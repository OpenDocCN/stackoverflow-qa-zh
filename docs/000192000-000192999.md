# StackOverflow 问答 000192000-000192999

# interface - 界面设计问题

> ID：192002
> 
> 赞同：1
> 
> 时间：2008-10-10T15:54:45.110
> 
> 标签：interface

不久前我问了[这个问题](https://stackoverflow.com/questions/168661/javascript-table-manipulation)，基本上该项目几乎包括在浏览器中复制 excel。我们希望人们以类似 Excel 的方式输入数据。我的问题是，最好的控制是什么？我应该使用常规表，然后将列附加到它，还是应该使用数据网格并将其翻转 XtoY？你会采取什么方法？

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-10T16:01:17.967

除非您有大量的开发时间，否则不要尝试自己做。尝试使用 Telerik 或 ComponentOne 等第三方控件。没有一个可能具有您想要的所有功能，但您应该能够找到足够接近的功能。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-10T15:59:31.887

选项 1：查看 Silverlight 选项以开发您的应用程序。它有一个很好的 Excel，比如 DataGrid，它在浏览器杠杆上呈现，你可以在任何想要进行更改的时间点对服务器进行异步调用。

选项 2：WPF 中有许多可用的数据网格，您可以使用[.NET3.5](https://stackoverflow.com/questions/127647/what-is-the-best-free-datagrid-for-wpf)获得高性能应用程序，并且可以将其托管为 XBAP 应用程序。

选项 3：启用 AJAX 的典型 ASP.NET Datagrid

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-10T16:26:57.977

我建议将[ExtJS](http://extjs.com)用于具有 AJAX 数据源的[可编辑数据网格。](http://extjs.com/deploy/dev/examples/grid/edit-grid.html)ExtJS 有点笨重但非常灵活。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-12T01:41:59.137

查看[SpreadsheetGear](http://www.spreadsheetgear.com/support/samples/)。这是模拟（并与）Excel for .Net 一起使用的控制权下降。我已经看到它很好地用于显示和后端计算。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-10T17:18:03.303

Farpoint Spread 控件可以很好地模拟 Excel 网格，您甚至可以在其后面编写公式。虽然确实要花钱

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-08T10:02:20.630

也许[codeplex](http://www.codeplex.com/wpf)上 wpf 工具包中的新 Datagrid有你需要的东西。该数据网格可以按照您需要的方式进行模板化和样式化。

# c++ - 为什么在 Windows/unix/linux 中使用管道被认为是危险的？

> ID：192021
> 
> 赞同：7
> 
> 时间：2008-10-10T15:57:30.547
> 
> 标签：c++, c, ipc, pipe, named-pipes

为什么管道被认为是危险的使用？可以做些什么来避免这些安全问题？

我对 Windows 最感兴趣，但如果您有其他操作系统信息，请提供。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-10T16:03:39.147

（假设您在提到“c”和“IPC”时谈论的是 Unix 命名管道。Windows 命名管道的工作方式有所不同）

任何有权限的人都可以写入命名管道，因此您必须小心权限和锁定（请参阅[flock()](http://ftp.altlinux.org.ua/pub/docs/developer/general/unix-prog-faq/faq_3.html)）。如果应用程序信任它从命名管道获得的输入（通常情况下，除非您明确地在其中构建输入验证），那么恶意用户可以在获得许可的情况下将任何所需的数据写入命名管道。

此外，如果您没有专门锁定它，任何具有权限的用户都可以从管道中读取并拦截来自管道的数据。然后，读取器期望的输入流中缺少数据。

# sql - 从字符串到 Blob

> ID：192028
> 
> 赞同：2
> 
> 时间：2008-10-10T15:58:35.100
> 
> 标签：sql, mysql, blob

我正在尝试在 group_concat 命令中使用 concat_ws 。使用查询，简化如下：

```
SELECT item.title, GROUP_CONCAT( CONCAT_WS(  ',', attachments.id, attachments.type,     attachments.name ) )  as attachments
FROM story AS item
LEFT OUTER JOIN story_attachment AS attachments ON item.id = attachments.item_id
GROUP BY item.id 
```

我将附件列作为 Blob 类型。是否可以将其作为字符串而不是 Blob 获取？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-10T16:06:46.550

您需要转换为字符..

```
SELECT item.title, GROUP_CONCAT( CAST(CONCAT_WS(',', attachments.id, 
attachments.type, attachments.name ) as CHAR ) ) as attachments 
FROM story AS item 
LEFT OUTER JOIN story_attachment AS attachments 
ON item.id = attachments.item_id GROUP BY item.id 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-10T16:09:38.837

虽然我怀疑 CAST 是合适的答案，但值得一提的是，我过去遇到过类似的事情，结果证明是一个奇怪/冲突的排序规则类型和字符集。

# html - 一个 HTML 元素可以有多个 id 吗？

> ID：192048
> 
> 赞同：349
> 
> 时间：2008-10-10T16:04:16.057
> 
> 标签：html, xhtml, standards-compliance

我知道一个 id 在 HTML/XHTML 页面中必须是唯一的。

对于给定的元素，我可以为其分配多个 id 吗？

```
<div id="nested_element_123 task_123"></div> 
```

我意识到我有一个简单的解决方案，只需使用一个类。我只是对以这种方式使用 id 感到好奇。

* * *

## 回答 #1

> 赞同：222
> 
> 时间：2008-10-10T16:09:16.577

不，来自[XHTML 1.0 规范](http://www.w3.org/TR/xhtml1/#h-4.10)

> 在 XML 中，片段标识符属于 ID 类型，每个元素只能有一个 ID 类型的属性。因此，在 XHTML 1.0 中，id 属性被定义为 ID 类型。为了确保 XHTML 1.0 文档是结构良好的 XML 文档，XHTML 1.0 文档在上面列出的元素上定义片段标识符时必须使用 id 属性。有关在将 XHTML 文档作为媒体类型 text/html 提供服务时确保此类锚点向后兼容的信息，请参阅 HTML 兼容性指南。

* * *

## 回答 #2

> 赞同：209
> 
> 时间：2011-04-16T07:53:16.787

与其他人所说的相反，正确答案是**YES**

选择[器规范](http://www.w3.org/TR/selectors/#id-selectors)对此非常清楚：

> 如果一个元素有多个 ID 属性，则必须将所有这些属性都视为该元素的 ID，以用于 ID 选择器。这种情况可以通过混合使用 xml:id、DOM3 Core、XML DTD 和特定命名空间来实现知识。

* * *

**编辑**

澄清一下：是的，一个 XHTML 元素可以有多个 id，例如

```
<p id="foo" xml:id="bar"> 
```

但是使用空格分隔的列表将多个 id 分配给同一`id`属性是不可能的。

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2008-10-10T16:13:22.683

我的理解一直是：

*   ID 是**一次性**的，仅适用于一个元素...

    *   每个元素都**作为** ***唯一标识符*** **（仅）归属于一个元素**。
*   类可以**多次**使用...

    *   因此，它们可以应用于**多个元素**，并且类似但不同的是，每个元素可以有**多个类（即多个类）**。

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2008-10-10T16:10:35.467

**不。** 虽然[W3C](http://www.w3.org/TR/REC-html40/struct/global.html#adef-id)对 HTML 4 的定义似乎没有明确涵盖您的问题，[但 name 和 id 属性的定义表明](http://www.w3.org/TR/REC-html40/types.html#type-name)标识符中没有空格：

> ID 和 NAME 标记必须以字母 ([A-Za-z]) 开头，后跟任意数量的字母、数字 ([0-9])、连字符 ("-")、下划线 ("_") , 冒号 (":") 和句点 (".")。

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2008-10-10T16:11:23.250

不，每个 DOM 元素，如果它有一个 id，它就有一个唯一的 id。您可以使用以下方法对其进行近似：

```
<div id='enclosing_id_123'><span id='enclosed_id_123'></span></div> 
```

然后使用导航来获得你真正想要的。

如果您只是想应用样式，类名会更好。

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2008-10-10T23:14:43.317

每个元素只能有一个 ID，但确实可以有多个类。但是不要有多个类属性；将多个类值放入一个属性中。

```
<div id="foo" class="bar baz bax"> 
```

是完全合法的。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-10T16:08:52.473

不，单个标签不能有多个 id，但我看到一个标签具有一个`name`属性和一个`id`属性，某些应​​用程序将其视为相同。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-10-10T16:17:01.290

不，如果你想沿着这条路走，你应该使用嵌套的 DIV。此外，即使可以，想象一下运行 document.getElementByID() 时会引起的混乱。如果有多个ID，它将获取什么ID？

在一个稍微相关的主题上，您可以将多个*类*添加到一个 DIV。请参阅 Eric Myers 的讨论，

[http://meyerweb.com/eric/articles/webrev/199802a.html](http://meyerweb.com/eric/articles/webrev/199802a.html)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2012-04-18T18:21:17.190

我想说技术上是的，因为实际上渲染的内容在技术上总是依赖于浏览器。大多数浏览器都尽可能地遵守规范，据我所知，CSS 规范中没有任何内容反对它。我只会保证在任何其他解释器介入之前发送到浏览器的实际 HTML、CSS 和 JavaScript 代码。

但是，我也说不，因为我通常测试的每个浏览器实际上都不允许你这样做。

如果您需要自己查看，请将以下内容另存为 .html 文件并在主要浏览器中打开。在我测试过的所有浏览器中，JavaScript 函数都不匹配元素。但是，从 id 标签中删除“hunkojunk”，一切正常。

### 示例代码

```
<html>
<head>
</head>
<body>
    <p id="hunkojunk1 hunkojunk2"></p>

    <script type="text/javascript">
        document.getElementById('hunkojunk2').innerHTML = "JUNK JUNK JUNK JUNK JUNK JUNK";
    </script>
</body>
</html> 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2018-10-30T20:55:35.110

分配给 div 元素的任何 ID 都是唯一的。但是，您可以在“下”分配多个 ID，而不是“分配给”一个 div 元素。在这种情况下，您必须将这些 ID 表示为`<span></span>`ID。

假设您希望同一个 HTML 页面中的两个链接指向页面中的同一个 div 元素。

### 两个不同的链接

```
<p><a href="#exponentialEquationsCalculator">Exponential Equations</a></p>

<p><a href="#logarithmicExpressionsCalculator"><Logarithmic Expressions</a></p> 
```

### 指向页面的同一部分

```
<!-- Exponential / Logarithmic Equations Calculator -->
<div class="w3-container w3-card white w3-margin-bottom">
   <span id="exponentialEquationsCalculator"></span>
   <span id="logarithmicEquationsCalculator"></span>
</div> 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2013-08-13T13:41:41.033

从*[7.5.2 元素标识符： id 和 class 属性](http://www.w3.org/TR/REC-html40/struct/global.html#h-7.5.2)*：

> id 属性为元素分配一个**唯一**标识符（可以由 SGML 解析器验证）。

和

> ID 和 NAME 标记必须以字母 ([A-Za-z]) 开头，后跟任意数量的字母、数字 ([0-9])、连字符 ("-")、下划线 ("_") , 冒号 (":") 和句点 (".")。

所以“id”必须是唯一的，不能包含空格。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-04-20T11:40:02.187

正如其他人在我之前所说的那样，简单的答案是否定的。一个元素不能有多个 ID，并且一个 ID 不能在一个页面中多次使用。尝试一下，您会发现它*不起作用*。

回应[tvanfosson](https://stackoverflow.com/questions/192048/can-an-html-element-have-multiple-ids/192071#192071)关于在两个不同元素中使用相同 ID 的回答。据我所知，一个 ID 只能在一个页面中使用一次，无论它是否附加到不同的标签。

根据定义，需要一个 ID 的元素应该是唯一的，但如果您需要两个 ID，那么它并不是真正唯一的，而是需要一个类。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2015-04-25T17:54:01.300

不。

话虽如此，没有什么可以阻止你这样做。但是你会得到与各种浏览器不一致的行为。不要这样做。每个元素一个 ID。

如果您想对一个元素进行多个分配，请使用类（用空格分隔）。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-10T16:06:59.263

这很有趣，但据我所知，答案是肯定的。我不明白为什么需要嵌套 ID，因为您通常会将它与另一个具有相同嵌套 ID 的元素交叉。不做就没有意义，做也没什么意义。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-03-01T16:11:58.893

类是专门为此而设计的，下面是您可以理解的代码：

```
<html>
<head>
    <style type="text/css">
     .personal{
            height:100px;
            width: 100px;

        }
    .fam{
            border: 2px solid #ccc;
        }
    .x{
            background-color:#ccc;
        }

    </style>
</head>

<body>
    <div class="personal fam x"></div>
</body>
</html> 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2017-12-16T13:13:36.950

不。

从*[3.2.3.1 开始的 id 属性](https://www.w3.org/TR/2011/WD-html5-20110525/elements.html#the-id-attribute)*：

> 该值不得包含任何空格字符。

`id="a b"`<-- 在该***ValuE***中找到空格字符。

也就是说，您*可以*设置多个 ID 的样式。但如果你遵循规范，答案是否定的。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-01-28T11:52:22.470

ID 应该是唯一的，因此您应该只在页面上使用一次特定的 ID。类可以重复使用。

查看*[HTML id 属性](https://www.w3schools.com/html/html_id.asp)*(W3Schools) 了解更多详情。

* * *

## 回答 #18

> 赞同：-2
> 
> 时间：2010-09-13T10:53:52.413

我不认为你可以有两个身份证，但它应该是可能的。两次使用相同的身份证是不同的情况......就像两个人使用相同的护照。然而，一个人可能有多个护照......来找这个是因为我遇到了一个员工可以拥有多个功能的情况。说具有 id="sysadm teamcoordinator" 的“sysadm”和“team coordinator”可以让我从其他页面引用它们，以便employees.html#sysadm 和employees.html#teamcoordinator 会指向同一个地方......有一天有人否则可能会在 sysadm 仍然是 sysadm 时接管团队协调员功能......然后我只需要更改 employees.html 页面上的 id......但就像我说的 - 它不起作用:(

# emacs - 是否可以在 Lisp 中为函数名设置别名？

> ID：192049
> 
> 赞同：14
> 
> 时间：2008-10-10T16:04:19.613
> 
> 标签：emacs, lisp

...就像包裹一样。

我使用 Emacs（也许它可以提供某种解决方案）。

例如`(defun the-very-very-long-but-good-name () ...)`在后面的代码中没有用处。但是名称 like`Fn-15`或首字母缩写也没有用。是否可以有一个类似于包的别名，或者在尝试调用函数名称时访问文档字符串？

换句话说，函数是否有可能以某种方式混合自记录和短名称？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-10-10T17:23:04.573

你想要`defalias`。`(defalias 'newname 'oldname)`将保留文档，甚至在请求其文档时显示“newname 是 `oldname' 的别名”。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2014-01-12T14:12:08.733

来自《On Lisp》？代码如下：

```
(defmacro alias (new-name prev-name)
  `(defmacro ,new-name (&rest args)
     `(,',prev-name ,@args)))

; use: (alias df defun)

(defun group (source n)
  (if (zerop n) (error "zero length"))
  (labels ((rec (source acc)
             (let ((rest (nthcdr n source)))
               (if (consp rest)
                   (rec rest (cons (subseq source 0 n) acc))
                   (nreverse (cons source acc))))))
    (if source (rec source nil) nil)))

(defmacro aliasx (&rest names)
  `(alias
     ,@(mapcar #'(lambda (pair)
                   `(alias ,@pair))
               (group names 2))))

; use: (aliasx df1 defun 
;              df2 defun 
;              df3 defun) 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2014-04-28T05:12:41.847

您可以使用`setf`将函数分配给另一个函数单元格，例如：

```
(defmacro alias (new-name prev-name)
  `(setf (symbol-function ,new-name) (symbol-function ,prev-name))) 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-14T16:49:06.667

如果是所有类型导致不希望继续使用长名称，那么是的，emacs 可以提供帮助。退房[`abbrev-mode`](http://www.cs.cmu.edu/cgi-bin/info2www?(emacs)Abbrevs)。在这种情况下也深思熟虑的是[`hippie-expand`](http://www.emacswiki.org/cgi-bin/wiki/HippieExpand).

如果是可读性问题，那就更难了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-10T16:23:13.350

如果您的问题是您不记得很长的函数名称，但您记得名称的一部分，这就是“apropos”的用途。在我的 Emacs 中，我将“Ch a”绑定到“hyper-apropos”。您输入要查找的符号的子字符串，它会列出所有匹配项。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-10T16:27:19.473

我不知道 Emacs，但不会（定义短名称 longnamefunctionblahblah）工作吗？

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-10-10T16:25:44.407

您可以简单地拥有一个只调用另一个函数的函数。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-10-10T17:15:02.513

您可以使用`(defmacro ...)`别名函数

# .net - 如何在 Windows 窗体应用程序中创建复合键盘快捷键？

> ID：192055
> 
> 赞同：15
> 
> 时间：2008-10-10T16:05:18.160
> 
> 标签：.net, winforms, keyboard-shortcuts

我想创建一个组件，它允许我们拥有与任意命令相关联的复合键盘快捷键，就像 Visual Studio IDE 和 Microsoft Office 所做的那样。

也就是说，由一系列多次击键组成的键盘快捷键，例如`Ctrl`++ 。在 Visual Studio 中，这将打开类视图。当按下第一组键 ( + ) 时，状态栏中会出现消息“(Ctrl + W) 已按下。等待和弦的第二个键...”。`W``C``Ctrl``W`

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-11T10:17:49.623

专门回答**键盘和弦**的问题，我认为目前没有现成的选项可供您使用。

但是，建模应该足够简单。我会创建一个类，也许`KeyboardChordProvider`。它需要了解表单级别的键盘事件。如其他地方所述，该`Form.KeyPreview`属性必须是`true`. 此提供者订阅该`Form.KeyPress`事件可能就足够了。如果您传入表单，则可以在提供者的构造函数中完成所有这些操作。

您需要向提供商注册潜在的击键。

在内部，此实例将跟踪当前状态。每当观察到表示和弦的第一个键的击键时，您将更新提供者的状态并引发一个事件，以便订阅者可以设置文本：*(CTRL+W) 被按下。等待和弦的第二个键...*

如果下一次击键与潜在的次要选项匹配，那么您就有了匹配项，并且可以引发一个`ChordPressed`包含所输入击键详细信息的事件。`ChordPressed`或者，您可能只调用在注册和弦时提供给提供者的特定回调（以避免在事件处理程序中有 switch 语句或其他调度）。

*如果在任何时候，击键与潜在的下一个*选项不匹配，那么您将重置提供程序的状态。

在提供者内部，您可以使用树结构对可能的击键进行建模。提供者的当前状态只是一个特定的树节点。一开始，根节点将处于活动状态。如果一个孩子匹配一个击键，那么它将成为预期下一个击键的当前节点。如果子节点是叶节点，则整个和弦都已匹配，您将引发`ChordPressed`事件（传递使您到达该点的笔画链）或调用存储在叶中的回调。每当没有击键与子节点匹配时，重置回使根节点处于活动状态。

我认为这个设计会达到你想要的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-10T16:33:38.743

菜单控件具有名为[ShortCut](http://msdn.microsoft.com/en-us/library/system.windows.forms.menuitem.shortcut.aspx)的属性，您可以在其中分配值。当您按下该快捷键时，将调用该菜单项。将该属性用于具有相应菜单的命令。

如果您需要菜单上不可用的快捷方式，那么您必须通过表单或控件上的[KeyUp](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.keyup.aspx)或[KeyDown事件自行处理。](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.keydown.aspx)[KeyEventArgs](http://msdn.microsoft.com/en-us/library/system.windows.forms.keyeventargs.aspx)对象将传递给您的处理程序，您可以检查按下了哪个键，以及是否还按下了 Ctrl、Alt 或 Shift 键。

来自 MSDN 的示例代码：

```
// Handle the KeyDown event to determine the type of character entered into the control.
private void textBox1_KeyDown(object sender, System.Windows.Forms.KeyEventArgs e)
{
    // Initialize the flag to false.
    nonNumberEntered = false;

    // Determine whether the keystroke is a number from the top of the keyboard.
    if (e.KeyCode < Keys.D0 || e.KeyCode > Keys.D9)
    {
        // Determine whether the keystroke is a number from the keypad.
        if (e.KeyCode < Keys.NumPad0 || e.KeyCode > Keys.NumPad9)
        {
            // Determine whether the keystroke is a backspace.
            if(e.KeyCode != Keys.Back)
            {
                // A non-numerical keystroke was pressed.
                // Set the flag to true and evaluate in KeyPress event.
                nonNumberEntered = true;
            }
        }
    }
    //If shift key was pressed, it's not a number.
    if (Control.ModifierKeys == Keys.Shift) {
        nonNumberEntered = true;
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-10T16:12:59.753

使用表单的 OnKeyPressed 事件并检查是否在 eventArgs 参数中按下了所需的组合键

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-10T17:37:30.847

除了一些答案之外，在按钮或菜单项的标题中使用 & 号会导致它带有下划线，并且可以通过使用`Alt`+ 前面加上 & 号 & 的字母来访问。

换句话说，如果您有一个标题为*&File*的菜单项，它将在 F 下方显示一个下划线，并且用户可以通过单击`Alt`+来触发该菜单`F`。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-10T19:48:00.707

这取决于键盘快捷键的范围。如果您希望在不使用工具栏的情况下从窗体上的任何控件使用键盘快捷键，请设置

```
Form.KeyPreview = true; 
```

在表格上。这将允许所有按键事件在表单级别被*KeyPress*、*KeyDown*和*KeyUp*事件过滤，这将允许在一个位置处理单个键盘快捷键，而不是在所有用户控件中复制功能。

[MSDN：Form.KeyPreview 属性](http://msdn.microsoft.com/en-us/library/system.windows.forms.form.keypreview.aspx)

# language-agnostic - Windows 和 Linux 中的管道有什么区别？

> ID：192073
> 
> 赞同：19
> 
> 时间：2008-10-10T16:12:22.030
> 
> 标签：language-agnostic, ipc, pipe, named-pipes

Windows 和 Linux 中的管道有什么区别？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-10T16:37:26.707

我知道的一个区别是，Linux 下的命名管道是文件系统中的实际条目（您将在目录列表中看到它，它们具有特殊类型），而在 Windows 上它们存储在某个神奇的存储库中（它们都通过路径“\\.\pipe\”访问。

其次，在 Linux 中，您可以使用标准文件 IO 方法从管道中写入/读取，就好像它们是任何其他文件一样。而在 Windows 上，您必须使用 Win32 API 中的特殊“管道”函数。

我更喜欢 linux 的方法，因为它让我可以在任何我想要的应用程序中使用管道。例如：

```
mkfifo pipe.wav
decodeMP3 song.mp3 --out pipe.wav &
encodeAVI video.mpeg pipe.wav --out video.avi 
```

这让我可以将 MP3 解码器的输出直接通过管道传输到视频解码器中，而不必先将整个 MP3 解码为磁盘上的 WAV 文件。如果你有一个双核 CPU，它会很方便，因为这样你就可以同时运行这两个操作，以获得很好的加速。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2016-07-21T19:04:49.050

另一个重要的区别

窗户下

```
A | B | C 
```

直到 A 完成它的输出 B 才开始读取，对于 C 读取的 B 输出也是如此

*nix 将输入和输出挂钩在一起，以便 C 可以读取 B 的输出，而 B 可以在 A 和 B 仍在运行时读取 A 的输出

吞吐量大致相同，但使用 *nix 时输出显示得更快。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-10T19:23:54.750

在 Linux（和一般的 *ix）下，“一切都是文件”。您可以不受限制地读取/写入/查找管道、套接字和设备，只要这些操作有意义。

而对于这些不同类型的对象，Windows 的体系结构要统一得多。虽然我不能告诉你细节，但我知道 Windows 和 Linux 之间的管道缓冲有很大不同，所以你可能会遇到困难。

此外，一种常见的 Unix-y 管道使用是`fork()`子进程，然后通过管道与其通信（父进程打开一端，子进程打开另一端）。在 Windows 下，这种事情是不可能的。IPC 机制完全不同。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-10T19:40:47.883

另请参阅上一个线程：

[什么是命名管道？](https://stackoverflow.com/questions/175579/what-are-named-pipes#176140)

其中包含我的拍摄和其他几个人的

# wpf - 设置 DependencyProperty 值时，是在强制之前还是之后调用验证？

> ID：192077
> 
> 赞同：4
> 
> 时间：2008-10-10T16:12:41.157
> 
> 标签：wpf, dependency-properties

我创建了一个带有 DependencyProperty 的简单类。设置值时，我观察到在 CoerceValueCallback 之前调用了 ValidateValueCallback。

在[wpftutorial](http://wpftutorial.net/How+does+a+DependencyProperty+resolve+its+value.htm)和其他书籍中，声明在验证之前调用强制。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-10T18:39:57.740

是的，我观察到了同样的事情。看来验证确实先于强制。设置新值时，将对其进行验证。如果强制更改/约束一个值，则必须再次对其进行验证。所以从技术上讲，如果我们将强制视为另一个“集合”，那么验证总是在“集合”之后发生。

我猜其他网站/书籍正在做出一个假设，尽管令人困惑，但验证具体发生在强制之后。它似乎发生在任何“设置”之后。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-10T17:21:44.997

3.5sp1 在这里。

[MSDN](http://msdn.microsoft.com/en-us/library/ms745795.aspx)似乎暗示验证发生在强制之前。这与您所发现的相符。

我自己做的，`ValidateValueCallback`之前来过`CoerceValueCallback`。我什至在[Reflector](http://reflector.red-gate.com/)中阅读了源代码并确认了这一点，尽管很难遵循所有代码并确定所有可能的路径。

有趣的。我想知道在早期版本中是否相反。

**编辑：**

显然，当您从 中返回不同的值时`CoerceValueCallback`，`ValidateValueCallback`会再次调用 以获取新值。验证-强制-验证。

# java - 如何获取 java.sql.ResultSet 的大小？

> ID：192078
> 
> 赞同：303
> 
> 时间：2008-10-10T16:12:46.430
> 
> 标签：java, sql, jdbc, resultset, record-count

这不应该是一个非常简单的操作吗？但是，我看到既`size()`没有方法也没有`length()`方法。

* * *

## 回答 #1

> 赞同：289
> 
> 时间：2008-10-10T16:17:36.403

`SELECT COUNT(*) FROM ...`改为查询。

或者

```
int size =0;
if (rs != null) 
{
  rs.last();    // moves cursor to the last row
  size = rs.getRow(); // get row id 
} 
```

在任何一种情况下，您都不必遍历整个数据。

* * *

## 回答 #2

> 赞同：100
> 
> 时间：2008-10-10T16:16:24.923

```
ResultSet rs = ps.executeQuery();
int rowcount = 0;
if (rs.last()) {
  rowcount = rs.getRow();
  rs.beforeFirst(); // not rs.first() because the rs.next() below will move on, missing the first element
}
while (rs.next()) {
  // do your standard per row stuff
} 
```

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2013-04-10T07:46:11.667

好吧，如果您有 a`ResultSet`类型`ResultSet.TYPE_FORWARD_ONLY`，您希望保持这种方式（而**不是**切换到 a `ResultSet.TYPE_SCROLL_INSENSITIVE`or`ResultSet.TYPE_SCROLL_INSENSITIVE`以便能够使用`.last()`）。

我建议一个非常好的和高效的 hack，在顶部添加一个包含行数的第一个虚假/虚假行。

*例子*

假设您的查询如下

```
select MYBOOL,MYINT,MYCHAR,MYSMALLINT,MYVARCHAR
from MYTABLE
where ...blahblah... 
```

你的输出看起来像

```
true    65537 "Hey" -32768 "The quick brown fox"
false  123456 "Sup"    300 "The lazy dog"
false -123123 "Yo"       0 "Go ahead and jump"
false       3 "EVH"    456 "Might as well jump"
...
[1000 total rows] 
```

只需将您的代码重构为如下所示：

```
Statement s=myConnection.createStatement(ResultSet.TYPE_FORWARD_ONLY,
                                         ResultSet.CONCUR_READ_ONLY);
String from_where="FROM myTable WHERE ...blahblah... ";
//h4x
ResultSet rs=s.executeQuery("select count(*)as RECORDCOUNT,"
                           +       "cast(null as boolean)as MYBOOL,"
                           +       "cast(null as int)as MYINT,"
                           +       "cast(null as char(1))as MYCHAR,"
                           +       "cast(null as smallint)as MYSMALLINT,"
                           +       "cast(null as varchar(1))as MYVARCHAR "
                           +from_where
                           +"UNION ALL "//the "ALL" part prevents internal re-sorting to prevent duplicates (and we do not want that)
                           +"select cast(null as int)as RECORDCOUNT,"
                           +       "MYBOOL,MYINT,MYCHAR,MYSMALLINT,MYVARCHAR "
                           +from_where); 
```

您的查询输出现在将类似于

```
1000 null     null null    null null
null true    65537 "Hey" -32768 "The quick brown fox"
null false  123456 "Sup"    300 "The lazy dog"
null false -123123 "Yo"       0 "Go ahead and jump"
null false       3 "EVH"    456 "Might as well jump"
...
[1001 total rows] 
```

所以你只需要

```
if(rs.next())
    System.out.println("Recordcount: "+rs.getInt("RECORDCOUNT"));//hack: first record contains the record count
while(rs.next())
    //do your stuff 
```

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2014-04-18T16:07:49.050

```
int i = 0;
while(rs.next()) {
    i++;
} 
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2012-11-28T05:47:55.467

使用时出现异常`rs.last()`

```
if(rs.last()){
    rowCount = rs.getRow(); 
    rs.beforeFirst();
} 
```

：

```
java.sql.SQLException: Invalid operation for forward only resultset 
```

这是由于默认情况下它是`ResultSet.TYPE_FORWARD_ONLY`，这意味着您只能使用`rs.next()`

***解决方案是：***

```
stmt=conn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE,
    ResultSet.CONCUR_READ_ONLY); 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2015-05-21T21:23:17.083

[速度考虑]

这里有很多 ppl 建议`ResultSet.last()`，但为此您需要打开连接`ResultSet.TYPE_SCROLL_INSENSITIVE`，因为 Derby 嵌入式数据库的**速度**比`ResultSet.TYPE_FORWARD_ONLY`.

根据我对嵌入式 Derby 和 H2 数据库的微测试，`SELECT COUNT(*)`在 SELECT 之前调用它要快得多。

[这是我的代码和基准测试的更详细信息](https://stackoverflow.com/questions/30359737/how-to-run-2-sql-selects-atomically-or-any-other-better-way-to-get-number-of)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2014-08-28T07:59:34.927

ResultSet 大小的获取方式，无需使用 ArrayList 等

```
int size =0;  
if (rs != null)   
{  
rs.beforeFirst();  
 rs.last();  
size = rs.getRow();
} 
```

现在你会得到大小，如果你想打印结果集，在打印之前也使用下面的代码行，

```
rs.beforeFirst(); 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2012-09-30T01:49:38.150

这是一种进行行数计数的简单方法。

```
ResultSet rs = job.getSearchedResult(stmt);
int rsCount = 0;

//but notice that you'll only get correct ResultSet size after end of the while loop
while(rs.next())
{
    //do your other per row stuff 
    rsCount = rsCount + 1;
}//end while 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-08-27T04:43:16.927

```
String sql = "select count(*) from message";
ps =  cn.prepareStatement(sql);

rs = ps.executeQuery();
int rowCount = 0;
while(rs.next()) {
    rowCount = Integer.parseInt(rs.getString("count(*)"));
    System.out.println(Integer.parseInt(rs.getString("count(*)")));
}
System.out.println("Count : " + rowCount); 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-03-13T15:25:04.213

```
theStatement=theConnection.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);

ResultSet theResult=theStatement.executeQuery(query); 

//Get the size of the data returned
theResult.last();     
int size = theResult.getRow() * theResult.getMetaData().getColumnCount();       
theResult.beforeFirst(); 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-06-02T17:06:56.547

我检查了**ResultSet**接口的运行时值，发现它几乎一直是一个**ResultSetImpl**。ResultSetImpl 有一个方法调用`getUpdateCount()`它返回您正在寻找的值。

*此代码示例应该足够了：*
`ResultSet resultSet = executeQuery(sqlQuery);`
`double rowCount = ((ResultSetImpl)resultSet).getUpdateCount()`

我意识到向下转换通常是一个不安全的过程，但这种方法还没有让我失望。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2017-11-06T09:55:55.383

今天，我使用了这个逻辑，为什么我不知道得到 RS 的计数。

```
int chkSize = 0;
if (rs.next()) {
    do {  ..... blah blah
        enter code here for each rs.
        chkSize++;
    } while (rs.next());
} else {
    enter code here for rs size = 0 
}
// good luck to u. 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-11-06T15:20:08.107

我遇到了同样的问题。`ResultSet.first()`在执行解决它之后以这种方式使用：

```
if(rs.first()){
    // Do your job
} else {
    // No rows take some actions
} 
```

文档（[链接](http://docs.oracle.com/javase/7/docs/api/java/sql/ResultSet.html#first())）：

> ```
> boolean first()
>     throws SQLException 
> ```
> 
> 将光标移动到该`ResultSet`对象的第一行。
> 
> **回报：**
> 
> `true`如果光标在有效行上；`false`如果结果集中没有行
> 
> **抛出：**
> 
> [`SQLException`](http://docs.oracle.com/javase/7/docs/api/java/sql/SQLException.html)- 如果发生数据库访问错误；此方法在关闭的结果集上调用或结果集类型为`TYPE_FORWARD_ONLY`
> 
> [`SQLFeatureNotSupportedException`](http://docs.oracle.com/javase/7/docs/api/java/sql/SQLFeatureNotSupportedException.html)- 如果 JDBC 驱动程序不支持此方法
> 
> **自从：**
> 
> 1.2

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2019-09-30T06:37:04.110

最简单的方法，运行 Count(*) 查询，执行 resultSet.next() 指向第一行，然后执行 resultSet.getString(1) 来获取计数。代码 ：

```
ResultSet rs = statement.executeQuery("Select Count(*) from your_db");
if(rs.next()) {
   int count = rs.getString(1).toInt()
} 
```

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2018-05-11T20:03:57.333

给列一个名字..

```
String query = "SELECT COUNT(*) as count FROM 
```

将该列从 ResultSet 对象引用到一个 int 并从那里执行您的逻辑..

```
PreparedStatement statement = connection.prepareStatement(query);
statement.setString(1, item.getProductId());
ResultSet resultSet = statement.executeQuery();
while (resultSet.next()) {
    int count = resultSet.getInt("count");
    if (count >= 1) {
        System.out.println("Product ID already exists.");
    } else {
        System.out.println("New Product ID.");
    }
} 
```

# firefox - Firefox 到本地或网络页面的链接不起作用

> ID：192080
> 
> 赞同：35
> 
> 时间：2008-10-10T16:13:10.047
> 
> 标签：firefox, pdf, asp-classic, unc

我有一个 .asp 应用程序，其中图像文件 (.PDF) 存储在一个目录中（由复印机/扫描仪提供）。创建的文件名存储在数据库表中。当从网页启动查询时，会创建指向该文件的链接。单击时应显示图像。此功能在 Internet Explorer 中 100% 有效。Firefox 没有这样的运气（我有一些 Firefox 用户）。创建的超链接如下所示`file://Server/Scanner/XYZ.pdf`

Firefox 帮助建议原因是这样的：

> 到本地或网络页面的链接不起作用。作为安全预防措施，Firefox 禁止 Internet 上的站点链接到存储在本地计算环境中的文件。这些文件可能包括您计算机上的文件、映射的网络驱动器和 UNC 网络路径

解决方法的建议似乎都不起作用（或者我不理解创建图像显示的步骤）有什么建议吗？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-10-10T17:13:48.180

这是为安全而设计的默认 Firefox 行为。假设可能是大多数网站不知道本地文件（包括 UNC 路径）在哪里以及在哪里。

这可以在 Firefox 中关闭：

*   在地址栏中输入“about:config”并接受“我会小心的”
*   在旧版本中找到“security.checkloaduri”或在新版本的firefox中找到“security.fileuri.strict_origin_policy”并将值更改为“false”
*   重启火狐

那应该为你做。您可以在此处获得更多信息：

*   [http://kb.mozillazine.org/Security.fileuri.strict_origin_policy](http://kb.mozillazine.org/Security.fileuri.strict_origin_policy)
*   [http://kb.mozillazine.org/Security.fileuri.origin_policy](http://kb.mozillazine.org/Security.fileuri.origin_policy)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-10T17:11:24.940

## 火狐 >= 68.0.1

我可以使用此处提到的设置在 Firefox 中预览带有本地文件链接的图像和 PDF 文件：[https ://bugzilla.mozilla.org/show_bug.cgi?id=1303727](https://bugzilla.mozilla.org/show_bug.cgi?id=1303727)

我使用了本地文件的链接：`<a href="file://N:/path/to/file.ext">test</a>`

并在`user.js`上述设置中添加（带有调整的站点列表）：

> user_pref("capability.policy.policynames", "localfilelinks"); user_pref("capability.policy.localfilelinks.sites", " [http://my.intranet](http://my.intranet) "); user_pref("capability.policy.localfilelinks.checkloaduri.enabled", "allAccess");

此外，当将 Firefox 设置为“始终询问”PDF 文件时，我能够在 Adob​​e Acrobat Reader DC 中“打开”PDF，它在访问“文件 - > 属性”时报告了预期的本地文件夹。

* * *

## 火狐 >= 1.5.x < 20 (ish)

在硬盘上搜索 Firefox 配置文件文件夹，例如（12345678 代表八个随机数字和字母）：

*   Windows：“C:\Documents and Settings\Username\Application Data\Mozilla\Firefox\Profiles12345678.default\”
*   Linux：“/home/username/.mozilla/firefox/12345678.default/”
*   OS X：/用户名/库/应用程序支持/Firefox/Profiles/12345678.default/

在此文件夹中创建一个名为**user.js**的文本文件。将以下行写入该文本文件：

> `user_pref("capability.policy.default.checkloaduri.enabled", "allAccess");`

可在我的 PC（Firefox 3.0.3**和 19.0 beta**）上使用，参考如下：

*   `<img src="file://///server/share/image.png" />`
*   `<img src="file://\\\server\share\image.png" />`
*   `<img src="file://d:\image.png" />`
*   `<img src="file:///d:\image.png" />`
*   `<img src="file://d:/image.png" />`
*   `<img src="file:///d:/image.png" />`
*   `<img src="file://localhost/d:/image.png" />`

此外，如果您使用的是 NoScript 插件，请选中**Advanced \ Trusted \ Allow local links**选项。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-06-07T08:39:11.440

阅读此处给出的解决方案，我点击了[链接到本地​​页面的链接不起作用](http://kb.mozillazine.org/Links_to_local_pages_do_not_work)，对我来说，只有这个效果很好（我在本地 wamp 安装中使用 wordpress 来提供个人常见问题解答）：

*   转到“%Your Documents & Settings%\Application Data\Mozilla\Firefox\Profiles\%your profile%\”
*   编辑文件“prefs.js”
*   在文档末尾添加以下行：

.

```
user_pref("capability.policy.localfilelinks.checkloaduri.enabled", "allAccess");
user_pref("capability.policy.localfilelinks.sites", "http://localhost");
user_pref("capability.policy.maonoscript.javascript.enabled", "allAccess"); 
```

您可以将设置“security.checkloaduri”保留为其默认值，也可以将“security.fileuri.strict_origin_policy”保留为默认值。多亏了这 3 行，您只需为本地服务器设置一个例外。

请注意，如果您需要返回该 prefs.js 文件，请注意 Firefox 将按字母顺序对其进行排序。因此，您将在末尾添加的 3 行将位于开头的某个位置；)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-11T20:48:02.167

您可以加载 LocalLink FireFox 附加组件，它允许您右键单击本地链接并选择“在前台窗口中打开”。其他“打开...”菜单项应该可以工作，但不适合我。

[http://locallink.mozdev.org/](http://locallink.mozdev.org/)

此外，您可以像 Alex 建议的那样使用 NoScript，它可以正常单击本地链接。谢谢亚历克斯。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-06-30T16:57:24.493

Marko 的解决方案应该适用于本地文件系统上的链接，但我认为它不应该允许 http:// 页面链接到 file:// 页面。

此处讨论了从 http:// 页面链接的人的问题：http: [//kb.mozillazine.org/Links_to_local_pages_do_not_work](http://kb.mozillazine.org/Links_to_local_pages_do_not_work) 以及如何规避它并使自己面临风险的解释。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-10T16:54:52.880

您可以改为从磁盘读取文件，然后在页面的响应中发送它。

有关示例，请参见此[链接。](http://www.xefteri.com/articles/show.cfm?id=7)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-12-22T13:02:17.627

非常感谢我几个月以来一直在寻找这个解决方案，

::这件事奏效了::

这可以在 Firefox 中关闭：

```
* type "about:config" in the address bar and accept "i'll be careful"
* find "security.checkloaduri" in older versions or "security.fileuri.strict_origin_policy" in newer versions of firefox and change the value to "false"
* restart firefox 
```

::::

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-10T16:32:26.187

您不应该将页面真正存储在应用程序目录中并以这种方式引用它们。[http://SITENAME/Server/scanner/XYZ.pdf](http://SITENAME/Server/scanner/XYZ.pdf)。

我们对存储在一个目录中的文件做类似的事情，只存储文件名。然后我们使用已知的文件夹名称创建链接并附加文件名。这很好用。

最后，Firefox 对文件名中斜线的方向也有更多的了解。确保它们都是“/”而不是“\”。

希望这可以帮助。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-02T19:50:25.607

当心本地链接和策略管理器都为我工作的 gmarks（谷歌工具栏替换器）不兼容；本地链接更流畅一点，策略管理器给你更多控制

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2012-04-23T05:31:04.797

`file://localhost///servername/share/file.txt`在 FF11 上为我工作

（来自本地 html 文件`file:///C:/index.html`：）

# php - 使用 PHP + IIS6 的网站可以覆盖 php.ini 设置吗？

> ID：192083
> 
> 赞同：1
> 
> 时间：2008-10-10T16:13:39.923
> 
> 标签：php, windows, iis, configuration

我们将 PHP 5.2.6 部署到 c:\php 并且在该文件夹中有 php.ini 文件。在 Windows 上，网站可以像 apache 的 .htaccess 那样覆盖这些设置吗？例如

```
DirectoryIndex index.php index.html
<IfModule mod_php5.c>
php_flag magic_quotes_gpc off
  php_flag register_globals off
</IfModule>
<IfModule mod_php4.c>
  php_flag magic_quotes_gpc off
 php_flag register_globals off
</IfModule> 
```

***更新：***

我知道 ini_set() 但想知道是否有一种声明方式可以在网站的配置文件中而不是在脚本中执行此操作。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-10T16:16:17.750

我建议尽你所能避免将 r 更改`egister_globals`为 on，因为它是一个主要的安全漏洞。

但是您可以尝试使用`init_set()`来更改 PHP 代码中的设置，尽管有些设置在 PHP 开始运行后无法更改。（我相信这些在某种程度上取决于服务器。）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-10T17:48:09.780

您可以通过多种方式覆盖 php.ini 文件中的指令，但并非所有指令都可以通过每种方法进行更改。请参阅手册中的[php.ini 指令](http://www.php.net/manual/en/ini.php)页面以获取指令列表和适用于每个指令的方法。

表中的最后一列列出了适用于该特定方法的方法。在增加访问级别：

*   `PHP_INI_USER`- 可以使用`ini_set()`（或任何更高的方法）在用户脚本中设置
*   `PHP_INI_PERDIR`- 可以使用带有`php_value` 字符串值或`php_flag`二进制值（或任何更高方法）的 .htacess 文件进行设置
*   `PHP_INI_SYSTEM`- 只能使用 php.ini 或 httpd.conf 设置（都需要访问服务器的配置文件）
*   `PHP_INI_ALL`- 可以使用上述任何一种方法进行设置

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-10T17:26:20.417

[ini_set](http://ie.php.net/ini_set)应该做你所追求的 -

```
$option = 'magic_quotes_gpc';
echo "Value of $option => ", ini_get($option);
ini_set($option,0);
echo "New value of $option => ", ini_get($option); 
```

这里需要注意的是，仅仅因为您可以在运行时设置值并不意味着它会按预期工作，例如`register_globals`在运行时设置将几乎没有用处，因为该设置在您的脚本启动时已经完成了它的工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-03T21:18:18.553

从[http://us.php.net/configuration.changes](http://us.php.net/configuration.changes)：

**通过 Windows 注册表更改 PHP 配置**

在 Windows 上运行 PHP 时，可以使用 Windows 注册表在每个目录的基础上修改配置值。配置值存储在注册表项 HKLM\SOFTWARE\PHP\Per Directory Values 中，在与路径名对应的子项中。例如，目录 c:\inetpub\wwwroot 的配置值将存储在密钥 HKLM\SOFTWARE\PHP\Per Directory Values\c\inetpub\wwwroot 中。该目录的设置对于从此目录或其任何子目录运行的任何脚本都是活动的。键下的值应具有 PHP 配置指令的名称和字符串值。值中的 PHP 常量不会被解析。但是，只有 PHP_INI_USER 中可更改的配置值可以这样设置，PHP_INI_PERDIR 值不能。

...实际上还没有尝试过，因此您的里程可能会有所不同。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-24T10:46:36.970

我刚刚找到了一种新的方法。首先，我使用 phpinfo() 来查找我的托管服务提供商正在使用的 PHP.ini。

此后，我将包含以下代码的文件上传到我的托管空间：

```
 $fsrc = fopen($pathToIni,'r');
    $fdest = fopen($myHostingDir,'w+');
    $len = stream_copy_to_stream($fsrc,$fdest);
    fclose($fsrc);
    fclose($fdest);
    echo $len; 
```

这有效地将 php.ini 复制到了我的托管空间。此后，我下载了该 php.ini，将 register_globals 更改为关闭（为此我做了所有这些），并将其上传到我的托管空间的根目录。宾果游戏，给你。

我依赖于 IIS 使用完整的 php.ini（如果在目录中可用）这一事实。您不能仅覆盖特定设置，例如在 Apache 上使用 .htaccess。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-13T09:44:53.310

对于 cgi 环境，有一个名为[htscanner](http://pecl.php.net/package/htscanner)的模块。它基本上伪造 .htaccess 行为并允许每个目录配置。不幸的是，我在 Windows 上没有这方面的经验，更不用说 IIS6 了。

# c# - 测试以查看 C# 中是否存在图像

> ID：192085
> 
> 赞同：27
> 
> 时间：2008-10-10T16:13:53.183
> 
> 标签：c#, .net, iis

我正在为 SiteScope 编写诊断页面，我们需要测试的一个区域是是否可以从 Web 服务器访问到文件/媒体资产的连接。我认为可以做到这一点的一种方法是通过后面的代码加载图像并测试 IIS 状态消息是否为 200。

所以基本上我应该能够在站点内导航到这样的文件夹：/media/1/image.jpg 并查看它是否返回 200 ...如果不抛出异常。

我正在努力弄清楚如何编写这段代码。

任何帮助是极大的赞赏。

谢谢

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2008-10-10T16:26:36.450

只需使用 HEAD。如果您不需要它，则无需下载整个图像。这里有一些样板代码。

```
HttpWebRequest request = (HttpWebRequest)HttpWebRequest.Create("url");
request.Method = "HEAD";

bool exists;
try
{
    request.GetResponse();
    exists = true;
}
catch
{
   exists = false;
} 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-10-10T19:02:40.127

您可能还想检查您是否获得了 OK 状态代码（即 HTTP 200）以及来自响应对象的 mime 类型是否与您期望的相符。您可以将其扩展为，

```
public bool doesImageExistRemotely(string uriToImage, string mimeType)
{
    HttpWebRequest request = (HttpWebRequest)WebRequest.Create(uriToImage);
    request.Method = "HEAD";

    try
    {
        HttpWebResponse response = (HttpWebResponse)request.GetResponse();

        if (response.StatusCode == HttpStatusCode.OK && response.ContentType == mimeType)
        {
            return true;
        }
        else
        {
            return false;
        }   
    }
    catch
    {
        return false;
    }
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-25T12:18:10.887

你必须处理 HTTPWebResponse 对象，否则你会遇到我遇到的问题......

```
 public bool DoesImageExistRemotely(string uriToImage)
    {
        HttpWebRequest request = (HttpWebRequest)WebRequest.Create(uriToImage);

            request.Method = "HEAD";

            try
            {
                using (HttpWebResponse response = (HttpWebResponse)request.GetResponse())
                {

                    if (response.StatusCode == HttpStatusCode.OK)
                    {
                        return true;
                    }
                    else
                    {
                        return false;
                    }
                }
            }
            catch (WebException) { return false; }
            catch
            {
                return false;
            }
    } 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-10T16:31:14.987

我以前用过这样的东西，但可能有更好的方法：

```
try
{
    HttpWebRequest request = (HttpWebRequest)WebRequest.Create("http://somewhere/picture.jpg");
    request.Credentials = System.Net.CredentialCache.DefaultCredentials;
    HttpWebResponse response = (HttpWebResponse)request.GetResponse();
    myImg.ImageUrl = "http://somewhere/picture.jpg";
}
catch (Exception ex)
{
    // image doesn't exist, set to default picture
    myImg.ImageUrl = "http://somewhere/default.jpg";
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-11-02T10:34:24.020

如果您在请求期间遇到异常，例如“远程服务器返回错误：（401）未授权。”，

这可以通过添加以下行来解决

```
request.Credentials = new NetworkCredential(username, password); 
```

[从检查图像是否存在于 Intranet](https://stackoverflow.com/questions/7978318/check-if-image-exists-on-intranet)中添加到此问题的问题和答案。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-10-07T15:06:37.557

如果 url 像 http:\server.myImageSite.com 这样存在，则只有当 imageSize > 0 为真时，答案才为假。

```
 public static void GetPictureSize(string url, ref float width, ref float height, ref string err)
  {
    System.Net.HttpWebRequest wreq;
    System.Net.HttpWebResponse wresp;
    System.IO.Stream mystream;
    System.Drawing.Bitmap bmp;

    bmp = null;
    mystream = null;
    wresp = null;
    try
    {
        wreq = (System.Net.HttpWebRequest)System.Net.HttpWebRequest.Create(url);
        wreq.AllowWriteStreamBuffering = true;

        wresp = (HttpWebResponse)wreq.GetResponse();

        if ((mystream = wresp.GetResponseStream()) != null)
            bmp = new System.Drawing.Bitmap(mystream);
    }
    catch (Exception er)
    {
        err = er.Message;
        return;
    }
    finally
    {
        if (mystream != null)
            mystream.Close();

        if (wresp != null)
            wresp.Close();
    }
    width = bmp.Width;
    height = bmp.Height;
}

public static bool ImageUrlExists(string url)
{

    float width = 0;
    float height = 0;
    string err = null;
    GetPictureSize(url, ref width, ref height, ref err);
    return width > 0;
} 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-10-10T16:30:08.267

我会改为研究 HttpWebRequest - 我认为前面的答案实际上会下载数据，而您应该能够在没有来自 HttpWebRequest 的数据的情况下获得响应。

[http://msdn.microsoft.com/en-us/library/456dfw4f.aspx](http://msdn.microsoft.com/en-us/library/456dfw4f.aspx)直到第 4 步应该可以解决问题。如果需要，HttpWebResponse 上还有其他字段用于获取数字代码......

杰克

# resources - 个人代码库

> ID：192088
> 
> 赞同：21
> 
> 时间：2008-10-10T16:15:01.933
> 
> 标签：resources

所以我假设我不是唯一一个。我想知道是否还有其他人编译了个人代码库。你从一个工作到另一个工作的东西，有最佳实践的例子，你引以为豪的东西，或者只是你看到自己一遍又一遍地使用的常见方法。

我最近才开始我的 C# 库。它已经有很多小物件了。常见的正则表达式验证、异常处理接口、一些类型转换重载、枚举包装器、sql 注入检测方法，以及一些带有 AJAX 工具包示例的常见用户控件。

我想知道你里面有什么样的东西？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-10T16:38:18.610

我使用自己的 wiki 发布代码片段和评论。

我发现这比拥有自己的图书馆更有用。而且由于它们本质上是注释而不是完整的程序，因此谁拥有代码（您或您的雇主）没有问题。

PS：我并不隐瞒我从雇主那里得到的事实。事实上，他们中的大多数人都是积极的，甚至要求提供一份副本。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-10T16:30:41.137

因为我主要从事 Web 开发，所以我抽象出一些我最终经常在网站上为客户做的常见功能。

*   **阿贾克斯电子邮件**。几乎我工作的每个网站都有某种类型的联系表。我编写了一个实用程序，允许我在页面上放置一些 HTML，具有 JavaScript 字段验证，以及一个 PHP 库，需要我更改一些参数才能与每个客户端的邮件服务器一起使用。每次我将 CSS 包含到页面上时，我唯一需要编写的就是 CSS。

*   **样式表骨架生成器**。我编写了一个小型 JavaScript 实用程序，它遍历包含它的任何页面的 DOM，然后存根出一个有效的 CSS 框架，这样我就可以立即开始编写样式，而不必为我工作的每个站点执行重复性任务。

*   **JavaScript 查询字符串解析器。**有时我需要解析查询字符串，但它不需要对服务器进行任何重大修改（例如安装 PHP），因此我编写了一个通用的 JavaScript 实用程序，我可以轻松地为每个站点配置它。

我也有其他零碎的实用工具，但它们有点被黑客攻击在一起供个人使用。我会不好意思让任何人看到源代码。

## 更新

有几个人在评论中询问了我的样式表骨架生成器，因此我在[此处](http://www.tommcfarlin.com/pages_projects/get-styleshell/)提供了该项目的链接。它或多或少基于我构建 XHTML 和格式化 CSS 的方式，但希望您会发现它很有用。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-10T16:23:55.470

我发现使用[Snipplr](http://snipplr.com/)使这非常方便。您可以标记项目、保存收藏夹、按关键字搜索等。我主要将它用于与 Vim 相关的片段（常用命令、vimrc 文件等），但它可以用于任何事情。一探究竟。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-10T17:15:34.133

我在这里有我的个人 C++ 跨平台库：[http ://code.google.com/p/kgui/](http://code.google.com/p/kgui/)

它是开源的 LGPL，我在我的爱好/志愿者项目中使用它。我大约在 3 年前开始使用它，并且一直在缓慢地为其添加功能。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-02-11T18:37:45.270

[我使用来自http://www.highdots.com/products/source-code-library/](http://www.highdots.com/products/source-code-library/)的源代码库，因为我可以管理不同的文本文件、注释、屏幕截图和不同的编程语言。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-10T16:42:04.170

回到在 MacOS 7 上进行 C 编程的日子，我确实编写了一个相当广泛的 OO 库（是的，非常旧的 C 中的 OOP）主要用于处理对话框窗口。在从 68k 切换到 PPC 处理器期间，我放弃了 PowerPlant（Metrowerks 的一个不错的 C++）。

不久之后，我开始编写 Web 应用程序，首先使用 PHP，最近使用 Django。在这方面，我的可重用代码仅限于一些技巧和代码风格。

但是对于所有非网络（或只有小型网络组件），我一直在使用 Lua。编写和重写代码的速度如此之快，以至于几乎没有重用代码的动力。我的意思是，复制一个 10 行函数然后对其进行调整有什么意义？只为这个项目重写它会更快。

这并不像听起来那么浪费。Lua 代码非常简洁，以至于我的应用程序可能非常复杂，但很少有超过几千行的代码。

同时，一些 Lua 项目暗示了与 C 库的接口。编写与现有库的绑定非常容易，所以我只是将其作为子项目进行。这些模块是我重用的！一次又一次......从一个项目到另一个项目的变化很少（如果有的话）。

简而言之：非 web 项目通常是一次性的 Lua 代码，以及一些重用的绑定模块。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-08T18:35:20.853

我用 Java 编写了一个快速简单的库，我可以在其中添加代码片段。我计划在某个时候将它扩展到一个完整的开发框架，但前提是时间允许。我有各种各样的东西，从简单的功能到完整的页面和功能。它在开发时非常有用，因为作为网页设计师，我需要做的就是更改页面的 CSS。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-10T17:04:04.407

当我从一个工作转移到另一个工作时，我随身携带了几个实用的 MATLAB 函数，特别是那些在我制作的绘图上强制执行 W3C 标准的函数，以确保文本和背景颜色具有良好的[亮度比](http://www.w3.org/TR/2005/WD-WCAG20-20051123/appendixA.html)。我还有一个使用 ActiveX 将 MATLAB 图形插入 PowerPoint 的函数。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-10T17:10:40.913

我将我的个人代码库保存在[CPAN](http://search.cpan.org)上。我什至不知道如何用其他语言做到这一点。它与我现在考虑编程的方式太集成了。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-10T17:18:14.737

对于我的 PHP 工作，我从一个包含简单内容的小文件开始：一个检查输入是否存在标头攻击的邮件函数，以及电子邮件验证器（输入 srubber），这类东西。随着时间的推移，它已经发展成为一个应用程序框架，用于快速开发可以由我们的图形设计师模板化的一次性应用程序。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-10T17:38:53.120

我有一个使用非常广泛的库。我从 c# 开始，有点把所有遗留的东西都扔到了窗外。我发现它们非常方便，我经常重写/重构它们（其中一些）。我拥有的一些东西是：

*   辅助（诸如 IsRunningLocal、InternetDetection 之类的东西）
*   标准类或结构：地址、信用卡、人员
*   我有 .dll 用于 win 和 web 的东西，一些非常合乎逻辑的 .dll 用于购物车的东西

# f# - 你如何设计一个功能程序？

> ID：192090
> 
> 赞同：54
> 
> 时间：2008-10-10T16:15:32.507
> 
> 标签：f#, functional-programming

从我编程生涯的第一天开始，我就开始使用面向对象编程。但是，我对学习其他范式很感兴趣（我在这里多次说过是件好事，但我没有时间去做）。我想我不仅准备好了，而且有时间，所以我将开始使用 F# 进行函数式编程。

但是，我不确定如何构建更少的设计应用程序。我习惯于 OO 编程中的每个文件一个类和类名词/功能动词的想法。您如何设计和构建功能性应用程序？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-10T16:21:02.327

阅读[SICP](http://mitpress.mit.edu/sicp/)。

此外，还有一个[PDF 版本](http://deptinfo.unice.fr/~roy/sicp.pdf)可用。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-10T19:27:37.970

您可能想查看我最近的一篇博客文章：[函数式编程如何影响您的代码结构？](http://lorgonblog.spaces.live.com/blog/cns!701679AD17B6D310!511.entry)

在较高层次上，OO 设计方法对于构建 F# 程序仍然非常有用，但是当您深入到较低层次时，您会发现这种方法被打破（规则的更多例外）。在物理级别上，“每个文件一个类”并非在所有情况下都有效，因为需要在同一个文件中定义相互递归的类型（**type** Class1 = ...**和**Class2 = ...)，并且您的一些代码可能驻留在未绑定到特定类的“免费”函数中（这是 F#“模块”的优点）。F# 中的文件排序约束也将迫使您批判性地思考程序中类型之间的依赖关系；这是一把双刃剑，因为解开高级依赖关系可能需要更多的工作/思考，但会产生以始终使它们易于接近的方式组织的程序（因为最原始的实体总是排在第一位，你可以始终从“从上到下”阅读程序并逐一介绍新事物，而不是仅仅开始寻找一个充满代码文件的目录而不知道“从哪里开始”）。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-11T07:48:40.347

[How to Design Programs](http://www.htdp.org/)就是这样（冗长乏味，使用 Scheme 而不是 F#，但原则仍然适用）。简而言之，您的代码反映了您的数据类型；这个想法可以追溯到老式的“结构化编程”，只有函数式编程更明确，并且具有更高级的数据类型。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-10T16:20:53.980

鉴于现代函数式语言（即不是 lisps）默认使用早期绑定的多态函数（有效地），并且面向对象只是安排具有多态函数的一种特殊方式，如果你知道如何设计适当封装的类。

Lisp 使用后期绑定来实现类似的效果。老实说，除了没有明确声明类型的结构外，没有太大区别。

如果您已经使用 C++ 模板函数进行了广泛的编程，那么您可能已经有了一个想法。

在任何情况下，答案都是小“类”，而不是修改内部状态，您必须返回具有不同状态的新版本。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-19T02:25:35.560

F# 为大规模结构化编程（例如接口）提供了传统的 OO 方法，并没有尝试提供在 OCaml 之类的语言中开创的实验方法（例如函子）。

因此，F# 程序的大规模结构化本质上与 C# 程序相同。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-10T16:33:58.307

函数式编程肯定是一种不同的范式。也许最简单的理解它的方法是坚持使用流程图来布置设计。每个函数都是不同的，没有继承，没有多态，不同。数据在函数之间传递，以进行删除、更新、插入和创建新数据。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-09-15T17:44:26.893

关于构建功能程序：

OO 语言用类来构造代码，而函数式语言用模块来构造代码。对象包含状态和方法，模块包含数据类型和函数。在这两种情况下，结构单元将数据类型与相关行为组合在一起。两种范式都有用于构建和实施抽象障碍的工具。

我强烈建议您选择一种您熟悉的函数式编程语言（F#、OCaml、Haskell 或 Scheme），并仔细研究其标准库的结构。

例如，将 OCaml [Stack](http://caml.inria.fr/pub/docs/manual-ocaml/libref/Stack.html)模块与.NET 中的[System.Collections.Generic.Stack](http://msdn.microsoft.com/en-us/library/3278tedw.aspx)或 Java 中的类似集合进行比较。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2016-07-04T11:14:20.627

这完全是关于纯函数以及如何组合它们以构建更大的抽象。这实际上是一个难题，需要[强大的数学背景](http://www.haskellforall.com/2012/08/the-category-design-pattern.html)。幸运的是，有几种模式可以进行深入的正式和实践研究。关于[函数式和反应式域建模](https://www.manning.com/books/functional-and-reactive-domain-modeling)Debasish Ghosh 进一步探讨了这个主题，并将几个应用纯函数式模式的实际场景放在一起：

> 函数式和反应式域建模教你如何从纯函数的角度来思考域模型，以及如何组合它们以构建更大的抽象。您将从函数式编程的基础知识开始，逐步学习实现复杂领域模型所需了解的高级概念和模式。这本书展示了高级 FP 模式（如代数数据类型、基于类型类的设计和副作用的隔离）如何使您的模型组合起来具有可读性和可验证性。

# php - 在 PHP 中，使用 CLI 时确保当前工作目录与脚本相同的最佳方法

> ID：192092
> 
> 赞同：15
> 
> 时间：2008-10-10T16:15:48.403
> 
> 标签：php

通过 cli 调用 php 时，当前目录不会更改为脚本之一。我在 crontab 中运行的所有脚本都通过 CLI 运行，所以这是一个问题。

我目前正在通过使用脚本所在的绝对路径执行 chdir() 来*解决*问题，但我真的不喜欢将路径硬编码到类似的东西中。

我正在寻找最便携/可靠的方法来确保当前工作目录是它所在的脚本所在的目录。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-10-10T16:27:33.623

```
chdir(dirname(__FILE__)); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-10T16:20:18.740

您可以使用`__FILE__`获取执行文件本身的完整绝对路径：

```
<?php
echo "I'm here: ".__FILE__."\n";
?> 
```

有关更多信息，请参阅[文档](http://fi.php.net/language.constants.predefined)。

# .net - 有没有办法从 .NET 3.5 中提取 .NET 2.0？

> ID：192100
> 
> 赞同：6
> 
> 时间：2008-10-10T16:16:54.127
> 
> 标签：.net, deployment, .net-2.0, .net-3.5

.NET Framework 3.5 SP1 在后台安装 .NET Framework 2.0 SP2 和 .NET Framework 3.0 SP2。这些安装包（尤其是 .NET Framework 2.0 SP2）不能直接从 Microsoft 获得。

有没有办法从 .NET Framework 3.5 SP1 安装包中提取它们？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-13T10:52:20.507

查看[http://msdn.microsoft.com/en-us/vs2008/bb898654.aspx](http://msdn.microsoft.com/en-us/vs2008/bb898654.aspx)或下载[.NET Frameworks 2.0 SP2 和 3.0 SP2 引导程序包](http://go.microsoft.com/fwlink/?LinkID=127832)。这些包为您提供单独的 .NET Framework 2.0 SP2 和 .NET Framework 3.0 SP2 安装包。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-10T17:12:37.027

这值得一读：

[http://msdn.microsoft.com/en-us/library/bb822049.aspx](http://msdn.microsoft.com/en-us/library/bb822049.aspx)

具体来说：

*“Windows Vista 不支持 .NET Framework 2.0 SP2 版或 3.0 SP2 版的独立安装。Windows 2000 不支持 .NET Framework 3.5 SP 1 版，也不支持 .NET Framework 3.0 SP 2 版的独立安装。 "*

此外 - *“如果您的应用程序依赖于 .NET Framework 2.0 SP 1 或 SP 2 附带的更改，那么您可以让您的应用程序以 .NET Framework 2.0 为目标并要求您的客户下载 .NET Framework 2.0 SP 1 或 SP 2 . 但是，如果您的应用程序依赖于新的或更改的功能，建议您的应用程序以 .NET Framework 3.5 或 .NET Framework Client Profile 为目标。”*

这确实表明将来某个时候可能会有一个独立的版本，尽管你的猜测和我的一样好。

也可以在 Somasegar 的博客上看到这个关于 2.0 SP2 的背景的评论：

[http://blogs.msdn.com/somasegar/archive/2008/05/12/visual-studio-2008-and-net-fx-3-5-sp1-beta-available-now.aspx#8515404](http://blogs.msdn.com/somasegar/archive/2008/05/12/visual-studio-2008-and-net-fx-3-5-sp1-beta-available-now.aspx#8515404)

您可以解压缩 dotnetfx35.exe 并尝试在一次性/测试机器上安装 .NET 2.0 SP2 位以查看它是否有效。这些文件位于 wcu/dotNetFramework/dotNetfx20 下。

但我的警告是等到官方 RTM 或部署整个 3.5SP1，正如 Scott 正确指出的那样，你可能会得到一个不稳定且完全不支持的安装（特别是 MS PSS）。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-10T16:28:11.920

如果它们不能直接使用，那么就没有正式的方法来单独安装它们，即使您能够提取它们，您最终也会得到一个非常不受支持（并且可能不稳定）的 .NET 环境。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-12T11:06:06.170

您可以通过访问[Microsoft 下载站点完全单独下载 SP 2](http://www.microsoft.com/downloads/details.aspx?familyid=5b2c0358-915b-4eb5-9b1d-10e506da9d0f&displaylang=en)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-10T17:00:40.373

您可以简单地下载[.NET Framework 2.0 SP1](http://www.microsoft.com/downloads/details.aspx?familyid=79BC3B77-E02C-4AD3-AACF-A7633F706BA5) (x86)、SP2 补丁（如果可以的话直接下载、从 3.5 SP1 安装程序中提取的 .MSP，或通过 WSUS 的 .MSP，或通过捕获 Windows Update HTTP流量），并创建一个批处理文件，使用 /silent 开关在其上安装 SP1 然后 SP2。在完整的 SP1 发行版和 SP2 补丁之间不需要重新启动，除非在安装 SP1 运行时之前正在使用文件，无论如何都是完整的发行版。

[这](http://icelava.net/forums/thread/1042.aspx)是我也用来为 NFX1.1 集成 SP1 的过程 - 我想它也应该以类似的方式用于其他补丁。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-06-30T05:00:05.647

Microsoft's all-inclusive get-the-framework site: [http://msdn.microsoft.com/en-us/netframework/aa731542.aspx](http://msdn.microsoft.com/en-us/netframework/aa731542.aspx)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-25T08:54:17.947

这里：http: [//msdn.microsoft.com/en-us/vs2008/bb898654.aspx](http://msdn.microsoft.com/en-us/vs2008/bb898654.aspx)

下载安装程序（下载大小：325 MB）

用/x开关解压，里面有个cab文件叫**adtbs_sp2oob.cab**，里面有个叫的文件`FL_FL_NetFx20SP2_x86.exe.3643236F_FC70_11D3_A536_0090278A1BB8`，你可以重命名为`NetFx20SP2_x86.exe`，如果你需要64位，大概是`FL_NetFx20SP2_x64.3643236F_FC70_11D3_A536_0090278A1BB8`。它应该是完全独立的，到目前为止对我来说还可以。

# python - 是否有一个内置函数可以打印对象的所有当前属性和值？

> ID：192109
> 
> 赞同：1258
> 
> 时间：2008-10-10T16:19:27.850
> 
> 标签：python, debugging, introspection, pretty-print, python-datamodel

所以我在这里寻找的是 PHP 的[print_r](http://us2.php.net/print_r)函数。

这样我就可以通过查看相关对象的状态来调试我的脚本。

* * *

## 回答 #1

> 赞同：1176
> 
> 时间：2008-10-11T01:16:32.493

你想`vars()`混合`pprint()`：

```
from pprint import pprint
pprint(vars(your_object)) 
```

* * *

## 回答 #2

> 赞同：741
> 
> 时间：2008-10-10T17:27:06.077

你真的把两种不同的东西混合在一起了。

使用[`dir()`](https://docs.python.org/3/library/functions.html#dir),[`vars()`](https://docs.python.org/3/library/functions.html#vars)或[`inspect`](https://docs.python.org/3/library/inspect.html)模块来获取您感兴趣的内容（我`__builtins__`以此为例；您可以使用任何对象代替）。

```
>>> l = dir(__builtins__)
>>> d = __builtins__.__dict__ 
```

打印你喜欢的字典：

```
>>> print l
['ArithmeticError', 'AssertionError', 'AttributeError',... 
```

或者

```
>>> from pprint import pprint
>>> pprint(l)
['ArithmeticError',
 'AssertionError',
 'AttributeError',
 'BaseException',
 'DeprecationWarning',
...

>>> pprint(d, indent=2)
{ 'ArithmeticError': <type 'exceptions.ArithmeticError'>,
  'AssertionError': <type 'exceptions.AssertionError'>,
  'AttributeError': <type 'exceptions.AttributeError'>,
...
  '_': [ 'ArithmeticError',
         'AssertionError',
         'AttributeError',
         'BaseException',
         'DeprecationWarning',
... 
```

交互式调试器中也可以使用命令进行漂亮的打印：

```
(Pdb) pp vars()
{'__builtins__': {'ArithmeticError': <type 'exceptions.ArithmeticError'>,
                  'AssertionError': <type 'exceptions.AssertionError'>,
                  'AttributeError': <type 'exceptions.AttributeError'>,
                  'BaseException': <type 'exceptions.BaseException'>,
                  'BufferError': <type 'exceptions.BufferError'>,
                  ...
                  'zip': <built-in function zip>},
 '__file__': 'pass.py',
 '__name__': '__main__'} 
```

* * *

## 回答 #3

> 赞同：271
> 
> 时间：2008-10-10T16:36:28.457

```
def dump(obj):
  for attr in dir(obj):
    print("obj.%s = %r" % (attr, getattr(obj, attr))) 
```

有许多第三方功能可以根据作者的喜好添加异常处理、国家/特殊字符打印、递归到嵌套对象等内容。但他们基本上都归结为这一点。

* * *

## 回答 #4

> 赞同：83
> 
> 时间：2008-10-10T16:44:50.170

`dir`已经提到过，但这只会给你属性的名称。如果您也想要它们的值，请尝试`__dict__`.

```
class O:
   def __init__ (self):
      self.value = 3

o = O() 
```

这是输出：

```
>>> o.__dict__

{'value': 3} 
```

* * *

## 回答 #5

> 赞同：49
> 
> 时间：2019-12-01T18:26:56.773

> ## 是否有一个内置函数可以打印对象的所有当前属性和值？

否。最受好评的答案不包括某些类型的属性，并且接受的答案显示了如何获取*所有*属性，包括非公共 api 的方法和部分。但是没有一个好的完整的*内置*函数。

所以简短的推论是你可以编写自己的，但它会计算属性和其他计算的数据描述符，它们是公共 API 的一部分，你可能不希望这样：

```
from pprint import pprint
from inspect import getmembers
from types import FunctionType

def attributes(obj):
    disallowed_names = {
      name for name, value in getmembers(type(obj)) 
        if isinstance(value, FunctionType)}
    return {
      name: getattr(obj, name) for name in dir(obj) 
        if name[0] != '_' and name not in disallowed_names and hasattr(obj, name)}

def print_attributes(obj):
    pprint(attributes(obj)) 
```

## 其他答案的问题

观察当前投票最多的答案在具有许多不同类型数据成员的类上的应用：

```
from pprint import pprint

class Obj:
    __slots__ = 'foo', 'bar', '__dict__'
    def __init__(self, baz):
        self.foo = ''
        self.bar = 0
        self.baz = baz
    @property
    def quux(self):
        return self.foo * self.bar

obj = Obj('baz')
pprint(vars(obj)) 
```

只打印：

```
{'baz': 'baz'} 
```

因为`vars` *只*返回`__dict__`对象的，而不是副本，所以如果你修改vars返回的dict，你也在修改`__dict__`对象本身。

```
vars(obj)['quux'] = 'WHAT?!'
vars(obj) 
```

返回：

```
{'baz': 'baz', 'quux': 'WHAT?!'} 
```

-- 这很糟糕，因为 quux 是一个我们不应该设置的属性，也不应该在命名空间中......

在当前接受的答案（和其他答案）中应用建议也好不到哪里去：

```
>>> dir(obj)
['__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', 'bar', 'baz', 'foo', 'quux'] 
```

如我们所见，`dir`只返回与对象关联的*所有（实际上只是大多数）名称。*

`inspect.getmembers`，在评论中提到，同样有缺陷 - 它返回所有名称*和*值。

### 从班级

在教学时，我让我的学生创建一个提供对象的语义公共 API 的函数：

```
def api(obj):
    return [name for name in dir(obj) if name[0] != '_'] 
```

我们可以扩展它以提供对象的语义命名空间的*副本*，但我们需要排除`__slots__`那些未分配的，如果我们认真对待“当前属性”的请求，我们需要排除计算的属性（如它们可能会变得昂贵，并且可能被解释为不是“当前的”）：

```
from types import FunctionType
from inspect import getmembers

def attrs(obj):
    disallowed_properties = {
        name for name, value in getmembers(type(obj)) 
        if isinstance(value, (property, FunctionType))
    }
    return {
        name: getattr(obj, name) for name in api(obj) 
        if name not in disallowed_properties and hasattr(obj, name)
    } 
```

现在我们不计算或显示属性 quux：

```
>>> attrs(obj)
{'bar': 0, 'baz': 'baz', 'foo': ''} 
```

### 注意事项

但也许我们确实知道我们的房产并不昂贵。我们可能想要更改逻辑以包含它们。也许我们想排除*其他* **自定义**数据描述符。

然后我们需要进一步定制这个功能。因此，我们不能拥有一个神奇地知道我们想要什么并提供它的内置函数是有道理的。这是我们需要自己创建的功能。

## 结论

没有内置函数可以做到这一点，您应该做在语义上最适合您的情况的事情。

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2008-10-10T16:20:40.547

您可以使用“dir()”函数来执行此操作。

```
>>> import sys
>>> dir(sys)
['__displayhook__', '__doc__', '__excepthook__', '__name__', '__stderr__', '__stdin__', '__stdo
t__', '_current_frames', '_getframe', 'api_version', 'argv', 'builtin_module_names', 'byteorder
, 'call_tracing', 'callstats', 'copyright', 'displayhook', 'dllhandle', 'exc_clear', 'exc_info'
 'exc_type', 'excepthook', 'exec_prefix', 'executable', 'exit', 'getcheckinterval', 'getdefault
ncoding', 'getfilesystemencoding', 'getrecursionlimit', 'getrefcount', 'getwindowsversion', 'he
version', 'maxint', 'maxunicode', 'meta_path', 'modules', 'path', 'path_hooks', 'path_importer_
ache', 'platform', 'prefix', 'ps1', 'ps2', 'setcheckinterval', 'setprofile', 'setrecursionlimit
, 'settrace', 'stderr', 'stdin', 'stdout', 'subversion', 'version', 'version_info', 'warnoption
', 'winver']
>>> 
```

另一个有用的功能是帮助。

```
>>> help(sys)
Help on built-in module sys:

NAME
    sys

FILE
    (built-in)

MODULE DOCS
    http://www.python.org/doc/current/lib/module-sys.html

DESCRIPTION
    This module provides access to some objects used or maintained by the
    interpreter and to functions that interact strongly with the interpreter.

    Dynamic objects:

    argv -- command line arguments; argv[0] is the script pathname if known 
```

* * *

## 回答 #7

> 赞同：23
> 
> 时间：2008-10-11T07:29:09.653

要打印对象的当前状态，您可以：

```
>>> obj # in an interpreter 
```

或者

```
print repr(obj) # in a script 
```

或者

```
print obj 
```

为您的类定义`__str__`或`__repr__`方法。从[Python 文档](http://www.python.org/doc/2.5.2/ref/customization.html)：

> `__repr__(self)`由`repr()`内置函数和字符串转换（反引号）调用，以计算对象的“官方”字符串表示。如果可能的话，这应该看起来像一个有效的 Python 表达式，可用于重新创建具有相同值的对象（给定适当的环境）。如果这不可能，则应返回“<...一些有用的描述...>”形式的字符串。返回值必须是字符串对象。如果一个类定义了**repr** () 但未定义`__str__()`，则`__repr__()`当需要该类实例的“非正式”字符串表示时也使用 then。这通常用于调试，因此表示信息丰富且明确是很重要的。
> 
> `__str__(self)`由`str()`内置函数和 print 语句调用以计算对象的“非正式”字符串表示。这与`__repr__()`它不必是有效的 Python 表达式不同：可以使用更方便或更简洁的表示。返回值必须是字符串对象。

* * *

## 回答 #8

> 赞同：18
> 
> 时间：2012-11-15T04:11:48.243

可能值得一试——

[是否有与 Perl 的 Data::Dumper 等效的 Python？](https://stackoverflow.com/questions/2540567/is-there-a-python-equivalent-to-perls-datadumper)

我的建议是——

[https://gist.github.com/1071857](https://gist.github.com/1071857)

请注意，perl 有一个名为 Data::Dumper 的模块，它将对象数据转换回 perl 源代码（注意：它不会将代码转换回源代码，并且几乎总是您不希望输出中的对象方法函数）。这可以用于持久性，但共同的目的是用于调试。

标准 python pprint 无法实现许多事情，特别是当它看到一个对象的实例并为您提供对象的内部十六进制指针时它只是停止下降（错误，该指针并没有被大量使用）道路）。所以简而言之，python 就是关于这个伟大的面向对象的范例，但是你开箱即用的工具是为处理对象以外的东西而设计的。

perl Data::Dumper 允许您控制想要走多深，还可以检测循环链接结构（这非常重要）。这个过程在 perl 中更容易实现，因为对象除了它们的祝福之外没有特殊的魔力（一个普遍定义良好的过程）。

* * *

## 回答 #9

> 赞同：17
> 
> 时间：2018-12-07T10:49:44.137

我建议使用`help(your_object)`.

`help(dir)`

> ```
>  If called without an argument, return the names in the current scope.
>  Else, return an alphabetized list of names comprising (some of) the attributes
>  of the given object, and of attributes reachable from it.
>  If the object supplies a method named __dir__, it will be used; otherwise
>  the default dir() logic is used and returns:
>  for a module object: the module's attributes.
>  for a class object:  its attributes, and recursively the attributes
>  of its bases.
>  for any other object: its attributes, its class's attributes, and
>  recursively the attributes of its class's base classes. 
> ```

`help(vars)`

> ```
> Without arguments, equivalent to locals().
> With an argument, equivalent to object.__dict__. 
> ```

* * *

## 回答 #10

> 赞同：13
> 
> 时间：2008-10-15T14:53:54.790

在大多数情况下，使用`__dict__`or`dir()`会得到你想要的信息。如果您碰巧需要更多详细信息，标准库包含[检查](https://docs.python.org/2/library/inspect.html)模块，它可以让您获得一些令人印象深刻的细节。一些真正的信息包括：

*   函数和方法参数的名称
*   类层次结构
*   实现函数/类对象的源代码
*   框架对象外的局部变量

如果您只是在寻找“我的对象具有哪些属性值？”，那么`dir()`并且`__dict__`可能就足够了。如果您真的想深入研究任意对象的当前状态（请记住，在 python 中几乎所有东西都是对象），那么`inspect`值得考虑。

* * *

## 回答 #11

> 赞同：11
> 
> 时间：2014-11-23T21:20:22.207

如果您使用它进行调试，并且您只想递归转储所有内容，那么接受的答案并不令人满意，因为它要求您的类已经具有良好的`__str__`实现。如果不是这种情况，这会更好：

```
import json
print(json.dumps(YOUR_OBJECT, 
                 default=lambda obj: vars(obj),
                 indent=1)) 
```

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2016-07-28T07:14:28.417

试试[漂亮](https://github.com/symonsoft/ppretty)

```
from ppretty import ppretty

class A(object):
    s = 5

    def __init__(self):
        self._p = 8

    @property
    def foo(self):
        return range(10)

print ppretty(A(), show_protected=True, show_static=True, show_properties=True) 
```

输出：

```
__main__.A(_p = 8, foo = [0, 1, ..., 8, 9], s = 5) 
```

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2008-10-11T07:53:33.863

一个带有魔法的元编程示例[Dump 对象](http://www.ibm.com/developerworks/linux/library/l-pymeta.html)：

```
$猫转储.py

```

```
#!/usr/bin/python
import sys
if len(sys.argv) > 2:
    module, metaklass  = sys.argv[1:3]
    m = __import__(module, globals(), locals(), [metaklass])
    __metaclass__ = getattr(m, metaklass)

class Data:
    def __init__(self):
        self.num = 38
        self.lst = ['a','b','c']
        self.str = 'spam'
    dumps   = lambda self: repr(self)
    __str__ = lambda self: self.dumps()

data = Data()
print data 
```

没有参数：

```
$蟒蛇转储.py

```

```
<__main__.Data instance at 0x00A052D8> 
```

使用[Gnosis 实用程序](http://www.gnosis.cx/download/Gnosis_Utils.More/)：

```
$ python dump.py gnosis.magic MetaXMLPickler

```

```
<?xml version="1.0"?>
<!DOCTYPE PyObject SYSTEM "PyObjects.dtd">
<PyObject module="__main__" class="Data" id="11038416">
<attr name="lst" type="list" id="11196136" >
  <item type="string" value="a" />
  <item type="string" value="b" />
  <item type="string" value="c" />
</attr>
<attr name="num" type="numeric" value="38" />
<attr name="str" type="string" value="spam" />
</PyObject> 
```

它有点过时但仍在工作。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2014-07-14T15:01:07.297

```
from pprint import pprint

def print_r(the_object):
    print ("CLASS: ", the_object.__class__.__name__, " (BASE CLASS: ", the_object.__class__.__bases__,")")
    pprint(vars(the_object)) 
```

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2016-03-04T19:32:37.153

这会以 json 或 yaml 缩进格式递归地打印出所有对象内容：

```
import jsonpickle # pip install jsonpickle
import json
import yaml # pip install pyyaml

serialized = jsonpickle.encode(obj, max_depth=2) # max_depth is optional
print json.dumps(json.loads(serialized), indent=4)
print yaml.dump(yaml.load(serialized), indent=4) 
```

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2017-09-28T04:35:31.753

我赞成只提到 pprint 的答案。需要明确的是，如果您想查看复杂数据结构中的所有*值，请执行以下操作：*

```
from pprint import pprint
pprint(my_var) 
```

其中*my_var*是您感兴趣的变量。当我使用时`pprint(vars(my_var))`，我什么也没得到，这里的其他答案没有帮助，或者该方法看起来不必要地长。顺便说一句，在我的特殊情况下，我正在检查的代码有一本字典。

值得指出的是，对于一些自定义类，您最终可能会得到一种无用`<someobject.ExampleClass object at 0x7f739267f400>`的输出。在这种情况下，您可能必须实现一种`__str__`方法，或尝试其他一些解决方案。

我还发现，在我得到这种`object`类型的输出的一个实例中，`vars()`向我展示了我想要的东西。因此，涵盖这两种情况的更好解决方案是分别尝试两种情况。但是 using`vars()`有时会抛出异常，例如`TypeError: vars() argument must have __dict__ attribute`.

我仍然想找到适用于所有场景的简单工具，无需第三方库。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2013-06-14T09:20:39.960

为什么不简单：

```
for key,value in obj.__dict__.iteritems():
    print key,value 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2013-06-28T19:36:55.397

我需要在一些日志中打印调试信息并且无法使用 pprint 因为它会破坏它。相反，我这样做并得到了几乎相同的东西。

```
DO = DemoObject()

itemDir = DO.__dict__

for i in itemDir:
    print '{0}  :  {1}'.format(i, itemDir[i]) 
```

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2014-06-26T16:12:23.437

转储“myObject”：

```
from bson import json_util
import json

print(json.dumps(myObject, default=json_util.default, sort_keys=True, indent=4, separators=(',', ': '))) 
```

我试过 vars() 和 dir(); 两者都失败了我正在寻找的东西。vars() 不起作用，因为该对象没有 __dict__ （exceptions.TypeError: vars() 参数必须具有 __dict__ 属性）。dir() 不是我想要的：它只是字段名称的列表，没有给出值或对象结构。

我认为 json.dumps() 适用于大多数没有 default=json_util.default 的对象，但我在对象中有一个 datetime 字段，因此标准 json 序列化程序失败。请参阅[如何在 python 中克服“datetime.datetime not JSON serializable”？](https://stackoverflow.com/questions/11875770/how-to-overcome-datetime-datetime-not-json-serializable-in-python)

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2020-02-03T04:43:56.737

无论您的变量如何在类内、__init__ 内或外部定义，这都有效。

```
your_obj = YourObj()
attrs_with_value = {attr: getattr(your_obj, attr) for attr in dir(your_obj)} 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2010-09-13T05:11:22.607

[pprint](http://www.doughellmann.com/PyMOTW/pprint/#module-pprint)包含一个“漂亮的打印机”，用于生成美观的数据结构表示。格式化程序生成的数据结构表示可以被解释器正确解析，并且也易于人类阅读。如果可能，输出将保留在单行上，并在拆分为多行时缩进。

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2016-09-16T16:12:56.443

试试[beeprint](https://github.com/panyanyany/beeprint)。

它不仅可以帮助您打印对象变量，还可以帮助您输出美观，如下所示：

```
class(NormalClassNewStyle):
  dicts: {
  },
  lists: [],
  static_props: 1,
  tupl: (1, 2) 
```

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2017-09-07T11:40:59.290

对于每个挣扎的人

*   `vars()`不返回所有属性。
*   `dir()`不返回属性的值。

以下代码打印的**所有**属性`obj`及其值：

```
for attr in dir(obj):
        try:
            print("obj.{} = {}".format(attr, getattr(obj, attr)))
        except AttributeError:
            print("obj.{} = ?".format(attr)) 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2016-03-07T16:41:44.443

你可以试试 Flask 调试工具栏。
[https://pypi.python.org/pypi/Flask-DebugToolbar](https://pypi.python.org/pypi/Flask-DebugToolbar)

```
from flask import Flask
from flask_debugtoolbar import DebugToolbarExtension

app = Flask(__name__)

# the toolbar is only enabled in debug mode:
app.debug = True

# set a 'SECRET_KEY' to enable the Flask session cookies
app.config['SECRET_KEY'] = '<replace with a secret key>'

toolbar = DebugToolbarExtension(app) 
```

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2021-10-04T08:04:22.037

虽然有很多很好的答案，但这里有一个 1-liner，可以提供属性 AS WELL AS 值：

```
(str(vars(config)).split(",")[1:]) 
```

其中'config'是有问题的对象。我将此列为单独的答案，因为我只想简单地打印对象的相关值（不包括 __main 等）而不使用循环或漂亮的打印并且没有找到方便的答案。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2021-12-18T12:18:38.820

vars() 似乎显示了该对象的属性，但 dir() 似乎也显示了父类的属性。您通常不需要查看**str**、**doc**等继承属性。**字典**等

```
In [1]: class Aaa():
...:     def __init__(self, name, age):
...:         self.name = name
...:         self.age = age
...:
In [2]: class Bbb(Aaa):
...:     def __init__(self, name, age, job):
...:         super().__init__(name, age)
...:         self.job = job
...:
In [3]: a = Aaa('Pullayya',42)

In [4]: b = Bbb('Yellayya',41,'Cop')

In [5]: vars(a)
Out[5]: {'name': 'Pullayya', 'age': 42}

In [6]: vars(b)
Out[6]: {'name': 'Yellayya', 'age': 41, 'job': 'Cop'}

In [7]: dir(a)
Out[7]:
['__class__',
 '__delattr__',
 '__dict__',
 '__dir__',
 '__doc__',
 '__eq__',
 ...
 ...
 '__subclasshook__',
 '__weakref__',
 'age',
 'name'] 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2017-05-04T12:53:28.807

我喜欢使用 python 对象内置类型[keys](https://docs.python.org/2/library/stdtypes.html?highlight=keys#dict.keys)或[values](https://docs.python.org/2/library/stdtypes.html?highlight=keys#dict.values)。

对于属性，无论它们是方法还是变量：

```
o.keys() 
```

对于这些属性的值：

```
o.values() 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2021-08-18T05:41:26.980

从[答案](https://stackoverflow.com/a/59128615/1779027)中，可以稍微修改以仅获取对象的“属性”，如下所示：

```
def getAttributes(obj):
    from pprint import pprint
    from inspect import getmembers
    from types import FunctionType

    def attributes(obj):
        disallowed_names = {
          name for name, value in getmembers(type(obj)) 
            if isinstance(value, FunctionType)}
        return {
          name for name in dir(obj) 
            if name[0] != '_' and name not in disallowed_names and hasattr(obj, name)}
    pprint(attributes(obj)) 
```

在临时添加此功能时很有帮助，并且无需对现有源代码进行太多更改即可将其删除

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2021-09-15T02:04:52.193

该项目修改 pprint 以显示所有对象字段值，它忽略了对象`__repr__`成员函数，它还递归到嵌套对象中。它适用于 python3，请参阅[https://github.com/MoserMichael/pprintex](https://github.com/MoserMichael/pprintex) 您可以通过 pip 安装它：`pip install printex`

# php - 引用 PHP 中的静态方法？

> ID：192111
> 
> 赞同：22
> 
> 时间：2008-10-10T16:20:15.837
> 
> 标签：php, syntax

在 PHP 中，我可以毫无问题地将普通函数用作变量，但我还没有弄清楚如何使用静态方法。我只是缺少正确的语法，还是不可能？

（编辑：第一个建议的答案似乎不起作用。我扩展了我的示例以显示返回的错误。）

```
function foo1($a,$b) { return $a/$b; }

class Bar
{
    static function foo2($a,$b) { return $a/$b; }

    public function UseReferences()
    {
        // WORKS FINE:
        $fn = foo1;
        print $fn(1,1);

        // WORKS FINE:
        print self::foo2(2,1);
        print Bar::foo2(3,1);

        // DOES NOT WORK ... error: Undefined class constant 'foo2'
        //$fn = self::foo2;
        //print $fn(4,1);

        // DOES NOT WORK ... error: Call to undefined function self::foo2()
        //$fn = 'self::foo2';
        //print $fn(5,1);

        // DOES NOT WORK ... error: Call to undefined function Bar::foo2()        
        //$fn = 'Bar::foo2';
        //print $fn(5,1);

     }
}

$x = new Bar();
$x->UseReferences(); 
```

（我使用的是 PHP v5.2.6——答案是否也因版本而异？）

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-10-10T16:22:25.130

PHP 将回调处理为字符串，而不是函数指针。您的第一个测试有效的原因是 PHP 解释器将**foo1**假定为字符串。如果您启用了 E_NOTICE 级别错误，您应该会看到证明。

“使用未定义的常量 foo1 - 假定为 'foo1'”

不幸的是，您不能以这种方式调用静态方法。范围（类）是相关的，因此您需要改用 call_user_func 。

```
<?php

function foo1($a,$b) { return $a/$b; }

class Bar
{
    public static function foo2($a,$b) { return $a/$b; }

    public function UseReferences()
    {
        $fn = 'foo1';
        echo $fn(6,3);

        $fn = array( 'self', 'foo2' );
        print call_user_func( $fn, 6, 2 );
     }
}

$b = new Bar;
$b->UseReferences(); 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-10T18:32:55.930

在 php 5.2 中，您可以在静态调用中使用变量作为方法名，但要使用变量作为类名，您必须使用 BaileyP 描述的回调。

但是，从 php 5.3 开始，您**可以**在静态调用中使用变量作为类名。所以：

```
class Bar
{
    public static function foo2($a,$b) { return $a/$b; }

    public function UseReferences()
    {
        $method = 'foo2';
        print Bar::$method(6,2); // works in php 5.2.6

        $class = 'Bar';
        print $class::$method(6,2); // works in php 5.3
     }
}

$b = new Bar;
$b->UseReferences();
?> 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-06-20T06:43:55.127

您可以使用静态方法的全名，包括命名空间。

```
<?php
    function foo($method)
    {
        return $method('argument');
    }

    foo('YourClass::staticMethod');
    foo('Namespace\YourClass::staticMethod'); 
```

名称数组`array('YourClass', 'staticMethod')`等于它。但我认为该字符串可能更易于阅读。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-08-20T05:05:38.940

在 PHP 5.3.0 中，您还可以执行以下操作：

```
<?php

class Foo {
    static function Bar($a, $b) {
        if ($a == $b)
            return 0;

        return ($a < $b) ? -1 : 1;
    }
    function RBar($a, $b) {
        if ($a == $b)
            return 0;

        return ($a < $b) ? 1 : -1;
    }
}

$vals = array(3,2,6,4,1);
$cmpFunc = array('Foo', 'Bar');
usort($vals, $cmpFunc);

// This would also work:
$fooInstance = new Foo();
$cmpFunc = array('fooInstance', 'RBar');
// Or
// $cmpFunc = array('fooInstance', 'Bar');
usort($vals, $cmpFunc);

?> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-12-18T04:02:43.050

来自 javascript 背景并被它宠坏了，我只是编写了以下代码：

```
function staticFunctionReference($name)
{
    return function() use ($name)
    {
        $className = strstr($name, '::', true);
        if (class_exists(__NAMESPACE__."\\$className")) $name = __NAMESPACE__."\\$name";
        return call_user_func_array($name, func_get_args());
    };
} 
```

要使用它：

```
$foo = staticFunctionReference('Foo::bar');
$foo('some', 'parameters'); 
```

它是一个函数，它返回一个调用你想要调用的函数的函数。听起来很花哨，但正如您在实践中看到的那样，它是小菜一碟。

与命名空间一起使用，返回的函数应该像静态方法一样工作 - 参数的工作方式相同。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-11T09:25:03.553

这似乎对我有用：

```
<?php

class Foo{
    static function Calc($x,$y){
        return $x + $y;
    }

    public function Test(){
        $z = self::Calc(3,4);

        echo("z = ".$z);
    }
}

$foo = new Foo();
$foo->Test();

?> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-01-08T04:01:48.870

除了所说的之外，您还可以使用 PHP 的反射功能：

```
class Bar {

    public static function foo($foo, $bar) {
        return $foo . ' ' . $bar;
    }

    public function useReferences () {
        $method = new ReflectionMethod($this, 'foo');
        // Note NULL as the first argument for a static call
        $result = $method->invoke(NULL, '123', 'xyz');
    }

} 
```

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2008-10-10T16:51:23.607

“使用静态声明的成员或方法不能使用作为对象实例的变量访问，并且不能在扩展类中重新定义”

( [http://theserverpages.com/php/manual/en/language.oop5.static.php](http://theserverpages.com/php/manual/en/language.oop5.static.php) )

# c# - 寻找非托管的 dll API？

> ID：192117
> 
> 赞同：4
> 
> 时间：2008-10-10T16:20:41.610
> 
> 标签：c#, api, dll

我正在用 C# 编写。
如何找出可以在不属于 Windows 的非托管 dll 中使用的方法/函数？
示例：我在我的计算机上安装了一些软件，它有一个 dll，我想知道我有哪些选择来创建连接到该软件的代码？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-10T16:51:36.320

对于您没有参考的本机 DLL，您可以使用 Visual Studio SDK 中的 dumpbin 实用程序来提取 DLL 中的导出函数列表。

垃圾箱参考在这里：http: [//msdn.microsoft.com/en-us/library/c1h23y6c (VS.71).aspx](http://msdn.microsoft.com/en-us/library/c1h23y6c(VS.71).aspx)

CodeProject 页面提供了一些关于如何使用 dumpbin 以及查找正确的 P/Invoke 签名的更多详细信息：http: [//www.codeproject.com/KB/mcpp/usingcppdll.aspx#Retrieve](http://www.codeproject.com/KB/mcpp/usingcppdll.aspx#Retrieve)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-10T16:27:54.323

[PInvoke.net](http://pinvoke.net)是 .NET 互操作的绝佳资源。它们不仅列出了 Windows 本机库中可用的函数，还列出了您需要在 .NET 代码中使用的签名。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-10T19:09:33.140

使用 Depends.exe（与 VS 一起提供）。

Depends 将显示可以使用 Pinvoke 从托管代码调用的所有导出函数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-16T02:22:17.663

我读了一篇关于 PInvoke Interop Assistant 的博客，它也可以处理我们自己的 DLL [http://www.codeplex.com/clrinterop/Release/ProjectReleases.aspx?ReleaseId=14120](http://www.codeplex.com/clrinterop/Release/ProjectReleases.aspx?ReleaseId=14120)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-10-04T12:47:52.937

我想补充一点，**如果它是一个 COM 程序集**，例如 VB6 COM 组件，它可以`Object Explorer`在 Visual Studio 中浏览，这非常好，因为它可以很好地为您分解所有内容。

# c# - 如何将 DateTime.TryParse 与 Nullable 一起使用 ?

> ID：192121
> 
> 赞同：126
> 
> 时间：2008-10-10T16:21:14.027
> 
> 标签：c#, datetime, nullable

我想使用 DateTime.TryParse 方法将字符串的日期时间值转换为 Nullable。但是当我尝试这个时：

```
DateTime? d;
bool success = DateTime.TryParse("some date text", out (DateTime)d); 
```

编译器告诉我

> 'out' 参数未被归类为变量

不知道我需要在这里做什么。我也试过：

```
out (DateTime)d.Value 
```

这也不起作用。有任何想法吗？

* * *

## 回答 #1

> 赞同：175
> 
> 时间：2008-10-10T16:35:32.077

正如 Jason 所说，您可以创建一个正确类型的变量并传递它。您可能希望将其封装在您自己的方法中：

```
public static DateTime? TryParse(string text)
{
    DateTime date;
    if (DateTime.TryParse(text, out date))
    {
        return date;
    }
    else
    {
        return null;
    }
} 
```

...或者如果您喜欢条件运算符：

```
public static DateTime? TryParse(string text)
{
    DateTime date;
    return DateTime.TryParse(text, out date) ? date : (DateTime?) null;
} 
```

或者在 C# 7 中：

```
public static DateTime? TryParse(string text) =>
    DateTime.TryParse(text, out var date) ? date : (DateTime?) null; 
```

* * *

## 回答 #2

> 赞同：133
> 
> 时间：2008-10-10T16:27:38.897

```
DateTime? d=null;
DateTime d2;
bool success = DateTime.TryParse("some date text", out d2);
if (success) d=d2; 
```

（可能有更优雅的解决方案，但你为什么不简单地做上面的事情呢？）

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-10-31T21:41:14.310

这是 Jason 建议的稍微简洁的版本：

```
DateTime? d; DateTime dt;
d = DateTime.TryParse(DateTime.Now.ToString(), out dt)? dt : (DateTime?)null; 
```

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-10-10T16:46:25.223

您不能因为`Nullable<DateTime>`与`DateTime`. 您需要编写自己的函数来执行此操作，

```
public bool TryParse(string text, out Nullable<DateTime> nDate)
{
    DateTime date;
    bool isParsed = DateTime.TryParse(text, out date);
    if (isParsed)
        nDate = new Nullable<DateTime>(date);
    else
        nDate = new Nullable<DateTime>();
    return isParsed;
} 
```

希望这可以帮助 ：）

**编辑：** 删除（显然）未正确测试的扩展方法，因为（正如一些坏话所指出的那样）尝试更改“this”参数的扩展方法不适用于值类型。

PS 有问题的 Bad Hoor 是一位老朋友 :)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-06-24T22:06:36.690

创建扩展方法怎么样？

```
public static class NullableExtensions
{
    public static bool TryParse(this DateTime? dateTime, string dateString, out DateTime? result)
    {
        DateTime tempDate;
        if(! DateTime.TryParse(dateString,out tempDate))
        {
            result = null;
            return false;
        }

        result = tempDate;
        return true;

    }
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2019-10-18T18:41:19.567

这是您正在寻找的一个班轮：

```
DateTime? d = DateTime.TryParse("some date text", out DateTime dt) ? dt : null; 
```

如果你想让它成为一个合适的 TryParse 伪扩展方法，你可以这样做：

```
public static bool TryParse(string text, out DateTime? dt)
{
    if (DateTime.TryParse(text, out DateTime date))
    {
        dt = date;
        return true;
    }
    else
    {
        dt = null;
        return false;
    }
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-10-12T18:20:09.057

我不明白为什么微软没有处理这个问题。一个聪明的小实用方法来处理这个问题（我遇到了 int 的问题，但是用 DateTime 替换 int 将是相同的效果，可能是.....

```
 public static bool NullableValueTryParse(string text, out int? nInt)
    {
        int value;
        if (int.TryParse(text, out value))
        {
            nInt = value;
            return true;
        }
        else
        {
            nInt = null;
            return false;
        }
    } 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-02-18T21:12:42.627

这是一个单行解决方案：

```
DateTime? d = DateTime.TryParse("text", out DateTime parseDate) ? parseDate : (DateTime?)null; 
```

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2018-08-07T19:45:49.107

或者，如果您不关心可能引发的异常，您可以将 TryParse 更改为 Parse：

```
DateTime? d = DateTime.Parse("some valid text"); 
```

尽管也不会有布尔值指示成功，但在您知道输入文本将始终有效的某些情况下，它可能是实用的。

# c# - MOSS 2007 -- 无效的 URL 异常 SPSite.OpenWeb(...)

> ID：192122
> 
> 赞同：0
> 
> 时间：2008-10-10T16:21:31.000
> 
> 标签：c#, sharepoint, sharepoint-2007, moss, wss

这可能看起来有点微不足道，但我一直无法弄清楚。我正在打开一个 SPSite，然后尝试在该 SPSite 下打开一个 SPWeb。这在具有相同站点集合/站点层次结构的 VPC 上运行良好，但在生产中，当我尝试 SPSite.OpenWeb(webUrl); 时，我收到一个异常，告诉我 URL 无效。我已经验证了 URL 是正确的。

编码：

```
 try
        {
            SPSite scheduleSiteCol = new SPSite(branchScheduleURL);
            lblError.Text += Environment.NewLine + "Site Collection URL: " + scheduleSiteCol.Url;
            SPWeb scheduleWeb = scheduleSiteCol.OpenWeb(branchScheduleURL.Replace(scheduleSiteCol.Url, "")); //<--- Throws error on this line
            SPList scheduleList = scheduleWeb.GetList(branchScheduleURL + "/lists/" + SPContext.Current.List.Title);
            return scheduleList.GetItemById(int.Parse(testID));
        }
        catch (System.Exception ex)
        {
            lblError.Text += Environment.NewLine + ex.ToString();
            return null;
        } 
```

注意：
branchScheduleURL 实际上是包含 Web 的 URL 的整个 URL。

输出+异常：

> 网站集 URL：[https](https://ourSite.com/mocc)
> ://ourSite.com/mocc System.ArgumentException：无效的 URL：/internal/scheduletool。在 Microsoft.SharePoint.SPSite.OpenWeb(String strUrl, Boolean requireExactUrl) 在 Microsoft.SharePoint.SPSite.OpenWeb(String strUrl) 在 MOCCBranchScheduleListWeb.MOCCBranchScheduleListV3.GetConflictListItem(String branchScheduleURL, String testID)System.NullReferenceException: 对象引用未设置为对象的实例。在 MOCCBranchScheduleListWeb.MOCCBranchScheduleListV3.CheckForConflicts（字符串 [] cfcFlags1，日期时间开始时间，日期时间结束时间，字符串 [] cfcFlags2）

注意：
[https](https://ourSite.com/mocc/internal/scheduletool) : //ourSite.com/mocc/internal/scheduletool 是我要打开的 SPWeb。

我错过了一些明显的东西吗？任何帮助将不胜感激。

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-10T18:45:00.460

[查看本页](http://msdn.microsoft.com/en-us/library/ms955307.aspx)底部的示例表。

尽量不要将任何参数发送到 OpenWeb() 方法（第 2 行）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-11T11:53:01.227

首先尝试获取“内部”的 SPWeb 对象。然后获取该对象的 SubWeb SPWebCollection。由此，尝试使用 GetSubwebsForCurrentUser() 方法获取“ScheduleTool”的 SPWeb 对象。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-13T20:17:26.637

它说您的网站集 URL 是 /mocc，因此您下面的 SPWeb 将类似于 /mocc/internal/scheduletool。所以做类似的事情

`string webServerRelativeUrl = site.ServerRelativeUrl + "/internal/scheduletool"`

# c++ - 如何使用 GDI+ 和 C++ 从 SQL Server 数据库加载和保存图像？

> ID：192124
> 
> 赞同：5
> 
> 时间：2008-10-10T16:22:34.040
> 
> 标签：c++, sql, sql-server, image, gdi+

我需要专门加载保存为 blob 的 JPG 图像。GDI+ 可以很容易地从文件中检索图像，而不是从数据库中检索图像......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-10T18:32:53.183

看看[Image::Image(IStream *, BOOL)](http://msdn.microsoft.com/en-us/library/ms535410(VS.85).aspx)。这需要一个指向实现 IStream 接口的 COM 对象的指针。您可以通过使用[GlobalAlloc](http://msdn.microsoft.com/en-us/library/aa366574(VS.85).aspx)分配一些全局内存然后在返回的句柄上调用[CreateStreamOnHGlobal来获得其中之一。](http://msdn.microsoft.com/en-us/library/aa378980(VS.85).aspx)它看起来像这样：

```
shared_ptr<Image> CreateImage(BYTE *blob, size_t blobSize)
{
    HGLOBAL hMem = ::GlobalAlloc(GMEM_MOVEABLE,blobSize);
    BYTE *pImage = (BYTE*)::GlobalLock(hMem);

    for (size_t iBlob = 0; iBlob < blobSize; ++iBlob)
        pImage[iBlob] = blob[iBlob];

    ::GlobalUnlock(hMem);

    CComPtr<IStream> spStream;
    HRESULT hr = ::CreateStreamOnHGlobal(hMem,TRUE,&spStream);

    shared_ptr<Image> image = new Image(spStream);  
    return image;
} 
```

但是有错误检查等（为了让事情更清楚，这里省略了）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-10T16:26:14.763

首先将您的博客提取到一个字节数组中，然后使用如下内容：

```
public static Image CreateImage(byte[] pict)
{
   System.Drawing.Image img = null;
   using (System.IO.MemoryStream stream = new System.IO.MemoryStream(pict)) {
    img = System.Drawing.Image.FromStream(stream);
   }
   return img;
} 
```

# vb.net - LIKE 在 Linq to SQL 中

> ID：192126
> 
> 赞同：3
> 
> 时间：2008-10-10T16:22:40.170
> 
> 标签：vb.net, linq-to-sql

我有一个方法需要接受一组国家名称，并返回与其中一个国家名称匹配的记录列表。我正在尝试这个

```
Public Shared Function GetConcessions(ByVal Countries As String()) As IEnumerable
    Dim CountryList As String = Utility.JoinArray(Countries) ' turns string array into comma-separated string
    Return (From t In New Db().Concessions _
                    Where CountryList Like t.Country _
                    Select t.ConcessionID, t.Title, t.Country)
End Function 
```

但我得到这个错误

```
 *Only arguments that can be evaluated on the client are supported for the LIKE method 
```

在普通 SQL 中，这很简单：

```
 Select ConcessionID,Title from Concessions c where @CountryList like '%' + c.Country + '%' 
```

如何在 Linq to SQL 中实现此结果？

### 编辑（澄清）

我收到与 string.Contains 相同的消息。会很好的

```
t.Country.contains(CountryList) 
```

但是我需要

```
CountryList.contains(t.Country) 
```

这会引发我上面列出的相同错误。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-10T16:32:31.023

您可以使用 SqlMethods.Like

例如

```
Where SqlMethods.Like(t.country, "%Sweden%") 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-10T16:33:58.633

我认为你想要做的是从国家构建一个列表并使用

```
List<string> ListOfCountries = new List(Countries)

...ListOfCountries.Contains(t.Country) 
```

这将转化为

```
t.Country IN ('yyy','zzz',...) 
```

请原谅我的 C#-ishness..

# actionscript - 在 Actionscript 2 中，如何从 XML 对象获得 302 重定向？

> ID：192128
> 
> 赞同：0
> 
> 时间：2008-10-10T16:23:05.800
> 
> 标签：actionscript, actionscript-2, http-status-code-302

我正在开发一个 Actionscript 2 项目 - 尝试使用 XML 对象查找作为 302 重定向返回的 url。有没有办法在 actionscript 2 中做到这一点？

代码：

```
var urlone:XML = new XML();
urlone.load("http://mydomain.com/file.py");
urlone.onLoad = function (success) {
    trace("I want to print the 302 redirect url here, how do I access it?");
}; 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-10T16:32:13.550

我认为 AS2 不可能，我认为浏览器会自动重定向到新的 URL 并从该 URL 返回数据。有可能在 AS3 中，他们增加了几个新的特性，比如读取 HTTP 头等等。

也许您应该做的不是返回 302 重定向，而是将 URL 作为文本字符串返回。然后它会很容易从 Flash 中读取，只需使用 .onData 而不是 .onLoad 这样它就不会尝试解析 XML。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-10T16:32:53.503

我认为这是不可能的（至少使用 XML 类）。它有一个[onHTTPStatus](http://livedocs.adobe.com/flash/8/main/wwhelp/wwhimpl/common/html/wwhelp.htm?context=LiveDocs_Parts&file=00002875.html)事件处理程序，但似乎即使这样，您也只能访问状态代码而不能访问其他任何内容。

# svn - 如何使用公钥/私钥对获得 SVN 结帐？

> ID：192134
> 
> 赞同：29
> 
> 时间：2008-10-10T16:24:43.613
> 
> 标签：svn, ssh, key

我必须检查一些代码并运行它。我有网址：

```
svn+ssh://myuser@www.myclient.com/home/svn/project/trunk 
```

我有一个带有他们私钥的文件。我该怎么做才能获得此代码？

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2010-12-15T22:08:08.870

如果您只需要为 svn 使用自定义密钥，以下将起作用：

`SVN_SSH="ssh -i /path/to/key_name"`

`export SVN_SSH`

`svn commands`

[http://labs.kortina.net/2010/01/30/svn-checkout-with-private-key-over-ssh/](http://labs.kortina.net/2010/01/30/svn-checkout-with-private-key-over-ssh/)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2011-03-05T14:33:06.277

将此条目添加到您的**~/.ssh/config**文件中：

```
Host YOUR_SERVER
IdentityFile YOUR_PRIVATE_KEY_PATH # (ex: ~/.ssh/rsa)
User USER_NAME 
```

有关更多选项，[请参阅 ssh_config 手册页](http://linux.die.net/man/5/ssh_config)。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2012-08-31T23:37:52.343

只需使用 ssh-add 命令（它会询问您的密码，这是您创建此公钥私钥对时使用的密码）。

```
ssh-add PATH_TO_YOUR_PRIVATE_JEY
e.g. ssh-add ~/.ssh/myPrivateKey.key 
```

通过执行此操作验证您是否正确添加了密钥

```
ssh-add -l 
```

这将列出它正在使用的所有身份文件。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-10T16:47:43.287

私钥在客户端机器上，通常命名为`~/.ssh/id_rsa`、`~/.ssh/id_dsa`或`~/.ssh/identity`取决于 SSH 版本和密钥类型。但是，您可以只使用`ssh -i path/to/private.key`.

这是假设服务器上存在相应的公钥`~/.ssh/authorized_keys`，并且您的本地计算机正在运行 OpenSSH 客户端。如果您在 Windows 上使用 PuTTY，只需打开 Pageant 程序，然后通过 GUI 导入密钥。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-08-16T20:48:03.040

以下是我用来通过 svn+ssh 从 Mac OS X 命令行连接到我的服务器的步骤：

在服务器上：

```
ssh-keygen -b 1024 -t dsa -f mykey   (creates mykey and mkey.pub files) 
```

**将mykey.pub**的内容复制到 ~/.ssh/authorized_keys （如果不存在，则创建 authorized_keys 文件）

**将 mkey**下载到本地计算机并运行：

```
chmod 600 mkey  (the next step won't run otherwise)
svn-add mkey  (enter your passphrase) 
```

使用 ssh 从您的 svn 服务器结帐：

```
svn co svn+ssh://user@server.com/repos/path 
```

从您的服务器中删除 mkey 和 mkey.pub

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-01-16T10:34:02.923

除了答案之外，还有来自带有颠覆性的 Eclipse 3.7 的两个屏幕截图。

* * *

![通用设置](https://i.stack.imgur.com/zrqXC.png)
**输入用户名！**（我在截屏之前忘记了这一点）。不要**输入**密码。

* * *

![SSH 设置](https://i.stack.imgur.com/LuJZx.png) 如果您的私钥受密码保护，请输入密钥密码。

* * *

*一张图片胜过千言万语。*

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-10T16:37:09.423

将私钥添加到您的`~/.ssh/`文件夹，然后运行`ssh-agent $SHELL; ssh-add;`​​，然后该`svn co`URL 的 应该可以工作。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-04-26T05:18:08.463

```
SVN_SSH="ssh -i /xxx/xxx/id_rsa" svn checkout svn+ssh://username@svn.xxx.com/data 
```

# terminology - 这个数据结构的名称或使用序列成员之间的相对差异的技术是什么

> ID：192138
> 
> 赞同：0
> 
> 时间：2008-10-10T16:25:53.517
> 
> 标签：terminology

假设我有一个值序列（例如，3、5、8、12、15），我想偶尔将它们全部减少某个值。

如果我将它们存储为序列 (0, 2, 3, 4, 3) 并将变量保留为 3 的基数，我现在只需更改基数（并检查第一项），只要我想减少它们而不是实际上遍历所有值。

我知道这有一个官方术语，但是当我从我的母语直接翻译成英语时，它并不正确。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-10T16:37:46.893

[差分编码](http://wiki.multimedia.cx/index.php?title=Differential_Coding)/[增量编码](http://en.wikipedia.org/wiki/Delta_encoding)？

我不知道数据结构的名称，但它基本上只是 base+offset :-)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-10T16:28:01.330

抵消？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-10T16:36:45.553

如果我理解你的问题是正确的，那么你正在变基。这通常用于参考从加载地址[修补](http://en.wikipedia.org/wiki/Rebasing)DLL 中的地址。

我不确定你在做什么，因为你的例子似乎不正确。为了得到以 3 为底的 { 3, 5, 8, 12, 15 }，您需要 { 0, 2, 5, 9, 12 }。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-10T16:39:38.887

我不知道。如果您将第一个数组想象为提供索引值 f(i) 的某个函数的结果，其中 f(0) 为 3，f(1) 为 5，依此类推，那么您的第二个数组正在描述函数 f` (i) 其中 f(i+1) = f(i) + f'(i) 给定 f(0) = 3。

我将其称为导数函数，其中检索原始数据的过程只是求和函​​数。

什么会更频繁地发生，你会改变 f(0) 还是从 f(i) 中检索值？这种技术是否植根于优化的愿望？

也许您正在寻找“**归纳序列**”或“**归纳**序列”之类的术语。（我只是编的。）

# c++ - 有没有办法在 GDI+ 中实现层？

> ID：192151
> 
> 赞同：0
> 
> 时间：2008-10-10T16:28:47.583
> 
> 标签：c++, gdi+

我的想法是在内存上绘制几个 Graphics 对象，并在绘制图像时将它们组合起来。

但我对如何做到这一点没有一个确切的想法。我应该使用 GraphicsContainer 的吗？或者将对象保存为元文件？（这些是临时对象，我想将它们保留在内存中）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-10T16:43:30.597

最简单的方法：创建多个位图。给他们画你想要的东西。通过将它们拉回前面来合成它们。

如果您有很多文本，那么为这些图层使用图元文件可能会在一定程度上提高渲染质量。

# ruby-on-rails - 阅读 Rails 会话密码的最佳方法是什么？

> ID：192153
> 
> 赞同：9
> 
> 时间：2008-10-10T16:29:16.943
> 
> 标签：ruby-on-rails, ruby, session

我想以编程方式访问 Rails 会话机密（我正在使用它来生成登录令牌）。

这是我想出的：

```
ActionController::Base.session.first[:secret] 
```

这将返回会话密钥。但是，每次调用 ActionController::Base.session 时，它都会向数组添加另一个条目，因此您最终会得到如下内容：

```
[{:session_key=>"_new_app_session", :secret=>"totally-secret-you-guys"}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}] 
```

这让我觉得不好。

有没有更好的方法来访问会话秘密？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2011-02-01T05:27:46.360

对于 Rails4

```
Rails.configuration.secret_token
Rails.configuration.secret_key_base 
```

对于 Rails3

```
Rails.configuration.secret_token 
```

但是如果对于 Rails2.x，就像 Don Parish 提到的

```
ActionController::Base.session_options[:secret] 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-10T17:16:43.587

谢谢，杰克。

由于秘密不会根据请求或操作而更改，因此这也有效：

```
ActionController::Base.session_options_for(nil,nil)[:secret] 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-10T17:05:08.743

```
ActionController::Base.session_options_for(request,params[:action])[:secret] 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T18:28:08.743

对于 Rails 2.3，我使用过：

```
ActionController::Base.session_options[:secret] 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-02-01T05:47:36.967

对于 Rails 3，Rails.configuration 与 Rails.application.config 相同，因此 Rails.configuration.secret_token 就像 choonkeat 提供的一样。

# eclipse - 在 Eclipse 中，如何检测代码 .project 中的哪些位置正在更新？

> ID：192175
> 
> 赞同：2
> 
> 时间：2008-10-10T16:34:27.353
> 
> 标签：eclipse

我遇到了一个问题，即 Eclipse 插件中的某个类正在修改 .project 文件，但我无法确定它是哪个代码/类。

我在 Windows XP 机器上。有没有办法可以设置断点或设置某种侦听器，以便我可以看到 .project 文件在代码中的哪个位置被修改？（理想情况下，通过在某处设置断点，以便我可以看到它发生的堆栈）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-11T18:58:49.433

一个建议，但也许您已经尝试过：在触发 Eclipse 之前将您的 .project 设置为只读，这样您至少可以了解修改您的 .project 的插件

# php - 同时使用 Xdebug 和 Zend 调试器？

> ID：192188
> 
> 赞同：3
> 
> 时间：2008-10-10T16:37:28.597
> 
> 标签：php, profiling, xdebug, zend-studio, zend-debugger

是否可以在同一个 PHP 安装中同时运行两个调试器。它们都使用不同的端口，因此与客户端 IDE/其他应用程序的通信不会成为问题。

我之所以这么问，是因为事实证明将 Zend Debugger 与 ZendStudio 一起使用要容易得多（从浏览器开始/停止调试的步骤更少），但我真的很喜欢一些仅适用于 XDebug 的分析工具。所以简而言之，如果可能的话，我希望能够两全其美。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-11T10:37:30.833

[http://www.suspekt.org/2008/08/04/xdebug-203-stealth-patch/](http://www.suspekt.org/2008/08/04/xdebug-203-stealth-patch/)（特别是最后一条评论）似乎表明 Xedebug 的分析部分可以与 Zend Debugger 一起正常工作，带有补丁安装。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-10T16:40:53.173

有可能 - 在开发 Web 服务器上最简单的方法是运行 2 个不同的 apache 进程，其中不同的 php.ini 文件引用不同的调试器模块

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-12T22:59:16.263

因此，众所周知，XDebug 不能与许多 Zend 工具一起使用（我肯定知道 Zend Optimizer，我不知道 Zend Debugger，但如果 XDebug 有一个内置检查，我不会感到惊讶）。

由于您在开发机器上运行调试器和分析器，我不明白为什么您不能维护两个单独的 ini 文件。否则，您将不得不自己编译一个绕过检查的自定义版本。

# asp.net - 使用 javascript 动态创建表单是否有注意事项？

> ID：192200
> 
> 赞同：4
> 
> 时间：2008-10-10T16:41:41.503
> 
> 标签：asp.net, javascript, forms

我必须进行跨站点 POST（带有重定向，因此不使用 XMLHTTPRequest），并且基础平台是 ASP.NET。我不想将 ASP.NET FORM 中的所有控件发布到这个其他站点，所以我正在考虑使用 javascript 动态创建一个新的表单元素并发布它。

有人试过这个技巧吗？有什么注意事项吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-10T16:45:49.827

我一直这样做。效果很好。但是，您必须手动查看请求的参数，除非您对传递的内容有创意，因为参数不会映射到该页面上的控件。您也可以通过在查询字符串中传递参数以 REST 方式执行此操作，但我更喜欢表单方法来保持我的 URL 干净。请注意，ASP.NET 会忽略所有表单，但它在回发时是自己的，所以我不会费心删除它们。

以下代码的 GridView 模板字段示例：

```
 <asp:TemplateField HeaderText="Station" SortExpression="Name">
   <ItemTemplate>
      <a href="javascript:void(0);" onclick='Redirector.redirect_with_id("StationDetail.aspx", <%# Eval("StationID") != null ? Eval("StationID") : "-1" %>);return false;'>
      <asp:Label ID="nameLabel" runat="server" Text='<%# Bind("Name") %>' /></a>
   </ItemTemplate>
   </asp:TemplateField> 
```

下面的代码——需要原型：

```
 // JScript File

   var Redirector = Class.create();

   Redirector.prototype = {
       initialize: function(url,target) {
           this.url = url;
           this.parameters = new Hash();
           this.target = target;
       }, 

    addParameter: function(id,value) {
        this.parameters.set(id, value);
    },

    redirect: function() {
        var form = document.createElement('form');
        document.body.appendChild(form);
        form.action = this.url;
        form.method = "post";
        if (this.target) {
            form.target = this.target;
        }
        this.parameters.each( function(pair) {
            var input = document.createElement('input');
            input.id = pair.key;
            input.name = pair.key;
            input.value = pair.value;
            input.style.display = 'none';
            form.appendChild(input);
        });
        form.submit();
    }
};

Redirector.redirect_with_id = function(url,id,target) {
    var redirector = new Redirector( url, target );
    redirector.addParameter( 'ID', id );
    redirector.redirect();
};

Redirector.redirect_with_tag = function(url,tag_name,tag,target) {
    var redirector = new Redirector( url, target );
    redirector.addParameter( tag_name, tag );
    redirector.redirect();
};

Redirector.redirect_with_tags = function(url,tag_names_comma_separated,tag_values_comma_separated,target) {
    var redirector = new Redirector( url, target );
    var tags = tag_names_comma_separated.split( "," );
    var values = tag_values_comma_separated.split( ",");
    for( var i = 0; i< tags.length; i++ )
    {
        redirector.addParameter( tags[i], values[i] );
    }
    redirector.redirect();
}; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-10T17:12:31.207

一个警告：您不能使用 innerHTML 将 FORM 标记添加到文档中。您必须通过创建一个新的 DOM 元素来添加它。您可以使用 innerHTML 添加字段，但不能使用表单本身。

# linq-to-sql - 相当于 TOP 或 LIMIT/OFFSET 的 Linq to SQL 是什么？

> ID：192203
> 
> 赞同：199
> 
> 时间：2008-10-10T16:42:22.250
> 
> 标签：linq-to-sql

我该怎么做呢

```
Select top 10 Foo from MyTable 
```

在 Linq 到 SQL 中？

* * *

## 回答 #1

> 赞同：254
> 
> 时间：2008-10-10T16:47:46.500

使用[Take 方法](https://docs.microsoft.com/en-us/dotnet/api/system.linq.enumerable.take)：

```
var foo = (from t in MyTable
           select t.Foo).Take(10); 
```

在 VB LINQ 中有一个 take 表达式：

```
Dim foo = From t in MyTable _
          Take 10 _
          Select t.Foo 
```

从文档中：

> `Take<TSource>`枚举`source`并产生元素，直到`count`元素被产生或`source`不再包含元素。如果`count`超过 中的元素个数，则返回`source`的所有元素。`source`

* * *

## 回答 #2

> 赞同：147
> 
> 时间：2008-10-10T16:45:20.263

在 VB 中：

```
from m in MyTable
take 10
select m.Foo 
```

这假定 MyTable 实现了 IQueryable。您可能必须通过 DataContext 或其他一些提供程序来访问它。

它还假设 Foo 是 MyTable 中映射到属性名称的列。

有关更多详细信息，请参阅[http://blogs.msdn.com/vbteam/archive/2008/01/08/converting-sql-to-linq-part-7-union-top-subqueries-bill-horst.aspx](http://blogs.msdn.com/vbteam/archive/2008/01/08/converting-sql-to-linq-part-7-union-top-subqueries-bill-horst.aspx)。

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2008-10-10T16:47:56.420

使用`Take(int n)`方法：

```
var q = query.Take(10); 
```

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2015-10-16T16:30:29.893

OP实际上也提到了偏移量，所以例如。如果你想从 30 到 60 的项目，你会这样做：

```
var foo = (From t In MyTable
       Select t.Foo).Skip(30).Take(30); 
```

使用“跳过”方法进行偏移。
使用“Take”方法进行限制。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2010-08-11T21:03:16.940

@Janei：我在这里的第一条评论是关于你的样本；）

我想如果你这样做，你想取 4，然后对这 4 应用排序。

```
var dados =  from d in dc.tbl_News.Take(4) 
                orderby d.idNews descending
                select new 
                {
                    d.idNews,
                    d.titleNews,
                    d.textNews,
                    d.dateNews,
                    d.imgNewsThumb
                }; 
```

与通过 idNews 降序然后取 4 对整个 tbl_News 进行排序不同

> ```
> var dados =  (from d in dc.tbl_News
>                 orderby d.idNews descending
>                 select new 
>                 {
>                     d.idNews,
>                     d.titleNews,
>                     d.textNews,
>                     d.dateNews,
>                     d.imgNewsThumb
>                 }).Take(4); 
> ```

不 ？结果可能不同。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2010-01-07T17:07:02.140

这在 C# 中运行良好

```
var q = from m in MyTable.Take(10)
        select m.Foo 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2010-01-26T15:08:16.510

我喜欢这样：

```
 var dados =  from d in dc.tbl_News.Take(4) 
                orderby d.idNews descending

                select new 
                {
                    d.idNews,
                    d.titleNews,
                    d.textNews,
                    d.dateNews,
                    d.imgNewsThumb
                }; 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-10T16:47:32.710

您将使用 Take(N) 方法。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-11-22T09:53:59.250

take 发生在客户端还是数据库中取决于您应用 take 运算符的位置。如果您在枚举查询之前应用它（即在您在 foreach 中使用它或将其转换为集合之前），则获取将导致“top n”SQL 运算符被发送到数据库。如果您运行 SQL 探查器，您可以看到这一点。如果您在枚举查询后应用 take，它将发生在客户端上，因为 LINQ 必须从数据库中检索数据以便您通过它进行枚举

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2010-06-04T07:34:10.217

取DataBase的数据不排序和random take是一样的

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2013-03-15T05:47:11.247

```
Array oList = ((from m in dc.Reviews
                           join n in dc.Users on m.authorID equals n.userID
                           orderby m.createdDate descending
                           where m.foodID == _id                      
                           select new
                           {
                               authorID = m.authorID,
                               createdDate = m.createdDate,
                               review = m.review1,
                               author = n.username,
                               profileImgUrl = n.profileImgUrl
                           }).Take(2)).ToArray(); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-05-09T15:50:58.983

我不得不使用 Take(n) 方法，然后转换为列表，就像一个魅力：

```
 var listTest = (from x in table1
                     join y in table2
                     on x.field1 equals y.field1
                     orderby x.id descending
                     select new tempList()
                     {
                         field1 = y.field1,
                         active = x.active
                     }).Take(10).ToList(); 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-10-01T16:47:08.413

这种方式对我有用：

```
var noticias = from n in db.Noticias.Take(6)
                       where n.Atv == 1
                       orderby n.DatHorLan descending
                       select n; 
```

# c# - 如何判断 IDisposable 对象引用是否已释放？

> ID：192206
> 
> 赞同：95
> 
> 时间：2008-10-10T16:44:05.383
> 
> 标签：c#, .net, dispose, idisposable

有没有一种方法或其他一些轻量级的方法来检查引用是否是对已处理对象的引用？

PS - 这只是一个好奇（睡得好，不是在生产代码中）。是的，我知道我可以`ObjectDisposedException`在尝试访问对象的成员时捕捉到。

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2008-10-10T16:48:16.327

否 - IDisposable 模式的默认实现不支持它

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2008-10-10T16:49:02.113

`System.Windows.Forms.Control`有一个在[被调用](http://referencesource.microsoft.com/System.Windows.Forms/winforms/Managed/System/WinForms/Control.cs.html#d85b7dd334cd518d)[后设置为 true](http://referencesource.microsoft.com/System.Windows.Forms/winforms/Managed/System/WinForms/Control.cs.html#d85b7dd334cd518d)[`IsDisposed`](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.isdisposed.aspx)的属性。在您自己的 IDisposable 对象中，您可以轻松地创建类似的属性。[`Dispose()`](http://referencesource.microsoft.com/System.Windows.Forms/winforms/Managed/System/WinForms/Control.cs.html#d85b7dd334cd518d)

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-10-17T08:49:49.813

没有内置的东西可以允许这样做。您需要公开一个反映内部已处置标志的 IsDisposed 布尔属性。

```
public class SimpleCleanup : IDisposable
{
    private bool disposed = false;

    public bool IsDisposed
    {
       get
       {
          return disposed;
       }
    }

    public SimpleCleanup()
    {
        this.handle = /*...*/;
    }

    protected virtual void Dispose(bool disposing)
    {
        if (!disposed)
        {
            if (disposing)
            {
               // free only managed resources here
            }

            // free unmanaged resources here
            disposed = true;
        }
    }

    public void Dispose()
    {
        Dispose(true);
    }
} 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-10-10T16:56:22.333

如果它不是你的类并且它不提供 IsDisposed 属性（或类似的东西 - 名称只是一个约定），那么你无法知道。

但是，如果它是您的班级并且您正在遵循[规范的 IDisposable 实现](http://msdn.microsoft.com/en-us/library/fs2xkftw.aspx)，那么只需将 _disposed 或 _isDisposed 字段作为属性公开并检查它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-09-14T00:56:54.830

我看到这是旧的，但我没有看到答案。并非所有一次性对象（如 DataSet）都具有可以附加的已处置事件。

```
class DisposeSample : IDisposable
{
    DataSet myDataSet = new DataSet();
    private bool _isDisposed;

    public DisposeSample()
    {
        // attach dispose event for myDataSet
        myDataSet.Disposed += MyDataSet_Disposed;
    }

    private void MyDataSet_Disposed(object sender, EventArgs e)
    {
        //Event triggers when myDataSet is disposed
        _isDisposed = true; // set private bool variable as true 
    }

    public void Dispose()
    {
        if (!_isDisposed) // only dispose if has not been disposed;
            myDataSet?.Dispose(); // only dispose if myDataSet is not null;
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-10-08T16:37:59.323

该`Dispose`方法需要在对象被放弃之前执行任何清理工作；如果不需要清理，则不需要执行任何操作。要求一个对象跟踪它是否已被释放，即使该`Dispose`方法不做任何事情，也将需要许多`IDisposable`对象添加一个标志，以获得非常有限的好处。

如果`IDisposable`包含两个属性可能会有所帮助 - 一个指示对象是否*需要处置*，其中一个指示对象没有被处置而*变得无用*。对于处理实际上做某事的对象，两个值最初都是 true，之后会变为 false `Dispose`。对于处理不需要进行任何清理的对象，第一个方法总是可以返回 false，而第二个方法总是返回 true，而不必在任何地方存储标志。不过，我认为现在无法将它们添加到 .NET 中。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-07-29T06:56:35.933

检查对象是否使用 Extension 方法处理的快捷方式可能是

```
public static class ObjectExtensions 
{
    public static bool IsDisposed(this object obj)
    {
        try
        {
            obj.ToString();
            return false;
        }
        catch (ObjectDisposedException)
        {
            return true;
        }
    }

}

//Usage
if(myObject.IsDisposed()){ 
    /* Do your Stuff */ 
} 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2013-12-07T20:43:56.197

我喜欢做的是声明对象而不初始化它们，但将它们的默认值设置为`Nothing`. 然后，在循环结束时我写：

```
If anObject IsNot Nothing Then anObject.Dispose() 
```

这是一个完整的示例：

```
Public Sub Example()
    Dim inputPdf As PdfReader = Nothing, inputDoc As Document = Nothing, outputWriter As PdfWriter = Nothing

    'code goes here that may or may not end up using all three objects, 
    ' such as when I see that there aren't enough pages in the pdf once I open  
    ' the pdfreader and then abort by jumping to my cleanup routine using a goto ..

GoodExit:
    If inputPdf IsNot Nothing Then inputPdf.Dispose()
    If inputDoc IsNot Nothing Then inputDoc.Dispose()
    If outputWriter IsNot Nothing Then outputWriter.Dispose()
End Sub 
```

这也适用于将主要对象放在例程的顶部，在例程中使用它们`Try`，然后将它们放置在一个`Finally`块中：

```
Private Sub Test()
    Dim aForm As System.Windows.Forms.Form = Nothing
    Try
        Dim sName As String = aForm.Name  'null ref should occur
    Catch ex As Exception
        'got null exception, no doubt
    Finally
        'proper disposal occurs, error or no error, initialized or not..
        If aForm IsNot Nothing Then aForm.Dispose()
    End Try
End Sub 
```

# nhibernate - NHibernate Criteria：用 IN 表达式连接两列

> ID：192213
> 
> 赞同：3
> 
> 时间：2008-10-10T16:45:51.807
> 
> 标签：nhibernate, icriteria

这是我想要完成的 SQL：

```
WHERE domain_nm + '\' + group_nm in ('DOMAINNAME\USERNAME1','DOMAINNAME2\USERNAME2') 
```

我一辈子都找不到合适的表达方式。而且我不认为我可以使用两个表达式作为域名和组名需要连接。

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-18T00:26:48.520

你不能使用两个表达式吗？

```
criteria
  .Add(Expression.In("DomainName", new string[] { "DOMAINNAME", "DOMAINNAME2" }))
  .Add(Expression.In("GroupName", new string[] { "USERNAME1", "USERNAME2" }) 
```

另一种选择是使用 Expression.Sql。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T16:35:50.247

Expression.Sql 如下：

```
.Add(Expression.Sql(String.Format("{{alias}}.domain_nm + '\' + {{alias}}.group_nm in ({0})", getSqlInString(userGroups)))) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-20T14:15:35.973

我只想指出两个表达式不起作用，因为我需要一个表达式。

在 in 发生之前，DomainName 和 GroupName 需要连接起来。想想域帐户上的用户名。DomainName 和 GroupName 一起是唯一的，而不是单独的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-10-23T10:35:04.530

您可以在地图中添加只读公式字段。您将能够以这种方式查询它。使用流利的 nhibernate 看起来像这样

```
Map(x => x.FullName).Formula("[domain_nm] + '\' + [group_nm]") 
```

查询将如下所示

```
criteria.Add(Expression.In("FullName", new string[] { "DOMAINNAME\USERNAME1", "DOMAINNAME2\USERNAME2" })) 
```

# iis - URL 大小写敏感导致缓存问题！有快速修复标题吗？

> ID：192216
> 
> 赞同：2
> 
> 时间：2008-10-10T16:47:01.383
> 
> 标签：iis, caching

是我可以在 IIS 中设置的 http 标头，它本质上会告诉用户浏览器该 url

“/something/img.gif”和网址“/SomeThing/IMG.gif”

实际上是同一件事，浏览器不应该重新下载该资源？我遇到了一些 url 大小写不同的缓存问题，因此用户浏览器正在重新下载资源。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-10T17:20:51.877

URL 的定义是区分大小写的。问题是默认情况下，Windows 文件系统不区分大小写。这就是 IIS 添加该 hack 的原因，但通常您不应该使用它。对于缓存问题，您可能无能为力，因为浏览器遵循标准并假设不同的情况是不同的文件。我的建议是修复您的网站，使其始终使用相同的案例来请求事物。

# sql - 将平面表解析为树的最有效/优雅的方法是什么？

> ID：192220
> 
> 赞同：550
> 
> 时间：2008-10-10T16:47:43.223
> 
> 标签：sql, algorithm, recursion, tree, hierarchical-data

假设您有一个存储有序树层次结构的平面表：

```
Id   Name         ParentId   Order
 1   'Node 1'            0      10
 2   'Node 1.1'          1      10
 3   'Node 2'            0      20
 4   'Node 1.1.1'        2      10
 5   'Node 2.1'          3      10
 6   'Node 1.2'          1      20 
```

这是一个图表，我们有`[id] Name`. 根节点 0 是虚构的。

```
                       [0] 根
                          / \
              [1] 节点 1 [3] 节点 2
              / \ \
    [2] 节点 1.1 [6] 节点 1.2 [5] 节点 2.1
          /          
 [4] 节点 1.1.1

```

您将使用什么简约方法将其作为正确排序、正确缩进的树输出到 HTML（或文本）？

进一步假设你只有基本的数据结构（数组和哈希图），没有带有父/子引用的花哨对象，没有 ORM，没有框架，只有你的两只手。该表表示为一个结果集，可以随机访问。

伪代码或纯英文都可以，这纯粹是一个概念问题。

额外的问题：有没有更好的方法在 RDBMS 中存储这样的树结构？

* * *

**编辑和添加**

回答一位评论者（[Mark Bessey](https://stackoverflow.com/users/17826/mark-bessey)）的问题：根节点不是必需的，因为它永远不会被显示。ParentId = 0 是表达“这些是顶级”的约定。Order 列定义了如何对具有相同父节点的节点进行排序。

我所说的“结果集”可以被描绘成一个哈希图数组（保留在那个术语中）。因为我的例子本来就应该在那里。有些答案会加倍努力并首先构建它，但这没关系。

树可以任意深。每个节点可以有 N 个孩子。不过，我并没有完全想到“数百万个条目”树。

不要将我选择的节点命名（'Node 1.1.1'）误认为是可以依赖的东西。这些节点同样可以称为“Frank”或“Bob”，没有暗示命名结构，这只是为了使其可读。

*我已经发布了我自己的解决方案，因此你们可以将其分解。*

* * *

## 回答 #1

> 赞同：482
> 
> 时间：2008-10-10T17:58:07.263

既然[MySQL 8.0 支持递归查询](https://dev.mysql.com/doc/refman/8.0/en/with.html)，我们可以说[所有流行的 SQL 数据库都支持](https://stackoverflow.com/questions/324935/mysql-with-clause/325243#325243)标准语法的递归查询。

```
WITH RECURSIVE MyTree AS (
    SELECT * FROM MyTable WHERE ParentId IS NULL
    UNION ALL
    SELECT m.* FROM MyTABLE AS m JOIN MyTree AS t ON m.ParentId = t.Id
)
SELECT * FROM MyTree; 
```

我在 2017 年的演示[Recursive Query Throwdown中测试了 MySQL 8.0 中的递归查询。](https://www.slideshare.net/billkarwin/recursive-query-throwdown)

以下是我 2008 年的原始答案：

* * *

有几种方法可以在关系数据库中存储树状结构的数据。您在示例中显示的内容使用两种方法：

*   **邻接列表**（“父”列）和
*   **路径枚举**（您的姓名列中的虚线数字）。

另一种解决方案称为**嵌套集**，它也可以存储在同一个表中。有关这些设计的更多信息，请阅读Joe Celko 的“ [Smarties 中的树和层次结构”。](https://rads.stackoverflow.com/amzn/click/com/1558609202)

我通常更喜欢一种称为**闭包表**（又名“邻接关系”）的设计来存储树形结构的数据。它需要另一个表，但是查询树非常容易。

[我在我的演示文稿Models for Hierarchical Data with SQL and PHP](http://www.slideshare.net/billkarwin/models-for-hierarchical-data)和我的书[SQL Antipatterns: Avoiding the Pitfalls of Database Programming](http://pragprog.com/book/bksqla/sql-antipatterns)中介绍了Closure Table 。

```
CREATE TABLE ClosureTable (
  ancestor_id   INT NOT NULL REFERENCES FlatTable(id),
  descendant_id INT NOT NULL REFERENCES FlatTable(id),
  PRIMARY KEY (ancestor_id, descendant_id)
); 
```

将所有路径存储在闭包表中，其中存在从一个节点到另一个节点的直接祖先。为每个节点包含一行以引用自身。例如，使用您在问题中显示的数据集：

```
INSERT INTO ClosureTable (ancestor_id, descendant_id) VALUES
  (1,1), (1,2), (1,4), (1,6),
  (2,2), (2,4),
  (3,3), (3,5),
  (4,4),
  (5,5),
  (6,6); 
```

现在你可以得到一个从节点 1 开始的树，如下所示：

```
SELECT f.* 
FROM FlatTable f 
  JOIN ClosureTable a ON (f.id = a.descendant_id)
WHERE a.ancestor_id = 1; 
```

输出（在 MySQL 客户端中）如下所示：

```
+----+
| id |
+----+
|  1 | 
|  2 | 
|  4 | 
|  6 | 
+----+ 
```

换句话说，节点 3 和 5 被排除在外，因为它们是单独层次结构的一部分，而不是从节点 1 下降。

* * *

回复：来自 e-satis 关于直系子女（或直系父母）的评论。您可以向 中添加“ `path_length`”列，`ClosureTable`以便更轻松地专门查询直系子女或父母（或任何其他距离）。

```
INSERT INTO ClosureTable (ancestor_id, descendant_id, path_length) VALUES
  (1,1,0), (1,2,1), (1,4,2), (1,6,1),
  (2,2,0), (2,4,1),
  (3,3,0), (3,5,1),
  (4,4,0),
  (5,5,0),
  (6,6,0); 
```

然后，您可以在搜索中添加一个术语来查询给定节点的直接子节点。这些是 1 的后代`path_length`。

```
SELECT f.* 
FROM FlatTable f 
  JOIN ClosureTable a ON (f.id = a.descendant_id)
WHERE a.ancestor_id = 1
  AND path_length = 1;

+----+
| id |
+----+
|  2 | 
|  6 | 
+----+ 
```

* * *

来自@ashraf 的重新评论：“如何[按名称] 对整棵树进行排序？”

这是一个示例查询，用于返回节点 1 的所有后代节点，将它们连接到包含其他节点属性的 FlatTable，例如`name`，并按名称排序。

```
SELECT f.name
FROM FlatTable f 
JOIN ClosureTable a ON (f.id = a.descendant_id)
WHERE a.ancestor_id = 1
ORDER BY f.name; 
```

* * *

来自@Nate的重新评论：

```
SELECT f.name, GROUP_CONCAT(b.ancestor_id order by b.path_length desc) AS breadcrumbs
FROM FlatTable f 
JOIN ClosureTable a ON (f.id = a.descendant_id) 
JOIN ClosureTable b ON (b.descendant_id = a.descendant_id) 
WHERE a.ancestor_id = 1 
GROUP BY a.descendant_id 
ORDER BY f.name

+------------+-------------+
| name       | breadcrumbs |
+------------+-------------+
| Node 1     | 1           |
| Node 1.1   | 1,2         |
| Node 1.1.1 | 1,2,4       |
| Node 1.2   | 1,6         |
+------------+-------------+ 
```

* * *

一位用户今天提出了修改建议。SO 版主批准了编辑，但我正在撤消它。

编辑建议上面最后一个查询中的 ORDER BY 应该是`ORDER BY b.path_length, f.name`，大概是为了确保排序与层次结构匹配。但这不起作用，因为它会在“Node 1.2”之后订购“Node 1.1.1”。

如果您希望排序以合理的方式匹配层次结构，这是可能的，但不仅仅是通过路径长度排序。例如，请参阅我对[MySQL Closure Table hierarchy database - How to pull information out in the correct order 的](https://stackoverflow.com/questions/8252323/mysql-closure-table-hierarchical-database-how-to-pull-information-out-in-the-c)回答。

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2008-10-11T12:31:22.337

如果您使用嵌套集（有时称为修改前序树遍历），您可以使用单个查询按树顺序提取整个树结构或其中的任何子树，但插入成本更高，因为您需要管理描述通过树结构的有序路径的列。

对于[django-mptt](http://code.google.com/p/django-mptt/)，我使用了这样的结构：

```
id parent_id tree_id level lft rght
-- --------- ------- ----- --- ----
 1 无 1 0 1 14
 2 1 1 1 2 7
 3 2 1 2 3 4
 4 2 1 2 5 6
 5 1 1 1 8 13
 6 5 1 2 9 10
 7 5 1 2 11 12

```

它描述了一个看起来像这样的树（`id`代表每个项目）：

```
1
 +-- 2
 | +-- 3
 | +-- 4
 |
 +-- 5
     +-- 6
     +-- 7

```

或者，作为一个嵌套的集合图，它使`lft`和`rght`值的工作方式更加明显：

```
__________________________________________________________________________
| 根 1 |
| ________________________________ ________________________________ |
| | 儿童 1.1 | | 儿童 1.2 | |
| | ___________ ___________ | | ___________ ___________ | |
| | | 1.1.1 | | 1.1.2 | | | | C 1.2.1 | | 1.2.2 | | |
1 2 3_______________4 5___________6 7 8 9___________10 11______________12 13 14
| |________________________________| |________________________________| |
|____________________________________________________________________________________|

```

如您所见，要获取给定节点的整个子树，按树顺序，您只需选择所有行，其值介于其`lft`和值之间。检索给定节点的祖先树也很简单。`rght``lft``rght`

为了方便起见，该`level`列有点非规范化，并且该`tree_id`列允许您重新启动每个顶级节点的`lft`and编号，这减少了受插入、移动和删除影响的列数，因为and列必须是当这些操作发生时进行相应调整，以创建或缩小差距。当我试图围绕每个操作所需的查询进行思考时，我做了一些[开发笔记。](http://code.google.com/p/django-mptt/source/browse/trunk/NOTES)`rght``lft``rght`

就实际使用这些数据显示树而言，我创建了一个[`tree_item_iterator`](http://code.google.com/p/django-mptt/source/browse/trunk/mptt/utils.py#29)实用函数，对于每个节点，它应该为您提供足够的信息来生成您想要的任何类型的显示。

更多关于 MPTT 的信息：

*   [SQL 中的树](http://www.intelligententerprise.com/001020/celko.jhtml)
*   [在数据库中存储分层数据](http://www.sitepoint.com/print/hierarchical-data-database)
*   [在 MySQL 中管理分层数据](http://mikehillyer.com/articles/managing-hierarchical-data-in-mysql/)

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2014-03-13T11:19:21.293

这是一个相当古老的问题，但由于它有很多观点，我认为值得提出一个替代方案，并且在我看来非常优雅的解决方案。

为了读取树结构，您可以使用**递归公用表表达式**(CTE)。它提供了一次获取整个树结构的可能性，具有有关节点级别、其父节点以及父节点子节点中的顺序的信息。

让我向您展示这将如何在 PostgreSQL 9.1 中工作。

1.  创建结构

    ```
    CREATE TABLE tree (
        id int  NOT NULL,
        name varchar(32)  NOT NULL,
        parent_id int  NULL,
        node_order int  NOT NULL,
        CONSTRAINT tree_pk PRIMARY KEY (id),
        CONSTRAINT tree_tree_fk FOREIGN KEY (parent_id) 
          REFERENCES tree (id) NOT DEFERRABLE
    );

    insert into tree values
      (0, 'ROOT', NULL, 0),
      (1, 'Node 1', 0, 10),
      (2, 'Node 1.1', 1, 10),
      (3, 'Node 2', 0, 20),
      (4, 'Node 1.1.1', 2, 10),
      (5, 'Node 2.1', 3, 10),
      (6, 'Node 1.2', 1, 20); 
    ```

2.  写一个查询

    ```
    WITH RECURSIVE 
    tree_search (id, name, level, parent_id, node_order) AS (
      SELECT 
        id, 
        name,
        0,
        parent_id, 
        1 
      FROM tree
      WHERE parent_id is NULL

      UNION ALL 
      SELECT 
        t.id, 
        t.name,
        ts.level + 1, 
        ts.id, 
        t.node_order 
      FROM tree t, tree_search ts 
      WHERE t.parent_id = ts.id 
    ) 
    SELECT * FROM tree_search 
    WHERE level > 0 
    ORDER BY level, parent_id, node_order; 
    ```

    结果如下：

    ```
     id |    name    | level | parent_id | node_order 
    ----+------------+-------+-----------+------------
      1 | Node 1     |     1 |         0 |         10
      3 | Node 2     |     1 |         0 |         20
      2 | Node 1.1   |     2 |         1 |         10
      6 | Node 1.2   |     2 |         1 |         20
      5 | Node 2.1   |     2 |         3 |         10
      4 | Node 1.1.1 |     3 |         2 |         10
    (6 rows) 
    ```

    树节点按深度级别排序。在最终输出中，我们将在后续行中呈现它们。

    对于每个级别，它们在父级中按 parent_id 和 node_order 排序。这告诉我们如何在输出 - 链接节点中按此顺序将它们呈现给父节点。

    有了这样的结构，用 HTML 制作一个非常好的演示文稿并不难。

    递归 CTE 在**PostgreSQL、IBM DB2、MS SQL Server 和 Oracle**中可用。

    如果您想了解更多关于递归 SQL 查询的信息，您可以查看您最喜欢的 DBMS 的文档或阅读我的两篇关于该主题的文章：

    *   [在 SQL 中执行：递归树遍历](http://www.vertabelo.com/blog/do-it-in-sql-recursive-tree-traversal)
    *   [了解 SQL 递归查询的强大功能](http://www.vertabelo.com/blog/sql-recursive-queries)

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-10-10T20:06:21.153

从 Oracle 9i 开始，您可以使用 CONNECT BY。

```
SELECT LPAD(' ', (LEVEL - 1) * 4) || "Name" AS "Name"
FROM (SELECT * FROM TMP_NODE ORDER BY "Order")
CONNECT BY PRIOR "Id" = "ParentId"
START WITH "Id" IN (SELECT "Id" FROM TMP_NODE WHERE "ParentId" = 0) 
```

从 SQL Server 2005 开始，您可以使用递归公用表表达式 (CTE)。

```
WITH [NodeList] (
  [Id]
  , [ParentId]
  , [Level]
  , [Order]
) AS (
  SELECT [Node].[Id]
    , [Node].[ParentId]
    , 0 AS [Level]
    , CONVERT([varchar](MAX), [Node].[Order]) AS [Order]
  FROM [Node]
  WHERE [Node].[ParentId] = 0
  UNION ALL
  SELECT [Node].[Id]
    , [Node].[ParentId]
    , [NodeList].[Level] + 1 AS [Level]
    , [NodeList].[Order] + '|'
      + CONVERT([varchar](MAX), [Node].[Order]) AS [Order]
  FROM [Node]
    INNER JOIN [NodeList] ON [NodeList].[Id] = [Node].[ParentId]
) SELECT REPLICATE(' ', [NodeList].[Level] * 4) + [Node].[Name] AS [Name]
FROM [Node]
  INNER JOIN [NodeList] ON [NodeList].[Id] = [Node].[Id]
ORDER BY [NodeList].[Order] 
```

两者都将输出以下结果。

```
姓名
'节点 1'
'节点 1.1'
'节点 1.1.1'
'节点 1.2'
'节点 2'
'节点 2.1'

```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2010-12-22T04:31:40.227

比尔的答案非常好，这个答案增加了一些东西，这让我希望 SO 支持线程答案。

无论如何，我想支持树结构和 Order 属性。我在每个被调用的节点中包含了一个属性，该属性在原始问题`leftSibling`中执行相同的`Order`操作（保持从左到右的顺序）。

```
mysql> desc 节点；
+-------------+-------------+------+-----+------ --+----------------+
| 领域 | 类型 | 空 | 钥匙 | 默认 | 额外 |
+-------------+-------------+------+-----+------ --+----------------+
| 编号 | 整数(11) | 否 | 优先级 | 空 | 自动增量 |
| 姓名 | varchar(255) | 是 | | 空 | |
| 左兄弟 | 整数(11) | 否 | | 0 | |
+-------------+-------------+------+-----+------ --+----------------+
3 行一组（0.00 秒）

mysql> desc 邻接；
+------------+---------+------+-----+---------+--- -------------+
| 领域 | 类型 | 空 | 钥匙 | 默认 | 额外 |
+------------+---------+------+-----+---------+--- -------------+
| 关系 ID | 整数(11) | 否 | 优先级 | 空 | 自动增量 |
| 家长 | 整数(11) | 否 | | 空 | |
| 孩子| 整数(11) | 否 | | 空 | |
| 路径长度 | 整数(11) | 否 | | 空 | |
+------------+---------+------+-----+---------+--- -------------+
4 行一组（0.00 秒）

```

[更多细节和 SQL 代码在我的博客上](http://bobobobo.wordpress.com/2010/12/22/closure-table-part-deux-nodes-and-adjacencies-a-tree-in-mysql/)。

谢谢比尔，您的回答对入门很有帮助！

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-10-10T17:36:21.690

好吧，如果有选择，我会使用对象。我会为每个记录创建一个对象，其中每个对象都有一个`children`集合，并将它们全部存储在一个关联数组（/哈希表）中，其中 Id 是键。并通过集合闪电战一次，将孩子添加到相关的孩子字段中。**简单的。**

但是因为限制使用一些好的 OOP 并不好玩，所以我可能会基于以下内容进行迭代：

```
function PrintLine(int pID, int level)
    foreach record where ParentID == pID
        print level*tabs + record-data
        PrintLine(record.ID, level + 1)

PrintLine(0, 0) 
```

编辑：这与其他几个条目相似，但我认为它稍微干净一些。我要补充一件事：这是 SQL 密集型的。*真恶心*。_ **如果您有选择，请走 OOP 路线。**

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2017-03-14T08:43:51.550

确实有很好的解决方案可以利用 sql 索引的内部 btree 表示。这是基于 1998 年左右所做的一些伟大研究。

这是一个示例表（在 mysql 中）。

```
CREATE TABLE `node` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(255) NOT NULL,
  `tw` int(10) unsigned NOT NULL,
  `pa` int(10) unsigned DEFAULT NULL,
  `sz` int(10) unsigned DEFAULT NULL,
  `nc` int(11) GENERATED ALWAYS AS (tw+sz) STORED,
  PRIMARY KEY (`id`),
  KEY `node_tw_index` (`tw`),
  KEY `node_pa_index` (`pa`),
  KEY `node_nc_index` (`nc`),
  CONSTRAINT `node_pa_fk` FOREIGN KEY (`pa`) REFERENCES `node` (`tw`) ON DELETE CASCADE
) 
```

树表示所需的唯一字段是：

*   tw：从左到右的 DFS 预购索引，其中 root = 1。
*   pa：对父节点的引用（使用 tw），root 为 null。
*   sz：节点分支的大小，包括它自己。
*   nc：用作语法糖。它是 tw+sz，代表节点的“下一个孩子”的 tw。

这是一个示例 24 节点填充，按 tw 排序：

```
+-----+---------+----+------+------+------+
| id  | name    | tw | pa   | sz   | nc   |
+-----+---------+----+------+------+------+
|   1 | Root    |  1 | NULL |   24 |   25 |
|   2 | A       |  2 |    1 |   14 |   16 |
|   3 | AA      |  3 |    2 |    1 |    4 |
|   4 | AB      |  4 |    2 |    7 |   11 |
|   5 | ABA     |  5 |    4 |    1 |    6 |
|   6 | ABB     |  6 |    4 |    3 |    9 |
|   7 | ABBA    |  7 |    6 |    1 |    8 |
|   8 | ABBB    |  8 |    6 |    1 |    9 |
|   9 | ABC     |  9 |    4 |    2 |   11 |
|  10 | ABCD    | 10 |    9 |    1 |   11 |
|  11 | AC      | 11 |    2 |    4 |   15 |
|  12 | ACA     | 12 |   11 |    2 |   14 |
|  13 | ACAA    | 13 |   12 |    1 |   14 |
|  14 | ACB     | 14 |   11 |    1 |   15 |
|  15 | AD      | 15 |    2 |    1 |   16 |
|  16 | B       | 16 |    1 |    1 |   17 |
|  17 | C       | 17 |    1 |    6 |   23 |
| 359 | C0      | 18 |   17 |    5 |   23 |
| 360 | C1      | 19 |   18 |    4 |   23 |
| 361 | C2(res) | 20 |   19 |    3 |   23 |
| 362 | C3      | 21 |   20 |    2 |   23 |
| 363 | C4      | 22 |   21 |    1 |   23 |
|  18 | D       | 23 |    1 |    1 |   24 |
|  19 | E       | 24 |    1 |    1 |   25 |
+-----+---------+----+------+------+------+ 
```

每个树的结果都可以非递归地完成。例如，要在 tw='22' 处获取节点的祖先列表

**祖先**

```
select anc.* from node me,node anc 
where me.tw=22 and anc.nc >= me.tw and anc.tw <= me.tw 
order by anc.tw;
+-----+---------+----+------+------+------+
| id  | name    | tw | pa   | sz   | nc   |
+-----+---------+----+------+------+------+
|   1 | Root    |  1 | NULL |   24 |   25 |
|  17 | C       | 17 |    1 |    6 |   23 |
| 359 | C0      | 18 |   17 |    5 |   23 |
| 360 | C1      | 19 |   18 |    4 |   23 |
| 361 | C2(res) | 20 |   19 |    3 |   23 |
| 362 | C3      | 21 |   20 |    2 |   23 |
| 363 | C4      | 22 |   21 |    1 |   23 |
+-----+---------+----+------+------+------+ 
```

兄弟姐妹和孩子是微不足道的 - 只需使用 tw 的 pa 字段排序。

**后人**

例如，以 tw = 17 为根的节点集（分支）。

```
select des.* from node me,node des 
where me.tw=17 and des.tw < me.nc and des.tw >= me.tw 
order by des.tw;
+-----+---------+----+------+------+------+
| id  | name    | tw | pa   | sz   | nc   |
+-----+---------+----+------+------+------+
|  17 | C       | 17 |    1 |    6 |   23 |
| 359 | C0      | 18 |   17 |    5 |   23 |
| 360 | C1      | 19 |   18 |    4 |   23 |
| 361 | C2(res) | 20 |   19 |    3 |   23 |
| 362 | C3      | 21 |   20 |    2 |   23 |
| 363 | C4      | 22 |   21 |    1 |   23 |
+-----+---------+----+------+------+------+ 
```

**补充笔记**

当读取的数量远大于插入或更新的数量时，这种方法非常有用。

因为树中节点的插入、移动或更新需要对树进行调整，所以在开始操作之前需要锁定表。

插入/删除成本很高，因为 tw 索引和 sz（分支大小）值将需要在插入点之后的所有节点上更新，并分别为所有祖先更新。

分支移动涉及到将分支的tw值移出范围，所以在移动分支时也需要禁用外键约束。移动分支基本上需要四个查询：

*   将分支移出范围。
*   关闭它留下的差距。（剩余的树现在已标准化）。
*   打开它会去的缝隙。
*   将分支移动到新位置。

**调整树查询**

树中间隙的打开/关闭是创建/更新/删除方法使用的重要子功能，因此我将其包含在此处。

我们需要两个参数 - 一个表示我们是缩小还是扩大规模的标志，以及节点的 tw 索引。因此，例如 tw=18（分支大小为 5）。假设我们正在缩小规模（删除 tw）——这意味着我们在以下示例的更新中使用“-”而不是“+”。

我们首先使用（稍作改动的）祖先函数来更新 sz 值。

```
update node me, node anc set anc.sz = anc.sz - me.sz from 
node me, node anc where me.tw=18 
and ((anc.nc >= me.tw and anc.tw < me.pa) or (anc.tw=me.pa)); 
```

然后我们需要为那些 tw 高于要移除的分支的那些调整 tw。

```
update node me, node anc set anc.tw = anc.tw - me.sz from 
node me, node anc where me.tw=18 and anc.tw >= me.tw; 
```

然后我们需要为那些pa的tw高于要移除的分支的人调整parent。

```
update node me, node anc set anc.pa = anc.pa - me.sz from 
node me, node anc where me.tw=18 and anc.pa >= me.tw; 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-10-10T18:25:29.937

这写得很快，既不漂亮也不高效（加上它自动装箱很多，在`int`和之间转换`Integer`很烦人！），但它有效。

它可能违反了规则，因为我正在创建自己的对象，但是嘿，我这样做是为了转移实际工作:)

这还假设在您开始构建节点之前将结果集/表完全读入某种结构，如果您有数十万行，这不是最佳解决方案。

```
public class Node {

    private Node parent = null;

    private List<Node> children;

    private String name;

    private int id = -1;

    public Node(Node parent, int id, String name) {
        this.parent = parent;
        this.children = new ArrayList<Node>();
        this.name = name;
        this.id = id;
    }

    public int getId() {
        return this.id;
    }

    public String getName() {
        return this.name;
    }

    public void addChild(Node child) {
        children.add(child);
    }

    public List<Node> getChildren() {
        return children;
    }

    public boolean isRoot() {
        return (this.parent == null);
    }

    @Override
    public String toString() {
        return "id=" + id + ", name=" + name + ", parent=" + parent;
    }
}

public class NodeBuilder {

    public static Node build(List<Map<String, String>> input) {

        // maps id of a node to it's Node object
        Map<Integer, Node> nodeMap = new HashMap<Integer, Node>();

        // maps id of a node to the id of it's parent
        Map<Integer, Integer> childParentMap = new HashMap<Integer, Integer>();

        // create special 'root' Node with id=0
        Node root = new Node(null, 0, "root");
        nodeMap.put(root.getId(), root);

        // iterate thru the input
        for (Map<String, String> map : input) {

            // expect each Map to have keys for "id", "name", "parent" ... a
            // real implementation would read from a SQL object or resultset
            int id = Integer.parseInt(map.get("id"));
            String name = map.get("name");
            int parent = Integer.parseInt(map.get("parent"));

            Node node = new Node(null, id, name);
            nodeMap.put(id, node);

            childParentMap.put(id, parent);
        }

        // now that each Node is created, setup the child-parent relationships
        for (Map.Entry<Integer, Integer> entry : childParentMap.entrySet()) {
            int nodeId = entry.getKey();
            int parentId = entry.getValue();

            Node child = nodeMap.get(nodeId);
            Node parent = nodeMap.get(parentId);
            parent.addChild(child);
        }

        return root;
    }
}

public class NodePrinter {

    static void printRootNode(Node root) {
        printNodes(root, 0);
    }

    static void printNodes(Node node, int indentLevel) {

        printNode(node, indentLevel);
        // recurse
        for (Node child : node.getChildren()) {
            printNodes(child, indentLevel + 1);
        }
    }

    static void printNode(Node node, int indentLevel) {
        StringBuilder sb = new StringBuilder();
        for (int i = 0; i < indentLevel; i++) {
            sb.append("\t");
        }
        sb.append(node);

        System.out.println(sb.toString());
    }

    public static void main(String[] args) {

        // setup dummy data
        List<Map<String, String>> resultSet = new ArrayList<Map<String, String>>();
        resultSet.add(newMap("1", "Node 1", "0"));
        resultSet.add(newMap("2", "Node 1.1", "1"));
        resultSet.add(newMap("3", "Node 2", "0"));
        resultSet.add(newMap("4", "Node 1.1.1", "2"));
        resultSet.add(newMap("5", "Node 2.1", "3"));
        resultSet.add(newMap("6", "Node 1.2", "1"));

        Node root = NodeBuilder.build(resultSet);
        printRootNode(root);

    }

    //convenience method for creating our dummy data
    private static Map<String, String> newMap(String id, String name, String parentId) {
        Map<String, String> row = new HashMap<String, String>();
        row.put("id", id);
        row.put("name", name);
        row.put("parent", parentId);
        return row;
    }
} 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-10-10T16:59:37.677

假设您知道根元素为零，这是输出到文本的伪代码：

```
function PrintLevel (int curr, int level)
    //print the indents
    for (i=1; i<=level; i++)
        print a tab
    print curr \n;
    for each child in the table with a parent of curr
        PrintLevel (child, level+1)

for each elementID where the parentid is zero
    PrintLevel(elementID, 0) 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-10-10T17:24:34.973

您可以使用 hashmap 模拟任何其他数据结构，因此这不是一个可怕的限制。从上到下扫描，您为数据库的每一行创建一个哈希图，每列都有一个条目。将这些哈希映射中的每一个添加到一个“主”哈希映射中，以 id 为键。如果任何节点有一个您还没有看到的“父节点”，请在主 hashmap 中为其创建一个占位符条目，并在您看到实际节点时填写它。

要打印出来，做一个简单的深度优先遍历数据，一路跟踪缩进级别。您可以通过为每一行保留一个“子”条目并在扫描数据时填充它来简化此操作。

至于是否有“更好”的方式将树存储在数据库中，这取决于您将如何使用数据。我见过具有已知最大深度的系统，它为层次结构中的每个级别使用不同的表。如果树中的级别毕竟不是完全等价的（顶级类别与叶子不同），这很有意义。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-10T17:02:40.103

如果可以创建嵌套的哈希映射或数组，那么我可以简单地从头开始向下遍历表并将每个项目添加到嵌套数组中。我必须将每一行跟踪到根节点，以便知道要插入嵌套数组中的哪个级别。我可以使用记忆功能，这样我就不需要一遍又一遍地查找同一个父级。

编辑：我会先将整个表读入一个数组，所以它不会重复查询数据库。当然，如果您的桌子很大，这将不实用。

结构建好后，我必须先做一个深度遍历，打印出HTML。

没有更好的基本方法来使用一张表存储这些信息（虽然我可能是错的；），并且希望看到更好的解决方案）。但是，如果您创建一个方案来使用动态创建的数据库表，那么您会以牺牲简单性和 SQL 地狱的风险打开一个全新的世界；）。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-10T18:42:36.940

要扩展 Bill 的 SQL 解决方案，您基本上可以使用平面数组来做同样的事情。此外，如果您的字符串都具有相同的长度并且您的最大子节点数是已知的（例如在二叉树中），您可以使用单个字符串（字符数组）来完成。如果您有任意数量的孩子，这会使事情变得有点复杂......我将不得不检查我的旧笔记，看看可以做什么。

然后，牺牲一点内存，特别是如果你的树是稀疏和/或不平衡的，你可以通过一些索引数学，通过存储你的树来随机访问所有字符串，宽度在数组中像这样（对于二进制树）：

```
String[] nodeArray = [L0root, L1child1, L1child2, L2Child1, L2Child2, L2Child3, L2Child4] ... 
```

你知道你的字符串长度，你知道的

我现在正在工作，所以不能花太多时间在上面，但我可以感兴趣地获取一些代码来执行此操作。

我们用它来搜索由 DNA 密码子组成的二叉树，一个过程构建了树，然后我们将它展平以搜索文本模式，当找到时，虽然索引数学（从上面反转）我们得到节点回来......非常快速、高效、坚固 我们的树很少有空节点，但我们可以在瞬间搜索千兆字节的数据。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-10T21:45:05.167

如果元素按树顺序排列，如您的示例所示，您可以使用类似于以下 Python 示例的内容：

```
delimiter = '.'
stack = []
for item in items:
  while stack and not item.startswith(stack[-1]+delimiter):
    print "</div>"
    stack.pop()
  print "<div>"
  print item
  stack.append(item) 
```

这样做是维护一个代表树中当前位置的堆栈。对于表中的每个元素，它会弹出堆栈元素（关闭匹配的 div），直到找到当前项的父项。然后它输出该节点的开始并将其推入堆栈。

如果您想使用缩进而不是嵌套元素输出树，您可以简单地跳过打印语句以打印 div，并在每个项目之前打印等于堆栈大小的某个倍数的空格数。例如，在 Python 中：

```
print "  " * len(stack) 
```

您还可以轻松地使用此方法构造一组嵌套列表或字典。

编辑：我从您的说明中看到，这些名称并非旨在成为节点路径。这表明了另一种方法：

```
idx = {}
idx[0] = []
for node in results:
  child_list = []
  idx[node.Id] = child_list
  idx[node.ParentId].append((node, child_list)) 
```

这构造了一个元组数组树（！）。idx[0] 表示树的根。数组中的每个元素都是一个 2 元组，由节点本身及其所有子节点的列表组成。构造完成后，您可以保留 idx[0] 并丢弃 idx，除非您想通过其 ID 访问节点。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-11-26T15:49:12.657

考虑将 nosql 工具（如 neo4j）用于层次结构。例如，像linkedin这样的网络应用程序使用couchbase（另一种nosql解决方案）

但仅将 nosql 用于数据集市级别的查询，而不用于存储/维护事务

# php - 用 PHP 编写一个简单的 preg_replace

> ID：192228
> 
> 赞同：2
> 
> 时间：2008-10-10T16:49:13.783
> 
> 标签：php, regex

我不是一个编码员，但我需要用 PHP 编写一个简单的*preg_replace*语句，这将帮助我使用 WordPress 插件。基本上，我需要一些代码来搜索字符串，提取视频 ID，然后返回嵌入代码，其中插入了视频 ID。

换句话说，我正在寻找这个：

```
[youtube=http://www.youtube.com/watch?v=VIDEO_ID_HERE&hl=en&fs=1] 
```

并想用这个替换它（保持视频ID相同）：

```
param name="movie" value="http://www.youtube.com/v/VIDEO_ID_HERE&hl=en&fs=1&rel=0 
```

如果可能的话，如果您能解释一下您是如何在搜索模式中使用各种斜杠、插入符号和 Kleene 星号的，我将永远感激不尽，即将它从 grep 翻译成英语以便我学习。:-)

谢谢！
麦克风

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-10T17:18:10.900

当心！如果这是一个带有用户输入的 BBCode 风格的系统，那么其他两种解决方案会使您容易受到 XSS 攻击。

您有几种方法可以保护自己免受这种情况的影响。让正则表达式明确禁止可能给您带来麻烦的字符（或者，只允许那些对 youtube 视频 ID 有效的字符），或者实际清理输入并改用 preg_match，我将在下面说明如何脱离 RoBorg 的正则表达式。

```
<?php

$input = "[youtube=http://www.youtube.com/watch?v=VIDEO_ID_HERE&hl=en&fs=1]";

if ( preg_match('/\[youtube=.*?v=(.*?)&.*?\]/i', $input, $matches ) )
{
    $sanitizedVideoId = urlencode( strip_tags( $matches[1] ) );
    echo 'param name="movie" value="http://www.youtube.com/v/' . $sanitizedVideoId . '&hl=en&fs=1&rel=0';
} else {
    //  Not valid input
} 
```

这是此类攻击的示例

```
<?php

$input = "[youtube=http://www.youtube.com/watch?v=\"><script src=\"http://example.com/xss.js\"></script>&hl=en&fs=1]";

//  Is vulnerable to XSS
echo preg_replace('/\[youtube=.*?v=(.*?)&.*?\]/i', 'param name="movie" value="http://www.youtube.com/v/$1&hl=en&fs=1&rel=0', $input );
echo "\n";

//  Prevents XSS
if ( preg_match('/\[youtube=.*?v=(.*?)&.*?\]/i', $input, $matches ) )
{
    $sanitizedVideoId = urlencode( strip_tags( $matches[1] ) );
    echo 'param name="movie" value="http://www.youtube.com/v/' . $sanitizedVideoId . '&hl=en&fs=1&rel=0';
} else {
    //  Not valid input
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-10T16:53:40.043

```
$str = preg_replace('/\[youtube=.*?v=([a-z0-9_-]+?)&.*?\]/i', 'param name="movie" value="http://www.youtube.com/v/$1&hl=en&fs=1&rel=0', $str);

         /     - Start of RE
         \[    - A literal [  ([ is a special character so it needs escaping)
         youtube= - Make sure we've got the right tag
         .*?   - Any old rubbish, but don't be greedy; stop when we reach...
         v=    - ...this text
         ([a-z0-9_-]+?) - Take some more text (just z-a 0-9 _ and -), and don't be greedy.  Capture it using ().  This will get put in $1
         &.*?\] - the junk up to the ending ]
         /i - end the RE and make it case-insensitive for the hell of it 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-13T00:19:35.277

如果可能的话，我会在这种情况下避免使用正则表达式，因为：谁保证第一个 url 中的查询字符串总是采用这种格式？

我会使用`parse_url($originalURL, PHP-URL-QUERY);`然后循环遍历返回的数组，为查询字符串的 v 部分找到正确的“名称=值”对：类似于：

```
$originalURL = 'http://www.youtube.com/watch?v=VIDEO_ID_HERE&hl=en&fs=1';

foreach( parse_url( $originalURL, PHP_URL_QUERY) as $keyvalue )
{
    if ( strlen( $keyvalue ) > 2 && substr( $keyvalue, 0, 2 ) == 'v=' )
    {
        $videoId = substr( $keyvalue, 2 );
        break;
    }
}

$newURL = sprintf( 'http://www.youtube.com/v/%s/whatever/else', url_encode( $videoId ) ); 
```

ps 写在 SO 文本框中，未经测试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-10T17:10:28.373

一个警告。如果没有立即找到后面的文本`.*?`，正则表达式引擎将继续搜索整行，可能会跳转到下一个`[youtube...]`标签。通常最好使用`[^\]]*?`将搜索限制在括号内。

基于 RoBorgs 的回答：

```
$str = preg_replace('/\[youtube=[^\]]*?v=([^\]]*?)&[^\]]*?\]/i', ...) 
```

`[^\]]`将匹配除 . 之外的任何字符`']'`。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-10T17:00:02.513

```
$embedString = 'youtube=http://www.youtube.com/watch?v=VIDEO_ID_HERE&hl=en&fs=1';
preg_match('/v=([^&]*)/',$embedstring,$matches);
echo 'param name="movie" value="http://www.youtube.com/v/'.$matches[1].'&hl=en&fs=1&rel=0'; 
```

试试看。

正则表达式`/v=([^&]*)/`以这种方式工作：

*   它搜索`v=`
*   然后它将匹配保存到括号内的模式中`$matches`
*   `[^&]`告诉它匹配*除*& 符号 ('&') 之外的任何字符
*   `*`告诉它我们想要匹配中从 0 到任意数量的这些字符

# html - 基于表格的表格？

> ID：192232
> 
> 赞同：0
> 
> 时间：2008-10-10T16:51:16.540
> 
> 标签：html, forms

寻找提供模板以创建基于样式的基于表格的网页表单的网站。

类似于基于 css 的表单： [http ://www.smashingmagazine.com/2006/11/11/css-based-forms-modern-solutions/](http://www.smashingmagazine.com/2006/11/11/css-based-forms-modern-solutions/)

（请没有 css 比表格讨论更好）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-15T04:45:40.293

这就像询问 GOTO 语句最佳实践的示例。你就是自找麻烦，不管是什么意图！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-15T04:43:38.423

我想我不会评论为什么表在这里是一个坏主意（因为你特别提到了它）。要完成工作，您可以试试这个[在线表格生成器](http://www.hooverwebdesign.com/templates/table-generator.html)。

如果您在问题中添加更具体的要求，我很乐意为您提供一些剪切和粘贴代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-12T19:51:33.383

我不知道提供模板的网站，但是 37 Signals 使用表格和表格。喜欢[这个](https://signup.37signals.com/basecamp/Max/signup/new?source=google-basecamp)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T03:33:11.807

我的表格比典型的 2 列表格更复杂。我可以有 3 &4+ 列，一旦你开始使用 CSS 在所有浏览器中正确布局这些列，它就会变得非常耗时。使用表格更容易做到这一点，使用表格没有任何问题。表格用于显示表格数据，并且可以将表单视为表格数据。有两个阵营可以就此争论表格与 CSS 直到永恒，这真的毫无意义。有数以百万计的网站，包括已知的流行网站，它们使用表格作为表格，我不认为这是错误的。这不是使用表格进行布局，而是使用表格来帮助创建表单。

# wpf - 是否可以在 WPF 用户控件上定义属性？

> ID：192237
> 
> 赞同：2
> 
> 时间：2008-10-10T16:52:00.283
> 
> 标签：wpf

在创建 WPF 用户控件时，是否可以通过属性或其他机制使属性成为必需？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-10T17:00:01.060

将属性分配给一个初始值，该值可以与它可能设置的任何其他值区分开来（即，对于引用类型，null）。

在您需要该属性时，如果尚未设置 (this.Property == UnsetValue)，则抛出带有问题描述的 InvalidOperationException。

此外，请确保在类、属性以及如果未设置属性将引发异常的任何方法的文档中突出说明这一点。

`**`*编辑* 或者，您可以为您的控件创建一个 XSD 架构，根据需要标识该属性，但是我不知道如何去做。

更快的解决方案可能是实现 ISupportInitialize，这将允许您在反序列化期间检查属性，此时您可以抛出异常。 [这是 Relya 的博客上](http://blogs.windowsclient.net/rob_relyea/archive/2008/04/19/xaml-and-isupportinitialize.aspx)关于它的一篇文章。

# excel - 为什么将内容声明为字符串会导致 WinHttp 无法在 Excel VBA 中发送 HTTP 内容？

> ID：192238
> 
> 赞同：0
> 
> 时间：2008-10-10T16:53:01.123
> 
> 标签：excel, winhttp, vba

我有一个 Excel VBA 宏，它等效于以下 HTTP POST，它可以成功运行：

```
Set WebClient = CreateObject("WinHttp.WinHttpRequest.5.1")
' ... Configure WebClient for a POST request
RequestBody = "<request>"
WebClient.send RequestBody 
```

以前，我已将 RequestBody 的类型显式设置为 String，如下所示：

```
Set WebClient = CreateObject("WinHttp.WinHttpRequest.5.1")
' ... Configure WebClient for a POST request
Dim RequestBody As String
RequestBody = "<request>"
WebClient.send RequestBody 
```

这似乎工作正常，只是服务器没有收到请求内容。

在通过这两个版本进行调试时，RequestBody 上的手表将其类型描述为“Variant/String”并且内容是正确的。

为什么添加类型会导致此问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-10T18:08:53.420

唔...

尝试添加对 WinHTTP 库的引用（工具 - 参考）。有时它很重要，没有明显的原因。

但是 Send 方法无论如何都被声明为使用 Variant 参数，因此将其设为 String 没有意义。

# sharepoint - 来自具有集成安全选项的共享点工作流的数据库连接问题

> ID：192241
> 
> 赞同：0
> 
> 时间：2008-10-10T16:54:13.053
> 
> 标签：sharepoint

大家，早安，

我在使用 SharePoint 工作流项目（C#、VS 2008）并连接到数据库时遇到了问题。这是我的数据库连接字符串：

```
Data Source=DBSERVER;Initial Catalog=DBNAME;Integrated Security=True; 
```

当我尝试运行以下代码时，出现以下错误...

```
SqlConnection dbEngine = new SqlConnection(Constants.DBCONNECTION_STRING);
dbEngine.Open(); 
```

**“用户 'DOMAIN\MACHINE_NAME$' 登录失败”**

我需要它做的是通过登录用户的凭据。我已经打开了模拟，但它似乎没有通过。任何建议将不胜感激。

提前感谢您的任何建议，

斯科特·维库斯基

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-11T11:08:11.567

Web 前端和 SQL 服务器在同一个盒子上吗？

如果没有，您必须设置 Kerberos 以允许凭据传播。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-03T03:38:57.910

出于安全和连接池的原因，任何数据库访问都应作为 Windows 服务帐户运行。

关于工作流安全上下文，请参阅：

SharePoint、工作流和安全 [http://cglessner.blogspot.com/2008/09/sharepoint-workflows-and-security.html](http://cglessner.blogspot.com/2008/09/sharepoint-workflows-and-security.html)

声明性工作流和用户上下文[http://blogs.msdn.com/sharepointdesigner/archive/2008/09/28/declarative-workflows-and-user-context.aspx](http://blogs.msdn.com/sharepointdesigner/archive/2008/09/28/declarative-workflows-and-user-context.aspx)

SharePoint 中的安全性和应用程序开发：第一步工作流 [http://www.microsoft.com/technet/community/columns/secmvp/sv0408.mspx#EACAC](http://www.microsoft.com/technet/community/columns/secmvp/sv0408.mspx#EACAC)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-15T05:54:57.157

您不能这样做 - 工作流不会在用户的上下文中运行。工作流程是异步执行的。只有 (HTTP) 网页请求在用户的上下文中运行（如果您打开模拟）。您无法将模拟流向工作流。要在工作流程中恢复模拟（您不应该这样做），需要用户名和密码或协议转换（然后需要在系统下运行流程）。

此外，如果您尝试从模拟的用户上下文访问数据库，您的应用程序会出现严重的设计问题。这会打乱连接池并严重影响性能。这通常是不行的。

这*不是*kerberos 问题。该进程尝试以机器帐户的身份访问数据库，这会告诉您该进程正在作为网络服务或（win 2008 及更高版本）系统运行。

# bash - 如何在 Bash 中解析命令行参数？

> ID：192249
> 
> 赞同：2319
> 
> 时间：2008-10-10T16:57:19.490
> 
> 标签：bash, command-line, scripting, arguments, getopts

说，我有一个用这一行调用的脚本：

```
./myscript -vfd ./foo/bar/someFile -o /fizz/someOtherFile 
```

或者这个：

```
./myscript -v -f -d -o /fizz/someOtherFile ./foo/bar/someFile 
```

什么是可接受的解析方式，使得在每种情况下（或两者的某种组合）`$v`、、`$f`和 `$d`都将设置为`true`并且`$outFile`等于`/fizz/someOtherFile`？

* * *

## 回答 #1

> 赞同：3234
> 
> 时间：2013-01-07T20:01:05.670

#### Bash 空格分隔（例如，`--option argument`）

```
cat >/tmp/demo-space-separated.sh <<'EOF'
#!/bin/bash

POSITIONAL_ARGS=()

while [[ $# -gt 0 ]]; do
  case $1 in
    -e|--extension)
      EXTENSION="$2"
      shift # past argument
      shift # past value
      ;;
    -s|--searchpath)
      SEARCHPATH="$2"
      shift # past argument
      shift # past value
      ;;
    --default)
      DEFAULT=YES
      shift # past argument
      ;;
    -*|--*)
      echo "Unknown option $1"
      exit 1
      ;;
    *)
      POSITIONAL_ARGS+=("$1") # save positional arg
      shift # past argument
      ;;
  esac
done

set -- "${POSITIONAL_ARGS[@]}" # restore positional parameters

echo "FILE EXTENSION  = ${EXTENSION}"
echo "SEARCH PATH     = ${SEARCHPATH}"
echo "DEFAULT         = ${DEFAULT}"
echo "Number files in SEARCH PATH with EXTENSION:" $(ls -1 "${SEARCHPATH}"/*."${EXTENSION}" | wc -l)

if [[ -n $1 ]]; then
    echo "Last line of file specified as non-opt/last argument:"
    tail -1 "$1"
fi
EOF

chmod +x /tmp/demo-space-separated.sh

/tmp/demo-space-separated.sh -e conf -s /etc /etc/hosts 
```

##### 复制粘贴上面的块的输出

```
FILE EXTENSION  = conf
SEARCH PATH     = /etc
DEFAULT         =
Number files in SEARCH PATH with EXTENSION: 14
Last line of file specified as non-opt/last argument:
#93.184.216.34    example.com 
```

##### 用法

```
demo-space-separated.sh -e conf -s /etc /etc/hosts 
```

* * *

#### Bash 等于分隔（例如，`--option=argument`）

```
cat >/tmp/demo-equals-separated.sh <<'EOF'
#!/bin/bash

for i in "$@"; do
  case $i in
    -e=*|--extension=*)
      EXTENSION="${i#*=}"
      shift # past argument=value
      ;;
    -s=*|--searchpath=*)
      SEARCHPATH="${i#*=}"
      shift # past argument=value
      ;;
    --default)
      DEFAULT=YES
      shift # past argument with no value
      ;;
    -*|--*)
      echo "Unknown option $i"
      exit 1
      ;;
    *)
      ;;
  esac
done

echo "FILE EXTENSION  = ${EXTENSION}"
echo "SEARCH PATH     = ${SEARCHPATH}"
echo "DEFAULT         = ${DEFAULT}"
echo "Number files in SEARCH PATH with EXTENSION:" $(ls -1 "${SEARCHPATH}"/*."${EXTENSION}" | wc -l)

if [[ -n $1 ]]; then
    echo "Last line of file specified as non-opt/last argument:"
    tail -1 $1
fi
EOF

chmod +x /tmp/demo-equals-separated.sh

/tmp/demo-equals-separated.sh -e=conf -s=/etc /etc/hosts 
```

##### 复制粘贴上面的块的输出

```
FILE EXTENSION  = conf
SEARCH PATH     = /etc
DEFAULT         =
Number files in SEARCH PATH with EXTENSION: 14
Last line of file specified as non-opt/last argument:
#93.184.216.34    example.com 
```

##### 用法

```
demo-equals-separated.sh -e=conf -s=/etc /etc/hosts 
```

* * *

为了更好地理解在[本指南](http://tldp.org/LDP/abs/html/string-manipulation.html)`${i#*=}`中搜索“子字符串删除” 。它在功能上等价于调用一个不需要的子进程或调用*两个*不需要的子进程。``sed 's/[^=]*=//' <<< "$i"````echo "$i" | sed 's/[^=]*=//'``

 ** * *

#### 将 bash 与 getopt[s] 一起使用

getopt(1) 限制（较旧、相对较新的`getopt`版本）：

*   无法处理空字符串参数
*   无法处理带有嵌入空格的参数

较新的`getopt`版本没有这些限制。有关更多信息，请参阅这些[文档](https://mywiki.wooledge.org/BashFAQ/035#getopts)。

* * *

#### POSIX getopts

此外，POSIX shell 和其他提供`getopts`的没有这些限制。我已经包括了一个简单的`getopts`例子。

```
cat >/tmp/demo-getopts.sh <<'EOF'
#!/bin/sh

# A POSIX variable
OPTIND=1         # Reset in case getopts has been used previously in the shell.

# Initialize our own variables:
output_file=""
verbose=0

while getopts "h?vf:" opt; do
  case "$opt" in
    h|\?)
      show_help
      exit 0
      ;;
    v)  verbose=1
      ;;
    f)  output_file=$OPTARG
      ;;
  esac
done

shift $((OPTIND-1))

[ "${1:-}" = "--" ] && shift

echo "verbose=$verbose, output_file='$output_file', Leftovers: $@"
EOF

chmod +x /tmp/demo-getopts.sh

/tmp/demo-getopts.sh -vf /etc/hosts foo bar 
```

##### 复制粘贴上面的块的输出

```
verbose=1, output_file='/etc/hosts', Leftovers: foo bar 
```

##### 用法

```
demo-getopts.sh -vf /etc/hosts foo bar 
```

的优点`getopts`是：

1.  它更便携，并且可以在其他 shell 中工作，例如`dash`.
2.  `-vf filename`它可以像典型的 Unix 方式那样自动处理多个单个选项。

的缺点`getopts`是它只能处理短选项（`-h`, not `--help`）而无需额外代码。

有一个[getopts 教程](http://wiki.bash-hackers.org/howto/getopts_tutorial)解释了所有语法和变量的含义。在 bash 中，还有`help getopts`，这可能会提供信息。

* * *

## 回答 #2

> 赞同：681
> 
> 时间：2015-04-20T17:47:25.610

**没有答案展示了*增强的 getopt*。[投票最多的答案](https://stackoverflow.com/a/14203146/825924)具有误导性：**它要么忽略`-⁠vfd`样式短选项（由 OP 要求），要么忽略位置参数后的选项（也由 OP 要求）；它忽略了解析错误。反而：

*   **使用`getopt`来自 util-linux 或以前的 GNU glibc 的**增强版。^([1])
*   它与`getopt_long()`GNU glibc 的 C 函数一起工作。
*   *此页面上没有其他解决方案可以做到这一切*：
    *   ^([处理参数2])中的空格、引号字符甚至二进制（非增强型`getopt`不能这样做）
    *   它可以在最后处理选项：（`script.sh -o outFile file1 file2 -v`不`getopts`这样做）
    *   允许`=`-style 长选项：（`script.sh --outfile=fileOut --infile fileIn`如果自解析，则允许两者都很长）
    *   允许组合短选项，例如`-vfd`（如果自解析，则实际工作）
    *   允许触摸选项参数，例如`-oOutfile`或`-vfdoOutfile`
*   已经这么老了^([3])以至于没有 GNU 系统缺少这个（例如任何 Linux 都有它）。
*   您可以使用以下方法测试它的存在：`getopt --test`→ 返回值 4。
*   其他`getopt`或 shell-builtin`getopts`的用途有限。

以下调用

```
myscript -vfd ./foo/bar/someFile -o /fizz/someOtherFile
myscript -v -f -d -o/fizz/someOtherFile -- ./foo/bar/someFile
myscript --verbose --force --debug ./foo/bar/someFile -o/fizz/someOtherFile
myscript --output=/fizz/someOtherFile ./foo/bar/someFile -vfd
myscript ./foo/bar/someFile -df -v --output /fizz/someOtherFile 
```

全部返回

```
verbose: y, force: y, debug: y, in: ./foo/bar/someFile, out: /fizz/someOtherFile 
```

与以下`myscript`

```
#!/bin/bash
# More safety, by turning some bugs into errors.
# Without `errexit` you don’t need ! and can replace
# PIPESTATUS with a simple $?, but I don’t do that.
set -o errexit -o pipefail -o noclobber -o nounset

# -allow a command to fail with !’s side effect on errexit
# -use return value from ${PIPESTATUS[0]}, because ! hosed $?
! getopt --test > /dev/null 
if [[ ${PIPESTATUS[0]} -ne 4 ]]; then
    echo 'I’m sorry, `getopt --test` failed in this environment.'
    exit 1
fi

OPTIONS=dfo:v
LONGOPTS=debug,force,output:,verbose

# -regarding ! and PIPESTATUS see above
# -temporarily store output to be able to check for errors
# -activate quoting/enhanced mode (e.g. by writing out “--options”)
# -pass arguments only via   -- "$@"   to separate them correctly
! PARSED=$(getopt --options=$OPTIONS --longoptions=$LONGOPTS --name "$0" -- "$@")
if [[ ${PIPESTATUS[0]} -ne 0 ]]; then
    # e.g. return value is 1
    #  then getopt has complained about wrong arguments to stdout
    exit 2
fi
# read getopt’s output this way to handle the quoting right:
eval set -- "$PARSED"

d=n f=n v=n outFile=-
# now enjoy the options in order and nicely split until we see --
while true; do
    case "$1" in
        -d|--debug)
            d=y
            shift
            ;;
        -f|--force)
            f=y
            shift
            ;;
        -v|--verbose)
            v=y
            shift
            ;;
        -o|--output)
            outFile="$2"
            shift 2
            ;;
        --)
            shift
            break
            ;;
        *)
            echo "Programming error"
            exit 3
            ;;
    esac
done

# handle non-option arguments
if [[ $# -ne 1 ]]; then
    echo "$0: A single input file is required."
    exit 4
fi

echo "verbose: $v, force: $f, debug: $d, in: $1, out: $outFile" 
```

* * *

^([1])增强的 getopt 可用于大多数“bash 系统”，包括 Cygwin；在 OS X 上尝试[brew install gnu-getopt](https://stackoverflow.com/a/37485578/825924)或`sudo port install getopt`
^([2]) POSIX`exec()`约定没有可靠的方法在命令行参数中传递二进制 NULL；这些字节过早地结束了参数
^([3]) 1997 年或更早发布的第一个版本（我只追踪到 1997 年）

* * *

## 回答 #3

> 赞同：322
> 
> 时间：2015-11-20T12:28:23.557

**部署.sh**

```
#!/bin/bash

while [[ "$#" -gt 0 ]]; do
    case $1 in
        -t|--target) target="$2"; shift ;;
        -u|--uglify) uglify=1 ;;
        *) echo "Unknown parameter passed: $1"; exit 1 ;;
    esac
    shift
done

echo "Where to deploy: $target"
echo "Should uglify  : $uglify" 
```

**用法：**

```
./deploy.sh -t dev -u

# OR:

./deploy.sh --target dev --uglify 
```

* * *

## 回答 #4

> 赞同：149
> 
> 时间：2012-11-13T10:31:07.720

来自[digitalpeer.com](https://web.archive.org/web/20120818044047/http://www.digitalpeer.com/id/parsing)，稍作修改：

用法 `myscript.sh -p=my_prefix -s=dirname -l=libname`

```
#!/bin/bash
for i in "$@"
do
case $i in
    -p=*|--prefix=*)
    PREFIX="${i#*=}"

    ;;
    -s=*|--searchpath=*)
    SEARCHPATH="${i#*=}"
    ;;
    -l=*|--lib=*)
    DIR="${i#*=}"
    ;;
    --default)
    DEFAULT=YES
    ;;
    *)
            # unknown option
    ;;
esac
done
echo PREFIX = ${PREFIX}
echo SEARCH PATH = ${SEARCHPATH}
echo DIRS = ${DIR}
echo DEFAULT = ${DEFAULT} 
```

为了更好地理解在[本指南](http://tldp.org/LDP/abs/html/string-manipulation.html)`${i#*=}`中搜索“子字符串删除” 。它在功能上等价于调用一个不需要的子进程或调用*两个*不需要的子进程。``sed 's/[^=]*=//' <<< "$i"````echo "$i" | sed 's/[^=]*=//'``

 ** * *

## 回答 #5

> 赞同：111
> 
> 时间：2015-07-15T23:43:36.203

```
while [ "$#" -gt 0 ]; do
  case "$1" in
    -n) name="$2"; shift 2;;
    -p) pidfile="$2"; shift 2;;
    -l) logfile="$2"; shift 2;;

    --name=*) name="${1#*=}"; shift 1;;
    --pidfile=*) pidfile="${1#*=}"; shift 1;;
    --logfile=*) logfile="${1#*=}"; shift 1;;
    --name|--pidfile|--logfile) echo "$1 requires an argument" >&2; exit 1;;

    -*) echo "unknown option: $1" >&2; exit 1;;
    *) handle_argument "$1"; shift 1;;
  esac
done 
```

这个解决方案：

*   把手`-n arg`和`--name=arg`
*   最后允许参数
*   如果有任何拼写错误，则显示正常错误
*   兼容，不使用 bashisms
*   可读，不需要在循环中维护状态

* * *

## 回答 #6

> 赞同：109
> 
> 时间：2008-10-10T17:03:38.463

`getopt()`/`getopts()`是一个不错的选择。[从这里](http://aplawrence.com/Unix/getopts.html)复制：

> 这个小脚本显示了“getopt”的简单用法：

```
#!/bin/bash
echo "Before getopt"
for i
do
  echo $i
done
args=`getopt abc:d $*`
set -- $args
echo "After getopt"
for i
do
  echo "-->$i"
done 
```

> 我们所说的是允许使用 -a、-b、-c 或 -d 中的任何一个，但 -c 后跟一个参数（“c:”表示）。
> 
> 如果我们称其为“g”并尝试一下：

```
bash-2.05a$ ./g -abc foo
Before getopt
-abc
foo
After getopt
-->-a
-->-b
-->-c
-->foo
-->-- 
```

> 我们从两个参数开始，“getopt”分解选项并将每个选项放在自己的参数中。它还添加了“--”。

* * *

## 回答 #7

> 赞同：46
> 
> 时间：2016-07-10T22:40:42.817

我发现在脚本中编写可移植解析非常令人沮丧，以至于我编写了[Argbash](https://github.com/matejak/argbash "阿格巴什") - 一个 FOSS 代码生成器，可以为您的脚本生成参数解析代码，而且它具有一些不错的功能：

[https://argbash.io](https://argbash.io)

* * *

## 回答 #8

> 赞同：44
> 
> 时间：2014-07-01T01:20:22.350

我以较早的答案为起点来整理我旧的临时参数解析。然后我重构了以下模板代码。它处理长参数和短参数，使用 = 或空格分隔的参数，以及组合在一起的多个短参数。最后，它将所有非参数参数重新插入到 $1,$2.. 变量中。

```
#!/usr/bin/env bash

# NOTICE: Uncomment if your script depends on bashisms.
#if [ -z "$BASH_VERSION" ]; then bash $0 $@ ; exit $? ; fi

echo "Before"
for i ; do echo - $i ; done

# Code template for parsing command line parameters using only portable shell
# code, while handling both long and short params, handling '-f file' and
# '-f=file' style param data and also capturing non-parameters to be inserted
# back into the shell positional parameters.

while [ -n "$1" ]; do
        # Copy so we can modify it (can't modify $1)
        OPT="$1"
        # Detect argument termination
        if [ x"$OPT" = x"--" ]; then
                shift
                for OPT ; do
                        REMAINS="$REMAINS \"$OPT\""
                done
                break
        fi
        # Parse current opt
        while [ x"$OPT" != x"-" ] ; do
                case "$OPT" in
                        # Handle --flag=value opts like this
                        -c=* | --config=* )
                                CONFIGFILE="${OPT#*=}"
                                shift
                                ;;
                        # and --flag value opts like this
                        -c* | --config )
                                CONFIGFILE="$2"
                                shift
                                ;;
                        -f* | --force )
                                FORCE=true
                                ;;
                        -r* | --retry )
                                RETRY=true
                                ;;
                        # Anything unknown is recorded for later
                        * )
                                REMAINS="$REMAINS \"$OPT\""
                                break
                                ;;
                esac
                # Check for multiple short options
                # NOTICE: be sure to update this pattern to match valid options
                NEXTOPT="${OPT#-[cfr]}" # try removing single short opt
                if [ x"$OPT" != x"$NEXTOPT" ] ; then
                        OPT="-$NEXTOPT"  # multiple short opts, keep going
                else
                        break  # long form, exit inner loop
                fi
        done
        # Done with that param. move to next
        shift
done
# Set the non-parameters back into the positional parameters ($1 $2 ..)
eval set -- $REMAINS

echo -e "After: \n configfile='$CONFIGFILE' \n force='$FORCE' \n retry='$RETRY' \n remains='$REMAINS'"
for i ; do echo - $i ; done 
```

* * *

## 回答 #9

> 赞同：32
> 
> 时间：2016-09-08T18:59:57.367

```
# As long as there is at least one more argument, keep looping
while [[ $# -gt 0 ]]; do
    key="$1"
    case "$key" in
        # This is a flag type option. Will catch either -f or --foo
        -f|--foo)
        FOO=1
        ;;
        # Also a flag type option. Will catch either -b or --bar
        -b|--bar)
        BAR=1
        ;;
        # This is an arg value type option. Will catch -o value or --output-file value
        -o|--output-file)
        shift # past the key and to the value
        OUTPUTFILE="$1"
        ;;
        # This is an arg=value type option. Will catch -o=value or --output-file=value
        -o=*|--output-file=*)
        # No need to shift here since the value is part of the same string
        OUTPUTFILE="${key#*=}"
        ;;
        *)
        # Do whatever you want with extra options
        echo "Unknown option '$key'"
        ;;
    esac
    # Shift after checking all the cases to get the next option
    shift
done 
```

这允许您同时拥有空格分隔的选项/值，以及相等的定义值。

因此，您可以使用以下命令运行脚本：

```
./myscript --foo -b -o /fizz/file.txt 
```

也：

```
./myscript -f --bar -o=/fizz/file.txt 
```

并且两者都应该具有相同的最终结果。

优点：

*   允许 -arg=value 和 -arg value

*   适用于您可以在 bash 中使用的任何 arg 名称

    *   含义 -a 或 -arg 或 --arg 或 -arg 或其他
*   纯粹的狂欢。无需学习/使用 getopt 或 getopts

缺点：

*   无法组合 args

    *   意思是没有-abc。你必须做 -a -b -c

* * *

## 回答 #10

> 赞同：25
> 
> 时间：2016-09-07T18:25:44.987

此示例说明如何使用`getopt`and`eval`和`HEREDOC`and`shift`来处理带和不带所需值的短参数和长参数。此外，switch/case 语句简洁易懂。

```
#!/usr/bin/env bash

# usage function
function usage()
{
   cat << HEREDOC

   Usage: $progname [--num NUM] [--time TIME_STR] [--verbose] [--dry-run]

   optional arguments:
     -h, --help           show this help message and exit
     -n, --num NUM        pass in a number
     -t, --time TIME_STR  pass in a time string
     -v, --verbose        increase the verbosity of the bash script
     --dry-run            do a dry run, dont change any files

HEREDOC
}  

# initialize variables
progname=$(basename $0)
verbose=0
dryrun=0
num_str=
time_str=

# use getopt and store the output into $OPTS
# note the use of -o for the short options, --long for the long name options
# and a : for any option that takes a parameter
OPTS=$(getopt -o "hn:t:v" --long "help,num:,time:,verbose,dry-run" -n "$progname" -- "$@")
if [ $? != 0 ] ; then echo "Error in command line arguments." >&2 ; usage; exit 1 ; fi
eval set -- "$OPTS"

while true; do
  # uncomment the next line to see how shift is working
  # echo "\$1:\"$1\" \$2:\"$2\""
  case "$1" in
    -h | --help ) usage; exit; ;;
    -n | --num ) num_str="$2"; shift 2 ;;
    -t | --time ) time_str="$2"; shift 2 ;;
    --dry-run ) dryrun=1; shift ;;
    -v | --verbose ) verbose=$((verbose + 1)); shift ;;
    -- ) shift; break ;;
    * ) break ;;
  esac
done

if (( $verbose > 0 )); then

   # print out all the parameters we read in
   cat <<EOM
   num=$num_str
   time=$time_str
   verbose=$verbose
   dryrun=$dryrun
EOM
fi

# The rest of your script below 
```

上面脚本中最重要的几行是：

```
OPTS=$(getopt -o "hn:t:v" --long "help,num:,time:,verbose,dry-run" -n "$progname" -- "$@")
if [ $? != 0 ] ; then echo "Error in command line arguments." >&2 ; exit 1 ; fi
eval set -- "$OPTS"

while true; do
  case "$1" in
    -h | --help ) usage; exit; ;;
    -n | --num ) num_str="$2"; shift 2 ;;
    -t | --time ) time_str="$2"; shift 2 ;;
    --dry-run ) dryrun=1; shift ;;
    -v | --verbose ) verbose=$((verbose + 1)); shift ;;
    -- ) shift; break ;;
    * ) break ;;
  esac
done 
```

简短、中肯、易读，并且几乎可以处理所有事情（恕我直言）。

希望对某人有所帮助。

* * *

## 回答 #11

> 赞同：21
> 
> 时间：2014-06-09T13:46:50.943

如果您正在制作可与其他实用程序互换的脚本，那么以下灵活性可能会很有用。

任何一个：

```
command -x=myfilename.ext --another_switch 
```

或者：

```
command -x myfilename.ext --another_switch 
```

这是代码：

```
STD_IN=0

prefix=""
key=""
value=""
for keyValue in "$@"
do
  case "${prefix}${keyValue}" in
    -i=*|--input_filename=*)  key="-i";     value="${keyValue#*=}";; 
    -ss=*|--seek_from=*)      key="-ss";    value="${keyValue#*=}";;
    -t=*|--play_seconds=*)    key="-t";     value="${keyValue#*=}";;
    -|--stdin)                key="-";      value=1;;
    *)                                      value=$keyValue;;
  esac
  case $key in
    -i) MOVIE=$(resolveMovie "${value}");  prefix=""; key="";;
    -ss) SEEK_FROM="${value}";          prefix=""; key="";;
    -t)  PLAY_SECONDS="${value}";           prefix=""; key="";;
    -)   STD_IN=${value};                   prefix=""; key="";; 
    *)   prefix="${keyValue}=";;
  esac
done 
```

* * *

## 回答 #12

> 赞同：19
> 
> 时间：2019-03-05T17:12:02.193

扩展@bruno-bronosky 的答案，我添加了一个“预处理器”来处理一些常见的格式：

*   扩展`--longopt=val`到`--longopt val`
*   扩展`-xyz`到`-x -y -z`
*   支持`--`指示标志的结束
*   显示意外选项的错误
*   紧凑且易于阅读的选项开关

```
#!/bin/bash

# Report usage
usage() {
  echo "Usage:"
  echo "$(basename "$0") [options] [--] [file1, ...]"
}

invalid() {
  echo "ERROR: Unrecognized argument: $1" >&2
  usage
  exit 1
}

# Pre-process options to:
# - expand -xyz into -x -y -z
# - expand --longopt=arg into --longopt arg
ARGV=()
END_OF_OPT=
while [[ $# -gt 0 ]]; do
  arg="$1"; shift
  case "${END_OF_OPT}${arg}" in
    --) ARGV+=("$arg"); END_OF_OPT=1 ;;
    --*=*)ARGV+=("${arg%%=*}" "${arg#*=}") ;;
    --*) ARGV+=("$arg") ;;
    -*) for i in $(seq 2 ${#arg}); do ARGV+=("-${arg:i-1:1}"); done ;;
    *) ARGV+=("$arg") ;;
  esac
done

# Apply pre-processed options
set -- "${ARGV[@]}"

# Parse options
END_OF_OPT=
POSITIONAL=()
while [[ $# -gt 0 ]]; do
  case "${END_OF_OPT}${1}" in
    -h|--help)      usage; exit 0 ;;
    -p|--password)  shift; PASSWORD="$1" ;;
    -u|--username)  shift; USERNAME="$1" ;;
    -n|--name)      shift; names+=("$1") ;;
    -q|--quiet)     QUIET=1 ;;
    -C|--copy)      COPY=1 ;;
    -N|--notify)    NOTIFY=1 ;;
    --stdin)        READ_STDIN=1 ;;
    --)             END_OF_OPT=1 ;;
    -*)             invalid "$1" ;;
    *)              POSITIONAL+=("$1") ;;
  esac
  shift
done

# Restore positional parameters
set -- "${POSITIONAL[@]}" 
```

* * *

## 回答 #13

> 赞同：16
> 
> 时间：2012-03-01T15:15:03.550

我认为这个使用起来很简单：

```
#!/bin/bash
#

readopt='getopts $opts opt;rc=$?;[ "$rc$opt" = "0?" ]&&exit 1;[ $rc = 0 ]||{ shift $[OPTIND-1];false; }'

opts=vfdo:

# Enumerating options
while eval "$readopt"
do
    echo OPT:$opt ${OPTARG+OPTARG:$OPTARG}
done

# Enumerating arguments
for arg
do
    echo ARG:$arg
done 
```

调用示例：

```
./myscript -v -do /fizz/someOtherFile -f ./foo/bar/someFile
OPT:v 
OPT:d 
OPT:o OPTARG:/fizz/someOtherFile
OPT:f 
ARG:./foo/bar/someFile 
```

* * *

## 回答 #14

> 赞同：12
> 
> 时间：2016-07-01T20:56:37.003

`parse_params`我给你从命令行解析参数的函数。

1.  这是一个纯 Bash 解决方案，没有额外的实用程序。
2.  不污染全局范围。
3.  毫不费力地为您返回简单易用的变量，您可以在其上构建进一步的逻辑。
4.  参数之前的破折号数量无关紧要（`--all`等于`-all`等于`all=all`）

下面的脚本是一个复制粘贴工作演示。查看`show_use`函数以了解如何使用`parse_params`.

限制：

1.  不支持空格分隔的参数 ( `-d 1`)
2.  参数名称将丢失破折号，因此`--any-param`是`-anyparam`等效的
3.  `eval $(parse_params "$@")`必须在 bash**函数**内使用（它在全局范围内不起作用）

* * *

```
#!/bin/bash

# Universal Bash parameter parsing
# Parse equal sign separated params into named local variables
# Standalone named parameter value will equal its param name (--force creates variable $force=="force")
# Parses multi-valued named params into an array (--path=path1 --path=path2 creates ${path[*]} array)
# Puts un-named params as-is into ${ARGV[*]} array
# Additionally puts all named params as-is into ${ARGN[*]} array
# Additionally puts all standalone "option" params as-is into ${ARGO[*]} array
# @author Oleksii Chekulaiev
# @version v1.4.1 (Jul-27-2018)
parse_params ()
{
    local existing_named
    local ARGV=() # un-named params
    local ARGN=() # named params
    local ARGO=() # options (--params)
    echo "local ARGV=(); local ARGN=(); local ARGO=();"
    while [[ "$1" != "" ]]; do
        # Escape asterisk to prevent bash asterisk expansion, and quotes to prevent string breakage
        _escaped=${1/\*/\'\"*\"\'}
        _escaped=${_escaped//\'/\\\'}
        _escaped=${_escaped//\"/\\\"}
        # If equals delimited named parameter
        nonspace="[^[:space:]]"
        if [[ "$1" =~ ^${nonspace}${nonspace}*=..* ]]; then
            # Add to named parameters array
            echo "ARGN+=('$_escaped');"
            # key is part before first =
            local _key=$(echo "$1" | cut -d = -f 1)
            # Just add as non-named when key is empty or contains space
            if [[ "$_key" == "" || "$_key" =~ " " ]]; then
                echo "ARGV+=('$_escaped');"
                shift
                continue
            fi
            # val is everything after key and = (protect from param==value error)
            local _val="${1/$_key=}"
            # remove dashes from key name
            _key=${_key//\-}
            # skip when key is empty
            # search for existing parameter name
            if (echo "$existing_named" | grep "\b$_key\b" >/dev/null); then
                # if name already exists then it's a multi-value named parameter
                # re-declare it as an array if needed
                if ! (declare -p _key 2> /dev/null | grep -q 'declare \-a'); then
                    echo "$_key=(\"\$$_key\");"
                fi
                # append new value
                echo "$_key+=('$_val');"
            else
                # single-value named parameter
                echo "local $_key='$_val';"
                existing_named=" $_key"
            fi
        # If standalone named parameter
        elif [[ "$1" =~ ^\-${nonspace}+ ]]; then
            # remove dashes
            local _key=${1//\-}
            # Just add as non-named when key is empty or contains space
            if [[ "$_key" == "" || "$_key" =~ " " ]]; then
                echo "ARGV+=('$_escaped');"
                shift
                continue
            fi
            # Add to options array
            echo "ARGO+=('$_escaped');"
            echo "local $_key=\"$_key\";"
        # non-named parameter
        else
            # Escape asterisk to prevent bash asterisk expansion
            _escaped=${1/\*/\'\"*\"\'}
            echo "ARGV+=('$_escaped');"
        fi
        shift
    done
}

#--------------------------- DEMO OF THE USAGE -------------------------------

show_use ()
{
    eval $(parse_params "$@")
    # --
    echo "${ARGV[0]}" # print first unnamed param
    echo "${ARGV[1]}" # print second unnamed param
    echo "${ARGN[0]}" # print first named param
    echo "${ARG0[0]}" # print first option param (--force)
    echo "$anyparam"  # print --anyparam value
    echo "$k"         # print k=5 value
    echo "${multivalue[0]}" # print first value of multi-value
    echo "${multivalue[1]}" # print second value of multi-value
    [[ "$force" == "force" ]] && echo "\$force is set so let the force be with you"
}

show_use "param 1" --anyparam="my value" param2 k=5 --force --multi-value=test1 --multi-value=test2 
```

* * *

## 回答 #15

> 赞同：11
> 
> 时间：2015-02-12T21:50:26.093

如果 #1 已安装 getopts 并且 #2 您打算在同一平台上运行它，则 getopts 效果很好。OSX 和 Linux（例如）在这方面表现不同。

这是一个支持等于、非等于和布尔标志的（非 getopts）解决方案。例如，您可以以这种方式运行您的脚本：

```
./script --arg1=value1 --arg2 value2 --shouldClean

# parse the arguments.
COUNTER=0
ARGS=("$@")
while [ $COUNTER -lt $# ]
do
    arg=${ARGS[$COUNTER]}
    let COUNTER=COUNTER+1
    nextArg=${ARGS[$COUNTER]}

    if [[ $skipNext -eq 1 ]]; then
        echo "Skipping"
        skipNext=0
        continue
    fi

    argKey=""
    argVal=""
    if [[ "$arg" =~ ^\- ]]; then
        # if the format is: -key=value
        if [[ "$arg" =~ \= ]]; then
            argVal=$(echo "$arg" | cut -d'=' -f2)
            argKey=$(echo "$arg" | cut -d'=' -f1)
            skipNext=0

        # if the format is: -key value
        elif [[ ! "$nextArg" =~ ^\- ]]; then
            argKey="$arg"
            argVal="$nextArg"
            skipNext=1

        # if the format is: -key (a boolean flag)
        elif [[ "$nextArg" =~ ^\- ]] || [[ -z "$nextArg" ]]; then
            argKey="$arg"
            argVal=""
            skipNext=0
        fi
    # if the format has not flag, just a value.
    else
        argKey=""
        argVal="$arg"
        skipNext=0
    fi

    case "$argKey" in 
        --source-scmurl)
            SOURCE_URL="$argVal"
        ;;
        --dest-scmurl)
            DEST_URL="$argVal"
        ;;
        --version-num)
            VERSION_NUM="$argVal"
        ;;
        -c|--clean)
            CLEAN_BEFORE_START="1"
        ;;
        -h|--help|-help|--h)
            showUsage
            exit
        ;;
    esac
done 
```

* * *

## 回答 #16

> 赞同：10
> 
> 时间：2020-08-14T13:36:01.620

# 另一个选项解析器（生成器）

一个优雅的 shell 脚本选项解析器（完全支持所有 POSIX shell） [https://github.com/ko1nksm/getoptions](https://github.com/ko1nksm/getoptions)（更新：2021-05-02 发布的 v3.3.0）

**getoptions**是一个用 POSIX 兼容的 shell 脚本编写的新选项解析器（生成器），并于 2020 年 8 月发布。它适用于那些希望在你的 shell 脚本中支持 POSIX / GNU 样式选项语法的人。

支持的语法有`-a`, `+a`, `-abc`, `-vvv`, `-p VALUE`, `-pVALUE`, `--flag`, `--no-flag`, `--with-flag`, `--without-flag`, `--param VALUE`, `--param=VALUE`, `--option[=VALUE]`, `--no-option` `--`.

它支持子命令、验证、缩写选项和自动帮助生成。并且适用于所有 POSIX shell（dash 0.5.4+、bash 2.03+、ksh88+、mksh R28+、zsh 3.1.9+、yash 2.29+、busybox ash 1.1.3+ 等）。

```
#!/bin/sh

VERSION="0.1"

parser_definition() {
  setup   REST help:usage -- "Usage: example.sh [options]... [arguments]..." ''
  msg -- 'Options:'
  flag    FLAG    -f --flag                 -- "takes no arguments"
  param   PARAM   -p --param                -- "takes one argument"
  option  OPTION  -o --option on:"default"  -- "takes one optional argument"
  disp    :usage  -h --help
  disp    VERSION    --version
}

eval "$(getoptions parser_definition) exit 1"

echo "FLAG: $FLAG, PARAM: $PARAM, OPTION: $OPTION"
printf '%s\n' "$@" # rest arguments 
```

它解析以下参数：

```
example.sh -f --flag -p VALUE --param VALUE -o --option -oVALUE --option=VALUE 1 2 3 
```

并自动生成帮助。

```
$ example.sh --help

Usage: example.sh [options]... [arguments]...

Options:
  -f, --flag                  takes no arguments
  -p, --param PARAM           takes one argument
  -o, --option[=OPTION]       takes one optional argument
  -h, --help
      --version 
```

它也是一个选项解析器生成器，生成以下简单的选项解析代码。如果您使用生成的代码，则不需要`getoptions`. **实现真正的可移植性和零依赖。**

```
FLAG=''
PARAM=''
OPTION=''
REST=''
getoptions_parse() {
  OPTIND=$(($#+1))
  while OPTARG= && [ $# -gt 0 ]; do
    case $1 in
      --?*=*) OPTARG=$1; shift
        eval 'set -- "${OPTARG%%\=*}" "${OPTARG#*\=}"' ${1+'"$@"'}
        ;;
      --no-*|--without-*) unset OPTARG ;;
      -[po]?*) OPTARG=$1; shift
        eval 'set -- "${OPTARG%"${OPTARG#??}"}" "${OPTARG#??}"' ${1+'"$@"'}
        ;;
      -[fh]?*) OPTARG=$1; shift
        eval 'set -- "${OPTARG%"${OPTARG#??}"}" -"${OPTARG#??}"' ${1+'"$@"'}
        OPTARG= ;;
    esac
    case $1 in
      '-f'|'--flag')
        [ "${OPTARG:-}" ] && OPTARG=${OPTARG#*\=} && set "noarg" "$1" && break
        eval '[ ${OPTARG+x} ] &&:' && OPTARG='1' || OPTARG=''
        FLAG="$OPTARG"
        ;;
      '-p'|'--param')
        [ $# -le 1 ] && set "required" "$1" && break
        OPTARG=$2
        PARAM="$OPTARG"
        shift ;;
      '-o'|'--option')
        set -- "$1" "$@"
        [ ${OPTARG+x} ] && {
          case $1 in --no-*|--without-*) set "noarg" "${1%%\=*}"; break; esac
          [ "${OPTARG:-}" ] && { shift; OPTARG=$2; } || OPTARG='default'
        } || OPTARG=''
        OPTION="$OPTARG"
        shift ;;
      '-h'|'--help')
        usage
        exit 0 ;;
      '--version')
        echo "${VERSION}"
        exit 0 ;;
      --)
        shift
        while [ $# -gt 0 ]; do
          REST="${REST} \"\${$(($OPTIND-$#))}\""
          shift
        done
        break ;;
      [-]?*) set "unknown" "$1"; break ;;
      *)
        REST="${REST} \"\${$(($OPTIND-$#))}\""
    esac
    shift
  done
  [ $# -eq 0 ] && { OPTIND=1; unset OPTARG; return 0; }
  case $1 in
    unknown) set "Unrecognized option: $2" "$@" ;;
    noarg) set "Does not allow an argument: $2" "$@" ;;
    required) set "Requires an argument: $2" "$@" ;;
    pattern:*) set "Does not match the pattern (${1#*:}): $2" "$@" ;;
    notcmd) set "Not a command: $2" "$@" ;;
    *) set "Validation error ($1): $2" "$@"
  esac
  echo "$1" >&2
  exit 1
}
usage() {
cat<<'GETOPTIONSHERE'
Usage: example.sh [options]... [arguments]...

Options:
  -f, --flag                  takes no arguments
  -p, --param PARAM           takes one argument
  -o, --option[=OPTION]       takes one optional argument
  -h, --help
      --version
GETOPTIONSHERE
} 
```

* * *

## 回答 #17

> 赞同：8
> 
> 时间：2018-09-16T17:45:50.463

我想提交我的项目：[https ://github.com/flyingangel/argparser](https://github.com/flyingangel/argparser)

```
source argparser.sh
parse_args "$@" 
```

就那么简单。环境将填充与参数同名的变量

* * *

## 回答 #18

> 赞同：7
> 
> 时间：2013-07-19T07:50:31.020

这就是我在函数中所做的，以避免破坏 getopts 在堆栈中更高位置同时运行：

```
function waitForWeb () {
   local OPTIND=1 OPTARG OPTION
   local host=localhost port=8080 proto=http
   while getopts "h:p:r:" OPTION; do
      case "$OPTION" in
      h)
         host="$OPTARG"
         ;;
      p)
         port="$OPTARG"
         ;;
      r)
         proto="$OPTARG"
         ;;
      esac
   done
...
} 
```

* * *

## 回答 #19

> 赞同：7
> 
> 时间：2015-06-24T10:54:23.253

我想提供我的选项解析版本，它允许以下内容：

```
-s p1
--stage p1
-w somefolder
--workfolder somefolder
-sw p1 somefolder
-e=hello 
```

也允许这样做（可能是不需要的）：

```
-s--workfolder p1 somefolder
-se=hello p1
-swe=hello p1 somefolder 
```

您必须在使用前决定是否将 = 用于选项。这是为了保持代码干净（ish）。

```
while [[ $# > 0 ]]
do
    key="$1"
    while [[ ${key+x} ]]
    do
        case $key in
            -s*|--stage)
                STAGE="$2"
                shift # option has parameter
                ;;
            -w*|--workfolder)
                workfolder="$2"
                shift # option has parameter
                ;;
            -e=*)
                EXAMPLE="${key#*=}"
                break # option has been fully handled
                ;;
            *)
                # unknown option
                echo Unknown option: $key #1>&2
                exit 10 # either this: my preferred way to handle unknown options
                break # or this: do this to signal the option has been handled (if exit isn't used)
                ;;
        esac
        # prepare for next option in this key, if any
        [[ "$key" = -? || "$key" == --* ]] && unset key || key="${key/#-?/-}"
    done
    shift # option(s) fully processed, proceed to next input argument
done 
```

* * *

## 回答 #20

> 赞同：6
> 
> 时间：2019-12-24T02:09:42.760

有几种方法可以解析 cmdline args（例如 GNU getopt（不可移植）vs BSD（MacOS）getopt vs getopts） - 都有问题。这个解决方案

*   是便携的！
*   零依赖，仅依赖 bash 内置
*   允许短期和长期选择
*   处理空格或同时`=`在选项和参数之间使用分隔符
*   支持串联短选项样式`-vxf`
*   处理带有可选参数的选项（例如`--color`vs `--color=always`），
*   正确检测并报告未知选项
*   支持`--`发出选项结束信号，以及
*   与相同功能集的替代方案相比，不需要代码膨胀。即简洁，因此更易于维护

示例：任何

```
# flag
-f
--foo

# option with required argument
-b"Hello World"
-b "Hello World"
--bar "Hello World"
--bar="Hello World"

# option with optional argument
--baz
--baz="Optional Hello" 
```

* * *

```
#!/usr/bin/env bash

usage() {
  cat - >&2 <<EOF
NAME
    program-name.sh - Brief description

SYNOPSIS
    program-name.sh [-h|--help]
    program-name.sh [-f|--foo]
                    [-b|--bar <arg>]
                    [--baz[=<arg>]]
                    [--]
                    FILE ...

REQUIRED ARGUMENTS
  FILE ...
          input files

OPTIONS
  -h, --help
          Prints this and exits

  -f, --foo
          A flag option

  -b, --bar <arg>
          Option requiring an argument <arg>

  --baz[=<arg>]
          Option that has an optional argument <arg>. If <arg>
          is not specified, defaults to 'DEFAULT'
  --     
          Specify end of options; useful if the first non option
          argument starts with a hyphen

EOF
}

fatal() {
    for i; do
        echo -e "${i}" >&2
    done
    exit 1
}

# For long option processing
next_arg() {
    if [[ $OPTARG == *=* ]]; then
        # for cases like '--opt=arg'
        OPTARG="${OPTARG#*=}"
    else
        # for cases like '--opt arg'
        OPTARG="${args[$OPTIND]}"
        OPTIND=$((OPTIND + 1))
    fi
}

# ':' means preceding option character expects one argument, except
# first ':' which make getopts run in silent mode. We handle errors with
# wildcard case catch. Long options are considered as the '-' character
optspec=":hfb:-:"
args=("" "$@")  # dummy first element so $1 and $args[1] are aligned
while getopts "$optspec" optchar; do
    case "$optchar" in
        h) usage; exit 0 ;;
        f) foo=1 ;;
        b) bar="$OPTARG" ;;
        -) # long option processing
            case "$OPTARG" in
                help)
                    usage; exit 0 ;;
                foo)
                    foo=1 ;;
                bar|bar=*) next_arg
                    bar="$OPTARG" ;;
                baz)
                    baz=DEFAULT ;;
                baz=*) next_arg
                    baz="$OPTARG" ;;
                -) break ;;
                *) fatal "Unknown option '--${OPTARG}'" "see '${0} --help' for usage" ;;
            esac
            ;;
        *) fatal "Unknown option: '-${OPTARG}'" "See '${0} --help' for usage" ;;
    esac
done

shift $((OPTIND-1))

if [ "$#" -eq 0 ]; then
    fatal "Expected at least one required argument FILE" \
    "See '${0} --help' for usage"
fi

echo "foo=$foo, bar=$bar, baz=$baz, files=${@}" 
```

* * *

## 回答 #21

> 赞同：5
> 
> 时间：2016-08-29T03:44:56.437

# 保留未处理参数的解决方案。包括演示。

这是我的解决方案。它非常灵活，不像其他人，不应该需要外部包并干净地处理剩余的参数。

用法是：`./myscript -flag flagvariable -otherflag flagvar2`

您所要做的就是编辑validflags 行。它在前面加上一个连字符并搜索所有参数。然后它将下一个参数定义为标志名称，例如

```
./myscript -flag flagvariable -otherflag flagvar2
echo $flag $otherflag
flagvariable flagvar2 
```

主要代码（简短版本，详细示例，下面还有一个错误版本）：

```
#!/usr/bin/env bash
#shebang.io
validflags="rate time number"
count=1
for arg in $@
do
    match=0
    argval=$1
    for flag in $validflags
    do
        sflag="-"$flag
        if [ "$argval" == "$sflag" ]
        then
            declare $flag=$2
            match=1
        fi
    done
        if [ "$match" == "1" ]
    then
        shift 2
    else
        leftovers=$(echo $leftovers $argval)
        shift
    fi
    count=$(($count+1))
done
#Cleanup then restore the leftovers
shift $#
set -- $leftovers 
```

带有内置 echo 演示的详细版本：

```
#!/usr/bin/env bash
#shebang.io
rate=30
time=30
number=30
echo "all args
$@"
validflags="rate time number"
count=1
for arg in $@
do
    match=0
    argval=$1
#   argval=$(echo $@ | cut -d ' ' -f$count)
    for flag in $validflags
    do
            sflag="-"$flag
        if [ "$argval" == "$sflag" ]
        then
            declare $flag=$2
            match=1
        fi
    done
        if [ "$match" == "1" ]
    then
        shift 2
    else
        leftovers=$(echo $leftovers $argval)
        shift
    fi
    count=$(($count+1))
done

#Cleanup then restore the leftovers
echo "pre final clear args:
$@"
shift $#
echo "post final clear args:
$@"
set -- $leftovers
echo "all post set args:
$@"
echo arg1: $1 arg2: $2

echo leftovers: $leftovers
echo rate $rate time $time number $number 
```

最后一个，如果传递了一个无效的参数，这个错误就会出错。

```
#!/usr/bin/env bash
#shebang.io
rate=30
time=30
number=30
validflags="rate time number"
count=1
for arg in $@
do
    argval=$1
    match=0
        if [ "${argval:0:1}" == "-" ]
    then
        for flag in $validflags
        do
                sflag="-"$flag
            if [ "$argval" == "$sflag" ]
            then
                declare $flag=$2
                match=1
            fi
        done
        if [ "$match" == "0" ]
        then
            echo "Bad argument: $argval"
            exit 1
        fi
        shift 2
    else
        leftovers=$(echo $leftovers $argval)
        shift
    fi
    count=$(($count+1))
done
#Cleanup then restore the leftovers
shift $#
set -- $leftovers
echo rate $rate time $time number $number
echo leftovers: $leftovers 
```

优点：它做了什么，它处理得很好。它保留了许多其他解决方案没有的未使用的参数。它还允许调用变量而无需在脚本中手动定义。如果没有给出相应的参数，它还允许预填充变量。（参见详细示例）。

缺点：无法解析单个复杂的 arg 字符串，例如 -xcvf 将作为单个参数处理。不过，您可以稍微轻松地将其他代码写入我的代码中以添加此功能。

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2015-10-19T13:59:34.890

请注意，这`getopt(1)`是 AT&T 的一个短暂错误。

getopt 是在 1984 年创建的，但在 1986 年已经被埋没了，因为它并不是真正可用的。

`getopt`一个非常过时的事实的证明是`getopt(1)`手册页仍然提到`"$*"`而不是`"$@"`, 是在 1986 年与内置 shell 一起添加到 Bourne Shell 中的`getopts(1)`，以便处理内部带有空格的参数。

顺便说一句：如果您对解析 shell 脚本中的长选项感兴趣，可能有兴趣知道`getopt(3)`libc (Solaris) 的实现和`ksh93`两者都添加了一个统一的长选项实现，该实现支持长选项作为短选项的别名。这会导致`ksh93`并`Bourne Shell`通过`getopts`.

从 Bourne Shell 手册页中获取的长选项示例：

`getopts "f:(file)(input-file)o:(output-file)" OPTX "$@"`

显示在 Bourne Shell 和 ksh93 中可以使用多长时间的选项别名。

请参阅最近的 Bourne Shell 的手册页：

[http://schillix.sourceforge.net/man/man1/bosh.1.html](http://schillix.sourceforge.net/man/man1/bosh.1.html)

以及来自 OpenSolaris 的 getopt(3) 手册页：

[http://schillix.sourceforge.net/man/man3c/getopt.3c.html](http://schillix.sourceforge.net/man/man3c/getopt.3c.html)

最后，使用 getopt(1) 手册页来验证过时的 $*：

[http://schillix.sourceforge.net/man/man1/getopt.1.html](http://schillix.sourceforge.net/man/man1/getopt.1.html)

* * *

## 回答 #23

> 赞同：4
> 
> 时间：2020-06-27T23:07:28.267

[我受到@bronson](https://stackoverflow.com/a/31443098/3738764)相对简单的答案的启发，并试图尝试改进它（不增加太多复杂性）。结果如下：

# 另一个 Shell 参数解析器 (ASAP) – POSIX，否`getopt*`

*   使用任何`-n [arg]`、`-abn [arg]`和样式的选项`--name [arg]` **；** `--name=arg`
*   参数可以以任何顺序出现，只有**位置参数留在** `$@`循环之后；
*   **用于** `--` **强制将**剩余参数视为位置参数；
*   检测无效选项和缺失参数；
*   不依赖于`getopt(s)`或外部工具（一个功能使用一个简单的`sed`命令）；
*   便携，紧凑，可读性强，具有**独立功能**。

```
# Convenience functions.
usage_error () { echo >&2 "$(basename $0):  $1"; exit 2; }
assert_argument () { test "$1" != "$EOL" || usage_error "$2 requires an argument"; }

# One loop, nothing more.
EOL=$(echo '\01\03\03\07')
if [ "$#" != 0 ]; then
  set -- "$@" "$EOL"
  while [ "$1" != "$EOL" ]; do
    opt="$1"; shift
    case "$opt" in

      # Your options go here.
      -f|--flag) flag=true;;
      -n|--name) assert_argument "$1" $opt; name="$1"; shift;;

      -|''|[^-]*) set -- "$@" "$opt";;                                          # positional argument, rotate to the end
      # Extra features (you may remove any line you don't need):
      --*=*)      set -- "${opt%%=*}" "${opt#*=}" "$@";;                        # convert '--name=arg' to '--name' 'arg'
      -[^-]?*)    set -- $(echo "${opt#-}" | sed 's/\(.\)/ -\1/g') "$@";;       # convert '-abc' to '-a' '-b' '-c'
      --)         while [ "$1" != "$EOL" ]; do set -- "$@" "$1"; shift; done;;  # process remaining arguments as positional
      -*)         usage_error "unknown option: '$opt'";;                        # catch misspelled options
      *)          usage_error "this should NEVER happen ($opt)";;               # sanity test for previous patterns
    esac
  done
  shift # $EOL
fi

# Do something cool with "$@"... \o/ 
```

*注意：*我知道...*二进制模式* `0x01030307`的参数可能会破坏逻辑。但是，如果有人在命令行中传递这样的参数，他们应该得到它。

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2015-04-27T02:42:47.553

## 混合位置和基于标志的参数

### --param=arg（等于分隔）

在位置参数之间自由混合标志：

```
./script.sh dumbo 127.0.0.1 --environment=production -q -d
./script.sh dumbo --environment=production 127.0.0.1 --quiet -d 
```

可以通过一种相当简洁的方法来完成：

```
# process flags
pointer=1
while [[ $pointer -le $# ]]; do
   param=${!pointer}
   if [[ $param != "-"* ]]; then ((pointer++)) # not a parameter flag so advance pointer
   else
      case $param in
         # paramter-flags with arguments
         -e=*|--environment=*) environment="${param#*=}";;
                  --another=*) another="${param#*=}";;

         # binary flags
         -q|--quiet) quiet=true;;
                 -d) debug=true;;
      esac

      # splice out pointer frame from positional list
      [[ $pointer -gt 1 ]] \
         && set -- ${@:1:((pointer - 1))} ${@:((pointer + 1)):$#} \
         || set -- ${@:((pointer + 1)):$#};
   fi
done

# positional remain
node_name=$1
ip_address=$2 
```

### --param arg（空格分隔）

`--flag=value`不混合和`--flag value`风格通常更清楚。

```
./script.sh dumbo 127.0.0.1 --environment production -q -d 
```

这读起来有点冒险，但仍然有效

```
./script.sh dumbo --environment production 127.0.0.1 --quiet -d 
```

来源

```
# process flags
pointer=1
while [[ $pointer -le $# ]]; do
   if [[ ${!pointer} != "-"* ]]; then ((pointer++)) # not a parameter flag so advance pointer
   else
      param=${!pointer}
      ((pointer_plus = pointer + 1))
      slice_len=1

      case $param in
         # paramter-flags with arguments
         -e|--environment) environment=${!pointer_plus}; ((slice_len++));;
                --another) another=${!pointer_plus}; ((slice_len++));;

         # binary flags
         -q|--quiet) quiet=true;;
                 -d) debug=true;;
      esac

      # splice out pointer frame from positional list
      [[ $pointer -gt 1 ]] \
         && set -- ${@:1:((pointer - 1))} ${@:((pointer + $slice_len)):$#} \
         || set -- ${@:((pointer + $slice_len)):$#};
   fi
done

# positional remain
node_name=$1
ip_address=$2 
```

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2017-02-20T21:30:19.627

我编写了一个 bash 助手来编写一个不错的 bash 工具

项目主页：[https ://gitlab.mbedsys.org/mbedsys/bashopts](https://gitlab.mbedsys.org/mbedsys/bashopts)

例子：

```
#!/bin/bash -ei

# load the library
. bashopts.sh

# Enable backtrace dusplay on error
trap 'bashopts_exit_handle' ERR

# Initialize the library
bashopts_setup -n "$0" -d "This is myapp tool description displayed on help message" -s "$HOME/.config/myapprc"

# Declare the options
bashopts_declare -n first_name -l first -o f -d "First name" -t string -i -s -r
bashopts_declare -n last_name -l last -o l -d "Last name" -t string -i -s -r
bashopts_declare -n display_name -l display-name -t string -d "Display name" -e "\$first_name \$last_name"
bashopts_declare -n age -l number -d "Age" -t number
bashopts_declare -n email_list -t string -m add -l email -d "Email adress"

# Parse arguments
bashopts_parse_args "$@"

# Process argument
bashopts_process_args 
```

会提供帮助：

```
NAME:
    ./example.sh - This is myapp tool description displayed on help message

USAGE:
    [options and commands] [-- [extra args]]

OPTIONS:
    -h,--help                          Display this help
    -n,--non-interactive true          Non interactive mode - [$bashopts_non_interactive] (type:boolean, default:false)
    -f,--first "John"                  First name - [$first_name] (type:string, default:"")
    -l,--last "Smith"                  Last name - [$last_name] (type:string, default:"")
    --display-name "John Smith"        Display name - [$display_name] (type:string, default:"$first_name $last_name")
    --number 0                         Age - [$age] (type:number, default:0)
    --email                            Email adress - [$email_list] (type:string, default:"") 
```

请享用 ：）

* * *

## 回答 #26

> 赞同：3
> 
> 时间：2017-03-15T13:24:42.327

这是我的方法 - 使用正则表达式。

*   没有getopts
*   它处理短参数块`-qwerty`
*   它处理短参数`-q -w -e`
*   它处理长选项`--qwerty`
*   您可以将属性传递给短选项或长选项（如果您使用的是短选项块，则属性附加到最后一个选项）
*   您可以使用空格或`=`提供属性，但属性匹配直到遇到连字符+空格“分隔符”，所以 in`--q=qwe ty` `qwe ty`是一个属性
*   它处理以上所有内容的混合，因此`-o a -op attr ibute --option=att ribu te --op-tion attribute --option att-ribute`是有效的

脚本：

```
#!/usr/bin/env sh

help_menu() {
  echo "Usage:

  ${0##*/} [-h][-l FILENAME][-d]

Options:

  -h, --help
    display this help and exit

  -l, --logfile=FILENAME
    filename

  -d, --debug
    enable debug
  "
}

parse_options() {
  case $opt in
    h|help)
      help_menu
      exit
     ;;
    l|logfile)
      logfile=${attr}
      ;;
    d|debug)
      debug=true
      ;;
    *)
      echo "Unknown option: ${opt}\nRun ${0##*/} -h for help.">&2
      exit 1
  esac
}
options=$@

until [ "$options" = "" ]; do
  if [[ $options =~ (^ *(--([a-zA-Z0-9-]+)|-([a-zA-Z0-9-]+))(( |=)(([\_\.\?\/\\a-zA-Z0-9]?[ -]?[\_\.\?a-zA-Z0-9]+)+))?(.*)|(.+)) ]]; then
    if [[ ${BASH_REMATCH[3]} ]]; then # for --option[=][attribute] or --option[=][attribute]
      opt=${BASH_REMATCH[3]}
      attr=${BASH_REMATCH[7]}
      options=${BASH_REMATCH[9]}
    elif [[ ${BASH_REMATCH[4]} ]]; then # for block options -qwert[=][attribute] or single short option -a[=][attribute]
      pile=${BASH_REMATCH[4]}
      while (( ${#pile} > 1 )); do
        opt=${pile:0:1}
        attr=""
        pile=${pile/${pile:0:1}/}
        parse_options
      done
      opt=$pile
      attr=${BASH_REMATCH[7]}
      options=${BASH_REMATCH[9]}
    else # leftovers that don't match
      opt=${BASH_REMATCH[10]}
      options=""
    fi
    parse_options
  fi
done 
```

* * *

## 回答 #27

> 赞同：3
> 
> 时间：2017-10-10T22:49:30.400

假设我们创建了一个名为`test_args.sh`如下的 shell 脚本

```
#!/bin/sh
until [ $# -eq 0 ]
do
  name=${1:1}; shift;
  if [[ -z "$1" || $1 == -* ]] ; then eval "export $name=true"; else eval "export $name=$1"; shift; fi  
done
echo "year=$year month=$month day=$day flag=$flag" 
```

在我们运行以下命令后：

```
sh test_args.sh  -year 2017 -flag  -month 12 -day 22 
```

输出将是：

```
year=2017 month=12 day=22 flag=true 
```

* * *

## 回答 #28

> 赞同：3
> 
> 时间：2020-04-10T12:12:17.030

我想分享我为解析选项所做的事情。这里的答案没有满足我的一些需求，所以我不得不想出这个：[https ://github.com/MihirLuthra/bash_option_parser](https://github.com/MihirLuthra/bash_option_parser)

这支持：

*   子选项解析
*   选项的别名
*   可选参数
*   可变参数
*   打印使用和错误

假设我们有一个名为`fruit`用法的命令，如下所示：

```
fruit <fruit-name> ...
   [-e|—-eat|—-chew]
   [-c|--cut <how> <why>]
   <command> [<args>] 
```

`-e`不带参数
`-c`需要两个参数，即如何切割以及为什么要切割
`fruit`本身至少需要一个参数。
`<command>`用于子选项 like`apple`等`orange`（类似于`git`which has suboptions`commit`等`push`）

所以要解析它：

```
parse_options \
    'fruit'                         '1 ...'  \
    '-e'     , '--eat' , '--chew'   '0'      \
    '-c'     , '--cut'              '1 1'    \
    'apple'                         'S'      \
    'orange'                        'S'      \
    ';' \
    "$@" 
```

现在，如果有任何使用错误，可以使用`option_parser_error_msg`如下方式打印：

```
retval=$?

if [ $retval -ne 0 ]; then
    # this will manage error messages if
    # insufficient or extra args are supplied

    option_parser_error_msg "$retval"

    # This will print the usage
    print_usage 'fruit'
    exit 1
fi 
```

现在检查是否通过了某些选项，

```
if [ -n "${OPTIONS[-c]}" ]
then
    echo "-c was passed"

    # args can be accessed in a 2D-array-like format
    echo "Arg1 to -c = ${ARGS[-c,0]}"
    echo "Arg2 to -c = ${ARGS[-c,1]}"

fi 
```

子选项解析也可以通过传递`$shift_count`给`parse_options_detailed`which 来完成，使其在将 args 移动到子选项的 args 后开始解析。在本[例](https://github.com/MihirLuthra/bash_option_parser/blob/master/example)中进行了演示。

[存储库](https://github.com/MihirLuthra/bash_option_parser)中的自述文件和示例中提供了详细说明。

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2013-07-09T16:51:09.393

使用[bash-modules中的模块“参数”](https://github.com/vlisivka/bash-modules)

例子：

```
#!/bin/bash
. import.sh log arguments

NAME="world"

parse_arguments "-n|--name)NAME;S" -- "$@" || {
  error "Cannot parse command line."
  exit 1
}

info "Hello, $NAME!" 
```

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2019-12-01T11:06:26.090

这是一个 getopts，它以最少的代码实现解析，并允许您使用带有子字符串的 eval 在一种情况下定义您希望提取的内容。

基本上`eval "local key='val'"`

```
function myrsync() {

        local backup=("${@}") args=(); while [[ $# -gt 0 ]]; do k="$1";
                case "$k" in
                    ---sourceuser|---sourceurl|---targetuser|---targeturl|---file|---exclude|---include)
                        eval "local ${k:3}='${2}'"; shift; shift    # Past two arguments
                    ;;
                    *)  # Unknown option  
                        args+=("$1"); shift;                        # Past argument only
                    ;;                                              
                esac                                                
        done; set -- "${backup[@]}"                                 # Restore $@

        echo "${sourceurl}"
} 
```

将变量声明为局部变量而不是全局变量作为此处的大多数答案。

称为：

```
myrsync ---sourceurl http://abc.def.g ---sourceuser myuser ... 
```

${k:3} 基本上是`---`从键中删除第一个的子字符串。

* * *

## 回答 #31

> 赞同：2
> 
> 时间：2020-07-22T23:34:02.770

我写了一个脚本，可以帮助轻松解析命令行参数 - [https://github.com/unfor19/bargs](https://github.com/unfor19/bargs)

### 例子

```
$ bash example.sh -n Willy --gender male -a 99
Name:      Willy
Age:       99
Gender:    male
Location:  chocolate-factory 
```

```
$ bash example.sh -n Meir --gender male
[ERROR] Required argument: age

Usage: bash example.sh -n Willy --gender male -a 99

--person_name  |  -n  [Willy]              What is your name?
--age          |  -a  [Required]
--gender       |  -g  [Required]
--location     |  -l  [chocolate-factory]  insert your location 
```

```
$ bash example.sh -h

Usage: bash example.sh -n Willy --gender male -a 99
--person_name  |  -n  [Willy]              What is your name?
--age          |  -a  [Required]
--gender       |  -g  [Required]
--location     |  -l  [chocolate-factory]  insert your location 
```

* * *

## 回答 #32

> 赞同：2
> 
> 时间：2021-06-13T23:48:12.947

我最终实现了[接受的答案](https://stackoverflow.com/a/14203146/8740349)`dash`的（或`/bin/sh`）版本，基本上没有使用数组：

```
while [[ $# -gt 0 ]]; do
    case "$1" in
    -v|--verbose) verbose=1; shift;;
    -o|--output) if [[ $# -gt 1 && "$2" != -* ]]; then
            file=$2; shift 2
        else
            echo "-o requires file-path" 1>&2; exit 1
        fi ;;
    --)
        while [[ $# -gt 0 ]]; do BACKUP="$BACKUP;$1"; shift; done
        break;;
    *)
        BACKUP="$BACKUP;$1"
        shift
        ;;
    esac
done
# Restore unused arguments.
while [ -n "$BACKUP" ] ; do
    [ ! -z "${BACKUP%%;*}" ] && set -- "$@" "${BACKUP%%;*}"
    [ "$BACKUP" = "${BACKUP/;/}" ] && break
    BACKUP="${BACKUP#*;}"
done 
```

* * *

## 回答 #33

> 赞同：2
> 
> 时间：2021-10-27T10:26:48.120

基于此处的其他答案，这是我的版本：

```
#!/bin/bash
set -e

function parse() {
    for arg in "$@"; do # transform long options to short ones
        shift
        case "$arg" in
            "--name") set -- "$@" "-n" ;;
            "--verbose") set -- "$@" "-v" ;;
            *) set -- "$@" "$arg"
        esac
    done

    while getopts "n:v" optname
    do
        case "$optname" in
            "n") name=${OPTARG} ;;
            "v") verbose=true ;;
        esac
    done
    shift "$((OPTIND-1))" # shift out all the already processed options
}

parse "$@"
echo "hello $name"
if [ ! -z $verbose ]; then echo 'nice to meet you!'; fi 
```

用法：

```
$ ./parse.sh
hello
$ ./parse.sh -n YOUR_NAME
hello YOUR_NAME
$ ./parse.sh -n YOUR_NAME -v
hello YOUR_NAME
nice to meet you!
$ ./parse.sh -v -n YOUR_NAME
hello YOUR_NAME
nice to meet you!
$ ./parse.sh -v
hello 
nice to meet you! 
```

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2014-06-14T18:01:08.403

这也可能很有用：您可以设置一个值，如果有人提供输入，则使用该值覆盖默认值。

`myscript.sh -f ./serverlist.txt` 或者只是`./myscript.sh` （并且它采用默认值）

```
 #!/bin/bash
    # --- set the value, if there is inputs, override the defaults.

    HOME_FOLDER="${HOME}/owned_id_checker"
    SERVER_FILE_LIST="${HOME_FOLDER}/server_list.txt"

    while [[ $# > 1 ]]
    do
    key="$1"
    shift

    case $key in
        -i|--inputlist)
        SERVER_FILE_LIST="$1"
        shift
        ;;
    esac
    done

    echo "SERVER LIST   = ${SERVER_FILE_LIST}" 
```

* * *

## 回答 #35

> 赞同：1
> 
> 时间：2015-10-06T08:53:32.507

这是我使用可变数组对 Bruno Bronosky 答案的改进解决方案。

它允许您混合参数位置并为您提供一个参数数组，在没有选项的情况下保留顺序

```
#!/bin/bash

echo $@

PARAMS=()
SOFT=0
SKIP=()
for i in "$@"
do
case $i in
    -n=*|--skip=*)
    SKIP+=("${i#*=}")
    ;;
    -s|--soft)
    SOFT=1
    ;;
    *)
        # unknown option
        PARAMS+=("$i")
    ;;
esac
done
echo "SKIP            = ${SKIP[@]}"
echo "SOFT            = $SOFT"
    echo "Parameters:"
    echo ${PARAMS[@]} 
```

将输出例如：

```
$ ./test.sh parameter -s somefile --skip=.c --skip=.obj
parameter -s somefile --skip=.c --skip=.obj
SKIP            = .c .obj
SOFT            = 1
Parameters:
parameter somefile 
```

* * *

## 回答 #36

> 赞同：1
> 
> 时间：2015-10-17T21:17:58.797

# 另一个没有 getopt[s]、POSIX、旧 Unix 风格的解决方案

[与Bruno Bronosky 在这里发布的解决方案](https://stackoverflow.com/a/14203146/2261442)类似，这是一个不使用`getopt(s)`.

我的解决方案的主要区别在于它允许将选项连接在一起，就像`tar -xzf foo.tar.gz`等于`tar -x -z -f foo.tar.gz`. 就像 in等一样`tar`，`ps`前导连字符对于短选项块是可选的（但这可以很容易地更改）。也支持长选项（但是当一个块以一个开头时，需要两个前导连字符）。

## 带有示例选项的代码

```
#!/bin/sh

echo
echo "POSIX-compliant getopt(s)-free old-style-supporting option parser from phk@[se.unix]"
echo

print_usage() {
  echo "Usage:

  $0 {a|b|c} [ARG...]

Options:

  --aaa-0-args
  -a
    Option without arguments.

  --bbb-1-args ARG
  -b ARG
    Option with one argument.

  --ccc-2-args ARG1 ARG2
  -c ARG1 ARG2
    Option with two arguments.

" >&2
}

if [ $# -le 0 ]; then
  print_usage
  exit 1
fi

opt=
while :; do

  if [ $# -le 0 ]; then

    # no parameters remaining -> end option parsing
    break

  elif [ ! "$opt" ]; then

    # we are at the beginning of a fresh block
    # remove optional leading hyphen and strip trailing whitespaces
    opt=$(echo "$1" | sed 's/^-\?\([a-zA-Z0-9\?-]*\)/\1/')

  fi

  # get the first character -> check whether long option
  first_chr=$(echo "$opt" | awk '{print substr($1, 1, 1)}')
  [ "$first_chr" = - ] && long_option=T || long_option=F

  # note to write the options here with a leading hyphen less
  # also do not forget to end short options with a star
  case $opt in

    -)

      # end of options
      shift
      break
      ;;

    a*|-aaa-0-args)

      echo "Option AAA activated!"
      ;;

    b*|-bbb-1-args)

      if [ "$2" ]; then
        echo "Option BBB with argument '$2' activated!"
        shift
      else
        echo "BBB parameters incomplete!" >&2
        print_usage
        exit 1
      fi
      ;;

    c*|-ccc-2-args)

      if [ "$2" ] && [ "$3" ]; then
        echo "Option CCC with arguments '$2' and '$3' activated!"
        shift 2
      else
        echo "CCC parameters incomplete!" >&2
        print_usage
        exit 1
      fi
      ;;

    h*|\?*|-help)

      print_usage
      exit 0
      ;;

    *)

      if [ "$long_option" = T ]; then
        opt=$(echo "$opt" | awk '{print substr($1, 2)}')
      else
        opt=$first_chr
      fi
      printf 'Error: Unknown option: "%s"\n' "$opt" >&2
      print_usage
      exit 1
      ;;

  esac

  if [ "$long_option" = T ]; then

    # if we had a long option then we are going to get a new block next
    shift
    opt=

  else

    # if we had a short option then just move to the next character
    opt=$(echo "$opt" | awk '{print substr($1, 2)}')

    # if block is now empty then shift to the next one
    [ "$opt" ] || shift

  fi

done

echo "Doing something..."

exit 0 
```

有关示例用法，请参阅下面的示例。

## 带参数的选项的位置

对于它的价值，带参数的选项不是最后一个（只需要长选项）。因此，例如在`tar`（至少在某些实现中）`f`选项需要放在最后，因为文件名跟随（`tar xzf bar.tar.gz`有效但`tar xfz bar.tar.gz`不有效），这里不是这种情况（参见后面的示例）。

## 带参数的多个选项

作为另一个好处，具有所需选项的参数按选项顺序使用选项参数。只需在此处使用命令行`abc X Y Z`（或`-abc X Y Z`）查看我的脚本的输出：

```
Option AAA activated!
Option BBB with argument 'X' activated!
Option CCC with arguments 'Y' and 'Z' activated! 
```

## 长选项也连接在一起

此外，您还可以在选项块中使用长选项，因为它们最后出现在块中。因此，以下命令行都是等效的（包括处理选项及其参数的顺序）：

*   `-cba Z Y X`
*   `cba Z Y X`
*   `-cb-aaa-0-args Z Y X`
*   `-c-bbb-1-args Z Y X -a`
*   `--ccc-2-args Z Y -ba X`
*   `c Z Y b X a`
*   `-c Z Y -b X -a`
*   `--ccc-2-args Z Y --bbb-1-args X --aaa-0-args`

所有这些导致：

```
Option CCC with arguments 'Z' and 'Y' activated!
Option BBB with argument 'X' activated!
Option AAA activated!
Doing something... 
```

## 不在此解决方案中

### 可选参数

带有可选参数的选项应该可以通过一些工作来实现，例如通过查找是否存在没有连字符的块；然后，用户需要在每个块前面加上一个连字符，然后是一个带有可选参数的参数块。也许这太复杂了，无法与用户交流，所以在这种情况下，最好只需要一个前导连字符。

使用多个可能的参数，事情变得更加复杂。我建议不要通过确定一个参数是否适合它来使选项变得聪明（例如，一个选项只是将一个数字作为一个可选参数），因为这可能会在未来中断。

我个人更喜欢附加选项而不是可选参数。

### 用等号引入的选项参数

就像使用可选参数一样，我不喜欢这个（顺便说一句，有讨论不同参数样式的优缺点的线程吗？）但是如果你想要这个，你可以自己实现它，就像在[http:// mywiki.wooledge.org/BashFAQ/035#Manual_loop](http://mywiki.wooledge.org/BashFAQ/035#Manual_loop)带有一个`--long-with-arg=?*`case语句，然后去掉等号（顺便说一句，这个网站说可以通过一些努力进行参数连接，但是“留下[它]作为读者的练习“这让我相信他们的话，但我从头开始）。

## 其他注意事项

符合 POSIX 标准，甚至适用于我必须处理的古老 Busybox 设置（例如`cut`，`head`和`getopts`缺失）。

* * *

## 回答 #37

> 赞同：1
> 
> 时间：2016-08-08T12:42:47.190

当我尝试时，这个问题的最佳答案似乎有点错误 - 这是我发现更强大的解决方案：

```
boolean_arg=""
arg_with_value=""

while [[ $# -gt 0 ]]
do
key="$1"
case $key in
    -b|--boolean-arg)
    boolean_arg=true
    shift
    ;;
    -a|--arg-with-value)
    arg_with_value="$2"
    shift
    shift
    ;;
    -*)
    echo "Unknown option: $1"
    exit 1
    ;;
    *)
    arg_num=$(( $arg_num + 1 ))
    case $arg_num in
        1)
        first_normal_arg="$1"
        shift
        ;;
        2)
        second_normal_arg="$1"
        shift
        ;;
        *)
        bad_args=TRUE
    esac
    ;;
esac
done

# Handy to have this here when adding arguments to
# see if they're working. Just edit the '0' to be '1'.
if [[ 0 == 1 ]]; then
    echo "first_normal_arg: $first_normal_arg"
    echo "second_normal_arg: $second_normal_arg"
    echo "boolean_arg: $boolean_arg"
    echo "arg_with_value: $arg_with_value"
    exit 0
fi

if [[ $bad_args == TRUE || $arg_num < 2 ]]; then
    echo "Usage: $(basename "$0") <first-normal-arg> <second-normal-arg> [--boolean-arg] [--arg-with-value VALUE]"
    exit 1
fi 
```

* * *

## 回答 #38

> 赞同：1
> 
> 时间：2018-12-16T07:53:48.233

简单易修改，参数可以任意排列。这可以修改为采用任何形式的参数（-a、--a、a 等）。

```
for arg in "$@"
do
   key=$(echo $arg | cut -f1 -d=)`
   value=$(echo $arg | cut -f2 -d=)`
   case "$key" in
        name|-name)      read_name=$value;;
        id|-id)          read_id=$value;;
        *)               echo "I dont know what to do with this"
   ease
done 
```

* * *

## 回答 #39

> 赞同：1
> 
> 时间：2021-03-10T21:32:26.697

我用它从最后迭代**key => value**。第一个可选参数在循环之后被捕获。

用法是 ./script.sh *optional-first-arg* -key value -key2 value2

```
#!/bin/sh

a=$(($#-1))
b=$(($#))
while [ $a -gt 0 ]; do
    eval 'key="$'$a'"; value="$'$b'"'
    echo "$key => $value"
    b=$(($b-2))
    a=$(($a-2))
done
unset a b key value

[ $(($#%2)) -ne 0 ] && echo "first_arg = $1" 
```

当然，您可以从左到右进行一些更改。

此片段代码显示**键 => 值**对和第一个参数（如果存在）。

```
#!/bin/sh

a=$((1+$#%2))
b=$((1+$a))

[ $(($#%2)) -ne 0 ] && echo "first_arg = $1"

while [ $a -lt $# ]; do
    eval 'key="$'$a'"; value="$'$b'"'
    echo "$key => $value"
    b=$(($b+2))
    a=$(($a+2))
done

unset a b key value 
```

使用 100,000 个参数进行测试，速度很快。

您还可以在不使用 eval 的情况下从左到右迭代**key => value**和*第一个可选参数：*

```
#!/bin/sh

a=$(($#%2))
b=0

[ $a -eq 1 ] && echo "first_arg = $1"

for value; do
    if [ $b -gt $a -a $(($b%2)) -ne $a ]; then
        echo "$key => $value"
    fi
    key="$value"
    b=$((1+$b))
done

unset a b key value 
```

# .net - 为数据库层添加额外功能的位置 (Linq-to-SQL)

> ID：192256
> 
> 赞同：2
> 
> 时间：2008-10-10T17:00:15.210
> 
> 标签：.net, linq, linq-to-sql, design-patterns

在使用 Linq-to-SQL 的数据库层中实现额外功能的最佳方法是什么？目前我正在寻找实现基于预设和类似任务添加信息的功能？

插入、更新和删除需要访问您无权访问上下文`DataContext`的类中的和。`Table`我见过使用 Singletons 的解决方案，但它似乎是一个 hack，我想知道是否有其他人遇到过这个问题以及你的解决方案是什么？有没有更好的方法来实现类似的功能。

我希望将此功能添加到数据库层的原因是我有几个应用程序都使用相同的数据库对象，并且我希望能够从所有应用程序中使用这些功能，因此我不必重写很多代码。

* * *

这不是我的意思。我希望能够执行复杂的操作，例如根据第一个表中的信息更新一个表并将记录添加到另一个表。

假设我选择了一条客户记录，我想用信息更新它，当这种情况发生时，我希望它在“更新”表中添加另一条记录，以跟踪更新发生的时间和执行者。这当然只是一个例子。需要做的事情可能更复杂。

基本上我想向表对象添加一个方法来对该表中的特定行进行修改，然后对其他对象进行插入和更新。我知道你可以使用部分类，我已经广泛地这样做了。

例子：

```
db.Customers.Where(c => c.CustomerID == 5).AddOrder(orderDetails); 
```

我觉得我真的无法用语言来表达我的问题以使其易于理解:)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-08-31T07:29:16.847

如果您只是在一般情况下在 linq 或任何类周围添加一些包装器功能之后，您是否可以通过使用静态辅助方法来使用 C# 3 及更高版本中的扩展方法方法：

```
public static class StringExtensions 
{
    public static int ToInt(this string oString)
    {
        return int.Parse(oString);
    }
} 
```

这样你就可以有一个静态帮助器类，提供特定于特定类的帮助器功能，你可以在项目之间移植，或者可能夹入一个单独的 DLL 并在需要的地方导入？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-25T22:48:42.653

Linq to SQL 中的实体类是部分的。你可以用你需要的规则来扩展它们。

或者，您可以构建自己的业务实体，从 Linq 到 SQL 实体。然后，您的业务实体将包含有关何时做什么的规则。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-10T17:23:14.867

我不想这么说，但是存储过程呢？

在我的项目中，无论我们想提供什么额外的功能，我们都坚持使用部分类。数据上下文类被标记为部分，因此您可以将方法添加到上下文中，而不必担心重新生成上下文会破坏您的工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-10T21:28:43.577

您可以将通用数据上下文扩展用于常见的数据访问方法，如插入、删除等，如[http://weblogs.asp.net/stephenwalther/archive/2008/08/26/asp-net-mvc-tip-38-中所述简化-linq-to-sql-with-extension-methods.aspx](http://weblogs.asp.net/stephenwalther/archive/2008/08/26/asp-net-mvc-tip-38-simplify-linq-to-sql-with-extension-methods.aspx)。和 Will 建议的不太常见的功能的部分类。

# c# - 计算工作日/小时左右的日期？

> ID：192260
> 
> 赞同：4
> 
> 时间：2008-10-10T17:01:06.877
> 
> 标签：c#, date

我目前正在一个网站上跟踪项目。在其中，可以创建服务水平协议 (SLA)。这些可配置为项目可以在一周中的哪几天进行，以及每一天的时间跨度。例如。周一可能是 08:00 到 16:00 之间，然后是周五 10:00 到 14:00。它们还根据优先级配置了截止时间。例如。以“低”优先级创建的项目的截止时间为两周，而“高”优先级的项目的截止时间为四个小时。

我遇到的问题是计算前面描述的几个小时左右的截止日期。假设我在星期一 14:00 创建了一个具有“高”优先级的项目。这意味着我有四个小时的时间来完成这个项目。但由于工作时间的关系，我周一有两个小时（直到 16:00），周五还有两个小时。这意味着截止日期必须设置为星期五 12:00。

我花了很多时间在谷歌上搜索，我可以找到很多例子来找出给定的开始结束日期之间有多少工作时间。我只是不知道如何将其转换为 FINDING 结束日期时间，给定开始时间和截止日期前的时间量。

日期/时间跨度以以下格式存储在 sql 数据库中：

日期（例如 1 表示星期一） StartHour EndHour

StartHour/EndHour 保存为 DateTimes，但当然只有时间部分很重要。

我认为它的方式是，我必须以某种方式遍历这些时间并进行一些日期时间计算。我只是无法弄清楚这些计算应该是什么，最好的方法是什么。

我在写这篇文章时在网站上发现[了这个问题](https://stackoverflow.com/questions/5260/what-is-the-best-way-to-wrap-time-around-the-work-day)。这是我想要的，我现在正在玩它，但我仍然不知道如何让它在我动态的工作日/小时内工作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-10T19:46:14.143

这里有一些 C# 代码可能会有所帮助，它可能会更简洁，但它是一个快速的初稿。

```
 class Program
    {
        static void Main(string[] args)
        {
            // Test
            DateTime deadline = DeadlineManager.CalculateDeadline(DateTime.Now, new TimeSpan(4, 0, 0));
            Console.WriteLine(deadline);
            Console.ReadLine();
        }
    }

    static class DeadlineManager
    {
        public static DateTime CalculateDeadline(DateTime start, TimeSpan workhours)
        {
            DateTime current = new DateTime(start.Year, start.Month, start.Day, start.Hour, start.Minute, 0);
            while(workhours.TotalMinutes > 0)
            {
                DayOfWeek dayOfWeek = current.DayOfWeek;
                Workday workday = Workday.GetWorkday(dayOfWeek);
                if(workday == null)
                {
                    DayOfWeek original = dayOfWeek;
                    while (workday == null)
                    {
                        current = current.AddDays(1);
                        dayOfWeek = current.DayOfWeek;
                        workday = Workday.GetWorkday(dayOfWeek);
                        if (dayOfWeek == original)
                        {
                            throw new InvalidOperationException("no work days");
                        }
                    }
                    current = current.AddHours(workday.startTime.Hour - current.Hour);
                    current = current.AddMinutes(workday.startTime.Minute - current.Minute);
                }

                TimeSpan worked = Workday.WorkHours(workday, current);
                if (workhours > worked)
                {
                    workhours = workhours - worked;
                    // Add one day and reset hour/minutes
                    current = current.Add(new TimeSpan(1, current.Hour * -1, current.Minute * -1, 0));
                }
                else
                {
                    current.Add(workhours);
                    return current;
                }
            }
            return DateTime.MinValue;
        }
    }

    class Workday
    {
        private static readonly Dictionary<DayOfWeek, Workday> Workdays = new Dictionary<DayOfWeek, Workday>(7);
        static Workday()
        {
            Workdays.Add(DayOfWeek.Monday, new Workday(DayOfWeek.Monday, new DateTime(1, 1, 1, 10, 0, 0), new DateTime(1, 1, 1, 16, 0, 0)));
            Workdays.Add(DayOfWeek.Tuesday, new Workday(DayOfWeek.Tuesday, new DateTime(1, 1, 1, 10, 0, 0), new DateTime(1, 1, 1, 16, 0, 0)));
            Workdays.Add(DayOfWeek.Wednesday, new Workday(DayOfWeek.Wednesday, new DateTime(1, 1, 1, 10, 0, 0), new DateTime(1, 1, 1, 16, 0, 0)));
            Workdays.Add(DayOfWeek.Thursday, new Workday(DayOfWeek.Thursday, new DateTime(1, 1, 1, 10, 0, 0), new DateTime(1, 1, 1, 16, 0, 0)));
            Workdays.Add(DayOfWeek.Friday, new Workday(DayOfWeek.Friday, new DateTime(1, 1, 1, 10, 0, 0), new DateTime(1, 1, 1, 14, 0, 0)));
        }

        public static Workday GetWorkday(DayOfWeek dayofWeek)
        {
            if (Workdays.ContainsKey(dayofWeek))
            {
                return Workdays[dayofWeek];
            }
            else return null;
        }

        public static TimeSpan WorkHours(Workday workday, DateTime time)
        {
            DateTime sTime = new DateTime(time.Year, time.Month, time.Day,
                workday.startTime.Hour, workday.startTime.Millisecond, workday.startTime.Second);
            DateTime eTime = new DateTime(time.Year, time.Month, time.Day,
                workday.endTime.Hour, workday.endTime.Millisecond, workday.endTime.Second);
            if (sTime < time)
            {
                sTime = time;
            }
            TimeSpan span = eTime - sTime;
            return span;
        }

        public static DayOfWeek GetNextWeekday(DayOfWeek dayOfWeek)
        {
            int i = (dayOfWeek == DayOfWeek.Saturday) ? 0 : ((int)dayOfWeek) + 1;
            return (DayOfWeek)i;
        }

        private Workday(DayOfWeek dayOfWeek, DateTime start, DateTime end)
        {
            this.dayOfWeek = dayOfWeek;
            this.startTime = start;
            this.endTime = end;
        }

        public DayOfWeek dayOfWeek;
        public DateTime startTime;
        public DateTime endTime;
    } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-10T17:17:58.920

有一个可行的递归解决方案，请尝试按照以下思路进行思考：

```
public DateTime getDeadline(SubmitTime, ProjectTimeAllowed)
{
   if (SubmitTime+ProjectTimeAllowed >= DayEndTime)
           return getDeadline(NextDayStart, ProjectTimeAllowed-DayEndTime-SubmitTime)
   else
           return SubmitTime + ProjectTimeAllowed
} 
```

显然这是相当粗糙的伪代码。希望它只是给你另一种方式来思考这个问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-10T19:35:09.500

这就是我将如何做到的。该算法是看今天是否可以关闭问题，如果不能，则使用今天的所有时间来减少问题的剩余时间并转到明天。

1.  找出你必须以 TimeSpan 的形式关闭问题的时间（我称之为问题的剩余时间）
2.  对于每个工作日，创建一个仅包含开始时间和结束时间的 DateTime。
3.  将开始时间设置为现在。
4.  环形：
    1.  通过减去今天的结束时间减去开始时间找到今天的剩余时间（结果应该是 TimeSpan）
    2.  如果今天的剩余时间大于问题的剩余时间，取今天的日期和今天的开始时间+问题的剩余时间
    3.  如果问题的剩余时间较长，则将问题的剩余时间设置为问题的剩余时间减去今天的剩余时间，移动到明天，然后转到循环顶部。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-10T19:43:07.817

使用 Stu 的[回答](https://stackoverflow.com/questions/5260/what-is-the-best-way-to-wrap-time-around-the-work-day#5334)作为起点，修改 IsInBusinessHours 函数以查找日期参数的营业时间。可以使用如下程序：

```
CREATE PROCEDURE [dbo].[IsInBusinessHours]
    @MyDate DateTime 
AS
BEGIN
    SELECT     CASE Count(*) WHEN 0 THEN 0 ELSE 1 END AS IsBusinessHour
FROM         WorkHours
WHERE     (DATEPART(hour, StartHours) <= DATEPART(hour, @MyDate)) AND (DATEPART(hour, EndHours) > DATEPART(hour, @MyDate)) AND (Day = DATEPART(WEEKDAY, 
                      @MyDate))
END 
```

# python - How do I log an exception at warning- or info-level with traceback using the python logging framework?

> ID：192261
> 
> 赞同：63
> 
> 时间：2008-10-10T17:02:08.373
> 
> 标签：python, exception, logging

Using something like this:

```
try:
   # Something...
except Exception as excep:
   logger = logging.getLogger("component")
   logger.warning("something raised an exception: " + excep)
   logger.info("something raised an exception: " + excep) 
```

I would rather not have it on the error-level cause in my special case it is not an error.

* * *

## 回答 #1

> 赞同：100
> 
> 时间：2008-10-10T21:49:50.150

From the [logging documentation](http://docs.python.org/library/logging.html#logging.Logger.debug):

> There are three keyword arguments in `kwargs` which are inspected: `exc_info`, `stack_info`, and `extra`.
> 
> If `exc_info` does not evaluate as false, it causes exception information to be added to the logging message. If an exception tuple (in the format returned by [`sys.exc_info()`](https://docs.python.org/3/library/sys.html#sys.exc_info)) or an exception instance is provided, it is used; otherwise, [`sys.exc_info()`](https://docs.python.org/3/library/sys.html#sys.exc_info) is called to get the exception information.

So do:

```
logger.warning("something raised an exception:", exc_info=True) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-02-05T19:53:02.327

Here is one that works (python 2.6.5).

```
logger.critical("caught exception, traceback =", exc_info=True) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2018-04-23T07:18:30.350

You can try this:

```
from logging import getLogger

logger = getLogger('warning')

try:
    # Somethings that is wrong.

except Exception as exp:
    logger.warning("something raised an exception: " , exc_info=True)
    logger.warning("something raised an exception: {}".format(exp))  # another way 
```

# c# - Asp.Net 静态刷新页面的方法

> ID：192264
> 
> 赞同：2
> 
> 时间：2008-10-10T17:02:42.053
> 
> 标签：c#, asp.net, javascript, static, methods

我有一个页面每 5 秒访问一次网络服务以更新页面上的信息。我正在使用 Ajax Control Toolkit 中的 DynamicPopulateExtender 来使用一些文本填充面板。

我想要做的是，如果满足某个条件，则完全刷新页面。

我能用我现有的方法做到这一点吗？这是我目前的东西：

* * *

ASP.NET

```
<cc1:DynamicPopulateExtender ID="DynamicPopulateExtender1" runat="server"
ClearContentsDuringUpdate="true" TargetControlID="panelQueue" BehaviorID="dp1"
ServiceMethod="GetQueueTable" UpdatingCssClass="dynamicPopulate_Updating" /> 
```

Javascript

```
Sys.Application.add_load(function(){updateQueue();});

    function updateQueue()
    {
        var queueShown = document.getElementById('<%= hiddenFieldQueueShown.ClientID %>').value;

        if(queueShown == 1)
        {
            var behavior = $find('dp1');
            if (behavior)
            {
                behavior.populate();                    
                setTimeout('updateQueue()', 5000);
            }
        }
    } 
```

服务器 (C#)

```
[System.Web.Services.WebMethod]
    [System.Web.Script.Services.ScriptMethod]
    public static string GetQueueTable()
    {
        System.Text.StringBuilder builder = new System.Text.StringBuilder();

        try
        {
             // do stuff
        }
        catch (Exception ex)
        {
             // do stuff
        }

        return builder.ToString();
    } 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-10T17:20:09.273

*   你不能从你的 ASMX 做任何事情。
*   您可以通过使用常规页面重新加载或通过执行服务器端更改然后通过 UpdatePanel 或更简单的 Response.Redirect 进行更新的回发来从 JavaScript 刷新页面。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-10T17:35:59.303

您可以从 Javascript 强制回发，请参阅此 Default.aspx 页面以获取示例：

* * *

## 默认.aspx

```
<html xmlns="http://www.w3.org/1999/xhtml" >
<head runat="server">
    <title>Untitled Page</title>

    <script type="text/javascript" language="javascript">
        function forcePostback()
        {
            <%=getPostBackJavascriptCode()%>;
        }
    </script>

</head>

<body onload="javascript:forcePostback()">
    <form id="form1" runat="server">
    <div>
        <asp:Label ID="Label1" runat="server" Text="Postbacking right now..."></asp:Label>
    </div>
    </form>
</body>
</html> 
```

* * *

## 默认.aspx.cs

```
namespace ForcingApostback
{
    public partial class _Default : System.Web.UI.Page
    {
        protected void Page_Load(object sender, EventArgs e)
        {
            if (IsPostBack) Label1.Text = "Done postbacking!!!";
        }

        protected string getPostBackJavascriptCode()
        {
            return ClientScript.GetPostBackEventReference(this, null);

        }
    }
} 
```

在客户端，在任何情况下，您都可以调用 forcePostback() Javascript 函数来强制回发。

# encryption - SSL 证书加密与密码加密

> ID：192268
> 
> 赞同：8
> 
> 时间：2008-10-10T17:04:26.450
> 
> 标签：encryption, ssl, certificate-authority

我刚刚安装了 SSL 证书。此证书使用 2048 位加密进行加密。

但是，密码是 128 位加密（或 40，或其他一些变体，具体取决于浏览器。）

这里似乎有两种不同类型的加密。2048 的“握手”加密和较小数量级的“有线”加密。

理论上我有这个权利吗？谁能更好地解释一下？

我一直在谷歌上，找不到两者之间区别的明确解释。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-10T17:15:36.367

[维基百科](http://en.wikipedia.org/wiki/Secure_Sockets_Layer#How_it_works)中有一个很好的条目。

你是对的，有两种加密方式。第一个是非对称加密或公钥加密 - 这是具有较大密钥的那个。第二种是使用较小密钥的对称加密。

第一种加密（非对称 - 较大的密钥）用于协商客户端和服务器将使用哪种类型的对称加密。他们还将交换他们将使用的会话密钥。这是握手过程，使用非对称加密进行加密

会话密钥基本上是他们在发送真实数据时使用的密钥，通过他们在握手过程中决定的任何类型进行加密。这是对称加密部分。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-10T17:07:01.733

确实，对称加密的密钥长度通常使用更少的位。原因是对称加密在给定位数上要强得多。

非对称加密（每一方都有不同的密钥）更难实现。它的计算量更大，因此仅用于握手部分或用于加密消息其余部分使用的对称密钥。

# bash - 如何最好地包含其他脚本？

> ID：192292
> 
> 赞同：404
> 
> 时间：2008-10-10T17:14:38.537
> 
> 标签：bash

您通常包含脚本的方式是使用“源”

例如：

主.sh：

```
#!/bin/bash

source incl.sh

echo "The main script" 
```

包括.sh：

```
echo "The included script" 
```

执行“./main.sh”的输出是：

```
The included script
The main script 
```

...现在，如果您尝试从另一个位置执行该 shell 脚本，它无法找到包含，除非它在您的路径中。

确保您的脚本可以找到包含脚本的好方法是什么，尤其是在脚本需要可移植的情况下？

* * *

## 回答 #1

> 赞同：252
> 
> 时间：2008-10-10T17:17:52.290

我倾向于让我的脚本都相互关联。这样我就可以使用目录名：

```
#!/bin/sh

my_dir="$(dirname "$0")"

"$my_dir/other_script.sh" 
```

* * *

## 回答 #2

> 赞同：212
> 
> 时间：2012-10-02T16:15:43.720

我知道我迟到了，但是无论您如何启动脚本并专门使用内置函数，这都应该有效：

```
DIR="${BASH_SOURCE%/*}"
if [[ ! -d "$DIR" ]]; then DIR="$PWD"; fi
. "$DIR/incl.sh"
. "$DIR/main.sh" 
```

`.`(dot) 命令是 的别名`source`，`$PWD`是工作目录的路径，`BASH_SOURCE`是一个数组变量，其成员是源文件名，`${string%substring}`从 $string 后面去除 $substring 的最短匹配

* * *

## 回答 #3

> 赞同：58
> 
> 时间：2008-10-10T18:18:55.363

替代方案：

```
scriptPath=$(dirname $0) 
```

是：

```
scriptPath=${0%/*} 
```

.. 优点是不依赖于 dirname，它不是内置命令（在模拟器中并不总是可用）

* * *

## 回答 #4

> 赞同：47
> 
> 时间：2008-10-10T17:17:55.173

如果它在同一目录中，您可以使用`dirname $0`：

```
#!/bin/bash

source $(dirname $0)/incl.sh

echo "The main script" 
```

* * *

## 回答 #5

> 赞同：32
> 
> 时间：2011-09-23T18:22:28.523

我认为最好的方法是使用 Chris Boran 的方式，但是你应该这样计算 MY_DIR ：

```
#!/bin/sh
MY_DIR=$(dirname $(readlink -f $0))
$MY_DIR/other_script.sh 
```

引用 readlink 的手册页：

> ```
> readlink - display value of a symbolic link
> 
> ...
> 
>   -f, --canonicalize
>         canonicalize  by following every symlink in every component of the given 
>         name recursively; all but the last component must exist 
> ```

我从未遇到过`MY_DIR`计算不正确的用例。如果您通过符号链接访问您的脚本，`$PATH`它就可以工作。

* * *

## 回答 #6

> 赞同：25
> 
> 时间：2015-12-10T17:40:28.580

**这个问题的答案的组合提供了最强大的解决方案。**

它在生产级脚本中为我们工作，对依赖项和目录结构有很好的支持：

```
#!/bin/bash

# 当前脚本的完整路径
THIS=`readlink -f "${BASH_SOURCE[0]}" 2>/dev/null||echo $0`

# 当前脚本所在目录
DIR=`目录名“${THIS}”`

# 'Dot'表示'source'，即'include'：
. “$DIR/编译.sh”
```

**该方法支持所有这些：**

*   **路径中的**空格****
***   **链接**（通过`readlink`）*   `${BASH_SOURCE[0]}`比`$0`**

 *** * *

## 回答 #7

> 赞同：22
> 
> 时间：2009-06-14T13:35:36.683

```
SRC=$(cd $(dirname "$0"); pwd)
source "${SRC}/incl.sh" 
```

* * *

## 回答 #8

> 赞同：16
> 
> 时间：2015-08-12T09:08:28.367

即使脚本是来源的，这也有效：

```
source "$( dirname "${BASH_SOURCE[0]}" )/incl.sh" 
```

* * *

## 回答 #9

> 赞同：12
> 
> 时间：2018-04-07T10:38:14.373

# 1\. 最整洁

我探索了几乎所有的建议，这是最适合我的建议：

`script_root=$(dirname $(readlink -f $0))`

即使脚本符号链接到`$PATH`目录，它也可以工作。

在此处查看实际操作：[https ://github.com/pendashteh/hcagent/blob/master/bin/hcagent](https://github.com/pendashteh/hcagent/blob/master/bin/hcagent)

# 2.最酷的

```
# Copyright https://stackoverflow.com/a/13222994/257479
script_root=$(ls -l /proc/$$/fd | grep "255 ->" | sed -e 's/^.\+-> //') 
```

这实际上来自此页面上的另一个答案，但我也将其添加到我的答案中！

# 3.最可靠的

或者，在极少数情况下那些不起作用，这里是防弹方法：

```
# Copyright http://stackoverflow.com/a/7400673/257479
myreadlink() { [ ! -h "$1" ] && echo "$1" || (local link="$(expr "$(command ls -ld -- "$1")" : '.*-> \(.*\)$')"; cd $(dirname $1); myreadlink "$link" | sed "s|^\([^/].*\)\$|$(dirname $1)/\1|"); }
whereis() { echo $1 | sed "s|^\([^/].*/.*\)|$(pwd)/\1|;s|^\([^/]*\)$|$(which -- $1)|;s|^$|$1|"; } 
whereis_realpath() { local SCRIPT_PATH=$(whereis $1); myreadlink ${SCRIPT_PATH} | sed "s|^\([^/].*\)\$|$(dirname ${SCRIPT_PATH})/\1|"; } 

script_root=$(dirname $(whereis_realpath "$0")) 
```

`taskrunner`您可以在源代码中看到它的实际效果： [https ://github.com/pendashteh/taskrunner/blob/master/bin/taskrunner](https://github.com/pendashteh/taskrunner/blob/master/bin/taskrunner)

希望这可以帮助那里的人:)

另外，如果对您不起作用，请留下评论并提及您的操作系统和模拟器。谢谢！

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2008-10-10T17:32:52.040

您需要指定其他脚本的位置，没有其他方法可以解决。我建议在脚本顶部使用一个可配置变量：

```
#!/bin/bash
installpath=/where/your/scripts/are

. $installpath/incl.sh

echo "The main script" 
```

或者，您可以坚持让用户维护一个环境变量，指示您的程序主目录在哪里，例如 PROG_HOME 或类似的东西。这可以通过在 /etc/profile.d/ 中创建包含该信息的脚本来自动为用户提供，每次用户登录时都会获取该信息。

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2008-10-10T17:18:51.867

我建议您创建一个 setenv 脚本，其唯一目的是为系统中的各种组件提供位置。

然后，所有其他脚本将获取此脚本，以便使用 setenv 脚本的所有脚本中的所有位置都是通用的。

这在运行 cronjobs 时非常有用。运行 cron 时你会得到一个最小的环境，但是如果你让所有的 cron 脚本首先包含 setenv 脚本，那么你就可以控制和同步你希望 cronjobs 执行的环境。

我们在构建猴子上使用了这种技术，用于在大约 2,000 kSLOC 的项目中进行持续集成。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2010-09-11T18:14:40.500

**[Shell Script Loader](http://loader.sourceforge.net/)**是我的解决方案。

它提供了一个名为 include() 的函数，可以在许多脚本中多次调用该函数来引用单个脚本，但只会加载一次脚本。该函数可以接受完整路径或部分路径（在搜索路径中搜索脚本）。还提供了一个名为 load() 的类似函数，它将无条件加载脚本。

它适用于**bash**、**ksh**、**pd ksh**和**zsh ，**每个脚本都经过优化；以及其他通常与原始 sh 兼容的 shell，如**ash**、**dash**、**heirloom sh**等，通过通用脚本自动优化其功能，具体取决于 shell 可以提供的功能。

**[转发示例]**

**启动.sh**

这是一个可选的启动脚本。将启动方法放在这里只是为了方便，可以放在主脚本中。如果要编译脚本，也不需要此脚本。

```
#!/bin/sh

# load loader.sh
. loader.sh

# include directories to search path
loader_addpath /usr/lib/sh deps source

# load main script
load main.sh 
```

**主文件**

```
include a.sh
include b.sh

echo '---- main.sh ----'

# remove loader from shellspace since
# we no longer need it
loader_finish

# main procedures go from here

# ... 
```

**灰**

```
include main.sh
include a.sh
include b.sh

echo '---- a.sh ----' 
```

**b.sh**

```
include main.sh
include a.sh
include b.sh

echo '---- b.sh ----' 
```

**输出：**

```
---- b.sh ----
---- a.sh ----
---- main.sh ---- 
```

最好的是基于它的脚本也可以用可用的编译器编译成单个脚本。

这是一个使用它的项目：http: [//sourceforge.net/p/playshell/code/ci/master/tree/](http://sourceforge.net/p/playshell/code/ci/master/tree/)。它可以在编译或不编译脚本的情况下可移植地运行。也可以编译生成单个脚本，这在安装过程中很有帮助。

我还为任何可能希望简要了解实现脚本如何工作的保守派创建了一个更简单的原型：[https ://sourceforge.net/p/loader/code/ci/base/tree/loader-include-prototype .bash](https://sourceforge.net/p/loader/code/ci/base/tree/loader-include-prototype.bash)。它很小，如果他们的代码打算与 Bash 4.0 或更高版本一起运行，并且它也不使用`eval`.

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-10-11T11:35:12.637

Steve 的回复绝对是正确的技术，但应该重构它，以便您的 installpath 变量位于一个单独的环境脚本中，所有此类声明都在其中进行。

然后所有脚本都来自该脚本并且应该更改安装路径，您只需在一个位置更改它。让事情变得更加，呃，面向未来。上帝我讨厌这个词！（-：

顺便说一句，在以示例中所示的方式使用变量时，您应该真正使用 ${installpath} 来引用变量：

```
. ${installpath}/incl.sh 
```

如果大括号被忽略，一些 shell 会尝试扩展变量“installpath/incl.sh”！

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2015-06-04T21:22:43.900

这应该可靠地工作：

```
source_relative() {
 local dir="${BASH_SOURCE%/*}"
 [[ -z "$dir" ]] && dir="$PWD"
 source "$dir/$1"
}

source_relative incl.sh 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2010-10-28T22:41:47.527

我将所有启动脚本都放在了 .bashrc.d 目录中。这是 /etc/profile.d 等地方的常用技术。

```
while read file; do source "${file}"; done <<HERE
$(find ${HOME}/.bashrc.d -type f)
HERE 
```

使用通配符的解决方案的问题...

```
for file in ${HOME}/.bashrc.d/*.sh; do source ${file};done 
```

...您是否可能有一个“太长”的文件列表。像...这样的方法

```
find ${HOME}/.bashrc.d -type f | while read file; do source ${file}; done 
```

...运行但不会根据需要更改环境。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2012-11-04T21:14:58.897

使用 source 或 $0 不会为您提供脚本的真实路径。您可以使用脚本的进程 ID 来检索其真实路径

```
ls -l       /proc/$$/fd           | 
grep        "255 ->"            |
sed -e      's/^.\+-> //' 
```

我正在使用这个脚本，它一直对我很有帮助:)

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2014-11-04T02:58:13.277

当然，每个人都有自己的想法，但我认为下面的块是相当稳固的。我相信这涉及到查找目录的“最佳”方式，以及调用另一个 bash 脚本的“最佳”方式：

```
scriptdir=`dirname "$BASH_SOURCE"`
source $scriptdir/incl.sh

echo "The main script" 
```

所以这可能是包含其他脚本的“最佳”方式。这是基于另一个“最佳”答案，它[告诉 bash 脚本它的存储位置](https://stackoverflow.com/questions/59895/can-a-bash-script-tell-what-directory-its-stored-in)

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2018-08-10T09:29:03.230

个人将所有库放在一个`lib`文件夹中，并使用一个`import`函数来加载它们。

*文件夹结构*

[![在此处输入图像描述](https://i.stack.imgur.com/2NPbb.png)](https://i.stack.imgur.com/2NPbb.png)

*`script.sh`内容*

```
# Imports '.sh' files from 'lib' directory
function import()
{
  local file="./lib/$1.sh"
  local error="\e[31mError: \e[0mCannot find \e[1m$1\e[0m library at: \e[2m$file\e[0m"
  if [ -f "$file" ]; then
     source "$file"
    if [ -z $IMPORTED ]; then
      echo -e $error
      exit 1
    fi
  else
    echo -e $error
    exit 1
  fi
} 
```

请注意，此导入功能应位于脚本的开头，然后您可以轻松地导入库，如下所示：

```
import "utils"
import "requirements" 
```

在每个库的顶部添加一行（即 utils.sh）：

```
IMPORTED="$BASH_SOURCE" 
```

现在您可以访问内部`utils.sh`和外部`requirements.sh`的功能`script.sh`

TODO：编写链接器来构建单个`sh`文件

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2014-01-16T13:35:51.197

我们只需要找出存放我们的 incl.sh 和 main.sh 的文件夹；只需更改您的 main.sh ：

主文件

```
#!/bin/bash

SCRIPT_NAME=$(basename $0)
SCRIPT_DIR="$(echo $0| sed "s/$SCRIPT_NAME//g")"
source $SCRIPT_DIR/incl.sh

echo "The main script" 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2019-07-06T20:26:25.633

根据[`man hier`](http://man7.org/linux/man-pages/man7/hier.7.html)脚本的合适位置包括`/usr/local/lib/`

> /usr/local/lib
> 
> 与本地安装的程序相关的文件。

我个人更喜欢`/usr/local/lib/bash/includes`包含。有[bash-helper](https://github.com/nafigator/bash-helpers#features) lib 用于以这种方式包含库：

```
#!/bin/bash

. /usr/local/lib/bash/includes/bash-helpers.sh

include api-client || exit 1                   # include shared functions
include mysql-status/query-builder || exit 1   # include script functions

# include script functions with status message
include mysql-status/process-checker; status 'process-checker' $? || exit 1
include mysql-status/nonexists; status 'nonexists' $? || exit 1 
```

[![bash-helpers 包括状态输出](https://i.stack.imgur.com/7Q3lF.jpg)](https://i.stack.imgur.com/7Q3lF.jpg)

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2021-02-25T15:42:31.543

我在这里看到的大多数答案似乎都使​​事情变得过于复杂。这种方法对我来说一直很可靠：

```
FULLPATH=$(readlink -f $0)
INCPATH=${FULLPATH%/*} 
```

INCPATH 将保存脚本的完整路径，不包括脚本文件名，无论脚本如何调用（通过 $PATH、相对或绝对）。

之后，只需执行此操作即可将文件包含在同一目录中：

```
. $INCPATH/file_to_include.sh 
```

参考：[TecPorto / 位置无关包括](https://tecporto.pt/wiki/index.php/Location_independent_includes)

* * *

## 回答 #22

> 赞同：-5
> 
> 时间：2010-11-19T16:13:32.770

您还可以使用：

```
PWD=$(pwd)
source "$PWD/inc.sh" 
```

# windows - 如何在 GUI 应用程序中写入控制台

> ID：192294
> 
> 赞同：6
> 
> 时间：2008-10-10T17:15:32.667
> 
> 标签：windows, winapi, console-application

背景：我们开发win32应用程序，并在windows上使用“Thompson Toolkit”为我们提供了一个类似unix的shell，我们将其用作我们的命令行。

我们有一个要写入控制台的 GUI 程序（带有 WinMain 和消息循环），但是 printf 等不起作用，即使我们从控制台启动程序也是如此。我们如何从 GUI 程序写入控制台？我们需要在那里打印文本，以便自动构建系统可以显示错误消息等。

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-10T17:17:04.147

简而言之，您需要附加一个控制台。有关详细信息和准备使用的代码，请参阅[http://www.codeproject.com/KB/dialog/ConsoleAdapter.aspx](http://www.codeproject.com/KB/dialog/ConsoleAdapter.aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-02-14T09:40:39.570

基本上你必须自己用`AllocConsole`,来创建一个控制台`AttachConsole`。之后，您必须`GetStdHandle`在`_open_osfhandle`.

返回的句柄可用于覆盖 crt`stdin`和`stdout`. 之后，所有 crt 方法都`printf`应该工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-10T17:24:15.100

不要登录到控制台，而是登录到文件，然后使用单独的 gui 应用程序跟踪文件。这使控制台保持整洁，并为您提供更持久的日志记录，这有时非常有用。有各种库可以为您完成大部分工作，或者您可以保持简单并自己做。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-10T17:22:31.610

假设您使用的是 VS，则可以在 Visual Studio 项目设置中的某处打开控制台。（不能说在哪里，因为我目前没有）

# c# - 关闭不同线程时在其他窗口后面发送的应用程序窗口（C#）

> ID：192313
> 
> 赞同：15
> 
> 时间：2008-10-10T17:19:20.150
> 
> 标签：c#, winforms, multithreading, splash-screen

我正在用 C#.NET 编写一个 Windows 窗体应用程序

启动时，应用程序会显示一个启动屏幕，该屏幕在单独的线程中运行。在显示初始屏幕时，主应用程序正在初始化。

主应用程序完成初始化后，将显示应用程序的主窗体，并且启动屏幕仍显示在顶部。

到目前为止，一切都符合预期。

然后，启动屏幕关闭，导致该线程退出。出于某种原因，此时，主应用程序窗口被发送到所有其他打开的 Windows 之后，特别是 Windows 资源管理器窗口，您首先单击 .exe 文件来运行应用程序！

是什么导致窗户突然像这样跳到“后面”？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-10T17:21:17.383

当你的线程关闭时，尝试在你的主窗口上调用 .Activate() 。

它从未激活过，因此 Z-Order 较低，因此更高的自然会高于它。我必须在我们的应用程序中修复这个确切的场景。

不要忘记！您可能需要使用 Invoke() 将调用编组到正确的线程！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-10T17:43:33.593

我也有过这种情况。Bob 的回答是最简单的，并且在大多数情况下对我有用。但是，有时我需要使用蛮力。通过互操作执行此操作，如下所示：

[DllImport("user32.dll")] public static extern bool SetForegroundWindow(IntPtr hWnd);

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-10T18:18:50.870

启动画面是模态对话框吗？

如果您通过设置 DialogResult 并调用 Hide() 或 close() 两次关闭模态对话框，我已经看到此窗口“跳跃”。

像这样的代码：

```
private void button1_Click(object sender, System.EventArgs e)
{
     this.DialogResult = DialogResult.Abort;
     this.Hide();
} 
```

有关所有案例，请参阅[此](http://jacco.greydesk.com/20070710.html)博客条目...

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2010-05-29T02:35:24.277

您可以使用这样的代码：

```
private void button1_Click(object sender, System.EventArgs e)
{
     this.DialogResult = DialogResult.Abort;
     this.Hide();
} 
```

谢谢大家！

# linux - 我如何知道 Bash 脚本中的脚本文件名？

> ID：192319
> 
> 赞同：703
> 
> 时间：2008-10-10T17:20:41.503
> 
> 标签：linux, bash, shell, scripting

如何确定脚本本身内的 Bash 脚本文件的名称？

就像我的脚本在文件中一样`runme.sh`，那么我如何让它显示“您正在运行 runme.sh”消息而不进行硬编码？

* * *

## 回答 #1

> 赞同：725
> 
> 时间：2008-10-10T17:23:08.660

```
me=`basename "$0"` 
```

要阅读符号链接¹，这通常不是您想要的（您通常不想以这种方式混淆用户），请尝试：

```
me="$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" 
```

IMO，这会产生令人困惑的输出。“我运行了 foo.sh，但它说我在运行 bar.sh！？一定是一个错误！” 此外，使用不同名称的符号链接的目的之一是根据它的名称提供不同的功能（想想某些平台上的 gzip 和 gunzip）。

* * *

¹也就是说，要解析符号链接，以便当用户执行`foo.sh`实际上是指向 的符号链接时`bar.sh`，您希望使用解析后的名称`bar.sh`而不是`foo.sh`.

* * *

## 回答 #2

> 赞同：283
> 
> 时间：2010-08-28T00:35:12.560

```
＃  -  -  -  -  -  - - 脚本  -  -  -  -  -  - - ＃
 #!/bin/bash

echo
echo "# arguments called with ---->  ${@}     "
echo "# \$1 ---------------------->  $1       "
echo "# \$2 ---------------------->  $2       "
echo "# path to me --------------->  ${0}     "
echo "# parent path -------------->  ${0%/*}  "
echo "# my name ------------------>  ${0##*/} "
echo
exit 
# ------------- 调用 ------------- #

# 注意下一行，第一个参数在 double 中调用，
# 和单引号，因为它包含两个单词

$ /misc/shell_scripts/check_root/show_parms.sh "'你好'" "'william'"

＃  -  -  -  -  -  - - 结果  -  -  -  -  -  - - ＃

# 使用 ---> 'hello there' 'william' 调用的参数
# $1 ----------------------> '你好'
# $2 ----------------------> '威廉'
# 我的路径 --------------> /misc/shell_scripts/check_root/show_parms.sh
# 父路径 -------------> /misc/shell_scripts/check_root
# 我的名字 -----------------> show_parms.sh

＃  -  -  -  -  -  - - 结尾  -  -  -  -  -  - - ＃

```

* * *

## 回答 #3

> 赞同：218
> 
> 时间：2009-03-12T16:48:42.713

使用*bash >= 3*以下工作：

```
$ ./s
0 is: ./s
BASH_SOURCE is: ./s
$ . ./s
0 is: bash
BASH_SOURCE is: ./s

$ cat s
#!/bin/bash

printf '$0 is: %s\n$BASH_SOURCE is: %s\n' "$0" "$BASH_SOURCE" 
```

* * *

## 回答 #4

> 赞同：104
> 
> 时间：2011-06-15T09:27:45.737

`$BASH_SOURCE`采购脚本时给出正确答案。

但是，这包括路径，因此要仅获取脚本文件名，请使用：

```
$(basename $BASH_SOURCE) 
```

* * *

## 回答 #5

> 赞同：70
> 
> 时间：2008-10-10T17:26:04.207

如果脚本名称中包含空格，则更可靠的方法是在 MacOS 上使用`"$0"`or - 或： . 这可以防止名称以任何方式被破坏或解释。通常，在 shell 中始终用双引号引起变量名是一种很好的做法。`"$(basename "$0")"``"$(basename \"$0\")"`

* * *

## 回答 #6

> 赞同：30
> 
> 时间：2008-10-10T19:14:34.113

如果你想要它没有路径，那么你会使用`${0##*/}`

* * *

## 回答 #7

> 赞同：22
> 
> 时间：2008-10-10T18:21:14.877

要回答[Chris Conway](https://stackoverflow.com/questions/192319/in-the-bash-script-how-do-i-know-the-script-file-name#192440)，在 Linux 上（至少）你会这样做：

```
echo $(basename $(readlink -nf $0)) 
```

readlink 打印出符号链接的值。如果它不是符号链接，它会打印文件名。-n 告诉它不打印换行符。-f 告诉它完全跟随链接（如果符号链接是指向另一个链接的链接，它也会解析那个链接）。

* * *

## 回答 #8

> 赞同：18
> 
> 时间：2014-08-31T20:59:57.837

我发现这一行总是有效的，无论文件是作为脚本获取还是作为脚本运行。

```
echo "${BASH_SOURCE[${#BASH_SOURCE[@]} - 1]}" 
```

如果您想`readlink`在上面的路径上使用符号链接，递归或非递归。

单线工作的原因是通过使用`BASH_SOURCE`环境变量及其关联来解释的`FUNCNAME`。

> BASH_SOURCE
> 
> 一个数组变量，其成员是源文件名，其中定义了 FUNCNAME 数组变量中的相应 shell 函数名称。shell 函数 ${FUNCNAME[$i]} 在文件 ${BASH_SOURCE[$i]} 中定义并从 ${BASH_SOURCE[$i+1]} 调用。
> 
> 功能名称
> 
> 一个数组变量，包含当前在执行调用堆栈中的所有 shell 函数的名称。索引为 0 的元素是任何当前正在执行的 shell 函数的名称。最底部的元素（索引最高的元素）是“main”。此变量仅在执行 shell 函数时存在。对 FUNCNAME 的分配无效并返回错误状态。如果未设置 FUNCNAME，它将失去其特殊属性，即使它随后被重置。
> 
> 此变量可与 BASH_LINENO 和 BASH_SOURCE 一起使用。FUNCNAME 的每个元素在 BASH_LINENO 和 BASH_SOURCE 中都有对应的元素来描述调用堆栈。例如，从文件 ${BASH_SOURCE[$i+1]} 的行号 ${BASH_LINENO[$i]} 调用 ${FUNCNAME[$i]}。内置调用者使用此信息显示当前调用堆栈。

[来源：Bash 手册]

* * *

## 回答 #9

> 赞同：12
> 
> 时间：2009-03-12T15:34:18.727

这些答案对于他们陈述的情况是正确的，但是如果您使用“source”关键字从另一个脚本运行脚本（以便它在同一个 shell 中运行），仍然存在问题。在这种情况下，您将获得调用脚本的 $0。在这种情况下，我认为不可能获得脚本本身的名称。

这是一个边缘情况，不应太认真。如果您直接从另一个脚本运行脚本（没有“源”），则使用 $0 将起作用。

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2018-02-05T18:12:40.803

由于一些评论询问了不带扩展名的文件名，下面是一个如何实现的示例：

```
FileName=${0##*/}
FileNameWithoutExtension=${FileName%.*} 
```

享受！

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2010-10-15T05:25:25.443

回复：上面 Tanktalus 的（已接受）答案，一种更清洁的方法是使用：

```
me=$(readlink --canonicalize --no-newline $0) 
```

如果您的脚本来自另一个 bash 脚本，您可以使用：

```
me=$(readlink --canonicalize --no-newline $BASH_SOURCE) 
```

我同意如果您的目标是向用户提供反馈，那么取消引用符号链接会令人困惑，但有时您确实需要将规范名称获取到脚本或其他文件，这是最好的方法，imo。

* * *

## 回答 #12

> 赞同：9
> 
> 时间：2012-11-14T16:28:35.193

```
this="$(dirname "$(realpath "$BASH_SOURCE")")" 
```

这会解析符号链接（realpath 执行此操作），处理空格（双引号执行此操作），并且即使在来源（. ./myscript）或由其他脚本调用（$BASH_SOURCE 处理）时也会找到当前脚本名称。毕竟，最好将其保存在环境变量中以供重复使用或在其他地方轻松复制（this=）...

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2008-10-10T17:24:20.200

您可以使用 $0 来确定您的脚本名称（带有完整路径） - 要获取脚本名称，您可以使用修剪该变量

```
basename $0 
```

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2017-01-25T02:50:44.810

如果你的调用 shell 脚本像

```
/home/mike/runme.sh 
```

$0 是全名

```
 /home/mike/runme.sh 
```

basename $0 将获取基本文件名

```
 runme.sh 
```

你需要把这个基本名称放入一个变量中，比如

```
filename=$(basename $0) 
```

并添加您的附加文本

```
echo "You are running $filename" 
```

所以你的脚本喜欢

```
/home/mike/runme.sh
#!/bin/bash 
filename=$(basename $0)
echo "You are running $filename" 
```

* * *

## 回答 #15

> 赞同：8
> 
> 时间：2020-10-24T18:43:37.313

这适用于`./self.sh`, `~/self.sh`, `source self.sh`, `source ~/self.sh`:

```
#!/usr/bin/env bash

self=$(readlink -f "${BASH_SOURCE[0]}")
basename=$(basename "$self")

echo "$self"
echo "$basename" 
```

学分：我结合了多个答案来得到这个。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2017-08-13T07:06:42.323

```
echo "$(basename "`test -L ${BASH_SOURCE[0]} \
                   && readlink ${BASH_SOURCE[0]} \
                   || echo ${BASH_SOURCE[0]}`")" 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2018-01-19T15:06:45.993

在`bash`您可以使用`$0`. 通常`$1`，`$2`等是访问 CLI 参数。同样`$0`是访问触发脚本的名称（脚本文件名）。

```
#!/bin/bash
echo "You are running $0"
...
... 
```

如果您使用路径调用脚本，`/path/to/script.sh`那么`$0`也会给出带有路径的文件名。在那种情况下需要使用`$(basename $0)`来获取脚本文件名。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2019-08-19T09:15:48.560

简短、清晰、简单，在`my_script.sh`

```
#!/bin/bash

running_file_name=$(basename "$0")

echo "You are running '$running_file_name' file." 
```

输出：

```
./my_script.sh
You are running 'my_script.sh' file. 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2015-02-22T06:50:03.690

信息感谢比尔埃尔南德斯。我添加了一些我正在采用的偏好。

```
#!/bin/bash
function Usage(){
    echo " Usage: show_parameters [ arg1 ][ arg2 ]"
}
[[ ${#2} -eq 0 ]] && Usage || {
    echo
    echo "# arguments called with ---->  ${@}     "
    echo "# \$1 ----------------------->  $1       "
    echo "# \$2 ----------------------->  $2       "
    echo "# path to me --------------->  ${0}     " | sed "s/$USER/\$USER/g"
    echo "# parent path -------------->  ${0%/*}  " | sed "s/$USER/\$USER/g"
    echo "# my name ------------------>  ${0##*/} "
    echo
} 
```

干杯

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2018-11-24T12:00:12.747

这是我的想法，灵感来自[Dimitre Radoulov](https://stackoverflow.com/users/430749/dimitre-radoulov)的回答*（顺便说一句，我赞成）*。

```
script="$BASH_SOURCE"
[ -z "$BASH_SOURCE" ] && script="$0"

echo "Called $script with $# argument(s)" 
```

无论您调用脚本的方式如何

```
. path/to/script.sh 
```

或者

```
./path/to/script.sh 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2021-07-31T06:22:50.990

$0 将给出您正在运行的脚本的名称。创建一个脚本文件并添加以下代码

```
#!/bin/bash
echo "Name of the file is $0" 
```

然后像这样从终端运行

```
./file_name.sh 
```

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2008-10-10T17:23:19.877

echo "你正在运行 $0"

* * *

## 回答 #23

> 赞同：-1
> 
> 时间：2011-04-28T09:11:05.360

```
DIRECTORY=$(cd `dirname $0` && pwd) 
```

我从另一个 Stack Overflow 问题中得到了上述信息，*[Bash 脚本可以告诉它存储在哪个目录中吗？](https://stackoverflow.com/questions/59895)*，但我认为它对这个主题也很有用。

* * *

## 回答 #24

> 赞同：-7
> 
> 时间：2015-04-16T10:32:16.837

像这样的东西？

```
export LC_ALL=en_US.UTF-8
#!/bin/bash
#!/bin/sh

#----------------------------------------------------------------------
start_trash(){
ver="htrash.sh v0.0.4"
$TRASH_DIR  # url to trash $MY_USER
$TRASH_SIZE # Show Trash Folder Size

echo "Would you like to empty Trash  [y/n]?"
read ans
if [ $ans = y -o $ans = Y -o $ans = yes -o $ans = Yes -o $ans = YES ]
then
echo "'yes'"
cd $TRASH_DIR && $EMPTY_TRASH
fi
if [ $ans = n -o $ans = N -o $ans = no -o $ans = No -o $ans = NO ]
then
echo "'no'"
fi
 return $TRUE
} 
#-----------------------------------------------------------------------

start_help(){
echo "HELP COMMANDS-----------------------------"
echo "htest www                 open a homepage "
echo "htest trash               empty trash     "
 return $TRUE
} #end Help
#-----------------------------------------------#

homepage=""

return $TRUE
} #end cpdebtemp

# -Case start
# if no command line arg given
# set val to Unknown
if [ -z $1 ]
then
  val="*** Unknown  ***"
elif [ -n $1 ]
then
# otherwise make first arg as val
  val=$1
fi
# use case statement to make decision for rental
case $val in
   "trash") start_trash ;;
   "help") start_help ;;
   "www") firefox $homepage ;;
   *) echo "Sorry, I can not get a $val   for you!";;
esac
# Case stop 
```

# c# - 简单的 WPF 示例导致不受控制的内存增长

> ID：192329
> 
> 赞同：13
> 
> 时间：2008-10-10T17:22:19.190
> 
> 标签：c#, wpf, memory-leaks

我已经将我在我的一个应用程序中看到的一个问题归结为一个非常简单的复制样本。我需要知道是否有什么不对劲或我错过了什么。

无论如何，下面是代码。行为是代码在内存中运行并稳定增长，直到它因 OutOfMemoryException 而崩溃。这需要一段时间，但行为是正在分配对象并且没有被垃圾收集。

我已经进行了内存转储并在一些事情上运行了 !gcroot 并使用 ANTS 来找出问题所在，但我已经研究了一段时间并且需要一些新的眼光。

此复制示例是一个简单的控制台应用程序，它创建一个 Canvas 并向其添加一个 Line。它不断地这样做。这就是代码所做的全部。它时不时地休眠以确保 CPU 不会因为过度使用而导致系统无响应（并确保 GC 无法运行时不会出现异常情况）。

有人有什么想法吗？我仅使用 .NET 3.0、.NET 3.5 和 .NET 3.5 SP1 进行了尝试，并且在所有三个环境中都发生了相同的行为。

另请注意，我也将此代码放入了 WPF 应用程序项目中，并在单击按钮时触发了代码，它也发生在那里。

```
使用系统；
使用 System.Collections.Generic；
使用 System.Linq；
使用 System.Text；
使用 System.Windows.Controls；
使用 System.Windows.Shapes；
使用 System.Windows；

命名空间 SimplestReproSample
{
    课堂节目
    {
        [STA线程]
        静态无效主要（字符串 [] 参数）
        {
            长计数 = 0;
            而（真）
            {
                如果（计数++ % 100 == 0）
                {
                    // 休眠一段时间以确保我们没有用完整个 CPU
                    System.Threading.Thread.Sleep(50);
                }
                构建画布（）；
            }
        }

        [System.Runtime.CompilerServices.MethodImpl(System.Runtime.CompilerServices.MethodImplOptions.NoInlining)]
        私有静态无效 BuildCanvas()
        {
            画布 c = 新画布（）；

            线线 = 新线（）；
            线.X1 = 1;
            线.Y1 = 1;
            线.X2 = 100;
            线.Y2 = 100;
            line.Width = 100;
            c.Children.Add(line);

            c.Measure(新尺寸(300, 300));
            c.Arrange(新矩形(0, 0, 300, 300));
        }
    }
}

```

注意：下面的第一个答案有点偏离基础，因为我已经明确指出在 WPF 应用程序的按钮单击事件期间会发生同样的行为。但是，我没有明确说明在那个应用程序中我只进行了有限次数的迭代（比如 1000 次）。这样做可以让 GC 在您单击应用程序时运行。另请注意，我明确表示我已经进行了内存转储，并发现我的对象是通过 !gcroot 植根的。我也不同意 GC 将无法运行。GC 不在我的控制台应用程序的主线程上运行，特别是因为我在双核机器上，这意味着 Concurrent Workstation GC 处于活动状态。然而，消息泵，是的。

为了证明这一点，这里有一个在 DispatcherTimer 上运行测试的 WPF 应用程序版本。它在 100 毫秒的计时器间隔内执行 1000 次迭代。有足够的时间来处理来自泵的任何消息并保持较低的 CPU 使用率。

```
使用系统；
使用 System.Collections.Generic；
使用 System.Linq；
使用 System.Text；
使用 System.Windows；
使用 System.Windows.Controls；
使用 System.Windows.Shapes；

命名空间 SimpleReproSampleWpfApp
{
    公共部分类 Window1：窗口
    {
        私有 System.Windows.Threading.DispatcherTimer _timer;

        公共窗口1（）
        {
            初始化组件（）；

            _timer = new System.Windows.Threading.DispatcherTimer();
            _timer.Interval = TimeSpan.FromMilliseconds(100);
            _timer.Tick += new EventHandler(_timer_Tick);
            _timer.Start();
        }

        [System.Runtime.CompilerServices.MethodImpl(System.Runtime.CompilerServices.MethodImplOptions.NoInlining)]
        无效运行测试（）
        {
            for (int i = 0; i < 1000; i++)
            {
                构建画布（）；
            }
        }

        [System.Runtime.CompilerServices.MethodImpl(System.Runtime.CompilerServices.MethodImplOptions.NoInlining)]
        私有静态无效 BuildCanvas()
        {
            画布 c = 新画布（）；

            线线 = 新线（）；
            线.X1 = 1;
            线.Y1 = 1;
            线.X2 = 100;
            线.Y2 = 100;
            line.Width = 100;
            c.Children.Add(line);

            c.Measure(新尺寸(300, 300));
            c.Arrange(新矩形(0, 0, 300, 300));
        }

        void _timer_Tick（对象发送者，EventArgs e）
        {
            _timer.Stop();

            运行测试（）；

            _timer.Start();
        }
    }
}

```

注意2：我使用了第一个答案中的代码，我的记忆增长非常缓慢。请注意，1ms 比我的示例慢得多，迭代次数也少得多。在开始注意到增长之前，您必须让它运行几分钟。5 分钟后，它从 30MB 的起点变为 46MB。

注意3：删除对 .Arrange 的调用完全消除了增长。不幸的是，该调用对我的使用非常重要，因为在许多情况下，我是从 Canvas（通过 RenderTargetBitmap 类）创建 PNG 文件。如果没有调用 .Arrange 它根本不会布局画布。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-11T02:17:13.450

我能够使用您提供的代码重现您的问题。内存不断增长，因为 Canvas 对象从未被释放；内存分析器表明 Dispatcher 的 ContextLayoutManager 正在保留它们（以便它可以在必要时调用 OnRenderSizeChanged）。

似乎一个简单的解决方法是添加

```
c.UpdateLayout() 
```

到结束`BuildCanvas`。

也就是说，请注意这`Canvas`是一个`UIElement`; 它应该在UI中使用。它不是为用作任意绘图表面而设计的。正如其他评论者已经指出的那样，创建数千个 Canvas 对象可能表明存在设计缺陷。我意识到您的生产代码可能更复杂，但如果它只是在画布上绘制简单的形状，则基于 GDI+ 的代码（即 System.Drawing 类）可能更合适。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-09-01T02:20:00.060

.NET 3 和 3.5 中的 WPF 存在内部内存泄漏。它仅在某些情况下触发。我们永远无法弄清楚究竟是什么触发了它，但我们在我们的应用程序中有它。显然它已在 .NET 4 中修复。

[我认为它与这篇博](http://wesaday.wordpress.com/tag/cmilchannel-hwndsource/)文中提到的相同

无论如何，将以下代码放在`App.xaml.cs`构造函数中为我们解决了它

```
public partial class App : Application
{
   public App() 
   { 
       new HwndSource(new HwndSourceParameters()); 
   } 
} 
```

如果没有其他方法可以解决它，请尝试并查看

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-10T18:35:40.527

通常在 .NET 中，GC 在超过某个阈值时触发对象分配，它不依赖于消息泵（我无法想象它与 WPF 不同）。

我怀疑 Canvas 对象以某种方式深深植根于内部或其他东西。如果在 BuildCanvas 方法完成之前执行 c.Children.Clear()，内存增长会显着减慢。

无论如何，正如这里的评论者所指出的，框架元素的这种使用是非常不寻常的。为什么需要这么多画布？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-10T17:45:37.210

**编辑2：**显然不是答案，而是这里的答案和评论之间来回的一部分，所以我不会删除它。

GC 永远没有机会收集这些对象，因为您的循环及其阻塞调用永远不会结束，因此消息泵和事件永远不会轮到它们。如果您使用`Timer`某种类型的 a 以便消息和事件实际上有机会处理，那么您可能无法吃掉所有的记忆。

**编辑：**只要间隔大于零，以下内容就不会占用我的内存。即使间隔只有 1 Tick，只要不为 0。如果为 0，我们就回到无限循环。

```
public partial class Window1 : Window {
    Class1 c;
    DispatcherTimer t;
    int count = 0;
    public Window1() {
        InitializeComponent();

        t = new DispatcherTimer();
        t.Interval = TimeSpan.FromMilliseconds( 1 );
        t.Tick += new EventHandler( t_Tick );
        t.Start();
    }

    void t_Tick( object sender, EventArgs e ) {
        count++;
        BuildCanvas();
    }

    private static void BuildCanvas() {
        Canvas c = new Canvas();

        Line line = new Line();
        line.X1 = 1;
        line.Y1 = 1;
        line.X2 = 100;
        line.Y2 = 100;
        line.Width = 100;
        c.Children.Add( line );

        c.Measure( new Size( 300, 300 ) );
        c.Arrange( new Rect( 0, 0, 300, 300 ) );
    }
} 
```

# c# - .NET 中是否有一种方法可以在调用另一个方法之后但在输入之前自动调用一个方法

> ID：192332
> 
> 赞同：5
> 
> 时间：2008-10-10T17:22:29.283
> 
> 标签：c#, .net

我正在寻找的是一种在调用另一个方法之后但在输入之前调用方法的方法。例子：

```
public class Test {

  public void Tracer ( ... )
  {
  }

  public int SomeFunction( string str )
  {
    return 0;
  }

  public void TestFun()
  {
    SomeFunction( "" );
  }

} 
```

在上面的示例中，我希望在 TestFun() 调用 SomeFunction() 之后但在进入 SomeFunction() 之前调用 Tracer()。我还想获得有关 SomeFunction() 的反射数据。

* * *

我在每个人的回答中发现了一些有趣的东西。这个问题的**最佳答案**是使用 Castle 的 DynamicProxy；但是，这不是我要用来解决我的问题的，因为它需要在我的项目中添加一个库。我只有几个需要“跟踪”的方法，所以我选择使用经过修改的“核心”方法，并与动态代理的实现方式相结合。我在下面对我自己的问题的回答中对此进行了解释。

作为一个注释，我将研究 AOP 和其他一些应用程序的 ContextBoundObject 类。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-10T17:25:50.480

您可以使用动态代理（例如[Castle 的 DynamicProxy](http://www.castleproject.org/dynamicproxy/index.html)）来拦截调用，运行您希望的任何代码，然后根据您的需要调用或不调用您的方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-10T17:25:43.957

使用 *Core 方法：

```
public int SomeFunction(string str)
{
    Tracer();
    return SomeFunctionCore(str);
}

private int SomeFunctionCore(string str)
{
    return 0;
} 
```

许多 .NET API 都使用这个（在 WPF 中很多）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-11T16:33:13.440

**使用代表！**

```
delegate void SomeFunctionDelegate(string s);

void Start()
{
  TraceAndThenCallMethod(SomeFunction, "hoho");
}

void SomeFunction(string str)
{
  //Do stuff with str
}

void TraceAndThenCallMethod(SomeFunctionDelegate sfd, string parameter)
{
  Trace();
  sfd(parameter);
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-10T17:26:16.173

您想研究面向方面的编程。这是我在 .NET 中找到的 AOP 页面：[http ://www.postsharp.org/aop.net/](http://www.postsharp.org/aop.net/)

面向方面的编程涉及从代码中分离出“横切关注点”。这方面的一个例子是日志记录 - 日志记录（希望）存在于您的所有代码中。这些方法都真的需要了解日志吗？也许不吧。AOP 是研究将这些关注点从它们处理的代码中分离出来，然后在编译时或运行时将它们重新注入。我发布的链接包含几个可用于编译时和运行时 AOP 的工具的链接。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-10T19:04:56.597

.NET 有一个名为 ContextBoundObject 的类，只要您不介意从基类派生，您就可以使用它来设置消息接收器以进行调用拦截，这将为您提供所需的内容，而无需依赖库。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-10T17:26:18.200

您必须使用某种形式的 AOP 框架，例如[SpringFramework.NET](http://www.springframework.net/doc-latest/reference/html/aop-quickstart.html)来做到这一点。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-10T19:59:33.867

如果您需要大规模执行此操作（即针对程序中的每个函数）并且您不想大幅更改源代码，您可能会考虑使用[.NET Profiling API](http://msdn.microsoft.com/en-us/magazine/cc301725.aspx)。它使用起来有点麻烦，因为您必须构建自由线程 COM 对象才能这样做，但它可以让您对程序的执行进行大量控制。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-11T01:55:29.717

这是我为解决我的问题而选择的解决方案。由于没有自动（类似属性）的方式来完成这项工作，我觉得它是最不突兀的，并且允许通过选择要实例化的类来打开和关闭功能。请注意，**这不是**我问题的最佳答案，但它是我特定情况的更好答案。

发生的事情是，我们只是派生了第二个类，它有时或总是被实例化以代替其父类。我们要跟踪（或以其他方式跟踪）的方法被声明为 virtual 并在派生类中重新实现以执行我们要跟踪的任何操作，然后在父类中调用该函数。

```
public class TestClass {

  public virtual void int SomeFunction( string /*str*/ )
  {
    return 0;
  }

  public void TestFun()
  {
    SomeFunction( "" );
  }

}

public class TestClassTracer : TestClass {

  public override void int SomeFunction( string str )
  {
    // do something
    return base.SomeFunction( str );
  }

} 
```

# python - 长生不老药的塔

> ID：192345
> 
> 赞同：7
> 
> 时间：2008-10-10T17:24:23.773
> 
> 标签：python, sqlalchemy, pylons, python-elixir

我想将 Pylons 与 Elixir 一起使用，但是，我不确定这样做的最佳方法是什么。有几篇博客文章（[cleverdevil](http://cleverdevil.org/computing/68/ "聪明的魔鬼技术")、[beachcoder](http://beachcoder.wordpress.com/2007/05/11/using-elixir-with-pylons/ "beachcoder的技术")、[adam hoscilo](http://hoscilo.pypla.net/2007/03/19/sqlalchemy-elixir-and-pylons-round-one/ "亚当·霍西洛的技术")），甚至还有一个关于如何去做的[全新框架；](http://code.google.com/p/tesla-pylons-elixir/ "特斯拉")但是，我不确定它们之间的区别。哪个最好用？我会在使用一个而不是另一个时遇到问题吗？

我宁愿不必直接使用 SQLAlchemy，因为它的冗长和重复性。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-13T17:37:32.857

就个人而言，我会选择 beachcoder 的食谱，[这里](http://pylonshq.com/pasties/271)更新。也就是说，除了特斯拉（我不熟悉）可能例外，它们都足够轻巧，如果您遇到任何问题，应该很容易在它们之间切换；所有的努力都在你的模型中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-10-18T09:28:16.507

Graham Higgins[为此写了](http://bel-epa.com/notes/Pylons/Elixir/)一个 pylon 模板（我们称它们为模板吗？你知道，安装的包取决于你给 paster 创建的参数...）。我用了它，它工作得很好。

您可能还想查看[有关 pylons 列表的讨论](http://groups.google.com/group/pylons-discuss/browse_thread/thread/5be6a0c084a96412?hl=en)

# asp.net - 如何在 Web 应用程序中从客户端计算机获取 AD 凭据？

> ID：192366
> 
> 赞同：2
> 
> 时间：2008-10-10T17:27:29.837
> 
> 标签：asp.net, .net, web-applications, authentication, active-directory

是否可以从 Web 应用程序中获取客户端计算机上用户的活动目录凭据？

澄清一下，我正在设计一个 Web 应用程序，它将托管在客户的 Intranet 上。

要求应用程序的用户在访问应用程序时不会被提示输入凭据，而是应该自动获取登录到客户端计算机的用户的凭据，而无需用户交互。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-10T17:42:39.180

绝对地。这对于 Intranet 应用程序特别有用。

由于您没有指定您的环境，我假设它是 .NET，但这当然不是唯一可能的方法。

可以使用[LDAP](http://en.wikipedia.org/wiki/LDAP)轻松查询 Active Directory 。如果您使用的是 .NET，则可以执行[此代码示例](http://www.codeproject.com/KB/system/QueryADwithDotNet.aspx)或我下面的示例中的操作。您也可以在[SQL 环境](https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-22_11-5259887.html)中执行此操作。

如果您只需要 Windows 来处理身份验证，您可以设置，例如，为[Windows Authentication](http://weblogs.asp.net/scottgu/archive/2006/07/12/Recipe_3A00_-Enabling-Windows-Authentication-within-an-Intranet-ASP.NET-Web-application.aspx)设置一个 .NET Web 应用程序。请务必在 IIS 中为您的应用程序[**关闭匿名登录。**](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/524404dc-8586-46b0-89ac-0f5db6d33c9c.mspx?mfr=true)完成后，您将能够访问用户的 Windows 登录名并使用它进行进一步的安全检查（例如，他们在 AD 中的[组/角色成员身份）。](http://msdn.microsoft.com/en-us/library/4z6b5d42.aspx)

[您还可以使用 Enterprise Library 的Security Application Block](http://msdn.microsoft.com/en-us/library/cc309291.aspx)之类的东西来简化整个混乱。

* * *

这是一个简短的 C# 示例：（[在此处](http://www.developerfusion.com/tools/convert/csharp-to-vb/)转换为 VB.NET ）

```
using System.DirectoryServices;

/// <summary>
/// Gets the email address, if defined, of a user from Active Directory.
/// </summary>
/// <param name="userid">The userid of the user in question.  Make
/// sure the domain has been stripped first!</param>
/// <returns>A string containing the user's email address, or null
/// if one was not defined or found.</returns>
public static string GetEmail(string userid)
{
    DirectorySearcher searcher;
    SearchResult result;
    string email;

    // Check first if there is a slash in the userid
    // If there is, domain has not been stripped
    if (!userid.Contains("\\"))
    {
        searcher = new DirectorySearcher();
        searcher.Filter = String.Format("(SAMAccountName={0})", userid);
        searcher.PropertiesToLoad.Add("mail");
        result = searcher.FindOne();
        if (result != null)
        {
            email = result.Properties["mail"][0].ToString();
        }
    }

    return email;
} 
```

您不必指定域控制器。执行 DirectorySearcher 的空/默认构造函数将导致它尝试自动查找 - 事实上，这是[**首选方法**](http://weblogs.asp.net/steveschofield/archive/2004/04/28/121857.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-10T17:38:46.210

也许 .NET 有一种更直接的方法来做到这一点，但使用 PHP 我只是将我们的 Active Directory 服务器作为 LDAP 服务器访问。

我不确定执行此操作需要对服务器进行哪些调整。我没有设置服务器，我只是查询它。我也不建议您使用 PHP。我只是发现处理 LDAP 比尝试直接绑定到 Active Directory 更容易。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-10T22:43:06.563

Windows 集成身份验证，用户必须使用 IE，并且站点必须在用户的受信任站点中。如果这些情况属实，那么 IE 会将您的 Windows 安全令牌传递给该网站并对其进行身份验证。我们在 Intranet 上使用 SharePoint 执行此操作，否则访问任何受限制的内容会很痛苦——每次单击文档时都会收到提示。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-10T17:44:08.540

不，当然不是。你能想象导致随机网络应用程序能够获取你的 AD 用户名和密码的破坏吗？

现在，如果您只想要用户名 - 如果您使用的是集成的[windows auth](http://en.wikipedia.org/wiki/Integrated_Windows_Authentication) ，则在 REMOTE_USER 中。而且，windows auth 会自动将用户登录到您的站点 - 假设您共享一个域（或信任）。

编辑：IWA 在 Intranet 方案中工作，因为 IE（默认情况下）包括 Intranet 安全区域中的 Intranet 站点。此外，系统管理员可以使用 GPO 设置其他受信任的站点。Firefox 也[支持 NTLM](http://www.testingreflections.com/node/view/1365)，[Opera](http://www.pmwiki.org/wiki/Cookbook/SingleSign-On)和[Chrome](http://weblogs.asp.net/erobillard/archive/2008/09/02/google-chrome-works-for-sharepoint-users-less-so-for-administrators.aspx)也是如此。总而言之，这不是设置 Intranet 的坏方法。

但请注意 - 您没有获得凭据。您与客户协商一个令牌，这就是保持 IWA 安全的原因（与我的上述观点相关）。

# python - 在 Django 中，当孩子保存在外键关系中时，如何通知父母？

> ID：192367
> 
> 赞同：16
> 
> 时间：2008-10-10T17:27:35.357
> 
> 标签：python, django, django-models

我有以下两个模型：

```
class Activity(models.Model):
    name = models.CharField(max_length=50, help_text='Some help.')
    entity = models.ForeignKey(CancellationEntity)
    ...

class Cancellation(models.Model):
    activity = models.ForeignKey(Activity)
    date = models.DateField(default=datetime.now().date())
    description = models.CharField(max_length=250)
    ... 
```

我希望 Activity 模型能够知道何时保存与其相关的取消（插入或更新）。

解决此问题的最佳方法是什么？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-10T18:18:56.923

您要查看的是[Django 的信号](http://docs.djangoproject.com/en/dev/ref/signals/)（也请查看[此页面](http://docs.djangoproject.com/en/dev/topics/signals/)），特别是模型信号—​​—更具体地说，是**post_save**信号。信号是 Django 的插件/挂钩系统版本。每次保存模型时都会发送 post_save 信号，无论它是更新还是创建（它会通知您它是否已创建）。这就是当 Activity 有 Cancellation 时，您将如何使用信号来获得通知

```
from django.db.models.signals import post_save

class Activity(models.Model):
    name = models.CharField(max_length=50, help_text='Some help.')
    entity = models.ForeignKey(CancellationEntity)

    @classmethod
    def cancellation_occurred (sender, instance, created, raw):
        # grab the current instance of Activity
        self = instance.activity_set.all()[0]
        # do something
    ...

class Cancellation(models.Model):
    activity = models.ForeignKey(Activity)
    date = models.DateField(default=datetime.now().date())
    description = models.CharField(max_length=250)
    ...

post_save.connect(Activity.cancellation_occurred, sender=Cancellation)
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-10T22:16:49.393

以下有什么问题？

```
class Cancellation( models.Model ):
    blah
    blah
    def save( self, **kw ):
        for a in self.activity_set.all():
            a.somethingChanged( self )
        super( Cancellation, self ).save( **kw ) 
```

它将允许您非常精确地控制模型之间的通知。在某种程度上，这就是典型的“为什么 OO 这么好？” 问题。我认为 OO 很好，正是因为您的 Cancellation 和 Activity 对象的集合可以充分合作。

# apache-flex - 在 AS3 中强制垃圾收集？

> ID：192373
> 
> 赞同：18
> 
> 时间：2008-10-10T17:30:44.197
> 
> 标签：apache-flex, flash, actionscript-3, garbage-collection

是否可以以编程方式强制在 ActionScript 3.0 中运行完整的垃圾回收？

假设我创建了一堆带有 eventListeners 的 Display 对象，并且一些 DO 已被删除，一些 eventListeners 已被触发和删除等等......有没有办法强制垃圾收集运行并收集所有内容可以收集吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-10T17:45:09.223

是的，这是可能的，但这通常是一个坏主意。GC 应该比你应该更好地知道什么时候是运行的好时机，除了非常特殊的情况，比如你刚刚使用了 500MB 内存并且你需要尽快取回它，你不应该调用 GC你自己。

在 Flash 10 中，有一个`System.gc()`方法可以调用（但请不要调用，见上文） - 请记住 System.gc() 仅适用于 Flash player 10+ 的调试版本。

在 Flash 9 中，有一种不受支持的方法可以通过奇怪的 LocalConnection 命令强制它，但它可能不适用于所有版本。请参阅格兰特斯金纳的[这篇文章](http://www.gskinner.com/blog/archives/2006/08/as3_resource_ma_2.html)。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2012-07-12T10:45:25.273

有一个新的 API 可以告诉 GC 这可能是一个“相对好的时刻”来收集。

[有关System.pauseForGCIfCollectionImminent](http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/flash/system/System.html#pauseForGCIfCollectionImminent())的信息，请参阅 Adob​​e API 文档

以及在 Player 版本 11 中引入该方法后不久的这篇[Adob​​e 博客文章](http://blogs.adobe.com/cantrell/archives/2011/10/providing-hints-to-the-garbage-collector-in-air-3.html)

该方法采用“迫在眉睫”的论点；基本上，如果您真的希望收集器运行，您可以输入一个较小的数字（接近 0.0），即使自上次收集以来没有太多活动（当前以分配的字节数衡量），并且您输入的数字很大（ 1.0 附近）如果您只希望在我们已经接近无论如何都会发生收集的点时发生收集暂停。

这里的动机是针对例如游戏中的情况，您希望将 GC 发生的点移动少量，例如在游戏中的关卡更改期间进行 GC，而不是在玩家开始探索关卡后两秒。

一个非常重要的细节：Release 和 Debugger Flash Runtimes 都支持这一新 API。这使它优于调用 System.gc()。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-10T19:58:36.223

对于所有当前发布的版本，System.gc() 仅适用于 Flash 播放器和 ADL（AIR 应用程序的调试环境）的调试版本。Flash 播放器 10 测试版目前适用于所有版本。

我同意 Davr，这是一个坏主意。运行时通常会比你有更好的主意。

另外，垃圾收集器如何工作的细节是一个实现细节，可能会在 Flash 播放器版本之间发生变化。所以今天行得通的东西并不能保证将来也行得通。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-12T15:33:28.613

正如其他人所说：不要尝试手动 GC，有黑客攻击但不安全。

您应该尽可能地尝试*回收*对象 - 您将节省大量内存。

例如，这可以应用于 BitmapDatas（清除和重用）、粒子（从显示中删除和重用）。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-02-19T10:10:50.430

我对那些说你永远不应该手动进行 GC 的人发表评论。我习惯于在 C++ 中手动管理内存，并且我更喜欢 sharedptr 而不是 GC，但无论如何。

在特定情况下，我找不到除 GC 之外的其他解决方案。请考虑：我有一个 DataCache 类，它的工作方式是为某些在刷新/接收数据时发送更新事件的方法调用保留结果对象。刷新缓存的方式是我只是清除其中的所有结果并发送导致任何剩余侦听器重新请求其数据的事件，并且超出范围的侦听器不应该重新请求清除不需要的结果。但显然，如果我不能强制所有仍然悬空等待 GC 在发送“再次询问数据”事件之前立即清理的侦听器，那些悬空的侦听器将不必要地再次请求数据。所以因为我不能 removeEventListener 因为 AS3 没有析构函数，所以我不能

（编辑）除此之外，我无论如何都不能使用 removeEventListener 进行绑定，这些绑定是在 mxml 中设置的，例如（使用我的自定义 DataCacher 类来处理 remoteobj）

```
<mx:DataGrid id="mygrid" dataProvider="{DataCacher.instance().result('method').data}" ... /> 
```

当包含此数据网格的弹出窗口关闭时，您会期望绑定被破坏。显然，他们一直生活下去。*嗯，当对象被标记*为 GC时，不应该从对象中销毁所有绑定（即事件侦听器），因为最后一个引用已被删除。这对我来说有点解决问题。

至少这就是我认为的原因，我仍然是 Flex 的初学者，所以任何想法都会受到赞赏。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-04-19T16:05:16.867

```
try {
    new LocalConnection().connect('foo');
    new LocalConnection().connect('foo');
} catch (e:*){
    trace("Forcing Garbage Collection :"+e.toString());
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-09-17T20:14:32.673

如果必须，调用 gargabe 收集器可能会很有用......所以，你必须小心如何以及何时这样做，但毫无疑问，有时是必要的。

例如，如果您有一个模块化的应用程序，当您从一个视图更改为另一个视图时，所有已删除的对象可能代表大量内存，应该尽可能快地可用，您只需要控制您正在处理的变量和引用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-11-10T00:53:00.117

回收并没有真正的帮助。我使用了一个加载器，它每 500 毫秒重复加载相同的 jpg。任务管理器仍然报告内存不断增加。

在这里尝试和证明的解决方案。

[http://simplistika.com/as3-garbage-collection/](http://simplistika.com/as3-garbage-collection/)

# ruby-on-rails - Rails：link_to_unless_current 的页面保护重定向问题

> ID：192375
> 
> 赞同：0
> 
> 时间：2008-10-10T17:31:42.447
> 
> 标签：ruby-on-rails, ruby

当`before_filter :login_required`用于保护特定页面时，`link_to_unless_current`应用程序布局模板中的方法将登录页面的“登录”链接呈现为超链接，而不仅仅是文本。

“登录”文本/链接问题仅在通过`before_filter`机器重定向到登录页面时发生，否则，该`link_to_unless_current`方法按预期运行。

似乎`link_to_unless_current`使用旧页面数据作为“当前”而不是登录页面（重定向时）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-09T04:26:01.573

您可以使用路由辅助方法来执行页面重定向：

```
 redirect_to login_url 
```

如果定义了登录的“命名路由”（通过在“config/routes.rb”文件中添加指向“/login”的显式路径来完成）。

该路径实际上与生成的路径相同：

new_session_url

要详细了解路由，我建议使用[**Rails 路由指南**](http://guides.rubyonrails.org/routing_outside_in.html)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-13T16:02:24.593

感谢您的回答，您可以从问题的性质看出我们是 Rails 新手。顺便说一句，我们在这个网站上发布了同样的问题：[http](http://railsforum.com) ://railsforum.com （不确定它是否是官方的 rails 论坛）还没有回复。到目前为止，StackOverflow 似乎正在创建一个伟大的帮助者社区，他们愿意接触受到编程挑战的人。

我认为部分问题在于我们将宁静的 url 与标准路由混合在一起。登录页面映射到 RESTful 路由“/login”，但页面重定向使用“/sessions/new”（Rick Olson 的 RESTful 身份验证模块）

在 application.rb 中，我们将过滤器强制设置为“/login”，从而解决了问题：

```
before_filter :login_required

受保护

def login_required
  如果已登录，则返回 true？
  session[:return_to] = request.request_uri
  flash[:error] = "请先登录"
  redirect_to "/login" 并返回 false
结尾

```

对这种方法的技术优点的评论表示赞赏，因为它可能对其他新手有所帮助。

谢谢，乔

# sql - 选择 XML 节点作为行

> ID：192398
> 
> 赞同：15
> 
> 时间：2008-10-10T17:37:03.250
> 
> 标签：sql, xml, tsql, xpath

我正在使用 T-SQL 从具有 XML 列的表中进行选择。我想选择某种类型的节点并为每个节点创建一行。

例如，假设我正在从*人员*表中进行选择。该表有一个*地址*的 XML 列。XML 的格式类似于以下内容：

```
<address>
  <street>Street 1</street>
  <city>City 1</city>
  <state>State 1</state>
  <zipcode>Zip Code 1</zipcode>
</address>
<address>
  <street>Street 2</street>
  <city>City 2</city>
  <state>State 2</state>
  <zipcode>Zip Code 2</zipcode>
</address> 
```

我怎样才能得到这样的结果：

**名称**         **城市**         **州**

乔·贝克 西雅图 WA

乔·贝克 塔科马 WA

弗雷德琼斯温哥华BC

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-10-11T04:11:04.857

这是您的解决方案：

```
/* TEST TABLE */
DECLARE @PEOPLE AS TABLE ([Name] VARCHAR(20),  [Address] XML )
INSERT INTO @PEOPLE SELECT 
    'Joel', 
    '<address>
      <street>Street 1</street>
      <city>City 1</city>
      <state>State 1</state>
      <zipcode>Zip Code 1</zipcode>
    </address>
    <address>
      <street>Street 2</street>
      <city>City 2</city>
      <state>State 2</state>
      <zipcode>Zip Code 2</zipcode>
    </address>'
UNION ALL SELECT
    'Kim', 
    '<address>
      <street>Street 3</street>
      <city>City 3</city>
      <state>State 3</state>
      <zipcode>Zip Code 3</zipcode>
    </address>'

SELECT * FROM @PEOPLE

-- BUILD XML
DECLARE @x XML
SELECT @x = 
( SELECT 
      [Name]
    , [Address].query('
            for $a in //address
            return <address 
                street="{$a/street}" 
                city="{$a/city}" 
                state="{$a/state}" 
                zipcode="{$a/zipcode}" 
            />
        ') 
  FROM @PEOPLE AS people 
  FOR XML AUTO
) 

-- RESULTS
SELECT [Name]    = T.Item.value('../@Name', 'varchar(20)'),
       street    = T.Item.value('@street' , 'varchar(20)'),
       city      = T.Item.value('@city'   , 'varchar(20)'),
       state     = T.Item.value('@state'  , 'varchar(20)'),
       zipcode   = T.Item.value('@zipcode', 'varchar(20)')
FROM   @x.nodes('//people/address') AS T(Item)

/* OUTPUT*/

Name | street   | city   | state   | zipcode
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Joel | Street 1 | City 1 | State 1 | Zip Code 1
Joel | Street 2 | City 2 | State 2 | Zip Code 2
Kim  | Street 3 | City 3 | State 3 | Zip Code 3 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-11T21:15:13.260

这是我一般的做法：

我通过调用粉碎了源 XML，例如

```
 DECLARE @xmlEntityList xml
SET @xmlEntityList =
'
<ArbitrarilyNamedXmlListElement>
              <ArbitrarilyNamedXmlItemElement><SomeVeryImportantInteger>1</SomeVeryImportantInteger></ArbitrarilyNamedXmlItemElement>
              <ArbitrarilyNamedXmlItemElement><SomeVeryImportantInteger>2</SomeVeryImportantInteger></ArbitrarilyNamedXmlItemElement>
              <ArbitrarilyNamedXmlItemElement><SomeVeryImportantInteger>3</SomeVeryImportantInteger></ArbitrarilyNamedXmlItemElement>
</ArbitrarilyNamedXmlListElement>
'

    DECLARE @tblEntityList  TABLE(
        SomeVeryImportantInteger    int
    )

    INSERT @tblEntityList(SomeVeryImportantInteger)
    SELECT 
        XmlItem.query('//SomeVeryImportantInteger[1]').value('.','int') as SomeVeryImportantInteger
    FROM
        [dbo].[tvfShredGetOneColumnedTableOfXmlItems] (@xmlEntityList) 

```

通过利用标量值函数

```
 /* Example Inputs */
/*
DECLARE @xmlListFormat xml
SET     @xmlListFormat =
            '
            <ArbitrarilyNamedXmlListElement>
              <ArbitrarilyNamedXmlItemElement>004421UB7</ArbitrarilyNamedXmlItemElement>
              <ArbitrarilyNamedXmlItemElement>59020UH24</ArbitrarilyNamedXmlItemElement>
              <ArbitrarilyNamedXmlItemElement>542514NA8</ArbitrarilyNamedXmlItemElement>
            </ArbitrarilyNamedXmlListElement>
            '
declare @tblResults TABLE 
(
    XmlItem xml
)

*/

-- =============================================
-- Author:      6eorge Jetson
-- Create date: 01/02/3003
-- Description: Shreds a list of XML items conforming to
--              the expected generic @xmlListFormat
-- =============================================
CREATE FUNCTION [dbo].[tvfShredGetOneColumnedTableOfXmlItems]  
(
    -- Add the parameters for the function here
    @xmlListFormat xml
)
RETURNS 
@tblResults TABLE 
(
    -- Add the column definitions for the TABLE variable here
    XmlItem xml
)
AS
BEGIN

    -- Fill the table variable with the rows for your result set
    INSERT @tblResults
    SELECT
        tblShredded.colXmlItem.query('.')   as XmlItem
    FROM
         @xmlListFormat.nodes('/child::*/child::*') as tblShredded(colXmlItem)

    RETURN 
END

--SELECT * FROM @tblResults 

```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-06-19T21:50:44.123

如果这对寻找“通用”解决方案的其他人有用，我创建了一个 CLR 过程，它可以采用上述 Xml 片段并将其“分解”到表格结果集中，而无需您提供有关名称的任何其他信息或列的类型，或以任何方式为给定的 Xml 片段自定义调用：

[http://architectshack.com/ClrXmlShredder.ashx](http://architectshack.com/ClrXmlShredder.ashx)

当然有一些限制（xml 必须像这个示例一样本质上是“表格”，第一行需要包含将支持的所有元素/列等） - 但我确实希望它比现在的可用的内置。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-10-26T20:46:10.350

这是一个替代解决方案：

```
;with cte as 
(
    select id, name, addresses, addresses.value('count(/address/city)','int') cnt
    from @demo
)
, cte2 as
(
    select id, name, addresses, addresses.value('((/address/city)[sql:column("cnt")])[1]','nvarchar(256)') city, cnt-1 idx 
    from cte 
    where cnt > 0

    union all

    select cte.id, cte.name, cte.addresses, cte.addresses.value('((/address/city)[sql:column("cte2.idx")])[1]','nvarchar(256)'), cte2.idx-1 
    from cte2 
    inner join cte on cte.id = cte2.id and cte2.idx > 0
)
select id, name, city 
from cte2 
order by id, city 
```

仅供参考：我在代码审查网站上发布了此 SQL 的另一个版本：[https ://codereview.stackexchange.com/questions/108805/select-field-in-an-xml-column-where-both-xml- and-table-contain-multiple-matches](https://codereview.stackexchange.com/questions/108805/select-field-in-an-xml-column-where-both-xml-and-table-contain-multiple-matches)

* * *

## 回答 #5

> 赞同：-4
> 
> 时间：2008-10-10T17:52:23.513

如果可以使用，linq api 对 XML 来说很方便：

```
var addresses = dataContext.People.Addresses
    .Elements("address")
        .Select(address => new { 
            street  = address.Element("street").Value, 
            city    = address.Element("city").Value, 
            state   = address.Element("state").Value, 
            zipcode = address.Element("zipcode").Value, 
        }); 
```

# linux - 关于 ftrace 的良好解释/文档

> ID：192401
> 
> 赞同：5
> 
> 时间：2008-10-10T17:37:12.500
> 
> 标签：linux, kernel, ftrace

我刚刚读到 2.6.27 内核有一个名为 ftrace 的新模块，它听起来很像 suns dtrace 实用程序。我在搜索文档时遇到了一些麻烦，我想知道其他人是否有任何东西。这是否将在 dtrace 之类的完整编程堆栈上实现，并且我们将获得一种用于在 linux 中进行跟踪的漂亮的小脚本语言？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-10T19:12:58.797

我没有解释，但[文档在这里](http://lxr.linux.no/linux+v2.6.27/Documentation/ftrace.txt)。

# c# - 如何防止 RichTextBox 刷新其显示？

> ID：192413
> 
> 赞同：11
> 
> 时间：2008-10-10T17:42:11.477
> 
> 标签：c#, winforms, richtextbox

我有一个 RichTextBox，我需要经常更新 Text 属性，但是当我这样做时，RichTextBox 会令人讨厌地“闪烁”，因为它会在整个方法调用中刷新所有内容。

我希望找到一种简单的方法来暂时抑制屏幕刷新，直到我的方法完成，但我在网上找到的唯一方法是覆盖 WndProc 方法。我采用了这种方法，但有一些困难和副作用，而且它也使调试变得更加困难。似乎必须有更好的方法来做到这一点。有人可以指出我更好的解决方案吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2014-09-28T18:47:31.753

这是完整且有效的示例：

```
 private const int WM_USER = 0x0400;
    private const int EM_SETEVENTMASK = (WM_USER + 69);
    private const int WM_SETREDRAW = 0x0b;
    private IntPtr OldEventMask;       

    [DllImport("user32.dll", CharSet=CharSet.Auto)]
    private static extern IntPtr SendMessage(IntPtr hWnd, int msg, IntPtr wParam, IntPtr lParam);

    public void BeginUpdate()
    {
        SendMessage(this.Handle, WM_SETREDRAW, IntPtr.Zero, IntPtr.Zero);
        OldEventMask = (IntPtr)SendMessage(this.Handle, EM_SETEVENTMASK, IntPtr.Zero, IntPtr.Zero);
    }       

    public void EndUpdate()
    {
        SendMessage(this.Handle, WM_SETREDRAW, (IntPtr)1, IntPtr.Zero);
        SendMessage(this.Handle, EM_SETEVENTMASK, IntPtr.Zero, OldEventMask);
    } 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-11T19:42:42.793

我问了最初的问题，最适合我的答案是 BoltBait 将 SendMessage() 与 WM_SETREDRAW 结合使用。与使用 WndProc 方法相比，它的副作用似乎更少，并且在我的应用程序中的执行速度是 LockWindowUpdate 的两倍。

在我扩展的 RichTextBox 类中，我刚刚添加了这两个方法，并且每当我需要在进行某些处理时停止重新绘制时，我都会调用它们。如果我想从 RichTextBox 类之外执行此操作，我认为只需将“this”替换为对 RichTextBox 实例的引用即可。

```
 private void StopRepaint()
    {
        // Stop redrawing:
        SendMessage(this.Handle, WM_SETREDRAW, 0, IntPtr.Zero);
        // Stop sending of events:
        eventMask = SendMessage(this.Handle, EM_GETEVENTMASK, 0, IntPtr.Zero);
    }

    private void StartRepaint()
    {
        // turn on events
        SendMessage(this.Handle, EM_SETEVENTMASK, 0, eventMask);
        // turn on redrawing
        SendMessage(this.Handle, WM_SETREDRAW, 1, IntPtr.Zero);
        // this forces a repaint, which for some reason is necessary in some cases.
        this.Invalidate();
    } 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-10T17:58:06.513

在这里找到：http: [//bytes.com/forum/thread276845.html](http://bytes.com/forum/thread276845.html)

> 我最终通过 SendMessage 发送 WM_SETREDRAW 以禁用然后重新启用，然后在完成更新后发送 Invalidate()。这似乎奏效了。

我从未尝试过这种方法。我已经编写了一个带有语法突出显示的 RTB 应用程序，并在 RTB 类中使用了以下内容：

```
protected override void WndProc(ref Message m)
{
    if (m.Msg == paint)
    {
        if (!highlighting)
        {
            base.WndProc(ref m); // if we decided to paint this control, just call the RichTextBox WndProc
        }
        else
        {
            m.Result = IntPtr.Zero; // not painting, must set this to IntPtr.Zero if not painting otherwise serious problems.
        }
    }
    else
    {
        base.WndProc(ref m); // message other than paint, just do what you normally do.
    }
} 
```

希望这可以帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-10T17:50:36.747

您可以将 Text 存储到一个字符串中，对字符串进行操作，然后在方法结束时将其存储回 Text 属性吗？

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-10T18:10:44.163

我建议看看[LockWindowUpdate](http://msdn.microsoft.com/en-us/library/ms534869.aspx)

```
 [DllImport("user32.dll", EntryPoint="LockWindowUpdate", SetLastError=true,
ExactSpelling=true, CharSet=CharSet.Auto,
CallingConvention=CallingConvention.StdCall)] 
```

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2008-10-10T17:47:12.837

试试这个：

```
myRichTextBox.SuspendLayout();
DoStuff();
myRichTextBox.ResumeLayout(); 
```

# java - 改进的集合迭代器

> ID：192417
> 
> 赞同：12
> 
> 时间：2008-10-10T17:44:21.377
> 
> 标签：java, collections, iterator, decorator

就个人而言，我发现 java.util.Iterator 提供的功能范围相当可悲。至少，我希望有以下方法：

*   peek() 返回下一个元素而不向前移动迭代器
*   previous() 返回前一个元素

尽管还有很多其他的可能性，例如 first() 和 last()。

有谁知道这样的第 3 方迭代器是否存在？它可能需要实现为 java.util.Iterator 的装饰器，以便它可以与现有的 java 集合一起使用。理想情况下，它应该是“泛型意识”。

在此先感谢，唐

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-10T17:53:43.357

只需`previous()`使用`java.util.ListIterator`.

窥视这一点很容易通过执行

```
public <T> T peek(ListIterator<T> iter) throws NoSuchElementException {
    T obj = iter.next();
    iter.previous();
    return obj;
} 
```

不幸的是，将它作为一种实用方法会更容易，因为每个集合类都实现了自己的迭代器。做一个包装器以在某些接口上的每个集合上获取一个 peek 方法，例如`MyListIterator`将是相当多的工作。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-10T17:56:50.103

我认为这些没有实现的原因是因为它们对于某些集合来说并不重要，并且会对性能产生很大的影响。我认为为您关心的收藏品制作这项工作对您来说非常简单。

我也不喜欢 Java 迭代器无法在不移动它的情况下获取当前值（因此你不能轻易地编写基于值分支的代码，只需传递迭代器——你必须传递你的值现在也有）。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-10T18:35:20.307

[Apache Commons 集合](https://commons.apache.org/proper/commons-collections/javadocs/api-release/org/apache/commons/collections4/iterators/package-summary.html)

[谷歌收藏](https://google.github.io/guava/releases/21.0/api/docs/com/google/common/collect/package-summary.html)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-10T18:48:31.217

通用运算符没有实现这些特性是有一个很好的理由：它们并不适用于所有容器。典型的例子是一个代表一些外部数据输入的容器，比如一个被视为流的文件。每次您读取一个值时，您**都会使用**它并将指针向前移动，无论您是否愿意。如果你对泛型迭代器施加这些约束，那么你就会失去迭代器的泛型性。

如果您想要一种`previous`方法，如建议的那样，请使用`ListIterator<>`，然后将其限制为容器表现为列表。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-10T18:00:09.257

我要看的一件事是 clojure 中的 Seq 实现

[http://clojure.org/sequences](http://clojure.org/sequences)

基类的实现是用 Java 实现的，并且可以使用完整的源代码。Seq 是 Java 迭代器上的装饰器（采用并实现 Java 迭代器接口）——但它们也提供自己的接口，这可能是你想要的更多——或者至少是一个起点。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-11-04T01:56:17.167

我看到有人链接到Google Collections，但是没有人提到您要查找的方法称为Iterators.peekingIterator()。

不过，最好只使用 ListIterator。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-10T18:51:00.120

正如 ykaganovich 建议的那样，您可能想查看[google-collections 的](http://code.google.com/p/google-collections/)东西。你想要的一些东西肯定有一些支持，比如[偷看](http://google-collections.googlecode.com/svn/trunk/javadoc/com/google/common/collect/PeekingIterator.html)。此外，正如其他一些人所提到的，从可能性或性能的角度来看，为所有集合实现所有这些东西可能是危险的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-05T05:49:13.760

```
public class Iterazor<T> {
  private Iterator<T> it;
  public T top;
  public Iterazor(Collection<T> co) {
    this.it = co.iterator(); 
    top = it.hasNext()? it.next(): null; 
  }
  public void advance() { 
    top = it.hasNext()? it.next(): null; 
  }
}

// usage

for(Iterazor<MyObject> iz = new Iterazor<MyObject>(MyCollection); 
    iz.top!=null; iz.advance())
  iz.top.doStuff();
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-10T17:59:14.063

我从来没有遇到过需要 peek(); 的问题。迭代器对我来说工作得很好。我很好奇你是如何使用你觉得你需要这个附加功能的迭代器的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-10T18:38:22.720

听起来你最好使用堆栈。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-18T16:33:24.963

编写 Java 集合是为了提供一组最小的有用功能。对于任何实现 Java 的人都必须实现的**代码**，这是一种非常好的方法。*使用可能*有用的功能使界面膨胀可能会导致代码量大幅增加，而只有少数人注意到了改进。如果 peek() 和 previous() 是标准迭代器的一部分，这意味着每个编写新类型 Collection 的人都**必须**实现它，无论它是否合理。

*迭代器还被设计用于处理物理上不能*倒退的事情，这使得 peek() 和 previous() 都不可能。

# grails - 让 Groovy 的葡萄开始了！

> ID：192432
> 
> 赞同：12
> 
> 时间：2008-10-10T17:49:56.017
> 
> 标签：grails, groovy, grape

我尝试在 Groovy 1.6-beta-2 中使用新的[Groovy Grape](http://groovy.codehaus.org/Grape)功能，但收到一条错误消息；

```
unable to resolve class com.jidesoft.swing.JideSplitButton 
```

运行 stock 示例时，从 Groovy 控制台 (/opt/groovy/groovy-1.6-beta-2/bin/groovyConsole)；

```
import com.jidesoft.swing.JideSplitButton
@Grab(group='com.jidesoft', module='jide-oss', version='[2.2.1,)')
public class TestClassAnnotation {
    public static String testMethod () {
        return JideSplitButton.class.name
    }
} 
```

我什至尝试运行葡萄命令行工具以确保导入库。像这样;

```
 $ /opt/groovy/groovy-1.6-beta-2/bin/grape install com.jidesoft jide-oss 
```

确实可以很好地安装库。如何让代码从 groovyConsole 正确运行/编译？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-11T18:24:28.847

在制定启动/终止开关例程时仍然存在一些问题。对于 Beta-2，首先在它自己的脚本中执行此操作：

```
groovy.grape.Grape.initGrape() 
```

您将遇到的另一个问题涉及使用无界上限的乐趣。从 2.3.0 开始，Jide-oss 一直在将其代码编译为 Java 6 字节码，因此您需要在 Java 6 中运行控制台（无论如何，这都是您想要为 Swing 做的）或设置上限范围，像这样

```
import com.jidesoft.swing.JideSplitButton

@Grab(group='com.jidesoft', module='jide-oss', version='[2.2.1,2.3.0)')
public class TestClassAnnotation {
    public static String testMethod () {
        return JideSplitButton.class.name
    }
}

new TestClassAnnotation().testMethod() 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-10-27T06:06:39.547

我终于让它适用于 Groovy Shell（1.6.5，JVM：1.6.0_13）。这应该更好地记录下来。

首先在命令行...

> 葡萄安装 org.codehaus.groovy.modules.http-builder http-builder 0.5.0-RC2

然后在groovysh中...

```
groovy:000> import groovy.grape.Grape
groovy:000> Grape.grab(group:'org.codehaus.groovy.modules.http-builder', module:'http-builder', version:'0.5.0-RC2')
groovy:000> def http= new groovyx.net.http.HTTPBuilder('http://rovio')
===> groovyx.net.http.HTTPBuilder@91520 
```

@grab 在文件中比在 shell 中使用更好。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-11T18:50:34.927

行。似乎这是一个简短的工作演示（从 groovyConsole 运行）

```
groovy.grape.Grape.initGrape()
@Grab(group='com.jidesoft', module='jide-oss', version='[2.2.1,2.3.0)')
public class UsedToExposeAnnotationToComplier {}
com.jidesoft.swing.JideSplitButton.class.name 
```

运行时会产生

结果：“com.jidesoft.swing.JideSplitButton”

很酷！！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-12-09T14:38:17.160

导入语句必须出现**在**抓取之后。
附言。抓取后必须至少存在**一个导入**语句

```
@Grab(group='com.jidesoft', module='jide-oss', version='[2.2.1,)')
import com.jidesoft.swing.JideSplitButton
public class TestClassAnnotation {
    public static String testMethod () {
        return JideSplitButton.class.name
    }
} 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-01-23T14:58:47.617

使用最新 RC-2 的不同示例（注意：Grab 注释 createEmptyInts）：

```
// create and use a primitive array
import org.apache.commons.collections.primitives.ArrayIntList

@Grab(group='commons-primitives', module='commons-primitives', version='1.0')
def createEmptyInts() { new ArrayIntList() }

def ints = createEmptyInts()
ints.add(0, 42)
assert ints.size() == 1
assert ints.get(0) == 42 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-01-31T14:33:11.880

另一个例子（注：Grab 注释 getHtml）：

```
// find the PDF links in the Java 1.5.0 documentation
@Grab(group='org.ccil.cowan.tagsoup', module='tagsoup', version='0.9.7')
def getHtml() {
    def parser = new XmlParser(new org.ccil.cowan.tagsoup.Parser())
    parser.parse("http://java.sun.com/j2se/1.5.0/download-pdf.html")
}
html.body.'**'.a.@href.grep(~/.*\.pdf/).each{ println it } 
```

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2009-01-31T14:59:46.740

另一个例子（注：`Grab`注释`getFruit`）：

```
// Google Collections example
import com.google.common.collect.HashBiMap
@Grab(group='com.google.code.google-collections', module='google-collect', version='snapshot-20080530')
def getFruit() { [grape:'purple', lemon:'yellow', orange:'orange'] as HashBiMap }
assert fruit.inverse().yellow == 'lemon' 
```

# svn - 如何正确使用 KDiff3 与 TortoiseSVN 来解决冲突？

> ID：192454
> 
> 赞同：28
> 
> 时间：2008-10-10T17:56:32.383
> 
> 标签：svn, tortoisesvn, diff, conflict

我将 TortoiseSVN 设置为使用 KDiff3 作为冲突解决工具（我发现它比内置的 TortoiseMerge 显示了更多对合并有用的信息）。

当我使用 Tortoise 的“编辑冲突”命令打开一个文件时，它会显示三个文件，我必须手动选择“合并->合并当前文件”。问题是 KDiff3 将结果保存到`source_file.working`而不是 to `source_file`。因此，如果不执行另存为，则存在冲突的真实文件不会被修改。有没有办法每次都做这个手册另存为？

我知道这不是一个严格的编程问题，而是关于一个对程序员来说足够普遍的辅助过程，它在这里应该很有用。我在别处找不到这个问题的答案。

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-10-14T10:28:08.183

我的有点长：

```
"C:\Program Files\KDiff3\kdiff3.exe" %base %mine %theirs -o %merged --L1 Base --L2 Mine --L3 Theirs 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-02-10T23:36:20.047

如果有像我这样的其他人，让我指出他是在 TortoiseSVN->Settings->Diff Viewer 中完成的。我在已经安装 Tortoise 的 Windows 中安装了 KDiff3，它是自动配置的。我花了一些时间才弄清楚这需要在哪里完成。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-10T18:29:03.237

原来我只需要一个更具体的命令行。我将它设置为简单的路径`kdiff3.exe`，并希望从 TortoiseSVN 传递的默认参数就足够了。不是这样。这是需要的（关键是`-o`参数）：

```
C:\Program Files\KDiff3\kdiff3.exe %base %theirs %mine -o %merged 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-01-16T17:24:30.990

我有同样的问题，但可以在没有任何命令行的情况下解决它：当我点击“编辑冲突”时，kdiff3 打开了。解决冲突后，我只需单击“保存”并关闭 kdiff3 窗口。窗口关闭后，我切换回 SVN“解决冲突”窗口并单击解决。然后就出现了下一个冲突......

# java - 设置日志文件名以在 Log4j 中包含当前日期

> ID：192456
> 
> 赞同：70
> 
> 时间：2008-10-10T17:56:46.423
> 
> 标签：java, .net, logging, log4net, log4j

我想将 log4j 和 log4net appender 的日志文件名设置为当前日期。我们正在进行每日翻转，但当前日志文件没有日期。日志文件名格式为

```
logname.2008-10-10.log 
```

有人知道我这样做的最佳方法吗？

编辑：我忘了提到我们也想在 log4net 中这样做。另外，任何解决方案都需要在 JBoss 中可用。

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2008-10-10T18:24:49.267

DailyRollingFileAppender 正是您要寻找的。

```
<appender name="roll" class="org.apache.log4j.DailyRollingFileAppender">
    <param name="File" value="application.log" />
    <param name="DatePattern" value=".yyyy-MM-dd" />
    <layout class="org.apache.log4j.PatternLayout"> 
      <param name="ConversionPattern" 
          value="%d{yyyy-MMM-dd HH:mm:ss,SSS} [%t] %c %x%n  %-5p %m%n"/>
    </layout>
  </appender> 
```

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2012-01-17T02:11:58.923

使用 log4j.properties 文件，并在我的 POM 中包含[apache-log4j-extras](http://logging.apache.org/log4j/extras/) 1.1 和 log4j 1.2.16

```
log4j.appender.LOGFILE=org.apache.log4j.rolling.RollingFileAppender
log4j.appender.LOGFILE.RollingPolicy=org.apache.log4j.rolling.TimeBasedRollingPolicy
log4j.appender.LOGFILE.RollingPolicy.FileNamePattern=/logs/application_%d{yyyy-MM-dd}.log 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-10T18:51:35.703

我 99% 确定 RollingFileAppender/DailyRollingFileAppender 虽然它为您提供了所需的日期滚动功能，但没有任何方法可以指定当前日志文件也应该使用`DatePattern`。

您也许可以简单地继承 RollingFileAppender（或 DailyRollingFileAppender，我忘记了 log4net 中的哪个）并修改命名逻辑。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-10-10T19:29:44.487

我已经创建了一个可以做到这一点的附加程序。 [http://stauffer.james.googlepages.com/DateFormatFileAppender.java](http://stauffer.james.googlepages.com/DateFormatFileAppender.java)

```
/*
 * Copyright (C) The Apache Software Foundation. All rights reserved.
 *
 * This software is published under the terms of the Apache Software
 * License version 1.1, a copy of which has been included with this
 * distribution in the LICENSE.txt file.  */

package sps.log.log4j;

import java.io.IOException;
import java.io.File;
import java.text.SimpleDateFormat;
import java.util.Date;

import org.apache.log4j.*;
import org.apache.log4j.helpers.LogLog;
import org.apache.log4j.spi.LoggingEvent;

/**
 * DateFormatFileAppender is a log4j Appender and extends 
 * {@link FileAppender} so each log is 
 * named based on a date format defined in the File property.
 *
 * Sample File: 'logs/'yyyy/MM-MMM/dd-EEE/HH-mm-ss-S'.log'
 * Makes a file like: logs/2004/04-Apr/13-Tue/09-45-15-937.log
 * @author James Stauffer
 */
public class DateFormatFileAppender extends FileAppender {

  /**
   * The default constructor does nothing.
   */
  public DateFormatFileAppender() {
  }

  /**
   * Instantiate a <code>DailyRollingFileAppender</code> and open the
   * file designated by <code>filename</code>. The opened filename will
   * become the ouput destination for this appender.
   */
  public DateFormatFileAppender (Layout layout, String filename) throws IOException {
    super(layout, filename, true);
  }

  private String fileBackup;//Saves the file pattern
  private boolean separate = false;

  public void setFile(String file) {
    super.setFile(file);
    this.fileBackup = getFile();
  }

  /**
   * If true each LoggingEvent causes that file to close and open.
   * This is useful when the file is a pattern that would often
   * produce a different filename.
   */
  public void setSeparate(boolean separate) {
    this.separate = separate;
  }

  protected void subAppend(LoggingEvent event) {
    if(separate) {
        try {//First reset the file so each new log gets a new file.
            setFile(getFile(), getAppend(), getBufferedIO(), getBufferSize());
        } catch(IOException e) {
            LogLog.error("Unable to reset fileName.");
        }
    }
    super.subAppend(event);
  }

  public
  synchronized
  void setFile(String fileName, boolean append, boolean bufferedIO, int bufferSize)
                                                            throws IOException {
    SimpleDateFormat sdf = new SimpleDateFormat(fileBackup);
    String actualFileName = sdf.format(new Date());
    makeDirs(actualFileName);
    super.setFile(actualFileName, append, bufferedIO, bufferSize);
  }

  /**
   * Ensures that all of the directories for the given path exist.
   * Anything after the last / or \ is assumed to be a filename.
   */
  private void makeDirs (String path) {
    int indexSlash = path.lastIndexOf("/");
    int indexBackSlash = path.lastIndexOf("\\");
    int index = Math.max(indexSlash, indexBackSlash);
    if(index > 0) {
        String dirs = path.substring(0, index);
//        LogLog.debug("Making " + dirs);
        File dir = new File(dirs);
        if(!dir.exists()) {
            boolean success = dir.mkdirs();
            if(!success) {
                LogLog.error("Unable to create directories for " + dirs);
            }
        }
    }
  }

} 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2009-04-21T18:12:45.293

我不知道在 Java 中是否可行，但在 .NET 中，RollingFileAppender 上的 StaticLogFileName 属性可以满足您的需求。默认值为真。

```
<staticLogFileName value="false"/> 
```

完整配置：

```
<appender name="DefaultFileAppender" type="log4net.Appender.RollingFileAppender">
  <file value="application"/>
  <staticLogFileName value="false"/>
  <appendToFile value="true" />
  <rollingStyle value="Date" />
  <datePattern value="yyyy-MM-dd&quot;.log&quot;" />
  <layout type="log4net.Layout.PatternLayout">
    <conversionPattern value="%date [%thread] %-5level %logger [%property{NDC}] - %message%newline" />
  </layout>
</appender> 
```

`&quot;.log&quot;`是为了不让 dateformat 识别日志中的全局日期模式“g”。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-06-27T12:56:27.970

此示例将为每分钟创建记录器，如果您想更改每一天的值，请更改`DatePattern`值。

```
<appender name="ASYNC" class="org.apache.log4j.DailyRollingFileAppender">
   <param name="File" value="./applogs/logger.log" />
   <param name="Append" value="true" />
   <param name="Threshold" value="debug" />
   <appendToFile value="true" />
   <param name="DatePattern" value="'.'yyyy_MM_dd_HH_mm"/>
   <rollingPolicy class="org.apache.log4j.rolling.TimeBasedRollingPolicy">
      <param name="fileNamePattern" value="./applogs/logger_%d{ddMMMyyyy HH:mm:ss}.log"/>
      <param name="rollOver" value="TRUE"/>
   </rollingPolicy>
   <layout class="org.apache.log4j.PatternLayout">
      <param name="ConversionPattern" value="%d{ddMMMyyyy HH:mm:ss,SSS}^[%X{l4j_mdc_key}]^[%c{1}]^ %-5p %m%n" />
   </layout>
</appender>
<root>
   <level value="info" />
   <appender-ref ref="ASYNC" />
</root> 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-02-21T17:52:26.510

作为对提到 DailyRollingFileAppender 的两个答案的回应（对不起，我没有足够的代表直接评论它们，我认为这需要提及），我警告说不幸的是该类的开发人员已经记录了它表现出同步和数据丢失，并建议应为新部署寻求替代方案。

[DailyRollingFileAppender JavaDoc](http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/DailyRollingFileAppender.html)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-01-21T06:01:09.127

您可以动态设置[FileAppender](http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/FileAppender.html)

```
SimpleLayout layout = new SimpleLayout();           
FileAppender appender = new FileAppender(layout,"logname."+new Date().toLocaleString(),false);
logger.addAppender(appender); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-07-27T12:13:18.330

即使您像@gedevan 建议的那样使用 DailyRollingFileAppender，您仍然会得到`logname.log.2008-10-10`（一天后，因为前一天的日志将被存档并且日期将连接到它的文件名）。所以如果你想要.log 最后，你必须在 DatePattern 上这样做：

`log4j.appender.file.DatePattern='.'yyyy-MM-dd-HH-mm'.log'`

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-05-25T20:41:25.990

您可以像这样以编程方式执行此操作：

```
 String dateFile = LocalDate.now().toString() + ".log";
        Enumeration enm = Logger.getRootLogger().getAllAppenders();
        Appender appender = null;
        while(enm.hasMoreElements()){
            appender = (Appender)enm.nextElement();
            String c = appender.getClass().toString();
            if(c.contains("FileAppender")){
                String f = ((FileAppender)appender).getFile();
                ((FileAppender)appender).setFile(f+dateFile);
                System.out.println("From:"+f+" to:"+dateFile);
            }
        } 
```

# refactoring - 改进非常糟糕的系统

> ID：192464
> 
> 赞同：13
> 
> 时间：2008-10-10T17:59:15.327
> 
> 标签：refactoring, system

你将如何开始改进一个非常糟糕的系统？

在你推荐创建单元测试和重构之前，让我解释一下我的意思。我可以使用这些技术，但在这种情况下那将毫无意义。

实际上，这个系统是如此的破碎，它没有做它需要做的事情。

例如，系统应该计算它发送了多少条消息。它主要工作，但在某些情况下它“忘记”增加消息计数器的值。问题是，许多其他模块都有自己的变通方法建立在这个计数器上，如果我更正计数器，整个系统会变得比现在更糟。解决方案可能是修改所有模块并删除它们自己的更正，但有 150 多个模块需要如此多的协调，我负担不起。

更糟糕的是，有些问题的解决方法不在系统本身，而在人们的脑海中。例如，系统不能在一个消息组中表示超过四个相关消息。有些服务需要将五条消息组合在一起。会计部门知道这个限制，每次他们计算这些服务的消息时，他们都会计算消息组并将其乘以 5/4 以获得正确的消息数量。绝对没有关于这些偏差的文档，也没有人知道现在系统中有多少这样的东西。

那么你将如何着手改进这个系统呢？你会遵循什么策略？

一些额外的事情：我是一个单人军队，因此雇佣足够多的人并重新设计/重构系统是不可接受的答案。在几周或几个月后，我真的应该表现出一些明显的进步，所以在几年内自己进行重构也不是一个选择。

一些技术细节：该系统是用 Java 和 PHP 编写的，但我认为这并不重要。它背后有两个数据库，一个 Oracle 和一个 PostgreSQL。除了之前提到的代码本身的缺陷之外，它的编写和文档记录也很糟糕。

附加信息：

计数器问题不是同步问题。counter++ 语句被添加到某些模块中，而不是添加到其他一些模块中。一个快速而肮脏的解决方法是将它们添加到它们丢失的地方。长期的解决方案是让它成为需要它的模块的一个方面，这样以后就不可能忘记它。我在修复这样的事情上没有任何问题，但如果我做出这个改变，我会打破 10 多个其他模块。

更新：

我接受了 Greg D 的回答。即使我更喜欢亚当·贝莱尔的作品，也不知道什么是最理想的。谢谢大家的回答。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-10T18:27:55.313

1.  **扑灭大火**。如果有任何至关重要的问题，无论它们是什么，你都必须首先处理它们。如果必须的话，用一个臭的代码库就可以了。你知道你会在未来改进它。这是针对您向谁汇报的销售技巧。
2.  **摘一些低垂的果实。** 我假设您对这个特定软件相对较新，并且您被重新分配了处理它的任务。在代码的相关子系统中找到一些明显简单的问题，这些问题不应该花费超过一两天的时间来解决，并修复它们。这可能涉及重构，也可能不涉及。目标是熟悉系统和原作者的风格。你可能不会真的很幸运（在我之前在我的系统上工作的两个不称职的人之一总是用四个标点符号而不是一个标点符号来修正他的评论，这使得很容易区分谁编写了特定的代码段。），但是您会深入了解作者的弱点，因此您知道要注意什么。例如，与全局状态的广泛、紧密耦合与对语言工具的理解不足。
3.  **设定一个大目标。** 如果您的经验与我的相似，那么当您执行前面的步骤时，您会发现自己越来越频繁地陷入特定的意大利面条代码中。这是您需要解开的第一个结。凭借您对组件的了解以及原始作者可能做错了什么（因此，您需要注意什么）的经验，您可以开始为系统的这个子集设想一个更好的模型。如果您仍然需要维护一些杂乱的界面来维护功能，请不要担心，只需一步一步完成。

起泡，冲洗，重复！:)

给定时间，考虑在与系统其余部分的接口下一层为您的新模型添加单元测试。不要通过使用它们的测试将坏接口刻在代码中，您将在未来的迭代中更改它们。

解决您提到的特定问题：

当您遇到用户手动解决的情况时，请*与用户*讨论如何更改它。如果您在投入时间之前提供更改，请确认他们会接受更改。如果他们不想要改变，你的工作就是维持不正常的行为。

当您遇到多个其他组件已经解决的错误组件时，我支持并行组件技术。创建一个计数器，它可以按照现有计数器的工作方式*工作*。提供一个相似的（或者，如果可行的话，相同的）界面并将新组件滑入代码库。当您触摸可以解决损坏的外部组件时，请尝试用新组件替换旧组件。类似的接口简化了代码的移植，如果新组件失败，旧组件仍然存在。在可以之前不要移除旧组件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-10T18:16:12.233

现在问你什么？是否要求您实现功能或修复错误？他们甚至知道他们想让你做什么吗？

如果您没有人力、时间或资源来“修复”整个系统，那么您所能做的就是保释金。你是说你应该能够在几个月的时间内取得一些“明显的进步”。好吧，由于系统如您所描述的那样糟糕，您实际上可能会使系统变得更糟。在做一些引人注目的事情的压力下，您只需添加代码，并使系统更加复杂。

你最终需要重构。没有其他办法了。如果您能找到一种对最终用户可见的重构方法，**那将是理想**的，即使它需要 6-9 个月或一年而不是“几个月”。但如果你不能，那么你可以选择：

*   重构，尽管您付出了努力，但仍有被视为“没有完成任何事情”的风险
*   不要重构，完成“可见”的目标，让系统更复杂，更难有一天重构。（也许在你找到了一份更好的工作，并希望下一个开发者永远找不到你住的地方之后。）

哪一个对您个人最有利取决于您公司的文化。他们有一天会决定雇佣更多的开发人员，还是用其他产品完全取代这个系统？

相反，如果你“解决问题”的努力实际上破坏了其他事情，他们会理解你被要求单枪匹马解决的怪物吗？

这里没有简单的答案，对不起。您必须根据您独特的个人情况进行评估。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-10T18:07:32.377

这是一整本书，基本上会讲单元测试和重构，但有更多关于如何做的实用建议

[http://ecx.images-amazon.com/images/I/51RCXGPXQ8L._SL500_AA240_.jpg](https://rads.stackoverflow.com/amzn/click/com/0131177052)

[http://www.amazon.com/Working-Effectively-Legacy-Robert-Martin/dp/0131177052](https://rads.stackoverflow.com/amzn/click/com/0131177052)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-10T18:05:45.517

使用 Windows 资源管理器打开包含该系统的目录。然后，按 Ctrl-A，然后按 Shift-Delete。在你的情况下，这听起来像是一个改进。

不过说真的：那个计数器听起来好像有线程安全问题。我会锁定增加的功能。

而对于系统的其余部分，你不能做不可能的事，所以尽量做可能的事。您需要从两个方面攻击您的系统。先处理比较明显的问题，这样你才能显示出进步。同时，您应该处理更多的基础设施问题，以便有一天您有机会真正修复这个问题。

祝你好运，愿源与你同在。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-10T18:05:52.427

选择一个重构难度中等的区域。仅使用现有方法签名创建原始代码的骨架；甚至可能使用接口。然后开始破解。您甚至可以将“新”方法指向旧方法，直到找到它们。

然后，测试，测试，测试。由于没有任何单元测试，也许只使用老式的语音激活单元测试（人）？或者随手编写自己的测试。

当你进入某种存储库时，记录你的进展，包括挫折和问题，这样当下一个得到这个项目的可怜的 schmuck 不会是你所在的地方:)。

完成第一部分后，继续进行下一部分。关键是建立在渐进式进展之上，这就是为什么你不应该先从最难的部分开始；士气低落太容易了。

Joel 有几篇关于重写/重构的文章：

[http://www.joelonsoftware.com/articles/fog0000000069.html](http://www.joelonsoftware.com/articles/fog0000000069.html)

[http://www.joelonsoftware.com/articles/fog0000000348.html](http://www.joelonsoftware.com/articles/fog0000000348.html)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-10T18:30:51.410

近三年来，我一直在使用具有相同特征的遗留系统，并且没有我知道的捷径。

我们的遗留系统最困扰我的是我不允许修复一些错误，因为如果我修复了许多其他功能可能会破坏它们。这需要丑陋的变通方法或创建旧功能的新版本。然后可以一次用新函数替换对旧函数的调用（在测试时）。

我不确定你的任务目标是什么，但我强烈建议你尽可能少地接触代码。只做你需要做的。

您可能希望通过采访人来尽可能多地记录下来。这是一项艰巨的任务，因为您不知道要问哪些问题，而且人们会忘记很多细节。

除此之外：确保你得到报酬和足够的精神支持。会有哭泣和咬牙切齿的...

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-10T18:06:52.160

好吧，您需要从某个地方开始，听起来有些错误需要修复。我会解决这些错误，进行快速重构，并在此过程中编写任何可能的单元测试。我还会使用像[SourceMonitor](http://www.campwoodsw.com/sourcemonitor.html)这样的工具来识别系统中一些最“复杂”的代码部分，看看我是否可以以任何方式简化它们的设计。最终，您只需要接受这将是一个缓慢的过程，并朝着更好的系统迈出一小步。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-10T18:18:21.387

我会尝试选择可以相当快地单独提取和重写的系统部分。即使它做的不多，您也可以很快显示进度，并且您不存在直接与遗留代码交互的问题。

希望如果你能挑出一些这样的任务，他们会看到你取得了明显的进步，你可以提出一个论点来雇佣更多的人来重写更大的模块。当系统的某些部分依赖于损坏的行为时，您别无选择，只能在修复任何东西之前分离。

希望您可以逐步建立一个能够重写整个代码的团队。

所有这一切都必须与一些体面的培训齐头并进，否则人们的旧习惯会坚持下去，当事情没有按预期进行时，你的工作就会受到指责。

祝你好运！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-10T18:25:51.137

弃用当前存在的所有问题，并编写可以正常工作的新问题。尽可能多地记录将发生的变化，并在指向该文档的地方放置大红色闪烁的标志。

通过这样做，您可以保留现有的错误（那些正在其他地方得到补偿的错误），而不会减慢您获得实际工作系统的进度。

# asp.net-mvc - 如何本地化 ASP.NET MVC 应用程序？

> ID：192465
> 
> 赞同：122
> 
> 时间：2008-10-10T17:59:30.693
> 
> 标签：asp.net-mvc, localization, globalization

本地化 ASP.NET MVC 应用程序的最佳实践是什么？

我想介绍两种情况：

*   IIS 中的一个应用程序部署，可以处理多种语言
*   一种语言/应用程序部署。

在第一种情况下，您是否应该使用某种基于视图的东西，例如~/View/EN、~/View/FI、~/View/SWE 或不同的东西？

第二种情况呢，只是通过 Web.config 进行基于应用程序的配置并将这些不同的语言指向不同的 URL？

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2010-03-16T14:58:37.927

您还可以在此处查看[ASP.NET MVC 2 本地化完整指南](http://adamyan.blogspot.com/2010/02/aspnet-mvc-2-localization-complete.html)和[ASP.NET MVC 2 模型验证与本地化](http://helios.ca/2010/02/17/asp-net-mvc-2-model-validation-with-localization/)，如果您使用 ASP.NET MVC 2，这些内容将对您有所帮助。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-10-10T20:03:25.340

您将以与经典 ASP.NET Web 窗体应用程序相同的方式本地化您的 ASP.NET MVC 应用程序。

您不会为每种语言使用不同的页面/视图，但每个页面都将使用附属程序集支持多种语言。

您可以查看[Matt Hawley 的博客条目](http://blog.eworldui.net/post/2008/05/ASPNET-MVC---Localization.aspx)以获取更多解释和示例。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-08-04T18:27:07.587

不幸的是，Matt Hawley 的原始代码在 ASP.NET MVC 的发布版本中不起作用。查看更新的帖子：[http ://blog.eworldui.net/post/2008/10/ASPNET-MVC-Localization-via-View-Engines.aspx](http://blog.eworldui.net/post/2008/10/ASPNET-MVC-Localization-via-View-Engines.aspx)

一般来说，本地化过程在 VS 2008 / ASP.NET MVC 世界中不如在传统 Web 表单中顺利。[http://www.guysmithferrier.com/post/2009/05/Localizing-ASPNET-MVC.aspx](http://www.guysmithferrier.com/post/2009/05/Localizing-ASPNET-MVC.aspx)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-11T05:54:54.587

看看 Rob Connery 的 MvcStore 项目。他做了一个截屏视频，展示了解决全球化问题的一种方法。

[http://wekeroad.com/2008/04/24/mvcstore-part-5](http://wekeroad.com/2008/04/24/mvcstore-part-5)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-11-24T15:54:51.170

我从来不相信像 Elijah 建议的那样在表单中处理本地化 - 不同的长度和方向可能会导致非常复杂或变化不定的表单。

我只是从 MVC 开始，但采用解耦方法，无论语言如何，您都希望使用相同的控制器（将语言视为视图） - 这将为您提供 /Controller/Action/language/form

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-07-29T14:44:04.150

关于如何本地化 asp.net mvc 应用程序的最新更新有很好的教程，涵盖所有方面，包括 DisplayName 本地化、验证、使用路由（在 URL 中存储文化名称）、输出缓存问题等等...... [Alex Adamyan 博客 - 虽然我的键盘轻轻地哭泣](http://adamyan.blogspot.com)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-10-10T15:31:18.973

实际上，我们完全不同的是重写了 [DataAnnotationsMetadaDataProvider](http://msdn.microsoft.com/en-us/library/system.web.mvc.dataannotationsmodelmetadataprovider%28v=vs.108%29.aspx)。在那里，您可以确保将 DisplayNameAttribute 值解析为正确的语言。实际上，只有在有帮助的情况下，您甚至可以摆脱该属性并通过字段名称解析。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-04-22T01:37:20.340

我不久前写了这篇文章。它使用自定义视图引擎。 [http://blog.oimae.com/2011/02/20/cultured-view-engine-for-mvc/](http://blog.oimae.com/2011/02/20/cultured-view-engine-for-mvc/)

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2010-06-26T11:25:41.197

还有另一个针对不同解决方案的教程

[教程：使用语言检测创建 ASP.NET MVC 本地化](http://blog.kosev.net/2010/06/tutorial-create-aspnet-mvc-localization.html)

# c# - 从 .Net 连接到 Informix 数据库

> ID：192477
> 
> 赞同：4
> 
> 时间：2008-10-10T18:02:22.387
> 
> 标签：c#, .net, database-connection, informix

从 .Net 连接到 Informix 数据库的最佳方式是什么？

我正在开发一个基于传统 Informix DB 的客户端-服务器应用程序，该数据库曾经通过 JDBC 连接。

我需要它，从最重要到最不重要：

1.  要快
2.  不需要更改数据库服务器
3.  除了 de .Net Framework 2.0 之外，没有 ODBC 和依赖项

在此先感谢您的帮助。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-10T18:14:59.380

可以在[此处](http://www.connectionstrings.com/?carrier=informix)找到与 OleDb 或 ADO.NET 一起使用的连接字符串。

查看这篇[文章](https://www.ibm.com/developerworks/data/library/techarticle/dm-0510durity/index.html)，了解如何使用 ADO.NET 连接到 Informix 数据库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-10T18:19:12.710

我们从 .NET 连接到 Informix，但我们通过用 FourJ 的 BDL 编写的 Web 服务来实现

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-10T18:18:28.517

[http://publib.boulder.ibm.com/infocenter/idshelp/v10/index.jsp?topic=/com.ibm.relnotes.doc/uc3/netrel.htm](http://publib.boulder.ibm.com/infocenter/idshelp/v10/index.jsp?topic=/com.ibm.relnotes.doc/uc3/netrel.htm)

看看是否有帮助。另外，内置的 ODBC 或 OLEDB 驱动程序呢？你试过那些吗？这些可能会奏效。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-18T12:48:51.767

您可能想研究 ADO.Net 的 OpenLink 多层 Informix 驱动程序（只需在客户端上安装所有内容）：[http ://uda.openlinksw.com/dotnet/mt/dotnet-informix-mt/](http://uda.openlinksw.com/dotnet/mt/dotnet-informix-mt/)

# svn - 从 SVN 获得有用的报告 - 非代码文件弄乱了统计数据

> ID：192484
> 
> 赞同：2
> 
> 时间：2008-10-10T18:05:48.213
> 
> 标签：svn, logging, metrics

我的项目有一个 SVN 存储库；它保存代码、文档、图表等。与项目相关的所有内容都在那里并进行了版本控制。但是，我正在尝试为我的代码获取某种智能统计信息。我使用的统计程序是 StatSVN——据我所知，它们似乎是同类中最好的。但是，我得到了旧文件、Word 文件等的结果，这些结果使图表出现偏差。

解决这个问题并获得有关我的 cpp 文件的可靠信息的想法？我不只是想重建回购，但我担心这可能是目前最好的主意......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-16T04:15:56.827

我构建了 StatSVN，目前正在维护它:)

您可以根据文件名和文件夹使用排除。看看我们的[维基](http://wiki.statsvn.org/User%20Manual.ashx)！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-10T18:35:06.173

尝试将您的非代码项设置为[外部](http://svnbook.red-bean.com/en/1.5/svn.advanced.externals.html)项，并在您想要运行报告时忽略外部项。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-10T18:10:58.623

它可能是也可能不是您要查找的内容，但我编写了一个基于 Web 的应用程序，该应用程序创建了从提交消息到 SubVersion 的报告。它仍然很轻，没有真正的统计数据或类似的东西，但它可能会有所帮助。

[http://krazyyak.com/svnreport](http://krazyyak.com/svnreport)

# tortoisesvn - trac 和 svn（乌龟）-“问题跟踪插件”-（是的，又一个 svn 和 trac 问题）

> ID：192502
> 
> 赞同：2
> 
> 时间：2008-10-10T18:11:17.157
> 
> 标签：tortoisesvn, bug-tracking, trac

我希望能够“从问题跟踪器获取信息”，如“从问题跟踪器获取信息”部分所述：http: [//tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-bugtracker。 html](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-bugtracker.html) （当用户在 svn 中启动提交操作时向用户显示一个 dlg 框，以便他们可以从分配给他们的问题列表中选择）

我曾尝试查找有关 tortoisesvn 的 COM 插件的信息，但实际上并未成功找到。有许多指向页面的链接等说明了可能的情况，但我不想写一个，希望有一个。

任何人都可以对此有所了解或为我的客户指出一个插件吗？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-11T15:20:51.043

在 TSVN 源代码的 contrib/ 目录中有 IBugTraqProvider 的示例实现。一个在 ATL 中；它运行一个 EXE，传递（除其他外）一个临时文件名供提供者写入提交消息。该 EXE 应该与您的问题跟踪器对话。

另一个在 C# 中；它显示了一些模拟数据，但可以根据需要进行扩展。

还有其他几个：[Gurtle](http://code.google.com/p/gurtle/)与 Google Code 对话；[这里](http://tracexplorer.devjavu.com/)有一个用于 Trac 的。

# language-agnostic - 内存映射文件的优点是什么？

> ID：192527
> 
> 赞同：97
> 
> 时间：2008-10-10T18:19:29.823
> 
> 标签：language-agnostic, memory, filesystems

我一直在为一个项目研究内存映射文件，如果以前使用过它们或决定不使用它们的人的任何想法，我将不胜感激，为什么？

我特别关注以下问题，按重要性排序：

*   并发
*   随机访问
*   表现
*   便于使用
*   可移植性

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2008-10-10T20:01:06.780

我认为优势在于您减少了与传统读取文件方法相比所需的数据复制量。

如果您的应用程序可以“就地”使用内存映射文件中的数据，那么它可以在不被复制的情况下进入；如果您使用系统调用（例如 Linux 的 pread() ），那么这通常涉及内核将数据从其自己的缓冲区复制到用户空间。这种额外的复制不仅需要时间，而且会通过访问这些额外的数据副本而降低 CPU 缓存的效率。

如果实际上必须从磁盘读取数据（如在物理 I/O 中），那么操作系统仍然必须读取它们，页面错误可能不会比系统调用更好的性能，但如果它们不要（即已经在操作系统缓存中），理论上性能应该要好得多。

不利的一面是，内存映射文件没有异步接口 - 如果您尝试访问未映射的页面，它会生成页面错误，然后使线程等待 I/O。

* * *

内存映射文件的明显缺点是在 32 位操作系统上 - 您很容易用完地址空间。

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2008-10-10T19:04:47.363

我在用户键入时使用了内存映射文件来实现“自动完成”功能。我在单个索引文件中存储了超过 100 万个产品部件号。该文件具有一些典型的标题信息，但文件的大部分是按关键字段排序的固定大小记录的巨大数组。

在运行时，文件被内存映射，转换为`C`-style`struct`数组，我们进行二进制搜索以在用户键入时找到匹配的部件号。实际上从磁盘中只读取了文件的几个内存页面——无论是在二进制搜索期间命中的页面。

*   并发性 - 我遇到了一个实现问题，有时它会在同一个进程空间中多次内存映射文件。我记得这是一个问题，因为有时系统找不到足够大的空闲虚拟内存块来映射文件。解决方案是只映射文件一次，然后对它进行所有调用。回想起来，使用成熟的 Windows 服务会很酷。
*   随机访问 - 二进制搜索肯定是随机访问并且闪电般快速
*   性能 - 查找速度非常快。当用户键入时，弹出窗口会显示匹配的产品部件号列表，该列表会随着他们继续键入而缩小。打字时没有明显的延迟。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-10-10T19:03:51.920

内存映射文件可用于替换读/写访问，或支持并发共享。当您将它们用于一种机制时，您也会得到另一种机制。

与其在文件中查找、写入和读取，不如将其映射到内存中并简单地访问您期望它们所在的位。

这可以非常方便，并且根据虚拟内存接口可以提高性能。性能改进可能会发生，因为操作系统现在可以管理这个以前的“文件 I/O”以及所有其他程序内存访问，并且可以（理论上）利用它已经用来支持的分页算法等程序*其余部分*的虚拟内存。但是，它确实取决于底层虚拟内存系统的质量。我听说 Solaris 和 *BSD 虚拟内存系统可能比 Linux 的 VM 系统表现出更好的性能改进——但我没有经验数据来支持这一点。YMMV。

当您考虑多个进程通过映射内存使用相同“文件”的可能性时，并发性就出现了。在读/写模型中，如果两个进程写入文件的同一区域，您可以确信其中一个进程的数据会到达文件中，并覆盖另一个进程的数据。你会得到一个，或者另一个——但不是一些奇怪的混合。我不得不承认我不确定这是否是任何标准规定的行为，但这是你几乎可以依赖的东西。（这实际上是一个很好的后续问题！）

相反，在映射的世界中，想象两个过程都“写作”。他们通过执行“内存存储”来做到这一点，这导致 O/S 最终将数据分页到磁盘。但与此同时，可能会发生重叠写入。

这是一个例子。假设我有两个进程都在偏移量 1024 处写入 8 个字节。进程 1 正在写入“11111111”，进程 2 正在写入“22222222”。如果他们使用文件 I/O，那么你可以想象，在 O/S 的深处，有一个充满 1s 的缓冲区和一个充满 2s 的缓冲区，它们都指向磁盘上的同一个地方。其中一个将首先到达那里，另一个将在第二个到达那里。在这种情况下，第二个获胜。 **但是**，如果我使用内存映射文件方法，则进程 1 将使用 4 字节的内存存储，然后是另一个 4 字节的内存存储（假设这不是最大内存存储大小）。过程 2 将做同样的事情。根据进程运行的时间，您可能会看到以下任何内容：

```
11111111
22222222
11112222
22221111 
```

对此的解决方案是使用显式互斥——无论如何这可能是一个好主意。无论如何，在读/写文件 I/O 情况下，您有点依赖 O/S 来做“正确的事情”。

分类互斥原语是互斥体。对于内存映射文件，我建议您查看内存映射互斥锁，可以使用（例如）pthread_mutex_init()。

用一个陷阱进行编辑：当您使用映射文件时，很容易将指向文件中数据的指针嵌入文件本身（想想存储在映射文件中的链表）。您不想这样做，因为文件可能在不同时间或在不同进程中映射到不同的绝对地址。相反，使用映射文件中的偏移量。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-10T18:21:07.107

并发将是一个问题。随机访问更容易性能好到好。便于使用。没那么好。便携性- 不那么热。

我很久以前在 Sun 系统上使用过它们，这些是我的想法。

# xhtml - 在 hCalendar 微格式中，描述中允许使用哪些标记？

> ID：192538
> 
> 赞同：1
> 
> 时间：2008-10-10T18:22:54.060
> 
> 标签：xhtml, microformats, hcalendar

我正在开发一个以[hCalendar 格式](http://microformats.org/wiki/hcalendar)输出事件列表的日历应用程序。这包括一个具有“ `description`”类的元素，应该用于事件的描述。我的问题是，**我的 hCalendar 事件描述中允许使用哪些标记？**

我在 hCalendar 网站上找到了一个示例，其中显示了带有`<br />`标签的描述，但其他所有示例都很简短，并且在描述中没有额外的标记。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-11T12:15:34.740

就微格式而言，您可以在描述（以及其他任何地方）中使用任何有效的 HTML 标记。

但是，通常用于提取 hCalendars的[iCalendar格式只允许在描述中使用纯文本。](https://www.rfc-editor.org/rfc/rfc2445#section-4.8.1.5)

使用您需要的任何标记，但要做好准备，Microformat 解析器会将其转换为纯文本，因此可能只有`<br>`,`<p>`会起作用，而其他元素将不起作用。

# .net - 使用异步委托或 ThreadPool.QueueUserWorkItem 进行大规模并行？

> ID：192539
> 
> 赞同：6
> 
> 时间：2008-10-10T18:23:13.017
> 
> 标签：.net, multithreading, asynchronous, threadpool

我有一个 .NET 应用程序，它在批量导入中处理大约 300,000 条记录，每条记录需要几秒钟，所以我想并行化它。`ProcessWithAnsycDelegates()`在下面的代码中，和有什么区别`ProcessWithThreadPool()`？

```
public class ResultNotification
 { public EventHandler event Success;
   public EventHandler event Fail;
   internal void Notify(bool sucess) {if (success) Success(); else Fail();}
 }

public static class Processor
 { public ResultNotification ProcessWithAnsycDelegates(Record record)
    { var r = new ResultNotification();
      Func<Record,bool> processRecord=new RecordProcessor().ProcessRecord;
      processRecord.BeginInvoke
                     ( record
                      ,ar => result.Notify(processRecord.EndInvoke(ar))
                      ,null); 
      return r;    
    }

   public ResultNotification ProcessWithThreadPool(Record r)
    { var r  = new ResultNotification();
      var rp = new RecordProcessor();
      ThreadPool.QueueWorkUserItem(_=>result.Notify(rp.ProcessRecord(r)));
      return r;
    }
 } 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-11T21:08:29.203

这个问题的字面答案是两者都使用线程池，所以如果性能是唯一的考虑因素，差异并不大。

如果问题真的是关于获得最佳性能，那么知道使用线程池确实存在问题可能会有所帮助。这些包括：

*   工作队列上的锁争用
*   过多的上下文切换。如果您有 2 个 CPU 和一系列工作项，那么 25 个线程并没有真正的帮助。最好有 2 个线程，每个 CPU 一个

可能值得研究 TPL 和 PLINQ：

*   [在多核处理器上运行并行 LINQ 查询](http://msdn.microsoft.com/en-gb/magazine/cc163329.aspx)
*   [多核机器的并行性能优化托管代码](http://msdn.microsoft.com/en-gb/magazine/cc163340.aspx)
*   [在下一版本的 Visual Studio 中改进了对并行性的支持](http://msdn.microsoft.com/en-gb/magazine/cc817396.aspx)

他们给出的使用 TPL 的一个例子是：

```
for (int i = 0; i < 100; i++) { 
  a[i] = a[i]*a[i]; 
} 
```

到：

```
Parallel.For(0, 100, delegate(int i) { 
  a[i] = a[i]*a[i]; 
}); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-10T18:36:29.323

在这种情况下，不是很多，因为他们都使用引擎盖下的线程池。我会说 QueueUserWorkItem() 更容易阅读和查看与 BeginInvoke 相比发生了什么。

此链接可能会有所帮助。这是较旧的信息，但仍然主要适用 [http://www.yoda.arachsys.com/csharp/threads/threadpool.shtml](http://www.yoda.arachsys.com/csharp/threads/threadpool.shtml)

# ip-address - 使用受限帐户更改 IP 地址

> ID：192544
> 
> 赞同：0
> 
> 时间：2008-10-10T18:24:16.913
> 
> 标签：ip-address

这是我需要做的，任何想法都会有所帮助。

作为 XP 中的受限用户，我需要能够以编程方式更改计算机的本地 IP 地址。不向用户提供管理员信息。我玩过 runas、sanur 和 autoit，但它们要么需要放弃管理员密码，要么不太可靠。

同样，任何想法都会很棒。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-10T18:28:48.200

您可能应该创建一个具有管理权限的服务，并允许有限的用户从该服务请求更改 IP。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-10T18:32:05.073

尼尔是对的，您可以通过服务来做到这一点。您需要构建和安装服务，并创建一个可以在有限用户模式下运行的小型客户端，该客户端将命令服务更改 IP。

但是，在你走这条路之前，我不得不问：你为什么要更改计算机的 IP 地址？我想知道您是否将其作为解决可能具有不同解决方法的其他问题的解决方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-10T19:55:18.507

我想您可以简单地使用管理员凭据调用[LogonUser](http://msdn.microsoft.com/en-us/library/aa378184(VS.85).aspx)，然后从那里进行更改。当然，这需要将密码嵌入到 EXE 中。

# windows-installer - 有没有办法使用自定义操作更改开始菜单链接名称的名称

> ID：192545
> 
> 赞同：0
> 
> 时间：2008-10-10T18:24:20.690
> 
> 标签：windows-installer, startmenu

我们正在本地化我们的应用程序，需要根据当前的 UI 文化更改“开始”菜单中显示的名称。我们希望在安装期间使用自定义操作来执行此操作。我们正在使用 Windows Installer 部署项目，不打算使用任何第三方部署工具。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-23T19:48:42.573

CustomAction 不能修改数据库的内容（它在执行时是只读的）。您必须接管快捷方式的整个创建过程。在这样做之前，我会推荐一个更好的 Windows Installer 创建工具，因为您需要编写大量代码来处理安装和卸载以及引用计数的回滚场景。

有比 Visual Studio 部署项目更好的工具。一些像[WiX 工具集](http://wix.sourceforge.net)是免费的（功能齐全但工作更多）。

# maven-2 - 这是构建代码库的正确方法吗？

> ID：192546
> 
> 赞同：1
> 
> 时间：2008-10-10T18:24:38.987
> 
> 标签：maven-2, netbeans

我们有一个 Java 代码库，它目前是一个基于 Web 的 Netbeans 项目。随着我们的组织和代码库的增长，显然我们应该将系统的各个独立部分划分为单独的 jar。因此，一个 Jar 库用于数据访问层，一个用于通用库，一个用于专业知识访问，等等。然后我们将有一个单独的 Web 应用程序项目，一个用于命令行工具应用程序，另一个最终的网络应用程序等。

执行和管理此操作的推荐做法是什么？是马文吗？通过简单地创建单个项目并将一个项目的依赖关系设置在其他项目的 jar 文件上，仅使用 Netbeans 就可以有效地完成这一切吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-10T19:45:39.493

我同意上面的 SteveG 使用 Maven2 来帮助您模块化代码库，但我会使用[Nexus](http://nexus.sonatype.org/)作为 Maven 的本地存储库而不是 Archiva。Sonatype 的人也有一本关于如何使用 Maven、Nexus 并将其集成到 IDE 的优秀（免费 html/pdf）书。

不过，在决定如何划分项目时要小心。仅仅为了它而过度复杂化你的依赖是没有意义的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-10T18:39:11.063

我会创建[ant](http://ant.apache.org/)脚本来构建和部署。那么您就不会依赖您的 IDE 进行构建/部署。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-10T18:41:29.467

我肯定会说检查 Maven(2)。做这种事情非常好。您可以很容易地定义单个模型和版本。Netbeans 在集成方面也做得不错。

此外，我建议您设置[Archiva](http://archiva.apache.org/)，它可以让您依赖公司内部生成的其他工件的二进制文件。这也充当代理，并将保留项目可能具有的任何外部依赖项的本地副本，因此可以非常快速地在内部获取新版本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-10T18:48:18.270

听起来您的代码已经到了从 WAR 方法毕业并进入 EAR 级别的地步。

EAR 只是另一个包含所有其他 JAR 和 WAR 的档案，这些 JAR 和 WAR 被组合起来创建一个应用程序。有四种类型的模块可以驻留在其中，Web、EJB、连接器和实用程序。大多数人只使用 Web 和实用程序，因此他们使用 WEB-INF/lib 方法。

但是，如果您开始有很多相互依赖关系，那么您应该创建一个 EAR 项目并让您的 Web 项目成为它的子项目。每个实用程序 JAR 都是其他模块使用的直接 Java 代码，也成为 EAR 的子项。最后，在您的每个项目中都应该有一个 META-INF/manifest.mf 文件，其中包含 JAR/WAR 所依赖的 JAR 的名称。

我是一个 eclipse 的人，大部分这些都在 eclipse 中为你处理，但我确信 netbeans 具有非常相似的功能。

现在唯一的问题是您必须使用完整的 Java EE 服务器来部署 EAR，因此如果您当前正在使用 Tomcat，我认为您不能使用 Tomcat。

# ruby-on-rails - 如何使用来自同一个 rails 控制器的不同 RJS 模板？

> ID：192549
> 
> 赞同：2
> 
> 时间：2008-10-10T18:25:14.773
> 
> 标签：ruby-on-rails, ruby, rjs

我有一个控制器方法，它返回一个以部分呈现的下拉列表，但根据使用部分的位置，RJS 模板需要不同。我可以将参数传递给将确定使用哪个 RJS 的控制器吗？

这是控制器方法，很简单：

```
def services
   respond_to do |format|
     format.js {
       @type     = HospitalCriteria.find_by_id(params[:type_id])
       @services = @type.children.all
     }
   end
end 
```

这是自动呈现的 rjs 模板

```
page.replace_html 'select_service', :partial => 'hospital/services'
page.replace_html 'select_condition', :partial => 'hospital/conditions'
page.replace_html 'select_procedure', :partial => 'hospital/procedures'

page << 'if ($("chosenType") != null) {'
  page.replace_html 'chosenType', @type.name
  page.replace_html 'chosenService', 'Selected Service'
  page.replace_html 'chosenCondition', 'Selected Condition'
  page.replace_html 'chosenProcedure', 'Selected Procedure'
page << '}' 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-10T20:24:05.877

我喜欢 Mike 的回答，但从设计的角度来看，这里需要考虑一些事情：

在我看来，这应该在视图层中——如果动作在语义上是相同的，但呈现方式不同，也许有两个不同的 rjs 部分，并且做类似下面的事情更符合 MVC？

```
if params[:use_alternate]
  render :partial => "case_1.rjs"
else
  render :partial => "case_2.rjs"
end 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-13T09:27:56.103

将条件逻辑放在**一个**rjs 模板中怎么样？

```
# services.rjs

if @type == "your conditions"
  # your rjs updates
else
  # your other rjs updates
end 
```

这为您提供了一个更干净的控制器，并为您省去了维护多个 rjs 模板的麻烦。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-10T20:03:55.933

就像是：

```
if params[:use_alternate]
  render :template => alternate.rjs and return
end 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-10T22:12:59.137

为了保持干净，我有两个控制器方法来呈现两个不同的 RJS。然后我会在两个控制器方法调用的公共受保护方法中设置@type 和@services。

在我看来，您在每种情况下都要求不同的东西，因此请调用不同的控制器方法。传入一个标志来改变方法的工作方式只是一个技巧，当你有 3、4 或 5 个位置时，它不会很好地扩展。即使您将生成更多代码，它也会更容易维护。

# asp.net-mvc - ASP.net MVC 自定义字符串输出重载运算符 <%=h

> ID：192553
> 
> 赞同：0
> 
> 时间：2008-10-10T18:26:33.070
> 
> 标签：asp.net-mvc, html-encode

我目前正在创建一个新的 ASP.net MVC 网站，并且发现自己到处都在使用 Html.Encode，这是一种很好的做法，但会变得非常混乱。我认为清理这个的一个好方法是如果我可以重载一个运算符来自动进行 Html 编码。

之前：

```
<%= Html.Encode( ViewData['username'] ) %> 
```

相当于：

```
<%=h ViewData['username'] %> 
```

任何人都有任何想法我可以如何做到这一点，也许使用扩展方法或其他东西？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-10T18:39:49.783

它不像运算符重载那么干净，但我使用了以下扩展方法：

```
public static string Safe(this string sz)
{
    return HttpUtility.HtmlEncode(sz);
} 
```

所以在我的 aspx id 中：

```
<%= this.ViewData["username"].Safe() %> 
```

在我看来，将额外的方法添加到表达式的末尾比通过函数发送值更漂亮。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2008-10-10T18:31:34.560

**注意：这是一个丑陋且未经测试的黑客，我不认为我会这样做**

```
public static String h (this System.Object o, System.Object viewData)
{
    return Html.Encode(viewData);
} 
```

我不确定 ViewData 是什么类型，所以我在这里使用了 Object，最好在真实代码中实际更改类型。

这通过将扩展方法挂在 System.Object 上来工作，因此它始终适用于所有类型......丑陋，但它可以完成这项工作：

```
<%=h(ViewData['username']) %> 
```

# visual-studio - 是否有用于对构建输出进行排序的 Visual Studio 插件（从多线程构建中加扰）？

> ID：192561
> 
> 赞同：2
> 
> 时间：2008-10-10T18:30:20.503
> 
> 标签：visual-studio, plugins

我的工作只是给了我一台四核计算机，WOW 构建时间很快！（过去需要 20 多分钟，现在需要 7 分钟）。

无论如何，Visual Studio 并行构建项目（非常适合构建时间），但会打乱输出：

```
1>Performing Makefile project actions
3>arg.c
2>msg.c
3>log.c
4>test.c

(and so on....) 
```

是否有一个插件可以在构建完成时对输出进行排序？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-10T18:33:53.727

在输出和错误窗格的“显示输出自”下拉列表中选择“构建顺序”项可能符合您的要求。

# javascript - Firefox '错误加载脚本' 在 FF2 中加载 Google Analytics

> ID：192570
> 
> 赞同：13
> 
> 时间：2008-10-10T18:33:22.433
> 
> 标签：javascript, firefox, google-analytics

我正在处理的项目使用 window.onerror 事件处理程序来报告用户问题。我注意到一个用户似乎无法加载 Google Analytics 脚本。我们的网站没有看到很多流量，所以我不确定这有多广泛，但到目前为止它似乎只影响一个用户。

他的用户代理是：“Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.17) Gecko/20080829 Firefox/2.0.0.17”。
Firefox 给出的错误消息是：“加载脚本错误”。

**附加说明**：该站点引用了其他几个 javascript 文件。但是，分析引用是唯一指向外部域的引用，也是页面底部的唯一脚本引用，就在结束正文标记之前。

有没有其他人遇到过这个问题，或者知道可能是什么问题？谢谢！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2011-10-07T10:32:53.317

在所有脚本完成加载之前在 Firefox 中离开页面时会出现此问题。所以我认为忽略这个错误是安全的。

您在 Firefox 错误控制台中看不到此错误，但您可以通过将警报绑定到 window.onerror 事件来使其可见。然后您将能够在一小段时间内看到警报框，并在错误控制台中收到以下错误：

```
[11:35:57.428] uncaught exception: [Exception... "prompt aborted by user"  nsresult: "0x80040111 (NS_ERROR_NOT_AVAILABLE)"  location: "JS frame :: resource:///components/nsPrompter.js :: openTabPrompt :: line 462"  data: no] 
```

我正在使用以下检查在我的 onerror 处理程序中忽略此错误：

```
if (navigator.userAgent.search('Firefox') != -1 && message === 'Error loading script') {
    // Firefox generates this error when leaving a page before all scripts have finished loading
    return;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T23:22:16.560

我有一个包含 80 多个页面的网站，所有页面都使用 JavaScript 错误捕获。我的网站每天提供超过 2000 个页面，我每天从 Firefox 浏览器收到大约十个“错误加载脚本”脚本错误。它开始让我非常恼火，我开始确信这是 Firefox 中的一个问题。

我可以忽略 NOSCRIPT 建议，因为脚本加载在我的页面头部，没有 NOSCRIPT 标记。

我可以忽略“外部域”的建议，因为我有两个站点遇到此问题，并且在这两种情况下，JS 库文件都位于站点自己的服务器上。

我使用 JavaScript Lint 仔细检查了每个库文件和网页，发现了脚本错误和有问题的脚本技术。所有这些问题都已得到纠正，但这并没有为“加载脚本错误”问题提供任何解决方法。

我的页面确实加载了几个没有这个问题的 JavaScript 库文件，唯一的区别是文件的大小。大多数文件小于 5KB，但问题文件为 17KB。

库文件的大小可能是问题吗？

啊！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-10T18:36:37.310

这是一个相当随机的猜测，但我想知道用户是否使用像 NoScript 这样的插件来控制脚本执行，并且不允许来自 Google Analytics 的脚本运行。我知道这是可能的，因为这是我所做的 :) 我不知道这是否会显示为您所看到的错误。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-06-25T21:55:24.920

我们遇到了同样的问题，在检查我们的 CDN 日志后，我们发现当脚本返回 HTTP 状态“304 Not Modified”时，Firefox 会触发 onerror 事件，因此缓存命中。事实上，Firefox（在撰写本文时使用 Firefox 12 进行了测试）似乎会触发除“200 Ok”之外的所有 HTTP 状态的 onerror 事件。其他浏览器在我们的实验中表现不同：Chrome (19) 仅在“需要 407 代理身份验证”时触发 onerror，而 Opera (12) 在 100、101、204、4xx 和 5xx 上触发。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-07-15T02:24:14.163

我确信这已经解决了很久.. 但对于任何偶然发现此页面的人：当外部脚本无法加载时，此错误由 firefox 触发（很容易在源代码中找到触发此错误的代码）。我们在我们的网站上发现了这些错误，结果发现我们正在为脚本返回 404，因此我建议将您的日志视为此错误的一个可能来源。

# data-transfer - 将用户名从一个论坛转移到另一个？

> ID：192575
> 
> 赞同：0
> 
> 时间：2008-10-10T18:34:53.773
> 
> 标签：data-transfer, vbulletin

如何将 vBulletin 论坛的用户转移到新安装的 IceBB？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-10T19:13:17.267

大概，他们都有某种数据库后端，对吧？SQL 转储，然后用你最喜欢的脚本语言修补东西，然后是 SQL 加载，似乎是可行的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-06T15:12:40.367

有一个名为[ImpEx](http://www.vbulletin.com/forum/showthread.php?p=982086)的工具供 vBulletin 执行此操作。它导入和导出用户和数据。与使用 ImpEx 相比，自己执行 SQL 可能容易出错且困难。

# python - TFS Web 服务文档

> ID：192579
> 
> 赞同：11
> 
> 时间：2008-10-10T18:36:02.413
> 
> 标签：python, web-services, api, tfs

我们使用大量 python 来完成大部分部署，并且可以方便地连接到我们的 TFS 服务器以获取有关迭代路径、票证等的信息。我可以看到 web 服务，但找不到任何文档。只是想知道是否有人知道任何事情？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-10T19:43:39.717

Microsoft 没有记录 Web 服务，因为它不是官方支持的与 TFS 对话的途径。官方支持的路线是使用他们的[.NET API](http://msdn.microsoft.com/en-us/library/bb130146(VS.80).aspx)。

对于您的应用程序，我通常推荐的做法是创建您自己的 Web 服务 shim，它位于 TFS 服务器（或其他服务器）上，并使用它们的 API 与服务器通信，但允许您呈现数据以一种很好的方式添加到您的应用程序。

他们的对象模型极大地简化了交互（取决于您想要做什么），因此它实际上意味着总体上更少的代码 - 但更好的测试和可测试代码，您还可以解决诸如 NTLM auth 使用的事情TFS 网络服务。

希望有帮助，

马丁。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2015-02-20T23:32:38.197

所以，这个问题太老了，但让我来看看它（因为它不断出现在我的谷歌搜索中）。

本地 TFS 没有官方支持的 API（MSFT 托管的 API 有[http://www.visualstudio.com/en-us/integrate/api/overview](http://www.visualstudio.com/en-us/integrate/api/overview)）。

也就是说，您始终可以使用 Fiddler ( [http://www.telerik.com/fiddler](http://www.telerik.com/fiddler) ) 或类似的东西来检查 TFS 的 Web 客户端对服务器进行的调用，并施展魔法将这些调用转换为脚本在你想要的python中。

您需要在一个服务帐户下运行您的 python 脚本，该服务帐户的 TFS privs 适合于它正在尝试执行的操作（读取、更新、配置......无论如何）。

由于听起来您只是想从 TFS 中读取数据，因此这可能是您获得所需内容的一种非常简单的方法，因为 HTTP 访问 [http://yourserver/tfs/yourcollection/yourproject/_workitems#id=yourworkitemid](http://yourserver/tfs/yourcollection/yourproject/_workitems#id=yourworkitemid) 将把你还给（中途）理智的 html 有效载荷。

如果您想要迭代或团队或其他列表，那么您的服务帐户需要具有适当的管理员权限并点击 [http://yourserver/tfs/yourcollection/yourproject/_admin/_iterations 之类的内容](http://yourserver/tfs/yourcollection/yourproject/_admin/_iterations) 并使用该响应。

# c# - 如何为列表框中的每个项目设置不同的工具提示文本？

> ID：192584
> 
> 赞同：25
> 
> 时间：2008-10-10T18:37:59.820
> 
> 标签：c#, .net, winforms, winapi, listbox

我有一个数据绑定到对象集合的列表框。列表框被配置为显示每个对象的标识符属性。我想显示一个工具提示，其中包含特定于悬停在列表框中的项目的信息，而不是整个列表框的一个工具提示。

我在 WinForms 中工作，感谢一些有用的博客文章整理了一个非常好的解决方案，我想分享它。

我很想看看这个问题是否有其他优雅的解决方案，或者如何在 WPF 中完成。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-10T18:58:20.887

为了解决这个问题，必须解决两个主要的子问题：

1.  确定悬停在哪个项目上
2.  当用户将鼠标悬停在一个项目上，然后在列表框中移动光标并悬停在另一个项目上时，触发 MouseHover 事件。

第一个问题很容易解决。通过在 MouseHover 的处理程序中调用类似以下的方法，您可以确定悬停在哪个项目上：

```
private ITypeOfObjectsBoundToListBox DetermineHoveredItem()
{
    Point screenPosition = ListBox.MousePosition;
    Point listBoxClientAreaPosition = listBox.PointToClient(screenPosition);

    int hoveredIndex = listBox.IndexFromPoint(listBoxClientAreaPosition);
    if (hoveredIndex != -1)
    {
        return listBox.Items[hoveredIndex] as ITypeOfObjectsBoundToListBox;
    }
    else
    {
        return null;
    }
} 
```

然后根据需要使用返回值设置工具提示。

第二个问题是，在光标离开控件的客户区域然后回来之前，通常不会再次触发 MouseHover 事件。

您可以通过包装`TrackMouseEvent`Win32API 调用来解决此问题。
在以下代码中，该`ResetMouseHover`方法封装了 API 调用以获得所需的效果：重置控制悬停事件何时触发的底层计时器。

```
public static class MouseInput
{
    // TME_HOVER
    // The caller wants hover notification. Notification is delivered as a 
    // WM_MOUSEHOVER message.  If the caller requests hover tracking while 
    // hover tracking is already active, the hover timer will be reset.

    private const int TME_HOVER = 0x1;

    private struct TRACKMOUSEEVENT
    {
        // Size of the structure - calculated in the constructor
        public int cbSize;

        // value that we'll set to specify we want to start over Mouse Hover and get
        // notification when the hover has happened
        public int dwFlags;

        // Handle to what's interested in the event
        public IntPtr hwndTrack;

        // How long it takes for a hover to occur
        public int dwHoverTime;

        // Setting things up specifically for a simple reset
        public TRACKMOUSEEVENT(IntPtr hWnd)
        {
            this.cbSize = Marshal.SizeOf(typeof(TRACKMOUSEEVENT));
            this.hwndTrack = hWnd;
            this.dwHoverTime = SystemInformation.MouseHoverTime;
            this.dwFlags = TME_HOVER;
        }
    }

    // Declaration of the Win32API function
    [DllImport("user32")]
    private static extern bool TrackMouseEvent(ref TRACKMOUSEEVENT lpEventTrack);

    public static void ResetMouseHover(IntPtr windowTrackingMouseHandle)
    {
        // Set up the parameter collection for the API call so that the appropriate
        // control fires the event
        TRACKMOUSEEVENT parameterBag = new TRACKMOUSEEVENT(windowTrackingMouseHandle);

        // The actual API call
        TrackMouseEvent(ref parameterBag);
    }
} 
```

有了包装器，您只需`ResetMouseHover(listBox.Handle)`在 MouseHover 处理程序的末尾调用，即使光标停留在控件的范围内，悬停事件也会再次触发。

我确信这种方法，将所有代码粘贴在 MouseHover 处理程序中必然会导致触发比实际需要更多的 MouseHover 事件，但它会完成工作。任何改进都非常受欢迎。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2011-07-27T17:14:04.147

使用 MouseMove 事件，您可以跟踪鼠标所在项目的索引，并将其存储在一个变量中，该变量在 MouseMove 之间保持其值。每次触发 MouseMove 时，它​​都会检查索引是否已更改。如果是这样，它将禁用工具提示，更改此控件的工具提示文本，然后重新激活它。

下面是一个示例，其中 Car 类的单个属性显示在 ListBox 中，但是当悬停在任何一行上时会显示完整信息。为了使这个示例工作，您只需要一个名为 lstCars 的 ListBox 和一个 MouseMove 事件和一个在 WinForm 上名为 tt1 的 ToolTip 文本组件。

车型定义：

```
 class Car
    {
        // Main properties:
        public string Model { get; set; }
        public string Make { get; set; }
        public int InsuranceGroup { get; set; }
        public string OwnerName { get; set; }
        // Read only property combining all the other informaiton:
        public string Info { get { return string.Format("{0} {1}\nOwner: {2}\nInsurance group: {3}", Make, Model, OwnerName, InsuranceGroup); } }
    } 
```

表单加载事件：

```
 private void Form1_Load(object sender, System.EventArgs e)
    {
        // Set up a list of cars:
        List<Car> allCars = new List<Car>();
        allCars.Add(new Car { Make = "Toyota", Model = "Yaris", InsuranceGroup = 6, OwnerName = "Joe Bloggs" });
        allCars.Add(new Car { Make = "Mercedes", Model = "AMG", InsuranceGroup = 50, OwnerName = "Mr Rich" });
        allCars.Add(new Car { Make = "Ford", Model = "Escort", InsuranceGroup = 10, OwnerName = "Fred Normal" });

        // Attach the list of cars to the ListBox:
        lstCars.DataSource = allCars;
        lstCars.DisplayMember = "Model";
    } 
```

工具提示代码（包括创建名为 hoveredIndex 的类级别变量）：

```
 // Class variable to keep track of which row is currently selected:
        int hoveredIndex = -1;

        private void lstCars_MouseMove(object sender, MouseEventArgs e)
        {
            // See which row is currently under the mouse:
            int newHoveredIndex = lstCars.IndexFromPoint(e.Location);

            // If the row has changed since last moving the mouse:
            if (hoveredIndex != newHoveredIndex)
            {
                // Change the variable for the next time we move the mouse:
                hoveredIndex = newHoveredIndex;

                // If over a row showing data (rather than blank space):
                if (hoveredIndex > -1)
                {
                    //Set tooltip text for the row now under the mouse:
                    tt1.Active = false;
                    tt1.SetToolTip(lstCars, ((Car)lstCars.Items[hoveredIndex]).Info);
                    tt1.Active = true;
                }
            }
        } 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-12T15:29:06.300

我认为最好的选择是使用数据模板，因为您将列表框数据绑定到对象。所以你可以做这样的事情：

```
<ListBox Width="400" Margin="10" 
         ItemsSource="{Binding Source={StaticResource myTodoList}}">
    <ListBox.ItemTemplate>
        <DataTemplate>
            <TextBlock Text="{Binding Path=TaskName}" 
                       ToolTipService.ToolTip="{Binding Path=TaskName}"/>
        </DataTemplate>
     </ListBox.ItemTemplate>
</ListBox> 
```

当然，您可以将 ItemsSource 绑定替换为您的绑定源，并将绑定路径部分替换为您实际想要显示的列表中对象的任何公共属性。更多详细信息可在[msdn上找到](http://msdn.microsoft.com/en-us/library/ms742521.aspx)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2017-12-19T11:58:17.377

您可以使用这个在 WinForms 中使用 ListBox 的 onMouseMove 事件的简单代码：

```
private void ListBoxOnMouseMove(object sender, MouseEventArgs mouseEventArgs)
{
        var listbox = sender as ListBox;
        if (listbox == null) return;

        // set tool tip for listbox
        var strTip = string.Empty;
        var index = listbox.IndexFromPoint(mouseEventArgs.Location);

        if ((index >= 0) && (index < listbox.Items.Count))
            strTip = listbox.Items[index].ToString();

        if (_toolTip.GetToolTip(listbox) != strTip)
        {
            _toolTip.SetToolTip(listbox, strTip);
        }
} 
```

当然，您必须在构造函数或一些 init 函数中初始化 ToolTip 对象：

```
_toolTip = new ToolTip
{
            AutoPopDelay = 5000,
            InitialDelay = 1000,
            ReshowDelay = 500,
            ShowAlways = true
}; 
```

享受！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-14T04:00:43.170

使用 title 属性，我们可以为列表框中的每个列表项设置工具提示。

循环这个列表框中的所有项目。

```
ListItem li = new ListItem("text","key");
li.Attributes.Add("title","tool tip text"); 
```

希望这可以帮助。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-06-12T15:13:25.410

这是一个使用 ListBox 创建一组 RadioButtons 的 Style。一切都注定要进行 MVVM-ing。MyClass 包含两个字符串属性：MyName 和 MyToolTip。这将显示 RadioButtons 列表，包括正确的 ToolTip-ing。该线程感兴趣的是靠近底部的 ToolTip 的 Setter，使其成为一个全 Xaml 解决方案。

示例用法：

ListBox Style="{StaticResource radioListBox}" ItemsSource="{Binding MyClass}" SelectedValue="{Binding SelectedMyClass}"/>

风格：

```
 <Style x:Key="radioListBox" TargetType="ListBox" BasedOn="{StaticResource {x:Type ListBox}}">
    <Setter Property="BorderThickness" Value="0" />
    <Setter Property="Margin" Value="5" />
    <Setter Property="Background" Value="{x:Null}" />
    <Setter Property="ItemContainerStyle">
        <Setter.Value>
            <Style TargetType="ListBoxItem" BasedOn="{StaticResource {x:Type ListBoxItem}}">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ListBoxItem">
                            <Grid Background="Transparent">
                                <RadioButton Focusable="False" IsHitTestVisible="False" IsChecked="{TemplateBinding IsSelected}" Content="{Binding MyName}"/>
                            </Grid>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
                <Setter Property="ToolTip" Value="{Binding MyToolTip}" />
            </Style>
        </Setter.Value>
    </Setter>
</Style> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-11-12T07:06:04.107

使用`onmouseover`您可以遍历列表的每个项目，并可以显示`ToolTip`

```
onmouseover="doTooltipProd(event,'');

function doTooltipProd(e,tipObj)
{

    Tooltip.init();
      if ( typeof Tooltip == "undefined" || !Tooltip.ready ) {
      return;
      }
      mCounter = 1;
   for (m=1;m<=document.getElementById('lobProductId').length;m++) {

    var mCurrent = document.getElementById('lobProductId').options[m];
        if(mCurrent != null && mCurrent != "null") {
            if (mCurrent.selected) {
                mText = mCurrent.text;
                Tooltip.show(e, mText);
                }
        }   
    }   
} 
```

# excel - 如何在excel中发送带有签名的电子邮件附件

> ID：192592
> 
> 赞同：0
> 
> 时间：2008-10-10T18:39:29.677
> 
> 标签：excel

我想知道如何编写一个宏来发送带有用户签名的 Excel 附件的电子邮件。

不同的用户将使用相同的宏。因此，它应该从用户的位置动态读取任何一个（从多个 html、rtf 和 txt 文件中）签名文件，`C:\Documents and Settings\" & Environ("username") "\Application Data\Microsoft\Signatures\[user file]" OR Environ("APPDATA") & "\Microsoft\Signatures\"`并使用该特定用户的签名发送电子邮件。

请指导我如何实现这一点。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-10T20:40:39.820

如果您打算使用 Outlook 自动化和 Windows XP，可以从以下位置读取签名：

C:\Documents and Settings\\Application Data\Microsoft\Signatures

你会发现三个文件：

.htm (HTML)
.rtf (富文本)
.txt (纯文本)

您可以使用环境变量来获取当前用户和要读取文件的 FileSystemObject。

# .net-2.0 - 使用 SQLDataReader 有哪些优点/缺点？

> ID：192599
> 
> 赞同：5
> 
> 时间：2008-10-10T18:40:46.740
> 
> 标签：.net-2.0

SqlDataReader 是一种处理存储过程的更快方法。使用 SQLDataReader 有哪些优点/缺点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-10T18:46:06.713

我假设您的意思是“而不是将结果加载到数据表中”？

优点：您可以控制数据的加载方式。您可以要求特定的数据类型，除非您愿意，否则您最终不会同时将整个数据集加载到内存中。基本上，如果您想要数据但不需要数据表（例如，您要填充自己的集合），您不会得到中间步骤的开销。

缺点：您可以控制数据的加载方式，这意味着更容易出错并且还有更多工作要做。

你在这里的用例是什么？您是否有充分的理由相信使用普通（或强类型）数据表的开销会严重影响性能？如果我有充分的理由，我只会直接使用 SqlDataReader。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-10T19:03:32.543

关键优势显然是速度——这是您选择 SQLDataReader 的主要原因。

尚未提及的一个潜在缺点是 SQLDataReader 仅向前，因此您只能按顺序浏览一次记录 - 这是允许它如此快速的原因之一。在许多情况下这很好，但如果您需要多次迭代记录或添加/编辑/删除数据，您将需要使用其中一种替代方法。

在您处理完所有记录并关闭阅读器之前，它也会保持连接（当然，您可以选择提前关闭它，但是您将无法访问任何剩余的记录）。如果您要在迭代记录时对记录执行任何冗长的处理，您可能会发现您会影响到数据库的其他连接。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-10T18:45:37.010

这取决于你需要做什么。如果您从数据库中取回一页结果（例如 20 条记录），最好使用数据适配器填充 DataSet，并将其绑定到 UI 中的某些内容。

但是如果您需要处理多条记录，一次处理 1 条，请使用 SqlDataReader。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-10T18:46:32.047

优点：速度更快，内存更少。

缺点：必须保持连接，必须记得关闭阅读器。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2010-01-31T21:38:28.240

数据可能不是决定性的，你无法控制你的行为，为什么路上的送奶工总是随身携带数据，否则他们会被数据破解，警察不会携带任何数据，因为他们认为保留其他人的数据是错误的，这样做是错误的。有一个住在谢菲尔德的女孩，她喜欢出去玩，大部分时间她在家，这就是为什么我不喜欢和她说话，因为她的父母和她的其他朋友被带到了和平花园那是一个地方每个人都喜欢唱歌和留下来。通常有名的名人都会在那里闲逛，但总是有最高的安全性，因为我们不想让他们的尽头被骚扰。KK 现在见你 我需要 2 去西区放松一下 和平!!!£"$$$ Made of Money MAN$$$$

# lisp - 是否有用于 Common Lisp 的文档化、有组织的库集合？

> ID：192602
> 
> 赞同：8
> 
> 时间：2008-10-10T18:42:20.560
> 
> 标签：lisp, common-lisp, documentation-generation

我是一所主要用 Java 教授的学校的大学生。我非常喜欢 Java 的优势之一，就是大量的库集合。使这些库特别有用的是通过 JavaDoc 提供的大量文档和组织。是否有任何具有这些特性的 Common Lisp 库集合，是否有类似于 JavaDoc 的工具可以帮助构建、维护或扩展这些库？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-10T23:39:43.767

[是的，在http://www.cl-user.net](http://www.cl-user.net)、 [http://www.cliki.net](http://www.cliki.net)和[http://clocc.sourceforge.net](http://clocc.sourceforge.net)上有大量记录在案的图书馆收藏。以及使用它们的高级“asdf”或“mk-defsystem”基础设施。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-10T20:47:34.300

不，没有全面的、一致记录的图书馆收藏。不存在这样的东西是 Common Lisp 目前最大的问题。如果你有兴趣帮助 Lisp 社区，这很可能是首先要攻击的东西。

此外，虽然有[各种 JavaDoc 等价物](http://www.cliki.net/Documentation%20tool)，但没有被广泛接受的 Java 准标准。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-07-05T09:09:20.600

现在有了 quicklisp，它让一切变得如此简单！ [http://www.quicklisp.org/](http://www.quicklisp.org/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-10T18:50:00.153

[Github](http://github.com/)包含很多 lisp 项目，更不用说[Sourceforge](http://sourceforge.net/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-10T18:52:57.260

试试 cliki 或 common-lisp.net。

至于 javadoc……你知道 docstrings 吗？如果没有，找出来。还可以了解所有其他自记录功能。

听起来你还没有阅读规范。无论您在做什么，请务必阅读规范。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-22T08:49:26.210

我推荐[clbuild](http://common-lisp.net/project/clbuild)，它包含一组由经验丰富、有眼光的 lisp 程序员编译的高质量库（以及下载和安装这些库的脚本）。

如果您想要编写高级/api 文档的指南，我建议您遵循 Edi Weitz 和其他人设置的示例（例如，请参阅[Hunchentoot](http://www.weitz.de/hunchentoot)、[Vecto](http://www.xach.com/lisp/vecto)）。

对于较低级别的实现文档，我认为内置的文档字符串机制以及[Slime](http://common-lisp.net/project/slime)的源导航和自动文档工具构成了代码探索的最佳现有环境。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-10T19:00:12.613

[Tinna](http://common-lisp.net/project/tinaa/)是一个可与 JavaDoc 相媲美的 Lisp 文档系统。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-17T13:15:24.100

Common Lisp 有许多可用的库，其中许多都有完整的文档记录。JavaDoc，以我自己的经验（或任何此类工具，如用于 C++ 的 Doxygen），不是记录库的有价值的工具，而是记录其实现的更多工具。

所以文档不是这里的工具问题，而是lib作者编写体面手册的意愿。在这个领域，Common Lisp 就像任何其他语言一样：有漂亮的工程和精彩的文档，快速而肮脏的代码，没有丝毫的文档迹象，以及代码和文档质量的所有可能组合......

总而言之，我个人发现 Common Lisp 库的整体质量相当高。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-27T14:53:38.353

如果你习惯了 Java，你可以给[Clojure](http://clojure.org)一个机会，继续使用你知道的 Java 库。

# javascript - jQuery 可滚动、可排序、可过滤的表格

> ID：192608
> 
> 赞同：26
> 
> 时间：2008-10-10T18:44:32.300
> 
> 标签：javascript, jquery, html

我希望利用 jQuery 来处理我们对不同大小的数据表的一些非常常见的请求：滚动、排序和动态过滤。

*   过去，我通过拥有两个具有固定宽度列的单独表格以及用于“实际”滚动的关联 div 容器来处理滚动。但是，此方法不适用于我遇到的任何基于 jQuery 的排序表扩展（到目前为止，tablesorter 是我最喜欢的），因为它们希望将所有内容都放在一个表中。
*   对于过滤，他们要求类似于 Excel 和 SharePoint 列表的方式（基本上所有列值都列在下拉列表中，允许用户选择/取消选择它们）。我还没有看到类似的东西，尽管听起来可能。
*   另一个相关的不错的功能是能够“冻结”一列以进行水平滚动。

理想情况下，我想要一个现有的扩展，但如果没有，我也会感谢任何 jQuery 专家关于如何最好地实现它的建议。我目前的想法是深入研究 tablesorter 并根据需要扩展/更新它。

为了让事情保持专注，分页不是一种选择（与任何基于服务器的东西一样）。

**更新：** 到目前为止，我确实很欣赏这些答案，但是到目前为止给出的选项都没有涉及过滤方面（也就是说，我必须承认 jqGrid 对于我未来的一些项目看起来非常好）。与此同时，我将致力于定制过滤解决方案；如果成功我会再次更新。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2013-02-16T19:07:18.410

我自己在寻找一个可排序的表格插件时遇到了这个问题；我对任何建议的小部件都没有印象，但后来我发现了[DataTables](http://datatables.net/index)，给我留下了深刻的印象。我建议检查一下。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-10T23:37:12.243

也许这个优秀的插件可以做到：

[演示页面](http://trirand.com/jqgrid/jqgrid.html)

它叫做jQGrid，这里是项目页面： [http ://plugins.jquery.com/project/jqGrid](http://plugins.jquery.com/project/jqGrid)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-11T12:52:10.297

我会鼓励你试试[Flexigrid](http://flexigrid.info/)。

它有很多很棒的功能，我个人认为它看起来比 jqGrid 更专业。

它没有您要求的某些功能，但我认为这可能是一个好的开始。如果您可以将其中一些功能添加到代码库中，那就太好了。

如果您使用 c# 进行编码，那么我发布了一篇关于如何使用[LINQ to Reflection 将 JSON 绑定到 Flexigrid 的博客文章](http://webdevdotnet.blogspot.com/2008/07/flexigrid.html)……如果您使用其他语言，您可以在[Flexigrid 的网站](http://flexigrid.info/)和[Google 群组](http://groups.google.com/group/flexigrid?pli=1)页面上找到其他示例。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-05-06T15:13:33.087

一个简单的[jQuery 可滚动表格插件](http://farinspace.com/jquery-scrollable-table-plugin/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-11-16T18:51:42.127

正如我在更新中提到的，我最终使用了自定义过滤扩展（不幸的是，闭源）。我最近开始使用[SlickGrid](https://github.com/mleibman/SlickGrid "SlickGrid")，它现在是我的首选网格。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-01-14T23:16:37.277

我想添加 Laravel 风格的 DataTables（[GitHub](http://github.com/yajra/laravel-datatables)，[jquery DataTables API](https://yajrabox.com/docs/laravel-datatables/master)）——如果你已经在使用 PHP/Laravel，那就完美了。

另外，[koalyptus/TableFilter](https://github.com/koalyptus/TableFilter/)另一个自定义过滤表（实际上是我的最爱）。

# seo - Google Page Rank - 新域/链接结构迁移

> ID：192628
> 
> 赞同：4
> 
> 时间：2008-10-10T18:50:22.150
> 
> 标签：seo, migration, pagerank

我的任务是将纯 HTML 网站重新组织成 CMS。如果一切顺利，新站点最终将成为主 URL，而旧域将被逐步淘汰。旧域的页面排名足够好，该​​公司希望减轻任何页面排名的损失。在查看可用选项时，我发现了一些事情：

*   当您准备好进行切换（[source](http://www.seroundtable.com/archives/007233.html)）时，最好使用 301 重定向。
*   当前站点没有站点地图，因此添加并提交它可能有助于他们未来的页面排名。
*   我需要向他们建议他们联系当前链接到他们的人以更新他们的链接。
*   重新获得旧页面排名的过程需要一段时间，因此在我们查看新站点是否足够灵活以保证完全切换时计划重建链接。

**我的问题是**：由于迁移到 CMS 驱动的站点，到各个页面的链接将发生变化以适应新的结构。这会是试图维持（或提高）当前页面排名的问题吗？有哪些方法可以缓解更改单个页面 URL 的问题？*除了使用 301 重定向将单个页面映射到新位置之外，还有更好的方法吗？（该网站实际上有数百页，呃......）*

```
ex.
http://domain.com/Messy_HTML_page_with_little_categorization.html ->
http://newdomain.com/nice/structured/pages.php 
```

我意识到这不是一个严格的编程问题，但是我觉得这些信息可能对除了网站开发之外还负责处理此类事情的开发人员有用。

**编辑**：斜体字的补充

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-10T19:06:57.047

如果您真的想确保页面排名不会丢失，您将希望将旧内容替换为执行正确 301 重定向到新位置的内容。使用 301 重定向，搜索蜘蛛将知道内容已移动，并且页面排名通常会延续。它还有助于外部链接。

但是，不利的一面是，经过一段时间后，您只需要摆脱旧域即可。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-10T19:14:46.640

您可以为 HTML 文件创建一个处理程序，并使用 301 重定向将旧页面映射到新结构。

# c# - 设置。默认。 始终返回默认值而不是持久存储（XML 文件）中的值

> ID：192641
> 
> 赞同：11
> 
> 时间：2008-10-10T18:53:46.353
> 
> 标签：c#, .net, dll, application-settings

我最近用 C# (.Net 2.0) 编写了一个 DLL，其中包含一个需要 IP 地址的类。我的一位同事更改了类以从“.dll.config”（XML）文件中检索 IP——这显然是由他创建的“应用程序设置”文件（Settings1.settings）自动生成的。这样做的好处是允许最终用户随意更改 XML/config 文件中的 IP 地址。

不幸的是，当我从树中检查他的代码并尝试编译（或使用）这个新代码时，任何调用这个 DLL 的应用程序都只会得到默认值，而不是文件中的值。

调用配置文件的构造函数如下所示：

```
 public class form : System.Windows.Forms.Form
    {
        public form()
        {
            // This call is required by the Windows Form Designer.
            InitializeComponent();
            IP = IPAddress.Parse(Settings1.Default.IPAddress);
        }
    } 
```

我[在 MSDN 论坛上找到了对此问题的参考，](http://social.msdn.microsoft.com/Forums/en-US/clr/thread/f3a4b138-6e6c-42e3-86e8-1f86c90f8fb4/)其中一位用户说：

> “旧”值（您在开发时定义的值）是硬编码的。如果框架无法访问或打开配置文件，它将使用默认值。如果您在 dll 中使用设置，这种情况总是会发生。

1.  这是否意味着我不能在配置文件中存储 DLL 的外部值？（我的同事以某种方式完成了这项工作......）

2.  由于我的框架似乎无法访问或打开配置文件，我该如何找出它失败的原因？甚至检测何时发生这种情况？

**德克尔**：这有点帮助。不幸的是，我正在将此 DLL 写入规范，因此我实际上无法访问应用程序的配置文件。正如您将在上面提到的，我的同事创建了一个“设置**1** .settings”文件。当时我不明白这一点，但现在看来，添加“1”会将其排除在任何调用它的应用程序的设置空间之外。

我想我想弄清楚为什么 DLL 似乎没有在同一目录中找到它旁边的配置文件。一步一步地跟踪代码没有发现任何问题。

顺便说一句，我可以将程序集的“输出类型”从“类库”更改为“Windows 应用程序”，并在 DLL 代码的开头添加以下行：

```
 [STAThread]
    public static void Main(string[] args)
    {
        System.Windows.Forms.Application.Run(new form());
    } 
```

当我运行它时，它会生成一个不同的配置文件（“.exe.config”），我可以更改该文件并让它从文件中提取新数据。所以我有点困惑。有任何想法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-10T19:55:48.913

我一直使用这种技术。通常我有一个需要某些设置的库程序集，我需要通过测试项目以及主要的“可执行”程序集来设置它们——无论是 Web 项目还是 Windows 服务项目。

您是正确的，当您为任何项目创建设置文件时，它会添加一个应用程序配置文件。您为任何设置输入的值存储在两个位置——配置文件和设置基础结构创建的类的属性中。当未找到配置文件时，将使用嵌入在属性中的值。

这是显示此类属性的片段：

这是一个片段，显示了生成的类中 ConcordanceServicesEndpointName 的默认值：

```
 [global::System.Configuration.ApplicationScopedSettingAttribute()]
    [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
    [global::System.Configuration.DefaultSettingValueAttribute("InternalTCP")]

    public string ConcordanceServicesEndpointName {
        get {
            return ((string)(this["ConcordanceServicesEndpointName"]));
        }
    } 
```

您要做的是将配置部分从库程序集项目中的 app.config 文件中复制出来，并将其（小心地）合并到主程序集的适用 web.config 或 app.config 中。在运行时，这是唯一使用的配置文件。

这是一个例子：

```
`<configSections>
    <sectionGroup name="applicationSettings" type="System.Configuration.ApplicationSettingsGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" >
      <section name="LitigationPortal.Documents.BLL.DocumentsBLLSettings" type="System.Configuration.ClientSettingsSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" requirePermission="false" />
    </sectionGroup>
  </configSections>
  <applicationSettings>
    <LitigationPortal.Documents.BLL.DocumentsBLLSettings>
      <setting name="ConcordanceServicesEndpointName" serializeAs="String">
        <value>InternalTCP</value>
      </setting>
    </KayeScholer.LitigationPortal.Documents.BLL.DocumentsBLLSettings>
  </applicationSettings>` 
```

您应该将这些部分复制到“真实”配置文件中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-10T20:18:43.437

我正在原型设计中的应用程序中解决这个确切的问题。尽管 Decker 建议将配置文件一起破解应该可行，但我认为这是一个非常不方便的手动破解，作为构建周期的一部分执行。而不是我决定最干净的解决方案是让每个库解析自己的 library.dll.config 文件。它仍然不完美，它需要一些额外的样板代码，但它似乎是绕过 .Net 处理这些 app.config 文件的拜占庭方式的唯一方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-12T16:52:03.237

我有同样的问题很长一段时间 - 这很烦人。

我喜欢制作自己的配置文件并让每个 DLL 解析它的想法，尽管仍然可能很容易错过不得不更改配置的情况。

我过去做过的至少让这更容易的一件事是确保 Setting1.Settings 文件的任何配置值都无效。

例如，我有一个使用 LINQ-To-SQL 与 DB 对话的类。所以它有一个 Setting1.settings 文件，它将连接到数据库的字符串存储在其中。输入的默认值（在将数据库表拖放到设计器中时）是开发数据库的连接字符串。

一旦我基于测试数据库创建了 DBML 文件，我可以进入并编辑设置文件并输入数据库名称，如“FAKE_DATABASE”。

这样，如果您在另一个项目中使用 DLL，然后忘记合并配置文件以添加正确的 DLL 配置值，至少您会收到类似“无法连接到 FAKE_DATABASE”的错误消息。

当然，如果您必须再次与设计器合作，则必须将值更改回您的开发数据库的值。

巨大的痛苦。他们必须以某种方式改变这一点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-10T19:04:37.177

显然您的应用程序正在尝试从默认配置文件（可能是应用程序的配置文件）中读取。为确保，将dll的配置文件中的键值对添加到应用程序的配置文件中，运行应用程序，看看这次是否被读取。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-10T21:17:04.177

我想我刚刚找到了为什么这对我的 DLL 和我的测试应用程序不起作用的解释。这是某人[博客](http://blogs.interknowlogy.com/robinsanner/archive/2006/05/10/2335.aspx)的结论性例外：

> 解决此问题的方法是确保您的应用程序和支持程序集具有相同的命名空间，或者确保合并 AppName.exe.config 和 DllName.dll.config 的内容（是的，当您编译 .dll 时，它现在会生成此文件，但是如果您将其复制到应用程序目录并且不会自动合并，则会忽略它）

所以要么我必须将 DLL 和应用程序保持在同一个命名空间中 - 要么 - 我必须将 DLL 配置文件的内容与应用程序的配置文件合并。

（这不是违背了 DLL 的目的吗？我认为 DLL 应该是一个独立的库。）

也许这就是为什么它对我的同事有用。生产应用程序与 DLL 共享相同的命名空间。（我的测试应用程序显然没有......）

**更新：** 我最近刚和我的同事坐下来再次谈论这个问题，似乎它也从未对他有用，但他没有意识到这一点，因为他将初始值设置为与我们试图使用的设备。所以当然它一开始似乎可以工作，但是一旦我们将它部署到其他设置略有不同的地方，它就又被破坏了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-10T19:52:33.833

我在使用 app.config 时遇到过类似的问题。尝试从 .exe 而不是从 Visual Studio 运行您的应用程序，然后查看它是否按预期运行。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-06T17:16:25.620

在您的 DLL 中，您可能将访问修饰符（对于 Settings1.Settings）设置为 Internal（对于 VB 来说是Friend）。尝试将 Access MOdifier 更改为 Public 并查看是否允许您的应用程序从 dll 的配置中读取/写入值。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-03-10T10:06:40.680

霍华德的回答涵盖了理论。

解决此问题的一种快速而肮脏的方法是手动解析 xml 配置文件。

```
 string configFile = Assembly.GetExecutingAssembly().Location + ".config";
    XDocument.Load(configFile).Root.Element("appSettings").... 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2012-08-16T16:00:45.927

`Settings1.Default.IPAddress`我认为你们都犯的错误是，当您只是应该这样做时，您显然是通过引用 DLL 设置`Settings1.IPAddress`。

不同之处在于，当您使用`Settings1.Default.IPAddress`这些值时，这些值是从作为属性 [global::System.Configuration.DefaultSettingValueAttribute(...)] 嵌入到程序集文件（.dll 或 .exe）中的硬编码值中获取的。

While`Settings1.IPAddress`是文件`.dll.config`（XML 文件）中可编辑的值**。因此，您对 XML 文件所做的任何更改都不会反映在程序集中的硬编码默认值中。

不是这个：

```
IP = IPAddress.Parse(Settings1.Default.IPAddress); 
```

但是试试这个：

```
*IP = IPAddress.Parse(Settings1.IPAddress); 
```

# .net - .NET 带反射的动态对象

> ID：192643
> 
> 赞同：1
> 
> 时间：2008-10-10T18:54:51.860
> 
> 标签：.net, reflection, enums, nullable

如何通过反射确定 a`Nullable(of Enum)`是否确实是a ？`Enum`

我正在使用一种方法，该方法使用从数据库调用中检索到的类型动态填充类型的`T`对象`IDataReader`。从本质上讲，它循环遍历数据读取器的序数，`T`并填充与序数名称匹配的属性（也抛出了一些属性魔术来更改列名）。在所有其他情况下，它都很好用，但是当我检查属性时`BaseType`，`System.Enum`我发现，`System.ValueType` 因此，我的枚举检查失败并且方法炸弹。

[编辑： `Type.IsEnum`不起作用我需要它。这里的主要问题是`T`BaseType 层次结构中没有任何内容表明它是`Enum`. 就好像让它成为一种`Nullable`类型就失去了我的`Enum`权利。]

有任何想法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-10T19:18:02.373

有点麻烦：

*   从获取类型`PropertyInfo.PropertyType`
*   测试`IsGenericType`
*   如果是，请使用以下方法获取泛型类型`GetGenericTypeDefinition()`
*   如果该类型等于`typeof(Nullable<>)`，则您有一个 Nullable
*   获取底层（即`Enum`）类型`Nullable.GetUnderlyingType(propertyInfo.PropertyType)`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-10T19:18:27.240

你的问题不清楚。您可以使用它`.HasValue`来查找 Nullable 是否具有 Enum 或者它是否为 null，但这似乎不是您问题的目的。您是否使用反射来获取变量的类型并将 IDataReader 的数据从 Object 转换为该类型？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-10T19:25:47.553

从 IDataReader 返回的列是否始终为 Nullable？如果是这样，一个简单的检查方法可能是：

```
AnEnum? enumObj;
if (enumObj.HasValue)
{
  enumObj.Value.GetType().IsEnum();
} 
```

希望有帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-01T03:47:02.860

我也觉得这个问题不是很清楚。我在我们的生产代码中使用了 OregonGhost 的技巧。枚举列表很小时很好，但随着层次结构的增长（读取超过 100 个条目）会变慢。

当存在跨越继承层次结构中的多个类的概念（例如表示类中的字段/属性的枚举）时，我也喜欢使用枚举值链：

```
class Base
{
  enum BaseEnum
  {
   Val1,
   Val2,
   LastVal
  }
}

class Derived
{
  enum DerivedEnum
  {
    Val3 = BaseEnum.LastVal,
    Val4,
    LastVal
  }
} 
```

# php - CakePHP - 如何将页面标题设置为项目名称？

> ID：192648
> 
> 赞同：5
> 
> 时间：2008-10-10T18:55:54.383
> 
> 标签：php, cakephp

好的，所以我正在尝试自学 CakePHP 框架，并且我正在尝试为自己构建一个简单的演示应用程序。

我已经设置好所有的控制器、视图和模型并可以正常工作，但我想做的事情比基本的在线帮助显示要多一些。

我有一个 guitars_controller.php 文件如下...

```
<?php
class GuitarsController extends AppController {
    var $name = 'Guitars';
    function index() {
        $this->set('Guitars', $this->Guitar->findAll());
        $this->pageTitle = "All Guitars";
    }
    function view($id = null) {
        $this->Guitar->id = $id;
        $this->set('guitar', $this->Guitar->read());
        // Want to set the title here.
    }
}
?> 
```

“吉他”对象包含一个名为“名称”的属性，我希望能够将其设置为各个页面视图的 pageTitle。

谁能指出我会怎么做，好吗？

**注意**：我知道在应用程序中设置此类数据的位置存在普遍分歧，但对我来说，这是与数据相关的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-11T09:37:09.380

这些操作与模型无关，因此可以放在您的 app/app_controller.php 文件中

```
<?php
class AppController extends Controller {
    function index() {
        $this->set(Inflector::variable($this->name), $this->{$this->modelClass}->findAll());
        $this->pageTitle = 'All '.Inflector::humanize($this->name);
    }
    function view($id = null) {
        $data = $this->{$this->modelClass}->findById($id);
        $this->set(Inflector::variable($this->modelClass), $data);
        $this->pageTitle = $data[$this->modelClass][$this->{$this->modelClass}->displayField];
    }
}
?> 
```

将您的浏览器指向 /guitars 将调用您的吉他控制器索引操作，该操作不存在，因此将运行 AppController（GuitarsController 继承自）中的操作。视图操作也是如此。这也适用于您的 DrumsController、KeyboardsController 等。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-10T19:26:44.090

您可以在控制器中进行设置：

```
function view($id = null) {
    $guitar = $this->Guitar->read(null, $id);
    $this->set('guitar', $guitar);
    $this->pageTitle = $guitar['Guitar']['name'];
} 
```

或者在视图中：

```
<? $this->pageTitle = $guitar['Guitar']['name']; ?> 
```

视图中设置的值将覆盖控制器中可能已经设置的任何值。

为了安全起见，您必须确保显示 pageTitle html 的布局/视图对这些任意数据进行编码，以避免注入攻击和损坏的 html

```
<?php echo h( $title_for_layout ); ?> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T21:16:10.670

回应您自己关于 oo 范式的回答。就像这样 ：

```
function view($id) {
    $this->Guitar->id = $id;
    $this->Guitar->read();
    $this->pageTitle = $this->Guitar->data['Guitar']['name'];
    $this->set('data', $this->Guitar->data);
} 
```

顺便说一句，您应该检查 id 是否已设置且有效等，因为这是 url 用户输入。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-07-24T04:46:19.343

从 CakePHP 1.3 开始，设置页面标题已更改。

```
$this->pageTitle = "Title"; //deprecated

$this->set("title_for_layout",Inflector::humanize($this->name)); // new way of setting title 
```

注意：关于 Inflector 的更多信息：[http ://api13.cakephp.org/class/inflector#method-Inflector](http://api13.cakephp.org/class/inflector#method-Inflector)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-10T18:58:52.087

```
$this->pageTitle = $this->Guitar->Name; 
```

虽然它应该在视图中，我不使用 PHP 或 cakePHP，但这是视图应该做的事情，而不是控制器。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-10T19:21:40.917

它应该进入控制器。看到[这个](http://book.cakephp.org/view/314/Views)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-10T20:11:47.337

> “但我想做一些比基本的在线帮助显示更多的事情。”

不总是这样吗？如此多的文档都是针对最低限度的，实际上并没有多大帮助。您可以完成许多可用的教程，但是只要您从预订中走 1 步，就会出现混乱。嗯，它要么是最低限度，要么是专业开发人员最高限度，但很少能达到轻松、清晰和深度的最佳点。

我目前正在重写一些 Zend Framework 文档以供我自己使用，这样我就可以消除不一致之处，澄清被掩盖的假设，并获得理解它的核心“最佳实践”方式。我的口头禅：轻松、清晰、深度。轻松，清晰，深度。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-10T20:26:25.810

啊，不明显的答案如下……

```
$this->pageTitle = $this->viewVars['guitar']['Guitar']['Name']; 
```

我通过将以下代码放入控制器中发现了这一点（老实说，这是一个成功的远射）

```
echo "<pre>"; print_r($this);echo "</pre>"; 
```

感谢所有试图提供帮助的人。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-23T07:44:20.023

```
echo "<pre>"; print_r($this);echo "</pre>"; 
```

怎么样

```
pr( $this ); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-05-14T20:17:29.043

好的，我真的想在控制器中设置页面标题，而不是在视图中。所以这就是我所做的：

```
class CustomersController extends AppController {

    var $name = 'Customers';

    function beforeFilter() {
        parent::beforeFilter();
        $this->set('menu',$this->name);
        switch ($this->action) {
          case 'index':
            $this->title = 'List Customer';
            break;
          case 'view':
            $this->title = 'View Customer';
            break;
          case 'edit':
            $this->title = 'Edit Customer';
            break;
          case 'add':
            $this->title = 'Add New Customer';
            break;
          default:
            $title = 'Welcome to '.$name;
            break;
        }
        $this->set('title',$this->title);
      } 
```

诀窍是你不能`$this->title`在任何动作中设置，它不会起作用。在我看来，网页在渲染后会执行操作，但是您可以在`beforeFilter`.

# python - 你能在 Python 的核心类型上修改补丁方法吗？

> ID：192649
> 
> 赞同：54
> 
> 时间：2008-10-10T18:56:12.340
> 
> 标签：python, ruby, programming-languages, monkeypatching, fluent-interface

Ruby 可以向 Number 类和其他核心类型添加方法以获得如下效果：

```
1.should_equal(1) 
```

但似乎 Python 无法做到这一点。这是真的？如果是这样，为什么？这与无法修改*类型*的事实有关吗？

*更新：与其谈论猴子补丁的不同定义，我只想关注上面的例子。正如你们中的一些人回答的那样，我已经得出结论，它不能做到。但我想更详细地解释为什么它不能完成，如果 Python 中可用的话，也许有什么功能允许这样做。*

回答你们中的一些人：我*可能*想要这样做的原因仅仅是美学/可读性。

```
 item.price.should_equal(19.99) 
```

这读起来更像英语，并清楚地表明哪个是测试值，哪个是预期值，应该是：

```
should_equal(item.price, 19.99) 
```

这个概念是[Rspec](http://rspec.info/)和其他一些 Ruby 框架所基于的。

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2008-10-10T20:01:31.990

你不能。在 Python 中，在 C 扩展模块（包括内置函数）中定义的所有数据（类、方法、函数等）都是不可变的。这是因为 C 模块在同一进程中的多个解释器之间共享，因此对其进行猴子补丁也会影响同一进程中不相关的解释器。（通过[C API](https://docs.python.org/3/c-api/init.html#sub-interpreter-support)可以在同一进程中使用多个解释器，并且已经为使它们在 Python 级别上可用而做出了[一些努力。）](https://www.python.org/dev/peps/pep-0554/)

但是，在 Python 代码中定义的类可能会被猴子补丁，因为它们是该解释器的本地类。

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2008-10-10T19:15:42.207

你说的猴子补丁到底是什么意思？有[几个略有不同的定义](http://wikipedia.org/wiki/Monkey_patch)。

如果你的意思是，“你能在运行时改变一个类的方法吗？”，那么答案肯定是肯定的：

```
class Foo:
  pass # dummy class

Foo.bar = lambda self: 42

x = Foo()
print x.bar() 
```

如果您的意思是，“您可以在运行时更改类的方法并**让该类的所有实例在事后更改**吗？” 那么答案也是肯定的。稍微改变一下顺序：

```
class Foo:
  pass # dummy class

x = Foo()

Foo.bar = lambda self: 42

print x.bar() 
```

但是您不能对某些内置类执行此操作，例如`int`or `float`。这些类的方法是用 C 实现的，为了使实现更容易和更高效，牺牲了一些抽象。

我不太清楚你**为什么**要改变内置数字类的行为。如果你需要改变他们的行为，子类他们！！

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2010-10-26T15:37:39.423

```
def should_equal_def(self, value):
    if self != value:
        raise ValueError, "%r should equal %r" % (self, value)

class MyPatchedInt(int):
    should_equal=should_equal_def

class MyPatchedStr(str):
    should_equal=should_equal_def

import __builtin__
__builtin__.str = MyPatchedStr
__builtin__.int = MyPatchedInt

int(1).should_equal(1)
str("44").should_equal("44") 
```

玩得开心 ;）

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2013-06-22T00:33:56.370

你可以做到这一点，但它需要一点黑客攻击。幸运的是，现在有一个名为“Forbidden Fruit”的模块，它使您能够非常简单地修补内置类型的方法。你可以在

[http://clarete.github.io/forbiddenfruit/?goback=.gde_50788_member_228887816](http://clarete.github.io/forbiddenfruit/?goback=.gde_50788_member_228887816)

或者

[https://pypi.python.org/pypi/forbiddenfruit/0.1.0](https://pypi.python.org/pypi/forbiddenfruit/0.1.0)

使用原始问题示例，在编写“should_equal”函数后，您只需执行

```
from forbiddenfruit import curse
curse(int, "should_equal", should_equal) 
```

你可以走了！还有一个“反向”功能可以删除已修补的方法。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-10-11T04:50:58.223

正如其他用户指出的那样，Python 的核心类型在设计上是不可变的：

```
>>> int.frobnicate = lambda self: whatever()
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: can't set attributes of built-in/extension type 'int' 
```

您当然*可以*通过创建子类来实现您描述的效果，因为 Python 中的用户定义类型默认情况下是可变的。

```
>>> class MyInt(int):
...   def frobnicate(self):
...     print 'frobnicating %r' % self
... 
>>> five = MyInt(5)
>>> five.frobnicate()
frobnicating 5
>>> five + 8
13 
```

也没有必要`MyInt`公开子类；也可以直接在构造实例的函数或方法中内联定义它。

在某些情况下，精通该习语的 Python 程序员会认为这种子类化是正确的做法。例如，`os.stat()`返回一个`tuple`添加命名成员的子类，正是为了解决您在示例中提到的那种可读性问题。

```
>>> import os
>>> st = os.stat('.')
>>> st
(16877, 34996226, 65024L, 69, 1000, 1000, 4096, 1223697425, 1223699268, 1223699268)
>>> st[6]
4096
>>> st.st_size
4096 
```

也就是说，在您给出的具体示例中，我不相信（或其他地方）的子类`float`化`item.price`很可能被认为是 Pythonic 的事情。如果这是主要用例，我*可以*很容易地想象有人决定添加一个`price_should_equal()`方法；`item`如果人们正在寻找更一般的东西，也许使用命名参数来使预期的含义更清晰可能更有意义，例如

```
should_equal(observed=item.price, expected=19.99) 
```

或类似的规定。它有点冗长，但毫无疑问它可以改进。与 Ruby 风格的猴子补丁相比，这种方法的一个可能优势是`should_equal()`可以轻松地对任何类型进行比较，而不仅仅是`int`or `float`。但也许我过于关注您碰巧提供的特定示例的细节。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2011-05-13T06:35:19.300

您无法在 python 中修补核心类型。但是，您可以使用管道编写更易于阅读的代码：

```
from pipe import *

@Pipe
def should_equal(obj, val):
    if obj==val: return True
    return False

class dummy: pass
item=dummy()
item.value=19.99

print item.value | should_equal(19.99) 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-10T19:09:16.760

如果你真的真的*很想*在 Python 中做一个猴子补丁，你可以用“import foo as bar”技术做一个（某种）hack。

如果您有诸如 TelnetConnection 之类的类，并且您想扩展它，请将其子类化到一个单独的文件中，并将其命名为 TelnetConnectionExtended 之类的名称。

然后，在代码的顶部，您通常会说：

```
import TelnetConnection 
```

将其更改为：

```
import TelnetConnectionExtended as TelnetConnection 
```

然后在代码中引用 TelnetConnection 的任何地方实际上都会引用 TelnetConnectionExtended。

可悲的是，这假设您可以访问该类，并且“as”仅在该特定文件中运行（它不是全局重命名），但我发现它有时很有用。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-05-08T02:36:45.263

这是一个实现的示例`item.price.should_equal`，尽管我会在实际程序中使用 Decimal 而不是 float：

```
class Price(float):
    def __init__(self, val=None):
        float.__init__(self)
        if val is not None:
            self = val

    def should_equal(self, val):
        assert self == val, (self, val)

class Item(object):
    def __init__(self, name, price=None):
        self.name = name
        self.price = Price(price)

item = Item("spam", 3.99)
item.price.should_equal(3.99) 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-10T19:13:08.173

不，但你有 UserDict UserString 和 UserList 正是考虑到这一点。

如果你谷歌你会发现其他类型的例子，但这是内置的。

一般来说，猴子补丁在 Python 中的使用比在 Ruby 中少。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-05-06T15:15:39.107

做什么`should_equal`？它是布尔返回`True`还是`False`？在这种情况下，它的拼写是：

```
item.price == 19.99 
```

没有考虑到口味，但没有一个普通的 Python 开发人员会说它的可读性不如你的版本。

是否`should_equal`设置了某种验证器？（为什么验证器被限制为一个值？为什么不只设置值而不在之后更新它？）如果你想要一个验证器，这无论如何都不会工作，因为你提议修改一个特定的整数或全部整数。`18.99`（需要相等的验证器`19.99`总是会失败。）相反，您可以这样拼写：

```
item.price_should_equal(19.99) 
```

或这个：

```
item.should_equal('price', 19.99) 
```

并在项目的类或超类上定义适当的方法。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-06-05T20:22:55.243

看来你真正想写的是：

```
assert item.price == 19.99 
```

（当然，比较浮点数是否相等，或使用浮点数表示价格是[个坏主意](http://download.oracle.com/docs/cd/E19957-01/806-3568/ncg_goldberg.html)，因此您可以编写`assert item.price == Decimal(19.99)`或使用任何用于价格的数字类。）

您还可以使用[py.test 之](http://doc.pytest.org/en/latest/example/reportingdemo.html)类的测试框架来获取有关测试中失败断言的更多信息。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-10T18:57:11.403

不，你不能在 Python 中做到这一点。我认为这是一件好事。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-12-20T11:19:35.087

不，遗憾的是您不能在运行时扩展用 C 实现的类型。

您可以将 int 子类化，尽管它很重要，但您可能必须重写`__new__`.

您还有语法问题：

```
1.somemethod()  # invalid 
```

然而

```
(1).__eq__(1)  # valid 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2012-06-05T03:38:45.557

这是我实现 .should_something... 行为的方法：

```
result = calculate_result('blah') # some method defined somewhere else

the(result).should.equal(42) 
```

## 或者

```
the(result).should_NOT.equal(41) 
```

我包含了一个装饰器方法，用于在运行时在独立方法上扩展此行为：

```
@should_expectation
def be_42(self)
    self._assert(
        action=lambda: self._value == 42,
        report=lambda: "'{0}' should equal '5'.".format(self._value)
    )

result = 42

the(result).should.be_42() 
```

您必须对内部结构有所了解，但它确实有效。

这是来源：

[https://github.com/mdwhatcott/pyspecs](https://github.com/mdwhatcott/pyspecs)

它也在 pyspecs 下的 PyPI 上。

# c# - 为什么我在从 ApplicationSettingsBase 派生的类上看不到成员“默认”？

> ID：192653
> 
> 赞同：0
> 
> 时间：2008-10-10T18:57:48.467
> 
> 标签：c#, .net

我正在使用 .NET 3.5，我有一个类 A，标记为内部密封部分，它派生自 System.Configuration.ApplicationSettingsBase。然后我以下列方式使用这个类的一个实例：

```
A A_Instance = new A();
A_Instance.Default.Save(); 
```

为什么 Visual C# 编译器会抱怨：

```
error CS0117: 'A' does not contain a definition for 'Default' 
```

?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-10T19:12:22.247

您可能正在寻找这个：

```
private static ServerSettings defaultInstance = ((ServerSettings)(global::System.Configuration.ApplicationSettingsBase.Synchronized(new ServerSettings())));

public static ServerSettings Default 
    {
    get { return defaultInstance; }
} 
```

这是由 Visual Studio 生成的代码

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-10T20:52:26.130

.NET 没有在 ApplicationSettingsBase 中提供用于访问任何方法的“默认”成员。我没有注意到的是“默认”被用作 A 的单例。因此，gdean2323 提供的示例代码为我提供了一些修复指导。解决问题的代码需要我将以下代码添加到 A 类（为简单起见，无需同步）：

```
private static A defaultInstance = new A();
public static A Default 
{
    get
    {
        return defaultInstance;
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-10T19:05:54.240

ApplicationSettingsBase 继承自 SettingsBase，两者都不公开 Default 属性。从编译器错误来看，您的类不会添加一个。

AFAIK C# 不支持围绕“默认”一词的任何特殊语法来访问标记为默认值的属性。

你期待什么行为？

# oracle - “使用 Oracle Internet Directory 注册系统事件……”是什么意思？

> ID：192655
> 
> 赞同：1
> 
> 时间：2008-10-10T18:58:30.917
> 
> 标签：oracle, systemevent, oracleinternetdirectory

这是来自 Stream - AQ 文档。

> 您可以在 Oracle Internet Directory 的队列中注册系统事件、用户事件和通知。系统事件是数据库启动、数据库关闭和系统错误事件。用户事件包括用户登录和用户注销、DDL 语句（创建、删除、更改）和 DML 语句触发器。队列通知包括 OCI 通知、PL/SQL 通知和电子邮件通知。

听起来不错。这对我有什么好处？

我的意思是这些东西看起来像 DDL 触发器......所以不是在数据库中构建 DDL 触发器而是在 OID 中构建它并让 OID 管理触发器的触发？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-12T03:17:44.917

没用过，这是我的猜测。

想象一下，您有一百个数据库，并且您想在每次人们登录每个数据库时都进行记录，您可以在每个单独的服务器上执行此操作，但这会使回答诸如“标记登录到哪些数据库”之类的问题变得困难。所以，相反，您让每个数据库使用 OID（通过 AQ）注册其“用户登录”事件，然后您有一个进程从 OID 接收这些事件并记录它们。然后您有一个可以审核系统范围登录的单点。

您可能还可以使用它来将消息从一个 AQ 传播到另一个 AQ，并查找系统中存在哪些可以订阅的队列。

# wcf - WCF 中的表单身份验证错误

> ID：192678
> 
> 赞同：0
> 
> 时间：2008-10-10T19:06:08.607
> 
> 标签：wcf, authorization

我们正在连接到关闭匿名访问、打开 Windows 身份验证的 WCF Web 服务。web.config 文件有一个本地用户帐户，用于允许用户和拒绝用户=“？”。

我可以很好地下载和生成服务代理（被提示输入凭据），但是从我的 Windows 窗体项目（即使在传递凭据时），我收到以下错误：

```
System.ServiceModel.Security.MessageSecurityException was unhandled
  Message="The HTTP request is unauthorized with client authentication scheme 'Anonymous'. The authentication header received from the server was 'Basic realm=\"SEIPART001\"'."

Message="The remote server returned an error: (401) Unauthorized." 
```

这是我的示例代码：

```
ip.eIPCShoppingCartWSSoapClient client = new iParts.ip.eIPCShoppingCartWSSoapClient();
System.Net.NetworkCredential creds = new System.Net.NetworkCredential("username", "password", "domain");

client.ClientCredentials.Windows.ClientCredential = creds;
iParts.ip.OrderListItem[] listItem = client.GetOrderList("1234"); //throws exception here 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-11T12:00:48.200

看起来您的服务要求进行*基本*身份验证；不是windows集成身份验证。

在这种情况下，我认为您需要使用 ClientCredentials.UserName 属性而不是 ClientCredentials.Windows 指定客户端代理上的凭据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T15:50:02.703

看起来你应该切换到运输安全。查看配置的安全部分。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-11T20:21:20.780

没变。虚拟目录要求 Windows Auth 并传入本地用户。它在浏览器中运行良好，但服务不断出错。

# java - 蚂蚁在财产上的错误目录

> ID：192684
> 
> 赞同：0
> 
> 时间：2008-10-10T19:10:28.723
> 
> 标签：java, ant

我是 Ant 的新手，所以我决定在这里发布，而不是在官方错误列表上发布（因为它可能不是错误）：

当我运行我的 Ant build.xml 文件时，除了构建目录之外，一切都运行良好，而不是将属性 ${classes.dir} 转换为 build/ver_2.0.0/classes 它创建一个文件 ${cv.build.dir} /类

这是蚂蚁代码的一部分：

```
<!--Properties-->
<property name="build.ver"   value="2.0.0"/> 
<property name="src.dir"     value="src"/>
<property name="lib.dir"     value="lib"/>
<property name="build.dir"   value="build"/>
<property name="classes.dir" value="${cv.build.dir}/classes"/>
<property name="jar.dir"     value="${cv.build.dir}/jar"/>
<property name="main-class"  value="br.uesc.computacao.estagio.controlador.ControladorModoExecucao"/>
<property name="cv.dir"      value="ver_${build.ver}"/>
<property name="cv.src.dir"  value="${src.dir}/${cv.dir}"/>
<property name="cv.build.dir" value="${build.dir}/${cv.dir}"/>
...
<target name="compile">
    <mkdir dir="${classes.dir}"/> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-10T19:19:59.577

```
<property name="before" value="${after}"/>
<property name="after" value="MyBuildDirectory"/>

<target name="test" >
<mkdir dir="${before}"/>
</target> 
```

它将创建名为 ${after} 的目录...您必须在使用前先初始化参数！

# c# - 热键覆盖

> ID：192686
> 
> 赞同：0
> 
> 时间：2008-10-10T19:11:01.157
> 
> 标签：c#, c++, keyboard-shortcuts, policy, hotkeys

困难的问题。答案可能是否定的，如果我在 Intertubes 中发现的一切都是正确的，但值得一试。我需要覆盖`Ctrl`++和`Shift`+组合。能够覆盖组合键会很好，但我有一个低级别的钩子可以做到这一点，我只希望我不需要它。如果我可以设法完全通过策略阻止开始菜单和任务管理器，则不再需要覆盖，但我找不到正确的策略来这样做。`Esc``Ctrl``Esc``Win`

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-10T20:46:12.260

您可以覆盖`Ctrl`+ `Esc`（我刚刚在 AutoHotkey 中尝试过，它有效），但不能覆盖++ `Ctrl`，不超过`Shift`++ 。`Esc``Ctrl``Alt``Del`

所以使用政策可能是要走的路……我担心没有这个领域的经验。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2017-04-09T16:51:13.707

如果有人来这里寻找非 AutoHotKey，这里是 ac# 方式。

可以使用键盘挂钩来执行此操作。可以在此 [CodeProject 文章中找到一个很好的钩子类](https://www.codeproject.com/articles/7294/processing-global-mouse-and-keyboard-hooks-in-c)

使用下面的代码将防止`WIN`+`LEFT`或`WIN`+`RIGHT`发生。您可以使用它来覆盖您想要的任何键。

这甚至会覆盖您通过`RegisterHotKey`Win API 添加的热键。

在项目中拥有这些类后，您可以将处理程序添加到静态`HookManager`类，如下所示。

```
//It's worth noting here that if you subscribe to the Key_Press event then it will break the international accent keys.
HookManager.KeyPress += HookManager_KeyPress;
HookManager.KeyDown += HookManager_KeyDown;
HookManager.KeyUp += HookManager_KeyUp; 
```

您也可以添加鼠标事件，但为简单起见，我只是展示了键盘挂钩。

我还创建了一个通用列表，以便我知道哪些键当前处于关闭状态，并从`KeyUp`事件列表中删除这些键。

```
public static List<Keys> keysDown = new List<Keys>();
private static void HookManager_KeyDown(object sender, KeyEventArgs e)
        {
            //Used for overriding the Windows default hotkeys
            if(keysDown.Contains(e.KeyCode) == false)
            {
                keysDown.Add(e.KeyCode);
            }

            if (e.KeyCode == Keys.Right && WIN())
            {
                e.Handled = true;
                //Do what you want when this key combination is pressed
            }
            else if (e.KeyCode == Keys.Left && WIN())
            {
                e.Handled = true;
                //Do what you want when this key combination is pressed
            }

        }

        private static void HookManager_KeyUp(object sender, KeyEventArgs e)
        {
            //Used for overriding the Windows default hotkeys
            while(keysDown.Contains(e.KeyCode))
            {
                keysDown.Remove(e.KeyCode);
            }
        }

        private static void HookManager_KeyPress(object sender, KeyPressEventArgs e)
        {
            //Used for overriding the Windows default hotkeys

        }

        public static bool CTRL()
        {
            //return keysDown.Contains(Keys.LShiftKey)
            if (keysDown.Contains(Keys.LControlKey) || 
                keysDown.Contains(Keys.RControlKey) || 
                keysDown.Contains(Keys.Control) || 
                keysDown.Contains(Keys.ControlKey))
            {
                return true;
            }
            else
            {
                return false;
            }
        }

        public static bool SHIFT()
        {
            //return keysDown.Contains(Keys.LShiftKey)
            if (keysDown.Contains(Keys.LShiftKey) || 
                keysDown.Contains(Keys.RShiftKey) ||
                keysDown.Contains(Keys.Shift) ||
                keysDown.Contains(Keys.ShiftKey))
            {
                return true;
            }
            else
            {
                return false;
            }
        }

        public static bool WIN()
        {
            //return keysDown.Contains(Keys.LShiftKey)
            if (keysDown.Contains(Keys.LWin) || 
                keysDown.Contains(Keys.RWin))
            {
                return true;
            }
            else
            {
                return false;
            }
        }

        public static bool ALT()
        {
            //return keysDown.Contains(Keys.LShiftKey)
            if (keysDown.Contains(Keys.Alt))
            {
                return true;
            }
            else
            {
                return false;
            }
        } 
```

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-10-10T19:18:34.090

所以你需要在你的应用程序上覆盖热键吗？那么答案可能是肯定的，如何？不知道，但如果这个（[http://www.inchwest.com/mapkeyboard.aspx](http://www.inchwest.com/mapkeyboard.aspx)）程序可以，你也可以

# c# - 检查数值的精度和小数位数的有效方法是什么？

> ID：192693
> 
> 赞同：8
> 
> 时间：2008-10-10T19:13:02.620
> 
> 标签：c#, sql-server, .net-3.5

我正在编写一个在将数据插入数据库之前验证数据的例程，其中一个步骤是查看数值是否符合 Numeric(x,y) SQL-Server 类型的精度和比例。

我已经从 SQL-Server 获得了精度和比例，但是在 C# 中获得 CLR 值的精度和比例的最有效方法是什么，或者至少测试它是否符合给定的约束？

目前，我正在将 CLR 值转换为字符串，然后使用 .IndexOf() 查找小数点的位置。有更快的方法吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-10T20:22:05.647

```
System.Data.SqlTypes.SqlDecimal.ConvertToPrecScale( new SqlDecimal (1234.56789), 8, 2) 
```

给出 1234.67。它将截断小数位后的多余数字，并会抛出错误而不是尝试截断小数位之前的数字（即 ConvertToPrecScale(12344234, 5,2)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2016-07-14T20:28:00.233

在不触发异常的情况下，您可以使用以下方法来确定该值是否符合精度和比例约束。

```
private static bool IsValid(decimal value, byte precision, byte scale)
{
    var sqlDecimal = new SqlDecimal(value);

    var actualDigitsToLeftOfDecimal = sqlDecimal.Precision - sqlDecimal.Scale;

    var allowedDigitsToLeftOfDecimal = precision - scale;

    return 
        actualDigitsToLeftOfDecimal <= allowedDigitsToLeftOfDecimal && 
        sqlDecimal.Scale <= scale;
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2018-02-21T18:03:36.347

这是一种基于数学的方法。

```
private static bool IsValidSqlDecimal(decimal value, int precision, int scale)
{
    var minOverflowValue = (decimal)Math.Pow(10, precision - scale) - (decimal)Math.Pow(10, -scale) / 2;
    return Math.Abs(value) < minOverflowValue;
} 
```

这考虑到 sql server 将如何进行舍入并防止溢出错误，即使我们超出了精度。例如：

```
DECLARE @value decimal(10,2)
SET @value = 99999999.99499 -- Works
SET @value = 99999999.995   -- Error 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-10T19:30:47.903

您可以使用 decimal.Truncate(val) 获取值的整数部分，使用 decimal.Remainder(val, 1) 获取小数点后的部分，然后检查每个部分是否满足您的约束（我猜这可以是一个简单的 > 或 < 检查）

# javascript - 如何修复参数名称不匹配的问题 - DOJO 和 PL/SQL

> ID：192697
> 
> 赞同：0
> 
> 时间：2008-10-10T19:13:30.403
> 
> 标签：javascript, web-applications, plsql, dojo

如果客户端名称是您正在使用的服务器端语言中的关键字或保留字，您如何解决名称不匹配问题？

DOJO JavaScript 工具包有一个 QueryReadStore 类，您可以将其子类化以向服务器提交 REST 模式查询。我将它与 FilteringSelect Dijit 结合使用。

我可以继承 QueryReadStore 并指定传递给服务器的参数和参数。但在此过程中，“start”和“count”参数正在从客户端传递到服务器。我进入 API 并发现 QueryReadStore.js 正在发送这些参数名称。

我正在使用 Fiddler 来确认实际发送和带回的内容。服务器响应告诉我，由于“start”和“count”参数，我的参数名称不匹配。问题是，我不能在 PL/SQL 中使用“start”和“count”。

解决方法或正确的实施建议将不胜感激...谢谢。

//我试着把代码片段放在这里，但由于它主要是 HTML，所以效果不太好。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-10T20:39:43.223

虽然感觉做错了事，因为我正在破解一个经过良好测试、编写良好的 JavaScript 工具包，但这就是我解决问题的方法：

我进入 DOJOX QueryReadStore.js 并将“开始”和“计数”引用**替换**为可接受的（对于服务器端语言）参数名称。

我想通过我的 PL/SQL *（但我不知道如何绕过保留字）*或客户端代码*（子类化并没有*解决问题）来处理这个问题......而无需进入图书馆。但它有效，我可以继续前进。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-11T13:38:33.167

正如您所提到的，与从 API 中删除它相反，您实际上可以使用自己的 fetch 创建一个子类，并删除 start/count 参数（理论上）。查看此 URL 以获取指导：

[http://www.sitepen.com/blog/2008/06/25/web-service-data-store/](http://www.sitepen.com/blog/2008/06/25/web-service-data-store/)

start 和 count 实际上非常有用，因为它们允许您为查询传递参数，可用于过滤大量数据集，并且有助于管理客户端分页。我会尝试子类化，拦截和删除。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-17T00:26:47.123

您的 pl/sql 程序是否通过 URL 和 mod_plsql 访问？如果是这样，那么您可以使用“灵活的参数传递”并将变量分配给名称/值对数组。

像这样定义你的包规格......

```
create or replace package pkg_name
    TYPE plsqltable
   IS
      TABLE OF VARCHAR2 (32000)
         INDEX BY BINARY_INTEGER;

   empty   plsqltable;
 PROCEDURE api (name_array IN plsqltable DEFAULT empty ,
                         value_array IN plsqltable DEFAULT empty
   );
END pkg_name; 
```

然后是身体：

```
 CREATE OR REPLACE PACKAGE BODY pkg_name AS
    l_count_value number;
    l_start_value number;
    PROCEDURE proc_name (name_array IN plsqltable DEFAULT empty,
                   value_array IN plsqltable DEFAULT empty) is
    ------------
    FUNCTION get_value (p_name IN VARCHAR) RETURN VARCHAR2 IS 
    BEGIN
    FOR i IN 1..name_array.COUNT LOOP
        IF UPPER(name_array(i)) = UPPER(p_name) THEN
           RETURN value_array(i);
        END IF;
    END LOOP;
    RETURN NULL;
    END get_value;
    ----------------------
    begin
    l_count_value := get_value('count');
    l_start_value := get_value('start');
    end api;
    end pkg_name; 
```

然后你可以调用 pkg_name.api 使用

```
http://server/dad/!pkg_name.api?start=3&count=3 
```

# java - 使用 jboss 使用 Web 服务

> ID：192702
> 
> 赞同：2
> 
> 时间：2008-10-10T19:15:18.603
> 
> 标签：java, web-services, jboss, jax-ws, jax-rpc

有人可以为我指出一个很好的分步教程来使用 Java 中已经运行的 Web 服务吗？

PS：我尝试使用创建类`wsconsume`，但它哭泣
`[ERROR] rpc/encoded wsdls are not supported in JAXWS 2.0.` （我的网络服务是 rpc/encoded）

如果我可以完全手动使用 Web 服务（不使用向导），并且了解它是如何工作的，那么我会很高兴。

谢谢！

**更新**：我发现 rpc web 服务不是使用`jbossws`, but来使用的`jboss-jaxrpc`，它实现了 JAX-RPC 规范。[我在这里](http://www.ibm.com/developerworks/library/ws-jaxrpc1/)找到了 JAX-RPC 指南，但我仍在寻找其他可以提供帮助的指南。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T12:49:39.517

How about the [JBossWS](http://jbossws.jboss.org/mediawiki/index.php?title=JBossWS) website? The details on the [client side wsconsume tool](http://jbossws.jboss.org/mediawiki/index.php?title=JBossWS_JAX-WS_Tools#Client_Side) are probally what you will look at first.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-18T13:27:43.527

[Apache CXF](http://cxf.apache.org/)是让 Web 服务运行的最简单方法。具体看一下[Simple Frontend](http://cwiki.apache.org/CXF20DOC/simple-frontend.html)。简单的前端使用反射将方法/数据类型转换为 Web 服务。没有比这更容易的了。

CXF 相当稳定，但不包括所有 WS 规范（例如 WS-Eventing）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-20T05:16:02.990

您还可以使用[Spring WS](http://static.springframework.org/spring-ws/sites/1.5/reference/html/client.html)使用 Web 服务。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-10T19:27:48.283

如果您有 WSDL 和 XSD 文件，您可以使用[Axis](http://ws.apache.org/axis/) Web 服务库来创建将与它们描述的服务交互的 Java 类。从这个库的角度来看，您正在创建一个客户端应用程序。

# sql - 使用 SQL 语句创建记录集

> ID：192707
> 
> 赞同：4
> 
> 时间：2008-10-10T19:18:06.993
> 
> 标签：sql, vba, ms-access

我正在尝试在 Access VBA 中创建一个记录集，它将向我显示与表单的当前记录相关的表中的所有记录。我当前的代码如下所示：

```
Private Sub Form_Load()

    Dim rst As Recordset

    Set rst = CurrentDb.OpenRecordset("Select [ID], [Ln] From [Order Detail] Where ((([Order Detail].[ID]) = [Forms]![Order Data Entry Header]![ID]))")

    rst.MoveLast
    Forms![Order Data Entry Header].LineNum = rst![Ln]

End Sub 
```

我这样做是为了在添加新记录时可以在最高数字之后按顺序编号。当我运行表单时，它得到“运行时错误：'3061'参数太少。预期为 1。” 在设置第一行。

任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-10T19:38:22.287

问题在于您看到的字符串正是传递给驱动程序的字符串。

您需要“建立”字符串，如下所示：

```
Set rst = CurrentDb.OpenRecordset("Select [ID], [Ln] From [Order Detail] Where ((([Order Detail].[ID]) = " & [Forms]![Order Data Entry Header]![ID] & "))") 
```

观察以确保 [Forms]![Order Data Entry Header]![ID] 是安全内容，因为您正在构建 SQL 语句。

# asp.net-mvc - MVC 与 SharePoint

> ID：192712
> 
> 赞同：5
> 
> 时间：2008-10-10T19:18:42.310
> 
> 标签：asp.net-mvc, sharepoint, configuration, web-config

1.  我们希望在我们的 SP 应用程序中使用 MVC 框架。
2.  这就是我们正在努力完成的事情... SPSite 中的一个虚拟目录，它可以托管和运行 MVC。例如，/_layouts/MVC/

有关所需配置更改的任何提示（如果可能的话）将非常有帮助。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-11T12:16:32.150

您可能会对此感兴趣 [http://www.codeplex.com/SharePointMVC](http://www.codeplex.com/SharePointMVC)

我大约 5 分钟前发布了它。

它基本上是一个帮助在 SharePoint 母版页中呈现 ASP.MVC 的库。

还为时过早，但你明白了。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-13T20:10:47.773

您将有一段时间在 MVC 应用程序的 web.config 中取消继承所有内容（模块、处理程序、程序集、命名空间）。我建议不要尝试让 MVC 在同一个 IIS 网站内工作，为什么不直接在 SharePoint 之外运行您的应用程序呢？Joel Oleson 刚刚发布了关于使用“小部件”或“Web 部件”作为 SharePoint 集成形式的博客：

[乔尔·奥尔森](http://www.sharepointjoel.com/Lists/Posts/Post.aspx?ID=109)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-04-16T08:53:01.440

我从 MS MVC 团队听说，Sharepoint 没有使用 MVC 的计划。但是 MVC 可以通过一些调整与 Sharepoint 一起使用

以下共享点站点 www.themedicinecabinet.co.uk 是使用 ASP.net MVC 2 构建的。

本文解释了这是如何完成的 [http://vspug.com/mbailey/files/2010/04/Using-ASP.NET-MVC-2-with-Sharepoint-Publishing.pdf](http://vspug.com/mbailey/files/2010/04/Using-ASP.NET-MVC-2-with-Sharepoint-Publishing.pdf)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-06-19T19:57:16.147

我们刚刚发布了一个开源项目，让您可以使用 SharePoint 2010 作为网站的后端并在前端使用 ASP.NET MVC3。过去两年我们一直在使用代码库，并希望与社区分享它，因为我们相信其他人会发现它有用。

文档仍然很少 - 如果您有任何问题或需要帮助，请随时与我们联系。

[http://www.slamcms.com](http://www.slamcms.com)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-10T20:09:37.327

我建议在它自己的应用程序池中运行您的虚拟目录。我在其他一些 Microsoft 产品上利用 MVC，并且应用程序池的托管管道模式必须 = MVC 的“集成”。

# c# - 是否可以分解数组，以便可以将其元素传递给带有 params 关键字的方法？

> ID：192715
> 
> 赞同：5
> 
> 时间：2008-10-10T19:19:50.797
> 
> 标签：c#, parameters, keyword, variadic-functions, params-keyword

以这个非编译代码为例：

```
public string GetPath(string basefolder, string[] extraFolders)
{
    string version = Versioner.GetBuildAndDotNetVersions();
    string callingModule = StackCrawler.GetCallingModuleName();
    return AppendFolders(basefolder, version, callingModule, extraFolders);
}
private string AppendFolders(params string[] folders)
{
    string outstring = folders[0];
    for (int i = 1; i < folders.Length; i++)
    {
        string fixedPath = folders[i][0] == '\\' ? folders[i].Substring(1) : folders[i];
        Path.Combine(outstring, fixedPath);
    }
    return outstring;
} 
```

这个例子是我正在使用的测试代码的简化版本。请，我只对与 param 关键字直接相关的解决方案感兴趣。我知道列表和其他类似的东西是如何工作的。

有没有办法“分解” extraFolders 数组，以便它的内容可以与其他参数一起传递到 AppendFolders 中？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-10T19:33:00.410

就通过吧。文件夹参数首先是一个数组。“params”功能有点像编译器魔法，但这不是必需的。

```
AppendFolders(extraFolders); 
```

现在，对于这个特定的实例，您必须首先向该数组添加一些东西。

```
List<string> lstFolders = new List<string>(extraFolders);
lstFolder.Insert(0, callingModule);
lstFolder.Insert(0, version);
lstFolder.Insert(0, basefolder);
return AppendFolders(lstFolders.ToArray()); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-10T19:51:57.330

我会对“崩溃”这个词提出质疑，因为您似乎真的想“扩展”。而且我不确定您所说的解决方案“与 params 关键字直接相关”和“您对解决方法不感兴趣”是什么意思。最后，您要么必须传递一些字符串——编译器会神奇地将它们打包成一个数组——要么直接传递一个字符串数组。话虽如此，我的解决方案（不更改界面）将类似于：

```
return AppendFolders(new string[] { basefolder, version, callingModule }.Concat(extraFolders).ToArray()); 
```

编辑：

虽然您无法通过扩展方法添加运算符，但您可以执行以下操作：

```
return AppendFolders(new string[] { baseFolder, callingModuleName, version }.Concat(extraFolders));

public static T[] Concat<T>(this T[] a, T[] b) {
   return ((IEnumerable<T>)a).Concat(b).ToArray();
} 
```

但是，如果我们要走得那么远 - 不妨扩展 List<T> 来优雅地处理这个问题：

```
return AppendFolders(new Params<string>() { baseFolder, callingModuleName, version, extraFolders });

class Params<T> : List<T> {
    public void Add(IEnumerable<T> collection) {
       base.AddRange(collection);
    }

    public static implicit operator T[](Params<T> a) {
       return a.ToArray();
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-10T19:23:25.687

一个快速而肮脏的解决方案是从项目构建一个 List<string>，然后传递它（使用 ToArray()）。

请注意，您不需要测试反斜杠。Path.Combine 可以很好地处理[脏东西](https://stackoverflow.com/questions/144439/building-a-directory-string-from-component-parts-in-c)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-10T19:45:20.043

我认为 OregonGhost 的答案可能是你想走的路。只是为了详细说明，他建议做这样的事情：

```
public string GetPath(string basefolder, string[] extraFolders)
{
    string version = Versioner.GetBuildAndDotNetVersions();
    string callingModule = StackCrawler.GetCallingModuleName();

    List<string> parameters = new List<string>(extraFolders.Length + 3);
    parameters.Add(basefolder);
    parameters.Add(version);
    parameters.Add(callingModule);
    parameters.AddRange(extraFolders);
    return AppendFolders(parameters.ToArray());
} 
```

我并不是说这是关于如何使用列表的一课，只是对任何可能在未来寻找解决方案的人进行一点澄清。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-10T21:14:32.263

一种选择是将`params`参数设为`object[]`：

```
static string appendFolders(params object[] folders)
 { return (string) folders.Aggregate("",(output, f) => 
                       Path.Combine( (string)output
                                    ,(f is string[]) 
                                      ? appendFolders((object[])f)
                                      : ((string)f).TrimStart('\\')));
 } 
```

如果您想要更强类型的东西，另一种选择是使用隐式转换运算符创建自定义联合类型：

```
 static string appendFolders(params StringOrArray[] folders)
     { return folders.SelectMany(x=>x.AsEnumerable())
                     .Aggregate("",
                       (output, f)=>Path.Combine(output,f.TrimStart('\\')));
     }

   class StringOrArray
     { string[] array;

       public IEnumerable<string> AsEnumerable()
        { return soa.array;}

       public static implicit operator StringOrArray(string   s)   
        { return new StringOrArray{array=new[]{s}};}

       public static implicit operator StringOrArray(string[] s)  
        { return new StringOrArray{array=s};}
     } 
```

无论哪种情况，这**将**编译：

```
appendFolders("base", "v1", "module", new[]{"debug","bin"}); 
```

# .net - 什么是作为数组的具体泛型的标准 CLR XML？

> ID：192717
> 
> 赞同：1
> 
> 时间：2008-10-10T19:19:59.640
> 
> 标签：.net, xml, syntax

这是我不知道正确的 Xml 语法的一个简单问题。在温莎城堡中，我可以复制这行代码：

```
IoC.Container.AddComponent<IInputRequestedDialog<string>, SealsInputDialog>("seals"); 
```

使用此 XML：

```
<component id="seals" 
    service="MyApp.InputRequestedDialog`1[[System.String]], MyApp" 
    type="MyApp.SealsInputDialog, MyApp" /> 
```

但是，如果具体的泛型是字符串数组而不是字符串呢？如何对以下内容进行 xml 化？

```
IoC.Container.AddComponent<IInputRequestedDialog<string[]>, SealsInputDialog>("seals"); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-13T14:54:17.647

引用[Castle Project 邮件列表中的 Ken Egozi 的](http://groups.google.com/group/castle-project-devel/browse_thread/thread/ab3eb5bd01383bc1)话：

* * *

我已经做了

```
Console.WriteLine(typeof (IFoo<string[]>).FullName); 
```

输出是：

> IFoo`1[[System.String[]，mscorlib，版本=2.0.0.0，文化=中性，PublicKeyToken=b77a5c561934e089]]

所以我猜

```
 service="MyApp.InputRequestedDialog`1[System.String[] ], MyApp" 
```

应该可以工作，如果没有，

```
 service="MyApp.InputRequestedDialog`1[[System.String[], mscorlib, Version= 
2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089]], MyApp" 
```

* * *

System.String[] 效果很好，而且我也学到了一些关于如何找出类型的正确 Xml 表示的知识！

# java - 没有 J2EE 容器的 JNDI（使用 JNP？也许是其他一些提供者？）

> ID：192718
> 
> 赞同：5
> 
> 时间：2008-10-10T19:20:55.317
> 
> 标签：java, jakarta-ee, jboss, jms, jndi

我需要在没有 J2EE 容器开销的情况下运行 JNDI 提供程序。我已尝试按照本文中的说明进行操作，该[文章](http://www.javaworld.com/javaworld/jw-04-2002/jw-0419-jndi.html)准确地描述了（第 3 页）我想要做什么。不幸的是，这些方向都失败了。我也必须将 jboss-common.jar 添加到我的类路径中。一旦我这样做了，我会得到一个堆栈跟踪：

```
$ java org.jnp.server.Main
0    [main] DEBUG
org.jboss.naming.Naming  - Creating
NamingServer stub, theServer=null,rmiPort=0,clientSocketFactory=null,serverSocketFactory=org.jboss.net.sockets.DefaultSocketFactory@ad093076[bindAddress=null]
Exception in thread "main"
java.lang.NullPointerException
     at org.jnp.server.Main.getNamingInstance(Main.java:301)
     at org.jnp.server.Main.initJnpInvoker(Main.java:354)
     at org.jnp.server.Main.start(Main.java:316)
     at org.jnp.server.Main.main(Main.java:104) 
```

我希望能够完成这项工作，但我也愿意向其他轻量级独立 JNDI 提供者开放。所有这一切都是为了使 ActiveMQ 工作，如果有人可以建议另一个轻量级 JMS 提供程序，它可以在 vm 之外很好地工作，客户端所在的客户端不需要一个完整的应用程序服务器也可以工作。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-13T09:10:33.830

[Apache ActiveMQ](http://activemq.apache.org/)已经带有一个集成的轻量级 JNDI 提供程序。请参阅[这些使用说明](http://activemq.apache.org/jndi-support.html)。

基本上，您只需将 jndi.properties 文件添加到类路径即可。

```
java.naming.factory.initial = org.apache.activemq.jndi.ActiveMQInitialContextFactory

# use the following property to configure the default connector
java.naming.provider.url = failover:tcp://localhost:61616

# use the following property to specify the JNDI name the connection factory
# should appear as. 
#connectionFactoryNames = connectionFactory, queueConnectionFactory, topicConnectionFactry

# register some queues in JNDI using the form
# queue.[jndiName] = [physicalName]
queue.MyQueue = example.MyQueue

# register some topics in JNDI using the form
# topic.[jndiName] = [physicalName]
topic.MyTopic = example.MyTopic 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-10T20:34:43.267

使用这样的 jndi.properties 文件：

```
java.naming.factory.initial=org.apache.activemq.jndi.ActiveMQInitialContextFactory

# use the following property to configure the default connector
java.naming.provider.url=tcp://jmshost:61616

# use the following property to specify the JNDI name the connection factory
# should appear as. 
#connectionFactoryNames = connectionFactory, queueConnectionFactory, topicConnectionFactry

# register some queues in JNDI using the form
# queue.[jndiName] = [physicalName]
#queue.MyQueue = example.MyQueue

# register some topics in JNDI using the form
# topic.[jndiName] = [physicalName]
topic.myTopic = MY.TOPIC 
```

确保此文件在您的类路径中。然后您可以像这样查找主题/队列（减去适当的尝试/捕获）：

```
context = new InitialContext(properties);

context = (Context) context.lookup("java:comp/env/jms");

topicConnectionFactory = (TopicConnectionFactory) context.lookup("ConnectionFactory");

topic = (Topic) context.lookup("myTopic"); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-10T19:23:53.937

JBoss JMQ 也可以仅使用 MicroKernel 和非常少的库集来运行。JBoss AS 安装程序具有“配置文件”选项，其中之一是用于独立 JMQ。它还允许您挑选和选择组件（尽管它对您的依赖关系没有太多帮助）。您是否尝试过运行安装程序？

# language-agnostic - 网站应该跟踪访问者和/或用户对该网站的行为是否有限制？

> ID：192719
> 
> 赞同：1
> 
> 时间：2008-10-10T19:21:02.710
> 
> 标签：language-agnostic

一旦用户开始一个会话（或登录，对于注册用户，关联多个会话），他们的特定页面浏览量就会被跟踪。然后可以通过多种方式使用这些数据，从定向广告到电子邮件更新，再到网站经常访问的部分。

只要在隐私政策等中注明，这会是错误的吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-10T19:22:35.673

我认为只要您在隐私政策中明确，您就可以合法。从道德上讲，为用户提供选择退出的方式可能是值得的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-10T19:23:59.663

如果您完全按照您在隐私政策中披露的内容行事，并且用户对隐私政策规则有清晰合理的理解，那么您就可以了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-10T19:56:08.040

当然有合法和道德的方式来做这样的事情。然而，我认为这样的事情最大的问题更多是营销问题。

谷歌的有针对性的文字广告（我不觉得有侵入性）和弹出窗口、动画横幅广告等之间有一条很好但很重要的界限。同样，非常有针对性的电子邮件更新（例如， “如果此页面已更新，请给我发电子邮件”框）和垃圾邮件更新（例如，“您已使用我们的网站，我们添加了您可能关心或不关心的此功能！”）

如果您谨慎而巧妙地使用您收集的关于客户/访客的数据（尤其是尽可能多地选择加入），那应该没问题，并且您不会惹恼潜在的回头客。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-10T19:34:46.320

通过跟踪页面浏览量，您只是记录了他们无论如何都可以合理期望您记录的信息（无论如何它都在网络博客中）。您如何处理这些信息、如何保护它，以及您是否选择以某种方式对其进行匿名处理，这些都是比较主观的问题，应该在您的隐私政策中明确回答。

IANAL，但如果你想联系某人，他们应该可以选择退出，即使他们没有选择退出，通信也应该限制在你可以合理地期望他们感兴趣的事情上（可能基于页面浏览量、购买、一般网站主题等）。

选择加入让您可以向他们发送更广泛的内容，因为他们错过选择退出的可能性要小得多。

我会选择一个你认为合理的政策，然后问几个同事他们是否对该政策感到满意。如果他们同意（并且您已与律师核实），请在隐私政策中明确说明并继续。

# objective-c - 为什么我不应该在 init/dealloc 中使用 Objective C 2.0 访问器？

> ID：192721
> 
> 赞同：42
> 
> 时间：2008-10-10T19:21:32.837
> 
> 标签：objective-c, cocoa

在[@mmalc](https://stackoverflow.com/users/23233/mmalc) 对[这个问题的](https://stackoverflow.com/questions/155964/what-are-best-practices-that-you-use-when-writing-objective-c-and-cocoa)[回答](https://stackoverflow.com/questions/155964/what-are-best-practices-that-you-use-when-writing-objective-c-and-cocoa#156288)中，他指出“一般来说，您不应该*在*dealloc（或 init）中使用访问器方法。” 为什么 mmalc 会这样说？

 *我能想到的唯一真正原因是性能和避免@dynamic setter 的未知副作用。

讨论？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-10-10T20:00:48.030

它基本上是一个将错误可能性降至最低的指南。

在这种情况下，您的 setter/getter 可能会无意中对对象的状态做出直接或间接的假设。当对象处于设置或销毁过程中时，这些假设可能会成为问题。

例如，在下面的代码中，观察者不知道“示例”正在被销毁，并且可以假设其他已被释放的属性是有效的。

（您可以争辩说您的对象应该在自行拆除之前移除所有观察者，这是一种很好的做法，也是防止意外问题的另一个准则）。

```
@implementation Example

-(void) setFoo:(Foo*)foo
{
   _foo = foo;
  [_observer onPropertyChange:self object:foo];
}

-(void) dealloc
{
   ...
   self.foo = nil;
}

@end 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-10-22T21:10:36.667

这一切都是关于使用惯用一致的代码。如果您正确地对所有代码进行模式化，则有一组规则可以保证在 init/dealloc 中使用访问器是安全的。

最大的问题是（正如 mmalc 所说）设置属性默认状态的代码不应通过访问器，因为它会导致各种讨厌的问题。问题是 init 没有理由设置属性的默认状态。由于多种原因，我一直在使用自初始化的访问器，如下面的简单示例：

```
- (NSMutableDictionary *) myMutableDict {
    if (!myMutableDict) {
        myMutableDict = [[NSMutableDictionary alloc] init];
    }

    return myMutableDict;
} 
```

这种类型的属性初始化允许延迟许多实际上可能不需要的初始化代码。在上述情况下，init 不负责初始化属性状态，并且在 init 方法中使用访问器是完全安全的（甚至是必要的）。

诚然，这确实对您的代码施加了额外的限制，例如，具有超类中属性的自定义访问器的子类必须调用超类访问器，但这些限制与 Cocoa 中常见的各种其他限制并不不一致。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-10-11T09:08:32.417

你是在自问自答：

1.  性能本身可能是一个完全充分的理由（特别是如果您的访问器是原子的）。
2.  您应该避免访问器可能具有的任何副作用。

如果您的类可能是子类，则后者尤其是一个问题。

但是，尚不清楚为什么在*Objective-C 2*访问器中专门解决了这个问题？无论您是使用声明的属性还是自己编写访问器，都适用相同的原则。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-10-16T17:52:17.610

可能是 setter 具有应该运行的逻辑，或者实现使用了名称与 getter/setter 不同的 ivar，或者可能需要释放和/或将其值设置为 nil 的两个 ivar。唯一可靠的方法是调用 setter。setter 有责任以这样一种方式编写，即在 init 或 dealloc 期间调用时不会发生不希望的副作用。

来自“Cocoa 设计模式”，Buck，Yacktman，第 115 页：“...当您使用现代 Objective-C 运行时或...的合成实例变量时，没有其他实用的替代方法可以替代使用访问器。”

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-01-03T21:46:08.900

事实上，对于一个频繁出现和消失的类（如详细视图控制器），您希望在 init 中使用访问器；否则，您最终可能会在 viewDidUnload 中释放一个您稍后尝试访问的值（它们在 CS193P 中显示...）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-12-09T20:57:47.453

您可以通过在分配/解除分配时不调用设置器来创建相同的问题。

我不认为你可以通过在 init/dealloc 中直接使用保留/释放来实现任何目标。您只需更改可能的错误集。

每次您必须考虑财产分配/解除分配的顺序。

# web-services - 有什么地方可以搜索可用的网络服务吗？

> ID：192723
> 
> 赞同：21
> 
> 时间：2008-10-10T19:21:57.467
> 
> 标签：web-services, api, mashup

我想知道是否有一个网站可以收集（并希望更新）有关可用网络服务的信息。

编辑：感谢所有信息；许多好的答案。我目前只能接受1作为“接受的答案”，所以我选择了我最喜欢的一个。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-10T19:30:12.007

[webservicelist](http://www.webservicelist.com)是一个地方..

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-10T19:41:48.397

[http://www.programmableweb.com/apis](http://www.programmableweb.com/apis)怎么样？它有一个相当大的流行 Web 服务列表和每个服务的快速信息表，包括如何访问它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-10T19:36:33.257

回到 web 服务要接管世界的时候，我偶然发现了[xmethods.net](http://www.xmethods.net/)。它仍然存在，但我不能再保证它的准确性或及时性。注意过时的简介：

> 新兴的 Web 服务标准，如 SOAP、WSDL 和 UDDI，将使系统到系统的集成比以往任何时候都容易。

谷歌搜索[网络服务列表](http://www.google.com/search?aq=f&sourceid=chrome&ie=UTF-8&q=web+services+list)指向您可能还想查看的几个评分较高的网站：

*   恰当地命名为[http://www.webservicelist.com/](http://www.webservicelist.com/)
*   [http://www.webservicex.net](http://www.webservicex.net)

就个人而言，我发现随机、免费的网络服务比它们的价值更麻烦。几乎他们正在做的任何事情*，我都可以以最低的成本更有效、更可靠地为自己提供服务。

如果我正在寻找特定问题的解决方案，例如。安全地存储信用卡数据，然后我将评估该空间中的选项——网络服务与否。

*   值得注意的例外情况包括访问专有数据，例如 CDDB 或 Amazon。但是，如果我需要这些数据，一个快速的谷歌会出现谁拥有高质量的数据——然后它会为它找到一个 API。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-10T19:46:52.287

NOAA 提供了一个很棒的（免费的）天气网络服务集合供您使用，

[http://www.weather.gov/xml/](http://www.weather.gov/xml/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-10T19:34:21.267

不是一个真正的网站，但您可以使用[UDDI](http://en.wikipedia.org/wiki/UDDI)查找有关发布服务列表的企业提供哪些 Web 服务的信息。我链接到的页面底部列出了几个客户端实现。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-12-03T13:24:51.860

**Seekda.com 仅**用于“大”(WS-*) 服务，基于 WSDL/SOAP。让我知道您是否发现它有用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-03-27T10:31:32.327

看看[http://usgovxml.com](http://usgovxml.com)。USGovXML.com 是美国政府提供的公开可用的 Web 服务和 XML 数据源的索引。

# memory - 为什么 Erlang 在大序列上崩溃？

> ID：192725
> 
> 赞同：5
> 
> 时间：2008-10-10T19:22:45.860
> 
> 标签：memory, memory-management, erlang

我刚刚开始学习 Erlang，并且正在尝试一些 Project Euler 问题以开始学习。但是，我似乎能够对大序列执行任何操作而不会导致 erlang shell 崩溃。

即，即使这样：

```
list:seq(1,64000000). 
```

使erlang崩溃，并出现错误：

eheap_alloc：无法分配 467078560 字节的内存（“堆”类型）。

实际上，字节数当然会有所不同。

现在半个 gig 是很多内存，但是一个具有 4 gigs RAM 和大量虚拟内存空间的系统应该能够处理它。

有没有办法让erlang使用更多的内存？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-11T07:25:53.763

您的操作系统可能对用户进程的大小有默认限制。在 Linux 上，您可以使用 ulimit 更改它。

您可能想要遍历这 64000000 个数字，而不需要一次将它们全部存储在内存中。惰性列表让您可以编写与 list-all-at-once 代码风格相似的代码：

```
-module(lazy).
-export([seq/2]).

seq(M, N) when M =< N ->
    fun() -> [M | seq(M+1, N)] end;
seq(_, _) ->
    fun () -> [] end.

1> Ns = lazy:seq(1, 64000000).
#Fun<lazy.0.26378159>
2> hd(Ns()).
1
3> Ns2 = tl(Ns()).
#Fun<lazy.0.26378159>
4> hd(Ns2()).
2 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-10T19:38:17.420

可能是一个菜鸟答案（我是一名 Java 开发人员），但 JVM 人为地限制了内存量以帮助更轻松地检测内存泄漏。也许erlang有类似的限制？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-10T21:11:06.670

此外，windows 和 linux 都对图像可以占用的最大内存量有限制我记得在 linux 上它是 0.5 GB。

真正的问题是为什么这些操作没有懒惰地完成；）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-11T16:54:00.323

这是一个特点。我们不希望一个进程消耗所有内存。它就像你家的保险丝盒。为了我们大家的安全。

您必须了解 erlangs 恢复模型才能了解他们让进程终止的方式。

# git - 如何让 git-svn 使用特定的 svn 分支作为远程存储库？

> ID：192736
> 
> 赞同：61
> 
> 时间：2008-10-10T19:26:44.057
> 
> 标签：git, svn, repository, branch, git-svn

一句警告：总的来说，我是一个n00b `git`。我的团队在 中使用功能分支`svn`，我想用它`git-svn`来跟踪我在特定功能分支上的工作。我一直（大致）遵循[Andy Delcambre 的帖子](http://andy.delcambre.com/2008/03/04/git-svn-workflow.html)来设置我的本地存储`git`库，但这些说明似乎导致`git`选择`svn`最近更改的分支作为远程存储库；问题是那不是我关心的分支。如何控制`git-svn`使用哪个分支？还是我完全错误地接近这个？

更新：我确实使用了`-T`、`-b`和`-t`选项（在我的情况下，因为`svn`repo 有多个项目，但我希望`git`repo 只包含我正在处理的项目）。

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2008-10-13T12:41:16.620

Muchas gracias to Bart's Blog 为[git 中的 svn 分支提供了方便的参考](http://www.jukie.net/~bart/blog/svn-branches-in-git)。显然，我只需要在创建分支时指定一个远程分支`git`，例如，

```
git checkout -b git-topic-branch-foo foo 
```

`foo`远程分支的名称在哪里。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-03-30T07:33:30.663

你也可以看看这个：[git-svn is a gateway drug-robby on rails](http://www.robbyonrails.com/articles/2008/04/10/git-svn-is-a-gateway-drug)。

当我需要确保我的本地分支指向正确的远程 svn 分支时，我使用了类似的东西：

```
git branch -r 
```

获取我要跟踪的远程分支的名称。然后

```
git reset --hard remotes/svn-branch-name 
```

显式更改我的本地分支以指向不同的远程分支。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2011-09-01T10:23:34.953

我需要先运行“git svn fetch”，因为我想要关联的分支是在我的 git 客户端之后创建的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-10T19:34:46.833

我使用 git-svn 但我没有使用与 SVN 分支互操作的功能。话虽如此，我注意到您所遵循的教程没有使用[-T、-b、-t](http://git-scm.com/docs/git-svn)选项来 git svn init。这些选项告诉 git-svn 上游主干/分支/标签目录的名称，这在您的情况下可能很重要。

# delphi - 将 ODBC 数据源与 Delphi 2006+ 连接的正确方法？

> ID：192742
> 
> 赞同：4
> 
> 时间：2008-10-10T19:28:06.207
> 
> 标签：delphi, odbc

连接 ODBC 数据源并执行一些 SQL 语句的正确方法是什么？

TQuery 和其他 BDE 组件可以做到这一点，但如果我理解正确，它们现在已被弃用了吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-10T19:33:31.437

您可以使用 ADO 组件：

1) 从 dbGo 选项卡中拖动一个 TAdoConnection。

2）右键单击并选择编辑连接字符串。

3）点击构建

4) 选择 Microsoft OLE DB Provider for ODBC

5) 点击下一步

然后，您将能够选择一个数据库。

您可以拖动 TAdoQuery 并将其连接到 TAdoConnection 以执行一些查询。

其余的应该是直截了当的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-10T19:39:02.753

ADO（在 dbGo 组件组件组下）以及 dbExpress（在 dbExpress 组件组下）浮现在脑海中。

# asp.net - 在 IE7 中使用 ASP.Net、CSS、VS 2008 的奇怪定位行为

> ID：192748
> 
> 赞同：1
> 
> 时间：2008-10-10T19:30:15.593
> 
> 标签：asp.net, css, css-position

我正在使用 ASP.Net/C# 中的一个网页，该网页使用文本框的绝对定位，事实上有几个。它工作得很好，直到我添加了更多的文本框。也就是说，现有的文本框仍然正确定位，但新的文本框没有，尽管我在 CSS 中为它们创建了新样式，就像其他的一样。一个例子如下：

```
.pieceBox {
    position: absolute;
    top: 425px;
    left: 133px;
    background-color: White;
    color: Black;
    width: 132px;
    font-weight: bold;
    text-align: center;     
} 
```

同一个 CSS 文件（当然名称不同）中相同的样式在这个文件的上方和下方都可以正常工作。我已经检查、仔细检查和三重检查了 CssClass 属性中的样式名称，它是正确的。但是，无论我做什么，包括给它一个新名称，复制旧条目，重命名它们等等，这三个新文本框都将自己定位在页面顶部，而其他文本框则显示在正确的绝对位置. 我查看了 aspx 源页面并确保它们不在其他 DIV 中，等等。我对此束手无策。我现在确实想出了一个解决方法，但这不是我想要的方式（涉及以编程方式在 Asp:Literal 中创建一些 HTML。）

我检查了生成的源代码（通过 IE 的视图源），并且在生成的 HTML 中正确设置了类。

万一这很重要，还有一件事；这个网站项目最初是在 VS 2005 中创建的，并转换为 VS 2008 格式。没关系，但我想我会提到它。

有没有其他人经历过这种行为？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-11T01:22:50.813

如果您的绝对定位元素的父元素是绝对定位或相对定位，则它们将相对于其容器而不是整个页面定位自己。

换句话说，您的元素可能会从不同的原点定位自己。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-10T19:57:01.343

如果没有提供实际代码，很难解释这样的问题，但我的第一个猜测是，您遇到的新控件与旧控件不使用相同父容器的问题。

您是否检查过适用于正常工作文本框的父容器的 css 规则？它们通常应设置为“位置：相对；” 如果您想让您的子控件根据它们对齐。

还要确保布局问题不会由于控件的重叠而发生，即两个文本框可能具有相似或接近的位置，然后一个出现在另一个上。

无论如何，如果您想要正确和直接地解决您的问题，我建议您发布部分代码。

# c# - 调用中止后的 MSDTC 和 Oracle 事务锁？

> ID：192756
> 
> 赞同：2
> 
> 时间：2008-10-10T19:32:41.067
> 
> 标签：c#, oracle, transactions, msdtc

我在使用 MSDTC 和 Oracle 时遇到了问题。这是一个 .net 应用程序，我使用 TransactionScope 类来控制事务。

问题是，有时，如果事务回滚（在没有调用 scope.Complete 的情况下调用了 scope.Dispose），它会长时间处于“Aborting”状态，而不是释放锁定的记录。即使事务处于“Aborting”状态，当调用 Dispose 以中止事务时，它也会立即返回，因此线程不会卡住。

有谁知道什么会导致事务表现得像这样并在调用 abort 后保留锁？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-10T21:14:23.153

在使用 Microsoft Data Provider for Oracle 时，存在有关使用分布式事务的已知问题。

如果您正在使用它，请尝试切换到[ODP.NET](http://www.oracle.com/technology/tech/windows/odpnet/index.html)提供程序，这应该可以解决您的事务问题。

# registration - 如何以编程方式注册域名？

> ID：192767
> 
> 赞同：10
> 
> 时间：2008-10-10T19:36:54.693
> 
> 标签：registration, domain-name

是否有任何域名注册商支持使用 Web 服务或类似功能进行域名注册，而不会告诉您成为经销商？

我没有注册那么多域名，也没有兴趣支付经销商费用。

如果我可以在不支付前期费用的情况下成为经销商，那很好。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-13T15:59:35.800

[www.opensrs.com](http://www.opensrs.com)一次性收取 95 美元的设置费（转换为 95 美元的账户信用）。这不是你要求的，但它很低。您可以访问一个有据可查的功能性 API。但是，您需要通过向您的帐户存入贷方来支付域费用，然后从那里购买域。我认为这笔初始存款的数额没有任何限制。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-24T11:32:22.337

尽管名字很不幸，[但 NameCheap.com](http://namecheap.com)确实不错。我已经将我所有的域都移到了他们那里，并且我发现它们是我使用过的最好的注册商。

他们还有一个 API ( [developer.namecheap.com](http://developer.namecheap.com/docs/) )，可以免费使用 - 尽管您的帐户必须有 200 美元或更多，在过去两年中花费了 200 美元，或者您的帐户中有 20 个域。

我才刚刚开始使用 API，但到目前为止它似乎还不错。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-13T16:51:05.757

[Dotster](http://www.dotster.com/resources/partnerships/)实际上有一个免费的经销商计划，他们曾经有一个 API 可以用来注册域名。如果您想自动注册域名，无论如何都要调查一下。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-15T02:36:57.603

当我以编程方式注册域时，我查看了几个注册商的 API。我的需求是基本的——我只是想注册一个域名......而不是更改所有权、转发 URL、查看天气或所有其他的花里胡哨。

我最终使用了[Moniker.com](http://www.moniker.com)，发现他们的 API 简单直接。我阅读了他们的文档，并在一小时内起床并开始工作。

# firefox - ZeroConf extension that can be used in Firefox/XULRunner?

> ID：192773
> 
> 赞同：1
> 
> 时间：2008-10-10T19:38:22.647
> 
> 标签：firefox, xulrunner, zeroconf, mdns, slp

Is there a [ZeroConf](http://en.wikipedia.org/wiki/ZeroConf) client extension for Firefox/XULRunner to be used in a zeroConf environment based on either [mDNS](http://files.multicastdns.org/draft-cheshire-dnsext-multicastdns.txt) or [SLP](http://en.wikipedia.org/wiki/Service_Location_Protocol)?

I know of an extension already that's being developed by the [ActiveState Open Komodo](http://svn.openkomodo.com/openkomodo/browse/addons/sdconnector/) folks but it requires PyXPCOM support to be baked into the XULRunner runtime in order to access the Apple [Bonjour](http://developer.apple.com/networking/bonjour/download/) libs for Windows. Is there anything else available?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-08T21:59:11.253

It appears that Andrew Tunnell-Jones has undertaken the task.

[http://andrew.tj.id.au/projects/bonjourfoxy/](http://andrew.tj.id.au/projects/bonjourfoxy/)

I have not yet verified that it works for me under Windows, but I am hopeful :)

It did not discover that I activated web sharing here, only with a user account active. Let me know what you find.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T02:16:24.947

[BonjourFoxy](http://www.bonjourfoxy.net/) has come some way since Thorbjørn Ravn Andersen's post. It's implemented as a set of binary XPCOM modules tied together with a JavaScript XPCOM service. The service can be used to register, browse and resolve services as well as to enumerate browse and registrations domains. It builds and runs on OS X 10.5 (Intel), Ubuntu 8.10 (32-bit) and Windows XP (32-bit) and has been run on Windows 2000 as well.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-11-26T09:42:06.093

The links given in this answer are dead or misleading. It seems like the project has changed its name and can now be found at [http://dnssd.me/](http://dnssd.me/) .

I can confirm it works on

`Mozilla/5.0 (Windows NT 6.1; WOW64; rv:16.0) Gecko/20100101 Firefox/16.0` on Win7.

I would have commented the posts, but don't have enough reputation to do so.

# matlab - 在matlab中创建输出m文件

> ID：192796
> 
> 赞同：1
> 
> 时间：2008-10-10T19:45:19.073
> 
> 标签：matlab

假设我有一个计算的 M 文件，例如ת `d=a+b+c`（前面给出了 `a`,`b`上的值）。`c`

我应该使用什么命令来生成一个输出 M 文件来显示这个总和的结果？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-10T20:01:50.413

在 Matlab 中使用分号“;” 在一行的末尾抑制输出。所以，

```
>> d=1+2;
>> d=1+2
d = 
    3 
```

或者您可以像第[一个答案一样使用](https://stackoverflow.com/questions/192796/creating-output-m-file-in-matlab#192841)*disp*。

```
>> disp(num2str(d));
3 
```

如果要将变量的值写入文件，可以使用*dlmwrite*（使用 Matlab 的帮助功能获取更多信息）或*保存*命令。对于*dlmwrite*，用法基本上是

```
>> dlmwrite('filename',d,',') 
```

它将向量（矩阵）d 写入名为*filename*的文本文件，使用逗号作为元素之间的分隔符。

另一种选择是使用*save*命令，如

```
>> save('filename','d') 
```

这会将变量“d”保存到 MAT 文件中（有关更多信息，请参阅*帮助保存*）。希望这可以帮助？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-11T06:46:06.230

To expand on [Azim's answer](https://stackoverflow.com/questions/192796/creating-output-m-file-in-matlab#192859), the **save** command can be used to save variables to a text file. In your case you would use:

```
save 'filename' d -ascii 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-10T19:58:30.343

```
disp(num2str(d)); 
```

# c# - 非平凡的数据绑定

> ID：192801
> 
> 赞同：0
> 
> 时间：2008-10-10T19:46:44.127
> 
> 标签：c#, .net, data-binding

琐碎的数据绑定示例就是这样，琐碎的。我想做一些更复杂的事情，想知道是否有一种简单的内置方法来处理它。

```
public partial class Form1 : Form
{
  public Form1()
  {
    InitializeComponent();
    List<DataStruct> list = new List<DataStruct>()
    {
      new DataStruct(){Name = "Name 1", Value = "Value 1", ComplexValue = new ComplexValue(){Part1 = "1:P1", Part2 = "1:P2"}},
      new DataStruct(){Name = "Name 2", Value = "Value 2", ComplexValue = new ComplexValue(){Part1 = "2:P1", Part2 = "2:P2"}}
    };

    listBox1.DataSource = list;
    listBox1.DisplayMember = "ComplexValue.Part1";
  }
}

public class DataStruct
{
  public string Name { get; set; }
  public string Value { get; set; }
  public ComplexValue ComplexValue { get; set; }
}

public class ComplexValue
{
  public string Part1 { get; set; }
  public string Part2 { get; set; }
} 
```

是否有一种简单的方法可以将 Part1 属性的值设置为 DataStruct 项列表的显示成员？上面我尝试了一些我认为有意义的方法，但它只是默认返回 DataStruct 上的 ToString()。如有必要，我可以解决它，我只是想知道数据绑定中是否有内置的东西可以处理像上面这样更复杂的数据绑定。

编辑：使用 WinForms

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-10T20:03:50.347

也许不是一种内置的方式，但你总是可以定义

```
DataStruct {
    public ComplexValuePart1 { 
        get { return ComplexValue.Part1; }
    }
} 
```

并将您的 DisplayMember 设置为

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-10T20:11:04.047

就我个人而言，我会选择像 Jimmy's 这样的简单解决方案——但是，如果你*想*这样做（使用常规的 win-form 绑定），你需要使用自定义类型描述符将`Part1`/展平`Part2`为`DataStruct`. 您可以通过`ICustomTypeDescriptor`或执行此操作`TypeDescriptionProvider`。后者涉及更多，但从“关注点分离”的角度来看更清晰。

如果你真的想要我可以准备一个例子（或者我过去做过很多）——但简单就是美丽：如果你只有几个属性，一个简单的外观（即通过属性`DataStruct`）会更可取。

# svn - 按文件扩展名过滤的 SVN 结帐？

> ID：192810
> 
> 赞同：16
> 
> 时间：2008-10-10T19:49:27.960
> 
> 标签：svn, svn-checkout

我有一个 DOS 批处理文件形式的自制自动构建脚本。在该脚本的一部分中，我检查了（使用“svn checkout”）我们 SVN 存储库的一部分，其中包括我们项目中使用的一堆第三方内容。这个批处理文件在很长一段时间内运行良好，但是现在人们已经将大量的绒毛（文档、示例代码等）签入到第三方区域，并且该脚本的签出部分变得慢了很多。我想通过只检查我们需要的东西来缓解这种情况——在我们的例子中主要是 dll 文件。所以，我的问题是：检查按文件扩展名过滤的 SVN 存储库的最佳方法是什么？

我在 svn 帮助中没有看到任何明显的方法来做到这一点。我有一个以某种方式包装 svn.exe 的 .NET 实用程序库，我正在考虑扩展它以仅检索与我感兴趣的扩展匹配的内容。但如果存在，我更愿意使用更简单或现有的方法。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2010-01-07T21:47:48.407

这是可能的：您可以`svn checkout`创建一个空目录，然后为*您*`svn update filename`想要的每个文件。

 *您的脚本可以执行以下操作：

1.  `svn checkout svn://path/to/repos/directory --depth empty`
2.  `svn list --recursive svn://path/to/repos/directory`
3.  通过删除禁止文件扩展名的过滤器将结果管道化，例如`grep`
4.  遍历这个新的过滤列表和`svn update --parents`每个文件

这将为您提供没有某些文件或文件扩展名的工作副本的所需结果。

当然，还有你提到的“人们[检查]很多绒毛”的问题，但这是另一回事。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-10T20:00:16.393

正如我在[这里](https://stackoverflow.com/questions/192824/svn-checkout-ignore-folder)所说，SVN 本身只有一个选项：SVN 1.5 中的一个新功能称为**sparse checkout**，但是您只能在目录级别选择签出，因此您必须在不同的目录中对不需要的文件进行排序.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-10T19:57:04.730

您不能只签出几个特定文件 - 您只能签出整个文件夹。您可以重新安排您要签出的内容的组织，或者您可以从其他地方复制一份工作副本并进行更新。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-10-07T01:20:41.077

[对于Michael Hackner](https://stackoverflow.com/users/189919/michael-hackner)答案的 powershell 特定实现，请尝试以下操作：

```
svn ls http://svn-server/src --recursive | Out-File svn.txt
Get-Content .\svn.txt | where {$_.toLower().EndsWith('special.xml')} | select -First 200 | foreach {New-Object PSObject -Property @{ Path = $_; Munged = $_.Replace('/', '_') } } | foreach { svn export "http://svn-server/src/$($_.Path)" $($_.Munged) } 
```

我在这里的特殊用例是找到一堆名称相似的文件（在本例中为 *special.xml），并将它们全部转储到一个文件夹中，具有本质上唯一的名称。我已经使用了一个中间文件来存储整个 repo 列表，但如果这对你更好，这也可以内联。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-04-21T01:12:02.427

我刚刚尝试了 Michael Hackner 提出的方法。下面是 DOS 系统的实现。请注意，您必须在运行此脚本之前签出空文件夹。

```
@echo off

svn list --recursive https://path_to_repository_folder | find /I ".sql" > filelist.txt

REM Specify a custom delim. Otherwise space in filename will be treated as a delimiter.
FOR /F "delims=|" %%i  IN (filelist.txt) DO (
    echo -------------
    echo %%i
    svn update --parents "%%i"
) 
```

* * *

## 回答 #6

> 赞同：-4
> 
> 时间：2008-10-10T20:15:11.637

最简单和正确的方法：不要这样做！

如果第三方文件夹中有一些废话，假设有 .dll 文件需要结帐 - 将这些废话移到其他位置！无论如何它不属于这里。

# security - Windows Server 2003 上的 IIS 管理器 IIS6 权限管理

> ID：192811
> 
> 赞同：2
> 
> 时间：2008-10-10T19:50:27.240
> 
> 标签：security, iis, iis-6, dedicated-hosting, iis-manager

我们正在使用专门的托管服务提供商来托管我们的几个公共网站。我们公司有两个开发团队/部门，每个团队都在这些相同的服务器上维护公共网站。有没有通过 ACL 或某种权限管理（例如个人登录）的方法，我只能查看和维护我的公共站点，而其他开发团队只能查看和维护他们的站点？

谢谢！

克里斯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T15:33:30.873

当然-如果您可以访问服务器，则文件 ACLS 可能是要走的路。

您可以为具有相应用户的本地组“LG-Site1”设置名为 Site1 的目录和 ACL 更改权限，并为组“LG-Site2”设置具有更改权限的目录 Site2。

您确实声明您只想查看您的站点，而不是其他站点 - 这样做的挑战是，如果您登录到服务器，您可能拥有管理员权限，或者至少拥有您所做的任何事情的权限将自己锁定在 Site2 目录之外可以逆转 - 通过临时授予您自己的权利或将您自己添加到 LG-Site2。不一定是表演的终结者，但肯定是一个考虑因素。

您还可以设置 FTP，以便每个开发团队可以发布到他们的目录，但不能进入另一个。

# .net - VB.net 中的#warning 指令

> ID：192822
> 
> 赞同：8
> 
> 时间：2008-10-10T19:53:54.970
> 
> 标签：.net, vb.net, preprocessor, compiler-directives

我知道 #warning 指令在 vb.net 中不存在......有类似的东西吗？
我希望能够在编译器时抛出消息（警告）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-11T00:43:15.587

据我所知……没有。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2020-01-09T09:57:46.783

它与预处理器警告不同，但在大多数情况下，当我需要为用户发出警告时，我会使用 ObsoleteAttribute 生成警告：

`<ObsoleteAttribute("You should no used this method!", False)> Sub MySub() End Sub`

但是，由于它与预处理器警告不同，它只会在有人使用该方法时触发。

# svn - SVN结帐忽略文件夹

> ID：192824
> 
> 赞同：100
> 
> 时间：2008-10-10T19:54:44.313
> 
> 标签：svn, build-automation, cruisecontrol.net, svn-checkout

我可以忽略 svn checkout 上的文件夹吗？我需要在我的构建服务器结帐时忽略 DOCs 文件夹。

**编辑：**忽略外部不是一个选项。我有一些我需要的外部设备。

* * *

## 回答 #1

> 赞同：105
> 
> 时间：2008-10-20T11:44:29.913

您不能在结帐时直接忽略文件夹，但可以在 svn 1.5 中使用稀疏结帐。例如：

```
$ svn co http://subversion/project/trunk my_checkout --depth immediates 
```

这会将项目主干中的文件和目录检查到“my_checkout”中，但不会递归到这些目录中。例如：

```
$ cd my_checkout && ls
bar/ baz foo xyzzy/ 
```

然后获取'bar'的内容：

```
$ cd bar && svn update --set-depth infinity 
```

* * *

## 回答 #2

> 赞同：81
> 
> 时间：2011-12-09T14:03:05.670

是的，您可以使用 SVN 1.6。您需要先进行结帐，然后将文件夹标记为排除，然后删除不需要的文件夹。

```
svn checkout http://www.example.com/project
cd project
svn update --set-depth=exclude docs
rm -fr docs 
```

从现在开始，对工作副本的任何更新都不会重新填充 docs 文件夹。

请参阅[http://blogs.collab.net/subversion/2009/03/sparse-directories-now-with-exclusion/](http://blogs.collab.net/subversion/2009/03/sparse-directories-now-with-exclusion/)和[http://subversion.apache.org/docs/release-notes/1.6.html#sparse-目录排除](http://subversion.apache.org/docs/release-notes/1.6.html#sparse-directory-exclusion)以获取更多详细信息。

汤姆

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-20T11:54:42.857

对于 1.5 之前的版本，我发现如果您只签出最顶层的文件夹然后有选择地更新，那么从那时起更新只会影响您签出的内容。IE。

```
svn co -N foo
cd foo
svn up -N bar
svn up 
```

-N 标志使操作非递归。上面不会检查 foo 级别的任何其他内容，例如。说有一个文件夹`lala`，最后 svn up 不会检出那个文件夹，但是会更新`bar`。

但是稍后您可以`svn up lala`将其添加到结帐中。

大概这也适用于1.5。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-08-31T04:55:51.537

这是在 TortoiseSVN 客户端 1.7.1 中（也可能在某些旧版本中可用）：

*   SVN checkout --> 选择存储库的 URL

*   单击“结帐项目”（在结帐深度下）并仅选择所需的文件夹！

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-10T19:56:28.367

是的，[Subversion 1.5](http://subversion.apache.org/docs/release-notes/1.5.html)有一个叫做[Sparse checkouts](http://subversion.apache.org/docs/release-notes/1.5.html#sparse-checkouts)的特性，它可以做这种事情。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-10T19:57:00.253

您可以将 docs 文件夹放在外部存储库中，然后使用`svn checkout --ignore-externals`.

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-08-12T05:39:33.353

我发现这个问题正在寻找一种在排除回归测试的同时检查 WebKit 源的方法。我最终得到以下结果：

```
svn checkout http://svn.webkit.org/repository/webkit/trunk WebKit \
  --depth immediates

cd WebKit
find . \
  -maxdepth 1 -type d \
  -not -name '.*' \
  -not -name '*Tests' \
  -not -name 'Examples' \
  -not -name 'Websites' \
  | (while read SUBDIR; do svn update --set-depth infinity "$SUBDIR"; done) 
```

请注意，您可以根据需要更改排除项，但建议使用 .* 跳过工作目录（已经是最新的）和所有 .svn 目录。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-12-20T17:24:44.667

我最近解决了同样的任务。这个想法是获取存储库下的文件夹/文件的即时列表，排除您需要的条目，然后检查剩余的文件夹并更新即时文件（如果有）。这是解决方案：

```
 # Path to the svn repository to be checked out
rpath=https://svn-repo.company.com/sw/trunk/ && \
    # This files are to be excluded (folders are ending with '/')
    # this is a regex pattern with OR ('|') between enties to be excluded
excludep='docs_folder/tests_folder/|huge_folder/|file1|file2' && \
    # Get list of the files/folders right under the repository path
filtered=`svn ls $rpath | egrep -v $excludep` && \
    # Get list of files out of filtered - they need to be 'uped'
files=`echo $filtered | sed 's| |\n|g' | egrep '^.*[^/]$'` && \
    # Get list of folders out of filtered - they need to be 'coed'
folders=`echo $filtered | sed 's| |\n|g' | egrep '^.*[/]$'` && \
    # Initial nonrecursive checkout of repository - just empty
    # to the current (./) working directory
svn co $rpath ./ --depth empty && \
    # Update the files
svn up $files &&\
    # Check out the all other folders finally.
svn co `echo $folders | sed "s|\<|$rpath|g"` 
```

切换到源工作目录。复制命令。粘贴。更改适当的 URL 并排除模式。运行命令。

谢谢，

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-10T19:56:03.030

不，忽略仅用于添加文件。
您可以使用稀疏结帐（如果您使用 svn 1.5）

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-13T09:26:05.640

正如其他一些人所提到的，您可以只使用 svn:externals 属性，然后在结帐时使用 --ignore-externals 选项。然而，需要注意的一点是 svn:externals*不一定*需要引用另一个存储库。它可以是对同一仓库中其他文件夹的引用。

# process - 你能冻结一个 C/C++ 进程并在不同的主机上继续它吗？

> ID：192838
> 
> 赞同：11
> 
> 时间：2008-10-10T19:57:58.347
> 
> 标签：process, coredump, process-migration

我想知道是否可以生成一个“核心”文件，将 if 复制到另一台机器，然后继续在该机器上执行核心文件？

我见过 gcore 实用程序，它可以从正在运行的进程生成核心文件。但我不认为 gdb 可以基于核心文件继续执行。

有没有办法只转储堆/堆栈并在以后恢复它们？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-10T20:01:25.673

这称为[进程迁移](http://www.google.com/search?q=process+migration)。

[mosix](http://www.mosix.com/)和[OpenMosix](http://openmosix.sourceforge.net/)曾经能够做到这一点。现在最容易迁移整个虚拟机。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-10T20:04:08.990

在现代系统上，不是来自核心文件，不，你不能。为了在 Linux 上冻结和恢复单个进程，[CryoPID](http://cryopid.berlios.de/)和新[的基于内核的检查点和重启](http://lwn.net/Articles/293575/)正在开发中，但它们的能力目前非常有限。 [OpenVZ](http://wiki.openvz.org/Checkpointing_and_live_migration)和其他类似虚拟化的软件可以冻结和恢复整个系统。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-10T22:45:33.750

还可以查看[Condor](http://www.cs.wisc.edu/condor/)项目。Condor 也可以通过并行作业来做到这一点。Condor 还包括监视器，例如，当某些人再次开始使用他们的工作站时，它们可以自动迁移您的进程。它真的是为在网络环境中利用空闲周期而设计的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-10T20:03:22.267

一般来说，这不足以让任意进程在另一台机器上继续。除了堆和堆栈状态，还可能有打开的 I/O 句柄、分配的硬件资源等。

您的选择是明确编写软件，使其在信号上转储状态，然后从转储状态恢复，或者在虚拟机中运行软件并将其迁移到备用主机 - Xen 和 Vmware 都支持冻结/恢复以及实时迁移。

也就是说，[CryoPID](http://cryopid.berlios.de/)试图准确地做到这一点，并且偶尔会成功。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2017-02-16T16:50:14.693

As of Feb. 2017, there's a fairly stable and mature tool, called [CRIU](https://en.wikipedia.org/wiki/CRIU) that depends on updates to the Linux Kernel made in version 3.11 (as this was done in Sep. 2013, most modern distros should have those incorporated into their kernel versions).

It can be installed via aptitude by simply calling `sudo apt-get install criu`.

[Instructions on how to use it.](http://xmodulo.com/how-to-checkpoint-and-restore-linux-process.html)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-10T20:04:25.433

在某些情况下，这是可以做到的。例如，Emacs 构建过程的一部分是加载所有 Lisp 库，然后将内存映像转储到磁盘上以便快速加载。其他一些语言解释器也这样做（我主要考虑 Lisp 和 Scheme 实现）。但是，它们是专门为这种用途设计的，所以我不知道他们必须做些什么特殊的事情才能让它发挥作用。

我认为这对于随机程序来说很难做到，但是如果您编写了一个所有对象都支持序列化/反序列化的框架，那么您可以序列化程序使用的所有对象，然后将其发送到其他地方，并在另一端。

其他人对虚拟化的回答也在现场。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-10T20:31:46.313

取决于机器。例如，它在非常小的嵌入式系统中非常可行。我认为它也在 Beowulf 集群和其他超级计算机类应用程序中实现了一些。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-10T23:10:32.297

有很多原因你不能很容易地做你想做的事。例如，当您在另一台机器上恢复核心文件时，您如何解析您处理的已打开的文件描述符？那么套接字、命名管道、信号量或任何其他操作系统级别的资源呢？基本上，除非您的系统专门设计用于处理此类操作，否则您不能天真地转储核心文件并将其移动到另一台机器上。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-10-10T20:01:46.047

我不相信这是可能的。但是，您可能想要研究虚拟化软件——例如[Xen——](http://xen.org)它可以冻结整个系统映像并将其从一台机器移动到另一台机器。

# internet-explorer - 如何从 javascript 中获取终端服务客户端机器名称？

> ID：192839
> 
> 赞同：1
> 
> 时间：2008-10-10T19:58:03.900
> 
> 标签：internet-explorer, activex, terminal-services

是否可以从运行 Internet Explorer 的 javascript 中获取机器名称、IP 或 MAC 地址（基本上是客户端网络信息）？

我发现以下代码似乎可以完成此操作：

```
function Button1_onclick() {
  var locator = new ActiveXObject("WbemScripting.SWbemLocator");
  var service = locator.ConnectServer(".");
  var properties = service.ExecQuery("SELECT * FROM Win32_NetworkAdapterConfiguration");
  var e = new Enumerator (properties);
  document.write("<table border=1>");
  dispHeading();
  for (;!e.atEnd();e.moveNext ())
  {
        var p = e.item ();
        document.write("<tr>");
        document.write("<td>" + p.Caption + "</td>");
        document.write("<td>" + p.IPFilterSecurityEnabled + "</td>");
        document.write("<td>" + p.IPPortSecurityEnabled + "</td>");
        document.write("<td>" + p.IPXAddress + "</td>");
        document.write("<td>" + p.IPXEnabled + "</td>");
        document.write("<td>" + p.IPXNetworkNumber + "</td>");
        document.write("<td>" + p.MACAddress + "</td>");
        document.write("<td>" + p.WINSPrimaryServer + "</td>");
        document.write("<td>" + p.WINSSecondaryServer + "</td>");
        document.write("</tr>");
  }
  document.write("</table>"); 
```

}

因此，它使用了一个似乎与操作系统一起安装的 ActiveX 对象来完成此操作。是否可以从终端服务会话中执行类似的操作？获取终端服务客户端网络信息？（不是终端服务器网络信息，这是上述代码从终端服务会话运行时所做的）。

我在想也许还有另一个 Active X 对象可以用来完成这个？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-12T11:08:09.227

基本上，有两种可能性可以获取想到的客户名称/地址：

*   使用MFCOM，即`MetaFrameSession`对象。
*   使用WMI，看起来很有前途的`MetaFrame_ICA_Client`类。`root\Citrix`

Mayor drawback of both solutions is, that they require more user permissions than you might be willing to give. From what I read, at least "Account View" permissions are required within Citrix, but I have no way to test it right now. I could not get either to work as a normal user.

To give you an idea, accessing the info with MFCOM would look something like this:

```
var MetaFrameSessionObject = 6;

var oShell   = new ActiveXObject("WScript.Shell");
var oSession = new ActiveXObject("MetaFrameCOM.MetaFrameSession");

oSession.Initialize(
  MetaFrameSessionObject, 
  oShell.ExpandEnvironmentStrings("%COMPUTERNAME%"), 
  oShell.ExpandEnvironmentStrings("%SESSIONNAME%"), 
  -1
);

alert(oSession.ClientAddress); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-10T21:30:05.180

如果用户登录到终端服务器并在该 TS 会话中访问 Internet Explorer 中的页面，则 Internet Explorer（以及它实例化的任何 ActiveX 控件）运行在终端服务器硬件上，而不是客户端硬件上。

从这个角度来看，在客户端硬件上运行的唯一代码是终端服务客户端软件。要检索有关终端服务客户端硬件/网络/等的网络信息，您必须在客户端硬件上运行代码。

# .net - 如何使用 NHibernate 和 SQL Server 2005 保存 PDF 文件

> ID：192862
> 
> 赞同：2
> 
> 时间：2008-10-10T20:03:07.090
> 
> 标签：.net, sql-server, nhibernate, pdf

我正在开发一个网络应用程序，用户有机会以 pdf 格式上传他的简历。我使用 NHibernate 作为数据映射器和 MS SQL SERVER 2005。

我希望能够将 .pdf 文件保存到给定的表中……有什么想法吗？

非常感谢你！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-14T09:50:22.020

我们使用“原始”Java Hibernate3 正是这样做的。您只需将可持久类的字节数组属性映射到“图像”类型的列。

```
package com.hibernate.pdf.sample;

public class TPDFDocument implements java.io.Serializable {

        private Integer pdfDocumentId;
        private byte[] document;

        public Integer getPdfDocumentId() {
            return this.pdfDocumentId;
        }

        public void setPdfDocumentId(Integer pdfDocumentId) {
            this.pdfDocumentId = pdfDocumentId;
        }

        public byte[] getDocument() {
            return this.document;
        }

        public void setDocument(byte[] document) {
            this.document = document;
        }

} 
```

休眠映射：

```
<hibernate-mapping>
    <class name="com.hibernate.pdf.sample.TPDFDocument" table="T_PDFDocument">
        <id name="pdfDocumentId" type="integer">
            <column name="pdfDocumentId" />
            <generator class="identity" />
        </id>
        <property name="document" type="binary">
            <column name="document" not-null="true" />
        </property>
    </class>
</hibernate-mapping> 
```

表创建：

```
CREATE TABLE [dbo].[T_PDFDocument](
    [pdfDocumentId] [int] IDENTITY(1,1) NOT NULL,
    [document] [image] NOT NULL,
CONSTRAINT [PK_PDFDocument] PRIMARY KEY CLUSTERED 
(
    [pdfDocumentId] ASC
) 
```

您所要做的就是将文档原始字节读入数组并将其持久化。在我们的情况下，文档几乎不会大于 1MB ，因此将整个内容放入字节数组中不会导致性能问题。也许这个解决方案对于非常大的文档是不可行的。

我猜 NHibernate 实现和 C# 的解决方案看起来非常相似。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-10T20:24:17.047

插入表（DocumentId，PDF）值（newid（），0x12345667）

其中十六进制常量是 PDF 的十六进制编码字节流。

我相信有人可以找到更好的方法，但这对我来说很明显。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-10T20:29:18.643

您需要将 PDF 放入表格中的任何原因？您可以将文件保存到文件系统并使用 ID 引用它。这将为您节省一些 SQL Server 空间。我不相信你可以索引二进制数据。

# windows - 设置 Windows 进程（或用户）内存限制

> ID：192876
> 
> 赞同：50
> 
> 时间：2008-10-10T20:07:08.593
> 
> 标签：windows, memory

有没有办法设置一个进程可以在 Windows XP 中使用的系统范围内存限制？我有几个不稳定的应用程序，它们在大多数情况下都可以正常工作，但可能会遇到一个错误，导致在几秒钟内吃掉整个内存（或者至少我想就是这样）。这会导致硬重置，因为 Windows 变得完全没有响应并且我失去了工作。

我希望能够在 Linux 上执行 /etc/limits 之类的操作 - 例如设置 M90（设置 90% 的最大内存供单个用户分配）。因此，无论如何，系统都会获得剩余的 10%。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-10-11T02:02:33.697

使用 Windows[作业对象](http://msdn.microsoft.com/en-us/library/ms684161(VS.85).aspx)。作业就像进程组，可以限制内存使用和进程优先级。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-08-17T19:34:32.370

使用 Microsoft 的[应用程序验证程序 (AppVerifier)](http://msdn.microsoft.com/en-us/library/aa480483.aspx)工具。

就我而言，我需要模拟不再可用的内存，因此我在工具中执行了以下操作：

1.  添加了我的应用程序
2.  未选中的基本
3.  检查低资源模拟
    *   将 TimeOut 更改为 120000 - 我的应用程序将正常运行 2 分钟，然后才会生效。
    *   将 HeapAlloc 更改为 100 - 100% 的堆分配错误几率
    *   将 Stacks 设置为 true - 堆栈将无法变得更大
4.  节省
5.  开始我的申请

2 分钟后，我的程序无法再分配新内存，我可以看到一切是如何处理的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-10T20:44:09.953

根据您的应用程序，限制语言解释器使用的内存可能更容易。例如，使用 Java，您可以设置 JVM 将分配的 RAM 量。

否则，可以使用 windows API 为每个进程设置一次

[SetProcessWorkingSetSize 函数](http://msdn.microsoft.com/en-us/library/ms686234(VS.85).aspx)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-11T20:30:43.227

据我所知，没有办法做到这一点，尽管我很想知道是否有人有一个好的答案。我一直在考虑将这样的东西添加到我公司构建的一个应用程序中，但没有找到好的方法。

我能想到的一件事（虽然不是直接点）是我相信您可以限制 Windows 中 COM+ 应用程序的总内存使用量。当然，这需要编写应用程序以在 COM+ 中运行，但这是我所知道的最接近的方式。

工作集的东西很好（作业对象也控制工作集），但这不是总内存使用量，只是任何时候的实际内存使用量（分页）。它可能适用于您想要的东西，但它不会限制总分配的内存。

# c# - 在 C# 中创建 Outlook .MSG 文件

> ID：192878
> 
> 赞同：9
> 
> 时间：2008-10-10T20:07:59.637
> 
> 标签：c#, outlook

我的任务是从具有关联元数据的 XML 文件中编写 Outlook .MSG 文件。我尝试使用 Aspose 库，但所有公开的 MapiMessage 属性都是只读的。使用 Outlook 对象模型，我无法更改创建日期以及我必须有权访问的其他属性。我也尝试过 Rebex 库，但它导出到 EML，并且不支持 RTF。

我的问题是，是否有 Mapi 或任何类型的方法来编写 .MSG 文件并可以访问每个属性？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-06T11:44:09.723

Aspose now supports creating new msg files. Please check out [http://www.aspose.com/documentation/utility-components/aspose.network-for-.net/creatingsaving-outlook-message-msg-files.html](http://www.aspose.com/documentation/utility-components/aspose.network-for-.net/creatingsaving-outlook-message-msg-files.html) for details.

However, updating existing msg files is not supported currently. If you load an msg file using MapiMessage class, the properties will still be readonly.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-10T20:13:33.120

看看[http://www.dimastr.com/redemption/](http://www.dimastr.com/redemption/) 不肯定，但听起来它可以做你需要的

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-06-09T17:03:29.300

尝试在[Redemption中使用](http://www.dimastr.com/redemption/)[RDOSession](http://www.dimastr.com/redemption/rdosession.htm) .CreateMessageFromMsgFile 。你会得到[RDOMail](http://www.dimastr.com/redemption/RDOMail.htm)对象；您需要做的就是设置所有属性并调用[RDOMail](http://www.dimastr.com/redemption/RDOMail.htm) .Save。

类似的东西

```
 Redemption.RDOSession Session = new RDOSession();
  Redemption.RDOMail Msg = Session.CreateMessageFromMsgFile(@"c:\temp\YourMsgFile.msg");
  Msg.Sent = true;
  Msg.Subject = "test";
  Msg.Body = "test body";
  Msg.Recipients.AddEx("the user", "user@domain.demo", "SMTP", rdoMailRecipientType.olTo);
  Msg.Save(); 
```

# visual-studio-2008 - 如何阻止 Visual Studio 调整控件的大小？

> ID：192885
> 
> 赞同：11
> 
> 时间：2008-10-10T20:12:17.973
> 
> 标签：visual-studio-2008, ide

Visual Studio 2008 SP1（尽管 IIRC，这种行为在 2005 年也存在）不断调整我使用的几个网格控件（准确地说是 Janus.GridEx）的大小。

我可以将它们调整回正常大小，保存并编译就好了。当它编译时，这两个控件将扩展为荒谬的值。

更多信息：此问题与在控件上设置 Anchor 属性有关。如果我将 Anchor 属性设置为相反的两端（例如左和右），则在编译 Designer 文件时，它将控件的宽度/高度设置为容器的宽度/高度。

似乎在 Designer 文件中，Anchor 属性设置在 Size 属性之前。手动编辑（我知道，真丢脸）文件以首先放置 Size 属性并没有帮助，因为当 Designer 文件被编译时，它似乎也是从头开始重写的。

所以我想我真正的问题是如何让 VS 表单设计器尊重我的初始尺寸声明以及 Anchor 属性。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-12-15T18:00:18.787

我有同样的问题。我在表单上的用户控件实例具有这些设置。锚点 - 无 自动调整大小 - 假停靠 - 无

每次我进行构建等时，它仍然可怕地调整它们的大小。

I found that on the user control in the design properties it had autoscalemode set to font. I change it to none and that fixed the problem.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-10T23:57:08.303

我通常通过在调用 InitializeComponent() 之后将“好”代码放入表单构造函数中来解决这种问题，因此它会覆盖自动设计器魔法可能导致的任何混乱。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-10T22:04:56.390

我目前正在做的是处理 Resize 事件并在两个必需的控件上设置 Size。考虑到 Anchor 属性的预期效果，我觉得这有点混乱。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-10T21:37:52.047

通常当我遇到这个问题时，我最终会在控件上使用具有 Dock 和 Padding 属性的面板和标签（空白文本）来获得相同的视觉外观。这对您的表单是否实用取决于它的布局方式。

由于所有额外的控制，这不是最好的解决方案，但它可以完成工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-11T05:14:21.953

也许我误解了这个问题，但我认为您正在寻找的是 Locked 属性：http: [//msdn.microsoft.com/en-us/library/80xxxf69.aspx](http://msdn.microsoft.com/en-us/library/80xxxf69.aspx)

# jquery - .hide()、.show()、表格和 IE

> ID：192888
> 
> 赞同：4
> 
> 时间：2008-10-10T20:14:23.227
> 
> 标签：jquery, internet-explorer

我有一些嵌套表，我想在单击其中一个顶级行时隐藏/显示它们。

简而言之，标记是：

```
  <表格>
    <tr>
      <td>东西</td>
      ....更多tds在这里
    </tr>
    <tr>
      <td colspan=some_number>
        <表格>
        </table>
      </td>
    </tr>
  </table>

```

现在，我正在使用一些 jQuery 来定位第一个表行中的链接。单击该链接时，它会下拉一些数据，将其格式化为一组表格行，并将其附加到内部表格中。然后它将 .show() 应用于表格。（这一切都是通过 id/class 定位完成的。为简洁起见，我将它们排除在示例之外）。

这在 Firefox 中效果很好。单击链接，数据被加载，主表“扩展”，辅助表都很好并填充。

问题是——Internet Explorer 给了我手指。据我所知，数据被附加到内部表中。问题是 .show() 似乎没有做任何有用的事情。为了让事情变得更烦人，我有一个页面，它有这个功能，在这两种情况下都能很好地工作——唯一的区别是两件事：

在正在工作的那个中，内表被包裹在一个 div 中。我什至尝试在这个例子中将我的表格包装在一个 div 中，但没有成功。在那个不工作的地方，我加载了一个额外的 jQuery 插件——但我已经删除了这个插件并尝试了没有它的页面，但它仍然无法显示内部表格。

我尝试将 .show 附加到父 tr、父 td 和表本身，但没有成功。我一定错过了一些非常简单的东西，因为据我所知，这应该可以工作。

有没有人遇到过这样的事情？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-10T20:21:38.783

请记住，<table> 元素的 innerHTML 在 IE 中是*只读的*（肯定是 6，对于 7 不确定）。既然如此，您是否明确添加了 <tbody> 元素？如果没有，请尝试添加一个并将行添加到 body 元素而不是 table 元素。

```
<table>
  <tbody>
    <!-- Add stuff here... -->
  </tbody>
</table> 
```

有关此的 Microsoft 信息（排序）：[PRB：Internet Explorer 中的错误设置 table.innerHTML](http://support.microsoft.com/kb/239832)注意：它说这是“设计使然”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-10T20:18:51.940

IE 中有很多与从 Javascript 修改表格内容相关的错误。在很多情况下，IE（包括IE7）甚至会崩溃。

~~我最近遇到了这个问题，我对我想出的解决方法一无所知。让我回顾一下我的日志，看看我能找到什么。~~

* * *

好的，我找到了我遇到的案例。

我正在做类似的事情。我有一个表，我试图`<td`通过 Javascript 在其中添加一个带有链接的 > 标记，这导致 IE7 中出现内存异常。

最后，我能想出解决它的唯一方法是`<table`在 Javascript 中重建整个 >，而不是尝试将东西插入现有的。

澄清一下，重建我的意思是创建一个包含表格 HTML 的字符串并将其添加到 div 的 innerHTML 中。我没有使用 DOM 函数来创建表。

# sql-server - SQL Server 上大型 EAV/开放架构系统的性能

> ID：192892
> 
> 赞同：10
> 
> 时间：2008-10-10T20:15:38.467
> 
> 标签：sql-server, database, entity-attribute-value

有没有人在 SQL Server 中实现了一个非常大的 EAV 或开放模式样式数据库？我想知道这是否存在性能问题以及您如何克服这些障碍。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-23T21:52:00.670

无论 MS SQL Server 与任何其他品牌的数据库如何，EAV 最糟糕的性能问题是人们试图进行怪物查询以重建单行上的实体。 *这需要每个属性单独连接*。

```
SELECT e.id, a1.attr_value as "cost", a2.attr_value as "color",
  a3.attr_value as "size", . . .
FROM entity e
  LEFT OUTER JOIN attrib a1 ON (e.entity_id = a1.entity_id AND a1.attr_name = 'cost')
  LEFT OUTER JOIN attrib a2 ON (e.entity_id = a2.entity_id AND a2.attr_name = 'color')
  LEFT OUTER JOIN attrib a2 ON (e.entity_id = a3.entity_id AND a3.attr_name = 'size')
  . . . additional joins for each attribute . . . 
```

无论您使用什么数据库品牌，查询中的更多连接都意味着性能成本呈几何级增长。不可避免地，您需要足够的属性来超出任何 SQL 引擎的架构能力。

解决方案是获取行而不是列中的属性，并在应用程序代码中编写一个类来循环这些行，将值一一分配到对象属性中。

```
SELECT e.id, a.attr_name, a.attr_value
FROM entity e JOIN attrib a USING (entity_id)
ORDER BY e.id; 
```

这个 SQL 查询非常简单和高效，它弥补了额外的应用程序代码。

我在 EAV 框架中寻找的是一些样板代码，它检索这样的多行结果集，并将属性映射到对象属性，然后返回填充对象的集合。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-11T19:37:06.860

我不是 EAV 方面的专家，但有几个比我更有经验的开发人员评论说，Magento 的开源电子商务框架很慢，主要是因为通过 MySQL 的 EAV 架构。最明显的缺点是不容易克服的。这就是随着应用程序大小的增加，解决实体和属性值在何处以及如何表示信息的困难。我听到的反对 EAV 的第二个论点是它需要进入低两位数的表连接，但有人评论说使用 InnoDB 而不是 MyISAM 提高了一些性能（或者反之亦然，但我不记得完全）。

# javascript - 等待光标在整个 html 页面上

> ID：192900
> 
> 赞同：93
> 
> 时间：2008-10-10T20:18:47.337
> 
> 标签：javascript, html, css, dynamic-css

是否可以以简单的方式在整个 html 页面上将光标设置为“等待”？这个想法是向用户显示在完成 ajax 调用时正在发生的事情。下面的代码显示了我尝试过的简化版本，还演示了我遇到的问题：

1.  如果一个元素 (#id1) 设置了光标样式，它将忽略 body 上的一组（显然）
2.  某些元素具有默认光标样式 (a)，并且不会在悬停时显示等待光标
3.  body 元素根据内容有一定的高度，如果页面很短，光标将不会显示在页脚下方

考试：

```
<html>
    <head>
        <style type="text/css">
            #id1 {
                background-color: #06f;
                cursor: pointer;
            }

            #id2 {
                background-color: #f60;
            }
        </style>
    </head>
    <body>
        <div id="id1">cursor: pointer</div>
        <div id="id2">no cursor</div>
        <a href="#" onclick="document.body.style.cursor = 'wait'; return false">Do something</a>
    </body>
</html> 
```

后来编辑......
它在Firefox和IE中工作：

```
div#mask { display: none; cursor: wait; z-index: 9999; 
position: absolute; top: 0; left: 0; height: 100%; 
width: 100%; background-color: #fff; opacity: 0; filter: alpha(opacity = 0);}

<a href="#" onclick="document.getElementById('mask').style.display = 'block'; return false">
Do something</a> 
```

此解决方案（或功能）的问题在于，由于 div 重叠，它会阻止点击（感谢 Kibbee）

稍后编辑...
来自 Dorward 的一个更简单的解决方案：

```
.wait, .wait * { cursor: wait !important; } 
```

进而

```
<a href="#" onclick="document.body.className = 'wait'; return false">Do something</a> 
```

此解决方案仅显示等待光标，但允许点击。

* * *

## 回答 #1

> 赞同：113
> 
> 时间：2012-05-29T15:11:16.433

如果您使用从 Dorward 发布的 CSS 的略微修改版本，

```
html.wait, html.wait * { cursor: wait !important; } 
```

然后，您可以添加一些非常简单的[jQuery](http://api.jquery.com/)来处理所有 ajax 调用：

```
$(document).ready(function () {
    $(document).ajaxStart(function () { $("html").addClass("wait"); });
    $(document).ajaxStop(function () { $("html").removeClass("wait"); });
}); 
```

或者，对于较旧的 jQuery 版本（1.9 之前）：

```
$(document).ready(function () {
    $("html").ajaxStart(function () { $(this).addClass("wait"); });
    $("html").ajaxStop(function () { $(this).removeClass("wait"); });
}); 
```

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2008-10-10T20:46:08.467

我知道您可能无法控制这一点，但您可能会选择一个覆盖整个主体的“屏蔽”div，z-index 高于 1。如果您愿意，div 的中心部分可以包含加载消息。

然后，您可以将光标设置为在 div 上等待，而不必担心链接，因为它们位于您的掩蔽 div 的“下方”。这是“屏蔽 div”的一些示例 CSS：

```
身体{身高：100%；}
div#mask { 光标：等待；z指数：999；高度：100%；宽度：100%；}

```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-10T21:02:38.107

这似乎在Firefox中工作

```
<style>
*{ cursor: inherit;}
body{ cursor: wait;}
</style> 
```

* 部分确保当您将鼠标悬停在链接上时光标不会改变。虽然链接仍然可以点击。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2012-07-30T16:05:51.283

今天我已经为这个问题苦苦挣扎了好几个小时。基本上一切都在 FireFox 中运行良好，但（当然）在 IE 中不行。在 IE 中，等待光标显示在执行耗时功能之后。

我终于在这个网站上找到了诀窍：http: [//www.codingforums.com/archive/index.php/t-37185.html](http://www.codingforums.com/archive/index.php/t-37185.html)

代码：

```
//...
document.body.style.cursor = 'wait';
setTimeout(this.SomeLongFunction, 1);

//setTimeout syntax when calling a function with parameters
//setTimeout(function() {MyClass.SomeLongFunction(someParam);}, 1);

//no () after function name this is a function ref not a function call
setTimeout(this.SetDefaultCursor, 1);
...

function SetDefaultCursor() {document.body.style.cursor = 'default';}

function SomeLongFunction(someParam) {...} 
```

我的代码在 JavaScript 类中运行，因此 this 和 MyClass（MyClass 是单例）。

尝试显示本页所述的 div 时，我遇到了同样的问题。在 IE 中，它在函数执行后显示。所以我想这个技巧也可以解决这个问题。

非常感谢这篇文章的作者 glenngv。你真的让我很开心！！！

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-10-19T01:26:19.673

CSS：`.waiting * { cursor: 'wait' }`

jQuery：`$('body').toggleClass('waiting');`

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-07-25T07:08:08.463

我知道的最简单的方法是像这样使用 JQuery：

```
$('*').css('cursor','wait'); 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-10T20:27:13.467

为什么不只使用其中一种精美的加载图形（例如：[http](http://ajaxload.info/) ://ajaxload.info/ ）？等待光标是针对浏览器本身的——所以每当它出现时，它与浏览器有关，而不是与页面有关。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-14T20:28:40.687

试试css：

```
html.waiting {
cursor: wait;
} 
```

似乎如果该属性与它`body`相对使用，`html`它不会在整个页面上显示等待光标。此外，如果您使用 css 类，您可以轻松控制它何时实际显示。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-07-16T05:22:20.330

这是一个不需要外部 CSS 的更精细的解决方案：

```
function changeCursor(elem, cursor, decendents) {
    if (!elem) elem=$('body');

    // remove all classes starting with changeCursor-
    elem.removeClass (function (index, css) {
        return (css.match (/(^|\s)changeCursor-\S+/g) || []).join(' ');
    });

    if (!cursor) return;

    if (typeof decendents==='undefined' || decendents===null) decendents=true;

    let cname;

    if (decendents) {
        cname='changeCursor-Dec-'+cursor;
        if ($('style:contains("'+cname+'")').length < 1) $('<style>').text('.'+cname+' , .'+cname+' * { cursor: '+cursor+' !important; }').appendTo('head');
    } else {
        cname='changeCursor-'+cursor;
        if ($('style:contains("'+cname+'")').length < 1) $('<style>').text('.'+cname+' { cursor: '+cursor+' !important; }').appendTo('head');
    }

    elem.addClass(cname);
} 
```

有了这个你可以做到：

```
changeCursor(, 'wait'); // wait cursor on all decendents of body
changeCursor($('#id'), 'wait', false); // wait cursor on elem with id only
changeCursor(); // remove changed cursor from body 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-10-17T16:00:11.693

我使用了对[Eric Wendelin](https://stackoverflow.com/a/192967/443427)解决方案的改编。它将在整个主体上显示一个透明的动画覆盖等待div，点击将被等待div阻止而可见：

CSS：

```
div#waitMask {
    z-index: 999;
    position: absolute;
    top: 0;
    right: 0;
    height: 100%;
    width: 100%;
    cursor: wait;
    background-color: #000;
    opacity: 0;
    transition-duration: 0.5s;
    -webkit-transition-duration: 0.5s;
} 
```

js：

```
// to show it
$("#waitMask").show();
$("#waitMask").css("opacity"); // must read it first
$("#waitMask").css("opacity", "0.8");

...

// to hide it
$("#waitMask").css("opacity", "0");
setTimeout(function() {
    $("#waitMask").hide();
}, 500) // wait for animation to end 
```

html:

```
<body>
    <div id="waitMask" style="display:none;">&nbsp;</div>
    ... rest of html ... 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2018-02-22T15:32:12.130

我的两便士：

第一步：声明一个数组。这将用于存储分配的原始游标：

```
var vArrOriginalCursors = new Array(2); 
```

第二步：实现函数 cursorModifyEntirePage

```
 function CursorModifyEntirePage(CursorType){
    var elements = document.body.getElementsByTagName('*');
    alert("These are the elements found:" + elements.length);
    let lclCntr = 0;
    vArrOriginalCursors.length = elements.length; 
    for(lclCntr = 0; lclCntr < elements.length; lclCntr++){
        vArrOriginalCursors[lclCntr] = elements[lclCntr].style.cursor;
        elements[lclCntr].style.cursor = CursorType;
    }
} 
```

它的作用：获取页面上的所有元素。将分配给它们的原始游标存储在步骤 1 中声明的数组中。将游标修改为由参数 CursorType 传递的所需游标

第三步：恢复页面上的光标

```
 function CursorRestoreEntirePage(){
    let lclCntr = 0;
    var elements = document.body.getElementsByTagName('*');
    for(lclCntr = 0; lclCntr < elements.length; lclCntr++){
        elements[lclCntr].style.cursor = vArrOriginalCursors[lclCntr];
    }
} 
```

我已经在应用程序中运行了它，它工作正常。唯一需要注意的是，当您动态添加元素时，我没有对其进行测试。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2020-03-10T10:58:22.920

要从 JavaScript 为整个窗口设置光标，请使用：

```
document.documentElement.style.cursor = 'wait'; 
```

来自 CSS：

```
html { cursor: wait; } 
```

根据需要添加更多逻辑。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-09-10T17:11:19.710

BlockUI 是一切的答案。试试看。

[http://www.malsup.com/jquery/block/](http://www.malsup.com/jquery/block/)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-05-22T05:36:25.327

这个纯 JavaScript 似乎工作得很好……在 FireFox、Chrome 和 Edge 浏览器上进行了测试。

如果您的页面上有过多的元素并且计算机速度很慢，我不确定它的性能......试试看。

为所有元素设置光标等待：

```
Object.values(document.querySelectorAll('*')).forEach(element => element.style.cursor = "wait"); 
```

将所有元素的光标设置回默认值：

```
Object.values(document.querySelectorAll('*')).forEach(element => element.style.cursor = "default"); 
```

另一种（也许更具可读性）版本是创建一个 setCursor 函数，如下所示：

```
function setCursor(cursor)
{
    var x = document.querySelectorAll("*");

    for (var i = 0; i < x.length; i++)
    {
        x[i].style.cursor = cursor;
    }
} 
```

然后打电话

```
setCursor("wait"); 
```

和

```
setCursor("default"); 
```

分别设置等待光标和默认光标。

# windows - 管理网络连接的软件

> ID：192902
> 
> 赞同：0
> 
> 时间：2008-10-10T20:20:04.167
> 
> 标签：windows, networking

我需要一个软件来管理我的网络连接，我用我的笔记本去不同的客户端，我必须手动更改我的设置。最好的软件来做到这一点？Windows 和 Mac，我使用带有 Vmware Fusion 的 MacBook。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-13T14:30:37.587

转到系统首选项中的网络选项卡，并为每个不使用默认“自动”配置文件的网络创建一个新的“位置”。这应该对大多数情况有所帮助。对于某些特殊网络，请尝试在相应位置的设置中调整特定设置。

HTH - 至少对于 Mac OS。没有适用于 Windows 的解决方案，尽管 IIRC 有一些适用于公路战士。

# python - XML 解析 - ElementTree vs SAX 和 DOM

> ID：192907
> 
> 赞同：79
> 
> 时间：2008-10-10T20:22:24.553
> 
> 标签：python, xml, dom, sax, elementtree

Python有几种解析XML的方法...

我了解使用**SAX**进行解析的基础知识。它用作流解析器，具有事件驱动的 API。

我也了解**DOM**解析器。它将 XML 读入内存并将其转换为可以使用 Python 访问的对象。

一般来说，根据您需要做什么、内存限制、性能等，在两者之间进行选择很容易。

（希望到目前为止我是正确的。）

从 Python 2.5 开始，我们也有了**ElementTree**。这与 DOM 和 SAX 相比如何？它和哪个更相似？为什么它比以前的解析器更好？

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2008-10-11T16:02:41.003

ElementTree 更易于使用，因为它（基本上）将 XML 树表示为列表结构，而属性则表示为字典。

与 DOM 相比，ElementTree 对 XML 树需要的内存要少得多（因此速度更快），并且解析开销`iterparse`与 SAX 相当。此外，`iterparse`返回部分结构，并且您可以在解析期间通过在处理它们时立即丢弃结构来保持内存使用不变。

与 Python 2.5 一样，ElementTree 与成熟的 XML 库相比只有很小的功能集，但对于许多应用程序来说已经足够了。如果您需要验证解析器或完整的 XPath 支持，lxml 是您的最佳选择。很长一段时间，它曾经很不稳定，但从2.1开始我没有遇到任何问题。

ElementTree 与 DOM 不同，其中节点可以访问其父级和兄弟级。处理实际文档而不是数据存储也有点麻烦，因为文本节点不被视为实际节点。在 XML 片段中

```
<a>This is <b>a</b> test</a> 
```

该字符串`test`将是所谓`tail`的元素`b`。

一般来说，我推荐 ElementTree 作为所有使用 Python 处理 XML 的默认值，并推荐 DOM 或 SAX 作为特定问题的解决方案。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2013-03-16T17:33:15.727

# 最小的 DOM 实现：

[链接](http://docs.python.org/2/library/xml.dom.minidom.html#module-xml.dom.minidom)。

Python 提供了一个完整的、W3C 标准的 XML DOM ( *xml.dom* ) 实现和一个最小的实现，*xml.dom.minidom*。后一个比完整的实现更简单、更小。但是，从“解析的角度”来看，它具有标准 DOM 的所有优点和缺点 - 即它将所有内容加载到内存中。

考虑一个基本的 XML 文件：

```
<?xml version="1.0"?>
<catalog>
    <book isdn="xxx-1">
      <author>A1</author>
      <title>T1</title>
    </book>
    <book isdn="xxx-2">
      <author>A2</author>
      <title>T2</title>
    </book>
</catalog> 
```

*一个可能的使用minidom*的 Python 解析器是：

```
import os
from xml.dom import minidom
from xml.parsers.expat import ExpatError

#-------- Select the XML file: --------#
#Current file name and directory:
curpath = os.path.dirname( os.path.realpath(__file__) )
filename = os.path.join(curpath, "sample.xml")
#print "Filename: %s" % (filename)

#-------- Parse the XML file: --------#
try:
    #Parse the given XML file:
    xmldoc = minidom.parse(filepath)
except ExpatError as e:
    print "[XML] Error (line %d): %d" % (e.lineno, e.code)
    print "[XML] Offset: %d" % (e.offset)
    raise e
except IOError as e:
    print "[IO] I/O Error %d: %s" % (e.errno, e.strerror)
    raise e
else:
    catalog = xmldoc.documentElement
    books = catalog.getElementsByTagName("book")

    for book in books:
        print book.getAttribute('isdn')
        print book.getElementsByTagName('author')[0].firstChild.data
        print book.getElementsByTagName('title')[0].firstChild.data 
```

请注意，*xml.parsers.expat*是 Expat 非验证 XML 解析器 (docs.python.org/2/library/pyexpat.html) 的 Python 接口。

xml.dom包还提供异常类*DOMException*，但 minidom 不*支持**它*！

 **# ElementTree XML API：

[链接](http://docs.python.org/2/library/xml.etree.elementtree.html)。

*ElementTree*比 XML DOM 更易于使用，并且它需要的内存更少。此外，还提供了一个 C 实现（*xml.etree.cElementTree*）。

*一个可能的使用ElementTree*的 Python 解析器是：

```
import os
from xml.etree import cElementTree  # C implementation of xml.etree.ElementTree
from xml.parsers.expat import ExpatError  # XML formatting errors

#-------- Select the XML file: --------#
#Current file name and directory:
curpath = os.path.dirname( os.path.realpath(__file__) )
filename = os.path.join(curpath, "sample.xml")
#print "Filename: %s" % (filename)

#-------- Parse the XML file: --------#
try:
    #Parse the given XML file:
    tree = cElementTree.parse(filename)
except ExpatError as e:
    print "[XML] Error (line %d): %d" % (e.lineno, e.code)
    print "[XML] Offset: %d" % (e.offset)
    raise e
except IOError as e:
    print "[XML] I/O Error %d: %s" % (e.errno, e.strerror)
    raise e
else:
    catalogue = tree.getroot()

    for book in catalogue:
        print book.attrib.get("isdn")
        print book.find('author').text
        print book.find('title').text 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-11T15:24:41.457

ElementTree 有更多的pythonic API。它现在也在标准库中，因此使用它可以减少依赖关系。

我实际上更喜欢[lxml](https://lxml.de/)，因为它有类似 ElementTree 的 API，但也有很好的附加功能并且性能很好。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-10T20:25:05.343

ElementTree 的 parse() 类似于 DOM，而 iterparse() 类似于 SAX。在我看来，ElementTree 比 DOM 和 SAX 更好，因为它提供了更易于使用的 API。

# svn - 在 Subversion 中替换整个目录树的最佳方法是什么？

> ID：192915
> 
> 赞同：11
> 
> 时间：2008-10-10T20:26:05.497
> 
> 标签：svn, replace, directory

在我的 Subversion 项目中，我有几个目录，其中包含我的代码需要的其他开源项目。例如 ffmpeg、freetype、matrixssl 和其他一些。

更新 SVN 以保存这些项目之一的最新版本的最佳方法是什么？

本质上，我将执行以下操作（以 ffmpeg 为例）：

```
1) Rename current ffmpeg folder to ffmpeg.old
2) Download new version of ffmpeg from net
3) Make sure it and my code compile and work fine together
4) Update subversion to now hold the "new" version of ffmpeg
5) Delete ffmpeg.old directory tree 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-10T20:45:36.877

你可以看看 svnbook 谈论[供应商分支](http://svnbook.red-bean.com/en/1.5/svn-book.html#svn.advanced.vendorbr)。这正是你试图完成的

您可以使用**svn_load_dirs.pl**替换您的手动步骤 1-5。svn_load_dirs.pl 还将跟踪新的、移动的或删除的文件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-10T20:36:43.713

我在 CMake 中遇到了同样的情况，我将二进制 win32 版本检查到我们的供应商目录中：

```
branches/
trunk/
vendor/
    cmake/
        cmake-2.6.0/
        cmake-2.6.1/
        cmake-2.6.2/
        ... 
```

然后我使用 svn:externals 来引用我正在使用的 CMake 版本。使测试升级到新版本变得非常容易，而且我使用的 CMake 版本也很清楚。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-10T20:31:18.060

一切都是正确的，除了您不需要步骤 1 和 5 - 如果步骤 3 失败，则使用 svn revert 功能恢复更改。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-10T20:33:16.933

我想你有两个选择。

**一种）**

1.  SVN 删除所有文件。
2.  获取最新信息并使其发挥作用。
3.  SVN 添加所有文件。

专业人士：如果最新版本中不存在额外的文件，将确保不会保留它们。

缺点：可能很耗时。

**二）**

1.  在旧版本上下载并安装新版本。
2.  让它起作用。
3.  SVN 添加任何新文件。

Pro：您可以看到该工具的文件中发生了哪些变化。

缺点：最终可能会变得混乱。根据工具覆盖可能会导致错误。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-11T06:37:36.997

如果某些供应商项目也使用 Subversion，您可以将*svn:externals*属性添加到您的分支/主干的父目录。

查看[SVN 书籍](http://svnbook.red-bean.com/en/1.0/ch07s03.html)以获取更多详细信息。

# java - 在 Java 中生成全局唯一标识符

> ID：192920
> 
> 赞同：13
> 
> 时间：2008-10-10T20:27:59.847
> 
> 标签：java, persistence, uuid, uniqueidentifier

**简介：**我正在开发一个持久化的 Java Web 应用程序，我需要确保我持久化的所有资源都具有全局唯一标识符，以防止重复。

**精美的印刷品：**

1.  我没有使用 RDBMS，所以我没有任何花哨的序列生成器（比如 Oracle 提供的那个）
2.  我希望它很快，最好全部在内存中 - 我宁愿不必打开文件并增加一些值
3.  它需要是线程安全的（我预计一次只有一个 JVM 需要生成 ID）
4.  JVM 实例之间需要保持一致性。如果服务器关闭并启动，ID 生成器不应重新生成它在先前实例化中生成的相同 ID（或者至少机会必须非常非常渺茫 - 我预计会有数百万的预置资源）
5.  我已经看过 EJB 唯一 ID 模式文章中的示例。它们对我不起作用（我宁愿不完全依赖 System.currentTimeMillis() ，因为我们将每毫秒保留多个资源）。
6.  我已经查看了[这个问题](https://stackoverflow.com/questions/41107/how-to-generate-a-random-alpha-numeric-string-in-java)中提出的答案。我对他们的担忧是，随着时间的推移，我获得重复 ID 的可能性有多大？我对使用[java.util.UUID](http://java.sun.com/j2se/1.5.0/docs/api/java/util/UUID.html)作为[UUID](https://en.wikipedia.org/wiki/Universally_unique_identifier)的建议很感兴趣，但同样，重复的机会需要非常小。
7.  我正在使用JDK6

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-10-10T20:32:29.807

很确定UUID“足够好”。有 340,282,366,920,938,463,463,374,607,431,770,000,000 个 UUID 可用。

[http://www.wilybeagle.com/guid_store/guid_explain.htm](http://www.wilybeagle.com/guid_store/guid_explain.htm)

“从这些数字来看，一个人每年被陨石击中的风险估计为 170 亿分之一，这意味着概率约为 0.00000000006 (6 × 10−11)，相当于创造几个一年有几十万亿个UUID，并且有一个重复。也就是说，在接下来的100年每秒产生10亿个UUID之后，只创建一个重复的概率大约是50%。一个重复的概率是如果地球上每个人都拥有 6 亿个 UUID，则大约是 50%”

[http://en.wikipedia.org/wiki/Universally_Unique_Identifier](http://en.wikipedia.org/wiki/Universally_Unique_Identifier)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-10T20:37:21.637

如果它需要每台 PC 都是唯一的：您可能可以使用`(System.currentTimeMillis() << 4) | (staticCounter++ & 15)`或类似的东西。

这将允许您每毫秒生成 16 个。如果您需要更多，请移动 5，然后移动 31...

如果它需要在多台 PC 中是唯一的，您还应该结合主网卡的 MAC 地址。

编辑：澄清

```
private static int staticCounter=0;
private final int nBits=4;
public long getUnique() {
    return (currentTimeMillis() << nBits) | (staticCounter++ & 2^nBits-1);
} 
```

并将 nBits 更改为您应该每毫秒生成的最大数的平方根。

它最终会翻身。可能需要 20 年左右，而 nBits 为 4。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-13T08:25:04.920

```
public class UniqueID {
    private static long startTime = System.currentTimeMillis();
    private static long id;

    public static synchronized String getUniqueID() {
        return "id." + startTime + "." + id++;
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-13T02:24:50.687

从内存中，RMI 远程包包含一个 UUID 生成器。我不知道这是否值得研究。

当我不得不生成它们时，我通常使用当前日期时间、用户名和计算机 IP 地址的 MD5 哈希和。基本上，这个想法是获取有关计算机/人的所有信息，然后生成此信息的 MD5 哈希。

它工作得非常好，而且速度非常快（一旦你第一次初始化 MessageDigest）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-03-16T21:49:47.087

为什么不这样做

```
String id = Long.toString(System.currentTimeMillis()) + 
    (new Random()).nextInt(1000) + 
    (new Random()).nextInt(1000); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-09-30T03:57:40.750

如果您想使用 java UUID 的更短更快的实现，请查看：

[https://code.google.com/p/spf4j/source/browse/trunk/spf4j-core/src/main/java/org/spf4j/concurrent/UIDGenerator.java](https://code.google.com/p/spf4j/source/browse/trunk/spf4j-core/src/main/java/org/spf4j/concurrent/UIDGenerator.java)

请参阅 javadoc 中的实现选择和限制。

这是一个关于如何使用的单元测试：

[https://code.google.com/p/spf4j/source/browse/trunk/spf4j-core/src/test/java/org/spf4j/concurrent/UIDGeneratorTest.java](https://code.google.com/p/spf4j/source/browse/trunk/spf4j-core/src/test/java/org/spf4j/concurrent/UIDGeneratorTest.java)

# database - 展示 SQL Server 数据库结构的最佳软件

> ID：192923
> 
> 赞同：2
> 
> 时间：2008-10-10T20:29:58.017
> 
> 标签：database, sql-server-2005, diagram

我有一个包含大约 140 个表的 MSSQL2005 数据库。我想使用表格结构创建可访问的图表或可打印的 API 类型文档。有没有提供这种数据库可视化的程序？

我发现 SQL Server 中内置的图表对于我的数据库大小来说非常笨重且难以访问。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-10T20:33:39.023

看看[SQL 文档](http://www.red-gate.com/products/SQL_Doc/index.htm)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-10T20:34:00.397

我总是将 Visio 用于此类事情。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-19T02:02:07.573

为此，我喜欢 Toad Data Modeler。它对 Microsoft SQL Server 数据库（以及其他品牌的数据库）进行逆向工程，但更重要的是，您可以开始在工具内进行建模更改，它会生成更改脚本。

如果您使用其他人的工具，请确保您可以往返更改 - 意思是，如果您将所有时间和精力都放在正确的文档上，然后您更改 SQL 中的数据库，您是否可以从数据库而不覆盖您在文档工具中的工作？他们中的大多数人不这样做，但 Toad Data Modeler 会。

（免责声明 - 我为 Quest 工作。不过，在 Quest 购买它之前，我使用了这个程序，并且一直很喜欢它。）

[http://www.quest.com/toad-data-modeler/](http://www.quest.com/toad-data-modeler/)

# sql - 数据库中 2 个字段的 SQL 不同

> ID：192924
> 
> 赞同：85
> 
> 时间：2008-10-10T20:31:12.367
> 
> 标签：sql, distinct

你能得到一个数据库表中 2 个不同字段的不同组合吗？如果是这样，您能否提供 SQL 示例。

* * *

## 回答 #1

> 赞同：130
> 
> 时间：2008-10-10T20:33:58.617

简单地说：

```
select distinct c1, c2 from t 
```

或者

```
select c1, c2, count(*)
from t
group by c1, c2 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-10-10T20:38:56.797

如果您只想从两个字段中获得不同的值，并返回其他字段，那么其他字段必须对它们进行某种聚合（总和、最小值、最大值等），并且您想要区分的两列必须出现在group by 子句。否则，就像德克尔所说的那样。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2013-07-16T03:42:08.643

您可以通过使用以下 SQL 的两列获得不同的结果：

```
SELECT COUNT(*) FROM (SELECT DISTINCT c1, c2 FROM [TableEntity]) TE 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2013-03-12T19:56:36.610

如果您仍然只想按一列分组（如我所愿），您可以嵌套查询：

```
select c1, count(*) from (select distinct c1, c2 from t) group by c1 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2019-03-21T12:50:38.127

分享我的愚蠢想法：

也许我只能在 c1 而不是 c2 上选择 distinct，所以语法可能是`select ([distinct] col)+`where `distinct`is a qualifier for each column。

但想了想，我发现**只有一栏的 distinct 是胡说八道**。取以下关系：

```
 | A | B
__________
  1| 1 | 2
  2| 1 | 1 
```

如果是我们`select (distinct A), B`，那什么是合适`B`的`A = 1`呢？

因此，`distinct`是 a 的限定词`statement`。

# outlook - 如何以编程方式更新 Outlook 联系人姓名解析顺序

> ID：192938
> 
> 赞同：1
> 
> 时间：2008-10-10T20:35:07.867
> 
> 标签：outlook, registry, exchange-server

在 Outlook 2003 中，打开通讯簿，选择工具->选项。您会看到地址对话框，其中显示选项“发送邮件时，请按以下顺序使用这些地址列表检查姓名：”

![地址对话框](https://i.stack.imgur.com/wa79y.jpg)

对于大多数人来说，这将只包含“联系人”。对于企业网络，它可能还包含“全球地址列表”。问题是，在我的公司中，GAL 有数万之多，并且在尝试发送电子邮件时，名称解析中经常会发生冲突，并且它会发送给另一个国家/地区的错误人员。

相反，我想在该列表顶部放置一个单独的 Exchange 地址列表“X”，以便在检查 GAL 之前首先解析我们自己公司中的名称。然后，解决“联系人”，然后是 GAL。此配置需要部署到数百台 PC。

我已经能够在我自己的电脑上通过破解注册表项来做到这一点： `HKCU\Software\Microsoft\Windows NT\CurrentVersion\Windows Messaging Subsystem\Profiles\your_profile_name\9207f3e0a3b11019908b08002b2a56c2`， Value `11023d05`。

这包含一个 REG_BINARY 数据结构，该结构列出了该列表中项目的 ID。我可以根据自己的喜好对它们重新排序，Outlook 接受它。

GAL 和“X”地址列表的 ID 是静态的。但是，问题在于“联系人”ID 显然不是静态的，可能是用户和/或计算机独有的。它的值似乎在注册表中是不可发现的。这使我无法简单地将这个注册表值复制到所有 PC。

有没有人能够以编程方式重新排序联系人姓名解析列表？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-10T20:41:46.417

我过去曾为一家公司做过这件事。这是一个 .NET 应用程序，可在每台 PC 上运行并重新排序此列表。

这是您需要开始的地方：

[http://msdn.microsoft.com/en-us/library/bb820991.aspx](http://msdn.microsoft.com/en-us/library/bb820991.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-27T15:28:11.073

对于那些感兴趣的人，我在我的博客上发布了我在本机 C++ 中创建的 MAPI 工具。享受。

[http://www.explodingcoder.com/cms/content/programmatically-updating-outlooks-address-book-options-with-a-command-line-tool](http://www.explodingcoder.com/cms/content/programmatically-updating-outlooks-address-book-options-with-a-command-line-tool)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-07-19T15:51:08.140

在扩展 MAPI 级别上，您可以使用`IAddrBook.SetSearchPath`（仅限 C++ 或 Delphi）

如果使用 Redemption 是一个选项（它支持几乎所有语言，包括所有 .Net 语言），您可以使用它`RDOSession.AddressBook.SearchPath`来访问或操作地址簿搜索路径顺序 - 请参阅[http://www.dimastr.com/redemption/RDOAddressBookSearchPath。 htm](http://www.dimastr.com/redemption/RDOAddressBookSearchPath.htm)

# c++ - 在 C/C++ 中存储 PCRE 编译的正则表达式

> ID：192940
> 
> 赞同：4
> 
> 时间：2008-10-10T20:35:24.543
> 
> 标签：c++, c, regex, pcre

有没有一种有效的方法将编译的正则表达式（通过 regcomp()、PCRE 编译）存储在二进制文件中，以便稍后我可以从文件中读取并调用 regexec()？

或者只是将已编译的 regex_t 结构转储到文件并在需要时将它们读回的问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-10T20:51:50.360

除非你有一个[超级复杂的正则表达式](http://phi.lho.free.fr/programming/RETutorial.en.html "电子邮件地址")，否则我几乎看不到序列化编译的正则表达式的优势，编译时间不应该那么大。除非您使用的是超紧密的嵌入系统？

无论如何，确实倾倒结构可能是一个解决方案，至少您可以尝试...
[编辑] 我刚刚查看了我拥有的源代码（6.7），正如我所担心的那样，它并不是那么简单，结构以一个 void *... 你不能序列化指针，它们必须重新计算。

# c# - 将asp.net，C＃GridView输出为PDF的好方法是什么

> ID：192942
> 
> 赞同：0
> 
> 时间：2008-10-10T20:36:07.943
> 
> 标签：c#, asp.net, pdf, gridview

我尝试使用 Microsoft ReportingControls，但发现它们过于繁琐，文档太少。我想要一个简单的控件，可以将 GridView 控件转换为 PDF 文档。我已经开始研究 PDFSHArp 并且在文档方面遇到了死胡同。与 iTextSharp 相同。如果他们过去曾为其他人工作过，我愿意进一步研究他们。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-10T20:41:50.177

您可以遍历 gridview 中的数据并使用 iTextSharp 将其写入 PDF 表。看看这里： http: [//www.codeproject.com/KB/cs/iTextSharpPdfTables.aspx](http://www.codeproject.com/KB/cs/iTextSharpPdfTables.aspx)

我还建议[购买 iText In Action](http://www.manning.com/lowagie)一书。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-10T21:13:54.060

如果您只需要创建 PDF 文件，我可以推荐 ceTe DynamicPDF 产品。它有据可查，而且很容易使用。我唯一需要注意的是，您的报告都将在代码中构建。如果您计划添加大量报告，那么您可能想要探索替代方案，例如 Telerik 的新报告工具（将导出为 PDF）。

好吧，请注意两点：如果您只是进行一个 GridView 导出，DynamicPDF 有点贵。

# regex - What's the best way to validate a user-entered URL in a Cocoa application?

> ID：192944
> 
> 赞同：4
> 
> 时间：2008-10-10T20:36:20.377
> 
> 标签：regex, cocoa, validation, url

I am trying to build a homebrew web brower to get more proficient at Cocoa. I need a good way to validate whether the user has entered a valid URL. I have tried some regular expressions but NSString has some interesting quirks and doesn't like some of the back-quoting that most regular expressions I've seen use.

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-10T21:57:35.063

You could start with the [`+ (id)URLWithString:(NSString *)URLString`](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSURL_Class/Reference/Reference.html#//apple_ref/occ/clm/NSURL/URLWithString:) method of [`NSURL`](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSURL_Class/Reference/Reference.html#//apple_ref/occ/clm/NSURL/URLWithString:), which returns `nil` if the string is malformed.

If you need further validation, you can use the `baseURL`, `host`, `parameterString`, `path`, etc methods to give you particular components of the URL, which you can then evaluate in whatever way you see fit.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-10T23:45:07.030

I've found that it is possible to enter some URLs that seem to be OK but are rejected by the NSURL creation methods. So we have a method to escape the string first to make sure it's in a good format. Here is the meat of it:

```
NSString *escapedURLString =
    NSMakeCollectable(CFURLCreateStringByAddingPercentEscapes(NULL,
      (CFStringRef)URLString,
      (CFStringRef)@"%+#",  // Characters to leave unescaped
      NULL,
      kCFStringEncodingUTF8));

```

# iphone - 在 iPhone 上推送像素

> ID：192951
> 
> 赞同：2
> 
> 时间：2008-10-10T20:39:18.373
> 
> 标签：iphone, framebuffer, pixels, demo-effects

在 iPhone 上获取帧缓冲区并在软件中渲染的最快方法是什么？

基本上进入模式 13h 风格的东西，所以我可以制作一些效果？:)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-10T20:52:49.173

您需要以`CGImageContext`可以直接操作的位图格式创建 , 。然后，您可以在屏幕上绘制该图像，将其用作 GL 纹理或其他任何东西。

非常简单的东西 - 查看 Core Graphics 文档。我认为没有获得实际原始`frameBuffer`访问权限的好方法，但无论如何，这可能不是您真正想要的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-10T20:53:30.357

据我所知，您的 iPhone 上有一个 OpenGL|ES 加速器芯片。如果你想推送像素，你应该检查支持哪种 OpenGL|ES。为它编写代码，让硬件完成这项工作。

顺便说一句，编写 OpenGL|ES 并不难。我你仍然知道 mode13 是什么（你是个老屁！）你应该在一小时内掌握基础知识，并且在玩了一个周末之后你已经掌握了 API。

# regex - 针对多个正则表达式有效地查询一个字符串

> ID：192957
> 
> 赞同：51
> 
> 时间：2008-10-10T20:42:16.683
> 
> 标签：regex, algorithm, pcre

假设我有 10,000 个正则表达式和一个字符串，我想找出字符串是否与其中任何一个匹配并获取所有匹配项。最简单的方法是针对所有正则表达式逐一查询字符串。有没有更快、更有效的方法呢？

编辑：我尝试用 DFA (lex) 代替它这里的问题是它只会给你一个单一的模式。如果我有一个字符串“hello”和模式“[H|h]ello”和“.{0,20}ello”，DFA 只会匹配其中一个，但我希望它们都命中。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-10T21:05:00.990

我们必须在我曾经做过的产品上这样做。答案是将所有正则表达式一起编译成[确定性有限状态机](http://en.wikipedia.org/wiki/Deterministic_finite_automaton)（也称为确定性有限自动机或**DFA**）。然后，DFA 可以逐个字符地遍历您的字符串，并在其中一个表达式匹配时触发“匹配”事件。

**优点**是它运行速度快（每个字符只比较一次）并且如果添加更多表达式也不会变慢。

**缺点**是它需要一个*庞大*的自动机数据表，并且有许多类型的正则表达式不受支持（例如，反向引用）。

我们使用的那个是当时我们公司的一个 C++ 模板 nut 手工编码的，所以很遗憾，我没有任何 FOSS 解决方案可以为您指明方向。**但是，如果您使用“ DFA** ”搜索正则表达式或正则表达式，您会发现可以为您指明正确方向的内容。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-10T21:08:46.223

这就是词法分析器的工作方式。

正则表达式被转换为单个非确定性自动机 (NFA)，并可能转换为确定性自动机 (DFA)。

生成的自动机将尝试一次匹配所有正则表达式，并在其中一个上成功。

有很多工具可以在这里为您提供帮助，它们被称为“词法分析器生成器”，并且有适用于大多数语言的解决方案。

你没有说你使用的是哪种语言。对于 C 程序员，我建议看看[re2c](http://re2c.sf.net)工具。当然，传统的[(f)lex](http://en.wikipedia.org/wiki/Flex_lexical_analyser)始终是一种选择。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-13T12:35:48.830

我过去遇到过类似的问题。我使用了类似于[akdom 建议](https://stackoverflow.com/questions/192957/efficiently-querying-one-string-against-multiple-regexes#193000)的解决方案。

我很幸运，因为我的正则表达式通常有一些子字符串必须出现在它匹配的每个字符串中。我能够使用简单的解析器提取这些子字符串，并使用 Aho-Corasick 算法在 FSA 中对它们进行索引。然后使用该索引快速消除所有与给定字符串不匹配的正则表达式，只留下几个正则表达式进行检查。

我将 LGPL 下的代码作为 Python/C 模块发布。请参阅[Google 代码托管上的 esmre](http://code.google.com/p/esmre/)。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-08-28T11:21:44.863

[Martin Sulzmann](http://sulzmann.blogspot.com/)在这个领域做了很多工作。他在[这里](http://sulzmann.blogspot.com/2008/12/equality-containment-and-intersection.html)简要解释[了一个 HackageDB 项目](http://hackage.haskell.org/cgi-bin/hackage-scripts/package/regexpr-symbolic)，该项目使用[偏导数](http://sulzmann.blogspot.com/2008/11/playing-with-regular-expressions.html)似乎是为此量身定制的。

使用的语言是 Haskell，因此如果需要的话，将很难翻译成非功能性语言（我认为翻译成许多其他 FP 语言仍然非常困难）。

该代码不是基于转换为一系列自动机然后组合它们，而是基于对正则表达式本身的符号操作。

此外，该代码非常具有实验性，Martin 不再是教授，而是从事“有酬工作”(1)，因此可能不感兴趣/无法提供任何帮助或输入。

* * *

1.  这是个笑话——我喜欢教授，聪明的人越少努力工作，我获得报酬的机会就越大！

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-10T21:00:59.170

10,000 正则表达式是吗？ [Eric Wendelin 的](https://stackoverflow.com/questions/192957/efficiently-querying-one-string-against-multiple-regexes#192975)层次结构建议似乎是个好主意。你有没有想过将这些正则表达式的庞大减少为类似于树结构的东西？

举个简单的例子：所有需要一个数字的正则表达式都可以从一个正则表达式分支出来，所有的正则表达式都不需要另一个分支。以这种方式，您可以将实际比较的数量减少到沿树的路径，而不是在 10,000 中进行每个比较。

这将需要将提供的正则表达式分解为流派，每个流派都有一个共享测试，如果失败则将它们排除在外。通过这种方式，理论上您可以显着减少实际比较的次数。

如果您必须在运行时执行此操作，您可以解析给定的正则表达式并将它们“归档”为预定义的流派（最容易做到）或当时生成的比较流派（不太容易做到）。

此解决方案不会真正帮助您将“hello”与“[H|h]ello”和“.{0,20}ello”进行比较的示例。一个可能有用的简单情况是：如果您有 1000 个测试，只有在字符串中某处存在“ello”并且您的测试字符串是“goodbye”时才会返回 true；您只需要对“ello”进行一次测试，并且知道需要它的 1000 次测试将不起作用，因此，您不必进行这些测试。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-10-10T20:49:13.173

您需要有某种方法来确定给定的正则表达式与另一个正则表达式相比是否“附加”。创建各种正则表达式“层次结构”，允许您确定某个分支的所有正则表达式都不匹配

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-10-13T12:56:08.430

如果您正在考虑“10,000 个正则表达式”，您需要改变您的流程。如果不出意外，请考虑“要匹配的 10,000 个目标字符串”。然后寻找为处理“大量目标字符串”情况而构建的非正则表达式方法，例如 Aho-Corasick 机器。不过，坦率地说，在使用哪台机器之前，似乎在这个过程中出现了一些问题，因为 10,000 个目标字符串听起来更像是数据库查找，而不是字符串匹配。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-10-10T20:58:18.133

您可以将它们组合成大约 20 个一组。

```
(?=(regex1)?)(?=(regex2)?)(?=(regex3)?)...(?=(regex20)?) 
```

只要每个正则表达式都有零个（或至少相同数量的）捕获组，您就可以查看捕获的内容以查看哪些模式匹配。

如果 regex1 匹配，则捕获组 1 将具有匹配的文本。如果没有，那就是`undefined`/// ...`None``null`

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2017-11-16T00:17:33.807

**Aho-Corasick**是我的答案。

我有 2000 个类别的事物，每个类别都有要匹配的模式列表。字符串长度平均约为 100,000 个字符。

**主要警告：** 要匹配的模式都是语言模式，而不是正则表达式模式，例如`'cat'`vs `r'\w+'`。

我使用的是**python**，所以使用了[https://pypi.python.org/pypi/pyahocorasick/](https://pypi.python.org/pypi/pyahocorasick/)。

```
import ahocorasick
A = ahocorasick.Automaton()

patterns = [
  [['cat','dog'],'mammals'],
  [['bass','tuna','trout'],'fish'],
  [['toad','crocodile'],'amphibians'],
]

for row in patterns:
    vals = row[0]
    for val in vals:
        A.add_word(val, (row[1], val))

A.make_automaton()

_string = 'tom loves lions tigers cats and bass'

def test():
  vals = []
  for item in A.iter(_string):
      vals.append(item)
  return vals 
```

在我的 2000 个类别上运行`%timeit test()`，每个类别大约有 2-3 条轨迹，`_string`长度约为`100,000`让我`2.09 ms`比`631 ms`连续`re.search()` **315 倍快！**.

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-10-10T21:09:24.413

如果您使用的是真正的正则表达式（与形式语言理论中的正则语言相对应的表达式，而不是一些类似 Perl 的非正则表达式），那么您很幸运，因为正则语言在联合下是封闭的。在大多数正则表达式语言中，管道 (|) 是联合。所以你应该能够构造一个字符串（代表你想要的正则表达式），如下所示：

```
(r1)|(r2)|(r3)|...|(r10000) 
```

其中括号用于分组，而不是匹配。与此正则表达式匹配的任何内容都至少与您的原始正则表达式之一匹配。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-10-10T21:13:45.713

我会说这是一个真正的解析器的工作。中点可能是[Parsing Expression Grammar (PEG)](http://en.wikipedia.org/wiki/Parsing_expression_grammar)。它是模式匹配的高级抽象，一个特点是您可以定义整个语法而不是单个模式。有一些高性能实现通过将语法编译成字节码并在专门的 VM 中运行来工作。

免责声明：我唯一知道的是[LPEG](http://www.inf.puc-rio.br/~roberto/lpeg/lpeg.html)，一个[Lua](http://www.lua.org)库，并且（对我来说）掌握基本概念并不容易。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2019-09-02T15:34:27.287

如果您只需要知道哪些正则表达式匹配，我建议您使用 Intel 的 Hyperscan。它是为此目的而建造的。如果您需要采取的行动更复杂，您也可以使用 ragel。虽然它产生一个单一的 DFA 并可能导致许多状态，因此是一个非常大的可执行程序。Hyperscan 采用混合 NFA/DFA/自定义方法进行匹配，可以很好地处理大量表达式。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-10T20:55:24.160

我几乎建议编写一个“由内而外”的正则表达式引擎——“目标”是正则表达式，“术语”是字符串。

但是，您迭代尝试每一个的解决方案似乎要容易得多。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-11T04:04:31.750

您可以将正则表达式编译成混合 DFA/ [Bucchi 自动机](http://en.wikipedia.org/wiki/B%C3%BCchi_automaton)，其中每次 BA 进入接受状态时，您都会标记哪个正则表达式规则“命中”。

Bucchi 对此有点矫枉过正，但修改 DFA 的工作方式可以解决问题。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-10T20:48:29.120

尝试将它们组合成一个大的正则表达式？

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-10T21:03:53.097

我认为简短的回答是，是的，有一种方法可以做到这一点，并且它是计算机科学所熟知的，我不记得它是什么。

简短的回答是，您可能会发现您的正则表达式解释器在 |'d 一起时已经有效地处理了所有这些，或者您可能会找到一个这样做的。如果没有，是时候谷歌搜索字符串匹配和搜索算法了。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2018-03-19T08:30:18.847

我将[Ragel](http://complang.org/ragel/)与离开动作一起使用：

```
action hello {...}
action ello {...}
action ello2 {...}
main := /[Hh]ello/  % hello |
        /.+ello/ % ello |
        any{0,20} "ello"  % ello2 ; 
```

字符串“hello”将调用块中的代码`action hello`，然后是`action ello`块中的代码，最后是`action ello2`块中的代码。

他们的正则表达式非常有限，而是首选机器语言，您示例中的大括号仅适用于更通用的语言。

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2009-09-01T09:00:53.227

最快的方法似乎是这样的（代码是 C#）：

```
public static List<Regex> FindAllMatches(string s, List<Regex> regexes)
{
    List<Regex> matches = new List<Regex>();
    foreach (Regex r in regexes)
    {
        if (r.IsMatch(string))
        {
            matches.Add(r);
        }
    }
    return matches;
} 
```

哦，你的意思是最快的*代码*？那时我不知道......

# delphi - 启用 MultiSelect 的 TListBox 拖放问题

> ID：192960
> 
> 赞同：2
> 
> 时间：2008-10-10T20:44:05.603
> 
> 标签：delphi, drag-and-drop, vcl

我有一个带有多选和 ExtendedSelect 的 TListBox 都设置为 true。我需要能够拖动列表框中的多个项目来重新排列它们。我的问题是当用户单击已选择的项目而不按住 CTRL 或 SHIFT 键时会发生什么。

案例一：DragMode 设置为 dmManual 在鼠标按下之前清除选择。这将不允许拖动多个项目。

情况 2：DragMode 设置为 dmAutomatic MouseDown 事件从不触发。选择未清除，因此可以拖动，但用户无法通过单击所选项目之一来清除选择。如果选择了所有项目或者用户想要选择的下一个项目是当前选择的一部分，这确实会导致问题。

请注意，仅当您在 OnStartDrag 过程中为 DragObject 分配某些内容时，才会出现此问题。我认为如果 OnStartDrag 仅在用户移动鼠标后启动，问题就会消失。我设置了 Mouse.DragImmediate := false ，但是只要单击列表框中的某个项目，我仍然会触发 StartDrag。

我在这个项目中使用了 Delphi 7，但我在 Delphi 2007 中看到了相同的行为。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-11T19:10:07.880

我已经玩了一段时间了。并观察同样的效果。

我会使用 Case2 并在列表中添加一个（全选/取消全选）按钮。它甚至增加了额外的功能并解决了问题中最烦人的部分。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T15:20:35.983

我不确定为什么这会有所不同，但如果我将 DragObject 更改为 TDrag **Control** ObjectEx（而不是 TDragObjectEx），我会得到我正在寻找的行为。拖动模式设置为自动。

我试图看看这会影响什么，但我无法弄清楚。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-28T00:55:44.820

用例 2 和 TListBox.OnMouseUp 事件触发时检查是否选择并拖动了多个项目。如果选择了多个项目，但未拖动，则取消选择除单击项目之外的所有项目。

我会使用这种方法，因为 Windows 资源管理器就是这样工作的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-22T16:27:23.103

有点杂乱无章，但这行得通。ListBox 上的 DragMode 设置为 dmAutomatic。

```
procedure TForm1.ListBox1DragDrop(Sender, Source: TObject; X, Y: Integer);
var
  iDropIdx, i: Integer;
  pDropPoint: TPoint;
  slSelected: TStrings;
begin
  {Which item is being dropped onto?}
  pDropPoint := Point(X, Y);
  iDropIdx := ListBox1.ItemAtPos(pDropPoint, False);

  slSelected := TStringList.Create;
  try
    {Copy the selected items to another string list}
    for i := 0 to Pred(ListBox1.Items.Count) do
    begin
      if (ListBox1.Selected[i]) then
        slSelected.Append(ListBox1.Items[i]);
    end;

    {Find the selected items in the listbox and swap them with the drop target}
    for i := 0 to Pred(slSelected.Count) do
    begin
      ListBox1.Items.Exchange(ListBox1.Items.IndexOf(slSelected[i]), iDropIdx);
      inc(iDropIdx);
    end;
  finally
    slSelected.Free;
  end;
end; 
```

# google-maps - 如何在 KML 中简化（减少点数）？

> ID：192976
> 
> 赞同：11
> 
> 时间：2008-10-10T20:49:53.280
> 
> 标签：google-maps, maps, kml

我有与[这篇文章](https://stackoverflow.com/questions/174535/google-maps-overlays)类似的问题。我需要在嵌入式 Google 地图上显示多达 1000 个多边形。多边形位于 SQL 数据库中，我可以使用自定义 HttpHandler（在 ASP.NET 中）即时将每个多边形渲染为单个 KML 文件，例如[http://alpha.foresttransparency.org/concession.1.kml](http://alpha.foresttransparency.org/concession.1.kml) .

即使在我的（非常快的）开发机器上，加载甚至几十个形状也需要一段时间。所以两个问题，真的：

1.  一旦我超出某个缩放级别，将这些渲染为标记而不是叠加层的好策略是什么？

2.  是否有公开可用的算法来简化多边形（减少点数），这样我就不会显示比在某个缩放级别有意义的点更多的点？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-10T21:02:55.143

对于您的第二个问题：您需要[Douglas-Peucker 泛化算法](http://everything2.com/index.pl?node_id=859282)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-10T21:31:19.970

对于您的第一个问题，您能否计算特定多边形的面积，并将每个缩放级别与特定的最小区域相关联，以便您放大或缩小多边形的消失和标记根据缩放级别出现。

对于第二个问题，我会使用 Mark Bessey 的建议。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-10T21:00:56.613

我对 KML 了解不多，但我认为问题 #2 的通常解决方案涉及迭代点，并删除特定大小下的任何线段。这在某些情况下会导致一些“不幸”的影响，但它相对快速且容易做到。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-10T21:01:28.407

我会推荐两件事： - 计算和组合接触的多边形。这涉及大量的处理和复杂的数学运算，但我已经做到了，所以我知道这是可能的。- 创建您自己的叠加层，而不是使用 PNG 格式的 KML，同时在前面的建议中组合它们。您必须创建很多 PNG，但它在客户端上的速度非常快。

祝你好运 ：）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-23T06:55:56.640

不久前，我需要解决您的 #2 问题，在查看了一些可用的行简化算法之后，我创建了自己的解决方案。

这个过程很简单，看起来效果很好，但如果你没有正确实现它可能会有点慢：

**`P[0..n]`**是你的点数组让我们**`T[n]`**定义为由点形成的三角形是你试图减少这条线的点数。**`P[n-1], P[n], P[n+1]`** **`Max`**

1.  计算集合中每个可能的三角形的面积`T[1..n-1]`。
2.  `T[i]`选择面积最小的三角形
3.  删除该点`P[i]`以使三角形基本变平
4.  重新计算受影响三角形的面积`T[n-1], T[n+1]`
5.  如果点数 > 则转到步骤 #2`Max`

# php - 使用 Javascript 执行进程并将更新/回调发送到网络服务器

> ID：192978
> 
> 赞同：0
> 
> 时间：2008-10-10T20:50:44.903
> 
> 标签：php, javascript, pdf, queuing

我正在制定一个流程，允许人们通过基于 Web 的界面上传 PDF 文件并管理文档（页面顺序）。

PDF 文件的页面需要裁剪为特定大小以进行打印，目前我们通过处理此问题的 Photoshop 操作来运行它们。

我想要做的是将 PDF 文件上传到专用服务器以执行所需的过程（photoshop 操作、转换、将图像发送回 Web 服务器）。

有什么好的方法来执行这些功能，但是向网络服务器发送更新以允许进程跟踪/进度条让用户了解他们的文件需要多长时间来处理。

此外，一般来说，排队/跟踪作业/流程有哪些好的技术（重点是基于 Web 的技术）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T17:12:59.723

Derek，我相信你有你使用 Photoshop 的理由，但是说真的，Imagemagick 的渲染对你来说不够吗？我曾经使用传真实用程序将 Fax.g3 文件转换为 TIFF，然后使用 Imagemagick 将对比度和亮度提高了 15% 并将其转换回 PDF。IM 作为调用调用的独立 Linux 程序工作`system()`，我知道有新的 Imagemagick PECL 扩展。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T18:09:20.840

创建一个队列，并将作业推送到该队列。运行一个 cronjob 或守护程序，从队列中获取作业并处理它们。确保您使用某种锁定，以便您可以安全地停止/启动守护程序/作业。

如果您希望这项工作能够快速完成，您可以使用一种称为“彗星”的技术。基本上，您建立了从 javascript（使用 XmlHttpRequest）到服务器端脚本的连接。在此脚本中，您检查作业是否已完成。如果没有，你就睡一两秒钟——然后再检查一次。你一直这样做，直到工作完成。然后你给一个回应。结果是请求需要一段时间才能完成，但会立即返回。然后，您可以在 javascript 中采取适当的操作（重新加载页面或其他）。

# c# - 锅炉板代码替换 - 这个代码有什么不好的吗？

> ID：192980
> 
> 赞同：18
> 
> 时间：2008-10-10T20:51:50.483
> 
> 标签：c#, coding-style

我最近创建了这两个（不相关的）方法来替换我的 winforms 应用程序中的大量样板代码。据我所知，它们工作正常，但我需要一些关于是否存在我可能遗漏的问题的保证/建议。

（从记忆里）

```
static class SafeInvoker
{
    //Utility to avoid boiler-plate InvokeRequired code
    //Usage: SafeInvoker.Invoke(myCtrl, () => myCtrl.Enabled = false);
    public static void Invoke(Control ctrl, Action cmd)
    {
        if (ctrl.InvokeRequired)
            ctrl.BeginInvoke(new MethodInvoker(cmd));
        else
            cmd();
    }

    //Replaces OnMyEventRaised boiler-plate code
    //Usage: SafeInvoker.RaiseEvent(this, MyEventRaised)
    public static void RaiseEvent(object sender, EventHandler evnt)
    {
        var handler = evnt;
        if (handler != null)
            handler(sender, EventArgs.Empty);
    }
} 
```

编辑：[在此处查看相关问题](https://stackoverflow.com/questions/258409/how-to-get-information-about-an-exception-raised-by-the-target-of-controlinvoke)

**更新**

继死锁问题（与[此问题](https://stackoverflow.com/questions/2055960/control-invoke-getting-stuck-in-hidden-showdialog)相关）之后，我已从 Invoke 切换到 BeginInvoke（请参阅[此处](https://stackoverflow.com/questions/229554/whats-the-difference-between-invoke-and-begininvoke/229558#229558)的解释）。

**另一个更新**

关于第二个片段，我越来越倾向于使用“空委托”模式，它通过直接使用空处理程序声明事件来“从源头”解决这个问题，如下所示：

```
event EventHandler MyEventRaised = delegate {}; 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-10T21:12:14.687

这是好东西。使它们成为扩展方法以进一步清理您的代码。例如：

```
//Replaces OnMyEventRaised boiler-plate code
//Usage: SafeInvoker.RaiseEvent(this, MyEventRaised)
public static void Raise(this EventHandler eventToRaise, object sender)
{
            EventHandler eventHandler = eventToRaise;

            if (eventHandler != null)
                eventHandler(sender, EventArgs.Empty);
} 
```

现在在您的事件中，您可以调用： myEvent.Raise(this);

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-01-13T14:37:28.803

由于 Benjol 不知道，为什么他将 Action 放入 MethodInvoker 和 broccliman 打算将其用作扩展函数，这里是清理代码：

```
static class SafeInvoker
{
    //Utility to avoid boiler-plate InvokeRequired code
    //Usage: myCtrl.SafeInvoke(() => myCtrl.Enabled = false);
    public static void SafeInvoke(this Control ctrl, Action cmd)
    {
        if (ctrl.InvokeRequired)
            ctrl.BeginInvoke(cmd);
        else
            cmd();
    }

    //Replaces OnMyEventRaised boiler-plate code
    //Usage: this.RaiseEvent(myEventRaised);
    public static void RaiseEvent(this object sender, EventHandler evnt)
    {
        if (evnt != null)
            evnt(sender, EventArgs.Empty);
    }
} 
```

最后一点：`MethodInvoker`两者`Action`都只是具有完全相同结构的代表。由于这种情况，两者都可以相互替换。这种命名冲突的根源来自遗留问题。一开始（.Net 2.0）只有`MethodInvoker`and `Action(T)`。但由于这样一个事实，每个曾经`Action(T)`希望拥有 a 的人都`Action`觉得拿 . 很不自然`MethodInvoker`。因此，在 .Net 3.5 中`Action`，`Action(T1, T2, T3, T4)`也添加了所有`Func`代表，但 MethodInvoker 无法在不进行任何重大更改的情况下被删除。

### 额外的：

如果您能够使用 .Net 3.5，则上述代码很好，但如果您被固定到 .Net 2.0，则可以像以前一样将其用作正常功能并替换`Action`为`MethodInvoker`.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-10T21:04:12.083

类似的模式对我有用，没有任何问题。不过，我不确定您为什么将 Action 包装在 MethodInvoker 中。

# java - 在 TableCellRenderer 中设置选项卡大小

> ID：192985
> 
> 赞同：3
> 
> 时间：2008-10-10T20:54:57.607
> 
> 标签：java, swing, text

我有一个扩展类`DefaultTableCellRenderer`，它以等宽字体呈现字符串，具有特定的颜色。默认情况下，似乎根本不呈现选项卡（0 个空格）。如何设置选项卡大小和/或使它们被呈现？

**编辑：** “制表符”是指制表符，我只想将其呈现为一定数量的空格。重写字符串是一种选择，但我认为有更好的方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-10T23:00:00.007

[`DefaultTableCellRenderer`](http://docs.oracle.com/javase/6/docs/api/javax/swing/table/DefaultTableCellRenderer.html)是 a[`JLabel`](http://docs.oracle.com/javase/6/docs/api/javax/swing/JLabel.html)并且做 a`JLabel`会做的事情。我建议你给自己定一个习惯[`TableCellRenderer`](http://docs.oracle.com/javase/6/docs/api/javax/swing/table/TableCellRenderer.html)，并返回一个适当布局的`JPanel`两个或多个s 。`JLabel`或者，使用[`JComponent`](http://docs.oracle.com/javase/6/docs/api/javax/swing/JComponent.html)覆盖[`paintComponent`](http://docs.oracle.com/javase/6/docs/api/javax/swing/JComponent.html#paintComponent%28java.awt.Graphics%29)以根据需要进行绘制。

注意：尝试在渲染器中使用 HTML 在性能方面是一个非常糟糕的主意。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-10T21:15:40.407

半生不熟的答案：用空格字符替换它们，你需要的数量（如果使用的不仅仅是行缩进，则需要一些计算）。

# macos - QuickTime 视频编解码器配置

> ID：192986
> 
> 赞同：2
> 
> 时间：2008-10-10T20:55:09.340
> 
> 标签：macos, quicktime, codec, avi

所以我正在将一个应用程序从 Windows 移植到 Mac，该应用程序的一部分处理创建电影文件。在 Windows 上，有一组函数，如 ICOpen 和 ICConfigure，它们表示视频压缩驱动程序为选定的编解码器打开一个配置框。Mac上的QuickTime有类似的东西吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-12T14:57:38.680

为此，您需要直接使用 Quicktime-C 调用，但您需要的函数称为 MovieExportDoUserDialog。

有关详细信息，请参阅 CocoaDev 上的[QTMovieExportSettings](http://www.cocoadev.com/index.pl?QTMovieExportSettings)文章。

# hex - 二进制数据库对齐或打包

> ID：192993
> 
> 赞同：0
> 
> 时间：2008-10-10T20:58:02.780
> 
> 标签：hex, alignment

有没有办法通过十六进制编辑器或其他方式查看二进制文件中的数据是否对齐或打包，特别是对于 HPUX 系统？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-11T04:11:26.650

如果您知道要查找的内容并且可以在十六进制转储中识别它，那么您可以对数据是否对齐或打包做出明智的估计。但在很多方面，你的问题是无法回答的。数据从何而来？为什么你不能问这个人（大概是驱动程序）它是如何创建的？

如果您问“我可以使用哪些工具来查看数据”，那么您可以考虑：

*   od（八进制转储 - 也可能带有 -c 选项）
*   hd（十六进制转储 - 并不总是可用，并且在 HP-UX 上似乎不存在）
*   sed l （这是一个小写的 ell - 这意味着列出数据；除非大部分数据是纯文本，否则这不是一个好的选择）

或者你可以用 Perl 来做。很久以前（1987 年左右），我写了一个程序 odx（十六进制的八进制转储 - 很奇怪），我继续使用它 - 它给了我一个十六进制转储，每行 16 个字节，加上可打印字符的图像. 这个例子不是很令人兴奋（odx 自己运行 - 在 Sun Sparc 上）：

```
Black JL: odx odx | sed 10q
0x0000: 7F 45 4C 46 01 02 01 00 00 00 00 00 00 00 00 00   .ELF............
0x0010: 00 02 00 12 00 00 00 01 00 01 0D 84 00 00 00 34   ...............4
0x0020: 00 00 77 9C 00 00 01 00 00 34 00 20 00 05 00 28   ..w......4\. ...(
0x0030: 00 24 00 23 00 00 00 06 00 00 00 34 00 01 00 34   .$.#.......4...4
0x0040: 00 00 00 00 00 00 00 A0 00 00 00 A0 00 00 00 05   ................
0x0050: 00 00 00 00 00 00 00 03 00 00 00 D4 00 00 00 00   ................
0x0060: 00 00 00 00 00 00 00 11 00 00 00 00 00 00 00 04   ................
0x0070: 00 00 00 00 00 00 00 01 00 00 00 00 00 01 00 00   ................
0x0080: 00 00 00 00 00 00 22 86 00 00 22 86 00 00 00 05   ......"...".....
0x0090: 00 01 00 00 00 00 00 01 00 00 22 88 00 02 22 88   .........."...".
Black JL: 
```

# vb.net - .NET webservice 使用参数类型的实例？

> ID：192997
> 
> 赞同：2
> 
> 时间：2008-10-10T20:59:31.327
> 
> 标签：vb.net, web-services, types, proxy-classes

我的解决方案中有一个 Windows 窗体项目和一个 Web 服务项目，我正在尝试调用 Web 服务并返回一个客户对象作为结果。问题是当我尝试接收返回对象时，我收到一个无法转换它的错误。例如，这是我的网络服务的签名：

```
Public Function GetDriverByID(ByVal DriverID As Integer) As Driver 
```

这是我用来调用它的代码：

```
 Dim d As Driver = mywebserviceinstance.GetDriverByID(1) 
```

但我收到此编译时错误（wsDrivers 是我添加到表单项目中的 Web 引用的名称）：“ProjectNamespace.Common.wsDrivers.Driver 类型的值无法转换为 ProjectNamespace.Common.Driver”

这个“Common”命名空间包含 Driver 类，我不确定为什么来自 Web 服务的返回类不仅仅是一个通用的“Driver”，而是一个“wsDrivers.Driver”，我无法转换回来了。有人知道我该如何处理这种类型不匹配吗？

编辑：感谢您的解释 - 这实际上清楚地说明了它在做什么。但是，有什么方法可以强制它使用实际类型而不是代理（或者，有什么方法可以在“真实”实例和“代理”实例之间进行转换），还是我必须在我通过网络发送它们之前序列化属性，然后手动反序列化返回值？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-10T21:08:17.660

这实际上很常见。发生的事情是 Web 服务已经在其中定义了 Web 服务中使用的所有类型的定义。当您添加对该 Web 服务的引用时，它会在您的命名空间的子命名空间中自动生成一个代理类型。这就是您调用 Web 服务时返回的内容。

但是，您可能还引用了 Web 服务单独执行的包含相同类型的相同库。这是您在调暗驱动程序时所期望的类型。这就是为什么存在不匹配的原因。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-10T21:06:09.847

VB.NET 或 C# 项目中的 Web 服务引用可以引用*任何*类型的 Web 服务，并且不限于 ASP.NET 提供的那些。这就是 Visual Studio 为每个可以从 Web 服务检索的对象创建代理类的原因。

# sharepoint - SharePoint 网站定义未显示在模板列表中 - 为什么？

> ID：192998
> 
> 赞同：2
> 
> 时间：2008-10-10T21:00:44.133
> 
> 标签：sharepoint, stsadm, solution-deployment

我有一些通过 SharePoint wsp 解决方案包部署的自定义 SharePoint 网站定义。他们似乎工作正常。我可以通过 stsadm 命令行很好地部署它们，并且我在某些功能中运行的 C# 代码也可以基于它们部署站点。部署我的解决方案后，我的文件似乎已正确放置在文件夹中`webtemp.*.xml`。`12\1033\XML`我的问题是，当我尝试`Create Site Collection.` 为什么不显示时，它们只是没有出现在中央管理应用程序中？我什至不知道在哪里寻找这个。

* * *

**编辑：**

嗯.. 大约一个小时后，我碰巧回到了创建网站集页面，我的模板就在那里。我不确定发生了什么...奇怪的缓存某处或某事。

我还应该更清楚的是，这些解决方案包已经在我的开发箱上成功部署了很多次，所以我没想到在其他服务器上会出现问题（无论如何都是部署方面）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-02T18:57:59.743

SharePoint 中的许多任务都经过排队，然后通过计时器作业执行。IISReset 会导致 Web 应用程序重新加载到内存中，并重新加载配置信息，例如 web.config。

要给 SharePoint 一个“轻推”并导致作业执行，您可以尝试：

```
stsadm -o execadmsvcjobs 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-10T21:08:14.260

您是否启用了发布功能？我读到内容类型不能保存在模板中，因此它们不允许将发布站点制作成模板。这可能与为什么他们不会向您展示您已经制作的内容有关。

尽管我无权访问中央管理员进行验证，但在我的网站集中就是这种情况。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-11T09:47:47.563

你忘了运行 iisreset 吗？这是 SharePoint 重新加载网站模板所必需的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-03-14T21:53:15.423

如果您使用记录中心作为根网站的模板，则在创建新列表时模板库中的模板（.stp 文件）将不会显示。

有一些奇怪的错误导致这种情况发生。

以下是您可以尝试在 SharePoint PowerShell 中运行的代码。GetCustomListTemplates($web).Count 的返回值将为零，如果您有从记录中心模板制作的根网站。

```
$site = get-spsite("http://localhost")
$web = $site.RootWeb
$list = $web.Lists["TestDocLibrary"]
$list.SaveAsTemplate("MyListTemplate.stp", "MyListTemplate", "My List Template", $false)
$site.GetCustomListTemplates($web).Count 
```

更多信息可以在以下链接中找到：

*   [http://social.msdn.microsoft.com/Forums/ar/sharepoint2010general/thread/c5455a27-360a-465c-91d5-f81beeac6789](http://social.msdn.microsoft.com/Forums/ar/sharepoint2010general/thread/c5455a27-360a-465c-91d5-f81beeac6789)
*   [http://sharepointrecordsmanagement.com/2011/02/](http://sharepointrecordsmanagement.com/2011/02/)********