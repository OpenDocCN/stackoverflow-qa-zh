# StackOverflow 问答 000136000-000136999

# javascript - 彗星和 jQuery

> ID：136012
> 
> 赞同：114
> 
> 时间：2008-09-25T20:53:48.707
> 
> 标签：javascript, jquery, design-patterns, comet, server-push

我已经对使用 javascript 的服务器推送进行了一些研究，并发现普遍的共识是我正在寻找的是“彗星”设计模式。在 jQuery 之上构建的这种模式有什么好的实现吗？如果没有，这种模式有什么好的实现吗？不管这些问题的答案如何，从实现的角度来看，是否有关于这种模式的任何文档？

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2008-09-26T00:17:07.860

我写了Till提到的插件。该插件是[Bayeux](http://cometdproject.dojotoolkit.org/documentation/bayeux)协议的实现，目前支持长轮询（通过 AJAX 的本地服务器）和回调轮询（通过 XSS 的远程服务器）。Python有一个[Bayeux](http://cometdproject.dojotoolkit.org/documentation/bayeux)实现，称为 cometd-twisted，我听说我的插件可以使用它，但我还没有验证这一点。我已经测试并验证了它适用于[cometd-jetty](http://cometdproject.dojotoolkit.org/documentation/cometd-jetty)和[erlycomet](http://code.google.com/p/erlycomet/)，其中包含一个 jQuery Comet 示例。[我的博客](http://morglog.org)上有更多信息，可以在其[google 代码页](http://code.google.com/p/jquerycomet/)上找到带有基本聊天示例的当前代码。希望此信息对您有所帮助，如果需要有关插件的任何进一步帮助，请随时与我联系。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-25T21:19:08.550

有人[使用 jQuery 为 Comet 构建了一个客户端](http://plugins.jquery.com/project/Comet)。我不知道它是否有任何好处。我读过关于 Comet 的文章，听说过它可以做的所有好事，但我从来没有开始使用它。我目前的任何项目都没有时间也没有用例。

我完全忘了添加一个链接来实现彗星。

有彗星日报，他们在网上有一个[比较。](http://cometdaily.com/maturity.html)比较强调不同实现的成熟度。这很有趣，应该让你开始。

希望有帮助！

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2010-07-16T14:56:33.443

查看[Ape 项目](http://www.ape-project.org/)以获得实现彗星模式的完整客户端和服务器端解决方案。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-25T21:18:16.370

模式描述： http: [//ajaxpatterns.org/HTTP_Streaming](http://ajaxpatterns.org/HTTP_Streaming)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-12-30T04:15:12.790

Comet 是一个很好的解决方案，并且有各种各样的实现。哪一种取决于你的需求。

我们已经为 IIS/ASP.NET，[WebSync](http://www.frozenmountain.com/websync)实现了一个解决方案。它包括 javascript 客户端，可以很好地与 jQuery 配合使用。从技术上讲，由于它是 Bayeux 协议，因此任何 Bayeux 客户端都应该可以正常工作。在 dojo 库中也可以找到相同的协议。

有关更多详细信息，您可以查看[Bayeux 协议](http://svn.cometd.com/trunk/bayeux/bayeux.html)的规范。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-08-31T07:12:13.390

我在这里有一个非常简单的例子，可以让你开始使用彗星。它涵盖了使用 NHPM 模块编译 Nginx，并包含 jQuery、PHP 和 Bash 中简单发布者/订阅者角色的代码。

[http://blog.jamieisaacs.com/2010/08/27/comet-with-nginx-and-jquery/](http://blog.jamieisaacs.com/2010/08/27/comet-with-nginx-and-jquery/)

可以在这里找到一个工作示例（简单聊天）：http:
[//cheetah.jamieisaacs.com/](http://cheetah.jamieisaacs.com/)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-05-25T20:35:19.130

看看socket.io。相信我。这正是医生所吩咐的。

[http://socket.io](http://socket.io)

[使用 Node.js 流式传输数据](https://stackoverflow.com/questions/2558606/stream-data-with-node-js/6130564#6130564)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-12-16T15:25:07.857

如果您使用的是 JQuery，我建议您使用 jquery-stream。我目前在一个项目中使用 jquery-stream，到目前为止它是可靠的、有据可查的并且有一个活跃的谷歌代码项目。

[http://code.google.com/p/jquery-stream/](http://code.google.com/p/jquery-stream/)

# asp.net - Quickbooks 2005 网络集成

> ID：136026
> 
> 赞同：1
> 
> 时间：2008-09-25T20:55:00.043
> 
> 标签：asp.net, quickbooks

我们的一位客户拥有 Quickbooks 2005，并希望将他们的 Web 数据（订单、客户、税收）从 Web 收集到的格式以可以导入 Quickbooks 2005 Pro 的格式发送。

有人对这个有经验么？如果是这样，您的经验是什么，您会推荐什么组件/方法将此数据导入 Quickbooks？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T21:17:31.473

查看[QuickBooks Web 连接器](http://marketplace.intuit.com/webconnector/)。

有一个类似的问题： [https ://stackoverflow.com/questions/9331/integrating-quickbooks-with-your-e-commerce-site](https://stackoverflow.com/questions/9331/integrating-quickbooks-with-your-e-commerce-site)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-08T14:36:07.167

QuickBooks Web 连接器几乎可以肯定是将网站与 QuickBooks 集成的唯一方法。

这是一个包含一些附加信息的 wiki：http: [//www.consolibyte.com/wiki/doku.php/quickbooks](http://www.consolibyte.com/wiki/doku.php/quickbooks)

您还想查看 QuickBooks OSR：http: [//developer.intuit.com/qbSDK-Current/Common/newOSR/index.html](http://developer.intuit.com/qbSDK-Current/Common/newOSR/index.html)

还有 QuickBooks SDK：http: [//developer.intuit.com/](http://developer.intuit.com/)

PHP 特定框架： http: [//idnforums.intuit.com/messageview.aspx ?catid=56&threadid=9164](http://idnforums.intuit.com/messageview.aspx?catid=56&threadid=9164)

# c# - Assembly.Load 和 Environment.CurrentDirectory

> ID：136028
> 
> 赞同：2
> 
> 时间：2008-09-25T20:55:04.600
> 
> 标签：c#, .net, assemblies

我意识到这里有一个相关的线程： [加载程序集及其依赖项](https://stackoverflow.com/questions/22012/loading-assemblies-and-its-dependencies)

但我正在修改一些东西，这并不完全适用。

```
string path = Path.GetDirectoryName( pathOfAssembly ); 
Environment.CurrentDirectory = path;
Assembly.Load(Path.GetFileNameWithoutExtension(pastOfAssembly)); 
```

你真的有理由这样做吗？仅使用以下内容是否更有意义：

```
Assembly.LoadFile(pathOfAssembly); 
```

任何见解将不胜感激。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-25T21:00:10.220

看起来像“冗余部门”。

比需要的代码多得多。少即是多！

**编辑：**再想一想，可能是您正在加载的程序集具有依赖项，这些依赖项位于其自己的文件夹中，可能需要使用第一个程序集。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T08:08:18.583

当您开发 Windows 服务时，这可能是必要的。服务的工作目录默认为 %WinDir%，因此，如果您想从服务 exe 所在的目录加载程序集，这是可行的方法。

# php - 我怎样才能获得 PHP（部署）的简单性和 Perl 的强大功能？

> ID：136033
> 
> 赞同：19
> 
> 时间：2008-09-25T20:55:46.843
> 
> 标签：php, perl

我鄙视 PHP 语言，而且我很确定我并不孤单。但是 PHP 的伟大之处在于 mod_php 采用并隐藏与 apache 运行时集成的血腥细节的方式，并实现了类似 CGI 的请求隔离和良好的性能。

使用 Perl 语义获得与 PHP 运行时环境相同的简单性、速度和隔离性的最短距离方法是什么？我觉得原始的 mod_perl 给了我太多的束缚：交叉请求的全局变量、混乱的配置、太多的模板引擎可供选择。

快速CGI？HTML::梅森？我想主要在 Perl 中进行开发，只要我有一个可以让我使用的框架。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-25T21:03:29.697

看看[Catalyst](http://www.catalystframework.org/)，这个 MVC（模型、视图、控制器）框架独立工作或与 apache_perl 一起工作，并隐藏了很多混乱的部分。有一个稍微奇怪的学习曲线（快速开始，中间速度较慢，然后它真的点击高级的东西）。

Catalyst 允许您使用[Template Toolkit](http://template-toolkit.org/ "模板工具包")将设计逻辑与业务逻辑分离，Template toolkit 确实很棒，即使您决定不使用 Catalyst 也应该使用它。HTML::Mason 不是我个人喜欢的东西，但如果您自己编写所有 HTML，那么您可能需要查看[Template::Declare](http://search.cpan.org/dist/Template-Declare/)，这是您也可以与 Catalyst 一起使用的另一种替代方法。

对于数据库的东西，请查看[DBIx::Class](http://search.cpan.org/dist/DBIx-Class/ "DBIx::类")，它再次与 Catalyst 一起使用或单独使用。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-02-09T05:38:36.080

我刚看到[舞者](http://search.cpan.org/dist/Dancer/lib/Dancer.pm)。看起来这可能是一个不错的选择。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-25T20:59:13.623

我推荐使用 FastCGI 的[**Catalyst 。**](http://www.catalystframework.org/)此外，对于模板，我个人最喜欢的是**Template::Toolkit ，但****HTML::Mason**在社区中也受到高度评价。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-26T14:39:50.457

在 Perl 中与 PHP 最接近且广受好评的等价物可能是[HTML::Mason](http://search.cpan.org/perldoc?HTML::Mason)。

像 PHP 一样，它将 Perl 嵌入到您的文档中并呈现它：

```
% my $noun = 'World';
Hello <% $noun %>!
How are ya? 
```

O'Reilly 的书籍[Embedding Perl in HTML with Mason](http://www.masonbook.com/book/)可免费在线获取。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-26T01:40:39.313

有很多可能性，取决于你想做什么。

如果您想利用 mod_perl 的速度，但又想利用 vanilla CGI 的简单性，请查看 CPAN 的[Modperl::Registry](http://search.cpan.org/~gozer/mod_perl-2.0.4/docs/api/ModPerl/Registry.pod)发行版。这将允许您运行基本不变的纯 CGI 脚本。

[在框架方面，我是CGI::Application](http://search.cpan.org/dist/CGI-Application/lib/CGI/Application.pm)的忠实粉丝。它提供了一个非常简单的基于继承的框架，可以处理 Web 应用程序需要做的大部分事情，让您可以自由地按照自己喜欢的方式设计应用程序。一个简单的应用程序可以以单片方式完成；更复杂的可以使用成熟的[MVC](http://en.wikipedia.org/wiki/Model-view-controller)设计。与一般的 Perl 一样，CGI-App 为您提供了很多选择，并且通常不会妨碍您。

CGI-App 默认支持优秀的[HTML::Template](http://search.cpan.org/~samtregar/HTML-Template-2.9/Template.pm)模块，并具有其他模板系统的插件，例如壮观的[Template Toolkit](http://search.cpan.org/~abw/Template-Toolkit-2.20/lib/Template.pm)。还有大量用于其他目的的[插件。](http://cgi-app.org/index.cgi?Plugins)

如果您想为您完成更多工作，请查看[Catalyst](http://www.catalystframework.org/)。如果您使用过 Ruby on Rails，那么这种处理方式可能会更加熟悉。

其他流行的 Web 应用程序框架包括由 Randal Schwartz 编写的基于[Class::Prototyped](http://search.cpan.org/~teverett/Class-Prototyped-1.11/lib/Class/Prototyped.pm)对象框架的[Jifty](http://search.cpan.org/~sartak/Jifty-0.80408/lib/Jifty.pm)和[CGI​​::Prototype 。](http://search.cpan.org/~merlyn/CGI-Prototype-0.9053/lib/CGI/Prototype.pm)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-26T01:40:51.463

前面提到的 Catalyst 是构建整个 Web 应用程序的好工具，但它绝不是简单的。PHP 的主要优势在于您可以根据需要将它的小块嵌入到其他静态页面中，即您可以执行以下操作：

`<html>` `<body>` `<p>The value of 2+2 is: <?php echo 2+2; ?></p>` `</body></html>`

并在您的网络浏览器上查看：

`The value of 2+2 is: 4`

如果你尝试用 Catalyst 做这样的事情（据我所知），你正在开发一个包含多个文件的整个应用程序来打印一个简单的值。至少，在我看到的教程中没有解释如何进行简单的嵌入。

幸运的是，使用 Mason 可以达到这种简单程度*，*在某些方面（感谢 Perl 的强大功能）甚至可以更简单。上面的例子如下：

`<html><body><p>The value of 2+2 is: <% 2+2 %></p></body></html>`

你得到相同的结果。

没有理由您不能从安装和使用 Mason 开始，然后与它并排安装 Catalyst，但是，如果您打算稍后转移到非常复杂的、纯粹由 Perl 驱动的项目，那么。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-26T02:43:47.443

我想知道[mod_perlite变成了](http://www.majordojo.com/2007/11/how-to-fix-cgi.php "Byrne Reese：如何修复 CGI")*什么*，它将提供您所追求的。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-26T13:03:31.390

像 Catalyst 和 CGI​​::Application 这样的东西更像是 Zend 框架而不是 PHP 本身。为了复制 PHP “开箱即用”提供的用于创建网页的基本功能，您需要两个 CPAN 模块，每个基本 Perl 安装都应该提供这些模块：

```
use CGI;
use DBI; 
```

是你真正需要的。现在代替：

```
$_POST['param']
$_GET['param'] 
```

你有：

```
my $q = new CGI;
$q->param('param'); # same for post or get 
```

而不是：

```
$dbh = mysql_connect('localhost', 'mysql_user', 'mysql_password');
$sth = mysql_query("SELECT 1 FROM table", $dbh);
while($row = mysql_fetch_assoc($sth))
{
    // do something with $row
} 
```

你有：

```
my $dbh = DBI->connect('DBI:mysql:host=localhost;', 'mysql_user', 'mysql_password');
my $sth = $dbh->prepare("SELECT 1 FROM table");
$sth->execute();
while(my $row = $sth->fetchrow_hashref)
{
    # do stuff with row
} 
```

DBI 代码稍微复杂一些，因为它提供了准备好的语句和绑定变量，因此您无需担心 SQL 注入。PHP 不提供此功能，因此您需要使用 PDO 之类的东西或编写自己的数据库类。

唯一剩下的就是如果您想在脚本中输出 HTML。但你不希望这样是吗？为此，您使用 HTML::Template 或 Template::Toolkit，就像在 PHP 中使用 Smarty 或本机模板一样。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-10-18T06:19:54.953

如果我问这个问题时[Mojolicious](http://mojolicio.us/)存在，我怀疑我会问它。

具体来说，[Mojolicious::Lite](http://mojolicio.us/perldoc/Mojolicious/Lite)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-12T01:35:43.877

我同意亚里士多德的观点。mod_perlite 听起来就像您正在寻找的东西，只要它完成了。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-31T12:37:22.733

就简单性而言，最接近 PHP 的是 HTML::Mason。

对于寻求简单的人来说，建议 Catalyst 是一个糟糕的笑话……而且我现在每天都在愉快地使用 Catalyst。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-22T17:52:38.157

我使用过 HTML::Mason，首先破解 RT，然后用它创建两个站点。有一个学习曲线，但还不错。我认为更糟糕的是安装这个东西，但这与 Apache 和 mod_perl 的关系比 Mason 更重要。一旦部件到位，它就和你做的一样复杂（就像 Perl 本身一样）。

# java - 在 java 的 ibatis 和 oracle 中传递和返回自定义数组对象

> ID：136034
> 
> 赞同：7
> 
> 时间：2008-09-25T20:56:03.770
> 
> 标签：java, oracle, ibatis

我环顾四周寻找一个很好的例子，但我还没有遇到过。我想使用 IBATIS 框架将自定义字符串数组从 java 传递到 oracle 并返回。有没有人有一个很好的例子链接？我正在从 IBATIS 调用存储过程。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T03:54:51.300

您必须从`TypeHandler`. 我们更愿意实现更简单的`TypeHandlerCallback`，但在这种情况下，我们需要访问底层的`Connection`.

```
public class ArrayTypeHandler implements TypeHandler {

    public void setParameter(PreparedStatement ps, int i, Object param, String jdbcType)
            throws SQLException {
        if (param == null) {
            ps.setNull(i, Types.ARRAY);
        } else {
            Connection conn = ps.getConnection();
            Array loc = conn.createArrayOf("myArrayType", (Object[]) param);
            ps.setArray(i, loc);
        }
    }

    public Object getResult(CallableStatement statement, int i)
            throws SQLException {
        return statement.getArray(i).getArray();
    }
    ...
} 
```

然后，在 iBATIS 配置中连接它：

```
<?xml version="1.0"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="arrayTest">

    <parameterMap id="storedprocParams" class="map">
        <parameter property="result" mode="OUT" jdbcType="ARRAY" typeHandler="ArrayTypeHandler"/>
        <parameter property="argument" mode="IN" jdbcType="ARRAY" typeHandler="ArrayTypeHandler"/>
    </parameterMap>

    <procedure id="storedproc" parameterMap="arrayTest.storedprocParams">
        {? = call My_Array_Function( ? )}
    </procedure>

</sqlMap> 
```

希望这可以帮助！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T20:47:31.000

bsanders 给了我一个很好的起点——这是我必须做的才能使它在 RAD 环境（websphere 6.2）中工作。

```
public Object getResult(CallableStatement statement, int i) throws SQLException {
    return statement.getArray(i).getArray(); //getting null pointer exception here
}

public void setParameter(PreparedStatement ps, int i, Object param, String jdbcType) throws SQLException {
    if (param == null) {
        ps.setNull(i, Types.ARRAY);

    } else {
        String[] a = (String[]) param;
        //ARRAY aOracle = ARRAY.toARRAY(a, (OracleConnection)ps.getConnection());

        //com.ibm.ws.rsadapter.jdbc.WSJdbcConnection
        w = (com.ibm.ws.rsadapter.jdbc.WSJdbcConnection)ps.getConnection());

        //com.ibm.ws.rsadapter.jdbc.WSJdbcObject x;
        Connection nativeConnection = Connection)WSJdbcUtil.getNativeConnection((WSJdbcConnection)ps.getConnection());

        ArrayDescriptor descriptor = ArrayDescriptor.createDescriptor("F2_LIST", nativeConnection);
        ARRAY dataArray = new ARRAY(descriptor, nativeConnection, a);
        ps.setArray(i, dataArray);
    }
} 
```

注意我必须得到的 nativeConnection、我必须创建的描述符等等。但是，虽然我可以将内容作为字符串数组传递到数据库中，但我无法弄清楚为什么我没有得到任何返回。我的 OUT 参数（getResult(CallableStatement statment, int i) 抛出空指针异常，即使我在数据库的 plsql 中设置了 out 参数。

```
--stored procedure to take a | delimited ids
   PROCEDURE array_test (argument IN f2_list, result OUT f2_list) 
   AS
      l_procname_v   VARCHAR2 (50)                 := 'array_test';
      l_param_list   VARCHAR2 (2000)
                   := l_procname_v || ' param_values: p_string: ';

      p_status_n     NUMBER;
      p_message_v    VARCHAR2 (2000);
      ret_list f2_list := new f2_list();
      l_count_v varchar2(200);
   BEGIN

      l_count_v := argument.COUNT;
      for x in 1..argument.count
      LOOP
          pkg_az_common_util.az_debug (package_nm,
                                   l_procname_v,
                                   pkg_az_data_type_def.debug_num,
                                   argument(x)
                                  );
      end loop;

      pkg_az_common_util.az_debug (package_nm,
                                   l_procname_v,
                                   pkg_az_data_type_def.debug_num,
                                   l_count_v
                                  );
      ret_list.extend();
      ret_list(1) := 'W';
      ret_list.extend();
      ret_list(2) := 'X';
      ret_list.extend();
      ret_list(3) := 'Y';
      ret_list.extend();
      ret_list(4) := 'Z';

      result := ret_list;

   EXCEPTION
      WHEN OTHERS
      THEN
         p_status_n := pkg_az_common_util.get_error_code;
         p_message_v :=
               TO_CHAR (p_status_n)
            || '|'
            || 'Oracle Internal Exception('
            || l_procname_v
            || ')'
            || '|'
            || TO_CHAR (SQLCODE)
            || '|'
            || SQLERRM
            || l_param_list;
         standard_pkg.log_error (package_nm,
                                 l_procname_v,
                                 SQLCODE,
                                 p_message_v
                                );

         IF p_status_n = 1
         THEN
            RAISE;
         END IF;
   END array_test; 
```

这是我访问它的方式：

```
Map queryParamsTest = new HashMap();

        String[] testArray = {"A", "B", "C"};

        queryParamsTest.put("argument", testArray);

        DaoUtils.executeQuery(super.getSqlMapClientTemplate(),
                "arrayTest", queryParamsTest, queryParamsTest
                .toString());  //just executes query

        String[] resultArray = (String[])queryParamsTest.get("result");

        for(int x = 0; x< resultArray.length; x++)
        {
            System.out.println("Result: " + resultArray[x]);
        }

<parameterMap id="storedprocParams" class="map">        
        <parameter property="argument" mode="IN" jdbcType="ARRAY" typeHandler="ArrayTypeHandler"/>    
        <parameter property="result" mode="OUT" jdbcType="ARRAY" typeHandler="ArrayTypeHandler"/>        
    </parameterMap>    
    <procedure id="arrayTest" parameterMap="storedprocParams">        
        {call pkg_az_basic_dev.array_test(?, ? )}    
    </procedure> 
```

有任何想法吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-10-20T09:11:41.290

好吧，公司里的人找到了**解决方案**：您需要在 typeHandler 中实现 getResult 方法并在映射器中提供附加属性 jdbcTypeName=ORACLE_REAL_ARRAY_TYPE

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T15:02:17.733

尝试使用`statement.getObject(i)`然后转换为数组。

# c# - 一次捕获多个异常？

> ID：136035
> 
> 赞同：2415
> 
> 时间：2008-09-25T20:56:08.513
> 
> 标签：c#, .net, exception

不鼓励简单地 catch `System.Exception`。相反，应该只捕获“已知”的异常。

现在，这有时会导致不必要的重复代码，例如：

```
try
{
    WebId = new Guid(queryString["web"]);
}
catch (FormatException)
{
    WebId = Guid.Empty;
}
catch (OverflowException)
{
    WebId = Guid.Empty;
} 
```

我想知道：有没有办法捕获两个异常并且只`WebId = Guid.Empty`调用一次？

给定的示例相当简单，因为它只是一个[`GUID`](http://en.wikipedia.org/wiki/Globally_unique_identifier). 但是想象一下你多次修改一个对象的代码，如果其中一个操作预期失败，你想“重置” `object`. 但是，如果出现意外异常，我仍然想将其抛出更高。

* * *

## 回答 #1

> 赞同：2334
> 
> 时间：2008-09-25T21:01:49.530

捕捉`System.Exception`并打开类型

```
catch (Exception ex)            
{                
    if (ex is FormatException || ex is OverflowException)
    {
        WebId = Guid.Empty;
        return;
    }

    throw;
} 
```

* * *

## 回答 #2

> 赞同：757
> 
> 时间：2013-10-12T00:24:15.827

**编辑：**我同意其他人的说法，从 C# 6.0 开始，异常过滤器现在是一个非常好的方法：`catch (Exception ex) when (ex is ... || ex is ... )`

除了我仍然有点讨厌单行布局，并且会像下面这样亲自布置代码。我认为这既实用又美观，因为我相信它可以提高理解力。有些人可能不同意：

```
catch (Exception ex) when (
    ex is ...
    || ex is ...
    || ex is ...
) 
```

**原来的：**

我知道我在这里聚会有点晚了，但是圣烟……

切入正题，这种方法重复了之前的答案，但是如果你真的想对几种异常类型执行一个通用的操作，并在一个方法的范围内保持整个事情的整洁，为什么不只使用一个 lambda /closure/inline 函数执行以下操作？我的意思是，很有可能你最终会意识到你只是想让这个闭包成为一个可以在任何地方使用的单独方法。但是，在不实际更改其余代码结构的情况下，将非常容易做到这一点。对？

```
private void TestMethod ()
{
    Action<Exception> errorHandler = ( ex ) => {
        // write to a log, whatever...
    };

    try
    {
        // try some stuff
    }
    catch ( FormatException  ex ) { errorHandler ( ex ); }
    catch ( OverflowException ex ) { errorHandler ( ex ); }
    catch ( ArgumentNullException ex ) { errorHandler ( ex ); }
} 
```

我不禁想知道（**警告：**前面有点讽刺/讽刺）为什么要付出所有这些努力基本上只是替换以下内容：

```
try
{
    // try some stuff
}
catch( FormatException ex ){}
catch( OverflowException ex ){}
catch( ArgumentNullException ex ){} 
```

...下一个代码气味的一些疯狂变化，我的意思是示例，只是为了假装你正在节省一些击键。

```
// sorta sucks, let's be honest...
try
{
    // try some stuff
}
catch( Exception ex )
{
    if (ex is FormatException ||
        ex is OverflowException ||
        ex is ArgumentNullException)
    {
        // write to a log, whatever...
        return;
    }
    throw;
} 
```

因为它当然不会自动更具可读性。

当然，我在第一个示例中留下了三个相同的实例`/* write to a log, whatever... */ return;`。

但这就是我的观点。你们都听说过函数/方法，对吧？严重地。编写一个通用`ErrorHandler`函数，然后从每个 catch 块中调用它。

如果您问我，第二个示例（使用`if`and`is`关键字）的可读性明显降低，同时在项目的维护阶段更容易出错。

维护阶段，对于任何可能对编程相对较新的人来说，将占项目整个生命周期的 98.7% 或更多，而进行维护的可怜的笨蛋几乎肯定会是你以外的人。他们很有可能会在工作上花费 50% 的时间来诅咒你的名字。

当然，FxCop 会向您咆哮，因此您还必须***在***代码中添加一个属性，该属性与正在运行的程序具有精确的 zip，并且只是在那里告诉 FxCop 忽略一个问题，在 99.9% 的情况下它完全是正确的标记。而且，对不起，我可能弄错了，但“忽略”属性最终不会真正编译到您的应用程序中吗？

将整个`if`测试放在一行上会使其更具可读性吗？我不这么认为。我的意思是，很久以前我确实有另一位程序员激烈争辩说，将更多代码放在一行上会使其“运行得更快”。但当然，他是个十足的疯子。试图向他解释（板着脸——这很有挑战性）解释器或编译器如何将那长长的行分成离散的每行一条指令的语句——如果他继续前进的话，结果基本上是相同的只是让代码可读，而不是试图让编译器更聪明——对他没有任何影响。但我离题了。

从现在开始的一两个月后，再添加三种异常类型时，可读性会*降低*多少？（答案：它变得不那么可读了***）***。

真正的要点之一是，格式化我们每天都在查看的文本源代码的大部分要点是让其他人非常非常清楚地看到代码运行时实际发生的事情。因为编译器将源代码变成了完全不同的东西，并且不太关心您的代码格式样式。所以全线上也完全烂透了。

只是说...

```
// super sucks...
catch( Exception ex )
{
    if ( ex is FormatException || ex is OverflowException || ex is ArgumentNullException )
    {
        // write to a log, whatever...
        return;
    }
    throw;
} 
```

* * *

## 回答 #3

> 赞同：453
> 
> 时间：2014-04-04T13:59:38.657

正如其他人指出的那样，您可以`if`在 catch 块中添加一个语句来确定发生了什么。C#6 支持异常过滤器，因此以下将起作用：

```
try { … }
catch (Exception e) when (MyFilter(e))
{
    …
} 
```

该`MyFilter`方法可能看起来像这样：

```
private bool MyFilter(Exception e)
{
  return e is ArgumentNullException || e is FormatException;
} 
```

或者，这可以全部内联完成（when 语句的右侧必须是布尔表达式）。

```
try { … }
catch (Exception e) when (e is ArgumentNullException || e is FormatException)
{
    …
} 
```

这与在块`if`内使用语句不同`catch`，使用异常过滤器**不会**展开堆栈。

您可以下载[Visual Studio 2015](http://www.visualstudio.com/en-us/downloads/visual-studio-2015-downloads-vs.aspx)来查看。

如果要继续使用 Visual Studio 2013，可以安装以下 nuget 包：

> 安装包 Microsoft.Net.Compilers

[在撰写本文时，这将包括对 C# 6 的支持。](http://www.nuget.org/packages/Microsoft.Net.Compilers/)

> 引用此包将导致使用包中包含的 C# 和 Visual Basic 编译器的特定版本构建项目，而不是任何系统安装的版本。

* * *

## 回答 #4

> 赞同：199
> 
> 时间：2008-09-25T21:03:57.840

不幸的是，不在 C# 中，因为您需要一个异常过滤器来执行此操作，而 C# 不会公开 MSIL 的该功能。VB.NET 确实有这种能力，例如

```
Catch ex As Exception When TypeOf ex Is FormatException OrElse TypeOf ex Is OverflowException 
```

您可以做的是使用匿名函数来封装您的错误代码，然后在这些特定的 catch 块中调用它：

```
Action onError = () => WebId = Guid.Empty;
try
{
    // something
}
catch (FormatException)
{
    onError();
}
catch (OverflowException)
{
    onError();
} 
```

* * *

## 回答 #5

> 赞同：150
> 
> 时间：2018-07-11T13:12:05.520

异常过滤器现在在 c# 6+ 中可用。你可以做

```
try
{
       WebId = new Guid(queryString["web"]);
}
catch (Exception ex) when(ex is FormatException || ex is OverflowException)
{
     WebId = Guid.Empty;
} 
```

在 C# 7.0+ 中，您也可以将其与模式匹配结合使用

```
try
{
   await Task.WaitAll(tasks);
}
catch (Exception ex) when( ex is AggregateException ae &&
                           ae.InnerExceptions.Count > tasks.Count/2)
{
   //More than half of the tasks failed maybe..? 
} 
```

* * *

## 回答 #6

> 赞同：143
> 
> 时间：2013-04-13T12:18:12.367

为了完整起见，从**.NET 4.0**开始，代码可以重写为：

```
Guid.TryParse(queryString["web"], out WebId); 
```

[TryParse](http://msdn.microsoft.com/en-us/library/system.guid.tryparse.aspx)从不抛出异常并在格式错误时返回 false，将 WebId 设置为`Guid.Empty`.

* * *

从**C# 7**开始，您可以避免在单独的行中引入变量：

```
Guid.TryParse(queryString["web"], out Guid webId); 
```

您还可以创建用于解析返回元组的方法，这些方法在 .NET Framework 4.6 版中尚不可用：

```
(bool success, Guid result) TryParseGuid(string input) =>
    (Guid.TryParse(input, out Guid result), result); 
```

并像这样使用它们：

```
WebId = TryParseGuid(queryString["web"]).result;
// or
var tuple = TryParseGuid(queryString["web"]);
WebId = tuple.success ? tuple.result : DefaultWebId; 
```

* * *

当在 C# 12 中实现 out-parameters 的解构时，对这个无用的答案进行了下一个无用的更新。:)

* * *

## 回答 #7

> 赞同：85
> 
> 时间：2015-04-01T12:29:33.930

如果您可以将您的应用程序升级到 C# 6，那么您是幸运的。新的 C# 版本实现了异常过滤器。所以你可以这样写：

```
catch (Exception ex) when (ex is FormatException || ex is OverflowException) {
    WebId = Guid.Empty;
} 
```

有些人认为这段代码与

```
catch (Exception ex) {                
    if (ex is FormatException || ex is OverflowException) {
        WebId = Guid.Empty;
    }
    throw;
} 
```

但事实并非如此。实际上，这是 C# 6 中唯一无法在早期版本中模拟的新功能。首先，重新投掷比跳过接球意味着更多的开销。其次，它在语义上不等价。当您调试代码时，新功能会完整地保留堆栈。如果没有此功能，故障转储就不太有用，甚至毫无用处。

~~请参阅[CodePlex 上关于此的讨论](https://roslyn.codeplex.com/discussions/541301)~~不再可用。和一个[显示差异的例子](http://www.volatileread.com/Wiki/Index?id=1087)。

* * *

## 回答 #8

> 赞同：42
> 
> 时间：2018-01-05T11:43:42.623

使用 C# 7可以改进[Michael Stum 的答案，同时保持 switch 语句的可读性：](https://stackoverflow.com/a/136038)

```
catch (Exception ex)
{
    switch (ex)
    {
        case FormatException _:
        case OverflowException _:
            WebId = Guid.Empty;
            break;
        default:
            throw;
    }
} 
```

多亏了[Orace](https://stackoverflow.com/users/361177/orace)注释，这可以使用 C# 8 通过省略丢弃变量来简化：

```
catch (Exception ex)
{
    switch (ex)
    {
        case FormatException:
        case OverflowException:
            WebId = Guid.Empty;
            break;
        default:
            throw;
    }
} 
```

并使用 C# 8 作为 switch 表达式：

```
catch (Exception ex)
{
    WebId = ex switch
    {
        _ when ex is FormatException || ex is OverflowException => Guid.Empty,
        _ => throw ex
    };
} 
```

正如[Nechemia Hoffmann](https://stackoverflow.com/users/7711481/nechemia-hoffmann)指出的那样。后一个示例将导致堆栈跟踪丢失。这可以通过使用[Jürgen Steinblock](https://stackoverflow.com/a/57052791/4226080)描述的扩展方法在抛出之前捕获堆栈跟踪来防止：

```
catch (Exception ex)
{
    WebId = ex switch
    {
        _ when ex is FormatException || ex is OverflowException => Guid.Empty,
        _ => throw ex.Capture()
    };
}

public static Exception Capture(this Exception ex)
{
    ExceptionDispatchInfo.Capture(ex).Throw();
    return ex;
} 
```

两种样式都可以通过 C# 9 的模式匹配增强功能进行简化：

```
catch (Exception ex)
{
    switch (ex)
    {
        case FormatException or OverflowException:
            WebId = Guid.Empty;
            break;
        default:
            throw;
    }
} 

catch (Exception ex)
{
    WebId = ex switch
    {
        _ when ex is FormatException or OverflowException => Guid.Empty,
        _ => throw ex.Capture()
    };
} 
```

* * *

## 回答 #9

> 赞同：38
> 
> 时间：2015-10-07T17:31:46.863

如果您不想`if`在`catch`范围内使用语句***，则`C# 6.0`可以使用`Exception Filters`***CLR 在预览版本中已支持但仅存在于`VB.NET`/中的***语法***`MSIL`：

```
try
{
    WebId = new Guid(queryString["web"]);
}
catch (Exception exception) when (exception is FormatException || ex is OverflowException)
{
    WebId = Guid.Empty;
} 
```

`Exception`只有当它是 a`InvalidDataException`或时，此代码才会捕获`ArgumentNullException`。

实际上，您基本上可以在该`when`子句中放置任何条件：

```
static int a = 8;

...

catch (Exception exception) when (exception is InvalidDataException && a == 8)
{
    Console.WriteLine("Catch");
} 
```

请注意，与' 范围`if`内的语句相反，不能 throw ，当他们这样做时，或者当条件不是时，将评估下一个条件：`catch``Exception Filters``Exceptions``true``catch`

```
static int a = 7;

static int b = 0;

...

try
{
    throw new InvalidDataException();
}
catch (Exception exception) when (exception is InvalidDataException && a / b == 2)
{
    Console.WriteLine("Catch");
}
catch (Exception exception) when (exception is InvalidDataException || exception is ArgumentException)
{
    Console.WriteLine("General catch");
} 
```

> 输出：一般捕获。

当有多个时`true` `Exception Filter`- 第一个将被接受：

```
static int a = 8;

static int b = 4;

...

try
{
    throw new InvalidDataException();
}
catch (Exception exception) when (exception is InvalidDataException && a / b == 2)
{
    Console.WriteLine("Catch");
}
catch (Exception exception) when (exception is InvalidDataException || exception is ArgumentException)
{
    Console.WriteLine("General catch");
} 
```

> 输出：抓住。

正如您在代码中看到的那样`MSIL`，代码不是转换为`if`语句，而是转换为`Filters`，并且`Exceptions`不能从标记为的区域内抛出`Filter 1`，`Filter 2`但是抛出 的过滤器将失败，也是命令`Exception`之前推入堆栈的最后一个比较值`endfilter`将确定过滤器的成功/失败（`Catch 1` ***XOR*** `Catch 2`将相应地执行）：

[![异常过滤器 MSIL](https://i.stack.imgur.com/uEfE9.jpg)](https://i.stack.imgur.com/uEfE9.jpg)

*还有，具体`Guid`有[`Guid.TryParse`](https://msdn.microsoft.com/en-us/library/system.guid.tryparse(v=vs.110).aspx)方法。*

* * *

## 回答 #10

> 赞同：36
> 
> 时间：2021-01-06T20:12:03.897

**C# 9 的更新**

使用 C# 9 中的[新模式匹配增强功能](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-9#pattern-matching-enhancements)，您可以缩短异常过滤器中的表达式。现在，捕获多个异常很简单：

```
try
{
    WebId = new Guid(queryString["web"]);
}
catch (Exception e) when (e is FormatException or OverflowException)
{
    WebId = Guid.Empty;
} 
```

* * *

## 回答 #11

> 赞同：23
> 
> 时间：2009-01-07T08:07:52.157

```
catch (Exception ex) when (ex is FormatException or OverflowException)
{
    WebId = Guid.Empty;
} 
```

或者

```
catch (Exception ex)
{
    if (ex is not FormatException and not OverflowException)
        throw;

    WebId = Guid.Empty;
} 
```

* * *

## 回答 #12

> 赞同：21
> 
> 时间：2010-07-30T17:09:19.227

接受的答案似乎可以接受，除了 CodeAnalysis/ [FxCop](http://en.wikipedia.org/wiki/FxCop)会抱怨它正在捕获一般异常类型这一事实。

此外，似乎“is”运算符可能会稍微降低性能。

*[CA1800：不要强制](http://msdn.microsoft.com/en-us/library/ms182271.aspx)*要求“考虑测试 'as' 运算符的结果”，但如果这样做，您将编写比单独捕获每个异常更多的代码。

无论如何，这就是我要做的：

```
bool exThrown = false;

try
{
    // Something
}
catch (FormatException) {
    exThrown = true;
}
catch (OverflowException) {
    exThrown = true;
}

if (exThrown)
{
    // Something else
} 
```

* * *

## 回答 #13

> 赞同：19
> 
> 时间：2015-10-04T07:51:06.983

在 C# 6 中，推荐的方法是使用异常过滤器，这是一个示例：

```
 try
 {
      throw new OverflowException();
 }
 catch(Exception e ) when ((e is DivideByZeroException) || (e is OverflowException))
 {
       // this will execute iff e is DividedByZeroEx or OverflowEx
       Console.WriteLine("E");
 } 
```

* * *

## 回答 #14

> 赞同：18
> 
> 时间：2012-08-31T20:51:24.283

这是马特的答案的变体（我觉得这有点干净）......使用一种方法：

```
public void TryCatch(...)
{
    try
    {
       // something
       return;
    }
    catch (FormatException) {}
    catch (OverflowException) {}

    WebId = Guid.Empty;
} 
```

任何其他异常都会被抛出并且代码`WebId = Guid.Empty;`不会被命中。如果您不希望其他异常使您的程序崩溃，只需在其他两个捕获之后添加：

```
...
catch (Exception)
{
     // something, if anything
     return; // only need this if you follow the example I gave and put it all in a method
} 
```

* * *

## 回答 #15

> 赞同：18
> 
> 时间：2014-12-08T20:31:11.677

[Joseph Daigle's Answer](https://stackoverflow.com/questions/136035/catch-multiple-exceptions-at-once/136092#136092)是一个很好的解决方案，但我发现以下结构更整洁，更不容易出错。

```
catch(Exception ex)
{   
    if (!(ex is SomeException || ex is OtherException)) throw;

    // Handle exception
} 
```

反转表达式有几个优点：

*   不需要返回声明
*   代码没有嵌套
*   没有忘记约瑟夫解决方案中与表达式分离的“抛出”或“返回”语句的风险。

它甚至可以压缩成一行（虽然不是很漂亮）

```
catch(Exception ex) { if (!(ex is SomeException || ex is OtherException)) throw;

    // Handle exception
} 
```

* * *

**编辑：** C# 6.0 中 的[异常过滤](http://www.codeproject.com/Articles/853207/What-s-new-in-Csharp-Exception-Filters)将使语法更简洁，并且与任何当前解决方案相比具有[许多其他好处。](https://stackoverflow.com/a/27082164/2802543)（最值得注意的是让堆栈安然无恙）

以下是使用 C# 6.0 语法的相同问题的外观：

```
catch(Exception ex) when (ex is SomeException || ex is OtherException)
{
    // Handle exception
} 
```

* * *

## 回答 #16

> 赞同：16
> 
> 时间：2008-09-25T21:01:54.613

@迈克尔

您的代码的略微修改版本：

```
catch (Exception ex)
{
   Type exType = ex.GetType();
   if (exType == typeof(System.FormatException) || 
       exType == typeof(System.OverflowException)
   {
       WebId = Guid.Empty;
   } else {
      throw;
   }
} 
```

字符串比较丑陋且缓慢。

* * *

## 回答 #17

> 赞同：13
> 
> 时间：2008-09-25T20:57:26.810

怎么样

```
try
{
    WebId = Guid.Empty;
    WebId = new Guid(queryString["web"]);
}
catch (FormatException)
{
}
catch (OverflowException)
{
} 
```

* * *

## 回答 #18

> 赞同：12
> 
> 时间：2013-05-18T11:28:30.983

### 谨慎和警告：[另一种实用风格。](http://community.bartdesmet.net/blogs/bart/archive/2008/01/06/exception-handling-in-functional-style.aspx)

链接中的内容不能直接回答您的问题，但将其扩展为如下所示很简单：

```
static void Main() 
{ 
    Action body = () => { ...your code... };

    body.Catch<InvalidOperationException>() 
        .Catch<BadCodeException>() 
        .Catch<AnotherException>(ex => { ...handler... })(); 
} 
```

*（基本上提供另一个`Catch`返回自身的空重载）*

更大的问题是*为什么*。我认为这里的成本不会超过收益:)

* * *

## 回答 #19

> 赞同：10
> 
> 时间：2013-11-27T21:53:33.930

2015 年 12 月 15 日更新：请参阅[https://stackoverflow.com/a/22864936/1718702](https://stackoverflow.com/a/22864936/1718702)了解 C#6。它是一种更清洁的语言，现在是语言的标准。

面向那些想要[更优雅的解决方案](https://stackoverflow.com/q/791390/1718702)来捕获一次并过滤异常的人，我使用了如下所示的扩展方法。

我的库中已经有了这个扩展，最初是为其他目的而编写的，但它非常适合`type`检查异常。另外，恕我直言，它看起来比一堆`||`声明更干净。此外，与公认的答案不同，我更喜欢显式异常处理，因此`ex is ...`具有不受欢迎的行为，因为派生类可分配给父类型）。

**用法**

```
if (ex.GetType().IsAnyOf(
    typeof(FormatException),
    typeof(ArgumentException)))
{
    // Handle
}
else
    throw; 
```

**IsAnyOf.cs 扩展（请参阅依赖项的完整错误处理示例）**

```
namespace Common.FluentValidation
{
    public static partial class Validate
    {
        /// <summary>
        /// Validates the passed in parameter matches at least one of the passed in comparisons.
        /// </summary>
        /// <typeparam name="T"></typeparam>
        /// <param name="p_parameter">Parameter to validate.</param>
        /// <param name="p_comparisons">Values to compare against.</param>
        /// <returns>True if a match is found.</returns>
        /// <exception cref="ArgumentNullException"></exception>
        public static bool IsAnyOf<T>(this T p_parameter, params T[] p_comparisons)
        {
            // Validate
            p_parameter
                .CannotBeNull("p_parameter");
            p_comparisons
                .CannotBeNullOrEmpty("p_comparisons");

            // Test for any match
            foreach (var item in p_comparisons)
                if (p_parameter.Equals(item))
                    return true;

            // Return no matches found
            return false;
        }
    }
} 
```

**完整的错误处理示例（复制粘贴到新的控制台应用程序）**

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Common.FluentValidation;

namespace IsAnyOfExceptionHandlerSample
{
    class Program
    {
        static void Main(string[] args)
        {
            // High Level Error Handler (Log and Crash App)
            try
            {
                Foo();
            }
            catch (OutOfMemoryException ex)
            {
                Console.WriteLine("FATAL ERROR! System Crashing. " + ex.Message);
                Console.ReadKey();
            }
        }

        static void Foo()
        {
            // Init
            List<Action<string>> TestActions = new List<Action<string>>()
            {
                (key) => { throw new FormatException(); },
                (key) => { throw new ArgumentException(); },
                (key) => { throw new KeyNotFoundException();},
                (key) => { throw new OutOfMemoryException(); },
            };

            // Run
            foreach (var FooAction in TestActions)
            {
                // Mid-Level Error Handler (Appends Data for Log)
                try
                {
                    // Init
                    var SomeKeyPassedToFoo = "FooParam";

                    // Low-Level Handler (Handle/Log and Keep going)
                    try
                    {
                        FooAction(SomeKeyPassedToFoo);
                    }
                    catch (Exception ex)
                    {
                        if (ex.GetType().IsAnyOf(
                            typeof(FormatException),
                            typeof(ArgumentException)))
                        {
                            // Handle
                            Console.WriteLine("ex was {0}", ex.GetType().Name);
                            Console.ReadKey();
                        }
                        else
                        {
                            // Add some Debug info
                            ex.Data.Add("SomeKeyPassedToFoo", SomeKeyPassedToFoo.ToString());
                            throw;
                        }
                    }
                }
                catch (KeyNotFoundException ex)
                {
                    // Handle differently
                    Console.WriteLine(ex.Message);

                    int Count = 0;
                    if (!Validate.IsAnyNull(ex, ex.Data, ex.Data.Keys))
                        foreach (var Key in ex.Data.Keys)
                            Console.WriteLine(
                                "[{0}][\"{1}\" = {2}]",
                                Count, Key, ex.Data[Key]);

                    Console.ReadKey();
                }
            }
        }
    }
}

namespace Common.FluentValidation
{
    public static partial class Validate
    {
        /// <summary>
        /// Validates the passed in parameter matches at least one of the passed in comparisons.
        /// </summary>
        /// <typeparam name="T"></typeparam>
        /// <param name="p_parameter">Parameter to validate.</param>
        /// <param name="p_comparisons">Values to compare against.</param>
        /// <returns>True if a match is found.</returns>
        /// <exception cref="ArgumentNullException"></exception>
        public static bool IsAnyOf<T>(this T p_parameter, params T[] p_comparisons)
        {
            // Validate
            p_parameter
                .CannotBeNull("p_parameter");
            p_comparisons
                .CannotBeNullOrEmpty("p_comparisons");

            // Test for any match
            foreach (var item in p_comparisons)
                if (p_parameter.Equals(item))
                    return true;

            // Return no matches found
            return false;
        }

        /// <summary>
        /// Validates if any passed in parameter is equal to null.
        /// </summary>
        /// <param name="p_parameters">Parameters to test for Null.</param>
        /// <returns>True if one or more parameters are null.</returns>
        public static bool IsAnyNull(params object[] p_parameters)
        {
            p_parameters
                .CannotBeNullOrEmpty("p_parameters");

            foreach (var item in p_parameters)
                if (item == null)
                    return true;

            return false;
        }
    }
}

namespace Common.FluentValidation
{
    public static partial class Validate
    {
        /// <summary>
        /// Validates the passed in parameter is not null, throwing a detailed exception message if the test fails.
        /// </summary>
        /// <param name="p_parameter">Parameter to validate.</param>
        /// <param name="p_name">Name of tested parameter to assist with debugging.</param>
        /// <exception cref="ArgumentNullException"></exception>
        public static void CannotBeNull(this object p_parameter, string p_name)
        {
            if (p_parameter == null)
                throw
                    new
                        ArgumentNullException(
                        string.Format("Parameter \"{0}\" cannot be null.",
                        p_name), default(Exception));
        }
    }
}

namespace Common.FluentValidation
{
    public static partial class Validate
    {
        /// <summary>
        /// Validates the passed in parameter is not null or an empty collection, throwing a detailed exception message if the test fails.
        /// </summary>
        /// <typeparam name="T"></typeparam>
        /// <param name="p_parameter">Parameter to validate.</param>
        /// <param name="p_name">Name of tested parameter to assist with debugging.</param>
        /// <exception cref="ArgumentNullException"></exception>
        /// <exception cref="ArgumentOutOfRangeException"></exception>
        public static void CannotBeNullOrEmpty<T>(this ICollection<T> p_parameter, string p_name)
        {
            if (p_parameter == null)
                throw new ArgumentNullException("Collection cannot be null.\r\nParameter_Name: " + p_name, default(Exception));

            if (p_parameter.Count <= 0)
                throw new ArgumentOutOfRangeException("Collection cannot be empty.\r\nParameter_Name: " + p_name, default(Exception));
        }

        /// <summary>
        /// Validates the passed in parameter is not null or empty, throwing a detailed exception message if the test fails.
        /// </summary>
        /// <param name="p_parameter">Parameter to validate.</param>
        /// <param name="p_name">Name of tested parameter to assist with debugging.</param>
        /// <exception cref="ArgumentException"></exception>
        public static void CannotBeNullOrEmpty(this string p_parameter, string p_name)
        {
            if (string.IsNullOrEmpty(p_parameter))
                throw new ArgumentException("String cannot be null or empty.\r\nParameter_Name: " + p_name, default(Exception));
        }
    }
} 
```

**两个示例 NUnit 单元测试**

类型的匹配行为`Exception`是精确的（即，子类型不匹配其任何父类型）。

```
using System;
using System.Collections.Generic;
using Common.FluentValidation;
using NUnit.Framework;

namespace UnitTests.Common.Fluent_Validations
{
    [TestFixture]
    public class IsAnyOf_Tests
    {
        [Test, ExpectedException(typeof(ArgumentNullException))]
        public void IsAnyOf_ArgumentNullException_ShouldNotMatch_ArgumentException_Test()
        {
            Action TestMethod = () => { throw new ArgumentNullException(); };

            try
            {
                TestMethod();
            }
            catch (Exception ex)
            {
                if (ex.GetType().IsAnyOf(
                    typeof(ArgumentException), /*Note: ArgumentNullException derrived from ArgumentException*/
                    typeof(FormatException),
                    typeof(KeyNotFoundException)))
                {
                    // Handle expected Exceptions
                    return;
                }

                //else throw original
                throw;
            }
        }

        [Test, ExpectedException(typeof(OutOfMemoryException))]
        public void IsAnyOf_OutOfMemoryException_ShouldMatch_OutOfMemoryException_Test()
        {
            Action TestMethod = () => { throw new OutOfMemoryException(); };

            try
            {
                TestMethod();
            }
            catch (Exception ex)
            {
                if (ex.GetType().IsAnyOf(
                    typeof(OutOfMemoryException),
                    typeof(StackOverflowException)))
                    throw;

                /*else... Handle other exception types, typically by logging to file*/
            }
        }
    }
} 
```

* * *

## 回答 #20

> 赞同：8
> 
> 时间：2014-10-21T09:44:02.490

因为我觉得这些答案只是表面上，所以我试图更深入地挖掘。

所以我们真正想做的是不能编译的东西，比如：

```
// Won't compile... damn
public static void Main()
{
    try
    {
        throw new ArgumentOutOfRangeException();
    }
    catch (ArgumentOutOfRangeException)
    catch (IndexOutOfRangeException) 
    {
        // ... handle
    } 
```

我们想要这个的原因是因为我们不希望异常处理程序捕获我们稍后在流程中需要的东西。当然，我们可以捕获一个异常并用“如果”检查要做什么，但老实说，我们并不是真的想要那样。（FxCop，调试器问题，丑陋）

那么为什么这段代码不能编译——我们怎样才能破解它呢？

如果我们查看代码，我们真正想做的是转发呼叫。但是，根据 MS Partition II，IL 异常处理程序块不会像这样工作，这在这种情况下是有道理的，因为这意味着“异常”对象可以有不同的类型。

或者用代码编写它，我们要求编译器做这样的事情（虽然它并不完全正确，但我猜这是最接近的可能）：

```
// Won't compile... damn
try
{
    throw new ArgumentOutOfRangeException();
}
catch (ArgumentOutOfRangeException e) {
    goto theOtherHandler;
}
catch (IndexOutOfRangeException e) {
theOtherHandler:
    Console.WriteLine("Handle!");
} 
```

这不会编译的原因很明显：'$exception' 对象将具有什么类型和值（这里存储在变量“e”中）？我们希望编译器处理这个问题的方式是注意两个异常的公共基类型是“异常”，将其用于包含两个异常的变量，然后只处理捕获的两个异常。这在 IL 中实现的方式是“过滤器”，它在 VB.Net 中可用。

为了让它在 C# 中工作，我们需要一个具有正确“异常”基本类型的临时变量。为了控制代码的流动，我们可以添加一些分支。开始：

```
 Exception ex;
    try
    {
        throw new ArgumentException(); // for demo purposes; won't be caught.
        goto noCatch;
    }
    catch (ArgumentOutOfRangeException e) {
        ex = e;
    }
    catch (IndexOutOfRangeException e) {
        ex = e;
    }

    Console.WriteLine("Handle the exception 'ex' here :-)");
    // throw ex ?

noCatch:
    Console.WriteLine("We're done with the exception handling."); 
```

这样做的明显缺点是我们无法正确重新投掷，而且 - 老实说 - 这是一个非常丑陋的解决方案。可以通过执行分支消除来稍微修复丑陋，这使解决方案稍微好一些：

```
Exception ex = null;
try
{
    throw new ArgumentException();
}
catch (ArgumentOutOfRangeException e)
{
    ex = e;
}
catch (IndexOutOfRangeException e)
{
    ex = e;
}
if (ex != null)
{
    Console.WriteLine("Handle the exception here :-)");
} 
```

剩下的只是“重新投掷”。为此，我们需要能够在 'catch' 块内执行处理 - 使这项工作的唯一方法是通过捕获 'Exception' 对象。

此时，我们可以添加一个单独的函数，使用重载决议来处理不同类型的异常，或者来处理异常。两者都有缺点。首先，这是使用辅助函数的方法：

```
private static bool Handle(Exception e)
{
    Console.WriteLine("Handle the exception here :-)");
    return true; // false will re-throw;
}

public static void Main()
{
    try
    {
        throw new OutOfMemoryException();
    }
    catch (ArgumentException e)
    {
        if (!Handle(e)) { throw; }
    }
    catch (IndexOutOfRangeException e)
    {
        if (!Handle(e)) { throw; }
    }

    Console.WriteLine("We're done with the exception handling."); 
```

另一个解决方案是捕获异常对象并相应地处理它。根据上面的上下文，最直接的翻译是这样的：

```
try
{
    throw new ArgumentException();
}
catch (Exception e)
{
    Exception ex = (Exception)(e as ArgumentException) ?? (e as IndexOutOfRangeException);
    if (ex != null)
    {
        Console.WriteLine("Handle the exception here :-)");
        // throw ?
    }
    else 
    {
        throw;
    }
} 
```

所以得出结论：

*   如果我们不想重新抛出，我们可能会考虑捕获正确的异常，并将它们存储在临时文件中。
*   如果处理程序很简单，并且我们想重用代码，最好的解决方案可能是引入辅助函数。
*   如果我们想重新抛出，我们别无选择，只能将代码放在“异常”捕获处理程序中，这将破坏 FxCop 和调试器的未捕获异常。

* * *

## 回答 #21

> 赞同：8
> 
> 时间：2017-11-15T20:27:32.940

这是每个 C# 开发人员最终都会面临的经典问题。

让我把你的问题分成2个问题。首先，

**我可以一次捕获多个异常吗？**

简而言之，没有。

这就引出了下一个问题，

**鉴于我无法在同一个 catch() 块中捕获多个异常类型，如何避免编写重复代码？**

鉴于您的特定样本，回退值构建起来很便宜，我喜欢按照以下步骤操作：

1.  将 WebId 初始化为备用值。
2.  在临时变量中构造一个新的 Guid。
3.  将 WebId 设置为完全构造的临时变量。将此作为 try{} 块的最终语句。

所以代码看起来像：

```
try
{
    WebId = Guid.Empty;
    Guid newGuid = new Guid(queryString["web"]);
    // More initialization code goes here like 
    // newGuid.x = y;
    WebId = newGuid;
}
catch (FormatException) {}
catch (OverflowException) {} 
```

如果抛出任何异常，则 WebId 永远不会设置为半构造值，并保持为 Guid.Empty。

如果构建后备值很昂贵，而重置值要便宜得多，那么我会将重置代码移动到它自己的函数中：

```
try
{
    WebId = new Guid(queryString["web"]);
    // More initialization code goes here.
}
catch (FormatException) {
    Reset(WebId);
}
catch (OverflowException) {
    Reset(WebId);
} 
```

* * *

## 回答 #22

> 赞同：7
> 
> 时间：2008-09-25T20:56:37.670

请注意，我确实找到了一种方法，但这看起来更像是[The Daily WTF 的](https://en.wikipedia.org/wiki/The_Daily_WTF)材料：

```
catch (Exception ex)
{
    switch (ex.GetType().Name)
    {
        case "System.FormatException":
        case "System.OverflowException":
            WebId = Guid.Empty;
            break;
        default:
            throw;
    }
} 
```

* * *

## 回答 #23

> 赞同：6
> 
> 时间：2016-09-22T11:40:40.880

所以你在每个异常开关中都重复了很多代码？听起来像提取方法将是上帝的想法，不是吗？

所以你的代码归结为：

```
MyClass instance;
try { instance = ... }
catch(Exception1 e) { Reset(instance); }
catch(Exception2 e) { Reset(instance); }
catch(Exception) { throw; }

void Reset(MyClass instance) { /* reset the state of the instance */ } 
```

我想知道为什么没有人注意到代码重复。

从 C#6 开始，您还拥有其他人已经提到的[异常过滤器。](https://stackoverflow.com/questions/4268223/c-sharp-exception-filter)因此，您可以将上面的代码修改为：

```
try { ... }
catch(Exception e) when(e is Exception1 || e is Exception2)
{ 
    Reset(instance); 
} 
```

* * *

## 回答 #24

> 赞同：5
> 
> 时间：2017-04-16T15:51:04.873

想在这个已经很长的线程中添加我的简短回答。没有提到的是 catch 语句的优先顺序，更具体地说，您需要了解您尝试捕获的每种异常类型的范围。

例如，如果您使用“catch-all”异常作为**Exception**它将在所有其他 catch 语句之前，并且您显然会得到编译器错误但是如果您颠倒顺序，您可以链接您的 catch 语句（我认为有点反模式) 您可以将 catch-all **Exception**类型放在底部，这将捕获任何不适合您的 try..catch 块中更高级别的异常：

```
 try
            {
                // do some work here
            }
            catch (WebException ex)
            {
                // catch a web excpetion
            }
            catch (ArgumentException ex)
            {
                // do some stuff
            }
            catch (Exception ex)
            {
                // you should really surface your errors but this is for example only
                throw new Exception("An error occurred: " + ex.Message);
            } 
```

我强烈建议人们查看此 MSDN 文档：

[异常层次结构](https://msdn.microsoft.com/en-us/library/z4c5tckx.aspx)

* * *

## 回答 #25

> 赞同：4
> 
> 时间：2018-01-23T14:02:59.597

也许尝试保持您的代码简单，例如将公共代码放在一个方法中，就像您在代码的任何其他部分中所做的那样，而不是在 catch 子句中？

例如：

```
try
{
    // ...
}
catch (FormatException)
{
    DoSomething();
}
catch (OverflowException)
{
    DoSomething();
}

// ...

private void DoSomething()
{
    // ...
} 
```

我会怎么做，试图找到*简单而美丽*的模式

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2018-12-07T15:14:45.373

这里值得一提。您可以响应多种组合（异常错误和异常消息）。

我在尝试在数据网格中转换控件对象时遇到了一个用例场景，内容为 TextBox、TextBlock 或 CheckBox。在这种情况下，返回的异常是相同的，但消息不同。

```
try
{
 //do something
}
catch (Exception ex) when (ex.Message.Equals("the_error_message1_here"))
{
//do whatever you like
} 
catch (Exception ex) when (ex.Message.Equals("the_error_message2_here"))
{
//do whatever you like
} 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2019-05-27T14:18:24.817

我想建议最短的答案（另一种**功能风格**）：

```
 Catch<FormatException, OverflowException>(() =>
            {
                WebId = new Guid(queryString["web"]);
            },
            exception =>
            {
                WebId = Guid.Empty;
            }); 
```

为此，您需要创建几个“Catch”方法重载，类似于 System.Action：

```
 [DebuggerNonUserCode]
    public static void Catch<TException1, TException2>(Action tryBlock,
        Action<Exception> catchBlock)
    {
        CatchMany(tryBlock, catchBlock, typeof(TException1), typeof(TException2));
    }

    [DebuggerNonUserCode]
    public static void Catch<TException1, TException2, TException3>(Action tryBlock,
        Action<Exception> catchBlock)
    {
        CatchMany(tryBlock, catchBlock, typeof(TException1), typeof(TException2), typeof(TException3));
    } 
```

依此类推。但是你需要做一次，你可以在你的所有项目中使用它（或者，如果你创建了一个 nuget 包，我们也可以使用它）。

和 CatchMany 实现：

```
 [DebuggerNonUserCode]
    public static void CatchMany(Action tryBlock, Action<Exception> catchBlock,
        params Type[] exceptionTypes)
    {
        try
        {
            tryBlock();
        }
        catch (Exception exception)
        {
            if (exceptionTypes.Contains(exception.GetType())) catchBlock(exception);
            else throw;
        }
    } 
```

ps 为了代码简单，我没有进行空检查，考虑添加参数验证。

ps2 如果要从 catch 中返回一个值，则需要执行相同的 Catch 方法，但在参数中使用 return 和 Func 而不是 Action。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2021-11-21T03:11:07.633

```
 try
           {
                WebId = new Guid(queryString["web"]);
           }
           catch (Exception ex)
           {
                string ExpTyp = ex.GetType().Name;
                if (ExpTyp == "FormatException")
                {
                     WebId = Guid.Empty;
                }
                else if (ExpTyp == "OverflowException")
                {
                     WebId = Guid.Empty;
                }
           } 
```

* * *

## 回答 #29

> 赞同：-26
> 
> 时间：2015-05-20T07:48:59.637

在 c# 6.0 中，Exception Filters 是对异常处理的改进

```
try
{
    DoSomeHttpRequest();
}
catch (System.Web.HttpException e)
{
    switch (e.GetHttpCode())
    {
        case 400:
            WriteLine("Bad Request");
        case 500:
            WriteLine("Internal Server Error");
        default:
            WriteLine("Generic Error");
    }
} 
```

# c++ - 防止 Visual Studio 创建浏览信息 (.ncb) 文件

> ID：136050
> 
> 赞同：5
> 
> 时间：2008-09-25T20:58:07.167
> 
> 标签：c++, visual-studio, visual-studio-2008

有没有办法防止 VS2008 为 C++ 项目创建浏览信息文件。
我很少使用类浏览器，每次构建后重新创建它所花费的时间是不值得的，特别是因为即使构建失败它也会运行。

编辑 - 去声明/定义也需要它

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-25T21:00:15.587

在项目属性中，您将在以下位置找到浏览信息：

配置属性 -> C/C++ -> 浏览信息

告诉它不要生成浏览信息。它的全部用途是在代码组件之间快速浏览（例如使用“转到定义”）等等。我个人喜欢能够在组件之间快速跳转，但如果它给你的编译增加了不必要的时间，不要担心把它关掉。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-12-15T22:31:59.717

这也有一个注册表项：`[HKEY_CURRENT_USER\Software\Microsoft\VisualStudio\9.0\Languages\Language Services\C/C++]`

智能感知开启

```
"IntellisenseOptions"=dword:00000000 
```

智能感知关闭

```
"IntellisenseOptions"=dword:00000007 
```

Intellisense 开启 - 无后台更新

```
"IntellisenseOptions"=dword:00000005 
```

更多标志可用，您也可以[通过宏控制 Intellisense](http://blogs.msdn.com/vcblog/archive/2007/11/19/controlling-intellisense-through-macros.aspx)。

```
ISENSE_NORMAL = 0       'normal (Intellisense On)
ISENSE_NOBG = &H1       'no bg parsing (Intellisense Updating Off - although NCB file will be opened r/w and repersisted at shutdown)
ISENSE_NOQUERY = &H2    'no queries (don't run any ISense queries)
ISENSE_NCBRO = &H4      'no saving of NCB (must be set before opening NCB, doesn't affect updating or queries, just persisting of NCB)
ISENSE_OFF = &H7 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-25T21:06:29.797

尝试创建一个与 ncb 文件同名的文件夹（当然，您必须删除该文件）。我过去使用这个技巧来防止智能感知锁定 VS2005。不过，你会失去智能。

# java - 如何格式化电子邮件中的字符串以便 Outlook 打印换行符？

> ID：136052
> 
> 赞同：78
> 
> 时间：2008-09-25T20:58:24.700
> 
> 标签：java, email, outlook, newline, line-breaks

我正在尝试用 Java 发送一封电子邮件，但是当我在 Outlook 中阅读电子邮件的正文时，它消除了我所有的换行符。我将 \n 放在行尾，但除此之外我还需要做些什么特别的事情吗？接收方将始终使用 Outlook。

我在 microsoft.com 上发现了一个页面，上面说 Outlook 中有一个“删除换行符”“功能”，这是否意味着除了取消选中该设置之外没有其他解决方案可以解决这个问题？

谢谢

* * *

## 回答 #1

> 赞同：203
> 
> 时间：2009-10-28T16:59:45.980

我今天一直在和这个作斗争。我们将删除多余换行符的行为称为“继续”。一点实验发现以下行为：

*   每条消息都以继续关闭开始。
*   长度少于 40 个字符的行不会触发继续，但如果打开了继续，它们的换行符将被删除。
*   行 40 个字符或更长的行打开继续。它保持打开状态，直到发生事件以将其关闭。
*   以句点、问号、感叹号或冒号结尾的行会关闭续行。（Outlook 假设它是一个句子的结尾？）
*   关闭续行的行将以换行符开始，但如果它们超过 40 个字符，则会重新打开续行。
*   以制表符开头或结尾的行将关闭续行。
*   以 2 个或更多空格开头的行将关闭延续。
*   以 3 个或更多空格结尾的行将关闭延续。

请注意，我在 Outlook 2007 中尝试了所有这些。YMMV。
因此，如果可能，所有项目符号项都以句终止标点符号、制表符甚至三个空格结束。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-09-25T21:01:54.647

您需要`\r\n`用作解决方案。

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2011-02-17T08:54:35.600

在换行符 (CRLF) 之前附加一个（或两个？）制表符 (\t) 时，您可以在 Outlook 中强制换行。

例子：

```
This is my heading in the mail\t\n
Just here Outlook is forced to begin a new line. 
```

它似乎适用于 Outlook 2010。请测试这是否适用于其他版本。

另请参阅[Outlook 自动清理我的换行符并搞砸我的电子邮件格式](https://stackoverflow.com/questions/247546/outlook-autocleaning-my-line-breaks-and-screwing-up-my-email-format/436114#436114)

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2009-01-30T23:29:22.373

Microsoft Outlook 2002 及更高版本默认从文本消息中删除“额外的换行符” [(kb308319)](http://support.microsoft.com/kb/308319)。也就是说，Outlook 似乎只是忽略了文本消息中的换行和/或回车序列，将所有行放在一起。

如果您尝试编写将自动生成电子邮件以供使用 Outlook 的人阅读的代码，这可能会导致问题。

例如，为了清楚起见，假设您想在单独的行中提供单独的信息，如下所示：

交易需注意！
发布日期：1/30/2009
金额：12,222.06 美元
TransID：8gk288g229g2kg89 邮政编码
：91543

您的 Outlook 收件人将看到所有信息拼凑在一起，如下所示：

交易需注意！发布日期：1/30/2009 金额：12,222.06 美元 TransID：8gk288g229g2kg89 邮政编码：91543

似乎没有一个简单的解决方案。替代方案是：

1.  您可以在每行之间提供**两组**换行符。这确实会阻止 Outlook 将这些行合并到一行，但它会在每行之间显示一个额外的空白行（产生相反的问题）。“提供两组换行符”是指您应该使用“\r\n\r\n”或“\r\r”或“\n\n”，而不是“\r\n”或“\n \r”。
2.  您可以在电子邮件正文的每行开头提供两个空格。这样可以避免在每行之间引入额外的空白行。但是，如果您的消息中的每一行都相当短，则此方法效果最好，因为用户可能正在一个非常窄的 Outlook 窗口中预览文本，该窗口将每行的末尾环绕到下一行的第一个位置，而不会与您的两个空格缩进的行对齐。这种策略已被用于一些[时事通讯](http://www.masternewmedia.org/newsletter_publishing/newsletter_formatting/remove_line_breaks_issue_Microsoft_Outlook_2003_when_publishing_text_newsletters_20051217.htm "通讯")。
3.  您可以放弃使用纯文本格式，而使用 html 格式。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2010-12-14T13:35:58.827

我有同样的问题，并找到了解决方案。试试这个： `%0D%0A`添加换行符。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2014-09-21T04:49:49.253

我使用了 html 换行符而不是 "\n" 。它工作得很好。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2016-04-12T15:03:59.223

在 Outlook 2010 上添加 "\t\r\n" （TAB 为 \t）而不是 "\r\n" 对我有用。注意：在每行末尾添加 3 个空格也可以做同样的事情，但这看起来像是编程技巧！

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-09-26T15:28:04.493

诀窍是使用`encodeURIComponent()`js 的功能：

```
var formattedBody = "FirstLine \n Second Line \n Third Line";
var mailToLink = "mailto:x@y.com?body=" + encodeURIComponent(formattedBody); 
```

结果：

```
FirstLine
SecondLine
ThirdLine 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-06-02T03:20:58.670

对于 Outlook 2010 及更高版本，请使用***\t\n***而不是 \r\n。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-25T20:59:03.497

尝试`\r\c`代替`\n`.

**编辑：**我认为@Robert Wilkinson 是对的。`\r\n`. 记忆不再像以前那样了。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-25T21:03:03.333

这`\n`在很大程度上对我们有用，但 Outlook 有时会自行删除您所说的换行符。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-25T21:15:03.867

您需要发送 HTML 电子邮件。在电子邮件中使用`<br />`s，您将始终有换行符。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2011-05-17T09:22:14.447

如果您可以添加“。” 每行末尾的（点）字符，这似乎可以防止 Outlook 破坏文本格式。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-08-26T20:09:52.453

我也遇到了纯/文本邮件类型的问题。早些时候，我使用了“\n\n”，但有两个换行符。然后，我使用了 "\t\n" 并且它起作用了。我`StringBuffer`在java中使用来附加内容。
内容打印在 Outlook 2010 邮件的下一行。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-09-22T15:12:05.900

我一直在为上述所有解决方案苦苦挣扎，但在这里没有任何帮助，因为我在我的电子邮件库中使用了字符串变量（来自 JTextPane 的纯文本）和“text/html”格式。

所以，这个问题的解决方案是使用“text/plain”，而不是“text/html”，根本不需要替换返回字符：

```
MimeBodyPart messageBodyPart = new MimeBodyPart();
messageBodyPart.setContent(message, "text/plain"); 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-09-24T15:48:36.267

将文本放入`<pre>`标签中，outlook 将正确格式化和显示文本。

我在 HTML Body 的 CSS 内联中定义了它，例如：

CSS：

```
pre {
 font-family: Verdana, Geneva, sans-serif;
} 
```

我将字体系列定义为必须设置字体。

HTML：

```
<td width="70%"><pre>Entry Date/Time:       2013-09-19 17:06:25
Entered By:     Chris

worklog mania

____________________________________________________________________________________________________

Entry Date/Time:        2013-09-19 17:05:42
Entered By:     Chris

this is a new Worklog Entry</pre></td> 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2013-10-26T13:06:52.353

因为它是一个查询，所以只有百分比转义字符有效，这意味着 %0A 给你一个换行符。例如，

```
&lt;a href=&quot;mailto:someone@gmail.com?Subject=TEST&amp;amp;body=Hi there,%0A%0AHow are you?%0A%0AThanks&quot;&gt;email to me&lt;/a&gt; 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2014-11-13T16:50:54.097

我也遇到了纯/文本邮件类型的问题。Form Feed `\f`对我有用。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2015-09-15T17:56:29.963

有时您必须输入 \r\n 两次才能强制 Outlook 中断。

这将添加一个空行，但所有行都会中断。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2016-12-26T11:35:36.340

**\r\n**在您将正文类型设置为文本之前将不起作用。

```
message.setBody(MessageBody.getMessageBodyFromText(msg));
BodyType type = BodyType.Text;
message.getBody().setBodyType(type); 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2020-06-11T16:47:11.390

我遇到了同样的问题，这是解决它的代码：

```
\t\n - for new line in Email service JavaMailSender

String mailMessage = JSONObject.toJSONString("Your message").replace(",", "\t\n").trim(); 
```

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2009-12-01T11:57:25.343

试试这个：

```
message.setContent(new String(body.getBytes(), "iso-8859-1"),
                    "text/html; charset=\"iso-8859-1\""); 
```

问候， Mohammad Rasool Javeed

* * *

## 回答 #23

> 赞同：-1
> 
> 时间：2010-12-30T06:41:40.457

**在我的申请中解决**

在我的应用程序中，我试图发送一封电子邮件，其邮件正文由用户在文本区域中键入。发送邮件时，outlook 会自动删除用户输入的换行符。

例如，如果用户输入
Yadav
Mahesh

Outlook 将其显示为
YadavMahesh

*解决方案：*我将换行符“\r\n”更改为“\par”（记得在 RTF 代码“\par”的末尾打空格）并恢复换行符。

干杯，
马赫什

* * *

## 回答 #24

> 赞同：-1
> 
> 时间：2012-04-30T11:19:45.657

我有一个很好的解决方案，我尝试过，它只是在行尾添加 Char(13)，如下例所示：

```
Dim S As String
 S = "Some Text" & Chr(13)
 S = S + "Some Text" & Chr(13) 
```

* * *

## 回答 #25

> 赞同：-1
> 
> 时间：2013-04-09T04:05:49.363

如果消息是文本/普通使用，\r\n 应该可以工作；如果消息类型是 text\html，请使用`< p/>`

* * *

## 回答 #26

> 赞同：-1
> 
> 时间：2015-10-22T13:29:06.623

如果需要使用没有 html 编码的格式化文本来完成工作。它可以通过以下场景轻松实现，即[动态创建 div 元素](https://stackoverflow.com/questions/1219860/html-encoding-in-javascript-jquery)并使用`<pre></pre>`html 元素保持格式。

```
var email_body = htmlEncode($("#Body").val());

 function htmlEncode(value) {
    return "<pre>" + $('<div/>').text(value).html() + "</pre>";
} 
```

* * *

## 回答 #27

> 赞同：-1
> 
> 时间：2018-06-25T20:10:32.090

不确定上面是否提到过，但 Outlook 有一个名为“删除纯文本消息中的额外换行符”的复选框设置，默认情况下处于选中状态。对于不同版本的 Outlook，它位于不同的位置，但对于 2010，请转到“文件”选项卡。选择“选项 => 邮件” 向下滚动到“邮件格式” 取消选中该复选框。

# security - 如何检查文件是否有win2003“阻止”选项

> ID：136065
> 
> 赞同：0
> 
> 时间：2008-09-25T20:59:18.507
> 
> 标签：security, windows-server-2003, nsis

如果我的安装程序的首选项中有阻止选项，我如何从我的 NSIS 安装程序中检查。

即使您知道在没有 NSIS 的情况下进行检查的方法，也请告诉我，以便我自己编写脚本。

请参阅此问题以了解[有关此已阻止选项的更多信息](https://stackoverflow.com/questions/135600/reproducing-the-blocked-exe-unblock-option-in-file-properties-in-windows-2003)。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-25T21:00:25.693

在此处使用[Hitscan 的相关答案](https://stackoverflow.com/questions/135600/reproducing-the-blocked-exe-unblock-option-in-file-properties-in-windows-2003)...

您可以通过检查备用数据流 (ADS) 的存在来检查 EXE 是否具有此属性：

```
file.exe:Zone.Identifier 
```

# perl - 如何分析 Perl Web 应用程序？

> ID：136067
> 
> 赞同：16
> 
> 时间：2008-09-25T20:59:29.020
> 
> 标签：perl, profiling

我正在开发一个使用 Perl 的网络应用程序，我需要研究加速应用程序的某些部分。

我想我会开始分析我希望调查的部分的特定调用。我已经对分析 Perl 代码进行了一些搜索，但不幸的是，我发现的大部分内容都表明我应该从命令行运行我的 perl 代码`-d:DProf myapp`。这对我来说不太适用，因为我的代码位于 Web 应用程序中。我确实找到了一种让分析与 apache 一起工作的方法，但不幸的是，从分析器返回的“最常用”模块都是 CPAN 模块——Class::xyz 等等等等。没有太大帮助。

除了我将“计时器”代码注入我希望分析的方法以仅针对这些方法之外，还有没有人知道一个好方法？我曾想过编写一个测试脚本并对其进行分析，但由于我正在处理的代码的性质，这需要比我希望做的更多的工作。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-25T21:07:57.937

您是否尝试过可以在 Apache 下工作的[Devel::NYTProf](http://search.cpan.org/dist/Devel-NYTProf)（比 Devel::DProf 好得多）？您使用的是哪个网络服务器？这是一个普通的 CGI 脚本，一个 mod_perl 的东西，还是别的什么？

如果你在做数据库的事情，[DBI::Profile](http://www.metacpan.org/module/DBI::Profile)可以对你的查询进行基准测试，这是在另一个程序中进行的工作。

然而，真正的诀窍是组织代码，以便您可以进行全方位的测试和分析，而不必在最后将它们放在一起以发现某些东西很慢。这在短期内对灭火没有多大帮助，但从长远来看，它确实可以防止事情变成火灾。还有各种方法可以伪造网络服务器环境等等，但这是一个不同的问题。:)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-25T21:50:23.780

如果您正在使用 CGI.pm，您可以在命令行上将参数传递给您的 perl 脚本，CGI.pm 将把它们解释为好像它们是通过 HTTP 传递的参数一样。因此，如果您正在调试，例如

`[http://example.com/scripts/example.pl?action=browse&search=grommet&restrict=blah](http://example.com/scripts/example.pl?action=browse&search=grommet&restrict=blah)`

然后你可以从命令行调用，例如

`perl -d:NYTProf *documentroot*/scripts/example.pl 'action=browse&search=grommet&restrict=blah'`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T21:01:50.637

如果您真的想在内部计时，可以使用带有**:hireswallclock选项的**[**Benchmark**](http://perldoc.perl.org/Benchmark.html)核心模块。但实际上，您应该能够从命令行进行分析。您可能必须编写测试脚本来模拟 CGI 请求的某些部分，但 DProf在寻找性能瓶颈时 **非常有用。**

 ****特别是，查找您的代码调用 CPAN 模块代码的位置。您可能在循环中执行此操作的次数远远超过必要的次数，因此当花费在 CPAN 模块上的时间时，重构您的代码可以解决问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T01:52:40.267

我意识到此时它有点晚了，但这就是为什么使用[CGI::Application](http://search.cpan.org/dist/CGI-Application)或其他架构很好的原因之一，在这种架构中，Web 应用程序只是一小段面向 Web 的代码，它可以利用您为实现实际功能而编写的一堆模块。使用这样的设计可以非常简单地从命令行单独或集体地分析（或简单地测试）任何模块，而不必担心 Web 方面。

# python - Python Web 开发 - 有或没有框架

> ID：136069
> 
> 赞同：19
> 
> 时间：2008-09-25T20:59:49.440
> 
> 标签：python, frameworks

我计划将 PHP 应用程序移植到 Python。该应用程序主要是关于数据收集和处理。主应用程序作为独立的命令行应用程序运行。该应用程序有一个 Web 界面，基本上是一个非常轻量级的报告界面。

我没有在 PHP 版本中使用框架，但是作为 Python 的新手，我想知道使用 Django 之类的东西是否有利，或者至少使用 Genshi。需要注意的是，我不希望我的应用程序分发被我需要与应用程序一起分发的框架部分所淹没。

在这种情况下，仅在 Python 中使用 cgi 导入是最好的方法吗？我倾向于认为框架开销太大，但也许我并没有以非常“python”的方式思考它们。在这种情况下，您有什么建议？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-25T21:14:33.413

命令行 Python，IMO，绝对是第一位的。让它发挥作用，因为这是你正在做的事情的核心。

问题是从命令行应用程序使用 Web 框架的 ORM 并不明显。Django 提供了从命令行应用程序使用 ORM 的具体说明。起初这些很烦人，但我认为从长远来看它们是救生员。我大量使用它来上传大量客户提供的文件。

不要使用裸 CGI。这不是不可能的，但是太多的事情可能会出错，而且它们都已经被框架解决了。为什么要重新发明一些东西？只需使用别人的代码。

框架涉及学习，但没有真正的“开销”。他们并不慢。它们是您不必编写或调试的代码。

1.  学习一些 Python。

2.  做[Django](http://docs.djangoproject.com/en/dev/)教程。

3.  开始构建 Web 应用程序。

    一种。启动一个 Django 项目。在该项目中构建一个小型应用程序。

    湾。使用 Django ORM 构建新模型。为模型创建一个 Django 单元测试。确保它有效。您将能够使用默认的管理页面并进行大量操作。只是还没有建立*整个*网站。

4.  让您的命令行应用程序使用 Django ORM 工作。本质上，您必须对设置文件进行微调才能使该应用程序正常工作。请参阅[设置/配置](http://docs.djangoproject.com/en/dev/topics/settings/#topics-settings)部分。

5.  一旦你的命令行和默认管理员运行，你就可以完成网络应用程序。

这是框架的黄金法则： **它是您不必编写、调试或维护的代码。** 使用它们。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-25T23:17:24.930

[您可能会考虑使用web.py](http://webpy.org/)之类的东西，它易于分发（因为它很小），并且您的其他工具也很容易适应它，因为它不需要您像 Django 那样提交到框架。 .

但是请注意，它不是 Python 社区中最受喜爱的框架，但它可能正是适合你的东西。您也可以查看[web2py](http://mdp.cti.depaul.edu/)，但我对此知之甚少。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-25T21:07:44.507

取决于项目的大小。如果您以前只有几个调用独立应用程序的 php 脚本，那么我可能会选择 cgi-app。

如果您使用数据库、url 重写、模板、用户管理等，那么使用框架是一个好主意。

当然，在移植之前，请考虑是否值得仅仅切换语言，或者是否需要特定的 Python 功能。

祝你好运！

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-25T21:22:30.477

[我最近使用web.py](http://webpy.org/)将 PHP 应用程序移植到 Python 。随着框架的发展，它非常轻量级，依赖最少，而且它往往不会妨碍您，因此它可能是您正在寻找的折衷方案。

不过，这一切都取决于您的初始应用程序，因为对于大型应用程序，拥有一个功能齐全的框架来处理管道的优势往往超过了必须拖拽所有框架代码所涉及的劣势。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-25T22:47:33.830

Django 使快速创建网站成为可能，这是肯定的。你不需要成为 Python 大师就可以使用它，而且由于它的设计非常 Pythonic，并且没有真正的“魔法”，它将帮助你一路学习 Python。

从示例开始，查看来自 TwiD 的一些 django 截屏视频，您就可以开始了。

慢慢开始，调整管理员，并通过 shell 使用它是开始的方式。一旦你掌握了 ORM 并了解了事情是如何工作的，就开始构建真正的东西！

该框架不会引起任何性能问题，就像 S. Lott 所说的那样，它是您不必维护的代码，这是最好的一种。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-26T11:31:45.990

去找一个框架。如果您不使用会话处理之类的基本内容，那将是一场噩梦，因为 Python 不像 PHP 那样专门用于网络。

如果你觉得 django 太多了，你可以尝试一个更轻的，比如很小但仍然很方便的 web.py。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-09-17T02:47:39.630

为了皮特的爱，使用框架！从字面上看，那里有几十个框架，从cherrypy到django到albatross到......嗯......你的名字。事实上，当人们抱怨 Rails 的流行时，大量的 Web 框架就是他们所指的。

Python Web 开发社区四分五裂，没有一个声音。但这完全是另一个话题！关键是，有一些“网络工具包”（例如 albatross）相当轻巧但功能强大，足以让您度过一天（例如，自动验证机器人没有做简单的表单提交假，或帮助保持 MVC 清洁）。

如果你想要一些不是“太多框架”的东西，请看这里：

[http://wiki.python.org/moin/WebFrameworks](http://wiki.python.org/moin/WebFrameworks)

查看“提供模板的基本框架”。它们都很轻巧，可以做所有“不要重新发明轮子”的东西，而不会强迫你使用 Mac 卡车。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-25T21:11:08.523

这取决于您要分发应用程序的方式。
如果它只在内部使用，请选择 django。和它一起工作很愉快。但是，django 在分发任务方面确实做得不够。django-applications 设置起来很痛苦。

# python - 静态方法和类方法的区别

> ID：136097
> 
> 赞同：4223
> 
> 时间：2008-09-25T21:01:57.843
> 
> 标签：python, oop, methods, python-decorators

[`@staticmethod`](http://docs.python.org/library/functions.html#staticmethod)用 装饰的函数和用 装饰的函数有什么区别[`@classmethod`](http://docs.python.org/library/functions.html#classmethod)？

* * *

## 回答 #1

> 赞同：3616
> 
> 时间：2009-11-03T19:13:48.353

也许一些示例代码会有所帮助：注意`foo`,`class_foo`和的调用签名的区别`static_foo`：

```
class A(object):
    def foo(self, x):
        print(f"executing foo({self}, {x})")

    @classmethod
    def class_foo(cls, x):
        print(f"executing class_foo({cls}, {x})")

    @staticmethod
    def static_foo(x):
        print(f"executing static_foo({x})")

a = A() 
```

下面是对象实例调用方法的常用方式。对象实例 ，`a`作为第一个参数隐式传递。

```
a.foo(1)
# executing foo(<__main__.A object at 0xb7dbef0c>, 1) 
```

* * *

**使用 classmethods**，对象实例的类作为第一个参数而不是`self`.

```
a.class_foo(1)
# executing class_foo(<class '__main__.A'>, 1) 
```

您也可以`class_foo`使用类调用。事实上，如果你将某个东西定义为类方法，那可能是因为你打算从类中调用它，而不是从类实例中调用它。`A.foo(1)`会引发 TypeError，但`A.class_foo(1)`工作得很好：

```
A.class_foo(1)
# executing class_foo(<class '__main__.A'>, 1) 
```

人们发现类方法的一种用途是创建[可继承的替代构造函数](https://stackoverflow.com/a/1950927/190597)。

* * *

**使用 staticmethods**，`self`（对象实例）和 `cls`（类）都不会作为第一个参数隐式传递。它们的行为类似于普通函数，只是您可以从实例或类中调用它们：

```
a.static_foo(1)
# executing static_foo(1)

A.static_foo('hi')
# executing static_foo(hi) 
```

静态方法用于对与类与类有某种逻辑联系的函数进行分组。

* * *

`foo`只是一个函数，但是当您调用时，您`a.foo`不仅获得了该函数，还获得了该函数的“部分应用”版本，其中对象实例`a`绑定为该函数的第一个参数。`foo`需要 2 个参数，而`a.foo`只需要 1 个参数。

`a`必然`foo`。这就是下文“绑定”一词的含义：

```
print(a.foo)
# <bound method A.foo of <__main__.A object at 0xb7d52f0c>> 
```

with `a.class_foo`,`a`不是绑定到`class_foo`，而是类`A`是绑定到的`class_foo`。

```
print(a.class_foo)
# <bound method type.class_foo of <class '__main__.A'>> 
```

在这里，使用静态方法，即使它是一个方法，`a.static_foo`也只是返回一个没有绑定参数的好 'ole 函数。`static_foo`需要 1 个参数，也 `a.static_foo`需要 1 个参数。

```
print(a.static_foo)
# <function static_foo at 0xb7d479cc> 
```

当然，当您改为`static_foo`与班级通话时，也会发生同样的事情`A`。

```
print(A.static_foo)
# <function static_foo at 0xb7d479cc> 
```

* * *

## 回答 #2

> 赞同：896
> 
> 时间：2008-09-25T21:05:53.293

**静态**方法是一种对调用它的类或实例一无所知的方法。它只获取传递的参数，没有隐式的第一个参数。它在 Python 中基本上没用——你可以只使用模块函数而不是静态方法。

另一方面，**classmethod**是一个方法，它通过调用它的类或调用它的实例的类作为第一个参数。当您希望该方法成为该类的工厂时，这很有用：因为它获取调用它的实际类作为第一个参数，您始终可以实例化正确的类，即使涉及子类也是如此。例如，观察`dict.fromkeys()`类方法在子类上调用时如何返回子类的实例：

```
>>> class DictSubclass(dict):
...     def __repr__(self):
...         return "DictSubclass"
... 
>>> dict.fromkeys("abc")
{'a': None, 'c': None, 'b': None}
>>> DictSubclass.fromkeys("abc")
DictSubclass
>>> 
```

* * *

## 回答 #3

> 赞同：181
> 
> 时间：2008-09-25T21:07:06.147

基本上`@classmethod`创建一个方法，其第一个参数是调用它的类（而不是类实例），`@staticmethod`没有任何隐式参数。

* * *

## 回答 #4

> 赞同：122
> 
> 时间：2009-11-03T19:23:19.520

**官方python文档：**

[@classmethod](http://docs.python.org/library/functions.html#classmethod)

> 类方法接收类作为隐式第一个参数，就像实例方法接收实例一样。要声明一个类方法，请使用以下习惯用法：
> 
> ```
> class C:
>     @classmethod
>     def f(cls, arg1, arg2, ...): ... 
> ```
> 
> `@classmethod`表单是一个函数 [*装饰器*](http://docs.python.org/2/glossary.html#term-decorator)——详见函数定义中[*函数定义*](http://docs.python.org/2/reference/compound_stmts.html#function)的描述。
> 
> 它可以在类（例如`C.f()`）或实例（例如`C().f()`）上调用。该实例被忽略，除了它的类。如果为派生类调用类方法，则派生类对象作为隐含的第一个参数传递。
> 
> 类方法不同于 C++ 或 Java 静态方法。如果您想要这些，请参阅[`staticmethod()`](http://docs.python.org/2/library/functions.html#staticmethod)本节。

[@静态方法](http://docs.python.org/library/functions.html#staticmethod)

> 静态方法不接收隐式的第一个参数。要声明静态方法，请使用以下习惯用法：
> 
> ```
> class C:
>     @staticmethod
>     def f(arg1, arg2, ...): ... 
> ```
> 
> `@staticmethod`表单是一个函数 [*装饰器*](http://docs.python.org/2/glossary.html#term-decorator)——详见函数定义中[*函数定义*](http://docs.python.org/2/reference/compound_stmts.html#function)的描述。
> 
> 它可以在类（例如`C.f()`）或实例（例如`C().f()`）上调用。该实例被忽略，除了它的类。
> 
> Python 中的静态方法类似于 Java 或 C++ 中的静态方法。有关更高级的概念，请参阅 [`classmethod()`](http://docs.python.org/2/library/functions.html#classmethod)本节。

* * *

## 回答 #5

> 赞同：101
> 
> 时间：2016-04-22T15:40:20.397

要决定是使用[@staticmethod](https://docs.python.org/3/library/functions.html?highlight=staticmethod#staticmethod)还是[@classmethod](https://docs.python.org/3.5/library/functions.html?highlight=classmethod#classmethod)，您必须查看方法内部。**如果您的方法访问类中的其他变量/方法，请使用 @classmethod**。另一方面，如果您的方法不涉及类的任何其他部分，则使用@staticmethod。

```
class Apple:

    _counter = 0

    @staticmethod
    def about_apple():
        print('Apple is good for you.')

        # note you can still access other member of the class
        # but you have to use the class instance 
        # which is not very nice, because you have repeat yourself
        # 
        # For example:
        # @staticmethod
        #    print('Number of apples have been juiced: %s' % Apple._counter)
        #
        # @classmethod
        #    print('Number of apples have been juiced: %s' % cls._counter)
        #
        #    @classmethod is especially useful when you move your function to another class,
        #       you don't have to rename the referenced class 

    @classmethod
    def make_apple_juice(cls, number_of_apples):
        print('Making juice:')
        for i in range(number_of_apples):
            cls._juice_this(i)

    @classmethod
    def _juice_this(cls, apple):
        print('Juicing apple %d...' % apple)
        cls._counter += 1 
```

* * *

## 回答 #6

> 赞同：95
> 
> 时间：2009-11-03T19:02:23.270

[这](http://rapd.wordpress.com/2008/07/02/python-staticmethod-vs-classmethod/)是关于这个问题的简短文章

> @staticmethod 函数只不过是在类中定义的函数。它可以在不先实例化类的情况下调用。它的定义通过继承是不可变的。
> 
> @classmethod 函数也可以在不实例化类的情况下调用，但它的定义遵循子类，而不是父类，通过继承。这是因为@classmethod 函数的第一个参数必须始终是 cls（类）。

* * *

## 回答 #7

> 赞同：66
> 
> 时间：2015-01-23T20:01:20.607

> ## Python中的@staticmethod和@classmethod有什么区别？

您可能已经看过类似以下伪代码的 Python 代码，它演示了各种方法类型的签名并提供了一个文档字符串来解释每种方法：

```
class Foo(object):

    def a_normal_instance_method(self, arg_1, kwarg_2=None):
        '''
        Return a value that is a function of the instance with its
        attributes, and other arguments such as arg_1 and kwarg2
        '''

    @staticmethod
    def a_static_method(arg_0):
        '''
        Return a value that is a function of arg_0\. It does not know the 
        instance or class it is called from.
        '''

    @classmethod
    def a_class_method(cls, arg1):
        '''
        Return a value that is a function of the class and other arguments.
        respects subclassing, it is called with the class it is called from.
        ''' 
```

# 普通实例方法

首先我会解释`a_normal_instance_method`。这被精确地称为“**实例方法**”。当使用实例方法时，它被用作部分函数（与总函数相反，在源代码中查看时为所有值定义），也就是说，在使用时，第一个参数被预定义为具有所有给定属性的对象。它绑定了对象的实例，并且必须从对象的实例中调用它。通常，它将访问实例的各种属性。

例如，这是一个字符串的实例：

```
', ' 
```

如果我们`join`在这个字符串上使用实例方法来加入另一个可迭代对象，那么它显然是实例的函数，除了是可迭代列表的函数之外，`['a', 'b', 'c']`：

```
>>> ', '.join(['a', 'b', 'c'])
'a, b, c' 
```

### 绑定方法

实例方法可以通过点查找来绑定以供以后使用。

例如，这将`str.join`方法绑定到`':'`实例：

```
>>> join_with_colons = ':'.join 
```

稍后我们可以将其用作已经绑定了第一个参数的函数。这样，它就像实例上的部分函数一样工作：

```
>>> join_with_colons('abcde')
'a:b:c:d:e'
>>> join_with_colons(['FF', 'FF', 'FF', 'FF', 'FF', 'FF'])
'FF:FF:FF:FF:FF:FF' 
```

# 静态方法

静态方法不*将*实例作为参数。

它与模块级函数非常相似。

但是，模块级函数必须存在于模块中，并专门导入到其他使用它的地方。

但是，如果它附加到对象上，它也会通过导入和继承方便地跟随对象。

静态方法的一个示例是`str.maketrans`，从`string`Python 3 中的模块移动而来。它使转换表适合 使用`str.translate`。从字符串的实例中使用时看起来确实很傻，如下所示，但是从`string`模块中导入函数相当笨拙，能够从类中调用它很好，如下所示`str.maketrans`

```
# demonstrate same function whether called from instance or not:
>>> ', '.maketrans('ABC', 'abc')
{65: 97, 66: 98, 67: 99}
>>> str.maketrans('ABC', 'abc')
{65: 97, 66: 98, 67: 99} 
```

在 python 2 中，你必须从越来越没用的字符串模块中导入这个函数：

```
>>> import string
>>> 'ABCDEFG'.translate(string.maketrans('ABC', 'abc'))
'abcDEFG' 
```

# 类方法

类方法类似于实例方法，因为它接受一个隐式的第一个参数，但它接受的是类而不是实例。这些通常用作替代构造函数以更好地使用语义，并且它将支持继承。

内置类方法最典型的例子是`dict.fromkeys`. 它被用作 dict 的替代构造函数，（非常适合当您知道您的键是什么并且想要它们的默认值时。）

```
>>> dict.fromkeys(['a', 'b', 'c'])
{'c': None, 'b': None, 'a': None} 
```

当我们继承 dict 时，我们可以使用相同的构造函数，它创建子类的实例。

```
>>> class MyDict(dict): 'A dict subclass, use to demo classmethods'
>>> md = MyDict.fromkeys(['a', 'b', 'c'])
>>> md
{'a': None, 'c': None, 'b': None}
>>> type(md)
<class '__main__.MyDict'> 
```

有关替代构造函数的其他类似示例，请参阅[pandas 源代码](https://github.com/pydata/pandas/blob/master/pandas/core/frame.py)[`classmethod`](https://docs.python.org/library/functions.html#classmethod)，另请参阅关于和的官方 Python 文档[`staticmethod`](https://docs.python.org/library/functions.html#staticmethod)。

* * *

## 回答 #8

> 赞同：54
> 
> 时间：2017-10-10T10:10:50.207

我开始用 C++ 学习编程语言，然后是 Java，然后是 Python，所以这个问题也困扰着我很多，直到我理解了每种语言的简单用法。

**类方法：**与 Java 和 C++ 不同，Python 没有构造函数重载。因此，要实现这一点，您可以使用`classmethod`. 下面的例子将解释这一点

假设我们有一个`Person`类，它接受两个参数`first_name`并`last_name`创建`Person`.

```
class Person(object):

    def __init__(self, first_name, last_name):
        self.first_name = first_name
        self.last_name = last_name 
```

现在，如果您需要仅使用单个名称（仅 a ）创建一个类`first_name`，则您**不能**在 Python 中执行此类操作。

当您尝试创建对象（实例）时，这会给您一个错误。

```
class Person(object):

    def __init__(self, first_name, last_name):
        self.first_name = first_name
        self.last_name = last_name

    def __init__(self, first_name):
        self.first_name = first_name 
```

`@classmethod`但是，您可以使用以下方法实现相同的目的

```
class Person(object):

    def __init__(self, first_name, last_name):
        self.first_name = first_name
        self.last_name = last_name

    @classmethod
    def get_person(cls, first_name):
        return cls(first_name, "") 
```

**静态方法：**这很简单，它不绑定到实例或类，你可以简单地使用类名来调用它。

因此，假设在上面的示例中您需要一个`first_name`不超过 20 个字符的验证，您可以简单地执行此操作。

```
@staticmethod  
def validate_name(name):
    return len(name) <= 20 
```

你可以简单地调用 using`class name`

```
Person.validate_name("Gaurang Shah") 
```

* * *

## 回答 #9

> 赞同：43
> 
> 时间：2019-05-21T10:47:50.193

**只有第一个参数不同**：

*   普通方法：**当前对象**自动作为（附加）第一个参数传递
*   classmethod：**当前对象的类**自动作为（附加）第一个参数传递
*   staticmethod：不会自动传递**额外的参数。**你传递给函数的就是你得到的。

更详细...

## 正常方法

“标准”方法，就像在每个面向对象的语言中一样。当一个对象的方法被调用时，它会自动获得一个额外的参数`self`作为它的第一个参数。也就是方法

```
def f(self, x, y) 
```

必须用 2 个参数调用。`self`是自动传递的，而且是*对象本身*。类似于`this`神奇地出现在例如。java/c++，只有在 python 中才会显式显示。

> 实际上，第一个参数不必*被*调用`self`，但它是标准约定，所以保留它

## 类方法

装饰方法时

```
@classmethod
def f(cls, x, y) 
```

自动提供的参数*不是* `self`，而是*的类* `self`。

## 静态方法

装饰方法时

```
@staticmethod
def f(x, y) 
```

该方法*根本没有给出*任何自动参数。它只给出调用它的参数。

# 用法

*   `classmethod`主要用于替代构造函数。
*   `staticmethod`不使用对象的状态，甚至不使用类本身的结构。它可以是类外部的函数。它只放在类中，用于对具有相似功能的函数进行分组（例如，像 Java 的`Math`类静态方法）

```
class Point
    def __init__(self, x, y):
        self.x = x
        self.y = y

    @classmethod
    def frompolar(cls, radius, angle):
        """The `cls` argument is the `Point` class itself"""
        return cls(radius * cos(angle), radius * sin(angle))

    @staticmethod
    def angle(x, y):
        """this could be outside the class, but we put it here 
just because we think it is logically related to the class."""
        return atan(y, x)

p1 = Point(3, 2)
p2 = Point.frompolar(3, pi/4)

angle = Point.angle(3, 2) 
```

* * *

## 回答 #10

> 赞同：41
> 
> 时间：2015-05-19T15:27:13.230

我认为一个更好的问题是“你什么时候使用`@classmethod`vs `@staticmethod`？”

`@classmethod`允许您轻松访问与类定义关联的私有成员。这是实现单例或控制已创建对象实例数量的工厂类的好方法。

`@staticmethod`提供了边际性能提升，但我还没有看到无法在类外作为独立函数实现的类中静态方法的有效使用。

* * *

## 回答 #11

> 赞同：37
> 
> 时间：2016-10-03T10:41:18.207

**静态方法：**

*   没有 self 参数的简单函数。
*   处理类属性；不在实例属性上。
*   可以通过类和实例调用。
*   内置函数 staticmethod() 用于创建它们。

**静态方法的好处：**

*   它在类作用域中本地化函数名称
*   它将功能代码移到更靠近使用它的位置
*   与模块级函数相比，导入更方便，因为不必专门导入每个方法

    ```
    @staticmethod
    def some_static_method(*args, **kwds):
        pass 
    ```

**类方法：**

*   具有第一个参数作为类名的函数。
*   可以通过类和实例调用。
*   这些是使用 classmethod 内置函数创建的。

    ```
     @classmethod
     def some_class_method(cls, *args, **kwds):
         pass 
    ```

* * *

## 回答 #12

> 赞同：36
> 
> 时间：2012-02-24T09:32:32.853

在 python 2.4 中添加了@decorators 如果你使用的是 python < 2.4，你可以使用 classmethod() 和 staticmethod() 函数。

例如，如果您想创建一个工厂方法（一个函数返回一个类的不同实现的实例，具体取决于它获得的参数），您可以执行以下操作：

```
class Cluster(object):

    def _is_cluster_for(cls, name):
        """
        see if this class is the cluster with this name
        this is a classmethod
        """ 
        return cls.__name__ == name
    _is_cluster_for = classmethod(_is_cluster_for)

    #static method
    def getCluster(name):
        """
        static factory method, should be in Cluster class
        returns a cluster object for the given name
        """
        for cls in Cluster.__subclasses__():
            if cls._is_cluster_for(name):
                return cls()
    getCluster = staticmethod(getCluster) 
```

还要注意，这是使用类方法和静态方法的一个很好的例子，静态方法显然属于类，因为它在内部使用类 Cluster。classmethod 只需要关于类的信息，不需要对象的实例。

使该方法成为类方法的另一个好处`_is_cluster_for`是子类可以决定更改其实现，这可能是因为它非常通用并且可以处理多种类型的集群，因此仅检查类的名称是不够的。

* * *

## 回答 #13

> 赞同：30
> 
> 时间：2018-01-14T14:07:39.050

让我先说说用@classmethod 装饰的方法与@staticmethod 之间的相似之处。

**相似性：**它们都可以在*类*本身上调用，而不仅仅是类的*实例*。所以，它们在某种意义上都是*类的方法*。

**区别：**类方法将接收类本身作为第一个参数，而静态方法则不会。

因此，从某种意义上说，静态方法并不绑定到类本身，只是因为它可能具有相关功能而挂在那里。

```
>>> class Klaus:
        @classmethod
        def classmthd(*args):
            return args

        @staticmethod
        def staticmthd(*args):
            return args

# 1\. Call classmethod without any arg
>>> Klaus.classmthd()  
(__main__.Klaus,)  # the class gets passed as the first argument

# 2\. Call classmethod with 1 arg
>>> Klaus.classmthd('chumma')
(__main__.Klaus, 'chumma')

# 3\. Call staticmethod without any arg
>>> Klaus.staticmthd()  
()

# 4\. Call staticmethod with 1 arg
>>> Klaus.staticmthd('chumma')
('chumma',) 
```

* * *

## 回答 #14

> 赞同：27
> 
> 时间：2008-09-25T21:24:13.267

`@staticmethod`只是禁用默认函数作为方法描述符。classmethod 将您的函数包装在一个可调用的容器中，该容器可调用传递对拥有类的引用作为第一个参数：

```
>>> class C(object):
...  pass
... 
>>> def f():
...  pass
... 
>>> staticmethod(f).__get__(None, C)
<function f at 0x5c1cf0>
>>> classmethod(f).__get__(None, C)
<bound method type.f of <class '__main__.C'>> 
```

事实上，`classmethod`它有运行时开销，但可以访问拥有的类。或者，我建议使用元类并将类方法放在该元类上：

```
>>> class CMeta(type):
...  def foo(cls):
...   print cls
... 
>>> class C(object):
...  __metaclass__ = CMeta
... 
>>> C.foo()
<class '__main__.C'> 
```

* * *

## 回答 #15

> 赞同：24
> 
> 时间：2015-11-16T02:00:50.757

[关于如何在 Python 中使用静态、类或抽象方法的权威指南](https://julien.danjou.info/blog/2013/guide-python-static-class-abstract-methods)是该主题的一个很好的链接，并将其总结如下。

**`@staticmethod`**函数只不过是在类中定义的函数。它可以在不先实例化类的情况下调用。它的定义通过继承是不可变的。

*   Python 不必为对象实例化绑定方法。
*   它简化了代码的可读性，并且不依赖于对象本身的状态；

**`@classmethod`**函数也可以在不实例化类的情况下调用，但它的定义遵循子类，而不是父类，通过继承，可以被子类覆盖。这是因为`@classmethod`函数的第一个参数必须始终是*cls*（类）。

*   *工厂方法*，用于使用例如某种预处理为类创建实例。
*   *调用静态方法的静态方法*：如果将一个静态方法拆分为多个静态方法，则不应硬编码类名，而应使用类方法

* * *

## 回答 #16

> 赞同：22
> 
> 时间：2016-09-29T17:02:51.280

关于静态方法与类方法的另一个考虑是继承。假设您有以下课程：

```
class Foo(object):
    @staticmethod
    def bar():
        return "In Foo" 
```

然后你想`bar()`在一个子类中覆盖：

```
class Foo2(Foo):
    @staticmethod
    def bar():
        return "In Foo2" 
```

这可行，但请注意，现在`bar()`子类 ( `Foo2`) 中的实现不能再利用特定于该类的任何东西。例如，假设`Foo2`有一个`magic()`您想在`Foo2`实现中使用的名为的方法`bar()`：

```
class Foo2(Foo):
    @staticmethod
    def bar():
        return "In Foo2"
    @staticmethod
    def magic():
        return "Something useful you'd like to use in bar, but now can't" 
```

这里的解决方法是调用`Foo2.magic()`in `bar()`，但随后您会重复自己（如果名称`Foo2`更改，您必须记住更新该`bar()`方法）。

对我来说，这稍微违反了[开放/封闭原则](https://en.wikipedia.org/wiki/Open/closed_principle)，因为做出的决定`Foo`会影响您在派生类中重构公共代码的能力（即它对扩展的开放性较低）。如果`bar()`是`classmethod`我们会很好：

```
class Foo(object):
    @classmethod
    def bar(cls):
        return "In Foo"

class Foo2(Foo):
    @classmethod
    def bar(cls):
        return "In Foo2 " + cls.magic()
    @classmethod
    def magic(cls):
        return "MAGIC"

print Foo2().bar() 
```

给出：`In Foo2 MAGIC`

另外：历史记录：Guido Van Rossum（Python 的创造者）曾经将`staticmethod`'s 称为“意外”：[https ://mail.python.org/pipermail/python-ideas/2012-May/014969.html](https://mail.python.org/pipermail/python-ideas/2012-May/014969.html)

> 我们都知道静态方法有多么有限。（它们基本上是一个意外——早在 Python 2.2 时代，当我发明新型类和描述符时，我打算实现类方法，但一开始我不理解它们，不小心先实现了静态方法。然后它删除它们为时已晚，只提供类方法。

另外：[https ://mail.python.org/pipermail/python-ideas/2016-July/041189.html](https://mail.python.org/pipermail/python-ideas/2016-July/041189.html)

> 老实说，staticmethod 是一个错误——我试图做类似 Java 类方法的东西，但是一旦它发布，我发现真正需要的是类方法。但是摆脱静态方法为时已晚。

* * *

## 回答 #17

> 赞同：10
> 
> 时间：2016-09-20T09:03:29.677

我将尝试用一个例子来解释基本的区别。

```
class A(object):
    x = 0

    def say_hi(self):
        pass

    @staticmethod
    def say_hi_static():
        pass

    @classmethod
    def say_hi_class(cls):
        pass

    def run_self(self):
        self.x += 1
        print self.x # outputs 1
        self.say_hi()
        self.say_hi_static()
        self.say_hi_class()

    @staticmethod
    def run_static():
        print A.x  # outputs 0
        # A.say_hi() #  wrong
        A.say_hi_static()
        A.say_hi_class()

    @classmethod
    def run_class(cls):
        print cls.x # outputs 0
        # cls.say_hi() #  wrong
        cls.say_hi_static()
        cls.say_hi_class() 
```

1 - 我们可以直接调用静态和类方法，无需初始化

```
# A.run_self() #  wrong
A.run_static()
A.run_class() 
```

2-静态方法不能调用self方法但可以调用其他静态和类方法

3-静态方法属于类，根本不会使用对象。

4-类方法不绑定到对象，而是绑定到类。

* * *

## 回答 #18

> 赞同：8
> 
> 时间：2021-03-17T11:25:42.577

**存在继承时会发生差异。**

假设有两个类——Parent 和 Child。如果要使用@staticmethod，print_name 方法应该写两次，因为类的名称应该写在打印行中。

```
class Parent:
   _class_name = "Parent"

   @staticmethod
   def print_name():
       print(Parent._class_name)

class Child(Parent):
   _class_name = "Child"

   @staticmethod
   def print_name():
       print(Child._class_name)

Parent.print_name()
Child.print_name() 
```

但是，对于@classmethod，不需要编写两次 print_name 方法。

```
class Parent:
    _class_name = "Parent"

    @classmethod
    def print_name(cls):
        print(cls._class_name)

class Child(Parent):
    _class_name = "Child"

Parent.print_name()
Child.print_name() 
```

* * *

## 回答 #19

> 赞同：7
> 
> 时间：2017-09-20T16:57:20.180

@classmethod：可用于创建对该类创建的所有实例的共享全局访问......就像由多个用户更新记录......我特别发现它在创建单例时也很有用......： )

@static 方法：与关联的类或实例无关...但是为了可读性可以使用静态方法

* * *

## 回答 #20

> 赞同：7
> 
> 时间：2019-01-24T12:56:46.453

您可能需要考虑以下之间的区别：

```
class A:
    def foo():  # no self parameter, no decorator
        pass 
```

和

```
class B:
    @staticmethod
    def foo():  # no self parameter
        pass 
```

这在 python2 和 python3 之间发生了变化：

蟒蛇2：

```
>>> A.foo()
TypeError
>>> A().foo()
TypeError
>>> B.foo()
>>> B().foo() 
```

蟒蛇3：

```
>>> A.foo()
>>> A().foo()
TypeError
>>> B.foo()
>>> B().foo() 
```

因此，使用 `@staticmethod`仅直接从类中调用的方法在 python3 中已成为可选。如果你想从类和实例中调用它们，你仍然需要使用`@staticmethod`装饰器。

unutbus answer很好地涵盖了其他情况。

* * *

## 回答 #21

> 赞同：7
> 
> 时间：2019-11-20T11:48:00.820

类方法接收类作为隐式第一个参数，就像实例方法接收实例一样。它是一个绑定到类而不是类的对象的方法。它可以访问类的状态，因为它需要一个指向类而不是对象实例的类参数。它可以修改适用于类的所有实例的类状态。例如，它可以修改适用于所有实例的类变量。

另一方面，与类方法或实例方法相比，静态方法不接收隐式的第一个参数。并且不能访问或修改类状态。它只属于类，因为从设计的角度来看，这是正确的方法。但就功能而言，在运行时并没有绑定到类。

作为指导，使用静态方法作为实用程序，例如使用类方法作为工厂。或者也许定义一个单例。并使用实例方法对实例的状态和行为进行建模。

希望我很清楚！

* * *

## 回答 #22

> 赞同：6
> 
> 时间：2018-06-25T02:38:52.880

我的贡献展示了 、 和 实例方法之间的区别`@classmethod`，`@staticmethod`包括实例如何间接调用`@staticmethod`. 但是`@staticmethod`，与其从实例间接调用 a ，不如将其设为私有可能更“pythonic”。这里没有演示从私有方法获取某些东西，但它基本上是相同的概念。

```
#!python3

from os import system
system('cls')
# %   %   %   %   %   %   %   %   %   %   %   %   %   %   %   %   %   %   %   %

class DemoClass(object):
    # instance methods need a class instance and
    # can access the instance through 'self'
    def instance_method_1(self):
        return 'called from inside the instance_method_1()'

    def instance_method_2(self):
        # an instance outside the class indirectly calls the static_method
        return self.static_method() + ' via instance_method_2()'

    # class methods don't need a class instance, they can't access the
    # instance (self) but they have access to the class itself via 'cls'
    @classmethod
    def class_method(cls):
        return 'called from inside the class_method()'

    # static methods don't have access to 'cls' or 'self', they work like
    # regular functions but belong to the class' namespace
    @staticmethod
    def static_method():
        return 'called from inside the static_method()'
# %   %   %   %   %   %   %   %   %   %   %   %   %   %   %   %   %   %   %   %

# works even if the class hasn't been instantiated
print(DemoClass.class_method() + '\n')
''' called from inside the class_method() '''

# works even if the class hasn't been instantiated
print(DemoClass.static_method() + '\n')
''' called from inside the static_method() '''
# %   %   %   %   %   %   %   %   %   %   %   %   %   %   %   %   %   %   %   %

# >>>>> all methods types can be called on a class instance <<<<<
# instantiate the class
democlassObj = DemoClass()

# call instance_method_1()
print(democlassObj.instance_method_1() + '\n')
''' called from inside the instance_method_1() '''

# # indirectly call static_method through instance_method_2(), there's really no use
# for this since a @staticmethod can be called whether the class has been
# instantiated or not
print(democlassObj.instance_method_2() + '\n')
''' called from inside the static_method() via instance_method_2() '''

# call class_method()
print(democlassObj.class_method() + '\n')
'''  called from inside the class_method() '''

# call static_method()
print(democlassObj.static_method())
''' called from inside the static_method() '''

"""
# whether the class is instantiated or not, this doesn't work
print(DemoClass.instance_method_1() + '\n')
'''
TypeError: TypeError: unbound method instancemethod() must be called with
DemoClass instance as first argument (got nothing instead)
'''
""" 
```

* * *

## 回答 #23

> 赞同：6
> 
> 时间：2020-11-07T20:16:26.960

***实例方法***：

`+` *可以*修改对象实例状态

`+` *可以*修改类状态

***类方法***：

`-` *无法*修改对象实例状态

`+` *可以*修改类状态

***静态方法***：

`-` *无法*修改对象实例状态

`-` *无法*修改班级状态

```
class MyClass:
    ''' 
    Instance method has a mandatory first attribute self which represent the instance itself. 
    Instance method must be called by a instantiated instance.
    '''
    def method(self):
        return 'instance method called', self

    '''
    Class method has a mandatory first attribute cls which represent the class itself. 
    Class method can be called by an instance or by the class directly. 
    Its most common using scenario is to define a factory method.
    '''
    @classmethod
    def class_method(cls):
        return 'class method called', cls

    '''
    Static method doesn’t have any attributes of instances or the class. 
    It also can be called by an instance or by the class directly. 
    Its most common using scenario is to define some helper or utility functions which are closely relative to the class.
    '''
    @staticmethod
    def static_method():
        return 'static method called'

obj = MyClass()
print(obj.method())
print(obj.class_method()) # MyClass.class_method()
print(obj.static_method()) # MyClass.static_method() 
```

输出：

```
('instance method called', <__main__.MyClass object at 0x100fb3940>)
('class method called', <class '__main__.MyClass'>)
static method called 
```

我们实际上可以访问对象实例的实例方法，所以这是我的类对象之外的一个实例，而使用类方法我们可以访问类本身。但不是任何对象，因为类方法并不真正关心对象是否存在。但是，您可以在对象实例上调用类方法和静态方法。这会起作用，它并没有真正的区别，所以当你在这里调用静态方法时，它会再次起作用，它会知道你想调用哪个方法。

静态方法用于执行一些实用任务，类方法用于工厂方法。工厂方法可以为不同的用例返回类对象。

最后，一个简短的例子可以更好地理解：

```
class Student:
    def __init__(self, first_name, last_name):
        self.first_name = first_name
        self.last_name = last_name

    @classmethod
    def get_from_string(cls, name_string: str):
        first_name, last_name = name_string.split()
        if Student.validate_name(first_name) and Student.validate_name(last_name):
            return cls(first_name, last_name)
        else:
            print('Invalid Names')

    @staticmethod
    def validate_name(name):
        return len(name) <= 10

stackoverflow_student = Student.get_from_string('Name Surname')
print(stackoverflow_student.first_name) # Name
print(stackoverflow_student.last_name) # Surname 
```

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2017-12-01T10:38:02.333

顾名思义，类方法用于更改类而不是对象。要对类进行更改，他们将修改类属性（而不是对象属性），因为这是您更新类的方式。这就是类方法将类（通常用“cls”表示）作为第一个参数的原因。

```
class A(object):
    m=54

    @classmethod
    def class_method(cls):
        print "m is %d" % cls.m 
```

另一方面，静态方法用于执行未绑定到类的功能，即它们不会读取或写入类变量。因此，静态方法不将类作为参数。使用它们是为了让类可以执行与类目的不直接相关的功能。

```
class X(object):
    m=54 #will not be referenced

    @staticmethod
    def static_method():
        print "Referencing/calling a variable or function outside this class. E.g. Some global variable/function." 
```

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2017-12-12T09:40:50.050

**从字面上**分析@staticmethod ，提供不同的见解。

类的普通方法是隐式**动态**方法，它以实例作为第一个参数。
相反，静态方法不将实例作为第一个参数，因此称为**'static'**。

静态方法确实是一个普通函数，与类定义之外的函数相同。
幸运的是，它被分组到类中只是为了更靠近它的应用位置，或者您可以滚动找到它。

* * *

## 回答 #26

> 赞同：3
> 
> 时间：2019-11-20T09:50:33.463

我认为提供一个纯 Python 版本的`staticmethod`and`classmethod`将有助于理解它们在语言级别上的区别。

它们都是非数据描述符（如果你先熟悉[描述符](https://docs.python.org/3/reference/datamodel.html#implementing-descriptors)会更容易理解）。

```
class StaticMethod(object):
    "Emulate PyStaticMethod_Type() in Objects/funcobject.c"

    def __init__(self, f):
        self.f = f

    def __get__(self, obj, objtype=None):
        return self.f

class ClassMethod(object):
    "Emulate PyClassMethod_Type() in Objects/funcobject.c"
    def __init__(self, f):
        self.f = f

    def __get__(self, obj, cls=None):
        def inner(*args, **kwargs):
            if cls is None:
                cls = type(obj)
            return self.f(cls, *args, **kwargs)
        return inner 
```

* * *

## 回答 #27

> 赞同：3
> 
> 时间：2021-01-16T19:58:07.033

Python 带有几个内置的装饰器。三巨头是：

```
@classmethod
@staticmethod
@property 
```

**@classmethod**装饰器可以使用类的实例调用，也可以直接由类本身作为其第一个参数调用。

**@staticmethod**是一种将函数放入类的方法（因为它在逻辑上属于那里），同时表明它不需要访问该类。

让我们考虑以下类：

```
class DecoratorTest(object):

    def __init__(self):
        pass

    def doubler(self, x):
        print("running doubler")
        return x*2

    @classmethod
    def class_doubler(klass, x):
        print("running doubler: %s" % klass)
        return x*2

    @staticmethod
    def static_doubler(x): # no need adding 'self' here
        print("running doubler")
        return x*2

decor = DecoratorTest() 
```

让我们看看它是如何工作的：

```
print(decor.doubler(5))
# running doubler
# 10

print(decor.class_doubler(5))
# running doubler: <class '__main__.DecoratorTest'> 
# 10
print(DecoratorTest.class_doubler(5))
# running doubler: <class '__main__.DecoratorTest'> 
# 10

print(DecoratorTest.static_doubler(5))
# running doubler 
# 10
print(decor.static_doubler(5))
# running doubler 
# 10

print(decor.doubler)
# <bound method DecoratorTest.doubler of <__main__.DecoratorTest object at 0x7f90e74fd150>> 
print(decor.class_doubler)
# <bound method DecoratorTest.class_doubler of <class '__main__.DecoratorTest'>> 
print(decor.static_doubler)
# <function DecoratorTest.static_doubler at 0x7f90e7447440> 
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2020-07-31T18:12:55.373

子类化时会出现一个非常重要的实际差异。如果你不介意，我会劫持@unutbu 的例子：

```
class A: 
    def foo(self, x): 
        print("executing foo(%s, %s)" % (self, x)) 

    @classmethod
    def class_foo(cls, x): 
        print("executing class_foo(%s, %s)" % (cls, x))

    @staticmethod 
    def static_foo(x): 
        print("executing static_foo(%s)" % x)

class B(A):
    pass 
```

在`class_foo`中，该方法知道它在哪个类上被调用：

```
A.class_foo(1)
# => executing class_foo(<class '__main__.A'>, 1)
B.class_foo(1)
# => executing class_foo(<class '__main__.B'>, 1) 
```

在`static_foo`中，没有办法确定它是被调用`A`还是`B`：

```
A.static_foo(1)
# => executing static_foo(1)
B.static_foo(1)
# => executing static_foo(1) 
```

请注意，这并不意味着您不能在 a 中使用其他方法`staticmethod`，您只需直接引用该类，这意味着子类的 staticmethods 仍将引用父类：

```
class A:
    @classmethod
    def class_qux(cls, x):
        print(f"executing class_qux({cls}, {x})")

    @classmethod
    def class_bar(cls, x):
        cls.class_qux(x)

    @staticmethod
    def static_bar(x):
        A.class_qux(x)

class B(A):
    pass

A.class_bar(1)
# => executing class_qux(<class '__main__.A'>, 1)
B.class_bar(1)
# => executing class_qux(<class '__main__.B'>, 1)
A.static_bar(1)
# => executing class_qux(<class '__main__.A'>, 1)
B.static_bar(1)
# => executing class_qux(<class '__main__.A'>, 1) 
```

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2021-02-04T16:00:16.443

首先让我们从一个示例代码开始，我们将使用它来理解这两个概念：

```
class Employee:

    NO_OF_EMPLOYEES = 0

    def __init__(self, first_name, last_name, salary):
        self.first_name = first_name
        self.last_name = last_name
        self.salary = salary
        self.increment_employees()

    def give_raise(self, amount):
        self.salary += amount

    @classmethod
    def employee_from_full_name(cls, full_name, salary):
        split_name = full_name.split(' ')
        first_name = split_name[0]
        last_name = split_name[1]
        return cls(first_name, last_name, salary)

    @classmethod
    def increment_employees(cls):
        cls.NO_OF_EMPLOYEES += 1

    @staticmethod
    def get_employee_legal_obligations_txt():
        legal_obligations = """
        1\. An employee must complete 8 hours per working day
        2\. ...
        """
        return legal_obligations 
```

* * *

**类方法**

类方法接受类本身作为隐式参数和 - 可选 - 定义中指定的任何其他参数。重要的是要理解类方法不能访问对象实例（就像实例方法一样）。因此，类方法不能用于更改实例化对象的状态，而是能够更改在该类的所有实例之间共享的类状态。当我们需要访问类本身时，类方法通常很有用——例如，当我们想要创建工厂方法时，即创建类实例的方法。换句话说，类方法可以作为替代构造函数。

在我们的示例代码中，`Employee`可以通过提供三个参数来构造 的实例；`first_name`,`last_name`和`salary`.

```
employee_1 = Employee('Andrew', 'Brown', 85000)
print(employee_1.first_name)
print(employee_1.salary)

'Andrew'
85000 
```

现在让我们假设有可能可以在单个字段中提供 Employee 的姓名，其中名字和姓氏由空格分隔。在这种情况下，我们可能会使用我们的类方法`employee_from_full_name`，它总共接受三个参数。第一个是类本身，它是一个隐式参数，这意味着在调用方法时不会提供它——Python 会自动为我们执行此操作：

```
employee_2 = Employee.employee_from_full_name('John Black', 95000)
print(employee_2.first_name)
print(employee_2.salary)

'John'
95000 
```

请注意，也可以`employee_from_full_name`从对象实例调用，尽管在这种情况下它没有多大意义：

```
employee_1 = Employee('Andrew', 'Brown', 85000)
employee_2 = employee_1.employee_from_full_name('John Black', 95000) 
```

我们可能想要创建类方法的另一个原因是当我们需要更改类的状态时。在我们的示例中，类变量`NO_OF_EMPLOYEES`跟踪当前为公司工作的员工数量。每次创建 Employee 的新实例时都会调用此方法，并相应地更新计数：

```
employee_1 = Employee('Andrew', 'Brown', 85000)
print(f'Number of employees: {Employee.NO_OF_EMPLOYEES}')
employee_2 = Employee.employee_from_full_name('John Black', 95000)
print(f'Number of employees: {Employee.NO_OF_EMPLOYEES}')

Number of employees: 1
Number of employees: 2 
```

* * *

**静态方法**

另一方面，在静态方法中，实例（即`self`）和类本身（即`cls`）都不是作为隐式参数传递的。这意味着此类方法无法访问类本身或其实例。现在有人可能会争辩说，静态方法在类的上下文中没有用，因为它们也可以放在帮助模块中，而不是将它们添加为类的成员。在面向对象编程中，将类构造成逻辑块很重要，因此，当我们需要在类下添加方法时，静态方法非常有用，因为它在逻辑上属于该类。在我们的示例中，静态方法名为`get_employee_legal_obligations_txt`只返回一个字符串，其中包含公司每个员工的法律义务。此函数不与类本身或任何实例交互。它可以被放置到不同的辅助模块中，但是，它只与这个类相关，因此我们必须将它放在 Employee 类下。

静态方法可以直接从类本身访问

```
print(Employee.get_employee_legal_obligations_txt())

    1\. An employee must complete 8 hours per working day
    2\. ... 
```

或从类的实例：

```
employee_1 = Employee('Andrew', 'Brown', 85000)
print(employee_1.get_employee_legal_obligations_txt())

    1\. An employee must complete 8 hours per working day
    2\. ... 
```

* * *

**参考**

*   [Python中的静态方法和类方法有什么区别？](https://towardsdatascience.com/whats-the-difference-between-static-and-class-methods-in-python-1ef581de4351)

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2020-03-02T16:01:43.433

staticmethod 无法访问继承层次结构中的对象、类或父类的属性。它可以直接在类中调用（无需创建对象）。

classmethod 无法访问对象的属性。但是，它可以访问继承层次结构中的类和父类的属性。它可以直接在类中调用（无需创建对象）。如果在对象上调用，则它与不访问`self.<attribute(s)>`且`self.__class__.<attribute(s)>`仅访问的普通方法相同。

认为我们有一个带有 的类`b=2`，我们将创建一个对象并将其重新设置为`b=4`其中。静态方法无法访问以前的任何内容。Classmethod`.b==2`只能通过`cls.b`. 普通方法可以同时访问：`.b==4`via`self.b`和`.b==2`via `self.__class__.b`。

我们可以遵循 KISS 风格（保持简单，愚蠢）：不要使用静态方法和类方法，不要使用没有实例化的类，只访问对象的属性`self.attribute(s)`。有些语言以这种方式实现 OOP，我认为这不是坏主意。:)

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2021-02-03T03:32:48.680

tldr;

A`staticmethod`本质上是一个绑定到一个类（以及它的实例）的函数

A`classmethod`本质上是一个可继承的`staticmethod`.

有关详细信息，请参阅其他人的出色答案。

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2021-07-20T18:18:00.777

**从它的文档中定义静态方法和类方法。以及何时使用静态方法以及何时使用类方法。**

*   **静态方法**就像 java 和 C# 中的静态方法，它不会使用类的任何初始化值，它需要从外部正常工作。

*   **类方法**：一般用于继承覆盖，当我们覆盖一个方法时，然后我们使用 CLS 实例来告诉我们是要调用子类的方法还是父类的方法。如果您想同时使用具有相同名称和不同签名的方法。

静态方法（函数）-> 方法

```
Convert a function to be a static method.

A static method does not receive an implicit first argument.
To declare a static method, use this idiom:

     class C:
         @staticmethod
         def f(arg1, arg2, ...):
             ...

It can be called either on the class (e.g. C.f()) or on an instance
(e.g. C().f()).  The instance is ignored except for its class.

Static methods in Python are similar to those found in Java or C++.
For a more advanced concept, see the classmethod builtin.
""" 
```

类方法（函数）-> 方法

```
Convert a function to be a class method.

A class method receives the class as implicit first argument,
just like an instance method receives the instance.
To declare a class method, use this idiom:

  class C:
      @classmethod
      def f(cls, arg1, arg2, ...):
          ...

It can be called either on the class (e.g. C.f()) or on an instance
(e.g. C().f()).  The instance is ignored except for its class.
If a class method is called for a derived class, the derived class
object is passed as the implied first argument.

Class methods are different than C++ or Java static methods.
If you want those, see the staticmethod builtin. 
```

* * *

## 回答 #33

> 赞同：-5
> 
> 时间：2012-12-17T18:51:40.130

对 iPython 中其他相同方法的快速分析表明，这会`@staticmethod`产生边际性能提升（以纳秒为单位），但除此之外它似乎没有任何作用。此外，任何性能提升都可能会被编译期间处理该方法的额外工作所抵消`staticmethod()`（这发生在您运行脚本时的任何代码执行之前）。

为了代码的可读性，我会避免`@staticmethod`使用，除非您的方法将用于处理以纳秒为单位的大量工作。

# grails - Grails 1.0.3 控制台报告“文件过早结束”

> ID：136098
> 
> 赞同：5
> 
> 时间：2008-09-25T21:02:02.477
> 
> 标签：grails, groovy

浏览使用 Grails 1.0.3 版构建的动态网页，控制台日志显示每个页面请求的以下错误：

```
[Fatal Error] :-1:-1: Premature end of file. 
```

如何阻止每个请求出现此错误？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-25T21:04:44.437

此错误已修复：http: [//jira.codehaus.org/browse/GRAILS-3088](http://jira.codehaus.org/browse/GRAILS-3088)

> 文件过早结束
> 
> 影响版本/秒：1.0.3
> 修复版本/秒： [1.0.4](http://web.archive.org/web/20080914033743/http://jira.codehaus.org/browse/GRAILS/fixforversion/14156)
> 
> ...只是一些实施说明。我们默认 aq 值为 0，根据规范，这是不正确的。所以我们现在默认为 1.0，它在 Firefox 3 中给出了正确的优先顺序，但在 Firefox 2 中不正确。但是，如果它们具有相同的 q 值，更具体的 XML 类型（如 application/xhtml+xml）现在优先于不太具体的 XML 类型，所以这个修复了 Firefox 2 中的问题...

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-01T16:09:40.467

当从 Firefox 3 浏览器发出 http 请求时，会出现日志条目。

Grails 1.0.3 上的解决方法是在您的项目中打开 Config.groovy 并找到以下内容：

```
grails.mime.types = [ html: ['text/html','application/xhtml+xml'],
xml: ['text/xml', 'application/xml'], ... 
```

上面与 xml 相关的第二行应该被删除。

这是已解决的 GRAILS 1.0.3 错误，有关完整详细信息，请参阅[http://jira.codehaus.org/browse/GRAILS-3088](http://jira.codehaus.org/browse/GRAILS-3088)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-13T18:56:12.573

升级到 1.0.4 快照可能是处理此问题的最佳方法。查看[Grails 下载页面上“Grails 开发构建”下的说明](http://grails.org/Download)。

它也可以被忽略，没有太大的困难。

# project-management - 什么时候一个功能被认为是“完成”？

> ID：136099
> 
> 赞同：6
> 
> 时间：2008-09-25T21:02:16.127
> 
> 标签：project-management

作为软件开发人员，我们创建了很多……嗯……代码。我们生成的大部分代码都可以用于新功能或现有功能的增强。在这种情况下，我们如何知道此功能何时**完成**？

在功能的上下文中，*完成*意味着什么？例如，对于 A 公司来说，这可能意味着许多不同的事情，例如，

1.  满足客户要求（这本身就很棘手）
2.  没有已知的错误
3.  文档已编写
4.  等等
5.  等等

为了更好地帮助理解*完成*对不同开发人员和团队的意义，请列出最多五个（但不超过 10 个）项目。此列表将是您作为开发人员或您的团队可能会经历的事情，一旦所有项目都被选中，该功能就被认为已***完成***。

### 更新

这些是一些很好的答案。我试图弄清楚如何确定最好的，因为我猜这个问题有点主观。我想我仍在寻找更完整的图片。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-25T21:04:16.560

当客户/用户在测试后签署 UAT（用户验收测试）时。那是我们的官方量尺。

当然，这并不意味着什么，因为几周后总是会要求提供该功能的 2.0 版本，但这比我们的要多。

编辑 - 如果你想详细了解它，我们是这样做的：

1.  要求由系统分析师和客户批准
2.  设计由首席程序员批准
3.  代码审查由同行程序员批准
4.  代码在 QA 部门的单元测试中标记为已测试。
5.  UAT 由客户亲自测试后签名。
6.  代码在 QA 部门的系统测试中标记为已测试。
7.  代码发布。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-25T21:09:35.673

如果您的意思是“我们将永远不必再碰它”的意义上的“完成”，那么唯一的答案是：当系统过时;-)

如果您的意思是“当它准备好发布时”，那么大概是当所有商定的单元测试都通过时，当然假设是 TDD/XP/Agile 方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-25T21:04:10.990

当用户满意时。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-25T21:06:04.543

当它解决了它所设想的问题时。这带来了足够的测试、文档、可用性等的负担——不是太多，但足以满足它的需要。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-28T02:32:39.597

令人反感、政治上不正确但务实的答案：（至少）在一项功能的演变过程中存在一个*关键点。*

*   *在此之前*发布该功能，您会因为客户不接受该功能而失败。修复的成本——时间、材料、声誉——比“完成”它的成本更高。

*   *在此之后*发布该功能，您会因为机会成本而失败。通过将注意力集中在其他事情上，您将获得更多收益。

该功能在达到此临界点时*完成。*

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-25T21:06:51.997

当里面有叉子时。

*   代码符合书面规范
*   代码通过代码审查
*   代码具有并通过单元和集成测试
*   代码通过 QA
*   包含代码的包由所有利益相关者签署

-亚当

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-25T21:10:26.153

对我们来说，一个功能已经完成，这意味着我们可以在满足两个条件时发布它：

1.  一个功能通过了我们在发布开始时编写的所有单元测试和手动测试。这是由 QA 或开发人员在没有 QA 的情况下确定的。
2.  对功能进行未完成的更改请求/错误修复提供的价值低于完成它们所需的资源（时间）。这是由产品所有者决定的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-06-03T10:03:10.700

每个项目都划分为 sprint。Sprint 可能具有一个或多个功能。当该 sprint 的这些阶段完成时，一个 sprint 或功能就完成了

1.US->用户故事-> UI-用户界面->开发->开发->QA->质量保证->UAT->用户验收测试完成。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-08-12T15:14:26.530

关于“完成”的含义似乎仍然存在差异。对于许多人（大多数？），比如[Scrum Alliance](https://www.scrumalliance.org/community/articles/2008/september/definition-of-done-a-reference)的 Mayank Gupta ，完成意味着产品或功能可以*由*产品负责人自行决定是否可以交付。

对于其他人，比如上面的 MattC（和我自己的组织），“完成”意味着产品或功能*已经*交付。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-25T21:04:56.637

发货的时候。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-25T21:05:53.917

当没有什么可以带走的时候。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-25T21:08:08.687

当与它相关的所有测试都通过时，您的功能就完成了。当需求发生变化时，添加更多测试和代码，直到它们也通过。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-25T21:08:56.330

我认为这取决于看它的人。开发人员自然希望将代码提升到*第 n*级，而客户将对它有远见。

所以，

*   客户，当他们停止要求更改时。
*   开发人员，从不**:)**

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-25T22:12:20.810

简单的回答：当它满足客户（或您正在为其实施该功能的人）的要求时。

不是那么简单的答案：当它满足人们/客户期望的所有内在要求时：隐藏的质量要求、可扩展性、文档、稳定性、易用性等。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-08-20T01:12:04.357

当它按照团队定义的 Done 定义完成时。完成的定义应该是 Scrum 团队同意的可见文档，每当出现“完成了吗？”这个问题时，都会参考该文档。被问到。

在 scrumalliance.org 网站上有一篇很好的文章分解了完成的定义

[在此处输入链接描述](https://www.scrumalliance.org/community/articles/2008/september/definition-of-done-a-reference)

# visual-studio-2005 - 为什么 Visual Studio 2005 不会生成 Xml 序列化程序集？

> ID：136104
> 
> 赞同：3
> 
> 时间：2008-09-25T21:02:48.607
> 
> 标签：visual-studio-2005, xml-serialization, sgen

当我将项目设置“生成序列化程序集”设置为“开”时，为什么 Visual Studio 2005 不生成序列化设置？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-25T21:03:14.050

[事实证明，Dev Studio 仅支持 Web 服务的此设置。](http://msdn.microsoft.com/en-us/library/ms164303.aspx)

对于非 Web 服务，您可以通过将 AfterBuild 目标添加到项目文件来使其工作：

```
 <Target Name="AfterBuild" DependsOnTargets="AssignTargetPaths;Compile;ResolveKeySource" Inputs="$(MSBuildAllProjects);@(IntermediateAssembly)"  Outputs="$(OutputPath)$(_SGenDllName)">         
      <SGen BuildAssemblyName="$(TargetFileName)" BuildAssemblyPath="$(OutputPath)"  References="@(ReferencePath)" ShouldGenerateSerializer="true" UseProxyTypes="false" KeyContainer="$(KeyContainerName)" KeyFile="$(KeyOriginatorFile)" DelaySign="$(DelaySign)" ToolPath="$(SGenToolPath)">
          <Output TaskParameter="SerializationAssembly" ItemName="SerializationAssembly" />
      </SGen>
  </Target> 
```

也可以看看：

*   [SGen MSBuild 任务](http://msdn.microsoft.com/en-us/library/ms164303.aspx)
*   [AfterBuild 事件](http://msdn.microsoft.com/en-us/library/xzw8335a(VS.80).aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T21:04:33.173

可以使用[sgen.exe](http://msdn.microsoft.com/en-us/library/bk3w6240(VS.80).aspx)手动完成。

# winforms - Windows 窗体：如何更改禁用标签的字体颜色

> ID：136129
> 
> 赞同：11
> 
> 时间：2008-09-25T21:05:01.597
> 
> 标签：winforms

我正在尝试为标签控件设置禁用的字体特征。我可以设置所有的字体特征（大小、粗体等），但是颜色被默认的 windows 行为覆盖，这似乎是这两种颜色之一：

*   如果背景颜色是透明的，则 ForeColor 与 TextBox disabled Color 相同。
*   如果背景颜色设置为其他颜色，则 ForeColor 为深灰色。

下图演示了这种行为——第 1 列是标签，第 2 列是文本框，第 3 列是组合框。

![替代文字](https://i.stack.imgur.com/60viN.png)

编辑——解释图像：前两行是标签、文本框和组合框的默认样式。在后两行中，我将背景颜色设置为红色，将前景设置为白色。Microsoft 禁用的字体样式处理不一致。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T21:06:22.293

您是否尝试过实现 EnabledChanged 事件？或者您是否在控件上寻找更多的“样式”属性（据我所知，它们不存在）？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-08T16:34:36.400

对于文本框，您可以将 readonly 属性设置为 true，同时保持控件处于启用状态。然后，您可以将 BackColor 和 ForeColor 属性设置为您喜欢的任何值。用户仍然可以单击控件并有一个闪烁的光标，但他们将无法编辑任何内容。

不确定这是否可以推广到其他控件类型，例如组合框或诸如此类的东西，因为我还没有机会进行实验，但值得一试。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T21:28:22.710

看一下[ControlPaint.DrawStringDisabled](http://msdn.microsoft.com/en-us/library/system.windows.forms.controlpaint.drawstringdisabled.aspx)方法；这可能会有所帮助。我在为自定义控件覆盖 OnPaint 事件时使用了它。

```
ControlPaint.DrawStringDisabled(g, this.Text, this.Font, Color.Transparent,
                new Rectangle(CustomStringWidth, 5, StringSize2.Width, StringSize2.Height), StringFormat.GenericTypographic); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T21:21:19.810

为什么这是一个问题？

我个人会让windows处理它。人们习惯于以某种方式禁用项目，因此如果您开始尝试更改它们外观的各个方面，您可能会开始混淆您的用户。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T21:28:13.210

您可能需要覆盖 Paint 事件。到目前为止，我使用的所有工具包在禁用控件时都存在相同的问题。只是猜测他们让窗口绘制文本。至于标签，它们不是标准控件，这就是它们起作用的原因。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-06-19T16:31:59.783

我用下面的 OnPaint 方法覆盖了我的控件的 OnPaint 方法。我粘贴了整个控件类以便于复制。

```
public partial class NewLabel : Label
{
    public NewLabel()
    {
        InitializeComponent();
    }

    protected override void OnPaint(PaintEventArgs e)
    {
        TextRenderer.DrawText(e.Graphics, this.Text.ToString(), this.Font, ClientRectangle, ForeColor);
    }

} 
```

# c# - 在 C# 中操作 RichText 的更好方法？

> ID：136132
> 
> 赞同：5
> 
> 时间：2008-09-25T21:05:28.037
> 
> 标签：c#, string, rtf

我需要创建一些带有标准“格式”（如粗体/斜体、缩进等）的 RichText 并将其复制到剪贴板。我现在这样做的方式似乎有点不雅......我正在创建一个 RichTextBox 项目并通过它应用我的格式，如下所示：

```
RichTextBox rtb = new RichTextBox();
Font boldfont = new Font("Times New Roman", 10, FontStyle.Bold);
rtb.Text = "sometext";
rtb.SelectAll()
rtb.SelectionFont = boldfont;
rtb.SelectionIndent = 12; 
```

必须有更好的方法，但经过几个小时的搜索，我无法想出更好的方法。有任何想法吗？

编辑：RichTextBox (rtb) 不会在表单的任何位置显示/绘制。我只是使用该对象来格式化我的 RichText。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-05T17:50:23.930

这个项目有帮助吗？

[http://www.codeproject.com/KB/string/nrtftree.aspx](http://www.codeproject.com/KB/string/nrtftree.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-25T21:23:39.163

我认为你的技术是完成你想做的事情的好方法。我知道你的意思......感觉有点“脏”，因为你正在使用 Winforms 控件来完成它原本的用途，但它确实有效。我多年来一直使用这种技术。有兴趣看看其他人是否有可行的选择。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-25T21:11:22.250

在执行所有这些操作之前，您可能希望暂停富文本框的布局，以避免不必要的闪烁。这是我过去常犯的错误之一，使它看起来“不雅”

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-25T21:19:49.313

您可以创建一些实用程序扩展方法以使其更“优雅”:)

```
public static RichTextBox Set(this RichTextBox rtb, Font font, string text)
{               
    rtb.Text = text;
    rtb.SelectAll();
    rtb.SelectionFont = font;
    rtb.SelectionIndent = 12;
    return rtb;
} 
```

并像这样调用：

```
someRtb.Set(yourFont, "The Text").AndThenYouCanAddMoreAndCHainThem(); 
```

编辑：我现在看到你甚至没有显示它。Hrm，很有趣，抱歉，我对提供非 Rtb 方式没有多大帮助。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-11-05T23:10:00.820

您还应该在创建后暂停富文本框的布局，并在使用后将其丢弃。

```
RichTextBox rtb = new RichTextBox();
rtb.SuspendLayout();
//richtext processing goes here...
rtb.Dispose(); 
```

并且不要羞于使用richtextbox 进行富文本处理。Microsoft 本身在[本](http://msdn.microsoft.com/en-us/library/cc488002.aspx)教程中执行此操作。:-)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-09-05T01:34:26.103

我知道已经有一段时间了，但请查看这篇关于将 rtf 转换为 html 的 stackoverflow 帖子。将您的内容转换为 html、对其进行操作、然后使用 html 显示或将其转换回 rtf 可能会更容易。

[将 Rtf 转换为 HTML](https://stackoverflow.com/questions/439301/convert-rtf-to-html)

# asp.net - ASP.NET 自定义控件 - 在设计时从图像池中呈现图像

> ID：136135
> 
> 赞同：0
> 
> 时间：2008-09-25T21:05:34.760
> 
> 标签：asp.net, rendering, custom-server-controls

我一直在研究 ImageRotator 控件，并在今晚完成了用它清除任何奇怪的东西，而且效果很好。然而，有一件事让我很烦恼。**它在设计时不显示任何内容**（我只是得到图像占位符）。

我一直在谷歌上搜索，并且发现了 Rick Strahl 的一篇好[文章](http://www.west-wind.com/weblog/posts/193001.aspx)（一如既往），这**对于路径明确的单个图像非常有用。**

但是，`ImageRotator`实际上只会获取文件夹的路径并对其进行扫描，然后遍历它们。目前这在设计时不起作用，因为图像“池”不起作用（我认为这是因为设计者没有授予代码扫描文件系统的权限）。

**那么，这可以做到吗？是否可以为控件实现自定义设计器并在那里提升权限（或其他东西）？**

* * *

### 一边喝茶一边思考的更新（我是多么的英国人！）

是否可以为控件创建一个设计器，创建一个图像，将其编码为 base64 并将其粘贴到代码库中并呈现它？

这样我就不需要对池中的图像废话了，因为我会有自己的^_^

（虽然从池中抓取和图像会更好，因为那是用户选择的正确的？）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-25T21:12:07.570

[Hey Rick Stranl在这里](http://www.west-wind.com/WebLog/posts/189.aspx)也有一篇文章，描述了检测设计时间。如果它在设计时只是从池中给它一个固定的图像。例如， alays 采用第一个或类似的东西。

# regex - 正则表达式，用于测试字符串是否包含以 10 为底的有效实数

> ID：136146
> 
> 赞同：2
> 
> 时间：2008-09-25T21:06:42.247
> 
> 标签：regex, parsing

例子：

```
"1"     yes
"-1"    yes
"- 3"   no
"1.2"   yes
"1.2.3" no
"7e4"   no  (though in some cases you may want to allow scientific notation)
".123"  yes
"123."  yes
"."     no
"-.5"   yes
"007"   yes
"00"    yes 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-25T21:08:31.323

这允许在前面添加可选的“+”和“-”。并允许尾随或初始空格。

```
/^\s*[+-]?(?:\d+\.?\d*|\d*\.\d+)\s*$/ 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-02T04:20:56.043

有几种选择。首先，使用零宽度的先行断言可以使正则表达式的其余部分更简单：

```
/^[-+]?(?=\.?\d)\d*(?:\.\d*)?$/ 
```

如果您想避免前瞻，那么我会尝试阻止正则表达式回溯：

```
/^[-+]?(?:\.\d+|\d+(?:\.\d*)?)$/
/^[-+]?(\.\d+|\d+(\.\d*)?)$/ # if you don't mind capturing parens 
```

请注意，您说的是“以 10 为底”，因此您实际上可能希望禁止额外的前导零，因为“014”可能意味着八进制：

```
/^[-+]?(?:\.\d+|(?:0|[1-9]\d*)(?:\.\d*)?)$/
/^[-+]?(\.\d+|(0|[1-9]\d*)(\.\d*)?)$/ 
```

最后，您可能需要替换`\d`为，`[0-9]`因为某些正则表达式不支持`\d`，或者因为某些正则表达式允许`\d`匹配 0..9 以外的 Unicode“数字”，例如“ARABIC-INDIC DIGIT”。

```
/^[-+]?(?:\.[0-9]+|(?:0|[1-9][0-9]*)(?:\.[0-9]*)?)$/
/^[-+]?(\.[0-9]+|(0|[1-9][0-9]*)(\.[0-9]*)?)$/ 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-07T00:17:01.323

The regular expression in [perlfaq4: How do I determine whether a scalar is a number/whole/integer/float?](http://faq.perl.org/perlfaq4.html#How_do_I_determine_w) does what you want, and it handles the "e" notation too.

```
while( <DATA> )
    {
    chomp;

    print /^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/ ?
        "$_ Works\n"
        :
        "$_ Fails\n"
        ;
    }

__DATA__
1
-1
- 3
1.2
1.2.3
7e4
.123
123.
.
-.5

```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-25T21:35:59.930

匹配所有指定的示例，不捕获任何组：

```
^[+-]?(?:\d+(?:\.\d*)?|\.\d+)$ 
```

不匹配“1”。（ETC）：

```
^[+-]?(?:\d+(?:\.\d+)?|\.\d+)$ 
```

不打扰空格（使用修剪功能）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T21:09:22.147

根据您在此功能中编码的语言，可能已经存在。

# visual-studio-2008 - Visual Studio 2008 属性窗口慢

> ID：136165
> 
> 赞同：0
> 
> 时间：2008-09-25T21:10:39.197
> 
> 标签：visual-studio-2008

即使在应该解决此问题的所有修补程序和更新之后，我在 Visual Studio 2008 中的属性窗口仍然很慢！发生的情况是在 Web 编辑器中单击表格单元格或类似内容，并且无论我正在处理的页面大小如何，属性窗口都需要一两秒钟才能显示所选项目的属性。

最烦人的事情是有时我会单击一个单元格，选择一个属性并开始输入，但它仍然卡在错误（未选择）的项目上，所以它最终将我输入的内容放在错误的位置，并且然后一旦选择了正确的项目，它就会消失。

就像我说的，我正在运行所有可用的修补程序和服务包。任何人遇到这个并且有任何运气修复它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-13T18:20:12.147

我想我发现了我遇到的问题 - 我关闭了启动页面，并禁用了启动页面刷新选项（它每 60 分钟检查一次最新内容或其他什么），所以现在当我加载环境时，它只是显示空白页。

我不知道为什么这与在 HTML 设计器中选择的项目出现在属性窗口中所需的时间有关，但显然这两件事是相关的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-25T21:13:25.147

关闭所有动画。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T18:51:20.413

不起作用 - 即使关闭动画，属性页切换到新选定对象的速度也很慢。例如，如果您在一个表中并且它正在显示属性，当您点击“Escape”以选择父表时，父表的属性需要 2-3 秒才能出现。

# python - 获取文件的最后n行，类似于tail

> ID：136168
> 
> 赞同：192
> 
> 时间：2008-09-25T21:11:11.363
> 
> 标签：python, file, file-io, tail, logfile

我正在为 Web 应用程序编写日志文件查看器，为此我想通过日志文件的行进行分页。文件中的项目是基于行的，最新的项目位于底部。

所以我需要一种`tail()`可以`n`从底部读取行并支持偏移的方法。这是我想出的帽子：

```
def tail(f, n, offset=0):
    """Reads a n lines from f with an offset of offset lines."""
    avg_line_length = 74
    to_read = n + offset
    while 1:
        try:
            f.seek(-(avg_line_length * to_read), 2)
        except IOError:
            # woops.  apparently file is smaller than what we want
            # to step back, go to the beginning instead
            f.seek(0)
        pos = f.tell()
        lines = f.read().splitlines()
        if len(lines) >= to_read or pos == 0:
            return lines[-to_read:offset and -offset or None]
        avg_line_length *= 1.3 
```

这是一个合理的方法吗？使用偏移量尾随日志文件的推荐方法是什么？

* * *

## 回答 #1

> 赞同：129
> 
> 时间：2008-09-25T21:43:18.447

这可能比你的更快。不对行长做任何假设。一次一个块地返回文件，直到找到正确数量的 '\n' 字符。

```
def tail( f, lines=20 ):
    total_lines_wanted = lines

    BLOCK_SIZE = 1024
    f.seek(0, 2)
    block_end_byte = f.tell()
    lines_to_go = total_lines_wanted
    block_number = -1
    blocks = [] # blocks of size BLOCK_SIZE, in reverse order starting
                # from the end of the file
    while lines_to_go > 0 and block_end_byte > 0:
        if (block_end_byte - BLOCK_SIZE > 0):
            # read the last block we haven't yet read
            f.seek(block_number*BLOCK_SIZE, 2)
            blocks.append(f.read(BLOCK_SIZE))
        else:
            # file too small, start from begining
            f.seek(0,0)
            # only read what was not read
            blocks.append(f.read(block_end_byte))
        lines_found = blocks[-1].count('\n')
        lines_to_go -= lines_found
        block_end_byte -= BLOCK_SIZE
        block_number -= 1
    all_read_text = ''.join(reversed(blocks))
    return '\n'.join(all_read_text.splitlines()[-total_lines_wanted:]) 
```

我不喜欢关于行长的棘手假设——实际上——你永远无法知道这样的事情。

通常，这将在第一次或第二次通过循环时定位最后 20 行。如果您的 74 个字符实际上是准确的，那么您将块大小设置为 2048，并且您几乎会立即拖尾 20 行。

此外，我不会消耗大量大脑卡路里来尝试与物理操作系统块对齐。使用这些高级 I/O 包，我怀疑您会看到尝试在 OS 块边界上对齐的任何性能后果。如果您使用较低级别的 I/O，那么您可能会看到加速。

* * *

**更新**

*对于 Python 3.2 及更高版本，按照在文本文件中（那些在模式字符串中没有**“b”**打开的文件）中的字节处理过程，只允许相对于文件开头的搜索（例外是搜索到文件末尾与寻找（0, 2））。：*

例如：`f = open('C:/.../../apache_logs.txt', 'rb')`

```
 def tail(f, lines=20):
    total_lines_wanted = lines

    BLOCK_SIZE = 1024
    f.seek(0, 2)
    block_end_byte = f.tell()
    lines_to_go = total_lines_wanted
    block_number = -1
    blocks = []
    while lines_to_go > 0 and block_end_byte > 0:
        if (block_end_byte - BLOCK_SIZE > 0):
            f.seek(block_number*BLOCK_SIZE, 2)
            blocks.append(f.read(BLOCK_SIZE))
        else:
            f.seek(0,0)
            blocks.append(f.read(block_end_byte))
        lines_found = blocks[-1].count(b'\n')
        lines_to_go -= lines_found
        block_end_byte -= BLOCK_SIZE
        block_number -= 1
    all_read_text = b''.join(reversed(blocks))
    return b'\n'.join(all_read_text.splitlines()[-total_lines_wanted:]) 
```

* * *

## 回答 #2

> 赞同：99
> 
> 时间：2008-09-25T21:30:14.810

假设您可以在 Python 2 上使用类似 unix 的系统：

```
import os
def tail(f, n, offset=0):
  stdin,stdout = os.popen2("tail -n "+n+offset+" "+f)
  stdin.close()
  lines = stdout.readlines(); stdout.close()
  return lines[:,-offset] 
```

对于 python 3，你可以这样做：

```
import subprocess
def tail(f, n, offset=0):
    proc = subprocess.Popen(['tail', '-n', n + offset, f], stdout=subprocess.PIPE)
    lines = proc.stdout.readlines()
    return lines[:, -offset] 
```

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2012-12-09T18:21:42.133

这是我的答案。纯蟒蛇。使用 timeit 似乎很快。拖尾具有 100,000 行的日志文件的 100 行：

```
>>> timeit.timeit('tail.tail(f, 100, 4098)', 'import tail; f = open("log.txt", "r");', number=10)
0.0014600753784179688
>>> timeit.timeit('tail.tail(f, 100, 4098)', 'import tail; f = open("log.txt", "r");', number=100)
0.00899195671081543
>>> timeit.timeit('tail.tail(f, 100, 4098)', 'import tail; f = open("log.txt", "r");', number=1000)
0.05842900276184082
>>> timeit.timeit('tail.tail(f, 100, 4098)', 'import tail; f = open("log.txt", "r");', number=10000)
0.5394978523254395
>>> timeit.timeit('tail.tail(f, 100, 4098)', 'import tail; f = open("log.txt", "r");', number=100000)
5.377126932144165 
```

这是代码：

```
import os

def tail(f, lines=1, _buffer=4098):
    """Tail a file and get X lines from the end"""
    # place holder for the lines found
    lines_found = []

    # block counter will be multiplied by buffer
    # to get the block size from the end
    block_counter = -1

    # loop until we find X lines
    while len(lines_found) < lines:
        try:
            f.seek(block_counter * _buffer, os.SEEK_END)
        except IOError:  # either file is too small, or too many lines requested
            f.seek(0)
            lines_found = f.readlines()
            break

        lines_found = f.readlines()

        # we found enough lines, get out
        # Removed this line because it was redundant the while will catch
        # it, I left it for history
        # if len(lines_found) > lines:
        #    break

        # decrement the block counter to get the
        # next X bytes
        block_counter -= 1

    return lines_found[-lines:] 
```

* * *

## 回答 #4

> 赞同：35
> 
> 时间：2008-11-11T05:17:18.083

如果可以接受读取整个文件，则使用双端队列。

```
from collections import deque
deque(f, maxlen=n) 
```

在 2.6 之前，deques 没有 maxlen 选项，但它很容易实现。

```
import itertools
def maxque(items, size):
    items = iter(items)
    q = deque(itertools.islice(items, size))
    for item in items:
        del q[0]
        q.append(item)
    return q 
```

如果需要从末尾读取文件，则使用疾驰（又名指数）搜索。

```
def tail(f, n):
    assert n >= 0
    pos, lines = n+1, []
    while len(lines) <= n:
        try:
            f.seek(-pos, 2)
        except IOError:
            f.seek(0)
            break
        finally:
            lines = list(f)
        pos *= 2
    return lines[-n:] 
```

* * *

## 回答 #5

> 赞同：26
> 
> 时间：2011-08-13T00:43:38.617

S.Lott 上面的回答几乎对我有用，但最终给了我部分内容。事实证明，它破坏了块边界上的数据，因为数据以相反的顺序保存读取的块。调用 ''.join(data) 时，块的顺序错误。这解决了这个问题。

```
def tail(f, window=20):
    """
    Returns the last `window` lines of file `f` as a list.
    f - a byte file-like object
    """
    if window == 0:
        return []
    BUFSIZ = 1024
    f.seek(0, 2)
    bytes = f.tell()
    size = window + 1
    block = -1
    data = []
    while size > 0 and bytes > 0:
        if bytes - BUFSIZ > 0:
            # Seek back one whole BUFSIZ
            f.seek(block * BUFSIZ, 2)
            # read BUFFER
            data.insert(0, f.read(BUFSIZ))
        else:
            # file too small, start from begining
            f.seek(0,0)
            # only read what was not read
            data.insert(0, f.read(bytes))
        linesFound = data[0].count('\n')
        size -= linesFound
        bytes -= BUFSIZ
        block -= 1
    return ''.join(data).splitlines()[-window:] 
```

* * *

## 回答 #6

> 赞同：23
> 
> 时间：2009-03-28T11:13:44.380

我最终使用的代码。我认为这是迄今为止最好的：

```
def tail(f, n, offset=None):
    """Reads a n lines from f with an offset of offset lines.  The return
    value is a tuple in the form ``(lines, has_more)`` where `has_more` is
    an indicator that is `True` if there are more lines in the file.
    """
    avg_line_length = 74
    to_read = n + (offset or 0)

    while 1:
        try:
            f.seek(-(avg_line_length * to_read), 2)
        except IOError:
            # woops.  apparently file is smaller than what we want
            # to step back, go to the beginning instead
            f.seek(0)
        pos = f.tell()
        lines = f.read().splitlines()
        if len(lines) >= to_read or pos == 0:
            return lines[-to_read:offset and -offset or None], \
                   len(lines) > to_read or pos > 0
        avg_line_length *= 1.3 
```

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2011-07-25T09:18:10.030

使用 mmap 的简单快速解决方案：

```
import mmap
import os

def tail(filename, n):
    """Returns last n lines from the filename. No exception handling"""
    size = os.path.getsize(filename)
    with open(filename, "rb") as f:
        # for Windows the mmap parameters are different
        fm = mmap.mmap(f.fileno(), 0, mmap.MAP_SHARED, mmap.PROT_READ)
        try:
            for i in xrange(size - 1, -1, -1):
                if fm[i] == '\n':
                    n -= 1
                    if n == -1:
                        break
            return fm[i + 1 if i else 0:].splitlines()
        finally:
            fm.close() 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2019-12-25T04:06:48.277

最简单的方法是使用`deque`：

```
from collections import deque

def tail(filename, n=10):
    with open(filename) as f:
        return deque(f, n) 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2015-12-01T20:34:50.440

应评论者的要求发布[我对类似问题的回答的答案，](/a/33811809/364696)其中使用相同的技术来改变文件的最后一行，而不仅仅是获取它。

对于较大的文件，[`mmap`](https://docs.python.org/3/library/mmap.html)这是执行此操作的最佳方法。为了改进现有`mmap`答案，此版本可在 Windows 和 Linux 之间移植，并且应该运行得更快（尽管如果不对 32 位 Python 与 GB 范围内的文件进行一些修改，它将无法工作，请参阅[其他答案以获取有关处理此问题的提示，并用于修改以在 Python 2 上工作](/a/33811809/364696)）。

```
import io  # Gets consistent version of open for both Py2.7 and Py3.x
import itertools
import mmap

def skip_back_lines(mm, numlines, startidx):
    '''Factored out to simplify handling of n and offset'''
    for _ in itertools.repeat(None, numlines):
        startidx = mm.rfind(b'\n', 0, startidx)
        if startidx < 0:
            break
    return startidx

def tail(f, n, offset=0):
    # Reopen file in binary mode
    with io.open(f.name, 'rb') as binf, mmap.mmap(binf.fileno(), 0, access=mmap.ACCESS_READ) as mm:
        # len(mm) - 1 handles files ending w/newline by getting the prior line
        startofline = skip_back_lines(mm, offset, len(mm) - 1)
        if startofline < 0:
            return []  # Offset lines consumed whole file, nothing to return
            # If using a generator function (yield-ing, see below),
            # this should be a plain return, no empty list

        endoflines = startofline + 1  # Slice end to omit offset lines

        # Find start of lines to capture (add 1 to move from newline to beginning of following line)
        startofline = skip_back_lines(mm, n, startofline) + 1

        # Passing True to splitlines makes it return the list of lines without
        # removing the trailing newline (if any), so list mimics f.readlines()
        return mm[startofline:endoflines].splitlines(True)
        # If Windows style \r\n newlines need to be normalized to \n, and input
        # is ASCII compatible, can normalize newlines with:
        # return mm[startofline:endoflines].replace(os.linesep.encode('ascii'), b'\n').splitlines(True) 
```

这假设拖尾的行数足够小，您可以一次安全地将它们全部读入内存；您还可以将其设为生成器函数，并通过将最后一行替换为以下内容来手动读取一行：

```
 mm.seek(startofline)
        # Call mm.readline n times, or until EOF, whichever comes first
        # Python 3.2 and earlier:
        for line in itertools.islice(iter(mm.readline, b''), n):
            yield line

        # 3.3+:
        yield from itertools.islice(iter(mm.readline, b''), n) 
```

最后，以二进制模式读取（必须使用`mmap`），因此它给`str`出行（Py2）和`bytes`行（Py3）；如果您想要`unicode`（Py2）或`str`（Py3），可以调整迭代方法以为您解码和/或修复换行符：

```
 lines = itertools.islice(iter(mm.readline, b''), n)
        if f.encoding:  # Decode if the passed file was opened with a specific encoding
            lines = (line.decode(f.encoding) for line in lines)
        if 'b' not in f.mode:  # Fix line breaks if passed file opened in text mode
            lines = (line.replace(os.linesep, '\n') for line in lines)
        # Python 3.2 and earlier:
        for line in lines:
            yield line
        # 3.3+:
        yield from lines 
```

注意：我在无法访问 Python 进行测试的机器上输入了这一切。如果我输入任何错误，请告诉我；这与我*认为*应该可以使用[的其他答案](/a/33811809/364696)非常相似，但是调整（例如处理 an ）可能会导致细微的错误。如果有任何错误，请在评论中告诉我。*`offset`*

 ** * *

## 回答 #10

> 赞同：5
> 
> 时间：2017-08-30T12:40:01.197

将@papercrane 解决方案更新为 python3。使用 and 打开文件`open(filename, 'rb')`：

```
def tail(f, window=20):
    """Returns the last `window` lines of file `f` as a list.
    """
    if window == 0:
        return []

    BUFSIZ = 1024
    f.seek(0, 2)
    remaining_bytes = f.tell()
    size = window + 1
    block = -1
    data = []

    while size > 0 and remaining_bytes > 0:
        if remaining_bytes - BUFSIZ > 0:
            # Seek back one whole BUFSIZ
            f.seek(block * BUFSIZ, 2)
            # read BUFFER
            bunch = f.read(BUFSIZ)
        else:
            # file too small, start from beginning
            f.seek(0, 0)
            # only read what was not read
            bunch = f.read(remaining_bytes)

        bunch = bunch.decode('utf-8')
        data.insert(0, bunch)
        size -= bunch.count('\n')
        remaining_bytes -= BUFSIZ
        block -= 1

    return ''.join(data).splitlines()[-window:] 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2018-01-04T01:45:20.553

一个更干净的 python3 兼容版本，它不插入但追加和反转：

```
def tail(f, window=1):
    """
    Returns the last `window` lines of file `f` as a list of bytes.
    """
    if window == 0:
        return b''
    BUFSIZE = 1024
    f.seek(0, 2)
    end = f.tell()
    nlines = window + 1
    data = []
    while nlines > 0 and end > 0:
        i = max(0, end - BUFSIZE)
        nread = min(end, BUFSIZE)

        f.seek(i)
        chunk = f.read(nread)
        data.append(chunk)
        nlines -= chunk.count(b'\n')
        end -= nread
    return b'\n'.join(b''.join(reversed(data)).splitlines()[-window:]) 
```

像这样使用它：

```
with open(path, 'rb') as f:
    last_lines = tail(f, 3).decode('utf-8') 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2010-06-10T21:28:20.193

基于 S.Lott 的最高投票答案（2008 年 9 月 25 日 21:43），但对于小文件是固定的。

```
def tail(the_file, lines_2find=20):  
    the_file.seek(0, 2)                         #go to end of file
    bytes_in_file = the_file.tell()             
    lines_found, total_bytes_scanned = 0, 0
    while lines_2find+1 > lines_found and bytes_in_file > total_bytes_scanned: 
        byte_block = min(1024, bytes_in_file-total_bytes_scanned)
        the_file.seek(-(byte_block+total_bytes_scanned), 2)
        total_bytes_scanned += byte_block
        lines_found += the_file.read(1024).count('\n')
    the_file.seek(-total_bytes_scanned, 2)
    line_list = list(the_file.readlines())
    return line_list[-lines_2find:]

    #we read at least 21 line breaks from the bottom, block by block for speed
    #21 to ensure we don't get a half line 
```

希望这是有用的。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2012-04-16T13:26:32.587

我发现上面的 Popen 是最好的解决方案。它又快又脏，它适用于 Unix 机器上的 python 2.6 我使用了以下

```
def GetLastNLines(self, n, fileName):
    """
    Name:           Get LastNLines
    Description:        Gets last n lines using Unix tail
    Output:         returns last n lines of a file
    Keyword argument:
    n -- number of last lines to return
    filename -- Name of the file you need to tail into
    """
    p = subprocess.Popen(['tail','-n',str(n),self.__fileName], stdout=subprocess.PIPE)
    soutput, sinput = p.communicate()
    return soutput 
```

soutput 将包含最后 n 行代码。逐行遍历 soutput：

```
for line in GetLastNLines(50,'myfile.log').split('\n'):
    print line 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2012-10-06T18:23:37.210

pypi 上有一些现有的 tail 实现，您可以使用 pip 安装它们：

*   mtFileUtil
*   多尾
*   log4tailer
*   ...

根据您的情况，使用这些现有工具之一可能会有优势。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2019-05-15T03:51:54.393

简单的 ：

```
with open("test.txt") as f:
data = f.readlines()
tail = data[-2:]
print(''.join(tail) 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-25T21:40:32.557

对于非常大的文件（在您可能想要使用 tail 的日志文件情况下很常见），为了提高效率，您通常希望避免读取整个文件（即使您这样做而不是一次将整个文件读入内存）但是，您这样做需要以某种方式计算行而不是字符的偏移量。一种可能性是用 seek() 逐个字符向后读取，但这非常慢。相反，最好在更大的块中处理。

我有一个我不久前编写的实用程序函数，用于向后读取可以在这里使用的文件。

```
import os, itertools

def rblocks(f, blocksize=4096):
    """Read file as series of blocks from end of file to start.

    The data itself is in normal order, only the order of the blocks is reversed.
    ie. "hello world" -> ["ld","wor", "lo ", "hel"]
    Note that the file must be opened in binary mode.
    """
    if 'b' not in f.mode.lower():
        raise Exception("File must be opened using binary mode.")
    size = os.stat(f.name).st_size
    fullblocks, lastblock = divmod(size, blocksize)

    # The first(end of file) block will be short, since this leaves 
    # the rest aligned on a blocksize boundary.  This may be more 
    # efficient than having the last (first in file) block be short
    f.seek(-lastblock,2)
    yield f.read(lastblock)

    for i in range(fullblocks-1,-1, -1):
        f.seek(i * blocksize)
        yield f.read(blocksize)

def tail(f, nlines):
    buf = ''
    result = []
    for block in rblocks(f):
        buf = block + buf
        lines = buf.splitlines()

        # Return all lines except the first (since may be partial)
        if lines:
            result.extend(lines[1:]) # First line may not be complete
            if(len(result) >= nlines):
                return result[-nlines:]

            buf = lines[0]

    return ([buf]+result)[-nlines:]

f=open('file_to_tail.txt','rb')
for line in tail(f, 20):
    print line 
```

[编辑] 添加了更具体的版本（避免需要反转两次）

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2010-11-09T06:50:09.913

您可以使用 f.seek(0, 2) 转到文件末尾，然后使用以下 readline() 替换逐行读取：

```
def readline_backwards(self, f):
    backline = ''
    last = ''
    while not last == '\n':
        backline = last + backline
        if f.tell() <= 0:
            return backline
        f.seek(-1, 1)
        last = f.read(1)
        f.seek(-1, 1)
    backline = last
    last = ''
    while not last == '\n':
        backline = last + backline
        if f.tell() <= 0:
            return backline
        f.seek(-1, 1)
        last = f.read(1)
        f.seek(-1, 1)
    f.seek(1, 1)
    return backline 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2011-01-20T19:29:37.357

基于 Eyecue 的回答（2010 年 6 月 10 日 21:28）：此类将 head() 和 tail() 方法添加到文件对象。

```
class File(file):
    def head(self, lines_2find=1):
        self.seek(0)                            #Rewind file
        return [self.next() for x in xrange(lines_2find)]

    def tail(self, lines_2find=1):  
        self.seek(0, 2)                         #go to end of file
        bytes_in_file = self.tell()             
        lines_found, total_bytes_scanned = 0, 0
        while (lines_2find+1 > lines_found and
               bytes_in_file > total_bytes_scanned): 
            byte_block = min(1024, bytes_in_file-total_bytes_scanned)
            self.seek(-(byte_block+total_bytes_scanned), 2)
            total_bytes_scanned += byte_block
            lines_found += self.read(1024).count('\n')
        self.seek(-total_bytes_scanned, 2)
        line_list = list(self.readlines())
        return line_list[-lines_2find:] 
```

用法：

```
f = File('path/to/file', 'r')
f.head(3)
f.tail(3) 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2011-04-12T16:14:42.537

如果文件不以 \n 结尾或确保读取完整的第一行，则其中一些解决方案会出现问题。

```
def tail(file, n=1, bs=1024):
    f = open(file)
    f.seek(-1,2)
    l = 1-f.read(1).count('\n') # If file doesn't end in \n, count it anyway.
    B = f.tell()
    while n >= l and B > 0:
            block = min(bs, B)
            B -= block
            f.seek(B, 0)
            l += f.read(block).count('\n')
    f.seek(B, 0)
    l = min(l,n) # discard first (incomplete) line if l > n
    lines = f.readlines()[-l:]
    f.close()
    return lines 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2016-06-19T01:54:08.593

这是一个非常简单的实现：

```
with open('/etc/passwd', 'r') as f:
  try:
    f.seek(0,2)
    s = ''
    while s.count('\n') < 11:
      cur = f.tell()
      f.seek((cur - 10))
      s = f.read(10) + s
      f.seek((cur - 10))
    print s
  except Exception as e:
    f.readlines() 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2018-12-18T23:49:41.803

有一个非常有用的[模块](https://pypi.org/project/file-read-backwards/)可以做到这一点：

```
from file_read_backwards import FileReadBackwards

with FileReadBackwards("/tmp/file", encoding="utf-8") as frb:

# getting lines by lines starting from the last line up
for l in frb:
    print(l) 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2019-07-30T17:37:10.253

[更新A.Coady](https://stackoverflow.com/a/280083/9485283)给出的答案

适用于**python 3**。

这使用[指数搜索](https://en.wikipedia.org/wiki/Exponential_search)并且只会缓冲`N`后面的行并且非常有效。

```
import time
import os
import sys

def tail(f, n):
    assert n >= 0
    pos, lines = n+1, []

    # set file pointer to end

    f.seek(0, os.SEEK_END)

    isFileSmall = False

    while len(lines) <= n:
        try:
            f.seek(f.tell() - pos, os.SEEK_SET)
        except ValueError as e:
            # lines greater than file seeking size
            # seek to start
            f.seek(0,os.SEEK_SET)
            isFileSmall = True
        except IOError:
            print("Some problem reading/seeking the file")
            sys.exit(-1)
        finally:
            lines = f.readlines()
            if isFileSmall:
                break

        pos *= 2

    print(lines)

    return lines[-n:]

with open("stream_logs.txt") as f:
    while(True):
        time.sleep(0.5)
        print(tail(f,2)) 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2013-05-12T12:11:01.107

我不得不从文件的最后一行读取一个特定的值，然后偶然发现了这个线程。我没有在 Python 中重新发明轮子，而是得到了一个很小的 ​​shell 脚本，保存为 /usr/local/bin/get_last_netp：

```
#! /bin/bash
tail -n1 /home/leif/projects/transfer/export.log | awk {'print $14'} 
```

在 Python 程序中：

```
from subprocess import check_output

last_netp = int(check_output("/usr/local/bin/get_last_netp")) 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2013-05-12T12:38:55.377

不是第一个使用双端队列的例子，而是一个更简单的例子。这是通用的：它适用于任何可迭代的对象，而不仅仅是文件。

```
#!/usr/bin/env python
import sys
import collections
def tail(iterable, N):
    deq = collections.deque()
    for thing in iterable:
        if len(deq) >= N:
            deq.popleft()
        deq.append(thing)
    for thing in deq:
        yield thing
if __name__ == '__main__':
    for line in tail(sys.stdin,10):
        sys.stdout.write(line) 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2014-04-25T10:24:36.673

```
This is my version of tailf

import sys, time, os

filename = 'path to file'

try:
    with open(filename) as f:
        size = os.path.getsize(filename)
        if size < 1024:
            s = size
        else:
            s = 999
        f.seek(-s, 2)
        l = f.read()
        print l
        while True:
            line = f.readline()
            if not line:
                time.sleep(1)
                continue
            print line
except IOError:
    pass 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2014-08-22T15:52:53.540

```
import time

attemps = 600
wait_sec = 5
fname = "YOUR_PATH"

with open(fname, "r") as f:
    where = f.tell()
    for i in range(attemps):
        line = f.readline()
        if not line:
            time.sleep(wait_sec)
            f.seek(where)
        else:
            print line, # already has newline 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2018-03-03T21:54:03.857

```
import itertools
fname = 'log.txt'
offset = 5
n = 10
with open(fname) as f:
    n_last_lines = list(reversed([x for x in itertools.islice(f, None)][-(offset+1):-(offset+n+1):-1])) 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2018-06-17T06:40:53.000

```
abc = "2018-06-16 04:45:18.68"
filename = "abc.txt"
with open(filename) as myFile:
    for num, line in enumerate(myFile, 1):
        if abc in line:
            lastline = num
print "last occurance of work at file is in "+str(lastline) 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2019-10-02T17:59:49.903

另一种解决方案

如果你的 txt 文件看起来像这样：鼠标蛇猫蜥蜴狼狗

你可以通过简单地在 python ''' 中使用数组索引来反转这个文件

```
contents=[]
def tail(contents,n):
    with open('file.txt') as file:
        for i in file.readlines():
            contents.append(i)

    for i in contents[:n:-1]:
        print(i)

tail(contents,-5) 
```

结果：狗狼蜥蜴猫

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2021-04-23T15:00:20.960

好！我有一个类似的问题，虽然我只需要**LAST LINE ONLY**，所以我想出了自己的解决方案

```
def get_last_line(filepath):
    try:
        with open(filepath,'rb') as f:
            f.seek(-1,os.SEEK_END)
            text = [f.read(1)]
            while text[-1] != '\n'.encode('utf-8') or len(text)==1:
                f.seek(-2, os.SEEK_CUR)
                text.append(f.read(1))
    except Exception as e:
        pass
    return ''.join([t.decode('utf-8') for t in text[::-1]]).strip() 
```

此函数返回文件中的最后一个字符串
我有一个 1.27gb 的日志文件，找到最后一行所需的时间非常少（甚至不到半秒）

* * *

## 回答 #31

> 赞同：-1
> 
> 时间：2008-09-25T22:03:09.833

再想一想，这可能和这里的任何东西一样快。

```
def tail( f, window=20 ):
    lines= ['']*window
    count= 0
    for l in f:
        lines[count%window]= l
        count += 1
    print lines[count%window:], lines[:count%window] 
```

这要简单得多。它似乎确实以良好的速度发展。

* * *

## 回答 #32

> 赞同：-1
> 
> 时间：2018-06-18T12:03:11.507

我找到了一种可能最简单的方法来查找文件的第一行或最后 N 行

**文件的最后 N 行（例如：N=10）**

```
file=open("xyz.txt",'r")
liner=file.readlines()
for ran in range((len(liner)-N),len(liner)):
    print liner[ran] 
```

**文件的前 N ​​行（例如：N=10）**

```
file=open("xyz.txt",'r")
liner=file.readlines()
for ran in range(0,N+1):
    print liner[ran] 
```

* * *

## 回答 #33

> 赞同：-2
> 
> 时间：2018-06-20T11:49:34.883

很简单：

```
def tail(fname,nl):
with open(fname) as f:
    data=f.readlines() #readlines return a list
    print(''.join(data[-nl:])) 
```

* * *

## 回答 #34

> 赞同：-5
> 
> 时间：2016-05-12T02:57:48.817

虽然这对于大文件来说并不是很有效，但这段代码非常简单：

1.  它读取文件对象，`f`.
2.  它使用换行符分割返回的字符串，`\n`.
3.  它获取数组列表最后一个索引，使用负号代表最后一个索引，并`:`获取一个子数组。

    ```
    def tail(f,n):
        return "\n".join(f.read().split("\n")[-n:]) 
    ```

# c# - 如何在运行时加载的程序集中使用通用 log4net 引用？

> ID：136172
> 
> 赞同：10
> 
> 时间：2008-09-25T21:11:54.077
> 
> 标签：c#, reflection, logging, log4net, dynamic-binding

我有一个单线程应用程序，它在运行时使用以下内容加载多个程序集：

```
objDLL = Assembly.LoadFrom(strDLLs[i]); 
```

我希望以这种方式加载的程序集使用与其他程序集相同的 log4net.ILog 引用。但似乎运行时加载的程序集完全有不同的引用，需要它们自己的配置。有谁知道单个 log4net.ILog 是否可以在运行时使用 .NET 接口加载的程序集中使用？

这是Program类中log4net.ILog的创建和支持代码：

```
 // Configure log4net using the .config file
   [assembly: log4net.Config.XmlConfigurator(Watch = true)]

   public static class Program
   {
      private static log4net.ILog m_Log = null;

      [STAThread]
      public static void Main(string[] args)
      {
         try
         {
            m_Log = log4net.LogManager.GetLogger(
               MethodBase.GetCurrentMethod().DeclaringType);
         }

      }
   } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T21:33:36.287

如果您的所有程序集都实现了一个公共接口，那么您可以有一个属性或构造函数参数，允许您将 ILog 的本地实例传递给动态加载的程序集。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-10-16T15:43:15.480

这个答案晚了4年，但我刚刚遇到了同样的问题。就我而言，我发现正在加载的程序集（来自与调用程序集不同的文件夹）也在加载它自己的 log4net 实例。

我通过从加载运行时程序集的文件夹中删除 log4net.dll 文件解决了这个问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-09T01:44:24.027

您可以通过指定文字记录器名称字符串来获取相同的记录器，从而获得相同的记录器实例。

```
log4net.LogManager.GetLogger("SomeLogger"); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T21:43:20.973

Something about the runtime loaded class prevents the usual one ILog per class from working. I can get a valid ILog instance, but unlike all the other instances it appears not to be configured (all the Is**Enabled flags are set to false). Perhaps the "root" logger is not accessible to the classes loaded at runtime???

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-22T15:17:10.420

我有一个愚蠢的解决方案。您可以将 XmlConfiguration 设置为主 log4net 配置文件。

```
[assembly: log4net.Config.XmlConfigurator(ConfigFile="<configpath>",Watch = true)] 
```

这不是真正的美丽..但它运行。

# c++ - Windows 上最快的小型数据存储

> ID：136175
> 
> 赞同：3
> 
> 时间：2008-09-25T21:12:14.777
> 
> 标签：c++, windows, data-structures, caching, registry

我的应用程序跟踪大约 1000 个对象的状态。这些对象以无特定顺序读取和写入持久存储（序列化）。

现在，该应用程序使用注册表来存储每个对象的状态。这很好，因为：

*   很简单

*   它非常快

*   可以读取/写入单个对象的状态，而无需读取更大的实体（例如从大型 XML 文件中提取片段）

*   有一个不错的编辑器（RegEdit），可以轻松操作单个项目

话虽如此，我想知道是否有更好的方法。SQLite 似乎是一种可能性，但您没有与注册表相同级别的多读取器/多写入器，也没有简单的方法来编辑现有条目。

有更好的建议吗？一堆平面文件？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-25T21:19:25.367

如果您所说的“多读取器/多写入器”的意思是您保持大量线程同时写入存储，那么 SQLite 是线程安全的（您可以有并发 SELECT 并且透明地处理并发写入）。请参阅 [FAQ [1]] 和 grep 以获取“线程安全”

[1]：[http](http://www.sqlite.org/faq.html/) : //www.sqlite.org/faq.html/

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-25T22:54:50.833

如果您确实开始尝试使用 SQLite，您应该知道“开箱即用”它可能看起来不像您想要的那么快，但是通过应用一些已建立的优化技巧可以很快使它变得更快：

[SQLite 优化](http://web.utk.edu/~jplyon/sqlite/SQLite_optimization_FAQ.html "sqlite 调速")

根据数据的大小和可用的 RAM 量，将 sqlite 设置为使用全内存数据库而不是写入磁盘将获得最佳性能提升之一。

对于内存数据库，将 NULL 作为文件名参数传递给`sqlite3_open`并 [确保正确定义了 TEMP_STORE](http://www.sqlite.org/pragma.html#pragma_temp_store)

**另一方面**，如果您告诉 sqlite 使用硬盘，那么您将获得与当前使用 RegEdit 来“即时”操作程序数据类似的好处。

您可以使用 sqlite 模拟当前 RegEdit 技术的方法是使用 sqlite 命令行工具连接到磁盘数据库。您可以在主程序运行时（和/或在中断模式下暂停时）从命令行对 sql 数据运行 UPDATE 语句。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T13:24:11.530

我怀疑这些天任何理智的人都会走这条路，但是您描述的一些内容可以使用 Window 的[Structured/Compound Storage](http://msdn.microsoft.com/en-us/library/aa380369.aspx)来完成。我只提到这一点，因为你问的是*Windows* - 这是/曾经是官方的 Windows 方式来做到这一点。

这就是 DOC 文件的组合方式（但不是新的 DOCX 格式）。从 MSDN 来看，它看起来确实很复杂，但我已经使用过它，它并不是Win32 中*最糟糕*的API。

*   这**并不**简单
*   它很快，我*猜*它比注册表更快。
*   可以读取/写入单个对象的状态，而无需读取一些更大的实体。
*   没有像样的编辑器，但是有一些真正的基本东西（VC++ 6.0 在工具下有“DocFile Viewer”。（是的，就是这样做的）我在网上找到[了](http://www.codeproject.com/KB/macros/ssfview.aspx) 更多[。](http://www.coco.co.uk/developers/CFX.html)
*   你得到一个文件而不是注册表项。
*   您获得了一些老式的 Windows 开发人员极客信誉。

**其他随机想法：** 我认为 XML 是可行的方法（尽管存在随机访问问题）。哎呀，INI文件可能工作。如果需要，注册表会为您提供非常精细的安全性 - 当使用文件的声明更好时，人们似乎忘记了这一点。*如果*我理解你在做什么，嵌入式数据库似乎有点过头了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T21:16:38.213

您需要在每个更改事件上保留对象还是仅在内存中并在关机时存储？如果是这样，只需加载它们并在最后序列化它们，假设您的应用程序运行了很长时间（并且您不与另一个程序共享该状态），那么在内存中将成为赢家。

如果您有固定大小的结构，那么您可以考虑只使用内存映射文件并从中分配内存吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T12:41:02.867

如果您唯一要做的就是序列化/反序列化单个对象（没有花哨的查询），那么请使用 btree 数据库，例如[Berkeley DB](http://www.oracle.com/technology/products/berkeley-db/index.html)。它通过键存储和检索数据块非常快（我假设您的对象有一些可以用作键的 id）并且支持多个进程的访问。

# git - 我应该如何使用 git diff 处理长行？

> ID：136178
> 
> 赞同：251
> 
> 时间：2008-09-25T21:12:34.730
> 
> 标签：git, diff, word-wrap

我正在对文件运行[git-diff](http://www.git-scm.com/docs/git-diff)，但更改位于长行的末尾。

如果我使用光标键向右移动，它会失去颜色编码——更糟糕的是，线条不会对齐——这使得跟踪变化变得更加困难。

有没有办法防止这个问题或简单地换行？

我正在通过 mingw32 运行 Git 1.5.5。

* * *

## 回答 #1

> 赞同：236
> 
> 时间：2010-06-24T06:58:19.240

或者，如果您使用 less 作为默认寻呼机，只需`-S`在查看差异时键入即可重新启用在 less 中的换行。

* * *

## 回答 #2

> 赞同：129
> 
> 时间：2008-09-30T10:43:23.783

输出的显示`git diff`由您使用的任何寻呼机处理。

通常，在 Linux 下`less`会使用。

`GIT_PAGER`您可以通过设置环境变量告诉 git 使用不同的寻呼机。如果您不介意分页（例如，您的终端允许您向后滚动），您可以尝试明确设置`GIT_PAGER`为空以使用分页器停止它。在 Linux 下：

```
$ GIT_PAGER='' git diff 
```

没有寻呼机，行将换行。

如果您的终端不支持彩色输出，您也可以使用`--no-color`参数将其关闭，或者在 git 配置文件的颜色部分输入一个条目。

```
$ GIT_PAGER='' git diff --no-color 
```

* * *

## 回答 #3

> 赞同：119
> 
> 时间：2010-09-09T04:46:21.267

您还可以使用`git config`设置寻呼机进行换行。

```
$ git config core.pager 'less -r' 
```

设置当前项目的寻呼机设置。

```
$ git config --global core.pager 'less -r' 
```

为所有项目全局设置寻呼机

* * *

## 回答 #4

> 赞同：62
> 
> 时间：2013-10-08T16:53:51.450

在对此[答案](https://stackoverflow.com/a/3107807/313756)[的评论](https://stackoverflow.com/questions/136178/git-diff-handling-long-lines/3107807#comment18876094_3107807)中完全归功于[Josh Diehl](https://stackoverflow.com/users/187812/josh-diehl)，但我觉得这本身应该是一个答案，所以添加它：

处理长行差异的一种方法是使用面向单词的差异。这可以通过以下方式完成：

```
git diff --word-diff 
```

在这种情况下，您将获得显着不同的 diff 输出，它具体显示了一行中发生了什么变化。

例如，而不是得到这样的东西：

```
diff --git a/test-file.txt b/test-file.txt
index 19e6adf..eb6bb81 100644
--- a/test-file.txt
+++ b/test-file.txt
@@ -1 +1 @@
-this is a short line
+this is a slightly longer line 
```

你可能会得到这样的东西：

```
diff --git a/test-file.txt b/test-file.txt
index 19e6adf..eb6bb81 100644
--- a/test-file.txt
+++ b/test-file.txt
@@ -1 +1 @@
this is a [-short-]{+slightly longer+} line 
```

或者，使用着色，而不是这样：

![只是 git diff 的结果](https://i.stack.imgur.com/SdK0E.png)

你可能会得到这个：

![git diff --word-diff 的结果](https://i.stack.imgur.com/iYZut.png)

现在，如果您要比较一条很长的线路，您最初描述的寻呼机情况可能仍然存在问题，并且在其他答案中显然已经解决了这一问题。不过，希望这为您提供了一个新工具，可以更轻松地识别在线上发生了哪些变化。

* * *

## 回答 #5

> 赞同：30
> 
> 时间：2012-09-19T17:32:54.720

要使用 less 作为寻呼机并使换行永久化，您只需启用 fold-long-lines 选项：

```
git config --global core.pager 'less -+S' 
```

这样您就不必在使用 less 时键入它。

干杯

* * *

## 回答 #6

> 赞同：19
> 
> 时间：2009-05-21T02:32:40.993

刚刚google了这个。 `GIT_PAGER='less -r'`为我工作

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2011-05-23T21:57:52.360

Mac OSX：除了someone45's '-S' while less is running 对我来说没有其他答案。使自动换行持久化需要以下操作：

```
git config --global core.pager 'less -+$LESS -FRX' 
```

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2014-05-13T23:10:55.533

自 Git 1.5.3（[2007 年 9 月](http://github.com/git/git/commit/463a849)）

有一个`--no-pager`选项可用。

```
git --no-pager diff 
```

[如何防止 git diff 使用寻呼机？](https://stackoverflow.com/q/2183900/#2183920)

[例子](http://git.661346.n2.nabble.com/git-log-follow-doesn-t-follow-a-rename-over-a-merge-td6480971.html)

从 v2.1 开始，wrap 是默认的

[Git v2.1 发行说明](http://github.com/git/git/blob/50f84e3/Documentation/RelNotes/2.1.0.txt#L30-L37)

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2016-06-30T14:18:30.940

直到现在还没有人指出这一点。它很容易记住，不需要在 git config 中进行额外的配置

```
git diff --color | less -R 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2016-02-11T23:21:05.823

八年后，我从[https://superuser.com/questions/777617/line-wrapping-less-in-os-x-specifically-for-use-with-git-diff](https://superuser.com/questions/777617/line-wrapping-less-in-os-x-specifically-for-use-with-git-diff)找到了一个更好的答案：

```
git config core.pager `fold -w 80 | less` 
```

现在你首先通过折叠管道 git diff，然后到 less: Wrapped，更少的页面高度是正确的，保持语法突出显示。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2017-03-11T20:10:17.097

当您使用“git diff”并且它显示几个页面时（您在页面末尾看到“：”），在这种情况下，您可以键入“-S”并按 Enter。（S 应该是大写）。它将切换折叠长线。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-09-25T21:48:28.560

不是一个完美的解决方案，但可以显示这些信息，`gitk`并`git-gui`有滚动条。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2013-07-11T15:07:32.183

您可以简单地将 git diff 的输出通过管道传输到更多：

```
git diff | more 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2016-02-01T23:58:54.340

列出当前/默认配置：

```
 $ git config --global core.pager  
    less -FXRS -x2 
```

然后更新并省略 -S 之类的：

```
 $ git config --global core.pager 'less -FXR -x2' 
```

-S：使长于屏幕宽度的行被截断而不是折叠。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2008-09-26T11:59:33.293

遇到麻烦时，我经常求助于 DiffMerge。具有在线差异突出显示的优秀差异工具。此外，在最新版本中，他们添加了一种具有水平模式的模式。

不过，我无法配置 git 来使用它。所以我必须先搞定这两个版本的文件。

# .net - 在应用程序中集中错误消息的最佳方法是什么？

> ID：136190
> 
> 赞同：2
> 
> 时间：2008-09-25T21:15:08.997
> 
> 标签：.net, error-handling, coding-style

在使用错误消息（或其他用户消息）的整个应用程序中，我通常对字符串进行硬编码。显然，这可能非常糟糕（尤其是当您可能不得不返回并本地化应用程序时）。集中这些字符串的最佳方法是什么？静态类？常数？一个 XML 文件？或组合（例如创建一个带有用于从 xml 文件中读取的常量的静态类）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-25T21:20:22.590

在资源文件中创建字符串。然后，您可以通过添加其他资源文件进行本地化。

查看[http://geekswithblogs.net/dotNETPlayground/archive/2007/11/09/116726.aspx](http://geekswithblogs.net/dotNETPlayground/archive/2007/11/09/116726.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T21:18:20.427

使用字符串资源。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T21:19:49.407

我总是根据您的语言（静态类？应用程序范围的控制器？资源文件？）在最有意义的地方定义常量，并在需要的地方/时间调用它们。当然，它们在某种程度上仍然是“硬编码”的，但它们也很好地集中，命名约定是有意义的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-25T21:22:13.380

创建一个资源 (.resx) 文件并在其中添加您的字符串。VS 将为您生成一个类，以便您轻松访问这些资源，并具有完整的智能。然后，您可以以相同的方式添加本地化资源。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T21:19:05.167

.net 对所谓的资源文件有很好的支持，您可以在其中存储一种语言的所有字符串。

# regex - 如何使此“使用未初始化值”警告消失？

> ID：136191
> 
> 赞同：1
> 
> 时间：2008-09-25T21:15:20.103
> 
> 标签：regex, perl

假设我想编写一个正则表达式将所有`<abc>`,`<def>`和`<ghi>`标签更改为`<xyz>`标签.. 我还想将它们的结束标签更改为`</xyz>`. 这似乎是一个合理的正则表达式（忽略反引号；如果我不包含小于号，StackOverflow 会遇到麻烦）：

```
`s!<(/)?(abc|def|ghi)>!<${1}xyz>!g;` 
```

它也有效。唯一的问题是，对于打开标签，可选的 $1 变量被分配为 undef，因此我收到“使用未初始化的值...”警告。

解决此问题的优雅方法是什么？我宁愿不把它变成两个单独的正则表达式，一个用于打开标签，另一个用于关闭标签，因为这样需要维护两个 taglist 副本，而不仅仅是一个。

**编辑：**我知道我可以在代码的这个区域关闭警告，但我不认为那是“优雅的”。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-25T21:35:27.310

在捕获括号内移动问号。这样 $1 将始终被定义，但可能是一个零长度的字符串。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-25T21:29:32.723

怎么样：

```
`s!(</?)(abc|def|ghi)>!${1}xyz>!g;` 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T21:28:33.037

你可以让你的第一场比赛成为`(</?)`，并摆脱`<`“替换”方面的硬编码。那么 $1 总是有`<`or `</`。可能有更优雅的解决方案来解决警告问题，但这应该处理实际问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-25T21:28:34.957

这是一种方法：

```
 s!<(/?)(abc|def|ghi)>!<$1xyz>!g; 
```

更新：删除了关于使用的无关评论`(?:pattern)`。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-25T21:38:26.163

`s!<(/?)(abc|def|ghi)>!<${1}xyz>!g;`

唯一的区别是更改“（/）？” 到 ”（/？）”。您已经确定了几个功能解决方案。我想，这个有你所要求的优雅。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-25T21:30:27.760

要使正则表达式在任何一种情况下都捕获 $1，请尝试：

```
 s!<(/|)?(abc|def|ghi)>!<${1}xyz>!g;
       ^
       note the pipe symbol, meaning '/' or '' 
```

对于''，这将捕获'<'和'abc>'之间的''，对于''，捕获'<'和'abc>'之间的'/'。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T08:38:51.180

> 我宁愿不把它变成两个单独的正则表达式，一个用于打开标签，另一个用于结束标签，因为有两个 taglist 副本需要维护

为什么？将您的 taglist 放入一个变量中，并将该变量插入到您喜欢的任意数量的正则表达式中。我什至会考虑使用单个正则表达式，因为复杂的正则表达式更具可读性（什么正则表达式不复杂？）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-27T11:36:38.847

要小心，因为 HTML 比乍一看要难一些。例如，是否要将“<abc foo='bar'>”更改为“<xyz foo='bar'>”？你的正则表达式不会。是否要更改“<img alt='<abc>'>”？正则表达式会。相反，您可能想做这样的事情：

```
use HTML::TreeBuilder;
my $tree=HTML::TreeBuilder->new_from_content("<abc>asdf</abc>");
for my $tag (qw<abc def ghi>) {
  for my $elem ($tree->look_down(_tag => $tag)) {
    $elem->tag('xyz');
  }
}
print $tree->as_HTML; 
```

这使您不必自己进行解析 HTML 的繁琐工作。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-09-25T21:29:29.073

添加

```
no warnings 'uninitialized'; 
```

或者

```
s!<(/)?(abc|def|ghi)>! join '', '<', ${1}||'', 'xyz>' !ge; 
```

# c# - 尝试从 C# 在 ActiveX WebBrowser 中设置/获取 JavaScript 变量

> ID：136195
> 
> 赞同：1
> 
> 时间：2008-09-25T21:15:44.317
> 
> 标签：c#, javascript, activex, browser

我们有一个包含 ActiveX WebBrowser 控件的 Windows 应用程序。作为此应用程序常规操作的一部分，将对 ActiveX WebBrowser 控件显示的页面进行修改。这些修改的一部分涉及在加载到 ActiveX WebBrowser 的网页中设置 JavaScript 变量。

我们需要在 C# 中初始化这个变量（最初，VB6 代码正在初始化这个值）。此变量的值是 COM 可见的类对象。

但是，为简单起见，我们将问题简化为设置字符串值。我们的原始页面涉及框架等，但同样的问题发生在这样的页面中：

```
<HTML>
 <HEAD>
  <TITLE>Test</TITLE>
  <SCRIPT type="text/javascript">
   var field = 'hello world';
  </SCRIPT>
 </HEAD>
 <BODY>
   <input type="button" value="See field" onclick="javascript:alert(field);"/>
 </BODY>
</HTML> 
```

我们想要访问*字段*变量并为其赋值。在 VB6 中，这方面的代码非常简单：

```
doc.Script.field = 'newValue' 
```

但是，在 C# 中，我们不得不求助于其他技巧，例如：

```
Microsoft.VisualBasic.CompilerServices.NewLateBinding.LateSet(Script, null, "field",new object[] { "newValue"},null, null); 
```

该页面的重点是测试我们的变量是否由 C# 正确分配。单击该按钮应该会产生 C# 注入的任何新值。例如，单击页面中的按钮，我们会收到一条警报，显示：“newValue”。

这第一次有效，但如果我们重新加载页面，它就不起作用了。在随后的调用中，我们无法设置变量的值`field`。

以前有没有人做过这种手术的经验？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-11-19T14:44:28.833

我认为您正在寻找的是`eval()`Javascript 中的方法。您可以像这样从 C# 调用它：

```
webBrowser1.Document.InvokeScript("eval", new String[] {"1 + 2"}); 
```

此代码将评估`"1 + 2"`并返回`"3"`. 我会想象如果你把

```
InvokeScript("eval", new String[] {"varName = 3"}) 
```

如果该变量在文件中全局可见，您将获得分配给 3 的变量。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T06:22:26.040

如果使用 webBrowser 控件，可以将 ac# 对象分配给 objectForScripting 属性 [http://msdn.microsoft.com/en-us/library/system.windows.forms.webbrowser.objectforscripting.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.webbrowser.objectforscripting.aspx)

之后，您可以在您的 javascript 中使用 window.external 从 javascript 与您的 c# 对象进行交互

如果您出于某种原因使用 activeX 版本，您可以通过 javascript: urls 以编程方式设置您的变量，或者您可以使用 webservice/database/file 或简单地使用您建议的方法来同步您的脚本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T19:18:31.850

这两篇文章帮助我们找到了解决问题的方法。他们概述了人们需要了解的基础知识：

[使用 C# 的 Microsoft Web 浏览器自动化](http://www.codeproject.com/KB/cs/mshtml_automation.aspx)

[使用 MSHTML 高级托管接口](http://www.codeproject.com/KB/cs/advhost.aspx?target=idochostuihandler)

所以我们实现了一个 DocHostUIHandler 接口，它允许我们设置一个 UIHandler，允许我们从 Javascript 中引用该方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T21:18:31.423

我们常用的方法是在页面上添加一个隐藏的文本输入框（ASP.Net控件版）。这样，您可以轻松地在 C# 代码隐藏中设置其值并在客户端 JavaScript 中读取值（当然反之亦然）。

# list - Perl 的地图有什么意义？

> ID：136204
> 
> 赞同：33
> 
> 时间：2008-09-25T21:17:31.580
> 
> 标签：list, perl, dictionary, higher-order-functions

没有真正理解地图功能的意义。任何人都可以用例子解释它的用途吗？

使用它而不是循环是否有任何性能优势，或者它只是糖？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2008-09-25T21:21:15.817

任何时候你想生成一个基于另一个列表的列表：

```
# Double all elements of a list
my @double = map { $_ * 2 } (1,2,3,4,5);
# @double = (2,4,6,8,10); 
```

由于列表很容易成对转换为哈希，如果您想要基于特定属性的对象的哈希表：

```
# @user_objects is a list of objects having a unique_id() method
my %users = map { $_->unique_id() => $_ } @user_objects;
# %users = ( $id => $obj, $id => $obj, ...); 
```

它是一个非常通用的工具，您必须开始使用它才能在您的应用程序中找到好的用途。

出于可读性目的，有些人可能更喜欢冗长的循环代码，但就个人而言，我发现`map`更具可读性。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-09-25T21:45:17.833

首先，这是一种转换数组的简单方法：而不是说 eg

```
my @raw_values = (...);
my @derived_values;
for my $value (@raw_values) {
    push (@derived_values, _derived_value($value));
} 
```

你可以说

```
my @raw_values = (...);
my @derived_values = map { _derived_value($_) } @raw_values; 
```

它对于构建快速查找表也很有用：而不是例如

```
my $sentence = "...";
my @stopwords = (...);
my @foundstopwords;
for my $word (split(/\s+/, $sentence)) {
    for my $stopword (@stopwords) {
       if ($word eq $stopword) {
           push (@foundstopwords, $word);
       }
    }
} 
```

你可以说

```
my $sentence = "...";
my @stopwords = (...);
my %is_stopword = map { $_ => 1 } @stopwords;
my @foundstopwords = grep { $is_stopword{$_} } split(/\s+/, $sentence); 
```

如果您想从另一个列表中派生一个列表，它也很有用，但并不特别需要有一个临时变量使这个地方混乱，例如，而不是

```
my %params = ( username => '...', password => '...', action => $action );
my @parampairs;
for my $param (keys %params) {
    push (@parampairs, $param . '=' . CGI::escape($params{$param}));
}
my $url = $ENV{SCRIPT_NAME} . '?' . join('&amp;', @parampairs); 
```

你说的简单多了

```
my %params = ( username => '...', password => '...', action => $action );
my $url = $ENV{SCRIPT_NAME} . '?'
    . join('&amp;', map { $_ . '=' . CGI::escape($params{$_}) } keys %params); 
```

（编辑：修复了最后一行中缺少的“keys %params”）

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-09-25T21:42:07.280

该`map`函数用于转换列表。它基本上是用于替换某些类型`for[each]`循环的语法糖。一旦你把头绕在它周围，你会在任何地方看到它的用途：

```
my @uppercase = map { uc } @lowercase;
my @hex       = map { sprintf "0x%x", $_ } @decimal;
my %hash      = map { $_ => 1 } @array;
sub join_csv { join ',', map {'"' . $_ . '"' } @_ } 
```

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-09-25T21:36:30.133

有关地图的高级用法，另请参阅[Schwartzian 变换](http://en.wikipedia.org/wiki/Schwartzian_transform)。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-09-25T21:36:44.763

制作查找哈希也很方便：

```
my %is_boolean = map { $_ => 1 } qw(true false); 
```

相当于

```
my %is_boolean = ( true => 1, false => 1 ); 
```

那里没有多少节省，但假设您想定义`%is_US_state`?

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2008-09-26T08:58:16.577

**map**用于通过转换另一个列表的元素来创建一个列表。

**grep**用于通过过滤另一个列表的元素来创建一个列表。

**sort**用于通过对另一个列表的元素进行排序来创建一个列表。

这些运算符中的每一个都接收一个代码块（或表达式），用于转换、过滤或比较列表中的元素。

对于**map**，块的结果成为新列表中的一个（或多个）元素。当前元素别名为 $_。

对于**grep**，块的布尔结果决定是否将原始列表的元素复制到新列表中。当前元素别名为 $_。

对于**sort**，该块接收两个元素（别名为 $a 和 $b）并预期返回 -1、0 或 1 之一，指示 $a 是否大于、等于或小于 $b。

[Schwartzian 变换](http://en.wikipedia.org/wiki/Schwartzian_transform)使用这些运算符来有效地缓存值（属性）以用于对列表进行排序，尤其是在计算这些属性具有不平凡的成本时。

它通过创建一个中间数组来工作，该数组具有作为元素的数组引用，原始元素和我们想要排序的计算值。这个数组被传递给排序，它比较已经计算的值，创建另一个中间数组（这个是排序的），然后传递给另一个映射，该映射丢弃缓存的值，从而将数组恢复到它的初始列表元素（但是现在按所需的顺序）。

示例（在当前目录中创建一个按上次修改时间排序的文件列表）：

```
@file_list = glob('*');
@file_modify_times = map { [ $_, (stat($_))[8] ] } @file_list;
@files_sorted_by_mtime = sort { $a->[1] <=> $b->[1] } @file_modify_times;
@sorted_files = map { $_->[0] } @files_sorted_by_mtime; 
```

通过将运算符链接在一起，中间数组不需要声明变量；

```
@sorted_files = map { $_->[0] } sort { $a->[1] <=> $b->[1] } map { [ $_, (stat($_))[8] ] } glob('*'); 
```

您还可以在排序前通过插入**grep**过滤列表（如果您想过滤相同的缓存值）：

示例（最近 24 小时内修改的文件列表按最后修改时间排序）：

```
 @sorted_files = map { $_->[0] } sort { $a->[1] <=> $b->[1] } grep { $_->[1] > (time - 24 * 3600 } map { [ $_, (stat($_))[8] ] } glob('*'); 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-09-26T03:34:41.050

map 函数是函数式编程范式中的一个想法。在函数式编程中，函数是一等对象，这意味着它们可以作为参数传递给其他函数。地图是一个简单但非常有用的例子。它的参数是一个函数（让我们调用它`f`）和一个列表`l`。 `f`必须是一个接受一个参数的函数，并且 map 只适用`f`于 list 的每个元素`l`。 `f`可以对每个元素做任何你需要做的事情：为每个元素添加一个，对每个元素进行平方，将每个元素写入数据库，或者为每个元素打开一个 Web 浏览器窗口，这恰好是一个有效的 URL。

using 的优点`map`是它很好地封装了对列表元素的迭代。您所要做的就是说“`f`对每个元素都做，`map`由决定如何最好地做到这一点。例如，`map`可以实现将其工作分配给多个线程，并且对调用者完全透明。

请注意，这`map`根本不是 Perl 特有的。它是函数式语言使用的标准技术。它甚至可以在 C 中使用函数指针来实现，或者在 C++ 中使用“函数对象”来实现。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-09-25T21:23:23.097

map 函数对列表的每个元素运行一个表达式，并返回列表结果。可以说我有以下列表

```
@names = ("andrew", "bob", "carol" ); 
```

我想把每个名字的第一个字母大写。我可以遍历它们并调用每个元素的 ucfirst，或者我可以执行以下操作

```
@names = map (ucfirst, @names); 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-01-16T04:00:13.577

“只是糖”是苛刻的。请记住，循环只是糖——if's 和 goto 可以完成循环构造所做的一切，甚至更多。

Map 是一个足够高级的函数，它可以帮助您在头脑中掌握更复杂的操作，因此您可以编写和调试更大的问题。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-09-25T21:32:49.673

用 Hall & Schwartz 的“Effective Perl Programming”来解释，map 可能会被滥用，但我认为最好用它从现有列表中创建一个新列表。

创建 3,2 和 1 的平方列表：

```
@numbers = (3,2,1);
@squares = map { $_ ** 2 } @numbers; 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-09-25T21:38:20.220

生成密码：

```
$ perl -E'say map {chr(32 + 95 * rand)} 1..16'
# -> j'k=$^o7\l'yi28G 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2008-09-25T22:31:24.650

您可以使用 map 转换列表并将结果分配给另一个列表，使用 grep 过滤列表并将结果分配给另一个列表。“其他”列表可以是与您正在转换/过滤的列表相同的变量。

```
my @array = ( 1..5 );
@array = map { $_+5 } @array;
print "@array\n";
@array = grep { $_ < 7 } @array;
print "@array\n"; 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2008-09-25T22:50:16.070

它允许您将列表转换为*表达式*而不是*语句*。想象一下这样定义的士兵哈希：

```
{ name          => 'John Smith'
, rank          => 'Lieutenant'
, serial_number => '382-293937-20'
}; 
```

那么就可以分别对名字列表进行操作了。

例如，

```
map { $_->{name} } values %soldiers 
```

是一个*表达式*。它可以去任何允许表达式的地方——除非你不能分配给它。

```
${[ sort map { $_->{name} } values %soldiers ]}[-1] 
```

索引数组，取最大值。

```
my %soldiers_by_sn = map { $->{serial_number} => $_ } values %soldiers; 
```

我发现操作表达式的优点之一是它减少了来自临时变量的错误。

如果 McCoy 先生想要过滤掉所有 Hatfields 以供考虑，您可以使用最少的编码添加该检查。

```
my %soldiers_by_sn 
    = map  { $->{serial_number}, $_ } 
      grep { $_->{name} !~ m/Hatfield$/ } 
      values %soldiers
      ; 
```

我可以继续链接这些表达式，这样如果我与这​​些数据的交互必须深入到特定目的，我就不必编写很多代码来假装我会做更多的事情。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2008-09-25T21:24:58.803

任何时候您想从现有列表创建新列表时都可以使用它。

例如，您可以在字符串列表上映射解析函数以将它们转换为整数。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-26T16:15:35.267

正如其他人所说， map 从列表中创建列表。考虑将一个列表的内容“映射”到另一个列表中。下面是来自 CGI 程序的一些代码，用于获取专利号列表并打印专利申请的超链接：

```
my @patents = ('7,120,721', '6,809,505', '7,194,673');
print join(", ", map { "<a href=\"http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO1&Sect2=HITOFF&d=PALL&p=1&u=/netahtml/srchnum.htm&r=0&f=S&l=50&TERM1=$_\">$_</a>" } @patents); 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-30T16:28:15.530

正如其他人所说， map 对于转换列表最有用。没有提到的是 map 和“等效” for 循环之间的区别。

一个区别是 for 不适用于修改其迭代的列表的表达式。其中一个终止，另一个没有：

```
perl -e '@x=("x"); map { push @x, $_ } @x'
perl -e '@x=("x"); push @x, $_ for @x' 
```

另一个小的区别是map 块内的*上下文*是一个列表上下文，但是 for 循环赋予了一个 void 上下文。

# c# - 如何在 C# 中编写 SNMP 代理或 SNMP 扩展代理 DLL

> ID：136206
> 
> 赞同：16
> 
> 时间：2008-09-25T21:17:48.493
> 
> 标签：c#, snmp

我需要为我的应用程序编写一个 SNMP 代理。

我阅读了有关如何使用 win32 编写 SNMP 扩展代理 DLL 的[CodeProject 文章](http://www.codeproject.com/KB/IP/SNMP_Agent_DLL__Part1_.aspx)，但想知道是否可以使用托管代码来实现。

另外，是否可以在托管代码中编写我自己的 SNMP 代理并沿着 Windows SNMP 服务运行它？windows SNMP 服务需要在我的服务器上运行以提供基本的操作系统管理信息。

你会推荐什么 C# SNMP 库？我找到了一些 C# SNMP 协议实现，但找不到有关如何实现 SNMP 代理的示例代码 - 大多数示例仅与查询其他代理或发送陷阱有关。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-12-19T14:21:34.980

如果您想使用 .Net Framework 中的 SNMP 协议，请考虑以下库：[#SNMP](http://sharpsnmplib.codeplex.com/)。

似乎可以用它编写您自己的 SNMP 服务器。但是标准的 SNMP 代理架构不是基于 .Net 的，所以——我假设——你不能使用提到的库来扩展它。您必须自己编写，这看起来可以使用提到的库。

希望这有帮助。

br--马布拉

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T03:50:07.533

1.  8年NMS开发用过的最好的库 [——adventnet](http://snmp.adventnet.com/)
2.  你可以自己写，但你需要了解[ASN](http://en.wikipedia.org/wiki/ASN.1)。祝你好运。
3.  SNMP 代理做两件事：查询数据，发送和接收陷阱。你还想让他们做什么？洗衣服？！（抱歉无法抗拒！:)）。

你想用你的 SNMP 代理做什么？！你的应用需要发送陷阱吗？！或从节点查询数据？！

# python - 您如何管理自定义模块？

> ID：136207
> 
> 赞同：9
> 
> 时间：2008-09-25T21:18:09.800
> 
> 标签：python, code-reuse

我编写了大量的 python 脚本，我发现自己重用了我为其他项目编写的大量代码。我的解决方案是确保将代码分成逻辑模块/包（这是给定的）。然后我让它们知道设置工具并将它们发布到 PyPI 上。这使我的其他脚本始终拥有最新的代码，我有一种温暖的模糊感，因为我没有重复自己，而且我的开发总体上变得不那么复杂。我也很高兴有人在那里发现我的代码对他们正在做的事情很方便，但这主要是出于自私的原因:)

对于所有的pythonistas，你如何处理这个？你使用 PyPI 还是 setuptools (easy_install)？或者是其他东西？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T00:13:02.987

我一直在做同样的事情。提取通用功能，使用额外的文档和单元测试/文档测试来美化代码，创建一个 easy_install setup.py，然后在 PyPi 上发布。最近，我创建了一个单独的[Google 代码站点](http://code.google.com/p/7oars/)，我在其中管理源代码并使 wiki 保持最新状态。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T01:39:58.707

我们在这里谈论什么样的模块？如果您打算将您的项目分发给其他 python 开发人员，那么 setuptools 非常棒。但这通常不是向最终用户分发应用程序的好方法。在后一种情况下，您最好的选择是根据您分发它的平台定制您的包装。当然，这很痛苦，但它使最终用户的生活变得更加轻松。

例如，在我的 Debian 系统中，我通常不使用 easy_install，因为要让鸡蛋与包管理器一起工作会有点困难。在 OS X 和 windows 中，您可能希望分别使用 py2app 和 py2exe 打包所有内容。这使最终用户的生活变得更好。毕竟，他们不应该知道或关心您的脚本是用什么语言编写的。他们只需要安装它们。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-02-01T18:53:57.390

我将它们全部离线存储在一个逻辑目录结构中，将常用模块分组为实用程序。这意味着更容易控制我发布和管理的版本。我还将构建过程自动化以解释逻辑目录结构。

# c# - Silverlight 安全 - 敏感数据

> ID：136219
> 
> 赞同：1
> 
> 时间：2008-09-25T21:19:23.980
> 
> 标签：c#, .net, silverlight, security

Silverlight 在客户端工作，因此将任何敏感数据（如连接字符串、密码等）放入代码中似乎不是一件好事。我想在 Silverlight 中构建整个 Web 应用程序，做很多授权和数据库查询。如何使其安全？任何提示和技巧以及我应该避免哪些事情？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T21:34:44.833

我从未开发/使用过 Silverlight 应用程序，但我假设您会使用 Web 服务来代理您的应用程序和数据库之间的通信。

这至少是 Flex 的工作方式。

编辑：这也是 Silverlight 的工作方式

# tcsh - 从 .aliases 重定向 tcsh 中的 STDERR

> ID：136233
> 
> 赞同：4
> 
> 时间：2008-09-25T21:22:19.387
> 
> 标签：tcsh

在 tcsh 中，我试图从我的 .aliases 文件中的命令重定向 STDERR。

我发现我可以像这样从命令行重定向 STDERR。. .

```
$ (xemacs > /dev/tty) >& /dev/null 
```

. . . 但是当我把它放在我的 .aliases 文件中时，我得到了一个别名循环。. .

```
$ cat .aliases
alias xemacs '(xemacs > /dev/tty ) >& /dev/null'
$ xemacs &
Alias loop.
$ 
```

. . . 所以我在 .aliases 中的命令前放了一个反斜杠，它允许命令运行。. .

```
$ cat .aliases
alias xemacs '(\xemacs > /dev/tty ) >& /dev/null'
$ xemacs &
[1] 17295
$ 
```

. . . 但现在我不能给命令任何参数：

```
$ xemacs foo.txt &
Badly placed ()'s.
[1]    Done                          ( \xemacs > /dev/tty ) >& /dev/null
$ 
```

任何人都可以提供任何解决方案吗？先感谢您！

* * *

更新：我仍然很好奇是否可以从 .aliases 重定向 tcsh 中的 STDERR，但正如这里所建议的，我最终得到了一个 shell 脚本：

```
#!/bin/sh
# wrapper script to suppress messages sent to STDERR on launch
# from the command line.
/usr/bin/xemacs "$@" 2>/dev/null 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-25T21:34:59.370

我怀疑这是不使用别名是最佳选择的情况 - 尝试使用 shell 脚本：

```
#!/bin/tcsh

(xemacs $* > /dev/tty ) >& /dev/null 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T02:26:52.770

尝试

```
alias emacs '(\emacs \!* > /dev/tty) >& /dev/null' 
```

“错误放置 () 的”消息来自将输入参数错误放置到 emacs。没有`\!*`别名定义中的“”，“ `emacs abc`”变成

```
(/usr/bin/emacs > /dev/tty) >& /dev/null abc 
```

包含" `\!*`" 后， " `emacs abc`" 变为

```
(/usr/bin/emacs abc > /dev/tty) >& /dev/null 
```

# email - 解析可能是 html 或各种奇怪编码的原始电子邮件并将其转换为纯文本，例如 pine 可能会显示它的方式

> ID：136235
> 
> 赞同：3
> 
> 时间：2008-09-25T21:22:32.613
> 
> 标签：email, parsing, bots

我想这样做的原因是为了便于解析通过电子邮件发送给机器人的指令，majordomo 可能会解析订阅和取消订阅等命令。事实证明，有很多疯狂的格式和事情需要处理，比如引用文本、区分标题和正文等。

执行此操作的 perl 模块将是理想的，但欢迎使用任何语言的解决方案。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T01:34:15.287

Python 有[电子邮件](http://docs.python.org/lib/module-email.html)。

```
>>> import email
>>> p = email.Parser.Parser()
>>> msg = p.parsestr("From: me@example.com\nSubject: Hello\nDear Sir or Madam...")
>>> msg.get("Subject")
Hello
>>> msg.get_payload()
'Dear Sir or Madam...' 
```

它支持 MIME 和 Python 中包含的几乎所有编码。HTML 将只是文本，但您可以使用 BeautifulSoup 或 Tidy+ElementTree 从中获取文本。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-25T21:33:12.090

不能说我已经完全按照您所说的做了，但是也许您应该阅读一下，因为听起来作者正在按照您的描述进行操作。

[解析 MIME 和 HTML](http://mipagina.cantv.net/lem/perl/mime.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T21:39:12.667

You could do worse than look at [CPAN](http://cpan.org/) for email-related modules.

One that I've used in the past for breaking out subjects, and bodies has been [Email::Simple](http://search.cpan.org/perldoc?Email::Simple)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-09-25T21:36:19.167

一些想法： http://news.ycombinator.com/item?id= [666607](http://news.ycombinator.com/item?id=666607)

这是我不完整的解决方案，它实际上适用于我的目的（解析通过电子邮件发送给机器人的命令）。我把它留在这里供参考，直到有一个明确的更好的答案。

```
# Take an email as a big string and turn it into a plain ascii equivalent.
# TODO: leave any html tags inside of quotes alone.
sub plainify {
  my($email) = @_;

  # translate quoted-printable or whatever this crap is to plain text.
  $email =~ s/\=0D\=0A/\n/gs;
  $email =~ s/\=0A/\n/gs;
  $email =~ s/\=A0/ /gs;
  $email =~ s/\=2E/\./gs;
  $email =~ s/\=20/\ /gs;
  $email =~ s/\=([\n\r]|\n\r|\r\n)//gs;

  # translate html to plain text (or enough of it to parse commands).
  $email =~ s/\&nbsp\;/ /gs;
  $email =~ s/\<br\>/\n/gis;
  $email =~ s/(\<[^\>]+\>)/\n$1\n/gs;

  return $email
} 
```

# visual-studio - Visual Studios Link.exe 错误：“额外操作数”

> ID：136237
> 
> 赞同：12
> 
> 时间：2008-09-25T21:23:05.500
> 
> 标签：visual-studio, build-process, linker

我们的构建过程使用 Visual Studios 2003 link.exe 进行链接。在一台机器上，我们看到以下错误：

```
_X86_Win32/Debug/Intermediate/OurApp.exe LINK: extra operand `/subsystem:windows' Try `LINK --help' for more information 
```

它似乎使用与其他机器相同版本的视觉工作室。有没有人遇到过这个问题？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-09-25T21:42:37.403

看起来在搜索路径的某处有一份 GNU 链接实用程序的副本。此消息不是来自 Microsoft 链接器。

# c# - 向 .NET Windows 窗体 (C#) 添加大量控件时出现问题

> ID：136238
> 
> 赞同：1
> 
> 时间：2008-09-25T21:23:08.977
> 
> 标签：c#, winforms

我有一个用 C# 编写的 Windows 窗体应用程序。它的工作是将消息发送到用户列表。在发送这些消息时，我想显示每个用户的操作状态。我正在做的（对于每个用户）是创建一个标签控件并将其添加到面板中。这对一小部分用户来说没有问题。当我将大小增加到 1000 或更多时，Visual Studio 调试器会显示以下消息：

> *System.Windows.Forms.dll 中出现“System.ComponentModel.Win32Exception”类型的第一次机会异常 mscorlib.dll 中出现“System.Reflection.TargetInvocationException”类型的第一次机会异常*

然后应用程序挂起。关于我做错了什么以及如何解决这个问题的任何想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T21:27:14.867

改用 DataGridView

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-25T21:27:55.037

鉴于大小，我会考虑在 RichTextBox 中显示您的状态。

正在发生的事情是您生成了太多句柄，而框架无法处理所有这些句柄。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-25T21:26:33.073

这是一种解决方法，但我不认为您的用户真的想查看 1000 人的列表。向他们展示其余的当前/最新和摘要报告。或者让他们翻页。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-25T21:31:16.963

没有看到具体的代码，很难说。如果我的任务是相同的程序，我会以不同的方式处理它。

我会使用 Grid 或 Listview 来显示用户和他或她正在发送的消息的状态。这些控件可以处理无限（好吧——受系统内存限制）行数。每个用户一行（或每条消息一行 - 效果更好）。

这应该是 UI 线程中唯一发生的事情。使用后台工作者（BacngroundWorker 类）或消息队列框架（MSMQ、SQL 服务器）来异步发送消息并通过 BackgroundWorker 报告状态备份。

至于你的具体错误——我不知道你为什么会得到它。您可以在 WinForm 上放置的标签数量应该没有限制。我怀疑错误是由其他原因引起的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-25T21:52:24.510

而是在您的表单上放置一个 ProgressBar。如果您要向 1000 人发送一条消息，则每次发送消息时只需将 ProgressBar 增加 1。

如果您要向 1000 人发送 5 条消息，则为消息设置一个进度条，为人员设置一个进度条（第二个进度条将为第一个进度条上的每个值循环一次）。

您还可以为每个进度条设置一个标签（例如“95% 完成”或“第 3 条消息，共 5 条消息”等）。

您不能在 .NET 表单上拥有如此多的控件，即使可以，任何用户也不可能同时查看所有控件。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-25T22:00:42.350

我喜欢`ListView`在细节模式下使用。通常，我会创建一个例程来添加一行，将其选中，然后调用`EnsureVisible()`该项目以自动滚动到它。

如前所述，控件与一个或多个窗口句柄相关，而操作系统只能分配这么多。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-25T21:27:56.580

控制太多了！制作一个控件来包含所有这些状态消息。多行文本框怎么样？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-25T21:34:16.317

如果您实际上只在面板中显示标签，我建议您使用 GDI 显示状态。在 OnPaint 中写入可见区域的文本，并仅在状态标签的区域发生更改时使其无效。

# c# - 为什么要使用指令删除不必要的 C#？

> ID：136278
> 
> 赞同：230
> 
> 时间：2008-09-25T21:30:07.120
> 
> 标签：c#, assemblies, using

例如，我很少需要：

```
using System.Text; 
```

但默认情况下它总是在那里。[如果您的代码包含不必要的using 指令](http://msdn.microsoft.com/en-us/library/aa664764(VS.71).aspx)，我假设应用程序将使用更多内存。但是还有什么我应该注意的吗？

此外，如果仅在一个文件与大多数/所有文件中使用相同的 using 指令，它是否有任何区别？

* * *

*编辑：请注意，此问题与称为[using 语句](http://msdn.microsoft.com/en-us/library/yh598w02.aspx)的不相关概念无关，旨在通过确保当对象超出范围时调用其[IDisposable.Dispose](http://msdn.microsoft.com/en-us/library/system.idisposable.dispose.aspx)方法来帮助管理资源。请参阅[C# 中“使用”的使用](https://stackoverflow.com/questions/75401/uses-of-using-in-c)。*

* * *

## 回答 #1

> 赞同：491
> 
> 时间：2008-09-25T22:39:58.933

除了编码偏好之外，删除未使用的使用/命名空间的原因很少**：**

*   删除项目中未使用的 using 子句可以加快编译速度，因为编译器可以查找要解析的类型的名称空间更少。（对于 C# 3.0 尤其如此，因为有扩展方法，编译器必须在所有命名空间中搜索扩展方法以获得可能的更好匹配、泛型类型推断和涉及泛型类型的 lambda 表达式）
*   当新类型添加到未使用的命名空间中时，可能有助于避免未来构建中的名称冲突，这些命名空间与已使用命名空间中的某些类型具有相同的名称。
*   编码时会减少编辑器自动完成列表中的项目数量，可能会导致更快的输入（在 C# 3.0 中，这也可以减少显示的扩展方法列表）

删除未使用的命名空间**不会**做什么：

*   以任何方式改变编译器的输出。
*   以任何方式改变编译程序的执行（更快的加载，或更好的性能）。

无论是否删除了未使用的使用，生成的程序集都是相同的。

* * *

## 回答 #2

> 赞同：185
> 
> 时间：2008-09-25T21:31:32.687

当你的程序运行时，它不会改变任何东西。所需的一切都按需加载。因此，即使您有该 using 语句，除非您实际使用该命名空间/程序集中的类型，否则不会加载与 using 语句相关的程序集。

主要是为了清理个人喜好。

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2008-09-25T22:35:50.300

代码清洁度*很*重要。

当人们看到多余的使用时，人们开始感觉到代码可能是无人维护的，并且在 browfield 路径上。本质上，当我看到一些未使用的 using 语句时，我的脑后会升起一面小黄旗，告诉我“谨慎行事”。阅读生产代码永远不会给你那种感觉。

所以清理你的使用。不要马虎。激发信心。让你的代码漂亮。给另一个开发者那种温暖模糊的感觉。

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2008-09-25T21:35:58.433

没有对应于`using`. 因此，这些`using`语句不会增加您的应用程序内存，因为没有为其生成代码或数据。

`Using`在编译时仅用于将短类型名称解析为完全限定类型名称。因此，唯一不必要的负面影响`using`是稍微减慢编译时间并在编译期间占用更多内存。不过我不会担心这个。

`using`因此，拥有不需要的语句的唯一真正负面影响是智能感知，因为在您键入时完成的潜在匹配列表会增加。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-25T21:36:23.283

如果您将类称为命名空间中的（未使用的）类，则可能会发生名称冲突。对于 System.Text，如果您定义一个名为“Encoder”的类，就会遇到问题。

无论如何，这通常是一个小问题，并被编译器检测到。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-25T21:31:47.287

您的应用程序不会使用更多内存。编译器可以找到您在代码文件中使用的类。除了不干净之外，它真的没有伤害。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-25T21:34:25.503

主要是个人喜好。我自己清理它们（ReSharper 很好地告诉我什么时候不需要使用语句）。

有人可以说它可能会减少编译时间，但随着当今计算机和编译器的速度，它不会产生任何明显的影响。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-25T22:07:05.533

留下额外的`using`指令很好。删除它们有一点价值，但没有多大价值。例如，它使我的 IntelliSense 完成列表更短，因此更易于导航。

编译的程序集不受无关`using`指令的影响。

有时我把它们放在一个 里面`#region`，然后让它折叠起来；这使得查看文件更清晰。IMO，这是`#region`.

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2018-06-08T16:04:09.323

如果您想保持代码干净，`using`则应从文件中删除未使用的语句。当您在一个需要了解您的代码的协作团队中工作时，好处显得非常明显，认为您的所有代码都必须维护，更少的代码=更少的工作，好处是长期的。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-25T21:35:19.043

它们只是用作捷径。例如，如果您没有 using System，则每次都必须编写： System.Int32；在上面。

删除未使用的只会让你的代码看起来更干净。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-25T22:15:45.420

using 语句只是让您无法限定您使用的类型。我个人喜欢清理它们。实际上，这取决于如何使用 loc 指标

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-02-25T13:52:42.953

只有您实际使用的命名空间允许您将代码记录在案。

您可以通过任何搜索工具轻松找到代码的哪些部分相互调用。

如果您有未使用的命名空间，则在运行搜索时这没有任何意义。

我现在正在清理命名空间，因为我经常被问到应用程序的哪些部分以一种或另一种方式访问​​相同的数据。

我知道哪些部分正在以各种方式访问​​数据，因为数据访问被命名空间分隔，例如直接通过数据库和间接通过 Web 服务。

我想不出一种更简单的方法来一次完成这一切。

如果您只是希望您的代码成为一个黑匣子（对开发人员而言），那么没关系。但是，如果您需要随着时间的推移对其进行维护，那么它就像所有其他代码一样是有价值的文档。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-25T21:32:06.460

'using' 语句不会影响性能，因为它只是限定标识符名称的助手。因此，不必输入*System.IO.Path.Combine(...)* ，如果您*使用 System.IO*，您可以简单地输入*Path.Combine(...)*。

 ** * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-25T21:32:20.780

不要忘记编译器在构建项目时会做很多工作来优化所有内容。在很多地方使用它，或者 1 不应该在编译后做不同的事情。

# sql - 从 SQL 填充的 Ajax 自动完成扩展器

> ID：136284
> 
> 赞同：1
> 
> 时间：2008-09-25T21:31:28.880
> 
> 标签：sql, ajax

好的，首先让我声明我从未使用过此控件，这也是我第一次尝试使用 Web 服务。

我的困境如下。我需要查询数据库以取回某个列并将其用于我的自动完成。显然，我不希望每次用户在文本框中键入另一个单词时都运行查询，所以我最好的猜测是运行一次查询，然后使用该数据集、数组、列表或其他任何内容来过滤自动完成扩展器。 .

我有点失去任何建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T21:53:55.237

这个问题取决于您的数据存储的事务性。显然，如果您正在寻找美国各州（在应用程序的整个生命周期中不会实际改变的数据集合），那么我将缓存一个 System.Collection.Generic List<> 类型，或者如果您想要一个 DataTable。

您可以轻松地将希望查询的数据缓存设置为依赖于 XML 文件或数据库，以便您的扩展程序始终查询从缓存中转换的数据对象，并且缓存对象仅在数据源更改时更新。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T02:33:56.437

为什么不在会话变量中跟踪用户执行的查询，然后使用它来过滤任何进一步的结果？

我认为防止数据库过载的诀窍实际上是限制自动更新程序被允许更新的频率，比如每 2 秒一次对我来说似乎是合理的。

我要做的是：存储查询返回的当前列表，用于单词 A 服务器端，并将其绑定到会话变量。这基本上应该是我认为的整个列表。然后，对于输入的每个新词，只要原词 A 存在，就可以过滤会话信息，并将过滤后的结果吐出，而无需再次查询。所以基本上，只有当单词 A 发生变化时才再次查询。

我在 PHP 意义上使用“会话”，您可能使用具有不同术语的不同语言，但概念应该相同。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T13:11:25.387

RAM 很便宜，SQL 比 IIS 更难扩展，因此将所有内容缓存在内存中：

1.  您的整个数据源如果不是太大而无法在合理的时间内加载它，
2.  预先计算的数据，
3.  自动完成网络服务响应。

根据您的自动完成所需的行为和性能，您可能需要预先计算数据并创建优化读取的冗余结构。使用诸如 SortedList 之类的结构（当您需要 'select top x ... where z like @query+'%'）、Hashtable、...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-06T21:52:49.910

虽然缓存所有内容当然是一个好主意，但您关于使用哪种数据结构的问题是一个在这里没有完全回答的问题。自动完成扩展器的最佳数据结构是 Trie。[您可以在此处](http://metalthought.blogspot.com/2009/05/enhanced-performance-for-aspnet-ajax.html ".NET AutocompleteExtender Trie")找到一篇好的 .NET 文章和代码。

# php - PHP/MySQL 更新一个数据库中的一条新闻记录问题

> ID：136288
> 
> 赞同：1
> 
> 时间：2008-09-25T21:31:48.020
> 
> 标签：php, mysql

我有这个 PHP 代码，我试图用它让用户在表单中编辑新闻记录，然后当他们点击提交按钮时，它将更新数据库中的记录。问题是一切正常，但数据库中的记录实际上并未更新。

有人可以查看我的代码并查看可能出现问题的位置吗？

```
<?php
    $title = "Edit News";
    include("../includes/header.php");
    include("../includes/database.php");
    $done = false;
    $expected = array('newstitle', 'newscontent', 'id');
    if ($_GET && !$_POST) { 
        if (isset($_GET['id']) && is_numeric($_GET['id'])) { 
            $id = $_GET['id']; 
        } 
        else { 
            $id = NULL; 
        } 
        if ($id) { 
            $sql = "SELECT * FROM news WHERE id = $id"; 
            $result = mysql_query($sql) or die ("Error connecting to database..."); 
            $row = mysql_fetch_assoc($result);
        } 
        // if form has been submitted, update record 
        if (array_key_exists('update', $_POST)) { 
            // prepare expected items for insertion into database 
            foreach ($_POST as $key => $value) { 
                if (in_array($key, $expected)) { 
                    ${$key} = mysql_real_escape_string($value); 
                } 
            } 
            // abandon the process if primary key invalid 
            if (!is_numeric($id)) { 
                die('Invalid request'); 
            }
            // prepare the SQL query 
            $query = "UPDATE news SET title = '$title', content = '$content' WHERE id = $id"; 
            // submit the query 
            $done = mysql_query($query) or die("Error connecting to database..."); 
        }
    }
    // redirect page if $id is invalid 
    if ($done) { 
        header("Location: $ROOT/admin/listnews.php"); 
        exit; 
    }
?> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-25T21:38:59.017

```
if ($_GET && !$_POST) { 
```

...

```
if (array_key_exists('update', $_POST)) { 
```

Won't that ensure the update code never fires?

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-25T21:39:51.327

Should $content and $title in the line below be $newstitle and $newscontent?

```
// prepare the SQL query 
$query = "UPDATE news SET title = '$newstitle', content = '$newscontent' WHERE id = $id"; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T21:41:44.643

Couple of things to try and narrow down the problem:

*   echo out some debug text just inside the `if (array_key_exists('update', $_POST))` block to make sure you're actually getting in there. The top of your "if" is `if($_GET && !$_POST)`, so you may need to change this `$_POST` to `$_GET`
*   have you tried echoing out `$query` just before the db call? Does it run on the command line mysql interface ok?
*   if my reading of your `foreach ($_POST as $key => $value)` is correct, you'll end up setting variables with the same names as those in `$expected` - (`$newstitle, $newscontent, $id`) - but in your sql reference `$content` and `$title`. They may be the cause of this bug, but something to keep an eye out for.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T21:43:50.333

It's a little hard to know exactly what's going on without seeing the HTML source of your form, but I think that the

```
if (array_key_exists('update', $_POST)) { 
```

block needs to be moved out of the outer if, since it will never be executed if it's there.

If you don't want to use some sort of testing framework, `print()` is your friend when it comes to debugging your code. Try to find what's executing and what's not; you'll quickly discover which of your assumptions are incorrect, and therefore where the bug is.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T21:44:26.447

Take this if statement out of the nested if:

```
 if (array_key_exists('update', $_POST)) { 
...
} 

```

and then add this conditional:

```
 if (count($_POST) && array_key_exists('update', $_POST)) { 
...
} 

```

I'm pretty sure that will take care of your problem.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-25T21:35:21.320

如果您使用用户发送的相同数据从 mysql cli 运行该 UPDATE，它会更新吗？

如果不检查转义字符。

# visual-studio - 完全卸载 Visual Studio 2005 需要什么

> ID：136298
> 
> 赞同：2
> 
> 时间：2008-09-25T21:33:03.243
> 
> 标签：visual-studio, visual-studio-2005

由于持续的崩溃问题，我即将卸载并重新安装我的 Visual Studio 2005 副本。我知道仅运行卸载程序会在我的机器上留下大量资源和设置，并且希望能够从原始状态重新安装.

有什么方法可以从我的机器上完全卸载 VS2k5，就好像它从来不存在一样？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T21:36:36.980

Visual Studio 2005 以不那么好卸载而闻名（尤其是 Express 版本）。使用[此处](http://support.microsoft.com/kb/907965)找到的技术手动卸载所有 Visual Studio。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-25T21:43:32.953

当然，它以 'format c:' 开头 :)

不过说真的，我在各种 MS 产品上都遇到过这种问题。干净卸载几乎是不可能的，因为即使是 Windows 也没有跟踪 VS2005 安装了哪些共享 DLL。您可以尝试安装 VS express，希望它覆盖任何问题，然后重新安装 VS2005，但我不会屏住呼吸。

另一种可能性是它对您的用户来说是本地的。您可以尝试在文档和设置下移动您的文件夹并让它重新生成，看看是否有效......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T21:36:37.447

好运连连。我已经尝试了很多次来解决这个问题，每次我最终都只是恢复到我安装它或进行全新安装之前。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T21:50:31.317

如果 DevStudio 经常让您崩溃，您可以尝试卸载任何加载项和扩展作为第一步。

它可能会为您节省很多痛苦。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T22:18:33.510

重建你的机器。一段时间后事情就会变得混乱，在此过程中，除了 Visual Studio 垃圾之外，您还将清除在 Windows 中积累的所有垃圾。这看起来很苛刻，但在你做了几次之后，它确实比试图追踪一堆随机问题更快、更少痛苦、更完整。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-02-27T20:17:16.030

Aaron Stebner 的 WebLog 有一个 VS2005 专业卸载程序的[链接](http://blogs.msdn.com/astebner/archive/2005/10/27/485987.aspx)。比下载 MSIZap.exe 和 Windows Server 2003 SDK 的官方 MS 解决方案更直接。

# java - 如何配置 Tomcat JULI 日志记录以滚动日志文件？

> ID：136300
> 
> 赞同：17
> 
> 时间：2008-09-25T21:33:07.113
> 
> 标签：java, tomcat, logging, log4j

我有几个使用 java.util.logging 的 webapps。Tomcat 5.5 被配置为使用 Juli 记录器，因此每个 webapp 都有自己的日志文件。问题是 Juli 没有最大文件大小和文件数的属性。使用 Juli，文件将无限增长，并且只会在一天结束时滚动。此外，保留无限数量的日志文件。

您可以在此页面上看到 FileHandler 属性 - [Apache Tomcat 5.5 文档](http://tomcat.apache.org/tomcat-5.5-doc/logging.html)
没有限制或计数属性（以下几行什么都不做）
`org.apache.juli.FileHandler.limit=102400`
`org.apache.juli.FileHandler.count=5`

在不更改 webapps 的情况下，有没有办法为每个应用程序获取唯一的日志文件，并在日志文件大小上有某种类型的界限？

**更新：** 我找到的解决方案根本不使用 Juli 记录器！ `java.util.logging.FileHandler.limit=102400`
`java.util.logging.FileHandler.count=5`

谢谢，

格雷格

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T21:37:37.743

**Update:** I see your point now after reading more. "Tomcat's JULI implementation is not intended to be a fully-featured logging libary, only a simple bridge to those libraries. However, JULI does provide several properties for configuring the its handlers. These are listed below." Funny that they say that the default java.util.Logging implementation is too limited then they work around it by providing an even more limiting implementation.

[FileHandler javadocs](http://java.sun.com/javase/6/docs/api/java/util/logging/FileHandler.html)

*   java.util.logging.FileHandler.limit specifies an approximate maximum amount to write (in bytes) to any one file. If this is zero, then there is no limit. (Defaults to no limit).
*   java.util.logging.FileHandler.count specifies how many output files to cycle through (defaults to 1).

for the one file per web app, you probably want to separate it by the name of the logger and it depends on how the loggers are created for each app. If they're based off the package or class name then you can filter the logs based on that. It looks like the sample on the link you provided tells how to do this

```
org.apache.catalina.core.ContainerBase.[Catalina].[localhost].level = INFO
org.apache.catalina.core.ContainerBase.[Catalina].[localhost].handlers = \
   2localhost.org.apache.juli.FileHandler 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-05T14:51:51.320

***编辑：刚刚意识到您想要每个 webapp 日志记录，这可能无法通过此设置...***

假设您使用的是 Tomcat 6.0，我的建议是编译额外的组件以实现完整的公共日志记录并使用 Log4j 配置滚动日志。

此处的构建说明 [http://tomcat.apache.org/tomcat-6.0-doc/building.html](http://tomcat.apache.org/tomcat-6.0-doc/building.html)

然后替换Tomcat的/bin目录下的tomcat-juli.jar，将tomcat-juli-adapters.jar连同log4j.jar和log4j.properties一起放到/lib目录下。

然后使用类似的东西：

```
<appender name="file" class="org.apache.log4j.RollingFileAppender">
  <param name="File" value="logfile.log"/>
  <param name="Threshold" value="INFO"/>
  <param name="MaxFileSize" value="10MB"/>
  <param name="MaxBackupIndex" value="3"/>
  <layout class="org.apache.log4j.PatternLayout">
    <param name="ConversionPattern" value="%d{ISO8601} %p %m%n"/>
  </layout>
</appender> 
```

# java - 你如何从 Eclipse 中刷新 Maven 依赖项？

> ID：136308
> 
> 赞同：10
> 
> 时间：2008-09-25T21:33:54.663
> 
> 标签：java, eclipse, maven-2

我们最近开始使用 maven 进行依赖管理。我们的团队使用 eclipse 作为 IDE。有没有一种简单的方法可以让 eclipse 在不运行 mvn eclipse:eclipse 的情况下刷新 maven 依赖项？

依赖项在本地 maven 存储库中是最新的，但在我们使用 eclipse:eclipse 命令之前，eclipse 不会获取更改。这会重新生成很多 eclipse 配置文件。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-25T21:38:29.863

您是否尝试过使用[m2eclipse](http://m2eclipse.codehaus.org/)插件？我将它与 eclipse 一起使用，当我添加依赖项时它会维护 eclipse .classpath。它还将检查更新的依赖项。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-25T21:39:51.590

您可以使用 生成特殊的 eclipse 文件`mvn eclipse:eclipse`，但是一旦完成，您应该让[插件](http://maven.apache.org/eclipse-plugin.html)在 eclipse 中处理依赖项。

这就是我们在我的工作场所的做法，而且通常效果很好。

# wpf - Is this a crazy way to handle multi Validation types with IDataError and WPF?

> ID：136336
> 
> 赞同：5
> 
> 时间：2008-09-25T21:37:54.747
> 
> 标签：wpf, validation, xaml, styles

We are using the standard method for our controls to report broken BO rules. This is done via the interface IDataError in our BO’s and in XAML the control is bound to the BO’s property etc. This approach works OK. But we need to show 2 types of visuals in the UI depending on the type (or category if you like) of the invalidation error. If it’s a required field then we show a CueBanner (water mark) but for other types we change the colour of the controls boarder. In both scenarios we set the tool type of the error message.

The Problem with IDataError is that it doesn’t support a method/property to distinguish between error types.

The only way I can do that is by examining the error text, required field text must contain the key word “required”. The following approach doesn’t feel right but it’s the only way I can determine the type of error and then deal with it accordingly. All required field rules must have as part of the error text “required field”. To make this all work I have created a custom dependency property called ErrorMessage. In my ResourceDictionary I have a Style.Trigger for Validation.HasError. In there I set my dependency properties value to the ErrorContent. Now when my dependency properties value changes I can examine the text and set the Validation.SetErrorTemplate( myControl, newErrorTemplate) to the template to suit the error type. I have to wire up a few events to the control such as lost and got focus to manage removing or adding the cueBanner template but the whole thing will work. It’s just that I’m not sure it’s the best way to do it.

PS. When I set the ErrorTemplate i’m doing this in code, thats building and adding it. Is there a way to point Validation.SetErrorTemplate to a static resource keeping in mind that I need to switch between at least 2 types?

Your thoughts please..

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T06:05:25.930

是否有可能派生一个接口 IDataError 来添加一个额外的属性，该属性是错误类型的枚举。然后你可以尝试绑定它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-11-07T13:31:29.483

如果您对有点清晰的（未经测试的）方法感到满意，那么您可以执行以下操作：抛出异常而不是使用 IDataErrorInfo 接口返回字符串。在您的 ErrorTemplate 中，您可以访问 ValidationErrors（和 ValidationError.Exception 属性）。

然后，您将异常上的 DataTrigger 与转换器结合使用，该转换器检查正确的异常类型并返回真或假。完成这项工作应该足够了。

# design-patterns - 是否存在明确的设计模式列表？

> ID：136337
> 
> 赞同：46
> 
> 时间：2008-09-25T21:38:03.933
> 
> 标签：design-patterns

设计模式的想法是从哪里来的，谁决定了什么是模式，什么不是模式，并给它们起了名字？是否有定义它们的官方组织，或者它们是否通过一些社区共识而存在？

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2008-09-25T21:45:26.040

我认为有一个基本的“设计模式的生命周期”

1.  作者在一本书中写了关于设计模式的文章。
2.  书读得很好，可能是畅销书
3.  设计模式进入公众意识，获得关注。
4.  设计模式被使用。它运作良好。设计模式得到更多的关注
5.  设计模式成为灵丹妙药，被过度使用。
6.  不同的作者写道“设计模式被认为是有害的”
7.  设计模式变成[反模式](http://en.wikipedia.org/wiki/Anti-pattern)
8.  不同的作者成名，写满新设计模式的书……

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-09-25T21:42:54.187

大多数人会提到[“四人帮”](http://en.wikipedia.org/wiki/Gang_of_Four_(software))（Erich Gamma、Richard Helm、Ralph Johnson 和 John Vlissides），他们撰写了《*设计模式：可重用面向对象软件的元素*》一书。没有真正确定的列表，因为有用的设计模式肯定一直在被发现。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-09-25T21:40:10.637

维基百科有一个很好的列表。[http://en.wikipedia.org/wiki/Design_pattern_(computer_science)](http://en.wikipedia.org/wiki/Design_pattern_(computer_science))

大多数是由社区共识（该社区由阅读过设计模式或代码完整的人组成：/）

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-25T21:49:47.197

简短的回答：没有。

长答案：因为如果有人设计了一些东西，并且它往往被其他人重用，那么一个新的“设计模式”就会被创建（或发现？？）

实际上，现有应用程序中的设计模式数量可能非常庞大，但尚未对其进行分类。

我会添加前面的链接这两个：

[http://martinfowler.com/eaaCatalog/](http://martinfowler.com/eaaCatalog/)

[http://c2.com/ppr/](http://c2.com/ppr/)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-25T22:03:40.847

设计模式的想法是由克里斯托弗·亚历山大（Christopher Alexander）在撰写关于建筑物和城镇内的建筑模式时提出的。同样，随着工程师在面向对象设计方法方面获得更多经验，模式也出现了。

没有一个官方联盟来定义什么是模式，什么不是模式。然而，模式在被普遍接受之前通常有很长的生命周期。开发社区开始参与诸如 PLOP（Pattern Languages of Programs）及其年度会议： [2008 Conference](http://hillside.net/plop/2008/index.php)之类的活动，该会议专注于模式作者和爱好者讨论模式和新模式开发的主题。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-25T21:42:22.160

没有确定的清单。模式是被发现的，而不是发明的，所以没有组织可以说“这是一个模式”和“这不是一个模式”。就算有，对任何人都没有用。

尽管如此，“著名”模式是在设计模式或 GOF 书中描述的模式。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-25T21:44:35.510

[识别反模式](http://en.wikipedia.org/wiki/Anti-pattern)也很有用。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-25T21:47:47.220

这是一个很好的模式列表（来自*企业应用程序架构*的模式）：

[http://martinfowler.com/eaaCatalog/](http://martinfowler.com/eaaCatalog/)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-25T21:45:33.870

没有明确的列表 - 因为有一个很可能需要一些权威来声明一个模式是一个模式还是只是一个......其他东西。

一些模式只在一部分语言中有意义——规范的[GOF 书](https://rads.stackoverflow.com/amzn/click/com/0201633612)专注于 Java（或者它是 C++？这本书在我办公室的桌子上）并且描述的一些模式与例如 Ruby 不是很相关或 VB6。当然反之亦然。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-25T22:00:42.680

我想说的是，《四人帮》和 Fowler 的《企业架构模式》中的列表联盟将为您提供 99% 的您需要知道的内容。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-25T21:45:09.643

有一本规范的书：Gamma、Helm、Johnson、Vlissides：“设计模式 - 可重用的面向对象软件的元素”，这一切都开始了。它包含 23 种模式。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-26T23:31:25.143

不可能有一个确定的清单。曾经。

如果你看到某个问题的一些解决方案——对你来说——有一个可以清晰表达的模式，那么你就发现了一种设计模式。您可以随时继续执行此操作。

每一个聪明的、新的解决方案都可能成为具有共同模式的类似解决方案的起源。模式是*你*用来总结和捕捉问题的酷解决方案的东西。

人脑几乎可以在*任何事物*中找到模式。这是我们不假思索地做的事情。

# java - 将引用的 Eclipse 项目添加到 Maven 依赖项

> ID：136362
> 
> 赞同：25
> 
> 时间：2008-09-25T21:42:06.343
> 
> 标签：java, eclipse, maven-2

现在，我有两个 Eclipse 项目——它们都使用 Maven 2 来实现对 jar 的依赖。

在 Eclipse 中，我将项目 Foo 包含在项目 Bar 的构建路径中，这样我就可以使用项目 Bar 中的 Foo 类。这在 Eclipse 领域非常有效，但是当我尝试时：

```
mvn compile 
```

在 Bar 的目录中，它失败了，因为 Maven 不知道 Eclipse 构建路径中的项目到项目关系。

如果我使用的是 Ant，我只会用它来做一些愚蠢的事情，比如将 foo.jar 复制到项目 Bar 的类路径中，但据我所知，在 Maven 领域做的事情要少得多。

我想知道这种类型的问题是否有标准的解决方法——它似乎相当普遍，我只是缺少一些关于 Maven 如何工作的基本知识。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-25T21:48:54.533

也许您仅通过 Eclipse 配置-> 构建路径引用了另一个项目。只要您使用 Eclipse 构建您的项目，它就可以工作。

尝试先`mvn install`在项目 Bar 中运行（以便将 Bar 放入您的 Maven 存储库中），然后将依赖项添加到 Foo 的 pom.xml 中。

那应该工作！

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-25T22:53:20.323

查看[m2eclipse](https://www.eclipse.org/m2e/)插件。当您更改 pom.xml 时，它将自动动态更新项目构建路径。没有必要运行`mvn eclipse:eclipse`。

该插件还将检测是否有任何依赖项在同一个工作区中，并将该项目添加到构建路径中。

理想情况下，如果您使用 m2eclipse，您永远不会手动更改项目构建路径。您将始终编辑 pom.xml，这是正确的方法。

如前所述，Maven 不会知道 Eclipse 项目构建路径。您确实需要将所有依赖项添加到 pom 中，并且您需要确保首先通过运行构建和安装所有依赖项`mvn install`。

如果您想使用单个命令构建两个项目，那么您可能会发现[项目聚合](http://maven.apache.org/guides/introduction/introduction-to-the-pom.html#Project_Aggregation)很有趣。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2017-10-18T19:38:07.547

我只需要这样做，我需要它来构建外部 mvn clean install 命令。这是在 Eclipse 中配置它的正确方法。（项目 B 作为 A 的依赖项）

1.  在 Eclipse 中打开项目 A 的 pom.xml。
2.  转到`Dependencies`选项卡。
3.  单击`Add...`页面中间的按钮（用于左侧的依赖项框）
4.  在弹出窗口中，一行下方应有一个框，其上方的文字为`Enter groupId, artifactId or sha1 prefix or pattern (*):`. 在此框中输入项目 B 的工件 ID。
5.  双击要作为依赖项添加到此项目的 jar
    1.  之后您可能需要更新项目。
    2.  在包资源管理器中右键单击项目 A
    3.  Maven -> 更新项目...
    4.  然后在弹出窗口中点击确定。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T03:03:55.367

您可能想尝试另一种方法，您有一个父 maven 项目和两个子项目。比方说：

父级（pom.xml 引用了两个子项目/模块）--> A（取决于 B）--> B

那么当你从 Parent 的根目录运行 mvn eclipse:eclipse 时，maven 将为 A 和 B 生成 eclipse 项目，并且它将 B 作为 A 的类路径中的必需项目。

您可以从 Parent 的根目录运行 mvn install 来编译两个项目。

要完成设置，您必须将 A 和 B 都导入 Eclipse，确保没有选中“将项目复制到工作区”。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-25T21:48:17.060

我认为处理它的最好方法是让 Bar 像 Foo 一样成为一个 Maven 项目，然后`mvn install`它可以在您的本地 Maven 存储库中使用。缺点是每次您希望 Maven 看到您对 Bar 所做的更改时都必须安装该项目。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-25T21:50:25.230

不是一个完整的答案：
Bar 的 pom 需要包含 Foo 才能使用 maven 编译它。
我也对这个问题感兴趣，但从如何让 eclipse 识别 maven 添加的依赖项的角度来看，实际上是同一工作区中的另一个项目。我目前在执行后更改了构建路径`mvn eclipse:eclipse`

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-06-29T09:22:26.453

如果你引用了一个本地项目，但它的版本已经更新（通常会增加），它可能只能在你的本地 repo 中找到，你必须在你的 POM 中更新它的（可能是固定的）版本。

* * *

我们有一个“通用项目”（随处使用），它不一定需要版本控制，因为我们通过源代码控制对其进行标记。所以要么

*   将其保持在固定版本或
*   用特殊`LATEST`版本引用它

是始终保持安全的好方法。

# c# - 如何将 ORM 用于其架构在运行时未知的数据库？

> ID：136366
> 
> 赞同：3
> 
> 时间：2008-09-25T21:42:37.403
> 
> 标签：c#, .net, database, orm, dynamic

鉴于以下要求，我正在尝试利用 ORM：

1) 使用.NET Framework（最新的Framework 还可以）
2) 必须能够互换使用Sybase、Oracle、MSSQL
3) 架构大多是静态的，但也有动态的部分。

我对 SubSonic 和 NHibernate 有点熟悉，但并不深入。
我觉得 ORM 可以做我想做的事，但我现在不知道如何利用它。

SubSonic 可能不是最优的，因为它目前不支持 Sybase，并且我现在为它编写自己的提供程序超出了我的资源和能力。

对于#3（上图），有几个元数据表，它们描述了供应商可以“装订”到现有数据库的表。
我们将这些称为*MetaTables*和*MetaFields*。

有一个基本的静态模式，ORM（NHibernate ATM）可以很好地处理它。
**但是**，供应商可以（物理地）将表添加到数据库中，只要他们还将数据添加到元数据表中以描述其结构即可。

我真正想要的是能够以某种方式用元数据（以它可以理解的方式）“喂养”ORM，并在那时让我能够操纵数据。

我的主要**目标**是减少我必须在这些动态表上构建的通用 SQL 语句的数量。
我还想避免担心发送到 Sybase、Oracle 或 MSSQL 的 SQL 的差异。

我的主要**问题**是我无法让 ORM 知道动态表，直到运行时才能访问元数据

**编辑**：使用示例可能类似于[此处概述](http://subsonicproject.com/querying/using-the-original-query-tool/)的示例：

IDataReader rdr=new Query("DynamicTable1").WHERE("ArbitraryId",2).ExecuteReader();

（但是，SubSonic 似乎无法工作，因为没有 Sybase 提供程序（见上文）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T07:40:16.960

我们使用 NHibernate 做了一些工作，但是我们停止了这个项目，因为它没有为我们提供我们想要的 ROI。我们最终编写了自己的 ORM/SQL 层，效果很好（因为我不再在那里工作，所以我猜它仍然有效）。

我们的系统使用一个开源项目来生成 SQL（不再记得名字了），并且我们用我们自己的基于 Xml 的语言（查询标记语言 - QML）构建了所有查询。然后，我们可以使用选择、位置、组等构建一个 xmlDocument，然后将其发送到 SqlEngine，后者会将其转换为 Sql 语句并执行它。我们讨论过但从未实现过所有这些中的缓存。这将允许我们缓存 Qmls 以用于经常使用的查询。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T21:07:28.957

根据this blog，您实际上可以将[NHibernate 与动态映射一起](http://ayende.com/Blog/archive/2008/05/01/Dynamic-Mapping-with-NHibernate.aspx)使用。不过需要稍微调整一下...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T21:48:06.530

我对在运行时如何使用 orm 感到有点困惑？如果 ORM 会在运行时动态构建某些东西，那么运行时代码如何知道 orm 动态做了什么？

“在那一点上让我可以操纵数据” - 什么是操纵数据？

我可能在这里遗漏了一些东西，如果是这样的话，我很抱歉。（我只真正使用了 ORM 自下而上的方法）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T22:22:06.717

IDataReader 不会将任何内容映射到您知道的对象。因此，您的示例应该使用经典查询生成器编写。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-19T05:13:24.863

您是否考虑过使用 ADO.NET 实体框架？

[MSDN：LINQ 到实体](http://msdn.microsoft.com/en-us/library/bb386964.aspx)

它允许您以这样一种方式将数据库表映射到对象模型，这样您就可以在不考虑使用哪个数据库供应商的情况下进行编码，也不用担心 DBA 对实际表所做的微小变化。映射保存在配置文件中，可以在修改 db 表时进行修改，而无需重新编译。

此外，使用 LINQ to Entities，您可以以 OO 方式构建查询，因此您无需编写实际的 SQL 查询字符串。

# .net - 反转 RSS 提要

> ID：136401
> 
> 赞同：1
> 
> 时间：2008-09-25T21:50:21.080
> 
> 标签：.net, rss, feed

这可能很奇怪，你有没有遇到过你想按时间顺序阅读的博客？那个博客可能很旧，有几百个帖子。当我将此提要添加到我的提要阅读器（例如 googlereader）时，最新提要位于顶部，当我进一步向下滚动时，会出现较旧的帖子。如果您想从头开始阅读，这可能会令人沮丧。有没有这样做的读者？或者，我很想把它作为一个宠物项目来做，（最好在 c# 中），我应该怎么做呢？此外，是否有任何 .NET 库可用于处理 RSS 提要？我以前没有做过任何 RSS 提要编程。

**编辑**我想知道这是否有任何技术限制。这只是我遇到的一个有趣的问题，我认为可以通过编程方式解决。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T21:53:28.813

在 Google 阅读器中，当您阅读提要时，会出现一个“提要设置...”菜单，其中包含以下选项：“按最新排序”、“按最旧排序”。

文件夹在“文件夹设置...”菜单下具有相同的选项

无需编程。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-25T21:54:13.007

我想你可能有这个问题。许多 RSS 提要仅保留最新的 10 条左右的帖子，因此无法提供自博客开始以来提要中的旧数据。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T03:35:30.240

如果您决定推出自己的 C# 应用程序来执行此操作，那么在当前版本的 .NET Framework 中非常简单。

查找[System.ServiceModel.Syndication](http://msdn.microsoft.com/en-us/library/system.servicemodel.syndication.aspx)命名空间。它有与 RSS 和 Atom 提要相关的类。我最近编写了一些代码，使用这些类从数据库生成提要，并将地理编码添加到提要项中。我有同样的问题，我需要颠倒提要中项目的顺序，因为我的数据库查询以相反的顺序返回它们，我希望我的用户看到。

我所做的只是在我自己的数据结构中保存提要的[SyndicationItem](http://msdn.microsoft.com/en-us/library/system.servicemodel.syndication.syndicationitem.aspx)对象列表，`List<SyndicationItem>`直到我想将提要写入磁盘之前。然后我会做这样的事情：

```
private SyndicationFeed m_feed;
private List<SyndicationItem> m_items;

...snip...

m_items.Reverse();
m_feed.Items = m_items; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-25T21:57:38.880

在 Google 阅读器中，您可以让它显示文件夹（提要）中的项目，从最新到最旧，或从最旧到最新。为此，请选择提要，选择“提要设置”下拉菜单，然后选择“按最旧排序”。我不确定谷歌阅读器有多远，但可能从它第一次开始监控提要开始。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T21:55:02.990

这对于任何语言都应该相当容易......您需要做的就是将提要 xml 读入 DOM 结构（包括 C# 在内的几乎所有语言都有一个 DomDocument 类）

然后，您应该能够以相反的顺序简单地循环遍历项目节点......

见： http: [//msdn.microsoft.com/en-us/library/ms756177 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms756177(VS.85).aspx)

正如其他人所说，根据 rss 提要，您可能只能获得有限数量的项目。

# apache-flex - Flex - 单击封闭组件时避免容器上的单击事件

> ID：136413
> 
> 赞同：4
> 
> 时间：2008-09-25T21:52:39.140
> 
> 标签：apache-flex, events, containers

我有一个 Flex 应用程序，我在其中使用 Canvas 来包含其他几个组件。在那幅画布上有一个按钮，用于调用通过系统的特定流程。单击 Canvas 上的任何其他位置应会导致出现详细信息窗格，其中显示有关此控件表示的记录的更多信息。

我遇到的问题是，因为每当用户单击按钮时按钮都位于画布内，所以在按钮和画布上都会触发单击事件。如果用户单击另一个组件覆盖的区域，是否有任何方法可以避免在 Canvas 对象上触发单击事件？

我创建了一个简单的小测试应用程序来演示这个问题：

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute">
    <mx:Script>
        <![CDATA[
            private function onCanvasClick(event:Event):void {
                text.text = text.text + "\n" + "Canvas Clicked";
            }

            private function onButtonClick(event:Event):void {
                text.text = text.text + "\n" + "Button Clicked";
            }
        ]]>
    </mx:Script>

    <mx:Canvas x="97" y="91" width="200" height="200" backgroundColor="red" click="onCanvasClick(event)">
        <mx:Button x="67" y="88" label="Button" click="onButtonClick(event)"/>
    </mx:Canvas>
    <mx:Text id="text" x="97" y="330" text="Text" width="200" height="129"/>
</mx:Application> 
```

就目前而言，当您单击按钮时，您将在文本框中看到两个条目，“Button Clicked”，然后是“Canvas Clicked”，即使鼠标只单击了一次。

我想找到一种方法可以避免进行第二个条目，这样当我单击按钮时，只会创建“单击按钮”条目，但是如果我要单击画布中的其他任何位置，则会出现“单击画布”条目仍然会出现。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-25T22:22:26.947

事件继续进行，因为 event.bubbles 设置为 true。这意味着显示层次结构中的所有内容都会收到该事件。要停止事件继续，您调用

```
event.stopImmediatePropagation() 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T13:16:42.843

拉普利的回答就像一个魅力。对于那些感兴趣的人，更新后的代码如下所示：

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute">
    <mx:Script>
        <![CDATA[
                private function onCanvasClick(event:Event):void {
                        text.text = text.text + "\n" + "Canvas Clicked";
                }

                private function onButtonClick(event:Event):void {
                        text.text = text.text + "\n" + "Button Clicked";
                        event.stopImmediatePropagation();
                }
        ]]>
    </mx:Script>

    <mx:Canvas x="97" y="91" width="200" height="200" backgroundColor="red" click="onCanvasClick(event)">
        <mx:Button x="67" y="88" label="Button" click="onButtonClick(event)"/>
    </mx:Canvas>
    <mx:Text id="text" x="97" y="330" text="Text" width="200" height="129"/>
</mx:Application> 
```

唯一的区别是 onButtonClick 方法中多了一行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T22:22:37.197

我有两个想法，先试试这个：

```
 btn.addEventListener(MouseEvent.Click,function(event:MouseEvent):void{
    event.stopImmediatePropagation();
    ...
}); 

```

如果这不起作用，请查看是否可以将单击侦听器添加到画布而不是按钮，并检查事件对象上的目标属性。就像是：

```
 btn.addEventListener(MouseEvent.Click,function(event:MouseEvent):void{
    if(event.target == btn){
        ...
    }
    else{
        ...
    }
}); 

```

同样，这些是我脑海中的一些想法......我将创建一个小型测试应用程序，看看这些是否有效......

# java - 在Java中获取当前年份的整数值

> ID：136419
> 
> 赞同：342
> 
> 时间：2008-09-25T21:53:52.837
> 
> 标签：java, datetime, date

我需要将 Java 中的当前年份确定为整数。我可以只使用`java.util.Date()`，但它已被弃用。

* * *

## 回答 #1

> 赞同：719
> 
> 时间：2008-09-25T21:56:41.207

```
int year = Calendar.getInstance().get(Calendar.YEAR); 
```

不确定这是否符合不设置新日历的标准？（为什么反对这样做？）

* * *

## 回答 #2

> 赞同：173
> 
> 时间：2015-11-13T19:11:12.230

使用 Java 8 的时间 API（假设您很高兴在系统的默认时区中获得年份），您可以使用[以下`Year::now`方法](https://docs.oracle.com/javase/8/docs/api/java/time/Year.html#now--)：

```
int year = Year.now().getValue(); 
```

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2008-09-25T22:00:04.553

这个最简单的（使用日历，抱歉）是：

```
 int year = Calendar.getInstance().get(Calendar.YEAR); 
```

还有新的[Date and Time API JSR](https://jsr-310.dev.java.net/)，以及[Joda Time](http://joda-time.sourceforge.net/)

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2017-05-23T14:51:36.043

您还可以使用`java.time.YearMonth`（自 Java 8 起）的 2 种方法：

```
import java.time.YearMonth;
...
int year = YearMonth.now().getYear();
int month = YearMonth.now().getMonthValue(); 
```

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2015-05-03T21:42:24.140

# tl;博士

```
ZonedDateTime.now(  ZoneId.of( "Africa/Casablanca" )  )
             .getYear() 
```

# 时区

[Raffi Khatchadourian](https://stackoverflow.com/users/405326/raffi-khatchadourian)[的回答](https://stackoverflow.com/a/28891864/642706)明智地展示了如何在 Java 8 中使用新的[java.time 包](http://docs.oracle.com/javase/8/docs/api/java/time/package-summary.html)。但该答案未能解决时区在确定日期时的关键问题。

> int 年 = LocalDate.now().getYear();

该代码取决于 JVM 当前的默认时区。默认区域用于确定今天的日期。例如，请记住，在巴黎午夜过后的那一刻，蒙特利尔的日期仍然是“昨天”。

因此，您的结果可能会因它运行的机器、更改主机操作系统时区的用户/管理员或随时更改 JVM 当前默认值的任何 Java 代码而*异*。最好指定时区。

顺便说一句，请始终使用[IANA 定义的](https://www.iana.org/time-zones)正确[时区名称](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones)。切勿使用既不标准化也不唯一的 3-4 个字母代码。

# java.time

Java 8 的 java.time 中的示例。

```
int year = ZonedDateTime.now(  ZoneId.of( "Africa/Casablanca" )  ).getYear() ; 
```

# 乔达时间

一些想法如上，但使用[Joda-Time](http://www.joda.org/joda-time/) 2.7 库。

```
int year = DateTime.now( DateTimeZone.forID( "Africa/Casablanca" ) ).getYear() ; 
```

# 递增/递减年份

如果您的目标是一次跳跃一年，则无需提取年份编号。Joda-Time 和 java.time 都有一次加/减一年的方法。这些方法很聪明，可以处理夏令时和其他异常情况。

*java.time*中的示例。

```
ZonedDateTime zdt = 
    ZonedDateTime
    .now(  ZoneId.of( "Africa/Casablanca" )  )
    .minusYears( 1 ) 
; 
```

Joda-Time 2.7 中的示例。

```
DateTime oneYearAgo = DateTime.now( DateTimeZone.forID( "Africa/Casablanca" ) ).minusYears( 1 ) ; 
```

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2008-09-25T21:58:47.253

最简单的方法是从日历中获取年份。

```
// year is stored as a static member
int year = Calendar.getInstance().get(Calendar.YEAR); 
```

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2011-07-20T12:02:38.633

如果您想要任何日期对象的年份，我使用了以下方法：

```
public static int getYearFromDate(Date date) {
    int result = -1;
    if (date != null) {
        Calendar cal = Calendar.getInstance();
        cal.setTime(date);
        result = cal.get(Calendar.YEAR);
    }
    return result;
} 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2015-03-06T03:24:17.570

您还可以使用 Java 8 [`LocalDate`](http://docs.oracle.com/javase/8/docs/api/java/time/LocalDate.html)：

```
import java.time.LocalDate;
//...
int year = LocalDate.now().getYear(); 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2019-08-07T09:49:26.870

对 java 8 使用以下代码：

```
LocalDate localDate = LocalDate.now();
int year = localDate.getYear();
int month = localDate.getMonthValue();
int date = localDate.getDayOfMonth(); 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-09-25T22:16:48.070

如果您的应用程序大量使用 Date 和 Calendar 对象，您真的应该使用 Joda Time，因为`java.util.Date`它是可变的。`java.util.Calendar`更新其字段时会出现性能问题，并且对于日期时间算术来说很笨拙。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2014-11-24T14:34:16.573

正如上面一些人的回答：

如果以后想使用该变量，最好使用：

```
int year;

year = Calendar.getInstance().get(Calendar.YEAR); 
```

如果您只需要年份来满足您最好使用的条件：

```
Calendar.getInstance().get(Calendar.YEAR) 
```

例如，在检查引入年份不小于当前年份 200 或大于当前年份（可能是出生年份）时使用它：

```
import java.util.Calendar;
import java.util.Scanner;

public static void main (String[] args){

    Scanner scannernumber = new Scanner(System.in);
    int year;

    /*Checks that the year is not higher than the current year, and not less than the current year - 200 years.*/

    do{
        System.out.print("Year (Between "+((Calendar.getInstance().get(Calendar.YEAR))-200)+" and "+Calendar.getInstance().get(Calendar.YEAR)+") : ");
        year = scannernumber.nextInt();
    }while(year < ((Calendar.getInstance().get(Calendar.YEAR))-200) || year > Calendar.getInstance().get(Calendar.YEAR));
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-06-11T16:46:46.847

在我的情况下，以上都不起作用。所以在尝试了很多解决方案之后，我发现了下面一个，它对我有用

```
import java.util.Scanner;
import java.util.Date;

public class Practice
{   
    public static void main(String[] args)
    {
        Date d=new Date();  
        int year=d.getYear();
        int currentYear=year+1900;    

        System.out.println(currentYear);

    }

} 
```

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2008-09-26T06:17:50.660

您可以使用整数数学来完成整个事情，而无需实例化日历：

```
return (System.currentTimeMillis()/1000/3600/24/365.25 +1970); 
```

新年可能会休息一两个小时，但我不觉得这是个问题？

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2019-11-13T12:46:47.760

在 Java 版本 8+ 中，可以（建议）使用[java.time](https://docs.oracle.com/javase/8/docs/api/java/time/package-summary.html)库。[ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html)设置了编写日期的标准方法：`YYYY-MM-DD`并`java.time.Instant`使用它，所以（对于`UTC`）：

```
import java.time.Instant;
int myYear = Integer.parseInt(Instant.now().toString().substring(0,4)); 
```

PS 以防万一（并且缩写为 get `String`， not `int`），使用`Calendar`看起来更好，并且可以感知区域。

* * *

## 回答 #15

> 赞同：-5
> 
> 时间：2008-09-26T04:24:40.947

我在我的库中使用特殊函数来处理日/月/年整数 -

```
int[] int_dmy( long timestamp ) // remember month is [0..11] !!!
{
  Calendar cal = new GregorianCalendar(); cal.setTimeInMillis( timestamp );
  return new int[] { 
    cal.get( Calendar.DATE ), cal.get( Calendar.MONTH ), cal.get( Calendar.YEAR )
  };
};

int[] int_dmy( Date d ) { 
 ...
} 
```

# php - 不要等待进程退出

> ID：136429
> 
> 赞同：1
> 
> 时间：2008-09-25T21:55:30.727
> 
> 标签：php

我有一个 PHP 脚本，它每分钟都会从一个 cron 作业中调用。该脚本从数据库中获取一些信息，然后使用 System 函数调用另一个 PHP 脚本（传递一些参数）。

这意味着我可以从这个“主要”脚本启动多达 10 个脚本。而我想做的是，我会调用脚本并继续执行主脚本，即不等系统调用完成再调用下一个。

如何才能做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T13:08:57.150

你也许可以使用[`proc_open()`](http://www.php.net/manual/en/function.proc-open.php),[`stream_select()`](http://www.php.net/manual/en/function.stream-select.php)并[`stream_set_blocking()`](http://www.php.net/manual/en/function.stream-set-blocking.php)协同实现这种事情。

如果这听起来含糊不清，我打算在这里粘贴一大段代码，这些代码我在最近的一个项目中使用过，该项目做了类似的事情，但后来觉得它可能会阻碍而不是帮助！总之，代码是这样工作的：

1.  cronjob 调用 cronjob_wrapper.php
2.  cronjob_wrapper.php 创建一个新的 Manager 类，然后对其调用*start*。
3.  Manager 类启动方法检查有多少实例正在运行（在特定位置查找 pid 文件）。如果它小于给定的最大实例数，它将自己的进程 ID 写入 pid 文件，然后继续
4.  Manage 类创建一个适当的 Encoder 类的实例并在其上调用*exec*。
5.  *exec*方法使用proc_open、stream_select 和 stream_set_blocking 以非阻塞方式运行系统命令（在这种情况下运行 ffmpeg - 可能需要相当长的时间！）
6.  当它最终运行时，它会清理它的 PID 文件并退出。

现在我含糊不清的原因是我们这里的多个实例是由 cronjob 而不是 PHP 处理的。我一直在尝试做你所说的那种事情，并且[`pcntl_fork()`](http://www.php.net/manual/en/function.pcntl-fork.php)和朋友们一起工作得很好，但最后我遇到了几个问题（如果我记得至少有一个是 PHP 中的错误）和决定这种方法是实现相同目标的更可靠的方法。YMMV。

不过，这些功能非常值得一看，您可以使用它们实现很多功能。虽然不知何故，我认为 PHP 永远不会成为首选的套接字编程语言...... :)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T21:59:09.267

如果您的操作系统支持它，您可以使用[pcntl_fork()](http://www.php.net/manual/en/function.pcntl-fork.php)函数来分离父进程不等待的子进程。不过要小心，很容易意外创建太多子进程，尤其是当它们运行时间比预期长时！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T22:02:47.493

[我认为答案与已经为异步 PHP 调用](https://stackoverflow.com/questions/124462/asynchronous-php-calls)提供的答案非常相似。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T23:39:23.877

[http://php.net/pcntl_fork](http://php.net/pcntl_fork)

它只是 *NIX，但您可以使用 PCNTL 扩展来分叉您的脚本。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-25T21:59:24.087

我不确定 PHP 是否支持线程。[在这里](http://www.alternateinterior.com/2007/05/multi-threading-strategies-in-php.html)检查。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-25T22:05:56.817

你可以在后台运行它们：

```
system('php yourscript.php &'); 
```

您只需确保检查正在运行的进程总数。总而言之，这不是一个超级优雅的解决方案。相反，cron 你可以让一个脚本永远运行，我在想这样的事情：

```
<?php
while(true) {
  // do whatever needs to be done.
}
?> 
```

不过要小心。不完全知道 PHP 可用作守护程序。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-09-25T21:57:56.477

使用 php 的 fork 或线程版本。

# perl - Compressing HTTP request with LWP, Apache, and mod_deflate

> ID：136432
> 
> 赞同：6
> 
> 时间：2008-09-25T21:56:29.443
> 
> 标签：perl, apache, mod-deflate, lwp

I have a client/server system that performs communication using XML transferred using HTTP requests and responses with the client using Perl's LWP and the server running Perl's CGI.pm through Apache. In addition the stream is encrypted using SSL with certificates for both the server and all clients.

This system works well, except that periodically the client needs to send really large amounts of data. An obvious solution would be to compress the data on the client side, send it over, and decompress it on the server. Rather than implement this myself, I was hoping to use Apache's mod_deflate's "Input Decompression" as described [here](http://httpd.apache.org/docs/2.0/mod/mod_deflate.html).

The description warns:

> If you evaluate the request body yourself, don't trust the Content-Length header! The Content-Length header reflects the length of the incoming data from the client and not the byte count of the decompressed data stream.

So if I provide a Content-Length value which matches the compressed data size, the data is truncated. This is because mod_deflate decompresses the stream, but CGI.pm only reads to the Content-Length limit.

Alternatively, if I try to outsmart it and override the Content-Length header with the decompressed data size, LWP complains and resets the value to the compressed length, leaving me with the same problem.

Finally, I attempted to hack the part of LWP which does the correction. The original code is:

```
 # Set (or override) Content-Length header
    my $clen = $request_headers->header('Content-Length');
    if (defined($$content_ref) && length($$content_ref)) {
        $has_content = length($$content_ref);
        if (!defined($clen) || $clen ne $has_content) {
            if (defined $clen) {
                warn "Content-Length header value was wrong, fixed";
                hlist_remove(\@h, 'Content-Length');
            }
            push(@h, 'Content-Length' => $has_content);
        }
    }
    elsif ($clen) {
        warn "Content-Length set when there is no content, fixed";
        hlist_remove(\@h, 'Content-Length');
    } 
```

And I changed the push line to:

```
 push(@h, 'Content-Length' => $clen); 
```

Unfortunately this causes some problem where content (truncated or not) doesn't even get to my CGI script.

Has anyone made this work? I found [this](http://hype-free.blogspot.com/2007/07/compressed-http.html) which does compression on a file before uploading, but not compressing a generic request.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T07:06:41.353

我认为您不能像那样更改 Content-Length 。它会使 Apache 感到困惑，因为 mod_deflate 不知道要读取多少压缩数据。让客户端添加一个 X-Uncompressed-Length 标头，然后使用使用 X-Uncompressed-Length（如果存在）而不是 Content-Length 的修改版本的 CGI.pm 怎么样？（实际上，您可能不需要修改 CGI.pm。只需`$ENV{'CONTENT_LENGTH'}`在初始化 CGI 对象或调用任何 CGI 函数之前设置为适当的值即可。）

或者，使用一个较低级别的模块，该模块使用 bucket brigade 来判断要读取多少数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T13:21:07.107

尽管您说您不想自己进行压缩，但是有很多 perl 模块可以为您完成这两个方面，例如[Compress::Zlib 。](http://search.cpan.org/dist/Compress-Zlib/)

我有一个作弊器（公司的 .net 部分），我将 XML 作为一个单独的参数传递到其中，然后可以像处理字符串一样处理它，而不是用 SOAP 之类的东西来处理它。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-09-26T01:35:21.617

我不确定我是否按照你想要的方式关注你，但我有一个自定义的 get/post 模块，我用它来做一些非标准的事情。下面的代码将读取通过邮寄或 STDIN 发送的任何内容。

```
read(STDIN, $query_string, $ENV{'CONTENT_LENGTH'}); 
```

不要使用 $ENV 的值，而是使用你的值。我希望这会有所帮助，如果没有，我很抱歉。

# wpf - 有什么方法可以使 WPF 文本块可选？

> ID：136435
> 
> 赞同：250
> 
> 时间：2008-09-25T21:56:51.003
> 
> 标签：wpf, xaml, textbox, textblock

如何允许`TextBlock`选择文本？

我试图通过使用样式看起来像文本块的只读文本框显示文本来使其工作，但这在我的情况下不起作用，因为文本框没有内联。换句话说，如何使它可选择？

* * *

## 回答 #1

> 赞同：258
> 
> 时间：2010-03-24T09:27:23.480

将 a`TextBox`与这些设置一起使用以使其只读并看起来像一个`TextBlock`控件。

```
<TextBox Background="Transparent"
         BorderThickness="0"
         Text="{Binding Text, Mode=OneWay}"
         IsReadOnly="True"
         TextWrapping="Wrap" /> 
```

* * *

## 回答 #2

> 赞同：85
> 
> 时间：2017-08-11T05:23:52.730

这里的所有答案都只是使用`TextBox`或尝试手动实现文本选择，这会导致性能不佳或非本机行为（在 中闪烁插入符号`TextBox`，手动实现中不支持键盘等）

经过数小时的挖掘和阅读[WPF 源代码](https://referencesource.microsoft.com/#PresentationFramework/src/Framework/System/Windows/Controls/FlowDocumentScrollViewer.cs,694a70a8f6818358)`TextBlock`后，我发现了一种为控件（或实际上是任何其他控件）启用本机 WPF 文本选择的方法。围绕文本选择的大部分功能都是在`System.Windows.Documents.TextEditor`系统类中实现的。

要为您的控件启用文本选择，您需要做两件事：

1.  调用`TextEditor.RegisterCommandHandlers()`一次以注册类事件处理程序

2.  `TextEditor`为您的类的每个实例创建一个实例并将您的基础实例传递`System.Windows.Documents.ITextContainer`给它

还需要将控件的`Focusable`属性设置为`True`.

就是这个！听起来很简单，但不幸的是，`TextEditor`类被标记为内部。所以我不得不在它周围写一个反射包装器：

```
class TextEditorWrapper
{
    private static readonly Type TextEditorType = Type.GetType("System.Windows.Documents.TextEditor, PresentationFramework, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35");
    private static readonly PropertyInfo IsReadOnlyProp = TextEditorType.GetProperty("IsReadOnly", BindingFlags.Instance | BindingFlags.NonPublic);
    private static readonly PropertyInfo TextViewProp = TextEditorType.GetProperty("TextView", BindingFlags.Instance | BindingFlags.NonPublic);
    private static readonly MethodInfo RegisterMethod = TextEditorType.GetMethod("RegisterCommandHandlers", 
        BindingFlags.Static | BindingFlags.NonPublic, null, new[] { typeof(Type), typeof(bool), typeof(bool), typeof(bool) }, null);

    private static readonly Type TextContainerType = Type.GetType("System.Windows.Documents.ITextContainer, PresentationFramework, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35");
    private static readonly PropertyInfo TextContainerTextViewProp = TextContainerType.GetProperty("TextView");

    private static readonly PropertyInfo TextContainerProp = typeof(TextBlock).GetProperty("TextContainer", BindingFlags.Instance | BindingFlags.NonPublic);

    public static void RegisterCommandHandlers(Type controlType, bool acceptsRichContent, bool readOnly, bool registerEventListeners)
    {
        RegisterMethod.Invoke(null, new object[] { controlType, acceptsRichContent, readOnly, registerEventListeners });
    }

    public static TextEditorWrapper CreateFor(TextBlock tb)
    {
        var textContainer = TextContainerProp.GetValue(tb);

        var editor = new TextEditorWrapper(textContainer, tb, false);
        IsReadOnlyProp.SetValue(editor._editor, true);
        TextViewProp.SetValue(editor._editor, TextContainerTextViewProp.GetValue(textContainer));

        return editor;
    }

    private readonly object _editor;

    public TextEditorWrapper(object textContainer, FrameworkElement uiScope, bool isUndoEnabled)
    {
        _editor = Activator.CreateInstance(TextEditorType, BindingFlags.Instance | BindingFlags.NonPublic | BindingFlags.CreateInstance, 
            null, new[] { textContainer, uiScope, isUndoEnabled }, null);
    }
} 
```

我还创建了一个`SelectableTextBlock`派生的`TextBlock`，采用上述步骤：

```
public class SelectableTextBlock : TextBlock
{
    static SelectableTextBlock()
    {
        FocusableProperty.OverrideMetadata(typeof(SelectableTextBlock), new FrameworkPropertyMetadata(true));
        TextEditorWrapper.RegisterCommandHandlers(typeof(SelectableTextBlock), true, true, true);

        // remove the focus rectangle around the control
        FocusVisualStyleProperty.OverrideMetadata(typeof(SelectableTextBlock), new FrameworkPropertyMetadata((object)null));
    }

    private readonly TextEditorWrapper _editor;

    public SelectableTextBlock()
    {
        _editor = TextEditorWrapper.CreateFor(this);
    }
} 
```

另一种选择是创建一个附加属性，`TextBlock`以便按需启用文本选择。在这种情况下，要再次禁用选择，需要`TextEditor`使用以下代码的反射等效项来分离 a：

```
_editor.TextContainer.TextView = null;
_editor.OnDetach();
_editor = null; 
```

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2015-09-30T15:51:10.557

我一直找不到任何真正回答这个问题的例子。所有答案都使用了 Textbox 或 RichTextbox。我需要一个允许我使用 TextBlock 的解决方案，这就是我创建的解决方案。

我相信正确的方法是扩展 TextBlock 类。这是我用来扩展 TextBlock 类以允许我选择文本并将其复制到剪贴板的代码。“sdo”是我在 WPF 中使用的命名空间引用。

**WPF 使用扩展类：**

```
xmlns:sdo="clr-namespace:iFaceCaseMain"

<sdo:TextBlockMoo x:Name="txtResults" Background="Black" Margin="5,5,5,5" 
      Foreground="GreenYellow" FontSize="14" FontFamily="Courier New"></TextBlockMoo> 
```

**扩展类的代码隐藏：**

```
public partial class TextBlockMoo : TextBlock 
{
    TextPointer StartSelectPosition;
    TextPointer EndSelectPosition;
    public String SelectedText = "";

    public delegate void TextSelectedHandler(string SelectedText);
    public event TextSelectedHandler TextSelected;

    protected override void OnMouseDown(MouseButtonEventArgs e)
    {
        base.OnMouseDown(e);
        Point mouseDownPoint = e.GetPosition(this);
        StartSelectPosition = this.GetPositionFromPoint(mouseDownPoint, true);            
    }

    protected override void OnMouseUp(MouseButtonEventArgs e)
    {
        base.OnMouseUp(e);
        Point mouseUpPoint = e.GetPosition(this);
        EndSelectPosition = this.GetPositionFromPoint(mouseUpPoint, true);

        TextRange otr = new TextRange(this.ContentStart, this.ContentEnd);
        otr.ApplyPropertyValue(TextElement.ForegroundProperty, new SolidColorBrush(Colors.GreenYellow));

        TextRange ntr = new TextRange(StartSelectPosition, EndSelectPosition);
        ntr.ApplyPropertyValue(TextElement.ForegroundProperty, new SolidColorBrush(Colors.White));

        SelectedText = ntr.Text;
        if (!(TextSelected == null))
        {
            TextSelected(SelectedText);
        }
    }
} 
```

**示例窗口代码：**

```
 public ucExample(IInstanceHost host, ref String WindowTitle, String ApplicationID, String Parameters)
    {
        InitializeComponent();
        /*Used to add selected text to clipboard*/
        this.txtResults.TextSelected += txtResults_TextSelected;
    }

    void txtResults_TextSelected(string SelectedText)
    {
        Clipboard.SetText(SelectedText);
    } 
```

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2008-09-26T02:29:06.857

为 TextBlock 创建 ControlTemplate 并在其中放置一个带有只读属性集的 TextBox。或者只是使用 TextBox 并将其设置为只读，然后您可以更改 TextBox.Style 使其看起来像 TextBlock。

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2012-02-10T16:41:33.797

将此样式应用于您的 TextBox 就是这样（灵感来自[这篇文章](https://web.archive.org/web/20130601215415/http://beta.blogs.microsoft.co.il/blogs/eshaham/archive/2009/07/06/selectable-text-control.aspx)）：

```
<Style x:Key="SelectableTextBlockLikeStyle" TargetType="TextBox" BasedOn="{StaticResource {x:Type TextBox}}">
    <Setter Property="IsReadOnly" Value="True"/>
    <Setter Property="IsTabStop" Value="False"/>
    <Setter Property="BorderThickness" Value="0"/>
    <Setter Property="Background" Value="Transparent"/>
    <Setter Property="Padding" Value="-2,0,0,0"/>
    <!-- The Padding -2,0,0,0 is required because the TextBox
        seems to have an inherent "Padding" of about 2 pixels.
        Without the Padding property,
        the text seems to be 2 pixels to the left
        compared to a TextBlock
    -->
    <Style.Triggers>
        <MultiTrigger>
            <MultiTrigger.Conditions>
                <Condition Property="IsMouseOver" Value="False" />
                <Condition Property="IsFocused" Value="False" />
            </MultiTrigger.Conditions>
            <Setter Property="Template">
                <Setter.Value>
                <ControlTemplate TargetType="{x:Type TextBox}">
                    <TextBlock Text="{TemplateBinding Text}" 
                             FontSize="{TemplateBinding FontSize}"
                             FontStyle="{TemplateBinding FontStyle}"
                             FontFamily="{TemplateBinding FontFamily}"
                             FontWeight="{TemplateBinding FontWeight}"
                             TextWrapping="{TemplateBinding TextWrapping}"
                             Foreground="{DynamicResource NormalText}"
                             Padding="0,0,0,0"
                                       />
                </ControlTemplate>
                </Setter.Value>
            </Setter>
        </MultiTrigger>
    </Style.Triggers>
</Style> 
```

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2008-09-25T22:45:17.377

我不确定您是否可以选择 TextBlock，但另一种选择是使用 RichTextBox - 它就像您建议的 TextBox，但支持您想要的格式。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2016-01-29T18:10:46.687

根据[Windows 开发中心](https://msdn.microsoft.com/en-us/library/windows/apps/windows.ui.xaml.controls.textblock.istextselectionenabled.aspx)：

> **TextBlock.IsTextSelectionEnabled 属性**
> 
> [针对 Windows 10 上的 UWP 应用进行了更新。有关 Windows 8.x 文章，请参阅[存档](http://go.microsoft.com/fwlink/p/?linkid=619132)]
> 
> 获取或设置一个值，该值指示是否通过用户操作或调用与选择相关的 API在[TextBlock中启用文本选择。](https://msdn.microsoft.com/en-us/library/windows/apps/windows.ui.xaml.controls.textblock.aspx)

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2017-05-12T23:29:09.147

虽然问题确实说“可选择”，但我相信有意的结果是将文本放到剪贴板。这可以通过添加上下文菜单和名为副本的菜单项来轻松优雅地实现，该副本将 Textblock Text 属性值放入剪贴板。反正只是一个想法。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2011-09-13T09:57:27.153

TextBlock 没有模板。所以为了实现这一点，我们需要使用一个TextBox，它的样式被改变为一个textBlock。

```
<Style x:Key="TextBlockUsingTextBoxStyle" BasedOn="{x:Null}" TargetType="{x:Type TextBox}">
    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
    <Setter Property="Background" Value="Transparent"/>
    <Setter Property="BorderBrush" Value="{StaticResource TextBoxBorder}"/>
    <Setter Property="BorderThickness" Value="0"/>
    <Setter Property="Padding" Value="1"/>
    <Setter Property="AllowDrop" Value="true"/>
    <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
    <Setter Property="ScrollViewer.PanningMode" Value="VerticalFirst"/>
    <Setter Property="Stylus.IsFlicksEnabled" Value="False"/>
    <Setter Property="Template">
        <Setter.Value>
            <ControlTemplate TargetType="{x:Type TextBox}">
                <TextBox BorderThickness="{TemplateBinding BorderThickness}" IsReadOnly="True" Text="{TemplateBinding Text}" Background="{x:Null}" BorderBrush="{x:Null}" />
            </ControlTemplate>
        </Setter.Value>
    </Setter>
</Style> 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-06-28T13:17:34.210

[有一种替代解决方案可能适用于本博客文章](http://beta.blogs.microsoft.co.il/blogs/eshaham/archive/2009/07/06/selectable-text-control.aspx)中的 RichTextBox - 当用户悬停在控件上时，它使用触发器来换出控件模板 - 应该有助于提高性能

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-11-10T14:21:02.247

```
 new TextBox
{
   Text = text,
   TextAlignment = TextAlignment.Center,
   TextWrapping = TextWrapping.Wrap,
   IsReadOnly = true,
   Background = Brushes.Transparent,
   BorderThickness = new Thickness()
         {
             Top = 0,
             Bottom = 0,
             Left = 0,
             Right = 0
         }
}; 

```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-07-07T11:06:10.180

我已经在我的开源控件库中实现了[SelectableTextBlock 。](http://blog.angeloflogic.com/2014/07/selectabletextblock-in-junglecontrols.html)你可以像这样使用它：

```
<jc:SelectableTextBlock Text="Some text" /> 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-03-25T17:17:47.527

```
Really nice and easy solution, exactly what I wanted ! 
```

我带来了一些小的修改

```
public class TextBlockMoo : TextBlock 
{
    public String SelectedText = "";

    public delegate void TextSelectedHandler(string SelectedText);
    public event TextSelectedHandler OnTextSelected;
    protected void RaiseEvent()
    {
        if (OnTextSelected != null){OnTextSelected(SelectedText);}
    }

    TextPointer StartSelectPosition;
    TextPointer EndSelectPosition;
    Brush _saveForeGroundBrush;
    Brush _saveBackGroundBrush;

    TextRange _ntr = null;

    protected override void OnMouseDown(MouseButtonEventArgs e)
    {
        base.OnMouseDown(e);

        if (_ntr!=null) {
            _ntr.ApplyPropertyValue(TextElement.ForegroundProperty, _saveForeGroundBrush);
            _ntr.ApplyPropertyValue(TextElement.BackgroundProperty, _saveBackGroundBrush);
        }

        Point mouseDownPoint = e.GetPosition(this);
        StartSelectPosition = this.GetPositionFromPoint(mouseDownPoint, true);            
    }

    protected override void OnMouseUp(MouseButtonEventArgs e)
    {
        base.OnMouseUp(e);
        Point mouseUpPoint = e.GetPosition(this);
        EndSelectPosition = this.GetPositionFromPoint(mouseUpPoint, true);

        _ntr = new TextRange(StartSelectPosition, EndSelectPosition);

        // keep saved
        _saveForeGroundBrush = (Brush)_ntr.GetPropertyValue(TextElement.ForegroundProperty);
        _saveBackGroundBrush = (Brush)_ntr.GetPropertyValue(TextElement.BackgroundProperty);
        // change style
        _ntr.ApplyPropertyValue(TextElement.BackgroundProperty, new SolidColorBrush(Colors.Yellow));
        _ntr.ApplyPropertyValue(TextElement.ForegroundProperty, new SolidColorBrush(Colors.DarkBlue));

        SelectedText = _ntr.Text;
    }
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-11-14T09:02:51.827

```
public MainPage()
{
    this.InitializeComponent();
    ...
    ...
    ...
    //Make Start result text copiable
    TextBlockStatusStart.IsTextSelectionEnabled = true;
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2019-03-28T12:13:10.117

添加到@torvin 的答案和@Dave Huang 在评论中提到的如果您`TextTrimming="CharacterEllipsis"`启用了应用程序在您将鼠标悬停在省略号上时崩溃。

我尝试了线程中提到的有关使用 TextBox 的其他选项，但它确实似乎不是解决方案，因为它没有显示“省略号”，而且如果文本太长而无法容纳选择内容的容器文本框在内部“滚动”，这不是 TextBlock 行为。

我认为最好的解决方案是@torvin 的答案，但是在将鼠标悬停在省略号上时会发生严重的崩溃。

我知道这并不漂亮，但是在内部订阅/取消订阅未处理的异常并处理异常是我发现解决此问题的唯一方法，如果有人有更好的解决方案，请分享:)

```
public class SelectableTextBlock : TextBlock
{
    static SelectableTextBlock()
    {
        FocusableProperty.OverrideMetadata(typeof(SelectableTextBlock), new FrameworkPropertyMetadata(true));
        TextEditorWrapper.RegisterCommandHandlers(typeof(SelectableTextBlock), true, true, true);

        // remove the focus rectangle around the control
        FocusVisualStyleProperty.OverrideMetadata(typeof(SelectableTextBlock), new FrameworkPropertyMetadata((object)null));
    }

    private readonly TextEditorWrapper _editor;

    public SelectableTextBlock()
    {
        _editor = TextEditorWrapper.CreateFor(this);

        this.Loaded += (sender, args) => {
            this.Dispatcher.UnhandledException -= Dispatcher_UnhandledException;
            this.Dispatcher.UnhandledException += Dispatcher_UnhandledException;
        };
        this.Unloaded += (sender, args) => {
            this.Dispatcher.UnhandledException -= Dispatcher_UnhandledException;
        };
    }

    private void Dispatcher_UnhandledException(object sender, DispatcherUnhandledExceptionEventArgs e)
    {
        if (!string.IsNullOrEmpty(e?.Exception?.StackTrace))
        {
            if (e.Exception.StackTrace.Contains("System.Windows.Controls.TextBlock.GetTextPositionFromDistance"))
            {
                e.Handled = true;
            }
        }
    }
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-04-10T15:31:18.887

只需使用 a `FlowDocument`inside a `FlowDocumentScrollViewer`，将您的内联传递给元素。您可以控制元素的样式，在我的例子中，我添加了一个小边框。

```
<FlowDocumentScrollViewer Grid.Row="2" Margin="5,3" BorderThickness="1" 
                          BorderBrush="{DynamicResource Element.Border}" 
                          VerticalScrollBarVisibility="Auto">
    <FlowDocument>
        <Paragraph>
            <Bold>Some bold text in the paragraph.</Bold>
            Some text that is not bold.
        </Paragraph>

        <List>
            <ListItem>
                <Paragraph>ListItem 1</Paragraph>
            </ListItem>
            <ListItem>
                <Paragraph>ListItem 2</Paragraph>
            </ListItem>
            <ListItem>
                <Paragraph>ListItem 3</Paragraph>
            </ListItem>
        </List>
    </FlowDocument>
</FlowDocumentScrollViewer> 
```

[![在此处输入图像描述](https://i.stack.imgur.com/vXYTk.png)](https://i.stack.imgur.com/vXYTk.png)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2021-06-26T06:51:01.623

这对我有用。我创建了一个派生自 TextBox 并设置为只读的类 TextBlockEx，并在构造函数中自动换行。

```
public class TextBlockEx : TextBox
{
    public TextBlockEx()
    {
        base.BorderThickness = new Thickness(0);
        IsReadOnly = true;
        TextWrapping = TextWrapping.Wrap;
        //Background = Brushes.Transparent; // Uncomment to get parent's background color
    }
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2021-09-08T23:31:05.457

我同意这里的大多数答案都不会创建可选择的 Text **Block**。@Billy Willoughby 运行良好，但没有明显的选择提示。我想扩展他的扩展，它可以在选中文本时突出显示文本。它还包含双击和三次单击选择。如果需要，您可以添加带有“复制”的上下文菜单。它使用该`Background`属性来“突出显示”选择，因此它受到限制，因为它会覆盖`Run.Background`

[https://github.com/mwagnerEE/WagnerControls](https://github.com/mwagnerEE/WagnerControls)

# c# - 如何在 C# 中运行一系列进程并保持其环境设置？

> ID：136436
> 
> 赞同：3
> 
> 时间：2008-09-25T21:57:25.870
> 
> 标签：c#, build-process, makefile, environment, auto-build

我正在开发一个自动构建器，它将在我们的构建过程中运行一系列步骤并构建我们的目标应用程序。我们曾经使用一个批处理文件来设置一堆环境变量或调用工具来设置环境变量并最终运行“make”。

我一直在使用“进程”类，它非常适合运行这些命令，但不幸的是，每次运行都会改变环境（比如在 PATH 中添加一些东西），当“进程”完成时，这些变量就会丢失。下一个“进程”被实例化并再次从“调用”应用程序（我的 exe）继承环境 - 这意味着最后一个命令设置的所有环境都丢失了。你如何处理这种情况？有没有更好的方法在 C# 中运行一系列类似批处理文件的命令并维护它们设置的环境？

请注意，不幸的是，老同学已经声明 nant/ant 不是一个选项，所以“嘿，为什么不使用 Nant - 它就是这样做的！” 不是我要找的答案。

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-25T22:06:08.000

那么，System.Environment.SetEnvironmentVariable() 方法将让您指定您设置的变量的范围。这是你想要的？不确定我是否理解。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-25T22:06:19.687

我们使用 CruiseControl.net 来运行 NAnt 脚本。强烈推荐。

可以使用 -D: 命令行开关调用 NAnt 脚本来设置等效的环境变量。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T22:06:24.490

我会建议一些将您的环境变量保存到外部文件的代码，然后您可以在以下流程开始时通过外部文件检索这些变量。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T22:14:53.270

我认为问题不在于在这里指定自定义环境变量。（您可以通过 ProcessStartInfo 设置它们。）问题在于读取正在运行的进程对环境变量所做的更改。我不确定这是否可能。我知道为进程本身和/或其子进程设置环境变量的唯一方法。我不知道没有办法为父进程设置环境变量。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T04:56:39.467

永远不会设置环境变量，也不能为父进程 (*) 设置环境变量。仅适用于当前流程及其创建的流程 - 这是概念的一部分。

(*) 除了，也许，搞乱操作系统内部。

# html - IE7为什么不复制 blocks to the clipboard correctly?

> ID：136443
> 
> 赞同：37
> 
> 时间：2008-09-25T21:58:05.383
> 
> 标签：html, internet-explorer

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-10-01T20:36:04.193

It seems that this is a known bug for IE6 and prettify.js has a workaround for it. Specifically it replaces the BR tags with '\r\n'.

By modifying the check to allow for IE6 or 7 then the cut-and-paste will work correctly from IE7, but it will render with a *newline* followed by a *space*. By checking for IE7 and providing just a '\r' instead of a '\r\n' it will continue to cut-and-paste and render correctly.

Add this code to prettify.js:

```
function _pr_isIE7() {
  var isIE7 = navigator && navigator.userAgent &&
       /\bMSIE 7\./.test(navigator.userAgent);
  _pr_isIE7 = function () { return isIE7; };
  return isIE7;
} 
```

and then modify the prettyPrint function as follows:

```
 function prettyPrint(opt_whenDone) {
     var isIE6 = _pr_isIE6();
+    var isIE7 = _pr_isIE7(); 
```

...

```
-        if (isIE6 && cs.tagName === 'PRE') {
+        if ((isIE6 || isIE7) && cs.tagName === 'PRE') {
          var lineBreaks = cs.getElementsByTagName('br');
+         var newline;
+         if (isIE6) {
+           newline = '\r\n';
+         } else {
+           newline = '\r';
+         }
          for (var j = lineBreaks.length; --j >= 0;) {
            var lineBreak = lineBreaks[j];
            lineBreak.parentNode.replaceChild(
-               document.createTextNode('\r\n'), lineBreak);
+               document.createTextNode(newline), lineBreak);
          } 
```

You can see a [working example here](http://andrjohn.myzen.co.uk/soTest/136443.html).

**Note:** I haven't tested the original workaround in IE6, so I'm guessing it renders without the space caused by the '\n' that is seen in IE7, otherwise the fix is simpler.

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-25T22:25:55.113

Here's the issue:

Your code colorization script replaces line breaks with <br /> tags. When copying/pasting, IE7 apparently doesn't translate the <br /> tag into a linebreak like it does for the screen.

In other words, your code becomes this:

```
public PageSizer(string href, int index)<br />{<br />    HRef = href;<br />    PageIndex = index;<br />    }
```

But you want it to become this:

```
 public PageSizer(string href, int index)<br />
{<br />
    HRef = href;<br />
    PageIndex = index;<br />
}<br /> 
```

In the latest version of prettify.js on Google Code, the line responsible is line 1001 (part of recombineTagsAndDecorations):

```
 html.push(htmlChunk.replace(newlineRe, '<br />')); 
```

Edited, based on the comments:
For IE7, this is what the line should probably be changed to:

```
 html.push(htmlChunk.replace(newlineRe, '\n')); 
```

(Assuming newlineRe is a placeholder).

This fix also holds up in Chrome, and FFX3... I'm not sure which (if any) browsers need the <br /> tags.

**Update:** More information in my second response:
[Why doesn't IE7 copy <pre><code> blocks to the clipboard correctly?](https://stackoverflow.com/questions/136443/why-doesnt-ie7-copy-precode-blocks-to-the-clipboard-correctly#156069)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-25T22:52:08.187

This looks like a bug in IE, *BR* tags inside the *PRE* or *CODE* are not being converted into newlines in the plain text copy buffer. The rich text copy buffer is fine, so the paste works as expected for applications like *wordpad*.

The prettify script, that colours the code, removes **all** the whitespace and replaces it with HTML tags for spaces and new lines. The generated code looks something like this:

```
<pre><code>code<br/>&nbsp;&nbsp;code<br/>&nbsp;&nbsp;code<br/>code</code></pre>

```

The *PRE* and *CODE* tags are rendered by defaults with the CSS style of ***{whitespace: pre}***. In this case, IE is failing to turn the *BR* tags into newlines. It would work on your original HTML because IE will successfully turn actual newlines into newlines.

In order to fix it you have 3 options. (I am presuming you want nice HTML **and** the ability to work well with and without javascript enabled on the client):

1.  You could place the code inside a normal div and use CSS to render it using ***{whitespace: pre}***. This is a simple solution, although might not please an HTML markup purist.

2.  You could have two copies of the code, one using proper *PRE* / *CODE* tags and another in a normal div. In your CSS you hide the normal div. Using javascript you prettify the normal div and hide the pre/code version.

3.  Modify the prettify script to recognise that it is acting on a *PRE* or *CODE* element and to not replace the whitespace in that event.

* * *

**Notes:**

*   What is important is not the HTML in your source, but the HTML that is generated after the prettify script has ran on it.

*   This bug is still present even if the white-space mode of the *PRE* is changed to *normal* using CSS.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-11-04T23:45:37.413

This site has addressed the issue: [http://www.developerfusion.com/tools/convert/csharp-to-vb/](http://www.developerfusion.com/tools/convert/csharp-to-vb/)

I suggest a "Copy to Clipboard" button as part of the code display box. This button would copy version of the displayed information as plain text. The plain text could be stored as an internal page property.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T01:19:17.377

bad news : none of the proposed fixes work. Modifying prettify.js around line 1000

```
html.push(htmlChunk.replace(newlineRe, '\n')); 
```

This causes double-spacing in other browsers, and *still* doesn't solve the IE7 copy to notepad problem! So even if I selectively detected IE7, this "fix" doesn't fix anything.

I guess maybe it is simply a bug in IE7 having to do with JavaScript rebuilding a `<pre>` element -- no matter how many \n newlines I put in there, nothing changes w/r/t to the paste to notepad behavior.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T03:04:15.330

@Jeff Atwood It's the right idea, but the implementation still needs work. I guess my air code just didn't cut it :)

I suspect that the fix I mentioned earlier doesn't work because prettify is doing some additional processing on the text after line ~1000 is called.

Trying to track the content backwards from when it's added to the page, I came across this comment around line 1227:

```
 // Replace <br>s with line-feeds so that copying and pasting works
// on IE 6.
// Doing this on other browsers breaks lots of stuff since \r\n is
// treated as two newlines on Firefox, and doing this also slows
// down rendering. 
```

When I took the isIE6 condition off of the code, it mostly worked in IE7 (there was an extra line break at the top and bottom), and Firefox 3... But I'd assume that it causes issues with older versions of FFX.

At the very least, it appears that IE7 will require \r\n, instead of just \n. Figuring out exactly what will work with which browsers will take a more extensive test setup than I have handy at the moment.

Anyway, inserting the \r\n for IE7 appears to be basically what needs to happen. I'll keep poking around prettify to see if I can narrow it down further.

**UPDATE:** IE7 appears to strip newline characters (\r or \n) from strings that are assigned to an innerHTML property. It looks like they need to be added back in, around line 1227.

A correct solution would probably mean inserting a placeholder tag around line 1000, and then replacing it around line 1227.

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-25T22:09:36.730

Remove the inner `<code>`. IE's copy/paste behavior could see that as an inline tag and forget about the visible whitespace.

# network-programming - 如何从 C 程序发送 ARP 数据包？

> ID：136444
> 
> 赞同：1
> 
> 时间：2008-09-25T21:58:21.750
> 
> 标签：network-programming

我正在使用 C 语言开发嵌入式 linux 系统，我正在寻找 Windows 中 SendARP 等价物的源代码。任何指针？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T02:18:47.443

看看[arping](http://freshmeat.net/projects/arping/)。发送 arp 的快速而肮脏的方法是：

```
 foo = system("/somepath/arping somehost"); 
```

但是通过arping源查看应该能够为您提供更好的解决方案。

不过，对于全面解决方案，您可以手动构建自己的解决方案，并使用原始套接字或[libpcap](http://www.tcpdump.org/)发送它。

* * *

顺便提一句。如果您想要做的只是强制发送一个 arp（但必须来自您），您可以通过删除您已经为您的主机拥有的任何 arp 条目来实现这一点。对该地址的下一次访问将需要发送一个 arp。

例如。/usr/sbin/arp -d 目的地主机IP

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-25T22:06:43.880

这可能很有趣：[http ://cvs.linux-ha.org/viewcvs/viewcvs.cgi/linux-ha/resources/heartbeat/SendArp.in?rev=1.4](http://cvs.linux-ha.org/viewcvs/viewcvs.cgi/linux-ha/resources/heartbeat/SendArp.in?rev=1.4)

它是 Bourne Shell 脚本中的一个实现。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T22:09:41.923

我从未见过任何专门针对 ARP 的东西，但我认为您可以使用[libpcap](http://www.tcpdump.org/pcap3_man.html)和适当的 RFC 发送任何类型的数据包。

# math - 概率问题 - 从大篮子中选择时重复

> ID：136456
> 
> 赞同：2
> 
> 时间：2008-09-25T22:00:26.783
> 
> 标签：math, probability

我需要向客户解释为什么骗子会出现在 2 次据称不同的考试之间。Prob and Stats 已经 20 年了。

我有一个生成的多项选择考试。数据库中有 192 个问题，100 个是随机选择的（没有重复）。

显然，这样生成的任何两次考试之间有 100% 的机会至少有 8 次重复。（鸽笼原理）

如何计算有 25 个骗子的概率？50个骗子？75个骗子？

-- 事后编辑 -- 我通过 excel 运行这个，从 n-100 中取概率的总和，对于这个特定的问题，概率是

```
n   P(n+ dupes)
40  97.5%
52  ~50% 
61  ~0 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T22:18:33.587

嗯，这对我来说真的很朦胧。但是有（192 选择 100）可能的考试，对吧？

并且有（100 种选择 N）选择 N 个受骗者的方法，每种方法都有（92 种选择 100-N）选择其余问题的方法，不是吗？

因此，挑选 N 个骗子的概率不只是：

(100 选 N) * (92 选 100-N) / (192 选 100)

编辑：因此，如果您想要*N 个或更多*欺骗的机会而不是恰好 N，您必须将 N 的所有值的上半部分相加，从最小欺骗数到 100。

呃，也许……

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T22:13:08.657

创建第一个考试后，有 92 个问题从未使用过，还有 100 个问题已经使用过。如果您现在生成另一个考试，其中包含 100 个问题，那么您将从一组 92 个从未使用过的问题和 100 个已经使用过的问题中进行选择。很明显，你会得到相当多的重复。

您会期望得到 (100/192) * 100 个重复问题，即在任意两个随机选择的考试中，（平均）会有 52 个重复问题。

如果你想要有 25、75 或其他的概率，那么你有两个选择。

a) 计算数学

b) 在电脑上模拟几次运行

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T22:02:46.417

它可能比你想象的要高。我不会尝试复制这篇文章：[http ://en.wikipedia.org/wiki/Birthday_paradox](http://en.wikipedia.org/wiki/Birthday_paradox)

# javascript - 更改浏览器中的 URL 而不使用 JavaScript 加载新页面

> ID：136458
> 
> 赞同：302
> 
> 时间：2008-09-25T22:00:38.887
> 
> 标签：javascript, url, html5-history, fragment-identifier, hashchange

我怎么会有一个[JavaScript](http://en.wikipedia.org/wiki/JavaScript)操作，它可能对当前页面有一些影响，但也会改变浏览器中的 URL，所以如果用户点击重新加载或书签，那么使用新的 URL？

如果后退按钮可以重新加载原始 URL，那也很好。

我正在尝试在 URL 中记录 JavaScript 状态。

* * *

## 回答 #1

> 赞同：187
> 
> 时间：2008-09-25T22:08:40.663

如果您希望它在尚不支持的浏览器中工作`history.pushState`，`history.popState`“旧”方法是设置片段标识符，这不会导致页面重新加载。

基本思想是将`window.location.hash`属性设置为包含您需要的任何状态信息的值，然后使用[window.onhashchange 事件](https://developer.mozilla.org/en/DOM/window.onhashchange)，或者对于不支持的旧浏览器`onhashchange`（IE < 8，Firefox < 3.6），定期检查查看哈希是否已更改（`setInterval`例如使用）并更新页面。您还需要检查页面加载时的哈希值以设置初始内容。

如果您使用的是 jQuery，则有一个[hashchange 插件](http://benalman.com/projects/jquery-hashchange-plugin/)，它将使用浏览器支持的任何方法。我确信其他库也有插件。

需要注意的一件事是与页面上的 id 发生冲突，因为浏览器将滚动到任何具有匹配 id 的元素。

* * *

## 回答 #2

> 赞同：122
> 
> 时间：2010-11-19T06:20:18.737

在 HTML 5 中，使用[`history.pushState`函数](http://www.whatwg.org/specs/web-apps/current-work/multipage/history.html). 举个例子：

```
<script type="text/javascript">
var stateObj = { foo: "bar" };
function change_my_url()
{
   history.pushState(stateObj, "page 2", "bar.html");
}
var link = document.getElementById('click');
link.addEventListener('click', change_my_url, false);
</script> 
```

和一个href：

```
<a href="#" id='click'>Click to change url to bar.html</a> 
```

* * *

如果要更改 URL 而不向后退按钮列表添加条目，请`history.replaceState`改用。

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2008-09-25T22:19:36.673

window.location.href 包含当前 URL。您可以从中读取，可以附加到它，也可以替换它，这可能会导致页面重新加载。

如果听起来像，您想在 URL 中记录 javascript 状态以便可以将其添加为书签，而无需重新加载页面，请将其附加到当前 URL 后 # 并让一段由 onload 事件触发的 javascript 解析当前URL 以查看它是否包含已保存状态。

如果您使用 ? 而不是#，您将强制重新加载页面，但是由于您将在加载时解析保存的状态，这实际上可能不是问题；这将使前进和后退按钮也能正常工作。

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2008-09-25T22:07:09.247

我强烈怀疑这是不可能的，因为如果是这样，那将是一个令人难以置信的安全问题。例如，我可以制作一个看起来像银行登录页面的页面，并让地址栏中的 URL 看起来*像真正的银行*！

也许如果您解释为什么要这样做，人们可能会提出替代方法...

*[[2011 年编辑：自从我在 2008 年写下这个答案以来，关于HTML5 技术](https://developer.mozilla.org/en/DOM/Manipulating_the_browser_history)的更多信息已经曝光，只要它来自同一来源，就可以修改 URL]*

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2013-10-08T21:04:06.183

*jQuery*有一个很棒的插件来改变浏览器的 URL，叫做**[jQuery-pusher](https://github.com/salvan13/jquery-pusher)**。

JavaScript`pushState`和 jQuery 可以一起使用，例如：

`history.pushState(null, null, $(this).attr('href'));`

**例子：**

```
$('a').click(function (event) {

  // Prevent default click action
  event.preventDefault();     

  // Detect if pushState is available
  if(history.pushState) {
    history.pushState(null, null, $(this).attr('href'));
  }
  return false;
}); 
```

仅使用*JavaScript* `history.pushState()`来更改引荐来源网址，该引荐来源网址在您更改状态后创建的 XMLHttpRequest 对象的 HTTP 标头中使用。

**例子：**

`window.history.pushState("object", "Your New Title", "/new-url");`

**pushState() 方法：**

`pushState()`接受三个参数：一个状态对象、一个标题（当前被忽略）和（可选）一个 URL。让我们更详细地检查这三个参数中的每一个：

1.  *state 对象*— state 对象是一个 JavaScript 对象，它与由`pushState()`. 每当用户导航到新状态时，都会触发一个 popstate 事件，并且该事件的 state 属性包含历史条目状态对象的副本。

    状态对象可以是任何可以序列化的对象。因为 Firefox 将状态对象保存到用户的磁盘，以便在用户重新启动浏览器后可以恢复它们，所以我们对状态对象的序列化表示施加了 640k 个字符的大小限制。如果将序列化表示大于此的状态对象传递给`pushState()`，则该方法将引发异常。如果您需要更多空间，我们鼓励您使用 sessionStorage 和/或 localStorage。

2.  *title* — Firefox 当前忽略此参数，尽管它可能在未来使用它。在此处传递空字符串应该可以安全地防止将来对该方法进行更改。或者，您可以为您要迁移到的州传递一个简短的标题。

3.  *URL* — 新历史条目的 URL 由该参数给出。请注意，在调用 之后，浏览器不会尝试加载此 URL `pushState()`，但它可能会在稍后尝试加载 URL，例如在用户重新启动浏览器之后。新的 URL 不需要是绝对的；如果是相对的，则相对于当前 URL 进行解析。新 URL 必须与当前 URL 同源；否则，`pushState()`将抛出异常。该参数是可选的；如果未指定，则将其设置为文档的当前 URL。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-09-25T22:11:14.370

浏览器安全设置防止人们直接修改显示的 url。您可以想象会导致的网络钓鱼漏洞。

在不更改页面的情况下更改 url 的唯一可靠方法是使用内部链接或哈希。例如：[http://site.com/page.html](http://site.com/page.html)变为[http://site.com/page.html#item1](http://site.com/page.html#item1)。这种技术常用于 hijax（AJAX + 保存历史）。

这样做时，我通常只使用以哈希作为 href 的操作的链接，然后使用 jquery 添加单击事件，该事件使用请求的哈希来确定和委托操作。

我希望这能让你走上正确的道路。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-25T23:47:45.043

有一个 Yahoo YUI 组件（浏览器历史管理器）可以处理这个：http: [//developer.yahoo.com/yui/history/](http://developer.yahoo.com/yui/history/)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-01-11T15:43:21.650

Facebook 的照片库在 URL 中使用 #hash 来执行此操作。以下是一些示例 URL：

在点击“下一步”之前：

```
/photo.php?fbid=496429237507&set=a.218088072507.133423.681812507&pid=5887027&id=681812507 
```

点击“下一步”后：

```
/photo.php?fbid=496429237507&set=a.218088072507.133423.681812507&pid=5887027&id=681812507#!/photo.php?fbid=496435457507&set=a.218088072507.133423.681812507&pid=5887085&id=681812507 
```

请注意紧跟新 URL 的井号 (#!)。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2019-02-15T18:19:13.683

我提出一个更简单的答案，

```
window.history.pushState(null, null, "/abc") 
```

这将`/abc`在浏览器 URL 中的域名之后添加。只需复制此代码并将其粘贴到浏览器控制台中，即可看到 URL 更改为“ [https://stackoverflow.com/abc](https://stackoverflow.com/abc) ”

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-04-20T14:03:27.483

有一个 jquery 插件 [http://www.asual.com/jquery/address/](http://www.asual.com/jquery/address/)

我认为这就是你所需要的。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2018-04-26T06:52:24.900

对我有用的是-`history.replaceState()`功能如下-

```
history.replaceState(data,"Title of page"[,'url-of-the-page']); 
```

这不会重新加载页面，您可以通过 javascript 事件来使用它

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-03-31T20:33:38.690

我想知道只要页面中的父路径相同，它是否可行，只有新的东西被附加到它上面。

所以就像假设用户在页面上：`http://domain.com/site/page.html` 然后浏览器可以让我做`location.append = new.html` ，页面变成：`http://domain.com/site/page.htmlnew.html`并且浏览器不会改变它。

或者只是允许该人更改 get 参数，所以让我们`location.get = me=1&page=1`.

所以原始页面变为`http://domain.com/site/page.html?me=1&page=1`并且它不会刷新。

# 的问题是当哈希改变时数据没有被缓存（至少我不这么认为）。因此，就像每次加载新页面时一样，而非[Ajax](http://en.wikipedia.org/wiki/Ajax_%28programming%29)页面中的后退和前进按钮能够缓存数据，而无需花费时间重新加载数据。

据我所见，Yahoo 历史记录已经一次性加载了所有数据。它似乎没有执行任何 Ajax 请求。因此，当 a`div`用于处理不同的方法超时时，不会为每个历史状态存储该数据。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-10-29T18:07:14.100

我的代码是：

```
//change address bar
function setLocation(curLoc){
    try {
        history.pushState(null, null, curLoc);
        return false;
    } catch(e) {}
        location.hash = '#' + curLoc;
} 
```

和行动：

```
setLocation('http://example.com/your-url-here'); 
```

和例子

```
$(document).ready(function(){
    $('nav li a').on('click', function(){
        if($(this).hasClass('active')) {

        } else {
            setLocation($(this).attr('href'));
        }
            return false;
    });
}); 
```

就这样 ：）

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-06-23T11:56:41.333

我在以下方面取得了成功：

```
location.hash="myValue"; 
```

它只是添加`#myValue`到当前 URL。如果您需要在页面加载上触发事件，您可以使用它`location.hash`来检查相关值。请记住从例如`#`返回的值中删除`location.hash`

```
var articleId = window.location.hash.replace("#",""); 
```

# ruby - DRY way of re-raising same set of exceptions in multiple places

> ID：136467
> 
> 赞同：3
> 
> 时间：2008-09-25T22:01:59.197
> 
> 标签：ruby, exception, metaprogramming

short:

Is there a way in Ruby to DRY-ify this:

```
def entry_point_one
  begin
    do_something
  rescue MySyntaxErrorOne, MySyntaxErrorTwo, MySyntaxErrorEtc => syn_err
    raise syn_err.exception(syn_err.message)
  end
end

def entry_point_two
  begin
    do_something_else
  rescue MySyntaxErrorOne, MySyntaxErrorTwo, MySyntaxErrorEtc => syn_err
    raise syn_err.exception(syn_err.message)
  end
end 
```

longer:

I'm building an interpreter. This interpreter can be called using different entry points. If I feed this interpreter a 'dirty' string, I expect it to raise an error. However, it would be nice if I don't get spammed by the by the entire back trace of every method called directly or indirectly by do_something, especially since the interpreter makes use of recursion.

As you can see in the above snippet, I already know a way to re raise an error and thereby removing the back trace. What I would like do is remove the duplication in the above example. The closest I have come thus far is this:

```
def entry_point_one
  re_raise_known_exceptions {do_something}
end

def entry_point_two
  re_raise_known_exceptions {do_something_else}
end

def re_raise_known_exceptions
  yield
rescue MySyntaxErrorOne, MySyntaxErrorTwo, MySyntaxErrorEtc => syn_err
    raise syn_err.exception(syn_err.message)
end 
```

But that makes the method re-raise-known-exceptions show up in the back trace.

edit: I guess what I want would be something like a C pre-processing macro

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T02:22:01.023

您可以在阵列上使用 splat。

直接来自 IRB：

```
COMMON_ERRORS = [ArgumentError, RuntimeError] # add your own 

def f
  yield
rescue *COMMON_ERRORS => err
  puts "Got an error of type #{err.class}"
end

f{ raise ArgumentError.new }
Got an error of type ArgumentError

f{ raise 'abc' }
Got an error of type RuntimeError 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-25T22:16:17.447

在考虑更多的同时，我想出了这个：

```
interpreter_block {do_something}

def interpreter_block
  yield
rescue ExceptionOne, ExceptionTwo, ExceptionEtc => exc
  raise exc.exception(exc.message)
end 
```

虽然我想要的还不是很安静，但至少现在后面的痕迹中的额外条目已经变得更好看了一些。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T11:56:55.310

这可能有点邪恶，但我认为您可以简单地从回溯中删除该行；-)

```
COMMON_ERRORS = [ArgumentError, RuntimeError]

def interpreter_block
  yield
rescue *COMMON_ERRORS => err
  err.backtrace.delete_if{ |line| line=~/interpreter_block/ }
  raise err
end 
```

不过，我不确定这是否是个好主意。之后调试解释器会非常有趣；-)

旁注：[Treetop](http://treetop.rubyforge.org/)可能会引起您的兴趣。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-10-04T23:22:14.967

这有点骇人听闻，但就清理回溯而言，这样的事情效果很好：

```
class Interpreter

  def method1
    error_catcher{ puts 1 / 0 }
  end

  def error_catcher
    yield
  rescue => err
    err.set_backtrace(err.backtrace - err.backtrace[1..2])
    raise err
  end

end 
```

主要技巧是这条线`err.set_backtrace(err.backtrace - err.backtrace[1..2])`。没有它，我们得到以下（来自 IRB）：

```
ZeroDivisionError: divided by 0
  from (irb):43:in `/'
  from (irb):43:in `block in method1'
  from (irb):47:in `error_catcher'
  from (irb):43:in `method1'
  from (irb):54
  from /Users/peterwagenet/.ruby_versions/ruby-1.9.1-p129/bin/irb:12:in `<main>' 
```

我们不想要的是第二行和第三行。所以我们删除它们，最终得到：

```
ZeroDivisionError: divided by 0
  from (irb):73:in `/'
  from (irb):73:in `method1'
  from (irb):84
  from /Users/peterwagenet/.ruby_versions/ruby-1.9.1-p129/bin/irb:12:in `<main>' 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T23:13:05.470

如果您在异常中拥有所需的所有信息，并且根本不需要回溯，则可以定义自己的错误并引发它，而不是重新引发现有的异常。这将给它一个新的回溯。（当然，可能您的示例代码不完整，并且在救援块中发生了其他处理 - 否则您最好的选择是让错误自然冒泡。）

```
class MyError < StandardError; end

def interpreter_block
  yield
rescue ExceptionOne, ExceptionTwo, ExceptionEtc => exc
  raise MyError
end 
```

# java - 从集合中选择随机子集的最佳方法？

> ID：136474
> 
> 赞同：70
> 
> 时间：2008-09-25T22:02:59.600
> 
> 标签：java, algorithm, collections, random, subset

我在 Vector 中有一组对象，我想从中选择一个随机子集（例如 100 个返回的项目；随机选择 5 个）。在我的第一个（非常仓促的）传球中，我做了一个非常简单且可能过于聪明的解决方案：

```
Vector itemsVector = getItems();

Collections.shuffle(itemsVector);
itemsVector.setSize(5); 
```

虽然这具有美观和简单的优点，但我怀疑它不会很好地扩展，即 Collections.shuffle() 必须至少为 O(n)。我不太聪明的选择是

```
Vector itemsVector = getItems();

Random rand = new Random(System.currentTimeMillis()); // would make this static to the class    

List subsetList = new ArrayList(5);
for (int i = 0; i < 5; i++) {
     // be sure to use Vector.remove() or you may get the same item twice
     subsetList.add(itemsVector.remove(rand.nextInt(itemsVector.size())));
} 
```

有关从集合中提取随机子集的更好方法的任何建议？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-25T22:35:59.303

Jon Bentley 在“Programming Pearls”或“More Programming Pearls”中讨论了这一点。您需要小心您的 N of M 选择过程，但我认为显示的代码可以正常工作。与其随机打乱所有项目，不如随机打乱只打乱前 N 个位置 - 当 N << M 时，这是一个有用的节省。

Knuth 还讨论了这些算法——我相信这将是第 3 卷“排序和搜索”，但我的集合已经打包等待搬家，所以我无法正式检查。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-25T22:57:39.093

@乔纳森，

我相信这是您正在谈论的解决方案：

```
void genknuth(int m, int n)
{    for (int i = 0; i < n; i++)
         /* select m of remaining n-i */
         if ((bigrand() % (n-i)) < m) {
             cout << i << "\n";
             m--;
         }
} 
```

它位于 Jon Bentley 的 Programming Pearls 第 127 页，基于 Knuth 的实现。

编辑：我刚刚在第 129 页看到了进一步的修改：

```
void genshuf(int m, int n)
{    int i,j;
     int *x = new int[n];
     for (i = 0; i < n; i++)
         x[i] = i;
     for (i = 0; i < m; i++) {
         j = randint(i, n-1);
         int t = x[i]; x[i] = x[j]; x[j] = t;
     }
     sort(x, x+m);
     for (i = 0; i< m; i++)
         cout << x[i] << "\n";
} 
```

这是基于“......我们只需要随机播放数组的前*m*个元素......”的想法。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-25T23:26:39.493

如果你试图从 n 的列表中选择 k 个不同的元素，你上面给出的方法将是 O(n) 或 O(kn)，因为从 Vector 中删除一个元素会导致 arraycopy 将所有元素向下移动.

由于您要求最好的方法，这取决于您可以使用输入列表做什么。

如果可以接受修改输入列表，如您的示例中所示，那么您可以简单地将 k 个随机元素交换到列表的开头并在 O(k) 时间内返回它们，如下所示：

```
public static <T> List<T> getRandomSubList(List<T> input, int subsetSize)
{
    Random r = new Random();
    int inputSize = input.size();
    for (int i = 0; i < subsetSize; i++)
    {
        int indexToSwap = i + r.nextInt(inputSize - i);
        T temp = input.get(i);
        input.set(i, input.get(indexToSwap));
        input.set(indexToSwap, temp);
    }
    return input.subList(0, subsetSize);
} 
```

如果列表必须以与开始时相同的状态结束，您可以跟踪您交换的位置，然后在复制您选择的子列表后将列表恢复到其原始状态。这仍然是一个 O(k) 解决方案。

但是，如果您根本无法修改输入列表并且 k 远小于 n（例如 100 中的 5），那么最好不要每次都删除选定的元素，而只需选择每个元素，如果你得到重复，扔掉并重新选择。这会给你 O(kn / (nk)) 当 n 支配 k 时仍然接近 O(k)。（例如，如果 k 小于 n / 2，则它减少到 O(k)）。

如果 k 不以 n 为主，并且您无法修改列表，则不妨复制原始列表，并使用您的第一个解决方案，因为 O(n) 将与 O(k) 一样好。

正如其他人所指出的那样，如果您依赖于每个子列表都可能（且无偏见）的强随机性，那么您肯定需要比`java.util.Random`. 见`java.security.SecureRandom`。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-25T23:06:37.107

几周前我写[了一个有效的实现。](http://gregbeech.com/blog/shuffle-and-takerandom-extension-methods-for-ienumerable-t)它在 C# 中，但翻译成 Java 很简单（基本上是相同的代码）。好的一面是它也是完全公正的（一些现有的答案不是） -[一种测试方法在这里](http://gregbeech.com/blog/determining-the-bias-of-a-shuffle-algorithm)。

它基于 Fisher-Yates shuffle 的 Durstenfeld 实现。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-25T22:10:18.630

但是，您使用 Random 选择元素的第二种解决方案似乎很合理：

*   根据您的数据的敏感程度，我建议使用某种散列方法来打乱随机数种子。有关一个好的案例研究，请参阅[我们如何在在线扑克中学会作弊](http://itmanagement.earthweb.com/entdev/article.php/11070_616221_3)（但截至 2015 年 12 月 18 日，此链接为 404）。替代 URL（通过 Google 搜索在双引号中的文章标题上找到）包括：

    *   [我们是如何在在线扑克中学会作弊的](http://www.developer.com/tech/article.php/616221/How-We-Learned-to-Cheat-at-Online-Poker-A-Study-in-Software-Security.htm)——显然是原始出版商。
    *   [我们如何学会在线扑克作弊](http://www.datamation.com/entdev/article.php/616221/How-We-Learned-to-Cheat-at-Online-Poker-A-Study-in-Software-Security.htm)
    *   [我们如何学会在线扑克作弊](https://www.cigital.com/papers/download/developer_gambling.php)

*   矢量是同步的。如果可能，请改用 ArrayList 来提高性能。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T01:26:30.813

[这](https://stackoverflow.com/questions/48087/select-a-random-n-elements-from-listt-in-c#)是关于stackoverflow的一个非常相似的问题。

总结我最喜欢的那个页面的答案（来自用户 Kyle 的第一个）：

*   **O(n) 解决方案**：遍历您的列表，并以概率 (#needed / #remaining) 复制出一个元素（或对其的引用）。示例：如果 k = 5 且 n = 100，那么您采用概率为 5/100 的第一个元素。如果你复制那个，那么你选择下一个概率为 4/99；但如果你没有拿第一个，概率是 5/99。
*   **O(k log k) 或 O(k ² )**：通过随机选择一个 < n 的数字，然后随机选择一个数字，构建 k 个索引（{0, 1, ..., n-1} 中的数字）的排序列表< n-1 等。在每一步，您都需要重新调整您的选择以避免冲突并保持概率均匀。例如，如果 k=5 和 n=100，并且您的第一个选择是 43，那么您的下一个选择在 [0, 98] 范围内，如果它 >=43，那么您将其加 1。所以如果你的第二个选择是 50，那么你加 1，你就有 {43, 51}。如果您的下一个选择是 51，则将其加*2*得到 {43, 51, 53}。

这是一些伪python -

```
# Returns a container s with k distinct random numbers from {0, 1, ..., n-1}
def ChooseRandomSubset(n, k):
  for i in range(k):
    r = UniformRandom(0, n-i)                 # May be 0, must be < n-i
    q = s.FirstIndexSuchThat( s[q] - q > r )  # This is the search.
    s.InsertInOrder(q ? r + q : r + len(s))   # Inserts right before q.
  return s 
```

我是说时间复杂度是 O(k ² )**或**O(k log k)，因为它取决于您搜索 s 并将其插入容器的速度。如果 s 是一个普通列表，那么其中一个操作是线性的，你得到 k^2。但是，如果您愿意将 s 构建为平衡二叉树，则可以节省 O(k log k) 时间。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-25T22:17:25.307

移除费用是多少？因为如果需要将数组重写到新的内存块，那么您在第二个版本中完成了 O(5n) 操作，而不是您之前想要的 O(n)。

您可以创建一个设置为 false 的布尔数组，然后：

```
for (int i = 0; i < 5; i++){
   int r = rand.nextInt(itemsVector.size());
   while (boolArray[r]){
       r = rand.nextInt(itemsVector.size());
   }
   subsetList.add(itemsVector[r]);
   boolArray[r] = true;
} 
```

如果您的子集比您的总大小小很多，则此方法有效。随着这些大小彼此接近（即大小的 1/4 或其他大小），您会在该随机数生成器上遇到更多冲突。在这种情况下，我会制作一个与您的较大数组大小相同的整数列表，然后打乱该整数列表，并从中提取第一个元素以获得您的（非冲突）索引。这样，您在构建整数数组时花费了 O(n)，在 shuffle 中花费了另一个 O(n)，但是没有来自内部 while 检查器的冲突，并且可能花费的成本低于潜在的 O(5n)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-25T22:18:16.053

我个人会选择您的初始实施：非常简洁。性能测试将显示它的可扩展性。我已经以一种被滥用的方法实现了一个非常相似的代码块，并且它的扩展性足够大。特定代码也依赖于包含超过 10,000 个项目的数组。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-25T23:05:15.520

```
Set<Integer> s = new HashSet<Integer>()
// add random indexes to s
while(s.size() < 5)
{
    s.add(rand.nextInt(itemsVector.size()))
}
// iterate over s and put the items in the list
for(Integer i : s)
{
    out.add(itemsVector.get(i));
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-03-03T22:09:43.057

我认为这里不会出现两个解决方案 - 对应的内容很长，并且包含一些链接，但是，我认为并非所有帖子都与从一组 N 个元素中选择 K 元素的子项的问题有关. [“集合”是指数学术语，即所有元素出现一次，顺序不重要]。

溶胶 1：

```
//Assume the set is given as an array:
Object[] set ....;
for(int i=0;i<K; i++){
randomNumber = random() % N;
    print set[randomNumber];
    //swap the chosen element with the last place
    temp = set[randomName];
    set[randomName] = set[N-1];
    set[N-1] = temp;
    //decrease N
    N--;
} 
```

这看起来与丹尼尔给出的答案相似，但实际上却大不相同。它的运行时间为 O(k)。

另一种解决方案是使用一些数学运算：将数组索引视为 Z_n，因此我们可以随机选择 2 个数字，x 与 n 互质，即 chhose gcd(x,n)=1，另一个是 a，即“起点” - 然后是系列： a % n,a+x % n, a+2*x % n,...a+(k-1)*x%n 是不同数字的序列（只要k<=n)。

# sharepoint - SharePoint 的优点和缺点

> ID：136483
> 
> 赞同：6
> 
> 时间：2008-09-25T22:03:48.477
> 
> 标签：sharepoint

我正试图围绕 SharePoint。为什么好？为什么不好？

乍一看，它似乎提供了一些令人难以置信的协作工具。然而，成本看起来是天文数字，而且似乎很僵化且难以定制。

致那些使用过 SharePoint 的人；请描述它的优点和缺点。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-25T23:57:32.400

优点：

*   文档管理是其最著名的功能，并且与 Office 2007 集成得非常好。
*   创建可以覆盖在您的个人 Outlook 上并在 Web 上进行管理的组日历。
*   响应小组网站上某些操作的通知
*   与 Office 堆栈完全集成的 Wiki 类型的功能。
*   完整的数据库后端，为您提供真正 RDBMS 的可靠性和安全性。
*   如果您选择使用 ASP.NET（不是内置的向导/gui 编辑器）开发自定义网站，则可高度自定义。
*   表单数据收集

缺点：

*   免费版在定制方面有些限制。
*   如何处理单个文件的多个编辑器并不明显。
*   离线编辑文档的工作流程并不明显。
*   以正确的方式使用它的学习曲线非常陡峭。
*   让人们使用它就像让人们去看牙医。
*   开箱即用的模板不会做很多事情。
*   在不编写代码的情况下进行自定义确实限制了您的选择。
*   与旧版本的 Office 集成是丑陋的
*   不存在 Mac 集成（最近有变化吗？）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-25T22:17:34.057

它具有很好的 Office 2007 集成。例如，Excel 了解您何时签出文件，并在您关闭文件时让您签入（带有注释）。文档管理具有简单的版本控制（尽管不是必需的；您可以为每个文件使用一个版本）。

在 SharePoint 中，所有内容本质上都是内部列表，创建自定义列表非常容易。在相关的说明中，我还没有使用过任何一个，但它应该可以很好地与工作流和 InfoPath 一起使用。

不利的一面是，它几乎是一种资源野兽。它需要多台具有强大规格的机器，特别是如果您想“真正”将其用于文档管理并成为您的 Intranet/Internet 站点的骨干。它在一定程度上可以扩展，但从我的角度来看它并不漂亮。

定制它提出了它自己的挑战。你真的需要人们全职专注于它，因为管理和定制都需要他们自己令人印象深刻的学习曲线。

最后，一些开箱即用的部分实施得很差。wiki 就是一个很好的例子。在我看来，它基本上没用。所以要记住的一件事是，有些人可能将 SharePoint 作为一个整体包视为“同类最佳”（不是说我愿意！），它的个别功能通常不是。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T22:47:00.353

**开箱** 即用，它提供了大量的功能和强大功能，即使对于库存 Web 部件也是如此。只需创建一个任何人都可以打开/编辑/上传的文档库很简单……即使对于我们当中那些不精通网络的人也是如此。

**差** 的几乎所有其他东西。

*   “讨论板”是一个美化的 Outlook 电子邮件链。
*   在 SharePoint Designer 2007 中实现类似结果与使用 Web 界面之间的脱节令人不快且烦人
*   尝试自定义 SharePoint 网站的外观和感觉通常会以彻底的灾难告终。尤其是 WSS 3.0。
*   WSS 3.0 和 MOSS 2007 层之间的镍和调光方案绝对是痛苦的；WSS 3.0 只是勉强能用起来非常令人沮丧
*   更改 MS 样式几乎是不可能的，因为它们的布局非常糟糕且 CSS 文件大得令人讨厌。
*   **现在是 2009 年......已经摆脱了非表格数据的表格！**

这是一个野兽使用。为公司两个完全不同的领域处理两个完整的品牌重塑项目让我精神崩溃。特别是在打开 core.css 文件时，偶尔会导致我重新定义的所有样式都重置为默认值。除了打开文件之外，我没有做任何事情。并且无法撤消这些更改。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-25T22:20:59.340

好东西：很棒的沟通工具。您可以将公告发布到您的 SharePoint 网站，而不是发送公司范围的电子邮件。用户可以订阅公告的 RSS 提要，或者在列表更新时向他们发送电子邮件警报。

坏事：SharePoint 网站上显示的错误消息是通用的，帮助解决问题的链接很少有任何帮助。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-28T06:33:55.117

好的：

它可以是一个很棒的协作工具。假设您熟悉 ASP.NET webparts，开始为 sharepoint 进行开发很简单。

坏的：

开发生命周期没有完全实现。除其他外，没有用于测试的内置设施。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-06T16:54:03.990

SharePoint 正在发展并成为 Microsoft Office 环境中更好的协作工具。它在中小型企业环境中表现良好。在设置中实施“最佳实践”**至关重要；**否则它将很快成为维护和使用的噩梦。

对于“最佳实践”，我为 SharePoint 2007 推荐了两本书：

*   [基本 SharePoint 2007](http://books.google.com/books?id=UnwBAmgvQ3oC)

*   [共享点 2007](http://books.google.com/books?id=bQcfCKQKn18C)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-25T22:23:19.083

Sharepoint 中的许多很酷的东西都可以在 Windows Sharepoint Services 3.0 中获得，Windows Server 2003/2008 是免费的。您只需要一个 SQL Server 2000 及更高版本的许可证，大多数 mirosoft 商店都有。在 WSS 中，您可以进行文档管理、工作流、自定义站点、博客、wiki 等。

如果您需要 Excel Services、Forms Server、CMS 或其他一些 MOSS 功能，那就另当别论了。是的，它确实要花很多钱，但在大多数情况下，它比从头开始更便宜。

加号：
- 伟大的对象模型。- 很多好的功能都是开箱即用的。

缺点： - 陡峭的学习曲线以正确的方式做事。- 做错事很容易上吊。- 调试和部署就像根管一样令人愉快。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-28T10:03:59.590

好的 ：

可以做很多事情。Wokflowks、InfoPath 表单、Excel Services、业务数据目录等。

坏的 ：

您将无法轻松完成这些描述。必须具备共享点管理和开发技能，才能获得不会快速改进的良好解决方案。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-03T18:27:26.860

如果您有 Microsoft Server 2003 的许可证，那么您可以免费安装 Sharepoint 的独立版本！ [下载共享点](http://www.microsoft.com/downloads/details.aspx?FamilyId=D51730B5-48FC-4CA2-B454-8DC2CAF93951&displaylang=en)

使用内部数据库时，安装非常简单。

Microsoft Office Sharepoint Designer 2007 是任何自定义的必备软件。

我使用 Sharepoint 创建了几个公司内部网，并且对它的功能非常满意。Microsoft Office 2007 与 sharepoint 很好地交互。

我发现 Sharepoint 非常强大且易于学习。有很多人使用 sharepoint 开发网站。定制水平很棒。最简单的自定义是在您的浏览器中完成的，下一个级别是使用 Microsoft Sharepoint Designer 2007，最后使用 Visual Studio 创建新的应用程序（webparts）。

# javascript - Copy&paste from Office 2007 into </h1> <div id="body"><p>I want to copy and paste text from a Office 2007 document (docx) into a textarea. On Window, using Firefox 3, there is additional jiberish that gets put into the fie

> ID：136485
> 
> 赞同：2
> 
> 时间：2008-09-25T22:05:23.790
> 
> 标签：javascript, html, ms-office

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T01:45:25.240

与林肯的想法类似，您可以使用[PureText](http://www.stevemiller.net/puretext/)来自动化该过程。基本上，您按下它的热键而不是`Ctrl`+ `V`（我的设置为`Win`+ `V`），它会粘贴剪贴板上任何内容的纯文本版本。我不确定这是否会删除 Office 添加的额外数据，但值得一试。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-09-25T22:21:55.250

我发现消除这种随机乱码的最简单方法是复制所需的文本，将其粘贴到记事本或类似的纯文本编辑器中，从记事本复制，然后将其粘贴到字段中。

此外，通过删除“智能”引号和 em/en 破折号的脚本或应用程序运行它也不是一个坏主意。

# .net - XSLT 有 Split() 函数吗？

> ID：136500
> 
> 赞同：43
> 
> 时间：2008-09-25T22:07:52.943
> 
> 标签：.net, xml, vb.net, xslt, split

我在节点中有一个字符串，我想将字符串拆分为“？” 并返回数组中的最后一项。

例如，在下面的块中：

```
<a>
    <xsl:attribute name="href">
        /newpage.aspx?<xsl:value-of select="someNode"/>
    </xsl:attribute>
    Link text
</a> 
```

我想拆分`someNode`价值。

编辑：这是我用来为我的 Asp.Net 页面加载 Xsl 的 VB.Net：

```
Dim xslDocPath As String = HttpContext.Current.Server.MapPath("~/App_Data/someXslt.xsl")
Dim myXsltSettings As New XsltSettings()
Dim myXMLResolver As New XmlUrlResolver()

myXsltSettings.EnableScript = True
myXsltSettings.EnableDocumentFunction = True

myXslDoc = New XslCompiledTransform(False)
myXslDoc.Load(xslDocPath, myXsltSettings, myXMLResolver)

Dim myStringBuilder As New StringBuilder()
Dim myXmlWriter As XmlWriter = Nothing

Dim myXmlWriterSettings As New XmlWriterSettings()
myXmlWriterSettings.ConformanceLevel = ConformanceLevel.Auto
myXmlWriterSettings.Indent = True
myXmlWriterSettings.OmitXmlDeclaration = True

myXmlWriter = XmlWriter.Create(myStringBuilder, myXmlWriterSettings)

myXslDoc.Transform(xmlDoc, argumentList, myXmlWriter)

Return myStringBuilder.ToString() 
```

**更新：**这是[在特定节点上拆分 XML 的示例](http://gist.github.com/360186)

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2008-09-26T18:04:00.030

使用递归方法：

```
<xsl:template name="output-tokens">
    <xsl:param name="list" /> 
    <xsl:variable name="newlist" select="concat(normalize-space($list), ' ')" /> 
    <xsl:variable name="first" select="substring-before($newlist, ' ')" /> 
    <xsl:variable name="remaining" select="substring-after($newlist, ' ')" /> 
    <id>
        <xsl:value-of select="$first" /> 
    </id>
    <xsl:if test="$remaining">
        <xsl:call-template name="output-tokens">
            <xsl:with-param name="list" select="$remaining" /> 
        </xsl:call-template>
    </xsl:if>
</xsl:template> 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-25T22:14:35.080

如果您可以使用 XSLT 2.0 或更高版本，您可以使用`tokenize(string, separator)`：

```
tokenize("XPath is fun", "\s+")
Result: ("XPath", "is", "fun") 
```

请参阅[w3schools XPath 函数参考](http://www.w3schools.com/xpath/xpath_functions.asp)。

默认情况下，.NET 不支持 XSLT 2.0，更不用说 XSLT 3.0。唯一已知的 .NET 2.0+ 处理器是带有[IKVM的](http://www.ikvm.net/)[Saxon for .NET](http://saxonica.com)、[Exselt](http://exselt.net)、一个当前处于测试阶段的 .NET XSLT 3.0 处理器和[XMLPrime](http://xmlprime.com) XSLT 2.0 处理器。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-25T23:24:49.530

我最终使用了该[`substring-after()`](http://msdn.microsoft.com/en-gb/library/ms256455(VS.80).aspx)功能。这对我有用：

```
<a>
    <xsl:attribute name="href">
        /newpage.aspx?<xsl:value-of select="substring-after(someNode, '?')"/>
    </xsl:attribute>
    Link text
</a> 
```

即使将 XSLT 的版本设置为 2.0 后，`'tokenize()' is an unknown XSLT function.`尝试使用`tokenize()`.

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2010-05-19T16:06:49.070

添加另一种可能性，如果您的模板引擎支持[EXSLT](http://www.exslt.org/)，那么您可以使用[tokenize()](http://www.exslt.org/str/functions/tokenize/index.html)。

例如：

```
<xsl:stylesheet version="1.0"
                xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                xmlns:str="http://exslt.org/strings"
                extension-element-prefixes="str">

...
  <a>
    <xsl:attribute name="href">
      <xsl:text>/newpage.aspx?</xsl:text>
      <xsl:value-of select="str:tokenize(someNode)[2]"/>
    </xsl:attribute>              
  </a>
...
</xsl:stylesheet> 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-26T18:44:02.743

不幸的是，.NET 不支持 XSLT 2.0。我很确定它支持 EXSLT，它有一个[split()](http://www.exslt.org/str/functions/split/str.split.html)函数。Microsoft 有一个关于其 EXSLT 实施 的[旧页面。](http://msdn.microsoft.com/en-us/library/aa468553.aspx)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-05-28T08:18:16.187

`string-before`您可以使用和`string-after`函数编写模板并在其中使用它。我为此写了[一篇博客](http://lavgupta.com/2008/05/xsl-template-to-split-to-string.html)。

最后想出了一个 xslt 模板，它将分隔的字符串拆分为子字符串。我不声称它是最聪明的脚本，但肯定能解决我的问题。

样式表：

```
<?xml version="1.0" encoding="iso-8859-1"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="/">
<xsl:for-each select="Paths/Item">
<xsl:call-template name="SplitText">
<xsl:with-param name="inputString" select="Path"/>
<xsl:with-param name="delimiter" select="Delimiter"/>
</xsl:call-template>
<br/>
</xsl:for-each>
</xsl:template>
<xsl:template name="SplitText">
<xsl:param name="inputString"/>
<xsl:param name="delimiter"/>
<xsl:choose>
<xsl:when test="contains($inputString, $delimiter)">
<xsl:value-of select="substring-before($inputString,$delimiter)"/>
<xsl:text disable-output-escaping = "no"> </xsl:text>
<xsl:call-template name="SplitText">
<xsl:with-param name="inputString" select="substring-after($inputString,$delimiter)"/>
<xsl:with-param name="delimiter" select="$delimiter"/>
</xsl:call-template>
</xsl:when>
<xsl:otherwise>
<xsl:choose>
<xsl:when test="$inputString = ''">
<xsl:text></xsl:text>
</xsl:when>
<xsl:otherwise>
<xsl:value-of select="$inputString"/>
<xsl:text> </xsl:text>
</xsl:otherwise>
</xsl:choose>
</xsl:otherwise>
</xsl:choose>
</xsl:template>
</xsl:stylesheet> 
```

XML 文件（待转换）：

```
<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="textSpliter.xslt"?>
<Paths>
  <Item>
    <Path>C:\ProgramFiles\SomeWierdSoftware</Path>
    <Delimiter>\</Delimiter>
  </Item>
</Paths> 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-25T22:18:09.627

XSLT 1.0 本身没有 split 函数，但您可以通过 substring-before 和 substring-after 函数实现您想要做的事情。

或者，如果您使用的是 Microsoft XSLT 引擎，则可以使用内联 C#。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-26T08:04:59.233

仅作记录，如果您使用 1.0 执行此操作，并且您确实需要拆分/标记，则需要[xslt extensions](http://www.exslt.org/str/functions/tokenize/)。

# regex - 使用正则表达式在文本中搜索 UUID

> ID：136505
> 
> 赞同：306
> 
> 时间：2008-09-25T22:08:27.433
> 
> 标签：regex

我正在使用正则表达式在文本块中搜索 UUID。目前我依赖的假设是所有 UUID 都将遵循 8-4-4-4-12 十六进制数字的模式。

谁能想到这个假设无效并导致我错过一些 UUID 的用例？

* * *

## 回答 #1

> 赞同：585
> 
> 时间：2011-07-10T11:39:56.150

uuid 的正则表达式是：

```
\b[0-9a-f]{8}\b-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-\b[0-9a-f]{12}\b 
```

* * *

## 回答 #2

> 赞同：159
> 
> 时间：2012-10-11T15:32:31.150

@ivelin：UUID 可以有大写字母。所以你要么需要 toLowerCase() 字符串或使用：

`[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}`

本来只是对此发表评论但没有足够的代表:)

* * *

## 回答 #3

> 赞同：137
> 
> 时间：2013-01-04T22:42:44.447

> 第 4 版 UUID 的格式为 xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx，其中 x 是任何十六进制数字，y 是 8、9、A 或 B 之一。例如 f47ac10b-58cc-4372-a567-0e02b2c3d479。

来源：[http ://en.wikipedia.org/wiki/Uuid#Definition](http://en.wikipedia.org/wiki/Uuid#Definition)

因此，这在技术上更正确：

```
/[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-[89aAbB][a-f0-9]{3}-[a-f0-9]{12}/ 
```

* * *

## 回答 #4

> 赞同：119
> 
> 时间：2016-07-04T19:20:40.267

如果您想检查或验证**特定的 UUID 版本**，这里是相应的正则表达式。

> 请注意，**唯一的区别是版本号**，在[UUID 4122 RFC](https://www.ietf.org/rfc/rfc4122.txt)`4.1.3\. Version`章节中进行了说明。

版本号是第三组的第一个字符 : `[VERSION_NUMBER][0-9A-F]{3}`:

*   UUID v1：

    ```
    /^[0-9A-F]{8}-[0-9A-F]{4}-[1][0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i 
    ```

*   UUID v2：

    ```
    /^[0-9A-F]{8}-[0-9A-F]{4}-[2][0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i 
    ```

*   UUID v3：

    ```
    /^[0-9A-F]{8}-[0-9A-F]{4}-[3][0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i 
    ```

*   UUID v4：

    ```
    /^[0-9A-F]{8}-[0-9A-F]{4}-[4][0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i 
    ```

*   UUID v5：

    ```
    /^[0-9A-F]{8}-[0-9A-F]{4}-[5][0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i 
    ```

* * *

## 回答 #5

> 赞同：44
> 
> 时间：2008-09-25T22:27:13.940

我同意根据定义，您的正则表达式不会错过任何 UUID。但是，请注意，如果您特别搜索 Microsoft 的全局唯一标识符 (GUID)，则 GUID 有五种等效的字符串表示形式：

```
"ca761232ed4211cebacd00aa0057b223" 

"CA761232-ED42-11CE-BACD-00AA0057B223" 

"{CA761232-ED42-11CE-BACD-00AA0057B223}" 

"(CA761232-ED42-11CE-BACD-00AA0057B223)" 

"{0xCA761232, 0xED42, 0x11CE, {0xBA, 0xCD, 0x00, 0xAA, 0x00, 0x57, 0xB2, 0x23}}" 
```

* * *

## 回答 #6

> 赞同：41
> 
> 时间：2014-06-24T13:19:39.873

```
/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89AB][0-9a-f]{3}-[0-9a-f]{12}$/i 
```

Gajus 的正则表达式拒绝 UUID V1-3 和 5，即使它们是有效的。

* * *

## 回答 #7

> 赞同：23
> 
> 时间：2010-10-22T16:45:45.577

`[\w]{8}(-[\w]{4}){3}-[\w]{12}`在大多数情况下对我有用。

或者，如果您想非常具体`[\w]{8}-[\w]{4}-[\w]{4}-[\w]{4}-[\w]{12}`。

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2013-02-05T16:21:32.257

在 python re 中，您可以从数字跨越到大写字母。所以..

```
import re
test = "01234ABCDEFGHIJKabcdefghijk01234abcdefghijkABCDEFGHIJK"
re.compile(r'[0-f]+').findall(test) # Bad: matches all uppercase alpha chars
## ['01234ABCDEFGHIJKabcdef', '01234abcdef', 'ABCDEFGHIJK']
re.compile(r'[0-F]+').findall(test) # Partial: does not match lowercase hex chars
## ['01234ABCDEF', '01234', 'ABCDEF']
re.compile(r'[0-F]+', re.I).findall(test) # Good
## ['01234ABCDEF', 'abcdef', '01234abcdef', 'ABCDEF']
re.compile(r'[0-f]+', re.I).findall(test) # Good
## ['01234ABCDEF', 'abcdef', '01234abcdef', 'ABCDEF']
re.compile(r'[0-Fa-f]+').findall(test) # Good (with uppercase-only magic)
## ['01234ABCDEF', 'abcdef', '01234abcdef', 'ABCDEF']
re.compile(r'[0-9a-fA-F]+').findall(test) # Good (with no magic)
## ['01234ABCDEF', 'abcdef', '01234abcdef', 'ABCDEF'] 
```

这使得最简单的 Python UUID 正则表达式：

```
re_uuid = re.compile("[0-F]{8}-([0-F]{4}-){3}[0-F]{12}", re.I) 
```

我将把它作为练习留给读者使用 timeit 来比较它们的性能。

享受。保持它 Pythonic™！

**注意：**这些跨度也将匹配`:;<=>?@'`，因此，如果您怀疑这可能会给您带来误报，请不要走捷径。（感谢 Oliver Aubert 在评论中指出这一点。）

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2008-09-25T22:14:38.417

根据定义，正如您所描述的，UUID 是 32 个十六进制数字，由连字符分成 5 组。你不应该错过任何你的正则表达式。

[http://en.wikipedia.org/wiki/Uuid#Definition](http://en.wikipedia.org/wiki/Uuid#Definition)

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2020-07-13T08:34:59.067

这是工作的正则表达式：[https ://www.regextester.com/99148](https://www.regextester.com/99148)

```
const regex = [0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12} 
```

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2013-04-15T23:09:10.943

所以，我认为 Richard Bronosky 实际上有迄今为止最好的答案，但我认为你可以做一些事情让它更简单（或者至少更简洁）：

```
re_uuid = re.compile(r'[0-9a-f]{8}(?:-[0-9a-f]{4}){3}-[0-9a-f]{12}', re.I) 
```

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2014-04-16T18:23:05.023

C++ 的变体：

```
#include <regex>  // Required include

...

// Source string    
std::wstring srcStr = L"String with GIUD: {4d36e96e-e325-11ce-bfc1-08002be10318} any text";

// Regex and match
std::wsmatch match;
std::wregex rx(L"(\\{[A-F0-9]{8}-[A-F0-9]{4}-[A-F0-9]{4}-[A-F0-9]{4}-[A-F0-9]{12}\\})", std::regex_constants::icase);

// Search
std::regex_search(srcStr, match, rx);

// Result
std::wstring strGUID       = match[1]; 
```

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2016-07-02T17:23:11.300

对于在 OS X 上使用 生成的 UUID `uuidgen`，正则表达式模式是

```
[A-F0-9]{8}-[A-F0-9]{4}-4[A-F0-9]{3}-[89AB][A-F0-9]{3}-[A-F0-9]{12} 
```

验证

```
uuidgen | grep -E "[A-F0-9]{8}-[A-F0-9]{4}-4[A-F0-9]{3}-[89AB][A-F0-9]{3}-[A-F0-9]{12}" 
```

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2016-01-17T17:04:40.767

```
$UUID_RE = join '-', map { "[0-9a-f]{$_}" } 8, 4, 4, 4, 12; 
```

顺便说一句，其中一个位置只允许 4 个仅对 UUIDv4 有效。但是 v4 并不是唯一存在的 UUID 版本。我在实践中也遇到了 v1。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2019-11-13T08:57:41.763

对于 bash：

```
grep -E "[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-[89aAbB][a-f0-9]{3}-[a-f0-9]{12}" 
```

例如：

```
$> echo "f2575e6a-9bce-49e7-ae7c-bff6b555bda4" | grep -E "[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-[89aAbB][a-f0-9]{3}-[a-f0-9]{12}"
f2575e6a-9bce-49e7-ae7c-bff6b555bda4 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2020-04-03T23:57:32.797

如果使用 Posix 正则表达式（`grep -E`、MySQL 等），这可能更容易阅读和记住：

```
[[:xdigit:]]{8}(-[[:xdigit:]]{4}){3}-[[:xdigit:]]{12} 
```

**编辑：** Perl 和 PCRE 风格也支持 Posix 字符类，所以这将适用于它们。对于那些，将 更改`(…)`为非捕获子组`(?:…)`。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2020-12-15T18:55:17.683

想提供我的贡献，因为我的正则表达式涵盖了来自 OP 的所有案例，并在 group 方法上正确分组所有相关数据（您不需要对字符串进行后处理来获取 uuid 的每个部分，这个正则表达式已经为你得到它)

```
([\d\w]{8})-?([\d\w]{4})-?([\d\w]{4})-?([\d\w]{4})-?([\d\w]{12})|[{0x]*([\d\w]{8})[0x, ]{4}([\d\w]{4})[0x, ]{4}([\d\w]{4})[0x, {]{5}([\d\w]{2})[0x, ]{4}([\d\w]{2})[0x, ]{4}([\d\w]{2})[0x, ]{4}([\d\w]{2})[0x, ]{4}([\d\w]{2})[0x, ]{4}([\d\w]{2})[0x, ]{4}([\d\w]{2})[0x, ]{4}([\d\w]{2}) 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2022-02-28T14:26:36.497

官方[uuid 库](https://www.npmjs.com/package/uuid)使用以下正则表达式：

```
/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i 
```

见[参考](https://github.com/uuidjs/uuid/blob/main/src/regex.js)

# java - Java VNC 小程序

> ID：136518
> 
> 赞同：3
> 
> 时间：2008-09-25T22:11:20.080
> 
> 标签：java, applet, vnc

有谁知道可以从网页运行的开源 Java VNC 服务器，因此不需要在服务器端安装，可能基于小程序。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T17:28:36.207

已签名的 Java 小程序（或应用程序）可以使用 Robot 类来获取当前窗口的屏幕截图并将其用于远程控制。它永远不会非常有效，但它可以做到。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T14:46:36.027

不幸的是，Tight VNC 只提供基于小程序的客户端，而不是服务器，而且 GSVNCJ 是封闭源代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T18:22:48.767

公认的答案是错误的——用 Java 构建 VNC 服务器是完全可能的。是的，Java 是沙盒化的，但这并不意味着它不能访问屏幕内容，如果你愿意的话！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T00:57:23.037

结帐[GSVNCJ](http://vncj.com/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-22T17:51:48.283

检查[副驾驶](https://www.copilot.com/)。它不需要安装，可以通过防火墙工作，并且像 vnc 一样工作。我认为他们实际上在幕后使用 VNC。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-09-21T15:12:58.327

[http://vncj.com/default.aspx](http://vncj.com/default.aspx) 一旦你得到它设置你不会知道你是如何生活的没有它。服务器和客户端在指向您的侦听客户端所在的 html 页面中都使用相同的 .jar 文件。

# .net - 使用 .NET 的 Reflection.Emit 生成接口

> ID：136528
> 
> 赞同：7
> 
> 时间：2008-09-25T22:14:17.483
> 
> 标签：.net, reflection.emit

我需要在运行时生成一个具有与现有接口相同的所有成员的新接口，除了我将在某些方法上放置不同的属性（某些属性参数直到运行时才知道）。如何实现？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-30T18:45:56.373

要使用具有属性的接口动态创建程序集：

```
using System.Reflection;
using System.Reflection.Emit;

// Need the output the assembly to a specific directory
string outputdir = "F:\\tmp\\";
string fname = "Hello.World.dll";

// Define the assembly name
AssemblyName bAssemblyName = new AssemblyName();
bAssemblyName.Name = "Hello.World";
bAssemblyName.Version = new system.Version(1,2,3,4);

// Define the new assembly and module
AssemblyBuilder bAssembly = System.AppDomain.CurrentDomain.DefineDynamicAssembly(bAssemblyName, AssemblyBuilderAccess.Save, outputdir);
ModuleBuilder bModule = bAssembly.DefineDynamicModule(fname, true);

TypeBuilder tInterface = bModule.DefineType("IFoo", TypeAttributes.Interface | TypeAttributes.Public);

ConstructorInfo con = typeof(FunAttribute).GetConstructor(new Type[] { typeof(string) });
CustomAttributeBuilder cab = new CustomAttributeBuilder(con, new object[] { "Hello" });
tInterface.SetCustomAttribute(cab);

Type tInt = tInterface.CreateType();

bAssembly.Save(fname); 
```

这将创建以下内容：

```
namespace Hello.World
{
   [Fun("Hello")]
   public interface IFoo
   {}
} 
```

添加方法通过调用 TypeBuilder.DefineMethod 使用 MethodBuilder 类。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-25T22:29:20.957

你的问题不是很具体。如果您用更多信息更新它，我将用更多细节充实这个答案。

以下是所涉及的手动步骤的概述。

1.  使用 DefineDynamicAssembly 创建装配
2.  使用 DefineDynamicModule 创建模块
3.  使用 DefineType 创建类型。确保通过`TypeAttributes.Interface`以使您的类型成为接口。
4.  迭代原始接口中的成员并在新接口中构建类似的方法，并根据需要应用属性。
5.  调用`TypeBuilder.CreateType`以完成构建您的界面。

# .net - 可以使用 SqlCommandBuilder（不使用存储过程）在插入时检索 IDENTITY 列值吗？

> ID：136536
> 
> 赞同：14
> 
> 时间：2008-09-25T22:15:14.157
> 
> 标签：.net, ado.net

仅供参考：我在 dotnet 3.5 SP1 上运行

我试图在执行更新后（使用 SqlDataAdapter 和 SqlCommandBuilder）将标识列的值检索到我的数据集中。执行 SqlDataAdapter.Update(myDataset) 后，我希望能够读取 的自动分配值`myDataset.tables(0).Rows(0)("ID")`，但它是 System.DBNull（尽管插入了行）。

（注意：我不想显式地编写一个新的存储过程来做到这一点！）

一种经常发布的方法[http://forums.asp.net/t/951025.aspx](http://forums.asp.net/t/951025.aspx)像这样修改 SqlDataAdapter.InsertCommand 和 UpdatedRowSource：

```
SqlDataAdapter.InsertCommand.CommandText += "; SELECT MyTableID = SCOPE_IDENTITY()"
InsertCommand.UpdatedRowSource = UpdateRowSource.FirstReturnedRecord 
```

显然，这似乎对过去的许多人有用，但对我不起作用。

另一种技术：[http](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=619031&SiteID=1) ://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=619031&SiteID= 1 对我也不起作用，因为在执行 SqlDataAdapter.Update 后，SqlDataAdapter.InsertCommand.Parameters 集合被重置为原始的（丢失了额外的添加参数）。

有谁知道这个问题的答案？？？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2011-09-30T16:44:41.453

这是我之前遇到的一个问题，错误似乎是当您调用 da.Update(ds); 时 插入命令的参数数组被重置为从您的命令生成器创建的初始列表，它会删除您为身份添加的输出参数。

解决方案是创建一个新的 dataAdapter 并复制命令，然后使用这个新的来执行您的 da.update(ds);

喜欢

```
SqlDataAdapter da = new SqlDataAdapter("select Top 0 " + GetTableSelectList(dt) + 
"FROM " + tableName,_sqlConnectString);
SqlCommandBuilder custCB = new SqlCommandBuilder(da);
custCB.QuotePrefix = "[";
custCB.QuoteSuffix = "]";
da.TableMappings.Add("Table", dt.TableName);

da.UpdateCommand = custCB.GetUpdateCommand();
da.InsertCommand = custCB.GetInsertCommand();
da.DeleteCommand = custCB.GetDeleteCommand();

da.InsertCommand.CommandText = String.Concat(da.InsertCommand.CommandText, 
"; SELECT ",GetTableSelectList(dt)," From ", tableName, 
" where ",pKeyName,"=SCOPE_IDENTITY()");

SqlParameter identParam = new SqlParameter("@Identity", SqlDbType.BigInt, 0, pKeyName);
identParam.Direction = ParameterDirection.Output;
da.InsertCommand.Parameters.Add(identParam);

da.InsertCommand.UpdatedRowSource = UpdateRowSource.FirstReturnedRecord;

//new adaptor for performing the update                     
SqlDataAdapter daAutoNum = new SqlDataAdapter();
daAutoNum.DeleteCommand = da.DeleteCommand;
daAutoNum.InsertCommand = da.InsertCommand;
daAutoNum.UpdateCommand = da.UpdateCommand;

daAutoNum.Update(dt); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T02:48:01.007

可以指示插入命令使用 UpdatedRowSource 属性使用输出参数或第一个返回的记录（或两者）更新插入的记录...

```
InsertCommand.UpdatedRowSource = UpdateRowSource.Both; 
```

如果你想使用存储过程，你就完成了。但是您想使用原始命令（又名命令生成器的输出），它不允许 a) 输出参数或 b) 返回记录。为什么是这样？好吧，a）这就是您的 InsertCommand 的样子...

```
INSERT INTO [SomeTable] ([Name]) VALUES (@Name) 
```

无法在命令中输入输出参数。那么b）呢？不幸的是，DataAdapter 通过调用命令 ExecuteNonQuery 方法来执行插入命令。这不会返回任何记录，因此适配器无法更新插入的记录。

所以你需要要么使用存储过程，要么放弃使用 DataAdapter。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-03-25T09:04:24.320

对我有用的是配置 MissingSchemaAction：

```
SqlCommandBuilder commandBuilder = new SqlCommandBuilder(myDataAdapter);
myDataAdapter.MissingSchemaAction = MissingSchemaAction.AddWithKey; 
```

这使我可以在插入后检索主键（如果它是标识或自动编号）。

祝你好运。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-08-31T10:19:06.460

我在这里找到了适合我的答案：http: [//www.dotnetmonster.com/Uwe/Forum.aspx/dotnet-ado-net/4933/Have-soln-but-need-understanding-return-IDENTITY-issue](http://www.dotnetmonster.com/Uwe/Forum.aspx/dotnet-ado-net/4933/Have-soln-but-need-understanding-return-IDENTITY-issue)

有效的代码（来自网站 - 归因于 Girish）

```
//_dataCommand is an instance of SqlDataAdapter
//connection is an instance of ConnectionProvider which has a property called DBConnection of type SqlConnection
//_dataTable is an instance of DataTable

SqlCommandBuilder bldr = new SqlCommandBuilder(_dataCommand);
SqlCommand cmdInsert = new SqlCommand(bldr.GetInsertCommand().CommandText, connection.DBConnection);
cmdInsert.CommandText += ";Select SCOPE_IDENTITY() as id";

SqlParameter[] aParams = new
SqlParameter[bldr.GetInsertCommand().Parameters.Count];
bldr.GetInsertCommand().Parameters.CopyTo(aParams, 0);
bldr.GetInsertCommand().Parameters.Clear();

for(int i=0 ; i < aParams.Length; i++)
{
 cmdInsert.Parameters.Add(aParams[i]);
}

_dataCommand.InsertCommand = cmdInsert;
_dataCommand.InsertCommand.UpdatedRowSource = UpdateRowSource.FirstReturnedRecord;
_dataCommand.Update(_dataTable); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-01-08T15:47:18.667

实际上，这对我有用：

```
SqlDataAdapter.InsertCommand.CommandText += "; SELECT MyTableID = SCOPE_IDENTITY()" InsertCommand.UpdatedRowSource = UpdateRowSource.OutputParameters; 
```

干杯。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-03-04T07:17:15.140

我有同样的问题。当我克隆由commandbuilder生成的命令时，它刚刚解决了。看起来即使您更改了 insertcommand 的 commandText，它也会不断获取由 Commandbuilder 生成的命令...这是我用来克隆命令的代码...

```
 private static void CloneBuilderCommand(System.Data.Common.DbCommand toClone,System.Data.Common.DbCommand repository)
    {
        repository.CommandText = toClone.CommandText;
        //Copying parameters
        if (toClone.Parameters.Count == 0) return;//No parameters to clone? go away!
        System.Data.Common.DbParameter[] parametersArray= new System.Data.Common.DbParameter[toClone.Parameters.Count];
        toClone.Parameters.CopyTo(parametersArray, 0);
        toClone.Parameters.Clear();//Removing association before link to the repository one
        repository.Parameters.AddRange(parametersArray);            
    } 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-08-24T08:07:19.833

对我来说，问题是代码的放置位置。

在 RowUpdating 事件处理程序中添加代码，如下所示：

```
void dataSet_RowUpdating(object sender, SqlRowUpdatingEventArgs e)
{
    if (e.StatementType == StatementType.Insert)
    {
        e.Command.CommandText += "; SELECT ID = SCOPE_IDENTITY()";
        e.Command.UpdatedRowSource = UpdateRowSource.FirstReturnedRecord;
     }
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-12-07T09:53:12.060

如果您只想 (a) 将一条记录插入表中，(b) 使用 DataSet，并且 (c) 不使用存储过程，那么您可以按照以下步骤操作：

1.  创建您的 dataAdapter，但在 select 语句中添加 WHERE 1=0，这样您就不必下载整个表 - 性能的可选步骤

2.  使用范围标识选择语句和输出参数创建自定义 INSERT 语句。

3.  进行正常处理，填充数据集，添加记录并保存表更新。

4.  现在应该能够直接从参数中提取身份。

例子：

```
 '-- post a new entry and return the column number
    ' get the table stucture
    Dim ds As DataSet = New DataSet()
    Dim da As SqlDataAdapter = New SqlDataAdapter(String.Concat("SELECT * FROM [", fileRegisterSchemaName, "].[", fileRegisterTableName, "] WHERE 1=0"), sqlConnectionString)
    Dim cb As SqlCommandBuilder = New SqlCommandBuilder(da)

    ' since we want the identity column back (FileID), we need to write our own INSERT statement
    da.InsertCommand = New SqlCommand(String.Concat("INSERT INTO [", fileRegisterSchemaName, "].[", fileRegisterTableName, "] (FileName, [User], [Date], [Table]) VALUES (@FileName, @User, @Date, @Table); SELECT @FileID = SCOPE_IDENTITY();"))
    da.InsertCommand.UpdatedRowSource = UpdateRowSource.FirstReturnedRecord
    With da.InsertCommand.Parameters
        .Add("@FileName", SqlDbType.VarChar, 1024, "FileName")
        .Add("@User", SqlDbType.VarChar, 24, "User")
        .Add("@Date", SqlDbType.DateTime, 0, "Date")
        .Add("@Table", SqlDbType.VarChar, 128, "FileName")
        ' allow the @FileID to be returned back to us
        .Add("@FileID", SqlDbType.Int, 0, "FileID")
        .Item("@FileID").Direction = ParameterDirection.Output
    End With

    ' copy the table structure from the server and create a reference to the table(dt)
    da.Fill(ds, fileRegisterTableName)
    Dim dt As DataTable = ds.Tables(fileRegisterTableName)

    ' add a new record
    Dim dr As DataRow = dt.NewRow()
    dr("FileName") = fileName
    dr("User") = String.Concat(Environment.UserDomainName, "\", Environment.UserName)
    dr("Date") = DateTime.Now()
    dr("Table") = targetTableName
    dt.Rows.Add(dr)

    ' save the new record
    da.Update(dt)

    ' return the FileID (Identity)
    Return da.InsertCommand.Parameters("@FileID").Value 
```

但是，做与此相同的事情实在是太啰嗦了……

```
' add the file record
    Dim sqlCmd As SqlCommand = New SqlCommand(String.Concat("INSERT INTO [", fileRegisterSchemaName, "].[", fileRegisterTableName, "] (FileName, [User], [Date], [Table]) VALUES (@FileName, @User, @Date, @Table); SELECT SCOPE_IDENTITY();"), New SqlConnection(sqlConnectionString))
    With sqlCmd.Parameters
        .AddWithValue("@FileName", fileName)
        .AddWithValue("@User", String.Concat(Environment.UserDomainName, "\", Environment.UserName))
        .AddWithValue("@Date", DateTime.Now())
        .AddWithValue("@Table", targetTableName)
    End With
    sqlCmd.Connection.Open()
    Return sqlCmd.ExecuteScalar 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-26T01:54:24.397

如果这些其他方法对您不起作用，那么.Net 提供的工具（SqlDataAdapter）等并没有真正提供关于灵活性的其他很多东西。您通常需要将其提升到一个新的水平并开始手动做一些事情。存储过程将是继续使用 SqlDataAdapter 的一种方式。否则，您需要转移到另一个数据访问工具，因为 .Net 数据库具有限制，因为它们的设计很简单。如果您的模型不符合他们的愿景，您必须在某个点/级别推出自己的代码。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-09-02T06:52:45.243

另一种仅使用命令对象的方法。

```
Dim sb As New StringBuilder
sb.Append(" Insert into ")
sb.Append(tbl)
sb.Append(" ")
sb.Append(cnames)
sb.Append(" values ")
sb.Append(cvals)
sb.Append(";Select SCOPE_IDENTITY() as id") 'add identity selection

Dim sql As String = sb.ToString

Dim cmd As System.Data.Common.DbCommand = connection.CreateCommand
cmd.Connection = connection
cmd.CommandText = sql
cmd.CommandType = CommandType.Text
cmd.UpdatedRowSource = UpdateRowSource.FirstReturnedRecord

'retrieve the new identity value, and update the object
Dim dec as decimal = CType(cmd.ExecuteScalar, Decimal) 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-03-17T20:30:39.243

实际上，它更容易，不需要任何自定义命令。在数据集设计器中创建表适配器时，请在向导的高级选项中指定“刷新数据表”。这样，在您发出 dataadapter.update mydataset 之后，您会发现数据表中的识别列填充了数据库中的新值。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-11-15T16:27:51.957

我的解决方案：

```
SqlDataAdapter da = new SqlDataAdapter("SELECT * FROM Mytable;" , sqlConnection);

SqlCommandBuilder cb = new SqlCommandBuilder(da);

da.DeleteCommand = (SqlCommand)cb.GetDeleteCommand().Clone();
da.UpdateCommand = (SqlCommand)cb.GetUpdateCommand().Clone();

SqlCommand insertCmd = (SqlCommand)cb.GetInsertCommand().Clone();

insertCmd.CommandText += ";SET @Id = SCOPE_IDENTITY();";
insertCmd.Parameters.Add("@Id", SqlDbType.Int, 0, "Id").Direction = ParameterDirection.Output;
da.InsertCommand = insertCmd;
da.InsertCommand.UpdatedRowSource = UpdateRowSource.OutputParameters;

cb.Dispose(); 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-05-26T15:19:22.807

***问题是在使用SqlDataAdapter.Update(DataSet)***方法时未考虑您对**InsertCommand**所做的更改。完美的解决方案是克隆由**CommandBuilder**生成的**InsertCommand**。

 ******```
SqlCommandBuilder cb = new SqlCommandBuilder(da);
cb.ConflictOption = ConflictOption.OverwriteChanges;

da.InsertCommand = cb.GetInsertCommand().Clone();
da.InsertCommand.CommandText += "; SELECT idTable = SCOPE_IDENTITY()";
da.InsertCommand.UpdatedRowSource = UpdateRowSource.FirstReturnedRecord;

da.Update(dt); 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2008-10-01T21:47:25.973

您是否考虑过使用 LINQ？我知道这并不能解决您的实际问题，但是如果您使用的是 .NET 3.5，您真的应该尝试使用 LINQ。事实上，随着 Code First EntityFramework 的出现，我认为您可以轻松地选择 LINQ to SQL 或 EF 作为滚动您自己的 DAL 的相对轻量级的替代方案。

# c# - 确定文件夹是否在 .NET 中共享

> ID：136539
> 
> 赞同：10
> 
> 时间：2008-09-25T22:15:24.610
> 
> 标签：c#, .net, windows

有没有办法通过 .net 框架来确定文件夹是否共享？

Diretory、DirectoryInfo 或 FileAttributes 似乎都没有任何对应的字段。

我忘记提到的一件事是我想检查网络共享。但我会调查 WMI 的东西。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-25T22:43:21.063

您可以使用 WMI Win32_Share 获取所有共享文件夹的列表，并查看您要查找的文件夹是否在它们之间。这是一个可能对您有所帮助的片段：

```
public static List<string> GetSharedFolders()
{

  List<string> sharedFolders = new List<string>();

  // Object to query the WMI Win32_Share API for shared files...

  ManagementObjectSearcher searcher = new ManagementObjectSearcher("select * from win32_share");

  ManagementBaseObject outParams;

  ManagementClass mc = new ManagementClass("Win32_Share"); //for local shares

  foreach (ManagementObject share in searcher.Get()){

  string type = share["Type"].ToString();

  if (type == "0") // 0 = DiskDrive (1 = Print Queue, 2 = Device, 3 = IPH)
  {
    string name = share["Name"].ToString(); //getting share name

    string path = share["Path"].ToString(); //getting share path

    string caption = share["Caption"].ToString(); //getting share description

    sharedFolders.Add(path);
  }

  }

  return sharedFolders;

} 
```

请注意，我从这个[链接](http://bytes.com/forum/thread624242.html)上粗暴地复制粘贴了字节

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-25T22:23:19.443

您可以使用 WMI Win32_Share。看一眼：

[http://www.gamedev.net/community/forums/topic.asp?topic_id=408923](http://www.gamedev.net/community/forums/topic.asp?topic_id=408923)

显示查询、创建和删除共享文件夹的示例。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-25T23:19:01.040

给这只猫换皮的另一种方法是使用 powershell（如果您安装了它）来调用 wmi 调用，包括对 System.Management.Automation 的引用，它很可能位于 \program files\reference assembly\microsoft\windowspowershell

```
private void button1_Click(object sender, EventArgs e)
{
  Runspace rs = RunspaceFactory.CreateRunspace();
  rs.Open();
  Pipeline pl = rs.CreatePipeline();
  pl.Commands.AddScript("get-wmiobject win32_share");

  StringBuilder sb = new StringBuilder();
  Collection<PSObject> list = pl.Invoke();
  rs.Close();
  foreach (PSObject obj in list)
  {
    string name = obj.Properties["Name"].Value as string;
    string path = obj.Properties["Path"].Value as string;
    string desc = obj.Properties["Description"].Value as string;

    sb.AppendLine(string.Format("{0}{1}{2}",name, path, desc));
  }
  // do something with the results...
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T22:18:19.080

尝试使用 WMI 并进行`SELECT * FROM Win32_ShareToDirectory`查询。

# project-management - 作为没有项目管理的开发人员，避免范围蔓延的最佳方法

> ID：136542
> 
> 赞同：14
> 
> 时间：2008-09-25T22:16:22.580
> 
> 标签：project-management, requirements, scope-creep

我是一家金融公司内部小型 IT 部门的开发人员，曾参与过许多中小型项目，这些项目自始至终几乎没有或根本没有项目管理。这似乎总是导致范围蔓延，因此无法满足最后期限，并且不得不牺牲良好的设计/代码来满足用户/经理的短期需求。

作为一名开发人员，我可以做些什么来确保在编写任何代码之前确定用户需求，并考虑到用户/经理的需求和期望，妥善管理任何变更请求。

谢谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-25T22:22:49.037

在这种情况下，范围蔓延几乎是不可避免的，利益相关者没有时间帮助预先进行分析，也没有正式的合同。我建议选择一种允许您不断调整目标和期望的敏捷方法。像[scrum 之](http://en.wikipedia.org/wiki/Scrum_(development))类的东西。较短的周期将帮助利益相关者及早看到结果并调整需求，因为他们更好地理解了问题，并且由于冲刺周期将使您适应这些变化，因此它们将使您免于精神错乱。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-25T22:28:59.773

在开始编码之前，几乎不可能有一个功能齐全的规范。尤其是在小公司。敏捷方法效果更好，但这不应该阻止您完成项目。

你可以做什么 ：

*   尽可能多地就正在做出的决定进行沟通。就连你们都认为你的老板应该这样做。最好通过电子邮件，这样没有人可以声称无知
*   如果需要新功能，请确保每个人都知道这将花费多少时间。不要低估。根据功能的风险，做出有根据的猜测并将数字乘以风险因素。
*   当一个项目接近终点时，列出仍然需要完成的任务，以及时间估计。同样，确保所有相关人员都可以随时看到此列表。

基本上你需要做的是确保每个人都知道你在做什么。这并不一定能使项目本身按时完成，但它可以作为经理的一面镜子，因此他们可以看到他们的决定的后果是什么。

但总而言之，沟通，沟通，沟通，成为一种小项目负责人。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-25T22:20:21.947

如果您在请求附加功能时没有经理可以推迟，您将不得不自己做。我会发布一个发布时间表并为项目的未来阶段添加额外的特性，这样你就不会因为这些额外的特性而迟到整个项目。让人们知道这些附加功能将添加到项目中的时间以及他们何时可以看到它们。

最难的部分是学习如何告诉别人“**不**”，但这是你需要学习的东西。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-25T22:33:47.577

范围蔓延有两种类型。一个源于没有预先得到好的要求。这会导致意外的任务，以便交付预期的内容。如果这是问题所在，那么您可能希望提前花更多时间收集需求并严格记录每个时期的预期内容。一旦你有了这个，你可以创建一些低级别的任务和时间估计。如果有时间超限，那么至少你会提前知道。

第二种类型源于在开发周期中间添加的小功能。这是你必须学习如何说不的地方。你不能总是说不，但你必须选择你的战斗。请记住，这种类型的范围蔓延并不是来自一件大事。它来自很多小事。被一千张剪纸杀死。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-25T22:20:36.453

不要害怕说“不”。当然，礼貌和专业。不要承诺任何你没有马上不可能的事情。不要立即承诺任何你不确定的事情。

此外，不要害怕拿起一本项目管理书籍，阅读并应用它，即使你只是将它应用到自己身上。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-25T22:22:59.037

关键是文档和可见性。我们有一个易于使用的问题跟踪系统，需求创建者使用它来提出他们的功能请求。他们从不气馁这样做，但是在我们为编码它们做出估计之后，会议将花在审查请求上。如果时间有限，现在请求者必须相互竞争编码时间，而不是仅仅期望它完成。作为编码人员，我们可以免受蠕变，因为他们必须讨论它如何相互影响。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-25T22:34:25.670

一旦您和客户对需求感到满意，请使用签名的需求文档锁定它们。之后的任何事情都是需要花费更多钱的变更请求。

如果客户从不想签字，这将不起作用。看看你是否可以在你的合同中设置一些合理的期限，比如“软请求期限”和“硬请求期限”。

显然应该有一些回旋的空间，而且从来没有一种硬性的方法来确定什么应该在事后顺利通过，什么不应该，但是增加一个硬性的最后期限和更多成本的威胁通常会确保大量的 reqs 在某一点上是不可变的，从而保持你的一些理智。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-25T22:52:18.843

不幸的是，您基本上必须自己进行项目管理，并学习一些有关变更管理的知识。您最好拿起一本易于理解的项目管理书籍（不是 PMBOK）并阅读有关变更管理的任何部分。

在我从事的项目中，我们通过以下方式管理变更

1.  起草由利益相关者签署的需求规范
2.  估计构建指定内容所需的工作量
3.  每次请求更改时，估计它将更改多少所需的工作量，解释更改对成本和完成日期的影响
4.  对不包括更改日程的更改说不
5.  签署已接受的变更（包括接受时间表的变更）
6.  记录请求的更改以及批准的更改。

不幸的是，根据我的经验，变革管理从来都不是一件有趣的事情，而且有很多地方可能会出错。我听到的最常见的是对估计精度的不切实际的期望，以及利益相关者的不合理要求（简单地拒绝你已经阐明的更改的含义，或者忽略流程，要求“完成它”）

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-05T14:47:20.597

I have been in the same situation for many years. My experience was a little different however. Originally in my company, I was the lone wolf. The requirements meetings were all led by me. After gathering the requirements, I would build the app, and lo and behold, it wasn't what the users wanted. Rebuild time, with eleven billion changes. What a horrific process. Everyone would get mad about it from, my manager, to me, to the users.

Unfortunately I have found that people that want software, all too often, don't want to put in the time to help you design a solution that will solve the business problems they are looking for a solution to. They will be consistently vague, and not want to commit to anything.

As we grew, we hired some people to be instant project managers, even though they had never managed a software dev project before, and had little to no technical experience. This resulted in getting "concrete" specs that everyone, but me the dev, agreed upon.

Of course the results were nearly as bad as the original situation, but at least we had management buy-in on enforcing the specifications. Unfortunately these concrete specs, were filled with ridiculous, and often truly impossible wants.

After fighting for sanity in the application, it would be built. Nine times out of ten, the users were still upset, because they invariably, along with the project managers, designed stupid solutions, that did not work well for them.

Again, rebuild hell ensued.

We have now come full circle. All of the project managers are gone, and we have had some pretty heavy layoffs, so I am once again responsible for the entire cycle. Fortunately we have learned from our mistakes, and management is still dedicated to doing what is needed to enforce agreements. We also have changed a bit in the way we give the users an app.

We give them small chunks, often, and require them to test them, and sign off that the section is what they want and need. If it isn't, any changes they want get added to the end of the project, and everyone is informed about how it will change the schedule. Petty changes and whims, disappear quickly, when the bottom line is demonstrably affected.

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-25T22:21:03.910

让您收到的每个要求都由经理签署，您可以自己管理项目，但在实施之前让其他人批准更改。然后，您可以使用签字作为拒绝的杠杆。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-25T22:24:51.153

跟踪当前的要求是什么。当客户来询问新功能时，请确保他们知道添加新功能会导致以下情况之一发生：

1.  交货日期将被推迟
2.  需要删除功能要求，以便为新功能腾出空间
3.  或者，无法满足他们的新要求

正如鲍勃金在评论中所说，在专业问题上说“不”并不是一件坏事。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-25T22:28:54.327

阅读有关 Scrum 的书并在您的办公室实施该实践。它有效地扭转了管理局面，使他们优先考虑他们想要完成的事情。我们开发人员经常会收到一个庞大的需求列表和很短的时间线。使用 Scrum，您可以将这些需求分解为任务，确定您可以在特定时间内工作多少小时，然后在该大量时间开始时召开会议，以确定此“冲刺”的优先级。还有更多，但真正的天才，除了管理你的经理之外，它消除了“可爱”的要求，因为优先级往往是应用程序的真正内容。自从我在我的组织中实施它以来，我作为开发人员的生活变得更加愉快。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-26T01:05:43.763

Scope Creep 是关于未经批准的更改。阅读您的问题，您似乎知道答案，您需要要求、变更请求和批准。

如果您有 BA 和 PM 以及所有其他管理中间件，您可以全力以赴地处理需求声明、变更请求表格、变更审查委员会等。但是我猜这不是您想要的。

您可以简单地完成所有这些工作。首先确定项目的发起人是谁。谁启动了它，谁拥有它。这需要是一个批准您项目的预算和日程安排的人。你们双方都需要提出一个类似于以下的流程，你们都可以同意。

接下来在 Excel 中为您的需求寄存器创建一个工作表。列出所有要求。给每个人一个简短的描述，并在必要时留下一个更长的描述栏。还包括有关谁提出了要求、何时以及是否设计了解决方案以及是否交付了解决方案的列。与您的赞助商坐下来并同意这是基线。

现在创建一个变更登记表。这需要一个用于简短描述的列，一个用于较长描述的列，一个日期，一个用于影响的列以及一个用于批准日期和批准者的列。冲击柱是最重要的。每次有人要求更改时，您都需要弄清楚该更改将如何影响您的范围、预算或时间表。一个额外的功能可能会增加 5 天和 5,000 美元。如果您需要在圣诞节前交货，您必须删除要求项目 1、2、3。

一旦你有了你的要求和沟通变更和影响的方法，最困难的部分是你不能在没有得到赞助商批准的情况下实施变更。该批准可以是电子邮件或其他任何形式。但它需要明确地说“我批准第 12 号变更”。如果没有明确的批准步骤，您最好不要打扰。

这大约是您可以摆脱的最少文档/流程。主要目标是确保每个更改的影响都被正确的人充分传达、接受和拒绝。此人不是您，通常也不是提出更改请求的人。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-07T00:12:04.030

不要让每个人都不同意的功能改变或加深。如果您必须选择，请放下其他东西。决定应该自己做出。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2010-10-26T17:15:00.167

您将不得不自己进行一些项目管理。了解敏捷项目管理：

[http://agilesoftwaredevelopment.com/blog/artem/scrum-under-10-minutes-video](http://agilesoftwaredevelopment.com/blog/artem/scrum-under-10-minutes-video)

制定积压工作，而不是对更改或功能说是/否，而是按优先级对其进行排序。使事情变得完美的“好”东西总是可以推迟到以后的版本，并明确说明这就是计划。专注于最低限度，首先获得功能性产品。

# c++ - 优缺点：在条件语句中初始化变量

> ID：136548
> 
> 赞同：18
> 
> 时间：2008-09-25T22:18:08.223
> 
> 标签：c++, coding-style, if-statement

在 C++ 中，您可以在 if 语句中初始化变量，如下所示：

```
if (CThing* pThing = GetThing())
{
} 
```

为什么人们会认为这种不好或好的风格？有什么好处和坏处？

我个人喜欢这种风格，因为它限制了 pThing 变量的范围，所以当它为 NULL 时永远不会被意外使用。但是，我不喜欢你不能这样做：

```
if (CThing* pThing = GetThing() && pThing->IsReallySomeThing())
{
} 
```

如果有办法使上述工作，请张贴。但如果那是不可能的，我仍然想知道为什么。

[从这里借来的问题，类似的主题，但 PHP。](https://stackoverflow.com/questions/136373/initializing-a-variable-in-a-conditional-statment)

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-25T22:52:00.887

重要的是 C++ 中的声明不是表达式。

```
bool a = (CThing* pThing = GetThing()); // not legit!! 
```

您不能在 if 语句中同时执行声明和布尔逻辑，C++ 语言规范特别允许表达式或声明。

```
if(A *a = new A)
{
    // this is legit and a is scoped here
} 
```

我们如何知道表达式中的一个术语和另一个术语之间是否定义了 a？

```
if((A *a = new A) && a->test())
{
    // was a really declared before a->test?
} 
```

咬紧牙关，使用内部 if。范围规则很有用，您的逻辑很明确：

```
if (CThing* pThing = GetThing())
{
    if(pThing->IsReallySomeThing())
    {
    }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-25T22:34:49.523

关于优点：

始终建议在您第一次需要变量时定义变量，而不是之前的一行。这是为了提高代码的可读性，因为无需滚动和搜索定义的位置就可以知道 CThing 是什么。

还将范围缩小到循环/if 块，导致变量在代码块执行后未被引用，这使其成为垃圾收集的候选者（如果语言支持此功能）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-01-20T16:31:07.637

```
if (CThing* pThing = GetThing()) 
```

这是**不好的风格**，因为在里面`if`你没有提供布尔表达式。您正在提供一个`CThing*`.

```
CThing* pThing = GetThing();
if (pThing != NULL) 
```

这是很好的风格。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-25T22:27:09.387

这在 C++ 中~~**应该**~~不起作用，~~因为~~即使它支持[短路评估](http://www.codepedia.com/1/ShortCircuitEval)。 ~~也许~~不要尝试以下操作：

```
if ((CThing* pThing = GetThing()) && (pThing->IsReallySomeThing()))
{
} 
```

错误..见[韦斯利塔尔的回答](https://stackoverflow.com/questions/136548/procon-initializing-a-variable-in-a-conditional-statement-c#136695)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-25T22:33:21.680

我通常不这样做的一个原因是因为在条件测试中错过了“=”的常见错误。我使用带有错误/警告设置的 lint 来捕获这些错误/警告。然后它会对条件句中的所有作业大喊大叫。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-25T22:39:18.017

仅供参考，一些较旧的 Microsoft C++ 编译器（我认为是 Visual Studios 6 和 .NET 2003）在某些情况下并不完全遵循范围规则。

```
for(int i = 0; i > 20; i++) {
     // some code
}

cout << i << endl; 
```

我应该超出范围，但那是/是有效的代码。我相信它是作为一个功能被玩弄的，但在我看来，这只是不合规。不遵守标准是不好的。就像一个关于 IE 和 Firefox 的 web 开发者。

有VS的人可以检查一下这是否仍然有效？

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2018-05-07T20:37:56.780

这么多的事情。首先，裸指针。请务必避免使用它们。使用引用、可选、unique_ptr、shared_ptr。作为最后的手段，编写自己的类来处理指针所有权，而不是别的。

如果您需要 C++11（首选 C++14 以避免 C++11 缺陷），请使用统一初始化： - 它避免了 = vs == 混淆，并且在检查参数时更加严格（如果有的话）。

```
if (CThing thing {})
{
} 
```

确保实现`operator bool`从 CThing 到 bool 的可预测转换。但是，请记住，阅读代码的其他人不会`operator bool`立即看到。显式方法调用通常更具可读性和令人放心。如果您需要 C++17，请使用初始值设定项语法。

```
if (CThing thing {}; thing.is_good())
{
} 
```

如果 C++17 不是一个选项，请按照其他人的建议使用上面的声明。

```
{
  CThing thing {};
  if (thing.is_good())
  {
  }
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-07-30T11:37:42.973

您可以在**C++17**`if`内部和`switch`之后使用初始化语句。

 **您的代码现在是：

```
if (CThing* pThing = GetThing(); pThing->IsReallySomeThing())
{
    // use pThing here
}
// pThing is out of scope here 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-25T22:39:45.317

您还可以将分配包含在一组额外的 ( ) 中以防止出现警告消息。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-25T22:42:40.270

我认为这有点危险。下面的代码更安全，并且括号仍然会以您想要的方式限制 pThing 的范围。

我假设 GetThing() 有时会返回 NULL，这就是为什么我将那个有趣的子句放在 if() 语句中。它可以防止在 NULL 指针上调用 IsReallySomething()。

```
{
    CThing *pThing = GetThing();
    if(pThing ? pThing->IsReallySomeThing() : false)
    {
    // Do whatever
    }
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-25T22:57:07.363

另请注意，如果您正在编写 C++ 代码，您希望编译器在条件语句（不是声明的一部分）中警告“=”成为错误。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-25T23:00:01.507

这是可以接受的良好编码实践。但是，不是来自低级编码背景的人可能会不同意。

# tcl - Timeout doesn't work with '-re' flag in expect script

> ID：136554
> 
> 赞同：0
> 
> 时间：2008-09-25T22:19:24.303
> 
> 标签：tcl, expect

I'm trying to get an expect script to work, and when I use the -re flag (to invoke regular expression parsing), the 'timeout' keyword seems to no longer work. When the following script is run, I get the message 'timed out at step 1', then 'starting step 2' and then it times out but does NOT print the 'timed out at step 2' I just get a new prompt.

Ideas?

```
#!/usr/bin/expect --

spawn $env(SHELL)
match_max 100000

set timeout 2

send "echo This will print timed out\r"
expect  {
    timeout { puts "timed out at step 1"  }
    "foo " { puts "it said foo at step 1"}
}

puts "Starting test two\r"

send "echo This will not print timed out\r"
expect  -re {
    timeout { puts "timed out at step 2" ; exit }
    "foo " { puts "it said foo at step 2"}
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T23:12:45.157

```
Figured it out:

expect  {
    timeout { puts "timed out at step 2" ; exit }
    -re "foo " { puts "it said foo at step 2"}
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-13T16:58:16.493

Yes, the "-re" flag as it appears in your question will apply to every pattern in the expect command. So the "timeout" pattern becomes "-re timeout", losing its specialness.

# java - 如何让标签在 SWT 中继承 Composite 的 GC

> ID：136580
> 
> 赞同：8
> 
> 时间：2008-09-25T22:24:43.323
> 
> 标签：java, user-interface, swt

我正在编写一个应用程序，我们的设计师希望在我们的一些复合材料中使用渐变来处理一些背景。

我写了以下代码：

```
composite.addListener (SWT.Paint, new Listener () {
    public void handleEvent (Event e) {
            GC gc = e.gc;
            Rectangle rect = composite.getClientArea ();
            Color color1 = new Color (display, 0, 0, 0);
            Color color2 = new Color (display, 255, 255, 255);
            gc.setForeground(color1);
            gc.setBackground(color2);
            gc.fillGradientRectangle (rect.x, rect.y, rect.width, rect.height , true);

        }
    }); 
```

这可以在复合材料上精细地绘制渐变，但我们在复合材料的顶部有标签/CLabel、画布和链接。

在这些区域中，背景只是绘制空画布时得到的纯灰色。

我试过强制标签继承背景，如下所示：

```
label.setBackgroundMode(SWT.INHERIT_DEFAULT) //SWT.INHERIT_FORCE Doesn't work either 
```

但这给我留下了相同的默认灰色，并且在 Composite 顶部的组件后面没有渐变。

有什么建议让渐变成为每个元素的背景？

我不反对将渐变绘制到提供图像的 gc 上，然后将背景设置为该图像。但是，该方法根本不起作用，复合或其任何元素。

我也无法根据我的知识单独设置渐变。我们希望整个复合材料是一个均匀流动的梯度。

[[编辑] 我在这里](http://twitpic.com/d5qz)上传了一个例子到 twitpic 。

谢谢，

布赖恩·吉安福卡罗

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-26T10:51:27.320

使用**composite.setBackgroundMode(SWT.INHERIT_DEFAULT)**，但不要直接绘制复合材料 - 绘制图像并将其设置为使用**composition.setBackgroundImage(Image)**的背景图像。除非我错过了一个技巧，否则这意味着您只需在调整合成大小时重新生成图像。

您应该能够按原样剪切'n'粘贴此代码，以了解我的意思：

```
import org.eclipse.swt.SWT;
import org.eclipse.swt.graphics.*;
import org.eclipse.swt.layout.*;
import org.eclipse.swt.widgets.*;

/**
 * SWT composite with transparent label
 * 
 * @author McDowell
 */
public class Sweet {

    private Image imageGradient;
    private Label label;
    private Composite composite;

    private void createComponents(Shell parent) {
        composite = new Composite(parent, SWT.NONE);
        composite.addListener(SWT.Resize, new Listener() {
            public void handleEvent(Event e) {
                changeImage();
            }
        });
        composite.setLayout(new FormLayout());
        composite.setBackgroundMode(SWT.INHERIT_DEFAULT);

        label = new Label(composite, SWT.None);
        label.setText("Hello, World!");
    }

    private void changeImage() {
        Image oldImage = imageGradient;

        Display display = composite.getDisplay();
        Rectangle rect = composite.getClientArea();
        imageGradient = new Image(display, rect.width, rect.height);
        GC gc = new GC(imageGradient);
        try {
            Color color1 = new Color(display, 200, 200, 255);
            try {
                Color color2 = new Color(display, 255, 255, 255);
                try {
                    gc.setForeground(color1);
                    gc.setBackground(color2);
                    gc.fillGradientRectangle(rect.x, rect.y, rect.width,
                            rect.height, true);
                } finally {
                    color2.dispose();
                }
            } finally {
                color1.dispose();
            }
        } finally {
            gc.dispose();
        }
        composite.setBackgroundImage(imageGradient);

        if (oldImage != null) {
            oldImage.dispose();
        }
    }

    private void openShell(Display display) {
        Shell shell = new Shell(display);
        try {
            shell.setSize(200, 100);
            shell.setLayout(new FillLayout());
            createComponents(shell);
            shell.open();
            while (!shell.isDisposed()) {
                if (!display.readAndDispatch()) {
                    display.sleep();
                }
            }
        } finally {
            if (!shell.isDisposed()) {
                shell.dispose();
            }
        }
    }

    public void run() {
        Display display = Display.getDefault();
        try {
            openShell(display);
        } finally {
            display.dispose();
        }
    }

    public void dispose() {
        if (imageGradient != null) {
            imageGradient.dispose();
        }
    }

    public static void main(String[] args) {
        Sweet sweet = new Sweet();
        try {
            sweet.run();
        } finally {
            sweet.dispose();
        }
    }

} 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-09-25T22:44:13.557

我要尝试的第一件事是[从小部件捕获图像](http://dev.eclipse.org/viewcvs/index.cgi/%7Echeckout%7E/org.eclipse.swt.snippets/src/org/eclipse/swt/snippets/Snippet95.java)并将子小部件所在的图像部分直接绘制到子小部件上。

如果这不起作用，请尝试对两个小部件使用相同的绘制侦听器，但在转换 GC 以将坐标转换为标签的坐标空间之后将 GC 的转换设置为：

```
Listener listener = new Listener () {
  public void handleEvent (Event e) {
    GC gc = e.gc;
    Rectangle rect = composite.getClientArea ();
    Point offset = ((Control)e.widget).toControl(composite.toDisplay(0, 0));
    Color color1 = new Color (display, 0, 0, 0);
    Color color2 = new Color (display, 255, 255, 255);
    gc.setForeground(color1);
    gc.setBackground(color2);
    gc.fillGradientRectangle (rect.x + offset.x, rect.y + offset.y,
        rect.width, rect.height , true);
  }
}
composite.addListener (SWT.Paint, listener);
label.addListener(SWT.Paint, listener); 
```

此外，请小心处理您创建的任何 Color 实例，然后再使用它们。否则，您将泄漏系统资源并最终耗尽。

# ajax - 使用 cfdiv 绑定时禁用插页式图形

> ID：136581
> 
> 赞同：4
> 
> 时间：2008-09-25T22:24:45.693
> 
> 标签：ajax, coldfusion

有没有办法在 cfdiv 刷新时不显示“正在加载...”图形？我想防止加载图形然后加载新的html时闪烁。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T16:34:01.650

通过在标题底部添加这些行，它会覆盖“正在加载...” html，并且似乎可以防止 IE 和 FireFox 中的闪烁效果：

```
 <script language="JavaScript"> 
 _cf_loadingtexthtml=""; 
 </script> 
```

虽然这似乎可以解决问题，但如果有官方支持的方法可以在每个页面或每个控件的基础上自定义加载动画，那就太好了。希望他们在 ColdFusion9 中添加对此的支持。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T16:06:56.177

我认为目前没有办法在`cfdiv`标签中以编程方式执行此操作。如果您真的想摆脱“正在加载...”消息和图像，您可以查看几个地方。

您可以重命名或删除图像，该图像位于： **CFIDE\scripts\ajax\resources\cf\images\loading.gif**

那只会摆脱动画。"Loading..." 文本可以空白为空字符串，定义在：**CFIDE\scripts\ajax\messages\cfmessage.js**

进行这些更改显然会对除 之外的标签产生影响`cfdiv`，但是如果您希望在一个地方消除这种行为，我相信您也不会介意在其他任何地方杀死它。:)

如果其他人有任何想法，我很乐意看到一种更清洁的方式来做到这一点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-03-05T12:26:29.223

这绝不是一个全面或优雅的解决方案，但我发现在相邻元素上使用负边距可以“覆盖”动画。我不知道这种方法是否适用于所有情况，但对于我的特殊情况它有效。动画出现在绑定的文本字段旁边，其右侧是一个提交按钮。图层向右浮动。我在提交按钮上使用了负边距，它覆盖了动画而不影响图层对齐。

我做的另一项措施是检查层结构，并确保将以下代码添加到我的 css 中：

```
#TitleNameloadingicon {visibility:hidden;}
#TitleName_cf_button {visibility:hidden;}
#TitleNameautosuggest {background-color:#ffffff;} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-02-15T20:02:18.243

您可以创建函数以在调用 ajax 加载之前更改消息，从而将消息和图像设置为新值。

```
function loadingOrder(){
    _cf_loadingtexthtml="Loading Order Form <image src='/CFIDE/scripts/ajax/resources/cf/images/loading.gif'>"; 
}

function loadingNavigation(){
    _cf_loadingtexthtml="Loading Menu <image src='/CFIDE/scripts/ajax/resources/cf/images/loading_nav.gif'>"; 
} 
```

（这些最终将被整合到一个函数中，该函数将接受一个 text_value 和一个 image_path 参数）

在我的一些同时加载主导航和左导航 cfdiv 的进程中，我使用如下函数：

```
function locateCreateOrder(){
    loadingOrder();
    ColdFusion.navigate('/functional_areas/orders/orders_actions/cf9_act_orders_index.cfm','main_content');
    loadingNavigation();
    ColdFusion.navigate('/functional_areas/products/products_actions/cf9_products_menu.cfm','left_menu');
} 
```

# asp.net - ASP.NET 中的应用程序和缓存有什么区别？

> ID：136598
> 
> 赞同：5
> 
> 时间：2008-09-25T22:29:01.253
> 
> 标签：asp.net, caching

`Application("some-object")`和`Cache("some-object")`ASP.NET有什么区别？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-25T22:31:20.297

应用程序是应用程序范围内的，没有超时（池重新启动时除外）字典。缓存是通用缓存存储的临时存储库。

[这](http://www.eggheadcafe.com/articles/20030405.asp)和[这](http://bytes.com/forum/thread314515.html)可能有助于澄清差异和用法。

[这](http://wiki.asp.net/page.aspx/59/application-and-cache/)是另一个。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-12T09:14:12.283

根据 MS 的说法，应用程序存储只是为了向后兼容经典的 ASP 应用程序而保留，所以使用缓存，因为它更智能且线程安全。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-23T04:59:43.870

应用程序和缓存都是应用程序级别的项目存储，但不同的是，在使用场景中，像缓存更灵活可以做更多像清除一样的事情（从缓存中自动删除不朽的项目），但是另一侧的缓存是易失性的意味着它不是确保数据将在应用程序生命周期中保留。但应用程序更可靠，数据在应用程序运行时保留，但它很简单。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-07-19T09:53:06.607

*   应用程序非常类似于在 Web 应用程序的生命周期内持续存在的静态字典。
*   缓存提供了更多您期望缓存中的功能，例如到期和到期回调。
*   在最常见的使用场景中，项目可以自动从缓存中“消失”。应用程序不会发生这种情况。
*   缓存似乎是[最佳实践](https://stackoverflow.com/questions/326675/httpruntime-cache-vs-application)选项。

# sql-server - 通过一对多自关系复制数据 (Tsql)

> ID：136604
> 
> 赞同：1
> 
> 时间：2008-09-25T22:30:36.507
> 
> 标签：sql-server, tsql

对不起，如果标题描述性不好，但我现在不能做得更好=（

所以，我有这个主细节方案，细节是一个树结构（一对多的自我关系），有 n 个级别（在 SQLServer 2005 上）

我需要使用存储过程将详细结构从一个主机复制到另一个主机，方法是将源主机 ID 和目标主机 ID 作为参数传递（目标是新的，因此它没有详细信息）。

我遇到了麻烦，并寻求您的帮助，以找到一种方法来跟踪父 ID 并在不使用光标或类似讨厌的东西的情况下插入孩子......

![问题的表模型](https://i.stack.imgur.com/hBzdZ.jpg)

当然，这是一个示例模型，我要做的是将详细结构从一个主控复制到另一个主控。事实上，我正在使用现有的作为模板创建一个新的主人。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T00:46:22.967

如果我理解这个问题，这可能是你想要的：

```
INSERT dbo.Master VALUES (@NewMaster_ID, @NewDescription)

INSERT dbo.Detail (parent_id, master_id, [name])
SELECT detail_ID, @NewMaster_ID, [name]
FROM dbo.Detail 
WHERE master_id = @OldMaster_ID

UPDATE NewChild
SET parent_id = NewParent.detail_id
FROM dbo.Detail NewChild
JOIN dbo.Detail OldChild
ON NewChild.parent_id = OldChild.detail_id
JOIN dbo.Detail NewParent
ON NewParent.parent_id = OldChild.parent_ID
WHERE NewChild.master_id = @NewMaster_ID
AND   NewParent.master_id = @NewMaster_ID
AND   OldChild.master_id = @OldMaster_ID 
```

诀窍是在初始插入中使用旧`detail_id`的作为新的。`parent_id`然后使用此关系连接回旧的行集，并更新新`parent_id`值。

我假设这`detail_id`是一个 IDENTITY 值。如果您自己分配它们，则需要提供详细信息，但有一个类似的解决方案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-25T22:45:37.423

您必须为少量样本数据提供创建表和插入语句。以及基于此样本数据的预期结果。

# c# - 给定服务器的 IP 地址和端口，如何使用 C# 测试与服务器的 TCP 连接？

> ID：136615
> 
> 赞同：16
> 
> 时间：2008-09-25T22:32:46.267
> 
> 标签：c#, networking

如何以*编程*方式确定我是否可以使用 C# 访问具有给定 IP 地址和端口的服务器 (TCP)？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-26T01:26:38.940

您可以使用 Ping 类（.NET 2.0 及更高版本）

```
    平 x = 新平（）；
    PingReply 回复 = x.Send(IPAddress.Parse("127.0.0.1"));

    如果（回复.Status == IPStatus.Success）
        Console.WriteLine("地址可访问");

```

您可能希望在生产系统中使用异步方法来允许取消等。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-09-25T22:34:37.263

假设您的意思是通过 TCP 套接字：

```
IPAddress IP;
if(IPAddress.TryParse("127.0.0.1",out IP)){
    Socket s = new Socket(AddressFamily.InterNetwork,
    SocketType.Stream,
    ProtocolType.Tcp);

    try{   
        s.Connect(IPs[0], port);
    }
    catch(Exception ex){
        // something went wrong
    }
} 
```

欲了解更多信息： http: [//msdn.microsoft.com/en-us/library/4xzx2d41.aspx ?ppud=4](http://msdn.microsoft.com/en-us/library/4xzx2d41.aspx?ppud=4)

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-25T22:39:39.043

声明字符串地址和 int 端口，您就可以通过 TcpClient 类进行连接了。

```
System.Net.Sockets.TcpClient client = new TcpClient();
try
{
    client.Connect(address, port);
    Console.WriteLine("Connection open, host active");
} catch (SocketException ex)
{
    Console.WriteLine("Connection could not be established due to: \n" + ex.Message);
}
finally
{
    client.Close();
} 
```

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2008-09-25T22:40:29.387

这应该这样做

```
bool ssl;
ssl = false;
int maxWaitMillisec;
maxWaitMillisec = 20000;
int port = 555;

success = socket.Connect("Your ip address",port,ssl,maxWaitMillisec);

if (success != true) {

    MessageBox.Show(socket.LastErrorText);
    return;
} 
```

# javascript - 如何以编程方式强制输入上的 onchange 事件？

> ID：136617
> 
> 赞同：161
> 
> 时间：2008-09-25T22:32:53.443
> 
> 标签：javascript

如何以编程方式强制输入上的 onchange 事件？

我试过这样的事情：

```
var code = ele.getAttribute('onchange');
eval(code); 
```

但我的最终目标是触发任何侦听器功能，但这似乎不起作用。也不只是更新“值”属性。

* * *

## 回答 #1

> 赞同：214
> 
> 时间：2016-04-15T13:47:25.723

创建一个`Event`对象并将其传递给`dispatchEvent`元素的方法：

```
var element = document.getElementById('just_an_example');
var event = new Event('change');
element.dispatchEvent(event); 
```

这将触发事件侦听器，无论它们是通过调用`addEventListener`方法还是通过设置`onchange`元素的属性来注册的。

* * *

如果您希望事件冒泡，则需要将第二个参数传递给`Event`构造函数：

```
var event = new Event('change', { bubbles: true }); 
```

* * *

有关浏览器兼容性的信息：

*   [调度事件（）](https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/dispatchEvent#Browser_Compatibility)
*   [事件（）](https://developer.mozilla.org/en-US/docs/Web/API/Event/Event#Browser_compatibility)

* * *

## 回答 #2

> 赞同：103
> 
> 时间：2008-12-04T11:51:45.527

在 jQuery 中，我主要使用：

```
$("#element").trigger("change"); 
```

* * *

## 回答 #3

> 赞同：65
> 
> 时间：2008-09-25T22:37:00.643

呃，不要对*任何事情*使用 eval 。嗯，有些东西，但它们非常罕见。相反，你会这样做：

```
document.getElementById("test").onchange() 
```

在这里查看更多选项：http: [//jehiah.cz/archive/firing-javascript-events-properly](http://jehiah.cz/archive/firing-javascript-events-properly)

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2008-09-25T23:18:32.540

出于某种原因，ele.onchange() 在我的页面上的 IE 中为我抛出了“找不到方法”异常，所以我最终使用了[Kolten](https://stackoverflow.com/users/13959/kolten)提供的链接中的这个函数并调用了 fireEvent(ele, 'change')，它起作用了：

```
function fireEvent(element,event){
    if (document.createEventObject){
        // dispatch for IE
        var evt = document.createEventObject();
        return element.fireEvent('on'+event,evt)
    }
    else{
        // dispatch for firefox + others
        var evt = document.createEvent("HTMLEvents");
        evt.initEvent(event, true, true ); // event type,bubbling,cancelable
        return !element.dispatchEvent(evt);
    }
} 
```

然而，我确实创建了一个测试页面，确认调用应该 onchange() 工作：

```
<input id="test1" name="test1" value="Hello" onchange="alert(this.value);"/>
<input type="button" onclick="document.getElementById('test1').onchange();" value="Say Hello"/> 
```

编辑： ele.onchange() 不起作用的原因是因为我实际上没有为 onchange 事件声明任何内容。但是 fireEvent 仍然有效。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-25T23:06:26.250

[取自QUnit](http://dev.jquery.com/view/trunk/qunit/testrunner.js)的底部

```
function triggerEvent( elem, type, event ) {
    if ( $.browser.mozilla || $.browser.opera ) {
        event = document.createEvent("MouseEvents");
        event.initMouseEvent(type, true, true, elem.ownerDocument.defaultView,
            0, 0, 0, 0, 0, false, false, false, false, 0, null);
        elem.dispatchEvent( event );
    } else if ( $.browser.msie ) {
        elem.fireEvent("on"+type);
    }
} 
```

当然，您可以将 $.browser 替换为您自己的浏览器检测方法，使其独立于 jQuery。

要使用此功能：

```
var event;
triggerEvent(ele, "change", event); 
```

这基本上会触发真正的 DOM 事件，就好像某些东西已经真正改变了一样。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2018-10-19T00:44:56.817

这是 IE 和 Chrome 最正确的答案::

```
var element = document.getElementById('xxxx');
var evt = document.createEvent('HTMLEvents');
evt.initEvent('change', false, true);
element.dispatchEvent(evt); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2020-04-17T03:26:35.303

如果您使用这段代码添加所有事件：

```
//put this somewhere in your JavaScript:
HTMLElement.prototype.addEvent = function(event, callback){
  if(!this.events)this.events = {};
  if(!this.events[event]){
    this.events[event] = [];
    var element = this;
    this['on'+event] = function(e){
      var events = element.events[event];
      for(var i=0;i<events.length;i++){
        events[i](e||event);
      }
    }
  }
  this.events[event].push(callback);
}
//use like this:
element.addEvent('change', function(e){...}); 
```

那么你可以只使用`element.on<EVENTNAME>()`where`<EVENTNAME>`是你的事件的名称，这将调用所有事件`<EVENTNAME>`

* * *

## 回答 #8

> 赞同：-5
> 
> 时间：2008-09-25T22:36:35.387

如果您使用的是 jQuery，您将拥有：

```
$('#elementId').change(function() { alert('Do Stuff'); }); 
```

或 MS AJAX：

```
$addHandler($get('elementId'), 'change', function(){ alert('Do Stuff'); }); 
```

或者在元素的原始 HTML 中：

```
<input type="text" onchange="alert('Do Stuff');" id="myElement" /> 
```

重新阅读问题后，我想我错过了要做什么。我从来没有找到一种以强制更改事件的方式更新 DOM 元素的方法，您最好做的是拥有一个单独的事件处理程序方法，如下所示：

```
$addHandler($get('elementId'), 'change', elementChanged);
function elementChanged(){
  alert('Do Stuff!');
}
function editElement(){
  var el = $get('elementId');
  el.value = 'something new';
  elementChanged();
} 
```

由于您已经在编写一个 JavaScript 方法来进行更改，因此只需额外调用 1 行即可。

或者，如果您*使用*的是 Microsoft AJAX 框架，您可以通过以下方式访问所有事件处理程序：

```
$get('elementId')._events 
```

它允许你做一些反射式的工作来找到正确的事件处理程序来触发。

* * *

## 回答 #9

> 赞同：-6
> 
> 时间：2016-04-06T10:07:40.727

使用 JQuery，您可以执行以下操作：

```
// for the element which uses ID
$("#id").trigger("change");

// for the element which uses class name
$(".class_name").trigger("change"); 
```

* * *

## 回答 #10

> 赞同：-7
> 
> 时间：2019-02-27T09:44:14.690

用于触发 Javascript 中的任何事件。

```
 document.getElementById("yourid").addEventListener("change", function({
    //your code here
}) 
```

# model-view-controller - 如何让选择模型与代理模型一起使用？

> ID：136628
> 
> 赞同：8
> 
> 时间：2008-09-25T22:35:42.970
> 
> 标签：model-view-controller, qt, selectionmodel

我有一个模型和两个视图，如下所示：

```
Model ---> OSortFilterProxyModel ---> OListView
Model ------------------------------> OTableView 
```

当用户在其中一个视图中选择某些内容时，我希望另一个视图反映该选择。所以我想我会使用 QSelectionModel 将它们链接在一起。但这不起作用。我有一种感觉，这是因为视图认为它们有两个不同的模型，而实际上它们具有相同的模型。有没有办法让它工作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T23:44:51.353

可能发生的是视图确实有两种不同的模型。一个是您的原始模型，另一个是排序过滤器模型。

我不确定这是否可行，这取决于 Qt 认为“已激活”的内容，但您可以将一个函数连接到每个视图的已激活插槽。这些将传递给您一个模型索引。您必须通过代理模型以适当的方向（mapFromSource 和 mapToSource）发送模型索引。然后，在另一个视图上调用 setCurrentIndex。

激活信号的文档指出，被视为“激活”的内容因平台而异。您可能还可以锁定其他信号，例如选择模型的选择更改信号。您可能需要执行不同的调用来更改用户看到的选择。最后，在派生的 QSelectionModel 中可能甚至更容易做到这一点，只要您记得映射到源模型/从源模型映射。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T20:45:52.863

不太确定您的模型子类是如何实现的 - 但选择取决于持久模型索引是否正确。你能提供一些源代码吗？您是否在两者上使用相同的选择模型？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-09-19T13:32:54.403

您可能需要将[void QItemSelectionModel::select](http://doc.qt.nokia.com/latest/qitemselectionmodel.html#select-2)与[QAbstractProxyModel::mapSelectionFromSource](http://doc.qt.nokia.com/latest/qabstractproxymodel.html#mapSelectionFromSource)和[QAbstractProxyModel::mapSelectionToSource](http://doc.qt.nokia.com/latest/qabstractproxymodel.html#mapSelectionToSource)结合使用。在 QListView 的 selectionChange 信号处理程序中，您应该有

```
tableView->selection()->select(
    proxyModel->mapSelectionToSource(selected),
    QItemSelectionModel::ClearAndSelect); 
```

并与 QTableView 的 signalChange 信号处理程序中的 mapSelectionFromSource 类比。

请注意，我不确定 Qt 是否会阻止无限递归，因为表将更改列表的选择，而列表的选择又会更改表的选择等等...

# asp.net - Web.Config 的 System.Web 部分中的 AllowLocation="true" 有什么作用？

> ID：136635
> 
> 赞同：2
> 
> 时间：2008-09-25T22:36:53.043
> 
> 标签：asp.net, windows, iis, configuration, .net-2.0

我们有一个 .NET 2.0 应用程序，我们通常在 IIS6 上运行，过去在 IIS7 上运行良好，但最近在为 Vista IIS7 安装 SP1 后，Web.Config 文件中的一行似乎卡住了：

```
<system.web AllowLocation="true"> 
```

删除 AllowLocation 属性是否安全？这个属性有什么作用？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-25T23:42:56.210

来自 MSDN：

> 当设置为 false 时，AllowLocation 属性指示该部分由本机代码阅读器访问。因此，不允许使用位置属性，因为本机代码阅读器不支持位置的概念。

默认值为 true，因此您应该能够在不影响您的应用程序的情况下将其删除。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-25T22:45:22.790

将此设置为 true 应该启用`<location>`web.config 中的任何部分，因此如果其中没有任何部分，您应该可以将其删除。

# .net - 如何比较多个 .resx 文件？

> ID：136638
> 
> 赞同：23
> 
> 时间：2008-09-25T22:37:48.690
> 
> 标签：.net, resources, resx

如何比较两个（或更多）大型 .resx 文件的内容？每个文件中有数百个名称/值对，查看组合版本会非常有帮助。我对存在于中性文化中但未在特定文化版本中指定的名称/值对特别感兴趣。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-05-01T16:39:35.543

有一个很棒的免费软件工具可以编辑 resx 文件，您可以在其中一次查看多种语言并清楚地看到缺少或额外的内容 - [Zeta 资源编辑器](http://www.zeta-resource-editor.com/index.html)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-09T18:20:05.327

虽然它本身不是一个差异工具，但[RESX Synchronizer](http://www.screwturn.eu/ResxSync.ashx)可以帮助您。它的主要用途是使用中性语言的新条目更新本地化的 .resx 文件，并删除所有已删除的项目。

可能，通过 /v 命令行开关使用它生成的输出将是您需要的。否则，它确实带有完整的 C# 源代码，因此您可以根据需要对其进行调整。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2016-01-26T20:42:55.423

对于较新版本的 Visual Studio (2010+)，现在有一个名为[ResXManager](https://visualstudiogallery.msdn.microsoft.com/3b64e04c-e8de-4b97-8358-06c73a97cc68)的 Visual Studio 扩展（由[tomengler](http://www.codeplex.com/site/users/view/tomenglert)创建），这非常棒。

它允许您并排查看每种语言的每个资源，并突出显示缺失的资源。（以下示例来自扩展下载页面。）

[![扩展下载页面的示例](https://i.stack.imgur.com/HMRuN.png)](https://i.stack.imgur.com/HMRuN.png)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-09T09:01:06.860

如果匹配的元素在两个文件中出现的顺序不同，那么对 XML 文件使用简单的 diff 可能完全没用。我也一直在寻找特定于 XML 的差异工具，但到目前为止没有成功。

与此同时，我一直在使用的解决方法是：

*   `.resx`在 Visual Studio 中打开文件。
*   选择所有 [ `Ctrl`+ `A`] 并剪切 [ `Ctrl`+ `X`]（对于大文件，这可能需要一段时间 - 请耐心等待）
*   粘贴 [ `Ctrl`+ `V`] 并保存（这将重新创建`.resx`按键排序的文件）

当这两个文件都被重新排序时，正常的差异变得容易得多。您现在可以通过浏览差异来快速找到丢失的键。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-12-25T07:26:25.183

我已经尝试了几个 XML 差异工具。这是摘要（促使我评估它的要求是区分 Visual Studio 生成的`.resx`资源文件，我认为这是微软犯的一个大错误——元素的顺序是随机的，Windows 窗体总是重写 ImageStream如果您只是更改按钮的位置而不对 imageList 执行任何操作）。

1.  XmlDiff
2.  阿拉西斯
3.  [Altova DiffDog](http://en.wikipedia.org/wiki/Altova#Products)
4.  [XML 记事本](http://en.wikipedia.org/wiki/XML_Notepad)
5.  [考试XML](http://www.a7soft.com/examxml.html)
6.  [Liquid XML Studio 2009](http://www.liquid-technologies.com/xml-studio.aspx)（有一个 XML diff 菜单，但只有许可证版本可以使用它。所以我没有机会尝试一下）

首先，不应考虑所有普通的 diff 工具，因为它们对 XML 一无所知，它们将文本文件视为文本行。

1.  XmlDiff 是我尝试的第一个工具。看起来它可以满足我的需要，但是在下载源代码（[Visual Studio 2003](http://en.wikipedia.org/wiki/Microsoft_Visual_Studio#Visual_Studio_.NET_2003)）并用 Visual Studio 2005 编译（自动升级成功）后，我可以顺利编译这个小项目。但是当我比较两个真实`.resx`文件（1295 行）时，它崩溃了。调试代码并没有让我知道发生了什么，因为我没有`xmldiffpatch.dll XmlDiffPatch.View.dll`.

    我没有尝试深入研究这个工具的原因是输出格式或 GUI 设计。它输出一个 HTML 文件，在 Internet Explorer 托管的窗口中突出显示不同之处。对于大型 XML 文件 diff，使用起来并不容易。

2.  XML Notepad 有一个简单的内置 XML diff。根据输出窗口，我认为它在内部使用了 XmlDiff 的组件。并且输出与 XmlDiff 相同。我会卸载它。

3.  Araxis 更像是一个传统的文本比较工具，它还可以比较二进制文件、图像文件、文件夹和 word 文件。*对于除*XML 之外的任何差异任务，我都非常喜欢它，因为它不支持 XML 感知差异选项。

4.  Altova DiffDog 看起来像一个复杂的商业产品，它确实包含一个忽略元素顺序的选项，这对我来说是关键特性。

    但是在使用相同的真实`.resx`文件（1295 行，在我的经验中不是很大）尝试之后，我发现如果两个元素位于两个文件中非常不同的位置，“忽略元素顺序”就无法正常工作.

5.  ExamXML 看起来像一个商业产品，但它是一个小产品。但是在尝试之后，我发现它是目前我所期望的最理想的工具。

还有令人失望的一面：当我按下`F10`导航到下一个差异时，它崩溃了。元素的*忽略顺序*选项效果很好。遗憾的是，忽略元素的自定义没有那么灵活。

```
label1.Size
label1.Location
label1.Width 
```

我想忽略这些名称包含“.Size”或“.Location”或“.Width”的元素的所有差异，但不可能同时定义这样的条件。自定义不支持正则表达式。

无论如何，我将使用 ExamXML（小心地）来比较 XML 文件。

更新 1：几年过去了，现在我使用 VS2017 并且自从我最初回答这个问题以来，winform 没有改变。当工作需要分解给不同的人时，这个问题一次又一次地出现，让我很无聊。

其实我忘记了这个答案，谷歌把我带到了这里。

我开始了一个新的调查会议，并有一些很好的发现： [https](https://www.codeproject.com/Articles/37022/Solving-the-resx-Merge-Problem) : //www.codeproject.com/Articles/37022/Solving-the-resx-Merge-Problem 表明我们可以轻松地按数据对 resx 文件进行排序/@ LINQ 的名称属性。太奇妙了。核心代码只是由几个 LINQ 组成的一条语句。

然后我也发现了ResXResourceManager，这个帖子的另一个回答指出了这个问题，作者回复了上面的代码项目文章并将功能添加到ResXResourceManager，在ResxResourceManager中，你可以配置插件自动排序resx文件when(之前）您将其保存在配置选项卡中。您甚至可以选择排序选项：CurrentCulture、Ordinal 或 IgnoreCase 等。

不幸的是，代码项目解决方案和 ResXResourceManager 解决方案产生了不同的结果，源可用，我发现代码项目解决方案处理“>>” 属性值作为普通文本，因此语义相关的小部件是分开的。这可以通过向 LINQ 添加 TrimStart('>') 轻松解决。

但是，修复此问题后，这两个工具仍然会产生不同的结果。罪魁祸首是默认情况下使用 CurrentCulture 对字符串进行排序的 LINQ，我完全忽略了 resXResourceManager 中的相关排序选项，对于这个问题，我认为最好的排序选项是“Ordinal”。将排序选项添加到代码项目解决方案中，并在 ResXResourceManager 中设置相同的排序选项后，最终它们会产生完全相同的结果！

虽然 resxResourceManager 非常适合集中管理资源并修复 resx 元素顺序问题，但代码项目工具对我来说仍然是无价的，因为它是独立的，因此可以在更广泛的情况下使用；另外，代码非常简洁和优雅。

我会在更新结束时添加另一个注释，我使用乌龟 git，我使用 Araxis 来比较不同的版本，比较两个 resx 文件修订版几乎没有意义，但是，Araxis 支持自定义过滤器来转换输入文件在比较引擎看到它之前。为了比较，Araxis 通过以下命令调用过滤器： sortresx.exe -f C:\Users\ADMINI~1\AppData\Local\Temp\mrg.8032.3.resx C:\Users\ADMINI~1\AppData\Local\ Temp\mrg.8032.2 C:\Users\ADMINI~1\AppData\Local\Temp\mrg.8032.4

-f 表示转发，第一个文件名是输入文件，第二个文件名是过滤器应该写入的输出文件，第三个可以安全地忽略。在对代码项目代码进行一些更改后，我现在可以编译一个过滤程序，在 Araxis 中对其进行配置，并且即使在旧的、混乱的 resx 文件上也可以进行合理的 resx 修订比较。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-15T22:24:18.190

您可以使用 XML Diff 编写代码。请参阅*[在应用程序中使用 XML 差异和补丁工具](http://msdn.microsoft.com/en-us/library/aa302294.aspx)*。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-09-25T22:41:21.660

您可以使用 TortoiseSVN 的 diff 之类的工具（如果您使用的是 Windows）。只需选择两个文件，右键单击，然后从 TortoiseSVN 子菜单中选择“diff”。

# php - PHP正则表达式删除多个？-标记

> ID：136642
> 
> 赞同：5
> 
> 时间：2008-09-25T22:38:42.947
> 
> 标签：php, regex, escaping

我无法想出正确的正则表达式字符串来删除多个 ? 人物。我想替换多个顺序？用一个？，但是要逃避哪些角色……正在逃避我。

示例输入：

> 有这玩意？？？要不然是啥？？？

期望的输出：

> 有这玩意吗？要不然是啥？

我在 PHP 中使用[preg_replace() 。](http://php.net/preg_replace)

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-25T22:41:36.247

```
preg_replace('{\?+}', '?', 'Is this thing on??? or what???'); 
```

也就是说，您只需要转义问号，“\?+”中的加号表示我们正在用一个或多个字符替换每个实例，尽管我怀疑“\?{2,}”可能会更好，并且更高效（用两个或更多问号字符替换每个实例。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-25T22:41:57.493

`preg_replace( '{\\?+}', '?', $text );`

应该这样做。

您需要用反斜杠转义问号本身，然后用另一个反斜杠转义反斜杠本身。

在这种情况下，C# 的[逐字字符串](http://msdn.microsoft.com/en-us/library/aa691090(VS.71).aspx)很好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T22:42:11.533

这应该有效（我已经测试过了）：

```
preg_replace('/\?+/', '?', $subject); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-25T22:43:21.547

```
preg_replace('/\?{2,}/','?',$text) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-25T22:47:43.533

这应该这样做

```
preg_replace('/(\?+)/m', '?', 'what is going in here????'); 
```

问号需要转义，m 用于多行模式。

这是一个很好的网站，可以在[http://regex.larsolavtorvik.com/上试用](http://regex.larsolavtorvik.com/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-25T22:53:16.017

你试过模式吗

```
[?]+ 
```

更换`?`?

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-25T23:40:28.650

```
str_replace('??', '?', 'Replace ??? in this text'); 
```

# .net - 以编程方式记录到 Sharepoint ULS

> ID：136672
> 
> 赞同：6
> 
> 时间：2008-09-25T22:45:00.793
> 
> 标签：.net, sharepoint, sharepoint-2007

我想在我的 Sharepoint Web 部件中记录内容，但我希望它进入 ULS。我发现的大多数示例都记录到事件日志或其他文件中，但我还没有真正找到用于登录 ULS 的示例。

令人讨厌的是，Microsoft.SharePoint.Diagnostics 类都标记为内部。我确实找到[了一个](http://www.codeplex.com/SharePointOfView/SourceControl/FileView.aspx?itemId=244213&changeSetId=13835)如何通过反射来使用它们的示例，但这看起来非常冒险且不稳定，因为微软可能会使用他们想要的任何修补程序来更改该类。

Sharepoint 文档也没有真正的帮助 - 关于 ULS 是什么以及如何配置它的大量管理员信息，但我还没有找到支持代码的示例来实际记录我自己的事件。

任何提示或提示？

**编辑：**正如您从这个问题的年龄所看到的那样，这是针对 SharePoint 2007 的。在 SharePoint 2010 中，您可以使用 SPDiagnosticsService.Local ，然后使用[WriteTrace](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.administration.spdiagnosticsservicebase.writetrace.aspx)。请参阅下面 Jürgen 的答案。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-26T04:52:10.910

是的，这是可能的，请参阅此 MSDN 文章： http: [//msdn2.microsoft.com/hi-in/library/aa979595 (en-us).aspx](http://msdn2.microsoft.com/hi-in/library/aa979595(en-us).aspx)

这是 C# 中的一些示例代码：

```
using System;
using System.Runtime.InteropServices;
using Microsoft.SharePoint.Administration;

namespace ManagedTraceProvider
{
class Program
{
    static void Main(string[] args)
    {
        TraceProvider.RegisterTraceProvider();

        TraceProvider.WriteTrace(0, TraceProvider.TraceSeverity.High, Guid.Empty, "MyExeName", "Product Name", "Category Name", "Sample Message");
        TraceProvider.WriteTrace(TraceProvider.TagFromString("abcd"), TraceProvider.TraceSeverity.Monitorable, Guid.NewGuid(), "MyExeName", "Product Name", "Category Name", "Sample Message");

        TraceProvider.UnregisterTraceProvider();
    }
}

static class TraceProvider
{
    static UInt64 hTraceLog;
    static UInt64 hTraceReg;

    static class NativeMethods
    {
        internal const int TRACE_VERSION_CURRENT = 1;
        internal const int ERROR_SUCCESS = 0;
        internal const int ERROR_INVALID_PARAMETER = 87;
        internal const int WNODE_FLAG_TRACED_GUID = 0x00020000;

        internal enum TraceFlags
        {
            TRACE_FLAG_START = 1,
            TRACE_FLAG_END = 2,
            TRACE_FLAG_MIDDLE = 3,
            TRACE_FLAG_ID_AS_ASCII = 4
        }

        // Copied from Win32 APIs
        [StructLayout(LayoutKind.Sequential)]
        internal struct EVENT_TRACE_HEADER_CLASS
        {
            internal byte Type;
            internal byte Level;
            internal ushort Version;
        }

        // Copied from Win32 APIs
        [StructLayout(LayoutKind.Sequential)]
        internal struct EVENT_TRACE_HEADER
        {
            internal ushort Size;
            internal ushort FieldTypeFlags;
            internal EVENT_TRACE_HEADER_CLASS Class;
            internal uint ThreadId;
            internal uint ProcessId;
            internal Int64 TimeStamp;
            internal Guid Guid;
            internal uint ClientContext;
            internal uint Flags;
        }

        [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Unicode)]
        internal struct ULSTraceHeader
        {
            internal ushort Size;
            internal uint dwVersion;
            internal uint Id;
            internal Guid correlationID;
            internal TraceFlags dwFlags;
            [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 32)]
            internal string wzExeName;
            [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 32)]
            internal string wzProduct;
            [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 32)]
            internal string wzCategory;
            [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 800)]
            internal string wzMessage;
        }

        [StructLayout(LayoutKind.Sequential)]
        internal struct ULSTrace
        {
            internal EVENT_TRACE_HEADER Header;
            internal ULSTraceHeader ULSHeader;
        }

        // Copied from Win32 APIs
        internal enum WMIDPREQUESTCODE
        {
            WMI_GET_ALL_DATA = 0,
            WMI_GET_SINGLE_INSTANCE = 1,
            WMI_SET_SINGLE_INSTANCE = 2,
            WMI_SET_SINGLE_ITEM = 3,
            WMI_ENABLE_EVENTS = 4,
            WMI_DISABLE_EVENTS = 5,
            WMI_ENABLE_COLLECTION = 6,
            WMI_DISABLE_COLLECTION = 7,
            WMI_REGINFO = 8,
            WMI_EXECUTE_METHOD = 9
        }

        // Copied from Win32 APIs
        internal unsafe delegate uint EtwProc(NativeMethods.WMIDPREQUESTCODE requestCode, IntPtr requestContext, uint* bufferSize, IntPtr buffer);

        // Copied from Win32 APIs
        [DllImport("advapi32.dll", CharSet = CharSet.Unicode)]
        internal static extern unsafe uint RegisterTraceGuids([In] EtwProc cbFunc, [In] void* context, [In] ref Guid controlGuid, [In] uint guidCount, IntPtr guidReg, [In] string mofImagePath, [In] string mofResourceName, out ulong regHandle);

        // Copied from Win32 APIs
        [DllImport("advapi32.dll", CharSet = CharSet.Unicode)]
        internal static extern uint UnregisterTraceGuids([In]ulong regHandle);

        // Copied from Win32 APIs
        [DllImport("advapi32.dll", CharSet = CharSet.Unicode)]
        internal static extern UInt64 GetTraceLoggerHandle([In]IntPtr Buffer);

        // Copied from Win32 APIs
        [DllImport("advapi32.dll", SetLastError = true)]
        internal static extern uint TraceEvent([In]UInt64 traceHandle, [In]ref ULSTrace evnt);
    }

    public enum TraceSeverity
    {
        Unassigned = 0,
        CriticalEvent = 1,
        WarningEvent = 2,
        InformationEvent = 3,
        Exception = 4,
        Assert = 7,
        Unexpected = 10,
        Monitorable = 15,
        High = 20,
        Medium = 50,
        Verbose = 100,
    }

    public static void WriteTrace(uint tag, TraceSeverity level, Guid correlationGuid, string exeName, string productName, string categoryName, string message)
    {
        const ushort sizeOfWCHAR = 2;
        NativeMethods.ULSTrace ulsTrace = new NativeMethods.ULSTrace();

        // Pretty standard code needed to make things work
        ulsTrace.Header.Size = (ushort)Marshal.SizeOf(typeof(NativeMethods.ULSTrace));
        ulsTrace.Header.Flags = NativeMethods.WNODE_FLAG_TRACED_GUID;
        ulsTrace.ULSHeader.dwVersion = NativeMethods.TRACE_VERSION_CURRENT;
        ulsTrace.ULSHeader.dwFlags = NativeMethods.TraceFlags.TRACE_FLAG_ID_AS_ASCII;
        ulsTrace.ULSHeader.Size = (ushort)Marshal.SizeOf(typeof(NativeMethods.ULSTraceHeader));

        // Variables communicated to SPTrace
        ulsTrace.ULSHeader.Id = tag;
        ulsTrace.Header.Class.Level = (byte)level;
        ulsTrace.ULSHeader.wzExeName = exeName;
        ulsTrace.ULSHeader.wzProduct = productName;
        ulsTrace.ULSHeader.wzCategory = categoryName;
        ulsTrace.ULSHeader.wzMessage = message;
        ulsTrace.ULSHeader.correlationID = correlationGuid;

        // Pptionally, to improve performance by reducing the amount of data copied around,
        // the Size parameters can be reduced by the amount of unused buffer in the Message
        if (message.Length < 800)
        {
            ushort unusedBuffer = (ushort) ((800 - (message.Length + 1)) * sizeOfWCHAR);
            ulsTrace.Header.Size -= unusedBuffer;
            ulsTrace.ULSHeader.Size -= unusedBuffer;
        }

        if (hTraceLog != 0)
            NativeMethods.TraceEvent(hTraceLog, ref ulsTrace);
    }

    public static unsafe void RegisterTraceProvider()
    {
        SPFarm farm = SPFarm.Local;
        Guid traceGuid = farm.TraceSessionGuid;
        uint result = NativeMethods.RegisterTraceGuids(ControlCallback, null, ref traceGuid, 0, IntPtr.Zero, null, null, out hTraceReg);
        System.Diagnostics.Debug.Assert(result == NativeMethods.ERROR_SUCCESS);
    }

    public static void UnregisterTraceProvider()
    {
        uint result = NativeMethods.UnregisterTraceGuids(hTraceReg);
        System.Diagnostics.Debug.Assert(result == NativeMethods.ERROR_SUCCESS);
    }

    public static uint TagFromString(string wzTag)
    {
        System.Diagnostics.Debug.Assert(wzTag.Length == 4);
        return (uint) (wzTag[0] << 24 | wzTag[1] << 16 | wzTag[2] << 8 | wzTag[3]);
    }

    static unsafe uint ControlCallback(NativeMethods.WMIDPREQUESTCODE RequestCode, IntPtr Context, uint* InOutBufferSize, IntPtr Buffer)
    {
        uint Status;
        switch (RequestCode)
        {
            case NativeMethods.WMIDPREQUESTCODE.WMI_ENABLE_EVENTS:
                hTraceLog = NativeMethods.GetTraceLoggerHandle(Buffer);
                Status = NativeMethods.ERROR_SUCCESS;
                break;
            case NativeMethods.WMIDPREQUESTCODE.WMI_DISABLE_EVENTS:
                hTraceLog = 0;
                Status = NativeMethods.ERROR_SUCCESS;
                break;
            default:
                Status = NativeMethods.ERROR_INVALID_PARAMETER;
                break;
        }

        *InOutBufferSize = 0;
        return Status;
    }
} 
```

}

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-06-30T11:10:55.320

功劳归于：http: [//msdn.microsoft.com/en-us/library/gg512103](http://msdn.microsoft.com/en-us/library/gg512103(v=office.14).aspx)
(v=office.14).aspx 我刚刚在我的博客上发表了一篇文章，但在此处粘贴了代码。

在以下行的代码中定义解决方案的名称：

```
private const string PRODUCT_NAME = "My Custom Solution"; 
```

以下是有关如何使用它的示例代码：

```
UlsLogging.LogInformation("This is information message");
UlsLogging.LogInformation("{0}This is information message","Information:");  

UlsLogging.LogWarning("This is warning message");
UlsLogging.LogWarning("{0}This is warning message", "Warning:");  

UlsLogging.LogError("This is error message");
UlsLogging.LogError("{0}This is error message","Error:"); 
```

以下是代码：

```
using System;
using System.Collections.Generic;
using Microsoft.SharePoint.Administration;
namespace MyLoggingApp
{
    public class UlsLogging : SPDiagnosticsServiceBase
    {
        // Product name
        private const string PRODUCT_NAME = "My Custom Solution";

        #region private variables

        // Current instance
        private static UlsLogging _current;

        // area
        private static SPDiagnosticsArea _area;

        // category
        private static SPDiagnosticsCategory _catError;
        private static SPDiagnosticsCategory _catWarning;
        private static SPDiagnosticsCategory _catLogging;

        #endregion

        private static class CategoryName
        {
            public const string Error = "Error";
            public const string Warning = "Warning";
            public const string Logging = "Logging";
        }

        private static UlsLogging Current
        {
            get
            {
                if (_current == null)
                {
                    _current = new UlsLogging();
                }
                return _current;
            }
        }

        // Get Area
        private static SPDiagnosticsArea Area
        {
            get
            {
                if (_area == null)
                {
                    _area = UlsLogging.Current.Areas[PRODUCT_NAME];
                }
                return _area;
            }
        }

        // Get error category
        private static SPDiagnosticsCategory CategoryError
        {
            get
            {
                if (_catError == null)
                {
                    _catError = Area.Categories[CategoryName.Error];
                }
                return _catError;
            }
        }

        // Get warning category
        private static SPDiagnosticsCategory CategoryWarning
        {
            get
            {
                if (_catWarning == null)
                {
                    _catWarning = Area.Categories[CategoryName.Warning];
                }
                return _catWarning;
            }
        }

        // Get logging category
        private static SPDiagnosticsCategory CategoryLogging
        {
            get
            {
                if (_catLogging == null)
                {
                    _catLogging = Area.Categories[CategoryName.Logging];
                }
                return _catLogging;
            }
        }

        private UlsLogging()
            : base(PRODUCT_NAME, SPFarm.Local)
        {
        }

        protected override IEnumerable<SPDiagnosticsArea> ProvideAreas()
        {
            var cat = new List<SPDiagnosticsCategory>{
                new SPDiagnosticsCategory(CategoryName.Error, TraceSeverity.High,EventSeverity.Error),
                new SPDiagnosticsCategory(CategoryName.Warning, TraceSeverity.Medium,EventSeverity.Warning),
                new SPDiagnosticsCategory(CategoryName.Logging,TraceSeverity.Verbose,EventSeverity.Information)
            };
            var areas = new List<SPDiagnosticsArea>();
            areas.Add(new SPDiagnosticsArea(PRODUCT_NAME, cat));

            return areas;
        }

        // Log Error
        public static void LogError(string msg)
        {
            UlsLogging.Current.WriteTrace(0, CategoryError, TraceSeverity.High, msg);
        }
        public static void LogError(string msg,params object[] args)
        {
            UlsLogging.Current.WriteTrace(0, CategoryError, TraceSeverity.High, msg,args);
        }

        // Log Warning
        public static void LogWarning(string msg)
        {
            UlsLogging.Current.WriteTrace(0, CategoryWarning, TraceSeverity.Medium, msg);
        }
        public static void LogWarning(string msg, params object[] args)
        {
            UlsLogging.Current.WriteTrace(0, CategoryWarning, TraceSeverity.Medium, msg,args);
        }

        // Log Information
        public static void LogInformation(string msg)
        {
            UlsLogging.Current.WriteTrace(0, CategoryLogging, TraceSeverity.Verbose, msg); 
        }
        public static void LogInformation(string msg,params object[] args)
        {
            UlsLogging.Current.WriteTrace(0, CategoryLogging, TraceSeverity.Verbose, msg,args);
        }

    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-06-17T15:36:02.340

在这里您可以找到另一篇关于使用 SharePoint 进行日志记录的精彩文章：http: [//www.parago.de/2011/01/how-to-implement-a-custom-sharepoint-2010-logging-service-for-uls-and-windows -事件簿/](http://www.parago.de/2011/01/how-to-implement-a-custom-sharepoint-2010-logging-service-for-uls-and-windows-event-log/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-05-12T11:15:24.023

试试下面的代码：（添加此参考：使用 Microsoft.SharePoint.Administration；）

```
try
        {

            SPSecurity.RunWithElevatedPrivileges(delegate()
            {
                SPDiagnosticsService diagSvc = SPDiagnosticsService.Local;
                diagSvc.WriteTrace(123456, new SPDiagnosticsCategory("Category_Name_Here", TraceSeverity.Monitorable, EventSeverity.Error), TraceSeverity.Monitorable, "{0}:{1}", new object[] { "Method_Name", "Error_Message"});
            });
        }
        catch (Exception ex)
        {
        } 
```

现在打开 uls 查看器并按您的类别名称过滤。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-12-28T03:31:35.210

这对我不起作用，并且一直挂断我的 webpart。我让它工作了一秒钟，然后没有。只有当我删除 Trace register/unregister/etc 语句时，它才会起作用。

所以我推荐这篇对我有用的优秀文章：http: [//sharepoint.namics.com/2008/05/logging_in_webparts.html](http://sharepoint.namics.com/2008/05/logging_in_webparts.html)

本质上，您应该使用：

.NET 的通用基础结构库。

我从这里下载了它：http: [//netcommon.sourceforge.net/](http://netcommon.sourceforge.net/)

我使用 gacutil（或控制面板/管理工具/.net 配置工具）将 2.0/release dll 添加到 gac。

我将对我的代码的引用添加到 dll 中（来自下载）。一切编译。

我必须创建一个目录和空日志文件，然后 bam！在第一个 web 部件加载它工作。我尝试了好几个小时来为我的 Web 部件记录日志，这非常有效，而且它是一个很好的标准，比如 log4j。

# c# - 不通过调试器运行关键业务 C# 控制台应用程序的原因？

> ID：136674
> 
> 赞同：5
> 
> 时间：2008-09-25T22:45:16.753
> 
> 标签：c#, debugging

我正在寻找一些可以用来说服同事通过简单地打开 Visual Studio 并以调试模式运行应用程序来运行 24/7 生产应用程序的谈话要点。

运行已编译的控制台应用程序与在调试模式下运行同一个应用程序有什么不同？

您是否曾经在实时环境中使用调试器？（实时：连接到面向客户的数据库的含义）

假设通过调试器运行实时配置总是一个坏主意，我错了吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-25T22:48:40.380

在调试器下运行时，您将受到性能下降的影响（更不用说[Bruce](https://stackoverflow.com/questions/136674/reasons-to-not-run-a-business-critical-c-console-application-via-the-debugger#136699)提到的复杂性问题），并且没有什么可以阻止您在发布模式下编译时获得与在调试器下运行相同的功能 - 您总是可以设置您的程序以[记录未处理的异常](http://www.julmar.com/blog/mark/PermaLink,guid,f733e261-5d39-4ca1-be1a-c422f3cf1f1b.aspx)并[生成核心转储](http://blogs.msdn.com/tess/archive/2008/05/21/debugdiag-1-1-or-windbg-which-one-should-i-use-and-how-do-i-gather-memory-dumps.aspx)，即使在重新启动您的应用程序后，您也可以调试问题。

此外，手动管理需要 24/7 可用性的应用程序听起来完全错误。您应该使用计划任务或某种自动进程重启机制。

退后一步，[这个问题](https://stackoverflow.com/questions/12745/how-do-you-handle-poor-quality-code-from-team-members)可能会为影响你的团队提供一些指导。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-25T23:23:05.353

如果性能足够好，在调试中运行它本身就没有问题。令我感到奇怪的是，您正在以用户身份运行关键业务 24/7 应用程序，甚至可能在工作站上运行。如果您想确保稳健性和可用性，您应该考虑在除应用程序之外没有人使用的专用硬件上运行它。如果您确实在用户机器上运行此程序，则很容易发生意外，例如关闭“错误”的 Visual Studio，或使计算机崩溃等。

在调试中运行应该在测试环境中完成。在我工作/工作的地方，我们通常有三个环境，生产、发布和测试。

**生产**

*   专用硬件
*   访问权限有限，通常只有主要开发人员/技术人员
*   版本控制，来自 SVN/CVS 的某个标记版本
*   运行已升级为生产状态的最新稳定版本

**释放**

*   专用硬件
*   对所有开发人员的完全访问权限
*   版本控制，来自 SVN/CVS 的某个标记版本
*   运行产品的下一个版本，尚未提升到生产状态，但可能会。“金”，如果你喜欢。

**测试**

*   虚拟机或虱子硬件
*   完全访问
*   没有版本控制，可能是下一个、下一个版本，或者只是有人想在“近生产环境”上测试的自定义版本

这样我们就可以轻松地在 Release 中测试新版本，甚至在那里调试它们。在测试环境中，一切皆有可能。如果有人想测试涉及多个盒子（你自己的）的东西，那就更重要了。

通过这种方式，它将保护您免受没有通过专用测试机器进行充分测试的快速黑客攻击，但仍然允许您在紧急情况下释放这些黑客攻击。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-25T22:52:12.883

笼统地说，当您在调试器下运行程序时，您实际上是在运行两个进程——目标和调试器——并将它们紧密地联系在一起。因此，存在意外影响和错误（不在生产​​运行中）的机会。当然，编写调试器的人尽最大努力将这些影响降至最低，但 24/7 全天候运行该场景可能会暴露任何确实存在的问题。

如果您试图追踪特定故障，有时在调试器下运行是最好的解决方案；但即使在那里，通常启用一种或另一种跟踪是一种影响较小但同样有效的解决方案。

调试器也在用尽资源——取决于机器和应用程序，这可能是一个问题。如果您需要使用调试器 24/7 可能出错的更具体的示例，请告诉我。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T02:04:42.530

询问他们是否愿意在 The Daily WTF 上被公开嘲笑。（因为在文章中有足够的细节，这将是合格的。）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-25T22:48:11.847

我不能代表每个人的经验，但对我来说 Visual Studio 崩溃了很多。它不仅使自己崩溃，而且使资源管理器崩溃。附加组件和插件加剧了这种情况。我不确定它是否曾经像操作系统一样经过测试，可以在几天、几天和几天内全天候 24/7 运行。

本质上，您将应用程序的运行置于第二个应用程序的巨大庞然大物的支配下，这听起来比您的应用程序更大更复杂的数量级。您只会收到错误报告，其中大多数将涉及视觉工作室崩溃。

此外，您是否为生产机器的视觉工作室许可证付费？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-25T23:00:17.590

无论性能问题如何，您绝对不希望从调试器手动运行需要 24/7 全天候运行的应用程序。如果你必须说服你的同事，那就找一份新工作。

在我无法在测试环境中准确重现生产数据的情况下，我有时会使用实时调试器（即针对实时客户数据）来调试​​与数据相关的应用程序问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-25T23:49:01.577

简单的答案：您几乎肯定会降低性能（很可能会大大降低）并且您将大大增加您的依赖关系。在一个步骤中，您已将整个 VS 堆栈（包括 IDE 和其他一点点）添加到您的依赖项中。聪明的人尽可能紧密地保持高正常运行时间服务的依赖关系。

如果你想在调试器下运行，那么你应该使用重量更轻的调试器，比如 ntsd，这简直是疯了。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-25T22:48:42.207

我们从不通过调试器运行它。有些编译器选项可能会意外打开/关闭。优化没有打开，在生产中运行它是一个巨大的安全风险。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-25T23:34:34.637

除了调试代码可能具有不同的代码路径 ( `#ifdef, Debug.Assert(), etc`) 之外，它将运行相同的代码。

有点吓人 - 设置断点，设置要执行的下一行代码，交互式异常弹出和在 Visual Studio 下运行不稳定。还有调试器选项允许您在异常发生时始终中断. 如果您没有正确编写代码，即使检查类也会导致副作用......这肯定不是我想要做的正常的 24x7 进程。

从调试器运行的唯一原因是调试应用程序。如果您在生产中定期这样做，那么您的代码和流程需要帮助是一个很大的危险信号。

迄今为止，我从未在生产环境中以交互方式运行调试模式。我们很少切换到调试版本以进行额外的日志记录，但从未在 Visual Studio 打开的情况下坐在那里。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-25T23:56:58.547

我会问他们通过 Visual Studio 运行它有什么好处？

回复中列出了很多缺点。我想不出有什么好处。

# .net - 如何在 mshtml.HTMLDocument (.NET) 中禁用 Javascript

> ID：136682
> 
> 赞同：6
> 
> 时间：2008-09-25T22:47:00.290
> 
> 标签：.net, javascript, html, mshtml

我有这样的代码：

```
Dim Document As New mshtml.HTMLDocument
Dim iDoc As mshtml.IHTMLDocument2 = CType(Document, mshtml.IHTMLDocument2)
iDoc.write(html)
iDoc.close() 
```

但是，当我加载这样的 HTML 时，它会执行其中的所有 Javascript，并从“html”代码中请求某些资源。

我想禁用 javascript 和所有其他弹出窗口（例如证书错误）。

我的目标是使用 mshtml 文档中的 DOM 以可靠的方式从 HTML 中提取一些标签（而不是一堆正则表达式）。

或者是否有另一个 IE/Office DLL，我可以在不考虑 IE 相关弹出窗口或活动脚本的情况下加载 HTML？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-23T09:13:24.667

```
Dim Document As New mshtml.HTMLDocument
Dim iDoc As mshtml.IHTMLDocument2 = CType(Document, mshtml.IHTMLDocument2)
'add this code
iDoc.designMode="On"
iDoc.write(html)iDoc.close() 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T12:46:18.767

如果您已经将 'html' 作为字符串，并且您只想访问它的 DOM 视图，那么为什么要将它“渲染”到浏览器控件呢？

我不熟悉 .Net 技术，但必须有某种 StringToDOM/StringToJSON 类型的东西才能更好地满足您的需求。

同样，如果您在上面使用的 'html' 变量是 URL，则只需使用 wget 或类似方法将标记检索为字符串，并使用适用的工具进行解析。

我会寻找一个 .Net XML/DOM 库并使用它。（再次，我认为这将是语言的一部分，但我不确定）

PS 在快速谷歌后我发现了这个（[来源](http://www.van-steenbeek.net/?q=explorer_domparser_parsefromstring)）。不确定是否会有所帮助，如果您要在 HTMLDocument 中使用它。

```
 if(typeof(DOMParser) == 'undefined') {
      DOMParser = function() {}
      DOMParser.prototype.parseFromString = function(str, contentType) {
      if(typeof(ActiveXObject) != 'undefined') {
        var xmldata = new ActiveXObject('MSXML.DomDocument');
        xmldata.async = false;
        xmldata.loadXML(str);
        return xmldata;
     } else if(typeof(XMLHttpRequest) != 'undefined') {
        var xmldata = new XMLHttpRequest;
        if(!contentType) {
          contentType = 'application/xml';
        }
        xmldata.open('GET', 'data:' + contentType + ';charset=utf-8,' + encodeURIComponent(str), false);
        if(xmldata.overrideMimeType) {
          xmldata.overrideMimeType(contentType);
        }
        xmldata.send(null);
        return xmldata.responseXML;
     }
  }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-11T00:03:25.560

听起来您正在截屏一些资源，然后尝试以编程方式使用生成的 HTML 做一些事情？

如果您提前知道它是有效的 XHTML，则将 XHTML 字符串（实际上是 XML）加载到[XmlDocument](http://msdn.microsoft.com/en-us/library/system.xml.xmldocument.aspx)对象中，并以这种方式使用它。

否则，如果 HTML 可能无效或格式不正确，那么您将需要类似[hpricot](http://code.whytheluckystiff.net/hpricot/)的东西（但那是一个 Ruby 库）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-07T09:37:56.247

如果我没记错的话，MSHTML 会自动继承 IE 的设置。

因此，如果您在 Internet Explorer 中为正在执行代码的用户禁用 javascript，那么 Javascript 也不应该在 MSHTML 中运行。

# java - 我可以在使用 JSF 1.2 和 JSP 2.1 的 ac:forEach 标记上的统一 EL 表达式中使用哈希表吗？

> ID：136696
> 
> 赞同：2
> 
> 时间：2008-09-25T22:52:03.883
> 
> 标签：java, jsp, jsf, jstl

我有一个名为 sportMap 的 Hashtable<Integer, Sport> 和一个来自我的支持 bean 的 sportIds (List<Integer> sportIds) 列表。Sport 对象有一个 List<String> 设备列表。我可以使用统一的 EL 执行以下操作以获取每个运动的设备列表吗？

```
<h:dataTable value="#{bean.sportIds}" var="_sportId" > 
  <c:forEach items="#{bean.sportMap[_sportId].equipmentList}" var="_eqp">
    <h:outputText value="#{_eqp}"></h:outputText>
    <br/>
  </c:forEach>
</h:dataTable> 
```

尝试运行此 JSP 代码时出现以下异常。

```
15:57:59,438 错误 [ExceptionFilter] 异常根本原因
javax.servlet.ServletException：javax.servlet.jsp.JspTagException：
      不知道如何在 <forEach> 中迭代提供的“项目”。
```

这是我的环境的打印

```
服务器：JBossWeb/2.0.1.GA
小服务程序规范：2.5
JSP版本：2.1
JSTL 版本：1.2
Java版本：1.5.0_14

```

注意：以下使用 JSF 标记确实有效。它打印出在 sportIds 列表中指定的每项运动的设备列表。

```
<h:dataTable value="#{bean.sportIds}" var="_sportId" > 
    <h:outputText value="#{bean.sportMap[_sportId].equipmentList}">
    </h:outputText>
</h:dataTable> 
```

我想使用 c:forEach 标签。有谁知道这是否可能？如果没有，有人有建议吗？最后我想要一个堆叠列表而不是由设备列表提供的逗号分隔列表。toString(); （另外，不想覆盖 toString()）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T16:37:01.923

@ [keith30xi.myopenid.com](https://stackoverflow.com/questions/136696/can-i-use-a-hashtable-in-a-unified-el-expression-on-a-cforeach-tag-using-jsf-12#137188)

**在 JSF 1.2 中不是 TRUE**。根据[java.net wiki 常见问题解答](http://wiki.java.net/bin/view/Projects/JavaServerFacesSpecFaq#12coreTags)，它们应该按预期一起工作。

以下是每个常见问题的摘录：

> **JSF 1.1 FAQ**
> 问：JavaServer Faces 标记是否与 JSTL 核心标记、forEach、if、choose 以及何时互操作？
> 
> A. 由于 JSTL 使用的策略与 JavaServer Faces 技术不兼容，forEach 标记不适用于 JavaServer Faces 技术版本 1.0 和 1.1 标记。相反，您可以使用渲染器，例如 dataTable 标记使用的 Table 渲染器，它执行自己的迭代。if、choose 和 when 标记有效，但嵌套在这些标记中的 JavaServer Faces 标记必须具有显式标识符。
> 
> ***这个缺点已在 JSF 1.2 中得到修复。***
> 
> **JSF 1.2 FAQ**
> 问：JavaServer Faces 标记是否与 JSTL 核心标记、forEach、if、choose 以及何时互操作？
> 
> 答：是的。JSP 2.1 的一个新特性，称为 JSP Id Consumer 允许这些标记按预期工作。

有没有人专门为Each使用带有JSTL核心标签的JSF标签？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T14:12:52.490

我曾经遇到过同样的问题，但我找不到使用 dataTable 的解决方案。问题是 var **_sportId**只能由 dataTable 组件读取。

如果您需要在循环中执行循环，则可以在 dataTable 中使用 dataTable：

```
<h:dataTable value="#{bean.sportIds}" var="_sportId" > 
  <h:dataTable value="#{bean.sportMap[_sportId].equipmentList}" var="_eqp">
    <h:outputText value="#{_eqp}"></h:outputText>
  </h:dataTable>
</h:dataTable> 
```

但在这种情况下，您的每个设备列表项都打印在表格行中。这对我来说不是一个很好的解决方案。

我选择使用普通的 html 表而不是 dataTable：

```
<table>
    <c:forEach items="#{bean.sportIds}" var="_sportId">
      <tr>
        <td>
        <c:forEach items="#{bean.sportMap[_sportId].equipmentList" var="_eqp">
            <h:outputText value="#{_eqp} " />
        </c:forEach>
        </td>
      </tr>
    </c:forEach>
</table> 
```

有用。**如果您需要一些特定的 dataTable 功能，如绑定和行映射，您可以使用f:setPropertyActionListener**标记以简单的方式获得它。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-09-26T00:57:36.030

两个问题：

1.  一个 dataTable 只能有以下子元素：header facet、footer facet、column。其他任何事情都不会被正确评估。
2.  JSTL 标记不能与 JSF 组件交织。创建组件树时评估 JSTL 标记。JSF 组件在页面呈现时进行评估。因此，c:forEach 标签只被评估一次——在创建组件树时，这可能在“#{bean.sportIds}”可用之前。

要么使用提供你想要的循环的 JSF 组件库，构建一个执行你想要的循环的组件库，要么重构 bean，以便循环遍历每个运动都有其 id 和设备的运动列表，而不是循环运动 ID。 .

# c++ - 在 C++ 中是否有一个单行程序可以将文件读入字符串？

> ID：136703
> 
> 赞同：8
> 
> 时间：2008-09-25T22:52:42.930
> 
> 标签：c++, file, filesystems

我需要一种快速简便的方法来从标准 C++ 文件中获取字符串。我可以自己编写，但只想知道是否已经有标准的方式，用 C++ 编写。

如果您知道 Cocoa，则相当于：

```
NSString *string = [NSString stringWithContentsOfFile:file]; 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-26T00:31:17.543

我们可以做到，但这是一条很长的路线：

```
#include<fstream>
#include<iostream>
#include<iterator>
#include<string>

using namespace std;

int main()
{
    // The one-liner
    string fileContents(istreambuf_iterator<char>(ifstream("filename.txt")), istreambuf_iterator<char>());

    // Check result
    cout << fileContents;
} 
```

编辑：使用“istreambuf_iterator”而不是“istream_iterator”

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-25T23:00:44.703

几乎可以使用 istream_iterator（3 行！）

```
#include <iostream>
#include <fstream>
#include <iterator>
#include <string>
#include <sstream>

using namespace std;

int main()
{
    ifstream file("filename.txt");
    string fileContents;

    copy(istreambuf_iterator<char>(file),
              istreambuf_iterator<char>(),
              back_inserter(fileContents));
} 
```

已编辑 - 摆脱了中间字符串流，现在直接复制到字符串中，现在使用忽略空格的 istreambuf_iterator（感谢 Martin York 的评论）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-25T22:54:23.267

标准 C++ 库不提供执行此操作的函数。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-25T23:00:11.943

我能做的最好是5行：

```
#include <fstream>
#include <vector>
using namespace std;

ifstream f("filename.txt");
f.seekg(0, ios::end);
vector<char> buffer(f.tellg());
f.seekg(0, ios::beg);
f.read(&buffer[0], buffer.size()); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-25T23:34:59.940

怎么样：

```
#include <fstream>
#include <sstream>
#include <iostream>

using namespace std;

int main( void )
{
  stringstream os(stringstream::out);
  os << ifstream("filename.txt").rdbuf();
  string s(os.str());
  cout << s << endl;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T00:24:08.420

如果您按照以下方式进行操作（但正确地包装好与下面不同），您可以读取文件而不必担心文件中的 0x1A 字节（例如）会缩短文件的读取时间。先前建议的方法将阻塞文件中的 0x1A（例如）。

```
 #include <iostream>
#include <cstdio>
#include <vector>
#include <cstdlib>
using namespace std;

int main() {
    FILE* in = fopen("filename.txt", "rb");
    if (in == NULL) {
        return EXIT_FAILURE;
    }
    if (fseek(in, 0, SEEK_END) != 0) {
        fclose(in);
        return EXIT_FAILURE;
    }
    const long filesize = ftell(in);
    if (filesize == -1) {
        fclose(in);
        return EXIT_FAILURE;
    }
    vector<unsigned char> buffer(filesize);
    if (fseek(in, 0, SEEK_SET) != 0 || fread(&buffer[0], sizeof(buffer[0]), buffer.size(), in) != buffer.size() || ferror(in) != 0) {
        fclose(in);
        return EXIT_FAILURE;
    }
    fclose(in);
} 
```

但是，是的，它不是一个已经实现的 1-liner。

编辑： 0x1A 不是一个很好的例子，因为 ios_base::binary 将涵盖这一点。然而，即使这样，当使用 .read() 一次性读取 png 文件时，C++ 流也经常给我带来麻烦。使用 C 方式效果更好。只是想不起一个很好的例子来说明原因。可能是在循环中以块的形式对二进制文件进行 .read() 处理，而这可能是 C++ 流的问题。所以，无视这个帖子。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-08-30T10:51:11.310

```
std::string temp, file; std::ifstream if(filename); while(getline(if, temp)) file += temp; 
```

这不是一个简短的或单一的语句行，但它是一个行，它真的没那么糟糕。

# .net - 在 .NET 中测试本地 Intranet 中的连接时，我应该使用什么端口号？

> ID：136709
> 
> 赞同：5
> 
> 时间：2008-09-25T22:53:49.807
> 
> 标签：.net, networking, ports

我想测试与本地 Intranet 中机器的连接。我知道IP地址。

我应该使用什么端口号？555？顺便说一句：我正在使用 .NET。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-25T22:59:06.063

您可以使用任何但避免使用“众所周知的”端口号

有关此类端口的更多详细信息，请[点击此处](http://www.webopedia.com/quick_ref/portnumbers.asp)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T02:06:57.377

低于 1024 的端口被认为是特权端口，因此不应使用。

有一些高于 1024 的端口被指定为“知名”端口，因此您可能应该远离它们。查看最终的[IANA](http://www.iana.org/assignments/port-numbers)列表以了解详细信息。

为了完全安全起见，请获取一份 sysinternals 工具 Tcpview 的副本，~~以~~[检查](http://technet.microsoft.com/en-us/sysinternals/bb897437.aspx)您的机器上正在使用哪些端口。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T22:55:32.860

该端口通常没有任何影响，只要它没有被其他东西使用，并且该端口也没有发生网络过滤，我通常选择数千个随机的东西，比如 32581

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T23:04:25.567

任何高于 1024 的都很好。

原因是下面的所有端口都是为特定协议或将来使用而保留的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T23:09:21.517

如果您的目标只是打开到 Windows 机器 (XP/Vista/2003/2008) 的 TCP 连接，而不必建立自己的服务，那么如果您打开连接，您将不会破坏任何东西（并且然后关闭它而不发送消息）到端口 445 (Windows-DS)。

如果您想设置自己的服务器，请遵循关于 1024 以上未使用端口的其他建议。

# customization - SAP R/3标准代码修改的手段？

> ID：136726
> 
> 赞同：4
> 
> 时间：2008-09-25T22:56:42.530
> 
> 标签：customization, abap, sap-r3

我正在尝试确定如何修改已安装系统的 SAP R/3 包代码。任何人都可以为此建议模块/工具吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-20T23:05:53.610

SAP 提供了各种客户插件，以使客户能够修改和适配标准代码：

*   用户出口（事务 SMOD、CMOD 和 SE81）。[本文](https://www.sdn.sap.com/irj/sdn/go/portal/prtroot/docs/library/uuid/208811b0-00b2-2910-c5ac-dd2c7c50c8e8)更详细地介绍了用户存在。

*   BADI（业务插件，事务 SE18）。这是一种扩展标准功能的面向对象（ish）方式。[本文](https://www.sdn.sap.com/irj/sdn/go/portal/prtroot/docs/library/uuid/3001894b-b1fb-2910-77ba-e80b6f2053b7)更详细地介绍了 BADI

*   显式增强点（仅限 Netweaver 7.0 和更高版本，事务 SE80）是 SAP 标准代码中的占位符，程序员可以在其中添加自己的代码。[在此处阅读](http://help.sap.com/saphelp_nw04s/helpdata/en/91/f1e540f8648431e10000000a1550b0/frameset.htm)有关增强点的更多信息。

所有这些选项都要求 SAP 已经预见到需要增强代码并提供增强功能的钩子。如果他们在那里，这是维护 SAP 标准代码而不会使与 SAP 的支持协议失效的好方法。

以下 2 种方式*不需要*SAP 做任何事情：

*   隐式增强点（仅限 Netweaver 7.0 及更高版本，事务 SE80）。与显式增强点的工作方式相同，但存在于*所有*函数、表单、方法、结构等的开头和结尾。菜单路径编辑->增强操作->显示隐式增强点将使这些可见。隐式增强点的美妙之处在于*它仍然受到 SAP 的支持*。

*   程序修复：在 SE80 中，点击更改图标，SAP 将要求提供修复密钥 - 可以通过[http://service.sap.com](http://service.sap.com)向 SAP 请求（通常由基础人员）。提供密钥后，您可以正常编辑代码（如果已打开，则可以使用修改助手）。 *SAP 不支持修复的对象*

编辑：根据 SAP Enterprise 许可协议，截至 2008/2009 年 SAP 仍可能支持已修复对象

将 SAP 标准程序复制到 Z 包并对其进行修改应该是最后的手段，因为您必须为每个补丁和升级手动比较和维护任何此类程序，这会使系统的一般维护变得更加困难。

SAP 提供工具来修补或升级对标准代码的所有上述更改，大多数时候您只需在修补或升级后确认更改即可。

*注意：*您可能需要 OSS 登录才能访问这些文档。如果你不能 SAP 帮助通常是相当不错的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-28T18:03:27.457

我一直是通过 SE80 事务来完成的，在那里我可以浏览现有的非 Z 代码，将其复制到 Z 包中，并在那里进行修改。

# html - 为什么 a 的边距不会与相邻的 ? 根据我对 CSS 规范的理解，段落上方或下方的表格应该折叠垂直边距。然而，这并没有发生在这里： 问问题 raldi 问问题 2008-09-25T22:56:50.813 3491 次 This question shows research effort; it is useful and clear 12 This question does not show any research effort; it is unclear or not useful Bookmark this question. Show activity on this post. 根据我对 CSS 规范的理解，段落上方或下方的表格应该折叠垂直边距。然而，这并没有发生在这里： table { margin: 100px; border: solid red 2px; } p { margin: 100px } <table> <tr> <td> This is a one-celled table with 100px margin all around. </td> </tr> </table> <p>This is a paragraph with 100px margin all around.</p> 我以为两个元素之间会有 100 像素，但有 200 像素——边距没有塌陷。 为什么不？ 编辑：这似乎是表格的错：如果我复制表格并复制段落，这两个段落将折叠边距。这两张桌子不会。而且，如上所述，表格不会与段落一起折叠边距。这是合规行为吗？ table { margin: 100px; border: solid red 2px; } <table> <tr> <td> This is a one-celled table with 100px margin all around. </td> </tr> </table> <table> <tr> <td> This is a one-celled table with 100px margin all around. </td> </tr> </table> p { margin: 100px } <p>This is a paragraph with 100px margin all around.</p> <p>This is a paragraph with 100px margin all around.</p> 我认为这取决于 CSS 的不同浏览器实现。我刚刚试过你的代码，Firefox3 不会折叠垂直边距，但 IE7 和 Safari3.1.2 会。 htmlcss 4 4 回答 4 This answer is useful 9 边距折叠仅针对块元素定义。试试看 - 添加display: block到表格样式中，突然它起作用了（并改变了表格的显示......） 桌子很特别。在 CSS 规范中，它们并不完全是块元素——特殊规则适用于它们的子元素（显然）和table元素本身的大小和位置。 相关规格： http://www.w3.org/TR/CSS21/box.html#collapsing-margins http://www.w3.org/TR/CSS21/visuren.html#block-box 于 2008-09-25T23:19:08.170 回答 This answer is useful 3 我认为这取决于 CSS 的不同浏览器实现。我刚刚试过你的代码，Firefox3 不会折叠垂直边距，但 IE7 和 Safari3.1.2 会。 于 2008-09-25T23:08:01.237 回答 This answer is useful 2 我最初认为 Firefox 3 不尊重CSS 规范的这一部分： 'display' 属性的几个值使元素成为块级：'block'、'list-item' 和 'run-in'（部分时间；参见 run-in 框）和 'table'。 我这么说是因为规范说明了以下关于折叠边距的内容...... 正常流程中两个或多个相邻的块框垂直边距折叠。 ...并将表格的样式设置为display: block使边距按照您的预期折叠并将其设置回以display: table再次撤消折叠。 但是再看一遍，规范也这样说（强调我的）： 块级元素（除了 display 'table' 元素，将在后面的章节中描述）生成一个主体块框......主体块框参与块格式化上下文。 然后，在块格式化上下文部分： 块格式化上下文中相邻块框之间的垂直边距折叠。 阅读这让我认为表格（不参与块格式化上下文）和段落（参与）之间的边距不应该折叠是正确的。 于 2008-09-25T23:30:39.030 回答 This answer is useful -1 我的理解是，垂直边距仅在表格和标题 [1] 之间折叠。否则，表格应该表现得像任何其他块元素 [2]（即 2 个元素，它们之间的边距均为 100px = 200px）。 http://www.w3.org/TR/CSS2/tables.html#q5 http://www.w3.org/TR/CSS2/box.html 于 2008-09-25T23:16:18.753 回答 Related 2 php - 无需mysqldump即可将大型数据库导出到文件，内存占用低 3 javascript - 在特定的 div 类中删除 2 android - 我的应用程序启动时如何获得规律性 3 c++ - 如何在多个构造函数中删除重复检查 3 javascript - 使用 setInterval 延迟循环的代码 1 gwt - GWT：外形依赖编辑器 3 javascript - Javascript 文本字段验证 1 ms-access - 访问查询：显示第一条记录 1 scala - scala中的while循环 1 python - mongoengine中的参考字段 Reference php × 1429865 c/c++ × 756500 nginx × 49975 mongodb × 159057 mybatis × 3233 anaconda × 13410 pycharm × 14671 python × 1902243 vscode × 56040 docker × 110988 github × 49000 flask × 49129 ffmpeg × 24037 jmeter × 16910 matplotlib × 63493 bootstrap × 54641

> ID：136727
> 
> 赞同：12
> 
> 时间：
> 
> 标签：html, css

根据我对 CSS 规范的理解，段落上方或下方的表格应该折叠垂直边距。然而，这并没有发生在这里：

```
table {
  margin: 100px;
  border: solid red 2px;
}
p {
  margin: 100px
}
```

```
<table>
  <tr>
    <td>
      This is a one-celled table with 100px margin all around.
    </td>
  </tr>
</table>

<p>This is a paragraph with 100px margin all around.</p>
```

我以为两个元素之间会有 100 像素，但有 200 像素——边距没有塌陷。

为什么不？

**编辑：**这似乎是表格的错：如果我复制表格并复制段落，这两个段落将折叠边距。这两张桌子不会。而且，如上所述，表格不会与段落一起折叠边距。这是合规行为吗？

```
table {
  margin: 100px;
  border: solid red 2px;
}
```

```
<table>
  <tr>
    <td>
      This is a one-celled table with 100px margin all around.
    </td>
  </tr>
</table>
<table>
  <tr>
    <td>
      This is a one-celled table with 100px margin all around.
    </td>
  </tr>
</table>
```

```
p {
  margin: 100px
}
```

```
<p>This is a paragraph with 100px margin all around.</p>
<p>This is a paragraph with 100px margin all around.</p>
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-25T23:19:08.170

边距折叠仅针对块元素定义。试试看 - 添加`display: block`到表格样式中，突然它起作用了（并改变了表格的显示......）

桌子很特别。在 CSS 规范中，它们并不*完全*是块元素——特殊规则适用于它们的子元素（显然）和`table`元素本身的大小和位置。

### 相关规格：

[http://www.w3.org/TR/CSS21/box.html#collapsing-margins](http://www.w3.org/TR/CSS21/box.html#collapsing-margins)
[http://www.w3.org/TR/CSS21/visuren.html#block-box](http://www.w3.org/TR/CSS21/visuren.html#block-box)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-25T23:08:01.237

我认为这取决于 CSS 的不同浏览器实现。我刚刚试过你的代码，Firefox3 不会折叠垂直边距，但 IE7 和 Safari3.1.2 会。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-25T23:30:39.030

我最初认为 Firefox 3 不尊重[CSS 规范的这一部分](http://www.w3.org/TR/CSS21/visuren.html#block-boxes)：

> 'display' 属性的几个值使元素成为块级：'block'、'list-item' 和 'run-in'（部分时间；参见 run-in 框）和 'table'。

我这么说是因为规范说明了以下关于[折叠边距](http://www.w3.org/TR/CSS21/box.html#collapsing-margins)的内容......

> 正常流程中两个或多个相邻的块框垂直边距折叠。

...并将表格的样式设置为`display: block`使边距按照您的预期折叠并将其设置回以`display: table`再次撤消折叠。

但是再看一遍，[规范也这样说](http://www.w3.org/TR/CSS21/visuren.html#block-boxes)（强调我的）：

> 块级元素（**除了 display 'table' 元素**，将在后面的章节中描述）生成一个主体块框......主体块框参与块格式化上下文。

然后，在[块格式化上下文](http://www.w3.org/TR/CSS21/visuren.html#block-formatting)部分：

> 块格式化上下文中相邻块框之间的垂直边距折叠。

阅读这让我认为表格（不参与块格式化上下文）和段落（参与）之间的边距不应该折叠是正确的。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-09-25T23:16:18.753

我的理解是，垂直边距仅在表格和标题 [1] 之间折叠。否则，表格应该表现得像任何其他块元素 [2]（即 2 个元素，它们之间的边距均为 100px = 200px）。

1.  [http://www.w3.org/TR/CSS2/tables.html#q5](http://www.w3.org/TR/CSS2/tables.html#q5)
2.  [http://www.w3.org/TR/CSS2/box.html](http://www.w3.org/TR/CSS2/box.html)

# python - Python中的按键

> ID：136734
> 
> 赞同：34
> 
> 时间：2008-09-25T22:58:01.090
> 
> 标签：python, keypress

是否可以让系统显示一个按键被按下，例如我需要`A`按键被按下数千次，手动完成非常耗时，我想写点东西来做对我来说，我唯一知道的就是 Python。

更好的说法是，我需要模拟按键，IE 不捕获按键。

更多信息（根据要求）：我正在运行 Windows XP，需要将密钥发送到另一个应用程序。

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-09-25T23:09:39.550

安装[pywin32](https://github.com/mhammond/pywin32)扩展。然后您可以执行以下操作：

```
import win32com.client as comclt
wsh= comclt.Dispatch("WScript.Shell")
wsh.AppActivate("Notepad") # select another application
wsh.SendKeys("a") # send the keys you want 
```

搜索 WScript.Shell 对象的文档（我相信默认安装在所有 Windows XP 安装中）。也许你可以从[这里开始。](http://www.microsoft.com/technet/scriptcenter/guide/sas_wsh_pkoy.mspx?mfr=true)

**编辑：**发送 F11

```
import win32com.client as comctl
wsh = comctl.Dispatch("WScript.Shell")

# Google Chrome window title
wsh.AppActivate("icanhazip.com")
wsh.SendKeys("{F11}") 
```

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2015-10-21T00:57:43.800

您还可以使用 PyAutoGui 发送虚拟按键。

这是文档：[https ://pyautogui.readthedocs.org/en/latest/](https://pyautogui.readthedocs.org/en/latest/)

```
import pyautogui

pyautogui.press('Any key combination') 
```

您还可以发送诸如 shift 键或 enter 键之类的键：

```
import pyautogui

pyautogui.press('shift') 
```

Pyautogui 也可以像这样发送直接文本：

```
import pyautogui

pyautogui.typewrite('any text you want to type') 
```

至于按“A”键 1000 次，它看起来像这样：

```
import pyautogui

for i in range(999):
    pyautogui.press("a") 
```

alt-tab 或其他需要同时按下多个键的任务：

```
import pyautogui

# Holds down the alt key
pyautogui.keyDown("alt")

# Presses the tab key once
pyautogui.press("tab")

# Lets go of the alt key
pyautogui.keyUp("alt") 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-25T23:03:55.820

[AutoHotKey](http://www.autohotkey.com/)非常适合此类任务（键盘自动化/重新映射）

发送“A”100次的脚本：

```
Send {A 100} 
```

就这样

**编辑**：将密钥发送到特定应用程序：

```
WinActivate Word
Send {A 100} 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2017-06-26T10:12:55.597

检查具有许多功能的此模块[**键盘**](https://pypi.python.org/pypi/keyboard)。安装它，也许使用以下命令：

```
pip3 install keyboard 
```

然后使用此代码：

```
import keyboard
keyboard.write('A',delay=0) 
```

如果您想多次写“A”，那么只需使用循环。
***注意*：**
整个窗口都将按下“A”键。意味着脚本正在运行并且您进入浏览器，脚本将在那里开始编写。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-08-15T19:16:47.593

在发送按键事件之前将首选窗口设置为前台的替代方法。

```
hwnd = win32gui.FindWindowEx(0,0,0, "App title")
win32gui.SetForegroundWindow(hwnd) 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-25T23:12:13.130

如果您的平台是 Windows，我实际上不会推荐 Python。相反，请查看[Autohotkey](http://www.autohotkey.com/)。相信我，我喜欢 Python，但在这种情况下，宏程序是完成这项工作的理想工具。Autohotkey 的脚本只是不错的（在我看来），但模拟输入的简易性将为您节省无数时间。Autohotkey 脚本也可以“编译”，因此您不需要解释器来运行脚本。

此外，如果这是针对 Web 上的某些内容，我推荐[iMacros](https://addons.mozilla.org/en-US/firefox/addon/3863)。它是一个 Firefox 插件，因此与网站有更好的集成。例如，您可以说“以这种形式写 1000 个 'a'”而不是“在 (319,400) 处模拟鼠标点击，然后按 'a' 1000 次”。

对于 Linux，不幸的是，我无法找到一种轻松创建键盘/鼠标宏的好方法。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2020-02-18T08:25:06.513

PyAutoGui 还允许您多次按下按钮：

```
pyautogui.press('tab', presses=5)   # press TAB five times in a row

pyautogui.press('A', presses=1000)   # press A a thousand times in a row 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2021-02-17T14:06:16.777

有一个解决方案：

```
import pyautogui
for i in range(1000):
    pyautogui.typewrite("a") 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-12-12T08:04:40.870

```
import keyboard

keyboard.press_and_release('anykey') 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-03-27T19:53:10.493

您可以使用 pyautogui 模块，该模块可用于自动移动鼠标和按键。它也可以用于一些 GUI（非常基本的）。您可以执行以下操作：- import pyautogui pyautogui.press('A') # 按下 'A' 键

如果要执行 1000 次，则可以使用 while 循环

希望这会有所帮助:)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-07-30T14:08:27.310

您可以使用我编写的这段代码，它将按“a”键 1000 次

```
import pyautogui 
loop = 1
while loop <= 1000: 
  pyautogui.press("a")
   loop += 1 
```

# python - Python 语言 API

> ID：136739
> 
> 赞同：6
> 
> 时间：2008-09-25T22:59:10.853
> 
> 标签：python, reference, documentation, python-2.x

我从来自 java 的 Python 开始。

我想知道是否存在类似于 JavaDoc API 的东西，我可以在其中找到类、它的方法以及如何使用它的示例。

我发现从 Python（命令行）中使用*help(thing)非常有帮助*

我也发现了这个：

[http://docs.python.org/2/](http://docs.python.org/2/)

[https://docs.python.org/2/py-modindex.html](https://docs.python.org/2/py-modindex.html)

但是，当您已经拥有要查找的类名时，它似乎会有所帮助。在 JavaDoc API 中，我有所有的类，所以如果我需要一些东西，我会向下滚动到一个“听起来像”我需要的类。或者有时我只是浏览所有类以查看它们的作用，当我需要一个功能时，我的大脑会想起我 *我们在 javadoc 中看到过类似的东西记得！？*

但我似乎没有在 Python 中找到类似的东西（尚未），这就是我发布这个 questin 的原因。

顺便说一句，我知道我最终会读到这个：

[https://docs.python.org/2/library/](https://docs.python.org/2/library/)

但是，好吧，我认为不是今天。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-25T23:00:48.243

[pydoc](http://docs.python.org/library/pydoc.html) ?

我不确定您是否正在寻找更复杂的东西，但它确实有用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-25T23:11:13.820

标准的 python 库有很好的文档记录。尝试跳入 python 并导入一个模块说“os”并运行：

```
import os   
help(os) 
```

这会读取模块中每个项目的文档字符串并显示它。这也正是 pydoc 会做的。

编辑：[epydoc](http://epydoc.sourceforge.net/)可能正是您正在寻找的：

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T23:03:33.307

[这](https://docs.python.org/py-modindex.html)是 Python 中所有模块的列表，不确定这是否是您真正想要的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-25T23:42:37.567

我从 Python.org 下载了 Python 2.5，它不包含 pydoc。

```
Directorio de C:\Python25

9/23/2008  10:45 PM    <DIR>          .
9/23/2008  10:45 PM    <DIR>          ..
9/23/2008  10:45 PM    <DIR>          DLLs
9/23/2008  10:45 PM    <DIR>          Doc
9/23/2008  10:45 PM    <DIR>          include
9/25/2008  06:34 PM    <DIR>          Lib
9/23/2008  10:45 PM    <DIR>          libs
2/21/2008  01:05 PM            14,013 LICENSE.txt
2/21/2008  01:05 PM           119,048 NEWS.txt
2/21/2008  01:11 PM            24,064 python.exe
2/21/2008  01:12 PM            24,576 pythonw.exe
2/21/2008  01:05 PM            56,354 README.txt
9/23/2008  10:45 PM    <DIR>          tcl
9/23/2008  10:45 PM    <DIR>          Tools
2/21/2008  01:11 PM             4,608 w9xpopen.exe
          6 archivos        242,663 bytes 
```

但它有（我猜的替代品）pydocgui ......

```
C:\Python25>dir Tools\Scripts\pydocgui.pyw

10/28/2005  07:06 PM               222 pydocgui.pyw
           1 archivos            222 bytes 
```

这将启动一个网络服务器并显示我正在寻找的内容。所有模块以及平台附带的所有类。

Doc 目录包含与以下内容相同的内容：

[http://docs.python.org/](http://docs.python.org/)

非常感谢您指导我使用 pydoc。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T01:56:12.270

> 顺便说一句，我知道我最终会读到这个：
> 
> [http://docs.python.org/lib/lib.html](http://docs.python.org/lib/lib.html)
> 
> 但是，好吧，我认为不是今天。

我建议你犯了一个错误。lib doc 包含“类、它的方法以及如何使用它的示例”。这*就是*你要找的东西。

我一直都在使用 Java 和 Python。深入了解图书馆文档，您会找到所需的一切。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T08:07:29.600

您可以将*环境变量* **PYTHONDOCS**设置为指向 python 文档的安装位置。

在我的系统上，它位于*/usr/share/doc/python2.5*

因此，您可以在*shell 配置文件*或其他地方定义此变量，具体取决于您的系统：

> 导出 PYTHONDOCS=/usr/share/doc/python2.5

现在，如果你打开一个交互式 python 控制台，你可以调用帮助系统。举个例子：

> ```
> >>> help(Exception)
> >>> Help on class Exception in module exceptions:
> 
> >>> class Exception(BaseException)
> >>>  |  Common base class for all non-exit exceptions.
> >>>  |  
> >>>  |  Method resolution order:
> >>>  |      Exception 
> ```

文档在这里：

[https://docs.python.org/library/pydoc.html](https://docs.python.org/library/pydoc.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-25T23:04:21.077

如果您使用的是 Windows [ActiveState，Python](http://www.activestate.com/Products/activepython/index.mhtml)附带文档，包括可搜索帮助文件中的库参考。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-26T07:16:09.647

它不会直接回答您的问题（因此我可能会被降级），但您可能对[Jython](http://www.jython.org)感兴趣。

> Jython 是用 100% 纯 Java 编写的高级、动态、面向对象的 Python 语言的实现，并与 Java 平台无缝集成。因此，它允许您在任何 Java 平台上运行 Python。

由于您来自 Java，Jython 可以帮助您利用 Python，同时仍然允许您使用您的 Java 知识。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-26T08:34:18.490

也试试

```
pydoc -p 11111 
```

然后在浏览器中输入[http://localhost:11111](http://localhost:11111)

编辑：当然，您可以使用任何其他值作为端口号，而不是 11111

# c++ - 你如何让 StackWalk64() 在 x64 上成功运行？

> ID：136752
> 
> 赞同：3
> 
> 时间：2008-09-25T23:01:31.083
> 
> 标签：c++, windows, winapi, 64-bit, callstack

我有一个 C++ 工具，它可以一次遍历调用堆栈。在代码中，它首先获取实时 CPU 寄存器的副本（通过 RtlCaptureContext()），然后使用一些 " `#ifdef ...`" 块将 CPU 特定的寄存器名称保存到`stackframe.AddrPC.Offset`、 ... `AddrStack`... 和 ... 中`AddrFrame`。 ..; 此外，对于上述 3 个`Addr`... 成员中的每一个，它都设置了`stackframe.Addr`... `.Mode = AddrModeFlat`。（这是从我不久前遇到的一些示例代码中借来的。）

使用 x86 二进制文件，这很好用。但是，对于 x64 二进制文件，StackWalk64() 会传回虚假地址。 *（第一次调用 API 时，唯一公然伪造的地址值出现在`AddrReturn`（== `0xFFFFFFFF'FFFFFFFE`-- aka StackWalk64() 的第三个参数，GetCurrentThread() 返回的伪句柄）中。如果第二次调用 API ，但是，所有`Addr`... 变量都会收到虚假地址。）* 无论如何`AddrFrame`设置都会发生这种情况：

*   使用任一推荐的 x64“基/帧指针”CPU 寄存器：`rbp`(= `0xf`) 或`rdi`(= `0x0`)
*   使用`rsp` *（没想到它会起作用，但还是尝试了）*
*   设置`AddrPC`和`AddrStack`正常，但保持`AddrFrame`归零*（在其他示例代码中看到）*
*   清零所有`Addr`... 值，让 StackWalk64() 从传入的 CPU 寄存器上下文中填充它们*（在其他示例代码中看到）*

FWIW，物理堆栈缓冲区的内容在 x64 和 x86 上也不同（当然，在考虑了不同的指针宽度和堆栈缓冲区位置之后）。不管是什么原因， StackWalk64() 应该仍然能够正确地遍历调用堆栈——哎呀，调试器仍然能够遍历调用堆栈，而且它似乎在幕后使用 StackWalk64() 本身。奇怪的是，调试器报告的（正确的）调用堆栈包含基地址和返回地址指针值，其组成字节实际上并不存在于堆栈缓冲区中（低于或高于当前堆栈指针）。

*（FWIW #2：鉴于上面的堆栈缓冲区奇怪，我确实尝试禁用 ASLR ( `/dynamicbase:no`) 以查看它是否有所作为，但二进制文件仍然表现出相同的行为。）*

所以。任何想法为什么这在 x86 上可以正常工作，但在 x64 上会出现问题？关于如何修复它的任何建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T23:46:02.973

鉴于 fs.sf 是一个 STACKFRAME64 结构，您需要在将其传递给 StackWalk64 之前像这样初始化它：（c 是一个 CONTEXT 结构）

```
 DWORD machine = IMAGE_FILE_MACHINE_AMD64;
  RtlCaptureContext (&c);
  fs.sf.AddrPC.Offset = c.Rip;
  fs.sf.AddrFrame.Offset = c.Rsp;
  fs.sf.AddrStack.Offset = c.Rsp;
  fs.sf.AddrPC.Mode = AddrModeFlat;
  fs.sf.AddrFrame.Mode = AddrModeFlat;
  fs.sf.AddrStack.Mode = AddrModeFlat; 
```

此代码取自 ACE（自适应通信环境），改编自 CodeProject 上的 StackWalker 项目。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2020-09-20T09:55:51.933

`SymInitialize(process, nullptr, TRUE)` must be called (once) before `StackWalk64()`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T21:29:42.817

FWIW，我已经切换到 using `CaptureStackBackTrace()`，现在它工作得很好。

# testing - 结构化 UAT 方法

> ID：136766
> 
> 赞同：0
> 
> 时间：2008-09-25T23:05:30.073
> 
> 标签：testing, project-management, uat

作为一名开发人员，我经常发布我希望用户测试的不同版本的应用程序，以识别错误并确认满足要求。

我让用户大致了解我所做的更改或需要测试的新功能，但这似乎有点草率而且结构不太好。

我想知道其他人在迭代开发过程中要求 UAT 时采取了哪些方法或程序。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T23:53:32.923

用户故事或用例可能是您正在寻找的内容，您最初是如何决定更改的，以及您是如何指定它的。如果您编写一个小故事，或者更大的实际结构化用例，您可以将其用作您的更改规范，然后用户可以针对该故事进行测试，以查看实现是否与描述匹配。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-25T23:33:55.310

我发现编写测试脚本非常耗时，通常比修复到位所需的时间还要长。由于我们在这里所做的大量工作，我们只是没有时间创建有效的测试脚本。

随着我们的更改，我们将测试推向两个级别，即应用程序支持和业务接受度。我们希望通过技术方法和业务方法来测试变更的大部分方面。为了让他们知道他们应该测试什么，我们附上了一个受更改影响的操作列表（添加产品、删除产品、编辑产品）。

在我看来，这与强大的单元测试方法相结合是大容量环境的最佳方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T23:23:14.227

通常，我在 excel 中创建一个脚本，其中包含每个功能列表和一个“预期结果”和“实际结果”列，其中“预期结果”列填写了应该发生的内容。为了我自己的使用，我包含一个作为项目 id 的列。这对应于团队系统中的任务 ID 或创建的项目计划中的 WSB

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-27T15:56:21.603

您正在寻找一种高效且有效的方式来以结构化的方式进行 UAT。我强烈建议使用成对或组合测试设计方法。我在超过 2 打的概念验证项目中使用了这种方法，发现与手动识别测试用例的传统方法相比，这种方法始终导致每个测试人员每小时发现更多的缺陷。事实上，正如我最近与人合写的一篇 IEEE 计算机[文章](http://go2.wordpress.com/?id=725X1342&site=hexawise.wordpress.com&url=http%3A%2F%2Fcsrc.nist.gov%2Fgroups%2FSNS%2Facts%2Fdocuments%2Fkuhn-kacker-lei-hunter09.pdf)中所报告的那样，平均而言，我们发现每个测试人员每小时*的缺陷数是平均*的 2.4 倍。

该方法在[此处](http://hexawise.com/intro_movie)的视频中进行了描述。如果这似乎是“使用我的工具”插件，我们深表歉意。我不是故意的。这种**方法**会带来巨大的好处，而不是您选择用来设计测试的特定工具。James Bach 还在他的 satisfice.com 网站上提供了一个名为 AllPairs 的免费工具。我的观点是，使用任何此类工具都会产生非常出色的结果，因为这些工具旨在以最少的测试次数产生最大的覆盖率。他们避免重复；此外，它们会自动识别并弥补手动测试用例识别方法无法弥补的潜在覆盖率差距。

虽然像 Hexawise 这样的工具能够（在几秒钟内）识别出应该运行得比测试人员能够识别和记录（在几天内）更好的 UAT 测试用例，这可能是违反直觉的，但它仍然是正确的。自己试试吧。让您团队中的一名 UAT 测试人员执行 20 个使用 Hexawise 创建的端到端“黑盒”或“灰盒”测试，并让其他测试人员测试他们通常会做的事情。我敢打赌，执行 20 次 Hexawise 测试的测试人员每小时会发现更多缺陷（并且会发现“重要”和“不重要”的缺陷）。

遗憾的是，除了一群相对成熟的测试人员花时间阅读 Lee Copeland 的关于测试设计方法的书等书籍之外，这些方法在测试社区中并不为人所知。成对和组合方法始终如一地工作，它们极大地提高了效率和有效性，并且它们很容易让测试团队立即开始使用。

贾斯汀（Hexawise 创始人）

# vb.net - 如何在 SSRS 中执行 .AddDays() 之前检查空值？

> ID：136770
> 
> 赞同：5
> 
> 时间：2008-09-25T23:07:09.587
> 
> 标签：vb.net, reporting-services, ssrs-2008-r2

我在 SSRS 报告中的文本框具有以下值：

```
 =iif(IsNothing(Fields!MyDate.Value), "", Format(Fields!MyDate.Value.AddDays(30), "MMMM dd, yyyy")) 
```

每次 MyDate 为空时，它都会给我一个“#Error”。

我该如何解决这个问题？

更新：

我编写了这个自定义函数，它摆脱了错误，但在传递空日期时返回 0001 年 1 月 31 日。

```
Public Shared Function NewDate(myDate as DateTime, days as integer) AS string
IF ISNOTHING(myDate) OR ISDBNULL(myDate) Then
    NewDate = "        "
ELSE
    NewDate = Format(myDate.AddDays(days), "MMMM dd, yyyy")
END IF
End Function 
```

@Matt Hamilton：DateAdd("d", 30,Fields!MyDate.Value)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-25T23:25:42.630

当然，问题在于 VB 的 IIF 语句会评估双方，而不管结果如何。因此，即使您的字段为空，它仍在评估“Value.DateAdd”调用。

如果我没记错的话，SSRS 有它自己的“DateAdd”函数，你可以使用它。所以你可以做这样的事情（检查文档'因为这是来自记忆）：

```
=Iif(IsNothing(Fields!MyDate.Value), "", Format(DateAdd("d", 30, Fields!MyDate.Value), "MMMM dd, yyyy")) 
```

# sql - SQL Server 代理作业 - 存在然后丢弃？

> ID：136771
> 
> 赞同：64
> 
> 时间：2008-09-25T23:07:31.490
> 
> 标签：sql, sql-server, sql-server-agent, sql-job

如果（且仅当）它存在，我如何删除 sql server 代理作业？

*这是一个用于存储过程*的运行良好的脚本。我怎样才能对 sql server 代理作业做同样的事情？

```
if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[storedproc]') and OBJECTPROPERTY(id, N'IsProcedure') = 1)
    drop procedure [dbo].[storedproc]
GO
CREATE PROCEDURE [dbo].[storedproc] ... 
```

* * *

## 回答 #1

> 赞同：101
> 
> 时间：2008-09-26T00:46:00.287

尝试这样的事情：

```
DECLARE @jobId binary(16)

SELECT @jobId = job_id FROM msdb.dbo.sysjobs WHERE (name = N'Name of Your Job')
IF (@jobId IS NOT NULL)
BEGIN
    EXEC msdb.dbo.sp_delete_job @jobId
END

DECLARE @ReturnCode int
EXEC @ReturnCode =  msdb.dbo.sp_add_job @job_name=N'Name of Your Job' 
```

[最好阅读有关“sp_add_job”](http://msdn.microsoft.com/en-us/library/ms182079.aspx)和[“sp_delete_job”](http://msdn.microsoft.com/en-us/library/ms188376.aspx)所需的所有参数的文档

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2012-05-15T09:57:26.137

```
IF EXISTS (SELECT job_id 
            FROM msdb.dbo.sysjobs_view 
            WHERE name = N'Your Job Name')
EXEC msdb.dbo.sp_delete_job @job_name=N'Your Job Name'
                            , @delete_unused_schedule=1 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T10:18:06.337

如果您为作业生成 SQL 脚本（使用企业管理器测试），它会自动为您构建存在性检查和删除语句。下面的例子： -

```
DECLARE @JobID BINARY(16)   
DECLARE @ReturnCode INT  
SELECT @ReturnCode = 0  
-- Delete the job with the same name (if it exists)  
SELECT @JobID = job_id   
FROM  msdb.dbo.sysjobs  
WHERE (name = N'My test job')   
IF (@JobID IS NOT NULL)  
BEGIN  
-- Check if the job is a multi-server job  
IF (EXISTS (SELECT *   
FROM msdb.dbo.sysjobservers   
WHERE (job_id = @JobID) AND (server_id <> 0)))   
BEGIN   
-- There is, so abort the script   
RAISERROR (N'Unable to import job ''My test job'' since there is already a multi-server   job with this name.', 16, 1) 
END   
ELSE   
-- Delete the [local] job   
EXECUTE msdb.dbo.sp_delete_job @job_name = N'My test job'   
SELECT @JobID = NULL  
END 
```

# .net - 为什么通过菜单项的单击事件打开的模式对话框会处理所有窗口消息？

> ID：136773
> 
> 赞同：4
> 
> 时间：2008-09-25T23:07:53.330
> 
> 标签：.net, window-messages

所以在过去的一天左右，我一直在修复一个由模式对话框引起的错误。我在一个通过 Windows 消息泵与服务器通信的应用程序上工作。当我使用 ShowDialog() 显示模态表单时，消息泵被阻止并且我的任何消息都没有被处理，但它们确实在队列中建立（预期行为）。

但是，我最近注意到，如果通过菜单项的单击事件打开模式窗体，则消息将被泵送到主窗体并进行处理。有谁知道为什么当通过菜单项的单击事件显示模态表单时这些消息没有被阻止？

编辑：我应该注意到我正在使用 C#。这个怎么样; 如果没有人能回答这个问题，谁能告诉我如何自己调查这个问题？我唯一能想到的就是查看调用堆栈。不幸的是，这还没有告诉我任何事情。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-25T23:22:59.097

是的，我从菜单项的单击事件中调用 ShowDialog()。在这种情况下，消息通过模态对话框泵送到主窗体。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T16:34:03.697

尝试将菜单中的对话框设置为相同的所有者/父对象，以显示预期的消息泵送行为。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-04T05:45:47.230

通常，您的客户端 UI**不应**因长时间的服务器操作而阻塞。.Net 使得使用 BackgroundWorker 线程进行服务器工作变得**非常容易。**有关示例，请参见此帖子：[多线程导入](https://stackoverflow.com/questions/95700/vb-net-or-c-2008-multi-threaded-import)

该示例在 VB 中，但您可以点击 C# 示例的链接。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T23:09:48.537

您是从单击事件中调用 ShowDialog() 还是以其他方式调用？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T01:06:18.427

您使用的是哪种菜单控件？它可以在与主窗体运行的线程不同的线程上运行吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T01:23:15.720

@Chris: I am just using the standard MenuStrip control. If it were running on a separate thread, I would then be interested in how it shows the form as modal. I experimented with showing the dialog from a separate thread as to not block the message queue, but I cannot specify the main form as a parent, so it is not really modal.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-11-25T17:42:27.160

我不清楚您所说的“消息泵被阻止”是什么意思。

发生的情况是 ShowDialog 没有返回，因此顶级消息泵正在等待您的应用程序从处理使其调用 ShowDialog 的任何事件返回；这与您的处理程序甚至在磨削 CPU 没有什么不同。所以，是的，从这个意义上说，消息泵被阻塞了。

但是模态对话框本身运行自己的消息泵循环，直到对话框关闭，它应该像主循环一样处理消息，所以我不明白为什么任何消息都应该在队列中建立。

这个消息循环处理所有窗口的消息，因为它必须例如允许应用程序的其他窗口正确地绘制自己。

您可能会尝试查看回调堆栈（从 ShowDialog 调用向下到堆栈的根），并比较“事情正常工作”和“事情不工作”时的外观。这可能有点微妙，比如您是通过消息调度还是消息预处理来调用 ShowDialog（我刚刚发现当您调用 ContextMenuStrip.Show 时会有所不同）

# php - 使用 PHP 从 MySQL 日期时间转换为另一种格式

> ID：136782
> 
> 赞同：467
> 
> 时间：2008-09-25T23:10:30.203
> 
> 标签：php, mysql, datetime

我`datetime`在 MySQL 中有一个专栏。

如何使用 PHP将其转换为**mm/dd/yy H:M (AM/PM)显示？**

* * *

## 回答 #1

> 赞同：546
> 
> 时间：2011-03-20T06:06:08.663

如果您正在寻找一种将日期标准化为 MySQL 格式的方法，请使用以下命令

```
$phpdate = strtotime( $mysqldate );
$mysqldate = date( 'Y-m-d H:i:s', $phpdate ); 
```

该行`$phpdate = strtotime( $mysqldate )`接受一个字符串并执行一系列启发式方法将该字符串转换为 unix 时间戳。

该行`$mysqldate = date( 'Y-m-d H:i:s', $phpdate )`使用该时间戳和 PHP 的[`date`](http://php.net)函数将该时间戳转换回 MySQL 的标准日期格式。

（**编者注**：这个答案在这里是因为一个原始问题的措辞令人困惑，并且即使它没有直接回答现在存在的问题，这个答案也提供了谷歌的一般用途）

* * *

## 回答 #2

> 赞同：320
> 
> 时间：2008-09-25T23:30:09.330

将从 MySQL 检索到的日期转换为请求的格式 ( `mm/dd/yy H:M (AM/PM)`)：

```
// $datetime is something like: 2014-01-31 13:05:59
$time = strtotime($datetimeFromMysql);
$myFormatForView = date("m/d/y g:i A", $time);
// $myFormatForView is something like: 01/31/14 1:05 PM 
```

请参阅[PHP 日期格式选项](http://php.net/manual/en/function.date.php#refsect1-function.date-parameters)以调整格式。

* * *

## 回答 #3

> 赞同：115
> 
> 时间：2008-09-26T04:31:21.397

如果您使用的是 PHP 5，您也可以尝试

```
$oDate = new DateTime($row->createdate);
$sDate = $oDate->format("Y-m-d H:i:s"); 
```

* * *

## 回答 #4

> 赞同：48
> 
> 时间：2013-03-01T13:02:44.070

```
$valid_date = date( 'm/d/y g:i A', strtotime($date)); 
```

**参考： http:** [//php.net/manual/en/function.date.php](http://php.net/manual/en/function.date.php)

* * *

## 回答 #5

> 赞同：31
> 
> 时间：2014-12-30T21:53:24.297

最后是 PHP 5.3 及更高版本的正确解决方案：（ *在示例中添加了可选的时区，如评论中提到的）*

无时区：

```
$date = \DateTime::createFromFormat('Y-m-d H:i:s', $mysql_source_date);
echo $date->format('m/d/y h:i a'); 
```

带时区：

```
$date = \DateTime::createFromFormat('Y-m-d H:i:s', $mysql_source_date, new \DateTimeZone('UTC'));
$date->setTimezone(new \DateTimeZone('Europe/Berlin'));
echo $date->format('m/d/y h:i a'); 
```

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2008-09-25T23:15:23.950

一种更简单的方法是直接在 MySQL 查询中而不是 PHP 中格式化日期。请参阅[DATE_FORMAT 的 MySQL 手册条目](http://dev.mysql.com/doc/refman/5.0/en/date-and-time-functions.html#function_date-format)。

如果您更愿意在 PHP 中执行此操作，那么您需要[date](http://uk.php.net/date)函数，但您必须先将数据库值转换为时间戳。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2012-09-14T08:58:35.093

忘记所有。只需使用：

```
$date = date("Y-m-d H:i:s",strtotime(str_replace('/','-',$date))) 
```

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2013-05-31T17:42:08.893

要在 PHP 中正确格式化`DateTime`对象以存储在 MySQL 中，请使用 MySQL 使用的标准化格式，即[ISO 8601](http://en.wikipedia.org/wiki/ISO_8601)。

PHP 从 5.1.1 版本开始将这种格式存储为常量，我强烈建议使用它而不是每次都手动输入字符串。

```
$dtNow = new DateTime();
$mysqlDateTime = $dtNow->format(DateTime::ISO8601); 
```

这和其他 PHP DateTime 常量的列表可在[http://php.net/manual/en/class.datetime.php#datetime.constants.types](http://php.net/manual/en/class.datetime.php#datetime.constants.types)

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2011-11-08T20:07:29.563

这应该格式化 SQL 查询中的字段：

```
SELECT DATE_FORMAT( `fieldname` , '%d-%m-%Y' ) FROM tablename 
```

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2008-09-25T23:16:05.197

使用[日期](http://www.php.net/date)函数：

```
<?php
    echo date("m/d/y g:i (A)", $DB_Date_Field);
?> 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2014-01-23T19:49:47.217

取决于您的 MySQL 日期时间配置。通常：***2011-12-31 07:55:13***格式。这个非常简单的功能应该可以发挥作用：

```
function datetime()
{
    return date( 'Y-m-d H:i:s', time());
}

echo datetime(); // display example: 2011-12-31 07:55:13 
```

或者提前一点来匹配问题。

```
function datetime($date_string = false)
{
    if (!$date_string)
    {
        $date_string = time();
    }
    return date("Y-m-d H:i:s", strtotime($date_string));
} 
```

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2015-07-09T18:12:37.417

```
SELECT 
 DATE_FORMAT(demo.dateFrom, '%e.%M.%Y') as dateFrom,
 DATE_FORMAT(demo.dateUntil, '%e.%M.%Y') as dateUntil
FROM demo 
```

如果您不想更改 PHP 代码中的每个函数以显示预期的日期格式，请在源 - 您的数据库中进行更改。

**如上例所示，使用as**运算符命名行很重要（如 dateFrom、dateUntil）。你在那里写的名字就是名字，行将在你的结果中被调用。

这个例子的输出将是

[月份中的日期，数字 (0..31)].[月份名称 (January..December)].[年份，数字，四位数字]

示例：2015 年 8 月 5 日

使用选择的分隔符更改点并检查[DATE_FORMAT(date,format)](http://dev.mysql.com/doc/refman/5.0/en/date-and-time-functions.html#function_date-format)函数以获取更多日期格式。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-09-25T23:57:03.960

您还可以让您的查询将时间作为 Unix 时间戳返回。这将摆脱调用的需要`strtotime()`，并使 PHP 端的事情变得不那么密集......

```
select  UNIX_TIMESTAMP(timsstamp) as unixtime from the_table where id = 1234; 
```

然后在 PHP 中，只需使用该`date()`函数以任何您喜欢的方式对其进行格式化。

```
<?php
  echo date('l jS \of F Y h:i:s A', $row->unixtime);
?> 
```

或者

```
<?php
  echo date('F j, Y, g:i a', $row->unixtime);
?> 
```

我喜欢这种方法而不是使用[MySQL](http://en.wikipedia.org/wiki/MySQL)的`DATE_FORMAT`函数，因为它允许您重用相同的查询来获取数据并允许您更改 PHP 中的格式。

有两个不同的查询只是为了改变日期在 UI 中的显示方式很烦人。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-04-23T01:56:04.733

您可能会遇到 Unix Timestamp 中未返回的日期的问题，所以这对我有用......

```
return date("F j, Y g:i a", strtotime(substr($datestring, 0, 15))) 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2014-03-12T06:11:04.347

这将工作...

```
echo date('m/d/y H:i (A)',strtotime($data_from_mysql)); 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-11-21T19:12:50.040

使用 PHP 4.4.9 和 MySQL 5.0，这对我有用：

```
$oDate = strtotime($row['PubDate']);
$sDate = date("m/d/y",$oDate);
echo $sDate 
```

`PubDate`是[MySQL](http://en.wikipedia.org/wiki/MySQL)中的列。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-05-16T18:18:09.863

我建议的方法如下所示。首先，从 mysql 格式的字符串创建一个基本的日期时间对象；然后你按照你喜欢的方式格式化它。幸运的是，mysql datetime 符合 ISO8601，因此代码本身看起来非常简单和优雅。请记住，尽管该`datetime`列没有时区信息，因此[您需要对其进行适当的转换](https://stackoverflow.com/questions/2505681/timezone-conversion-in-php/61840217#61840217)。

这是代码：

```
(new ISO8601Formatted(
    new FromISO8601('2038-01-19 11:14:07'),
    'm/d/Y h:iA'
))
    ->value(); 
```

它输出`01/19/2038 11:14AM`——希望是你所期望的。

此示例使用蛋白酥皮库。如果您愿意，可以[查看更多内容](https://meringue.readthedocs.io/en/latest/quick_start.html)。

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2013-12-02T13:00:47.527

```
$date = "'".date('Y-m-d H:i:s', strtotime(str_replace('-', '/', $_POST['date'])))."'"; 
```

# python - 如何让 Python / PostgreSQL 更快？

> ID：136789
> 
> 赞同：7
> 
> 时间：2008-09-25T23:12:50.087
> 
> 标签：python, postgresql

现在我有一个日志解析器读取 515mb 的纯文本文件（过去 4 年中每天的文件）。我的代码目前是这样的：http: [//gist.github.com/12978](http://gist.github.com/12978)。我使用过 psyco（如代码中所示），我也在编译它并使用编译后的版本。它每 0.3 秒执行大约 100 行。该机器是标准的 15" MacBook Pro (2.4ghz C2D, 2GB RAM)

这是否有可能更快，或者这是对语言/数据库的限制？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-26T01:50:23.767

不要浪费时间进行分析。时间总是在数据库操作中。尽量少做。只需最少的插入次数。

三件事。

一。不要一遍又一遍地选择以符合日期、主机名和人员维度。一次将所有数据提取到 Python 字典中并在内存中使用它。不要重复单例选择。使用 Python。

二。不要更新。

具体来说，不要这样做。这是糟糕的代码有两个原因。

```
cursor.execute("UPDATE people SET chats_count = chats_count + 1 WHERE id = '%s'" % person_id) 
```

它被一个简单的 SELECT COUNT(*) FROM ... 替换。永远不要更新以增加计数。只需计算带有 SELECT 语句的行数。[如果您不能使用简单的 SELECT COUNT 或 SELECT COUNT(DISTINCT) 做到这一点，那么您会丢失一些数据——您的数据模型应该始终提供正确的完整计数。永不更新。]

和。永远不要使用字符串替换来构建 SQL。完全哑巴。

如果由于某种原因`SELECT COUNT(*)`速度不够快（首先进行基准测试，然后再做任何蹩脚的事情），您可以将计数结果缓存在另一个表中。在所有负载之后。执行 a`SELECT COUNT(*) FROM whatever GROUP BY whatever`并将其插入计数表中。不要更新。曾经。

三。使用绑定变量。总是。

```
cursor.execute( "INSERT INTO ... VALUES( %(x)s, %(y)s, %(z)s )", {'x':person_id, 'y':time_to_string(time), 'z':channel,} ) 
```

SQL 永远不会改变。绑定的值会改变，但 SQL 永远不会改变。这要快得多。永远不要动态构建 SQL 语句。绝不。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-25T23:29:56.910

在 sql 语句中使用绑定变量而不是文字值，并为每个唯一的 sql 语句创建一个游标，以便下次使用该语句时无需重新解析。从 python db api 文档：

> 准备并执行数据库操作（查询或命令）。参数可以作为序列或映射提供，并将绑定到操作中的变量。变量以特定于数据库的表示法指定（有关详细信息，请参阅模块的 paramstyle 属性）。[5]
> 
> 游标将保留对该操作的引用。如果再次传入相同的操作对象，则游标可以优化其行为。这对于使用相同操作但绑定不同参数（很多次）的算法最有效。

总是总是总是使用绑定变量。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-25T23:59:39.290

在 for 循环中，您重复插入到“聊天”表中，因此您只需要一个带有绑定变量的 sql 语句，以使用不同的值执行。所以你可以把它放在 for 循环之前：

```
insert_statement="""
    INSERT INTO chats(person_id, message_type, created_at, channel)
    VALUES(:person_id,:message_type,:created_at,:channel)
""" 
```

然后代替您执行的每个 sql 语句，将其放在适当的位置：

```
cursor.execute(insert_statement, person_id='person',message_type='msg',created_at=some_date, channel=3) 
```

这将使事情运行得更快，因为：

1.  游标对象不必每次都重新解析语句
2.  db 服务器不必生成新的执行计划，因为它可以使用之前创建的执行计划。
3.  您不必调用 santitize() 因为绑定变量中的特殊字符不会成为执行的 sql 语句的一部分。

注意：我使用的绑定变量语法是 Oracle 特定的。您必须检查 psycopg2 库的文档以了解确切的语法。

其他优化：

1.  每次循环迭代后，您都将使用“UPDATE people SET chatscount”进行递增。保留一个字典映射用户到chat_count，然后执行你看到的总数的语句。这将比在每条记录后点击数据库更快。
2.  在所有查询中使用绑定变量。不只是插入语句，我选择它作为示例。
3.  更改所有执行数据库查找的 find_*() 函数以缓存其结果，这样它们就不必每次都访问数据库。
4.  Psycho 优化执行大量数字运算的 python 程序。该脚本是 IO 昂贵的，而不是 CPU 昂贵的，所以如果有任何优化，我不希望给你太多。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T00:20:36.680

正如 Mark 建议的那样，使用绑定变量。数据库只需为每个语句准备一次，然后为每次执行“填空”。作为一个很好的副作用，它会自动处理字符串引用问题（您的程序没有处理）。

打开事务（如果还没有）并在程序结束时执行一次提交。在需要提交所有数据之前，数据库不必将任何内容写入磁盘。如果您的程序遇到错误，则不会提交任何行，这样您就可以在问题得到纠正后简单地重新运行程序。

您的 log_hostname、log_person 和 log_date 函数正在对表进行不必要的 SELECT。使适当的表属性 PRIMARY KEY 或 UNIQUE。然后，不要在 INSERT 之前检查密钥是否存在，只需执行 INSERT。如果人员/日期/主机名已经存在，则 INSERT 将因违反约束而失败。（如果您使用带有单个提交的事务，这将不起作用，如上所述。）

或者，如果您知道您是唯一一个在程序运行时插入表中的人，则在执行插入时在内存中创建并行数据结构并在内存中维护它们。例如，在程序开始时将表中的所有主机名读入关联数组。当想知道是否进行 INSERT 时，只需进行数组查找即可。如果未找到条目，请执行 INSERT 并适当地更新数组。（此建议与事务和单次提交兼容，但需要更多编程。不过，它会快得多。）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T00:26:21.503

除了@Mark Roddy 给出的许多好的建议之外，请执行以下操作：

*   不要使用`readlines`，你可以遍历文件对象
*   尝试使用`executemany`而不是`execute`：尝试进行批量插入而不是单次插入，这往往会更快，因为开销更少。它还减少了提交的数量
*   `str.rstrip`将工作得很好，而不是用正则表达式剥离换行符

批量插入将暂时使用更多内存，但是当您不将整个文件读入内存时应该没问题。

# ruby - Ruby 中有“do ... while”循环吗？

> ID：136793
> 
> 赞同：474
> 
> 时间：2008-09-25T23:15:03.873
> 
> 标签：ruby, loops

我正在使用此代码让用户输入名称，而程序将它们存储在一个数组中，直到他们输入一个空字符串（他们必须在每个名称后按 enter）：

```
people = []
info = 'a' # must fill variable with something, otherwise loop won't execute

while not info.empty?
    info = gets.chomp
    people += [Person.new(info)] if not info.empty?
end 
```

这段代码在 do ... while 循环中看起来会更好：

```
people = []

do
    info = gets.chomp
    people += [Person.new(info)] if not info.empty?
while not info.empty? 
```

在这段代码中，我不必将信息分配给一些随机字符串。

不幸的是，Ruby 中似乎不存在这种类型的循环。有人可以提出更好的方法吗？

* * *

## 回答 #1

> 赞同：681
> 
> 时间：2012-05-23T05:28:38.377

**注意**：

`begin <code> end while <condition>`被 Ruby 的作者 Matz 拒绝。相反，他建议使用`Kernel#loop`，例如

```
loop do 
  # some code here
  break if <condition>
end 
```

这是2005 年 11 月 23 日[的电子邮件交流](http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-core/6745)，Matz 指出：

```
|> Don't use it please.  I'm regretting this feature, and I'd like to
|> remove it in the future if it's possible.
|
|I'm surprised.  What do you regret about it?

Because it's hard for users to tell

  begin <code> end while <cond>

works differently from

  <code> while <cond> 
```

[RosettaCode wiki](http://rosettacode.org/wiki/Loops/Do-while#Ruby)也有类似的故事：

> 2005 年 11 月，Ruby 的创建者 Yukihiro Matsumoto 对这个循环功能表示遗憾，并建议使用 Kernel#loop。

* * *

## 回答 #2

> 赞同：188
> 
> 时间：2008-09-25T23:19:05.457

> `Tempfile#initialize`我在阅读Ruby 核心库中的源代码时发现了以下代码段：
> 
> ```
> begin
>   tmpname = File.join(tmpdir, make_tmpname(basename, n))
>   lock = tmpname + '.lock'
>   n += 1
> end while @@cleanlist.include?(tmpname) or
>   File.exist?(lock) or File.exist?(tmpname) 
> ```
> 
> 乍一看，我认为 while 修饰符会在 begin...end 的内容之前被评估，但事实并非如此。观察：
> 
> ```
> >> begin
> ?>   puts "do {} while ()" 
> >> end while false
> do {} while ()
> => nil 
> ```
> 
> 如您所料，当修饰符为真时，循环将继续执行。
> 
> ```
> >> n = 3
> => 3
> >> begin
> ?>   puts n
> >>   n -= 1
> >> end while n > 0
> 3
> 2
> 1
> => nil 
> ```
> 
> 虽然我很高兴再也不会看到这个成语，但 begin...end 非常强大。以下是记忆没有参数的单行方法的常用习惯用法：
> 
> ```
> def expensive
>   @expensive ||= 2 + 2
> end 
> ```
> 
> 这是一种很难记住但快速记住更复杂内容的方法：
> 
> ```
> def expensive
>   @expensive ||=
>     begin
>       n = 99
>       buf = "" 
>       begin
>         buf << "#{n} bottles of beer on the wall\n" 
>         # ...
>         n -= 1
>       end while n > 0
>       buf << "no more bottles of beer" 
>     end
> end 
> ```

*最初由杰里米·沃里斯 ( [Jeremy Voorhis](https://twitter.com/jvoorhis) ) 撰写。内容已被复制到此处，因为它似乎已从原始站点中删除。副本也可以在[Web Archive](http://web.archive.org/web/20080206125158/http://archive.jvoorhis.com/articles/2007/06/13/ruby-hidden-do-while-loop)和[Ruby Buzz 论坛](http://www.artima.com/forums/flat.jsp?forum=123&thread=208036)中找到。- 蜥蜴比尔*

* * *

## 回答 #3

> 赞同：103
> 
> 时间：2008-09-25T23:20:30.147

像这样：

```
people = []

begin
  info = gets.chomp
  people += [Person.new(info)] if not info.empty?
end while not info.empty? 
```

参考：[Ruby 的 Hidden do {} while () 循环](http://web.archive.org/web/20080206125158/http://archive.jvoorhis.com/articles/2007/06/13/ruby-hidden-do-while-loop)

* * *

## 回答 #4

> 赞同：44
> 
> 时间：2008-09-25T23:24:03.133

这个怎么样？

```
people = []

until (info = gets.chomp).empty?
  people += [Person.new(info)]
end 
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2010-07-22T15:27:46.767

这是从 hubbardr 到我的博客的死链接中的全文文章。

`Tempfile#initialize`我在阅读Ruby 核心库中的源代码时发现了以下代码段：

```
begin
  tmpname = File.join(tmpdir, make_tmpname(basename, n))
  lock = tmpname + '.lock'
  n += 1
end while @@cleanlist.include?(tmpname) or
  File.exist?(lock) or File.exist?(tmpname) 
```

乍一看，我认为`while`修饰符会在 的内容之前进行评估`begin...end`，但事实并非如此。观察：

```
>> begin
?>   puts "do {} while ()" 
>> end while false
do {} while ()
=> nil 
```

如您所料，当修饰符为真时，循环将继续执行。

```
>> n = 3
=> 3
>> begin
?>   puts n
>>   n -= 1
>> end while n > 0
3
2
1
=> nil 
```

虽然我很高兴再也不会看到这个成语，但`begin...end`它非常强大。以下是记忆没有参数的单行方法的常用习惯用法：

```
def expensive
  @expensive ||= 2 + 2
end 
```

这是一种很难记住但快速记住更复杂内容的方法：

```
def expensive
  @expensive ||=
    begin
      n = 99
      buf = "" 
      begin
        buf << "#{n} bottles of beer on the wall\n" 
        # ...
        n -= 1
      end while n > 0
      buf << "no more bottles of beer" 
    end
end 
```

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2013-02-17T06:26:31.810

这现在可以正常工作：

```
begin
    # statment
end until <condition> 
```

但是，它可能会在未来被删除，因为这种`begin`说法是违反直觉的。见：[http ://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-core/6745](http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-core/6745)

Matz（Ruby 的创建者）建议这样做：

```
loop do
    # ...
    break if <condition>
end 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2013-08-28T18:23:59.267

据我所知，Matz 不喜欢这个结构

```
begin
    <multiple_lines_of_code>
end while <cond> 
```

因为，它的语义不同于

```
<single_line_of_code> while <cond> 
```

因为第一个构造在检查条件之前首先执行代码，第二个构造在执行代码之前首先测试条件（如果有的话）。我认为 Matz 更喜欢保留第二个构造，因为它匹配 if 语句的一行构造。

即使对于 if 语句，我也不喜欢第二个构造。在所有其他情况下，计算机从左到右（例如 || 和 &&）从上到下执行代码。人类从左到右从上到下阅读代码。

我建议使用以下构造：

```
if <cond> then <one_line_code>      # matches case-when-then statement

while <cond> then <one_line_code>

<one_line_code> while <cond>

begin <multiple_line_code> end while <cond> # or something similar but left-to-right 
```

我不知道这些建议是否会与其他语言一起解析。但无论如何，我更喜欢保持从左到右的执行以及语言的一致性。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-08-04T23:51:43.687

```
a = 1
while true
  puts a
  a += 1
  break if a > 10
end 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-11-10T12:38:58.283

这是另一个：

```
people = []
1.times do
  info = gets.chomp
  unless info.empty? 
    people += [Person.new(info)]
    redo
  end
end 
```

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2010-01-11T18:47:58.170

```
ppl = []
while (input=gets.chomp)
 if !input.empty?
  ppl << input
 else
 p ppl; puts "Goodbye"; break
 end
end 
```

# security - 监控用户是否合乎道德？

> ID：136798
> 
> 赞同：11
> 
> 时间：2008-09-25T23:15:34.387
> 
> 标签：security, tracking, privacy, corporate-policy

我不知道我会这么快收到太多回复。我可以提供更多细节。它绝对是在公司内部使用的。我正在寻找一些关于我是否应该更加小心或需要注意什么的信息......

我的老板要求我提供一些关于用户使用他们的应用程序做什么的跟踪信息。这与收集敏感数据无关，但可能涉及一些屏幕截图，我不确定这是否侵犯了隐私。

很想听听对此的任何想法，或者您是否处理过类似的事情。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-25T23:17:43.290

在工作中，没有隐私。这样想，如果您为金融机构或政府机构工作，监控用户可能是保持敏感信息保密与不保密之间的区别。（我希望我的个人信息保密）。他们在工作中获得报酬。如果他们害怕自己所做的事情是错误的，那么他们就不应该这样做。

一条评论提出了一个很好的观点。如果您销售产品并监视最终用户，那就完全不同了。截屏并将其报告给公司是非常不道德的。事实上，我工作的地方，如果我们知道了，我们会逮捕你的。（是的，你会违反联邦法律，我保证我们会追查每个人并在以后解决错误。）这是一个非常滑的斜坡。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-25T23:19:40.867

如果您指的是广大用户，是的，这是对隐私的侵犯。

如果您指的是您公司内部的用户（员工），那么不——不应该期望工作场所的隐私。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-25T23:18:41.167

有时收集一些指标是很好的，这将有助于增强用户体验。曾经，我们能够证明某个功能从未被使用过，并且我们能够删除对它的支持。对于屏幕截图，您应该小心只截取所需的窗口而不是全屏。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-25T23:54:37.197

撇开法律问题不谈，您想在一家为您的桌面截屏的公司工作吗？

即使合法，这种行为也肯定会赶走开发人员。请记住，在糟糕的工作环境中，最好的开发人员通常会先离开；他们有最好的工作前景。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-25T23:19:59.010

如果该应用程序在您的组织内部使用，并且您的公司政策声明“不期望隐私”已传达给您的用户并由您的用户签名，那么就没有问题。

监控美国企业内员工的行为是非常普遍的做法。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-26T17:21:39.150

这是一个必然的例子：你想让你的老板录音和听你从办公室打来的电话吗？您不会仅仅通过兑现薪水就放弃您拥有的所有权利。

即使这种截屏方法是合法的，它肯定是不道德的，并且会通过证明他们不被信任而绝对会损害员工的士气。

这只是个坏主意。必须有比这更好的方法来实现你的目标。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-26T00:10:42.320

如果它是一个内部应用程序，它完全符合道德。

除了向所有用户披露他们对应用程序的使用受到监控之外，没有其他披露义务（联邦合同和工会合同除外）。

捕获此类数据最重要的是专注于捕获绝对最少的必要数量 - 捕获所有打开窗口以及任何相邻数据流的屏幕截图实际上会产生责任问题（想想 HIPPA）以及产生大量数据除非律师通过传票提出要求，否则没有人会仔细检查，并且要求您仔细检查并编辑 160GB 数据中的所有姓名、出生日期和 SSN。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-25T23:18:36.127

截图？如果不是选择加入，我会说这是对隐私的明显侵犯。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-25T23:19:55.000

我用 PHP 制作了一个简单的 CMS，我必须存储用户的所有操作，但情况完全不同。在我看来，问你老板的事情有点出于隐私，特别是如果在你的应用程序中你没有向用户提及这种行为。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-25T23:20:19.650

在工作机器上？绝对地; 只要用户知道他们被监控的程度。为雇主工作是他们的选择，他们正在使用雇主的设备。

如果您*不*通知他们他们正在被监视，那么这是一个“灰色区域”......根据州法律，它甚至可能是*非法*的 - 取决于您正在监视的信息类型。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-25T23:21:17.133

这在很大程度上取决于您所在的国家/地区以及您收集的信息以及您如何处理这些信息。
例如，美国和欧盟之间存在巨大差异。

法律、判例、工会合同和公司政策（如果与上述不矛盾）决定什么是可接受的。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-25T23:28:37.460

有助于澄清的事情是这是内部公司应用程序或将在用户个人计算机上的东西。

通常，当涉及到公司拥有的计算机时，如果公司决定进行监控，这是他们的选择。为了公开和诚实，通常鼓励披露监控，但这不是强制性的。用户在使用公司拥有和管理的设备时不应有任何隐私期望。

这不仅仅是定制应用程序的问题，还包括网页浏览、电子邮件、电话交谈等。如果您使用的是公司资源，那么您就是在释放您的隐私。

如果这是面向公司以外用户的应用程序，那么是的，未经用户许可，这是错误的。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-26T12:51:21.547

似乎已经回答了这个问题，但应该注意的是，有些国家/地区即使在工作场所也是如此。
例如，在瑞士，跟踪每个用户访问过的网站是非法的。

除了相反的具体法律，我同意这样做是可以接受的，因为在工作场所不应该有对隐私的合理期望。也就是说，通知用户是正确的做法。

另一个警告，如果您收集的数据足够敏感，攻击者可以使用它（例如，屏幕截图包括 CC 编号），那么您必须确保此信息得到很好的保护。（我指的不是用户信息，而是银行客户的账户信息。）

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-26T00:19:32.190

> 截图？如果不是选择加入，我会说这是对隐私的明显侵犯。

您已通过兑现薪水选择加入 :)

正如许多人所说，通知用户是公司能做的最好的事情。**通知**，而不是要求选择加入。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-25T23:19:09.603

如果客户是外部客户，则应向客户披露。实际上，如果客户是内部或外部的，如果你不透露它，那是完全不道德的。

声明不能期望隐私的雇佣协议构成披露。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-25T23:20:44.280

如果是在未经用户同意的情况下进行的，那绝对是对隐私的侵犯。即使得到用户的同意，也必须明确传回哪些信息。如果屏幕截图是抓取整个屏幕，而不仅仅是一个窗口，那么您可能会获得各种私人信息。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-25T23:22:10.970

这是一个内部应用程序还是面向公众的东西？如果是内部的，即使是卑鄙的，监视用户也不是不道德的。

如果它是为公众准备的，为了不低俗：

*   用户必须能够选择退出
*   无法收集任何个人识别数据
*   只能收集有关您的应用程序的数据（而不是整个屏幕的屏幕截图）

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-25T23:23:58.797

这实际上取决于收集的确切内容、披露以及是否可以选择退出该程序。如果通过了气味测试，那么确保报告不提供攻击媒介并且数据得到适当保护就成为您关心的问题。如果事情看起来可疑，请向 CYA 发送一些书面的“功能请求”。基本思想，如果做得好，并不是什么新鲜事。例如，微软用他们的一些产品做到了这一点。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-09-25T23:27:52.890

在工作环境中，我认为只要所有员工都知道他们可能会受到监控就可以了。我见过整天跟踪员工的地方（Intuit 就是其中之一）。然而，这不是我的一杯茶。

在政府机构中，通常会有某种登录屏幕，表明在该机器上所做的任何事情都受到监控。

如果这些是由公众运行的应用程序，我会说最好清楚地表明您正在收集有关它们的数据。就我个人而言，我宁愿不要让程序“打电话回家”来提供有关我的活动的信息，尽管它们可能很无聊。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-10-11T05:26:27.967

I would suggest reading: [Privacy](http://en.wikipedia.org/wiki/Privacy). My interpretation is that people will expect some things to be kept private such as their personal information. By interacting with your sites, users are sharing information with you that you should be able to use but not distribute or abuse as if it was your own.

Screen shots is obviously the hot button issue here. While users entering information into a text input field are knowingly giving you information, screen shots go beyond what a typical user would expect and therefore should be disclosed to the user through a privacy policy.

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-10-11T06:04:53.427

Collecting *anonymous* usage should be doable without screenshots.

If your app collects *any* data that is meant to be protected by privacy laws, then you will have to treat the screenshots as containing sensitive information and protect them accordingly. Data protection laws are pretty strict in most countries.

Unless you have a really really small company, privacy laws vary a lot between countries, and the feature is probably more trouble than it's worth. In any country I've even lived in, that idea would never fly.

But don't ask a bunch of hacks on a site like stack overflow. Seriously, ask a lawyer.

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-10-11T06:33:44.070

I think the question is still a bit vague as to who is going to be monitored for what. From what I understand who'll be monitored are the end users who are using the application and the gathered data will be used internally. Assuming this is the case, I think, I can contribute the following answer:

If you are going to monitor end users to see how they are using your product, you are in human factors/user experience business and what you want to do is really an experiment. Doing such an experiment requires **consent** of the **subject** (the end user). In an academic setting (and I think the same goes for industry as well), there is an Institutional Review Board (IRB) which grants permission for such experiments. I believe in the industry scene there are similar organizations (just not sure what they are called). A request for permission for such an experiment is accompanied by a report which details the user experiment in a very specific manner. The IRB than decides whether to issue a permit or not.

The important point is the consent here and users should know about the experiment and agree to be subjects. I think, in the absence of a user consent the experiment is neither ethical nor legal. Again, I approached this based on an assumption and tried to summarize my experience in such experiments.

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2009-10-05T05:41:28.867

即使通知员工，收集屏幕截图也可能是非法的。这是当地法律和联邦法律的问题。你没有说你在哪个国家。例如，在加利福尼亚，监控屏幕可能违反工作场所隐私法和窃听法。在实施此之前，您应该征求公司律师的意见。

# flash - 什么会导致这种突变的 Flash 显示？

> ID：136807
> 
> 赞同：0
> 
> 时间：2008-09-25T23:17:32.447
> 
> 标签：flash, internet-explorer, firefox, video, cross-browser

我有一个奇怪的跨浏览器闪存问题。请看下面的截图。我以前见过这种行为，但我不记得原因是什么。有人可以告诉我为什么会发生这种情况，以及我可以采取哪些措施来解决它？

![ie7和firefox中的flash问题](https://i.stack.imgur.com/KDy17.png "问题")

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-26T12:29:22.190

肯定需要更多信息才能给出完整的答案。

<开始完整猜测>

看来 IE flash player 版本不够高，无法正常播放 flash 文件。看起来它正在加载第一帧（其中布置了所有资产以帮助预加载）。然后，应该播放电影的 Actionscript 由于 Flash 播放器版本不正确而失败。因此，文件停留在第 1 帧。

</结束完整猜测>

您的播放器检测/包含脚本应捕获此类情况，并为没有足够高版本的 Flash 播放器的用户提供替代内容。为此使用[SWFObject 。](http://code.google.com/p/swfobject/)请务必将 SWFObject 代码设置为需要发布文件的 Flash 版本。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T03:24:52.040

您需要告诉我们每个浏览器使用的 Flash 版本是什么？IE 可以使用较新的版本或 firefox。据我了解，flash 是每个浏览器都有自己的内部插件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T21:02:19.157

正如 81bronco 建议的那样，这是由于我的嵌入不当造成的。我开始使用 SWFObject，一切都很好！

# .net - 从 SQL Server 存储过程或函数引用 .NET 程序集

> ID：136818
> 
> 赞同：4
> 
> 时间：2008-09-25T23:19:30.447
> 
> 标签：.net, sql-server, stored-procedures, clr

是否可以从 SQL Server 存储过程或函数引用 .NET 程序集，或者以其他方式从 SQL Server 访问 clr 代码？

**编辑**虽然这个解决方案需要有点通用，但我相当有信心期待 SQL 2005+

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-25T23:26:44.937

这取决于您的 SQL Server 版本。SQL Server 2005 及更高版本支持 CLR 存储过程。如果您有旧版本，则需要将程序集注册为 COM 类（使用对象/方法/程序集上的属性），然后使用 regasm 注册它。然后，您可以像调用任何其他 COM 对象一样调用它。

[http://dn.codegear.com/article/32754](http://dn.codegear.com/article/32754)

虽然 SQL 6.5 有点错误（偶尔会泄漏内存），所以您可能需要将它注册为 COM+ 组件（根据我的经验）。这可能无法阻止内存泄漏，但它可以帮助防止“找不到类”错误。我不确定为什么它会出现在 6.5

[http://msdn.microsoft.com/en-us/library/ms189763.aspx](http://msdn.microsoft.com/en-us/library/ms189763.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-25T23:22:33.747

你确实可以。

[这里](http://blogs.msdn.com/sqlclr/archive/2006/06/29/651644.aspx)有一些信息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-25T23:23:41.340

[CLR 存储过程](http://msdn.microsoft.com/en-us/library/ms131094.aspx)

需要 Sql Server 2005 或更高版本。

# reporting - 如何解决此错误：授予用户“COMPUTERNAME\\ASPNET”的权限不足以执行此操作。(rsAccessDenied)

> ID：136823
> 
> 赞同：5
> 
> 时间：2008-09-25T23:20:15.873
> 
> 标签：reporting

我正在尝试将 SSRS 报告集成到我的网页中。代码如下：

```
ReportViewer1.ProcessingMode = rocessingMode.Remote;
ReportViewer1.ServerReport.ReportServerUrl = new Uri("http://localhost/reportserver");
ReportViewer1.ServerReport.ReportPath = "/Report Project1/Reconciliation";
List<ReportParameter> paramList = new List<ReportParameter>();
paramList.Add(new ReportParameter("StartDate", startdate.ToString(), false));
paramList.Add(new ReportParameter("EndDate", enddate.ToString(), false));
this.ReportViewer1.ServerReport.SetParameters(paramList);
ReportViewer1.Visible = true; 
```

当我尝试运行此报告时出现此错误：

```
The permissions granted to user 'COMPUTERNAME\\ASPNET' are insufficient for performing this operation. (rsAccessDenied)"}   
System.Exception {Microsoft.Reporting.WebForms.ReportServerException} 
```

谁能告诉我我做错了什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-06T09:23:21.687

稍微澄清一下 Erikk 的回答。

您要设置以修复此错误的特定安全权限集（报告管理器中至少还有另外两种类型的安全设置）在您所在的报告文件夹的“属性”选项卡的“安全”菜单选项中可用看着。

显然，您不应该对主文件夹的“所有人”组授予完全权限，因为这会继承给所有其他项目和子文件夹并打开一个巨大的安全漏洞。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T00:21:15.307

您需要授予 Web 应用访问报告的权限。转到您的报告管理器 ( [http://servername/reports/](http://servername/reports/) )。我通常只是将整个 Web 服务器的“浏览器”权限授予报告。

您的服务器的帐户名称通常是 Domain\servername$。因此，如果您的服务器名称是“webserver01”并且您的域是 Acme，您将授予帐户 Acme\servername$ 浏览器权限。

我认为您还可以通过在运行报告的 Web 应用程序上禁用匿名访问（在 IIS 中）来修复它，这样报告服务将使用用户凭据而不是 ASPNET 帐户进行身份验证。但这对您来说可能不是一个可行的解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T23:25:40.853

问题是您的 ASP.NET 工作进程没有执行您想要的操作的权限。

在服务器（MACHINENAME\ASPNET）上编辑这个用户，并给它更多的权限（它可能需要写权限等）。

您还需要将 MACHINENAME\ASPNET 作为用户添加到 SSRS 正在使用的 SQL 数据库。

# c# - 如何以编程方式检查项目中是否使用了变量？

> ID：136829
> 
> 赞同：7
> 
> 时间：2008-09-25T23:21:23.250
> 
> 标签：c#, .net, vb.net, add-in, envdte

在 VB.NET（或 C#）中，如何以编程方式确定类 helper.vb 中的公共变量是否在项目中的任何位置使用？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T23:26:39.463

查找所有参考资料是您的朋友。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T21:00:59.247

来自[MSDN](http://msdn.microsoft.com/en-us/library/aa300858(VS.71).aspx)

Find 对象允许您在支持此类操作的环境中搜索和替换文本，例如代码编辑器。

它主要用于宏录制目的。编辑器的宏记录机制使用 Find 而不是 TextSelection.FindPattern 以便您可以发现全局查找功能，并且因为它通常比使用 TextSelection 对象更有用，例如在文件中查找等操作。

如果搜索操作是异步的，例如 Find All，则**FindDone**事件会在操作完成时发生。

```
Sub ActionExample()
   Dim objFind As Find = objTextDoc.DTE.Find

   ' Set the find options.
   objFind.Action = vsFindAction.vsFindActionFindAll
   objFind.Backwards = False
   objFind.FilesOfType = "*.vb"
   objFind.FindWhat = "<Variable>"
   objFind.KeepModifiedDocumentsOpen = False
   objFind.MatchCase = True
   objFind.MatchInHiddenText = True
   objFind.MatchWholeWord = True
   objFind.PatternSyntax = vsFindPatternSyntax.vsFindPatternSyntaxLiteral
   objFind.ResultsLocation = vsFindResultsLocation.vsFindResultsNone
   objFind.SearchPath = "c:\<Your>\<Project>\<Path>"
   objFind.SearchSubfolders = False
   objFind.Target = vsFindTarget.vsFindTargetCurrentDocument
   ' Perform the Find operation.
   objFind.Execute()
End Sub

<System.ContextStaticAttribute()> _
Public WithEvents FindEvents As EnvDTE.FindEvents

Public Sub FindEvents_FindDone(ByVal Result As EnvDTE.vsFindResult, _
                               ByVal Cancelled As Boolean) _
                               Handles FindEvents.FindDone
   Select Case Result 
        case vsFindResultFound
             'Found!
        case else
             'Not Found
   Ens select
End Sub 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T23:24:26.130

您将需要使用反射，这会很复杂。

为什么要以编程方式执行此操作？您知道 Visual Studio 有一个“查找所有引用”功能可以为您完成这项工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T23:27:54.187

反射器具有分析功能。或者，这是您追求的某种运行时功能吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T00:26:14.280

你是说在编译代码之前这样做吗？[尽管像Mono.Cecil](http://www.mono-project.com/Cecil)这样的工具可以提供帮助，但对已编译的程序集执行此操作可能并非易事。您必须实际遍历每个方法并检查 IL 指令以调用相关属性的 get 和 set 方法。但实际上它可能并没有那么糟糕，特别是如果您使用 Cecil 而不是 System.Reflection。Cecil 也快得多，因为它将程序集视为文件，而不是将它们实际加载到应用程序域中。

如果您想在项目的实际源代码上运行它，情况会大不相同。我对 Visual Studio 加载项了解不多，但您可能能够以编程方式调用“查找所有引用”命令并使用结果。

System.CodeDom 中可能还有一些可以提供帮助的东西。看起来您可以使用 a`CodeParser`将代码解析为 a `CodeCompileUnit`，然后从那里遍历所有方法中的所有语句并检查相关`CodePropertyReferenceExpression`的 s。

# java - 在 Java 中选择随机种子的跨平台方法是什么？

> ID：136831
> 
> 赞同：4
> 
> 时间：2008-09-25T23:21:48.570
> 
> 标签：java, random, cross-platform, random-seed

阅读此答案后： [从集合中选择随机子集的最佳方法？](https://stackoverflow.com/questions/136474/best-way-to-pick-a-random-subset-from-a-collection#136513)

这让我想知道，如何在 Java 中选择随机种子？

不要说使用 System.currentTimeMillis() 或 System.nanoTime()。阅读文章，看看为什么不。

这是一个很难的问题，但让我把它变得更难。假设您需要在不连接到互联网、不使用用户输入（IE，没有 gui）的情况下生成随机种子，并且它必须是跨平台的（因此没有 JNI 来访问硬件）。

是否有一些我们可以监控的 JVM 变量作为随机性的来源？

这可以做到吗？还是不可能？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-25T23:28:03.313

看看[Uncommons Maths](https://uncommons-maths.dev.java.net)（完全披露：我写的）。它应该可以解决您在 Java 中遇到的大多数随机数问题。

甚至，如果您不使用它，您应该能够从它提供的各种[SeedGenerator实现中获得一些想法。](https://uncommons-maths.dev.java.net/nonav/api/org/uncommons/maths/random/SeedGenerator.html)基本上，它默认使用[/dev/random](http://en.wikipedia.org/wiki/Urandom)。如果不存在（例如 Windows），它要么尝试从[random.org](http://www.random.org)下载数据，要么使用[SecureRandom.generateSeed](http://java.sun.com/javase/6/docs/api/java/security/SecureRandom.html#generateSeed(int))。

我认为 SecureRandom.generateSeed 是您在不依赖任何特定平台或 Internet 的情况下可以做到的最好的方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-25T23:35:55.867

`System.currentTimeMillis()`与每次生成种子时递增的全局计数器结合使用。使用[AtomicLong](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/atomic/AtomicLong.html)作为计数器，这样您就可以提高效率和线程安全性。

“组合”并不意味着“添加”或“异或”，因为它太容易得到重复。相反，哈希。您可能会变得复杂，将 long 和计数器填充到例如 16 字节和 MD5 中，但我可能会使用 Adler CRC 或其他一些[64 位 CRC](http://dev.isb-sib.ch/projects/expasy4j/api/org/expasy/core/util/CRC64.html)的 64 位版本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T13:10:46.303

嗯，那篇文章说 32 位种子不好，但 64 位种子很好。System.currentTimeMillis() 是 64 位种子。

# c# - C# 数组初始化 - 具有非默认值

> ID：136836
> 
> 赞同：33
> 
> 时间：2008-09-25T23:22:34.090
> 
> 标签：c#, .net

您知道在 C# 中初始化动态大小数组的最巧妙方法是什么？

这是我能想到的最好的

```
private bool[] GetPageNumbersToLink(IPagedResult result)
{
   if (result.TotalPages <= 9)
      return new bool[result.TotalPages + 1].Select(b => true).ToArray();

   ... 
```

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2009-06-26T20:49:35.170

如果“最流畅”的意思是最快的，恐怕**Enumerable.Repeat**可能比**for**循环慢 20 倍。请参阅[http://dotnetperls.com/initialize-array](http://dotnetperls.com/initialize-array)：

```
Initialize with for loop:             85 ms  [much faster]
Initialize with Enumerable.Repeat:  1645 ms 
```

所以使用 Dotnetguy 的 SetAllValues() 方法。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2008-09-26T00:56:09.200

使用[Enumerable.Repeat](http://msdn.microsoft.com/en-us/library/bb348899%28v=vs.110%29.aspx)

```
Enumerable.Repeat(true, result.TotalPages + 1).ToArray() 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-09-26T00:46:02.407

*编辑：正如评论者指出的那样，我最初的实现不起作用。此版本有效，但基于 for 循环相当不灵活。*

如果你愿意创建一个扩展方法，你可以试试这个

```
public static T[] SetAllValues<T>(this T[] array, T value) where T : struct
{
    for (int i = 0; i < array.Length; i++)
        array[i] = value;

    return array;
} 
```

然后像这样调用它

```
bool[] tenTrueBoolsInAnArray = new bool[10].SetAllValues(true); 
```

作为替代方案，如果您对上课感到满意，您可以尝试这样的事情

```
public static class ArrayOf<T>
{
    public static T[] Create(int size, T initialValue)
    {
        T[] array = (T[])Array.CreateInstance(typeof(T), size);
        for (int i = 0; i < array.Length; i++)
            array[i] = initialValue;
        return array;
    }
} 
```

你可以调用它

```
bool[] tenTrueBoolsInAnArray = ArrayOf<bool>.Create(10, true); 
```

不确定我更喜欢哪个，尽管我通常会大量使用扩展方法。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-26T00:34:19.847

我实际上建议这样做：

```
return Enumerable.Range(0, count).Select(x => true).ToArray(); 
```

这样你只分配一个数组。这本质上是一种更简洁的表达方式：

```
var array = new bool[count];

for(var i = 0; i < count; i++) {
   array[i] = true;
}

return array; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-10-09T11:37:19.090

很多时候你想用不同的值初始化不同的单元格：

```
public static void Init<T>(this T[] arr, Func<int, T> factory)
{
    for (int i = 0; i < arr.Length; i++)
    {
        arr[i] = factory(i);
    }
} 
```

或工厂风味：

```
public static T[] GenerateInitializedArray<T>(int size, Func<int, T> factory)
{
    var arr = new T[size];
    for (int i = 0; i < arr.Length; i++)
    {
        arr[i] = factory(i);
    }
    return arr;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-25T23:36:39.203

未经测试，但你能做到这一点吗？

```
return result.Select(p => true).ToArray(); 
```

跳过“new bool []”部分？

# security - 如何确保用户只登录一次？

> ID：136837
> 
> 赞同：8
> 
> 时间：2008-09-25T23:22:52.980
> 
> 标签：security

几年前，我开发了一个 Web 应用程序，我们希望确保用户不共享凭据。

我们决定做的一件事是，一次只允许用户从一台计算机登录。我这样做的方法是每 N 秒有一个小的 iframe ping 服务器；只要服务器对特定用户（来自特定 IP）有心跳，就不允许该用户从任何其他 IP 登录。

这个解决方案虽然得到了我的经理的批准，但对我来说总是很老套。此外，它似乎很容易规避。

有没有一种好方法可以确保 Web 应用用户只登录一次？老实说，我从来不明白为什么管理层甚至想要这个功能。在分布式应用程序上强制执行此操作是否有意义？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-25T23:31:09.153

我通过维护当前登录用户的哈希表来实现这一点，键是用户名，值是他们的最后活动时间。

登录时，您只需检查此哈希表中的密钥，如果存在，则拒绝登录。

当用户做任何事情时，您会随时间更新哈希表（如果您将其作为核心页面框架的一部分，这很容易）。

如果哈希表中的时间超过 20 分钟不活动，则将其删除。您可以在每次检查哈希表时执行此操作，因此即使您只有一个用户，并且在几个小时后尝试登录，在初始检查期间，它也会将其从哈希表中删除，因为它们处于空闲状态。

C# 中的一些示例（未经测试）：

```
public Dictionary<String,DateTime> UserDictionary
{
    get
    {
        if (HttpContext.Current.Cache["UserDictionary"] != null)
        {
            return HttpContext.Current.Cache["UserDictionary"] as Dictionary<String,DateTime>;
        }
        return new Dictionary<String,DateTime>();
    }
    set
    {
        HttpContext.Current.Cache["UserDictionary"] = value;
    }
}

public bool IsUserAlreadyLoggedIn(string userName)
{
    removeIdleUsers();
    return UserDictionary.ContainsKey(userName);
}

public void UpdateUser(string userName)
{
    UserDictionary[userName] = DateTime.Now;

    removeIdleUsers();
}

private void removeIdleUsers()
{
   for (int i = 0; i < UserDictionary.Length; i++)
        {
            if (user[i].Value < DateTime.Now.AddMinutes(-20))
                user.RemoveAt(i);
        }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T10:20:22.153

我会扭转这个问题，并允许最后一次登录以牺牲任何先前的登录为代价，因此每当用户登录时，终止他可能拥有的任何其他登录会话。

这更容易实现，并且您最终知道自己在哪里。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-26T12:15:07.157

在开发过这样的“功能”后，请注意——这是一个边缘案例的大象陷阱，你最终认为你已经确定了它，然后你或其他人说“但是如果有人做了 X 怎么办？” 你意识到你必须增加另一层复杂性。

例如：

*   如果用户打开一个带有会话副本的新选项卡怎么办？
*   如果用户打开一个新的浏览器窗口怎么办？
*   如果用户登录并且他们的浏览器崩溃了怎么办？

等等...

基本上有一系列或多或少的hacky解决方案，没有一个是万无一失的，所有这些都将难以维护。通常客户端的真正目标是一些其他合法的安全目标，例如“阻止用户共享帐户”。

最好的办法是找出根本目标是什么，并找到一种方法来实现它。而且恐怕这涉及谈判外交和其他此类“软技能”，而不是开始技术上的野鹅追逐......，

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-26T00:10:09.513

只看 IP 可能不可靠。IIRC 有一些代理风格，可以通过多个 IP 地址随机发送传出请求。根据您的应用范围，这可能会或可能不会影响您。其他代理将显示来自单个 IP 的大量流量。

上次登录时间也可能是一个问题。考虑基于 cookie 的身份验证，其中身份验证 cookie 不是持久的（一件好事）。如果浏览器崩溃或关闭，用户必须重新登录，但在超时到期之前不能登录。如果该应用程序是用于交易股票的，那么 20 分钟不工作会花钱，而且可能是不可接受的。

通常可以购买智能防火墙/路由器，它们的性能比你或我一次性的要好。它们还有助于防止重放攻击、cookie 窃取等，并且可以配置为与您选择的 Web 平台中的标准机制一起运行。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-25T23:27:23.220

在高度安全的应用程序中，您可能需要这样做。您可以做的是保持登录计数增加登录用户和 IP 地址的计数。计数永远不应该是 2。如果是，那么您将另一个 IP 注销，而无论它登录到该 IP 的人都会被丢弃。这不会阻止用户 1 将他的凭据提供给用户 2，如果用户 2 同时登录其他地方，只会让用户 1 做他的工作感到沮丧。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-25T23:27:32.550

我从来没有找到这个问题的标准解决方案。在我的一个应用程序中，我使用了 Javascript + Java 的组合来确保用户只能从指定的 IP 登录一次（实际上它是一个会话 ID），但在最坏的情况下，超时（设置为2 分钟）该帐户不可用。我不明白为什么没有一种通用的方法来做到这一点。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-26T01:37:40.350

我刚遇到这个问题。

我们正在构建一个包含 Flex 应用程序（由客户构建）的 Drupal 站点，他想要以下内容：

1.  来自 Drupal<->Flex 的透明登录（哎呀！）
2.  没有并发登录！

他测试了每个解决方案的废话，最后，这就是我们所做的：

*   我们通过每个 URL 传递会话 ID。
*   当用户登录时，我们建立了一个 timestamp-IP-SessionID-Username 足迹
*   每个页面，数据库都被 ping 通，如果在同一个 IP 上发现同一个用户，但 SessionID 不同，那么他们的老用户就会被引导

这个解决方案满足了我们客户的严格测试（他家里有两台电脑......在我们找到这个解决方案之前，他让我们在代码中找到了几个小时的小角落和缝隙）

# .net - 你在使用 BizTalk 吗？如果是这样，你是如何使用它的？

> ID：136856
> 
> 赞同：15
> 
> 时间：2008-09-25T23:26:29.243
> 
> 标签：.net, biztalk

在我上一个工作的地方，我经常使用 BTS。然而，我注意到经理们经常想将它用于错误的事情，而开发人员对采用它犹豫不决。

所以，我只是想知道，如何使用 BTS？请发表经验，而不是理论。谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T10:47:50.183

我曾在欧洲最大的石油/能源公司之一担任顾问，他们基本上使用 BizTalk 进行所有消息传递/集成。示例包括：以不同格式发送给合作伙伴的发票（电子发票）、AD 和第三方软件之间的同步作业（维护其自己的用户名 db）以及支持系统和外部客户之间通过电子邮件进行的集成。因此，他们广泛采用了 BizTalk，并使用了一个由 5 个服务器组成的集群。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T01:07:07.800

我们有几十个需要交互的应用程序。我们有一个基于 Web 服务的应用程序，它控制系统之间的消息传递。其他系统通过 BizTalk 编排等与它通信并从它接收消息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T03:58:32.117

我们确实使用 BizTalk 连接到第三方订购系统。我可能会将其归类为使用 BizTalk 似乎提供的大量功能的有用但初学者的方法。我的意思是我们只使用了一小部分功能。它是这样的：

*   编排轮询第三方 IBM 消息队列。
*   此队列包含我们最终需要导入 Microsoft SQL Server 数据库的订单信息（xml 格式）。
*   从队列中接收到 xml 后，我们运行 xslt 转换以将 xml 转换为我们的系统可以理解的格式。
*   使用翻译后的 xml，我们最终调用了一个存储过程，该过程执行订单的实际“导入”。

该解决方案最终运行良好，并且已经投入生产几年了。这是行之有效的事情*之一。*

我要注意的一件事是，在开发此功能时，我们尝试使用 Mapper 工具来帮助我们完成翻译部分。我们的翻译非常复杂，而且工具本身使用起来非常乏味。由于我们对 xslt 感到满意，因此我们最终编写了自己的而不使用图形 Mapper 工具。似乎 Mapper 工具对于简单的翻译非常有用，但任何超过少数元素的东西都开始成为维护的噩梦（恕我直言）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T10:53:37.907

过去，我曾在 B2B 环境中将 BT (2004) 用于电子商务目的（订购、订单确认、交货通知等），并且效果非常好。这可能是 BT 的基础，因为它是它在组织中最明显的位置。

这些天来，我（几乎）参与了一个完全内部的 BT 项目，该项目最初处理从遗留系统到新应用程序的大量数据加载，然后将处理另一个遗留应用程序和同一个新系统之间的消息传递。可能不是最有效的技术使用，但现在基础设施已经到位，可以实现被视为“我们业务的救星”的企业服务总线类型的架构。不过，我还没有相信这种想法。:S

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-01-28T19:18:30.133

我们目前在我们公司使用 BizTalk 2006 将来自 Commerce Server 2007 实例的订单和所有运行 Dynamics RMS 的商店主机传送到我们的主要 ERP、Dynamics NAV。BizTalk 无疑是一个强大的解决方案，但我确实认为学习曲线相当陡峭，并且同意 StackOverflow 上的其他人所说的它是 Microsoft 生产的最复杂的服务器。

对于它所做的事情，它是坚如磐石的，如果系统曾经出现过问题，它一直在链的一端或另一端，但从来没有与 BizTalk。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-04-21T02:32:23.493

我们使用 BizTalk 2006 从各种来源和各种类型（CSV、固定宽度、XML）导入大小数据文件。我认为 BizTalk 的一大特色是它的平面文件反汇编器。您可以使用向导描述平面文件的构成，并且此表示形式存储为 XML 模式定义 (.XSD)。该向导甚至允许您根据行本身的某些指示符破译可能包含不同类型（以及因此长度）行的单个文件。酷的东西。

-克里普

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-10-18T21:10:17.897

在我的公司，我们使用 BizTalk 作为大型文档翻译引擎。我们为供应链文档进行 EDI、XML 和平面文件处理。我们在文档代理场景中进行操作，并使用 BT 接收任何格式的文档，然后将它们转换为任何其他格式以发送给任何贸易伙伴。

因此，我们不是每对两个贸易伙伴都进行 EDI 入职练习，而是让每个贸易伙伴按照他们的规范入职，然后使用我们的翻译引擎来确保他们能够以静态格式发送和接收他们的文档。在内部，我们将它们的格式映射到规范模式，然后在彼此之间即插即用贸易伙伴。考虑一个中心辐射型文档网络。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-20T21:20:14.633

个人开发用于：

采购：处理医院对不同制造公司的采购请求。这些公司会将不同的 xml 请求发送到不同的公司，每个制造商都有自己的风格。然后，所有购买也被制作成 html/xslt 报告（内部收据），显示以什么价格购买的东西。

HL7：一次处理大量正在处理的 HL7 文件（认为它被设置为一次处理 4 个），处理并放入当天的新文件夹中。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-20T09:13:14.727

我使用 HL7 Accelerator 开发了一些 Hl7 解决方案，管理索赔申请系统的工作流程，使用通用的消息路由方法在不同系统之间进行集成等。

所有的乐趣和大量的工作......;-D

# c++ - 向我推销 const 正确性

> ID：136880
> 
> 赞同：151
> 
> 时间：2008-09-25T23:34:21.270
> 
> 标签：c++, const-correctness

那么为什么总是建议尽可能多地使用 const 呢？在我看来，使用 const 可能比 C++ 中的帮助更痛苦。但话又说回来，我是从 python 的角度来看的：如果你不想改变某些东西，就不要改变它。话虽如此，这里有几个问题：

1.  似乎每次我将某些东西标记为 const 时，我都会收到一个错误，并且必须在某个地方将其他一些函数也更改为 const。然后这导致我不得不在其他地方更改*另一个功能。*有了经验，这会变得更容易吗？

2.  使用 const 的好处*真的*足以弥补麻烦吗？如果你不打算改变一个对象，为什么不写不改变它的代码呢？

我应该注意到，在这个时间点上，我最关注的是使用 const 来实现正确性和可维护性的好处，尽管了解性能影响也很好。

* * *

## 回答 #1

> 赞同：170
> 
> 时间：2008-09-25T23:40:30.943

这是关于“const 正确性”的权威文章：[https](https://isocpp.org/wiki/faq/const-correctness) ://isocpp.org/wiki/faq/const-correctness 。

简而言之，使用 const 是一种很好的做法，因为...

1.  它可以防止您意外更改不打算更改的变量，
2.  它可以防止您进行意外的变量分配，并且
3.  编译器可以对其进行优化。例如，您受到保护

    ```
    if( x = y ) // whoops, meant if( x == y ) 
    ```

同时，编译器可以生成更高效的代码，因为它始终准确地知道变量/函数的状态。如果您正在编写紧凑的 C++ 代码，这很好。

您是正确的，因为很难始终如一地使用 const-correctness，但最终代码更简洁，更安全。当您进行大量 C++ 开发时，这样做的好处很快就会显现出来。

* * *

## 回答 #2

> 赞同：136
> 
> 时间：2008-09-25T23:37:05.100

这是一段带有常见错误的代码， const 正确性可以保护您免受以下错误的影响：

```
void foo(const int DEFCON)
{
   if (DEFCON = 1)     //< FLAGGED AS COMPILER ERROR! WORLD SAVED!
   {
       fire_missiles();
   }
} 
```

* * *

## 回答 #3

> 赞同：67
> 
> 时间：2008-09-26T00:19:29.583

> 似乎每次我将某些东西标记为 const 时，我都会收到一个错误，并且必须在某个地方将其他一些函数也更改为 const。然后这导致我不得不在其他地方更改另一个功能。有了经验，这会变得更容易吗？

根据经验，这完全是一个神话。当非 const-correct 与 const-correct 代码一起出现时，肯定会发生这种情况。如果您从一开始就设计 const-correct，那么这永远不会成为问题。如果你做了一个 const 的东西，然后其他的东西没有编译，编译器告诉你一些非常重要的东西，你应该花时间**正确地**修复它。

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2008-09-27T00:03:11.180

如果您严格使用 const，您会惊讶于大多数函数中的实变量很少。通常不超过一个循环计数器。如果你的代码达到了那个点，你会感到内心温暖……编译验证……函数式编程领域就在附近……你现在几乎可以触摸它了……

* * *

## 回答 #5

> 赞同：32
> 
> 时间：2008-09-25T23:37:59.670

当您最初编写代码时，它不适合您。它是为其他人（或几个月后的你）准备的，他们正在查看类或接口中的方法声明以查看它的作用。不修改对象是从中收集的重要信息。

* * *

## 回答 #6

> 赞同：23
> 
> 时间：2008-09-26T02:24:55.710

const 是您作为开发人员所做的承诺，并在执行时寻求编译器的帮助。

我是 const 正确的原因：

*   它与您的函数的客户沟通，您不会更改变量或对象
*   通过 const 引用接受参数为您提供了按引用传递的效率和按值传递的安全性。
*   将您的接口编写为 const 正确将使客户能够使用它们。如果您编写接口以接受非 const 引用，则使用 const 的客户将需要放弃 const 才能与您合作。如果您的界面接受非 const char*，并且您的客户正在使用 std::strings，这尤其令人讨厌，因为您只能从它们那里获得 const char*。
*   使用 const 将使编译器保持诚实，这样您就不会错误地更改不应更改的内容。

* * *

## 回答 #7

> 赞同：22
> 
> 时间：2008-09-26T08:00:52.330

没有 const 的 C++ 编程就像开车没有系安全带一样。

每次上车都系上安全带很痛苦，365 天中有 364 天你会安全到达。

唯一的区别是，当您的汽车遇到问题时，您会立即感觉到，而在没有 const 的情况下进行编程，您可能不得不搜索两周导致崩溃的原因，结果却发现您无意中弄乱了一个函数参数您通过非常量引用以提高效率。

* * *

## 回答 #8

> 赞同：21
> 
> 时间：2008-09-26T00:54:20.703

我的理念是，如果您要使用带有编译时检查的挑剔语言，而不是充分利用它。 `const`是一种编译器强制执行的方式来传达您的***意思***……它比注释或 doxygen 更好。你付出了代价，为什么不得出价值呢？

* * *

## 回答 #9

> 赞同：20
> 
> 时间：2008-09-26T03:30:20.890

对于嵌入式编程，`const`在声明全局数据结构时明智地使用可以通过使常量数据位于 ROM 或闪存中而无需在引导时复制到 RAM 来节省大量 RAM。

在日常编程中，`const`谨慎使用可以帮助您避免编写崩溃或行为不可预测的程序，因为它们试图修改字符串文字和其他常量全局数据。

在大型项目中与其他程序员合作时，`const`正确使用有助于防止其他程序员限制您。

* * *

## 回答 #10

> 赞同：15
> 
> 时间：2009-12-09T02:40:20.023

const 正确性是从一开始就真正需要到位的事情之一。正如您所发现的，以后添加它会很痛苦，尤其是当您添加的新函数和已经存在的旧的非常量正确函数之间存在很多依赖关系时。

在我编写的许多代码中，确实值得付出努力，因为我们倾向于大量使用组合：

```
class A { ... }
class B { A m_a; const A& getA() const { return m_a; } }; 
```

如果我们没有 const 正确性，那么您将不得不求助于按值返回复杂对象，以确保没有人在您背后操纵 B 类的内部状态。

简而言之，const-correctness 是一种防御性编程机制，可以让您免于痛苦。

* * *

## 回答 #11

> 赞同：13
> 
> 时间：2008-09-25T23:45:13.660

`const`帮助您隔离在您背后“改变事物”的代码。因此，在一个类中，您会将所有不会更改对象状态的方法标记为`const`. 这意味着`const`该类的实例将不再能够调用任何非`const`方法。这样，您就不会意外调用可以更改对象的功能。

此外，`const`它是重载机制的一部分，因此您可以拥有两个具有相同签名的方法，但一个有`const`一个没有。一个`const`被称为`const`引用，另一个被称为非`const`引用。

例子：

```
#include <iostream>

class HelloWorld {
    bool hw_called;

public:
    HelloWorld() : hw_called(false) {}

    void hw() const {
        std::cout << "Hello, world! (const)\n";
        // hw_called = true;  <-- not allowed
    }

    void hw() {
        std::cout << "Hello, world! (non-const)\n";
        hw_called = true;
    }
};

int
main()
{
    HelloWorld hw;
    HelloWorld* phw1(&hw);
    HelloWorld const* phw2(&hw);

    hw.hw();    // calls non-const version
    phw1->hw(); // calls non-const version
    phw2->hw(); // calls const version
    return 0;
} 
```

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2008-09-26T03:46:24.283

假设您在 Python 中有一个变量。你知道你不*应该*修改它。万一不小心做了怎么办？

C++ 为您提供了一种方法来保护自己免于意外地做一些原本不应该做的事情。从技术上讲，无论如何您都可以绕过它，但是您必须付出额外的努力才能射击自己。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2008-09-25T23:37:30.607

[这里](http://duramecho.com/ComputerInformation/WhyHowCppConst.html)有一篇关于 C++ 中 const的好文章。这是一个非常直截了当的意见，但希望它对一些人有所帮助。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2008-09-26T00:07:01.597

当您使用“const”关键字时，您正在为您的类指定另一个接口。有一个接口包含所有方法，一个接口只包含 const 方法。显然，这使您可以限制对某些您不想更改的内容的访问。

是的，随着时间的推移，它确实变得更容易了。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-09-26T00:01:19.083

我喜欢 const 正确性……理论上。每次我尝试在实践中严格应用它时，它最终都会崩溃，并且 const_cast 开始使代码变得丑陋。

也许这只是我使用的设计模式，但 const 最终总是过于宽泛。

例如，想象一个简单的数据库引擎……它有模式对象、表、字段等。用户可能有一个“const Table”指针，这意味着他们不允许修改表模式本身……但是如何操作与表关联的数据？如果 Insert() 方法被标记为 const，那么在内部它必须放弃 const 才能实际操作数据库。如果它没有被标记为 const 那么它就不能防止调用 AddField 方法。

也许答案是根据 const-ness 要求将类拆分，但这往往会使设计变得比我想要的更复杂，因为它带来的好处。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-26T03:59:30.647

您也可以使用 const 给编译器提示......根据以下代码

```
#include <string>

void f(const std::string& s)
{

}
void x( std::string& x)
{
}
void main()
{
    f("blah");
    x("blah");   // won't compile...
} 
```

# html - 我如何同时（1）保持一个 从占用所有可用宽度和（2）使其与邻居折叠边距？

> ID：136884
> 
> 赞同：0
> 
> 时间：2008-09-25T23:35:10.657
> 
> 标签：html, css

是否可以`<div>`同时 (1) 不占用所有可用宽度和 (2) 与其邻居一起折叠边距？

我最近了解到，设置 a `div`to`display:table`将阻止它扩展以占据父容器的整个宽度——但现在我意识到这引入了一个新问题：它停止与它的邻居折叠边距。

在下面的示例中，红色 div 无法折叠，而蓝色 div 太宽。

```
<p style="margin:100px">This is a paragraph with 100px margin all around.</p>

<div style="margin: 100px; border: solid red 2px; display: table;">
  This is a div with 100px margin all around and display:table.
  <br/>
  The problem is that it doesn't collapse margins with its neighbors.
</div>

<p style="margin:100px">This is a paragraph with 100px margin all around.</p>

<div style="margin: 100px; border: solid blue 2px; display: block;">
  This is a div with 100px margin all around and display:block.
  <br/>
  The problem is that it expands to take up all available width.
</div>

<p style="margin:100px">This is a paragraph with 100px margin all around.</p> 
```

有没有办法同时满足这两个标准？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-25T23:41:10.440

您可以`display: table` `div`用另一个`div`包装并将边距放在包装纸`div`上。讨厌，但它的工作原理。

```
<p style="margin:100px">This is a paragraph with 100px margin all around.</p>

<div style="margin: 100px"><div style="border: solid red 2px; display: table;">
  This is a div which had 100px margin all around and display:table, but the margin was moved to a wrapper div.
  <br/>
  The problem was that it didn't collapse margins with its neighbors.
</div></div>

<p style="margin:100px">This is a paragraph with 100px margin all around.</p>

<div style="margin: 100px; border: solid blue 2px; display: block;">
  This is a div with 100px margin all around and display:block.
  <br/>
  The problem is that it expands to take up all available width.
</div>

<p style="margin:100px">This is a paragraph with 100px margin all around.</p> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T02:25:29.750

我可能只是浮动 div （这样它就不会占用可用宽度），然后在必要时随后清除浮动。

```
<p style="margin:100px">This is a paragraph with 100px margin all around.</p>

<div style="border: solid red 2px; float: left;">
  This should work.
</div>

<p style="margin:100px;clear:both;">This is a paragraph with 100px margin all around.</p> 
```

# php - 在 PHP 中使用 @ 运算符抑制错误

> ID：136899
> 
> 赞同：74
> 
> 时间：2008-09-25T23:37:41.637
> 
> 标签：php, operators, error-suppression

在您看来，使用 @ 运算符来抑制 PHP 中的错误/警告是否有效，而您可能正在处理错误？

如果是这样，你会在什么情况下使用它？

欢迎使用代码示例。

编辑：回复者注意。我不想关闭错误报告，但是，例如，通常的做法是使用

```
@fopen($file); 
```

然后检查......但你可以通过做摆脱@

```
if (file_exists($file))
{
    fopen($file);
}
else
{
    die('File not found');
} 
```

或类似的。

我想问题是 - 是否有任何地方可以使用 @ 来抑制错误，而不能以任何其他方式处理？

* * *

## 回答 #1

> 赞同：125
> 
> 时间：2009-06-06T18:47:48.237

注意：首先，我意识到 99% 的 PHP 开发人员使用错误抑制运算符（我曾经是其中之一），所以我希望任何看到这一点的 PHP 开发人员不同意。

> 在您看来，使用 @ 运算符来抑制 PHP 中的错误/警告是否有效，而您可能正在处理错误？

**简短的回答：**
不！

**更长更正确的答案：**
我不知道，因为我不知道一切，但到目前为止，我还没有遇到过这是一个很好的解决方案的情况。

**为什么不好：**
在我认为使用 PHP 大约 7 年的时间里，我已经看到了由错误抑制运算符引起的无休止的调试痛苦，并且从未遇到过不可避免的情况。

问题是您正在抑制错误的那段代码目前可能只会导致您看到的错误；但是，当您更改被抑制的行所依赖的代码或它运行的环境时，该行很有可能会尝试输出与您试图忽略的错误完全不同的错误。那么你如何追踪一个没有输出的错误呢？欢迎来到调试地狱！

我花了很多年才意识到由于被压制的错误，我每几个月浪费了多少时间。大多数情况下（但并非唯一）这是在安装第三方脚本/应用程序/库之后，该脚本/应用程序/库在开发人员环境中没有错误，但不是我的，因为 php 或服务器配置差异或缺少通常会立即输出错误的依赖项提醒问题是什么，但不是当开发人员添加魔术@时。

**替代方案（取决于情况和期望的结果）：**
处理您知道的实际错误，以便如果一段代码将导致某个错误，那么它不会在该特定情况下运行。但我认为你得到了这一部分，你只是担心最终用户会看到错误，这就是我现在要解决的问题。

对于常规错误，您可以设置错误处理程序，以便在您查看页面时以您希望的方式输出它们，但对最终用户隐藏并记录下来，以便您知道用户触发了哪些错误。

对于在您的 php.ini 中设置为关闭的致命错误`display_errors`（您的错误处理程序仍会被触发）并启用错误日志记录。如果您有一个开发服务器和一个实时服务器（我推荐），那么在您的开发服务器上不需要执行此步骤，因此您仍然可以调试这些致命错误，而无需查看错误日志文件。甚至还有一个[技巧可以使用关闭函数](http://www.php.net/manual/en/function.set-error-handler.php#88401)将大量致命错误发送到您的错误处理程序。

**总结：**
请避免。这可能有一个很好的理由，但我还没有看到一个，所以直到那一天，我认为 (@) 错误抑制运算符是邪恶的。

如果您想了解更多信息，可以阅读[我在 PHP 手册中的错误控制运算符页面上的评论。](http://php.net/operators.errorcontrol#90987)

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2008-09-26T07:11:09.597

我会压制错误**并处理它**。否则，您可能会遇到**TOCTOU**问题（检查时间、使用时间。例如，文件可能在 file_exists 返回 true 之后但在 fopen 之前被删除）。

但我不会仅仅压制错误以使它们消失。这些最好是可见的。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-09-25T23:39:33.940

是的，压制是有道理的。

例如，如果文件无法打开，则该`fopen()`命令返回。`FALSE`这很好，但它*也会*产生 PHP 警告消息。通常你不想要警告——你会`FALSE`自己检查。

事实上[PHP 手册](http://us3.php.net/function.fopen)特别建议在这种情况下使用 @ ！

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-09-26T04:07:41.563

如果您不想在使用 fopen() 之类的函数时引发警告，则可以抑制错误但使用异常：

```
try {
    if (($fp = @fopen($filename, "r")) == false) {
        throw new Exception;
    } else {
        do_file_stuff();
    }
} catch (Exception $e) {
    handle_exception();
} 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-09-25T23:51:46.813

*除非您知道*可以处理所有条件，否则应避免错误抑制。

这可能比最初看起来要困难得多。

您真正应该做的是依靠 php 的“error_log”作为您的报告方法，因为您不能依靠查看页面的用户来报告错误。（并且您还应该禁止 php 显示这些错误）

然后，至少您将获得系统中所有问题的综合报告。

如果您确实必须处理错误，则可以创建自定义错误处理程序

[http://php.net/set-error-handler](http://php.net/set-error-handler)

然后，您可能会发送异常（可以处理）并做任何需要向管理人员报告奇怪错误的事情。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-07-15T20:51:08.417

我从不允许自己使用'@'...句号。

当我在代码中发现“@”的用法时，我会添加注释以使其在使用时以及在使用它的函数周围的文档块中都非常明显。由于这种错误抑制，我也被“追鬼”调试所困扰，我希望通过在我发现它时突出显示它的用法来使下一个人更容易。

如果我希望我自己的代码在原生 PHP 函数遇到错误时抛出异常，并且 '@' 似乎是一种简单的方法，我会选择做一些其他的事情来获得相同的结果，但是（再次）在代码中显而易见：

```
$orig = error_reporting(); // capture original error level
error_reporting(0);        // suppress all errors
$result = native_func();   // native_func() is expected to return FALSE when it errors
error_reporting($orig);    // restore error reporting to its original level
if (false === $result) { throw new Exception('native_func() failed'); } 
```

只需编写更多代码：

```
$result = @native_func(); 
```

但我更喜欢让我的压制需要非常明显，为了跟随我的可怜的调试灵魂。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2010-10-06T08:12:34.747

大多数人不理解错误信息的含义。
不开玩笑。他们中的大多数。

他们认为错误消息都是一样的，说“出了点问题！”
他们懒得去读。
虽然它是错误消息中最重要的部分——不仅仅是它被提出的事实，而是它的意义。它可以告诉你*出了什么*问题。错误消息是为了帮助，而不是为了“如何隐藏它？”来打扰您。问题。这是新手网络编程世界中最大的误解之一。

因此，人们应该*阅读*它所说的内容，而不是扼杀错误信息。它不仅有一个“找不到文件”值。可能有数千个不同的错误：`permission denied`, `save mode restriction`,`open_basedir restriction`等等。每一项都需要采取适当的行动。**但如果你堵嘴，你永远不会知道发生了什么！**

**OP 将错误报告**与错误**处理**搞乱了，但差别很大！
错误处理是针对用户的。“发生了什么事”在这里就足够了。
虽然错误报告适用于程序员，但他们迫切需要知道肯定发生了什么。

因此，永远不要堵嘴错误消息。既为程序员**记录它，又为用户****处理它**。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-25T23:45:49.353

有没有办法抑制 php.ini 警告和错误？在这种情况下，您只能调试更改标志而不尝试发现隐藏问题的@。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-26T00:03:14.273

使用 @ 有时会适得其反。根据我的经验，您应该始终在 php.ini 中关闭错误报告或调用

```
error_reporting(0); 
```

在生产现场。这样，当您在开发中时，您只需注释掉该行并保持错误可见以进行调试。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-26T01:22:50.603

我使用它的一个地方是在套接字代码中，例如，如果你设置了一个超时，如果你不包含@，你会收到一个警告，即使不获取数据包是有效的。

```
$data_len = @socket_recvfrom( $sock, $buffer, 512, 0, $remote_host, $remote_port ) 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-07-21T00:12:16.617

我真正需要使用它的唯一地方是 eval 函数。eval 的问题在于，当由于语法错误而无法解析字符串时，eval 不会返回 false，而是会抛出错误，就像在常规脚本中出现解析错误一样。为了检查存储在字符串中的脚本是否可解析，您可以使用以下内容：

```
$script_ok = @eval('return true; '.$script); 
```

AFAIK，这是最优雅的方式。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2020-03-27T13:04:32.147

PHP 中的一些函数会发出一个`E_NOTICE`（例如反[序列化](https://www.php.net/manual/en/function.unserialize)函数）。

捕获该错误的一种可能方法（对于[PHP 版本 7+](https://www.php.net/manual/en/language.errors.php7.php)）是**将所有发出的错误转换为异常**，而不是让它发出`E_NOTICE`. 我们可以按如下方式更改异常错误处理程序：

```
function exception_error_handler($severity, $message, $file, $line) {                                                                       
    throw new ErrorException($message, 0, $severity, $file, $line);          
}                                                                            

set_error_handler('exception_error_handler');                          

try {             
    unserialize('foo');
} catch(\Exception $e) {
    // ... will throw the exception here
} 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2019-02-13T06:25:23.810

今天我遇到了一个问题，这是一个很好的例子，说明何时可能至少暂时使用 @ 运算符。

长话短说，我发现登录信息（纯文本的用户名和密码）写入错误日志跟踪。

这里有更多关于这个问题的信息。

登录逻辑属于它自己的一类，因为系统应该提供不同的登录机制。由于服务器迁移问题，发生了错误。该错误将整个跟踪转储到错误日志中，包括密码信息！一种方法期望用户名和密码作为参数，因此 trace 将所有内容忠实地写入错误日志。

这里的长期解决方案是重构所述类，而不是将用户名和密码用作 2 个参数，例如使用包含这 2 个值的单个数组参数（在这种情况下，跟踪将为参数写出 Array）。还有其他方法可以解决这个问题，但这是一个完全不同的问题。

无论如何。跟踪消息很有帮助，但在这种情况下是完全有害的。

当我注意到跟踪输出时，我学到的教训是：有时暂时抑制错误消息是避免进一步伤害的有用的权宜之计。

在我看来，我不认为这是一个糟糕的类设计案例。错误本身是由 PDOException（从 MySQL 5.6 到 5.7 的时间戳问题）触发的，PHP 默认将所有内容都转储到错误日志中。

一般来说，由于其他评论中解释的所有原因，我不使用 @ 运算符，但在这种情况下，错误日志说服我快速做一些事情，直到问题得到正确解决。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-25T23:48:30.720

您不想压制所有内容，因为它会减慢您的脚本速度。

是的，在 php.ini 和您的脚本中都有一种方法可以删除错误（但只有在您处于实时环境中并从 php 记录错误时才这样做）

```
<?php
    error_reporting(0);
?> 
```

你可以阅读[这个](http://is2.php.net/manual/en/errorfunc.configuration.php#ini.display-errors)关于关闭它的 php.ini 版本。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2021-05-14T21:17:07.887

我有一个我认为是使用@进行错误抑制的有效用例。

我有两个系统，一个运行 PHP 5.6.something，另一个运行 PHP 7.3.something。我想要一个能在它们两个上正常运行的脚本，但有些东西在 PHP 5.6 中不存在，所以我使用了诸如 random_compat 之类的[polyfill](https://github.com/paragonie/random_compat)。

最好使用内置函数，所以我的代码如下所示：

```
if(function_exists("random_bytes")) {
    $bytes = random_bytes(32);
} else {
    @include "random_compat/random.php"; // Suppress warnings+errors
    if(function_exists("random_bytes")) {
        $bytes = random_bytes(32);
    } else if(function_exists('openssl_random_pseudo_bytes')) {
        $bytes = openssl_random_pseudo_bytes(4);
    } else {
        // Boooo! We have to generate crappy randomness
        $bytes = substr(str_shuffle(str_repeat('ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',64)),0,32);
    }
} 
```

回退到 polyfill 永远不会产生任何错误或警告。在尝试加载 polyfill 后，我正在检查该函数是否存在，这是所有必要的。甚至还有一个后备的后备。和一个后备到后备的后备。

没有办法避免`include`（例如使用`file_exists`）的潜在错误，所以唯一的方法是抑制警告并检查它是否有效。至少，在这种情况下。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-02-16T11:18:47.060

如果您正在使用自定义错误处理函数并想抑制错误（可能是已知错误），请使用此方法。在这种情况下使用“@”不是一个好主意，因为如果设置了错误处理程序，它不会抑制错误。

编写3个函数并像这样调用。

```
# supress error for this statement
supress_error_start();  
$mail_sent = mail($EmailTo, $Subject, $message,$headers);
supress_error_end(); #Don't forgot to call this to restore error.  

function supress_error_start(){
    set_error_handler('nothing');
    error_reporting(0);
}

function supress_error_end(){
    set_error_handler('my_err_handler');
    error_reporting('Set this to a value of your choice');
}

function nothing(){ #Empty function
}

function my_err_handler('arguments will come here'){
      //Your own error handling routines will come here
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2021-07-05T22:57:06.857

我可以想到一种使用情况，用于自动增加不存在的数组键。

```
$totalCars = [];

$totalCars['toyota']++; // PHP Notice:  Undefined index: toyota

@$totalCars['toyota']++;
// [
//    "toyota" => 2,
// ] 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2021-12-02T09:55:32.607

根据我的经验，我会说一般来说，错误抑制对于未来的开发人员来说只是另一种不好的做法，应该尽可能避免，因为它隐藏了错误的复杂性并防止错误记录，而 Exception 可以帮助开发人员获得错误快照。但是回答说“**如果是这样，你会在什么情况下使用它？** ”的原始问题。

我会说应该将它用于一些不会引发异常错误的遗留代码或库，而是通过将错误变量与其对象（说到 OOP）或使用全局变量来记录错误或仅打印错误来处理错误错误全部一起。

以 mysqli 对象为例

```
new mysqli($this->host, $this->username, $this->password, $this->db); 
```

上面的这段代码几乎不会或从不会在连接失败时抛出异常，它只将错误存储在`mysqli::errno`和`mysli::error`

对于现代编码，我发现的一种解决方案是抑制丑陋的错误消息（这对任何人都没有帮助，尤其是在调试模式关闭的生产服务器上），而开发人员应该抛出自己的异常。这是考虑现代实践并帮助编码人员更快地跟踪错误。

```
 $this->connection = @new mysqli($this->host, $this->username, $this->password, $this->db);
  if($this->connection->connect_errno)
      throw new mysqli_sql_exception($this->connection->error); 
```

您可以注意到使用抑制`@`符号来防止在开发服务器上打开错误显示时出现难看的错误显示。

我也不得不抛出我自己的异常。这样我就可以使用`@`符号，同时我没有隐藏错误，也没有自己猜测错误可能是什么。

我会说，如果使用得当，那是有道理的。

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2008-09-25T23:52:48.993

我在尝试加载 HTML 文件以作为 DOMDocument 对象进行处理时使用它。如果 HTML 中有任何问题...而哪个网站*至少没有一个*... DOMDocument->loadHTMLFile() 如果您不使用 @ 禁止它，则会抛出错误。这是我在 PHP 中成功创建 HTML 抓取工具的唯一方法（也许有更好的方法）。

# dll - dll获取配置信息的最佳方式？

> ID：136901
> 
> 赞同：0
> 
> 时间：2008-09-25T23:38:13.973
> 
> 标签：dll, configuration

我们开发了许多由第三方 Windows 应用程序调用的自定义 dll。这些 dll 会根据需要加载/卸载。

大多数 dll 调用 Web 服务，这些需要配置 url、超时等。

因为 dll 不是永久保存在内存中的，所以每次调用它都必须读取配置。这对我来说似乎不是最理想的。

有没有更好的方法来处理这个？

注意：可配置信息位于 xml 文件中，以便 IT 部门可以根据需要进行更改。他们不会接受注册表编辑。

注意：这些 dll 为许多第三方应用程序提供服务，它本质上实现了一个外部 EDMS 接口。供应商不接受传递所需的参数。

注意：这是一个 .NET 应用程序，dll 是用 C# 编写的。本质上，当需要执行某种 EDMS 操作时，有厚（Windows 应用程序）和瘦客户端访问此 dll。EDMS 接口被定义为必须在 dll 中实现的一组调用，而 dll 决定如何实现 EDMS 功能，例如对于某些客户端，“注册文档”将更新数据库，而对于其他客户端，相同的调用将使用第三方EDMS系统。没有 ASP 客户端。

我的理解是当客户端想要访问 EDMS 操作时加载 dll，然后在调用完成时卸载。客户端可能暂时不需要执行另一个 EDMS 操作（在某些情况下超过一个小时）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-25T23:40:36.137

使用注册表来存储您的配置信息，它绝对足够快。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T23:50:20.747

我认为您需要提供更多信息。持久化配置信息有很多方法。我们甚至不知道开发平台。。网？

1.  除非我确定它始终可用，否则我不会依赖注册表。您可能会在客户端机器上侥幸逃脱，但您已经提到了 Web 服务。

2.  当前目录中的 XML 文件现在似乎对于服务器端第三方 dll 非常流行。但这些配置是可选的。

3.  如果这是 ASP，那么在选择配置持久性方法时，您的[信任级别](http://msdn.microsoft.com/en-us/library/ms998341.aspx)将非常重要。

4.  您也许可以使用您的应用程序服务器的“应用程序范围”。在应用程序的每个生命周期中加载一次。如果您的 DLL 检测到它也需要，它可以使该数据无效。

5.  我使用文本文件、XML 文件、数据库、各种 IPC（如共享内存段、应用程序范围）来保存配置信息。这在很大程度上取决于您的项目的具体情况。

想进一步详细说明吗？

编辑。考虑到您的说明，我会使用 XML 文件。此自定义 XML 文件将使用已预定义和记录的搜索路径加载。如果这是 ASP.Net，您可以使用 Server.MapPath() 例如检查各种文件夹，如 App_Data。不过，DLL 将首先检查当前目录中的配置文件。然后，您可以使用一个“管理器”线程来保存配置数据并将其传递给需要它的任何子线程。共享可以像共享内存段一样使用IPC。

这看起来很麻烦，但是您必须将信息存储在某个范围内……来自磁盘、内存（应用程序范围、会话范围、DLL 全局范围、另一个进程/IPC 等）

ASP.Net 还使您能够将[自定义配置部分](http://aspnet.4guysfromrolla.com/articles/020707-1.aspx)添加到标准配置文件，如 web.config。您可以随意访问这些部分，它们将不依赖于您的 DLL 的加载时间。

为什么您认为您的 DLL 正在从内存中删除？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T23:41:56.790

你为什么不让调用应用程序用你需要的东西填写一个数据结构呢？可以作为初始化调用的一部分完成。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T23:50:59.903

dll多久被卸载一次？COM dll 可以通过 DllCanUnload 方法控制何时卸载它们。如果这些是 COM 组件，您可以在此处查看实现某种超时以防止频繁加载和卸载。除非 dll 以很高的频率重新加载配置，否则它不太可能成为真正的性能瓶颈。

知道 dll 将在某些点重新加载其配置是一个有用的功能，因为它可以防止用户想知道他们是否必须重新启动主机进程、重新启动机器等才能使配置生效。您甚至可以查看文件的更改以使其保持最新状态。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T04:40:46.367

我认为 DLL 获取配置信息的最佳方式是通过使用它的应用程序 - 通过隐式的“Init”调用，如 Nils 建议的那样，或者通过它们的配置文件。

DLL 通常不应该“配置自己”，因为它们永远无法确定它们在哪个上下文中使用。不同的用户（如在应用程序中）可能需要进行不同的配置设置。

既然你说应用程序是用 .NET 编写的，你可能应该简单地要求他们将你的 DLL 函数的必要配置放在*他们的*配置文件（“whatever.exe.config”）中，并通过 AppSettings 甚至从你的 DLL 访问它通过自定义配置部分更好。

此外，您可能希望在可能的情况下为设置提供合理的默认值（尽管可能不是网络地址）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T04:48:32.557

如果仅每隔 1 小时左右从内存中加载和卸载 dll，则由于 mslal 初始化（读取文件/注册表）导致的效率低下将可以忽略不计。

但是，如果这种情况更频繁，则更高的低效率将是加载和卸载 dll 的物理操作。这可能比小的初始化效率低得多。

因此，最好将它们固定在内存中。这样，在加载时执行的初始化不会重复，并且您还可以避免加载和卸载的低效率。您以这种方式解决了 2 个问题。

我可以告诉你如何在 C++ 中做到这一点。不确定您将如何在 C# 中执行此操作。GetModuleHandle + 对此句柄进行额外的 LoadLibrary 调用是我在 C++ 中执行此操作的方式。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-01-23T12:02:25.997

一种方法是在 DLL 中有一个接口来指定所需的设置。

然后由“应用程序项目”来拥有一个实现此接口的类，并在启动时将其传递给 DLL，这使您可以根据项目自由更改实现。一个可能从 web.config 读取，而另一个从 DB 读取。

# layout - 使用 DojoX Layout，是否可以替换布局的内容？

> ID：136928
> 
> 赞同：0
> 
> 时间：2008-09-25T23:42:15.057
> 
> 标签：layout, dojo

我有一个 div，其中使用 DojoX 布局功能加载了一个页面：

```
<div dojoType="dojox.layout.ContentPane"
                 adjustPaths="true"
                 renderStyles="true"
                 executeScripts="true"
                 href="my/page/containing/scripts/and/styles/in/a/sub/folder.html">
                Initial content, will be replace by href.
                paths in folder.html will be adjusted to match this page
        </div> 
```

是否有一个 API 可以用来稍后将这个 div 的内容替换为来自另一个页面的其他内容（其他 URI）？

亚历克斯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T00:26:06.260

在 div 上添加一个 id（比如 id="myPane"），然后写：

```
dijit.byId("myPane").setHref("path/page.html"); 
```

亚历克斯

# javascript - 有没有办法在javascript中捕获后退按钮事件？

> ID：136937
> 
> 赞同：61
> 
> 时间：2008-09-25T23:45:13.380
> 
> 标签：javascript

当只有位置哈希发生变化时，有没有办法在javascript中响应被点击的后退按钮（或被按下的退格键）？也就是说当浏览器没有与服务器通信或重新加载页面时。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-09-25T23:50:48.703

使用[`hashchange`](https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers.onhashchange)事件：

```
window.addEventListener("hashchange", function(e) {
  // ...
}) 
```

如果您需要支持旧版浏览器，请查看 Modernizr 的 HTML5 Cross Browser Polyfills wiki 页面中的[`hashChange`事件部分](https://github.com/Modernizr/Modernizr/wiki/HTML5-Cross-Browser-Polyfills#hashchange-event)。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2010-02-27T16:38:06.797

我创建了一个可能对某些人有用的[解决方案。](http://www.bajb.net/2010/02/browser-back-button-detection/)只需在您的页面上包含代码，您就可以编写自己的函数，该函数将在单击后退按钮时调用。

我已经在 IE、FF、Chrome 和 Safari 中进行了测试，并且都可以正常工作。我在 IE 和 FF 中基于 iframe 工作的解决方案无需持续轮询，但是，由于其他浏览器的限制，在 Safari 中使用位置哈希。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-02-23T02:06:35.737

我做了一个有趣的 hack 来解决这个问题，让我很满意。我有一个动态加载内容的 AJAX 站点，然后修改 window.location.hash，并且我有代码在 $(document).ready() 上运行以解析哈希并加载适当的部分。问题是我对用于导航的部分加载代码非常满意，但想添加一种方法来拦截浏览器的后退和前进按钮，这会改变窗口位置，但不会干扰我当前操作的页面加载例程window.location，并且以恒定的时间间隔轮询 window.location 是不可能的。

我最终做的是这样创建一个对象：

```
var pageload = {
    ignorehashchange: false,
    loadUrl: function(){
        if (pageload.ignorehashchange == false){
            //code to parse window.location.hash and load content
        };
    }
}; 
```

然后，我在我的站点脚本中添加了一行以在[hashchange](https://developer.mozilla.org/en/DOM/window.onhashchange "hashchange")事件时运行该`pageload.loadUrl`函数，如下所示：

```
window.addEventListener("hashchange", pageload.loadUrl, false); 
```

然后，每当我想修改`window.location.hash`而不触发此页面加载例程时，我只需在每行之前添加以下`window.location.hash =`行：

```
pageload.ignorehashchange = true; 
```

然后在每个哈希修改行之后的以下行：

```
setTimeout(function(){pageload.ignorehashchange = false;}, 100); 
```

所以现在我的部分加载例程通常正在运行，但是如果用户点击“后退”或“前进”按钮，则会解析新位置并加载相应的部分。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-07-17T19:33:10.510

查看[history.js](https://github.com/balupton/History.js/)。有一个 html 5 statechange 事件，你可以收听它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-25T23:48:53.700

`onLocationChange`也可能有用。不确定这是否是 Mozilla 独有的东西，但似乎它可能是。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-25T23:52:47.263

你看过这个吗？[http://developer.yahoo.com/yui/history/](http://developer.yahoo.com/yui/history/)

# c++ - 枚举和定义语句之间的区别

> ID：136946
> 
> 赞同：51
> 
> 时间：2008-09-25T23:47:24.047
> 
> 标签：c++, c, enums, c-preprocessor

在 C/C++ 中使用 define 语句和 enum 语句有什么区别（在 C 或 C++ 中使用它们时有什么区别）？

例如，什么时候应该使用

```
enum {BUFFER = 1234}; 
```

超过

```
#define BUFFER 1234 
```

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2008-09-25T23:48:21.483

`enum`定义一个句法元素。

`#define`是预处理器指令，在编译器看到代码*之前*执行，因此不是 C 本身的语言元素。

一般来说，枚举是首选，因为它们是类型安全的并且更容易被发现。定义更难定位并且可能具有复杂的行为，例如一段代码可以重新定义`#define`另一段代码。这可能很难追踪。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-09-25T23:58:00.137

`#define`语句在编译器查看代码之前由预处理器处理，因此它基本上是文本替换（实际上使用参数等更智能）。

枚举是 C 语言本身的一部分，具有以下优点。

1/ 它们可能有类型，编译器可以对它们进行类型检查。

2/ 由于它们对编译器可用，它们的符号信息可以传递给调试器，使调试更容易。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-25T23:53:15.857

定义是一个预处理命令，它就像在你的编辑器中做“全部替换”一样，它可以用另一个字符串替换一个字符串然后编译结果。

枚举是类型的一种特殊情况，例如，如果你写：

```
enum ERROR_TYPES
{
   REGULAR_ERR =1,
   OK =0
} 
```

存在一种称为 ERROR_TYPES 的新类型。REGULAR_ERR 确实会产生 1，但从这种类型转换为 int 应该会产生转换警告（如果您将编译器配置为高详细度）。

总结：它们都是相似的，但是当使用 enum 时，您可以从类型检查中受益，而通过使用定义，您只需替换代码字符串。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-26T00:26:40.677

在使用枚举有意义的地方，枚举通常比#define 更受欢迎：

*   `enum`调试器可以向您显示s 值的符号名称（“ `openType: OpenExisting`”，而不是“ `openType: 2`”
*   您可以从名称冲突中获得更多保护，但这并没有以前那么糟糕（大多数编译器警告`#define`reition.

最大的区别是您可以使用枚举作为类型：

```
// Yeah, dumb example
enum OpenType {
    OpenExisting,
    OpenOrCreate,
    Truncate
};

void OpenFile(const char* filename, OpenType openType, int bufferSize); 
```

这使您可以对参数进行类型检查（您不能轻易混淆 openType 和 bufferSize），并且可以轻松找到有效的值，从而使您的接口更易于使用。一些 IDE 甚至可以为您提供~~智能感知~~代码完成功能！

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-06-14T07:28:26.213

如果可能，最好使用枚举。使用枚举为编译器提供了有关您的源代码的更多信息，编译器永远不会看到预处理器定义，因此携带的信息更少。

例如，为了实现例如一堆模式，使用枚举使编译器可以捕获`case`开关中缺失的语句。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2010-06-14T07:34:02.987

enum 可以将多个元素归为一类：

```
enum fruits{ apple=1234, orange=12345}; 
```

而#define 只能创建不相关的常量：

```
#define apple 1234
#define orange 12345 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-06-14T07:38:51.803

**#define 是一个预处理命令，枚举是 C 或 C++ 语言。**

对于这种情况，使用枚举而不是#define 总是更好。一件事是类型安全。另一个是当你有一个值序列时，你只需要在枚举中给出序列的开头，其他值就会得到连续的值。

```
enum {
  ONE = 1,
  TWO,
  THREE,
  FOUR
}; 
```

代替

```
#define ONE 1
#define TWO 2
#define THREE 3
#define FOUR 4 
```

作为旁注，在某些情况下您可能必须使用#define（通常对于某种宏，如果您需要能够构造一个包含常量的标识符），但这是一种宏黑魔法，而且非常非常难得是要走的路。如果你走到这些极端，你可能应该使用 C++ 模板（但如果你被 C 卡住了......）。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-06-14T07:31:38.870

如果你只想要这个单一的常量（比如缓冲区大小），那么我不会使用枚举，而是使用定义。我会将枚举用于返回值（这意味着不同的错误条件）以及我们需要区分不同“类型”或“案例”的地方。在这种情况下，我们可以使用枚举来创建可以在函数原型等中使用的新类型，然后编译器可以更好地检查代码。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-06-14T07:42:55.930

除了所有已经写好的东西，一个说但没有显示，而是很有趣。例如

```
enum action { DO_JUMP, DO_TURNL, DO_TURNR, DO_STOP };
//...
void do_action( enum action anAction, info_t x ); 
```

将动作视为一种类型会使事情更清楚。使用define，你会写

```
void do_action(int anAction, info_t x); 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2010-06-14T07:53:50.817

对于整数常量值，我更`enum`喜欢`#define`. 使用似乎没有任何缺点`enum`（排除更多打字的微小缺点），但是您具有`enum`可以限定范围的优势，而`#define`标识符具有超越一切的全局范围。

使用`#define`通常不是问题，但由于没有缺点`enum`，我同意。

在 C++ 中，我通常也更喜欢`enum`即使`const int`在 C++ 中 a`const int`可以用来代替文字整数值（与 C 中不同），因为`enum`它可以移植到 C 中（我仍然在很多地方工作）。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-25T23:54:04.187

如果您有一组常量（例如“星期几”），则最好使用枚举，因为它表明它们是分组的；而且，正如 Jason 所说，它们是类型安全的。如果它是一个全局常量（如版本号），那更多的是你要使用的`#define`；虽然这是很多争论的主题。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-26T10:37:15.107

除了上面列出的优点之外，您还可以将枚举的范围限制为类、结构或命名空间。就个人而言，我喜欢在任何时候都在范围内拥有最少数量的相关符号，这是使用枚举而不是#defines 的另一个原因。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-29T01:32:22.510

枚举相对于定义列表的另一个优点是编译器（至少 gcc）可以在 switch 语句中未检查所有值时生成警告。例如：

```
enum {
    STATE_ONE,
    STATE_TWO,
    STATE_THREE
};

...

switch (state) {
case STATE_ONE:
    handle_state_one();
    break;
case STATE_TWO:
    handle_state_two();
    break;
}; 
```

在前面的代码中，编译器能够生成警告，指出并非枚举的所有值都在开关中处理。如果状态是按照#define 的方式完成的，则情况并非如此。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-06-14T07:30:08.013

枚举更多地用于枚举某种集合，例如一周中的几天。如果您只需要一个常数，`const int`（或双倍等）肯定会比枚举更好。我个人不喜欢`#define`（至少不喜欢某些常量的定义），因为它没有给我类型安全，但如果它更适合你，你当然可以使用它。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2010-06-14T08:13:50.890

创建枚举不仅会创建文字，还会创建对这些文字进行分组的类型：这为您的代码添加了编译器能够检查的语义。

此外，在使用调试器时，您可以访问枚举文字的值。#define 并非总是如此。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2016-07-20T11:00:50.957

虽然上面的几个答案出于各种原因建议使用枚举，但我想指出，在开发接口时使用定义具有实际优势。您可以引入新选项，并且可以让软件有条件地使用它们。

例如：

```
    #define OPT_X1 1 /* 在版本 1 中引入 */
    #define OPT_X2 2 /* 在版本 2 中引入 */

```

然后可以用它可以做的任何一个版本编译的软件

```
    #ifdef OPT_X2
    int 标志 = OPT_X2；
    ＃别的
    整数标志 = 0；
    ＃万一

```

在枚举时，如果没有运行时特征检测机制，这是不可能的。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2017-08-11T18:08:38.573

**枚举：**

**1.**一般用于多个值

**2.**在枚举中有两个东西一个是名称，另一个是名称的值 name 必须区分但 value 可以相同。如果我们不定义 value 那么 enum name 的第一个值是 0 秒value 为 1，依此类推，除非明确指定 value。

**3.**它们可能有类型，编译器可以对它们进行类型检查

**4.**使调试变得容易

**5.**我们可以将它的范围限制为一个类。

**定义：**

**1.**当我们只需要定义一个值时

**2.**一般将一个字符串替换为另一个字符串。

**3.**它的作用域是全局的，我们不能限制它的作用域

总的来说，我们必须使用枚举

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2014-06-23T13:38:31.227

差别不大。C 标准说枚举具有整数类型并且枚举常量是 int 类型，因此两者都可以与其他整数类型自由混合，而不会出错。（另一方面，如果在没有显式转换的情况下不允许这种混合，那么明智地使用枚举可能会发现某些编程错误。）

枚举的一些优点是数字值是自动分配的，调试器可以在检查枚举变量时显示符号值，并且它们服从块范围。（当枚举被不加选择地混合时，编译器也可能产生非致命警告，因为这样做仍然被认为是不好的风格，即使它不是严格非法的。）缺点是程序员几乎无法控制这些非致命警告。一些程序员也讨厌无法控制枚举变量的大小。

# windows - 启动已注册的 mime 助手应用程序

> ID：136948
> 
> 赞同：1
> 
> 时间：2008-09-25T23:47:38.210
> 
> 标签：windows, delphi, mime, mime-types

我曾经能够通过在 Windows 注册表中注册给定的 mime 类型来启动本地安装的帮助应用程序。这使我能够允许用户单击一次链接到我们内部浏览器应用程序的当前安装。这在 Internet Explorer 5（大部分时间）和 Firefox 中运行良好，但现在在 Internet Explorer 7 中不起作用。

传递给我的 shell/open/command 的文件名不是下载安装包的完整物理路径。IE给我的路径参数是

```
"C:\Document and Settings\chq-tomc\Local Settings\Temporary Internet Files\
  EIPortal_DEV_2_0_5_4[1].expd" 
```

`FileExists()`不幸的是，在调用或尝试创建`TFileStream`对象时，这不会解析为物理文件。

物理路径缺少 Internet Explorer 隐藏缓存子目录的 Internet 临时文件，`"Content.IE5\ALBKHO3Q"`其绝对路径将表示为

```
"C:\Document and Settings\chq-tomc\Local Settings\Temporary Internet Files\ 
  Content.IE5\ALBKHO3Q\EIPortal_DEV_2_0_5_4[1].expd" 
```

是的，子目录是由 IE 随机生成的，只要 IE 将完整路径传递给我的帮助应用程序，这不应该是一个问题，不幸的是它没有这样做。

mime 助手应用程序的安装不是问题。它由全球所有 10,000 多名用户的全球登录脚本安装/更新。只有当用户点击带有我们桌面浏览器应用程序安装链接的内部网页时，才会调用 mime 助手。该安装以 mime 类型的`"application/x-expeditors"`. `".expd"`/ mime 类型的注册`"application/x-expeditors"`看起来像这样。

```
[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\.expd] 
@="ExpeditorsInstaller"
"Content Type"="application/x-expeditors"

[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\ExpeditorsInstaller]
"EditFlags"=hex:00,00,01,00

[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\ExpeditorsInstaller\shell]

[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\ExpeditorsInstaller\shell\open]
@=""

[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\ExpeditorsInstaller\shell\open\command]
@="\"C:\\projects\\desktop2\\WebInstaller\\WebInstaller.exe\" \"%1\""

[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\MIME\Database\Content Type\application/x-expeditors]
"Extension"=".expd" 
```

我曾考虑枚举用户的所有 IE 缓存条目，但我会担心检查所有这些条目可能需要多长时间，或者我最终可能会在我正在寻找的当前条目之前找到一个较旧的缓存条目。但是，括号中的文件名后缀`"[n]"`可能是唯一键。

我尝试过wininet方法`GetUrlCacheEntryInfo`，但这需要URL，而不是IE传递的虚拟路径。

我希望有一个给定虚拟路径的 Shell 函数将交回物理路径。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-26T02:28:02.240

我相信IE创建的子目录是随机生成的，所以你不能保证它每次都被命名相同，而且我看到的注册表方法的问题是它只在文件仍然存在时才有效在缓存中...清空缓存将清除需要再次安装的文件。

将此助手安装到应用程序数据中不是更好吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T12:15:12.210

我对此不确定，但也许这可能会引导您朝着正确的方向前进：尝试使用 wininet DLL 中的 URL 缓存函数：[FindFirstUrlCacheEntry](http://msdn.microsoft.com/en-us/library/aa384026(VS.85).aspx)、[FindNextUrlCacheEntry](http://msdn.microsoft.com/en-us/library/aa384049(VS.85).aspx)、[FindCloseUrlCache](http://msdn.microsoft.com/en-us/library/aa384015(VS.85).aspx)进行枚举，并且当您找到本地文件名与给定路径匹配的条目时您可以使用[RetrieveUrlCacheEntryFile](http://msdn.microsoft.com/en-us/library/aa385365(VS.85).aspx)来检索文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-15T09:59:06.430

我正在使用带有 X-Appl 浏览器的类似系统来显示 WAML Web 应用程序，它运行良好。也许你应该看看他们是如何做到的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-06T12:42:38.803

看起来 iexplore 正在传递文件的外壳命名空间“名称”而不是文件系统名称。

我不认为有一个记录在案的方式可以在命令行上传递一个 shell 项 id - explorer 自己做，但是有编组考虑因素，因为 shell 项 id 是（指向）二进制数据结构，仅在单个中有效过程。

我可能会尝试做的是： 1\. 调用 SHGetDesktopFolder，它将返回 shell 命名空间的根 IShellFolder 对象。2\. 调用 IShellFolder::ParseDisplayName 将您获得的名称转换回 shell 项 id 列表。3\. 尝试带有 SHGDN_FORPARSING 标志的 IShellFolder::GetDisplayNameOF - 坦率地说，感觉就像我们刚刚绕了一圈又回到了我们开始的地方。因为我认为它的这个 API 最终负责返回“错误”的文件系统相对路径。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-23T22:22:56.060

一些后续行动来结束这个问题。

Turned out the real issue was how I was creating the file handle using TFileStream. I changed to open with **fmOpenRead or fmShareDenyWrite** which solved what turned out to be a file locking issue.

```
srcFile := TFileStream.Create(physicalFilename, fmOpenRead or fmShareDenyWrite);
```

# javascript - 在 jQuery 表单中，在 'beforeSubmit' 完成之前调用 'success'

> ID：136961
> 
> 赞同：1
> 
> 时间：2008-09-25T23:49:43.197
> 
> 标签：javascript, jquery, ajax

我正在使用 jQuery Form 插件上传图片。我已经分配了一个淡入淡出动画来发生`beforeSubmit`回调，但是当我在本地运行时，它没有时间在`success`调用函数之前完成。

我在`fade();`调用中使用了一个回调函数来确保一个淡入淡出在下一个开始之前完成，但这似乎并不能保证调用它的函数已经完成。

难道我做错了什么？`beforeSubmit`在提交ajax调用之前不应该完成吗？

这是两个回调：

提交前：

```
function prepImageArea() {
  if (userImage) {
    userImage.fadeOut(1500, function() {
      ajaxSpinner.fadeIn(1500);
    });
  }
} 
```

成功：

```
function imageUploaded(data) {
  var data = evalJson(data);
  userImage.attr('src', data.large_thumb);
  ajaxSpinner.fadeOut(1500, function() {
    userImage.fadeIn(1500);
  });
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T00:10:15.410

我认为您可能对那些淡入淡出动画太花哨了:)...在 beforeSubmit 中，fadeOut 已设置，但该函数立即返回导致提交发生。我猜上传是在 3 秒内发生的，导致新图像在您的动画完成之前出现。

所以如果你真的想要这个效果，那么你需要做图像淡出、微调器淡入，一旦完成就触发上传。像这样的东西：

```
if (userImage) {
  userImage.fadeOut(1500, function() {
    ajaxSpinner.fadeIn(1500, function(){
        //now trigger the upload and you don't need the before submit anymore
    });
  });
}
else {
   // trigger the upload right away
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T00:11:22.397

Even though the beforeSubmit callback is called before submitting the form, the userImage.fadeOut function is synchronous (i.e. it spawns a separate thread of execution to execute the fade animation then it continues execution) and it returns immediately. The fade animation takes 1.5 seconds to complete and as you are running on localhost the ajax response is returned faster than 1.5 seconds and thus you won't see the animation, in real world applications it mostly unlikely that ajax requests would take less than 1.5 seconds, so you are good :)

# c# - 是否已经添加了事件处理程序？

> ID：136975
> 
> 赞同：206
> 
> 时间：2008-09-25T23:53:29.430
> 
> 标签：c#, .net, asp.net

有没有办法判断事件处理程序是否已添加到对象中？我正在序列化一个对象列表进入/退出会话状态，这样我们就可以使用基于 SQL 的会话状态......当列表中的一个对象的属性发生更改时，它需要被标记，事件处理程序之前会妥善处理. 但是现在当对象被反序列化时，它没有得到事件处理程序。

有点恼火的是，我只是将事件处理程序添加到访问对象的 Get 属性中。它现在被调用了，这很好，除了它被调用了 5 次，所以我认为每次访问对象时处理程序都会不断添加。

忽略它真的足够安全，但我宁愿通过检查处理程序是否已经添加来让它更干净，所以我只这样做一次。

那可能吗？

编辑：我不一定完全控制添加了哪些事件处理程序，因此仅检查 null 是不够的。

* * *

## 回答 #1

> 赞同：245
> 
> 时间：2011-08-15T13:55:36.100

我最近遇到了类似的情况，我只需要为一个事件注册一次处理程序。我发现你可以安全地先注销，然后再注册，即使处理程序根本没有注册：

```
myClass.MyEvent -= MyHandler;
myClass.MyEvent += MyHandler; 
```

请注意，每次注册处理程序时都这样做将确保您的处理程序只注册一次。对我来说听起来是一个很好的做法:)

* * *

## 回答 #2

> 赞同：134
> 
> 时间：2008-09-25T23:58:55.593

`+=`正如@Telos 所提到的，从定义类之外，您只能在 a或 a的左侧使用 EventHandler `-=`。因此，如果您有能力修改定义类，您可以提供一种方法来通过检查事件处理程序是否是来执行检查`null`- 如果是，则没有添加事件处理程序。如果没有，那么也许你可以遍历 [Delegate.GetInvocationList](http://msdn.microsoft.com/en-us/library/system.delegate.getinvocationlist.aspx)中的值。如果一个等于您要添加为事件处理程序的委托，那么您知道它就在那里。

```
public bool IsEventHandlerRegistered(Delegate prospectiveHandler)
{   
    if ( this.EventHandler != null )
    {
        foreach ( Delegate existingHandler in this.EventHandler.GetInvocationList() )
        {
            if ( existingHandler == prospectiveHandler )
            {
                return true;
            }
        }
    }
    return false;
} 
```

这可以很容易地修改为“添加处理程序，如果它不存在”。如果您无法访问暴露事件的课程的内部信息，您可能需要按照@Lou Franco 的建议探索`-=`and 。`+=`

但是，您最好重新检查调试和停用这些对象的方式，看看您是否找不到自己跟踪这些信息的方法。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-09-25T23:58:11.320

如果这是唯一的处理程序，您可以检查事件是否为空，如果不是，则处理程序已添加。

我认为您可以使用处理程序安全地调用 -= 事件，即使它没有被添加（如果没有，你可以抓住它）——以确保它在添加之前不存在。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-26T00:29:42.040

此示例说明如何使用 GetInvocationList() 方法检索所有已添加的处理程序的委托。如果您要查看是否添加了特定的处理程序（函数），那么您可以使用数组。

```
public class MyClass
{
  event Action MyEvent;
}

...

MyClass myClass = new MyClass();
myClass.MyEvent += SomeFunction;

...

Action[] handlers = myClass.MyEvent.GetInvocationList(); //this will be an array of 1 in this example

Console.WriteLine(handlers[0].Method.Name);//prints the name of the method 
```

您可以检查委托的 Method 属性上的各种属性，以查看是否已添加特定函数。

如果您想查看是否只有一个附加，您可以测试 null。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-26T17:40:29.853

如果我正确理解您的问题，您可能会遇到更大的问题。您说其他对象可能订阅这些事件。当对象被序列化和反序列化时，其他对象（您无法控制的对象）将失去它们的事件处理程序。

如果您不担心这一点，那么保留对​​事件处理程序的引用就足够了。如果您担心其他对象丢失其事件处理程序的副作用，那么您可能需要重新考虑您的缓存策略。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2019-05-23T16:58:31.760

对我有用的唯一方法是创建一个布尔变量，当我添加事件时将其设置为 true。然后我问：如果变量为假，我添加事件。

```
bool alreadyAdded = false; 
```

这个变量可以是全局的。

```
if(!alreadyAdded)
{
    myClass.MyEvent += MyHandler;
    alreadyAdded = true;
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-03-23T10:25:33.117

我同意 alf 的回答，但对它的修改很少，使用，

```
 try
            {
                control_name.Click -= event_Click;
                main_browser.Document.Click += Document_Click;
            }
            catch(Exception exce)
            {
                main_browser.Document.Click += Document_Click;
            } 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-25T23:58:36.577

```
EventHandler.GetInvocationList().Length > 0 
```

# sql - 从另一个表的行批量更新一个表

> ID：136986
> 
> 赞同：8
> 
> 时间：2008-09-25T23:56:56.143
> 
> 标签：sql, sql-update

2张桌子：

```
Employees
- EmployeeID
- LeadCount

Leads
- leadID
- employeeID 
```

我想`Employees.LeadCount`通过计算`Leads`表中具有相同`EmployeeID`.

注意：可能有超过 1 个具有相同员工 ID 的潜在客户，所以我必须做一个`DISTINCT(SUM(employeeID))`.

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-26T00:02:12.653

```
UPDATE
    Employees E
SET
    E.LeadCount = (
        SELECT COUNT(L.EmployeeID)
        FROM Leads L
        WHERE L.EmployeeID = E.EmployeeID
    ) 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-26T00:26:29.630

您正在为数据同步问题做好准备。随着 Leads 表中的行被插入、更新或删除，您需要不断更新 Employees.LeadCount 列。

最好的解决方案是根本不存储 LeadCount 列，而是根据需要使用 SQL 聚合查询重新计算潜在客户数。这样它永远是正确的。

```
SELECT employeeID, COUNT(leadId) AS LeadCount
FROM Leads
GROUP BY employeeID; 
```

另一种解决方案是在 Leads 表上为 INSERT、UPDATE 和 DELETE 创建触发器，以便始终保持Employees.LeadCount 列最新。例如，使用 MySQL 触发器语法：

```
CREATE TRIGGER leadIns AFTER INSERT ON Leads
FOR EACH ROW BEGIN
  UPDATE Employees SET LeadCount = LeadCount + 1 WHERE employeeID = NEW.employeeID;
END

CREATE TRIGGER leadIns AFTER UPDATE ON Leads
FOR EACH ROW BEGIN
  UPDATE Employees SET LeadCount = LeadCount - 1 WHERE employeeID = OLD.employeeID;
  UPDATE Employees SET LeadCount = LeadCount + 1 WHERE employeeID = NEW.employeeID;
END

CREATE TRIGGER leadIns AFTER DELETE ON Leads
FOR EACH ROW BEGIN
  UPDATE Employees SET LeadCount = LeadCount - 1 WHERE employeeID = OLD.employeeID;
END 
```

如果您使用 MySQL，另一种选择是使用多表 UPDATE 语法。这是 SQL 的 MySQL 扩展，它不能移植到其他品牌的 RDBMS。首先，将所有行中的 LeadCount 重置为零，然后对 Leads 表进行连接，并在连接产生的每一行中增加 LeadCount。

```
UPDATE Employees SET LeadCount = 0;
UPDATE Employees AS e JOIN Leads AS l USING (employeeID)
  SET e.LeadCount = e.LeadCount+1; 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-26T00:24:13.660

连接对更新（和删除）的作用与对选择的作用相同（编辑：在一些流行的 RDBMS 中，至少*）：

```
UPDATE Employees SET
  LeadCount = Leads.LeadCount
FROM Employee
JOIN (
  SELECT EmployeeId, COUNT(*) as LeadCount 
  FROM Leads 
  GROUP BY EmployeeId
) as Leads ON
  Employee.EmployeeId = Leads.EmployeeId 
```

SUM(DISTINCT EmployeeId) 没有意义——你只需要一个 COUNT(*)。

*   MS SQL Server 支持[UPDATE...FROM](http://msdn.microsoft.com/en-us/library/ms177523.aspx)和[DELETE...FROM](http://msdn.microsoft.com/en-us/library/ms189835.aspx)语法，[MySql](http://dev.mysql.com/doc/refman/5.0/en/update.html)也是如此，但 SQL-92 标准不支持。SQL-92 会让您使用行表达式。我知道[DB2](http://publib.boulder.ibm.com/infocenter/db2v7luw/index.jsp?topic=/com.ibm.db2v7.doc/db2s0/sqls0645.htm)支持这种语法，但不确定是否有其他语法。坦率地说，我发现 SQL-92 版本令人困惑——但标准和理论专家会争辩说，FROM 语法违反了关系理论，并且在不精确的 JOIN 子句或切换 RDBMS 供应商时可能导致不可预测的结果。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-25T23:59:37.980

```
UPDATE Employees SET LeadCount = (
  SELECT Distinct(SUM(employeeID)) FROM Leads WHERE Leads.employeeId = Employees.employeeId
) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T00:08:54.133

从上面进行钢化并删除依赖的子查询。

```
// create tmp -> TBL (EmpID, count)

insert into TBL 
   SELECT employeeID COUNT(employeeID) Di
   FROM Leads WHERE Leads.employeeId = Employees.employeeId GROUP BY EmployeeId
UPDATE Employees SET LeadCount = (
  SELECT count FROM TBL WHERE TBL.EmpID = Employees.employeeId
)

// drop TBL 
```

**编辑**这是“group By”而不是“distinct”：b（感谢Mark Brackett）**************