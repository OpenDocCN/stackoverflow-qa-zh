# StackOverflow 问答 000741000-000741999

# c++ - 帮助将模板类的 intrusive_ptr 存储在 std::map 中

> ID：741000
> 
> 赞同：4
> 
> 时间：2009-04-11T23:50:56.050
> 
> 标签：c++, stl, boost, templates, typename

我有一个 Locker 类型的小型模板类，包含在我想存储在 std::map 中的 boost::intrusive_ptr 中：

```
template <typename T>
bool LockerManager<T>::
  AddData(const std::string& id, T* pData)
{

  boost::intrusive_ptr<Locker<T> > lPtr(Locker<T>(pData)); // Line 359 - compiles

  mMap.insert(make_pair(id, lPtr));  // Line 361 - gives error
} 
```

Locker 只是一个容器类；它的构造函数看起来像：

```
template <typename T>
Locker<T>::
  Locker(T* pData)
  : IntrusivePtrCountable(),
    mpData(pData),
    mThreadId(0),
    mDataRefCount(0)
{} 
```

在我对这门课的测试中，我正在尝试执行以下操作：

```
class Clayton
{
public:
  static int count;

  Clayton()
  { mNumber = count++;}

  void GetNumber()
  { cerr<<"My number is: "<<mNumber<<endl; }

private:
  int mNumber;
};

int Clayton::count = 0;

class ClaytonManager
{
public:
  bool AddData(const std::string& id, Clayton* pData)
  { return mManager.AddData(id, pData); }

private:
  LockerManager<Clayton> mManager;
}; 
```

我收到以下编译错误：

```
Compiling LockerManagerTest.cpp                             : /usr/local/lib/gcc/i686-pc-linux-gnu/3.4.6/../../../../include/c++/3.4.6/bits/stl_pair.h: In constructor `std::pair<_T1, _T2>::pair(const std::pair<_U1, _U2>&) [with _U1 = std::basic_string<char, std::char_traits<char>, std::allocator<char> >, _U2 = boost::intrusive_ptr<Locker<Clayton> > (*)(Locker<Clayton>), _T1 = const std::basic_string<char, std::char_traits<char>, std::allocator<char> >, _T2 = boost::intrusive_ptr<Locker<Clayton> >]':
../Utilities/include/LockerManager.h:361:   instantiated from `bool LockerManager<T>::AddData(const std::string&, T*) [with T = Clayton]'
src/LockerManagerTest.cpp:35:   instantiated from here
/usr/local/lib/gcc/i686-pc-linux-gnu/3.4.6/../../../../include/c++/3.4.6/bits/stl_pair.h:90: error: no matching function for call to `boost::intrusive_ptr<Locker<Clayton> >::intrusive_ptr(boost::intrusive_ptr<Locker<Clayton> > (* const&)(Locker<Clayton>))'
/usr/local/boost-1.36.0/include/boost-1_36/boost/intrusive_ptr.hpp:94: note: candidates are: boost::intrusive_ptr<T>::intrusive_ptr(const boost::intrusive_ptr<T>&) [with T = Locker<Clayton>]
/usr/local/boost-1.36.0/include/boost-1_36/boost/intrusive_ptr.hpp:70: note:                 boost::intrusive_ptr<T>::intrusive_ptr(T*, bool) [with T = Locker<Clayton>]
/usr/local/boost-1.36.0/include/boost-1_36/boost/intrusive_ptr.hpp:66: note:                 boost::intrusive_ptr<T>::intrusive_ptr() [with T = Locker<Clayton>]
Command exited with non-zero status 1
0:05.40 
```

请帮忙

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T17:03:05.810

Actually, intrusive_ptr already has a < operator and a copy constructor defined, so that wasn't the problem.

There were two main things that we were missing. First, we needed to use `value_type`, instead of `make_pair`, to avoid implicit type conversion in the `insert` statement. Second, we missed the fact that the intrusive_ptr constructor takes a **pointer** to the type that it is templated around.

So, the final, working method looks like this:

```
// ---------------------------------------------------------------------------
// LockerManager::AddData
// ---------------------------------------------------------------------------
template <typename T>
bool LockerManager<T>::
  AddData(const std::string& id, T* pData)
{
  Lock<MutualExclusion> lLock(mMutex);

  if ((pData == NULL) || (mMap.find(id) != mMap.end()))
    return false;

  mMap.insert(typename std::map<std::string, boost::intrusive_ptr<Locker<T> > >::value_type(id, new Locker<T>(pData)));

  return true;
} // LockerManager::AddData 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T00:01:48.770

编译器正在尽最大努力在这里提供帮助。您需要定义具有以下签名的方法：

```
boost::intrusive_ptr<Locker<Clayton> >::intrusive_ptr(
    boost::intrusive_ptr<Locker<Clayton> > (* const&)(Locker<Clayton>)
): 
```

您需要为存储在 std::map 中的类型定义一个复制构造函数，这就是此错误消息试图传达的内容。您还应该实现 < 运算符，以便满足以下条件：

```
- ( x < x ) == false
- if ( x < y ), then !( y < x )
- if ( x == y ), then ( x < y ) == ( y < x ) == false
- if ( x < y ) and ( y < z ), then ( x < z ) 
```

对于许多内置类型，C++ 将为您提供这些，这就是为什么有些人不知道如何将自定义对象存储在 std::map 和其他 STL 容器中。

# java - 发布 google app java web 应用程序时获取无效运行时

> ID：741018
> 
> 赞同：0
> 
> 时间：2009-04-12T00:05:02.973
> 
> 标签：java, google-app-engine

有谁知道出了什么问题？

有关更多详细信息，请参阅 Eclipse 错误日志！STACK 0 com.google.appengine.tools.admin.AdminException：无法上传应用程序：发布到 URL 时出错：[http ://appengine.google.com/api/appversion/create?app_id =guest-book&version=1&](http://appengine.google.com/api/appversion/create?app_id=guest-book&version=1&) 400 Bad Request 指定的运行时无效。

```
at com.google.appengine.tools.admin.AppAdminImpl.update(AppAdminImpl.java:47)
at com.google.appengine.eclipse.core.proxy.AppEngineBridgeImpl.deploy(AppEngineBridgeImpl.java:203)
at com.google.appengine.eclipse.core.deploy.DeployProjectJob.runInWorkspace(DeployProjectJob.java:97)
at org.eclipse.core.internal.resources.InternalWorkspaceJob.run(InternalWorkspaceJob.java:38)
at org.eclipse.core.internal.jobs.Worker.run(Worker.java:55) 
```

原因：java.io.IOException：错误发布到 URL：[http](http://appengine.google.com/api/appversion/create?app_id=guest-book&version=1&) ://appengine.google.com/api/appversion/create?app_id=guest-book&version=1& 400 Bad Request 指定的运行时无效。

```
at com.google.appengine.tools.admin.ServerConnection.send(ServerConnection.java:114)
at com.google.appengine.tools.admin.ServerConnection.post(ServerConnection.java:66)
at com.google.appengine.tools.admin.AppVersionUpload.send(AppVersionUpload.java:345)
at com.google.appengine.tools.admin.AppVersionUpload.beginTransaction(AppVersionUpload.java:159)
at com.google.appengine.tools.admin.AppVersionUpload.doUpload(AppVersionUpload.java:68)
at com.google.appengine.tools.admin.AppAdminImpl.update(AppAdminImpl.java:41)
... 4 more 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-14T19:52:56.877

你在谷歌应用引擎上获得了 java 的许可吗？如果未启用 java（即“运行时”），则会出现此错误。目前预览版仅限于 10,000 名用户，其他用户可以申请但必须等待...查看我的博客文章[为 Google 应用引擎编写 Java Hello World](http://www.vineetmanohar.com/2009/04/11/writing-java-hello-world-for-google-app-engine)了解详细信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T06:12:40.740

[http://code.google.com/appengine/kb/java.html#runtime](http://code.google.com/appengine/kb/java.html#runtime)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-12T01:19:07.787

可能是您没有正确定义 appengine-xml 中的应用程序名称吗？

```
<?xml version="1.0" encoding="utf-8"?>
<appengine-web-app xmlns="http://appengine.google.com/ns/1.0">
    <application>abcdef</application>
    <version>1</version>
    ....
</appengine-web-app> 
```

您尝试发布到[http://abcdef.appspot.com的位置](http://abcdef.appspot.com)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-12T01:21:01.123

有些人似乎正在经历这种情况。有一个你可能想要投票的[错误报告。](http://code.google.com/p/googleappengine/issues/detail?id=1213)

# c# - 如何在运行时判断哪个控件在前面？

> ID：741022
> 
> 赞同：0
> 
> 时间：2009-04-12T00:06:59.507
> 
> 标签：c#, winforms, controls, z-order

我有一个容器控件（a `Panel`），其中`Forms`加载了许多。基于用户交互，我有`.BringToFront()`一定的形式。但是，在程序的其他部分，我想弄清楚当前是哪个表格。（换句话说，确定哪个是最后一个`.BringToFront()`调用其方法的表单。）

确定哪个控件在前面的最佳方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-12T00:12:12.223

您可以使用`GetChildIndex`Controls 集合的方法来获取特定子控件的索引。

```
this.Controls.GetChildIndex(myControl); 
```

最高值在顶部。

# vim - 获取 Vim 中当前文件的名称

> ID：741024
> 
> 赞同：28
> 
> 时间：2009-04-12T00:08:55.537
> 
> 标签：vim

我试图在 Vim 中找到我正在编辑的文件的名称。所以我可以用它来映射`F5`来编译这个文件。如果我能识别文件格式并相应地选择编译器当然会很棒，但实际上没有必要。如果我找到文件的名称，我可以自己做。但我真的找不到任何方法来获取我正在编辑的文件的名称。

我知道该`:make`命令，并且已经映射了它，但是对于小型脚本/测试程序，我真的不想首先编写一个简单的 makefile。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-04-12T00:14:41.203

您可以在 vim 命令中使用 % 字符来获取带有扩展名的当前文件名。例如，

> `:!javac %`

在当前文件上运行 javac。

您可以通过以下方式了解更多信息

> `:help filename-modifiers`

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-04-12T02:39:13.103

> 我正在尝试在 vim 中找到我正在编辑的文件的名称。

对于当前缓冲区，这将为您提供文件名，

```
echo "You're editing " bufname("%") 
```

（只需将它放在某个 file.vim 中，然后获取它“:so %”。但我认为这不是你所需要的。

> 所以我可以用它来映射`F5`编译这个文件，用于测试目的。如果我能识别文件格式并相应地选择编译器当然会很棒，但实际上没有必要。如果我找到文件的名称，我可以自己做。但我真的找不到任何方法来获取我正在编辑的文件的名称。

你可以做几件事。如果 vim 识别出您正在编辑的文件类型，您可以映射`F5`到您的编译器命令并将该命令放在其特定的 ftplugin 目录中，因此它仅对该文件类型有效。例如，你把

```
nmap <f5> :!compilername %<cr> 
```

在 cpp.vim、fortran.vim、python.vim 等中。`%`给出您正在编辑的当前文件的名称。这将执行编译器，就像您`compilername file.cpp`在命令提示符中调用一样。

当然，`compilername`每种文件类型都会有所不同；你不会用 cpp 编译器编译 fortran，你把它放在`fortrancompiler %`那种情况下。

这是一种选择。您也可以尝试根据您的扩​​展名设置 autocmd 命令，`.vimrc`以便它根据文件的扩展名识别文件类型。这是 vim 的所有标准用法，没有什么不寻常的。现在，我不知道你想怎么做，所以我只是将你指向[Vim Wiki](http://vim.wikia.com/wiki/Main_Page)，在那里你可以找到涵盖这个的各种文章（以及一些编译器的提示）。

> 我知道该`:make`命令，并且已经映射了它，但是对于小型脚本/测试程序，我真的不想首先编写一个简单的 makefile。

是的，这似乎有点矫枉过正。就个人而言（当我在 Windows 上时），除了大型项目之外，我发现对于大多数事情来说，简单的批处理文件更容易编写。如果程序在一两个文件中，我只是使用一些单线映射来编译它。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-08-13T23:00:36.563

其他点非常有用。我要补充一点，您可能想要使用 :p，以确保文件名作为完全限定路径传递。没有它，Vim 可能会将它作为相对于 Vim 当前路径的路径传递，该路径可能与编译器使用的路径相同，也可能不同。所以一种解决方案是：

```
nnoremap <silent> <f5> :!javac %:p<cr> 
```

如果要自动检测文件类型，可以使用 AutoCommand

```
autocmd FileType java       nnoremap <buffer> <silent> <f5> :!javac %:p<cr>
autocmd FileType cpp        nnoremap <buffer> <silent> <f5> :!gcc %:p<cr> 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-12T01:34:39.093

正如其他人已经提到`%`的，扩展为当前文件。如果要在 vim 脚本中获取该字符串，请使用`expand("%")`.

但是您可能想简单地将 makeprg 设置为类似的东西`"compiler-command\ %"`并运行`:make`- 您可以通过这种方式获得快速修复支持。（打开错误/警告窗口`:copen`）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-07-27T11:38:46.350

`%`用作文件名的替代品。但就个人而言，我真的认为你可以推动`:make`做你想做的事。

我曾经做过你想要避免的事情：只需为我所在的每个文件夹修改一个两行 Makefile。我非常喜欢`:make`的 quickfix 支持，以至于修改一个两行 Makefile 似乎只是一个很小的开销大局。

...从那以后我学得更好了。您可以使用 autocmd 或 ftplugin 来设置`makeprg`选项，配置`:make`为根据当前文件类型使用您选择的命令。就其本身而言，这可以为您节省一些工作。

当我们使用一个错误消息看起来不像 GCC 的工具时，问题就开始了。为了解决这个问题，vim 也提供了`errorformat`选项。`errorformat`非常复杂。如果您真的想了解它，请从`:h error-format`. 从长远来看，复杂性真的很棒。这意味着，一旦您学会了如何使用它，您几乎可以解析*任何*`:cope`编译器输出并将其格式化，以便使用 quickfix（或）查看`:cl`。

从短期来看，这可能是一件坏事，因为这意味着在您自己破解错误格式的前几次，您将花费相当多的时间对 vimdocs 和 re -加载和构建将触发编译器可能产生的各种错误消息的文件。如果您只是在舒适区之外短暂地工作，或者您的老板在您的肩膀上敦促您立即修复此错误，那绝对不是您想要*的*。

希望（并且很可能）有人已经为您经历了这种痛苦，并且`errorformat`为您的 default 进行了适当的配置`ftplugin`，或者将其作为 vim 脚本的一部分发布，他们只是在等待社区安装和崇拜。

作为一个快速演示，这是我为我的`.vim/ftplugin/haskell.vim`文件编写的几行代码：

```
setl makeprg=ghc\ --make\ %
setl errorformat=%E%f:%l:%c:,%C\ %.%m,%Z,%f:%l:%c:%m 
```

我`setl`在这里使用，以便这些选项仅针对 haskell 源文件进行配置；如果我同时编辑不同类型的源文件，它可以使用不同的配置。

如果您最终使用`:make`，我还建议您配置您的`switchbuf`设置。我发现如果 quickfix 兴奋并跳转到错误的文件，在构建后按 ctrl-O 有点烦人。我用：

```
set switchbuf=useopen,usetab,newtab 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-12T00:16:05.647

好吧，它是**%**作为 :w 之类的替换代码。所以**:w blah%**会写入一个带有 'blah' 前缀的文件副本。或者**!!echo %**用它替换当前行。不知道这是否满足您的需求。

# asp.net - 如何绑定到没有值的下拉列表

> ID：741025
> 
> 赞同：0
> 
> 时间：2009-04-12T00:11:03.800
> 
> 标签：asp.net, drop-down-menu

我已经编写了一些代码来批量更新gridview。在 gridview 我的模板字段之一有一个下拉列表：

```
<asp:DropDownList ID="DDLCategories" runat="server" 
  DataSourceID="odsCategories" DataTextField="txtCategory" 
  DataValueField="intCategoryID" SelectedValue='<%# Bind("intCategoryID") %>'>
  <asp:ListItem Text="Please Select an item" Value ="-1"></asp:ListItem>
</asp:DropDownList> 
```

在我的数据库中，我有 800 条记录。然而，其中只有少数被分配了“intCategoryID”的值。其余为 NULL。

批量更新的全部原因是更新所有“intCategoryID”字段并为每条记录分配一个类别 ID。

因为并非所有“intCategoryID”都被分配了一个值，所以当我尝试呈现页面时出现错误。下拉列表失败。这是消息：

```
'DDLCategories' has a SelectedValue which is invalid because it does not exist in the list of items.
Parameter name: value 
```

有没有办法可以将空类别分配给我在下拉列表中创建的值为“-1”的列表项？IE 如果“intCategoryID”为 ISNULL，则选择“请选择一个项目”，否则选择所选值。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-12T00:59:44.997

我试图转换你指出给我的代码，但是我仍然只是 C# 和 ASP.NET 的新手，因此我有一些错误。

您指出的代码是指表单视图，但是我正在尝试将其更改为网格视图。

到目前为止，这是我的代码：

```
protected void GridView1_PreRender(object sender, EventArgs e)
    {
        DataRowView rowView = (DataRowView)(GridView1.DataItem);
        if ((rowView != null) &&
            ((DropDownList)(GridView1.FindControl("DDLCategories")).Items.FindByValue(rowView["intCategoryID"].ToString()) != null));
        {
            (DropDownList)(GridView1.FindControl("DDLCategories")).SelectedValue = rowView["Category"].ToString();
        }
    }

protected void GridView1_RowUpdated(object sender, GridViewUpdatedEventArgs e)
{
    e.NewValues["intCategoryID"] = (DropDownList)(GridView1.FindControl("DDLCategories")).SelectedValue;
} 
```

您能否指出我何时创建错误。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-12-11T09:42:46.050

最简单的方法是允许 AppendDataBoundItems 并添加一个对应于 null 的 intem。它可能具有“-1”的值或您不在列表值中的任何其他值。现在您所要做的就是进行条件绑定：

```
(Eval("intCategoryID") != null && Eval("intCategoryID").ToString().Length>0) ? Eval("intCategoryID").ToString() : "-1" 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-04-14T18:53:22.050

要解决此问题，您可以创建自定义 DropdownList 服务器控件。

```
using System.Web.UI.WebControls;

namespace CustomNamespace
{
    // Dropdownlist which does not throw an exception if SelectedValue does not exist
    public class CustomDropdownList : DropDownList
    {
        protected override void PerformDataBinding(System.Collections.IEnumerable dataSource)
        {
            try
            {
                base.PerformDataBinding(dataSource);
            }
            catch (System.ArgumentOutOfRangeException)
            {
            }
        }
    }
} 
```

然后改用 aspx 页面上的自定义下拉列表。如果您的项目名为“CustomProject”，请将其添加到 aspx 文件的第二行：

```
<%@ Register assembly="CustomProject" namespace="CustomNamespace" tagprefix="custom" %> 
```

然后用自定义的替换所有 DropdownList 标签实例：

```
<custom:CustomDropdownList ID="ddlId" runat="server" SelectedValue='<%# Bind("column") %>' DataSourceID="dataSourceDropdown" DataTextField="field" DataValueField="value" /> 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-12T00:20:42.030

看看[这篇文章](http://blog.evonet.com.au/post/2008/06/07/dropdownlist1-has-a-SelectedValue-which-is-invalid-because-it-does-not-exist-in-the-list-of-items.aspx)。它覆盖 DDL 的绑定方法并检查缺少的 SelectedValue。如果您不使用 FormView，您可能需要对其进行修改，但我认为您将从该帖子中获得一个良好的开端。

# c# - 使用 Assert 测试异常以确保它们被抛出的最佳方法

> ID：741029
> 
> 赞同：107
> 
> 时间：2009-04-12T00:12:02.817
> 
> 标签：c#, .net, unit-testing

您认为这是测试异常的好方法吗？有什么建议么？

```
Exception exception = null;
try{
    //I m sure that an exeption will happen here
}
catch (Exception ex){
    exception = ex;
}

Assert.IsNotNull(exception); 
```

我正在使用 MS 测试。

* * *

## 回答 #1

> 赞同：147
> 
> 时间：2009-04-12T00:40:35.087

我使用了几种不同的模式。`ExpectedException`大多数情况下，我会在预期出现异常时使用该属性。这对于大多数情况来说就足够了，但是，在某些情况下这还不够。异常可能无法捕获 - 因为它是由反射调用的方法引发的 - 或者我只是想检查其他条件是否成立，例如事务已回滚或某些值仍被设置。在这些情况下，我将它包装在一个`try/catch`预期确切异常的块中，`Assert.Fail`如果代码成功执行并捕获通用异常以确保不会引发不同的异常。

第一种情况：

```
[TestMethod]
[ExpectedException(typeof(ArgumentNullException))]
public void MethodTest()
{
     var obj = new ClassRequiringNonNullParameter( null );
} 
```

第二种情况：

```
[TestMethod]
public void MethodTest()
{
    try
    {
        var obj = new ClassRequiringNonNullParameter( null );
        Assert.Fail("An exception should have been thrown");
    }
    catch (ArgumentNullException ae)
    {
        Assert.AreEqual( "Parameter cannot be null or empty.", ae.Message );
    }
    catch (Exception e)
    {
        Assert.Fail(
             string.Format( "Unexpected exception of type {0} caught: {1}",
                            e.GetType(), e.Message )
        );
    }
} 
```

* * *

## 回答 #2

> 赞同：55
> 
> 时间：2017-05-07T00:19:22.880

现在，2017 年，您可以使用新的[MSTest V2 框架](https://github.com/microsoft/testfx)更轻松地做到这一点：

```
Assert.ThrowsException<Exception>(() => myClass.MyMethodWithError());

//async version
await Assert.ThrowsExceptionAsync<SomeException>(
  () => myObject.SomeMethodAsync()
); 
```

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2013-10-25T11:33:44.847

**编辑：** MS 测试框架迟来地复制了其他单元测试框架，并且现在确实具有[`Assert.ThrowsException`并且`Assert.ThrowsExceptionAsync`](https://docs.microsoft.com/en-us/dotnet/api/microsoft.visualstudio.testtools.unittesting.assert.throwsexception?view=visualstudiosdk-2019)其行为类似于 NUnit 等价物。

但是，在撰写本文时，仍然没有直接的等效项`Assert.Catch<TException>`允许测试`TException`或 的子类`TException`，因此您的单元测试需要准确了解所测试的设置和异常。来自 MS 测试文档：

> 测试委托操作指定的代码是否抛出类型 T **（而不是派生类型）**的确切给定异常，如果代码未抛出异常或抛出非 T 类型的异常，则抛出 AssertFailedException。

**在 SDK 2017 之前**

MS 需要赶上其他测试框架中可用的功能。例如，从 v [2.5 开始，NUnit](http://www.nunit.org/index.php?p=exceptionAsserts&r=2.5.10)`Assert`具有以下用于测试异常的方法级别：

[Assert.Throws](http://www.nunit.org/index.php?p=assertThrows&r=2.5)，它将测试确切的异常类型：

```
Assert.Throws<NullReferenceException>(() => someNullObject.ToString()); 
```

And `Assert.Catch`，它将测试给定类型的异常，或从该类型派生的异常类型：

```
Assert.Catch<Exception>(() => someNullObject.ToString()); 
```

顺便说一句，在调试抛出异常的单元测试时，您可能希望防止 VS[在异常上中断](https://stackoverflow.com/a/3362261/314291)。

**编辑**

仅举一个 Matthew 在下面评论的示例，泛型的返回 `Assert.Throws`和`Assert.Catch`是具有异常类型的异常，然后您可以对其进行检查以进行进一步检查：

```
// The type of ex is that of the generic type parameter (SqlException)
var ex = Assert.Throws<SqlException>(() => MethodWhichDeadlocks());
Assert.AreEqual(1205, ex.Number); 
```

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2009-04-12T19:01:04.520

我是新来的，没有评论或否决的声誉，但想指出[安迪·怀特回复](https://stackoverflow.com/a/741034/282110)中示例中的一个缺陷：

```
try
{
    SomethingThatCausesAnException();
    Assert.Fail("Should have exceptioned above!");
}
catch (Exception ex)
{
    // whatever logging code
} 
```

在我熟悉的所有单元测试框架中，`Assert.Fail`都是通过抛出异常来工作的，所以通用的 catch 实际上会掩盖测试的失败。如果`SomethingThatCausesAnException()`不抛出，则`Assert.Fail`意志，但绝不会冒泡给测试运行者以指示失败。

如果您需要捕获预期的异常（即，断言某些细节，例如异常的消息/属性），捕获特定的预期类型很重要，而不是基 Exception 类。这将允许`Assert.Fail`异常冒泡（假设您没有抛出与单元测试框架相同类型的异常），但仍然允许对您的`SomethingThatCausesAnException()`方法抛出的异常进行验证。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2016-10-03T14:10:18.150

不幸的是，MSTest STILL 仅真正具有 ExpectedException 属性（仅显示 MS 对 MSTest 的关心程度），IMO 非常糟糕，因为它打破了 Arrange/Act/Assert 模式，并且它不允许您准确指定您期望异常的哪一行代码发生在。

当我使用（/由客户端强制）使用 MSTest 时，我总是使用这个助手类：

```
public static class AssertException
{
    public static void Throws<TException>(Action action) where TException : Exception
    {
        try
        {
            action();
        }
        catch (Exception ex)
        {
            Assert.IsTrue(ex.GetType() == typeof(TException), "Expected exception of type " + typeof(TException) + " but type of " + ex.GetType() + " was thrown instead.");
            return;
        }
        Assert.Fail("Expected exception of type " + typeof(TException) + " but no exception was thrown.");
    }

    public static void Throws<TException>(Action action, string expectedMessage) where TException : Exception
    {
        try
        {
            action();
        }
        catch (Exception ex)
        {
            Assert.IsTrue(ex.GetType() == typeof(TException), "Expected exception of type " + typeof(TException) + " but type of " + ex.GetType() + " was thrown instead.");
            Assert.AreEqual(expectedMessage, ex.Message, "Expected exception with a message of '" + expectedMessage + "' but exception with message of '" + ex.Message + "' was thrown instead.");
            return;
        }
        Assert.Fail("Expected exception of type " + typeof(TException) + " but no exception was thrown.");
    }
} 
```

使用示例：

```
AssertException.Throws<ArgumentNullException>(() => classUnderTest.GetCustomer(null)); 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-04-12T18:51:21.457

作为使用`ExpectedException`属性的替代方法，我有时会为我的测试类定义两个有用的方法：

**`AssertThrowsException()`**接受一个委托并断言它抛出了预期的异常和预期的消息。

**`AssertDoesNotThrowException()`**接受相同的委托并断言它不会引发异常。

当您想测试在一种情况下抛出异常但在另一种情况下不抛出异常时，这种配对非常有用。

使用它们，我的单元测试代码可能如下所示：

```
ExceptionThrower callStartOp = delegate(){ testObj.StartOperation(); };

// Check exception is thrown correctly...
AssertThrowsException(callStartOp, typeof(InvalidOperationException), "StartOperation() called when not ready.");

testObj.Ready = true;

// Check exception is now not thrown...
AssertDoesNotThrowException(callStartOp); 
```

漂亮整洁吧？

我的`AssertThrowsException()`和`AssertDoesNotThrowException()`方法在一个通用的基类上定义如下：

```
protected delegate void ExceptionThrower();

/// <summary>
/// Asserts that calling a method results in an exception of the stated type with the stated message.
/// </summary>
/// <param name="exceptionThrowingFunc">Delegate that calls the method to be tested.</param>
/// <param name="expectedExceptionType">The expected type of the exception, e.g. typeof(FormatException).</param>
/// <param name="expectedExceptionMessage">The expected exception message (or fragment of the whole message)</param>
protected void AssertThrowsException(ExceptionThrower exceptionThrowingFunc, Type expectedExceptionType, string expectedExceptionMessage)
{
    try
    {
        exceptionThrowingFunc();
        Assert.Fail("Call did not raise any exception, but one was expected.");
    }
    catch (NUnit.Framework.AssertionException)
    {
        // Ignore and rethrow NUnit exception
        throw;
    }
    catch (Exception ex)
    {
        Assert.IsInstanceOfType(expectedExceptionType, ex, "Exception raised was not the expected type.");
        Assert.IsTrue(ex.Message.Contains(expectedExceptionMessage), "Exception raised did not contain expected message. Expected=\"" + expectedExceptionMessage + "\", got \"" + ex.Message + "\"");
    }
}

/// <summary>
/// Asserts that calling a method does not throw an exception.
/// </summary>
/// <remarks>
/// This is typically only used in conjunction with <see cref="AssertThrowsException"/>. (e.g. once you have tested that an ExceptionThrower
/// method throws an exception then your test may fix the cause of the exception and then call this to make sure it is now fixed).
/// </remarks>
/// <param name="exceptionThrowingFunc">Delegate that calls the method to be tested.</param>
protected void AssertDoesNotThrowException(ExceptionThrower exceptionThrowingFunc)
{
    try
    {
        exceptionThrowingFunc();
    }
    catch (NUnit.Framework.AssertionException)
    {
        // Ignore and rethrow any NUnit exception
        throw;
    }
    catch (Exception ex)
    {
        Assert.Fail("Call raised an unexpected exception: " + ex.Message);
    }
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-04-12T00:17:02.570

用 ExpectedExceptionAttribute 标记测试（这是 NUnit 或 MSTest 中的术语；其他单元测试框架的用户可能需要翻译）。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-04-12T00:17:27.250

对于大多数 .net 单元测试框架，您可以在测试方法上放置一个 [ExpectedException] 属性。但是，这不能告诉您异常发生在您期望的地方。这就是[xunit.net](http://www.codeplex.com/xunit)可以提供帮助的地方。

使用 xunit 你有 Assert.Throws，所以你可以做这样的事情：

```
 [Fact]
    public void CantDecrementBasketLineQuantityBelowZero()
    {
        var o = new Basket();
        var p = new Product {Id = 1, NetPrice = 23.45m};
        o.AddProduct(p, 1);
        Assert.Throws<BusinessException>(() => o.SetProductQuantity(p, -3));
    } 
```

[Fact] 是 [TestMethod] 的 xunit 等价物

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-10-16T21:11:49.553

建议使用[NUnit](https://nunit.org/)的干净委托语法。

测试示例`ArgumentNullExeption`：

```
[Test]
[TestCase(null)]
public void FooCalculation_InvalidInput_ShouldThrowArgumentNullExeption(string text)
{
    var foo = new Foo();
    Assert.That(() => foo.Calculate(text), Throws.ArgumentNullExeption);

    //Or:
    Assert.That(() => foo.Calculate(text), Throws.Exception.TypeOf<ArgumentNullExeption>);
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-04-09T11:30:00.057

这是我在调用 EnsureSuccessStatusCode 扩展方法时测试抛出的 HttpRequestException 所做的（.NET Core 3.1 MS 测试）：

```
var result = await Assert.ThrowsExceptionAsync<HttpRequestException>(async ()=>
{
    await myService.SomeMethodAsync("test value");
}

Assert.AreEqual("Response status code does not indicate success: 401 (Unauthorized).", result); 
```

上面测试了 SomeMethodAsync 方法`T`在这种情况下是否抛出类型异常，`HttpRequestException`然后我可以做更多的断言，例如测试它不是`null`，是类型`HttpRequestException`并且异常消息与`401 Unauthorised`上面示例中的字符串匹配（`HttpRequestException`基于`Exception`类，所以你可以访问其所有属性和方法）。

# javascript - sIFR 导致初始页面加载停止？

> ID：741041
> 
> 赞同：1
> 
> 时间：2009-04-12T00:20:07.867
> 
> 标签：javascript, apache, sifr

我最近刚刚启动了我的博客，我认为 sIFR 导致初始页面加载停止，基本上导致内部 500 错误或超时。

该站点的 URL 是[http://gothamblack.com/](http://gothamblack.com/)

对于我的一生，我无法确定发生了什么。我目前正在运行最新版本的 sIFR，将 parseSelector 替换为使用“$”来利用 jQuery。其他详细信息是：Expression Engine CMS、Mint 统计信息和修改后的 htaccess 以压缩文件（如果它发生冲突，这可能是另一个问题？但我不知道如何）。

我将 sIFR 替换调用重新定位到 global.js 文件以最小化文件请求，这在流中最后被调用。我的 JS 文件如下：

使用 parseSelector 修改 sifr min：[http](http://gothamblack.com/source/scripts/sifr.js) ://gothamblack.com/source/scripts/sifr.js 全局 javascript 文件：[http ://gothamblack.com/source/scripts/global.js](http://gothamblack.com/source/scripts/global.js)

修改后的 htaccess 文件有以下命令：

* * *

```
# Set Language and Character Set
AddDefaultCharset utf-8
AddLanguage en-gb .en
# Cache images and set default on everything else
ExpiresActive on
ExpiresDefault A259200
ExpiresByType image/gif A1209600
ExpiresByType image/png A1209600
ExpiresByType image/jpeg A1209600
# Set css and js so they can be gzipped
<IfModule mod_mime.c>
AddType application/x-httpd-php .css
AddType application/x-httpd-php .js
</IfModule>
# Expression Engine related
Options +FollowSymLinks
RewriteEngine On
# site routing
RewriteCond %{HTTP_HOST} ^www\.gothamblack\.com$ [NC]
RewriteRule ^(.*)$ http://gothamblack.com/$1 [L,R=301]
# Expression Engine related routing
RewriteCond $1 !^(enginecore|feeder|images|mint|source|themes|favicon\.ico|robots\.txt|index\.php) [NC]
RewriteRule ^(.*)$ /index.php/$1 [L] 
```

* * *

如果有人对我可以做些什么来解决这个问题有任何想法，那将不胜感激。我尝试在页面加载时查看萤火虫，但我似乎无法确定当出现失速时它在旋转什么。

再次感谢您的帮助！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-12T15:29:54.247

你能试着去掉薄荷吗？

关于 sIFR 设置：您必须`sIFR.activate()`直接从 JavaScript 调用，而不是从任何 onload 事件。您还可以在字体对象上放置一些共享属性（如比率）。我也不认为你的复杂`switch()`陈述是必要的——如果 DOM 中没有某些东西，sIFR 就不会失败。

# iphone - 如何判断 UIView 是否在前面（可见）？

> ID：741045
> 
> 赞同：8
> 
> 时间：2009-04-12T00:21:40.687
> 
> 标签：iphone, uiview

我需要检测哪个视图在前面（当前可见）。我怎样才能做到这一点？

这是我想做的事情：

```
if ( ! <<methodToTellIfViewAIsInFront>>) {
  [viewA prepareToDisplay];
  [window bringSubviewToFront: viewA];
} 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-12T18:21:51.947

UIView 不一定有在前的概念。UIWindows 可以是关键，也可以不是，但并不完全相同。

您可以将视图*放在*前面，但这并不意味着它可见或不可见。请记住，视图可以是任意大小。

深埋在层次结构中的 UIView 可能是部分可见的，它可能是模糊的，或者它可能位于一些半透明视图的后面。同样，如果修改了不透明度值或隐藏标志，则前面的视图可能根本不可见。

我认为您想要做的是检查您的超级视图或 UIWindow 的子视图 NSArray 并进行检查。我不记得哪个是前面，但它要么是第一个对象，要么是最后一个对象。

子视图是用画家的方法绘制的。视图按从最远到最近的顺序绘制，最后绘制的对象是“前面”。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2015-10-29T17:50:47.187

如果 viewA 在前面，以下将返回 YES：

```
[[viewA.superview.subviews lastObject] isEqual: viewA] 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-05-27T16:32:51.327

将此添加到视图控制器：

```
- (void)viewDidAppear:(BOOL)animated {
 [超级 viewDidAppear:动画];
 可见=是；
}

- (void)viewWillDisappear:(BOOL)animated {
 可见=否；
 [超级viewWillDisappear：动画]；
}

```

并检查“可见”ivar

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-11-22T07:52:26.600

检查 [UIView.window isKeyWindow] == YES

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-06-28T12:24:50.180

**Swift 4 中@LucasChwe 的回答**

```
if viewA.superview?.subviews.last == viewA { 'viewA is visible to user'} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-12T02:26:43.663

唯一的方法是使用 [UIView tag] 为您的视图分配一个唯一标识符，然后使用 [UIView viewWithTag] 将其带到前面。

或者您可以使用标签搜索您需要的视图并对其进行处理。

```
for (UIView *checkView in [self.view subviews] ) {
      if ([checkView tag] == whatever) {
      // Do Whatever you need to do
      }
} 
```

..然后把它带到前面。

干杯

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2013-07-26T00:06:26.457

在处理模态视图时，此代码在我的根视图控制器中与我一起使用：

```
 if(self.view == [(MyAppDelegate *)[[UIApplication sharedApplication] delegate].window.subviews objectAtIndex:0]){ ... 
          // stuff here 
     } 
```

# ruby-on-rails - 不以“/”结尾的 Apache/Rails/Passenger 目录 URL 失败为 404

> ID：741049
> 
> 赞同：1
> 
> 时间：2009-04-12T00:24:27.327
> 
> 标签：ruby-on-rails, linux, apache, passenger

我正在使用 Apache 和乘客来运行 rails 应用程序。在我的 rails 应用程序中，我在公共目录的子目录中有一些静态内容。每个子目录中都有一个 index.html。

因此，在公共目录中，我有一个名为“b”的子目录，其中包含一个 index.html。所以它是这样的：

/public/b/index.html

我有这些页面的链接，格式如下：

[http://a.com/b](http://a.com/b)

如果我在我的常规非 Rails Web 目录中执行此操作，Apache 会正确地将此 URL 重写为[http://a.com/b/](http://a.com/b/)，然后显示 index.html。只有在访问我的 rails 应用程序时它才不起作用。事实上，如果我关闭乘客模块......所以它只是像普通文档根一样访问我的 Rails 应用程序，它也可以正常工作。

我到底需要做什么才能让它与乘客正常工作？同样，当乘客不参与时，它在 apache 本身中也能正常工作。

我正在运行乘客 2.1.3。我有另一台运行乘客 2.0 的服务器似乎没有这个问题，但除了乘客本身的不同版本之外，我在配置中没有看到任何不同。

帮助！这两天一直在努力，没有任何改善！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-12T01:56:20.803

你有[`PassengerHighPerformance`](http://www.modrails.com/documentation/Users%20guide.html#PassengerHighPerformance)吗？这可能会干扰索引页面。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T01:37:49.443

将以下重写规则添加到您的 apache 配置中：

```
# Turn on URL rewriting
RewriteEngine On
# For a given url foo, check if foo/index.html exists as a static file
RewriteRule ^([^.]+)$ $1/index.html [QSA] 
```

# xml - 编写有效的 XSLT

> ID：741050
> 
> 赞同：14
> 
> 时间：2009-04-12T00:24:52.910
> 
> 标签：xml, xslt

**编写有效的 XSLT 的原则和模式是什么？**

当我说“有效”时，我的意思是它是

1.  结构良好且可读性强
2.  简单、简洁
3.  高效（即具有良好的性能）

简而言之，我正在寻找 XSLT 的最佳实践。

我已经看到[了有关效率的问题](https://stackoverflow.com/questions/434976/how-do-i-profile-and-optimize-an-xslt)，但是如果你无法理解它在做什么，那么高效的代码就会失去它的价值。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-12T01:31:05.637

# 一、优雅的XSLT代码

**人们经常可以找到漂亮的 XSLT 代码示例，尤其是当 XSLT 用作一种函数式编程语言时**。

有关示例，请参阅[**这篇**](http://www.idealliance.org/papers/extreme/proceedings/xslfo-pdf/2006/Novatchev01/EML2006Novatchev01.pdf)关于FXSL 2.0 的文章[**——XSLT 2.0**](http://fxsl.sf.net)的函数式编程库。

作为一种 FP 语言，XSLT 也是一种*[**声明性语言**](http://en.wikipedia.org/wiki/Declarative_programming)*。除其他外，这意味着一个人声明，指定现有关系。

这样**的定义通常不需要任何额外的代码来产生结果——它本身就是它自己的实现，或者一个可执行的定义或可执行的规范**。

**这是一个小例子**。

**这个 XPath 2.0 表达式定义**了“*自然数的**最大[素因子](http://en.wikipedia.org/wiki/Prime_factor)*”：

```
if(f:isPrime($pNum))
  then $pNum
  else
    for $vEnd in xs:integer(floor(f:sqrt($pNum, 0.1E0))),
        $vDiv1 in (2 to $vEnd)[$pNum mod . = 0][1],
        $vDiv2 in $pNum idiv $vDiv1
      return
        max((f:maxPrimeFactor($vDiv1),f:maxPrimeFactor($vDiv2))) 
```

**用英语发音**，一个数的最大素因数**`pNum`**就是这个数本身，如果 **`pNum`** 是素数，否则如果 **`vDiv1`**和**`vDiv2`**是 的两个因数**`pNum`**，那么 的最大素因数是和的最大素因数中**`pNum`**较大的一个。**`vDiv1`****`vDiv2`**

**我们如何使用它来实际计算**XSLT 中的最大素因子？**我们简单地将上面的定义包装**在一个`<xsl:function>`和......得到结果！

```
 <xsl:function name="f:maxPrimeFactor" as="xs:integer">
  <xsl:param name="pNum" as="xs:integer"/>

  <xsl:sequence select=
   "if(f:isPrime($pNum))
      then $pNum
      else
        for $vEnd in xs:integer(floor(f:sqrt($pNum, 0.1E0))),
            $vDiv1 in (2 to $vEnd)[$pNum mod . = 0][1],
            $vDiv2 in $pNum idiv $vDiv1
          return
            max((f:maxPrimeFactor($vDiv1),f:maxPrimeFactor($vDiv2)))
   "/>
 </xsl:function> 
```

**然后，我们可以[计算任何自然数的 MPF](https://stackoverflow.com/questions/439814#445858)**，例如：

`f:maxPrimeFactor(600851475143)`= 6857

至于效率，嗯，**这个转换只需要 0.109 秒**。

**其他优雅高效的 XSLT 代码示例**：

*   [**Tim Bray**](http://www.tbray.org/ongoing/)的[**Wide Finder**](http://www.tbray.org/ongoing/When/200x/2007/09/20/Wide-Finder)，在[**这里**](http://dnovatchev.spaces.live.com/Blog/cns!44B0A32C2CCF7488!385.entry)解决。
*   [**级联**](http://dnovatchev.spaces.live.com/blog/cns!44B0A32C2CCF7488!341.entry) [**删除**](http://dnovatchev.spaces.live.com/blog/cns!44B0A32C2CCF7488!342.entry)
*   [**传递闭包**](http://dnovatchev.spaces.live.com/blog/cns!44B0A32C2CCF7488!384.entry)
*   [**查找**](http://dnovatchev.spaces.live.com/blog/cns!44B0A32C2CCF7488!357.entry)单词的
*   [**文本语料库的一致性**](http://fxsl.cvs.sourceforge.net/fxsl/fxsl-xslt2/Tests/testConcordance.xsl?revision=1.1&view=markup)（旧约）
*   [**拼写检查**](http://fxsl.cvs.sourceforge.net/fxsl/fxsl-xslt2/Tests/testFunc-spell.xsl?revision=1.2&view=markup)（莎士比亚的奥赛罗）
*   [**数独求解器**](http://ajwelch.blogspot.com/2006/03/dimitres-tuned-sudoku-solution.html)

# 二、一些规则

**以下是编写“优质 XSLT 代码”的一些规则，取自[Mukul Ghandi 的博客](http://gandhimukul.tripod.com/xslt/xslquality.html)**。

**可以使用[Mukul 开发的工具](http://gandhimukul.tripod.com/xslt/xslqual.zip)**检查/执行它们：

1.  DontUseDoubleSlashOperatorNearRoot：避免在大树根附近使用 // 运算符。

2.  DontUseDoubleSlashOperator：避免在 XPath 表达式中使用运算符 //。

3.  SettingValueOfVariableIncorrectly：如果分配字符串值，则使用“选择”语法将值分配给变量。

4.  EmptyContentInInstructions：不要将空内容用于“xsl:for-each”“xsl:if”“xsl:when”等指令。

5.  DontUseNodeSetExtension：如果使用 XSLT 2.0，请不要使用节点集扩展功能。

6.  RedundantNamespaceDeclarations：xsl:stylesheet 元素中有多余的命名空间声明。

7.  UnusedFunction：未使用样式表函数。

8.  UnusedNamedTemplate：样式表中的命名模板未使用。

9.  UnusedVariable：样式表中未使用变量。

10.  UnusedFunctionTemplateParameter：函数或模板参数在函数/模板主体中未使用。

11.  TooManySmallTemplates：样式表中的低粒度模板太多（10 个或更多）。

12.  MonolithicDesign：在样式表中使用单个模板/函数。您可以模块化代码。

13.  OutputMethodXml：在生成 HTML 代码时使用输出方法“xml”。

14.  NotUsingSchemaTypes：在 XSLT 2.0 模式下工作时，样式表不使用任何内置模式类型（xs:string 等）。

15.  UsingNameOrLocalNameFunction：当 local-name() 可能合适时使用 name() 函数（反之亦然）。

16.  FunctionTemplateComplexity：函数或模板的大小/复杂度很高。需要重构代码。

17.  NullOutputFromStylesheet：样式表没有生成任何有用的输出。请重新查看样式表逻辑。

18.  UsingNamespaceAxis：在 XSLT 2.0 模式下工作时，使用已弃用的命名空间轴。

19.  CanUseAbbreviatedAxisSpecifier：使用冗长的轴说明符，如 child::、attribute:: 或 parent::node()。

20.  UsingDisableOutputEscaping：已将禁用输出转义属性设置为“是”。请重新查看样式表逻辑。

21.  NotCreatingElementCorrectly：如果可以直接使用 xsl:element 指令创建元素节点。

22.  AreYouConfusingVariableAndNode：您可能会将变量引用与节点引用混淆。（由阿兰·贝内代蒂供稿）

23.  IncorrectUseOfBooleanConstants：错误地将布尔常量用作“真”或“假”。（托尼·拉维尼奥供稿）

24.  ShortNames：对变量/函数/模板使用单个字符名称。为这些功能使用有意义的名称。

25.  NameStartsWithNumeric：变量/函数/模板名称以数字字符开头

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-12T00:42:44.507

**最佳实践 1**：尽可能**使用模板而不是 <xsl:for-each >**（这是 99% 的情况）

（我可以在最佳实践中添加可维护性作为额外的成分吗，恕我直言，即使是最重要的成分）

要理解 xsl，您确实需要一些练习。
不明白什么。当然是很相对的。

这对 XSLT 来说是双倍的，因为 xsl:for-each 结构往往是

*   更具可读性

对于新手来说，其实是

*   结构较少，
*   不那么简单，
*   不太简洁和
*   可维护性差很多

比模板，而且只有

*   因此，同样可读（充其量！！）。具有最少的模板经验。

> 永远不要使用 < xsl:for-each > 元素！
> 
> 我承认，这个标题有些夸张，有人告诉我，确实存在“xsl for each”可以有其优点的情况，但这些情况非常非常罕见。
> 
> 我曾经不得不在不到一周的时间内设计出一个相当复杂的 xml/xslt 客户端站点，并且在所有地方都使用了 for-each 元素。现在，几年后，更明智地，我花时间重写了最初的代码，只使用模板。现在的代码更干净，适应性更强。
> 
> 要么你知道这一点，要么你应该：<xsl:template> 和<xsl:apply-templates> 几乎总是要走的路。如果你是 xsl-ing，并且你不完全理解这些标签，现在停止你的工作，学习它们，获得一个 aha-erlebnis，然后作为一个重生的（wo）人继续你的工作。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-15T20:00:42.263

我认为回答这个问题的一个好方法是从另一边来解决这个问题。哪些实践使 XSLT*无效*，为什么？

我见过的一些导致 XSLT 无效的事情：

1.  **过度使用`for-each`.** 每个人都这么说；我再说一遍。我发现这`for-each`通常表明开发人员试图在声明性语言中使用传统的编程技术。

2.  **未充分利用 XPath。** 我见过的很多糟糕的 XSLT 的存在纯粹是因为开发人员不了解谓词、轴说明符、`position()`和`current()`，因此他使用 XSLT 构造来实现逻辑。

3.  **未充分利用元数据。** 您有时可以通过为您的转换提供元数据来消除大量的 XSLT *。*

4.  **未充分利用预处理。** 例如，如果 XML 文档包含必须使用 XSLT 字符串操作来解析的数据，那么在 XSLT 之外进行所有解析并将解析结果添加到 XML 或将解析结果作为参数传递通常要简单得多到变换。我见过一些非常难以维护的 XSLT 实现业务逻辑，在 C# 或 Python 中实现这些逻辑是微不足道的。

我在自己的 XSLT 世界中遇到的最大问题（我正在维护几个 3,000 多行转换）是死代码。我确信我的转换中的模板将永远不会再次使用，因为它们正在测试的条件将永远不会再次出现。没有办法以编程方式确定诸如此类的东西`<xsl:template match="SomeField[contains(., "some value")]>`是活的还是死的，因为它取决于元数据无法告诉你的东西。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-12T06:05:10.907

## 文件问题

**1.很多小文件比几个大文件好。**

将 hamburger.xsl 拆分为 i-bread.xsl 和 i-beef.xsl。

**2\. 使用“i-”前缀包含/导入的文件。**

它作为一个指示文件应该谨慎编辑，因为您可能会破坏导入/包含文件的功能。在提交更改之前检查它们。

**3\. 永远不要包含/导入无前缀的文件。**

如果要制作 cheeseburger.xsl，请不要包含 hamburger.xsl。相反，包括 i-bread.xsl、i-beef.xsl 和新创建的 i-cheese.xsl。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-12T01:08:34.367

为了便于阅读，我使用了`xsl:template`标签。它非常简洁易用。将参数传递给模板很简单。这种技术称为封装，是良好编程的基础之一。

# php - 如何在 Zend Framework 中转义复杂的 sql？

> ID：741053
> 
> 赞同：11
> 
> 时间：2009-04-12T00:28:09.330
> 
> 标签：php, zend-framework, zend-db-table

我有以下 sql（实际问题的简化）：

```
SELECT *
FROM t
WHERE myname LIKE '%{$input}%'; 
```

如何转义 $input？
我不能使用 quoteInto （除非我错过了什么）。
作为

```
$sql=$DB->quoteInto("SELECT *
                     FROM t
                     WHERE myname LIKE '%?%'",$input); 
```

会给我

```
SELECT *
FROM t
WHERE myname LIKE '%'my input'%'; 
```

和

```
$sql=$DB->quoteInto("SELECT *
                     FROM t
                     WHERE myname LIKE ?",'%'.$input.'%'); 
```

会给我一些东西：

```
SELECT *
FROM t
WHERE myname LIKE '\%my input\%'; 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-12T02:28:58.853

最后一个选项对我来说效果很好，我没有经历过它转义'％'。所以`$db->quote('%'.$_GET['query'].'%')`输出`%queryvalue%`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-03-22T19:55:15.827

解决方案非常简单。Zend_Db 有一个可以帮助您围绕它工作的 Expression 类。

```
$select = $this->select()
->where('value LIKE("?")', new Zend_Db_Expr('%' . $value . '%'))

$this->fetchAll( $select ); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-12T00:50:12.303

您可以在 SQL 级别连接 $input：

```
$sql=$DB->quoteInto("SELECT * FROM t WHERE myname LIKE '%'|| ? ||'%'",$input); 
```

不幸的是，当您希望 $input 能够包含文字 '%' 或 '_' 字符时，这不可用。为了解决这个问题，指定一个明确的 LIKE-ESCAPE 字符并自己转义它们：

```
$inputlike= '%'.preg_replace('[%_=]', '=$0', $input).'%';
$sql=$DB->quoteInto("SELECT * FROM t WHERE myname LIKE ? ESCAPE '='", $inputlike); 
```

（它可以是任何字符，不一定是 '='。这也适用于在 MySQL 中未指定 ESCAPE 默认为 '\' 的错误。）

不幸的是，SQL Server 也将 '[' 字符视为特殊字符，以执行类似正则表达式的字符组。因此，如果您的数据库是 SQL Server，您必须在 preg_replace 的组中包含“[”。不幸的是，在不需要转义的其他 DBMS 上转义 '[' 不是有效的 ANSL SQL。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-25T04:30:09.460

这很简单：

```
$sql=$DB->quoteInto("SELECT *
                     FROM t
                     WHERE myname LIKE ?",'%' . $input . '%');

//Will output: SELECT FROM t WHERE myname LIKE '%inputtedvalue%'

$sql=$DB->quoteInto("SELECT *
                     FROM t
                     WHERE myname LIKE ?",'%' . $input);

//Will output: SELECT FROM t WHERE myname LIKE '%inputtedvalue'

$sql=$DB->quoteInto("SELECT *
                     FROM t
                     WHERE myname LIKE ?", $input . '%');

//Will output: SELECT FROM t WHERE myname LIKE 'inputtedvalue%'

$sql=$DB->quoteInto("SELECT *
                     FROM t
                     WHERE myname LIKE ?", $input);

//Will output: SELECT FROM t WHERE myname LIKE 'inputtedvalue' 
```

有什么问题？

:)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-01-28T09:10:21.337

问题是，我们想转义 LIKE 特殊字符手动替换它们会有点脏，但如果没有解决方案......

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-02-19T08:26:29.470

它更简单：

```
$table->select()->where("myname LIKE ?", '%'.$input.'%'); 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-04-12T01:41:14.863

您可以只使用 zf 在字符串上使用的函数 addcslashes($value, "\000\n\r\'\"\032"); 这将以 zf 使用的相同方式替换字符串，或者您可以（在 mysql 的情况下）使用 mysql_real_escape_string。

无论哪种方式，您都不会使用其中一个 db quote 函数

我确实想知道 db 类中是否有一种方法可以做到这一点，但我不知道应该有一个方法。

# c# - stl C++ 和 C# 容器之间的映射

> ID：741054
> 
> 赞同：15
> 
> 时间：2009-04-12T00:29:04.897
> 
> 标签：c#, c++, stl, containers

有人能指出常用的 C++ STL 容器（如 vector、list、map、set、multimap ......）和 C# 通用容器之间的良好映射吗？

我已经习惯了前者，不知何故我已经习惯了用这些容器来表达算法。我很难找到与这些等效的 C#。

谢谢！

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-04-12T00:54:47.893

这是一个**粗略**的等价物：

1.  `Dictionary<K,V>`<=>`unordered_map<K,V>`
2.  `HashSet<T>`<=>`unordered_set<T>`
3.  `List<T>`<=>`vector<T>`
4.  `LinkedList<T>`<=>`list<T>`

.NET BCL（基类库）没有红黑树（stl map）或优先级队列（make_heap()、push_heap()、pop_heap()）。

.NET 集合不像 C++ 那样使用“迭代器”。它们都实现了，并且可以使用“语句”`IEnumerable<T>`进行迭代。`foreach`如果你想手动控制迭代，你可以`GetEnumerator()`在集合上调用“”，它将返回一个`IEnumerator<T>`对象。`IEnumerator<T>.MoveNext()`大致相当于 C++ 迭代器上的“++”，“Current”大致相当于指针引用运算符（“*”）。

C# 确实具有称为“迭代器”的语言功能。但是，它们与 STL 中的“迭代器对象”不同。相反，它们是一种允许自动实现`IEnumerable<T>`. 有关更多信息，请参阅`yield return`and`yield break`语句的文档。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T00:59:56.943

您可能还想看看[STL/CLR](http://msdn.microsoft.com/en-us/library/bb385954.aspx)这是

> ... 是标准模板库 (STL) 的打包，它是标准 C++ 库的子集，用于 C++ 和 .NET Framework 公共语言运行时 (CLR)。使用 STL/CLR，您可以在托管环境中使用 STL 的所有容器、迭代器和算法。

另外，请记住，您可以使用**/clr**标志编译现有的 C++/STL 代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T00:39:18.680

[这个 SorceForge 项目](http://sourceforge.net/projects/cstl)看起来像是您正在寻找的有趣资源。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-04-12T00:33:17.523

没有很好的直接映射，因为例如 C++ set 和 map 使用比较器，而 .Net HashSet 和 Dictionary 使用哈希码。

# ruby - 安装 Ruby 1.9.1

> ID：741055
> 
> 赞同：0
> 
> 时间：2009-04-12T00:29:27.860
> 
> 标签：ruby

我通常在[http://hivelogic.com](http://hivelogic.com)上查看有关安装 Ruby 的说明，但我在尝试将 Dan 的 1.8.7 说明转换为 1.9.1 时遇到了问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T21:12:01.837

[这就是我所做的](http://stuff.lilleaas.net/ruby_1.9_on_your_mac)！概括：

*   curl -O [ftp://ftp.ruby-lang.org/pub/ruby/1.9/ruby-1.9.1-p0.tar.gz](ftp://ftp.ruby-lang.org/pub/ruby/1.9/ruby-1.9.1-p0.tar.gz)
*   tar xzvf ruby​​-1.9.1-p0.tar.gz
*   cd ruby​​-1.9.1-p0
*   ./configure --prefix=/usr/local --program-suffix=1.9
*   制作
*   须藤使安装

# language-agnostic - 听（）而不调用绑定（）

> ID：741061
> 
> 赞同：13
> 
> 时间：2009-04-12T00:35:51.107
> 
> 标签：language-agnostic, networking, network-programming, tcp

我尝试了以下方法：

```
int sockfd = socket(...);
listen(sockfd, 10);
accept(sockfd, ...); 
```

没有一个调用失败，程序刚刚开始阻塞，就像我调用了 bind() 一样。在这种情况下会发生什么？因为它没有本地地址或端口，就不可能接收到连接吗？还是它隐含地分配了一个本地地址和端口，现在它正在监听这些？如果是这样，我怎样才能检索那些是什么？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-12T00:51:34.000

`connect(2)`调用正在工作，但由于您没有显式绑定套接字，因此操作系统或系统库为您隐式分配了一个端口和默认绑定（与您在没有先调用的情况下调用时完全相同`bind(2)`）。另外，由于您之前询问过 TCP 的问题，我假设您在这里谈论的是 Internet 套接字。

找出操作系统将套接字绑定到的名称因操作系统而异，因此您必须查找您的特定操作系统，但大多数操作系统都提供了一个`netstat`或类似的工具，您可以使用它来查询哪些应用程序正在侦听哪些端口。

正如约翰在评论中提到的那样，您可以使用`getsockname(2)`来查找绑定套接字的名称。这是一个简短的例子：

```
// ...

// Create socket and set it to listen (we ignore error handling for brevity)
int sock = socket(AF_INET, SOCK_STREAM, 0);
listen(sock, 10);

// Sometime later we want to know what port and IP our socket is listening on
socklen_t addr_size = sizeof(struct sockaddr_in);
struck sockaddr_in addr;
getsockname(sock, (struct sockaddr *)&addr, &addr_size); 
```

`addr`现在将包含您的套接字正在侦听的 IP 地址和端口。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-12T14:37:11.863

正如其他人所提到的，如果您不绑定（）一个端口，操作系统将分配一个端口。您可以在listen() 之后使用[getsockname()](http://opengroup.org/onlinepubs/007908799/xns/getsockname.html)调用来查看分配的地址/端口。然后，如果您将该地址/端口传达给客户端，它可以连接。

所以这是有道理的。你可以编写一个程序，这是一件有趣的事情。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T00:50:41.007

我怀疑你永远不会得到连接。您可以通过在运行程序之前和之后在您的操作系统上执行相当于“netstat -an”的操作来检查是否有新的套接字侦听。

我在 C# 中尝试了同样的事情：

```
Socket socket = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
socket.Listen(1);
socket.Accept(); 
```

我在第二行得到一个异常，它以迂回的方式通知我需要绑定。它当然适用于：

```
Socket socket = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
socket.Bind(new IPEndPoint(IPAddress.Loopback, 4567));
socket.Listen(1);
socket.Accept(); 
```

我也用 Udp 套接字进行了测试，同样的事情，Windows 对 Listen 调用不满意，除非绑定已经完成。由于 .Net 套接字调用只是 Winsock 的包装器，因此这种行为对于 Windows 上的所有 Winsock 派生库可能都是相同的。

# debugging - 在代码执行期间报告信息：最佳设计

> ID：741063
> 
> 赞同：6
> 
> 时间：2009-04-12T00:37:06.703
> 
> 标签：debugging, logging

在设计正确的执行报告时，我总是有疑问。

假设您有以下（愚蠢的，简单的）案例。我将使用python。

```
def doStuff():
    doStep1()
    doStep2()
    doStep3() 
```

现在，假设您想报告各个步骤，如果出现问题等。不是真正的调试：只是应用程序的信息行为。

第一个简单的解决方案是打印

```
def doStuff():
    print "starting doing stuff"
    print "I am starting to do step 1"
    doStep1()
    print "I did step 1"
    print "I am starting to do step 2"
    doStep2()
    print "I did step 2"
    print "I am starting to do step 3"
    doStep3()
    print "I did step 3" 
```

一般来说，这是非常糟糕的。假设这段代码最终会出现在一个库中。我不希望我的图书馆把东西打印出来。我希望它能够默默地完成这项工作。尽管如此，有时我还是想提供信息，不仅是在调试情况下，而且还要让用户知道某些事情实际上正在完成的过程中。打印也很糟糕，因为您无法控制消息的处理。它只是进入标准输出，除了重定向之外，你无能为力。

另一种解决方案是有一个用于记录的模块。

```
def doStuff():
    Logging.log("starting doing stuff")
    Logging.log("I am starting to do step 1")
    doStep1()
    Logging.log("I did step 1")
    Logging.log("I am starting to do step 2")
    doStep2()
    Logging.log("I did step 2")
    Logging.log("I am starting to do step 3")
    doStep3()
    Logging.log("I did step 3") 
```

这样做的好处是您知道日志服务的独特位置，并且您可以随意修改此服务。您可以将其静音、将其重定向到文件、stdout 甚至网络。缺点是您与 Logging 模块的耦合非常强。基本上你的代码的每一部分都依赖于它，而且你到处都可以调用日志记录。

第三种选择是有一个界面清晰的报表对象，然后你传递它

```
def doStuff(reporter=NullReporter()):
    reporter.log("starting doing stuff")
    reporter.log("I am starting to do step 1")
    doStep1()
    reporter.log("I did step 1")
    reporter.log("I am starting to do step 2")
    doStep2()
    reporter.log("I did step 2")
    reporter.log("I am starting to do step 3")
    doStep3()
    reporter.log("I did step 3") 
```

最后，如果他们有更多话要说，您也可以将记者对象传递给 doStepX()。优点：它减少了与模块的耦合，但它引入了与 NullReporter 对象的实例化的耦合。这可以通过使用 None 作为默认值并在调用 log 之前检查来解决，这很笨拙，因为在 python 中你必须每次都编写一个条件（在 C 中你可以定义一个宏）

```
def doStuff(reporter=None):
    if reporter is not None:
        reporter.log("starting doing stuff")
        # etc... 
```

编辑：另一个选择是像 Qt 一样工作，并有一个 emit() 信号策略。当您的代码执行时，它会发出带有适当状态代码的信息，任何有兴趣的人都可以订阅信号并提供信息。漂亮干净，非常解耦，但需要一点编码，因为我认为使用包含的 python 电池无法快速完成。

最后，您可以使用有意义的错误消息引发异常，但这当然只能在您退出错误条件时使用。它不适用于偶尔的报告。

编辑：我想澄清一个事实，即情况更普遍，而不仅限于一系列调用的步骤。它还可能涉及控制结构：

```
 if disconnected:
     print "Trying to connect"
     connect()
 else:
     print "obtaining list of files from remote host"
     getRemoteList() 
```

报告也可以包含在实际的例程中，因此您将在 connect() 和 getRemoteList() 例程中作为第一条语句进行“打印”。

因此，问题是：

*   您认为对于某些代码（尤其是在库的情况下）来说，最好的设计是在噪音可能对客户端造成干扰时同时保持沉默，但在有用时变得冗长？
*   如何处理逻辑代码和报告代码之间的平衡混合？
*   代码和错误检查之间的混合已通过异常解决。可以做些什么来将报告的“噪音”与代码逻辑分开？

* * *

编辑：头脑中的更多想法

我认为这不仅仅是将 Logging 代码与逻辑代码分离的问题。我认为这也是信息生产与信息消费脱钩的问题。类似的技术已经存在，特别是用于处理 UI 事件，但我并没有真正看到应用于日志记录问题的相同模式。

* * *

编辑：我接受了 Marcelo 的回答，因为他在事实证据中指出，在这种情况下妥协是最好的解决方案，而且没有灵丹妙药。然而，所有其他的答案也很有趣，我真的很高兴为所有答案投票。谢谢您的帮助！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-12T00:44:45.547

我认为图书馆的最佳解决方案是添加例如

```
Log.Write(...) 
```

Log 的行为是从环境环境中获取的（例如 app.config 或环境变量）。

（我也认为这是一个已经被多次解决和解决的问题，虽然在设计空间中有一些“甜蜜点”，但上面的答案对于你描述的情况来说是最好的 IMO。）

我没有看到任何将代码的“正常”部分与“日志记录”部分“分离”的好方法。日志记录往往是相对非侵入性的；我不认为偶尔的 Log.Write(...) 会分散实际代码的注意力。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-12T01:26:16.913

另一种选择是在不记录的情况下编写代码，然后在执行代码之前应用一些转换来插入适当的记录语句。执行此操作的实际技术高度依赖于语言，但与编写调试器的过程非常相似。

不过，这可能不值得增加复杂性……

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-12T01:45:38.707

我在为 python 搜索面向方面的编程时发现[了这一点。](http://www.ibm.com/developerworks/linux/library/l-pymeta.html)我同意其他发帖者的观点，即不应将此类担忧与核心逻辑混为一谈。

本质上，您想要记录日志的点可能并不总是任意的，可能是诸如“错误之前的所有点”之类的概念，可以通过切入点来识别。可以使用简单的测井技术捕获其他完全任意的点。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-14T19:05:12.793

我经常为此使用 DTrace。在 OS X 上，python 和 ruby​​ 都已经设置了 DTrace 钩子。在其他平台上，您可能必须自己执行此操作。但是能够将调试跟踪附加到正在运行的进程是非常棒的。

但是，对于库代码（假设您正在编写一个 http 客户端库），最好的选择是传入一个可选的记录器作为参数，正如您所提到的。DTrace 非常适合将日志记录添加到生产中（有时在其他地方）出现问题的地方，但是如果其他人可能需要访问日志来调试随后调用您的代码，那么可选的记录器作为参数绝对是方法去。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-14T16:55:53.603

我认为最简单的解决方案是最好的。这取决于语言，但只需使用一个非常短的、全局可访问的标识符 - 在 PHP 中我使用自定义函数`trace($msg)`- 然后只需实现并重新实现您认为适合特定项目或阶段的代码。

它的自动编译器版本是标准调试器。如果你想看到有意义的标签，你需要自己写这些标签，不幸的是:)

或者您可以尝试将内联注释临时转换为函数调用，但我不确定这是否可行。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-12T01:40:36.597

应该有工具允许样板日志消息，例如“使用参数 (1,2,3) 输入方法 A”，“从方法 B 返回值 X，花费 10 毫秒”自动（和有选择地）生成（控制在运行或部署时间）。手工写这些东西太无聊/重复/容易出错。

不过不确定是否有。

如果您要编写手动日志消息，请确保包含一些有用的上下文信息（用户 ID、正在查看的 URL、搜索查询等），这样如果出现问题，您可以获得更多信息，而不仅仅是方法名称。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-14T16:42:14.340

我将使用[`logging`](http://docs.python.org/library/logging.html)自 Python 2.3 以来一直是标准库一部分的标准模块。

这样，查看您的代码的人很有可能已经知道该`logging`模块是如何工作的。如果他们必须学习，那么至少它是有据可查的，并且他们的知识可以转移到其他也使用`logging`.

`logging`是否有任何您想要但在标准模块中找不到的功能？

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-14T17:30:56.983

回应您对信息生产/消费的编辑：对于一般情况，这是一个有效的问题，但记录不是一般情况。特别是，您不应该依赖程序某个部分的日志输出来影响另一部分的执行。这确实会将消费者与生产者的实现紧密耦合。

日志记录应被视为您的主要执行附带的。您的系统不应该知道或关心此类日志文件的存在或内容（监控工具可能除外）。在这种情况下，将原木的“消费”与其生产脱钩的概念是无关紧要的。由于您没有使用日志来做任何有意义的事情，因此耦合不是问题。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-15T20:39:34.540

我认为有一点你必须划清界限并做出妥协。我认为没有办法将日志记录与系统完全分离，因为您必须以某人理解的方式将这些消息发送到某个地方。

我会使用默认的日志记录模块，因为......它是默认模块。它有据可查，并带有默认库，因此这里没有依赖性问题。此外，您还可以避免重新发明轮子。

也就是说，如果你真的想做一些新的事情，你可以创建一个全局记者对象。您可以在流程开始时实例化和配置它（记录、不记录、重定向流等。即使在每个流程/功能/步骤的基础上）并从任何地方调用它，无需传递它（也许在一个多线程环境，但这将是最小的）。

您还可以将它放在另一个线程中并像 Qt 一样捕获日志事件。

# php - 为每个会话分配随机颜色，用于聊天

> ID：741070
> 
> 赞同：0
> 
> 时间：2009-04-12T00:45:18.867
> 
> 标签：php, javascript, jquery, css, ajax

我有一个我正在开发的 AJAX 聊天系统，到目前为止我已经开始工作了。我想做的一件事是拥有它，因此当用户名显示在屏幕上时，它是一种独特的颜色（就像在 AIM 窗口中一样）。我将如何生成随机颜色以分配给他们登录的特定会话的用户名？

颜色必须比白色背景上的颜色更深，并且在生成它们时，它们不能与其他当前用户分配的颜色太相似。

**编辑**谢谢，我想一个预定义的列表将是最简单的方法。如果我在配置文件中有这个列表，并且在用户登录时分配了颜色，我应该如何确保没有两个登录用户具有相同的颜色？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-12T00:48:36.097

我认为您最好从满足您要求的预生成颜色列表中随机选择（足够暗，彼此足够不同），而不是尝试动态生成颜色。

*编辑添加：*

至于防止多个用户使用相同的颜色，我见过的系统所做的一件事就是使用 Javascript 在用户机器上本地分配颜色。通常，不同的用户看到其他人的相同颜色并不重要。我不在乎我屏幕上的颜色是否与其他用户屏幕上的颜色相同，只要我屏幕上的所有颜色都是唯一的。事实上，可能希望每个用户自己的文本是不同的（例如，他们的文本是黑色的，其他人的文本是彩色的）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T00:49:06.190

创建一个足够深且易于区分的颜色列表（手动），然后随机选择一种。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-12T00:56:34.800

如果您还希望它们相互对比并处于白色的黑暗面，那么您不希望颜色过于随意。

最好预先定义一个颜色数组，然后从一个随机的起始位置循环遍历它们，这样在整个集合被分配之前不会重复。

# c# - 从 vs 2005 迁移到 vs 2008

> ID：741072
> 
> 赞同：0
> 
> 时间：2009-04-12T00:45:57.977
> 
> 标签：c#, visual-studio, visual-studio-2008, visual-studio-2005, upgrade

我在一家大公司工作，我们还没有将 dotnet 运行时 3.0+ 分发到桌面，所以我们都在使用 vs 2005 和 c# 2.0

对于开发人员来说，迁移到 vs 2008 并仍然以 2.0 为目标（因为运行时部署不会很快出现）有什么大好处。

此外，如果建议升级到 vs 2008，是否有任何问题或需要担心或准备的事情。

注意：我们主要是在做winforms项目

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-12T00:49:35.253

[在另一个线程](https://stackoverflow.com/questions/193281/visual-studio-2005-vs-2008-what-are-the-benefits)和[这个](https://stackoverflow.com/questions/46036/upgrading-to-visual-studio-2008-from-2005)线程上有一些关于这个主题的很好的讨论。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-12T01:03:16.517

IDE 的一些改进包括更好的 XML 编辑器和新的 Web 表单设计器。

我建议您升级到 VS2008 SP1，它还包括一个用于编辑 XML 模式的模式查看器。

如果您的目标是 .NET 2.0，那么您的代码不需要任何新程序集，因此您的代码仍然可以在没有 .NET 3.5 的机器上运行。您应该将 .NET 2.0 SP1 和 SP2 推广到桌面。然后，我相信您编写的任何使用 .NET 3.5 SP1 程序集的新代码都可以简单地随代码一起发布该程序集。不会影响计算机上的其他任何人。.NET 2.0 到 .NET 3.5 SP1 都使用相同的 CLR，因此不存在冲突。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T00:50:28.950

您需要记住它支持 .NET 2.0 SP1，因此可能需要升级。

要记住的另一件事是，您仍然可以使用一些 C# 3.0 功能，同时仍然以 .NET 框架为目标。例如，您可以使用 lambdas、自动属性。但是，您不能使用扩展方法或任何 linq 东西。仅出于这个原因，我会切换到 2008 年；C# 3.0 的改进提高了生产力，至少在一定程度上改变了它。

最后，我不确定 IDE 的改进；我使用 Resharper，所以 Visual Studio 自己做的事情让我无法理解。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-12T00:54:26.803

就个人而言，我喜欢使用 VS2008 来降低目标 2.0 应用程序。大多数新的语言功能，包括 LINQ，都可以在向下定位 2.0 应用程序时使用。确实，您需要为 System.Core 提供您自己的替代品。有几个[可用](http://code.msdn.com/bclextras)的，所以你不必手动编码。我觉得其中许多功能改进了我的编程，足以保证这种方法。

我喜欢使用向下定向的语言功能

*   Lambda 表达式（C# 和 VB.Net）
*   扩展方法
*   LINQ 查询（带有附加 LINQ 库的 C# 和 VB.Net）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-12T00:55:49.700

我认为迁移到 2008 年的最大好处将是 C# 3.0 中的新功能。自 2.0 以来，.NET 3.5 的运行时 (CLR) 并没有真正改变很多。您可能需要将升级推送到所有客户端，但这还不错（只需告诉人们使用 Windows Update 更新他们的 .NET 运行时即可。）

程序员会感谢你的，2008 年有一些很棒的新功能！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-12T00:56:28.683

> 对于开发人员来说，迁移到 vs 2008 并仍然以 2.0 为目标（因为运行时部署不会很快出现）有什么大好处。

我会说不，但是从另一面考虑这个问题，

> **对于开发人员来说，继续使用 VS2005 并仍然**以 2.0 为目标（因为运行时部署不会很快出现）有什么大好处吗？

仍然没有。

# c# - sqlite，单声道，C# 跨平台

> ID：741113
> 
> 赞同：4
> 
> 时间：2009-04-12T01:16:57.467
> 
> 标签：c#, sqlite, mono, moma

我在我的 C# 项目中使用 sqlite。MoMA 抱怨 DLL，我不确定在 mac/linux 端该怎么做。移植外部 DLL 时我通常需要做什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-06-25T14:41:42.933

您可能想[在 googlecode 上查看 SQLite](http://code.google.com/p/csharp-sqlite/)的 C# 重新实现。它最初是作为[C++ SQLite 的逐行端口，](http://tirania.org/blog/archive/2009/Aug-06.html)但经过大量改进后，现在在许多类型的操作中都优于原始版本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T01:29:23.473

您可以使用 Mono 附带的 SQLite 程序集——它派生自您现在可能正在使用的程序集。

有关详细信息，请参阅[http://mono-project.com/SQLite](http://mono-project.com/SQLite)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-12T16:05:34.710

PHXSoftware 的[System.Data.Sqlite](http://sqlite.phxsoftware.com/)在 Mono 上运行。

# c# - Facebook 应用程序中的重定向

> ID：741119
> 
> 赞同：1
> 
> 时间：2009-04-12T01:21:20.777
> 
> 标签：c#, asp.net, facebook

目前，我在 IFrame Facebook 应用程序后面的 ASP.net C# 代码中使用以下代码：

```
Response.Redirect("Default.aspx"); 
```

有一个更好的方法吗？

听说用

```
<fb:redirect url=\""/> 
```

但如果这是正确的方法，我将如何使用它在我的 ASP.net 项目的根级别的页面之间导航？请提供示例，因为我从他们身上学到了最好的东西。

谢谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-14T21:41:38.317

使用`fb:redirect`标签适用于 FBML 应用程序，但它不会在您的 IFrame 应用程序中执行任何操作，因为`<fb:redirect />`对浏览器没有任何意义。

IFrame 应用程序的诀窍在于，如果您直接链接或重定向到您的页面，您将丢失所有 Facebook 特定的数据（所有 fb_sig 参数），如果您没有办法持久保存它们，这可能会破坏事情。

我一直在为 CodePlex 上的 Facebook API 开发 .NET 客户端框架[——.NET Facebook API 客户端](http://facebook.codeplex.com)——它为你处理这些数据的持久化。它目前仍处于 alpha 阶段，但我们已经拥有了大部分我认为在我们的第一个版本中涵盖的更重要的功能。

# php - AJAX 聊天，自动滚动窗口

> ID：741122
> 
> 赞同：0
> 
> 时间：2009-04-12T01:25:43.933
> 
> 标签：php, javascript, jquery, ajax

### 复制

> [使用 JavaScript 滚动溢出的 DIV](https://stackoverflow.com/questions/13362/scrolling-overflowed-divs-with-javascript)

* * *

我有一个 AJAX 聊天，它将消息输出到一个带有 overflow: auto 的 div，所以如果它变得太长，滚动条就会出现。有没有办法让它在添加新消息时自动滚动到底部？最好使用jQuery？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-12T06:23:16.433

这将通过以下行完成

```
$("#youChatDiv").attr({ scrollTop: $("#youChatDiv").attr("scrollHeight") }); 
```

这样做是将滚动设置为自己元素的高度

只需在每条新消息中调用它即可：)

干杯

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T07:55:25.510

属性 scrollHeight 是理想的，但它不是 W3C 的一部分。

如需进一步了解，请访问：

[http://yelotofu.com/2008/10/jquery-how-to-tell-if-youre-scroll-to-bottom/](http://yelotofu.com/2008/10/jquery-how-to-tell-if-youre-scroll-to-bottom/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T16:11:12.713

如果每条消息都在一个单独的元素（div、段落等）中，你可以调用[`scrollIntoView`](https://developer.mozilla.org/en/DOM/element.scrollIntoView)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-02T08:39:51.363

这个 Jquery 插件会帮助你。

[Jquery ScrollTo 插件演示页面](http://demos.flesler.com/jquery/scrollTo/)

# qt - 使 QClipboard::setText() 在 X11 下工作所需的最小调整量是多少？

> ID：741129
> 
> 赞同：1
> 
> 时间：2009-04-12T01:31:16.603
> 
> 标签：qt, x11

在推荐了[uclip](http://www.typo.co.il/~mooffie/uclip/)之后，我发现它不适用于复制。我开始调试这个，首先从 QT3 转换到 QT4 看看是否有帮助，但它没有任何区别，最终我发现这是一个[已知的错误](http://www.qtsoftware.com/developer/task-tracker/index_html?method=entry&id=114376)，但标记为“不会修复”：

> 这是在创建 QApplication 后立即设置剪贴板的副作用。X11 剪贴板是事件驱动的，因此依赖于来自 X 服务器的当前时间戳。这些时间戳由 QApplication 自动处理。然而，在这个简单的例子中，事件循环没有运行，因此我们没有从 X 服务器获取更新的时间戳，这反过来导致 QClipboard::ownsClipboard() 返回 false。设置剪贴板以响应例如键盘或鼠标事件使这项工作按预期工作。

使用 QClipboard::setText() 的理想最小代码应该类似于以下内容

```
#include <qapplication.h>
#include <qclipboard.h>

int main(int argc, char *argv[])
{
    QApplication app(argc, argv);

    QClipboard *cb = QApplication::clipboard();
    QString input = "Hello clipboard";
    cb->setText(input);

    return 0;
    //return app.exec(); makes no difference from return 0
} 
```

但是正如我所说，这行不通。通过反复试验，我想出了以下可行的方法

```
#include <qapplication.h>
#include <qclipboard.h>
#include <QTimer>
#include <QtGui>
#include <iostream>

class MyApplication : public QApplication {
    Q_OBJECT
public:
    MyApplication(int & argc, char ** argv) : QApplication(argc, argv)
    {
    }
public slots:
    void setClipboard()
    {
        QClipboard *cb = QApplication::clipboard();
        QString input = "THIS WORKS";
        std::cout << "setText line " << __LINE__+1 << "\n";
        cb->setText(input);
    }
};

class MainWidget:public QMainWindow {
public:
    MainWidget() {
        QClipboard *clipboard = QApplication::clipboard();
        std::cout << "setText line " << __LINE__+1 << "\n";
        clipboard->setText("This will not be copied to the clipboard, apparently also too early");
    }
};

int main(int argc, char *argv[])
{
    MyApplication app(argc, argv);

    QClipboard *cb = QApplication::clipboard();
    QString input = "This will not be copied to the clipboard, too early";
    std::cout << "setText line " << __LINE__+1 << "\n";
    cb->setText(input);

    //QTimer::singleShot(3, &app, SLOT(setClipboard())); // 3 ok, 2 not ok

    MainWidget mainWid;
    //mainWid.show();

    QTimer::singleShot(2, &app, SLOT(setClipboard())); // 2 ok, 1 not ok

    return app.exec();
}
#include "main.moc" 
```

但是，我确信这既不是最低限度也不是最好的方法。因此，我问，以最小的努力和影响生成这样一个所需的 X11 时间戳更新需要什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-12T15:53:57.513

我会尝试一下：

```
QApplication app(argc, argv);
// Paste something to your clipboard
app.processEvents(); 
```

这实际上使 Qt 应用程序的事件循环处理所有未决事件，如果您不像第一个示例中那样调用 app.exec()，则不会发生这种情况，并且与您在第二个示例中所做的非常相似实际上用计时器做一些等效的事情。我还没有尝试过，这也与文档的建议相去甚远（处理剪贴板作为对用户输入事件的响应）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-27T23:08:01.527

我相信你在 X11 上运气不好。由应用程序本身来管理 X11 剪贴板。因此，当您的应用程序关闭剪贴板上的数据时，数据就会丢失。

我认为你最好的选择是调用命令行`xclip`命令。将剪贴板上所需的文本通过管道传输到其中。我不确定这个命令通常有多可用。它必须在做一些可以用较低级别的 x 代码重新创建的事情吗？

# asp.net - ASP.net 中的文件路径

> ID：741131
> 
> 赞同：1
> 
> 时间：2009-04-12T01:35:59.667
> 
> 标签：asp.net, redirect

过去我对文件路径（相对的、物理的等）感到困惑。使用我的以下项目结构：

```
Solution MySolution
- MyProject
   -MiniApp Folder
     -MiniApp.aspx
   -Default.aspx
   -Default2.aspx 
```

请提供有关重定向（**例如 Response.Redirect("~/Default.aspx")**）导航的示例：

1.  Default.aspx 到 MiniApp.aspx
2.  MiniApp.aspx 到 Default.aspx
3.  Default.aspx 到 Default2.aspx

使用：

1.  物理路径
2.  相对路径
3.  我省略的任何其他路径

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-12T02:03:45.653

你不应该使用物理路径来重定向。

~ 将解析到您的应用程序 /MyProject 的根目录

下面的代码将从任何页面重定向到这些页面

```
Response.Redirect("~/Default.aspx");
Response.Redirect("~/Default2.aspx");
Response.Redirect("~/MiniApp/MiniApp.aspx"); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T13:15:56.300

正如 rm 所说，永远不要使用物理路径进行重定向，这是错误的，你应该将它用于文件 IO 操作，这里的任何方式都是在 ASP.net 中处理路径的示例

您还可以使用 Server.MapPath("~/Your RelativePath); 转换为物理路径。

# objective-c - 协议对象上的键值观察：addObserver 上的编译器警告：

> ID：741134
> 
> 赞同：11
> 
> 时间：2009-04-12T01:39:50.670
> 
> 标签：objective-c, cocoa, key-value-observing

我有一个带有属性的简单协议：

```
@protocol StopsSource <NSObject>
@property (retain,readonly) NSArray * stops;
@end 
```

我在其他地方添加了一个键值观察器来监听“stops”属性的变化：

```
id<StopsSource> source = ...
[source addObserver:self
         forKeyPath:@"stops"
            options:NSKeyValueObservingOptionNew
            context:nil]; 
```

代码按预期工作，因为当“停止”属性更改时，我得到了 observeValueForKeyPath 事件。真正的烦恼是 addObserver 调用上的编译器警告：

```
warning: '-addObserver:forKeyPath:options:context:' not found in protocol(s) 
```

'addObserver' 方法在 NSObject 的类别中定义：

```
@interface NSObject(NSKeyValueObserverRegistration) 
```

有没有办法让 XCode 放弃这个警告？我的理解是协议不能采用类别，所以我不确定如何将 NSKeyValueObserverRegistration 方法引入我的协议中，而不是将声明复制到协议本身中，这似乎是一种 hack。

我知道这是一个微不足道的问题，因为它只是一个编译器警告，但我很想知道是否有一种“正确”的方法来解决这个问题。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-12T03:13:53.800

> 真正的烦恼是 addObserver 调用上的编译器警告：
> 
> > ```
> > warning: '-addObserver:forKeyPath:options:context:' not found in protocol(s) 
> > ```
> 
> 'addObserver' 方法在 NSObject 的类别中定义：
> 
> ```
> @interface NSObject(NSKeyValueObserverRegistration) 
> ```
> 
> 有没有办法让 XCode 放弃这个警告？

Xcode（小写 c）只是向您显示警告；它是编译器 GCC，它首先给你警告。

您将NSObject*类*与*协议*NSObject 混淆了。NSObject 类遵守 NSObject 协议等，但协议与类没有关系。您的 StopsSource 协议，作为一个协议，继承自 NSObject 协议，而不是 NSObject 类。

您的声明仅涵盖这两个协议，而不是任何特定的类，因此它不包括 NSObject 类可能实现的那些协议之外的任何内容（例如 KVO）。这就是你收到警告的原因。

正如 Jason Coco 在他对您的问题的评论中告诉您的那样，解决方案是更改声明以使用 NSObject 类和您的协议：

```
NSObject <StopsSource> *source = …; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T01:59:40.157

我认为您可能对协议的作用感到困惑；它只是定义了一组可以由另一个类实现的操作。

你的协议中唯一的东西是一个属性。

另外，你为什么要声明它符合 NSObject 协议？您不需要这样做，因为如果您有一个采用您的协议的类，它将继承自 NSObject，因此将符合 . IE

```
@interface YourClass : NSObject <StopSource> {
    // etc
@end 
```

# iphone - 确定 iPhone 上的互联网可用性？

> ID：741145
> 
> 赞同：1
> 
> 时间：2009-04-12T01:49:03.393
> 
> 标签：iphone, objective-c

我在 iPhone 应用程序中使用 NSURLConnection，如下所示：

```
NSURLConnection *conn = [[NSURLConnection alloc] initWithRequest: request delegate: self]; 
```

该请求已设置并正常工作，但如果没有可用的连接，我希望能够向用户提供“连接不可用”消息。有没有一种快速的方法来确定 iPhone 上的 Internet 连接是否可用？

像在初始化 NSURLConnection 后添加以下内容一样简单：

```
if (conn) { // do normal processing } else { // display connection not available message } 
```

在此先感谢，本

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-12T09:39:04.653

这对我有用，取自苹果地震 xml 项目：

```
- (BOOL)isDataSourceAvailable
{
    static BOOL checkNetwork = YES;
    if (checkNetwork) { // Since checking the reachability of a host can be expensive, cache the result and perform the reachability check once.
        checkNetwork = NO;

        Boolean success;    
        const char *host_name = "twitter.com"; // your data source host name

        SCNetworkReachabilityRef reachability = SCNetworkReachabilityCreateWithName(NULL, host_name);
        SCNetworkReachabilityFlags flags;
        success = SCNetworkReachabilityGetFlags(reachability, &flags);
        _isDataSourceAvailable = success && (flags & kSCNetworkFlagsReachable) && !(flags & kSCNetworkFlagsConnectionRequired);
        CFRelease(reachability);
    }
    return _isDataSourceAvailable;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T21:01:38.210

Raj，该代码有效，但并不总是产生所需的结果。

iPhone 上 TCP 堆栈的工作方式与预期的完全不同。使用“可达性”代码，有时会出现网络连接，但无法可靠地检测到。但是，启动 MobileSafari 然后重新尝试使用“Reachability”代码（Raj 的代码）检查连接将产生正确的结果。

我发现确定网络连接最有效的方法是在应用程序加载时在单独的线程中运行 NSURLConnection 检查。调用您知道会返回类似“Yes”（即服务器上的 HTML 文件或其他内容）的 URL。然后检查以确保返回的结果等于静态文本。这样一来，您就知道 NSURLConnection 堆栈可以正确地伸出，而不是不能始终如一地工作的“Reachability”代码。

# .net - 在 .NET 中显示 NOAA 图表

> ID：741149
> 
> 赞同：2
> 
> 时间：2009-04-12T01:51:30.987
> 
> 标签：.net, mapping

NOAA 提供两种格式的免费海图：

1) “NOAA 电子航海图® (NOAA ENCs) 是代表 NOAA 最新、最强大的电子海图产品的矢量数据集。NOAA ENCs 符合国际水文局 (IHO) S-57 国际交换格式”

2) “NOAA Raster Navigational Charts® (NOAA RNCs) 是 NOAA 整套纸质海图的全彩数字图像……采用 BSB 格式。”

有谁知道在 Microsoft 的 .NET 中使用和显示这些格式的任何开源例程？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-12T02:15:49.790

你可以看看 SharpMap

*   [http://www.codeplex.com/SharpMap](http://www.codeplex.com/SharpMap)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T02:11:48.643

谷歌似乎提供了很好的链接，例如：

*   [ENC](http://www.nauticalcharts.noaa.gov/mcd/FAQ_ENC.html)
*   [BSB](http://www.nauticalcharts.noaa.gov/staff/charts.htm)

你为什么不说你看过那里却找不到任何你可以使用的东西？

# java - Java 3D 的未来是什么？

> ID：741161
> 
> 赞同：9
> 
> 时间：2009-04-12T02:01:47.577
> 
> 标签：java, java-3d

前段时间我读到关于 Java 3D 集成到 Java FX 中的文章，该文章报告说主要的 Java 3D 项目因为将 3D 引擎重写为 FX 是“死的”。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-12T04:18:58.947

Sun 已经表示他们不再专注于对 Java3D API 的改进。官方公告在：

[https://java3d.dev.java.net/servlets/NewsItemView?newsItemID=5689](https://java3d.dev.java.net/servlets/NewsItemView?newsItemID=5689) [http://forums.java.net/jive/thread.jspa?threadID=36022](http://forums.java.net/jive/thread.jspa?threadID=36022)

如您所见，Sun 本身正在将注意力转移到新的 3D 场景图形 API 上，该 API 最终将成为 JavaFX 的一部分。

否则，有许多可用于 Java 的高质量 3D API（例如[JMonkeyEngine](http://www.jmonkeyengine.com/)或[Ogre3D](http://www.ogre3d.org/)），或者您始终可以使用低级 API，例如[JOGL](https://jogl.dev.java.net/)和[LWJGL](http://lwjgl.org/)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2015-08-18T15:07:03.703

Sun Microsystems 于 2004 年夏季将 Java 3D 作为社区源项目发布，并于 2008 年 1 月 29 日放弃了它（正如 jsight 在上面的回答中所写的那样）。它在 2008 年 2 月 28 日发布了 GPL 2 下的全部源代码，但类路径异常。第一个社区版本是 Java 3D 1.5.2。

[哈维](https://github.com/hharrison/)多年来一直在维护它。我在 2012 年 2 月 10 日启动了 JOGL 渲染器的移植，从 JOGL 1 到 JOGL 2，它已经成为 JogAmp 社区的一个项目。它在 2015 年仍然活跃。它的公共 API 被冻结，它基本上保持不变。许多错误已得到修复。非常感谢 Harvey 和其他主要贡献者 :) Java 3D 1.6.0 可[在此处](http://jogamp.org/deployment/java3d/)获得，安装说明在[此处](http://jogamp.org/wiki/index.php/Downloading_and_installing_Java3D)。

Java 3D 1.6.0 是可靠的，但不是面向未来的。它依赖于固定的管道，它不能与 OpenGL ES 一起工作，它不支持任何向前兼容的配置文件。我们只修复错误，我们不会在其中实现任何新功能。

有许多替代方案，包括[JogAmp 的 Ardor3D Continuation](http://jogamp.org/wiki/index.php/Ardor3D_Tutorial)、[JMonkeyEngine](http://jmonkeyengine.org)、[LibGDX](https://libgdx.badlogicgames.com)、JavaFX 3D 图形功能……大多数主要的场景图形 API 都使用[JOGL](http://jogamp.org/jogl/www/)作为访问硬件加速的手段，但如果您寻找较低级别的东西，您可以直接使用它比Java 3D。

PS：一个新的贡献者在 Java3D 1.7.0 上工作，它将添加 Android 支持 :)

# asp.net - Can you use LINQ extension method operators in an ASP.NET databinding expression?

> ID：741169
> 
> 赞同：4
> 
> 时间：2009-04-12T02:07:25.487
> 
> 标签：asp.net, linq, data-binding

Is it possible to use a LINQ extension method within an ASP.NET databinding expression?

Within a GridView that is bound to a Customer collection which in-turn has a related Phones collection the following Eval expression fails:

```
<%# Eval("Phones.Single(p => p.PhoneTypeId == 2)") %> 
```

The error message I receive is: 'First(p => p' is not a valid indexed expression

Is this possible to use the LINQ extension method operations within a binding expression?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-12T03:25:26.610

No it is not. Lambda expressions are an advanced expression type that is not supported by Asp.Net data binding expressions. Binding expressions are a much simpler language. They only support property and field names (including indexer expressions).

[http://msdn.microsoft.com/en-us/library/4hx47hfe.aspx](http://msdn.microsoft.com/en-us/library/4hx47hfe.aspx)

# mysql - 使用 PHP 分页时的 MySQL 大表性能问题

> ID：741172
> 
> 赞同：6
> 
> 时间：2009-04-12T02:09:45.920
> 
> 标签：mysql, database, performance

有一个包含 300,000 条记录的巨大 mysql 表，并希望以这种方式通过查询在 PHP 中对记录进行分页（但这里不是重点）：

```
SELECT * FROM `table` LIMIT 250000, 100 
```

在记录的后半部分，它可能会很慢，尤其是在接近表的末尾时（LIMIT 开始非常大）。我的猜测是 MySQL 必须一直精确到 250000 才能将结果舀给我？

那么如何解决这个或任何其他可能更快的分页方法呢？谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-12T02:14:10.807

确保您使用的是索引，否则它正在执行全表扫描。您可以查看执行计划来验证这一点，或者使用`ORDER BY`子句（在索引列上）强制问题。这里有[更多信息](http://forums.mysql.com/read.php?24,24830,24830)。

您的表在 300k 行时并没有那么大。然而，接近表格末尾存在性能问题。唯一真正的解决方案是伪造限制条款。有一个自动增量字段，将行编号从 1 到 300,000，然后执行：

```
SELECT *
FROM mytable
WHERE field BETWEEN 250000 and 250100 
```

或类似的。如果您经常删除行，这可能是有问题的或不可能的，但我倾向于发现旧数据往往变化较少，因此您可以通过使用`LIMIT`前 100,000 行和除此之外的代理分页列来对其进行一些优化。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T02:15:18.713

你是对的：MySQL 必须先扫描 250000 行无用的行，然后才能读取你想要的行。实际上没有解决方法可以保存将表拆分为多个表或进行黑客攻击，例如：

```
SELECT * FROM table WHERE id BETWEEN 250000 AND 250000 + 100 - 1
;or
SELECT * FROM table WHERE id > 250000 ORDER BY id ASC LIMIT 100 
```

但这仍然不能准确地模拟`LIMIT`运算符对复杂查询的功能。这是速度：功能机会成本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T02:14:11.463

这真的是整个查询，还是您也有 ORDER BY 子句？因为这会严重减慢这样的查询。但是，如果您可以获得有关您订购的全套物品的索引，应该会有所帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-12T02:19:08.720

如果你有一个自动增量字段，你可以这样做：

```
SELECT * FROM table 
WHERE ID > @LastID 
ORDER BY ID
LIMIT 100 
```

# internet-explorer-6 - 没有javascript的IE6中的最小/最大宽度？

> ID：741175
> 
> 赞同：2
> 
> 时间：2009-04-12T02:14:09.763
> 
> 标签：internet-explorer-6, width, max, min

是否可以在不使用 javascript 的情况下在 IE6 中获得最小/最大宽度？

在一些相关的说明中，谷歌浏览器是否不理解，

```
<!--[if IE 6]><!-->
<!--<![endif]--> 
```

还是我只是搞砸了那个代码。谢谢。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-12T02:19:00.920

**第一个问题**：没有。`max-`您可以使用表格和图像对其进行排序，但不能以任何方式接近/的易用性`min-width`。

**第二个问题**：不 - 它认为它们与其他所有非 IE 浏览器一样，作为评论。也许你想要：

```
<!--[if IE 6]>
something IE6 should see
<![endif]--> 
```

请注意 XML/HTML 注释如何从第一行开始，直到最后一行才结束。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T03:43:27.317

是的，这就是“下层显示”的条件注释语法。它验证了，但除此之外没有太多用处。我建议使用 Shog9 列出的格式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T04:15:08.847

是的，你搞砸了。如果你想显示下层，它应该如下所示：

```
<![if IE 6]>
do something
<![endif]> 
```

这将使 IE 6 和所有其他非 IE 浏览器的“做某事”代码出现。IE 7 和 IE 8 不会使任何“做某事”可见。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-14T20:47:08.830

### 

这是最简单的解决方案！在我开始之前，我必须告诉你下拉选择框将在几乎所有浏览器中自动展开，除了 IE6.so .. 我会做一个浏览器检查 [ ie, IE6] 并将以下内容仅写入该浏览器。这里它去......首先检查浏览器..

代码将神奇地扩展下拉选择框。解决方案的唯一问题是 onmouseover 下拉将扩展为 420px .. 因为溢出 = hidden 我们隐藏扩展的下拉大小并将其显示为 170px；所以，箭头右侧的 ddl 将被隐藏，无法看到。但是选择框会扩大到420px；这是我们真正想要的。自己试试下面的代码，如果你喜欢就使用它。干杯。

.ctrDropDown { 宽度：420px; } .ctrDropDownClick { 宽度：420px; }

以上是IE6 css。通用 css [适用于所有其他浏览器] 应如下所示。

```
 .ctrDropDown
{
    width:170px; <%--this is the actual width of the dropdown list--%>
}
.ctrDropDownClick
{
    width:auto; <%-- this the width of the dropdown select box.--%>
} 
```

# haskell - 如何在 Haskell 中编写符号的限定名称？

> ID：741184
> 
> 赞同：20
> 
> 时间：2009-04-12T02:19:09.967
> 
> 标签：haskell, syntax, identifier, qualified-name

我在两个想要使用相同中缀运算符 ( `<*>`) 的不同 Haskell 模块之间发生了名称冲突。Haskell 98 报告说

```
modid.varsym 
```

是允许的，但我无法让它工作。这里的全部内容是`Test.hs`：

```
module Test
where

import qualified Test2 as T

three = T.<*> 
```

和`Test2.hs`：

```
module Test2
where
(<*>) = 3 
```

但是尝试编译会导致错误消息：

```
Test.hs:6:12: parse error on input `T.<*>' 
```

我试过`T.(<*>)`了，但这也不起作用。

如何引用在导入的模块中定义的符号名称`import qualified`？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-12T03:43:46.787

尝试

```
three = (T.<*>) 
```

将中缀运算符定义为整数很奇怪。让我们考虑`\\`（集合差分运算符）：

```
import qualified Data.List as L

foo = [1..5] L.\\ [1..3] -- evaluates to [4,5]
diff = (L.\\) 
```

正如你在上面看到的，`L.\\`是一个合格的中缀运算符；它仍然可以用作中缀运算符。要将其用作值，您需要在整个内容周围加上括号。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-12T06:21:56.077

请记住，我们导入符号包装的括号。例如

```
import T ((<*>)) 
```

所以导入合格是一样的：

```
import qualified T as Q

main = print (Q.<*>) 
```

# objective-c - 关闭键盘的简单方法？

> ID：741185
> 
> 赞同：382
> 
> 时间：2009-04-12T02:19:29.843
> 
> 标签：objective-c, cocoa-touch, sdk

我的表格中的许多表格单元格中散布着很多控件，我想知道是否有一种更简单的方法可以关闭键盘，而不必遍历我的所有控件并将它们全部作为第一响应者。我想问题是..我如何让当前的第一响应者使用键盘？

* * *

## 回答 #1

> 赞同：805
> 
> 时间：2010-09-14T01:13:30.577

尝试：

```
[self.view endEditing:YES]; 
```

* * *

## 回答 #2

> 赞同：126
> 
> 时间：2009-04-12T05:39:09.003

您可以使用 强制当前正在编辑的视图退出其第一响应者状态`[view endEditing:YES]`。这隐藏了键盘。

与, 不同`-[UIResponder resignFirstResponder]`，`-[UIView endEditing:]`将搜索子视图以找到当前的第一响应者。因此，您可以将它发送到您的顶级视图（例如`self.view`在 a 中`UIViewController`），它会做正确的事情。

（这个答案以前包括其他几个解决方案，它们也有效，但比必要的更复杂。我已经删除了它们以避免混淆。）

* * *

## 回答 #3

> 赞同：94
> 
> 时间：2013-01-05T01:32:58.677

您可以向应用程序发送一个 nil 目标操作，它会随时退出第一响应者，而不必担心当前哪个视图具有第一响应者状态。

目标-C：

```
[[UIApplication sharedApplication] sendAction:@selector(resignFirstResponder) to:nil from:nil forEvent:nil]; 
```

斯威夫特 3.0：

```
UIApplication.shared.sendAction(#selector(resignFirstResponder), to: nil, from: nil, for: nil) 
```

Nil 目标操作在 Mac OS X 上对于菜单命令很常见，这里是它们在 iOS 上的用途。

* * *

## 回答 #4

> 赞同：56
> 
> 时间：2011-06-27T22:00:56.400

老实说，我对这里提出的任何解决方案都不感兴趣。我确实找到了一种使用 TapGestureRecognizer 的好方法，我认为它可以解决您的问题的核心：当您单击键盘以外的任何东西时，关闭键盘。

1.  在 viewDidLoad 中，注册接收键盘通知并创建一个 UITapGestureRecognizer：

    ```
    NSNotificationCenter *nc = [NSNotificationCenter defaultCenter];

    [nc addObserver:self selector:@selector(keyboardWillShow:) name:
    UIKeyboardWillShowNotification object:nil];

    [nc addObserver:self selector:@selector(keyboardWillHide:) name:
    UIKeyboardWillHideNotification object:nil];

    tapRecognizer = [[UITapGestureRecognizer alloc] initWithTarget:self
    action:@selector(didTapAnywhere:)]; 
    ```

2.  添加键盘显示/隐藏响应器。在那里，您将 TapGestureRecognizer 添加和删除到 UIView 中，当被点击时应该关闭键盘。注意：您不必将其添加到所有子视图或控件中。

    ```
    -(void) keyboardWillShow:(NSNotification *) note {
        [self.view addGestureRecognizer:tapRecognizer];
    }

    -(void) keyboardWillHide:(NSNotification *) note
    {
        [self.view removeGestureRecognizer:tapRecognizer];
    } 
    ```

3.  TapGestureRecognizer 将在点击时调用您的函数，您可以像这样关闭键盘：

    ```
    -(void)didTapAnywhere: (UITapGestureRecognizer*) recognizer {    
        [textField resignFirstResponder];
    } 
    ```

这个解决方案的好处是它只过滤 Taps，而不是滑动。因此，如果您在键盘上方有滚动内容，则滑动仍会滚动并显示键盘。通过在键盘消失后移除手势识别器，未来对视图的点击会得到正常处理。

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2009-06-24T08:42:47.797

这是一种解决方案，通过在一个地方添加代码（因此不必为每个文本字段添加处理程序），`return`在*任何*文本字段中敲击键盘时都会消失：

* * *

考虑这种情况：

我有`viewcontroller`两个文本字段（用户名和密码）。和`viewcontroller`实现`UITextFieldDelegate`协议

我在 viewDidLoad 中这样做

```
- (void)viewDidLoad 
{
    [super viewDidLoad];

    username.delegate = self;
    password.delegate = self;
} 
```

并且视图控制器将可选方法实现为

```
- (BOOL)textFieldShouldReturn:(UITextField *)textField
{
    [textField resignFirstResponder];
    return YES;
} 
```

并且无论您在哪个文本字段中，只要我敲击`return`键盘，它就会被解雇！

在您的情况下，只要您将所有文本字段的委托设置为 self 并实现`textFieldShouldReturn`

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2009-04-13T06:36:50.153

更好的方法是让某些东西“窃取”第一响应者的身份。

由于 UIApplication 是 UIResponder 的子类，您可以尝试：

```
[[UIApplication sharedApplication] becomeFirstResponder]
[[UIApplication sharedApplication] resignFirstResponder] 
```

如果做不到这一点，请创建一个具有零大小框架的新 UITextField，将其添加到某处的视图中并执行类似的操作（然后是辞职）。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2011-06-24T17:27:57.147

把它藏在一些实用程序类中。

```
+ (void)dismissKeyboard {
    [self globalResignFirstResponder];
}

+ (void) globalResignFirstResponder {
    UIWindow * window = [[UIApplication sharedApplication] keyWindow];
    for (UIView * view in [window subviews]){
        [self globalResignFirstResponderRec:view];
    }
}

+ (void) globalResignFirstResponderRec:(UIView*) view {
    if ([view respondsToSelector:@selector(resignFirstResponder)]){
        [view resignFirstResponder];
    }
    for (UIView * subview in [view subviews]){
        [self globalResignFirstResponderRec:subview];
    }
} 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2010-09-14T17:07:57.177

@Nicholas Riley & @Kendall Helmstetter Geln & @cannyboy：

绝对精彩！

谢谢你。

考虑到您的建议和此线程中其他人的建议，这就是我所做的：

**使用时的样子：**

`[[self appDelegate] dismissKeyboard];` *（注意：我添加了 appDelegate 作为 NSObject 的补充，所以我可以在任何地方使用任何东西）*

**它在引擎盖下的样子：**

```
- (void)dismissKeyboard 
{
    UITextField *tempTextField = [[[UITextField alloc] initWithFrame:CGRectZero] autorelease];
    tempTextField.enabled = NO;
    [myRootViewController.view addSubview:tempTextField];
    [tempTextField becomeFirstResponder];
    [tempTextField resignFirstResponder];
    [tempTextField removeFromSuperview];
} 
```

**编辑**

修改我对包括的答案`tempTextField.enabled = NO;`。如果您在整个应用程序中依赖这些通知，禁用文本字段将阻止`UIKeyboardWillShowNotification`发送键盘通知。`UIKeyboardWillHideNotification`

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2011-09-17T15:44:04.930

当用户触摸 UITextField 或键盘之外的屏幕上的任何位置时如何在 iOS 中关闭键盘的快速提示。考虑到 iOS 键盘可以占用多少空间，为用户提供一种简单直观的方式来关闭键盘是很有意义的。

这是[一个链接](http://remarkablepixels.com/blog/2011/1/23/dismiss-iphone-keyboard.html)

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2012-03-29T21:28:31.983

这里有很多过于复杂的答案，可能是因为这在 iOS 文档中不容易找到。JosephH 就在上面：

```
[[view window] endEditing:YES]; 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2015-01-07T19:55:26.457

这是我在代码中使用的内容。它就像一个魅力！

在 yourviewcontroller.h 添加：

`@property (nonatomic) UITapGestureRecognizer *tapRecognizer;`

现在在 .m 文件中，将其添加到您的 ViewDidLoad 函数中：

```
- (void)viewDidLoad {
    //Keyboard stuff
    tapRecognizer = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(didTapAnywhere:)];
    tapRecognizer.cancelsTouchesInView = NO;
    [self.view addGestureRecognizer:tapRecognizer];
} 
```

此外，在 .m 文件中添加此函数：

```
- (void)handleSingleTap:(UITapGestureRecognizer *) sender
{
    [self.view endEditing:YES];
} 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2013-12-04T14:57:45.267

甚至比 Meagar 的答案更简单

覆盖`touchesBegan:withEvent:`

```
- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event
{
    [textField resignFirstResponder];`
} 
```

当`dismiss the keyboard`您触摸`background`.

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2015-09-17T20:19:26.870

您应该发送`endEditing:`到工作窗口作为子类`UIView`

```
[[UIApplication sharedApplication].windows.firstObject endEditing:NO]; 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2012-04-21T23:08:10.637

在视图控制器的头文件中添加`<UITextFieldDelegate>`控制器接口的定义，使其符合 UITextField 委托协议...

```
@interface someViewController : UIViewController <UITextFieldDelegate> 
```

...在控制器的实现文件 (.m) 中添加以下方法，或者如果您已经有 viewDidLoad 方法，则添加其中的代码...

```
- (void)viewDidLoad
{
    // Do any additional setup after loading the view, typically from a nib.
    self.yourTextBox.delegate = self;
} 
```

...然后，将 yourTextBox 链接到您的实际文本字段

```
- (BOOL)textFieldShouldReturn:(UITextField *)theTextField 
{
    if (theTextField == yourTextBox) {
        [theTextField resignFirstResponder];
    }
    return YES;
} 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2016-08-09T08:16:22.290

从 UITableView 和 UIScrollView 关闭键盘的最佳方法是：

```
tableView.keyboardDismissMode = UIScrollViewKeyboardDismissModeOnDrag 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2017-02-20T19:18:54.113

在 swift 3 中，您可以执行以下操作

```
UIApplication.shared.sendAction(#selector(UIResponder.resignFirstResponder), to: nil, from: nil, for: nil) 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2010-11-23T18:45:50.283

杰里米的回答对我来说不太有效，我想是因为我在选项卡视图中有一个导航堆栈，上面有一个模式对话框。我现在正在使用以下内容，它对我有用，但您的里程可能会有所不同。

```
 // dismiss keyboard (mostly macro)
[[UIApplication sharedApplication].delegate dismissKeyboard]; // call this in your to app dismiss the keybaord

// --- dismiss keyboard (in indexAppDelegate.h) (mostly macro)
- (void)dismissKeyboard;

// --- dismiss keyboard (in indexAppDelegate.m) (mostly macro)
// do this from anywhere to dismiss the keybard
- (void)dismissKeyboard {    // from: http://stackoverflow.com/questions/741185/easy-way-to-dismiss-keyboard

    UITextField *tempTextField = [[UITextField alloc] initWithFrame:CGRectZero];

    UIViewController *myRootViewController = <#viewController#>; // for simple apps (INPUT: viewController is whatever your root controller is called.  Probably is a way to determine this progragrammatically)
    UIViewController *uivc;
    if (myRootViewController.navigationController != nil) { // for when there is a nav stack
        uivc = myRootViewController.navigationController;
    } else {
        uivc = myRootViewController;
    }

    if (uivc.modalViewController != nil) { // for when there is something modal
        uivc = uivc.modalViewController;
    } 

    [uivc.view  addSubview:tempTextField];

    [tempTextField becomeFirstResponder];
    [tempTextField resignFirstResponder];
    [tempTextField removeFromSuperview];
    [tempTextField release];

} 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2012-07-16T12:55:15.770

在某些情况下，您可能还需要覆盖 UIViewController disablesAutomaticKeyboardDismissal 以使其正常工作。如果您有 UINavigationController，这可能必须在其上完成。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2013-10-11T14:53:06.827

子类化您的文本字段...以及文本视图

在子类中放置此代码..

```
-(void)conformsToKeyboardDismissNotification{

    [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(dismissKeyBoard) name:KEYBOARD_DISMISS object:nil];
}

-(void)deConformsToKeyboardDismissNotification{

    [[NSNotificationCenter defaultCenter] removeObserver:self name:KEYBOARD_DISMISS object:nil];
}

- (void)dealloc{
    [[NSNotificationCenter defaultCenter] removeObserver:self];
    [self resignFirstResponder];
} 
```

在文本字段代表中（类似于 textview 代表）

```
-(void)textFieldDidBeginEditing:(JCPTextField *)textField{
     [textField conformsToKeyboardDismissNotification];
}

- (void)textFieldDidEndEditing:(JCPTextField *)textField{
    [textField deConformsToKeyboardDismissNotification];
} 
```

一切就绪.. 现在只需在代码中的任何位置发布通知。它将放弃任何键盘。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2015-03-31T08:16:43.943

我们可以迅速做到

```
UIApplication.sharedApplication().sendAction("resignFirstResponder", to: nil, from: nil, forEvent: nil) 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2015-12-02T05:32:11.860

要在键盘弹出后关闭键盘，有**两种情况**，

1.  当 UITextField**在 UIScrollView 内时**

2.  当 UITextField**在 UIScrollView 之外时**

2.当 UITextField 在 UIScrollView 之外时，覆盖 UIViewController 子类中的方法

您还必须**为所有 UITextView 添加委托**

```
- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event {
    [self.view endEditing:YES];
} 
```

1.  在**滚动视图中，Tapping outside 不会触发任何事件**，因此在这种情况下，请**使用 Tap Gesture Recognizer**，拖放滚动视图的**UITapGesture并****为其创建 IBAction**。

要创建 IBAction，请按 ctrl+ 单击 UITapGesture 并将其拖到 viewcontroller 的 .h 文件中。

在这里，我将 tappedEvent 命名为我的操作名称

```
- (IBAction)tappedEvent:(id)sender {
      [self.view endEditing:YES];  } 
```

以上给出的信息来源于以下链接，如果您不理解以上数据，请参考更多信息或与我联系。

[http://samwize.com/2014/03/27/dismiss-keyboard-when-tap-outside-a-uitextfield-slash-uitextview/](http://samwize.com/2014/03/27/dismiss-keyboard-when-tap-outside-a-uitextfield-slash-uitextview/)

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2009-11-30T15:49:47.680

我讨厌在不使用私有 API 调用的情况下以编程方式关闭键盘的“全局”方式。通常，我需要在不知道第一响应者是什么对象的情况下以编程方式关闭键盘。我已经`self`使用 Objective-C 运行时 API 进行检查，枚举其所有属性，提取那些 type 的属性，`UITextField`并向它们发送`resignFirstResponder`消息。

做这件事应该不难……

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2010-05-24T18:34:26.053

这并不漂亮，但是当我不知道响应者是什么时，我辞去 firstResponder 的方式：

在 IB 中或以编程方式创建 UITextField。使其隐藏。如果您在 IB 中制作，请将其链接到您的代码。然后，当您想关闭键盘时，将响应者切换到不可见的文本字段，并立即将其退出：

```
 [self.invisibleField becomeFirstResponder];
  [self.invisibleField resignFirstResponder]; 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2010-09-10T21:04:44.413

您可以递归地遍历子视图，存储所有 UITextField 的数组，然后循环遍历它们并全部退出。

不是一个很好的解决方案，特别是如果你有很多子视图，但对于简单的应用程序它应该可以解决问题。

我以一种更复杂但性能更高的方式解决了这个问题，但是对我的应用程序的动画引擎使用单例/管​​理器，并且任何时候文本字段成为响应者，我都会将其分配给一个静态的，它将得到根据某些其他事件席卷（辞职）......我几乎不可能在一段中解释。

要有创意，在我发现这个问题后，我只花了 10 分钟就为我的应用考虑了这个问题。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2010-12-22T14:33:54.807

最简单的方法是调用方法

```
- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event 
{
    if(![txtfld resignFirstResponder])
    {
        [txtfld resignFirstResponder];
    }
    else
    {

    }
    [super touchesBegan:touches withEvent:event];
} 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2015-03-09T06:04:36.460

我最近需要使用的一种更强大的方法：

```
- (void) dismissKeyboard {
    NSArray *windows = [UIApplication sharedApplication].windows;

    for(UIWindow *window in windows) [window endEditing:true];

    //  Or if you're only working with one UIWindow:

    [[UIApplication sharedApplication].keyWindow endEditing:true];
} 
```

我发现其他一些“全局”方法不起作用（例如，`UIWebView`&`WKWebView`拒绝辞职）。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2015-03-24T11:23:47.727

将一个点击手势识别器添加到您的视图中。并将其定义为 ibaction

你的 .m 文件会像

```
 - (IBAction)hideKeyboardGesture:(id)sender {
    NSArray *windows = [UIApplication sharedApplication].windows;
    for(UIWindow *window in windows) [window endEditing:true];
    [[UIApplication sharedApplication].keyWindow endEditing:true];
} 
```

它对我有用

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2016-07-01T10:02:30.890

是的，endEditing 是最好的选择。从 iOW 7.0 开始，`UIScrollView`有一个很酷的功能可以在与滚动视图交互时关闭键盘。为此，您可以设置`keyboardDismissMode`.`UIScrollView`

将键盘关闭模式设置为：

```
tableView.keyboardDismissMode = UIScrollViewKeyboardDismissModeOnDrag 
```

它几乎没有其他类型。看看这个[苹果文档](https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIScrollView_Class/#//apple_ref/c/tdef/UIScrollViewKeyboardDismissMode)。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2016-07-05T14:06:32.760

迅速：

```
self.view.endEditing(true) 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2016-09-14T08:15:13.377

您必须使用其中一种方法，

```
[self.view endEditing:YES]; 
```

或者

```
[self.textField resignFirstResponder]; 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2016-10-05T06:07:08.593

**更新**

我找到了另一种简单的方法

只需声明一个属性：-

```
@property( strong , nonatomic) UITextfield *currentTextfield; 
```

和一个 Tap Gecognizer：-

```
@property (strong , nonatomic) UITapGestureRecognizer *resignTextField; 
```

**在 ViewDidLoad**

```
_currentTextfield=[[UITextField alloc]init];
_resignTextField=[[UITapGestureRecognizer alloc]initWithTarget:@selector(tapMethod:)];

[self.view addGestureRecognizer:_resignTextField]; 
```

**实现文本字段委托方法 didBeginEditing**

```
 -(void)textFieldDidBeginEditing:(UITextField *)textField{

      _currentTextfield=textField;

    } 
```

**实现您的点击手势方法 (_resignTextField)**

```
 -(void)tapMethod:(UITapGestureRecognizer *)Gesture{

     [_currentTextfield resignFirstResponder];

 } 
```

# java - 使用 JMock 测试具体的第三方类

> ID：741186
> 
> 赞同：3
> 
> 时间：2009-04-12T02:19:35.473
> 
> 标签：java, unit-testing, jmock

我有一个转发方法的类`foo`：

```
void foo( Concrete c, String s ) { c.bar( s ); } 
```

我想测试是否`foo`确实转发。对我来说不幸的是，`Concrete`它是第三方库中的一个类，是一个具体的类型，而不是一个接口。因此我必须`ClassImposteriser`在 JMock 中使用来模拟`Concrete`，所以在我的测试用例中，我这样做：

```
@Test
public final void testFoo() {
   Mockery context = new JUnit4Mockery() {{
      setImposteriser(ClassImposteriser.INSTANCE);
   }};

  final Concrete c = context.mock(Concrete.class);
  final String s = "xxx" ;

  // expectations
  context.checking(new Expectations() {{

     oneOf (c).bar(s); // exception gets thrown from here
  }});

  new ClassUnderTest.foo( c, s );
  context.assertIsSatisfied(); 
```

}

不幸的是，`Concrete.bar`反过来又调用了一个抛出的方法。该方法是最终的，所以我不能覆盖它。此外，即使我注释掉该行`new ClassUnderTest.foo( c, s );`，当 JMock 设置异常时抛出异常，而不是在`foo`调用时抛出异常。

那么我如何测试该方法`ClassUnderTest.foo`确实转发到`Concrete.bar`？

编辑：
是的，酒吧是最终的。

我的解决方案*不是*通用的，是使用第三方库中的“Tester”类来正确设置`Concrete`.

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-12T06:37:40.987

从问题文本中不清楚 Concrete.bar() 是否是最终的，或者 Concrete.somethingElse() 是否是最终的并从 Concrete.bar() 调用。

如果 Concrete.bar()**不是 final**，请为 Concrete 创建一个手写存根，如下所示：

```
public class ConcreteStub extends Concrete
{
    public int numCallsToBar = 0;
    @Override
    public void bar(String s) { numCallsToBar++; }
} 
```

并在您的测试代码中：

```
ConcreteStub c = new ConcreteStub();
foo(c,"abc");
assertEquals(1,c.numCallsToBar); 
```

如果 Concrete.bar()**是 final**，它会更复杂，答案取决于 Concrete 的复杂性和您的项目对 Concrete 类的使用。如果您对 Concrete 的使用足够简单，我会考虑将 Concrete 包装在一个接口（[适配器模式](http://en.wikipedia.org/wiki/Adapter_pattern)）中，然后您可以更轻松地模拟出来。

适配器模式解决方案的好处：可能通过在项目使用具体之后命名接口来阐明行为。更容易测试。

适配器模式解决方案的缺点：引入更多类，可能对生产代码几乎没有好处。我不知道 Concrete 做了什么，将 Concrete 包装在界面中可能不切实际。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-22T20:02:07.620

有关模拟类以及如何绕过最终限制的信息，请参见[http://www.jmock.org/mocking-classes.html 。](http://www.jmock.org/mocking-classes.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T12:15:20.203

如果一个方法是最终的，那么我们就无能为力了。如果这是一个第三方库，那么我们会考虑将它包装在一个 veneer 层并模拟*它*，然后进行集成测试以针对该库进行测试。还有其他框架可以模拟锁定代码，但我们不支持它，因为我们认为这不是一个好主意。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-12-31T14:39:56.473

使用功能更强大的模拟工具，例如[JMockit](http://code.google.com/p/jmockit)。然后你的测试可以写成：

```
@Test
public void testFoo(final Concrete c)
{
  final String s = "xxx";

  new Expectations() {{
    c.bar(s);
  }};

  new ClassUnderTest().foo(c, s);
} 
```

`Concrete`对于 JMockit，它是一个接口、一个最终类、一个抽象类或其他什么都没有区别。此外，无需使用`@RunWith`、扩展基本测试类或调用任何方法，例如`assertIsSatisfied()`; 这一切都是以透明的方式自动完成的。

# c++ - 多维数组 (C++)

> ID：741190
> 
> 赞同：0
> 
> 时间：2009-04-12T02:26:11.370
> 
> 标签：c++, pointers, multidimensional-array, memory-management

我正在尝试将指针存储在数组中。

我指向指针的指针是类对象是：

```
classType **ClassObject; 
```

所以我知道我可以像这样使用 new 运算符来分配它：

```
ClassObject = new *classType[ 100 ] = {}; 
```

我正在阅读一个带有标点符号的文本文件，这是我目前所拥有的：

```
// included libraries
// main function
// defined varaibles

classType **ClassObject; // global object
const int NELEMENTS = 100; // global index

wrdCount = 1;  // start this at 1 for the 1st word
while ( !inFile.eof() )  
{
   getline( inFile, str, '\n' );  // read all data into a string varaible
   str = removePunct(str);  // User Defined Function to remove all punctuation.
   for ( unsigned x = 0; x < str.length(); x++ )
   {
       if ( str[x] == ' ' ) 
       {
          wrdCount++;  // Incrementing at each space
          ClassObject[x] = new *classType[x];
       // What i want to do here is allocate space for each word read from the file.

       }
   }
}
// this function just replaces all punctionation with a space
string removePunct(string &str) 
{ 
    for ( unsigned x = 0; x < str.length(); x++ )
        if ( ispunct( str[x] ) )
            str[x] = ' ';
  return str;
}

// Thats about it. 
```

我想我的问题是：

*   我是否为文件中的每个单词分配了空间？
*   我将如何在我的 while/for 循环中的 ClassObject 数组中存储一个指针？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-12T02:34:40.663

如果您使用 C++，请使用[Boost 多维数组库](http://www.boost.org/doc/libs/1_38_0/libs/multi_array/doc/user.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T03:08:02.020

嗯，我不确定你想做什么（尤其是 new *classType[x] - 这甚至可以编译吗？）

如果你想要每个单词都有一个新的 classType，那么你可以去

```
ClassObject[x] = new classType; //create a _single_ classType
ClassObject[x]->doSomething(); 
```

前提是 ClassObject 已初始化（如您所说）。

你说你想要一个二维数组 - 如果你想这样做，那么语法是：

```
ClassObject[x] = new classType[y]; //create an array of classType of size y
ClassObject[0][0].doSomething(); //note that [] dereferences automatically 
```

但是，我也不确定你所说的 new *classType[ 100 ] = {}; 是什么意思。- 花括号在那里做什么？好像应该是

```
classType** classObject = new classType*[100]; 
```

不过，我强烈建议你使用其他东西，因为这真的很讨厌（而且你必须注意删除......呃）

使用 vector<>s 或如上面的海报所建议的那样，使用 boost 库。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T03:15:27.587

除了一行之外，您的代码非常好： `ClassObject[x] = new *classType[x];` 星 * 需要消失，您可能想说的是您希望 ClassObject 被索引到*字数*而不是 x。

将该行替换为： `ClassObject[wrdCount] = new classType[x];`

希望有帮助，Billy3

# rest - 在 HTTP DELETE 方面查看幂等性的正确方法是什么？

> ID：741192
> 
> 赞同：15
> 
> 时间：2009-04-12T02:26:57.843
> 
> 标签：rest, http, idempotent

我最近花了很多时间阅读 HTTP 1.1 规范并将其与 REST 相关联。我发现对于 HTTP DELETE 方法的“幂等性”和安全性有两种解释。以下是两个阵营：

1.  如果您使用 HTTP DELETE 删除资源，并且成功（200 OK），然后您尝试删除该资源 N 次，您应该为每个删除调用返回一条成功消息（200 OK） . 这就是它的“幂等性”。

2.  如果您使用 HTTP DELETE 删除资源，并且成功（200 OK），然后您尝试再次删除该资源，您应该会收到一条错误消息（410 Gone），因为该资源已被删除。

规范说 DELETE 是幂等的，当然，但它也说幂等事件的序列仍然会产生副作用。我真的觉得第二个阵营是正确的，而第一个是误导性的。通过允许客户认为他们是删除先前删除的资源的原因，我们引入了哪些“安全性”？

第一个阵营有很多人，包括这个主题的几位作者，所以我想检查是否有一些令人信服的理由，而不是情绪导致人们进入第一个阵营。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-04-12T02:51:13.917

幂等并不意味着不允许请求有副作用（这就是“安全”属性所描述的）。这只是意味着多次发出相同的请求不会导致不同或额外的副作用。

在我看来，随后的 DELETE 请求应该返回一个错误 - 它仍然是幂等的，因为服务器的状态与只发出一个 DELETE 请求相同。然后再次返回 200 OK 状态也应该没问题 - 我认为幂等*不需要*为后续的 DELETE 请求返回错误代码 - 只是返回错误状态对我来说似乎更有意义。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-10-22T18:58:01.500

@MichaelBurr 关于幂等性和副作用是正确的。

我的观点是，给定的 REST 请求涉及两种状态，即客户端状态和服务器状态。REST 就是在服务器和客户端之间传输这些状态，以便客户端的状态映射到服务器状态的子集，换句话说，子集与服务器保持一致。因为这种幂等性应该意味着后续的幂等请求不会导致任何一个状态与仅发出一次请求不同。使用第一个 DELETE，您可以想象服务器删除资源并让客户端知道它也可以删除资源（因为资源“不再存在”）。现在这两个状态应该与之前相同，减去已删除的项目。为了让客户端在尝试删除已删除的项目时做任何不同的事情，那么从服务器传输到客户端的状态必须包含不同的信息。服务器可以对资源已经被删除的信息做一些稍微不同的事情，但是一旦它用不同的东西做出响应，方法的幂等性就基本上被破坏了。

对于幂等函数：

```
delete(client_state) -> client_state - {item}
delete(delete(client_state)) -> client_state - {item}
delete(client_state) = delete(delete(client_state)) 
```

保证这种幂等性的最好方法是如果服务器的响应是相同的，这意味着客户端状态打破幂等性的唯一方法是在客户端处理响应时存在不确定性或副作用（这可能指向处理响应的错误实现）。

如果客户端和服务器之间就状态代码存在于正在传输的状态表示（REST）之外的协议达成一致，则可以通知客户端该项目“不再存在”（因为它会在第一个请求中）以及先前已删除的额外评论。客户端如何处理这些信息尚不清楚，但它不应该影响生成的客户端状态。但是状态码不能用于传达状态，或者更确切地说，如果它在其他情况下也传达状态（例如“您无权删除此项目”或“项目未删除”），那么有一些引入歧义或混乱。所以，*并且*仍然让服务器的响应取决于先前相同的 DELETE 请求。

HTTP 请求涉及删除方法，因此该函数可能类似于

```
delete(client_state) = send_delete(client_state) -> receive_delete(client_state) 
                                                 -> respond_to_delete(informative_state) 
                                                 -> handle_response(informative_state) 
                                                 -> client_state - {item} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-10-15T07:14:43.670

[维基百科](http://en.wikipedia.org/wiki/Idempotence)将幂等性定义为：

> 可以多次应用而不改变初始应用之外的结果。

请注意，他们谈论的`result`是操作。对我来说，这包括**服务器**状态**和**响应代码。

HTTP 规范在这个问题上有点模糊。它[定义它](https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-p2-semantics-24#section-4.2.2)指定 HTTP 方法是幂等的：

> 如果多个相同请求的预期效果与单个请求相同。

如果您`effect`按照`result`维基百科的定义进行解释，那么它们的含义相同。无论如何，我质疑告诉客户资源已被删除的实际好处。

最后一点：幂等性是根据单个客户端定义的。一旦你开始引入其他客户端的并发请求，所有的赌注都没有了。您应该使用条件更新标头（例如`If-Match-ETag`）来处理这种情况。

重申一下：**您应该返回相同的返回码，无论资源刚刚被删除、被先前的请求删除，还是根本不存在。**

# c# - 在 C# 中通过 C DLL 使用数组和指针

> ID：741206
> 
> 赞同：1
> 
> 时间：2009-04-12T02:56:00.723
> 
> 标签：c#, arrays, dll, pointers, double

我对 C# 很陌生（过去一周才开始学习）。

我有一个用 C 语言编写的自定义 DLL，它具有以下功能：

```
DLLIMPORT void test_function (double **test) 
```

我要做的是从 C# 中为数组“测试”提供一个指针。

因此，如果在 DLL 函数中我有 test[0] = 450.60、test[1] = 512.99 等。我希望能够在我的 C# 程序中使用它。

在 C# 程序中，我有类似的东西：

```
namespace TestUtil
{
  public class Echo
  {
    public double[] results = new double[10];
    public double[] results_cpy = new double[10];

    [DllImport("test_dll.dll", CallingConvention = CallingConvention.Cdecl)]
    static extern unsafe void test_function(ref double[] Result);

    public unsafe void Tell()
    {
      results[0] = 0.0;
      results[1] = 0.0;

      results_cpy[0] = 0.0;
      results_cpy[1] = 0.0;

      test_function(ref results);
      results_cpy[0] = (double)results[0] + (double)results[1] ;
    }
  }
} 
```

在 DLL 的“test_function”函数中，我使用了以下内容：

```
*test[0] = 450.60;
*test[1] = 512.99; 
```

在 DLL 中一切正常（我在 DLL 中使用了一个消息框来检查正在应用的值）。回到 C# 程序中，'results[0]' 似乎很好，我可以从中获取值，但 'results[1]' 给了我一个索引越界错误。我知道这一点，因为如果我省略 '+ (double)results[1]' 我不会收到错误。此外，如果我没有尝试在 DLL 中修改“test[1]”，它会保留 C# 的原始值（在我的示例中为 0.0）。

显然我没有做正确的事情，但这是我能够让它工作的最接近的事情。我尝试过的其他一切都失败了。

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-12T03:34:37.183

不需要不安全的代码。事实上，根本没有必要通过引用传递。如果您的签名如下所示：

```
void test_function (double *test) 
```

你的导入看起来像这样：

```
static extern void test_function(double[] Result); 
```

然后一切都应该正常工作。也就是说，假设你只需要修改数组而不返回一个全新的数组。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T03:11:56.223

我猜你已经知道 C++；如果是这种情况，您真的应该看看 C++/CLI，它可以让您轻松使用 C++ 中的托管代码 (.NET)。您上面显示的代码确实不是很像 C#（您应该完全避免使用`unsafe`）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T03:33:13.067

[关于 SO here](https://stackoverflow.com/questions/209258/dllimport-int-how-to-do-this-if-it-can-be-done)的类似问题。您正在查看一个不透明的指针，因此它很可能是另一个线程中描述的按引用系统 InPtr。

顺便说一句，为什么不让它成为双 * 而不是双**。我想这会让生活更轻松。

# c++ - 在 C++ 中将 32 位数字拆分为字节的最快方法

> ID：741212
> 
> 赞同：3
> 
> 时间：2009-04-12T03:08:04.717
> 
> 标签：c++, byte

我正在编写一段代码，旨在对 CLSID 结构进行一些数据压缩。我将它们存储为 128 位整数的压缩流。但是，有问题的代码必须能够将无效的 CLSID 放入流中。为了做到这一点，我把它们留成了一根大绳子。在磁盘上，它看起来像这样：

```
+--------------------------+-----------------+------------------------+
|                          |                 |                        |
| Length of Invalid String | Invalid String  | Compressed Data Stream |
|                          |                 |                        |
+--------------------------+-----------------+------------------------+ 
```

为了编码字符串的长度，我需要输出 32 位整数，即字符串的长度，一次一个字节。这是我当前的代码：

```
std::vector<BYTE> compressedBytes;
DWORD invalidLength = (DWORD) invalidClsids.length();
compressedBytes.push_back((BYTE)  invalidLength        & 0x000000FF);
compressedBytes.push_back((BYTE) (invalidLength >>= 8) & 0x000000FF));
compressedBytes.push_back((BYTE) (invalidLength >>= 8) & 0x000000FF));
compressedBytes.push_back((BYTE) (invalidLength >>= 8)); 
```

这段代码不会经常被调用，但在解码阶段需要有一个类似的结构被调用数千次。我很好奇这是否是最有效的方法，或者是否有人可以提出更好的方法？

谢谢大家！

比利3

编辑：查看了一些答案后，我创建了这个迷你测试程序，看看哪个是最快的：

```
// temp.cpp : Defines the entry point for the console application.
//

#include "stdafx.h"
#include <windows.h>
#include <ctime>
#include <iostream>
#include <vector>

void testAssignedShifts();
void testRawShifts();
void testUnion();

int _tmain(int argc, _TCHAR* argv[])
{
    std::clock_t startTime = std::clock();
    for (register unsigned __int32 forLoopTest = 0; forLoopTest < 0x008FFFFF; forLoopTest++)
    {
        testAssignedShifts();
    }
    std::clock_t assignedShiftsFinishedTime = std::clock();
    for (register unsigned __int32 forLoopTest = 0; forLoopTest < 0x008FFFFF; forLoopTest++)
    {
        testRawShifts();
    }
    std::clock_t rawShiftsFinishedTime = std::clock();
    for (register unsigned __int32 forLoopTest = 0; forLoopTest < 0x008FFFFF; forLoopTest++)
    {
        testUnion();
    }
    std::clock_t unionFinishedTime = std::clock();
    std::printf(
        "Execution time for assigned shifts: %08u clocks\n"
        "Execution time for raw shifts:      %08u clocks\n"
        "Execution time for union:           %08u clocks\n\n",
        assignedShiftsFinishedTime - startTime,
        rawShiftsFinishedTime - assignedShiftsFinishedTime,
        unionFinishedTime - rawShiftsFinishedTime);
    startTime = std::clock();
    for (register unsigned __int32 forLoopTest = 0; forLoopTest < 0x008FFFFF; forLoopTest++)
    {
        testAssignedShifts();
    }
    assignedShiftsFinishedTime = std::clock();
    for (register unsigned __int32 forLoopTest = 0; forLoopTest < 0x008FFFFF; forLoopTest++)
    {
        testRawShifts();
    }
    rawShiftsFinishedTime = std::clock();
    for (register unsigned __int32 forLoopTest = 0; forLoopTest < 0x008FFFFF; forLoopTest++)
    {
        testUnion();
    }
    unionFinishedTime = std::clock();
    std::printf(
        "Execution time for assigned shifts: %08u clocks\n"
        "Execution time for raw shifts:      %08u clocks\n"
        "Execution time for union:           %08u clocks\n\n"
        "Finished. Terminate!\n\n",
        assignedShiftsFinishedTime - startTime,
        rawShiftsFinishedTime - assignedShiftsFinishedTime,
        unionFinishedTime - rawShiftsFinishedTime);

    system("pause");
    return 0;
}

void testAssignedShifts()
{
    std::string invalidClsids("This is a test string");
    std::vector<BYTE> compressedBytes;
    DWORD invalidLength = (DWORD) invalidClsids.length();
    compressedBytes.push_back((BYTE)  invalidLength);
    compressedBytes.push_back((BYTE) (invalidLength >>= 8));
    compressedBytes.push_back((BYTE) (invalidLength >>= 8));
    compressedBytes.push_back((BYTE) (invalidLength >>= 8));
}
void testRawShifts()
{
    std::string invalidClsids("This is a test string");
    std::vector<BYTE> compressedBytes;
    DWORD invalidLength = (DWORD) invalidClsids.length();
    compressedBytes.push_back((BYTE) invalidLength);
    compressedBytes.push_back((BYTE) (invalidLength >>  8));
    compressedBytes.push_back((BYTE) (invalidLength >>  16));
    compressedBytes.push_back((BYTE) (invalidLength >>  24));
}

typedef union _choice
{
    DWORD dwordVal;
    BYTE bytes[4];
} choice;

void testUnion()
{
    std::string invalidClsids("This is a test string");
    std::vector<BYTE> compressedBytes;
    choice invalidLength;
    invalidLength.dwordVal = (DWORD) invalidClsids.length();
    compressedBytes.push_back(invalidLength.bytes[0]);
    compressedBytes.push_back(invalidLength.bytes[1]);
    compressedBytes.push_back(invalidLength.bytes[2]);
    compressedBytes.push_back(invalidLength.bytes[3]);
} 
```

运行几次会导致：

```
Execution time for assigned shifts: 00012484 clocks
Execution time for raw shifts:      00012578 clocks
Execution time for union:           00013172 clocks

Execution time for assigned shifts: 00012594 clocks
Execution time for raw shifts:      00013140 clocks
Execution time for union:           00012782 clocks

Execution time for assigned shifts: 00012500 clocks
Execution time for raw shifts:      00012515 clocks
Execution time for union:           00012531 clocks

Execution time for assigned shifts: 00012391 clocks
Execution time for raw shifts:      00012469 clocks
Execution time for union:           00012500 clocks

Execution time for assigned shifts: 00012500 clocks
Execution time for raw shifts:      00012562 clocks
Execution time for union:           00012422 clocks

Execution time for assigned shifts: 00012484 clocks
Execution time for raw shifts:      00012407 clocks
Execution time for union:           00012468 clocks 
```

看起来是关于分配班次和工会之间的联系。由于我稍后将需要该值，因此它是联合！谢谢！

比利3

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-12T03:11:51.963

这可能与您将得到的一样优化。位旋转操作是处理器上最快的一些操作。

>> 16, >> 24 而不是 >>= 8 >>= 8 可能会更快-您减少了分配。

另外，我认为您不需要 & - 因为您要转换为 BYTE（*应该*是 8 位字符），所以无论如何它都会被适当地截断。（是吗？如果我错了请纠正我）

不过，总而言之，这些都是很小的变化。对其进行分析以查看它是否真的有所作为：P

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-12T03:21:06.123

只需使用联合：

```
assert(sizeof (DWORD) == sizeof (BYTE[4]));   // Sanity check

union either {
    DWORD dw;
    struct {
         BYTE b[4];
    } bytes;
};

either invalidLength;
invalidLength.dw = (DWORD) invalidClsids.length();
compressedBytes.push_back(either.bytes.b[0]);
compressedBytes.push_back(either.bytes.b[1]);
compressedBytes.push_back(either.bytes.b[2]);
compressedBytes.push_back(either.bytes.b[3]); 
```

**注意：与原始问题中的位移方法不同，此代码产生与字节序相关的输出。** 仅当在一台计算机上运行的程序的输出将在具有不同字节顺序的计算机上读取时，这才重要——但由于使用此方法似乎没有可测量的速度增加，您不妨使用更便携的位移方法， 以防万一。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-12T03:27:30.990

您应该衡量而不是猜测任何潜在的改进，但我的第一个想法是按如下方式进行联合*可能会更快：*

```
typedef union {
    DWORD d;
    struct {
        BYTE b0;
        BYTE b1;
        BYTE b2;
        BYTE b3;
    } b;
} DWB;

std::vector<BYTE> compBytes;
DWB invLen;
invLen.d = (DWORD) invalidClsids.length();
compBytes.push_back(invalidLength.b.b3);
compBytes.push_back(invalidLength.b.b2);
compBytes.push_back(invalidLength.b.b1);
compBytes.push_back(invalidLength.b.b0); 
```

这*可能*是推回的正确顺序，但请检查以防万一——这取决于 CPU 的字节序。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-12T03:21:27.620

一种真正快速的方法是将 DWORD*（单元素数组）视为 BYTE*（4 元素数组）。代码也更具可读性。

警告：我没有编译这个

警告：这会使您的代码依赖于字节顺序

```
std::vector<BYTE> compressedBytes;
DWORD invalidLength = (DWORD) invalidClsids.length();
BYTE* lengthParts = &invalidLength;
static const int kLenghtPartsLength = sizeof(DWORD) / sizeof(BYTE);
for(int i = 0; i < kLenghtPartsLength; ++i)
    compressedBytes.push_back(lengthParts[i]); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-12T05:51:19.630

```
compressedBytes.push_back(either.bytes.b[0]);
compressedBytes.push_back(either.bytes.b[1]);
compressedBytes.push_back(either.bytes.b[2]);
compressedBytes.push_back(either.bytes.b[3]); 
```

还有一种更智能、*更快捷*的方法！让我们看看这段代码在做什么以及如何改进它。

此代码正在序列化整数，一次一个字节。对于每个字节，它都调用 push_back，它正在检查内部向量缓冲区中的可用空间。如果我们没有空间容纳另一个字节，就会发生内存重新分配（提示，慢！）。当然，重新分配不会经常发生（重新分配通常通过将现有缓冲区加倍来发生）。然后，新字节被复制，内部大小增加一。

vector<> 有一个标准要求，即内部缓冲区是连续的。vector<> 也恰好有一个*operator& ()*和*operator[] ()*。

所以，这是你能想到的最好的代码：

```
std::string invalidClsids("This is a test string");
std::vector<BYTE> compressedBytes;
DWORD invalidLength = (DWORD) invalidClsids.length();
compressedBytes.resize(sizeof(DWORD)); // You probably want to make this much larger, to avoid resizing later.
// compressedBytes is as large as the length we want to serialize.
BYTE* p = &compressedBytes[0]; // This is valid code and designed by the standard for such cases. p points to a buffer that is at least as large as a DWORD.
*((DWORD*)p) = invalidLength;  // Copy all bytes in one go! 
```

上述转换可以使用*&compressedBytes[0]*语句一次性完成，但不会更快。这更具可读性。

笔记！以这种方式（甚至使用 UNION 方法）进行序列化是依赖于字节序的。也就是说，在 Intel/AMD 处理器上，最低有效字节排在第一位，而在大端机器（PowerPC、摩托罗拉……）上，最高有效字节排在第一位。如果您想保持中立，则**必须**使用数学方法（班次）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-12T03:16:44.353

你*必须*一次做一个字节吗？有没有一种方法可以让你一举将整个 32 位 memcpy() 放入流中？如果您有要写入流的缓冲区的地址，您可以复制到那里吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-01-06T12:00:37.450

也许可以获得32位变量指针，将其转换为char指针并读取char，然后将+1添加到指针并读取下一个char ..只是理论:)我不知道它是否有效

# apache-flex - 如何在 flex 应用程序中使用 facebook connect 登录

> ID：741217
> 
> 赞同：-1
> 
> 时间：2009-04-12T03:15:20.847
> 
> 标签：apache-flex, facebook

我一直在检查来自 Adob​​e 的新 actionscript 3 库中的 facebook connect 东西。我一直在试图弄清楚如何在 flex 应用程序中使用 facebook 连接按钮。

在 html 页面中，您将使用 fbml，它会自动将 facebook 连接按钮放在您的页面上，当用户单击它时，它会弹出 face div 并让用户登录。那么你不能在flex中使用它。所以我可以把它放在包含 swf 的页面上，但这就是我使用 flex 而不是 html 的原因。我已经看到 Universal Mind 的人这样做了，所以我知道这是可能的。我只需要一点方向。

我知道在 facebook 连接 api 中使用的功能会导致登录对话框出现我只是想不出正确的组合。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T14:46:38.440

查看[使用 Flex 创建您的第一个 Facebook 应用程序](http://www.adobe.com/devnet/facebook/articles/build_your_first_facebook_app_05.html)教程，特别是[添加 Facebook 登录](http://www.adobe.com/devnet/facebook/articles/build_your_first_facebook_app_05.html)部分。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T03:41:34.997

这应该适用于 Flex。这将使用 Flash 中的 ExternalInterface 调用来完成。

[http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/external/ExternalInterface.html](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/external/ExternalInterface.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-26T18:53:59.417

In Adobe facebook-actionscript-api there is a class [LoginWindow](http://code.google.com/p/facebook-actionscript-api/source/browse/#svn/trunk/source/actionscript/com/facebook/views) which you can use.

When you need it this window will open like small flash popup window and it will display facebook login page and enable user to login. All needed events will be raised and you should be connected after that. I didn't tested it but from the code looks like what you need.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-21T03:19:22.763

使用此 API： [http ://code.google.com/p/facebook-actionscript-api/](http://code.google.com/p/facebook-actionscript-api/)

看看 ConnectDemo。

示例很糟糕……它会在显示 Flex 应用程序之前强制您进行连接。

您需要 tweek 示例以使其执行您想要的操作。

此外，FB 对某些方法进行了折旧，因此您必须查找未折旧的新方法。

我很想更新示例，但我没有时间专注于另一个项目。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-12-08T06:42:32.867

还有一个非常干净和优雅的解决方案/教程： [http ://www.stevenvh.be/blog/?p=57](http://www.stevenvh.be/blog/?p=57)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-12-02T10:18:31.573

该开发人员使用 ExternalInterface 类创建了您正在谈论的这个 js/flash 桥。您也可以下载所有源文件。我发现它非常有用。 [http://www.wellconsidered.be/blog/2009/01/04/facebook-connect-to-actionscript-3/](http://www.wellconsidered.be/blog/2009/01/04/facebook-connect-to-actionscript-3/)

# ajax - MVC - 如何在 ajax 中开发类似向导的控件功能

> ID：741221
> 
> 赞同：1
> 
> 时间：2009-04-12T03:20:47.637
> 
> 标签：ajax, model-view-controller

在我开始之前，我想我会在这里询问如何在 ajax 中为 MVC 开发类似 wiazrd 的控件。

该控件将具有具有数据输入控件的页面，并在每个页面提交时将数据插入数据库。

任何想法如何去做？

马尔科姆

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-12T04:06:56.997

你在使用 JavaScript 库吗？我知道 dojo 在 dojox 命名空间中有一个向导，而且我很确定有 jquery 的向导。如果没有，我会做一个向导，就像我做标签一样，没有标签栏，每个视图都包含一个表单和下一个、上一个、取消和/或重新启动按钮，所有这些都将处理 ajax 调用/状态管理和更改风景。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T04:59:59.443

如果它是一个向导，您可能实际上应该使用单独的网页，而不是通过 ajax 调用更新单个页面，这样前进和后退按钮就可以在浏览器中正常工作，以便在向导中前进和后退。

当然，您可以使用片段技巧在单个页面中前进/后退，但根据我的经验，这很棘手。

# jquery - jQuery：可拖动连接到可排序。可拖动项目与可排序列表具有不同的 DOM

> ID：741226
> 
> 赞同：12
> 
> 时间：2009-04-12T03:25:46.533
> 
> 标签：jquery, jquery-ui-sortable, draggable

我现在可以将一个项目拖到可排序的地方。但是可排序列表具有不同的 DOM。

```
<!-- The draggable items. Has the "original" DOM in the LI tags. -->
<ul class="draggable_text">
    <li><span>DRAG THIS A</span></li>
    <li><span>DRAG THIS B</span></li>
</ul>

<!-- This list has a different DOM in the LI tags -->
<ul id="stagerows">
    <li><p>This is a new DOM dragged from "DRAG THIS A"</p></li>
    <li><p>This is a new DOM dragged from "DRAG THIS B"</p></li>
</ul>

$(document).ready(function() {
    $('.draggable_text > li').draggable({
        //helper:'clone',
        helper: function(event, ui) {
            return '<div style="width: 100px; height: 50px; border: 1px solid #000; background-color: #fff;">xxx</div>';
        },
        connectToSortable:'#stagerows'
    });

    $('#stagerows').sortable({
        handle: '.drag_handle'
    });
}); 
```

助手有这个： xxx 这应该被放入可排序的...

“帮手”有效。但是当我将项目“丢弃”到可排序中时，它只是恢复到“原始”DOM。我希望将“新创建的 DOM”（在帮助程序中创建的 DOM）放入可排序的对象中。

我希望我说得通。谢谢！

另一种说法：当我拖动一个苹果时，它现在变成了一个橙子。但是当我放下它时，它又变回了一个苹果..

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-12T05:45:10.143

```
$('.draggable_text > li').draggable({
    helper: function(event, ui) {
        var type = $(this).find('.link_type').val();
        return create(type,0);
    },
    connectToSortable:'#stagerows'
});

$('#stagerows').sortable({
    handle: '.drag_handle',
    placeholder: 'placeholder_sortable'
});

/**
 * When item is dropped from the Add <Stuff>
 */
$('#stagerows').droppable({
    drop: function(event, ui){
        type = ui.draggable.find('.link_type').val();
        ui.draggable.empty();
        return ui.draggable.html(create(type,0))
    }
}); 
```

# windows - 确定菜单是否被下拉

> ID：741227
> 
> 赞同：1
> 
> 时间：2009-04-12T03:26:42.100
> 
> 标签：windows, menu

有没有办法确定 win32 api 中是否下拉菜单？可以这样使用的东西：

HMENU hMenu = GetMenu(hWnd);

HMENU hSubMenu = GetSubMenu(hMenu);

// hSubMenu 是否下拉？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T03:55:22.123

我不确定一种专门在 HMENU 上操作以查看菜单是否正在显示的方法（并且快速扫描平台 SDK 文档并没有找到任何特定的内容），但您也许可以使用该`GetMenuItemInfo`功能来获取`MENUITEMINFO`与拥有下拉菜单的菜单项相关的结构。如果`fState`成员已`MFS_HILITE`设置，则应表明该项目已被选中并且子菜单很可能已打开。我无法保证正确性，但值得尝试。

另一种可能的选择是使用`FindWindow`类“#32768”来查找可能打开的任何菜单的 hWnd，并将`MN_GETHMENU`消息发送到您找到的任何窗口以检索`HMENU`并将其与`GetSubMenu`.

# .net - 除了 Mono 之外，还有其他方法可以在 Mac 或 Linux 上运行 Microsoft .NET 吗？

> ID：741239
> 
> 赞同：3
> 
> 时间：2009-04-12T03:44:20.793
> 
> 标签：.net, linux, macos, mono

我目前无法使用任何 Windows 机器，并且 Mono 不运行我的应用程序。还有另一种方法可以解决 Mono 不起作用的任何原因吗？（我目前没有错误消息。）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-12T03:47:03.500

除了虚拟化，没有。如果你有硬件，我会推荐[VMware](http://www.vmware.com/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T03:58:48.293

您可以尝试[在 Wine 下运行 .NET Framework](http://appdb.winehq.org/appview.php?iAppId=2586)。我对此不抱太大希望，唯一获得金牌评级的版本是 2.0。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-12T06:19:51.543

如果您没有现金购买 VMWare（如果有的话，这是可以买到的最好的钱），试试[VirtualBox](http://www.virtualbox.org)。它是免费的、开源的，而且非常好。虽然不如 VMWare 强大。

* * *

## 回答 #4

> 赞同：-7
> 
> 时间：2009-04-12T07:30:38.987

***翻白眼***这就是为什么我不建议使用.NET 作为任何工作的正确工具。无论 Microrip-off 怎么说，它都不是跨平台兼容的。

回到正题。查看 CodeWeavers Wine。他们做了很多事情来使他们的 Wine 包更兼容。很多工作都在运行每个应用程序的设置中，但他们也对它进行了大量修补，这些补丁可能需要一段时间才能恢复主流（尽管它们确实将它们归还）。

如果虚拟化是你所追求的，那么 VirtualBox 是相当不错的。我在 Mac 上使用它，它以合理的速度完成我需要的一切。Parallels 似乎快了一点，但如果我长时间不重新启动我的 Mac，Parallels 似乎会在一段时间后像狗一样跑。VMWare 提供与并行程序大致相同的功能/性能。Parallels 在 Mac 集成方面感觉好一些，但这完全是个人喜好。

如果您还需要 Linux 兼容性，请查看 VirtualBox 或 VMWare。两者都有 Linux 的免费版本（VMWare 服务器免费提供）。如果您在 Mac 和 Linux 上都使用 Virtual Box 或 VMWare，那么您将能够传递相同的 VM 文件，而不是让 Windows VM 在 Mac 中运行和在 Linux 中运行 Windows VM（更不用说许可成本了）安装了两个 Windows 副本）。

# ruby - CGI cookie 在 Ruby 中是如何工作的？

> ID：741242
> 
> 赞同：0
> 
> 时间：2009-04-12T03:50:58.703
> 
> 标签：ruby, cookies, cgi

这是我一直在网上看到的如何设置 cookie 的示例。

```
require "cgi"
cookie = CGI::Cookie.new("rubyweb", "CustID=123", "Part=ABC");
cgi = CGI.new("html3")
cgi.out( "cookie" => [cookie] ){
  cgi.html{
    "\nHTML content here"
  }
} 
```

我尝试这样做，它设置了 cookie，然后出现了一个空白页面。

```
#!/usr/local/bin/ruby

require 'cgi'
load 'inc_game.cgi'
cgi = CGI.new

cookie = CGI::Cookie.new("rubyweb", "CustID=123", "Part=ABC");
cgi.out( "cookie" => [cookie] ){""}     

#see if game submit buttons pressed
doIt = cgi['play']
puts "Content-type: text/html\n\n"  

play = Game.new

#welcome
if doIt == ''
puts play.displayGreeting
end

#choose weapon
play.playGame

if doIt == 'Play'
    move = cgi['weapon']
    human = play.humanMove(move)
    computer = play.ComputerMove
    print human
    print computer
    result = play.results(human,computer)
    play.displayResults(result)
end 
```

所以我的问题首先是，我错过了什么/做错了什么？其次，我想知道是否有人想解释 .out 与 .header 相比做什么，或者是否有区别？

谢谢，

列维

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T05:05:41.440

我相信这条线：

```
cgi.out( "cookie" => [cookie] ){""} 
```

正在冲洗你的标题。

在我的 TTY 中运行代码后，

```
内容类型：文本/html
内容长度：0
设置 Cookie：rubyweb=CustID%3D123&Part%3DABC; 路径=

内容类型：文本/html

```

已发出，并且 "Content-Length: 0" （由 out{} 中的空字符串生成）可能告诉浏览器您已完成。

```
cookie = CGI::Cookie.new("rubyweb", "CustID=123", "Part=ABC");
cgi.header( "cookie" => [cookie] ,  type => 'text/html' )

#normal printing here 
```

更适合发送标头。

选择“做处理”——“然后考虑输出”模型可能会有所帮助。

```
require 'cgi'
load 'inc_game.cgi'

cgi = CGI.new
cookie = CGI::Cookie.new("rubyweb", "CustID=123", "Part=ABC");

output = ""; 

#see if game submit buttons pressed
doIt = cgi['play']

play = Game.new

#welcome
if doIt == ''
  output << play.displayGreeting
end

#choose weapon
play.playGame

if doIt == 'Play'
    move = cgi['weapon']
    human = play.humanMove(move)
    computer = play.ComputerMove
    output << human
    output << computer
    result = play.results(human,computer)
    output << play.displayResults(result)
end

cgi.out( "cookie" => [cookie] , type=>"text/html" ){ 
  output; 
} 
```

# user-interface - C ++中托管和非托管类型之间的转换？

> ID：741245
> 
> 赞同：1
> 
> 时间：2009-04-12T03:56:28.987
> 
> 标签：user-interface, c++-cli, unmanaged, managed

我认为，当我在 C++ 中使用 GUI 时，文本字段存储为托管字符串。我需要一种将它们转换为标准整数、浮点数和字符串的方法。有什么帮助吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-12T04:09:18.440

[您可以使用Marshal.StringToHGlobalAnsi](http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.marshal.stringtohglobalansi.aspx)将 System.String 转换为非托管 char * 。[完成后调用Marshal.FreeHGlobal](http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.marshal.freehglobal.aspx)确保释放它。要将字符串转换为数值，您可以使用常规的 .NET 解析函数，例如`Int32.Parse`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T04:27:23.450

要在本机代码中使用托管内存，您必须首先将托管内存的内容复制到本机内存中。

例如：

从托管内存复制内容如下：

```
const int len = 50;
BYTE *destination = new BYTE[nLength];
System::Byte source[] = new System::Byte[len];

System::Runtime::InteropServices::Marshal::
  Copy(source, 0, IntPtr((void *)destination, len); 
```

因为我们正在处理托管内存，所以垃圾收集可以将托管数据转移并移动到另一个位置，如果我们试图定位我们想要转换的数据，那么所有数据都会丢失。

因此，我们希望通过使用 __pin 将其从托管转换为非托管来“将其固定在内存中”：

```
const int len = 50;
BYTE *source              = new BYTE[len];
System::Byte destination[]     = new System::Byte[len];
BYTE __pin *managedData = &(destination[0]);

::memcpy(source, managedData, len); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T09:30:45.320

您可以简单地将 System::String^ 对象转换为 MFC CString

```
CString* name = new CString(managedName); 
```

其中 managedName 是一个托管字符串。

# c++ - 将 time() 和 localtime() 替换为与用户无关的等效项

> ID：741254
> 
> 赞同：0
> 
> 时间：2009-04-12T04:10:33.837
> 
> 标签：c++, c, time, clock, localtime

我有一个使用 time() 和 localtime() 设置内部时钟的程序，但这需要更改，以便内部时钟独立于用户和“实时”时间。我需要能够设置任何合理的开始时间，并根据程序内部的计时器让它向前计数。关于解决此问题的最佳方法的任何想法？这是摘录：

```
#define ConvertToBCD(x) ((x / 10) << 4) | (x % 10);
time_t  tm;
time(&tm);
struct tm *tm_local= localtime(&tm);
tm_local->tm_year %= 100;
tm_local->tm_mon++;
timedata[0] = ConvertToBCD(tm_local->tm_year);
timedata[1] = ConvertToBCD(tm_local->tm_mon);
timedata[2] = ConvertToBCD(tm_local->tm_mday);
timedata[3] =  (tm_local->tm_wday + 6) & 7;
if (!(TimeStatus & 0x02)) tm_local->tm_hour %= 12;
timedata[4] = ((tm_local->tm_hour < 12) ? 0x00 : 0x40) | ConvertToBCD(tm_local->tm_hour);
timedata[5] =  ConvertToBCD(tm_local->tm_min);
timedata[6] =  ConvertToBCD(tm_local->tm_sec); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-12T04:21:48.800

A在 POSIX 兼容系统下，只是自*epoch* 1970 年 1 月 1 日 0:00:00`time_t`以来的秒数。

 *只需向 a 添加一个（可能为负）值来`time_t`更改时间，确保该值不会溢出，然后`localtime`照常使用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T07:17:39.657

如果只需要整秒分辨率，那么`time()`可以使用；如果您需要亚秒级分辨率，请使用`gettimeofday()`.

但是，如果您希望能够控制返回的值，那么您需要为自己定义一个`time()`(or `gettimeofday()`) 的代理项。大多数库都是按照 Plauger 的[The Standard C Library](https://rads.stackoverflow.com/amzn/click/com/0131315099)中描述的路线设计的，并且您通常可以提供一个调用的函数，该函数`time()`按照您的意愿运行，以替换标准版本。或者，更安全的是，您可以修改代码以调用您自己设计的函数`simulated_time()`，`simulated_time()`可能`time()`称为自己的版本，可以根据需要安排时间进行更改。

您无需更改对`localtime()`;的使用。它只是将`time_t`您赋予它的任何值转换为`struct tm`; 您希望它像往常一样给出答案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T08:06:23.347

我理解它的方式是你想要一个内部时钟，它会根据真实时钟的进度进行更新。

那么你会创建这样的东西：

```
struct myTime
{
    time_t userStart;
    time_t systemStart;
    time_t curTime;
};

void initTtime(struct myTime *t, time_t time)
{
    t->userStart=time;
    t->systemStart=time(NULL);
}

time_t getTime(struct myTime *t)
{
    t->curTime = t->userStart + time(NULL)-t->systemStart;
    return t->curTime;
} 
```

所以使用 initTime 你设置你想要的当前时间，这会及时链接到系统时间。当您使用该结构调用 getTime 时，它​​会根据已进行的时间量更新起点。（注意，我没有测试过代码，如果需要，您可以直接使用该结构）。

对于亚秒级精度，将 time() 和 time_t 替换为 gettimeofday 等效项。对于转换、ascii arting、分解为第二个计数器以外的任何东西，您仍然可以使用 unix 函数。

# api - 谷歌街景图像 API

> ID：741258
> 
> 赞同：1
> 
> 时间：2009-04-12T04:21:15.260
> 
> 标签：api, google-maps

是否有 API 可用于在特定位置（和方向）抓取 Google 街景图像？我看到它可以获取和定位 Flash 控件，但我更喜欢只给我 JPEG（或其他一些位图格式）的东西。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-12T06:25:56.787

您正在寻找[静态地图 API](http://code.google.com/apis/maps/documentation/staticmaps/)。~~不幸的是，他们还没有[完成](http://code.google.com/p/gmaps-api-issues/issues/detail?id=397)制作静态街景地图的工作~~（现在可以使用[静态街景 API ）。](http://code.google.com/apis/maps/documentation/streetview/)正如评论 4 和 5 所指出的，您可能可以获得用于街景的缩略图（尽管您可能必须让 Google 实际加载该特定图像，然后才能抓取它并可能自己缓存它）。除此之外，您还被 Flash 控件卡住了。

您可能能够在后端拥有一项服务，该服务实质上是获取 Flash 控件的屏幕截图并缓存它，但这有点骇人听闻。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-05-15T21:28:09.000

静态图像尚未正式提供，但您可以使用与 Google 的 Streetview Flash 应用程序相同的 API 来获取图块和缩略图。

我在这里写了关于这项技术的文章：

[http://jamiethompson.co.uk/web/2010/05/15/google-streetview-static-api/](http://jamiethompson.co.uk/web/2010/05/15/google-streetview-static-api/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-09-23T05:17:08.407

谷歌现在提供了一个街景图像 API 来实现这个目的：

[http://code.google.com/apis/maps/documentation/streetview/](http://code.google.com/apis/maps/documentation/streetview/)

请注意，Maps API 服务条款不允许通过记录在案的公共 API（如 Street View Image API 和 JavaScript Maps API）以外的任何方式访问街景图像，并且可能会导致您的网站对该图像的请求被被谷歌屏蔽。

非常感谢，

雷神。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-12T05:12:48.023

这是[文档](http://code.google.com/apis/maps/documentation/services.html#Streetview)。

这是[参考文档](http://code.google.com/apis/maps/documentation/reference.html#GStreetviewPanorama)。

查看[Google 示例](http://code.google.com/apis/maps/documentation/demogallery.html?searchquery=street)。

我相信这个[例子](http://gmaps-samples.googlecode.com/svn/trunk/streetview/angletowardsbuilding.html)就是你要找的。

此外，您还需要注册[Google Maps API 密钥](http://code.google.com/apis/maps/signup.html)。

# objective-c - NSApplicon 委托 - applicationDidFinishLaunching

> ID：741260
> 
> 赞同：1
> 
> 时间：2009-04-12T04:24:55.983
> 
> 标签：objective-c, cocoa, macos

我在这里为我的可可应用程序声明了一个代表：

MyAppDelegate.h

```
@interface MyAppDelegate : NSApplication {
}
- (void) applicationDidFinishLaunching:(NSNotification*) notice ;
@end 
```

MyAppDelegate.m

```
@implementation MyAppDelegate 
- (void) applicationDidFinishLaunching:(NSNotification*) notice {
    NSLog(@"inside appdidfinishlaunching") ;
}
@end 
```

我已将文件所有者的委托出口链接到 IB 中的此对象。

然而，这个方法没有被调用。我没有看到任何日志消息。

你能提出什么问题吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-12T04:57:37.340

您的应用程序委托不是应用程序本身。它应该继承自 NSObject，而不是 NSApplication。

### 为什么这很重要

NSApplication 是一个单例。它的`init`方法总是返回 NSApplication 或任何子类的第一个实例，丢弃您（或 nib 加载器）可能正在调用的任何后续对象`init`。

所以你最终将你的应用程序对象设置为它自己的委托。您打算让委托的对象在第二次调用中死亡，`init`应用程序对象取而代之。

将应用程序对象更改为您的子类的实例也可以，但您仍然会将应用程序作为自己的委托，这是不干净的并且可能很危险（NSApplication 可能会私下实现它的一些委托方法本身，因为它们只是通知处理程序方法）。唯一正确的解决方案是让您的应用委托类不继承自 NSApplication。

# c# - 如何停止过时的 UI 更新？

> ID：741261
> 
> 赞同：1
> 
> 时间：2009-04-12T04:26:17.197
> 
> 标签：c#, user-interface

假设我有一个带有 GUI 的 C# 程序，GUI 的更新/刷新/显示需要 0.2 秒。

比如说，当它还在计算显示过程时（在这 0.2 秒内），给出了一个新的更新请求，所以当前的更新请求已经过时了。我怎样才能让它停止做这种毫无意义的过时工作来开始计算新的请求？

它可能不仅仅是关于 UI 更新。也许，对于任何函数调用，我怎样才能使它成为“如果发出另一个相同的调用，放弃当前的工作并改用新的数据/情况”？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-12T05:33:29.750

*也许，对于任何函数调用，我怎样才能使它变成“如果发出另一个相同的调用，放弃当前的工作并改用新的数据/情况”？*

你为什么要那个？您将失去代码中的所有可证明性。您将永远无法确保系统中的一致状态。如果你想模拟它，只需弄乱PC。设计一个程序，任意将 PC 推回到它所在的任何方法的顶部。您会很快看到系统退化。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T04:57:57.107

您正在谈论一些相当高级的线程问题。使用内置的系统控制结构，没有办法阻止消息循环完成，就像没有办法（优雅地）中断另一种方法一样。

现在，如果此功能对您非常重要，您可以构建所有自定义控件，并在控件的绘制代码中检查（当然，以线程安全的方式）一个布尔值，指示是否应该继续绘制。

但是，如果我可以在黑暗中试一试，我猜你实际上并没有明确地执行任何多线程。如果是这种情况，那么您描述的场景永远不会真正发生，因为刷新 GUI 的过程将在另一个可以开始之前完成（即，您描述的这个匿名过程需要再次刷新或认为当前的一个陈旧）。因为同一线程上的代码是按顺序执行的，所以不相关的代码实际上没有机会导致更新。

重绘发生方式和时间的语义（例如，Invalidate() 和 Refresh() 之间的区别，以及它们各自对该逻辑的影响）是一个您可能真的不感兴趣的话题。只要知道，如果你...

*   做多线程，然后你必须实现自己的代码来检查当前操作是否应该继续（对于 UI，这意味着在绘制逻辑中具有此逻辑的自定义控件）
*   不做多线程，那么你所描述的永远不会发生。

希望这有帮助！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T05:06:00.957

一种可能的方法是启动一个更新 GUI 的线程并中止它并启动另一个。由于 C# 中线程管理的可怕状态，这通常不是推荐的做法，但您应该能够绕过它而不必担心。

```
public static class ControlExtensions
{
  public static TResult InvokeEx<TControl, TResult>(this TControl control,
                                            Func<TControl, TResult> func)
    where TControl : Control
  {
    if (control.InvokeRequired)
      return (TResult)control.Invoke(func, control);
    else
      return func(control);
  }
}

public partial class Form1 : Form
{
  public Form1()
  {
    InitializeComponent();
  }

  Thread guiUpdateThread = null;
  public void BeginLongGuiUpdate(MyState state)
  {
    if (guiUpdateThread != null && guiUpdateThread.ThreadState != ThreadState.Stopped)
    {
      guiUpdateThread.Abort();
      guiUpdateThread.Join(); // wait for thread to abort
    }

    guiUpdateThread = new Thread(LongGuiUpdate);
    guiUpdateThread.Start(state);
  }

  private void LongGuiUpdate(object state)
  {
    MyState myState = state as MyState;
    // ...
    Thread.Sleep(200);
    this.InvokeEx(f => f.Text = myState.NewTitle);
    // ...
  }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-12T06:32:34.010

我不知道这是否符合您的需要，但这里有。实现这种行为的一种方法是扭转问题并延迟实际渲染。

每当您收到请求或更改时，请启动计时器。每个进来的请求都将开始或重新开始时间。当计时器实际过去时，执行渲染。它并没有完全按照您的描述做，但它实际上可能最终会做您需要的事情，即不会为每个请求渲染，因为渲染时间太长。

如果您没有连续的请求，这会很好地工作。显然，如果你这样做，你永远不会得到任何显示......

# eclipse - 在 Mac 上的 Eclipse 中注释块

> ID：741264
> 
> 赞同：14
> 
> 时间：2009-04-12T04:29:12.107
> 
> 标签：eclipse, macos, comments

如何在 Mac 上的 Eclipse 中注释代码块？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-12T04:55:53.600

Apple + Shift + / 将使用 /* */ 切换选定代码块
Apple + / 将使用 // 切换一行（或多行，如果选择）

您可能必须禁用 OS 热键（apple + shift + / 显示帮助菜单）

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2014-03-04T22:32:04.713

Ctrl + cmd + / <- 阻止注释和 Ctrol + cmd + \ <- 删除注释

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-04-12T04:31:48.603

命令（空格键旁边的三叶草/苹果键）正斜杠 (/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-12T04:32:37.417

`Command`+`/`评论选择。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-01-30T04:46:14.630

选择要作为注释的文本并使用“ `command`+ `/`”应用多行注释，每行具有“ `//`”

但是，如果您使用' `command`++ '，则文本的开头`control`和结尾`/`都会用''注释，`/* ... */`这比以前的要好得多

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-12-10T13:32:18.700

## 简短的回答：

选择要作为评论的文本并使用

`⌘</kbd> + `⇧</kbd> + `C```

## 长答案：

**单线**

相同键的切换

*评论* `⌘</kbd> + `⇧</kbd> + `C```

*取消注释* `⌘</kbd> + `⇧</kbd> + `C```

**多行**

*评论* `⌘</kbd> + `/``

*取消注释* `⌘</kbd> + `\` (note the backslash)`

**有关所有快捷方式的确切列表，或者如果您想更改一些内容，请查看：**

*Eclipce->设置->常规->键*

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-09-29T09:24:02.837

对于多行注释，即 /*。代码。*/

```
Command + control + / 
```

或者

对于单行注释，即 //

```
Command + / 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-04-23T05:18:24.507

### 用于在 Mac 上注释和取消注释代码的键盘快捷键。

注释代码的快捷方式：

*   `/*...*/`（多行注释）：`Command ⌘</kbd> + `Control ^` + `/``

*   `//`（单行注释）：`Command ⌘</kbd> + `/``

取消注释代码的快捷方式：

*   按`Command ⌘</kbd> + `/` to uncomment a selected single-line comment.`
*   按`Command ⌘</kbd> + `Control ^` + `\` to uncomment a selected multi-line comment.`

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2022-01-07T11:14:32.953

选择要作为评论的文本并使用“command + /”

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2022-01-13T14:13:05.407

删除 Eclipse 中的切换注释。

命令 + 移位 + 7

# hosting - DNS 和域指向

> ID：741265
> 
> 赞同：0
> 
> 时间：2009-04-12T04:30:05.987
> 
> 标签：hosting, dns

我是 DNS 的新手，想知道如何将域指向主机，当域和主机来自不同的站点时。我在 1and1.com 购买了我的域名，并从 ipower.com 购买了我的托管计划

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-14T07:52:00.557

有两种可能的方法；

将您域的所有 DNS 记录移动到 ipower 或仅在 1and1 的 DNS 中为 www 创建一个 A 记录。

要将 DNS 记录移动到 ipower，您需要知道其名称服务器的地址。

要在 1and1 服务器上设置 DNS 以指向您的 Web 空间，您需要知道将托管您的 Web 空间的服务器的 IP 地址。

无论哪种方式，您最好的选择是与 ipower 交谈。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-14T07:41:31.300

ipower.com 上的 Web 服务器没有为 msa-roch.com 配置（可能是因为您没有要求 ipower 这样做）并且只包含一个 HTML 重定向（可怕的技术，它表明这家公司不精通技术):

```
% telnet msa-roch.com http
Trying 66.96.130.149...
Connected to msa-roch.com.
Escape character is '^]'.
GET / HTTP/1.0
Host: msa-roch.com
Connection: close

HTTP/1.1 200 OK
Date: Tue, 14 Apr 2009 07:39:34 GMT
Content-Type: text/html
Connection: close
Server: Apache
Last-Modified: Mon, 16 Feb 2009 18:21:28 GMT
ETag: "b5f696af-5f-4630d414dfc69"
Accept-Ranges: bytes
Content-Length: 95

<HTML> <HEAD><META HTTP-EQUIV=Refresh CONTENT="0; url=http://74.208.128.239">  </HEAD> </HTML> Connection closed by foreign host. 
```

此重定向解释了您所看到的。与 ipower.com 交谈或阅读他们的文档。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-14T08:35:23.307

我在 Dreamhost 托管中使用域名（在 1and1 注册）也有同样的经历。

您可以通过以下步骤轻松实现您想要的：

1.  为您的域配置托管计划。即使此域在您的域池中不可用，您也应该能够托管它。
2.  在您的托管 Web 面板中查找与此域关联的 IP。
3.  在 1and1 Web 面板中编辑您的 DNS 配置，并将“A”条目设置为您刚刚查找的 IP。
4.  等待 DNS 传播和测试。

该解决方案可能并非一直有效；如果您的托管包中没有静态 IP，您的托管公司*可以*将此域从一台服务器移动到另一台服务器（从而更改 IP）。

我从来没有遇到过这种情况，但仍然有可能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-12T04:51:22.240

1and1 有一个管理区域供您编辑您的域名服务器。

这些域名服务器将由 1power.com 提供

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-06-26T01:58:19.617

这就是我在 Dreamhost 中使用 1and1 的域进行托管时所做的：

1.  Dreamhost > 管理域 > 添加新域 > 完全托管
2.  1and1 > 域 > 选中域的框 > DNS > 编辑 DNS 设置：

> ```
> name server: my name server
> Primary name server: ns1.dreamhost.com
> Secondary name server : my secondary name server 
> One Secondary name server: ns2.dreamhost.com
> Two Secondary name server: ns3.dreamhost.com 
> ```

然后等待一两个小时，让更改通过系统传播。

# sdl - SDL_Surface 的外部编译错误

> ID：741266
> 
> 赞同：0
> 
> 时间：2009-04-12T04:30:40.387
> 
> 标签：sdl, extern, compiler-errors

我收到`Code::Block`一个`SDL_Surface`变量的编译错误。奇怪的是，这是我第一次收到这种错误，因为我之前使用过这行代码并且运行良好。

导致此问题的一个（几个具有相同问题的）示例代码行是：

```
extern SDL_Surface *screen; 
```

产生的错误是这样的：

```
expected init-declarator before "extern"|
expected `,' or `;' before "extern"|

||=== Build finished: 2 errors, 0 warnings ===| 
```

我试图理解错误，但我不知道它是什么。有谁知道可能出了什么问题？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-12T04:39:16.387

这是一个疯狂的猜测，因为我没有太多工作要做。`SDL_Surface`在那之前你有所有需要的标题`extern`吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T05:09:49.667

看起来您缺少`SDL_Surface`. 确保在其中定义`#include`了正确的头文件。`SDL_Surface`或者，如果您实际上没有使用该`screen`变量（即您没有访问它的任何字段），您可以使用*不完整的类型*声明它，如下所示：

```
extern struct SDL_Surface *screen; 
```

# php - 仅在未拖动元素时获取输出

> ID：741269
> 
> 赞同：1
> 
> 时间：2009-04-12T04:33:17.180
> 
> 标签：php, javascript, jquery, html, user-interface

如何更改下面的代码，以便在拖动元素时脚本将停止获取输出文件，直到该元素被释放？

```
$(document).ready(function() {
    //$(".draggable").draggable();
    $(".draggable").draggable({ containment: '#container', scroll: false });
    $(".draggable").draggable({ stack: { group: '#container', min: 1 } });

    $("*", document.body).click(function (e) {
        var offset = $(this).offset();// get the offsets of the selected div
        e.stopPropagation();
        var theId = $(this).attr('id');// get the id of the selceted div
        $("#result").text(this.tagName + " id=" + theId + " (" + offset.left + "," + offset.top +")");
         //post x,y to php (and the id of the elemnt)
        $.post("http://localhost/index.php", "id=" + theId + "&x=" + offset.left + "&y=" + offset.top);
    });

    var req = function () {
        $.ajax({
            url: "out.php",
            cache: false,
            success: function(html){
                $("#stuff").empty().append(html);
                var css_attr = html.split(",");
                $('#1').css('left', css_attr[0] + 'px').css('top', css_attr[1] + 'px');
            },
            complete: function(){
                req();
            }
          });
    };
    req();
}); 
```

注意：此脚本依赖于以下 JavaScript 源：

```
jquery.js
http://jqueryui.com/latest/ui/ui.core.js
http://jqueryui.com/latest/ui/ui.draggable.js
http://jqueryui.com/latest/ui/ui.droppable.js 
```

有什么帮助...谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-14T13:18:04.127

Draggables 具有允许您将函数与拖动的开始和停止相关联的选项。（请参阅[http://api.jquery.com/](http://api.jquery.com/)，单击顶部的 jQuery UI 获取文档）。所以你可以使用它，也许有一个全局布尔值，在拖动开始时设置，在拖动结束时取消设置。让您的 req() 函数检查此布尔值，如果已设置则退出。就像是：

```
var halt_request = 0;

$(".draggable").draggable({
    containment: '#container',
    scroll: false,
    start: function(){ halt_request = 1; },
    stop: function(){ halt_request = 0; }
});

...

var req = function () {
    if (halt_request) {
        sleep(10); // so you're not looping too quickly
        req();
        return;
    }

    $.ajax({
        url: "out.php",
... 
```

更好的是，与其让 req() 自己调用，不如让它使用 setTimeout。将超时设置为全局并让启动/停止功能清除/设置超时。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-14T17:25:39.493

您甚至可以进一步了解 kbosak 的想法：

```
var req = function () {
...

$(".draggable").draggable({
    containment: '#container',
    scroll: false,
    stop: req
}); 
```

换句话说，创建一个在拖动停止时调用函数“req”的可拖动对象。

此外，您还可以以更标准的形式完全重写它：

```
function req () {
... 
```

这将是完全相同的事情。此外，您可以执行以下操作：

```
$(function() { 
```

代替：

```
$(document).ready(function() { 
```

你可以合并你的两个可拖动调用。所以......如果我正在编写它，最终代码将是：

```
function req () {
    ...*insert code for req here*...
};

$(function() {
    $(".draggable").draggable({
        containment: '#container',
        scroll: false,
        stack: { group: '#container', min: 1 },
        stop: req
    });
    $("*", document.body).click(function (e) {
        var offset = $(this).offset();// get the offsets of the selected div
        e.stopPropagation();
        var theId = $(this).attr('id');// get the id of the selceted div
        $("#result").text(this.tagName + " id=" + theId + " (" + offset.left + "," + offset.top +")");
         //post x,y to php (and the id of the elemnt)
        $.post("http://localhost/index.php", "id=" + theId + "&x=" + offset.left + "&y=" + offset.top);
    });

    req();
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T05:03:04.880

也许你可以将它与`mouseup`事件联系起来？

> [http://docs.jquery.com/Events/mouseup#fn](http://docs.jquery.com/Events/mouseup#fn)

与其将可拖动对象直接与 AJAX 调用相关联，不如将其与可用于激活`mouseleave`.

# python - Django：向模型类对象添加附加属性

> ID：741270
> 
> 赞同：1
> 
> 时间：2009-04-12T04:36:51.540
> 
> 标签：python, django, google-app-engine

这是使用 Google App Engine。我不确定这是否适用于正常的 Django 开发，或者 Google App Engine 是否会发挥作用。如果是这样，请告诉我，以便我可以更新此问题的描述。

```
class MessageModel(db.Model):
    to_user_id = db.IntegerProperty()
    to_user = db.StringProperty(multiline=False)
    message = db.StringProperty(multiline=False)
    date_created = db.DateTimeProperty(auto_now_add=True) 
```

现在，当我进行查询时，获取“MessageModel”列表并将其发送到要绑定的 template.html，我想包含更多属性，例如“since_date_created”，以输出自上次输出以来的时间, 可能会使用 message 属性并添加其他有助于布局的参数，例如“highlight”、“background-color”等...

我想到的唯一方法是遍历初始查询对象并创建一个新列表，我将在其中添加属性值，然后将其附加回列表。

```
 for msg in messagesSQL:
    msg.lalaland = "test"
            msg.since_created_time = 321932
            msglist.append(msg) 
```

然后，我现在将传递 msglist，而不是传递 template.html 消息 SQL。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-12T08:10:08.160

在通过 for 循环向模板添加元素后，您仍然应该能够将消息 SQL 发送到模板。Python 允许这种事情。

在某些情况下可能有意义的其他方法是提供您的 MessageModel 方法。例如，如果您有一个

```
def since_date_created(self):
    '''Compute the time since creation time based on self.date_created.''' 
```

然后（假设您在模板中有“messagesSQL”），您可以将该函数用作

```
{% for msg in messagesSQL %}
    {{ msg.since_date_created }}
{% endfor %} 
```

基本上，您可以调用模型中的任何方法，只要它不需要传递给它的参数。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-12T08:10:59.250

您可以通过在模型中定义方法来获得它，例如

```
class MessageModel(db.Model):
    # Definition
    def since_date_created(self):
        # ... 
```

现在在模板中，您可以像这样使用它

```
Time since created {{ message.since_date_created }} 
```

# java - 如何将套接字存储在数据库中？

> ID：741282
> 
> 赞同：0
> 
> 时间：2009-04-12T04:57:57.293
> 
> 标签：java, sockets

我想在我的数据库中存储套接字并检索它们。但是套接字不可序列化，所以我无法做到这一点。

如何将套接字存储在数据库中？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-12T05:05:46.963

您希望在数据库中存储的套接字怎么样？套接字本身代表了一些不能存储在数据库中的东西，但也许您可以获取套接字的重要属性——端点 IP 地址、端口，也许还有一些其他重要属性（如果有的话）——并将它们作为套接字本身的代理。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-12T06:29:25.310

您需要考虑您*真正*需要在数据库中存储什么，以代表您在特定应用程序中与客户端的“对话”。

例如，它可能是在服务器上分配的（安全生成的）随机数/会话 ID，客户端将其作为 cookie 传递。它*可能*是一个 IP 地址/远程端口，请记住它们应该被视为临时的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T05:06:08.100

您想如何将套接字存储在数据库中？你是说数据结构吗？

如果它是您的意思的数据结构，那么您可以将套接字存储在向量中。

### 例子：

```
Vector yourNewPlaceToStoreSockets = new Vector();
yourNewPlaceToStoreSockets.add(yourSocketObject); 
```

如果您可以更具描述性，它将帮助我更好地回答您。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-12T05:35:28.157

您的程序可以访问的套接字是一个将被放弃的临时实体。将其存储在数据库中是什么意思？你想做什么？

您实际上是指数据库（如外部数据库管理系统）还是数据结构？因为你可以把它放在一个集合中。

# asp.net-mvc - 为什么此表单在 ASP.NET MVC 中不调用我的控制器操作？

> ID：741293
> 
> 赞同：2
> 
> 时间：2009-04-12T05:10:11.680
> 
> 标签：asp.net-mvc, webforms

我正在尝试在 ASP.NET MVC 中制作 TinyURL 克隆作为学习项目。

现在，我想要的只是能够通过表单向我的 /Home/Create 操作提交新的 URL。

![替代文字](https://imgur.com/JJOP0.png)

我有我的 LINQ 表达式所有设置，我有我的路由设置，我有我的视图设置，但我的设置有问题。

路由：

```
 routes.MapRoute(
            "Default",                                              // Route name
            "",                           // URL with parameters
            new { controller = "Home", action = "Index" }  // Parameter defaults
        );

 routes.MapRoute(
            "Redirect",
            "{hash}",
            new { controller = "Home", action = "RequestLink", hash = "" }
        ); 
```

这些路线使我能够访问我的网站 www.tinyurlclone.com/，如果没有通过，ti 将直接转到我的 Home/Index() 操作。但是，如果您在斜杠之后放置任何内容，它将认为是链接哈希并尝试检索哈希。

我的 HomeController 如下：

```
[HandleError]  
public class HomeController : Controller  
{  
    TinyGetRepository repo = new TinyGetRepository();

    public ActionResult Index()
    {
        return View();
    }

    public ActionResult Create(String url)
    {
        String hash = repo.addLink(url);
        ViewData["LinkHash"] = hash;
        return View();
    }

    public ActionResult RequestLink(String hash)
    {
        String url = repo.getLink(hash);
        return Redirect(url);

    }
} 
```

我的 repo 类中包含用于处理数据库的所有 LINQ 表达式，我真的不需要包含它们，因为它与这个问题无关。

最后，我的基本 Home/Index() 视图（用于提交 url）如下：

```
<%@ Page Language="C#" Inherits="System.Web.Mvc.ViewPage" %>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" >
<head runat="server">
    <title>Index</title>
</head>
<body>
    <div>
    <center>
            <span style="font-size: 14pt">TinyGet <em>(beta)</em></span><br />
            <span style="font-family: Tahoma">Reduce your long links to smaller ones to keep them more memorable....<br />
            </span>
            <% using(Html.BeginForm("Create", "Home")) %>
            <% { %>
            <%= Html.TextBox("url") %>
            <input type="submit" name="submitButton" value="Shorten Link!" />
            <% } %>

      </center>
    </div>
</body>
</html> 
```

但是，当我单击提交时，我的表单根本没有触发任何方法。

此外，如果我查看生成的 HTML 的源代码，我可以看到它没有正确执行我的表单操作，它显示为：

```
<form action="" method="post"><input id="url" name="url" type="text" value="" />
            <input type="submit" name="submitButton" value="Shorten Link!" />
            </form> 
```

为什么 HTML 助手在它应该放置 /Home/Create 时将“”作为操作？为什么没有调用我的 /Home/Create 操作方法？即使我不使用 Html 帮助程序并`<form`手动指定 > 标记，它也会引发错误。

这里有什么问题？

项目来源：[这里](http://www.filedropper.com/tinyget)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-12T08:17:53.647

问题是您没有与路由值匹配的路由（控制器 = 主页，操作 = 创建）。

你有两个路由，一个是空字符串（无参数），它匹配 Controller = "Home", Action = "Index"。另一个是你的哈希路由，它匹配 Controller = "Home", Action = "RequestLink"。因此，当 ASP.Net Routing 从您提供的路由值构建一个 URL 时，它找不到一个（因为它们都没有“{controller}”和“{action}”参数）。

在这种情况下，最简单的解决方案是创建到“创建”操作的直接路由，这样您仍然可以使用“哈希”路由。将它放在 RegisterRoutes 方法的顶部。注意：顺序*很*重要！ASP.Net Routing 按添加的顺序检查每个路由，直到找到匹配项。

```
routes.MapRoute(
        "Create",                                              // Route name
        "Create",                           // URL with parameters
        new { controller = "Home", action = "Create" }  // Parameter defaults
    ); 
```

因为你有那个“散列”路由，你不能真正使用默认的“{controller}/{action}/{id}”技术，因为“散列”值将被认为是一个有效的控制器名称。因此，如果有人请求：[http](http://www.mysite.com/fjhas82) : //www.mysite.com/fjhas82，MVC 会寻找一个名为“fjhas82”的控制器并抱怨它找不到它。不幸的是，这意味着你必须为每个新的控制器动作手动添加新的路由（就像我上面展示的那样），这很痛苦。

最好的解决方案（在我看来）是使用正则表达式约束：如果您的哈希具有非常明确的格式（例如：5 个字母后跟 2 个数字，或“_”后跟任何字母数字字符等），或者，如果您愿意采用这种格式，则可以使用 ASP.Net Routing 支持的 Regex 约束。然后，您只需要这两条路线

```
routes.MapRoute(
        "Redirect",
        "{hash}",
        new { controller = "Home", action = "RequestLink" },
        new { hash = @"[a-zA-Z]{5}[0-9]{2}" } // Regex Constraints
    );

routes.MapRoute(
    "Default",                                              // Route name
    "{controller}/{action}/{id}",                           // URL with parameters
    new { controller = "Home", action = "Index" }  // Parameter defaults
); 
```

在这些路由下，如果 MVC 看到控制器名称如：“Home”，它会检查第一个路由，发现它与正则表达式不匹配，然后移动到下一个。注意：我的正则表达式语法可能有点生疏，所以我会先使用[http://regexpal.com/](http://regexpal.com/)之类的东西来测试正则表达式，以确保它适用于您的哈希和控制器名称。

希望对您有所帮助，我知道我写了很多，但是 MVC 是如此灵活，您可以用很多不同的方式来做事！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T05:20:29.550

从我了解到的情况中，我遇到了一个类似的问题是路由采用最后一条路线

所以它使用你的哈希路由，所以它把“”

基本上你可以摆脱那个哈希路由，只需要这个

```
 routes.MapRoute(            "Default",                                              // Route name            "{controller}/{action}/{hash}",                           // URL with parameters            new { controller = "Home", action = "Index", hash="" }  // Parameter defaults        ); 
```

它会完成同样的事情，当没有提供哈希时，这无关紧要

# c++ - Windows 版本标识 [C/C++]

> ID：741294
> 
> 赞同：4
> 
> 时间：2009-04-12T05:10:54.313
> 
> 标签：c++, c, windows

如何以编程方式确定当前安装的 Windows 版本？就像区分vista和xp一样。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-12T05:15:15.240

如果您使用的是 Win32，那么您可以使用[GetVersionEx](http://msdn.microsoft.com/en-us/library/ms724451(VS.85).aspx) API 来识别操作系统。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-12T05:36:37.450

这里的直接问题是您要测试什么？最好[检查功能](http://msdn.microsoft.com/en-us/library/ms724832.aspx)而不是比较版本号（因为有各种缩减版的 Windows）。

[VerifyVersionInfo](http://msdn.microsoft.com/en-us/library/ms725492.aspx)两者都会做，并且是比较主要/次要数字的推荐方法。

```
BOOL IsAtLeast2008DC() {

  OSVERSIONINFOEX osvi = {0};
  DWORDLONG mask = 0;

  osvi.dwOSVersionInfoSize = sizeof(OSVERSIONINFOEX);
  osvi.dwMajorVersion = 6;
  osvi.dwMinorVersion = 0;
  osvi.wServicePackMajor = 0;
  osvi.wServicePackMinor = 0;
  osvi.wProductType = VER_NT_DOMAIN_CONTROLLER;

  VER_SET_CONDITION(mask, VER_MAJORVERSION, VER_GREATER_EQUAL);
  VER_SET_CONDITION(mask, VER_MINORVERSION, VER_GREATER_EQUAL);
  VER_SET_CONDITION(mask, VER_SERVICEPACKMAJOR, VER_GREATER_EQUAL);
  VER_SET_CONDITION(mask, VER_SERVICEPACKMINOR, VER_GREATER_EQUAL);
  VER_SET_CONDITION(mask, VER_SERVICEPACKMINOR, VER_GREATER_EQUAL);
  VER_SET_CONDITION(mask, VER_PRODUCT_TYPE, VER_EQUAL);

  return VerifyVersionInfo(&osvi,
      VER_MAJORVERSION | VER_MINORVERSION |
      VER_SERVICEPACKMAJOR | VER_SERVICEPACKMINOR |
      VER_PRODUCT_TYPE, 
      mask
      );

} 
```

要仅测试 Vista 或更高版本，请删除提及产品类型的行。您会[在此处](http://msdn.microsoft.com/en-us/library/ms725491.aspx)找到更多示例，但请注意您要检查的内容。

# linq-to-sql - Linq to SQL：具有匿名类型的 DISTINCT

> ID：741299
> 
> 赞同：1
> 
> 时间：2009-04-12T05:16:31.150
> 
> 标签：linq-to-sql, distinct, anonymous-types

鉴于此代码：

```
dgIPs.DataSource = 
    from act in Master.dc.Activities
    where act.Session.UID == Master.u.ID
    select new
    {
      Address = act.Session.IP.Address,
      Domain = act.Session.IP.Domain,
      FirstAccess = act.Session.IP.FirstAccess,
      LastAccess = act.Session.IP.LastAccess,
      IsSpider = act.Session.IP.isSpider,
      NumberProblems = act.Session.IP.NumProblems,
      NumberSessions = act.Session.IP.Sessions.Count()
    }; 
```

如何仅基于不同的地址提取 Distinct()？也就是说，如果我简单地添加 Distinct()，它会将整行评估为不同的，因此无法找到任何重复项。我想为每个 act.Session.IP 对象返回一行。

我已经找到[了这个答案](https://stackoverflow.com/questions/543482/linq-select-distinct-with-anonymous-types)，但这似乎是另一种情况。此外，如果我只选择 act.Session.IP，Distinct() 工作正常，但它有一个我希望避免检索的列，我宁愿不必通过手动绑定我的数据网格列来做到这一点。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-12T05:39:27.817

```
dgIPs.DataSource = 
    from act in Master.dc.Activities
    where act.Session.UID == Master.u.ID
    group act by act.Session.IP.Address into g
    let ip = g.First().Session.IP
    select new
    {
      Address = ip.Address,
      Domain = ip.Domain,
      FirstAccess = ip.FirstAccess,
      LastAccess = ip.LastAccess,
      IsSpider = ip.isSpider,
      NumberProblems = ip.NumProblems,
      NumberSessions = ip.Sessions.Count()
    }; 
```

或者：

```
dgIPs.DataSource = 
    from act in Master.dc.Activities
    where act.Session.UID == Master.u.ID
    group act.Session.IP by act.Session.IP.Address into g
    let ip = g.First()
    select new
    {
      Address = ip.Address,
      Domain = ip.Domain,
      FirstAccess = ip.FirstAccess,
      LastAccess = ip.LastAccess,
      IsSpider = ip.isSpider,
      NumberProblems = ip.NumProblems,
      NumberSessions = ip.Sessions.Count()
    }; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T05:23:01.243

Enumerable.Distinct 的重载之一接受 IEqualityComparer 实例。只需编写一个实现 IEqualityComparer 并且只比较两个 Address 属性的类。

不幸的是，您必须为正在使用的匿名类命名。

# c++ - 如果我的编译器不支持，如何在 C 或 C++ 中加减 128 位整数？

> ID：741301
> 
> 赞同：27
> 
> 时间：2009-04-12T05:19:32.343
> 
> 标签：c++, integer, 128-bit

我正在为一长串 128 位数字编写压缩器。我想将数字存储为差异 - 仅存储数字之间的差异而不是数字本身，因为我可以将差异打包成更少的字节，因为它们更小。

但是，对于压缩，我需要减去这些 128 位值，而对于解压缩，我需要添加这些值。我的编译器的最大整数大小为 64 位宽。

有人对有效地做到这一点有任何想法吗？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-04-12T06:43:13.530

如果您只需要加法和减法，并且您已经拥有二进制形式的 128 位值，那么库可能很方便，但并非绝对必要。这个数学对自己来说是微不足道的。

我不知道您的编译器对 64 位类型使用什么，所以我将使用 INT64 和 UINT64 来处理有符号和无符号的 64 位整数。

```
class Int128
{
public:
    ...
    Int128 operator+(const Int128 & rhs)
    {
        Int128 sum;
        sum.high = high + rhs.high;
        sum.low = low + rhs.low;
        // check for overflow of low 64 bits, add carry to high
        if (sum.low < low)
            ++sum.high;
        return sum;
    }
    Int128 operator-(const Int128 & rhs)
    {
        Int128 difference;
        difference.high = high - rhs.high;
        difference.low = low - rhs.low;
        // check for underflow of low 64 bits, subtract carry to high
        if (difference.low > low)
            --difference.high;
        return difference;
    }

private:
    INT64  high;
    UINT64 low;
}; 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-04-12T05:42:58.060

看看[GMP](http://gmplib.org/manual/)。

```
#include <stdio.h>
#include <gmp.h>

int main (int argc, char** argv) {
    mpz_t x, y, z;
    char *xs, *ys, *zs;
    int i;
    int base[4] = {2, 8, 10, 16};

    /* setting the value of x in base 10 */
    mpz_init_set_str(x, "100000000000000000000000000000000", 10);

    /* setting the value of y in base 16 */
    mpz_init_set_str(y, "FF", 16);

    /* just initalizing the result variable */
    mpz_init(z);

    mpz_sub(z, x, y);

    for (i = 0; i < 4; i++) {
        xs = mpz_get_str(NULL, base[i], x);
        ys = mpz_get_str(NULL, base[i], y);
        zs = mpz_get_str(NULL, base[i], z);

        /* print all three in base 10 */
        printf("x = %s\ny = %s\nz = %s\n\n", xs, ys, zs);

        free(xs);
        free(ys);
        free(zs);
    }

    return 0;
} 
```

输出是

```
x = 10011101110001011010110110101000001010110111000010110101100111011111000000100000000000000000000000000000000
y = 11111111
z = 10011101110001011010110110101000001010110111000010110101100111011111000000011111111111111111111111100000001

x = 235613266501267026547370040000000000
y = 377
z = 235613266501267026547370037777777401

x = 100000000000000000000000000000000
y = 255
z = 99999999999999999999999999999745

x = 4ee2d6d415b85acef8100000000
y = ff
z = 4ee2d6d415b85acef80ffffff01 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2010-05-29T15:44:15.397

完全偶然地偶然发现了这篇相对较旧的帖子，我认为有必要详细说明沃尔特先前的猜想，以使没有经验的读者受益。

首先，128位数字的有符号范围是-2 ^(127)到2 ^(127) -1，而不是原来规定的-2 ^(127)到2 ^(127 。)

其次，由于有限算术的循环特性，两个 128 位数字之间所需的最大差值为 -2 ^(127)到 2 ^(127) -1，其存储前提是 128 位，而不是 129。虽然 (2 ^(127) -1) - (-2 ^(127) ) = 2 ^(128) -1 这明显大于我们最大的 2 ^(127) -1 正整数，算术溢出总是确保任何两个*n位数字之间的最近距离总是在 0 到 2* ^(*n*)的范围内- 1，因此隐含 -2 ^(*n* -1)到 2 ^(*n* -1) -1。

为了澄清，让我们首先检查一个假设的 3 位处理器如何实现二进制加法。例如，考虑下表描述了 3 位整数的绝对无符号范围。

   0 = 000b
   1 = 001b
   2 = 010b
   3 = 011b
   4 = 100b
   5 = 101b
   6 = 110b
   7 = 111b ---> [溢出时循环回 000b]

从上表不难看出：

   001b(1) + 010b(2) = 011b(3)

同样明显的是，将这些数字中的任何一个与其数字补码相加总是会产生 2 ^(*n*) -1：

   010b(2) + 101b([2 的补码] = 5) = 111b(7) = (2 ³ -1)

由于当两个*n*位数字相加导致 ( *n* +1) 位结果时发生循环溢出，因此可以得出以下结论：将这些数字中的任何一个与其数字补码 + 1 相加总是会产生 0：

   010b(2) + 110b([2 的补码] + 1) = 000b(0)

因此我们可以说 [ *n*的补码] + 1 = - *n*，因此*n* + [ *n*的补码] + 1 = *n* + (- *n* ) = 0。此外，如果我们现在知道*n + [* *n*的补码] + 1 = 0，则*n + [* *n* - *x*的补码 ] + 1 必须 = *n* - ( *n* - *x* ) = *x*。

将其应用于我们原来的 3 位表会产生：

   0 = 000b = [0 的补码] + 1 = 0
   1 = 001b = [7 的补码] + 1 = -7
   2 = 010b = [6 的补码] + 1 = -6
   3 = 011b = [5 的补码] + 1 = -5
   4 = 100b = [4 的补码] + 1 = -4
   5 = 101b = [3 的补码] + 1 = -3
   6 = 110b = [2 的补码] + 1 = -2
   7 = 111b = [1 的补码] + 1 = -1 ---> [溢出时循环回 000b]

无论表示抽象是正的、负的还是两者的组合，正如带符号的补码算法所暗示的那样，我们现在有 2 ^(*n*) *n*位模式，可以无缝地为正 0 到 2 ^(*n*) -1 和负 0 到 -(2 ^(*n*) )-1 范围在需要时。事实上，所有现代处理器都采用这样的系统来实现加法和减法运算的通用 ALU 电路。当 CPU 遇到`i1 - i2`减法指令时，它会在内部执行 [complement + 1] 运算，`i2`然后通过加法电路处理操作数，以便计算`i1`+ [complement of`i2`] + 1。除了一个额外的进位/符号异或门控溢出标志外，有符号和无符号加法以及隐含减法都是隐式的。

如果我们将上表应用于 Volte 原始回复中提供的输入序列 [-2 ^(*n* -1) , 2 ^(*n* -1) -1, -2 ^(*n* -1) ]，我们现在可以计算以下 n 位差分：

差异 #1：
   (2 ^(*n* -1) -1) - (-2 ^(*n* -1) ) =
   3 - (-4) = 3 + 4 =
   (-1) = 7 = 111b

差异 #2：
   (-2 ^(*n* -1) ) - (2 ^(*n* -1) -1) =
   (-4) - 3 = (-4) + (5) =
   (-7) = 1 = 001b

从我们的种子 -2 ^(*n* -1)开始，我们现在能够通过依次应用上述每个微分来重现原始输入序列：

   (-2 ^(*n* -1) ) + (diff #1) =
   (-4) + 7 = 3 =
   2 ^(*n* -1) -1

   (2 ^(*n* -1) -1) + (diff #2) =
   3 + (-7) = (-4) =
   -2 ^(*n* -1)

您当然可能希望对这个问题采取更哲学的方法，并推测为什么 2 ^(*n 个*)循环序列数需要超过 2 ^(*n 个*)循环序列微分？

塔利亚顿。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2013-04-25T15:28:48.270

Boost 1.53 现在包括多精度：

```
#include <boost/multiprecision/cpp_int.hpp>
#include <iostream>

// Requires Boost 1.53 or higher
// build: g++ text.cpp

int main()
{
    namespace mp = boost::multiprecision;

    mp::uint128_t a = 4294967296;
    mp::uint256_t b(0);
    mp::uint512_t c(0);

    b = a * a;
    c = b * b;

    std::cout << "c: " << c << "\n";
    return 0;
} 
```

输出：

```
./a.out
c: 340282366920938463463374607431768211456 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-12T06:06:35.100

有很多关于大整数数学的文献。您可以使用免费提供的库之一（请参阅链接），也可以使用自己的库。尽管我应该警告您，但对于比加减法（和移位）更复杂的任何事情，您都需要使用非平凡的算法。

要进行加减运算，您可以创建一个包含两个 64 位整数的类/结构。您可以使用简单的学校数学来进行加法和减法。基本上，做你用铅笔和纸做的事情来增加或减少，仔细考虑携带/借用。

搜索大整数。顺便说一句，最近版本的 VC++、IntelC++ 和 GCC 编译器具有 128 位整数类型，尽管我不确定它们是否像您希望的那样容易访问（它们旨在与 sse2/xmms 寄存器一起使用）。

*   [http://en.wikipedia.org/wiki/Arbitrary_precision_arithmetic](http://en.wikipedia.org/wiki/Arbitrary_precision_arithmetic)
*   [http://orion.math.iastate.edu/cbergman/crypto/bignums.html](http://orion.math.iastate.edu/cbergman/crypto/bignums.html)
*   [http://www.mathgoodies.com/tutorial/](http://www.mathgoodies.com/tutorial/)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-12T06:04:35.887

[TomsFastMath](http://www.libtom.net/TomsFastMath/)有点像 GMP（上面提到过），但它是公共领域的，并且从一开始就设计得非常快（它甚至包含针对 x86、x86-64、ARM、SSE2、PPC32 和 AVR32 的汇编代码优化） .

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-11-08T09:45:31.390

另外值得注意的是：如果目标仅仅是通过预处理来改进数字流的压缩，那么预处理的流不必由精确的算术差异组成。您可以使用 XOR ( `^`) 代替`+`and `-`。优点是128位异或与64位部分上的两个独立异或完全一样，既简单又高效。

# c++ - 使用 **ClassObject ( C++ ) 调用公共成员

> ID：741306
> 
> 赞同：0
> 
> 时间：2009-04-12T05:28:05.677
> 
> 标签：c++

我需要打电话给我的公众成员。接受 1 个参数的构造函数。

这就是我的代码的样子：// main

```
char tmpArray[100] = {};

while ( !inFile.eof() )
{
   for ( unsigned x = 0; x < str2.length(); x++ )
   {
    if ( !isspace( str2[x] ) || isspace( str2[x] ) ) 
    {   
       tmpArray[x] = str2[x]; // prepare to supply the constructor with each word
       ClassObject[wrdCount] = new ClassType[x] ;
       //ClassObject[wordCount]->ClassType( tmpArray );
    }
   }
} 
```

错误是：

> 'function-style cast' : 非法作为'->' 运算符的右侧

为了尝试解决这个问题，我尝试了两个等效的表达式：

```
/* no good */ (*ClassObject[wrdCount]).ClassType( tmpArray );
/* no good */ (*ClassObject[wrdCount][10]).ClassType( tmpArray );
/* combine */ ClassObject[arbitrary][values]->ClassType( tmpArray ); 
```

Intellisense 确实会调出我所有的成员和私人，除了构造函数。这可能是原因吗？

//MyHeader.h

```
class ClassObject
{
    private:
    const char* cPtr;
    float theLength;
public:
    ClassObject( const char* );  // Yes its here and saved..
    ClassObject(); // an appropriate default constructor
    ~ClassObject( );
    char GetThis( );
    char* GetThat( );
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-12T05:46:55.587

我假设以下事情，因为从发布的代码中不清楚：

(1)。ClassObject 定义如下： ClassType* ClassObject[/ *some value* /10];

(2)。MyHeader.h 中的类定义属于 ClassType 而不是 ClassObject。

在这种情况下，以下语句就是问题所在：

```
ClassObject[wrdCount] = new ClassType[x] 
```

在这里，它创建了“x”个 ClassType 对象。我不认为那是你想要的。我猜你想通过传递 const char* 作为构造函数参数来构造一个 ClassType 对象。如果是这样，您应该像这样使用它：

```
ClassObject[wrdCount] = new ClassType(tmpAray); 
```

另请注意，您假设传递的数组的大小。我建议最好使用 std::string 之类的东西而不是原始字符数组。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T06:01:33.163

我不完全清楚你在做什么，但你不能显式地调用这样的构造函数。如果你有一个指向`ClassType`被调用指针的指针`ClassObject`，你需要做这样的事情来初始化它：

```
ClassObject[wrdCount] = new ClassType*[x]; // create a new 'row' in the array with x columns
for (int i = 0; i < x; ++i) // initialize each 'column' in the new row
    ClassObject[wrdCount][i] = new ClassType(tmpArray); 
```

考虑到您粘贴的代码，这似乎没有多大意义（因为 wrdCount 没有改变）。没有确切的问题描述很难说。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T09:12:48.337

您需要使用标识符。以下：

```
ClassObject[wrdCount] = new ClassType[x] ; 
```

尝试将 应用于`operator[]`类类型名称。这能有什么好处？没有任何。尝试：

```
ClassObject *a = new ClassType[x]; 
```

这将创建一个`a`大小`x`为`Classtype`s 的数组类型的对象。你需要一个数组吗——这取决于你。如果您只需要一个变量，请使用：

```
ClassObject *a = new ClassType; 
```

# sql - MYSQL 一对多 JOIN

> ID：741308
> 
> 赞同：0
> 
> 时间：2009-04-12T05:34:33.757
> 
> 标签：sql, mysql

我有这个查询，我需要在名为“likes”的表中包含另一个联接，其中up​​dates.id = likes.update_id。此连接将有 0 个或更多匹配项。

```
"SELECT * FROM users 
INNER JOIN updates ON users.remote_id=updates.owner_id 
ORDER BY updates.status_time DESC LIMIT 50" 
```

这可能相当简单，但我无法找到此类查询的任何示例。

这种情况基本上是我正在显示一个项目列表。我在 users 表上进行连接以获取创建每个项目的用户。我还需要在“喜欢”表上进行连接，以显示喜欢每个项目的 0+ 人。

* * *

编辑：我的解决方案

好的，这里是使用 GROUP_CONCAT 成功加入和组合重复结果（由于每次更新都有多个“喜欢”）。

```
"SELECT   users.*,updates.update_id,updates.content,updates.status_time,
GROUP_CONCAT(likes.liker SEPARATOR ',') AS liked_by 
FROM updates 
LEFT OUTER JOIN likes ON updates.update_id = likes.update_id 
JOIN users ON users.remote_id = updates.owner_id 
GROUP BY updates.update_id 
ORDER BY updates.status_time DESC 
LIMIT 200" 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T05:38:27.743

```
SELECT * FROM users 
LEFT OUTER JOIN updates ON users.remote_id=updates.owner_id
INNER JOIN likes ON <join condition here>
ORDER BY updates.time DESC LIMIT 50 
```

那会奏效吗？

如果没有，你能澄清你的问题到底是什么吗？难道你的查询没有工作？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T07:07:36.063

如果你有一个 1 到 n 的关系，你应该使用 LEFT JOIN ，我的意思是如果只有 1 个用户和很多 likes.user_id 你应该用以下方式做

“SELECT * FROM users LEFT JOIN updates ON (users.remote_id=updates.owner_id) ORDER BY updates.time DESC LIMIT 50”

这样您就可以从某个用户那里获得所有更新:)

干杯

# javascript - Click-to-focus 和 focus-by-javascript 有什么区别？

> ID：741315
> 
> 赞同：1
> 
> 时间：2009-04-12T05:42:25.330
> 
> 标签：javascript, html, internet-explorer, focus

我遇到了一个结构复杂的麻烦网页。如果用鼠标单击一个***DIV***，则一切正常。但是，如果它是由 javascript 聚焦的（即 divElement.focus）。布局变得凌乱。这只发生在 IE7/8 中。

那么，IE中的click-to-focus和focus-by-javascript有什么区别吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-12T05:59:29.657

触发 Javascript`focus`事件不会触发`click`事件。在没有看到相关代码的情况下，我猜测某些`click`处理程序已经到位，在您触发`focus`事件的情况下没有被调用。

相反，您可以尝试触发`click`：

```
var clickEvent;
if(document.createEvent) {
    clickEvent = document.createEvent('click');
    clickEvent.initMouseEvent('click');
    divElement.dispatchEvent(clickEvent);
} else {
    // Semi-pseudocode for IE, not tested, consult documentation if it fails
    clickEvent = document.createEventObject();
    divElement.fireEvent('onclick');
} 
```

或者，如果您喜欢 jQuery：

```
$(divElement).click(); 
```

Prototype 也有类似的解决方案（搜索 Event.simulate）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T15:02:52.410

> 这只发生在 IE7/8 中。

嗯，那我确定这是一个与 IE 相关的错误。不奇怪。如果涉及合法的 Javascript 事件，那么它们应该在所有浏览器中统一触发。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T06:22:41.897

Focus动作的定义是将输入（键盘或鼠标）带到某个元素，通常是输入字段。当元素获得焦点时，会触发 OnFocus 事件。当它失去焦点时，会触发 OnBlur 事件。

通常点击得到的是OnClick事件，与以上两个没有必然联系。

# html - 如何创建脚本以从 Excel 复制单元格并粘贴到位于浏览器上的文本框中

> ID：741316
> 
> 赞同：0
> 
> 时间：2009-04-12T05:42:42.740
> 
> 标签：html, forms, vba, excel

在工作中，我们必须通过通过 vb.net 制作的在线应用程序来跟踪我们的电话。要在文本框和下拉框中输入所需的信息，您必须处理多个页面。必须键入甚至复制和粘贴所需的信息很麻烦。

我希望能够在 excel 中将信息输入到一个页面上，然后让脚本能够自动复制并粘贴到位于浏览器屏幕上的文本框中，而无需我进行复制和粘贴。

这可能吗？谁能指出我正确的方向？

我注意到当您尝试创建一个电子邮件帐户时，他们总是有一个框，您必须在其中输入波浪形的字母。我认为这是因为有些应用程序可以自动粘贴或写入位于浏览器屏幕上的文本框中。

任何能帮助我指出正确方向的帮助都会很棒。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-12T10:43:41.893

据我所知，您想要的是 Excel 工作表中的一些第 3 方脚本或 VBA 脚本来为您进行复制/粘贴。

我可以告诉你的是，尝试让浏览器完成这项工作是行不通的*。*浏览器能做什么和不能做什么有很多限制，主要是阻止它访问您计算机上的数据。这包括从 Excel 电子表格复制。

我认为您可以做的是构建一个非常非常严格的 Windows Shell 脚本。使用该[`SendKeys`](http://www.devguru.com/Technologies/wsh/QuickRef/wshshell_SendKeys.html)功能，您可以执行一组按键，就像您自己完成一样。

您可以让脚本执行以下操作：

1.  激活 Excel 的窗口
2.  移动到您要复制的第一个单元格。（通过使用箭头键。）
3.  复制它。（通过使用 CTRL-INSERT）
4.  激活 VB.NET 窗口
5.  移动到您从第一个单元格插入数据的位置。（反复使用 TAB。）
6.  粘贴它。（通过使用 SHIFT-INSERT）

*我必须警告你，如果有任何*不合适的地方，这样的脚本将会失败- 当前光标位置错误，每个窗口的文本都已更改，等等。

这是一个例子：

```
Set WshShell = WScript.CreateObject("WScript.Shell")
WshShell.AppActivate "the-exact-text-in-the-titlebar-of-Excel"
WScript.Sleep 50
WshShell.SendKeys "{RIGHT}"
WshShell.SendKeys "{RIGHT}"
WshShell.SendKeys "{DOWN}"
WshShell.SendKeys "^{INSERT}"
WshShell.AppActivate "the-exact-text-in-the-titlebar-of-vb.net-browser-window"
WScript.Sleep 50
WshShell.SendKeys "{TAB}"
WshShell.SendKeys "{TAB}"
WshShell.SendKeys "{TAB}"
WshShell.SendKeys "+{INSERT}" 
```

该示例假设：

1.  要从 Excel 复制的单元格位于 Excel 中当前光标位置右侧的第二列，向下一行。
2.  在 vb 表单中粘贴的位置是浏览器中当前光标位置的第 3 个控件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T11:18:40.310

除了@scraimer 的 SendKeys 之外，我想不出任何特定的方式来完全按照您的要求进行操作。牢记他的警告，SendKeys 很难可靠地完成。

获得相同最终结果的另一种可能性是更改您的 .aspx 以接受 GET 变量并在 PageLoad() 上预填充其字段，您可能有 3 个填充名称、公司和消息的变量；

```
http://www.mysite.com/myform.aspx?var1=JoeBolgs&var2=Company+XYZ&var3=Help+me+please 
```

然后在 VBA 中创建用户可以填写的表单或工作表 var1 -> var3

```
// obviously make your var names nicer than mine :)
myUrl = "http://www.mysite.com/myform.aspx?"
myUrl = myUrl & "var1="  & strVar1
myUrl = myUrl & "&var2=" & strVar2
myUrl = myUrl & "&var3=" & strVar3

OpenBrowserURL(myUrl) 
```

并有一个`OpenBrowserURL()`例行公事

```
Sub OpenBrowserURL(strURL As String)
  ActiveWorkbook.FollowHyperlink Address:=strURL, NewWindow:=True
End Sub 
```

我对通过菜单调用的帮助页面使用类似的东西，它很有效。用户单击一个菜单，VBA 在用户最喜欢的浏览器中打开一个带有一些数据的 url。

我以编程方式与 VBA 网站交互的唯一其他方法是直接调用 wininet.dll 以获取 GET 和 POST 数据。虽然不认为这对你的问题有帮助。

最后一个想法，如果你想阻止人们以某种​​方式玩你的网站，你应该加密你的变量。加密然后 UUEncode 数据并将其作为请求变量发送并不难。然后只需对其进行 URLdecode 并在服务器上使用与加密它相同的算法对其进行解密。

祝你好运。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T13:48:47.910

加入两个excel表+一个excel单元格更改+在vb.net中用源代码更改另一个表

# jquery - jquery ui datepicker dateformat

> ID：741325
> 
> 赞同：4
> 
> 时间：2009-04-12T05:52:23.997
> 
> 标签：jquery, user-interface, datepicker

我遇到了一些问题来获得正确的日期格式。

在我的日期字段失去焦点后，我希望它显示如下：

dd-mm-yyyy 但它必须像这样保存在数据库中

yyyy-mm-dd。.

这是我到目前为止所拥有的：

```
$("#birthdate").datepicker({
            changeMonth: true,
            changeYear: true,
            altFormat: 'yyyy-mm-dd' 
             }); 
```

现在它显示在日期字段中，如 2009 年 11 月 25 日（2009 年 11 月 25 日），发布日期为 2009 年 11 月 25 日

有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-12T12:00:17.887

尝试这个：

```
<script type="text/javascript" charset="utf-8">
$(document).ready(function()
{   
    $("#datepicker").datepicker({
        altField: '#realdate', 
        altFormat:'yy-mm-dd'
    }); 
}); 
```

```
<input type="text" name="datepicker" value="" id="datepicker">
<input type="hidden" name="realdate" value="" id="realdate"> 
```

然后使用 realdate 获取发布日期。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-15T16:06:26.210

MrHus 有一个很好的答案，但您应该只在后端处理它，因为这些信息可以通过代理或许多其他可能的恶意方式伪造。例如，如果您正在运行 PHP，它将是这样的：

```
<?php
// BTW... you'll want to check for XSS attacks and other vulnerabilities first...
$date = '08/05/1986';//$_REQUEST['datepicker'];
// This is very simple... you should also check if the date is real...
if(preg_match('/^\d{2}\/\d{2}\/\d{4}$/',$date)) {
    $date_formatted = date('Y-m-d',strtotime($date));
}
// put $date_formatted into database...
?> 
```

我们的两个答案的组合应该让你（大部分）安全地到达那里。

# c# - 可编辑的 WPF 列表框

> ID：741326
> 
> 赞同：5
> 
> 时间：2009-04-12T05:58:07.023
> 
> 标签：c#, wpf, data-binding

我有一个绑定到 WPF 中的 ListBox 的 ObservableCollection。我希望 ListBox 可编辑，并将编辑更改保存到集合中。由于 WPF 不提供可编辑的列表框，我尝试通过更改 ListBox.ItemTemplate 创建自己的列表框。

```
<ListBox.ItemTemplate>
    <DataTemplate>                      
        <TextBox Name="EditableText" Text="{TemplateBinding Content}"/>
    </DataTemplate>
</ListBox.ItemTemplate> 
```

更改 ItemTemplate 给了我可编辑的框，但是对文本框的任何更改都不会保存到 ObservableCollection。有没有办法让一个可编辑的 ListBox 具有双向绑定？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-12T06:22:45.343

你不能这样做。

要实现这种技巧，您需要将您的项目作为“持有者类”，以公开您可以将文本框绑定到的属性。

为了理解它，想象一下下面的伪调用序列：

```
class ListBox
{
  Bind(Items)
  {
    foreach(var item in Items)
    {
      DataTemplate Template = LoadTemplateForItem(item.GetType()); // this is where your template get loaded
      Template.Bind(item); //this is where your template gets bound
    }
  }
} 
```

您的模板（带有列表框的 DataTemplate）被加载并且项目（我假设在您的情况下是一个字符串）被传入。此时，它只知道字符串，并且不能影响任何向上的东西。双向绑定不会影响集合，因为模板不知道在哪个上下文中使用它，因此它无法返回原始集合并修改其内容。就此而言，TextBox 也是如此。如果没有给它一个容器和一个属性名称，它就没有地方“存储”这些更改。这基本上与将字符串传递给函数调用相同。该函数无法更改传入的字符串（忽略通过引用参数传递等技巧）。

回到您的案例，您需要构建一个对象集合，这些对象公开一个包含需要编辑的值的属性：

```
public class MyDataItem
{
  string Data { get; set;}
} 
```

然后您可以将您的 ListBox 绑定到这些项目的集合并修改您的数据模板：

```
<ListBox.ItemTemplate>
    <DataTemplate>                                              
            <TextBox Name="EditableText" Text="{Binding Data, Mode=TwoWay}"/>
    </DataTemplate>
</ListBox.ItemTemplate> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T06:20:43.600

绑定到模型属性——即数据对象的属性——而不是视图属性，例如内容。例如：

```
// model class
public class Widget : INotifyPropertyChanged
{
  public string Description { ... }
}

<!-- view -->
<DataTemplate>
  <TextBox Text="{Binding Description}" />
</DataTemplate> 
```

请注意，如果您的 ItemsSource 是 ObservableCollection，这将不起作用（因为没有要绑定的属性）。

# iphone - 重用 Cocos2d CocosNodes

> ID：741327
> 
> 赞同：1
> 
> 时间：2009-04-12T05:59:05.773
> 
> 标签：iphone, cocoa, cocoa-touch, cocos2d-iphone

我正在尝试在我的 iPhone 游戏中创建一个很酷的分数计数器，我在 Photoshop 中创建了数字 0 到 9，并且我想每秒更新分数。

我现在正在做的事情如下：

*   在我的初始化中，我将所有数字精灵加载到一个数组中，以便该数组有 10 个项目。

*   我创建了一个方法，它将当前分数（例如 2000）分解为单个数字并从数组中获取精灵，然后将它们添加到父 CocosNode* 对象中。

*   每秒钟我都会通过它的标签获取父 CocosNode 并将其替换为新的父对象。

目前我已经遇到了这个问题，因为分数 2000 使用了 3 次 0 位，我不能重复使用精灵。

```
- (CocosNode*) createScoreString:(int) score
{
    NSLog(@"Creating score string : %d", score);
    NSString* scoreString = [NSString stringWithFormat:@"%d", score];

    int xAxes = 0;
    CocosNode* parentNode = [[Sprite alloc] init];
    for (NSInteger index = 0; index < [scoreString length]; index++)
    {
        NSRange range;
        range.length = 1;
        range.location = index;

        NSString* digit = [scoreString substringWithRange:range];

        Sprite* digitSpriteOriginal = [self.digitArray objectAtIndex:[digit intValue]];
        Sprite* digitSprite = [digitSpriteOriginal copy];
        [digitSprite setPosition:cpv(xAxes, 0)];

        xAxes += [digitSprite contentSize].width - 10;

        [parentNode addChild:digitSprite];
    }
    return parentNode;
} 
```

我是在 cocos2d 中以正确的方式处理这个问题，还是有一些标准功能？另外，如果这是正确的，我怎样才能“重用”精灵？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T08:34:47.383

我相信你想使用[`LabelAtlas`class](http://www.google.com/codesearch/p?hl=en#PWa7F9gP7VU/trunk/cocos2d/LabelAtlas.m&q=LabelAtlas)，你只需要提供一个兼容的位图（就像 fps 计数器使用的一样）。

# subsonic - 为什么 SS 生成的所有 Int 数据类型都为 bool？

> ID：741334
> 
> 赞同：0
> 
> 时间：2009-04-12T06:03:19.320
> 
> 标签：subsonic, int, boolean

我的数据库有一些使用整数数据类型的字段，但是在 SS 生成它们之后，它们都是布尔数据库类型。

请告诉我如何解决它！

谢谢 ！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T19:01:45.223

Tinyint 将被标记为布尔值，因为许多数据库使用它来表示真/假。这是我们必须为 MySQL 做出的选择，我知道这可能会导致问题。

如果您使用 SubSonic 3，您可以在模板中进行更改。

# java - 如何配置 OC4J 以支持阿拉伯语？

> ID：741335
> 
> 赞同：1
> 
> 时间：2009-04-12T06:04:11.177
> 
> 标签：java, arabic, oc4j

如何配置 OC4J 以支持阿拉伯语？一些阿拉伯语内容显示为？问号，但是在出现此问题的页面中，页面编码（**<%@ page pageEncoding="windows-1256" %>**）设置正确（我尝试了所有可能的替代 windows-1256、utf8、... ETC）

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-12T06:06:21.793

要调整 OC4J 配置以支持阿拉伯语，请执行以下操作：

在命令行选项块的 OC4J 服务器属性屏幕中，将粗体选项添加到您的 Java 选项中，如下所示：

Java 选项= -Xms512m -Xmx512m -server -Djava.security.policy=/u01/app/oracle/products/10gias/j2ee/OC4J_EPS/config/java2.policy **-Djava.awt.headless=true -Duser.region=AE -Duser.language=ar -Dfile.encoding=windows-1256** -Xverify:none

# javascript - 为什么弹出警报会影响“designMode”？

> ID：741343
> 
> 赞同：0
> 
> 时间：2009-04-12T06:07:03.663
> 
> 标签：javascript, firefox, alert, designmode

我正在尝试构建一个页面编辑器。一个问题让我在 Firefox 中发疯。

页面代码如下：

```
<body>
<iframe WIDTH=200 HEIGHT=200 id="myEditor"></iframe>
<script>

    function getIFrameDocument(sID){
        // if contentDocument exists, W3C compliant (Mozilla)
        if (document.getElementById(sID).contentDocument){
            alert("mozilla"); // comment out this line and it doesn't work
            return document.getElementById(sID).contentDocument;
        } else {
            // IE
            alert("IE");
            //return document.getElementById(sID);
            return document.frames[sID].document;
        }
    }

    getIFrameDocument("myEditor").designMode = "On";

</script>

</body> 
```

它只是检查以Mozilla方式或IE方式设置“designMode”是否合适。当页面加载时，会弹出一个“Mozilla”；点击 iframe 区域，焦点在 iframe 上，我可以用键盘输入。

这看起来不错，但是当我注释掉***“alert("mozilla");*** ”，它不起作用。如 FireBug 所示，“designMode”为“Off”。

这太有线了。为什么警报会影响 DOM 和 javascript？顺便说一句，我的 Firefox 是 3.0.6。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T06:09:26.937

因为警报为 iframe 提供了加载时间。只有在 iframe 文档加载后，您才应将 designMode 设置为“on”：

```
iframe.onload = function() {
    doc.designMode = "on";
}; 
```

# php - 如何使用 Zend OpenID 实现基于 Direct Identity 的 OpenID 身份验证

> ID：741345
> 
> 赞同：16
> 
> 时间：2009-04-12T06:08:06.300
> 
> 标签：php, zend-framework, authentication, login, openid

我正在使用 Zend 框架和来自[http://code.google.com/p/openid-selector/](http://code.google.com/p/openid-selector/)的 openid 选择器- 但是我发现我无法使用 Google 和 Yahoo 等网站登录，因为它们使用基于直接身份的登录系统，其中一个人只是被重定向到一个 url，而不是输入他们自己的唯一 url 进行身份验证。

我已经检查了许多选项和技巧，但它们似乎都不起作用。顺便说一句，我怎样才能让它在这里工作 - 它是如何在堆栈溢出时实现的？我真的可以在这里使用所有的帮助。

* * *

编辑

好吧，这里的问题是，据我所知，Zend OpenID 类不支持 OpenID 2.0 问题是典型的开放 ID 提供程序为您提供了一个唯一的 url，例如 your-name.openid-providor.com 或 openid -providor.com/your-name 和 Zend OpenId 类只是通过该 url 进行解析，然后将您重定向到提供者网站，在该网站上进行身份验证后您将被重定向回来。

在 Yahoo 和 google 的情况下 - 您没有输入唯一的 url，而是被重定向到提供者登录站点，并且在登录和身份验证后，您被重定向回来 - 所以基本上发生的事情是 zend_openID 对象在解析时告诉谁提供者是它无法从一般 url 本身中分辨出来。就像当您点击 Google 链接时，它会将您重定向到[https://www.google.com/accounts/o8/id](https://www.google.com/accounts/o8/id)

这里的 zend openid 对象更多的是一个问题，并且在 zend 相关论坛上没有任何帮助 - 所以我想知道是否有人已经入侵或对班级进行了更改以完成此操作。抱歉，如果我遗漏了一些东西，但我对此有点陌生，并且使用开放 ID 进行编程，并且刚刚开始涉足。

* * *

感谢您的跟进 - 我确实检查了 RPX 一段时间，他们确实有一个 php 类，但我无法检查它，而且我现在真的只想让在 stackoverflow 上使用的代码选择器与 Yahoo 和谷歌认证。必须有某种方法来调整 Zend OpenID 类在运行一系列正则表达式检查以进行发现时使用的解析。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-09T23:45:15.397

游戏有点晚了，但我能够通过我在互联网上发现的一些黑客来完成这项工作。

第一的。雅虎。为了让 Yahoo 正常工作，我只需将 JavaScript 更改为使用**me.yahoo.com**而不是**yahoo.com**，它与我正在使用的 Zend Framework 版本完美配合。不幸的是，谷歌仍然没有，所以一些黑客攻击是为了。

所有这些变化都在`Zend/OpenId/Consumer.php`

首先，在该`_discovery`方法中，在从第 740 行开始的一系列 preg_match 检查中添加以下内容。

```
} else if (preg_match('/<URI>([^<]+)<\/URI>/i', $response, $r)) {
    $version = 2.0;
    $server = $r[1]; 
```

`return false;`我在 else {} 块中的语句之前添加了这个。

其次，在该`_checkId`方法中，您需要添加 3 个新块（我没有深入了解导致这三种情况中的每一种被调用的原因，所以为了安全起见，我涵盖了所有内容。

在 $version <= 2.0 块中，您会找到一个 if/else if/else 块。在第一个 if 语句`($this->_session !== null)`中将其添加到末尾：

```
if ($server == 'https://www.google.com/accounts/o8/ud') {
    $this->_session->identity = 'http://specs.openid.net/auth/2.0/identifier_select';
    $this->_session->claimed_id = 'http://specs.openid.net/auth/2.0/identifier_select';
} 
```

在 else if (defined('SID') 块中将其添加到末尾：

```
if ($server == 'https://www.google.com/accounts/o8/ud') {
    $_SESSION['zend_openid']['identity'] = 'http://specs.openid.net/auth/2.0/identifier_select';
    $_SESSION['zend_openid']['claimed_id'] = 'http://specs.openid.net/auth/2.0/identifier_select';
} 
```

然后在 else 块之后（所以在 if/else if/else 块之外，但仍在 $version <= 2.0 块内）添加：

```
if ($server == 'https://www.google.com/accounts/o8/ud') {
    $params['openid.identity'] = 'http://specs.openid.net/auth/2.0/identifier_select';
    $params['openid.claimed_id'] = 'http://specs.openid.net/auth/2.0/identifier_select';
} 
```

[链接到 Zend Framework 问题跟踪器中的错误](http://framework.zend.com/issues/browse/ZF-6905)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-08-17T00:30:59.597

我需要使用 Google 的 OpenID 东西，我尝试了 Steven 的代码，但无法让它按原样工作。我做了一些修改。

_discovery 更改方法还是一样的：

Zend/OpenId/Consumer.php，第 765 行，添加：

```
} else if (preg_match('/<URI>([^<]+)<\/URI>/i', $response, $r)) {
    $version = 2.0;
    $server = $r[1]; 
```

其余的则不同：

Zend/OpenId/Consumer.php，第 859 行（进行上述更改后），添加：

```
if (stristr($server, 'https://www.google.com/') !== false) {
    $id = 'http://specs.openid.net/auth/2.0/identifier_select';
    $claimedId = 'http://specs.openid.net/auth/2.0/identifier_select';
} 
```

这是之前的：

```
$params['openid.identity'] = $id;

$params['openid.claimed_id'] = $claimedId; 
```

并让它返回 ID，一旦授权：

Zend/Auth/Adapter/OpenId.php，第 278 行：

```
if(isset($_REQUEST['openid_identity']))
{
    $this->_id = $_REQUEST['openid_identity'];
    $id = $this->_id;
} 
```

这是之前的：

```
return new Zend_Auth_Result(
    Zend_Auth_Result::SUCCESS,
    $id,
    array("Authentication successful")); 
```

请注意，我没有彻底测试过这段代码。下面的代码更加不稳定。

除了上述内容之外，我还花费了更多时间，并通过以下更改使其与我的 Google Apps 域一起使用：

Zend/OpenId/Consumer.php，第 734 行

```
 $discovery_url = $id;
        if(strpos($discovery_url, '/', strpos($discovery_url, '//')+2) !== false) {
            $discovery_url = substr($discovery_url, 0, strpos($discovery_url, '/', strpos($discovery_url, '//')+2));
        }
        $discovery_url .= '/.well-known/host-meta';
        $response = $this->_httpRequest($discovery_url, 'GET', array(), $status);
        if ($status === 200 && is_string($response)) {
            if (preg_match('/Link: <([^><]+)>/i', $response, $r)) {
                $id = $r[1];
            }
        } 
```

这是紧随其后：

```
/* TODO: OpenID 2.0 (7.3) XRI and Yadis discovery */ 
```

我相信这是我必须做出的唯一改变。我很确定出于安全原因应该对上述内容进行一些检查，但我还没有深入研究它以了解它们会是什么。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T12:20:56.360

回顾所有提供的建议 - 我决定放弃使用 zend_openid 类 [ 对那个 zend 感到抱歉 ] 而是转而使用 JanRains OpenID 库。它需要几个小时才能启动并运行我的项目，但至少它的工作就像轻而易举。不得不进行大量的黑客攻击和一些代码溢出才能使其正常工作，但这是值得的。

我不能使用任何 Zend 适配器和 Zend-Auth 来解决这个新的代码库，因为该库自己进行身份验证。所以我破解并制作了一个通用适配器，它只返回一个填充的 zend_result 集到 Auth 对象，因此我使用我的库进行身份验证，并且仅将结果存储在 Auth 对象中，将 Zend-Auth 对象拉快一点而不是有再次重写我的代码。

该库位于[http://openidenabled.com/php-openid/](http://openidenabled.com/php-openid/)

感谢所有的帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-15T07:03:04.130

我正在处理类似的问题。我现在计划将[RPX](https://rpxnow.com/)与 Zend Framework 一起使用。也许我会写一个适配器。只是让你知道。

信息：“RPS now”为用户注册提供了一个多合一的界面和 UI

*   Facebook
*   谷歌
*   雅虎
*   我的空间ID
*   Windows LiveID
*   开放ID
*   醇

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-15T08:09:04.347

我很确定[Yahoo 仅适用于 OpenID 2.0](http://developer.yahoo.com/openid/)。如果您想支持 Yahoo 用户，您将不得不升级到支持 2.0 的库。这不仅仅是调整一些解析的问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-12T14:13:27.067

您是否查看了手册 - [Zend_OpenId_Consumer 基础知识](http://framework.zend.com/manual/en/zend.openid.consumer.html)？查看`38.2.2`该页面并让我知道这是否有帮助，因为它应该。

具体来说，我不知道 Google 是否提供 OpenID。我知道雅虎工作，因为我已经尝试过一段时间。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-02T16:33:56.173

谢谢你提供的详情。我从使用 JanRain 的库开始，但是在让 Simple Registration 工作时遇到了问题：我没有成功地以这种方式获取任何数据。并且没有关于使用属性交换的文档。:(

所以，我找到并尝试了 Zend/OpenId，但遇到了和你一样的问题：没有 Yahoo!、Google 和谁知道还有什么支持。读到这里，我似乎不得不回到 JanRain；在我的情况下，RPX 不是一个选项，因为它是第三方服务。

# c# - 在插入运行时查询数据：我们可以使用缓存吗？

> ID：741361
> 
> 赞同：0
> 
> 时间：2009-04-12T06:30:18.180
> 
> 标签：c#, database

我们正在构建一个应用程序，该应用程序需要每天在每个表中插入大约 150 万行数据。我们有 16 张桌子。我们跟踪 3 天的历史数据，包括当天的数据。

该应用程序是使用 C# 完成的；在服务器端，我们运行一个在市场时段（4.5 小时）填充数据表的 exe，我们每 5 秒更新 16 个表。

在客户端，应用程序获取需要最近插入的数据（在最后 5 秒内）和可能是今天或之前的历史点的用户查询，并以某种方式绘制它们。

我们遇到了一些严重的性能问题，因为一个查询可能需要 1 秒或更长时间，这太长了。问题是，对于在运行时插入的今天的数据，我们是否可以利用缓存而不是每次从今天的数据中获取某些内容时都去数据库？这样会更有效率吗？如果是这样，我们该怎么做？PS一天的数据大约300 MB，我们有足够的RAM

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-12T11:42:24.903

保留数据的副本以及用于检索数据的日期时间。下一次，只检索新数据，这样可以最大限度地减少通过网络发送的数据量。

如果操作中所有查询的运行时间为 1 秒，那么您看到的问题可能是 UI 冻结。如果是这种情况，请不要在 UI 线程上执行此操作。

**Upate（基于注释）：**您在控件的事件处理程序中运行的代码在 UI 线程中运行，这就是导致 UI 冻结的原因。没有一种方法可以在单独的线程中运行它，我建议在这种情况下[使用 BackGroundWorker](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx)。查看社区最后提供的示例。

# openid - OpenID 开发和调试工具

> ID：741363
> 
> 赞同：14
> 
> 时间：2009-04-12T06:33:09.890
> 
> 标签：openid

任何指向 OpenID 的开发（主要是调试工具）的指针？特别是，我正在寻找一种工具来记录和查看在间接通信身份验证会话期间通过用户代理的 OpenID 流量。提供有关身份验证尝试的调试信息的 OpenID 提供程序和依赖方也会很好。

是的，我已经问过 Google 先生，但没有找到正确的关键字，否则我不会在这里问。我可以自己构建这个，但如果其他人已经完成了这项工作......

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-13T02:52:41.673

DotNetOpenAuth 库同时执行 RP 和 OP，并具有用于诊断目的的非常详细的日志记录，可以调整到您感兴趣的任何日志。您可以使用它来针对您的 OpenID 站点进行测试，无论其平台是什么。

您可以通过登录[演示 RP](http://samples.dotnetopenauth.net/v3.4/OpenIdRelyingPartyWebForms/)然后访问它从您的登录累积的[日志页面来查看日志示例。](http://samples.dotnetopenauth.net/v3.4/OpenIdRelyingPartyWebForms/tracepage.aspx)

然后是等效的[演示 OP](http://samples.dotnetopenauth.net/v3.4/OpenIdProviderWebForms/)和相关的[日志页面](http://samples.dotnetopenauth.net/v3.4/OpenIdProviderWebForms/TracePage.aspx)。

如果您喜欢您所看到的，您可以自己使用这些站点来测试您的 OpenID 站点，或者您可以[下载 DotNetOpenAuth](http://www.dotnetopenauth.net/)并在本地使用它并进一步自定义日志。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T01:23:16.520

关于在哪里可以找到除 google 之外的信息的一些建议：[dmoz上有一些链接，](http://www.dmoz.org/Computers/Security/Authentication/Single_Sign-On/OpenID/) [freshmeat](http://freshmeat.net/search?q=openid&submit=Search)和[sourceforge](http://sourceforge.net/search/?type_of_search=soft&words=openid)上有几个 OpenID 相关项目。虽然你可能在那里找不到你想要的东西，但也许你可以直接询问各种 openid 服务器的一位或部分作者，或者在相应的邮件列表上发帖。我假设其中一些人已经完成了他们的调试工作，并且会提供一些提示。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-04-11T21:23:48.877

安德鲁的回答很好，但已经过时了——他的链接是 404 但是他的链接是很好的起点。

现在链接是[http://test-id.net/OP/AXFetch.aspx](http://test-id.net/OP/AXFetch.aspx)和该站点上的其余部分:-)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-15T08:00:14.553

我认为 FireFox 的[TamperData](http://tamperdata.mozdev.org/)扩展是我过去通过用户代理查看通信的。python-openid/contrib/ 中的脚本“openid-parse”将从 TamperData 日志中复制数据并将其解析为 OpenID 字段。

# php - 有什么更好的方法来编写这个函数。它获取一个远程文件并在本地复制它，在 php

> ID：741364
> 
> 赞同：0
> 
> 时间：2009-04-12T06:34:02.540
> 
> 标签：php, windows, linux, http, winapi

所以是的，我在 Windows 系统上工作，虽然这在本地工作，但知道它会在其他人的服务器上中断。什么是与此相同的跨平台方式

```
function fetch($get,$put){
    file_put_contents($put,file_get_contents($get));
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-12T06:53:18.717

除非另一台计算机在 PHP4 上，否则我不明白为什么会失败。**要使其向后**兼容，您需要做的是添加功能以提供 file_get_contents 和 file_put_contents 的替换：

```
if(version_compare(phpversion(),'5','<')) {
    function file_get_contents($file) {
        // mimick functionality here
    }    
    function file_put_contents($file,$data) {
        // mimick functionality here
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T12:35:49.720

这是使用简单文件操作的解决方案：

```
<?php
$file = "http://www.domain.com/thisisthefileiwant.zip";
$hostfile = fopen($file, 'r');
$fh = fopen("thisisthenameofthefileiwantafterdownloading.zip", 'w');

while (!feof($hostfile)) {
    $output = fread($hostfile, 8192);
    fwrite($fh, $output);
}

fclose($hostfile);
fclose($fh);
?> 
```

确保您的目录启用了写入权限。(CHMOD)

因此，您的 fetch($get, $put) 的替代品将是：

```
function fetch($get, $put) {    
    $hostfile = fopen($get, 'r');
    $fh = fopen($put, 'w');

    while (!feof($hostfile)) {
        $output = fread($hostfile, 8192);
        fwrite($fh, $output);
    }

    fclose($hostfile);
    fclose($fh);
} 
```

希望它有所帮助！=)

* * *

干杯，KrX

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T07:00:53.397

肖恩的回答是绝对正确的，唯一的事情是你需要确保你的 $put 变量是 Unix 服务器上的 Windows 服务器上的有效路径。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-12T07:20:21.257

好吧，当我阅读您的问题时，我知道您想将文件从远程服务器带到本地服务器，这可以通过 php 的 FTP 扩展来完成

[http://www.php.net/manual/en/function.ftp-fget.php](http://www.php.net/manual/en/function.ftp-fget.php)

如果这不是您的意图，我相信肖恩说的是正确的

否则在评论中告诉我，我会帮助你更多

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-12T07:39:06.627

如果未启用 fopen 包装器，则 curl 扩展名可能是： http: [//php.net/curl](http://php.net/curl)

# objective-c - 用单个对象替换多个数组内容？

> ID：741367
> 
> 赞同：1
> 
> 时间：2009-04-12T06:37:19.770
> 
> 标签：objective-c, cocoa-touch, cocoa, nsmutablearray

我有一个`NSMutableArray`我想用`NSNull`对象替换的内容。

这就是我所做的：

```
NSMutableArray* nulls = [NSMutableArray array];

for (NSInteger i = 0; i < myIndexes.count; i++)
    [nulls addObject:[NSNull null]];

[stageMap replaceObjectsAtIndexes:myIndexes withObjects:nulls]; 
```

我怎样才能更有效地做到这一点？有没有办法枚举一个NSIndexSet，这样我就可以一一替换数组内容了？

*解决了*

建议的方法结果是 2 倍快（平均 0.000565s 与 0.001210s）：

```
if (myIndex.count > 0)
{
    NSInteger index = [myIndex firstIndex];

    for (NSInteger i = 0; i < myIndex.count; i++)
    {
        [stageMap replaceObjectAtIndex:index withObject:[NSNull null]];
        index = [myIndex indexGreaterThanIndex:index];
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-12T07:27:33.143

您可以使用`for`循环。从第一个索引开始，`indexGreaterThanIndex:`用于获取下一个索引，并在到达最后一个索引后停止。

不要忘记考虑空索引集。第一个和最后一个索引都将`NSNotFound`在这种情况下。最简单的方法是测试索引集的计数；如果为零，则不要循环。

此外，Jason Coco 谈到了剖析。在您的程序运行之前不要太担心效率，并且在您运行 Shark（或 Instruments，如果那是您的事情）并确切地发现什么是慢的之前不要去优化事情。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-07-03T21:07:53.293

我意识到这是一个非常古老的问题，但我在这里发布以防其他人发现您可以使用的这个问题：

```
 [indexes enumerateIndexesUsingBlock:^(NSUInteger idx, BOOL *stop) {
        NSLog(@"index: %d", idx);
        [objectArray replaceObjectAtIndex:idx 
                               withObject:newObject];
    }]; 
```

这更简洁。

# php - 在 PHP 中使用 ereg_replace？

> ID：741374
> 
> 赞同：-3
> 
> 时间：2009-04-12T06:45:38.237
> 
> 标签：php, regex

如何使用以下代码替换？

```
ereg_replace("%Data_Index\[.\]%", $this->resultGData[$key ][\\1], $var) 
```

我想将 [] 中的数字替换`%Data_Index`
为`$this->resultGData[$key ][\\1]`相同`%Data_Index`
以及如何`ex %Data_Index[1] = $this->resultGData[$key][1], $var);`

将数字替换`%Data_Index[...........]`为 相同的数字`[]`
`$this->resultGData[$key ][............]`

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-12T08:07:49.990

[改用修饰符](http://docs.php.net/manual/en/reference.pcre.pattern.modifiers.php)尝试该[`preg_replace()`功能](http://docs.php.net/preg_replace)：[`e`](http://docs.php.net/manual/en/reference.pcre.pattern.modifiers.php)

```
preg_replace('/%Data_Index\[(\d+)\]%/e', '$this->resultGData[$key][\1]', $var); 
```

请注意，此函数使用[Perl 兼容的正则表达式](http://docs.php.net/manual/en/pcre.pattern.php)而不是 POSIX 扩展的正则表达式。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2009-04-12T07:14:49.213

你的问题有点难以理解

替换你所问的最聪明的方法我相信使用循环

例如，如果你知道 $this->resultGData[$key ][] 上有 10 个元素，你可以简单地这样做，假设 %Data_Index[1] （你确定它不是 $Data_Index 吗？我假设) 你可以试试下面的

```
$total = count($this->resultGData[$key ]);  //we get the total of elements in that key

for($i=0;$i<$total;$i++)
{
  $Data_Index[$i] = $this->resultGData[$key][$i];
} 
```

现在，如果 $key 更改，您需要为每个 $key 执行此操作:)

继续练习你的英语，它在 IT 领域是一个非常有用的工具 :) （我也不是很擅长它 :P）

# wcf - 使用 WCF 传输文件

> ID：741378
> 
> 赞同：2
> 
> 时间：2009-04-12T06:54:29.417
> 
> 标签：wcf, file-transfer

我正在尝试编写一个允许 PC 和 Windows Mobile 下载某些文件的 WCF 服务。对于 PC，我使用 MTOM 将数据流式传输到客户端，但 Windows Mobile 似乎不支持 MTOM。如何实现单一服务来下载文件？文件大小从 100KB 到 10MB 不等。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-12T06:58:32.510

目前，DIME 仍然是可行的方法，因为 .NET CF 没有 MTOM 实现。

**另见**：

*   [一角缓冲上传](http://www.codeproject.com/KB/cpp/DimeBufferedUpload.aspx)
*   [WSE 3.0 不能在 Mobile 5.0 设备上与 Compact Framework 2.0 一起使用](http://realworldsa.dotnetdevelopersjournal.com/wse30compactframework20.htm)
*   [通过 Web 服务（WCF、MTOM、WCE？）上传和下载大文件 - Windows Mobile（紧凑型框架）](https://stackoverflow.com/questions/518796/upload-and-download-large-files-windows-mobile-compact-framework-via-web-serv)

# sql-server-2008 - 全文搜索远景

> ID：741382
> 
> 赞同：1
> 
> 时间：2009-04-12T07:01:33.377
> 
> 标签：sql-server-2008

如何在 windows vista 中启用 sql server 2008 express 的全文搜索？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-12T07:09:50.863

您是否安装了*支持*全文搜索的 SQL Server Express 版本？这是您选择要安装的版本时的选项之一。

从SQL Server 2008 Express with Advanced Services的[下载页面描述：](http://www.microsoft.com/express/sql/download/)

*   SQL Server 数据库引擎 - 创建、存储、更新和检索您的数据
*   SQL Server Management Studio Basic - 用于创建、编辑和管理数据库的可视化数据库管理工具
*   全文搜索 - 用于搜索文本密集型数据的强大、高速引擎
*   Reporting Services - 用于创建报告的集成报告创建和设计环境

所以如果你没有安装“高级服务”版本，我建议你现在就安装。我希望您可以从“标准”版本升级。

# javascript - 如何在 Rails 上安装和使用基于 javascript 的插件？

> ID：741385
> 
> 赞同：0
> 
> 时间：2009-04-12T07:09:11.970
> 
> 标签：javascript, ruby-on-rails, ruby, ruby-on-rails-plugins

我正在制作一个 Rails 应用程序，并且很难让 Redbox 插件正常工作。我很确定我正确安装了所有东西并且正在正确使用它。当我使用其中一种辅助方法时，它似乎可以正确生成 javascript。例如，当我输入：

```
<%= link_to_redbox 'hello', 'test' %> 
```

它生成：

```
<a href="#" onclick="RedBox.showInline('test'); return false;">hello</a> 
```

如果我想显示一个`display:none;`名为 test 的不可见 ( ) div，这似乎是正确的。

我对这个很困惑。我很确定它没有找到 js 或其他东西，但不明白为什么会这样。redbox.js 链接生成为：

```
<script src="/javascripts/redbox.js?1239506092" type="text/javascript"></script> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T08:50:55.690

检查 javascript 文件是否确实存在 - 它应该位于 public/javascripts/redbox.js （至少，它似乎是它期望的位置）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-10T05:18:54.313

CSS必须是内联的！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-05T17:12:11.940

试试 GitHub 的版本。当前的 sourceforge 版本非常老旧。 [http://github.com/craigambrose/redbox/tree/master](http://github.com/craigambrose/redbox/tree/master)

我正在使用这个。

东西已经开始搬到这里了。您可能会调查其他一些分叉。从 4 月份博客上的一些部分来看，听起来 Craig 可能会再次开始维护它，但奇怪的是，该博客还没有更新到指向 GitHub。

还有一个另外，请阅读补丁和其他内容的评论：

blog.craigambrose.com/articles/2006/09/22/redbox-release-2

博客评论是一个即兴的支持论坛。我在此处找到的表单补丁中应用了一个表单。

还有另一个博客在评论中有大量讨论。

另一件事 - 使用 Firebug 分析 html 并找到问题。

# unit-testing - 单元测试 Scala

> ID：741390
> 
> 赞同：55
> 
> 时间：2009-04-12T07:18:22.463
> 
> 标签：unit-testing, scala, tdd

我最近才开始学习 Scala 语言，并希望以[TDD](http://en.wikipedia.org/wiki/Test-driven_development)方式进行。您能否分享您对 Scala 的单元测试框架的经验以及它们的优缺点。

我正在使用 IntelliJ IDEA 进行 Scala 开发，因此能够在支持 IDE 的情况下运行测试会很好。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-04-12T09:40:28.097

你看过[ScalaTest](http://www.artima.com/scalatest/)吗？

我没有用过它，但它来自 Artima 的 Bill Venners 和 co，因此我怀疑它会完成这项工作。但是，它似乎没有集成 IDE。

[这个博客条目](http://www.theserverside.com/blogs/thread.tss?thread_id=48085)有点旧，但建议 TestNG 是测试 Scala 的最佳选择。TestNG 肯定会有 IDE 集成。

编辑：我刚刚意识到我在 2009 年写了这个答案，世界已经在前进（！）。我目前正在使用 ScalaTest，IDE 集成工作正常，我强烈推荐它。特别是[匹配器 DSL](http://www.scalatest.org/user_guide/using_matchers)工作得非常好

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-04-16T09:03:41.867

我是规范的作者。如果您是 Intellij 用户，我建议您将 org.specs.runner.ScalaTest 特征混入您的规范，并将其作为 ScalaTest 套件运行。

如果您对此有任何问题，或者有任何其他问题，请随时向[规范用户](http://groups.google.com/group/specs-users)邮件列表发送消息。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-12T18:54:31.543

您还可以查看[Specs](http://code.google.com/p/specs/ "眼镜")，它相当完整，IIRC 被大量用作 Lift 的一部分。

# c# - 责任链设计模式给出错误：并非所有代码路径都返回值

> ID：741391
> 
> 赞同：0
> 
> 时间：2009-04-12T07:19:33.850
> 
> 标签：c#

这段代码给了我错误：“ConcreteHandler1：Handler”等。错误：“并非所有代码路径都返回值”函数错误？

```
 public abstract class Handler
    {
         protected Handler BirSonrakiAdim;
        public void NextStep(Handler BirSonrakiAdim)
        {
            this.BirSonrakiAdim = BirSonrakiAdim;
        }
        public abstract ReturnFaiz HandleRequest(int mevduat);
    }

public class ConcreteHandler1 : Handler
    {
        public override ReturnFaiz HandleRequest(int mevduat)
        {

            if (mevduat > 0 && mevduat < 1000)
            {
                return ReturnFaiz.faiztype1;
            }
            else if (BirSonrakiAdim != null)
            {
                BirSonrakiAdim.HandleRequest(mevduat);
            }
            else
                return ReturnFaiz.faiztype1;

        }
    }

   public class ConcreteHandler2 : Handler
    {
        public override ReturnFaiz HandleRequest(int mevduat)
        {

            if (mevduat > 1000 && mevduat < 3000)
            {
              return ReturnFaiz.faiztype2;
            }
            else if (BirSonrakiAdim != null)
            {
                BirSonrakiAdim.HandleRequest(mevduat);
            }
            else
                return ReturnFaiz.faiztype1;
          }
    }

 public class ConcreteHandler3 : Handler
    {
        public override ReturnFaiz HandleRequest(int mevduat)
        {
            if(mevduat>3000)
            {
                return ReturnFaiz.faiztype3;
            }
            else if(BirSonrakiAdim!=null)
            {
                BirSonrakiAdim.HandleRequest(mevduat);
            }
            else
                return ReturnFaiz.faiztype1;
         }
    }

public enum ReturnFaiz
    {
        faiztype1=20,
        faiztype2=30,
        faiztype3=40
    }

   public partial class _Default : System.Web.UI.Page
    {
        protected void Page_Load(object sender, EventArgs e)
        {
            if (!IsPostBack)
            {
                ;
            }
        }

        protected void BtnHesapla_Click(object sender, EventArgs e)
        {
            Handler h1 = new ConcreteHandler1();
            Handler h2 = new ConcreteHandler2();
            Handler h3 = new ConcreteHandler3();

            h1.NextStep(h2);
            h2.NextStep(h3);

            Label1.Text= h1.HandleRequest(Convert.ToInt32(TextBox1.Text)).ToString();
        }
    } 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-12T07:22:23.967

在 public override ReturnFaiz HandleRequest(int mevduat) 的 elseif 语句中，您没有返回任何内容......所以应该是：

```
 if (mevduat > 0 && mevduat  1000 && mevduat 3000)
    {
        return ReturnFaiz.faiztype3;
    }
    else if(BirSonrakiAdim!=null)
    {
        return BirSonrakiAdim.HandleRequest(mevduat);
    }
    else
        return ReturnFaiz.faiztype1; 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-04-12T15:20:24.647

你说你的方法返回一个`ReturnFaiz`枚举，但是在`else if`子句中你什么都不返回，因为在它通过`else if`确实返回的代码之后，就再也没有访问过。这是无效的，因为您的方法声称您确实返回了某些东西，而这是编译器希望您遵守的承诺。

您可以做的是声明一个`ReturnFaiz`名为 Empty 的名称（我建议为 faiztype1 等组成更易读的名称）并且值为 -1。然后你在每个方法的底部将它作为一种默认返回值返回：如果方法在到达该值时还没有返回，它将返回`ReturnFaiz.Empty`。

所以：

```
public enum ReturnFaiz
{
    Empty = -1,
    faiztype1=20,
    faiztype2=30,
    faiztype3=40
}

public class ConcreteHandler2 : Handler
{
    public override ReturnFaiz HandleRequest(int mevduat)
    {

        if (mevduat > 1000 && mevduat < 3000)
        {
          return ReturnFaiz.faiztype2;
        }
        else if (BirSonrakiAdim != null)
        {
            BirSonrakiAdim.HandleRequest(mevduat);
        }
        else
            return ReturnFaiz.faiztype1;

        return ReturnFaiz.Empty; // default return value if nothing else applies.
    }
} 
```

# c - 夹板如何知道我的函数没有在另一个文件中使用？

> ID：741400
> 
> 赞同：0
> 
> 时间：2009-04-12T07:29:09.693
> 
> 标签：c, splint

夹板给了我以下警告：

```
encrypt.c:4:8: Function exported but not used outside encrypt: flip
  A declaration is exported, but not used outside this module. Declaration can
  use static qualifier. (Use -exportlocal to inhibit warning)
   encrypt.c:10:1: Definition of flip 
```

既然我只在这个文件上调用了夹板，它怎么知道呢？

```
#include        <stdio.h>
#include        <stdlib.h>

int    flip( int a)
{
        int b;
        b = a;
        b ^= 0x000C;
        return b;
}

int     blah(int argc, char    *argv[]) {

        FILE    *fp = NULL, *fpOut=NULL;
        int             ch;
        ch = 20; flip(20); return (ERROR_SUCCESS);
} 
```

我什至摆脱了 main ，以至于它无法确定该文件以任何方式完成。我完全被难住了！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T17:47:34.153

您可能会发现，如果您包含一个声明的标题`flip()`- 当然，您应该这样做 - 那么`splint`就不会抱怨。您还应该`blah()`在标题中声明。

我不完全相信这是解释，因为`blah()`根本没有使用（尽管它使用`flip()`），而且您没有提到对此`splint`的抱怨。

但是，最好先创建每个函数（在 C 中）`static`，直到您可以证明在其源文件之外需要它，然后确保有一个声明函数的标头，并且该标头在文件中使用它定义了函数以及使用该函数的每个文件。

在 C++ 中，“每个函数都应该是`static`”的建议变成了“每个函数都应该在匿名命名空间中定义”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T09:28:14.883

> 既然我只在这个文件上调用了夹板，它怎么知道呢？

你已经回答了你的问题。您已经将一个文件输入到 lint，因此 lint*知道*只有一个文件需要处理（当然，标准头文件除外）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-12T10:00:26.677

int flip() 未声明为静态的，因此它可以潜在地在外部使用。由于您仅使用一个源文件调用了夹板，因此它正确地说明了您的函数，如果未在外部使用，则必须声明为静态

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-12T07:35:59.550

它只能报告它所看到的。如果您比它所说的更清楚，请忽略警告或按照说明禁止它。不要假设像这样的工具一定比你更了解你的程序。

如果它确实不打算在文件之外使用，您可以将其声明为静态的，它应该可以解决问题，但其他文件将无法访问它。

# php - 在 PHP 中访问 javascript 函数值？

> ID：741401
> 
> 赞同：1
> 
> 时间：2009-04-12T07:29:32.827
> 
> 标签：php, javascript

我可以从函数外部访问 javascript 函数的值吗，就像我有一个函数一样

```
<script>
function test_tree(opt)
{
    val = opt;
}
</script> 
```

我可以`val`从函数外部访问该值，`test_tree`还是有办法从 PHP 代码访问它？

我需要能够从 PHP 代码中的 javascript 代码中访问一个值。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-12T07:37:35.553

考虑到您没有使用`var`来声明变量，它对全局范围内的每个函数和所有代码都可用，因为没有`var`变量是在全局范围内创建的。

不过，回答您的问题，如果您希望在函数内部创建的变量在函数生命周期之外存在，请使用闭包。您可以将变量提供给函数外部可访问的某个对象，该函数负责存储这些值。

如果您希望 PHP 后端可以访问该变量（在 JavaScript 中创建，因此我假设在客户端），您必须向您的服务器发送请求。如果此执行不是提交表单的一部分，则可能是 ajax 调用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T07:33:31.663

将值设置为隐藏字段，并在服务器端代码中读取隐藏字段。

```
<input type="hidden" id="myVariable"> 
```

在您的功能中：

```
document.getElementById('myVariable').value = val; 
```

# java - Oracle 应用程序开发入门

> ID：741402
> 
> 赞同：2
> 
> 时间：2009-04-12T07:29:36.773
> 
> 标签：java, oracle

我不确定我是不是有点太深入了，但我决定我想学习如何开发使用 Oracle 技术堆栈构建的应用程序。

我不是编程背景（我一直从事商业方面的工作），但我喜欢无论你遇到什么问题，你几乎总是可以用某种描述的程序来解决它（我知道“程序”可能是那里的词错了，但希望你知道我的意思）。

所以我的问题：

1.  鉴于我没有编程经验，我应该尝试从其他东西开始吗？
2.  如果 Oracle 是一个好的开始，从我可以确定的情况来看，我还需要对 Java 有一个公平的掌握。我应该从哪里开始？

我不一定要寻找最快的方法，但我确实想确保无论我做什么都能让我对正在发生的事情有一个很好的了解。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-12T07:38:05.537

如果你没有任何面向对象的编程背景，我建议你应该从熟悉基本的 OO 概念开始。我推荐阅读本书“Head First Java” [http://www.amazon.com/Head-First-Java-Kathy-Sierra/dp/0596009208](https://rads.stackoverflow.com/amzn/click/com/0596009208)和官方的 java 教程 - [http://java.sun.com/docs /books/tutorial/reallybigindex.html](http://java.sun.com/docs/books/tutorial/reallybigindex.html)

在您了解面向对象编程和 java 的想法和基本概念之后。您可以自行使用任何技术，包括 Oracle 技术栈和其他 OO 语言，例如 python 和 C#。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T00:35:29.147

正如 natch3z 所提到的，如果您没有编程背景，那么从比 oracle 技术堆栈简单一点的开始可能是值得的。

通过 Oracle 技术堆栈，我假设在 Oracle 的 JDeveloper IDE 中使用 oc4j、ADF、oracle DB 等。尽管像这样的技术可以很强大并且可以实现你想要的，但对于初学者来说可能有点不知所措。

从 Eclipse IDE 之类的东西开始，然后通过一些简单的教程来学习可能会更有利一些。没有什么比从困难的事情开始并因不知所措而气馁更糟糕的了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-14T08:44:42.507

为什么是 Java ？更具体地说，您打算开发什么样的东西？

对于 Web 应用程序，您可以查看 PHP。Oracle 在数据库中还有一个 Web 开发/运行时环境，称为[Application Express](http://www.oracle.com/technology/products/database/application_express/html/what_is_apex.html)。这是开始开发面向数据的 Web 应用程序的一种非常简单的方法。[它们都是免费XE](http://www.oracle.com/technology/products/database/xe/index.html)版本的单一安装的一部分。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-29T15:17:08.667

对于 Oracle 问题，您可以尝试在由 Simple Talk Publishing 维护的新的专用 Oracle 堆栈交换站点[http://www.oracleoverflow.com/上发帖。](http://www.oracleoverflow.com/)

# asp.net-mvc - 使用 Html.BeginForm 时如何使用锚标签提交？

> ID：741408
> 
> 赞同：3
> 
> 时间：2009-04-12T07:37:29.547
> 
> 标签：asp.net-mvc

使用时如何使用锚标签提交`Html.BeginForm`？该`BeginForm`方法没有办法给出它看起来的表单名称，所​​以我可以这样做

```
<a href="JAVASCRIPT:Form1.submit()">Next</a> 
```

这失败了，因为不`Form1`存在。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-30T10:59:44.153

如果您使用 jQuery，请使用

```
<a href="javascript:$('form').submit();">Submit</a> 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-13T10:36:42.837

这是使用 htmlAttributes 对象添加“名称”属性的方式

```
<% using (Html.BeginForm("Action", "Controller", FormMethod.Post, new { name = "MyFormName" })) 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-12T07:49:25.807

如果页面上只有一个表单，则以下代码应该可以工作：

```
<a href="javascript:document.getElementsByTagName('form').item(0).submit()">Next</a>
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-07-23T09:51:31.413

`onclick`使用and 的替代 jQuery 解决方案`.closest('form')`：

```
<a href="#" onclick="$(this).closest('form').submit(); return false;">My link</a> 
```

# asp.net-mvc - 通过 WCF 服务实现寻呼机

> ID：741413
> 
> 赞同：12
> 
> 时间：2009-04-12T07:40:12.787
> 
> 标签：asp.net-mvc, wcf, web-services

我正在开发一个包含 WCF 服务及其 ASP.NET MVC 客户端的应用程序。ASP.NET MVC 网站必须显示一个对象网格——比如产品。这些产品存储在可通过 WCF 服务访问的数据库中。因此，在 MVC 控制器的某个地方，我调用 WCF 服务的方法，该方法返回我需要显示的产品数组。

那么我的问题是什么？我想为我的产品网格实现寻呼机功能，因为可能会有很多产品。所以有几种方法可以做到这一点：

1.  我的控制器可以获取整个产品列表并进行内存分页
2.  WCF 可以选择所有产品并将它们存储在其缓存中的某个位置，然后根据请求的页码仅将其中的一部分传递给控制器​​。
3.  WCF 只能根据请求的页码从数据库中选择部分产品。
4.  WCF可以将IQueryable返回给控制器，然后控制器会随时选择他想要的任何东西。

据我了解（如果不正确，请纠正我），第一个选项是无用的，所以我必须在其他选项之间进行选择。

第二个选项浪费了我服务器的内存。

第三个选项还可以，但是在WCF端实现分页似乎有点难看。

第四个选项听起来令人困惑。我实际上将某种查询传递给客户端，然后他自己通过 WCF 服务查询我的数据库。我不知道如何正确实现这一点。

那么你能帮我选择正确的方法来实现它吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-12T13:53:03.297

您的后端数据库层是什么样的？如果您使用 LINQ（-to-SQL 或 -to-Entities），则可以通过指定页面大小和所需页码来通过 WCF 实现分页，然后使用 LINQ 的“Skip”和“Take”运算符来获取请求的页面 - 大致类似于：

```
[ServiceContract]
public interface IFetchData
{
  [OperationContract]
  public List<Data> GetData(int pageSize, int pageNumber)
} 
```

然后像这样实现它（简化）：

```
public class FetchDataService : IFetchData
{
  public List<Data> GetData(int pageSize, int pageNumber)
  {
      var query = yourContext.DataTable
                    .Skip((pageNumber - 1) * pageSize)
                    .Take(pageSize);

      return query.ToList();
  }
} 
```

这对你有帮助吗？？

马克

# sql-server - 插入更新触发器如何确定是插入还是更新

> ID：741414
> 
> 赞同：185
> 
> 时间：2009-04-12T07:42:31.487
> 
> 标签：sql-server, tsql, triggers

我需要在表 A 上编写一个插入更新触发器，它将删除表 B 中的所有行，其中一列（比如 Desc）的值类似于表 A 的列（比如 Col1）中插入/更新的值。我将如何编写它以便我可以处理更新和插入情况。我将如何确定是否为更新或插入执行触发器。

* * *

## 回答 #1

> 赞同：185
> 
> 时间：2009-04-12T08:03:23.977

触发器有特殊`INSERTED`的`DELETED`表格来跟踪“之前”和“之后”的数据。所以你可以使用类似的东西`IF EXISTS (SELECT * FROM DELETED)`来检测更新。更新时只有行`DELETED`，但`INSERTED`.

[在CREATE TRIGGER](https://docs.microsoft.com/en-us/sql/t-sql/statements/create-trigger-transact-sql)中寻找“插入” 。

编辑，2011 年 11 月 23 日

评论后，此答案仅适用于`INSERTED`和`UPDATED`触发。
显然，DELETE 触发器不能`INSERTED`像我上面所说的那样有“总是行”

* * *

## 回答 #2

> 赞同：141
> 
> 时间：2011-09-15T11:53:57.890

```
CREATE TRIGGER dbo.TableName_IUD
ON dbo.TableName
AFTER INSERT, UPDATE, DELETE
AS 
BEGIN
    SET NOCOUNT ON;

    --
    -- Check if this is an INSERT, UPDATE or DELETE Action.
    -- 
    DECLARE @action as char(1);

    SET @action = 'I'; -- Set Action to Insert by default.
    IF EXISTS(SELECT * FROM DELETED)
    BEGIN
        SET @action = 
            CASE
                WHEN EXISTS(SELECT * FROM INSERTED) THEN 'U' -- Set Action to Updated.
                ELSE 'D' -- Set Action to Deleted.       
            END
    END
    ELSE 
        IF NOT EXISTS(SELECT * FROM INSERTED) RETURN; -- Nothing updated or inserted.

    ...

    END 
```

* * *

## 回答 #3

> 赞同：98
> 
> 时间：2012-06-07T08:18:34.960

如果您运行不删除任何内容的删除语句，其中许多建议都不会考虑在内。
假设您尝试删除 ID 等于表中不存在的某个值的位置。
您的触发器仍会被调用，但 Deleted 或 Inserted 表中没有任何内容。

使用它是安全的：

```
--Determine if this is an INSERT,UPDATE, or DELETE Action or a "failed delete".
DECLARE @Action as char(1);
    SET @Action = (CASE WHEN EXISTS(SELECT * FROM INSERTED)
                         AND EXISTS(SELECT * FROM DELETED)
                        THEN 'U'  -- Set Action to Updated.
                        WHEN EXISTS(SELECT * FROM INSERTED)
                        THEN 'I'  -- Set Action to Insert.
                        WHEN EXISTS(SELECT * FROM DELETED)
                        THEN 'D'  -- Set Action to Deleted.
                        ELSE NULL -- Skip. It may have been a "failed delete".   
                    END) 
```

特别感谢@KenDog 和@Net_Prog 的回答。
我从他们的脚本中构建了这个。

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2015-01-06T08:41:25.500

我正在使用以下内容，它还正确检测到什么都不删除的删除语句：

```
CREATE TRIGGER dbo.TR_TableName_TriggerName
    ON dbo.TableName
    AFTER INSERT, UPDATE, DELETE
AS
BEGIN
    SET NOCOUNT ON;

    IF NOT EXISTS(SELECT * FROM INSERTED)
        -- DELETE
        PRINT 'DELETE';
    ELSE
    BEGIN
        IF NOT EXISTS(SELECT * FROM DELETED)
            -- INSERT
            PRINT 'INSERT';
        ELSE
            -- UPDATE
            PRINT 'UPDATE';
    END
END; 
```

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2017-05-08T06:32:17.303

```
Declare @Type varchar(50)='';
IF EXISTS (SELECT * FROM inserted) and  EXISTS (SELECT * FROM deleted)
BEGIN
    SELECT @Type = 'UPDATE'
END
ELSE IF EXISTS(SELECT * FROM inserted)
BEGIN
    SELECT @Type = 'INSERT'
END
ElSE IF EXISTS(SELECT * FROM deleted)
BEGIN
    SELECT @Type = 'DELETE'
END 
```

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2016-07-28T12:17:58.243

我相信嵌套 ifs 有点令人困惑，并且：

> 扁平胜于嵌套【Python之禅】

;)

```
DROP TRIGGER IF EXISTS AFTER_MYTABLE

GO

CREATE TRIGGER dbo.AFTER_MYTABLE ON dbo.MYTABLE AFTER INSERT, UPDATE, DELETE 

AS BEGIN 

    --- FILL THE BEGIN/END SECTION FOR YOUR NEEDS.

    SET NOCOUNT ON;

    IF EXISTS(SELECT * FROM INSERTED)  AND EXISTS(SELECT * FROM DELETED) 
        BEGIN PRINT 'UPDATE' END 
    ELSE IF EXISTS(SELECT * FROM INSERTED)  AND NOT EXISTS(SELECT * FROM DELETED) 
        BEGIN PRINT 'INSERT' END 
    ELSE IF    EXISTS(SELECT * FROM DELETED) AND NOT EXISTS(SELECT * FROM INSERTED)
        BEGIN PRINT 'DELETED' END
    ELSE BEGIN PRINT 'NOTHING CHANGED'; RETURN; END  -- NOTHING

END 
```

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2011-04-12T15:31:07.567

经过大量搜索后，我找不到处理所有 (3) 三个触发器操作 INSERT、UPDATE 和 DELETE 条件的单个 SQL Server 触发器的确切示例。我终于找到了一行文字，它谈到了当 DELETE 或 UPDATE 发生时，常见的 DELETED 表将包含这两个操作的记录。然后，基于该信息，我创建了一个小的 Action 例程来确定触发器被激活的原因。当在 INSERT 与 UPDATE 触发器上同时存在通用配置和特定操作时，有时需要这种类型的接口。在这些情况下，为 UPDATE 和 INSERT 创建单独的触发器将成为维护问题。（即两个触发器是否都为必要的通用数据算法修复而正确更新？）

为此，我想提供以下多触发事件代码片段，用于在 Microsoft SQL Server 的一个触发器中处理 INSERT、UPDATE、DELETE。

```
CREATE TRIGGER [dbo].[INSUPDDEL_MyDataTable]
ON [dbo].[MyDataTable] FOR INSERT, UPDATE, DELETE
AS 

-- SET NOCOUNT ON added to prevent extra result sets from
-- interfering with caller queries SELECT statements.
-- If an update/insert/delete occurs on the main table, the number of records affected
-- should only be based on that table and not what records the triggers may/may not
-- select.
SET NOCOUNT ON;

--
-- Variables Needed for this Trigger
-- 
DECLARE @PACKLIST_ID varchar(15)
DECLARE @LINE_NO smallint
DECLARE @SHIPPED_QTY decimal(14,4)
DECLARE @CUST_ORDER_ID varchar(15)
--
-- Determine if this is an INSERT,UPDATE, or DELETE Action
-- 
DECLARE @Action as char(1)
DECLARE @Count as int
SET @Action = 'I' -- Set Action to 'I'nsert by default.
SELECT @Count = COUNT(*) FROM DELETED
if @Count > 0
    BEGIN
        SET @Action = 'D' -- Set Action to 'D'eleted.
        SELECT @Count = COUNT(*) FROM INSERTED
        IF @Count > 0
            SET @Action = 'U' -- Set Action to 'U'pdated.
    END

if @Action = 'D'
    -- This is a DELETE Record Action
    --
    BEGIN
        SELECT @PACKLIST_ID =[PACKLIST_ID]
                    ,@LINE_NO = [LINE_NO]
        FROM DELETED

        DELETE [dbo].[MyDataTable]
        WHERE [PACKLIST_ID]=@PACKLIST_ID AND [LINE_NO]=@LINE_NO
    END
 Else
    BEGIN
            --
            -- Table INSERTED is common to both the INSERT, UPDATE trigger
            --
            SELECT @PACKLIST_ID =[PACKLIST_ID]
                ,@LINE_NO = [LINE_NO]
                ,@SHIPPED_QTY =[SHIPPED_QTY]
                ,@CUST_ORDER_ID = [CUST_ORDER_ID]
            FROM INSERTED 

         if @Action = 'I'
            -- This is an Insert Record Action
            --
            BEGIN
                INSERT INTO [MyChildTable]
                    (([PACKLIST_ID]
                    ,[LINE_NO]
                    ,[STATUS]
                VALUES
                    (@PACKLIST_ID
                    ,@LINE_NO
                    ,'New Record'
                    )
            END
        else
            -- This is an Update Record Action
            --
            BEGIN
                UPDATE [MyChildTable]
                    SET [PACKLIST_ID] = @PACKLIST_ID
                          ,[LINE_NO] = @LINE_NO
                          ,[STATUS]='Update Record'
                WHERE [PACKLIST_ID]=@PACKLIST_ID AND [LINE_NO]=@LINE_NO
            END
    END 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2018-03-02T19:24:51.163

虽然我也喜欢@Alex 发布的答案，但我在上面的@Graham 解决方案中提供了这种变体

这专门使用 INSERTED 和 UPDATED 表中的记录存在，而不是使用 COLUMNS_UPDATED 进行第一次测试。它还为偏执的程序员提供了解脱，因为他们知道最后一个案例已经被考虑...

```
declare @action varchar(4)
    IF EXISTS (SELECT * FROM INSERTED)
        BEGIN
            IF EXISTS (SELECT * FROM DELETED) 
                SET @action = 'U'  -- update
            ELSE
                SET @action = 'I'  --insert
        END
    ELSE IF EXISTS (SELECT * FROM DELETED)
        SET @action = 'D'  -- delete
    else 
        set @action = 'noop' --no records affected
--print @action 
```

您将获得 NOOP 并带有如下语句：

```
update tbl1 set col1='cat' where 1=2 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2020-06-25T00:17:03.543

```
DECLARE @ActionType CHAR(6);
SELECT  @ActionType = COALESCE(CASE WHEN EXISTS(SELECT * FROM INSERTED)
                                     AND EXISTS(SELECT * FROM DELETED)  THEN 'UPDATE' END,
                               CASE WHEN EXISTS(SELECT * FROM DELETED)  THEN 'DELETE' END,
                               CASE WHEN EXISTS(SELECT * FROM INSERTED) THEN 'INSERT' END);
PRINT   @ActionType; 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2016-08-10T17:08:26.793

试试这个..

```
ALTER TRIGGER ImportacionesGS ON dbo.Compra 
    AFTER INSERT, UPDATE, DELETE
AS
BEGIN
  -- idCompra is PK
  DECLARE @vIdCompra_Ins INT,@vIdCompra_Del INT
  SELECT @vIdCompra_Ins=Inserted.idCompra FROM Inserted
  SELECT @vIdCompra_Del=Deleted.idCompra FROM Deleted
  IF (@vIdCompra_Ins IS NOT NULL AND @vIdCompra_Del IS NULL)  
  Begin
     -- Todo Insert
  End
  IF (@vIdCompra_Ins IS NOT NULL AND @vIdCompra_Del IS NOT NULL)
  Begin
     -- Todo Update
  End
  IF (@vIdCompra_Ins IS NULL AND @vIdCompra_Del IS NOT NULL)
  Begin
     -- Todo Delete
  End
END 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2012-03-21T11:50:38.227

这可能是一种更快的方法：

```
DECLARE @action char(1)

IF COLUMNS_UPDATED() > 0 -- insert or update
BEGIN
    IF EXISTS (SELECT * FROM DELETED) -- update
        SET @action = 'U'
    ELSE
        SET @action = 'I'
    END
ELSE -- delete
    SET @action = 'D' 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2012-04-25T11:06:33.323

我在 Grahams 中发现了一个小错误，否则很酷的解决方案：

它应该是 IF COLUMNS_UPDATED() **<** > 0 -- 插入或更新
而不是 > 0 可能是因为最高位被解释为有符号整数符号位...（？）。所以总的来说：

```
DECLARE @action CHAR(8)  
IF COLUMNS_UPDATED() <> 0 -- delete or update?
BEGIN     
  IF EXISTS (SELECT * FROM deleted) -- updated cols + old rows means action=update       
    SET @action = 'UPDATE'     
  ELSE
    SET @action = 'INSERT' -- updated columns and nothing deleted means action=insert
END 
ELSE -- delete     
BEGIN
  SET @action = 'DELETE'
END 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2012-04-03T19:28:24.667

所提供的两种解决方案的一个潜在问题是，根据它们的编写方式，更新查询可能会更新零记录，而插入查询可能会插入零记录。在这些情况下，Inserted 和 Deleted 记录集将为空。在许多情况下，如果 Inserted 和 Deleted 记录集都是空的，您可能只想退出触发器而不做任何事情。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2014-01-29T10:28:37.470

这对我有用：

```
declare @action_type int;
select @action_type = case
                       when i.id is not null and d.id is     null then 1 -- insert
                       when i.id is not null and d.id is not null then 2 -- update
                       when i.id is     null and d.id is not null then 3 -- delete
                     end
  from      inserted i
  full join deleted  d on d.id = i.id 
```

由于并非所有列都可以一次更新，因此您可以通过以下方式检查特定列是否正在更新：

```
IF UPDATE([column_name]) 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2014-09-08T20:44:19.423

```
declare @insCount int
declare @delCount int
declare @action char(1)

select @insCount = count(*) from INSERTED
select @delCount = count(*) from DELETED

    if(@insCount > 0 or @delCount > 0)--if something was actually affected, otherwise do nothing
    Begin
        if(@insCount = @delCount)
            set @action = 'U'--is update
        else if(@insCount > 0)
            set @action = 'I' --is insert
        else
            set @action = 'D' --is delete

        --do stuff here
    End 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2016-07-06T18:08:02.613

我喜欢“计算机科学优雅”的解决方案。我的解决方案在这里点击 [inserted] 和 [deleted] 伪表一次以获取它们的状态并将结果放入位映射变量中。然后，INSERT、UPDATE 和 DELETE 的每个可能组合都可以通过有效的二进制评估在整个触发器中轻松测试（不太可能的 INSERT 或 DELETE 组合除外）。

它确实假设如果没有修改任何行（这应该满足绝大多数情况），那么 DML 语句是什么并不重要。因此，虽然它不像 Roman Pekar 的解决方案那样完整，但它更有效。

使用这种方法，我们有可能为每个表创建一个“FOR INSERT、UPDATE、DELETE”触发器，这使我们能够 A) 完全控制动作顺序和 b) 每个适用于多动作的动作一个代码实现。（显然，每个实施模型都有其优点和缺点；您需要单独评估您的系统，以找出真正有效的方法。）

请注意，“存在（从«插入/删除»中选择*）”语句非常有效，因为没有磁盘访问（[https://social.msdn.microsoft.com/Forums/en-US/01744422-23fe-42f6 -9ab0-a255cdf2904a](https://social.msdn.microsoft.com/Forums/en-US/01744422-23fe-42f6-9ab0-a255cdf2904a)）。

```
use tempdb
;
create table dbo.TrigAction (asdf int)
;
GO
create trigger dbo.TrigActionTrig
on dbo.TrigAction
for INSERT, UPDATE, DELETE
as
declare @Action tinyint
;
-- Create bit map in @Action using bitwise OR "|"
set @Action = (-- 1: INSERT, 2: DELETE, 3: UPDATE, 0: No Rows Modified 
  (select case when exists (select * from inserted) then 1 else 0 end)
| (select case when exists (select * from deleted ) then 2 else 0 end))
;
-- 21 <- Binary bit values
-- 00 -> No Rows Modified
-- 01 -> INSERT -- INSERT and UPDATE have the 1 bit set
-- 11 -> UPDATE <
-- 10 -> DELETE -- DELETE and UPDATE have the 2 bit set

raiserror(N'@Action = %d', 10, 1, @Action) with nowait
;
if (@Action = 0) raiserror(N'No Data Modified.', 10, 1) with nowait
;
-- do things for INSERT only
if (@Action = 1) raiserror(N'Only for INSERT.', 10, 1) with nowait
;
-- do things for UPDATE only
if (@Action = 3) raiserror(N'Only for UPDATE.', 10, 1) with nowait
;
-- do things for DELETE only
if (@Action = 2) raiserror(N'Only for DELETE.', 10, 1) with nowait
;
-- do things for INSERT or UPDATE
if (@Action & 1 = 1) raiserror(N'For INSERT or UPDATE.', 10, 1) with nowait
;
-- do things for UPDATE or DELETE
if (@Action & 2 = 2) raiserror(N'For UPDATE or DELETE.', 10, 1) with nowait
;
-- do things for INSERT or DELETE (unlikely)
if (@Action in (1,2)) raiserror(N'For INSERT or DELETE.', 10, 1) with nowait
-- if already "return" on @Action = 0, then use @Action < 3 for INSERT or DELETE
;
GO

set nocount on;

raiserror(N'
INSERT 0...', 10, 1) with nowait;
insert dbo.TrigAction (asdf) select top 0 object_id from sys.objects;

raiserror(N'
INSERT 3...', 10, 1) with nowait;
insert dbo.TrigAction (asdf) select top 3 object_id from sys.objects;

raiserror(N'
UPDATE 0...', 10, 1) with nowait;
update t set asdf = asdf /1 from dbo.TrigAction t where asdf <> asdf;

raiserror(N'
UPDATE 3...', 10, 1) with nowait;
update t set asdf = asdf /1 from dbo.TrigAction t;

raiserror(N'
DELETE 0...', 10, 1) with nowait;
delete t from dbo.TrigAction t where asdf < 0;

raiserror(N'
DELETE 3...', 10, 1) with nowait;
delete t from dbo.TrigAction t;
GO

drop table dbo.TrigAction
;
GO 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2013-02-20T09:49:25.773

在第一种情况下，我认为您的表有 IDENTITY 列

```
CREATE TRIGGER [dbo].[insupddel_yourTable] ON [yourTable]
FOR INSERT, UPDATE, DELETE
AS
IF @@ROWCOUNT = 0 return
SET NOCOUNT ON;
DECLARE @action nvarchar(10)
SELECT @action = CASE WHEN COUNT(i.Id) > COUNT(d.Id) THEN 'inserted'
                      WHEN COUNT(i.Id) < COUNT(d.Id) THEN 'deleted' ELSE 'updated' END
FROM inserted i FULL JOIN deleted d ON i.Id = d.Id 
```

在第二种情况下不需要使用 IDENTITTY 列

```
CREATE TRIGGER [dbo].[insupddel_yourTable] ON [yourTable]
FOR INSERT, UPDATE, DELETE
AS
IF @@ROWCOUNT = 0 return
SET NOCOUNT ON;
DECLARE @action nvarchar(10),
        @insCount int = (SELECT COUNT(*) FROM inserted),
        @delCount int = (SELECT COUNT(*) FROM deleted)
SELECT @action = CASE WHEN @insCount > @delCount THEN 'inserted'
                      WHEN @insCount < @delCount THEN 'deleted' ELSE 'updated' END 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2013-03-13T07:28:53.277

**快速解决MySQL**

顺便说一句：我正在使用 MySQL PDO。

(1) 在自动增量表中，一旦每个脚本首先运行，就从增量列中获取最大值（我的列名 = id）：

```
$select = "
    SELECT  MAX(id) AS maxid
    FROM    [tablename]
    LIMIT   1
"; 
```

(2) 像往常一样运行 MySQL 查询，并将结果转换为整数，例如：

```
$iMaxId = (int) $result[0]->maxid; 
```

(3) 在“INSERT INTO ... ON DUPLICATE KEY UPDATE”查询之后，获取最后插入的 id 您喜欢的方式，例如：

```
$iLastInsertId = (int) $db->lastInsertId(); 
```

(4) 比较和反应：如果lastInsertId 高于表中的最高值，那很可能是INSERT，对吧？反之亦然。

```
if ($iLastInsertId > $iMaxObjektId) {
    // IT'S AN INSERT
}
else {
    // IT'S AN UPDATE
} 
```

我知道它很快而且可能很脏。这是一个旧帖子。但是，嘿，我一直在寻找解决方案，也许有人发现我的方法还是有用的。祝一切顺利！

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2014-02-07T03:20:50.360

只是简单的方法

```
CREATE TRIGGER [dbo].[WO_EXECUTION_TRIU_RECORD] ON [dbo].[WO_EXECUTION]
WITH EXECUTE AS CALLER
FOR INSERT, UPDATE
AS
BEGIN  

  select @vars = [column] from inserted 
  IF UPDATE([column]) BEGIN
    -- do update action base on @vars 
  END ELSE BEGIN
    -- do insert action base on @vars 
  END

END 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2014-08-13T08:37:26.617

```
DECLARE @INSERTEDCOUNT INT,
        @DELETEDCOUNT INT

SELECT @INSERTEDCOUNT = COUNT([YourColumnName]) FROM inserted

SELECT @DELETEDCOUNT = COUNT([YourColumnName]) FROM deleted 
```

如果它的更新

```
 @INSERTEDCOUNT = 1
 @DELETEDCOUNT = 1 
```

如果它的插入

```
 @INSERTEDCOUNT = 1
 @DELETEDCOUNT = 0 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2015-12-21T16:22:52.990

我已经使用这些查询很长时间了，但是对于空的 CRUD 操作（当和表`exists (select * from inserted/deleted)`中没有记录时）仍然不够。因此，在稍微研究了这个主题之后，我找到了更精确的解决方案：`inserted``deleted`

```
declare
    @columns_count int = ?? -- number of columns in the table,
    @columns_updated_count int = 0

-- this is kind of long way to get number of actually updated columns
-- from columns_updated() mask, it's better to create helper table
-- or at least function in the real system
with cte_columns as (
    select @columns_count as n
    union all
    select n - 1 from cte_columns where n > 1
), cte_bitmasks as (
    select
        n,
        (n - 1) / 8 + 1 as byte_number,
        power(2, (n - 1) % 8) as bit_mask
    from cte_columns
)
select
    @columns_updated_count = count(*)
from cte_bitmasks as c
where
    convert(varbinary(1), substring(@columns_updated_mask, c.byte_number, 1)) & c.bit_mask > 0

-- actual check
if exists (select * from inserted)
    if exists (select * from deleted)
        select @operation = 'U'
    else
        select @operation = 'I'
else if exists (select * from deleted)
    select @operation = 'D'
else if @columns_updated_count = @columns_count
    select @operation = 'I'
else if @columns_updated_count > 0
    select @operation = 'U'
else
    select @operation = 'D' 
```

也可以用来`columns_updated() & power(2, column_id - 1) > 0`查看列是否更新，但对于列数很大的表来说并不安全。我使用了一些复杂的计算方法（请参阅下面的有用文章）。

此外，这种方法仍然会错误地将某些更新分类为插入（如果表中的每一列都受到更新的影响），并且可能会将仅插入默认值的插入分类为删除，但这些是罕见操作之王（在在我的系统中租用它们）。除此之外，我目前不知道如何改进此解决方案。

*   [Piotr Rodak 审计触发器的 COLUMNS_UPDATED()](http://sqlblogcasts.com/blogs/piotr_rodak/archive/2010/04/28/columns-updated.aspx)
*   [Adam Machanic 处理非常大的位掩码](http://sqlblog.com/blogs/adam_machanic/archive/2006/07/12/dealing-with-very-large-bitmasks.aspx)

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2019-08-10T20:46:40.257

```
declare @result as smallint
declare @delete as smallint = 2
declare @insert as smallint = 4
declare @update as smallint = 6
SELECT @result = POWER(2*(SELECT count(*) from deleted),1) + POWER(2*(SELECT 
     count(*) from inserted),2)

if (@result & @update = @update) 
BEGIN
  print 'update'
  SET @result=0
END
if (@result & @delete = @delete)
  print 'delete'
if (@result & @insert = @insert)
  print 'insert' 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2020-06-22T12:00:03.440

我这样做：

```
select isnull((select top 1 1 from inserted t1),0) + isnull((select top 1 2 from deleted t1),0) 
```

1 -> 插入

2 -> 删除

3 -> 更新

```
set @i = isnull((select top 1 1 from inserted t1),0) + isnull((select top 1 2 from deleted t1),0)
--select @i

declare @action varchar(1) = case @i when 1 then 'I' when 2 then 'D' when 3 then 'U' end
--select @action

select @action c1,* from inserted t1 where @i in (1,3) union all
select @action c1,* from deleted t1 where @i in (2) 
```

# apache - 您如何简单地将新的自定义重写添加到 wordpress 的 .htaccess 中而不会失败？

> ID：741415
> 
> 赞同：3
> 
> 时间：2009-04-12T07:45:05.613
> 
> 标签：apache, wordpress, .htaccess, mod-rewrite

我为我的 wordpress 添加了一些额外的功能，以便我可以使用变量访问它并做额外的事情。

问题是，当我在 .htaccess 文件中将丑陋的动态链接转换为可爱的永久链接格式时，wordpress 会覆盖它/忽略它。我听说有一种方法可以做到这一点，但是我尝试根据人们所说的去做的方法仍然返回一个 404 页面。我知道它指向的文件有效。

人们说的两种方式有效，但我对以下内容并不满意：

1) 在#BEGIN wordpress 部分上方插入规则 2) 在某处使用 add_rewrite_rule() wordpress 函数

有人用这些方法成功了吗？还是其他方法？

这是我的 .htaccess 文件的样子

```
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteRule ^/ref/(.*)$ /index.php?ref=1&sid=$1 [NC]
</IfModule>

# BEGIN WordPress
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /

RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]

</IfModule> 
```

在我的主题 function.php 中，我还尝试添加：

```
add_rewrite_rule('/ref/(.*)$', 'index.php?ref=1&sid=$matches[1]','top'); 
```

没有成功。

我也没有高兴地尝试过@ [WordPress + mod_rewrite的解决方案。](https://stackoverflow.com/questions/723283/wordpress-modrewrite)

请帮忙！:)

有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-22T11:19:40.987

这行得通 - 我刚刚测试过 - 注意我在 RewriteRule 的末尾添加了一个 L

```
<IfModule mod_rewrite.c>
RewriteEngine On

RewriteRule ^/ref/(.*)$ /index.php?ref=1&sid=$1 [NC,L]

#wp
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]
</IfModule> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-12T07:52:27.390

新规则将永远覆盖旧规则

尝试以下

```
<IfModule mod_rewrite.c>
RewriteEngine On
#wp
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]

RewriteRule ^/ref/(.*)$ /index.php?ref=1&sid=$1 [NC]

</IfModule> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-12T07:57:58.843

在 .htaccess 文件中，您必须离开`RewriteRule`指令模式中的前导斜杠。所以试试这个：

```
RewriteRule ^ref/(.*)$ index.php?ref=1&sid=$1 [NC] 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-13T16:19:48.660

由于上述解决方案似乎不起作用，我最终在 php 中执行了以下操作。Wordpress 对 .htaccess 文件的统治是至高无上的：

```
if(strstr($_SERVER['REQUEST_URI'], '/ref/')) { 
```

从那以后，我们就可以做几乎相同的事情了。一个漂亮的网址，可以翻译成别的东西。

# .net - Visual Studio 2008 express 无法识别我的 Sql Server 2008 express

> ID：741417
> 
> 赞同：2
> 
> 时间：2009-04-12T07:49:37.973
> 
> 标签：.net, sql-server, visual-web-developer

我最近按顺序安装：

Sql Server 2008 速成版

视觉 Web 开发者速成 2008

当我右键单击 app_data 并尝试添加一个 db 时，它会返回： 与 SQL Server 文件 (*.mdf) 的连接需要 SQL Server Express 2005 才能正常运行。请验证组件的安装或从 URL 下载：http: [//go.microsoft.com/fwlink/ ?LinkId=49251](http://go.microsoft.com/fwlink/?LinkId=49251)

由于在安装sql server之前安装visual web developer的注册表问题，我最近刚刚重新安装了windows vista。这次相反的顺序似乎工作正常，直到我注意到这个问题。

我可以将 MDF 文件复制到 app_code 目录中，但这似乎不能解决我的问题，因为单击 DB 会返回相同的错误。

根据我从谷歌搜索中收集到的信息，这个错误来自几个不同的安装路径。它可能与 2005 年的安装无关（我没有安装任何 Visual Studio 或 sql server 2005s）。他们可能只是从未升级错误消息。有谁知道如何解决这个问题？我不介意输入一些连接字符串，如果这样可以解决问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-21T20:52:08.030

它是 64 位 Vista（或者更确切地说，是 64 位 SQL Express 安装）吗？[http://support.microsoft.com/default.aspx?scid=kb;en-us;957944&sd=rss&spid=12913](http://support.microsoft.com/default.aspx?scid=kb;en-us;957944&sd=rss&spid=12913)

使用 64 位 SQL Express 引擎进行 Visual Studio 2008 集成存在一个已知问题（如果您使用 Web 引导程序单独安装 SQL Express，它很容易在您不知情的情况下发生 - 至少在我的系统上它安装了 64 位版本而没有告诉我全部）。

上面的链接基本上告诉您卸载所有 SQL Express 实例，然后安装您选择的 x86 SQL Express，它将开始正常工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-17T16:22:40.107

我在 64 位 Windows 7（使用 64 位 SQL Server Express 2008）上也遇到了这个问题。

[Microsoft 支持知识库文章](http://support.microsoft.com/default.aspx?scid=kb;en-us;957944)中引用了两种解决此问题的方法：

**1\. 解决方法**

> 若要解决此问题，请卸载 64 位版本的 SQL Server Express 2008，然后安装 32 位版本的 SQL Server Express 2008。

如果您不想进行卸载/安装，请尝试下面的修补程序方法。

**2\. 修补程序**

> Microsoft 现已提供受支持的修补程序。但是，它仅用于更正本文描述的问题。仅将其应用于遇到此特定问题的系统。

虽然文章本身不包含修补程序的链接，但您可以在此处获取：http: [//support.microsoft.com/hotfix/KBHotfix.aspx ?kbnum=957944](http://support.microsoft.com/hotfix/KBHotfix.aspx?kbnum=957944)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T09:35:05.630

嗨，大卫，您是否确保 sql express 服务和 sql 浏览器服务都在运行？您可以通过管理工作室连接到同一个 sql server express 版本吗？如果不是，那么这些服务可能没有在您的盒子上运行

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T00:14:31.557

虽然我仍然收到 sql server 2005 错误，但它并没有阻止我做我需要做的事情。在“数据库连接”选项卡中，我可以在将 MDF 与 Management Studio 分离后连接到它。如果需要，我还可以使用此选项卡的功能来创建新的数据库文件。

# c# - 如何免费编写、编译和运行 C#（在 Windows 中）

> ID：741422
> 
> 赞同：9
> 
> 时间：2009-04-12T07:55:46.913
> 
> 标签：c#, deployment, ide

可以免费使用 C# 吗？你会使用哪些工具？

1.  为了好玩/学习：我很确定你可以，但仍然存在工具问题。
2.  对于您希望销售的程序？

我正在寻找的工具：

1.  IDE（尽可能完整：调试、重构、库、IntelliSense 等）——此外，如果它不包含在 IDE 中，编译器。
2.  单元测试，
3.  记录（与 JavaDoc 一样提取注释），
4.  部署。

也欢迎其他关于不错的免费工具的建议。

请注意，IMO、Visual Studio Express 不提供所有这些工具。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-12T09:11:52.877

IDE：

*   [Visual Studio 2017 社区](https://www.visualstudio.com/downloads/)。它具有专业版功能的一个子集，但都包含您提到的所有功能。您可能想要[比较 Visual Studio 2017 版本](https://www.visualstudio.com/vs/compare/)。高中生和大学生有资格获得[Dreamspark](http://www.dreamspark.com)的 VS Professional 的免费许可。

*   夏普发展

*   [单声道开发](http://monodevelop.com/)

独立编译器：

*   csc.exe、vbc.exe 和 msbuild.exe 是 .NET Framework 的一部分。Windows SDK 工具也是免费的。或者您可以使用[Mono 项目](http://mono-project.com/)中的编译器。

* * *

单元测试：

*   NUnit、mbUnit、xUnit 等等。

记录：（提取注释 JavaDoc 样式）

*   [GhostDoc](http://www.roland-weigelt.de/ghostdoc/) - 不适用于 Express 版

部署：

*   [克鲁斯](http://nant.sourceforge.net/)[控制](http://ccnet.thoughtworks.com/).NET

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-13T04:25:55.677

虽然 OP 说：

> Visual Studio Express 并没有像声称的那样提供所有这些工具！
> 
> > C# Express 没有提供您想要的什么？
> 
> 认真的部署，单元测试，记录

然而，IMO 您*可以*使用 Visual Studio Express 做到这一点。

### 部署

Visual Studio Express 中肯定缺少 Visual Studio 部署项目，但坦率地说，这并不是什么遗漏。整个功能是半生不熟的，足以在功能列表中打勾，对于玩具部署来说足够好，但可以说，并不能真正达到现实世界的严格要求。

[Windows Installer XML](http://wix.sourceforge.net/) (WiX) 是 Microsoft 用于创建安装程序的开源工具包。[据报道](http://www.tramontana.co.hu/wix/)，Microsoft Office 2007 的安装程序是使用 WiX 构建的，因此有理由相信它可以处理任何较小的情况。

另一个安装工具是[Nullsoft Scriptable Install System](http://nsis.sourceforge.net/Main_Page)，可能比 WiX 更容易理解，但也不能与 Windows 内置的 MSI 技术一起使用，因此在企业案例中更难管理。

### 单元测试

Microsoft 测试框架是[MSTest](http://en.wikipedia.org/wiki/MSTest)，虽然它可以胜任这项任务，但它并不是其中的佼佼者。事实上，如果你在谷歌上搜索对 MSTest 的反应，你会发现很多人认为它是对[NUnit](http://www.nunit.org/)的抄袭。

[曾经有一段时间，您可以使用Test Driven.Net](http://www.testdriven.net/)将任何测试工具集成到 Visual Studio Express 中，尽管这不再有效。

有效的是为您的单元测试工具使用外部运行程序——所有主要的单元测试框架都附带了它们*。*当我自己使用 VS Express 时，我倾向于让测试运行程序在后台徘徊；然后重新运行测试只涉及任务切换。

NUnit 是 .NET 测试框架的鼻祖，它运行良好。不过还有其他一些，例如[mbUnit](http://www.mbunit.com/)和[xUnit](http://www.codeplex.com/xunit)。

### 文档

没有任何版本的 Visual Studio 有好的文档故事。事实上，它们都有*相同的故事*- 一个编译器开关，用于根据文档注释生成 XML 文件。

要将这些 XML 文件转换为真正的文档，您需要其他工具。[NDoc](http://ndoc.sourceforge.net/)曾经是标准，但不幸的是，该项目现在已经死了（[非常悲伤的故事](http://weblogs.asp.net/bhouse/archive/2006/07/26/NDoc-2.0-_2D00_-R.I.P.aspx)）。[Sandcastle](http://blogs.msdn.com/sandcastle/)（另一个 Microsoft 开源项目）可能会成为新的黄金标准，但该工具还没有我们希望的那样成熟和易于使用。[DocU](http://blog.jagregory.com/2009/03/19/introducing-docu-simple-doc-gen-for-net/)是该领域的新版本，可能值得跟进。

### 结论

如您所见，即使使用 Visual Studio Express，也有一些很好的方法可以实现您想要的目标。事实上，升级到 Visual Studio 的付费版本只会获得两件事。

1.  如果需要，您将获得 MSTest。
2.  您将能够安装扩展程序/插件，例如 TestDriven.NET 和 Resharper。

对于刚入门的人，我认为价值主张不存在。从免费工具开始，当你有足够的经验花钱时花钱。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-13T04:34:58.200

1.  IDE（尽可能完整，调试、重构、库、智能感知等）
    => [Sharpdevelop (#develop)](http://sharpdevelop.net/)一个支持多种语言的 .Net 开源 IDE。
2.  如果不在 IDE 中，编译器
    => 如 Jozef 所述
3.  单元测试
    => Sharpdevelop，NUnit 集成在里面
4.  记录（提取注释，例如 cf javadoc）
    => Sharpdevelop、[SandCastle](http://www.codeplex.com/Sandcastle)和[SHFB](http://www.codeplex.com/SHFB)集成
5.  部署
    => Sharpdevelop，[WIX](http://wix.sourceforge.net/)集成。

[在SharpDevelop Features](http://sharpdevelop.net/OpenSource/SD/Features.aspx)查看 Shardevelop 的所有功能

它可以免费创建程序和销售。为了好玩，您可以在其中开发更多功能:)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-12T07:58:54.877

您可以下载 Visual Studio Express。它包括您所要求的一切。这是链接:)

祝你好运！

[http://www.microsoft.com/express/download/](http://www.microsoft.com/express/download/)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-12T08:02:17.677

1.  Visual C# 速成版
2.  Visual C# 速成版
3.  单位
4.  沙堡
5.  不知道，我让别人回答。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-12T08:00:00.633

[Visual Studio 2008 Express](http://www.microsoft.com/Express/)（或 Visual C# 2008 Express，如果您不想使用其他语言）是一个不错的选择。免费。

非微软，试试[SharpDevelop](http://www.icsharpcode.net/OpenSource/SD/)

编辑：如果您是学生，并且您的大学获得 MSDN AA 认证，您可以免费获得 Visual Studio 2008 Professional。是的，免费的。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-12T08:00:11.317

为您的 IDE 和编译器查看[Visual C# Express](http://www.microsoft.com/express/vcsharp/) ，为您的文档查看[NDoc ，为单元测试](http://ndoc.sourceforge.net)[查看 MbUnit](http://www.mbunit.com/)或[NUnit](http://www.nunit.org/index.php)，我相信 C# Express 也将处理部署。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-12T07:59:24.613

[http://www.microsoft.com/express/vcsharp/](http://www.microsoft.com/express/vcsharp/)

[https://www.dreamspark.com/Products/ProductList.aspx](https://www.dreamspark.com/Products/ProductList.aspx)（如果你是学生：）

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-12T09:29:26.830

另请查看用于部署的[WiX](http://wix.sourceforge.net/) - 这允许您创建 MSI 文件。

# c++ - 在 Qt 中为 QTableView 创建弹出菜单

> ID：741423
> 
> 赞同：7
> 
> 时间：2009-04-12T07:57:11.187
> 
> 标签：c++, qt, qtableview

我的`QTableView`程序的主 UI 中有一个。我想在用户右键单击表格的单元格时显示弹出菜单，并在从菜单中选择一个选项时采取适当的操作。

我正在使用 Qt Creator 1（Qt 版本 4.5）。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-04-12T08:10:19.530

查看[customContextMenuRequested](https://doc.qt.io/qt-5/qwidget.html#customContextMenuRequested)信号以获取事件，并为菜单本身使用[QMenu](https://doc.qt.io/qt-5/qmenu.html)。使用[QTableView::indexAt](https://doc.qt.io/qt-5/qtableview.html#indexAt)根据给定信号的坐标找出单击了哪些单元格（如果有），并在单击菜单项时采取适当的操作。

# javascript - document.ready 不是在每次加载时都执行

> ID：741424
> 
> 赞同：2
> 
> 时间：2009-04-12T07:57:19.423
> 
> 标签：javascript, jquery, apache

我有一个奇怪的问题。我有一个 jQuery document.ready 函数在页面上执行一些脚本。当我通过使用 firefox/opera 打开文件来测试它时，它起作用了。当我将它上传到服务器时（我尝试了我的家庭 apache 和我的共享主机），它可能只在 10 次加载中工作一次。

可能是什么问题呢？

预先感谢

**编辑：**

这是代码。它根据中央面板配置正确的侧面板尺寸。

```
 <script type="text/javascript">
         $(document).ready(function(){
            // Get natural heights
            var cHeight = $("#content").height();   
            var nHeight = $("#left").height() - $("#footer").height() - $("#header").height() - 10; 

            // Assign maximum height to all columns
            $("#leftcontent").height(nHeight);
            $("#rightcontent").height(nHeight);
            $("#left").height(cHeight);
            $("#right").height(cHeight);
         });            
    </script> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-12T08:21:53.683

首先检查您是否没有 JS 语法错误（萤火虫或只是错误控制台）。

如果没有，您是否考虑过在准备功能中放置一个简单的警报。如果仍然失败，您知道它与 JQuery 库本身有关（不太可能）。

如果您不断收到警报，您就会知道这是您自己的代码有问题。进一步的帮助将需要查看您的代码。

# jquery-ui - 如何将数据传递到 jquery UI 对话框模式窗口中的表单？

> ID：741441
> 
> 赞同：0
> 
> 时间：2009-04-12T08:07:38.447
> 
> 标签：jquery-ui, forms, modal-dialog

我正在尝试使用 jquery UI 对话框组件来显示表单；我成功地做到了。

但是，我不知道如何在对话框窗口中将数据检索到此表单。可能吗？jquery 网站上显示的示例仅显示静态消息。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-12T12:00:57.230

也许你可以告诉我们更多关于这个问题的信息。您想要显示哪些数据以及这些数据的格式（是表单数据、javascript 对象、dom 对象等？）

您谈到了通过对话框显示的表单。您想在哪里访问此表单数据（当对话框关闭、打开、提交表单时……）？

# visual-studio - Visual Studio 和 VS express 版有什么区别？

> ID：741447
> 
> 赞同：2
> 
> 时间：2009-04-12T08:10:37.970
> 
> 标签：visual-studio

Visual Studio 和 VS express 版有什么区别？

可能非常适合谷歌，但我再次读到 StackOverflow 中的报道是一件好事。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-12T08:15:48.537

您可以从 Microsoft[下载比较。](http://download.microsoft.com/download/5/9/0/590E8F3D-77B1-4C5A-9FA7-0C526409836F/VisualStudio2008_Comparative.xls)还有一个来自[这里](http://www.microsoft.com/downloads/details.aspx?displaylang=en&FamilyID=727bcfb0-b575-47ab-9fd8-4ee067bb3a37)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-02-06T10:59:09.053

Express 版不附带 Microsoft C++ 运行时可再发行包，它本身也不授予您分发它们的权限。因此，您使用 Express 版本构建的软件的用户必须自己下载并运行安装程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T08:33:41.083

我可能在 excel 表中错过了它，但一些大的缺少适当的源代码控制集成和 3rd 方工具集成。Express 版本也缺少单元测试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-10T04:46:06.470

我觉得缺乏对重构和高级调试的支持是一个主要问题。

# c++ - C++ 棘手的继承类定义问题

> ID：741452
> 
> 赞同：1
> 
> 时间：2009-04-12T08:15:45.307
> 
> 标签：c++, inheritance, forward-declaration

在处理包括彼此在内的多个类时出现此错误：

```
error: expected class-name before '{' token 
```

我知道发生了什么，但我不知道如何正确纠正它。这是代码的抽象版本：

*啊*

```
#ifndef A_H_
#define A_H_

#include "K.h"

class A
{
    public:
        A();

};

#endif /*A_H_*/ 
```

*A.cpp*

```
#include "A.h"

A::A() {} 
```

*溴化氢*

```
#ifndef B_H_
#define B_H_

#include "A.h"

class B : public A
{ // error: expected class-name before '{' token
    public:
        B();
};

#endif /*B_H_*/ 
```

*B.cpp*

```
#include "B.h"

B::B() : A() {} 
```

*Jh*

```
#ifndef J_H_
#define J_H_

#include "B.h"

class J
{
    public:
        J();
};

#endif /*J_H_*/ 
```

*J.cpp*

```
#include "J.h"

J::J() {} 
```

*克*

```
#ifndef K_H_
#define K_H_

#include "J.h"

class K : public J
{ // error: expected class-name before '{' token
    public:
        K();
};

#endif /*K_H_*/ 
```

*K.cpp*

```
#include "K.h"

K::K() : J() {} 
```

*主文件*

```
#include "A.h"

int main()
{
    return 0;
} 
```

* * *

从*main.cpp*开始，我可以确定这是编译器看到的：

```
#include "A.h"

#ifndef A_H_
#define A_H_

#include "K.h"

#ifndef K_H_
#define K_H_

#include "J.h"

#ifndef J_H_
#define J_H_

#include "B.h"

#ifndef B_H_
#define B_H_

#include "A.h"

class B : public A
{ // error: expected class-name before '{' token 
```

因此，当我们到达*B时，* *A*的定义并不完整。有人告诉我，有时您需要使用前向声明，然后将*#include*语句移动到*.cpp*文件中，但我对此没有任何运气。如果我尝试这样的事情，我只会得到额外的错误：

 ***```
error: forward declaration of 'struct ClassName' 
```

我想也许我只是没有在正确的地方做事。有人可以告诉我如何编译这段代码吗？非常感谢你！

* * *

编辑：我想指出这只是真实代码的抽象版本。我意识到在*A中没有对**K*或*J中的**B*的引用，但是在真实的代码中有，我觉得它们是完全必要的。也许如果我对真实类进行简要描述，有人可以帮助我重组或修复我的代码。

 ****A*类是一个抽象节点类，充当图中节点的接口。*B*类是*A*的许多不同实现之一。同理，*J*类是一个抽象的Visitor类，*K*是对应的实现。这是具有更多上下文的代码：

*啊*（抽象节点）

```
#ifndef A_H_
#define A_H_

#include "K.h"

class K;

class A
{
    public:
        A();

        virtual void accept(const K&) const = 0;
};

#endif /*A_H_*/ 
```

*A.cpp*

```
#include "A.h"

A::A() {} 
```

*Bh*（具体节点）

```
#ifndef B_H_
#define B_H_

#include "A.h"

class K;

class B : public A
{ // error: expected class-name before '{' token
    public:
        B();

        virtual void accept(const K&) const;
};

#endif /*B_H_*/ 
```

*B.cpp*

```
#include "B.h"

B::B() : A() {}

void B::accept(const K& k) const { k.visit(this); } 
```

*Jh*（抽象访问者）

```
#ifndef J_H_
#define J_H_

#include "B.h"

class B;

class J
{
    public:
        J();

        virtual void visit(const B*) const = 0;
};

#endif /*J_H_*/ 
```

*J.cpp*

```
#include "J.h"

J::J() {} 
```

*Kh*（具体访客）

```
#ifndef K_H_
#define K_H_

#include "J.h"

class B;

class K : public J
{ // error: expected class-name before '{' token
    public:
        K();

        virtual void visit(const B*) const;
};

#endif /*K_H_*/ 
```

*K.cpp*

```
#include "K.h"

K::K() : J() {}

void K::visit(const B*) const {}; 
```

*主文件*

```
#include "A.h"

int main()
{
    return 0;
} 
```

我必须添加一些前向声明以使出现的一些额外错误（当我添加细节时）消失。其中一些可能不是必需的或不正确的。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-12T08:27:10.177

您的标题包含是循环的。A -> K -> J -> B -> A。使用前向声明是避免这种复杂性的最简单方法，但只有在被声明的类仅使用引用或指向所包含类的指针时才有可能。例如，您不能在 Kh 或 Bh 中使用前向声明，因为它们分别继承自 J 和 A。但是，您可以将`#include "K.h"`in Ah替换为`class K;`取决于您实际使用`K`in 的方式`A`。

谈论混乱。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-12T08:29:49.407

在这个具体的例子中，删除

```
#include "B.h" 
```

从文件中`J.h`，因为那里不需要。如果这不起作用，我们需要更多关于如何`J`使用的细节`B`......

**编辑**

由于`J`仅使用指向 的指针`B`，因此建议保持不变:-)：

`#include "B.h"`从中删除`J.h`并用前向声明替换它`B`：

```
(J.h)
class B;

class J
{
  // ...
  virtual void visit(const B*) const = 0; // This will work with forward declaration
} 
```

也`#include "K.h"`从`A.h`.

**重要的**

当然，您需要在相应的 CPP 文件中添加所需的包含：

```
(J.cpp)
#include "B.h"
// ...
// Go ahead with implementation of J
// ... 
```

（对于`A.cpp`，包括相同`K.h`）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-12T08:29:45.710

问题是您的头文件周期性地相互依赖。不要包括`K.h`in`A.h`和`B.h`in `J.h`。他们在那里不需要。

关于您的编辑：这不是您的对象交互的最佳方式。重新考虑您的设计。谁打电话`node.accept(visitor)`？不能`visitor(node)`直接打电话吗？

此外，如果您正在尝试设计图形库，请查看[Boost.Graph](http://www.boost.org/doc/libs/release/libs/graph/)库。

也就是说，由于您只使用指向`B`in的指针`J.h`，因此您不必包含`B.h`，只需前向声明该类。

```
class B;

struct J
{
    virtual void visit(const B*) const = 0;
}; 
```

然后包含`B.h`在您的`K.cpp`文件中。

```
#include "K.h"
#include "B.h"

void K::visit(const B* b) const
{
    // use b here any way you want
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-12T08:31:06.157

主要问题是您的头文件以循环方式相互包含。A 包括 K ，其中包括 J ，其中包括 B ，然后又包括 A ......你永远不应该要求发生这种情况的情况。你应该回到设计图板，要么削减一些依赖关系，要么完全重新组织你的类，这样这种循环依赖关系就不会发生。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-12T10:18:13.857

圆形夹杂物不起作用。

尽量将夹杂物控制在最低限度。如果你这样做，你要么完全没问题，要么你会发现设计中的问题。就您而言，我认为您的设计没有任何问题。

定义类 K 时，您只使用指向 B 类型对象的指针。这不需要定义 B（如“包含头文件”），只需声明（前向声明即可）。因此，在您的情况下，删除包含到标题“Bh”的内容，替换为“B 类；” 足够了。（J班也一样）

# sql - 帮助 Rails find_by 查询

> ID：741456
> 
> 赞同：2
> 
> 时间：2009-04-12T08:19:41.053
> 
> 标签：sql, ruby-on-rails

假设@news_writers 是一个记录数组。然后，我想使用@news_writers 查找由@news_writers 中包含的所有新闻作者撰写的所有新闻项目。

所以我想要这样的东西（但这在语法上是不正确的）：

```
@news = News.find_all_by_role_id(@news_writers.id) 
```

注意

```
class Role < ActiveRecord::Base
  has_many :news
end

and 

class News < ActiveRecord::Base
  belongs_to :role
end 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T10:30:48.617

像 ennen 一样，我不确定你的模型应该有什么关系。但通常，您可以从给定集合中找到所有具有列值的模型，如下所示：

```
 News.all(:conditions => {:role_id => @news_writers.map(&:id)}) 
```

这将创建一个带有 where 条件的 SQL 查询，例如：

```
 WHERE role_id IN (1, 10, 13, ...) 
```

其中整数是@news_writers 的 ID。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T08:34:57.460

我不确定我是否理解你 - @news_writers 是角色模型的集合？如果该假设是正确的，那么您的关联似乎是倒退的 - 如果这些代表新闻项目的作者，那么 News belongs_to Role （作为作者）不应该吗？

无论如何，我认为最直接的方法是在@news_writers 上使用迭代器，依次调用每个news_writer（如news_writer.news）的关联并将其推入单独的变量中。

编辑：Daniel Lucraft 的建议是比上述更优雅的解决方案。

# javascript - XML 和多个非唯一 DIV

> ID：741459
> 
> 赞同：0
> 
> 时间：2009-04-12T08:26:29.243
> 
> 标签：javascript, xml, ajax

有没有一种方法可以在单击时将内容从 XML 文件中提取到 DIV 中，而不使用 ID，并且涉及多个 DIV？

例如，在下面的代码中，单击第一个链接将使 XML 文件中的内容仅出现在链接下方的 DIV 中，而无需手动为链接或 DIV 分配任何 ID。

```
<a class="reveal">Reveal</a>
<div class="xml-content">Content appears here</div>
<a class="reveal">Reveal</a>
<div class="xml-content">Content appears here</div> 
```

我一直无法实现这样的目标。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T08:35:59.487

通过使用 JQuery 的许多选择器，您可以轻松地做到这一点。请参阅[此页面](http://docs.jquery.com/Selectors)以获取它们的列表，并具体查看 prev - next 和 first last。

# java - 如何只从服务器下载新文件？

> ID：741466
> 
> 赞同：3
> 
> 时间：2009-04-12T08:34:03.657
> 
> 标签：java, filesystems

我每天都想从雅虎财经下载大量 CSV 文件。我希望我的应用程序读取文件的创建日期（在我的计算机上，而不是服务器上）。如果创建日期早于今天，则应下载新文件（因为它将包含新数据）。如果不是，则不应下载新文件，相关性计算器（本质上是我的应用程序）应使用上次下载的特定股票代码文件。

我做了一些谷歌搜索并找到了 Apache POI 项目。

这是最好的方法吗，有没有更好的方法，你会推荐什么。JNI 在这里完全相关吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-12T08:43:05.193

我可能遗漏了一些东西，但我不明白为什么需要 JNI 或 POI 来下载文件。如果您使用 HTTP 下载文件，则可以使用带有“If-Modified-Since”请求标头的 HttpURLConnection。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-12T08:51:57.263

您是否考虑过创建一个 FTP 帐户来访问该特定文件夹，然后使用 SmartFTP 或 FileZilla 等 FTP 客户端将您的本地文件夹与远程文件夹同步？应该很容易设置并且使用起来也很方便...此外，如果绝对必要，您可以简单地创建一个 FTP 命令脚本并从您的 Java 代码中执行它...

或者我会尝试为您指出另一个方向：md5() 或其他消息摘要算法可以帮助您。您不必依赖时间戳。尝试计算您拥有的文件和您将要下载的文件的 md5() 哈希值。然后你就知道要不要下载了。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-12T10:15:46.890

> 我每天都想从雅虎财经下载大量 CSV 文件。我希望我的应用程序读取文件的创建日期（在我的计算机上，而不是服务器上）。如果创建日期早于今天，则应下载新文件（因为它将包含新数据）。

为了检测对本地文件的更改，您需要文件的最后修改日期，该日期比此类检查的创建日期更通用（因为它还显示文件创建后的更改）。

您可以使用 Java 来获得它

```
public long lastModified() 
```

File 对象上的方法。

请注意，在 File API 中没有获取创建日期的方法，可能是因为此信息并非在所有文件系统中都可用。

如果您**绝对**需要一个文件创建日期，那么（如果您自己创建文件，或者您可以询问那些创建文件的人）您可以在文件名中按照约定对创建日期进行编码，如下所示：myfile_2009_04_11.csv。

然后您必须解析文件名并确定创建日期。

> 我做了一些谷歌搜索并找到了 Apache POI 项目。这是最好的方法吗，有没有更好的方法，你会推荐什么。

Apache POI 项目是一个用于读写 MS Office 文件（本例中为 Excel 文件）的库。CSV 是一种简单的文本格式，因此您不需要 POI 即可阅读。

此外，您需要的信息（创建日期或上次修改日期）可用作文件本身的元数据，而不是文件数据，因此您不需要 POI 即可获取它。

> JNI 在这里完全相关吗？

从理论上讲，您可以使用自定义 JNI 扩展（连接本机代码的桥梁）来获取文件在支持它的文件系统上的创建日期。

但是，您最好使用 Java SDK API 中已有的可移植最后修改日期和/或“文件名中编码的创建日期”约定。

使用 JNI 将使您的程序无法移植，而没有真正的额外好处。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-12T08:52:01.163

JNI 绝对无关紧要，Apache POI 也是如此，除非创建日期存储在文件本身中（不太可能）。否则，它是外部元数据，可以通过 HTTP 标头访问（可能使用纯 Java），或者根本无法访问。

# asp.net - Microsoft AJAX 和 AJAX Pro 有什么区别？

> ID：741470
> 
> 赞同：2
> 
> 时间：2009-04-12T08:41:42.077
> 
> 标签：asp.net, ajax, asp.net-ajax, ajaxpro

Microsoft AJAx 和 AJAX Pro 有什么区别？

另外，我应该使用 AJAX Pro 做什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T08:58:43.580

Microsoft AJAX 是 Microsoft 的 Ajax 库，其中包含随时可用的服务器控件。

AJAX Pro 是一个免费的 AJAX 库，可让您手动实现 Ajax 调用。使用微软的控件有点困难。但是您可以使用此库对数据和 html 元素进行更多控制。

使用 AJAX Pro，您可以定义 AjaxMethods，并在客户端调用它们。使用回调方法，您可以获得返回值并实现您的逻辑。整个可序列化的 .NET 对象成功转换为 javascript 对象。

在 Ajax Pro 中，当您进行 ajax 调用时，只会调用您定义的方法。在 Microsoft Ajax 中，改为调用整个页面生命周期。因此，您不能使用 Ajax Pro 更改页面上的控件属性。您应该通过 javascript 中的回调函数手动执行此操作。但是在 Microsoft AJAX 中，您可以在 Ajax 方法中更改控件的属性。

我的建议是，如果您了解 Javascript 和 HTML，请尝试使用 Ajax Pro 或 JQuery for AJAX。但如果您是新手，请从 Microsoft Ajax 开始。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T13:24:06.407

如果您喜欢 AJAX pro 的工作方式，那么我建议您查看 www.coolite.com，它们是令人惊叹的控件，那里的人使用 EXTJS 并为您完成所有工作，您拥有出色的快速控件，您还可以在其中定义Ajax 方法，Web 方法。

另外，如果您真的想使用 Microsoft Ajax，那么我建议您使用 Teleirk Ajax Controls set，它基于 Microsoft Ajax 框架构建，但具有大量选项和强大的支持，我个人每天都在使用它们。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T11:49:05.963

我认为 Ajax Pro 的开发人员在构建 Atlas 时继续为 Microsoft 工作。

# c++ - 是否可以将多个对象放在一个联合中？

> ID：741476
> 
> 赞同：11
> 
> 时间：2009-04-12T08:47:02.390
> 
> 标签：c++, unions

如果我有这个怎么办：

```
union{
    vector<int> intVec ;
    vector<float> floatVec ;
    vector<double> doubleVec ;
} ; 
```

当然，我将只使用 3 个向量中的一个。但是......当所有 3 个向量都被构造时会发生什么？
3个向量的构造函数会相互干扰吗？（因为它们3在同一个内存地址中）

谢谢。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-12T08:48:25.697

当前的 C++ 标准不允许在联合中使用非 POD 类型。您将从以下位置收到此编译器错误`gcc`：

```
error: member ‘std::vector<int, std::allocator<int> >
<anonymous union>::i’ with constructor not allowed in union
error: member ‘std::vector<int, std::allocator<int> >
<anonymous union>::i’ with destructor not allowed in union 
```

新的 C++ 标准 ( [C++0x](http://en.wikipedia.org/wiki/C%2B%2B0x) ) 提出了[不受限制的联合](http://en.wikipedia.org/wiki/C%2B%2B0x#Unrestricted_unions)，但它给 C++[添加了*更多的*对象生命周期陷阱](http://www.informit.com/guides/content.aspx?g=cplusplus&seqNum=407)。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-12T08:48:37.973

您不能拥有包含非 POD 类类型的联合。您的示例将无法编译。

您可以将`boost::variant`其用作 C 联合的安全替代方案。请参阅[boost.org 上的文档](http://www.boost.org/doc/libs/1_38_0/doc/html/variant.html)。但是，您可能会重新考虑您的设计并改用多态性。当然，这取决于您要完成的工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-12T08:52:02.927

来自 C++ 标准，第 9.5 节：

> 具有非平凡构造函数 (12.1)、非平凡复制构造函数 (12.8)、非平凡析构函数 (12.4) 或非平凡复制赋值运算符 (13.5.3, 12.8) 的类的对象不能成为工会成员，

在这里，对于“非平凡”阅读“有用”:-)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-12T08:55:05.773

> 3个向量的构造函数会相互干扰吗？（因为它们3在同一个内存地址中）

C++ 标准不允许你的程序，所以它（充其量！）实现定义发生了什么。

例如，如果您的实现调用所有三个默认构造函数，并且它们都分配内存，并存储指向新分配空间的指针，那么您就有内存泄漏（前两个分配被第三个覆盖）。

如果析构函数都被调用并且它们都释放了“他们的”内存，那么您将进行双重释放（实际上是三重释放）；这可能会破坏分配数据结构，这是一件坏事。如果你崩溃了，你会很高兴，因为如果你不崩溃，调试起来会困难得多。

我认为这些问题可能是标准不允许这样做的*原因。*

（更有意义的事情可能是只默认构造第一类，但这仍然不明智，只是不那么疯狂......）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2019-08-26T05:12:05.260

现在 C++ 标准支持变体。检查[https://en.cppreference.com/w/cpp/utility/variant](https://en.cppreference.com/w/cpp/utility/variant)。

`**std::variant**`

在标题中定义

```
template <class... Types>   
class variant; 
```

^((C++17 起))

类模板`std::variant`代表一个类型安全的[union](https://en.cppreference.com/w/cpp/language/union)。在任何给定时间的实例`std::variant`要么保存其替代类型之一的值，要么在错误的情况下 - 没有值（这种状态很难实现，请参阅[valueless_by_exception](https://en.cppreference.com/w/cpp/utility/variant/valueless_by_exception)）。

与联合一样，如果变体拥有某个对象类型 T 的值，则 T 的对象表示直接分配在变体本身的对象表示中。不允许变体分配额外的（动态）内存。

不允许变量包含引用、数组或 void 类型。空变体也是格式错误的（`std::variant<std::monostate>`可以代替使用）。

一个变体被允许多次持有相同的类型，并且持有相同类型的不同的 cv 限定版本。

[与聚合初始化](https://en.cppreference.com/w/cpp/language/aggregate_initialization)期间联合的行为一致，默认构造的变体保留其第一个替代的值，除非该替代不是默认构造的（在这种情况下，变体也不是默认构造的）。辅助类[`std::monostate`](https://en.cppreference.com/w/cpp/utility/variant/monostate)可用于使此类变体默认可构造。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-12T08:52:09.010

您可能想看看[Boost.Variant](http://www.boost.org/doc/libs/1_38_0/doc/html/variant.html)可以包含不同类型的单个值。

# nhibernate - 忽略 NHibernate 代理的公共/内部字段

> ID：741489
> 
> 赞同：18
> 
> 时间：2009-04-12T09:01:02.997
> 
> 标签：nhibernate, fluent-nhibernate, f#

我有一些我想延迟加载的实体类型。但是，它们有一些公开的内部（程序集）字段，但不在该类之外使用。这些字段是编译器生成的 (F#)，我无法更改它们。一个示例例外是：

> NHibernate.InvalidProxyTypeException：以下类型不能用作代理：Mappings.MTest：字段 id@47 不应该是公共的或内部的

我理解 NHibernate 为何这样做，以及如果我访问它们，拥有字段会如何弄乱生成的代理的延迟加载属性。但是，既然我知道我不会使用这些字段，我可以以某种方式覆盖 NHibernate 吗？

有什么办法可以说“忽略这个领域”？我正在使用 Fluent NHibernate，如果这样更容易的话。

编辑：我还应该注意，我使用的是 NHibernate 2.1.0 Alpha 2。

Edit2：这里的主要要点是我想保持 LazyLoading 启用，这意味着我必须使用代理生成。禁用 LazyLoading 是可行的（没有代理），但有点违背了像 NHibernate 这样的好框架的目的。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-12T10:25:14.607

我重新组装了 NHibernate（比获取源代码和重建更容易）并删除了在内部/公共字段上出错的代码。没有该检查，LazyLoading 似乎工作得很好。（虽然，我是 NHibernate 的新手，所以可能有一些我不知道的场景。）

**编辑：** 啊，有一个属性“use_proxy_validator”将禁用所有验证检查。够好了。

```
Fluently.Configure()
    .ExposeConfiguration(fun cfg -> 
        cfg.Properties.Add("use_proxy_validator", "false"))... 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-08-02T19:16:59.157

只需将**惰性**属性设置为 false，

```
 <class name="OrderLine" table="OrderLine" lazy="false" > 
```

您可以阅读更多内容：NHibernate 的一切都必须是虚拟的吗？- [http://davybrion.com/blog/2009/03/must-everything-be-virtual-with-nhibernate/](http://davybrion.com/blog/2009/03/must-everything-be-virtual-with-nhibernate/)

Ofir, www.TikalK.com

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-12T09:14:23.090

您可以使用

```
[XmlIgnore] 
```

属性来装饰字段:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-13T14:23:14.960

您可以使用接口来声明“已使用”字段吗？[http://nhibernate.info/doc/nh/en/index.html#persistent-classes-poco-sealed](http://nhibernate.info/doc/nh/en/index.html#persistent-classes-poco-sealed)

“另一种可能性是类实现声明所有公共成员的接口”

我不知道 NH 是否使用与 JAVA 版本相同的 @transient 注释/属性来忽略持久操作中的属性。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-12T09:03:36.063

~~你可能想看看[这个页面](http://www.atrevido.net/blog/2009/04/01/Using+Fluent+NHibernate+With+F.aspx)，它概述了使用 F# 和 Fluent NHibernate。~~

**编辑**我刚刚注意到您的用户名。我认为这是你的博客是正确的吗？我多么愚蠢。不过，它似乎确实解决了您的问题，特别是“我们首先禁用 LazyLoad，因为大多数属性不是虚拟的，并且 NHibernate 将无法验证映射。相反，我们显式地 LazyLoad 事物，例如 Store 引用。”？也许我只是误解了这个问题。

# repository-pattern - 存储库模式 - POCO 或 IQueryable？

> ID：741490
> 
> 赞同：12
> 
> 时间：2009-04-12T09:01:26.023
> 
> 标签：repository-pattern

我是存储库模式的新手，在网上做了很多阅读之后，我对正在发生的事情有了一个粗略的了解，但似乎存在思想冲突。

一个是 IRepository 应该返回的内容。

我只想处理 Pocos，所以我将为每个聚合根都有一个 IRepository 实现，如下所示：

```
public class OrangeRepository: IOrangeRepository
{
  public Orange GetOrange(IOrangeCriteria criteria);
} 
```

其中 IOrangeCriteria 采用一些特定于查找橙色的参数。

我拥有的另一件事是许多数据后端——这就是我首先进入这种模式的原因。我想我将为每个人都有一个实现，例如

OrangeRepositoryOracle、OrangeRepositorySQL、OrangeRepositoryMock 等

我想让它保持打开状态，以便我可以使用 EF 或 NHibernate - 如果我的 IOrangeRepository 处理 POCO，那么我将通过实现 OrangeRepositoryNHibernate 等将其封装在存储库本身中。

我在正确的路线上吗？

谢谢

编辑：感谢您的反馈，目前我没有其他人可以提出这些想法，因此不胜感激！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-12T10:00:04.243

是的，您的版本是最安全/最兼容的版本。您仍然可以将它用于任何资源，不仅是数据访问资源，还可以用于 Web 服务、文件等。

请注意，使用 IQueryable 版本，您仍然可以根据您的 POCO 类工作，但您与 IQueryable 相关联。还要考虑您可能拥有使用 IQueryable 的代码，然后发现您遇到了存储库的 ORM 之一不能很好地处理它的情况。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-12T10:44:39.147

我使用与您相同的模式。我很喜欢。您可以从任何资源中获取数据。

但是使用 IQuerable 的优点是您不必像 OrangeCriteria 那样编写自己的标准 API。

当 NHibernate 获得完整的 Linq 支持时，我可能会切换到 IQueryable。

然后你得到

```
public class OrangeRepository: IOrangeRepository {  
    public IQueryable<Orange> GetOranges();
} 
```

# xml - 在 XPATH 中加载属性，问题

> ID：741493
> 
> 赞同：0
> 
> 时间：2009-04-12T09:07:08.240
> 
> 标签：xml, xpath, xslt

我有一个关于在 XPATH 中加载属性的问题。我编写了简短的 XML 代码进行测试：

```
<?xml version="1.0" encoding="iso-8859-1"?>
<?xml-stylesheet type="text/xsl" href="testDate.xsl"?>
<element attribute="1/1/2100">
  Hung
 </element> 
```

我的 XSL 代码：

```
<?xml version="1.0" encoding="iso-8859-1"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
  <!--Handle the document: set up HTML page-->
  <xsl:template match="/">
    <html>
    <head>    
    </head>
    <body>
   This is a test   
     <xsl:value-of select="element@attribute"/>
    </body>
    </html>
  </xsl:template>
</xsl:stylesheet> 
```

为什么加载样式表时会产生错误？你能帮我解释一下吗？谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-12T09:35:55.723

您需要`@`在`<xsl:value-of />`.

您收到错误是因为`element@attribute`XPath 无效。插入斜线表示您想要：

*   找到名为 的元素`element`，然后
*   在这些元素中，找到一个名为`attribute`.

以下修改后的样式表对我有用：

```
<?xml version="1.0" encoding="iso-8859-1"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
  <!--Handle the document: set up HTML page-->
  <xsl:template match="/">
    <html>
    <head>    
    </head>
    <body>
                This is a test                  
        <xsl:value-of select="element/@attribute"/>
    </body>
    </html>
  </xsl:template>
</xsl:stylesheet> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-12T09:35:19.030

我怀疑您的 XPath 属性是错误的。我认为应该是

```
element/@attribute 
```

即你应该用 / 分隔元素和@attribute

# sql-server - 基于成功或失败的结果集

> ID：741502
> 
> 赞同：0
> 
> 时间：2009-04-12T09:18:41.987
> 
> 标签：sql-server, stored-procedures, temp-tables

我有一个存储过程，它根据成功或失败返回两个结果集。

SP 成功结果集：name, id ,error,desc
SP 失败结果 sret: error,desc

我正在使用以下查询来获取存储过程的结果。成功返回 0，失败返回 -1。

```
declare @ret int

DECLARE @tmp TABLE (
     name  char(70),
     id    int,
     error char(2),
     desc  varchar(30)
)

insert into @tmp
EXEC @ret  = sptest '100','King'

select @ret

select * from @tmp 
```

如果 SP 成功，则四个字段将被插入到临时表中，因为列匹配。但是在失败的情况下，sp结果集只有错误和desc与临时表中的列不匹配......我无法更改Sp，所以我需要做一些事情（不确定）临时表来处理失败和成功。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-12T10:25:00.940

您不能返回 2 个不同的记录集并加载同一个临时表。两者都不能尝试填写 2 个不同的表格。

有 2 个选项。

1.  修改你的存储过程

    *   在所有条件下返回所有 4 列
    *   第一对 (name, ID) 列在错误时为 NULL
    *   第二对（错误，描述）成功时为 NULL
2.  如果您使用的是 SQL Server 2005，则使用 TRY/CATCH 分隔成功和失败代码路径。下面的代码依赖于使用新的错误处理通过异常/RAISERROR 传回错误结果集。

例子：

```
CREATE PROC sptest
AS
DECLARE @errmsg varchar(2000)

BEGIN TRY
   do stuff
   SELECT col1, col2, col3, col4 FROM table etc
   --do more stuff
END TRY
BEGIN CATCH
   SELECT @errmsg = ERROR_MESSAGE()
   RAISERROR ('Oops! %s', 16, 1, @errmsg)
END CATCH
GO

DECLARE @tmp TABLE ( name CHAR(70), id INT, error char(2), desc varchar(30)

BEGIN TRY
    insert into @tmp
    EXEC sptest '100','King'
    select * from @tmp
END TRY
BEGIN CATCH
   PRINT ERROR_MESSAGE()
END CATCH 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-28T00:41:17.177

你不能只用一个电话来做到这一点。您必须调用它一次，或者获取返回状态，然后根据状态分支到 INSERT..EXEC 命令，该命令将适用于将返回的列数，或者调用一次，假设成功，使用 TRY。 .CATCH，然后在 Catch 中再次调用它，假设它会失败（这就是它到达 CATCH 的方式）。

更好的是，要么重写存储过程，使其返回一致的列集，要么编写您自己的存储过程、表值函数或查询，方法是从该存储过程中提取代码并使其适应您的使用. 这是 SQL 中的正确答案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T09:35:50.870

我的错！！回答得太快了。您只需要对返回值进行 relv，因此针对它构建逻辑要好得多。

如果您仍然想使用临时表，那么两次调用 sptest 可能是一种处理它的方法（虽然不是最佳的），一次获取返回值并基于它然后有 2 个不同的临时表要填充（一个是 4 个字段，另一个只有 2 个字段）。

```
declare @ret int

DECLARE @tmp TABLE (name CHAR(70), id INT, error char(2), desc varchar(30))
DECLARE @tmperror TABLE (error char(2), desc varchar(30))

EXEC @ret = sptest '100','King'

IF @ret != 0
BEGIN
  INSERT INTO @tmperror
  EXEC sptest '100','King';
  SELECT * FROM @tmperror;
END
ELSE
BEGIN
  INSERT INTO @tmp
  EXEC sptest '100','King';
  SELECT * FROM @tmp;
END 
```

请记住，此解决方案不是最佳的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-23T06:56:38.460

尝试修改表定义，使前两列可以为空：

```
DECLARE @tmp TABLE (
 name  char(70) null,
 id    int null,
 error char(2),
 desc  varchar(30) 
```

)

希望这可以帮助，

账单

# asp.net-mvc - url中的国际字符，mvc过滤问题

> ID：741503
> 
> 赞同：1
> 
> 时间：2009-04-12T09:19:45.620
> 
> 标签：asp.net-mvc, internationalization

我在 asp.net mvc 中过滤时遇到问题。我有一个列出集合和过滤器的页面。过滤器有过滤集合的值，它是：类别、状态和包含的字符串。问题在于国际化应用程序可以使用多种语言，因此包含的字符串可以是特殊字符，例如：ü

我的路线是`List/{category}/{status}/{containingString}`

我应该使用 get 方法来发送 containsString 还是应该使用 post 方法。我现在正在使用小技巧，我的表单正在发布到同一控制器的另一个操作方法，该控制器从 url 获取类别和状态，从 Request.Form 获取 containsString，然后重定向到 List 操作方法，包含我正在放入 TempData ...如您所见，这是一种肮脏的黑客行为，我自己也不喜欢...

任何人都可以更好地解决这个问题？

谢谢

ps stackoverflow 摇滚！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-15T09:47:50.833

你可以去掉路由器中的变音符号吗？

# php - 正则表达式匹配任何 UTF 字符，不包括标点符号

> ID：741506
> 
> 赞同：3
> 
> 时间：2009-04-12T09:21:55.460
> 
> 标签：php, regex, utf-8

我正在 PHP 中准备一个函数来自动转换字符串以用作 URL (*.html) 中的文件名。虽然为了安全起见，应该使用 ASCII，但对于 SEO 需要，我需要允许文件名使用任何语言，但我不希望它包含破折号 (-) 和下划线 (_)、字符以外的标点符号像 *%$#@"' 不应该被允许。

空格应转换为破折号。

我认为使用 Regex 将是最简单的方法，但我不确定如何处理 UTF8 字符串。

我的 ASCII 函数如下所示：

```
function convertToPath($string)
{
    $string = strtolower(trim($string));
    $string = preg_replace('/[^a-z0-9-]/', '-', $string);
    $string = preg_replace('/-+/', "-", $string);
    return $string;
} 
```

谢谢，

罗伊。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-12T09:36:32.477

我认为对于 SEO 需要，您应该在 URL 中坚持使用 ASCII 字符。

理论上，URL 中允许使用更多字符。在实践中，大多数系统只解析可靠的 ASCII。

此外，许多自动解析链接脚本会因非 ASCII 字符而窒息。因此，在您的 URL 中允许使用非 ASCII 字符的 URL 会大大减少您的链接在用户生成的内容中显示（正确）的变化。（如果您想要此类脚本的示例，请查看 stackoverflow 脚本，例如，它会被括号阻塞）

您还可以查看： [重写“漂亮 URL”时如何处理变音符号（口音）](https://stackoverflow.com/questions/465990/how-to-handle-diacritics-accents-when-rewriting-pretty-urls)

公认的解决方案是转换非 ASCII 字符：

```
<?php
  $text = iconv('UTF-8', 'US-ASCII//TRANSLIT', $text);
?> 
```

希望这可以帮助

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-12T09:35:07.783

如果选择 UTF-8 模式[*，*](http://de2.php.net/manual/en/regexp.reference.php)*您*可以使用[](http://de2.php.net/manual/en/regexp.reference.php)

 *```
/\P{L}+/ 
```

所以我会尝试以下（未经测试）：

```
function convertToPath($string)
{
    $string = mb_strtolower(trim($string), 'UTF-8');
    $string = preg_replace('/\P{L}+/', '-', $string);
    $string = preg_replace('/-+/', "-", $string);
    return $string;
} 
```

请注意，您会[`strtolower()`](http://de.php.net/strtolower)在使用 UTF-8 字符串时遇到问题，因为它会弄乱您的多字节字符 - 请[`mb_strtolower()`](http://de.php.net/manual/en/function.mb-strtolower.php)改用。

# java - 控制Java中的类加载顺序

> ID：741512
> 
> 赞同：0
> 
> 时间：2009-04-12T09:28:39.733
> 
> 标签：java, static, classloader

我创建了一个包含一堆属性值的类。为了初始化该类，我必须调用一些静态方法“configure()”，该方法从 XML 文件对其进行配置。

那个类应该用来存储一些数据，这样我就可以写了

```
PropClass.GetMyProperty(); 
```

我`configure()`从 main 中的一个静态块调用它，所以我可以在任何地方使用它

但

如果我将某个其他类的静态常量成员设置为我的“PropClass”中的一个值，我会得到 null，

```
class SomeClass {

   static int myProp = PropClass.GetMyProperty();

} 
```

这可能是因为该表达式是在调用配置之前评估的。我该如何解决这个问题？

我怎样才能强制调用`configure()`将首先执行？谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-12T09:33:24.323

你可以使用静态代码块来做到这一点

```
static {
   configure();
} 
```

静态初始化块的语法？剩下的就是关键字 static 和一对匹配的大括号，其中包含在加载类时要执行的代码。[取自这里](http://www.developer.com/java/other/print.php/2238491)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-12T15:24:24.667

我会做以下事情：

```
class SomeClass 
{
   // assumes myProp is assigned once, otherwise don't make it final
   private final static int myProp;

   static
   { 
       // this is better if you ever need to deal with exceeption handling, 
       // you cannot put try/catch around a field declaration
       myProp = PropClass.GetMyProperty();
   }
} 
```

然后在 PropClass 中做同样的事情：

```
class PropClass
{ 
    // again final if the field is assigned only once.
    private static final int prop;

    // this is the code that was inside configure.
    static
    {
        myProp = 42;
    }

    public static int getMyProperty();
} 
```

还。如果可能的话，不要让一切都是静态的——至少使用一个[单例](http://en.wikipedia.org/wiki/Singleton_pattern)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T09:32:19.193

你能不让`GetMyProperty()`方法检查是否`configure()`已经被调用吗？这样您就可以调用`GetMyProperty()`而不必担心我们的对象是否已配置。您的对象将为您处理此问题。

例如

```
public String getMyProperty() {
   if (!configured) {
      configure();
   }
   // normal GetMyProperty() behaviour follows
} 
```

（如果你想要线程安全，你应该同步上面的内容）

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-12T14:59:32.900

伙计，听起来你应该使用[Spring Framework](http://www.springframework.org/)（或其他一些依赖注入框架）。在 Spring 中，您已经获得了所需的一切：

*   用于定义具有可配置属性的 bean 的 XML 格式，无需编写用于读取 XML 和自己初始化 bean 的逻辑。
*   Bean 在您需要它们时被初始化（前提是您以正确的方式访问它们）。最好的方法是将 bean 注入调用者。

不要发明轮子... Spring 是 Java 中最常用的框架之一。恕我直言，没有它就不应该编写大型 Java 应用程序。

# c# - 如果 SetForegroundWindow 和 ShowWindowAsync 不起作用，如何设置前景窗口？

> ID：741514
> 
> 赞同：1
> 
> 时间：2009-04-12T09:29:47.810
> 
> 标签：c#, .net, windows, winapi

它是一个 ac# winform 应用程序。我已将 ShowInTaskbar 属性设置为 false，因为我不希望程序出现在任务栏中，但是像这样 SetForegroundWindow 或 ShowWindowAsync 不起作用。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-12T09:45:09.397

Raymond Chen 在他的经典文章前台激活权限就像爱一样解释了Windows 中围绕前台激活的规则[：你不能偷，它必须给你](http://blogs.msdn.com/oldnewthing/archive/2009/02/20/9435239.aspx)。粗略地说，您不能使用类似的调用窃取前台激活`SetForegroundWindow`，您需要从已经具有前台激活的进程中获得它。

在您的情况下，当您在任务栏中设置显示时，任务栏能够为您的应用程序提供前台激活，因为当您单击窗口的任务栏图标时，这将（简要地）激活任务栏。如果您没有在任务栏中显示激活，则需要找到一种方法来拥有一个可以提供给您的应用程序。明确允许的一种方法是使用通知窗口（托盘）图标。

# c# - 如何在 C# 中中断服务器连接

> ID：741520
> 
> 赞同：1
> 
> 时间：2009-04-12T09:34:42.947
> 
> 标签：c#, ftp

我的应用程序功能之一是从我们的 ftp 服务器下载文件。当然，此功能需要取消此操作（取消下载）。

现在，我的下载功能如下：

```
try
        {
            reqFTP = (FtpWebRequest)FtpWebRequest.Create(new Uri("ftp://" + uri + "/" + fileName));
            reqFTP.Method = WebRequestMethods.Ftp.DownloadFile;
            reqFTP.UseBinary = true;
            reqFTP.Credentials = new NetworkCredential(ftpUserID, ftpPassword);
            reqFTP.UsePassive = true;

                response = (FtpWebResponse)reqFTP.GetResponse();
                ftpStream = response.GetResponseStream();
                _isItOutputStream = true;
                string dataLengthString = response.Headers["Content-Length"];
                int dataLength = 0;
                if (dataLengthString != null)
                {
                    dataLength = Convert.ToInt32(dataLengthString);
                }

                long cl = response.ContentLength;
                int bufferSize = 4048;
                int readCount;
                byte[] buffer = new byte[bufferSize];
                readCount = ftpStream.Read(buffer, 0, bufferSize);
                outputStream = new FileStream(filePath + "\\" + fileName, FileMode.Create);
                bool first = true;
                while (readCount > 0)
                {
                    outputStream.Write(buffer, 0, readCount);
                    _actualDownloaded += readCount;
                    if (this.InvokeRequired)
                    {
                        ProgressBarDel _progressDel = new ProgressBarDel(ProgressBar);
                        this.Invoke(_progressDel, new object[] { _actualDownloaded, first });
                    }
                    first = false;
                    readCount = ftpStream.Read(buffer, 0, bufferSize);
                }
                ftpStream.Close();
                outputStream.Close();
                response.Close();
                _isItOutputStream = false;
                return true;
            }
            catch (Exception ee)
            {
                _downloadException = ee.Message;
                if (ftpStream != null && outputStream!=null )
                    if (ftpStream.CanRead && outputStream.CanWrite)
                    {
                        ftpStream.Close();
                        outputStream.Close();
                    }

                if (response != null)
                    response.Close();

                return false;
            } 
```

现在，正如您在 Catch Block 中看到的那样，您可以看到当用户单击“取消”按钮时我正在尝试中断此连接。

*   取消操作场景：

1) 单击取消按钮。

2) 调用函数“DoSomeWorx()”

3）在“DoSomeWorx（）”中做：

```
if (_isItOutputStream)// where here i'm trying to check if it's downloading 
 {
   ftpStream.Close();
   outputStream.Close();
   response.Close(); 
 }
 if (_startCopy)// check if copying to phone 
 {
   IsCancelled();
 }
 _btnDownload2PhoneThread.Abort(); // actually this operation does what i did before but for some resoans it does this but it takes time...
 _btnDownload2PhoneThread.Join(); 
```

问题是当我达到以下任何陈述时`(ftpStream.Close();outputStream.Close();response.Close();)`

它抛出异常“文件不可用（例如文件正忙）”

并且此异常会影响它看到文件繁忙的重新下载操作。

那么如何避免这个异常呢？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-12T09:50:01.070

我假设您有某种形式，因此您在线程上执行下载。

你最好做的是在你的while循环中检查一个“取消”标志。

例如。

```
while(readcount > 0 && !cancel)
{
   ...
} 
```

然后让你的方法优雅地取消。

其次，您应该在流上使用 using 语句。这意味着如果您抛出异常，finally 块将保证您的流被释放（顺便说一句，这就是您接收文件繁忙的原因，因为流还没有运行它的析构函数，即使您的方法已经完成）

# jquery - 不是立即显示 ajax 加载指示器，而是在延迟之后显示

> ID：741528
> 
> 赞同：5
> 
> 时间：2009-04-12T09:37:40.383
> 
> 标签：jquery, ajax

我当前的 Web 应用程序项目大量使用 ajax 调用。他们中的大多数都很快并且几乎立即做出反应。因此，没有必要一直显示 ajax 加载器。但是当 ajax 调用需要超过 250 毫秒（左右）时，我想显示一个 ajax 加载器。否则用户可能会感到困惑并一遍又一遍地点击链接。:)

任何想法如何使用 jQuery 来完成它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-12T09:44:24.703

我以前没有使用 jQuery 的经验，但要实现一些代码执行的简单延迟，只需使用以下命令：

```
setTimeout ("foo()", 250); 
```

其中 foo() 是负责*加载...*指示的函数。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-12T09:47:44.990

您可以使用 Javascript 计时器在 250 毫秒后触发以显示您的“正在加载...”消息吗？

[在ajaxSend()](http://docs.jquery.com/Ajax/ajaxSend#callback)上激活它，并在[ajaxComplete()](http://docs.jquery.com/Ajax/ajaxComplete#callback)上禁用它（如果需要，则清除“正在加载...”消息），因此实现对于您所做的任何 Ajax 调用都应该是透明的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-02-15T23:48:25.903

```
var activity = false;
$("#loadingIndicator").ajaxStart(function() {
    activity = true;
    window.setTimeout(function() {
        if (activity) {
            //alert('activity');
            $("#loadingIndicator").show();
        }
    }
    , 700);
});
$("#loadingIndicator").ajaxStop(function() {
    activity = false;
    $(this).hide();
}); 
```

# blob - 使用 ODBC 将二进制 std::string 插入 BLOB 列

> ID：741531
> 
> 赞同：2
> 
> 时间：2009-04-12T09:39:58.817
> 
> 标签：blob, binary-data, insert-update

谁能给我一个例子，如何使用 ODBC 和 C++ 将二进制 std::string 插入 BLOB 列，好吗？

编辑：

[How to INSERT binary std::string into BLOB (MySQL)](https://stackoverflow.com/questions/733262/how-to-insert-binary-stdstring-into-blob-mysql)的副本。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-12T11:23:14.467

如果它确实是一个二进制字符串，并且您在其中有实际的二进制数据（例如嵌入的空值），那么您需要注意不要使用任何可以将其视为 C 字符串的 std::string 成员（例如终止 null），因为您显然最终会丢失数据。

该类`std::string`并不真正适合此目的 - 它是在假设您正在使用的实际上是一个字符串的情况下编写的 - 因为您使用的是二进制数据的 blob 或数组，所以 a`std::vector`可能更合适。

要插入数据，您需要使用绑定参数将向量的内容绑定到 SQL 查询。也就是说，您应该使用[SQLPrepare创建语句句柄，而不是使用](http://msdn.microsoft.com/en-us/library/ms710926(VS.85).aspx)[SQLExecDirect](http://msdn.microsoft.com/en-us/library/ms713611(VS.85).aspx)来执行包含 SQL 查询的字符串- 您将二进制值的值与“？”分开，然后使用[SQLBindParameter](http://msdn.microsoft.com/en-us/library/ms710963(VS.85).aspx)将占位符绑定到二进制值。[然后，您使用SQLExecute](http://msdn.microsoft.com/en-us/library/ms713584(VS.85).aspx)调用该函数。

`SQLBindParameter`上面的文档中有一些代码示例。

# .net - 现成的动画库

> ID：741535
> 
> 赞同：1
> 
> 时间：2009-04-12T09:44:42.177
> 
> 标签：.net, winforms, animation, progress-bar

我正在寻找一些要在我的 WinForms 应用程序中显示的进度动画 - 所以任何像 AVI 或动画 GIF 都可以。最好的动画是描绘一些“抽象”概念，例如（例如）飞纸或动画 0 和 1，以指示进度。

我知道Visual Studio 2008自带了自己的动画库（Microsoft Visual Studio 9.0\Common7\VS2008ImageLibrary\1033\VS2008ImageLibrary.zip），但是很小。有谁知道一个网站，我可以在其中找到具有这些必要条件的大型动画库？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T12:08:02.253

[您可以在http://www.ajaxload.info/](http://www.ajaxload.info/)生成自己的加载器

# vim - 在 vim 中显示函数参数

> ID：741542
> 
> 赞同：15
> 
> 时间：2009-04-12T09:53:05.617
> 
> 标签：vim, ide

vim 中有没有办法获得带有函数参数的弹出窗口？（就像在视觉工作室/光滑编辑中）

例如，当我键入“function_name(”时，vim 将打开一个弹出窗口（就像`ctrl-n`在新版本中那样）并显示函数参数以及我当前正在输入的其中一个参数。

ps

1.  我正在寻找比`ctrl-w` `ctrl-]`

2.  我也在寻找一个类似的功能，当我输入“var->”或“var”时，它会显示可用成员的列表。

3.  我正在使用 C

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T13:09:31.893

正如已经建议的那样，安装[autocomplpop](http://www.vim.org/scripts/script.php?script_id=1879)插件。然后，要在您键入 C 文件时触发 omincompletion，您可以将以下内容添加到您的 .vimrc 中：

```
let g:AutoComplPop_Behavior = { 
\ 'c': [ {'command' : "\<C-x>\<C-o>",
\       'pattern' : ".",
\       'repeat' : 0}
\      ]  
\} 
```

如果您不想为输入的每个字符触发全补全，请更改模式值以满足您的需要。有关如何进一步自定义的信息，请查看 autocomplpop.vim 的注释头中的文档

此外，要获得带有函数参数的弹出窗口，还要将以下内容添加到您的 .vimrc 中：

```
let g:AutoComplPop_CompleteoptPreview = 1 
```

要使其正常工作，请确保您使用 ctags 生成了一个标签文件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-12T09:58:26.387

请查看[autocomplpop](http://www.vim.org/scripts/script.php?script_id=1879)和[TTrCodeAssistor](http://www.vim.org/scripts/script.php?script_id=1754)插件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-03-07T04:28:50.060

[YouCompleteMe](https://github.com/Valloric/YouCompleteMe)是一个不错的替代方案，它提供模糊自动完成功能并使用 clang 来处理语义。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-12T10:58:36.617

Check [cream](http://cream.sourceforge.net/) - it seems to have some `C` support. You'll need *[ctags](http://ctags.sourceforge.net/)*.

> A modern configuration of the powerful and famous *Vim*, Cream is now available for Microsoft Windows, GNU/Linux, and FreeBSD
> 
> ... (Programmer Features)
> 
> *   Pop up prototype and information menu ( Alt+( ). View the function's prototype under the cursor without having to open the file with the definition.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-05-27T09:08:53.527

或者你可以试试[vim-assistant](http://www.vim.org/scripts/script.php?script_id=2805)脚本。

# c# - 从 C# 读取 SWF 文件代码

> ID：741551
> 
> 赞同：1
> 
> 时间：2009-04-12T10:04:40.550
> 
> 标签：c#, flash

我有一个接受 Flash 文件上传到我的网站的网站，我需要检查上传的 SWF 文件以检查某些代码是否存在或不将其放入 SWF 文件中，因此我需要读取或反汇编 SWF 文件并从 C#.Net 读取它的代码有什么办法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T10:10:10.430

也许您可以使用[http://flasm.sourceforge.net/](http://flasm.sourceforge.net/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-01-04T10:20:58.483

如果您的 flash 版本不大于 7，那么您可以使用这个 [http://www.codeproject.com/Articles/16834/How-to-create-a-simple-SWF-decompiler-with-the-Swf](http://www.codeproject.com/Articles/16834/How-to-create-a-simple-SWF-decompiler-with-the-Swf)

# php - 如何将两个或多个破折号转换为单个破折号并删除字符串开头和结尾的所有破折号？

> ID：741553
> 
> 赞同：6
> 
> 时间：2009-04-12T10:07:08.253
> 
> 标签：php, regex

例子：`-this--is---a-test--`

我想要的是：`this-is-a-test`

感谢您的任何回答！:)

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-04-12T10:09:23.863

我会使用[`preg_replace`](http://docs.php.net/preg_replace)和的组合[`trim`](http://docs.php.net/trim)：

```
trim(preg_replace('/-+/', '-', $str), '-') 
```

该`preg_replace`调用删除多个破折号并`trim`删除前导和尾随破折号。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-04-24T14:18:27.083

没有正则表达式......

```
$string = trim($string,'-');

while (stristr($string,'--')) {$c = str_ireplace('--','-',$string);} 
```

# objective-c - @finally 在 Cocoa 的 try/catch/finally 异常处理中什么情况下是非冗余的？

> ID：741555
> 
> 赞同：9
> 
> 时间：2009-04-12T10:09:52.363
> 
> 标签：objective-c, cocoa, exception, exception-handling, try-catch

考虑以下 Cocoa/Obj-C 代码片段：

```
MyClass *obj;
@try {
    [obj doSomething];
}
@catch (NSException * e) {
    NSLog(@"Exception occurred: %@", [e description]);
}
@finally {
    [obj cleanUp];
} 
```

和

```
MyClass *obj;
@try {
    [obj doSomething];
}
@catch (NSException * e) {
    NSLog(@"Exception occurred: %@", [e description]);
}
[obj cleanUp]; 
```

在什么情况下第一个片段会被`[obj cleanUp]`调用，而第二个片段*不会*`[obj cleanUp]`被调用？换句话说，在什么情况下`@finally`使用 Cocoa 异常处理是非冗余的？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-12T13:44:07.920

在这些情况下没有区别，因为异常被吞没了。这里有两个*不同*的场景：

[obj cleanUp] 被称为：

```
MyClass *obj;
@try {
    [obj doSomething];
}
@catch (NSException * e) {
    @throw;      
}
@finally {
    [obj cleanUp]; // called when exception is caught
} 
```

[obj cleanUp] 未被调用：

```
MyClass *obj;
@try {
    [obj doSomething];
}
@catch (NSException * e) {
    @throw;
}
[obj cleanUp]; // not called when exception is caught 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-11-10T20:53:34.747

还值得注意的是，当控制*出于任何原因*`@finally`退出`@try`块时，块中的代码将运行，即使是通过或。例如：*`return``goto`*

 *```
@try {
    doStuff();
    if(bail){
        return;
    }
    doMoreStuff();
}
@finally {
    [obj cleanUp];
}
[obj announceSuccess]; 
```

`[obj cleanUp]`即使`bail`是真的也会执行，但`[obj announceSuccess]`不会。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-12T11:01:44.003

在那种情况下，你正在压制异常，没有。`@finally`用于在您未捕获异常或重新抛出异常时进行清理，在任何一种情况下都会将最终异常响应留给调用代码。由于 Cocoa 中的异常只应该用于编程错误，因此很少发生，这是完全合理的做法。

还值得指出一种*不需要*使用的情况`@finally`，即设置自己的自动释放池时。当“父”自动释放池被销毁时，任何尚未清理的内部自动释放池也将被销毁。如果您确实尝试自己清理它，则需要将异常本身从您的自动释放池中提升出来。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-12T11:05:41.327

什么时候：

*   您没有捕捉到发生的异常类型
*   您捕获了异常，但 catch 块中的代码也会引发异常。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-13T06:26:25.013

一个较低级别的问题，你为什么要这样做？

try/catch/finally 方法在 Java 中被广泛使用，但在 Objective-C 中几乎没有使用过，并且不是首选方法 - 你根本不需要它，因为库不会像 Java 库调用那样抛出异常，如果你正在编写自己的库，您不应该期望调用者自然会想到寻找要捕获的异常。

最广泛使用和理解的约定是具有错误方法回调的委托，或者可能通知您需要通过多个代码级别传递的更一般的故障。如果有一个像 Cocoa 那样设置的简单通知系统，那么这种方法可能会在 Java 世界中得到更广泛的应用。

委托方法与在 Java 中声明异常具有相同的文档属性，它们只是不同的方法，但通常最好使用更适合手头语言的方法，除非有非常令人信服的理由不这样做。

# ios - iphone锁定/解锁时如何暂停/恢复音频

> ID：741567
> 
> 赞同：0
> 
> 时间：2009-04-12T10:22:16.813
> 
> 标签：ios, iphone, avfoundation

这是我的应用程序中当前发生的情况：

锁定：按下 iPhone 锁定按钮 -> 音频暂停
解锁：按下 iPhoneUnlocked 按钮 -> 音频恢复 -> 滑动解锁 -> 应用出现

我希望解锁顺序为：

解锁：按下 iPhone 解锁按钮 -> 滑动解锁 -> 音频恢复 -> 应用出现

我正在使用 OS 2.2.1 和 AVFoundation 框架，这是我已经尝试过的：

*   我尝试使用 AppDelegate 的 applicationWillResignActive 和 applicationDidBecomeActive 回调，它不起作用。虽然 applicationDidBecomeActive 在正确的时间被调用（即当用户滑动解锁设备时），但只要按下解锁按钮，音频就会恢复（我猜这是因为音频会话），所以我尝试了：

*   我实现了 AVAudioPlayerDelegate 的 audioPlayerBeginInterruption 和 audioPlayerEndInterruption 选择器，看起来这些方法永远不会被调用（我已经放置了日志调用）。我确定我正确设置了委托，因为在音频文件完成播放时正确调用了 audioPlayerDidFinishPlaying。

PS：如果这不明显，我正在设备上进行测试

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-11-03T10:03:48.237

他们显然只在音频会话被中断时才被调用，也就是说，如果您正在播放音频并且它被其他请求活动会话的音频中断。简而言之：当电话不活动时他们不会被呼叫，但是当您接到电话时他们会被呼叫。但即便如此，他们也只有在 AVAudioplayer 当时处于活动状态时才会被调用。我还在和那个糟糕的系统搏斗……

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-09-30T21:10:04.577

轻微滥用系统，但您可以观察文件保护通知以了解设备何时解锁。您可以使用它来决定何时再次播放音频。

# ruby-on-rails - Rails 2.3 四级嵌套表单 Javascript 函数

> ID：741576
> 
> 赞同：4
> 
> 时间：2009-04-12T10:29:10.150
> 
> 标签：ruby-on-rails, ruby, forms, nested-forms

我正在使用[此处](http://github.com/alloy/complex-form-examples/tree/master)找到的合金的复杂形式示例。他提供的示例是两级层次结构，我正在尝试将其扩展到四级。

他有用于添加嵌套项目的 javascript 函数。如何扩展四个嵌套层？

```
'.add_nested_item': function(e){
   el = Event.findElement(e);
   template = eval(el.href.replace(/.*#/, ''))
   $(el.rel).insert({    
     bottom: replace_ids(template)
   });
 },
 '.add_nested_item_lvl2': function(e){
   el = Event.findElement(e);
   elements = el.rel.match(/(\w+)/g)
   parent = '.'+elements[0]
   child = '.'+elements[1]

   child_container = el.up(parent).down(child)    
   parent_object_id = el.up(parent).down('input').name.match(/.*\[(\d+)\]/)[1]

   template = eval(el.href.replace(/.*#/, ''))

   template = template.replace(/(attributes[_\]\[]+)\d+/g, "$1"+parent_object_id)

   // console.log(template)
    child_container.insert({     
     bottom: replace_ids(template)
    });
 } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-12T11:32:16.473

如果您需要处理三层层次结构，我认为它有点重载。首先重新考虑你的用户界面。

除此之外-我认为您不需要在控制器中构建关联的对象，因为示例应用程序在视图（app/views/projects/_form.erb）中构建它们（如果需要）：

`<% @project.build_author unless @project.author %> <% project_form.fields_for :author do |author_form| %>`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-24T11:23:11.917

不幸的是，这也不是我真正的专业领域……</p>

让我声明一下，我不会使用 complex-form-examples 中使用的示例进行如此多的嵌套。相反，我会使用常规 DOM API 完全在 JS 中构建所需的表单输入。这应该会给你一个更干净、更精简的实现，并且也可以更好地测试。

干杯，埃洛伊

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-09-08T21:54:40.813

Ryan Bates 使这个解决方案变得简单。与 helmerj 的评论一起使用 Rails 3 :)

[http://railscasts.com/episodes/197-nested-model-form-part-2](http://railscasts.com/episodes/197-nested-model-form-part-2)

helmerj 评论：

对于最新的 Rails3.rc 必须修改一行：

在“模块应用程序助手”中

link_to_function（名称，“add_fields（这个，\“#{association}\”，\“#{escape_javascript（字段）}\”）“）

它删除了不需要的 h() 函数。否则就像魅力一样。

# jsp - JSP 中 Struts2 映射条目的字段名称

> ID：741578
> 
> 赞同：0
> 
> 时间：2009-04-12T10:33:39.437
> 
> 标签：jsp, map, struts2, collections, type-conversion

我想从 JSP 中填充 Struts2 操作的地图属性。我应该使用什么格式的数据名称？最初我对填充 Map<String, String> 感兴趣，但将来我会对填充 Map<String, DomainClass> 感兴趣，其中 DomainClass 具有自己的属性。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-24T15:28:50.300

我有一个动作，其属性如下 -

```
private Map<String,String> assetProps;
...
public Map<String, String> getAssetProps() {
    return assetProps;
}

public void setAssetProps(Map<String, String> assetProps) {
    this.assetProps = assetProps;
} 
```

要将值设置到地图上，基本上有两个步骤。首先，OGNL 不能实例化地图，所以这取决于你。在我的操作中，我实现了 Preparable 接口，但在运行“公共字符串输入（）”方法之前对其进行实例化，如下所示 -

```
public class EditAction extends ActionSupport implements Preparable {
...
    public void prepare() {
        // just satisfying Preparable interface so we can have prepareInput()

    }

    public void prepareInput() throws Exception {
        assetProps = new HashMap<String,String>();
    } 
```

现在，对象是非空的，我可以在 JSP 中使用类似于以下的语法 -

```
 <s:iterator value="asset.properties" var="prop">
    <sjx:textfield name="%{'assetProps[\\'' +#prop.propName +'\\']'}" 
           value="%{#prop.propValue}" 
           label="%{#prop.propName}" size="25"/>
  </s:iterator> 
```

迭代器从堆栈中拉出一组对象并对其进行迭代。重要的部分是“name=”部分，注意双转义的单引号。这样，当页面呈现时，输入元素的名称就变成（例如）-assetProps['Screen Size']。提交页面时，在“public void execute()”方法中，assetProps 已完全填充。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-05-04T13:14:08.907

这是另一个做类似事情的代码片段，以防它帮助某人。

```
<s:iterator value="storageIds" var="sids">
    <s:hidden name="%{'storageIds[\\'' + key +'\\']'}" value="%{#sids.value}"/>
</s:iterator> 
```

我的动作有一个`Map<String,String>`名字`storageIds`

迭代 Map 时，键和值解析为`Map.Entry`属性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-11-15T11:13:27.220

试试这个 。为我完美工作

```
<s:iterator value="configMap" id="daa">
    <s:hidden name="%{'configMap[\\'' + key +'\\']'}" value="%{#daa.value}" />
</s:iterator> 
```

# c# - 如何将 ICSharpCode.ZipLib 与流一起使用？

> ID：741591
> 
> 赞同：4
> 
> 时间：2009-04-12T10:46:24.460
> 
> 标签：c#, byte, sharpziplib, compression

对于保守的标题和我的问题本身，我感到非常抱歉，但我迷路了。

ICsharpCode.ZipLib 提供的示例不包括我正在搜​​索的内容。我想通过将 byte[] 放入 InflaterInputStream(ICSharpCode.SharpZipLib.Zip.Compression.Streams.InflaterInputStream) 来解压缩它

我找到了一个解压功能，但它不起作用。

```
 public static byte[] Decompress(byte[] Bytes)
    {
        ICSharpCode.SharpZipLib.Zip.Compression.Streams.InflaterInputStream stream =
            new ICSharpCode.SharpZipLib.Zip.Compression.Streams.InflaterInputStream(new MemoryStream(Bytes));
        MemoryStream memory = new MemoryStream();
        byte[] writeData = new byte[4096];
        int size;

        while (true)
        {
            size = stream.Read(writeData, 0, writeData.Length);
            if (size > 0)
            {
                memory.Write(writeData, 0, size);
            }
            else break;
        }
        stream.Close();
        return memory.ToArray();
    } 
```

它在 line(size = stream.Read(writeData, 0, writeData.Length);) 处引发异常，说它的标头无效。

我的问题不是如何修复该函数，该函数未随库提供，我只是在谷歌搜索中发现它。我的问题是，如何像使用 InflaterStream 函数一样解压缩，但无一例外。

再次感谢 - 抱歉保守的问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2013-12-12T13:59:23.447

lucene 中的代码非常好。

```
public static byte[] Compress(byte[] input) {
        // Create the compressor with highest level of compression  
        Deflater compressor = new Deflater();
        compressor.SetLevel(Deflater.BEST_COMPRESSION);

        // Give the compressor the data to compress  
        compressor.SetInput(input);
        compressor.Finish();

        /* 
         * Create an expandable byte array to hold the compressed data. 
         * You cannot use an array that's the same size as the orginal because 
         * there is no guarantee that the compressed data will be smaller than 
         * the uncompressed data. 
         */
        MemoryStream bos = new MemoryStream(input.Length);

        // Compress the data  
        byte[] buf = new byte[1024];
        while (!compressor.IsFinished) {
            int count = compressor.Deflate(buf);
            bos.Write(buf, 0, count);
        }

        // Get the compressed data  
        return bos.ToArray();
    }

    public static byte[] Uncompress(byte[] input) {
        Inflater decompressor = new Inflater();
        decompressor.SetInput(input);

        // Create an expandable byte array to hold the decompressed data  
        MemoryStream bos = new MemoryStream(input.Length);

        // Decompress the data  
        byte[] buf = new byte[1024];
        while (!decompressor.IsFinished) {
            int count = decompressor.Inflate(buf);
            bos.Write(buf, 0, count);
        }

        // Get the decompressed data  
        return bos.ToArray();
    } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T11:19:00.670

好吧，听起来数据不合适，否则代码可以正常工作。（诚​​然，我会为流使用“使用”语句而不是`Close`显式调用。）

你从哪里得到你的数据？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-12T11:23:58.630

为什么不使用 System.IO.Compression.DeflateStream 类（从 .Net 2.0 开始可用）？这使用相同的压缩/解压缩方法，但不需要额外的库依赖。

从 .Net 2.0 开始，如果您需要文件容器支持，您只需要 ICSharpCode.ZipLib。

# asp.net-mvc - 更改 asp.net MVC 中的默认模型绑定器

> ID：741594
> 
> 赞同：34
> 
> 时间：2009-04-12T10:53:56.347
> 
> 标签：asp.net-mvc

有什么方法可以将默认的 ModelBinder 设置为我自己的？

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2009-04-12T11:01:26.500

```
ModelBinders.Binders.DefaultBinder = new MyOwnModelBinder(); 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2019-07-05T21:15:51.557

在*Global.asax.cs*中：

```
public class MvcApplication : System.Web.HttpApplication
    {
        protected void Application_Start()
        {
            //...
            ModelBinders.Binders.DefaultBinder = new MyModelBinder();
        }

    } 
```

# c++ - 使用模板参数中定义的类型

> ID：741597
> 
> 赞同：1
> 
> 时间：2009-04-12T10:56:09.693
> 
> 标签：c++, templates

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-12T11:02:42.330

您缺少必需的 typename 关键字：

```
typedef typename container::value_type elementtype; 
```

这是因为在这个模板中`container`是一个*依赖名称*，所以编译器无法知道 container::value_type 是否总是一个类型，因为它可能取决于`container`.

这个问题肯定是某个地方的常见问题解答吗？

编辑，它是： http: [//www.parashift.com/c++-faq-lite/templates.html#faq-35.18](http://www.parashift.com/c++-faq-lite/templates.html#faq-35.18)

# asp.net - ASP.net Web Resources vs. Images

> ID：741598
> 
> 赞同：4
> 
> 时间：2009-04-12T10:56:16.310
> 
> 标签：asp.net

Okay, so ASP.net allows one to embed Images into an Assembly and access them using WebResource.axd.

I just wonder: What are the Pros/Cons of using Web Resources instead of Images in a folder on the Web Server, like how it's being traditionally done?

[This article](http://www.4guysfromrolla.com/articles/080906-1.aspx) mainly mentions ease of deployment, but that doesn't seem to justify the extra amount of work.

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-12T11:47:02.397

一个明显的场景是：第三方控制。

我真的不想为我们没有开发的控件处理不同的脚本/图像文件。对于嵌入式资源，它只是 .dll 文件，仅此而已:)。

如果您正在开发将在不同网站上使用的自定义 Web 控件，这同样适用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T11:57:31.077

我构建了由同一台机器上的三个不同应用程序使用的自定义控件。当我维护控件的脚本时，我可能会忘记将新的脚本文件部署到每个应用程序。

在这种情况下，最好将资源嵌入到程序集中并将程序集部署到 GAC。

但是关于外部文件（不嵌入资源）的好处是，有时您会意识到脚本文件中的错误。在不重置应用程序的情况下部署它在在线应用程序中是一件好事。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-12T12:59:17.980

这是我认为最好的规则，如果你有不会经常改变的资源，比如脚本、图像。那么你最好将它们嵌入资源中。

但是，如果您有资源，可以更改 Jquery 之类的版本，那么您应该创建属性以指向这些外部资源。

希望这可以帮助

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-12T11:32:30.683

对我来说，这只是 ASP.NET 中添加的另一个非杀手级功能。我不认为它是在考虑提供大量内容的情况下实现的，但有时增加部署的便利性很重要，那么您会获得一些好处。问题是什么时候？

微软表示他们将其用于例如。提供表单验证脚本，并且由于缓存它不应该影响性能。这为控件及其脚本创建了隔离，因此您在将它们添加到您的站点时不必自己担心它们。

所以对我来说，如果您认为它可以帮助您部署用户/服务器控件，您可以尝试。一般用于提供图像？我不会打扰。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-12T11:46:16.033

我不会将图像放入程序集中。这只是太多的工作，没有明显的好处。它更快吗？可能不会调用类似反射的速度来获取资源。是不是更难维护，你敢打赌！

例如，当企业想要更新徽标时，为什么需要高端开发人员？

# google-app-engine - How do you upload data in bulk to Google App Engine Datastore?

> ID：741599
> 
> 赞同：5
> 
> 时间：2009-04-12T10:56:21.910
> 
> 标签：google-app-engine, upload, bulk, google-cloud-datastore

I have about 4000 records that I need to upload to Datastore.

They are currently in CSV format. I'd appreciate if someone would point me to or explain how to upload data in bulk to GAE.

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-12T11:29:27.710

您可以使用[bulkloader.py](http://code.google.com/appengine/docs/python/tools/uploadingdata.html)工具：

> Python SDK 附带的 bulkloader.py 工具可以将数据上传到应用程序的数据存储区。只需进行一点设置，您就可以从 CSV 文件创建新的数据存储实体。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-03T10:48:15.793

我没有完美的解决方案，但我建议您使用[App Engine Console](http://con.appspot.com)。App Engine Console 是一个免费插件，可让您在生产环境中运行交互式 Python 解释器。由于以下几个原因，它有助于一次性数据操作（例如初始数据导入）：

1.  这是老式的 read-eval-print 解释器。您可以一次做一件事情，而不必一次编写完美的导入代码并批量运行它。
2.  您可以交互式访问自己的数据模型，因此您可以从数据存储中读取/更新/删除对象。
3.  您可以交互式访问 URL Fetch API，因此您可以逐个提取数据。

我建议如下：

1.  让您的数据模型在您的开发环境中工作
2.  将您的 CSV 记录拆分为少于 1,000 条的块。将它们发布到 Amazon S3 或任何其他 URL 之类的地方。
3.  在您的项目中安装 App Engine 控制台并将其推送到生产环境
4.  登录控制台。（只有管理员可以使用控制台，所以您应该是安全的。您甚至可以将其配置为返回 HTTP 404 以“隐藏”未经授权的用户。）
5.  对于 CSV 的每一块：
    1.  使用 URLFetch 拉取一大块数据
    2.  使用内置`csv`模块来分割你的数据，直到你有一个有用的数据结构列表（很可能是一个列表列表或类似的东西）
    3.  编写一个`for`循环，遍历列表中的每个数据结构：
        1.  创建具有所有正确属性的数据对象
        2.  put() 将其放入数据存储中

您应该会发现，在通过#5 的一次迭代之后，您可以复制和粘贴，或者编写简单的函数来加快您的导入任务。此外，通过在步骤 5.1 和 5.2 中获取和处理您的数据，您可以慢慢来，直到您确定自己拥有完美的数据。

（*注意，App Engine 控制台目前最适合 Firefox。*）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-02-02T19:44:03.863

通过对多个实体使用远程 API 和操作。我将展示一个使用 python 的 NDB 示例，其中我们的 Test.csv 包含以下用分号分隔的值：

```
1;2;3;4
5;6;7;8 
```

首先我们需要导入模块：

```
import csv
from TestData import TestData
from google.appengine.ext import ndb
from google.appengine.ext.remote_api import remote_api_stub 
```

然后我们需要创建远程 api 存根：

```
remote_api_stub.ConfigureRemoteApi(None, '/_ah/remote_api', auth_func, 'your-app-id.appspot.com') 
```

有关使用远程 api 的更多信息，请查看[此答案](https://stackoverflow.com/a/14439758/535661)。

然后是主要代码，它基本上做了以下事情：

1.  打开 Test.csv 文件。
2.  设置分隔符。我们使用分号。
3.  然后，您有两个不同的选项来创建实体列表：
    4.  使用 map reduce 函数。
    5.  使用列表理解。
4.  最后，您批量放置整个实体列表。

主要代码：

```
# Open csv file for reading.
with open('Test.csv', 'rb') as file:
    # Set delimiter.
    reader = csv.reader(file, delimiter=';')

    # Reduce 2D list into 1D list and then map every element into entity.
    test_data_list = map(lambda number: TestData(number=int(number)),
            reduce(lambda list, row: list+row, reader)
        )

    # Or you can use list comprehension.
    test_data_list = [TestData(number=int(number)) for row in reader for number in row]

    # Batch put whole list into HRD.
    ndb.put_multi(test_data_list) 
```

put_multi 操作还负责确保在单个 HTTP POST 请求中批处理适当数量的实体。

查看此文档以获取更多信息：

*   [CSV文件读写](http://docs.python.org/2/library/csv.html#module-csv)
*   [在本地客户端中使用远程 API](https://developers.google.com/appengine/docs/python/tools/remoteapi#Using_Remote_API_in_a_Local_Client)
*   [对多个键或实体的操作](https://developers.google.com/appengine/docs/python/ndb/entities#multiple)
*   [NDB 函数](https://developers.google.com/appengine/docs/python/ndb/functions)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-04T06:21:12.710

后期版本的app engine sdk，可以使用appcfg.py上传

见[appcfg.py](http://code.google.com/appengine/docs/python/tools/uploadingdata.html "appcfg.py")

# iphone - 删除应用程序中的状态栏是一个坏主意吗？

> ID：741608
> 
> 赞同：6
> 
> 时间：2009-04-12T11:04:32.997
> 
> 标签：iphone

我不确定，但我猜：

*   如果您制作游戏，则没有状态栏。只是看起来不太好。

*   如果您有一个应用程序，请将状态栏留在原处。可能有用。

Apple 是否有任何指导方针何时或何时不删除状态栏？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-12T11:38:06.333

查看 Apple 的“iPhone 人机界面指南”第 66 页，他们说：“虽然全屏、沉浸式应用程序可以隐藏状态栏，但您应该仔细考虑这一设计决策的后果。人们希望能够看到当前他们设备的电池充电；隐藏此信息并要求用户退出您的应用程序才能获得它，这不是理想的用户体验。”

建议很明确：不要这样做:)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-12T12:48:03.247

如果您的应用程序是身临其境的（如其他人所说的游戏或视频应用程序），那么您可能更喜欢隐藏状态栏 - 这就是该选项的用途。否则这不是一个好主意。

然而，需要注意的一件事（至少就我所发现的而言）是，如果您隐藏状态栏，模拟器似乎不会让您点击原本应该存在的区域。如果您想将自己的控件放在那里，这可能是个问题。在设备上它工作得很好（在我的应用程序中，如果它是为 sim 构建的，我必须有条件代码来取消隐藏状态栏）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-12T11:43:14.807

想想您的台式机/笔记本电脑上有多少应用程序全屏显示并隐藏所有内容 - 不多。如果您正在制作游戏或正在播放视频（例如内置的 youtube 客户端），请隐藏状态栏。否则，不要。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-12T11:43:34.213

隐藏状态栏应该是例外而不是规则。如果您的应用需要全屏（游戏等），则在游戏模式期间隐藏状态栏并在设置、启动、主屏幕等期间显示。

# postgresql - PostgreSQL 函数选择*

> ID：741616
> 
> 赞同：2
> 
> 时间：2009-04-12T11:11:05.447
> 
> 标签：postgresql, stored-procedures

我该如何使用：

```
select * from <some_table>; 
```

在`FUNCTION`Postgres 中？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-12T13:49:38.263

```
CREATE OR REPLACE FUNCTION  my_function() RETURNS INTEGER AS '
   DECLARE
      your_record your_table%ROWTYPE;
   BEGIN

      FOR your_record IN SELECT * FROM your_table  
      LOOP

      --
      -- You can access fields of your table using .
      --    your_record.your_field
        ...
      END LOOP;

   END;
' LANGUAGE 'plpgsql'
STABLE; 
```

或者

```
CREATE OR REPLACE FUNCTION  my_function() RETURNS INTEGER AS '
   DECLARE
      your_record your_table%ROWTYPE;
   BEGIN

      SELECT * INTO your_record FROM your_table;

      --
      -- You can access fields of your table using .
      --    your_record.your_field

   END;
' LANGUAGE 'plpgsql'
STABLE; 
```

* * *

编辑：

使用 join 返回记录：

```
CREATE OR REPLACE FUNCTION  my_function() RETURNS SETOF record AS '
   DECLARE
      your_record record;
   BEGIN
      --
      -- You should specify a list of fields instead of *
      --
      FOR your_record IN SELECT * FROM your_table INNER JOIN ...           
         RETURN NEXT your_record;
      END LOOP;
   END;
' LANGUAGE 'plpgsql'
STABLE; 
```

要使用 my_function()，您必须指定字段和数据类型： [请参阅此处的详细信息](https://stackoverflow.com/questions/742180/postgres-functions)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-05-22T21:31:53.863

有一个smipler方法，如果要在函数中使用SQL，在函数中使用SQL语言：

```
CREATE FUNCTION getallzipcodes() 
RETURNS SETOF zip AS
$BODY$
     SELECT * FROM zip;
$BODY$ 
LANGUAGE 'sql'; 
```

这也可能有用（如何调用函数）

```
SELECT function_returning_setof(); -- Wrong!  
SELECT * FROM function_returning_setof(); -- OK!  
SELECT function_returning_scalar(); -- OK 
```

[参考](http://wischner.blogspot.com.ar/2009/03/creating-stored-procedure-function.html)

# java - 将摆动控制分成相等的部分

> ID：741619
> 
> 赞同：0
> 
> 时间：2009-04-12T11:16:06.153
> 
> 标签：java, swing

我知道这将是一个愚蠢的问题。请原谅我是 CS 的 n00b

我有一个继承自 JComponent 的新 swing 组件。我试图在其表面上绘制线条以显示线条将控件分成相等的部分。代码看起来像

```
int spc;
spc = (int) Math.round((this.ZBar.getWidth() / this.ZBar.getModel().getModelSize()));

        for (int i = 0; i <= this.ZBar.getModel().getModelSize(); i++) {
            g.drawLine(i * spcing, 0, i *, this.ZBar.getHeight());

        } 
```

this.ZBar.getModel().getModelSize(); 给出要拆分的部分数量。但是，在某些情况下，我的组件的最右端还有更多空间。我想这与 Math.round 完成的类型转换有关。我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-12T12:29:40.733

这是因为该除法是 int 类型的除法。例如：

```
5 / 2 == 2 
```

Math.round 在这里什么也不做。它已经被四舍五入（作为 Math.floor 代替）。

为了获得您想要的效果，在除法之前将 int 转换为双精度：

```
(double)5 / 2 == 2.5 
```

或者在您的特定情况下：

```
spc = (int) Math.round(((double)this.ZBar.getWidth() / this.ZBar.getModel().getModelSize())); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T12:27:47.960

由于语法错误，您发布的代码将无法编译，但我认为您的方法没有直接问题。你说问题是间歇性出现的。这表明问题可能在于 swing 刷新的方式，以及你如何在代码中处理它。尝试阅读。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T04:13:22.243

非常感谢你的答复。解决了这个问题。

我已经把所有这些整数弄得一团糟。然后使用 Java2D 包来处理双打。

Line2D 类支持使用双参数创建。

# user-interface - ListView (MFC) 中的列选择

> ID：741623
> 
> 赞同：1
> 
> 时间：2009-04-12T11:21:14.160
> 
> 标签：user-interface, mfc, listview, controls

我想在 ListView 中选择一个特定的列。当我搜索它时，我总是找到仅按行选择的方法。知道我该怎么做吗？另外我如何获得选定的列索引？

使用 MFC-VS2005。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-14T11:45:07.047

我正在维护一个已移植到 VS 2005 的 VS6.0 应用程序，并且 SetSelectedColumn 在 CListCtrl 中不可用，除非 _WIN32_WINNT >= 0x0501。我的是 0x400，起初我不明白为什么使用 SetSelectedColumn 会导致编译器错误。有关详细信息，请参见 commctrl.h

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T16:41:46.430

有一个 CListCtrl::SetSelectedColumn() 方法看起来像你想要的那样：它将 LVM_SETSELECTEDCOLUMN 消息发布到列表视图控件。

同样，CListCtrl::GetSelectedColumn() 获取选定的列。

# stored-procedures - 如果存储过程中有多个选择语句，如何使用 SqlDataReader

> ID：741625
> 
> 赞同：7
> 
> 时间：2009-04-12T11:23:14.997
> 
> 标签：stored-procedures, sqldatareader, multiple-select

我在 Microsoft SQL Server 2005 的存储过程中编写了三个 select 语句。两个 select 语句都返回多条记录，并且 select 语句的表列表不同。一个从主表中选择记录，另一个从子表中选择记录。在 C# 代码中，我想获取所有这些记录并将所有数据放在一个对象中。我正在使用 SqlDataReader。有可能还是我应该做其他事情。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-12T11:28:16.140

您可以在数据读取器上使用[NextResult](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqldatareader.nextresult(VS.80).aspx)方法来浏览来自查询的多个结果。

要遍历所有数据，您可以执行以下操作：

```
var moreResults = true;
while (moreResults)
{
    while (reader.Read())
    {
    ...
    }
    moreResults = reader.NextResult();
} 
```

因此，以此为背景，并假设主结果集首先出现，填充主对象和细节对象可以像这样完成：

首先，建立一个 Master 记录的字典：

```
var masters = new Dictionary<int, Master>();

var idOrdinal = reader.GetOrdinal("id");
while (reader.Read())
{
    var id = reader.GetInt32(idOrdinal);
    masters.Add(id, new Master{Id=id, ....});
} 
```

接下来，继续详细记录并将其添加到相应的主记录中：

```
reader.NextResult();

var masterIdOrdinal = reader.GetOrdinal("masterId");
while (reader.Read())
{
    var masterId = reader.GetInt32(masterIdOrdinal);

    var master = masters[masterId];
    master.Details.Add(new Detail{....});
} 
```

您显然应该用数据中的内容替换列名，并提供 Master 和 Detail 对象的完整初始化。如果详细结果集按主 ID 排序，则可以优化最后一个循环以仅从字典中查找每个主控一次。如果结果集很小，那么收益不会那么大。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-12T12:35:37.427

> ...从主表中选择记录，从子表中选择其他记录。在 C# 代码中，我想获取所有这些记录并将所有这些数据放在一个对象中...

Peter 的解决方案旨在解决使用单个`DataReader`. 但是，如果要将数据保存到复制 Master-Details 表之间关系的对象中，则应该使用 a `DataSet`。

DataSet 可以包含多个s，并通过允许在表之间创建s 来为表`DataTable`之间的固有关系提供完全支持。然后，您可以分别通过调用或从 Master 或 Details 表`DataRelation`中获取每个场景的相关记录。`GetChildRows()``GetParentRows()`

网上可能有很多示例说明了如何执行此操作。[这是我的小组的一个讨论线程](http://groups.google.com/group/DotNetDevelopment/browse_thread/thread/8a39f0ad30b8a2d7/)，其中我列出了步骤并提供了一些代码来演示该过程。

# jquery - 如何覆盖 jquery 事件处理程序

> ID：741628
> 
> 赞同：75
> 
> 时间：2009-04-12T11:25:35.927
> 
> 标签：jquery, event-handling

我将尝试用一个简单的代码来解释这个问题。

```
var fireClick = function() { alert('Wuala!!!') };

$('#clickme').click(fireclick);
$('#clickme').click(fireclick); 
```

所以现在它显然会提醒 2 次，但我只需要提醒一次。尝试了很多方法，但没有结果。

谢谢。

* * *

## 回答 #1

> 赞同：140
> 
> 时间：2009-04-12T11:29:20.113

从 jQuery 1.7 开始，您应该使用[off](http://api.jquery.com/off)来删除事件处理程序并[使用 on](http://api.jquery.com/on)来添加它们，尽管您仍然可以使用`click`简写。

```
$('#clickme').off('click').on('click', fireclick);
$('#clickme').off().on('click', fireclick); 
```

原答案：

如果要替换所有单击处理程序，请先调用[unbind](http://docs.jquery.com/Events/unbind#typefn)而不使用函数参数。如果要替换所有事件处理程序，请不要指定事件类型。

```
$('#clickme').unbind('click').click(fireclick);
$('#clickme').unbind().click(fireclick); 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2014-10-22T09:49:15.617

使用命名空间确保不删除任何其他侦听器：

```
$('#clickme').off('click.XXX').on('click.XXX', fireclick); 
```

只要没有其他代码使用`XXX`，您就可以确定您没有搞砸一些您不知道的其他行为。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-04-12T11:30:58.440

您可以使用 jQuery 函数[unbind](http://docs.jquery.com/Events/unbind)删除第一个事件：

```
var fireClick = function() { alert('Wuala!!!') };

$('#clickme').click(fireclick);
$('#clickme').unbind('click', fireClick); // fireClick won't fire anymore...
$('#clickme').click(fireclick); // ...but now it will 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-12T11:30:39.813

我会尝试消除额外的调用，但如果没有 tyhat，你可以确保每次都调用这两个：

```
$('#clickme').unbind('click', fireclick);
$('#clickme').click(fireclick); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2020-05-28T14:45:53.083

```
$(document).off('click', '#clickme').on('click', '#clickme', fireclick); 
```

* * *

## 回答 #6

> 赞同：-11
> 
> 时间：2012-03-08T23:37:48.703

您应该使用 setInterval。问题是您不能同时弹出两个警报。第一个必须先关闭，否则第二个不能出现在屏幕上......

# iphone - URL 类型和 URL 方案有什么区别？

> ID：741629
> 
> 赞同：1
> 
> 时间：2009-04-12T11:25:43.040
> 
> 标签：iphone

有人对此有很好的解释吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-12T11:49:43.793

他们是一样的。

但它们可能意味着不同的东西：

例如，iTunes`itms://`在实际上使用 HTTP 作为传输协议时使用了该方案，因此您可以替换`itms`为`http`并获得相同的结果。同样，`feed://`通常用于 RSS 提要，但底层传输协议仍然是 HTTP。

因此`itms`，`feed`严格意义上来说，并不是 URL 方案。它们的唯一目的是触发特殊应用程序（iTunes 或 RSS 阅读器）。

我想 Type 和 Scheme 可以用来区分对应于传输协议的方案和不对应的方案。

你能指出一个让你相信它们是不同事物的特定资源吗？

# .net - 是否有工具可以找出 PC 上安装了哪个 .NET 框架？

> ID：741632
> 
> 赞同：5
> 
> 时间：2009-04-12T11:29:14.030
> 
> 标签：.net

我知道官方的方式是注册表，但这有点费时。

我必须检查几台 PC 上已安装的版本，它们都没有 VisualStudio，但它们（可能）都是 .NET 框架*的*版本。

由于热水可能已经存在，我在哪里可以找到它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-12T11:41:21.303

1.  尝试使用浏览器的用户代理的 minimumdotnet 的主页，[以](http://www.hanselman.com/smallestdotnet/)检查您拥有的 .net 版本。
2.  转到 \Windows\Microsoft.NET\Framework\ 您将看到您拥有的所有版本。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-12T12:51:13.663

这是一个免费的轻量级工具，可以快速完成 - [.NET 版本检测器 2007](http://www.asoft.be/prod_netver.html)

如果您想手动执行此操作，[此页面](http://www.walkernews.net/2008/05/16/how-to-check-net-framework-version-installed/)显示了 4-5 种执行此操作的好方法。[MS 支持页面](http://msdn.microsoft.com/en-us/kb/kb00318785.aspx)提供了一种简单的方法，只需打开 Framework 文件夹并检查安装的版本（文件夹名称）！

但是，如果您想以编程方式执行此操作，则`HttpBrowserCapabilities`该类提供了`GetClrVersions()`一种可通过`Request.Browser.GetClrVersions()`调用访问的方法。当然，正如其他人所提到的，您也可以随时通过 Javascript 查询浏览器的 Navigator.UserAgent 属性（我认为这只会在 IE 中向您显示 .NET 版本）：

```
javascript:alert(navigator.userAgent) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-12T13:41:26.630

我在编写 PowerShell 脚本时经常遇到这个问题。我发现最好的方法是在以下每个基本目录中运行以下检查

*   %WINDIR%\Microsoft.Net\Framework
*   %WINDIR%\Microsoft.Net\Framework64

不要忘记第二个目录，否则您的应用程序可能会在 64 位机器上中断。

对于每个起点，我都会查找匹配的目录`v\d+\\.\d+\\.\d+`并包含文件 mscorlib.dll。仅查找目录名称是不够的，因为名称可能存在而实际上没有安装该版本的框架。例如，如果你有一台 vista 机器，你也会有 v1.0.3705 和 v1.1.4322，但实际上都没有安装这些框架。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-12T11:40:38.590

看看[SmallestDotNet](http://www.hanselman.com/smallestdotnet/)的 javascript 。[CodeProject](http://www.codeproject.com/KB/dotnet/frameworkversiondetection.aspx)上也有一篇很好的文章。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-12T12:52:12.707

这是您可以放入 ASP.net 站点或 winforms 的代码

```
 using System;
using System.Collections.Generic;
using System.Text;
using System.Runtime.InteropServices;

namespace ConsoleApplication1
{
class Program
{
[DllImport("mscoree.dll")]
private static extern int GetCORSystemDirectory(
[MarshalAs(UnmanagedType.LPWStr)]StringBuilder pbuffer,
int cchBuffer, ref int dwlength);

static void Main(string[] args)
{
GetClrInstallationDirectory();
}

private static void GetClrInstallationDirectory()
{
int MAX_PATH = 260;
StringBuilder sb = new StringBuilder(MAX_PATH);
GetCORSystemDirectory(sb, MAX_PATH, ref MAX_PATH);
Console.WriteLine(sb.ToString());
while(Console.Read() != 'q') ;
}

}
} 
```

# c# - 更改在 c# 中传递给应用程序的 ExtendedTemplate 字段

> ID：741642
> 
> 赞同：0
> 
> 时间：2009-04-12T11:34:21.320
> 
> 标签：c#, asp.net

我在哪里更改此元素？它说 mmcs: 但我需要它说 afghan: 我正在尝试更改它，以便它作为 EventLabel 通过应用程序传播。我一直试图在 .aspx 文档中更改它，但它必须来自某个地方的控制文件，因为它似乎必须在我重新编译应用程序时产生影响。任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-13T04:03:34.030

目前还不是很清楚你在问什么，但听起来你可能想检查`<pages><controls>`你的 web.config 文件的部分......请参阅[http://msdn.microsoft.com/en-us/library /ms164640.aspx](http://msdn.microsoft.com/en-us/library/ms164640.aspx)了解更多信息。

# delphi - 在 Vista 中捕获隐藏的窗口

> ID：741643
> 
> 赞同：0
> 
> 时间：2009-04-12T11:35:14.327
> 
> 标签：delphi, windows-vista, screen-capture

我对 Vista 的理解是，每个窗口都有自己的屏幕缓冲区，然后将其进行 alpha 混合等以创建屏幕。

那么，有没有办法通过直接读取这些缓冲区来截取一个被遮挡或部分不在屏幕上的窗口？当您 alt-tab 或将鼠标悬停在任务栏上时，Vista 会执行此操作。

我在 Delphi 中这样做，但任何语言的代码都足够了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T11:53:34.970

我相信当这些窗口不在屏幕上时，这些缓冲区不存在。或者在部分离屏时仅部分存在。

如果您注意窗口缩略图，您会发现当这些窗口最小化或离屏时它不会更新。WM_PAINT 将在窗口从屏幕外拖动到打开时触发，再次表明此数据尚未缓冲在某处。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-14T04:27:04.513

你考虑过挂钩 wm_paint 消息吗？《Windows图形编程：Win32 GDI与DirectDraw》作者冯远为此制作了示例dll。我认为通过这种方式也可以捕获 DirectXed 窗口（随时都有缓冲屏幕）。请参考[http://www.fengyuan.com/article/wmprint.html](http://www.fengyuan.com/article/wmprint.html) 你可以通过谷歌找到工作的德尔福例子。还要检查 expterts-exchange.com

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T07:54:34.503

我认为新的 DWM APi（桌面 Windows 管理器）中可能有一些东西，它可以让您编写和安装自定义桌面管理器，并可以访问您在 Flip3d 和其他视图中看到的相同缩略图。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-12T13:05:55.733

这是我很久以前用 C# 为屏幕捕获应用程序编写的一些代码。它使用 Win32 函数 GetWindowRect 来获取要捕获的窗口的边界，创建具有该大小的位图，然后使用 Win32 函数 PrintWindow 要求窗口将自身打印到该位图：

```
RECT lRectangle = new RECT();
if (!GetWindowRect(lWindow.HWnd, ref lRectangle))
{
    MessageBox.Show(this, "An error occured while measuring the selected window.", Text, MessageBoxButtons.OK, MessageBoxIcon.Error);
    return;
}

fCapturedImage = new Bitmap(lRectangle.Right - lRectangle.Left, lRectangle.Bottom - lRectangle.Top, PixelFormat.Format32bppArgb);
using (Graphics lGraphics = Graphics.FromImage(fCapturedImage))
{
    HDC lHdc = lGraphics.GetHdc();
    PrintWindow(lWindow.HWnd, lHdc, 0);
    lGraphics.ReleaseHdc(lHdc);
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-13T03:39:48.660

在这个线程中有什么有用的吗？：[http ://www.eggheadcafe.com/conversation.aspx?messageid=31543575&threadid=31543575](http://www.eggheadcafe.com/conversation.aspx?messageid=31543575&threadid=31543575)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-07T22:36:35.387

这样做 (C#)

```
 public static Bitmap PrintWindow(IntPtr hwnd)
    {
        RECT rc;
        WinUserApi.GetWindowRect(hwnd, out rc);

        Bitmap bmp = new Bitmap(rc.Width, rc.Height, PixelFormat.Format32bppArgb);
        Graphics gfxBmp = Graphics.FromImage(bmp);
        IntPtr hdcBitmap = gfxBmp.GetHdc();
        bool succeeded = WinUserApi.PrintWindow(hwnd, hdcBitmap, 0);
        gfxBmp.ReleaseHdc(hdcBitmap);
        if (!succeeded)
        {
            gfxBmp.FillRectangle(new SolidBrush(Color.Gray), new Rectangle(Point.Empty, bmp.Size));
        }
        IntPtr hRgn = WinGdiApi.CreateRectRgn(0, 0, 0, 0);
        WinUserApi.GetWindowRgn(hwnd, hRgn);
        Region region = Region.FromHrgn(hRgn);
        if (!region.IsEmpty(gfxBmp))
        {
            gfxBmp.ExcludeClip(region);
            gfxBmp.Clear(Color.Transparent);
        }
        gfxBmp.Dispose();
        return bmp;
    } 
```

# windows - Tortoise SVN 如何存储存储库文件？

> ID：741652
> 
> 赞同：0
> 
> 时间：2009-04-12T11:45:21.747
> 
> 标签：windows, svn, version-control, tortoisesvn

有人告诉我，Microsoft Windows 上最好的 SVN 客户端是 Tortoise SVN。

但是，当我安装它时，只会将项目添加到我的外壳中，即单击文件夹时的右键单击选项。

当我尝试签出一个文件夹时，它会尝试在我正在处理的文件夹中创建一个存储库。

我希望我的存储库不在我的工作范围内。这可能吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-12T12:04:59.450

[Ollifant 的回答](https://stackoverflow.com/questions/741652/how-does-tortoise-svn-work/741664#741664)是正确的，但是当您即将创建第一个存储库时，我只想添加 file:// 根本不是在生产环境中访问存储库的推荐方法。事实上，根据[svn 书](http://svnbook.red-bean.com/nightly/en/)，它根本不应该被视为一种选择：

> 不要被让所有用户直接通过 file:// URL 访问存储库的简单想法所诱惑。即使每个人都可以通过网络共享随时使用存储库，这也是一个坏主意。它消除了用户和存储库之间的任何保护层：用户可能意外（或故意）损坏存储库数据库，使存储库脱机以进行检查或升级变得困难，并且可能导致文件权限问题混乱（请参阅名为“支持多种存储库访问方法”的部分）。请注意，这也是我们警告不要通过 svn+ssh:// URL 访问存储库的原因之一——从安全角度来看，它实际上与本地用户通过 file:// 访问相同，

svnserve 几乎总是比 file:// 访问更好，而且几乎不需要额外的设置。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-12T11:55:04.747

创建存储库和使用它是两件不同的事情。

“在此处创建存储库”操作创建一个存储库，您可以通过 file://.. 语法或通过 svnserve 守护程序在本地访问该存储库。

“结帐”操作可以在任何其他地方进行。您可以使用本地存储库，通过 http(s) 或 svnserve 访问存储库。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T12:10:51.730

如果您尝试运行自己的 SVN 服务器，然后可以将文件签入，请尝试[VisualSVN](http://www.visualsvn.com/server/download/)。我将它与 Tortoise 和 AnkSVN（全部免费）一起使用，效果很好。

# asp.net-mvc - 使用 MVC 防止 URL 操纵攻击？

> ID：741653
> 
> 赞同：11
> 
> 时间：2009-04-12T11:45:28.750
> 
> 标签：asp.net-mvc, security, url

有什么好的策略、代码片段等来防止 URL 操纵？

例如，我有这个 url，`http://localhost/profile/edit/5`id 可以很容易地更改为任何内容，因此人们可以编辑他们不应该的配置文件。

以下是我想到的一些想法，但它们都有缺点：

1.  更改我的系统以使用 GUID 主键 - 几乎不可能猜到键 - 但人们仍然可以从应用程序的一个部分获取 GUID 并稍后在另一个 url 中使用它。

2.  使用 TempData 存储密钥 - 防止 url 在以后被发送\使用。

3.  在显示页面之前在控制器中执行检查 - 意味着您必须在任何地方执行“管理”代码来检查操作。

最好的办法是什么？其中之一还是其​​他？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-12T11:49:11.253

3号是正确的做法。服务器端安全验证始终是您所需要的，因为这是您完全控制并且可以依赖的机制。

第一是默默无闻的安全性，如果有人不小心在某处发布了他的 URL（就像人们在复制/粘贴链接时经常使用 Session-ID 一样），您的“安全性”就会被破坏。

2 号似乎是一个弱安全性 - 如果你经历了麻烦，最好实施适当的安全性。这也允许人们为页面添加书签。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-12T12:13:22.223

我使用自定义授权过滤器来实现基于角色和所有者的访问控制。标准 AuthorizationFilter 将允许您指定可以访问操作的命名角色或用户。我对此进行了扩展，以允许您指定当前用户如果是数据的“所有者”则可以访问。我有两个额外的过滤器，RoleOrOwnerAuthorizationFilter 和 RoleOrOwnerAssociatedAuthorizationFilter。第一个检查`id`在 RouteData 中传递的可配置参数（通常）是我的 users 表中当前用户的 id，或者当前用户是否处于任何列出的角色中。如果是，则检查成功，如果不是，则返回授权错误视图。

第二个允许我指定一个连接表和参数，用于将 RouteData 中的参数与连接表中的列相关联，并将当前用户与连接表中的另一列相关联。如果有一个条目既匹配参数值又匹配用户，我断定用户与数据相关并且可以访问。如果您处于指定角色，它还允许访问。在这三个不同的属性之间，我几乎满足了所有访问控制需求，这意味着我只需使用适当配置的属性进行装饰即可应用安全性。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-12T12:04:23.557

你不应该让你的 URL “防篡改”来保护底层功能。此外：大多数网站使 URL 更具可读性`http://stackoverflow.com/questions/741653/preventing-url-manipulation-attacks-with-mvc`，例如 - 混淆将是一个倒退。

而是检查控制器中的权限，如果不允许用户编辑配置文件 6，则引发异常。如果您不想在任何地方都有“检查”，也许您可​​以将它们放入`ActionFilter`，或创建一些帮助方法，例如`CurrentUser.FindProfileToEditById(profileId)`（如果不允许该操作，则会引发异常）而不是`Profile.FindById(id)`.

如果您想要一个没有“当前用户”的通用服务，您可能会使用 GUID（例如 Doodle 也是如此） - 但这总是会以各种方式构成安全威胁（Facebook 的照片存在这个问题-专辑）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-12T12:02:22.377

用于访问您的站点的 url 是来自客户端的数据，当考虑到安全性时，您应该始终认为客户端提供的数据是恶意的。

不幸的是，没有灵丹妙药可以解决这个问题。您需要在整个应用程序中实施访问限制。

# vb.net - VB.NET：从第二种形式中检索值的最佳方法是什么？

> ID：741663
> 
> 赞同：3
> 
> 时间：2009-04-12T11:54:53.190
> 
> 标签：vb.net, show, showdialog

我正在自学VB.Net。

这是我最近遇到的一个问题。假设我的应用程序中有一个主 Form1。Form1 调用第二个 LoginForm（正如其名称所暗示的那样）是一个带有用户名/密码类型字段的登录窗口。预期的行为是 LoginForm 将捕获登录详细信息并将其传递回 Form1。

做这个的最好方式是什么？

在我的脑海中，我在思考像“doLogin”这样的函数调用，它会“显示”LoginForm、捕获输入的数据、处理表单并返回登录详细信息（可能在某种 bean 中）。不知何故，我不认为这是可能的

我目前拥有的不太优雅。LoginForm由Form1模态显示（即showDialog）；'me' 引用被传递到第二个窗口。在 LoginForm 上收到用户输入后，我在 Form1 上设置一个值，然后处理。

每个人都这样吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T12:01:21.927

虽然这是在 C# 中，但很容易转换：[C# 初学者帮助，如何将值从子窗体传递回父窗体？](https://stackoverflow.com/questions/280579/c-beginner-help-how-do-i-pass-a-value-from-a-child-back-to-the-parent-form/280586)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T12:01:18.320

我总是将一个委托传递给第二种形式，可以调用它来将第二种形式的值“传回”到第一种形式。

这样，您就可以避免任何紧密耦合。

经典的观察者模式。

* * *

一个示例实现如下：

将委托签名添加到 Form1。在 Form1 的按钮单击事件处理程序中，实例化 Form2 类和 Form1 的委托。给委托分配一个Form2的函数，调用委托：

```
'Form1.vb
Public Delegate Sub delPassData(ByVal text As TextBox)

Private Sub btnSend_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnSend.Click
  Dim frm As Form2 = New Form2
  Dim del As delPassData = New delPassData(AddressOf frm.funData)
  del(Me.textBox1)
  frm.Show()
End Sub 
```

在 Form2 中，添加委托将指向的函数。此函数会将 textBox1 的文本分配给 label1。

```
'Form2.vb
Public Sub funData(ByVal text As TextBox)
  label1.Text = text.Text
End Sub 
```

要将数据传回 Form1，只需创建`funData`一个返回所需值的函数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T12:05:44.613

您还可以使用“My.Forms”在 VB.NET 中检索数据

下面从 LoginForm 中的文本框中获取文本并将其放入主窗体中的文本框中。

```
Me.RetrievedDataTextBox.Text = My.Forms.LoginForm.Textbox1.Text 
```

# c# - Visual C# Express 中的 dataGridView 不会在 Windows Vista 上调整大小

> ID：741675
> 
> 赞同：0
> 
> 时间：2009-04-12T12:05:26.267
> 
> 标签：c#, visual-studio-2008, datagridview, windows-vista, resize

我最近升级了我的主计算机，现在在 Windows Vista 中工作。我的开发环境是 Microsoft Visual C# 2008 Express Edition。

我有一个使用 DataGridView 的程序，我开始在我的旧 Win XP 机器上开发它。现在在 Vista 上一切正常，只是当我调整主应用程序窗口的大小时 dataGridView 不会调整大小。这适用于 Win XP 机器。

dataGridView Anchor 属性设置为“上、左、下、右”。

??

提前致谢！

-一种

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-12T13:32:35.870

确保 Dock 属性设置为 Fill（选择布局中心的部分），并且未设置 MaximumSize (0,0)。然后让我知道是否仍然没有调整大小。

# continuous-integration - Cruise 与 TeamCity 与 CruiseControl.net

> ID：741679
> 
> 赞同：3
> 
> 时间：2009-04-12T12:08:15.077
> 
> 标签：continuous-integration

我们正在使用 CruiseControl.net，我们正在考虑搬到团队城市，但我只是注意到 thinkworks 有另一个名为 Cruise 的产品

[http://studios.thoughtworks.com/cruise-continuous-integration](http://studios.thoughtworks.com/cruise-continuous-integration)

是否有人在生产环境中使用此产品，如果是，他们是否对该产品与团队城市有意见

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-25T15:47:08.000

我们在公司使用 TeamCity，对此我们非常满意。它易于配置，具有干净的 UI 并且非常易于管理。此外，VS-Addin 安静舒适。只有“成功构建后自动提交”无法正常工作。

我也使用了 CC.Net，但我错过了 - 简单配置 - 身份验证 - 干净的 ui

也许 atlassians 'Bamboo' 是另一种可能的 CI-Server。看看这个。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-12T12:15:51.827

我在一个使用 Cruise 的团队中工作，我的历史一直是 CruiseControl.NET。

功能方面我看不出两者之间有太大的区别，但是从 UI 和可用性的角度来看，Cruise 产品的“抛光”程度要高得多。

Cruise 似乎掌握了一些配置细节，我想好处是所有项目的标准化方法。然而，我确实觉得这种手把手的某些部分迫使您在某种程度上围绕产品配置您的项目。我总是对此有点怀疑。

只是我比较 Cruise / CruiseControl.NET 的两分钱。

希望这会有所帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-03T02:44:49.790

另请参阅此 SO 问题：[CruiseControl [.Net] vs TeamCity 进行持续集成？](https://stackoverflow.com/questions/195835/cruisecontrol-net-vs-teamcity-for-continuous-integration)

# php - 单元测试 HTTP 操作

> ID：741682
> 
> 赞同：4
> 
> 时间：2009-04-12T12:13:06.437
> 
> 标签：php, unit-testing, http-headers

我正在编写另一个 PHP 框架，现在我已经编写了很多东西，我开始考虑单元测试（是的，我知道，糟糕的形式）。

一些动作使框架修改 HTTP 行为，例如创建 cookie、重定向浏览器。另一个主要特性是访问的 URI 会影响框架的行为方式。

简而言之，我需要能够测试影响环境或受环境影响的东西，而不仅仅是函数/方法的返回值。我怎样才能最简单地做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-12T12:18:35.143

SimpleTest 的[Web 测试](http://www.simpletest.org/en/web_tester_documentation.html)器可能会对您有所帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-12T12:20:55.513

> 简而言之，我需要能够测试影响环境或受环境影响的东西，而不仅仅是函数/方法的返回值。我怎样才能最简单地做到这一点？

如果环境可以轻松模拟并且可以用少量状态完全表示，那么您应该研究*模拟测试*。模拟测试可以帮助您编写测试，而不必使用真实的域对象，如果您可以简单地确保以正确的顺序调用事物就可以了。这是对原则的**[一个很好的概述](http://www.ibm.com/developerworks/library/j-mocktest.html)**。

如果不是这种情况，那么您说的是*集成测试*，它的成本要高得多。集成测试可以帮助您查看您的系统是否具有凝聚力，并且通常与您的应用程序的实时全栈副本一起运行。这里[**有更多**](http://en.wikipedia.org/wiki/Integration_testing)关于集成测试的阅读。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-12T12:25:21.337

您应该在单元测试中向服务器发出 HTTP 请求，然后检查响应中的 cookie 和标头是否设置正确。

在 PHP 中，我会使用 Zend_Http_Client。文档可以在[这里](http://framework.zend.com/apidoc/core/)找到，在 Zend_Http 包中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-12T14:50:44.373

> （是的，我知道，糟糕的形式）。

是的。如果您从测试开始，您会以某种方式编写框架，以便可以模拟外部依赖项。您现在可以做的是将所有对操纵全局状态的函数的调用替换为对全局代理对象的调用。然后，您可以在测试期间对此进行模拟。全局状态的一个特别麻烦的变化是调用`exit`/ `die`。您可以尝试用模拟中的异常替换它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-12T12:18:54.427

所以听起来好像您正在编写集成测试而不是单元测试（根据定义，任何涉及环境的东西都是集成测试）。

这会更容易通过浏览器通过堆栈进行测试吗？如果是这样，请查看浏览器自动化框架，可能类似于[http://wtr.rubyforge.org/](http://wtr.rubyforge.org/)

# ruby - 检测重复事件中的冲突

> ID：741687
> 
> 赞同：2
> 
> 时间：2009-04-12T12:18:27.843
> 
> 标签：ruby, calendar, constraints, recurrence

我正在编写一个日历应用程序，它需要检查重复条目之间的冲突。每个Entry 对象都有一个recurrences() 方法，该方法返回一个范围数组——每个范围包含每个未来事件的开始和结束时间。

我需要检查新条目和现有条目之间的冲突。我通过检查新条目的未来出现与现有条目的未来出现没有冲突来做到这一点：

```
def conflicts?(other)
  conflicts = 0
  recurrences.each do |my_rec|
    other.recurrences.each do |other_rec|
      start, finish = other_rec.first, other_rec.last
      conflicts += 1 if my_rec.include?(start) || my_rec.include?(finish)
    end
  end
  conflicts > 0
end 
```

resumes() 默认返回开始时间和开始时间 + 1 年之间的所有事件

问题是这种方法效率不高。仅比较两个条目，每个条目在 1 年内每天重复一次，导致 365 * 365 次比较（在我的机器上需要 4 秒以上）。可能有任意数量的现有条目可以与新条目进行比较，因此我现在拥有的方法是无用的。

我没有计算机科学或数学背景，但我一直在阅读各种关于算法的教科书，但我一直无法找到优化方法的方法。还有其他人有什么想法吗？

谢谢

戴夫

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T12:34:22.003

首先，您可以通过引起早期函数返回来改善这一点：

```
def conflicts?(other)
  conflicts = 0
  recurrences.each do |my_rec|
    other.recurrences.each do |other_rec|
      start, finish = other_rec.first, other_rec.last
      return true if my_rec.include?(start) || my_rec.include?(finish)
    end
  end
  false
end 
```

然而，这不会提高算法的平均性能，但如果存在冲突，只会导致一次比较。您唯一的选择是及早检测“简单”碰撞。所以喜欢

*   将重复类型（每周、每天、每月）存储到重复对象中。
*   如果两者都是每日重复，请找出可能存在潜在冲突的第一天。示例：*每天，a：1 月至 7 月，b：5 月至 10 月*应仅检查 May,1st 是否存在时间冲突。如果没有发生任何冲突，则无需检查任何其他冲突。
*   对不同的星座（周-周、日-周、日-年）执行相同的操作。
*   避免写`day-week`和`week-day`-`week_day(x,y)`是一样的`day_week(y,x)`。
*   如果找不到匹配的方法，则必须使用上面给出的方法作为后备。

正如您所看到的，后者的工作量更大——并且最坏情况下的执行时间可能相同（因为它使用原始算法作为后备）。例如，最坏的情况可能是由“不规则”重复（“每天一小时后”）引起的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-06-19T19:45:05.007

```
require 'set' #ruby standard lib
first_dates  = Set.new [1,2]  #where 1 and 2 are your sample dates, in an array
second_dates = Set.new [2,3]  #where 2 and 3 are your sample dates,
first_dates.intersection( second_dates ).empty?  #if empty, then no conflict 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T13:28:50.217

假设重复是可排序的，您可以在 O(n*log(n) 中对它们进行排序，并且只与相邻事件进行比较。这是一个开始：

```
def conflicts?(other)
 conflicts = 0
 # Generate all recurrences and sort
 all_recurrences = recurrences + other.recurrences
 all_recurrences.sort!

 # Keep track of what immediate neighbors could be conflicting
 conflicting = []
 all_recurrences.each do |my_rec| 
     conflicting.each do |other_rec| do
       start, finish = other_rec.first, other_rec.last
       if my_rec.include?(start) || my_rec.include?(finish) then
          # TODO update conflicting array: add my_rec + other_rec if conflicting
          conflicts += 1
       else 
          # TODO remove other_rec if not conflicting
       end
     end
 end
 conflicts > 0
end 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-12T12:36:52.730

一些想法：

1.  使用从日历日期指向该日期所有条目的列表的数据结构。然后查看该日期的条目列表中是否存在冲突。
2.  查看星期几 - 星期一的重复条目永远不会与星期三的条目发生冲突（包含在第一个想法中）。
3.  使用过期日期 - 检查冲突时，仅检查适合较早过期条目的日期。[您可能会从埃拉托色尼筛法中](http://en.wikipedia.org/wiki/Sieve_of_Eratosthenes)获得一些灵感。

# sifr - SiFR 仅替换“首屏”内容

> ID：741697
> 
> 赞同：1
> 
> 时间：2009-04-12T12:26:07.187
> 
> 标签：sifr

我正在尝试使用`siFR`来替换页面上`H1`的`H2`内容，但它似乎只替换了前两个。

总共大约有 8 个，因此在您向下滚动之前，其中一些不会出现在页面上，而且看起来`siFR`只是替换“首屏”的项目

我对 javascript 几乎一无所知，所以任何人都可以告诉我如何解决这个问题，以便它替换所有`H1`'s 和`H2`'s

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-12-09T15:51:03.327

尝试使用 servlet。这可能会帮助您解决问题。您可能会在网上找到一些不错的教程。

# c# - 在 C# 中切换表单的最佳方法是什么？

> ID：741699
> 
> 赞同：0
> 
> 时间：2009-04-12T12:26:29.867
> 
> 标签：c#, wpf, winforms

在 C# 中切换表单的最佳方法是什么？

场景：我想单击 Form1 中的一个按钮，杀死现有的 Form1 并创建 Form2。我怎样才能做到这一点？

如果有人甚至可以比较 Winforms 与 WPF 中此任务的复杂性，我将不胜感激。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-12T13:28:08.627

最简单的方法是使用一个可以打开两个表单的控制功能。在第一个表单上单击按钮时，将其关闭并移至第二个表单。

```
using (var form1 = new Form1() ) {
  form1.ShowDialog();
}
using (var form2 = new Form2()) {
  form2.ShowDialog();
} 
```

WPF 的代码类似。最大的区别是 WPF 窗口（以及几乎所有的类通常）不实现 IDisposable，因此不需要 using 语句。

```
var win1 = new Window1();
win1.ShowDialog();
var win2 = new Window2();
win2.ShowDialog(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T12:32:37.140

当然，关闭当前表单、创建新表单的实例并显示它只是一件非常简单的事情吗？以下代码（在您的情况下位于 Click 事件处理程序下）应该在 WinForms 或 WPF 中工作。

```
this.Close();
(new Form2()).Show(); 
```

也许我在这里错过了什么？

# php - 需要帮助将 VB.NET 08 代码转换为 PHP - 从 MediaFire.com 获取直接链接

> ID：741700
> 
> 赞同：0
> 
> 时间：2009-04-12T12:26:56.857
> 
> 标签：php, vb.net

我正在寻找一种从 mediafire 的文件托管服务获得直接链接的方法。默认情况下，当用户访问下载链接时，他会看到一个下载页面，他必须等待下载被处理，然后才会出现一个链接。此链接将出现在 div id 'download_link' 中。

我用谷歌搜索并找到了一个 VB.NET 2008 解决方案，但我需要 PHP 中的代码这是 VB.NET 2008 解决方案：[http ://www.vbforums.com/showthread.php?t=556681](http://www.vbforums.com/showthread.php?t=556681)

任何帮助是极大的赞赏。

干杯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T12:48:19.410

此 VB.NET 代码依赖于通过 WebBrowser .NET 控件访问客户端 DOM。您可以通过以下方式将其移植到 PHP：

*   使用 cURL 函数获取 HTML
*   将它们加载到 HTML 解析器中以找到正确的链接
*   重定向用户`Header('Location: '.download_link)`

[不过，我认为向您的用户推荐SkipScreen](http://skipscreen.com/) Firefox 扩展会更好。客户解决方案总是更容易。

# google-app-engine - 将大量数据集上传到 Google App Engine 的最快方法是什么？

> ID：741703
> 
> 赞同：0
> 
> 时间：2009-04-12T12:29:54.697
> 
> 标签：google-app-engine, upload

我有大约 4000 多条记录要上传到 App Engine。GAE 是否允许您上传这么多数据？如果是，那么我有一些问题：

1.  如何上传这些数据？
2.  完成这件事需要多少时间？
3.  最快的上传方法是什么。

* * *

**重复：[如何将数据批量上传到 Google App Engine Datastore？](https://stackoverflow.com/questions/741599/how-does-one-upload-data-in-bulk-to-a-google-appengine-datastore)**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T12:11:34.693

看一眼：

咸海巴尔干 GAEBAR（谷歌备份和恢复）[http://aralbalkan.com/1784](http://aralbalkan.com/1784)

谷歌批量加载器 [http://code.google.com/appengine/docs/python/tools/uploadingdata.html](http://code.google.com/appengine/docs/python/tools/uploadingdata.html)

# c# - 在c#中将信息从子对象传递到父对象的最佳方法是什么

> ID：741704
> 
> 赞同：0
> 
> 时间：2009-04-12T12:32:36.983
> 
> 标签：c#

我有一个动态创建许多子对象的对象。这些子对象派生自 UserControl。将信息传递回父母的最佳方法是什么？过去我使用过委托事件，但最近我只是在子对象的构造函数中使用对父级的引用。

我确实对紧密耦合有所保留，因为我担心如果父对象未能及时执行引用的方法，子对象可能会被捆绑。

我不想开始一个新问题，所以我会在这里问。

如果我有为动态创建的对象连接的事件，并且该对象稍后被处理，我是否应该在处理事件之前取消连接事件。

并且...如果我将动态创建的对象保存在数组或哈希表中，则只需从内存中删除该列表项即可处理该项目。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-12T12:34:44.700

这将取决于情况。如果一个对象想要观察另一个对象并对特定变化做出反应，则事件是合适的。在其他情况下，简单地保留对父级的引用是合适的。如果您需要针对非常具体的案例的建议，请提供该案例的详细信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-12T12:39:45.437

取决于您对紧密耦合的态度和手头的确切情况。

就个人而言，我认为委托/事件方法要干净得多。

传入引用意味着孩子需要了解父对象的类型？好的，您可能可以使用基类或接口，但它仍然是必需的。

委托/事件模型的好处是子对象可以只发布事件，任何注册的人都会收到事件。经典的观察者模式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T13:02:23.027

好吧，我认为正如乔恩建议的那样，事件最好观察其他控件的变化，这是最好的。您也可以在主用户控件中创建属性，然后从子控件中获取、设置它，我一直这样做。

希望这可以帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-12T13:35:22.543

如果您担心紧密耦合，请考虑使用父对象的接口，该接口仅公开传递数据所需的方法。

为了防止锁定子控件（分别是 UI 线程），您可以使用 a`BackgroundWorker`在单独的线程中完成工作。

# ruby-on-rails - 带有 path_prefix 的浅路径？

> ID：741712
> 
> 赞同：4
> 
> 时间：2009-04-12T12:36:34.570
> 
> 标签：ruby-on-rails, ruby

最近我在我的一个应用程序中更改了一些嵌套资源以使用浅路由。它工作得很好，我已经能够简化我的视图和控制器。

但是，我之前一直在使用 path_prefix ：

```
map.with_options :path_prefix => "blog" do |blog|
  blog.resources :posts do |posts|
    posts.resources :comments
  end
end 
```

请注意，所有路由都按预期以“/blog”为前缀。

```
# $ rake routes
#             posts GET    /blog/posts(.:format)                            {:controller=>"posts", :action=>"index"}
#                   POST   /blog/posts(.:format)                            {:controller=>"posts", :action=>"create"}
#          new_post GET    /blog/posts/new(.:format)                        {:controller=>"posts", :action=>"new"}
#         edit_post GET    /blog/posts/:id/edit(.:format)                   {:controller=>"posts", :action=>"edit"}
#              post GET    /blog/posts/:id(.:format)                        {:controller=>"posts", :action=>"show"}
#                   PUT    /blog/posts/:id(.:format)                        {:controller=>"posts", :action=>"update"}
#                   DELETE /blog/posts/:id(.:format)                        {:controller=>"posts", :action=>"destroy"}
#     post_comments GET    /blog/posts/:post_id/comments(.:format)          {:controller=>"comments", :action=>"index"}
#                   POST   /blog/posts/:post_id/comments(.:format)          {:controller=>"comments", :action=>"create"}
#  new_post_comment GET    /blog/posts/:post_id/comments/new(.:format)      {:controller=>"comments", :action=>"new"}
# edit_post_comment GET    /blog/posts/:post_id/comments/:id/edit(.:format) {:controller=>"comments", :action=>"edit"}
#      post_comment GET    /blog/posts/:post_id/comments/:id(.:format)      {:controller=>"comments", :action=>"show"}
#                   PUT    /blog/posts/:post_id/comments/:id(.:format)      {:controller=>"comments", :action=>"update"}
#                   DELETE /blog/posts/:post_id/comments/:id(.:format)      {:controller=>"comments", :action=>"destroy"} 
```

新的路由配置如下所示：

```
map.with_options :path_prefix => "blog", :shallow => true do |blog|
  blog.resources :posts do |posts|
    posts.resources :comments
  end
end 
```

现在，我的一些路由中缺少“/blog”前缀。

```
# $ rake routes
#            posts GET    /blog/posts(.:format)                  {:controller=>"posts", :action=>"index"}
#                  POST   /blog/posts(.:format)                  {:controller=>"posts", :action=>"create"}
#         new_post GET    /blog/posts/new(.:format)              {:controller=>"posts", :action=>"new"}
#        edit_post GET    /posts/:id/edit(.:format)              {:controller=>"posts", :action=>"edit"}
#             post GET    /posts/:id(.:format)                   {:controller=>"posts", :action=>"show"}
#                  PUT    /posts/:id(.:format)                   {:controller=>"posts", :action=>"update"}
#                  DELETE /posts/:id(.:format)                   {:controller=>"posts", :action=>"destroy"}
#    post_comments GET    /posts/:post_id/comments(.:format)     {:controller=>"comments", :action=>"index"}
#                  POST   /posts/:post_id/comments(.:format)     {:controller=>"comments", :action=>"create"}
# new_post_comment GET    /posts/:post_id/comments/new(.:format) {:controller=>"comments", :action=>"new"}
#     edit_comment GET    /comments/:id/edit(.:format)           {:controller=>"comments", :action=>"edit"}
#          comment GET    /comments/:id(.:format)                {:controller=>"comments", :action=>"show"}
#                  PUT    /comments/:id(.:format)                {:controller=>"comments", :action=>"update"}
#                  DELETE /comments/:id(.:format)                {:controller=>"comments", :action=>"destroy"} 
```

我正在寻找一种解决方案来取回所有路由的前缀。我知道它正在使用命名空间 ( `map.namespace :blog do`)，但我想防止重构我的所有控制器/视图/测试以实际使用命名空间。

所有代码示例都使用 Rails 版本 2.3.2 和 Ruby 1.8.7 进行了测试。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-13T15:37:39.697

该文档似乎表明这种确切的行为是设计使然：

> :shallow - 如果为 true，则引用特定成员的嵌套资源的路径（即具有 :id 参数的那些）将不使用父路径前缀或名称前缀。

（来自[http://api.rubyonrails.org/classes/ActionController/Resources.html#M000501](http://api.rubyonrails.org/classes/ActionController/Resources.html#M000501)）

由于使用 :shallow 选项会导致您的 :path_prefix 在某些情况下被忽略，如果您必须始终使用此前缀，则应考虑删除 :shallow 选项。这是一个替代解决方案，似乎可以满足您的需求：

```
map.with_options :path_prefix => "blog" do |blog|
  blog.resources :posts do |posts|
    posts.resources :comments, :only => [:index, :create, :new]
  end
  blog.resources :comments, :except => [:index, :create, :new]
end 
```

导致这些路线：

```
#             posts GET    /blog/posts                               {:controller=>"posts", :action=>"index"}
#                   POST   /blog/posts                               {:controller=>"posts", :action=>"create"}
#          new_post GET    /blog/posts/new                           {:controller=>"posts", :action=>"new"}
#         edit_post GET    /blog/posts/:id/edit                      {:controller=>"posts", :action=>"edit"}
#              post GET    /blog/posts/:id                           {:controller=>"posts", :action=>"show"}
#                   PUT    /blog/posts/:id                           {:controller=>"posts", :action=>"update"}
#                   DELETE /blog/posts/:id                           {:controller=>"posts", :action=>"destroy"}
#     post_comments GET    /blog/posts/:post_id/comments             {:controller=>"comments", :action=>"index"}
#                   POST   /blog/posts/:post_id/comments             {:controller=>"comments", :action=>"create"}
#  new_post_comment GET    /blog/posts/:post_id/comments/new         {:controller=>"comments", :action=>"new"}
#      edit_comment GET    /blog/comments/:id/edit                   {:controller=>"comments", :action=>"edit"}
#           comment GET    /blog/comments/:id                        {:controller=>"comments", :action=>"show"}
#                   PUT    /blog/comments/:id                        {:controller=>"comments", :action=>"update"}
#                   DELETE /blog/comments/:id                        {:controller=>"comments", :action=>"destroy"} 
```

希望这可以帮助！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-14T20:14:45.297

可能最简单的解决方案不是使用 :shallow 选项，而是使用附加资源定义创建相同的路由：

```
map.with_options :path_prefix => "blog" do |blog|
  blog.resources :posts do |posts|
    posts.resources :comments, :only => [:index, :create, :new]
  end
end
map.resources :comments, :path_prefix => "blog",
              :except => [:index, :create, :new] 
```

它给出了以下路线定义：

```
# $ rake routes
#            posts GET    /blog/posts(.:format)                       {:action=>"index", :controller=>"posts"}
#                  POST   /blog/posts(.:format)                       {:action=>"create", :controller=>"posts"}
#         new_post GET    /blog/posts/new(.:format)                   {:action=>"new", :controller=>"posts"}
#        edit_post GET    /blog/posts/:id/edit(.:format)              {:action=>"edit", :controller=>"posts"}
#             post GET    /blog/posts/:id(.:format)                   {:action=>"show", :controller=>"posts"}
#                  PUT    /blog/posts/:id(.:format)                   {:action=>"update", :controller=>"posts"}
#                  DELETE /blog/posts/:id(.:format)                   {:action=>"destroy", :controller=>"posts"}
#    post_comments GET    /blog/posts/:post_id/comments(.:format)     {:action=>"index", :controller=>"comments"}
#                  POST   /blog/posts/:post_id/comments(.:format)     {:action=>"create", :controller=>"comments"}
# new_post_comment GET    /blog/posts/:post_id/comments/new(.:format) {:action=>"new", :controller=>"comments"}
#     edit_comment GET    /blog/comments/:id/edit(.:format)           {:action=>"edit", :controller=>"comments"}
#          comment GET    /blog/comments/:id(.:format)                {:action=>"show", :controller=>"comments"}
#                  PUT    /blog/comments/:id(.:format)                {:action=>"update", :controller=>"comments"}
#                  DELETE /blog/comments/:id(.:format)                {:action=>"destroy", :controller=>"comments"} 
```

# ruby-on-rails - 在 Rails 中上传文件

> ID：741714
> 
> 赞同：1
> 
> 时间：2009-04-12T12:37:35.380
> 
> 标签：ruby-on-rails, pdf, file-upload

我想在我的网站中创建一个部分，访问者可以上传文件（pdf）。如何才能做到这一点？

此外，在上传 pdf 后，我需要一个指向该文件的链接。我没有使用无聊的文本链接，而是考虑使用 pdf 第一页的缩略图。有没有一个工具可以做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-12T12:52:07.450

对于*Uploading 部分*，您可以考虑[ActsAsAttachment](http://techno-weenie.net/articles/acts_as_attachment)或（如前所述）[Paperclip](http://www.thoughtbot.com/projects/paperclip)。

我不知道有任何 Rails 插件能够自动*从 PDF 文件创建/读取缩略图*，但您可以从代码中调用[LibExtractpr](http://gnunet.org/libextractor/)或[GhostScript 。](http://www.ghostscript.com/)

此外，您可能会查看[rGhost Gem](http://github.com/shairontoledo/rghost/tree/master)，它（如文档所述）是一个“文档创建和转换 API”，本质上应该是 Ruby 的 GhostScript Wrapper。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-15T15:37:55.533

同时，没有直接解决 PDF 缩略图问题“Rails 方式”正在做一系列关于使用 Rails 上传/下载文件的系列，这对于像 PDF 这样的大文件很有用。

**[上传文件](http://www.therailsway.com/2009/4/23/uploading-files)**：基本上，他们有一个名为 ModPorter 的 Apache 模块，它可以加速包含上传的多部分 HTTP 请求的解析。

**[下载文件](http://www.therailsway.com/2009/2/22/file-downloads-done-right)**：一旦你的 Rails 应用程序执行了所需的任何用户身份验证，使用 X-SendFile 让 Apache 提供下载服务

# c# - 将一个方法传递给另一个方法

> ID：741716
> 
> 赞同：2
> 
> 时间：2009-04-12T12:40:53.610
> 
> 标签：c#, asp.net-mvc, attributes, lambda

是否有可能将一个函数发送到另一个函数以使其运行。例如......我想在一个字段上有一个属性，我可以在其中指定一个方法，该方法将发送到另一个方法，传入的方法将在该方法运行。

不确定这是否有意义，但这是一个小例子。

```
[ValidateIf(x=>x.test())]
public string test { get; set; } 
```

**更新：** 基本上我想使用 DataAnnotations 进行验证，但有时根据系统设置，字段可能不是强制性的……你对我应该前进的方向有什么建议吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-12T12:42:39.937

不幸的是，您不能将委托用作属性的属性。您必须指定方法名称，然后在执行时使用反射创建委托 - 这显然在编译时查找拼写错误方面并不理想。

在IL中*可能*是可能的（指定 a`MethodInfo`使用与当然。（最好将委托类型信息保留在属性中。）`typeof``infoof`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T13:25:30.070

我不知道这是否能满足您的特定目标，但总的来说，如果您希望在您的语言中添加数据注释，我建议您查看 Spec#。这是 C# 语言的扩展，允许您将数据协定添加到您的程序中，并且似乎可以实现您正在寻找的目标。

[http://research.microsoft.com/en-us/projects/specsharp/](http://research.microsoft.com/en-us/projects/specsharp/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T16:08:49.757

如果您希望向域对象添加验证，可以查看 NHibernate Validator。

[http://nhibernate.info/doc/validator/nhibernate-validator-1-0-0-documentation.html](http://nhibernate.info/doc/validator/nhibernate-validator-1-0-0-documentation.html)

# c++ - APR（Apache Portable Runtime）1.3 和 0.9 有什么区别？

> ID：741719
> 
> 赞同：0
> 
> 时间：2009-04-12T12:41:38.070
> 
> 标签：c++, apache, apr

我刚刚开始使用 APR，似乎有两个受支持的版本并排开发： http: [//apr.apache.org/](http://apr.apache.org/)

文档没有解释 1.3.x 和 0.9.x 之间的区别......有人可以解释一下吗？或者简而言之，我应该使用哪个？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-12T13:12:03.080

见[http://www.apache.org/dist/apr/Announcement0.9.html](http://www.apache.org/dist/apr/Announcement0.9.html)：

> 此版本的 APR 主要是一个错误修复版本，仅提供给需要 APR 0.9 兼容性的用户。鼓励大多数开发人员采用最新的 APR 1.x 版本，以确保获得最全面的支持和对最新功能和增强功能的访问。
> 
> 例如，Apache HTTP 服务器项目的 httpd 2.0 版本使用 APR 0.9 来实现二进制兼容性，而后来的 httpd 2.2 版本需要 APR 1.2 以获得更好的支持和附加功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T13:13:26.073

[主页](http://apr.apache.org/)包含指向每个版本[中所有更改列表的](http://www.apache.org/dist/apr/CHANGES-APR-1.3)链接。
祝你好运。

# asp.net - 如何开始创建选择脚本，“像萤火虫一样检查”？

> ID：741720
> 
> 赞同：0
> 
> 时间：2009-04-12T12:42:16.350
> 
> 标签：asp.net, javascript, jquery, html

> **可能重复：**
> [有人知道 DOM 检查器 javascript 库或插件吗？](https://stackoverflow.com/questions/742210/does-anyone-know-a-dom-inspector-javascript-library-or-plugin)

我想在 webproject 上创建一个小工具，让用户在页面上选择标签，我会将选择保存在一个数组中以供将来使用，所以我需要的是接近 firebug 功能的东西。

我可以从哪里开始？有什么好的文章或工具可以让事情变得更容易吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T12:50:09.390

你能做一些事情，比如添加一个 jquery 函数，它可以在悬停和点击你想要检查的东西上做一些事情吗？

例如

```
$('div, p, img').hover(function(){
 // stuff to do on hover like highlight the object
    $(this).addClass('hover');
}, function(){
    $(this).removeClass('hover');
});

$('div, p, img').click(function(){  yourSpecialClickFunction();  }); 
```

也许在单击检查按钮之前，您可能会在某处无法使上述内容执行任何操作。

# windows - 诊断 Windows 应用程序清单

> ID：741726
> 
> 赞同：6
> 
> 时间：2009-04-12T12:50:08.627
> 
> 标签：windows, windows-vista, uac, manifest

Windows 应用程序清单的语法非常松散——无法识别的部分会被忽略。我如何诊断哪些部分被识别，哪些未被识别？

导致此问题的问题在于具有并行 UAC 清单的应用程序，其中指定的*requestedExecutionLevel*为*最高可用*。这应该关闭 Vista 文件虚拟化，但事实并非如此。我想知道为什么。清单正在被使用，因为我通过故意引入语法错误进行检查，但我看不出有什么方法可以确定它是如何被使用的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-17T07:41:33.643

我遇到了类似的问题：任务管理器显示为正在运行的应用程序启用了虚拟化，尽管应用程序显示为最高可用。我尝试使用 mt.exe 来显示我的文件。它对一些人有效，但对另一些人无效。这种奇怪的行为让我觉得 Vista 中有一些持久缓存会根据 exe 的时间戳影响 UAC 信息。解决方案是使用[Resource Tuner](http://www.heaventools.com/rt-tour-xml-manifest-wizard.htm)中的清单向导。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-19T09:32:27.417

请参阅我对 Wylder 的评论 - 您是否尝试过更新可执行文件和清单的时间戳？
从提升的命令提示符运行“sxstrace”会返回什么？
你能把你的清单贴在某个地方吗？

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-01-04T01:43:32.297

有一个缓存。

SxS 激活上下文缓存缓存 .manifest 文件。

从我读过的内容来看，它应该只缓存清单的存在。

它是基于内存的，只有在重新启动时才会清除 - 但是，我知道事实上它并不总是在重新启动时清除，许多其他人也报告了这一点。我确实找到了 c:\windows\sxs\manifestCache 并想知道它是否真的在重新启动时从那里重新加载。

强制的唯一方法是更改​​ .exe 上的修改日期。

编辑清单时也要小心，如果您不提升编辑器，它将被 UAC 虚拟化 - 当然，加载程序会忽略虚拟化副本。

参考：

*   [http://blogs.msdn.com/b/junfeng/archive/2006/10/25/touch-the-exe-after-you-added-a-manifest-for-it-in-vista.aspx](https://web.archive.org/web/20140423082154/http://blogs.msdn.com/b/junfeng/archive/2006/10/25/touch-the-exe-after-you-added-a-manifest-for-it-in-vista.aspx)
*   [http://blogs.msdn.com/b/junfeng/archive/2007/10/01/vista-activation-context-cache.aspx](https://web.archive.org/web/20160702070403/https://blogs.msdn.microsoft.com/junfeng/2007/10/01/windows-vista-sxs-activation-context-cache/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-15T00:00:25.860

我会查看[文档](http://msdn.microsoft.com/en-us/library/aa374191.aspx)以确保它符合规范，但除此之外，据我所知，没有自动化工具可以做同样的事情。

# delphi - Delphi 中的 reintroduce 和 override 指令是什么意思？

> ID：741735
> 
> 赞同：30
> 
> 时间：2009-04-12T12:57:29.043
> 
> 标签：delphi, overriding

**`override`**和**`reintroduce`**指令有什么区别？我什么时候不应该**`inherited`**在被覆盖的方法中使用关键字？

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-04-12T17:53:03.157

顺便说一句，对 Jim 的回答的引用非常好，它只描述了何时何地使用这些指令。答案的另一部分是为什么仍然需要它们？没有它们，许多语言相处得很好，对吧？在设计 Delphi 对象 Pascal 语言的各个方面时，OOP（面向对象编程）已经成为主流好几年了。在此期间，观察到使用许多采用这些概念的语言（Turbo Pascal、C++ 等）来开发应用程序框架会遇到我所谓的“版本 2”问题。

假设您使用语言 X 开发了一个很棒的框架并将其作为版本 1 发布。您的用户对它所能做的一切都赞不绝口，并且它被大量使用。大获全胜，您决定发布更棒的第 2 版。您特别确保它完全向后兼容。突然，您的用户开始报告奇怪的行为。他们自己的虚拟方法在奇怪的时间被调用。许多人报告说他们的旧代码无法与新版本一起编译。奇怪的。所有相同的对象、方法和功能仍然保留。您所做的只是向一些基类、一些新的对象类型和一些新的可选功能添加一些虚拟方法。发生了什么？

override 和 reintroduce 指令通过要求为了实际*覆盖*虚拟方法必须使用 override 指令代替 virtual 指令来消除此问题。如果您碰巧引入了您自己的与您祖先的虚拟方法之一同名的虚拟方法，编译器现在会警告您，但仍会做正确的事情。在这种情况下，使用 reintroduce 不仅可以抑制该警告，还可以在您打算执行此操作的源中记录。

如果没有 override 和 reintroduce 指令，您将无法在不担心破坏所有用户的情况下不断发展您的框架。如果您的用户每次发布新版本时都必须进行大量修改，那么他们将不愿意采用新版本。最后，使用“覆盖”还允许框架设计者在不破坏用户代码的情况下更改祖先中的虚拟类型。例如，在 Delphi 中，许多方法都被标记为“动态”，这是一种基于表的运行时方法查找形式的多态性。它的执行速度不如常规 virtual 快，因此它通常用于很少被覆盖的方法和/或对用户操作的响应，而这些额外开销从未被注意到。假设在框架的 V1 中，一个方法被标记为“动态” 但在实践中，它最终被覆盖并调用了超出您预期的次数。在 V2 中，您可以将其更改为“虚拟”，而不必担心用户的代码被破坏。

Delphi 的 Object Pascal 语言并不是唯一能识别这个问题的语言。出于完全相同的原因，C# 需要使用“覆盖”指令。C++ 标准委员会终于认识到了这个问题，并正在修改语言以支持它……有点。在 C++ 中，如果一个方法的名称和参数列表与祖先的虚拟匹配，那么它就是一个覆盖（即使你没有在后代上说“虚拟”！）。对于即将推出的新 C++ 标准，如果您指定“虚拟”并且签名不匹配，那么它是当前类中引入的新虚拟方法。如果与祖先有签名匹配并且作者*不*打算覆盖，那么“新”

 *** * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-12T15:46:25.347

**override**指令用于覆盖继承类中的虚拟方法。

**reintroduce**指令用于声明与超类中同名但参数不同的方法。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-12T18:22:41.617

> 什么时候不应该在被覆盖的方法中使用inherited关键字？

基本上，答案是当您不希望执行继承的方法时。请注意，不允许运行继承的方法可能会以不希望的方式破坏继承对象的功能，因此请确保您没有引入任何意外的副作用。

例如，假设您希望完全覆盖一个名为 ApplyDiscount 的继承函数，但有人将折扣百分比硬编码到祖先类中。如果您调用继承的 ApplyDiscount，它将覆盖您的代码或计算您将覆盖的值；在这种情况下，您不能调用继承并自己应用折扣。

（这是一个人为的例子，所以如果有人能想到更好的例子，请添加它。）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-12T21:54:55.790

在许多情况下，您不想在被覆盖的方法中调用继承。

在我使用的某些库中，基本方法会引发错误（ENotImplimented 或类似的）。显然，在这种情况下，您不想调用inherited，否则您的代码也会抛出错误。

我的一些类有一个在大多数情况下都有效的默认实现。该方法只是覆盖替换默认值，不需要调用默认值。

例如，我的基本财务对象的 GST 函数（= 销售税）返回 ExGst 金额的 12.5%，而 IncGst 返回 ExGst + GST。

在我的收入补偿对象上，GST 始终返回 0，因此无需调用继承的函数。

# c# - .NET：条件套接字.Accept

> ID：741737
> 
> 赞同：0
> 
> 时间：2009-04-12T13:01:26.273
> 
> 标签：c#, .net, sockets, tcp

似乎没有任何 Socket 或 ListenSocket 方法可以让我有条件地接受连接。

当我收到 SYN 时，我希望能够根据源决定是否需要此连接，如果我发回 SYN/ACK（接受连接）或 RST（强制拒绝）。

有没有人想实现这一目标？不幸的是，我不能在接受后立即关闭连接，根本不需要打开它。我还想避免将其用作 RAW 套接字。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-12T13:21:50.127

不幸的是，这是不可能的。无法使用 TCP 套接字连接有条件地接受。您只能在建立连接后过滤连接。

但是你到底想过滤什么？在您收到 SYN 数据包时，您所知道的只是源的 IP 地址和它们尝试连接的端口。使用防火墙根据此数据进行过滤似乎要好得多。我意识到这不是通过您的应用程序控制的，但它是一个可以考虑的替代方案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T13:41:14.227

似乎不进入 RAW 模式是不可能的。一旦套接字进入 Winsock 的监听模式，它将接受任何东西，甚至在调用 Socket.Accept 之前。

如果需要此功能，您必须使用 RAW 模式并使用您自己的 TCP 堆栈解析数据包。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T14:35:14.083

也刮一下。Windows XP SP2 和更高版本不再支持通过 RAW 套接字发送 TCP 数据包。有关更多详细信息，请参见[此处](http://msdn.microsoft.com/en-us/library/ms740548.aspx)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-04-05T20:50:31.043

自 Windows Vista 以来有一个新的套接字选项允许这样做。虽然没有标准库支持这一点。

[https://msdn.microsoft.com/en-us/library/windows/desktop/dd264794(v=vs.85).aspx](https://msdn.microsoft.com/en-us/library/windows/desktop/dd264794(v=vs.85).aspx)

[http://www.winsocketdotnetworkprogramming.com/dotnetnetworkprogrammingsecurity13a.html](http://www.winsocketdotnetworkprogramming.com/dotnetnetworkprogrammingsecurity13a.html)

# c# - C#中的音乐播放器

> ID：741741
> 
> 赞同：0
> 
> 时间：2009-04-12T13:04:50.633
> 
> 标签：c#

我试图使用 C# 制作音乐播放器。我使用 Windows XP 中存在的 QuartzTypeLib.dll。当我点击播放按钮时我卡住了它播放音乐很好并使主线程处于挂起状态，所以我在其他线程中播放音乐我仍然面临同样的问题。任何建议请。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-12T13:21:45.383

据我所知，整个控件需要在另一个线程中创建和初始化——即，不仅仅是 Play() 调用。

# browser - 如何在基于 Windows 的应用程序中调用 WebKit 中的 openDatabase？

> ID：741744
> 
> 赞同：2
> 
> 时间：2009-04-12T13:08:17.507
> 
> 标签：browser, webkit

在为基于 WebKit 项目的 Windows 创建 C# 应用程序后，我可以成功呈现 HTML 并进行 AJAX 调用。我的应用程序使用`window.openDatabase`调用。

此方法似乎存在于对以下内容的调用中：

```
if (window.openDatabase) 
```

将评估为`true`。当实际调用该方法打开数据库时，会返回`null`数据库无法打开。

我找到了以下[链接](http://lists.apple.com/archives/Webkitsdk-dev/2008/Apr/msg00027.html)，用于在 Macintosh 的 WebKit 上使用它，但相同的解决方案似乎不适用于 windows 构建。

有谁知道这在 Windows 的标准 WebKit 夜间构建中是否可用，如果可以，如何使其工作？

# c++ - 在 Windows XP 中多次启动程序 + DLL 的问题？

> ID：741746
> 
> 赞同：0
> 
> 时间：2009-04-12T13:11:58.933
> 
> 标签：c++, dll, crash, visual-c++, interprocess

我们开发了一个使用 TCP 和 UDP 套接字的网络库。此 DLL 由 testclient 使用，该客户端在同一台 PC 上多次启动以进行负载测试。

在 Windows Vista 中，多次启动 testclient 是没有问题的。在 Windows XP 中，启动它最多 5 次是没有问题的，但是如果我们启动它 6 次或更多，然后关闭一个客户端，它们都会崩溃并带有明显的随机堆栈跟踪。

是的，虽然我们不使用任何进程间代码（仅客户端之间的套接字），但其中一个客户端的终止会导致所有客户端的崩溃。

我们的 DLL 使用 MSVC 编译并使用 Boost 和 Crypto++ 库（静态链接）。

知道为什么不同的过程会相互影响吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-12T13:33:45.760

我们需要更多数据来诊断您的问题。但是考虑到关闭一个客户端会使所有客户端崩溃，您需要考虑客户端可以相互影响的所有方式（进程间通信）。无论是隐含的还是明确的。所以我会先看看

*   当第 6 个客户端关闭时，服务器会做什么。它是否发出了其他 5 个客户端无法处理的特殊数据包？
*   您是否正在向文件系统读取或写入任何内容？
*   你使用共享内存吗？

但总的来说，我发现 C++ 中看似随机的堆栈跟踪通常是由以下原因之一引起的

*   数据损坏
*   线程逻辑中的竞争条件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T13:19:17.930

一个想法：你有一些错误。

说真的，如果没有任何信息，就无法知道您的问题是什么。
当一个进程崩溃时，它通常有一个很好的理由这样做。找出那是什么。在调试中编译您的 dll 和可执行文件，附加调试器并了解您获得的堆栈跟踪。如果你得到一个无意义的堆栈跟踪，找出原因。

与许多问题一样，这个问题很可能通过**“仅调试它”来解决**

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T14:39:35.540

修改 DLL 或锁定 DLL 可能会导致依赖它的程序崩溃。通常，对 DLL 的更改将被文件系统锁定，但在您的应用程序中，您可能正在做一些不寻常的事情。

# php - 为什么我从我的 PHP 中得到“未定义的索引”？

> ID：741750
> 
> 赞同：0
> 
> 时间：2009-04-12T13:14:06.260
> 
> 标签：php, undefined-index

当我运行此代码时：

```
<?php
if (preg_match('/^[a-z0-9]+$/', $_GET['p'])) {
  $page = realpath("includes/$_GET[p].php");
  if ($page) {
    include $page;
  }
}
?> 
```

我收到此错误：

> 注意：未定义的索引：第 3 行 index.php 中的 p

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-12T13:18:59.803

错误消息说没有带有 key 的数组项`p`。如果你不能保证一个变量（或数组项）确实存在，你应该首先用[`isset`函数](http://docs.php.net/isset)检查它：

```
if (isset($_GET['p']) && preg_match('/^[a-z0-9]+$/', $_GET['p'])) {
    $page = realpath("includes/$_GET[p].php");
    if ($page) {
        include $page;
    }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-12T13:53:45.290

Gumbo 所说的检查是否在数组中设置了索引。

此外，为了[解析字符串中的数组索引，](http://php.net/manual/en/language.types.string.php#language.types.string.parsing.complex)您应该在数组周围使用方括号，并且如果它是字符串，则应该用单引号转义索引。

```
$page = realpath("includes/{$_GET['p']}.php"); 
```

但是对于包含用户建议的文件，最安全的方法是在数组中查找文件，并且仅在它们存在时才包含它们。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-12T13:17:01.620

```
$page = realpath("includes/ " . $_GET['p'] . ".php"); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-12T13:43:38.777

没有真正的问题。PHP 产生一个*Notice*而不是*Warning*或*Error*。基本上，您的脚本没有收到`p`URL 参数。所以它使用 '' 并在日志中给出通知。如果您在呈现的页面上看到此消息，请将 php 错误报告调整为类似于`E_ERROR | E_WARNING`PHP.ini 中的内容

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-12T14:11:12.470

查看[array_key_exists()](http://www.php.net/array_key_exists)以检查数组键...是否存在。但在你的情况下，我建议你选择专门处理用户输入的[过滤器类。](http://www.php.net/filter)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-12T13:17:42.897

页面没有'p'参数，也许？你的意思是`$_REQUEST`相反吗？
另外，访问数组时不是 `"${_GET['p']}" 吗？

# multithreading - 低级编程：操作系统如何启动新线程/进程？

> ID：741751
> 
> 赞同：13
> 
> 时间：2009-04-12T13:14:58.533
> 
> 标签：multithreading, operating-system, process, cpu, low-level

每当引导加载程序加载操作系统时，大概只有一个程序流处于活动状态，对吧？这意味着，一个处理器持有指令指针并执行它在 EIP 寄存器指向的位置找到的命令。在什么时候以及系统如何开始利用更多的进程和/或线程（没有用户态线程，但 cpu 线程）？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-12T13:42:09.560

操作系统将以特殊角色启动（在 BIOS 和引导加载程序完成后） - 因为第一个运行它的程序将直接访问所有 CPU 命令。

所以它将设置系统的各个部分——比如设置[中断处理程序](http://en.wikipedia.org/wiki/Interrupt_handler)（或中断服务程序）。完成此操作后，它就有能力创建“调度程序”。

实际的“进程/线程”处理将由该调度程序完成。它决定将运行哪些线程。它还管理所有活动线程。CPU 不知道所有这些事情。

一旦调度程序的主执行程序决定执行线程（或“进程”）A，它会将进程数据复制到寄存器中（并将寄存器存储到最近运行的线程的 InfoBlock 中）。它将告诉 CPU / 计时器在**n**微秒（或其他时间单位）内引起中断。然后它会告诉 cpu 在非 OS 模式下运行“程序”（CPU 唯一知道的事情）（这样它就不会修改关键数据或未经许可注册自己的中断处理程序）。

当线程 A 现在正在执行时，硬件计时器将运行。一旦达到所需的时间偏移量，它将导致中断。然后硬件将停止当前程序的执行，并调用已注册的程序`Interrupt Handler`。这个处理程序将是调度程序的一个方法（准确地说是主执行程序）。

然后，此方法将再次重新评估应该调度哪个线程，因此调度会继续。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-12T13:27:01.453

正确，在启动过程中只有一个执行线程。通常情况下，直到操作系统初始化到低级内存管理、调度程序等功能正常为止。

甚至在多 CPU 系统中也是如此——一个核心是处理早期启动的“主处理器”，直到基础设施在那里启动其他核心。

最后，它是高度特定于操作系统的；[英特尔架构软件开发人员手册](http://developer.intel.com/products/processor/manuals/index.htm)包含硬件规格的详细信息。（假设您谈论的是英特尔架构；其他架构可能会有很大不同。）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-12T13:25:26.310

（多线程）操作系统必须启动的第一件事是调度程序，它负责管理多个进程（因此也管理多个 CPU 线程，例如在多核机器上）。

此调度程序启动的第一个进程通常是某种“init”进程，该进程又负责随后加载其他程序/进程。

# java - Java 套接字问题

> ID：741753
> 
> 赞同：1
> 
> 时间：2009-04-12T13:15:54.960
> 
> 标签：java, sockets

我正在尝试编写一个简单的服务器-客户端程序，但我有一个问题：我可以将数据从客户端发送到服务器，但我无法从服务器发送数据（我无法在客户端接收它）： （
那么如何从服务器发送数据，并在客户端接收呢？

服务器：

```
//this is in a thread
try {
    server = new ServerSocket(1365);
} catch (IOException e) {
    e.printStackTrace();
}
while (!exit) {
    try {
        clientSocket = server.accept();
        is = new DataInputStream(clientSocket.getInputStream());
        os = new PrintStream(clientSocket.getOutputStream());
        while ((line = is.readLine()) != null) {
            System.out.println("Message from client: " + line);
            //if (line.equals("exit")) {
            //  exit = true;
            //}
            if (line.equals("say something")) {
                os.write("something".getBytes());
            }
        }
    } catch (IOException e) {
        e.printStackTrace();
    }
    try {
        is.close();
    } catch (IOException ex) {
        ex.printStackTrace();
    }
os.close();
} 
```

客户：

```
try {
    socket = new Socket(host, 1365);
    os = new DataOutputStream(socket.getOutputStream());
    is = new DataInputStream(socket.getInputStream());
} catch (UnknownHostException e) {}
if (socket != null && os != null && is != null) {
    try {
        os.writeBytes("say something");
        //get the answer from server
        os.close();
        is.close();
        socket.close();
    } catch (IOException e) {}
} 
```

（对不起，长代码）
提前谢谢你。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-12T13:28:10.703

您的服务器的 OutputStream 是 PrintStream，但您的客户端的 InputStream 是 DataInputStream。尝试更改服务器以使用像您的客户端一样的**DataOutputStream 。**

更好的方法可能是同时更改为使用 PrintWriter 和 BufferedReader，例如[Sun 的 Socket Tutorial](http://java.sun.com/docs/books/tutorial/networking/sockets/clientServer.html)中的示例客户端/服务器对。

* * *

只是解释一下*为什么*您的代码不起作用：您可以将 Stream 对象视为数据通过的过滤器。过滤器更改您的数据，对其进行格式化，以便另一端的*匹配过滤器可以理解它。*当您通过一种类型的 OutputStream 发送数据时，您应该在另一端使用匹配的 InputStream 接收它。

正如您不能将 String 对象存储在 double 中，或将 double 存储在 String 中（而不是不转换它），您也不能将数据从一种类型的 OutputStream（在本例中为 PrintStream）发送到不同类型的输入流。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T17:20:54.003

我认为另一个问题是我没有在文本之后发送“\n”，但我使用了 readLine() 方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T18:06:29.137

在你`os.write()`做之后`os.flush()`；消息非常小，可能没有发送，因为它没有填满缓冲区。

# java - 在 Java 中捕获特定线程的控制台输出

> ID：741775
> 
> 赞同：3
> 
> 时间：2009-04-12T13:29:54.240
> 
> 标签：java, multithreading, console

我意识到在 SO 上有类似的问题，但它们并不能完全解决我的问题。

我想要一个方法，给定一个 Class 对象，将调用该类（如果存在）上的“main”方法，即 public static void main，并捕获该 main 方法的控制台输出。执行调用的类是非守护线程。

我已经有部分代码，但我不确定如何捕获控制台输出，最重要的是，如何仅为 *this 特定线程捕获它。这是我到目前为止所拥有的：

```
public class Output extends Thread {
    private Class testClass;

    public Output(Class clazz) {
        this.testClass = clazz;
    }

    private Method getMainMethod(Class clazz) {
        Method[] methods = clazz.getMethods();
        for (Method method : methods) {
            if (isMainMethod(method)) { 
                return method;
            }
        }

        return null;
    }

    private Boolean isMainMethod(Method method) {
        return (method.getName().equals("main") &&
                Modifier.isStatic(method.getModifiers()) &&
                method.getReturnType().equals(Void.class));
    }

    public void run() {
        Method mainMethod = null;

        if ((mainMethod = getMainMethod(this.testClass)) == null) {
            //if there's no static void main method, throw exception
            throw new YouFuckedItUpException();
        }

        mainMethod.invoke(this.testClass, new String[0]);

        return heresWhereImStuckIWantToCaptureTheConsoleOutputAndReturnIt();
    }
} 
```

我所需要的只是一些代码或指向如何捕获被调用方法的 System.out 和 System.err 输出的答案的链接。有人可以提供的任何帮助将不胜感激。

提前致谢！

**编辑：**这不仅仅是为了测试，这最终将投入生产。

**编辑 2**：这将需要是线程安全的。其他线程可能会同时调用多个主要方法，我希望每个线程只捕获自己的特定输出。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-12T13:36:53.677

使用[System.setOut](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/System.html#setOut(java.io.PrintStream))，然后编写一个 printstream 的子类，该子类覆盖所有打印/写入方法，并在数据来自您要监视的线程时记录数据。

伪代码：

```
public class HackedPrintStream extends PrintStream {
    private PrintStream originalStream;
    private HashMap<Thread, PrintStream> loggerStreams = new HashMap<Thread, PrintStream>();

    public HackedPrintStream(PrintStream originalStream) {
        this.originalStream = originalStream;
    }

    public synchronized void logForThread(Thread threadToLogFor, PrintStream streamToLogTo) {
        loggerStreams.put(threadToLogFor, streamToLogTo);
    }

    /** example overridden print method, you need to override all */
    public synchronized void println(String ln) {
        PrintStream logPS = loggerStreams.get(Thread.currentThread());
        if (logPS != null) { logPS.println(ln); }
        originalStream.println(ln);
    }
} 
```

然后你可以创建和使用这个流

```
HackedPrintStream hps = new HackedPrintStream(System.out);
System.setOut(hps); 
```

不过，我真的建议您努力寻找另一种解决方案，因为这并不漂亮。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-12T13:47:36.630

既然您使用该`main()`方法 - 您是否需要它在同一个过程中？如果没有，您可以尝试将其创建为新进程 ( [`java.lang.Process`](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Process.html))。

该类提供了捕获和/或`Process`的必要方法。`StdOut``StdErr``StdIn`

*注意*由于一切都在它自己的进程中运行，因此线程安全应该没有问题。但是，您仍然需要找到 .class 文件（或至少根文件）所在的位置，以便您可以使用 .class 运行/创建进程`java here.goes.your.ClassName`。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-04-12T13:39:10.083

您可以使用 System.setOut() 和 System.setErr() 但当然，程序的其余部分也将捕获输出。

# c# - 使用来自一个特定线程的对象

> ID：741781
> 
> 赞同：2
> 
> 时间：2009-04-12T13:35:42.057
> 
> 标签：c#, multithreading, com

我有一个在 dotnet 中使用的 COM 对象，我必须始终在同一个线程上调用它。问题在于，从概念上讲，它在整个程序中都适用于多种事物。确保在这个特定的后台线程上调用此对象的所有使用的最佳方法是什么？示例代码会很棒。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T13:42:26.847

你可以在程序启动时启动一个线程，它应该处理所有的 COM 交互。然后你可以有一个包装对象，它将任务推送到队列中以供线程处理。

包装器可以包含同步代码，以便向调用者隐藏多线程（即，将包装的调用公开为同步方法）。

如果这是一个 WinForms 项目，也许您可​​以通过简单地使用 GUI 线程和 Control.Invoke 方法来偷工减料。（但如果调用需要很长时间，这不是一个好主意，因为您会在调用期间阻塞 UI）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T13:45:54.217

如果您可以在 STA 下使用该对象，则可以在同一线程上调用它。
为此，您需要在 Main 上添加[STAThreadAttribute 。](http://msdn.microsoft.com/en-us/library/system.stathreadattribute.aspx)
唯一的问题是**所有**COM 对象都将以这种方式处理。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T13:46:26.417

为了做到这一点，您必须首先建立一种方法来获得对特定线程的特定调用。.Net 有几种内置机制可以做到这一点，但我发现最简单的是 SynchronizationContext 类。WinForms 和 WPF 都为它们正在运行消息循环的任何线程建立一个 SynchronizationContext 实例。

所以我会...

*   为对象启动一个新线程
*   创建一个隐藏的 WinForms 或 WPF 窗口并运行它
*   获取该线程的 SynchronizationContext
*   在该线程上创建 COM 对象

现在，您有了 COM 对象的位置以及调用正确线程的方法。下一步是创建一个代理对象。该对象应该具有 COM 对象的所有方法（并且可能只实现 COM 接口）。然后它会使用同步上下文将每个方法调用和代理调用到真正的 COM 对象。

```
public class Foo {
  private ComFoo _com;
  private SynchronizationContext _context;
  public void Bar() { 
    _context.Send(notUsed => _com.Bar(););
  }
} 
```

# c# - 即使列是整数，如何在 Select 语句的 IN 子句中提供 Id 字符串

> ID：741789
> 
> 赞同：1
> 
> 时间：2009-04-12T13:41:43.073
> 
> 标签：c#, parameters, sqlcommand, sql

我正在使用 an 分页数据，`ObjectDataSource`并且我有以下方法：

```
public int GetNumberOfArticles(string employeeIds)
{
    System.Data.DataTable dataTable;
    System.Data.SqlClient.SqlDataAdapter dataAdapter;
    System.Data.SqlClient.SqlCommand command;

    int numberOfArticles = 0;

    command = new System.Data.SqlClient.SqlCommand();
    command.Connection = Classes.Database.SQLServer.SqlConnection;

    command.CommandText = @"SELECT COUNT(*)
                            FROM 
                                  [Articles]
                            WHERE 
                                  [Articles].[EmployeeID] IN (@EmployeeIds)";

    command.Parameters.AddWithValue("@EmployeeIds", employeeIds);
    numberOfArticles = (int)command.ExecuteScalar();
    return numberOfArticles;
} 
```

**EmployeeID**是一个整数，因此，我放入的任何内容`employeeIds`都将转换为整数。但是，因为我使用的是`IN`关键字，很明显我想`employeeIds`用逗号分隔的 id 列表替换：

```
1, 2, 3 
```

但是当我更换线路时：

```
command.Parameters.AddWithValue("@EmployeeIds", employeeIds); 
```

有类似的东西：

```
command.Parameters.AddWithValue("@EmployeeIds", "1, 2, 3"); 
```

我收到一个异常，因为我提供了一个字符串，而`EmployeeIds`它是一个整数。那么，我将如何去做呢？

谢谢。

**编辑：**

从回复中，我了解到这必须手动完成，但是包含此方法的类将由`ObjectDataSource`. 那么我怎样才能提供`employeeIds`运行时的值呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T13:47:50.327

这样做的唯一方法是在查询中手动解析字符串并将值插入内存表，然后在查询中加入内存表，而不是使用`IN`子句。

例如，[CodeProject 上的这个页面](http://www.codeproject.com/KB/database/splitparameterstring.aspx)展示了这个功能：

```
IF EXISTS(SELECT * FROM sysobjects WHERE ID = OBJECT_ID(’UF_CSVToTable’))
 DROP FUNCTION UF_CSVToTable
GO

CREATE FUNCTION UF_CSVToTable
(
 @psCSString VARCHAR(8000)
)
RETURNS @otTemp TABLE(sID VARCHAR(20))
AS
BEGIN
 DECLARE @sTemp VARCHAR(10)

 WHILE LEN(@psCSString) > 0
 BEGIN
  SET @sTemp = LEFT(@psCSString, ISNULL(NULLIF(CHARINDEX(',', @psCSString) - 1, -1),
                    LEN(@psCSString)))
  SET @psCSString = SUBSTRING(@psCSString,ISNULL(NULLIF(CHARINDEX(',', @psCSString), 0),
                               LEN(@psCSString)) + 1, LEN(@psCSString))
  INSERT INTO @otTemp VALUES (@sTemp)
 END

RETURN
END
Go 
```

然后你可以像这样使用它：

```
SELECT                          
    COUNT(*)
FROM 
    [Articles]

JOIN dbo.UF_CSVToTable(@EmployeeIds) ids on ids.sID = [Articles].[EmployeeID] 
```

但最终，这通常不是一个好习惯。但是，如果有必要，那么这种方法应该以一种非常简单的方式提供给您。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-12T14:21:02.400

您可以使用字符串连接创建这样的 SQL 语句：

“选择...输入（@id1，@id2，@id3）”

接着：

command.Parameters.AddWithValue("@id1", employeeIds[0]); command.Parameters.AddWithValue("@id2", employeeIds[1]); command.Parameters.AddWithValue("@id3", employeeIds[2]);

（当然使用 for 循环）。

这样，您仍然可以使用参数插入值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-12T14:53:53.010

与[此问题](https://stackoverflow.com/questions/337704/parameterizing-a-sql-in-clause/337792#337792)类似，您需要在运行时为每个值添加一个参数：

```
public int GetNumberOfArticles(string employeeIds)
{
    System.Data.DataTable dataTable;
    System.Data.SqlClient.SqlDataAdapter dataAdapter;
    System.Data.SqlClient.SqlCommand command;

    int numberOfArticles = 0;

    command = new System.Data.SqlClient.SqlCommand();
    command.Connection = Classes.Database.SQLServer.SqlConnection;

    string params = string.Join(",", employeeIds.Select((e, i)=> "@employeeId" + i.ToString()).ToArray());
    command.CommandText = @"SELECT                          
                               COUNT(*)
                            FROM 
                               [Articles]
                            WHERE 
                               [Articles].[EmployeeID] IN (" + params + ")";

    for (int i = 0; i < employeeIds.Length; i++) {
       command.Parameters.AddWithValue("@employeeId" + i.ToString(), employeeIds[i]);
    }

    numberOfArticles = (int)command.ExecuteScalar();

    return numberOfArticles;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-12T14:00:03.230

参数是一个不同的值，不能像您尝试那样用于动态创建 SQL 语句。您将需要使用字符串连接创建 SQL 语句，这可能很简单：

```
command.CommandText = @"SELECT COUNT(*) FROM [Articles] " +
    "WHERE [Articles].[EmployeeID] IN (" + employeeIds + ")"; 
```

但是，如果它来自用户输入，则需要对 employeeIds 字符串进行清理，以避免 SQL 注入漏洞。您可以通过将字符串拆分为数组并解析每个元素以检查它是否为 int 来做到这一点。如果它通过，那么您可以在连接之前将数组重新加入字符串。

# iphone - 如果用户选择美式英语但我只提供“英语”会怎样？

> ID：741802
> 
> 赞同：0
> 
> 时间：2009-04-12T13:50:14.753
> 
> 标签：iphone, internationalization

例如：我的`en.lproj`应用程序包中有一个包含所有`English`内容的子目录。

现在，Apple 表示用户不仅可以选择一种语言，还可以选择某种方言。所以我们这里可能有“美式英语”或“英式英语”。用户可能会选择美式英语，那么接下来会发生什么？

据我了解，系统会寻找一个`en_US.lproj`子目录。是否足够聪明地看到：“哦，不，没有`en_US.lproj`，但是有一个`en.lproj`”？或者它会像面包一样愚蠢，然后选择`fr.lproj`或`de.lproj`？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-12T14:09:38.480

我看到两个解决方案：

*   将“en”设置为默认开发语言（在您的 Info.plist 中），
*   每次进行分发构建时将 en.lproj 目录复制到 en_US.lproj 目录（如果您的默认语言不是英语）。

但也许在“en_US”之后，系统会寻找“en”。我不知道..

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T14:10:26.920

根据[官方文档](https://developer.apple.com/iphone/library/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/ApplicationEnvironment/ApplicationEnvironment.html#//apple_ref/doc/uid/TP40007072-CH7-SW23)中的“提示” （以及常识），我假设它将从“en_US”回退到“en”（文档说，该区域`_US`是可选的。

但是我记得苹果开发论坛中的一些帖子，如果存在，“en”优于“en_US”。但我可能弄错了。

# java - 关闭 SAX 解析器在解析过程中读取的流的最佳方法是什么？

> ID：741813
> 
> 赞同：0
> 
> 时间：2009-04-12T14:01:39.063
> 
> 标签：java, sockets, stream, sax, jaxp

让我们直接回答我的问题：我有一个套接字，通过这个套接字/流的所有输入都由我的 SAX 解析器解析。现在，对于某个解析事件，我想从我的 SAX 事件处理程序中关闭套接字/流。另外，我想在解析器仍在工作时从外部关闭流。不幸的是，如果没有解析器抛出异常（意外的文档结束......），我无法做一件事或另一件事。好的，我可以捕捉到这个异常，但是您知道如何安全关闭流的解决方案吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-12T14:43:39.727

我认为你不能轻易做到这一点。您为 SAX 解析器提供了一个可供读取的资源（流），然后您将其关闭，而 SAX 解析器仍希望从中读取 - 因此它（并非不合理！）抛出“意外的文档结尾”。

如果您想干净地执行此操作，我认为您已实现的 SAX 解析器[处理程序](http://java.sun.com/j2se/1.4.2/docs/api/org/xml/sax/helpers/DefaultHandler.html)应该在您决定忽略更多事件后静默吞下事件。

例如，您的 等的实现`startElement()`应该`endElement()`在处理之前检查您是否仍然对这些事件感兴趣。

这样，SAX 解析器就可以干净地运行到文档的末尾，而无需您处理任何更多的事件。

或者，为什么不记录您已关闭输入流的事实，然后当您收到“意外的文档结束”事件时，看看它是否确实*是*预期的。并且仅在确实出乎意料时才记录错误。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T15:31:57.800

如果您控制文档生成端，您可以设置关闭请求消息发送回服务器并结束传入文档。根据您完整系统的详细信息，这要么是一个丑陋的黑客，要么是一个优雅的解决方案...... :)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T23:36:58.500

这可能很明显，但对于这样的用例，[Stax 解析器](http://woodstox.codehaus.org)可能更合适。由于应用程序通过迭代控制读取，它可以在任何给定点关闭解析器和底层流。使用 SAX，您将不得不抛出一个异常，这不是特别优雅或高效。另外，您只能在处理程序中执行此操作。

对于加分，[StaxMate](http://staxmate.codehaus.org/Tutorial)可以让使用 Stax 更愉快；没有它，Stax 具有与 SAX 相似的低抽象级别。

最后：如果您的问题是由于套接字而导致的阻塞，那么使用传统的基于阻塞 IO 的 xml 解析器可能很难解决。有一个开源的 xml 解析器可以进行非阻塞（异步）解析，但它鲜为人知，所以我将把这个发现留给感兴趣的读者。:-)

# vim - 在 Vim 中上下移动整行

> ID：741814
> 
> 赞同：342
> 
> 时间：2009-04-12T14:02:53.333
> 
> 标签：vim, vi

在 Notepad++ 中，我可以使用++ `Ctrl`/来上下移动当前行。Vim中是否有类似的命令？我浏览了无尽的指南，但一无所获。`Shift``Up``Down`

如果没有，我如何将操作绑定到该组合键？

编辑：Mykola 的答案适用于所有行，除了缓冲区开头和结尾的那些。将第一行向上或底线向下移动会删除该线，而当将底线向上移动时，它最初会跳过两个空格，就像一个棋子！任何人都可以提供任何改进吗？

* * *

## 回答 #1

> 赞同：631
> 
> 时间：2009-04-12T14:06:02.610

如果我想将一行与上面的行交换，我通常会执行以下操作

```
ddkP 
```

解释

*   dd 将删除该行并将其添加到默认寄存器中。
*   k 将向上移动一条线（j 将向下移动一条线）
*   P 将粘贴在当前行上方

* * *

## 回答 #2

> 赞同：250
> 
> 时间：2012-09-24T17:24:12.597

假设光标在您想要移动的线上。

上下移动： [`:m`](http://vimdoc.sourceforge.net/htmldoc/change.html#:m)移动

`:m +1`- 下移 1 行

`:m -2`- 上移 1 行

（请注意，您可以将 +1 替换为任何数字，具体取决于您要向上或向下移动多少行，即 +2 会将其向下移动 2 行，-3 会将其向上移动 2 行）

移动到特定行

[`:set number`](http://vimdoc.sourceforge.net/htmldoc/various.html#:number)- 显示数字行（更容易看到你将它移动到哪里）

`:m 3`- 在第 3 行之后移动该行（将 3 替换为您想要的任何行）

移动多行：

[`V`](http://vimdoc.sourceforge.net/htmldoc/visual.html#V)（即`Shift`- `V`）并上下移动 courser 以在 VIM 中选择多行

一旦选择命中`:`并运行上面的命令`m +1`等

* * *

## 回答 #3

> 赞同：86
> 
> 时间：2009-04-12T14:06:11.720

将以下内容放入您的 .vimrc 以完成工作

```
noremap <c-s-up> :call feedkeys( line('.')==1 ? '' : 'ddkP' )<CR>
noremap <c-s-down> ddp 
```

该行的消失看起来像一个 Vim 错误。我放了一个技巧来避免它。可能有一些更准确的解决方案。

**更新**

仅使用 Vim 组合有很多无法解释的困难。这些是线路缺失和额外的线路跳跃。

所以这里是脚本解决方案，可以放在 .vimrc 或 ~/.vim/plugin/swap_lines.vim 中

```
function! s:swap_lines(n1, n2)
    let line1 = getline(a:n1)
    let line2 = getline(a:n2)
    call setline(a:n1, line2)
    call setline(a:n2, line1)
endfunction

function! s:swap_up()
    let n = line('.')
    if n == 1
        return
    endif

    call s:swap_lines(n, n - 1)
    exec n - 1
endfunction

function! s:swap_down()
    let n = line('.')
    if n == line('$')
        return
    endif

    call s:swap_lines(n, n + 1)
    exec n + 1
endfunction

noremap <silent> <c-s-up> :call <SID>swap_up()<CR>
noremap <silent> <c-s-down> :call <SID>swap_down()<CR> 
```

* * *

## 回答 #4

> 赞同：83
> 
> 时间：2012-02-23T06:30:27.257

向上移动一行：`ddkP`

下移一行：`ddp`

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2015-01-28T07:07:07.980

将以下内容添加到 ~/.vimrc 文件中（确保没有 n,m 的映射）

```
nmap n :m +1<CR>
nmap m :m -2<CR> 
```

现在按下`n`键将向下移动一行并向`m`上移动一行。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2010-03-13T20:05:33.613

这对我有用：

[http://vim.wikia.com/wiki/Moving_lines_up_or_down_in_a_file](http://vim.wikia.com/wiki/Moving_lines_up_or_down_in_a_file)

顺便说一句，如果你想使用 ALT+some_key 并且你的终端（urxvt 这样做）拒绝遵守，你应该在你的 .vimrc 中输入这样的内容：

```
" For moving lines (^] is a special character; use <M-k> and <M-j> if it works)
nnoremap ^]k mz:m-2<CR>`z==
inoremap ^]j <Esc>:m+<CR>==gi
inoremap ^]k <Esc>:m-2<CR>==gi
vnoremap ^]j :m'>+<CR>gv=`<my`>mzgv`yo`z
nnoremap ^]j mz:m+<CR>`z==
vnoremap ^]k :m'<-2<CR>gv=`>my`<mzgv`yo`z 
```

其中 ^] 是表示 ALT 键**的单个字符。**要输入该字符，`C+v, Esc`请在 Vim 中使用（`C+q, Esc`在 Windows 上）。

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2011-09-17T10:46:39.380

在命令模式下，将光标放在要向下移动的行上，然后

```
ddp 
```

说明： dd 将当前行删除到通用缓冲区 p 将其放回光标位置之后，或者如果是整行，则在下一行。

许多文档中关于命令 p 和 P 存在一些混淆。实际上 p 粘贴在光标之后，然后粘贴在光标处。

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2010-11-08T06:48:12.743

只需将此代码添加到 .vimrc（或 .gvimrc）

```
nnoremap <A-j> :m+<CR>==
nnoremap <A-k> :m-2<CR>==
inoremap <A-j> <Esc>:m+<CR>==gi
inoremap <A-k> <Esc>:m-2<CR>==gi
vnoremap <A-j> :m'>+<CR>gv=gv
vnoremap <A-k> :m-2<CR>gv=gv 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2011-10-21T00:29:55.587

**正是您**在这些插件中寻找的内容：

*   [https://github.com/vim-scripts/upAndDown](https://github.com/vim-scripts/upAndDown)
*   [https://github.com/matze/vim-move](https://github.com/matze/vim-move)

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2017-07-18T12:49:32.750

一个**简单的解决方案**是放入您的`.vimrc`这些行：

```
nmap <C-UP> :m-2<CR>  
nmap <C-DOWN> :m+1<CR> 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2013-07-25T14:07:34.690

我将以下内容放在 .vimrc 文件的末尾：

```
noremap H ddkkp
noremap N ddp 
```

所以现在'H'和'N'分别上下移动当前行。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2018-05-03T09:49:54.007

当你点击命令`:help move`时`vim`，结果如下：

`:[range]m[ove] {address} *:m* *:mo* *:move* *E134* Move the lines given by [range] to below the line given by {address}.`

**例如：** *将当前行向下移动一行 =>* `:m+1`。

**例如：** *将编号为 100 的行移动到编号为 80 的行下方 =>* `:100 m 80`。

**例如：** *将编号为 100 的行移到编号为 200 的行下方 =>* `:100 m 200`。

**例如：** *将编号在 [100, 120] 内的行移动到编号为 200 => 的行下方* `:100,120 m 200`。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2018-10-14T19:20:41.207

对我来说，`ddkkp`做到了（而不是`ddkP`使用大写的 P，这也可以）。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2021-06-20T12:58:46.770

最简单的方法与 vscode 相同。将以下行添加到 .vimrc

```
"Ctrl+Shift+up move line above"
nmap <C-S-Up> :m -2<CR>

"Ctrl+Shift+down move line below
nmap <C-S-Down> :m +1<CR> 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2010-07-11T22:13:07.590

这是 MacVim 的简化版本，使用 Wikia 文章示例（参见*gun*评论中的链接）。

```
" Move selection up/down (add =gv to reindent after move)
:vmap <D-S-Up> :m-2<CR>gv
:vmap <D-S-Down> :m'>+<CR>gv 
```

我只使用块选择变体，因为只需要 Shift-V 来选择当前行，并且可以选择上/下光标来选择更多行。

根据上面的快捷键，按下 Cmd-Shift-Up/Down 将向上/向下移动块选择。“D”是 MacVim 中的 Command 键，对于 Windows，请尝试“C”（Control）或“A”（Alt）（例如，<CAf> 将是 Control Alt f）。

Wikia 文章在其中添加了“=gv”，这具有根据周围文本调整移动后块的缩进的效果。这很令人困惑，所以我将其删除，并添加了用于快速缩进选择的快捷方式。

```
" Indent selection left/right (Cmd Shift Left/Right is used for Tab switching)
:vmap <D-A-Left> <gv
:vmap <D-A-Right> >gv 
```

请注意，<< 和 >> 也可以这样做，但是选择会丢失，因此上面的这些快捷方式允许多次缩进并且仍然移动块，因为选择保持不变。

我的 MacVim 配置为使用 Cmd-Shift-Left/Right 切换选项卡，因此我使用了 Cmd-Alt-Left/Right。

这是 MacVim 的 Tab 切换（将 .gvimrc 与上面的其余部分一起放入）：

```
:macm Window.Select\ Previous\ Tab key=<D-S-Left>
:macm Window.Select\ Next\ Tab key=<D-S-Right> 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2012-05-17T21:54:45.697

vim 插件 unimpaired.vim [e 和 ]e

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2018-04-27T23:23:41.603

如果您想在与特定搜索匹配的多行上执行此操作：

*   向上：`:g/Your query/ normal ddp`或`:g/Your query/ m -1`
*   向下`:g/Your query/ normal ddp`或`:g/Your query/ m +1`

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2018-05-31T08:05:58.037

**这是适用于我的机器的解决方案** ：运行 VIM 8.1 的 MacBook Pro

这些命令不会删除缓冲区顶部或底部的行。

使用 Alt-J 和 Alt-K 输出的实际符号是其键码在我的环境中未正确映射的一种解决方法。

*把它放在旧的**.vimrc**中，看看是否适合你。*

```
" Maps Alt-J and Alt-K to macros for moving lines up and down
" Works for modes: Normal, Insert and Visual
nnoremap ∆ :m .+1<CR>==
nnoremap ˚ :m .-2<CR>==
inoremap ∆ <Esc>:m .+1<CR>==gi
inoremap ˚ <Esc>:m .-2<CR>==gi
vnoremap ∆ :m '>+1<CR>gv=gv
vnoremap ˚ :m '<-2<CR>gv=gv 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2020-11-19T12:19:38.787

可以使用命令：

```
:g/^/move 0 
```

参考：[https ://vi.stackexchange.com/questions/2105/how-to-reverse-the-order-of-lines](https://vi.stackexchange.com/questions/2105/how-to-reverse-the-order-of-lines)

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2012-09-24T12:41:13.247

:m.+1 或 :m.-2 如果您要移动单行，则可以。这是我移动多行的脚本。在视觉模式下，Alt-up/Alt-down 将包含视觉选择的行向上/向下移动一行。在插入模式或普通模式下，如果没有给出计数前缀，Alt-up/Alt-down 将移动当前行。如果有计数前缀，Alt-up/Alt-down 将从当前行开始向上/向下移动那么多行。

```
function! MoveLines(offset) range
    let l:col = virtcol('.')
    let l:offset = str2nr(a:offset)
    exe 'silent! :' . a:firstline . ',' . a:lastline . 'm'
        \ . (l:offset > 0 ? a:lastline + l:offset : a:firstline + l:offset)
    exe 'normal ' . l:col . '|'
endf

imap <silent> <M-up> <C-O>:call MoveLines('-2')<CR>
imap <silent> <M-down> <C-O>:call MoveLines('+1')<CR>
nmap <silent> <M-up> :call MoveLines('-2')<CR>
nmap <silent> <M-down> :call MoveLines('+1')<CR>
vmap <silent> <M-up> :call MoveLines('-2')<CR>gv
vmap <silent> <M-down> :call MoveLines('+1')<CR>gv 
```

# php - 从 mySQL 数据库中回显一个整数

> ID：741823
> 
> 赞同：1
> 
> 时间：2009-04-12T14:08:15.553
> 
> 标签：php, mysql, integer, echo

我正在尝试制作一个用户在一个屏幕上输入详细信息的网站，并将它们发布到以下脚本中。该脚本旨在将这些详细信息与唯一的整数 ID（它确实如此）一起存储在数据库中，然后生成两个包含刚刚创建的记录的唯一 ID 的链接。由于数据库创建了 ID 而不是之前的页面，我尝试在数据库中查询最近的记录（即具有最高唯一 ID 值的记录）并在链接中使用该数字，但是使用当前脚本ID 似乎没有显示在页面中。它是变量类型的东西吗？有没有更简单的方法来获取刚刚创建的页面的 ID？这是代码：

```
$css = $_POST['css'];
$shopName = strip_tags($_POST['title']);
$email = $_POST['email'];

$con = mysql_connect("***","***","***");
if (!$con)
{
    die('Could not connect to database: '. mysql_error());
}

mysql_select_db("***", $con);

$sql = "INSERT INTO wps_Shops (shopName, shopEmail, shopStyle)
    VALUES ('$shopName', '$email', '$css')";

$quer = mysql_query($sql);

$result = mysql_query("SELECT *
                    FROM wps_Shops
                    ORDER BY shopId DESC
                    LIMIT 1");

$lastShop = mysql_fetch_array($result);

$id = strval($lastShop['id']);

echo ("Id: ".$id);

if ($quer)
{
    echo("<h1>Shop created</h1>");
    echo("<p><a href=\"shop.php?id=$id\">Go to shop</a></p>");
    echo("<p><a href=\"addproducts.php?id=$id\">Add products</a></p>");
}

mysql_close($con); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T14:12:09.067

你需要[`mysql_insert_id`](http://www.php.net/manual/en/function.mysql-insert-id.php).

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-12T14:12:36.913

在执行`mysql_query()`插入操作后，您可以使用[mysql_insert_id()](http://au2.php.net/mysql-insert-id)来获取插入行的 ID。

```
mysql_query("INSERT INTO........");
$id=mysql_insert_id(); 
```

* * *

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-12T14:12:23.327

它叫“id”还是“shopId”？但你应该使用： http: [//php.net/mysql_insert_id](http://php.net/mysql_insert_id)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-12T14:18:32.063

或者，您可以进行以下 MySQL 查询：

```
$query = "SELECT * FROM wps_Shops WHERE id=LAST_INSERT_ID()";
$result = mysql_query($query); 
```

虽然我对你为什么使用*ORDER BY shopId*感到困惑，但在后面的电话中：

```
$id = strval($lastShop['id']); 
```

另外，真的有必要进行**strval()**调用吗？**当您调用echo()**时，PHP 已经为您进行了类型转换。**而且，目前，从mysql_query()**或**mysqli_query()**返回的任何结果数据都以字符串格式返回，而不管 MySQL 中该列的数据类型如何。

# sql-server - SQL 帐户是否会降低 MS SQL Server 2008 的安全性

> ID：741824
> 
> 赞同：2
> 
> 时间：2009-04-12T14:08:55.940
> 
> 标签：sql-server, security, sql-server-2008

我有 Microsoft SQL Server 2008，我们在其上托管了一些数据库。我们目前使用 Windows 集成进行身份验证。

我们开始需要对来自 ASP.NET 和其他应用程序的脚本进行身份验证的支持。这些应用程序需要使用“脚本凭据”，因为它们在没有用户登录的情况下运行。我们并不想像管理员那样使用集成登录来执行此操作，我们正在查看 SQL 身份验证。这样做会降低我们的安全性吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-12T14:47:26.800

是的，它确实。

使用可以配置为仅在某些服务器上运行的 NT 服务帐户。此外，您可以使用组策略应用任何权限（例如交互式登录）。

SQL 登录，虽然您可以使用 AD 组策略来获取密码等，但本质上更不安全

您不必在 SQL Server 上将此帐户设为 sysadmin

编辑：

系统和解决方案级别不安全的一些原因，而不是 SQL Server。

1.  密码必须是纯文本格式（代码、app.config 等）。对于运行 IIS 应用程序池的服务帐户，不必如此。

2.  对您使用的客户端计算机没有限制。也就是说，服务帐户可以限制为应用程序或 Web 服务器。

3.  您可能在某处仍需要 NFTS 或 UNC 权限：SQL 登录无法处理此问题。

# ios - 在 Objective-C 中获取时间

> ID：741830
> 
> 赞同：156
> 
> 时间：2009-04-12T14:12:09.410
> 
> 标签：ios, objective-c

我需要获取两个事件之间经过的时间，例如 UIView 的出现和用户的第一反应。

如何在 Objective-C 中实现它？

* * *

## 回答 #1

> 赞同：269
> 
> 时间：2009-04-12T14:15:09.607

```
NSDate *start = [NSDate date];
// do stuff...
NSTimeInterval timeInterval = [start timeIntervalSinceNow]; 
```

`timeInterval`是 start 和 now 之间的差异，以秒为单位，精度为亚毫秒。

* * *

## 回答 #2

> 赞同：235
> 
> 时间：2013-08-01T06:43:05.263

您不应该依赖于`[NSDate date]`计时目的，因为它可能会高估或低估经过的时间。甚至在某些情况下，您的计算机似乎会穿越，因为经过的时间是负数！（例如，如果时钟在计时期间向后移动。）

根据 Aria Haghighi 在[2013 年冬季斯坦福 iOS 课程](https://itunes.apple.com/us/course/coding-together-developing/id593208016)[`CACurrentMediaTime()`](https://developer.apple.com/documentation/quartzcore/1395996-cacurrentmediatime?language=objc)（34:00）的“Advanced iOS Gesture Recognition”讲座中所说，如果需要准确的时间间隔，则应使用。

目标-C：

```
#import <QuartzCore/QuartzCore.h> 
```

```
CFTimeInterval startTime = CACurrentMediaTime();
// perform some action
CFTimeInterval elapsedTime = CACurrentMediaTime() - startTime; 
```

迅速：

```
let startTime = CACurrentMediaTime()
// perform some action
let elapsedTime = CACurrentMediaTime() - startTime 
```

原因是`[NSDate date]`服务器上的同步，所以它可能导致“时间同步打嗝”，这可能导致非常难以跟踪的错误。`CACurrentMediaTime()`另一方面，是不会随着这些网络同步而改变的设备时间。

您需要[将](https://stackoverflow.com/a/19337932/35690)[QuartzCore 框架](https://developer.apple.com/documentation/quartzcore?language=objc)添加到目标的设置中。

注意：还有其他类似的 API`clock_gettime_nsec_np`也可以工作。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2009-07-09T14:48:51.473

使用`timeIntervalSinceDate`方法

```
NSTimeInterval secondsElapsed = [secondDate timeIntervalSinceDate:firstDate]; 
```

`NSTimeInterval`只是一个`double`，`NSDate`像这样定义：

```
typedef double NSTimeInterval; 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2012-05-21T12:04:54.710

对于任何来这里寻找 iOS 的 getTickCount() 实现的人，这是我在将各种资源放在一起之后的。

以前我在这段代码中有一个错误（我首先除以 1000000），这导致我的 iPhone 6 上的输出出现了一些量化（也许这在 iPhone 4/etc 上不是问题，或者我只是从未注意到它）。请注意，如果不先执行该除法，则如果时基的分子很大，则存在溢出的风险。如果有人好奇，这里有一个包含更多信息的链接：[https ://stackoverflow.com/a/23378064/588476](https://stackoverflow.com/a/23378064/588476)

鉴于该信息，使用Apple的功能可能更安全`CACurrentMediaTime`！

我还对`mach_timebase_info`调用进行了基准测试，在我的 iPhone 6 上大约需要 19ns，因此我删除了缓存该调用输出的（非线程安全的）代码。

```
#include <mach/mach.h>
#include <mach/mach_time.h>

uint64_t getTickCount(void)
{
    mach_timebase_info_data_t sTimebaseInfo;
    uint64_t machTime = mach_absolute_time();

    // Convert to milliseconds
    mach_timebase_info(&sTimebaseInfo);
    machTime *= sTimebaseInfo.numer;
    machTime /= sTimebaseInfo.denom;
    machTime /= 1000000; // convert from nanoseconds to milliseconds

    return machTime;
} 
```

根据时基调用的输出，请注意潜在的溢出风险。我怀疑（但不知道）它可能是每个 iPhone 型号的常数。在我的 iPhone 6 上是`125/3`.

使用的解决方案`CACurrentMediaTime()`非常简单：

```
uint64_t getTickCount(void)
{
    double ret = CACurrentMediaTime();
    return ret * 1000;
} 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-04-12T15:06:25.723

对于精确的时间测量（如 GetTickCount），还可以查看 mach_absolute_time 和这个 Apple Q&A：http: [//developer.apple.com/qa/qa2004/qa1398.html](http://developer.apple.com/qa/qa2004/qa1398.html)。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-04-12T14:16:25.250

使用 NSDate 类的 timeIntervalSince1970 函数，如下所示：

```
double start = [startDate timeIntervalSince1970];
double end = [endDate timeIntervalSince1970];
double difference = end - start; 
```

基本上，这就是我用来比较 2 个不同日期之间的秒数差异的方法。[也在这里](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/nsdate_Class/Reference/Reference.html#//apple_ref/doc/uid/20000188-timeIntervalSince1970)检查这个链接

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-09-12T07:51:06.063

其他答案是正确的（有一个警告*）。我添加这个答案只是为了展示一个示例用法：

```
- (void)getYourAffairsInOrder
{
    NSDate* methodStart = [NSDate date];  // Capture start time.

    // … Do some work …

    NSLog(@"DEBUG Method %s ran. Elapsed: %f seconds.", __func__, -([methodStart timeIntervalSinceNow]));  // Calculate and report elapsed time.
} 
```

在调试器控制台上，您会看到如下内容：

```
DEBUG Method '-[XMAppDelegate getYourAffairsInOrder]' ran. Elapsed: 0.033827 seconds. 
```

* * *

*警告：正如其他人提到的，用于`NSDate`计算经过时间仅用于临时目的。一个这样的目的可能是常见的测试，粗略的分析，你只是想大致了解一种方法需要多长时间。

风险在于，由于网络时钟同步，设备时钟的当前时间设置可能随时更改。所以`NSDate`时间可以随时向前或向后跳跃。

# c++ - 如何避免在高内存使用应用程序中耗尽内存？C / C++

> ID：741834
> 
> 赞同：13
> 
> 时间：2009-04-12T14:13:27.817
> 
> 标签：c++, c, memory, virtual-memory

我编写了一个转换器，它接受 openstreetmap xml 文件并将它们转换为二进制运行时渲染格式，该格式通常约为原始大小的 10%。输入文件大小通常为 3gb 或更大。输入文件不会一次全部加载到内存中，而是在收集点和多边形时进行流式传输，然后在它们上运行 bsp 并输出文件。最近在较大的文件上，它会耗尽内存并死掉（有问题的文件有 1400 万个点和 100 万个多边形）。通常，当这种情况发生时，我的程序使用大约 1gb 到 1.2gb 的内存。我尝试将虚拟内存从 2 增加到 8GB（在 XP 上），但这种更改没有效果。此外，由于此代码是开源的，我希望它能够在任何可用内存（尽管速度较慢）的情况下运行，它可以在 Windows、Linux 和 Mac 上运行。

我可以使用哪些技术来避免内存不足？在较小的子集中处理数据，然后合并最终结果？使用我自己的虚拟内存类型的处理程序？还有其他想法吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-12T14:23:28.900

首先，在 32 位系统上，无论页面文件设置如何，您都将始终被限制为 4 GB 内存。（其中，Windows 上的进程只有 2GB 可用。在 Linux 上，您通常有大约 3GB 可用）

因此，第一个明显的解决方案是切换到 64 位操作系统，并将您的应用程序编译为 64 位。这为您提供了巨大的虚拟内存空间供您使用，并且操作系统将根据需要在页面文件中交换数据以保持工作正常。

其次，一次分配较小的内存块可能会有所帮助。找到 4 256MB 的空闲内存块通常比找到一个 1GB 的块更容易。

第三，分解问题。不要一次处理整个数据集，而是尝试一次只加载和处理一小部分。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-12T14:15:37.517

听起来您已经在使用基于[SAX](http://en.wikipedia.org/wiki/Simple_API_for_XML)的 XML 处理方法（在进行时加载 XML，而不是一次全部加载）。

解决方案几乎总是改变算法，以便将问题分成更小的部分。物理上不要一次分配尽可能多的内存，只读入你需要的东西，处理它，然后写出来。

您有时可以在算法需要时通过使用硬盘驱动器来扩展内存。

如果你不能拆分你的算法，你可能想要[内存映射文件](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2006/n2044.html)之类的东西。

在最坏的情况下，如果您在 Windows 系统上，您可以尝试使用类似[VirtualAlloc的东西。](http://msdn.microsoft.com/en-us/library/aa366887(VS.85).aspx)如果您使用的是 32 位系统，则可以尝试使用[物理地址扩展 (PAE)](http://msdn.microsoft.com/en-us/library/aa366796(VS.85).aspx)之类的东西。

您还可以考虑为您的程序设置输入限制，并为 32 位和 64 位系统设置不同的输入限制。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-12T14:23:17.200

您是否检查过以确保您没有在任何地方泄漏内存？

由于您的程序可移植到 Linux，因此我建议在 Valgrind 下运行它以确保。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-12T14:38:50.220

我怀疑您的内存问题是由于将 BSP 树保留在内存中。因此，将 BSP 保留在磁盘上，并且只在内存中保留一些块。使用 BSP 这应该相当容易，因为该结构比其他一些树结构更适合自己，并且逻辑应该很简单。为了既高效又对内存友好，您可以使用带有脏标志的缓存，将缓存大小设置为可用内存，以减少呼吸空间。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-12T14:33:59.250

假设您使用的是 Windows XP，如果您刚刚超出内存限制并且不希望或没有时间按照上面的建议重新编写代码，您可以将 /3GB 开关添加到您的[boot.ini](http://technet.microsoft.com/en-us/sysinternals/bb963892.aspx)文件，然后它只是一个设置链接器开关以获得额外的 1GB 内存的问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-12T16:02:06.200

您必须了解虚拟内存与“RAM”的不同之处在于您使用的虚拟内存量是您保留的总量，而实际内存（在 Windows 中称为工作集）是您拥有的内存实际修改或锁定。

正如其他人指出的那样，在 32 位 Windows 平台上，虚拟内存的限制为 2 GB，除非您将特殊标志设置为 3 GB，并且可以确保代码和您使用的任何库中的所有指针都只使用无符号指针。

因此，要么强制用户使用 64 位，要么监控您的虚拟内存，并将您的最大块大小限制在适合 32 位操作系统所施加的限制的范围内，这都是我的建议。

我在 Windows 中撞上了 32 位墙，但没有解决 Linux 中这些限制的经验，所以我只讨论了 Windows 方面的事情。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-12T16:20:18.590

在 32 位 XP 上，您的最大程序地址空间为 2GB。然后，由于 DLL 和驱动程序加载到您的地址空间，您会产生碎片。最后，您遇到了堆碎片的问题。

你最好的办法就是结束它并作为 64 位进程运行（在 64 位系统上）。突然间，所有这些问题都消失了。您可以使用更好的堆来减轻堆碎片的影响，并且可以尝试使用 VirtualAlloc 在一个大的连续块中获取您的内存（然后您可以从那里管理它！）以阻止 DLL/驱动程序对其进行碎片化。

最后，您可以跨进程拆分 BSP。复杂而痛苦，坦率地说，把它放在磁盘上会更容易，但理论上你可以通过让一组进程交换信息来获得更好的性能，如果你可以让所有东西都驻留（假设你可以比内存更聪明比操作系统可以处理文件缓冲......这是一个很大的如果）。每个进程需要的内存要少得多，因此不应达到 2GB 地址空间限制。当然，你会更快地消耗 RAM/swap。

您可以通过分配较小的块来减轻地址空间碎片的影响。这将产生其他令人讨厌的副作用，但您可以遵循退避策略，如果您未能成功分配，您可以获取越来越小的内存块。通常，这种简单的方法会为您提供一个在其他情况下无法正常工作的程序，但在其余时间都可以正常运行。

男孩，64 位计算听起来不是比其他选择好得多吗？

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-12T17:34:36.477

您如何为积分分配内存？您是否一次分配一个点（例如 pt = new Point ）。然后根据点的大小，可能会浪费一些内存。例如，在 windows 上，内存是按 16 字节的倍数分配的，所以即使你要求尝试分配 1 字节，操作系统实际上也会分配 16 字节。

如果是这种情况，使用内存分配器可能会有所帮助。您可以使用 STL 分配器进行快速检查。（为 Point 类重载 new 运算符并使用 STL 分配器分配内存，而不是“malloc”或默认的 new 运算符）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-12T18:56:24.830

您可能没有以最佳方式分配和释放内存。正如其他人指出的那样，您可能正在泄漏内存并且不知道它。调试和优化内存分配需要时间。

如果您不想花时间优化内存使用，何不试试[Conservative Garbage Collector](http://www.hpl.hp.com/personal/Hans_Boehm/gc/)呢？它是 malloc()/new 和 free() 的插件替代品。事实上， free() 是一个无操作的，所以你可以从你的程序中删除那些调用。相反，如果您按照前面的建议手动优化程序并管理内存池，那么您最终将完成 CGC 已经为您完成的大量工作。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-12T19:20:14.007

您需要流式传输您的输出和输入。如果您的输出格式不是面向流的，请考虑进行第二次传递。例如，如果输出文件以数据的校验和/大小开始，则在第一遍留出空间，稍后再寻找/写入该空间。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-12T14:23:53.160

听起来你正在做 txt 到二进制对话，那么为什么需要将整个数据保存在内存中？
你不能从 txt (xml) 中读取一个原语然后保存到二进制流吗？

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-12T18:04:53.703

如果你想独立于内存大小，你需要一个独立于大小的算法。无论您的 RAM 有多大，如果您无法控制内存使用情况，您就会碰到边界。

看一下您可以用来产生一些输出的最少信息块。然后想办法把输入分成这个大小的块。

现在这听起来很容易，不是吗？（很高兴我不必这样做:)）

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-13T14:20:52.517

你不需要切换到 64 位机器，也不需要别人建议的 1000 种东西中的大部分。你需要的是一个更周到的算法。

您可以采取以下措施来帮助解决这种情况：

*   如果您使用的是 Windows，请使用文件映射（[示例代码](http://msdn.microsoft.com/en-us/library/aa366548(VS.85).aspx)）。这将通过单个缓冲区指针访问文件，就像您在内存中读取整个文件一样，只是没有实际这样做。最新版本的 Linux 内核具有类似的机制。
*   如果可以并且看起来可以，请按顺序扫描文件并避免创建内存中的 DOM。这将大大减少您的加载时间以及内存需求。
*   使用池化内存！你可能会有很多微小的对象，比如节点、点等等。使用池化内存来提供帮助（我假设您使用的是非托管语言。搜索池化分配和内存池）。
*   如果您使用的是托管语言，请至少将此特定部分移动到非托管语言中并控制内存和文件读取。托管语言在内存占用和性能方面都有不小的开销。（是的，我知道这被标记为“C++”......）
*   尝试设计一种就地算法，一次只读取和处理最少量的数据，这样你的内存需求就会下降。

最后，让我指出，复杂的任务需要复杂的措施。如果你认为你买得起 8GB RAM 的 64 位机器，那么只需使用“将文件读入内存，处理数据，写输出”算法，即使需要一天才能完成。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-01-26T15:09:47.050

有一个很好的技术，就是将一些实例存储到文件中，并在需要时获取它们。

当需要大量内存时，许多开源软件（如 Doxygen）都使用这种技术来实现可扩展性。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-11-24T09:39:34.983

这是一个老问题，但是，因为我最近做了同样的事情......

没有简单的答案。在理想情况下，您将使用具有巨大地址空间（即 64 位）和大量物理内存的机器。仅仅巨大的地址空间是不够的，否则它会崩溃。在这种情况下，将 XML 文件解析到数据库中，并通过适当的查询提取您需要的内容。这很可能是 OSM 本身所做的（我相信世界大约是 330GB）。

实际上，出于权宜之计，我仍在使用 XP 32bit。

这是空间和速度之间的权衡。只要您不在乎需要多长时间，您就可以在任何数量的内存中做几乎任何事情。使用 STL 结构你可以解析任何你想要的东西，但是你很快就会耗尽内存。您可以定义自己的交换分配器，但同样，这将是低效的，因为映射、向量、集合等并不真正知道您在做什么。

我发现让这一切在 32 位机器上以较小的占用空间运行的唯一方法是非常仔细地考虑我在做什么以及何时需要什么，并将任务分解成块。内存效率高（从不使用超过 ~100MB），但速度不是很快，但没关系 - 需要多久解析一次 XML 数据？

# sql - 从多个聚簇表中统一查询数据

> ID：741837
> 
> 赞同：0
> 
> 时间：2009-04-12T14:15:17.000
> 
> 标签：sql, sql-server, database, cakephp, msde

我最近开始了一个项目，该项目涉及为一个相当老的软件创建一个基于 Web 的报告界面，该软件负责管理一些访问控制硬件，例如电子门锁。
我选择 CakePHP 来完成这项任务，它所涉及的只是查询数据库中的日志记录并将它们显示在网站上。该软件是用 C++ 编写的并使用 MSDE（Microsoft SQL Server 7.0 或 2000 的缩小版），我能够配置 CakePHP 以便它成功连接到数据库。

问题是该软件的开发人员选择通过为每天创建一个单独的表来将日志存储在数据库中。所以它看起来像这样：

```
tbl_DoorEvent_2008_08_07
tbl_DoorEvent_2008_08_08
tbl_DoorEvent_2008_08_09
tbl_DoorEvent_2008_08_10
... 
```

我对 MSDE 不是很熟悉，但我仍然怀疑设计和维护这样的数据库是否是一种可接受的做法。我不知道桌面软件如何在所有信息都采用这种格式时解析查询所有信息，但我的 CakePHP 应用程序很难理解这一点。

我想在 Web 应用程序中坚持使用 MVC，但我不知道如何在 CakePHP 中实现 DooreventModel，以便它从所有分区表中获取信息。
我试过实施一些技巧，比如使用

```
UNION ALL SELECT * FROM tbl_DoorEvent_2008_08_07
UNION ALL SELECT * FROM tbl_DoorEvent_2008_08_08
.... 
```

并且这种工作，但是当我想对整个查询或任何其他 SQL 运算符执行 WHERE 限制时，它不起作用。

还有一个要求是，基于 Web 的应用程序不添加或创建任何额外的数据库或表，而只使用现有的数据库或表来显示报告，因此创建一个包含所有集群表的巨大表并不是一个真正的选择。

我只是希望有人会想出一个 SQLServer 函数，每次我执行查询时都会为我将所有表合并为一个，但我知道这有点乐观，所以我真的愿意接受所有建议。请记住，该解决方案必须与 CakePHP 一起使用，并作为 MVC 中的单个模型

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-12T14:55:14.003

如果将联合放在子查询中，则可以使用 where 语句：

```
SELECT *
FROM (
    SELECT * FROM tbl_DoorEvent_2008_08_07
    UNION ALL 
    SELECT * FROM tbl_DoorEvent_2008_08_08
) sub
where sub.MyKey = MyValue 
```

或者创建一个视图：

```
CREATE VIEW vw_MyView
AS
SELECT * FROM tbl_DoorEvent_2008_08_07
UNION ALL 
SELECT * FROM tbl_DoorEvent_2008_08_08 
```

之后，您可以查询视图：

```
SELECT * from vw_MyView where MyKey = MyValue 
```

PS 切勿在生产查询中使用 *，尤其是视图。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T14:29:44.893

您可能想要一个[分区视图](http://msdn.microsoft.com/en-us/library/aa933141(SQL.80).aspx)？

# regex - tcsh：如何更改多个文件的文件扩展名？

> ID：741841
> 
> 赞同：1
> 
> 时间：2009-04-12T14:19:22.407
> 
> 标签：regex, linux, shell, tcsh

是否有一个单行命令`tcsh`来更改一组文件的扩展名？在各种 DOS shell 中，我曾经使用以下命令：

```
ren *.abc *.def 
```

这会将所有`.abc`以结尾的文件重命名为`.def`. 就`sed`其而言，这将执行如下操作：

```
sed -e 's/\(.\)*\.abc$/\1.def/' 
```

在文件名上。我可能会拼凑一些零碎的东西来在 *nix 中实现类似的东西，但我猜这里的问题是我缺乏使用`tcsh`.

任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-12T14:30:11.957

输入这四行。在第一个提示之后，tcsh 会告诉你你在`foreach`循环中。您也可以将其转换为 shell 脚本并调用该 shell 脚本。

```
foreach n ( `ls *.abc` )
set base = `basename $n .abc`
mv $n $base.def
end 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-12T16:27:25.873

除了其他人所说的之外，许多 UNIX 风格都提供了一个名为“ `rename`”的命令。如果您的目标是使用 重命名文件`tcsh`，那么这对您没有帮助。否则，您可以通过以下方式实现目标：

```
rename abc def *.abc 
```

这是一个非常简单且非常有用的命令。在第三个参数提供的文件列表中，它用第二个参数替换所有出现的第一个参数。至少在我熟悉的版本中，根本没有模式匹配，除非你的 shell 会在第三个参数的文件列表中扩展模式。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-12T14:24:42.690

我不知道是否`tcsh`提供了一种更简单的方法来做到这一点，但这是我通常做的：

```
ls *.abc | sed 's/\(.*\)\.abc/mv "\1.abc" "\1.def"/' | sh 
```

我还编写了一个名为`regexmv`使用正则表达式重命名文件的 Python 脚本。这是脚本：

```
import os
import re
import sys
import os.path

def main(argv):
    dry_run = True
    if argv[0] == '-f':
        dry_run = False
        argv = argv[1:]

    pattern = argv[0]
    repl    = argv[1]
    files   = argv[2:]

    max_length = max([len(f) for f in files])

    for f in files:
        new = re.sub(pattern, repl, f)
        if f != new:
            if not os.path.exists(new):
                print "%s --> %s" % (f.ljust(max_length), new)
                if not dry_run:
                    os.rename(f, new)

if __name__ == '__main__':
    main(sys.argv[1:]) 
```

我首先像这样运行它：

```
regexmv '\.abc$' '.def' * 
```

查看哪些文件将被重命名（以及它们将如何重命名），如果这是我想要的，我运行它：

```
regexmv -f '\.abc$' '.def' * 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-03-01T15:20:10.790

```
foreach f (*.abc)
mv $f $f:r.xyz
end 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-12T14:34:15.847

在 *nix 世界中没有“扩展”的概念。“点 abc”只是文件名的一部分。有一个 perl 脚本来模仿[这里](http://tips.webdesign10.com/files/rename.pl.txt)的行为。

很抱歉我不能提供 tcsh，但是有一个 bash 成语：

```
for f in *.foo; do
    mv $f ${f%foo}bar
done 
```

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-04-16T05:28:01.977

[整理答案 - 提问者从回复中得到了什么]：

在 tcsh 中更改一组文件的名称没有简单的方法。查斯。在 tcsh 中提供了最简单的解决方案，但仍然不容易。

如果您使用 tcsh 作为您的外壳程序，那么执行我所追求的最佳方法是使用外部重命名命令（请参阅 Eddie 的回答）。

我很欣赏这不是我在问题中实际提出的问题 - 但我了解到我的问题是错误的！

感谢所有回复的人，您的回答非常有帮助 - 每个人的方式都略有不同。如果有人想以比我更好的方式总结这个问题的结果，请这样做。我更愿意将我的“接受的答案”提供给其他人！

# database - 数据库字段的大小是否重要？

> ID：741846
> 
> 赞同：2
> 
> 时间：2009-04-12T14:22:56.420
> 
> 标签：database, database-design

我有一个数据库表，我们称之为国家。国家都有名称、简称和大洲。假设世界上任何一个国家的最长名称都是 54 个字符。我应该将最大大小设置为 54 还是应该将其设置为例如 64 或其他？我的选择会以任何方式影响查询或存储吗？

我知道这可能看起来像是预先优化，但我发现自己经常选择 32、64、128 等，我想知道这是否重要。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-12T14:25:46.617

一个可靠的 DBMS 应该知道什么是最适合它的。如果您需要“54 个字符”但数据库可以使用 64 个字符进行更好的搜索优化，它会在内部自动扩展数据字段。如果没有，您将每行保存 12 个字符。

我认为这不是您应该担心的事情，只需写下您需要的内容即可。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-12T14:25:16.837

答案将特定于 RDBMS：

如果您使用的是 SQL Server（2000 及更高版本），则 varchar 仅将空间用于存储在其中的实际字符（加上少量开销），直至声明的最大大小。

作为一般经验法则，在遇到问题之前不要进行优化。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-23T14:14:41.493

取决于数据类型。例如在 ORACLE 中 - varchar2 数据类型将是可变长度字符串的不错选择。您只需要定义字符串的最大长度 - varchar2(maxsize)。这意味着任何长度不超过 10 的字符串都适合。列的长度取决于存储在其中的实际字符串。

看。[链接文本](http://www.orafaq.com/faq/what_is_the_difference_between_varchar_varchar2_and_char_data_types)

在您的情况下，如果您绝对确定没有超过 54 个字符的国家/地区名称，我将使用大小为 54 的可变大小数据类型。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-12T14:33:01.233

如果您使用的是 SQL Server，我强烈建议您*不要*对所有字段使用 VARCHAR(8000) 或 VARCHAR(MAX) ......您需要在这里让常识占上风 - 使字段尽可能大可能需要它，为意外的长度添加一些额外的内容，你就完成了:-)

此外，我认为将它保持在您一遍又一遍地使用的几个长度是一个好主意。例如，我将 VARCHAR(255) 用于大多数字段，如街道地址或电子邮件等，可能会更长一些，VARCHAR(50) 用于电话号码等，而 VARCHAR(20) 用于邮政编码和这样的。

务实一点——找到适合你的风格。不要过度优化，但也不要反其道而行之。

马克

# iphone - iPhone sdk - 通过应用程序访问当前歌曲信息

> ID：741847
> 
> 赞同：9
> 
> 时间：2009-04-12T14:23:14.347
> 
> 标签：iphone

是否可以检索有关当前正在播放的歌曲的信息。我正在寻找艺术家和标题，以便我可以在应用程序上显示它？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-12T23:03:46.263

使用公开可用的 iPhone API（适用于 OS <= 2.2.1），无法从设备上的 iTunes 库中收集任何信息。可以使用非官方的方法来完成，但是，这种方法会导致 Apple 拒绝您的应用程序。

使用 iPhone OS 3.0 API，您可以使用如下内容：

```
MPMediaItem *nowPlayingMediaItem = [[MPMusicPlayerController iPodMusicPlayer] nowPlayingItem]; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-12T14:41:30.323

iPhone OS 2.0 目前还不可能，但是（在不破坏任何保密协议的情况下）3 月 17 日公开披露 iPhone OS 3.0 将添加一个新的 API，允许应用程序从 iPod 应用程序中提取元数据......我没有我自己没有查看 API，但如果您有 ADC 帐户，您应该查看 API。如果你能得到当前正在播放的歌曲，我不会感到惊讶......

# prolog - Prolog 在哪里用于交通控制系统？

> ID：741854
> 
> 赞同：3
> 
> 时间：2009-04-12T14:25:23.547
> 
> 标签：prolog, traffic

用户 Laurent 对这个问题 [为什么逻辑编程没有流行起来？] 有一个有趣的回答：

> 如果你看看逻辑编程在空中交通管制领域的影响，我认为不能说逻辑编程没有流行起来。

出现一个问题：

> prolog 在哪里用于道路交通控制系统？为什么在这样的环境中使用它而不是 C 或 Python 等语言？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T14:30:26.200

这篇论文[“大型 Prolog 知识库的商业应用”](http://www.springerlink.com/content/w22088q4038j5055/)可能很有趣。另一种这样的读物是（免费提供，而不是前者需要 Springer-Verlag 会员资格）[有限状态语法模型和空中交通管制员命令解析器](http://www.ece.uprm.edu/crc/crc2001/papers/moraima_valle.pdf)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-12T16:48:53.060

[Prolog 在实现专家系统](http://en.wikipedia.org/wiki/Expert_systems)时很有用。因此，如果您能想到一个对控制流量有用的专家系统，您可以使用 Prolog。我不是交通控制方面的专家，我相信这是一门非常有趣的科学（我相信任何坐在红绿灯前的司机都会告诉你：D），但我认为你可以创建这样一个专家系统可以根据随时间收集的统计数据控制交通信号灯时间和同步，汽车在一天中的不同时间通过交叉路口。

我不知道任何这样的实现系统，我只是说我认为 Prolog 可能有用的地方。

# artificial-intelligence - 用尽可能少的“参数”表示双精度的 2D 地图

> ID：741857
> 
> 赞同：3
> 
> 时间：2009-04-12T14:27:07.817
> 
> 标签：artificial-intelligence, neural-network, game-ai, neat

我正在使用一种称为[NEAT](http://en.wikipedia.org/wiki/NeuroEvolution_of_Augmenting_Topologies)的神经网络技术开发回合制游戏 AI 。我正在尝试训练一个可以在二维（X&Y 坐标）空间中移动的网络，给定存储在有效二维数组中的各种值。

我可以看到使用神经网络的两种策略：

1.  对于网格中的每个“单元”，提供来自不同启发式的分数作为神经元的输入，并创建一个实际上是一个非常复杂的“评分”系统的 NN。将非游戏角色 (NPC) 移动到得分最高的位置。

2.  为每个启发式度量创建一个压缩值（以某种方式压缩为尽可能少的位），并为每个度量提供一个输入神经元。

我对选项二很感兴趣，因为它提供了最少的计算量（游戏的运行时间很长），但是我很困惑我可以使用什么方法来创建两者的“小表示”版本-维度启发式值。我知道那里有诸如傅立叶变换之类的技术，但是我不知道这些是否适合我的问题。基本上，我正在寻找一种将 50x50 的双精度数组转换为一个或两个双精度值的方法。这两个双精度值可以进行有损压缩，我不需要能够取回原始值，我只需要一个合理的机制来将输入数据更改为一个小的占用空间。

这两种可能性的替代方法是根据与 NPC 的距离以某种方式编码“区域”（因此您可以获得“接近”单元格的实际值和“远”单元格的近似值）。我不确切知道我将如何连接它，但它至少消除了在游戏的每一轮评估每个单元的需要（考虑到我正在以每轮大约 1 秒的速度查看大约 500 万轮，任何简化我能想出会大有帮助）。

如果这没有多大意义，我深表歉意，这是一个相当困难的问题，困扰了我一段时间，我想不出一个简单的方法来描述它。

谢谢，

艾丹

编辑添加（并更改标题）：

多亏了克里斯，我们完善了我正在寻找的东西。我正在寻找的是一种以尽可能少的参数逼近一条线的方法（我可以将 2D 地图转换为一条线）。我之前使用三次样条进行插值，但是对于在 0.0 和 1.0 之间变化很大的数据集，我需要一些更可行的东西。我想我正在寻找的是地图的“散列”。

我知道有诸如三次样条之类的技术，我可以从中计算出一些“关键点”，这些值是我正在寻找的合理类比。我需要一种方法来获取 2500 个值并提出这些值的小表示，我可以将其用于神经网络。我认为可以训练NN来推断这些表示的真实含义，或者至少可以确定表示与现实世界之间的某种相关性，因此它不一定需要是可逆函数，但我不认为许多单向函数（例如 MD5、SHA）实际上也会非常有帮助......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T14:59:57.177

基本上，任何图形压缩算法都会做你想做的事。它们经过大量优化，可将二维数字数组压缩到尽可能小的空间中。

*编辑添加：*

要考虑的另一件事是，由于您希望使用压缩来减少处理时间，因此获得真正高的压缩比通常需要更多的计算来压缩和解压缩数组。您可能会花费更多时间来压缩和解压缩数组，而不是运行神经网络。

*再次编辑添加：*

根据您的评论，听起来您可能想要的是一条[空间填充曲线](http://en.wikipedia.org/wiki/Space_filling_curves)。使用曲线将 50x50* 数组转换为 1x2500 线，然后为数组的每个单元格得出一个近似值的公式。

*阵列必须是 50x50 吗？如果它是一个尺寸略有不同的正方形，则使用空间填充曲线填充可能会容易得多。例如，希尔伯特曲线非常适用于二维的幂次方。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T18:10:29.777

您可以尝试的一件事是对一维线进行 FFT，然后删除以后的（高频）项。例如，在 MATLAB 中，我执行了以下操作：

```
x = [1:1000];
y = rand(1,1000);
f = fft(y, 250); % truncate to 250 terms
plot(x,y, x,abs(ifft(f), 1000)); 
```

倾向于发生的是 f 的 iFFT 的峰值非常接近 y 的峰值。它们不一定是 y 的最高点，但它们是峰值。例如，本次运行，f 的反 FFT 在 x=424、475 和 725 处有峰值，在 x=423、475 和 726 处也有 y 处的峰值。然而，y 的全局最大值在 x =503，这是ifft(f)中的一个峰值，但不是很高。

但是，这只会真正将您的数据使用量减少一半，因为我将 1000 个双精度值转换为 250 个复数值。仅使用 FFT 的实部可以获得进一步的增加：

```
x = [1:1000];
y = rand(1,1000);
f = real(fft(y, 250)); % only uses 1/4 the space now
plot(x,y, x,abs(ifft(f, 1000))); 
```

这仍然产生了很好的结果，ifft(f) 的每个主要峰值对应于 y 中的一个峰值，大多数时间最多只有 2 的距离，并且您使用 1/4 直接存储双精度的空间.

但是，这仍然没有得到“一两个双值”的结果。您现在将 2500 个双精度数打包成 625。您可以通过删减更多项进行试验，但您必须通过删减更多项来“近距离”测试更多值。也许你可以保留前 10% 的项，找到最大值，然后在 3 或 4 的距离内查看；这会将您的 2500 双打减少到“仅” 250。只有测试才能找出最适合您的应用程序的方法。

如果你*真的很*绝望，你可以低至最低的 1% 频率，并在任一方向搜索 5 或 6 以寻找真正的峰值。但这仍然给你留下了 25 个双打。

我不认为有任何方法可以将 2500 个双打转换为只有 1 个或 2 个，并且可以将其转换为任何有意义的东西。看看信息论课本，看看为什么。我建议您使用 MATLAB、GNU Octave 甚至 Excel，并尝试使用类似的东西并找到最适合您的结果。

# web-services - 一个网络服务监控工具

> ID：741868
> 
> 赞同：8
> 
> 时间：2009-04-12T14:36:12.270
> 
> 标签：web-services, monitoring

任何人都知道一个简单的监控工具，它可以定期向 Web 服务发送请求并在它没有得到响应时提醒我？没什么花哨的，只是调度和报告。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-14T10:20:53.850

该领域最常见的程序是[Nagios](http://www.nagios.org/)。它有一个调度程序，可以按照您设置的时间间隔执行测试，当出现问题时它会发出警报，并且它有执行实际测试的插件。如果您的服务没有插件（已经存在无数插件），您可以编写一个而无需触及主代码。

我个人使用[mon](http://mon.wiki.kernel.org/)代替，因为它更简单，并且编写监视器（进行实际测试的小脚本）非常简单。它可以满足您对监控工具的所有期望，例如设置警报间隔（无需每分钟告诉我网站已关闭）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-12T14:41:36.237

JMeter 可以将其作为守护进程来完成，如果您使用像平台 cron 这样的 unix，则对您有很大帮助

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-14T10:29:44.983

我使用[http://pingdom.com/](http://pingdom.com/)效果很好。它不仅可以检查网站是否启动或关闭，还可以设置为检查特定文本（例如'sql error'，会失败）。它有更多的功能，非常好的报告，以及用于日常状态的定期电子邮件。

Pingdom 已经成为一项付费服务​​已有一段时间了，但其他服务，如[https://uptimerobot.com/](https://uptimerobot.com/)仍然可用，我将它们用于低成本/无成本的一些装饰性监控。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-06-17T15:15:17.287

我个人使用内容站点监视器 ( [http://www.contentsitemonitor.com](http://www.contentsitemonitor.com) )。它有一个非常简单和酷炫的网络界面，让您可以在桌面或移动屏幕上查看网站的正常运行时间统计信息。配置监控参数也很容易。它不只是 ping 您的服务器以确保它处于活动状态。它允许您指定要监控的某些内容/关键字，如果您的网站缺少内容/关键字，它将向您发送警报电子邮件。最重要的是，它可以免费监控多达 3 个站点！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-12T14:40:01.030

[老大哥工作得很好。](http://www.bb4.com/)我们在办公室使用它来监控十几个非常繁忙的生产服务器。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-12T15:22:26.247

可以像 Web 页面一样使用[curl](http://curl.haxx.se/)或[twill](http://twill.idyll.org/)等工具来监控 Web 服务。

> curl 是一个命令行工具，用于使用 URL 语法传输文件，支持 FTP、FTPS、HTTP、HTTPS、SCP、SFTP、TFTP、TELNET、DICT、LDAP、LDAPS 和 FILE。curl 支持 SSL 证书、HTTP POST、HTTP PUT、FTP 上传、基于 HTTP 表单的上传、代理、cookie、用户+密码身份验证（Basic、Digest、NTLM、Negotiate、kerberos...），...

...

> twill 是一种简单的语言，它允许用户从命令行界面浏览 Web。使用斜纹，您可以浏览使用表​​单、cookie 和大多数标准 Web 功能的网站。

可以`cron`在 Linux 和`Task Scheduler`Windows 上重复探测。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-12T15:36:45.417

我过去使用过[Alertra](http://www.alertra.com/)。这是相当不错的。他们从世界各地的多个地点访问您的网站。这是一项订阅服务，因此无需安装。只需每月支付。没有合同，IIRC。

# eclipse - WTP HTTP 预览服务器 - 如何重新配置 默认服务器端口？

> ID：741871
> 
> 赞同：17
> 
> 时间：2009-04-12T14:37:59.350
> 
> 标签：eclipse, eclipse-wtp

在 Eclipse Ganymede 下，如何重新配置​​ Eclipse WTP“HTTP Preview Server”的默认服务器端口（8080）？

@莱昂内尔

我想您从未见过与此问题相关联的“视图”，我问的是“HTTP 预览服务器”，而不是其他服务器视图，其中端口在任何其他可设置选项之间*明显*可见；-) 否则我不会在 StackOverflow 上询问是否真正的问题只是在表单设置之间进行搜索

@莱昂内尔

Tnx 为了您的可靠性，这在这些日子里已经不是一种普遍的美德了；），事实上，正如阅读的那样，我想知道是否有一些隐藏的可配置参数：p

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-11-10T18:24:33.410

也可以使用 HTTP 和 J2EE Preview 服务器，但正如您所发现的，如果发生冲突，没有任何 UI 可以更改使用的端口。但是，您可以手动更改它。

1.  进入您的工作区目录并将文件打开`.metadata.plugins\org.eclipse.wst.server.core\servers.xml`到文本编辑器或`File > Open File...`在 Eclipse 中使用。
2.  找到有`<server>`问题的预览服务器的元素并添加一个`port`属性，例如.`port="*8181*"`
3.  重新启动 Eclipse 以获取更改。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T13:23:52.373

假设您想更改一个服务器配置的端口，试试这个：打开配置双击服务器列表中所需的服务器（菜单选项`Window/Show View/Servers`）？有一个以`Ports`端口列表命名的组。我想你想改变`HTTP/1.1`（编辑它，点击端口号。别忘了`CTRL+s`保存它。;）
编辑：首先，很抱歉懒惰的回应。你是对的（有点）。我见过但从未使用过。我使用 Jboss、Tomcat 或 Jerry 作为服务器。我创建了一个 HTTP 预览，并注意到有一个要配置的端口。

我运行了我的服务器测试并且 Eclipse 抱怨

查看[帮助页面](http://help.eclipse.org/stable/index.jsp?topic=/org.eclipse.wst.server.ui.doc.user/topics/thttppreview.html)，您会发现可以更改它：

> HTTP 预览服务器是与工作台集成的超文本传输​​协议 (HTTP) 嵌入式测试服务器。它旨在用于初步测试并节省您下载、安装和设置 HTTP 服务器的时间。但是，随着您的静态 Web 项目在其开发周期中的进展，我们鼓励您在外部 HTTP 服务器上进行测试和运行。在对外部 HTTP 服务器进行最终测试之前，您可以使用 HTTP 预览服务器作为检查错误的便捷方式。

所以，我认为你不能这样做。:(

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-09-23T15:22:26.517

在 Eclipse 菜单中，转到窗口->显示视图->服务器

当您在服务器选项卡中获得服务器列表时，双击您拥有的服务器并手动更改端口号。

希望这能解决问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-05-24T13:41:28.503

打开您的 .metadata，您的项目存储在您的工作区中。浏览文件路径 .metadata.plugins\org.eclipse.wst.server.core\servers.xml

打开文件 servers.xml 并在 server 标记中添加属性 port = "any port number"。示例：server.xml

# python - 我如何告诉 matplotlib 我完成了一个情节？

> ID：741877
> 
> 赞同：189
> 
> 时间：2009-04-12T14:40:55.880
> 
> 标签：python, matplotlib, plot

以下代码绘制到两个[PostScript](http://en.wikipedia.org/wiki/PostScript) (.ps) 文件，但第二个包含两行。

```
import matplotlib
import matplotlib.pyplot as plt
import matplotlib.mlab as mlab

plt.subplot(111)
x = [1,10]
y = [30, 1000]
plt.loglog(x, y, basex=10, basey=10, ls="-")
plt.savefig("first.ps")

plt.subplot(111)
x = [10,100]
y = [10, 10000]
plt.loglog(x, y, basex=10, basey=10, ls="-")
plt.savefig("second.ps") 
```

如何告诉 matplotlib 重新开始第二个情节？

* * *

## 回答 #1

> 赞同：201
> 
> 时间：2009-04-12T17:08:30.220

有一个明确的数字命令，它应该为你做：

```
plt.clf() 
```

如果您在同一个图中有多个子图

```
plt.cla() 
```

清除当前坐标区。

* * *

## 回答 #2

> 赞同：136
> 
> 时间：2009-04-12T14:43:47.260

例如，您可以使用`figure`创建一个新图，或`close`在第一个图之后使用。

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2009-04-12T21:44:36.063

正如 David Cournapeau 所说，使用 figure()。

```
import matplotlib
import matplotlib.pyplot as plt
import matplotlib.mlab as mlab

plt.figure()
x = [1,10]
y = [30, 1000]
plt.loglog(x, y, basex=10, basey=10, ls="-")
plt.savefig("first.ps")

plt.figure()
x = [10,100]
y = [10, 10000]
plt.loglog(x, y, basex=10, basey=10, ls="-")
plt.savefig("second.ps") 
```

或 subplot(121) / subplot(122) 用于相同的情节，不同的位置。

```
import matplotlib
import matplotlib.pyplot as plt
import matplotlib.mlab as mlab

plt.subplot(121)
x = [1,10]
y = [30, 1000]
plt.loglog(x, y, basex=10, basey=10, ls="-")

plt.subplot(122)
x = [10,100]
y = [10, 10000]
plt.loglog(x, y, basex=10, basey=10, ls="-")
plt.savefig("second.ps") 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2012-03-22T10:52:09.110

只需`plt.hold(False)`在第一个 plt.plot 之前输入，就可以坚持原来的代码。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2016-08-16T13:33:22.047

如果您以交互方式使用 Matplotlib，例如在 Web 应用程序中（例如 ipython），您可能正在寻找

```
plt.show() 
```

而不是`plt.close()`or `plt.clf()`。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2018-02-10T12:45:53.510

如果它们都没有工作，那么检查一下..说如果你沿着各自的轴有 x 和 y 数据数组。然后检查您已将 x 和 y 初始化为空的单元格（jupyter）。这是因为，也许您正在将数据附加到 x 和 y 而不重新初始化它们。所以情节也有旧数据。所以检查那个..

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2021-09-24T23:34:33.187

来自[matplotlib.pyplot](https://matplotlib.org/stable/_modules/matplotlib/pyplot.html#figure)的源代码，在`figure()`文档下：

> ```
> If you are creating many figures, make sure you explicitly call
>     `.pyplot.close` on the figures you are not using, because this will
>     enable pyplot to properly clean up the memory. 
> ```

所以，正如其他人所说，`plt.close()`当你完成每个人物时，使用它，你会很高兴的！

注意：如果您通过创建图形`f = plt.figure()`，您可以通过`plt.close( f )`而不是关闭它`f.close()`。

# iphone - Objective C 从指针中生成整数，而无需强制转换将对象作为 args 传递

> ID：741878
> 
> 赞同：4
> 
> 时间：2009-04-12T14:41:21.493
> 
> 标签：iphone, objective-c, cocoa

我正在尝试在目标 C 中进行二十一点，并且在传递物体时遇到了麻烦。我的手类基本上是拿一副牌并从中抽牌，然后将它们添加到数组中。

这是所涉及的 Hand 方法：

```
- (id)init : (Deck*) deck
{
    [self draw: deck];
    [self draw: deck];
    return self;
}

- (void)draw: (Deck*)deck;
{
    Card* C= [deck drawFromDeck];
    [cards addObject: C];
} 
```

这是主要的有问题的部分：

```
Deck* deck=[[Deck alloc] init];
Hand* hand=[[Hand alloc] init: deck ]; 
```

第二行得到“没有强制转换的指针的整数”错误。每当我运行代码时，手中永远不会有牌，因为没有牌可以从中抽牌（我认为 :)）。我需要以不同的方式传递或解析 Deck* 吗？（如果您需要我发布更多代码，请询问）

多谢你们！！:D

* * *

* * *

***关于赏金的编辑***：尽管我确实相信我接受的答案得到了很好的解释，并且在过去的一年半中，这个问题平均每天获得超过 17 次浏览。**这意味着这个问题可能是许多人对 stackoverflow 的第一次体验**，改进它不仅可以更好地向我们展示，而且可能会节省很多人的时间。虽然它现在有很好的答案，但我想确保它尽可能完美，特别是因为我们真的不知道有多少人能够遵循它并解决他们的问题。

继续并提交对现有答案的编辑或添加您自己的答案。（Mods，你认为这会是社区 wiki 的一个很好的候选者吗？）

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-13T01:41:10.627

根据您在下面发布的额外代码，问题是您有两个名称相同但参数不匹配的方法，即`- (id)init: (Deck*)deck`和`- (id)init: (int)newvalue`。

通常这不是问题，但在这种情况下，类型在结构上是不同的——指针和 int。编译器可以根据接收者的类型区分您的意思，但这仅在它具有静态类型时才有效。例如，如果您有：

```
Hand *h = [Hand alloc];
h = [h init: deck]; 
```

它会停止给你警告。不过，这是非常不寻常的代码 - alloc 和 init 几乎总是在同一行。

由于`alloc`返回 an `id`，而不是 a`Hand`它不知道 init 调用`[[Hand alloc] init:deck]`是对 a `Hand`，而不是 a `Card`。有关这方面的更多信息，请参阅[Apple 的静态类型文档。](http://developer.apple.com/documentation/Cocoa/Conceptual/ObjectiveC/Articles/ocStaticBehavior.html#//apple_ref/doc/uid/TP30001163-CH16-TPXREF161)

最简单（也是合理）的解决方案是重命名方法以指示参数的类型。例如，您可以使用`initWithCardValue:`and `initWithDeck:`。

编辑：另外，是的，请注意其他帖子中有关 init 方法内正确行为的建议。（它不会导致警告，但可能会导致段错误。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-12T16:28:17.867

1.  正如 Phil Nash 在他对您的问题的评论中所说，请确保您已将 Hand 和 Deck 的标题导入到您的主文件中。那应该停止警告（这是警告，而不是错误）。

2.  在您的`init`方法中，不要忘记调用`[super init]`，检查它是否没有返回`nil`，并初始化它确实返回的对象。最常见的方法是：

    ```
    if ((self = [super init])) {
        //Initialize here
    }
    return self; 
    ```

3.  为数组声明变量是不够的；您还必须创建数组并将它们放入变量中。只有这样你才能把东西放入数组中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-12T14:55:38.497

你调用`[super init]`你手的`init:`方法了吗？

此外，您正在将卡片添加到卡片数组中；设置正确吗？

# java - 如何在数据库更新时自动更新我的 JTable 数据？

> ID：741885
> 
> 赞同：3
> 
> 时间：2009-04-12T14:45:13.607
> 
> 标签：java, database, jtable

当我的数据库更新时，如何自动更新我的 JTable 数据？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T14:51:55.790

您的 JTable[数据模型](http://java.sun.com/docs/books/tutorial/uiswing/components/table.html#data)必须以某种方式确定您的数据库是否已更改。

没有将这些信息直接从 SQL 数据库提供给表模型的标准方法。您很可能必须轮询数据库并自己发现此信息（在轮询线程中？）

根据填充表所需查询的复杂性以及表中数据的数量，您可以轮询以取回完整的数据集并在必要时重建表，或者轮询最新更新的行，然后如果已更改，则发出对完整数据集的查询。

根据您使用的是特定框架还是 SQL 数据库产品，*可能*会有更多针对此问题的产品特定答案。

# linux - Linux/Unix 应用程序的源代码最适合保存在哪里？

> ID：741888
> 
> 赞同：4
> 
> 时间：2009-04-12T14:48:18.903
> 
> 标签：linux, sysadmin

作为开发者，我经常下载运行

```
./configure
./make
./make install 
```

将应用程序安装到我的 Linux 系统上。但是我从来没有很清楚保存下载目录的最佳位置。我的本地`Desktop`是默认位置，但我想知道保存它的最佳“官方”位置是什么。另外，它是否因发行版而异？

我现在正在运行 Ubuntu。我知道 apt-get install 可以为您执行此操作，但有时我感兴趣的应用程序根本不在这些列表中。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-12T14:52:08.677

看看[FileSystem Hierarchy Standard](http://www.pathname.com/fhs/2.2/fhs-4.9.html)：它是`/usr/local/src`. 但是，这是一个有争议的问题，您将在[此处](http://www.linuxfromscratch.org/blfs/view/svn/introduction/position.html)找到。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-12T14:49:54.343

也许“/usr/local/src”？;-)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-12T15:10:38.677

如果您使用包管理器，请允许它使用托管包的默认值。`/usr/local`如果您管理该盒子，请按照[Steel Plume 的建议](https://stackoverflow.com/questions/741888/where-is-source-code-for-a-linux-unix-application-kept/741891#741891)将不受管理的第三方工具放在下面（尽管有些人更喜欢`/opt`）。如果以非特权用户身份安装，请在 中解压缩并编译`$(HOME)/src`，然后安装到`$(HOME)/bin`、`$(HOME)/etc`中，依此类推。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-20T03:20:04.713

供个人使用：~/src

跨系统共享：/usr/local/src

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-13T23:06:23.177

@dirkgently 和 @dmckee 完全正确。我要补充一点，因为这可能是一个有争议的问题，所以我会模仿分发提供商（在你的情况下）Ubuntu 为其主要软件包所做的事情。

# jsf - 在 facelets 中声明变量有多少种方法？

> ID：741890
> 
> 赞同：2
> 
> 时间：2009-04-12T14:48:51.493
> 
> 标签：jsf, facelets

我注意到 c:set 在“include of include”中不能很好地使用，因为重要的通知 facelets 文档也不推荐它。

现在我在 ui:include 中使用 ui:param，但是当包含没有附带关于 params 的注释时，它有点分散，还有其他方法来声明“全局变量”吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T22:17:30.203

这实际上是一个尝试将旧的 JSP 编程融入 JSF 框架的问题。您应该使用支持 bean 来保存您的数据。

如果您尝试将数据直接硬编码到您的 xhtml 文件中，那么您就违背了 JSF 的 MVC 框架的目的。如果你有一个具体的例子来说明你想要做什么，我可以给你一个具体的建议。

# asp.net-membership - ASP.NET 成员获取匿名用户的 UserId

> ID：741893
> 
> 赞同：2
> 
> 时间：2009-04-12T14:50:45.543
> 
> 标签：asp.net-membership, anonymous-users

我有一个使用 .net 成员资格的现有项目。我们希望扩展项目以允许匿名用户，但我们似乎遇到了一个障碍，因为我们在许多数据库表中使用 aspnet_Users 表的 UserId 作为外键。

以下调用返回 null，因为 aspnet_Membership 表中没有匿名用户的记录

```
Membership.Provider.GetUser(Request.AnonymousID, false); 
```

有没有办法通过标准 API 获取匿名用户的 UserId？还是我必须编写一个可以做到的扩展？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T15:40:20.480

据我所知，这是关于访问的。如果您的网站有不需要访问的模块或页面。您需要先在 aspnet users 表中创建一个用户。可能是未正确创建此匿名用户导致空值。

此外，如果您想跟踪这些匿名用户，您必须在配置文件提供程序配置中将 allowanonymous 设置为 true。

有关更多帮助，请参阅本文 [http://www.odetocode.com/Articles/440.aspx](http://www.odetocode.com/Articles/440.aspx)

# linq-to-sql - 通过部分类重命名 LINQ 2 SQL 实体属性

> ID：741898
> 
> 赞同：1
> 
> 时间：2009-04-12T14:52:40.173
> 
> 标签：linq-to-sql, naming, rename

我可以使用部分类来创建指向 L2S 设计器生成的关联属性的属性吗？另外，我可以在查询中使用新属性吗？

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T14:54:45.457

如果您只想为关联属性指定不同的名称，只需使用关联的属性页面并重命名父和/或子属性。这将更改类中 EntityRef/EntitySet 的名称。

**编辑**：在部分类中使用单独属性的缺点是 LINQ 在生成查询时将无法使用它——本质上，您将被迫始终获取实体，然后才能使用对象上的相关属性. 通过重命名，您可以让 LINQ 在构造查询时使用相关属性，从而提高查询效率。例如，如果您想获取相关实体具有特定属性值的实体，则使用属性修饰实体将允许 LINQ 生成 SQL 以仅从数据库中提取那些匹配的值。使用简单的属性实现（简单地引用底层关系属性，实际上是重命名它），您将被迫首先获取所有实体，然后在您的应用程序中进行过滤。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T15:04:06.777

是的，您可以，但是您必须应用与 linq2sql 生成的属性相同的属性，即

```
 [Association(Name="Test_TestData", Storage="_TestDatas", ThisKey="SomeId", OtherKey="OtherId")]
    public System.Data.Linq.EntitySet<TestData> MyTestDatas
    {
        get
        {
            return this.TestDatas;
        }
    } 
```

TestDatas 是原始关系。

**更新：**我运行的示例查询：

```
 var context = new DataClasses1DataContext();
        var tests =
            from d in context.Tests
            where d.MyTestDatas.Any(md=>md.MyId == 2)
            select new
            {
                SomeId = d.SomeId,
                SomeData = d.SomeData,
                Tests = d.MyTestDatas
            };
        foreach (var test in tests)
        {
            var data = test.Tests.ToList();
        } 
```

# java - 二叉树问题。检查相似的形状

> ID：741900
> 
> 赞同：5
> 
> 时间：2009-04-12T14:54:03.180
> 
> 标签：java, algorithm, tree

嗨，我一直在做这个，不知道该怎么做。

如果我有两棵二叉树，我将如何检查它们是否具有相同的形状？节点中的数据无关紧要，只要树结构相等即可。

关于如何解决这个问题的任何想法？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-12T15:45:31.917

您可以通过递归轻松做到这一点。以下代码有效，因为当且仅当它们各自的子树具有相同的形状时，两个非空树具有相同的形状。

```
boolean equalTrees(Node lhs, Node rhs)
{
    // Empty trees are equal
    if (lhs == null && rhs == null)
        return true;

    // Empty tree is not equal to a non-empty one
    if ((lhs == null && rhs != null)
        || (lhs != null && rhs == null))
        return false;

    // otherwise check recursively
    return equalTrees(lhs.left(), rhs.left())
        && equalTrees(lhs.right(), rhs.right())
} 
```

要检查两棵树，请将它们的根节点传递给上面的函数。

```
equalTrees(tree1.root(), tree2.root()) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-12T15:00:28.280

并行的两个广度优先搜索将是一种方式。

[http://en.wikipedia.org/wiki/Breadth-first_search](http://en.wikipedia.org/wiki/Breadth-first_search)

使用 BFS，您可以同时检查树的特定级别的所有节点。这样，如果您不区分左右子节点（即，如果节点的对应节点有一个子节点，则认为您的树是相同的，而不管“右”或“左”子节点如何）您可以在那个时候处理。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-12T15:15:02.460

> 如果我有两棵二叉树，我将如何检查它们是否具有相同的形状？

您会很高兴知道**二叉树有一个有趣的特性：[它们可以表示为数组](http://en.wikipedia.org/wiki/Binary_tree#Methods_for_storing_binary_trees)。**只需将每棵树转换为这些数组之一并比较数组内容。空白单元格对应于不存在的左或右子节点，定义了树的结构。您想遍历两个数组并确保一个数组中遇到的每个空白单元格都出现在另一个数组中；这是 O(n)。

当然，如果数组的大小不同，则根本不需要做任何工作，因为具有不同节点数的树不可能具有相同的结构。从那里，你就完成了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-12T15:01:17.047

使用符号名称而不是实际数据按预排序和按顺序遍历它们，并比较生成的字符串。也许对您的数据结构进行更多输入会很有用。

不是java相关的AFAICT

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-12T15:44:19.283

只需跟随树枝，模仿一棵树的每一个动作。在 Python 伪代码中：

```
树类：
    def __init__(self, value, left=None, right=None):
        自我价值=价值
        self.left = 左
        self.right = 对

定义相同的形状（T1，T2）：
    如果 T1 == 无：
        返回 T2 == 无

    如果 T2 == 无：
        返回 T1 == 无

    返回 same_shape(T1.left, T2.left) 和 same_shape(T1.right, T2.right)

```

# cron - 如何让我的基于 PHP 的 cron 作业更频繁地执行？

> ID：741910
> 
> 赞同：1
> 
> 时间：2009-04-12T15:01:20.073
> 
> 标签：cron, refresh, meta-tags

我有一个文件“ `update.php`”，它执行一些 MySQL 操作。cron 作业每 5 分钟执行一次此文件。不幸的是，我不能更频繁地执行 cron 作业。

所以我有一个想法，我可以添加......

```
<html>
<head>
  <meta http-equiv="refresh"  content="2; URL=<?php echo $_SERVER['SCRIPT_NAME']; ?>" />
</head>
<body></body>
</html> 
```

...到页面“ `update.php`”。cron 会以页面自动刷新的方式执行文件吗？还是因为没有带有浏览器的客户端而不会发生这种情况？

如果元刷新没有效果，是否还有其他可能实现页面的刷新？

提前致谢！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-12T15:19:04.273

恐怕这行不通，因为它是刷新页面的浏览器功能。

问题：为什么不能将 cron 作业设置为比每 5 分钟更频繁地运行一次？

如果没有其他选择，那么您可以创建自己的守护进程来更频繁地完成这项工作。

例如，您的 php 脚本可以：

*   跑
*   等待 60 秒
*   跑
*   （等待；运行；再过两次）
*   出口

例如：（通过[sshow](https://stackoverflow.com/questions/741910/how-can-i-make-my-php-based-cron-job-execute-more-often/753700#753700)代码的变体）

```
<?php

$secs = 60;

ignore_user_abort(true);
set_time_limit(0);

dostuff();
sleep($secs);
dostuff();
sleep($secs);
dostuff();
sleep($secs);
dostuff();
sleep($secs);
dostuff();

?> 
```

这个版本的脚本会驻留四分钟，执行代码 4 次，相当于每分钟运行一次，如果这个脚本是由 cron 每 5 分钟运行一次的话。

关于 cronjob 是什么以及它是如何运行的似乎有些混乱。

[cron](http://en.wikipedia.org/wiki/Cron)是一个守护进程，它位于后台，并按照[crontab](http://unixhelp.ed.ac.uk/CGI/man-cgi?crontab+5)中指定的时间表通过 shell 运行任务。

每个用户都有一个 crontab，还有一个系统 crontab。

每个用户的 crontab 都可以指定以该用户身份运行的作业。

例如：

```
# run five minutes after midnight, every day
5 0 * * *       $HOME/bin/daily.job >> $HOME/tmp/out 2>&1
# run at 2:15pm on the first of every month -- output mailed to paul
15 14 1 * *     $HOME/bin/monthly
# run at 10 pm on weekdays, annoy Joe
0 22 * * 1-5    mail -s "It's 10pm" joe%Joe,%%Where are your kids?%
23 0-23/2 * * * echo "run 23 minutes after midn, 2am, 4am ..., everyday"
5 4 * * sun     echo "run at 5 after 4 every sunday" 
```

所以每五分钟运行一次：

```
*/5 * * * *     echo "This will be run every five minutes" 
```

或者每分钟运行一次：

```
* * * * *       echo "This will be run every minute" 
```

命令的输出通过电子邮件发送给 crontab 的所有者（或由 MAILTO 指定）。这意味着，如果您每分钟运行一次，它将每分钟向您发送电子邮件，除非您确保所有正常输出都被抑制或重定向。

这些命令以拥有 crontab 的用户身份运行，这与网络服务器运行的脚本形成对比，后者以“nobody”用户身份运行（或类似的——无论网络服务器配置为以何种身份运行）。如果 cronjob 正在写入应该由 Web 服务器运行的脚本访问的文件，这会使生活变得更加复杂。基本上，您必须确保权限保持正确。

现在，我不确定这是您所指的系统。如果您的意思是其他意思，`cronjob`则上述内容可能不适用。

如果您想做一些当前主机不允许您做的事情，那么与其绕过限制，您可能会考虑更换托管服务提供商？

* * *

另一种方法是将脚本放在您的正常脚本位置，并让一些外部调度程序以您喜欢的任何频率对其运行 wget。

* * *

另一种选择是按需更新[vartec](https://stackoverflow.com/questions/741910/how-can-i-make-my-php-based-cron-job-execute-more-often/755186#755186)建议的形式。但是，这可能无法解决您的问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-15T20:59:40.827

我很确定你可以通过这样做来实现它：

```
<?php

$secs = 120;

ignore_user_abort(true);
set_time_limit(0);

while (true)
{
    // do something

    // Sleep for some time
    sleep($secs);
}

?> 
```

**编辑**

您必须在每次服务器重新启动后执行一次，除非您像 Douglas 描述的那样执行此操作。

**更新**

记住 Douglas Leeder 的回答，然后看看这个：

[http://www.php.net/manual/en/function.ignore-user-abort.php](http://www.php.net/manual/en/function.ignore-user-abort.php)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-15T20:15:48.763

我会说不要尝试使用 php 执行此操作，请更改您的 crontab。如果您需要您的应用程序每分钟执行一次 cronjob，而您的主机没有提供此选项，那么您的主机很可能已经超出了您的要求。以每月 20 美元的价格为自己获得一个 VPS 主机（Slicehost、Servergrove）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-15T19:53:38.287

**更新：根据新信息编辑。**

元刷新将不起作用，因为 cronjob.de 将使用一个不会实际读取页面内容的自动化系统。没有浏览器，所以什么都看不到元刷新。

你有几个选择。它们的可怕程度或多或少有所不同。

最好的选择是更改虚拟主机。一个好的虚拟主机将完全支持 cron。但是，如果您需要接触 cron，老实说，您可能无论如何都应该在 VPS 主机上。许多主机会反对每分钟运行的 cron 任务，除非该任务只是非常快速地更新某些内容并退出。但是 VPS 主机通常不会在意。Slicehost 以每月 20 美元的价格提供 VPS 服务器。不建议以前从未有过 root 访问权限的人使用。

在 cronjob.de 的 5 分钟限制下，您拥有的唯一选择是构建一个循环，该循环将运行一个迭代、休眠、运行另一个迭代，并在 5 分钟结束之前重复您需要的多次。但是，这种方法存在两个主要问题。首先，如果您有一个持续 4 分钟的请求，那么您的虚拟主机很可能会在请求完成之前终止该请求。其次，如果网络服务器的配置不正确，这样的请求可能会阻止其他请求，从而阻止合法用户访问您的站点——他们会排队等待 cronjob.de 请求完成，然后才能完成他们的请求. 而且由于该请求需要 4-5 分钟才能完成，然后在一分钟后重复，他们可能每 5 分钟只能访问一次您的网站。我猜这是不可取的。不幸的是，要知道您是否会遇到这些问题，唯一的方法是询问您的虚拟主机。我不建议在询问之前尝试它，因为如果它出乎意料地坏并开始影响服务器上的其他客户，他们可能不会欣赏它。

如果你幸运的话，他们甚至可能愿意为你设置一个 cron 工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T23:02:58.820

您可以使用 PHP 调用脚本...

```
<?php
$script='/path/to/my/php/script.php';

ignore_user_abort(1);
set_time_limit(0);
$php=exec('which php');
while (1) {
    if (file_exists($script)) { exec($php.' '.$script); }
    else { file_get_contents($script); }
    sleep(2);
}
?> 
```

你给 $script 的文件需要存在，否则它认为它是一个 URL。

它应该可以解决问题。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-04-12T15:18:51.467

您正在尝试做的事情意味着用户交互，那么如果没有客户进入您的“页面”怎么办？

例如，Servlet 和 EJB 容器可以在容器启动时以编程方式完成您需要的操作，所以我认为对于 PHP 而言，“自动”完成类似 cron 的作业的唯一方法是在 Apache 源代码中进行一些更改，显然只有在您使用住房服务器。

**不考虑代码更改的更实用的选项可能是一些 cron 脚本直接调用您的页面（wget、netcat 等）在您的 Web 服务器启动期间启动**

# search - 你如何搜索 Vim 的命令历史？

> ID：741913
> 
> 赞同：89
> 
> 时间：2009-04-12T15:02:14.267
> 
> 标签：search, vim

我也想在 Vim 中进行以下搜索

```
(reverse-i-search)`': 
```

输入您之前命令的一个单词，您将获得完整的命令。

我知道 Vim 中的年代历史工具

```
q: 
```

但是，它不如模糊反向搜索有用。

**如何在 Vim 中进行与终端中类似的反向搜索？**

* * *

## 回答 #1

> 赞同：142
> 
> 时间：2011-07-04T10:29:36.270

在正常模式下键入`q:`以打开命令窗口。您可以使用常规 vim 命令在此处搜索/编辑。您从正常模式开始。按`Enter`执行命令。

这种方法使您可以搜索整个命令，而不仅仅是行首。

* * *

## 回答 #2

> 赞同：89
> 
> 时间：2009-04-12T15:07:57.750

输入上一个命令的第一个字母，然后按 <Up> 箭头（或 Ctrl+p）。

```
:set li<up>
:set lines=75 
```

不要忘记检查历史选项并将其设置为足够大的值

```
:set history=1000 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2018-05-11T00:14:00.780

在命令模式下按**Ctrl+F**打开命令历史记录窗口。然后，您可以使用`/`、`?` 和其他搜索命令。按 Enter 键执行历史记录中的命令。

有关命令历史记录窗口的更多信息，请参阅[:h cmdwin](https://vimhelp.org/cmdline.txt.html)。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-04-12T15:07:37.937

这是[Vim 命令行历史](http://vimdoc.sourceforge.net/htmldoc/usr_20.html#20.4)的文档，另请参阅 Vim 命令行历史的这部分文档，其中涵盖了历史中的键绑定[。](http://vimdoc.sourceforge.net/htmldoc/cmdline.html#history)看起来您可以说`:foo`然后按向上箭头以查找以 foo 开头的最后一个命令。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2020-07-01T19:21:33.160

使用 FZF 模糊搜索命令：`:History:`

来源：[https ://github.com/junegunn/fzf.vim](https://github.com/junegunn/fzf.vim)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2013-06-10T03:33:07.823

我也在寻找这个（最后在想知道为什么它没有内置一段时间之后）并决定我无法抗拒启动一个实现，所以你去：[https ://github.com/goldfeld/ ctrlr.vim](https://github.com/goldfeld/ctrlr.vim)

它应该像 shell 一样工作——好吧，仍然缺少一些基本的东西（比如再次按 ^R 以跳到下一场比赛），但我使用的只是在第一个版本中，我计划将其余部分添加到接下来的几周，我有时间。

# java - 如何在 SWT 中强制重绘前不可见组的内容？

> ID：741929
> 
> 赞同：2
> 
> 时间：2009-04-12T15:21:19.370
> 
> 标签：java, swt

我是 SWT 的菜鸟，刚刚开始，但我之前曾使用过诸如 Swing 之类的 GUI 框架。

我有一个组合，其中包含一个组和一个按钮。Group 最初设置为不可见（使用 group.setVisible(false)），并在单击按钮时设置为可见。这将启动一个执行一些计算的线程，用进度更新组内的标签（一种手动进度条。这是客户想要的:)）。

无论如何，由于某种原因，该组仅在线程完成运行后出现，而我似乎无法使其出现，无论我使用什么（尝试调用this.pack（），this.layout（）， this.getShell().layout(), redraw() 在路径中的各种控件上——什么都没有。

这是我创建组的方式：

```
statusGroup = new Group(this, SWT.SHADOW_NONE);
statusGroup.setLayout(null);
statusGroup.setVisible(false);
percentCompleteLabel = new Label(statusGroup, SWT.NONE);
percentCompleteLabel.setText("0% complete"); 
```

以下是我从 Button 的 SelectionListener 更新它的方法：

```
this.statusGroup.setVisible(true);
this.statusGroup.pack(true);
this.statusGroup.layout();

this.getShell().layout();

myThreadStartupCode(); // psuedo

while (!workIsDone)  // psuedo
{
   final int progress = myProgressCalcMethod();  // psuedo

   percentCompleteLabel.setText(progress + "% complete");
   percentCompleteLabel.pack(true);

   this.layout();
   this.redraw();

   Thread.sleep(100);
} 
```

任何线索将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T06:25:22.503

显然，解决方案是使用`Display.getCurrent().update();`

# ruby-on-rails - ruby on rails 中的嵌套布局

> ID：741945
> 
> 赞同：12
> 
> 时间：2009-04-12T15:38:16.880
> 
> 标签：ruby-on-rails

我是 Rails 新手，正在尝试研究如何让嵌套布局正常工作；我假设它们有点像.net 母版页？

我已按照[本指南](http://guides.rubyonrails.org/layouts_and_rendering.html#using-nested-layouts)进行操作，并在我的布局目录中创建了一个 application.erb.html，其中包含以下内容：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
       "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
  <title><%= @page_title or 'Page Title' %></title>
  <%= stylesheet_link_tag 'layout' %>
  <style type="text/css"><%= yield :stylesheets %></style>
</head>
<body>

<%= yield(:content) or yield %>

</body>
</html> 
```

并将我现有的布局之一修改为：

```
<% content_for :stylesheets do %>

<% end -%>

<% content_for :content do %>
  <p style="color: green"><%= flash[:notice] %></p>
  <%= yield %>
<% end -%>

<% render :file => 'layouts/application' %> 
```

当我在浏览器中转到我的视图之一时，绝对没有呈现任何内容；当我查看源代码时没有 html。

我确定我错过了一些基本的东西，有人可以指出吗？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-04-12T17:17:56.733

我已经制定了解决方案，尽管它不是[本文中给出的](http://guides.rubyonrails.org/layouts_and_rendering.html#using-nested-layouts)

我已经替换了这条线

```
<% render :file => 'layouts/application' %> 
```

和

```
<%= render :file => 'layouts/application' %> 
```

我不确定文章是否有误，或者我找到了错误的方法来修复它！请告诉我！

干杯

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-14T04:20:56.103

原文章有错误，你的解决方法是正确的。原因如下：

包含在 <%= %> 中的 ERB（视图）中的 ruby​​ 代码的输出被添加到生成并发送到浏览器的 HTML 中。包含在 <% %> 中的 ruby​​ 代码的输出不会添加到 HTML 中。因此调用 <% render :partial ... %> 没有任何效果，因为该 ruby​​ 代码的结果（获取部分）没有添加到生成的 HTML 文件中。

<% %> 通常保留用于条件和循环，如上例所示。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-03-01T17:59:45.613

这是嵌套布局[的另一种方法](http://mattmccray.com/archive/2007/02/19/Sorta_Nested_Layouts/)，可能会派上用场。

# python - 以编程方式确定函数所需的参数数量 - Python

> ID：741950
> 
> 赞同：34
> 
> 时间：2009-04-12T15:43:34.777
> 
> 标签：python, parameters, function

我正在创建一个简单的命令行实用程序，并使用字典作为一种 case 语句，其中的关键字链接到相应的功能。这些函数都需要不同数量的参数，因此目前要检查用户是否输入了每个函数所需的正确数量的参数，我将所需的数量放在表格中的字典 case 语句中`{Keyword:(FunctionName, AmountofArguments)}`。

这个当前的设置工作得很好但是我只是想知道是否有一种方法可以确定函数中所需的参数数量并且我的谷歌尝试到目前为止没有返回任何价值但我看到了 args 和 kwargs可能会因为它们允许的无限量的参数而搞砸这样的命令。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-04-12T15:48:52.657

[检查.getargspec()](http://docs.python.org/library/inspect.html#inspect.getargspec)：

> 获取函数参数的名称和默认值。返回一个包含四件事的元组：（args、varargs、varkw、defaults）。args 是参数名称的列表（它可能包含嵌套列表）。varargs 和 varkw 是 * 和 ** 参数的名称或无。defaults 是默认参数值的元组，如果没有默认参数，则为 None；如果这个元组有 n 个元素，它们对应于 args 中列出的最后 n 个元素。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-04-12T15:53:40.010

由于使用了 varargs 和 kwargs，你想要的通常是不可能的，但是`inspect.getargspec`(Python 2.x) 和`inspect.getfullargspec`(Python 3.x) 很接近。

*   Python 2.x：

    ```
    >>> import inspect
    >>> def add(a, b=0):
    ...     return a + b
    ...
    >>> inspect.getargspec(add)
    (['a', 'b'], None, None, (0,))
    >>> len(inspect.getargspec(add)[0])
    2 
    ```

*   Python 3.x：

    ```
    >>> import inspect
    >>> def add(a, b=0):
    ...     return a + b
    ...
    >>> inspect.getfullargspec(add)
    FullArgSpec(args=['a', 'b'], varargs=None, varkw=None, defaults=(0,), kwonlyargs=[], kwonlydefaults=None, annotations={})
    >>> len(inspect.getfullargspec(add).args)
    2 
    ```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2016-11-02T19:45:38.657

在 Python 3 中，使用`someMethod.__code__.co_argcount`

（因为`someMethod.func_code.co_argcount`不再工作了）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-08-04T20:28:28.433

这已经得到解答，但没有检查模块，您也可以使用`someMethod.func_code.co_argcount`

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-12T21:20:51.753

使每个命令成为一个类，从定义命令的一般结构的抽象基础派生。应尽可能将命令属性的定义放入类变量中，并使用在处理该数据的基类中定义的方法。

使用工厂类注册这些子类中的每一个。这个工厂类获取参数列表并通过实例化适当的命令子类来决定执行哪个命令。

参数检查由命令子类本身处理，使用来自命令基类的正确定义的通用方法。

这样，您永远不需要重复编写相同的代码，也不需要模拟 switch 语句。它还使扩展和添加命令变得非常容易，因为您可以简单地添加和注册一个新类。没有什么可以改变的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-09-13T12:10:16.110

很好的问题。我只是有一个问题，我想编写一个带有回调参数的函数。根据该回调的参数数量，需要以不同的方式调用它。

我从 gimel 的回答开始，然后扩展为能够处理与`inspect`模块 ( `raise TypeError`) 反应不佳的内置函数。

所以这里的代码来检查一个函数是否需要一个参数：

```
def func_has_one_arg_only(func, typical_argument=None, ignore_varargs=False):
    """True if given func expects only one argument

    Example (testbench):
    assert not func_has_one_arg_only(dict.__getitem__), 'builtin 2 args'
    assert func_has_one_arg_only(lambda k: k), 'lambda 1 arg'
    assert not func_has_one_arg_only(lambda k,x: k), 'lambda 2 args'
    assert not func_has_one_arg_only(lambda *a: k), 'lambda *a'
    assert not func_has_one_arg_only(lambda **a: k), 'lambda **a'
    assert not func_has_one_arg_only(lambda k,**a: k), 'lambda k,**a'
    assert not func_has_one_arg_only(lambda k,*a: k), 'lambda k,*a'

    assert func_has_one_arg_only(lambda k: k, ignore_varargs=True), 'lambda 1 arg'
    assert not func_has_one_arg_only(lambda k,x: k, ignore_varargs=True), 'lambda 2 args'
    assert not func_has_one_arg_only(lambda *a: k, ignore_varargs=True), 'lambda *a'
    assert not func_has_one_arg_only(lambda **a: k, ignore_varargs=True), 'lambda **a'
    assert func_has_one_arg_only(lambda k,**a: k, ignore_varargs=True), 'lambda k,**a'
    assert func_has_one_arg_only(lambda k,*a: k, ignore_varargs=True), 'lambda k,*a'
    """

    try:
        import inspect
        argspec = inspect.getargspec(func)
    except TypeError:                   # built-in c-code (e.g. dict.__getitem__)
        try:
            func(typical_argument)
        except TypeError:
            return False
        else:
            return True
    else:
        if not ignore_varargs:
            if argspec.varargs or argspec.keywords:
                return False
        if 1 == len(argspec.args):
            return True
        return False
    raise RuntimeError('This line should not be reached') 
```

您可以控制与可变参数和参数相关的`*args`行为。`**kwargs``ignore_varargs`

`typical_argument`参数是一个杂项：如果不能`inspect`工作，例如在前面提到的内置函数上，那么我们只是尝试用一个参数调用函数，看看会发生什么。

这种方法的问题在于有多种原因`raise TypeError`：使用了错误数量的参数，或者使用了错误类型的参数。通过允许用户提供一个`typical_argument`我试图规避这个问题。

这不好。`inspect`但它可能会帮助有同样问题的人，也可能会遇到无法检查 C 编码函数实现的事实。也许人们有更好的建议？

# c# - 平移和缩放图像

> ID：741956
> 
> 赞同：142
> 
> 时间：2009-04-12T15:48:14.827
> 
> 标签：c#, wpf, xaml, zooming, pan

我想在 WPF 中创建一个简单的图像查看器，使用户能够：

*   平移（通过鼠标拖动图像）。
*   缩放（带有滑块）。
*   显示叠加层（例如矩形选择）。
*   显示原始图像（如果需要，使用滚动条）。

你能解释一下怎么做吗？

我在网上没有找到好的样本。我应该使用 ViewBox 吗？还是图像刷？我需要 ScrollViewer 吗？

* * *

## 回答 #1

> 赞同：202
> 
> 时间：2011-07-21T20:59:32.110

使用此问题中的示例后，我制作了完整版本的平移和缩放应用程序，并相对于鼠标指针进行了适当的缩放。所有平移和缩放代码已移至名为 ZoomBorder 的单独类。

*ZoomBorder.cs*

```
using System.Linq;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Input;
using System.Windows.Media;

namespace PanAndZoom
{
  public class ZoomBorder : Border
  {
    private UIElement child = null;
    private Point origin;
    private Point start;

    private TranslateTransform GetTranslateTransform(UIElement element)
    {
      return (TranslateTransform)((TransformGroup)element.RenderTransform)
        .Children.First(tr => tr is TranslateTransform);
    }

    private ScaleTransform GetScaleTransform(UIElement element)
    {
      return (ScaleTransform)((TransformGroup)element.RenderTransform)
        .Children.First(tr => tr is ScaleTransform);
    }

    public override UIElement Child
    {
      get { return base.Child; }
      set
      {
        if (value != null && value != this.Child)
          this.Initialize(value);
        base.Child = value;
      }
    }

    public void Initialize(UIElement element)
    {
      this.child = element;
      if (child != null)
      {
        TransformGroup group = new TransformGroup();
        ScaleTransform st = new ScaleTransform();
        group.Children.Add(st);
        TranslateTransform tt = new TranslateTransform();
        group.Children.Add(tt);
        child.RenderTransform = group;
        child.RenderTransformOrigin = new Point(0.0, 0.0);
        this.MouseWheel += child_MouseWheel;
        this.MouseLeftButtonDown += child_MouseLeftButtonDown;
        this.MouseLeftButtonUp += child_MouseLeftButtonUp;
        this.MouseMove += child_MouseMove;
        this.PreviewMouseRightButtonDown += new MouseButtonEventHandler(
          child_PreviewMouseRightButtonDown);
      }
    }

    public void Reset()
    {
      if (child != null)
      {
        // reset zoom
        var st = GetScaleTransform(child);
        st.ScaleX = 1.0;
        st.ScaleY = 1.0;

        // reset pan
        var tt = GetTranslateTransform(child);
        tt.X = 0.0;
        tt.Y = 0.0;
      }
    }

    #region Child Events

        private void child_MouseWheel(object sender, MouseWheelEventArgs e)
        {
            if (child != null)
            {
                var st = GetScaleTransform(child);
                var tt = GetTranslateTransform(child);

                double zoom = e.Delta > 0 ? .2 : -.2;
                if (!(e.Delta > 0) && (st.ScaleX < .4 || st.ScaleY < .4))
                    return;

                Point relative = e.GetPosition(child);
                double absoluteX;
                double absoluteY;

                absoluteX = relative.X * st.ScaleX + tt.X;
                absoluteY = relative.Y * st.ScaleY + tt.Y;

                st.ScaleX += zoom;
                st.ScaleY += zoom;

                tt.X = absoluteX - relative.X * st.ScaleX;
                tt.Y = absoluteY - relative.Y * st.ScaleY;
            }
        }

        private void child_MouseLeftButtonDown(object sender, MouseButtonEventArgs e)
        {
            if (child != null)
            {
                var tt = GetTranslateTransform(child);
                start = e.GetPosition(this);
                origin = new Point(tt.X, tt.Y);
                this.Cursor = Cursors.Hand;
                child.CaptureMouse();
            }
        }

        private void child_MouseLeftButtonUp(object sender, MouseButtonEventArgs e)
        {
            if (child != null)
            {
                child.ReleaseMouseCapture();
                this.Cursor = Cursors.Arrow;
            }
        }

        void child_PreviewMouseRightButtonDown(object sender, MouseButtonEventArgs e)
        {
            this.Reset();
        }

        private void child_MouseMove(object sender, MouseEventArgs e)
        {
            if (child != null)
            {
                if (child.IsMouseCaptured)
                {
                    var tt = GetTranslateTransform(child);
                    Vector v = start - e.GetPosition(this);
                    tt.X = origin.X - v.X;
                    tt.Y = origin.Y - v.Y;
                }
            }
        }

        #endregion
    }
} 
```

**主窗口.xaml**

```
<Window x:Class="PanAndZoom.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:PanAndZoom"
        Title="PanAndZoom" Height="600" Width="900" WindowStartupLocation="CenterScreen">
    <Grid>
        <local:ZoomBorder x:Name="border" ClipToBounds="True" Background="Gray">
            <Image Source="image.jpg"/>
        </local:ZoomBorder>
    </Grid>
</Window> 
```

**主窗口.xaml.cs**

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Navigation;
using System.Windows.Shapes;

namespace PanAndZoom
{
    public partial class MainWindow : Window
    {
        public MainWindow()
        {
            InitializeComponent();
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：120
> 
> 时间：2009-04-21T12:38:06.267

我解决此问题的方法是将图像放置在边框内，并将其 ClipToBounds 属性设置为 True。然后将图像上的 RenderTransformOrigin 设置为 0.5,0.5，因此图像将开始在图像的中心进行缩放。RenderTransform 也设置为包含 ScaleTransform 和 TranslateTransform 的 TransformGroup。

然后我处理图像上的 MouseWheel 事件以实现缩放

```
private void image_MouseWheel(object sender, MouseWheelEventArgs e)
{
    var st = (ScaleTransform)image.RenderTransform;
    double zoom = e.Delta > 0 ? .2 : -.2;
    st.ScaleX += zoom;
    st.ScaleY += zoom;
} 
```

为了处理平移，我做的第一件事是处理图像上的 MouseLeftButtonDown 事件，捕捉鼠标并记录它的位置，我还存储了 TranslateTransform 的当前值，这是为了实现平移而更新的内容。

```
Point start;
Point origin;
private void image_MouseLeftButtonDown(object sender, MouseButtonEventArgs e)
{
    image.CaptureMouse();
    var tt = (TranslateTransform)((TransformGroup)image.RenderTransform)
        .Children.First(tr => tr is TranslateTransform);
    start = e.GetPosition(border);
    origin = new Point(tt.X, tt.Y);
} 
```

然后我处理了 MouseMove 事件来更新 TranslateTransform。

```
private void image_MouseMove(object sender, MouseEventArgs e)
{
    if (image.IsMouseCaptured)
    {
        var tt = (TranslateTransform)((TransformGroup)image.RenderTransform)
            .Children.First(tr => tr is TranslateTransform);
        Vector v = start - e.GetPosition(border);
        tt.X = origin.X - v.X;
        tt.Y = origin.Y - v.Y;
    }
} 
```

最后不要忘记释放鼠标捕获。

```
private void image_MouseLeftButtonUp(object sender, MouseButtonEventArgs e)
{
    image.ReleaseMouseCapture();
} 
```

至于调整大小的选择句柄，可以使用装饰器来完成，查看[这篇文章](http://msdn.microsoft.com/en-us/library/ms746703.aspx)了解更多信息。

* * *

## 回答 #3

> 赞同：48
> 
> 时间：2009-05-29T17:15:02.320

答案已在上面发布，但并不完整。这是完成的版本：

**XAML**

```
<Window
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
x:Class="MapTest.Window1"
x:Name="Window"
Title="Window1"
Width="1950" Height="1546" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:Controls="clr-namespace:WPFExtensions.Controls;assembly=WPFExtensions" mc:Ignorable="d" Background="#FF000000">

<Grid x:Name="LayoutRoot">
    <Grid.RowDefinitions>
        <RowDefinition Height="52.92"/>
        <RowDefinition Height="*"/>
    </Grid.RowDefinitions>

    <Border Grid.Row="1" Name="border">
        <Image Name="image" Source="map3-2.png" Opacity="1" RenderTransformOrigin="0.5,0.5"  />
    </Border>

</Grid> 
```

**代码背后**

```
using System.Linq;
using System.Windows;
using System.Windows.Input;
using System.Windows.Media;

namespace MapTest
{
    public partial class Window1 : Window
    {
        private Point origin;
        private Point start;

        public Window1()
        {
            InitializeComponent();

            TransformGroup group = new TransformGroup();

            ScaleTransform xform = new ScaleTransform();
            group.Children.Add(xform);

            TranslateTransform tt = new TranslateTransform();
            group.Children.Add(tt);

            image.RenderTransform = group;

            image.MouseWheel += image_MouseWheel;
            image.MouseLeftButtonDown += image_MouseLeftButtonDown;
            image.MouseLeftButtonUp += image_MouseLeftButtonUp;
            image.MouseMove += image_MouseMove;
        }

        private void image_MouseLeftButtonUp(object sender, MouseButtonEventArgs e)
        {
            image.ReleaseMouseCapture();
        }

        private void image_MouseMove(object sender, MouseEventArgs e)
        {
            if (!image.IsMouseCaptured) return;

            var tt = (TranslateTransform) ((TransformGroup) image.RenderTransform).Children.First(tr => tr is TranslateTransform);
            Vector v = start - e.GetPosition(border);
            tt.X = origin.X - v.X;
            tt.Y = origin.Y - v.Y;
        }

        private void image_MouseLeftButtonDown(object sender, MouseButtonEventArgs e)
        {
            image.CaptureMouse();
            var tt = (TranslateTransform) ((TransformGroup) image.RenderTransform).Children.First(tr => tr is TranslateTransform);
            start = e.GetPosition(border);
            origin = new Point(tt.X, tt.Y);
        }

        private void image_MouseWheel(object sender, MouseWheelEventArgs e)
        {
            TransformGroup transformGroup = (TransformGroup) image.RenderTransform;
            ScaleTransform transform = (ScaleTransform) transformGroup.Children[0];

            double zoom = e.Delta > 0 ? .2 : -.2;
            transform.ScaleX += zoom;
            transform.ScaleY += zoom;
        }
    }
} 
```

我有一些源代码演示了这个[Jot the sticky note app](https://github.com/kelias/Jot)。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-04-14T19:23:32.797

*   Pan：将图像放入 Canvas 中。实现 Mouse Up、Down 和 Move 事件以移动 Canvas.Top、Canvas.Left 属性。向下时，将 isDraggingFlag 标记为 true，向上时将标志设置为 false。在移动时，您检查是否设置了标志，如果是，则您偏移画布内图像上的 Canvas.Top 和 Canvas.Left 属性。
*   缩放：将滑块绑定到画布的缩放变换
*   显示叠加层：在包含图像的画布上添加其他没有背景的画布。
*   显示原始图像：ViewBox 内的图像控件

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-05-05T18:38:52.510

试试这个缩放控制：[http ://wpfextensions.codeplex.com](http://wpfextensions.codeplex.com)

控件的用法很简单，参考wpfextensions组件比：

```
<wpfext:ZoomControl>
    <Image Source="..."/>
</wpfext:ZoomControl> 
```

目前不支持滚动条。（它将在下一版或两周内发布）。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2010-08-23T07:05:16.060

@Anothen 和 @Number8 - Vector 类在 Silverlight 中不可用，因此要使其工作，我们只需要记录上次调用 MouseMove 事件时看到的最后位置，并比较两点以找出差异; 然后调整变换。

XAML：

```
 <Border Name="viewboxBackground" Background="Black">
            <Viewbox Name="viewboxMain">
                <!--contents go here-->
            </Viewbox>
    </Border> 
```

代码隐藏：

```
 public Point _mouseClickPos;
    public bool bMoving;

    public MainPage()
    {
        InitializeComponent();
        viewboxMain.RenderTransform = new CompositeTransform();
    }

    void MouseMoveHandler(object sender, MouseEventArgs e)
    {

        if (bMoving)
        {
            //get current transform
            CompositeTransform transform = viewboxMain.RenderTransform as CompositeTransform;

            Point currentPos = e.GetPosition(viewboxBackground);
            transform.TranslateX += (currentPos.X - _mouseClickPos.X) ;
            transform.TranslateY += (currentPos.Y - _mouseClickPos.Y) ;

            viewboxMain.RenderTransform = transform;

            _mouseClickPos = currentPos;
        }            
    }

    void MouseClickHandler(object sender, MouseButtonEventArgs e)
    {
        _mouseClickPos = e.GetPosition(viewboxBackground);
        bMoving = true;
    }

    void MouseReleaseHandler(object sender, MouseButtonEventArgs e)
    {
        bMoving = false;
    } 
```

另请注意，您不需要 TransformGroup 或集合来实现平移和缩放；取而代之的是，[CompositeTransform](http://msdn.microsoft.com/en-us/library/system.windows.media.compositetransform(VS.95).aspx)会更轻松地解决问题。

我很确定这在资源使用方面确实效率低下，但至少它有效:)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-05-10T00:09:57.407

要相对于鼠标位置进行缩放，您只需要：

```
var position = e.GetPosition(image1);
image1.RenderTransformOrigin = new Point(position.X / image1.ActualWidth, position.Y / image1.ActualHeight); 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2021-02-09T22:50:55.260

我也尝试[了这个答案](https://stackoverflow.com/questions/741956/pan-zoom-image/6782715#6782715)，但对结果并不完全满意。我一直在谷歌上搜索，终于找到了一个 Nuget 包，它可以帮助我管理我想要的结果，anno 2021。我想与 Stack Overflow 的前开发人员分享。

我使用了通过[这个 Github Repository找到的](https://github.com/GuOrg/Gu.Wpf.Geometry)[这个 Nuget Package](https://www.nuget.org/packages/Gu.Wpf.Geometry/) **Gu.WPF.Geometry**。开发的所有功劳都应归功于**此软件包的所有者 Johan Larsson。**

 **我是怎么用的？我想将命令作为缩放框下方的按钮，如此处所示`MachineLayoutControl.xaml`。

```
<UserControl
   x:Class="MyLib.MachineLayoutControl"
   xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
   xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
   xmlns:csmachinelayoutdrawlib="clr-namespace:CSMachineLayoutDrawLib"
   xmlns:effects="http://gu.se/Geometry">
   <UserControl.Resources>
       <ResourceDictionary Source="Resources/ResourceDictionaries/AllResourceDictionariesCombined.xaml" />
   </UserControl.Resources>

   <Grid Margin="0">
       <Grid.RowDefinitions>
           <RowDefinition Height="*" />
           <RowDefinition Height="Auto" />
       </Grid.RowDefinitions>

       <Border
           Grid.Row="0"
           Margin="0,0"
           Padding="0"
           BorderThickness="1"
           Style="{StaticResource Border_Head}"
           Visibility="Visible">
           <effects:Zoombox
               x:Name="ImageBox"
               IsManipulationEnabled="True"
               MaxZoom="10"
               MinZoom="0.1"
               Visibility="{Binding Zoombox_Visibility}">
               <ContentControl Content="{Binding Viewing_Canvas}" />
           </effects:Zoombox>
       </Border>
           <StackPanel
               Grid.Column="1"
               Margin="10"
               HorizontalAlignment="Right"
               Orientation="Horizontal">
               <Button
                   Command="effects:ZoomCommands.Increase"
                   CommandParameter="2.0"
                   CommandTarget="{Binding ElementName=ImageBox}"
                   Content="Zoom In"
                   Style="{StaticResource StyleForResizeButtons}" />

               <Button
                   Command="effects:ZoomCommands.Decrease"
                   CommandParameter="2.0"
                   CommandTarget="{Binding ElementName=ImageBox}"
                   Content="Zoom Out"
                   Style="{StaticResource StyleForResizeButtons}" />

               <Button
                   Command="effects:ZoomCommands.Uniform"
                   CommandTarget="{Binding ElementName=ImageBox}"
                   Content="See Full Machine"
                   Style="{StaticResource StyleForResizeButtons}" />

               <Button
                   Command="effects:ZoomCommands.UniformToFill"
                   CommandTarget="{Binding ElementName=ImageBox}"
                   Content="Zoom To Machine Width"
                   Style="{StaticResource StyleForResizeButtons}" />

           </StackPanel>

</Grid>
</UserControl> 
```

在底层 Viewmodel 中，我有以下相关代码：

```
public Visibility Zoombox_Visibility { get => movZoombox_Visibility; set { movZoombox_Visibility = value; OnPropertyChanged(nameof(Zoombox_Visibility)); } }
public Canvas Viewing_Canvas { get => mdvViewing_Canvas; private set => mdvViewing_Canvas = value; } 
```

另外，我希望**在加载时立即执行 Uniform to Fill 命令，**这是我在*代码隐藏* `MachineLayoutControl.xaml.cs`中设法做到的。您会看到，如果执行命令，我只将 Zoombox 设置为可见，以避免在加载用户控件时“闪烁”。

```
 public partial class MachineLayoutControl : UserControl
    {
        #region Constructors

        public MachineLayoutControl()
        {
            InitializeComponent();
            Loaded += MyWindow_Loaded;
        }

        #endregion Constructors

        #region EventHandlers

        private void MyWindow_Loaded(object sender, RoutedEventArgs e)
        {
            Application.Current.Dispatcher.BeginInvoke(
               DispatcherPriority.ApplicationIdle,
               new Action(() =>
               {
                   ZoomCommands.Uniform.Execute(null, ImageBox);
                   ((MachineLayoutControlViewModel)DataContext).Zoombox_Visibility = Visibility.Visible;
               }));
        }

        #endregion EventHandlers
    } 
```

[![结果](https://i.stack.imgur.com/8kcpj.png)](https://i.stack.imgur.com/8kcpj.png)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-09-23T09:52:00.837

@默克

对于您的 lambda 表达式解决方案，您可以使用以下代码：

```
//var tt = (TranslateTransform)((TransformGroup)image.RenderTransform).Children.First(tr => tr is TranslateTransform);
        TranslateTransform tt = null;
        TransformGroup transformGroup = (TransformGroup)grid.RenderTransform;
        for (int i = 0; i < transformGroup.Children.Count; i++)
        {
            if (transformGroup.Children[i] is TranslateTransform)
                tt = (TranslateTransform)transformGroup.Children[i];
        } 
```

此代码可按原样用于 .Net Frame work 3.0 或 2.0

希望它可以帮助你:-)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2012-08-10T07:34:47.670

同一种控制的另一个版本。它具有与其他类似的功能，但它增加了：

1.  触摸支持（拖动/捏合）
2.  可以删除图像（通常，图像控件会将图像锁定在磁盘上，因此您无法删除它）。
3.  内边框子项，因此平移后的图像不会与边框重叠。如果边框带有圆角矩形，请查找 ClippedBorder 类。

用法很简单：

```
<Controls:ImageViewControl ImagePath="{Binding ...}" /> 
```

和代码：

```
public class ImageViewControl : Border
{
    private Point origin;
    private Point start;
    private Image image;

    public ImageViewControl()
    {
        ClipToBounds = true;
        Loaded += OnLoaded;
    }

    #region ImagePath

    /// <summary>
    ///     ImagePath Dependency Property
    /// </summary>
    public static readonly DependencyProperty ImagePathProperty = DependencyProperty.Register("ImagePath", typeof (string), typeof (ImageViewControl), new FrameworkPropertyMetadata(string.Empty, OnImagePathChanged));

    /// <summary>
    ///     Gets or sets the ImagePath property. This dependency property 
    ///     indicates the path to the image file.
    /// </summary>
    public string ImagePath
    {
        get { return (string) GetValue(ImagePathProperty); }
        set { SetValue(ImagePathProperty, value); }
    }

    /// <summary>
    ///     Handles changes to the ImagePath property.
    /// </summary>
    private static void OnImagePathChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        var target = (ImageViewControl) d;
        var oldImagePath = (string) e.OldValue;
        var newImagePath = target.ImagePath;
        target.ReloadImage(newImagePath);
        target.OnImagePathChanged(oldImagePath, newImagePath);
    }

    /// <summary>
    ///     Provides derived classes an opportunity to handle changes to the ImagePath property.
    /// </summary>
    protected virtual void OnImagePathChanged(string oldImagePath, string newImagePath)
    {
    }

    #endregion

    private void OnLoaded(object sender, RoutedEventArgs routedEventArgs)
    {
        image = new Image {
                              //IsManipulationEnabled = true,
                              RenderTransformOrigin = new Point(0.5, 0.5),
                              RenderTransform = new TransformGroup {
                                                                       Children = new TransformCollection {
                                                                                                              new ScaleTransform(),
                                                                                                              new TranslateTransform()
                                                                                                          }
                                                                   }
                          };
        // NOTE I use a border as the first child, to which I add the image. I do this so the panned image doesn't partly obscure the control's border.
        // In case you are going to use rounder corner's on this control, you may to update your clipping, as in this example:
        // http://wpfspark.wordpress.com/2011/06/08/clipborder-a-wpf-border-that-clips/
        var border = new Border {
                                    IsManipulationEnabled = true,
                                    ClipToBounds = true,
                                    Child = image
                                };
        Child = border;

        image.MouseWheel += (s, e) =>
                                {
                                    var zoom = e.Delta > 0
                                                   ? .2
                                                   : -.2;
                                    var position = e.GetPosition(image);
                                    image.RenderTransformOrigin = new Point(position.X / image.ActualWidth, position.Y / image.ActualHeight);
                                    var st = (ScaleTransform)((TransformGroup)image.RenderTransform).Children.First(tr => tr is ScaleTransform);
                                    st.ScaleX += zoom;
                                    st.ScaleY += zoom;
                                    e.Handled = true;
                                };

        image.MouseLeftButtonDown += (s, e) =>
                                         {
                                             if (e.ClickCount == 2)
                                                 ResetPanZoom();
                                             else
                                             {
                                                 image.CaptureMouse();
                                                 var tt = (TranslateTransform) ((TransformGroup) image.RenderTransform).Children.First(tr => tr is TranslateTransform);
                                                 start = e.GetPosition(this);
                                                 origin = new Point(tt.X, tt.Y);
                                             }
                                             e.Handled = true;
                                         };

        image.MouseMove += (s, e) =>
                               {
                                   if (!image.IsMouseCaptured) return;
                                   var tt = (TranslateTransform) ((TransformGroup) image.RenderTransform).Children.First(tr => tr is TranslateTransform);
                                   var v = start - e.GetPosition(this);
                                   tt.X = origin.X - v.X;
                                   tt.Y = origin.Y - v.Y;
                                   e.Handled = true;
                               };

        image.MouseLeftButtonUp += (s, e) => image.ReleaseMouseCapture();

        //NOTE I apply the manipulation to the border, and not to the image itself (which caused stability issues when translating)!
        border.ManipulationDelta += (o, e) =>
                                       {
                                           var st = (ScaleTransform)((TransformGroup)image.RenderTransform).Children.First(tr => tr is ScaleTransform);
                                           var tt = (TranslateTransform)((TransformGroup)image.RenderTransform).Children.First(tr => tr is TranslateTransform);

                                           st.ScaleX *= e.DeltaManipulation.Scale.X;
                                           st.ScaleY *= e.DeltaManipulation.Scale.X;
                                           tt.X += e.DeltaManipulation.Translation.X;
                                           tt.Y += e.DeltaManipulation.Translation.Y;

                                           e.Handled = true;
                                       };
    }

    private void ResetPanZoom()
    {
        var st = (ScaleTransform)((TransformGroup)image.RenderTransform).Children.First(tr => tr is ScaleTransform);
        var tt = (TranslateTransform)((TransformGroup)image.RenderTransform).Children.First(tr => tr is TranslateTransform);
        st.ScaleX = st.ScaleY = 1;
        tt.X = tt.Y = 0;
        image.RenderTransformOrigin = new Point(0.5, 0.5);
    }

    /// <summary>
    /// Load the image (and do not keep a hold on it, so we can delete the image without problems)
    /// </summary>
    /// <see cref="http://blogs.vertigo.com/personal/ralph/Blog/Lists/Posts/Post.aspx?ID=18"/>
    /// <param name="path"></param>
    private void ReloadImage(string path)
    {
        try
        {
            ResetPanZoom();
            // load the image, specify CacheOption so the file is not locked
            var bitmapImage = new BitmapImage();
            bitmapImage.BeginInit();
            bitmapImage.CacheOption = BitmapCacheOption.OnLoad;
            bitmapImage.UriSource = new Uri(path, UriKind.RelativeOrAbsolute);
            bitmapImage.EndInit();
            image.Source = bitmapImage;
        }
        catch (SystemException e)
        {
            Console.WriteLine(e.Message);
        }
    }
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2017-07-14T11:17:17.990

这将放大和缩小以及平移，但将图像保持在容器的范围内。编写为控件，因此`App.xaml`直接或通过将样式添加到`Themes/Viewport.xaml`.

为了便于阅读，我还在[gist](https://gist.github.com/ahancock1/a2958f7eedd3e8d13e6ddda8feef0a65)和[github上上传了这个](https://github.com/ahancock1/Han.Wpf.ViewportControl)

我也在[nuget上打包了这个](https://www.nuget.org/packages/Han.Wpf.ViewportControl/1.0.0)

```
PM > Install-Package Han.Wpf.ViewportControl 
```

./Controls/Viewport.cs：

```
public class Viewport : ContentControl
{
    private bool _capture;
    private FrameworkElement _content;
    private Matrix _matrix;
    private Point _origin;

    public static readonly DependencyProperty MaxZoomProperty =
        DependencyProperty.Register(
            nameof(MaxZoom),
            typeof(double),
            typeof(Viewport),
            new PropertyMetadata(0d));

    public static readonly DependencyProperty MinZoomProperty =
        DependencyProperty.Register(
            nameof(MinZoom),
            typeof(double),
            typeof(Viewport),
            new PropertyMetadata(0d));

    public static readonly DependencyProperty ZoomSpeedProperty =
        DependencyProperty.Register(
            nameof(ZoomSpeed),
            typeof(float),
            typeof(Viewport),
            new PropertyMetadata(0f));

    public static readonly DependencyProperty ZoomXProperty =
        DependencyProperty.Register(
            nameof(ZoomX),
            typeof(double),
            typeof(Viewport),
            new FrameworkPropertyMetadata(0d, FrameworkPropertyMetadataOptions.BindsTwoWayByDefault));

    public static readonly DependencyProperty ZoomYProperty =
        DependencyProperty.Register(
            nameof(ZoomY),
            typeof(double),
            typeof(Viewport),
            new FrameworkPropertyMetadata(0d, FrameworkPropertyMetadataOptions.BindsTwoWayByDefault));

    public static readonly DependencyProperty OffsetXProperty =
        DependencyProperty.Register(
            nameof(OffsetX),
            typeof(double),
            typeof(Viewport),
            new FrameworkPropertyMetadata(0d, FrameworkPropertyMetadataOptions.BindsTwoWayByDefault));

    public static readonly DependencyProperty OffsetYProperty =
        DependencyProperty.Register(
            nameof(OffsetY),
            typeof(double),
            typeof(Viewport),
            new FrameworkPropertyMetadata(0d, FrameworkPropertyMetadataOptions.BindsTwoWayByDefault));

    public static readonly DependencyProperty BoundsProperty =
        DependencyProperty.Register(
            nameof(Bounds),
            typeof(Rect),
            typeof(Viewport),
            new FrameworkPropertyMetadata(default(Rect), FrameworkPropertyMetadataOptions.BindsTwoWayByDefault));

    public Rect Bounds
    {
        get => (Rect) GetValue(BoundsProperty);
        set => SetValue(BoundsProperty, value);
    }

    public double MaxZoom
    {
        get => (double) GetValue(MaxZoomProperty);
        set => SetValue(MaxZoomProperty, value);
    }

    public double MinZoom
    {
        get => (double) GetValue(MinZoomProperty);
        set => SetValue(MinZoomProperty, value);
    }

    public double OffsetX
    {
        get => (double) GetValue(OffsetXProperty);
        set => SetValue(OffsetXProperty, value);
    }

    public double OffsetY
    {
        get => (double) GetValue(OffsetYProperty);
        set => SetValue(OffsetYProperty, value);
    }

    public float ZoomSpeed
    {
        get => (float) GetValue(ZoomSpeedProperty);
        set => SetValue(ZoomSpeedProperty, value);
    }

    public double ZoomX
    {
        get => (double) GetValue(ZoomXProperty);
        set => SetValue(ZoomXProperty, value);
    }

    public double ZoomY
    {
        get => (double) GetValue(ZoomYProperty);
        set => SetValue(ZoomYProperty, value);
    }

    public Viewport()
    {
        DefaultStyleKey = typeof(Viewport);

        Loaded += OnLoaded;
        Unloaded += OnUnloaded;
    }

    private void Arrange(Size desired, Size render)
    {
        _matrix = Matrix.Identity;

        var zx = desired.Width / render.Width;
        var zy = desired.Height / render.Height;
        var cx = render.Width < desired.Width ? render.Width / 2.0 : 0.0;
        var cy = render.Height < desired.Height ? render.Height / 2.0 : 0.0;

        var zoom = Math.Min(zx, zy);

        if (render.Width > desired.Width &&
            render.Height > desired.Height)
        {
            cx = (desired.Width - (render.Width * zoom)) / 2.0;
            cy = (desired.Height - (render.Height * zoom)) / 2.0;

            _matrix = new Matrix(zoom, 0d, 0d, zoom, cx, cy);
        }
        else
        {
            _matrix.ScaleAt(zoom, zoom, cx, cy);
        }
    }

    private void Attach(FrameworkElement content)
    {
        content.MouseMove += OnMouseMove;
        content.MouseLeave += OnMouseLeave;
        content.MouseWheel += OnMouseWheel;
        content.MouseLeftButtonDown += OnMouseLeftButtonDown;
        content.MouseLeftButtonUp += OnMouseLeftButtonUp;
        content.SizeChanged += OnSizeChanged;
        content.MouseRightButtonDown += OnMouseRightButtonDown;
    }

    private void ChangeContent(FrameworkElement content)
    {
        if (content != null && !Equals(content, _content))
        {
            if (_content != null)
            {
                Detatch();
            }

            Attach(content);
            _content = content;
        }
    }

    private double Constrain(double value, double min, double max)
    {
        if (min > max)
        {
            min = max;
        }

        if (value <= min)
        {
            return min;
        }

        if (value >= max)
        {
            return max;
        }

        return value;
    }

    private void Constrain()
    {
        var x = Constrain(_matrix.OffsetX, _content.ActualWidth - _content.ActualWidth * _matrix.M11, 0);
        var y = Constrain(_matrix.OffsetY, _content.ActualHeight - _content.ActualHeight * _matrix.M22, 0);

        _matrix = new Matrix(_matrix.M11, 0d, 0d, _matrix.M22, x, y);
    }

    private void Detatch()
    {
        _content.MouseMove -= OnMouseMove;
        _content.MouseLeave -= OnMouseLeave;
        _content.MouseWheel -= OnMouseWheel;
        _content.MouseLeftButtonDown -= OnMouseLeftButtonDown;
        _content.MouseLeftButtonUp -= OnMouseLeftButtonUp;
        _content.SizeChanged -= OnSizeChanged;
        _content.MouseRightButtonDown -= OnMouseRightButtonDown;
    }

    private void Invalidate()
    {
        if (_content != null)
        {
            Constrain();

            _content.RenderTransformOrigin = new Point(0, 0);
            _content.RenderTransform = new MatrixTransform(_matrix);
            _content.InvalidateVisual();

            ZoomX = _matrix.M11;
            ZoomY = _matrix.M22;

            OffsetX = _matrix.OffsetX;
            OffsetY = _matrix.OffsetY;

            var rect = new Rect
            {
                X = OffsetX * -1,
                Y = OffsetY * -1,
                Width = ActualWidth,
                Height = ActualHeight
            };

            Bounds = rect;
        }
    }

    public override void OnApplyTemplate()
    {
        base.OnApplyTemplate();
        _matrix = Matrix.Identity;
    }

    protected override void OnContentChanged(object oldContent, object newContent)
    {
        base.OnContentChanged(oldContent, newContent);

        if (Content is FrameworkElement element)
        {
            ChangeContent(element);
        }
    }

    private void OnLoaded(object sender, RoutedEventArgs e)
    {
        if (Content is FrameworkElement element)
        {
            ChangeContent(element);
        }

        SizeChanged += OnSizeChanged;
        Loaded -= OnLoaded;
    }

    private void OnMouseLeave(object sender, MouseEventArgs e)
    {
        if (_capture)
        {
            Released();
        }
    }

    private void OnMouseLeftButtonDown(object sender, MouseButtonEventArgs e)
    {
        if (IsEnabled && !_capture)
        {
            Pressed(e.GetPosition(this));
        }
    }

    private void OnMouseLeftButtonUp(object sender, MouseButtonEventArgs e)
    {
        if (IsEnabled && _capture)
        {
            Released();
        }
    }

    private void OnMouseMove(object sender, MouseEventArgs e)
    {
        if (IsEnabled && _capture)
        {
            var position = e.GetPosition(this);

            var point = new Point
            {
                X = position.X - _origin.X,
                Y = position.Y - _origin.Y
            };

            var delta = point;
            _origin = position;

            _matrix.Translate(delta.X, delta.Y);

            Invalidate();
        }
    }

    private void OnMouseRightButtonDown(object sender, MouseButtonEventArgs e)
    {
        if (IsEnabled)
        {
            Reset();
        }
    }

    private void OnMouseWheel(object sender, MouseWheelEventArgs e)
    {
        if (IsEnabled)
        {
            var scale = e.Delta > 0 ? ZoomSpeed : 1 / ZoomSpeed;
            var position = e.GetPosition(_content);

            var x = Constrain(scale, MinZoom / _matrix.M11, MaxZoom / _matrix.M11);
            var y = Constrain(scale, MinZoom / _matrix.M22, MaxZoom / _matrix.M22);

            _matrix.ScaleAtPrepend(x, y, position.X, position.Y);

            ZoomX = _matrix.M11;
            ZoomY = _matrix.M22;

            Invalidate();
        }
    }

    private void OnSizeChanged(object sender, SizeChangedEventArgs e)
    {
        if (_content?.IsMeasureValid ?? false)
        {
            Arrange(_content.DesiredSize, _content.RenderSize);

            Invalidate();
        }
    }

    private void OnUnloaded(object sender, RoutedEventArgs e)
    {
        Detatch();

        SizeChanged -= OnSizeChanged;
        Unloaded -= OnUnloaded;
    }

    private void Pressed(Point position)
    {
        if (IsEnabled)
        {
            _content.Cursor = Cursors.Hand;
            _origin = position;
            _capture = true;
        }
    }

    private void Released()
    {
        if (IsEnabled)
        {
            _content.Cursor = null;
            _capture = false;
        }
    }

    private void Reset()
    {
        _matrix = Matrix.Identity;

        if (_content != null)
        {
            Arrange(_content.DesiredSize, _content.RenderSize);
        }

        Invalidate();
    }
} 
```

./Themes/Viewport.xaml：

```
<ResourceDictionary ... >

    <Style TargetType="{x:Type controls:Viewport}"
           BasedOn="{StaticResource {x:Type ContentControl}}">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type controls:Viewport}">
                    <Border BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            Background="{TemplateBinding Background}">
                        <Grid ClipToBounds="True"
                              Width="{TemplateBinding Width}"
                              Height="{TemplateBinding Height}">
                            <Grid x:Name="PART_Container">
                                <ContentPresenter x:Name="PART_Presenter" />
                            </Grid>
                        </Grid>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

</ResourceDictionary> 
```

./App.xaml

```
<Application ... >
    <Application.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>

                <ResourceDictionary Source="./Themes/Viewport.xaml"/>

            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Application.Resources>
</Application> 
```

用法：

```
<viewers:Viewport>
    <Image Source="{Binding}"/>
</viewers:Viewport> 
```

有什么问题，给我留言。

快乐编码:)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-12-15T04:36:52.477

[上面](https://stackoverflow.com/a/6782715/521342)@WiesławŠoltés回答提供的极好的解决方案的一个补充

现有代码使用右键单击重置图像位置，但我更习惯于通过双击来执行此操作。只需替换现有的 child_MouseLeftButtonDown 处理程序：

```
private void child_MouseLeftButtonDown(object sender, MouseButtonEventArgs e)
    {
        if (child != null)
        {
            var tt = GetTranslateTransform(child);
            start = e.GetPosition(this);
            origin = new Point(tt.X, tt.Y);
            this.Cursor = Cursors.Hand;
            child.CaptureMouse();
        }
    } 
```

有了这个：

```
private void child_MouseLeftButtonDown(object sender, MouseButtonEventArgs e)
    {
        if ((e.ChangedButton == MouseButton.Left && e.ClickCount == 1))
        {
            if (child != null)
            {
                var tt = GetTranslateTransform(child);
                start = e.GetPosition(this);
                origin = new Point(tt.X, tt.Y);
                this.Cursor = Cursors.Hand;
                child.CaptureMouse();
            }
        }

        if ((e.ChangedButton == MouseButton.Left && e.ClickCount == 2))
        {
            this.Reset();
        }
    } 
```

# php - 如何使用 php 将 php 页面转换为 .doc 文件

> ID：741958
> 
> 赞同：0
> 
> 时间：2009-04-12T15:49:43.203
> 
> 标签：php, ms-word

最近我在一个项目中工作。在这个项目中，我需要将页面转换为 Microsoft Word 文档（.doc 文件）并提供该文档供下载，全部使用 PHP。但我无法解决这个问题。

请帮我。非常感谢，阿里夫

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-12T18:36:40.993

这并不容易解决。

首先，如果你想写*真正的*Word 文档，你必须在 Windows 上做。您可以使用[COM](http://us.php.net/com)与 Word 对话，这就是您设法获得良好结果的方法。我已经尝试了所有基于 unix/linux 的解决方案，但结果并不是那么好。

否则，我建议您编写 RTF——这同样好。最后，您可以调用 .rtf 文件、.doc 并且没有人会注意到它。RTF 有一些限制（格式），但另一方面——它都是 ASCII 并且[RTF 标准](http://msdn.microsoft.com/en-us/library/aa140277.aspx)非常全面且有据可查。

有一个类做得很好[——phpLiveDocx](http://www.phplivedocx.org/articles/brief-introduction-to-phplivedocx/)（这是一个很好的介绍）。这门课还声称可以编写 PDF 和 DOC——但我还没有尝试过。我对 PDF 使用另一种解决方案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T20:01:57.247

也许不是您寻求的答案，但仍然值得注意的是，有一个名为 abiword 的开源文字处理器，它有一个 CLI（命令行界面）。您可以使用它轻松地在文档格式之间进行转换。我知道至少有一个网站使用它将文本文件转换为各种格式。

它正在积极开发中，可以很容易地用作转换文档服务器端的 3de 方黑盒解决方案。

这是一位开发人员关于如何将其与 PHP 集成的博客

[服务器端 AbiWord](http://www.advogato.org/person/msevior/diary.html?start=65)

[abiword 主页](http://www.abisource.com/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T19:44:16.757

我建议使用 RTF 格式而不是 .doc - 它更易于写入，并且所有文本编辑器都理解它。当您想要输出 Excel 文件时，对 .csv 的类似建议。

# windows - 以太网类型

> ID：741959
> 
> 赞同：-1
> 
> 时间：2009-04-12T15:51:52.933
> 
> 标签：windows, ethernet

以太网标头中有一个称为以太网类型的字段。我正在使用原始以太网帧在 Windows 中编写通信库。我应该怎么做才能考虑以太网类型？我必须使用的是 0xBEEF。这是否意味着我不能使用 NDIS 之类的东西？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-12T15:54:21.647

最好的办法是[阅读 EtherType 字段](http://en.wikipedia.org/wiki/Ethertype)。

> 它用于指示帧数据中封装了哪种协议。

这意味着如果您使用`0xBEEF`，其他运行标准软件的机器将无法识别帧的有效负载。

当然，您可以在帧中发送任何类型的数据。您只需在接收端安装软件即可解释数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-10-24T10:40:27.510

以太网类型基本上是包含在特定以太网帧中的数据协议类型。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2017-05-12T18:11:31.563

如果没有很好的理由这样做，我永远不会使用原始以太网帧。例如，使用 UDP 数据包通常更简单且更具前瞻性。

# asp.net - 我的 GridView 代码有问题

> ID：741969
> 
> 赞同：0
> 
> 时间：2009-04-12T16:02:55.980
> 
> 标签：asp.net, vb.net, dataadapter

这段代码永远不会填满网格视图我知道这里的代码有问题

```
Imports System.Data
Imports ZidduDataSetTableAdapters
Partial Class _Default
    Inherits System.Web.UI.Page
    Dim filesAdp As New FilesTableAdapter
    Dim filestable As New ZidduDataSet.FilesDataTable
    Protected Sub btnfill_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles btnfill.Click
        Me.GridView1.DataSource = filesAdp.GetData
        Me.GridView1.DataBind()
    End Sub
End Class 
```

我已经使用名为 ZidduDataSet.xsd 的向导创建了数据集，适配器名称为 FilesTableAdapter

有人可以帮忙吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-12T19:16:15.390

我不是 VB 编码器，但我认为您也应该在页面加载事件上调用 Databind() 函数。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T06:25:30.007

代码唯一的问题是**从未**使用过文件表。如果您的 gridview 没有出现，那么您在我认为的其他地方有问题。

1.  btnfill_Click 没有被调用。检查 .aspx 标记以确保引用了事件处理程序。
2.  filesAdp.GetData 不返回任何数据。
3.  GridView1 在页面上不可见。

# sql - TSQL 使 EXECUTE 语句同步

> ID：741970
> 
> 赞同：2
> 
> 时间：2009-04-12T16:03:02.453
> 
> 标签：sql, sql-server, tsql, exec, synchronous

我有两个 TSQL EXEC 语句

```
EXECUTE (N'MyDynamicallyGeneratedStoredProcedure') -- return 0 on success
SELECT @errCode = @@ERROR ;

IF (@errCode = 0)
BEGIN
  EXEC 'A Sql Statement using ##temptable created from first', @returnValue
END 
```

如何使两个 EXEC 同步？; 现在第二个 EXEC 不会等待第一个 EXECUTE 完成。我尝试发出 WaitFor 延迟，它等待但第二个 EXEC 语句永远不会返回。

谢谢。

**更新，这里有更多信息：**

1.  首先执行创建一个全局临时表并从一个复杂的 SELECT 查询中填充它。
2.  第二个 EXEC 是一个 CLR 存储过程，它根据最近创建和填充的全局临时表中的变量生成动态 SP。

现在第二个 EXEC 抱怨找不到 Global Temp 表。

**更新 2，发现问题（还有我！！）**

GBN（和其他人）对答案持空白。执行是同步的。问题？我对问题本身的理解..我提到过

1.  EXECUTE (N'MyDynamicallyGeneratedStoredProcedure') -- 成功返回 0

它应该是：

1(a) EXECUTE (N'CreateMyDynamicStoredProcedure') -- 成功返回 0

1(b) **EXECUTE (N'MyDynamicStoredProcedure') -- 成功返回 0**

我错过了 1(b) 实际上是在其他地方和步骤 (2) 之后执行的。

（我应该去活下去！！）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-12T16:11:14.070

执行是同步的。第二个在第一个之后运行。总是。

您是否有多个连接运行相同的代码？您正在使用对所有连接都可见的全局临时表，因此它可能看起来像异步执行...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T18:17:12.990

正如[gbn 的回答](https://stackoverflow.com/questions/741970/tsql-make-execute-statement-synchronous/741979#741979)所指出的，EXECUTE 是同步的。

问题可能是 CRL 存储过程中的 SQL Connection 对象与批处理脚本不在同一个上下文中。您的全局临时表应该在运行后被删除`EXECUTE (N'MyDynamicallyGeneratedStoredProcedure')`

确保您通过传递创建 SQLConnection 对象`"context connection=true"` Here is the [post answer](https://stackoverflow.com/questions/738421/accessing-tsql-created-temp-tables-from-clr-stored-procedure-is-it-possible/739224#739224)，其中有人在访问临时表时遇到类似问题，因为 SQLConnection 不在同一连接上下文中。

[从 CLR 存储过程访问 TSQL 创建的 #temp 表。是否可以？](https://stackoverflow.com/questions/738421/accessing-tsql-created-temp-tables-from-clr-stored-procedure-is-it-possible)

如果您的第二个 CRL 存储过程通过不同的连接运行，则 CRL sproc 将无法访问全局临时表，因为它应该已被删除。

请参阅这篇关于 Global Temporary life cycle (when the gloal temp is dropped)
[Deleting Global Temporary Tables (##tempTable) in SQL Server 的帖子](https://stackoverflow.com/questions/688531/deleting-global-temporary-tables-temptable-in-sql-server)

# .net - 如何对 TCP 服务器进行单元测试？它甚至值得吗？

> ID：741981
> 
> 赞同：17
> 
> 时间：2009-04-12T16:12:20.293
> 
> 标签：.net, unit-testing, tdd, tcp

我正在开发一个小型 TCP 服务器，它将处理一些 TCP 数据包并根据请求采取不同的行为。

我该如何为此编写单元测试？如果真的很难写，那还值得吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-12T16:22:47.820

我会尝试从处理位中提取特定于 TCP 的位。你的协议*真的*是基于数据包的，还是基于流的？如果它是基于流的，您可以让处理部分接受一个流（或者可能是一对流，一个用于输入，一个用于输出）并使用一个`MemoryStream`或您自己的类似流实现来提供更多控制。

无论哪种方式，您基本上都想模拟事物的网络端，这样您就可以在不涉及网络的情况下测试真正的逻辑。测试网络层（即框架网络类和处理逻辑之间的薄逻辑部分）可能会有点困难，但如果你可以让它足够薄，那么测试应该不会太多。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-12T16:20:21.100

首先要做的是将行为与传入的 TCP 数据包分开。将其抽象为调度表或其他类似的东西。

然后为每个行为编写单元测试，而不管它们是如何被调用的。您可以使用您编写或借用的测试工具测试最终的 TCP -> 行为层。如果代码被正确分解，该层应该几乎是微不足道的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-12T16:17:26.037

这将是非常值得的。

单元测试的数量应该与请求的类型（不同的行为）一致。当您进行修改并查看它是否影响 TCP 服务器的其他部分时，这将很有用。

您可以使用几种可用的工具模拟发送 TCP 数据包。让我知道事情的后续。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-12T16:27:15.017

如果您编写 TCP 服务器，您还应该编写客户端库。除非您正在做一些花哨的事情，否则您可以简单地通过单元测试和存根服务器之间的环回适配器触发数据包。您只需要通过这些测试验证您是否正确地执行 TCP，因为您的其余测试应该以适当的单元测试方式，存根/跳过 TCP/套接字逻辑并直接跳入正在测试的单个单元。

做这一切是完全值得的。如果您对 TCP 足够陌生，不确定如何以及为什么应该对其进行单元测试，那么您可能会在编写 TCP 代码时犯一些错误/错误假设，而单元测试对于调用那出来。您还会发现它鼓励您更多地关注客户端的需求，这往往会产生更简洁的协议和更简洁的服务器代码库。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-12T16:19:03.583

我对.net 一无所知，但我可以告诉你有关单元测试的信息。

你需要考虑因素。例如，您的服务器可能在一个线程中运行并做一些工作。它在哪里工作应该在一个函数内部。您也可能有一个请求对象。使tcp服务器的“工作函数”以请求对象为参数。然后像往常一样进行单元测试：在测试开始时，设置请求，并将其传递给 tcp 服务器对象的“工作函数”。实际上不要让服务器打开套接字或任何东西。您只是对完成工作的方法进行单元测试，并且只测试请求的处理。您*不是在*测试套接字或网络可靠性或类似的东西。你需要以不同的方式测试这些东西。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-12T16:21:40.597

你可以看看[NMock](http://www.nmock.org/)，一个 .NET 的模拟库。如果有两方参与单元测试，最好只“模拟”一方（你没有测试的一方，在这种情况下是客户端）。

然而，这将需要对您的代码进行一些更改，但相信我，这是值得的。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-12T16:23:45.507

我不能给你任何具体的帮助，因为你的问题是相当开放的。

然而，这听起来好像你想根据你的需要编写一个模拟服务器/客户端。值得一看[Rhino Mocks](http://ayende.com/projects/rhino-mocks.aspx)。

您可能还想查看 Oren 的[NMemCached 项目](https://rhino-tools.svn.sourceforge.net/svnroot/rhino-tools/experiments/NMemcached/)，该项目使用自定义 TCP/IP 实现来实现缓存服务器。该项目有一些使用 Rhino Mocks 编写的有趣的单元/集成测试。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-12T16:24:27.033

这当然是值得的。对于我正在开发的基于 HTTP 小型服务器的应用程序，我所做的是拥有一系列使用**wget**在服务器上触发请求的脚本。然后我使用**diff**将保存的 wget 输出与我期望得到的输出进行比较，并报告任何差异。每次更改服务器时，我都会运行这一堆脚本，并且它已经捕获了很多错误。

显然，这仅适用于 HTTP 服务器，但值得您编写一个可以在您的服务器上触发 TCP 请求并保存结果的小应用程序。

# qt - 从 QWebView 打开外部浏览器

> ID：741984
> 
> 赞同：5
> 
> 时间：2009-04-12T16:15:38.740
> 
> 标签：qt, qwebview

我的应用程序上有一个“起始页”，它只是一个`QWebView`从我的服务器下载页面的小部件。

当用户点击一个链接时，我希望它在他们的默认浏览器中打开，而不是在小部件中。

有没有办法做到这一点`QWebView`？还是我应该采取不同的方法？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-12T21:43:00.247

只需调用 QWebPage::setLinkDelegationPolicy(QWebPage::DelegateAllLinks) 然后将信号 QWebView::linkClicked (const QUrl & url) 连接到插槽，并在插槽中执行浏览器。找出默认浏览器是什么，稍微复杂一些，并且取决于用户正在运行的桌面。环境变量 BROWSER 通常包含默认值。

或使用[QDesktopServices::openUrl](https://doc.qt.io/qt-5/qdesktopservices.html#openUrl) [如 gnud 在评论中建议的那样]

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-04-08T01:05:47.713

假设链接是外部的，您可以在 QWebView 小部件上调用[QWebView::setOpenExternalLinks(true)](http://doc.qt.io/qt-5/qtextbrowser.html#openExternalLinks-prop)。该属性默认为false；将其设置为 true 会导致外部链接在您的默认 Web 浏览器中打开。

# latex - 专业书籍中的 LaTeX 源代码列表

> ID：741985
> 
> 赞同：339
> 
> 时间：2009-04-12T16:15:51.500
> 
> 标签：latex

乳胶源代码列表应该如何产生类似于已知书籍中的输出，例如用于 Spring 框架的输出？我已经尝试使用乳胶列表包，但无法产生看起来像下面这样好的东西。所以我主要对格式说明感兴趣，以生成类似下面的示例（来自 Manning 的Spring *in Action*[示例章节](http://www.manning.com/walls3/sample-ch01.pdf)）：

 *![来自曼宁的春天在行动](https://i.stack.imgur.com/GhMUK.png)

**编辑** 特别是在[Tormod Fjeldskår](https://stackoverflow.com/users/27220/tormod-fjeldsk229r)的帮助下，这是产生所需外观的完整片段：

```
\usepackage{listings}
\usepackage{courier}
\lstset{
    basicstyle=\footnotesize\ttfamily, % Default font
    % numbers=left,              % Location of line numbers
    numberstyle=\tiny,          % Style of line numbers
    % stepnumber=2,              % Margin between line numbers
    numbersep=5pt,              % Margin between line numbers and text
    tabsize=2,                  % Size of tabs
    extendedchars=true,
    breaklines=true,            % Lines will be wrapped
    keywordstyle=\color{red},
    frame=b,
    % keywordstyle=[1]\textbf,
    % keywordstyle=[2]\textbf,
    % keywordstyle=[3]\textbf,
    % keywordstyle=[4]\textbf,   \sqrt{\sqrt{}}
    stringstyle=\color{white}\ttfamily, % Color of strings
    showspaces=false,
    showtabs=false,
    xleftmargin=17pt,
    framexleftmargin=17pt,
    framexrightmargin=5pt,
    framexbottommargin=4pt,
    % backgroundcolor=\color{lightgray},
    showstringspaces=false
}
\lstloadlanguages{ % Check documentation for further languages ...
     % [Visual]Basic,
     % Pascal,
     % C,
     % C++,
     % XML,
     % HTML,
     Java
}
% \DeclareCaptionFont{blue}{\color{blue}} 

% \captionsetup[lstlisting]{singlelinecheck=false, labelfont={blue}, textfont={blue}}
\usepackage{caption}
\DeclareCaptionFont{white}{\color{white}}
\DeclareCaptionFormat{listing}{\colorbox[cmyk]{0.43, 0.35, 0.35,0.01}{\parbox{\textwidth}{\hspace{15pt}#1#2#3}}}
\captionsetup[lstlisting]{format=listing,labelfont=white,textfont=white, singlelinecheck=false, margin=0pt, font={bf,footnotesize}} 
```

在您的文档中使用它：

```
\lstinputlisting[label=samplecode, caption=A sample]{sourceCode/HelloWorld.java} 
```

* * *

## 回答 #1

> 赞同：191
> 
> 时间：2009-04-12T17:13:51.517

在我看来，您真正想要的是自定义字幕的外观。使用该`caption`软件包最容易做到这一点。有关如何使用此软件包的说明，请参阅[手册 (PDF)](http://tug.ctan.org/tex-archive/macros/latex/contrib/caption/caption-eng.pdf)。您可能需要创建自己的自定义字幕格式，如手册第 4 章所述。

**编辑：**用 MikTex 测试：

```
\documentclass{report}

\usepackage{color}
\usepackage{xcolor}
\usepackage{listings}

\usepackage{caption}
\DeclareCaptionFont{white}{\color{white}}
\DeclareCaptionFormat{listing}{\colorbox{gray}{\parbox{\textwidth}{#1#2#3}}}
\captionsetup[lstlisting]{format=listing,labelfont=white,textfont=white}

% This concludes the preamble

\begin{document}

\begin{lstlisting}[label=some-code,caption=Some Code]
public void here() {
    goes().the().code()
}
\end{lstlisting}

\end{document} 
```

**结果：**

![预览](https://i.stack.imgur.com/WmL2j.png)

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2009-04-12T16:28:18.367

`listings`我对这个包裹很满意：

![清单示例](https://i.imgur.com/f90FB.png)

这是我的配置方式：

```
\lstset{
language=C,
basicstyle=\small\sffamily,
numbers=left,
numberstyle=\tiny,
frame=tb,
columns=fullflexible,
showstringspaces=false
} 
```

我这样使用它：

```
\begin{lstlisting}[caption=Caption example.,
  label=a_label,
  float=t]
// Insert the code here
\end{lstlisting} 
```

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2009-04-12T17:11:57.747

并且，无论您做什么，请配置列表包以使用固定宽度字体（如您的示例中所示；您将在文档中找到该选项）。默认设置使用网格上的比例字体排版，即恕我直言，令人难以置信的丑陋和不可读，从其他带有图片的答案中可以看出。当我必须阅读一些按比例字体排版的代码时，我个人*非常恼火。*

尝试使用以下设置固定宽度字体：

```
\lstset{basicstyle=\ttfamily} 
```

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2015-05-27T15:08:29.107

我想知道为什么没有人提到[Minted](https://github.com/gpoore/minted)包。它比 LaTeX 列表包有更好的语法高亮。它使用[Pygments](http://pygments.org/)。

```
$ pip install Pygments 
```

LaTeX 中的示例：

```
\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}

\usepackage{minted}

\begin{document}
\begin{minted}{python}
import numpy as np

def incmatrix(genl1,genl2):
    m = len(genl1)
    n = len(genl2)
    M = None #to become the incidence matrix
    VT = np.zeros((n*m,1), int)  #dummy variable

    #compute the bitwise xor matrix
    M1 = bitxormatrix(genl1)
    M2 = np.triu(bitxormatrix(genl2),1) 

    for i in range(m-1):
        for j in range(i+1, m):
            [r,c] = np.where(M2 == M1[i,j])
            for k in range(len(r)):
                VT[(i)*n + r[k]] = 1;
                VT[(i)*n + c[k]] = 1;
                VT[(j)*n + r[k]] = 1;
                VT[(j)*n + c[k]] = 1;

                if M is None:
                    M = np.copy(VT)
                else:
                    M = np.concatenate((M, VT), 1)

                VT = np.zeros((n*m,1), int)

    return M
\end{minted}
\end{document} 
```

结果是：

![在此处输入图像描述](https://i.stack.imgur.com/5yBe8.png)

**您需要将该标志`-shell-escape`与 pdflatex 命令一起使用。**

欲了解更多信息：[https ://www.sharelatex.com/learn/Code_Highlighting_with_minted](https://www.sharelatex.com/learn/Code_Highlighting_with_minted)

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2009-04-12T16:27:45.827

试一试`listings`包装。这是我前段时间用来制作彩色 Java 列表的示例：

```
\usepackage{listings}

[...]

\lstset{language=Java,captionpos=b,tabsize=3,frame=lines,keywordstyle=\color{blue},commentstyle=\color{darkgreen},stringstyle=\color{red},numbers=left,numberstyle=\tiny,numbersep=5pt,breaklines=true,showstringspaces=false,basicstyle=\footnotesize,emph={label}}

[...]

\begin{lstlisting}
public void here() {
    goes().the().code()
}

[...]

\end{lstlisting} 
```

您可能想要自定义它。列表包有几个参考。只是谷歌他们。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-04-12T16:22:26.913

看看[`algorithms`](http://www.ctan.org/tex-archive/macros/latex/contrib/algorithms/algorithms.pdf)包装，尤其是`algorithm`环境。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2010-05-20T15:23:32.957

您还可以执行其他几项操作，例如选择新字体：

```
\documentclass[10pt,a4paper]{article}
% ... lots of packages e.g. babel, microtype, fontenc, inputenc &c.
\usepackage{color}    % Leave this out if you care about B/W printing, obviously.
\usepackage{upquote}  % Turns curly quotes in verbatim text into straight quotes. 
                      % People who have to copy/paste code from the PDF output 
                      % will love you for this. Or perhaps more accurately: 
                      % They will not hate you/hate you less.
\usepackage{beramono} % Or some other package that provides a fixed width font. q.v.
                      % http://www.tug.dk/FontCatalogue/typewriterfonts.html
\usepackage{listings} 
\lstset {                 % A rudimentary config that shows off some features.
    language=Java,
    basicstyle=\ttfamily, % Without beramono, we'd get cmtt, the teletype font.
    commentstyle=\textit, % cmtt doesn't do italics. It might do slanted text though.
    \keywordstyle=        % Nor does cmtt do bold text.
        \color{blue}\bfseries,
    \tabsize=4            % Or whatever you use in your editor, I suppose.
}
\begin{document} 
\begin{lstlisting}
public final int ourAnswer() { return 42; /* Our final answer */ }
\end{lstlisting} 
\end{document} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-06-23T20:40:06.013

对于我使用的 R 代码

```
\usepackage{listings}
\lstset{
language=R,
basicstyle=\scriptsize\ttfamily,
commentstyle=\ttfamily\color{gray},
numbers=left,
numberstyle=\ttfamily\color{gray}\footnotesize,
stepnumber=1,
numbersep=5pt,
backgroundcolor=\color{white},
showspaces=false,
showstringspaces=false,
showtabs=false,
frame=single,
tabsize=2,
captionpos=b,
breaklines=true,
breakatwhitespace=false,
title=\lstname,
escapeinside={},
keywordstyle={},
morekeywords={}
} 
```

它看起来就像这样

[![在此处输入图像描述](https://i.stack.imgur.com/7PEEB.jpg)](https://i.stack.imgur.com/7PEEB.jpg)

# jsf - 用于将 JSP taglib 支持添加到 facelets 页面的命名空间是什么？

> ID：741988
> 
> 赞同：2
> 
> 时间：2009-04-12T16:17:48.440
> 
> 标签：jsf, facelets, code-injection, javabeans

类似于以下内容

```
 xmlns:jsp="http://java.sun.com/JSP/Page" 
```

似乎不起作用，有什么提示吗？或者，如何在不使用过滤器的情况下在启动时将 bean 注入 JSF 生命周期流？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-12T21:35:22.030

> **用于将 JSP taglib 支持添加到 facelets 页面的命名空间是什么？**

你不能。Facelets 不是 JSP，也不使用 JSP 标记库。从[项目页面](https://facelets.dev.java.net/)：

> *不同之处在于 **，JSP Vendor API 的所有负担都被移除**，以更显着地增强 JSF 性能并提供简单的即插即用开发。*

* * *

> **如何将 bean 注入 JSF**

*[使用managed-bean](http://java.sun.com/javaee/5/docs/tutorial/doc/bnaqm.html#bnaqo)*元素将它们添加到您的*[WEB-INF/faces-config.xml](http://java.sun.com/javaee/5/docs/tutorial/doc/bnawp.html)*文件中。

# ruby-on-rails - ActionMailer 和 Ramaze

> ID：741989
> 
> 赞同：5
> 
> 时间：2009-04-12T16:18:38.343
> 
> 标签：ruby-on-rails, actionmailer, ramaze

是否可以在像 Ramaze 这样的 Web 框架中使用 ActionMailer，还是需要使用 Rails？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-12T16:34:13.797

你可以很容易地在没有 Rails 的情况下使用 ActionMailer。我不熟悉 Ramaze，但这里是普通的 ruby​​，它应该很容易集成到您希望的任何框架中：

**路径/mailer.rb**

```
require 'rubygems'
require 'action_mailer'

class Mailer < ActionMailer::Base
  def my_email
    recipients "recipient@their_domain.com"
    from       "me@my_domain.com"
    subject    "my subject"

    body        :variable1 => 'a', :variable2 => 'b'
  end
end

Mailer.template_root = File.dirname(__FILE__)
Mailer.delivery_method = :sendmail
Mailer.logger = Logger.new(STDOUT)

# this sends the email
Mailer.deliver_my_email 
```

然后将电子邮件模板放在以 ActionMailer 类命名的目录中

**PATH/mailer/my_email.html.erb**

```
variable 1: <%= @variable1 %>
variable 2: <%= @variable2 %> 
```

查看[API 文档](http://api.rubyonrails.org/classes/ActionMailer/Base.html)以获取更多配置选项，但这些是基础知识

# javascript - 如何在当前鼠标悬停元素上显示/隐藏 div？

> ID：741993
> 
> 赞同：0
> 
> 时间：2009-04-12T16:20:04.283
> 
> 标签：javascript, jquery, html, dom

我想编写一个脚本，允许用户将鼠标悬停在页面上的任何元素“例如 a、img、div”上时，另一个隐藏元素将显示在当前元素上，并且其位置、宽度、高度和透明颜色。
如何使用 javascript/jquery 做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-12T16:33:05.627

首先将鼠标悬停事件附加到元素

```
$(function(){
    $("#myElementId").mouseOver(myMouseOverHandler);
}); 
```

然后写一个函数来处理事件

```
function myMouseOverHandler(e)
{
    var width = $(this).width();
    var height = $(this).height();
    var top = $(this).offset().top;
    var left = $(this).offset().left;

    // set the element with these parameters
    var el = $("#myHiddenElement");

    el.width(width);
    el.height(height);
    el.css({ "top":top, "left":left, "position":"absolute" });

    el.show();
} 
```

# c# - 如何在带有 Select 语句的存储过程上使用 LINQ？

> ID：741997
> 
> 赞同：0
> 
> 时间：2009-04-12T16:21:03.533
> 
> 标签：c#, linq-to-sql, stored-procedures, return-value, store

如何在带有`Select`语句的存储过程上使用 LINQ？

我知道如何使用存储过程为我执行一些过程，但是，如果我想从存储过程中返回一些数据？我怎么做？

问候

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-12T16:24:40.827

Scott Guthrie 有一篇关于此的[相当详细的博客文章](http://weblogs.asp.net/scottgu/archive/2007/08/16/linq-to-sql-part-6-retrieving-data-using-stored-procedures.aspx)。通常我相信你会调用一个存储过程作为一个单独的方法——如果你想将它包含在一个 select 子句中，你可能应该使用一个用户定义的函数 (UDF)。这些都包含在同一篇博客文章中。

如果您已经阅读过这篇文章并且没有帮助，您能否详细说明哪个部分不适合您？**************