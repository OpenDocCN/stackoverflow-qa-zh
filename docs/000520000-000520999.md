# StackOverflow 问答 000520000-000520999

# asp.net - 如何在 asp.net 中修改 Bind("MyValue")

> ID：520013
> 
> 赞同：2
> 
> 时间：2009-02-06T11:41:46.960
> 
> 标签：asp.net, gridview, timezone, linqdatasource

我对时间值和多个时区感到头疼。我以 UTC 时间存储新的 DateTime 值，但是当我尝试使用 LinqDataSource 和 GridView 修改它们时遇到问题。

我可以很容易地显示正确的时间

```
<ItemTemplate>
    <asp:Label ID="Label1" runat="server" Text='<%# TimeManager.ToLocalTime((DateTime)Eval("OrderDate")) %>' />
</ItemTemplate> 
```

目前，这将为存储在 DB 中的 UTC 时间增加 1 小时。

但是，绑定回源并不容易。Bind("OrderDate") 不能像 TimeManager.ToGlobalTime((DateTime)Bind("OrderDate")) 那样修改。

我正在考虑使用 LinqDataSource 的 OnUpdating 事件将值更新为全球时间，但是如果用户修改了其他字段而不是日期字段怎么办？他每次更新记录的时间值都会小一小时。

比较新旧值也不是很好，因为用户可以修改日期时间的日期部分而不是时间，这受时区的影响？

如果我有办法在 gridview 的所有状态中显示当地时间，那么我可以轻松地使用 LinqDataSource 的 OnUpdating。

请分享你的想法...

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-06T19:48:13.733

您是否考虑过对模型进行更改？假设您要绑定的对象的名称是 CustomerOrder。您可以将以下类添加到您的项目中（在与 Linq 对象相同的命名空间中）：

```
public partial class CustomerOrder
{
    public DateTime LocalOrderDate
    {
        get { return TimeManager.ToLocalTime(OrderDate); }
        set { OrderDate = TimeManager.ToUTCTime(value); }
    }
} 
```

现在不是绑定到 OrderDate，而是绑定到 LocalOrderDate。这将自动将 UTC/本地时间转换为 OrderDate。

（注意：我假设您正确定义了 TimeManager.ToLocalTime() 和 TimeManager.ToUTCTime()）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-06T11:56:04.110

我过去处理这类事情的方式也是在 EditItemTemplate 中使用 Eval。让用户在本地时间编辑项目。然后为 gridview 添加 OnItemUpdating 处理程序并添加提取关联文本框的值，将其转换为全局时间，并将其添加到新的值字典中。将（全球时间）中的原始值绑定到同一模板中的隐藏字段，这将使用正确的旧时间填充旧值字典。尽管您显然不需要旧值（因为没有旧值），但您会希望在 OnItemInserting 中插入时执行相同的操作。

**编辑**：通常我在DetailsView而不是GridView上进行更新，因此是ItemUpdating/Inserting而不是RowUpdating/Inserting。下面的示例代码——此示例使用一对下拉列表，允许用户指定位置（选择建筑物和建筑物中的位置，但它实际上只映射数据库中的位置）。在后端，它将初始值分配给 OnPreRender 中的下拉列表（未显示），并从 ItemUpdating/Inserting 上的位置下拉列表中提取 LocationID 数据库字段值（显示更新）。DetailsView 包装在 UpdatePanel 中，并且在建筑物下拉选择更改时完成 Location 下拉列表的填充。请注意，由于我正在更新项目（无论如何都会导致更新声明），所以我不会

```
<asp:TemplateField HeaderText="Location:" SortExpression="LocationId">
    <EditItemTemplate>
        <asp:DropDownList runat="server" ID="buildingDropDownList"
                          DataSourceID="buildingDataSource"
                          DataTextField="name"
                          DataValueField="abbreviation"
                          OnSelectedIndexChanged=
                             "buildingDropDownList_SelectedIndexChanged"
                          AutoPostBack="true" />
        <asp:DropDownList runat="server" ID="locationDropDownList"
                          DataSourceID="locationsDataSource"
                          DataTextField="Name"
                          DataValueField="ID">
        </asp:DropDownList>
    </EditItemTemplate>
    <InsertItemTemplate>
        <asp:DropDownList runat="server" ID="buildingDropDownList"
                          DataSourceID="buildingDataSource"
                          DataTextField="name"
                          DataValueField="abbreviation"
                          OnSelectedIndexChanged=
                              "buildingDropDownList_SelectedIndexChanged"
                          AutoPostBack="true"
                          AppendDataBoundItems="true">
            <asp:ListItem Text="Select Building" Value="" />
        </asp:DropDownList>
        <asp:DropDownList runat="server" ID="locationDropDownList"
                          DataSourceID="locationsDataSource"
                          DataTextField="Name"
                          DataValueField="ID"
                          AppendDataBoundItems="true">
            <asp:ListItem Text="Not installed" Value="" />
        </asp:DropDownList>
    </InsertItemTemplate>
    <ItemTemplate>
        <asp:Label ID="locationLabel" runat="server"\
                    Text='<%# Eval("LocationID") == null
                                  ? ""
                                  : Eval("Location.Name") %>'>
        </asp:Label>
    </ItemTemplate>
</asp:TemplateField> 
```

代码隐藏：

```
void editPrinterDetailsView_ItemUpdating( object sender,
                                          DetailsViewUpdateEventArgs e )
{
    // Use a helper method to find the dropdown inside the details view
    // and get the selected value.
    string locationID = ControlHelper
                          .GetDropDownValue( editPrinterDetailsView,
                                             "locationDropDownList" );
    if (locationID == string.Empty)
    {
        locationID = null;
    }
    if (e.NewValues.Contains( "LocationID" ))
    {
        e.NewValues["LocationID"] = locationID;
    }
    else
    {
        e.NewValues.Add( "LocationID", locationID );
    }
    e.OldValues["LocationID"] = -1;
} 
```

# python - 用于部署 Python 应用程序的跨平台 gui 工具包

> ID：520015
> 
> 赞同：50
> 
> 时间：2009-02-06T11:43:30.000
> 
> 标签：python, user-interface, cross-platform

建立在： [http ://www.reddit.com/r/Python/comments/7v5ra/whats_your_favorite_gui_toolkit_and_why/](http://www.reddit.com/r/Python/comments/7v5ra/whats_your_favorite_gui_toolkit_and_why/)

# 优点：

1 - 易于设计/集成 - 学习曲线

2 - *nix、Windows、Mac 的支持/可用性，本地 l&f 的额外积分，支持移动或网络

3 - pythonic API

4 - 文档质量 - 我想做一些更复杂的事情，现在怎么办？

5 - 轻量级包装，因此不需要包含完整的安装程序（py2exe、py2app 理想情况下可以按原样工作，并且不会生成大量 MB 文件）

6 - 许可

7 - 其他人？（指定）

* * *

# 竞争者：

1 - tkinter，目前支持（从 2.6、3.0 开始）

2 - pyttk 库

3 - pyGTK

4 - pyQt

5 - wxPython

6 - 通过基于 Python 的框架（Django、Turbogears、web.py、Pylons...）或粘贴的 HTML-CGI

7 - 其他人？（指定）

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2009-02-06T12:06:10.390

请不要犹豫，扩大这个答案。

# [特金特](http://wiki.python.org/moin/TkInter)

Tkinter 是 python 自带的工具包。这意味着您已经拥有编写 GUI 所需的一切。这也意味着，如果您选择分发您的程序，很可能其他所有人都已经拥有运行您的程序所需的东西。

Tkinter 成熟且稳定，并且（至少可以说）非常易于使用。我发现它比 wxPython 更易于使用，但显然这有点主观。

Tkinter 因长相丑陋和过时而受到诟病。虽然使用 Tkinter 创建丑陋的 GUI 确实很容易，但创建漂亮的 GUI 也很容易。Tkinter 不会牵你的手，但也不会妨碍你。Tkinter 在 Mac 和 Windows 上看起来最好，因为它在那里使用本地小部件，但在 linux 上看起来也不错。

关于 Tkinter 外观的另一点是，在大多数情况下，外观并不像人们想象的那么重要。大多数使用 Tkinter、wxPython、PyQT 等工具包编写的应用程序都是专用应用程序。对于这些工具包用于的应用程序类型，可用性胜过外观。如果应用程序的外观很重要，那么完善 Tkinter 应用程序就很容易了。

Tkinter 具有其他工具包无法比拟的一些功能。变量跟踪、命名字体、几何（布局）管理器以及 Tkinter 处理事件的方式仍然是评判其他工具包的标准。

不利的一面是，Tkinter 是在 python 中运行的 Tcl 解释器的包装器。这对于使用 Tkinter 开发的任何人来说几乎是不可见的，但它有时会导致错误消息暴露此架构。您将收到一个错误，抱怨名称为“.1245485.67345”的小部件，除非您也熟悉 Tcl/tk 的工作原理，否则这对任何人来说几乎没有意义。

另一个缺点是 Tkinter 没有 wxPython 那么多的预构建小部件。例如，Tkinter 中的分层树小部件有点弱，并且没有内置的表格小部件。另一方面，Tkinter 的画布和文本小部件非常强大且易于使用。但是，对于您将编写的大多数类型的应用程序，您将拥有所需的一切。只是不要指望用 Tkinter 复制 Microsoft Word 或 Photoshop。

我不知道 Tkinter 的许可证是什么，我假设与整个 python 相同。Tcl/tk 有一个 BSD 风格的许可证。

# [PyQt](http://www.riverbankcomputing.co.uk/software/pyqt/intro)

它建立在C++ 框架[Qt](http://qt.nokia.com/)之上。它非常先进，并且有一些很好的工具，比如 Qt Designer 来设计你的应用程序。不过你应该知道，它感觉不像是 Python 100%，而是接近它。文档[非常](http://doc.qt.nokia.com/4.5/index.html)好

这个框架真的很好。它由诺基亚拥有的奇趣科技积极开发。Python 的绑定由 Riverbank 开发。

PyQt 在 GPL 许可或商业许可下可用。河岸 PyQt 许可证的价格约为每位开发商 400 欧元。

Qt 不仅是一个 GUI 框架，而且还有许多其他类，只需使用 Qt 类就可以创建应用程序。（如 SQL、网络、脚本……）

Qt 曾经在每个平台上模拟 GUI 元素，但现在使用平台的本机样式（尽管不是本机 GUI 工具包）：请参阅[Mac OS X](http://doc.qt.nokia.com/4.4/qtmac-as-native.html)和[windows XP 样式的文档](http://doc.qt.nokia.com/4.5/qwindowsxpstyle.html#details)

打包就像运行 py2exe 或 pyInstaller 一样简单。我的 PyQt 应用程序的内容在 Windows 上看起来像这样（我在它上面使用了 InnoSetup 以进行正确安装）：

```
pyticroque.exe PyQt4.QtGui.pyd unicodedata.pyd
MSVCP71.dll PyQt4._qt.pyd unins000.dat
MSVCR71.dll python25.dll unins000.exe
PyQt4.QtCore.pyd sip.pyd _socket.pyd

```

QT 带有一个小部件设计器，甚至在最近的版本中还带有一个[IDE](http://qt.nokia.com/products/developer-tools)来帮助设计 Qt 软件。

# [PySide](http://pyside.org)

PySide 是与 Qt 的 LGPL 绑定。它是由诺基亚开发的，作为 GPL PyQt 的替代品。

> 尽管基于与现有 GPL 许可的 PyQt 绑定不同的技术，PySide 最初的目标是与它们兼容 API。除了兼容 PyQt 的 API，未来还会提供更多 Pythonic 的 API。

# [wxPython](http://www.wxpython.org/)

wxPython 是使用[wxWidgets](http://www.wxwidgets.org/) -Framework 的 Python 绑定。该框架在 LGPL 许可下，由开源社区开发。

我真正缺少的是设计界面的好工具，它们大约有 3 个，但没有一个可用。

我应该提到的一件事是，尽管我没有使用任何先进的东西，但我在选项卡视图中发现了一个错误。（仅在 Mac OS X 上）我认为[wxWidgets](http://www.wxwidgets.org/)不如[Qt](http://qt.nokia.com/)优美。

wxPython 实际上只是关于 GUI 类，没有太多其他内容。

wxWidgets 使用原生 GUI 元素。

wxPython 相对于 Tkinter 的一个优势是 wxPython 有一个更大的小部件库可供选择。

# 其他

我对其他 GUI 框架没有任何经验，也许其他人有。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-19T09:01:32.230

我只是在权衡说 TKinter 很烂。可悲的是，由于向后兼容性，它似乎与 Python 打包在一起。

文档很糟糕。看起来很可怕。我遇到了一些奇怪的错误，这些错误实际上会使 Python 崩溃。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-19T08:55:42.333

[杰通](http://www.jython.org/Project/)。

> Jython 是用 100% 纯 Java 编写的高级、动态、面向对象的 Python 语言的实现，并与 Java 平台无缝集成。因此，它允许您在任何 Java 平台上运行 Python。

您可以使用 Swing、Applet 或其他适用于 Java 平台的 GUI 框架。请参阅[图形用户界面](http://java.sun.com/docs/books/tutorial/ui/index.html)和[2D 图形](http://java.sun.com/docs/books/tutorial/2d/index.html)的[Java 教程](http://java.sun.com/docs/books/tutorial/)。有很多书籍和[文档](http://java.sun.com/javase/6/docs/)，例如[API 参考](http://java.sun.com/javase/6/docs/api/index.html)。

[这是来自An Introduction to Jython](http://www.javalobby.org/articles/jython/)的 Hello world Swing 应用程序。

```
from javax.swing import *

frame = JFrame("Hello Jython")
label = JLabel("Hello Jython!", JLabel.CENTER)
frame.add(label)
frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE)
frame.setSize(300, 300)
frame.show() 
```

这是 Todd Ditchendorf 的 Jython[小程序，它演示了多线程粒子绘制](http://replay.waybackmachine.org/20080724075253/http://www.ditchnet.org/wp/2005/05/10/mulit-threaded-jython-applet/)（60 行）。

```
from __future__ import nested_scopes
import java.lang as lang
import java.util as util
import java.awt as awt
import javax.swing as swing

class Particle:

    def __init__(self,initX,initY):
    self.x = initX
    self.y = initY
    self.rng = util.Random()

    def move(self):
    self.x += self.rng.nextInt(10) - 5
    self.y += self.rng.nextInt(20) - 10

    def draw(self,g2):
    g2.drawRect(self.x,self.y,10,10)

class ParticleCanvas(awt.Canvas):

    def __init__(self,newSize):
    awt.Canvas.__init__(self,size=(newSize,newSize))

    def paint(self,g2):
    for p in self.particles:
        p.draw(g2)

class ParticleApplet(swing.JApplet):

    def init(self):
    self.canvas = ParticleCanvas(self.getWidth())
    self.contentPane.add(self.canvas)

    def start(self):
    n = 10
    particles = []
    for i in range(n):
        particles.append(Particle(150,150))
    self.canvas.particles = particles

    self.threads = []
    for i in range(n):
        self.threads.append(self.makeThread(particles[i]))
        self.threads[i].start()

    def makeThread(self,p):

    class MyRunnable(lang.Runnable):
        def run(this):
        try:
            while 1:
            p.move()
            self.canvas.repaint()
            lang.Thread.sleep(100)
        except lang.InterruptedException:
            return

    return lang.Thread(MyRunnable()) 
```

如果你只是对画线和圆感兴趣，你可以把它减半。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-29T06:03:47.267

如果有人知道比通常讨论的更好的东西，我肯定会很感激；我看到头痛找到合适的东西......

Qt 很棒，但 PyQt 似乎没有相同的开发资源。它似乎有一些巧妙的方法来生成绑定，但并不完整（例如 PyKDE 终端 kpart）并且缺乏文档（正如开发人员承认的那样）。与 Qt 的 UI 设计器的兼容性很好。

wxpython - 控件没有那么好看，小部件库没有 KDE 大。

OpenGL - 默认情况下甚至不支持字体... pygame 还可以，但是 opengl 作为状态机太烦人了（面向对象的模型防止在错误状态下进行调用）。

XUL - 好主意，我希望它能奏效。不过，[pyxulrunner](http://pyxpcomext.mozdev.org/no_wrap/tutorials/pyxulrunner/python_xulrunner_about.html)教程对我不起作用——首先我必须将 xulrunner /usr/lib 路径添加到 LD_LIBRARY_PATH，然后它仍然遇到“来自 xpcom 导入组件”的问题......

我对 ui 库的愿望清单是

*   Python 集成（即使用像 unicode 这样的内置函数，像线程这样的模块，以及像闭包这样的语言特性）
*   良好的中间表示（像 XUL 而不是生成数百行看起来像“listbox91.addChild(label28)”）
*   *简单的*多线程支持（自动锁或事件发布，例如 elt.setText 可以从任何线程调用；让设计人员在必要时使用 Python 锁管理锁定）
*   以用户为中心的特性——一系列 UI 事件的脚本、键绑定任何东西的能力（KDE 有 dcop，但 UI 库不会自动完成 afaik 绑定）和拦截事件。
*   一个大型的、易于贡献的标准库的潜力。
*   文档，但如果图书馆设计得很好并产生了足够的兴趣，这将是一个给定的。

根据我的经验，html 比 UI 库更容易获得好看的东西。

**编辑**- 在使用 PyQt 4 一段时间后，它完成了简单 UI 的工作。我目前不是为最终用户开发，所以看起来并不重要。QTextBrowser 对于显示基本的 HTML 表格和生成 HTML 链接非常有用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-06T16:21:04.213

专业的 wxPython

*   很多教程
*   wxGlade 作为编辑器：还不完美，但可以使用。

# jquery - 在 jQuery 事件中控制“this”的值

> ID：520019
> 
> 赞同：74
> 
> 时间：2009-02-06T11:46:43.957
> 
> 标签：jquery, scope, this

我使用 jQuery 创建了一个“控件”，并使用 jQuery.extend 来帮助使其尽可能地面向对象。

在我的控件初始化期间，我连接了各种点击事件，如下所示

```
jQuery('#available input', 
            this.controlDiv).bind('click', this, this.availableCategoryClick); 
```

请注意，我将“this”作为绑定方法中的数据参数。我这样做是为了获取附加到控件实例的数据，而不是从触发点击事件的元素中获取数据。

这很好用，但是我怀疑有更好的方法

在过去使用过 Prototype 之后，我记得一种绑定语法，它允许您控制事件中 'this' 的值。

什么是jQuery方式？

* * *

## 回答 #1

> 赞同：104
> 
> 时间：2011-04-20T07:53:54.867

您可以使用[`jQuery.proxy()`](http://api.jquery.com/jQuery.proxy/)匿名函数，只是有点尴尬，'context' 是第二个参数。

```
 $("#button").click($.proxy(function () {
     //use original 'this'
 },this)); 
```

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-12-30T22:50:23.910

我喜欢你的方式，实际上使用了类似的结构：

```
$('#available_input').bind('click', {self:this}, this.onClick); 
```

和 this.onClick 的第一行：

```
var self = event.data.self; 
```

我喜欢这种方式，因为这样您就可以同时单击元素（作为 this）和作为 self 的“this”对象，而无需使用闭包。

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2011-02-14T11:32:46.110

jQuery 有这个[`jQuery.proxy`](http://api.jquery.com/jQuery.proxy/)方法（从 1.4 开始可用）。

例子：

```
var Foo = {
  name: "foo",

  test: function() {
    alert(this.name)
  }
}

$("#test").click($.proxy(Foo.test, Foo))
// "foo" alerted 
```

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2009-02-06T13:59:10.600

我不认为 jQuery 有一个内置的功能。但是您可以使用如下的辅助构造：

```
Function.prototype.createDelegate = function(scope) {
    var fn = this;
    return function() {
        // Forward to the original function using 'scope' as 'this'.
        return fn.apply(scope, arguments);
    }
}

// Then:
$(...).bind(..., obj.method.createDelegate(obj)); 
```

这样，您可以使用 createDelegate() 创建动态的“包装函数”，以给定对象作为其“this”范围调用该方法。

例子：

```
function foo() {
    alert(this);
}

var myfoo = foo.createDelegate("foobar");
myfoo(); // calls foo() with this = "foobar" 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2014-04-24T18:24:32.757

兼容 HTML 5 的浏览器提供了一种[bind 方法](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind)，`Function.prototype`它可能是最简洁的语法并且不依赖于框架，尽管它直到 IE 9 才内置到 IE 中。（不过，对于没有它的浏览器，有一个[polyfill](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind#Polyfill)。）

根据您的示例，您可以像这样使用它：

```
jQuery('#available input', 
        this.controlDiv).bind('click', this.availableCategoryClick.bind(this)); 
```

（旁注：`bind`此语句中的第一个是 jQuery 的一部分，与 jQuery 无关`Function.prototype.bind`）

或者使用更简洁和最新的jQuery（并消除两种不同类型的混淆`bind`）：

```
$('#available input', this.controlDiv).click(this.availableCategoryClick.bind(this)); 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2013-03-08T19:20:27.840

您可以像这样使用 javascript[绑定](https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Function/bind)方法：

```
var coolFunction = function(){
  // here whatever involving this
     alert(this.coolValue);
}

var object = {coolValue: "bla"};

$("#bla").bind('click', coolFunction.bind(object)); 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-06T14:16:13.170

jQuery 不支持绑定，首选方法是使用函数。

因为在 Javascript 中，this.availableCategoryClick 并不意味着在此对象上调用 availableCategoryClick 函数，所以 jQuery 建议使用以下首选语法：

```
var self = this;
jQuery('#available input', self.controlDiv).bind('click', function(event)
{
   self.availableCategoryClick(event);
}); 
```

Javascript 中的 OO 概念很难理解，函数式编程通常更容易且更具可读性。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-06T14:38:03.690

看到函数改变范围，最常见的方法是手动完成，例如`var self = this`.

```
var self = this

$('.some_selector').each(function(){
  // refer to 'self' here
} 
```

# dql - DQL 返回文件柜中的文件

> ID：520020
> 
> 赞同：0
> 
> 时间：2009-02-06T11:47:38.197
> 
> 标签：dql, documentum

使用 DQL 我想返回 Cabinet*测试*下的所有文档。我将如何编写查询来执行此操作？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-06T12:12:02.250

```
select r_object_id, object_name from dm_document(all) where folder('/NameOfCabinet', descend); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-03-02T17:56:03.067

select * from dm_document where folder('/NameOfCabinet', descend); 它只会返回所有文档的当前版本，而不是所有版本。

查看所有版本。

select * from dm_document(all) where folder('/NameOfCabinet', descend);

# c# - 为什么没有 Linq 方法通过谓词返回不同的值？

> ID：520030
> 
> 赞同：51
> 
> 时间：2009-02-06T11:51:53.150
> 
> 标签：c#, linq, distinct

我想获取列表中的不同值，但不是通过标准相等比较。

我想做的是这样的：

```
return myList.Distinct( (x, y) => x.Url == y.Url ); 
```

我不能，Linq 中没有扩展方法可以做到这一点 - 只有一个需要`IEqualityComparer`.

我可以用这个破解它：

```
return myList.GroupBy( x => x.Url ).Select( g => g.First() ); 
```

但这似乎很混乱。它也不完全做同样的事情——我只能在这里使用它，因为我只有一个键。

我也可以添加我自己的：

```
public static IEnumerable<T> Distinct<T>( 
    this IEnumerable<T> input, Func<T,T,bool> compare )
{
    //write my own here
} 
```

但这似乎更像是在写一些本来就应该存在的东西。

有人知道为什么没有这种方法吗？

我错过了什么吗？

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2009-02-06T12:00:34.927

这很烦人，当然。它也是我的“MoreLINQ”项目的一部分，在某些时候我必须注意 :) 有很多其他操作在对投影进行操作时是有意义的，但要返回原始的 MaxBy 和 MinBy 会浮现在脑海中。

正如您所说，它很容易编写 - 尽管我更喜欢名称“DistinctBy”来匹配 OrderBy 等。如果您有兴趣，这是我的实现：

```
 public static IEnumerable<TSource> DistinctBy<TSource, TKey>
        (this IEnumerable<TSource> source,
         Func<TSource, TKey> keySelector)
    {
        return source.DistinctBy(keySelector,
                                 EqualityComparer<TKey>.Default);
    }

    public static IEnumerable<TSource> DistinctBy<TSource, TKey>
        (this IEnumerable<TSource> source,
         Func<TSource, TKey> keySelector,
         IEqualityComparer<TKey> comparer)
    {
        if (source == null)
        {
            throw new ArgumentNullException("source");
        }
        if (keySelector == null)
        {
            throw new ArgumentNullException("keySelector");
        }
        if (comparer == null)
        {
            throw new ArgumentNullException("comparer");
        }
        return DistinctByImpl(source, keySelector, comparer);
    }

    private static IEnumerable<TSource> DistinctByImpl<TSource, TKey>
        (IEnumerable<TSource> source,
         Func<TSource, TKey> keySelector,
         IEqualityComparer<TKey> comparer)
    {
        HashSet<TKey> knownKeys = new HashSet<TKey>(comparer);
        foreach (TSource element in source)
        {
            if (knownKeys.Add(keySelector(element)))
            {
                yield return element;
            }
        }
    } 
```

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2009-02-06T13:38:56.087

> 但这似乎很混乱。

这不是乱七八糟，是正确的。

*   如果你想要`Distinct`Programmers by FirstName 并且有四个 Amy，你想要哪一个？
*   如果你`Group`的程序员 By FirstName 并拿了`First`一个，那么在四个 Amy 的情况下你想做什么就很清楚了。

> 我只能在这里使用它，因为我只有一个键。

您可以使用相同的模式执行多个键“不同”：

```
return myList
  .GroupBy( x => new { x.Url, x.Age } )
  .Select( g => g.First() ); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-10-08T18:29:26.863

乔恩，你的解决方案非常好。一个小小的变化。我认为我们不需要 EqualityComparer.Default 。这是我的解决方案（当然起点是 Jon Skeet 的解决方案）

```
 public static IEnumerable<T> DistinctBy<T, TKey>(this IEnumerable<T> source, Func<T, TKey> keySelector)
    {
        //TODO All arg checks
        HashSet<TKey> keys = new HashSet<TKey>();
        foreach (T item in source)
        {
            TKey key = keySelector(item);
            if (!keys.Contains(key))
            {
                keys.Add(key);
                yield return item;
            }
        }
    } 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-09-01T08:02:13.713

使用 AmyB 的[答案](https://stackoverflow.com/a/520315/1835379)，我编写了一个小的`DistinctBy`扩展方法，以允许传递谓词：

```
/// <summary>
/// Distinct method that accepts a perdicate
/// </summary>
/// <typeparam name="TSource">The type of the t source.</typeparam>
/// <typeparam name="TKey">The type of the t key.</typeparam>
/// <param name="source">The source.</param>
/// <param name="predicate">The predicate.</param>
/// <returns>IEnumerable&lt;TSource&gt;.</returns>
/// <exception cref="System.ArgumentNullException">source</exception>
public static IEnumerable<TSource> DistinctBy<TSource, TKey>
    (this IEnumerable<TSource> source,
     Func<TSource, TKey> predicate)
{
    if (source == null)
        throw new ArgumentNullException("source");

    return source
        .GroupBy(predicate)
        .Select(x => x.First());
} 
```

您现在可以传递谓词以通过以下方式对列表进行分组：

```
var distinct = myList.DistinctBy(x => x.Id); 
```

或按多个属性分组：

```
var distinct = myList.DistinctBy(x => new { x.Id, x.Title }); 
```

# python - 使用 Python 从字符串中提取 URL 的最简洁方法是什么？

> ID：520031
> 
> 赞同：26
> 
> 时间：2009-02-06T11:51:57.113
> 
> 标签：python, regex, url

尽管我知道我可以使用一些巨大的正则表达式，例如[此处](http://geekswithblogs.net/casualjim/archive/2005/12/01/61722.aspx)发布的那个，但我想知道是否有一些微调的方法可以使用标准模块或第三方附加组件来做到这一点？

简单的问题，但在 Google（或 Stackoverflow）上没有跳出任何内容。

期待看到你们如何做到这一点！

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2015-02-17T00:20:26.813

我知道这正是您不想要的，但这是一个包含大量正则表达式的文件：

```
#!/usr/bin/python
# -*- coding: utf-8 -*-
"""
the web url matching regex used by markdown
http://daringfireball.net/2010/07/improved_regex_for_matching_urls
https://gist.github.com/gruber/8891611
"""
URL_REGEX = r"""(?i)\b((?:https?:(?:/{1,3}|[a-z0-9%])|[a-z0-9.\-]+[.](?:com|net|org|edu|gov|mil|aero|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|post|pro|tel|travel|xxx|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|Ja|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw)/)(?:[^\s()<>{}\[\]]+|\([^\s()]*?\([^\s()]+\)[^\s()]*?\)|\([^\s]+?\))+(?:\([^\s()]*?\([^\s()]+\)[^\s()]*?\)|\([^\s]+?\)|[^\s`!()\[\]{};:\'\".,<>?«»“”‘’])|(?:(?<!@)[a-z0-9]+(?:[.\-][a-z0-9]+)*[.](?:com|net|org|edu|gov|mil|aero|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|post|pro|tel|travel|xxx|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|Ja|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw)\b/?(?!@)))""" 
```

我调用该文件`urlmarker.py`，当我需要它时，我只需导入它，例如。

```
import urlmarker
import re
re.findall(urlmarker.URL_REGEX,'some text news.yahoo.com more text') 
```

参看。[http://daringfireball.net/2010/07/improved_regex_for_matching_urls](http://daringfireball.net/2010/07/improved_regex_for_matching_urls)

此外，这里是 Django (1.6) 用来验证`URLField`s 的内容：

```
regex = re.compile(
    r'^(?:http|ftp)s?://'  # http:// or https://
    r'(?:(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\.)+(?:[A-Z]{2,6}\.?|[A-Z0-9-]{2,}\.?)|'  # domain...
    r'localhost|'  # localhost...
    r'\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}|'  # ...or ipv4
    r'\[?[A-F0-9]*:[A-F0-9:]+\]?)'  # ...or ipv6
    r'(?::\d+)?'  # optional port
    r'(?:/?|[/?]\S+)$', re.IGNORECASE) 
```

参看。[https://github.com/django/django/blob/1.6/django/core/validators.py#L43-50](https://github.com/django/django/blob/1.6/django/core/validators.py#L43-50)

Django 1.9 将该逻辑拆分为几个类

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2015-05-23T02:08:49.497

## 对 13 种不同的正则表达式方法进行了出色的比较

...可以在此页面上找到：[**In search of the perfect URL validation regex**](https://mathiasbynens.be/demo/url-regex)。

通过了所有测试的 Diego Perini 正则表达式**很**长，但可以在他的 gist 中[找到](https://gist.github.com/dperini/729294)。
请注意，您必须将他的 PHP 版本转换为 python 正则表达式（略有不同）。

我最终使用了[Imme Emosol](https://gist.github.com/731338/810d83626a6d79f40a251f250ed4625cac0e731f)版本，它通过了绝大多数测试，并且是 Diego Perini 的一小部分。

这是 Imme Emosol 正则表达式的 python 兼容版本：

```
r'^(?:(?:https?|ftp)://)(?:\S+(?::\S*)?@)?(?:(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:/[^\s]*)?$' 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-12-06T17:03:32.290

在这里查看 Django 的方法：[`django.utils.urlize()`](https://github.com/django/django/blob/98c5370ef673bc83deaf24c197e0bb22a75071e3/django/utils/html.py#L257). 正则表达式对于这项工作来说太有限了，您必须使用启发式方法来获得大部分正确的结果。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2012-12-27T12:59:34.333

你可以使用我写的这个库：

[https://github.com/imranghory/urlextractor](https://github.com/imranghory/urlextractor)

它非常 hacky，但它不像许多其他技术那样依赖“http://”，而是使用 Mozilla TLD 列表（通过 tldextract 库）来搜索 TLD（即“.co.uk”、“. com”等），然后尝试围绕 TLD 构建 url。

它的目标不是要符合 RFC，而是要准确地说明 url 在现实世界中的实际使用方式。因此，例如，它将拒绝技术上有效的域“com”（您实际上可以将 TLD 用作域；尽管在实践中很少见），并且会从 url 中去除跟踪句号或逗号。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-02-06T12:06:16.087

如果您知道字符串中的空格后面有一个 URL，您可以执行以下操作：

s 是包含 url 的字符串

```
>>> t = s[s.find("http://"):]
>>> t = t[:t.find(" ")] 
```

否则你需要检查 find 是否返回 -1 。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-06T12:12:58.927

您可以使用[BeautifulSoup](http://www.crummy.com/software/BeautifulSoup/)。

```
def extractlinks(html):
    soup = BeautifulSoup(html)
    anchors = soup.findAll('a')
    links = []
    for a in anchors:
        links.append(a['href'])
    return links 
```

请注意，使用正则表达式的解决方案更快，尽管不会那么准确。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2016-11-16T18:39:51.623

我参加聚会迟到了，但这是来自#python on freenode 的某人向我建议的解决方案。它避免了正则表达式的麻烦。

```
from urlparse import urlparse

def extract_urls(text):
    """Return a list of urls from a text string."""
    out = []
    for word in text.split(' '):
        thing = urlparse(word.strip())
        if thing.scheme:
            out.append(word)
    return out 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-07-05T21:50:30.047

还有另一种方法可以轻松地从文本中提取 URL。您可以使用 urlextract 为您完成，只需通过 pip 安装即可：

```
pip install urlextract 
```

然后你可以像这样使用它：

```
from urlextract import URLExtract

extractor = URLExtract()
urls = extractor.find_urls("Let's have URL stackoverflow.com as an example.")
print(urls) # prints: ['stackoverflow.com'] 
```

您可以在我的 github 页面上找到更多信息：[https ://github.com/lipoja/URLExtract](https://github.com/lipoja/URLExtract)

注意：它会从 iana.org 下载 TLD 列表，让您随时了解最新信息。但是，如果该程序没有互联网访问权限，那么它不适合您。

*这种方法与 urlextractor（上面提到的）类似，但我的代码是最新的、维护的，我愿意接受任何建议（新功能）。*

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2017-05-01T21:19:08.567

```
import re
text = '<p>Please click <a href="http://www.dr-chuck.com">here</a></p>'
aa=re.findall('href="(.+)"',text)
print(aa) 
```

# ocaml - OCaml 中的查找表

> ID：520033
> 
> 赞同：5
> 
> 时间：2009-02-06T11:52:54.023
> 
> 标签：ocaml, lookup

我想在 OCaml 中创建一个查找表。该表将有 7000 多个条目，在查找时（通过 int）返回一个字符串。用于此任务的适当数据结构是什么？表是否应该从基本代码中外部化，如果是这样，如何“包括”查找表以便从他/她的程序中访问？

谢谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-06T15:23:12.520

如果字符串使用连续整数寻址，则可以使用数组。

否则，您可以使用哈希表（非功能性）或 Map（功能性）。要开始使用地图，请尝试：

```
module Int =
struct
  type t = int
  let compare = compare
end ;;

module IntMap = Map.Make(Int) ;; 
```

如果表太大而无法存储在内存中，您可以将其存储在外部数据库中并使用绑定到[dbm](http://caml.inria.fr/pub/docs/manual-ocaml/libref/Dbm.html)、 bdb 、[sqlite](http://www.ocaml.info/home/ocaml_sources.html#toc13) ......

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-06T14:59:15.160

```
let table : (int,string) Hashtbl.t = Hashtbl.create 8192 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-09T12:14:47.233

要将表存储在单独的文件中（例如作为数组），只需创建一个`strings.ml`包含内容的文件：

```
let tbl = [|
    "String 0";
    "String 1";
    "String 2";
    ...7000 more...
|] 
```

编译：

```
ocamlc -c strings.ml 
```

如[手册](http://caml.inria.fr/pub/docs/manual-ocaml/manual004.html#toc17)中所述，这定义了`Strings`其他 Ocaml 模块可以引用的模块。例如，您可以启动一个顶层：

```
ocaml strings.cmo 
```

并通过访问数组中的特定位置来查找字符串：

```
Strings.tbl.(1234) ;; 
```

# c++ - 为什么你不能超载'。' C++ 中的运算符？

> ID：520035
> 
> 赞同：80
> 
> 时间：2009-02-06T11:54:02.273
> 
> 标签：c++, operator-overloading

能够重载 . C++ 中的运算符并返回对对象的引用。

你可以超载`operator->`，`operator*`但不能`operator.`

这有技术原因吗？

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-02-06T12:07:03.480

请参阅[Bjarne Stroustrup 的这句话](http://www.stroustrup.com/bs_faq2.html#overload-dot)：

> 操作员 。(dot) 原则上可以使用与 -> 相同的技术进行重载。但是，这样做可能会导致有关操作是否适用于对象重载的问题。或 引用的对象。例如：
> 
> ```
> class Y {
> public:
>     void f();
>     // ...
> };
> 
> class X {    // assume that you can overload .
>     Y* p;
>     Y& operator.() { return *p; }
>     void f();
>     // ...
> };
> 
> void g(X& x)
> {
>     x.f();    // X::f or Y::f or error?
> } 
> ```
> 
> 这个问题可以通过多种方式解决。在标准化时，尚不清楚哪种方式最好。有关更多详细信息，请参阅[C++ 的设计和演变](http://www.stroustrup.com/dne.html)。

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2009-02-06T12:09:55.703

Stroustrup 说 C++ 应该是一种可扩展的，但不是可变的语言。

点（属性访问）操作符被认为太接近语言的核心而不允许重载。

请参阅[C++ 的设计和演变](http://www.google.com/search?q=The+Design+and+Evolution+of+C%2B%2B)，第 242 页，第*11.5.2 节智能参考*。

> 当我决定允许 operator 重载时`->`，我自然会考虑 operator`.`是否可以类似地重载。
> 
> 当时，我认为以下论点是决定性的：如果`obj`是类对象，那么对于该对象类`obj.m`的每个成员都有意义`m`。我们尽量不通过重新定义内置操作来使语言可变（尽管`=`出于迫切需要和 unary违反了该规则`&`）。
> 
> `.`如果我们允许一个类的重载`X`，我们将无法`X`通过正常方式访问成员；我们将不得不使用指针 and `->`，但`->`and`&`也可能已被重新定义。我想要一种可扩展的语言，而不是可变的。
> 
> 这些论点是有分量的，但不是结论性的。特别是在 1990 年，Jim Adcock 提议允许 operator的重载与 operator`.` *完全*`->`一样。

这句话中的“我”是 Bjarne Stroustrup。你不能比这更有权威。

如果你想真正理解 C++（如“为什么会这样”），你绝对应该阅读这本书。

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2009-02-06T12:07:03.090

Stroustrup [对这个问题有一个答案](http://www.stroustrup.com/bs_faq2.html#overload-dot)：

> 操作员 。(dot) 原则上可以使用与 -> 相同的技术进行重载。但是，这样做可能会导致有关操作是否适用于对象重载的问题。或 引用的对象。例如：
> 
> ```
> class Y {
> public:
>     void f();
>     // ...
> };
> class X {   // assume that you can overload .
>     Y* p;
>     Y& operator.() { return *p; }
>     void f();
>     // ...
> };
> void g(X& x)
> {
>     x.f();  // X::f or Y::f or error?
> } 
> ```
> 
> 这个问题可以通过多种方式解决。在标准化时，尚不清楚哪种方式最好。有关详细信息，请参阅[D&E](http://www.stroustrup.com/dne.html)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-08-26T09:25:22.660

很容易理解，如果你通过操作符函数调用的内部机制，说一个类复合体可以有两个成员 r 代表实部，i 代表虚部。Say **Complex C1(10,20),C2(10,2)** // 我们假设类中已经有一个两个参数的构造函数。现在，如果您将**C1+C2**编写为语句，那么编译器会尝试在复数上查找 + 运算符的重载版本。现在我们假设我重载了 + 运算符，所以 **C1+C2**内部翻译为**c1.operator+(c2)** 现在暂时假设你可以重载 '.' 操作员。所以现在考虑以下调用**C1.disp()** //显示复杂对象的内容 现在尝试表示为内部表示 **C1.operator.(--------)**，创建了完全混乱的东西。这就是我们不能超载'.'的原因。操作员

# java - Spring中的Oracle连接

> ID：520041
> 
> 赞同：2
> 
> 时间：2009-02-06T11:56:41.097
> 
> 标签：java, oracle, spring, connection-string

我正在使用 Oracle 9 JDBC Thin Driver - 我用于标准 JDBC 的连接字符串是：

```
jdbcConn.connect("jdbc:oracle:thin:myDevDb/myDevDb@fooServer:1521:MYSIDNAME"); 
```

...只是试图让我在 Spring 2.5 中使用这种连接。

您如何将 Spring 连接到 Oracle 连接 - 认为它与 XML 配置文件有关，但不确定，似乎有几种方法可以做到这一点。

非常感谢任何帮助...

**最新编辑**

*感谢那些迄今为止做出回应的人 - 但我需要一点“支持” - 在您在配置中的数据库连接字符串设置中配置的部分，您将这些信息放在哪里，以及如何放置？我有一个现有的 Java Web 应用程序 - 我正试图掌握如何将 Spring 'shoehorn' 插入我现有的应用程序中。*

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-06T12:07:00.937

有几种方法可以做到这一点，这取决于您的环境。如果您正在使用 Spring，那么您很有可能正在部署 Web 应用程序，或者您处于 J2EE 环境中。如果是这种情况（可以说即使不是），您可能想要配置一个数据源。

这是一个相当简单的解决方案：

```
 <bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close">
    <property name="driverClassName" value="${jdbc.driverClassName}"/>
    <property name="url" value="${jdbc.url}"/>
    <property name="username" value="${jdbc.username}"/>
    <property name="password" value="${jdbc.password}"/>
  </bean> 
```

以上使用的是 Apache (Jakarta Commons) 数据库连接池，但您的应用服务器可能有一个您可能想要使用的替代方案。此外，不同的数据库供应商也有自己的数据源实现（例如 OracleDataSource 和 OracleXADataSource for Oracle）。

请注意 jdbc.username 等属性的使用。这是一种典型配置，因为数据库配置通常因环境而异。您可以使用以下内容激活属性配置器：

```
<bean id="jdbcConfiguration" class="org.springframework.beans.factory.config.PropertiesPlaceholderConfigurer">
  <property name="location" value="classpath:jdbc.properties"/>
</bean> 
```

现在你可能也想要交易，我想。最简单的方法是使用平台事务管理器，但与大多数 Spring 一样，有多种方法可以做到这一点。

```
<bean id="txManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
  <property name="dataSource" ref="dataSource"/>
</bean> 
```

在此之后，您可以直接使用此 bean，或者（可以说更常见）您可以使用带有 AOP（注释）的声明性事务。

[（极好的） Spring 参考文档](http://static.springframework.org/spring/docs/2.5.x/reference/index.html)中有关这些主题的更多信息。

# c# - 函数式 C# API 设计（返回函数参数增加计算结果）

> ID：520043
> 
> 赞同：1
> 
> 时间：2009-02-06T11:58:28.143
> 
> 标签：c#, functional-programming, method-chaining

有一个关于在 C# 代码中使用函数式编程技术的问题。例子

让我们有接口

```
interface IGraph { /*contains vertices and edges*/} 
```

假设我们需要布局图的顶点（将 Point 分配给每个顶点）。

```
interface ILayoutInfo {
  Point GetVertexPoint(vertex);
} 
```

简单的布局路线可以有这样的签名：

```
ILayoutInfo SimpleLayout(IGraph graph); 
```

哪个可以这样使用

```
void Demo() {
  IGraph graph = CreateGraphInAnyWay();
  ILayoutInfo layout = SimpleLayout(graph);
  PrintCoordinates(graph,layout);
} 
```

在下面的设计中 PrintCoordinates 需要对图形和布局的引用。

考虑功能样式设计，其中布局路由通过有关图形顶点坐标的信息来增强图形信息。

```
ILayoutedGraph SimpleLayoutNew(IGraph graph); 
```

ILayoutedGraph 实现 IGraph 和 ILayoutInfo 的地方

```
void DemoNew() {
  IGraph graph = CreateGraphInAnyWay();
  ILayoutedGraph layoutedGraph = SimpleLayoutNew(graph);
  PrintCoordinatesNew(layoutedGraph);
} 
```

1）在这个设计中 PrintCoordinatesNew 只得到一个参数。2）奇怪的接口ILayoutedGraph诞生了，它不包含任何方法，只是包装了其他接口。如果某些库具有其他类型，例如 INetwork、ITree，我们最终会创建包装接口 ILayoutedNetwork、ILayoutedTree（这很糟糕）。

所以这种技术只用于函数式语言，只是因为它们不能以其他方式工作（没有状态，所以函数必须将输入与计算信息结合起来供外部例程使用），或者它在命令式世界中也是可行的？

非常感谢，

PS：可以在这里找到更详细的漂亮打印示例 [http://tivadj.blogspot.com/2009/02/designing-c-api-in-functional-style.html](http://tivadj.blogspot.com/2009/02/designing-c-api-in-functional-style.html)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-06T12:07:57.690

您可以使用实现接口并将返回转换为该类的类来实现这一点吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-07T01:20:28.713

你原来的API没有问题

```
void Demo() {
  IGraph graph = CreateGraphInAnyWay();
  ILayoutInfo layout = SimpleLayout(graph);
  PrintCoordinates(graph,layout);
} 
```

它功能齐全。命令式 API 在创建后将涉及更改`graph`。例如

```
void Demo() {
  IGraph graph = CreateGraphInAnyWay();
  graph.Layout(new SimpleLayout()); // changes the state of graph
  PrintCoordinates(graph);
} 
```

至于 ILayoutedGraph、ILayoutedTree、ILayoutedQueue 等问题，我认为您可以通过函数式语言中的泛型类和允许这样做的 OO 语言中的多重继承来解决这个问题。

就个人而言，我会推荐泛型：需要布置边缘的东西`ILayout<a>`在哪里。`a`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-07T01:40:57.347

如果似乎在传递两个参数时打扰您的是您的布局（ILayoutInfo）链接到用于生成它的图形。传递带有不用于生成它的图形的布局是没有意义的。

在这种情况下，您可以在布局信息中保留对图形的引用，并在 ILayoutInfo 接口上提供访问器。

这样，您只能传递 ILayoutInfo 实例，而您的 PrintCoordinates 函数仍然可以访问用于生成 ILayoutInfo 的图形。

如果您有其他类型的对象可以生成布局信息，请为它们使用通用接口，或使 ILayoutInfo 通用。

# c# - C# 问题：如何将在 DataGridView 中所做的更改保存回使用的 DataTable？

> ID：520051
> 
> 赞同：9
> 
> 时间：2009-02-06T12:02:54.390
> 
> 标签：c#, datagrid, binding, datatable, dataset

我从 DataSet 中获取 DataTable，然后将该 DataTable 绑定到 DataGridView。一旦用户编辑了 DataGridView 上的信息，我如何进行这些更改并将它们放回使用的 DataTable 中，然后我可以放回我的 DataSet 中？

我想在我的 DataGrid 上创建一个保存按钮，当按下它时实际保存更改。

如果我能比这更具体，我不知道，因为这是一个相当简单的问题。

提前致谢！

如果您需要我详细说明，请告诉我。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-06T12:12:42.687

如果您正在使用数据绑定到 a `DataGridView`，那么您*已经在*更新`DataTable`/ `DataSet`。如果您的意思是更改数据库，那么这就是适配器发挥作用的地方。

这是一个例子：

```
using System;
using System.Data;
using System.Linq;
using System.Windows.Forms;
static class Program
{
    [STAThread]
    static void Main()
    {
        Application.EnableVisualStyles();

        DataSet set = new DataSet();
        DataTable table = set.Tables.Add("MyTable");
        table.Columns.Add("Foo", typeof(int));
        table.Columns.Add("Bar", typeof(string));

        Button btn;
        using (Form form = new Form
        {
            Text = "DataGridView binding sample",
            Controls =
            {
                new DataGridView {
                    Dock = DockStyle.Fill,
                    DataMember = "MyTable",
                    DataSource = set
                },
                (btn = new Button {
                    Dock = DockStyle.Bottom,
                    Text = "Total"
                })
            }
        })
        {
            btn.Click += delegate
            {
                form.Text = table.AsEnumerable().Sum(
                    row => row.Field<int>("Foo")).ToString();
            };
            Application.Run(form);
        }

    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T13:40:23.523

如前所述，DataAdapters 是一种简单的方法。

请参阅： http: [//www.codeproject.com/KB/database/relationaladonet.aspx](http://www.codeproject.com/KB/database/relationaladonet.aspx)

一个非常简单的例子，我认为它涵盖了你需要的东西。

# sql - Hibernate - 来自连接表的新列

> ID：520061
> 
> 赞同：1
> 
> 时间：2009-02-06T12:07:28.937
> 
> 标签：sql, hibernate, mapping

我有一个类用户对象。我正在尝试使用 Hibernate 从数据库中加载此对象。我的 SQL 语句是：

```
SELECT
    users.uid               AS uid,
    users.deleted           AS deleted,
    users.username          AS username,
    users.passwd            AS passwd,
    users.disabled          AS disabled,
    users.lockout           AS lockout,
    users.expires           AS expires,
    data_firstname.value            AS firstname,
    data_lastname.value     AS lastname 
FROM 
    ac_users as users
LEFT JOIN
    ac_userdef_data as data_firstname
ON
    users.uid = data_firstname.parentuid AND
    data_firstname.fieldname like 'firstname'
LEFT JOIN
    ac_userdef_data as data_lastname
ON
    users.uid = data_lastname.parentuid AND
    data_lastname.fieldname like 'lastname'
WHERE
    users.deleted = 0 
```

我对 User 类的映射是：

```
<class name="com.agetor.commons.security.User" table="ac_users">
    <id name="uid" column="uid" type="long" >
        <generator class="native"/>
    </id>
    <property name="deleted" column="deleted" />
    <property name="username" column="username" />   
    <property name="password" column="passwd" />
    <property name="firstname" column="firstname" />
    <property name="lastname" column="lastname" />
    <property name="disabled" column="disabled" />
    <property name="lockout" column="lockout" />
    <property name="expires" column="expires" />            
</class> 
```

我的问题是表 ac_users 没有列 'firstname' 或 'lastname' 这些列仅存在于我的 SQL-join 语句的结果集中。它们也不存在于 ac_userdef_data 表中。我有 2 个列：字段名和值。和 2 行： fieldname = 'firstname' 在 value 列中有一些值，另一行 fieldname = 'lastname' 在 value 列中有一些值

如何更改我的映射文件，以便 Hibernate 了解它需要将名字和姓氏列加载到我的 POJO 上的名字和姓氏字段中，而这些列实际上并不存在于引用的 ac_users 表中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-06T13:04:26.170

我现在有一些工作代码。诀窍是为 User 类指定一个加载查询。Hibernate 然后根据 Query 而不是 Table 设计的返回来验证。

类映射

```
<class name="com.agetor.commons.security.User" table="ac_users">
    <id name="uid" column="uid" type="long" >
        <generator class="native"/>
    </id>
    <property name="deleted" column="deleted" />
    <property name="username" column="username" />   
    <property name="password" column="passwd" />
    <property name="firstname" column="firstname" />
    <property name="lastname" column="lastname" />
    <property name="disabled" column="disabled" />
    <property name="lockout" column="lockout" />
    <property name="expires" column="expires" />                 

    <loader query-ref="GetAllUsers" />
</class> 
```

我的查询声明

```
<sql-query name="GetAllUsers">
  <return alias="user" class="com.agetor.commons.security.User" />
  <![CDATA[ 
    SELECT
        users.uid               AS uid,
        users.deleted           AS deleted,
        users.username          AS username,
        users.passwd            AS passwd,
        users.disabled          AS disabled,
        users.lockout           AS lockout,
        users.expires           AS expires,
        data_firstname.value    AS firstname,
        data_lastname.value     AS lastname 
    FROM 
        ac_users as users
    LEFT JOIN
        ac_userdef_data as data_firstname
    ON
        users.uid = data_firstname.parentuid AND
        data_firstname.fieldname like 'firstname'
    LEFT JOIN
        ac_userdef_data as data_lastname
    ON
        users.uid = data_lastname.parentuid AND
        data_lastname.fieldname like 'lastname'
    WHERE
        users.deleted = 0
  ]]>
</sql-query> 
```

我必须使用该行`<return alias="user" class="com.agetor.commons.security.User" />`才能正确键入返回的集合

# unit-testing - 什么是单元测试、集成测试、冒烟测试和回归测试？

> ID：520064
> 
> 赞同：778
> 
> 时间：2009-02-06T12:08:34.317
> 
> 标签：unit-testing, testing, definition

什么是单元测试、集成测试、冒烟测试和回归测试？它们之间有什么区别，我可以为它们使用哪些工具？

例如，我使用[JUnit](https://en.wikipedia.org/wiki/JUnit)和[NUnit](https://en.wikipedia.org/wiki/NUnit)进行*单元测试*和*集成测试*。*最后两个，冒烟测试*或*回归测试*是否有任何工具？

* * *

## 回答 #1

> 赞同：1122
> 
> 时间：2009-02-06T12:28:48.880

*   **单元测试**：指定并测试一个类的单个方法的契约的一点。这应该有一个非常狭窄和明确定义的范围。复杂的依赖关系和与外部世界的交互被[存根或模拟](http://martinfowler.com/articles/mocksArentStubs.html)。

*   **集成测试**：测试多个子系统的正确互操作。从测试两个类之间的集成到测试与生产环境的集成，有整个范围。

*   **冒烟测试（又名** ***健全性*** **检查）**：一个简单的集成测试，我们只检查当被测系统被调用时它是否正常返回并且不会崩溃。

    *   冒烟测试与电子设备类似，第一个测试发生在给电路通电时（如果冒烟，那就不好了！）...
    *   ......而且，[显然](https://stackoverflow.com/questions/520064/what-is-unit-test-integration-test-smoke-test-regression-test#comment13627138_520116)，[管道](https://en.wikipedia.org/wiki/Smoke_testing_(mechanical))系统，管道系统实际上被烟雾填充，然后目视检查。如果有任何东西冒烟，说明系统有泄漏。
*   **回归测试**：修复错误时编写的测试。它确保此特定错误不会再次发生。全称是“非回归测试”。它也可以是在更改应用程序之前进行的测试，以确保应用程序提供相同的结果。

为此，我将补充：

*   **验收测试**：测试功能或用例是否正确实现。它类似于集成测试，但关注的是要提供的用例而不是所涉及的组件。

*   **系统测试**：将系统作为黑盒进行测试。对其他系统的依赖通常在测试期间被模拟或存根（否则它将更像是一个集成测试）。

*   **飞行前检查**：在类生产环境中重复进行的测试，以减轻“在我的机器上构建”综合症。这通常是通过在类似生产环境中进行验收或冒烟测试来实现的。

* * *

## 回答 #2

> 赞同：109
> 
> 时间：2009-02-06T12:13:56.990

*   **单元测试**：测试类内部工作的自动测试。它应该是一个独立的测试，与其他资源无关。
*   **集成测试**：在环境中完成的自动测试，类似于单元测试，但使用外部资源（数据库、磁盘访问）
*   **回归测试**：在实现新功能或错误修复后，您重新测试过去有效的场景。在这里，您将介绍新功能破坏现有功能的可能性。
*   **冒烟测试**：测试人员可以根据他们是否继续测试得出结论的第一个测试。

* * *

## 回答 #3

> 赞同：93
> 
> 时间：2009-02-06T12:15:07.223

每个人的定义都会略有不同，而且往往存在灰色地带。然而：

*   单元测试：这一点点（尽可能隔离）有用吗？
*   集成测试：这两个（或更多）组件是否一起工作？
*   冒烟测试：整个系统（尽可能接近生产系统）是否可以很好地组合在一起？（即我们是否有理由相信它不会产生黑洞？）
*   回归测试：我们是否无意中重新引入了我们之前修复的任何错误？

* * *

## 回答 #4

> 赞同：52
> 
> 时间：2013-09-11T03:47:51.430

我刚刚意识到的一个新的测试类别是*[canary 测试](https://www.quora.com/What-is-canary-testing)*。金丝雀测试是一种自动化的、非破坏性的测试，它在**实时环境中****定期运行**，这样如果它失败了，就会发生非常糟糕的事情。

 **示例可能是：

*   应该只在开发/测试中可用的数据是否已经*出现*？
*   后台进程是否运行失败？
*   用户可以登录吗？

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2015-11-26T07:28:31.377

**来自软件测试技术的最佳网站之一的回答：**

**软件测试的类型——完整列表[点击这里](http://www.testingexcellence.com/types-of-software-testing-complete-list/)**

[![在此处输入图像描述](https://i.stack.imgur.com/2bdIx.jpg)](https://i.stack.imgur.com/2bdIx.jpg)

> 这是一个相当长的描述，我不打算在这里粘贴它：但它可能对想要了解所有测试技术的人有所帮助。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-03-04T01:48:41.053

单元测试：验证特定组件（即类）是否按设计创建或修改了功能。此测试可以是手动的或自动的，但它不会超出组件的边界。

集成测试：验证特定组件的交互是否按设计运行。集成测试可以在单元级别或系统级别执行。这些测试可以是手动的或自动的。

回归测试：验证现有代码中没有引入新缺陷。这些测试可以是手动的或自动的。

根据您的[SDLC](https://en.wikipedia.org/wiki/Systems_development_life_cycle)（[瀑布](https://en.wikipedia.org/wiki/Waterfall_model)、[RUP](https://en.wikipedia.org/wiki/Rational_Unified_Process)、[敏捷](https://en.wikipedia.org/wiki/Agile_software_development)等），特定测试可以分“阶段”执行，也可以或多或少同时执行。例如，单元测试可能仅限于开发人员，然后他们将代码交给测试人员进行集成和回归测试。然而，另一种方法可能让开发人员进行单元测试和某种程度的集成和回归测试（使用[TDD](https://en.wikipedia.org/wiki/Test-driven_development)方法以及持续集成和自动化单元和回归测试）。

工具集在很大程度上取决于代码库，但有许多用于单元测试 (JUnit) 的开源工具。HP (Mercury) QTP 或 Borland 的[Silk Test](https://en.wikipedia.org/wiki/Silk_Test)都是用于自动化集成和回归测试的工具。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2014-04-26T12:02:23.493

**单元测试**：测试应用程序中的单个模块或独立组件被称为单元测试。单元测试将由开发人员完成。

**集成测试**：结合所有模块并测试应用程序，以验证模块之间的通信和数据流是否正常工作。此测试也由开发人员执行。

**冒烟测试** 在冒烟测试中，他们以浅而广的方式检查应用程序。在冒烟测试中，他们检查应用程序的主要功能。如果应用程序中有任何阻塞问题，他们将向开发团队报告，开发团队将修复并纠正缺陷，并将其返回给测试团队。现在测试团队将检查所有模块，以验证在一个模块中所做的更改是否会影响另一个模块。*在冒烟测试*中，测试用例是脚本化的。

**回归测试**重复执行相同的测试用例，以确保未更改的模块不会导致任何缺陷。回归测试属于功能测试

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2010-10-21T05:28:26.347

## 回归测试-

“回归测试针对更改的软件重新运行以前的测试，以确保在当前软件中所做的更改不会影响现有软件的功能。”

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2019-07-24T19:13:41.687

我只是想添加并提供更多背景信息，说明为什么我们有这些级别的测试，它们在示例中的真正含义

Mike Cohn 在他的《敏捷成功》一书中提出了“测试金字塔”作为在项目中进行自动化测试的一种方式。这个模型有多种解释。该模型解释了需要创建什么样的自动化测试、他们可以多快地对被测应用程序提供反馈以及谁编写这些测试。基本上任何项目都需要 3 个级别的自动化测试，它们如下所示。

**单元测试 -** 这些测试您的软件应用程序的最小组件。这实际上可能是代码中的一个函数，它根据一些输入计算一个值。此功能是构成应用程序的硬件/软件代码库的其他几个功能的一部分。

例如 - 让我们以基于 Web 的计算器应用程序为例。该应用程序中需要进行单元测试的最小组件可能是一个执行加法的函数，另一个执行减法的函数等等。所有这些小功能组合在一起就构成了计算器应用程序。

从历史上看，开发人员编写这些测试，因为它们通常使用与软件应用程序相同的编程语言编写。诸如 JUnit 和 NUnit（用于 java）、MSTest（用于 C# 和 .NET）和 Jasmine/Mocha（用于 JavaScript）等单元测试框架用于此目的。

单元测试的最大优势是，它们在 UI 下运行得非常快，我们可以快速获得有关应用程序的反馈。这应该包含超过 50% 的自动化测试。

**API/集成测试——** 这些测试一起测试软件系统的各种组件。这些组件可能包括测试数据库、API（应用程序编程接口）、第三方工具和服务以及应用程序。

例如 - 在我们上面的计算器示例中，Web 应用程序可能使用数据库来存储值，使用 API 进行一些服务器端验证，并且它可能使用 3rd 方工具/服务将结果发布到云，以使其在不同的环境中可用平台。

过去，开发人员或技术 QA 会使用各种工具（如 Postman、SoapUI、JMeter 和 Testim 等其他工具）编写这些测试。

这些运行速度比 UI 测试快得多，因为它们仍然在引擎盖下运行，但可能比单元测试消耗更多时间，因为它必须检查系统各个独立组件之间的通信并确保它们具有无缝集成。这应该包括超过 30% 的自动化测试。

**UI 测试 -** 最后，我们有测试来验证应用程序的 UI。这些测试通常用于测试通过应用程序的端到端流程。

例如 - 在计算器应用程序中，端到端流程可以是，打开浏览器 -> 输入计算器应用程序 url -> 使用用户名/密码登录 -> 打开计算器应用程序 -> 在计算器上执行一些操作-> 从 UI 验证这些结果 -> 注销应用程序。这可能是一个端到端的流程，是 UI 自动化的一个很好的候选者。

从历史上看，技术 QA 或手动测试人员编写 UI 测试。他们使用像 Selenium 这样的开源框架或像 Testim 这样的 UI 测试平台来编写、执行和维护测试。这些测试提供了更多的视觉反馈，因为您可以通过屏幕截图、日志、测试报告查看测试的运行方式、预期结果与实际结果之间的差异。

UI 测试的最大限制是，与单元和 API 级别的测试相比，它们相对较慢。因此，它应该只占整个自动化测试的 10-20%。

接下来的两种类型的测试可以根据您的项目而有所不同，但想法是 -

**烟雾测试**

这可以是上述 3 个测试级别的组合。这个想法是在每次代码签入期间运行它，并确保系统的关键功能仍然按预期工作；合并新代码更改后。他们通常需要运行 5 到 10 分钟才能获得更快的故障反馈

**回归测试**

它们通常至少每天运行一次，涵盖系统的各种功能。他们确保应用程序仍按预期工作。它们比冒烟测试更详细，涵盖了应用程序的更多场景，包括非关键场景。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2014-10-12T19:55:36.253

**单元测试**是针对实现的最小部分。在 Java 中，这意味着您正在测试单个类。如果该类依赖于其他类，则这些是伪造的。

当您的测试调用多个类时，它就是一个**集成测试**。

完整的测试套件可能需要很长时间才能运行，因此在更改后，许多团队会运行一些快速完成的测试来检测重大损坏。例如，您已将 URI 分解为基本资源。这些是**冒烟测试**。

**回归测试**在每个构建上运行，并允许您通过捕获您破坏的内容来有效地重构。任何类型的测试都可以是回归测试，但我发现单元测试最有助于找到故障源。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2014-06-30T09:50:43.470

*   集成测试：集成测试是集成的另一个元素
*   冒烟测试：冒烟测试也称为构建版本测试。冒烟测试是为检查被测软件是否准备好/稳定以进行进一步测试而进行的初始测试过程。
*   回归测试：回归测试是*重复*测试。新软件是否在另一个模块中生效。
*   单元测试：这是一个白盒测试。只有*开发人员*参与其中

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2014-09-16T10:50:07.040

### 单元测试

单元测试通常由开发人员完成，而测试人员在这种类型的测试中部分进化，测试是逐个单元完成的。在 Java [JUnit](https://en.wikipedia.org/wiki/JUnit)测试用例中，也可以测试编写的代码是否设计完美。

### 集成测试：

这种类型的测试在单元测试之后当所有/部分组件被集成时是可能的。这种类型的测试将确保当组件集成时，它们是否会影响彼此的工作能力或功能？

### 冒烟测试

当系统成功集成并准备好在生产服务器上运行时，最后完成此类测试。

这种类型的测试将确保从头到尾的每个重要功能都可以正常工作，并且系统已准备好在生产服务器上部署。

### 回归测试

当开发人员修复一些问题时，这种类型的测试对于测试系统中不存在意外/不需要的缺陷非常重要。此测试还确保所有错误都已成功解决，因此不会发生其他问题。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2017-07-18T12:29:27.300

单元测试：它总是由开发人员在开发完成后执行，以便在他们为 QA 准备任何需求之前从测试方面找出问题。

集成测试：当某些数据/功能输出驱动到一个模块到另一个模块时，测试人员必须验证模块到子模块的验证。或者在您的系统中，如果使用使用您的系统数据进行集成的第三方工具。

冒烟测试：测试人员执行以验证系统以进行高级测试，并试图在更改或代码上线之前找出显示停止错误。

回归测试：测试人员执行回归以验证现有功能由于系统中实施的更改以进行新增强或系统更改。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2017-11-17T11:58:04.223

冒烟和健全性测试都在软件构建之后执行，以确定是否开始测试。在烟雾测试后可能会或可能不会执行理智。它们可以单独执行，也可以同时执行 - 理智是在烟雾之后立即执行的。

**因为健全性测试更深入并且需要更多时间，所以在大多数情况下，自动化是非常值得的。**

冒烟测试的执行时间通常不超过 5-30 分钟。它更通用：它检查整个系统的少量核心功能，以验证软件的稳定性是否足以进行进一步测试并且没有问题，从而阻止计划的测试用例的运行。

健全性测试比烟雾更详细，可能需要 15 分钟到一整天，具体取决于新构建的规模。它是一种更专业的验收测试，在进展或重新测试之后执行。它检查某些新功能和/或错误修复的核心功能以及一些与它们密切相关的功能，以验证它们是否按照所需的操作逻辑运行，然后才能更大规模地执行回归测试。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-02-06T12:31:31.683

已经有一些很好的答案，但我想进一步完善它们：

单元测试是这里唯一的白盒测试形式。其他的是黑盒测试。白盒测试意味着你知道输入；您知道该机制的内部工作原理并且可以检查它并且您知道输出。通过黑盒测试，您只知道输入是什么以及输出应该是什么。

很明显，单元测试是这里唯一的白盒测试。

*   单元测试测试特定的代码片段。通常方法。
*   集成测试测试您的新功能软件是否可以与其他所有功能集成。
*   回归测试。这是为了确保您没有破坏任何东西而进行的测试。过去可以工作的一切都应该仍然有效。
*   冒烟测试是一种快速测试，以确保在您参与更严格的测试之前一切正常。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2015-07-26T04:23:41.403

回归测试 - 是一种软件测试，我们试图覆盖或检查错误*修复*。围绕错误修复的功能不应因提供的修复而改变或改变。在此过程中发现的问题称为*回归问题*。

冒烟测试：是一种测试，用于决定是否接受构建/软件进行进一步的 QA 测试。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2017-12-09T08:45:56.223

*烟雾测试已经在这里进行了解释并且很简单。回归测试属于集成测试。*

自动化测试可以分为两种。

**单元测试和集成测试**（这是最重要的）

对于所有测试，如集成测试、功能测试、回归测试、UI 测试等，我将使用“长测试”（LT）这个短语，而将单元测试称为“短测试”。

一个 LT 示例可以是自动加载网页、登录帐户并购买书籍。如果测试通过，则更有可能以相同的方式在实时站点上运行（因此有“更好的睡眠”参考）。Long = 网页（开始）和数据库（结束）之间的距离。

这是一篇很棒的文章，讨论了[集成测试（长测试）相对于单元测试](https://www.linkedin.com/pulse/before-you-feed-unit-test-beast-s-a-n-j-ay-mohan)的好处。

# entity-framework - 实体框架作为存储库和 UnitOfWork？

> ID：520065
> 
> 赞同：18
> 
> 时间：2009-02-06T12:09:04.567
> 
> 标签：entity-framework, domain-driven-design

我正在开始一个新项目，并决定尝试合并 DDD 模式，还包括 Linq to Entities。当我查看 EF 的 ObjectContext 时，它似乎正在执行存储库和工作单元模式的功能：

从实体表示抽象出底层数据级接口的意义上的存储库，我可以通过 ObjectContext 请求和保存数据。

从某种意义上说，我可以将所有插入/更新写入 objectContext 并在执行 SaveChanges() 时一次性执行它们。

将这些模式的另一层放在 EF ObjectContext 之上似乎是多余的？似乎模型类也可以使用“部分类”直接合并到 EF 生成的实体之上。

我是 DDD 的新手，所以如果我在这里遗漏了什么，请告诉我。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-06T12:53:22.387

我不认为实体框架是存储库的一个很好的实现，因为：

*   对象上下文不够抽象，无法对引用它的事物进行良好的单元测试，因为它绑定到数据库访问。相反，拥有 IRepository 引用更适合创建单元测试。
*   当客户端可以访问 ObjectContext 时，客户端几乎可以做任何它关心的事情。您对此唯一真正的控制就是将某些类型或属性设为私有。这种方式很难实现良好的数据安全性。
*   在一个重要的模型上，ObjectContext 不够抽象。例如，您可以将表和存储过程都映射到相同的实体类型。您真的不希望客户端必须区分这两个映射。
*   与此相关的是，很难编写全面且执行良好的业务规则和实体代码。事实上，这是否是一个好主意是值得商榷的。

*另一方面*，一旦有了 ObjectContext，实现 Repository 模式就很简单了。事实上，对于不是特别复杂的情况，Repository 是 ObjectContext 和 Entity 类型的包装器。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-06T13:06:30.050

我想说您应该将 ObjectContext 视为您的 UnitOfWork，而不是存储库。

ObjectContext 不能是存储库-imho-，因为它是“通用的”。您应该创建自己的存储库，在常规 CRUD 方法旁边有专门的方法（例如 GetCustomersWithGoldStatus）。

所以，我要做的是创建存储库（每个聚合根一个），并让这些存储库使用 ObjectContext。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-13T11:53:26.007

我喜欢有一个存储库层，原因如下：

**EF 的陷阱**

当您查看当前有关 EF（Code First 版本）的一些教程时，很明显有许多问题需要处理，特别是围绕对象图（包含实体的实体）和断开连接的场景。我认为存储库层非常适合将它们包装在一个地方。

**数据访问机制的清晰图景**

存储库提供了关于 BL 如何访问和更新数据存储的特​​定图片。它公开了具有明确单一目的的方法，并且可以独立于 BL 进行测试。教科书中的标准示例**Find()**查找单个实体。一个更特定于应用程序的示例，**Clear()**用于清除数据库表。

**优化的地方**

使用 vanilla EF 时，您不可避免地会遇到性能问题。我使用存储库对 BL 隐藏优化机制。

例子，

**GetKeys()**从表中投影缓存的键（用于插入/更新决策）。仅读取密钥比读取完整实体更快并且使用更少的内存。

通过 SqlBulkCopy 批量加载。EF 将按单个 SQL 语句插入。如果您希望单个语句插入多行，SqlBulkCopy 是一个很好的机制。存储库对此进行封装并为 SqlBulkCopy 提供元数据。除了 Insert 方法，您还需要 StartBatch() 和 EndBatch() 方法，这也是 UnitOfWork 层的参数。

# c# - C# lambda - 咖喱用例

> ID：520083
> 
> 赞同：12
> 
> 时间：2009-02-06T12:16:14.567
> 
> 标签：c#, .net, lambda

我读了[这篇文章](http://jacobcarpenter.wordpress.com/2008/01/02/c-abuse-of-the-day-functional-library-implemented-with-lambdas/)，发现它很有趣。

对于那些不想阅读整个帖子的人来说，总结一下。作者像这样实现了一个名为 Curry 的高阶函数（我在没有他的内部类的情况下进行了重构）：

```
 public static Func<T1, Func<T2, TResult>> 
             Curry<T1, T2, TResult>(this Func<T1, T2, TResult> fn)
 {
     Func<Func<T1, T2, TResult>, Func<T1, Func<T2, TResult>>> curry = 
     f => x => y => f(x, y);
     return curry(fn);
 } 
```

这使我们能够采用像 F(x, y) 这样的表达式，例如。

```
Func<int, int, int> add = (x, y) => x + y; 
```

并以 F.Curry()(x)(y) 方式调用它；

这部分我理解了，我觉得它很酷。我无法理解的是这种方法的实际用例。何时何地需要这种技术，从中可以获得什么？

提前致谢。

编辑：在最初的 3 个响应之后，我了解到在某些情况下，当我们从 curried 创建一个新函数时，一些参数不会被重新评估。我在 C# 中做了这个小测试（请记住，我只对 C# 实现感兴趣，而不是一般的咖喱理论）：

```
public static void Main(string[] args)
{
    Func<Int, Int, string> concat = (a, b) => a.ToString() + b.ToString();
    Func<Int, Func<Int, string>> concatCurry = concat.Curry();
    Func<Int, string> curryConcatWith100 = (a) => concatCurry(100)(a);

    Console.WriteLine(curryConcatWith100(509));
    Console.WriteLine(curryConcatWith100(609));
}

    public struct Int
    {
        public int Value {get; set;}

        public override string ToString()
        {
             return Value.ToString();
        }

        public static implicit operator Int(int value)
        {
            return new Int { Value = value };
        }
    } 
```

在对 curryConcatWith100 的 2 次连续调用中，对值 100 的 ToString() 评估被调用了两次（每次调用一次），所以我在这里看不到任何评估收益。我错过了什么吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-06T13:04:41.507

Currying 用于将带有 x 参数的函数转换为带有 y 参数的函数，因此可以将其传递给另一个需要带有 y 参数的函数的函数。

例如，`Enumerable.Select(this IEnumerable<T> source, Func<TSource, bool> selector)`接受一个有 1 个参数的函数。`Math.Round(double, int)`是一个有 2 个参数的函数。

您可以使用柯里化将`Round`函数“存储”为数据，然后将该柯里化函数传递给`Select`类似的函数

```
Func<double, int, double> roundFunc = (n, p) => Math.Round(n, p);
Func<double, double> roundToTwoPlaces = roundFunc.Curry()(2);
var roundedResults = numberList.Select(roundToTwoPlaces); 
```

这里的问题是还有匿名代表，这使得柯里化变得多余。事实上，匿名代表*是*柯里化的一种形式。

```
Func<double, double> roundToTwoPlaces = n => Math.Round(n, 2);
var roundedResults = numberList.Select(roundToTwoPlaces); 
```

甚至只是

```
var roundedResults = numberList.Select(n => Math.Round(n, 2)); 
```

给定某些函数式语言的语法，柯里化是一种解决特定问题的方法。使用匿名委托和 lambda 运算符，.NET 中的语法要简单得多。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-06T12:24:03.553

首先考虑 fn(x,y,z) 更容易。这可以通过使用 fn(x,y) 进行柯里化，为您提供一个只接受一个参数 z 的函数。任何需要单独使用 x 和 y 完成的事情都可以通过返回函数保存的闭包来完成和存储。

现在您使用不同的 z 值多次调用返回的函数，而无需重新计算所需的 x 和 y 部分。

**编辑：**

咖喱有两个有效的理由。

## 参数缩减

正如 Cameron 所说，将一个接受 2 个参数的函数转换为一个只接受 1 个参数的函数。使用参数调用此 curried 函数的结果与使用 2 个参数调用原始函数的结果相同。

对于 C# 中存在的 Lambda，这具有有限的价值，因为无论如何它们都可以提供这种效果。尽管您使用的是 C# 2，但您问题中的 Curry 函数具有更大的价值。

## 分期计算

咖喱的另一个原因是我之前说过的。当最终参数被提供给柯里化函数时，允许复杂/昂贵的操作被分阶段和重复使用几次。

这种类型的柯里化在 C# 中是不可能的，它确实需要一种可以本地柯里化其任何功能的函数式语言来实现。

## 结论

通过您提到的 Curry 减少参数在 C# 2 中很有用，但由于 Lambdas 在 C# 3 中的价值大大降低。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-06T12:27:11.957

> 从某种意义上说，curring 是一种启用自动部分应用的技术。
> 
> 更正式地说，柯里化是一种将函数转换为只接受一个参数的函数的技术。
> 
> 反过来，当调用该函数时，该函数返回另一个函数，该函数接受一个且仅一个参数。. . 依此类推，直到能够执行“原始”功能。

[来自编码论坛](http://codingforums.com/showthread.php?t=138769)中的一个线程

我特别喜欢这个[页面](http://www.cs.aau.dk/~normark/prog3-03/html/notes/higher-order-fu_themes-curry-section.html)上的解释和长度。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-06T12:39:17.297

一个例子：你有一个函数`compare(criteria1, criteria2, option1, option2, left, right)`。但是，当您想将函数提供`compare`给对列表进行排序的某个方法时，则`compare()`必须只接受两个参数，`compare(left, right)`. 使用 curry，您可以根据需要绑定条件参数以对列表进行排序，最后这个高度可配置的函数会像任何其他 plain 一样呈现给排序算法`compare(left,right)`。

详细信息：.NET 委托使用隐式柯里化。类的每个非静态成员函数都有一个隐式`this`引用，但是，当您编写委托时，您不需要手动使用一些柯里化来绑定`this`到函数。相反，C# 关心语法糖，自动绑定 this，并返回一个只需要剩下参数的函数。

在 C++ boost::bind 等人中。用于相同的。和往常一样，在 C++ 中，一切都更加明确（例如，如果您想将实例成员函数作为回调传递，则需要显式地绑定`this`）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-08-30T23:18:54.370

我有这个愚蠢的例子： Uncurry 版本：

```
void print(string name, int age, DateTime dob)
{
    Console.Out.WriteLine(name);
    Console.Out.WriteLine(age);
    Console.Out.WriteLine(dob.ToShortDateString());
    Console.Out.WriteLine();
} 
```

咖喱功能：

```
public Func<string, Func<int, Action<DateTime>>> curry(Action<string, int, DateTime> f)
{
    return (name) => (age) => (dob) => f(name, age, dob);
} 
```

用法：

```
var curriedPrint = curry(print);
curriedPrint("Jaider")(29)(new DateTime(1983, 05, 10)); // Console Displays the values 
```

玩得开心！

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-06T13:23:55.740

这是另一个如何使用 Curry 函数的示例。根据某些条件（例如星期几），您可以决定在更新文件之前应用什么归档策略。

```
 void ArchiveAndUpdate(string[] files)
    {
        Func<string, bool> archiveCurry1 = (file) =>
            Archive1(file, "archiveDir", 30, 20000000, new[] { ".tmp", ".log" });

        Func<string, bool> archiveCurry2 = (file) =>
            Archive2("netoworkServer", "admin", "nimda", new FileInfo(file));

        Func<string, bool> archvieCurry3 = (file) => true;

        // backup locally before updating
        UpdateFiles(files, archiveCurry1);

        // OR backup to network before updating
        UpdateFiles(files, archiveCurry2);

        // OR do nothing before updating
        UpdateFiles(files, archvieCurry3);
    }

    void UpdateFiles(string[] files, Func<string, bool> archiveCurry)
    {
        foreach (var file in files)
        {
            if (archiveCurry(file))
            {
                // update file //
            }
        }
    }

    bool Archive1(string fileName, string archiveDir, 
        int maxAgeInDays, long maxSize, string[] excludedTypes)
    {
        // backup to local disk
        return true;
    }

    bool Archive2(string sereverName, string username, 
        string password, FileInfo fileToArchvie)
    {
        // backup to network
        return true;
    } 
```

# rss - PubDate/Guid 对 RSS 来说是必不可少的吗？我如何在 Yahoo! 中创建一个好的 RSS！如果来源没有为项目提供不同的日期，则管道？

> ID：520092
> 
> 赞同：3
> 
> 时间：2009-02-06T12:18:38.337
> 
> 标签：rss, guid, feed, yahoo-pipes

我正在创建[一个 Yahoo! 管道](http://pipes.yahoo.com/pipes/pipe.info?_id=atCUO0T03RG3TpwCPxJ3AQ)到[新闻站点](http://www.cbncuritiba.com.br/index.php?pag=todas)，但无**源源**没有每个项目的日期/时间。我的 RSS 不能很好地工作：每次更新都会使 RSS 阅读器（例如 Google 阅读器）再次将所有已读项目标记为未读。也许那是因为缺少 pubDate 标签或不正确的 guid 标签。

1.  如何在 Yahoo! 上创建“pubDate” 当您的源不为您提供数据时，管道？

2.  如何避免“guid”标签被覆盖？（您可以在 YPipes 中设置 guid，但 YPipes 会忽略您的 guid）

**解决方案：** pudDate 不是必需的。指导是必不可少的。即使雅虎！Pipes 重写了 guid，它会工作，因为 Yahoo! Pipes 将您的 guid 文本转换为哈希值，在修改文本之前不会对其进行修改。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-10T00:07:59.093

您是否看过 Feedity - [http://feedity.com](http://feedity.com) - 用于创建自定义 RSS 提要。它就像 Pipes，但更易于使用，而且实际上在 Pipes 中也能很好地工作。我一直在使用它为那些“无源”网页创建 RSS 源。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-26T15:31:03.213

我认为 GUID 是从链接参数生成的。因此，为每个提要项设置一个唯一的 url 很重要。如果所有提要 URL 都具有相同的链接，则它们将具有相同的 GUID。

我希望这会有所帮助。

我正在努力创建独特的网址。你有没有找到实现它的方法？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-03-05T18:06:27.137

好吧，以供将来参考，可以[在此链接](http://pipes.yahoo.com/pipes/pipe.edit?_id=Iq4alPIO3RGgAbcrw5tC8g)中找到解决方案。它也很适合约会。基本上它所做的是创建一个节点，将所有需要的字段作为其子节点复制，然后最后用这个“克隆”的子节点替换父节点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-06T13:37:41.987

我没有给你一个明确的答案，但有趣的是，在过去 4 年左右的时间里，我一直在维护一个私人订阅阅读器。我接触过很多变幻莫测的 RSS/ATOM，我可以告诉你，很多提要没有与项目关联的日期。可能是 RSS 版本问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-06T19:44:02.667

上次我重建我的网站时，我在提要方面遇到了很多麻烦。以您描述的方式-在下次更新时阅读的内容变为未读，重复的条目。事实证明，问题更多的是与 guid 元素有关，而不是与 pubdate 有关。据我记得，只要 guid 是唯一的，我对日期做了什么（我的格式有一段时间错误）并不重要。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-18T16:25:19.500

使用 Yahoo Pipes，使用“创建 RSS”模块，它似乎使用每个条目的*链接*（散列版本）来生成 GUID，正如您所指出的，这对于大多数提要阅读器检测新条目是必要的。

我尝试将“创建 RSS”模块的 GUID 字段设置为每个条目唯一的值，但是生成的提要中的 GUID 对于每个条目保持相同。然后，当我将*链接*设置为该值时，GUID 生成的每个条目都是唯一的。

我已经通过[复制您的管道](http://pipes.yahoo.com/pipes/pipe.info?_id=0be0ae0d2857cb6efc80ba977e6c7f01)并删除（嗯，重命名）链接属性并没有生成 GUID（尽管您已经指定了一个）来验证这一点。这已被其他人确认为错误，请参阅 tinyurl.com/mxard2。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-06T14:43:42.397

问题可能与您的提要的来源有关。如果您使用多个提要，则在管道中的联合操作之后，对 pubdate 执行排序操作，然后将其重定向到输出。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-08-20T19:38:16.933

我自己一直在这样做，并且已经求助于在我用来从中获取数据的 url 中附加一个随机数（我正在使用 YQL 进行抓取）。我通过使用日期生成器生成该随机数并用“今天”填充它以获取当前日期/时间。然后，我使用 URL Builder 来构建我请求的 url，传入一个额外的“随机数”参数，我将其分配给我的 DateTime.utime 值。

通过查看源查看生成的 RSS 提要后，articleId 现在看起来确实是独一无二的，但我没有离开它足够长的时间来了解谷歌阅读器等是否认为它不同。

# ruby - 如何获得“irb(main):001:0>”提示而不是“>>”

> ID：520099
> 
> 赞同：4
> 
> 时间：2009-02-06T12:22:17.783
> 
> 标签：ruby, irb

Ruby 预装在我的 Mac 上，所以我想看看它。我注意到的第一件事是 irb 提示 >> 而不是 irb(main):001:0>。我找不到任何关于如何使用 Google 进行更改的信息，因为每个人都在他们的代码中使用 irb(main):001:0> ;-)

你能帮我吗？

PS：并不是我认为Ruby坏了，而是我想在编程时看起来更书呆子;-)

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-06T12:30:49.780

```
$ irb --help
Usage:  irb.rb [options] [programfile] [arguments]
  --prompt prompt-mode
  --prompt-mode prompt-mode
            Switch prompt mode. Pre-defined prompt modes are
            `default', `simple', `xmp' and `inf-ruby'

$ irb --prompt inf-ruby
irb(main):001:0> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-06-16T00:45:34.067

我所做的就是在我的 .bashrc 中把它变成一个别名，这样我就不必每次都输入它了。

```
echo alias irb=\'irb --prompt inf-ruby\' >> ~/.bashrc 
```

希望这可以帮助！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-12-24T03:34:47.817

转到位置 /home/leapfrog/.rvm/scripts

```
cd ~/.rvm/scripts 
```

打开文件“irbrc.rb”，使用超级用户权限覆盖

```
$ sudo gedit irbrc.rb 
```

将哈希“@prompt”的内容更改为以下内容

```
@prompt = {
 :PROMPT_I => "#{rvm_ruby_string} :%03n > ", # default prompt
 :PROMPT_S => "#{rvm_ruby_string} :%03n%l> ", # known continuation
 :PROMPT_C => "#{rvm_ruby_string} :%03n > ",
 :PROMPT_N => "#{rvm_ruby_string} :%03n?> ", # unknown continuation
 :RETURN => " => %s \n",
 :AUTO_INDENT => true
} 
```

希望这对你有帮助:)

# sql - 如何从sql中的所有字段中搜索

> ID：520102
> 
> 赞同：0
> 
> 时间：2009-02-06T12:25:06.547
> 
> 标签：sql

例如我的桌子在这里>>

```
CREATE TABLE tProject(  
name nvarchar(1000),
Goal ntext, 
Activities ntext,
Result ntext,
MonName nvarchar(1000),
MonGoal ntext,
MonActivities ntext,
MonResult ntext,
TotalFund nvarchar(100)) 
```

如何一次性搜索所有 ntext 和 nvarchar 字段。

请帮帮我

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-06T12:31:16.627

如果您的意思是针对匹配多列的表创建一个选择命令。

```
select * from tProject where name like '%text%' or Goal like '%text%' or...; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T12:41:40.163

你真的有1000个字符长的名字吗？MonName、MonGoal 等列真的是 Monday Name、Monday Goal 的吗？如果是这样，它们应该被移动到另一个表中并链接到这个表。TotalFund 听起来更像是一个数字列而不是 nvarchar。根据这些问题的答案，您可能希望在学习了一些基本的数据库设计实践之后重新设计数据库，以免为时已晚。

无论如何，我认为这就是你要找的：

```
SELECT
    name,
    Goal 
    Activities,
    Result,
    MonName,
    MonGoal,
    MonActivities,
    MonResult,
    TotalFund
FROM
    tProject
WHERE
    name LIKE '%' + @search_string + '%' OR
    Goal LIKE '%' + @search_string + '%' OR
    Activities LIKE '%' + @search_string + '%' OR
    Result LIKE '%' + @search_string + '%' OR
    MonName LIKE '%' + @search_string + '%' OR
    MonGoal LIKE '%' + @search_string + '%' OR
    MonActivities LIKE '%' + @search_string + '%' OR
    MonResult LIKE '%' + @search_string + '%' OR
    TotalFun LIKE '%' + @search_string + '%' 
```

您还可以查看全文字符串搜索，尽管我不知道这是否会使它变得更简单。

# c# - 线程进度到 GUI

> ID：520107
> 
> 赞同：0
> 
> 时间：2009-02-06T12:26:14.780
> 
> 标签：c#, multithreading, user-interface, deadlock

我在我的应用程序中实现了线程来抓取网站。在所有网站都被抓取之后，我想处理它们。

表单创建 queueworker（创建 2 个工作人员并处理任务）。完成所有任务后，我想在表单线程中处理它们。在这一点上，我接受了这个

```
public void WaitForCompletion()
    {
        // Enqueue one null task per worker to make each exit.
        StopWorkers();

        //wait for the workers to finish
        foreach (Thread worker in workers)
        {
            worker.Join();
        }
    } 
```

执行任务后，我触发（来自 queueworker）：

```
public event EventHandler<ProgressEvent> UrlScanned;   

if (UrlScanned != null)
{ 
         UrlScanned(this, new ProgressEvent(task.Name, 1));
} 
```

并通过以下方式捕捉该事件：

```
urlscanner.UrlScanned += new EventHandler<ProgressEvent>(UrlScanningProgress);     

private void UrlScanningProgress(object sender, ProgressEvent args)
{
   if (pbarurlScan.InvokeRequired)
   {
       //don't use invoke when Thread.Join() is used! Deadlock
       Invoke(new MethodInvoker(delegate() { UrlScanningProgress(sender, args); 
       //BeginInvoke(new MethodInvoker(delegate() { UrlScanningProgress(sender, args)};
   }
   else
   {
                pbarurlScan.Value++;
   }
} 
```

问题是窗体线程被阻塞并且调用 Invoke 整个应用程序现在处于死锁状态。

如何在没有死锁的情况下对窗体线程进行更新并进行即时更新（如果工作线程完成，则会发生开始调用）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-06T12:33:29.197

你为什么要加入？我会在每个线程结束时提出一个回调 - 可能会减少一个计数器。当计数器变为 0 时，*回调*UI 线程并执行“all done”代码；就像是：

```
using System.Windows.Forms;
using System.Threading;
using System;
class MyForm : Form
{

    public MyForm()
    {
        Button btn = new Button();
        Controls.Add(btn);
        btn.Text = "Go";
        btn.Click += btn_Click;
    }
    int counter;
    void btn_Click(object sender, System.EventArgs e)
    {
        for (int i = 0; i < 5; i++)
        {
            Interlocked.Increment(ref counter);
            ThreadPool.QueueUserWorkItem(DoWork, i);
        }
    }
    void DoWork(object state)
    {
        for (int i = 0; i < 10; i++)
        { // send progress
            BeginInvoke((Action)delegate { Text += state.ToString(); });
            Thread.Sleep(500);
        }
        EndThread(); // this thread done
    }
    void EndThread()
    {
        if (Interlocked.Decrement(ref counter) == 0)
        {
            AllDone();
        }
    }
    void AllDone()
    {
        Invoke((Action)delegate { this.Text += " all done!"; });
    }
    [STAThread]
    static void Main()
    {
        Application.Run(new MyForm());
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T13:00:01.780

当所有任务完成后，我现在触发一个单独的事件。我将处理任务的逻辑移到了一个单独的函数中，该函数将在接收到 AllUrlsScanned 事件时被调用。

# jquery - jQuery 排队动画

> ID：520112
> 
> 赞同：0
> 
> 时间：2009-02-06T12:27:35.387
> 
> 标签：jquery

我有三个图像，然后使用以下代码在鼠标悬停时淡入淡出。（他们都在自己的 div 中，带有“thumbs”类）

```
$(".thumbs img").fadeTo("slow", 0.3);

$(".thumbs img").hover(function(){
    $(this).fadeTo("normal", 1.0);
},function(){
    $(this).fadeTo("slow", 0.3);
}); 
```

问题是，当您将鼠标滚过它们几次时，它们会在那里闪烁很长时间，因为每次您将鼠标滚过它都会将效果添加到一种队列中。发生这种情况时看起来真的很乱，有什么办法可以防止这种情况发生吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-06T12:32:46.780

防止这种情况的最好方法是在开始动画之前添加一个 Stop() 。因此，您的代码将如下所示：

```
$(".thumbs img").stop().fadeTo("slow", 0.3);

$(".thumbs img").hover(function(){
    $(this).stop().fadeTo("normal", 1.0);
},function(){
    $(this).stop().fadeTo("slow", 0.3);
}); 
```

# wpf - wpf中的StringFormat本地化问题

> ID：520115
> 
> 赞同：119
> 
> 时间：2009-02-06T12:28:27.397
> 
> 标签：wpf, datetime, localization

在 WPF 3.5SP1 中，我使用 DataBindings 中的最后一个功能 StringFormat：

```
 <TextBlock Text="{Binding Path=Model.SelectedNoteBook.OriginalDate, StringFormat='f'}"
                FontSize="20" TextTrimming="CharacterEllipsis" /> 
```

我面临的问题是日期总是用英语格式化......虽然我的系统是法语的？如何强制日期跟随系统日期？

* * *

## 回答 #1

> 赞同：225
> 
> 时间：2009-02-06T13:45:54.997

```
// Ensure the current culture passed into bindings is the OS culture.
// By default, WPF uses en-US as the culture, regardless of the system settings.
FrameworkElement.LanguageProperty.OverrideMetadata(
      typeof(FrameworkElement),
      new FrameworkPropertyMetadata(
          XmlLanguage.GetLanguage(CultureInfo.CurrentCulture.IetfLanguageTag))); 
```

从[在 WPF 中创建国际化向导](http://www.codeproject.com/KB/WPF/InternationalizedWizard.aspx)

* * *

## 回答 #2

> 赞同：93
> 
> 时间：2011-06-21T09:30:17.710

定义以下 xml 命名空间：

```
xmlns:gl="clr-namespace:System.Globalization;assembly=mscorlib" 
```

现在看看这个奇妙的修复：

```
<TextBlock Text="{Binding Path=Model.SelectedNoteBook.OriginalDate, StringFormat='f', ConverterCulture={x:Static gl:CultureInfo.CurrentCulture}" FontSize="20"TextTrimming="CharacterEllipsis" /> 
```

我很清楚这不是一个全局修复程序，您将在每个绑定上都需要它，但肯定这只是很好的 XAML 吗？据我所知，下次绑定更新时，它将使用正确的`CultureInfo.CurrentCulture`或您提供的任何内容。

[此解决方案将立即使用正确的值更新您的绑定，](http://www.nbdtech.com/Blog/archive/2009/03/18/getting-a-wpf-application-to-pick-up-the-correct-regional.aspx)但对于如此罕见和无害的东西来说，这似乎是很多代码。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2013-05-16T08:02:17.630

我只是想补充一点，**loraderon**的答案在大多数情况下都很有效。当我将以下代码行放入我的 App.xaml.cs 时，我的 TextBlocks 中的日期以正确的区域性格式化。

```
FrameworkElement.LanguageProperty.OverrideMetadata(typeof(FrameworkElement), new FrameworkPropertyMetadata(System.Windows.Markup.XmlLanguage.GetLanguage(CultureInfo.CurrentCulture.IetfLanguageTag))); 
```

我说“大多数情况”。例如，这将开箱即用：

```
<TextBlock Text="{Binding Path=Date, StringFormat={}{0:d MMMM yyyy}}" />
--> "16 mei 2013" (this is in Dutch) 
```

...但是在 TextBlock 中使用 Run 时，DateTime 会以默认区域性格式化。

```
<TextBlock>
  <Run Text="Datum: " />
  <Run Text="{Binding Path=Date, StringFormat={}{0:d MMMM yyyy}, Mode=OneWay}" />
</TextBlock>
--> "Datum: 16 may 2013" (this is in English, notice the
    name of the month "may" vs. "mei") 
```

为此，我需要**Gusdor**的答案，即将 ConverterCulture={x:Static gl:CultureInfo.CurrentCulture} 添加到 Binding。

```
<TextBlock>
  <Run Text="Datum: " />
  <Run Text="{Binding Path=Date, StringFormat={}{0:d MMMM yyyy}, ConverterCulture={x:Static gl:CultureInfo.CurrentCulture}, Mode=OneWay}" />
</TextBlock>
--> "Datum: 16 mei 2013" (=Dutch) 
```

我希望这个额外的答案对某人有用。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2012-11-02T15:16:36.720

只需将文化快捷方式插入顶级标签：

```
xml:lang="de-DE" 
```

例如：

```
<Window x:Class="MyApp"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xml:lang="de-DE"
    Title="MyApp" Height="309" Width="497" Loaded="Window_Loaded">....</Window> 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2015-02-06T12:50:56.447

如前所述，XAML 默认为不变区域性 (en-US)，您可以使用

```
FrameworkElement.LanguageProperty.OverrideMetadata(
  typeof(FrameworkElement),
  new FrameworkPropertyMetadata(
      XmlLanguage.GetLanguage(CultureInfo.CurrentCulture.IetfLanguageTag))); 
```

将文化设置为当前文化语言的默认文化。但是评论是错误的；这不*使用*当前的文化，因为您不会看到用户可能进行的任何自定义，它将始终是该语言的默认值。

要实际使用具有自定义的当前文化，您需要将 与`ConverterCulture`一起设置`StringFormat`，如

```
Text="{Binding Day, StringFormat='d', ConverterCulture={x:Static gl:CultureInfo.CurrentCulture}}" 
```

在根元素中`gl`定义为全局命名空间

```
xmlns:gl="clr-namespace:System.Globalization;assembly=mscorlib" 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2011-03-02T14:39:26.877

如果您需要在程序运行时更改语言，您只需更改根元素上的 Language 属性（我不确定这是否具有即时效果或者是否必须重新创建子元素，在我的情况下，这至少有效）

```
element.Language = System.Windows.Markup.XmlLanguage.GetLanguage(culture.IetfLanguageTag); 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2014-07-28T11:54:53.333

在类似元素中切换本地化的完整代码`<Run />`如下：

```
Private Shared Sub SetXamlBindingLanguage()

    '' For correct regional settings in WPF (e.g. system decimal / dot or comma) 
    Dim lang = System.Windows.Markup.XmlLanguage.GetLanguage(CultureInfo.CurrentCulture.IetfLanguageTag)
    FrameworkContentElement.LanguageProperty.OverrideMetadata(GetType(TextElement), New FrameworkPropertyMetadata(lang))
    FrameworkContentElement.LanguageProperty.OverrideMetadata(GetType(DefinitionBase), New FrameworkPropertyMetadata(lang))
    FrameworkContentElement.LanguageProperty.OverrideMetadata(GetType(FixedDocument), New FrameworkPropertyMetadata(lang))
    FrameworkContentElement.LanguageProperty.OverrideMetadata(GetType(FixedDocumentSequence), New FrameworkPropertyMetadata(lang))
    FrameworkContentElement.LanguageProperty.OverrideMetadata(GetType(FlowDocument), New FrameworkPropertyMetadata(lang))
    FrameworkContentElement.LanguageProperty.OverrideMetadata(GetType(TableColumn), New FrameworkPropertyMetadata(lang))
    FrameworkElement.LanguageProperty.OverrideMetadata(GetType(FrameworkElement), New FrameworkPropertyMetadata(lang))

End Sub 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-03-07T12:01:18.353

如果您想在运行时更改文化信息，您可以使用行为（见下文）

```
 public class CultureBehavior<TControl> : Behavior<TControl>
    where TControl : FrameworkElement
{
    private readonly IEventAggregator _eventAggregator;
    private readonly Action<CultureInfo> _handler;

    public CultureBehavior()
    {
        _handler = (ci) => this.AssociatedObject.Language = XmlLanguage.GetLanguage(ci.IetfLanguageTag);
        _eventAggregator = IoC.Container.Resolve<IEventAggregator>();
    }

    protected override void OnAttached()
    {
        base.OnAttached();

        _eventAggregator
            .GetEvent<LanguageChangedEvent>()
            .Subscribe(_handler);

        _handler.Invoke(CultureInfo.CurrentCulture);
    }

    protected override void OnDetaching()
    {
        _eventAggregator
            .GetEvent<LanguageChangedEvent>()
            .Unsubscribe(_handler);

        base.OnDetaching();
    }
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-01-29T04:41:27.380

如果您正在处理代码而不是 XAML，则可以按如下方式设置 ConverterCulture：

```
binding.ConverterCulture = System.Globalization.CultureInfo.CurrentCulture; 
```

感谢@KZeise 指出使用默认文化定义和使用用户自定义文化定义之间的细微差别。

# papervision3d - Papervision 的场景图实现？

> ID：520123
> 
> 赞同：1
> 
> 时间：2009-02-06T12:30:55.957
> 
> 标签：papervision3d, scenegraph

我正在尝试将 Papervision for Flash 用于我的这个项目，该项目涉及机械框架的 3D 模型，由几个连接的部分组成。部件之一的移动导致框架的其他部件的方向和位置的相应变化。我的理解是，使用场景图来处理这种链接运动将是理想的方式，至少，如果我要在更成熟的 3D 开发选项之一中实现，例如 OpenGL 或 DirectX。我的问题是，Papervision 是否有现有的场景图实现？或者，另一种生成所需 3D 运动的方法？

感谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-06T13:03:01.040

我认为 Papervision 基本上是一个基于 Flash 的 3D 渲染引擎，因此应该包含自己的场景图。

`org.papervision3d.scenes.Scene3D`在[API](http://docs.pv3d.org/)中查看。

有关 Papervision 中各种对象的详细说明，请参阅[本文。](http://www.insideria.com/2008/02/papervision3d-part-1-foundatio.html)您可以做的一件事是在 P3D 中搜索具有关键对象的文章，例如 EngineManager、Viewport3D、BasicRenderEngine、Scene3D 和 Camera3D。

至于“产生运动”，这取决于你想要达到的目标。要么您自己编写代码并更改场景，要么使用第三方库（如物理库），这样就不必自己编写所有代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T13:25:30.810

您可以诚实地构建一个，而您需要搜索一个：

使用虚拟方法 Render(matrix:Matrix) 创建一个名为 Node 的类，该类包含一个子节点数组。创建一个名为 TransformNode 的 Node 子类，它引用一个矩阵。创建一个名为 ModelNode 的 Node 子类，它引用一个模型。

TransformNode 的 Render 方法将传入的矩阵与自己的矩阵相乘，然后调用其子级的 render 方法与生成的矩阵。

ModelNode 的 Render 方法在传入矩阵指定的位置将其模型发送到渲染器。

而已。如果边界形状在视锥体中不可见，您可以使用不调用其子级的 BoundsNode 进一步增强事物。

# zend-framework - 翻译查询以使用 Zend_Db_Select

> ID：520131
> 
> 赞同：7
> 
> 时间：2009-02-06T12:37:03.200
> 
> 标签：zend-framework, zend-db-table, zend-db-select

我在将此查询转换为使用 ZF 时遇到一些问题`Zend_Db_Select`：

```
SELECT b.id, b.title, b.description 
FROM memberships AS m
JOIN blogs AS b ON b.id = m.blog_id 
WHERE m.user_id = ? 
ORDER BY m.created
LIMIT 0, 30 
```

（此查询有效并返回结果）

`Memberships``blogs`是和之间的链接表`users`。这是一件简单的`| id | blog_id | user_id |`事情。

这是我到目前为止所拥有的：

```
// $table = Zend_Db_Table instance, $id = a user id
$select = $table->select()
->from(array('m' => 'memberships'), array('b.id', 'b.title', 'b.description'))
->join(array('b' => 'blogs'), 'b.id = m.blog_id')
->where('m.user_id = ?', (int) $id)
->order('m.created DESC')
->limit(0, 30); 
```

这是我得到的（奇怪（对我））错误：

> `#0: Select query cannot join with another table`
> 
> 发生在第 211 行`D:\...\library\Zend\Db\Table\Select.php`。

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-06T23:28:35.973

您还可以通过添加 setIntegrityCheck(false) 来使用传统的 $model->select() 对象，就像这样。

```
$select = $table->select()
->setIntegrityCheck(false)
->from(array('m' => 'memberships'), array('b.id', 'b.title', 'b.description'))
->join(array('b' => 'blogs'), 'b.id = m.blog_id')
->where('m.user_id = ?', (int) $id)
->order('m.created DESC')
->limit(0, 30); 
```

这将禁用引发异常的检查：

```
#0: Select query cannot join with another table 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-06T12:47:34.100

从您的表对象中检索时，该语句将仅限于我认为的该表。这些`Zend_Db_Table::select()`方法返回一个`Zend_Db_Table_Select`对象，该对象是其子类`Zend_Db_Select`并施加此限制。试试这个：

```
$db = Zend_Db::factory( ...options... );
$select = new Zend_Db_Select($adapter);
$select->from( 'my_table_name' )->join( ... 
```

如果您愿意，以下内容应该是等效的：

```
$db = Zend_Db::factory( ...options... );
$db->select()->from( 'my_table_name' )->join( ... 
```

# php - php中的静态变量是否在请求中持续存在？

> ID：520132
> 
> 赞同：40
> 
> 时间：2009-02-06T12:38:29.173
> 
> 标签：php, static, persistence

## php中的静态变量gotcha

我来自 Java 背景，最近为一个项目切换到 php。我在 php.ini 中发现了一种意外行为。

> **设置为某个静态变量的值不会在** **请求中****保持持久性。**

 **我不确定这是否是预期的行为。因为在 java 中，您始终可以在请求中保留非常常用的变量或说诸如 dbname,hostname,username,password 之类的常量，这样您就不必总是从本地属性文件中读取它们。

这种行为正常吗？如果它是正常的，那么是否有任何替代方法可以让我在请求中保留分配给变量的值？

有人可以建议我在 php 中执行此操作的更好方法吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-02-06T12:39:47.750

不，虽然静态变量将保留在当前请求中，但您需要将其添加到会话中以在请求中保留它的值。

例子：

```
session_start();

class Car {
    public static $make;
    public function __construct($make) {
        self::$make = $make;
    }
}

$c = new Car('Bugatti');
echo '<p>' . Car::$make . '</p>';
unset($c);

if (!isset($_SESSION['make'])) {
    echo '<p>' . Car::$make . '</p>';
    $c = new Car('Ferrari');
    echo '<p>' . Car::$make . '</p>';
}

$_SESSION['make'] = Car::$make;

echo '<p>' . $_SESSION['make'] . '</p>'; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-06T12:41:30.943

静态变量只适用于一个请求。如果您希望数据在特定用户的请求之间保持不变，请仅使用会话变量。

对他们来说一个很好的入门 tut 位于：http: [//www.tizag.com/phpT/phpsessions.php](http://www.tizag.com/phpT/phpsessions.php)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-06T13:05:50.037

如果您开始处理跨会话的复杂数据集，您可能需要考虑将数据存储在对象中，这些对象会序列化到数据库并在会话恢复时提取。

PHP 中的变量并不意味着是持久的。您的应用程序（堆栈）的流程在每个页面运行时从头到尾执行。后台没有任何东西可以继续您的逻辑或应用程序。最接近的是会话，但您不想在其中存储数据库访问等信息。

您的数据库配置应该在某种配置或环境文件中，一次访问以连接到数据库，一旦建立连接，您可以在需要时简单地查询并使用连接句柄来识别要使用的连接。

# .net - 从getter/setter的MethodInfo中找到宿主PropertyInfo

> ID：520138
> 
> 赞同：26
> 
> 时间：2009-02-06T12:39:44.253
> 
> 标签：.net, reflection, methodinfo, propertyinfo

我在运行时使用反射进行了一些类型分析。如果我有一个 MethodInfo 实例，我如何确定这是一个“真实”方法还是一个属性的 getter/setter 方法？如果它是一个属性，我怎样才能找到它的托管 PropertyInfo 回来？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-06T12:47:29.263

好吧，getter 和 setter 背后的方法*是*“真正的”方法。

重新跟踪到一个属性 - 模式（返回与采用 1 个参数）将有助于缩小范围 - 但您必须在每个上调用 GetGetMethod/GetSetMethod 才能找到该属性。

您可能可以**尝试**( `Name`less get__/set__) - 但这感觉很脆弱。这是较长的版本（不使用`Name`）：

```
static PropertyInfo GetProperty(MethodInfo method)
{
    bool takesArg = method.GetParameters().Length == 1;
    bool hasReturn = method.ReturnType != typeof(void);
    if (takesArg == hasReturn) return null;
    if (takesArg)
    {
        return method.DeclaringType.GetProperties()
            .Where(prop => prop.GetSetMethod() == method).FirstOrDefault();
    }
    else
    {
        return method.DeclaringType.GetProperties()
            .Where(prop => prop.GetGetMethod() == method).FirstOrDefault();
    }
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-06T13:17:00.497

Ecma 335 指定（但不要求）编译器使用 get_/set_ 前缀（第 22.28 章）。我不知道任何违反该建议的语言。让它变得简单：

```
public static PropertyInfo GetPropFromMethod(Type t, MethodInfo method) {
  if (!method.IsSpecialName) return null;
  return t.GetProperty(method.Name.Substring(4), 
    BindingFlags.Instance | BindingFlags.Static | BindingFlags.NonPublic);
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-06T12:48:45.453

调查[`MethodBase.IsSpecialName`](http://msdn.microsoft.com/en-us/library/system.reflection.methodbase.isspecialname.aspx)。不应明显可见的方法，例如属性访问器、事件订阅方法和运算符重载使用此标志。

`PropertyInfo`据我所知，如果不遍历属性并比较方法，就无法找到。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-12-29T13:53:04.400

我真的很想留下这个作为评论，但我不能因为我的代表不够高:(

Marc Gravell 的代码中有一个错误：如果它是一个索引器，它将返回 null，即使存在父属性也是如此。快速失败很好，但我认为我们只能在它既没有返回值也没有参数的情况下这样做：

```
 [Pure]
    public static PropertyInfo GetParentProperty(this MethodInfo method)
    {
        if (method == null) throw new ArgumentNullException("method");
        var takesArg = method.GetParameters().Length == 1;
        var hasReturn = method.ReturnType != typeof(void);
        if (!(takesArg || hasReturn)) return null;

        if (takesArg && !hasReturn)
        {
            return method.DeclaringType.GetProperties().FirstOrDefault(prop => prop.GetSetMethod() == method);
        }
        else
        {
            return method.DeclaringType.GetProperties().FirstOrDefault(prop => prop.GetGetMethod() == method);
        }
    } 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2015-09-22T06:45:12.360

玩的技巧是**BindingFlags.DeclaredOnly**和**IsSpecialName**

# algorithm - 识别此算法：插槽和钉子

> ID：520143
> 
> 赞同：4
> 
> 时间：2009-02-06T12:42:23.063
> 
> 标签：algorithm, math

我有许多插槽和钉子排成一条直线。钉子可以移动，并且需要分别移动到一个插槽中。只有当所有的钉子都被拿走时，一个插槽才能空着。当一个钉子被移动时，它不能越过另一个钉子。换句话说，必须保持挂钩的顺序。优选地，所有钉移动的总距离应保持在最小值。尽可能在最近的可用插槽中放置一个钉子。

我只想知道：数学的哪个领域处理这样的问题？处理类似问题的任何知名算法的名称是什么？我正在寻找谷歌饲料。一些关键词。

```
+--oooo-+--+---+---o--+------+--+-ooo+o-+-------o--+-----o-o-+-o

+ - Slots
o - Pegs 
```

**编辑：**我认为这种可视化更有意义。它们是需要排列的两条独立的轨道。

```
Slots: +-------+--+---+------+------+--+----+--+----------+---------+--
Pegs:  ---oooo------------o--------------ooo-o---------o--------o-o---o 
```

**编辑：**只是想明确一点，插槽的数量可以大于、小于或等于钉子的数量。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-06T13:08:50.360

我认为这是[动态编程](http://en.wikipedia.org/wiki/Dynamic_programming)解决方案的经典素材。事实上，看看“序列对齐”，这可能是该维基百科页面上的另一个很好的搜索词。

关键见解是这样的：

想象一下，您将挂钩作为挂钩位置列表（挂钩 1：更多挂钩），将插槽作为插槽位置列表（插槽 1：更多插槽）。调用这个问题（peg1:pegs, slot1:slots）。然后解决方案是 slot1 中的 peg1 和 (pegs, slots) 的解决方案，或者是 (peg1:pegs, slots) 的解决方案。

这给出了如何解决它的递归定义。

或者用伪代码（以函数式编程风格编写），想象一个函数 distance(peg, slot)：

```
distance([]) = 0
distance((peg,slot):matches) = distance(peg,slot)+distance(matches)

solution(peg:[], slot:[]) = [(peg,slot)]
solution(peg:pegs, slot:slots) = if distance(a)<distance(b) then a else b
   where a = solution(peg:pegs, slots) and b=(peg,slot):solution(pegs, slots) 
```

通过将距离组合到数据结构中，应该可以提高该解决方案的效率。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-06T13:02:12.027

我不知道这个问题是从哪里来的，但我很确定它是一种[**组合优化**](http://en.wikipedia.org/wiki/Combinatorial_optimization)形式，更具体地说，它可以使用[**（整数）线性规划**](http://en.wikipedia.org/wiki/Linear_programming)来解决。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-06T18:52:10.323

> “所有钉子移动的总距离应保持在最小值”

除非我遗漏了什么，否则这不是问题。

由于必须保持钉子的顺序，您只需将钉子编号为 1、2、3、...

> +--1234-+--+---+---5--+------+--+-678+9-+-------10--+--- --11-12-+-13

并且最终状态必须是插槽 1 中的 peg 1，插槽 2 中的 peg 2，等等。

> +--1-+-2-+-3-+-4-+-5-+-6-+-7-+-8-+-9-+-10-+-11-+-12-+ -13-+

不能将钉子相互跳过并不重要，每个钉子都必须从起点到终点移动一定的距离。 ***只要所有的移动都在正确的方向并且钉子永远不必后退***，那么每个钉子必须移动的距离就是一个简单的常数（它不取决于移动的顺序），并且总和那些距离，你的成本函数也是恒定的。

我认为这里不需要动态规划或线性规划优化问题。

如果你引入一个拾取和设置挂钩的成本，那么这里可能存在优化问题，但即使这样也可能是微不足道的。

**针对 1800 Information 的评论进行**编辑****

 **> 仅当插槽数等于挂钩数时才如此-问题陈述中没有假设- 1800信息（2小时前）

好吧，我错过了。感谢您指出我所缺少的。不过，我仍然不相信这是火箭科学。

假设 #pegs > #holes。像上面那样计算最终状态，就好像你有额外的洞一样；然后选择移动最远的 N 个钉子并将它们从问题中删除：那些是没有移动的钉子。重新计算忽略这些挂钩。

假设 #holes > #pegs。正确的最终状态可能有也可能没有差距。如上所述计算最终状态，并寻找相邻的钉子相互移动的位置。这些是您可以将其分解为可以轻松解决的子问题的点。当连续子问题的两端都有洞时，还有一个额外的变量——最终的连续序列开始的地方。

是的，它比我一开始想的要复杂一些，但它似乎仍然需要一点纸笔工作来表明解决方案是几个易于理解和编码的循环。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-06T13:08:30.030

组合学。组合算法。具体数学。（也是唐纳德·克努斯（Donald Knuth ）的[一本优秀且相关的书](https://rads.stackoverflow.com/amzn/click/com/0201558025)的标题 。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-06T23:54:01.337

如果挂钩数 == 槽数，则仅存在一种解决方案。第一个挂钩必须进入第一个插槽，下一个挂钩必须进入下一个插槽，以此类推。

数字不同，然后它稍微复杂一些，因为一个钉子或插槽（我们可以移动哪个无关紧要）可以移动到很多地方。

蛮力：假设对象的数量是 m pegs 和 n 个插槽（可互换），m < n

1.  对于每种方式（nm）可以选择插槽（请参阅一些组合算法以了解如何执行此操作）
    1.  那里 (nm) 选择的插槽将是空的。
    2.  用钉子填充剩余的 m 个插槽。计算移动的距离。这与顶部讨论的情况相同。
2.  选择移动最小距离的排列。

递归解决方案：

```
 int solve(int pegs, int *peg_x, int slots, int *slot_x)
    {
      if (slots > pegs )
        return solve(slots, slot_x, pegs, peg_x);
      if (slots == 0 || pegs==0)
        return 0; // Cannot move

      int option1 = INT_MAX, options2 = INT_MAX;

      if (pegs > slots ) // Can try skipping a peg
        option1 = solve(pegs-1, peg_x+1 /* Move over one element */
                          slots, slot_x);
      // pegs >= slots 
      option2 = solve(pegs-1, peg_x+1, slots-1, slot_x+1)
                + abs(peg_x[0]-slot_x[0]);
      return min(option1, option2);
    } 
```

这个解决方案仍然需要将结果存储在一个表中，这样就不会多次解决子问题，成为一个动态解决方案。

想……会更新……

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-06T12:54:50.933

排队论或数学...

# unicode - 将文件保存为 unicode 的脚本

> ID：520150
> 
> 赞同：6
> 
> 时间：2009-02-06T12:44:32.030
> 
> 标签：unicode, powershell, cygwin

你知道我可以以编程方式或通过脚本将一组以 ansi 字符编码保存的文本文件转换为 unicode 编码的方法吗？

当我用记事本打开文件并选择将其保存为 unicode 文件时，我想做同样的事情。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-07T00:13:20.767

这可能对您有用，但请注意它会抓取当前文件夹中的**每个文件：**

```
 Get-ChildItem | Foreach-Object { $c = (Get-Content $_); `
Set-Content -Encoding UTF8 $c -Path ($_.name + "u") } 
```

为简洁起见，使用别名也是如此：

```
 gci | %{ $c = (gc $_); sc -Encoding UTF8 $c -Path ($_.name + "u") } 
```

Steven Murawski 建议`Out-File`改用。两个 cmdlet 之间的区别如下：

*   `Out-File`将尝试格式化它收到的输入。
*   `Out-File`的默认编码是基于 Unicode 的，而`Set-Content`使用系统的默认编码。

这是一个假设文件`test.txt`在任何一种情况下都不存在的示例：

```
 PS> [system.string] | Out-File test.txt
PS> Get-Content test.txt

IsPublic IsSerial Name                                     BaseType          
-------- -------- ----                                     --------          
True     True     String                                   System.Object     

# test.txt encoding is Unicode-based with BOM 
```

```
 PS> [system.string] | Set-Content test.txt
PS> Get-Content test.txt

System.String

# test.txt encoding is "ANSI" (Windows character set) 
```

事实上，如果您不需要任何特定的 Unicode 编码，您也可以执行以下操作将文本文件转换为 Unicode：

```
 PS> Get-Content sourceASCII.txt > targetUnicode.txt 
```

`Out-File`是一种“带有可选参数的重定向运算符”。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-06T14:19:25.147

最简单的方法是 Get-Content 'path/to/text/file' | 输出文件“名称/文件/文件”。

[Out-File 有一个 -encoding 参数](http://technet.microsoft.com/en-us/library/dd315303.aspx)，默认为 Unicode。

如果你想编写一批脚本，你可以做类似的事情

```
$files = get-childitem 'directory/of/text/files' 
foreach ($file in $files) 
{
  get-content $file | out-file $file.fullname
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-06T13:00:21.373

将 System.IO.StreamReader（读取文件内容）类与 System.Text.Encoding.Encoding（创建进行编码的 Encoder 对象）基类一起使用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-06T23:13:12.120

您可以创建一个新的文本文件并将原始文件中的字节写入新文件，在每个原始字节之前放置一个“\0”（假设原始文本文件是英文的）。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-02-06T13:03:22.913

伪代码...

昏暗系统、文件、内容、newFile、oldFile

常量 ForReading = 1，ForWriting = 2，ForAppending = 3 常量 AnsiFile = -2，UnicodeFile = -1

设置 system = CreateObject("Scripting.FileSystemObject...

设置文件 = system.GetFile("text1.txt")

设置 oldFile = file.OpenAsTextStream(ForReading, AnsiFile)

内容 = oldFile.ReadAll()

oldFile.关闭

system.CreateTextFile "text1.txt"

设置文件 = system.GetFile("text1.txt")

设置 newFile = file.OpenAsTextStream(ForWriting, UnicodeFile)

newFile.Write 内容

新文件关闭

希望这种方法能奏效..

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-06T13:54:13.950

您可以使用 iconv。在 Windows 上，您可以在 Cygwin 下使用它。

```
iconv -f from_encoding -t to_encoding file 
```

# python - Python“属性对象没有属性”异常

> ID：520152
> 
> 赞同：5
> 
> 时间：2009-02-06T12:45:09.830
> 
> 标签：python, django, properties

```
confirmation = property(_get_confirmation, _set_confirmation)
confirmation.short_description = "Confirmation" 
```

当我尝试上述方法时，我得到一个我不太明白的异常：

```
AttributeError: 'property' object has no attribute 'short_description' 
```

这是对此处另一个问题的[回答](https://stackoverflow.com/questions/435544/django-custom-virtual-model-field-with-companion-stored-field/435580#435580)，但我无法对此发表评论，因为我没有足够的积分或其他东西。:-(

在其他测试中，我在类似情况下也遇到了这个错误：

```
TypeError: 'property' object has only read-only attributes (assign to .short_description) 
```

有什么想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-06T13:01:53.150

property() 的结果是您无法添加新字段或方法的对象。它是不可变的，这就是您收到错误的原因。

[示例如何使用 property()](http://adam.gomaa.us/blog/2008/aug/11/the-python-property-builtin/)。

[编辑]至于[答案](https://stackoverflow.com/questions/435544/django-custom-virtual-model-field-with-companion-stored-field/435580#435580)，您参考：我认为当您查看示例时，该示例的缩进是完全错误的。这已经修复了，现在。

# c# - 如何处理来自 SQL Server 的 XML 中的空对象？

> ID：520160
> 
> 赞同：1
> 
> 时间：2009-02-06T12:49:27.120
> 
> 标签：c#, sql-server, xml

我有一个以 XML 形式返回对象的存储过程。如何处理对象不存在的情况？

我无法返回 null 或空字符串，因为 XmlReader 抱怨它不是有效的 XML。

如果我返回一个空标签，我如何判断它只是一个空对象还是没有对象？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-06T13:02:11.260

好吧，一种常见的方法是一些标记属性，例如`xsi:nil="true"`（尽管这只是一个示例）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-06T15:27:21.030

我见过的两种方式是：

1.  包含一个属性以指示项目是否为空 (isnull="true|false")。通常，如果不包含该属性，则假定为 false。
2.  Don't include the element for that node. If it doesn't exist in the xml it's null. If it does exist and is empty, it's just an empty string. This, of course, relies on your parsing code being able to determine what elements should exist (via either a schema or information earlier in the xml file, generally).

The first option is generally easier to deal with, but results in more text. The second can result in a smaller xml file.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-06T13:07:57.740

要么返回一个自定义的空标签 () 并检查它，要么只是改变你读取数据的方式：

*   首先将流获取到 string-var 并检查 String.IsNullOrEmpty
*   只需尝试捕获 ArgumentNullException/ArgumentException 的读者

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-06T13:55:00.220

为您的存储过程创建一个 out 参数。在存储过程中，将值设置为 1 表示现有对象或 0 表示不存在。仅当 out 参数为 1 时才反序列化存储过程的 xml 结果。

```
CREATE PROCEDURE sp_GetObjectAsXml         
(
    @intId  int,
    @intExists int out
) 
AS  
BEGIN
    SELECT 'hello world'  WHERE 1 = @intId
    SET @intExists = @@ROWCOUNT
END

-- Happy Path
DECLARE @intExists int
exec sp_GetObjectAsXml 1, @intExists out
SELECT @intExists -- results in 1

-- Sad Path
DECLARE @intExists int
exec sp_GetObjectAsXml 10, @intExists out
SELECT @intExists -- results in 0 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-06T13:55:50.903

根据您的“外部约束”（例如，您控制多少 XML 生成/使用过程），您可以通过根本不包含元素来表示 null。

接收方（模式验证等）当然必须准备好处理可选元素。

# c# - 学习日 C#

> ID：520163
> 
> 赞同：0
> 
> 时间：2009-02-06T12:51:11.220
> 
> 标签：c#, .net, datetime

我如何在一周内的下周三、周一学习？例如今天 06.02.2009 下周一 09.02.2009 或周三 11.02.2009 有什么算法吗？

我需要 ：

下周的哪个星期一？

findDay("星期一")

它必须返回 09.02.2009

==================================================== ===

findDay("星期二")

它必须返回 10.02.2009

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-06T12:57:34.813

```
public static DateTime GetNextDayDate(DayOfWeek day) {
  DateTime now = DateTime.Now;
  int dayDiff = (int)(now.DayOfWeek - day);
  if (dayDiff <= 0) dayDiff += 7;
  return now.AddDays(dayDiff);
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-06T12:54:45.347

```
DateTime now = DateTime.Now;
DateTime nextMonday = now.AddDays((int)now.DayOfWeek - (int)DayOfWeek.Monday); 
```

哼，看来我回答得太快了。实际上还有更多的检查要做。看看 nobugz 或 peterchen 的答案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-02-28T18:51:36.593

我找到了一个更简单的解决方案：

DayOfWeek 是一个枚举，如：Monday=1、Tuesday=2 等。

因此，要获得下周一（从今天开始），您应该使用：

```
DateTime.Today.AddDays(8-(int)DateTime.Today.DayOfWeek) 
```

其中“8”是下周的星期一（根据枚举-> 1+7）。

将 8 替换为 10（即星期三，3+7），您将得到下周的星期三，依此类推...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-06T12:59:11.033

像 Tyalis 一样，但需要一些额外的检查：

```
int daysUntilMonday = ((int)DayOfWeek.Monday - (int)today.DayOfWeek;
if (daysUntilMonday <= 0) 
  daysUntilMonday += 7;

Monday = DateTime.Now.AddDays(daysUntilMonday); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-06T13:05:12.987

稍微迭代一下：

```
DateTime baseDate = ...;
DayOfWeek requiredDayOfWeek = ...;

while(baseDate.DayOfWeek != requiredDayOfWeek)
    baseDate = baseDate.AddDays(1); 
```

如果可用，您还可以编写扩展方法：

```
static Next(this DateTime date, DayOfWeek requiredDayOfWeek) { ... } 
```

你会得到漂亮的语法：`today.Next(DayOfWeek.Saturday)`.

# c# - 从经典 ASP 访问 .NET 程序集

> ID：520165
> 
> 赞同：7
> 
> 时间：2009-02-06T12:52:59.487
> 
> 标签：c#, .net, asp-classic, assemblies

我一直在尝试访问我在经典 ASP 中使用创建的 .NET 程序集

```
dim foo
set foo = Server.CreateObject("TestAssembly.MyClass") 
```

问题是我收到一个错误：

```
Server object error 'ASP 0177 : 800401f3'

Server.CreateObject Failed

/test.asp, line 4

Invalid class string 
```

我已经按照文章中的说明使用 gacutil 和 regasm 注册了程序集（TestAssembly.dll）：用我从[另一个问题中引用的](https://stackoverflow.com/questions/95724/what-is-the-easiest-way-to-convert-from-asp-classic-to-asp-net/104187#104187)[.NET 程序集替换旧的经典 ASP COM 组件](http://blog.danbartels.com/articles/322.aspx)。它提供了两种安装程序集的方法，我都尝试过，但都无济于事。

让它工作会很棒，因为它可以让我逐渐将经典的 ASP 站点迁移到 .NET

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-06T13:47:11.857

要检查的另一件事：确保您的 .Net 程序集设置为 COM Visible。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-01-05T09:28:10.800

在此处检查注册表：*HKLM\SOFTWARE\Classes* 并查看 namespace.class 是否存在（例如“TestAssembly.MyClass”）以及它是否有一个名为“CLSID”且具有有效 ID 的键。

如果注册表项不存在，请确保**Project > Properties > Assembly Information**具有“ **Make assembly COM-Visible** ”，然后重新编译。编译后，运行 regasm（如果您在 64 位计算机上，则必须明确引用 64 位版本的 regasm - **c:\Windows\microsoft.net\framework64\v4.0.30319\regasm**）：

```
regasm /codebase /tlb TestAssembly.dll 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-06T13:00:10.080

此错误表示“无效的类字符串”——换句话说，对 CreateObject 的调用失败，因为 OLE 子系统找不到名称对象。原因包括：

1.  毕竟你真的没有在服务器上运行 regsvr32 。
2.  您运行了 regsvr32 但它报告了一个错误。
3.  有人修改了部分注册表的安全性，阻止 OLE 子系统读取全部或部分 HKEY_CLASSES_ROOT 树。
4.  您尝试创建的对象的名称拼写错误或不正确。
5.  确定是否是权限问题

将匿名用户（由 IIS 使用）添加到管理员组。测试页面然后工作，证明这是一个权限问题。不要忘记从 Admin 组中删除匿名 IIS 用户！

6.  判断是否是文件权限问题：

从 Admin 组中删除 Anonymous 用户后，向文件 (smtpsvg.dll) 添加失败审核，这将确定该文件是否曾被访问过（通过缺少失败事件）。如果不是，这表明失败发生在文件访问之前，但请继续检查文件/目录权限以确保匿名 IIS 用户可以访问该文件。

7.  检查注册表权限

使用 Regedt32，在 smtpsvg.dll 上找到。检查密钥（和子密​​钥）的权限，并确保匿名用户具有读取权限。查找包含位置值和版本的类 ID，并检查这些权限。

来源：[http ://forums.digitalpoint.com/showthread.php?t=21069](http://forums.digitalpoint.com/showthread.php?t=21069)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-06T13:10:48.153

过去我在从 ASP Classic 调用 .NET 程序集时遇到过问题。我认为这是我在此过程中遇到的几个问题之一。

我必须做的一件事是确保 ASP 站点的应用程序池使用与匿名用户相同的身份（默认情况下它使用“系统用户”或类似的东西）。所以我最终创建了一个新的本地用户（确保它是 IIS_WPG 组的成员）并将其用于 IIS 匿名用户和应用程序池身份。

这是一个麻烦的地方，我使用它的应用程序是一个收缩包装的产品，我们发现一些机器被搞砸了，即使经过很多次我们也无法让 ASP Classic 到 .net 调用工作权限等的调整。

**编辑：**

我想我应该说我并没有声称此更改将解决此特定问题，只是这是我们必须做出的更改之一，以使 ASP Classic -> .NET 代码在广泛的随机客户服务器上工作.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-02-25T13:26:14.117

我使用了icepicker的解决方案，它对我有用。我花了一天多的时间调查我遇到的这个错误

```
Microsoft VBScript runtime error '800a01ad' 

ActiveX component can't create object: 'namespace.class' 

/page.asp, line 15 
```

解决方案是使用**c:\Windows\microsoft.net\framework64(folder of framework used)\regasm)**。我从*c:\Windows\microsoft.net\framework64* & *c:\Windows\microsoft.net\framework*运行它，但它不起作用。我的假设是，如果您运行 REGASM，它将默认为 32 位版本。除非您指定 framework64/v4.0.xxx（或任何版本）文件夹，否则它将运行 64 位。

# agile - 使用 scrum 部署中期冲刺（大型正在进行的“棕地”公共网络项目）

> ID：520166
> 
> 赞同：2
> 
> 时间：2009-02-06T12:53:10.420
> 
> 标签：agile, scrum

[Schwaber & Beedle 的“scrum”书](https://rads.stackoverflow.com/amzn/click/com/0130676349)（以及我读过的其他 scrum 文献）似乎专注于在 sprint 结束时拥有可发布的产品。已建立站点的 Web 开发（至少在我们的例子中）包括开发“增强”（各种大小）和许多小的“修复”。仅在 sprint 结束时部署（到 Web）会减慢我们对大型增强功能的部署（可能是一件好事），但会大大减慢我们对小型增强功能和修复的部署（即错误停留时间更长）。

Scrum 中的中期 sprint 部署是异端吗？冲刺甚至适用于我们的案例吗？我是否完全误解了 sprint？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-06T13:03:23.957

我真的认为在冲刺中期部署到*生产*环境听起来是个坏主意。一个真正的焦点窃取者。

也许缩短冲刺长度对你来说是件好事？

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-06T14:52:55.233

在 Sprint 结束时完成的工作必须由产品负责人在评审会议期间进行评审。如果您在中途释放，情况可能并非如此。

如果你觉得在 sprint 结束之前工作已经完成，你可以：

1.  通过从发布积压中选择最高优先级的项目来添加更多工作
2.  缩短未来的冲刺

鉴于您的工作环境描述，我会选择 2。

您可能还想考虑另一种可能更适合您的环境的敏捷方法。

我不会在冲刺中期发布。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-10T15:37:46.717

在 sprint 结束时拥有可发布的内容并不排除在 sprint 中期发布。事实上，当您的团队承担生产支持职责时，这是必需的。

不过，我会问一些关于这些冲刺中期版本的问题：

1）早期版本的增量价值是否超过部署成本？2) 您是否评估了每个小型部署的风险，以确保它们不会适得其反并创造更多工作？3) 你能否获得客户对这些迷你版本的反馈，以确保你发布他们想要的东西？4）您是否考虑过缩短冲刺时间？

“严格的 scrum 驱动开发”（上面提到的）对我来说是矛盾的。口头禅是检查和适应。有人认为 Scrum 被用作反对提高对利益相关者的响应能力的学说，我对此感到恼火。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-06T13:06:02.063

如果您想执行严格的 Scrum 驱动开发 - 那么中期 sprint 部署是异端。在我看来，这是一种严格的 scrum 方法，而不是用于场景的最佳工具。我会使用一种更经典的方法，您可以在其中定义部署包和指定给它们的任务。您在单个主干上开发，如果给定部署包的所有任务都已完成 - 您部署它。但请注意代码和项目中的约束。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-06T13:09:17.283

你可以看看 Alistair Cockburn Crystal “Orange Web” 方法。他将敏捷原则与公共网站的限制相结合。

# java - Apache-Ant1.6.5 中 build.xml 文件的疑问

> ID：520168
> 
> 赞同：0
> 
> 时间：2009-02-06T12:53:23.680
> 
> 标签：java

我在我的代码中使用了泛型集合。当尝试在 build.xml 中编译该 java 文件时，它在泛型处显示错误并且它说它不是一个语句。我正在使用 Apache-Ant-1.6.5，并且我只安装了 JDK 1.5。我知道通用将在 jdk1.5 中支持，但它显示错误。以下是我收到的代码错误

代码 ：

```
Map<String, String> inputconfigmap = 
    new LinkedHashMap<String, String>(); 
```

例外 ：

```
compile:
    [mkdir] Created dir: D:\GenericPreProcessor\Source\classes
    [javac] Compiling 49 source files to D:\GenericPreProcessor\Source\classes
    [javac] D:\GenericPreProcessor\Source\src\com\dnb\genericpreprocessor\fileprocessor\FixedLength
FileProcessor.java:187: not a statement
    [javac] Map<String, String> inputconfigmap = 
                new LinkedHashMap<String, String>(); 
```

* * *

我按照你的建议做了，但我在控制台中得到了以下内容。

**Console :**
D:\GenericPreProcessor\Source>ant
Buildfile: build.xml
[echo] JVM版本是1.5
[echo] 目标编译是${ant.build.javac.target}

clean:
[delete] 删除目录 D:\GenericPreProcessor\Source\classes

清洁罐：

compile:
[mkdir] Created dir: D:\GenericPreProcessor\Source\classes
[javac] 将 49 个源文件编译到 D:\GenericPreProcessor\Source\classes
[javac] javac: invalid target release: 1.5
[javac] Usage: javac
[javac ] 其中可能的选项包括：
[javac] -g 生成所有调试信息
[javac] -g:none 不生成调试信息
[javac] -g:{lines,vars,source} 仅生成一些调试信息
[javac] -nowarn 生成no warnings
[javac] -verbose 输出有关编译器正在做什么的消息
[javac] -deprecation 使用已弃用 API 的输出源位置
[javac] -classpath 指定查找用户类文件的
位置 [javac] -sourcepath 指定查找输入源文件
的位置 [javac] -bootclasspath 覆盖引导类文件的位置
[javac ] -extdirs 覆盖已安装扩展的位置
[javac] -d 指定放置生成的类文件的位置
[javac] -encoding 指定源文件使用的字符编码
[javac] -source 提供与指定版本的源兼容性
[javac] -target 生成类特定 VM 版本的文件
[javac] -help 打印标准选项的概要

构建失败

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-06T13:10:53.520

您是否尝试过为您的[javac](http://ant.apache.org/manual/Tasks/javac.html)任务显式设置`source`和`target`属性？

```
<target name="compile">
    <javac .....
        source="1.6"
        target="1.6" />
</target> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-06T13:00:58.970

也许您可以使用以下命令检查编译器的版本：

```
<echo>JVM version is ${ant.java.version}</echo>
<echo>Target compilation is ${ant.build.javac.target}</echo> 
```

您可以添加`<property name="ant.build.javac.target" value="1.5" />`强制编译器使用 Java 5 合规性...此属性是 ant 1.7 的默认目标，对于 ant 1.6，我认为您必须添加`target="${ant.build.javac.target}"`到您的 javac 目标。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-06T13:01:14.430

您需要定义地图的类型，即：

```
Map<String, String> inputconfigmap  = new LinkedHashMap<String, String>(); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-06T13:02:14.193

尝试

```
Map<?, ?> inputconfigmap = new LinkedHashMap<?, ?>(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-06T13:21:17.697

您是否使用双尖括号（<< 和 >>）？正如 kgiannakakis 所示，它们应该是单身：

```
Map<String, String> inputconfigmap  = new LinkedHashMap<String, String>(); 
```

# grails - 在 Grails/GORM 中定义默认排序顺序

> ID：520187
> 
> 赞同：16
> 
> 时间：2009-02-06T13:02:49.170
> 
> 标签：grails, grails-orm, gsp

假设我使用 GORM 定义了一个用户对象。每个用户可以有零个或多个 Login:s。每个登录都有一个时间戳。检索 user.logins 时，我希望根据 login.date 的值对登录进行排序。实现这一目标的正确 Grails 方法是什么？

示例：我希望以下代码按升序列出所有用户的登录信息。

```
<g:each var="login" in="${user.logins}">
  <tr>
    <td>${login.date}</td>
  </tr>
</g:each> 
```

这些是引用的类：

```
class User {
  ...
  def hasMany = [logins: Login]
  static fetchMode = [logins: "eager"]
}

class Login {
  Date date
  ...
  def belongsTo = [User]
} 
```

我正在运行 Grails 1.0.4，它是最新的稳定版本。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-05-27T22:31:16.237

他们在参考指南（第 5 节）的 GORM 页面上展示了如何执行此操作。您想要的位在该文档的底部附近是您想要的部分。他们有两个简单的例子：

```
class Airport {
    …
    static mapping = {
        sort "name"
    }
}

class Airport {
    …
    static mapping = {
        sort name:"desc"
    }
} 
```

他们还有一个对关联进行排序的示例：

```
class Airport {
    …
    static hasMany = [flights:Flight]
    static mapping = {
        flights sort:'number'
    }
} 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-02-06T13:42:48.683

只需让 Login 类实现 Comparable 接口：

```
class Login implements Comparable {

    // ...

    Date date

    public int compareTo(def other) {
        return date <=> other?.date // <=> is the compareTo operator in groovy
    }

} 
```

并将关系声明为 SortedSet：

```
class User {
  ...
  def hasMany = [logins: Login]               
  SortedSet logins

  static fetchMode = [logins: "eager"]
} 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-10T18:23:16.777

Grails/GORM 中默认排序顺序的处理似乎在 Grails 1.1 中得到了彻底的简化：

*   [Grails 1.1 发行说明](http://www.grails.org/1.1+Release+Notes)（搜索“默认排序顺序”）

# wpf - 在 XAML 样式中，如何将纯色背景更改为渐变？

> ID：520190
> 
> 赞同：40
> 
> 时间：2009-02-06T13:03:18.967
> 
> 标签：wpf, xaml, styles

我有一个 MainResources.xaml 文件，其中我的样式定义了我的应用程序中每个窗口的外观：

```
 <Style x:Key="MainBorderStyle" TargetType="{x:Type Border}">
    <Setter Property="Background" Value="WhiteSmoke" />
    <Setter Property="BorderBrush" Value="LightGray" />
    <Setter Property="BorderThickness" Value="1" />
    <Setter Property="CornerRadius" Value="5" />
    <Setter Property="SnapsToDevicePixels" Value="True" />
  </Style> 
```

而不是“WhiteSmoke”，我希望我的背景是这个渐变：

```
 <LinearGradientBrush>
        <GradientStop Color="#ccc" Offset="0"/>
        <GradientStop Color="#bbb" Offset="1"/>
    </LinearGradientBrush> 
```

但是以下尝试导致 VS2008 告诉我“样式设置器不支持子元素”：

```
<Style x:Key="MainBorderStyle" TargetType="{x:Type Border}">
    <Setter Property="Background">
        <LinearGradientBrush>
            <GradientStop Color="#ccc" Offset="0"/>
            <GradientStop Color="#bbb" Offset="1"/>
        </LinearGradientBrush>
    </Setter>
    <Setter Property="BorderBrush" Value="LightGray" />
    <Setter Property="BorderThickness" Value="1" />
    <Setter Property="CornerRadius" Value="5" />
    <Setter Property="SnapsToDevicePixels" Value="True" />
</Style> 
```

将渐变颜色作为这种样式的背景的正确方法是什么？

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2009-02-06T13:07:12.047

你错过了`<Setter.Value>`

```
<Style ...> 
   <Setter Property="...">
      <Setter.Value>
         <LinearGradientBrush />
      </Setter.Value>
   </Setter>
</Style> 
```

# perl - 如何检查文件句柄是否在 Perl 中打开？

> ID：520196
> 
> 赞同：34
> 
> 时间：2009-02-06T13:04:36.263
> 
> 标签：perl, file-io, filehandle

有没有办法检查文件是否已经在 Perl 中打开？我想要读取文件访问权限，所以不需要`flock`.

```
 open(FH, "<$fileName") or die "$!\n" if (<FILE_IS_NOT_ALREADY_OPEN>);
 #  or something like
 close(FH) if (<FILE_IS_OPEN>); 
```

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-02-06T13:09:06.193

请参阅关于[from的](https://stackoverflow.com/a/5993224/47529)[答案`openhandle()``Scalar::Util`](https://stackoverflow.com/a/5993224/47529)。我最初在这里写的答案曾经是我们能做的最好的，但现在已经严重过时了。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2011-05-13T14:14:48.673

[Scalar::Util](http://search.cpan.org/%7Epevans/Scalar-List-Utils-1.27/lib/Scalar/Util.pm)模块[`openhandle()`](http://perldoc.perl.org/Scalar/Util.html#openhandle)为此提供了功能。与[fileno()](http://perldoc.perl.org/functions/fileno.html)不同，它处理与操作系统文件句柄无关的 perl 文件句柄。与[tell()](http://perldoc.perl.org/functions/tell.html)不同，它在未打开的文件句柄上使用时不会产生警告来自模块的[文档](http://perldoc.perl.org/Scalar/Util.html#openhandle)：

> 开口手柄 FH
> 
> ```
> Returns FH if FH may be used as a filehandle and is open, or FH is a tied handle. Otherwise "undef" is returned.
> 
>    $fh = openhandle(*STDIN);           # \*STDIN
>    $fh = openhandle(\*STDIN);          # \*STDIN
>    $fh = openhandle(*NOTOPEN);         # undef
>    $fh = openhandle("scalar");         # undef 
> ```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-02-06T13:16:15.430

你为什么想这么做？我能想到的唯一原因是当您使用旧式包文件句柄（您似乎正在这样做）并希望防止意外地将一个句柄保存在另一个句柄上时。

该问题可以通过使用新样式的间接文件句柄来解决。

```
open my $fh, '<', $filename or die "Couldn't open $filename: $!"; 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-02-06T19:57:29.347

Perl正是为此目的提供了[fileno函数。](http://perldoc.perl.org/functions/fileno.html)

**编辑**我站在纠正的目的`fileno()`。我更喜欢较短的测试

`fileno FILEHANDLE`

超过

`tell FH != -1`

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-02-09T21:37:09.830

`use warnings`Tell 使用(-w)生成警告（stat、-s、-e 等也是如此）

```
perl -wle '
    open my $fh, "<", "notexists.txt"; 
    print "can stat fh" if tell $fh
'
tell() on closed filehandle $fh at -e line 1.
-1 
```

替代品`fileno($fh)`并`eof($fh)`不会产生警告。我发现最好的选择是将输出从`open`.

# xml - 如何在 SQL Server 2005 上使用 XQuery 从 XML 中删除所有注释？

> ID：520199
> 
> 赞同：0
> 
> 时间：2009-02-06T13:05:44.857
> 
> 标签：xml, xquery

我可以通过以下方式轻松地从 XML 中选择所有注释

```
select @XML.query('comment()') 
```

但找不到如何删除它们。@XML.modify('delete ...') 有合适的语法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-06T13:29:30.160

```
set @XML.modify('delete comment()')
select @XML 
```

这里是。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T13:42:57.637

也许本文为您提供了 [使用 SQL Server 2005 提高 XML 更新性能的解决方案](http://www.15seconds.com/issue/050818.htm)

```
UPDATE Store SET Demographics.modify('delete //newnode') WHERE CustomerID = @custid 
```

# python - Python在哪里使用？我在 Reddit 上读了很多

> ID：520210
> 
> 赞同：8
> 
> 时间：2009-02-06T13:08:13.247
> 
> 标签：python

我已经下载了 Pyscripter 并学习了 Python。但我不知道它是否有任何工作价值，尤其是在印度。我正在学习 Python 作为一种爱好。但如果知道印度是否需要 Python 程序员，那将是令人欣慰的。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-06T13:12:56.590

到处。它[被谷歌广泛](http://panela.blog-city.com/python_at_google_greg_stein__sdforum.htm)使用。

有关更多信息，请参阅[python 软件列表](http://en.wikipedia.org/wiki/Python_software)，以及[谁在网络上使用 python？](http://www.python.org/doc/essays/ppt/www8-py-www/sld010.htm)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-06T13:16:37.723

在许多大公司中，它是一种主要的脚本语言。Google 将它与 Java 和 C++ 一起使用，几乎没有其他任何东西。还有许多网页是建立在 python 和 Django 之上的。另一个地方是游戏开发。许多游戏的引擎都是用 C++ 编写的，但所有逻辑都是用 Python 编写的。

换句话说，它是最有价值的工具之一。

这也可能对您感兴趣：

*   [Python 适合大型软件项目（不是基于 Web 的）吗？](https://stackoverflow.com/questions/35753/is-python-good-for-big-software-projects-not-web-based)
*   [我不应该使用 Python 有什么好的理由吗？](https://stackoverflow.com/questions/371966/are-there-any-good-reasons-why-i-should-not-use-python)
*   [你用什么自学python？](https://stackoverflow.com/questions/111857/what-did-you-use-to-teach-yourself-python)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-06T13:14:47.600

它绝对具有工作价值。例如谷歌需要它。看看[谷歌在印度的职位空缺](http://www.google.co.in/support/jobs/bin/topic.py?dep_id=1054&loc_id=1100&topic=1054)：

> 至少具有以下一种语言的优秀编程技能：C、C++、Java 或 Python（首选 C++/Python）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-06T13:13:10.803

[不确定印度，但您可以在此处](http://www.python.org/community/jobs/)的 python.org 工作页面上获得有关可用 Python 工作的完整概述。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-06T13:16:35.680

尝试查看 Mark Pilgrim 的优秀书籍“ [Dive Into Python](http://www.diveintopython.org/) ”，该书可根据 GNU 自由文档许可证下载。

高温高压

干杯，

抢

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-06T13:20:40.273

在 10 年的 web 开发中，我有一个客户让我用它编写一个电子邮件解析应用程序。并不是说它没有被使用，而是我在野外更经常地看到 Ruby/php/.net。

编辑：如果您计划在 Google 工作，从其他帖子中，这听起来像是要学习的语言 - 哈哈！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-06T13:58:54.877

这只是一个例子，但我知道它广泛用于拥有高科技机器的大型科研机构，非程序员（通常是物理学家）需要快速原型或工具来满足他们的数据收集/处理需求。易于访问的脚本语言方面显然在这里发挥了作用。所以我不知道仅仅以此为基础建立职业，但我肯定会说，了解 Python 是你简历中非常有价值的资产，它会增强你的“有用性”。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-09-04T16:18:16.337

谷歌应用引擎允许您使用 python（或 Java）。我强烈建议您检查一下。如果你想拥有一个使用 python 的带有数据库的免费网站（实际上是一个数据存储，但它的工作原理很像一个数据库），这就是它。它也扩大了规模。如果您开始获得足够的流量，您将不得不开始为其所需的使用付费。

[http://code.google.com/appengine/docs/python/overview.html](http://code.google.com/appengine/docs/python/overview.html)

您可以制作自己的基于 python 的网站并投放一些广告。瞧，赚点钱。另外，我相信谷歌可能会对一些好的 python 印象深刻，因为我听说他们在自己的网站上使用它。

# sql-server - 禁用 SQL2008 结果集中的消息

> ID：520220
> 
> 赞同：4
> 
> 时间：2009-02-06T13:10:32.587
> 
> 标签：sql-server, sql-server-2008, dataset, messages

除了[这](https://stackoverflow.com/questions/483787/is-there-a-bug-in-sqldatareader-hasrows-when-running-against-sql-server-2008 "这些") [两个](https://stackoverflow.com/questions/197220/sqldatareader-hasrows-returns-false-since-sql-2008-upgrade)问题，有没有办法禁用可能与 SQL2008 中的结果集一起发送的消息？

（请注意，这与 ANSI_WARNINGS 设置无关。**或 NOCOUNT**。）

谢谢你的帮助。

编辑：兼容性设置或表所有者不是问题。**这与 NOCOUNT 无关**。相信我。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-21T18:01:24.957

不，没有办法禁用与结果集一起发送的所有消息。设置 nocount on/off 对这些类型的消息没有影响。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T13:08:03.883

无论如何，您都需要在 Sproc 的主体中使用 NOCOUNT（我感谢您在有无的情况下都对其进行了测试）

在这种情况下，我得到了对 Sproc 的实际调用（从我的 APP 中的 Debug 或使用 SQL Profiler），然后将其插入 SSMS 或您使用的任何 IDE，将其包装在 ROLLBACK 事务中（所以它不能不小心做出任何更改）。注意：使用您的 IDE 登录到 SQL Server，使用与应用程序将使用的凭据相同的凭据。

```
BEGIN TRANSACTION
EXEC StaffEnquirySurnameSearch @searchterm = 'FOOBAR'
ROLLBACK 
```

看看你得到了什么。使用 TEXT 模式进行输出，而不是可能隐藏某些内容的 GRID 模式

只是为了展示我认为应该如何将 NOCOUNT 添加到您的 SProc 中：

```
CREATE PROCEDURE StaffEnquirySurnameSearch
    @searchterm varchar(255)
AS

SET NOCOUNT ON

SELECT  AD.Name, AD.Company, AD.telephoneNumber, AD.manager, CVS.Position,
    CVS.CompanyArea, CVS.Location, CVS.Title, AD.guid AS guid,
    AD.firstname, AD.surname
FROM ADCVS AD
LEFT OUTER JOIN CVS ON
    AD.Guid=CVS.Guid 
WHERE AD.SurName LIKE @searchterm
ORDER BY AD.Surname, AD.Firstname
GO 
```

我注意到您没有在表前加上数据库所有者（最常见的是“dbo”），这可能意味着任何人都拥有额外的副本，并且从应用程序权限的角度来看它们是默认的，尽管我没有不认为这会改变结果集 [在 SQL 版本之间]，但是，同样的事情适用于 Sproc 的所有权，并且您可能会调用一些早期版本，为不同的所有者创建。

同上，您的 Sproc 名称在您的 ASP.NET 代码中定义（我似乎无法在您的链接问题中找到）也应该定义所有者，即

```
EXEC dbo.StaffEnquirySurnameSearch @searchterm = 'FOOBAR' 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T13:14:59.810

从 SQL 2000 升级到 2008 时是否更改了兼容级别？如果它是某种可能治愈它的向后兼容性警告消息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T23:15:12.847

您是否尝试过不使用“OR”运行相同的 CONTAINS 查询？

IE：

```
SELECT * FROM my_table
WHERE CONTAINS(my_column, 'a monkey')  -- "a" is a noise word 
```

代替

```
SELECT * FROM my_table
WHERE CONTAINS(my_column, 'a OR monkey')  -- "a" is a noise word 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-24T04:05:42.943

您可以将其包装在 try catch... 在线书籍中的更多信息

例如：

创建表 Test_ShortString(

```
ShortString varchar(10) NULL 
```

)

开始尝试

```
insert into 
Test_ShortString (ShortString) 
values ('123456789012345') 
```

结束尝试

开始抓

```
--Select Error_Number() as ErrorNumber 
```

结束捕获

# model-view-controller - 与 Drupal 相比，使用 MVC 框架构建大型网站有哪些优势？

> ID：520225
> 
> 赞同：9
> 
> 时间：2009-02-06T13:11:20.073
> 
> 标签：model-view-controller, drupal, frameworks, content-management-system

我正在对构建我们的新网站的 3 种技术选项进行比较：

*   WordPress
*   德鲁巴
*   一个 MVC 框架

老板肯定我们应该使用 Wordpress，但是网站会很大，有很多版块、子版块、页面和复杂的模板。

我发现比较 WP + Drupal 很容易，但要说明使用 MVC 框架的额外优势（相对于 Drupal）并不容易。

到目前为止，我有：

*   自定义数据存储、内容类型、语义
*   API / REST
*   逻辑/UI分离
*   约定、代码结构

（显然，根据项目的类型，一些好处会有所不同。在这种情况下，它将成为博物馆的大型门户，为参观者提供一些社交活动的潜力）

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-02-06T14:08:34.170

很难将 CMS（例如 Drupal、WordPress）与 MVC 框架进行比较，因为它们属于不同的类别。

为了具体回答您关于 MVC 框架相对于 CMS 的优势的问题，MVC 框架的优势在于它允许您从头开始设计您需要的确切 Web 应用程序。

至于你的具体情况：

使用现有的 CMS，如 WordPress 或 Drupal，如果它们满足您的需求，将是一个绝妙的主意。它避免了重新发明轮子，节省了您的时间，并且 CMS 可以非常用户友好（在不同程度上）。如果您打算将内容更新的任务委派给非技术用户，那么明智的做法可能是选择对新手友好的 CMS，而不是使用 MVC 框架自行开发，这可能会导致应用程序需要更多的技术专长才能完成维持。

但是，如果您设想网站需要大量自定义业务逻辑，而这些逻辑在 CMS 的约束下难以实现，那么您可能需要使用 MVC 框架。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-17T13:05:50.970

谢谢大家的回答。我提出了使用框架或 Drupal 的案例，但决定我们应该使用 Wordpress，或者至少开始在 Wordpress 上构建，看看它是如何进行的。

FWIW 这里是我想出的笔记：

## WordPress / 亩

[http://wordpress.org/](http://wordpress.org/) [http://mu.wordpress.org/](http://mu.wordpress.org/)

个人发布工具、博客平台

*   PHP +
*   许多可用的小部件 +
*   多作者支持/工作流程 +
*   社交功能（BuddyPress）+
*   集成（BBPress 等）+
*   简单，常见 +
*   简单的用户界面 +
*   能够管理多个博客（使用 WordPress MU）+
*   只有 2 种内容类型（帖子或页面）-
*   不是真正的“CMS”/博客心态——
*   不灵活的继承（没有部分） -
*   有限的语义 -
*   作者的模板选择有限 -
*   乱码——
*   安全/漏洞利用 -

## 德鲁巴

[http://drupal.org/](http://drupal.org/)

内容管理框架、CMS 构建工具包、构建站点的工具。为“非程序员”构建网站，构建块

*   PHP +
*   专为大型网站/门户网站 +
*   内置社交功能（每个用户都有自己的个人资料/日志，可扩展）+
*   作者的页面类型选择/配置（块系统）+
*   结构化数据/语义的范围 +
*   多种内容类型（新闻稿、新闻文章、博客文章等）+
*   良好的社区/工具 +
*   空白画布 +
*   多种功能 +
*   良好的图像处理 +
*   复杂的用户界面 -
*   “黑盒子”，很抽象的代码，学习曲线！-
*   定制/主题化很困难 -

## 框架

它允许您从头开始设计您需要的确切网络应用程序

*   可扩展 +
*   语义控制、数据存储+
*   API / 数据 / REST / Web 服务 +
*   当前，现代工具，尖端 +
*   逻辑/表示分离（MVC设计模式）+
*   约定 - 结构化代码、工作流 +
*   重用/组合内容 +
*   允许开发多个 UI，而无需触及业务逻辑代码库 +
*   强大的 API / 标准 / 模式 +
*   DRY（不要重复自己）+
*   学习曲线 -
*   需要设计自定义 UI -
*   矫枉过正？（取决于目标）-

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-06T13:15:58.283

您无法真正比​​较 WP 或 Drupal 和 MVC 框架。您*可以*做的是决定是使用现有的内容管理系统还是推出自己的内容管理系统并比较 ROI、TCO、开发成本等。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-06T15:40:30.443

作为在过去十年的大部分时间里从事各种家庭滚动 CMS 系统工作的人，我的建议是不要自己滚动。如果您有一些独特的应用程序，那么 MVC 是编写 Web 应用程序的好方法，但它的简便性无法抵消数千小时的构建和数百万次测试 OSS 的页面点击量。

Drupal 不仅是一个不错的 CMS 系统，而且还是一个非常好的构建定制 Web 功能的框架，因此您可以免费获得很多东西，并且只需要花时间处理您网站的独特之处。（在你学会了如何在 drupal 系统上编码之后）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-06T13:36:57.197

您可以基于 WP 或 Drupal 构建一个可扩展的站点，但您可能会遇到基于框架设计用途的设计限制。Drupal/WP 是核心的内容管理系统，所以如果你不管理内容，你就没有有效地使用框架。如果您发现自己构建越来越多的代码来绕过这些限制，那么您就有理由从头开始构建或使用轻量级框架。

我目前正在使用[CakePHP](http://www.cakephp.org) MVC 框架构建一个站点，我强烈推荐它。恕我直言，它满足了您的所有优势。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-08-05T20:07:27.120

Drupal 有 MVC 层，请查看 Drupal Prometheus @ [http://www.drupalprometheus.org](http://www.drupalprometheus.org)。它具有现代 MVC 框架的大部分功能以及 Drupal CMS 的强大功能。我们最近开始在我们客户的一个项目中使用它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-06T13:21:08.603

Microsoft ASP MVC（例如）是一个用于构建网站的框架，Drupal 是一个内容管理系统，您可以在其中“设计”页面但不必编写任何代码。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-06T13:54:04.247

CMS 的灵活性是有限制的，尽管 Drupal 的限制越来越小。有一个学习曲线来完成你想要的，如果你不得不将它与现有的扩展一起捏造，它可能不是最优雅的解决方案。当然，您始终可以自己扩展任何 CMS 的功能，但这可能比一开始就使用一个好的框架需要更多的时间。

我最近也遇到了同样的困境，在尝试了 Drupal 之后，最终选择了 CodeIgniter MVC PHP 框架。可能值得先用 CMS 投资几天，以调查是否可能。如果您认为这太难了，请改用 MVC 框架。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-06T16:23:35.770

我会说使用 MVC 框架来推出自己的框架而不是使用 WP 或 Drupal 的优势是：

1.  您只需编写您需要的代码。WP 和 Drupal 将会有很多你不需要的东西放在你的服务器上。
2.  开发人员了解整个代码库，因为他们是从头开始编写的——这使得以后更容易维护。
3.  WP 是一个大型代码库（我不了解 Drupal），只要您需要任何 CMS 都不支持的东西，您就必须挖掘大量代码。
4.  Wordpress 的逻辑/用户界面分离很糟糕——我的意思是真的很糟糕。
5.  更大的灵活性。CMS 很棒，因为您不会试图让它们做一些他们不打算做的事情——然后它们就会变得很痛苦。

如果你要推动一个 MVC 框架，那么你需要仔细看看你会选择哪一个——它们不是生来平等的。其中一些会以与 CMS 相同的方式对您的代码和网站布局进行限制。

我想这真的取决于需求的复杂程度以及 CMS 或框架将如何满足这些需求。对于相对简单的内容交付，编写自己的轻量级 MVC 并在此基础上构建可能是一种选择。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-13T19:54:45.010

我强烈建议您不要使用 WordPress，这对于具有一些静态页面和一个博客/新闻部分的网站来说非常棒，但是我制作了一个基于 WP 2.2 的双语产品网站，它是一个主要的 PITA，有很多黑客和编写数据库访问代码到模板中以使其成为可能。

现在我一直在使用 Drupal 进行开发，它对于大型项目来说确实更好（尽管与 WP 相比，建立一个简单的博客需要更多的时间）——它具有出色的模块化架构，使我能够通过编写来解决迄今为止的任何请求/问题一个模块而不是破解核心。

至于 MVC/Drupal：看看 Drupal 做了什么，如果您可以通过修改 Drupal 来获得结果，那么它非常棒，并且不必编写通常的东西（用户注册、输入清理、健壮），从而为您节省*大量*时间表单处理和验证、主题化基础设施、存储抽象、Web 服务抽象层（服务模块）等等...）。

针对 Drupal：由于模块化（我正在渲染项目列表，让我们调用所有实现了 theme_list 的模块来确定是否要修改它）架构，本质上很慢，所以如果你正在制作下一个推特，请获得一个快速的 MVC取而代之的框架。并且注册用户的内容缓存仍然需要大量工作才能有效（标记缓存应该在核心中），因此用户通常登录时的站点可能会很慢。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2009-02-09T03:49:00.007

我认为 Drupal 是 MVC。Drupal 使用一个主题系统，即您的视图和一个菜单系统，即您的控制器。模块是您的模型。当然，菜单被分割成各种模块，但它仍然基本上是 MVC 对吗？

# javascript - ruby 是强类型还是弱类型？

> ID：520228
> 
> 赞同：30
> 
> 时间：2009-02-06T13:12:21.910
> 
> 标签：javascript, ruby, typing

ruby 是强类型还是弱类型？

Javascript 大概也是如此。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2009-02-06T14:10:03.263

Ruby 是“**强类型**”。

强类型是指在执行需要某种类型的操作之前检查对象的类型（不是 OOP 意义上的，而是一般意义上的）。

弱类型意味着不做任何检查来确保操作可以在对象上成功。（例如，当一个函数访问一个字符串和浮点数组时，如果没有进行类型检查，则允许该操作）

编辑：这个答案发布已经 6 年了，我认为它需要一些额外的澄清：

多年来，开始使用“类型安全性不是绝对值”的概念来支持二进制含义（是/否）

与大多数典型的动态语言相比，Ruby 的类型“更强”（带有“er”）。事实上，ruby 需要显式的语句来转换 IE: Array("foo"), "42".to_i, Float(23)，这使得 Ruby 打字拨盘比“弱类型”更接近“强类型”端.

所以我会说“Ruby 是一种比大多数常见动态语言更强大的类型化动态语言”

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-02-06T21:46:53.200

维基百科将其标记为“动态（'鸭子'）类型”。

关于波普关于它是“强类型”的评论——我不确定他的解释是否与幕后发生的事情相符。MRI 并没有真正“检查”是否可以对对象执行操作。它只是向对象发送消息，如果该对象不接受该消息（通过方法声明或在#method_missing 中处理它），它就会出错。如果运行时确实检查以确保操作是可能的，#method_missing 将不起作用。

另外，应该注意的是，由于 Ruby 中的一切都是对象（我的意思是*一切*），我不确定他所说的“不是 oo-sense”是准确的。在 Ruby 中，你要么是一个对象，要么是一条消息。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-02-06T14:06:22.740

虽然您*可以*就这些术语的定义争论不休，但我想说：

Ruby 是动态且强类型的，而 JavaScript 是动态且弱类型的。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-02-06T13:44:05.203

恕我直言 Ruby 是强但动态类型的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-06T13:39:38.003

我会考虑这些语言[鸭子类型](http://en.wikipedia.org/wiki/Duck_typing)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-06T13:16:01.687

过于简单的答案是 ruby​​ 和 javascript 都是弱类型的。

然而，这个问题并不像看起来那么明确——请参阅[这篇维基百科文章](http://en.wikipedia.org/wiki/Strongly-typed_programming_language)，以更深入地讨论强类型语言和弱类型语言之间的区别。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-01-10T15:30:12.720

我只是偶然发现了这个旧线程，但认为我可以提出我的意见是正确的。*（不，我不是在“劫持”僵尸线程。）*

*我对术语**“强类型™”*的通俗解释特指***“编译*时间”。**（这是当今许多语言（包括 Ruby）“根本没有的”。）

例如，一个简单的赋值语句，如*编译器*可以根据它对 and 的“类型”的评估，以及程序员提供的类型转换规定*（如果适用）*`a = b;`来判断是否可以接受。如果该语句被判断为不可接受，则会引发编译时错误，并且不会产生“可执行文件”。*`a``b`*

 **当然，这个概念与诸如 Ruby、PHP、Perl、JavaScript 等语言的基本设计准则或当今广泛使用（并且非常成功）的许多其他语言不兼容。（请注意，我并不是说这是支持或反对他们的“判断”。他们就是他们，他们肯定会把培根带回家。）

因为这些语言没有“编译时间”，就我的（！）俗语来说，它们不能被称为“强类型”。他们有义务*在运行时*做出决定，根据他们的设计，这些决定不可能更早做出。

* * *

（另外请注意，我特别排除`lint`了为这种或那种语言而出现的各种“工具”，以便提前捕获更多错误。这些非常有用，是的，但不是一回事。 )

（出于同样的原因，我还特意排除了各种优秀的（！）工具，这些工具可以*生成*各种目标语言的源代码......出于同样的原因。）

而且——我再说一遍——我是在做一个*分类，*而不是一个*判断。*

# html - 我还应该使用 html 实体吗？为什么？

> ID：520236
> 
> 赞同：24
> 
> 时间：2009-02-06T13:13:56.307
> 
> 标签：html, utf-8, character-encoding

HTML 实体仍然有用还是我应该简单地创建 UTF-8 编码的 html 文档？请解释原因。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-02-06T13:30:26.510

如果编码设置正确（并且文档保存为 UTF-8），您应该能够只使用字符。来自 W3C：

> 使用 UTF-8 之类的编码意味着您可以避免大多数转义，而只使用字符。

[http://www.w3.org/International/questions/qa-escapes](http://www.w3.org/International/questions/qa-escapes)

但是，对于大于/小于等特殊字符，您仍然需要使用实体。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-06T14:30:39.773

实体在程序源代码文件中（在输出 HTML 的程序中）很有用。许多编码标准说，文件应该是纯 ASCII。当然，实际包含文本内容的文件除外——例如带有翻译的 .po 文件。

当您的文件很长，其中几乎没有非 ASCII 字符时，很容易以错误的编码保存文件，而不会注意到您的字符被搞砸了。

使用非 ASCII 字符的另一个好理由是外观相似的字符。你能看出下面两行代码的区别吗：

```
print "<title>" + pagename + " – " + sitename + "</title>";
print "<title>" + pagename + " - " + sitename + "</title>"; 
```

但是通过使用实体，区别是显而易见的：

```
print "<title>" + pagename + " &ndash; " + sitename + "</title>";
print "<title>" + pagename + " - " + sitename + "</title>"; 
```

但是在程序源代码文件之外，UTF-8 显然是要走的路。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-06T13:31:06.600

根据我的经验，只要您的数据确实是 UTF-8 并且您正确地告诉浏览器它是 UTF-8，那么您就不需要使用实体。除了 >, <, " 之类的东西 当然。

# php - 如何在 30 分钟后使 PHP 会话过期？

> ID：520237
> 
> 赞同：1134
> 
> 时间：2009-02-06T13:14:14.497
> 
> 标签：php, session, cookies

我需要让会话保持 30 分钟，然后将其销毁。

* * *

## 回答 #1

> 赞同：1744
> 
> 时间：2009-08-13T09:24:39.330

您应该实现自己的会话超时。其他人提到的两个选项（[*session.gc_maxlifetime*](http://php.net/manual/en/session.configuration.php#ini.session.gc-maxlifetime)和[*session.cookie_lifetime*](http://php.net/manual/en/session.configuration.php#ini.session.cookie-lifetime)）都不可靠。我将解释其中的原因。

**第一的：**

> **session.gc_maxlifetime**
> *session.gc_maxlifetime*指定数据将被视为“垃圾”并被清理的秒数。垃圾收集发生在会话开始期间。

[*但是垃圾收集器仅以session.gc_probability*](http://php.net/manual/en/session.configuration.php#ini.session.gc-probability)除以[*session.gc_divisor*](http://php.net/manual/en/session.configuration.php#ini.session.gc-divisor)的概率启动。并且使用这些选项的默认值（分别为 1 和 100），机会只有 1%。

好吧，您可以简单地调整这些值，以便更频繁地启动垃圾收集器。但是当垃圾收集器启动时，它会检查每个注册会话的有效性。这是成本密集型的​​。

此外，当使用 PHP 的默认[*session.save_handler*](http://php.net/manual/en/session.configuration.php#ini.session.save-handler)文件时，会话数据存储在[*session.save_path*](http://php.net/manual/en/session.configuration.php#ini.session.save-path)中指定的路径中的文件中。使用该会话处理程序，会话数据的年龄是根据文件的最后修改日期而不是最后访问日期计算的：

> **注意：**如果您使用默认的基于文件的会话处理程序，您的文件系统必须跟踪访问时间 (atime)。Windows FAT 不支持，因此如果您遇到 FAT 文件系统或任何其他时间跟踪不可用的文件系统，您将不得不想出另一种方法来处理垃圾收集您的会话。从 PHP 4.2.3 开始，它使用 mtime（修改日期）而不是 atime。因此，您不会遇到时间跟踪不可用的文件系统问题。

因此，还可能会出现会话数据文件被删除的情况，而会话本身仍然被认为是有效的，因为会话数据最近没有更新。

**第二：**

> **session.cookie_lifetime**
> *session.cookie_lifetime*以秒为单位指定发送到浏览器的 cookie 的生命周期。[…]

是的，这是正确的。这只会影响 cookie 的生命周期，并且会话本身可能仍然有效。但是使会话无效是服务器的任务，而不是客户端的任务。所以这没有任何帮助。事实上，将*session.cookie_lifetime*设置为`0`将使会话的 cookie 成为真正的[会话 cookie](http://en.wikipedia.org/wiki/HTTP_cookie#Session_cookie)，该 cookie 仅在浏览器关闭之前有效。

**结论/最佳解决方案：**

最好的解决方案是实现您自己的会话超时。使用一个简单的时间戳来表示最后一个活动（即请求）的时间，并在每个请求中更新它：

```
if (isset($_SESSION['LAST_ACTIVITY']) && (time() - $_SESSION['LAST_ACTIVITY'] > 1800)) {
    // last request was more than 30 minutes ago
    session_unset();     // unset $_SESSION variable for the run-time 
    session_destroy();   // destroy session data in storage
}
$_SESSION['LAST_ACTIVITY'] = time(); // update last activity time stamp 
```

使用每个请求更新会话数据也会更改会话文件的修改日期，以便垃圾收集器不会过早删除会话。

您还可以使用额外的时间戳定期重新生成会话 ID，以避免对[会话固定](http://www.owasp.org/index.php/Session_fixation)等会话的攻击：

```
if (!isset($_SESSION['CREATED'])) {
    $_SESSION['CREATED'] = time();
} else if (time() - $_SESSION['CREATED'] > 1800) {
    // session started more than 30 minutes ago
    session_regenerate_id(true);    // change session ID for the current session and invalidate old session ID
    $_SESSION['CREATED'] = time();  // update creation time
} 
```

**笔记：**

*   `session.gc_maxlifetime`应至少等于此自定义过期处理程序的生命周期（本例中为 1800）；
*   如果您想在*活动*30 分钟后而不是在*start* 30 分钟后使会话过期，您还需要使用`setcookie`with expire of`time()+60*30`来保持会话 cookie 处于活动状态。

* * *

## 回答 #2

> 赞同：150
> 
> 时间：2011-09-13T06:39:12.767

## PHP会话在30分钟内到期的简单方法。

注意：如果您想更改时间，只需将 30 更改为您想要的时间，不要更改 * 60：这将给出分钟。

* * *

以分钟为单位：(30 * 60)
以天为单位：(n * 24 * 60 * 60) n = 天数

* * *

## 登录.php

```
<?php
    session_start();
?>

<html>
    <form name="form1" method="post">
        <table>
            <tr>
                <td>Username</td>
                <td><input type="text" name="text"></td>
            </tr>
            <tr>
                <td>Password</td>
                <td><input type="password" name="pwd"></td>
            </tr>
            <tr>
                <td><input type="submit" value="SignIn" name="submit"></td>
            </tr>
        </table>
    </form>
</html>

<?php
    if (isset($_POST['submit'])) {
        $v1 = "FirstUser";
        $v2 = "MyPassword";
        $v3 = $_POST['text'];
        $v4 = $_POST['pwd'];
        if ($v1 == $v3 && $v2 == $v4) {
            $_SESSION['luser'] = $v1;
            $_SESSION['start'] = time(); // Taking now logged in time.
            // Ending a session in 30 minutes from the starting time.
            $_SESSION['expire'] = $_SESSION['start'] + (30 * 60);
            header('Location: http://localhost/somefolder/homepage.php');
        } else {
            echo "Please enter the username or password again!";
        }
    }
?> 
```

## 主页.php

```
<?php
    session_start();

    if (!isset($_SESSION['luser'])) {
        echo "Please Login again";
        echo "<a href='http://localhost/somefolder/login.php'>Click Here to Login</a>";
    }
    else {
        $now = time(); // Checking the time now when home page starts.

        if ($now > $_SESSION['expire']) {
            session_destroy();
            echo "Your session has expired! <a href='http://localhost/somefolder/login.php'>Login here</a>";
        }
        else { //Starting this else one [else1]
?>
            <!-- From here all HTML coding can be done -->
            <html>
                Welcome
                <?php
                    echo $_SESSION['luser'];
                    echo "<a href='http://localhost/somefolder/logout.php'>Log out</a>";
                ?>
            </html>
<?php
        }
    }
?> 
```

## 登出.php

```
<?php
    session_start();
    session_destroy();
    header('Location: http://localhost/somefolder/login.php');
?> 
```

* * *

## 回答 #3

> 赞同：46
> 
> 时间：2009-02-06T13:20:53.033

这是在设定时间后注销用户吗？在注册时设置会话创建时间（或到期时间），然后检查每个页面加载是否可以处理该问题。

例如：

```
$_SESSION['example'] = array('foo' => 'bar', 'registered' => time());

// later

if ((time() - $_SESSION['example']['registered']) > (60 * 30)) {
    unset($_SESSION['example']);
} 
```

**编辑：**我觉得你的意思是别的。

[`session.gc_maxlifetime`](http://uk3.php.net/manual/en/session.configuration.php#ini.session.gc-maxlifetime)您可以使用ini 设置在某个生命周期后取消会话：

**编辑：** ini_set('session.gc_maxlifetime', 60*30);

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2014-10-07T02:31:46.627

这篇文章展示了几种控制会话超时的方法：http: [//bytes.com/topic/php/insights/889606-setting-timeout-php-sessions](http://bytes.com/topic/php/insights/889606-setting-timeout-php-sessions)

恕我直言，第二个选项是一个不错的解决方案：

```
<?php
/***
 * Starts a session with a specific timeout and a specific GC probability.
 * @param int $timeout The number of seconds until it should time out.
 * @param int $probability The probablity, in int percentage, that the garbage 
 *        collection routine will be triggered right now.
 * @param strint $cookie_domain The domain path for the cookie.
 */
function session_start_timeout($timeout=5, $probability=100, $cookie_domain='/') {
    // Set the max lifetime
    ini_set("session.gc_maxlifetime", $timeout);

    // Set the session cookie to timout
    ini_set("session.cookie_lifetime", $timeout);

    // Change the save path. Sessions stored in teh same path
    // all share the same lifetime; the lowest lifetime will be
    // used for all. Therefore, for this to work, the session
    // must be stored in a directory where only sessions sharing
    // it's lifetime are. Best to just dynamically create on.
    $seperator = strstr(strtoupper(substr(PHP_OS, 0, 3)), "WIN") ? "\\" : "/";
    $path = ini_get("session.save_path") . $seperator . "session_" . $timeout . "sec";
    if(!file_exists($path)) {
        if(!mkdir($path, 600)) {
            trigger_error("Failed to create session save path directory '$path'. Check permissions.", E_USER_ERROR);
        }
    }
    ini_set("session.save_path", $path);

    // Set the chance to trigger the garbage collection.
    ini_set("session.gc_probability", $probability);
    ini_set("session.gc_divisor", 100); // Should always be 100

    // Start the session!
    session_start();

    // Renew the time left until this session times out.
    // If you skip this, the session will time out based
    // on the time when it was created, rather than when
    // it was last used.
    if(isset($_COOKIE[session_name()])) {
        setcookie(session_name(), $_COOKIE[session_name()], time() + $timeout, $cookie_domain);
    }
} 
```

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2015-07-15T06:16:41.400

好吧，我明白上面的答案是正确的，但它们是在应用程序级别，我们为什么不简单地使用`.htaccess`文件来设置过期时间？

```
<IfModule mod_php5.c>
    #Session timeout
    php_value session.cookie_lifetime 1800
    php_value session.gc_maxlifetime 1800
</IfModule> 
```

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2009-02-06T13:21:09.337

```
if (isSet($_SESSION['started'])){
    if((mktime() - $_SESSION['started'] - 60*30) > 0){
        //Logout, destroy session, etc.
    }
}
else {
    $_SESSION['started'] = mktime();
} 
```

* * *

## 回答 #7

> 赞同：16
> 
> 时间：2016-05-13T12:43:13.373

使用该`session_set_cookie_params`功能来执行此操作。

在调用之前需要调用这个函数`session_start()`。

试试这个：

```
$lifetime = strtotime('+30 minutes', 0);

session_set_cookie_params($lifetime);

session_start(); 
```

查看更多： http: [//php.net/manual/function.session-set-cookie-params.php](http://php.net/manual/function.session-set-cookie-params.php)

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2014-01-24T08:40:46.290

使用如下函数实际上很容易。它使用带有字段“id”和“time”的数据库表名“sessions”。

每次用户再次访问您的站点或服务时，您都应调用此函数来检查其返回值是否为 TRUE。如果为 FALSE，则用户已过期，会话将被销毁（注意：此函数使用数据库类来连接和查询数据库，当然您也可以在函数中执行此操作或类似的操作）：

```
function session_timeout_ok() {
    global $db;
    $timeout = SESSION_TIMEOUT; //const, e.g. 6 * 60 for 6 minutes
    $ok = false;
    $session_id = session_id();
    $sql = "SELECT time FROM sessions WHERE session_id = '".$session_id."'";
    $rows = $db->query($sql);
    if ($rows === false) {
        //Timestamp could not be read
        $ok = FALSE;
    }
    else {
        //Timestamp was read succesfully
        if (count($rows) > 0) {
            $zeile = $rows[0];
            $time_past = $zeile['time'];
            if ( $timeout + $time_past < time() ) {
                //Time has expired
                session_destroy();
                $sql = "DELETE FROM sessions WHERE session_id = '" . $session_id . "'";
                $affected = $db -> query($sql);
                $ok = FALSE;
            }
            else {
                //Time is okay
                $ok = TRUE;
                $sql = "UPDATE sessions SET time='" . time() . "' WHERE session_id = '" . $session_id . "'";
                $erg = $db -> query($sql);
                if ($erg == false) {
                    //DB error
                }
            }
        }
        else {
            //Session is new, write it to database table sessions
            $sql = "INSERT INTO sessions(session_id,time) VALUES ('".$session_id."','".time()."')";
            $res = $db->query($sql);
            if ($res === FALSE) {
                //Database error
                $ok = false;
            }
            $ok = true;
        }
        return $ok;
    }
    return $ok;
} 
```

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2015-05-21T11:20:50.050

在会话中存储时间戳

* * *

```
<?php    
$user = $_POST['user_name'];
$pass = $_POST['user_pass'];

require ('db_connection.php');

// Hey, always escape input if necessary!
$result = mysql_query(sprintf("SELECT * FROM accounts WHERE user_Name='%s' AND user_Pass='%s'", mysql_real_escape_string($user), mysql_real_escape_string($pass));

if( mysql_num_rows( $result ) > 0)
{
    $array = mysql_fetch_assoc($result);    

    session_start();
    $_SESSION['user_id'] = $user;
    $_SESSION['login_time'] = time();
    header("Location:loggedin.php");            
}
else
{
    header("Location:login.php");
}
?> 
```

现在，检查时间戳是否在允许的时间窗口内（1800 秒是 30 分钟）

```
<?php
session_start();
if( !isset( $_SESSION['user_id'] ) || time() - $_SESSION['login_time'] > 1800)
{
    header("Location:login.php");
}
else
{
    // uncomment the next line to refresh the session, so it will expire after thirteen minutes of inactivity, and not thirteen minutes after login
    //$_SESSION['login_time'] = time();
    echo ( "this session is ". $_SESSION['user_id'] );
    //show rest of the page and all other content
}
?> 
```

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2016-08-26T06:55:45.793

请在每个页面中加载的包含文件中使用以下代码块。

```
$expiry = 1800 ;//session expiry required after 30 mins
    if (isset($_SESSION['LAST']) && (time() - $_SESSION['LAST'] > $expiry)) {
        session_unset();
        session_destroy();
    }
    $_SESSION['LAST'] = time(); 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2020-05-31T20:45:41.873

PHP 处理会话的方式对于初学者来说是非常难以理解的。这可能会通过概述会话的工作方式来帮助他们： [会话如何工作（自定义会话处理程序）](https://www.sitepoint.com/writing-custom-session-handlers/)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2018-12-27T10:00:06.940

使用本课程 30 分钟

```
class Session{
    public static function init(){
        ini_set('session.gc_maxlifetime', 1800) ;
        session_start();
    }
    public static function set($key, $val){
        $_SESSION[$key] =$val;
    }
    public static function get($key){
        if(isset($_SESSION[$key])){
            return $_SESSION[$key];
        } else{
            return false;
        }
    }
    public static function checkSession(){
        self::init();
        if(self::get("adminlogin")==false){
            self::destroy();
            header("Location:login.php");
        }
    }
    public static function checkLogin(){
        self::init();
        if(self::get("adminlogin")==true){
            header("Location:index.php");
        }
    }
    public static function destroy(){
        session_destroy();
        header("Location:login.php");
    }
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2020-11-13T08:57:43.023

这让我大开眼界，克里斯托弗·克莱默 2014 年在 [https://www.php.net/manual/en/session.configuration.php#115842上写的](https://www.php.net/manual/en/session.configuration.php#115842)

> 在 debian（基于）系统上，在运行时更改 session.gc_maxlifetime 没有实际效果。Debian 通过设置 session.gc_probability=0 来禁用 PHP 自己的垃圾收集器。相反，它每 30 分钟运行一次 cronjob（参见 /etc/cron.d/php5），用于清理旧会话。这个 cronjob 基本上会查看您的 php.ini 并使用 session.gc_maxlifetime 的值来决定要清理哪些会话（请参阅 /usr/lib/php5/maxlifetime）。[...]

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-03-21T10:40:05.310

使用时间戳...

```
<?php
if (!isset($_SESSION)) {
    $session = session_start();
} 
if ($session && !isset($_SESSION['login_time'])) {
    if ($session == 1) {
        $_SESSION['login_time']=time();
        echo "Login :".$_SESSION['login_time'];
        echo "<br>";
        $_SESSION['idle_time']=$_SESSION['login_time']+20;
        echo "Session Idle :".$_SESSION['idle_time'];
        echo "<br>";
    } else{
        $_SESSION['login_time']="";
    }
} else {
    if (time()>$_SESSION['idle_time']){
        echo "Session Idle :".$_SESSION['idle_time'];
        echo "<br>";
        echo "Current :".time();
        echo "<br>";
        echo "Session Time Out";
        session_destroy();
        session_unset();
    } else {
        echo "Logged In<br>";
    }
}
?> 
```

**我使用 timestamp 用了 20 秒使会话过期**。

如果您需要 30 分钟，请添加 1800（以秒为单位的 30 分钟）...

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2019-03-29T05:39:22.380

您可以直接使用数据库来代替它。我使用一个 DB 函数来做这件事，我称之为 chk_lgn。

检查登录检查以查看他们是否已登录，这样做时，它将检查的日期时间戳设置为用户数据库行/列中的最后一个活动。

我也在那里做时间检查。这暂时适用于我，因为我对每个页面都使用此功能。

PS 我见过的没有人建议过纯数据库解决方案。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-06-20T01:16:01.173

在这里你可以设置小时

```
$lifespan = 1800;
ini_set('session.gc_maxlifetime', $lifespan); //default life time 
```

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2020-01-24T08:42:04.347

只需存储当前时间，如果通过比较超过 30 分钟，则销毁当前会话。

# java - 如何计算两个向量的余弦相似度？

> ID：520241
> 
> 赞同：34
> 
> 时间：2009-02-06T13:15:35.307
> 
> 标签：java, vector, trigonometry, tf-idf

如何找到向量之间的余弦相似度？

我需要找到相似度来衡量两行文本之间的相关性。

例如，我有两个句子，例如：

> 用户界面系统
> 
> 用户界面机器

…以及它们各自的向量在 tF-idf 之后，然后使用 LSI 进行归一化，例如 `[1,0.5]`和`[0.5,1]`。

如何测量这些向量之间的相似度？

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2014-04-07T13:13:28.693

如果你想避免依赖第三方库来完成这样一个简单的任务，这里有一个简单的 Java 实现：

```
public static double cosineSimilarity(double[] vectorA, double[] vectorB) {
    double dotProduct = 0.0;
    double normA = 0.0;
    double normB = 0.0;
    for (int i = 0; i < vectorA.length; i++) {
        dotProduct += vectorA[i] * vectorB[i];
        normA += Math.pow(vectorA[i], 2);
        normB += Math.pow(vectorB[i], 2);
    }   
    return dotProduct / (Math.sqrt(normA) * Math.sqrt(normB));
} 
```

请注意，该函数假定两个向量具有相同的长度。您可能需要明确检查它的安全性。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-02-06T13:21:21.113

看看：[http](http://en.wikipedia.org/wiki/Cosine_similarity) ://en.wikipedia.org/wiki/Cosine_similarity 。

如果你有向量 A 和 B。

相似度定义为：

```
cosine(theta) = A . B / ||A|| ||B||

For a vector A = (a1, a2), ||A|| is defined as sqrt(a1^2 + a2^2)

For vector A = (a1, a2) and B = (b1, b2), A . B is defined as a1 b1 + a2 b2;

So for vector A = (a1, a2) and B = (b1, b2), the cosine similarity is given as:

  (a1 b1 + a2 b2) / sqrt(a1^2 + a2^2) sqrt(b1^2 + b2^2) 
```

例子：

```
A = (1, 0.5), B = (0.5, 1)

cosine(theta) = (0.5 + 0.5) / sqrt(5/4) sqrt(5/4) = 4/5 
```

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2009-02-06T13:42:24.893

```
public class CosineSimilarity extends AbstractSimilarity {

  @Override
  protected double computeSimilarity(Matrix sourceDoc, Matrix targetDoc) {
    double dotProduct = sourceDoc.arrayTimes(targetDoc).norm1();
    double eucledianDist = sourceDoc.normF() * targetDoc.normF();
    return dotProduct / eucledianDist;
  }
} 
```

我最近为我在大学的信息检索部门做了一些 tf-idf 的工作。我使用了这种使用[Jama: Java Matrix Package](http://math.nist.gov/javanumerics/jama/)的余弦相似度方法。

有关完整的源代码，请参阅[IR Math with Java : Similarity measure](http://sujitpal.blogspot.com/2008/09/ir-math-with-java-similarity-measures.html)，非常好的资源，涵盖了一些不同的相似性测量。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-06T13:34:25.220

对于 Java 中的矩阵代码，我建议使用[Colt](http://acs.lbl.gov/~hoschek/colt/)库。如果你有这个，代码看起来像（未经测试甚至编译）：

```
DoubleMatrix1D a = new DenseDoubleMatrix1D(new double[]{1,0.5}});
DoubleMatrix1D b = new DenseDoubleMatrix1D(new double[]{0.5,1}});
double cosineDistance = a.zDotProduct(b)/Math.sqrt(a.zDotProduct(a)*b.zDotProduct(b)) 
```

上面的代码也可以更改为使用其中一种`Blas.dnrm2()`方法或`Algebra.DEFAULT.norm2()`用于范数计算。完全相同的结果，更具可读性取决于口味。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-06T13:28:22.847

前段时间我从事文本挖掘工作时，我使用的是[SimMetrics](https://github.com/Simmetrics/simmetrics)库，它在 Java 中提供了广泛的不同指标。如果碰巧您需要更多，那么总会有[R 和 CRAN](http://cran.r-project.org/)可供查看。

但是根据 Wikipedia 中的描述对其进行编码是相当微不足道的任务，并且可能是一个很好的练习。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-11-18T22:25:37.720

对于使用`Map(dimension -> magnitude)` Here is a scala version的向量的稀疏表示（您可以在Java 8中做类似的事情）

```
def cosineSim(vec1:Map[Int,Int],
              vec2:Map[Int,Int]): Double ={
  val dotProduct:Double = vec1.keySet.intersect(vec2.keySet).toList
    .map(dim => vec1(dim) * vec2(dim)).sum
  val norm1:Double = vec1.values.map(mag => mag * mag).sum
  val norm2:Double = vec2.values.map(mag => mag * mag).sum
  return dotProduct / (Math.sqrt(norm1) * Math.sqrt(norm2))
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-09-30T15:31:46.890

```
def cosineSimilarity(vectorA: Vector[Double], vectorB: Vector[Double]):Double={
    var dotProduct = 0.0
    var normA = 0.0
    var normB = 0.0
    var i = 0

    for(i <- vectorA.indices){
        dotProduct += vectorA(i) * vectorB(i)
        normA += Math.pow(vectorA(i), 2)
        normB += Math.pow(vectorB(i), 2)
    }

    dotProduct / (Math.sqrt(normA) * Math.sqrt(normB))
}

def main(args: Array[String]): Unit = {
    val vectorA = Array(1.0,2.0,3.0).toVector
    val vectorB = Array(4.0,5.0,6.0).toVector
    println(cosineSimilarity(vectorA, vectorA))
    println(cosineSimilarity(vectorA, vectorB))
} 
```

斯卡拉版本

# jquery - jQuery 如果 DIV 没有类“x”

> ID：520250
> 
> 赞同：221
> 
> 时间：2009-02-06T13:17:38.670
> 
> 标签：jquery

在 jQuery 中，我需要执行一个 if 语句来查看 $this 是否不包含类“.selected”。

```
$(".thumbs").hover(function(){

$(this).stop().fadeTo("normal", 1.0);
},function(){
$(this).stop().fadeTo("slow", 0.3);

}); 
```

基本上，当这个函数运行时（悬停时），如果类 '.selected' 已附加到 div，我不想执行淡入淡出，这意味着图像将处于完全不透明状态以表示它已被选中。尽管这是一个如何使用 IF 语句的简单问题，但在 Google 上搜索却没有运气......

* * *

## 回答 #1

> 赞同：377
> 
> 时间：2009-02-06T13:24:13.370

使用[“not](http://docs.jquery.com/Selectors/not#selector) ”选择器。

例如，而不是：

`$(".thumbs").hover()`

尝试：

`$(".thumbs:not(.selected)").hover()`

* * *

## 回答 #2

> 赞同：186
> 
> 时间：2009-02-06T13:27:22.833

jQuery 具有 hasClass() 函数，如果包装集中的任何元素包含指定的类，则返回 true

```
if (!$(this).hasClass("selected")) {
    //do stuff
} 
```

[看看我的使用示例](http://jsbin.com/ugaxe)

*   如果将鼠标悬停在 div 上，如果 div 不包含“选定”类，它会以正常速度淡化为 100% 不透明度
*   如果您将鼠标悬停在 div 之外，如果 div 不包含“选定”类，它会以缓慢的速度淡化到 30% 的不透明度
*   单击按钮将“选定”类添加到红色 div。褪色效果不再适用于红色 div

这是它的代码

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.1/jquery.min.js"></script>
<title>Sandbox</title>
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<style type="text/css" media="screen">
body { background-color: #FFF; font: 16px Helvetica, Arial; color: #000; }
</style>

<!-- jQuery code here -->
<script type="text/javascript">
$(function() {

$('#myButton').click(function(e) {
$('#div2').addClass('selected');
});

$('.thumbs').bind('click',function(e) { alert('You clicked ' + e.target.id ); } );

$('.thumbs').hover(fadeItIn, fadeItOut);

});

function fadeItIn(e) {
if (!$(e.target).hasClass('selected')) 
 { 
    $(e.target).fadeTo('normal', 1.0); 
  } 
}

function fadeItOut(e) { 
  if (!$(e.target).hasClass('selected'))
  { 
    $(e.target).fadeTo('slow', 0.3); 
 } 
}
</script>

</head>
<body>
<div id="div1" class="thumbs" style=" background-color: #0f0; margin: 10px; padding: 10px; width: 100px; height: 50px; clear: both;"> 
One div with a thumbs class
</div>
<div id="div2" class="thumbs" style=" background-color: #f00; margin: 10px; padding: 10px; width: 100px; height: 50px; clear: both;">
Another one with a thumbs class
</div>
<input type="button" id="myButton" value="add 'selected' class to red div" />
</body>
</html> 
```

**编辑：**

这只是一个猜测，但您是否正在尝试[实现这样](http://jsbin.com/adana)的目标？

*   两个 div 都以 30% 的不透明度开始
*   将鼠标悬停在 div 上会淡出 100% 的不透明度，悬停在 div 上会淡出 30% 的不透明度。淡入淡出效果仅适用于没有“选定”类的元素
*   单击 div 添加/删除“选定”类

jQuery 代码在这里-

```
$(function() {

$('.thumbs').bind('click',function(e) { $(e.target).toggleClass('selected'); } );
$('.thumbs').hover(fadeItIn, fadeItOut);
$('.thumbs').css('opacity', 0.3);

});

function fadeItIn(e) {
if (!$(e.target).hasClass('selected')) 
 { 
    $(e.target).fadeTo('normal', 1.0); 
  } 
}

function fadeItOut(e) { 
  if (!$(e.target).hasClass('selected'))
  { 
    $(e.target).fadeTo('slow', 0.3); 
 } 
}

<div id="div1" class="thumbs" style=" background-color: #0f0; margin: 10px; padding: 10px; width: 100px; height: 50px; clear: both; cursor:pointer;"> 
One div with a thumbs class
</div>
<div id="div2" class="thumbs" style=" background-color: #f00; margin: 10px; padding: 10px; width: 100px; height: 50px; clear: both; cursor:pointer;">
Another one with a thumbs class
</div> 
```

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2011-11-16T17:01:30.950

我认为作者正在寻找：

```
$(this).not('.selected') 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-08-12T14:13:42.860

当你检查一个元素是否有一个类时，确保你没有不小心在类名中加上一个点：

```
<div class="className"></div>

$('div').hasClass('className');
$('div').hasClass('.className'); #will not work!!!! 
```

在盯着我的代码看了很长时间后，我意识到我已经做到了。像这样的一个小错字花了我一个小时才弄清楚我做错了什么。检查你的代码！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-07-27T17:47:37.760

```
$(".thumbs").hover(
    function(){
        if (!$(this).hasClass("selected")) {
            $(this).stop().fadeTo("normal", 1.0);
        }
    },
    function(){
        if (!$(this).hasClass("selected")) {
            $(this).stop().fadeTo("slow", 0.3); 
        }           
    }
); 
```

在悬停的每个部分中放置一个 if 将允许您动态更改选择类，并且悬停仍然有效。

```
$(".thumbs").click(function() {
    $(".thumbs").each(function () {
        if ($(this).hasClass("selected")) {
            $(this).removeClass("selected");
            $(this).hover();
        }
    });                 
    $(this).addClass("selected");                   
}); 
```

作为示例，我还附加了一个单击处理程序，以将选定的类切换到单击的项目。然后我在前一个项目上触发悬停事件以使其淡出。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-06T15:14:13.583

您还可以使用 addClass 和 removeClass 方法在选项卡等项目之间切换。

例如

```
if($(element).hasClass("selected"))
   $(element).removeClass("selected"); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-06T16:36:46.553

在应用选择类时取消绑定事件，而不是在事件中使用 if 怎么样？我猜你在代码中的某个地方添加了类，所以取消绑定事件看起来像这样：

```
$(element).addClass( 'selected' ).unbind( 'hover' ); 
```

唯一的缺点是，如果您从元素中删除选定的类，则必须再次将其订阅到悬停事件。

# visual-studio - 是否有一个正则表达式可以在一个句子中找到两个不同的单词？

> ID：520252
> 
> 赞同：2
> 
> 时间：2009-02-06T13:18:45.580
> 
> 标签：visual-studio, regex, string, search, find

是否有一个正则表达式可以在一个句子中找到两个不同的单词？在 MS Visual Studio 2008 中工作的表达式的额外功劳:)

例如：

```
reg_ex_match(A, B, "A sentence with A and B") = true
reg_ex_match(C, D, "A sentence with A and B") = false 
```

另请参阅此相关[问题](https://stackoverflow.com/questions/210518/regex-multi-word-search)

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-06T13:43:55.530

对于真实的话：

```
\bA\b.+\bB\b|\bB\b.+\bA\b 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-06T13:25:49.810

".*A.*B.*|.*B.*A.*" 如果需要正确的单词，可以在单词 A 和 B 周围添加空格。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-31T21:31:35.853

## 正则表达式

以下正则表达式匹配整个字符串，仅当字符串包含所有单词时：`all your words here`。您可以轻松添加其他单词或删除现有单词。

```
(?=.*?\ball\b)
(?=.*?\byour\b)
(?=.*?\bwords\b)
(?=.*?\bhere\b)
.* 
```

没那么复杂。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-06T13:24:50.623

为什么不使用布尔逻辑，而不是复杂的正则表达式？

代码未测试：

```
public bool reg_ex_match(Regex A, Regex B, string s) {
    return A.isMatch(s) && B.isMatch(s);
} 
```

更新：假设 A 和 B 是用字边界定义的：

```
Regex A = new Regex(@"\bA\b"); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-06T13:38:07.833

`.*A.*\s.*B.*|.*B.*\s.*A.*`

请注意在 A 和 B 之间使用“+”。这是为了确保您在单独的 A 和 B 上匹配。如果这不是必需的，那么 Łukasz Lew 的答案是正确的。

更新：根据下面 Bryan 的出色观察进行了更改。上面的表达式将识别 A 与 B 分开（反之亦然），在两个感兴趣区域之间至少有一个空白字符（空格、制表符或换行符）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-04-12T21:38:48.840

您正在寻找的**正则表达式**是这样的：

```
/word1.*(?=word2)|word2.*(?=word1)/igm 
```

这也是不**区分大小写的**，可以应用于**多行**文本。

*[在http://regexr.com/](http://regexr.com/)测试过*

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-02-06T13:22:46.383

尝试搜索[regexlib](http://regexlib.com)，一个正则表达式存储库。

# java - 需要有关 SAML 2.0 的信息

> ID：520255
> 
> 赞同：1
> 
> 时间：2009-02-06T13:19:47.717
> 
> 标签：java, saml

对于基于 Web 的单点登录 (SSO)，我们需要按照 SAML2.0 标准规范实施。如果有人提供一些有关如何使用 JDK 1.4 使用 OpenSAML2.0 的信息，将不胜感激。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-17T14:19:57.500

OpenSAML 是一个低级库，提供构建块。考虑更高级别的东西，例如 OpenSSO 或 Shibboleth-IdP，它们可以满足您的需求。

另请查看[https://stackoverflow.com/users/33905/metadaddy](https://stackoverflow.com/users/33905/metadaddy)答案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-10T11:23:17.793

从 OpenSAML 2.2.3 自述文件中：

*   迄今为止，OpenSAML 仅在 JDK 1.5 上进行了测试，但计划在最终的 1.0 版本中支持 1.4。

当发布版本远远超过 1.0 时，我不知道这意味着什么。

# security - 将外部用户放入 Active Directory 是一种不好的做法吗？

> ID：520266
> 
> 赞同：12
> 
> 时间：2009-02-06T13:22:04.903
> 
> 标签：security, authentication, active-directory, adfs

我们有一个现有的 Web 应用程序，我们希望从自定义身份验证解决方案迁移到 Active Directory 联合身份验证服务，以便我们的合作伙伴组织可以管理其用户的授权。

目前，该站点正在使用自定义数据库表来管理用户，并使用自定义逻辑来管理身份验证和授权。

除了将对其用户进行身份验证并通过 ADFS 获得访问权限的合作伙伴组织之外，我们还有位于我们的 Active Directory 域中的内部用户。这些用户也可以通过 ADFS 进行身份验证。

我们的问题围绕着我们的外部用户。该网站还允许个人注册。这些人没有为他们工作的任何组织，因此我们不能使用 ADFS 来处理他们的身份验证。

由于我们需要支持这些人，我们需要管理他们的用户帐户。

ADFS 只能连接到 Active Directory 或 Active Directory 应用程序模式帐户存储。

由于 ADFS 仅支持这些帐户存储，因此合乎逻辑的解决方案似乎是在我们的 Active Directory 域中为外部用户创建帐户。

这意味着我们将更新我们的注册页面以在 Active Active Directory 中创建新用户帐户，而不是在我们的自定义数据库中创建新记录。

**那么，这是一种不好的做法吗？AD 应该用于组织外部的用户吗？其他人在使用 ADFS 时如何处理这种情况？**

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-06T13:38:50.297

为您的外部用户创建一个新的 AD 林，您可能需要设置一些更好的安全性，但可以将两者连接起来进行无缝身份验证。

您需要告诉他们在登录时使用不同的域（例如，您的普通用户使用“mycorp”，外部用户使用“externalcorp”），否则它是完全透明的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-06T13:24:31.123

是的，将外部用户与内部用户放在同一个 AD 中是不好的做法。将外部帐户分开，并检查[ADAM](http://www.microsoft.com/windowsserver2003/adam/default.mspx)以进行外部用户身份验证。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-06T13:42:07.327

我认为您需要问的问题不是将外部帐户存储在活动目录中是否不好，而是将帐户存储在与您的内部帐户相同的森林中是否不好。可以做到，但我倾向于同意 Fallen 的观点，即我不会将外部帐户与内部帐户放在同一个森林中。

过去，当我们使用 AD 存储放置外部帐户时，我们创建了一个新林并将外部用户放置在其中，然后信任这两个域。在我看来，这是更好的选择，因为用户对内部网络的最高访问权限受到信任而不是用户帐户的限制。如果域是包含的，您可以随时将其关闭，并且您会知道外部的任何东西都无法访问内部网络。这还允许您在外部和内部用户之间拥有不同的安全策略。

# .net - .NET 程序集跨越多个文件和单元测试

> ID：520280
> 
> 赞同：1
> 
> 时间：2009-02-06T13:27:55.077
> 
> 标签：.net, unit-testing, assemblies

谁能告诉我一些关于跨多个文件的 .NET 程序集的信息？

我在 MSDN 上找到了这个评论（[这里](http://msdn.microsoft.com/en-us/library/ms973231.aspx#assenamesp_topic4)）：

> 尽管在技术上可以创建跨多个文件的程序集，但在大多数情况下您不太可能使用此技术。

我问是因为我在单独的项目中有业务逻辑和单元测试，我想测试一些内部类（单元测试无法访问） - 所以我想我会尝试合并将两者合并为一个组件。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-06T13:33:32.913

您可以将两个程序集加为好友。然后一个人可以看到另一个人的“内部”。还是看不到私信。

MSDN - [http://msdn.microsoft.com/en-us/library/0tke9fxk(VS.80).aspx](http://msdn.microsoft.com/en-us/library/0tke9fxk(VS.80).aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-06T13:34:32.240

如果您想测试内部方法，那么[InternalsVisibleTo](http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.internalsvisibletoattribute.aspx)是适合您的属性。事实上，测试内部类/方法实际上是我用过它的唯一目的。

（基本上，您将其应用于生产程序集，指定测试程序集 - 然后测试程序集可以访问内部成员。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-06T13:42:16.390

我会说在下面的两个选项之间做出决定

*   如果内部类对于父程序集来说真的微不足道且私有，请跳过测试。执行这些内部类的公共类的测试应该涵盖它们。
*   如果内部类相当大并且确实需要自己的测试。将访问控制的职责拆分给另一个类。公开内部类并像往常一样编写测试。将内部类不直接在父程序集之外实例化，或者将其他类用作对“内部类”的单点访问，使其成为一个已知的团队约定。

恕我直言，只有当您真的担心不公开内部类型+绝对必须测试它们时，才选择 Option2。Option1 允许您随时更改内部实现/类，而不会破坏任何测试。不要使用晦涩的方法将程序集拆分为多个物理文件以进行测试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-06T13:30:28.880

内部类的测试应该通过测试你的公共方法来进行。

# networking - Java ME 中的网络问题

> ID：520284
> 
> 赞同：0
> 
> 时间：2009-02-06T13:30:02.657
> 
> 标签：networking, java-me, mobile

好的，所以我正在使用 Java ME 连接到我服务器上的 PHP 脚本，但由于某些奇怪的原因，网络只能在安装后第一次在手机上运行应用程序时工作。其他任何时候，它甚至都不会请求使用网络的许可。这是有问题的方法：

```
private static String defaultURL = "http://www.roostercogburn.co.uk/proj/uploadScript.php";

public static String upload(String requeststring) {
    HttpConnection hc = null;
    DataInputStream dis = null;
    DataOutputStream dos = null;
    StringBuffer messagebuffer = new StringBuffer();
    requeststring = "xml=" + requeststring;
    try {
        // Open up a http connection with the Web server
        // for both send and receive operations
        hc = (HttpConnection) Connector.open(defaultURL, Connector.READ_WRITE);
        // Set the request method to POST
        hc.setRequestMethod(HttpConnection.POST);
        // Send the string entered by user byte by byte
        dos = hc.openDataOutputStream();
        byte[] request_body = requeststring.getBytes();
        for (int i = 0; i < request_body.length; i++) {
            dos.writeByte(request_body[i]);
        }
        dos.flush();
        dos.close();
        // Retrieve the response back from the servlet
        dis = new DataInputStream(hc.openInputStream());
        int ch;
        // Check the Content-Length first
        long len = hc.getLength();
        if (len != -1) {
            for (int i = 0; i < len; i++) {
                if ((ch = dis.read()) != -1) {
                    messagebuffer.append((char) ch);
                }
            }
        } else {
            // if the content-length is not available
            while ((ch = dis.read()) != -1) {
                messagebuffer.append((char) ch);
            }
        }

        dis.close();

        hc.close();
    } catch (IOException ioe) {
        messagebuffer = new StringBuffer("ERROR!");
    } finally {
        // Free up i/o streams and http connection
        try {
            if (hc != null) {
                hc.close();
            }
        } catch (IOException ignored) {
        }
        try {
            if (dis != null) {
                dis.close();
            }
        } catch (IOException ignored) {
        }
        try {
            if (dos != null) {
                dos.close();
            }
        } catch (IOException ignored) {
        }
    }
    return messagebuffer.toString();
} 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-09T18:12:34.067

“静态”的使用提醒我 JavaME 虚拟机通常不会卸载类。

我知道至少 Series40 平台让 VM 进程一直运行，因此不会重置静态变量，静态初始化代码只运行一次。

尝试关闭并打开手机，以确保您没有遇到此问题。

否则，可能会将您使用此代码的简单 MIDlet 的整个代码发布到并告诉我们您在哪些手机上试用过。

您还可以使用日志记录（文件或标准输出）来确保您的上传方法实际上是第二次运行（或找出它没有运行的原因）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T18:35:18.640

对我来说，这段代码似乎不是问题。创建了一个快速测试 MIDlet，一切都在模拟器和索尼爱立信 W960 上运行。

我的测试表格：

```
class TestForm extends Form implements CommandListener, Runnable {
  private final Command exit = new Command("Exit", Command.EXIT, 0);
  private final Command run = new Command("Run", Command.OK, 0);
  private int testRunCount;

  public TestForm() {
    super("Test");
    addCommand(exit);
    addCommand(run);
    setCommandListener(this);
  }

  public void commandAction(final Command cmd, final Displayable d) {
    if (cmd == exit) {
      notifyDestroyed();
    } else if (cmd == run) {
      final Thread t = new Thread(this);
      t.start();
    }
  }

  public void run() {
    testRunCount++;
    append("Test run " + testRunCount + "\n");
    final String result = upload("StackOverflow testrun " + testRunCount);
    append("Result > " + result + "\n");
  }
} 
```

顺便提一句：

> 其他任何时候，它甚至都不会请求使用网络的权限

不需要每次都问。在手机/模拟器上，每个应用程序运行通常只询问一次权限。

检查此方法是否在初始调用后被调用:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-02-06T13:57:31.523

我对代码有一些评论。我会在关闭输出流后立即调用 getResponseCode 并在打开输入流之前检查 http 响应代码。不过，更重要的是，我会将所有的 close 移到 finally 块中。现在，如果您在代码中有异常，您可以让 HttpConnection 实例保持打开状态，这可能会干扰以后的连接尝试。

# c# - 如何以非泛型方式获取类型的默认值？

> ID：520290
> 
> 赞同：5
> 
> 时间：2009-02-06T13:31:50.140
> 
> 标签：c#, default-value

我知道“默认”关键字返回静态确定类型的默认值，例如在[这个问题](https://stackoverflow.com/questions/367378/returning-a-default-value-c)中所示。

但是，给定一个类型的实例，是否有一种简单的方法可以动态地获取该类型的默认值？我在谷歌搜索时发现的唯一方法[是](http://weblogs.asp.net/avnerk/archive/2006/05/21/Non_2D00_generic-default-values-in-C_23003F00_-Why-not_3F002100_.aspx)：

```
static object DefaultValue(Type myType)
{
    if (!myType.IsValueType)
        return null;
    else
        return Activator.CreateInstance(myType);
} 
```

但如果可能的话，我想避免使用 Activator 类。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-06T13:36:49.693

为什么要避免激活器？基本上这*就是*这样做的方式。

我的意思是，您可以编写一个通用方法，然后通过反射调用它，但这是一个非常可怕的“长切”，只是为了避免使用 Activator。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-06T13:37:14.933

这可能是您最好的路线。

我不会害怕在这里使用 Activator 类。这是一个非常标准的类，由编译器依赖。例如这个 VB 代码

```
Public Sub Example(Of T as New)()
  Dim x = new T()
End Sub 
```

大致翻译成这段代码

```
Public Sub Example(Of T As New)()
  Dim x = Activator.CreateInstance(OF T)
ENd Sub 
```

# java - 您可以使用反射找到包中的所有类吗？

> ID：520328
> 
> 赞同：600
> 
> 时间：2009-02-06T13:43:16.810
> 
> 标签：java, reflection, packages

是否可以找到给定包中的所有类或接口？（快速查看 eg [`Package`](http://java.sun.com/javase/6/docs/api/java/lang/Package.html)，似乎没有。）

* * *

## 回答 #1

> 赞同：405
> 
> 时间：2009-02-06T13:47:57.080

由于类加载器的动态特性，这是不可能的。类加载器不需要告诉虚拟机它可以提供哪些类，它们只是对类的请求，并且必须返回一个类或抛出一个异常。

但是，如果您编写自己的类加载器，或检查类路径及其 jar，则可以找到此信息。这将通过文件系统操作，而不是反射。甚至可能有一些库可以帮助您做到这一点。

如果有生成或远程交付的类，您将无法发现这些类。

正常的方法是在某处注册您需要在文件中访问的类，或在不同的类中引用它们。或者只是在命名时使用约定。

附录：[反射库](https://github.com/ronmamo/reflections)将允许您在当前类路径中查找类。它可用于获取包中的所有类：

```
 Reflections reflections = new Reflections("my.project.prefix");

 Set<Class<? extends Object>> allClasses = 
     reflections.getSubTypesOf(Object.class); 
```

* * *

## 回答 #2

> 赞同：202
> 
> 时间：2012-03-05T17:29:44.580

您可能应该看看开源[反射库](https://github.com/ronmamo/reflections)。有了它，您可以轻松实现您想要的。

首先，设置反射索引（这有点乱，因为默认情况下禁用搜索所有类）：

```
List<ClassLoader> classLoadersList = new LinkedList<ClassLoader>();
classLoadersList.add(ClasspathHelper.contextClassLoader());
classLoadersList.add(ClasspathHelper.staticClassLoader());

Reflections reflections = new Reflections(new ConfigurationBuilder()
    .setScanners(new SubTypesScanner(false /* don't exclude Object.class */), new ResourcesScanner())
    .setUrls(ClasspathHelper.forClassLoader(classLoadersList.toArray(new ClassLoader[0])))
    .filterInputsBy(new FilterBuilder().include(FilterBuilder.prefix("org.your.package")))); 
```

然后您可以查询给定包中的所有对象：

```
Set<Class<?>> classes = reflections.getSubTypesOf(Object.class); 
```

* * *

## 回答 #3

> 赞同：141
> 
> 时间：2012-11-20T16:06:26.023

Google Guava 14 包含一个新类，该类[`ClassPath`](http://code.google.com/p/guava-libraries/source/browse/guava/src/com/google/common/reflect/ClassPath.java)具有三种扫描顶级类的方法：

*   `getTopLevelClasses()`
*   `getTopLevelClasses(String packageName)`
*   `getTopLevelClassesRecursive(String packageName)`

有关更多信息，请参阅[`ClassPath`javadocs](http://google.github.io/guava/releases/17.0/api/docs/index.html?com/google/common/reflect/ClassPath.html)。

* * *

## 回答 #4

> 赞同：132
> 
> 时间：2009-02-06T13:49:40.853

您可以使用[此方法](https://web.archive.org/web/20090227113602/http://snippets.dzone.com:80/posts/show/4831)¹ ，该方法使用`ClassLoader`.

```
/**
 * Scans all classes accessible from the context class loader which belong to the given package and subpackages.
 *
 * @param packageName The base package
 * @return The classes
 * @throws ClassNotFoundException
 * @throws IOException
 */
private static Class[] getClasses(String packageName)
        throws ClassNotFoundException, IOException {
    ClassLoader classLoader = Thread.currentThread().getContextClassLoader();
    assert classLoader != null;
    String path = packageName.replace('.', '/');
    Enumeration<URL> resources = classLoader.getResources(path);
    List<File> dirs = new ArrayList<File>();
    while (resources.hasMoreElements()) {
        URL resource = resources.nextElement();
        dirs.add(new File(resource.getFile()));
    }
    ArrayList<Class> classes = new ArrayList<Class>();
    for (File directory : dirs) {
        classes.addAll(findClasses(directory, packageName));
    }
    return classes.toArray(new Class[classes.size()]);
}

/**
 * Recursive method used to find all classes in a given directory and subdirs.
 *
 * @param directory   The base directory
 * @param packageName The package name for classes found inside the base directory
 * @return The classes
 * @throws ClassNotFoundException
 */
private static List<Class> findClasses(File directory, String packageName) throws ClassNotFoundException {
    List<Class> classes = new ArrayList<Class>();
    if (!directory.exists()) {
        return classes;
    }
    File[] files = directory.listFiles();
    for (File file : files) {
        if (file.isDirectory()) {
            assert !file.getName().contains(".");
            classes.addAll(findClasses(file, packageName + "." + file.getName()));
        } else if (file.getName().endsWith(".class")) {
            classes.add(Class.forName(packageName + '.' + file.getName().substring(0, file.getName().length() - 6)));
        }
    }
    return classes;
} 
```

__________
[¹此方法最初取自[http://snippets.dzone.com/posts/show/4831](http://snippets.dzone.com/posts/show/4831)，由 Internet 档案馆[存档](https://web.archive.org/web/20090227113602/http://snippets.dzone.com:80/posts/show/4831)，链接到现在。该片段也可在[https://dzone.com/articles/get-all-classes-within-package](https://dzone.com/articles/get-all-classes-within-package)获得。]

* * *

## 回答 #5

> 赞同：117
> 
> 时间：2014-01-29T12:15:09.273

## 春天

此示例适用于 Spring 4，但您也可以在早期版本中找到类路径扫描器。

```
// create scanner and disable default filters (that is the 'false' argument)
final ClassPathScanningCandidateComponentProvider provider = new ClassPathScanningCandidateComponentProvider(false);
// add include filters which matches all the classes (or use your own)
provider.addIncludeFilter(new RegexPatternTypeFilter(Pattern.compile(".*")));

// get matching classes defined in the package
final Set<BeanDefinition> classes = provider.findCandidateComponents("my.package.name");

// this is how you can load the class type from BeanDefinition instance
for (BeanDefinition bean: classes) {
    Class<?> clazz = Class.forName(bean.getBeanClassName());
    // ... do your magic with the class ...
} 
```

## 谷歌番石榴

**注意：**在版本 14 中，API 仍标记为*@Beta*，因此在生产代码中要小心。

```
final ClassLoader loader = Thread.currentThread().getContextClassLoader();

for (final ClassPath.ClassInfo info : ClassPath.from(loader).getTopLevelClasses()) {
  if (info.getName().startsWith("my.package.")) {
    final Class<?> clazz = info.load();
    // do something with your clazz
  }
} 
```

* * *

## 回答 #6

> 赞同：42
> 
> 时间：2014-03-17T18:47:16.130

你好。我一直对上述解决方案（以及其他网站）有一些问题。
作为开发人员，我正在为 API 编写插件。API 阻止使用任何外部库或第 3 方工具。该设置还包含 jar 或 zip 文件中的代码以及直接位于某些目录中的类文件。因此，我的代码必须能够围绕每个设置工作。经过大量研究，我想出了一种方法，该方法至少适用于所有可能设置的 95%。

下面的代码基本上是永远有效的矫枉过正的方法。

## 编码：

此代码扫描给定包中包含的所有类。它只适用于当前的所有类`ClassLoader`。

```
/**
 * Private helper method
 * 
 * @param directory
 *            The directory to start with
 * @param pckgname
 *            The package name to search for. Will be needed for getting the
 *            Class object.
 * @param classes
 *            if a file isn't loaded but still is in the directory
 * @throws ClassNotFoundException
 */
private static void checkDirectory(File directory, String pckgname,
        ArrayList<Class<?>> classes) throws ClassNotFoundException {
    File tmpDirectory;

    if (directory.exists() && directory.isDirectory()) {
        final String[] files = directory.list();

        for (final String file : files) {
            if (file.endsWith(".class")) {
                try {
                    classes.add(Class.forName(pckgname + '.'
                            + file.substring(0, file.length() - 6)));
                } catch (final NoClassDefFoundError e) {
                    // do nothing. this class hasn't been found by the
                    // loader, and we don't care.
                }
            } else if ((tmpDirectory = new File(directory, file))
                    .isDirectory()) {
                checkDirectory(tmpDirectory, pckgname + "." + file, classes);
            }
        }
    }
}

/**
 * Private helper method.
 * 
 * @param connection
 *            the connection to the jar
 * @param pckgname
 *            the package name to search for
 * @param classes
 *            the current ArrayList of all classes. This method will simply
 *            add new classes.
 * @throws ClassNotFoundException
 *             if a file isn't loaded but still is in the jar file
 * @throws IOException
 *             if it can't correctly read from the jar file.
 */
private static void checkJarFile(JarURLConnection connection,
        String pckgname, ArrayList<Class<?>> classes)
        throws ClassNotFoundException, IOException {
    final JarFile jarFile = connection.getJarFile();
    final Enumeration<JarEntry> entries = jarFile.entries();
    String name;

    for (JarEntry jarEntry = null; entries.hasMoreElements()
            && ((jarEntry = entries.nextElement()) != null);) {
        name = jarEntry.getName();

        if (name.contains(".class")) {
            name = name.substring(0, name.length() - 6).replace('/', '.');

            if (name.contains(pckgname)) {
                classes.add(Class.forName(name));
            }
        }
    }
}

/**
 * Attempts to list all the classes in the specified package as determined
 * by the context class loader
 * 
 * @param pckgname
 *            the package name to search
 * @return a list of classes that exist within that package
 * @throws ClassNotFoundException
 *             if something went wrong
 */
public static ArrayList<Class<?>> getClassesForPackage(String pckgname)
        throws ClassNotFoundException {
    final ArrayList<Class<?>> classes = new ArrayList<Class<?>>();

    try {
        final ClassLoader cld = Thread.currentThread()
                .getContextClassLoader();

        if (cld == null)
            throw new ClassNotFoundException("Can't get class loader.");

        final Enumeration<URL> resources = cld.getResources(pckgname
                .replace('.', '/'));
        URLConnection connection;

        for (URL url = null; resources.hasMoreElements()
                && ((url = resources.nextElement()) != null);) {
            try {
                connection = url.openConnection();

                if (connection instanceof JarURLConnection) {
                    checkJarFile((JarURLConnection) connection, pckgname,
                            classes);
                } else if (connection instanceof FileURLConnection) {
                    try {
                        checkDirectory(
                                new File(URLDecoder.decode(url.getPath(),
                                        "UTF-8")), pckgname, classes);
                    } catch (final UnsupportedEncodingException ex) {
                        throw new ClassNotFoundException(
                                pckgname
                                        + " does not appear to be a valid package (Unsupported encoding)",
                                ex);
                    }
                } else
                    throw new ClassNotFoundException(pckgname + " ("
                            + url.getPath()
                            + ") does not appear to be a valid package");
            } catch (final IOException ioex) {
                throw new ClassNotFoundException(
                        "IOException was thrown when trying to get all resources for "
                                + pckgname, ioex);
            }
        }
    } catch (final NullPointerException ex) {
        throw new ClassNotFoundException(
                pckgname
                        + " does not appear to be a valid package (Null pointer exception)",
                ex);
    } catch (final IOException ioex) {
        throw new ClassNotFoundException(
                "IOException was thrown when trying to get all resources for "
                        + pckgname, ioex);
    }

    return classes;
} 
```

这三种方法使您能够找到给定包中的所有类。
你像这样使用它：

```
getClassesForPackage("package.your.classes.are.in"); 
```

## 说明：

该方法首先获取当前的`ClassLoader`. 然后它获取包含所述包的所有资源并迭代这些`URL`s。然后它创建一个`URLConnection`并确定我们拥有什么类型的 URl。它可以是目录 ( `FileURLConnection`)，也可以是 jar 或 zip 文件 ( `JarURLConnection`) 中的目录。根据连接的类型，我们将调用两种不同的方法。

首先让我们看看如果它是一个`FileURLConnection`.
它首先检查传递的 File 是否存在并且是一个目录。如果是这种情况，它会检查它是否是类文件。如果是这样，`Class`将创建一个对象并将其放入`ArrayList`. 如果它不是类文件而是目录，我们只需迭代它并做同样的事情。所有其他案例/文件将被忽略。

如果`URLConnection`是`JarURLConnection`另一个私有辅助方法将被调用。此方法遍历 zip/jar 存档中的所有条目。如果一个条目是类文件并且在包内，`Class`则将创建一个对象并将其存储在`ArrayList`.

解析完所有资源后，它（主要方法）返回`ArrayList`包含给定包中的所有类，当前`ClassLoader`知道。

如果该过程在任何时候失败，`ClassNotFoundException`将抛出包含有关确切原因的详细信息。

* * *

## 回答 #7

> 赞同：23
> 
> 时间：2016-07-31T01:48:16.207

目前列出给定包中所有类的最强大的机制是[ClassGraph](https://github.com/classgraph/classgraph/wiki/Code-examples)，因为它处理[最广泛的类路径规范机制](https://github.com/classgraph/classgraph/wiki/Classpath-Specification-Mechanisms)，包括新的 JPMS 模块系统。（我是作者。）

```
List<String> classNames = new ArrayList<>();
try (ScanResult scanResult = new ClassGraph().acceptPackages("my.package")
        .enableClassInfo().scan()) {
    classNames.addAll(scanResult.getAllClasses().getNames());
} 
```

* * *

## 回答 #8

> 赞同：18
> 
> 时间：2014-02-17T22:48:57.713

不使用任何额外的库：

```
package test;

import java.io.DataInputStream;
import java.io.InputStream;
import java.net.URL;
import java.util.ArrayList;
import java.util.List;

public class Test {
    public static void main(String[] args) throws Exception{
        List<Class> classes = getClasses(Test.class.getClassLoader(),"test");
        for(Class c:classes){
            System.out.println("Class: "+c);
        }
    }

    public static List<Class> getClasses(ClassLoader cl,String pack) throws Exception{

        String dottedPackage = pack.replaceAll("[/]", ".");
        List<Class> classes = new ArrayList<Class>();
        URL upackage = cl.getResource(pack);

        DataInputStream dis = new DataInputStream((InputStream) upackage.getContent());
        String line = null;
        while ((line = dis.readLine()) != null) {
            if(line.endsWith(".class")) {
               classes.add(Class.forName(dottedPackage+"."+line.substring(0,line.lastIndexOf('.'))));
            }
        }
        return classes;
    }
} 
```

* * *

## 回答 #9

> 赞同：13
> 
> 时间：2012-12-22T12:02:30.177

一般来说，类加载器不允许扫描类路径上的所有类。但通常唯一使用的类加载器是 UrlClassLoader，我们可以从中检索目录和 jar 文件列表（请参阅[getURLs](http://docs.oracle.com/javase/7/docs/api/java/net/URLClassLoader.html#getURLs%28%29)）并一一打开以列出可用的类。这种方法称为类路径扫描，在[Scannotation](http://scannotation.sourceforge.net/)和[Reflections](https://code.google.com/p/reflections/)中实现。

```
Reflections reflections = new Reflections("my.package");
Set<Class<? extends Object>> classes = reflections.getSubTypesOf(Object.class); 
```

另一种方法是使用[Java Pluggable Annotation Processing API](http://docs.oracle.com/javase/6/docs/api/javax/annotation/processing/Processor.html)编写注释处理器，该处理器将在编译时收集所有带注释的类并构建索引文件以供运行时使用。该机制在[ClassIndex](https://github.com/atteo/classindex)库中实现：

```
// package-info.java
@IndexSubclasses
package my.package;

// your code
Iterable<Class> classes = ClassIndex.getPackageClasses("my.package"); 
```

请注意，由于 Java 编译器会自动发现在类路径中找到的任何处理器，因此扫描是完全自动化的，因此不需要额外的设置。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2019-11-08T19:57:36.023

那这个呢：

```
public static List<Class<?>> getClassesForPackage(final String pkgName) throws IOException, URISyntaxException {
    final String pkgPath = pkgName.replace('.', '/');
    final URI pkg = Objects.requireNonNull(ClassLoader.getSystemClassLoader().getResource(pkgPath)).toURI();
    final ArrayList<Class<?>> allClasses = new ArrayList<Class<?>>();

    Path root;
    if (pkg.toString().startsWith("jar:")) {
        try {
            root = FileSystems.getFileSystem(pkg).getPath(pkgPath);
        } catch (final FileSystemNotFoundException e) {
            root = FileSystems.newFileSystem(pkg, Collections.emptyMap()).getPath(pkgPath);
        }
    } else {
        root = Paths.get(pkg);
    }

    final String extension = ".class";
    try (final Stream<Path> allPaths = Files.walk(root)) {
        allPaths.filter(Files::isRegularFile).forEach(file -> {
            try {
                final String path = file.toString().replace('/', '.');
                final String name = path.substring(path.indexOf(pkgName), path.length() - extension.length());
                allClasses.add(Class.forName(name));
            } catch (final ClassNotFoundException | StringIndexOutOfBoundsException ignored) {
            }
        });
    }
    return allClasses;
} 
```

然后，您可以重载该函数：

```
public static List<Class<?>> getClassesForPackage(final Package pkg) throws IOException, URISyntaxException {
    return getClassesForPackage(pkg.getName());
} 
```

如果你需要测试它：

```
public static void main(final String[] argv) throws IOException, URISyntaxException {
    for (final Class<?> cls : getClassesForPackage("my.package")) {
        System.out.println(cls);
    }
    for (final Class<?> cls : getClassesForPackage(MyClass.class.getPackage())) {
        System.out.println(cls);
    }
} 
```

如果您的 IDE 没有导入助手：

```
import java.io.IOException;
import java.net.URI;
import java.net.URISyntaxException;
import java.nio.file.FileSystemNotFoundException;
import java.nio.file.FileSystems;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.util.ArrayList;
import java.util.Collections;
import java.util.List;
import java.util.Objects;
import java.util.stream.Stream; 
```

有用：

*   从您的 IDE

*   对于 JAR 文件

*   没有外部依赖

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2012-10-24T21:49:59.097

我整理了一个简单的 github 项目来解决这个问题：

[https://github.com/ddopson/java-class-enumerator](https://github.com/ddopson/java-class-enumerator)

它应该适用于基于文件的类路径和 jar 文件。

如果你在签出项目后运行“make”，它会打印出来：

```
 Cleaning...
rm -rf build/
 Building...
javac -d build/classes src/pro/ddopson/ClassEnumerator.java src/test/ClassIShouldFindOne.java src/test/ClassIShouldFindTwo.java src/test/subpkg/ClassIShouldFindThree.java src/test/TestClassEnumeration.java
 Making JAR Files...
jar cf build/ClassEnumerator_test.jar -C build/classes/ . 
jar cf build/ClassEnumerator.jar -C build/classes/ pro
 Running Filesystem Classpath Test...
java -classpath build/classes test.TestClassEnumeration
ClassDiscovery: Package: 'test' becomes Resource: 'file:/Users/Dopson/work/other/java-class-enumeration/build/classes/test'
ClassDiscovery: Reading Directory '/Users/Dopson/work/other/java-class-enumeration/build/classes/test'
ClassDiscovery: FileName 'ClassIShouldFindOne.class'  =>  class 'test.ClassIShouldFindOne'
ClassDiscovery: FileName 'ClassIShouldFindTwo.class'  =>  class 'test.ClassIShouldFindTwo'
ClassDiscovery: FileName 'subpkg'  =>  class 'null'
ClassDiscovery: Reading Directory '/Users/Dopson/work/other/java-class-enumeration/build/classes/test/subpkg'
ClassDiscovery: FileName 'ClassIShouldFindThree.class'  =>  class 'test.subpkg.ClassIShouldFindThree'
ClassDiscovery: FileName 'TestClassEnumeration.class'  =>  class 'test.TestClassEnumeration'
 Running JAR Classpath Test...
java -classpath build/ClassEnumerator_test.jar  test.TestClassEnumeration
ClassDiscovery: Package: 'test' becomes Resource: 'jar:file:/Users/Dopson/work/other/java-class-enumeration/build/ClassEnumerator_test.jar!/test'
ClassDiscovery: Reading JAR file: '/Users/Dopson/work/other/java-class-enumeration/build/ClassEnumerator_test.jar'
ClassDiscovery: JarEntry 'META-INF/'  =>  class 'null'
ClassDiscovery: JarEntry 'META-INF/MANIFEST.MF'  =>  class 'null'
ClassDiscovery: JarEntry 'pro/'  =>  class 'null'
ClassDiscovery: JarEntry 'pro/ddopson/'  =>  class 'null'
ClassDiscovery: JarEntry 'pro/ddopson/ClassEnumerator.class'  =>  class 'null'
ClassDiscovery: JarEntry 'test/'  =>  class 'null'
ClassDiscovery: JarEntry 'test/ClassIShouldFindOne.class'  =>  class 'test.ClassIShouldFindOne'
ClassDiscovery: JarEntry 'test/ClassIShouldFindTwo.class'  =>  class 'test.ClassIShouldFindTwo'
ClassDiscovery: JarEntry 'test/subpkg/'  =>  class 'null'
ClassDiscovery: JarEntry 'test/subpkg/ClassIShouldFindThree.class'  =>  class 'test.subpkg.ClassIShouldFindThree'
ClassDiscovery: JarEntry 'test/TestClassEnumeration.class'  =>  class 'test.TestClassEnumeration'
 Tests Passed. 
```

另见[我的另一个答案](https://stackoverflow.com/questions/176527/how-can-i-enumerate-all-classes-in-a-package-and-add-them-to-a-list/3527428#3527428)

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2016-08-17T20:54:23.710

这是我的做法。我扫描所有子文件夹（子包），我不尝试加载匿名类：

```
 /**
   * Attempts to list all the classes in the specified package as determined
   * by the context class loader, recursively, avoiding anonymous classes
   * 
   * @param pckgname
   *            the package name to search
   * @return a list of classes that exist within that package
   * @throws ClassNotFoundException
   *             if something went wrong
   */
  private static List<Class> getClassesForPackage(String pckgname) throws ClassNotFoundException {
      // This will hold a list of directories matching the pckgname. There may be more than one if a package is split over multiple jars/paths
      ArrayList<File> directories = new ArrayList<File>();
      String packageToPath = pckgname.replace('.', '/');
      try {
          ClassLoader cld = Thread.currentThread().getContextClassLoader();
          if (cld == null) {
              throw new ClassNotFoundException("Can't get class loader.");
          }

          // Ask for all resources for the packageToPath
          Enumeration<URL> resources = cld.getResources(packageToPath);
          while (resources.hasMoreElements()) {
              directories.add(new File(URLDecoder.decode(resources.nextElement().getPath(), "UTF-8")));
          }
      } catch (NullPointerException x) {
          throw new ClassNotFoundException(pckgname + " does not appear to be a valid package (Null pointer exception)");
      } catch (UnsupportedEncodingException encex) {
          throw new ClassNotFoundException(pckgname + " does not appear to be a valid package (Unsupported encoding)");
      } catch (IOException ioex) {
          throw new ClassNotFoundException("IOException was thrown when trying to get all resources for " + pckgname);
      }

      ArrayList<Class> classes = new ArrayList<Class>();
      // For every directoryFile identified capture all the .class files
      while (!directories.isEmpty()){
          File directoryFile  = directories.remove(0);             
          if (directoryFile.exists()) {
              // Get the list of the files contained in the package
              File[] files = directoryFile.listFiles();

              for (File file : files) {
                  // we are only interested in .class files
                  if ((file.getName().endsWith(".class")) && (!file.getName().contains("$"))) {
                      // removes the .class extension
                      int index = directoryFile.getPath().indexOf(packageToPath);
                      String packagePrefix = directoryFile.getPath().substring(index).replace('/', '.');;                          
                    try {                  
                      String className = packagePrefix + '.' + file.getName().substring(0, file.getName().length() - 6);                            
                      classes.add(Class.forName(className));                                
                    } catch (NoClassDefFoundError e)
                    {
                      // do nothing. this class hasn't been found by the loader, and we don't care.
                    }
                  } else if (file.isDirectory()){ // If we got to a subdirectory
                      directories.add(new File(file.getPath()));                          
                  }
              }
          } else {
              throw new ClassNotFoundException(pckgname + " (" + directoryFile.getPath() + ") does not appear to be a valid package");
          }
      }
      return classes;
  } 
```

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2017-02-08T10:57:15.593

是的，您可以使用很少的 API，这就是我喜欢这样做的方式，遇到了我使用休眠核心的问题，并且必须找到用某个注释进行注释的类。

使这些成为自定义注释，您将使用它标记要选择的类。

```
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.TYPE)
public @interface EntityToBeScanned {

} 
```

然后用它标记你的班级

```
@EntityToBeScanned 
public MyClass{

} 
```

制作具有以下方法的实用程序类

```
public class ClassScanner {

    public static Set<Class<?>> allFoundClassesAnnotatedWithEntityToBeScanned(){
        Reflections reflections = new Reflections(".*");
        Set<Class<?>> annotated = reflections.getTypesAnnotatedWith(EntityToBeScanned.class);
        return annotated;
    }

} 
```

调用**allFoundClassesAnnotatedWithEntityToBeScanned()**方法来获取一**组**找到的类。

您将需要下面给出的库

```
<!-- https://mvnrepository.com/artifact/com.google.guava/guava -->
    <dependency>
        <groupId>com.google.guava</groupId>
        <artifactId>guava</artifactId>
        <version>21.0</version>
    </dependency>
<!-- https://mvnrepository.com/artifact/org.javassist/javassist -->
<dependency>
    <groupId>org.javassist</groupId>
    <artifactId>javassist</artifactId>
    <version>3.22.0-CR1</version>
</dependency>
<!-- https://mvnrepository.com/artifact/org.reflections/reflections -->
<dependency>
    <groupId>org.reflections</groupId>
    <artifactId>reflections</artifactId>
    <version>0.9.10</version>
</dependency> 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2020-04-30T14:21:04.353

如果您在 Spring-land，您可以使用`PathMatchingResourcePatternResolver`;

```
 PathMatchingResourcePatternResolver resolver = new PathMatchingResourcePatternResolver();
  Resource[] resources = resolver.getResources("classpath*:some/package/name/*.class");

    Arrays.asList(resources).forEach(r->{
        ...
    }); 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2013-09-25T08:44:56.843

您需要查找类路径中的每个类加载器条目：

```
 String pkg = "org/apache/commons/lang";
    ClassLoader cl = ClassLoader.getSystemClassLoader();
    URL[] urls = ((URLClassLoader) cl).getURLs();
    for (URL url : urls) {
        System.out.println(url.getFile());
        File jar = new File(url.getFile());
        // ....
    } 
```

如果条目是目录，只需在正确的子目录中查找：

```
if (jar.isDirectory()) {
    File subdir = new File(jar, pkg);
    if (!subdir.exists())
        continue;
    File[] files = subdir.listFiles();
    for (File file : files) {
        if (!file.isFile())
            continue;
        if (file.getName().endsWith(".class"))
            System.out.println("Found class: "
                    + file.getName().substring(0,
                            file.getName().length() - 6));
    }
} 
```

如果条目是文件，并且是 jar，请检查它的 ZIP 条目：

```
else {
    // try to open as ZIP
    try {
        ZipFile zip = new ZipFile(jar);
        for (Enumeration<? extends ZipEntry> entries = zip
                .entries(); entries.hasMoreElements();) {
            ZipEntry entry = entries.nextElement();
            String name = entry.getName();
            if (!name.startsWith(pkg))
                continue;
            name = name.substring(pkg.length() + 1);
            if (name.indexOf('/') < 0 && name.endsWith(".class"))
                System.out.println("Found class: "
                        + name.substring(0, name.length() - 6));
        }
    } catch (ZipException e) {
        System.out.println("Not a ZIP: " + e.getMessage());
    } catch (IOException e) {
        System.err.println(e.getMessage());
    }
} 
```

现在一旦你有了包中的所有类名，你可以尝试用反射加载它们并分析它们是类还是接口等。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2013-12-03T17:52:35.430

我一直在尝试使用 Reflections 库，但是在使用它时遇到了一些问题，而且我应该包含太多的 jar，只是为了简单地获取包上的类。

我将发布我在这个重复问题中找到的解决方案：[如何获取包中的所有类名称？](https://stackoverflow.com/questions/15519626/how-to-get-all-classes-names-in-a-package)

[答案是 sp00m 写](https://stackoverflow.com/questions/15519626/how-to-get-all-classes-names-in-a-package/15519745#15519745)的；我添加了一些更正以使其正常工作：

```
import java.io.File;
import java.io.IOException;
import java.net.URL;
import java.util.Enumeration;
import java.util.LinkedList;
import java.util.List;

public final class ClassFinder {

    private final static char DOT = '.';
    private final static char SLASH = '/';
    private final static String CLASS_SUFFIX = ".class";
    private final static String BAD_PACKAGE_ERROR = "Unable to get resources from path '%s'. Are you sure the given '%s' package exists?";

    public final static List<Class<?>> find(final String scannedPackage) {
        final ClassLoader classLoader = Thread.currentThread().getContextClassLoader();
        final String scannedPath = scannedPackage.replace(DOT, SLASH);
        final Enumeration<URL> resources;
        try {
            resources = classLoader.getResources(scannedPath);
        } catch (IOException e) {
            throw new IllegalArgumentException(String.format(BAD_PACKAGE_ERROR, scannedPath, scannedPackage), e);
        }
        final List<Class<?>> classes = new LinkedList<Class<?>>();
        while (resources.hasMoreElements()) {
            final File file = new File(resources.nextElement().getFile());
            classes.addAll(find(file, scannedPackage));
        }
        return classes;
    }

    private final static List<Class<?>> find(final File file, final String scannedPackage) {
        final List<Class<?>> classes = new LinkedList<Class<?>>();
        if (file.isDirectory()) {
            for (File nestedFile : file.listFiles()) {
                classes.addAll(find(nestedFile, scannedPackage));
            }
        //File names with the $1, $2 holds the anonymous inner classes, we are not interested on them. 
        } else if (file.getName().endsWith(CLASS_SUFFIX) && !file.getName().contains("$")) {

            final int beginIndex = 0;
            final int endIndex = file.getName().length() - CLASS_SUFFIX.length();
            final String className = file.getName().substring(beginIndex, endIndex);
            try {
                final String resource = scannedPackage + DOT + className;
                classes.add(Class.forName(resource));
            } catch (ClassNotFoundException ignore) {
            }
        }
        return classes;
    }

} 
```

要使用它，只需调用本示例中提到的 sp00n 的 find 方法：如果需要，我已经添加了类实例的创建。

```
List<Class<?>> classes = ClassFinder.find("com.package");

ExcelReporting excelReporting;
for (Class<?> aClass : classes) {
    Constructor constructor = aClass.getConstructor();
    //Create an object of the class type
    constructor.newInstance();
    //...
} 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2013-12-09T17:11:40.733

我刚写了一个util类，里面有测试方法，你可以看看~

IteratePackageUtil.java：

```
package eric.j2se.reflect;

import java.util.Set;

import org.reflections.Reflections;
import org.reflections.scanners.ResourcesScanner;
import org.reflections.scanners.SubTypesScanner;
import org.reflections.util.ClasspathHelper;
import org.reflections.util.ConfigurationBuilder;
import org.reflections.util.FilterBuilder;

/**
 * an util to iterate class in a package,
 * 
 * @author eric
 * @date Dec 10, 2013 12:36:46 AM
 */
public class IteratePackageUtil {
    /**
     * <p>
     * Get set of all class in a specified package recursively. this only support lib
     * </p>
     * <p>
     * class of sub package will be included, inner class will be included,
     * </p>
     * <p>
     * could load class that use the same classloader of current class, can't load system packages,
     * </p>
     * 
     * @param pkg
     *            path of a package
     * @return
     */
    public static Set<Class<? extends Object>> getClazzSet(String pkg) {
        // prepare reflection, include direct subclass of Object.class
        Reflections reflections = new Reflections(new ConfigurationBuilder().setScanners(new SubTypesScanner(false), new ResourcesScanner())
                .setUrls(ClasspathHelper.forClassLoader(ClasspathHelper.classLoaders(new ClassLoader[0])))
                .filterInputsBy(new FilterBuilder().includePackage(pkg)));

        return reflections.getSubTypesOf(Object.class);
    }

    public static void test() {
        String pkg = "org.apache.tomcat.util";

        Set<Class<? extends Object>> clazzSet = getClazzSet(pkg);
        for (Class<? extends Object> clazz : clazzSet) {
            System.out.println(clazz.getName());
        }
    }

    public static void main(String[] args) {
        test();
    }
} 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2017-06-29T06:17:21.920

`@RunWith(Parameterized.class)`使用 Maven 时， [Aleksander Blomskøld 的解决方案](https://stackoverflow.com/a/9571146)不适用于我的参数化测试。测试命名正确，并且在找到但未执行的位置：

```
-------------------------------------------------------
T E S T S
-------------------------------------------------------
Running some.properly.named.test.run.with.maven.SomeTest
Tests run: 0, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.123 sec 
```

[这里](https://stackoverflow.com/a/18450752/5930295)报告了一个类似的问题。

就我而言`@Parameters`，是在包中创建每个类的实例。在 IDE 中本地运行时，测试运行良好。但是，在运行 Maven 时，没有找到使用 Aleksander Blomskøld 解决方案的类。

我确实使它与以下片段一起工作，该片段的灵感来自 David Pärsson 对 Aleksander Blomskøld 的回答的评论：

```
Reflections reflections = new Reflections(new ConfigurationBuilder()
            .setScanners(new SubTypesScanner(false /* don't exclude Object.class */), new ResourcesScanner())
            .addUrls(ClasspathHelper.forJavaClassPath()) 
            .filterInputsBy(new FilterBuilder()
            .include(FilterBuilder.prefix(basePackage))));

Set<Class<?>> subTypesOf = reflections.getSubTypesOf(Object.class); 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2015-09-28T17:51:49.607

几乎所有答案都使用`Reflections`或从文件系统读取类文件。如果您尝试从文件系统中读取类，则在将应用程序打包为 JAR 或其他格式时可能会出错。此外，您可能不想为此目的使用单独的库。

这是另一种纯java方法，不依赖于文件系统。

```
import javax.tools.JavaFileObject;
import javax.tools.StandardJavaFileManager;
import javax.tools.StandardLocation;
import javax.tools.ToolProvider;
import java.io.File;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.regex.Pattern;
import java.util.stream.Collectors;
import java.util.stream.StreamSupport;

public class PackageUtil {

    public static Collection<Class> getClasses(final String pack) throws Exception {
        final StandardJavaFileManager fileManager = ToolProvider.getSystemJavaCompiler().getStandardFileManager(null, null, null);
        return StreamSupport.stream(fileManager.list(StandardLocation.CLASS_PATH, pack, Collections.singleton(JavaFileObject.Kind.CLASS), false).spliterator(), false)
                .map(javaFileObject -> {
                    try {
                        final String[] split = javaFileObject.getName()
                                .replace(".class", "")
                                .replace(")", "")
                                .split(Pattern.quote(File.separator));

                        final String fullClassName = pack + "." + split[split.length - 1];
                        return Class.forName(fullClassName);
                    } catch (ClassNotFoundException e) {
                        throw new RuntimeException(e);
                    }

                })
                .collect(Collectors.toCollection(ArrayList::new));
    }
} 
```

**Java 8 不是必须的**。您可以使用 for 循环而不是流。你可以像这样测试它

```
public static void main(String[] args) throws Exception {
    final String pack = "java.nio.file"; // Or any other package
    PackageUtil.getClasses(pack).stream().forEach(System.out::println);
} 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2019-11-18T09:50:09.170

我找不到这么简单的东西剪短的工作。所以就在这里，我在搞砸了一段时间后自己做了：

```
 Reflections reflections =
        new Reflections(new ConfigurationBuilder()
                .filterInputsBy(new FilterBuilder().includePackage(packagePath))
                .setUrls(ClasspathHelper.forPackage(packagePath))
                .setScanners(new SubTypesScanner(false)));

    Set<String> typeList = reflections.getAllTypes(); 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2010-03-03T18:32:21.037

如果您没有使用任何动态类加载器，您可以搜索类路径并为每个条目搜索目录或 JAR 文件。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2015-12-15T14:51:41.223

^(值得一提)

如果您想拥有某个包下所有类的列表，可以使用`Reflection`以下方式：

```
List<Class> myTypes = new ArrayList<>();

Reflections reflections = new Reflections("com.package");
for (String s : reflections.getStore().get(SubTypesScanner.class).values()) {
    myTypes.add(Class.forName(s));
} 
```

这将创建一个类列表，稍后您可以根据需要使用它们。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2017-05-26T13:06:42.600

这是非常有可能的，但是没有像`Reflections`它这样的额外库很难......
这很难，因为你没有完整的工具来获取类名。
而且，我拿了我`ClassFinder`班级的代码：

```
package play.util;

import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Enumeration;
import java.util.List;
import java.util.jar.JarEntry;
import java.util.jar.JarFile;

/**
 * Created by LINKOR on 26.05.2017 in 15:12.
 * Date: 2017.05.26
 */
public class FileClassFinder {
private JarFile file;
private boolean trouble;
public FileClassFinder(String filePath) {
    try {
        file = new JarFile(filePath);
    } catch (IOException e) {
        trouble = true;
    }
}

public List<String> findClasses(String pkg) {
    ArrayList<String> classes = new ArrayList<>();
    Enumeration<JarEntry> entries = file.entries();
    while (entries.hasMoreElements()) {
        JarEntry cls = entries.nextElement();
        if (!cls.isDirectory()) {
            String fileName = cls.getName();
            String className = fileName.replaceAll("/",         ".").replaceAll(File.pathSeparator, ".").substring(0, fileName.lastIndexOf('.'));
            if (className.startsWith(pkg)) classes.add(className.substring(pkg.length() + 1));
        }
    }
    return classes;
}
} 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2014-08-29T16:57:38.033

基于[@Staale 的回答](https://stackoverflow.com/a/520339)，为了不依赖第三方库，我将通过检查第一个包的物理位置来实施文件系统方法：

```
import java.io.File;
import java.io.FileFilter;
import java.util.ArrayList;
...
Class<?>[] foundClasses = new Class<?>[0];
final ArrayList<Class<?>> foundClassesDyn = new ArrayList<Class<?>>();

new java.io.File(
    klass.getResource(
        "/" + curPackage.replace( "." , "/")
    ).getFile()
).listFiles(
    new java.io.FileFilter() {
        public boolean accept(java.io.File file) {
            final String classExtension = ".class";

            if ( file.isFile()
                && file.getName().endsWith(classExtension)
                // avoid inner classes
                && ! file.getName().contains("$") )
            {
                try {
                    String className = file.getName();
                    className = className.substring(0, className.length() - classExtension.length());
                    foundClassesDyn.add( Class.forName( curPackage + "." + className ) );
                } catch (ClassNotFoundException e) {
                    e.printStackTrace(System.out);
                }
            }

            return false;
        }
    }
);

foundClasses = foundClassesDyn.toArray(foundClasses); 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2019-05-27T21:22:11.583

纯java：*FindAllClassesUsingPlainJavaReflectionTest.java*

```
@Slf4j
class FindAllClassesUsingPlainJavaReflectionTest {

  private static final Function<Throwable, RuntimeException> asRuntimeException = throwable -> {
    log.error(throwable.getLocalizedMessage());
    return new RuntimeException(throwable);
  };

  private static final Function<String, Collection<Class<?>>> findAllPackageClasses = basePackageName -> {

    Locale locale = Locale.getDefault();
    Charset charset = StandardCharsets.UTF_8;
    val fileManager = ToolProvider.getSystemJavaCompiler()
                                  .getStandardFileManager(/* diagnosticListener */ null, locale, charset);

    StandardLocation location = StandardLocation.CLASS_PATH;
    JavaFileObject.Kind kind = JavaFileObject.Kind.CLASS;
    Set<JavaFileObject.Kind> kinds = Collections.singleton(kind);
    val javaFileObjects = Try.of(() -> fileManager.list(location, basePackageName, kinds, /* recurse */ true))
                             .getOrElseThrow(asRuntimeException);

    String pathToPackageAndClass = basePackageName.replace(".", File.separator);
    Function<String, String> mapToClassName = s -> {
      String prefix = Arrays.stream(s.split(pathToPackageAndClass))
                            .findFirst()
                            .orElse("");
      return s.replaceFirst(prefix, "")
              .replaceAll(File.separator, ".");
    };

    return StreamSupport.stream(javaFileObjects.spliterator(), /* parallel */ true)
                        .filter(javaFileObject -> javaFileObject.getKind().equals(kind))
                        .map(FileObject::getName)
                        .map(fileObjectName -> fileObjectName.replace(".class", ""))
                        .map(mapToClassName)
                        .map(className -> Try.of(() -> Class.forName(className))
                                             .getOrElseThrow(asRuntimeException))
                        .collect(Collectors.toList());
  };

  @Test
  @DisplayName("should get classes recursively in given package")
  void test() {
    Collection<Class<?>> classes = findAllPackageClasses.apply(getClass().getPackage().getName());
    assertThat(classes).hasSizeGreaterThan(4);
    classes.stream().map(String::valueOf).forEach(log::info);
  }
} 
```

PS：为了简化处理错误等的样板，我在这里`vavr`和`lombok`库中使用

其他实现可以在[我的 GitHub daggerok/java-reflection-find-annotated-classes-or-methods repo 中找到](https://github.com/daggerok/java-reflection-find-annotated-classes-or-methods/tree/master/src/test/java/com/github/daggerok)

* * *

## 回答 #26

> 赞同：-1
> 
> 时间：2017-10-04T22:22:50.170

如果您只是想加载一组相关的类，那么 Spring 可以帮助您。

Spring 可以在一行代码中实例化实现给定接口的所有类的列表或映射。列表或映射将包含实现该接口的所有类的实例。

话虽如此，作为从文件系统中加载类列表的替代方法，只需在要加载的所有类中实现相同的接口，而不管包如何，并使用 Spring 为您提供所有这些类的实例。这样，您可以加载（和实例化）所有您想要的类，而不管它们在什么包中。

另一方面，如果您想要将它们全部放在一个包中，那么只需让该包中的所有类都实现给定的接口。

请注意，接口本身不必声明任何方法 - 它可以完全为空。

要注入实现给定接口的类列表，请使用以下代码行...

```
 @Autowired
  private List<ISomeInterface> implementationList; 
```

也可以使用 Spring 注入类的 Map。如果有兴趣了解如何阅读文档。

最后，我将提供另一种比搜索整个文件系统树更优雅的解决方案。

创建一个自定义注释来构建应用它的类的目录 - 类似于@ClassCatalog。

* * *

## 回答 #27

> 赞同：-5
> 
> 时间：2009-02-06T13:46:48.817

这是不可能的，因为可能不会加载包中的所有类，而您总是知道类的包。

# struts - 在 fa forward 中使用前缀作为参数

> ID：520329
> 
> 赞同：0
> 
> 时间：2009-02-06T13:43:39.070
> 
> 标签：struts

有什么方法可以使用前缀作为参数或在转发路径中，例如：

```
<forward name="test" path="/switch.do&page='/test.do'&prefix='/test'"/> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-12-16T06:47:42.757

我不确定 是什么意思`prefix`，我假设您指的是 servlet 的名称。假设您将其作为映射的一部分*转发：*`struts-config.xml``action`

```
<forward name="test" path="/switch" /> 
```

如果您想获得可用于您的操作的*前锋*名称，您可以使用`mapping.findForwards()`.

如果您已经有一个`forward`，例如：

```
ActionForward forward = mapping.findForward("test"); 
```

您可以通过以下方式获取前锋的名称：

```
String fwdName = forward.getName(); // returns "test" 
```

以及 servlet 名称或路径：

```
String servletPath = forward.getPath(); // returns "/switch.do" 
```

您也可以从`request`对象中获取它：

```
String servletPath = request.getServletPath(); 
```

好的，现在，如果您想在将控制权返回给 Struts 之前修改转发，以便您可以附加额外的参数，您需要`ActionForward`基于您定义的转发之一创建一个新的`struts-config.xml`，例如：

```
ActionForward forward = mapping.findForward("test");
StringBuilder path = new StringBuilder(forward.getPath());
path.append("?id=");
path.append(someobject.getId());
return new ActionForward(path.toString(), true); // `true` means "do a redirect" 
```

这将告诉 Struts 发出重定向到一个 URL，例如`/switch.do?id=3`

知道如何创建一个新的`ActionForward`，以及如何获取转发的名称和它们指向的 servlet 名称，构建所需的转发应该不会有问题。

# sql-server - 在 SQL Server 2005 中创建具有默认值的类型并检查约束

> ID：520338
> 
> 赞同：3
> 
> 时间：2009-02-06T13:47:55.677
> 
> 标签：sql-server, sql-server-2005

在 MSSQL 2005 中创建具有默认值和要在多个列中使用的检查约束的类型的推荐方法是什么？

我不想为每一列添加检查约束和默认值。

我的第一个想法是创建一个默认值和一个绑定到这种类型的规则，但在线书籍明确指出我们应该避免使用 CREATE DEFAULT 和 CREATE RULE 进行新开发，因为这些命令将在未来的版本中删除。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-06T18:46:38.773

是的，很好。幸运的是，它仍然是 SQL Server 2008 的全部。Robyn Page 的 Simple-Talk 文章解释了这一切

[Robyn Page 的 SQL Server 数据验证工作台](http://www.simple-talk.com/sql/learn-sql-server/robyn-pages-sql-server-data-validation-workbench/)

（我觉得我帮了她一点）只需创建一个**Type**，并将默认值和规则绑定到它。

弃用问题有点可惜。所发生的一切就是**rules**、**types**和**default**都违反了 SQL 标准。现在首选的方法是使用约束来做同样的事情，但是如果您需要在多个表中统一执行它，那么它就不那么优雅了。此外，只有像 Joe Celko 这样的人才能完全理解约束。当然，我不知道。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T17:26:37.250

也许您可以使用用户定义的数据类型来完成它，但即便如此，您也必须更改所有列的数据类型

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-06T17:43:04.237

我使用 CREATE TYPE 和 CREATE RULE 来设置默认约束，但不是默认值；这仍然在桌面级别完成，但没有充分的理由不能这样做。我还喜欢使用命名的表级约束，而不是依赖系统生成的列级语法名称。

我将此模板脚本用于我的片段引擎；“~~”是替换参数分隔符：

```
IF NOT EXISTS
(
    SELECT
        *
    FROM
        INFORMATION_SCHEMA.DOMAINS d
    WHERE
        (d.DOMAIN_CATALOG = DB_NAME()) AND
        (d.DOMAIN_SCHEMA = N'~~Schema.Name~~') AND
        (d.DOMAIN_NAME = N'Type~~TypeAndRule.Name~~')
)
BEGIN
    PRINT N'  ~~Schema.Name~~.Type~~TypeAndRule.Name~~, ~~Schema.Name~~.Rule~~TypeAndRule.Name~~';

    EXEC sp_executesql @statement = N'CREATE TYPE ~~Schema.Name~~.Type~~TypeAndRule.Name~~ FROM ~~baseTypeDef~~ NOT NULL;';
    EXEC sp_addextendedproperty N'MS_Description', N'Encapsulates XXX.', N'SCHEMA', N'~~Schema.Name~~', N'TYPE', N'Type~~TypeAndRule.Name~~';

    EXEC sp_executesql @statement = N'CREATE RULE ~~Schema.Name~~.Rule~~TypeAndRule.Name~~ AS (@value ~~atValueComparison~~);';
    EXEC sp_addextendedproperty N'MS_Description', N'Enforces XXX.', N'SCHEMA', N'~~Schema.Name~~', N'RULE', N'Rule~~TypeAndRule.Name~~';

    EXEC sp_bindrule @rulename = N'~~Schema.Name~~.Rule~~TypeAndRule.Name~~', @objname = N'~~Schema.Name~~.Type~~TypeAndRule.Name~~';
END;
GO 
```

1.  `TypeAndRule.Name`是基本名称。
2.  `Schema.Name`是模式；例如dbo。
3.  `baseTypeDef`是底层类型定义；例如 int 或 nvarchar(50)。
4.  `atValueComparison`是约束表达式。
5.  IF NOT EXISTS 条件允许脚本多次运行而不会出错。

CREATE TYPE/RULE 语句最初在 SQL 2005 时间范围内被弃用并且仍然存在。我怀疑它们会在 2015 年之前的任何时候导致脚本错误，因为 MS 必须保持向后兼容性:-)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-11T18:11:20.077

我正在使用 SQL CLR 集成，我们的想法是我们使用 (char, int) 等通用类型存储数据，然后使用约束将数据上下文化，特别是“检查”约束。

在 Visual Studio 数据库项目 (C#) 中创建一个数据类型，该数据类型在内部将值存储为原始类型（例如 int、float、string 等），但会限制可以构造它的值。例如，如果你有一个 Score 类型，如果值超出 0 到 100 的范围，构造函数会抛出一个错误，确保只有有效的 Score 对象可以存在。

您在数据库表中的检查约束只涉及调用一个 CLR 函数（您也将在数据库项目中创建该函数），该函数只是尝试使用您传递给它的新列值构造 C# 数据类型的实例。如果构造了值，则该函数成功，如果构造函数抛出错误，则该函数失败。

然后，您有一个受约束的数据类型，集中在您的 C# 代码中，可在整个应用程序中使用，它还强制数据库中的值。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2009-02-06T14:04:32.167

使用检查约束

例子

```
create table bla (value varchar(50) 
default 'A' 
constraint CheckValue check (len(value) > 0))
go
insert bla default values
go
insert bla values('1')
go
insert bla values('') --will fail
go 
```

# c# - 如何检查网络连接？

> ID：520347
> 
> 赞同：113
> 
> 时间：2009-02-06T13:51:00.663
> 
> 标签：c#, networking

确定是否有可用的网络连接的最佳方法是什么？

* * *

## 回答 #1

> 赞同：180
> 
> 时间：2011-12-01T16:54:06.363

标记的答案是 100% 没问题，但是，在某些情况下，标准方法会被虚拟卡（虚拟盒子……）所欺骗。通常还需要根据其速度（串行端口、调制解调器等）丢弃一些网络接口。

这是检查这些情况的一段代码：

```
 /// <summary>
    /// Indicates whether any network connection is available
    /// Filter connections below a specified speed, as well as virtual network cards.
    /// </summary>
    /// <returns>
    ///     <c>true</c> if a network connection is available; otherwise, <c>false</c>.
    /// </returns>
    public static bool IsNetworkAvailable()
    {
        return IsNetworkAvailable(0);
    }

    /// <summary>
    /// Indicates whether any network connection is available.
    /// Filter connections below a specified speed, as well as virtual network cards.
    /// </summary>
    /// <param name="minimumSpeed">The minimum speed required. Passing 0 will not filter connection using speed.</param>
    /// <returns>
    ///     <c>true</c> if a network connection is available; otherwise, <c>false</c>.
    /// </returns>
    public static bool IsNetworkAvailable(long minimumSpeed)
    {
        if (!NetworkInterface.GetIsNetworkAvailable())
            return false;

        foreach (NetworkInterface ni in NetworkInterface.GetAllNetworkInterfaces())
        {
            // discard because of standard reasons
            if ((ni.OperationalStatus != OperationalStatus.Up) ||
                (ni.NetworkInterfaceType == NetworkInterfaceType.Loopback) ||
                (ni.NetworkInterfaceType == NetworkInterfaceType.Tunnel))
                continue;

            // this allow to filter modems, serial, etc.
            // I use 10000000 as a minimum speed for most cases
            if (ni.Speed < minimumSpeed)
                continue;

            // discard virtual cards (virtual box, virtual pc, etc.)
            if ((ni.Description.IndexOf("virtual", StringComparison.OrdinalIgnoreCase) >= 0) ||
                (ni.Name.IndexOf("virtual", StringComparison.OrdinalIgnoreCase) >= 0))
                continue;

            // discard "Microsoft Loopback Adapter", it will not show as NetworkInterfaceType.Loopback but as Ethernet Card.
            if (ni.Description.Equals("Microsoft Loopback Adapter", StringComparison.OrdinalIgnoreCase))
                continue;

            return true;
        }
        return false;
    } 
```

* * *

## 回答 #2

> 赞同：157
> 
> 时间：2009-02-06T13:53:25.277

您可以使用以下命令检查 .NET 2.0 中的网络连接[`GetIsNetworkAvailable()`](http://msdn.microsoft.com/en-us/library/system.net.networkinformation.networkinterface.getisnetworkavailable.aspx)：

```
System.Net.NetworkInformation.NetworkInterface.GetIsNetworkAvailable() 
```

要监视 IP 地址的变化或网络可用性的变化，请使用[NetworkChange](http://msdn.microsoft.com/en-us/library/system.net.networkinformation.networkchange.aspx)类中的事件：

```
System.Net.NetworkInformation.NetworkChange.NetworkAvailabilityChanged
System.Net.NetworkInformation.NetworkChange.NetworkAddressChanged 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2012-01-09T14:51:39.867

Microsoft windows vista 和 7 使用 NCSI（网络连接状态指示器）技术：

1.  NCSI 在 www.msftncsi.com 上执行 DNS 查找，然后请求[http://www.msftncsi.com/ncsi.txt](http://www.msftncsi.com/ncsi.txt)。此文件是纯文本文件，仅包含文本“ *Microsoft NCSI* ”。
2.  NCSI 为 dns.msftncsi.com 发送 DNS 查找请求。此 DNS 地址应解析为 131.107.255.255。如果地址不匹配，则假定 Internet 连接无法正常工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-07-04T08:09:03.863

调用此方法检查网络连接。

```
public static bool IsConnectedToInternet()
        {
            bool returnValue = false;
            try
            {

                int Desc;
                returnValue = Utility.InternetGetConnectedState(out Desc, 0);
            }
            catch
            {
                returnValue = false;
            }
            return returnValue;
        } 
```

把它放在代码行下面。

```
[DllImport("wininet.dll")]
        public extern static bool InternetGetConnectedState(out int Description, int ReservedValue); 
```

# java - 浏览器关闭时 Servlet 长处理取消

> ID：520348
> 
> 赞同：8
> 
> 时间：2009-02-06T13:51:29.040
> 
> 标签：java, http, servlets, jakarta-ee, browser

我有一个长时间处理请求的 servlet。它假设在 doPost 内部的循环中继续做事，并通过响应的输出写入器发送数据。有效地在客户端浏览器中持续添加数据。但是当客户端只是关闭浏览器时，问题就会出现。尽管连接断开，servlet 中的响应写入器流永远不会关闭，因此 servlet 不知道 brocen 连接，并继续将数据转储到写入器中而没有任何错误。这怎么可能？以及如何在浏览器断开连接的情况下检测并取消长请求处理？

我认为响应编写器上的 checkError() 应该可以解决问题，但它无法正常工作。任何想法为什么？

这是永不停止的 servlet 代码：

```
protected void processRequest(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException
{
   HttpSession session = request.getSession();
   System.out.println("Session " + session.getId() + " started");

   response.setContentType("text/html;charset=UTF-8");

   PrintWriter out = response.getWriter();
   try
   {
       while (!out.checkError())
       {
           try
           {
               Thread.sleep(1000);
           } catch (InterruptedException ex)
           {
               ex.printStackTrace();
           }

           Date date = new Date();

           // TODO append output to the client browser here
           out.println(".....");

           System.out.println("Session " + session.getId() + "data sent at: " + date);

           out.flush();
       //break;  // _TEST
       }
   } finally
   {
       System.out.println("Session " + session.getId() + " finished");
       out.close();
   }
} 
```

谢谢，
迈克

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-06T14:06:58.493

处理这个问题的唯一真正方法是让浏览器不断告诉你它仍然存在，比如每 5-10 秒。如果你一分钟没有听到任何声音，你就认为客户已经走了，忘记了你在做什么。

有几种方法可以实现这一点：

*   元刷新：我不喜欢这样，因为它让用户感到不安和明显；
*   执行此操作的 iframe（不太明显）；或者
*   一些 AJAX 技术，这可能是最好的选择。

没有真正的方法可以检测客户端是否仍在阅读您发送的内容。TCP 连接断开需要时间，并且到客户端的路径通常是间接的（通过代理等），所以忘记检测它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-06T14:07:34.593

servlet 有一个输出缓冲区，必须在数据实际发送到浏览器之前填满。如果这个缓冲区没有被填满，那么网络上实际上没有数据发送。在您在网络上发送数据之前，您不会知道连接已关闭。

您可以通过在获取输出流或写入器**之前**调用响应对象上的方法来设置缓冲区大小。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-06T19:08:07.763

您正在尝试做一些不受 HTTP 协议支持的事情。Web 的整个本质是基于请求/响应。

模拟所需内容的一种方法是使用 Ajax。流程将是这样的：

1.  浏览器使用 Ajax 发送对项目 1 到 10 的请求
2.  服务器处理请求，构建并发送包含 1 到 10 项的响应。
3.  浏览器接收响应，解析结果，显示项目 1 到 10 并重复步骤 1，请求项目 11 到 20。

这种架构将消除检查客户端“可用性”的需要，并且还将提高服务器端组件的可伸缩性。

我希望它有所帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-17T17:00:36.747

java.io.PrintWriter javadoc sez：这个类中的方法从不抛出 I/O 异常 - 所以使用 javax.servlet.SocketOutputStream (response.getOutputStream()) 代替，你最终会得到一些 IOException。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-09-06T10:40:48.833

`checkError`您的一般方法对我有用（我有一个长时间运行的服务器任务，如果客户端挂断，使用，在一些合理的音量发送失败后中止就好了）。我只能建议您更新到最新的 Java 版本。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-04-27T14:03:37.667

我们遇到了类似的问题。在我们的例子中，是启用了 ESI 的网络服务器 ( [http://www-01.ibm.com/support/docview.wss?uid=swg27015501](http://www-01.ibm.com/support/docview.wss?uid=swg27015501) )。我们做了一个 TCP 转储来查看那里发生了什么，并看到 RES 包（在浏览器关闭后）从未发送回应用程序。网络服务器收到了它，但没有进一步发送。因此，printer.checkError() 从未返回 true，并且打印机一直在刷新数据。禁用此功能后，RES 包被发送到应用程序，一段时间后，printer.checkError() 返回 true。这就是为什么我偶然发现了你的问题。它一直发送3次。之后它 checkError() 返回 true。

# c# - 如何获得类似于 SQL Server 2008 中的 SERIAL PG 数据类型的内容？

> ID：520359
> 
> 赞同：0
> 
> 时间：2009-02-06T13:54:30.080
> 
> 标签：c#, linq-to-sql, sql-server-2008, postgresql

我正在帮助实现一个 SQL Server 2008 数据库，我有几列我想默认为序列中的下一个数字，但仍然可以随意手动插入数字。在 PostgreSQL 中，这是通过 SERIAL 数据类型和序列来完成的。不幸的是，这些东西在 SQL Server 中不存在。这是我所知道的行不通的。

1.  除非您将 IDENTITY_INSERT 设置为 on，否则标识列不允许插入。在这种情况下，它可以按需要工作，但根据[MSDN](http://msdn.microsoft.com/en-us/library/aa259221(SQL.80).aspx) ，此属性一次只能在一个表上设置，我想为多个表执行此操作。
2.  可以将函数设置为字段的默认值，但是由于函数无法在数据库中设置值，因此一旦设置了当前值，就无法更新计数。
3.  存储过程可用于增加数字并将其返回，但不能将它们设置为列的默认值。

我现在采取的解决方法是简单地创建一个存储过程，该过程返回我想要的值并将其编码到 LINQ API 中，以便它自动发生。这会产生一些我想删除的样板代码。

在 SQL Server 中我想要什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-06T14:02:01.500

不，身份列或自己滚动基本上是您的选择。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T14:33:36.100

有充分的理由不这样做——你必须实现 SQL 所做的所有锁定规则以确保你获得一个唯一的值——如果值必须返回到你的数据中，这样做可能会产生性能成本或业务层（例如，您可以在保存之前在内存中构建对象图）。

如果您真的想在内存中构建一个完整的对象图，然后一次性保存它，另一种方法是使用 GUID，但它们有自己的缺点。

# python - 在网站上搜索文件和目录

> ID：520362
> 
> 赞同：0
> 
> 时间：2009-02-06T13:55:31.963
> 
> 标签：python

嗨，我正在编码编码一个搜索 Dirs 和文件的工具。

已经这样做了，该工具会搜索目录，但需要帮助才能使其在网站上搜索文件。

知道它是如何在 python 中的吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-06T14:00:58.087

该工具是在扫描您自己网站（正在运行该工具的网站）的目录还是外部网站？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-06T14:10:02.200

只有当您有权浏览站点上的目录并且不存在默认页面时，您才能执行此操作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-06T14:17:46.227

您无法在网站上获得目录列表。

迂腐地，HTTP 没有目录的概念。

实际上，WebDAV 提供了一个目录列表动词，因此如果启用了 WebDAV，您就可以使用它。

否则，您可以做的最接近的事情类似于递归 wget 所做的事情：获取页面，解析 HTML，查找超链接（`a/@href`在 xpath 中），过滤掉不指向当前页面下方 URL 的超链接，递归到剩余页面网址。

您可以根据您的用例进行进一步过滤，例如删除 URL 的查询部分（第一个之后的任何内容`?`）。

当服务器启用了目录列表功能时，这将为您提供一些可用的东西。如果网站没有目录列表但以合理的方式组织，这也为您提供了一些有用的东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-06T14:55:31.250

如果您在自己的网站上获取信息以在您自己的 Web 应用程序中展示，您应该使用 os.walk。

有关详细信息，请参阅[http://www.python.org/doc/2.5.2/lib/os-file-dir.html](http://www.python.org/doc/2.5.2/lib/os-file-dir.html)。

# datasource - 什么统计框架/工具与来自不同来源的数据一起使用

> ID：520364
> 
> 赞同：0
> 
> 时间：2009-02-06T13:56:30.747
> 
> 标签：datasource, statistics

我有很多数据源（postgres 数据库、日志文件）包含统计数据或包含可以从中计算统计数据的数据。

我正在寻找一个应用程序，您可以在其中设计新的报告/输出（图形、表格等），而无需使用编程语言而是使用 gui。您应该能够保存这些查询并稍后重新运行它们。网络应用（或网络服务）会比离线应用更好。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-06T14:08:55.370

您可能想查看[R（链接） （](http://www.r-project.org/) [S 或 S-Plus](http://www.insightful.com/)的免费版本）或[SPSS](http://www.spss.com/) 。并且不要遗漏好的旧 Excel（或像 Open Office 这样的免费克隆）。当与“获取外部数据”选项结合使用时，无需太多代码即可完成惊人的数量。

还有其他更特定于某些领域，例如金融。

但是，几乎所有统计数据都足够依赖于数据，您需要某种编程/脚本语言。纯粹的视觉解决方案通常不会做你想做的事。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-05T08:29:44.707

我最近遇到了一个在线数据可视化网站[Verifiable](http://www.verifiable.com) - 没有使用过它，但从开始页面上的截屏视频来看，它似乎有一些有用的摘要统计信息。

如果您的数据不属于机密，则可能值得一试...

一些昂贵但精巧的产品是：

*   [Spotfire](http://spotfire.tibco.com/Products/Info.aspx)（高级数据分析）
*   [顾问](http://www.visualinsights.com/products.htm)（商业智能）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-11T14:32:31.107

没有编程语言？好吧，这占据了大部分市场，甚至提到的一些工具（excel 等）都需要一些 VBA 才能让它们像您期望的那样进行预成型。

如果您有一些资金，我建议您查看 SAS EGuide。它是一个点击式的 GUI 界面，允许您从 ANYWHERE 提取数据并在界面中进行操作。所谓的“项目”可以保存和重复使用。

我最好的建议是使用具有此类报告/分析经验的代理合作伙伴。我在这样的公司工作。如果我们能提供帮助，请记住我们。( [http://www.AFHood.com](http://www.AFHood.com) )

# sharepoint - 女士 SharePoint 2007 模板自定义

> ID：520375
> 
> 赞同：1
> 
> 时间：2009-02-06T14:01:34.213
> 
> 标签：sharepoint, sharepoint-2007, templates, ide-customization

从微软网站下载免费模板后，我想将两个模板的一些功能结合在一起。例如，有一个“联系人管理”模板和一个“营销网站”模板。每个模板都有自己的“联系人部分/表格”。

理想情况下，我希望在我的 SharePoint 服务器上使用这两个模板，同时让它们引用相同的联系人。同样，目前每个人都有自己的联系人。

我希望这是一项相当简单的任务，但我对 SharePoint 还很陌生，不知道从哪里开始这项任务。我一直在环顾四周，但到目前为止还没有运气。任何帮助将不胜感激。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-06T17:57:12.663

我假设您指的是可以[从此处下载](http://www.microsoft.com/downloads/details.aspx?familyid=5807B5EF-57A1-47CB-8666-78C1363F127D&displaylang=en)的 Fantastic 40 模板。

我想说否则，但不幸的是，这不是一个简单的任务！没有现成的方法可以将两个不同的联系人列表链接到一组联系人。您当然可以开发这样的解决方案。

如果您想开始对 SharePoint 进行编程，[请查看此问题](https://stackoverflow.com/questions/501776/where-can-i-find-good-programming-resources-for-sharepoint)以获取一些有用的资源。[本文档](http://www.microsoft.com/downloads/details.aspx?FamilyId=C49A6B00-E0AA-4102-B585-B25CD3CBB383&displaylang=en)也可能有助于进一步研究模板本身。

# single-sign-on - 使用不同版本的 SAML 实施 SSO

> ID：520379
> 
> 赞同：2
> 
> 时间：2009-02-06T14:02:37.037
> 
> 标签：single-sign-on, saml

当两个不同的供应商都使用不同版本的 SAML 时，是否可以在两个不同的供应商之间建立 SSO。VendorA 使用 SAML 1.0 而 VendorB 使用 SAML 2.0 ？我们可以有一个中介来解释基于 SAML 版本的断言吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-06T20:48:14.970

我想您可以构建一个中介，从一个供应商那里获取 SAML 请求，对其进行身份验证，读取断言，然后使用它发送给下一个供应商的正确版本构建一个全新的 SAML 请求。但这似乎将是一个重大挑战。这里的问题是您不能只是将 SAML 请求从一个版本重新构建到另一个版本 - 这样做会使原始请求的签名无效。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-09T04:06:16.427

您可以使用[OpenSSO](http://opensso.org/)来使用 SAML 1.0 断言并创建一个 SAML 2.0 断言，反之亦然。过去我用 OpenSSO 做过类似的协议转换。OpenSSO 将信任 VendorA，而 VendorB 将信任 OpenSSO。

# c# - 是否有可下载的文档封装了 StyleCop 强制执行的核心规则？

> ID：520380
> 
> 赞同：4
> 
> 时间：2009-02-06T14:02:38.567
> 
> 标签：c#, coding-style, stylecop

是否有可下载的文档封装了 StyleCop 强制执行的核心规则？

我们已经决定使用 C#，并且我们将使用 FxCop 和 StyleCop 来执行设计和样式指南。为了帮助人们加快速度，我们希望确保他们手头有参考材料的印刷版本作为*休闲阅读材料，*所以我希望周围有规则参考的 PDF 版本。

到目前为止，我对 StyleCop 规则参考的搜索一直没有结果。如果有人知道这些规则是否可以作为合并文档（PDF、XPS 或其他一些可下载的单一参考）提供，我将不胜感激。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-06T14:14:41.600

规则列表在 codeplex 上以[.chm文件的形式提供：](http://en.wikipedia.org/wiki/HTML_help) [StyleCop 4.3 规则文档](http://code.msdn.microsoft.com/sourceanalysis/Release/ProjectReleases.aspx?ReleaseId=1425)

# jquery - jQuery $.get 有效，但 $.ajax 无效

> ID：520399
> 
> 赞同：1
> 
> 时间：2009-02-06T14:10:36.257
> 
> 标签：jquery

我是 jQuery 新手，我正在使用 ajax 请求来获取 xml 作为响应，

```
 $.get("testurl",pars,function(data){
      xml = data;
      $(xml).find("element").each(function(i,item){
        if(($(this).attr("id"))!= undefined){
        tab_str += "<tr><td>'id'</td><td>"+$(this).attr("id")+"</td></tr>";
        }
      });

   });//get 
```

在上面的代码中，我按预期返回了 xml。唯一的问题是我需要在其余代码执行之前完全构建我的表。所以我决定使用带有 async false 的 $.ajax 函数。但这一次我没有得到任何回报。（我检查了萤火虫控制台，它在响应部分显示了完整的 xml）

```
var xml = (  $.ajax({
               type: "GET",
               url: "testurl",
               data: pars,
               aysnc:false

             }).responseText); 
```

在上面的代码中，var xml 是空的。为什么是这样？难道我做错了什么？请帮忙。提前致谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-06T14:26:22.980

如果您在示例中复制并粘贴了代码，则您`async`拼错了`aysnc`. 如果没有该选项，它将异步运行。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-06T14:16:29.660

我猜您的回复没有足够快地返回？您是否尝试过使用 success: 参数设置 xml？

```
(  $.ajax({
       type: "GET",
       url: "testurl",
       data: pars,
       aysnc:false
       success: function () {
          //set the right stuff here
        }

     })); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-06T14:55:56.493

如果您使用 $.ajax 方法并且想要成功功能，则应将 dataType 选项设置为 xml。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-06T14:46:55.340

上帝，我觉得亚当很愚蠢，感谢您的指出。至少今天我不会设法抓住它:)

是的，我使用的是“aysnc”而不是“异步”

顺便说一句，我需要提到我喜欢这个论坛。我刚出去喝杯咖啡，我有两个回应......哇！你们真棒。非常感谢您的快速回复。

jdangel：我也试过了，很明显它没有用:)

# c# - 如何使用反射确定属性类型？

> ID：520400
> 
> 赞同：38
> 
> 时间：2009-02-06T14:10:43.573
> 
> 标签：c#, .net, reflection

如何测试类型的属性以查看它是否为指定类型？

编辑：我的目标是检查程序集以查看该程序集中的任何类型是否包含 MyType（或从 MyType 继承）的属性。

这是我走过的路...

```
AssemblyName n = new AssemblyName();
n.CodeBase = "file://" + dllName;
Assembly a = AppDomain.CurrentDomain.Load(n);

foreach (Type t in a.GetTypes())
    foreach (PropertyInfo pi in t.GetProperties())
        if ( pi.PropertyType is MyType ) // warning CS0184
            Console.WriteLine("Found a property that is MyType"); 
```

编译时带有警告 CS0184: The given expression never of the provided ('MyType') type

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2009-02-06T14:14:56.560

你对什么类型感兴趣？方法/属性/事件等的返回类型？

如果是这样，我认为没有任何东西`MemberInfo`可以让您直接使用它 - 您需要投射和使用`MethodInfo.ReturnType`, `PropertyInfo.PropertyType`,`FieldInfo.FieldType`以及`EventInfo.EventHandlerType`我忘记的任何其他内容。（请记住，类型本身可以是成员。不确定您要对它们做什么！）

编辑：如果您对特定类型是否代表 MyType 或某个子类感兴趣，请使用[Type.IsAssignableFrom](http://msdn.microsoft.com/en-us/library/system.type.isassignablefrom.aspx)：

```
if (typeof(MyType).IsAssignableFrom(type)) 
```

编辑：现在我们知道您需要属性，这很容易 - 使用 GetProperties 而不是 GetMembers。我喜欢用 LINQ 做反射：

```
var query = from type in assembly.GetTypes()
            from property in type.GetProperties()
            where typeof(MyType).IsAssignableFrom(property.PropertyType)
            select new { Type=type, Property=property };

foreach (var entry in query)
{
    Console.WriteLine(entry);
} 
```

如果你不是 LINQ 的粉丝：

```
foreach (Type t in a.GetTypes())
    foreach (PropertyInfo pi in t.GetProperties())
        if (typeof(MyType).IsAssignableFrom(pi.PropertyType))
            Console.WriteLine("Found a property that is MyType"); 
```

请注意，您可能希望指定绑定标志以获取非公共属性等。

* * *

## 回答 #2

> 赞同：48
> 
> 时间：2009-02-06T14:34:10.793

好的，也许我错过了一些愚蠢的东西，但不应该是：

```
if ( pi.PropertyType == typeof(MyType )) 
```

？？？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-06T14:21:07.920

有多种方法可以测试对象的类型：

1) 使用**is**运算符：

```
if (anObject is MyType) {
// anObject is MyType or a derived class
... 
} 
```

2) 使用**as**运算符：

```
MyType newObject = anObject as MyType;
if (newObject != null ) {
// newObject is anObject cast to MyType
...
} 
```

3) 使用 typeof() 和 GetType() [3 种变体]：

```
// #1
if (typeof(MyType) == anObject.GetType()) {
// anObject is a MyType
...
}

//#2
public static bool IsType(object obj, string type)
{// modified from Visual C# 2005 Recipes {Apress}
// Get the named type, use case-insensitive search, throw
// an exception if the type is not found.
Type t = Type.GetType(type, true, true);
return t == obj.GetType();
}

//#3
public static bool IsTypeOrSubclass(object obj, string type)
{// modified from Visual C# 2005 Recipes {Apress}
// Get the named type, use case-insensitive search, throw
// an exception if the type is not found.
Type t = Type.GetType(type, true, true);
return t == obj.GetType() || obj.GetType().IsSubclassOf(t);
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-06T14:18:06.210

我认为你需要这样的东西：

```
using System;
using System.Reflection;

namespace ConsoleApplication1{
    class Class1{

        static bool checkType(Type propertyType,Type myType){
            if (propertyType == myType){
                return true;
            }
            Type test = propertyType.BaseType;
            while (test != typeof(Object)){
                if (test == myType){
                    return true;
                }
                test = test.BaseType;
            }
            return false;
        }

        [STAThread]
        static void Main(string[] args){
            Assembly a = Assembly.GetExecutingAssembly();
            foreach (Type t in a.GetTypes()){
                Console.WriteLine("Type: {0}",t.Name);
                foreach (PropertyInfo p in t.GetProperties()){
                    if (checkType(p.PropertyType,typeof(MyType))){
                        Console.WriteLine("  Property: {0}, {1}",p.Name,p.PropertyType.Name);
                    }
                }
            }
        }
    }

    class MyType{
    }

    class MyType2 : MyType{
    }

    class TestType
    {
        public MyType mt{
            get{return _mt;}
            set{_mt = value;}
        }
        private MyType _mt;
        public MyType2 mt2
        {
            get{return _mt2;}
            set{_mt2 = value;}
        }
        private MyType2 _mt2;
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-06T14:19:19.063

您正在寻找：

```
if (typeof(mi) is MyType) { ... } 
```

对 ？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-04-26T18:17:19.013

这个来自另一个类似问题的例子大大简化了我的理解

`If p.PropertyType Is GetType(String) Then`

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-04-26T18:50:47.323

`is`在将某事物的实例与显式编写的类型进行比较时，您应该使用：

```
Department sales = new Department("Sales");

Debug.Assert(sales is Department); 
```

当你想比较 2 种类型并且你不能明确地写类型时，你应该使用 typeof：

```
private void CheckType(Type t)
{
    Debug.Assert(typeof(Department) == t);
} 
```

使用`is`将考虑继承，`typeof`不会。

```
public class Animal { }
public class Dog : Animal { }

public void Test()
{
    Dog d = new Dog();

    Debug.Assert(d is Animal); // true

    Debug.Assert(typeof(Dog) == typeof(Animal); // false
} 
```

如果要比较两种类型并考虑继承，可以使用`IsAssignableFrom`：

```
Debug.Assert(typeof(Animal).IsAssignableFrom(typeof(Dog))); // true 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-03-20T06:22:08.857

这是捷径

```
property.PropertyType.IsGenericType && (typeof(ICollection<>).IsAssignableFrom(property.PropertyType.GetGenericTypeDefinition()))
&& typeof(<YourType>).IsAssignableFrom(property.PropertyType.GenericTypeArguments[0]) 
```

# php - 在不知道底层文件系统的情况下在 PHP 中加载文件

> ID：520405
> 
> 赞同：0
> 
> 时间：2009-02-06T14:12:28.607
> 
> 标签：php

关于 PHP 的一个 ncie 事情是，如果您执行包含/要求，它会在文件所在的目录（或者更确切地说是请求的 URI）上工作。这意味着如果您想包含更多文件，则无需知道原始脚本的运行位置。您只需要知道当前脚本在哪里。

现在我想加载一个文本文件并处理它。file_get_contents() 似乎是一种明显的加载方式。问题是我没有同样的奢侈。我要么需要绝对指定文件路径，我不想这样做，要么我必须知道相对于发起调用的文件的位置，这我也不喜欢。

Require/include 似乎不适用于非 PHP 文件，并且无论如何都会回显内容（是的，我知道我可以将其包装在 ob_start() 等中）。

建议？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-06T14:21:51.023

您可以使用获取与当前文件关联的目录

```
dirname(__FILE__) 
```

所以你可以做这样的事情：

```
file_get_contents(dirname(__FILE__) . '/foo.txt') 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-06T14:18:41.730

使用您想要的文件路径定义一个常量，无论您通常将配置设置放在哪里。保持简单和可定制。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-06T14:19:11.747

一方面，请注意“相对路径”将来自当前正在运行的第一个 php 脚本的路径（无论什么文件可能正在执行“包含”）。无法指定相对路径听起来很奇怪......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-06T14:21:53.940

如果我正确理解了文档[`file_get_contents`](http://de2.php.net/file_get_contents)，您可以将`true`其作为第二个参数传递，并且将使用[include_path 。](http://de2.php.net/manual/en/ini.core.php#ini.include-path)所以，在我的系统上

```
echo file_get_contents('doc/DB/doc/STATUS', true); 
```

将从我的 PEAR 模块中回显 STATUS 文档，因为 /usr/share/pear 在我的 include_path 中。虽然我们正在这样做，但我不相信 include() 或 require() 将在相对路径上工作，除非 '.' 是 include_path 的一部分。我会检查一下。

更新：好的，我检查了。事实证明，无论 include_path 说什么，include() 都会始终考虑当前目录。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-06T14:20:08.420

必须知道事物的路径在网站世界中很常见。您可以存储路径的一部分，例如配置变量中的开头，例如 $config['include_dir']; 指定文件的路径就像说 include($_SERVER['DOCUMENT_ROOT'] . '/includes/myinclude.inc.php'); 一样简单。

我不知道你怎么知道要包含什么文件。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-06T14:20:27.280

您将需要绝对路径来打开文件。您可以使用 realpath() 将相对 url 路径转换为绝对路径。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-06T14:22:06.217

查看 $_SERVER 属性。 [http://us2.php.net/manual/en/reserved.variables.server.php](http://us2.php.net/manual/en/reserved.variables.server.php)

你要

```
$_SERVER['DOCUMENT_ROOT']; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-06T14:30:10.850

`require`/`include`正在从两个路径（当前脚本文件和初始执行的脚本文件）解析绝对路径：

> 首先在相对于当前工作目录的每个`include_path`条目中查找包含文件，然后在当前脚本的目录中查找。例如，如果您`include_path`是库，则当前工作目录是`/www/`，您包含`include/a.php`并且`include "b.php"`在该文件中有，`b.php`首先查看`/www/libraries/`然后在`/www/include/`. 如果`filename`以`./`or开头`../`，则仅在当前工作目录中查找。— [http://docs.php.net/include](http://docs.php.net/include)

但是使用绝对路径更好，因此 PHP 不需要“猜测”是指哪个文件。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-06T14:38:46.557

要回答您的问题，在我看来，您需要编写自己的包含等效项，以从任意数量的可能路径返回文件内容。在数组中配置一系列路径并让您的函数循环通过它，使用 file_exists() 并在找到文件时加载文件内容。

文件系统函数： [http ://us2.php.net/manual/en/ref.filesystem.php#73954](http://us2.php.net/manual/en/ref.filesystem.php#73954)

另请注意，文件系统路径分隔符有 php 常量，例如： DIRECTORY_SEPARATOR ，但是对于可移植文件路径，您并不需要它，因为正斜杠“/”在 Windows 上有效。

Ps：Symfony 中常用的获取绝对路径的技巧是：

```
$path = realpath(dirname(__FILE__)).'/whatever.txt'; 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-06T14:58:22.150

我不知道您是否可以控制要加载的文件的内容，但如果可以，您可以尝试使用 smarty 模板引擎（[http://www.smarty.net/](http://www.smarty.net/)）

您需要将 '{include file="relative/file/path.ext"}' 放在您尝试加载的文件中，但 smarty 至少会处理所有相对路径和混淆你。

PS：包含标签的文档在这里：[http ://www.smarty.net/manual/en/language.function.include.php](http://www.smarty.net/manual/en/language.function.include.php)

# wordpress - 如何检查帖子是否属于 Wordpress 中的类别

> ID：520412
> 
> 赞同：2
> 
> 时间：2009-02-06T14:14:50.523
> 
> 标签：wordpress

我需要检查某个帖子是否属于某个类别或属于某个类别的后代。是否有为此的wordpress功能，或者我需要自己做？

编辑：我应该提到 WP 版本是 2.7。对不起

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2010-08-11T20:30:35.967

> 对于 2.7 或更高版本，请使用 in_category( $category, $_post )

问候， 维姬·比斯瓦斯

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-06T14:51:42.087

```
$post = get_post($id);
$category = $post->$post_category;
cat_is_ancestor_of(($parent_category, $category)); 
```

有关更多信息，请参阅[get_post](http://codex.wordpress.org/Function_Reference/get_post)和[cat 是](http://codex.wordpress.org/Function_Reference/cat_is_ancestor_of)引用的祖先。此外，虽然有点难以找到，但对于大多数 wp 开发相关的事情来说，[这](http://codex.wordpress.org/Function_Reference)是一个很好的起点。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-07-21T15:49:33.143

另请参阅：http: [//codex.wordpress.org/Function_Reference/in_category#Testing_if_a_post_is_in_a_descendant_category](http://codex.wordpress.org/Function_Reference/in_category#Testing_if_a_post_is_in_a_descendant_category)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-14T17:37:19.300

sql 查询可以与 wordpress 2.8 一起使用吗？

# django - 在 django admin 中动态添加行到内联

> ID：520421
> 
> 赞同：3
> 
> 时间：2009-02-06T14:17:08.443
> 
> 标签：django, admin, inlines

我定义了以下内容：

```
class AnswerChoiceInline(admin.TabularInline):
    model = AnswerChoice
    # extra = 0

class QuestionAdmin(admin.ModelAdmin):
    inlines = [AnswerChoiceInline]

admin.site.register(Question, QuestionAdmin) 
```

显然我得到了默认的附加设置（默认为 3）。目前是否有内置在管理员中的方法来“添加另一行”到内联字段集中？所以我可以填写 3 行，如果我需要第 4 行，我可以单击链接或按钮，并让它添加额外的行？

现在，我的工作流程要么将“额外”设置为任意大的数字，然后只有空白行，要么让用户多次保存模型（以便显示额外的行）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-06T14:26:39.733

为什么是的，请查看Arne Brodowski 的[Add and remove Django Admin Inlines with Javascript](http://www.arnebrodowski.de/blog/507-Add-and-remove-Django-Admin-Inlines-with-JavaScript.html)。

# wpf - 为什么 XAML Margin 不遵循 CSS 规范？

> ID：520422
> 
> 赞同：22
> 
> 时间：2009-02-06T14:17:43.543
> 
> 标签：wpf, xaml, margin

在 CSS 中，边距顺序是：**右上左下**

在 XAML 中，边距顺序为：**左上右下**

WPF 团队没有将其与 CSS 规范保持一致是有原因的吗？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-02-06T14:28:09.433

我想这是因为 WinForms 中的边距被声明为左、上、右、下。他们可能认为 WinForms 开发人员更有可能转向 WPF 而不是来自 Web 的开发人员。

作为参考，您可以检查[MSDN 上的 Padding 结构的构造函数](http://msdn.microsoft.com/en-us/library/x17zs1da.aspx)（用于 Margin 属性的类型）。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-02-06T14:27:05.707

它们没有与 CSS 规范保持一致——它们与 Microsoft 过去完成 UI API 的方式保持一致。我不能代表 WinForms，但在 MFC 中，坐标是按 LTRB 的顺序指定的。

# algorithm - 特殊分配问题的有效解决方案

> ID：520426
> 
> 赞同：2
> 
> 时间：2009-02-06T14:18:14.697
> 
> 标签：algorithm, variable-assignment

鉴于：

- 一组物品，每个物品都有放入给定容器类型的成本。

- 一组容器类型，每个类型都有许多可用容器。

例子：

数量*容器类型：5 * A、3 * B、2 * C

项目（成本）：

3 * X (A=2, B=3, C=1)

2 * Y (A=5, B=2, C=2)

1 * Z (A=3, B=3, C=1)

问题：

找到物品在容器中的最佳放置位置，以使成本最小化。为简单起见，仅将项目放入单一类型的容器中。

我尝试了匈牙利方法来解决这个问题，但是运行时间为 O(n³)，对于大型问题（例如，100000 个项目）来说，这是非常令人望而却步的。

我目前的解决方案是一种贪婪的方法，它只是按成本 (asc) 对项目容器组合进行排序，并分配第一个容器，并在 O(n log n) 中剩余足够的数量。

有更好的解决方案吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-06T14:26:23.277

这个问题是[背包问题](http://en.wikipedia.org/wiki/Knapsack_problem)的变体，从维基百科页面开始，然后从那里继续阅读。

贪心算法被认为是一个相当好的近似值，所以你可能已经足够好了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T15:19:58.847

您是否尝试将[分配问题](http://en.wikipedia.org/wiki/Assignment_problem)编写为[线性程序](http://en.wikipedia.org/wiki/Linear_programming)并使用[单纯形算法求解](http://en.wikipedia.org/wiki/Simplex_algorithm)？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-06T14:22:30.867

考虑到基因组很容易产生、变异和杂交，我自然会选择遗传方法。但可能有一个最佳的非组合解决方案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-06T14:24:40.563

如果我理解你的问题正确，你只需要一些数学：

[http://en.wikipedia.org/wiki/Optimization_%28mathematics%29](http://en.wikipedia.org/wiki/Optimization_%28mathematics%29)

# asp.net - 将类组织到 App_Code 文件夹中的命名空间中未按预期工作

> ID：520429
> 
> 赞同：3
> 
> 时间：2009-02-06T14:19:08.000
> 
> 标签：asp.net, visual-studio

我为我的 Web 项目创建了几个类，并将它们存储在 App_Code 文件夹中。我不想将所有类存储在顶层（没有命名空间），但想将它们组织到命名空间中。到目前为止，这似乎不可能，因为当我使用“使用 XXXX;”时 命名空间声明它仍然无法在我的代码隐藏文件中找到正确的类。我可能做错了什么？

编辑：

所以例如我有

```
namespace foo
{
    public class bar
    {
    }
} 
```

然后在我的 default.aspx 页面后面的代码中我有

```
.
.
.
using foo

public partial class _Default : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        bar NewBar = new bar();
    }
} 
```

以上对我不起作用，我必须使用

```
foo.bar NewBar = new foo.bar(); 
```

有谁知道我做错了什么？

编辑：好的，所以我安装了 Visual Studio 2005 SP 1 并尝试将其转换为 Web 应用程序而不是网站。仍然没有运气。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-06T14:52:44.423

（我在这里猜）尝试打开文件的属性并将构建操作设置为“编译”。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-06T14:23:16.747

最简单的解决方案是将类放在类库中，然后从您的网站项目中引用它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-06T14:23:58.600

你放了吗

```
namespace blah
{
   ...
} 
```

在代码文件中？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-06T14:34:27.720

您使用的是网站项目，而不是 Web 应用程序项目。网站项目即时编译所有 .cs 文件（包括 App_Code 中的文件），以便您可以在 Web 服务器上更新它们，而无需重新编译它们。它们被编译成临时 dll，在正常情况下，这些对您来说是不可见的（即 bin 中没有任何内容）。正如您所发现的，在编写网站项目时，您几乎无法控制名称空间。如果您希望更好的结构化代码和对命名空间的更多控制，[请将其转换为 Web 应用程序项目](http://webproject.scottgu.com/CSharp/Migration2/Migration2.aspx)。您的服务器端代码将被编译成 dll 并放置在 bin 文件夹中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-06T17:48:52.027

我已经想通了。我真的很愚蠢。很抱歉让您担心。这是因为我的命名空间和类名相同，所以它无法区分并需要完全限定名。一旦我更改了类名，一切都按预期工作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-06T14:22:27.213

您是否尝试过首先构建项目然后尝试“使用”它们？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-06T15:48:07.900

我刚刚在 VS2005 中尝试了您的确切代码示例，它使用 using 指令按预期工作，无需先构建站点或任何东西。

这告诉我您的项目和/或命名空间还有其他问题。如果您右键单击并选择“构建网站”，它会构建吗？

当您说它不起作用时，它到底以什么方式不起作用？网站不建吗？没有智能感知完成？浏览页面时出现错误消息？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-04-27T19:14:33.663

右键单击“类”并选择->“属性”将“属性”更改为->编译并在 .aspx 上“写入命名空间名称”

```
 using namespace name of the class; 
```

它工作正常。

# installation - 如何在 VirtualBox 中分发我稍微定制的 Linux？

> ID：520431
> 
> 赞同：4
> 
> 时间：2009-02-06T14:19:18.890
> 
> 标签：installation, virtualization, distribution, virtualbox

假设我有一些 Arch Linux 安装，我想将其分发给具有（有时非常）基本 Linux 知识的学生，以使他们能够在与大学非常相似的环境中编译 C 程序。（Cygwin 或 MinGW 之类的东西在这里似乎不合适。）

我还选择 VirtualBox 作为虚拟系统的持有者。

问题是：**我如何分发它**？我是说：

*   在目标机器上安装 VirtualBox（如果尚未安装）
*   解压缩和复制我的图像文件 (.VDI)
*   注册图像（以便 VirtualBox 在启动时可以看到它）
*   在 VirtualBox 中配置来宾系统（网络、内存等）
*   可选择安装 PuTTY 以简化与来宾 Linux 的接口

我应该创建一个安装程序吗？哪一个？或者只是写一些 .BAT 脚本？（目标主机系统是Windows，主要是XP和Vista。）我绝对不希望有一个带有屏幕截图的网页，解释点击哪里和按什么，因为它很无聊。

* * *

另外，第一次运行来宾 Linux 系统时，配置网络的最佳（最用户友好）方式是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-06T14:32:15.730

我这样做过一次：

1.  我刻录了一张 DVD，其中包含：VirtualBox 和图像
2.  我写了一个 autostart.exe ：在机器上安装了 VirtualBox 和 Putty
3.  它将图像复制到高清
4.  然后 autostart.exe 运行 Virtualbox 配置并添加虚拟机
5.  然后虚拟机启动，一个自动启动的 bash 脚本显示了虚拟机的网络信息，告诉学生如何通过 Putty 连接。
6.  就是这样

另外：在 DVD 上包含一个紧急功能：一个简单的脚本，它从 hd 中删除虚拟机的图像并将原始图像从 dvd 复制到 hd。这确实节省了很多时间。

# bash - Bash/DOS/PowerShell 脚本列出最新版本的文件？

> ID：520437
> 
> 赞同：5
> 
> 时间：2009-02-06T14:20:33.007
> 
> 标签：bash, powershell, shell, dos

我们有一个列表（比如说 50 个）报告，这些报告会根据特定条件被转储到各种文件夹中。所有报告都有标准名称，例如。D099C.LIS、D18A0.LIS 等

有时一个报告最多可以存在 5 个不同的位置，我需要生成每个报告的最新版本的所有位置的列表。

我可以使用代码轻松完成，或者将“dir”或“ls”输出重定向到文本文件，然后在 Excel 中进行操作，但我更喜欢使用 DOS、bash、或 PowerShell。

到目前为止，我在 PowerShell 中提出的最好的（我使用 bash 做过类似的事情）是：

```
ls -r -fi *.lis | sort @{expression={$_.Name}}, @{expression={$_.LastWriteTime};Descending=$true} | select Directory, Name, lastwritetime 
```

这将递归地列出所有带有 *.lis 扩展名的文件，然后按名称 (asc) 和日期 (desc) 对其进行排序，然后显示目录、名称和日期。

这给出了这种输出：

```
C:\reports\LESE            D057A.LIS                  28/01/2009 09:00:43
C:\reports\JCSW            D057A.LIS                  27/01/2009 10:50:21
C:\reports\ALID            D075A.LIS                  04/02/2009 12:34:12
C:\reports\JCSW            D075B.LIS                  05/02/2009 10:07:15
C:\reports\ALID            D075B.LIS                  30/01/2009 09:14:57
C:\reports\BMA3            D081A.LIS                  01/09/2008 14:51:36 
```

我现在显然需要做的是删除不是最新版本的文件，以便输出看起来像这样（不太担心格式化）：

```
C:\reports\LESE            D057A.LIS                  28/01/2009 09:00:43
C:\reports\JCSW            D075B.LIS                  05/02/2009 10:07:15
C:\reports\BMA3            D081A.LIS                  01/09/2008 14:51:36 
```

有人有想法么？

[编辑] 这个问题的一些好主意和答案。不幸的是，我不能将所有内容都标记为已接受，但 EBGreen 的（已编辑）答案无需修改即可工作。在验证它们时，我将在此处添加有效的解决方案。

重击：

```
 ls -lR --time-style=long-iso | awk 'BEGIN{OFS="\t"}{print $5,$6,$7,$8}' | grep ".LIS" | sort -k4 -k2r -k3r | uniq -f3
 ls -lR --time-style=long-iso | awk 'BEGIN{OFS="\t"}{print $5,$6,$7,$8}' | grep ".LIS" | sort -k4 -k2r -k3r | awk '!x[$4]++' 
```

电源外壳：

```
 ls -r -fi *.lis | sort @{expression={$_.Name}}, @{expression={$_.LastWriteTime};Descending=$true} | select Directory, Name, lastwritetime | Group-Object Name | %{$_.Group | Select -first 1}
  ls -r . *.lis | sort -desc LastWriteTime | group Name | %{$_.Group[0]} | ft Directory,Name,LastWriteTime
  ls -r -fi *.lis | sort @{expression={$_.Name}}, @{expression={$_.LastWriteTime};Descending=$true} | unique | ft Directory,Name,LastWriteTime 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-06T14:27:14.770

```
ls -r -fi *.lis | sort @{expression={$_.Name}}, @{expression={$_.LastWriteTime};Descending=$true} | select Directory, Name, lastwritetime | Group-Object Name | %{$_.Group | Select -first 1} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-06T14:43:01.400

在 bash 中，您可以通过[uniq](http://www.ss64.com/bash/uniq.html)传递您的答案。我不确定 bash 1-liner 结果的确切结构，但 -w N 和 -s N 的正确参数应该可以做到。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T19:28:54.977

PowerShell 中的另一种选择，更多“脚本”，例如：

```
ls -r . *.lis | sort LastWriteTime | %{$f=@{}} {$f[$_.Name]=$_} {$f.Values} | ft Directory,Name,LastWriteTime 
```

1.  递归获取文件
2.  按上次写入时间升序排序
3.  初始化哈希图（关联数组）
4.  对于每个文件，使用名称作为键分配它 - 以后的条目将覆盖以前的条目
5.  获取哈希图的值（不包括键）
6.  格式为表格

请注意，FileInfo 对象在整个管道中保留。您仍然可以访问对象的任何属性/方法或以任何您喜欢的方式对其进行格式化。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-06T14:55:39.160

问题似乎是根据特定领域找到独特的。awk 可以用来解决这个问题。看到这个有一种方法的[博客条目。](http://unstableme.blogspot.com/2008/03/remove-duplicates-based-on-fields-awk.html)例如，在 bash 中可以这样做：

寻找 。-名称“*.lis”-打印| xargs ls -tr | awk -F/ '!x[$NF]++'

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-04T22:06:38.957

电源外壳：

```
ls -r . *.lis | sort -desc LastWriteTime | sort -u Name | ft Directory,Name,LastWriteTime 
```

解释：

1.  递归获取文件
2.  按 LastWriteTime 降序对文件进行排序
3.  按名称对文件进行排序，选择唯一文件（仅第一个）。
4.  使用目录、名称和时间在表格中格式化生成的 FileInfo 对象

不依赖*排序*稳定的替代方案：

```
ls -r . *.lis | sort -desc LastWriteTime | group Name | %{$_.Group[0]} | ft Directory,Name,LastWriteTime 
```

1.  递归获取文件
2.  按 LastWriteTime 降序对文件进行排序
3.  按名称对文件进行分组
4.  为每个组选择该组的第一个（索引零）项目
5.  使用目录、名称和时间在表格中格式化生成的 FileInfo 对象

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-06T14:47:26.167

你能用perl吗？就像是：

*你的命令*| perl 'while (<STDIN>) { ($dir,$name,$date) = split; $hash{$name} = ($dir,$date);} foreach (keys %hash) { print "$hash{$ *}[0] $* $hash{$_}[1]\n"; }'

这在细节上可能是错误的（自从我愤怒地使用 perl 以来已经太久了），但基本的想法是保持一个结果的哈希键在文件名上，并在遇到新条目时总是覆盖以前的条目。这样，只要输入的行顺序正确，您只会得到最近接触的文件。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-07-15T00:24:11.157

ls -ARFlrt | awk '{打印 $6,$7,$8}'|grep 2010|sort -n

正在寻找类似的。以上帮助我获得了我在 bash 中所追求的列表。grep 是可选的（当然）。\谢谢

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-02-07T16:17:39.183

$f = ls -r -fi *.lis | 排序名称，lastWriteTime -desc

# remove -whatIf 删除文件

$f[1..$f.length] | 删除项目 -whatIf

# project-management - 如何缩小开发人员和生产支持团队之间的差距？

> ID：520439
> 
> 赞同：9
> 
> 时间：2009-02-06T14:21:14.097
> 
> 标签：project-management

为了让我的问题更清楚，请允许我定义标题的术语——

生产支持团队是维护当前使用的软件应用程序的资源。开发人员是根据需求编写软件应用程序的编码人员。

在我的工作经验中，这两个团队经常至少会面一次或两次，讨论下一个产品版本。假设生产支持团队将了解潜在风险，而无需查看需求或设计文档或与客户或利益相关者会面。预计在与开发团队的一/两次会议中，Prod 支持团队将了解、减轻和解决此版本中的潜在风险。

这就是问题所在，我的任务是制定指南以缩小生产支持团队和开发人员之间的差距。你有什么想法？当两个团队走到一起时需要问什么问题？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-06T14:41:45.023

拥有两支球队从一开始就是一个错误。

我在其他公司看到过这个（两个不同的团队），这总是让我感到惊讶，这实际上是在现实世界中完成的。

我建议只有一个开发团队——有些负责支持，有些正在做新的开发——但没有明确的划分。

一方面，新代码的开发人员没有自然的反馈循环（正面或负面）来真正使其可维护。他们只是把它扔到墙上让维护者处理。

我还看到它造成分裂，而不是凝聚力。我看不出这个场景有什么积极/好的方面，而我看到一个单一的产品团队有很多好处。

我无法理解。

我同意其他人的观点——要么轮换，要么组成一个团队。

编辑：

因此，对于那些无法轮换团队或组建一个团队的人：

*   对于出现的问题，双方都必须有可见性。也就是说，来自生产的反馈必须到达开发团队。
*   正如您所建议的，让生产团队参与初始设计和规划以及需求收集阶段。
*   团队必须能够轻松地相互访问

编辑：

我曾在一家公司工作，该公司有一个从开发团队的其他成员借来的小团队——他们称之为“特警”团队。他们将为一些大客户或收费构建特定功能，并将代码放在特定分支上。虽然相似，但它们确实仍然来自所有开发人员。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-06T14:24:44.013

让人们在两个团队之间轮换一会儿。这样当他们回到原来的团队时，他们对其他团队面临的问题有更好的理解。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-06T14:35:14.943

我会将 Elie 的建议更进一步，并说总是轮换人员。我不知道有哪个开发人员乐于只对其他人编写的代码进行维护工作。

另一方面，只编写新代码的开发人员永远不会感受到维护的痛苦，因此不会学习如何编写可维护的代码。

**编辑：**
理想情况下，我同意蒂姆的观点——真的不应该有单独的团队，这是一种糟糕的做法。我假设你没有能力做出如此激进的改变，但也许你有:)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-06T14:46:57.570

一些初步的想法：

1.  生产团队是利益相关者，因此他们应该从第一天起就参与进来。您的系统是否可支持？它是否将警报事件发布到支持系统/仪表板？是否需要任何手动流程（例如周末反弹）？通过在项目开始时与支持人员交谈，您将创建工作关系的开始。
2.  尽可能通过“生产”您的系统来尽快提供生产支持。即尝试将您的 Smoke、QA 和 UAT 构建作为生产系统进行管理。对于烟雾构建并不总是可能的，但对于 QA/UAT 应该是可能的（甚至是必需的）。
3.  培训和文档。教育生产支持团队并为他们提供良好的文档。
4.  确保您拥有第二或第三线支持流程——即生产支持团队可以在需要时与开发人员取得联系。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-06T14:48:26.990

真正的整合只能来自于在同一个项目中一起工作。

最好的事情是支持团队参与开发，例如 4 个元素的团队，每周一个人主要做支持，其他人做开发。这意味着支持人员可以在再次提供支持之前休息 3 周。

这使人们将项目视为“自己的”，并避免因有时支持可能包含的愚蠢问题和无脑任务而发疯。

还要记住，支持团队通常更了解用户以及他们使用系统的方式。出于这个原因，他们处于改进它的最佳位置。

生产支持团队应有权访问需求或设计文件，并参与使其保持最新状态。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-06T15:03:19.783

就我自己而言，无论是在工作中还是在外出时，我都会尽可能多地与巴黎圣日耳曼的人一起出去玩。另外，如果他们有问题，如果可以的话，我会立即起身去帮助他们。您对他们了解得越多，他们在生活中遇到的问题和麻烦等等，您就可以更好地为他们设置。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-06T15:52:46.003

以 Elie、Tim 和 17 of 26 为基础：
在每个版本中循环每个团队 25%-33% 的进出。谁来的时间最长；而且我不在乎您的职位是什么（北半球高级建筑师或苦工）。支持有效地对应用程序进行了测试，他们知道所有的问题（并将确保它们得到修复 - 这已经困扰了我 3 个周期#$%#$%#$%），开发人员最了解最新版本，所以他们最适合故障排除（哦，当然，该问题将出现在函数 XYZ 中）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-06T14:26:04.227

让开发人员和支持团队坐在一起，或者至少花一些时间在一起，我取得了巨大的成功。这样一来，想法和假设就可以尽早提出，并且**一些**问题可以更快地得到解决。

# .net - 使用 .NET 挂钩应用程序以捕获双击事件

> ID：520440
> 
> 赞同：0
> 
> 时间：2009-02-06T14:21:28.560
> 
> 标签：.net, hook, mouse-hook

如何挂钩一个应用程序，以便我可以找出鼠标在其中双击的时间？

这可以在.NET中完成吗？

有什么我需要注意的吗？（例如，使其他应用程序崩溃）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-06T14:39:08.023

文章“[如何将托管 .NET 程序集注入托管进程](http://www.codingthewheel.com/archives/how-to-inject-a-managed-assembly-dll)”将为您提供设置挂钩所需的所有知识。

文章“[我如何构建一个正常工作的扑克机器人：第 4 部分](http://www.codingthewheel.com/archives/how-i-built-a-working-online-poker-bot-4)”将为您提供捕捉双击所需的一切。

这两篇文章的代码都可以是特定领域的，但你应该不会有太多的麻烦来拉出金块来启动和运行。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T14:29:44.237

它可以在 .NET 中使用 Win32 API 完成。这篇[MSDN 文章](http://msdn.microsoft.com/en-us/magazine/cc188966.aspx)描述了 windows 挂钩。CodeProject也有[这个](http://www.codeproject.com/KB/cs/globalhook.aspx)。

是的，您应该非常小心地始终取消挂钩处理程序，无论哪种错误情况可能导致应用程序意外关闭。

# javascript - 如何知道程序何时使用 javascript 打开？

> ID：520461
> 
> 赞同：0
> 
> 时间：2009-02-06T14:28:29.870
> 
> 标签：javascript

我有一个问题，我想知道何时使用 javascript 打开程序。这可能吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-06T14:30:17.107

我假设，您的意思是在浏览器中运行的 JavaScript，程序是指在客户端操作系统（例如 bash、vim 或 emacs）上运行的真实应用程序。

那么这是不可能的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-06T14:30:18.260

我假设您正在谈论在浏览器中运行的javascript？不，那是不可能的。出于安全原因，不允许在浏览器中运行的 Javascript 与主机操作系统交互。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-06T14:30:33.143

当然，如果您使用 javascript 解析器实现所述程序。

如果您从浏览器中谈论，答案是响亮的不。那将是一个巨大的安全风险。如果您有想要检查报告的应用程序，当它对您可以使用 javascript 查询的服务器处于活动状态时，这将起作用，但如果您无权访问程序本身，则没有。

# c# - Linq to SQL 和 Collection 操作

> ID：520462
> 
> 赞同：3
> 
> 时间：2009-02-06T14:28:39.573
> 
> 标签：c#, sql-server-2005, linq-to-sql, .net-3.5, collections

我有一个字典，我想像 SQL 查询中的 IN 子句一样使用它。

我有一个 Linq-To-SQL 查询，我想在其中使用此字典的键来检查查询行中的字段。

例如

```
bool result = DataContext.Table.Any(res => MyDictionary.ContainsKey(res.field1)); 
```

实际上这类似于

```
 exists(select * from Table where field1 in (select id from DictionaryKeys)) 
```

在哪里`DictionaryKeys`将 Keys 扩展到他们自己的表中。

不幸的是我得到

```
System.NotSupportedException was unhandled
Message="Method 'Boolean ContainsKey(System.String)' has no supported translation to SQL."
Source="System.Data.Linq" 
```

我理解这个错误，但我正在努力思考这个问题以寻求不同的解决方案。

**编辑：**我正在连接到 SQL 2005。看起来这是一个连接提供程序问题，因为 Marc 的转换为列表的建议对我不起作用。

有任何想法吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-06T14:30:37.917

尝试将键放入一个简单的列表并使用包含：

```
var keys = MyDictionary.Keys.ToList();

DataContext.Table.Any(res => keys.Contains(res.field1)); 
```

# java - 如何从 WebApp 读取 web.xml

> ID：520467
> 
> 赞同：3
> 
> 时间：2009-02-06T14:29:59.307
> 
> 标签：java, web-services, jakarta-ee, glassfish

对于 WebApps，web.xml 可用于存储应用程序设置。我怎样才能阅读这个文件。我的 servlet 在 GlassFish v2 服务器中运行。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-06T14:46:59.117

不确定我是否完全理解这个问题......

假设您的 Servlet 扩展[`HttpServlet`](http://tomcat.apache.org/tomcat-5.5-doc/servletapi/index.html)？

`HttpServlet`implements `ServletConfig`，因此您可以使用以下方法查找 servlet 特定参数：

在 web.xml 中

```
<servlet>
    <servlet-class>com.acme.Foo</servlet-class>
    <init-param>
        <param-name>my.init.param</param-name>
        <param-value>10</param-value>
    </init-param>
</servlet> 
```

在小服务程序中：

```
int x = Integer.parseInt(getInitParameter("my.init.param")); 
```

同样，您可以使用以下方法获取全局（上下文范围）设置：

```
<context-param>
    <param-name>my.context.param</param-name>
    <param-value>Hello World</param-value>
</context-param> 
```

在小服务程序中：

```
String s = getServletContext.getInitParameter("my.context.param"); 
```

当然，如果您将框架与 servlet 一起使用，例如 Spring，那么您可以使用 Spring 的配置文件代替将设置注入您的 Web 应用程序类。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-06T14:46:57.853

添加一个初始化参数：

```
<init-param> 
    <param-name>InitParam</param-name> 
    <param-value>init param value</param-value> 
</init-param> 
```

然后从 java 代码中读取它（在一个 servlet 中）：

```
String initParam = getServletConfig().getInitParameter("InitParam"); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-06T14:56:39.953

Doekman，是否可以解释为什么要阅读 web.xml 文件？此文件中的设置以 WebContainer 为目标。如果要传递应用程序加载的配置参数，则只需使用上下文参数：

[*可选的 context-param 元素声明了 Web 应用程序的 servlet 上下文初始化参数。您可以使用和元素在单个上下文参数元素中设置每个上下文参数。您可以使用 javax.servlet.ServletContext.getInitParameter() 和 javax.servlet.ServletContext.getInitParameterNames() 方法在代码中访问这些参数。*](http://edocs.bea.com/wls/docs61/webapp/web_xml.html#1014756)

如果您确实需要读取文件，那么我很确定您可以尝试使用 Java IO 加载文件。您唯一需要知道的是 Glassfish 在您的应用程序运行时使用的工作路径。你可以试试这样 System.getProperty("user.dir");

从那里您可以使用相对路径加载文件。[www.exampledepot.com](http://www.exampledepot.com/egs/java.io/ReadLinesFromFile.html)上的示例。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-06T15:09:53.703

容器的选择不应该与这个问题相关，因为每个容器都应该实现[servlet 容器](http://en.wikipedia.org/wiki/Servlet_container)规范，无论是 Tomcat、Glassfish 还是[许多其他](http://en.wikipedia.org/wiki/List_of_Servlet_containers)容器之一。

# algorithm - 查找庞大数据集的子集总数

> ID：520474
> 
> 赞同：1
> 
> 时间：2009-02-06T14:30:43.923
> 
> 标签：algorithm, binary-search, subset-sum

首先：我不是程序员，从未学过编程/算法。实际上我必须编程，主要是在 awk 或 ruby​​ 中，一些 bash。

在今天的任务中，我在纯文本文件中有一个巨大的数据集（浮点数），一个记录/行，以及集合中所有数字的总和，但是总和是错误的，因为有些数字（只能一）在集合中是负数，但我们在文件中看不到它（如果元素是负数，则没有符号）。

但我必须找到它/他们：所以首先我计算了正确的总和（将所有数字与 相加`awk`）并不关心他们的迹象。现在我现在是原始总和（关心符号）和我的新总和之间的差异。但我必须找到数据集的所有子集，它们的和与差/2 完全相同。

例如：

```
DATA:
1,2,3,4,5

ORIG SUM: 
5 
```

现在我们可以计算 1+2+3+4+5 - ORIG SUM 之间的差值：15-5=10。10/2 = 5，所以我需要找到所有可以加起来为5的子集，即[1,4]，[2,3]，[5]。

有正确的方法吗？我更喜欢 awk、ruby、shell 脚本，但 python 和 perl 都是可以接受的（没有大量使用外部库，因为我无权安装它们）。

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-06T14:35:37.953

你的意思是[`SUBSET SUM`](http://en.wikipedia.org/wiki/Subset_sum_problem)计算机科学中已知的问题？

提示：查看相关问题，有很多关于该问题的问题/答案。

# c# - 我可以在不影响现有客户端的情况下修改/扩展生产 Web 服务吗？

> ID：520475
> 
> 赞同：3
> 
> 时间：2009-02-06T14:31:03.313
> 
> 标签：c#, .net, asp.net, vb.net, web-services

我目前正在调用一个 Web 服务，该服务返回一个服务定义的类，我在我的应用程序中对其进行解释。我正在考虑要求此 Web 服务的供应商为此类添加一个属性，这将使我的生活以及他们的其他客户的生活更加轻松。需要明确的是，我不是要求他们修改现有的行为或属性，因此这将扩展现有的功能。

我的问题是，如果他们将此属性添加到类中，是否会对现有客户的应用程序产生不利影响？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-06T14:37:49.930

这可能是一个问题，是的：

*   当从服务器接收到意外的属性时，旧客户端可能会出错
*   当没有从旧客户端接收到预期的属性时，服务器可能会出错

它也可以工作......它只需要测试/计划。

一个更安全的选择（如果您有复杂的部署，不能一次全部完成）是考虑 API 密封并添加一个新的“v2”端点等。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-06T14:36:46.530

是的，如果您没有更新代理，这可能意味着您会收到序列化错误。最好对服务接口进行版本控制，即使这意味着一次支持多个版本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-06T14:37:43.563

除了您要求第三方承担开发的事实（他们通常不乐意这样做）。Web 服务的修改/扩展可能需要停机时间，这可能很重要。它还会干扰其 API 的向后兼容性。

如果该属性包含大量不必要地传播到所有客户端的附加数据，则还需要考虑性能。

# jquery - jQuery 如果 div 不存在

> ID：520481
> 
> 赞同：3
> 
> 时间：2009-02-06T14:32:55.603
> 
> 标签：jquery

我有 3 张图像并具有一个功能，以便在鼠标悬停时它们淡入淡出。如果正在翻转的图像具有“已选择”类，我不想这样做。

到目前为止，我有这个代码：

```
$(".thumbs").hover(function(){

if (!($(this).hasClass(".selected")){

$(this).stop().fadeTo("normal", 1.0);
},function(){
$(this).stop().fadeTo("slow", 0.3);

}

}); 
```

对我来说，IF 语句看起来应该是：

```
if (!($(this).hasClass(".selected"))){ 
```

但两者都不起作用，所以谁知道呢。当我实现此代码时，我的整个 javascript 停止工作，有什么想法吗？

Google 上几乎没有关于 jQuery 的 IF 语句的信息，这太荒谬了。我将不胜感激任何帮助！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-06T14:35:16.550

问题是您的元素具有“selected”类而不是“.selected”类。删除点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-06T14:36:44.113

[选择器上的 jQuery 文档](http://docs.jquery.com/Selectors)告诉你你需要知道的一切。

```
$('.thumbs:not(.selected)').hover(function(){
  // ...
}) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-06T14:38:12.487

使用[`not`](http://docs.jquery.com/Traversing/not#expr)功能：

```
if ($(this).not(".selected")) {
    ...
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-06T14:35:43.757

也许应该是

```
if (!($(this).hasClass("selected"))){ 
```

不 。因为它知道你正在寻找一个类名。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-06T14:58:08.453

我认为你的 javascript 格式不正确——大括号放在错误的地方——你不应该在 hasClass 函数中使用点。更好的格式也有助于提高可读性。

```
$(document).ready( function() {
    $('.thumbs').hover( function() {
                            if (!$(this).hasClass('selected')) {
                                $(this).stop().fadeTo("normal", 1.0);
                            }
                        },
                        function() {
                            $(this).stop().fadeTo("slow", 0.3);
                        }
                 );
}); 
```

# recursion - 没有递归的复合模式迭代器

> ID：520482
> 
> 赞同：1
> 
> 时间：2009-02-06T14:33:19.970
> 
> 标签：recursion, iterator, design-patterns, composite

有没有人写过或考虑过在不使用递归的情况下为复合（树）结构编写迭代器？如果是这样，你能分享你的想法吗？谢谢

编辑：我正在考虑使用 Java 语言。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-06T14:40:39.847

在没有递归的情况下遍历一棵树很简单。假设一棵二叉树，每个节点大概有三个对其他节点的引用。左孩子，右孩子和父母。因此，假设深度优先的从左到右的迭代顺序，`while current.left-child != null, current = current.left-child`如果没有左子，则在 while-lop（伪代码）中遵循左子引用，则尝试右子。如果也没有正确的孩子，则向上直到找到正确的孩子（`while current.right-child == null, current = current.parent`）

您还没有指定一种语言，但由于您想避免递归，我将假设它是某种命令式语言，然后上述应该是可能的。

简而言之，您的迭代器必须持有对当前节点的引用，以及有关其行进方式的一些信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-11-21T11:08:22.320

您可能会从这个 SO 问题中得到一些启发： [Post order traversal of binary tree without recursion](https://stackoverflow.com/questions/1294701/post-order-traversal-of-binary-tree-without-recursion) 您所需要的只是将算法扩展到非二叉树。

# c# - 编写函数的最佳方式

> ID：520505
> 
> 赞同：-1
> 
> 时间：2009-02-06T14:38:29.210
> 
> 标签：c#, string

连接到不同数据库的 SQL 代码
**说 dbs= a,b,c** 也是一个大 SQL 查询，其名称应以数据库名称为前缀。因此，它本质上是对大查询的字符串操作，以替换所有上述数据库名称。用 C# 编写这个的最佳方式是什么

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-06T14:50:24.927

我认为您的问题不是很清楚，但我认为您正在寻找这个：

对包含 3 个以上字符串的所有字符串操作使用[StringBuilder类。](http://msdn.microsoft.com/en-us/library/system.text.stringbuilder.aspx)

# c# - 如何构建 OleDbCommand 查询，以便我可以从一个 .MDB 中获取表，并在另一个 .MDB 中替换它们

> ID：520506
> 
> 赞同：3
> 
> 时间：2009-02-06T14:38:29.507
> 
> 标签：c#, sql, datatable, dataset, oledbcommand

我正在尝试从一个 Access 数据库文件中获取表，将它们添加到另一个具有完全相同结构但具有不同信息的 Access 数据库文件中。我需要覆盖任何现有的表。我的项目几乎完成了，这是我的最后一堵砖墙。

我正在使用一个名为 DatabaseHandling.cs 的单独类文件来处理 Access 数据库文件。

这是我当前的全部 DatabaseHandling.cs 代码。暂时保持最新状态。

代码：

```
using System;
using System.Collections.Generic;
using System.Data;
using System.Data.OleDb;
using System.IO;
using System.Linq;
using System.Text;

namespace LCR_ShepherdStaffupdater_1._0
{
    public class DatabaseHandling
    {
        static DataTable datatableB = new DataTable();
        static DataTable datatableA = new DataTable();
        public static DataSet datasetA = new DataSet();
        public static DataSet datasetB = new DataSet();
        static OleDbDataAdapter adapterA = new OleDbDataAdapter();
        static OleDbDataAdapter adapterB = new OleDbDataAdapter();
        static string connectionstringA = "Provider=Microsoft.Jet.OLEDB.4.0;" + "Data Source=" + Settings.getfilelocationA();
        static string connectionstringB = "Provider=Microsoft.Jet.OLEDB.4.0;" + "Data Source=" + Settings.getfilelocationB();
        static OleDbConnection dataconnectionB = new OleDbConnection(connectionstringB);
        static OleDbConnection dataconnectionA = new OleDbConnection(connectionstringA);
        static DataTable tableListA;
        static DataTable tableListB;

        static public void addTableA(string table, bool addtoDataSet)
        {
            dataconnectionA.Open();
            datatableA = new DataTable(table);
            try
            {
                OleDbCommand commandselectA = new OleDbCommand("SELECT * FROM [" + table + "]", dataconnectionA);
                adapterA.SelectCommand = commandselectA;
                adapterA.Fill(datatableA);
            }
            catch
            {
                Logging.updateLog("Error: Tried to get " + table + " from DataSetA. Table doesn't exist!", true, false, false);
            }

            if (addtoDataSet == true)
            {
                datasetA.Tables.Add(datatableA);
                Logging.updateLog("Added DataTableA: " + datatableA.TableName.ToString() + " Successfully!", false, false, false);
            }

            dataconnectionA.Close();
        }

        static public void addTableB(string table, bool addtoDataSet)
        {
            dataconnectionB.Open();
            datatableB = new DataTable(table);

            try
            {
                OleDbCommand commandselectB = new OleDbCommand("SELECT * FROM [" + table + "]", dataconnectionB);
                adapterB.SelectCommand = commandselectB;
                adapterB.Fill(datatableB);
            }
            catch
            {
                Logging.updateLog("Error: Tried to get " + table + " from DataSetB. Table doesn't exist!", true, false, false);
            }

            if (addtoDataSet == true)
            {
                datasetB.Tables.Add(datatableB);
                Logging.updateLog("Added DataTableB: " + datatableB.TableName.ToString() + " Successfully!", false, false, false);
            }

            dataconnectionB.Close();
        }

        static public string[] getTablesA(string connectionString)
        {
            dataconnectionA.Open();
            tableListA = dataconnectionA.GetOleDbSchemaTable(OleDbSchemaGuid.Tables, new Object[] { null, null, null, "TABLE" });
            string[] stringTableListA = new string[tableListA.Rows.Count];

            for (int i = 0; i < tableListA.Rows.Count; i++)
            {
                stringTableListA[i] = tableListA.Rows[i].ItemArray[2].ToString();
            }
            dataconnectionA.Close();
            return stringTableListA;
        }

        static public string[] getTablesB(string connectionString)
        {
            dataconnectionB.Open();
            tableListB = dataconnectionB.GetOleDbSchemaTable(OleDbSchemaGuid.Tables, new Object[] { null, null, null, "TABLE" });
            string[] stringTableListB = new string[tableListB.Rows.Count];

            for (int i = 0; i < tableListB.Rows.Count; i++)
            {
                stringTableListB[i] = tableListB.Rows[i].ItemArray[2].ToString();
            }
            dataconnectionB.Close();
            return stringTableListB;
        }

        static public void createDataSet()
        {

            string[] tempA = getTablesA(connectionstringA);
            string[] tempB = getTablesB(connectionstringB);
            int percentage = 0;
            int maximum = (tempA.Length + tempB.Length);

            Logging.updateNotice("Loading Tables...");
            Logging.updateLog("Started Loading File A", false, true, false);
            for (int i = 0; i < tempA.Length ; i++)
            {
                if (!datasetA.Tables.Contains(tempA[i]))
                {
                    addTableA(tempA[i], true);
                    percentage++;
                    Logging.loadStatus(percentage, maximum);
                }
                else
                {
                    datasetA.Tables.Remove(tempA[i]);
                    addTableA(tempA[i], true);
                    percentage++;
                    Logging.loadStatus(percentage, maximum);
                }
            }
            Logging.updateLog("Finished loading File A", false, true, false);
            Logging.updateLog("Started loading File B", false, true, false);
            for (int i = 0; i < tempB.Length ; i++)
            {
                if (!datasetB.Tables.Contains(tempB[i]))
                {
                    addTableB(tempB[i], true);
                    percentage++;
                    Logging.loadStatus(percentage, maximum);
                }
                else
                {
                    datasetB.Tables.Remove(tempB[i]);
                    addTableB(tempB[i], true);
                    percentage++;
                    Logging.loadStatus(percentage, maximum);
                }
            }
            Logging.updateLog("Finished loading File B", false, true, false);

        }

        static public DataTable getDataTableA()
        {
            datatableA = datasetA.Tables[Settings.textA];

            return datatableA;
        }
        static public DataTable getDataTableB()
        {
            datatableB = datasetB.Tables[Settings.textB];
            return datatableB;
        }

        static public DataSet getDataSetA()
        {
            return datasetA;
        }

        static public DataSet getDataSetB()
        {
            return datasetB;
        }

        static public void InitiateCopyProcessA()
        {
            DataSet tablesA;
            tablesA = DatabaseHandling.getDataSetA();

                foreach (DataTable table in tablesA.Tables)
                {
                    OverwriteTable(table, table.TableName);
                    Logging.updateLog("Copied " + table.TableName + " successfully.", false, true, false);
                }

        }

        static void OverwriteTable(DataTable sourceTable, string tableName)
        {
            using (var destConn = new OleDbConnection(connectionstringA))
            using (var destCmd = new OleDbCommand(tableName, destConn) { CommandType = CommandType.TableDirect })
            using (var destDA = new OleDbDataAdapter(destCmd))
            {
                // Since we're using a single table, we can have the CommandBuilder
                // generate the appropriate INSERT and DELETE SQL statements
                using (var destCmdB = new OleDbCommandBuilder(destDA))
                {
                    destCmdB.QuotePrefix = "["; // quote reserved column names
                    destCmdB.QuotePrefix = "]";
                    destDA.DeleteCommand = destCmdB.GetDeleteCommand();
                    destDA.InsertCommand = destCmdB.GetInsertCommand();

                    // Get rows from destination, and delete them
                    var destTable = new DataTable();
                    destDA.Fill(destTable);
                    foreach (DataRow dr in destTable.Rows)
                    {
                        dr.Delete();
                    }
                    destDA.Update(destTable);

                    // Set rows from source as Added, so the DataAdapter will insert them
                    foreach (DataRow dr in sourceTable.Rows)
                    {
                        dr.SetAdded();
                    }
                    destDA.Update(sourceTable);
                }
            }
        }

        }          
    } 
```

我只是想获取内存中的数据表并将其写入 .MDB 文件。我已经尝试这样做了 30 多个小时。

**最新编辑：**

好的，添加了新代码。我收到一个新的运行时错误：**FROM 子句中的语法错误。**

**代码：**

```
static public void InitiateCopyProcessA()
{
    DataSet tablesA;
    tablesA = DatabaseHandling.getDataSetA();

        foreach (DataTable table in tablesA.Tables)
        {
            OverwriteTable(table, table.TableName);
            Logging.updateLog("Copied " + table.TableName + " successfully.", false, true, false);
        }

}

static void OverwriteTable(DataTable sourceTable, string tableName)
{
    using (var destConn = new OleDbConnection(connectionstringA))
    using (var destCmd = new OleDbCommand(tableName, destConn) { CommandType = CommandType.TableDirect })
    using (var destDA = new OleDbDataAdapter(destCmd))
    {
        // Since we're using a single table, we can have the CommandBuilder
        // generate the appropriate INSERT and DELETE SQL statements
        using (var destCmdB = new OleDbCommandBuilder(destDA))
        {
            destCmdB.QuotePrefix = "["; // quote reserved column names
            destCmdB.QuotePrefix = "]";
            destDA.DeleteCommand = destCmdB.GetDeleteCommand();
            destDA.InsertCommand = destCmdB.GetInsertCommand();

            // Get rows from destination, and delete them
            var destTable = new DataTable();
            destDA.Fill(destTable);
            foreach (DataRow dr in destTable.Rows)
            {
                dr.Delete();
            }
            destDA.Update(destTable);

            // Set rows from source as Added, so the DataAdapter will insert them
            foreach (DataRow dr in sourceTable.Rows)
            {
                dr.SetAdded();
            }
            destDA.Update(sourceTable); // !!! Run-time error: Syntax error in FROM clause. !!!
        }
    }
} 
```

再一次，它不起作用。如果您需要更多信息，请告诉我。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-06T15:16:53.610

我觉得你并没有真正了解整个 DataTable/DataRow 的事情。您会看到，在数据库中，您并没有真正使用*表*，而是使用行。如果您想用 TableA 的行“覆盖”TableB，您首先要删除 TableB 中的所有行，然后插入 TableA 中所有行的副本。

假设目标表已经存在，您可以通过从 1 个源填充来进行插入，然后将行设置为已添加。然后，DataAdapter 将为每个添加的行运行 SQL 插入命令。

```
static void CopyTable(string sourceConnectionString, string destinationConnectionString, string tableName) {
    // Get rows from source
    var sourceTable = new DataTable();
    using (var sourceConn = new OleDbConnection(sourceConnectionString))
    using (var sourceCmd = new OleDbCommand(tableName, sourceConn) { CommandType = CommandType.TableDirect })
    using (var sourceDA = new OleDbDataAdapter(sourceCmd)) {
        sourceDA.Fill(sourceTable);
    }

    OverwriteTable(sourceTable, destinationConnectionString, tableName);
}

static void OverwriteTable(DataTable sourceTable, string destinationConnectionString, string tableName) {
    using (var destConn = new OleDbConnection(destinationConnectionString))
    using (var destCmd = new OleDbCommand(tableName, destConn) { CommandType = CommandType.TableDirect })
    using (var destDA = new OleDbDataAdapter(destCmd)) {
        // Since we're using a single table, we can have the CommandBuilder
        // generate the appropriate INSERT and DELETE SQL statements
        using (var destCmdB = new OleDbCommandBuilder(destDA)) {
            destCmdB.QuotePrefix = "["; // quote reserved column names
            destCmdB.QuoteSuffix = "]";
            destDA.DeleteCommand = destCmdB.GetDeleteCommand();
            destDA.InsertCommand = destCmdB.GetInsertCommand();

            // Get rows from destination, and delete them
            var destTable = new DataTable();
            destDA.Fill(destTable);
            foreach (DataRow dr in destTable.Rows) {
                dr.Delete();
            }
            destDA.Update(destTable);

            // Set rows from source as Added, so the DataAdapter will insert them
            foreach (DataRow dr in sourceTable.Rows) {
               dr.SetAdded(); 
            }
            destDA.Update(sourceTable);
        }
    }    
} 
```

编辑：将 OverwriteTable 拆分为不同的方法以容纳您的内存数据表。还为您保留的 Year 和 Month 列名称在生成的 Sql 语句周围添加了引号。移动了由[Bendewey](https://stackoverflow.com/users/37881/bendewey)[修复](https://stackoverflow.com/questions/520506/how-do-i-structure-an-oledbcommand-query-so-that-i-can-take-tables-from-one-acces/521026#521026)的 CommandBuilder的处置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-06T15:50:31.220

尝试更换

```
using (var destCmdB = new OleDbCommandBuilder(destDA)) 
{            
    destDA.DeleteCommand = destCmdB.GetDeleteCommand();            
    destDA.InsertCommand = destCmdB.GetInsertCommand();        
} 
```

和

```
destDA.InsertCommand = new OleDbCommand("INSERT INTO `AdminUsers` (`UserName`, `Password`) VALUES (?, ?)");
destDA.DeleteCommand = new OleDbCommand("DELETE FROM `AdminUsers` WHERE (`ID` = ?)");
destDA.UpdateCommand = new OldDbCommand("UPDATE `AdminUsers` SET `UserName` = ?, `Password` = ? WHERE (`ID` = ?)"); 
```

查询对您的表结构有效的位置。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-06T16:37:07.537

@Mark Brackett 真的很接近你没有 DeleteCommand 的原因是因为 OleDbCommandBuilder 正在处理，所以移动那个括号，你应该很好。

```
static void CopyTable(string sourceConnectionString, string destinationConnectionString, string tableName)
{
// Get rows from source    
var sourceTable = new DataTable();
using (var sourceConn = new OleDbConnection(sourceConnectionString))
using (var sourceCmd = new OleDbCommand(tableName, sourceConn) {CommandType = CommandType.TableDirect})
using (var sourceDA = new OleDbDataAdapter(sourceCmd))
{
    sourceDA.Fill(sourceTable);
}
using (var destConn = new OleDbConnection(destinationConnectionString))
using (var destCmd = new OleDbCommand(tableName, destConn) {CommandType = CommandType.TableDirect})
using (var destDA = new OleDbDataAdapter(destCmd))
{
    // Since we're using a single table, we can have the CommandBuilder        
    // generate the appropriate INSERT and DELETE SQL statements        
    using (var destCmdB = new OleDbCommandBuilder(destDA))
    {
        destDA.DeleteCommand = destCmdB.GetDeleteCommand();
        destDA.InsertCommand = destCmdB.GetInsertCommand();

        // Get rows from destination, and delete them        
        var destTable = new DataTable();
        destDA.Fill(destTable);
        foreach (DataRow dr in destTable.Rows)
        {
            dr.Delete();
        }
        destDA.Update(destTable);
        // Set rows from source as Added, so the DataAdapter will insert them        
        foreach (DataRow dr in sourceTable.Rows)
        {
            dr.SetAdded();
        }
        destDA.Update(sourceTable);
    }
} 
```

## 更新

试试这个异常代码

```
static public void InitiateCopyProcessA()
{
    DataSet tablesA;
    tablesA = DatabaseHandling.getDataSetA();
    int i = 0;
    string tableName = "";
    try
    {
        foreach (DataTable table in tablesA.Tables)
        {
            tableName = table.TableName;  // for debugging the exception
            CopyTable(connectionstringA, connectionstringB, table.TableName);
        }
    }
    catch(Exception ex)
    {
        throw new Exception("Error updating " + tableName, ex);
    }
} 
```

## 更新

尝试改变

```
// Set rows from source as Added, so the DataAdapter will insert them                
foreach (DataRow dr in sourceTable.Rows)        
{            
    dr.SetAdded();        
} 
```

到

```
// only add the first row.
sourceTable.Rows[0].SetAdded() 
```

我很想知道它是否只是抛出错误的一行，或者它是否是查询。我的想法是其中一行具有时髦的价值

# c# - VS 2008 升级正在改变我的数据集设计器命名空间

> ID：520509
> 
> 赞同：2
> 
> 时间：2009-02-06T14:39:08.787
> 
> 标签：c#, visual-studio-2008, visual-studio-2005

我一直在将我们的解决方案从 VS 2005 升级到 VS 2008；仍然针对 .net 2.0 框架。转换向导很简单，我从未遇到过转换失败。到目前为止，我唯一遇到的问题是升级后我无法立即编译，因为 VS 更改了我的一些命名空间，导致命名冲突。

例如，我有一个 DAL 项目（我们称之为 MyNameSpace），它有一个“Clients”文件夹，其中包含一个名为“dsClient”的数据集。

这是数据集设计器类在转换之前的样子：

```
namespace MyNameSpace
{
    public partial class dsClient : global::System.Data.DataSet
    {
    }
} 
```

在转换过程中，VS 正在更改我的设计器类并将文件夹名称添加到命名空间的末尾，所以现在它看起来像这样：

```
namespace MyNameSpace.Clients
{
    public partial class dsClient : global::System.Data.DataSet
    {
    }
} 
```

问题是我在该文件夹中有另一个同名的类文件：

```
namespace MyNameSpace
{
    public class Clients
    {
    }
} 
```

这会导致命名冲突，我必须手动修复 VS 所做的更改。在某些情况下，VS 将命名空间名称更改为数据集的名称，而不是文件夹的名称。

这是转换向导中的配置吗？我想让向导只更新项目文件并保留代码。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-06T16:43:31.813

您可以通过提供应在其中生成代码的命名空间来解决此问题：

打开 xsd 文件的属性并将代码的命名空间放在“自定义工具命名空间”旁边。然后右键单击您的 xsd 文件并选择“运行自定义工具”，您就完成了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-06T16:11:45.183

我相信命名空间来自 xsd 文件的位置。我想一直到 2003 年，您将 xsd 放入的文件夹已将其放入命名空间。

在您的情况下，如果您将 xsd 移动到 DAL 项目的根目录，则应更正您的代码。我意识到这可能并不理想，但我认为这就是 DataSet 生成器的工作方式。

唯一让我吃惊的是命名空间在 2005 解决方案中没有包含“客户端”部分。感觉就像它是在根目录中生成的，但随后移动到子文件夹而没有重新生成。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-24T14:26:36.310

我不知道“自定义工具名称空间”文件属性！谢谢，这正是我想要的！:D

# .net - .NET 应用程序中是否会有针对全球事件的解决方案

> ID：520510
> 
> 赞同：1
> 
> 时间：2009-02-06T14:39:25.510
> 
> 标签：.net

在我们的程序中，我们使用 Microsoft 的 UserActivityHook.dll 来确定我们的 Windows 窗体应用程序的用户何时空闲超过 X 秒。这允许我们在一段时间后没有键盘或鼠标事件时复制类似于 MSN/Live Messanger 的“自动离开”行为。

我一直想知道为什么 .NET（据我所知）没有实现与此类全局事件交互的方法。看起来 FileSystemWatcher 类是类似的，因为它通知程序发生在程序之外的文件更改，为什么不提供鼠标/键盘事件的类似功能？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-08T10:16:31.483

You may consider the library provided in this article.

[http://www.codeproject.com/KB/cs/globalhook.aspx?display=PrintAll&fid=57596&df=90&mpp=25&noise=3&sort=Position&view=Quick&select=2857159](http://www.codeproject.com/KB/cs/globalhook.aspx?display=PrintAll&fid=57596&df=90&mpp=25&noise=3&sort=Position&view=Quick&select=2857159)

# asp.net - SQL Server 2005 和 APP_DATA

> ID：520514
> 
> 赞同：1
> 
> 时间：2009-02-06T14:41:12.420
> 
> 标签：asp.net, sql-server, sql-server-2005

曾经有人告诉我，不必让我的主机注册 SQL Server 数据库文件 + 用户/密码，而是可以将我的 MDB 文件放入我网站的 APP_DATA 并直接连接到它。我该怎么做呢？

我尝试使用 SqlConnection 的连接向导并设置 DataSource : Microsoft SQL Server Database File (SqlClient) Database file name : Path to a non-existent file in my App_Data 文件夹。身份验证：（尝试了 Windows 和 SQL 服务器）

我单击确定，此时系统询问我是否要创建文件，我选择“是”。然后我遇到这个消息：

* * *

微软视觉工作室

* * *

> 建立与 SQL Server 的连接时发生与网络相关或特定于实例的错误。服务器未找到或无法访问。验证实例名称是否正确以及 SQL Server 是否配置为允许远程连接。（提供者：SQL 网络接口，错误：26 - 错误定位服务器/指定的实例）

* * *

好的

* * *

我安装了 SQL Server 2005。有什么我想念的吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-06T14:47:24.950

我希望你的意思是 .MDF 文件？

文件名的完整路径在连接字符串中。就像是：

服务器=localhost;AttachDbFilename=c:\mydbfile.mdf;数据库=dbname; Trusted_Connection=是；

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-06T14:53:21.100

顺便说一句，我认为他们在谈论的是 MS SQL Express。

# php - 图片 URL 错误捕获问题

> ID：520515
> 
> 赞同：0
> 
> 时间：2009-02-06T14:41:17.707
> 
> 标签：php, http

我正在尝试查看 URL 是否存在，如果不存在，则将包含 URL 的变量重置为错误页面/图像。但是，我在下面的尝试将 PIC_URL 的每个实例都设置为 noimage.gif，无论它是否存在以及是否可访问。我错过了什么？

```
if (@fopen($_REQUEST[$PIC_URL],"r")) 
{
$status = "1";
} 
else  if (!(@fopen($_REQUEST[$PIC_URL],"r"))
{

$status = "2"; 
}

if ( $status == "2" ) $PIC_URL = "http://www.tricityhomes.com/assets/images/noimage.gif"; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-06T14:48:56.350

您可能想尝试做类似的事情

```
<?php
function url_exists($url) {
    // Version 4.x supported
    $handle   = curl_init($url);
    if (false === $handle)
    {
        return false;
    }
    curl_setopt($handle, CURLOPT_HEADER, false);
    curl_setopt($handle, CURLOPT_FAILONERROR, true);  // this works
    curl_setopt($handle, CURLOPT_HTTPHEADER, Array("User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.15) Gecko/20080623 Firefox/2.0.0.15") ); // request as if Firefox   
    curl_setopt($handle, CURLOPT_NOBODY, true);
    curl_setopt($handle, CURLOPT_RETURNTRANSFER, false);
    $connectable = curl_exec($handle);
    curl_close($handle);  
    return $connectable;
}
?> 
```

来源：[http ://uk.php.net/manual/en/function.file-exists.php#85246](http://uk.php.net/manual/en/function.file-exists.php#85246)

原因是如上所述，检查 fopen 的原始值不是最好的主意，而且该方法没有考虑到被重定向到错误页面等。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T14:46:16.340

使用`file_exists`或 is_readable，不要使用原始值

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-06T14:46:24.670

else 部分的测试看起来是多余的，你的意思是`$_REQUEST['PIC_URL']`？

```
if (@fopen($_REQUEST['PIC_URL'],"r")) 
{
    $status = "1";
} 
else
{

    $status = "2"; 
} 
```

不过还有很多问题。要测试远程文件是否存在，您最好使用 file_exists，甚至滚动您自己的方法来执行 HEAD 请求。

# windows-services - 更改服务的启动类型 (Windows)

> ID：520517
> 
> 赞同：4
> 
> 时间：2009-02-06T14:42:42.260
> 
> 标签：windows-services, registry, wmi

我正在寻找更改 Windows 服务启动类型的方法，我找到了两种方法来做到这一点......

[通过编辑注册表](http://www.techbytes.ca/techbyte74.html)或[使用 WMI 类](http://www.codeproject.com/KB/system/extendservicecontroller.aspx)

我想知道哪个是最好的...我希望我的应用程序在 Windows 和 Vista 上都能正常运行。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-06T14:48:57.427

也可以直接使用win32 API。我肯定会推荐 WMI 课程；如果将来的 Windows 版本发生变化，您的代码很可能仍然有效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-06T15:53:31.557

我希望对未来版本的 Windows 安全，最好使用 WMI。

如果您不打算超越 Windows 7，我建议您使用 WinAPI 函数（想到[OpenSCManager](http://msdn.microsoft.com/en-us/library/ms684323(VS.85).aspx)和[ChangeServiceConfig ）。](http://msdn.microsoft.com/en-us/library/ms681987(VS.85).aspx)我发现它们更容易理解，并且有大量关于如何使用它们的代码示例。另一方面，WMI 仍然是新的，并且没有很好的文档记录。

永远不要直接编辑注册表。WinAPI 或 WMI 接口的存在是为了从 Windows 内部处理数据的方式中抽象出任务。绕过它们会带来未来最大的破坏风险。

# c# - 在 Javascript 中获取属性背后的代码？

> ID：520519
> 
> 赞同：4
> 
> 时间：2009-02-06T14:43:15.643
> 
> 标签：c#, asp.net, javascript

我想将属性后面的 ac# 代码烧入 javascript alert(<%= someProperty%>); . 由于某种原因，它不起作用。有没有办法可以将代码隐藏属性刻录到 javascript 中？谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-06T14:56:16.773

不确定这是否适用于您的情况，但我认为您最好的选择可能是在页面加载后的代码中动态地将 javascript 附加到事件中，并在此时设置参数值。

例如：

```
btnSubmit.Attributes.Add("onclick","alert(" + someProperty + ");"); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-06T14:44:29.557

我认为你错过了 ' 这样的尝试 -->alert('<%= someProperty%>');

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-06T14:45:38.447

也许这是一个愚蠢的建议。你有没有尝试过

```
alert("<%= someProperty%>"); 
```

?

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-06T15:48:47.273

要使用 <%= => ASP.NET 表达式，**您的 Javascript 不能驻留在外部 .js 文件**中。它必须是 ASPX 标记的一部分才能解释脚本。

```
<head>
  <script type="text/javascript">
    alert(escape('<%=someProperty%>'));
  </script>
</head> 
```

此致...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-07T06:02:48.563

您可以使用 ClientScript.RegisterExpandoAttribute 方法将 C# 代码隐藏属性注册到 JavaScript 属性中。

# java - Java 中的 Swing 重用

> ID：520525
> 
> 赞同：1
> 
> 时间：2009-02-06T14:45:28.293
> 
> 标签：java, swing, netbeans, reusability

我正在使用 NetBeans 6.5 和不断重复的 Swing 模式编写 Java 桌面应用程序。我的每一个对话框都有一个`Save Button`并且`Close Button`在保存按钮后面有一个大部分不同的行为，在关闭按钮后面有相同的代码。

如何在不复制和粘贴的情况下重用此代码，同时为对话框的内部面板保留 GUI Builder 工具的用户？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-06T14:53:47.200

我不是 netbeans 专家，但我建议在对话框构造函数中添加一个 saveAction 和 closeAction，这两个都实现了 Action，然后只获取 GUI 构建器代码来执行相应的 Action。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T14:56:40.047

我是一名 C# 程序员，但同样的概念也适用。您可以创建一个抽象类来保存始终相同的代码和每个操作的抽象方法。此方法将由继承此新抽象类的类实现。

# java - 为什么有些人声称 Java 的泛型实现很糟糕？

> ID：520527
> 
> 赞同：126
> 
> 时间：2009-02-06T14:45:52.473
> 
> 标签：java, generics

我偶尔听说，对于泛型，Java 做得不对。（最近的参考，[在这里](https://stackoverflow.com/questions/457822/what-are-the-things-java-got-right)）

请原谅我的经验不足，但什么会使他们变得更好？

* * *

## 回答 #1

> 赞同：156
> 
> 时间：2009-02-06T14:53:27.200

坏的：

*   类型信息在编译时丢失，所以在执行时你无法判断它“意味着”是什么类型
*   不能用于值类型（这是一个大问题 - 在 .NET 中，a`List<byte>`确实由 a 支持`byte[]`，并且不需要装箱）
*   调用泛型方法的语法很糟糕（IMO）
*   约束的语法可能会令人困惑
*   通配符通常令人困惑
*   由于上述原因的各种限制 - 铸造等

好的：

*   通配符允许在调用方指定协变/逆变，这在许多情况下都非常简洁
*   总比没有好！

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-02-06T14:50:38.517

最大的问题是 Java 泛型只是编译时的东西，你可以在运行时颠覆它。C# 之所以受到称赞，是因为它进行了更多的运行时检查。[这篇文章](https://stackoverflow.com/questions/355060/c-vs-java-generics)中有一些非常好的讨论，它链接到其他讨论。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-02-06T14:52:37.123

主要问题是 Java 在运行时实际上没有泛型。这是一个编译时特性。

当您在 Java 中创建泛型类时，他们使用一种称为“类型擦除”的方法来实际从类中删除所有泛型类型，并实质上将它们替换为 Object。泛型的最高版本是，只要它出现在方法体中，编译器就会简单地将类型转换插入指定的泛型类型。

这有很多缺点。恕我直言，最大的问题之一是您不能使用反射来检查泛型类型。类型在字节码中实际上不是泛型的，因此不能作为泛型进行检查。

这里的差异很好的概述：[http ://www.jprl.com/Blog/archive/development/2007/Aug-31.html](http://www.jprl.com/Blog/archive/development/2007/Aug-31.html)

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-02-06T14:52:02.553

1.  运行时实现（即不是类型擦除）；
2.  使用原始类型的能力（这与（1）有关）；
3.  虽然通配符很有用，但语法和知道何时使用它却让很多人感到困惑。和
4.  没有性能改进（因为 (1)；Java 泛型是 casti 对象的语法糖）。

(1) 导致一些非常奇怪的行为。我能想到的最好的例子是。认为：

```
public class MyClass<T> {
  T getStuff() { ... }
  List<String> getOtherStuff() { ... }
} 
```

然后声明两个变量：

```
MyClass<T> m1 = ...
MyClass m2 = ... 
```

现在打电话`getOtherStuff()`：

```
List<String> list1 = m1.getOtherStuff(); 
List<String> list2 = m2.getOtherStuff(); 
```

第二个的泛型类型参数被编译器剥离，因为它是原始类型（意味着未提供参数化类型），即使它与参数化类型*无关*。

我还会提到我最喜欢的 JDK 声明：

```
public class Enum<T extends Enum<T>> 
```

除了通配符（这是一个混合包），我只是认为 .Net 泛型更好。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2009-02-07T00:49:30.460

我要抛出一个非常有争议的观点。泛型使语言复杂化，也使代码复杂化。例如，假设我有一个将字符串映射到字符串列表的映射。在过去，我可以简单地将其声明为

```
Map someMap; 
```

现在，我必须将其声明为

```
Map<String, List<String>> someMap; 
```

每次我将它传递给某个方法时，我都必须一遍又一遍地重复那个又长又长的声明。在我看来，所有额外的输入都会分散开发人员的注意力，并将他带出“区域”。此外，当代码中充满了大量杂乱无章的内容时，有时很难稍后再返回并快速筛选所有杂乱无章的内容以找到重要的逻辑。

Java 已经因为是最常用的语言之一而声名狼藉，而泛型只会增加这个问题。

你真的为所有这些额外的冗长买了什么？有多少次你真的遇到过有人将一个整数放入一个应该包含字符串的集合中，或者有人试图从一个整数集合中拉出一个字符串？在我 10 年构建商业 Java 应用程序的经验中，这从来都不是错误的主要来源。所以，我不确定你会因为额外的冗长而得到什么。这真的只是让我觉得额外的官僚包袱。

现在我将变得非常有争议。我认为 Java 1.4 中集合的最大问题是必须在任何地方进行类型转换。我认为这些类型转换是额外的、冗长的东西，它们与泛型有许多相同的问题。所以，例如，我不能只做

```
List someList = someMap.get("some key"); 
```

我要做

```
List someList = (List) someMap.get("some key"); 
```

当然，原因是 get() 返回一个 Object，它是 List 的超类型。因此，如果没有类型转换，就无法进行分配。再一次，想想这条规则真正给你带来了多少。根据我的经验，不多。

我认为如果 1) 它没有添加泛型，但 2) 允许从超类型到子类型的隐式转换，Java 会更好。让不正确的强制转换在运行时被捕获。然后我可以简单地定义

```
Map someMap; 
```

后来做

```
List someList = someMap.get("some key"); 
```

所有的麻烦都会消失，我真的不认为我会在我的代码中引入大量新的错误来源。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-02-07T00:21:08.457

它们的另一个副作用是编译时而不是运行时是您不能调用泛型类型的构造函数。所以你不能用它们来实现一个通用工厂......

```
 public class MyClass {
     public T getStuff() {
       return new T();
     }
    } 
```

--杰夫克++

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-06-01T12:44:39.917

忽略整个类型擦除混乱，指定的泛型不起作用。

这编译：

```
List<Integer> x = Collections.emptyList(); 
```

但这是一个语法错误：

```
foo(Collections.emptyList()); 
```

其中 foo 定义为：

```
void foo(List<Integer> x) { /* method body not important */ } 
```

因此，表达式类型是否检查取决于它是分配给局部变量还是方法调用的实际参数。这有多疯狂？

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-02-06T14:52:48.887

Java 泛型在编译时检查正确性，然后删除所有类型信息（该过程称为*类型擦除*。因此，泛型`List<Integer>`将简化为其*原始类型*，非泛型`List`，它可以包含任意类的对象。

这导致能够在运行时将任意对象插入到列表中，并且现在无法判断哪些类型被用作泛型参数。后者反过来导致

```
ArrayList<Integer> li = new ArrayList<Integer>();
ArrayList<Float> lf = new ArrayList<Float>();
if(li.getClass() == lf.getClass()) // evaluates to true
  System.out.println("Equal"); 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-02-06T14:51:48.980

将泛型引入 Java 是一项艰巨的任务，因为架构师试图平衡功能、易用性以及与遗留代码的向后兼容性。不出所料，必须做出妥协。

有些人还认为 Java 对泛型的实现将语言的复杂性提高到了无法接受的程度（参见 Ken Arnold 的“[泛型被认为是有害](http://weblogs.java.net/blog/arnold/archive/2005/06/generics_consid_1.html)的”）。Angelika Langer 的[泛型常见问题解答](http://www.angelikalanger.com/GenericsFAQ/JavaGenericsFAQ.html)提供了一个关于事情变得多么复杂的好主意。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-02-07T00:09:43.927

我希望这是一个维基，所以我可以添加到其他人......但是......

问题：

*   类型擦除（无运行时可用性）
*   不支持原始类型
*   与注释不兼容（它们都是在 1.5 中添加的，我仍然不确定为什么注释不允许泛型除了加速功能之外）
*   与数组不兼容。（有时我真的想做类似 Class 的事情`<`？扩展 MyObject `>`[]，但我不被允许）
*   奇怪的通配符语法和行为
*   泛型支持在 Java 类中不一致的事实。他们将它添加到大多数集合方法中，但每隔一段时间，您就会遇到一个它不存在的实例。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2009-02-06T14:50:17.067

Java 在运行时不强制泛型，仅在编译时强制。

这意味着您可以做一些有趣的事情，例如将错误的类型添加到泛型集合中。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-02-06T14:54:56.090

Java 泛型只是编译时的，并且被编译成非泛型代码。在 C# 中，实际编译的 MSIL 是通用的。这对性能有很大的影响，因为 Java 仍然在运行时强制转换。[请参阅此处了解更多信息](http://www.oreillynet.com/onjava/blog/2005/10/generics_performance_demystifi_1.html)。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-12-01T13:45:44.403

如果您收听[Java Posse #279 - 采访 Joe Darcy 和 Alex Buckley](http://www.javaposse.com/index.php?post_id=529403)，他们会谈到这个问题。这还链接到 Neal Gafter 的一篇名为[Reified Generics for Java](http://gafter.blogspot.com/2006/11/reified-generics-for-java.html)的博客文章，该文章说：

> 许多人对 Java 中泛型的实现方式所带来的限制不满意。具体来说，他们对泛型类型参数没有具体化感到不满：它们在运行时不可用。泛型是使用擦除实现的，其中泛型类型参数在运行时被简单地删除。

那篇博客文章引用了一个较旧的条目，[通过擦除令人费解：答案部分](http://gafter.blogspot.com/2004/09/puzzling-through-erasure-answer.html)，它强调了需求中关于*迁移兼容性*的观点。

> 目标是提供源代码和目标代码的向后兼容性，以及迁移兼容性。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2022-02-18T00:59:38.627

泛型的问题在于，IMO 将 Java API 中的方法签名的阅读和理解难度提高了 10 倍，而在健壮性方面并没有太多收获。事实上，他们可能应该采取另一种方式，通过方法调用完全摆脱编译时类型兼容性检查，并将其留给开发人员来解决或处理运行时异常。

# visual-studio-2008 - Visual Studio 设置库

> ID：520545
> 
> 赞同：3
> 
> 时间：2009-02-06T14:49:08.393
> 
> 标签：visual-studio-2008

曾经有一个画廊，人们可以在其中分享他们对 Visual Studio 的设置，例如字体、颜色等。有人知道这是哪里吗？

追问：有人知道 Scott Guthrie 使用的是什么设置吗？

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-06T14:52:08.327

它位于[http://idehotornot.ning.com/](http://idehotornot.ning.com/)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-02-07T15:41:43.630

我想你想要这个网站：[http](http://studiostyl.es/) : //studiostyl.es/ Awwww，是的。

# file - 仅当文件存在时才运行 Ant 目标的 Ant 任务？

> ID：520546
> 
> 赞同：155
> 
> 时间：2009-02-06T14:49:43.133
> 
> 标签：file, ant, build-automation

是否存在仅在给定文件存在时才会执行块的 ANT 任务？我有一个问题，我有一个通用的 ant 脚本，它应该做一些特殊的处理，但前提是存在一个特定的配置文件。

* * *

## 回答 #1

> 赞同：202
> 
> 时间：2009-02-06T14:53:22.097

[可用](http://ant.apache.org/manual/Tasks/available.html)和[条件](http://ant.apache.org/manual/Tasks/condition.html)

```
<target name="check-abc">
    <available file="abc.txt" property="abc.present"/>
</target>

<target name="do-if-abc" depends="check-abc" if="abc.present">
    ...
</target> 
```

* * *

## 回答 #2

> 赞同：123
> 
> 时间：2010-07-20T21:25:28.920

从编码的角度来看，这可能更有意义（可通过 ant-contrib 获得：[http://ant-contrib.sourceforge.net/](http://ant-contrib.sourceforge.net/)）：

```
<target name="someTarget">
    <if>
        <available file="abc.txt"/>
        <then>
            ...
        </then>
        <else>
            ...
        </else>
    </if>
</target> 
```

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2010-07-28T13:52:32.960

自 Ant 1.8.0 以来，显然还有资源存在

来自 [http://ant.apache.org/manual/Tasks/conditions.html](http://ant.apache.org/manual/Tasks/conditions.html)

> 测试资源是否存在。自蚂蚁 1.8.0
> 
> 要测试的实际资源被指定为嵌套元素。
> 
> 一个例子：
> 
> ```
> <resourceexists>
>   <file file="${file}"/>
> </resourceexists> 
> ```

我打算从上面对这个问题的好答案中修改这个例子，然后我发现了这个

> 从 Ant 1.8.0 开始，您可以改为使用属性扩展；true（或 on 或 yes）值将启用该项目，而 false（或 off 或 no）将禁用它。其他值仍假定为属性名称，因此仅当定义​​了命名属性时才启用该项目。
> 
> 与旧样式相比，这为您提供了额外的灵活性，因为您可以从命令行或父脚本覆盖条件：
> 
> ```
> <target name="-check-use-file" unless="file.exists">
>     <available property="file.exists" file="some-file"/>
> </target>
> <target name="use-file" depends="-check-use-file" if="${file.exists}">
>     <!-- do something requiring that file... -->
> </target>
> <target name="lots-of-stuff" depends="use-file,other-unconditional-stuff"/> 
> ```

[来自http://ant.apache.org/manual/properties.html#if+unless](http://ant.apache.org/manual/properties.html#if+unless)的 ant 手册

希望这个例子对某些人有用。他们没有使用resourceexists，但大概你可以？......

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2013-05-15T03:46:14.640

我认为值得参考这个类似的答案：[https ://stackoverflow.com/a/5288804/64313](https://stackoverflow.com/a/5288804/64313)

这是另一个快速解决方案。`<available>`使用标签还有其他可能的变化：

```
# exit with failure if no files are found
<property name="file" value="${some.path}/some.txt" />
<fail message="FILE NOT FOUND: ${file}">
    <condition><not>
        <available file="${file}" />
    </not></condition>
</fail> 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2016-01-27T22:17:07.437

### 检查使用文件名过滤器，如`DB_*/**/*.sql`

如果存在与通配符过滤器相​​对应的一个或多个文件，这是一种执行操作的变体。也就是说，您不知道文件的确切名称。

在这里，我们递归地在名为“ **DB_*** ”的任何子目录中查找“ ***.sql ”文件。**您可以根据需要调整过滤器。

 ****注意：Apache Ant 1.7 及更高版本！**

如果存在匹配的文件，这是设置属性的目标：

```
<target name="check_for_sql_files">
    <condition property="sql_to_deploy">
        <resourcecount when="greater" count="0">
            <fileset dir="." includes="DB_*/**/*.sql"/>
        </resourcecount>
    </condition>
</target> 
```

这是一个“条件”目标，仅在文件存在时运行：

```
<target name="do_stuff" depends="check_for_sql_files" if="sql_to_deploy">
    <!-- Do stuff here -->
</target> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-05-16T14:48:01.743

您可以通过命令使用名称等于您需要的名称的文件列表来执行操作。这比创建一个特殊的目标要容易和直接得多。而且您不需要任何额外的工具，只需要纯 Ant。

```
<delete>
    <fileset includes="name or names of file or files you need to delete"/>
</delete> 
```

请参阅：[文件集](https://ant.apache.org/manual/Types/fileset.html)。

# c# - ZIP 文件的 EOF 标记是什么？

> ID：520547
> 
> 赞同：1
> 
> 时间：2009-02-06T14:49:46.630
> 
> 标签：c#, zip, file-format, eof

我有一个使用 SharpZIPlib 解压缩一些 zip 文件的 C# 程序？它工作正常，但在一个文件上，我不断收到“Unexpected EOF”错误？实际上是否存在 EOF 标记，或者 Zip 文件是否被截断？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-06T14:51:40.947

您的文件被截断（或可能扩展或以其他方式损坏）。

您可以在其上运行常规解压缩程序（例如“ `unzip -l file.zip`”）来证明这一点。

顺便说一句，如果您使用 FTP 下载文件，您是否记得使用二进制传输？如果您（不小心）使用了 ASCII 模式，那将破坏任何二进制文件，例如 ZIP 存档。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-06T19:11:04.557

一个简单的 ZIP 文件如下所示：

```
LocalHeader1
CompressedData1
LocalHeader2
CompressedData2
[...]
LocalHeaderN
CompressedDataN
CentralHeader1
CentralHeader2
[...]
CentralHeaderN
EndHeader 
```

EndHeader 包含（除其他外）第一个 CentralHeader 的偏移量，然后每个 CentralHeader 包含与其匹配的 LocalHeader 的偏移量。

一些库可以从一开始就读取 zip 文件以顺序处理 LocalHeaders，从而恢复损坏的 zip 文件可以恢复的内容。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-06T14:52:19.713

Unexpected EOF 的确切含义是：在读取文件时，函数遇到了文件末尾，而库正在期待其他东西（数据）。它不是一个标记。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-10T06:15:30.570

你试过 DotNetZip 吗？ [http://www.codeplex.com/DotNetZip](http://www.codeplex.com/DotNetZip)

# sql - 授予权限存储过程

> ID：520552
> 
> 赞同：1
> 
> 时间：2009-02-06T14:51:18.047
> 
> 标签：sql

我有一个包含一些存储过程的数据库。

我的问题是：这样做有问题吗：

将 [dbo].[StoredProcedureXPTO] 授予 [Public] 执行

即向公众授予执行许可？？还是安全问题？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-06T14:56:14.293

如果这就是你想要的，那没有问题。如果您想限制对存储过程的访问，那么这不是要走的路。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-06T14:59:42.770

显然取决于存储过程的作用以及您是否希望“公共”能够做到这一点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-06T15:25:03.407

答案完全取决于您的存储过程做什么以及您是否希望每个人和他的狗都可以访问它。

根据我的经验，这很不寻常，因为我为我的应用程序提供了范围非常狭窄的用户和角色。

但是你的问题让我想知道你的问题背后是否还有另一个问题。你为什么要问？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-06T16:42:06.950

我喜欢避免授予任何公共权限，因为您不能将用户添加到不在公共角色中的数据库中。因此，本质上，您通过不给自己一种方法将任何数据库用户锁定在该存储过程之外（除了稍后更改存储过程权限）来限制安全性的灵活性。

# vba - 返回所选单元格的背景颜色

> ID：520570
> 
> 赞同：33
> 
> 时间：2009-02-06T14:53:55.920
> 
> 标签：vba, excel

我有一个电子表格，其中的单元格颜色很有意义。

有谁知道我如何在 Excel 工作表中返回当前单元格的背景颜色值？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-02-06T15:17:31.597

你可以使用`Cell.Interior.Color`，我用它来计算一个范围内具有给定背景颜色的单元格的数量（即匹配我的图例）。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2014-02-26T15:09:22.253

如果您正在查看表格、数据透视表或具有条件格式的内容，您可以尝试：

```
ActiveCell.DisplayFormat.Interior.Color 
```

这似乎也适用于常规单元格。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-02-06T14:58:24.957

也许你可以使用这个属性：

```
ActiveCell.Interior.ColorIndex - one of 56 preset colors 
```

和

```
ActiveCell.Interior.Color - RGB color, used like that:

ActiveCell.Interior.Color = RGB(255,255,255) 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2018-05-24T22:54:45.890

下面的代码给出了范围的**HEX**和**RGB**值，无论是**使用条件格式**还是其他格式。如果范围未使用条件格式格式化，并且您打算在 Excel 中使用 iColor 函数作为 UDF。它行不通。[阅读MSDN](https://msdn.microsoft.com/en-us/vba/excel-vba/articles/range-displayformat-property-excel)的以下摘录。

*请注意，**DisplayFormat**属性在用户定义的函数中不起作用。例如，在返回单元格内部颜色的工作表函数中，如果您使用类似于以下内容的行：*

```
Range.DisplayFormat.Interior.ColorIndex 
```

*然后执行工作表函数以返回#VALUE！错误。*如果您没有找到条件格式范围的颜色，那么我鼓励您宁愿使用

```
Range.Interior.ColorIndex 
```

因为那么该函数也可以用作 Excel 中的 UDF。如**iColor(B1,"HEX")**

```
Public Function iColor(rng As Range, Optional formatType As String) As Variant
'formatType: Hex for #RRGGBB, RGB for (R, G, B) and IDX for VBA Color Index
    Dim colorVal As Variant
    colorVal = rng.DisplayFormat.Interior.Color
    Select Case UCase(formatType)
        Case "HEX"
            iColor = "#" & Format(Hex(colorVal Mod 256),"00") & _
                           Format(Hex((colorVal \ 256) Mod 256),"00") & _
                           Format(Hex((colorVal \ 65536)),"00")
        Case "RGB"
            iColor = Format((colorVal Mod 256),"00") & ", " & _
                     Format(((colorVal \ 256) Mod 256),"00") & ", " & _
                     Format((colorVal \ 65536),"00")
        Case "IDX"
            iColor = rng.Interior.ColorIndex
        Case Else
            iColor = colorVal
    End Select
End Function

'Example use of the iColor function
Sub Get_Color_Format()
    Dim rng As Range

    For Each rng In Selection.Cells
        rng.Offset(0, 1).Value = iColor(rng, "HEX")
        rng.Offset(0, 2).Value = iColor(rng, "RGB")
    Next
End Sub 
```

# c# - ToolStripMenuItem 中的鼠标按钮

> ID：520573
> 
> 赞同：0
> 
> 时间：2009-02-06T14:54:40.660
> 
> 标签：c#, winforms, mouse, toolstrip

我有一个包含一些项目的上下文菜单。其中一个项目有一个子菜单（或其他任何名称），其中包含一些项目（取决于它找到的文件）。

我想要做的是，当我左键单击其中一个子项时，我希望发生一件事，而当我右键单击时，我希望发生另一件事。

我的问题是，当我使用 filesToolStripMenuItem_DropDownItemClicked 时，我没有在参数中得到任何 MouseEventArgs，所以我无法找出是哪个鼠标按钮用于单击该项目。

我尝试自己将其添加到参数中，但随后出现了一些错误。

有谁知道我该如何解决这个问题？所以我可以找出是用什么鼠标按钮来单击子项（这是一个 ToolStripMenuItem）？

谢谢

编辑：这是我用来创建子项目的代码：

```
IPHostEntry ipE = Dns.GetHostEntry(Dns.GetHostName());
IPAddress[] IpA = ipE.AddressList;
for (int i = 0; i < IpA.Length; i++)
{
      if (!IpA[i].ToString().Contains(":"))
           cxItems.Items.Add(new ToolStripMenuItem(IpA[i].ToString()));
} 
```

对于这些项目，我希望能够根据我使用的鼠标按钮做不同的事情

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-06T15:04:47.597

```
 private void button2_Click(object sender, EventArgs e)
    {
        ToolStripMenuItem item1 = new ToolStripMenuItem("Menu1");
        ToolStripMenuItem subMenuitem1 = new ToolStripMenuItem("SubMenu");
        item1.DropDownItems.Add(subMenuitem1);
        this.contextMenuStrip1.Items.Add(item1);
        subMenuitem1.MouseDown += new MouseEventHandler(subMenuitem1_MouseDown);
        this.contextMenuStrip1.Show(this.button2,new Point(0,0));
    }

    void subMenuitem1_MouseDown(object sender, MouseEventArgs e)
    {
        //e.Button will determine which button was clicked.
        MessageBox.Show(e.Button.ToString());
    } 
```

这应该可以帮助您入门。

回复：您正在编辑：

问题是，您只是在说 new ToolStripMenuItem(IpA[i].ToString()) 而没有保留对它的引用。以下是您需要执行的操作：

```
 IPHostEntry ipE = Dns.GetHostEntry(Dns.GetHostName());
    IPAddress[] IpA = ipE.AddressList;
    for (int i = 0; i < IpA.Length; i++)
    {
          if (!IpA[i].ToString().Contains(":"))
          {
               ToolStripMenuItem subItem = new ToolStripMenuItem(IpA[i].ToString());
               subItem.MouseDown += new MouseEventHandler(subItem_MouseDown);
               cxItems.Items.Add(subItem);
          }
    }

    void subMenuitem1_MouseDown(object sender, MouseEventArgs e)
    {
          //get a reference to the menu that was clicked
          ToolStripMenuItem clickedMenu = sender as ToolStripMenuItem;
          //e.Button will tell you which button was clicked.
    } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T15:11:06.493

您可以访问子菜单项吗？如果是这样，您可以处理子项目上的 MouseDown 事件。

```
private System.Windows.Forms.ToolStripMenuItem optionToolStripMenuItem;
private System.Windows.Forms.ToolStripMenuItem subitemToolStripMenuItem;
private System.Windows.Forms.ToolStripMenuItem subItem2ToolStripMenuItem;

public void init()
{
    // 
    // optionToolStripMenuItem
    // 
    this.optionToolStripMenuItem.DropDownItems.AddRange(new System.Windows.Forms.ToolStripItem[] {
    this.subitemToolStripMenuItem,
    this.subItem2ToolStripMenuItem});
    this.optionToolStripMenuItem.Name = "optionToolStripMenuItem";
    this.optionToolStripMenuItem.Size = new System.Drawing.Size(152, 22);
    this.optionToolStripMenuItem.Text = "Option";
    // 
    // subitemToolStripMenuItem
    // 
    this.subitemToolStripMenuItem.Name = "subitemToolStripMenuItem";
    this.subitemToolStripMenuItem.Size = new System.Drawing.Size(152, 22);
    this.subitemToolStripMenuItem.Text = "Subitem";
    // 
    // subItem2ToolStripMenuItem
    // 
    this.subItem2ToolStripMenuItem.Name = "subItem2ToolStripMenuItem";
    this.subItem2ToolStripMenuItem.Size = new System.Drawing.Size(152, 22);
    this.subItem2ToolStripMenuItem.Text = "SubItem2";
    this.subItem2ToolStripMenuItem.MouseDown += new System.Windows.Forms.MouseEventHandler(this.subItem2ToolStripMenuItem_MouseDown);
    this.subItem2ToolStripMenuItem.Click += new System.EventHandler(this.subItem2ToolStripMenuItem_Click);
}

private bool wasRightClicked = false;
private void subItem2ToolStripMenuItem_MouseDown(object sender, MouseEventArgs e)
{
    if (e.Button == MouseButtons.Right)
        wasRightClicked = true;
} 
```

# sql - 为什么存储过程不能从另一个数据库中读取表（我一定是错误地使用了 GRANT 和 DENY）

> ID：520579
> 
> 赞同：3
> 
> 时间：2009-02-06T14:56:00.003
> 
> 标签：sql, stored-procedures, database-permissions

我有两个 Microsoft SQL Server 2000 数据库，一个存储过程尝试从另一个数据库读取数据。这曾经可以正常工作，但是由于我变得具有安全意识并将登录名（SQL 用户）从“db owner”更改为“denydatareader”，因此调用失败。

如果我使用组“datareader”，我可以让事情正常工作，但由于我不希望此登录名具有对用户表的读取权限（ASP 仅使用 procs），我认为这是不明智的。如果我将用户从所有组中取出，它也可以工作！！！这个可以吗？

* * *

一个数据库称为“内部”，并有一个名为“Stuff”的表。另一个称为“WebFacing”，并有一个名为“Get_Some_Data”的存储过程，它从“Internal..Stuff”中选择。

我在内部数据库上运行了这个命令：
`GRANT SELECT ON Stuff TO magnus`

我在 WebFacing 数据库上运行了这个：
`GRANT EXECUTE ON Get_Some_Data TO magnus`

我的 ASP 使用 SQL 登录“magnus”并连接到“WebFacing”数据库。当它尝试执行该过程时，它会出错：
`SELECT permission denied on object 'Stuff', database 'Internal', owner 'dbo'.`

* * *

（抱歉，如果这是一个愚蠢的问题，但我被推到了深处，昨天才了解了 GRANT 和 DENY。我试过谷歌搜索......）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-06T16:28:51.703

将 SQL 登录与组/角色（或不与组/角色）相关联对于必须跟踪数据库权限的人来说更方便。由于您对这一切都不熟悉，因此在担心通过组/角色管理权限之前，我将首先专注于正确获取特定登录的权限。

当我第一次开始使用 SQL Server 权限时，让我很满意的一件事是了解用于执行存储过程的权限是用于调用 proc 的 SQL 登录名，还是与创建相关联的 SQL 登录名proc本身的。用于执行过程代码的一组凭据和相关权限的术语称为存储过程运行的“安全上下文”。我最近一直在使用 MySQL，但如果我没记错的话，用于在 SQL Server 上执行存储过程的默认安全上下文是 CALLER 而不是 proc 所有者的安全上下文。这总是让我觉得违反直觉，因为在我看来，使用存储过程的主要优势之一应该是能够仅将特定过程的 EXEC 权限授予 CALLER 登录。但是当我尝试这样做时，我不可避免地会遇到权限错误，因为我用来调用 proc 的凭据没有完成存储过程中包含的一个或多个操作所需的权限。

If you're using SQL Server 2005 and want to be able to grant only EXEC permissions to CALLER credentials, then [this](http://www.mssqltips.com/tip.asp?tip=1579) article may help shed some light on how to do so. In my opinion, that's the "correct" way to do things, though I'm sure there are probably others who might disagree (though I'd probably stick to my argument on this point).

Anyway, I'm not sure how much I've clarified the issue for you with this post. SQL Server permissions management is indeed a bit of a deep end when you first delve into the whole issue. It's not making it any easier that you're having to deal with setting them up accross multiple databases.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-06T18:41:57.753

You can enable Croos-Database ownership, without having to give select permissions on the table that your sproc is calling. But use at your own risk. I use it for the scenraio you are describing:

alter database dbname set db_chaining on

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-06T17:15:03.233

When you go across to a different database on the same instance, each "commmand" has permissions on its tables and views evaluated by the destination database in the same context before it is allowed to run.

This is unlike being completely in the same database as the SP, where the SELECT permissions are not required for tables referred to in an SP for which you have EXEC rights.

You can use EXECUTE AS to execute as a person who does have the rights, or another alternative is to make a VIEW in the second database which returns only the columns they need, or to set column-level permissions on the tables, or to create an SP and call it (you will have to insert the results into a temporary table, so not terribly efficient).

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-08-16T16:13:36.780

Connection string user!

Definitely a permissions issue, but who?

For me, calling stored procedure that (tried to) accesses a table in a different database, it was the user in the connection string that had to be GRANTed permissions.

# java - 使用 JDBC 的连接池选项：DBCP 与 C3P0

> ID：520585
> 
> 赞同：323
> 
> 时间：2009-02-06T14:57:19.390
> 
> 标签：java, jdbc, connection-pooling, c3p0, apache-commons-dbcp

可用于 Java/JDBC 的最佳连接池库是什么？

我正在考虑 2 个主要候选人（免费/开源）：

*   Apache DBCP - [http://commons.apache.org/dbcp/](http://commons.apache.org/dbcp/)
*   C3P0 - [http://sourceforge.net/projects/c3p0](http://sourceforge.net/projects/c3p0)

我在博客和其他论坛上阅读了很多关于它们的信息，但无法做出决定。

这两个有什么相关的替代品吗？

* * *

## 回答 #1

> 赞同：183
> 
> 时间：2009-02-06T16:02:23.910

DBCP 已过时，不是生产级。一段时间前，我们对两者进行了内部分析，创建了一个测试夹具，该夹具针对这两者生成负载和并发性，以评估它们在现实生活条件下的适用性。

DBCP 不断地在我们的测试应用程序中生成异常，并且努力达到 C3P0 完全能够在没有任何异常的情况下处理的性能水平。

C3P0 还可以在恢复时稳健地处理 DB 断开连接和透明重新连接，而如果从其下方取出链接，则 DBCP 永远不会恢复连接。更糟糕的是，DBCP 将连接对象返回给底层传输已中断的应用程序。

从那时起，我们在 4 个主要的重载消费类 Web 应用程序中使用了 C3P0，并且从未回头。

**更新：**事实证明，经过多年的搁置，Apache Commons 的人们已经让[DBCP 摆脱了休眠状态](http://commons.apache.org/dbcp/)，现在它再次成为一个积极开发的项目。因此，我的原始帖子可能已过时。

话虽如此，我还没有体验过这个新升级的库的性能，也没有听说它在任何最近的应用程序框架中都是事实上的。

* * *

## 回答 #2

> 赞同：180
> 
> 时间：2009-11-02T18:42:18.910

我邀请您试用[BoneCP——](http://www.jolbox.com/)它是免费的、开源的，并且比可用的替代品更快（参见基准部分）。

免责声明：我是作者，所以你可以说我有偏见:-)

更新：截至 2010 年 3 月，仍比新重写的 Apache DBCP（“tomcat jdbc”）池快约 35%。请参阅基准部分中的动态基准链接。

更新 #2：（2013 年 12 月）在 4 年的顶峰之后，现在有一个更快的竞争对手：[https ://github.com/brettwooldridge/HikariCP](https://github.com/brettwooldridge/HikariCP)

更新 #3：（2014 年 9 月）请考虑此时**已弃用**BoneCP ，建议切换到[**HikariCP**](http://brettwooldridge.github.io/HikariCP/)。

更新 #4：（2015 年 4 月）——我不再拥有域名 jolbox.com

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2010-12-14T22:44:53.117

当连接超时时，我遇到了 DBCP 问题，所以我试用了 c3p0。我打算将其发布到生产环境中，但随后开始了性能测试。我发现 c3p0 的表现非常糟糕。我根本无法将其配置为表现良好。我发现它的速度是 DBCP 的两倍。

然后我尝试了[Tomcat 连接池](http://tomcat.apache.org/tomcat-7.0-doc/jdbc-pool.html)。

这比 c3p0 快两倍，并解决了我在使用 DBCP 时遇到的其他问题。我花了很多时间调查和测试这 3 个池。如果您要部署到 Tomcat，我的建议是使用新的 Tomcat JDBC 池。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-04-26T03:03:52.863

对于 DBCP 的自动重新连接问题，是否尝试过使用以下 2 个配置参数？

```
validationQuery="Some Query"

testOnBorrow=true 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2016-04-01T04:41:51.730

另一种选择是[HikariCP](https://github.com/brettwooldridge/HikariCP)。

这是比较[基准](https://github.com/brettwooldridge/HikariCP-benchmark)

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2011-12-18T17:05:24.797

几年来一直在生产中使用 DBCP。它很稳定，可以在数据库服务器重新启动后继续存在。只需正确配置即可。它只需要指定几个参数，所以不要偷懒。这是我们系统生产代码的一个片段，其中列出了我们明确设置以使其工作的参数：

```
DriverAdapterCPDS driverAdapterCPDS = new DriverAdapterCPDS();
driverAdapterCPDS.setUrl(dataSourceProperties.getProperty("url"));
driverAdapterCPDS.setUser(dataSourceProperties.getProperty("username"));
driverAdapterCPDS.setPassword(dataSourceProperties.getProperty("password"));
driverAdapterCPDS.setDriver(dataSourceProperties.getProperty("driverClass"));

driverAdapterCPDS.setMaxActive(Integer.valueOf(dataSourceProperties.getProperty("maxActive")));
driverAdapterCPDS.setMaxIdle(Integer.valueOf(dataSourceProperties.getProperty("maxIdle")));
driverAdapterCPDS.setPoolPreparedStatements(Boolean.valueOf(dataSourceProperties.getProperty("poolPreparedStatements")));

SharedPoolDataSource poolDataSource = new SharedPoolDataSource();
poolDataSource.setConnectionPoolDataSource(driverAdapterCPDS);
poolDataSource.setMaxWait(Integer.valueOf(dataSourceProperties.getProperty("maxWait")));
poolDataSource.setDefaultTransactionIsolation(Integer.valueOf(dataSourceProperties.getProperty("defaultTransactionIsolation")));
poolDataSource.setDefaultReadOnly(Boolean.valueOf(dataSourceProperties.getProperty("defaultReadOnly")));
poolDataSource.setTestOnBorrow(Boolean.valueOf(dataSourceProperties.getProperty("testOnBorrow")));
poolDataSource.setValidationQuery("SELECT 0"); 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2010-01-07T03:11:39.413

这里有一些文章表明 DBCP 的性能明显高于 C3P0 或 Proxool。此外，根据我自己的经验，c3p0 确实有一些不错的功能，例如准备好的语句池，并且比 DBCP 更易于配置，但在我使用过的任何环境中，DBCP 显然都更快。

dbcp 和 c3p0 的区别？绝对没有！（Sakai 开发者博客） ~~[http://blogs.nyu.edu/blogs/nrm216/sakaidelic/2007/12/difference_between_dbcp_and_c3.html](http://blogs.nyu.edu/blogs/nrm216/sakaidelic/2007/12/difference_between_dbcp_and_c3.html)~~

另请参阅博客文章评论中对 JavaTech 文章“Connection Pool Showdown”的赞。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2009-02-06T15:18:26.680

[本文](http://www.informit.com/articles/article.aspx?p=353736&seqNum=4)提到了另一种替代方案 Proxool 。

您可能会发现为什么 Hibernate 将 c3p0 捆绑为其默认连接池实现？

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2009-09-01T17:06:40.250

不幸的是，它们都已经过时了。DBCP 最近更新了一点，另外两个是 2-3 岁，有很多突出的 bug。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2011-05-11T21:04:19.067

如果配置正确，则 Dbcp 可用于生产。

例如，它用于一个每天有 350000 名访问者和 200 个连接池的商业网站。

如果您正确配置它，它可以很好地处理超时。

版本 2 正在进行中，它的背景使其可靠，因为已经解决了许多生产问题。

我们将它用于我们的批处理服务器解决方案，它已经运行了数百个批处理，这些批处理在数据库中的数百万行上工作。

由tomcat jdbc pool 运行的性能测试表明它比cp30 具有更好的性能。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2010-08-14T02:01:50.167

刚刚用 DBCP 浪费了一天半的时间。[即使我使用的是最新的 DBCP 版本，我也遇到了与j pimmel](https://stackoverflow.com/a/520868/446591)完全相同的问题。我根本不推荐 DBCP，尤其是当 DB 消失时它会从池中抛出连接，当 DB 回来时它无法重新连接，并且它无法动态地将连接对象添加回池中（它永远挂在一个 post JDBCconnect I/O 套接字读取）

我现在正在切换到 C3P0。我在以前的项目中使用过它，它的工作和表现就像一个魅力。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2011-07-15T11:49:01.017

当我们使用多线程项目时，c3p0 很好。在我们的项目中，我们使用 DBCP 同时使用多个线程执行，然后如果我们使用更多线程执行，我们就会出现连接超时。所以我们选择了 c3p0 配置。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2010-08-20T22:38:08.470

一个易于使用的好选择是[DBPool](http://www.snaq.net/java/DBPool/)。

“一个基于 Java 的数据库连接池实用程序，支持基于时间的到期、语句缓存、连接验证以及使用池管理器的简单配置。”

[http://www.snaq.net/java/DBPool/](http://www.snaq.net/java/DBPool/)

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2018-02-13T05:21:38.023

我们遇到了需要引入连接池的情况，我们面前有 4 个选项。

*   DBCP2
*   C3P0
*   雄猫 JDBC
*   光CP

我们根据我们的标准进行了一些测试和比较，并决定选择 HikariCP。阅读[这篇文章](https://beansroasted.wordpress.com/2017/07/29/connection-pool-analysis/)，了解我们选择 HikariCP 的原因。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2019-02-02T04:38:33.327

我的建议是

**光 > 德鲁伊 > UCP > c3p0 > DBCP**

它基于我测试过的内容 - 20190202，在我的本地测试环境中（docker/pool minSize=1，maxSize=8 中的 4GB mac/mysql），hikari 可以服务 1024 个线程 x 1024 次获得连接，每个线程的平均时间完成是 1 或 200 万秒，而 c3p0 只能服务 256 个线程 x 1024 次，每个线程的平均时间已经是 2100 万秒。（512 个线程失败）。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2018-08-14T09:02:23.620

要以最佳方式实施 C3P0，[请检查此答案](https://stackoverflow.com/a/51838455/3073945)

**C3P0**：

对于企业应用，C3P0 是最好的方法。C3P0 是一个易于使用的库，用于使用 JNDI 可绑定数据源（包括实现连接和语句池的数据源）增强传统（基于 DriverManager）的 JDBC 驱动程序，如 jdbc3 规范和 jdbc2 std 扩展所述。C3P0 还可以在恢复时稳健地处理 DB 断开连接和透明重新连接，而如果从其下方取出链接，则 DBCP 永远不会恢复连接。

所以这就是 c3p0 和其他连接池也有准备好的语句缓存的原因——它允许应用程序代码避免处理所有这些。语句通常保存在一些有限的 LRU 池中，因此常见的语句重用 PreparedStatement 实例。

更糟糕的是，DBCP 将连接对象返回给底层传输已中断的应用程序。c3p0 的一个常见用例是替换 Apache Tomcat 中包含的标准 DBCP 连接池。程序员经常会遇到连接在 DBCP 连接池中没有正确回收的情况，而 c3p0 在这种情况下是一个有价值的替代品。

在当前更新中，C3P0 具有一些出色的功能。这些在下面给出：

```
ComboPooledDataSource dataSource = new ComboPooledDataSource();
dataSource.setMinPoolSize();
dataSource.setMaxPoolSize();
dataSource.setMaxIdleTime();
dataSource.setMaxStatements();
dataSource.setMaxStatementsPerConnection();
dataSource.setMaxIdleTimeExcessConnections(); 
```

在这里，max 和 min **poolsize**定义了连接范围，这意味着该应用程序将采用的最小和最大连接。`MaxIdleTime()`定义何时释放空闲连接。

**数据库CP**：

这种方法也很好，但有一些缺点，如连接超时和连接释放。当我们使用多线程项目时，C3P0 很好。在我们的项目中，我们使用 DBCP 同时使用多个线程执行，然后如果我们使用更多线程执行，我们就会出现连接超时。所以我们选择了 c3p0 配置。我根本不会推荐 DBCP，尤其是当 DB 消失时它会从池中抛出连接，当 DB 回来时它无法重新连接，并且它无法动态地将连接对象添加回池中（它永远挂在一个 post JDBCconnect I/O 套接字读取）

谢谢 ：）

# tsql - T-SQL 2005：抑制结果集的输出

> ID：520590
> 
> 赞同：0
> 
> 时间：2009-02-06T14:58:56.220
> 
> 标签：tsql, redirect, resultset, suppress

我有一些用于生成报告的存储过程。我正在尝试构建一个报告仪表板，该仪表板将显示每个报告中有多少条记录。

SP 在表格中详细说明，其中详细说明了它们应按何种顺序运行。

我有一个仪表板 SP，我在其中使用 Cursor 遍历数据库表，执行每个报告 SP，然后将 @@rowcount 保存到构成仪表板基础的临时表中。

我可以使用每个 SP 顶部的 set rowcoun off 来关闭行计数，但是我找不到阻止从 EXEC sp_my_sp 命令返回的结果集的方法。

```
而@@FETCH_STATUS = 0
开始
    将 @x 声明为 int
    执行 @SP_name @x OUT
    选择@x
    插入@results (Short___name,Records) 值 (@shortname,@x)
    从 myCursor 获取下一个到 @ShortName、@SP_Name、@Group、@Order
结尾

```

在那里的某个地方我需要抑制或重定向输出。我不想在实际的报告 SP 中这样做。

到目前为止，我想出的唯一解决方案是向每个 SP 添加一个输入参数，以说明它是为仪表板运行还是为报表运行。与其直接返回结果集，不如将其插入内存表中，然后**仅**在我们运行报告时才报告内存表 - 不好，因为有人必须记住为每个新的 SP 都这样做

TIA

奥比龙

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-08T16:51:04.683

我可以想到一种可能的解决方案，但我不确定它是否特别优雅（或者您正在寻找什么）。

扩展 SP 的输入参数的概念，您能否仅添加一些逻辑（CASE 或 IF 语句）以在来自仪表板的脚本上调用 Select Count()？

它需要添加到每个 SP，但只要记录在案，就不会给未来的开发人员带来太多问题。

# asp.net - 如何清除 Windows Vista 上的 Visual Studio 缓存？

> ID：520593
> 
> 赞同：61
> 
> 时间：2009-02-06T14:59:40.557
> 
> 标签：asp.net, windows, visual-studio, windows-vista, clear-cache

我有一个问题，我的 ASP.NET 控件无法从文件背后的代码中引用。

我在 Stack Overflow question [ASP.NET controls cannot be referenced in code-behind in Visual Studio 2008 中](https://stackoverflow.com/questions/38670/asp-net-controls-cannot-be-referenced-in-code-behind-in-visual-studio-2008)找到了解决方案。

但我似乎找不到我的 Visual Studio 缓存来清除它。我在 Windows Vista 上使用 Visual Studio 2005。

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2009-02-06T15:20:33.930

接受的答案给出了两个位置：

> 这里
> 
> C:\Documents and Settings\Administrator\Local Settings\Temp\VWDWebCache
> 
> 可能在这里
> 
> C:\Documents and Settings\Administrator\Local Settings\Application Data\Microsoft\WebsiteCache

你试过那些吗？

**编辑添加**

在我的 Windows Vista 机器上，它位于

```
%Temp%\VWDWebCache 
```

并且在

```
%LocalAppData%\Microsoft\WebsiteCache 
```

根据您的附加信息（关于团队版本），这来自[Clear Client TFS Cache](http://blogs.msdn.com/technet/archive/2008/05/15/clear-client-tfs-cache.aspx)：

> 清除客户端 TFS 缓存
> 
> Visual Studio 和 Team Explorer 提供了一种可能不同步的缓存机制。如果我有可以从单个 Visual Studio 客户端连接到的单个 TFS 的多个实例，则该客户端可能会变得混乱。
> 
> 要解决它..
> 
> 对于 Windows Vista 删除此文件夹的内容
> 
> %LocalAppData%\Microsoft\Team Foundation\1.0\Cache

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2015-01-12T15:02:16.870

我今天经历了这个。Config 中的值是更新后的值，但应用程序将返回旧值，停止并启动解决方案什么也没做。

所以我清除了 .Net Temp 文件夹。

```
C:\Windows\Microsoft.NET\Framework\v4.0.30319\Temporary ASP.NET Files 
```

它不应该产生错误，但为了安全起见，首先关闭您的解决方案。清除临时 ASP.NET 文件，然后加载您的解决方案。

我的问题已经解决了。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-01-22T12:33:52.333

我遇到了同样的问题，但是当我从 Temp 文件夹中删除缓存的项目时，构建失败了。

为了使构建再次工作，我不得不关闭项目并重新打开它。

# java - 在重负载数据库的查询中使用子选择应该考虑什么？

> ID：520595
> 
> 赞同：1
> 
> 时间：2009-02-06T15:00:09.433
> 
> 标签：java, database, orm, openjpa, subquery

我们正在开发一个使用 OpenJPA1.1 和一个 Oracle DB 作为后端存储的持久层应用程序。我将使用带有子选择的查询（请参阅我在[解决 JPA 查询中查找连接列表中的最后一个条目的](https://stackoverflow.com/questions/442488/solving-jpa-query-finding-the-last-entry-in-connected-list)问题）。

现在我的同事说，这样的查询可能会导致性能问题，因为数据库充满了数千个并发用户使用的数千个客户日期（这将在生产中成为现实）。

所以，我的问题是：在这种情况下，在查询中是否有**“最佳实践”**`subselects`？这样做必须考虑什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-06T15:33:07.930

我会首先证明这是一个问题。您将希望使用虚拟数据加载数据库，并查看随着数据库变大时查询的执行情况。否则你会花时间优化一些可能不是问题的东西。

需要考虑的一件事。在我工作过的所有地方，崩溃的不是数千条记录，而是数百万条记录。你已经有了这个系统，它可以正常工作一段时间，然后开始变慢，即使你向它投入更多的硬件。我现在工作的地方在他的历史记录表中有大约 7000 万条记录可以追溯到 1998 年。因此，某些查询的性能很糟糕，他们花费了大量时间来解决这些问题。

但在某些时候，你真的必须要问。我们是否需要在交易系统中保留超过 4 年的数据？甚至4个月大？此时间限制取决于您的业务需求，但如果您的事务系统仅包含处理正在进行的工作所需的数据......并将您的历史记录归档到数据仓库中。您将提高整体性能，因为您可能只是偶尔需要查询旧数据，那么为什么要保留最近的数据呢？

如果您事先考虑到这一点，从长远来看，您将省去很多麻烦。

# sql - Sql 2005 备份和架构更改交互

> ID：520597
> 
> 赞同：1
> 
> 时间：2009-02-06T15:01:21.207
> 
> 标签：sql, sql-server-2005, schema, backup

我不清楚数据库架构更改和 sql 2005 上的差异备份之间的交互。

假设我现在进行完整备份。然后我执行一些架构更改。然后我做一个差异备份。

发生什么了？我需要创建另一个完整备份吗？我的架构更改以及这些新架构位中的任何数据是否包含在我的差异备份中？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-06T16:34:10.193

是的，你是对的。

自上次完整数据库备份以来数据库（即驻留在数据库中的任何对象）内的所有更改，无论是结构更改还是数据修改，都将由您执行的任何后续差异备份记录。

我希望这可以为您解决问题，但请随时提出进一步的问题。

干杯，约翰

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-06T22:12:34.363

是的，对表的所有更改都将保存在差异备份中。这包括针对数据库执行的所有 DDL 代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-08T14:49:51.697

如前所述，非完整备份（LOG 或 DIFF）包括所有模式更改。

请记住：用户表、列、存储的过程定义、索引、整个 shebang 都存储在数据页中存在于磁盘上的表中，就像您的数据一样......

# c++ - 建议阅读有关重构的书？

> ID：520599
> 
> 赞同：2
> 
> 时间：2009-02-06T15:02:31.923
> 
> 标签：c++, refactoring

C++ 开发人员是否容易阅读[重构：改进现有代码的设计](https://rads.stackoverflow.com/amzn/click/com/0201485672)

还有其他关于重构的书我应该读吗？随意添加任何关于重构的文章。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-06T15:09:31.363

如果您使用遗留代码，那么可能值得[阅读 Michael Feathers 的《有效地使用遗留代码》](https://rads.stackoverflow.com/amzn/click/com/0131177052)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-06T15:07:23.943

据我所知，没有关于重构的书，其中包含 C++ 中的示例。主要是Java，有时是C#。但是基本概念是一样的——所以我看不出语言混合的问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-06T15:09:58.693

是的，重构对于 C++ 开发人员来说是一本容易阅读的书。代码示例是用 Java 编写的，但 Fowler 在书中没有做任何专门针对该语言的事情。他不使用 Java 的反射 API 或构建企业应用程序。:)

这些示例都是非常简单的数据类，具有一些职责。你应该很容易理解发生了什么。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-10T04:54:47.767

我是[Refactoring to Patterns](https://rads.stackoverflow.com/amzn/click/com/0321213351)的作者。我最近完成了关于重构的多媒体专辑的工作（使用 C++、Java，很快还会使用 C#）。

你可以在[这里查看这张专辑的样本：](https://elearning.industriallogic.com/gh/submit?Action=AlbumContentsAction&album=foundations&devLanguage=Cpp)

另外，如果你想擅长识别什么样的代码需要重构，你也可以考虑研究一下我在 Code Smells 上的专辑。 [看](https://elearning.industriallogic.com/gh/submit?Action=BrowseAlbumsAction)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-06T15:06:21.433

阅读[Martin Fowler 的《重构](https://rads.stackoverflow.com/amzn/click/com/0201485672)》一书。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-06T15:06:36.360

简单的？也许是，也许不是。事实上，这本书应该适用于 C++，因为它定义的原则可以转移到类 java 语言（C#、C++）。这绝对是推荐阅读。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-06T15:09:19.303

Joshua Kerievsky[重构模式](https://rads.stackoverflow.com/amzn/click/com/0321213351)

书中使用的语言不应该重要，重要的是概念。本书是一种实用的重构方法。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-06T15:10:47.803

我是一名“C++ 开发人员”，我发现它既简单又有趣，而且我在理解这些示例时也毫不费力。

# ant - 具有不同 basedir 的 Ant 副本

> ID：520607
> 
> 赞同：2
> 
> 时间：2009-02-06T15:04:59.703
> 
> 标签：ant

给定目录结构：

```
root
    build.xml
    folderA
        file1
        file2
    folderB
        file3 
```

我正在尝试将文件夹A中的文件复制到文件夹B中，当我尝试时，它最终将文件夹A放在文件夹B中，所以我最终得到：

```
folderB
    folderA
        file1
        file2
    file3 
```

我只想用相同的结构复制文件，所以我最终得到：

```
folderB
    file1
    file2
    file3 
```

我的 Ant 任务如下所示：

```
<copy todir="folderB">
    <fileset dir="folderA">
        <include name="file*" />
    </fileset>
</copy> 
```

有什么提示吗？

**编辑：**我不能使用 flatten，因为 folderA 下有一个目录结构需要保留。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-06T15:20:50.763

```
<copy todir="folderB">
    <fileset dir="folderA/">
        <include name="file*" />
    </fileset>
</copy> 
```

这行得通。*请注意dir="folderA/"*中的尾部斜杠。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T15:30:53.410

如果要在复制后维护文件夹结构，您实际上非常接近，只需先创建目录即可。

```
<target name="copy">
    <mkdir dir="folderB/folderA"/>
    <copy todir="folderB/folderA">
        <fileset dir="folderA"/>
    </copy>
</target> 
```

# mysql - 经典数据库插入问题

> ID：520610
> 
> 赞同：1
> 
> 时间：2009-02-06T15:06:51.290
> 
> 标签：mysql, concurrency, insert

我有一个 SQL 数据库，用于存储一些信息，每条记录都有一个由数据库生成的唯一 ID。我的程序是用闪存编写的并在网络上运行，程序运行良好，它将记录插入数据库并提取最后一条记录的 idnumber 并将其显示给用户，我的问题是我如何处理多个并发条目，因为程序将被多个用户使用，并且可能会有并发插入到数据库中，所以我如何能够为用户识别正确的唯一 ID 号

这是插入数据库的代码

```
$query = "INSERT into $tablename (grade,school,country) VALUES ('$datarray[0]','$datarray[1]','$datarray[2]')";
$result = mysql_query($query) 
        or die("no rows selected"); 
```

然后我在我的Flash文件的第二个加载另一个php文件以提取该记录的ID并在此处显示它是代码

```
$query = "SELECT max(id) from $tablename";
$result = mysql_query($query) 
        or die("no rows selected");
$row = mysql_fetch_array($result); // extracts one row
echo  "id=$row[0]"; 
```

我需要做什么才能获得该记录的正确 ID？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-06T15:27:26.337

PHP必须[`mysql_insert_id()`](http://us3.php.net/manual/en/function.mysql-insert-id.php)返回

> 前一个 INSERT 查询成功时为列生成的 ID `AUTO_INCREMENT` ，如果前一个查询没有生成`AUTO_INCREMENT`值，或者`FALSE`没有建立 MySQL 连接，则为 0。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-06T15:26:18.647

大多数数据库都支持 UUID/GUID 键。使用您的后端（甚至是 ActionScript）生成它并在数据库中使用它。它不是自然键，但即使在服务器场中也非常适合唯一性。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-06T15:11:52.623

您可以在同一事务中执行插入和以下选择操作。您还可以根据您的数据库访问设施。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-06T15:11:25.790

如果您的数据库代码返回最后插入的行的 Id，这肯定会导致问题。

如果您使用的是 SQL 服务器，则可以使用：

`SELECT SCOPE_IDENTITY()`

选择回正确的 ID。[有关MSDN 文章](http://msdn.microsoft.com/en-us/library/ms190315.aspx)的更多信息。

如果您提供有关如何进行数据库插入以及您使用的技术的更多信息，将会很有帮助

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-06T15:12:01.110

您需要一种原子方式来获取插入的唯一 ID。经典方法是使用数据库序列，在其中查询数据库以获取下一个唯一编号，然后在插入时使用该编号作为主键，或者（如果您使用在插入时生成唯一编号的 MySQL）组合插入并选择一个原子语句。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-06T15:12:02.560

这在某种程度上取决于您使用的数据库。

例如，在 SQL Server 中，您有几个选项。您可以使用 SCOPE_IDENTITY() 检索在当前范围内创建的最后一个身份值。

例如：选择@NEWID = SCOPE_IDENTITY()

本文提供了一些 SQL Server 示例：

[http://databases.aspfaq.com/general/how-do-i-get-the-identity/autonumber-value-for-the-row-i-inserted.html](http://databases.aspfaq.com/general/how-do-i-get-the-identity/autonumber-value-for-the-row-i-inserted.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-06T15:12:12.090

使用交易——我个人不会在闪存中写它（但这是我个人的意见）。不幸的是，我没有在 Flash 中做过这样的事情——所以我不知道该语言是否支持事务——你可以做的是在数据库上使用事务。我的意思是对于您建立的每个连接-您打开一个事务并且在该事务中只有一个用户-因此您可以显示正确的ID-但是如果您使用自动递增的数字作为ID，您将仍然拥有相同的ID问题 - 因为事务可以并发运行。我希望这个能有一点帮助 ;）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-06T16:01:46.173

请务必将 INSERT 和 SELECT 语句放入插入数据并返回 ID的**单个查询中。**

重要的是不要使用两个单独的查询来检索 ID，因为一旦第一次插入完成，另一个用户可以（**并且最终会**）在您有机会获得第一个 ID 之前插入另一条记录。

如果您使用单独的事务，您*最终*将遇到以下情况：

```
User1 : Inserts a record (id = 123)
User2 : Inserts a record (id = 124)
User1 : Requests max id (and gets back 124) <---- WRONG ID
User2 : Requests max id (and gets back 124) 
```

如上面的帖子中所述，检索插入的 ID 的确切语法是特定于数据库的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-06T16:36:04.403

首先，您使用的是 PHP 和 MySQL。ID 列通常应定义为：

```
id int( 4 ) UNSIGNED NOT NULL AUTO_INCREMENT,
-- Constraints
primary key (id) 
```

使用 id 作为名称是自我记录。一个 4 字节的整数可能有点过分，尤其是因为它是无符号的，但空间很便宜，而且你不太可能用完 id。

我还建议尽可能使用 InnoDB 引擎。外键和数据完整性是很棒的东西。

您的脚本应该执行 mysql_connect() ，这意味着每个用户都将获得自己的数据库连接，因为每个用户的会话都是该脚本的一个单独实例。插入后，您可以使用 mysql_insert_id() 如上一张海报指出的那样来获取为插入生成的 id。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-06T17:41:57.763

```
insert ....; select last_insert_id() 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2009-02-06T15:11:58.863

您可以将 ID 与用户相关联，以便表中的主键是复合的（生成的唯一 ID，用户 ID）。

# javascript - 如何使用类似于 PHP 的 preg_match_all() 的 JavaScript 中的正则表达式匹配多次出现？

> ID：520611
> 
> 赞同：161
> 
> 时间：2009-02-06T15:07:08.467
> 
> 标签：javascript, regex

我正在尝试解析由 key=value 对组成的 url 编码字符串，它们由`&`or分隔`&amp;`。

以下将仅匹配第一次出现，将键和值分解为单独的结果元素：

```
var result = mystring.match(/(?:&|&amp;)?([^=]+)=([^&]+)/) 
```

字符串 '1111342=Adam%20Franco&348572=Bob%20Jones' 的结果将是：

```
['1111342', 'Adam%20Franco'] 
```

使用全局标志 'g' 将匹配所有匹配项，但只返回完全匹配的子字符串，而不是分离的键和值：

```
var result = mystring.match(/(?:&|&amp;)?([^=]+)=([^&]+)/g) 
```

字符串 '1111342=Adam%20Franco&348572=Bob%20Jones' 的结果将是：

```
['1111342=Adam%20Franco', '&348572=Bob%20Jones'] 
```

虽然我可以单独拆分字符串`&`并拆分每个键/值对，但有没有办法使用 JavaScript 的正则表达式支持来匹配`/(?:&|&amp;)?([^=]+)=([^&]+)/`类似于 PHP`preg_match_all()`函数的模式的多次出现？

我的目标是通过某种方式获得子匹配分离的结果，例如：

```
[['1111342', '348572'], ['Adam%20Franco', 'Bob%20Jones']] 
```

或者

```
[['1111342', 'Adam%20Franco'], ['348572', 'Bob%20Jones']] 
```

* * *

## 回答 #1

> 赞同：165
> 
> 时间：2009-02-06T15:58:20.580

从评论中提升

> 2020 年评论：我们现在拥有 ，而不是使用正则表达式，[`URLSearchParams`](https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams)它为我们完成了所有这些，因此不再需要自定义代码，更不用说正则表达式了。
> 
> –[迈克“Pomax”卡默曼斯](https://stackoverflow.com/users/740553/mike-pomax-kamermans)

此处列出了浏览器支持[https://caniuse.com/#feat=urlsearchparams](https://caniuse.com/#feat=urlsearchparams)

* * *

我会建议一个替代正则表达式，使用子组来单独捕获参数的名称和值，并且[`re.exec()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/exec)：

```
function getUrlParams(url) {
  var re = /(?:\?|&(?:amp;)?)([^=&#]+)(?:=?([^&#]*))/g,
      match, params = {},
      decode = function (s) {return decodeURIComponent(s.replace(/\+/g, " "));};

  if (typeof url == "undefined") url = document.location.href;

  while (match = re.exec(url)) {
    params[decode(match[1])] = decode(match[2]);
  }
  return params;
}

var result = getUrlParams("http://maps.google.de/maps?f=q&source=s_q&hl=de&geocode=&q=Frankfurt+am+Main&sll=50.106047,8.679886&sspn=0.370369,0.833588&ie=UTF8&ll=50.116616,8.680573&spn=0.35972,0.833588&z=11&iwloc=addr"); 
```

`result`是一个对象：

```
{
  f：“q”
  地理编码：“”
  hl：“德”
  即：“UTF8”
  iwloc：“地址”
  ll: "50.116616,8.680573"
  问：“美因河畔法兰克福”
  sll：“50.106047,8.679886”
  来源：“s_q”
  spn：“0.35972,0.833588”
  sspn：“0.370369,0.833588”
  z：“11”
}

```

正则表达式分解如下：

```
(?: # 非捕获组
  \?|& # "?" 或者 ”＆”
  (?:amp;)? # （允许“&”，用于错误的 HTML 编码 URL）
) # 结束非捕获组
( # 第一组
  [^=&#]+ # 除“=”、“&”或“#”之外的任何字符；至少一次
) # 结束组 1 - 这将是参数的名称
(?: # 非捕获组
  =？# 一个“=”，可选
  (#第二组
    [^&#]* # 除“&”或“#”外的任何字符；任意次数
  ) # 结束组 2 - 这将是参数的值
) # 结束非捕获组

```

* * *

## 回答 #2

> 赞同：67
> 
> 时间：2009-02-06T15:09:41.923

您需要使用“g”开关进行全局搜索

```
var result = mystring.match(/(&|&amp;)?([^=]+)=([^&]+)/g) 
```

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2014-02-11T19:23:35.437

**2020年编辑**

使用[URLSearchParams](https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams)，因为这项工作不再需要任何类型的自定义代码。浏览器可以使用单个构造函数为您执行此操作：

```
const str = "1111342=Adam%20Franco&348572=Bob%20Jones";
const data = new URLSearchParams(str);
for (pair of data) console.log(pair) 
```

产量

```
Array [ "1111342", "Adam Franco" ]
Array [ "348572", "Bob Jones" ] 
```

所以没有理由再使用正则表达式了。

**原始答案**

如果您不想依赖运行[`exec`](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/RegExp/exec)样式匹配附带的“盲匹配”，JavaScript 确实内置了 match-all 功能，但它是[`replace`](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String/replace)函数调用的一部分，当使用“如何处理捕获组”[处理功能](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String/replace#Specifying_a_function_as_a_parameter)：

```
var data = {};

var getKeyValue = function(fullPattern, group1, group2, group3) {
  data[group2] = group3;
};

mystring.replace(/(?:&|&amp;)?([^=]+)=([^&]+)/g, getKeyValue); 
```

完毕。

我们不使用捕获组处理函数来实际返回替换字符串（对于替换处理，第一个 arg 是完整的模式匹配，随后的 args 是单独的捕获组），我们只需获取组 2 和 3 捕获，并缓存该对。

因此，不要编写复杂的解析函数，记住 JavaScript 中的“matchAll”函数只是用替换处理函数“替换”，可以提高模式匹配效率。

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2012-01-16T08:21:27.920

对于捕获组，我习惯于`preg_match_all`在 PHP 中使用，并尝试在此处复制它的功能：

```
<script>

// Return all pattern matches with captured groups
RegExp.prototype.execAll = function(string) {
    var match = null;
    var matches = new Array();
    while (match = this.exec(string)) {
        var matchArray = [];
        for (i in match) {
            if (parseInt(i) == i) {
                matchArray.push(match[i]);
            }
        }
        matches.push(matchArray);
    }
    return matches;
}

// Example
var someTxt = 'abc123 def456 ghi890';
var results = /[a-z]+(\d+)/g.execAll(someTxt);

// Output
[["abc123", "123"],
 ["def456", "456"],
 ["ghi890", "890"]]

</script> 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2009-02-06T15:09:21.660

`g`为全局匹配设置修饰符：

```
/…/g 
```

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2016-02-09T10:10:18.237

来源：
[https ://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/exec](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/exec)

## 寻找连续匹配

如果您的正则表达式使用“g”标志，您可以多次使用 exec() 方法在同一字符串中查找连续匹配项。当您这样做时，搜索将从正则表达式的 lastIndex 属性指定的 str 的子字符串开始（test() 也将推进 lastIndex 属性）。例如，假设您有这个脚本：

```
var myRe = /ab*/g;
var str = 'abbcdefabh';
var myArray;
while ((myArray = myRe.exec(str)) !== null) {
  var msg = 'Found ' + myArray[0] + '. ';
  msg += 'Next match starts at ' + myRe.lastIndex;
  console.log(msg);
} 
```

此脚本显示以下文本：

```
Found abb. Next match starts at 3
Found ab. Next match starts at 912 
```

注意：不要将正则表达式文字（或 RegExp 构造函数）放在 while 条件中，否则如果由于 lastIndex 属性在每次迭代时被重置而存在匹配，它将创建一个无限循环。还要确保设置了全局标志，否则这里也会出现循环。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-12-16T14:45:52.163

如果有人（像我一样）需要支持数组的 Tomalak 方法（即多选），这里是：

```
function getUrlParams(url) {
  var re = /(?:\?|&(?:amp;)?)([^=&#]+)(?:=?([^&#]*))/g,
      match, params = {},
      decode = function (s) {return decodeURIComponent(s.replace(/\+/g, " "));};

  if (typeof url == "undefined") url = document.location.href;

  while (match = re.exec(url)) {
    if( params[decode(match[1])] ) {
        if( typeof params[decode(match[1])] != 'object' ) {
            params[decode(match[1])] = new Array( params[decode(match[1])], decode(match[2]) );
        } else {
            params[decode(match[1])].push(decode(match[2]));
        }
    }
    else
        params[decode(match[1])] = decode(match[2]);
  }
  return params;
}
var urlParams = getUrlParams(location.search); 
```

输入`?my=1&my=2&my=things`

结果`1,2,things`（之前只返回：事物）

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2020-05-16T14:33:55.313

您好，从 2020 年开始。让我将[String.prototype.matchAll()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/matchAll)提请您注意：

```
let regexp = /(?:&|&amp;)?([^=]+)=([^&]+)/g;
let str = '1111342=Adam%20Franco&348572=Bob%20Jones';

for (let match of str.matchAll(regexp)) {
    let [full, key, value] = match;
    console.log(key + ' => ' + value);
} 
```

输出：

```
1111342 => Adam%20Franco
348572 => Bob%20Jones 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-12-05T20:40:19.113

只是为了坚持标题所示的建议问题，您实际上可以使用`String.prototype.replace()`. 例如，以下内容就是为了获取基于正则表达式的所有单词的数组：

```
function getWords(str) {
  var arr = [];
  str.replace(/\w+/g, function(m) {
    arr.push(m);
  });
  return arr;
}

var words = getWords("Where in the world is Carmen Sandiego?");
// > ["Where", "in", "the", "world", "is", "Carmen", "Sandiego"] 
```

如果我想获得捕获组甚至每场比赛的索引，我也可以这样做。下面显示了每个匹配项如何与整个匹配项、第一个捕获组和索引一起返回：

```
function getWords(str) {
  var arr = [];
  str.replace(/\w+(?=(.*))/g, function(m, remaining, index) {
    arr.push({ match: m, remainder: remaining, index: index });
  });
  return arr;
}

var words = getWords("Where in the world is Carmen Sandiego?"); 
```

上面运行后，`words`会如下：

```
[
  {
    "match": "Where",
    "remainder": " in the world is Carmen Sandiego?",
    "index": 0
  },
  {
    "match": "in",
    "remainder": " the world is Carmen Sandiego?",
    "index": 6
  },
  {
    "match": "the",
    "remainder": " world is Carmen Sandiego?",
    "index": 9
  },
  {
    "match": "world",
    "remainder": " is Carmen Sandiego?",
    "index": 13
  },
  {
    "match": "is",
    "remainder": " Carmen Sandiego?",
    "index": 19
  },
  {
    "match": "Carmen",
    "remainder": " Sandiego?",
    "index": 22
  },
  {
    "match": "Sandiego",
    "remainder": "?",
    "index": 29
  }
] 
```

为了匹配类似于 PHP 中可用的多次出现，[`preg_match_all`](http://php.net/manual/en/function.preg-match-all.php)您可以使用这种类型的思维来制作自己的或使用类似[`YourJS.matchAll()`](http://yourjs.com/snippets/65). YourJS 或多或少地定义了这个函数如下：

```
function matchAll(str, rgx) {
  var arr, extras, matches = [];
  str.replace(rgx.global ? rgx : new RegExp(rgx.source, (rgx + '').replace(/[\s\S]+\//g , 'g')), function() {
    matches.push(arr = [].slice.call(arguments));
    extras = arr.splice(-2);
    arr.index = extras[0];
    arr.input = extras[1];
  });
  return matches[0] ? matches : null;
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2016-11-08T15:45:16.427

如果您可以使用`map`这是一个四行解决方案：

```
var mystring = '1111342=Adam%20Franco&348572=Bob%20Jones';

var result = mystring.match(/(&|&amp;)?([^=]+)=([^&]+)/g) || [];
result = result.map(function(i) {
  return i.match(/(&|&amp;)?([^=]+)=([^&]+)/);
});

console.log(result);
```

不漂亮，效率不高，但至少它是紧凑的。;)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2017-06-21T06:45:28.113

使用`window.URL`：

```
> s = 'http://www.example.com/index.html?1111342=Adam%20Franco&348572=Bob%20Jones'
> u = new URL(s)
> Array.from(u.searchParams.entries())
[["1111342", "Adam Franco"], ["348572", "Bob Jones"]] 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-06-07T15:03:50.797

嗯......我有一个类似的问题......我想要使用 RegExp 进行增量/步进搜索（例如：开始搜索......做一些处理......继续搜索直到最后一个匹配）

经过大量的互联网搜索......像往常一样（现在这已经成为一种习惯）我最终在 StackOverflow 中找到了答案......

什么没有提到，重要的是“ `lastIndex`”我现在明白了为什么 RegExp 对象实现了“ `lastIndex`”属性

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-06-14T10:11:47.270

为了使用相同的名称捕获多个参数，我修改了 Tomalak 方法中的 while 循环，如下所示：

```
 while (match = re.exec(url)) {
    var pName = decode(match[1]);
    var pValue = decode(match[2]);
    params[pName] ? params[pName].push(pValue) : params[pName] = [pValue];
  } 
```

输入：`?firstname=george&lastname=bush&firstname=bill&lastname=clinton`

返回：`{firstname : ["george", "bill"], lastname : ["bush", "clinton"]}`

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-10-29T23:53:45.790

拆分它对我来说似乎是最好的选择：

```
'1111342=Adam%20Franco&348572=Bob%20Jones'.split('&').map(x => x.match(/(?:&|&amp;)?([^=]+)=([^&]+)/)) 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-08-08T09:43:13.413

为了避免正则表达式地狱，你可以找到你的第一个匹配，切掉一个块然后尝试在子字符串上找到下一个。在 C# 中，这看起来像这样，抱歉，我没有为您将它移植到 JavaScript。

```
 long count = 0;
        var remainder = data;
        Match match = null;
        do
        {
            match = _rgx.Match(remainder);
            if (match.Success)
            {
                count++;
                remainder = remainder.Substring(match.Index + 1, remainder.Length - (match.Index+1));
            }
        } while (match.Success);
        return count; 
```

# java - 使用 Jython 和 Swing 处理事件

> ID：520615
> 
> 赞同：8
> 
> 时间：2009-02-06T15:09:13.377
> 
> 标签：java, python, user-interface, swing, jython

我正在使用 Jython 的 Swing 制作一个 GUI。Jython 的事件处理似乎特别优雅，刚刚设置

```
JButton("Push me", actionPerformed = nameOfFunctionToCall) 
```

然而，在课堂上尝试同样的事情变得很困难。天真地尝试

```
JButton("Push me", actionPerformed = nameOfMethodToCall) 
```

或者

```
JButton("Push me", actionPerformed = nameOfMethodToCall(self)) 
```

从类的 GUI 构造方法不起作用，因为要调用的方法的第一个参数应该是*self*，以便访问类的数据成员，另一方面，不可能通过通过 AWT 事件队列传递给事件处理程序的任何参数。唯一的选择似乎是使用 lambda（如[http://www.javalobby.org/articles/jython/](http://www.javalobby.org/articles/jython/)所建议的那样），结果如下：

```
JButton("Push me", actionPerformed = lambda evt : ClassName.nameOfMethodToCall(self)) 
```

它有效，但优雅消失了。这一切只是因为被调用的方法需要从某个地方进行*自我*引用。有没有其他方法可以解决这个问题？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-07T08:35:51.017

```
JButton("Push me", actionPerformed=self.nameOfMethodToCall) 
```

这是您引用的文章中的修改示例：

```
from javax.swing import JButton, JFrame

class MyFrame(JFrame):
    def __init__(self):
        JFrame.__init__(self, "Hello Jython")
        button = JButton("Hello", actionPerformed=self.hello)
        self.add(button)

        self.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE)
        self.setSize(300, 300)
        self.show()

    def hello(self, event):
        print "Hello, world!"

if __name__=="__main__":
    MyFrame() 
```

# reporting-services - SQL Reporting Services 2005 - Active Directory 安全组访问

> ID：520619
> 
> 赞同：0
> 
> 时间：2009-02-06T15:09:29.180
> 
> 标签：reporting-services

有没有办法锁定 AD 组的 SSRS 报告的安全性？
我需要做到这一点，以便“A 组”可以访问，而“B 组”则不能。
到数据库的连接字符串需要保留一个 SQL Server 帐户。

有任何想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-06T15:17:59.443

好吧，我面前没有 SSRS，但 SSRS 的默认安全模型是集成 Windows 安全。因此，您基本上只需进入 SSRS 管理控制台（[http://server/reports](http://server/reports)站点）并将特定报告的安全性设置为仅 A 组（具有读取访问权限），其他人将无权访问它

# bit-manipulation - 您是否曾经在实际项目中不得不使用位移位？

> ID：520625
> 
> 赞同：83
> 
> 时间：2009-02-06T15:10:04.187
> 
> 标签：bit-manipulation, bit-shift

您是否曾经在实际的编程项目中不得不使用[位移位？](http://en.wikipedia.org/wiki/Bit_shift#Bit_shifts)大多数（如果不是全部）高级语言中都有移位运算符，但是你什么时候真正需要使用它们呢？

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2009-02-06T15:30:46.530

我仍然为硬件中不支持浮点的系统编写代码。在这些系统中，几乎所有算术都需要移位。

您还需要轮班来生成哈希。多项式算术（CRC、Reed-Solomon 码是主流应用程序）或也使用移位。

然而，使用轮班只是因为它们很方便并且准确地表达了作者的意图。如果你愿意，你可以用乘法来模拟所有的位移，但这会更难写，更难读，有时更慢。

编译器检测可以将乘法简化为移位的情况。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-02-06T15:31:39.167

是的，我已经用过很多次了。位旋转在位掩码非常常见的嵌入式硬件上很重要。当您需要最后一点性能时，它在游戏编程中也很重要。

**编辑：**另外，我经常使用它们来操作位图，例如更改颜色深度或转换 RGB <-> BGR。

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2009-02-06T15:13:35.707

*   为枚举创建漂亮的标志值（而不是手动输入 1、2、4...）
*   从位域中解包数据（许多网络协议使用它们）
*   Z 曲线遍历
*   [性能黑客](http://graphics.stanford.edu/~seander/bithacks.html)

我想不出很多使用它们的情况。它通常是另一种方式 - 存在一些特定问题，事实证明采用位操作将产生最佳结果（通常在性能方面 - 时间和/或空间）。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-02-06T15:12:46.600

我一直使用它们的一个地方是在为跨平台应用程序转置整数的字节顺序时。在对 2D 图形进行位图传输时，它们有时也会派上用场（与其他位操作运算符一起）。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-02-06T15:13:01.933

我已经使用过它们几次，但几乎总是用于解析二进制文件格式。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-02-06T15:21:44.880

位移很快。早在除法和模运算之前，它们就在 CPU 指令集中实现了。我们中的许多人都使用位移位进行算术，这在铅笔和纸上很简单，但在我们的 CPU 上不可用。

例如：

*   我在涉及将大型复合材料分解为其主要因素的项目中使用了位移。
*   我还使用位移来查找任意大整数的平方根和立方根。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-02-06T17:07:52.217

是的，仍然需要它。

例如，在我的工作中，我们开发了通过串行端口 COMx 与 PLC 通信的软件。需要处理一个字节内的位，我们每天使用左/右移位和逻辑运算符 OR、XOR、AND。

例如，假设我们需要打开一个**字节**的第 3 位（从右到左） ：

00001001 -> 00001101

这样做效率更高：

```
Byte B;

B := B OR 4; //100 
```

代替：

```
Byte B = 0;
String s;  // 0 based index

s = ConvertToBinary (B);
s[5] = "1";
B := ConvertToDecimal (s); 
```

问候。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-02-06T15:27:24.027

是的，我有。您可能会怀疑它最有可能出现在低级编程中，例如开发设备的驱动程序。但是，我在一个 C# 项目中工作，我必须开发一个从医疗设备接收数据的 Web 服务。设备存储的所有二进制数据都被编码为 SOAP 数据包，但二进制数据被压缩和编码。所以要解压缩它，你必须做很多很多的位操作。此外，您必须进行大量位移才能解析出任何有用的信息，例如设备序列号是第二个字节的下半部分或类似的东西。我还看到 .NET (C#) 世界中的一些人使用位掩码和标志属性，我个人从未有过这样做的冲动。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-02-06T18:17:17.427

当我用汇编语言编写代码时，我的代码充满了位移和掩码。

在 C 语言中也做了相当多的事情。

在 JavaScript 或服务器语言方面做得不多。

可能最好的现代用途是逐步遍历表示为 1 和 0 的布尔值的打包数组。我过去总是左移并检查汇编中的符号位，但在高级语言中，你会与一个值进行比较。

例如，如果您有 8 位，则使用“if (a>127) {...}”检查最高位。然后你左移（或乘以 2），用 127 做一个“与”（或者如果设置了最后一位，则减去 256），然后再做一次。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-02-06T15:13:49.967

是的。我之前必须编写加密算法，并且肯定会使用它们。

当使用整数等来跟踪状态时，它们也很有用。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-02-06T15:13:58.110

我在图像压缩/解压缩中经常使用它们，其中位图中的位被压缩。使用[http://en.wikipedia.org/wiki/Huffman_coding](http://en.wikipedia.org/wiki/Huffman_coding)被压缩的东西由不同数量的比特组成（它们并非都是字节对齐的），因此在编码或解码它们时需要对它们进行位移.

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-02-06T15:14:52.273

例如，在 C、C++ 等语言上的加密方法实现中。二进制文件、压缩算法和逻辑列表操作——按位操作总是好的 =)

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-02-06T15:17:59.460

位移并不能解决高层次的编程问题，只是有时我们不得不解决低层次的问题，而且不用用 C 语言编写一个单独的库来做这件事很方便。那是它被使用最多的时候是我的猜测。

我亲自使用它来编写[EBCDIC](http://en.wikipedia.org/wiki/EBCDIC)字符集转换器的编码器。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2009-02-06T15:41:19.787

将数字从小端格式转换为大端格式时，反之亦然

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2009-02-07T04:49:17.963

我在一家计算机外围设备制造商工作。我几乎每天都遇到并且不得不实现使用位移的代码。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2009-04-10T14:18:32.393

移位在破译在线游戏的协议中被大量使用。这些协议旨在使用尽可能少的带宽，因此不是在 int32 中传输服务器上的玩家数量、名称等，而是将所有信息打包到尽可能少的字节中。如今，大多数人都使用宽带并不是真的有必要，但是当他们最初设计时，人们使用 56k 调制解调器进行游戏，所以每一点都很重要。

最突出的例子是 Valve 的多人游戏，尤其是 Counter-Strike、Counter-Strike Source。Quake3 协议也是相同的，但 Unreal 并没有那么苗条。

这是一个示例（.NET 1.1）

```
string data = Encoding.Default.GetString(receive);

if ( data != "" )
{
    // If first byte is 254 then we have multiple packets
    if ( (byte) data[0] == 254 )
    {
        // High order contains count, low order index
        packetCount = ((byte) data[8]) & 15; // indexed from 0
        packetIndex = ((byte) data[8]) >> 4;
        packetCount -= 1;

        packets[packetIndex] = data.Remove(0,9);
    }
    else
    {
        packets[0] = data;

    }
} 
```

当然，您是否将其视为一个真正的项目或只是一个爱好（在 C# 中）取决于您。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2009-02-06T15:16:03.347

[快速傅里叶变换——FFT](http://www.librow.com/articles/article-10)和它的 Cooley-Tukey 技术将需要使用位移操作。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2009-02-08T07:46:23.863

求两个大于或等于给定数的最近幂：

```
1 << (int)(ceil(log2(given))) 
```

需要在不支持任意纹理大小的硬件上进行纹理处理。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2009-04-10T15:16:31.550

另一个很常见的事情是在提取一个字节的高[半字节](http://en.wikipedia.org/wiki/Nibble)时进行 4 位移位，即

```
#define HIGH_NIBBLE(byte) (((byte) >> 4) & 0x0F)
#define LOW_NIBBLE(byte)  ( (byte)       & 0x0F) 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2009-02-06T15:17:56.293

是的，在 MPEG2-2 传输流解析器中使用它们。它更容易并且可读性更好。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2009-02-06T15:22:09.903

我不得不编写一个程序来解析 DVD 光盘上的 .ifo 文件。这些是解释光盘上有多少标题、章节、菜单等的文件。它们由各种大小和对齐方式的打包位组成。我怀疑许多二进制格式需要类似的位移。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2009-02-06T15:22:27.890

当多个标志用作属性参数时，我已经看到使用按位运算符。例如数字 4 = 1 0 0 表示设置了三个标志之一。这对公共 API 不利，但它可以在特殊情况下加快速度，因为检查位很快。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2009-02-06T15:24:35.653

如果没有左右滑动位的能力，我写过的每一个 bitblt-er 都无法完成。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2009-02-06T15:25:39.320

我在游戏中使用它们将一堆标志打包成一个字节/字符以保存到数据卡中。诸如存储可解锁状态等之类的东西。现在不是什么要求，但可以节省工作量。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2009-02-06T15:30:33.490

我在一个必须读取监视器的 EDID 数据的嵌入式系统项目中使用它。EDID 中的一些数据编码如下：

> 字节#3：
> 水平消隐——低8位
> 字节#4：
> 低半字节：水平消隐——高4位
> 高半字节：其他

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2009-02-06T18:06:34.877

是的，在 Java 和 C# 应用程序之间执行二进制通信时，一种是 big-endian 字节顺序，另一种是 little-endian（不一定按此顺序）。我创建了一个 InputStream 类，它可以读取具有不同字节顺序的数字，并且它使用字节移位来工作。

有时，当您想在长的 4 个字节中放置 4 个短裤时，会出现使用字节移位的情况。我想我很多年前就这样做了...

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2009-02-06T15:34:28.410

与“较低级别”设备、例如数字以太网 IO 盒或 PLC 通信时，也需要移位，这些设备通常将单个输入/输出值打包成字节。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2009-02-06T18:23:43.407

是的，移位一直用于低级嵌入式软件。它也可以用作执行极其快速的数学运算的魔术技巧，看看

[http://betterexplained.com/articles/understanding-quakes-fast-inverse-square-root/](http://betterexplained.com/articles/understanding-quakes-fast-inverse-square-root/)

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2009-02-06T20:11:56.167

是的，一直都是。就像这些用于将 3space 坐标与 32 位整数打包和解包的宏一样：

```
#define Top_Code(a, b, c)           ((((a) + x) << 20) | (((b) + y) << 10) | ((c) + z))                           
#define From_Top_Code(a, b, c, f)   (a = (((f) >>> 20) - x), b = ((((f) & 0xffc00) >>> 10) - y), c = (((f) & 0x3ff) - z)) 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2009-02-06T20:47:00.073

我曾经（很多很多年前）为一个使用 Excel Oper 结构创建 Excel 电子表格的项目编写了一个输出例程。这是一个二进制文件共振峰，需要大量的位旋转。以下链接提供了 Oper 结构[Safari Books](http://my.safaribooksonline.com/0321262506/ch19lev1sec4)的风格。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2009-02-07T12:57:33.267

我在 C# 中做了一些位移。该应用程序需要标准化语音音频输入，这需要在音频样本级别进行多项数学运算。

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2009-02-08T07:17:38.693

是的。特别是在使用硬件驱动程序的控制和状态字节的仿真器中。控制字节中的每一位都有特殊含义，状态字节中的每一位都有特殊含义。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2009-02-09T15:32:36.743

我在CRC计算中使用了它。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2009-04-10T14:32:08.773

当然。处理[亲和力掩码](http://msdn.microsoft.com/en-us/library/ms686223(VS.85).aspx)使用位移位。

例如，您可能希望将应用程序限制为使用不超过给定数量的处理器（为使用每个处理器赚钱） - 您将使用位移来计算关联掩码中的位？

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2009-04-10T15:25:30.967

我对新颖的加密结构做了一些工作，将序列化结构（以及对它们的后续更新）隐藏在同态加法器后面。很多哈希也依赖于位操作；在他们之间转移。

涉及大量位移和讨厌的大数运算；全部在 Java 中（诚然，这是一个参考/研究实现）。

还完成了压缩项目（特别是 GZIP impl），您需要非常频繁地打包位；无法想象没有 << 和 >>（或者 >>>，如果你在 Java 中的话）。

基本上，如果您正在使用加密或压缩，那么您很有可能需要在某一点或另一个点进行位移。

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2009-04-10T15:43:06.137

不久前，我在一个 Web 项目中使用了位移。这是一个电子商务应用程序，其中每个产品都有许多可配置的属性。用户可以选择他们想要的属性，UI 会更新以提供所选选项的定价和 SKU。

不是在数据存储中搜索与用户选项匹配的 SKU，而是每个选项组合对应一个特定的哈希，这实际上是一个使用位数学创建的数字。我为每个选项允许 4 位（16 种组合），最多 5 个选项，所以总共 20 位。为了从用户的选项中计算哈希值，我将遍历每个编号属性并添加到哈希值：

```
for(var i = 0; i < getSku.arguments.length; i++)
{
    index = getAttributeIndex(i, getSku.arguments[i]);
    hash += (index+1) << (4*i);
} 
```

这比遍历潜在的数百个 SKU 每次最多比较 5 个值要快得多。

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2009-04-10T15:50:20.457

不，我从来没有真正需要使用它们。我认为这些二进制操作对于高级语言来说有点过时了。正如有人所说，它总是可以用其他数学表达式来模拟，并且由于这些几乎从未使用过，它们可以构建在外部库中。ruby 或 python 中的位移对我来说听起来很奇怪，有点像混合高电平和低电平。

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2010-02-05T11:16:33.063

我在扑克手评估器中使用过它们。

扑克手表示为 64 位无符号整数，其中`1`每张牌对应一个位。通过移位和掩蔽的组合，您可以提出诸如“给我所有我手上至少有 3 张牌的等级”之类的问题。

它相当快，但我已经学会了更快的方法，其中手表示为字节数组。

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2010-03-04T22:00:28.123

大多数数据包仍然是位编码的。如果您使用任何类型的低级网络通信，您将不得不使用比特。

还分析包含声音和视频的数据包——我相信即使是 MP3 标签也会使用一些位。

最重要的是，不习惯位操作意味着您很可能会错过实现某些操作的更好方法。我的意思是，如果您要处理 50 亿个有序对象的存在，那么能够非常舒适地将它们全部放入 ram 以进行即时查找或每次都在文件中查找它之间的区别——在这样的任务中我会说，一个自称是软件工程师，在没有位操作的情况下实现它的人不胜任他的工作。

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2010-06-09T05:29:48.007

我用它来实现 UTF-8 和 UTF-32 之间的转换。

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2010-08-03T14:47:53.213

是的。

移位在嵌入式应用程序中非常有用，因为内存很紧，速度就是一切。

例如，您可以只使用加法和位移来执行相同的计算，而不是进行昂贵的乘法运算，这样可以节省大量时间：

```
c := 0
while b != 0
    if (b and 1) != 0
        c := c + a
    shift a left by one
    shift b right by one
return c 
```

* * *

## 回答 #42

> 赞同：0
> 
> 时间：2010-11-20T22:29:45.097

我正在计算机科学专业毕业，我已经使用了位移。

人们已经说过，它们可以很好地存储标志、处理哈希等。

我使用了一次按位运算将 1 个小整数（2 个字节）值和 2 个字符压缩到一个整数中。与我同事的项目相比，这为我节省了很多内存。

并且这些操作有时在算术上也非常快，例如，当您必须扩展 double 类型或使用函数来使用螳螂操作浮点数据时（请参阅浮点算术标准）。

# unit-testing - 为什么在 JMock 中使用 .proxy()？

> ID：520627
> 
> 赞同：0
> 
> 时间：2009-02-06T15:10:38.117
> 
> 标签：unit-testing, testing, junit, jmock

我正在尝试学习如何使用 JMock，但我对您使用 .proxy() 方法的用途感到有些困惑。我知道它在你的 Mock 类上被调用，但我不明白它的 puprose 是什么。

我没有任何运气找到关于它如何在谷歌上工作的很好的描述。

任何帮助深表感谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-06T15:29:02.993

如果您正在学习 jmock 使用 jmock2 并在此处遵循此作弊，则仅在 jmock1 中使用代理

[http://www.jmock.org/cheat-sheet.html](http://www.jmock.org/cheat-sheet.html)

如果您想阅读代理的作用，请查看此处的 jmock1 文档

[http://www.jmock.org/jmock1-getting-started.html](http://www.jmock.org/jmock1-getting-started.html)

希望这可以帮助

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T12:44:11.953

我强烈建议升级到 jMock2，我们不再支持 jMock 1

# .net - 检查是否从命令行安装了 .NET

> ID：520631
> 
> 赞同：8
> 
> 时间：2009-02-06T15:11:24.963
> 
> 标签：.net

Windows 中是否有类似于以下内容的内容可以让我知道是否从命令行安装了 .NET？

```
$ java -version
$ ruby --version
$ python --version 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-06T15:15:36.530

您使用的是什么操作系统和命令外壳？

从批处理文件使用 Windows

```
if EXIST %WINDIR%\Microsoft.Net\Framework\v1.0.3705\mscorlib.dll
if EXIST %WINDIR%\Microsoft.Net\Framework\v1.1.4322\mscorlib.dll
if EXIST %WINDIR%\Microsoft.Net\Framework\v2.0.50727\mscorlib.dll 
```

通过 PowerShell 使用 Windows

```
if (test-path (join-path $env:windir "Microsoft.Net\Framework\v2.0.50727\mscorlib.dll"))){ 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-10-07T12:39:45.190

您可以使用 clrver 命令检查安装了哪些 .net 框架。

# visual-studio-2008 - 有人知道 Scott Guthrie 使用的是什么 IDE 设置吗？

> ID：520635
> 
> 赞同：1
> 
> 时间：2009-02-06T15:12:00.483
> 
> 标签：visual-studio-2008, themes

我正在寻找修改我的字体和颜色以匹配 Scott Guthrie 所拥有的。他在哪里发过这个？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-06T15:25:31.160

实际上，他使用的设置被称为 ZenBurn，这是我们自己的 Atwood 先生在 Coding Horror 上展示的。配色方案可在此处获得：http: [//www.codinghorror.com/blog/files/exported-font-and-colors-zenburn.zip](http://www.codinghorror.com/blog/files/exported-font-and-colors-zenburn.zip)，恐怖帖子是： http: [//www.codinghorror.com/blog/ 2006/09/is-your-ide-hot-or-not.html](http://www.codinghorror.com/blog/archives/000682.html)截图是：

![来自 Coding Horror 的 Zenburn IDE 映像](https://i.stack.imgur.com/qKmOj.png)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-06T15:16:10.117

[我相信是这个。](http://blog.wekeroad.com/blog/textmate-theme-for-visual-studio-take-2/)

[![替代文字](https://i.stack.imgur.com/lFRCT.gif)](https://i.stack.imgur.com/lFRCT.gif)
[（来源：[wekeroad.com](http://blog.wekeroad.com/wp-content/uploads/2007/10/codefile.gif)）]

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-26T07:58:00.280

@GregD，我相信这是斯科特当前的方案，至少是您指定的方案。

[斯科特的配色方案](http://blog.wekeroad.com/2007/10/17/textmate-theme-for-visual-studio-take-2/)

我目前正在使用它，我真的很喜欢它！

# html - Google 在 HTML 中的阴影——它是如何工作的？

> ID：520638
> 
> 赞同：2
> 
> 时间：2009-02-06T15:12:05.960
> 
> 标签：html, css

最近 gmail在 html 中添加了一些[自定义按钮和菜单小部件。](http://gmailblog.blogspot.com/2009/02/new-ways-to-label-with-move-to-and-auto.html)[他们](http://stopdesign.com/archive/2009/02/04/recreating-the-button.html)已经知道按钮内的渐变效果如何在没有图像的情况下工作。

但是新菜单后面还有一个微妙的阴影，似乎没有使用图像。谷歌地图中还有很多疯狂的阴影效果。

有没有人知道这是如何工作的？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-06T15:16:58.353

不确定谷歌的确切实施，但这使用了类似/相同的技术：[http ://www.sixapart.com/pronet/articles/ydsf_-_robust_c.html](http://www.sixapart.com/pronet/articles/ydsf_-_robust_c.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-06T19:38:43.067

下拉菜单实际上是一个表格（太恐怖了！），阴影是它们自己的单元格（底部阴影是一个`<tr>`包含三个单元格的单元格，一个用于每个角，一个用于底部边缘）。这些单元格使用 CSS 设置样式以具有 PNG 背景。角落和底部边缘是此图像中的精灵：[icons_ns5.png](http://mail.google.com/mail/images/2/icons_ns5.png)，右侧是此图像中的精灵：[vimages7.png](http://mail.google.com/mail/images/2/5/chrome/vimages7.png)

因此，例如，右侧边缘在 CSS 中看起来像这样：

```
.rightShadowCell {
    background-color: transparent;
    background-image: url(http://mail.google.com/mail/images/2/5/chrome/vimages7.png);
    background-position-x: -12px;
    background-position-y: 0px;
    background-repeat: repeat-y;
} 
```

Safari 告诉我，右侧阴影单元格的计算样式实际上是：

```
-webkit-background-clip: border;
-webkit-background-origin: padding;
-webkit-user-select: none;
background-attachment: scroll;
background-color: transparent;
background-image: url(http://mail.google.com/mail/images/2/5/chrome/vimages7.png);
background-repeat: repeat-y;
display: table-cell;
font-family: arial;
height: 18px;
margin-bottom: 0px;
margin-left: 0px;
margin-right: 0px;
margin-top: 0px;
padding-bottom: 0px;
padding-left: 0px;
padding-right: 0px;
padding-top: 0px;
vertical-align: middle;
width: 3px; 
```

至于 IE 6，我还没有检查过，但是它们要么不显示阴影，要么使用[Drew McLellan 的 IE 6 中透明 PNG 的已知修复](http://24ways.org/2007/supersleight-transparent-png-in-ie6)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-06T15:15:38.950

[您可以使用CSS](http://www.webtoolkit.info/css-drop-shadow.html)、[半透明 PNG 图像](http://www.positioniseverything.net/articles/dropshadows.html)或更好的是，通过为您完成所有繁重工作的框架（例如带有适当插件的 jQuery）来做阴影。

# javascript - 谷歌的无图像按钮

> ID：520640
> 
> 赞同：90
> 
> 时间：2009-02-06T15:12:31.980
> 
> 标签：javascript, html, css, gmail, reverse-engineering

最近有几篇关于谷歌新的无图像按钮的文章：

*   [http://stopdesign.com/archive/2009/02/04/recreating-the-button.html](http://stopdesign.com/archive/2009/02/04/recreating-the-button.html)
*   [http://stopdesign.com/eg/buttons/3.0/code.html](http://stopdesign.com/eg/buttons/3.0/code.html)
*   [http://stopdesign.com/eg/buttons/3.1/code.html](http://stopdesign.com/eg/buttons/3.1/code.html)
*   [http://gmailblog.blogspot.com/2009/02/new-ways-to-label-with-move-to-and-auto.html](http://gmailblog.blogspot.com/2009/02/new-ways-to-label-with-move-to-and-auto.html)

我真的很喜欢这些新按钮在 Gmail 中的工作方式。如何在我的网站上使用这些或类似的按钮？是否有任何具有类似外观和感觉的开源项目？

如果我想使用 JQuery/XHTML/CSS 像这样滚动我自己的按钮包，我可以使用哪些元素？我最初的想法是：

1.  使用 css 改进外观的标准`<input type="button">`（设计文章主要讨论了 css/imges 所涉及的内容。）

2.  Jquery javascript 会弹出一个自定义对话框，该对话框植根于“onclick”事件上的按钮，其中包含`<a>`标签和用于过滤的搜索栏？该弹出窗口的表格布局是否合理？

我对网络上的东西进行逆向工程很糟糕，我可以使用哪些工具来帮助对这些按钮进行逆向工程？使用 Firefox 的 Web 开发人员工具栏，我看不到按钮弹出对话框中使用的 css 或 javascript（即使它已被缩小）。我可以使用什么浏览器工具或其他方法来查看它们并获得一些想法？

我不想窃取任何 Google 的 IP，只是想知道如何创建类似的按钮功能。

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2009-02-12T06:51:50.847

-- 编辑 -- 我没有看到原始帖子中的链接。对不起！将尝试重新编写以反映实际问题

StopDesign 在[这里](http://stopdesign.com/archive/2009/02/04/recreating-the-button.html)有一篇很棒的文章。**[编辑 20091107] 这些是作为[闭包库](http://code.google.com/closure/)的一部分发布的：请参阅[按钮演示](http://closure-library.googlecode.com/svn/trunk/closure/goog/demos/button.html)。**

基本上，他[展示](http://stopdesign.com/eg/buttons/3.0/code.html)的自定义按钮是使用简单的 CSS 创建的。

他最初使用9个表来获得效果：![9 表](https://stopdesign.com/img/archive/2009/02/9-cell.png)

但后来他在上下边框上使用了一个简单的1px左右边距来达到同样的效果。

梯度是通过使用三层来伪造的：![按钮渐变](https://stopdesign.com/img/archive/2009/02/bands-spec.png)

所有代码都可以在[Custom Buttons 3.1](http://stopdesign.com/eg/buttons/3.1/code.html)页面中找到。（虽然没有图像的渐变只在 Firefox 和 Safari 中有效）

## 分步说明

1 - 插入以下 CSS：

```
/* Start custom button CSS here
---------------------------------------- */
.btn {
  display:inline-block;
  background:none;
  margin:0;
  padding:3px 0;
  border-width:0;
  overflow:visible;
  font:100%/1.2 Arial,Sans-serif;
  text-decoration:none;
  color:#333;
  }
* html button.btn {
  padding-bottom:1px;
  }
/* Immediately below is a temporary hack to serve the 
   following margin values only to Gecko browsers
   Gecko browsers add an extra 3px of left/right 
   padding to button elements which can't be overriden.
   Thus, we use -3px of left/right margin to overcome this. */
html:not([lang*=""]) button.btn {
  margin:0 -3px;
  }
.btn span {
  background:#f9f9f9;
  z-index:1;
  margin:0;
  padding:3px 0;
  border-left:1px solid #ccc;
  border-right:1px solid #bbb;
  }
* html .btn span {
  padding-top:0;
  }
.btn span span {
  background:none;
  position:relative;
  padding:3px .4em;
  border-width:0;
  border-top:1px solid #ccc;
  border-bottom:1px solid #bbb;
  }
.btn b {
  background:#e3e3e3;
  position:absolute;
  z-index:2;
  bottom:0;
  left:0;
  width:100%;
  overflow:hidden;
  height:40%;
  border-top:3px solid #eee;
  }
* html .btn b {
  top:1px;
  }
.btn u {
  text-decoration:none;
  position:relative;
  z-index:3;
  }

/* pill classes only needed if using pill style buttons ( LEFT | CENTER | RIGHT ) */
button.pill-l span {
  border-right-width:0;
  }
button.pill-l span span {
  border-right:1px solid #ccc;
  }
button.pill-c span {
  border-right-style:none;
  border-left-color:#fff;
  }
button.pill-c span span {
  border-right:1px solid #ccc;
  }
button.pill-r span {
  border-left-color:#fff;
  }

/* only needed if implementing separate hover state for buttons */
.btn:hover span, .btn:hover span span {
  cursor:pointer;
  border-color:#9cf !important;
  color:#000;
  }

/* use if one button should be the 'primary' button */
.primary {
  font-weight:bold;
  color:#000;
  } 
```

2 - 使用以下方式之一调用它（更多可以在上面的链接中找到）

```
<a href="#" class="btn"><span><span><b>&nbsp;</b><u>button</u></span></span></a> 
```

或者

```
<button type="button" class="btn"><span><span><b>&nbsp;</b><u>button</u></span></span></button> 
```

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-02-10T20:27:47.190

据 Firebug 说，这是他们的“存档”按钮。

```
<div tabindex="0" act="7" class="goog-imageless-button goog-inline-block goog-imageless-button goog-imageless-button-collapse-right goog-imageless-button-primary" id="">
  <div class="goog-inline-block goog-imageless-button-outer-box">
    <div class="goog-inline-block goog-imageless-button-inner-box">
      <div class="goog-imageless-button-pos">
        <div class="goog-imageless-button-top-shadow"> </div>
        <div class="goog-imageless-button-content"><b>Archive</b></div>
      </div>
    </div>
  </div>
</div> 
```

CSS 不仅仅是我关心的组织/粘贴。也许只有我一个人，但是当标记/css变得如此沉重时，我想我更愿意**使用图像**（或几张图像作为背景。更好的是，精灵）。此外，此按钮的图像将小于单个 K。

尽管我很喜欢谷歌，但这似乎有点矫枉过正。

* * *

**更新：** 谷歌是一个独特的案例。如果您是一个大型网站，并且希望将您的内容国际化，那么这种无图像技术实际上非常酷。它允许您将几乎任何书面语言应用于您的 UI，而无需生成新图像，也无需担心破坏您的按钮。

请参阅问题：[使用无图像按钮有哪些优点？](https://stackoverflow.com/questions/539703/what-are-the-advantages-of-using-an-imageless-button)

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-02-10T20:11:46.447

无论您决定这样做，请确保首先使用默认值呈现页面：

```
<input type="submit" value="submit" /> 
```

...然后使用 jQuery 将输入元素与具有 onClick 事件的自定义按钮交换。这将确保没有启用 JavaScript 的人仍然能够使用您的网站。

可用性应该是第一位的！

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-02-19T19:33:01.760

你可以使用我开发的这个 jquery 插件。这些按钮几乎可以在任何地方工作，因为它是一个插件，所以它们很容易设置和配置。

[http://swizec.com/code/styledButton/](http://swizec.com/code/styledButton/)

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2011-07-18T15:27:46.090

**为 2011 年更新此帖子：**

Google 于 2011 年 7 月在其服务中推出了新设计。新的 Google 按钮已在此处重新创建：http: [//pixify.com/blog/use-google-plus-to-improve-your-ui /](http://pixify.com/blog/use-google-plus-to-improve-your-ui/)

新按钮如下所示： ![在此处输入图像描述](https://i.stack.imgur.com/LXlhS.png)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-02-06T15:15:59.977

您可以尝试使用 Firefox 的[Firebug](http://getfirebug.com/)插件来查看按钮上的 CSS。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-02-11T07:24:08.047

您将遇到的最大问题是让它跨浏览器工作。

我认为你应该认真考虑你是否真的需要它......谷歌通过制作这样的东西获得了很多收益，因为他们需要大量的按钮和语言；我怀疑大多数网站和应用程序在使用图像时也会很顺利。

不过，开源组件是个好主意：广泛传播财富和努力。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-13T12:53:02.730

这里的大部分工作可能不会是设计 - 这些帖子已经是关于渐变效果的优秀方法。

问题是让它在所有浏览器中都能正常工作，或者更具体地说是 IE6 和 IE7 的古怪垃圾堆。

我认为您使用 jQuery 重写的标准按钮走在正确的轨道上 - 这样您仍然可以被屏幕阅读器访问，并且可以在非常旧的浏览器中很好地降级。

对于 HTML，我认为您最好的选择是使用每个浏览器访问 Gmail，然后查看生成的 HTML - 我希望 IE6、IE7（也取决于它们是否需要 quirks-mode）和其他所有内容都完全不同.

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-11-07T22:32:48.153

这些是作为[闭包库](http://code.google.com/closure/)的一部分发布的：参见[按钮演示](http://closure-library.googlecode.com/svn/trunk/closure/goog/demos/button.html)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-06T16:23:09.967

[Web Developer Toolbar](https://addons.mozilla.org/en-US/firefox/addon/60)在css 菜单下有一个视图样式信息，它将告诉您将什么 css 应用于项目。该菜单中还有“编辑 CSS”功能，可让您动态更改 CSS 以查看它如何影响页面。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-12-30T07:38:25.090

带有闭包库链接的帖子不适用。作为闭包库的一部分发布的内容使用带有*渐变*的按钮。

列出的其他解决方案是无用的。你不能从那里开始让这些按钮在 Gmail 让它们工作的每个浏览器上工作。鲍曼在他的网站上展示的不是工作代码。

# dll - GAC和Bin dll之间的冲突

> ID：520642
> 
> 赞同：3
> 
> 时间：2009-02-06T15:12:52.730
> 
> 标签：dll, gac, conflict

我正在自定义一个 SharePoint 应用程序，并且在我的 Visual Studio 项目中引用了一个也存在于 GAC 中的 dll。该项目构建得很好，但是当我点击页面时，我收到以下错误：

处理过程中发生错误。c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files\root\bef9a111\5466e63c\App_Web_welcomelinks.aspx_-1775745042.a7euki4f.0.cs(128)：错误 CS0433：类型“Microsoft. SharePoint.Publishing.PublishingLayoutPage' 存在于 'c:\WINDOWS\assembly\GAC_MSIL\Microsoft.SharePoint.Publishing\12.0.0.0__71e9bce111e9429c\Microsoft.SharePoint.Publishing.dll' 和 'c:\WINDOWS\Microsoft.NET\Framework \v2.0.50727\Temporary ASP.NET Files\root\bef9a111\5466e63c\assembly\dl3\4f0b8d4e\c81e2802_6788c901\PPM.DLL'

关于如何解决这个冲突的任何想法？由于某些依赖关系，我无法从 GAC 卸载 dll，并且如果没有参考，我将无法构建我的项目。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-06T15:17:02.597

我会尝试停止 IIS，然后删除“C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files”文件夹中的所有内容，然后再次启动 IIS。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-06T15:23:11.507

您可以将引用的 Copy Local 属性设置为 false，以便 VS Studio 不会输出 dll 的副本。这样，CLR 只会命中 GAC 版本。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-07-08T18:12:32.070

显然 cLeaning 项目不会自动删除 Bin 文件夹中的文件。我疯了想弄清楚。所以如果上面的解决方案仍然不起作用，请尝试删除项目 bin 文件夹中的所有内容

# c# - jquery datepicker ms ajax updatepanel在回发后不起作用

> ID：520645
> 
> 赞同：14
> 
> 时间：2009-02-06T15:13:25.413
> 
> 标签：c#, jquery, asp.net-ajax, updatepanel

所以我做了一些相关问题的阅读并且有一些有趣的东西但没有找到我的答案，至少没有理解答案。

一般来说，我对 AJAX、javascript 和 sclient 端脚本非常陌生。

我一直在使用 C# asp.net 并且最近在我身边添加了一些更新面板以平滑用户控件和位正在更新，以便每次都不会重新加载页面。所有的工作都非常出色，我对此非常满意，直到我决定尝试使用一些 JQuery。

我从 ui.jquery.js 中选择了 datepicker，它很酷，在普通页面上效果很好。当我从更新面板中进行回发时，我的问题就出现了。日期选择器只是停止工作。

从我读过的内容来看，我需要在回帖后手动连接这个备份。

1）我真的不明白为什么。在我的母版页上，我有：

```
<script type="text/javascript">
    $(function() {
        $(".mydatepickerclass").datepicker({dateFormat: 'dd-mm-yy'});
    });
</script> 
```

它使用分配的 mydatepickerclass 拾取我的输入框。和所有的作品。为什么这会停止在回发上工作。

2）我该如何解决这个问题....我如何连接它以便在更新面板中回发后它仍然可以工作。

我知道 ID 可能会在回发时更改，但我认为，但由于我正在使用类，我不知道出了什么问题。

**编辑**

我在进行更新的用户控件中有以下代码：

```
<asp:UpdatePanel ID="HistoryUpdatePanel" runat="server">
<ContentTemplate>
    <%-- Start of Company History section --%>
    <fieldset>
        <legend>Activity History</legend>

           <script type="text/javascript">
              $(function() {
              $(".mydatepickerclass").datepicker({dateFormat: 'dd-mm-yy'});
              });
           </script>            

        <div>
            <asp:ListBox ID="listBoxHistoryTypes" runat="server" SelectionMode="Multiple" AutoPostBack="true" OnSelectedIndexChanged="listBoxHistoryTypes_IndexChanged" />
            <label>Date From:</label><asp:TextBox class="mydatepickerclass" ID="txtdatefrom" runat="server" />
            <label>Date To:</label><input class="mydatepickerclass" type="text" />
            <asp:TextBox class="mydatepickerclass" ID="txtdateto" runat="server" />
            <asp:Button ID="btnFilterSearch" runat="server" Text="Filter Results" OnClick="btnFilterSearch_Click" />
        </div>

    </fieldset>
</ContentTemplate> 
```

更新面板中的脚本不会重新连接它吗？

谢谢

乔恩·霍金斯

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-02-06T15:20:25.040

更新面板将重新加载 html 的内容。您必须收听 UpdatePanel 才能完成并重新创建日期选择器。

这是一个非常基本的示例。这没有考虑到页面上的多个更新面板或未正确销毁日期选择器导致的潜在内存泄漏。

混合 ASP.NET Ajax 和 jQuery 时要注意的另一件事是要小心，因为两者都在不同的上下文中使用 $

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title></title>
    <script type="text/javascript" src="http://jqueryjs.googlecode.com/files/jquery-1.3.1.js">
    </script>
    <script type="text/javascript">
        $(document).ready(function() {
            Sys.WebForms.PageRequestManager.getInstance().add_endRequest(EndRequestHandler);

            function EndRequestHandler(sender, args) {
                $('.mydatepickerclass').datepicker({ dateFormat: 'dd-mm-yy' });
            }

        });
    </script>   
</head>
<body>
    <form id="form1" runat="server">
    <div>

    </div>
    <asp:ScriptManager ID="ScriptManager1" runat="server">
    </asp:ScriptManager>
    <asp:UpdatePanel ID="UpdatePanel1" runat="server">
        <ContentTemplate>
            <asp:TextBox ID="TextBox1" runat="server" CssClass="mydatepickerclass"></asp:TextBox>
            <br />
            <asp:Button ID="Button1" runat="server" Text="UpdateMe" 
                onclick="Button1_Click" />
        </ContentTemplate>
    </asp:UpdatePanel>
    </form>
</body>
</html> 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2012-04-24T15:17:33.620

我知道这很旧，但是...尝试替换：

`$(document).ready(function() {`

和：

`Sys.WebForms.PageRequestManager.getInstance().add_pageLoaded(function () {`

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2013-05-21T07:00:09.893

除了这样做，还有一个简单的替代方案。

在更新面板中元素的回发中添加此代码

```
ScriptManager.RegisterStartupScript(Me, Me.GetType(), "asddas", "getjquerydate();",   True) 
```

这在javascript中

```
function getjquerydate() {

$(".datepicker").datepicker({
    numberOfMonths: 2,
    showButtonPanel: true,
    minDate: 1,
    dateFormat: 'dd/mm/yy',
    showOn: "button",
    buttonImage: "images/calendar.gif",
    buttonImageOnly: true
}); 
```

}

在更新的面板中进行部分回发后，它再次调用 datepicker 函数

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2013-07-02T21:55:22.720

```
$(document).ready(function () {
        Sys.WebForms.PageRequestManager.getInstance().add_endRequest(EndRequestHandler);
        Sys.WebForms.PageRequestManager.getInstance().beginAsyncPostBack();
        function EndRequestHandler(sender, args) {
            $('.mydatepickerclass').datepicker({ dateFormat: 'dd-mm-yy' });
        }
    }); 
```

你可以这样做。在这种情况下，它将始终有效；））

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-12-30T19:00:33.773

**“在 ajax 部分回发后，jQuery UI Datepicker 不起作用”**

在页面上放置一个脚本管理器和一个更新面板。

```
<asp:ScriptManager ID="ScriptManager1" runat="server"></asp:ScriptManager>
<asp:UpdatePanel ID="upd1" runat="server">
 <ContentTemplate>
 </ContentTemplate>
</asp:UpdatePanel> 
```

现在在 updatepanel 控件中放置一个文本框和一个按钮。

```
<asp:ScriptManager ID="ScriptManager1" runat="server"></asp:ScriptManager>
<asp:UpdatePanel ID="upd1" runat="server">
 <ContentTemplate>
     <div style="font-family: Arial; font-size: small;">
        Select Date :
        <asp:TextBox ID="txtDate" runat="server"Font- Names="Arial">           
        </asp:TextBox>
     </div>
     <asp:Button ID="btnAjax" runat="server" Text="Ajax PostBack"  
       OnClick="btnAjax_Click" />
  </ContentTemplate>
</asp:UpdatePanel> 
```

现在将 datepicker 控件与文本框绑定。

```
<script type="text/javascript" language="javascript">
$(document).ready(function(){     
    $("#<%=txtDate.ClientID %>").datepicker(
    {   changeMonth:true,
        changeYear:true,
        showOn: 'button',
        buttonText:'Show Date',
        showAnim: 'fadeIn',
        showButtonPanel: true,
        dateFormat: 'DD, MM d, yy',
        buttonImage: 'Images/imgCalendar.png',
        buttonImageOnly: true
     }
   );
   $(".ui-datepicker-trigger").mouseover(function() {
        $(this).css('cursor', 'pointer');
   });
}); 
<script> 
```

现在为将导致 ajax 部分回发的按钮创建服务器端单击。

```
protected void btnAjax_Click(object sender, EventArgs e)
{
   System.Threading.Thread.Sleep(1000);
} 
```

在运行页面时，您会看到类似这样的内容

[![阿贾克斯回传](https://i.stack.imgur.com/Uo4vl.png)](https://i.stack.imgur.com/Uo4vl.png)

点击日期选择器。日期选择器被打开，选定的日期成为文本框的值。现在点击按钮。服务器端按钮单击被调用，现在您将看到类似这样的内容。

[![AJAX 回传2](https://i.stack.imgur.com/QaKrh.png)](https://i.stack.imgur.com/QaKrh.png)

datepicker 按钮不见了。那么我们现在该怎么做才能使其在 ajax 中工作。请参见下面的代码。

```
<script type="text/javascript" language="javascript">
function pageLoad(sender, args)
{
  $(document).ready(function(){     
    $("#<%=txtDate.ClientID %>").datepicker(
    {   changeMonth:true,
        changeYear:true,
        showOn: 'button',
        buttonText:'Show Date',
        showAnim: 'fadeIn',
        showButtonPanel: true,
        dateFormat: 'DD, MM d, yy',
        buttonImage: 'Images/imgCalendar.png',
        buttonImageOnly: true
     }
   );
   $(".ui-datepicker-trigger").mouseover(function() {
        $(this).css('cursor', 'pointer');
   });
  }); 
}
</script> 
```

如果您使用的是 ASP.NET ajax，则在 JavaScript 中可以使用 pageLoad() 函数。AJAX 框架自动将任何名为 pageLoad() 的客户端函数连接为 Application.Load 处理程序

**源链接学分**

[http://www.jquerybyexample.net/2010/08/jquery-datepicker-does-not-work-after.html](http://www.jquerybyexample.net/2010/08/jquery-datepicker-does-not-work-after.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-06-17T17:10:19.133

当使用 asp:ScriptManager 和 Sys.WebForms.PageRequestManager 不起作用时，您可以尝试使用以下代码：

```
Sys.Application.add_load(LoadHandler);

//This load handler solved update panel did not bind date picker after partial postback 
function LoadHandler() {
    $(document).ready(function () {
        $(".datepicker").datepicker({
            dateFormat: "M d, yy",
            changeMonth: true,
            changeYear: true,
            onSelect: function (dateText, ubst) { 
               //your code here... 
            }
        }).val();
    });
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-07-31T03:07:19.630

我知道这是一篇旧帖子，但我刚刚遇到这个问题并在这个帖子中找到了答案。希望它可以帮助任何遇到这种情况的人。

我没有在后面的代码中放置任何客户端脚本。我只放了这段代码：

```
 <script type="text/javascript">       
         Sys.WebForms.PageRequestManager.getInstance().add_pageL
              Sys.WebForms.PageRequestManager.getInstance().add_endRequest(EndRequestHandler);

              function EndRequestHandler() {
                  $('.default-date-picker').datepicker({
                      format: 'dd-mm-yyyy'
                  });
              }

             });
             </script> 
```

上面的代码需要在正文部分而不是头部部分。我尝试将它放在脚本管理器之前和之后，或者在 UpdatePanel 内部和外部，但发现所有选项都没有问题。所以只要这段代码在正文部分，它就对我有用。

只需确保更改定义的 datetimepicker 类即可。我的是 js 文件中的“default-date-picker”。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2019-03-06T12:29:06.337

另一种简单的方法是从更新面板中取出日期文本框。这样，更新面板的回帖不会影响日期文本框

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2012-02-28T10:19:15.847

我知道这篇文章很旧 - 但只需将您的 jquery datepicker 放在更新面板之外 - 应该可以 100% 工作......

# git - 让现有的 Git 分支跟踪远程分支？

> ID：520650
> 
> 赞同：3787
> 
> 时间：2009-02-06T15:14:04.757
> 
> 标签：git, branch, git-branch

我知道如何创建一个跟踪远程分支的新分支，但是**如何使现有分支跟踪远程分支？**

我知道我可以编辑`.git/config`文件，但似乎应该有更简单的方法。

* * *

## 回答 #1

> 赞同：4568
> 
> 时间：2010-02-18T03:06:52.900

给定一个分支`foo`和一个远程`upstream`：

**从 Git 1.8.0 开始：**

```
git branch -u upstream/foo 
```

或者，如果本地分支`foo`不是当前分支：

```
git branch -u upstream/foo foo 
```

或者，如果你想输入更长的命令，这些等价于上述两个：

```
git branch --set-upstream-to=upstream/foo

git branch --set-upstream-to=upstream/foo foo 
```

**从 Git 1.7.0（1.8.0 之前）开始：**

```
git branch --set-upstream foo upstream/foo 
```

**笔记：**

*   以上所有命令都将导致本地分支从远程`foo`跟踪远程分支。`foo``upstream`
*   旧的 (1.7.x) 语法已弃用，取而代之的是新的 (1.8+) 语法。新语法旨在更直观、更容易记住。
*   当针对尚未获取的新创建的遥控器运行时，定义上游分支将失败。在这种情况下，请`git fetch upstream`提前运行。

* * *

另请参阅：[为什么我需要一直执行 `--set-upstream`？](https://stackoverflow.com/q/6089294/95706)

* * *

## 回答 #2

> 赞同：259
> 
> 时间：2009-03-09T08:50:23.650

您可以执行以下操作（假设您已在 master 上签出并希望推送到远程分支 master）：

如果您还没有“遥控器”，请设置它

```
git remote add origin ssh://... 
```

现在配置master知道要跟踪：

```
git config branch.master.remote origin
git config branch.master.merge refs/heads/master 
```

并推动：

```
git push origin master 
```

* * *

## 回答 #3

> 赞同：176
> 
> 时间：2012-10-02T16:24:00.303

`-u`我这样做是使用选项推动的副作用，如

```
$ git push -u origin branch-name 
```

等效的长选项是`--set-upstream`.

该`git-branch`命令也可以理解`--set-upstream`，但它的使用可能会令人困惑。[1.8.0 版本](https://lkml.org/lkml/2012/10/1/419)修改了界面。

> `git branch --set-upstream`已弃用，可能会在相对遥远的将来被删除。 `git branch [-u|--set-upstream-to]`已经引入了更合理的论点顺序。
> 
> …
> 
> 说起来很诱人`git branch --set-upstream origin/master`，但这告诉 Git 安排本地分支“origin/master”与当前签出的分支集成，这不太可能是用户的意思。该选项已弃用；改用新的`--set-upstream-to`（带有 short-and-sweet `-u`）选项。

假设您有一个本地`foo`分支，并希望它以与其上游相同的名称来处理该分支。做到这一点

```
$ git branch foo
$ git branch --set-upstream-to=origin/foo 
```

要不就

```
$ git branch --set-upstream-to=origin/foo foo 
```

* * *

## 回答 #4

> 赞同：66
> 
> 时间：2010-11-23T12:08:42.100

对于 Git 1.8.0 及更高版本：

实际上，对于公认的工作答案：

```
git remote add upstream <remote-url>
git fetch upstream
git branch -f --track qa upstream/qa
# OR Git version 1.8.0 and higher:
git branch --set-upstream-to=upstream/qa
# Gitversions lower than 1.8.0
git branch --set-upstream qa upstream/qa 
```

* * *

## 回答 #5

> 赞同：58
> 
> 时间：2009-02-06T17:11:44.830

您可能会发现该[`git_remote_branch`](http://github.com/webmat/git_remote_branch)工具很有用。它提供了用于创建、发布、删除、跟踪和重命名远程分支的简单命令。一个不错的功能是您可以要求一个`grb`命令来解释它将执行哪些 git 命令。

```
grb explain create my_branch github
# git_remote_branch version 0.3.0

# List of operations to do to create a new remote branch and track it locally:
git push github master:refs/heads/my_branch
git fetch github
git branch --track my_branch github/my_branch
git checkout my_branch 
```

* * *

## 回答 #6

> 赞同：48
> 
> 时间：2010-07-28T09:33:52.843

我相信早在 Git 1.5.x 中，您就可以像这样让本地分支`$BRANCH`跟踪远程分支`origin/$BRANCH`。

鉴于这一点`$BRANCH`并且`origin/$BRANCH`存在，并且您当前尚未签出`$BRANCH`（如果有，请切换），请执行以下操作：

```
git branch -f --track $BRANCH origin/$BRANCH 
```

这将重新创建`$BRANCH`为跟踪分支。尽管已经存在，`-f`但强制创造`$BRANCH`。`--track`如果有通常的默认值（即 git-config 参数`branch.autosetupmerge`为 true），则它是可选的。

请注意，如果`origin/$BRANCH`尚不存在，您可以通过将本地推`$BRANCH`送到远程存储库来创建它：

```
git push origin $BRANCH 
```

紧接着上一条命令将本地分支提升为跟踪分支。

* * *

## 回答 #7

> 赞同：45
> 
> 时间：2016-06-06T14:21:12.240

**1- 使用git fetch --all**更新您的本地元数据

 **[![在此处输入图像描述](https://i.stack.imgur.com/UBUNn.png)](https://i.stack.imgur.com/UBUNn.png)

**2-使用： git branch -a**显示您的远程和本地分支 ，请参见以下屏幕截图

[![在此处输入图像描述](https://i.stack.imgur.com/J1xB9.png)](https://i.stack.imgur.com/J1xB9.png)

3-切换到要与远程链接的目标分支：使用

**git checkout 分支名称**

例子 ：

[![在此处输入图像描述](https://i.stack.imgur.com/WeBwL.png)](https://i.stack.imgur.com/WeBwL.png)

4-使用以下命令将本地分支链接到远程分支：

**git branch --set-upstream-to nameOfRemoteBranch**

注意：**nameOfRemoteBranch**：从步骤 2 的输出中复制“git branch -r”

使用示例：

[![在此处输入图像描述](https://i.stack.imgur.com/arZFk.png)](https://i.stack.imgur.com/arZFk.png)

* * *

## 回答 #8

> 赞同：27
> 
> 时间：2011-08-29T21:38:32.473

确保你运行：

```
git config push.default tracking 
```

能够摆脱麻烦

* * *

## 回答 #9

> 赞同：25
> 
> 时间：2009-02-06T15:17:54.530

编辑`.git/config`可能是最简单和最快的方法。无论如何，这就是用于处理远程分支的 Git 命令正在做的事情。

如果您不想手动处理文件（这并不难），您可以随时使用`git config`它......但同样，无论如何，这只是要编辑`.git/config`文件。

当然，有一些方法可以在使用时自动跟踪远程分支`git checkout`（例如，通过传递`--track`标志），但这些命令适用于*新*分支，而不是现有分支。

* * *

## 回答 #10

> 赞同：20
> 
> 时间：2012-10-09T07:19:03.180

简而言之

```
git branch --set-upstream yourLocalBranchName origin/develop 
```

这将使您的`yourLocalBranchName`跟踪远程分支称为`develop`.

* * *

## 回答 #11

> 赞同：17
> 
> 时间：2010-06-01T02:23:47.553

对于 1.6.x，可以使用[git_remote_branch](http://github.com/webmat/git_remote_branch)工具完成：

```
grb track foo upstream 
```

这将导致 Git`foo`跟踪`upstream/foo`。

* * *

## 回答 #12

> 赞同：15
> 
> 时间：2015-12-22T09:46:13.040

我使用以下命令（假设您的本地分支名称是“branch-name-local”，远程分支名称是“branch-name-remote”）：

```
$ git branch --set-upstream-to=origin/branch-name-remote branch-name-local 
```

如果本地和远程分支都具有相同的名称，则只需执行以下操作：

```
$ git branch --set-upstream-to=origin/branch-name branch-name 
```

* * *

## 回答 #13

> 赞同：10
> 
> 时间：2015-11-29T23:04:57.007

在这里，使用`github`and `git version 2.1.4`，只需执行以下操作：

```
$ git clone git@github.com:user/repo.git 
```

遥控器来自 itelsef，即使没有在本地链接：

```
$ git remote show origin

* remote origin
  Fetch URL: git@github.com:user/repo.git
  Push  URL: git@github.com:user/repo.git
  HEAD branch: master
  Remote branches:
    develop tracked         <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
    master  tracked
  Local branch configured for 'git pull':
    master merges with remote master
  Local ref configured for 'git push':
    master pushes to master (up to date) 
```

但是当然，仍然没有本地分支：

```
$ git branch
* master                  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<< 
```

看？现在，如果您只是结帐开发，它会自动发挥作用：

```
$ git checkout develop
Branch develop set up to track remote branch develop from origin.
Switched to a new branch 'develop' 
```

太简单！

* * *

**概括。**只需运行这两个命令：

```
$ git clone git@github.com:user/repo.git
$ git checkout develop 
```

* * *

## 回答 #14

> 赞同：10
> 
> 时间：2017-04-20T10:24:24.520

要创建新分支，我们可以使用以下命令

```
git checkout --track -b 示例来源/示例
```

对于已经创建的分支在远程之间创建链接，然后从该分支使用以下命令

```
git 分支 -u 来源/远程分支名称
```

* * *

## 回答 #15

> 赞同：9
> 
> 时间：2016-08-02T10:23:19.343

## 使用“--track”选项

*   之后`git pull`：

    `git checkout --track <remote-branch-name>`

*   或者：

    `git fetch && git checkout <branch-name>`

* * *

## 回答 #16

> 赞同：7
> 
> 时间：2020-08-13T12:38:34.860

对于 git 版本`2.25.1`，使用命令：

```
git push --set-upstream origin <local_branch_name> 
```

* * *

## 回答 #17

> 赞同：6
> 
> 时间：2016-05-21T12:53:42.560

这不是对这个问题的直接答案，但我想在这里为任何在尝试配置上游分支时可能遇到与我相同问题的人留下一个注释。

小心**push.default**。

对于较旧的 git 版本，默认值为**match**，如果您有，这将导致非常不良的行为，例如：

本地分支“master”跟踪到 origin/master

远程分支“上游”跟踪到上游/主

如果你在“upstream”分支上尝试“git push”，与**push.default 匹配**的 git 会自动尝试将本地分支“master”合并到“upstream/master”中，造成一大堆混乱。

这给出了更理智的行为：

git config --global push.default 上游

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2015-10-05T06:10:44.840

以某种相关的方式，我试图将远程跟踪分支添加到现有分支，但无法访问我想在其中添加远程跟踪分支的系统上的远程存储库（因为我经常导出这个的副本repo 通过sneakernet 到另一个有权推送到该遥控器的系统）。我发现没有办法强制在本地添加一个尚未获取的远程分支（所以本地不知道该分支存在于远程，我会得到错误：）`the requested upstream branch 'origin/remotebranchname' does not exist`。

最后，我设法添加了一个新的、以前未知的远程分支（没有获取），方法是添加一个新的头文件，`.git/refs/remotes/origin/remotebranchname`然后从可以访问源的系统复制 ref（目测是最快的，因为它是蹩脚的;-) repo 到工作站（使用我添加远程分支的本地 repo）。

一旦完成，我就可以使用`git branch --set-upstream-to=origin/remotebranchname`

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2016-10-07T16:20:58.363

或简单地通过：

如果您不在分支中，请切换到分支：

```
[za]$ git checkout branch_name 
```

跑

```
[za]$ git branch --set-upstream origin branch_name
Branch origin set up to track local branch brnach_name by rebasing. 
```

你准备好：

```
 [za]$ git push origin branch_name 
```

您可以通过运行查看配置文件以查看正在跟踪的内容：

```
 [za]$ git config -e 
```

很高兴知道这一点，它显示了哪些分支被跟踪，哪些没有。：

```
 [za]$ git remote show origin 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2019-02-26T09:54:35.220

对于像我一样只想将本地分支名称与远程分支名称同步的任何人，这里有一个方便的命令：

```
git branch -u origin/$(git rev-parse --abbrev-ref HEAD) 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2020-04-15T09:39:59.787

为避免每次收到消息时都**记住需要执行的操作：**

> 请指定要合并的分支。有关详细信息，请参阅 git-pull(1)
> 。
> ......

您可以使用以下脚本将原点设置为您所在的**当前分支****的上游**。

 **就我而言，我**几乎从不**将**origin 以外**的其他内容设置为**默认的 upstream**。此外，我几乎总是为本地和远程分支保留相同的分支名称。所以以下适合我：

```
#!/bin/bash
# scriptname: git-branch-set-originupstream
current_branch="$(git branch | grep -oP '(?<=^\* )(.*)$')"
upstream="origin/$current_branch"
git branch -u "$upstream" 
```

* * *

## 回答 #22

> 赞同：-2
> 
> 时间：2016-06-22T16:37:35.087

这也可以

```
git branch --set-upstream-to=/< remote>/< branch> < localbranch> 
```

# c# - 调整 jpeg 图像大小会影响其压缩吗？

> ID：520671
> 
> 赞同：1
> 
> 时间：2009-02-06T15:17:23.873
> 
> 标签：c#, .net, image, compression, resize

我正在使用 Graphics.DrawImage 方法调整 jpeg 的大小（请参见下面的代码片段）。谁能确认这不会影响新图像的压缩？我看过[这个线程](https://stackoverflow.com/questions/87753/resizing-an-image-without-losing-any-quality)，但我专门谈论 jpeg 的压缩。

```
 private byte[] getResizedImage(String url, int newWidth)
    {
        Bitmap bmpOut = null;
        System.IO.MemoryStream outStream = new System.IO.MemoryStream();

        //input image is disposable
        using (Bitmap inputImage = LoadImageFromURL(url))
        {
            ImageFormat format = inputImage.RawFormat;
            decimal ratio;  //ratio old width:new width
            int newHeight = 0;

            //*** If the image is smaller than a thumbnail just return it
            if (inputImage.Width < newWidth)
                return null;

            ratio = (decimal)newWidth / inputImage.Width;
            decimal h = inputImage.Height * ratio;
            newHeight = (int)h;

            bmpOut = new Bitmap(newWidth, newHeight);
            Graphics g = Graphics.FromImage(bmpOut);
            g.InterpolationMode = System.Drawing.Drawing2D.InterpolationMode.HighQualityBicubic;
            // try testing with following options:
            //g.SmoothingMode = System.Drawing.Drawing2D.SmoothingMode.AntiAlias;
            //g.SmoothingMode = System.Drawing.Drawing2D.SmoothingMode.HighQuality;
            //g.PixelOffsetMode = System.Drawing.Drawing2D.PixelOffsetMode.HighQuality;
            //g.CompositingQuality = System.Drawing.Drawing2D.CompositingQuality.HighQuality;

            g.FillRectangle(Brushes.White, 0, 0, newWidth, newHeight);
            g.DrawImage(inputImage, 0, 0, newWidth, newHeight);
            bmpOut.Save(outStream, getImageFormat(url));
        }

        return outStream.ToArray();

    } 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-06T15:29:51.383

JPEG 没有保存在其中的“压缩”值。当您调整大小并保存它们时，它们会使用您告诉保存函数使用的任何值进行压缩。由于您没有传递值，它只会使用库的默认值。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-06T17:05:22.907

调整图像大小会影响压缩，如果通过“压缩”您指的是可以将多少细节适合多少像素。

JPEG 压缩算法有利于具有渐变和平坦色块的模糊或均匀图像。因此，图像尺寸和生成的文件大小之间没有直接关联。最重要的是图像中的细节量（所有图像都保存为 JPEG 格式，损失率为 80%）：

1.  原来的 SO 标志：

    [原创 http://magnetiq.com/exports/sologo/original.jpg](http://magnetiq.com/exports/sologo/original.jpg)

    `File size: 4,483 bytes`

2.  保留尺寸并应用重度高斯模糊：

    [模糊 http://magnetiq.com/exports/sologo/blurred.jpg](http://magnetiq.com/exports/sologo/blurred.jpg)

    `File size: 1,578 bytes`

3.  将原稿尺寸调整为 1/4：

    [缩小 http://magnetiq.com/exports/sologo/shrunk.jpg](http://magnetiq.com/exports/sologo/shrunk.jpg)

    `File size: 2,063 bytes`

请注意，模糊图像 (2)，即使它是缩小后的图像 (3) 的 4 倍，其文件大小也比 (1) 和 (2) 都小。模糊添加了使 JPEG 压缩满意的漂亮渐变。

小图像 (3) 虽然只有原始图像 (1) 的 1/4 像素，但还不是文件大小的 1/4。这是因为缩小图像会产生更精细的细节，而 JPEG 压缩不喜欢这样。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-06T15:35:53.230

当你调用“bmpOut.Save”时，你必须传入一些 EncoderParameters 来告诉方法你想用什么质量级别来保存它。

[http://msdn.microsoft.com/en-us/library/system.drawing.imaging.encoderparameters(VS.80).aspx](http://msdn.microsoft.com/en-us/library/system.drawing.imaging.encoderparameters(VS.80).aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-06T15:42:05.883

不要将存储格式 (JPEG) 与您使用`Graphics`对象操作的格式混淆。存储格式是压缩的，`Graphics`对象使用解压缩的数据。

该 `LoadImageFromURL`方法解压缩存储在 JPEG 中的信息，您对解压缩的数据执行调整大小操作，当您将其保存为 JPEG 文件时，它会再次被压缩。

由于 JPEG 压缩不是无损的，每次执行此过程时图片质量都会降低：*解压缩、变异、重新压缩*。

如果我误解了您的问题：您用于保存代码中设置的图像 int 的压缩因子，因此它将处于某个默认值。如果您想通过使用较小的压缩因子进行保存来减少质量损失，则需要显式设置它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-06T15:34:58.583

在您的代码中“ `HighQualityBicubic`”是您正在使用的压缩。调整到更小的尺寸确实会删除细节，但这与压缩无关，它只是与更少的像素有关。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-06T15:41:28.867

JPEG 压缩是[有损](http://en.wikipedia.org/wiki/Lossy_compression)的——并不是所有的原始数据都被准确地存储了。如果您将图像压缩为 JPEG 并对其进行解压缩，您将无法取回确切的原始图像。每次压缩和解压缩时，都会损失一点质量。

对于一些简单的转换，例如旋转 JPEG，您可以使用[jpegtran](http://jpegclub.org/)等程序无损地进行转换。

但是，对于调整图像大小，您不能无损地进行。当你这样做时，你肯定会在一定程度上降低质量，尽管可能不会降低很多。如果可能，请尝试使用原始无损图像作为调整大小操作的来源以获得尽可能高的质量，如果您连接多个调整大小操作，则只需从原始图像中进行一次调整大小。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-06T16:29:12.933

与您已经找到的相同，但这里是来自[Circumventing GDI+ default image compression](http://forums.asp.net/t/529816.aspx#531917)的 VB.NET 版本。

我个人推荐JPEG质量设置为90L。

# javascript - Javascript中的IE和内存积累

> ID：520680
> 
> 赞同：7
> 
> 时间：2009-02-06T15:19:07.960
> 
> 标签：javascript, internet-explorer, memory

这是测试网址

[http://edventures.com/temp/divtest.php](http://edventures.com/temp/divtest.php)

程序：

1.  关闭所有 IE 实例。
2.  在IE7中打开网址
3.  打开任务管理器，查找IE消耗的内存
4.  现在点击创建按钮，
5.  观察它会跳跃大约2K的内存
6.  现在单击 Destroy 按钮，DIV 将被销毁，但内存保持不变。
7.  您可以反复尝试，内存只会增加。

有没有什么办法解决这一问题？有什么方法可以在不重新加载窗口的情况下强制调用垃圾收集器？

我假设当我删除 DIV 时，内存将被释放，但似乎不是那样工作的。

请让我知道对此的任何解决方法。

谢谢你的帮助。

苏哈斯

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-06T15:24:20.507

下面介绍如何在 IE 中创建 DOM 元素并防止内存泄漏。

```
function createDOMElement(el) {
  var el = document.createElement(el);

  try {
    return el;
  }
  finally {
    el = null;
  }
} 
```

在执行其他 DOM 操作时，您可以使用 try/finally 技巧的变体来防止泄漏。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T15:20:42.527

是的 - IE 有一些可怕的内存泄漏。

看看[IE Drip](http://www.outofhanwell.com/ieleak/index.php?title=Main_Page) - 你基本上必须设计你的页面，这样他们就不会做任何让 IE 像这样泄漏的事情。

这就是为什么 IE 如此讨厌的部分原因。

为避免 IE 泄漏，您必须非常小心地向页面添加 HTML 元素，尤其是表格。对非 HTML 3.2 属性要特别小心——IE7 基本上仍然是 IE4，而旧 HTML 规范之外的属性往往会出错。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-06T15:34:29.067

你在其他浏览器上试过这个实验吗？Firefox的内存消耗比我机器上的IE差很多...

# wcf - WCF 的 NetTCPBinding 是否支持 Socks 代理？

> ID：520692
> 
> 赞同：2
> 
> 时间：2009-02-06T15:22:35.643
> 
> 标签：wcf, proxy, nettcpbinding

我有一个要在公司环境中部署的客户端/服务器 WCF 应用程序。

他们通常不允许直接的 Internet 连接，所以我必须使用他们的 SOCKS 代理。

是否可以通过 socks 代理使用 netTcpBinding 通道？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-25T12:45:07.087

经过大量研究，绝对不是（[链接到我自己在 msdn 上的帖子](http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/755c21fe-41c5-4267-9b32-df57d3c1838e)）

# c - @synthesize-ing Objective-C 2.0 中的 C 结构数组

> ID：520696
> 
> 赞同：6
> 
> 时间：2009-02-06T15:23:31.257
> 
> 标签：c, objective-c, cocoa, macos

我正在尝试遵循 Mac OS X API（音频队列服务）中的 C++ 接口教程，但是在 Cocoa（嗯，实际上只是 Foundation）应用程序中（嗯，实际上只是一个“工具”）。它有一个如下所示的结构：

```
static const int kNumberBuffers = 3;                              // 1
struct AQPlayerState {
    AudioStreamBasicDescription   mDataFormat;                    // 2
    AudioQueueRef                 mQueue;                         // 3
    AudioQueueBufferRef           mBuffers[kNumberBuffers];       // 4
    AudioFileID                   mAudioFile;                     // 5
    UInt32                        bufferByteSize;                 // 6
    SInt64                        mCurrentPacket;                 // 7
    UInt32                        mNumPacketsToRead;              // 8
    AudioStreamPacketDescription  *mPacketDescs;                  // 9
    bool                          mIsRunning;                     // 10
}; 
```

我在将第 4 项转换为 Objective-C 时遇到了很多麻烦，因为我不知道如何转换`@synthesize`为 C 数组。具体来说，这是我到目前为止所拥有的：

### 玩家状态.h

```
#import <Foundation/Foundation.h>
#import <AudioToolbox/AudioQueue.h>

@interface PlayerState : NSObject {
  AudioStreamBasicDescription   dataFormat;
  AudioQueueRef                 queue;
  AudioQueueBufferRef           _buffers[3];
  int                           audioFile; // make this an actual type?
  UInt32                        bufferByteSize;
  SInt64                        currentPacket;
  UInt32                        numPacketsToRead;
  AudioStreamPacketDescription* packetDescs;
  bool                          isRunning;
}

@property(assign) AudioStreamBasicDescription   dataFormat;
@property(assign) AudioQueueRef                 queue;
@property(assign) AudioQueueBufferRef           buffers;
@property(assign) int                           audioFile;
@property(assign) UInt32                        bufferByteSize;
@property(assign) SInt64                        currentPacket;
@property(assign) UInt32                        numPacketsToRead;
@property(assign) AudioStreamPacketDescription* packetDescs;
@property(assign) bool                          isRunning;

@end 
```

## 玩家状态.m

```
#import "PlayerState.h"

@implementation PlayerState

@synthesize dataFormat;
@synthesize queue;
@synthesize buffers;
@synthesize audioFile;
@synthesize bufferByteSize;
@synthesize currentPacket;
@synthesize numPacketsToRead;
@synthesize packetDescs;
@synthesize isRunning;

@end 
```

`@synthesize buffers`编译失败如下：“错误：综合属性‘缓冲区’必须与兼容的 ivar 命名相同，或者必须显式命名 ivar”

这显然是因为相应的 ivar 已命名`_buffers`而不是`buffers`- 但这是必要的，因为我无法将属性定义为数组（我可以吗？`@property(assign) *AudioQueueBufferRef buffers`是语法错误）

我该怎么做才能将 ivar 定义为`AudioQueueBufferRef`结构数组，或者合成属性以使其引用`_buffers`数组？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-06T16:06:11.123

> `@synthesize buffers`编译失败如下：“错误：综合属性‘缓冲区’必须与兼容的 ivar 命名相同，或者必须显式命名 ivar”

尝试：

```
@synthesize buffers = _buffers; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-07-29T08:24:20.813

我现在正在为一个 OpenGL 应用程序做类似的事情，因为这是一个有用的问题（而且很久没有答案）我想翻译我的解决方案。请注意，使用 NSArray 可能会更省力……但如果您需要磨练性能和/或使用基本的 C（或 GL 或类似的非对象）类型，这应该会有所帮助。另外，如果我做了一些在 OSX 中不起作用的事情，请原谅我，因为我的代码实际上是用于 iPhone 的……我相信至少概念是相同的。以下是步骤概要：

1.  将变量声明为指针
2.  使用@private 保护它免受外部直接访问
3.  将属性声明为一个指针，它将被设置为指向我们传递给 setter 的任何数组
4.  编写或合成一个 setter 和 getter 方法。我对@synthesize 的使用似乎使事情变得混乱并导致了内存泄漏，因此我将在此处遵循自己编写的路径。
5.  （我认为以前的一些帖子中缺少链接）由于您要返回一个 C 数组，因此请使用 malloc 分配内存。init 方法可能是一个很好的地方，您可以使用 dealloc 或其他地方来调用 free(myBuffers) 因为您的变量具有适当的广泛范围。

我不知道@synthesize 会为你处理 malloc 的变量，但其他人可能有我缺乏的经验。因此，我只是在编写 setter 和 getter。但请注意，我们仍然在界面中获得点语法和 @property 的香草外观。

这是代码：

在 PlayerState.h 中：

```
@interface PlayerState : NSObject {
    AudioStreamBasicDescription   dataFormat;
    AudioQueueRef                 queue;
@private
    AudioQueueBufferRef           *myBuffers;
    // [...]
    @property(assign) AudioStreamBasicDescription   dataFormat;
    @property(assign) AudioQueueRef                 queue;
    @property(assign) AudioQueueBufferRef           *myBuffers; 
```

这为您提供了一个指针和一个属性，后者相当于指针指示的内存的访问器方法。我们将编写自己的访问器，并为指针分配内存并为其提供指向的东西。

现在在 PlayerState.m 中：

```
-(id)init
{
    if (self = [super init]) {
        myBuffers = (AudioQueueBufferRef*)malloc(sizeof(AudioQueueBufferRef) * 3);
        /* memory is allocated. Free it elsewhere. Note that "Leaks" will
        probably falsely flag this, but you can test it in Object Allocations
        and see that it is clearly released. */
    }
    return self;
}

// return an array of structs
-(AudioQueueBufferRef*)myBuffers
{
    // you can check for values, etc here, but basically it all comes down to:
    return myBuffers;
}

    // the setter; there are several ways to write it, depending on what your objective
    -(void)setMyBuffers:(AudioQueueBufferRef*)abc
    {
    int i = 3;
    while (i > 0) {
        i--;
        myBuffers[i] = abc[i];
    }
    //another possible implementation, not tested
    //free(myBuffers);
    //myBuffers = NULL;
    //myBuffers = xyz;
    }

// if you want to set individual attributes, you can have another method like:
-(void)setMyBuffersA:(AudioQueueBufferRef)a B:(AudioQueueBufferRef)b C:(AudioQueueBufferRef)c
{
    myBuffers[0] = a;
    myBuffers[1] = b;
    myBuffers[2] = c;
} 
```

现在你可以像这样从另一个类中调用它们：

```
-(void)methodOfOtherClass
{
    PlayerState * playerState = [[PlayerState alloc] init];
    AudioQueueBufferRef abc[3] = //something

    [playerState setMyBuffers:(AudioQueueBufferRef*)abc];
    DLog(@"I'm in OtherClass and playerState.myBuffers returns %@, %@, %@", playerState.myBuffers[0],playerState.myBuffers[1],playerState.myBuffers[2])

    abc[1] = 6.22; // reassigning one of the values in our local variable
    playerState.myBuffers = (GLfloat*)abc; //call the setter again, with dot syntax this time if you like
    DLog(@"I'm in OtherClass and playerState.myBuffers returns %@, %@, %@", playerState.myBuffers[0],playerState.myBuffers[1],playerState.myBuffers[2])

    [playerState setMyBuffersA:yourStructA B:yourStructB C:yourStructC];
    DLog(@"I'm in OtherClass and playerState.myBuffers returns %@, %@, %@", playerState.myBuffers[0],playerState.myBuffers[1],playerState.myBuffers[2])
} 
```

这对我使用 iPhone OS 和我的（诚然略有不同）openGL 类型的测试来说没问题。但是，我认为它也对你有用。有可能你必须调整一些东西，或者我在复制和粘贴我的原始代码时引入了一个小错字。此外，如果您喜欢在编写代码时像我一样记录事物，那么记录缓冲区结构的某些成员以查看应该存在的内容可能会更有用。

此外，如果您习惯于在使用 NSLog 包装器编码时打印对象，即：`DLog(@"array is %@", myNSarray)`您将`EXC_BAD_ACCESS`尝试对 C 数组执行相同的操作。C 数组不是 Obj-C 对象，因此请记住这一点，并比 Objective-C 对象多握它的手；）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-06T15:42:00.393

**编辑：** [Peter Hosey](https://stackoverflow.com/users/30461/peter-hosey)指出 C 中的数组*与*指针不同。（有关详细信息，请参阅[本文档](http://djmnet.org/lore/arrays-are-not-pointers.txt)）。这将解释您所看到的错误，并使我发布的代码错误。

[gs在](https://stackoverflow.com/users/24587/gs)[他的回答](https://stackoverflow.com/questions/520696/synthesize-ing-a-c-array-of-structs-in-objective-c-2-0/520797#520797)中链接到的[另一个 SO 问题](https://stackoverflow.com/questions/476843/create-an-array-of-integers-property-in-objective-c)在这个问题的上下文中提出了一个我已经复制的[解决](https://stackoverflow.com/questions/476843/create-an-array-of-integers-property-in-objective-c/477041#477041)方法：

```
// PlayerState.h:
@interface PlayerState : NSObject 
{
    AudioQueueBufferRef           _buffers[3];
}

@property(readonly) AudioQueueBufferRef * buffers; 
```

```
// PlayerState.m:
@implementation PlayerState

@dynamic buffers;
- (AudioQueueBufferRef *)buffers { return _buffers; }

@end 
```

这将允许您像访问对象`buffers`数组一样访问它。`AuidoQueueBufferRef`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-06T15:47:08.247

在这里看起来像这个问题：

[在objective-c中创建一个整数属性数组](https://stackoverflow.com/questions/476843/create-an-array-of-integers-property-in-objective-c)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-06T15:48:05.357

为什么要将结构转换为 Objective-C 对象？Objective-C 是 C 的**严格**超集，因此您可以将给定的结构原样与 Objective-C 一起使用。

**[编辑]**作为对您的评论的回应，编译器抱怨`mBuffers`声明是因为关于允许的静态数组大小的规则。C 中的规则比 C++ 中的规则更严格一些。作为一个简单的修复，只需更改行

```
static const int kNumberBuffers = 3; 
```

进入

```
#define kNumberBuffers 3 
```

然后该结构应该正确编译（当然，前提是您已经包含了定义所有正确数据类型的必要标头，例如`AudioStreamBasicDescription`等）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-12-30T22:44:57.880

您可以拥有三个缓冲区 ivars（buffer0、buffer1、buffer2），或者您需要将其设为指向 AudioQueueBufferRefs 的指针并分别分配内存来保存三个 AudioQueueBufferRefs。或者，如果您需要可变数量的缓冲区，则使用 NSArray 或 NSData。

但是回到更大的上下文，您可能不需要跟踪 AudioQueueBufferRefs。如果您将所有三个缓冲区都排入队列，您将在音频队列回调中获得指向它们的指针。

我有一些记录和播放音频的音频代码，它调用 AudioQueueAllocateBuffer() 和 AudioQueueEnqueueBuffer() 之后几乎忘记了缓冲区。

如果您尝试为 AudioQueue 编写 Cocoa 包装器，请不要这样做。

编辑：但要回答您最初的问题：您不能将数组作为属性，因为它不是“Plain Ol' Data”类型。请参阅 Xcode 中的 Objective-C 2.0 文档中的“声明的属性”，这是：[http ://www.fnal.gov/docs/working-groups/fpcltf/Pkg/ISOcxx/doc/POD.html](http://www.fnal.gov/docs/working-groups/fpcltf/Pkg/ISOcxx/doc/POD.html)

# html - CSS最大高度不起作用

> ID：520710
> 
> 赞同：20
> 
> 时间：2009-02-06T15:28:19.297
> 
> 标签：html, css

我有一个非常简单的问题，当我希望 div 垂直滚动时，我需要一个 div 来扩展以适应其内容，除非高度达到一定大小。作为测试，我创建了一个页面，其中包含：

```
<div style="width:300px;max-height:25px;background-color:green;overflow:auto;">
    1<br />
    2<br />
    3<br />
    4<br />
    5
</div> 
```

不幸的是，最大高度似乎不起作用。我究竟做错了什么？

我正在使用 IE7。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-06T15:34:02.250

问题是你的浏览器。也许您可以将此 div 包装在另一个具有 25px 固定高度的 div 中。当然，这与最大高度不完全相同。

[关于解决方案的文章。](http://perishablepress.com/press/2007/01/16/maximum-and-minimum-height-and-width-in-internet-explorer/)

**编辑：** [根据微软](http://msdn.microsoft.com/en-us/library/cc351024(VS.85).aspx#positioning)的说法，它应该在 IE7+ 中工作。

您是否设置了适当的文档类型？如果不是 IE7 使用旧的布局引擎。您应该使用 HTML 4 或 XHTML。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-06T15:30:25.393

这是设置最小高度的跨浏览器方法：

```
min-height: 400px;
height:auto !important;
height:400px; 
```

IE 将 height 属性视为 min-height，而忽略 min-height。

编辑：将问题误读为最小高度！(>_<)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-06T15:37:47.750

你的代码对我有用。

用页包起来的话！

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
<title>1 2 3 4 5</title>
</head>

<body>
<div style="width:300px;max-height:25px;background-color:green;overflow:auto;">
    1<br />
    2<br />
    3<br />
    4<br />
    5
</div>
</body>

</html> 
```

在 IE7 和 Chrome 中运行良好。

FF3 没有给我滚动条。

但是最大高度在所有三个中都可以正常工作。

尽管您的代码片段不起作用，但没有周围的页面。我建议在有效的 HTML 页面中测试代码。*咧嘴笑*

# c - 有人可以解释 Quake3 的“大块头”吗？

> ID：520714
> 
> 赞同：3
> 
> 时间：2009-02-06T15:29:13.693
> 
> 标签：c, memory

我已经阅读了源代码，并尝试在网上对其进行研究，但在完全理解它方面我遇到了障碍。
我的意思是，它与区域分配有何不同？

“区域”是否用于小内存，“大块”用于模型等较大的东西？

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-09T02:16:58.700

是的，大块用于大型静态分配，例如纹理和几何图形，而区域用于较小的（并且可能是易变的）分配。

拥有两个（或更多！）这样的区域是游戏中的常见模式。有两个原因;

1) 大多数游戏会预先分配运行所需的内存，然后从该空间执行自己的分配。这不仅比使用操作系统分配器更快，而且它阻止操作系统将你的纹理/几何/任何内容分页到磁盘。使用您自己的分配器还可以更轻松地创建代码来跟踪内存模式和泄漏。

2) 将您的小型和/或动态分配保留在单独的区域中，以避免分割用于较大分配的区域。碎片化是以前的小分配留下“漏洞”的地方，导致连续可用空间的数量变得小于总可用空间，并且是推动内存限制的游戏的祸根:)

# sql-server - ADO.NET SQLServer：如何防止关闭的连接持有 S-DB 锁？

> ID：520716
> 
> 赞同：10
> 
> 时间：2009-02-06T15:30:03.757
> 
> 标签：sql-server, ado.net, tcp, connection-pooling

我[处理](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlconnection.close.aspx)一个 SqlConnection 对象，但当然[它并没有真正关闭](http://www.ondotnet.com/pub/a/dotnet/2004/02/09/connpool.html)。我需要关闭连接才能不锁定数据库对象。如何防止关闭的连接持有锁？

* * *

对上述句子的解释给不知道的人：

*   当您关闭 ADO 或 ADO.NET 连接时，您实际上并没有切断与 SQL Server 的连接。ADO/ADO.NET 基础结构保持连接，以防您想再次使用它。连接一直在所谓的“连接池”中徘徊。

*   几分钟不使用后，连接*实际上*会关闭。虽然，不是真的。TCP/IP 有它自己的方法来保持 TCP 连接打开几分钟（在“ **CLOSE_WAIT** ”状态）。这是在您要求再次打开到同一 IP:Port 的 TCP 连接时完成的。如果是这样，它可以使用已经打开的 TCP 连接。

*   使用连接池和 SQL Server，仍会建立与 SQL Server 的连接。每个连接都有一个它所在的数据库上下文。只要一个连接位于该数据库中：它就持有该数据库上的共享数据库 (S-DB) 锁。

*   共享数据库锁的意思很简单，“请不要在我在其中时删除此数据库。”

如何防止它在*我的*数据库上持有共享锁，同时保持连接池的好处？

* * *

我现在的临时解决方案是每次开发人员调用 Dispose：

```
connection.Dispose() 
```

将其更改为对全局辅助函数的调用：

```
Database.DisposeConnection(connection); 
```

它将数据库上下文更改为**master**：

```
public static void DisposeConnection(SqlConnection connection)
{
    //Stop holding a database lock - in my database at least
    ADOHelper.ExecuteNonQuery(connection, "USE master");

    connection.Dispose();
} 
```

它解决了我眼前的问题；关闭的连接没有锁定*我的*数据库。

但现在我担心连接池会扰乱它的大脑——因为我在它背后切换了数据库上下文。

* * *

如果有人不知道或不知道：

从[SDK](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlconnection.close.aspx)：

> **Close**和**Dispose**在功能上是等效的。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-08-29T11:11:06.303

您可以将数据库置于单用户模式以恢复它。IIRC，像这样的东西......

```
ALTER DATABASE TheDatabaseToRestore SET SINGLE_USER WITH  ROLLBACK IMMEDIATE;
RESTORE DATABASE TheDatabaseToRestore 
FROM DISK =N'Z:\Path\To\Backup\BackupFile';
ALTER DATABASE TheDatabaseToRestore SET MULTI_USER; 
```

有关更多背景信息，请参阅：获取使用 SQL 恢复 SQL Server和/或[恢复数据库备份的](http://dotnetvault.blogspot.com/2008/07/restore-database-backup-using-sql.html)[独占访问权限。](http://www.sql-server-performance.com/articles/dba/Obtain_Exclusive_Access_to_Restore_SQL_Server_p2.aspx)

*编辑：* 单用户模式用于备份和恢复（在非快速版本中，我经常使用它）。使用它会踢出所有其他连接，并且无法建立新连接。我没有玩过各种“WITH”选项，例如“ROLLBACK IMMEDIATE”，但它们的用法似乎很简单。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-08-28T17:30:25.633

你试过[SqlClient.ClearPool](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlconnection.clearpool%28VS.80%29.aspx)吗？

来自 MSDN：

> ClearPool 清除与连接关联的连接池。如果在调用时与 connection 关联的其他连接正在使用中，则它们会被适当地标记并在对其调用 Close 时被丢弃（而不是返回到池中）。

只需在每个连接上调用 ClearPool，但如果这样做，您将失去池化的好处。

```
public class DataFactory
{
  public SqlConnection CreateConnection(string connString)
  {
    SqlConnection conn = new SqlConnection(connString);
    SqlClient.ClearPool(conn);
    return conn;
   }
} 
```

或者，您可以使用连接字符串的 Pooling 属性一起禁用池：

```
string connString = "Data Source=MYSERVER;Initial Catalog=myDb;Integrated Security=true;Pooling=false" 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-29T07:33:09.110

正如您所说，当您关闭或处置连接时，它会返回池中，但并未真正关闭。

然后你需要做什么来关闭池中的所有连接。这可以通过 ClearAllPools 命令完成。

> ClearAllPools 重置（或清空）连接池。如果在调用时有正在使用的连接，它们会被适当地标记并在对其调用 Close 时被丢弃（而不是返回到池中）。

[http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlconnection.clearallpools(VS.80).aspx](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlconnection.clearallpools(VS.80).aspx)

还有一个 ClearPool 命令可以执行相同的操作，但只针对单个连接。

希望这可以帮助

设拉子

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-08-31T18:23:05.397

执行“使用临时数据库；” 第一的。然后关闭它。

或者“USE master;”，如果这更符合您的喜好。

在正常生产操作期间，这些数据库中的任何一个上的 S-DB 锁定都无关紧要，因为您无法摆脱任何一个并继续运行服务器。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-07T18:14:10.680

阅读评论，您想恢复它。

好的，让它离线。

恢复不是应用程序应该做的事情，所以 DBA 在 RESTORE 之前运行它。

```
ALTER DATABASE foo SET OFFLINE WITH ROLLBACK IMMEDIATE 
```

# c# - 无缓冲 StreamReader

> ID：520722
> 
> 赞同：21
> 
> 时间：2009-02-06T15:31:49.820
> 
> 标签：c#, stream

有没有办法让 StreamReader 不做任何缓冲？

我正在尝试处理来自可能是二进制或文本的进程的输出。输出看起来像一个 HTTP 响应，例如

```
Content-type: application/whatever
Another-header: value

text or binary data here 
```

我想要做的是使用 a 解析标头`StreamReader`，然后从其`BaseStream`或中读取`StreamReader`以处理其余内容。这基本上是我开始的：

```
private static readonly Regex HttpHeader = new Regex("([^:]+): *(.*)");
private void HandleOutput(StreamReader reader)
{
  var headers = new NameValueCollection();
  string line;
  while((line = reader.ReadLine()) != null)
  {
    Match header = HttpHeader.Match(line);
    if(header.Success)
    {
      headers.Add(header.Groups[1].Value, header.Groups[2].Value);
    }
    else
    {
      break;
    }
  }
  DoStuff(reader.ReadToEnd());
} 
```

这似乎会破坏二进制数据。所以我把最后一行改成这样：

```
if(headers["Content-type"] != "text/html")
{
  // reader.BaseStream.Position is not at the same place that reader
  // makes it looks like it is.
  // i.e. reader.Read() != reader.BaseStream.Read()
  DoBinaryStuff(reader.BaseStream);
}
else
{
  DoTextStuff(reader.ReadToEnd());
} 
```

...但 StreamReader 缓冲其输入，因此 reader.BaseStream 位置错误。有没有办法解除 StreamReader 的缓冲？或者我可以告诉 StreamReader 将流重置回 StreamReader 所在的位置吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2010-03-23T00:30:17.477

这个答案很晚，可能不再与您相关，但对于偶然发现此问题的其他人可能会派上用场。

我的问题涉及[PPM 文件](http://en.wikipedia.org/wiki/Netpbm_format)，其格式类似：

*   ASCII 文本开头
*   文件其余部分的二进制字节

我遇到的问题是`StreamReader`该类无法在不缓冲内容的情况下一次读取一个字节。这在某些情况下会导致意外结果，因为该`Read()`方法读取的是单个字符，而不是单个字节。

我的解决方案是围绕一个流编写一个包装器，一次读取一个字节。包装器有 2 个重要的方法，`ReadLine()`和`Read()`.

这两种方法允许我读取流的 ASCII 行，无缓冲，然后一次读取一个字节来读取流的其余部分。您可能需要进行一些调整以满足您的需求。

```
class UnbufferedStreamReader: TextReader
{
    Stream s;

    public UnbufferedStreamReader(string path)
    {
        s = new FileStream(path, FileMode.Open);
    }

    public UnbufferedStreamReader(Stream stream)
    {
        s = stream;
    }

    // This method assumes lines end with a line feed.
    // You may need to modify this method if your stream
    // follows the Windows convention of \r\n or some other 
    // convention that isn't just \n
    public override string ReadLine()
    {
        List<byte> bytes = new List<byte>();
        int current;
        while ((current = Read()) != -1 && current != (int)'\n')
        {
            byte b = (byte)current;
            bytes.Add(b);
        }
        return Encoding.ASCII.GetString(bytes.ToArray());
    }

    // Read works differently than the `Read()` method of a 
    // TextReader. It reads the next BYTE rather than the next character
    public override int Read()
    {
        return s.ReadByte();
    }

    public override void Close()
    {
        s.Close();
    }
    protected override void Dispose(bool disposing)
    {
        s.Dispose();
    }

    public override int Peek()
    {
        throw new NotImplementedException();
    }

    public override int Read(char[] buffer, int index, int count)
    {
        throw new NotImplementedException();
    }

    public override int ReadBlock(char[] buffer, int index, int count)
    {
        throw new NotImplementedException();
    }       

    public override string ReadToEnd()
    {
        throw new NotImplementedException();
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T17:21:05.247

好吧，您可以使用[Stream.Seek](http://msdn.microsoft.com/en-us/library/system.io.stream.seek.aspx)设置流的位置。在我看来，您在这里遇到的问题是 StreamReader 正在读取字符而不是字节（取决于编码，每个字符可能不同于 1 个字节）。从[MSDN 库](http://msdn.microsoft.com/en-us/library/system.io.streamreader.aspx)：

> StreamReader 设计用于特定编码的字符输入，而 Stream 类设计用于字节输入和输出。

当您调用 reader.ReadToEnd() 时，它会根据使用的任何编码将数据作为字符串读取。[使用Stream.Read](http://msdn.microsoft.com/en-us/library/system.io.stream.read.aspx)方法可能会更好。使用 StreamReader 读入您的字符串数据，然后在您读入通知您传入二进制数据的标头时将二进制数据提取到 byte[] 中。

# c# - sproc 使用 RETURN @value 时可以使用 cmd.ExecuteScalar

> ID：520735
> 
> 赞同：5
> 
> 时间：2009-02-06T15:34:39.410
> 
> 标签：c#, ado.net, executescalar

你能用吗

```
int blah = Convert.ToInt32(cmd.ExecuteScalar()); 
```

当 sproc 的最后一条语句执行时：

```
RETURN @value 
```

我只能让它工作，如果它这样做：

选择@值

此外，这给了我一个对象空异常：

```
int blah = (int)cmd.ExecuteScalar(); 
```

convert.toint32 和 (int) 不是一回事，但一个是另一个的包装？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-06T15:38:00.073

你不能。ExecuteScalar() 方法设计为在结果集中返回单个值。基本上，第一行的第一列中的值返回。

要获取返回值，您需要向 SQLCommand 对象添加一个参数。在创建参数对象时使用名称“@RETURN_VALUE”并指定返回的参数方向。然后，您可以使用 ExecuteNonQuery() 方法。

我必须注意 IMO，存储过程的返回值应该简单地指示过程的状态。所有数据都应通过结果集或输出参数返回。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-06T16:06:34.820

要回答您的另一个问题， (int) 是一个强制转换，实际上与转换 (Convert.ToInt32) 不同。

在强制转换中，您有点说被强制转换的对象实际上是您要强制转换的类型，因此没有进行真正的转换/解析。由于 int 不能为 null，因此当您要转换的对象为 null 时，转换无效，并引发异常。

随着转换，一些实际的解析和逻辑发生，它处理被转换的对象为空的情况。

[这里](https://stackoverflow.com/questions/104063/systemconverttoint-vs-int)有更多关于此的信息。

# database - 在网站中拥有用户日志记录的优势

> ID：520738
> 
> 赞同：1
> 
> 时间：2009-02-06T15:35:40.937
> 
> 标签：database, logging, web

我被要求记录所有成员的日志。

在我的网站或论坛中拥有用户的日志记录有什么好处？为什么我应该知道谁登录以及何时登录？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-06T15:41:06.620

原因可能是：

1.  监控滥用和安全漏洞。
2.  了解流量和增长模式。
3.  查看用户活动的流程以优化设计和程序流程。
4.  用于广告目的的营销数据。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-06T15:43:12.340

作为研究如何最好地处理他们的请求的一部分，这是你应该问你的主管的事情。询问他们打算如何处理这些数据，这样您就可以生成报告，为他们提供所需的内容。在这些情况下，通常最好询问提出请求的人他们的最终目标是什么，以便您制定最佳解决方案。

作为更直接的答案，这些数据对于查看网站上的活动趋势很有用。谁最常登录？他们在网站上花费了多少时间？那种性质的东西。如果企业计划在网站上销售广告，这对于确定目标人口统计数据非常宝贵，因此他们知道谁最有可能购买广告，从而最大限度地提高销售业绩。这只是一个。他们可能需要这些数据还有一千个其他原因。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-06T15:44:25.410

日志可用于：

*   调查潜在的安全问题（来自单个用户的多次登录尝试，或来自给定用户的并发登录）
*   报告（例如，最近登录的“活跃”用户数量）

我建议让您的主管了解他计划如何使用日志。记录用户在网站上执行的任何活动（例如提交联系表单）对于报告很有用，并且可以成为确保所有用户输入得到快速响应的系统的基础。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-06T15:48:39.910

我们跟踪所有用户在我们所有系统上的活动。作为一家医疗保健组织，我们需要保护患者信息并跟踪对可能被视为患者数据的任何信息的所有访问。还有一个营销方面。我们想知道我们的员工在我们的 Intranet 上对什么做出回应，而他们没有回应什么。最后，在提供安全的工作场所方面存在法律方面的问题。匿名论坛可以为骚扰等打开大门。糟透了，但它确实发生了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-06T15:39:14.907

听起来您的主管想要对应用程序进行审计跟踪。这样他们就可以跟踪使用统计数据，并可能跟踪那些不应该使用系统的数据。当您需要为额外的程序员时间进行更新或证明终止应用程序的合理性提供理由时，这在大规模上可能是有益的。

您还可以跟踪无效登录尝试以寻找那些试图闯入系统的人，或者主动尝试回电并说“嘿，我注意到您正在尝试进入应用程序。您填写了表格 X得到批准？”

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-06T15:40:45.730

这可能有用的原因有很多，最明显的两个是安全性和调试。

你的老板可能有其他原因，但没有上下文，很难说。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-06T15:42:09.223

好吧，您可以计算一些高级统计数据。如果出现问题，它可以帮助您了解某人的帐户发生了什么。这有很多用途，但是如果您的网站很小并且没有那么多流量，我认为简单的上次登录跟踪应该可以做到。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-06T15:39:12.037

拥有这些信息有利于报告目的（可能是你老板要求它的原因）。这是衡量在任何特定时刻有多少成员登录、谁使用它最多等的好方法。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-06T15:39:55.263

我猜是出于报告目的？

可能比将这些东西放在数据库中更好的主意，但是您将在每次登录时写入它。

一个更好的解决方案是利用谷歌分析。也许如果你有一个登录确认页面，你可以计算页面浏览量。这几乎不需要任何编程工作（在一些 javascript 中复制和粘贴）。

# shell - 在 bash/osx 终端中添加多个文件

> ID：520742
> 
> 赞同：5
> 
> 时间：2009-02-06T15:36:51.013
> 
> 标签：shell

我想在 bash 中将一些文本添加到多个文件中，我发现这篇文章处理了 prepend: [prepend to a file one liner shell?](https://stackoverflow.com/questions/54365/prepend-to-a-file-one-liner-shell "在文件中添加一个衬垫外壳？")

我可以使用 find 找到我需要处理的所有文件：

```
find ./ -name "somename.txt" 
```

但是如何使用管道将两者结合起来？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-06T15:48:13.390

你有几个选择。最简单的可能是 sed：

```
find ./ -name somename.txt -exec sed -e '1i\
My new text here' {} \; 
```

如果您添加 '2q' 来告诉它您在准备好文本后已经完成，并且如果将在带有 -i 标志的文件中发生，它会更快：

```
find ./ -name somename.txt -exec sed -i .bak -e '2q;1i\
My new text here' {} \; 
```

要添加多行，您需要以反斜杠结束每一行。

这使原始文件带有`.bak`扩展名。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-06T15:41:17.213

```
find . -name "somefiles-*-.txt" -type f | while read line; do  sed -i 'iThis text gets prepended' -- "$line"; done 
```

或者

```
find . -name "somefiles-*-.txt" -type f | xargs sed -i 'iGets prepended' -- 
```

最好的（我认为）：

```
find . -name "somefiles-*-.txt" -type f -exec sed -i 'iText that gets prepended (dont remove the i)' -- '{}' \; 
```

感谢您缺少“-提示。我也添加了重要的--s。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-06T15:41:08.867

```
find . -name "somename.txt" | while read a; do prepend_stuff_to "$a" ; done 
```

或者

```
find . -name "somename.txt -exec prepend_stuff_to "{}" \; 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-06T15:44:29.170

```
find ./ -name "somename.txt" -print0 | xargs -0 -n 1 prepend_stuff_to 
```

# apache - mod_rewrite 在重写之前截断 URL

> ID：520744
> 
> 赞同：0
> 
> 时间：2009-02-06T15:36:59.793
> 
> 标签：apache, mod-rewrite

我的 .htaccess 文件中有这个

```
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule (.*) /index.cfm?urlparam=/$1 [L,QSA]
</IfModule> 
```

urlparam 只返回域之后的前两个参数

即如果我输入

www.blahblah.com/competitions/display/competition01/

然后写 urlparam 的内容我只得到 /competitions/display/

任何人都可以提出任何建议 mod rewrite 对我来说有点黑艺术。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-06T16:12:53.793

请尝试使用该`REQUEST_URI`变量：

```
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^ /index.cfm?urlparam=%{REQUEST_URI} [L,QSA] 
```

# image - 如何增加图像的 DPI 并使其更清晰？

> ID：520747
> 
> 赞同：3
> 
> 时间：2009-02-06T15:37:26.563
> 
> 标签：image

我想将图像分辨率提高到 300 dpi，而且我有一个不可读的文本图像，所以我想放大它的字号和清晰度。我怎样才能做到这一点？

......从初学者

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-06T16:01:48.870

如果你有一张模糊的图像，你就不能去模糊它——信息已经丢失了。增加现有图像的图像分辨率也不能添加信息。您所能做的就是对现有特征进行插值。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-06T16:09:40.180

有一些软件产品，例如[Genuine Fractals](http://www.ononesoftware.com/detail.php?prodLine_id=2&gclid=CLOBiJyjyJgCFZCD3godCi2V0w)（Photoshop 插件），在图像放大过程中人为提高分辨率方面做得不错。然而，这些工具只能做到这一点，这完全取决于图像中的信息量。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-06T16:04:00.443

如果您有一个现有的图像文件，那么只有这么多信息存在。如果没有足够的数据，您将无法改善这种情况。

如果您有几乎足够的信息，插值、抗锯齿、边缘检测器或其他技术*可能会*帮助您查看其中的内容。

如果没有更多信息，我们不太可能提供任何帮助。

* * *

**编辑：**你在电视节目和电影中看到很多废话。通常，您*无法*将图像缩放到任意程度，然后神奇地对其进行模糊处理。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-06T16:16:18.123

我写了一个关于如何获得可打印屏幕截图的“初学者”教程。

这可能不是您正在寻找的，但原则是好的。您可以截取图像的屏幕截图并将其放大到可打印的尺寸。

[http://www.ryancdavidson.com/web/tt_screencaptoprint.php](http://www.ryancdavidson.com/web/tt_screencaptoprint.php)

我使用的技巧是将您的图像转换为索引颜色（而不是 RGB），它可以放大并保持通常清晰。然后您可以将 DPI 设置为索引颜色，最后在打印之前转换回 RGB。

访问该站点以获取分步操作。

# windows - 程序可以捕获并阻止 Windows 中新 USB 驱动器的弹出对话框吗？

> ID：520752
> 
> 赞同：0
> 
> 时间：2009-02-06T15:38:11.633
> 
> 标签：windows, usb-drive

在应用程序中，我们希望控制新 USB 驱动器连接到系统时出现的窗口弹出消息。

理想情况下，对话框应该完全隐藏。

任何可以帮助的消息？

**更新**

我知道全局禁用自动播放的技巧，但我宁愿在我的应用程序中控制每个事件、每个设备的行为。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T04:08:59.887

您可以使用 GPEdit.msc 在所有驱动器上禁用自动播放。它将对应于注册表项，因此您可以添加该项并根据需要将其删除。

这是[一篇](http://www.thinktechno.com/2008/02/14/disable-autoplay-pop-up-window-for-cds-and-usb-drives/)描述它的文章。这些说明看起来像是针对 XP 的。如果您有 Vista，那么它位于管理模板/Windows 组件/自动播放策略中。

我会尝试以每个设备为基础，将设备放入其中，同时运行 Process Monitor。查看正在触摸哪些注册表项。我认为会有一个与驱动器的设备 ID 相关联。然后，您可以使用正确的设置预先填充该信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-12-15T13:25:59.823

通过使用[QueryCancelAutoPlay](http://msdn.microsoft.com/en-us/library/cc144204%28VS.85%29.aspx)消息或[IQueryCancelAutoPlay](http://msdn.microsoft.com/en-us/library/bb761373%28VS.85%29.aspx)接口可以选择性地禁用自动播放。有关详细信息，请参阅[此答案](https://stackoverflow.com/questions/280787/suppress-autoplay/280832#280832)或[此 MSDN 文章](http://msdn.microsoft.com/en-us/magazine/cc301341.aspx)。

# .net - 检查路径是 UNC 路径还是本地路径的正确方法是什么？

> ID：520753
> 
> 赞同：27
> 
> 时间：2009-02-06T15:38:13.240
> 
> 标签：.net, path, unc

检查路径是否为 UNC 路径的最简单方法当然是检查完整路径中的第一个字符是字母还是反斜杠。这是一个好的解决方案还是可能有问题？

我的具体问题是，如果路径中有驱动器号，我想创建一个 System.IO.DriveInfo 对象。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-02-06T15:46:51.663

试试这个扩展方法：

```
public static bool IsUncPath(this string path)
{
    return Uri.TryCreate(path, UriKind.Absolute, out Uri uri) && uri.IsUnc;
} 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-02-06T15:42:14.620

由于根据定义，在第一个和第二个位置没有两个反斜杠的路径不是 UNC 路径，因此这是一种安全的确定方式。

第一个位置 (c:) 带有驱动器号的路径是根本地路径。

没有这些东西的路径 (myfolder\blah) 是相对本地路径。这包括只有一个斜杠 (\myfolder\blah) 的路径。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-02-06T15:46:13.333

最准确的方法是使用 shlwapi.dll 中的一些互操作代码

```
[DllImport("shlwapi.dll", CharSet = CharSet.Unicode)]
[ResourceExposure(ResourceScope.None)]
[return: MarshalAsAttribute(UnmanagedType.Bool)]
internal static extern bool PathIsUNC([MarshalAsAttribute(UnmanagedType.LPWStr), In] string pszPath); 
```

然后你会这样称呼它：

```
 /// <summary>
    /// Determines if the string is a valid Universal Naming Convention (UNC)
    /// for a server and share path.
    /// </summary>
    /// <param name="path">The path to be tested.</param>
    /// <returns><see langword="true"/> if the path is a valid UNC path; 
    /// otherwise, <see langword="false"/>.</returns>
    public static bool IsUncPath(string path)
    {
        return PathIsUNC(path);
    } 
```

@JaredPar 使用[纯托管代码](https://stackoverflow.com/questions/520753/what-is-the-correct-way-to-check-if-a-path-is-an-unc-path-or-a-local-path/520796#520796)的最佳答案。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2013-09-19T08:17:56.560

这是我的版本：

```
public static bool IsUnc(string path)
{
    string root = Path.GetPathRoot(path);

    // Check if root starts with "\\", clearly an UNC
    if (root.StartsWith(@"\\"))
    return true;

    // Check if the drive is a network drive
    DriveInfo drive = new DriveInfo(root);
    if (drive.DriveType == DriveType.Network)
    return true;

    return false;
} 
```

此版本相对于@JaredPars 版本的优势在于它支持任何路径，而不仅仅是`DriveInfo`.

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2013-09-20T01:11:35.373

我发现的一个技巧是使用`dInfo.FullName.StartsWith(String.Empty.PadLeft(2, IO.Path.DirectorySeparatorChar))`where dInfo 是 DirectoryInfo 对象 - 如果该检查返回 True 那么它是一个 UNC 路径，否则它是一个本地路径

# .net - 不同 Web 服务中的相同类型

> ID：520757
> 
> 赞同：5
> 
> 时间：2009-02-06T15:39:14.173
> 
> 标签：.net, wcf, web-services, svcutil.exe

我有一个与这个问题类似的[问题](https://stackoverflow.com/questions/209224/-net-consuming-web-service-identical-types-in-two-different-services)。我有多个使用 WCF 使用的 Web 服务，它们都共享类型。服务本身是用 Java 编写的，我无权访问它们。共享类型具有相同的签名，但`svcutil.exe`在运行时会出现此错误：

```
Error: There was a validation error on a schema generated during export:
    Source:
    Line: 8 Column: 3
   Validation Error: The complexType 'http://MyServer.MyService:CommonType' has already been declared. 
```

在`CommonType`使用的两个 Web 服务中具有相同的签名。我是这样称呼的`svcutil`：

```
svcutil.exe /o:GeneratedServices.cs /n:*,MyNamespace.Generated http://MyServer.MyService1?WSDL http://MyServer.MyService2?WSDL 
```

我知道`wsdl.exe`有`/mergeTypes`标志，它适用于这些服务，但有一些`svcutil.exe`我真的很想使用的选项。我确实有人证明这对我来说是可能的，但是后端也在使用 .NET 和 WCF，而且我使用的 Java 后端一直没有成功。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-01T08:20:25.187

首先 - 它们**完全**一样吗？特别是，SOAP 名称空间必须匹配（除了其他所有内容）。如果不是，那么它们是不同的（不兼容的）类型；您将不得不使用 2 个不同的引用（在不同的 C# 命名空间中以避免冲突），并在两种类型之间转移数据。

如果类型*相同*但它仍然不起作用，那么您也许可以将 /r 开关与 svcutil 一起使用来使用现有程序集中的类型。尝试使用它一次来获取第一个类型（仅来自 1 个 url） - 然后将该代码编译到程序集中。使用 svcutil 对*第二个*端点使用 /r 标志来标识您刚才生成的程序集。

笔记; 一个相关的主题是`partial class`为一种或多种类型编写一个 - 例如，为类型本身提供转换方法/运算符。这可能会使事情变得更简单。例如，您可以在不同命名空间中的两个相似类型之间编写隐式（或显式）静态转换运算符。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T08:51:12.677

用警告（和上下文）扩展答案：不要忘记，svcutil.exe 只是一个工具。您可以修改或扩展生成的代码 - 没有禁止它。当然，自定义生成的代码也有缺点，你应该睁大眼睛去做。

在早期，当通过 Web 服务将异构客户端和服务器装配在一起时，我经常求助于修改生成的 WSDL，修改从 WSDL 生成的代码（在连接 AXIS 和 .NET 时，我编写了许多 sed 脚本来交换命名空间），以及其他定制方法。一些使用时间最长的 Web 服务仍然需要这个。一个例子是 MS Office 研究服务，它根本不提供 WSDL...

另一种可能有效也可能无效的方法是通过部分类扩展生成的 .NET 代码。这是调整 XML 命名空间、添加可选元素（如版本字符串？）以及进行其他调整的好方法。当您重新生成代码时，您的扩展不会被覆盖。

编辑：从反对票来看，有些人认为这太冒险了！！！我完全理解。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-02T02:42:15.990

由于它存在于两个服务中，因此在对这两个服务运行 svcutil 后，您最终会得到两个声明。我认为 svcutil.exe 不够聪明，无法意识到两个 Web 服务中都存在相同的类型。

您可能需要手动消除重复声明。如果它们确实相同，那么您应该能够将其修复为仅使用其中一个并消除另一个。

# php - 使用 PHP / simpleXML 从具有给定参数的 XML 中递归查找所有节点

> ID：520761
> 
> 赞同：0
> 
> 时间：2009-02-06T15:40:04.717
> 
> 标签：php, xml, simplexml

就像我在标题中所说的那样，我想知道是否有可能以及如何递归地解析 XML 文档并返回所有具有给定参数的节点。

我实际上想要做的是加载和 XHTML 文档并返回所有具有等于先前定义值的类的节点（P 节点、DIV 节点等）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-06T15:49:21.033

使用 xpath 查找节点，然后循环：

```
$xml = new SimpleXMLElement($string);
$nodes = $xml->xpath("//*[@class='myclass']");

foreach ($nodes as $node) {
    // ...
} 
```

（实际上没有测试过，但它应该是正确的。）

# sql - SQL 创建表错误

> ID：520776
> 
> 赞同：2
> 
> 时间：2009-02-06T15:42:21.640
> 
> 标签：sql, oracle, create-table

我刚刚开始学习 SQL，并且在第一个障碍中绊倒了，我无法创建表。下面是代码示例。我在运行语句时收到的错误，引用第 7 行，说明“关系运算符”存在问题。**第7 行**的目的是检查此人的年龄是否大于 18。

我正在使用 Oracle（不确定这是否会有所作为）。我希望有人能指出我正确的方向。

```
1\.  CREATE TABLE employee
2\.  (
3\.  empID         VARCHAR2(20) NOT NULL primary key,
4\.  surname       VARCHAR2(15) NOT NULL CHECK(surname=UPPER(surname)),
5\.  deptCode      CHAR(5) NOT NULL CHECK(deptCode=UPPER(deptCode)),
6\.  empYear       NUMBER(1,0) NOT NULL CHECK(empYear >= 1 AND empYear <= 4),
7\.  birthDate     DATE NOT NULL CHECK((SYSDATE - birthDate) /365 ) >= 18
8\.  ); 
```

谢谢你。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-06T15:45:50.103

您不能定义引用 SYSDATE 之类的函数的 CHECK 约束。

Oracle 文档讨论了[对 CHECK 约束的限制](http://download.oracle.com/docs/cd/B19306_01/appdev.102/b14251/adfns_constraints.htm#sthref684)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-06T15:45:20.183

检查你的括号。

```
DATE NOT NULL CHECK(((SYSDATE - birthDate) /365 ) >= 18) 
```

编辑：正如贾斯汀指出的，你不能在这里使用 SYSDATE。

# c# - 检测使用 System.Addin 制作的插件时出现问题

> ID：520777
> 
> 赞同：2
> 
> 时间：2009-02-06T15:42:31.610
> 
> 标签：c#, wpf, plugins, system.addin

我正在使用 System.Addin 为我的应用程序的一小部分创建插件。我目前有两个不同的插件，它们都被正确检测和初始化。我什至可以复制和粘贴创建的插件文件夹，我也会看到它们出现。

当我在调试和发布文件夹中玩耍时，一切都很好。当我尝试将其中一个插件放入安装应用程序的插件文件夹时，问题就出现了。复制的插件永远不会被检测到，即使合约、视图或适配器中没有任何变化。

我尝试从不同安装的软件版本（其中合同仍然相同）复制和粘贴插件。

我发现完成这项工作的唯一方法是复制与插件架构相关的所有文件夹： **AddIns AddInSideAdapters AddInViews Contracts HostSideAdapters HostView.dll**

我猜想复制所有这些 dll 有点违背插件的目的。

新的 System.AddIn 是否有其他人有这些问题？

编辑：插件是使用管道构建器工具创建的

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-30T14:14:38.390

您是否尝试过分析插件商店缓存？也许这就是问题的根源。[在这里](http://msdn.microsoft.com/en-us/library/bb384188.aspx)查看可用的方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-06-19T16:59:26.997

MAF对 HostView、Contract 和 AddInView 程序集的 DLL 版本*非常敏感。*引用 AddInView 接口的特定 DLL 版本的 AddIn 将始终需要该确切版本。同样，AddInAdapter 应该引用 AddInView 的相同 DLL 版本。如果您构建一个新的 AddIn，它必须链接到与 AddInAdapter 链接到的完全相同版本的 DLL。

对于我们的实现，我确保将 HostView、Contract 和 AddInView DLL 打包在单独的 nuget 中，并且这些 VS 项目与我的 AddIn 或适配器不在同一个解决方案中。然后在 HostAdapter、AddInAdapter 和单个插件的 packages.config 中，我确保我们使用元素`allowedVersions`上的属性：`package`

```
 <package id="AddInPipelineSegments.AddInViews.AddinViewV1"
         version="139.37.8.1011"
         allowedVersions="[139.37.8.1011]"
         targetFramework="net451" /> 
```

这可确保不会发生会更改版本的意外 nuget 升级。

# sql - 这个模棱两可的 UPDATE 语句为什么/如何工作？

> ID：520778
> 
> 赞同：3
> 
> 时间：2009-02-06T15:42:59.143
> 
> 标签：sql, database, sql-server-2005, theory

假设您正在对一个表运行 UPDATE 语句，但您放入此基表的信息来自其他一些辅助表。通常，您会加入数据并且不希望 UPDATE 语句的 FROM 子句中的行成倍增加，从而保持一个新行映射到基表中的一个旧行。

但是我想知道如果您的 JOIN 表以某种方式模棱两可会发生什么，就像您不能将每个基本实体映射仅考虑到一个连接实体一样。或者，如果您做了一些荒谬的事情，例如将基表连接到其子表的表，并使用该信息更新基表。它会如何选择？现在每个基表行有多个行。

我在 SQL Server 2005 中运行了这样的语句，它似乎选择了每组中的第一行。但这对我来说似乎是错误的。它不应该引发错误吗？为什么这是理想的行为？

**示例代码**

```
-- normal
-- categories are one-to-many bundles

update bundles_denormalized set category = c.description

from bundles_denormalized b
left join categories c
on b.category_id = c.id

-- ambiguous
-- bundles are one-to-many products

update bundles_denormalized set category = p.description

from bundles_denormalized b
left join products p
on b.id = p.bundle_id 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-06T15:58:50.983

实际上，如果我正确理解了这个问题，它会多次更新该字段，只是因为只有一条记录，所以它最终只有一个值。为什么不会出错？因为语法是正确的，并且数据库无法知道您的意图是什么。你想这样做吗？通常情况下，这就是为什么您应该在运行更新之前选择更新以确保正确记录获得正确的值。

我通常以这种方式编写带有连接的更新：

```
update b    
set category = p.description
--select b.category, p.description
from bundles_denormalized b
left join products p on b.id = p.bundle_id 
```

我也会警惕在更新中使用左连接，因为您可能会将值更改为空值。如果这是你想要的，那没关系，但如果不是，那就不行了。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-06T16:00:22.477

[从 BOL 更新](http://msdn.microsoft.com/en-us/library/ms177523(SQL.90).aspx)

> **将 UPDATE 与 FROM 子句一起使用**
> 
> 如果 UPDATE 语句包含未指定的 FROM 子句，则该语句的结果是未定义的，即，如果 UPDATE 语句不是确定性的，则每个更新的列出现只有一个值可用。例如，在下面脚本的 UPDATE 语句中，Table1 中的两行都满足 UPDATE 语句中 FROM 子句的条件；但未定义 Table1 中的哪一行用于更新 Table2 中的行。
> 
> ```
> USE AdventureWorks;
> GO
> IF OBJECT_ID ('dbo.Table1', 'U') IS NOT NULL
>     DROP TABLE dbo.Table1;
> GO
> IF OBJECT_ID ('dbo.Table2', 'U') IS NOT NULL
>     DROP TABLE dbo.Table2;
> GO
> CREATE TABLE dbo.Table1 
>     (ColA int NOT NULL, ColB decimal(10,3) NOT NULL);
> GO
> CREATE TABLE dbo.Table2 
>     (ColA int PRIMARY KEY NOT NULL, ColB decimal(10,3) NOT NULL);
> GO
> INSERT INTO dbo.Table1 VALUES(1, 10.0);
> INSERT INTO dbo.Table1 VALUES(1, 20.0);
> INSERT INTO dbo.Table2 VALUES(1, 0.0);
> GO
> UPDATE dbo.Table2 
> SET dbo.Table2.ColB = dbo.Table2.ColB + dbo.Table1.ColB
> FROM dbo.Table2 
>     INNER JOIN dbo.Table1 
>     ON (dbo.Table2.ColA = dbo.Table1.ColA);
> GO
> SELECT ColA, ColB 
> FROM dbo.Table2; 
> ```

换句话说，它是一种有效的语法，不会抛出错误或异常。

但与此同时，您无法确定更新值将是 FROM 子句中的第一条或最后一条记录，因为它未定义。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-10-05T14:03:41.047

实际上，我只是注意到它在我的情况下做了一些非常愚蠢的事情。我的意图是创建一个单行选择，但显然有我没想到的重复项。在这种情况下，它实际上将混合数据输入到目标行中，从第一个源行中选择一些列，从第二个源行中选择一些列。

我很确定如果试图做一些像这样模棱两可的事情，Firebird 会抛出异常。但是Firebird根本不支持（非标准？）sntax update X from X join Y ...

# c# - 我可以在 Linq 查询中选择多个对象吗

> ID：520788
> 
> 赞同：39
> 
> 时间：2009-02-06T15:45:21.837
> 
> 标签：c#, linq, list

我可以在一个选择中返回多个项目吗？例如，我有一个固定装置列表（想想足球（或美式足球）固定装置）。每个固定装置包含一个主客队和一个主客场比分。我想得到所有平局的球队。我想使用类似的东西

```
IEnumerable<Team> drew = from fixture in fixtures
                         where fixture.Played && (fixture.HomeScore == fixture.AwayScore)
                         select fixture.HomeTeam && fixture.AwayTeam; 
```

我知道这种语法不正确，我不知道是否可以这样做。我需要两个查询然后将它们连接起来吗？

**编辑：这确实是一门学习的事情，因此以任何特定方式实现这一目标并不重要。基本上，在这个阶段，我想要的只是一个已经抽签的球队名单。一个示例用法可能是，对于给定的赛程列表，我可以找到所有被抽签的球队，这样我就可以将他们在表格中的排名更新 1 分（3 分表示胜利，0 表示失败）。**

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-02-06T15:49:08.990

[101 个 LINQ 示例](http://msdn.microsoft.com/en-us/vcsharp/aa336746.aspx)，即 Select - Anonymous Types 1

```
... select new { HomeTeam = fixture.HomeTeam, AwayTeam = fixture.AwayTeam }; 
```

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-02-06T16:36:40.453

以下将返回一个 IEnumerable<Team>：

```
IEnumerable<Team> drew =
    from fixture in fixtures
    where fixture.Played && (fixture.HomeScore == fixture.AwayScore)
    from team in new[]{fixture.HomeTeam, fixture.AwayTeam}
    select team; 
```

或者，使用流畅的 LINQ 风格：

```
IEnumerable<Team> drew =
    fixtures
    .Where(fxtr => fxtr.Played && (fxtr.HomeScore == fxtr.AwayScore))
    .SelectMany(fixture => new[]{fixture.HomeTeam, fixture.AwayTeam}); 
```

## 展平和平面地图

这个要求通常被称为“扁平化”。也就是说，获取一个 <Collection of <Collections of Things>> 并将其转换为一个 <Collection of Things>。

`SelectMany`两者都映射（一个固定到一个团队数组）和展平（一个团队数组序列到一个团队序列）。它类似于Java和JavaScript等其他语言中的“flatMap”功能。

可以将映射和展平分开：

```
IEnumerable<Team> drew =
    fixtures
    .Where(fxtr => fxtr.Played && (fxtr.HomeScore == fxtr.AwayScore))
    // map 
    .Select(fixture => new[]{fixture.HomeTeam, fixture.AwayTeam})
    // flatten
    .SelectMany(teams => teams); 
```

## 其他方法

### 迭代器块

使用迭代器块也可以实现相同的目的，但我怀疑这很少是最好的方法：

```
IEnumerable<Team> Drew(IEnumerable<Fixture> fixtures){
    var draws = 
      fixtures
      .Where(fxtr => fxtr.Played && (fxtr.HomeScore == fxtr.AwayScore));

    foreach(var fixture in draws){
        yield return fixture.HomeTeam;
        yield return fixture.AwayTeam;
    }
} 
```

### 联盟

联合也是一种选择，但有可能产生与上述不同的结果：

1.  结果的顺序会有所不同。返回所有 Home 结果，然后返回所有 Away 结果。

2.  `Union`枚举了两次固定装置，因此，根据固定装置的实现方式，固定装置有可能在调用之间更新。例如，如果在通话之间添加了新的抽签赛程，则可以返回客队，但不能返回主队。

正如迈克鲍威尔所描述的：

```
IEnumerable<Team> drew =
    ( from fixture in fixtures
      where fixture.Played && (fixture.HomeScore == fixture.AwayScore)
      select fixture.HomeTeam
    ).Union(
      from fixture in fixtures
      where fixture.Played  && (fixture.HomeScore == fixture.AwayScore)
      select fixture.AwayTeam ); 
```

根据固定装置的来源/实现方式，可能值得考虑“缓存”绘制的固定装置以避免必须枚举固定装置两次。

```
var draws = 
    ( from fixture in fixtures
      where fixture.Played  && (fixture.HomeScore == fixture.AwayScore)
      select fixture
    ).ToList();

IEnumerable<Team> drew =
    (from draw in draws select draw.HomeTeam)
    .Union(from draw in draws select draw.AwayTeam); 
```

或者使用流利的风格：

```
var draws = 
    fixtures
    .Where(fxtr => fxtr.Played && (fxtr.HomeScore == fxtr.AwayScore))
    .ToList();

IEnumerable<Team> drew =
    draws.Select(fixture => fixture.HomeTeam)
    .Union(draws.Select(fixture => fixture.AwayTeam)); 
```

### 修改 Fixture 类

可以考虑将“ParticipatingTeams”添加到 Fixture 类以获得：

```
IEnumerable<Team> drew =
    from fixture in fixtures
    where fixture.Played && (fixture.HomeScore == fixture.AwayScore)
    from team in fixture.ParticipatingTeams
    select team; 
```

但正如@MattDeKrey 指出的那样，这需要更改合同。

## 代码示例

[Repl.it](https://repl.it/@codybartfast/SO-Selecting-Multiple-Objects-in-a-Linq-Query)上提供了代码示例

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2009-02-06T15:55:50.210

我认为您正在寻找 Union 方法，如下所示：

```
IEnumerable<Team> drew = (from fixture in fixtures
                     where fixture.Played 
                        && (fixture.HomeScore == fixture.AwayScore)
                     select fixture.HomeTeam)
                     .Union(from fixture in fixtures
                     where fixture.Played 
                        && (fixture.HomeScore == fixture.AwayScore)
                     select fixture.AwayTeam); 
```

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-02-07T19:13:52.977

我自己尝试了一下，我想出了与“取决于”相同的版本。

使用查询理解语法：

```
IEnumerable<Team> drew =
    from fixture in fixtures
    where fixture.Played && (fixture.HomeScore == fixture.AwayScore)
    from team in new[]{fixture.AwayTeam, fixture.HomeTeam}
    select team; 
```

将 lambda 与扩展方法一起使用：

```
IEnumerable<Team> drew =
    fixtures.Where(f => f.Played && f.HomeScore == f.AwayScore)
    .SelectMany(f => new[]{f.HomeTeam, f.AwayTeam}); 
```

**编辑：**我不知道一个团队是否可能在您的数据库中多次参加比赛和抽签，但如果可能的话，那么您可能想要使用`Distinct`查询运算符：

```
IEnumerable<Team> drew =
    (from fixture in fixtures
     where fixture.Played && (fixture.HomeScore == fixture.AwayScore)
     from team in new[]{fixture.AwayTeam, fixture.HomeTeam}
     select team).Distinct(); 
```

或者：

```
IEnumerable<Team> drew =
    fixtures.Where(f => f.Played && f.HomeScore == f.AwayScore)
    .SelectMany(f => new[]{f.HomeTeam, f.AwayTeam})
    .Distinct(); 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-02-06T15:52:18.500

或者您可以定义一个类型来保存所有数据：

```
IEnumerable<TeamCluster> drew = from fixture in fixtures
                         where fixture.Played && (fixture.HomeScore == fixture.AwayScore)
                         select new TeamCluster {
                             Team1 = fixture.HomeTeam,
                             Team2 = fixture.AwayTeam,
                             Score1 = fixture.HomeScore,
                             Score2 = fixture.AwayScore
                         };

class TeamCluster {
    public Team Team1 { get; set; }
    public Team Team2 { get; set; }
    public int Score1 { get; set; }
    public int Score2 { get; set; }
} 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-02-06T15:51:49.220

**编辑：**对不起，误解了你原来的问题，所以重写了答案。

您可以使用“SelectMany”运算符来执行您想要的操作：

```
IEnumerable<Team> drew =
           (from fixture in fixtures
            where fixture.Played && (fixture.HomeScore == fixture.AwayScore)
                  select new List<Team>()
                             { HomeTeam = fixture.HomeTeam,
                               AwayTeam = fixture.AwayTeam
                             }).SelectMany(team => team); 
```

这将返回平局的团队列表。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-10-25T16:05:08.847

我遇到了这个问题，找不到我想要的，所以我写了一个小的扩展方法来做我想要的。

```
public static IEnumerable<R> MapCombine<M, R>(this IEnumerable<M> origList, params Func<M, R>[] maps)
{
    foreach (var item in origList)
    foreach (var map in maps)
    {
        yield return map(item);
    }
} 
```

按照问题中的问题，你会做这样的事情

```
var drew = fixtures.Where(fixture => fixture.Played && 
                        (fixture.HomeScore == fixture.AwayScore))
                    .MapCombine(f => f.HomeTeam, f => f.AwayTeam); 
```

有趣的是，智能感知对此并不完全满意，您不会在下拉列表的顶部看到 lamdba 表达式，但是在“=>”之后它非常高兴。但最主要的是编译器很高兴。

# asp.net-mvc - 哪种模型绑定方法在 ASP.NET MVC 中具有最佳的单元测试语义？

> ID：520793
> 
> 赞同：5
> 
> 时间：2009-02-06T15:46:29.667
> 
> 标签：asp.net-mvc, unit-testing, modelbinders

## 定义

在 ASP.NET MVC 中，有两种方法可以在操作中进行模型绑定。我们将这些称为“绑定参数方式”和“UpdateModel 方式”。他们都做几乎完全相同的事情，而且他们以几乎完全相同的方式做这件事：

```
 public ActionResult UpdateWithBindArguments(Foo model)
    {
        Repository.Update(model);
        // error handling removed
        return RedirectToAction(...)
    }

    public ActionResult UpdateWithUpdateModel()
    {
        Foo model; 
        UpdateModel(model); // part of MVC framework
        Repository.Update(model);
        // error handling removed
        return RedirectToAction(...)
    } 
```

正如我所说，这些几乎完全相同。第一个可能更具可读性，但我可以克服它。

## 两种测试方法

我认为，*重要*的区别在于您*如何*对它们进行单元测试：

```
 [TestMethod]
    public void TestUpdateWithBindArguments()
    {
       var model = new Foo() { PropertyName = "Bar" };
       var controller = new FooController();

       var result = controller.UpdateWithBindArguments(model);

       // assert
    }

    [TestMethod]
    public void TestUpdateWithUpdateModel()
    {
       var formData = new FormCollection() { { "PropertyName", "Bar" } };
       var controller = new FooController();
       controller.ValueProvider = formData.ToValueProvider();

       var result = controller.UpdateWithUpdateModel();

       // assert
    } 
```

第一种方法使用强静态类型构建模型。第二个使用名称/值对构造提交的用户数据。我发现第一种方法更容易阅读，但第二种方法更接近于网站调用控制器时实际发生的情况。

出于这个问题范围之外的原因，我从来没有说服人们应该使用 lambda 表达式而不是字符串来构建 aspx 页面来进行模型绑定。我很乐意与您讨论，但我们不要在这里讨论。出于这个问题的目的，让我们理所当然地认为我将使用内置的 HtmlHelper 方法，这些方法采用字符串而不是采用 lambda 表达式的扩展。因此，第二种方法使用名称/值对作为针对 aspx 页面的“动态”性质的非正式测试具有一定的价值。当然，它不能取代针对站点的集成测试。

## 问题（终于！）

我看到了这两种方法的优点和缺点。我的问题是，是否有一个非常有力的论据支持我缺少的一种方法？

**编辑**我正在寻找客观的答案。我正在寻找为什么一种方法比另一种更好的非显而易见的*原因*，而不是试图进行民意调查。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-07T05:48:10.497

在测试方面，在我看来，将对象直接传递给 action 方法更自然。无需填充 ValueProviderDictionary。

需要其他方法的原因是您可能需要控制要绑定的对象的实例化。DefaultModelBinder 只是查找默认构造函数并调用它。

但在某些情况下，您可能需要在将对象绑定到表单值之前自己创建对象。这就是 UpdateModel 发挥作用的地方。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T16:00:27.797

我会倾向于这样写

```
public ActionResult Update(int id, string name)
{
  Person person = PersonRepository.GetByID(id);
  //Do any error handling
  person.Name = name;
  //Do any error handling
  PersonRepository.Update(person);
} 
```

然后像这样测试（使用RhinoMocks）

```
Person person = new Person();
var mockPersonRepository = MockRepository.GenerateMock<IPersonRepository>();
mockPersonRepository.Expect(x => x.GetByID(1)).Return(person);
mockPersonRepository.Expect(x => x.Update(person));

var controller = new MyController(mockPersonRepository);
controller.Update(1, "Hello");
Assert("Hello", person.Name);
mockPersonRepository.VerifyAllExpectations(); 
```

所以我的回答是，以上都不是:-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-06T17:55:40.607

我总是选择对上下文透明以防止噪音进入测试，所以第一种方法是更好的 IMO。

只是好奇您对用于 HTML 生成的表达式的魔术字符串的喜好。是它们对编译器的不可见性，对重构的抵制，还是您讨厌智能感知。:) 哦，我现在已经完成了，开始了一个题外话辩论。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-07T03:41:53.857

我喜欢绑定到模型对象的第一个选项。这将控制器从模型和视图的细节中解放出来。因此，我可以根据需要更改模型和视图，而不会影响我的控制器。测试隔离也因此变得更容易。

对于复杂的域模型或只关注部分域的视图，我创建了一个视图模型，它对视图中的数据而不是域中的数据进行建模。然后我编写映射代码或使用对象映射器将视图模型映射到我的域模型。这减少了我的视图和我的域之间的耦合。

在将单个参数传递给控制器​​方法时，我将不得不不同意 Peter Morris 的观点。起初这看起来不错，但一旦您开始使用大型表单，很快就会变得很痛苦。此外，这增加了控制器和视图之间的耦合。

# diff - Powerpoint 的差异

> ID：520798
> 
> 赞同：19
> 
> 时间：2009-02-06T15:47:40.040
> 
> 标签：diff, powerpoint

在 Word 中，可以选择比较两个文档并找出两个文档之间的差异。我正在寻找一个类似的功能来比较两个 Powerpoint 文档。理想情况下，它会列出不同的单个幻灯片、版本之间每张幻灯片的差异以及进行更改的时间。但是，我找不到此功能的菜单选项（我使用的是 Office 2007）。我错过了什么吗？

如果 Powerpoint 中没有此功能，是否有第三方工具可以执行此操作？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2013-02-22T14:05:32.487

升级到 Powerpoint 2010 或 2013 并在 Review 选项卡中选择 Compare。看这个视频：

[http://www.youtube.com/watch?v=kYd-B_3V2oo](http://www.youtube.com/watch?v=kYd-B_3V2oo)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-08T18:11:10.340

其他一切都失败了，如果你有 Office 2007，你总是可以将 ppt 保存为 OOXML 文档。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-17T21:21:30.747

显然 PowerPoint 2003 中有一些功能可以比较两个 PowerPoint 文件，但由于我无法访问有效的安装，因此我无法真正了解比较的功能。正如 Ben 所指出的，您可以找到许多 3rd 方工具进行比较。

此功能已在 Office 2007 中停止使用。据我从文档中可以看出，应该使用与 SharePoint 的一些集成，但整个概念与演示差异非常不同。据我了解，您可以对单个幻灯片进行版本控制（具有获取和提交类型的功能），从现有幻灯片创建新的演示文稿，并在您使用的幻灯片被其他用户更改并提交到存储库时收到通知。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-08-11T05:16:22.773

使用 tortoisegit 脚本来区分 office 文档 [http://xcafebabe.blogspot.mx/2012/09/sexy-comparison-of-word-documents-with.html](http://xcafebabe.blogspot.mx/2012/09/sexy-comparison-of-word-documents-with.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-01-02T12:38:25.237

我知道这是一个旧线程，但这个线程对我来说是谷歌上的第一个热门话题，所以也许有人会发现我的解决方案很有用。

我正在使用 Microsoft Office 2010，我发现比较功能有点混乱。我只想逐字比较两个不同的 PPTX 文档，我只是不需要检查文档属性。

所以对我来说，将两个 PPTX 文档都保存为 pdf 格式就足够了，然后使用[DiffPDF Portable](http://portableapps.com/apps/utilities/diffpdf_portable)工具来查看两者之间的差异。

希望这会有用:-)

# r - R 是否有像 Perl 的 qw() 这样的类似引号的运算符？

> ID：520810
> 
> 赞同：23
> 
> 时间：2009-02-06T15:49:48.257
> 
> 标签：r, perl

任何人都知道 R 是否有类似 Perl 的类似引号的运算符`qw()`来生成字符向量？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-07-31T19:37:52.080

不，但你可以自己写：

```
q <- function(...) {
  sapply(match.call()[-1], deparse)
} 
```

只是为了证明它有效：

```
> q(a, b, c)
[1] "a" "b" "c" 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2012-04-04T01:56:45.197

我已经在我的 Rprofile.site 文件中添加了这个函数（看看`?Startup`你是否不熟悉）

```
qw <- function(x) unlist(strsplit(x, "[[:space:]]+"))

qw("You can type    text here
    with    linebreaks if you
    wish")
#  [1] "You"        "can"        "type"       "text"      
#  [5] "here"       "with"       "linebreaks" "if"        
#  [9] "you"        "wish" 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2011-06-28T23:17:07.220

流行的[Hmisc 包](http://biostat.mc.vanderbilt.edu/wiki/Main/Hmisc)提供了`Cs()`执行此操作的功能：

```
library(Hmisc)
Cs(foo,bar)
[1] "foo" "bar" 
```

它使用与哈德利的回答类似的策略：

```
Cs
function (...) 
{
    if (.SV4\. || .R.) 
        as.character(sys.call())[-1]
    else {
        y <- ((sys.frame())[["..."]])[[1]][-1]
        unlist(lapply(y, deparse))
    }
}
<environment: namespace:Hmisc> 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-12-12T08:31:59.693

```
qw = function(s) unlist(strsplit(s,' ')) 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2015-05-15T22:20:48.597

更简单：

```
qw <- function(...){
as.character(substitute(list(...)))[-1]
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-11-05T16:29:26.150

适用于传入向量的情况的片段，例如，`v=c('apple','apple tree','apple cider'). You would get c('"apple"','"apple tree"','"apple cider"')`

```
quoted = function(v){
    base::strsplit(paste0('"', v, '"',collapse = '/|||/'), split = '/|||/',fixed = TRUE)[[1]]
} 
```

# css - jQuery UI 日期选择器 css

> ID：520811
> 
> 赞同：3
> 
> 时间：2009-02-06T15:50:07.147
> 
> 标签：css, jquery-ui, themes

如何将我自己的主题应用于日期选择器，或者至少将 jQuery 的主题应用于它？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-06T15:54:01.570

我建议使用[http://jqueryui.com/themeroller/](http://jqueryui.com/themeroller/)，如果这不能帮助您更深入地了解 ui.datepicker.css 文件和 ui.theme.css 文件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-06T15:57:00.567

我假设您使用的是 jQuery UI 日期选择器。如果是这样，您可以在 jQuery [UI ThemeRoller](http://ui.jquery.com/themeroller/)设计一个自定义主题，然后修改生成的 CSS 文件以根据自己的喜好对其进行调整。您将获得悬停效果的 CSS 和自定义图像。javascript 将生成引用 CSS 文件中的类的代码。

# javascript - 如何检测网页何时加载？

> ID：520812
> 
> 赞同：22
> 
> 时间：2009-02-06T15:50:24.213
> 
> 标签：javascript, html

我想编写一个应用程序来检测页面何时加载到浏览器中，那么我应该能够在加载的网页顶部插入内容吗？有人知道如何做到这一点吗？

请注意，我应该能够在任何浏览器（Firefox/IE）中执行此操作。

我应该使用什么语言来帮助我做到这一点？

如何从外部应用程序中检测到这一点？

我应该如何将它与浏览器集成？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-02-06T15:55:15.140

您将使用 javascript 来执行此操作。如果您不知道如何使用 javascript，我建议您[先阅读](http://eloquentjavascript.net/contents.html)[一些](http://www.w3schools.com/js/default.asp) [教程](https://developer.mozilla.org/en/A_re-introduction_to_JavaScript) 。

对 javascript 有基本的了解后，就可以通过事件来检测页面何时加载完毕`window.onload`。

```
window.onload = function() {
  addPageContents();  //example function call.
} 
```

编辑：如果您想添加多个 onload 函数，并且不使用 javascript 库，您可以包装自己的 onload 处理程序。

```
window.whenloaded = function(fn) {
  if (window.onload) {
    var old = window.onload;
    window.onload = function() {
      old();
      fn();
    }
  } else {
    window.onload = fn;
  }
} 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-02-11T16:18:30.090

为什么不使用监听器？

```
// Everything but IE
window.addEventListener("load", function() {
    // loaded
}, false); 

// IE
window.attachEvent("onload", function() {
    // loaded
}); 
```

这样，您可以根据需要添加任意数量的侦听器，也可以分离它们！`removeEventListener`和`detachEvent`。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-02-06T15:55:31.630

比 onload 更好的是使用现有框架的功能，因为 onload 有时会在所有资源（图像等）加载后做出响应，而不仅仅是页面。

例如 jQuery：

```
$(document).ready( function() {
    // do stuff
}) 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2018-05-18T10:18:04.227

这个有用的链接可以很容易地解决您的问题：[OnLoad W3School](https://www.w3schools.com/jsref/event_onload.asp)

如果要加载状态：

您可以使用**简单的 Javascript来做到这一点**

```
if (document.readyState == "complete") {
    alert("Your page is loaded");
} 
```

**返回值**：一个字符串，表示当前文档的状态。

五个值之一：

*   未初始化 - 尚未开始加载
*   正在加载 - 正在加载
*   已加载 - 已加载
*   交互 - 已加载足够，用户可以与之交互
*   完成 - 满载

有关更多详细信息，请访问[W3Schools-document.readystate](https://www.w3schools.com/jsref/prop_doc_readystate.asp)。

希望这能清除您的想法。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-06T15:52:42.883

在 Javascript 中，您有[onload](http://www.w3schools.com/jsref/jsref_onload.asp)事件。

编辑：一个例子：

```
<html>
  <head>...</head>
  <body onload="doSomethingWhenPageIsLoaded();">
    ...
  </body>
</html> 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-06T15:53:00.247

Javascript 的 OnLoad 事件为你做你想要的。

```
<body onload="somefunc();"> 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-06T15:53:54.660

[使用onLoad()](http://www.w3schools.com/jsref/jsref_onload.asp)事件的 Javascript将在执行之前等待页面加载。

```
<body onload="somecode();" > 
```

如果您使用 jQuery 框架的文档就绪功能，则代码将在加载 DOM 并且在加载页面内容之前加载：

```
$(document).ready(function() {
    // jQuery code goes here
}); 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2020-05-11T18:56:37.507

我知道关于这个话题有很多答案，但我相信最好的解决方案是多个答案的混合，以防你不知道你的脚本什么时候运行（在我的情况下，客户可以粘贴脚本在窗口加载之前或该事件之后）。

```
if (document.readyState == "complete") {
    alert("Your page is loaded");
}else{
    window.addEventListener("load", function() {
        alert("Your page is loaded");
    }, false);
} 
```

您可以创建一个具有此行为的函数并附加一个回调函数来执行您需要的任何操作。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-02-08T20:11:34.050

我更喜欢这个解决方案：

```
 /**
  * The addEventListener() method attaches an event handler to the specified element.
  * @param {*} event Type of the event (like 'load', 'click' or 'onchange' ...)
  * @param {*} obj When the event occurs, an event object is passed to the function as the first parameter. The type of the event object depends on the specified event
  * @param {*} fn Specifies the function to run when the event occurs. 
  */
 function addListener(event, obj, fn) {
    if (obj.addEventListener) {
       obj.addEventListener(event, fn, false);   // modern browsers
    } else {
       obj.attachEvent("on"+event, fn);          // older versions of IE
    }
}

// Thge event emitter will be emitted when page is loaded
addListener('load', window, function(event) {
    alert("Your page is loaded");
}); 
```

当然，你可以添加更多不同`addEventListener`的，例如`click`，`onChange`等等。

# blackberry - 是否有现有黑莓平台与操作系统与模型版本的图表？

> ID：520816
> 
> 赞同：2
> 
> 时间：2009-02-06T15:50:52.573
> 
> 标签：blackberry, platform

是否有现有黑莓平台与操作系统与模型版本的图表？

就像是：

```
Blackberry Storm, platforms: x.x.x - y.y.y, OS versions: x.x.x-y.y.y
Blackberry Bold,  platforms: x.x.x - y.y.y, OS versions: x.x.x-y.y.y
Blackberry Curve, platforms: x.x.x - y.y.y, OS versions: x.x.x-y.y.y 
```

ETC

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-06T16:37:20.623

黑莓论坛可能是最好的查看地点 - 请参阅此处的帖子：http: [//www.blackberryforums.com/rim-software/58404-latest-operating-system-available-each-blackberry-device.html](http://www.blackberryforums.com/rim-software/58404-latest-operating-system-available-each-blackberry-device.html)，这可能不是最新的。

祝你好运！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-11-25T17:21:35.470

维基百科上的这个位置实际上有更好的信息：

[http://en.wikipedia.org/wiki/BlackBerry_OS](http://en.wikipedia.org/wiki/BlackBerry_OS)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-12-14T12:34:18.793

黑莓现在有一个官方页面，他们保存与此非常相似的信息。单击每个操作系统版本以显示支持的设备。

[http://us.blackberry.com/developers/choosingtargetos.jsp](http://us.blackberry.com/developers/choosingtargetos.jsp)

他们说信息每季度更新一次。

**更新：**这个链接已经失效（或重定向到不同的东西）一段时间了。此处保留的答案仅用于历史目的:(

# ruby - 学习树梢

> ID：520818
> 
> 赞同：17
> 
> 时间：2009-02-06T15:51:44.867
> 
> 标签：ruby, parsing, grammar, treetop

我正在尝试自学 Ruby 的 Treetop 语法生成器。我发现，对于那里的“最佳”文档而言，不仅文档非常稀少，而且它似乎不像我希望的那样直观地工作。

在高层次上，我真的很喜欢比现场文档或视频更好的教程，如果有的话。

在较低级别上，这是我根本无法使用的语法：

```
grammar SimpleTest

  rule num
    (float / integer)
  end

  rule float
   (
    (( '+' / '-')? plain_digits '.' plain_digits) /
    (( '+' / '-')? plain_digits ('E' / 'e') plain_digits ) /
    (( '+' / '-')? plain_digits '.') / 
    (( '+' / '-')? '.' plain_digits) 
   ) {
      def eval
        text_value.to_f
      end
   }
  end

  rule integer
    (( '+' / '-' )? plain_digits) {
      def eval
        text_value.to_i
      end
    }
  end

  rule plain_digits
    [0-9] [0-9]*      
  end

end 
```

当我加载它并在一个非常简单的测试对象中运行一些断言时，我发现：

```
assert_equal @parser.parse('3.14').eval,3.14 
```

工作正常，而

```
assert_equal @parser.parse('3').eval,3 
```

引发错误：NoMethodError: private method `eval' called for #

如果我在描述中反转整数和浮点数，整数和浮点数都会给我这个错误。我认为这可能与有限的前瞻性有关，但我在任何文档中都找不到任何信息，甚至无法涵盖在“或”上下文中进行评估的想法

更多信息可能会有所帮助。这是这两个 parse() 块的 pp 信息。

浮子：

```
SyntaxNode+Float4+Float0 offset=0, "3.14" (eval,plain_digits):
  SyntaxNode offset=0, ""
  SyntaxNode+PlainDigits0 offset=0, "3":
    SyntaxNode offset=0, "3"
    SyntaxNode offset=1, ""
  SyntaxNode offset=1, "."
  SyntaxNode+PlainDigits0 offset=2, "14":
    SyntaxNode offset=2, "1"
    SyntaxNode offset=3, "4":
      SyntaxNode offset=3, "4" 
```

Integer... 请注意，它似乎已被定义为遵循整数规则，但未捕获 eval() 方法：

```
SyntaxNode+Integer0 offset=0, "3" (plain_digits):
  SyntaxNode offset=0, ""
  SyntaxNode+PlainDigits0 offset=0, "3":
    SyntaxNode offset=0, "3"
    SyntaxNode offset=1, "" 
```

更新：

我遇到了我的特殊问题，但我不知道为什么：

```
 rule integer
    ( '+' / '-' )? plain_digits
     {
      def eval
        text_value.to_i
      end
    }
  end 
```

这对存在的文档没有意义，但只是删除额外的括号使匹配包括 Integer1 类以及 Integer0。Integer1 显然是持有 eval() 方法的类。我不知道为什么会这样。

我仍在寻找有关树梢的更多信息。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-12-30T04:01:33.460

[您可能会在Treetop 入门](http://po-ru.com/diary/getting-started-with-treetop/)中欣赏 Paul Battley 的漂亮、简单的教程

他从最小的语法开始，展示了如何创建解析器，然后通过几次迭代添加了一些功能。这足以让我脱离起跑线。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-10T16:00:38.377

可悲的是，Treetop 的文档很烂。很多。并且网站上的示例没有帮助。我发现 dzone 有大量的树顶语法：

[树顶文法](http://snippets.dzone.com/tag/Treetop)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-03-22T08:38:54.377

Roland Swingler 向 LRUG 介绍了 Treetop： [http](http://skillsmatter.com/podcast/ajax-ria/treetop) ://skillsmatter.com/podcast/ajax-ria/treetop ，我发现它对入门很有用。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-07-07T13:57:15.530

Citrus 是一种比树梢更轻的替代品：http: [//github.com/mjijackson/citrus](http://github.com/mjijackson/citrus)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-09-06T16:36:26.213

几年前，我遵循了这个[Treetop Introductory Tutorial来了解 treetop 的基础知识。](http://www.trsolutions.biz/blog/2010/03/10/treetop-introductory-tutorial-1-of-10/)

然后[是使用 Treetop 编写解析器的快速介绍](http://thingsaaronmade.com/blog/a-quick-intro-to-writing-a-parser-using-treetop.html)，对我很有用，因为它解释了如何将语法树节点映射到 ruby​​ 类实例。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-09-11T17:16:27.673

我刚刚开始尝试使用 TreeTop。

我试过改变

```
 rule num
      (float / integer)
 end 
```

到

```
 rule num
      (float / integer)
      {
       def eval
            text_value.to_f
       end
      }
 end 
```

它似乎有效。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-11-18T23:22:00.390

这是一个错误。整数规则周围不必要的括号会导致构建一个额外的模块来包含 eval 的定义，并且该模块不会混入节点，因此 'eval' 不可用。如果您比较带有和不带有这些额外括号的版本的 Ruby 代码（使用 tt 命令生成），您可以清楚地看到这一点。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-10-26T04:30:05.527

Treetop 文档似乎假设您已经对*解析表达式语法*(PEG) 有相当多的了解。Treetop 完全基于 PEG。PEG 不仅限于 Treetop，即它们也用于其他解析库。在学习 Treetop 时，我发现学习一般的 PEG 非常有帮助。这有助于填补文档中的许多空白。

# unit-testing - 单元测试无用的项目类型

> ID：520830
> 
> 赞同：10
> 
> 时间：2009-02-06T15:54:40.430
> 
> 标签：unit-testing, tdd

您是否认为必须在任何情况下进行单元测试（和测试驱动开发），或者是否应该有一些例外。我最近一直在研究这样的项目类型，我看不到单元测试将如何有用或改进设计、代码质量等。一种类型的项目是 PDF 报告生成器，它采用汇总数据（已经计算的值和QAed）并将其输出到 PDF 报告文件。另一种类型是使用 3rd 方 ORM 工具的直接 CRUD 应用程序。我可以看到有人可以为使用 CRUD 应用程序的单元测试提出论据，但这是很多不必要且耗时的设置工作，例如在结束时取消对数据库的所有调用和模拟业务对象等您需要知道数据库是否发生了什么事。

谢谢

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-06T16:16:11.853

请不要将作为一种工具的单元测试 (UT) 与作为一种方法论的测试驱动设计 (TDD) 混为一谈。[看到这个更多](https://stackoverflow.com/questions/517977/what-do-you-test-with-your-unit-tests/518165#518165)

另外，请记住，单元测试的好处之一是回归测试，即作为对未来重大更改的保险（并帮助验证已修复的错误不会变为未修复）。

在您的第一个示例中，我将对 PDF 转换进行单元测试，如下所示：

*   从一组已知的样本数据开始，并生成 PDF 文档
*   手动验证生成的 PDF 是否正确
*   保留样本数据和正确的 PDF 文档作为测试套件的一部分
*   编写一个函数来比较两个 PDF 文档的差异（在二进制或内容级别，视情况而定）
*   自动执行此单元测试，以将从样本数据生成的 PDF 文档与第一步中验证正确的文档进行比较

*现在，每当您更改 PDF 生成代码时，您都有一个自动化的单元测试来验证您至少*对于示例数据和输出格式没有中断文档生成。

我使用相同的技术来验证 HTML 呈现的页面、GUI 屏幕等。手动验证基线，然后自动进行比较。这为未来的重大变化提供了保障。

当然，如果您的输出格式经常更改，这可能没有那么有用，但基本输出格式的基线测试可能有很长的生命周期。

在您的第二个示例中，听起来您将测试 3rd-party ORM 工具，这可能毫无意义。但是，根据您使用该工具的方式，一些基线测试可能有助于防范未来的重大变化。例如，不要模拟整个 n 层链（我不喜欢在不必要的时候模拟），只需使用 ORM 工具来创建、读取、更新和删除一个典型的对象/记录，并且使用（测试）数据库上的直接 SQL 语句验证操作。这样，如果第 3 方供应商后来更新了一些破坏了您将了解的基本功能的内容，并且您项目的新开发人员可以轻松地从单元测试示例中了解如何使用 ORM 工具。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-06T16:00:28.140

它通常主要取决于进度限制以及您将如何处理代码。如果您正在编写一次性（许多人会认为无论如何都不存在），我认为不需要单元测试。

但是，如果您正在编写一个可能在未来被重用或重构的模块化软件 - 单元测试非常有帮助。

我经常发现它们的主要目的不是确定当前实现中的错误，而是确保在更改到达时不会引入错误。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-06T15:57:55.867

我从来没有真正遇到过值得麻烦的对应用程序的视图层进行单元测试的策略。

不过，我希望有人能证明我错了。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-02-06T16:00:06.737

套用 Jeff & Joel 最近对 SOB 的评论：当它为您的产品增加价值时，您应该进行单元测试。

在您描述的两种情况下，您将能够以与编写单元测试相同的成本进行大量临时修复（和/或事后回归测试）。所以不要写单元测试。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-02-06T16:07:30.310

“......这是很多不必要且耗时的设置工作，例如停止对数据库的所有调用和模拟业务对象等，而最后您只需要知道数据库是否发生了什么事。”

听起来你在测试错误的东西。

为什么要存根数据库调用？为什么不创建一个测试数据库并针对该测试数据库测试实际的数据库调用呢？[这就是 Django 测试服务器的工作方式，很棒。]

为什么要模拟业务对象？这就是你正在测试的，对吧？可以说“我们假设 ORM 有效”并声明您的“单元”是业务对象 + ORM + 数据库。测试一下，因为这就是问题出现的地方。

单元测试你写的东西。

你下载的东西应该有自己的单元测试。

单元测试可以分层——你可以编写类似集成的测试，假设 ORM 层已经通过了所有的测试。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-06T18:50:12.510

我认为您应该避免对代码不需要工作的项目进行单元测试。

如果您希望代码现在可以正常工作并且希望它在将来有修改时继续工作，那么单元测试非常有用。在这样的项目上，它不仅为自己付出了时间，还节省了时间，但在所有其他项目上，这都是不必要的开销。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-11-12T13:23:16.037

“我曾经听有人说，如果他写了超过 10 行代码而没有经过测试，那么他就会开始不确定自己刚刚写的代码是否能正常工作。”

这个人对他或她自己是危险的。立即从代码中删除它们。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-06T16:01:34.910

我同意瑞恩的观点。唯一有用的单元测试形式是测试某些算法行为的测试，这通常是程序的一小部分。

如果您发现自己正在编写有用的单元测试，那么您的工作可能并不常见 :)

编辑：相反，集成测试通常非常有用，但比单元测试更难自动化。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-06T16:32:43.613

*   例如，为用户界面/表示层编写自动化测试通常不值得麻烦。在这种情况下，通常最好保持表示层非常薄，并拥有一个包含表示层所有功能的可测试层。然后表示层将主要是声明性的，并且只包含简单的胶水代码。当一切都是声明性的时，几乎没有什么可以破坏的，因此没有必要对其进行测试。诸如 UI 元素是否正确对齐、布局是否正确、标签是否正确等内容更容易手动测试。

*   一次性代码。如果代码只使用一次，并且它是否正常工作并不重要，并且如果需要修改代码，您可以负担得起重写它，那么编写高质量的代码和测试可能不会带来好处。但是当代码变得更大，或者你需要维护它，或者代码正常工作很重要时，编写测试是值得的。我曾经听有人说，如果他写了超过 10 行代码而没有经过测试，那么他开始不确定他刚刚写的代码是否能正常工作。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-02-13T16:45:29.270

要回答你的问题，肯定有一些例外。

事实上，我想说自动化白盒测试的有用性更可能是例外而不是规则。

这需要额外的时间，只要有重大变化、减慢和阻碍开发，就必须重写测试。此外，仅仅因为您的测试通过并不能保证您的应用程序正常运行或解决它打算为用户解决的问题。

一段时间以来，带有自动化测试的白盒测试一直是工具箱中的一个工具——最近由于某种原因它风靡一时，如果你公开反对它，你就会在一定程度上被 TDD 狂热者排斥。

更好地理解它，并在可能有用的地方使用它。例如，我的一个朋友是 Microsoft Frarmework 团队的一名 SDET——这是一个很好的例子，说明 TDD 是一项巨大的资产。也就是说，他们正在为数百万人使用的开发环境开发引擎。

对于您运行工厂网络应用程序，甚至是企业级应用程序，我怀疑这种严格性是否值得增加时间和复杂性。但是，如果您有一个将被广泛使用/重复使用的关键组件，那么这些部件等可能是值得的。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2014-01-31T10:27:49.443

我想说的是，一旦您在项目中创建了第一个功能，就需要对其进行单元测试。如果您的代码库完全由副作用代码组成，例如 shell 脚本，您可以执行其他类型的自动化测试，但如果它不是 Esko Luontola 描述的一些一次性代码，您最好编写任何自动化测试而不是最终没有任何。

但是，在完整应用程序的某些区域中，没有自动工具可以为您进行检查。GUI 和在屏幕上呈现的所有内容就是一个例子，因为即使 Selenium 也没有接口来自动检查模态窗口出现的动画是否真的可以播放并且没有故障。您必须使用真人来手动测试这些东西，这是正确 QA 的现实。

您的 PDF 示例存在缺陷，因为您不知道要在 PDF 生成器中测试什么功能集。如果您需要确保已检查的数据将*出现*在生成的 PDF 中，您甚至可以通过文件搜索该数据执行绝对直截了当的操作，例如 grep，因为 PDF 只不过是带有二进制 blob 的文本文件。在其中，在这种情况下您可以安全地跳过它。如果您需要确保*格式*正确，那么目前没有办法自动化它，所以您手动测试它。

在 CRUD 示例中，您没有存根 3rd 方 ORM 工具。您围绕它编写一个包装器，因为在接下来的 2 年中，ORM 工具要么将被更闪亮的东西取代，要么只是接收一些与 BC 不兼容的更新。然后，您专门为此包装器编写全栈集成测试，以确保它满足您的应用程序的需求，然后在所有其他测试中模拟包装器以防止它们依赖于运行时环境。这两种类型的测试对于防止回归和支持重构都至关重要。

总之，我应该指出，如果您完全关心生成的应用程序，那么*无论如何*您都将测试功能的有效性。关键是，每次手动测试应用程序是一场噩梦，导致几乎没有测试。所以你需要自动化测试。为了获得最好的反馈，您希望这些自动化测试尽可能频繁地运行，最好是持续运行。为此，您需要他们快速*发疯*。而要让自动化测试用例快速疯狂，没有比只测试与这个用例相关的东西更好的解决方案了。因此，我们以单元测试定义结束，并且自然而然地做到了。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-06T15:58:19.987

我会说永远不会，仅仅是因为人们可能已经倾向于执行比必要更少的单元测试。如果我们说“可能不需要单元测试”，那么我们就会为各种借口敞开大门……

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-06T16:04:31.143

如果测试返回的值小于开发和执行单元测试的成本，请避免单元测试。这通常归结为一段代码的风险分析和预期生命周期。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-06T16:07:31.277

我正在开发一种与生产机器接口的软件（使用一些行业标准作为通信协议）。因此，通信器类的大多数方法都是由来自机器的消息触发的，它们永远不会从外部调用。所以我把它们设为私有。

如果我想测试这个功能，我需要创建一个模拟机器行为的模拟器，以便在这个类上运行一些黑盒测试。构建模拟器可能需要至少 50% 的时间用于通信器。

我会公开机器触发的功能，但这在我们的团队中引发了一些非常激烈的争论......

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-02-06T20:38:05.350

如果您的代码将被其他人审查或使用，那么应该对其进行测试。如果不是在班级水平，那么在更高的水平。我讨厌人们将他们的代码发送出去进行审查，而他们显然没有花时间去打扰它的工作原理（或者更糟的是甚至没有编译）。

我很少发现任何价值的单元测试（在类级别）。在开发代码时，我可以通过调试器轻松地进行这种测试。我更喜欢测试应该作为一个单元一起工作的类。采用这种方法，我得到了更多的收益。毕竟，我真的不在乎 functionX 是否完全按照我认为它自己应该做的事情做，但在与系统中的其他类一起工作时不做它需要做的事情。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-05-27T17:45:42.977

单元测试可以是 QA 流程的一部分，但不应该是整个 QA 流程。

通常，单元测试用作：

a) 一些 QA**只**使用单元测试，这些过程通常会遗漏很多无法自动测试的麻烦。例如（这并不奇怪），懒惰的 QA 人要求进行现成的单元测试，然后他们可以输入一些值并收工。

b) 其他 QA 用作其他测试的补充。但是，我倾向于（总是？）是多余的。

因此，除非单元测试是无痛的（特别是不要添加或修改代码），否则老派测试是解决方案（无论如何，都应该进行手动测试）。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2018-05-21T19:38:26.397

当编码过程符合所有**精益制造**原则时，单元测试就变得毫无用处。那是：

*   **函数**是最短的（及时）

*   您已经在完成后立即使用最具特色的案例（One Piece Flow）对它们进行了手动**测试**

*   当程序**崩溃**时，它会准确地告诉你它在哪里以及为什么。哪个函数调用了哪个，并且错误消息非常清晰（Jidoka）

*   编程**语言**只能通过显式代码使程序崩溃，就像 Go 编程语言一样（Poka-Yoke）

[自多卡之路](https://i.stack.imgur.com/Wo1GH.gif)

# multithreading - 常见的并发陷阱有哪些？

> ID：520837
> 
> 赞同：34
> 
> 时间：2009-02-06T15:56:29.537
> 
> 标签：multithreading, concurrency, design-patterns

我正在考虑对我们的团队进行并发教育。开发人员陷入围绕并发的最常见陷阱是什么。例如，在 .Net 中，关键字`static`为许多并发问题打开了大门。

是否还有其他非线程安全的设计模式？

## 更新

这里有很多很棒的答案，很难只选择一个作为接受的答案。一定要滚动浏览它们以获得很棒的提示。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-06T20:06:49.283

在这个线程上已经有很多好的答案和指示，但让我补充一件事。

**不要依赖测试来发现比赛条件和死锁**

假设您拥有所有良好的开发流程：每个组件的单元测试，每个夜间构建的冒烟测试，要求每个开发人员的更改在 checkin 之前通过测试等。

这一切都很好，但它导致了一种态度：“好吧，它通过了测试套件，所以它不可能是我的代码中的错误”。这在并发编程中不会很好地为您服务。实时并发错误非常难以重现。您可以在失败之前运行具有竞争条件的代码十亿次。

您将不得不调整您的流程，以更加重视由您最好的头脑进行的代码审查。仅针对并发问题进行单独的代码审查并不是一个坏主意。

您将不得不更加强调使您的应用程序能够自我调试。也就是说，当您在测试实验室或客户站点发生故障时，您需要确保捕获并记录了足够的信息，以便您进行明确的事后分析，因为您能够重现错误报告的可能性在您的便利可以忽略不计。

您将不得不在代码中更加强调偏执的健全性检查，以便在尽可能接近问题的地方检测到故障，而不是在 50,000 行代码之外。

多疑。非常偏执。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-02-06T15:58:56.927

一个是[竞争条件](http://en.wikipedia.org/wiki/Race_condition)，它基本上是假设一段代码将在另一段并发代码之前/之后运行。

也有[死锁](http://en.wikipedia.org/wiki/Deadlock)，即代码 A 等待代码 B 释放资源 Y，而代码 B 等待 A 释放资源 X。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-02-06T16:05:02.873

最大的陷阱之一是首先使用并发。并发性会增加大量的设计/调试开销，因此您确实必须检查问题并查看它是否真的需要并发性。

并发在某些领域肯定是不可避免的，但是当它可以避免时，就避免它。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-02-06T16:35:03.000

我向我的朋友和同事教授了很多并发。以下是一些大陷阱：

*   假设一个主要在多个线程中读取并且只在一个线程中写入的变量不需要锁定。（在 Java 中，这种情况可能会导致读取线程永远看不到新值。）
*   假设线程将以特定顺序运行。
*   假设线程将同时运行。
*   假设线程不会同时运行。
*   假设所有线程都将在任何一个线程结束之前向前推进。

我还看到：

*   `thread_fork()`和之间的大混淆`fork()`。
*   在一个线程中分配内存而在另一个线程中分配内存时会出现混乱`free()`。
*   由于某些库是线程安全的而有些不是，这一事实引起的混乱。
*   人们在应该使用睡眠和唤醒、选择或您的语言支持的任何阻塞机制时使用自旋锁。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2009-02-06T16:13:42.170

并发没有很多陷阱。

然而，同步访问共享数据是很棘手的。

以下是任何编写共享数据同步代码的人都应该能够回答的一些问题：

1.  什么是互锁增量？
2.  为什么 InterlockedIncrement 需要存在于汇编语言级别？
3.  什么是读写重排序？
4.  什么是 volatile 关键字（在 C++ 中），什么时候需要使用它？
5.  什么是同步层次结构？
6.  什么是ABA问题？
7.  什么是缓存一致性？
8.  什么是内存屏障？

“共享一切”并发是一个非常容易泄漏的抽象。改为采用[无共享消息传递。](http://en.wikipedia.org/wiki/Message_passing)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-02-06T20:06:27.987

要记住的一个事实是，即使最初的开发人员让他们的任务模型正常工作（这是一个很大的假设），那么随后的维护团队肯定会以难以想象的方式把事情搞砸。这样做的好处是限制整个系统的并发痕迹。尽你最大的努力确保你的大部分系统都没有意识到并发正在发生。对于不熟悉任务分配模式的人来说，这减少了无意中搞砸事情的机会。

人们经常疯狂地执行线程/任务。一切都在自己的线程上工作。最终结果是几乎每一段代码都必须密切关注线程问题。它迫使原本简单的代码充满了锁定和同步混淆。每次我看到这种情况，系统最终都会变得一团糟。然而，每次我看到这个，最初的开发者仍然坚持这是一个很好的设计:(

就像多重继承一样，如果你想创建一个新的线程/任务，那么假设你错了，直到证明不是这样。我什至无法计算我看到的模式线程 A 调用线程 B 然后线程 B 调用线程 C 然后线程 C 调用 D 都在等待来自前一个线程的响应的次数。代码所做的只是通过不同的线程进行冗长的函数调用。当函数调用正常时不要使用线程。

永远记住，当您想同时工作时，消息队列是您最好的朋友。

我发现创建一个处理几乎所有并发问题的核心基础架构效果最好。如果核心基础设施之外的任何线程必须与另一块软件通信，那么它们必须通过核心基础设施。这样，系统的其余部分就可以保持不知道并发，并发问题可以由希望了解并发的人处理。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-06T16:29:06.773

如其他答案所述，两个最可能的问题是**deadlocks**和**race conditions**。但是我的主要建议是，如果您希望就并发问题对团队进行培训，我强烈建议您**自己进行一些培训**。找一本关于这个主题的好书，不要依赖网站上的几段。一本好书取决于您使用的语言：Brian Goetz 的“Java Concurrency in Practice”对那种语言很有用，但还有很多其他的。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-02-09T08:36:22.657

这一切都归结为共享数据/共享状态。如果您不共享数据或状态，那么您就没有并发问题。

大多数人在想到并发时，都会想到单个进程中的多线程。

考虑这一点的一种方法是，如果将进程拆分为多个进程会发生什么。他们在哪里必须相互交流？如果您可以清楚进程必须在哪里相互通信，那么您就可以很好地了解它们共享的数据。

现在，作为心理测试，将这些多个进程转移到单独的机器上。你的沟通模式仍然正确吗？你还能看到如何让它工作吗？如果没有，可能需要重新考虑多个线程。

（其余的不适用于 Java 线程，我不使用它，因此对此知之甚少）。

另一个可能会被抓住的地方是，如果你使用锁来保护共享数据，你应该编写一个锁监视器来为你找到死锁。然后你需要让你的程序处理死锁的可能性。当您遇到死锁错误时，您必须释放所有锁，备份，然后重试。

如果没有在实际系统中非常罕见的关注级别，您不太可能使多个锁正常工作。

祝你好运！

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-06T17:42:27.607

我看到的 #1 陷阱是过多的数据共享。

我相信处理并发的更好方法之一是多进程而不是线程。这样，线程/进程之间的通信就被严格限制在选择的管道、消息队列或其他通信方式上。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-02-06T16:58:47.087

根据我的经验，许多（熟练的）开发人员缺乏并发理论的基础知识。Tanenbaum 或 Stallings 的经典操作系统教科书很好地解释了并发的理论和含义：互斥、同步、死锁和饥饿。要成功使用并发，必须具备良好的理论背景。

话虽如此，编程语言和不同库之间的并发支持差异很大。此外，测试驱动开发并不能让您在检测和解决并发问题方面走得太远（尽管短暂的测试失败表明并发问题）。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-06T16:03:05.997

这是一个关于并发的很好的资源，特别是在 Java 中： http: [//tech.puredanger.com/](http://tech.puredanger.com/) Alex Miller 列出了在处理并发时可能遇到的许多不同的问题。强烈推荐 ：）

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-06T16:05:59.643

从导致死锁的锁中调用公共类

```
public class ThreadedClass
{
    private object syncHandle = new object();

    public event EventHandler Updated = delegate { };
    public int state = 0;

    public void DoSmething()
    {
        lock(syncHandle)
        {
            // some locked code
            state = 1;

            Updated(this, EventArgs.Empty);
        }
    }

    public int State { 
        get
        {
            int returnVal;
            lock(syncHandle)
                returnVal = state;
            return returnVal;            
        }
    }
} 
```

您无法确定您的客户将要调用什么，他们很可能会尝试读取 State 属性。改为这样做

```
public void DoSmething()
{
    lock(syncHandle)
    {
        // some locked code
        state = 1;
    }
    // this should be outside the lock
    Updated(this, EventArgs.Empty);
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-06T16:25:37.280

至少在 Java 中，双重检查锁定已被[破坏。](http://www.cs.umd.edu/~pugh/java/memoryModel/DoubleCheckedLocking.html)了解为什么这是真的，以及如何解决它，可以让您深入了解并发问题和 Java 的内存模型。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-02-06T16:41:25.797

一些经验法则：

(1) 声明变量时注意上下文

*   写入类属性（**静态**）必须同步
*   写入实例属性必须同步
*   尽可能将所有变量保持在本地（除非有意义，否则不要将它们放在成员上下文中）
*   标记只读不可变的变量

(2) 锁定对可变类或实例属性的访问：属于同一个不变量的[变量](http://en.wikipedia.org/wiki/Invariant_(computer_science) "不变量")应该受到同一个锁的保护。

(3) 避免[双重检查锁定](http://en.wikipedia.org/wiki/Double-checked_locking)

*(4) 运行分布式*操作（调用子程序）时保持锁。

(5) 避免[忙着等待](http://en.wikipedia.org/wiki/Busy_waiting)

(6) 在同步部分保持低工作量

(7) 当你在同步块中时，不要让客户端控制。

(8) 评论！这确实有助于理解其他人在声明此部分同步或该变量不可变时的想法。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-02-09T08:08:16.360

并发编程的一个缺陷是**不正确的封装会导致竞争和死锁**。这可能会以多种不同的方式发生，尽管我特别看到了两种：

1.  **给变量不必要的广泛范围。**例如，有时人们会在本地范围内声明一个变量在实例范围内。这可以为不需要存在的比赛创造潜力。

2.  **不必要地暴露锁。**如果不需要暴露锁，则考虑将其隐藏起来。否则客户端可能会使用它并创建您本可以阻止的死锁。

这是上面 #1 的一个简单**示例**，它与我在生产代码中看到的非常接近：

```
公共类 CourseService {
    私人 CourseDao courseDao；
    私人名单课程；

    公共列表 getCourses() {
        this.courses = courseDao.getCourses();
        返回 this.courses;
    }
}

```

在这个例子中，变量不需要`courses`有实例范围，现在并发调用`getCourses()`可以有竞争。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-10-17T12:40:43.987

刚刚发现这篇论文，听起来很有趣：[A Study of Common Pitfalls in Simple Multi-Threaded Programs](http://www.elewis.net/papers/cse00.pdf)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-02-06T16:00:36.423

一些典型的陷阱是[死锁](http://en.wikipedia.org/wiki/Deadlock)（两个竞争进程卡住等待对方释放一些资源）和[竞争条件](http://en.wikipedia.org/wiki/Race_condition)（当事件的时间和/或依赖性可能导致意外行为时）。这里还有一个[关于“多线程陷阱”的有价值的视频](http://www.dnrtv.com/default.aspx?showNum=4)。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-02-06T16:14:54.680

您还可以查看进程外类型的并发问题
，例如：
编写文件的写入进程和声明文件的消费者进程。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-02-17T09:53:59.670

可组合性。在任何重要的系统中，不同子系统内同步的特殊方法使它们之间的交互通常容易出错，有时甚至是不可能的。请参阅[此视频](http://content.digitalwell.washington.edu/msr/external_release_talks_12_05_2005/14068/default.htm)，了解即使是最琐碎的代码也容易出现这些问题的示例。

就个人而言，我是[并发计算](http://en.wikipedia.org/wiki/Actor_model_and_process_calculi)（异步类型）的 Actor 模型的转换者。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-02-06T16:18:21.567

并发问题非常难以调试。作为一种预防措施，可以在不使用互斥锁的情况下完全禁止访问共享对象，这样程序员就可以轻松地遵循规则。我已经看到通过围绕操作系统提供的互斥锁和信号量等进行包装来完成此操作。

以下是我过去的一些令人困惑的例子：

我曾经为 Windows 开发打印机驱动程序。为了防止多个线程同时写入打印机，我们的端口监视器使用了这样的结构： // 伪代码，因为我不记得 API BOOL OpenPort() { GrabCriticalSection(); } BOOL ClosePort() { ReleaseCriticalSection(); } BOOL WritePort() { writestuff(); }

不幸的是，对 WritePort 的每次调用都来自假脱机程序线程池中的不同线程。我们最终遇到了 OpenPort 和 ClosePort 被不同的线程调用，导致死锁的情况。这个问题的解决方案留作练习，因为我不记得我做了什么。

我也曾经在打印机固件上工作。在这种情况下，打印机使用称为 uCOS（发音为“粘液”）的 RTOS，因此每个功能都有自己的任务（打印头电机、串行端口、并行端口、网络堆栈等）。该打印机的一个版本有一个内部选项，可插入打印机主板上的串行端口。在某个时候，发现打印机会从该外围设备读取相同的结果两次，之后的每个值都会乱序。（例如，外围设备读取序列 1,7,3,56,9,230 但我们会看到 1,7,3,3,56,9,230。这个值被报告给计算机并输入数据库，所以有一堆ID 号错误的文档数量非常糟糕）其根本原因是未能尊重保护设备读取缓冲区的互斥锁。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2009-02-13T19:07:45.560

这不是一个陷阱，而是更多基于其他人的回应的提示。.NET 框架的 readerwriterlockslim 在许多情况下会显着提高您的性能，而不是“lock”语句，同时是可重入的。

# php - Web应用的瓶颈？

> ID：520858
> 
> 赞同：2
> 
> 时间：2009-02-06T16:00:34.787
> 
> 标签：php, ruby-on-rails

这个问题与 Ruby on Rails 和 PHP 有关。在为 Web 应用程序寻找 VPS 主机时（还没有决定用 2 种语言中的哪一种来编写它），我应该更多地考虑什么？内存还是CPU？我知道您需要在两者之间取得公平的平衡，但我会首先遇到哪面墙？

我确定这取决于应用程序正在执行的工作类型，在我的情况下它是正常的 CRUD。我的猜测是记忆，但我只是想确定一下。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-06T16:03:42.707

我认为 DBMS 和您将要进行的查询的性质/数量将是这里最重要的考虑因素，而不是与所使用的语言有关的任何事情。（假设数据库在同一台服务器上）

除非您有一个非常小的数据集，否则内存可能会在 CPU 之前受到限制。

此外，您还没有真正指定所提供的组合是什么 - 所以很难给出答案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T16:03:20.273

我早在 CPU 问题之前就遇到了内存问题，但是我在与 Web 前端相同的 VPS 上运行 SQL 服务器。在我支付升级费用之前，存在一些严重的内存问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-06T16:04:29.130

只要您可以将其保持缓存，您只需计算/获取一次，但这实际上取决于您的 Web 应用程序的动态程度。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-06T16:05:44.883

在普通的 crud 应用程序上，您将在 cpu 墙之前遇到内存墙方式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-06T16:06:09.783

让 MySQL 将其用于缓存的更多内存将为您带来巨大的性能改进。将它与良好的数据库设计相结合，避免构建大型昂贵的对象数组，并且您应该遇到任何 CPU 问题......好吧，除非您正在执行 CPU 密集型聚合或一些复杂的逻辑。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-06T16:22:52.433

我认为您将遇到的第一面墙与数据库连接有关。很可能，首先让你慢下来的不是内存短缺或 CPU 资源，而是浪费时间打开、关闭数据库连接以及等待可用的数据库连接。如果可以，请尝试确保在应用程序中使用连接池。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-06T16:24:36.033

实际上，根据我的经验，在 VPS 上运行网络服务器时遇到的第一个瓶颈是带宽。要么使实际带宽饱和，要么用尽 VPS 上允许的打开套接字/连接。除非您的主机允许您购买更多带宽，否则前者您无能为力，但后者至少通常可以由托管公司进行调整。在带宽之后，内存是我遇到的下一个限制，主要来自与 MySQL、Apache 等同时运行 SpamAssassin。我通过升级到具有更多可用内存的下一级计划解决了这个问题。

If you haven't already selected a hosting company, I can recommend [**Tektonic**](http://www.tektonic.net). The prices can't be beat and if you get the middle or higher level plans they have a decent amount of RAM and CPU. Bandwidth is not metered, you're capped by actual capacity instead so if you find yourself short on bandwidth you'll probably have to pay for additional capacity, as with any host.

# java - 在线程之间传递工作项 (Java)

> ID：520860
> 
> 赞同：5
> 
> 时间：2009-02-06T16:00:44.800
> 
> 标签：java, multithreading

我有两个线程。生产者正在生产数据片段（字符串对象），消费者在其中处理这些字符串。问题是我的应用程序只需要处理最新的数据对象。换句话说，如果生产者设法产生两个字符串“s1”，然后是“s2”，那么我希望消费者只处理“s2”。“s1”可以安全地丢弃。

当然，实现实现这种行为的类没有问题，但我想使用 java.util.concurrent 中的标准机制（如果存在这样的机制）。请注意，SynchronousQueue 不是一个好的解决方案：消费者在将“s1”入队时会阻塞，并且不会有机会产生“s2”。

（简而言之，我正在寻找具有阻塞删除操作和非阻塞集合操作的单元素集合）

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-06T16:08:34.257

我认为您最好的答案可能是使用 ArrayBlockingQueue，其中生产者（您只有一个生产者，对吗？）在添加新元素之前删除任何现有元素。

当然，在这个实现中存在竞争条件：消费者可以在生产者删除元素之前开始处理它。但无论您使用何种数据结构，这些竞争条件将始终存在。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-06T16:16:20.463

[交换器](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/Exchanger.html)类呢？这是线程之间交换对象的标准方式。用你的类专门化它，可能是一个字符串列表。让消费者只使用第一个/最后一个。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-06T16:05:56.647

您可以为此使用大小为 1 的数组：

```
String[] oeq = new String[1]; 
```

样本来源：

```
public class Test {
    private static final String[] oeq = new String[1];
    public static void main(String[] args) {
        (new Producer()).start();
        (new Consumer()).start();
        (new Consumer()).start();
        (new Consumer()).start();
        (new Consumer()).start();
        (new Consumer()).start();
        (new Consumer()).start();
    }

    private static class Producer extends Thread {
        public void run() {
            int i=0;
            while(true) {
                i++;
                synchronized(oeq) {
                    oeq[0] = ""+i;
                    oeq.notifyAll();
                }
            }
        }
    }

    private static class Consumer extends Thread {
        public void run() {
            String workload = null;
            while(true) {
                synchronized(oeq) {
                    try {
                        oeq.wait();
                    } catch(InterruptedException ie) {
                        ie.printStackTrace();
                    }
                    if(oeq[0] != null) {
                        workload = oeq[0];
                        oeq[0] = null;
                    }
                }
                if(workload != null) {
                    System.out.println(workload);
                }
            }
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-07T01:54:51.903

好吧，如果你只想要最近生成的字符串，那么你根本不需要队列——你只需要一个字符串引用：生产者设置它，消费者读取它。如果消费者花了很长时间阅读它以至于生产者重新设置它......那又怎样？

设置和读取引用是原子的。唯一的问题是，如果您希望以某种方式通知消费者有可用的字符串。但即便如此......如果消费者正在做一些需要一段时间的事情，那么你真的不需要来自并发库的任何花哨的东西。

请注意，顺便说一句，此示例适用于任意数量的生产者和/或消费者线程。

```
import java.util.Random;

public class Example {
    public static void main(String[] av) {
        new Example().go();
    }

    Object  mutex       = new Object();
    String  theString   = null;

    void go() {
        Runnable producer = new Runnable() {
            public void run() {
                Random rnd = new Random();
                try {
                    for (;;) {
                        Thread.sleep(rnd.nextInt(10000));
                        synchronized (mutex) {
                            theString = "" + System.currentTimeMillis();
                            System.out.println("Producer: Setting string to " + theString);
                            mutex.notify();
                        }
                    }
                } catch (InterruptedException e) {
                    // TODO Auto-generated catch block
                    e.printStackTrace();
                }

            }
        };

        Runnable consumer = new Runnable() {
            public void run() {
                try {
                    String mostRecentValue = null;
                    Random rnd = new Random();
                    for (;;) {
                        synchronized (mutex) {
                            // we use == because the producer
                            // creates new string
                            // instances
                            if (theString == mostRecentValue) {
                                System.out.println("Consumer: Waiting for new value");
                                mutex.wait();
                                System.out.println("Consumer: Producer woke me up!");
                            } else {
                                System.out.println("Consumer: There's a new value waiting for me");
                            }
                            mostRecentValue = theString;
                        }
                        System.out.println("Consumer: processing " + mostRecentValue);
                        Thread.sleep(rnd.nextInt(10000));
                    }
                } catch (InterruptedException e) {
                    // TODO Auto-generated catch block
                    e.printStackTrace();
                }
            }
        };

        new Thread(producer).start();
        new Thread(consumer).start();
    }
} 
```

# asp.net-mvc - 在电子邮件中发送 asp.net mvc 操作结果

> ID：520863
> 
> 赞同：22
> 
> 时间：2009-02-06T16:01:15.753
> 
> 标签：asp.net-mvc, template-engine

我想在 asp.net mvc 中使用我的 Action 作为模板引擎，生成字符串形式，我可以通过电子邮件发送。

伪代码：

```
public ActionResult Register()
{
    SendEmail(View().ToString());

    return new EmptyResult();
} 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-06T17:11:32.227

首先，您可能仍然希望从您的操作中返回一个视图，因此返回 EmptyResult 并不是最好的；但是当您在注册过程中处理页面流时，您会发现这一点。

我假设您希望使用已创建的视图创建 HTML 电子邮件。这意味着您希望得到如下所示的结果：

```
public ActionResult CreateEmailView(RegistrationInformation info)
{
  var userInformation = Membership.CreateNewUserLol(info);
  return View(userInformation)
} 
```

并将其作为电子邮件的正文发送。你可以重用你的观点和所有有趣的东西。

您可以通过创建自定义 ActionResult 并使用它来生成文本来利用该框架。

这是一些可能实际编译和工作的类似 c# 的伪代码。一、自定义ActionResult：

```
public class StringResult : ViewResult
{
    public string Html { get; set; }
    public override void ExecuteResult(ControllerContext context)
    {
        if (context == null)
        {
            throw new ArgumentNullException("context");
        }
        if (string.IsNullOrEmpty(this.ViewName))
        {
            this.ViewName = 
                 context.RouteData.GetRequiredString("action");
        }
        ViewEngineResult result = null;
        if (this.View == null)
        {
            result = this.FindView(context);
            this.View = result.View;
        }
        ViewContext viewContext = new ViewContext(
                context, this.View, this.ViewData, this.TempData);
        using (var stream = new MemoryStream())
        using (var writer = new StreamWriter(stream))
        {
            // used to write to context.HttpContext.Response.Output
            this.View.Render(viewContext, writer);
            writer.Flush();
            Html = Encoding.UTF8.GetString(stream.ToArray());
        }
        if (result != null)
        {
            result.ViewEngine.ReleaseView(context, this.View);
        }
    }
} 
```

这将覆盖基本方法的 ExecuteResult（这是我正在覆盖的基本方法的代码；可能在 RC1 中已更改）以呈现到我控制的流而不是响应的输出流。因此，它准确地提取文本将如何呈现给客户端计算机。

接下来，您将如何在控制器操作中使用它：

```
public ActionResult CreateEmailView(RegistrationInformation info)
{
  var userInformation = Membership.CreateNewUserLol(info);
  // grab our normal view so we can get some info out of it
  var resultView = View(userInformation);

  // create our string result and configure it
  StringResult sr = new StringResult();
  sr.ViewName = resultView.ViewName;
  sr.MasterName = resultView.MasterName;
  sr.ViewData = userInformation;
  sr.TempData = resultView.TempData;
  // let them eat cake
  sr.ExecuteResult(this.ControllerContext);
  string emailHtml = sr.Html;
  // awesome utils package, dude
  Utils.SendEmailKThx(userInformation, emailHtml);

  return resultView;
} 
```

我正在渲染相同的视图两次；我第一次将它渲染到流中，第二次我正常渲染它。可能会潜入其他地方的 ViewResult 调用链并更改 Render 的操作方式，但粗略地看一下代码并没有发现任何东西。虽然框架非常好，但部分流程的调用堆栈的粒度不够细，无法轻松更改流程中的单个步骤。如果他们将 ExecuteResult 分解为几个不同的可重写方法，我们可以将其从渲染到输出流更改为渲染到我们的流，而无需重写整个 ExecuteResult 方法。那好吧....

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-08T04:22:05.867

我没有足够的代表发表评论，但我认为我可以通过指出似乎已接受的答案可行并且如果可行的话会很棒，从而节省人们一些时间。但是，似乎 WebForm 视图引擎只是吃掉了 TextWriter 参数。这里有更多信息：http: [//ayende.com/Blog/archive/2008/11/11/another-asp.net-mvc-bug-rendering-views-to-different-output-source.aspx](http://ayende.com/Blog/archive/2008/11/11/another-asp.net-mvc-bug-rendering-views-to-different-output-source.aspx)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-03-04T17:52:41.877

[http://www.brightmix.com/blog/renderpartial-to-string-in-asp-net-mvc/](http://www.brightmix.com/blog/renderpartial-to-string-in-asp-net-mvc/)有一个很好的解决方案，可以将视图呈现为字符串，以便您可以通过电子邮件发送它。他指出，“谢天谢地，渲染字符串的局部视图变得非常容易。”

```
/// Static Method to render string - put somewhere of your choosing
public static string RenderPartialToString(string controlName, object viewData)
{
     ViewDataDictionary vd = new ViewDataDictionary(viewData);
     ViewPage vp = new ViewPage { ViewData = vd };
     Control control = vp.LoadControl(controlName);

     vp.Controls.Add(control);

     StringBuilder sb = new StringBuilder();
     using (StringWriter sw = new StringWriter(sb))
     {
         using (HtmlTextWriter tw = new HtmlTextWriter(sw))
         {
             vp.RenderControl(tw);
         }
     }

     return sb.ToString();
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-06T16:59:10.050

您无法在控制器内部看到视图本身。执行您要求的方法是编写自定义 ActionResult 子类和自定义 ViewEngine 来处理它。覆盖 ExecuteResult 以实际发送电子邮件。查看开源的 Spark、NHAML 等，查看 MVC 的引擎示例。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-24T01:06:08.070

嘿，威尔，从我正在阅读的内容（以及我自己实现您的解决方案的尝试）来看，View.Render 方法完全忽略了 writer 参数。我的作者的内容总是空的，而是渲染的视图被脱口而出到响应流中。因此，让你使用你的观点似乎是不可能的（或者至少是令人费解的）。我认为在您的测试用例中，您会看到两次渲染视图，并且您的电子邮件将是空白的。

我在这里找到了一些讨论：http: [//ayende.com/Blog/archive/2008/11/11/another-asp.net-mvc-bug-rendering-views-to-different-output-source.aspx](http://ayende.com/Blog/archive/2008/11/11/another-asp.net-mvc-bug-rendering-views-to-different-output-source.aspx)

# python - 有人在 Cygwin 上安装 MySQLdb for Python 吗？

> ID：520865
> 
> 赞同：10
> 
> 时间：2009-02-06T16:01:35.580
> 
> 标签：python, mysql, cygwin

我正在尝试在 Cygwin 上安装 MySQLdb for python。不幸的是，当我运行时`python setup.py build`，我收到以下错误：

```
$ python setup.py build
/bin/sh: /usr/local/bin/mysql_config: No such file or directory
Traceback (most recent call last):
  File "setup.py", line 16, in <module>
    metadata, options = get_config()
  File "/home/Ben/python/MySQL-python-1.2.2/setup_posix.py", line 43, in get_config
    libs = mysql_config("libs_r")
  File "/home/Ben/python/MySQL-python-1.2.2/setup_posix.py", line 24, in mysql_config
    raise EnvironmentError, "%s not found" % mysql_config.path
EnvironmentError: /usr/local/bin/mysql_config not found 
```

显然我没有`mysql_config`安装，我猜这是问题所在。MySQLdb 的自述文件中提到了这一点，但它没有解释如何绕过它或如何安装 mysql_config。

所以也许这很简单：如何`mysql_config`为 Cygwin 安装？

或者可能比这更难。

仅供参考：我有 python 2.5.2 和 MySQL 5.1.30，在 Cygwin 下运行。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2013-07-04T11:03:46.097

我是怎么做到的：

首先我安装了[`apt-cyg`](https://github.com/transcode-open/apt-cyg). 接着就，随即：

```
# apt-cyg install gcc            # older name
apt-cyg install gcc-core         # as of 2015
apt-cyg install python-setuptools
easy_install pip
pip install -U mysql-python 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2015-05-24T01:54:37.463

首先，安装 apt-cyg：

```
lynx -source rawgit.com/transcode-open/apt-cyg/master/apt-cyg > apt-cyg`
install apt-cyg /bin 
```

现在，使用 apt-cyg 安装 mysql-devel：

```
apt-cyg install libmysqlclient-devel 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-06T16:48:26.717

你需要 mysql-devel，如果它可用于 cygwin，或者你需要从源代码构建 mysql。

您最好的选择可能是自己编译 MySQL 客户端，以获得编译 MySQLdb 所需的头文件。请参阅有关类似 Perl DB 驱动程序的[注释。](http://cpansearch.perl.org/src/CAPTTOFU/DBD-mysql-3.0000/INSTALL.html#windows_cygwin)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-12-09T01:52:00.637

使用上述说明构建 MySQL 后，您需要执行以下操作来构建和安装 MySQLdb：

1.  [在此处](http://pypi.python.org/pypi/setuptools#files)下载 Python 'setuptools' 包（例如：setuptools-0.6c11-py2.6.egg）。你需要它来运行 MySQL-python 附带的 setup.py。
2.  使用同一页面上的说明安装 setuptools（您只需像运行 shell 脚本一样运行它）。
3.  [在此处](http://sourceforge.net/projects/mysql-python/)下载 MySQL-python （例如：MySQL-python-1.2.3.tar.gz）。
4.  展开存档，您将在 README 文件中找到安装说明。
5.  使用 README 文件中的说明构建和安装 MySQL-python。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-10-27T06:06:41.003

尝试后得到同样的错误 `pip install mysql-python`。我有 Win7 x64 + Cygwin x86 2.830 + Django 1.5.5 + Python 2.7。

所以我运行了 Cygwin 设置并下载了`libmysqlclient-devel`：MySQL 数据库客户端库（开发），然后就完成了！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-11-23T19:19:45.507

我按照[此评论](http://phaseshiftllc.com/archives/2008/10/26/installing-mysql-gem-on-windows-cygwin-for-rails#comment-86)的说明在 Cygwin 上安装了 MySQL。我不得不使用可以从[这里](http://downloads.mysql.com/archives.php?p=mysql-5.1&o=other)下载的 5.1.35 版本，因为最新的 (5.1.41) 无法构建。

这是我使用的命令行：

./configure --without-libedit --without-readline --without-server CFLAGS=-O2`

# java - Oracle jdbc 驱动程序的 Hibernate 的 setFirstResult() 问题

> ID：520869
> 
> 赞同：9
> 
> 时间：2009-02-06T16:02:41.880
> 
> 标签：java, oracle, hibernate, jdbc

我正在尝试使用 Hibernate 进行分页，`setFirstResult()`但是`setMaxResults()`将第一个结果设置为 0 时我没有得到预期的结果。

执行以下操作时：

```
Query query = session.createQuery(queryString);  
query.setFirstResult(0);  
query.setMaxResults(30);  
List list = query.list();  //list.size() returns 10 
```

但是如果我将第一个结果设置为 1（或任何不同于 0 的值）：

```
query.setFirstResult(1);  
query.setMaxResults(30);  
List list = query.list();  //list.size() returns 30 
```

我读到这是 jdbc 驱动程序中的一个已知错误，但我搜索了解决方案，但似乎找不到。有没有人遇到过类似的事情并找到了解决方法？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-06T19:44:33.260

显然添加`setFetchSize()`可以解决问题。所以像这样的东西现在可以完美地工作：

```
query.setFirstResult(0);  
query.setMaxResults(30);  
query.setFetchSize(30);  
List list = query.list(); //list.size() now returns... wait for it... 30 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-01-23T06:05:56.383

另一个解决方案是实现您自己的 Oracle 方言：

```
public class Oracle10gDialectLimitBugfix extends Oracle10gDialect {
    @Override
    public boolean forceLimitUsage() {
        return true;
    }
} 
```

见[https://forum.hibernate.org/viewtopic.php?p=2379096](https://forum.hibernate.org/viewtopic.php?p=2379096)

更新：它似乎已在 Oracle 11.2.0.1.0 中修复

# tfs - 在 TFS 中，我可以获得用户在给定日期范围内接触的所有文件的列表吗？

> ID：520877
> 
> 赞同：2
> 
> 时间：2009-02-06T16:04:27.290
> 
> 标签：tfs

在 TFS 中，我想查看一天/一周/等修改了多少文件。

这可能吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-06T20:53:42.590

是的。您甚至可以获得精美的图表 :-) 您可以使用存储此数据的 TFS 数据仓库，也可以使用 TFS 命令行 ( [tf.exe](http://msdn.microsoft.com/en-us/library/z51z7zy0(VS.80).aspx) )。 [tf history](http://msdn.microsoft.com/en-us/library/yxtbh4yh(VS.80).aspx)将是您为获取有关历史记录的详细信息而执行的命令，请参阅我写的关于从 Excel 访问 TFS 数据仓库信息的以下博客文章：

[http://www.woodwardweb.com/vsts/getting_started.html](http://www.woodwardweb.com/vsts/getting_started.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-04-23T21:28:18.447

来自[http://msdn.microsoft.com/en-us/library/yxtbh4yh(v=vs.100).aspx](http://msdn.microsoft.com/en-us/library/yxtbh4yh(v=vs.100).aspx)：

从工作区的根目录执行所有命令：

显示我对 2000 年的更改：（如果 MM/dd/yyyy 不适合您，您可能需要使用本地日期格式）

```
tf history . /r /noprompt /version:D"01/01/2000"~D"01/01/2001" /user:me 
```

# python - 如何在 Python 中将数字列表转换为 html？

> ID：520881
> 
> 赞同：0
> 
> 时间：2009-02-06T16:05:16.570
> 
> 标签：python

嘿伙计们，我的最后一个问题^^说我有一个包含html的字符串，比如

```
html = '<td class="p11_666699"><strong>100</strong></td>' 
```

和一个像

```
numbers = [100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 
           113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125,
           126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138,
           139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150] 
```

基本上我想做这样的事情：

```
html = '<td class="p11_666699"><strong>' + numbers + '</strong></td>' 
```

编辑：由于某种原因，当我发布此代码时，代码标签会添加大括号，所以它搞砸了，对不起。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-06T16:17:03.990

正如评论中所指出的，很难理解你的问题......但如果你想生成一堆表格单元格，每个单元格都包含一个数字，请使用如下内容：

```
html = ''.join('<td>%d</td>' % n for n in numbers) 
```

当然，如果需要，您可以添加`class`要应用于表格单元格的属性或其他属性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-06T16:16:28.763

我想你要么想要这个：

```
numbers = [100, 101, 102, 103]
output = "<td>" + ", ".join(map(str, numbers)) + "</td>" 
```

或者

```
output = ""
for number in numbers:
    output += "<td>" + str(number) + "</td>" 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-06T16:14:01.250

您是否正在寻找一种将数字列表加入字符串的方法？这将起作用：

```
' '.join(map(str, [10, 20, 30])) 
```

导致：

```
'10 20 30' 
```

的第二个参数`map`是一个列表，因此您可以将“数字”列表放在那里。

当然，这绝不是特定于 HTML 的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-06T16:18:40.180

```
html = ['<td class="p11_666699"><strong>%d</strong></td>' % number for number in numbers] 
```

我看到大卫刚刚提出了这个建议（但加入了）。

# c++ - 头文件中的 C/C++ 私有数组初始化

> ID：520893
> 
> 赞同：4
> 
> 时间：2009-02-06T16:06:44.273
> 
> 标签：c++, arrays, header, initialization

我有一个名为 Cal 的类，它是 .cpp 和 .h 对应的

头文件有

```
class Cal {
    private:
        int wa[2][2];

    public:
        void do_cal();
}; 
```

.cpp 文件有

```
#include "Cal.h"
void Cal::do_cal() {
   print(wa) // where print just itterates and prints the elements in wa
} 
```

我的问题是如何初始化数组`wa`？我似乎无法让它工作。

我试过：

```
int wa[2][2] = {
                {5,2},
                {7,9}
               }; 
```

在头文件中，但我收到错误消息说我不能这样做，因为它违反了 iso..something。

还尝试`wa`在构造函数中初始化数组，但这也不起作用。我错过了什么？

谢谢

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-06T18:50:57.483

如果它可以是静态的，则可以在 .cpp 文件中对其进行初始化。在类声明中添加 static 关键字：

```
class Cal {
    private:
        static int wa[2][2];
    public:
        void do_cal();
}; 
```

并在 .cpp 文件的文件范围内添加：

```
#include "Cal.h"
int Cal::wa[2][2] = { {5,2}, {7,9} };
void Cal::do_cal() {
   print(wa) // where print just itterates and prints the elements in wa
} 
```

如果你从不改变它，这会很好用（连同使它成为常量）。但是，您只能获得与您班级的每个实例共享的一个。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-06T16:12:49.567

您不能在类声明中初始化数组元素。我最近试图找到一种方法来做到这一点。根据我所学到的，您必须在初始化函数中执行此操作，一次一个元素。

```
Cal::Cal{
   wa[0][0] = 5;
   wa[0][1] = 2;
   wa[1][0] = 7;
   wa[1][1] = 9;
} 
```

有可能（并且很可能）有更好的方法来做到这一点，但根据我上周的研究，这是如何使用多维数组来做到这一点的。如果有人有更好的方法，我很感兴趣。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-06T16:17:53.923

你不能轻易做到。如果您不[想像 Perchik's answer](https://stackoverflow.com/questions/520893/c-c-private-array-initialization-in-the-header-file/520917#520917)中那样单独指定每个元素，您可以创建一个静态数组`memcpy`（对于非平凡的数组大小，这可能会更快）：

```
namespace
{
    const int default_wa[2][2] = {{5, 2}, {7, 9}};
}

Cal::Cal
{
    memcpy(&wa[0][0], &default_wa[0][0], sizeof(wa));
} 
```

# .net - System.String.Copy 在 .NET 中有什么用？

> ID：520895
> 
> 赞同：79
> 
> 时间：2009-02-06T16:07:19.967
> 
> 标签：.net, string, copy, immutability

恐怕这是一个非常愚蠢的问题，但我一定遗漏了一些东西。

为什么要使用[String.Copy(string)](https://docs.microsoft.com/en-us/dotnet/api/system.string.copy)？

文档说方法

> 创建一个新的 String 实例，其值与指定的 String 相同。

由于字符串在 .NET 中是不可变的，所以我不确定使用这种方法有什么好处，因为我认为

```
 string copy = String.Copy(otherString); 
```

出于所有实际目的，似乎会产生与

```
 string copy = otherString; 
```

也就是说，除了正在进行的任何内部簿记以及复制不是`ReferenceEquals`到 otherString 的事实之外，没有可观察到的差异 - String 是一个不可变类，其相等性基于值，而不是身份。（感谢@Andrew Hare 指出我最初的措辞不够精确，无法表明我意识到`Copy`ing 和 not 之间存在差异，但担心缺乏*有用*的差异。）

当然，当传递一个`null`参数时， Copy 会抛出一个`ArgumentNullException`，并且“新实例”可能会消耗更多内存。后者似乎几乎没有好处，而且我不确定 null 检查是否足以保证整个 Copy 方法的好处。

谢谢。

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-02-06T16:18:46.950

`String.Copy`您实际上是在分配新内存并将字符从一个字符串复制到另一个字符串；你得到一个全新的实例，而不是让两个变量都是同一个实例。如果您将字符串与直接处理内存位置并可以改变字符串的非托管代码一起使用，这可能很重要。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-02-06T19:16:56.713

这是拼图的一部分。它没有解释你为什么要这样做，但它确实有助于解释功能差异。

如果您使用`fixed`关键字固定字符串，则内容将是可变的。在我的脑海中，我想不出你会想要这样做的情况，但这是可能的。

```
string original = "Hello World";
string refCopy = original;
string deepCopy = String.Copy(original);

fixed(char* pStr = original)
{
   *pStr = 'J';
}

Console.WriteLine(original);
Console.WriteLine(refCopy);
Console.WriteLine(deepCopy); 
```

* * *

输出：

```
Jello World
Jello World
Hello World 
```

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2009-02-06T16:16:16.267

`String.Copy`返回一个新的`String`并且不会产生相同的结果

```
String copy = otherString; 
```

试试这个：

```
using System;

class Program
{
    static void Main()
    {
        String test = "test";
        String test2 = test;
        String test3 = String.Copy(test);

        Console.WriteLine(Object.ReferenceEquals(test, test2));
        Console.WriteLine(Object.ReferenceEquals(test, test3));

        Console.ReadLine();
    }
} 
```

当您设置`test2 = test`这些引用指向相同的`String`. 该`Copy`函数返回一个新`String`引用，该引用具有相同的*内容*，但作为堆上的不同对象。

* * *

**编辑：**有很多人对我没有回答 OP 的问题感到非常沮丧。我相信我确实通过纠正问题本身的不正确前提来回答这个问题。这是一个类似的（如果不是过于简单的话）问题和答案，希望能说明我的观点：

**问题：**

> 我观察到我的车有两扇门，每侧一扇。我相信这是真的，无论我使用哪扇门，我最终都会坐在驾驶座上。另一扇门的目的是什么？

**回答：**

> 实际上，如果您使用任何一扇门，您最终会坐在驾驶座上，这是不正确的。如果您使用驾驶员侧门，您最终将坐在驾驶员座位上，如果您使用乘客侧门，您将最终坐在乘客座位上。

现在在这个例子中，你可以争辩说答案并不是真正的答案，因为问题是“乘客侧门的目的是什么？”。但是，既然这个问题完全是基于对门是如何工作的误解，难道不就意味着对前提的反驳将通过演绎揭示另一扇门的目的吗？

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2011-07-03T05:01:25.693

通过 BCL 快速搜索 .NET 4.0 显示该`string.Copy`方法在大约六处被调用。用法大致分为以下几类：

1.  用于与可能损坏传递给它们的字符串的本机函数的互操作。如果你不能影响 P/Invoke 声明并且你不能修复被调用的函数，`string.Copy`是最好的选择。

2.  对于出于性能原因而就地修改字符串的情况。如果您只需要将一个可能很长的字符串中的几个字符转换为小写，那么在不复制字符串两次并创建额外垃圾的情况下，唯一的方法就是对其进行变异。

3.  在似乎没有必要的地方。很可能有些程序员更习惯于 Java 或 C++ 字符串，而没有意识到在 C# 中复制字符串很少有用。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-02-06T16:26:44.827

```
string a = "abc";
string b = String.Copy(a);

Monitor.Enter(a); // not the same as Monitor.Enter(b); 
```

然而

```
string c = "123";
string d = c;
Monitor.Enter(c); // the same as Monitor.Enter(d); 
```

至于任何人都会关心的方式，我认为这是为了完整性。

* * *

还

```
StringBuilder sb = new StringBuilder(100);
sb.Append("abc");
string a = sb.ToString();
string b = String.Copy(a); 
```

我认为`a`会占用更多的 RAM `b`，因为`a`指向`StringBuilder`创建的大小为 100 的缓冲区。（看里面的`StringBuilder.ToString()`方法）

* * *

我认为`StringBuilder`使用`String.Copy()`并成为 .NET 框架的一部分`StringBuilder`确实会改变 .NET 框架的内容`string`。所以 a`string`并不总是不可变的。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2021-01-13T05:30:12.333

10 多年后访问此主题，使用 NET 5，请注意`String.Copy`自 NET Core 3.0 以来已过时。

所以*很好*，为什么使用这个问题的答案`String.Copy`现在可能是：*请不要！*

请参阅[MS 文档](https://docs.microsoft.com/en-us/dotnet/api/system.string.copy?view=net-5.0)：

[![Microsoft 文档中的 Doc 警告](https://i.stack.imgur.com/1MOH5.png)](https://i.stack.imgur.com/1MOH5.png)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-06T18:32:32.203

除了 tvanfosson 所说的（我认为您不能从非托管代码访问托管字符串使用的缓冲区......我知道这至少会很困难），我相信如果字符串是用作对多线程功能进行锁定的对象。

例如...

```
using System;

public class Class1
{
    string example1 = "example";
    string example2 = example1;

    public void ExampleMethod1()
    {
        lock (example1)
        {
            Console.WriteLine("Locked example 1");
            //do stuff...
        }
    }

    public void ExampleMethod2()
    {
        lock (example2)
        {
            Console.WriteLine("Locked example 2");
            //do stuff
        }
    }
} 
```

我相信如果这两个示例方法并行运行，它们将锁定同一个对象，因此当另一个在其锁定块内时，一个将无法执行。

但是，如果您将其更改为此...

```
using System;

public class Class1
{
    string example1 = "example";
    string example2 = string.Copy(example1);

    public void ExampleMethod1()
    {
        lock (example1)
        {
            Console.WriteLine("Locked example 1");
            //do stuff...
        }
    }

    public void ExampleMethod2()
    {
        lock (example2)
        {
            Console.WriteLine("Locked example 2");
            //do stuff
        }
    }
} 
```

然后我相信它们只会阻止执行相同方法的其他线程的执行（即任何执行 ExampleMethod1 的线程都将被锁定，直到每个线程完成，但它们不会干扰运行 ExampleMethod2 的线程）。

不确定这是一个*有用*的区别，因为有更好的同步机制（我不认为锁定字符串是一个好主意）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-06T16:50:03.687

```
string a = "test";
string b = a;
//Object.ReferenceEquals(a,b) is true
a += "more";
//Object.ReferenceEquals(a,b) is now false ! 
```

自动变化检测 ?

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-02-06T18:02:48.393

我不确定 String 是如何在 .NET 中实现的，但我认为 Java 是一个很好的参考。

在 Java 中， new String(str) 还可以做什么 String.copy(str); 做，分配一个具有相同值的新字符串。

看起来没什么用，但在内存优化方面非常有用。

String 在实现中包含一个带有偏移量和长度的 char[]。如果您执行子字符串之类的操作，它不会执行内存复制，而是返回一个共享相同 char[] 的新字符串实例。在很多情况下，这种模式会节省大量的内存复制和分配。但是，如果你在一个长的大字符串中子串一个小片段。即使原始的大字符串能够被GC，它仍然会引用大字符[]。

```
String longString = // read 1MB text from a text file
String memoryLeak = largeString.substring(100,102); 
largeString=null;
// memoryLeak will be sized 1MB in the memory
String smaller = new String(largeString.substring(100,102));
// smaller will be only few bytes in the memory 
```

它可以强制新的 String 对象分配它自己的 char[] 以防止隐藏的内存泄漏/浪费。

# java - 使用 Apache Ivy 获取 Hibernate Core 和 Hibernate Annotations 时遇到问题（但它也与 Maven2 相关。）

> ID：520902
> 
> 赞同：12
> 
> 时间：2009-02-06T16:09:33.473
> 
> 标签：java, hibernate, maven-2, annotations, ivy

## 好长啊！;-)

这个问题中有很多复制粘贴的文本，这使它看起来很复杂。老实说，这是很多信息！然而，对于有经验的人来说，其中很多可能是不必要的，而且很容易略过。

从本质上讲，我只是想知道为什么我的基本**Hibernate Core + Hibernate Annotations**测试项目不起作用。我怀疑缺少依赖项，但我使用的是 Apache Ivy，我认为它会自动从 Maven2 存储库 ibiblio 获取传递依赖项，但显然缺少依赖项（请参阅有关依赖项的帖子中的标题下方）。

## 我的测试项目

我有一个小测试项目：

**休眠.cfg.xml**

```
 <?xml version="1.0" encoding="UTF-8"?>
 <!DOCTYPE hibernate-configuration PUBLIC
         "-//Hibernate/Hibernate Configuration DTD 3.0//EN"
         "http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd">
 <hibernate-configuration>
     <session-factory>
         <property name="connection.driver_class">com.mysql.jdbc.Driver</property>
         <property name="connection.url">jdbc:mysql://localhost:3306/webcookieschema</property>
         <property name="connection.username">webcookieuser</property>
         <property name="connection.password">tHePaSsWoRd</property>
         <property name="dialect">org.hibernate.dialect.MySQLInnoDBDialect</property>
         </session-factory>
 </hibernate-configuration> 
```

**测试.java**

```
 public class Test {
    public static void main(String[] args) {
        UserDAO udao = new HibernateUserDAO();
        User u = new User();
        u.setName("somename");
        udao.store(u);
    }
 } 
```

**HibernateUserDAO.java**

```
 import org.hibernate.Session;
 import org.hibernate.SessionFactory;
 import org.hibernate.Transaction;
 import org.hibernate.cfg.AnnotationConfiguration;

 public class HibernateUserDAO implements
        UserDAO {

    private SessionFactory sessionFactory;

    public HibernateUserDAO() {
        AnnotationConfiguration annotConf = new AnnotationConfiguration();
        annotConf.addAnnotatedClass(User.class);
        annotConf.configure();
        // The line below generates the exception!
        sessionFactory = annotConf.buildSessionFactory();
    }

    @Override
    public void store(User user) {
        Session session = sessionFactory.openSession();
        Transaction tx = session.getTransaction();
        try {
            tx.begin();
            session.saveOrUpdate(user);
            tx.commit();
        } catch (RuntimeException e) {
            tx.rollback();
            throw e;
        } finally {
            session.close();
        }
    }
 } 
```

**log4j.properties**

```
 log4j.appender.Stdout=org.apache.log4j.ConsoleAppender
 log4j.appender.Stdout.layout=org.apache.log4j.PatternLayout
 log4j.appender.Stdout.layout.conversionPattern=%-5p - %-26.26c{1} - %m\n

 log4j.rootLogger=INFO,Stdout

 log4j.logger.org.apache.wicket=INFO
 log4j.logger.org.apache.wicket.protocol.http.HttpSessionStore=INFO
 log4j.logger.org.apache.wicket.version=INFO
 log4j.logger.org.apache.wicket.RequestCycle=INFO 
```

**用户DAO.java**

```
 public interface UserDAO {
    public void store(User user);
 } 
```

**用户.java**

```
 import javax.persistence.Column;
 import javax.persistence.Entity;
 import javax.persistence.GeneratedValue;
 import javax.persistence.Id;

 @Entity
 public class User {
    @Id
    @GeneratedValue
    @Column(name = "ID")
    private Long id;

    @Column(name = "NAME")
    private String name;

    public User() {
    }

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
 } 
```

运行测试项目时遇到的**异常：**

```
Exception in thread "main" java.lang.NoClassDefFoundError: javassist/util/proxy/MethodFilter
at org.hibernate.bytecode.javassist.BytecodeProviderImpl.getProxyFactoryFactory(BytecodeProviderImpl.java:49)
at org.hibernate.tuple.entity.PojoEntityTuplizer.buildProxyFactoryInternal(PojoEntityTuplizer.java:203)
at org.hibernate.tuple.entity.PojoEntityTuplizer.buildProxyFactory(PojoEntityTuplizer.java:181)
at org.hibernate.tuple.entity.AbstractEntityTuplizer.<init>(AbstractEntityTuplizer.java:158)
at org.hibernate.tuple.entity.PojoEntityTuplizer.<init>(PojoEntityTuplizer.java:76)
at org.hibernate.tuple.entity.EntityEntityModeToTuplizerMapping.<init>(EntityEntityModeToTuplizerMapping.java:80)
at org.hibernate.tuple.entity.EntityMetamodel.<init>(EntityMetamodel.java:325)
at org.hibernate.persister.entity.AbstractEntityPersister.<init>(AbstractEntityPersister.java:457)
at org.hibernate.persister.entity.SingleTableEntityPersister.<init>(SingleTableEntityPersister.java:131)
at org.hibernate.persister.PersisterFactory.createClassPersister(PersisterFactory.java:84)
at org.hibernate.impl.SessionFactoryImpl.<init>(SessionFactoryImpl.java:261)
at org.hibernate.cfg.Configuration.buildSessionFactory(Configuration.java:1327)
at org.hibernate.cfg.AnnotationConfiguration.buildSessionFactory(AnnotationConfiguration.java:867)
at HibernateUserDAO.<init>(HibernateUserDAO.java:15)
at Test.main(Test.java:3)
Caused by: java.lang.ClassNotFoundException:
    javassist.util.proxy.MethodFilter
    at java.net.URLClassLoader$1.run(URLClassLoader.java:200)
    at java.security.AccessController.doPrivileged(Native Method)
    at java.net.URLClassLoader.findClass(URLClassLoader.java:188)
    at java.lang.ClassLoader.loadClass(ClassLoader.java:306)
    at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:276)
    at java.lang.ClassLoader.loadClass(ClassLoader.java:251)
    at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:319)
    ... 15 more 
```

* * *

## 如果它缺少依赖项

当我得到一个*ClassCastException*（它包含在上面）时，我认为检查我是否拥有所有依赖项是个好主意。

如果我下载**Hibernate Core**存档并查看存档的 /lib 目录，我会得到：

```
kent@rat:~/dl-web/hibernate-distribution-3.3.1.GA$ tree lib/
lib/
|-- bytecode
|   |-- cglib
|   |   `-- hibernate-cglib-repack-2.1_3.jar
|   `-- javassist
|       `-- javassist-3.4.GA.jar
|-- optional
|   |-- c3p0
|   |   `-- c3p0-0.9.1.jar
|   |-- ehcache
|   |   `-- ehcache-1.2.3.jar
|   |-- jbosscache
|   |   `-- jboss-cache-1.4.1.GA.jar
|   |-- jbosscache2
|   |   `-- jbosscache-core-2.1.1.GA.jar
|   |-- oscache
|   |   `-- oscache-2.1.jar
|   |-- proxool
|   |   `-- proxool-0.8.3.jar
|   `-- swarmcache
|       `-- swarmcache-1.0RC2.jar
`-- required
    |-- antlr-2.7.6.jar
    |-- commons-collections-3.1.jar
    |-- dom4j-1.6.1.jar
    |-- javassist-3.4.GA.jar
    |-- jta-1.1.jar
    `-- slf4j-api-1.5.2.jar 
```

如果我下载**Hibernate Annotations**并做同样的事情，我会得到：

```
kent@rat:~/dl-web/hibernate-annotations-3.4.0.GA$ tree lib/
lib/
|-- README.txt
|-- build
|   |-- ant-contrib-1.0b2.jar
|   |-- ant-junit-1.6.5.jar
|   `-- junit-3.8.1.jar
|-- dom4j.jar
|-- ejb3-persistence.jar
|-- hibernate-commons-annotations.jar
|-- hibernate-core.jar
|-- slf4j-api.jar
`-- test
    |-- antlr.jar
    |-- asm-attrs.jar
    |-- asm.jar
    |-- commons-collections.jar
    |-- javassist.jar
    |-- jta.jar
    |-- junit.jar
    |-- log4j.jar
    `-- slf4j-log4j12.jar 
```

默认情况下**，我认为 Ivy 在 Maven2 模式下使用 ibiblio 服务器来检索其依赖项**。我正在使用这个**ivy.xml 来配置我想要的依赖项：**

```
<?xml version="1.0" encoding="UTF-8"?>
<ivy-module version="2.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="http://ant.apache.org/ivy/schemas/ivy.xsd">
    <info
      organisation="testorganization"
      module="hibernatetest"
      status="integration"/>
    <configurations>
        <conf name="runtime" description="" />
    </configurations>
    <dependencies>
        <dependency org="mysql" name="mysql-connector-java" rev="5.1.6" conf="runtime->default"/>
        <dependency org="org.hibernate" name="hibernate-core" rev="3.3.1.GA" conf="runtime->default"/>
        <dependency org="org.hibernate" name="hibernate-annotations" rev="3.4.0.GA" conf="runtime->default">
            <include></include>
        </dependency>
        <dependency org="org.slf4j" name="slf4j-log4j12" rev="1.5.6" conf="runtime->default"/>
    </dependencies>
</ivy-module> 
```

我实际得到的依赖**JAR**是：

```
kent@rat:~/.ivy2/cache$ ls -R1 * | egrep '.jar$'
antlr-2.7.6.jar
commons-collections-3.1.jar
dom4j-1.6.1.jar
jta-1.1.jar
log4j-1.2.14.jar
mysql-connector-java-5.1.6.jar
ejb3-persistence-1.0.2.GA.jar
hibernate-annotations-3.4.0.GA.jar
hibernate-commons-annotations-3.1.0.GA.jar
hibernate-core-3.3.1.GA.jar
slf4j-api-1.5.6.jar
slf4j-log4j12-1.5.6.jar
xml-apis-1.0.b2.jar 
```

在[ibiblio 上的 hibernate-core 的 POM 文件中，](http://mirrors.ibiblio.org/pub/mirrors/maven2/org/hibernate/hibernate-core/3.3.1.GA/hibernate-core-3.3.1.GA.pom)有一些**我想知道的行：**

```
 <dependencies>
       ...
       ...
       ...
       <!-- optional deps for bytecode providers until those are finally properly scoped -->
       <dependency>
           <groupId>javassist</groupId>
           <artifactId>javassist</artifactId>
           <version>3.4.GA</version>
           <optional>true</optional>
       </dependency>
       <dependency>
           <groupId>org.hibernate</groupId>
           <artifactId>hibernate-cglib-repack</artifactId>
           <version>2.1_3</version>
           <optional>true</optional>
       </dependency>
   </dependencies> 
```

**他们的意思是什么？我需要他们两个吗？如果确实总是需要它们，为什么将它们设置为可选？我如何得到它们？**

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-07T15:23:06.890

我会在您的项目中明确指定 javassist 作为依赖项，看看是否可行。

至于为什么它被列为可选，有几个原因有人会这样做，但在这种情况下，Hibernate 团队似乎还没有决定实际的依赖范围：

```
<!-- optional deps for bytecode providers until those are finally properly scoped --> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-09T12:20:19.937

我必须添加**,optional**到我的 Ivy.xml 以获得可选配置，这是检索所有依赖项和项目正确运行所必需的。

```
dependency org="org.hibernate" name="hibernate-core" rev="3.3.1.GA" conf="runtime->runtime,optional"/> 
```

# sql-server - 如何使用 SSIS 包将表数据拆分为单独的命名 Excel 文件？

> ID：520905
> 
> 赞同：2
> 
> 时间：2009-02-06T16:10:22.753
> 
> 标签：sql-server, excel, ssis

我正在处理一组来自 SQL Server 的数据，我想将这些数据放入一组 Excel 文件中。此任务需要自动运行以每月运行一次。数据看起来像

```
Site    ID      FirstName   LastName
------  ------- ---------   ---------
North   111     Jim         Smith
North   112     Tim         Johnson
North   113     Sachin      Tedulkar
South   201     Horatio     Alger
South   205     Jimi        Hendrix
South   215     Bugs        Bunny 
```

我希望结果看起来像

```
In Excel file named North.xls

ID      FirstName   LastName
111     Jim         Smith
112     Tim         Johnson
113     Sachin      Tedulkar

In Excel file named South.xls

ID      FirstName   LastName
201     Horatio     Alger
205     Jimi        Hendrix
215     Bugs        Bunny 
```

我想拆分的站点列中有 70 到 100 个值。我正在使用 SSIS 执行此任务，但是在使用 OLE DB 源任务从 SQL Server 中提取数据后，我遇到了困难。接下来应该怎么做？如果使用其他工具有更简单的方法可以做到这一点，我也对此持开放态度。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2011-07-16T11:25:33.927

您现在可能已经找到了问题的答案。这适用于可能偶然发现此问题的其他用户。以下示例显示了如何为可能存在的任意数量的站点动态地实现这一点。该示例是使用`SSIS 2008 R2`with`SQL Server 2008 R2`数据库创建的。

**分步过程：**

1.  在 SQL Server 数据库中执行 SQL 脚本部分下给出的脚本，以创建一个名为`dbo.Source`并填充数据的表（类似于问题中给出的数据）。它还创建了一个名为`dbo.GetSiteData`.

2.  在 SSIS 包的连接上，创建一个 OLE DB 连接以连接到 SQL Server。我们将在后面的步骤中连接 Excel。

3.  在 SSIS 包上，创建 6 个变量，如屏幕截图 # **1**所示。用 value填充变量**Site**`Template`，这是一个示例值，将用于评估其他表达式。将变量**SQLUniqueSites**设置为value `SELECT DISTINCT Site FROM dbo.SourceData`。将变量**ExcelFolder**设置为值`C:\temp\`

4.  选择变量**ExcelFilePath**并按下`F4`以查看属性。将属性*EvaluateAsExpression*更改为`True`并将属性*Expression*设置为value `@[User::ExcelFolder] + @[User::Site] + ".xls"`。参考截图# **2**。

5.  选择变量**ExcelSheet**并按下`F4`以查看属性。将属性*EvaluateAsExpression*更改为`True`并将属性*Expression设置为***ExcelSheet 变量值**下给出的值。参考截图# **3**。

6.  在 SSIS 包的 Control Flow 选项卡上，放置`Execute SQL Task`并配置它，如屏幕截图 # **4**和 # **5**所示。此任务将获取唯一的站点名称。

7.  在 SSIS 包的控制流选项卡上，`Foreach Loop container`在执行 SQL 任务之后放置一个并配置 Foreach 循环容器，如屏幕截图 # **6**和 # **7**所示。此循环将遍历结果集并将每个站点读入一个变量。然后，此变量用于为 Excel 文件提供名称以及将很快添加的数据流任务中的存储过程的参数。

8.  在 Foreach 循环容器内，放置一个`Execute SQL Task`，然后放置一个`Data Flow Task`。此时，“控制流”选项卡应如屏幕截图 # **8**所示。此时您的包裹可能会显示错误，我们将在接下来的步骤中尽快修复。我们将配置数据流任务，然后将返回到 Foreach 循环容器中的执行 SQL 任务。

9.  在数据流任务中，放置`OLE DB Source`并配置它，如屏幕截图 # **9**和 # **11**所示。这将根据给定站点从表中获取数据。单击**参数...**按钮设置查询参数。

10.  如果表字段数据类型是VARCHAR，那么我们需要将其转换为NVARCHAR（unicode格式），否则不需要这一步。在数据流任务中，`Data Conversion`在 OLE DB 源之后放置一个转换并按照屏幕截图 # **12**进行配置。

11.  接下来，在 Data Flow Task 中，放置一个 Excel 目标，单击第一个 New... 按钮，如屏幕截图 # **13**所示。

12.  在 Excel 连接管理器对话框中，提供 Excel 文件路径并单击确定。参考截图# **14**。返回 Excel 目标，单击第二个 New... 按钮，如屏幕截图 # **15**所示。在 Create Table 对话框中，确保脚本如屏幕截图 # **16**所示，然后单击 OK。**当显示如屏幕截图 # 17**所示的警告时，单击“确定”。`Template`从*Excel 工作表的名称*下拉列表中选择值，如屏幕截图 # **18**所示。**如屏幕截图 # 19**所示配置列。

13.  在 SSIS 包的连接管理器上，选择新创建的 Excel 连接管理器，然后按 F4 查看属性。*将Name*属性值更改为`Excel`。*将DelayValidation*更改为，`True`这样如果文件 Template.xls 不存在，您就不会收到错误消息。将*ServerName*表达式设置为 value `@[USer::ExcelFilePath]`。参考截图# **20**。**`NOTE:`**应该已经在路径 C:\temp\Template.xls 中创建了一个 Excel 文件。您可能希望保存它，以便在将来的设计更改期间不会遇到。如果文件被删除，您仍然可以重新创建它。

14.  返回到 Excel 目标并配置它，如屏幕截图 # **21**所示。配置数据流任务后，它应该如屏幕截图 # **22**所示。

15.  返回控制流选项卡，在 Foreach 循环容器中配置执行 SQL 任务，如屏幕截图 # **23**所示。此任务将为每个站点名称创建新的 Excel 电子表格。

16.  屏幕截图 # **24**显示了包执行**前**文件夹 c:\temp\ 中的内容。

17.  截图# **25**和# **26**显示了包的执行。

18.  屏幕截图 # **27**显示了包执行**后**文件夹 c:\temp\ 中的内容。

19.  屏幕截图# **28**和# **29**显示了新创建的 Excel 电子表格 North.xls 和 South.xls 的内容。两张表都包含各自同名站点的数据。

希望有帮助。

**ExcelSheet 变量值：**

```
CREATE TABLE `Template` (`Id` Long, `FirstName` LongText, `LastName` LongText) 
```

**SQL 脚本：**

```
CREATE TABLE [dbo].[SourceData](
    [Id] [int] IDENTITY(1,1) NOT NULL,
    [Site] [varchar](50) NOT NULL,
    [FirstName] [varchar](40) NOT NULL,
    [LastName] [varchar](40) NOT NULL,
CONSTRAINT [PK_SourceData] PRIMARY KEY CLUSTERED ([Id] ASC)
) ON [PRIMARY]
GO

INSERT INTO dbo.SourceData (Site, FirstName, LastName) VALUES
    ('North', 'Jim', 'Smith'),
    ('North', 'Tim', 'Johnson'),
    ('North', 'Sachin', 'Tendulkar'),
    ('South', 'Horatio', 'Alger'),
    ('South', 'Jimi', 'Hendrix'),
    ('South', 'Bugs', 'Bunny');
GO

CREATE PROCEDURE dbo.GetSiteData
(
    @Site   VARCHAR(50)
)
AS
BEGIN   
    SET NOCOUNT ON;

    SELECT  Id 
        ,   FirstName
        ,   LastName
    FROM    dbo.SourceData
    WHERE   Site = @Site
END 
GO 
```

**截图#1：**

![1](https://i.stack.imgur.com/I68Eo.png)

**截图#2：**

![2](https://i.stack.imgur.com/SPKi9.png)

**截图#3：**

![3](https://i.stack.imgur.com/bcaNF.png)

**截图#4：**

![4](https://i.stack.imgur.com/8RBYU.png)

**截图#5：**

![5](https://i.stack.imgur.com/gtZ5l.png)

**截图#6：**

![6](https://i.stack.imgur.com/0LcnB.png)

**截图#7：**

![7](https://i.stack.imgur.com/6HEyx.png)

**截图#8：**

![8](https://i.stack.imgur.com/QaqA0.png)

**截图#9：**

![9](https://i.stack.imgur.com/iMqPJ.png)

**截图#10：**

![10](https://i.stack.imgur.com/YA6KJ.png)

**截图 #11：**

![11](https://i.stack.imgur.com/jSU0U.png)

**截图#12：**

![12](https://i.stack.imgur.com/PoV2m.png)

**截图#13：**

![13](https://i.stack.imgur.com/IoGoz.png)

**截图#14：**

![14](https://i.stack.imgur.com/T6CW5.png)

**截图#15：**

![15](https://i.stack.imgur.com/Q5aTL.png)

**截图#16：**

![16](https://i.stack.imgur.com/lM9an.png)

**截图#17：**

![17](https://i.stack.imgur.com/1aXbf.png)

**截图#18：**

![18](https://i.stack.imgur.com/V2hOD.png)

**截图#19：**

![19](https://i.stack.imgur.com/1WAAT.png)

**截图#20：**

![20](https://i.stack.imgur.com/qBHuv.png)

**截图#21：**

![21](https://i.stack.imgur.com/Pi2jF.png)

**截图#22：**

![22](https://i.stack.imgur.com/DcapV.png)

**截图#23：**

![23](https://i.stack.imgur.com/luL0R.png)

**截图#24：**

![24](https://i.stack.imgur.com/XMEOS.png)

**截图#25：**

![25](https://i.stack.imgur.com/Tdlxw.png)

**截图#26：**

![26](https://i.stack.imgur.com/y57B0.png)

**截图#27：**

![27](https://i.stack.imgur.com/jHALp.png)

**截图#28：**

![28](https://i.stack.imgur.com/qkcEl.png)

**截图#29：**

![29](https://i.stack.imgur.com/85rZW.png)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-06T16:24:54.440

我认为 SSIS 是一个很好的工具，你有几个选择。

基本上，您可以使用多播和条件拆分对象来实现您想要的。

这是我的做法：

1) 我将创建两个 MS Excel 文件，其中包含我希望看到的所有数据。删除数据并将其保留为模板文件并为完整文件制作副本。

2) 在连接管理器中设置到这些文件的文件连接。

3）制作一个文件系统任务，在工作开始时用模板覆盖完整文件（其他方法可以做到这一点，但我最喜欢这个）。

4) 添加数据流任务并在其中放入一个 OLE DB 源、一个多播、两个条件拆分和两个 MS Excel 目标。

5）配置每一个，你应该完成。配置非常直观，按照我上面的顺序。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-06T20:33:46.793

不确定这是否可行，但将所有条件查询与文件名的另一个字段一起放在一个表中。然后使用 for 循环遍历其中的每一个并动态修改转换任务的 select 子句。SSIS 将这些动态修改称为表达式。

您在语句/条件表上进行选择，然后将其放入对象变量中。然后在 for 循环中使用对象变量。

我唯一不确定的是映射到 excel 文件名。

编辑：还发现了这个，它使用链接服务器[http://codebetter.com/blogs/raymond.lewallen/archive/2005/05/04/62781.aspx](http://codebetter.com/blogs/raymond.lewallen/archive/2005/05/04/62781.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-10-12T09:13:49.480

我发现问题出在 excel 目的地的解决方案。我重新安装了 Microsoft 访问引擎 Redistributable（32 位版本）。一切正常。我遇到了 64 位和 32 位问题，因为我的系统是 64 位，所以它们不兼容。

# java - 将 Java 字符串拆分为 1024 字节的块

> ID：520907
> 
> 赞同：8
> 
> 时间：2009-02-06T16:10:25.063
> 
> 标签：java, string, split, byte

在java中将String拆分为1024字节块的有效方法是什么？如果有多个块，则需要在所有后续块中重复标头（固定大小的字符串）。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-06T16:19:31.177

您有两种方式，快速方式和记忆保守方式。但首先，您需要知道字符串中有哪些字符。ASCII？是否有变音符号（128 到 255 之间的字符）甚至 Unicode（s.getChar() 返回大于 256 的内容）。根据这一点，您将需要使用不同的编码。如果您有二进制数据，请尝试“iso-8859-1”，因为它将保留字符串中的数据。如果您有 Unicode，请尝试“utf-8”。我将假设二进制数据：

```
String encoding = "iso-8859-1"; 
```

最快的方法：

```
ByteArrayInputStream in = new ByteArrayInputStream (string.getBytes(encoding)); 
```

请注意，字符串是 Unicode，因此每个字符都需要*两个*字节。您必须指定编码（不要依赖“平台默认值”。这只会在以后造成痛苦）。

现在您可以使用 1024 个块读取它

```
byte[] buffer = new byte[1024];
int len;
while ((len = in.read(buffer)) > 0) { ... } 
```

这需要大约三倍于原始字符串的 RAM。

一种更保守的内存方式是编写一个转换器，它采用 StringReader 和 OutputStreamWriter（包装 ByteArrayOutputStream）。将字节从读取器复制到写入器，直到底层缓冲区包含一大块数据：

当它这样做时，将数据复制到实际输出（在标题之前），将额外的字节（Unicode->字节转换可能已经生成）复制到临时缓冲区，调用 buffer.reset() 并将临时缓冲区写入缓冲。

代码如下所示（未经测试）：

```
StringReader r = new StringReader (string);
ByteArrayOutputStream buffer = new ByteArrayOutputStream (1024*2); // Twice as large as necessary
OutputStreamWriter w = new OutputStreamWriter  (buffer, encoding);

char[] cbuf = new char[100];
byte[] tempBuf;
int len;
while ((len = r.read(cbuf, 0, cbuf.length)) > 0) {
    w.write(cbuf, 0, len);
    w.flush();
    if (buffer.size()) >= 1024) {
        tempBuf = buffer.toByteArray();
        ... ready to process one chunk ...
        buffer.reset();
        if (tempBuf.length > 1024) {
            buffer.write(tempBuf, 1024, tempBuf.length - 1024);
        }
    }
}
... check if some data is left in buffer and process that, too ... 
```

这只需要几千字节的 RAM。

[编辑] 在评论中对字符串中的二进制数据进行了长时间的讨论。首先，将二进制数据放入 String 是完全安全的，只要您在创建它并将其存储在某个地方时要小心。要创建这样的字符串，请使用 byte[] 数组并：

```
String safe = new String (array, "iso-8859-1"); 
```

在 Java 中，ISO-8859-1（又名 ISO-Latin1）是 1:1 映射。这意味着数组中的字节不会以任何方式被解释。现在您可以对数据使用 substring() 等或使用索引搜索它，对其运行正则表达式等。例如，找到一个 0 字节的位置：

```
int pos = safe.indexOf('\u0000'); 
```

如果您不知道数据的编码并且想在某些编解码器弄乱它之前查看它，这将特别有用。

要将数据写入某处，反向操作是：

byte[] data = safe.getBytes("iso-8859-1");

**永远不要使用默认方法`new String(array)`或`String.getBytes()`！**有一天，您的代码将在不同的平台上执行，它会中断。

现在字符串中字符> 255的问题。如果您使用此方法，您的字符串中将永远不会有任何此类字符。也就是说，如果出于某种原因，getBytes() 会抛出异常，因为无法在 ISO-Latin1 中表达所有 Unicode 字符，因此从代码不会静默失败的意义上说，您是安全的。

有些人可能会争辩说这不够安全，你不应该混合使用字节和字符串。在这个时代，我们没有那种奢侈。许多数据没有明确的编码信息（例如，文件没有“编码”属性，就像它们具有访问权限或名称一样）。XML 是少数具有显式编码信息的格式之一，并且有像 Emacs 或 jEdit 这样的编辑器使用注释来指定这些重要信息。这意味着，在处理字节流时，您必须始终知道它们的编码方式。到目前为止，无论数据来自何处，都无法编写始终有效的代码。

即使使用 XML，您也必须将文件头作为字节读取以确定编码，然后才能对肉进行解码。

重要的一点是坐下来弄清楚使用哪种编码来生成您必须处理的数据流。如果你这样做，你很好，如果你不这样做，你注定要失败。混淆源于这样一个事实，即大多数人不知道同一个字节可能意味着不同的东西，这取决于编码，甚至有多个编码。此外，如果 Sun 没有引入“平台默认编码”的概念，它也会有所帮助。

初学者的要点：

*   有不止一种编码（字符集）。
*   有比英语使用的更多的字符。甚至还有几[组数字](http://msdn.microsoft.com/en-us/library/w1c0s6bb.aspx)（ASCII、全角、阿拉伯语-印度语、孟加拉语）。
*   您必须知道使用哪种编码来生成您正在处理的数据。
*   您必须知道应该使用哪种编码来编写正在处理的数据。
*   您必须知道指定此编码信息的正确方法，以便下一个程序可以解码您的输出（XML 标头、HTML 元标记、特殊编码注释等）。

ASCII 的时代已经结束。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-06T17:20:41.113

字符串和字节是两个完全不同的东西，所以想把一个字符串分割成字节就和想把一幅画分割成诗一样毫无意义。

你真正想做的是什么？

要在字符串和字节之间进行转换，您需要指定一种可以对 String 中的所有字符进行编码的编码。根据编码和字符，其中一些可能跨越一个字节以上。

您可以将字符串拆分为 1024 个字符的块并将它们编码为字节，但是每个块可能超过 1024 个字节。

或者您可以将原始字符串编码为字节，然后将它们拆分为 1024 的块，但是您必须确保在再次将整个字符串解码为字符串之前将它们附加为字节，否则您可能会在拆分点出现乱码一个字符跨越超过 1 个字节。

如果您担心String可能很长时内存使用情况，您应该使用流（java.io包）来进行en/decode和split，以避免将数据多次保存在内存中作为副本。理想情况下，您应该完全避免将原始字符串放在一个片段中，而是使用流从您获取它的任何地方以小块的形式读取它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2015-06-15T18:25:43.333

我知道我迟到了，但是我自己在寻找解决方案，然后发现我的答案是最佳答案：

```
private static String chunk_split(String original, int length, String separator) throws IOException {
    ByteArrayInputStream bis = new ByteArrayInputStream(original.getBytes());
    int n = 0;
    byte[] buffer = new byte[length];
    String result = "";
    while ((n = bis.read(buffer)) > 0) {
        for (byte b : buffer) {
            result += (char) b;
        }
        Arrays.fill(buffer, (byte) 0);
        result += separator;
    }
    return result;
} 
```

**示例**：

```
public static void main(String[] args) throws IOException{
       String original = "abcdefghijklmnopqrstuvwxyz";
       System.out.println(chunk_split(original,5,"\n"));
} 
```

**输出**：

```
abced
fghij
klmno
pqrst
uvwxy
z 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-08-10T14:39:12.893

我正在为自己尝试这个，我需要将一个巨大的字符串（近 10 MB）分块为 1 MB。这有助于在最短的时间内分块数据。（不到一秒）。

```
private static ArrayList<String> chunkLogMessage(String logMessage) throws Exception {
    ArrayList<String> messages = new ArrayList<>();
    if(logMessage.getBytes().length > CHUNK_SIZE) {
        Log.e("chunk_started", System.currentTimeMillis()+"");
        byte[] buffer = new byte[CHUNK_SIZE];
        int start = 0, end = buffer.length;
        long remaining = logMessage.getBytes().length;
        ByteArrayInputStream inputStream = new ByteArrayInputStream(logMessage.getBytes());
        while ((inputStream.read(buffer, start, end)) != -1){
            ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
            outputStream.write(buffer, start, end);
            messages.add(outputStream.toString("UTF-8"));
            remaining = remaining - end;
            if(remaining <= end){
                end = (int) remaining;
            }
        }
        Log.e("chunk_ended", System.currentTimeMillis()+"");
        return messages;
    }
    messages.add(logMessage);
    return messages;
} 
```

日志猫：

```
22:08:00.262 3382-3425/com.sample.app E/chunk_started: 1533910080261
22:08:01.228 3382-3425/com.sample.app E/chunk_ended: 1533910081228
22:08:02.468 3382-3425/com.sample.app E/chunk_started: 1533910082468
22:08:03.478 3382-3425/com.sample.app E/chunk_ended: 1533910083478
22:09:19.801 3382-3382/com.sample.app E/chunk_started: 1533910159801
22:09:20.662 3382-3382/com.sample.app E/chunk_ended: 1533910160662 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-06-16T15:35:18.393

是的，如果不是全部，上述大多数肯定会起作用。

或者你可以看看[这个](https://github.com/gbenroscience/datautils)项目就是这样做的；只有它不仅可以分块字符串，还可以分块字节数组、输入流和文件。

它有 2 个类：`DataChunker`和`StringChunker`

```
 DataChunker chunker = new DataChunker(8192, blob) {
@Override 
public void chunkFound(byte[] foundChunk, int bytesProcessed) {
//process chunk here
}
@Override 
public void chunksExhausted(int bytesProcessed) { 
//called when all the blocks have been exhausted
} 
}; 
```

```
String blob = "Experience is wasted if history does not repeat itself...Gbemiro Jiboye";

 final StringBuilder builder = new StringBuilder();
        StringChunker chunker = new StringChunker(4, blob) {
            @Override
            public void chunkFound(String foundChunk, int bytesProcessed) {
                builder.append(foundChunk);
                System.out.println("Found: "+foundChunk+", bytesProcessed: "+bytesProcessed+" bytes");
            }

            @Override
            public void chunksExhausted(int bytesProcessed) {
                System.out.println("Processed all of: "+bytesProcessed+" bytes. Rebuilt string is: "+builder.toString());
            }
        }; 
```

构造函数`blob`构造`Datachunker's`函数中的 要么是字节数组，要么是`File`a`InputStream`

# asp.net - 嵌套的用户控件和 ViewState

> ID：520908
> 
> 赞同：2
> 
> 时间：2009-02-06T16:11:22.660
> 
> 标签：asp.net

我有一个动态加载 UserControlChild 的 UserControlParent。

在 UserControlChild 中，我使用 ViewState 对象通过执行

```
ViewState["count"] = myCount; 
```

在回发时，ViewState 返回一个空值。这是因为 UserControlChild 是动态加载的吗？如果有帮助，UserControlParent 也会在 ASPX 页面中动态加载。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-10T16:38:51.653

这有几个可能的原因。

首先，确保您指定了 UserControlParent、UserControlChild 以及父层次结构中的每个 runat="server" 控件的 ID。如果你错过了一个，ASP.NET 会自动分配一个。此 ID 可以（在某些情况下）在您的回发前后不同，从而破坏 ViewState。

其次，确保父层次结构中的每个控件的 EnableViewState="true"，一直到页面。如果其中任何一个为假，它也会关闭其所有子级的 ViewState。

第三，当您动态创建 UserControlChild 时，请确保在页面生命周期中尽早创建它（并将其添加到 UserControlParent.Controls）。如果您在页面加载 ViewState 之后执行此操作，您只会从 ViewState 中返回空值。在 Page.Init 中添加它已经足够早了；在 Page.Load 中为时已晚。

希望这可以帮助！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-25T18:44:44.320

泰迪耶，

我指定了所有的 ID（除了 GridView 行），并且在任何地方都启用了视图状态，并且在标记中静态添加了控件。我仍然没有在回传中保存 ViewState - 认为这是 asp.net 中的错误。

这是控件树：

掌握; 页面 - Ajax:TabContainer - Ajax:TabPanel - UC1 - UC2 - Gridview - 它的行

看起来嵌套的用户控件不会保留视图状态。我在另一个项目中遇到了同样的问题，我犯规的唯一解决方案是避免嵌套用户控件。

如果有人知道这种行为背后的原因，请告知。

谢谢。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-06T16:15:24.133

您是否尝试过在您的 UserControl 中创建调试？

```
protected override void LoadViewState(object savedState)
{
    base.LoadViewState(savedState);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-06T16:19:21.363

是否`ViewState`为您的应用程序启用？有几个地方可以关闭它，即在 web.config、页面本身`UserControlParent`、或`UserControlChild`.

# c# - 如何模拟 Windows 关机以进行调试？

> ID：520910
> 
> 赞同：52
> 
> 时间：2009-02-06T16:11:42.220
> 
> 标签：c#, .net, winforms, shutdown

当 Windows 关闭时，我的应用程序出现问题 - 我的应用程序没有很好地退出，导致显示“结束任务”窗口。如何使用调试器查看发生了什么？

有没有办法将 Windows 关闭消息发送到我的应用程序，以便它认为 Windows 正在关闭，所以我可以确切地看到它的行为方式？

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2010-04-20T08:58:56.583

在微软的 Windows 徽标测试工具中有一个名为 Restart Manager (rmtool.exe) 的工具，可用于向进程发送关闭和重启消息。标志测试工具可以在这里下载：

[http://download.microsoft.com/download/d/2/5/d2522ce4-a441-459d-8302-be8f3321823c/LogoToolsv1.0.msi](http://download.microsoft.com/download/d/2/5/d2522ce4-a441-459d-8302-be8f3321823c/LogoToolsv1.0.msi)

然后您可以模拟您的进程的关闭：

```
rmtool.exe -p [PID] -S 
```

其中 [PID] 是进程 ID。根据 Vista Logo 认证测试用例文档，

> 重新启动管理器关闭消息是：
> 
> 一种。WM_QUERYENDSESSION with LPARAM = ENDSESSION_CLOSEAPP(0x1)：GUI 应用程序必须立即响应 (TRUE) 以准备重新启动。
> 
> 湾。WM_ENDSESSION with LPARAM = ENDSESSION_CLOSEAPP(0x1)：应用程序必须在 5 秒内关闭（服务为 20 秒）。
> 
> C。CTRL_SHUTDOWN_EVENT：控制台应用程序必须立即关闭。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-06T16:17:51.133

我相信当 Windows 关闭时，它会向所有应用程序发送“WM_QueryEndSession”。要模拟 Windows 关闭，您可以创建一个小应用程序，该应用程序只将此消息发送到您的应用程序的 PostMessage，然后查看会发生什么。Windows 可能会发送比实际关闭您的应用程序更多的消息（如 WM_CLOSE），但是每当您的应用程序收到“WM_QueryEndSession”消息时，这意味着您的应用程序即将从它下面拉出地毯。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2018-03-08T06:33:27.647

[SendMessage](https://sourceforge.net/projects/sendmessage/)可用于向窗口发送带有任何参数的窗口消息。

> 对于调试和测试非常有用。

1.  `WM_QUERYENDSESSION`使用`LPARAM`=发送消息`ENDSESSION_CLOSEAPP`。应用程序必须返回 1 (TRUE) 以指示它已准备好关闭并重新启动。

2.  发送`WM_ENDSESSION`带有 LPARAM =`ENDSESSION_CLOSEAPP` 应用程序必须在指定的超时期限内关闭的消息。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2020-12-21T11:32:51.693

这可以使用`rmlogotest.exe`工具来完成。请参阅以下链接：

[https://superuser.com/questions/959364/on-windows-how-can-i-gracefully-ask-a-running-program-to-terminate#1154058](https://superuser.com/questions/959364/on-windows-how-can-i-gracefully-ask-a-running-program-to-terminate#1154058)

如果您使用的是 WPF，那么您可以处理其他事件：

```
 Application.SessionEnding += Application_SessionEnding; 
```

您可以在其中设置`e.Cancel = true;`能够中止应用程序关闭。

我认为`rmlogotest.exe`使用 5 秒的超时，然后它会告诉你 `LOGO Validation FAILED`。

如果您在应用程序中放置某种消息框确认 - 您会失败，因为最终用户可能需要 5 秒以上的时间来响应。

我猜从 Windows 的角度来看，如果 5 秒过去了，它无论如何都想重新启动 - 如果最终用户没有保存他的文档/工作 - 那么 Windows 可能希望将它复制到其他地方。

从我的角度（作为应用程序开发人员） - 失败是可以接受的 `LOGO Validation FAILED`，因为用户可以自行决定 - 他是否会在 5 秒后杀死我的应用程序并丢失他的文档，或者他会保存文档并手动关闭我的应用程序。

如果您需要广播`WM_QUERYENDSESSION`消息，则需要将其发送 `SendMessage`到当前进程中的所有窗口。可以从这里找到起始示例代码：

[https://github.com/qakit/headless.git](https://github.com/qakit/headless.git)

但它只发送`WM_ENDSESSION`消息，您需要改为使用`WM_QUERYENDSESSION`并添加给定进程的窗口枚举。

相关链接：

*   [https://devblogs.microsoft.com/oldnewthing/20130627-00/?p=3973](https://devblogs.microsoft.com/oldnewthing/20130627-00/?p=3973)
*   [https://devblogs.microsoft.com/oldnewthing/20170329-00/?p=95855](https://devblogs.microsoft.com/oldnewthing/20170329-00/?p=95855)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-06T16:30:15.443

您可以使用[SystemEvents.SessionEnding](http://msdn.microsoft.com/en-us/library/microsoft.win32.systemevents.sessionending.aspx)事件，该事件在用户注销或关闭时触发。使用时要小心，但不能保证某些资源可用。例如，我的应用程序在关闭时需要访问服务器以将用户打卡（时钟应用程序），但是当此事件发生时，网卡有时已经被禁用。由于您只是在进行清理，因此应该可以正常工作。

# c# - 如何为自动生成的列设置 DataGridView 列属性？

> ID：520914
> 
> 赞同：0
> 
> 时间：2009-02-06T16:12:17.447
> 
> 标签：c#, winforms, visual-studio-2008, datagridview

`DataTable`我在绑定到 a 的a 中编辑数据`DataGridView`。当在视图中创建`DataTable`新列时，会在视图中生成一个新列。

通常我会在`DataGridView_ColumnAdded`事件中设置视图列属性，但是目前列的默认设置是添加一个视图列，其`SortMode`设置为`Automatic`与属性不兼容，`DataGridView` `ColumnHeaderSelect`并在列添加事件可以触发之前导致错误。

我想我可以通过为新生成的列定义一个“模板”列来解决这个问题——但是如何呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-06T17:01:00.017

好的，是时候破解它了：

为了演示，这里有一个小应用程序：

```
 public partial class Form1 : Form
    {
        DataTable table = new DataTable();
        public Form1()
        {
            InitializeComponent();
            this.dataGridView1.SelectionMode = DataGridViewSelectionMode.ColumnHeaderSelect;
            this.dataGridView1.ColumnAdded += new DataGridViewColumnEventHandler(dataGridView1_ColumnAdded);
        }

        void dataGridView1_ColumnAdded(object sender, DataGridViewColumnEventArgs e)
        {
            Console.WriteLine("Column added");
            e.Column.SortMode = DataGridViewColumnSortMode.NotSortable;
        }

        private void button1_Click(object sender, EventArgs e)
        {

            table.Columns.Add("Name");
            table.Columns.Add("Age", typeof(int));

            table.Rows.Add("John", 27);
            this.FlipSelectionMode();
            this.dataGridView1.DataSource = table;
            this.FlipSelectionMode();

        }

        private void button2_Click(object sender, EventArgs e)
        {
            this.FlipSelectionMode();
            table.Columns.Add("Height",typeof(int));
            table.Rows[0]["Height"] = 60;
            this.FlipSelectionMode();
        }

        private void FlipSelectionMode()
        {
            this.dataGridView1.SelectionMode = this.dataGridView1.SelectionMode == DataGridViewSelectionMode.ColumnHeaderSelect ? DataGridViewSelectionMode.CellSelect : DataGridViewSelectionMode.ColumnHeaderSelect;
        }
    } 
```

基本上，一开始我将DataGridView选择模式设置为ColumnHeaderSelect。在 button1 单击时，我将内容添加到数据表中，然后将其绑定到 DataGridView。诀窍是，我在绑定 DGV 之前和之后调用了一个名为 FlipSelectionMode() 的方法。它的作用是，如果它处于 columnheaderselect 模式，它会将其翻转为单元格选择，反之亦然。这样就可以添加列。然后，在添加列事件中，我将列排序属性设置为程序化，否则，您将无法添加另一列。为了证明这一点，在 button2 单击时，它只是添加了另一列，同时在前后翻转选择模式。

我同意，这完全是 hack，但 DGV 很时髦。我有很多很多问题，而且我几乎总是不得不破解一些东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T16:39:25.240

有趣 - 我已经做了很多，`DataGridView`但我还没有看到这个。也许务实的选择可能是手动构建列？可能不是你想听的……

# java - Java 和 .NET 堆开销

> ID：520922
> 
> 赞同：3
> 
> 时间：2009-02-06T16:13:55.960
> 
> 标签：java, .net, garbage-collection, clr, jit

我了解堆和垃圾收集器的工作原理：垃圾收集分代发生，内存分配顺序发生，在垃圾收集期间通过移动数据和形成连续块等压缩空闲/未使用空间等。

是否存在已分配内存块的标头以及它们有多大（我听说 .NET CLR 是 8-16 个字节）以及是否存在字节、字或四字对齐？我对 x86 和 x64 处理器架构的 JIT (Java) 和 CLR (.NET Framework 或 Mono) 实现的任何信息感兴趣。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-06T17:02:00.933

我相信标题大小是两个词 - 一个用于类型参考，一个用于同步块和其他标志。填充（我相信）足以将总大小四舍五入到整数个单词。

例如，只有一个“int”的引用类型在 x86 上占用 12 个字节，如下所示：

```
using System;

public class Foo
{
    int x;

    public Foo(int x)
    {
        this.x = x;
    }
}

public class Test
{
    static void Main(string[] args)
    {
        int length = int.Parse(args[0]);

        Foo x = new Foo(0);
        Foo[] array = new Foo[length];
        // Make sure that JITting the string constructor doesn't
        // change things
        long start = GC.GetTotalMemory(true);
        for (int i=0; i < length; i++)
        {
            array[i] = new Foo(i);
        }
        long end = GC.GetTotalMemory(true);

        GC.KeepAlive(array);
        GC.KeepAlive(x);

        decimal totalDecimal = end-start;
        Console.WriteLine(totalDecimal / length);
    }
} 
```

一个有趣的点——出于某种原因，System.Object 的一个实例占用了 12 个字节（在 x86 上），而不是我原本预测的 8 个字节。就好像最小大小是 12 个字节，但是您可以免费获得前四个字节的真实数据 :)

我不知道为什么报告的大小不完全是整数，顺便说一句 - 我怀疑这与托管堆中每页所需的一点额外内存有关，或者类似的东西。有时结果略高于 12，有时略低于 12——这似乎取决于给定的长度。（这个答案的先前版本有一个错误，它会解析第一个命令行 arg 但然后忽略它。我已经修复了。）无论如何，我不相信这种轻微的不准确与大小有关内存中的单个对象。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-08-25T08:21:28.650

这个问题的完整答案实际上会相当复杂：与对象分配相关的开销不仅取决于特定虚拟机的实现细节，而且还取决于对象恰好所在的世代（换句话说，与特定对象相关的开销可能会在对象的生命周期内发生变化）。

很少有简单的实用程序可用于估计特定对象的开销，但没有什么强大的（例如，请查看[http://java.sun.com/docs/books/performance/1st_edition/html/JPRAMFootprint.fm。 html](http://java.sun.com/docs/books/performance/1st_edition/html/JPRAMFootprint.fm.html) ).

在 Java 中，还有一个接口可能会为您提供包括开销在内的对象大小，请参阅[http://download-llnw.oracle.com/javase/6/docs/platform/jvmti/jvmti.html#GetObjectSize](http://download-llnw.oracle.com/javase/6/docs/platform/jvmti/jvmti.html#GetObjectSize)。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-02-06T16:42:34.890

我不了解 Java，但对于 CLR，每个分配的*引用类型有 1 个本机字开销。*在 32 位系统上，它将是 4 个字节，而在 64 位系统上，它将是 8 个字节。

# algorithm - 计算游戏中相对于先前分数和其他玩家的最终分数

> ID：520930
> 
> 赞同：2
> 
> 时间：2009-02-06T16:15:31.480
> 
> 标签：algorithm, scoring

假设一个多人游戏，你最公平的方法是根据所有玩家之前的分数给出最终分数。

例如，在一场两人比赛中，球员 A 的得分是球员 B 的两倍。“A”先完成不会给他很多分；最后，他会失去很多积分。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-06T16:21:14.090

你读过国际象棋中使用的[Elo Rating System吗？](http://en.wikipedia.org/wiki/Elo_rating_system)

我认为它不完全适合您的场景，但它可能会给您一些想法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-06T16:19:47.930

您可能想要使用类似于 FIDE 用于国际象棋分数的东西，即[Elo 评分系统](http://en.wikipedia.org/wiki/Elo_rating_system)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-06T21:48:31.637

微软有一个非常酷的评级系统，我有朝一日要在我的队列中实施。它被称为TrueSkill。它可以让您在面对面和团队中调整玩家的评分。你可以在这里阅读：[http ://research.microsoft.com/en-us/projects/trueskill/details.aspx](http://research.microsoft.com/en-us/projects/trueskill/details.aspx)

优点是它应该会很快吸引你的真实技能（通常在 20 场或更少的比赛中）。缺点是相当复杂。

ELO 系统（和其他类似系统）有一个缺点，即它们会遇到称为点膨胀的问题。例如，如果 1500 旨在表示普通玩家，那么随着时间的推移，情况将不再如此。有了足够多的游戏，真正的平均值（对于整个人口）最终会增加。因此，平均玩家实际上可能是 1600，但意图是平均 1500。因此，许多普通玩家认为他们比他们更好:)。

但是，ELO 系统的优点是非常容易计算。

# asp.net - 组织 Web 应用程序

> ID：520937
> 
> 赞同：4
> 
> 时间：2009-02-06T16:16:34.833
> 
> 标签：asp.net, visual-studio, namespaces

你们如何组织您的 asp.net Web 应用程序？您是否在应用程序或单独的类库中有课程？您如何按类型、功能、层级将类拆分为名称空间？我有一个很棒的工作应用程序，但是代码有点乱，我想看看组织它的最佳方式。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-06T16:32:24.723

我按层次组织我的课程。

在小型项目中，我有一个用于数据访问的类库、一个用于业务实体的类库、一个用于实用程序类的类库（包括我的可重用代码）和一个 Web 应用程序项目。

命名空间是这样的：

*   我的项目名称.DAL
*   我的项目名称.BLL
*   我的项目名称.实用程序
*   我的项目名称.Web

我从不将类添加到 Web 应用程序项目中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-06T16:30:07.847

我保持简单。

App_code - 包含分组到文件夹中的类

控件 - 包含分组到文件夹中的用户控件

图像 - 包含图像

样式 - 包含 css

js- 包含 javascript

任何其他有意义的页面分组的文件夹。示例：管理页面进入管理文件夹。管理母版页也将进入此文件夹。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-06T16:38:18.517

我和 ScarletGarden 在这件事上。我的偏好是为逻辑组件创建单独的类库，并尽可能将类排除在 Web 应用程序之外。如果您需要重用库、将功能移植到不同的技术（桌面、移动设备等），或者针对您的逻辑编写单元测试，将它们作为独立单元真的很方便。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-06T16:43:04.123

核心组件、库组件、模块组件、模板和配置/环境/引导

/包括

```
/core
/lib
/modules
/templates
config
enviornment 
```

是我的应用程序结构的基础，实际的应用程序有一个单一的入口点，所以几乎所有的东西都是从这个或它的子目录控制的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-06T16:50:57.587

我通常使用 Brian 和 ScarletGarden 所说的组合。我喜欢将我的业务逻辑和数据访问放在一个单独的类库中，但是与 Web 相关的实用程序类、页面基类等放在 Web 项目的文件夹中。如果我认为我的自定义控件会被重用，我也会给他们一个单独的项目。

# html - CSS 字体大小：相对值与绝对值。使用哪个？

> ID：520939
> 
> 赞同：30
> 
> 时间：2009-02-06T16:17:20.697
> 
> 标签：html, css, fonts, font-size

*   跨浏览器调整文本大小的最佳方法是什么？
*   以像素 / em 为单位定义字体大小的优点和缺点是什么？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-02-06T19:36:53.633

> 使用哪个？

两个都。相对于用户需要大量阅读的主体文本（因此他们希望能够舒适地阅读）；对于必须调整大小以匹配页面上以像素为单位大小的其他元素（例如图像）的文本的绝对值。

对于相对而言，'%' 和 'em' 同样好。

对于绝对值，请始终使用“px”。永远不要在屏幕上使用“pt”，它只对打印样式表有意义。遗憾的是，'pt' 被认为是字体处理的默认单位，因为在网络上它是最糟糕的选择。

（ETA：请注意，自从这个答案以来，CSS3[重新定义](http://www.w3.org/TR/css3-values/)了“物理单位”，因此`px`并且`pt`总是成比例的。所以这个问题不再重要，除非你关心非常旧的浏览器。）

有些人不喜欢相对字体大小的“复合”效果。实际上，诀窍是尽可能少地使用字体大小更改，以避免过多的嵌套。通过使用字体大小关键字“small”/“medium”/“xx-large”/等，应该可以在没有复合行为的情况下获得相对于用户的首选大小行为，但不幸的是，你就是*这样*没有得到太多的粒度，即使在今天浏览器处理它们的方式之间仍然存在差异。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-02-06T16:26:33.407

我将字体大小保持为用户选择的默认值，然后使用相对大小：

```
body {
    font-size: 100%;
}

p {
    font-size: 1em;
}

h1 {
    font-size: 1.8em;
} 
```

此方法尊重用户在浏览器中选择的字体大小，通常设置为 16px。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-02-06T16:22:30.437

我个人设置了绝对字体大小，`body`然后从那里将所有内容设置为相对于该字体大小。例如：

```
body {
    font-size: 10px;    /* or pt if you want */
}
h1 {
    font-size: 200%;
} 
```

尽量避免组合复合相对大小：

```
body {
    font-size: 10px;
}
p {
    font-size: 80%; /* 8px, right? */
}
div {
    font-size: 150%;
}
/* what size is a "div > p" ? */ 
```

如今，所有现代浏览器都具有整页缩放功能，这意味着即使以像素为单位调整字体大小也可以。

这种方法的好处是您可以通过更改一个定义轻松地放大或缩小所有文本。

不利的一面是，如果您想更改默认字体大小，而不是标题（例如），那么会有很多声明需要更改。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-06T16:33:45.593

A List Apart对字体大小在各种浏览器中的工作方式进行了[广泛的撰写。](http://www.alistapart.com/articles/howtosizetextincss/)事实证明它比你想象的要复杂，就像 CSS 中的其他一切一样。共识似乎倾向于使用 em，因为这使用户可以更好地控制浏览器中的字体大小。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-06T16:22:29.953

我更喜欢相对值，因为 Internet Explorer (< 7?) 无法缩放绝对值或像素值。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-06T16:23:37.347

我见过人们使用的一件事是在正文 CSS 中定义基本字体大小（例如，12pt），然后所有其他字体大小都是它的百分比（例如，标题为 140%，小字体为 80%，等等）。

如果您使用 pt ，那么您将根据用户设置的 DPI 在显示上有所不同，但它可能会在用户的控制之下。

如果您使用 px，那么在非常高 DPI 的设备上会出现问题。

Em 和 pt 非常适合用于打印的 CSS。

有很多事情要做，看看字体和 CSS 会发生什么。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-06T16:27:42.500

如果您使用绝对尺寸，那么任何视障读者都可能会觉得难以阅读。如果您使用相对大小，那么您只是指定哪些文本比页面上的其他文本更大/更小，所有这些都与用户的默认文本大小相关，可能很大（如果受损）或很小（如果有点奇怪）。

相对大小的文本的一个缺点是当您希望您的网站是固定大小时，但如果可能的话，您应该采用更流畅的设计，以便页面调整大小以适应其内容。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-06T16:28:01.953

像素是固定大小的。这意味着在任何屏幕和分辨率上查看时，文本的大小*始终*相同。

Em 具有可扩展性，这意味着使用不同屏幕尺寸和分辨率的人通常可以获得更好的体验。

某些浏览器在更改固定字体大小类型（px 和 pt）的大小时存在问题，因此对于网络字体往往不是很好，因为某些用户可能需要使用屏幕放大镜或仅使用鼠标滚轮来增加字体的大小.

相对字体大小习惯于激怒无知的设计师，他们会因为网站与他们的设计不*完全对应而感到厌烦。*

在我看来，安抚应该更了解的设计师并不足以成为在 Web 开发中使用固定字体的理由。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-06T16:31:43.867

使用 EM 缩放对字体更通用。它也更易于访问。

如果您以前没有使用过此工具，那么[Em Calculator](http://riddle.pl/emcalc/)之类的工具对于了解标签/模型的工作方式非常有用。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-06T16:21:58.020

使用相对大小将使您的页面在 iPhone 等移动设备上看起来更好，特别是因为它们在更大的视口上呈现页面，然后将其缩小以适应所需的空间。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-03-16T07:22:26.747

如果您可以放弃对 IE8 的支持，那么我建议使用`rem`单位。它们是像 em 这样的相对单位，但它们不会级联到子元素，使它们更易于使用

`em`很复杂

```
p {
  font-size: 2.5em;
  span {
    font-size: 1.5 em;
    /* font size comes out to 3.75 root em*/
  }
} 
```

`rem`更简单

```
p {
  font-size: 2.5rem;
  span {
    font-size: 1.5 rem;
    /* font size comes out to 1.5 root em*/
  }
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-06T16:37:57.893

我的大部分编程背景是桌面应用程序，但我最近阅读了大量有关 Web 开发的书籍，我遇到的书籍建议使用关键字字体大小规范（小、中等），然后将其放大或按百分比或 em 下降。

如果您的字体大小以 px 为单位指定，则旧版本 IE 的用户将无法覆盖文本的大小，即他们将无法根据自己的喜好将其放大或缩小。

但是，IE5 也存在一个问题，当你的字体大小由关键字指定时：相对于其他浏览器，IE5 显示的文本大约要大一倍。

# .net - MVC 框架中的复选框数组

> ID：520944
> 
> 赞同：0
> 
> 时间：2009-02-06T16:18:06.153
> 
> 标签：.net, asp.net-mvc

好的，不确定 MVC 框架 RC1 中的这些复选框发生了什么，但这是我得到的。我正在视图上使用 foreach 循环创建复选框，但是当我尝试使用控制器中的 Request.Form.Keys 访问它们时，我什么也得不到。我的问题是 Request.Form.Keys 是如何填充的？我知道复选框输入在表单上，​​但在返回键方面我一无所获。

这是代码示例

```
<% foreach (var item in Model){ %>
<tr align="center">
<% if (item.IsActive){ %>
<td><%= Html.CheckBox("session." + item.SessionID, item.SessionID)%></td>
<% } else { %>
<td><b>Closed</b></td>
<% } %> 
```

控制器使用这个

```
foreach (String key in Request.Form.Keys)
{
    if (key.StartsWith("Session."))
    {
         //Do Something
     }
} 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-10T19:14:42.607

String.StartsWith() 默认区分大小写。您正在将名称“session.{stuff}”呈现给表单，但您正在检查“Session.{stuff}”（注意不同的大小写）。使这些一致是否可以解决您的问题？

# c# - 使用用户控件之类的东西来放入 aspx 页面

> ID：520948
> 
> 赞同：0
> 
> 时间：2009-02-06T16:18:44.280
> 
> 标签：c#, .net, user-controls, include

基本上我只想要一个可以放入头部的包含控件以及可以嵌套的东西（可选）。我想把css和js文件的链接放在那里，所以我把它们都放在一个地方。没有母版 - 我试图（阅读必须）在这个项目中避免它们。用户控件可以正常工作，但我想这是一种奇怪的使用方式，并且 Visual Studio 无法在编辑器中页面的 HEAD 部分正确呈现它们。话虽如此，我已经成功地为此目的使用了用户控件，没有任何问题。但是，我想在这里与 .NET 专业人士核实一下，看看是否还有其他更好的方法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-06T16:22:45.397

尝试将[`Placeholder`](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.placeholder(VS.71).aspx)控件添加到您的 aspx 文件的头部。A`Placeholder`本身不呈现任何 html，但它确实有一个`ControlCollection`您可以添加任何您喜欢的内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T16:25:28.090

您可以使用[模拟的包含文件](http://msdn.microsoft.com/en-us/library/aa479009.aspx)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-06T17:05:34.873

您也可以使用文字控件。

# sql-server-2005 - 更改 SQL Reporting Services 2005 的 Web 服务标识的后果

> ID：520955
> 
> 赞同：0
> 
> 时间：2009-02-06T16:19:36.650
> 
> 标签：sql-server-2005, configuration, reporting-services

由于我计划安装的软件的要求，我必须更改运行 SQL Reporting Services 2005 的 IIS 应用程序池的标识。不幸的是，我无法找到任何有关这样做的后果的信息。

我希望这里的某个人能够向我指出有关该主题的一些信息。

如果您需要更多信息，请询问，我会发布我可以发布的内容。

SQL Reporting Services 当前在专用服务器上运行。应用程序池当前使用“NT Authority\NetworkService”，需要更改为使用 Active Directory 域帐户。我正在安装的应用程序分布在多个服务器上。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-06T22:09:24.527

更改它应该不是问题，因为 SSRS 服务使用通过 SSRS 配置实用程序指定的帐户连接到数据库。

# python - 使用 python cmd 模块进行分页

> ID：520963
> 
> 赞同：9
> 
> 时间：2009-02-06T16:21:16.833
> 
> 标签：python, pagination, cmd

我正在使用[cmd](http://docs.python.org/library/cmd.html)模块对 Python 应用程序进行原型设计。

给用户的一些消息会很长，我想给它们分页。将出现消息的前 10 行（或可配置的数量），按空格键将显示下一页，直到消息结束。

我不想在这里重新发明一些东西，有没有简单的方法来实现这个功能？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-06T16:42:32.737

简单的事情就是在运行时通过“less”或类似的命令来管道你的脚本。

不过，这是一个简单的方法，可以大致完成您想要的操作：

```
def print_and_wait(some_long_message):
    lines = some_long_message.split('\n')
    i=0
    while i < len(lines):
        print '\n'.join(lines[i:i+10])
        raw_input("press enter to read more...")
        i += 10 
```

你也可以考虑使用诅咒。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-30T21:07:16.760

正如 Yoni 上面所说的那样，正确的方法是提供一种打印方法，该方法在您正在运行的 cmd 实例中自动分页。Cmd 的构造函数接受 stdin 和 stdout 参数。如此简单地提供一个像标准输出一样工作并支持您的分页打印方法的对象。

```
class PagingStdOut(object):
    def write(self, buffer, lines_before_pause=40):
        # do magic paging here... 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-04T17:31:11.493

我有同样的问题。[**pydoc**模块](http://docs.python.org/library/pydoc)中内置了一个寻呼机。我就这样合并了它（我觉得这很老套而且不令人满意......不过我对更好的想法持开放态度）。

我喜欢这样的想法，即如果有超过*x 个*结果并且分页处于打开状态，它会自动分页，这是可以实现的，但在这里没有完成。

```
import cmd
from pydoc import pager
from cStringIO import StringIO
import sys

PAGER = True
class Commander(cmd.Cmd):
    prompt = "> "
    def do_pager(self,line):
        global PAGER
        line = line + " 1"
        tokens = line.lower().split()
        if tokens[0] in ("on","true","t", "1"):
            PAGER = True
            print "# setting PAGER True"
        elif tokens[0] in ("off","false","f","0"):
            PAGER = False
            print "# setting PAGER False"
        else:
            print "# can't set pager:  don't know -> %s" % tokens[0]

    def do_demo(self,line):
        results = dict(a=1,b=2,c=3)
        self.format_commandline_results(results)

    def format_commandline_results(self,results):
        if PAGER:
            ofh = StringIO()
        else:
            ofh = sys.stdout

        for (k,v) in sorted(results.items()):
            print >> ofh, "%s -> %s" % (k,v)

        if PAGER:
            ofh.seek(0)
            pager(ofh.read())

        return None

    def do_EOF(self,line):
        print "",
        return True

if __name__ == "__main__":
    Commander().cmdloop("# try: \n> pager off \n> demo \n> pager on \n> demo \n\n") 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-02T07:37:36.683

分页子例程可以在[IPython的](http://ipython.scipy.org/)[genutils.py](http://bazaar.launchpad.net/~ipython-dev/ipython/trunk/annotate/head%3A/IPython/genutils.py)文件中找到（参见，或更简单的一个）。代码有点复杂，但如果您尝试移植到包括 Windows 和各种终端仿真器在内的系统，这可能是不可避免的。`page``page_dumb`

# sql-server - SQL Server：数据库卡在“正在恢复”状态

> ID：520967
> 
> 赞同：608
> 
> 时间：2009-02-06T16:21:45.040
> 
> 标签：sql-server, backup, restore

我备份了一个数据库：

```
BACKUP DATABASE MyDatabase
TO DISK = 'MyDatabase.bak'
WITH INIT --overwrite existing 
```

然后尝试恢复它：

```
RESTORE DATABASE MyDatabase
   FROM DISK = 'MyDatabase.bak'
   WITH REPLACE --force restore over specified database 
```

现在数据库卡在恢复状态。

有人推测这是因为备份中没有日志文件，需要使用以下方式前滚：

```
RESTORE DATABASE MyDatabase
WITH RECOVERY 
```

当然，除了失败：

```
Msg 4333, Level 16, State 1, Line 1
The database cannot be recovered because the log was not restored.
Msg 3013, Level 16, State 1, Line 1
RESTORE DATABASE is terminating abnormally. 
```

在灾难性情况下，您想要的正是无法进行的恢复。

* * *

备份包含数据和日志文件：

```
RESTORE FILELISTONLY 
FROM DISK = 'MyDatabase.bak'

Logical Name    PhysicalName
=============   ===============
MyDatabase    C:\Program Files\Microsoft SQL Server\MSSQL.1\MSSQL\DATA\MyDatabase.mdf
MyDatabase_log  C:\Program Files\Microsoft SQL Server\MSSQL.1\MSSQL\DATA\MyDatabase_log.LDF 
```

* * *

## 回答 #1

> 赞同：790
> 
> 时间：2009-07-28T15:21:16.210

我遇到了使用 Symantec Backup Exec 11d 将数据库还原到 SQL Server 2005 Standard Edition 实例的这种情况。还原作业完成后，数据库仍处于“正在还原”状态。我没有磁盘空间问题——数据库根本没有脱离“正在恢复”状态。

我对 SQL Server 实例运行以下查询，发现数据库立即可用：

```
RESTORE DATABASE <database name> WITH RECOVERY 
```

* * *

## 回答 #2

> 赞同：462
> 
> 时间：2009-02-06T16:39:44.100

您需要将该`WITH RECOVERY`选项与您的数据库`RESTORE`命令一起使用，以使您的数据库在线作为恢复过程的一部分。

当然，这仅适用于您不打算恢复任何事务日志备份的情况，即您只希望恢复数据库备份然后能够访问数据库。

你的命令应该是这样的，

```
RESTORE DATABASE MyDatabase
   FROM DISK = 'MyDatabase.bak'
   WITH REPLACE,RECOVERY 
```

使用 SQL Server Management Studio 中的还原数据库向导可能会获得更多成功。这样，您可以选择特定的文件位置、覆盖选项和 WITH Recovery 选项。

* * *

## 回答 #3

> 赞同：109
> 
> 时间：2009-05-07T21:50:36.620

这是你如何做到的：

1.  停止服务（MSSQLSERVER）；
2.  重命名或删除数据库和日志文件 (C:\Program Files\Microsoft SQL Server\MSSQL.1\MSSQL\Data...) 或您拥有文件的任何位置；
3.  启动服务（MSSQLSERVER）；
4.  删除有问题的数据库；
5.  再次恢复数据库。

* * *

## 回答 #4

> 赞同：88
> 
> 时间：2011-01-11T13:51:04.230

我在停止日志传送辅助服务器时遇到了类似的事件。在命令从日志传送中删除服务器并停止从主服务器的日志传送之后，辅助服务器上的数据库在命令之后陷入恢复状态

```
RESTORE DATABASE <database name> WITH RECOVERY 
```

数据库消息：

> RESTORE DATABASE 在 18.530 秒（0.000 MB/秒）内成功处理了 0 个页面。

18 秒后，数据库再次可用。

* * *

## 回答 #5

> 赞同：85
> 
> 时间：2014-09-05T11:25:56.240

我在使用 SQL Management Studio 进行还原时遇到了类似的问题。我试图将数据库的备份恢复到具有不同名称的新备份。起初这失败了，在修复了新数据库的文件名之后，它成功执行了——无论如何，我描述的问题再次发生，即使我第一次就做对了。因此，在恢复后，原始数据库的名称旁边仍保留有 (Restoring...)。考虑到上面论坛（Bhusan's）的答案，我尝试在下面的查询编辑器中运行：

```
RESTORE DATABASE "[NAME_OF_DATABASE_STUCK_IN_RESTORING_STATE]" 
```

这解决了这个问题。起初我遇到了麻烦，因为数据库名称包含特殊字符。我通过在周围添加双引号解决了这个问题 - 单引号不起作用，给出“...附近的语法不正确”错误。

这是我尝试解决此问题的最小解决方案（将数据库卡在恢复状态），我希望它可以应用于更多案例。

* * *

## 回答 #6

> 赞同：36
> 
> 时间：2009-06-26T10:11:54.470

好的，我有类似的问题，与 Pauk 的情况完全一样，它是由于服务器在恢复时磁盘空间不足而导致的，因此导致了永久恢复状态。如何在不停止 SQL Server 服务的情况下结束此状态？

我找到了解决方案:)

```
Drop database *dbname* 
```

* * *

## 回答 #7

> 赞同：30
> 
> 时间：2014-01-17T17:24:33.563

执行 RESTORE DATABASE/RESTORE LOG 命令时，默认使用 WITH RECOVERY 选项。如果您陷入“恢复”过程，您可以通过执行以下命令使数据库恢复在线状态：

```
RESTORE DATABASE YourDB WITH RECOVERY
GO 
```

如果需要恢复多个文件，CLI 命令分别需要 WITH NORECOVERY 和 WITH RECOVERY - 只有命令中的最后一个文件应该具有 WITH RECOVERY 才能使数据库恢复联机：

```
RESTORE DATABASE YourDB FROM DISK = 'Z:\YourDB.bak'
WITH NORECOVERY
GO
RESTORE LOG YourDB FROM DISK = 'Z:\YourDB.trn'
WITH RECOVERY
GO 
```

您还可以使用 SQL Server Management Studio 向导：

![在此处输入图像描述](https://i.stack.imgur.com/fctbj.png)

还有虚拟恢复过程，但您必须使用第 3 方解决方案。通常您可以使用数据库备份作为实时在线数据库。ApexSQL 和 Idera 有自己的解决方案。SQL Hammer[对 ApexSQL 恢复](http://www.sqlhammer.com/blog/accelerating-the-restore-process-apexsql-restore-product-review/)的评论。如果您要处理大量备份，虚拟还原是一个很好的解决方案。恢复过程要快得多，也可以节省大量磁盘驱动器空间。您可以在此处查看[信息图](http://www.apexsql.com/sql_tools_restore_infographics.aspx)进行一些比较。

* * *

## 回答 #8

> 赞同：24
> 
> 时间：2014-07-16T15:20:11.153

这可能是相当明显的，但它刚刚绊倒了我：

如果您正在进行尾日志备份，则此问题也可能是由于在 SSMS 还原向导中选中了此选项 - “使源数据库处于还原状态（WITH NORECOVERY）”

![在此处输入图像描述](https://i.stack.imgur.com/gWlxG.jpg)

* * *

## 回答 #9

> 赞同：17
> 
> 时间：2009-02-11T19:04:41.203

我想通了为什么。

如果发出该`RESTORE DATABASE`命令的客户端在恢复过程中断开连接，则恢复将卡住。

奇怪的是，当客户端连接告诉服务器恢复数据库时，除非客户端始终保持连接，否则服务器不会完成恢复。

* * *

## 回答 #10

> 赞同：14
> 
> 时间：2020-07-31T15:39:29.630

右键单击数据库转到任务 --> 恢复 --> 事务日志 在事务文件中，如果您看到一个文件被选中，则 SQL 服务器正在尝试从该文件恢复。取消选中该文件，然后单击“确定”。数据库回来了……

这为我解决了这个问题，希望这对某人有所帮助。

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2012-10-03T10:55:02.850

这个确实有效：

[http://social.msdn.microsoft.com/Forums/en/sqldatabaseengine/thread/8dd1b91d-3e14-4486-abe6-e3a550bfe457](http://social.msdn.microsoft.com/Forums/en/sqldatabaseengine/thread/8dd1b91d-3e14-4486-abe6-e3a550bfe457)

我的数据库显示正在恢复状态，我无法运行任何查询，也无法连接我们的软件。

我为摆脱这种情况所做的是：

1.  从 Windows 服务停止所有 SQL 相关服务。

2.  我打开了 Ldf 和 Mdf 文件位于 SQL 目录中的 DATA 文件夹，通常类似于：“C:\Program Files***********\MSSQL\DATA

3.  然后我复制了数据库的 Ldf 和 Mdf 文件：[db name].mdf 和 [db name]_log.ldf

我将这两个文件复制到另一个文件夹。

4.  然后我再次从 Windows 服务启动所有 SQL 相关服务（在步骤 1 中）。

5.  以正常登录方式启动了我的 MS SQL 管理工作室。

6.  右键单击罪魁祸首数据库并点击 DELETE（完全删除数据库）。

7.  与此数据库相关的所有 LDF 和 MDF 文件都已从 DATA 文件夹中删除（在步骤 2 中提到）。

8.  创建了一个具有相同名称的新数据库（与我在步骤 6 中删除的数据库相同的名称 - 罪魁祸首数据库）。

9.  然后【数据库名称】->右键->任务->脱机。

10.  然后我将两个文件（从步骤 3 开始）复制回 DATA 文件夹（步骤 2）。

11.  [数据库名称]->右键单击->任务->联机。

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2016-07-28T13:17:40.123

我曾有一个 。在我的数据库名称中，因此查询不起作用（在'。'附近说语法不正确）然后我意识到我需要一个括号作为名称：

```
RESTORE DATABASE [My.DB.Name] WITH RECOVERY 
```

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2018-07-18T15:36:12.510

就我而言，使用 SQL 命令**删除处于****“正在恢复...”**状态的数据库就足够了

```
 drop database <dbname> 
```

在查询窗口中。

然后我右键单击**数据库**并选择**刷新**，它删除了 Management Studio 中的条目。之后我做了一个新的恢复，效果很好（请注意，使它脱机不起作用，重新启动 SQL 服务不起作用，重新启动服务器也不起作用）。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2020-05-19T12:44:51.000

使用以下命令解决此问题

```
RESTORE DATABASE [DatabaseName] WITH RECOVERY 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2010-03-13T18:40:44.477

当我在事件日志中也收到 TCP 错误时，我遇到了这个问题......

使用 sql 删除数据库或在管理器“删除”中右键单击它并再次恢复。

我实际上已经默认开始这样做了。编写数据库删除脚本，重新创建然后恢复。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2017-04-11T19:27:15.947

默认情况下，每个`RESTORE DATABASE`都带有`RECOVERY`设置。'NORECOVERY' 选项基本上告诉 SQL Server 数据库正在等待更多的恢复文件（可能是**DIFF**文件和**LOG**文件，并且可能包括尾日志备份文件，如果可能的话）。'RECOVERY' 选项，完成所有事务并让数据库准备好执行事务。

所以：

1.  如果您的数据库设置为使用**简单**恢复模式，则只有当您有**DIFF**备份时，您才能使用选项执行**FULL**恢复。**SIMPLE**恢复模型数据库中不允许有**LOG**备份。`NORECOVERY`
*******   否则，如果您的数据库设置为**FULL**或**BULK-LOGGED**恢复模式，您可以执行**FULL**恢复`NORECOVERY`，然后执行 option，然后执行**DIFF** ，然后执行`NORECOVERY`，最后，执行**LOG**恢复`RECOVERY`选项。******

 ****请记住，**最后的恢复查询必须有`RECOVERY`OPTION**。这可能是一种明确的方式，也可能不是。在T-SQL的Therms中，情况：

1.

```
 USE [master]
    GO
    RESTORE DATABASE Database_name 
    FROM DISK = N'\\path_of_backup_file.bak WITH FILE = 1, [REPLACE],NOUNLOAD, 
    RECOVERY -- This option could be omitted.
    GO 
```

**必须谨慎使用 WITH REPLACE 选项，因为它可能导致数据丢失**

或者，如果您执行 FULL 和 DIFF 备份，您可以使用此

```
 USE [master]
    GO
    RESTORE DATABASE Database_name
      FROM DISK = N'\\path_of_backup_file.bak' WITH FILE = 1, 
       NOUNLOAD,NORECOVERY
    GO
    RESTORE DATABASE Database_name
      FROM DISK =N'\\path_of_**diff**backup_file.bak' WITH FILE = 1, 
     NOUNLOAD, RECOVERY
    GO

 2\. USE [master]
    GO
   -- Perform a Tail-Log backup, if possible. 
   BACKUP LOG Database_name
   GO
   -- Restoring a FULL backup
   RESTORE DATABASE Database_name
    FROM DISK = N'\\path_of_backup_file.bak' WITH FILE = 1, 
     NOUNLOAD,NORECOVERY
  GO 
  -- Restore the last DIFF backup
  RESTORE DATABASE Database_name
    FROM DISK = N'\\path_of_DIFF_backup_file.bak' WITH FILE = 1,
     NORECOVERY,NOUNLOAD
  GO
  -- Restore a Log backup
  RESTORE LOG Database_name
    FROM DISK = N'path_of_LOG_backup_file.trn' WITH FILE = 2,
    RECOVERY, NOUNLOAD
  GO 
```

当然，您可以使用选项**STATS = 10**执行还原，该选项告诉 SQL Server 每完成 10% 报告一次。

如果您愿意，您可以观察过程或在基于实时的查询中恢复。如下：

```
USE[master]
GO
SELECT session_id AS SPID, command, a.text AS Query, start_time, percent_complete, dateadd(second,estimated_completion_time/1000, getdate()) as estimated_completion_time 
    FROM sys.dm_exec_requests r CROSS APPLY sys.dm_exec_sql_text(r.sql_handle) a 
        WHERE r.command in ('BACKUP DATABASE','RESTORE DATABASE')
GO 
```

希望这有帮助。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2009-08-28T05:42:02.360

如果启用快照，删除卡住的数据库也可能会出现问题。对我来说，这很有效：

1.  首先，我遵循[Tipu Delacablu](https://stackoverflow.com/questions/520967/sql-server-database-stuck-in-restoring-state/837220#837220)的步骤（阅读一些帖子）
2.  运行命令：drop database [your database]，这会给你一个错误，告诉你快照数据库的名称
3.  运行命令：drop database [snapshot database]，然后再次运行步骤2中的命令。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-02-06T20:25:17.187

您是否尝试过仅运行验证？只是为了确保它是一个健全的备份。

[http://msdn.microsoft.com/en-us/library/ms188902.aspx](http://msdn.microsoft.com/en-us/library/ms188902.aspx)

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2016-09-02T13:48:24.163

由于 SQL Express 许可限制，我得到了***MyDbName (Restoring...)案例。***

在日志文件中，我发现了这个：

> CREATE DATABASE 或 ALTER DATABASE**失败，因为**生成的累积数据库大小将超过 每个数据库**10240 MB 的许可限制。**

因此，如果您尝试恢复更大的数据库，例如，**您需要将 SQL Express 服务器切换到 Developer 版本**。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2018-10-31T21:36:14.123

为我解决的问题是

1.  停止实例
2.  在数据文件夹中创建 .mdf 和 .ldf 文件的备份
3.  重启实例
4.  删除数据库卡住恢复
5.  将 .mdf 和 .ldf 文件放回数据文件夹
6.  将实例附加到 .mdf 和 .ldf 文件

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2019-12-17T09:11:19.170

使用 SQL Server Management Studio 还原数据库时遇到类似问题，它陷入了还原模式。经过几个小时的问题跟踪，以下查询对我有用。以下查询将数据库从现有备份恢复到以前的状态。我相信，问题在于将 .mdf 和 .log 文件放在同一目录中。

```
RESTORE DATABASE aqua_lc_availability
FROM DISK = 'path to .bak file'
WITH RECOVERY 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2013-05-14T08:04:32.940

1.  首先让我们检查并运行 SQL 代理服务。
2.  使用以下 T-SQL：

    从 master.sys.sysaltfiles 中选择文件名，其中 dbid = DB_ID('db_name');

3.  连续使用 T-SQL：

    RESTORE DATABASE FROM DISK = 'DB_path' WITH RESTART, REPLACE;

希望这有帮助！

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2015-03-26T09:31:01.903

所有基于 WITH RECOVERY 的选项都不适合我。

所做的是从 Management Studio 进行完全恢复。

```
USE [master]
RESTORE DATABASE Sales_SSD
FROM  DISK = N'D:\databaseBackups02\Daily_Sales_20150309_0941.bak' 
WITH  FILE = 1,  
MOVE N'Sales_Data' TO N'C:\Data\SSD\Sales.mdf',  
MOVE N'Sales_Log' TO N'C:\Data\SSD\Sales_1.ldf',  
NOUNLOAD,  REPLACE,  STATS = 5 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2015-09-18T21:07:07.407

我有同样的问题......虽然我不知道为什么我的数据库遇到这个问题，因为我的驱动器没有满......就像它被损坏了一样。我尝试了以上所有方法都没有完全工作，我特别认为停止服务并删除 mdf 和 ldf 文件的建议会起作用......但它仍然在恢复时冻结？

我最终通过删除提到的文件解决了这个问题，但我没有尝试再次恢复数据库，而是复制了新的 .mdf 和 .ldf 文件，并使用前端附件向导附加了这些文件。放心，成功了！！

当我使用虚拟机时，它需要永远复制新文件......所以使用剪贴板复制和粘贴本身需要一个小时，所以我只推荐这是最后一次尝试。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2019-05-09T06:09:11.473

```
RESTORE DATABASE {DatabaseName}
   FROM DISK = '{databasename}.bak'
   WITH REPLACE, RECOVERY 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2020-11-19T09:04:17.920

如果要从备份文件恢复 SQL Server 数据库，可以使用以下脚本：

```
RESTORE DATABASE [MyDatabase] -- which database to restore
FROM DISK = N'X:\MyDatabase.bak' -- location of the database backup
WITH 
    FILE = 1, -- restore from a backup file
    -- declare where the file groups should be located (can be more than two)
    MOVE N'MyDatabase_Data' TO N'D:\SSDPATH\MyDatabase.mdf',
    MOVE N'MyDatabase_Log' TO N'E:\HDDPATH\MyDatabase.ldf',
    -- Tape option; only relevant if you backup from magnetic tape
    NOUNLOAD,
    -- brings the database online after the database got restored
    -- use this option when you don't want to restore incremental backups
    -- use NORECOVERY when you want to restore differential and incremental backup files
    RECOVERY,
    -- replace existing database with the backup 
    -- deletes the existing database
    REPLACE, 
    -- print log message for every 1 percent of restore
    STATS = 1; 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2020-12-10T05:58:54.803

这是 SQL Server 一直存在的老问题，即使是最新的 2019 版本！我不知道为什么微软让这种痛苦持续了这么久，并允许他们的 MSSQL 引擎继续以这种方式运行。尽管如此，我还是为那些尝试了 RESTORE DATABASE WITH RECOVERY 选项的人提出了另一种可能的解决方案，但它仍然不起作用。

登录到服务器本身并在实际数据库服务器上启动默认的 SSMS 程序。接下来转到“恢复”数据库并删除它。完毕。问题消失了。如果您需要保留它，请复制 MDF 文件并将其重命名并将其作为新数据库附加。在 SQL Server 2008 R2 上为我工作。

# c - 正确学习 C：是或否？

> ID：520977
> 
> 赞同：7
> 
> 时间：2009-02-06T16:23:27.720
> 
> 标签：c, multithreading, apache2, apache2-module

我的主要语言是 PHP，但我用其他语言做了一些（不是很多）编程。

我用 C 为 Apache 编写了 2 个模块。我用 C 编写它们，因为这是性能确实很重要的事情之一。（动态生成世界的投影地图并输出到.png）。

这些模块可以工作，这是我能保证代码质量的程度。不要误会我的意思，我已尽力编写正确的代码，但我确信它还有很大的改进空间。

我正在考虑将当前模块更改为线程化的想法，但没有线程化软件的经验，并且像追查错误这样的事情仍然需要我很多时间。

**我的问题是：**
我应该先学会正确地用 C 编程（获得一份[The C Programming Language](https://stackoverflow.com/questions/457129/where-to-start-self-learning-c-or-should-i-learn-i-learn-a-different-language/457137#457137)的副本）还是你推荐另一种方法。

注意：
我目前没有将 C 用于 Apache 模块的计划

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-06T16:27:29.273

如果你对编程很认真，我认为学习 C 语言真的很重要。它是许多语言的基础，你会遇到很多用 C 编写的源代码。但是，我们可以看到 Java、C++ 等。

恕我直言，我认为您应该继续编写模块并根据需要学习新事物。这是学习事物的最佳方式

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-06T16:28:22.140

听起来你已经做得很好了。开源这些模块并征求社区的反馈呢？

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-06T17:09:10.077

**只学习尽可能多的知识。**

您无需花时间阅读 The C Programming Language 并学习该语言的每一个特性，它就会变得有用。根据需要使用 C 编程语言作为查找工具。如果您更频繁地开始使用 c 编程，那么花时间更彻底地学习这门语言。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-06T19:32:08.587

学习编程语言的最好方法是使用它。因此，向前迈进并实际用 C 编写 apache 模块是一个好方法。但是，如果您想深入了解该语言，您应该做几件事：

*   使用语言。你已经这样做了:)
*   了解语言。“圣经”K&R 是你至少应该有一些知识的东西——你不需要知道这本书的每一点，但你应该使用它来至少了解未使用的语言特性太频繁。总有一天会有所帮助的。
*   与他人合作。与其他人一起参与一个项目，让其他人阅读您的代码并阅读他们的代码。开源通常是这样做的好方法，尽管也有其他选择。

从我的“职业生涯”来说，我也是从 PHP 开始的，最后是 C。阅读书籍（我强烈推荐 Peter van der Linden 的“Expert C Programming”，遗憾的是已绝版）会让你更深入地了解语言的内部，从而使您成为更好的程序员。我不知道 K&R 的每一页，但我从不后悔使用它并习惯它（我想我宁愿使用它也不愿阅读它——它不是教科书，而是我认为的参考）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-06T16:27:41.907

我强烈推荐那本书。即使您将来不会看到自己使用 C，您也永远不知道是否必须这样做，这是一本完美的书，可以让您获得更多的 C 经验/知识。

如上所述，C 是许多其他流行语言的基础，因此即使您最终没有更多地使用 C，您也可能最终使用其中一种继任者。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-06T16:38:58.233

即使您将来没有使用 C 编程的计划，或者即使您确定永远不必使用某些与 c 相关的语言进行开发，出于历史原因，我还是会推荐 K&R 书：这是一个学习的好习惯众所周知的艺术大师。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-06T18:12:21.603

我认为您在这里面临的**真正问题是：**

1) C 适合你正在做的任务吗？
2）随着需求的变化，您是否应该增加对 C 语言的了解？

对于问题 1，您的应用程序可能有 C 的替代方案。您需要输出 .png 图像，并且需要管理线程：也许 Java 或 Python 是 C 的更好替代品（.png 输出在两种语言中都只有几行，而我认为您需要 C 中的外部库等。同样的事情用于穿线。

对于问题2，如果您坚持使用C，如果您想避免随着复杂性增加而陷入陷阱（尤其是对于像C这样的低级语言），那么最好更深入地研究该语言。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-06T16:31:10.560

我会说正确地学习一些东西永远不会有害。对 C 的扎实理解肯定会加深你对编程的理解。

将来您是否会使用该语言本身并不重要，但为了了解幕后发生的事情，它是无价的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-06T16:45:58.190

我想说，对于每个程序员来说，掌握 C 语言中很重要的低级概念是很重要的，比如指针和手动内存管理。这使您可以深入了解事物的实际工作原理，即使在更高级别进行编程时也很有用。但是，如果您不经常使用 C，我认为真正掌握整个语言没有任何意义。例如，我不会花太多时间在标准库上或学习如何用 C 设计重要的项目。只要坚持关键概念即可。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-06T16:51:25.137

我已经从 BASIC 发展到 FORTRAN，然后是 Java，目前主要使用 PHP 和 Perl 的组合。除了弄乱 Apache 模块之外，我从来没有真正使用过 C，但无论你学习哪种语言，最好的学习方法就是边做边学。

用一本书向你介绍这门语言，但要实际学习。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-06T17:44:22.627

我肯定会推荐获得 C 编程语言 (K&R)。这是对 C 的非常简洁和有用的参考。如果你觉得从 K&R 学习有点困难，我会毫不犹豫地买一本关于语言的更温和的书，但 K&R 是当你有东西时你会回来看的书'不确定。

此外，值得指出的是，线程编程打开了一个充满潜在问题的全新世界，所以我绝对建议你买一本书来学习如何正确地做到这一点。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-06T18:09:12.670

读了这本书。你会很高兴你做到了。它将向您介绍很多您不会遇到的东西。您将被介绍该语言的所有功能，而不是在您认为需要它们时偶然发现它们。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-08T01:55:47.063

也许我有点现代主义者，但如果你要正确学习 C，我不建议从 K&R 开始。为什么要研究过时的标准？拿起一本教你 C99 标准的书，然后从中学习。因为你已经有点熟悉了，可能是 C Primer Plus 或类似的东西。

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2009-02-06T16:26:18.243

如果您不打算将 C 用于其他任何事情，我建议您切换到 Java，因为它的并发性要容易得多（至少在我看来）。

它还有一个非常大的标准库，非常易于使用，并且可能会大大加快您的开发速度。

# c# - 将结果集导出到 Excel 时显示加载消息

> ID：520987
> 
> 赞同：0
> 
> 时间：2009-02-06T16:25:45.827
> 
> 标签：c#, asp.net, multithreading, loading

我正在使用 ASP.NET 和 C# 并将一个非常大的结果集导出到 Excel。当我的导出代码正在运行时，我想显示一个“加载”动画 gif，以便用户知道他们的请求正在处理中。我一直在尝试用多线程来做到这一点，但我对它不是很熟悉。谁能指导我正确的方向？谢谢！

乔恩

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-06T16:42:02.567

你想在服务器上做多线程吗？我建议在您的客户端 javascript 中打开请等待消息，然后再发布到服务器。然后在客户端，当您完成发布后，您会关闭消息。

在不了解您的实际设置的情况下，我无能为力，但上次我实现这一点时，我做了以下事情：

假设我们有一个使用 JQUERY 的名为 PrintLoadingPanel 的 div，我将 div 设置为显示并接管窗口：

```
 $("#printLoadingPanel")
       .css({display:"block",top:"0px",left:"0px",height:screen.availHeight}); 
```

然后我将启动一个以 1/2 秒为间隔的计时器，它将开始检查我们是否完成了打印。我只生成和下载小型 PDF，所以我需要更快的响应。如果您的报告真的很慢，您可能需要调整一下：

```
 window.setTimeout(checkIfDoneDownload,500); 
```

然后我的 CheckIfDoneDownload 函数访问服务器并检查我们是否完成了文件的生成并下载了它。我在这里再次使用 JQUERY 来调用启用 AJAX 的 WCF 服务。您可以将其替换为 PageMethods 或任何其他回调到服务器的方式。

```
function checkIfDoneDownload()
{

$.ajax({
  type: "POST",
  url: "../Services/Utilities.svc/IsPrintDownloadDone",
  data: "{}",
  contentType: "application/json; charset=utf-8",
  dataType: "json",
  success: function(msg) {
  if (msg.d)
  {
    $("#printLoadingPanel").css("display","none");
  }
  else  {window.setTimeout(checkIfDoneDownload,500);}
  },  
  error: function (xhr, textStatus, errorThrown) {
  if (xhr.status==12030) {checkIfDoneDownload();}
}
});
} 
```

现在在服务器端，我正在通过 HTTP 处理程序生成我的下载。本质上，它所做的第一件事是将会话级别标志设置为 false，然后它所做的最后一件事是将其设置回 true。我的检查是否完成服务只返回标志的值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T16:37:22.717

我在生成报告时遇到了同样的问题。一个简单的解决方案是在晚上运行报告，然后将其写入服务器。然后提供指向报告的链接。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-06T17:18:15.580

如果您能够使用 ASP.NET AJAX，那么我建议您使用该[`UpdateProgress`](http://www.asp.net/AJAX/Documentation/Live/Tutorials/IntroductionUpdateProgress.aspx)控件（连同`UpdatePanel`.

如果您想要一个漂亮的动画 gif 图像，请查看[Ajaxload](http://ajaxload.info/)。

# asp.net - 在 ASP.net 中提取水晶报表中的嵌入式查询

> ID：520991
> 
> 赞同：1
> 
> 时间：2009-02-06T16:27:04.780
> 
> 标签：asp.net, crystal-reports

有没有一种方法或 DLL 可以用来从水晶报表中提取嵌入式查询。我可以在基于 Windows 的应用程序中使用 CRAXDRT 来做同样的事情，但是当我尝试在 ASP.net 中做同样的事情时，整个应用程序都会挂起。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-12-07T19:38:35.927

CRAXDRT Report.SQLQueryString 属性似乎在 .Net SDK 中没有等效属性，相信我，我一直在寻找。

但是，它在 RAS SDK 中可用。******************