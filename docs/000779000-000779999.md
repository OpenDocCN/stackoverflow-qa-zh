# StackOverflow 问答 000779000-000779999

# c# - 对 Bind 的调用必须分配给模板内控件的属性

> ID：779001
> 
> 赞同：19
> 
> 时间：2009-04-22T20:16:18.343
> 
> 标签：c#, asp.net, image, gridview

我想在 gridview 中显示缩略图而不是文本。这就是我正在尝试的：

```
 <asp:TemplateField HeaderText="Image" SortExpression="Image">
            <EditItemTemplate>
                <asp:TextBox ID="TextBox1" runat="server" Text='<%# Bind("Image") %>'></asp:TextBox>
            </EditItemTemplate>
            <ItemTemplate>
                <asp:Image ID="thumbnail" runat="server" ImageUrl="<%# Bind("Image") %>" />                        
            </ItemTemplate>
        </asp:TemplateField> 
```

我应该使用什么语法？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-04-22T20:22:59.200

*   尝试对 ImageUrl 使用**Eval**而不是*Bind* - 这是一种绑定方式。

*   如果您仍然遇到问题，在属性周围使用单引号而不是双引号可能会有所帮助：`<asp:Image ID="thumbnail" runat="server" ImageUrl='<%# Eval("Image") %>' />`

# c - 固定宽度整数的格式说明符？

> ID：779012
> 
> 赞同：3
> 
> 时间：2009-04-22T20:19:29.893
> 
> 标签：c

在处理诸如 int32_t、uint16_t 和 int8_t 等类型时，用于 printf 的格式说明符是什么？

使用 %d、%i 等不会产生可移植的程序。使用 PRIxx 宏是最好的方法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-22T20:37:32.143

> Is using the PRIxx macros the best approach?

As far as I know, yes.

Edit: another solution is to cast to a type that is at least as wide as the one you want to print. For example `int` is at least 2 bytes wide, to can print a `int16_t` with `printf("%d\n", (int)some_var)`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-01-15T06:09:04.317

是的，如果您使用的是新类型，那么您确实应该使用新的格式说明符。

这是最好的方法，因为实现已经完成了确保格式字符串对于类型正确的繁重工作。

因此，例如：

```
#include <stdio.h>
#include <stdint.h>
#include <inttypes.h>

int main (void) {
    int32_t i32 = 40000;
    printf ("%d\n", i32);            // might work.
    printf ("%" PRId32 "\n", i32);   // will work.
    return 0;
} 
```

显示*了两种*方法。

但是，实际上*并不能*保证第一个会按照您的预期进行。例如，在具有 16 位`int`类型的系统上，您可能会得到不同的值。

# ruby-on-rails - Ruby 中的复杂关系 - 跨多个表显示数据

> ID：779013
> 
> 赞同：0
> 
> 时间：2009-04-22T20:19:33.637
> 
> 标签：ruby-on-rails, ruby

我设计了一个包含 20 多个表并使用 Ruby on Rails 的应用程序。我正在使用身份验证系统供用户登录。我想向用户显示，当他登录时，可以在许多表中找到与他相关的信息，这些表之间存在所有可能的关系。我怎样才能在 RoR 中做到这一点？我应该考虑使用视图、多个连接吗？我没有设法从一个模型中获取信息，而不是使用“有很多”、“：通过”等经典方法查看表格设计的 2 个表格。

你能分享你的知识吗？

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-22T20:32:24.590

I assume that your User model has relationships with all the tables that contain related information.

Assuming that, you can have an action in UsersController and a corresponding view. In the action you can find out who is the currently connected user, and then get all the data you need from the related models. Return these data to the view and render them as you like.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T20:38:54.857

我认为你的问题太笼统了，但这里有一些想法......假设你正在制作一个传统的 Rails 应用程序

“我应该考虑使用视图吗？”

视图是用户在传统 Rails 应用程序中看到的内容。因此，如果您想向用户显示数据，请使用视图来显示控制器中可用的数据。控制器中的每个动作都会从模型中获取数据，并具有相应的视图。

因此，要显示属于用户的书籍，您可能需要一个 Books 控制器。用户登录后，您在“图书”控制器中有一个“索引”操作，显示为@user_books = @user.books。在这种情况下，@user 将是您的身份验证系统中的用户对象。一个用户会有很多书，而一本书可能会有很多用户。然后在你的 views/books/index.html.erb 文件中你有类似的东西：

```
<ul>
<% @user_books.each do |b| %>
  <li> <%= b.name %> </li>
<% end %>
</ul> 
```

打印书名列表。

连接是由 Rails 自动完成的，所以你不必担心它。但是，如果您的应用程序变得非常大并且查询很复杂，您可能必须重写 SQL 语句以提高可伸缩性......但这显然是一个很好的问题。

希望这可以帮助！

# sql - 如何在 9.5.2 中使用 DB2 Text Search 突出显示搜索词？

> ID：779014
> 
> 赞同：3
> 
> 时间：2009-04-22T20:19:43.093
> 
> 标签：sql, full-text-search, db2

我有一个使用 DB2 9.5.2 中新的文本搜索功能的有效搜索查询：

```
select * 
from prevue.mysearchabletable mst 
where contains(mst.searchabletext, 'porsche') = 1; 
```

但是，这只告诉我哪些匹配，以及得分是多少（为简洁起见，省略了得分功能）。有没有办法使用 9.5.2 中的文本搜索来突出显示搜索词？

我知道在旧的 Net Search Extender 中有这样的功能，但我还没有在新的文本搜索系统中找到等效的（或解决方法）。

# html - 是否可以为有序列表指定起始编号？

> ID：779016
> 
> 赞同：126
> 
> 时间：2009-04-22T20:19:52.717
> 
> 标签：html, css, html-lists

我有一个有序列表，我希望初始数字为 6。我发现HTML 4.01[支持](http://www.w3schools.com/TAGS/tag_ol.asp)（现已弃用）。在本规范中，他们说您可以使用 CSS 指定起始整数。（而不是`start`属性）

您将如何使用 CSS 指定起始编号？

* * *

## 回答 #1

> 赞同：162
> 
> 时间：2009-04-22T20:25:50.580

如果您需要在特定点启动有序列表 (OL) 的功能，则必须将您的文档类型指定为 HTML 5；这是：

```
<!doctype html> 
```

使用该文档类型，`start`在有序列表上设置属性是有效的。如：

```
<ol start="6">
  <li>Lorem</li>
  <li>Ipsum</li>
  <li>Dolor</li>
</ol>
```

* * *

## 回答 #2

> 赞同：68
> 
> 时间：2009-04-25T15:20:27.737

`<ol start="">`[在HTML5](http://www.whatwg.org/specs/web-apps/current-work/multipage/semantics.html#attr-ol-start)中不再被弃用，所以我会继续使用它，不管 HTML4.01 说什么。

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2015-05-07T19:09:11.583

`start="number"`不幸的是，它不会根据之前的编号自动更改。

另一种可能满足更复杂需求的方法是使用`counter-reset`和`counter-increment`.

**问题**

假设你想要这样的东西：

```
1\. Item one
2\. Item two

Interruption from a <p> tag

3\. Item three
4\. Item four 
```

您可以设置第二个`start="3"`的第三`li`个`ol`，但现在您每次向第一个添加项目时都需要更改它`ol`

**解决方案**

首先，让我们清除当前编号的格式。

```
ol {
  list-style: none;
} 
```

我们会让每个人向柜台展示

```
ol li:before {
  counter-increment: mycounter;
  content: counter(mycounter) ". ";
} 
```

现在我们只需要确保计数器只在第一个`ol`而不是每个都重置。

```
ol:first-of-type {
  counter-reset: mycounter;
} 
```

**演示**

[http://codepen.io/ajkochanowicz/pen/mJeNwY](http://codepen.io/ajkochanowicz/pen/mJeNwY)

```
ol
  list-style: none

li
  &:before
    counter-increment: mycounter
    content: counter(mycounter) ". "

  &:first-of-type
    counter-reset: mycounter
```

```
<ol>
  <li>Item one</li>
  <li>Item two</li>
</ol>
<p>Interruption</p>
<ol>
  <li>Item three</li>
  <li>Item four</li>
</ol>
<p>Interruption</p>
<ol>
  <li>Item five</li>
  <li>Item six</li>
</ol>
```

现在我可以向任一列表添加尽可能多的项目，并且编号将被保留。

```
1\. Item one
2\. Item two
...
n. Item n

Interruption from a <p> tag

n+1\. Item n+1
n+2\. Item n+2
... 
```

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2017-07-25T06:07:44.153

我很惊讶我无法在这个帖子中找到答案。

我找到[了这个来源](http://web.archive.org/web/20170725054754/http://www.timrivera.com/tests/ol-start.html)，我总结如下：

要使用 CSS 而不是 HTML 为有序列表设置 start 属性，可以`counter-increment`按如下方式使用该属性：

```
ol {
  list-style: none;
  counter-increment: start 3;
  }
li:before {
  content: counter(start, lower-alpha) ") ";
  counter-increment: start;
  } 
```

`counter-increment`似乎是 0-indexed，所以要获得从 4 开始的列表，请使用`3`.

对于以下 HTML

```
<ol>
  <li>Buy milk</li>
  <li>Feed the dog</li>
  <li>Drink coffee</li>
</ol> 
```

我的结果是

```
d) Buy milk
e) Feed the dog
f) Drink coffee 
```

看看我的[小提琴](http://jsfiddle.net/hcmcf/3e76c549/)

另请参阅[W3 wiki 参考](https://www.w3.org/wiki/CSS/Properties/counter-reset)

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2016-02-16T00:20:17.850

正如其他人所建议的那样，可以使用元素`start`的属性。`ol`

或者，可以使用元素`value`的属性。[这两个属性在HTML 4.01](https://www.w3.org/TR/1999/REC-html401-19991224/struct/lists.html#edef-OL)`li`中都被标记为已弃用，但在 HTML 5 (和) 中没有。[`ol`](https://www.w3.org/TR/2014/REC-html5-20141028/grouping-content.html#the-ol-element)[`li`](https://www.w3.org/TR/2014/REC-html5-20141028/grouping-content.html#the-li-element)

```
<ol start="-2">
  <li>Alpha</li>
  <li>Beta</li>
  <li value="10">Gamma</li>
  <li>Delta</li>
</ol>
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2020-10-23T16:27:42.060

通过 HTML，使用`start` [属性](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/ol#Attributes)

> 列表项开始计数的整数。始终为阿拉伯数字（1、2、3 等），即使编号类型是字母或罗马数字。例如，要从字母“d”或罗马数字“iv”开始编号元素，请使用 start="4"。

```
<ol start="10">
  <li>Ten</li>
  <li>Eleven</li>
  <li>Twelve</li>
</ol>
```

通过 CSS，使用[CSS 计数器](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Lists_and_Counters/Using_CSS_counters)：

> CSS 计数器可让您根据内容在文档中的位置调整内容的外观。例如，您可以使用计数器自动为网页中的标题编号。计数器本质上是由 CSS 维护的变量，其值可以通过 CSS 规则递增以跟踪它们被使用的次数。

```
ol {
  list-style: none;
  counter-reset: li 9; /* syntax: "counter name" "init value" */
}

ol li:before {
  counter-increment: li; /* for every appearance, add one */
  content: counter(li) ". "; /* mimic default ol list-style */
}
```

```
<ol>
  <li>Ten</li>
  <li>Eleven</li>
  <li>Twelve</li>
</ol>
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2018-12-11T12:03:41.737

从不同于默认值（“1”）的数字开始对有序列表进行编号需要该`start`属性。该属性在[HTML 4.01 规范](https://www.w3.org/TR/html401/struct/lists.html#adef-start)中是允许的（不被弃用） （在发布此问题时 HTML 4.01 还不是“被取代的规范”），并且在当前的[HTML 5.2 规范](https://www.w3.org/TR/html5/grouping-content.html#the-ol-element)中仍然允许。该元素在[XHTML 1.0 的过渡 DTD](https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd)`ol`中也有一个可选`start`属性，但在[XHTML 1.0 的严格 DTD](https://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd)中没有（搜索字符串并检查属性列表）。因此，尽管一些较早的评论说了什么，但该属性并未被*弃用*；而是*无效的*`ATTLIST ol``start`**在 HTML 4.01 和 XHTML 1.0 的严格 DTD 中。尽管其中一条评论声称，该`start`属性在元素上是不允许的，`ul`并且目前在 Firefox 和 Chromium 中不起作用。**

 **另请注意，千位分隔符不起作用（在当前版本的 Firefox 和 Chromium 中）。在下面的代码片段中，`10.000`将被解释为`10`; 这同样适用于`10,000`。所以不要使用以下类型的`counter`值：

```
<ol start="10.000">
  <li>Item 10.000</li>
  <li>Next item</li>
  <li>Next item</li>
</ol> 
```

因此，您应该使用以下内容（在极少数情况下需要高于 1000 的值）：

```
<ol start="10000">
  <li>Item 10.000</li>
  <li>Next item</li>
  <li>Next item</li>
</ol> 
```

其他一些答案建议使用 CSS 属性`counter`，但这与传统的内容和布局分离（分别在 HTML 和 CSS 中）背道而驰。具有某些视觉障碍的用户可能会使用自己的样式表，`counter`结果可能会丢失值。`counter`还应测试屏幕阅读器支持。CSS 中对内容的屏幕阅读器支持是一个相对较新的功能，并且行为不一定一致。请参阅[屏幕阅读器和 CSS：我们是否正在过时（并进入内容）？](https://webaim.org/blog/screen-readers-and-css/)作者：John Northup 在 WebAIM 博客上（2017 年 8 月）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-02-05T15:52:58.820

如果列表是嵌套的，则必须进行忽略嵌套列表项的处理，我通过验证祖父不是列表项来完成此操作。

```
var section = document.getElementById("TheContent");
var list = section.getElementsByTagName("li");
var cnt = 0;
for (var i=0;i<list.length;i++){
  if (list[i].parentElement.parentElement.nodeName!="LI") {
    cnt += 1;
    list[i].setAttribute("value",cnt);
  }
}
```

```
<!DOCTYPE html>
<html>
<body>

<section id="TheContent">
<h2>Ordered Lists - numbering not interupted</h2>
<p>This example avoids for the first list level that each ordered list starts with 1:</p>

<p><strong>1st list:</strong></p>
<ol>
  <li>list item 1</li>
  <li>list item 2</li>
  <li>list item 3</li>
</ol>

<p><strong>2nd list:</strong></p>
<ol>
  <li>item</li>
  <li>item
    <ol>
      <li>item</li>
      <li>item</li>
      <li>item</li>
    </ol>
  </li>
  <li>item</li>
</ol>
</section>

</body>
</html>
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-02-05T16:10:30.930

使用 CSS 覆盖存在嵌套列表项的情况有点棘手，因此只有第一个列表级别获得不会与每个新的有序列表中断的自定义编号。我正在使用 CSS 组合器“>”来定义列表项的可能路径，这些列表项将获得自定义编号。见[https://www.w3schools.com/css/css_combinators.asp](https://www.w3schools.com/css/css_combinators.asp)

```
body {
  counter-reset: li_cnt;
}
/* discard auto generated numbers */
ol {
  list-style-type: none;
}
/* all possible paths to the list item that shall have custom numbering */
section#TheContent > ol > li:before,
body > ol > li:before {
  counter-increment: li_cnt;
  content: counter(li_cnt)'. '; /* add own numbers */
}
/* switch on default auto generated numbers for nested list items */
li > ol {
  list-style-type: decimal;
}
```

```
<!DOCTYPE html>
<html>
<body>

<section id="TheContent">
<h2>Ordered Lists - numbering not interupted</h2>
<p>This example avoids for the first list level that each ordered list starts with 1:</p>

<p><strong>1st list:</strong></p>
<ol>
  <li>list item 1</li>
  <li>list item 2</li>
  <li>list item 3</li>
</ol>

<p><strong>2nd list:</strong></p>
<ol>
  <li>item</li>
  <li>item
    <ol>
      <li>item</li>
      <li>item</li>
      <li>item</li>
    </ol>
  </li>
  <li>item</li>
</ol>
</section>

</body>
</html>
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2019-02-05T15:45:51.157

显然，有序列表 <ol> 的 @start 和列表项 <li> 的 @value 都不能通过 CSS 设置。见[https://www.w3schools.com/css/css_list.asp](https://www.w3schools.com/css/css_list.asp)

用 CSS 中的计数器替换编号似乎是最好/最快/万无一失的解决方案，还有其他人在推广它，例如[https://css-tricks.com/numbering-in-style/](https://css-tricks.com/numbering-in-style/)

使用纯 JavaScript 可以为每个列表项设置 @value，但这当然比 CSS 慢。甚至不需要检查列表项是否属于有序列表<ol>，因为无序列表会被自动排除。

```
var section = document.getElementById("TheContent");
var list = section.getElementsByTagName("li");
for (var i=0; i<list.length; i++){
  if (list[i].parentElement.nodeName=="OL") {
    list[i].setAttribute("value",i+1);
  }
}
```

```
<!DOCTYPE html>
<html>
<body>

<section id="TheContent">
  <h2>Ordered Lists - numbering not interupted</h2>
  <p>This example avoid that each ordered list starts with 1:</p>

  <p><strong>1st list:</strong></p>
  <ol>
    <li>list item 1</li>
    <li>list item 2</li>
    <li>list item 3</li>
  </ol>

  <p><strong>2nd list:</strong></p>
  <ol>
    <li>list item 4</li>
    <li>list item 5</li>
    <li>list item 6</li>
  </ol>
  </section>

</body>
</html>
```

# uitableview - 模拟器与手机中的 UITableViewCell 行为

> ID：779017
> 
> 赞同：0
> 
> 时间：2009-04-22T20:20:06.913
> 
> 标签：uitableview

我使用的是 3.1.2 版本的 SDK。

我有一个应用程序，其中我在 IB 中创建了一个 UITableViewCell 来显示每个单元格的两行文本。当我在 iPhone 模拟器中运行应用程序时，一切都按预期运行；但是，当我在手机上运行完全相同的代码时，应用程序崩溃并在控制台中出现以下错误：

由于未捕获的异常“NSInternalInconsistencyException”而终止应用程序，原因：“UITableView 数据源必须从 tableView 返回一个单元格：cellForRowAtIndexPath：”

我的 iPhone 有 2.2.1 操作系统，我使用的是 2.2.1 版本的模拟器。此外，当我使用最新的 SDK（3.1.3 beta 2）时，该代码在运行 3.0 操作系统的其他 iPhone 上也能正常工作。

我的假设（可能不正确）是代码必须从根本上正确，并且与 2.2.1 操作系统存在一些细微差别。

这有意义吗？有没有人遇到过这个？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-07-08T10:57:16.390

尝试在设备上以调试模式运行应用程序，然后检查它是否有效。因为我也面临这个问题，并且在调试模式下运行时不会出现这个问题。

# .net - 委托与委托关键字

> ID：779021
> 
> 赞同：44
> 
> 时间：2009-04-22T20:21:05.413
> 
> 标签：.net, delegates

如果您想创建自定义委托，您可以使用`delegate`小写的关键字。

你可以用实际的`Delegate`类做什么？这有什么好处？我不明白确切的区别。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-04-22T20:27:00.657

来自[http://msdn.microsoft.com/en-us/library/system.delegate.aspx](http://msdn.microsoft.com/en-us/library/system.delegate.aspx)：

> 该类`Delegate`是委托类型的基类。但是，只有系统和编译器可以显式地从`Delegate`类或类派生`MulticastDelegate`。也不允许从委托类型派生新类型。该类 `Delegate`不被视为委托类型；它是一个用于派生委托类型的类。
> 
> 大多数语言都实现了`delegate` 关键字，并且这些语言的编译器能够从 `MulticastDelegate`类派生；因此，用户应使用`delegate`语言提供的关键字。

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2009-04-22T20:30:39.073

delegate 关键字是让编译器为你做一些魔术。当您声明具有自定义签名的新委托时，

*   编译器会为您创建一个从 MulticastDelegate 派生的新类型（它又从 Delegate 派生）。
*   编译器使用您的自定义签名添加一个 Invoke 方法
*   同样，编译器为这种新类型添加了 BeginInvoke 和 EndInvoke 方法

所以现在当你打电话时`delObject(args)`- 编译器将其转换为`delObject.Invoke(args)`

Delegate 基类提供了一些功能，例如

1.  CreateDelegate（用于获取包装静态/实例方法的委托）
2.  DynamicInvoke（使用参数列表调用委托 - 后期绑定）
3.  合并和删除（用于委托链接.. 将多个委托链接在一起，例如一个事件的多个事件处理程序委托）

C# 编译器禁止您在代码中明确地从 Delegate 派生。您必须使用 delegate 关键字。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-22T20:56:37.857

您可以使用`delegate`关键字做的另一件巧妙的事情是内联创建委托，而无需声明它们，例如：

```
// constructor
public Form1()
{
    this.Load += delegate(object sender, EventArgs e)
    {
         // Form1_Load code goes right here
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-22T20:23:58.153

Delegate 类的优点是它是 .Net 中所有委托类型的基类。拥有一个采用此类实例的方法允许您对所有委托方式进行通用操作。这就是像 ISynchronizedInvoke.Invoke 这样的操作使用它作为参数的原因。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-22T21:51:33.060

该类的用途之一`Delegate`是在调用事件处理程序时进行更多控制。例如，对于正常的事件处理，任何事件处理程序中的异常都将阻止调用任何以后的事件处理程序。`Delegate`您可以通过使用该类手动调用每个事件处理程序来更改该行为。

```
using System;

namespace DelegateClass
{
    class EventSource
    {
        public event EventHandler TheEvent;

        internal void RaiseEvent1()
        {
            EventHandler handler = TheEvent;
            if (handler != null)
                handler(this, EventArgs.Empty);
        }

        internal void RaiseEvent2()
        {
            EventHandler handler = TheEvent;
            if (handler == null)
                return;

            Delegate[] handlers = handler.GetInvocationList();
            foreach (Delegate d in handlers)
            {
                object[] args = new object[] { this, EventArgs.Empty };
                try
                {
                    d.DynamicInvoke(args);
                }
                catch (Exception ex)
                {
                    while (ex.InnerException != null)
                        ex = ex.InnerException;

                    Console.WriteLine(ex.Message);
                }
            }
        }
    }

    class Program
    {
        static void Handler1(object sender, EventArgs e)
        {
            Console.WriteLine("Handler1");
        }

        static void Handler2(object sender, EventArgs e)
        {
            Console.WriteLine("Handler2");
            throw new InvalidOperationException();
        }

        static void Handler3(object sender, EventArgs e)
        {
            Console.WriteLine("Handler3");
        }

        static void Main(string[] args)
        {
            EventSource source = new EventSource();
            source.TheEvent += Handler1;
            source.TheEvent += Handler2;
            source.TheEvent += Handler3;

            try
            {
                source.RaiseEvent1();
            }
            catch (Exception ex)
            {
                Console.WriteLine(ex.Message);
            }

            Console.WriteLine("-------------------");

            source.RaiseEvent2();
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-22T20:38:00.473

从实现的角度来看，Delegate 类定义了用于表示委托的函数指针的字段，而 MultiCastDelegate 类提供了事件使用的基线功能。此外，正如其他人提到的，Delegate 提供了“DynamicInvoke”方法，允许您调用任何委托。

# comments - 代码中的注释有标准格式吗？

> ID：779025
> 
> 赞同：15
> 
> 时间：2009-04-22T20:21:41.200
> 
> 标签：comments

我想知道人们在他们的代码中是否有标准的注释格式。不是方法或类的 xml 注释，而是方法*中*的注释。

* * *

### 也可以看看：

> [是否有用于注释 C# 代码的标准（如 phpdoc 或 python 的文档字符串）？](https://stackoverflow.com/questions/34516/is-there-a-standard-like-phpdoc-or-pythons-docstring-for-commenting-c-code)

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-04-22T20:31:52.173

除了格式化之外，你真的应该考虑一些事情来做出好的评论。

1.  不要简单地重申代码在做什么。例如，

> ```
>  // Start the services
>  StartServices(); 
> ```

真是个可怕的评论！

2.  描述***为什么***。为什么代码在做它正在做的事情？业务假设或算法步骤是什么？

3.  格式化您的评论以获得最大的可读性。正确标记它们，在必要时留出空格等。

4.  如果有人已经开始以标准方式发表评论，请不要打破该标准。

5.  在 MSDN 上查看这篇关于编写有效评论的文章：http: [//msdn.microsoft.com/en-us/library/aa164797.aspx](http://msdn.microsoft.com/en-us/library/aa164797.aspx)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-22T20:23:47.823

```
// I usually write comments like this 
```

在我工作的地方，大多数声明（类、方法、一些属性）都需要使用标准的 xml 注释样式（我们使用 C#）。

有时您可以看到正在使用的页眉/页脚注释。

```
/****************************************************/
// Filename: Customer.cpp
// Created: John Doe
// Change history:
// 18.12.2008 / John Doe
// 14.01.2009 / Sara Smith
/****************************************************/

/* Here goes a lot of stuff */

/****************************************************/
// EOF: Customer.cpp
/****************************************************/ 
```

在我以前的工作场所之一使用过类似的东西。在我看来，不必要的东西太多了。如今，通过版本控制系统可以很好地看到更改历史。

在许多优秀的软件商店中，都有关于何时以及如何编写评论的内部准则。文档通常被称为“源代码样式策略”或其他东西。在注释代码时坚持一种常见的风格非常重要。

当然，这种评论炒作不应该过分评论每一小段代码，尤其是显而易见的代码。

```
/// <summary>
///     Handles the standard PageLoad event
/// </summary>
/// <param name="sender">
///    Event sender
/// </param>
/// <param name="e">
///    Event arguments
/// </param>
public void Page_Load (object sender, EventArgs e)
{
    // Do something here
} 
```

这是过度痴迷评论的一个很好的例子。像这样的东西正好添加了零信息，但只会给源文件添加噪音。我们必须在工作中按要求去做。

我的个人意见是当你有话要说或解释时添加评论，而不仅仅是为了评论所有内容。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-22T20:28:32.353

```
/**
 * block comments to document a method for javadoc go like this
 * @param
 * @return
 * @exception BTKException
 * @see BTK
 */ 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-22T20:25:16.260

评论执行您所描述的代码（块）上方的行

```
// This is a comment.
Some code goes here 
```

避免做类似的事情

```
// ----------------
// IMPORTANT COMMENT
// ---------------- 
```

我避免使用

```
/* comment */ 
```

也许最重要的是，清理评论！描述不存在的功能的评论比没有评论更糟糕。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-22T20:33:28.533

```
//For one line, I write them like this

/*
For multiple lines of text
I write them like this
*/

/*
for(multiple lines of code){
  I.WriteComents(With("//"));
  Reason==If(I.Remove('The top begin-quote mark') then
    I.Worry.Not('About removing the close-quote mark');
//*/ 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-04-22T20:46:05.337

方法中（而不是接口中）注释的问题在于，除了维护该方法的人之外，任何人实际上都不会看到它们。因此，没有真正需要评论的标准。它们不会在任何地方发布，它们不公开可见，来电者通常永远不会看到它们。

一般来说，代码中的注释应该遵循四个规则：

1.  他们不应该陈述明显的
2.  他们应该与他们描述的一致
3.  应该清楚*它们*描述的内容（例如，哪条线、哪条块）。
4.  任何未来的维护者都应该可以阅读它们。

话虽如此，通常倾向于将对呼叫者重要的信息作为内部评论放置。例如：“哎呀，这不处理负数”。每当您看到内部注释时，请重新考虑是否应该更新标头文档，或者使用将注释“推送”到函数调用者意识的​​工具（[我有一个类似 Java 的工具](http://emoose.cs.cmu.edu)）。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-22T20:30:00.353

我不敢相信我们错过了 REM 关键字。

虽然公平地说，这是为了 REMARK 而不是 COMMENT。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-22T20:25:02.503

```
/* I will sometimes write
comments like this */ 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-22T20:31:09.570

```
# ----------------------------------
# BIG IMPORTANT COMMENTS IN PERL/SH
# ---------------------------------- 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-04-22T20:54:40.247

当注释将由外部工具（通常是文档生成器，如 javadoc）解析时，注释标准最有用。

在这种情况下，外部工具将说明标准。

对于其他情况，请参阅[您的评论如何？（最佳实践）](https://stackoverflow.com/questions/121945/how-do-you-like-your-comments-best-practices)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-04-22T20:24:18.900

```
' I usually write comments like this 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-04-22T20:28:04.553

```
<!--How about comments like this!?--> 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-04-22T20:31:22.517

```
//Cheap Debugger

//Response.Write(MySQLStringBecauseINeedToKnowWhatsBroken); 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-22T20:25:02.860

```
(* Modula-2 comments go like this *) 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-04-22T20:25:31.347

```
/*
 * Brief summary of what's going on.
 */
int code_that_goes_on(int c)
{
     /* and then if I have to remark on something inside... */
     return 0;
} 
```

99% 的编译器会支持`//`注释，这很棒，但那 1% 仍然存在，让他们的生活变得宜居并不难。

编辑：德尔福的评论有点迟钝，但确实指出了一个真正的缺陷。我打算这是一个特定于 C 的答案。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-04-22T20:29:31.743

在这个问题上可能会有宗教战争。

我试图做的，不会引起太多战争的，是

```
 // explain the purpose of the following statement in functional terms
... some statement ... 
```

这个想法是，如果我通过一个删除除注释之外的所有内容的程序运行代码，那么剩下的就是非常好的伪代码。

作为注释掉您认为可能再次需要的代码的一种有用的方法是：

```
 /*
 ... some code ...
/**/ 
```

然后修改第一行 - 要么将其删除，要么将其更改为 /**/

```
 /**/
... some code ...
/**/ 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-04-22T20:39:43.107

如果您偏执并且不使用或不信任源代码控制，您可能会这样做

```
// Initials-YYMMDD-fixNo-Start
dosomething();
// Initials-YYMMDD-fixNo-Finish 
```

它会造成大混乱，但它为您提供了一些回滚更改的方法。

但我建议使用源代码控制

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-04-22T20:49:37.030

我喜欢做这样的事情：

```
/************
*  Comment  *
************/ 
```

这样，每当我添加/删除文本时，我都必须浪费时间重新格式化整个块

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-04-22T20:54:37.877

我认为您的要求没有标准。而且我看不出它会如何从 /// 对方法本身的注释中增加任何好处。

要从 C# 类创建文档，请查看[Sandcastle](http://blogs.msdn.com/sandcastle/)。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-04-22T21:01:58.717

在 C/C++/C#/Java 中，当我有注释解释一段代码时：

```
// comment
code;
more_code; 
```

当评论解释单行时：

```
code; // comment 
```

我通常`//`用于单句评论和`/* ... */`多句评论的评论。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2009-04-22T21:25:40.563

C++/Java 等中的一种注释风格是这样的：

```
// Use // for all normal comments...
// and use multiline comments to comment out blocks of code while debugging:
/*
for(int i = 0; i < n; ++i) {
    // If we only use // style comments in here,
    // no comment here will mess up the block comment.
}
*/ 
```

我认为这是一个有趣的观点，即使它不是那么有用。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2009-04-22T21:33:05.693

我的代码是自我记录的。我不需要评论。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2009-04-22T21:44:52.357

有一些包可以帮助编写和格式化文档。他们需要一些特定的更改，以便他们可以识别评论类别。

比如doxygen：

[http://www.doxygen.nl/manual/docblocks.html](http://www.doxygen.nl/manual/docblocks.html)

```
/*! \brief Brief description.
 *         Brief description continued.
 *
 *  Detailed description starts here.
 */ 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2009-04-23T00:36:19.027

我很惊讶没有更多的人推荐 doxygen。这是一种记录代码的好方法，其副作用是它可以在一天结束时自动生成 html + pdf API 文档。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2015-06-10T08:02:00.357

我更喜欢以这种方式评论功能

```
/**
 * Activates user if not already activated
 * @param POST string verificationCode
 * @param POST string key
 * @return true on success, false on failure
 * @author RN Kushwaha <rn.kuswaha@gmail.com>
 * @since v1.0 <date: 10th June 2015>
 */ 
```

> 公共功能激活用户帐户（）{
> 
> //这里有一些代码
> 
> }

我对代码描述使用单行注释，例如

```
//check if verificationCode exists in any row of user table
code here 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2020-01-17T04:45:30.127

您可能至少要考虑使用 PHP 反射类的标准注释格式：[https ://www.php.net/manual/en/reflectionclass.getdoccomment.php](https://www.php.net/manual/en/reflectionclass.getdoccomment.php)

我的网站压缩了 html，所以像 //comment here in JS 这样的评论会使 java 脚本崩溃。在 PHP 中使用 // 的规范应该只是一个“简短的注释”，即：一行。就我个人而言，我认为它们不应该用于超过一条线。

使用它们也使压缩变得不可能 - 或者比它应该压缩的更难压缩。

最后。

人类解释不是绝对的 - 计算机代码是:)

因此，如果您有需要或应该阅读的代码 - （Go Nasty）并且不要评论它。即：强迫读者阅读代码，而不是依赖他们对评论的解释。

* * *

## 回答 #27

> 赞同：-1
> 
> 时间：2009-04-22T20:26:30.797

——我通常写这样的评论

在 SQL 中

# java - 删除锁时 Java 性能下降

> ID：779027
> 
> 赞同：1
> 
> 时间：2009-04-22T20:22:33.677
> 
> 标签：java, performance

我正在测试我的 java 应用程序是否存在任何性能瓶颈。应用程序将 concurrent.jar 用于锁定目的。

我有一个高计算调用，它为其操作调用锁定和解锁函数。从代码中删除锁定解锁机制后，我发现性能下降了很多倍，这与我的预期相反。观察到的其他事情之一是 CPU 消耗的增加，这让我觉得程序运行得更快，但实际上并非如此。

Q1。当我们删除锁时，性能下降的原因是什么？

最好的祝福 ！！！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-22T20:37:09.663

剖析它。这里的任何其他内容都只是猜测和不知情的。

使用像[YourKit](http://yourkit.com/)这样的分析器不仅会告诉您哪些方法在 CPU 时间方面是“热点”，而且还会告诉您线程大部分时间都在哪里花费 BLOCKED 或 WAITING

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-23T03:39:28.963

这可能是一个很常见的发现，具体取决于您在做什么以及您使用什么来替代 Locks。

从本质上讲，发生的情况是，诸如 ReentrantLock 之类的结构内置了一些逻辑，当它们实际上无法获得锁时，它们知道“何时退出”。这减少了仅在重复尝试获取锁的逻辑中消耗的 CPU 量，如果您使用更简单的锁定结构，可能会发生这种情况。

举个例子，看看我在[这里](http://www.javamex.com/tutorials/lock_performance.shtml)匆忙放上的图表。它显示了线程连续访问数组的随机元素的吞吐量，使用不同的结构作为锁定机制。沿 X 轴是线程数；Y轴是吞吐量。蓝线是 ReentrantLock；黄色、绿色和棕色线条使用自旋锁的变体。请注意，在线程数量较少的情况下，自旋锁如何提供您可能期望的更高吞吐量，但是随着线程数量的增加，ReentrantLock 的退避逻辑开始发挥作用，它最终做得更好，而在高争用情况下，自旋锁只是坐在燃烧CPU。

顺便说一句，这确实是在双处理器机器上进行的试运行；我还在亚马逊云中运行它（实际上是一个 8 路 Xeon），但我咳咳……文件放错了位置，但我要么找到它，要么很快再次运行实验，训练并发布更新。但我记得你会得到一个基本相似的模式。

**更新：**无论是否在锁定代码中，在某些多处理器架构上可能发生的一种现象是，当多个处理器进行大量内存访问时，您最终可能会淹没内存总线，实际上处理器会互相减慢向下。（这有点像以太网——添加到网络的机器越多，它们在发送数据时发生冲突的可能性就越大。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T22:35:58.177

它仍然正常运行吗？例如，在应用服务器中存在不同步`HashMap`导致偶尔无限循环的情况。不难看出如何简单地重复工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-23T03:00:06.640

当您删除共享内存保护时，看到性能下降和 CPU 使用率增加的最可能的罪魁祸首是竞争条件。两个或多个线程可能会不断地在共享对象上来回翻转状态标志。

对应用程序目的的更多描述将有助于诊断。

# objective-c - 在finally块中访问objective-c异常

> ID：779028
> 
> 赞同：3
> 
> 时间：2009-04-22T20:22:38.687
> 
> 标签：objective-c, exception

鉴于以下情况：

```
@try {
    @try {
        // raises an exception :)
        [receiver raisingFirstException];
    } @finally {
        // raises another exception :)
        [otherReceiver raisingFinalException];
    }
} @catch (id e) {
    printf("exception: %s\n", [[e stringValue] cString]);
} 
```

有什么方法可以获取块内的第一个异常 `@finally`或获取块内的两个异常`@catch`？

我有代码`@finally`块执行一些可能引发异常的检查，但我不想丢失原始异常（根本原因）。

如果没有原始异常但检查失败，我希望他们抛出异常。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T20:35:25.723

最好的方法是将异常分配给可以从块的其余部分访问的变量。

```
NSException *ex;
@try {
    @try {
        [someObject methodWhichCouldThrowException];
    } @catch (NSException *e) {
        ex = e;
    } @finally {
        [anotherObject methodWhichCouldThrowADifferentException];
    }
} @catch (NSException *e) {
    // From here you can access both the exception thrown by 'someObject'
    // as well as the exception thrown by 'anotherObject'.
} 
```

# .net - 哪个层应该负责加载插件？

> ID：779033
> 
> 赞同：2
> 
> 时间：2009-04-22T20:23:13.257
> 
> 标签：.net, user-interface, plugins, mef

我有一个包含 2 个主要组件 + 其他 DLL 的应用程序：

1.  核心 DLL（获得所有核心功能）
2.  图形用户界面
3.  需要 DI 等的第 3 方和完全独立的 DLL。

现在我正在实现插件支持。

哪个 DLL 应该负责加载这些插件？GUI 还是核心 DLL？

我正在使用 MEF，所以不太确定将其粘贴在哪里。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T22:21:46.417

我认为答案取决于应用程序中如何使用部件（使用 MEF 术语）。我会根据零件的使用位置/方式来创建和填充容器。

例子：

如果您正在创建包含 GUI 视图的部件，我认为应用程序中的 GUI 层会加载它们并管理容器。

我有一个为客户端应用程序插件构建的应用程序框架，其中有一个静态应用程序管理器类，它为应用程序加载 Parts，但随后我还将 Parts 加载到我的核心逻辑使用的容器中。两者的意图完全不同，因为其中一些是我希望以后能够轻松换出的核心概念，而另一些是 UI 插件，当它们被放入并可供应用程序使用时扩展客户端功能。

此外，这些是使用不同的方法加载的......核心仅在使用特定规则启动时，另一个是从目录（插件）加载所有内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T20:33:32.607

我认为Core DLL，因为它可能是插件的业务逻辑。

# web-services - 模拟在工作站 A 和 B 上使用相同的凭据授权失败

> ID：779040
> 
> 赞同：0
> 
> 时间：2009-04-22T20:24:48.663
> 
> 标签：web-services, authorization, asmx, impersonation

案例 1\. 当我从我自己的 PC 上浏览一个名为 JOHNXP 的小测试站点（例如[http://localhost/WebClient](http://localhost/WebClient)）时，我的 .aspx 页面调用我的 ASMX 网络服务获取我的凭据并将它们传递给另一台机器上的另一个网络服务（ SERVERTRIM）在同一域中。我可以看到我的请求导致 SERVERTRIM 机器上的安全日志条目带有我的凭据。

案例 2。我移动到同一域中的另一台 PC，并使用我在个人桌面上使用的相同凭据登录。当我浏览上面的同一个测试站点时（这次是[http://johnxp/WebClient](http://johnxp/WebClient)），我得到这个渗透回我的 .aspx 页面：

System.Web.Services.Protocols.SoapException：服务器无法处理请求。---> System.Net.WebException：请求失败，HTTP 状态 401：未授权

查看 SERVERTRIM 上的安全日志，我注意到案例 2 中的访问导致匿名登录，这似乎可以解释 401/未授权。

当我的 WS 在不同的服务器上调用供应商的 web 服务时，我试图让我的 web 服务使用登录的 DOMAIN 用户的凭据。

我的 ASMX 网络服务在我的桌面上运行（IIS 5.1 WinXP Pro - 机器名称是 JOHNXP）。我在涉及的每个服务器中都启用了匿名 UNCHECKED，并且在我的场景中涉及的每个 web.config 中都有这个：

供应商 Web 服务在 SERVERTRIM（Win 2003 服务器）上运行，它也是 ASMX 并使用 WSE 3.0。

Wireshark 和 Netmon 现在对于我来说看起来太强大了。我认为“远程”服务器（SERVERTRIM）上不同的结果登录是足够的“证据”。上面的所有机器都在同一个域中，但如果可能的话，我想将“远程”webservice 保留在 SERVERTRIM 上，并将我的中间 webservice 保留在同一域中的不同服务器上。这种情况是否要求我必须深入研究“委托”？当在域中的另一台机器上发起 Web 请求时，监视为什么相同的凭据会导致匿名登录的最简单工具是什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-22T20:44:21.083

我对身份验证的了解有点模糊，但是如果我正确理解了您的描述：

*   在第一种情况下，您正在浏览 localhost，它冒充调用者，然后在另一台机器上调用 Web 服务。模拟是在与客户端相同的机器上完成的。我相信在这种情况下，模拟应用程序不需要位于受委托委托的机器上（因为它已经与客户端在同一台机器上）。

*   在第二种情况下，您正在浏览**另一**台 PC，该 PC 在呼叫第三台 PC 时试图冒充呼叫者。在这种情况下，需要信任中间的 PC 以进行委派（如果它是开发工作站，则可能不会如此）。

# c# - 使用正则表达式获取两个子字符串之间的值

> ID：779045
> 
> 赞同：0
> 
> 时间：2009-04-22T20:25:25.857
> 
> 标签：c#, .net, regex

如果我有一个字符串“Param1=value1;Param2=value2;Param3=val3”，我怎样才能得到子字符串“Param2=”和下一个分号（或字符串结尾，以先到者为准）之间的值？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-22T20:27:46.113

`/Param2=([^;]+)/`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T20:28:28.000

"Param\d+=([^;]*)" 将捕获 = 和 ; 之间的内容 在第 1 组

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T20:43:09.353

您可以使用排除的字符类`;`（正如其他人回答的那样），也可以使用非贪婪匹配任何内容：

```
/Param2=(.*?);/ 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T20:56:04.517

您可以使用此字符串将所有值放入[Regex](http://msdn.microsoft.com/en-us/library/system.text.regularexpressions.regex_members.aspx)类的 Matches 集合中

```
string regex = "Param[0-9]*?=(?<value>.*?)(;|$)" 
```

# c# - C#中的字符串连接不安全，需要使用StringBuilder吗？

> ID：779051
> 
> 赞同：5
> 
> 时间：2009-04-22T20:25:40.723
> 
> 标签：c#, string, stringbuilder, string-concatenation

**我的问题是：** C# 中的字符串连接安全吗？如果字符串连接导致意外错误，并且使用 StringBuilder 替换该字符串连接会导致这些错误消失，这可能表明什么？

**背景：**我正在开发一个小型命令行 C# 应用程序。它接受命令行参数，执行稍微复杂的 SQL 查询，并将大约 1300 行数据输出到格式化的 XML 文件中。

我的初始程序在调试模式下总是运行良好。但是，在发布模式下，它会得到大约第 750 个 SQL 结果，然后因错误而死。错误是无法读取某列数据，即使通过SqlDataReader 对象的Read() 方法刚刚返回true。

此问题已通过对代码中的所有操作使用 StringBuilder 来解决，以前存在“string1 + string2”。我不是在谈论 SQL 查询循环中的字符串连接，其中 StringBuilder 已经在使用中。我说的是代码前面两个或三个短字符串变量之间的简单连接。

我的印象是 C# 足够聪明，可以处理将几个字符串添加在一起的内存管理。我错了吗？或者这是否表明某种其他类型的代码问题？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-22T21:32:09.737

**回答您的问题：** C#（和一般的 .NET）中的字符串连接*是*“安全的”，但是如您所描述的那样在紧密循环中执行它可能会导致严重的内存压力并对垃圾收集器造成压力。

我会大胆猜测您所说的错误与某种资源耗尽有关，但如果您能提供更多详细信息会有所帮助——例如，您是否收到异常？应用程序是否异常终止？

**背景：** .NET 字符串是不可变的，所以当你进行这样的连接时：

```
var stringList = new List<string> {"aaa", "bbb", "ccc", "ddd", //... };
string result = String.Empty;
foreach (var s in stringList)
{
    result = result + s;
} 
```

这大致相当于以下内容：

```
string result = "";
result = "aaa"
string temp1 = result + "bbb";
result = temp1;
string temp2 = temp1 + "ccc";
result = temp2;
string temp3 = temp2 + "ddd";
result = temp3;
// ...
result = tempN + x; 
```

这个例子的目的是强调每次循环都会导致分配一个新的临时字符串。

由于字符串是不可变的，因此运行时没有其他选择，只能在每次将另一个字符串添加到结果末尾时分配一个新字符串。

尽管`result`字符串会不断更新以指向最新和最大的中间结果，但您会产生大量这些未命名的临时字符串，这些字符串几乎立即可以进行垃圾回收。

在此连接结束时，您将在内存中存储以下字符串（为简单起见，假设垃圾收集器尚未运行）。

```
string a = "aaa";
string b = "bbb";
string c = "ccc";
// ...
string temp1 = "aaabbb";
string temp2 = "aaabbbccc";
string temp3 = "aaabbbcccddd";
string temp4 = "aaabbbcccdddeee";
string temp5 = "aaabbbcccdddeeefff";
string temp6 = "aaabbbcccdddeeefffggg";
// ... 
```

尽管所有这些隐式临时变量几乎可以立即进行垃圾回收，但它们仍然必须被分配。当在一个紧密的循环中执行连接时，这会给垃圾收集器带来很大的压力，如果没有别的，会让你的代码运行得很慢。我亲眼目睹了这对性能的影响，并且随着您的连接字符串变得更大，它变得真正具有戏剧性。

**推荐的方法是始终使用 a`StringBuilder`如果您正在执行多个字符串连接。** `StringBuilder`使用可变缓冲区来减少构建字符串所需的分配数量。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-22T20:29:07.687

如果在循环中连接大量字符串，则字符串连接是安全的，但比使用 StringBuilder 更占用内存。在极端情况下，您可能会耗尽内存。

这几乎可以肯定是您的代码中的一个错误。

也许你正在包含大量的字符串。或者也许它是完全不同的东西。

我会在没有对根本原因的任何先入之见的情况下返回调试 - 如果您仍然遇到问题，请尝试将其减少到重现问题和发布代码所需的最低限度。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-22T20:29:45.423

除了您正在做的事情之外，最好使用 XML APIs 而不是字符串或 StringBuilder 来完成我怀疑您看到的错误是由于字符串连接造成的。也许切换到 StringBuilder 只是掩盖了错误或优雅地解决了它，但我怀疑使用字符串真的是原因。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-22T20:30:28.543

连接版本与字符串生成器版本需要多长时间？您与数据库的连接可能正在关闭。如果您要进行大量连接，我会使用 StringBuilder，因为它更有效。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-22T20:35:50.650

一个原因可能是字符串在 .Net 中是不可变的，因此当您对一个字符串进行操作（例如连接）时，您实际上是在创建一个新字符串。

另一个可能的原因是字符串长度是 int，因此最大可能长度是 Int32.MaxValue 或 2,147,483,647。

无论哪种情况，对于此类操作，StringBuilder 都比“string1 + string2”更好。虽然，使用内置的 XML 功能会更好。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-23T12:32:32.287

`string.Concat(string[])`是迄今为止连接字符串的最快方法。在循环中使用时，它会严重影响`StringBuilder`性能，尤其是`StringBuilder`在每次迭代中创建时。如果你用谷歌搜索“c# string format vs stringbuilder”或类似的东西，就会有很多参考资料。 [http://www.codeproject.com/KB/cs/StringBuilder_vs_String.aspx](http://www.codeproject.com/KB/cs/StringBuilder_vs_String.aspx)让您了解时代。在这里 string.Join 赢得了连接测试，但我相信这是因为`string.Concat(string, string)`使用的是而不是采用数组的重载版本。如果您查看由不同方法生成的 MSIL 代码，您将看到幕后发生的事情。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-22T20:50:57.573

这是我在黑暗中拍摄的...

.NET 中的字符串（不是字符串生成器）进入字符串实习生池。这基本上是由 CLR 管理的一个区域，用于共享字符串以提高性能。这里必须有一些限制，虽然我不知道那个限制是什么。我想你正在做的所有连接都是撞到字符串实习生池的天花板。所以 SQL 说是的，我对你有一个价值，但它不能把它放在任何地方，所以你会得到一个例外。

一个快速简单的测试是对你的程序集进行[nGen](http://msdn.microsoft.com/en-us/library/6t9t5wcf(VS.80).aspx)测试，看看你是否仍然得到错误。在 nGen'ing 之后，您的应用程序将不再使用该池。

如果失败了，我会联系微软来尝试获取一些具体的细节。我认为我的想法听起来很合理，但我不知道为什么它可以在调试模式下工作。也许在调试模式下，字符串不会被保留。我也不是专家。

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2009-04-22T20:29:13.007

将字符串组合在一起时，我总是使用 StringBuilder。它是为它设计的，并且比简单地使用“string1 + string2”更有效。

# ruby - 哈希作为 def 参数

> ID：779054
> 
> 赞同：1
> 
> 时间：2009-04-22T20:26:02.937
> 
> 标签：ruby, hash, function

以下是可能的吗？我一直遇到哈希的奇数列表

```
def thores_hammer(bling)
  hammer_bling = { bling }
end

thores_hammer :rubys    => 5,
              :emeralds => 5,
              :souls    => 333 
```

提前谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-22T23:33:25.357

您遇到错误的原因是在 调用`Hash`该方法时隐式创建了`thores_hammer`- 所以当您`{ bling }`创建一个只有一个键（它本身就是一个哈希）并且没有值的哈希时。因此错误。

您需要做的就是去掉花括号：

```
irb> def thores_hammer(bling)
       hammer_bling = bling
     end
#=> nil
irb> thores_hammer :rubys    => 5,
                   :emeralds => 5,
                   :souls    => 333
#=> {:rubys=>5, :emeralds=>5, :souls=>333} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-23T06:50:52.170

您可能打算做的是制作哈希的副本，可以这样做：

```
def thores_hammer(bling)
  hammer_bling = bling.dup
end 
```

如果您打算长时间使用哈希并且不确定修改给出的方法的副本是否是一个好主意，那么制作副本可能是一个好主意，因为它可以在其他地方使用.

此外，Ruby 中的花括号有多种不同的用途，例如声明块。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T20:58:44.730

试试这个：

```
def thores_hammer(bling)
  hammer_bling = bling
end

thores_hammer Hash[:rubys => 5, :emeralds => 5, :souls => 333] 
```

# django - 带有自定义管理器的 Django 1.0.2 中的多个数据库

> ID：779055
> 
> 赞同：5
> 
> 时间：2009-04-22T20:26:10.050
> 
> 标签：django, django-models

我在用户组中问了这个没有回应，所以我想我会在这里尝试。我正在尝试设置一个自定义管理器来连接到与我的默认 mysql 连接相同的服务器上的另一个数据库。我曾尝试按照[此处](http://groups.google.com/group/django-developers/browse_thread/thread/5d8c73eb483029af/19b19ed79bbbfa0d)和[此处](http://www.djangrrl.com/view/multiple-database-connection-a-simple-use-case/)的示例进行操作，但没有运气。返回时我得到一个空元组 `MyCustomModel.objects.all()`。

这是我在 manager.py 中的内容

```
from django.db import models 
from django.db.backends.mysql.base import DatabaseWrapper 
from django.conf import settings 
class CustomManager(models.Manager): 
    """ 
    This Manager lets you set the DATABASE_NAME on a per-model basis. 
    """ 
    def __init__(self, database_name, *args, **kwargs): 
        models.Manager.__init__(self, *args, **kwargs) 
        self.database_name = database_name 
    def get_query_set(self): 
        qs = models.Manager.get_query_set(self) 
        qs.query.connection = self.get_db_wrapper() 
        return qs 
    def get_db_wrapper(self): 
        # Monkeypatch the settings file. This is not thread-safe! 
        old_db_name = settings.DATABASE_NAME 
        settings.DATABASE_NAME = self.database_name 
        wrapper = DatabaseWrapper() 
        wrapper._cursor(settings) 
        settings.DATABASE_NAME = old_db_name 
        return wrapper 
```

这是我在models.py中的内容：

```
from django.db import models 
from myproject.myapp.manager import CustomManager 
class MyCustomModel(models.Model): 
    field1  = models.CharField(max_length=765) 
    attribute = models.CharField(max_length=765) 
    objects = CustomManager('custom_database_name') 
    class Meta: 
        abstract = True 
```

但如果我跑步，`MyCustomModel.objects.all()`我会得到一个空列表。

我对这些东西很陌生，所以我不确定这是否适用于 1.0.2，我将查看 Manager 代码，看看我是否能弄清楚，但我只是想知道我是否在这里做错了什么。

更新：这现在在 Django 主干中，将成为 1.2 版本的一部分 [http://docs.djangoproject.com/en/dev/topics/db/multi-db/](http://docs.djangoproject.com/en/dev/topics/db/multi-db/)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-07-31T20:04:53.490

您可能想与[Alex Gaynor](http://twitter.com/alex_gaynor)交谈，因为他正在添加 MultiDB 支持，并且可能在[Django 1.2](http://code.djangoproject.com/wiki/Version1.2Features)中发布。我相信他会感谢那些将要使用 MultiDB 的人的反馈和意见。[在django-developers](http://groups.google.com/group/django-developers) mainling 列表中有关于它的讨论。他的 MultiDB 分支甚至可能可用，我不确定。

因为我猜你可能等不及了，如果 MultiDB 分支不可用，这里是你的选择。

*   遵循[Eric Flows 方法](http://www.eflorenzano.com/blog/post/easy-multi-database-support-django/)，记住它不受支持并且新发布的 Django 可能会破坏它。此外，一些评论表明它[已经被破坏了](http://www.eflorenzano.com/blog/post/easy-multi-database-support-django/#dsq-time-13323576)。这将是 hacky。
*   您的另一个选择是对您的一个数据库使用完全不同的数据库访问方法。也许是[SQLAlchemy](http://www.sqlalchemy.org/)，然后是 Django ORM。我猜测一个可能更以 Django 为中心，另一个是遗留数据库。

总结一下。我认为将 MultiDB 破解到 Django 中可能是错误的方法，除非您准备好在以后跟上维护您的破解的步伐。因此，我认为另一个 ORM 或数据库访问将为您提供最干净的途径，因为这样您就不会使用受支持的功能，而且归根结底，这一切都只是 Python。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-31T17:33:35.247

通过密切关注此博客文章，我的公司已成功使用多个数据库：[http ://www.eflorenzano.com/blog/post/easy-multi-database-support-django/](http://www.eflorenzano.com/blog/post/easy-multi-database-support-django/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T08:25:14.190

`t the answer your looking for, but it`如果您将所需的一切都移到一个数据库中，这可能是最好的。

# ant - 使用 Ant 就地过滤文件？

> ID：779064
> 
> 赞同：17
> 
> 时间：2009-04-22T20:28:17.017
> 
> 标签：ant

我有一个文件目录，我想使用 Apache Ant（Linux 上的 1.7.1 版）对其进行“就地”字符串过滤。

例如，假设在目录中`mydir`我有文件`foo`、`bar`和`baz`. 进一步假设所有出现的正则表达式`OLD([0-9])`都应更改为`NEW\1`，例如`OLD2`→ `NEW2`。（请注意，`replace`Ant 任务将不起作用，因为它不支持正则表达式过滤。）

可以使用以下 Bash 命令创建此测试情况（ant 将在当前目录，即`mydir`的父目录中运行）：

```
mkdir mydir
for FILE in foo bar baz ; do echo "A OLD1 B OLD2 C OLD3" > mydir/${FILE} ; done 
```

这是我第一次尝试使用 Ant 进行过滤：

```
<?xml version="1.0"?>
<project name="filter" default="filter">
    <target name="filter">
        <move todir="mydir">
            <fileset dir="mydir"/>
            <filterchain>
                <tokenfilter>
                    <replaceregex pattern="OLD([0-9])" replace="NEW\1" flags="g"/>
                </tokenfilter>
            </filterchain>
        </move>
    </target>
</project> 
```

运行第一个 Ant 脚本对`mydir`. 默认情况下，该`overwrite`参数与Ant 任务一起使用。我什至摆弄了设置，但这没有帮助。`true``move``granularity`

这是我的第二次尝试，它“有效”，但由于临时文件创建而有点烦人。此版本通过将内容移动到带有`filtered`后缀的文件来正确过滤内容，然后过滤后的内容将使用原始文件名“移回”：

```
<?xml version="1.0"?>
<project name="filter" default="filter">
    <target name="filter">
        <move todir="mydir">
            <globmapper from="*" to="*.filtered"/>
            <fileset dir="mydir"/>
            <filterchain>
                <tokenfilter>
                    <replaceregex pattern="OLD([0-9])" replace="NEW\1" flags="g"/>
                </tokenfilter>
            </filterchain>
        </move>
        <move todir="mydir">
            <globmapper from="*.filtered" to="*"/>
            <fileset dir="mydir"/>
        </move>
    </target>
</project> 
```

**第一次尝试（没有临时文件）可以工作吗？**

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-22T20:34:14.367

查看[替换](http://ant.apache.org/manual/Tasks/replace.html)任务：

```
<replace 
   dir="mydir" 
   includes="foo, bar, baz">
   <replacefilter token="OLD" value="NEW" />
</replace> 
```

或[replaceregexp](http://ant.apache.org/manual/Tasks/replaceregexp.html)任务：

```
<replaceregexp
    file="${src}/build.properties"
    match="OldProperty=(.*)"
    replace="NewProperty=\1"
    byline="true"/> 
```

# asp.net - 黄色错误屏幕附加到响应

> ID：779072
> 
> 赞同：1
> 
> 时间：2009-04-22T20:29:37.873
> 
> 标签：asp.net, session, iis-6, application-pool

我有一个应用程序在响应中附加黄色 asp.net 错误屏幕。页面看起来正常，然后在 Html 下方出现黄色屏幕。我已将此错误范围缩小到响应期间应用程序重置以及会话终止。因此，如果我开始加载页面并保存 web.config，它会给我一个附加到页面的与会话相关的错误。我将使用 sessionstate 服务来解决这个问题，但我很好奇是否有人见过实际附加到他们的应用程序 html 的黄色屏幕。该网站甚至使用 customerrors="on" 重定向到 500 个错误页面。我怎样才能防止这种情况发生？你认为 sessionstate 服务会有帮助吗？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T20:38:05.577

sounds like you have a web control on the page that in turn calls another web app or service to generate the response, and that web app is the one that is erroring....

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T20:33:03.247

Any response.Flush calls in your code? That's the only thing i could think of, but no, never seen that happen.

# vb6 - COMCTL Common Controls Progressbar 显示丑陋的蓝条

> ID：779075
> 
> 赞同：0
> 
> 时间：2009-04-22T20:29:56.717
> 
> 标签：vb6, progress-bar

我有一个使用 comctrl32.ocx 来显示进度条的 VB6 程序。我也有使用 mscomctl.ocx 的程序。但是，它使用丑陋的旧式蓝色框进度条来显示它，而不是使用新式进度条（这可能因操作系统而异）。引用同一个 ocx 文件的其他程序会显示新样式的进度条（除非我运行它们 VB6，在这种情况下它们仍然使用丑陋的进度条）。控件的所有属性都是相同的。关于我做错了什么有什么建议吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T20:33:10.393

很可能，您的应用程序没有清单，因此使用旧的 Windows XP 之前样式的通用控件。vbAccelerator 有一篇[很棒的文章，介绍如何添加一个](http://www.vbaccelerator.com/home/vb/code/libraries/XP_Visual_Styles/Using_XP_Visual_Styles_in_VB/article.asp)

# c# - SQLException : 字符串或二进制数据将被截断

> ID：779082
> 
> 赞同：66
> 
> 时间：2009-04-22T20:31:25.577
> 
> 标签：c#, sql, sql-server

我有一个 C# 代码，它可以批量执行大量插入语句。在执行这些语句时，我得到“字符串或二进制数据将被截断”错误和事务角色返回。

要找出是哪个插入语句导致的，我需要在 SQLServer 中一一插入，直到遇到错误。

有没有聪明的方法来找出哪个语句和哪个字段使用异常处理导致了这个问题？(SqlException)

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2009-04-22T20:35:07.937

In general, there isn't a way to determine which particular statement caused the error. If you're running several, you could watch profiler and look at the last completed statement and see what the statement after that might be, though I have no idea if that approach is feasible for you.

In any event, one of your parameter variables (and the data inside it) is too large for the field it's trying to store data in. Check your parameter sizes against column sizes and the field(s) in question should be evident pretty quickly.

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2012-06-21T06:58:40.883

当 SQL Server 列的数据类型的长度小于输入到输入表单中的数据长度时，就会发生这种类型的错误。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2013-07-22T09:24:35.253

这种类型的错误通常发生在您必须放置比您在数据库表中指定的字符或值更多的字符或值时，例如在这种情况下：您指定 transaction_status varchar(10) 但您实际上试图存储包含 19 个字符的 _transaction_status。这就是您在此代码中遇到此类错误的原因

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-09-22T03:19:03.613

通常是您插入的值大于最大允许值。例如，数据列最多只能容纳 200 个字符，但您要插入 201 个字符的字符串

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-22T20:39:06.227

```
BEGIN TRY
    INSERT INTO YourTable (col1, col2) VALUES (@val1, @val2)
END TRY
BEGIN CATCH
    --print or insert into error log or return param or etc...
    PRINT '@val1='+ISNULL(CONVERT(varchar,@val1),'')
    PRINT '@val2='+ISNULL(CONVERT(varchar,@val2),'')
END CATCH 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2013-05-14T01:40:55.063

[对于 SQL 2016 SP2 或更高版本，请点击此链接](https://stackoverflow.com/questions/6388756/sql-server-string-or-binary-data-would-be-truncated/52482685#52482685)

对于旧版本的 SQL，请执行以下操作：

1.  获取导致问题的查询（如果您没有源，也可以使用 SQL Profiler）
2.  删除所有 WHERE 子句和其他不重要的部分，直到您基本上只剩下 SELECT 和 FROM 部分
3.  添加 WHERE 0 = 1 （这将只选择表结构）
4.  在 FROM 子句之前添加 INTO [MyTempTable]

你应该最终得到类似的东西

```
SELECT
 Col1, Col2, ..., [ColN]
INTO [MyTempTable]
FROM
  [Tables etc.]
WHERE 0 = 1 
```

这将在您的数据库中创建一个名为 MyTempTable 的表，您可以将其与目标表结构进行比较，即您可以比较两个表上的列以查看它们的不同之处。这是一种解决方法，但它是我找到的最快的方法。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-22T20:36:20.790

It depends on how you are making the Insert Calls. All as one call, or as individual calls within a transaction? If individual calls, then yes (as you iterate through the calls, catch the one that fails). If one large call, then no. SQL is processing the whole statement, so it's out of the hands of the code.

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-06-05T01:06:06.177

也可能是因为您试图将`null`值放回数据库中。因此，您的一项交易中可能包含空值。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-05-22T18:09:03.833

使用 Linq To SQL，我通过记录上下文进行调试，例如。`Context.Log = Console.Out` 然后扫描 SQL 以检查是否有明显的错误，有两个：

```
-- @p46: Input Char (Size = -1; Prec = 0; Scale = 0) [some long text value1]
-- @p8: Input Char (Size = -1; Prec = 0; Scale = 0) [some long text value2] 
```

我通过根据值扫描表模式找到的最后一个，该字段是 nvarchar(20) 但值是 22 个字符

`-- @p41: Input NVarChar (Size = 4000; Prec = 0; Scale = 0) [1234567890123456789012]`

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-10-25T18:32:25.417

简单地使用这个：MessageBox.Show(cmd4.CommandText.ToString()); 在 c#.net 中，这将向您显示主要查询，复制它并在数据库中运行。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-06-05T20:21:26.957

这里的大多数答案都是进行明显的检查，即数据库中定义的列的长度不小于您尝试传递给它的数据。

有好几次，我都被 SQL Management Studio 所困扰，快速地做了一个：

```
sp_help 'mytable' 
```

并困惑几分钟，直到我意识到有问题的列是**nvarchar**，这意味着 sp_help 报告的长度实际上是支持的实际长度的两倍，因为它是双字节（unicode）数据类型。

即，如果 sp_help 报告 nvarchar 长度为 40，则最多可以存储 20 个字符。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-09-01T14:19:46.567

检查这个要点。 [https://gist.github.com/mrameezraja/9f15ad624e2cba8ac24066cdf271453b](https://gist.github.com/mrameezraja/9f15ad624e2cba8ac24066cdf271453b)。

```
public Dictionary<string, string> GetEvilFields(string tableName, object instance)
    {
        Dictionary<string, string> result = new Dictionary<string, string>();

        var tableType = this.Model.GetEntityTypes().First(c => c.GetTableName().Contains(tableName));

        if (tableType != null)
        {
           int i = 0;

           foreach (var property in tableType.GetProperties())
           {
               var maxlength = property.GetMaxLength();
               var prop = instance.GetType().GetProperties().FirstOrDefault(_ => _.Name == property.Name);

               if (prop != null)
               {
                   var length = prop.GetValue(instance)?.ToString()?.Length;

                   if (length > maxlength)
                   {
                        result.Add($"{i}.Evil.Property", prop.Name);
                        result.Add($"{i}.Evil.Value", prop.GetValue(instance)?.ToString());
                        result.Add($"{i}.Evil.Value.Length", length?.ToString());
                        result.Add($"{i}.Evil.Db.MaxLength", maxlength?.ToString());
                        i++;
                    }
               }
            }
       }

       return result;
    } 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2022-03-02T22:32:01.480

我创建了以下方法：

1.  获取我们尝试进行此插入/更新的表的所有列的列宽。（我**直接从数据库**中获取此信息。）
2.  将列宽与我们尝试插入/更新的值的宽度进行比较。

## 步骤1：

**直接从数据库**中获取所有列的列宽：

```
// I took HUGE help from this Microsoft docs website: - AshishK
// https://docs.microsoft.com/en-us/dotnet/api/system.data.sqlclient.sqlconnection.getschema?view=netframework-4.7.2#System_Data_SqlClient_SqlConnection_GetSchema_System_String_System_String___
private static Dictionary<string, int> GetColumnSizesOfTableFromDatabase(string tableName, string connectionString)
{
    var columnSizes = new Dictionary<string, int>();

    using (var connection = new SqlConnection(connectionString))
    {
        // Connect to the database then retrieve the schema information.  
        connection.Open();

        // You can specify the Catalog, Schema, Table Name, Column Name to get the specified column(s).
        // You can use four restrictions for Column, so you should create a 4 members array.
        String[] columnRestrictions = new String[4];

        // For the array, 0-member represents Catalog; 1-member represents Schema;
        // 2-member represents Table Name; 3-member represents Column Name.
        // Now we specify the Table_Name and Column_Name of the columns what we want to get schema information.
        columnRestrictions[2] = tableName;

        DataTable allColumnsSchemaTable = connection.GetSchema("Columns", columnRestrictions);

        foreach (DataRow row in allColumnsSchemaTable.Rows)
        {
            var columnName = row.Field<string>("COLUMN_NAME");
            var dataType = row.Field<string>("DATA_TYPE");
            var characterMaxLength = row.Field<int?>("CHARACTER_MAXIMUM_LENGTH");

            // I'm only capturing columns whose Datatype is "varchar" or "char", i.e. their CHARACTER_MAXIMUM_LENGTH won't be null.
            if(characterMaxLength != null)
            {
                columnSizes.Add(columnName, characterMaxLength.Value);
            }
        }

        connection.Close();
    }

    return columnSizes;
} 
```

## 第2步：

将列宽与我们尝试插入/更新的值的宽度进行比较：

```
public static Dictionary<string, string> FindLongBinaryOrStringFields<T>(T entity, string connectionString)
{
    var tableName = typeof(T).Name;
    Dictionary<string, string> longFields = new Dictionary<string, string>();
    var objectProperties = GetProperties(entity);
    //var fieldNames = objectProperties.Select(p => p.Name).ToList();

    var actualDatabaseColumnSizes = GetColumnSizesOfTableFromDatabase(tableName, connectionString);

    foreach (var dbColumn in actualDatabaseColumnSizes)
    {
        var maxLengthOfThisColumn = dbColumn.Value;
        var currentValueOfThisField = objectProperties.Where(f => f.Name == dbColumn.Key).First()?.GetValue(entity, null)?.ToString();

        if (!string.IsNullOrEmpty(currentValueOfThisField) && currentValueOfThisField.Length > maxLengthOfThisColumn)
        {
            longFields.Add(dbColumn.Key, $"'{dbColumn.Key}' column cannot take the value of '{currentValueOfThisField}' because the max length it can take is {maxLengthOfThisColumn}.");
        }
    }

    return longFields;
}

public static List<PropertyInfo> GetProperties<T>(T entity)
{
    //The DeclaredOnly flag makes sure you only get properties of the object, not from the classes it derives from.
    var properties = entity.GetType()
                            .GetProperties(System.Reflection.BindingFlags.Public
                            | System.Reflection.BindingFlags.Instance
                            | System.Reflection.BindingFlags.DeclaredOnly)
                            .ToList();

    return properties;
} 
```

## 用法：

假设我们正在尝试插入在我们的应用程序中建模`someTableEntity`的`SomeTable`类，如下所示：

```
public class SomeTable
{
    [Key]
    public long TicketID { get; set; }
    public string SourceData { get; set; }
} 
```

它在我们的内部`SomeDbContext`是这样的：

```
public class SomeDbContext : DbContext
{
    public DbSet<SomeTable> SomeTables { get; set; }
} 
```

Db 中的此表具有如下`SourceData`字段`varchar(16)`： ![](https://i.stack.imgur.com/C5L9V.png/200)

现在我们将尝试在此字段中插入超过 16 个字符的值并捕获此信息：

```
public void SaveSomeTableEntity()
{
    var connectionString = "server=SERVER_NAME;database=DB_NAME;User ID=SOME_ID;Password=SOME_PASSWORD;Connection Timeout=200";

    using (var context = new SomeDbContext(connectionString))
    {
        var someTableEntity = new SomeTable()
        {
            SourceData = "Blah-Blah-Blah-Blah-Blah-Blah"
        };

        context.SomeTables.Add(someTableEntity);

        try
        {
            context.SaveChanges();
        }
        catch (Exception ex)
        {
            if (ex.GetBaseException().Message == "String or binary data would be truncated.\r\nThe statement has been terminated.")
            {
                var badFieldsReport = "";
                List<string> badFields = new List<string>();

                // YOU GOT YOUR FIELDS RIGHT HERE:
                var longFields = FindLongBinaryOrStringFields(someTableEntity, connectionString);

                foreach (var longField in longFields)
                {
                    badFields.Add(longField.Key);
                    badFieldsReport += longField.Value + "\n";
                }
            }
            else
                throw;
        }
    }
} 
```

将`badFieldsReport`具有此值：

> 'SourceData' 列不能采用 'Blah-Blah-Blah-Blah-Blah-Blah' 的值，因为它可以采用的最大长度为 16。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-01-01T16:15:48.423

在我们自己的情况下，我增加了 sql 表允许的字符或字段大小，它小于从前端发布的总字符数。因此，解决了这个问题。

# java - 在 Linux / Java / Scala 中枚举附加的 DVD 驱动器

> ID：779088
> 
> 赞同：1
> 
> 时间：2009-04-22T20:32:24.513
> 
> 标签：java, linux, scala, dvd

在我的 Scala（在 Java 之上运行）应用程序中，我想获取包含 DVD 媒体的所有驱动器的列表，例如：

*   /dev/scd0 星际迷航 DS9 DVD1
*   /dev/scd0 4400 DVD1

不确定是否可以获得光盘的名称，但无论如何路径对我来说很重要。

我更喜欢纯 Java / Scala 解决方案（使用 file.io 的东西）。如果这不可能，访问正确的 Linux 文件也可以（例如 /proc/something）。

提前致谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-24T19:36:04.057

我认为您对 java.io.* 不走运，但如果您不介意调用 Linux 命令，您可以通过以下方式组装数据：

1.  调用“mount”并捕获第一列输出。
2.  对从步骤 1 中捕获的每个值调用“volname”。

根据 volname 的手册页，它只返回 ISO-9660 文件系统（例如 DVD）的数据，因此可以忽略任何返回空的设备路径。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-17T11:52:40.933

使用纯 Java 代码获取驱动器是一种（未经测试的）可能性。至少在 Windows 上。

它有点hacky并且在linux下不起作用（因为我相信linux从sun那里得到的集成爱并不多）。

```
import javax.swing._
import javax.swing.filechooser._
val chooser = new JFileChooser()
val view = chooser.getFileSystemView() 
```

FileSystemView 类提供了一些功能，例如询问可能的根是否是驱动器（isDrive()）。Swing 使用它来向您显示带有正确图标的文件选择器，因此它应该在 Windows 下工作，因为 IIRC 它在那里显示正确的符号。在 Linux 下，不幸的是它只显示“/”根。

这在 linux 下不起作用的原因之一可能是 linux 开发人员不断改变他们将此类信息呈现给用户空间的首选方式。目前是 IIRC hal 和 dbus。也许 SUN 不想在每次更改时都发布新的 java 版本。

如果纯 java 没有削减它，也许你可以使用一点 jni（如果你使用 JNA 之类的工具，它不再那么难使用）来直接访问 linux apis。我没做过，有兴趣可以试试。

# apache-flex - AdvancedDataGrid SummryRow

> ID：779090
> 
> 赞同：0
> 
> 时间：2009-04-22T20:32:28.367
> 
> 标签：apache-flex, flex3, advanceddatagrid

One update: I tried using the SummaryRow on the datagrid for its basic functionalities and it is working. Now, I need to embed the text in the summary fields. E.g. If one of my summaryfields returns me the count then it should be able to display 'TOTAL (count)'

Is it possible with the summaryrow?

Also, I need to have the data to be formatted when it is displayed. e.g. %age, like 50%, 0.1%, etc.

Is this also possible?

*Hi, One quick question. I have an AdvancedDataGrid. I need to add a summaryrow to the grid which will contain SUM/AVERAGE of the respective columns in the ADG. Can anyone point me to some tutorial or any reference where I can learn how to create a summaryrow? Thanks!*

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-22T20:49:20.383

adobe 的 advancedDataGrids 介绍包含一个演示，但它似乎不再出现在网络上。您是否尝试过查看 SummaryField 参考？我有一段时间没有使用汇总字段了，但它看起来很简单。

[http://livedocs.adobe.com/flex/3/langref/mx/collections/SummaryField.html](http://livedocs.adobe.com/flex/3/langref/mx/collections/SummaryField.html)

这实际上是一个格式化示例，但它包含创建摘要行的所有代码：

[http://www.adobe.com/cfusion/communityengine/index.cfm?event=showdetails&productId=2&postId=11472](http://www.adobe.com/cfusion/communityengine/index.cfm?event=showdetails&productId=2&postId=11472)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-03T16:28:33.617

实际上，我发现的最简单和最简单的方法是在现有 ADG 下方放置另一个 ADG。新的 ADG 将充当摘要行，因此将只有一行。初始化内容 ADG 后，我们可以按照我们想要的方式渲染摘要 ADG 的单元格。此外，我们可以将新摘要 ADG 的水平滚动与内容 ADG 同步。所以，总而言之，它实际上将被视为带有摘要行的 ADG

尽管它实际上不是摘要行并且需要大量自定义，但使用它确实有意义。:)

# .net - What does "Object reference not set to an instance of an object" mean?

> ID：779091
> 
> 赞同：231
> 
> 时间：2009-04-22T20:32:38.037
> 
> 标签：.net, nullreferenceexception

I am receiving this error and I'm not sure what it means?

> Object reference not set to an instance of an object.

* * *

## 回答 #1

> 赞同：195
> 
> 时间：2009-04-22T20:51:51.207

.NET 中的变量要么是引用类型，要么是值类型。值类型是诸如[整数](http://msdn.microsoft.com/en-us/library/system.int32%28loband%29.aspx)和[布尔值](http://msdn.microsoft.com/en-us/library/system.boolean(loband).aspx) 或结构之类的原语（并且可以识别，因为它们继承自[System.ValueType](http://msdn.microsoft.com/en-us/library/system.valuetype(loband).aspx)）。布尔变量在声明时具有默认值：

```
bool mybool;
//mybool == false 
```

引用类型在声明时没有默认值：

```
class ExampleClass
{
}

ExampleClass exampleClass; //== null 
```

如果您尝试使用空引用访问类实例的成员，则会得到[System.NullReferenceException](http://msdn.microsoft.com/en-us/library/system.nullreferenceexception%28loband%29.aspx)。这与*Object reference not set to an instance of an object*相同。

以下代码是重现此问题的简单方法：

```
static void Main(string[] args)
{
    var exampleClass = new ExampleClass();
    var returnedClass = exampleClass.ExampleMethod();
    returnedClass.AnotherExampleMethod(); //NullReferenceException here.
}

class ExampleClass
{
    public ReturnedClass ExampleMethod()
    {
        return null;
    }
}

class ReturnedClass
{
    public void AnotherExampleMethod()
    {
    }
} 
```

这是一个非常常见的错误，可能由于各种原因而发生。根本原因实际上取决于您遇到的具体情况。

如果您正在使用 API 或调用可能返回 null 的方法，那么*优雅*地处理这一点很重要。上面的 main 方法可以修改为 NullReferenceException 永远不会被用户看到：

```
static void Main(string[] args)
{
    var exampleClass = new ExampleClass();
    var returnedClass = exampleClass.ExampleMethod();

    if (returnedClass == null)
    {
        //throw a meaningful exception or give some useful feedback to the user!
        return;
    }

    returnedClass.AnotherExampleMethod();
} 
```

以上所有内容实际上只是 .NET 类型基础知识的提示，有关更多信息，我建议[通过 C# 学习 CLR](http://www.microsoft.com/learning/en/us/Books/6522.aspx)或阅读同一作者 - Jeffrey Richter 的这篇[MSDN 文章](http://msdn.microsoft.com/en-us/magazine/cc301569.aspx)。另请查看更复杂的[示例](http://www.danielfortunov.com/software/$daniel_fortunovs_adventures_in_software_development/2009/04/23/net_event_invocation_thread_safety)，了解何时会遇到 NullReferenceException。

一些使用 Resharper 的团队使用[JetBrains 属性](https://www.jetbrains.com/resharper/help/Code_Analysis__Code_Annotations.html)来注释代码，以突出显示（不）预期的空值。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2014-11-10T08:24:53.207

简而言之，这意味着..您正在尝试访问一个对象而不实例化它..您可能需要先使用“new”关键字来实例化它，即创建它的一个实例。

例如：

```
public class MyClass
{
   public int Id {get; set;}
}

MyClass myClass;

myClass.Id = 0; <----------- An error will be thrown here.. because myClass is null here... 
```

您将不得不使用：

```
myClass = new MyClass();
myClass.Id = 0; 
```

希望我说清楚了..

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2009-04-22T21:39:21.060

另一种简单的方法：

```
 Person myPet = GetPersonFromDatabase();
 // check for myPet == null... AND for myPet.PetType == null
 if ( myPet.PetType == "cat" ) <--- fall down go boom! 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-04-22T20:34:26.787

Not to be blunt but it means exactly what it says. One of your object references is NULL. You'll see this when you try and access the property or method of a NULL'd object.

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-22T20:36:29.213

It means you did something like this.

```
Class myObject = GetObjectFromFunction(); 
```

And **without** doing

`if(myObject!=null)`, you go ahead do `myObject.Method();`

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-08-23T10:45:49.250

如果我有课：

```
public class MyClass
{
   public void MyMethod()
   {

   }
} 
```

然后我做：

```
MyClass myClass = null;
myClass.MyMethod(); 
```

第二行抛出此异常，因为我正在调用[引用类型](http://msdn.microsoft.com/en-us/library/490f96s2.aspx)对象的方法`null`（即尚未 通过调用[实例化](http://msdn.microsoft.com/en-us/library/vstudio/dd460654.aspx)`myClass = new MyClass()`）

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-22T20:49:25.593

大多数时候，当您尝试将值赋值给对象时，如果该值为 null，则会发生这种异常。请检查[此链接](http://codebetter.com/blogs/raymond.lewallen/archive/2005/06/23/65033.aspx)。

为了自学，你可以放一些检查条件。喜欢

```
if (myObj== null)
Console.Write("myObj is NULL"); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-22T20:36:33.537

> what does this error mean? Object reference not set to an instance of an object.

exactly what it says, you are trying to use a null object as if it was a properly referenced object.

# java - Vast difference in Java Performance from 1.4 to 1.6

> ID：779092
> 
> 赞同：2
> 
> 时间：2009-04-22T20:32:47.943
> 
> 标签：java, performance

I have observed a great difference in Sun Java performance when code is compiled through jdk1.6 as compared to jdk1.5 or jdk1.4 (over 4 folds)

What changes and optimizations have been done? Is there anything worth taking home from these changes which will help to boost our application performance.

Thanks for replying

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-22T20:37:04.767

See: [Java SE 6 Performance White Paper](https://www.oracle.com/java/technologies/javase/6performance.html).

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-22T21:30:07.527

您可能对最近对 AMD 工程师的[Java Posse 采访感兴趣。](http://javaposse.com/index.php?post_id=454436)他们谈论了过去几年机器架构和 HotSpot 的进步。他们还讨论了一些与您的观察相符的基准。

这些工程师的“收获”是，开发人员可以通过遵循常见的习惯用法和编写简单的代码来最好地帮助 HotSpot 发挥它的魔力。开发人员在一个版本中进行的巧妙优化可能会阻止 HotSpot 在以后的版本中进行更好的优化。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-22T20:37:42.423

The [Java SE 6 Performance White Paper](http://java.sun.com/performance/reference/whitepapers/6_performance.html) and/or the [J2SE 5.0 Performance White Paper](http://java.sun.com/performance/reference/whitepapers/5.0_performance.html) may answer your questions.

# string - How do I replace quotes in XSLT with their HTML entities?

> ID：779101
> 
> 赞同：0
> 
> 时间：2009-04-22T20:34:12.933
> 
> 标签：string, xslt

This is related to my previous question -" [Manipulate the output of <xsl:apply-templates>](https://stackoverflow.com/questions/778120/manipulate-the-output-of-xslapply-templates)". I want to ask about the specific problem I am looking to address. How do I replace quotes in XSLT with their HTML entities. I want to eventually pass it to Javascript variable with special characters escaped.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T21:07:29.530

您可能想查看 Google 代码项目[xml2json-xslt](http://code.google.com/p/xml2json-xslt/)，尤其是[xml2js.xslt](http://code.google.com/p/xml2json-xslt/source/browse/trunk/xml2js.xslt)模板。也许你的答案就在那里。

# adobe-illustrator - AI (Adobe Illustrator) Files Detect Rasterized

> ID：779107
> 
> 赞同：0
> 
> 时间：2009-04-22T20:35:27.360
> 
> 标签：adobe-illustrator

Is there a way to detect whether there are any rasterized components to an Adobe Illustrator file? Under normal circumstances such a file can be vector based (in which case it will scale well when the size is increased) but if there's a pasted image in the file, this of course won't scale. Any ideas? Any programming language implementation is welcome although in the end I would be emitting C#...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-11T14:43:23.460

使用 COM 参考 Illustrator：

```
bool HasRaster = false;

Illustrator.Application app = new Illustrator.Application();
Illustrator.Document doc = app.Open("/FileName.AI", null, null);
HasRaster = (doc.RasterItems.Count > 0) ? true : false;
app.Quit(); 
```

# iphone - iPhone：无法启动模拟应用程序：未知错误

> ID：779115
> 
> 赞同：6
> 
> 时间：2009-04-22T20:37:01.927
> 
> 标签：iphone, ios-simulator

这是一个新的 iPhone 项目，只有 1 个目标（与[这个问题](https://stackoverflow.com/questions/717453/multiple-targets-in-xcode-failed-to-launch-simulated-application-unknown-error)不同）

在构建时，我们得到：

```
Failed to launch simulated application: Unknown error. 
```

谷歌再次没有给我们任何东西，很多人都遇到过这个问题，并且有很多疯狂的想法尝试“哦清理构建”、“清除缓存”、“旋转这个标志”，但没有一个能始终如一地工作和工作。我们可以使用 SDK 2.2.1 和 3.0 beta 在两台不同的机器上重现这一点。不是机器上的安装，因为其他 iphone 项目工作得很好，所以我们认为它与这个特定项目的配置有关，但是在梳理了两次配置后，我们无法发现问题。

万娜，我想花 200 美元买一条线索。

*   试过：XCode菜单->清除缓存
*   尝试：清理所有目标
*   试过：rm -rf ~/Library/Application\ Support/iPhone\ Simulator

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-08-10T06:13:09.493

这发生在我身上一次，我想我在博客中看到简单地退出并重新启动 Xcode。奇迹般地，它对我有用。我怀疑这是所有此类问题的最终解决方案，但是如果您还没有关闭 Xcode，那么值得一试。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-22T21:30:42.140

我有时会看到这个问题，并通过重新启动机器来解决。我怀疑模拟器的内部状态被搞砸了。不过听起来不像你的问题。

我同意 MiRAGe；如果这种情况仍然存在，请启动一个新项目并导入您的源代码。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-22T21:14:23.617

如果其他项目运行良好；开始一个新的并复制文件。梳理配置是行不通的（因为 XCode 有成千上万的配置可能性）。

你可以寄给我一张 200 美元的支票。

PS：当你真正开始一个新项目时，一步一步做。每次更改后运行它。也许你会发现你的问题。这可能是一项艰巨的工作，但它也可能会帮助其他成千上万有“未知错误”的迷失灵魂。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-08-10T05:54:38.423

更改产品名称对我有用。我尝试了几种不同的替代方案，它们都运行良好。这是我一开始使用的“神奇产品名称”，每次我回去都失败了。YMMV。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-09-22T13:01:48.960

这可能是因为目标缺少项目。展开目标并验证所有需要的源文件和库都在那里。搞砸后重新启动 Xcode。

[替代文字 http://pici.se/pictures/TsnTQxhKh.png](http://pici.se/pictures/TsnTQxhKh.png)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-05-13T12:18:29.050

谢谢...确实有同样的问题或更糟。我的应用程序没有加载到模拟器中，或者有时构建失败。现在意识到这是非常合乎逻辑的。

当您创建一个新项目并且 info.plist 与该项目相关联。每次添加修改/添加目标时，都会使用新名称生成另一个 plist。

但是与 info.plist 的原始关联仍然存在并且存在冲突。因此，从当前目标中删除该关联，或者最好还是从项目中删除并丢弃 info.plist。只需确保在目标设置（做 getInfo）中提到了正确的 info.plist。

请注意产品/目标的名称不应包含空格。如果您真的想要它更改捆绑显示名称。

现在应该关闭 xcode 的唯一原因是确保项目文件已注册所有更改。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-05-15T17:38:50.827

当我将 .plist 添加到我的目标（Info.plist -> Get Info -> Targets -> Target Memberships）时，我遇到了这个问题。当我再次取消选中它时它消失了。

我看到这与 Targets -> -> Get Info -> Build -> Packaging -> "Info.plist file" -> my.plist 提到的旅行是分开的，但我仍然不太明白发生了什么，并且绝对不明白为什么我们会收到如此无用的错误消息。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-10-04T01:50:47.773

出于同样的原因，我有过两次：将一个名为 Resources 的文件夹添加到项目中。这是与某些东西的命名冲突（尽管默认情况下应用程序包中没有任何称为“资源”的东西）。神秘的命名冲突可能是导致此问题的常见原因。

为了解决这个问题，我将文件夹重命名为其他东西（“资产”），手动删除了整个构建文件夹（清理不起作用）并退出模拟器。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-24T21:24:14.890

如果您绝望，可以尝试的另一件事是更改“产品名称”设置。当其他一切都没有时，这对我有用。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-11-20T07:15:14.307

我遇到了同样的问题，因为我更改了 BundleName 和其他一些值，但没有更改 PRODUCT_NAME。我在查找 PRODUCT_NAME 的定义位置时遇到了问题：Get Info on the target，Build-tab，它在列表的某处。

我更改了 PRODUCT_NAME 以匹配包名称，重新启动 Xcode 并且它工作。

弗雷德

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-09-21T16:05:37.377

我最近遇到了这个问题，修复非常简单。我记得我一直在编辑目标设置，在“可执行文件”字段的“属性”选项卡下，值后面有一个空格，即 ${EXECUTABLE_NAME}。是的，一个空间。除非您突出显示该字段，否则无法看到。我想出了这一点，因为我已经编辑了该字段，看看是否可以通过这种方式添加命令行选项。我想当我取消附加选项时，我错过了一个空格。因此，虽然这是导致此问题的唯一可能原因，但值得一试。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-10-07T18:35:11.227

有同样的问题。上面的答案都不适合我。然后我记得在问题开始之前我刚刚将图标添加到资源文件夹中。将图标移动到其他来源文件夹并且它工作。奇怪的！

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-11-03T00:58:42.503

多谢你们。

我的产品名称与信息列表中的不同。修复后重新启动，这一切都消失了。

ps，stackoverflow 对像我这样的初学者有很大的帮助。来自downunder的感谢。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-12-01T21:58:17.637

我用一个名为“resources”的文件夹添加了这个问题。重命名它，清理所有东西并再次运行。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2011-01-15T11:39:46.093

1）重启Xcode；2）在 Info.plist 上使用“获取信息”并取消选中当前目标（无论如何都会添加 Info.plist）。就这样。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2011-03-23T20:30:07.977

我可以确认命名冲突是我们问题的根源。`resources`我们在 Xcode 组中有一个文件系统文件夹，名为`Resources`. 有时我们会收到错误，系统会锁定，有时不会。将文件夹更改为名称`assets`解决了我们的问题。在阅读了上面的一些评论之后 - 似乎 Xcode 组名称可能与目录/文件夹名称发生冲突。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2013-11-24T14:00:54.180

This happened to me when I changed my version number from 1.0 to 0.1\. When I changed it back it started working again.

# php - OOP 如何设法“包含”存储在不同文件中的类

> ID：779123
> 
> 赞同：8
> 
> 时间：2009-04-22T20:38:01.160
> 
> 标签：php, oop, inheritance, class

我正在尝试进入 OOP 开发并转向这里，因为我厌倦了在网上搜索并且只找到关于什么是类以及它们如何相互继承的非常基本的信息——我理解*。*

我还不明白所有这些类如何存储在不同的文件中，围绕文件夹结构进行点缀，但使用该类所需要做的只是在代码中提及它的名称。这究竟是如何工作的？

并且在相关说明中，如果有人可以推荐一本好书或在线教程，这将为 OOP（最好是基于 php）提供良好的基础，我将非常感激。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-22T20:40:44.697

PHP 具有根据您所做的某些调用自动加载文件的功能。[PHP: Autoloading Objects](http://php.net/autoload)是你在这件事上的权威资源。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-24T19:28:49.753

技术答案是[PHP Autoloading](http://us.php.net/autoload)。

实现答案是这样的：

使用的一种常用方法与与文件夹结构相关的类的名称有关。那里有文章，但这里是一个简短的摘要：

设置自动加载代码时，取类名并用斜杠替换下划线。这样您就可以在文件夹中组织您的课程。

例如：

类名：Database_Provider_MySQL

文件：数据库/提供者/MySQL.php

所以在自动加载中，你会使用传入的类名，用斜杠替换下划线。然后包含该特定文件。

这实现了您想要完成的目标，您可以通过创建一个新实例来简单地加载一个类。您永远不必对这些类使用 include 语句。

请记住不要深入到最终达到 6 级以上的位置。我认为 3 到 5 之间是一个很好的最大值。

此外，这确实要求每个文件只保留 1 个类（类似于 Java）。尽管看起来不方便，但它使查找代码变得容易得多。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-22T21:08:17.157

我有一点要说，虽然我是 PHP 的超级（轻描淡写）粉丝（你想投我的票，我不在乎！总有一天我们会被接受 ;-)，PHP 并不是你真正想要走的路在学习 OOP 时。

PHP 做的事情，嗯，不同。不同是好的，不要误会我的意思，我喜欢不同，但它也很标新立异。非常规，也很好，几乎是谷歌的代名词，如果你问我，但我们并不生活在一个非常规的世界！你不能只是走到某人面前说；“嘿，我知道 OOP，我是用 PHP 学的”。它可能押韵，但之后人们不会认真对待你。不要问我为什么，但这就像黄香蕉一样真实。我去过那儿。

因此，如果您想学习传统的 OOP，请尝试 Java。它与它们一样传统（既不好也不好）。

老实说，我从来没有在一篇 20 句话的帖子中多次支持自己。不过得看ma'rep。:-D

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-23T14:54:42.723

PHP 的 include_path 配置设置告诉 PHP 在哪些目录中查找文件。

如果你做这样的事情：

```
<?php  include 'MyClass.php'; ?> 
```

然后 PHP 在当前目录中搜索“MyClass.php”，如果找不到该文件，则搜索 include_path 上的任何目录。许多类库做这样的事情：

```
<?php

// Set the ini page to the base package directory
ini_set('include_path', ini_get('include_path') . PATH_SEPARATOR . dirname(__FILE__));

// Now, in all of your sub-directories, you can still do things like this: 
include 'Subdirectory/Anothersub/AnotherClass.php';

// Now use the class
$obj = new AnotherClass();

?> 
```

它可以通过自动加载进一步简化：http: [//us.php.net/autoload](http://us.php.net/autoload)

其他库只是在基本包文件中包含所有立即使用的文件，因此所有这些类都可以立即使用。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-23T15:04:19.207

不同的语言/框架以不同的方式执行此操作，但归结为有一个内置的默认位置列表来查看和/或您可以指定查看的位置（您如何再次执行此操作取决于语言/框架）。我知道这个问题被标记为 php 但问题并没有具体提到 php 所以我想我会给出一个稍微更一般的答案

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-22T23:10:47.127

当我的研究工作遇到困难时，我发现查看现有代码非常有帮助。有大量的脚本、包、框架和应用程序遵循优秀的 PHP 编码实践，可以从中学习和学习。有几个关于 SO 的问题指出了几个好的问题。

到目前为止，我最喜欢的是[Zend 框架](http://framework.zend.com/)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-22T20:41:45.783

> 并且在相关说明中，如果有人可以推荐一本好书或在线教程，这将为 OOP（最好是基于 php）提供良好的基础，我将非常感激。

[应用 UML 和模式：面向对象分析与设计和迭代开发简介](https://rads.stackoverflow.com/amzn/click/com/0131489062)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-23T15:14:37.373

您所描述的与面向对象编程本身无关。这只是某些特定语言的一个特性。这些语言通过对文件的存储方式强制执行某种约定来做到这一点（例如，该类`foo.bar.quux`可能必须位于 foo/bar/quux.py 的某个标准位置）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-04-17T14:27:30.377

[http://www.headfirstlabs.com/books/hfooad/](http://www.headfirstlabs.com/books/hfooad/)

Head First 面向对象的分析和设计。Head First 是一本很棒的系列丛书，其中包含简单但非常有用的示例。他们向您展示信息的整个方式都很棒。他们甚至可能还有一些面向对象的 php 书籍！

# visual-studio - Visual Studio 可扩展性（加载项）：如何访问 Silverlight 相关的属性？

> ID：779132
> 
> 赞同：2
> 
> 时间：2009-04-22T20:40:04.773
> 
> 标签：visual-studio, silverlight, vsx

这是前段时间在 MSDN 论坛上发布的问题，直到今天仍未得到解答：

[http://social.msdn.microsoft.com/Forums/en-US/vsx/thread/676b13d4-acfc-4252-b102-5fc0553e4b81/](http://social.msdn.microsoft.com/Forums/en-US/vsx/thread/676b13d4-acfc-4252-b102-5fc0553e4b81/)

我感兴趣的属性是 ProjOutputReferences，存储在 Visual Studio 解决方案 (.sln) 文件中。

在 Visual Studio 中，可通过 Silverlight 网站项目的“属性页”对话框访问此属性（要求您安装了适用于 VS2008 的 Silverlight 工具）。在那里，有一个名为“Silverlight Applications”的页面，可以在其中编辑上述属性的内容。

我需要通过 VS 自动化或低级接口以编程方式在我的加载项中访问它。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-28T16:53:36.733

在用于 VS 2008 SP1 的 Silverlight 工具的最新发布版本中，该列表保留在引用项目文件的 SilverlightApplicationList 属性中。例如，我的解决方案中有 SilverlightApplication2 和 SilverlightApplication2.Web（后者引用前者）。我的 SilverlightApplication2.Web.csproj 文件中有以下节点：

```
<SilverlightApplicationList>{BBA7B148-42AE-477E-BB5E-0BA5AEC0A467}|..\SilverlightApplication2\SilverlightApplication2.csproj|ClientBin|False</SilverlightApplicationList> 
```

确实没有办法通过纯粹的 DTE 访问此属性，但您可以使用 Visual Studio SDK / VSIP 接口来执行此操作（具体而言，您希望获取 IVsBuildPropertyStorage 接口以访问 MSBuild 属性）。这是一个代码片段（在 VSPackage 的菜单命令处理程序中运行）：

```
IVsSolution solution = GetService(typeof(SVsSolution)) as IVsSolution;

IVsHierarchy hierarchy;
solution.GetProjectOfUniqueName(@"SilverlightApplication2.Web\SilverlightApplication2.Web.csproj", out hierarchy);

IVsBuildPropertyStorage buildPropertyStorage = hierarchy as IVsBuildPropertyStorage;

if (buildPropertyStorage != null)
{
    string silverlightAppListValue;
    buildPropertyStorage.GetPropertyValue("SilverlightApplicationList", "Debug", (uint)_PersistStorageType.PST_PROJECT_FILE, out silverlightAppListValue);

    MessageBox.Show(silverlightAppListValue);
} 
```

如果您仍想尝试从 Addin 执行此操作，则必须遵循[Craig 提到](http://blogs.msdn.com/craigskibo/archive/2003/10/15/51692.aspx)的方法将 DTE 对象转换为 IServiceProvider（以便您可以调用 GetService）。

-[亚伦马丁](http://blogs.msdn.com/aaronmar)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-01T20:56:47.800

由于 .sln 文件只是文本文件，请尝试使用记事本编辑 .sln 文件。您应该能够在那里找到您正在寻找的房产。假设信息的格式可以理解，那么您应该能够使用简单的文本解析器以编程方式从 .sln 中提取信息。

# asp.net - 使用 UrlMapping 时无法使用站点地图

> ID：779143
> 
> 赞同：1
> 
> 时间：2009-04-22T20:43:44.827
> 
> 标签：asp.net, c#-2.0, url-mapping

当我为每个页面创建文件夹并重新映射 web.config 中的文件夹时，出现了这个问题。

1）我看不到页面的内容。

2）当我使用导航控件时，我的 web.SiteMap 不起作用并且不显示页面路径。

我的项目有什么问题，我解决了什么？

这个链接是我的网站：

网址映射代码：

```
<urlMappings>
        <add url ="~/HOME" mappedUrl ="~/Default.aspx"/>
        <add url ="~/a" mappedUrl ="~/a.aspx" />
        <add url ="~/a1" mappedUrl ="~/a1/a1.aspx"/>
        <add url ="~/a2" mappedUrl ="~/a2/a2.aspx"/>
        <add url ="~/b" mappedUrl ="~/b/b.aspx"/>
        <add url ="~/b1" mappedUrl ="~/b1/b1.aspx"/>
        <add url ="~/b2" mappedUrl ="~/b2/b2.aspx"/>
        <add url ="~/b3" mappedUrl ="~/b3/b3.aspx"/>
        <add url ="~/c" mappedUrl ="~/c/c.aspx"/>
        <add url ="~/c1" mappedUrl ="~/c1/c1.aspx"/>

          </urlMappings> 
```

站点地图代码：

```
<siteMap xmlns="http://schemas.microsoft.com/AspNet/SiteMap-File-1.0" >

<siteMapNode url="~/HOME" title="Home"  description="Home Page">

  <siteMapNode url="~/a" title="page a" description="page a">
    <siteMapNode url="~/a1" title="page a-1" description="page 1 of a" />
    <siteMapNode url="~/a2" title="page a-2" description="page 2 of a"/>
  </siteMapNode>

  <siteMapNode url="~/b" title="page b" description="page b">
    <siteMapNode url="~/b1" title="page b-1" description="page 1 of b" imageTitle="lake"/>
    <siteMapNode url="~/b2" title="page b-2" description="page 2 of b" imageTitle="wolf"/>
    <siteMapNode url="~/b3" title="page b-3" description="page 3 of b" imageTitle="thunder"/>
  </siteMapNode>

  <siteMapNode url="~/c" title="page c" description="page c">
    <siteMapNode url="~/c1" title="page c-1" description="page 1 of c"/>
  </siteMapNode>

</siteMapNode> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-24T08:45:16.727

问题是您想要的 Url 是您 wbesite 中的实际文件夹，因此 IIS 首先选择它。有几种方法可以解决这个问题。

*   将所有 .aspx 文件名更改为 Default.aspx，这些将在您键入[http://website/a](http://website/a)时被选中，例如，如果您有一个名为“a”的文件夹，其中包含 Default.aspx，请删除其中的所有条目urlMappings
*   将 URL 作为与实际目录不同的名称
*   使用 3.5 SP1 中已经引入的 ASP.Net URL Routing 看看[Chis Cavanagh](http://chriscavanagh.wordpress.com/2008/03/11/aspnet-routing-goodbye-url-rewriting/)的博客文章就可以了。
*   使用 Jose 提到的 ReWritter

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T12:57:13.237

我可以解决我的问题。

您应该创建文件夹名称默认值并创建页面名称默认值，然后在导航控件中使用 web.sitemap。

# .net - LINQ 有哪些巧妙的用途？

> ID：779146
> 
> 赞同：17
> 
> 时间：2009-04-22T20:44:54.403
> 
> 标签：.net, linq

在 LINQ to SQL 之外，LINQ 有哪些巧妙的用途？

您是否发现 LINQ 使解决问题变得更容易？请发布示例。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-22T20:51:29.583

*   使用 LINQ to Objects，几乎所有与集合有关的事情都变得更容易。我发现这比 LINQ to SQL 有用得多。
*   我非常喜欢 Marc Gravell 和我开发的名为[Push LINQ](http://web.archive.org/web/20090614011041/http://msmvps.com/blogs/jon_skeet/archive/2008/01/04/quot-push-quot-linq-revisited-next-attempt-at-an-explanation.aspx)的框架（目前是[MiscUtil](http://pobox.com/~skeet/csharp/miscutil)的一部分，但最终可能会转移到[MoreLINQ](http://code.google.com/p/morelinq/)）。这对于计算大型流数据集的聚合非常有用，例如巨大的日志文件
*   LINQ to XML 是我用过的最好的 XML API，它与 LINQ to Objects 的集成非常好。
*   Parallel LINQ 是 Parallel Extensions 框架的一个非常好的部分——它确实使在适当的地方并行化任务变得更容易（尽管如果你不小心它可能会[出错）](http://msmvps.com/blogs/jon_skeet/archive/2007/12/04/a-cautionary-parallel-tale-ordering-isn-t-simple.aspx)

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-04-22T22:05:53.820

Microsoft 的 Robert Shelton 很酷，他为我们列出[了一些 LINQ 实现](http://web.archive.org/web/20131229055859/http://www.sheltonblog.com/archive/2008/07/11/list-of-linq-providers.aspx)：

截至 2008 年 7 月：

*   LINQ 到亚马逊
*   LINQ 到 Active Directory
*   LINQ to Bindable Sources (SyncLINQ)
*   LINQ over C-项目
*   LINQ 到 CRM
*   LINQ To Geo——地理空间数据的语言集成查询
*   LINQ 到 Excel
*   LINQ 到表达式 (MetaLinq)
*   LINQ Extender（用于构建 LINQ 提供程序的工具包）
*   LINQ 到 Flickr
*   LINQ 到谷歌
*   LINQ to Indexes（LINQ 和 i40）
*   LINQ to IQueryable（提供者上的 Matt Warren）
*   LINQ 转 JSON
*   LINQ 到 NHibernate
*   LINQ 转 JavaScript
*   LINQ 到 LDAP
*   LINQ to LLBLGen Pro
*   LINQ 到 Lucene
*   LINQ to Metaweb(freebase)
*   LINQ to MySQL、Oracle 和 PostgreSql (DbLinq)
*   LINQ 到 NCover
*   LINQ 到 Opf3
*   LINQ 到并行 (PLINQ)
*   LINQ 到 RDF 文件
*   LINQ 到共享点
*   LINQ 到 SimpleDB
*   LINQ 到流
*   LINQ 到 Web 查询
*   LINQ 到 WMI
*   LINQ 到 XtraGrid

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2010-01-22T01:29:29.470

我使用 LINQ在单个 C# 语句中解决了一些[Project Euler 。](http://projecteuler.net/)（请注意，语句与行不同）

当心：邪恶的恶作剧。

```
//Euler 1
//Add all the natural numbers below one thousand that are multiples of 3 or 5.
Enumerable.Range(0, 1000).Where(i => i % 5 == 0 || i % 3 == 0).Sum()

//Euler 2
//Find the sum of all the even-valued terms in the sequence which do not exceed four million
//Enumerable.Repeat(new List<long>(1024){ 1, 1 }, 1).First(fib => Enumerable.Range(0, int.MaxValue).TakeWhile(i => fib.Last() <= 4000000)
    .Aggregate(true, (u1, u2) => { fib.Add(fib.Last() + fib[fib.Count - 2]); return true; })).Where(n => n % 2 == 0).Sum()

//Euler 3 (>32bit)
//What is the largest prime factor of the number 600851475143?
Enumerable.Range(2, Int32.MaxValue - 2).Where(n => 600851475143 % n == 0 && Enumerable.Range(2, n / 2 - 1).All(f => n % f > 0)).Max()

//Euler 4
//Find the largest palindrome made from the product of two 3-digit numbers.
Enumerable.Range(100, 900).SelectMany(x => Enumerable.Range(100, 900).Select(y => x * y))
                          .Where(n => { var s = n.ToString(); return s.SequenceEqual(s.Reverse()); }).Max()

//Euler 5 (>32bit)
//What is the smallest number divisible by each of the numbers 1 to 20?
Enumerable.Range(20, Int32.MaxValue - 21).Where(n => Enumerable.Range(1, 20).All(i => n % i == 0)).First()

//Euler 6
//Find the difference between the sum of the squares of the first one hundred natural numbers and the square of the sum.
Math.Pow(Enumerable.Range(1, 100).Sum(), 2) - Enumerable.Range(1, 100).Select(i => i * i).Sum()

//Euler 7
//Find the 10001st prime.
Enumerable.Range(2, Int32.MaxValue - 1).Where(n => Enumerable.Range(2, n / 2 - 1).All(f => n % f > 0)).Skip(10000).First()

//Euler 8
//Discover the largest product of five consecutive digits in the 1000-digit number.
Enumerable.Range(0, 995).Select(i => "7316717653133062491922511967442657474235534919493496983520312774506326239578318016984801869478851843858615607891129494954595017379583319528532088055111254069874715852386305071569329096329522744304355766896648950445244523161731856403098711121722383113622298934233803081353362766142828064444866452387493035890729629049156044077239071381051585930796086670172427121883998797908792274921901699720888093776657273330010533678812202354218097512545405947522435258490771167055601360483958644670632441572215539753697817977846174064955149290862569321978468622482839722413756570560574902614079729686524145351004748216637048440319989000889524345065854122758866688116427171479924442928230863465674813919123162824586178664583591245665294765456828489128831426076900422421902267105562632111110937054421750694165896040807198403850962455444362981230987879927244284909188845801561660979191338754992005240636899125607176060588611646710940507754100225698315520005593572972571636269561882670428252483600823257530420752963450"
    .Substring(i,5).Select(c => c - '0').Aggregate(1, (x, y) => x * y)).Max()

//Euler 10
//Find the sum of all the primes below two million.
Enumerable.Range(2, 2000000).Where(n => Enumerable.Range(2, n / 2 - 1).All(f => n % f > 0)).Select(x => (long)x).Sum()

Enumerable.Range(0, 168).Aggregate(Enumerable.Range(2, 2000000).Select(x => (long)x).ToList(), (result, index) => { result.RemoveAll(i => i > result[index] && i % result[index] == 0); return result; }).Sum()

Enumerable.Repeat(Enumerable.Range(2, 2000000).Select(x => (long)x).ToList(), 1).SelectMany(list => Enumerable.Range(0, Int32.MaxValue).Select(i => new { List = list, Index = i }))
    .TakeWhile((g, i) => g.List[g.Index] * g.List[g.Index] <= 2000000 || i.Dump("Rounds") != i).Aggregate((List<long>) null, (result, g) => { g.List.RemoveAll(i => i > g.List[g.Index] && i % g.List[g.Index] == 0); return g.List; }).Sum()

Enumerable.Repeat(Enumerable.Range(2, 2000000).Select(x => (long)x).ToList(), 1).First(list => Enumerable.Range(0, Int32.MaxValue)
    .TakeWhile(i => list[i] * list[i] <= 2000000 || i.Dump("Rounds")!=i).Aggregate(0, (count, i) => count + list.RemoveAll(j => j > list[i] && j % list[i] == 0)) != null).Sum()

//Euler 14
Enumerable.Range(1, 1000000).Select(s => Enumerable.Repeat(new List<long>(32) { s }, 1).First(list => Enumerable.Range(0, Int32.MaxValue).TakeWhile(i => list.Last() > 1)
    .Aggregate(0, (index, unused) => { list.Add(list.Last() % 2 == 0 ? list.Last() / 2 : 3 * list.Last() + 1); return 1; }) == 1 || true))
    .Aggregate(new List<long>(), (list, result) => list.Count <= result.Count ? result : list)

//Euler 19
//How many Sundays fell on the first of the month during the twentieth century?
Enumerable.Range(1901,100).SelectMany(y => Enumerable.Range(1,12).Select(m => new DateTime(y, m, 1))).Where(d => d.DayOfWeek == DayOfWeek.Sunday)

//Euler 21
//Evaluate the sum of all the amicable numbers under 10000.
Enumerable.Repeat(new Func<int, int>(n => Enumerable.Range(1, n / 2).Where(d => n % d == 0).Sum()), 1)
          .Select(D => Enumerable.Range(1, 10000).Where(a => a == D(D(a)) && a != D(a)).Sum())

//Euler 34
//Find the sum of all numbers which are equal to the sum of the factorial of their digits.
Enumerable.Range(3, 40600).Where(n => n == n.ToString().Select(d => Enumerable.Range(1, d - '0').Aggregate(1, (r, i) => r * i)).Sum()).Sum()

//Euler 40  
Enumerable.Repeat(new StringBuilder(), 1)
    .Where(result => Enumerable.Range(0, Int32.MaxValue)
                               .TakeWhile(i => result.Length <= 1000000)
                               .Aggregate(result, (unused, index) => result.Append(index)) != null)
    .Select(result => Enumerable.Range(1, 6).Select(i => result[(int)Math.Pow(10, i)] - '0')).First().Aggregate(1, (x, y) => x * y) 
```

其他 LINQ 单线：

```
//Primes (Ineffecient)
Enumerable.Range(2, 1000000).Where(n => Enumerable.Range(2, n / 2 - 1).All(f => n % f > 0)).Count()

//Sieve of Eratosthenes
Enumerable.Range(0, 168)
          .Aggregate(Enumerable.Range(2, 1000000).ToList(), (result, index) => { 
               result.RemoveAll(i => i > result[index] && i % result[index] == 0); 
                return result; 
            }).Count
//Prime Factors
Enumerable.Range(2,13195 / 2)
          .Where(n => 13195 % n == 0
                   && Enumerable.Range(2, n / 2 - 1).All(f => n % f > 0))

//Fibonacci
Enumerable.Repeat(new List<long>(32){ 1, 1 }, 1)
    .First(fib => Enumerable.Range(0, 32).Aggregate(true, (u1, u2) => { 
        fib.Add(fib.Last() + fib[fib.Count - 2]); 
        return true; 
    })) 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-23T00:12:25.980

您还应该从 CodePlex 站点查看[Bindable LINQ](http://www.codeplex.com/bindablelinq)：

> “可绑定 LINQ 是 LINQ 的一组扩展，可为标准 LINQ 查询添加数据绑定和更改传播功能。
> 
> 除了传播更改之外，Bindable LINQ 还可以在运行时分析您的查询并检测您的查询所具有的任何依赖关系。如果这些依赖项提供要订阅的事件，Bindable LINQ 将自动监视它们的更改。"

以下是该网站的示例之一：

> 以这个查询为例：

```
 contactsListBox.ItemsSource = from c in customers
                                 where c.Name.StartsWith(textBox1.Text)
                                 select c; 
```

> 可绑定 LINQ 将检测到查询依赖于 TextBox 对象 textBox1 的 Text 属性。由于 TextBox 是 WPF 控件，因此 Bindable LINQ 知道订阅控件上的 TextChanged 事件。
> 
> 最终结果是，当用户键入时，查询中的项目会被重新评估，并且更改会出现在屏幕上。处理事件不需要额外的代码。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-22T20:46:38.520

我喜欢这个网站[blog.functionalfun.net](http://blog.functionalfun.net)的确切目的：LINQ 的实用（和不太实用，更有趣）的使用。最终，他所涵盖的几乎所有内容都可以应用于现实生活中，但他开始在博客上写更多“实用 LINQ”主题，以讨论他在业务逻辑代码中使用的有趣的东西。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-04-22T21:57:06.180

[Bart De Smet](http://community.bartdesmet.net/blogs/bart/Default.aspx)的博客对 LINQ 有一些巧妙的用法，例如[Who ever said LINQ predicates need to be Boolean-valued?](http://community.bartdesmet.net/blogs/bart/archive/2008/09/14/who-ever-said-linq-predicates-need-to-be-boolean-valued.aspx) .

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-11-19T23:55:20.293

[Linq to Excel](http://code.google.com/p/linqtoexcel/)使从 Excel 电子表格中检索数据变得轻而易举。它负责创建 OLEDB 连接和 sql 语句。您所要做的就是告诉它电子表格的文件路径并创建 linq 语句。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-22T20:48:38.997

Chalie Calvert[博客](http://blogs.msdn.com/charlie/archive/2006/10/05/Links-to-LINQ.aspx)列出了一些好的 linq 提供商。

[休眠到 Linq](http://ayende.com/Blog/archive/2007/03/17/Implementing-Linq-for-NHibernate-A-How-To-Guide--Part.aspx)

我之所以提到这一点，是因为它暴露了实施 linq 提供程序以解决复杂问题的许多挑战

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-23T00:06:44.387

我很惊讶乔恩没有提到他自己的……

[http://msmvps.com/blogs/jon_skeet/archive/2007/10/03/linq-to-silliness-generating-a-mandelbrot-with-parallel-potential.aspx](http://msmvps.com/blogs/jon_skeet/archive/2007/10/03/linq-to-silliness-generating-a-mandelbrot-with-parallel-potential.aspx)

同时愚蠢和聪明;-)

编辑：

哦，我也忘记了[这个](http://blogs.msdn.com/lukeh/archive/2007/10/01/taking-linq-to-objects-to-extremes-a-fully-linqified-raytracer.aspx)。使用 Linq 进行光线追踪。

# sql - 如何在存储过程中执行 SELECT TOP @Param？

> ID：779149
> 
> 赞同：47
> 
> 时间：2009-04-22T20:45:31.547
> 
> 标签：sql, stored-procedures

我正在尝试在 proc 中执行以下操作，但出现不正确的语法错误：

```
SELECT TOP @NumberOfResultsToReturn * 
```

我在这里做错了什么？谢谢。

* * *

## 回答 #1

> 赞同：115
> 
> 时间：2009-04-22T20:48:38.640

添加括号：

```
SELECT TOP (@NumberOfResultsToReturn) * 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-22T20:49:06.767

SQL Server：将参数放在括号中：

```
SELECT TOP (@NumberOfResultsToReturn) * 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-22T21:02:10.773

以下是我过去的做法：

```
SET @@ROWCOUNT = @NumberOfResultsToReturn
SELECT ........
SET @@ROWCOUNT = 0 
```

这将起作用，但`SELECT TOP (@NumberOfResultsToReturn)`如果您使用支持此语法的 SQL 服务器则更可取：

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-22T20:48:24.240

这在 SQL Server 2005 及更高版本中受支持，但在 SQL Server 2000 中不受支持。您使用的是什么版本？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-22T20:49:29.853

您可能必须改用 RowNumber() 方法。

这是一个例子：

```
DECLARE @PageNum AS INT;
DECLARE @PageSize AS INT;
SET @PageNum = 2;
SET @PageSize = 10;

WITH OrdersRN AS
(
    SELECT ROW_NUMBER() OVER(ORDER BY OrderDate, OrderID) AS RowNum
          ,OrderID
          ,OrderDate
          ,CustomerID
          ,EmployeeID
      FROM dbo.Orders
)

SELECT * 
  FROM OrdersRN
 WHERE RowNum BETWEEN (@PageNum - 1) * @PageSize + 1 
                  AND @PageNum * @PageSize
 ORDER BY OrderDate
         ,OrderID; 
```

**编辑**或者你可以使用括号......我当时不知道 :) 谢谢大家。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-22T20:50:50.397

恐怕你不能在 SQL 2000 中做到这一点，但你可以尝试构造查询

```
DECLARE @query VARCHAR(500)
set @query = 'SELECT TOP ' + @NumberOfResultsToReturn + '* FROM table'
EXEC @query 
```

我不知道 SQL 2005 的括号技巧，也谢谢大家，！！！

# sql-server - 为什么我不能收缩事务日志文件，即使在备份之后？

> ID：779153
> 
> 赞同：28
> 
> 时间：2009-04-22T20:46:00.500
> 
> 标签：sql-server, sql-server-2005

我有一个包含 28gig 事务日志文件的数据库。恢复模式很简单。我只是对数据库进行了完整备份，然后运行了两者：

`backup log dbmcms with truncate_only`

`DBCC SHRINKFILE ('Wxlog0', TRUNCATEONLY)`

db 的名称是 db_mcms，事务日志文件的名称是 Wxlog0。

两者都没有帮助。我不确定下一步该怎么做。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-04-23T17:08:03.767

谢谢大家的回答。

我们终于找到了问题所在。在 sys.databases 中，log_reuse_wait_desc 等于“复制”。显然，这意味着 SQL Server 在重用日志空间之前等待复制任务完成。

~~从未在此数据库上使用过~~复制，或者曾经在此数据库上玩过此服务器。我们通过运行 sp_removedbreplication 清除了不正确的状态。在我们运行这个之后，备份日志和 dbcc 收缩文件工作得很好。

绝对是一袋花招。

资料来源：

[http://social.technet.microsoft.com/Forums/pt-BR/sqlreplication/thread/34ab68ad-706d-43c4-8def-38c09e3bfc3b](http://social.technet.microsoft.com/Forums/pt-BR/sqlreplication/thread/34ab68ad-706d-43c4-8def-38c09e3bfc3b)

[http://www.eggheadcafe.com/conversation.aspx?messageid=34020486&threadid=33890705](http://www.eggheadcafe.com/conversation.aspx?messageid=34020486&threadid=33890705)

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-04-23T00:04:07.407

如果您的数据库设置为自动增长日志并且您最终会获得大量虚拟日志文件，您可能会遇到此问题。
运行`DBCC LOGINFO('databasename')`并查看最后一个条目，如果这是 2，那么您的日志文件将不会缩小。与数据文件不同，虚拟日志文件不能在日志文件内移动。

您将需要多次运行 BACKUP LOG 和 DBCC SHRINKFILE 以使日志文件收缩。

对于额外的奖励积分，在日志和推卸之间运行 DBBC LOGINFO

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-07-06T04:03:05.717

'sp_removedbreplication' 并没有为我解决问题，因为 SQL 刚刚返回说数据库不是复制的一部分......

我在这里找到了答案：

*   [http://www.sql-server-performance.com/forum/threads/log-file-fails-to-truncate.25410/](http://www.sql-server-performance.com/forum/threads/log-file-fails-to-truncate.25410/)
*   [http://blogs.msdn.com/b/sqlserverfaq/archive/2009/06/01/size-of-the-transaction-log-increasing-and-cannot-be-truncated-or-shrinked-due-to-快照复制.aspx](http://blogs.msdn.com/b/sqlserverfaq/archive/2009/06/01/size-of-the-transaction-log-increasing-and-cannot-be-truncated-or-shrinked-due-to-snapshot-replication.aspx)

基本上我必须创建一个复制，将所有复制指针重置为零；然后删除我刚刚进行的复制。IE

```
Execute SP_ReplicationDbOption {DBName},Publish,true,1
GO
Execute sp_repldone @xactid = NULL, @xact_segno = NULL, @numtrans = 0, @time = 0, @reset = 1
GO
DBCC ShrinkFile({LogFileName},0)
GO
Execute SP_ReplicationDbOption {DBName},Publish,false,1
GO 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-22T21:00:48.627

你不需要这个吗

```
DBCC SHRINKFILE ('Wxlog0', 0) 
```

请确保您意识到危险：请参阅此处：[不要截断您的 ldf 文件！](http://blogs.lessthandot.com/index.php/DataMgmt/DBAdmin/MSSQLServerAdmin/do-not-truncate-your-ldf-files)

在这里 [使用 Truncate_Only 备份日志：就像一个熊陷阱](http://sqlserverpedia.com/blog/sql-server-backup-and-restore/backup-log-with-truncate_only-like-a-bear-trap/)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-01-22T07:39:37.607

此答案已从[此处](http://social.msdn.microsoft.com/Forums/en-US/sqlreplication/thread/34ab68ad-706d-43c4-8def-38c09e3bfc3b/)取消并在此处发布，以防其他线程被删除：

> 您在日志中有非分布式 LSN 的事实是问题所在。我以前见过这种情况，不确定为什么我们不取消将事务标记为已复制。我们将在内部对此进行调查。您可以执行以下命令将事务取消标记为已复制

```
EXEC sp_repldone @xactid = NULL, @xact_segno = NULL, @numtrans = 0, @time = 0, @reset = 1 
```

> 此时您应该能够截断日志。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-06-02T01:50:46.837

我过去也遇到过同样的问题。通常，shrink 和 trn 备份需要多次发生。在极端情况下，我将数据库设置为“简单”恢复，然后对日志文件运行收缩操作。这总是对我有用。但是最近我遇到了一种情况，那就行不通了。该问题是由未完成的长时间运行的查询引起的，因此在我可以终止该进程然后运行我的收缩操作之前，任何收缩尝试都是无用的。我们正在讨论一个增长到 60 GB 并且现在缩小到 500 MB 的日志文件。

请记住，一旦您从 FULL 更改为 Simple 恢复模式并进行收缩，不要忘记将其设置回 FULL。然后，您必须立即进行 FULL DB 备份。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-22T21:43:29.850

如果您在 2005 年在数据库上设置了恢复模式（不知道 2005 年之前的情况），它将一起删除日志文件，然后您可以将其放回完全恢复模式以重新启动/重新创建日志文件。我们在使用 SQL 2005 express 时遇到了这个问题，因为在我们更改恢复模式之前，我们无法接近 4GB 的数据限制。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-02-20T20:37:28.317

我知道这已经有几年了，但想补充一些信息。

我在非常大的日志中发现，特别是当数据库未设置为备份事务日志（日志非常大）时，日志的第一次备份不会将 log_reuse_wait_desc 设置为空，而是将状态保留为仍在备份。这将阻止收缩。第二次运行备份正确地将 log_reuse_wait_desc 重置为 NOTHING，从而允许收缩处理。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-22T20:51:18.507

您是否尝试过在 SQL Server 管理工作室中使用 GUI。右键单击数据库，任务，收缩，文件。选择文件类型=日志。

一周前我为我工作。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-22T21:11:51.047

尝试在 DBCC 中使用您需要的 TRUNCATEONLY 目标大小：

DBCC SHRINKFILE ('Wxlog0', 1)

并检查这篇文章：

[http://msdn.microsoft.com/en-us/library/ms189493(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms189493(SQL.90).aspx)

[http://support.microsoft.com/kb/907511](http://support.microsoft.com/kb/907511)

编辑：

您可以尝试首先将分配的页面移动到日志文件的开头

DBCC SHRINKFILE ('Wxlog0', NOTRUNCATE)

在那之后

DBCC SHRINKFILE ('Wxlog0', 1)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-22T21:18:25.400

在使用 truncate_only 备份日志后尝试创建另一个完整备份（IIRC 无论如何你都应该这样做以维护日志链）。在简单恢复模式下，您的日志无论如何都不应该增长太多，因为它在每次事务之后都会被有效地截断。然后尝试指定您希望日志文件的大小，例如

```
-- shrink log file to c. 1 GB
DBCC SHRINKFILE (Wxlog0, 1000); 
```

TRUNCATEONLY 选项不会重新排列日志文件中的页面，因此您可能在文件的“末尾”有一个活动页面，这可能会阻止它被缩小。

您还可以使用 DBCC SQLPERF(LOGSPACE) 来确保日志文件中确实有空间要释放。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-22T21:29:01.630

将数据库恢复为完整模式，运行事务日志备份（不仅仅是完整备份），然后进行收缩。

缩小后，您可以将数据库恢复为简单模式，并且 txn 日志将保持相同大小。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2018-05-18T16:08:04.750

我有同样的问题。我运行了索引碎片整理过程，但事务日志已满，碎片整理过程出错。事务日志仍然很大。

我备份了事务日志，然后继续缩小事务日志 .ldf 文件。但是，事务日志根本没有缩小。

然后我发出了一个“CHECKPOINT”，然后是“DBCC DROPCLEANBUFFER”，之后能够缩小事务日志.ldf文件

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2009-04-22T21:34:12.930

您不能将事务日志缩小到小于其最初创建的大小。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2014-03-06T01:32:10.513

我尝试了所有列出的解决方案，但都没有奏效。我最终不得不做一个 sp_detach_db，然后删除 ldf 文件并重新连接数据库，强制它创建一个新的 ldf 文件。那行得通。

# java - 消除 Jasper 生成的 Java 源文件中 JSP 的 Javac 警告？

> ID：779161
> 
> 赞同：2
> 
> 时间：2009-04-22T20:48:35.317
> 
> 标签：java, jsp, tomcat, compiler-warnings

当使用 Jasper 编译器（使用 Tomcat）和 Java 编译器预编译 JSP 时，我看到`javac`这样的警告（我启用了`javac`'s`-Xlint`标志）：

```
warning: [unchecked] unchecked call to add(E) as a member of the raw type java.util.List
_jspx_dependants.add("/some-jsp.jspf"); 
```

现在，它“只是一个警告”，但我喜欢干净的构建，所以我自然想摆脱警告。当然，我可以`-Xlint`关闭 JSP 编译，但这`-Xlint`是好东西，所以它会保留。

在此示例警告中，问题在于未使用通用语法。取而代之的是`List<String>`，我们只有`List`。我意识到编写 Jasper 的好人必须迎合那些仍然被困在 Java5 之前的世界中的不幸灵魂。这很好，但我为什么要遭受这些警告呢？

**是否有一些众所周知的方法可以消除由 Jasper JSP 编译器创建的 Java 源代码引起的 javac 警告？**我对特定于 IDE 的解决方案不感兴趣（尽管对于某些使用特定 IDE 的人来说，这将是部分解决方案）。我正在寻找一个普遍适用的解决方案。

对 Jasper 源代码的扫描没有发现任何会导致泛型语法发射的“Java 5+”开关。事实上，恰恰相反，我发现了这一点：

```
apache-tomcat-6.0.18-src/java/org/apache/jasper/compiler/Generator.java:494:            out.printin("_jspx_dependants = new java.util.ArrayList("); 
```

这清楚地表明硬编码的代码没有任何注入优雅的通用语法的希望。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T21:09:53.563

禁用您知道的警告并且不关心：

> -Xlint:
> -xxx 禁用警告 xxx，其中 xxx 是以下 -Xlint:xxx 支持的警告名称之一。

见[这里](http://java.sun.com/j2se/1.5.0/docs/tooldocs/windows/javac.html)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T21:10:10.880

我正在使用基于 Ant 的构建。我目前对这个问题的解决方案是使用以下 Ant 过滤代码就地编辑有问题的 Jasper 生成的 Java 代码：

```
<move todir="WEB-INF/src">
    <fileset dir="WEB-INF/src"/>
    <globmapper from="*.java"
                to="*.java.foo"/>
    <filterchain>
        <tokenfilter>
            <replacestring from="private static java.util.List _jspx_dependants;"
                           to="private static java.util.List&lt;String&gt; _jspx_dependants;"/>
            <replacestring from="_jspx_dependants = new java.util.ArrayList"
                           to="_jspx_dependants = new java.util.ArrayList&lt;String&gt;"/>
            <replaceregex pattern="public final class (.*) extends org.apache.jasper.runtime.HttpJspBase"
                          replace="@SuppressWarnings(&quot;serial&quot;)&#xA;public final class \1 extends org.apache.jasper.runtime.HttpJspBase"/>
            <replacestring from="(PageContext)_jspx_page_context"
                           to="_jspx_page_context"/>
        </tokenfilter>
    </filterchain>
</move>
<move todir="WEB-INF/src" overwrite="true">
    <fileset dir="WEB-INF/src"/>
    <globmapper from="*.java.foo" to="*.java"/>
</move> 
```

请看[这个问题](https://stackoverflow.com/questions/779064/filtering-files-in-place-with-ant)来理解“双招”。

# gridview - 如何在 ASP.Net GridView 中格式化自动生成的列？

> ID：779181
> 
> 赞同：1
> 
> 时间：2009-04-22T20:51:19.880
> 
> 标签：gridview, formatting

直到现在，我总是明确地格式化我的 GridView 中的每一列。

但是现在，我的数据源的列数可能会有所不同，所以我 autogenerate="true"

这让我没有地方定义格式，所以当我想要两位小数的会计格式时，所有非字符串字段都有四位小数。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T21:04:32.190

您可以使用[GridView.RowDatabound](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.rowdatabound.aspx)事件来访问每一行中的值。这是[一篇](http://www.codeproject.com/KB/webforms/FrmtAutoGenClmnASPNETGrid.aspx)涵盖它的文章。或者，您可以访问[GridView.Databound](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.basedataboundcontrol.databound.aspx)事件并自己迭代行。

# c - 用 C 学习 GLADE 的最佳/最快方法是什么？

> ID：779182
> 
> 赞同：6
> 
> 时间：2009-04-22T20:51:27.273
> 
> 标签：c, gtk, glade

我刚刚下载并安装了 GLADE。C语言有哪些好的教程？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-22T21:02:45.610

本教程详细介绍了 C 和 Python 中的示例：[使用 Glade 设计用户界面](http://www.micahcarrick.com/12-24-2007/gtk-glade-tutorial-part-1.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-22T20:59:29.953

《今日 Linux》有[一对 Glade 教程](http://www.linuxtoday.com/news_story.php3?ltsn=2001-12-10-011-20-PS-GN-HL)

但是，大多数教程使用 C++ 或 C#。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-05-30T09:22:58.517

我在这里找到了一个非常好的 glade 教程索引： [https ://live.gnome.org/Glade/Tutorials](https://live.gnome.org/Glade/Tutorials)

# c++ - 与 DrawText 函数冲突

> ID：779185
> 
> 赞同：3
> 
> 时间：2009-04-22T20:52:10.940
> 
> 标签：c++, winapi

我正在开发一个多平台应用程序，在一个组件中我有一个名为 DrawText 的类方法。不幸的是，我收到一个链接器错误（仅在 Windows 上），指出此类的 DrawTextW 方法存在未解析的外部符号。

我之前已经看到过其他以“Text”结尾的方法，它正在寻找 FooTextW 或 FooTextA 方法，而不是我定义的 FooText 方法。我的假设是，在 Windows 标头的某处，有一个宏定义根据其他定义将 FooText 分配给 FooTextW 或 FooTextA 。

除了重命名我的函数（这是我过去所做的）之外，有没有人有解决这个问题的好主意？

谢谢。

乔

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-22T20:53:46.583

你真的只有两个选择：

```
#ifdef DrawText
#undef DrawText
#endif 
```

或重命名您的函数。Win32 使用没有命名空间或范围的宏，所以你有点卡住了。

我们只是重新命名我们的函数。

顺便说一句：它通常基于#ifdef UNICODE（或_UNICODE 或其他一些变体）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T21:23:56.137

是的，这是使用 Windows 的一个真正问题，并且没有办法将其关闭，因为标题看起来都是这样的：

```
#ifdef UNICODE
#define GetDlgItemText GetDlgItemTextW
#else
#define GetDlgItemText GetDlgItemTextA
#endif 
```

因此，无论哪种方式，您都将获得定义的符号。如果您可以在#include'ing windows.h 之前#define 一些东西来关闭此行为，那将是非常好的，但可惜不存在。

# join - 如何在两个或多个嵌套循环中迭代连接数据？

> ID：779186
> 
> 赞同：1
> 
> 时间：2009-04-22T20:52:27.867
> 
> 标签：join, loops, nested-loops

前段时间我问[了一个关于 SO 上的嵌套循环的问题](https://stackoverflow.com/questions/356778/php-query-single-value-per-iteration-or-fetch-all-at-start-and-retrieve-from-ar)，事实上，在我的示例的循环中存在查询，我得到了明确的答案：

> **永远不要将 SQL 查询放入循环中**

从那以后我一直在尝试，而且大部分都有效。只需要努力并编写一个查询即可一次检索您需要的所有内容。

但是，当您有一个来自 JOIN 查询的数据集，其中包含您需要以嵌套方式输出的嵌套数据时，您会怎么做？

来自表 A 和 B 的连接示例：

```
A.a     |  B.a     |  B.b
--------|----------|-------------
fruits  |  banana  |  yellow
fruits  |  apple   |  red
animals |  zebra   |  black&white
animals |  elefant |  gray
animals |  fox     |  red
planets |  earth   |  blue
planets |  mars    |  red 
```

好的，现在我将所有内容放在数组或行集中，现在我需要显示类似的内容：

**水果**

*   黄色香蕉
*   红苹果

**动物**

*   黑白斑马
*   灰象
*   红狐

**行星**

*   蓝色地球
*   红色火星

似乎很明显它应该可以工作，但是我现在已经尝试过好几次了，但我就是想不出一个解决方案。

目前我这样做是我的老方法：

```
查询组

foreach 组
{
    查询组中的动物
    动物
}
```

但是，嘿，永远不要将 sql 放入循环中。那我该怎么办？我做PHP，但我认为这是一个元问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-22T21:07:29.373

使用控制中断算法。

我会完全按照您在问题中显示的那样返回结果集：

```
A.a     |  B.a     |  B.b
--------|----------|-------------
fruits  |  banana  |  yellow
fruits  |  apple   |  red
animals |  zebra   |  black&white
animals |  elefant |  gray
animals |  fox     |  red
planets |  earth   |  blue
planets |  mars    |  red 
```

遍历所有行：

*   当 Aa 改变时，输出标题
*   然后总是输出 Bb + Ba 值

应用程序调用 SQL 的伪代码：

```
set last_A = null
exec query

loop over result set {
    if last_A == null or fetch_A!=last_A {
        last_A=fetch_A
        display fetch_a
    }
    display fetch_Bb + fetch_Ba
    }
}//loop 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T20:57:49.177

如果您拥有的是层次结构，则为“有向无环图”。SQL 不做这些。

SQL 没有做其他图论的事情。

由于 SQL 不这样做，因此“从不将 SQL 置于循环中”的规则不再适用。

您必须将 SQL 放入循环中，以解决涉及格和网络的层次结构和其他图形连接问题。

实际上，对于层次结构，您必须使用递归循环将层次结构的所有元素连接到任意深度。

另一方面，如果您只是将查询结果重新格式化为嵌套层次结构，那么您只是将单个 SQL 结果集重新格式化为嵌套列表。

这将是一个围绕结果集具有复杂循环的选择。一个选择（不在循环中）和一个复杂的循环来处理一个结果集。

# apache - 制定重写规则的正确方法？

> ID：779189
> 
> 赞同：0
> 
> 时间：2009-04-22T20:53:45.583
> 
> 标签：apache, .htaccess, mod-rewrite

我的站点 www 文件夹中有一个 .htaccess ，它具有此重写规则：

```
 RewriteRule ^(\w+)/?$ /$1.php 
```

它有效，如果你输入

```
 http://sampardee.com/urltest - 
```

它找到**urltest.php**并将其打开。

但是，如果您输入

```
 http://sampardee.com/urltest/ 
```

它仍然会**启动 urltest.php**，但 CSS 停止工作。我在链接标签中指定了 CSS 文件。同样的结果也出现在

```
 http://sampardee.com/urltest.php/ 
```

被访问。

有什么办法可以解决这个问题，以便有人可以输入

```
 http://sampardee.com/urltest/ 
```

并有**urltest.php**出现，但仍显示链接的 CSS 文件？

请帮助:) -山姆

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T21:01:29.763

问题不在于 mod_rewrite，而在于 css 链接（浏览器尝试获取[http://[...]/urltest/css/default.css](http://[...]/urltest/css/default.css)而不是 /css/default.css）。

尝试添加一个开始斜杠，并将其更改为：

> /css/default.css

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T21:03:51.440

一个更好的主意可能是将[http://sampardee.com/urltest/](http://sampardee.com/urltest/)重定向到[http://sampardee.com/urltest](http://sampardee.com/urltest)。

```
RewriteRule ^(\w+)/$ /$1 [R] 
RewriteRule ^(\w+)$ /$1.php 
```

# c# - Linq to Entities (EF)：如何在不进行连接的情况下获取 FK 的值

> ID：779193
> 
> 赞同：3
> 
> 时间：2009-04-22T20:55:39.433
> 
> 标签：c#, asp.net, entity-framework

我正在使用 Linq to Entities。我有我的主表，Employee setup 有一个名为 vendorID 的字段。供应商 ID 是供应商表的外键。

就像现在一样，Employee 对象不直接公开 vendorID。相反，我只能通过这种方式访问​​它：

```
var employee = (from e in context.Employees.Include("tbl_vendors")
               where e.employeeID = 1
               select e).FirstOrDefault();

//this gets the vendor ID
int vendorID = employee.tbl_vendors.vendorID; 
```

这很好，很花哨，但它是数据库上的额外工作，因为它强制在不需要的地方进行连接。有没有办法在不强制加入 tbl_vendors 表的情况下获得该键值？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-01T23:00:16.097

其实这很简单，你基本上是这样做的：

```
var tblVendorID = (from e in context.Employees
                  select e.tbl_vendors.ID).FirstOrDefault(); 
```

即使这看起来像您正在执行连接，L2E 也会优化连接。

您可以使用以下代码确认：

```
var results = from e in ctx.Employees
              select e.tbl_vendors.ID;

var query = results as ObjectQuery<int>;
string sql = query.ToTraceString(); 
```

希望这有助于亚历克斯（微软）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-22T21:08:41.600

您可以通过实体引用访问外键。

```
Employee employee = context.Employees.Single(e => e.employeeID == 1);

Int32 vendorID = (Int32)employee.tbl_vendorsReference.EntityKey.
   EntityKeyValues[0].Value; 
```

有关[EntityReference](http://msdn.microsoft.com/de-de/library/bb154700(loband).aspx)和[EntityKey](http://msdn.microsoft.com/de-de/library/system.data.entitykey.aspx)类的参考，请参阅 MSDN。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T21:07:59.823

不确定您的对象名称，但您可以从实体键属性中获取键，而无需访问数据库，如下所示：

```
var employee = (from e in context.Employees
               where e.employeeID = 1
               select e).FirstOrDefault();

//this gets the vendor ID
int vendorID = (int)employee.tbl_vendorsReference.EntityKey.EntityKeyValues[0].Value; 
```

# java - 如何更改 JRun 会话超时？

> ID：779196
> 
> 赞同：-1
> 
> 时间：2009-04-22T20:56:32.223
> 
> 标签：java, jrun

如果您尝试启动 JRun 服务器并且初始化时间超过 30 秒，则启动会失败。有没有办法增加这个 30 秒的限制？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-22T21:04:19.880

假设您在 Windows 下运行 JRun，您可以调整 Windows 服务管理器将等待的时间。请参阅[如何调试 Windows 服务](http://support.microsoft.com/kb/824344)并在该页面中搜索“30 秒”。紧接着，您将看到一个可以编辑的注册表项。

基本上，您将添加创建一个新的 DWORD 键：

```
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\ServicesPipeTimeout 
```

该键的值将是服务应该启动的毫秒数。这是一个全局设置，不仅适用于 JRun 服务。

# java - 如何在全局范围内设置 RenderingHints？

> ID：779198
> 
> 赞同：6
> 
> 时间：2009-04-22T20:57:19.820
> 
> 标签：java, graphics, rendering

对于 Java 应用程序，我可以在全局基础上设置 RenderingHints 吗？目前，我已经在 paintComponent 方法中定义了这些，如下所示。但是，我更愿意在应用程序启动时设置它们一次，并让它们在整个会话期间持续存在。

```
@Override
protected void paintComponent(Graphics g)
{
super.paintComponent(g);

Graphics2D g2d = (Graphics2D) g;
    g2d.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);
    g2d.setRenderingHint(RenderingHints.KEY_TEXT_ANTIALIASING, RenderingHints.VALUE_TEXT_ANTIALIAS_ON);
} 
```

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T21:17:13.937

有一个[系统属性](http://java.sun.com/javase/6/docs/technotes/guides/2d/flags.html#aaFonts)y 。

# spring - 兵马俑 - 无法转换为 com.tc.object.bytecode.TransparentAccess

> ID：779208
> 
> 赞同：0
> 
> 时间：2009-04-22T21:00:18.877
> 
> 标签：spring, configuration, terracotta

我有一个相当大的 spring 应用程序，我想要分享的只是一个 Map（使用 util.ConcurrentMap 作为实现）。

为此，我在 appContext 中创建了一个 bean，并尝试使用以下 tc-config 行：

*/applicationContext.xml

我必须做其他事情才能使其正常工作吗？MyClass 是一个相当简单的域对象，它只包含原语、两个构造函数和访问器/修改器。

我必须做其他事情才能使它正常工作吗？我正在使用兵马俑 3.0.0。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-26T20:43:57.357

您需要创建一个 tc-config.xml 配置文件，如[http://www.terracotta.org/web/display/orgsite/Spring+Integration](http://www.terracotta.org/web/display/orgsite/Spring+Integration)中所述。

# c# - 使用 .NET 以编程方式管理 Microsoft Access 附件类型字段

> ID：779211
> 
> 赞同：8
> 
> 时间：2009-04-22T21:01:04.473
> 
> 标签：c#, .net, ms-access, attachment

Access 在 2007 版本中添加了一种新的数据类型——附件类型。我们目前正在开发一个使用 Access 2007 数据库的 .NET 3.5 (C#) 的 WinForms 应用程序。我们希望能够通过 WinForms 界面添加新的附件。我似乎找不到任何有关如何使用 .NET 插入或选择附件数据的信息。我确实尝试过使用 DAO（版本 12），但它似乎没有这里讨论的 SaveToFile 或 LoadFromFile 方法：http: [//msdn.microsoft.com/en-us/library/bb258184.aspx](http://msdn.microsoft.com/en-us/library/bb258184.aspx)

那么，如何使用 .NET 获取附件？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-11-17T18:37:03.083

我终于使用对 Microsoft.Office.Interop.Access.Dao 的引用在 C# 中工作了。

```
DBEngine dbe = new DBEngine();
Database db = dbe.OpenDatabase("C:\\SomeDatabase.accdb", false, false, "");
Recordset rs = db.OpenRecordset("SELECT * FROM TableWithAttachmentField", RecordsetTypeEnum.dbOpenDynaset, 0, LockTypeEnum.dbOptimistic);
rs.MoveFirst();
rs.Edit();
Recordset2 rs2 = (Recordset2)rs.Fields["AttachmentFieldName"].Value;
rs2.AddNew();

Field2 f2 = (Field2)rs2.Fields["FileData"];

f2.LoadFromFile("C:\\test.docx");
rs2._30_Update();
rs2.Close();

rs._30_Update();
rs.Close(); 
```

这会将 test.docx 添加到表“TableWithAttachmentField”中的附件字段“AttachmentFieldName”中。需要注意的一点是，尝试两次添加相同的文件会引发错误。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T23:51:03.363

有趣的问题。我不使用 A2007，但安装了运行时，所以我使用 Access 对象浏览器查看其中的内容。我发现了一些非常奇怪的东西——有两个 FIELD 对象，Field 和 Field2。附件函数是 Field2 的成员，但不是 Field。所以，我的建议是，也许你需要做的是转换这个：

```
Recordset.Fields("FileData").LoadFromFile(<filename>) 
```

像这样：

```
Dim rs As DAO.Recordset
Dim fld2 As DAO.Field2

Set rs = CurrentDb.OpenRecordset("[SQL]")
Set fld2 = Recordset.Fields("FileData")
fld2.LoadFromFile(<filename>)

rs.Close
Set fld2=Nothing 
```

现在，我不知道这是否会为您解决问题，但在我看来，鉴于两个具有不同属性/方法/成员的 Field 对象，您需要明确说明您正在使用哪个 Field 对象。您引用的代码示例专门用于 Access，也许 Access 会自动解决两个对象之间的差异（也许它默认使用 Field 对象用于非 ACCDB 数据库和 Field2 对象用于 ACCDB 文件）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-23T14:11:10.013

我一直在努力尝试做同样的事情。您可以在项目中包含对“Microsoft.Office.Interop.Access.Dao”的引用，该引用将为您提供 Recordset2 和 Field2 接口，但没有实现类。

就我所知，我会再发一次/如果我弄明白了......

我无法在 C# 中使用它，所以我转向了不同的解决方案。我很想知道如何做到这一点，但如果有人弄清楚的话。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-22T12:51:57.947

看看[Access 团队博客](http://blogs.msdn.com/access/archive/2007/08/24/adding-removing-and-saving-files-from-the-new-attachment-field-in-access-2007.aspx)上的这篇文章 ，它基本上包含了 David 的建议，但略有不同。它设置一个 Recordset2 类型的对象等于附件字段的值。然后将一条记录附加到该记录集，然后将文件内容放入该新记录中。

# models - 免费提供的 3D 图形资源

> ID：779212
> 
> 赞同：9
> 
> 时间：2009-04-22T21:01:29.030
> 
> 标签：models, 3d

我主要是一名程序员，在开始新项目时总是有同样的问题：我的身体没有艺术骨。但你不能总是买得起艺术家。

我可以将哪些资源用于图形？我主要在寻找各种文件类型的免费 3D 模型。它们不必很复杂，但应该适用于快速原型制作。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-28T05:32:59.433

[http://sketchup.google.com/3dwarehouse/](http://sketchup.google.com/3dwarehouse/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-28T06:03:10.017

几年前，为了 GameDev.Net “四元素”竞赛，我编制[了一个非常大的列表（链接现在指向 WayBackMachine）](http://web.archive.org/web/20101231144152/http://www.gamedev.net/community/forums/topic.asp?topic_id=324643)。我已经有一段时间没有重新访问它了，所以可能有相当多的死链接，但我相信也有相当多的实时链接和踢球链接。它以一堆技术链接开始，但只需向下滚动即可。有很多模型和纹理链接。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-22T21:46:13.570

www.turbosquid.com

他们有免费和付费内容。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-29T08:35:10.577

这些是我过去在使用 3D 时使用的一些模型资源。

**3D Links**是一个很好的 3d 资源。它有一长串指向提供 3d 对象的网站的链接。

*   [http://www.3dlinks.com/Free_3D_Objects.cfm](http://www.3dlinks.com/Free_3D_Objects.cfm)

我经常用来获取我的室内模型的另一个来源是**e-interiors**。您必须在 Cad Library Availablity 中搜索 3D。它有数百个免费的室内物品，从椅子到水槽。

*   [http://www.e-interiors.net/](http://www.e-interiors.net/)

对于较小的组件和零件，例如旋钮和齿轮，请查看**3D 内容中心**

*   [http://www.3dcontentcentral.com](http://www.3dcontentcentral.com/Browse.aspx)

**Exchange 3D**也有一个免费模型列表

*   [http://www.exchange3d.com/cubecart/free-3d-models/cat_35.html](http://www.exchange3d.com/cubecart/free-3d-models/cat_35.html)

如果您想要 3D 钻石切割进行实验，请尝试**3D Lapidary**

*   [http://www.3dlapidary.com](http://www.3dlapidary.com/HTML/Stones1.htm)

*KatsBits*有几个低分辨率 md5 游戏模型

*   [http://www.katsbits.com/htm/models.htm](http://www.katsbits.com/htm/models.htm)

最后我想提一下**德埃斯波纳**。该系列不是免费的（除了少数型号，可[在此处](http://3dup.com/models/index.vfx?dv=DeEspona)获得）。可下载版本的价格为 395 美元。但是，如果您正在寻找包含各种分辨率模型的完整百科全书，我会推荐这本。

*   [http://www.deespona.com](http://www.deespona.com/3denciclopedia/menu.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-28T05:57:15.443

看一下：

*   [http://www.blendermodels.org/](http://www.blendermodels.org/)
*   [http://www.3dcafe.com/](http://www.3dcafe.com/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-01T18:34:40.667

如果有帮助，[http://www.modwiki.net/wiki/MD5_(file_format)](http://www.modwiki.net/wiki/MD5_(file_format))提供了将许多模型格式（Maya、3DS Max、Blender、Lightwave、Softimage）转换为 .MD5 格式的信息。

然后，您可以利用其他答案中提到的许多优秀资源......

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-06-14T14:17:28.213

[3dtotal.com](http://www.3dtotal.com)是一个非常受欢迎的 3d 图形网站。它提供免费的高质量教程和模型。此外，3dtotal 分发它自己的纹理 CD 集合 - 一些可用的最佳纹理。

# wpf - WPF RoutedEvents 由...处理？

> ID：779217
> 
> 赞同：1
> 
> 时间：2009-04-22T21:02:23.100
> 
> 标签：wpf, 3d, routed-events

我在 WPF 中有一个 3D 应用程序，它基本上应该在触发 MouseWheel 事件时放大和缩小。我已尝试订阅所有可能的内容，但找不到正在处理它的内容。

有没有办法找出是什么？或者有没有办法让事件不被处理，或者让一个包含 UIElement 在处理它之前/之后到达这个事件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T21:12:35.150

如果即使其他人已经处理了该事件，您也想被调用，请尝试使用该`UIElement.AddHandled(RoutedEvent, bool)`函数订阅该事件。`true`即使事件已被处理，作为第二个参数传入以被调用。

您还可以尝试订阅`PreviewMouseWheel`事件以在事件进行[隧道](http://msdn.microsoft.com/en-us/library/ms742806.aspx#routing_strategies)传输时被调用。

# c# - WatiN 生成空页面

> ID：779223
> 
> 赞同：2
> 
> 时间：2009-04-22T21:04:11.457
> 
> 标签：c#, nunit, watin

使用 WatiN 捕获图像时，生成的图像只是空的，纯黑色。但是，图像的大小等于屏幕大小。例如，下面的代码片段只保存了两个黑色图像。

```
using (IE ie = new IE()) {
            ie.ClearCache();
            ie.BringToFront();
            ie.GoTo("http://localhost/");
            ie.CaptureWebPageToFile(imageDir + "\\localhost.png");
            WatiN.Core.CaptureWebPage capture = new CaptureWebPage(ie);
            capture.CaptureWebPageToFile(imageDir + "\\localhost.jpg", true, true, 100, 80);
            Assert.IsTrue(ie.ContainsText("Zend"));
        } 
```

其他人也报告了这一点，但我还没有看到任何解决方案。请参阅此处的评论：http: [//www.codeproject.com/KB/graphics/IECapture.aspx?display= PrintAll&fid=192174&df=90&mpp=25&noise=3&sort=Position&view=Quick&fr=51&select=1810490](http://www.codeproject.com/KB/graphics/IECapture.aspx?display=PrintAll&fid=192174&df=90&mpp=25&noise=3&sort=Position&view=Quick&fr=51&select=1810490)

希望任何人都可以对此有所了解。

干杯//约翰

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-01-04T09:58:43.160

通过以下更改，我设法让它在 IE8 下为我的网页工作：

替换以下方法：

```
private static IntPtr GetHwndForInternetExplorerServer(IntPtr hwnd)
{
    var sbc = new StringBuilder(256);
    hwnd = NativeMethods.GetWindow(hwnd, NativeMethods.GW_CHILD);
    while (hwnd != IntPtr.Zero)
    {
        NativeMethods.GetClassName(hwnd, sbc, 256);
        if (sbc.ToString().IndexOf("Shell DocObject View", 0) > -1) //IE6
        {
            hwnd = NativeMethods.FindWindowEx(hwnd, IntPtr.Zero, "Internet Explorer_Server", IntPtr.Zero);
            break;
        }
        if (sbc.ToString().IndexOf("TabWindowClass", 0) > -1) //IE7
        {
            hwnd = NativeMethods.FindWindowEx(hwnd, IntPtr.Zero, "Shell DocObject View", IntPtr.Zero);
            hwnd = NativeMethods.FindWindowEx(hwnd, IntPtr.Zero, "Internet Explorer_Server", IntPtr.Zero);
            break;
        }
        if (sbc.ToString().IndexOf("Frame Tab", 0) > -1) // IE8
        {
            hwnd = NativeMethods.FindWindowEx(hwnd, IntPtr.Zero, "TabWindowClass", IntPtr.Zero);
            hwnd = NativeMethods.FindWindowEx(hwnd, IntPtr.Zero, "Shell DocObject View", IntPtr.Zero);
            hwnd = NativeMethods.FindWindowEx(hwnd, IntPtr.Zero, "Internet Explorer_Server", IntPtr.Zero);
            break;
        }
        hwnd = NativeMethods.GetWindow(hwnd, NativeMethods.GW_HWNDNEXT);
    }
    return hwnd;
} 
```

删除方法 GetHwndContainingAShellDocObjectView 和对它的调用。

# ssl-certificate - “参数不正确。” 使用 netsh http 添加 sslcert 时出错

> ID：779228
> 
> 赞同：66
> 
> 时间：2009-04-22T21:05:24.463
> 
> 标签：ssl-certificate, netsh

按照此链接中有关“如何：使用 SSL 证书配置端口”的说明：http: [//msdn.microsoft.com/en-us/library/ms733791.aspx](http://msdn.microsoft.com/en-us/library/ms733791.aspx)，我在命令行上输入了此命令（duh） ：

```
> netsh http add sslcert ipport:10.141.146.227:7001 certhash=5d48e604007b867ae8a69260a4ad318d2c05d8ff appid={EDE3C891-306C-40fe-BAD4-895B236A1CC8}
The parameter is incorrect. 
```

我的`certhash`指纹取自证书（本地计算机）>个人>证书文件夹中的证书。

`appid`GUID 已生成。

我还需要解决什么问题才能使其正常工作？

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2011-01-10T06:51:14.183

在 PowerShell 中只需键入如下。首先进入 netsh http 模式，然后添加 sslcert。它对我有用。

```
>netsh

netsh>http

netsh http>add sslcert ipport=0.0.0.0:13286 appid='{a5455c78-6489-4e13-b395-47fbdee0e7e6}' certhash=<thumprint without space> 
```

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2013-10-07T21:53:40.393

此问题的另一个可能原因是从证书管理器页面复制隐藏字符。如果您从证书中的详细信息窗口复制指纹，请在开始时检查隐藏字符（使用箭头键！）。这就是“参数不正确”错误消息的原因。

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2014-03-08T17:22:45.290

ps1 文件中的 PowerShell 命令行和 PowerShell 脚本会认为 curley-braces {...} 是 PowerShell 指令。所以引用他们。否则，如您所见，PowerShell 会感到困惑。

所以而不是这个（你发现失败）：

```
netsh http add sslcert ipport:10.141.146.227:7001 certhash=5d48e604007b867ae8a69260a4ad318d2c05d8ff appid= {EDE3C891-306C-40fe-BAD4-895B236A1CC8} 
```

这样做（注意单引号）：

```
netsh http add sslcert ipport:10.141.146.227:7001 certhash=5d48e604007b867ae8a69260a4ad318d2c05d8ff appid= '{EDE3C891-306C-40fe-BAD4-895B236A1CC8}' 
```

以下是有关带花括号的 PowerShell 语法的一些信息：

[http://danv74.wordpress.com/2012/07/12/powershell-and-the-hidden-art-of-curly-braces-and-other-braces/](http://danv74.wordpress.com/2012/07/12/powershell-and-the-hidden-art-of-curly-braces-and-other-braces/)

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-05-05T21:12:58.647

查看 netsh 命令的语法，我看到了这个例子：

```
add sslcert ipport=1.1.1.1:443 certhash=0102030405060708090A0B0C0D0E0F1011121314 appid={00112233-4455-6677-8899-AABBCCDDEEFF} 
```

从表面上看，你的问题是你正在做

```
ipport:10.141.146.227:7001
      ^ 
```

与

```
ipport=10.141.146.227:7001
      ^ 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2016-09-16T07:59:55.443

从 Certificate\Details\Thumbprint 复制证书指纹会在指纹值前面加上字节“3f38”，当转换为 ANSI 时，会显示为“?”。这个隐藏的价值给我带来了问题。

我将值粘贴到记事本++中，选择“编码”>“转换为 ANSI”，然后我手动删除了前面的“？” 人物。然后，我将使用一个*干净*的指纹值。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2015-10-04T05:14:31.767

1.  将命令复制到记事本中
2.  保存为 ANSI
3.  关闭并重新打开文件
4.  去除假货？人物
5.  从记事本复制到命令提示符并运行命令

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2017-07-13T17:17:45.863

我多次遇到这个问题，每次都有不同的原因，所以我决定写下对我有用的原因和确切的命令。

**以下是一些原因：**

1- 从 Windows 对话框复制和粘贴证书指纹会在您的哈希中添加一个隐藏字符。它在文本编辑器中不可见，但您需要删除该字符才能使其工作。

2- SSL 指纹应该在 Personal -> Certificates 中可用，以便与 localhost 一起使用。

3-应该是 'ipport=' 而不是 'ipport:'

4- SSL 证书应该有一个私钥。如果您使用的是证书管理控制台，请确保它在证书视图上有一个小钥匙图标。

5- GUID 应以完整格式定义：{a10b0420-a21f-45de-a1f8-818b5001145a}，并且在 powershell 中应有一个引号：'{a10b0420-a21f-45de-a1f8-818b5001145a}' 因此，PowerShell 格式不同从命令行。

6- SSL 证书应该有完整的字符，所有填充 '0' 并且没有任何空格。您可以复制指纹（小心删除特殊隐藏字符）并删除空格，或者如果证书已注册到另一个地址，则使用“netsh http show sslcert”获取值。

**什么对我有用：**

这是在 powershell 中对我有用的确切命令：

```
netsh http add sslcert ipport=0.0.0.0:20001 certhash=5304c034548b27c72b5e9c14f0c7bdd13e52d760 appid='{a10b0420-a21f-45de-a1f8-818b5001145a}' 
```

这是命令行语句：

```
netsh
http add sslcert ipport=0.0.0.0:20001 certhash=5304c034548b27c72b5e9c14f0c7bdd13e52d760 appid={a10b0420-a21f-45de-a1f8-818b5001145a} 
```

**更多命令可帮助您避免相关问题：**

使用以下命令查看当前注册的证书。您可以从那里找到并重用 certhash 或您的 appid：

```
netsh http show sslcert 
```

如果证书已经注册了类似的 ip 和 port，则需要将其删除。我发现它会导致 localhost、127.0.0.1 和 0.0.0.0 出现问题。您只需要在测试环境中注册 0.0.0.0。使用以下命令删除可能损坏的证书：

```
netsh http delete sslcert ipport=0.0.0.0:20001 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-07-16T15:51:00.727

当我刚开始使用 http.sys 时，我也遇到了这个错误。我跑了之后：

```
netsh http add iplisten ipaddress=0.0.0.0 
```

然后`netsh http add sslcert`命令开始正常运行。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2013-11-21T16:36:57.710

就我而言，问题是我按照微软的指令从 SSL 窗口复制了指纹。问题是这样做会在哈希的开头复制不可打印的字符。

尝试将指纹粘贴到记事本中，然后按主页并按删除两次（直到指纹中的第一个字符被删除）并重新添加字符。如果您复制指纹并将其粘贴到 cmd 中，您可以看到字符：

![指纹与](https://i.stack.imgur.com/Ahr7H.png)

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2011-04-24T18:54:29.073

我在寻找问题的解决方案时遇到了这个问题。我终于找到了一个适合我的。

我的`certhash`参数不完全是 20 个字节长。我必须在前面用零填充它才能让它工作。

所以，而不是

`certhash=112233445566778899aabbccddeeff00`，我必须这样做：

`certhash=00000000112233445566778899aabbccddeeff00`.

希望这可以帮助。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2015-05-12T21:26:25.413

certhash 参数使用序列号而不是指纹会因为字符数量的不同而导致此错误。用 0 填充会将错误更改为 SSL Certificate add failed, Error: 1312

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2014-11-05T21:05:54.560

先生，你有 ipport: 而不是 ipport= 这很容易做到，因为你遵循 ip:port

另外，请注意 { 与 < 或 (，这也让我过去。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2016-06-03T13:14:32.510

请注意，如果您将 DNS 名称用作绑定，请使用*hostnameport*而不是*ipport*

```
netsh http delete sslcert hostnameport=domainame.com:443 
```

我不得不删除 Office 365 单点登录的 ADFS 代理绑定。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-05-05T20:31:33.143

我做了一些事情，我认为在得到相同的“参数不正确”后它可以工作。错误。

1）重新启动机器并再次执行。它第一次起作用。2）确保我在c：\并在重新启动后再次输入命令不起作用

我无法解释原因，但我认为可能两次，还有其他问题。因为这是第三次发生在我身上，

3）我检查了我的 CA（不是颁发的服务器证书）的指纹并从 MMC 再次复制它并且它工作。

发生这种情况后，我再次将其删除（netsh http delete sslcert ipport=0.0.0.0:) 并使用服务器证书的指纹重复该过程。这该死的东西又起作用了。

我不知道，只是尝试经历我做过的同样的事情。也许其中之一会起作用。最后，我怀疑我在 certhash 中输入了虚假的空格或字符。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2021-11-17T17:36:06.927

这实际上是 cmd vs Powershell 的语法问题。将命令更改为

```
netsh http add sslcert ipport=0.0.0.0:8085 certhash=4da5af739d6745de4e38fea9574cdaa79032ea14 appid="{7BBE87B9-D98F-41D7-B726-FC5E1300ED28}" 
```

将在两个终端上工作。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2017-06-18T14:12:36.493

这将在 PowerShell 命令行中起作用：

```
$AppId = [Guid]::NewGuid().Guid
$Hash = "209966E2BEDA57E3DB74FD4B1E7266F43EB7B56D"

netsh http add sslcert hostname=localhost:8088 certhash=$Hash appid=`{$AppId`} certstorename my 
```

重要的细节是使用反引号 (`) 转义每个 {}，并且不要省略 certstorename。否则 netsh 会引发错误 87。

变量只是为了方便。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2013-09-20T09:28:39.133

“-”不是无关紧要的。如果您的 guid 看起来不完全像这样，您将收到不正确的参数错误：{EDE3C891-306C-40fe-BAD4-895B236A1CC8} 与 EDE3C891306C40feBAD4895B236A1CC8 -> 错误 {EDE3C891306C40feBAD4895B236A1CC8} -> 错误

我也将 guid 用于 IIS 的 appid，而不是随机的。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2021-04-08T14:07:36.837

我有隐藏的问题，只显示在 powershell 中，而不是命令提示符。

我从证书中复制了指纹并删除了记事本++中的所有空格，但它前面仍然有一个隐藏字符

看起来像这样 .. certhash=dca41243... 实际上是 .. certhash="special char"dca41243...

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2017-11-16T09:36:01.583

在此线程中添加我的分辨率可能很有用：

我试图添加一个带有 hostnameport 参数的 ippport，所以我得到了这个参数错误。

`netsh http add sslcert hostnameport="10.0.0.120:443"`

代替 ：

`netsh http add sslcert ipport="10.0.0.120:443"`

啊！

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2017-07-05T20:54:44.527

我一定是通过删除本地主机证书来破坏 VS 和 IIS Express 之间的关系。我真的被困住了。该应用程序无法启动，而且我似乎无能为力来纠正这种断开连接（这是想把我带到这个线程开始）。

通过更改非 SSL URL（`launchSettings.json`在 .NET Core 应用程序中）上的分配端口并在项目设置中禁用**Enable SSL**复选框并重新开始，我终于能够解决这个问题。然后我可以使用以下命令添加我新创建的证书：`netsh http add sslcert ipport=0.0.0.0:44392 appid={214124cd-d05b-4309-9af9-9caa44b2b74b} certhash=A0ADC1A1002F288CCFA96261F9F352D28C675A90`.

另外，请注意，该`appid`变量不是您的 VS 项目 AppID 的反映（或者至少不必如此）。根据[Scott Hanselmann](http://www.hanselman.com/blog/WorkingWithSSLAtDevelopmentTimeIsEasierWithIISExpress.aspx)的说法，这只是一个任意的 GUID ：

> AppId 并不重要，它只是一个 GUID。这告诉 HTTP.SYS 我们正在使用该证书。

这对我来说并不明显，并且处理**参数不正确**的错误更加模糊。

如果您遇到类似的问题，祝您好运。我相信你。如果您感到迷路和孤独，请联系我。也许到那时我能记住一些事情！:D

# nhibernate - 如何防止使用 nHibernate 插入重复数据？

> ID：779229
> 
> 赞同：1
> 
> 时间：2009-04-22T21:05:25.697
> 
> 标签：nhibernate, unique

我正在构建一个博客/CMS 系统（为了好玩，我知道我可以使用很多东西）。
我有一个简单的 Tag 实体，它只有一个 Id (int) 和一个 TagName (string) 属性。我想配置 nHibernate 以便我可以执行以下操作：

```
var tag1 = Tag.CreateTag("duplicate tag test");  // Id=0 at this point
var tag2 = Tag.CreateTag("duplicate tag test");  // Id=0 at this point
TagRepository.Save(tag1);  // tag1.Id is non-zero
TagRepository.Save(tag2);  // tag2.Id should be the same as tag1.Id at this point, but it's not

Assert.AreEqual(tag1, tag2); 
```

我设想 Save(Tag) 做一些类似查找的事情，如果标签已经存在，以某种方式将 tag2 替换为 tag1 的值。nHibernate 有一些魔法可以修改参数的属性，即使它没有作为输出参数传递。有人可以告诉我这里发生了什么以及如何解决这个方法来做我想做的事吗？我试图避免在 tag 参数上使用 out 关键字。

```
 public override void Save(Tag tag)
    {
        Tag existingTag = GetByTagName(tag.TagName);
        if (null == existingTag)
        {
            using (ISession session = NHibernateHelper.OpenSession())
            using (ITransaction transaction = session.BeginTransaction())
            {
                session.SaveOrUpdate(tag);
                transaction.Commit();
            }
        }
        else
        {
            tag = existingTag; // obviously doesn't impact the caller
        }
    } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-23T19:08:01.137

我认为您对“输出参数”的引用没有意义。该对象仍然是同一个实例，但 NH 在保存时已将 ID 更新为生成的 ID。

我认为您只需要像您在示例中所做的那样首先获取标签。如果您希望呼叫者看到正确的 ID，请执行

```
tag.id = existingTag.id; 
```

我认为您的问题与参数及其处理方式有关，而不是与 NHibernate 有关。阅读[这篇文章](http://www.yoda.arachsys.com/csharp/parameters.html)以获得关于这些东西如何工作的良好基础。

# mysql - 使用 MySQL 触发器将所有表更改记录到辅助表

> ID：779230
> 
> 赞同：33
> 
> 时间：2009-04-22T21:06:10.983
> 
> 标签：mysql, triggers

我有一张桌子：

```
CREATE TABLE `data_table` (
`data_id` INT NOT NULL AUTO_INCREMENT PRIMARY KEY ,
`field1` INT NOT NULL ,
`field2` INT NOT NULL ,
`field3` INT NOT NULL
) ENGINE = MYISAM ; 
```

我会记录到 field1、2 或 3 的任何机会：

```
CREATE TABLE `data_tracking` (
`tracking_id` INT NOT NULL AUTO_INCREMENT PRIMARY KEY ,
`data_id` INT NOT NULL ,
`field` VARCHAR( 50 ) NOT NULL ,
`old_value` INT NOT NULL ,
`new_value` INT NOT NULL ,
`modified` DATETIME NOT NULL
) ENGINE = MYISAM ; 
```

我正在使用 MySQL 5，我想创建一个触发器来做。我想在 data_table 更新时在 data_tracking 中插入一个新行，并记录旧/更新的值以及更改的字段。我尝试了以下但没有任何成功。

```
DELIMITER $$

DROP TRIGGER `update_data `$$

CREATE TRIGGER `update_data` AFTER UPDATE on `data_table`
FOR EACH ROW
BEGIN
    IF (NEW.field1 != OLD.field1) THEN
        INSERT INTO data_tracking set old_value = OLD.field1, new_value = NEW.field1, field = "field1";
    END IF;
END$$

DELIMITER ; 
```

它在插入行上给出了一个错误，我不太确定那应该是什么语法，或者我是否以正确的方式进行。任何帮助，将不胜感激。谢谢。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-04-22T21:12:32.420

插入语法是

```
INSERT INTO table (columns_list) VALUES (values_list) 
```

所以你的插入看起来像这样（我不是 MySQL 专家，但你可以适应查询）：

```
INSERT INTO data_tracking 
(`data_id` , `field` , `old_value` , `new_value` , `modified` ) 
VALUES 
(NEW.data_id, 'field1', OLD.field, NEW.field, CURRENT_DATETIME()); 
```

并重复它以改变 field2 和 field3

我认为这将是完整的触发器，请尝试：

```
DELIMITER $$

DROP TRIGGER `update_data `$$

CREATE TRIGGER `update_data` AFTER UPDATE on `data_table`
FOR EACH ROW
BEGIN
    IF (NEW.field1 != OLD.field1) THEN
        INSERT INTO data_tracking 
            (`data_id` , `field` , `old_value` , `new_value` , `modified` ) 
        VALUES 
            (NEW.data_id, "field1", OLD.field1, NEW.field1, NOW());
    END IF;
    IF (NEW.field2 != OLD.field2) THEN
        INSERT INTO data_tracking 
            (`data_id` , `field` , `old_value` , `new_value` , `modified` ) 
        VALUES 
            (NEW.data_id, "field2", OLD.field2, NEW.field2, NOW());
    END IF;
    IF (NEW.field3 != OLD.field3) THEN
        INSERT INTO data_tracking 
            (`data_id` , `field` , `old_value` , `new_value` , `modified` ) 
        VALUES 
            (NEW.data_id, "field3", OLD.field3, NEW.field3, NOW());
    END IF;
END$$

DELIMITER ; 
```

# svn - 如何设置 Tortoise SVN 评论长度要求

> ID：779239
> 
> 赞同：1
> 
> 时间：2009-04-22T21:09:44.610
> 
> 标签：svn, tortoisesvn

我知道在 Subversion 中，当开发人员在评论部分提交时，您可以确保 x 字符。我正在使用 Tortoise，但看不到在哪里全局指定它，并确保在开发人员所做的任何提交上输入 x 个字符。我也在使用 Visual SVN Server 来设置存储库。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-22T21:14:40.900

为了在整个开发团队中有效，这是一个应该在服务器上设置的设置，而不是在 TortoiseSVN 客户端中。如果您仍希望在客户端上设置此设置，Tim 所指的设置在此博客文章中进行了说明：
[http ://www.anujgakhar.com/2008/07/22/forcing-svn-comments-with-tortoisesvn /](http://www.anujgakhar.com/2008/07/22/forcing-svn-comments-with-tortoisesvn/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T21:13:15.117

从 tortoise svn 菜单（资源管理器插件）中选择属性 -> 添加 -> tsvn:logminsize

另见： [http ://www.anujgakhar.com/2008/07/22/forcing-svn-comments-with-tortoisesvn/](http://www.anujgakhar.com/2008/07/22/forcing-svn-comments-with-tortoisesvn/)

和

[http://tortoisesvn.net/docs/nightly/TortoiseSVN_en/ch05s15.html](http://tortoisesvn.net/docs/nightly/TortoiseSVN_en/ch05s15.html)

编辑 Tormod 是对的 - 在服务器上拥有该策略很好，但我只是在客户端上“强制执行”它。我们基本上有一个传播的 svnprops 文件。如果人们不遵守它，那么我们有一些讨论......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T21:16:15.657

这是[一篇](http://www.anujgakhar.com/2008/02/14/how-to-force-comments-on-svn-commit/)关于防止空白评论的文章。这个已经上线[了](https://stackoverflow.com/questions/247888/how-to-require-commit-messages-in-visualsvn-server)

# wpf - 在 WPF 中使用自定义转换器时强制转换始终运行？

> ID：779243
> 
> 赞同：1
> 
> 时间：2009-04-22T21:10:30.117
> 
> 标签：wpf, converter

我在 WPF 中实现了一个自定义日期转换器，这个想法是更聪明的日期输入，一个 la Outlook（能够输入“今天”等）所以我编写了自己的转换器，它正在工作。它将用户输入的格式设置为 M/d/yy 格式。例如，如果他们输入：8-2，他们将看到 8/2/09。迷人的。

问题是：用户可以输入几项最终导致相同日期的内容。（8-2 和 8/2，是简单的例子）。所以让我们假设他们从输入 8/2 开始，它通过 ConvertBack 和 Convert 运行，并显示为 8/2/09。到现在为止还挺好。现在假设他们在同一个字段中输入 8-2（或再次输入 8/2），紧随其后。它通过 ConvertBack 运行，它产生绑定属性中已经存在的 SAME 日期，因此它不需要运行 Convert，这意味着“8/2”就在文本框中。哎呀！没有数据问题，只是显示问题，但是嘿，整洁很重要。

如何强制 WPF 在所有（非错误）条目后运行转换？

这是转换器的简化版本：

```
 public class DateConverter : IValueConverter
{
    #region IValueConverter Members

    public object Convert(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
    {
        if (value != null)
        {
            string tempStr = value.ToString();
            return ((DateTime.Parse(tempStr)).ToString("M/d/yy"));
        }
        else
        {
            return null;
        }
    }

    public object ConvertBack(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
    {
        return DateTime.Parse(value.ToString());
    }

    #endregion
} 
```

以下是它的用法：

```
 <local:FilteredTextBox.Text>
        <Binding Path="Value" ElementName="root" Converter="{StaticResource DateConv}" 
           UpdateSourceTrigger="LostFocus"  Mode="TwoWay" diagnostics:PresentationTraceSources.TraceLevel="High"
        NotifyOnValidationError="True" ValidatesOnDataErrors="True" ValidatesOnExceptions="True">
          <Binding.ValidationRules>
                <local:DateValidation/>
          </Binding.ValidationRules>
        </Binding>
      </local:FilteredTextBox.Text> 
```

谢谢！斯科特

作为对以下评论的回应，这里是支持属性：

```
 public DateTime? Value
    {
        get
        {
            return (DateTime?)GetValue(ValueProperty);
        }
        set
        {
            SetValue(ValueProperty, value);
            OnPropertyChanged(new DependencyPropertyChangedEventArgs(ValueProperty, null, value)); // I just added this line, it makes no difference
        }
    } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-22T21:19:29.267

支持数据属性是否可能仅`PropertyChanged`在实际更改值时才触发？`PropertyChanged`无论值是否发生变化，您都可以在调用 set 函数时尝试触发。这将导致绑定被更新。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T17:00:00.220

非常感谢 Josh G - 在他的帮助下，我找到了（或至少一个）答案。

这是针对我正在创建的 DatePicker 控件中的文本框。因此，我没有将文本框直接“锁定”到控件的值，而是创建了一个中间属性，然后将集合调用为依赖属性：

```
 public DateTime? DateValue
    {
        get
        {
            return _dateValue;
        }
        set
        {
            _dateValue = value;
            OnPropertyChanged("DateValue");
            SetValue(ValueProperty, _dateValue);
        }
    } 
```

这完全可以正常工作。再次感谢，乔希！

# regex - 正则表达式模式中组模式的重复

> ID：779245
> 
> 赞同：2
> 
> 时间：2009-04-22T21:11:04.123
> 
> 标签：regex, curl

所以，伙计们，我有这个有效的自制模式。几个小时后（我不是正则表达式大师），这只小狗进化为我解析 curl PUT 输出：

```
 ^\s*([^ ]+)\s+([^ ]+)\s+([^ ]+)\s+([^ ]+)\s+([^ ]+)\s+([^ ]+)
    \s+([^ ]+)\s+([^ ]+)\s+([^ ]+)\s+([^ ]+)\s+([^ ]+)\s+([^ ]+) 
```

*（文本中的 CR 仅用于格式化）*

它为我提供了我可以访问的“组”——它有效！然而，我内心的编码员看到了一种模式的重复，这让我心烦意乱。多年来，我看到 perl*的模式竞赛有多小，这让我认为这可能会**小得多*。但是我尝试在其中打一个 * 失败了。

所以，**问题是**：如何以更简洁的方式编写此模式，以便我仍然可以拉出我的目标群体？

可能没关系，但这里是我所追求的群体：

```
$1: percent finished
$2: size uploaded so far
$6: size to upload
$8: average upload rate 
```

更新：可以在我的博客文章（[如何配置 OnMyCommand 以生成 curl 的进度条](http://lanai.dietpizza.ch/geekomatic/2009/03/06/1236358080000.html)）上找到更多背景，这将解释我在做什么以及为什么我只使用正则表达式模式。*本质*上，我实际上并不是在用一种语言进行编码……而是配置一个工具来使用正则表达式。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-22T21:32:42.060

看起来这是我能做的最好的：

```
^\s*([^ ]+)\s+([^ ]+)\s+(?:[^ ]+\s+){3}([^ ]+)\s+[^ ]+\s+([^ ]+)\s+ 
```

我折叠了您不关心的匹配项，使它们不被捕获，并保留了不需要的尾随匹配项。如果匹配所有内容很重要（例如，还有其他匹配的行），您可以说：

```
^\s*([^ ]+)\s+([^ ]+)\s+(?:[^ ]+\s+){3}([^ ]+)\s+[^ ]+\s+([^ ]+)(?:\s+[^ ]){4} 
```

请注意，我的更改也会更改捕获编号：

*   $1：完成百分比
*   $2：目前上传的尺寸
*   $3：上传大小
*   4 美元：平均上传速度

如果它支持 \S，你也许可以摆脱这个

```
^\s*(\S+)\s+(\S+)\s+(?:\S+\s+){3}(\S+)\s+\S+\s+(\S+)\s+ 
```

但这并不意味着完全相同。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T21:19:07.520

```
((^\s*|\s+)([^ ]+)){12} 
```

如果你不关心匹配的数量并且想要匹配一个完整的字符串，只需坚持以下。

```
((^\s*|\s+)([^ ]+))*\s*$ 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T21:34:40.633

如果您的正则表达式使用贪婪匹配，这可能有效：

```
^(\s*([^ ]+))+$ 
```

解释：

*   ^ = 行首
*   重复模式 = \s*([^ ]+)
*   用括号括起来并添加“+”以表示“前面的一个或多个匹配项”
*   $ = 行尾

# php - 使用tomcat运行一个php应用程序？

> ID：779246
> 
> 赞同：44
> 
> 时间：2009-04-22T21:11:50.987
> 
> 标签：php, tomcat, apache

是否可以使用 tomcat 运行 PHP 应用程序？

在您告诉我只使用 httpd 之前，我已经在我的网络服务器上运行了一个 Java 应用程序`host/myapp`。现在我想在主机/roundcube 上安装 RoundCube。

一种是PHP，一种是Java。我一直看到临时参考说这是可能的，但没有真正的说明。我不想将它们放在单独的端口上，我需要标准的 HTTP 和 HTTPS 端口。

有没有人有这方面的资源？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2012-08-07T06:45:37.403

是的，可能[会登](https://stackoverflow.com/users/17614/will-den)。我们可以使用它自己的端口号 localhost:8080 在 tomcat 服务器中运行 PHP 代码

在这里，我正在写一些对您非常有用的步骤。

**如何在 Windows 中的 Tomcat 6 上安装或运行 PHP**

1.  下载 PHP 5 并解压到一个目录，`c:\php-5.2.6-Win32`-php-5.2.9-2-Win32.zip[下载](http://www.php.net/get/php-5.2.9-2-Win32.zip/from/a/mirror)

2.  下载**PECL 5.2.5 Win32**二进制文件 - [PECL 5.2.5 Win32 下载](http://museum.php.net/php5/pecl-5.2.5-Win32.zip)

3.  重命名`php.ini-dist`为`php.ini`in`c:\php-5.2.6-Win32`

4.  取消注释或添加以下行（删除开头的分号）`php.ini`： `;extension=php_java.dll`

5.  `php5servlet.dll`从 PECL 5.2.5复制到`c:\php-5.2.6-Win32`

6.  `php_java.dll`从**PECL 5.2.5**复制到`c:\php-5.2.6-Win32\ext`

7.  `php_java.jar`从**PECL 5.2.5**复制到`tomcat\lib`

8.  在目录中创建一个名为`"php"`（或任何你喜欢的）的`tomcat\webapps`目录

9.  `phpsrvlt.jar`从**PECL 5.2.5**复制到`tomcat\webapps\php\WEB-INF\lib`

10.  Unjar 或 unzip`phpsrvlt.jar`用于 unzip 使用 winrar 或 winzip 用于 unjar ：`jar xfv phpsrvlt.jar`

11.  将两者都`net\php\reflect.properties`更改`net\php\servlet.properties`为`library=php5servlet`

12.  重新创建 jar 文件 -> jar cvf php5srvlt.jar net/php/ *。* PS：如果 jar 文件没有运行，你必须为我添加系统变量的路径，我添加了`C:\Program Files\Java\jdk1.6.0\bin; to System variables/Path`

13.  `web.xml`使用`tomcat\webapps\php\WEB-INF`此内容创建：

    ```
    <web-app version="2.4" 
      xmlns="http://java.sun.com/xml/ns/j2ee"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance "
      xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee 
      http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd ">
      <servlet>
        <servlet-name>php</servlet-name>
        <servlet-class>net.php.servlet</servlet-class>
      </servlet>
      <servlet>
        <servlet-name>php-formatter</servlet-name>
        <servlet-class>net.php.formatter</servlet-class>
      </servlet>
      <servlet-mapping>
        <servlet-name>php</servlet-name>
        <url-pattern>*.php</url-pattern>
      </servlet-mapping>
      <servlet-mapping>
        <servlet-name>php-formatter</servlet-name>
        <url-pattern>*.phps</url-pattern>
      </servlet-mapping>
    </web-app> 
    ```

14.  在 Windows 环境中将PHP 路径（`c:\php-5.2.6-Win32`）添加到您的系统或用户路径（提示：右键单击并从**我的电脑中选择属性**

15.  在like下创建`test.php`测试`tomcat\webapps\php`

16.  重启tomcat

17.  浏览`localhost:8080/php/test.php`

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-04-22T21:14:04.723

在 Apache 后面运行 Tomcat 是很常见的。在 Apache 中，您可以将某些 URL 定向到 Tomcat，并让 Apache/PHP 处理其他 URL（包括静态图像）。

（在 Unix 上，Tomcat 本身不能安全地在 80 端口上运行，而 Apache 可以。Tomcat 作为 Java 进程，需要以 root 身份运行，而 Apache 将在端口 80 被打开后立即切换到非 root 权限声称。因此，在端口 80 上运行 Apache 并将部分或全部请求重定向到 Tomcat，在 Unix 上很常见。）

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-22T21:30:38.273

Caucho [Quercus](http://www.caucho.com/resin-3.0/quercus/)可以在 jvm 上运行 PHP 代码。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2010-02-27T10:21:48.613

有点晚了，但这里。

如果您只想在 tomcat 上运行真正的 php，那么[http://wiki.apache.org/tomcat/UsingPhp](http://wiki.apache.org/tomcat/UsingPhp)怎么样。

关于在端口 80 上运行 tomcat，总是有 jsvc，只需 google jsvc + tomcat。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-04-22T21:39:36.270

那里有这个[PHP/Java](http://php-java-bridge.sourceforge.net/pjb/)桥。这基本上是通过 FastCGI 运行 PHP。我自己没用过。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-10-05T02:50:34.387

tomcat 被设计为 JSP servlet 容器。Apache 是设计的 PHP Web 服务器。使用 apache 作为 Web 服务器，响应 PHP 请求，并将 JSP servlet 请求定向到 tomcat 容器。应该更好的执行。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-07-03T06:31:53.927

如果有人还在寻找 - [Quercus](http://quercus.caucho.com/)有一场战争，允许在 apache tomcat 或 glassfish 中运行 PHP 脚本。有关分步指南，请查看[本文](http://www.studytrails.com/blog/php-on-a-java-app-server-apache-tomcat-using-quercus/)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-08-03T04:41:38.747

1.  确保你的服务器上安装了 php
2.  [从sourceforge](https://sourceforge.net/projects/php-java-bridge/files/Binary%20package/)中找到最新版本的 php-java-bridge
3.  从 Sourceforge 上的分解目录中，下载`php-servlet.jar`并`JavaBridge.jar`
4.  将这些 jar 文件放入`webapp/WEB-INF/lib`项目的文件夹中
5.  编辑 webapp/WEB-INF/web.xml 看起来像：

好的

```
<?xml version="1.0" encoding="UTF-8"?>
<web-app>
   <filter>
      <filter-name>PhpCGIFilter</filter-name>
      <filter-class>php.java.servlet.PhpCGIFilter</filter-class>
   </filter>
   <filter-mapping>
      <filter-name>PhpCGIFilter</filter-name>
      <url-pattern>/*</url-pattern>
   </filter-mapping>
   <!-- the following adds the JSR223 listener. Remove it if you don't want to use the JSR223 API -->
   <listener>
      <listener-class>php.java.servlet.ContextLoaderListener</listener-class>
   </listener>
   <!-- the back end for external (console, Apache/IIS-) PHP scripts; remove it if you don't need this -->
   <servlet>
      <servlet-name>PhpJavaServlet</servlet-name>
      <servlet-class>php.java.servlet.PhpJavaServlet</servlet-class>
   </servlet>
   <!-- runs PHP scripts in this web app; remove it if you don't need this -->
   <servlet>
      <servlet-name>PhpCGIServlet</servlet-name>
      <servlet-class>php.java.servlet.fastcgi.FastCGIServlet</servlet-class>
      <load-on-startup>0</load-on-startup>
   </servlet>
   <servlet-mapping>
      <servlet-name>PhpJavaServlet</servlet-name>
      <url-pattern>*.phpjavabridge</url-pattern>
   </servlet-mapping>
   <servlet-mapping>
      <servlet-name>PhpCGIServlet</servlet-name>
      <url-pattern>*.php</url-pattern>
   </servlet-mapping>
</web-app> 
```

您可能在此文件中还有其他内容，只需确保您已在 web-app 标记之间添加了所有内容。

6.  将您的 php 文件添加到 webapp 目录

你也可以用它做其他特殊的事情。您可以在这里了解更多信息：http: [//php-java-bridge.sourceforge.net/pjb/how_it_works.php](http://php-java-bridge.sourceforge.net/pjb/how_it_works.php)

# java - 阻止所有java线程消失到IO中的最简单方法？

> ID：779256
> 
> 赞同：0
> 
> 时间：2009-04-22T21:14:11.620
> 
> 标签：java, multithreading

我有一个只需要 servlet-container 运行的 web 应用程序。我的登录页面和首页没有任何后端事务，但所有其他页面都有。保证我不会将*所有*线程发送到某个套接字等待后端系统（CXF-webservices）的*最简单方法是什么？*这是 weblogic 10.3，但我真的不太关心标准合规性。

 *我有一个 AOP 方面已经拦截了所有后端流量，所以我想我可以增加/减少 AtomicInteger 并在剩下的线程太少时抛出异常，但这会产生确定当前线程池大小的问题。

有任何想法吗 ？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-23T08:26:02.253

你有多少控制权？您能否将 weblogic 配置为[使用 8.1 线程池模型](http://edocs.bea.com/wls/docs103/perform/appb_queues.html#use81)，然后定义不同的线程池——一个用于可能长期存在的后端调用，一个用于处理对首页的请求？

这只是配置，您不必编写任何代码，这对我来说似乎很好。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T21:19:44.447

好的，你的用例是什么？如果除了您的登录和首页之外的所有内容都有后端事务，并且您用完了线程，您希望应用程序*做*什么？你想要什么样的可观察行为？

通常的事情是有某种“请稍候……”的信息；如果是这样，请创建一个可以设置它的线程，并让它检查进度。当没有进展时，显示“请稍候...”消息。

# asp.net - ASP.Net 成员身份验证手动创建的用户

> ID：779258
> 
> 赞同：1
> 
> 时间：2009-04-22T21:14:21.853
> 
> 标签：asp.net, asp.net-membership, membership, membership-provider

我正在使用membership.creatuser() 在我的asp.net 用户表中手动创建用户。是否有一种简单的方法可以测试以确保在我创建帐户后创建帐户并且/或者有效？

```
MembershipCreateStatus status = new MembershipCreateStatus();
Membership.CreateUser(user.FirstName + user.LastName, 
                       user.Password, user.Email); 
```

我基本上想自动登录到该站点，然后如果成功与否则返回？

任何链接或想法将不胜感激。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-22T21:19:26.910

好吧，该`CreateUser()`方法有一个`out`参数，该参数将返回一个`MembershipCreateStatus` `enum`有关所发生事件的详细信息。除此以外的任何内容`Success`都`enum`表明存在潜在问题。

我看到你已经声明了你的`status`变量，你只需要使用它！

# c++ - 递归在 C++ 中的函数中执行多远？

> ID：779282
> 
> 赞同：2
> 
> 时间：2009-04-22T21:20:41.790
> 
> 标签：c++, recursion, mergesort

我在一位教我 C++（作为第一语言）的朋友的指导下编写了递归函数。但是，我真的不明白发生了什么。他帮助我（以及 SO 社区）编写了一个归并排序函数。

```
std::vector<int> mergeSort(std::vector<int> original)

//code here to create two vectors, farray and sarray, out of the 
//original std::vector<int> original ; each is half the length,
//note: if the size % 2 != 0, sarray takes the odd int

farray = mergeSort(farray);
sarray = mergeSort(sarray);

//code here merges the two into a single, final sorted std::vector 
```

在这个函数中，我分配：

```
farray = mergeSort(farray);
sarray = mergeSort(sarray); 
```

这里到底发生了什么？它以 farray 和 sarray 作为参数调用 mergeSort 并更改值。mergeSort 递归地执行到自身多远？直到递归函数调用？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-22T21:23:18.510

每次递归调用函数时，它都会有效地复制所需信息的新副本，然后继续。

你可以有一个“无限”重复的程序，即直到它耗尽资源，通常是堆栈空间——这些副本所在的空间。那看起来像

```
void recur(){
    recur();
}

int main(){
    recur();
    exit(0); /* won't ever really get here.*/
} 
```

显然，这不是很有用，因此您想编写一个对其重复频率有一定限制的程序。这是一个非常简单的程序来管理它：

```
#include <iostream>
using namespace std;
void recurSome(int count){
    cout << "RecurSome called with " << count << endl;
    if (count > 0){
        recurSome(count-1);
        cout << "Back at " << count << endl;
    }else{
        cout << "Bottom." << endl;
    }
    return;
}

int main(){
    recurSome(10);
    exit(0);  /* now it will get here. */
} 
```

如果您编译并运行它，请说：

```
bash $ g++ -Wall -o rc recursome.cpp
bash $ ./rc 
```

你会得到结果：

```
RecurSome called with 10
RecurSome called with 9
RecurSome called with 8
RecurSome called with 7
RecurSome called with 6
RecurSome called with 5
RecurSome called with 4
RecurSome called with 3
RecurSome called with 2
RecurSome called with 1
RecurSome called with 0
Bottom.
Back at 1
Back at 2
Back at 3
Back at 4
Back at 5
Back at 6
Back at 7
Back at 8
Back at 9
Back at 10
bash $ 
```

看看它是如何被调用为 10，然后是 9，等等，然后在它到达底部后，它显示它返回 1，然后是 2，等等，直到 10？

基本规则是*每个*递归函数都应该有一些构成基本情况的东西，一个*确实*会再次调用自己的东西。在这个例子中，基本情况是`count == 0`，事实上我们可以把它写成一个递归定义

> recursome:
> if c = 0 : print bottom
> if c > 0 : print count, and recursome(c-1)

当您继续学习数学时，您会看到许多此类递归定义。

这是一个更漂亮的 C 版本，输出更好：

```
#include <stdio.h>
#include <stdlib.h>

int max = 10;

void recurSome(int count){
    printf("RecurSome %*c Called with %d\n", max-count+1, ' ', count);
    if (count > 0){
        recurSome(count-1);
        printf("RecurSome %*c Back at %d\n", max-count+1, ' ', count);
    }else{
        printf("RecurSome %*c Bottom.\n", 2*max, ' ');
        printf("RecurSome %*c Back at %d\n", max-count+1, ' ', count);
    }
    return;
}

int main(){
    recurSome(max);
    exit(0);  /* now it will get here. */
} 
```

输出：

```
RecurSome   Called with 10
RecurSome    Called with 9
RecurSome     Called with 8
RecurSome      Called with 7
RecurSome       Called with 6
RecurSome        Called with 5
RecurSome         Called with 4
RecurSome          Called with 3
RecurSome           Called with 2
RecurSome            Called with 1
RecurSome             Called with 0
RecurSome                      Bottom.
RecurSome             Back at 0
RecurSome            Back at 1
RecurSome           Back at 2
RecurSome          Back at 3
RecurSome         Back at 4
RecurSome        Back at 5
RecurSome       Back at 6
RecurSome      Back at 7
RecurSome     Back at 8
RecurSome    Back at 9
RecurSome   Back at 10 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T22:01:24.597

查字典：

**递归**：名词。见*递归*

现在，严肃地说，在上面的笑话中，递归的定义是根据递归本身给出的。那就是递归。

递归算法是一种基于算法本身实现的算法。开发这种算法的过程从最基本的情况开始，其解决方案要么是预先知道的，要么可以简单地计算出来。然后根据算法本身来定义算法。

作为一个简单的例子，计算给定整数 i 的 n 次方可以是一个函数`power( int number, int power )`。你怎么能实现它？很多方面。最简单的是调用库，然后是循环，或者您可以根据自身定义函数：

```
int power( int number, unsigned int pow )
{
   // Basic trivial case, cuts the recursion:
   if ( pow == 0 ) return 1;

   // Implement power in terms of itself:
   return number * power( number, pow-1 );
}
int main()
{
   int power = power( 2, 10 );
} 
```

我们已经根据自身定义了函数。你从最基本的情况开始（n^0 = 1）。如果我们不是最简单的情况，你可以用它本身来表达你的算法。

该程序将从 main 开始，调用`power( 2, 10 )`将递归并调用`power( 2, 9 )`将问题简化为*更小*的问题，然后根据更简单的问题组成最终答案。

实际的呼叫跟踪将是：

```
power( 2, 5 )
  power( 2, 4 )
    power( 2, 3 )
      power( 2, 2 )
        power( 2, 1 )
          power( 2, 0 )    // simplest case: return 1
        return 2 * 1 -> 2  // obtain next solution in terms of previous
      return 2 * 2 -> 4
    return 2 * 4 -> 8
  return 2 * 8 -> 16
return 2 * 16 -> 32 
```

在开发递归算法时，它通常帮助我相信我已经启动并运行了算法，并且只需处理新结果的减少/组合。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-22T22:52:11.867

递归可以理解为归纳原理的实际应用。为了证明所有 n 的陈述 P(n)，其中 P(n) 表示“从 1 到 n 的整数之和为 n(n+1)/2”，我们必须证明两件事：

1.  **基本情况：** P(n) 适用于特定整数。P(1) 为真，因为 1 = 1(1+1)/2。
2.  **归纳案例：**如果 P(n) 为真，则 P(n+1) 必须为真。1 + ... + n + (n+1) = n(n+1)/2 + (n+1) = n(n+1)/2 + 2(n+1)/2 = (n+ 1)((n+1)+1)/2，即命题P(n+1)。

同样，在像 mergeSort 这样的递归函数中，我们需要处理两种情况：

1.  **基本情况：**如果数组只有一个元素，则排序；除此以外
2.  **递归案例：**将数组拆分为两个较小的数组，对每个数组进行mergeSort，然后合并在一起。

关键是这两个数组比原来的要*小*，否则其中一个永远不会达到基本情况。因为数组被大致分成两半，在这种情况下，递归的深度约为 log2(n)。

就问题中的代码而言，存在三个问题：

1.  缺少基本情况。
2.  重用变量 farray 和 sarray 并不是绝对必要的，而且可能会造成混淆。
3.  由于创建和销毁的 std::vectors 的数量，代码将非常慢。mergeSort 的最佳接口采用两个 vector::iterators 作为输入，类似于 std::sort() 函数。

新程序员应该尝试用纸和铅笔运行mergeSort。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T22:00:50.073

为了使递归函数不是无限的，需要有一些条件，它返回而不调用自身。对于某些算法，该条件是对数据执行调用不再有意义的点。

在您的情况下，如果您拆分传入的向量并最终得到两个向量，每个向量仅包含 1 个项目，那么对它们调用 mergeSort() 是否有意义？不。

您可以通过检查 farray 和 sarray 的大小并决定在组合它们并返回组合之前是否在其中一个或两个上调用 mergeSort() 来处理这个问题。

如果一个有 2 个项目，一个有 1 个项目怎么办？在尺寸 2 上调用 mergeSort() 但不在尺寸 1 上调用。

当对 mergeSort() 的调用在返回之前没有在 farray 或 sarray 上调用 mergeSort() 时，递归将开始展开。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-22T22:14:28.637

查看 wikipedia page for [merge sort](http://en.wikipedia.org/wiki/Mergesort)以获取有关您尝试执行的操作的更多信息。

作为旁注，请注意您正在制作作为参数提供的每个向量的副本。使用 vector<> const& 代替。

# c# - 是否有适用于 C#/.NET 的跨平台 GUI 框架？

> ID：779283
> 
> 赞同：15
> 
> 时间：2009-04-22T21:20:50.887
> 
> 标签：c#, .net, user-interface, cross-platform

让我们说只是为了它的乐趣，我决定我不想再用 Java 编写桌面应用程序，而是想改用 C#。我希望能够构建一个可以在一些主流 Linux 发行版和最新版本的 MS Windows 上运行的应用程序。它将有一个 GUI 组件。

在 Java 中，我可以构建一个使用 Swing 的应用程序。一旦我让它工作，我可以将该 jar 文件从 Windows 复制到 Linux，反之亦然，这取决于我开发它的位置。它通常会与`java -jar myapp.jar`.

在 C# 中可以做到这一点吗？C# 中是否有与 Swing 或 AWT 等效的功能？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2012-04-16T20:37:44.737

有[Eto.Forms （在 github 上），它是](https://github.com/picoe/Eto)**WPF**、**WinForms**、**GTK**和**MonoMac/Cocoa**之上的一个抽象层——因此您可以在所有平台上获得本机 UI，而无需为每个平台重新实现。您不必为最小公分母而受苦，因为您可以为每个平台实现细节（如果需要，但不是必需的）。

它的优点是它是纯 .NET 并且仅依赖于操作系统提供的依赖项，而不是使用 GTK 或 WxWidgets，您必须为各种平台捆绑本机二进制文件。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-04-22T21:27:04.927

可能[GTK#](http://www.mono-project.com/GtkSharp)是最接近的。

我知道其他人说过单声道，但这并不完全正确。.Net 之于 mono 就像 Microsoft 的 Java VM 之于 Sun 的 Java 运行时一样。mono 与 Swing 不在同一个概念空间中。为此，GTK# 是更接近的匹配项。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-22T21:28:30.883

[此页面](http://mono-project.com/Gui_Toolkits)列出了 Mono 支持的 GUI 工具包，包括每个工具包的优缺点。正如其他人所建议的那样，WinForms、GTK# 和 wxNet 都是可行的选择。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-22T21:23:40.537

我相信 WinForms 的很大一部分是在 Mono 中实现的。为此，您需要在 Linux 下安装 Mono。不过，您可能会遇到兼容性问题，因为 Mono 不是 Microsoft 的成果，也没有得到他们的官方支持。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2020-05-20T05:22:19.347

Microsoft 最近刚刚推出了[.NET MAUI](https://devblogs.microsoft.com/dotnet/introducing-net-multi-platform-app-ui/)，它基于 Xamarian 构建并支持 .NET 核心。

用他们的话来说：

> 当我们考虑在统一的 .NET 中构建设备应用程序会是什么样子时，我们看到许多设备跨使用多个平台，从 Android 和 iOS 到 Windows 和 macOS。为了满足这一需求，我们很高兴地宣布了一个新的一流 UI 框架来实现这一点：.NET Multi-platform App UI，亲切地称为 .NET MAUI。
> 
> .NET MAUI 简化了 .NET 开发人员的选择，提供支持所有现代工作负载的单一堆栈：Android、iOS、macOS 和 Windows。

尽管他们没有指定 Linux，但根据[MA​​UI Github Repo](https://github.com/dotnet/maui)的说法，社区开发了对它的支持。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2014-11-15T12:27:20.013

This is an older question, but as an update, a combination of Mono and Xamarin should work for your modern cross-platform needs.

[http://www.mono-project.com/docs/gui/winforms/](http://www.mono-project.com/docs/gui/winforms/)

Microsoft has just open-sourced .NET and is committing to bringing the .NET core to Linux and MacOS with their next version. Microsoft has also formed a close partnership with Mono and Xamarin, specifically to help with their Android and Linux libraries.

[http://www.hanselman.com/blog/AnnouncingNET2015NETAsOpenSourceNETOnMacAndLinuxAndVisualStudioCommunity.aspx](http://www.hanselman.com/blog/AnnouncingNET2015NETAsOpenSourceNETOnMacAndLinuxAndVisualStudioCommunity.aspx)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-11-14T12:25:36.073

对于 iOS、Android 和 Windows Mobile，有 Xamarin.Forms。 [http://xamarin.com/forms](http://xamarin.com/forms) 这是一个抽象层，允许您编写跨平台代码，它在底层绑定到本机 GUI 工具包。

我正在寻找更多这样的解决方案——我不仅关心移动平台，还关心桌面平台（windows、mac OSX、fedora/ubuntu/etc linux）

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-22T21:23:01.677

你可以试试[WxWidgets](http://www.wxwidgets.org/)。它支持 C# 以及许多其他语言，并且是跨平台的。唯一的缺点是为每个平台重新编译。或者，您可以尝试非常好的 Mono，但要注意存在一些兼容性问题。C# 应用程序没有预定义的“在任何地方运行”文件，但就像 Java 的 jars 一样，如果你想确保兼容性，最好的办法是为每个平台重新编译。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-22T21:23:08.617

我见过的最接近的东西是 Mono——尽管我相信它还不支持所有的 CLR 库，但它是跨平台的。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2019-06-30T03:53:23.330

这些天有很多。这取决于你在寻找什么。[这](https://christianfindlay.com/2019/05/11/cross-platform-c-ui-technologies/)是关于这三种选择技术的详细文章。它们不是唯一的技术，但它们现在最热门。

[Xamarin 表单](https://docs.microsoft.com/en-us/xamarin/xamarin-forms/)

C#，基于 XAML，Microsoft 拥有开源，支持 Android、iOS、UWP 等。本机渲染。

[宇野平台](https://platform.uno/)

C#，基于 XAML，开源，支持 Android、iOS、UWP 等。本机渲染。

[阿瓦洛尼亚](http://avaloniaui.net/)

C#，基于 XAML，开源，支持 Linux、MacOS、Windows 等。每个平台上的像素完美渲染。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-22T21:41:50.477

Windows.Forms 是为 .NET 开发 GUI 应用程序的标准库

尽管在 Windows 上得到了很好的支持，但 Mono 也完全实现了 2.0 版，这使得它可以在 Mono 支持的所有平台上使用。

另一方面，WPF 是概​​念上的新库，目前它主要仅在 Windows 上得到完全支持，Mono 的 Silverlight 实现 - Moonlight 仅支持它的一个子集。

如果您正在为高效的跨平台使用构建应用程序和/或有保守的性能限制，请转到 Windows 窗体。

如果您想试验和学习新的东西，或者如果您正在为 Windows 开发新的应用程序，请使用 WPF。这是客户端 GUI 应用程序的新技术。

# django - 如何使用 Django 平面页面拥有类似 Wordpress 的自定义字段？

> ID：779292
> 
> 赞同：0
> 
> 时间：2009-04-22T21:22:40.693
> 
> 标签：django, django-flatpages

使 WordPress 之类的 CMS 强大的功能之一是能够添加可能在模板中使用的其他字段。WordPress 有它所谓的自定义字段。有没有办法使用 Django 的平面页面来做到这一点？如果没有，是否有另一个 Django 应用程序允许通过添加其他字段的选项创建页面？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T22:27:36.827

您可以推出自己版本的平面应用程序；看看源代码，真的很简单。

听起来您可以使用两个模型完成您想要的：一个代表页面，另一个代表自定义字段。将它们与外键和一些内联管理员的优点联系在一起，你应该已经准备好了。要访问模板中的字段，请确保 Page 类实现某种查找功能，例如`__getitem__`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-23T07:33:33.690

如果您不需要查询字段，那么最简单的方法是添加一个字段，该字段以腌制字典或其他格式保存所有自定义数据。

**[JSONField](http://www.djangosnippets.org/snippets/377/)**是以 JSON 格式存储自定义对象的示例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-23T22:19:17.120

平面页面基本上只是存储在数据库中的静态 HTML 页面，具有漂亮的管理界面。

如果您需要更复杂的东西，是时候自己动手了。

# javascript - 使用 jQuery 设置新 id

> ID：779300
> 
> 赞同：34
> 
> 时间：2009-04-22T21:24:14.200
> 
> 标签：javascript, jquery

“this”是一个文本字段，“new_id”是一个整数。

当我应用以下代码段时：

```
$(this).attr('id',   this.id + '_' + new_id);
$(this).attr('name', this.name + '_' + new_id);
$(this).attr('value', 'test'); 
```

id 改变了，名字也改变了，但值没有改变。如果我将最后一行更改为此（因此使用字符串文字）

```
$('#mytextfield_3').attr('value', 'test'); 
```

有用。

有任何想法吗？

-- 编辑 -- 感谢 Steerpike 的快速插件测试 - 我相信它应该可以工作，但我找不到错误。

这里还有一些代码：

我使用创建克隆

```
clone = $(this).find('.clone_fields_container:first').clone(); 
```

“克隆”现在包含一个嵌入了输入字段的 div。

生成新ID后：

```
 /** Iterate over input and select fields in container */

  clone.children('input,select,textarea').each(function() {
    $(this).attr('id',   this.id + '_' + new_id);
    $(this).attr('name', this.name + '_' + new_id);
    $(this).val('test');
    console.log(this);
  }); 
```

文本字段没有任何值。

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-04-22T21:38:31.560

我刚刚编写了一个快速插件来使用您的相同代码段运行测试，它工作正常

```
$.fn.test = function() {
      return this.each(function(){
        var new_id = 5;
        $(this).attr('id',   this.id + '_' + new_id);
        $(this).attr('name', this.name + '_' + new_id);
        $(this).attr('value', 'test');
      });
    };

$(document).ready(function() {
    $('#field_id').test()
});

<body>
  <div id="container">

  <input type="text" name="field_name" id="field_id" value="meh" />
  </div>
</body> 
```

所以我只能假设你的代码中发生了其他事情。你能提供更多细节吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T21:29:25.263

你试过了吗

```
$(this).val('test'); 
```

代替

```
$(this).attr('value', 'test'); 
```

`val()`通常更容易，因为您需要更改的属性在不同的 DOM 元素上可能不同。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T21:26:57.813

**编辑**：根据您的评论并假设这`this`是被克隆的元素。

```
 $(this).clone()
        .attr( 'id', this.id + '_' + new_id )
        .attr( 'name', this.name + '_' + new_id )
        .val( 'test' )
        .appendTo('#someElement'); 
```

**完整示例**

```
 <script type="text/javascript">
    var new_id = 0;
    $(document).ready( function() {
       $('#container > input[type=button]').click( function() {
            var oldinp = $('input#inp')[0];
            var newinp = $(oldinp).clone()
                                  .attr('id',oldinp.id + new_id )
                                  .attr('name',oldinp.name + new_id )
                                  .val('test')
                                  .appendTo($('#container'));
            $('#container').append('<br>');
            new_id++;
        });
     });
 </script>

 <div id="container">
 <input type="button" value="Clone" /><br/>
 <input id="inp" name="inp" type="text" value="hmmm" /><br/>
 </div> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T21:38:10.783

当您像这样在一个[`attr()`命令中设置所有属性时会发生什么](http://docs.jquery.com/Attributes/attr)

```
$(this).attr({
               id : this.id + '_' + new_id,
               name: this.name + '_' + new_id,
               value: 'test' 
             }); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-23T03:57:23.070

`.val()`不使用`attr('value')`。

# sql - 性能调优 PostgreSQL

> ID：779311
> 
> 赞同：15
> 
> 时间：2009-04-22T21:28:08.747
> 
> 标签：sql, postgresql, indexing, performance-testing

请记住，我是 sql/数据库领域的新手。

我每秒插入/更新数千个对象。这些对象正在以多个秒的间隔被主动查询。

我应该做哪些基本的事情来调整我的（postgres）数据库的性能？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-22T23:23:14.570

这是一个广泛的话题，所以这里有很多东西供您阅读。

*   [EXPLAIN 和 EXPLAIN ANALYZE](http://www.postgresql.org/docs/current/static/sql-explain.html)对于了解 db-engine 中发生的事情非常有用
*   确保相关列已编入索引
*   确保不为*不*相关的列编制索引（如果必须更新太多索引，插入/更新性能可能会下降）
*   确保您的 postgres.conf 已正确调整
*   了解 work_mem 是什么，以及它如何影响您的查询（主要用于较大的查询）
*   确保您的数据库已正确规范化
*   [VACUUM](http://www.postgresql.org/docs/current/static/sql-vacuum.html)用于清除旧数据
*   [ANALYZE](http://www.postgresql.org/docs/current/static/sql-analyze.html)更新统计（统计量的统计目标）
*   持久连接（您可以使用 pgpool 或 pgbouncer 之类的连接管理器）
*   了解查询是如何构造的（连接、子选择、游标）
*   缓存数据（即 memcached）是一种选择

当您用尽这些选项时：添加更多内存、更快的磁盘子系统等。硬件很重要，尤其是在更大的数据集上。

当然，阅读 postgres/databases 上的所有其他线程。:)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-22T21:42:21.240

首先，阅读官方手册的[性能提示](http://www.postgresql.org/docs/8.3/interactive/performance-tips.html)。

对所有查询运行[EXPLAIN](http://www.postgresql.org/docs/8.3/interactive/using-explain.html)并了解其输出将使您知道查询是否尽可能快，以及是否应该添加索引。

完成后，我建议您阅读手册的[服务器配置](http://www.postgresql.org/docs/8.3/interactive/runtime-config.html)部分。有许多选项可以微调以进一步提高性能。不过，请务必了解您正在设置的选项，因为如果设置不正确，它们很容易影响性能。

请记住，*每次*更改查询或选项时，都要进行**测试**和**基准**测试，以便了解每次更改的效果。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-23T10:30:08.587

实际上有一些简单的规则可以让你在大多数情况下获得足够的性能：

1.  指数是第一部分。主键会自动编制索引。我建议在所有外键上放置索引。进一步在所有经常查询的列上放置索引，如果在查询多列的表上有大量使用的查询，则将这些列上的索引放在一起。

2.  您的 postgresql 安装中的内存设置。将以下参数设置得更高：

.

```
shared_buffers, work_mem, maintenance_work_mem, temp_buffers 
```

如果它是专用数据库机器，您可以轻松地将其中的前 3 个设置为 ram 的一半（在具有共享缓冲区的 linux 下要小心，也许您必须调整 shmmax 参数），在任何其他情况下，这取决于多少 ram你想给postgresql。

[http://www.postgresql.org/docs/8.3/interactive/runtime-config-resource.html](http://www.postgresql.org/docs/8.3/interactive/runtime-config-resource.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-23T09:07:42.747

[http://wiki.postgresql.org/wiki/Performance_Optimization](http://wiki.postgresql.org/wiki/Performance_Optimization)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-22T21:42:08.043

我推荐的绝对最小值是**[EXPLAIN ANALYZE](http://www.postgresql.org/docs/8.2/static/sql-explain.html)**命令。它将始终显示子查询、连接等的细分，显示操作中实际消耗的时间量。它还会提醒您注意顺序扫描和其他令人讨厌的问题。

这是**最好**的开始方式。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-04-23T09:50:51.287

如果您信任您的文件系统，请将 fsync = off 在您的 posgresql.conf 中，否则每个 postgresql 操作将立即写入磁盘（使用 fsync 系统调用）。10 年来，我们在许多生产服务器上都关闭了这个选项，而且我们从未出现过数据损坏。

# java - 死了你线程池执行器

> ID：779318
> 
> 赞同：4
> 
> 时间：2009-04-22T21:30:21.957
> 
> 标签：java, concurrency

我有一个 java.util.concurrent.Execution 服务 - 一个单线程线程池执行器。我向它提交某些任务。如果任务抛出未经检查的异常，则线程会终止，但服务会确保生成新线程并在其中执行后续任务。但是我不想要这个功能，仍然想使用 threadPoolExecutor。即，如果任务抛出未经检查的异常，我希望服务shutDownNow()。

实现这一目标的最佳方法是什么？使用限制产生的线程数量的自定义线程工厂是否有意义？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-22T22:12:11.683

您可以创建一个 ThreadPoolExecutor 子类并覆盖 afterExecute 方法。该方法有一个可抛出的参数，如果出现异常，该参数将为非空。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T21:58:22.747

你可以把你的包裹`threadPoolExecutor`在一个`ExecutorCompletionService`. 然后不断地`take()`从中检索`Future`s。如果`future.get()`抛出`Exception`，则调用`threadpoolexecutor.shutdown()`。

# django - 你如何在 Django 中获得未来的帖子？

> ID：779329
> 
> 赞同：1
> 
> 时间：2009-04-22T21:33:50.433
> 
> 标签：django, django-flatpages

我只想在 Django 中做一个基本站点，而 flatpages 应用程序非常简单，但它不支持我需要的一些东西，即自定义字段和未来约会。那是将发布日期设置为将来的某个时间点，而不是立即发布。

在 Django 中获取未来帖子的最佳选择是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-23T07:29:43.417

这个问题的答案与您的问题“有什么比 Flatpages 更好吗？”的答案相同。

**[django-cms](http://django-cms.org/)**允许您以分层结构排列您的平面页面，并允许您设置未来的发布日期。

通过自定义字段，我假设您的意思是用户定义的字段？如果是这样，那么您必须自己在 django-cms 之上实现它。

# layout - 您是将条件代码放在新行上还是有时？

> ID：779332
> 
> 赞同：1
> 
> 时间：2009-04-22T21:34:43.630
> 
> 标签：layout

我通常会按照以下方式编写条件代码

```
if (number==1) 
    name="a";
if (number==2)
    name="b"; 
```

不管多短，尽管我发现有相当一部分人在写作

```
if (number==1) name ="a";
if (number==2) name ="b"... 
```

对我来说，这似乎不一致，实际上使代码看起来更混乱。

做这个的最好方式是什么？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-22T21:36:37.337

编码风格是争论最激烈的话题之一（通常带有宗教狂热）。关于这个问题有很多资源，我会尝试找到链接。

无论哪种方式，我都喜欢用花括号包裹每一个这样的条件体；我的经验是，如果添加或省略线条，它们会使正文更明显，并降低出错的风险。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-22T21:36:40.427

我更喜欢你的第一个选择，但更好的是：

```
if (number == 1) { 
    name = "a";
}
if (number == 2) {
    name = "b";
} 
```

在简单视图中稍长一点，但是当 if 大于一行时我不必添加括号（我认为经常如此）

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-22T21:38:24.103

我总是写我的条件相同：

```
if (number == 1)
{
    name = "a";
}
else if (number == 2)
{
    name = "b";
} 
```

它易于阅读且一致。与具有多个语句的 if 语句一致，等等...

* * *

### 编辑

为了对此进行扩展，我尝试遵循以下规则：

> 每条线都做一件事。

也就是说，每一行都应该执行一个语句（并且范围应该很容易看到）。所以我不喜欢：

```
if (number==1) name ="a"; 
```

因为在一行中发生了两件事，这使得阅读和调试比应有的困难。所以我会搬到：

```
if (number==1)
    name ="a"; 
```

但这存在与多语句if不一致的问题。这就是为什么（正如其他人所说）最好在事物周围放置括号：

```
if (number==1)
{
    name ="a";
} 
```

我更喜欢它自己的行上的“{”的原因是，当我扫描代码时，我可以快速识别范围的开始和结束位置。它也遵循一个语句规则，因为有 'if' 和 '{' 会执行一个 if 语句*并*开始一个新的范围。

我不认为“它节省了垂直空格”是跳过可读性和良好格式的充分理由（两个 {} 在同一列上 == 性感）。这是因为考虑到当今显示器的分辨率，您无需费力地查看代码。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-22T22:01:29.290

我坚信，如果您要将语句放在条件之后的一行，请将其包裹在大括号中。举一个@Daniel观点的具体例子，如果我正在调试这个：

```
如果（数字==1）
    名称=“一”；
如果（数字==2）
    名称="b";

```

...我会非常想这样做：

```
如果（数字==1）
    print "命中第一个条件\n";
    名称=“一”；
如果（数字==2）
    print "不，打第二个条件\n";
    名称="b";

```

......随之而来的是运行时的欢闹。

我偶尔会将单行命令与“if”语句放在同一行，如果它是显而易见且简单的，例如“if (inputVar == null) return;”。但作为一般规则，如果我要缩进单个命令（而不是跨越多行的单个大命令）*，我总是希望它们用大括号括起来。这样我就少了麻烦。

* -- 好的，从技术上讲，那些单命令 if 语句确实是跨多行的单个命令。但是，如果我不小心在多行方法调用的中间插入了一个命令，编译器会在我弄糊涂之前停止工作。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-22T22:32:29.497

就个人而言，我喜欢在单行上布置条件，IF 和 ONLY IF，其中有一组我想轻松比较。

```
if      (iTerm >= Ps.missed_runs)   iTerm -= Ps.missed_runs;
else if (iTerm <= Ps.missed_runs)   iTerm += Ps.missed_runs;
else                                iTerm  = 0; 
```

在这里我可以清楚地看到什么是相同的，什么是不同的。与此比较：

```
if (iTerm >= Ps.missed_runs) {
    iTerm -= Ps.missed_runs;
} else if (iTerm >= Ps.missed_runs) {
    iTerm += Ps.missed_runs;
} else {
    iTerm  = 0;
} 
```

现在比较彼此远离，并且没有与列对齐。眼睛更难发现虫子。

PS你注意到第二个代码示例中的故意错误了吗？

雨果

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-22T21:38:39.643

我更喜欢：

```
if (number==1) { 
    name="a";
}
if (number==2) name="b"; 
```

每当我使用括号时，我都会开始换行。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-22T21:40:20.310

我正在使用以下样式。

```
if (number == 1) 
{
   name = "a";
}
else if (number == 2)
{
   name = "b";
} 
```

如果您插入新行，这可以避免错误。

```
if (number == 1) 
   DoSomething();
   name = "a"; 
```

现在`name = "a";`不再是有条件的。目前我正在考虑更改为以下样式。

```
if (number == 1) {
   name = "a";
} 
```

这样，文本结构更紧密地反映了控制结构，但我仍在考虑这一点。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-22T23:35:21.233

Python 几乎迫使你这样做，所以是的 - 条件代码总是换行。

```
if number == 1:
    name = "a"
elif number == 2:
    name = "b"
else:
    raise ValueError() 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-22T23:56:43.087

我几乎总是把它放在不同的线上，但我有点灵活。如果由于一行中的许多语句非常相似，代码在同一行上的可读性更高，我可能会在一行上执行以帮助演示相似性，但我会寻找一种消除相似性的方法通过重构代替。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-05-05T04:11:48.443

将条件放在一行上时，我使用单行格式：

```
toggled = (on == true ) ? true : false; 
```

但是，当您有多种情况时，这不起作用，我可能会使用 switch 语句：

```
switch ( number ) {
  case 1: a;
   break;

  case 2: b;
   break;
    a;
} 
```

对于您的具体示例，我会这样做：

```
if ( number == 1 ) {
  name = "a";
} else if ( number == 2 ) {
  name = "b";
} 
```

我喜欢值和括号之间的额外空间，因为它有助于通过突出显示它们来保持一切清洁。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-04-22T21:36:39.147

我做同样的事情（在java中）并且我总是添加花括号，即使它只有一行，它根本没有工作并且消除了一个经典的错误来源。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-04-22T21:37:40.220

当然，这纯粹是风格问题。一般来说，额外的空间是舒适的。但是，有时将这些内容浓缩下来似乎是合适的。通常，我只会在变量赋值时这样做，而不是其他任何事情。

我总是喜欢让代码*看起来*像它应该的那样，这意味着单个 if 语句应该看起来总是一样的。我通常什至戴着大括号离开，所以很清楚是什么。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-04-22T21:37:41.937

我只使用第一个选项。更容易阅读，也更容易在条件中设置断点。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-22T23:14:40.627

Microsoft C# 最佳实践声明将大括号用于单行条件。我个人觉得这更具可读性。在适合语言的情况下，我也倾向于在其他语言中养成这种习惯。

```
if (myVar == 0)
{
    return false;
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-04-22T21:39:01.293

它在代码可读性方面的差异可以忽略不计，随心所欲。编写好的代码，让您的 IDE 弄清楚它应该是什么样子。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-04-22T23:45:04.020

好的，我需要一些反对票。这真的很难看，但我认为这是有充分理由的：

```
 if (false){}
else if (variable == aValue){
  ... code ...
}
else if (variable == anotherValue){
  ... code ...
}
... more cases ...
else {
  ... code ...
} 
```

原因是没有分支（除了`else`）与其他分支不同，因此很容易重新排序它们或在开头插入一个新分支。

事实上，如果我从另一个程序*生成*这段代码，它确实简化了生成器。

# .net - 如何使用 msbuild 复制任务指定文件夹结构

> ID：779334
> 
> 赞同：23
> 
> 时间：2009-04-22T21:35:15.843
> 
> 标签：.net, msbuild

我有以下 msbuild 脚本，它将整个 DeploymentDirectory 复制到 VersionSpecificDirectory。这是片段：

```
<CreateItem Include="$(DeploymentDirectory)/**/*.*" >
  <Output ItemName="AllDeploymentFilesToCopy" TaskParameter="Include" />
</CreateItem>
<Copy SourceFiles="@(AllDeploymentFilesToCopy)"
      DestinationFiles="@(AllDeploymentFilesToCopy->'$(VersionSpecificDirectory)\%(RecursiveDir)%(Filename)%(Extension)')" /> 
```

该脚本用于复制 DeploymentDirectory 中的所有文件而不是目录本身？

更新：我尝试将斜线的方向更改为反斜线，但问题仍然存在。

另一个更新：这与 msbuild 代码无关。我的问题中的代码和答案中的代码都可以很好地执行此操作。

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-04-23T01:37:12.407

试试这个：

```
<ItemGroup>
    <MySourceFiles Include="c:\MySourceTree\**\*.*"/>
</ItemGroup>

<Target Name="CopyFiles">
    <Copy
        SourceFiles="@(MySourceFiles)"
        DestinationFiles="@(MySourceFiles->'c:\MyDestinationTree\%(RecursiveDir)%(Filename)%(Extension)')"
    />
</Target> 
```

来自[MSDN](http://msdn.microsoft.com/en-us/library/3e54c37h.aspx)。

# sql-server - Ident_Current 在 SQL 2005 上返回 NULL

> ID：779337
> 
> 赞同：1
> 
> 时间：2009-04-22T21:36:32.877
> 
> 标签：sql-server

该`ident_Current`函数在 sql server 2005 上返回 null。查看一些文档后，它看起来需要 db_owner 权限才能拥有可见性元数据，但这仅在 sql server 2008 的文档中指定。

有人可以确认它与 sql server 2005 相同吗？我找不到任何文件来确认这一点。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-22T21:42:28.727

[`IDENT_CURRENT()`](http://msdn.microsoft.com/en-us/library/ms175098.aspx)如果函数在无权选择表或视图的最后一个 id 的帐户下运行，则将返回 null。

使用时要记住的另一件事[`IDENT_CURRENT()`](http://msdn.microsoft.com/en-us/library/ms175098.aspx)是返回的 id 可以用于任何范围和任何会话；这可能是您有意为之，但我通常[`SCOPE_IDENTITY()`](http://msdn.microsoft.com/en-us/library/ms190315.aspx)在需要获取最后一个操作记录的 id 时使用

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T22:37:58.720

拉斯是对的。我想指出，我们有一个开发人员使用 Ident_current 来获取最后一个身份，他的 proc 与数据导入同时运行，他得到了导入正在运行的记录的身份，这弄乱了数据库中的数据完整性因为子表现在与错误的记录相关。查找和修复也是一个真正的问题。所以使用 ident_current 时要非常小心。在大多数情况下，scope_identity() 就是您想要的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T20:09:52.197

要使用 ident_current 或任何其他函数来获取最后一个身份，用户需要具有读取元数据的权限，因此它需要该数据库上的 db_onwer。

# c++ - 真实C/C++代码优秀例子的建议

> ID：779338
> 
> 赞同：15
> 
> 时间：2009-04-22T21:36:35.777
> 
> 标签：c++, c

我想学习一些好的 C/C++ 代码。代码应该：

1.  风格和结构良好，呈现最佳实践
2.  成为现实生活中的程序（不是示例或玩具）
3.  不太大，所以分析它不需要很长时间
4.  Windows 和/或 Unix

我知道那里有 1000 多个开源项目。但我想听听你的建议。

我是 Java 程序员，我很好奇 c/c++ 中好的项目的结构（文件）、类/函数/文件的粒度、文档/注释、构建工具等。

欢迎提出多个建议，例如这是很好的 windows 示例，即很好的纯 C 等。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-22T21:39:53.227

我会特别提到[memcached。](http://www.danga.com/memcached/)这是一个很好的例子，代码很短，可读性很明确，目的很明确。

其次，我会推荐[Apache Web 服务器](http://httpd.apache.org/)。这是一个运行良好的开源项目，您将从中学到很多东西，包括语言、一般设计实践和网络/线程。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-23T09:51:33.093

我会投票给 nginx：[http](http://sysoev.ru/en/) ://sysoev.ru/en/作为一个非常好的 C 编程风格的例子

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-22T21:52:57.923

[Samba](http://www.samba.org)：一个大型、跨平台（基于 POSIX）、纯 C、非常流行的网络服务器。

Samba 有很好的[开发者文档](http://www.samba.org/samba/devel/)，而且代码库本身组织*得*很好；深入到代码中的几乎任何位置来回答我关于其内部工作的问题或追踪错误时，我都没有遇到任何问题。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-23T09:46:51.590

[谷歌的 Chromium](http://dev.chromium.org/)相当庞大，但您无需分析所有内容即可欣赏其干净、经过同​​行评审的结构。此外，这是一个很好的开发人员环境部署的好例子。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-22T22:03:02.640

我发现 Lua 的实现是相当不错的 C 源代码。但是作为示例项目，语言有点奇怪。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-23T09:13:30.407

Diomidis Spinellis 在他的著作“代码阅读：开源视角”中提出了一些建议，Addison Wesley，2003。ISBN 0-201-79940-5。

也许这本书对你有用。

网址[http://www.spinellis.gr/codereading/](http://www.spinellis.gr/codereading/)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-22T21:50:01.033

这是 relayd 的主[文件](http://www.openbsd.org/cgi-bin/cvsweb/src/usr.sbin/relayd/)[，](http://www.openbsd.org/cgi-bin/cvsweb/src/usr.sbin/relayd/relayd.c?rev=1.83;content-type=text%2Fplain)它是一个处理负载平衡和故障转移的守护进程。它写得很好，功能齐全，干净的 C 代码。它足够大，可以让您感受到“真实世界”的程序，但又不会太大，以至于您无法通过一些工作来了解它。非常适合安全、编写良好的网络代码、守护程序等。

除了谦虚之外，还有一个我帮助过的用于 X的小[平铺窗口管理器。](http://www.peereboom.us/scrotwm/scrotwm.c)它很小，但它是一个真正的 wm，并且上面的其他编码器具有很高的标准（并坚持我！）......非常适合学习基本的 X 东西。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-23T19:20:33.447

[K&R](http://en.wikipedia.org/wiki/The_C_Programming_Language_(book))有很多真实程序的好例子。例如，在第二版的第 115 页上，有两个简单的`echo`命令实现。从那里开始，看看随着时间的推移如何执行命令可能会很有趣。例如，[GNU coreutils](http://git.savannah.gnu.org/cgit/coreutils.git/tree/src/echo.c)源代码中有一个版本。从[BSD](http://en.wikipedia.org/wiki/BSD)派生的版本可以在[BusyBox](http://sources.busybox.net/index.py/trunk/busybox/coreutils/echo.c)源代码中找到。

看看新版本与教科书示例的比较可能会很有趣。为什么在现实生活中使用的程序更长？有多少代码与新特性有关，又有多少与处理边缘情况有关？你将如何用 Java 编写相同的代码？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-23T18:52:27.307

至于 C++，我会向您推荐[Qt 库](http://www.qtsoftware.com/downloads)源代码和[KDE 的源代码](http://www.kde.org/)及其程序。

它是编写精美的代码，也是您应该用 C++ 编程的方式。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-25T05:35:45.910

更多 C++ 建议见：[“现代 C++”示例？](https://stackoverflow.com/questions/534311/examples-of-modern-c-in-action)

# linux - Vim 在其他程序上的移动

> ID：779348
> 
> 赞同：35
> 
> 时间：2009-04-22T21:38:57.287
> 
> 标签：linux, vim, user-interface, keyboard-shortcuts

我正在学习 Vim，随之而来的是在其他所有程序上使用 'hjkl' 和朋友的冲动，包括像浏览器这样的鼠标操作程序。

如何使用这些键盘快捷键或类似的东西？

我正在使用 Linux。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-04-22T22:01:38.073

从我的头顶上...

*   火狐的 Vimperator。
*   真棒，WMII，Xmonad 或 ion3 窗口管理器。
*   Evince 支持 hjkl。
*   vifm 文件管理器
*   readline 有 vi 键绑定，这使它们适用于许多终端应用程序
*   xzgv 图像查看器

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-22T21:43:52.623

Gmail 和其他几个 Google 应用程序本身就支持类似 Vi 的动作。

此外，您可能想尝试[Vimperator](http://vimperator.org/trac/wiki/Vimperator)，最肯定的是 Nethack！

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-22T21:54:34.300

[试试](http://freshmeat.net/projects/scrotwm)scrotwm 。它是一个平铺窗口管理器，默认情况下具有类似 vim 的绑定，由使用 vim 的程序员编写！

[Firefox 的vimperator](http://vimperator.org/trac/wiki/Vimperator)让我的生活变得更加轻松。

对于类似 Bourne 的 shell（ksh、bash、...），请尝试`set -o vi`让您的命令行使用 vi 键。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-12-31T00:03:07.773

*带有vi*移动键绑定的文件管理器等等：[ranger](http://ranger.nongnu.org/)。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-23T06:02:27.903

如果您使用[Eclipse](http://www.eclipse.org/)，那么[viPlugin](http://www.viplugin.com/viplugin/)是最好的类似 vi 的编辑器。

我总是在我的 /etc/inputrc 中添加以下两行（如果我没有 root 访问权限，则为 ~/.inputrc）：

```
set editing-mode vi
set keymap vi 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-04-27T23:59:30.560

其他：

*   [ViEmu](http://www.viemu.com/) : 适用于 Visual Studio、Word、Outlook 和 SQL Server 的插件
*   [Komodo Edit](http://www.activestate.com/komodo_edit/) : 开发者的编辑器
*   [AbiWord](http://www.abisource.com/)：文字处理器
*   [Editra](http://editra.org/) : 开发者的编辑器
*   [VimPlugin](http://vimplugin.org/) : 将 Vim 插入 Eclipse。我无法让它在 Windows 或 Mac OS X 下工作。
*   [Eclim](http://eclim.sourceforge.net/) : 另一个用于 Eclipse 的 Vim 插件。
*   [Viper](http://www.emacswiki.org/emacs/ViperMode)：Emacs 的旧 vi 模拟器
*   [Evil](http://www.emacswiki.org/emacs/Evil) : Emacs 的最新 Vim 模拟器
*   [IdeaVim ：用于](http://plugins.jetbrains.com/plugin/164)[IntelliJ](https://en.wikipedia.org/wiki/IntelliJ_IDEA)系列编辑器、[RubyMine](https://en.wikipedia.org/wiki/JetBrains#RubyMine)、[PyCharm](https://en.wikipedia.org/wiki/PyCharm)等的 Vim 模拟器。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2013-03-27T20:16:09.430

[Zathura](http://pwmt.org/projects/zathura/)是一个不错的小型 pdf 阅读器，并带有内置的类似 vim 的命令。感觉就像您在 vim 中打开了您的 pdf 文档。（例如：“：”按钮会显示相同的提示。）

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-04-29T21:01:22.343

Viper 可以工作，但如果你习惯了 Vim，它缺少很多键绑定，最终会把你弄得一团糟。Netbeans还有[jvi](http://jvi.sourceforge.net/)，我发现它比 Eclipse 插件更完整。凯特最近还添加了[Vi 仿真模式](http://hamberg.no/erlend/2008/11/24/the-vi-input-mode-for-kate-is-done/)

我也认为[xmonad](http://www.xmonad.org/)优于 Awesome、Ion 等。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2010-08-18T12:59:20.330

[Okular](http://okular.kde.org/)，KDE 4 的 PDF 阅读器支持 HJKL。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2010-07-13T08:56:06.667

[谷歌浏览器的Vimium](https://chrome.google.com/extensions/detail/dbepggeogbaibhgnhhndojpepiihcmeb)。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2012-10-26T15:35:26.733

用于 Firefox 的轻量级 (30k zpi) [FimFx](https://addons.mozilla.org/en-US/firefox/addon/vimfx/) - 比 Vimperator 做得更少，但这是有充分理由的。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2015-02-26T09:02:46.220

查看：

*   [dwb](http://portix.bitbucket.org/dwb/) — 网络浏览器
*   [ranger](http://nongnu.org/ranger/) — 基于终端的文件管理器
*   [Zathura](https://pwmt.org/projects/zathura/) — PDF 查看器
*   [Vimium](https://chrome.google.com/webstore/detail/vimium/dbepggeogbaibhgnhhndojpepiihcmeb) — Chrome(ium) 的 vim 键绑定扩展
*   [Evil](http://www.emacswiki.org/emacs/Evil) — 著名的 Emacs 插件，它把 Emacs 变成 Vim，如果你觉得有必要这样做的话
*   [i3](http://i3wm.org/) , [xmonad](http://xmonad.org/) , [dwm](http://dwm.suckless.org/) — 由键盘控制的平铺窗口管理器

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2012-06-28T08:50:36.407

对于 xpdf，将这些添加到您的`~/.xpdfrc`：

```
bind h any scrollLeft(35)
bind l any scrollRight(35)
bind k any scrollUpPrevPage(35)
bind j any scrollDownNextPage(35)

bind ctrl-f any scrollDownNextPage(320)
bind ctrl-b any scrollUpPrevPage(320)

bind ctrl-d any scrollDownNextPage(160)
bind ctrl-u any scrollUpPrevPage(160)

bind g      any gotoPage(1)
bind G  any gotoLastPage
bind /          any find 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2012-08-03T17:11:34.207

您可以使用 xmodmap 使 win+hjkl 用作箭头键。
创建一个名为 Xmodmap 的文件。添加以下内容：

```
keycode 133 = Mode_switch
keysym j = j J Down
keysym l = l L Right
keysym h = h H Left
keysym k = k K Up 
```

使用 xmodmap Xmodmap 加载它
注意：运行 xev 以找出 win 键的键码。133只是一个例子。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2017-03-13T09:24:22.333

没有提到Qutebrowser，它比插件好得多。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-04-22T21:50:02.360

我在 Linux 上使用[Ion](http://modeemi.fi/~tuomov/ion/)作为窗口管理器有一段时间了。如果我没记错的话，它使用类似于 Vim 的键绑定在窗口之间移动。它不会使您的应用程序支持 hjkl 移动，但窗口管理器是一个开始的地方。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-04-22T22:20:34.753

除了已经提到的之外，您还可以将这些键绑定到左...等等（使用 ahk）。我还注意到一些网络应用程序使用该移动键（gmail、greader、....）

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-04-23T19:36:40.507

试试 keynav，使用键盘控制鼠标指针。

[http://www.semicomplete.com/projects/keynav/](http://www.semicomplete.com/projects/keynav/)

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-12-11T17:14:47.890

VisVim for Visual Studio
CubicleVim for Outlook

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2010-07-12T05:10:02.587

如果你用mpd听音乐，那么我强烈推荐[PIM](http://pms.sourceforge.net)

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2010-07-18T16:31:44.723

`Google Reader`尊重`jk`键绑定。我相信他们支持的还有更多 - 随时编辑我的答案。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2012-06-28T08:47:37.280

[chrome 的快捷方式管理器](https://chrome.google.com/webstore/detail/mgjjeipcdnnjhgodgjpfkffcejoljijf)扩展。

你可以使用这样的东西来配置基本的 vim 移动键：

```
// ==UserScript==
// @ShortcutManager
// @name Scroll up by 25 pixels
// @key k
// @include *
// @exclude https://*mail.google.com/*
// @execute ScrollUp(["25"])
// ==/UserScript== 
```

其他有用的片段：

```
// @key g
// @execute ScrollToTop([])

// @key Shift+g
// @execute ScrollToBottom([]) 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2014-05-08T12:41:48.977

Mutt - 邮件客户端 - 可以配置为移动 hjkl，我配置了更多的 vim 键。需要一些时间来配置，因为它与其他邮件客户端有点不同。Mutt 不是 Muttator，是一个终端 GUI 应用程序。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2018-06-06T01:13:32.833

cVim for chrome 很棒。我目前正在使用它。 [https://github.com/1995eaton/chromium-vim](https://github.com/1995eaton/chromium-vim)

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2013-12-23T15:51:39.107

**[如何在 SuperUser 上的 Adob​​e Reader 中获取 Vim 键绑定](https://superuser.com/questions/40909/vim-like-navigation-on-adobe-acrobat-reader/)**

（我对这个问题的回答是一个 AutoHotKey 脚本，它甚至可以使用 、 和 为您提供适当的搜索功能，`/`但我承认我还没有验证到 Linux 或 Mac 的端口）`n``N`

# java - 反射和多维数组

> ID：779354
> 
> 赞同：4
> 
> 时间：2009-04-22T21:40:06.050
> 
> 标签：java, reflection

我有在输入对象上使用反射并对存储在对象中的数据进行一些处理的代码。输入对象可以是 String 或 int 或 double 等任何东西，有时它可以是多维数组。我知道如何对二维数组执行此操作，但我更喜欢适用于任何给定维度数组的东西。完成此任务的任何指导都会有所帮助。谢谢，

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-22T21:48:24.860

听起来您需要递归或循环，或两者兼而有之。

```
void getStuffFromArray(Object obj) {
    // assuming we already know obj.getClass().isArray() == true
    Class<?> componentType = obj.getClass().getComponentType();
    int size = Array.getLength(obj);
    for (int i = 0; i < size; i++) {
        Object value = Array.get(obj, i);
        if (value.getClass().isArray()) {
            getStuffFromArray(value);
        } else {
            // not an array; process it
        }
    }
} 
```

# c# - 如何使用后期绑定获取excel实例？

> ID：779363
> 
> 赞同：18
> 
> 时间：2009-04-22T21:42:03.237
> 
> 标签：c#, excel

我正在使用

```
[DllImport("Oleacc.dll")]
static extern int AccessibleObjectFromWindow(
int hwnd, 
uint dwObjectID, 
byte[] riid,
ref Excel.Window ptr);
```

使用他的句柄获取 Excel 实例，我从 excel 实例的进程 ID 中获取。

这是我使用这些功能时的样子

```
const uint OBJID_NATIVEOM = 0xFFFFFFF0;
Guid IID_IDispatch = new Guid("{00020400-0000-0000-C000-000000000046}");
Excel.Window ptr = null;  
int hr = AccessibleObjectFromWindow(hwndChild, OBJID_NATIVEOM, 
          IID_IDispatch.ToByteArray(), ref ptr);

Object objApp = ptr.Application;
```

这种和平的代码效果很好，但唯一的问题是我必须添加对 Office 2003 主互操作程序集的引用。

如您所见，函数中的最后一个参数是我需要添加对 Pias 的引用的原因，所以我的问题是是否有办法避免使用互操作程序集，我尝试过后期绑定，但也许我一直做错了，因为我无法让它发挥作用。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-04-22T23:45:09.510

第一：C# 中的后期绑定非常痛苦。最好避免它。第二：C# 中的后期绑定很痛苦。使用 PIA！

好的，话虽如此，为了使用后期绑定，您需要执行以下操作：删除对 Office 2003 PIA 的引用，而是添加所需接口的 COM 导入`AccessibleObjectFromWindow`，即`Excel.Window`接口：

```
[Guid("00020893-0000-0000-C000-000000000046")]
[InterfaceType(ComInterfaceType.InterfaceIsIDispatch)]
public interface ExcelWindow
{
} 
```

您可以使用[Reflector](http://www.red-gate.com/products/reflector/)`Excel.Window`之类的工具检索此界面（或者在对 Excel PIA 的引用仍在您的项目中时，只需在类型上按 F12 ）

完成后，您必须修改 的签名`AccessibleObjectFromWindow`以匹配导入的`ExcelWindow`接口：

```
[DllImport("Oleacc.dll")]
static extern int AccessibleObjectFromWindow(int hwnd, uint dwObjectID, byte[] riid, out ExcelWindow ptr); 
```

最后，必须使用反射`Excel.Application`从对象中获取`ExcelWindow`对象：

```
object xlApp = ptr.GetType().InvokeMember("Application", BindingFlags.GetProperty, null, ptr, null); 
```

如果您的代码要对 Excel 的 OM 进行大量调用，则在`Option Strict`关闭的情况下使用 VB 可能会更容易（或等待 C#4.0 ;-)。或者，如果您不想从 C# 进行更改，最好为后期绑定调用创建一个包装类。

* * *

**完整样本**

这是一个功能齐全的示例（基于 Andrew Whitechapel 的[文章](http://blogs.msdn.com/b/andreww/archive/2008/11/30/starting-or-connecting-to-office-apps.aspx)）：

```
using System;
using System.Globalization;
using System.Reflection;
using System.Runtime.InteropServices;
using System.Text;

namespace ExcelLateBindingSample
{
    /// <summary>
    /// Interface definition for Excel.Window interface
    /// </summary>
    [Guid("00020893-0000-0000-C000-000000000046")]
    [InterfaceType(ComInterfaceType.InterfaceIsIDispatch)]
    public interface ExcelWindow
    {
    }

    /// <summary>
    /// This class is needed as a workaround to http://support.microsoft.com/default.aspx?scid=kb;en-us;320369
    /// Excel automation will fail with the follwoing error on systems with non-English regional settings:
    /// "Old format or invalid type library. (Exception from HRESULT: 0x80028018 (TYPE_E_INVDATAREAD))" 
    /// </summary>
    class UILanguageHelper : IDisposable
    {
        private CultureInfo _currentCulture;

        public UILanguageHelper()
        {
            // save current culture and set culture to en-US 
            _currentCulture = System.Threading.Thread.CurrentThread.CurrentCulture;
            System.Threading.Thread.CurrentThread.CurrentCulture = new CultureInfo("en-US");
        }

        public void Dispose()
        {
            // reset to original culture 
            System.Threading.Thread.CurrentThread.CurrentCulture = _currentCulture;
        }
    }

    class Program
    {
        [DllImport("user32.dll", SetLastError = true)]
        static extern IntPtr FindWindow(string lpClassName, string lpWindowName);

        [DllImport("Oleacc.dll")]
        static extern int AccessibleObjectFromWindow(int hwnd, uint dwObjectID, byte[] riid, out ExcelWindow ptr);

        public delegate bool EnumChildCallback(int hwnd, ref int lParam);

        [DllImport("User32.dll")]
        public static extern bool EnumChildWindows(int hWndParent, EnumChildCallback lpEnumFunc, ref int lParam);

        [DllImport("User32.dll")]
        public static extern int GetClassName(int hWnd, StringBuilder lpClassName, int nMaxCount);

        public static bool EnumChildProc(int hwndChild, ref int lParam)
        {
            StringBuilder buf = new StringBuilder(128);
            GetClassName(hwndChild, buf, 128);
            if (buf.ToString() == "EXCEL7")
            {
                lParam = hwndChild;
                return false;
            }
            return true;
        }

        static void Main(string[] args)
        {
            // Use the window class name ("XLMAIN") to retrieve a handle to Excel's main window.
            // Alternatively you can get the window handle via the process id:
            // int hwnd = (int)Process.GetProcessById(excelPid).MainWindowHandle;
            //
            int hwnd = (int)FindWindow("XLMAIN", null); 

            if (hwnd != 0)
            {
                int hwndChild = 0;

                // Search the accessible child window (it has class name "EXCEL7") 
                EnumChildCallback cb = new EnumChildCallback(EnumChildProc);
                EnumChildWindows(hwnd, cb, ref hwndChild);

                if (hwndChild != 0)
                {
                    // We call AccessibleObjectFromWindow, passing the constant OBJID_NATIVEOM (defined in winuser.h) 
                    // and IID_IDispatch - we want an IDispatch pointer into the native object model.
                    //
                    const uint OBJID_NATIVEOM = 0xFFFFFFF0;
                    Guid IID_IDispatch = new Guid("{00020400-0000-0000-C000-000000000046}");
                    ExcelWindow ptr;

                    int hr = AccessibleObjectFromWindow(hwndChild, OBJID_NATIVEOM, IID_IDispatch.ToByteArray(), out ptr);

                    if (hr >= 0)
                    {
                        // We successfully got a native OM IDispatch pointer, we can QI this for
                        // an Excel Application using reflection (and using UILanguageHelper to 
                        // fix http://support.microsoft.com/default.aspx?scid=kb;en-us;320369)
                        //
                        using (UILanguageHelper fix = new UILanguageHelper())
                        {
                            object xlApp = ptr.GetType().InvokeMember("Application", BindingFlags.GetProperty, null, ptr, null);

                            object version = xlApp.GetType().InvokeMember("Version", BindingFlags.GetField | BindingFlags.InvokeMethod | BindingFlags.GetProperty, null, xlApp, null);
                            Console.WriteLine(string.Format("Excel version is: {0}", version));
                        }
                    }
                }
            }
        }
    }
} 
```

这将是在 VB 中没有 PIA 的相同解决方案（请注意，OM 调用更具可读性；但是，访问 OM 的代码将是相同的）：

```
Option Strict Off

Imports System.Globalization
Imports System.Runtime.InteropServices
Imports System.Text

Module ExcelLateBindingSample

    ''' <summary>
    ''' Interface definition for Excel.Window interface
    ''' </summary>
    <Guid("00020893-0000-0000-C000-000000000046"), _
    InterfaceType(ComInterfaceType.InterfaceIsIDispatch)> _
    Public Interface ExcelWindow
    End Interface

    ''' <summary>
    ''' This class is needed as a workaround to http://support.microsoft.com/default.aspx?scid=kb;en-us;320369
    ''' Excel automation will fail with the follwoing error on systems with non-English regional settings:
    ''' "Old format or invalid type library. (Exception from HRESULT: 0x80028018 (TYPE_E_INVDATAREAD))" 
    ''' </summary>
    Class UILanguageHelper
        Implements IDisposable

        Private _currentCulture As CultureInfo

        Public Sub New()
            ' save current culture and set culture to en-US 
            _currentCulture = System.Threading.Thread.CurrentThread.CurrentCulture
            System.Threading.Thread.CurrentThread.CurrentCulture = New CultureInfo("en-US")
        End Sub

        Public Sub Dispose() Implements System.IDisposable.Dispose
            'reset to original culture 
            System.Threading.Thread.CurrentThread.CurrentCulture = _currentCulture
        End Sub

    End Class

    <DllImport("user32.dll", SetLastError:=True, CharSet:=CharSet.Auto)> _
    Private Function FindWindow(ByVal lpClassName As String, ByVal lpWindowName As String) As IntPtr
    End Function

    <DllImport("Oleacc.dll")> _
    Private Function AccessibleObjectFromWindow(ByVal hwnd As Integer, ByVal dwObjectID As UInt32, ByVal riid() As Byte, ByRef ptr As ExcelWindow) As Integer
    End Function

    Public Delegate Function EnumChildCallback(ByVal hwnd As Integer, ByRef lParam As Integer) As Boolean

    <DllImport("User32.dll")> _
    Public Function EnumChildWindows(ByVal hWndParent As Integer, ByVal lpEnumFunc As EnumChildCallback, ByRef lParam As Integer) As Boolean
    End Function

    <DllImport("User32.dll")> _
    Public Function GetClassName(ByVal hWnd As Integer, ByVal lpClassName As StringBuilder, ByVal nMaxCount As Integer) As Integer
    End Function

    Public Function EnumChildProc(ByVal hwndChild As Integer, ByRef lParam As Integer) As Boolean
        Dim buf As New StringBuilder(128)
        GetClassName(hwndChild, buf, 128)
        If buf.ToString() = "EXCEL7" Then
            lParam = hwndChild
            Return False
        End If
        Return True
    End Function

    Sub Main()
        ' Use the window class name ("XLMAIN") to retrieve a handle to Excel's main window.
        ' Alternatively you can get the window handle via the process id:
        ' Dim hwnd As Integer = CInt(Process.GetProcessById(excelPid).MainWindowHandle);
        '
        Dim hwnd As Integer = CInt(FindWindow("XLMAIN", Nothing))

        If hwnd <> 0 Then
            Dim hwndChild As Integer = 0

            ' Search the accessible child window (it has class name "EXCEL7") 
            Dim cb As New EnumChildCallback(AddressOf EnumChildProc)
            EnumChildWindows(hwnd, cb, hwndChild)

            If hwndChild <> 0 Then
                ' We call AccessibleObjectFromWindow, passing the constant OBJID_NATIVEOM (defined in winuser.h) 
                ' and IID_IDispatch - we want an IDispatch pointer into the native object model.
                '
                Const OBJID_NATIVEOM As UInteger = &HFFFFFFF0&
                Dim IID_IDispatch As New Guid("{00020400-0000-0000-C000-000000000046}")
                Dim ptr As ExcelWindow

                Dim hr As Integer = AccessibleObjectFromWindow(hwndChild, OBJID_NATIVEOM, IID_IDispatch.ToByteArray(), ptr)

                If hr >= 0 Then
                    ' We successfully got a native OM IDispatch pointer, we can QI this for
                    ' an Excel Application using reflection (and using UILanguageHelper to 
                    ' fix http://support.microsoft.com/default.aspx?scid=kb;en-us;320369)
                    '
                    Using fixCrash As New UILanguageHelper
                        Console.WriteLine(String.Format("Excel version is: {0}", ptr.Application.Version))
                    End Using
                End If
            End If
        End If

    End Sub

End Module 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-01-21T16:43:24.937

请改用 AccessibleObjectFromWindow 的这个定义：

```
 [DllImport("Oleacc.dll")]
    private static extern int AccessibleObjectFromWindow(
        int hwnd, uint dwObjectID,
        byte[] riid,
        [MarshalAs(UnmanagedType.IUnknown)]ref object ptr); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-02-21T22:24:47.730

第一个答案中的代码就像一个魅力。Word 也是如此，底部还有一些 .NET 4.0 动态操作。

```
// http://stackoverflow.com/questions/779363/how-to-use-use-late-binding-to-get-excel-instance
// ReSharper disable InconsistentNaming

using System;
using System.Runtime.InteropServices;
using System.Globalization;
using System.Reflection;
using System.Text;

namespace LateBindingWord {
    /// <summary> Interface definition for Word.Window interface </summary>
    [Guid("00020962-0000-0000-C000-000000000046")]
    [InterfaceType(ComInterfaceType.InterfaceIsIDispatch)]
    public interface IWordWindow {
    }

    /// <summary>
    /// This class is needed as a workaround to http://support.microsoft.com/default.aspx?scid=kb;en-us;320369
    /// Excel automation will fail with the follwoing error on systems with non-English regional settings:
    /// "Old format or invalid type library. (Exception from HRESULT: 0x80028018 (TYPE_E_INVDATAREAD))" 
    /// </summary>
    class UiLanguageHelper : IDisposable {
        private readonly CultureInfo _currentCulture;

        public UiLanguageHelper() {
            // save current culture and set culture to en-US 
            _currentCulture = System.Threading.Thread.CurrentThread.CurrentCulture;
            System.Threading.Thread.CurrentThread.CurrentCulture = new CultureInfo("en-US");
        }

        public void Dispose() {
            // reset to original culture 
            System.Threading.Thread.CurrentThread.CurrentCulture = _currentCulture;
        }
    }

    class Program {
        [DllImport("user32.dll", SetLastError = true)]
        static extern IntPtr FindWindow(string lpClassName, string lpWindowName);

        [DllImport("Oleacc.dll")]
        static extern int AccessibleObjectFromWindow(int hwnd, uint dwObjectID, byte[] riid, out IWordWindow ptr);

        public delegate bool EnumChildCallback(int hwnd, ref int lParam);

        [DllImport("User32.dll")]
        public static extern bool EnumChildWindows(int hWndParent, EnumChildCallback lpEnumFunc, ref int lParam);

        [DllImport("User32.dll")]
        public static extern int GetClassName(int hWnd, StringBuilder lpClassName, int nMaxCount);

        public static bool EnumChildProc(int hwndChild, ref int lParam) {
            var buf = new StringBuilder(128);
            GetClassName(hwndChild, buf, 128);
            Console.WriteLine(buf.ToString());

            if (buf.ToString() == "_WwG") { 
                lParam = hwndChild;
                return false;
            }
            return true;
        }

        static void Main() {
            // Use the window class name ("XLMAIN") to retrieve a handle to Excel's main window.
            // Alternatively you can get the window handle via the process id:
            // int hwnd = (int)Process.GetProcessById(excelPid).MainWindowHandle;
            // var p=Process.GetProcesses().FirstOrDefault(x => x.ProcessName=="WINWORD");
            var hwnd = (int) FindWindow("OpusApp", null);

            if (hwnd == 0) 
                throw new Exception("Can't find Word");

            // Search the accessible child window (it has class name "_WwG") // http://msdn.microsoft.com/en-us/library/windows/desktop/dd317978%28v=vs.85%29.aspx
            var hwndChild = 0;
            var cb = new EnumChildCallback(EnumChildProc);
            EnumChildWindows(hwnd, cb, ref hwndChild);

            if (hwndChild == 0) 
                throw new Exception("Can't find Automation Child Window");

            // We call AccessibleObjectFromWindow, passing the constant OBJID_NATIVEOM (defined in winuser.h) 
            // and IID_IDispatch - we want an IDispatch pointer into the native object model.
            const uint OBJID_NATIVEOM = 0xFFFFFFF0;
            var IID_IDispatch = new Guid("{00020400-0000-0000-C000-000000000046}");
            IWordWindow ptr;

            var hr = AccessibleObjectFromWindow(hwndChild, OBJID_NATIVEOM, IID_IDispatch.ToByteArray(), out ptr);

            if (hr < 0) 
                throw new Exception("Can't get Accessible Object");

            // We successfully got a native OM IDispatch pointer, we can QI this for
            // an Excel Application using reflection (and using UILanguageHelper to 
            // fix http://support.microsoft.com/default.aspx?scid=kb;en-us;320369)
            using (new UiLanguageHelper()) {
                var wordApp = ptr.GetType().InvokeMember("Application", BindingFlags.GetProperty, null, ptr, null);

                var version = wordApp.GetType().InvokeMember("Version", BindingFlags.GetField | BindingFlags.InvokeMethod | BindingFlags.GetProperty, null, wordApp, null);
                Console.WriteLine("Word version is: {0}", version);

                dynamic wordAppd = ptr.GetType().InvokeMember("Application", BindingFlags.GetProperty, null, ptr, null);
                Console.WriteLine("Version: " + wordAppd.Version);
            }
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T23:50:30.463

不。

我知道这听起来很陈词滥调，但在使用 Excel 时，VB 比 C# 更容易使用很多很多倍。即使您使用 PIA 而不是全部后期绑定，您仍然最好使用 VB。

（注意：当 C# 4 发布时，所有这些评论都会立即出错。）

# asp.net-mvc - 在类上读/写的 GUID 和 DateTime 属性“需要一个值”

> ID：779367
> 
> 赞同：0
> 
> 时间：2009-04-22T21:42:29.383
> 
> 标签：asp.net-mvc

我创建了一个业务对象（带有属性的普通旧类，没什么花哨的），它有一个空的构造函数，我在我的视图中将它用作 /Member/Create 的强类型（参见代码）。

这一切都很好，我从创建视图中“回发”了对象 - 我的方法 memberToCreate.Save() 实际上将它应该写入的内容写入数据库。

但完成后，创建视图会再次显示，并且 guid 和 datetime 类型的字段会引发验证错误（“需要值”） - 除非它们是只读属性。

我不想将属性设置为只读，因为它们需要从其他地方写入。

我该如何解决这个问题？我可以根据需要/不需要“标记”属性吗？

```
'
' GET: /Member/Create

Function Create() As ActionResult
    Return View()
End Function

'
' POST: /Member/Create

<AcceptVerbs(HttpVerbs.Post)> _
Function Create(<Bind(Exclude:="MemberId")> ByVal memberToCreate As Biz.Member) As ActionResult
    memberToCreate.Save()
    Return View()
End Function 
```

这让我得到验证错误：

```
 Public Property DateOfBirth() As Date
        Get
            Return _DateOfBirth
        End Get
        Set(ByVal value As Date)
            _DateOfBirth = value
        End Set
    End Property 
```

这不...

```
 Public Readonly Property DateOfBirth() As Date
        Get
            Return _DateOfBirth
        End Get
    End Property 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T22:02:14.577

尝试将绑定属性更改为`<Bind(Exclude:="MemberId, DateOfBirth")>`.

或者，如果您的业务逻辑可以，您可以将 DateOfBirth 属性设为空。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T23:08:31.440

经过更多研究（使用 cagdas 提供给我的新关键字），我得出了这个解决方案：

```
 '
' POST: /Member/Create

<AcceptVerbs(HttpVerbs.Post)> _
Function Create(<Bind(Exclude:="MemberId,UserId,CreatedBy,ModifiedBy")> ByVal memberToCreate As eForening.Biz.Member) As ActionResult

    If ModelState.Item("DateOfBirth").Value.AttemptedValue = String.Empty Then
        ModelState.Item("DateOfBirth").Errors.Clear()
    End If

    If Not ModelState.IsValid Then
        Return View()
    End If
    memberToCreate.Save()
    Return RedirectToAction("Index")
End Function 
```

这让我可以处理 DateOfBirth 的空值和指定值 - 让我保持现有 Business Class 的原样（我认为应该如此）。

我基本上检查提供的 DateOfBirth 值，如果提供的值是空字符串，我将重置该字段的错误计数并让验证继续 - 在检查 Modelstate.IsValid 之前。

也许有一个更优雅的解决方案，但这是我迄今为止找到的最佳选择。

# qa - QA 应该向开发报告吗？

> ID：779370
> 
> 赞同：14
> 
> 时间：2009-04-22T21:43:47.897
> 
> 标签：qa, project-organization

这是我在很多很多公司都遇到过的一个问题：QA 团队应该向开发组织报告，还是相当于公司层次结构中的开发？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-22T21:47:02.837

恰恰相反。开发*应向*QA 报告。

如果您将 QA 部门想象为您的客户（注意：QA，而不是测试），那么您会做得很好。错误将得到修复，产品将被开发到良好的标准，开发人员将意识到它们是为业务服务并相应地对产品进行编码的。

但是，公司政治以其他方式赋予资历，因此如果您有 QA 部门，通常开发确实会比较小的 QA 部门更高级。

编辑：解释一下自己的一点补充：在我工作的一家公司，我们有一个“样板办公室”，它被设置为客户站点。我们将构建安装程序 CD 并将其交付给 QA 团队，他们会将其安装到一组干净恢复的机器上。如果它有任何问题，我们会向我们报告，我们必须先修复它（显然，取决于错误的严重程度），然后再制作另一张 CD 并重复该过程。起初我以为“这将是地狱”，它是..但只进行了几次迭代，然后开发人员收到消息并确保这些 CD 可以正常工作，并且它安装的软件可以正常工作。

我现在的公司需要这样的东西，来自站点的反馈是通过邮件列表获得的，安装程序通常不能完全工作，有时缺少依赖项，并且一次又一次地出现相同的安装问题。与之前确保它运行良好的 QA 部门相比，这里的质量很差。在这里，我们有一个开发驱动的小组，他们总是专注于下一个版本，新功能。QA 始终关注当前版本、现有产品。它对最终用户获得的东西产生了巨大的影响。

因此，即使 QA 部门在那里确保质量是可以接受的，我仍然认为应该将其视为开发“报告”给客户的。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-22T21:51:40.670

相等的。目标应该是相同的——发布高质量的软件。没有平等之间的公开讨论，这是不可能发生的。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-22T22:16:52.157

我认为这取决于谁负责提供适当质量的软件。如果是开发组，那么 QA 应该是其中的一部分，其中开发决定 QA 所需的资源与开发所需的资源。

另一方面，如果是一般的技术部门，那么他们可能是平等的，都向主管或 CIO 或 CTO 报告，通过平衡两个团队的需求来做出资源分配决策，以达到更大的目标。

如果 QA 部门推动开发目标，那么向 QA 报告开发可能是有意义的，尽管这肯定是不寻常的。

如果 QA 是组织内的特定实践，而不仅仅是开发过程的一部分，那么它可能不应该报告给开发组，但在许多围绕内部应用程序开发的情况下，QA 并没有得到重视。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-22T22:30:17.677

在我大约一年前工作的一家公司中，我认为这是我见过的最好的开发实践，QA 和开发并肩工作。两者是平等的，但 QA 负责发布和支持已发布的代码，例如：如果在现场发现代码有问题，并且几个第一级支持无法修复它，它将首先到达 QA修复，然后才去开发

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-22T22:05:31.200

我想这在一定程度上取决于 QA 的实际工作。在非常典型的情况下，QA 的任务是[提供没有错误（并且只是间接地（希望）提高质量）](https://stackoverflow.com/questions/761248/qa-process-best-ideas/761645#761645)，那么我认为让它们相等是最好的选择。另一方面，如果 QA 确实将提高质量作为主要任务，那么我认为我同意[gbjbaanb](https://stackoverflow.com/questions/779370/should-qa-report-to-development/779382#779382)的观点，即开发应该向 QA 报告。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-23T18:05:28.527

将其集成为开发团队的一部分。

让开发人员为他们所做的任何事情创建自动冒烟测试，并在这些方面进行 qa 增强/协作。并不是说 QA 向开发报告或相反，而是担任 QA 角色的员工与从事开发的员工处于同一条船上。

请记住，测试自动化需要开发人员的技能，而通常的开发/质量工作分配是错误的。

如果您要使用单独的层次结构，您仍然需要它们密切协作。每个角色都从自己的角度为项目的成功做出贡献。跨团队添加层次结构将优先考虑其中一个，影响其对项目成功的贡献。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-06-02T19:20:07.917

说真的，这个问题一直存在。至少只要有 QA 和开发人员。

就个人而言 - 我不认为 org. 只要您有一位优秀、道德和诚实的经理，图表就很重要。
“研发经理”可能会迫使 QA 人员做/报告某些事情的论点是正确的。您还可以有一个喜欢展示自己的肌肉并证明自己观点的 QA 经理。你也可以有 2 个独立的部门，如果你有一个糟糕的经理，你仍然会遇到问题或人们被迫“调整”事情。无论如何，你都可能以内讧和政治 BS 告终——这会导致发行不佳。

但是，如果您的经理理解并重视流程的两个部分，并且真正专注于尽可能最好的发布，那么组织的内容并不重要。图表看起来像。QA 可以向前台或清洁人员报告，如果他们能够诚实地报告他们的结果并且信息被给予适当的重视和考虑，那么一切都很好。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-06-16T20:47:08.613

您的问题似乎模棱两可；我将回答其余答案未解决的问题：进行测试的个人是否应该向非 QA 经理报告？那*确实*有一个答案，答案是：“QA部门应该是独立的和强大的，它不能向开发团队报告，事实上，QA的负责人应该有否决权发布任何不符合要求的软件鼓起。” Joel Spolsky 的“您没有测试人员的五个（错误）原因”（[http://www.joelonsoftware.com/articles/fog0000000067.html](http://www.joelonsoftware.com/articles/fog0000000067.html)）

让测试人员向工程部门报告，而不是向单一的 QA 负责人报告，似乎是公司希望尝试其他所有重组的事情。这通常表明高层管理人员希望按时发货，而不是当它符合他们应该支持的标准时。这始终是避免对质量问题负责的好方法，即使这不是预期的意图。

即使对于他从未听说过的错误，一个强大、负责的 QA 负责人也至关重要：如果我正在决定是否提交或争论一个我认为重要的错误，如果我知道我会在以下情况下支持我这真的很重要，那么我可能会做正确的事情，即使工程不想解决这个问题。如果我知道最终决定将由一位工程经理做出，其奖金是通过满足时间表来确定的，并且不受质量的影响，那么我会很想回避一场毫无意义的战斗。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-07-15T16:00:26.103

我来自一家对最终产品的质量至关重要的小商店。我还处理过一些商店，在这些商店中，占主导地位的个性（即煽动者）导致人们忽略产品的真实情况，直到顾客（尴尬地）将真实情况纳入视野。

作为最终产品的看门人，QA 部门需要自主权和权力来声明不完整或不可接受的内容。QA 必须“保持真实”。

除了产品质量领域之外，QA 部门还应该拥有（并使用）权力来改变/发展影响质量的开发过程。（即预防未来的问题，改进事物）

距离和视角是 QA 需要正确执行的内容。QA 部门不应参与实际开发要测试的代码的实际代码编写活动。也许是一些测试自动化，但不是要测试的实际代码。QA 也不应该参与开发的日常运营。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-11-03T21:34:17.707

你的问题的重点有点混杂。是关于公司结构和部门组织吗？还是关于项目组织？

如果您想询问问题、错误报告和项目组织，那么 QA 会向负责决定对给定项目中的问题采取什么措施的**角色报告。**它可以是开发人员、分析师、企业主、客户代表。可以决定如何处理给定问题并让其他人遵守的人。

如果您想询问假期、加班和公司组织，那么质量保证会向他们的直线经理报告。根据组织的规模，它可以是 qa 和开发人员的一名经理，也可以是他们自己的经理，因为组织中有太多的测试人员和开发人员，他们有不同的部门。

在这两种情况下，公司层次结构中的开发人员 - 测试人员职位都不相关（我认为这应该是等价的）。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-06-02T19:05:09.290

我认为 QA 是开发部门不可分割的一部分，但是 QA 作为一个团队在权力方面应该比阶梯高半步。如果 QA 部门必须通过或验证代码才能工作，他们本质上是更高的，因为他们可以告诉开发人员返回并再次执行。

开发者时间和发布日期之间会有冲突。有时，必须发布不完美的代码，或者开发人员认为不应该立即修复错误。我会说理想情况下 QA 负责人和首席开发人员都向同一个人报告，并且这两个人被视为平等。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-22T22:34:55.623

他们应该平等地工作，这样他们在政治上就不会被不想承认问题的发展经理们闭嘴。如果要有效，Qa 不能向开发人员报告。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-10-13T07:44:42.957

我认为 QA 和开发应该齐头并进，因为两者都为最好的产品交付工作。QA 和开发人员对组织可以交付的产品的最佳质量负责。任何阻碍 QA 和开发人员关系的事情也可能阻碍产品开发。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2016-11-20T18:59:11.380

QA 应该向 DEV 报告错误并且在任何情况下都不会被接受。如果生产环境出现故障，开发人员永远不会承担任何责任。他们为什么要向 QA 报告，为什么不反过来呢？毕竟，他们负责根据客户的要求发布功能需求。从客户的角度看产品是QA的主要工作。万一任何东西在理智上崩溃/失败，他们将负责运送不完整/不成熟的产品。这仍然是一种传统方法。

在敏捷方法论出现之后，QA 和 Dev 应该在产品开发经理的领导下并肩工作，或者 QA 和 Dev 可以有不同的负责人，但工作在同一个议程上，即根据客户的要求交付成熟的产品。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2016-05-10T05:25:20.420

作为 QA，我建议您必须报告您遇到的那些问题，可能是开发人员错过了不应该发生的事情。

# javascript - 为什么 setTimeout(fn, 0) 有时有用？

> ID：779379
> 
> 赞同：1001
> 
> 时间：2009-04-22T21:46:08.390
> 
> 标签：javascript, dom, event-loop

我最近遇到了一个相当讨厌的错误，其中代码是`<select>`通过 JavaScript 动态加载的。这个动态加载`<select>`的有一个预选值。在 IE6 中，我们已经有了修复 selected 的代码`<option>`，因为有时`<select>`' 的`selectedIndex`值会与 selected`<option>`的`index`属性不同步，如下所示：

```
field.selectedIndex = element.index; 
```

但是，此代码不起作用。即使该字段的`selectedIndex`设置正确，最终也会选择错误的索引。但是，如果我`alert()`在正确的时间插入一个语句，就会选择正确的选项。认为这可能是某种时间问题，我尝试了一些我之前在代码中看到的随机的东西：

```
var wrapFn = (function() {
    var myField = field;
    var myElement = element;

    return function() {
        myField.selectedIndex = myElement.index;
    }
})();
setTimeout(wrapFn, 0); 
```

这行得通！

我有一个解决我的问题的方法，但我很不安，因为我不知道为什么这能解决我的问题。有人有官方解释吗？通过使用“稍后”调用我的函数可以避免什么浏览器问题`setTimeout()`？

* * *

## 回答 #1

> 赞同：914
> 
> 时间：2009-04-23T00:14:17.927

在问题中，存在以下[竞争条件](https://en.wikipedia.org/wiki/Race_condition)：

1.  浏览器尝试初始化下拉列表，准备更新其选定的索引，以及
2.  您设置所选索引的代码

您的代码一直在赢得这场比赛，并试图在浏览器准备好之前设置下拉选择，这意味着会出现错误。

之所以存在这种竞争，是因为 JavaScript 有一个与页面渲染共享[的执行线程。](https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop)实际上，运行 JavaScript 会阻止 DOM 的更新。

您的解决方法是：

```
setTimeout(callback, 0) 
```

Invoking `setTimeout`with a callback, and zero as the second argument will schedule the callback to be run **asynchronously** , after the shortest possible delay - which will be around 10ms when the tab has focus and the JavaScript thread of execution is not busy.

因此，OP 的解决方案是将所选索引的设置延迟大约 10 毫秒。这给了浏览器一个初始化 DOM 的机会，修复了这个 bug。

每个版本的 Internet Explorer 都表现出古怪的行为，这种变通方法有时是必要的。或者，它可能是 OP 代码库中的真正错误。

* * *

参见 Philip Roberts 的演讲[“事件循环到底是什么？”](https://www.youtube.com/watch?v=8aGhZQkoFbQ) 以获得更详尽的解释。

* * *

## 回答 #2

> 赞同：703
> 
> 时间：2011-01-01T17:53:17.850

***前言：***

其他一些答案是正确的，但实际上并没有说明要解决的问题是什么，所以我创建了这个答案来展示详细的说明。

因此，我发布了**有关浏览器功能以及如何使用`setTimeout()`帮助**的详细演练。它看起来很长，但实际上非常简单明了——我只是把它写得很详细。

**更新：**我制作了一个 JSFiddle 来现场演示以下解释：http: [//jsfiddle.net/C2YBE/31/](http://jsfiddle.net/C2YBE/31/)。非常**感谢**@ThangChung 帮助启动它。

**UPDATE2：**以防万一 JSFiddle 网站死亡或删除代码，我在最后将代码添加到这个答案中。

* * *

**详情**：

想象一个带有“做某事”按钮和结果 div 的 Web 应用程序。

`onClick`“做某事”按钮的处理程序调用一个函数“LongCalc()”，它做了两件事：

1.  进行很长的计算（比如说需要 3 分钟）

2.  将计算结果打印到结果 div 中。

现在，您的用户开始对此进行测试，单击“做某事”按钮，然后页面似乎无所事事 3 分钟，他们变得焦躁不安，再次单击按钮，等待 1 分钟，没有任何反应，再次单击按钮...

问题很明显 - 你想要一个“状态”DIV，它显示正在发生的事情。让我们看看它是如何工作的。

* * *

因此，您添加了一个“状态”DIV（最初为空），并修改`onclick`处理程序（函数`LongCalc()`）来做 4 件事：

1.  将状态“正在计算...可能需要约 3 分钟”填充到状态 DIV

2.  进行很长的计算（比如说需要 3 分钟）

3.  将计算结果打印到结果 div 中。

4.  将状态“计算完成”填充到状态 DIV

而且，您很乐意将应用程序提供给用户进行重新测试。

他们回到你身边，看起来很生气。并解释当他们单击按钮时，**状态 DIV 从未更新为“正在计算...”状态！！！**

* * *

你挠头，在 StackOverflow 上四处询问（或阅读文档或谷歌），然后意识到问题所在：

浏览器将所有由事件产生的“TODO”任务（包括 UI 任务和 JavaScript 命令）放入**单个队列**中。不幸的是，使用新的“正在计算...”值重新绘制“状态”DIV 是一个单独的 TODO，它会排到队列的末尾！

以下是用户测试期间事件的细分，每个事件之后的队列内容：

*   队列：`[Empty]`
*   事件：点击按钮。活动后排队：`[Execute OnClick handler(lines 1-4)]`
*   事件：在 OnClick 处理程序中执行第一行（例如更改状态 DIV 值）。事件后排队：`[Execute OnClick handler(lines 2-4), re-draw Status DIV with new "Calculating" value]`。**请注意，虽然 DOM 更改是即时发生的，但要重新绘制相应的 DOM 元素，您需要一个由 DOM 更改触发的新事件，该事件位于队列末尾**。
*   **问题！！！** **问题！！！**详细说明如下。
*   事件：在处理程序中执行第二行（计算）。排队后：`[Execute OnClick handler(lines 3-4), re-draw Status DIV with "Calculating" value]`。
*   事件：在处理程序中执行第 3 行（填充结果 DIV）。排队后：`[Execute OnClick handler(line 4), re-draw Status DIV with "Calculating" value, re-draw result DIV with result]`。
*   事件：在处理程序中执行第 4 行（使用“DONE”填充状态 DIV）。队列：`[Execute OnClick handler, re-draw Status DIV with "Calculating" value, re-draw result DIV with result; re-draw Status DIV with "DONE" value]`。
*   `return`事件：从`onclick`处理程序子隐含执行。我们从队列中取出“Execute OnClick 处理程序”并开始执行队列中的下一项。
*   注意：由于我们已经完成了计算，因此用户已经过了 3 分钟。**重画事件还没有发生！！！**
*   事件：使用“计算”​​值重新绘制状态 DIV。我们重新绘制并将其从队列中移除。
*   事件：使用结果值重新绘制 Result DIV。我们重新绘制并将其从队列中移除。
*   事件：使用“完成”值重新绘制状态 DIV。我们重新绘制并将其从队列中移除。眼尖的观众甚至可能会注意到“状态 DIV 与“计算”值在几分之一微秒内闪烁 -**计算完成后**

所以，根本的问题是“状态”DIV的重绘事件被放置在最后的队列中，在“执行第2行”事件之后需要3分钟，所以实际的重绘不会发生，直到计算完成后。

* * *

救援来了`setTimeout()`。它有什么帮助？因为通过调用长执行代码`setTimeout`，您实际上创建了 2 个事件：`setTimeout`执行本身，以及（由于 0 超时）正在执行的代码的单独队列条目。

因此，为了解决您的问题，您将`onClick`处理程序修改为两个语句（在一个新函数中或只是一个块中`onClick`）：

1.  将状态“正在计算...可能需要约 3 分钟”填充到状态 DIV

2.  **执行`setTimeout()`0 超时并调用`LongCalc()`function**。

    `LongCalc()`功能与上次几乎相同，但显然没有“正在计算...”状态DIV更新作为第一步；而是立即开始计算。

那么，事件序列和队列现在是什么样子的呢？

*   队列：`[Empty]`
*   事件：点击按钮。活动后排队：`[Execute OnClick handler(status update, setTimeout() call)]`
*   事件：在 OnClick 处理程序中执行第一行（例如更改状态 DIV 值）。事件后排队：`[Execute OnClick handler(which is a setTimeout call), re-draw Status DIV with new "Calculating" value]`。
*   事件：在处理程序中执行第二行（setTimeout 调用）。排队后：`[re-draw Status DIV with "Calculating" value]`。队列在 0 秒内没有任何新内容。
*   事件：超时警报响起，0 秒后。排队后：`[re-draw Status DIV with "Calculating" value, execute LongCalc (lines 1-3)]`。
*   事件：**使用“计算”​​值重新绘制状态 DIV**。排队后：`[execute LongCalc (lines 1-3)]`。请注意，此重新绘制事件实际上可能在警报响起之前发生，这同样有效。
*   ...

万岁！在计算开始之前，状态 DIV 刚刚更新为“正在计算...”！！！

* * *

* * *

下面是来自 JSFiddle 的示例代码，说明了这些示例： http: [//jsfiddle.net/C2YBE/31/](http://jsfiddle.net/C2YBE/31/)：

**HTML 代码：**

```
<table border=1>
    <tr><td><button id='do'>Do long calc - bad status!</button></td>
        <td><div id='status'>Not Calculating yet.</div></td>
    </tr>
    <tr><td><button id='do_ok'>Do long calc - good status!</button></td>
        <td><div id='status_ok'>Not Calculating yet.</div></td>
    </tr>
</table> 
```

**JavaScript 代码：（在 jQuery 1.9 上执行`onDomReady`并且可能需要 jQuery 1.9）**

```
function long_running(status_div) {

    var result = 0;
    // Use 1000/700/300 limits in Chrome, 
    //    300/100/100 in IE8, 
    //    1000/500/200 in FireFox
    // I have no idea why identical runtimes fail on diff browsers.
    for (var i = 0; i < 1000; i++) {
        for (var j = 0; j < 700; j++) {
            for (var k = 0; k < 300; k++) {
                result = result + i + j + k;
            }
        }
    }
    $(status_div).text('calculation done');
}

// Assign events to buttons
$('#do').on('click', function () {
    $('#status').text('calculating....');
    long_running('#status');
});

$('#do_ok').on('click', function () {
    $('#status_ok').text('calculating....');
    // This works on IE8\. Works in Chrome
    // Does NOT work in FireFox 25 with timeout =0 or =1
    // DOES work in FF if you change timeout from 0 to 500
    window.setTimeout(function (){ long_running('#status_ok') }, 0);
}); 
```

* * *

## 回答 #3

> 赞同：93
> 
> 时间：2010-12-06T21:38:30.173

查看 John Resig 关于[JavaScript 计时器如何工作](http://ejohn.org/blog/how-javascript-timers-work/)的文章。当您设置超时时，它实际上将异步代码排队，直到引擎执行当前调用堆栈。

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2009-04-22T21:52:10.047

`setTimeout()`在加载 DOM 元素之前为您争取一些时间，即使设置为 0。

看看这个：[setTimeout](http://snook.ca/archives/javascript/settimeout_solve_domcontentloaded)

* * *

## 回答 #5

> 赞同：25
> 
> 时间：2013-02-25T21:27:03.443

浏览器有一个称为“主线程”的进程，它负责执行一些 JavaScript 任务，UI 更新，例如：绘画、重绘、重排等。 JavaScript 任务排队到消息队列中，然后分派到浏览器的主线程中进行处理。执行。当主线程忙时生成 UI 更新时，会将任务添加到消息队列中。

* * *

## 回答 #6

> 赞同：23
> 
> 时间：2014-07-26T00:30:21.370

这里有相互矛盾的赞成答案，没有证据就无法知道该相信谁。这证明@DVK 是正确的，@SalvadorDali 是不正确的。后者声称：

> “这就是为什么：不可能有 0 毫秒的时间延迟的 setTimeout。最小值由浏览器确定，它不是 0 毫秒。历史上浏览器将此最小值设置为 10 毫秒，但 HTML5 规范和现代浏览器将其设置为 4 毫秒。”

4 毫秒的最小超时与正在发生的事情无关。真正发生的是 setTimeout 将回调函数推到执行队列的末尾。如果在 setTimeout(callback, 0) 之后您有阻塞代码需要几秒钟才能运行，则回调将不会执行几秒钟，直到阻塞代码完成。试试这个代码：

```
function testSettimeout0 () {
    var startTime = new Date().getTime()
    console.log('setting timeout 0 callback at ' +sinceStart())
    setTimeout(function(){
        console.log('in timeout callback at ' +sinceStart())
    }, 0)
    console.log('starting blocking loop at ' +sinceStart())
    while (sinceStart() < 3000) {
        continue
    }
    console.log('blocking loop ended at ' +sinceStart())
    return // functions below
    function sinceStart () {
        return new Date().getTime() - startTime
    } // sinceStart
} // testSettimeout0 
```

输出是：

```
setting timeout 0 callback at 0
starting blocking loop at 5
blocking loop ended at 3000
in timeout callback at 3033 
```

* * *

## 回答 #7

> 赞同：17
> 
> 时间：2011-01-01T17:38:04.523

这样做的一个原因是将代码的执行推迟到一个单独的后续事件循环。当响应某种浏览器事件（例如鼠标点击）时，有时需要在当前事件处理*完毕后才执行操作。*该`setTimeout()`设施是最简单的方法。

*编辑*现在是 2015 年，我应该注意到还有`requestAnimationFrame()`，这并不完全相同，但它足够接近`setTimeout(fn, 0)`值得一提。

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2018-06-05T06:26:31.450

这两个评价最高的答案都是错误的。[查看并发模型和事件循环的 MDN 描述，](https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop)应该会清楚发生了什么（MDN 资源是真正的瑰宝）。除了“解决”这个小问题之外，**简单地使用** `setTimeout`还可以在代码中添加意想不到的问题。

这里**实际**发生的不是“浏览器可能还没有完全准备好，因为并发性”或基于“每一行都是一个添加到队列后面的事件”的东西。

DVK提供的[jsfiddle](http://jsfiddle.net/C2YBE/31/)确实说明了一个问题，但他对此的解释是不正确的。

他的代码中发生的事情是，他首先将一个事件处理程序附加到按钮`click`上的事件。`#do`

然后，当您实际单击按钮时，将`message`创建引用事件处理函数的 a，该函数将添加到`message queue`. 当`event loop`到达此消息时，它会`frame`在堆栈上创建一个，并在 jsfiddle 中调用 click 事件处理程序的函数。

这就是有趣的地方。我们习惯于认为 Javascript 是异步的，以至于我们很容易忽略一个小事实：**任何帧都必须在执行下一帧之前完全执行**。没有并发，人。

这是什么意思？这意味着每当从消息队列中调用一个函数时，它都会阻塞队列，直到它生成的堆栈被清空。或者，更一般地说，它会阻塞，直到函数返回。它会阻止**一切**，包括 DOM 渲染操作、滚动等等。如果您想确认，只需尝试增加小提琴中长时间运行的操作的持续时间（例如再运行外循环 10 次），您会注意到在它运行时，您无法滚动页面。如果它运行的时间足够长，您的浏览器会询问您是否要终止该进程，因为它会使页面无响应。帧正在执行，事件循环和消息队列被卡住，直到它完成。

那么为什么文本的这种副作用没有更新呢？因为当你**改变**了 DOM 中元素的值时——你可以`console.log()`在改变它之后立即看到它的值并看到它**已经**被改变了（这说明了为什么 DVK 的解释是不正确的）——浏览器正在等待堆栈耗尽（`on`要返回的处理程序函数），从而完成消息，以便它最终可以执行由运行时添加的消息，作为对我们的变异操作的反应，并在 UI 中反映该变异.

这是因为我们实际上是在等待代码完成运行。我们还没有说“有人获取这个然后调用这个函数并使用结果，谢谢，现在我已经完成了，所以我马上返回，现在做任何事情”，就像我们通常使用基于事件的异步 Javascript 所做的那样。我们进入一个click事件处理函数，我们更新一个DOM元素，我们调用另一个函数，另一个函数工作了很长时间然后返回，然后我们更新同一个DOM元素，**然后**我们从初始函数返回，有效清空堆栈。然后浏览器可以获取队列中的下一条消息，这很可能是我们通过触发一些内部“on-DOM-mutation”类型事件生成的消息**。**

在当前执行的帧完成（函数返回）之前，浏览器 UI 不能（或选择不）更新 UI。就个人而言，我认为这是设计而不是限制。

那为什么`setTimeout`事情会起作用呢？这样做是因为它有效地从自己的框架中删除了对长时间运行函数的调用，将其安排在上下文中稍后执行`window`，以便它自己可以**立即返回**并允许消息队列处理其他消息。这个想法是，当我们在 Javascript 中更改 DOM 中的文本时，我们在 Javascript 中触发的 UI“更新”消息现在领先于为长时间运行的函数排队的消息，因此 UI 更新发生在我们阻止之前需很长时间。

请注意，a) 长时间运行的函数在运行时**仍然会阻塞**所有内容，并且 b) 您不能保证 UI 更新实际上在消息队列中在它之前。在我 2018 年 6 月的 Chrome 浏览器上，值`0`10 并不能“解决”小提琴演示的问题 - 10 可以。我实际上对此感到有些窒息，因为对我来说，UI 更新消息应该在它之前排队似乎是合乎逻辑的，因为它的触发器是在安排长时间运行的函数“稍后”运行之前执行的。但也许 V8 引擎中的一些优化可能会干扰，或者我的理解可能只是缺乏。

好的，那么 using 有什么问题，`setTimeout`对于这种特殊情况有什么更好的解决方案？

首先，在`setTimeout`像这样的任何事件处理程序上使用的问题，试图缓解另一个问题，很容易与其他代码混淆。这是我工作中的一个真实示例：

一位同事对事件循环有错误的理解，试图通过使用一些模板渲染代码来“线程化”Javascript `setTimeout 0`。他不再来这里问了，但我可以推测，也许他插入了计时器来衡量渲染速度（这将是函数的返回即时性），并发现使用这种方法会使得该函数的响应速度极快。

第一个问题很明显；你不能线程化 javascript，所以当你添加混淆时你在这里什么也得不到。其次，您现在已经有效地将模板的渲染从可能的事件侦听器堆栈中分离出来，这些事件侦听器可能期望该模板已经被渲染，而它很可能没有被渲染。该函数的实际行为现在是非确定性的，就像——在不知不觉中——任何运行它或依赖它的函数一样。您可以做出有根据的猜测，但您无法正确编码其行为。

编写依赖于其逻辑的新事件处理程序时的“修复”是**也**使用`setTimeout 0`. 但是，这不是解决办法，很难理解，而且调试由这样的代码引起的错误也没有乐趣。有时从来没有问题，有时它总是失败，然后又一次，有时它会工作并偶尔中断，这取决于平台的当前性能以及当时发生的其他事情。这就是为什么我个人建议不要使用这个 hack（这**是**一个 hack，我们都应该知道它是），除非你真的知道你在做什么以及后果是什么。

但是我们**能**做些什么呢？好吧，正如引用的 MDN 文章所建议的那样，要么将工作拆分为多条消息（如果可以的话），以便排队的其他消息可以与你的工作交错并在它运行时执行，或者使用可以运行的 web worker与您的页面同步，并在完成计算后返回结果。

哦，如果你在想，“好吧，我不能在长时间运行的函数中放置一个回调以使其异步吗？”然后不。回调不会使其异步，它仍然需要在显式调用回调之前运行长时间运行的代码。

* * *

## 回答 #9

> 赞同：13
> 
> 时间：2014-05-19T21:34:47.610

这是一个老问题，老答案。我想重新审视这个问题，并回答为什么会发生这种情况，而不是为什么这很有用。

所以你有两个功能：

```
var f1 = function () {    
   setTimeout(function(){
      console.log("f1", "First function call...");
   }, 0);
};

var f2 = function () {
    console.log("f2", "Second call...");
}; 
```

然后按以下顺序调用它们`f1(); f2();`只是为了看到第二个首先执行。

这就是原因：不可能有`setTimeout`0 毫秒的时间延迟。**最小值由浏览器确定**，它不是 0 毫秒。[过去](https://developer.mozilla.org/en-US/docs/Web/API/window.setTimeout?redirectlocale=en-US&redirectslug=DOM/window.setTimeout#Minimum.2F_maximum_delay_and_timeout_nesting)浏览器将此最小值设置为 10 毫秒，但[HTML5 规范](http://www.whatwg.org/specs/web-apps/current-work/multipage/timers.html#timers)和现代浏览器将其设置为 4 毫秒。

> 如果嵌套级别大于 5，并且 timeout 小于 4，则将 timeout 增加到 4。

同样来自Mozilla：

> 要在现代浏览器中实现 0 毫秒超时，您可以使用 window.postMessage() ，如此[处](http://dbaron.org/log/20100309-faster-timeouts)所述。

PS信息是在阅读以下[文章](http://geekabyte.blogspot.com/2014/01/javascript-effect-of-setting-settimeout.html)后获取的。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2011-01-01T17:39:29.277

由于它的持续时间为`0`，我想这是为了`setTimeout`从执行流程中删除传递给 的代码。因此，如果它是一个可能需要一段时间的函数，它不会阻止后续代码执行。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2012-06-21T01:14:43.583

这样做的另一件事是将函数调用推送到堆栈底部，以防止在递归调用函数时发生堆栈溢出。这具有`while`循环的效果，但让 JavaScript 引擎触发其他异步计时器。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2021-05-23T07:29:28.537

如果你不想看[完整的视频](https://www.youtube.com/watch?v=8aGhZQkoFbQ)，这里简单解释一下需要了解的内容，以便能够理解这个问题的答案：

1.  **JavaScript 是单线程的**，这意味着它在运行时一次只做一件事。
2.  **但是运行 JavaScript 的环境可以是多线程的。**例如，浏览器通常是多线程的生物，即，一次能够做多项事情。所以他们可以运行 JavaScript，同时也可以跟踪处理其他事情。

从现在开始，我们将讨论“在浏览器中”的 JavaScript。类似`setTimeout`的东西确实是浏览器的东西，而不是 JavaScript 本身的一部分。

3.  **允许 JavaScript 异步运行的是多线程浏览器！**除了 Javascript 使用的主要空间（称为*调用堆栈*）来放置每一行代码并逐个运行它们之外，浏览器还为 JavaScript 提供了另一个空间来放置东西。

现在让我们称另一个空间**为第二个空间**。

4.  假设`fn`是一个函数。**这里要理解的重要一点是`fn();`call 不等于`setTimeout(fn, 0);`call**，这将在下面进一步解释。

我们先假设另一个延迟，而不是`0`延迟，例如 5000 毫秒`setTimeout(fn, 5000);`：重要的是要注意这仍然是一个“函数调用”，所以它必须放在主空间，并在完成后从其中删除，但是等等！我们不喜欢整个冗长而无聊的 5 秒延迟. 这将阻塞主空间，同时不允许 JavaScript 运行其他任何东西。

谢天谢地，这不是浏览器设计者设计它们的方式。**相反，这个 call( `setTimeout(fn, 5000);`) 是*立即*完成的。这很重要：即使有 5000 毫秒的延迟，这个函数调用也是在瞬间完成的！**接下来会发生什么？它从主空间中删除。会放在哪里？（因为我们不想失去它）。您可能猜对了：**浏览器*听到*这个调用并将其放在第二个空格上。** [![在此处输入图像描述](https://i.stack.imgur.com/ZBd8y.png)](https://i.stack.imgur.com/ZBd8y.png)

浏览器会跟踪 5 秒的延迟**，一旦延迟过去，它会查看主空间，然后“当它为空时”，将`fn();`调用返回给它**。这就是`setTimeout`工作原理。

所以，回到`setTimeout(fn, 0)`，即使延迟为零，这仍然是对浏览器的调用，浏览器会立即听到并拿起它，并将其放在第二个空间，然后再将其放回主空间**仅当主空间又是空的，而且不是真正的 0 毫秒后**。

我真的建议您也观看该视频，因为他的解释非常好，并且更多地打开了技术问题。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-04-22T21:53:43.553

通过调用 setTimeout，您可以让页面有时间对用户所做的任何事情做出反应。这对于在页面加载期间运行的函数特别有用。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2012-12-14T13:09:00.043

setTimeout 有用的其他一些情况：

您希望将长时间运行的循环或计算分解为更小的组件，以便浏览器不会出现“冻结”或说“页面上的脚本正忙”。

您希望在单击时禁用表单提交按钮，但如果您在 onClick 处理程序中禁用该按钮，则不会提交表单。时间为零的 setTimeout 可以解决问题，允许事件结束，开始提交表单，然后可以禁用您的按钮。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2018-09-15T09:12:40.750

问题是您试图对不存在的元素执行 Javascript 操作。该元素尚未加载，并`setTimeout()`通过以下方式为元素提供更多时间加载：

1.  `setTimeout()`导致事件是**异步**的，因此在所有同步代码之后执行，从而为您的元素提供更多加载时间。像里面的回调这样的异步回调`setTimeout()`被放入**事件队列**中，在同步代码栈为空后由**事件循环入栈。**
2.  ms 作为函数中的第二个参数的值 0`setTimeout()`通常略高（4-10ms 取决于浏览器）。执行回调所需的稍长的时间`setTimeout()`是由事件循环的“滴答声”（如果堆栈为空，滴答声将回调推送到堆栈上）的数量引起的。由于性能和电池寿命的原因，事件循环中的滴答数被限制为每秒**少于**1000 次的特定数量。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2013-03-13T23:29:55.870

关于执行循环和在其他代码完成之前渲染 DOM 的答案是正确的。JavaScript 中的零秒超时有助于使代码成为伪多线程，即使它不是。

我想补充一点，JavaScript 中跨浏览器/跨平台零秒超时的最佳值实际上约为 20 毫秒而不是 0（零），因为由于时钟限制，许多移动浏览器无法注册小于 20 毫秒的超时在 AMD 芯片上。

此外，不涉及 DOM 操作的长时间运行的进程现在应该发送到 Web Workers，因为它们提供了 JavaScript 的真正多线程执行。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2015-09-02T15:39:58.573

setTimout on 0 在设置延迟承诺的模式中也非常有用，您希望立即返回：

```
myObject.prototype.myMethodDeferred = function() {
    var deferredObject = $.Deferred();
    var that = this;  // Because setTimeout won't work right with this
    setTimeout(function() { 
        return myMethodActualWork.call(that, deferredObject);
    }, 0);
    return deferredObject.promise();
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2021-07-12T04:48:12.483

```
//When need "new a", setTimeout(fn, 0) is useful, when need to wait some action. Example:

var a = function (){console.log('a');};
var b = function(){setTimeout(b, 100);}; //wait some action before override this function

//without setTimeout:
console.log('no setTimeout: b.toString():', b.toString());
b();    //"b" is an old function
console.log('no setTieout: a.toString(): ', a.toString());
a();    //and "a" is not overrided

setTimeout(//but with setTimeout(fn, 0):
    function(){
        console.log('After timeout 0, b.toString(): ', b.toString());
        b();    //"b" is a new function
        console.log('After timeout 0, a.toString(): ', a.toString());
        a();    //and "a" is overrided
    },
    0
);

//override var "b", which was been undefined
b = function (){
    a = function(){console.log('new a');};
}
```

* * *

## 回答 #19

> 赞同：-2
> 
> 时间：2018-01-22T07:27:14.700

Javascript 是单线程应用程序，因此不允许同时运行函数，因此要使用事件循环来实现。那么 setTimeout(fn, 0) 究竟是做什么的，它被推入任务任务中，当您的调用堆栈为空时执行该任务。我知道这个解释很无聊，所以我建议你看一下这个视频，这将帮助你了解浏览器中的工作原理。观看此视频：- [https://www.youtube.com/watch?time_continue=392&v=8aGhZQkoFbQ](https://www.youtube.com/watch?time_continue=392&v=8aGhZQkoFbQ)

# python - Python多处理：将数据发送到进程

> ID：779384
> 
> 赞同：2
> 
> 时间：2009-04-22T21:47:29.497
> 
> 标签：python, multiprocessing

我有这样的子`Process`类：

```
class EdgeRenderer(Process):
    def __init__(self,starter,*args,**kwargs):
        Process.__init__(self,*args,**kwargs)
        self.starter=starter 
```

然后我定义了一个`run`使用`self.starter`.

该`starter`对象属于`State`我定义的类。

我这样做可以吗？对象会发生什么？它会被序列化吗？这是否意味着我必须始终确保`State`对象是可序列化的？新进程是否获得此对象的副本？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-23T13:37:03.940

在 unix 系统上，多处理使用 os.fork() 创建子进程，在 Windows 上，它使用一些子进程技巧和序列化来共享数据。所以要跨平台，是的 - 它必须是可序列化的。孩子将得到一份新副本。

话虽如此，这里有一个例子：

```
from multiprocessing import Process
import time

class Starter(object):
    def __init__(self):
        self.state = False

x = Starter()

class EdgeRenderer(Process):
    def __init__(self,starter,*args,**kwargs):
        Process.__init__(self,*args,**kwargs)
        self.starter=starter
    def run(self):
        self.starter.state = "HAM SANDWICH"
        time.sleep(1)
        print self.starter.state

a = EdgeRenderer(x)
a.start()
x.state = True
a.join()
print x.state 
```

运行时，您将看到：

```
HAM SANDWICH
True 
```

因此，在 fork() 之后，父母所做的更改不会得到传达，而孩子所做的更改也有同样的问题。你必须遵守分叉限制。

# c# - 如何使用 C# 处理大图像

> ID：779395
> 
> 赞同：1
> 
> 时间：2009-04-22T21:50:25.590
> 
> 标签：c#, image-processing

尝试加载 jpg 中 20 Mb 或 bmp 中 200 Mb 等图像时，内存不足

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T21:56:35.683

我们的地图控件中有一个非常大的（~50MB）光栅图像。

解决方案是将主图像切成小块并加载到*Image[,]*数组中。

```
 -------------------------------------
            |  pic00 |  pic01 |        |        |
            -------------------------------------
            |  pic10 |        |        |        |
pic.png ->  -------------------------------------
            |        |        |        |        |
            -------------------------------------
            |        |        |        |  picnm |
            ------------------------------------- 
```

您可以使用*Graphics.DrawImage(..)*绘制这些作品。

唯一的大问题是：如果您需要在屏幕上显示整个画面，绘图过程可能会很慢。保存缩略图并在需要时显示的一个很好的解决方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T22:02:44.827

我认为 web.config 中可能有一个设置允许您的应用程序消耗超过默认内存量。否则，如果它是一个 Web 应用程序，则创建一个更大的应用程序池。

还要确保您尽快处置（）资源。

默认情况下，.net 不会使用任何花哨的技巧来提高内存效率。它本身并不坏，但它不会给你任何好处。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T22:23:04.013

如果您使用的是 WPF，则可以将图像的“缩略图”加载到内存中，这可能是更合理的分辨率：

```
BitmapImage bitmapImage = new BitmapImage();
bitmapImage.BeginInit();
bitmapImage.DecodePixelWidth = 100;
bitmapImage.UriSource = new Uri(imageData.Name);
bitmapImage.EndInit();

this.imageControl.Source = bitmapImage; 
```

# list - 层次视觉设计

> ID：779399
> 
> 赞同：0
> 
> 时间：2009-04-22T21:51:31.873
> 
> 标签：list, user-interface, hierarchy, categories

我有一个类别层次结构，其中一个类别可以有一个父级（并且您可以有多个级别的子级。）

我正在研究向用户显示此信息的方法，似乎基本的香草树布局是最直观的方式。但我想知道是否有人可以提出其他方法。

要求是，

1）向用户清楚地展示列表的父/子关系 2）允许用户轻松移动项目（无论是通过拖放还是其他方法） 3）假设您有具有多个父级的层次结构数据，这将如何改变你的选择？

谢谢大家！- 凯文

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-23T13:01:12.810

您的基本树控件在显示层次关系方面取得了巨大成功。对于新手来说，它相对容易学习，现在是层次结构的事实标准。它非常适合编辑关系，尤其是拖放。当分层深度随对象任意变化时，这可能是唯一可行的选择（即，对于树上的任何对象，都可以有子、孙、曾孙等等，直到无限数量的“世代”。 ）。

树的主要替代方案是带有主从窗格的窗口。在此设计中，一个窗格包含父对象，另一个窗格包含子对象。选择父对象会使用其子项填充子窗格。您可以根据需要拥有孙子窗格和曾孙子窗格，但是当层次结构中的固定层数较少时，主详细信息通常效果最好。用户通过在窗口内或窗口之间拖放和剪切/复制和粘贴子对象来编辑父子关系，类似于使用树控件。

在以下情况下，主详细信息通常比树更好：

*   您需要为每个对象显示多个属性或属性。例如，对于给定的项目对象，您不仅要列出每个团队成员的员工编号，还要列出他们各自的姓名、角色、职务、部门和照片。使用主详细信息，每个窗格都可以布置为表格或表单，从而允许您显示有关每个对象的很多信息。树控件通常使用低效且令人困惑的属性对话框来完成此操作。

*   您需要细分孩子。例如，对于给定的项目对象，您希望将其团队成员与其项目阶段分开。使用主详细信息，您可以为单个父窗格拥有两个或多个子窗格，其中一个窗格列出团队成员，一个窗格列出阶段。将不相关的子对象与树控件分开是很尴尬的。

*   您有多对多关系，其中每个孩子可能有多个父母，并且每个父母都有多个孩子。例如，假设每个项目有多个员工（作为团队成员），但每个员工可能从事多个项目。您可以在父窗格中拥有一个包含项目的窗口，在子窗格中拥有团队成员，或者在父窗格中拥有员工，在子窗格中拥有项目分配，或者您可以同时拥有这两个窗口。当存在多对多关系时，树控件可能会使用户感到困惑，因为用户不希望同一个孩子在多个父母之下。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T22:27:36.857

TreeGX 是一种以与标准树[链接](http://www.devcomponents.com/treegx/)不同的方式显示分层数据的好方法。

我使用该组件来呈现搜索结果，虽然它不是免费的，但如果你想呈现独特的东西，它是值得的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T22:04:18.737

你可以放一些可视化的流程图样式设计，让它更具吸引力。你想走多远完全取决于你。这将帮助你与多个父母。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-09T14:48:49.680

您的问题将您的设计问题视为抽象事物。不幸的是，事情没那么简单——要是有一个完美的解决方案就好了！

UI 设计是高度情境化的。您必须考虑用户组（即他们的需求、目标和期望）以及您尝试支持的活动类型（即用户浏览此树时究竟在做什么？他们的目标是什么？他们会使用您的应用程序每天还是每年一次？等）。在您的上下文中有效的方法可能在其他地方效果不佳。

*当被告知“去构建一个快速原型并在最终用户的样本上对其进行测试”*时，人们总是会感到失望。它涉及进一步的工作，并且超出了典型的开发人员的舒适区。但是，这是确保您的 UI 适合您的给定上下文的唯一方法。

# django - 使用 Django 平面页面时如何获取页面父级？

> ID：779401
> 
> 赞同：1
> 
> 时间：2009-04-22T21:51:40.173
> 
> 标签：django, django-flatpages

由于 Django url 是任意的，包括在创建平面页面时设置的那些。您如何确定页面的父级是什么？也就是说，如果我创建了一个页面 /about/contact/，那么当我在联系人页面（在模板中）时，我如何才能确定父页面是什么？

有没有标准的方法来做到这一点？还是我只是将斜杠上的块分开并使用第一部分？

基本上我想弄清楚如何创建不同的站点部分。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-23T15:08:32.007

据我所知，django 没有节的本机概念，并且正如您所说，URL 是任意的（它们留给程序员决定）。如果您在整个网站（/<section>/page）中坚持使用相同的 URL 结构，那么您可以从 URL 推断出该部分。

我宁愿在 url 模式中设置该部分并将其传递给视图（如此处所述[）](http://docs.djangoproject.com/en/dev/topics/http/urls/#passing-extra-options-to-view-functions "这里")，而视图又可以将其传递给模板......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-23T22:15:33.980

flatpages 本质上与静态 html 页面相同，存储在您的数据库中，前面有一个漂亮的管理员。

所以只需硬编码一个链接，它应该没什么大不了的。

如果这是一个大问题，那意味着平面页面可能不是你的解决方案

# java - JSP 或 JavaScript 等价于 PHP 的 $_SERVER["HTTP_HOST"]？

> ID：779403
> 
> 赞同：6
> 
> 时间：2009-04-22T21:51:49.453
> 
> 标签：java, php, javascript, url, window.location

我在我的 JavaScript 中使用了一个绝对 URL，我为 window.location 硬编码。

我不想在每次测试我的应用程序时都更改它。在 PHP 中，我会通过测试 $_SERVER["HTTP_HOST"] 变量来处理这个问题，以找出我在哪个服务器上，并进行相应的调整。但是，我对 Java 不太熟悉，想知道它是否有类似的方法？或者甚至 JavaScript 也有类似的方法？

代码如下：

```
var url = "http://172.17.1.107/store/results/index.jsp";
window.location = url; 
```

我想做的是：

```
var server = [something that returns just 172.17.1.107 (with or without the http:// is fine)]
var url = "http://" + server + "/store/results/index.jsp";
window.location = url; 
```

在 PHP 中，我会这样做：

```
var server = <?= $_SERVER["HTTP_HOST"] ?>
var url = "http://" + server + "/store/results/index.php";
window.location = url; 
```

有任何想法吗？我想我是在假设您必须使用绝对 URL 来更改 JavaScript 中当前窗口的位置的情况下进行操作的。如果有另一种方法可以在没有绝对 URL 的情况下更改 JavaScript 中的窗口位置，请随时提供。

提前致谢...

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-22T22:07:15.377

你需要的是：

```
request.getServerName() 
```

一个例子：

```
<%
String path = request.getContextPath();
String basePath = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";
%> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-22T21:59:48.467

Javascript：

```
var server = window.location.hostname; 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-22T22:01:19.900

location 对象[有几个属性](http://www.w3schools.com/HTMLDOM/dom_obj_location.asp)，你想要的是[hostname](http://www.w3schools.com/HTMLDOM/prop_loc_hostname.asp)。

或者，您可以选择只使用相对于根的 URL 并设置[pathname](http://www.w3schools.com/HTMLDOM/prop_loc_pathname.asp)属性，而完全不干扰主机业务！

```
location.pathname = "/store/results/index.jsp"; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T21:59:44.100

你真的应该搜索这个，但在 JSP 中它是：

```
request.getRemoteHost() 
```

# c# - 如何重新启动我的 C# WinForm 应用程序？

> ID：779405
> 
> 赞同：93
> 
> 时间：2009-04-22T21:52:20.327
> 
> 标签：c#, .net

开发 C# .NET 2.0 WinForm 应用程序。需要应用程序自行关闭并重新启动。

```
Application.Restart(); 
```

上述方法已[被证明是不可靠](https://stackoverflow.com/questions/95098/why-is-application-restart-not-reliable)的。

重新启动应用程序的更好方法是什么？

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2011-02-23T03:08:34.970

对我有用的更简单的方法是：

```
Application.Restart();
Environment.Exit(0); 
```

尽管事件处理程序通常会阻止应用程序关闭，但这会保留命令行参数并正常工作。

Restart() 调用尝试退出，无论如何都会启动一个新实例并返回。Exit() 调用然后终止进程，而不给任何事件处理程序运行的机会。两个进程都在很短的时间内运行，这在我的情况下不是问题，但在其他情况下可能会出现问题。

退出代码 0 in`Environment.Exit(0);`指定干净关闭。您也可以使用 1 退出以指定发生错误。

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2010-09-17T16:47:37.147

如果您处于主应用程序形式，请尝试使用

```
System.Diagnostics.Process.Start( Application.ExecutablePath); // to start new instance of application
this.Close(); //to turn off current app 
```

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2009-09-09T03:22:30.210

不幸的是，您不能使用 Process.Start() 来启动当前正在运行的进程的实例。根据 Process.Start() 文档：“如果进程已经在运行，则不会启动额外的进程资源......”

这种技术在 VS 调试器下可以正常工作（因为 VS 做了某种魔术，导致 Process.Start 认为进程尚未运行），但在调试器下不运行时会失败。（请注意，这可能是特定于操作系统的——我似乎记得在我的一些测试中，它可以在 XP 或 Vista 上运行，但我可能只是记得在调试器下运行它。）

这种技术正是我目前正在从事的项目中最后一位程序员使用的技术，并且我一直在努力寻找一种解决方法。到目前为止，我只找到了一个解决方案，我觉得它很脏而且很笨拙：启动第二个应用程序，它在后台等待第一个应用程序终止，然后重新启动第一个应用程序。我确信它会起作用，但是，糟糕。

编辑：使用第二个应用程序有效。我在第二个应用程序中所做的只是：

```
 static void RestartApp(int pid, string applicationName )
    {
        // Wait for the process to terminate
        Process process = null;
        try
        {
            process = Process.GetProcessById(pid);
            process.WaitForExit(1000);
        }
        catch (ArgumentException ex)
        {
            // ArgumentException to indicate that the 
            // process doesn't exist?   LAME!!
        }
        Process.Start(applicationName, "");
    } 
```

（这是一个非常简化的例子。真实的代码有很多健全性检查、错误处理等）

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2011-11-24T01:26:42.747

我可能迟到了，但这是我的简单解决方案，它对我拥有的每个应用程序都很有效：

```
 try
        {
            //run the program again and close this one
            Process.Start(Application.StartupPath + "\\blabla.exe"); 
            //or you can use Application.ExecutablePath

            //close this one
            Process.GetCurrentProcess().Kill();
        }
        catch
        { } 
```

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2010-01-07T14:13:17.937

我有同样的问题，我也有防止重复实例的要求——我提出了一个替代解决方案来替代 HiredMind 提出的解决方案（可以正常工作）。

我正在做的是使用旧进程（触发重启的进程）的 processId 作为 cmd 行参数来启动新进程：

```
// Shut down the current app instance.
Application.Exit();

// Restart the app passing "/restart [processId]" as cmd line args
Process.Start(Application.ExecutablePath, "/restart" + Process.GetCurrentProcess().Id); 
```

然后当新应用程序启动时，我首先解析 cm 行 args 并检查是否存在带有 processId 的重启标志，然后等待该进程退出：

```
if (_isRestart)
{
   try
   {
      // get old process and wait UP TO 5 secs then give up!
      Process oldProcess = Process.GetProcessById(_restartProcessId);
      oldProcess.WaitForExit(5000);
   }
   catch (Exception ex)
   { 
      // the process did not exist - probably already closed!
      //TODO: --> LOG
   }
} 
```

我显然没有展示我进行的所有安全检查等。

即使不理想 - 我发现这是一个有效的替代方案，因此您不必为了处理重启而安装单独的应用程序。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-04-22T21:54:06.093

## 启动/退出方法

```
// Get the parameters/arguments passed to program if any
string arguments = string.Empty;
string[] args = Environment.GetCommandLineArgs();
for (int i = 1; i < args.Length; i++) // args[0] is always exe path/filename
    arguments += args[i] + " ";

// Restart current application, with same arguments/parameters
Application.Exit();
System.Diagnostics.Process.Start(Application.ExecutablePath, arguments); 
```

这似乎比 Application.Restart();

如果您的程序防止多个实例，则不确定如何处理。我的猜测是你最好启动第二个 .exe 暂停然后为你启动你的主应用程序。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2013-04-01T07:26:31.137

很简单，你只需要调用`Application.Restart()`方法，这将调用你的应用程序重新启动。您还必须使用错误代码退出本地环境：

```
Application.Restart();
Environment.Exit(int errorcode); 
```

您可以创建错误代码的枚举，以便您的应用程序有效退出。
另一种方法是退出应用程序并使用可执行路径启动进程：

```
Application.Exit();
System.Diagnostics.Process.Start(Application.ExecutablePath); 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2016-06-24T10:21:11.243

我想出了另一个解决方案，也许任何人都可以使用它。

```
string batchContent = "/c \"@ECHO OFF & timeout /t 6 > nul & start \"\" \"$[APPPATH]$\" & exit\"";
batchContent = batchContent.Replace("$[APPPATH]$", Application.ExecutablePath);
Process.Start("cmd", batchContent);
Application.Exit(); 
```

代码已简化，因此请注意异常和其他东西；）

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-07-27T11:28:52.340

试试这个代码：

```
bool appNotRestarted = true; 
```

此代码也必须在函数中：

```
if (appNotRestarted == true) {
    appNotRestarted = false;
    Application.Restart();
    Application.ExitThread();
} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-04-23T04:34:50.810

您忘记了传递给当前正在运行的实例的命令行选项/参数。如果你不传递这些，你就没有真正重新启动。使用您的流程参数的克隆进行设置`Process.StartInfo`，然后开始。

例如，如果您的进程以 启动`myexe -f -nosplash myfile.txt`，则您的方法只会在`myexe`没有所有这些标志和参数的情况下执行。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2011-04-09T09:21:02.267

您也可以使用[Restarter](http://www.knas.se/Applications/Restarter.aspx)。

> Restarter 是一个自动监控和重启崩溃或挂起的程序和应用程序的应用程序。它最初是为监视和重启游戏服务器而开发的，但它可以为任何基于控制台或表单的程序或应用程序完成这项工作

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2012-06-07T08:37:45.523

我希望在旧应用程序关闭后启动新应用程序。

使用 process.WaitForExit() 等待您自己的进程关闭是没有意义的。它总是会超时。

所以，我的方法是使用 Application.Exit() 然后等待，但允许事件被处理一段时间。然后使用与旧应用程序相同的参数启动一个新应用程序。

```
static void restartApp() {
    string commandLineArgs = getCommandLineArgs();
    string exePath = Application.ExecutablePath;
    try {
        Application.Exit();
        wait_allowingEvents( 1000 );
    } catch( ArgumentException ex ) {
        throw;
    }
    Process.Start( exePath, commandLineArgs );
}

static string getCommandLineArgs() {
    Queue<string> args = new Queue<string>( Environment.GetCommandLineArgs() );
    args.Dequeue(); // args[0] is always exe path/filename
    return string.Join( " ", args.ToArray() );
}

static void wait_allowingEvents( int durationMS ) {
    DateTime start = DateTime.Now;
    do {
        Application.DoEvents();
    } while( start.Subtract( DateTime.Now ).TotalMilliseconds > durationMS );
} 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2014-02-20T22:10:59.663

我担心使用 Process 重新启动整个应用程序会以错误的方式解决您的问题。

更简单的方法是修改Program.cs文件重启：

```
 static bool restart = true; // A variable that is accessible from program
    static int restartCount = 0; // Count the number of restarts
    static int maxRestarts = 3;  // Maximum restarts before quitting the program

    /// <summary>
    /// The main entry point for the application.
    /// </summary>
    [STAThread]
    static void Main()
    {
        Application.EnableVisualStyles();
        Application.SetCompatibleTextRenderingDefault(false);

        while (restart && restartCount < maxRestarts)
        {
           restart = false; // if you like.. the program can set it to true again
           restartCount++;  // mark another restart,
                            // if you want to limit the number of restarts
                            // this is useful if your program is crashing on 
                            // startup and cannot close normally as it will avoid
                            // a potential infinite loop

           try {
              Application.Run(new YourMainForm());
           }
           catch {  // Application has crashed
              restart = true;
           }
        }
    } 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2016-07-01T09:25:10.423

```
public static void appReloader()
    {
        //Start a new instance of the current program
        Process.Start(Application.ExecutablePath);

        //close the current application process
        Process.GetCurrentProcess().Kill();
    } 
```

*Application.ExecutablePath*返回您的应用程序 .exe 文件路径 请按照调用顺序。您可能希望将其放在 try-catch 子句中。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2011-12-15T01:54:38.463

如何创建一个bat文件，在关闭之前运行批处理文件，然后关闭当前实例。

批处理文件执行此操作：

1.  循环等待以检查进程是否已退出。
2.  开始这个过程。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2012-03-27T15:42:40.623

这是我的 2 美分：

序列 Start New Instance->Close Current Instance 即使对于不允许同时运行多个副本的应用程序也应该有效，因为在这种情况下，可能会向新实例传递一个命令行参数，该参数将指示正在重新启动因此不需要检查其他正在运行的实例。如果绝对没有两个实例并行运行是绝对必要的，那么等待第一个实例实际完成我的实现也是如此。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2017-02-15T15:50:50.193

使用**Application.Restart()**的问题是，它启动了一个新进程，但“旧”进程仍然存在。因此，我决定使用以下代码片段来终止旧进程：

```
 if(Condition){
            Application.Restart();
            Process.GetCurrentProcess().Kill();
            } 
```

而且效果很好。在我的例子中，MATLAB 和一个 C# 应用程序共享同一个 SQLite 数据库。如果 MATLAB 正在使用数据库，Form-App 应该再次重新启动（+倒计时），直到 MATLAB 重置其在数据库中的忙位。（仅供参考）

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2011-04-09T09:11:23.257

我遇到了类似的问题，但我的问题与无法管理的内存泄漏有关，我在必须 24/7 运行的应用程序上找不到该问题。我与客户同意，如果内存消耗超过定义值，则重新启动应用程序的安全时间是凌晨 03:00。

我试过`Application.Restart`了，但由于它似乎使用了一些在新实例已经运行时启动新实例的机制，所以我选择了另一种方案。我使用了文件系统处理持续存在直到创建它们的进程死亡的技巧。所以，从应用程序，我把文件放到磁盘上，但没有`Dispose()`处理。我也使用该文件来发送“我自己”的可执行文件和起始目录（以增加灵活性）。

代码：

```
_restartInProgress = true;
string dropFilename = Path.Combine(Application.StartupPath, "restart.dat");
StreamWriter sw = new StreamWriter(new FileStream(dropFilename, FileMode.Create, FileAccess.ReadWrite, FileShare.ReadWrite));
sw.WriteLine(Application.ExecutablePath);
sw.WriteLine(Application.StartupPath);
sw.Flush();
Process.Start(new ProcessStartInfo
{
    FileName = Path.Combine(Application.StartupPath, "VideoPhill.Restarter.exe"),
    WorkingDirectory = Application.StartupPath,
    Arguments = string.Format("\"{0}\"", dropFilename)
});
Close(); 
```

`Close()`最后将启动应用程序关闭，并且我在`StreamWriter`这里使用的文件句柄将保持打开状态，直到进程真正终止。然后...

Restarter.exe 开始行动。它尝试以独占模式读取文件，防止它获得访问权限，直到主应用程序没有死，然后启动主应用程序，删除文件并存在。我想它不能更简单：

```
static void Main(string[] args)
{
    string filename = args[0];
    DateTime start = DateTime.Now;
    bool done = false;
    while ((DateTime.Now - start).TotalSeconds < 30 && !done)
    {
        try
        {
            StreamReader sr = new StreamReader(new FileStream(filename, FileMode.Open, FileAccess.ReadWrite, FileShare.ReadWrite));
            string[] runData = new string[2];
            runData[0] = sr.ReadLine();
            runData[1] = sr.ReadLine();
            Thread.Sleep(1000);
            Process.Start(new ProcessStartInfo { FileName = runData[0], WorkingDirectory = runData[1] });
            sr.Dispose();
            File.Delete(filename);
            done = true;
        }
        catch (Exception ex)
        {
            Console.WriteLine(ex.Message);
        }
        Thread.Sleep(1000);
    }
} 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2015-10-28T16:16:36.070

我使用以下内容，它完全符合您的要求：

```
ApplicationDeployment ad = ApplicationDeployment.CurrentDeployment;
UpdateCheckInfo info = null;
info = ad.CheckForDetailedUpdate();
if (info.IsUpdateRequired)
{
    ad.UpdateAsync(); // I like the update dialog
    MessageBox.Show("Application was upgraded and will now restart.");
    Environment.Exit(0);
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2015-12-31T05:09:02.180

对于使用 As logout，您需要从 Ram Cache 中终止所有应用程序，因此首先关闭应用程序，然后重新运行它

//点击注销按钮

```
foreach(Form frm in Application.OpenForms.Cast<Form>().ToList())
        {
            frm.Close();
        }
System.Diagnostics.Process.Start(Application.ExecutablePath); 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2019-07-13T15:01:01.180

您可以将代码包含在一个函数中，当需要重新启动时，您可以调用该函数。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2020-12-02T13:30:31.080

以一个应用程序为例：

1.  申请未注册时；（启动时）应用程序应提示用户注册应用程序并创建登录帐户。

2.  提交注册并创建登录凭据后；应用程序应重新启动，检查注册并提示用户使用插入的凭据登录（以便用户可以访问所有应用程序功能）。

**问题：** 通过从 Visual Studio 构建和启动应用程序；以下 4 个备选方案中的任何一个都无法完成所需的任务。

```
/*
 * Note(s):
 * Take into consideration that the lines bellow don't represent a code block.
 * They are just a representation of possibilities,
 * that can be used to restart the application.
 */

Application.Restart();
Application.Exit();
Environment.Exit(int errorCode);
Process.GetCurrentProcess().Kill(); 
```

会发生什么：创建注册后，登录并调用 Application.Restart(); 应用程序将（奇怪地）重新打开注册表并跳过数据库中的数据（即使资源设置为“如果较新则复制”）。

**解决方案：** 批量构建应用程序（对我而言）证明上述任何行实际上都按预期工作。只是不是在使用 Visual Studio 构建和运行应用程序时。

首先，我会尝试批量构建应用程序；在 Visual Studio 之外运行它并检查 Application.Restart() 是否确实按预期工作。

**另请检查有关此线程主题的更多信息：** [如何重新启动我的 C# WinForm 应用程序？](https://stackoverflow.com/questions/779405/how-do-i-restart-my-c-sharp-winform-application)

# java - Java 泛型对 存储在 HashMap 中没有正确检索 key->value

> ID：779414
> 
> 赞同：3
> 
> 时间：2009-04-22T21:54:46.047
> 
> 标签：java, string, generics, hashmap

这是对.java

```
import java.lang.*; 
import java.util.*; 

public class Pair<TYPEA, TYPEB> implements Comparable< Pair<TYPEA, TYPEB> > {
  protected final TYPEA Key_;
  protected final TYPEB Value_;

  public Pair(TYPEA key, TYPEB value) {
    Key_   = key;
    Value_ = value;
  }
  public TYPEA getKey() {
    return Key_;
  }
  public TYPEB getValue() {
    return Value_;
  }
  public String toString() {
    System.out.println("in toString()");
    StringBuffer buff = new StringBuffer();
      buff.append("Key: ");
      buff.append(Key_);
      buff.append("\tValue: ");
      buff.append(Value_);
    return(buff.toString() );
  }
  public int compareTo( Pair<TYPEA, TYPEB> p1 ) { 
    System.out.println("in compareTo()");
    if ( null != p1 ) { 
      if ( p1.equals(this) ) { 
        return 0; 
      } else if ( p1.hashCode() > this.hashCode() ) { 
            return 1;
      } else if ( p1.hashCode() < this.hashCode() ) { 
        return -1;  
      }
    }
    return(-1);
  }
  public boolean equals( Pair<TYPEA, TYPEB> p1 ) { 
    System.out.println("in equals()");
    if ( null != p1 ) { 
      if ( p1.Key_.equals( this.Key_ ) && p1.Value_.equals( this.Value_ ) ) { 
        return(true);
      }
    }
    return(false);
  }
  public int hashCode() { 
    int hashCode = Key_.hashCode() + (31 * Value_.hashCode());
    System.out.println("in hashCode() [" + Integer.toString(hashCode) + "]");
    return(hashCode);
  }
} 
```

这是测试用例：

```
import java.lang.*; 
import java.util.*;

import junit.framework.*;

public class PairTest extends TestCase { 

  public void testPair() { 
    String key   = new String("key"); 
    String value = new String("asdf"); 

    Pair<String, String> pair = new Pair<String, String>( key, value ); 

    assertTrue( pair.getKey().equals( key ) );
    assertTrue( pair.getValue().equals( value ) );
    assertTrue( pair.equals( new Pair<String, String>(key, value)) );
  }

  public void testPairCollection() { 

    HashMap< Pair<String, String>, String> hm1 = new HashMap<Pair<String,String>, String>(); 

    Pair<String, String> p1 = new Pair<String, String>("Test1", "Value1"); 
       hm1.put(p1, "ONE");  
    Pair<String, String> p2 = new Pair<String, String>("Test1", "Value2"); 
       hm1.put(p2, "TWO");  
    Pair<String, String> p3 = new Pair<String, String>("Test2", "Value1"); 
       hm1.put(p3, "THREE");    
    Pair<String, String> p4 = new Pair<String, String>("Test2", "Value2"); 
       hm1.put(p4, "FOUR"); 
    Pair<String, String> p5 = new Pair<String, String>("Test3", "Value1"); 
       hm1.put(p5, "FIVE"); 
    Pair<String, String> p6 = new Pair<String, String>("Test3", "Value2"); 
       hm1.put(p6, "SIX");  
    Pair<String, String> p7 = new Pair<String, String>("Test3", "Value3"); 
       hm1.put(p7, "SEVEN");    

    assertTrue( hm1.size() == 7 ); 

    Pair<String, String> pSrch = new Pair<String, String>("Test3", "Value3"); 
    assertTrue( p7.equals(pSrch) );
    assertTrue( pSrch.equals(p7) );
    assertTrue( p7.hashCode() == pSrch.hashCode() ); 
    assertTrue( 0 == p7.compareTo( pSrch ) );
    assertTrue( 0 == pSrch.compareTo(p7) );

    System.out.println("starting containsKey search");
    assertTrue( hm1.containsKey( p7 ) );
    System.out.println("starting containsKey search2");
    assertTrue( hm1.containsKey( pSrch ) );
    System.out.println("finishing containsKey search");

    String result = hm1.get( pSrch );
    assertTrue( null != result );
    assertTrue( 0 == result.compareTo("SEVEN"));

  } 
} 
```

这是我的问题，最后一个 hm1.containsKey 调用应该（我天真地期望）返回存储在 Pair<"Three", "Three"> 为真的地方的值 - 我应该得到一个值为 "SEVEN" 的字符串。这是输出：

```
Running in equals()
in hashCode() [1976956095]
in hashCode() [1976956126]
in hashCode() [1976956096]
in hashCode() [1976956127]
in hashCode() [1976956097]
in hashCode() [1976956128]
in hashCode() [1976956159]
in equals()
in equals()
in hashCode() [1976956159]
in hashCode() [1976956159]
in compareTo()
in equals()
in compareTo()
in equals()
starting containsKey search
in hashCode() [1976956159]
starting containsKey search2
in hashCode() [1976956159]     <--- Bug here?

Never reaches 
          String result = hm1.get( pSrch ); 
```

p7.hashCode() 和 pSrch.hashCode() 也是一样的，p7.equals(pSrch) 和 pSrch.equals(p7) 和 hm1.containsValue(p7) == true，我希望 hm1.containsValue(pSrch ) 也会返回 true，但事实并非如此。我错过了什么？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-04-22T22:07:49.900

您需要*覆盖*类中的`equals`方法`java.lang.Object`。

相反，您已经用一个额外的版本*重载*了该方法，该版本需要一个`Pair`. 永远不会被调用的完全不同的方法。`equals`用这样的东西替换你的：

```
@Override
public boolean equals(Object o) { 
  System.out.println("in equals()");
  if (o instanceof Pair) { 
    Pair<?, ?> p1 = (Pair<?, ?>) o;
    if ( p1.Key_.equals( this.Key_ ) && p1.Value_.equals( this.Value_ ) ) { 
      return(true);
    }
  }
  return(false);
} 
```

为避免此类错误，请`@Override`在您打算用作覆盖的方法上使用注释。如果没有，你会得到一个编译时错误。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-22T22:15:59.677

您应该已经注意到，在“开始 containsKey search2”之后它不会打印“in equals()”。您也可以调试到 HashMap 以查看 .equals() 方法被调用并返回 false。那是因为

```
public boolean equals( Pair<TYPEA, TYPEB> p1 ) 
```

不覆盖

```
public boolean equals(Object obj) 
```

在 java.lang.Object 中定义

将您的代码更改为

```
 public boolean equals( Object obj ) {
    if (!(obj instanceof Pair)) return false;
    Pair p1 = (Pair) obj; 
```

它有效。您可以通过在您认为要覆盖的方法之前放置 @Override 注释来避免将来出现此类错误。如果您实际上没有覆盖它，编译器会告诉您。这

```
@Override public boolean equals( Pair<TYPEA, TYPEB> p1 ) 
```

导致编译错误。这

```
@Override public boolean equals( Object obj ) 
```

才不是。好的 IDE（例如 Intellij IDEA）也显示了哪些方法被覆盖。

# resource-management - 寻找“工作中的洗碗机”的解决方案

> ID：779415
> 
> 赞同：9
> 
> 时间：2009-04-22T21:55:13.800
> 
> 标签：resource-management

我正在寻找一种适用于“工作中的洗碗机”问题的算法。

虽然可以将脏咖啡杯等放入其中很棒，但您很快就会遇到“盘子的状态如何？” 困境。如果你走到厨房，你能从洗碗机里拿盘子，因为它们很干净，只是没有收起来吗？您可以将脏盘子放入洗碗机中，否则会使里面的干净盘子失效吗？

这似乎是一个必须具有编程等价物的问题。您有一个异步触发的共享进程，并将对象从一种状态移动到另一种状态。您需要能够在任何给定时间了解对象的状态。可以应用哪些算法？

我的开始选择是在“干净”和“脏”的洗碗机上创建一个翻转标志。当洗碗机清空时，必须切换到“脏”，运行时必须切换到“清洁”。该算法有问题吗？有没有更好/更不容易出错的？

注意：请不要使用轮询时间表的算法...

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-22T22:15:38.010

`User`当线程想要将脏东西`Dish`放入其他干净的洗碗机中时，就会出现问题中的主要问题。

解决方案很简单。创建另一个`Dishwasher`对象。

一个`Dishwasher`拿着脏盘子，等着清洗，另一个拿着最近清洗过的盘子。

当`Dishwasher`盛着干净的盘子是空的，开始清洗另一个盘子里的脏盘子`Dishwasher`。

此时，`User`线程现在可以将脏盘子放入曾经是干净的`Dishwasher`（现在是空的）的地方。

`Dishwashers`继续无限期地交替两者的角色。`User`线程总是可以丢弃脏盘子，而无需`KitchenCounterBuffer`.

注意：此解决方案不能解决杯子饥饿问题。`User`线程仍然可能会阻塞等待洗碗机完成清洁。

注意 2：在单例的受限环境中`Dishwasher`，提供 a`KitchenCounterBuffer`和 a`DishwasherOperator`来收起盘子并将脏盘子从`KitchenCounterBuffer`到`Dishwasher`。然后在上面的算法`KitchenCounterBuffer`中扮演脏的角色。`Dishwasher`但是，这可能会导致`User`线程抛出异常或死亡。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-23T00:58:29.023

与编程无关，但它可能有助于回答您的逻辑问题......我的洗碗机有一个“清洁”灯，当您运行洗衣机时会亮起。如果您只是打开门很短时间（即取出一个干净的杯子），灯会保持亮起，但如果您将门打开更长的时间（足够清空洗衣机的时间），灯就会熄灭。这并不完美，但它比必须由（有点健忘的）人翻转的前面的旗帜更可靠。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T22:04:11.827

我假设洗碗机中的所有物品都必须干净或脏，但不能混搭。下面的解决方案强制执行该属性。如果不是，那你的比喻就不太对了。

只需几个互斥锁就可以解决问题。

你有四个州。

*   洗碗机空了，你可以放脏盘子
*   洗碗机脏了，可以放脏盘子
*   洗碗机运行，您不能放置脏盘子或移除干净的盘子。
*   洗碗机干净，你不能放脏盘子，可以取出干净的盘子。

您可以进一步将空和脏一起折叠，因为您不关心差异。

*   当你想插入一些东西时，你等待 DirtyMutex
*   当您想开始洗涤时，请等待 DirtyMutex 以免浪费水；）
*   清洗结束时，您会发出 CleanMutex 信号
*   当您想清空洗碗机时，您可以等待 CleanMutex
*   当洗碗机空了时，您会发出 DirtyMutex 信号

这假设您可以知道洗碗机何时是空的，如果没有，您将需要 ElementsInDishwasher 的计数信号量，然后再发出 DirtyMutex 信号。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-22T22:06:24.847

我喜欢你的比喻，但潜在的问题让我担心。以我的经验，一个设计良好的系统总是知道（通常是隐含地）你所指的那种状态。例如，共享资源队列中的资源可供其他进程使用——如果不是，它就不会在队列中。或者，工作线程正在修改的资源处于线程处理所说的任何状态——更重要的是，没有其他线程**需要**知道它是“干净”还是“脏”。

我还没有遇到（或发明:-）的有效设计模式数量之多令人难以置信，但是您所描述的内容暗示着设计气味（或脏盘子）而不是有效模式。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-22T22:13:51.493

也许[有限状态机](http://en.wikipedia.org/wiki/Event_driven_finite_state_machine)适合您要解决的问题？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-20T22:13:30.533

只是制定一个规则，总是从洗碗机中取出干净的盘子，所以任何东西=脏，你可以添加更多

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-06-20T22:39:02.417

看，这就是程序性思维的问题。它将一切都变成了一个批处理过程，这在异步、事件驱动的世界中表现不佳。你需要开始担心状态、线程、竞争条件、持久性等。

避免这些问题的解决方案是使所有菜肴不可变。如果您需要一个脏盘子，您只需创建一个带有污垢的新实例。

如果获取菜的干净副本是一种常见操作（听起来像您的情况），您可以向您的 Dish 对象添加一个 .AsClean() 方法，它会自动为您返回一个干净的克隆。如果性能成为瓶颈，可以通过`this`在实例已经干净的情况下返回来优化。

当然，这假设您处于具有合理堆空间和自动垃圾收集的环境中。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-06-20T22:42:36.917

我见过商业洗碗机通过隧道在传送带上传送盘子。你把脏盘子放在左边的架子上。你从右边的架子上拿干净的盘子。单个盘子的清洁/脏污状态与其在机器内的物理位置相对应。

这是一个完全不同的架构。对于标准洗碗机，您认为“干净/脏”是洗碗机的一个属性。“干净”的意思是“没有脏盘子”。对于传送式洗碗机，“干净/脏”不是洗碗机的属性。

您可能不想切换到此架构，但如果您这样做，请考虑通过并发阻塞队列连接的一系列处理对象。一个盘子进入预冲洗器，出来，进入洗衣机，出来，进入烘干机，最后出来。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-22T22:15:11.130

正如您所指出的（干净/脏），您只需要一个标志。洗碗机通常已经提供了这种机制：（物理）锁。

*   洗碗机开始清空，解锁
*   洗碗机已解锁，因此可能会将脏盘子放入其中
*   在运行洗碗机之前，它被锁定
*   运行后还是被锁住，说明里面的东西都是脏的
*   如果您从中删除某些东西，并且它不是最后一个项目，则重新锁定它

在软件意义上，锁只在于能够将盘子放入洗碗机——你会根据它是否被锁定来知道被移除的盘子是干净还是脏，但只有在它被锁定时才能将盘子放进去。解锁。如果你拿走最后一道菜，你就会解锁它。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-22T22:20:40.803

一个简单的解决方案是保持始终为真的不变量。这样一组不变量的示例可以是：

*   如果洗碗机是空的/没有完全装满 - 所有的盘子都是脏的
*   如果洗碗机满了 - 那么所有的盘子都是干净的。

与洗碗机交互的对象的工作是保持这些不变量的顺序。如果有人在洗碗机里加了一个杯子，它就满了，他也必须打开它，这样下一个过来的人会发现洗碗机已经满了，所有的杯子都是干净的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-06-20T23:01:55.710

你能让洗碗机在洗涤周期结束时自动弹出它的碗碟吗？

这类似于 Mark Lutton 的想法，类似于将清洗过的盘子推到（可能是临时的）已知干净盘子的队列中，然后可以将它们从队列中取出。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-06-20T23:15:05.417

这是由于使用衰变技术而导致的设计问题 - 通过将设计的一部分更新为更高级的形式，您可以摆脱整个问题并节省时间、水和能源。

使用可食用的盘子？

# asp.net-mvc - 如何防止在 asp.net mvc ajax 表单中自动填充发布的值

> ID：779421
> 
> 赞同：0
> 
> 时间：2009-04-22T21:56:56.073
> 
> 标签：asp.net-mvc

在 asp.net mvc 部分视图中，我有一个 Ajax 表单，它发布一个值并将其父容器的内容替换为表单的另一个实例。

Index.aspx 视图：

```
<div id="tags">
    <% Html.RenderPartial("Tags", Model); %>
</div> 
```

Tags.ascx 局部视图：

```
<% using(Ajax.BeginForm("tag", new AjaxOptions { UpdateTargetId = "tags" }))
    { %>
        Add tag: <%= Html.TextBox("tagName")%>
        <input type="submit" value="Add" />
<%  } %> 
```

控制器：

```
[AcceptVerbs(HttpVerbs.Post)]
public ActionResult Tag(string tagName) {
    // do stuff
    return PartialView("Tags", ...);
} 
```

问题是当表单的新实例返回时，发布的值已经存储在输入字段中。例如，我发布为“tagName”的任何内容都将保留在文本框中。Firebug 显示该值在响应中是硬编码的。

返回部分视图时有什么方法可以清除输入文本框的值？

我试过了：

```
<%= Html.TextBox("tagName", string.Empty)%> 
```

和

```
<%= Html.TextBox("tagName", string.Empty, new { value = "" })%>` 
```

两者都不做任何事情。

编辑：

我意识到有 js 解决方案，我可能最终不得不使用，但我想知道是否有任何方法可以在后端做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T22:03:41.033

我不确定这个解决方案对你来说是否“足够好”，但你不能从你的 ajax 调用中清空 JS 回调函数中的表单吗？如果您在网站上使用[jQuery](http://www.jquery.com "如果你不使用它 - 去下载吧！")，回调函数可能如下所示：

```
function emptyFormOnReturn() {
    $(':input').val();
} 
```

我不完全确定它是否会，但如果上面的代码也删除了提交按钮上的文本，请将选择器更改为`':input[type!=submit]'`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-23T07:25:35.817

是的，如果您将代码更改为使用 jquery 进行 ajax 操作，您应该使用 jquery 设置响应值，您可以在成功回调时调用 settingvalues 函数...例如：

[http://docs.jquery.com/Ajax/jQuery.ajax#options](http://docs.jquery.com/Ajax/jQuery.ajax#options)

# iphone - 有没有人通过原生 iPhone 应用程序实现了 PayPal API？

> ID：779423
> 
> 赞同：36
> 
> 时间：2009-04-22T21:57:07.070
> 
> 标签：iphone, objective-c, cocoa-touch, paypal

似乎留在“应用程序”中的唯一方法是给他们一个贝宝移动网站的 UIWebView 并让他们在那里完成交易，否则用户将需要使用他们的 API 密钥。

这听起来对吗？有人得到或看过任何示例代码吗？我不得不认为这是一段常见的代码。

更新：苹果会允许这样做吗？这是一个慈善应用程序，所以我假设没有问题。

重新更新：我假设错了。Apple 将不允许使用 paypal 在应用程序内直接付款。您必须重新定向到 Web 界面。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-05-12T02:40:30.410

重新更新：如下面的回答，此代码对于购买实物商品可能仍然有用

* * *

更新：

尽管此代码有效，但 App Store 条款不允许您在应用程序中使用此代码。

* * *

原答案：

经过大量的 API 研究后，我发现了这一点。下面是一个创建 HTTP POST 以发送到 Paypal 并发出 NSURLRequest 的方法。您可以填写适当的字符串格式变量。我使用[HTTP 客户端](http://ditchnet.org/httpclient/)来检查我在做什么。

```
- (void)sendPayPalRequestPOST{

perfomingSetMobileCheckout=YES;
recordResults = FALSE;

NSString *parameterString = [NSString stringWithFormat:@"USER=%@&PWD=%@&SIGNATURE=%@&VERSION=57.0&METHOD=SetMobileCheckout&AMT=%.2f&CURRENCYCODE=USD&DESC=%@&RETURNURL=%@", userName, password, signature, self.donationAmount, @"Some Charge", returnCallURL];

NSLog(parameterString);

NSURL *url = [NSURL URLWithString:paypalUrlNVP];
NSMutableURLRequest *theRequest = [NSMutableURLRequest requestWithURL:url];
NSString *msgLength = [NSString stringWithFormat:@"%d", [parameterString length]];

[theRequest addValue: msgLength forHTTPHeaderField:@"Content-Length"];
[theRequest setHTTPMethod:@"POST"];
[theRequest setHTTPBody: [parameterString dataUsingEncoding:NSUTF8StringEncoding]];

NSURLConnection *theConnection = [[NSURLConnection alloc] initWithRequest:theRequest delegate:self];

if( theConnection ){
    webData = [[NSMutableData data] retain];
    [self displayConnectingView];

}else{
    NSLog(@"theConnection is NULL");
}
} 
```

在此之后，您需要解析响应，获取会话密钥并创建一个 UIWebView 以将它们带到移动 paypal 站点。Paypal 允许您指定一个“返回 URL”，您可以根据需要进行任何操作。只需继续检查该地址的委托方法中的 UIWebview，然后您就知道事务已完成。

然后，您再向 Paypal 发送一个 HTTP Post（类似于上面的一个）以完成交易。您可以在 Paypal Mobile Checkout API 文档中找到 API 信息。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-12-10T15:29:44.533

Apple 将允许对实体购买进行自定义结账。我在伦敦的 iPhone Tech Talks 上与他们进行了交谈，他们说他们将不支持使用 In App Purchase 进行实体购买，因为他们必须处理退款等问题。他们还提到了具有自定义结账功能的现有应用程序。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-28T22:34:33.080

当您对 Apple 允许在应用程序中进行慈善捐赠说“我认为是错误的”时，您能提供更多信息吗？我正在开发一个应用程序，并且要求允许慈善捐赠...我无法从 Apple 中找到任何严格禁止它的内容，但我无法找到允许慈善捐赠的应用程序商店，要么。

（我在纠结是否要在这里发布这个问题，而不是作为一个新的顶级问题，但你是我遇到的第一个直接了解 iPhone 应用程序问题中的慈善捐赠的人）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-08-10T11:36:18.557

不能使用 Paypal 的移动支付库吗？

[https://www.x.com/community/ppx/xspaces/mobile/mep?view=overview](https://www.x.com/community/ppx/xspaces/mobile/mep?view=overview)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-03-12T16:40:16.013

根据您需求的复杂程度，[PayPal 的 iOS SDK](https://github.com/paypal/PayPal-iOS-SDK/)（2013 年 3 月发布）可能是合适的选择。

# java - 如何编写或多或少充当容器的应用程序？

> ID：779429
> 
> 赞同：0
> 
> 时间：2009-04-22T21:59:41.247
> 
> 标签：java, hibernate, transactions, containers

我正在计划一个应用程序，它必须为第三方扩展代码提供非常类似于 Java EE 容器的服务。基本上，这个应用程序所做的是找到一组工作项（目前，计划是使用 Hibernate）并将它们分派给工作项消费者。

工作项消费者加载项详细信息，调用第三方扩展代码，然后如果第三方代码没有失败，则更新工作项的某些状态并提交所有已完成的工作。

我明确没有将其编写为 Java EE 应用程序。但是，本质上，我的应用程序必须提供容器的许多服务；它必须提供事务管理、连接池和管理，以及一定的部署支持。我如何 A) 直接提供这些，或 B) 选择第三方库来提供它们。由于较大项目的要求，扩展编写者将使用 Hibernate，如果这有什么不同的话。

值得注意的是，在我提到的所有功能中，我最不了解的是事务管理。如何为在我的容器中运行的扩展代码提供此服务？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-22T23:14:59.490

嗨，我建议使用 Spring Framework。它提供了一种很好的方式来汇集您正在谈论的许多不同的服务。

例如，为了满足您的特定需求：

1.  事务管理/连接池
    *   我构建了一个使用 Apache commons 连接池的基于 spring 的独立应用程序。另外我相信 spring 内置了某种事务管理。
2.  部署支持
    *   我使用 ant 作为前端加载器来部署和运行东西。它工作得很好。我只是使用 ant 分叉一个单独的进程来运行我的 Spring 独立应用程序。
3.  穿线。
    *   Spring 支持 Quartz，它可以很好地处理线程和线程池
4.  道
    *   Spring 与 Hibernate 和其他类似项目很好地集成
5.  配置
    *   使用它的 xml 属性定义——Spring 非常适合多环境配置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-23T14:39:41.433

Spring确实有事务管理。您可以使用 Apache DBCP 在应用程序上下文中定义一个数据源（使用 a`org.apache.commons.dbcp.BasicDataSourceorg.springframework.jdbc.datasource.DataSourceTransactionManager`作为数据源。之后，如果您将 TransactionManager 传递给应用程序中的任何对象，则可以通过编程方式定义自己的事务，或者您可以在对象的定义上使用 AOP 拦截器在您的应用程序上下文中，定义哪些方法需要在事务中运行。

或者，现在使用 Spring 更简单的方法是在需要在事务中运行的任何方法中使用 @Transactional 注释，并将类似这样的内容添加到您的应用程序上下文中（假设您的 transactionManager 名为 txManager）：

`<tx:annotation-driven transaction-manager="txManager"/>`

这样，您的应用程序稍后将轻松接受新组件，只需使用 @Transactional 注释或通过 PlatformTransactionManager 直接创建事务，它们将通过 setter 接收（因此您可以在定义对象时传递它）在您的应用程序上下文中）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-02T20:36:46.390

您可以在 J2SE 环境中尝试用于 Java 事务管理和连接池 (JDBC+JMS) 的[Atomikos TransactionsEssentials 。](http://www.atomikos.com/Main/TransactionsEssentials)不需要任何应用服务器，使用起来更有趣；-)

HTH 家伙

# asp.net-mvc - Asp.Net MVC 如何获取视图以生成 PDF

> ID：779430
> 
> 赞同：74
> 
> 时间：2009-04-22T21:59:42.900
> 
> 标签：asp.net-mvc, pdf

我想在控制器上调用一个动作。让控制器从模型中获取数据。然后视图运行并生成 PDF。我发现的唯一例子是 Lou [http://whereslou.com/2009/04/12/returning-pdfs-from-an-aspnet-mvc-action](http://whereslou.com/2009/04/12/returning-pdfs-from-an-aspnet-mvc-action)的一篇文章。他的代码非常优雅。该视图使用 ITextSharp 生成 PDF。唯一的缺点是他的示例使用了 Spark View Engine。有没有办法用标准的微软视图引擎做类似的事情？

* * *

## 回答 #1

> 赞同：83
> 
> 时间：2009-04-22T22:19:48.840

我使用 iTextSharp 在 MVC 中生成动态 PDF。您需要做的就是将您的 PDF 放入一个 Stream 对象，然后您的 ActionResult 返回一个 FileStreamResult。我还设置了内容处置，以便用户可以下载它。

```
公共 FileStreamResult PDFGenerator()
{
    流文件流 = GeneratePDF();

    HttpContext.Response.AddHeader("内容配置",
    “附件；文件名=form.pdf”）；

    return new FileStreamResult(fileStream, "application/pdf");
}

```

我还有一些代码可以让我获取模板 PDF、向其中写入文本和图像等（如果你想这样做的话）。

*   注意：您必须将 Stream 位置设置为 0。

```
私有流 GeneratePDF()
{
    //创建您的pdf并将其放入流中...下面的pdf变量
    //来自我用来将内容写入 PDF 文件的类

    内存流毫秒 = 新的内存流（）；

    byte[] byteInfo = pdf.Output();
    ms.Write(byteInfo, 0, byteInfo.Length);
    ms.位置 = 0;

    返回毫秒；
}

```

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2014-10-30T14:25:41.750

我们对这个问题的最终答案是使用[Rotativa](https://www.nuget.org/packages/Rotativa/)。

它像其他一些解决方案一样包装了 WKhtmltopdf.exe，但它是迄今为止我发现的最容易使用的

我去投票了所有其他也很好地解决了问题的答案，但这就是我们用来解决上述问题中提出的问题的方法。它与其他答案不同。

这是一个[Rotativa教程](http://www.codeproject.com/Articles/335595/Rotativa-how-to-print-PDF-in-Asp-Net-MVC)。

安装后，这就是你所需要的

```
public ActionResult PrintInvoice(int invoiceId)
{
  return new ActionAsPdf(
                 "Invoice", 
                 new { invoiceId= invoiceId }) 
                 { FileName = "Invoice.pdf" };
} 
```

非常非常简单。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2014-03-26T21:54:11.523

在 html 中创建布局并随后打印成 pdf 是最快的方法。

Html 到 pdf 的转换由[phantomjs](http://phantomjs.org)、[wkhtmltopdf](http://wkhtmltopdf.org)或[jsreport提供](http://jsreport.net)

[jsreport](http://jsreport.net)提供与 asp.net mvc 视图的直接集成，您可以在其中使用属性标记控制器操作，它会为您打印 pdf 而不是 html。

更多关于这篇[博文](http://jsreport.net/blog/rendering-pdf-from-aspnet-mvc-views)

免责声明：我是jsreport的作者

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2014-10-29T17:45:58.373

这是一个古老的问题，但仍然具有相关性，我想我只是分享我已经实现的效果很好的东西。

1.  安装 NuGet 包 TuesPechkin - 基于 WkHtmlToPdf 的 Pechkin 库中的一个分支，它使用 Webkit 引擎将 HTML 页面转换为 PDF。

2.  编写一个小助手来读取视图并将其转换为 HTML 字符串（mvcContext 是 this.HttpContext）。替换当然是可选的！：

    ```
    public static string RenderViewToString(HttpContextBase mvcContext, string area, string controllerName, string viewName, object model)
    {
        var context = System.Web.HttpContext.Current;
        var contextBase = mvcContext;
        var routeData = new RouteData();
        if (area == null) area = "";

        routeData.DataTokens.Add("area", area);

        routeData.Values.Add("controller", controllerName);

        var controllerContext = new ControllerContext(contextBase,
                                                routeData,
                                                new EmptyController());

        var razorViewEngine = new RazorViewEngine();
        var razorViewResult = razorViewEngine.FindView(controllerContext,
                                                    viewName,
                                                    "",
                                                false);

        var writer = new StringWriter();
        var viewContext = new ViewContext(controllerContext,
                                    razorViewResult.View,
                                    new ViewDataDictionary(model),
                                    new TempDataDictionary(),
                                    writer);
        razorViewResult.View.Render(viewContext, writer);

        string hostAddress = context.Request.Url.Scheme + "://" + context.Request.Url.Authority;

        return writer.ToString()
                     .Replace("src=\"/", "src=\"" + hostAddress + "/")
                     .Replace("<link href=\"/", "<link href=\"" + hostAddress + "/");                         
    }

    class EmptyController : ControllerBase
    {
        protected override void ExecuteCore() { }
    } 
    ```

以上的辛勤工作来自这里：[http ://wouterdekort.blogspot.co.uk/2012/10/rendering-aspnet-mvc-view-to-string-in.html?showComment=1414603363455#c7863520150405064571](http://wouterdekort.blogspot.co.uk/2012/10/rendering-aspnet-mvc-view-to-string-in.html?showComment=1414603363455#c7863520150405064571)

3.  创建一个 MVC Action 来生成文档

    ```
    public ActionResult DownloadPDF(long CentreID)
    {
        var model = GetModel()

        IPechkin converter = Factory.Create();
        byte[] result = converter.Convert(Helpers.PDF.RenderViewToString(this.HttpContext, "area", "controller", "action", model);
        MemoryStream outputStream = new MemoryStream();
        outputStream.Write(result, 0, result.Length);
        outputStream.Position = 0;

        return File(outputStream, "application/pdf", "filename.pdf");
    } 
    ```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-05-30T08:55:16.330

我也遇到了这个[http://www.codeproject.com/Articles/260470/PDF-reporting-using-ASP-NET-MVC3](http://www.codeproject.com/Articles/260470/PDF-reporting-using-ASP-NET-MVC3)。它简单快捷，非常适合 MVC。

然而，到目前为止唯一的缺点是它不太灵活，你想要一个像样的布局，例如，你对表格没有太多控制，通过 html 来控制单元格边框。它有点支持强制新页面，但您必须对 iTextsharp 应用补丁。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-06-22T09:48:27.193

我只是使用 wkhtmltopdf，在 html 中创建布局，然后将其转换为 pdf。

简单，可定制，真棒:)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-03-08T13:20:47.990

回复很晚，但我发现以下 URL 帮助我快速获得了结果：

（确保您通过使用 Nuget 包来引用 iTextSharp DLL）

[https://www.aspsnippets.com/Articles/Export-Grid-Html-Table-data-from-database-to-PDF-file-using-iTextSharp-in-ASPNet-MVC.aspx](https://www.aspsnippets.com/Articles/Export-Grid-Html-Table-data-from-database-to-PDF-file-using-iTextSharp-in-ASPNet-MVC.aspx)

**编辑** 这是我用来使表格看起来有点不同的代码（这也是风景：

```
public string GetCssForPdf()
        {
            string css = "";

            css = "th, td" +
                   "{" +
                       "font-family:Arial; font-size:10px" +
                    "}";

            return css;
        }

[HttpPost]
        [ValidateInput(false)]
        public FileResult Export(string GridHtml)
        {
            string webgridstyle = GetCssForPdf();

            string exportData = String.Format("<html><body>{0}{1}</body></html>", "<style>" + webgridstyle + "</style>", GridHtml);
            var bytes = System.Text.Encoding.UTF8.GetBytes(exportData);

            using (var input = new MemoryStream(bytes))
            {
                var output = new MemoryStream();
                var document = new iTextSharp.text.Document(PageSize.A4, 50, 50, 50, 50);
                var writer = PdfWriter.GetInstance(document, output);

                document.SetPageSize(iTextSharp.text.PageSize.A4.Rotate());
                Font headerFont = FontFactory.GetFont("Verdana", 10);
                Font rowfont = FontFactory.GetFont("Verdana", 10);

                writer.CloseStream = false;
                document.Open();

                var xmlWorker = iTextSharp.tool.xml.XMLWorkerHelper.GetInstance();
                xmlWorker.ParseXHtml(writer, document, input, System.Text.Encoding.UTF8);
                document.Close();
                output.Position = 0;

                return File(output, "application/pdf", "Pipeline_Report.pdf");

                //return new FileStreamResult(output, "application/pdf");
            }
        } 
```

希望这对其他人也有帮助。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-06-25T02:50:12.717

**在 asp.net mvc 中使用 rotativa 包的一个小例子**

*我们将创建一个函数来填充数据。我们将插入 7 天（2018 年 2 月 1 日 - 2018 年 2 月 7 日）的数据，显示特定日期的第一拳和最后一拳并附上备注。*

```
public ReportViewModel PopulateData()
        {
            var attendances = new List<Attendance>
            {
                new Attendance{ClassName = "present",Day = new DateTime(2018, 02, 01).ToString("ddd"),Date = new DateTime(2018, 02, 01).ToString("d"),FirstPunch = "09:01:00",LastPunch = "06:00:01",Remarks = ""},
                new Attendance{ClassName = "absent",Day = new DateTime(2018, 02, 02).ToString("ddd"),Date = new DateTime(2018, 02, 02).ToString("d"),FirstPunch = "",LastPunch = "",Remarks = "Absent"},
                new Attendance{ClassName = "holiday",Day = new DateTime(2018, 02, 03).ToString("ddd"),Date = new DateTime(2018, 02, 03).ToString("d"),FirstPunch = "",LastPunch = "",Remarks = "Democracy Day"},
                new Attendance{ClassName = "present",Day = new DateTime(2018, 02, 04).ToString("ddd"),Date = new DateTime(2018, 02, 04).ToString("d"),FirstPunch = "09:05:00",LastPunch = "06:30:01",Remarks = ""},
                new Attendance{ClassName = "present",Day = new DateTime(2018, 02, 05).ToString("ddd"),Date = new DateTime(2018, 02, 05).ToString("d"),FirstPunch = "09:01:00",LastPunch = "06:00:01",Remarks = ""},
                new Attendance{ClassName = "leave",Day = new DateTime(2018, 02, 06).ToString("ddd"),Date = new DateTime(2018, 02, 06).ToString("d"),FirstPunch = "",LastPunch = "",Remarks = "Sick Leave"},
                new Attendance{ClassName = "present",Day = new DateTime(2018, 02, 07).ToString("ddd"),Date = new DateTime(2018, 02, 07).ToString("d"),FirstPunch = "08:35:00",LastPunch = "06:15:01",Remarks = ""}
            };

            return new ReportViewModel
            {
                UserInformation = new UserInformation
                {
                    FullName = "Ritesh Man Chitrakar",
                    Department = "Information Science"
                },
                StartDate = new DateTime(2018, 02, 01),
                EndDate = new DateTime(2018, 02, 07),
                AttendanceData = attendances
            };
        } 
```

*然后，我们将创建一个下载 PDF 的函数。要下载 pdf，我们需要创建 2 个函数。1.下载pdf 2.查看pdf*

```
public ActionResult DownloadPdf()
        {
            var filename = "attendance.pdf";

            /*get the current login cookie*/
            var cookies = Request.Cookies.AllKeys.ToDictionary(k => k, k => Request.Cookies[k]?.Value);

            return new ActionAsPdf("PdfView", new
            {
                startDate = Convert.ToDateTime(Request["StartDate"]),
                endDate = Convert.ToDateTime(Request["EndDate"])
            })
            {
                FileName = filename,
                /*pass the retrieved cookie inside the cookie option*/
                RotativaOptions = {Cookies = cookies}
            };
        }

public ActionResult PdfView()
        {
            var reportAttendanceData = PopulateData();

            return View(reportAttendanceData);
        } 
```

您可以在此链接上查看详细说明。访问[这里](https://www.thelearninguy.com/asp-net-mvc-rotativa-generate-download-pdf-file)。

Curtesoy : [thelearninguy.com](https://www.thelearninguy.com)

# html - 如何防止填充属性更改 CSS 中的宽度或高度？

> ID：779434
> 
> 赞同：255
> 
> 时间：2009-04-22T22:00:46.733
> 
> 标签：html, css, padding

我正在用`DIV`s 创建一个网站。除了我创建一个 DIV 之外，一切都在进行中。我像这样创建它们（示例）：

```
newdiv {
    width: 200px;
    height: 60px;
    padding-left: 20px;
    text-align: left;
} 
```

当我添加`padding-left`属性时，宽度`DIV`更改为 220px，我希望它保持在 200px。

假设我创建了另一个与 完全相同的`DIV`名称，并将其放在其中但没有填充并且具有. 我得到同样的东西，宽度将是 220 像素。`anotherdiv``newdiv``newdiv``newdiv``anotherdiv``padding-left: 20px``newdiv`

我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：433
> 
> 时间：2012-08-20T08:58:03.620

添加属性：

```
-webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */
-moz-box-sizing: border-box;    /* Firefox, other Gecko */
box-sizing: border-box;         /* Opera/IE 8+ */ 
```

**注意：**这在低于版本 8 的 Internet Explorer 中**不起作用**。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-04-22T22:07:18.747

在你的 newdiv 中放一个 div`width: auto`和`margin-left: 20px`

从 newdiv 中删除填充。

[W3 Box 模型页面有很好的信息。](http://www.w3.org/TR/CSS2/box.html)

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2015-09-10T12:46:33.553

尝试这个

```
box-sizing: border-box; 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2015-01-15T02:28:15.733

如果您想在 div 中缩进文本而不更改 div 的大小，请使用 CSS`text-indent`而不是`padding-left`.

```
.indent {
  text-indent: 1em;
}
.border {
  border-style: solid;
}
```

```
<div class="border">
  Non indented
</div>

<br>

<div class="border indent">
  Indented
</div>
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2017-06-24T03:19:34.317

只需添加 `box-sizing: border-box;`

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-22T22:30:22.747

> 当我添加 padding-left 属性时，DIV 的宽度变为 220px

是的，这完全符合标准。这就是它应该如何工作的方式。

> 假设我创建了另一个名为 anotherdiv 的 DIV，与 newdiv 完全相同，并将其放在 newdiv 内，但 newdiv 没有填充，anotherdiv 有 padding-left: 20px。我得到同样的东西，newdiv的宽度将是220px；

不，newdiv 将保持 200px 宽。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2022-01-30T17:05:50.070

这在所有情况下都有效，预定义宽度中包含额外的填充

box-sizing：边框框；

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2012-04-14T18:32:33.680

如果您有 20px 的填充，只需将您的 div 宽度更改为 160px 它会为您的 div 的宽度增加 40px ，因此您需要从宽度中减去 40px 以保持您的 div 看起来正常并且不会因额外的宽度而扭曲它和你的文字都搞砸了。

# user-interface - 在 Matlab GUI 中编辑复选框

> ID：779441
> 
> 赞同：2
> 
> 时间：2009-04-22T22:01:27.373
> 
> 标签：user-interface, matlab, image-processing

在 Matlab 2008b 中使用 GUI 指南编辑器时，我遇到了复选框问题。我查看了许多在线教程等，但没有找到解决方案。我的问题是我有一个按钮可以重置 GUI 中的所有内容（编辑图片）。但是，我的 GUI 中有复选框，当按下重置按钮时，我不知道如何取消选择这些复选框。

附加：复选框执行的操作已经重置，我只需要在要重置的框中进行检查

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-23T00:38:58.680

对于取消选中复选框，将“Value”属性设置为 0（或任何“Min”属性设置为，如果您更改了它）。它看起来像：

```
set(hCheck1,'Value',0);
%OR
set(hCheck1,'Value',get(hCheck1,'Min'));  % If 'Min' is something besides 0 
```

在这里，**hCheck1**是第一个复选框的句柄（如果在 GUIDE 中创建 GUI ，我认为您可以从**句柄结构中获得）。**然后，您将对其他两个复选框中的每一个重复此操作。如果复选框已取消选中，则上述内容将无效。

# c# - p/invoke C 函数，返回指向结构的指针

> ID：779444
> 
> 赞同：4
> 
> 时间：2009-04-22T22:01:57.450
> 
> 标签：c#, interop, pinvoke

如何在 C# 中声明一个返回指向结构的指针的 C 函数？

我相信以下是做到这一点的一种方法，然后是**Marshal.PtrToStructure**以获得实际的结构值。

```
// C-function
SimpleStruct * Function(void);

// C# import
[DllImport("MyDll.dll")]
public static extern IntPtr Function(); 
```

1.  我对此是否正确？
2.  还有其他方法可以实现相同的目标吗？（按值取回 struct 是可以的）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-22T22:18:58.187

由于该函数返回一个指针（希望不是本地分配的指针？）您最好的选择是手动编组它（通过[Marshal.PtrToStructure](http://msdn.microsoft.com/en-us/library/4ca6d5z7(v=vs.110).aspx)）。

如果它是一个参数，您可以使用 PInvoke Interop Assistant 创建结构的托管版本，然后通过 ref 或 out 传递它。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-22T23:29:38.300

**警告：这仅在返回的指针指向已由 CLR 管理的内存时才有效**

我相信你正在寻找的是

```
// C# import
[DllImport("MyDll.dll")]
[return : MarshalAs(UnmanagedType.LPStruct)]
public static extern StructureName Function();

[StructLayout(LayoutKind.Sequential)]
public class StructureName {} 
```

这应该消除对任何手动`Marshal.PtrToStructure`调用的需要。根据您的结构所包含的内容，您可能需要使用`MarshalAs`适当的属性标记某些字段。[MSDN](http://msdn.microsoft.com/en-us/library/aa288468.aspx#pinvoke_example3)有一个很好的例子。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T22:13:35.877

我根本不是这里的专家，但我碰巧正在查看一段代码（我不完全理解你），它正在做同样的事情。

这是他们正在做的事情

```
[DllImport("")]
private static extern short MethodName([In,Out] ref StructureName variable); 
```

然后在结构上它们具有以下属性

```
[StructLayout(LayoutKind.Sequential, Size = #)]
public struct StructureName {} 
```

我认为您正在寻找的部分是 [In,Out] 部分，并且由于它是通过 ref 传递的，因此您应该得到相同的数据。

标记为社区 wiki，因此如果错误，人们可以修复此问题。

# function - 函数式 Web 框架

> ID：779446
> 
> 赞同：1
> 
> 时间：2009-04-22T22:02:30.100
> 
> 标签：function, frameworks

我见过的所有 Web 框架大多遵循 OO 范式。Python 或 Ruby 中是否有任何遵循 FP 风格的 Web 框架？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-22T22:24:16.833

与 python 本身一样，您可能会在 python 中找到融合了函数式和面向对象范式的 Web 框架。Django 就是一个很好的例子。Django 遵循模型-视图-控制器设计，他们将其标记为模型-模板-视图。有趣的是，这三层的运作方式非常不同。

*   模型是面向对象的。没有必要让它成为 OOP 可以做的一切的典范。你的模型可以很简单：你命名它，扩展一个基本模型类，并声明一些属性。我认为，这是应该的，而且我会着迷于学习其他在模型层明显不那么面向对象的框架。您的数据库需要表声明，并且您的站点需要生成数据行。无论你怎么看，这都非常类似于类和实例。
*   模板不是python。它应该看起来尽可能像 html，并有一些漂亮的方法来插入传递给它的数据。
*   视图非常实用。它可以被强制转换为 OO 范式，如果需要，它可以依靠模型来完成繁重的工作。但核心是有执行某些操作的函数声明。这些函数声明作为参数传递给 url 配置函数。

我碰巧喜欢这种范式的混合，因为我相信它对每个给定级别都有效。有些人可能会称之为不一致；其他人可能会说模型和表示逻辑之间的区别应该尽可能清晰以强调区别。

如果您不太关心 OOP 但可以在 python 中运行，那么这个框架可能对您很有效。除非您尝试利用默认管理界面。然后元类和表单集会让你头脑发热。

# c++ - Tandy 1000 PC SX 的 C 或 C++ 编译器？

> ID：779448
> 
> 赞同：4
> 
> 时间：2009-04-22T22:02:49.663
> 
> 标签：c++, c, compiler-construction

我有我父​​亲 1980 年代的旧电脑。这是 Tandy 1000 PC SX：

这台计算机没有调制解调器，但我有另一台装有 Windows XP 的 PC，它还有一个 5 3/4 英寸的软盘驱动器。那么我在哪里可以找到适用于这台旧 PC 的 C/C++ 编译器？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-22T22:09:50.503

你也许可以使用[Turbo C 2.01](https://downloads.embarcadero.com/free/tc201)。当我有一台 Tandy 1000HX 时，我可以。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-22T22:13:39.713

[Tandy 1000 系列常见问题解答](http://www.oldskool.org/guides/tvdog/1kfaq.html)

[III.G.2\. 哪些 C 编译器可以在我的 Tandy 1000 上运行？](http://www.oldskool.org/guides/tvdog/1kfaq.html#III.G.2)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-22T22:10:42.530

哦，我的上帝，我从来没有见过其中之一。好吧，那是运行一个 MS/DOS 版本，我记得不迟于 MS/DOS 3。

首先要确保您可以在 XP 计算机上读写 Tandy 可以读取的软盘。

我猜你甚至需要寻找一个相当旧的 Turbo C 版本。您可能应该查看[Tiny C Compiler](http://en.wikipedia.org/wiki/Tiny_C_Compiler)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-22T22:09:24.187

[看一下这个。](http://www.oldskool.org/guides/tvdog/1kfaq.html#III.G.2)

但我不得不说，如果你真的要上老派，你需要用汇编程序编写代码。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-22T22:06:32.943

你为什么要首先为这个东西编程？
我想[borland C/ Turbo C](https://downloads.embarcadero.com/free/tc201)应该可以解决这个问题。

显然还有一个[Turbo C++。](https://downloads.embarcadero.com/free/tcpp101)
这是各种此类事物[的另一个](http://www.uv.tietgen.dk/staff/mlha/Download/dos/#Borland)来源。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-22T23:07:59.367

[Digital Mars C++ 编译器](http://www.digitalmars.com/)声称仍然支持 16 位 DOS 和 Win16。

我不确定编译器本身是否会在这些平台上运行，或者您是否必须在 Win32 系统上“交叉编译”并将结果复制到 Tandy。

实际上，我不确定它是否有效，但支持声明非常突出。

与 Digital Mars 一起使用的好处是，您可以使用比免费提供的旧 Turbo C/C++ 更现代的编译器。我想 Digital Mars 中的模板和 STL 支持比旧的 Borland 编译器要好得多。

不过，旧的 Borland 的东西可能有更好的开箱即用的 UI 框架，并且您挖掘的此类或旧的 DOS 源代码实际上可能与旧编译器一起更好地工作。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-22T22:21:41.863

我完全会选择其他人在这里提到的 Turbo C。它们非常快速、易于使用，并且总体上让我在 DOS 中编码时感到很开心。

PS：您打算如何将 Turbo C 从 Internet 安装到您的机器上？通过串行端口的终端文件传输？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-22T22:44:45.787

鉴于对旧计算机的限制，您可能希望使用另一台 PC 交叉编译 Tandy 1000 PC SX。[如果您使用的是 Linux，那么使用 Dan Kegel 的crosstool](http://www.kegel.com/crosstool/)很容易为 DOS 构建一个交叉编译器。

# asp.net - 使用 jquery + jsonp，Internet Explorer 不保存 ASP.NET sessionID

> ID：779455
> 
> 赞同：2
> 
> 时间：2009-04-22T22:04:40.407
> 
> 标签：asp.net, jquery, jsonp

所以我正在使用 Jquery 做一些相当简单的 JSONP 工作。

一般结构

*   站点位于域**A**
*   Javascript 存在于域**B**
*   JSON 服务也存在于域**B**

该站点调用 jsonp 调用 json 服务 (.net) 的方法，在 .net 中我设置会话并返回。

这一切都很好，除了在 IE 中它不会在后续请求中存储或传递会话 id。所以 .net 每次都会创建一个新的。

如果我直接访问 JSON url，即愉快地存储它，并将在后续调用中使用它。

Firefox 和 chrome 对此没有任何问题，但由于某种原因，IE 似乎通过 jquery 忽略了会话 cookie，但除此之外响应工作正常。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-23T12:39:59.210

许多浏览器的同源策略比火狐更严格。这不是 IE 问题。XHR / MSXML 对象不接受 cookie。

[http://code.google.com/p/browsersec/wiki/Part2#Same-origin_policy](http://code.google.com/p/browsersec/wiki/Part2#Same-origin_policy)

# sql - 比较子查询中不同类型的 2 个值

> ID：779462
> 
> 赞同：0
> 
> 时间：2009-04-22T22:06:42.587
> 
> 标签：sql, join, subquery

我正在使用 MS SQL 数据库，我有 3 个表：'base_info'、'messages'、'config'

```
bases:
ID    Name   NameNum
====================================
 1    Home    101
 2    Castle  102
 3    Car     103

messages:
ID    Signal    RecBy    HQ
============================
111    120      Home     1
111    110      Castle   1
111    125      Car      1
222    120      Home     2
222    125      Castle   2
222    130      Car      2
333    100      Home     1
333    110      Car      2

config:
ID  SignalRec  SignalOut  RecBy   HQ
====================================
111     60        45       101    1
111     40        60       102    1
222     50        60       102    2
222     30        90       101    2
333     80        10       103    1 
```

好的，所以现在我有一个子查询，在其中我从配置表中选择“SignalRec”和“SignalOut”，并按 ID 和日期在消息表上匹配它（不包括在上面），问题是我需要它来匹配 where messages.RecBy = config.RecBy 但 config.RecBy 是一个字符串，但它的等效名称在基表中。所以我几乎需要在子查询或某种类型的连接中做一个子查询并比较返回的值。
这是我到目前为止所拥有的：

```
(SELECT TOP 1 config.SignalRec from config WHERE config.ID = messages.ID AND ||I need th other comparison here||...Order By...) As cfgSignalRec,
(SELECT TOP 1 config.SignalOut from config WHERE config.ID = messages.ID AND ||I need th other comparison here||...Order By...) As cfgSignalOut 
```

我试图尽可能清楚地说明这一点，但如果您需要更多信息，请告诉我。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T22:09:40.317

我会在您的消息表中规范化 RecBy 以引用基表。如果在基础中也引用了字符串内容，为什么还要在其中插入字符串内容？

这正是规范化存在的原因：减少冗余、减少歧义并强制引用完整性。

为了更清楚地说明这一点，messages 表中的 RecBy 应该是 Bases 的外键。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T22:16:00.020

我认为这可以解决问题（虽然我还没有尝试过......）

```
SELECT 
    c.SignalRec 
FROM config c 
    INNER JOIN bases b 
        ON c.RecBy = b.NameNum 
    INNER JOIN messages m 
        ON b.Name = m.RecBy
WHERE c.ID = m.ID 
```

但是，正如 Anthony 指出的那样，您可能希望规范化表中`RecBy`列中的字符串`messages`，因为表中具有相同的数据`bases`。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T22:17:04.073

根据您的描述，听起来您需要两个 JOINS

```
SELECT TOP 1
    c.SignalRec
FROM 
    config c
INNER JOIN 
    bases b
ON c.RecBy = b.NameNum
INNER JOIN
    messages m
ON b.Name = m.RecBy 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-24T12:26:59.813

我想我可能还不够清楚我想做什么，对此感到抱歉。尽管相关性相同，但 2 个表中的数据实际上是不同的。如果不详细说明系统的工作原理，解释起来有点令人困惑。
我实际上找到了一种非常快速的方法。
在我的子查询中，我这样做：

```
(SELECT TOP 1 config.Signal FROM config,bases 
     WHERE config.ID = messages.ID AND bases.Name = messages.RecBy AND bases.NameNum = 
     config.RecBy Order By...) 
```

所以这基本上比较了不同表的 2 个 RecBy，即使一个是整数而另一个是字符串。它让我想起了匹配并在 Excel 中查找。

# .net - 如何将一些 JavaScript 插入 WebBrowser 控件的文档中？

> ID：779469
> 
> 赞同：1
> 
> 时间：2009-04-22T22:09:09.053
> 
> 标签：.net, winforms, webbrowser-control

我[`System.Windows.Forms.WebBrowser`](http://msdn.microsoft.com/en-us/library/system.windows.forms.webbrowser.aspx)在 .NET 2.0 应用程序中使用该控件，并且想在`body`元素末尾之前将一些 JavaScript 代码插入到加载的文档中。

我该怎么做呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-23T07:54:10.707

我认为这个问题已经在这里提出并得到了回答：[153748/webbrowser-control-from-net-how-to-inject-javascript](https://stackoverflow.com/questions/153748/webbrowser-control-from-net-how-to-inject-javascript)

# sql - 来自 DataTable 的 SQL CLR SqlBulkCopy

> ID：779478
> 
> 赞同：1
> 
> 时间：2009-04-22T22:12:41.247
> 
> 标签：sql, sql-server, clr, sqlclr, sqlbulkcopy

我们在 CLR 过程中有一个内存数据表。经过大量处理后，DataTable 有很多数据需要加载到数据库中的表中。不幸的是，由于我们使用的是[上下文连接](http://msdn.microsoft.com/en-us/library/ms131053.aspx)， SqlBulkCopy 将无法工作（抛出错误：在[上下文限制的上下文连接大纲中，](http://msdn.microsoft.com/en-us/library/ms131101.aspx)*请求的操作不可用* ）。

我们正在考虑建立一个额外的常规连接并使用它来执行 SQLBulkCopy。[考虑到在上下文连接](http://msdn.microsoft.com/en-us/library/ms131104.aspx)上使用常规连接的开销，这似乎相当愚蠢。我们考虑过遍历 DataTable 中的行并为每个行插入一条记录，但它的大小很大，SQLBulkCopy 似乎更合适。

我们没有与 DataTable 结婚，只是在寻找从 CLR 过程将大量数据插入数据库的最佳方法。关于 DataTable 的最后一点说明，它代表底层数据库表，但不通过 DataSet 或 TableAdapter 绑定到表。在 CLR 过程中这样做的方法并不是很明显。这样做并使用 AcceptChanges 或 Update 方法将是一个可接受的解决方案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T23:05:17.953

根据表的大小，我估计 SQLBulkCopy 比插入快 10-100 倍，所以权衡是值得的。

看到您正在对 DataTable 进行“重要处理”，这无疑需要时间和资源，使用完整连接而不是上下文连接或打开全新连接的微小额外开销是一个很小的代价.

# java - 从 JPA 实体逆向工程 DDL

> ID：779479
> 
> 赞同：20
> 
> 时间：2009-04-22T22:12:49.577
> 
> 标签：java, hibernate, orm, jpa, ddl

我正在玩一些 JPA 的东西，更改映射以查看它们应该如何等。这是基本的实验。但是我找不到一个工具可以简单地读取我的实体然后为我生成表模式。我试图在 JBoss 工具中找到类似的东西，但 nada。Eclipse 集成将是一个巨大的优势，但我将采用命令行工具或 ant 任务。

有任何想法吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-05-15T19:47:34.373

尝试将以下内容添加到您的 persistence.xml

**对于休眠：**

创造：

```
<property name="hibernate.hbm2ddl.auto" value="update"/> 
```

要删除和创建：

```
<property name="hibernate.hbm2ddl.auto" value="create-drop"/> 
```

**对于顶联：**

创造：

```
<property name="toplink.ddl-generation" value="create-tables"/> 
```

要删除和创建：

```
<property name="toplink.ddl-generation" value="drop-and-create-tables"/> 
```

**对于 EclipseLink：**

创造：

```
<property name="eclipselink.ddl-generation" value="create-tables"/> 
```

要删除和创建：

```
<property name="eclipselink.ddl-generation" value="drop-and-create-tables"/> 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-22T23:31:10.590

我认为 JPA 没有通用的方法，您必须直接使用底层的 JPA 实现来实现这一点。

对于**Hibernate**，有几种可能性：

*   使用前面发布的[duffymo](https://stackoverflow.com/questions/779479/reverse-engineer-ddl-from-jpa-entities/779629#779629)方法，使 Hibernate 自动更新数据库模式。
*   如果你不想这样，你可以使用[Hibernate Tools的](http://www.hibernate.org/)*hbm2ddl*工具（注意：链接很烂，但显然他们的主页现在有点坏了）。您可以使用它从您的 JPA 实体中自动生成数据库创建脚本；还有自动调用的 Maven 和 Ant 插件。`hbm2ddl`

对于**EclipseLink**（以前称为 Oracle TopLink，JPA 2.0 RI），请参阅[Using EclipseLink JPA Extensions for Schema Generation](http://wiki.eclipse.org/Using_EclipseLink_JPA_Extensions_(ELUG)#Using_EclipseLink_JPA_Extensions_for_Schema_Generation)。原则上它与 Hibernate 非常相似，尽管乍一看我没有看到任何可以用作创建数据库脚本的独立实用程序的东西。

其他 JPA 实现（BEA/Oracle Kodo、Apache OpenJPA）可能有自己的特定方法来实现这一点。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-22T23:08:42.997

当我使用 Hibernate 时，我只需将其添加到我的配置文件中：

```
 <property name="hbm2ddl.auto">update</property> 
```

照顾一切。我不确定 JPA 的等价物是什么，但它深受 Hibernate 的影响，如果你找不到类似的东西，我会感到惊讶。

无需工具。我通常只运行一个简单的 JUnit 测试，然后为我创建数据库。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2013-08-27T12:29:04.010

通过 Maven 插件：

```
 <plugin>
            <!-- run "mvn hibernate3:hbm2ddl" to generate a schema -->
            <groupId>org.codehaus.mojo</groupId>
            <artifactId>hibernate3-maven-plugin</artifactId>
            <version>3.0</version>
            <configuration>
                <hibernatetool>
                    <classpath>
                        <path location="${project.build.directory}/classes" />
                        <path location="${project.basedir}/src/main/resources/META-INF/" />                                               
                    </classpath>   

                    <jpaconfiguration persistenceunit="galleryPersistenceUnit" />                     
                    <hbm2ddl create="true" export="false" destdir="${project.basedir}/target" drop="true" outputfilename="mysql.sql" format="true" console="true"/>
                </hibernatetool>
            </configuration>
        </plugin> 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-04-28T18:24:52.393

我使用 Hibernate 的`org.hibernate.tool.hbm2ddl.SchemaExport`类和这个小方法

在数据库中生成模式：

```
 public static void rebuildSchema()
 {
     configuration = new Configuration();
     configuration.configure();

     new SchemaExport(configuration)
         .setHaltOnError(true)
         .execute(false, true, false, false);
 } 
```

要在外部文件中创建 DDL，请使用对`execute`.

```
 new SchemaExport(configuration)
         .setHaltOnError(true)
         .setOutputFile(outputFile)
         .setImportFile("")
         .setDelimiter(";")
         .setFormat(true)
         .execute(false, false, false, true); 
```

将“hibernate.hbm2ddl.auto”设置为“update”被认为是错误的形式，因为自动更改生产数据库可能会破坏它。有关解释，请参阅[Hibernate hbm2ddl.auto 可能的值及其作用？](https://stackoverflow.com/questions/438146/hibernate-question-hbm2ddl-auto-possible-values-and-what-they-do).

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-23T12:31:31.913

[DataNucleus](http://www.datanucleus.org)有自己的 SchemaTool 能够为您生成架构，或者生成所需的 DDL 语句供您自己适应和应用。

——安迪（数据[核](http://www.datanucleus.org)）

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-04-28T12:49:30.447

添加到詹姆斯麦克马洪的名单：

**对于 OpenJPA：**

```
<property name="openjpa.jdbc.SynchronizeMappings" value="buildSchema(ForeignKeys=true)"/> 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-09-29T15:55:20.680

Antonio Goncalves 在他的[博客](http://antoniogoncalves.org/2014/12/11/generating-database-schemas-with-jpa-2-1/)中谈到了生成模式的 API。
在 JPA 2.1中，为此目的引入了[generateSchema方法。](https://docs.oracle.com/javaee/7/api/javax/persistence/Persistence.html#generateSchema-java.lang.String-java.util.Map-)

来自博客的示例：

```
public class Main {
    public static void main(String[] args) {
        Persistence.generateSchema("samplePU", null);
    }
} 
```

# sharepoint - 将 SharePoint 集与文件系统同步？

> ID：779482
> 
> 赞同：0
> 
> 时间：2009-04-22T22:13:47.827
> 
> 标签：sharepoint, microsoft-sync-framework

有没有人发现将 SharePoint 集（列表、文档等）与文件系统等“外部”源同步很有用？SharePoint 到 SharePoint 同步怎么样？我们是否有任何解释为什么 Microsoft Sync Framework 缺少与 SharePoint 的任何严重挂钩？这些东西会在某些 Office 14 时间范围内发布吗？根据保密协议？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-01-09T16:49:31.960

还没试过，你见过吗？ [http://listsync.codeplex.com/](http://listsync.codeplex.com/)

# c# - 如果基本类型是对象，为什么我们不能这样做？

> ID：779491
> 
> 赞同：-1
> 
> 时间：2009-04-22T22:16:23.873
> 
> 标签：c#, .net

所以对于复杂类型，我们可以这样写：

```
return new MyType ( 5 ); 
```

但是为什么我们不能做这样的事情（要有对称性）：

```
return new int ( 5 );

return new Int64 ( 5 ); 
```

我知道只提供了无参数的构造函数。这是什么原因？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-22T22:41:33.203

重点是什么？任何没有构造函数的 .NET 值类型都有文字形式。如果它们没有文字形式，就不可能提供一个将其类型作为参数的构造函数。

由于您有文字，因此提供一个采用该文字的构造函数是没有意义的。

没有字面，不可能

```
int i = new int(new int(new int(...))); 
```

用字面

```
int i = new int(5); // What is the point? Would the constructor do *anything*
                    // besides int i = 5? 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T22:41:33.470

设计的一部分是知道要省略什么。由于它没有增加价值，因此没有编码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-23T03:56:34.553

只是这些类型只有一个默认构造函数。许多其他复杂的 .net 类型也只有一个默认构造函数。我猜想没有参数化的原因是因为，正如其他答案所提到的，没有一个很好的理由。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T22:20:04.970

这可能听起来很奇怪，但你为什么要这样做？- 复杂类型是有意义的，因为您使用 1-n 输入来获得结果，但 int 只返回一个 int ......那为什么呢？

# c# - Magento Web 服务错误

> ID：779493
> 
> 赞同：2
> 
> 时间：2009-04-22T22:16:58.567
> 
> 标签：c#, .net, soap, magento, xml-rpc

我正在实施一个自定义解决方案来与[Magento](http://www.magentocommerce.com)网站交互。我的代码在 C# 中。我正在尝试使用`v2_soap API`和`xml-rpc API`Web 服务来创建产品。我尝试使用这两种服务创建产品。我似乎无法成功创建产品。对于每项服务，我都会收到错误消息 `[102] Invalid data given. Details in error message.`。我尝试将各种数据传递给 api 调用，但没有任何运气。我想知道几件事：

1) 有什么方法可以在我进行 Web 服务调用时收到关于哪些数据无效的更好的错误消息？错误消息似乎表明我可以到达`details`某个地方，但我已经搜索了所有日志，但我找不到运气的错误消息数据。

2) 使用 Web 服务添加新产品所需的最低属性是什么？

这是我正在使用的一些代码。这就是`XML-RPC`实现。我正在使用厨师计算 xml-rpc 库。

```
public int CreateProduct(Product product) {
    var entity = ConvertProduct(product);
    //int productId = Service.catalogProductCreate(SessionId, "simple", "0", product.Sku, entity);
    int productId = XmlRpcService.CallReturnInt(SessionId, "catalog_product.create",
      new object[] { 
         "simple" /* product type */, 
         0 /* attribute set */, 
         product.Sku /* sku */, 
         entity /* product data */ 
      });
    return productId;
}
private XmlRpcStruct ConvertProduct(Product product) {
    var entity = new XmlRpcStruct();
    entity.Add("name", product.Name);
    entity.Add("description", product.Description);
    return entity;
}
protected IMagentoXmlRcpService XmlRpcService {
    get {
        return this.xmlRpcService;
    }
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-22T23:04:11.073

关键是属性集。默认属性集是 4（至少对我来说）。那个小家伙是很多问题的根源。Magento Web 服务上的错误响应确实需要一些工作。

有关更多信息，请参阅此论坛主题：http: [//www.magentocommerce.com/boards/viewthread/36892/](http://www.magentocommerce.com/boards/viewthread/36892/)

# python - 访问包子目录中的数据

> ID：779495
> 
> 赞同：147
> 
> 时间：2009-04-22T22:17:52.123
> 
> 标签：python, package

我正在编写一个 python 包，其中包含需要在`./data/`子目录中打开数据文件的模块。现在我有硬编码到我的类和函数中的文件的路径。我想编写更健壮的代码，无论它安装在用户系统的哪个位置，都可以访问子目录。

我尝试了多种方法，但到目前为止我没有运气。似乎大多数“当前目录”命令返回系统的python解释器的目录，而不是模块的目录。

这似乎应该是一个微不足道的常见问题。然而我似乎无法弄清楚。部分问题是我的数据文件不是`.py`文件，所以我不能使用导入功能等。

有什么建议么？

现在我的包目录看起来像：

```
/
__init__.py
module1.py
module2.py
data/   
   data.txt 
```

我正在尝试`data.txt`从`module*.py`!

* * *

## 回答 #1

> 赞同：191
> 
> 时间：2011-04-08T23:42:39.203

执行此操作的标准方法是使用 setuptools 包和 pkg_resources。

您可以根据以下层次结构布局您的包，并配置包设置文件以将其指向您的数据资源，根据此链接：

[http://docs.python.org/distutils/setupscript.html#installing-package-data](http://docs.python.org/distutils/setupscript.html#installing-package-data)

然后，您可以按照以下链接使用 pkg_resources 重新查找和使用这些文件：

[http://peak.telecommunity.com/DevCenter/PkgResources#basic-resource-access](http://peak.telecommunity.com/DevCenter/PkgResources#basic-resource-access)

```
import pkg_resources

DATA_PATH = pkg_resources.resource_filename('<package name>', 'data/')
DB_FILE = pkg_resources.resource_filename('<package name>', 'data/sqlite.db') 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-04-22T22:37:04.197

您可以使用`__file__`获取包的路径，如下所示：

```
import os
this_dir, this_filename = os.path.split(__file__)
DATA_PATH = os.path.join(this_dir, "data", "data.txt")
print open(DATA_PATH).read() 
```

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2019-11-19T14:22:00.987

*回答详细说明无法*按原样工作的代码通常没有意义，但我认为这是一个例外。Python 3.7 添加[`importlib.resources`](https://docs.python.org/3/library/importlib.html#module-importlib.resources)了应该替换`pkg_resources`. 它适用于访问名称中没有*斜杠*的包中的文件，即

```
foo/
    __init__.py
    module1.py
    module2.py
    data/   
       data.txt
    data2.txt 
```

即您可以使用例如访问`data2.txt`内部包`foo`

```
importlib.resources.open_binary('foo', 'data2.txt') 
```

但它会失败，但有一个例外

```
>>> importlib.resources.open_binary('foo', 'data/data.txt')
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/usr/lib/python3.7/importlib/resources.py", line 87, in open_binary
    resource = _normalize_path(resource)
  File "/usr/lib/python3.7/importlib/resources.py", line 61, in _normalize_path
    raise ValueError('{!r} must be only a file name'.format(path))
ValueError: 'data/data2.txt' must be only a file name 
```

除非将其放入`__init__.py`然后`data`将其用作包装，否则无法解决此问题：

```
importlib.resources.open_binary('foo.data', 'data.txt') 
```

这种行为的原因是[“这是设计使然”](https://www.youtube.com/watch?v=ZsGFU2qh73E&feature=youtu.be&t=515)；但[设计可能会改变](https://gitlab.com/python-devs/importlib_resources/issues/58#note_239062875)......

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2014-10-09T12:33:03.800

提供今天有效的解决方案。绝对使用这个 API 来避免重新发明所有这些轮子。

需要一个真正的文件系统文件名。压缩的鸡蛋将被提取到缓存目录：

```
from pkg_resources import resource_filename, Requirement

path_to_vik_logo = resource_filename(Requirement.parse("enb.portals"), "enb/portals/reports/VIK_logo.png") 
```

返回指定资源的可读文件类对象；它可能是一个实际的文件、一个 StringIO 或一些类似的对象。流处于“二进制模式”，即资源中的任何字节都将按原样读取。

```
from pkg_resources import resource_stream, Requirement

vik_logo_as_stream = resource_stream(Requirement.parse("enb.portals"), "enb/portals/reports/VIK_logo.png") 
```

使用 pkg_resources 发现包和资源访问

*   [https://setuptools.readthedocs.io/en/latest/pkg_resources.html#resource-extraction](https://setuptools.readthedocs.io/en/latest/pkg_resources.html#resource-extraction)
*   [https://setuptools.readthedocs.io/en/latest/pkg_resources.html#basic-resource-access](https://setuptools.readthedocs.io/en/latest/pkg_resources.html#basic-resource-access)

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2015-12-10T09:59:33.883

您需要为整个模块命名，给您的目录树没有列出该详细信息，对我来说这很有效：

```
import pkg_resources
print(    
    pkg_resources.resource_filename(__name__, 'data/data.txt')
) 
```

值得注意的是 setuptools 似乎不会根据与打包数据文件的名称匹配来解析文件，所以无论如何你都必须包含`data/`前缀。如果您需要备用目录分隔符，您可以使用`os.path.join('data', 'data.txt)`，一般我发现硬编码的 unix 样式目录分隔符没有兼容性问题。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-04-22T22:35:52.187

我想我找到了答案。

我制作了一个模块 data_path.py，我将它导入到我的其他模块中，其中包含：

```
data_path = os.path.join(os.path.dirname(__file__),'data') 
```

然后我打开我所有的文件

```
open(os.path.join(data_path,'filename'), <param>) 
```

# hover - 虚拟地球控制 - 奇怪的浮动行为

> ID：779497
> 
> 赞同：0
> 
> 时间：2009-04-22T22:18:29.890
> 
> 标签：hover, virtual-earth

我一直在[学习“NerdDinner”MVC 教程](http://weblogs.asp.net/scottgu/archive/2009/03/10/free-asp-net-mvc-ebook-tutorial.aspx)，我刚刚达到了关于添加地图控件的部分。我遇到了虚拟地球控件的一些奇怪行为，我似乎无法弄清楚：

[http://img17.imageshack.us/img17/3379/virtualearth.png](http://img17.imageshack.us/img17/3379/virtualearth.png)

如果看不到图片，Virtual Earth 控件浮动在左上角，遮挡了窗体，与包含的 div 分开，这也不是真正在正确的位置，但它比控件的位置更好是。

据我所知，我直接从教程中复制了所有相关代码。有没有人见过这样的东西？

我的大部分测试都使用 Firefox，但它在 Internet Explorer 7 中的行为似乎相同。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-27T20:40:58.620

没关系，本教程似乎需要一些它没有告诉您的 CSS：/ 能够从官方“成品”源代码中检索它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-03-29T06:02:01.643

这让我发疯了！

缺少的 CSS 是：

```
#theMap {
    position: relative; 
    width: 500px; 
    height: 450px;
} 
```

# sql-server - 人们如何看待 Gupta Team Developer？

> ID：779502
> 
> 赞同：3
> 
> 时间：2009-04-22T22:20:05.767
> 
> 标签：sql-server, windows, development-environment, guptateamdeveloper

有没有人使用 Gupta（以前的 Centura）Team Developer 的经验？

如果是这样，您如何看待它支持开发成熟、可扩展、可维护的应用程序的能力？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-05T09:59:48.217

从 1.1 版开始，我一直在使用 CTD。目前我仍在使用 2.1 PTF4，主要用于在 windows 98-Vista 下针对 Centura SQLBase、MS Sql Server 或 MS Access 进行富客户端 CRUD。我没有从2.1升级到较新的版本，所以只能说说2001年以来比较老的2.1。(§)

我们的应用程序通常有大约 150 个窗体窗口，大量使用类（在 2.1 中仍称为“用户定义的变量”）并集成了 MS Office。我们没有稳定性问题或内存泄漏。不过，开发环境有点长：没有智能感知，没有智能调试，没有鼠标几乎无法使用。这可能随着新版本而改变。

CTD 本质上没有任何东西会迫使您编写不可维护的代码。*如果*您将代码设计为可重用的，那么使用类和文件包含可以在代码中获得良好程度的可重用性，也就是说。可维护性的问题可能是 CTD 变量和类没有访问修饰符，如“private”或“protected”。另外：没有接口或抽象类。另一方面：多重继承。

代码的“大纲结构”需要一些时间来适应，但当我迷失在一个到处都是变量声明和事件处理程序的庞大 C# 文件中时，我什至有时会错过大纲结构......

2.1 的控件非常完整，但我们仍然必须手动集成“现代”的东西，如工具栏、日期选择器或选项卡控件。OTOH，它甚至有一个开箱即用的数字输入字段。其中一份 Unify-Newsletters 表示，他们添加了很多吸引眼球的东西，让应用程序看起来更加最新。表格窗口的 mtable-Extensions 非常有用，可在此处获得：[MICSTO 的 MTable](http://www.micsto.de/)。集成第 3 方 DLL（例如用于集成智能卡读卡器）并不是很有趣，尤其是当它们使用结构时。哦：而且“Centura Report Builder”是一种皇家痛苦。

一个很大的优点是与 CTD 一起提供的 SDK：这使得将自己编写的工具集成到开发环境中变得非常容易，例如用于代码生成。

底线：我们使用并且仍在使用 CTD 来开发可扩展和可维护的应用程序。由于不寻常的大纲结构，学习曲线可能有点陡峭，并且可能导致粗心大意地编写“丑陋”的代码：例如大量静态函数、“消息操作”中的大量代码以及变量范围的问题。我认为您使用 CTD 的成功将取决于您要编写的应用程序的性质：对于富客户端 CRUD，您几乎可以肯定比使用 .net 更好，对于我真的不知道的网络应用程序。

**请记住，所有这些都与 8 年前的 CTD 2.1 版本有关**。现在情况可能完全不同。如果可以，请获取评估版。

**编辑**：除了语言本身的利弊之外，您可能还想考虑 CTD 是一个利基市场。免费工具不多，我还没有找到一个充满活力的社区（有一个新闻组，但合并后服务器宕机了——也许它还在某个地方）。因此，在特定问题上搜索帮助可能并不容易。

(§) 我没有继续从 2.1 到 5.1 的升级路径，因为在与 Unify 合并后，他们希望只为他们的支持计划（称为 GLS）的订阅者提供补丁。由于我不打算为错误修复付费，我决定继续为我们的旧应用程序使用 2.1，并为新应用程序切换到 .net。我想他们后来修改了这个。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-11-17T21:32:03.313

我已经与 Team Developer（以前的 Centura Builder、SQL Windows 等）合作了 9 年。与斯蒂芬凯勒在他的综合回答中描述的版本 2.1 相比，IMO 的事情并没有太大变化。

我工作的公司目前正在使用 TD 5.1 版本，并考虑明年升级到 TD 5.2。我们正在开发一个商业软件产品，针对 Oracle 数据库运行。该应用程序有 500 多个表单窗口和数百个报告。

我认为 Team Developer 可以很好地扩展到简单的小型应用程序，以及具有大型 RDBMS 和数百名用户的大型企业应用程序套件。

代码大纲使 IDE 易于使用，我认为学习曲线不会那么陡峭。即使没有鼠标也可以进行代码编辑，因为有许多方便的键盘快捷键。当然，窗口设计者需要鼠标。在较新的版本中还有一个内置的 Active Coding Assistant。

最新版本（5.1 和 5.2）提供了一些新的 GUI 控件，例如日期/时间选择器、网格窗口（对广泛使用的表格窗口的增强）和富文本编辑器。还有一个新的选项卡控件。菜单可以像丝带一样显示，尽管这不是“真正的”丝带栏。可以在 Unify 网站上找到示例屏幕截图。

TD 5.x 版本中还引入了新的 GUI 主题，为应用程序提供更现代的外观和感觉。

TD 5.x 版本存在许多稳定性问题、性能问题和屏幕绘制等问题。较早的 3.x 和 4.x 以非常强大的质量着称，只有非常有限的数量（如果有的话）稳定性或其他问题。这些问题在[统一支持论坛](http://support.unify.com/supportforum/)上得到了积极讨论。其中许多问题与数据库路由器（Oracle、MS SQL Server）或 Windows API 调用有关。TD 的基本功能通常运行良好。

也可以在支持论坛上获得有关特定问题和疑问的帮助。开发者社区可能很小，但非常活跃。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-07-04T06:53:25.660

我的公司多年来成功地使用了 Team Developer（我们的大多数应用程序都是用 2.0 编写的，其中一些在 5.2 中作为 Web 应用程序编写）并且计划将我们的开发更改为 6.0 版。

来自 C++ 背景，我首先必须找到进入该语言的方法（我仍然想念一些特性，如封装、结构良好的错误处理¹或变量范围²）

但毕竟，我学会了忍受语言的限制，并且通过一些纪律，我们的应用程序相对容易维护。（注意：我们有一组基础应用程序一起工作，并使用相同的代码库和一些与客户相关的变体来为每个客户构建单独的版本 - 错误修复出现在公共代码库中（然后用于任何其他项目）， lokal 项目文件中的特殊修改）。您只需要为您的项目设置一些基本准则并保留它们，因为编译器不会强制执行它们。

* * *

¹您只能在它发生的那一点或整个程序的全局范围内捕获一个 sql 错误。

²我仍然有时会遇到拼写错误的变量在完全独立的窗口中编译某些东西的情况 - 或者半引用句柄共享相同名称但不同数据类型的编译器错误

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-04-27T13:46:06.510

我们将 TD 用于几个大型应用程序，但由于缺乏资源、过时的 SAL 语言和老化的运行时，我们使用 ice tea group gupta/unify 迁移工具将数百万行 SAL 代码和数千个表单迁移到 C# 和 Visual Studio 2010 .

起初我们持怀疑态度。但是现在我们有了全新的应用程序，与我们的其他 .NET 资产完全集成，只需一小部分重写所需的时间。而且我们不必试图理解所有代码在做什么。:) 转换几乎是完美的！

忘了提一下，我们自动将 1200 多个报表生成器报表转换为水晶报表 .NET，这可能节省了一个世纪的无聊工作。

# visual-studio-2008 - 在 Visual Studio 项目模板中包含自定义 DLL

> ID：779505
> 
> 赞同：13
> 
> 时间：2009-04-22T22:20:32.863
> 
> 标签：visual-studio-2008

我正在尝试在 Visual Studio 2008 中创建一个项目模板，并且已经成功。

是否可以在我的项目模板中包含一些自定义程序集，以便在实例化新项目后不必添加对这些程序集的引用？如果这是可能的，我将如何去做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-04-10T04:43:10.180

我需要自己做这件事。今天最好的方法是创建一个包含所有“内容”的 nuget 包 - 例如 DLL。然后将 nuget 包向导添加到 vstemplate 的 WizardExtension 部分，并添加您的 nuget 包（作为对在线存储库的引用，或实际嵌入的 .nupkg 文件）...

您的 nuget 包将打包在您的最终 VSIX 文件中 - 因此，只需双击即可将所有内容部署到 Visual Studio 部署中。当开发人员基于你的模板创建一个新项目时会发生什么，项目结构将被创建，然后 Visual Studio 会看到有一个 Nuget 依赖项，它会自动将你的 nuget 包安装到新模板中，并添加对项目的适当引用。

以下是关于如何实现这一点的一些完整的解释 - Marcin 的示例有一个可下载的 zip 示例（您可以在他的评论中找到链接）：

[凯达尔·R·库尔卡尼](http://www.bluelemoncode.com/post/2012/01/20/Creating-custom-project-template-for-Visual-Studio-with-pre-installed-NuGet-packages.aspx)

[马辛·多博兹](http://blogs.msdn.com/b/marcinon/archive/2011/07/08/project-templates-and-preinstalled-nuget-packages.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-23T07:01:36.810

是的，在 zip 文件中更新模板中的项目文件。或者使用已包含参考的导出到模板 in vs。 [链接文本](http://social.msdn.microsoft.com/Forums/en-US/vstsstart/thread/e7b4914f-0f35-4ca6-b5fb-003e766bb604)将使这更容易。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-11-29T08:42:09.903

查看此 msdn 页面：“如何：将模板添加到新项目对话框” [https://msdn.microsoft.com/en-us/library/bb166808.aspx](https://msdn.microsoft.com/en-us/library/bb166808.aspx)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2015-03-19T13:44:45.527

将 DLL 复制到项目文件夹的某个位置，将 DLL 添加到解决方案（添加现有项目，手动将过滤器设置为 *.dll），然后在项目设置中添加对该副本的引用。只要您先这样做，它就应该存储在您导出的项目模板中。

# jquery - 尝试从 jQuery 列表中获取单个项目的 id 时使用什么属性（或...）？

> ID：779508
> 
> 赞同：0
> 
> 时间：2009-04-22T22:20:54.737
> 
> 标签：jquery

**修订：**我在从数据库记录（消息）创建的页面上有一个列表项。每条记录都包含一个 Id 值，我当前将其放入每条单独的消息中。我想做的是，当他们单击视图链接以获取消息的 Id 值时，我可以使用 javascript 对其进行操作。

生成的 html 如下所示：

```
<div id"messages">
  <div class="message">
    A cool message <a href="/Message/View/1" id="message_1" class="viewMessage">View</a>
  </div>
  <div class="message">
    A cool message <a href="/Message/View/2" id="message_2" class="viewMessage">View</a>
  </div>
  <div class="message">
    A cool message <a href="/Message/View/3" id="message_3" class="viewMessage">View</a>
  </div>
  <div class="message">
    A cool message <a href="/Message/View/4" id="message_4" class="viewMessage">View</a>
  </div>
</div> 
```

当我单击 id=message_1 时，我想获得 1 的 id 值。我试图避免字符串操作以获取 id 值：比如在“_”之后获取值。如果我可以使用其中值为“1”的单个属性，那就太好了。

```
$('.viewMessage').click(function() {
  ...$(this).messageId...
}); 
```

我可以只做一个属性吗？我实际上也会尝试这个，但我正在考虑整个 xhtml 严格的东西，所以我认为有比这样做更好的东西。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T22:34:43.110

我假设您想在点击处理程序中提取 id 的数字部分。

```
$('.viewMessage').click( function() {
   var id = this.id.replace(/message_/,'');
   ...now go use it...
}); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T22:37:37.817

这会从锚点的 href 中获取一个数字。

```
$('.viewMessage').click(function() {
    var id = this.href.match(/\d+/);
}); 
```

如果你想使用类似的东西`.messageId`，你想先预处理：

```
$('.viewMessage').each(function() {
    this.messageId = this.href.match(/\d+);
    // Or, to be more safe:
    this.messageId = parseInt(this.href.match(/\d+), 10);
}).click(function() {
    alert(this.messageId);
}); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T23:18:00.370

如果您想采用 (X)HTML 5，它允许名称以“data-”开头的任意属性正好用于这种情况。所以这可能是这样的`<a id="message_1" data-message-id="1">`。否则，我认为您将不得不不合格。37signals[使用了这种技术](http://www.37signals.com/svn/posts/1557-javascript-makes-relative-times-compatible-with-caching)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-22T23:31:37.063

我相信在下一个 html 规范中有一个自定义属性的规定。您在它们前面加上 data-
所以， data-id 将是有效的。

顺便说一句：我通常使用自定义属性。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-22T23:40:28.163

我真的不明白你为什么`id="message_1"`在你真的只想要的时候设置`1`，但假设有一个原因并且你不会改变它，你可以使用`rel`属性来代替。

```
<div id"messages">
    <div class="message">
        A cool message <a rel="1" href="/Message/View/1" id="message_1" class="viewMessage">View</a>
        A cool message <a rel="2" href="/Message/View/1" id="message_2" class="viewMessage">View</a>
    </div>
</div> 
```

那应该是有效`XHTML`的，并且您应该能够只获取索引

```
var id = $(this).attr("rel"); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-22T22:32:30.887

试图访问点击链接的 id？

试试这个

```
$('.viewMessage').click(function() {
  var id = $(this).attr('id');
}); 
```

# active-directory - 服务器维护何时应该影响实施决策？

> ID：779511
> 
> 赞同：6
> 
> 时间：2009-04-22T22:22:41.533
> 
> 标签：active-directory, system-administration

这是我的情况...

我正在为需要单点登录过程的大量 Web 应用程序编写一个 .Net/C# 安全系统（授权和身份验证）。我使用 Active Directory 作为数据存储，并编写了一个非常好的原型，通过 LDAP 与 AD 进行通信。该组件检索我存储在 AD 中的登录用户信息，然后我使用这些信息在 .Net 表单身份验证中设置他们的安全角色。

1）一切都很好。

作为系统管理员或网络工程师，我不熟悉设置 AD 实例所涉及的系统管理量。我不知道对于每个域，我都需要一个单独的服务器和域控制器。事实证明，我的团队需要为我们将要访问 AD 的所有不同环境设置 9 个不同的域……

*   env1.dev.mycompany.com
*   env1.qa.mycompany.com
*   env1.stage.mycompany.com
*   env2.dev.mycompany.com
*   ETC

...所以现在我给自己带来了一些管理上的头疼，因为我将不得不维护所有这些机器（或 VM），这是我不一定确定我想要做的事情。

2）一切都不好。

原型非常可靠，AD 为解决方案提供了一个非常好的数据库，但现在我想知道我是否应该放弃代码并改为编写 SQL Server 数据提供程序（我知道 .Net 已经提供了一个，但它没有'不仅符合我对授权的业务要求）。

无论如何，所以我试图从高层次的角度来思考这个问题。一般来说，我总是因为一些服务器维护而抛出一个非常好的解决方案这一事实而绊倒？我想知道这里是否有人经历过这样的场景以及你决定做什么。

也不必特定于 AD，只是您必须在一个好的软件解决方案和它的服务器维护限制之间进行评估的情况。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-22T22:49:42.717

一般来说，产品的可用性是人们在它和类似产品之间进行选择的原因。如果产品的可用性很差，用户就不会关心它的代码质量有多高——对他们来说，重要的是它的易用性和有效性以及它是否能很好地满足他们的需求。

维护可以被认为是可用性的一个方面。我会把拥有易于维护的产品作为首要任务。从长远来看，这将节省管理员的大量工作时间。

一种思考方式是，首先从最终用户/管理员的角度设计最有用的解决方案，然后让实际实施该最佳解决方案成为一项智力挑战。这可能需要程序员付出更多的努力，但最终结果会更好。

例如， [ZFS](http://en.wikipedia.org/wiki/ZFS)是一款维护得很好的产品（尽管我没有亲自使用过）。在设计它时，投入了大量精力来简化使用 ZFS 的命令行工具来管理文件系统 - 这些设计决策会影响 ZFS 的所有级别（例如存储池）。

作为另一个例子，我最近一直在计划如何在我的未来项目中进行维护 - 分布式数据库和应用程序服务器。思考典型的管理任务将如何发生（安装/升级应用程序、在集群中添加/删除服务器、解决硬件故障等），帮助我理清了一些设计决策。其中一些深入到系统的架构中（例如，应用程序和扩展如何在运行时加载，以及服务器如何在集群中找到其他服务器）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T22:39:58.370

如果为 Windows 系统设置单点登录系统，我很可能会使用 AD。作为系统管理员。我尝试遵循单一数据源政策。AD 已经保存了我的大部分 Windows 用户/安全数据。我宁愿把所有东西都放在里面，而不是第二个系统。

在设置 dev/test/prod 环境时，我尝试确保与 Prod 环境紧密匹配，尤其是在正在开发的领域（正在投入开发工作等）。因此，如果设置系统来开发与 AD 的接口，我可能会有多个 AD 服务器。

**哪些选项可以简化管理员？**

您能否拥有 1 台以标准方式维护的主服务器，并使用 VMware 复制过程之类的东西来维护所有或大部分其他服务器？除了为支持开发/测试所做的更改外，不要对 9 台服务器做任何事情，而是将其他 8 台服务器保留为该镜像主服务器的副本？

您可以从 1 个 AD 服务器运行多个开发或测试域吗？

你可以编写动作脚本吗？

你能减少环境的数量，尤其是在测试的高端吗？例如，将多个开发环境和角色升级版本提供到一个测试环境中？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T22:41:10.427

为什么在测试时不简单地使用 OU 而不是单独的域？也就是说，有一个域，但指定特定版本的用户必须在该域内的特定 OU 中找到。您要做的是在用于查找用户的搜索功能中，将特定的 OU 指定为搜索根目录，而不是域的根目录。在每个 OU 中，您可以拥有包含环境的 ID 以保持它们的唯一性，例如 , `user_env1_dev`, `user_env2_dev`, `user_env1_qa`...

我在我的应用程序中经常使用 AD，并且从不为开发/测试设置单独的域。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-22T23:38:17.140

使用提供者模式并抽象您的数据源调用。

然后，您可以将其配置为动态使用 AD 或 SQL。

```
public abstract SSODataProvider {
     public bool AuthenticateUser(string u, string p);
}

public ADSSODataProvider : SSODataProvider {
    public override AutheticateUser(string u, string p) {
       //do auth here
    }
}

public SQLSSODataProvider : SSODataProvider {
    public override AuthenticateUser(String u, string p) {
      //call DB
    }
}

public static SSODataProvider dataProvider;

if (ConfigurationSettings.AppSettings["SSODataProvider"] == "SQL")
   dataProvider = new SQLSSODataProvider();
else
   dataProvider = new ADSSODataProvider();

....

dataProvider.AuthenticateUser("sss","sss"); 
```

# version-control - 为 Web 应用程序组织主图形文件 (Photoshop / Gimp)

> ID：779516
> 
> 赞同：2
> 
> 时间：2009-04-22T22:24:41.403
> 
> 标签：version-control, graphics

我们中的一些程序员不得不时不时地处理图形文件......

*   快速修复现有图形
*   将一个快速精灵作为原型放在一起
*   因为设计师太忙所以创建一个图标

我认为任何人都不应该直接编辑网络图形（jpg / gif / png）。他们应该编辑主文件并在 Web 图形之上导出。

现在，我们系统中的所有 psd 文件都在设计人员或其他各种人的驱动器上，如果程序员需要进行适当的更改，他们就不能没有高昂的开销。

我应该如何解决这个障碍？

1.  将 *.psd / *.xcf 文件保存在 Web 图形 *.jpg *.png *.gif 旁边，以便于查找。要么在源代码控制中培训图形设计，要么让某人负责集成。我倾向于喜欢这个，因为它使所有内容都非常容易被发现，并且您可以让您的网络发布系统跳过 *.pdf *.xcf。但是，我也可以看到一个不喜欢 2mb psd 文件的编码器破坏了他们的存储库，并且不得不在 svn update 上下载它。

2.  为主图形文件创建单独的源代码控制存储库或网络共享。

3.  按原样继续...

还有其他建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-23T12:56:06.240

我总是将我从事的项目中使用的 PSD 视为源文件，并将从这些 PSD 导出的 jpeg 和 gif 视为二进制文件。转换为 PDF 的 Word 文件也是如此。

我的后备箱通常有两个子文件夹：

```
trunk
  /source
  /deploy 
```

未上到服务器的所有内容都属于源文件夹，其他所有内容都属于部署。如果我创建一个用作备份的数据库导出，那么我将它存储在源文件夹的子文件夹中（因为它不会进入服务器）。

有些纯粹主义者声称二进制文件不属于版本控制。我说那是BS。PSD 是 jpeg 和 gif 的源文件，就像 .java 文件是 .class 文件的源一样。我说，就这样踩吧。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-23T13:01:02.140

我会选择选项 2。正如您所说，源存储库中大型 PSD 的开销可能太高而无法舒适！

您是否研究过脚本 Photoshop 导出，以便“更改 PSD 文件”->“更新网站上的图形”工作流程尽可能紧凑和简单？这将使整个企业对 IMO 的每个人都具有真正的吸引力；特别是如果它设置为作为提交时的构建步骤运行。

**编辑：** Photoshop 似乎支持 Javascript 作为脚本语言，因此获得令人满意的结果应该相当简单[http://morris-photographics.com/photoshop/tutorials/scripting1.html](http://morris-photographics.com/photoshop/tutorials/scripting1.html)

# coldfusion - CFML 变量名称不能以“.”结尾。字符错误

> ID：779517
> 
> 赞同：2
> 
> 时间：2009-04-22T22:25:03.447
> 
> 标签：coldfusion, fusebox

发布表单时出现此错误。不过，最奇怪的是，这个错误只发生在 Chrome 和 Safari 中。FF、IE 和 Opera 都可以毫无问题地发布表单。

堆栈跟踪不指向发生此错误的文件。cfcatch 的 cfdump 让我对问题所在有了一些了解，但我找不到任何实际存在问题的实例。这是部分转储：

```
第 1 列
详细信息 变量属性。以“.”结尾 特点。您必须提供额外的结构键或删除“。” 特点。
已知列 -1
已知线 -1
已知文本“未知”
1号线
消息 CFML 变量名称不能以“.”结尾 特点。

```

这是处理发布数据的代码。一切都包含在 cftransaction 中，并且有一个循环，不知道为什么它没有被显示。（感谢 Peter Boughton 澄清这一点）

```
<!--- Delete out the old category ties --->
<cfquery name="deleteCategory" datasource="#request.dsnWrite#">
DELETE FROM
    ProductListings_categories
WHERE
    listingID = <cfqueryparam value="#attributes.listingID#">
</cfquery>

<!--- Loop through the list --->
<cfloop list="#attributes.taginput#" index="idx" delimiters=".">

<!--- check to see if tag exists --->
    <cfquery name="checkTag" datasource="#request.dsnWrite#">
    SELECT
        categoryID
    FROM
        categories
    WHERE
        CategoryName = <cfqueryparam value="#idx#" cfsqltype="cf_sql_varchar">
    </cfquery>

    <!--- If it does not then add the tag --->
    <cfif not(checkTag.recordCount)>
        <cfquery name="insertTag" datasource="#request.dsnWrite#">
        INSERT into Categories
        (
        categoryname,
        dateCreated
        )
        VALUES
        (
        <cfqueryparam value="#idx#" cfsqltype="cf_sql_varchar">,
        <cfqueryparam value="#now()#" cfsqltype="cf_sql_timestamp">
        )
        </cfquery>

        <cfquery name="insertTag" datasource="#request.dsnWrite#">
        SELECT
            LAST_INSERT_ID() as newID
        FROM
            Categories
        </cfquery>

        <cfset variables.categoryID = insertTag.newID>
    <cfelse>
        <cfset variables.categoryID = checkTag.categoryID>
    </cfif>

    <cftry>
        <!--- Tie the tag to the listing --->
        <cfquery name="insertCategory" datasource="#request.dsnWrite#">
        INSERT into ProductListings_categories
        (
        listingID,
        CategoryID
        )
        VALUES
        (
        <cfqueryparam value="#attributes.listingID#" cfsqltype="cf_sql_bigint">,
        <cfqueryparam value="#variables.categoryID#" cfsqltype="cf_sql_bigint">
        )
        </cfquery>
        <cfcatch></cfcatch>
    </cftry>
</cfloop>

<cflocation url="/sell/add_listing/step/3/listingID/#attributes.listingID#" addtoken="false"> 
```

任何见解都会很棒。谢谢！

这是表格和Javascript。我还没有机会重写以前的开发人员的代码（到目前为止，它正在工作，所以没有必要首先访问代码），但是没有使用 CFFORM，其他的也没有CF 表单项。各种 JS 函数用于 AJAX 调用，也包括在内。

```
<form action="/sell/add_listing/step/2/listingID/#attributes.listingId#" method="post">
    <div id="formFields"><input name="tagInput" id="tagInput" value="#variables.tagInput#" type="hidden"/></div>

    <h3>Step 2: <span id="instructions">First, choose a top-level category</span></h3>
    <p id="instructions2">This category will show up as the first tag on your listing.</p>

    <div id="tagLand">
        <div>
            1\. <select onchange="mainCategorySelector(this.value)">
                <cfloop query="getTopCats">
                <option value="#getTopCats.categoryName#" <cfif ListFirst(variables.tagInput,".") EQ getTopCats.categoryName>selected="selected"</cfif>>#capFirstTitle(ReplaceNoCase(getTopCats.categoryName, "_"," ", "all"))#</option>
                </cfloop>
            </select>
        </div>

        <div id="inputDiv" style="visibility: hidden;">
            <div>Add a tag</div>

            <div>2.
                <input type="text" onkeypress="return disableEnterKey(event)" name="newTag" id="newTag" maxlength="18"/>
                <input type="button" value="add" onclick="addTag(document.getElementById('newTag').value)" class="small_button" />
            </div>

            <div class="error"></div>
        </div>
    </div>

    <a href="/sell/add_listing/step/1/listingID/#attributes.listingId#"><img src="/resources/img/layoutV3/button_prev.gif" alt="prev"/></a>
    <input type="image" name="btnSubmit" src="/resources/img/layoutV3/button_next.gif" />
</form>

<script src="/resources/js/listing_2.js" type="text/javascript"></script>

//some variables
var listCount=1;
var tagLimit=14;
var maxSuggestions=100;
var allTags=new Array();
var allTags=new Array();
var allTagPointers=new Array();
var currentTags=0;

// XML document
var xmlDoc;
var req;

//this function will run anything upon page load
function addLoadEvent(func)
{
    var oldonload = window.onload;
    if (typeof window.onload != 'function')
    {
        if(func)window.onload = func;
    }
    else
    {
        window.onload = function() 
        {
            oldonload();
            func();
        }
    }
}

//let's rebuild the page!
addLoadEvent(rebuildTags());

function rebuildTags()
{
    //grab the tag tree left for us by PHP
    var passedTags=document.getElementById('tagInput').value;

    //only run if we got a value
    if(passedTags.replace(/^\s+|\s+$/g, ""))
    {
        //split the string into an array
        passedTags=passedTags.split(".");

        //run functions to rebuild the world
        mainCategorySelector(passedTags[0]);
        for(var i=1;i<passedTags.length;i++)
        {
            addTag(passedTags[i]);
        }
    }
}

function addTag(tagName)
{
    tagName=trim(tagName);
    tagName=tagName.toLowerCase();
    if(tagName)
    {
        //remove underscores from tags, replace with spaces so we can validate
        tagName=tagName.replace(/_/g," ");

        //clear out error message if it's there
        var errorDiv=document.getElementById('errorDiv');
        errorDiv.innerHTML="";

        //only run if we're not at the limit and tag has not been used already
        if(currentTags<=tagLimit && !getArrayIndex(allTags,tagName))
        {
            //if not alphanumeric, error
            var myRegxp = /^[0-9a-zA-Z\s]*$/;
            if(myRegxp.test(tagName)==false)
            {
                var errorDiv=document.getElementById('errorDiv');
                errorDiv.innerHTML="You may only use letters and numbers in your tags.";
            }
            //if it error checks fine, move on
            else
            {
                //let's replace all spaces with underscores for DB storage
                //tagName=tagName.replace(/ /g,"_");

                //query server and get list of related tags

                //random number to kill the cache
                var cacheKiller=Math.random();
                //get all children tags
                xmlDoc=ajaxRequest("/sell/get_categories_xml/tag/"+tagName.replace(/ /g,"_")+"/random/"+cacheKiller);
                relatedTags=new Array;

                var root=xmlDoc.getElementsByTagName('root')[0];
                var tags=root.getElementsByTagName('tag');

                //now get all sibling tags
                xmlDoc=ajaxRequest("/sell/get_categories_siblings_xml/tag/"+tagName.replace(/ /g,"_")+"/random/"+cacheKiller);
                root=xmlDoc.getElementsByTagName('root')[0];

                var siblingTags=root.getElementsByTagName('tag');

                //first compile child tags into an array
                for(var i=0;(i<tags.length && i<maxSuggestions);i++)
                {
                    relatedTags[i]=tags[i].firstChild.nodeValue;
                }

                //now add sibling tags to the same array
                tags=root.getElementsByTagName('tag');
                for(i;(i<tags.length && i<maxSuggestions);i++)
                {    
                    relatedTags[i]=tags[i].firstChild.nodeValue;
                }

                var tagLand=document.getElementById('tagLand');
                var newNumberDiv=document.createElement('div');
                var newDiv=document.createElement('div');

                //add to counter and master tag array
                listCount++;
                allTags[allTags.length]=tagName.replace(/ /g,"_");
                allTagPointers[allTagPointers.length]=listCount;
                updateForm();

                newNumberDiv.setAttribute('id','number_'+listCount);
                newNumberDiv.className='listing_number';
                newNumberDiv.innerHTML=listCount+".";

                newDiv.innerHTML=tagName+' <span  onclick="removeTag(\''+listCount+'\');" class="list_dynamic_link">x</span>';
                newDiv.className='list_tag';

                var newReccomendDiv=makeRelatedDiv(relatedTags);

                //let's give IDs to all of the new divs so we can't kill 'em later
                newDiv.setAttribute('id','tagDiv'+listCount);
                newReccomendDiv.setAttribute('id','reccomendDiv'+listCount);

                //add new divs to the master list
                tagLand.appendChild(newNumberDiv);
                tagLand.appendChild(newDiv);
                tagLand.appendChild(newReccomendDiv);

                //remove and re-append the input div to keep it at the end
                var inputDiv=document.getElementById('inputDiv');
                tagLand.removeChild(inputDiv);
                tagLand.appendChild(inputDiv);

                //make the inputDiv visible if it is not already
                inputDiv.style.visibility='visible';

                //run the reorderizer 
                reorderizer();

                //clear input field
                document.getElementById('newTag').value="";

                document.getElementById('newTag').focus();
            }
        }
    }
}

//removes a tag from the list -- called through the "x" link on each tag
function removeTag(tagNumber)
{
    //get master div
    var tagLand=document.getElementById('tagLand');

    //get reference to all three divs that make up a tag listing
    var deathRowNumberDiv=document.getElementById('number_'+tagNumber);
    var deathRowTagDiv=document.getElementById('tagDiv'+tagNumber);
    var deathRowReccomendDiv=document.getElementById('reccomendDiv'+tagNumber);

    //any last words, boys?
    tagLand.removeChild(deathRowNumberDiv);
    tagLand.removeChild(deathRowTagDiv);
    tagLand.removeChild(deathRowReccomendDiv);

    //find where we are in the master array
    var tagIndex=getArrayIndex(allTagPointers,tagNumber);
    //splice this tag out of master tag array
    allTags.splice(tagIndex,1);
    allTagPointers.splice(tagIndex,1);
    updateForm();

    //alert(allTags.join("."));

    //since we just changed the page structure, let's run reorderizer
    //run the reorderizer 
    reorderizer();

    //make the inputDiv visible if we're below the tag limit
    var inputDiv=document.getElementById('inputDiv');
    if(currentTags<=tagLimit)
    {
        inputDiv.style.visibility='visible';
    }
}

//this function displays the formatted div for related tags
function makeRelatedDiv(relatedTags)
{
    //let's prepare the recommended tags div
    var newReccomendDiv=document.createElement('div');
    newReccomendDiv.className='list_suggested_tags';
    newReccomendDiv.innerHTML='<span>Add related tags: </span> ';
    var numTags=0;

    //loop through suggested tag array
    for ( keyVar in relatedTags )
    {
        //add comma if necessary
        if(numTags)
        {
            newReccomendDiv.innerHTML+=", ";
        }
        newReccomendDiv.innerHTML+='<span  onclick="addTag(\''+relatedTags[keyVar]+'\');" class="list_dynamic_link">'+relatedTags[keyVar]+'</span>';
        numTags++;
    }

    return newReccomendDiv;
}

function mainCategorySelector(tag)
{
    //only run if we're not the dead selection
    if(tag!="- - -")
    {
        //query server and get list of related tags

        //random number to kill the cache
        var cacheKiller=Math.random();
        xmlDoc=ajaxRequest("/sell/get_categories_xml/tag/"+tag+"/random/"+cacheKiller);

        relatedTags=new Array;

        var root=xmlDoc.getElementsByTagName('root')[0];
        var tags=root.getElementsByTagName('tag');

        for(var i=0;(i<tags.length && i<maxSuggestions);i++)
        {
            relatedTags[i]=tags[i].firstChild.nodeValue;
        }

        var tagLand=document.getElementById('tagLand');

        var newReccomendDiv=makeRelatedDiv(relatedTags);

        //replace old reccomend list if it exists
        if(document.getElementById('mainCategoryReccomendations'))
        {
            var mainCategoryReccomendations=document.getElementById('mainCategoryReccomendations');
            tagLand.appendChild(newReccomendDiv);
            tagLand.insertBefore(newReccomendDiv , mainCategoryReccomendations);
            tagLand.removeChild(mainCategoryReccomendations);
        }
        else
        {
            tagLand.appendChild(newReccomendDiv);
            //add to counter if we added a new tag
            listCount++;
        }

        newReccomendDiv.setAttribute('id' , 'mainCategoryReccomendations');

        //alert(allTags.join("."));

        //add master tag array    
        allTags[0]=tag;
        allTagPointers[0]=1;
        updateForm()

        //alert(allTags.join("."));

        //remove and re-append the input div to keep it at the end
        var inputDiv=document.getElementById('inputDiv');
        tagLand.removeChild(inputDiv);
        tagLand.appendChild(inputDiv);

        //make the inputDiv visible if we're below the tag limit
        if(currentTags<=tagLimit)
        {
            inputDiv.style.visibility='visible';

            //focus on the new field
            document.getElementById('newTag').focus();
        }

        //change up the instructions
        changeInstructions("Now, add other tags to sort your listing","You can either click the related tags or enter your own")
    }
}

//this function changes the content of the instructional div
function changeInstructions(top, bottom)
{
    var instructions=document.getElementById('instructions');
    var instructions2=document.getElementById('instructions2');
    instructions.innerHTML=top;
    instructions2.innerHTML=bottom;
}

//this function reassigns all list numbers to their proper value
function reorderizer()
{
    /*
    Here we run through all number div IDs...
    remember, the div ID number may not match the display number, due to 
    additions/removals. That's why we have a separate variable for displayNumber!
    */

    var tagLand=document.getElementById('tagLand');

    //another counting var, for the actual display number
    var displayNumber=1;

    for(var i=1; i <= listCount; i++)
    {
        if(document.getElementById('number_'+i))
        {
            var b=document.getElementById('number_'+i);
            b.innerHTML=displayNumber+".";

            //ony increment displayNumber if we've actually printed a number
            displayNumber++;
        }
    }

    //update global tag count to most current and accurate number
    currentTags=displayNumber;

    //have we hit the tag limit? If so, hidezorz input
    if(displayNumber>tagLimit)
    {
        var inputDiv=document.getElementById('inputDiv');
        inputDiv.style.visibility='hidden';
    }
    else
    {
        //after looping through dynamic list entries, let's change the submit field's number too
        var number_last=document.getElementById('number_last');
        if(number_last)
        {
            number_last.innerHTML=displayNumber+".";
        }
    }
}

function pausecomp(millis) 
{
    date = new Date();
    var curDate = null;

    do { var curDate = new Date(); } 
    while(curDate-date < millis);
}

function ajaxRequest(requestURL)
{
    var req;
    if (window.XMLHttpRequest) {
        req = new XMLHttpRequest();
    } else if (window.ActiveXObject) {
        req = new ActiveXObject("Microsoft.XMLHTTP");
    }

    req.open("GET", requestURL, false);
    req.send(null);
    var xmlDocument = req.responseXML;
    return(xmlDocument);
}

function disableEnterKey(e)
{
    var key;

    if(window.event)
        key = window.event.keyCode;     //IE
    else
        key = e.which;     //firefox

    if(key == 13)
    {
        addTag(document.getElementById('newTag').value);
        return false;
    }
    else
    {
        return true;
    }
}

function getArrayIndex(arr, val) 
{
    for (i = 0; i < arr.length; i++) 
    {
        if (arr[i] == val) { return i; }
    }
}

function updateForm()
{
    //this function updates the hidden field that will actually send the tag data upon form submission
    document.getElementById('tagInput').value=allTags.join(".");
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-23T00:21:33.337

问题解决：选择列表没有定义name属性，结果属性变量确实有一个空字段名，导致错误。在我的例子中，选择列表没有在 CF 中使用，而仅在 JS 中使用。即使字段没有名称，Chrome 和 Safari 也会传递字段的值，而 IE、FF 和 Opera 则不会。谢谢你指引我正确的方向。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T22:41:40.083

从您的描述看来，错误是由客户端中的表单本身引发的，而不是您在上面发布的处理代码。如果您在调用页面上有 cfform/cfgrid，您可能需要查看 CF 生成的 Javascript 并针对 Chrome/Safari 进行测试。

# java - 在Java中递归删除目录

> ID：779519
> 
> 赞同：414
> 
> 时间：2009-04-22T22:25:42.150
> 
> 标签：java, file-io, filesystems, delete-directory

有没有办法在Java中递归删除整个目录？

在正常情况下，可以删除一个空目录。但是，当涉及到删除包含内容的整个目录时，就不再那么简单了。

如何在 Java 中删除包含内容的整个目录？

* * *

## 回答 #1

> 赞同：486
> 
> 时间：2009-04-22T22:37:49.233

您应该查看[Apache 的 commons-io](//commons.apache.org/proper/commons-io/)。它有一个[FileUtils](//commons.apache.org/proper/commons-io/javadocs/api-2.4/org/apache/commons/io/FileUtils.html#deleteDirectory(java.io.File))类，可以做你想做的事。

```
FileUtils.deleteDirectory(new File("directory")); 
```

* * *

## 回答 #2

> 赞同：194
> 
> 时间：2009-04-22T22:29:33.047

使用 Java 7，我们终于[可以通过可靠的符号链接检测来做到这一点。](https://stackoverflow.com/a/27917071/3474)（我不认为 Apache 的 commons-io 目前没有*可靠的*符号链接检测，因为它不处理在 Windows 上使用 . 创建的链接`mklink`。）

为了历史起见，这是一个 Java 7 之前的答案，它*遵循符号链接。*

```
void delete(File f) throws IOException {
  if (f.isDirectory()) {
    for (File c : f.listFiles())
      delete(c);
  }
  if (!f.delete())
    throw new FileNotFoundException("Failed to delete file: " + f);
} 
```

* * *

## 回答 #3

> 赞同：157
> 
> 时间：2015-01-13T07:38:22.177

在 Java 7+ 中，您可以使用[`Files`](http://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html)类。代码很简单：

```
Path directory = Paths.get("/tmp");
Files.walkFileTree(directory, new SimpleFileVisitor<Path>() {
   @Override
   public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException {
       Files.delete(file);
       return FileVisitResult.CONTINUE;
   }

   @Override
   public FileVisitResult postVisitDirectory(Path dir, IOException exc) throws IOException {
       Files.delete(dir);
       return FileVisitResult.CONTINUE;
   }
}); 
```

* * *

## 回答 #4

> 赞同：80
> 
> 时间：2017-02-16T07:27:58.703

**递归删除所有文件和目录（包括起始目录）的**单线解决方案（Java8） ：****

 **```
Files.walk(Paths.get("c:/dir_to_delete/"))
                .map(Path::toFile)
                .sorted((o1, o2) -> -o1.compareTo(o2))
                .forEach(File::delete); 
```

我们使用比较器来反转顺序，否则 File::delete 将无法删除可能非空的目录。因此，如果您想保留目录并且只删除文件，只需删除 sorted() 中的比较器**或**完全删除排序并添加文件过滤器：

```
Files.walk(Paths.get("c:/dir_to_delete/"))
                .filter(Files::isRegularFile)
                .map(Path::toFile)
                .forEach(File::delete); 
```

* * *

## 回答 #5

> 赞同：67
> 
> 时间：2011-12-31T02:45:25.360

Java 7 添加了对带有符号链接处理的遍历目录的支持：

```
import java.nio.file.*;

public static void removeRecursive(Path path) throws IOException
{
    Files.walkFileTree(path, new SimpleFileVisitor<Path>()
    {
        @Override
        public FileVisitResult visitFile(Path file, BasicFileAttributes attrs)
                throws IOException
        {
            Files.delete(file);
            return FileVisitResult.CONTINUE;
        }

        @Override
        public FileVisitResult visitFileFailed(Path file, IOException exc) throws IOException
        {
            // try to delete the file anyway, even if its attributes
            // could not be read, since delete-only access is
            // theoretically possible
            Files.delete(file);
            return FileVisitResult.CONTINUE;
        }

        @Override
        public FileVisitResult postVisitDirectory(Path dir, IOException exc) throws IOException
        {
            if (exc == null)
            {
                Files.delete(dir);
                return FileVisitResult.CONTINUE;
            }
            else
            {
                // directory iteration failed; propagate exception
                throw exc;
            }
        }
    });
} 
```

我将其用作特定于平台的方法的后备方法（在此**未经测试**的代码中）：

```
public static void removeDirectory(Path directory) throws IOException
{
    // does nothing if non-existent
    if (Files.exists(directory))
    {
        try
        {
            // prefer OS-dependent directory removal tool
            if (SystemUtils.IS_OS_WINDOWS)
                Processes.execute("%ComSpec%", "/C", "RD /S /Q \"" + directory + '"');
            else if (SystemUtils.IS_OS_UNIX)
                Processes.execute("/bin/rm", "-rf", directory.toString());
        }
        catch (ProcessExecutionException | InterruptedException e)
        {
            // fallback to internal implementation on error
        }

        if (Files.exists(directory))
            removeRecursive(directory);
    }
} 
```

（SystemUtils 来自[Apache Commons Lang](http://commons.apache.org/lang/)。进程是私有的，但它的行为应该是显而易见的。）

* * *

## 回答 #6

> 赞同：35
> 
> 时间：2010-10-26T18:28:25.893

Just saw my solution is more or less the same as erickson's, just packaged as a static method. Drop this somewhere, it's much lighter weight than installing all of Apache Commons for something that (as you can see) is quite simple.

```
public class FileUtils {
    /**
     * By default File#delete fails for non-empty directories, it works like "rm". 
     * We need something a little more brutual - this does the equivalent of "rm -r"
     * @param path Root File Path
     * @return true iff the file and all sub files/directories have been removed
     * @throws FileNotFoundException
     */
    public static boolean deleteRecursive(File path) throws FileNotFoundException{
        if (!path.exists()) throw new FileNotFoundException(path.getAbsolutePath());
        boolean ret = true;
        if (path.isDirectory()){
            for (File f : path.listFiles()){
                ret = ret && deleteRecursive(f);
            }
        }
        return ret && path.delete();
    }
} 
```

* * *

## 回答 #7

> 赞同：20
> 
> 时间：2012-04-26T16:30:02.133

具有堆栈且没有递归方法的解决方案：

```
File dir = new File("/path/to/dir");
File[] currList;
Stack<File> stack = new Stack<File>();
stack.push(dir);
while (! stack.isEmpty()) {
    if (stack.lastElement().isDirectory()) {
        currList = stack.lastElement().listFiles();
        if (currList.length > 0) {
            for (File curr: currList) {
                stack.push(curr);
            }
        } else {
            stack.pop().delete();
        }
    } else {
        stack.pop().delete();
    }
} 
```

* * *

## 回答 #8

> 赞同：16
> 
> 时间：2010-06-10T16:36:55.830

[Guava](https://github.com/google/guava)一直[`Files.deleteRecursively(File)`](http://google.github.io/guava/releases/9.0/api/docs/com/google/common/io/Files.html#deleteRecursively(java.io.File))支持到**Guava 9**。

从[番石榴10](http://google.github.io/guava/releases/10.0.1/api/docs/com/google/common/io/Files.html#deleteRecursively(java.io.File))：

> **已弃用。**此方法存在较差的符号链接检测和竞争条件。此功能只能通过向操作系统命令（例如`rm -rf`或）提供适当的支持`del /s`。*此方法计划在 Guava 11.0 版中从 Guava 中删除。*

[因此， Guava 11](http://google.github.io/guava/releases/11.0.2/api/docs/com/google/common/io/Files.html)中没有这种方法。

* * *

## 回答 #9

> 赞同：16
> 
> 时间：2015-01-14T03:29:50.903

如果你有 Spring，你可以使用[FileSystemUtils.deleteRecursively](http://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/util/FileSystemUtils.html#deleteRecursively-java.io.File-)：

```
import org.springframework.util.FileSystemUtils;

boolean success = FileSystemUtils.deleteRecursively(new File("directory")); 
```

* * *

## 回答 #10

> 赞同：13
> 
> 时间：2014-10-28T14:30:43.003

```
for(Path p : Files.walk(directoryToDelete).
        sorted((a, b) -> b.compareTo(a)). // reverse; files before dirs
        toArray(Path[]::new))
{
    Files.delete(p);
} 
```

Or if you want to handle the `IOException`:

```
Files.walk(directoryToDelete).
    sorted((a, b) -> b.compareTo(a)). // reverse; files before dirs
    forEach(p -> {
        try { Files.delete(p); }
        catch(IOException e) { /* ... */ }
      }); 
```

* * *

## 回答 #11

> 赞同：11
> 
> 时间：2011-06-28T23:19:06.007

```
public void deleteRecursive(File path){
    File[] c = path.listFiles();
    System.out.println("Cleaning out folder:" + path.toString());
    for (File file : c){
        if (file.isDirectory()){
            System.out.println("Deleting file:" + file.toString());
            deleteRecursive(file);
            file.delete();
        } else {
            file.delete();
        }
    }
    path.delete();
} 
```

* * *

## 回答 #12

> 赞同：9
> 
> 时间：2011-12-25T20:42:14.673

```
public static void deleteDirectory(File path) 
{
    if (path == null)
        return;
    if (path.exists())
    {
        for(File f : path.listFiles())
        {
            if(f.isDirectory()) 
            {
                deleteDirectory(f);
                f.delete();
            }
            else
            {
                f.delete();
            }
        }
        path.delete();
    }
} 
```

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2011-05-13T15:04:11.490

符号链接和上述代码失败的两种方法......并且不知道解决方案。

# 方式#1

运行这个来创建一个测试：

```
echo test > testfile
mkdir dirtodelete
ln -s badlink dirtodelete/badlinktodelete 
```

在这里您可以看到您的测试文件和测试目录：

```
$ ls testfile dirtodelete
testfile

dirtodelete:
linktodelete
```

然后运行你的 commons-io deleteDirectory()。它崩溃说找不到文件。不确定其他示例在这里做了什么。Linux rm 命令会简单地删除链接，并且目录上的 rm -r 也会。

```
Exception in thread "main" java.io.FileNotFoundException: File does not exist: /tmp/dirtodelete/linktodelete
```

# 方式#2

运行这个来创建一个测试：

```
mkdir testdir
echo test > testdir/testfile
mkdir dirtodelete
ln -s ../testdir dirtodelete/dirlinktodelete 
```

在这里您可以看到您的测试文件和测试目录：

```
$ ls dirtodelete testdir
dirtodelete:
dirlinktodelete

testdir:
testfile 
```

然后运行您的 commons-io deleteDirectory() 或人们发布的示例代码。它不仅会删除目录，还会删除被删除目录之外的测试文件。（它隐式地取消引用目录，并删除内容）。rm -r 只会删除链接。您需要使用类似这样的方法删除取消引用的文件：“find -L ditodelete -t​​ype f -exec rm {} \;”。

```
$ ls dirtodelete testdir
ls: cannot access dirtodelete: No such file or directory
testdir:
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2013-02-11T13:33:08.893

你可以使用：

`org.apache.commons.io.FileUtils.deleteQuietly(destFile);`

*删除文件，从不抛出异常。如果文件是一个目录，删除它和所有子目录。File.delete() 和这个方法的区别是： 要删除的目录不一定是空的。无法删除文件或目录时不会引发异常。*

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2017-12-25T00:10:54.790

处理异常的最佳解决方案与从方法引发的异常应始终描述该方法尝试（和失败）执行的方法一致：

```
private void deleteRecursive(File f) throws Exception {
    try {
        if (f.isDirectory()) {
            for (File c : f.listFiles()) {
                deleteRecursive(c);
            }
        }
        if (!f.delete()) {
            throw new Exception("Delete command returned false for file: " + f);
        }
    } 
    catch (Exception e) {
        throw new Exception("Failed to delete the folder: " + f, e);
    }
} 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2016-05-16T14:41:45.720

在遗留项目中，我需要创建本机 Java 代码。我创建此代码类似于 Paulitex 代码。看到：

```
public class FileHelper {

   public static boolean delete(File fileOrFolder) {
      boolean result = true;
      if(fileOrFolder.isDirectory()) {
         for (File file : fileOrFolder.listFiles()) {
            result = result && delete(file);
         }
      }
      result = result && fileOrFolder.delete();
      return result;
   } 
} 
```

和单元测试：

```
public class FileHelperTest {

    @Before
    public void setup() throws IOException {
       new File("FOLDER_TO_DELETE/SUBFOLDER").mkdirs();
       new File("FOLDER_TO_DELETE/SUBFOLDER_TWO").mkdirs();
       new File("FOLDER_TO_DELETE/SUBFOLDER_TWO/TEST_FILE.txt").createNewFile();
    }

    @Test
    public void deleteFolderWithFiles() {
       File folderToDelete = new File("FOLDER_TO_DELETE");
       Assert.assertTrue(FileHelper.delete(folderToDelete));
       Assert.assertFalse(new File("FOLDER_TO_DELETE").exists());
    }

} 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2018-03-10T12:59:12.163

下面的代码递归删除给定文件夹中的所有内容。

```
boolean deleteDirectory(File directoryToBeDeleted) {
    File[] allContents = directoryToBeDeleted.listFiles();
    if (allContents != null) {
        for (File file : allContents) {
            deleteDirectory(file);
        }
    }
    return directoryToBeDeleted.delete();
} 
```

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2009-04-23T21:38:01.433

这是一个接受命令行参数的简单主要方法，您可能需要附加自己的错误检查或将其塑造成您认为合适的方式。

```
import java.io.File;
import java.io.FileNotFoundException;
import java.io.IOException;

public class DeleteFiles {

/**
 * @param intitial arguments take in a source to read from and a 
 * destination to read to
 */
    public static void main(String[] args)
                     throws FileNotFoundException,IOException {
        File src = new File(args[0]);
        if (!src.exists() ) {
            System.out.println("FAILURE!");
        }else{
            // Gathers files in directory
            File[] a = src.listFiles();
            for (int i = 0; i < a.length; i++) {
                //Sends files to recursive deletion method
                fileDelete(a[i]);
            }
            // Deletes original source folder
            src.delete();
            System.out.println("Success!");
        }
    }

    /**
     * @param srcFile Source file to examine
     * @throws FileNotFoundException if File not found
     * @throws IOException if File not found
     */
    private static void fileDelete(File srcFile)
                     throws FileNotFoundException, IOException {
        // Checks if file is a directory
        if (srcFile.isDirectory()) {
            //Gathers files in directory
            File[] b = srcFile.listFiles();
            for (int i = 0; i < b.length; i++) {
                //Recursively deletes all files and sub-directories
                fileDelete(b[i]);
            }
            // Deletes original sub-directory file
            srcFile.delete();
        } else {
            srcFile.delete();
        }
    }
} 
```

我希望这会有所帮助！

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2020-05-30T08:12:34.310

[Guava](https://guava.dev)提供了一个单行：[`MoreFiles.deleteRecursively()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/io/MoreFiles.html#deleteRecursively-java.nio.file.Path-com.google.common.io.RecursiveDeleteOption...-).

与许多共享的示例不同，它考虑了符号链接，并且不会（默认情况下）删除提供的路径之外的文件。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2009-04-22T22:37:04.447

也许这个问题的解决方案可能是使用来自 erickson 的答案的代码重新实现 File 类的 delete 方法：

```
public class MyFile extends File {

  ... <- copy constructor

  public boolean delete() {
    if (f.isDirectory()) {
      for (File c : f.listFiles()) {
        return new MyFile(c).delete();
      }
    } else {
        return f.delete();
    }
  }
} 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2015-09-18T14:57:02.913

没有 Commons IO 和 < Java SE 7

```
public static void deleteRecursive(File path){
            path.listFiles(new FileFilter() {
                @Override
                public boolean accept(File pathname) {
                    if (pathname.isDirectory()) {
                        pathname.listFiles(this);
                        pathname.delete();
                    } else {
                        pathname.delete();
                    }
                    return false;
                }
            });
            path.delete();
        } 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2020-08-07T10:35:12.473

// 带有 lambda 和流的 Java 8，如果参数是目录

```
static boolean delRecursive(File dir) {
    return Arrays.stream(dir.listFiles()).allMatch((f) -> f.isDirectory() ? delRecursive(f) : f.delete()) && dir.delete();
} 
```

// 如果参数是文件或目录

```
static boolean delRecursive(File fileOrDir) {
    return fileOrDir.isDirectory() ? Arrays.stream(fileOrDir.listFiles()).allMatch((f) -> delRecursive(f)) && fileOrDir.delete() : fileOrDir.delete();
} 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2015-02-20T07:12:34.553

虽然可以使用 file.delete() 轻松删除文件，但目录必须为空才能删除。使用递归很容易做到这一点。例如：

```
public static void clearFolders(String[] args) {
        for(String st : args){
            File folder = new File(st);
            if (folder.isDirectory()) {
                File[] files = folder.listFiles();
                if(files!=null) { 
                    for(File f: files) {
                        if (f.isDirectory()){
                            clearFolders(new String[]{f.getAbsolutePath()});
                            f.delete();
                        } else {
                            f.delete();
                        }
                    }
                }
            }
        }
    } 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2019-10-16T20:05:50.763

### `rm -rf`比. *_* _`FileUtils.deleteDirectory`

经过广泛的基准测试，我们发现 using`rm -rf`比 using 快几倍`FileUtils.deleteDirectory`。

当然，如果您有一个小的或简单的目录，那没关系，但在我们的例子中，我们有多个千兆字节和深度嵌套的子目录，`FileUtils.deleteDirectory`使用`rm -rf`.

这是我们的粗略 Java 实现：

```
// Delete directory given and all subdirectories and files (i.e. recursively).
//
static public boolean deleteDirectory( File file ) throws IOException, InterruptedException {

    if ( file.exists() ) {

        String deleteCommand = "rm -rf " + file.getAbsolutePath();
        Runtime runtime = Runtime.getRuntime();

        Process process = runtime.exec( deleteCommand );
        process.waitFor();

        return true;
    }

    return false;

} 
```

如果您正在处理大型或复杂的目录，则值得尝试。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2017-12-20T13:20:09.007

好吧，让我们假设一个例子，

```
import java.io.File;
import java.io.IOException;

public class DeleteDirectory
{
   private static final String folder = "D:/project/java";

   public static void main(String[] args) throws IOException
   {
      File fl = new File(folder);
      if(!fl.exists()) // checking if directory exists
      {
         System.out.println("Sorry!! directory doesn't exist.");
      }
      else
      {
         DeleteDirectory dd = new DeleteDirectory();
         dd.deleteDirectory(fl);
      }
   }

   public void deleteDirectory(File file) throws IOException
   {
      if(file.isDirectory())
      {
         if(file.list().length == 0)
         { 
            deleteEmptyDirectory(file); // here if directory is empty delete we are deleting
         }
         else
         {
            File fe[] = file.listFiles();
            for(File deleteFile : fe)
            {
               deleteDirectory(deleteFile); // recursive call
            }
            if(file.list().length == 0)
            {
               deleteEmptyDirectory(file);
            }
         }
      }
      else
      {
         file.delete();
         System.out.println("File deleted : " + file.getAbsolutePath());
      }
   }

   private void deleteEmptyDirectory(File fi)
   {
      fi.delete();
      System.out.println("Directory deleted : " + fi.getAbsolutePath());
   }
} 
```

有关更多信息，请参阅以下资源

[删除目录](https://www.flowerbrackets.com/how-to-delete-a-directory-in-java/)

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2017-10-24T10:59:05.697

我编写了这个具有 3 个安全标准的例程，以便更安全地使用。

```
package ch.ethz.idsc.queuey.util;

import java.io.File;
import java.io.IOException;

/** recursive file/directory deletion
 * 
 * safety from erroneous use is enhanced by three criteria
 * 1) checking the depth of the directory tree T to be deleted
 * against a permitted upper bound "max_depth"
 * 2) checking the number of files to be deleted #F
 * against a permitted upper bound "max_count"
 * 3) if deletion of a file or directory fails, the process aborts */
public final class FileDelete {
    /** Example: The command
     * FileDelete.of(new File("/user/name/myapp/recordings/log20171024"), 2, 1000);
     * deletes given directory with sub directories of depth of at most 2,
     * and max number of total files less than 1000\. No files are deleted
     * if directory tree exceeds 2, or total of files exceed 1000.
     * 
     * abort criteria are described at top of class
     * 
     * @param file
     * @param max_depth
     * @param max_count
     * @return
     * @throws Exception if criteria are not met */
    public static FileDelete of(File file, int max_depth, int max_count) throws IOException {
        return new FileDelete(file, max_depth, max_count);
    }

    // ---
    private final File root;
    private final int max_depth;
    private int removed = 0;

    /** @param root file or a directory. If root is a file, the file will be deleted.
     *            If root is a directory, the directory tree will be deleted.
     * @param max_depth of directory visitor
     * @param max_count of files to delete
     * @throws IOException */
    private FileDelete(final File root, final int max_depth, final int max_count) throws IOException {
        this.root = root;
        this.max_depth = max_depth;
        // ---
        final int count = visitRecursively(root, 0, false);
        if (count <= max_count) // abort criteria 2)
            visitRecursively(root, 0, true);
        else
            throw new IOException("more files to be deleted than allowed (" + max_count + "<=" + count + ") in " + root);
    }

    private int visitRecursively(final File file, final int depth, final boolean delete) throws IOException {
        if (max_depth < depth) // enforce depth limit, abort criteria 1)
            throw new IOException("directory tree exceeds permitted depth");
        // ---
        int count = 0;
        if (file.isDirectory()) // if file is a directory, recur
            for (File entry : file.listFiles())
                count += visitRecursively(entry, depth + 1, delete);
        ++count; // count file as visited
        if (delete) {
            final boolean deleted = file.delete();
            if (!deleted) // abort criteria 3)
                throw new IOException("cannot delete " + file.getAbsolutePath());
            ++removed;
        }
        return count;
    }

    public int deletedCount() {
        return removed;
    }

    public void printNotification() {
        int count = deletedCount();
        if (0 < count)
            System.out.println("deleted " + count + " file(s) in " + root);
    }
} 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2021-08-07T18:46:35.227

# Guava 21.0 及更高版本

从 Guava 21.0 开始就有该类的`void deleteRecursively(Path path, RecursiveDeleteOption... options) throws IOException`静态方法可用。`MoreFiles`

请参阅[Javadoc 文档](https://guava.dev/releases/23.0/api/docs/com/google/common/io/MoreFiles.html#deleteRecursively-java.nio.file.Path-com.google.common.io.RecursiveDeleteOption...-)：

> public static void  [deleteRecursively](https://guava.dev/releases/23.0/api/docs/src-html/com/google/common/io/MoreFiles.html#line.506) ( [Path](http://docs.oracle.com/javase/8/docs/api/java/nio/file/Path.html?is-external=true "java.nio.file 中的类或接口")  path, [RecursiveDeleteOption](https://guava.dev/releases/23.0/api/docs/com/google/common/io/RecursiveDeleteOption.html "com.google.common.io 中的枚举") ... options) 抛出[IOException](http://docs.oracle.com/javase/8/docs/api/java/io/IOException.html?is-external=true "java.io 中的类或接口")
> 
> `path`递归删除给定的文件或目录。删除符号链接，而不是它们的目标（受以下警告的约束）。
> 
> 如果尝试读取、打开或删除给定目录下的任何文件时发生 I/O 异常，则此方法会跳过该文件并继续。收集所有此类异常，并在尝试删除所有文件后，`IOException`抛出一个包含这些异常作为[抑制异常的异常](http://docs.oracle.com/javase/8/docs/api/java/lang/Throwable.html?is-external=true#getSuppressed-- "java.lang 中的类或接口")。

# php - 从电子邮件中的单选按钮数组中获取内容

> ID：779525
> 
> 赞同：0
> 
> 时间：2009-04-22T22:26:40.697
> 
> 标签：php, html, forms

我有一个 sendemail.php 设置用于从表单向我发送信息。

我设置发送信息的方式是

```
$_POST['variable name'] 
```

我不知道如何在发送给我的电子邮件中显示单选按钮数组的选择。谢谢你的帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-22T22:34:40.100

好吧，一个组中的所有单选按钮都必须具有相同的名称，才能组合在一起。他们应该被赋予不同的价值。例如，您的 HTML 可能如下所示：

```
<input type="radio" name="gender" value="male" id="gender_male" />
    <label for="gender_male">Male</label>
<input type="radio" name="gender" value="female" id="gender_female" />
    <label for="gender_female">Female</label> 
```

然后在您的 sendemail.php 上，查看 的值`$_POST['gender']`，这将是“男性”或“女性”，这取决于他们选择了哪个单选按钮。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T22:34:53.797

每个单选按钮都必须设置一个值。您可以使用 获得所选按钮的值`$_POST['name of radio button']`。

# .net - 线程安全对象 - 静态与否？

> ID：779533
> 
> 赞同：11
> 
> 时间：2009-04-22T22:32:04.553
> 
> 标签：.net, multithreading, locking

我最近在接受采访，技术人员问我如何使应用程序线程安全。

好吧，在`lock()`正确解释之后，他说将对象设为静态并不是一个好主意。

```
private static readonly object _syncLock = new object(); 
```

他声称原因是静态对象使线程锁定的速度比非静态对象慢。这是真的？

编辑：尽管如此，我仍然不确定。这三种方法有什么区别？

```
private static readonly object _syncLock = new object();
public static readonly object _syncLock = new object();
private readonly object _syncLock = new object(); 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-22T22:38:20.623

锁定对象是否应该是静态的取决于您要锁定的对象。如果要锁定类的实例，则不能使用静态锁定对象。如果要锁定静态数据，则不能使用实例锁定对象。所以似乎没有任何选择。

您可以考虑使用静态或实例锁定对象来锁定对实例数据的访问，但这会导致不同的行为。使用实例锁定对象，您只锁定一个实例，而静态锁定对象将锁定所有实例。所以这里也没有性能调整的选择。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-22T22:34:45.840

> 他声称原因是静态在运行时而不是编译时运行，并且会使线程锁定的对象比非静态对象更慢。

这真的没有任何意义——我认为要么面试官不知道他在说什么，要么你误解了他的观点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T22:42:19.270

有时在求职面试中，我会说一些我知道是不正确的或者完全是胡说八道的话，看看候选人是否会有效地争论他的观点，或者只是放弃并同意。

哦，这是[Jeffrey Richter 写](http://msdn.microsoft.com/en-us/magazine/cc188793.aspx)的一篇关于正确使用锁的优秀文章。:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-23T09:22:37.080

每当您需要确保不同线程不会同时操作同一个实例时，请使用非静态对象进行锁定。

假设您有一些 List 类，它们有一个特殊的 Reorder 方法，它接受一些奇怪的参数。考虑在某些并行过程中是否需要重新排序 100 个不同的列表。您只关心不同的线程不会同时操作同一个列表，因为它可能会影响您的重新排序逻辑。您不需要静态锁，因为您不在乎何时同时操作不同的列表。

具有静态锁的场景的一个简单示例是一些静态数据的初始化，您希望确保加载逻辑只运行一次。像一些缓存或单例。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-06-15T06:09:49.523

如果您只有**一个**在多个线程之间共享的类的实例，则可以使用普通对象。但是如果您有多个线程之间共享的类的多个对象，则必须使用**静态**对象。

另一方面，使用普通对象可以管理类的**一个**实例的并发性，使用静态对象可以管理类的**所有**实例范围内的并发性。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-04-22T23:34:34.357

其他人是正确的，使用静态实例字段的选择取决于您需要锁定的状态（类级别或实例级别），并且锁定本身的速度没有相关差异。**但是**，如果您真的只需要使用实例数据，那么您的应用程序*可以*运行得更快，`lock(this)`而不是锁定所有线程访问任何实例的数据。这可能是面试官的意思——在一个多个线程只使用实例数据的应用程序中，如果你只锁定实例，它确实应该运行得更快，因为它不会阻止其他线程使用其他实例。

相反，如果线程正在访问类级别（静态）状态，那么您需要使用单个对象将它们全部锁定。当我需要这样做时，我使用的一种模式是像这样锁定类的类型：

*[编辑-毕竟不是一个好主意，请参阅下面的评论]*

```
lock(typeof(MyClass))
{
  // use class-level data
} 
```

这避免了创建静态对象字段的必要性。

# php - 抑制或 catch() 无效函数调用 - PHP

> ID：779534
> 
> 赞同：1
> 
> 时间：2009-04-22T22:32:13.633
> 
> 标签：php

有一系列我正在动态调用的函数，如下所示：

```
$function = 'someFunction';
$x = $function(); 
```

.. 但是，如果函数需要参数，并且我没有在调用中对其进行编码，我似乎会使页面崩溃。例如：

```
function someFunction( $in_param1 ) {
  return "SUCCESS";
}

$function = 'someFunction';
// this next line does not work
$x = $function() or die("error"); 
```

我该如何处理这种错误？

谢谢 -

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-22T22:33:38.090

[您可以使用set_error_handler](http://us.php.net/manual/en/function.set-error-handler.php)函数来捕获它：

```
function handle_errors( $errno, $errstr )
{
    die( "Your error will be caught here" );
}

set_error_handler( "handle_errors" );

$function = 'someFunction';
$x = $function(); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-22T22:41:09.913

压制？是的。抓住？[请参阅 don.neufeld 的回答](https://stackoverflow.com/questions/779534/suppress-or-catch-invalid-function-call-php/779539#779539)。

```
$x = @$function(); 
```

根据[此页面](http://us.php.net/operators.errorcontrol)，您可以启用特定的 INI 设置，以便您可以读取以这种方式抑制的错误。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-22T22:34:35.420

您可以使用所需参数的默认值重新定义您的函数，例如

```
function someFunction( $in_param1=null ) {
  return "SUCCESS";
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-22T22:42:45.493

我不知道抑制，但是您可以通过[`ReflectFunction`](http://php.net/manual/en/language.oop5.reflection.php#language.oop5.reflection.reflectionfunction)该类获得有关功能的更多信息。

```
<?php
function foo($a, $b, $c) {}

$func = new ReflectionFunction('foo');
echo $func->getNumberOfParameters(); 
```

这输出“3”。

# ruby - 遍历xml结构判断是否存在某个文本节点

> ID：779535
> 
> 赞同：2
> 
> 时间：2009-04-22T22:32:17.500
> 
> 标签：ruby, xml, enumeration

好吧，我有一个看起来像这样的 xml 文档：

```
 <xml>
     <list>
      <partner>
       <name>Some Name</name>
       <status>active</status>
       <id>0</id>
      </partner>
      <partner>
       <name>Another Name</name>
       <status>active</status>
       <id>1</id>
      </partner>
    </list>
   </xml> 
```

我正在使用 ruby​​ 的 lib-xml 来解析它。我想以一种快速而惯用的方式来查找是否有一个名为“Some Name”的合作伙伴。

假设我在一个名为 document.. 的变量中解析了一个文档，我该如何在一行或 ruby​​ 代码中做到这一点。这样我就可以调用 document.find(xpath) 来检索节点。我不得不在略有不同的情况下多次这样做，现在它开始困扰我。

我知道我可以做以下事情（但它很难看）

```
 found = false
 document.find('//partner/name').each do |name|
  if (name.content == 'Some Name')
   found = true
   break
  end
 end
 assert(found, "Some Name should have been found") 
```

但我觉得这真的很难看。我想过使用枚举包括？mixin 方法，但这仍然行不通，因为我需要获取每个节点的 .content 字段而不是实际节点......在写这个时，我想到了这个（但它似乎有点低效，尽管很优雅）

```
found = document.find('//partner/name').collect{|name| name.content}.member?("Some Name") 
```

有没有其他方法可以做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T22:40:54.000

那这个呢？

```
found = document.find("//partner[name='Some Name']").empty? 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T23:06:27.637

我试过这个解决方案：

```
 found = document.find("//partner[name='Some Name']") != nil 
```

但我收到一个错误，说 xpath 表达式无效。但是，我正在阅读一些 xpath 文档，看起来您可以在表达式中调用 text() 函数来获取文本节点。我尝试了以下，它似乎工作：

```
 found = document.find("//partner/name/text()='Some Name'") 
```

found 实际上不是一个 xml 节点，而是一个真/假对象，所以这是可行的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T22:40:23.817

我会使用一种在 XML 上运行的语言（例如 XQuery）。使用 XQuery，可以以简洁优雅的方式对 xml 数据进行此类查询。

# python - 使用 Gecko/Firefox 或 Webkit 在 python 中进行 HTML 解析

> ID：779538
> 
> 赞同：6
> 
> 时间：2009-04-22T22:33:15.533
> 
> 标签：python, html, parsing

我正在使用 BeautifulSoup 和 urllib2 下载 HTML 页面并对其进行解析。问题在于格式错误的 HTML 页面。虽然 BeautifulSoup 擅长处理格式错误的 HTML，但它仍然不如 Firefox。

考虑到 Firefox 或 Webkit 在处理 HTML 时更新和弹性更高，我认为使用它们来构建和规范化页面的 DOM 树，然后通过 Python 操作它是理想的。

但是我找不到任何相同的python绑定。任何人都可以提出一种方法吗？

我遇到了一些运行无头 Firefox 进程并通过 python 操作它的解决方案，但是否有更 Pythonic 的解决方案可用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-23T01:37:41.220

也许[pywebkitgtk](http://code.google.com/p/pywebkitgtk/)会做你需要的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-10-09T19:07:53.243

见[http://wiki.python.org/moin/WebBrowserProgramming](http://wiki.python.org/moin/WebBrowserProgramming)

有很多选择 - 我正在维护上面的页面，这样我就不会重复自己。

你应该看看 pyjamas-desktop: 查看示例/uitest 示例，因为我们正是使用这个技巧来获取 HTML 页面“输出”的副本，以便可以通过比较每个之后的页面结果来测试 python-to-javascript 编译器单元测试。

pyjamas-desktop 支持和使用的每个运行时都能够允许访问文档正文元素的“innerHTML”属性（还有更多）。

底线：做你想做的事是微不足道的，但你必须知道去哪里寻找如何去做。

l.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-07-06T12:09:29.727

[您可能喜欢来自http://www.gnu.org/software/pythonwebkit/](http://www.gnu.org/software/pythonwebkit/)的 PyWebkitDFB

# asp.net - 在保存时测试对象的状态

> ID：779540
> 
> 赞同：1
> 
> 时间：2009-04-22T22:33:44.813
> 
> 标签：asp.net, unit-testing, tdd, mocking, rhino-mocks

我正在寻找为这样的方法编写单元测试：

```
public override bool ChangePasswordQuestionAndAnswer(string username, string password, string newPasswordQuestion, string newPasswordAnswer)
{
    ISPMembershipUserDao userDao = GetISPMembershipUserDao();

    if (ValidateUser(username, password))
    {
        SPMembershipUser user = userDao.GetUserByUserName(username);

        user.PasswordQuestion = newPasswordQuestion;
        user.PasswordAnswer = newPasswordAnswer;

        userDao.Save(user);

        return true;
    }

    return false;
} 
```

这是一种相当直接的测试方法。我正在使用 Rhino Mocks 框架。但一方面让我质疑自己。我存根 DAO 对象及其保存方法，我想知道应该对传递给保存方法的用户对象进行多深的测试。我是否应该断言该对象的*每个*属性都符合我的预期？还是我应该只断言 PasswordQuestion 和 PasswordAnswer 属性具有正确的值？前者对我来说似乎是正确的，因为我应该确保*只*修改了这两个属性，而其他属性没有被触及。

我希望有些人可以就此发表意见。对于这些类型的情况，是否有要记住的经验法则或模式？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T22:58:16.953

**警告：前方个人意见**

好的，现在已经不碍事了....对我来说，归结为我需要做些什么来感觉我的代码正确地实现了所需的逻辑。在这种情况下？我有两个测试用例：

*   处理返回 false 的 ValidateUser
    *   应该返回 false
    *   不应该调用 Save
*   处理返回 true 的 ValidateUser
    *   应该返回真
    *   应该调用保存
        *   传递给保存的对象有修改后的问题和答案
        *   不检查用户对象的其他属性

但是，如果/当我提交了一个影响这部分代码的错误时，我会添加任何（最初失败的）测试来覆盖错误、修复错误并离开测试。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-22T11:23:01.140

既然在这里设置约束非常容易，为什么不对其进行测试以确保您的方法没有副作用？

```
stubbedUserDao.AssertWasCalled(x => x.Save(null), o => {
        o.IgnoreArguments();
        o.Constraints(Property.AllPropertiesMatch(expectedMatchingUser));
    }); 
```

# graphics - 光栅化或光线追踪是否有任何渲染替代方案？

> ID：779550
> 
> 赞同：16
> 
> 时间：2009-04-22T22:36:47.957
> 
> 标签：graphics, 3d, raytracing, rasterizing

光栅化（三角形）和光线追踪是我遇到的唯一渲染 3D 场景的方法。还有其他人吗？另外，我很想知道任何其他真正“外面”的 3D 方法，例如不使用多边形。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-04-24T18:04:47.863

啊！这些答案非常无知！

当然，问题不精确也无济于事。

好的，“渲染”是一个非常广泛的话题。渲染中的一个问题是相机可见性或“隐藏表面算法”——找出在每个像素中看到的对象。可见性算法有多种分类。这**可能**就是发帖人要问的（考虑到他们认为这是“光栅化”和“光线追踪”之间的二分法）。

一个经典的（虽然现在有些过时了）分类参考是 Sutherland 等人的“A Characterization of Ten Hidden-Surface Algorithms”，ACM Computer Surveys 1974。它已经非常过时了，但它仍然非常适合提供一个框架来思考如何对这些算法进行分类.

一类隐藏表面算法涉及“光线投射”，它计算从相机穿过每个像素的线与对象的交点（可以有各种表示，包括三角形、代数表面、NURBS 等）。

其他类别的隐藏表面算法包括“z-buffer”、“扫描线技术”、“列表优先算法”等。在没有太多计算周期和没有足够内存来存储 z 缓冲区的日子里，他们的算法非常有创意。

如今，计算和内存都很便宜，因此三种技术几乎胜出：（1）将所有内容切成三角形并使用 z 缓冲区；(2) 射线投射；(3) 类雷耶斯算法，使用扩展的 z 缓冲区来处理透明度等。现代显卡做#1；高端软件渲染通常会做 #2 或 #3 或组合。尽管已经提出了各种光线追踪硬件，有时还构建了这些硬件，但从未流行起来，而且现代 GPU 现在已经足够可编程以实际进行光线追踪，尽管其硬编码光栅化技术在速度上存在严重劣势。多年来，其他更奇特的算法大多被搁置了。（虽然各种排序/喷溅算法可用于体绘制或其他特殊目的。）

“光栅化”实际上只是意味着“找出对象位于哪些像素上”。惯例规定它不包括光线追踪，但这是不稳定的。我想你可以证明光栅化回答“这个形状重叠了哪些像素”，而光线追踪回答“这个像素后面是哪个对象”，如果你看到区别的话。

那么，隐藏表面的去除并不是“渲染”领域唯一需要解决的问题。了解每个像素中可见的对象只是一个开始；您还需要知道它是什么颜色，这意味着有一些方法可以计算光如何在场景中传播。有一大堆技术，通常分解为处理阴影、反射和“全局照明”（在对象之间反弹，而不是直接来自灯光）。

“光线追踪”意味着应用光线投射技术来确定阴影、反射、全局照明等的可见性。可以对所有事物使用光线追踪，或者使用各种光栅化方法来获得相机可见性，并使用光线追踪来获得阴影、反射、和胃肠道。“光子映射”和“路径追踪”是计算某些类型的光传播的技术（使用光线追踪，所以说它们从根本上是一种不同的渲染技术是错误的）。还有一些不使用光线追踪的全局照明技术，例如“辐射”方法（这是一种解决全局光传播的有限元方法，但在该领域的大部分地区最近已经失宠）。

提到特定形状表示（NURBS、体积、三角形）的人也有点困惑。这是光线追踪与光栅化的正交问题。例如，您可以直接对 nurb 进行光线追踪，也可以将 nurb 切成三角形并对其进行追踪。您可以直接将三角形栅格化到 z 缓冲区中，但您也可以按扫描线顺序直接栅格化高阶参数曲面（参见 Lane/Carpenter/etc CACM 1980）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-22T22:56:52.760

有一种称为[光子映射](http://en.wikipedia.org/wiki/Photon_mapping)的技术实际上与光线追踪非常相似，但在复杂场景中提供了各种优势。事实上，如果操作得当，它是唯一能够提供真正逼真（即遵守所有光学定律）渲染的方法（至少我知道其中一种方法）。据我所知，这是一种很少使用的技术，因为它的性能甚至比光线追踪还要差（鉴于它有效地做相反的事情并模拟光子从光源到相机的路径）——但这就是它唯一的缺点。这当然是一个有趣的算法，尽管在光线追踪之后（如果有的话）你不会看到它被广泛使用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-22T22:42:47.303

Wikipedia 上的渲染文章涵盖了各种[技术](http://en.wikipedia.org/wiki/Rendering_%28computer_graphics%29#Techniques)。

介绍段落：

> 已经研究了许多渲染算法，并且用于渲染的软件可以采用多种不同的技术来获得最终图像。
> 
> 追踪场景中的每一束光线是不切实际的，而且会花费大量时间。如果采样没有受到智能限制，即使跟踪足够大的部分以生成图像也会花费过多的时间。
> 
> 因此，出现了四种更有效的光传输建模技术： **光栅化**，包括扫描线渲染，将场景中的对象几何投影到图像平面，没有高级光学效果；**光线投射**将场景视为从特定角度观察到的场景，仅根据几何和反射强度的非常基本的光学定律计算观察到的图像，并且可能使用蒙特卡罗技术来减少伪影；**光能传递**性使用有限元数学来模拟光从表面的漫射；和**光线追踪**类似于光线投射，但采用了更高级的光学模拟，并且通常使用蒙特卡罗技术以通常慢几个数量级的速度获得更真实的结果。
> 
> 大多数先进的软件结合了两种或多种技术，以合理的成本获得足够好的结果。
> 
> 另一个区别是迭代图像平面的像素的图像顺序算法和迭代场景中的对象的对象顺序算法之间的区别。通常对象顺序更有效，因为场景中的对象通常比像素少。

从这些描述中，我觉得只有[光能传递](http://en.wikipedia.org/wiki/Radiosity)在概念上有所不同。

# java - Resin 服务器异常

> ID：779562
> 
> 赞同：0
> 
> 时间：2009-04-22T22:39:46.343
> 
> 标签：java, resin

树脂服务器重启时出现以下异常的可能原因是什么？

500 Servlet 异常 conf/resin.conf:168: java.lang.StackOverflowError

* * *

Resin Professional 3.0.21（建于 2006 年 8 月 10 日星期四 12:17:46 PDT）

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-24T18:18:47.533

您的conf中的圆形元素参考？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-09-09T21:28:59.557

发生这种情况是因为服务器中没有足够的磁盘空间来启动应用程序服务器。当我释放日志时，服务器就起来了。

# c++ - 什么适用于 C++ 中的 Web 开发

> ID：779573
> 
> 赞同：9
> 
> 时间：2009-04-22T22:42:23.297
> 
> 标签：c++

我想创建一个使用很少 RAM 运行的 Web 应用程序，我认为 C++ 可以帮助我实现这一目标。

现在，很多人说 C++ 不适合 Web 开发，因为：

*   没有简单的字符串操作
*   是一种不安全的语言（溢出等）
*   长的更改/构建/测试周期
*   等等

但我确信 C++ 社区已经找到了缓解所有这些问题的方法（可能不是编译时间），但是由于我不是常客，所以我很难对我在 Google 中找到的内容进行评价。

所以我请求一些指导。如果您分享什么有效，什么工具/库是最新的和活着的，我将不胜感激。哪些策略可以帮助 C++ 中的 Web 开发？FastCGI 还是嵌入式服务器（Asio / POCO / Pion / 等）？您如何解决安全问题？

非常感谢您的帮助

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-22T22:53:46.653

你看过[http://www.tntnet.org/](http://www.tntnet.org/)吗？他们创建了一个......好吧，让我从他们的网站上剪切和粘贴：

> Tntnet 是用于 C++ 的模块化、多线程、高性能 Web 应用程序服务器。要创建 web 应用程序，Tntnet 有一种称为 ecpp 的模板语言，类似于 php、jsp 或 mason，您可以在其中将 c++ 代码嵌入到 html 页面中以生成活动内容。ecpp 文件被预编译为称为组件的 c++ 类，并编译并链接到共享库中。这个过程在编译时完成。

我已经使用过它，它的开销很小，而且它的动态页面生成速度非常快。相比之下，PHP、Ruby 等蜗牛是因为使用 tntnet 您正在运行已编译的 C/C++ 代码。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-22T22:55:46.070

有[Wt 项目](http://www.webtoolkit.eu/wt)。它使用类似于 Qt 的信号/槽的范例。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-22T22:59:29.213

尝试用 C++ 构建 Web 应用程序没有**任何问题。**这实际上很有趣。你需要的是一个：

*   模板系统
*   一个[CGI 库](http://www.gnu.org/software/cgicc/)
*   一个数据库 API 包装器，很可能避免处理低级 MySQL API 之类的东西
*   记录器

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-22T23:48:11.670

我们的 Web 应用后端是通过 CGI 使用 C++ 编写的，我们使用 Clearsilver 模板以及随附的 HDF。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-22T22:48:46.527

给我们一些关于你想要做什么的更多提示。

你可以很容易地用 C++ 编写一个好的老式 cgi 程序，并用 FastCGI 运行它。我们过去一直这样做。

您也可以编写一个嵌入轻量级 HTTP 服务器的 C++ 程序。

与使用 perl 或 ruby​​ 之类的东西相比，它们都是更大的 PITA。

那么为什么是 C++ 呢？

### 更新

好，知道了。FastCGI 的主要特点是它避免了 fork-exec 来运行你的 CGI 程序，但它的 API 有点不同。这很好，但您仍然有处理 HTTP 内容的问题。

然而，有几个非常轻量级的 HTTP 服务器，比如[Cherokee](http://www.cherokee-project.com/)和[Lighttpd](http://www.lighttpd.net/)。在类似的情况下（为设备构建 Web 界面），我看到人们使用其中的一种，并在其下将 C/C++ 程序作为 CGI 运行。尤其是 Lighttpd 似乎专注于快速高效地制作类似 CGI 的东西。

另一个更新。我刚刚让[cgicc](http://www.gnu.org/software/cgicc/)向我指出：[http ://www.gnu.org/software/cgicc/](http://www.gnu.org/software/cgicc/)

这可能会解决一些问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-22T22:56:53.137

[ATL Server](http://msdn.microsoft.com/en-us/library/exb5b09w.aspx)是一个 C++ 类库，允许开发人员构建基于 Internet 的应用程序。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-22T23:01:16.400

[ATL 服务器](http://msdn.microsoft.com/en-us/library/hs71b4xz(VS.80).aspx)。 [它也是开源的！](http://www.codeplex.com/AtlServer/) 当然，总是有[ISAPI](http://msdn.microsoft.com/en-us/library/at50e70y(VS.80).aspx)。啊，糟糕的过去。:)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-22T23:13:22.223

在您的[另一个问题](https://stackoverflow.com/questions/645476/what-server-side-web-technology-should-i-use-in-an-embedded-system)中，您提到您的嵌入式系统是[openwrt](http://openwrt.org/)。由于这个路由器固件已经带有一个嵌入式 Web 服务器（用于它的管理 UI），你为什么不将它也用于你的应用程序呢？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-01-28T00:01:07.420

您可以尝试使用 Qt 构建的**[Cutelyst](https://cutelyst.org)**一个 C++11，它是[TechEmpower Benchmarks](https://www.techempower.com/benchmarks/)上最好的位置之一。

尽管它需要 Qt 5.6+，但完整的 CMS ( [CMlyst](https://github.com/cutelyst/CMlyst) ) 使用大约 6MB 的 RAM，同时在单核上每秒处理大约 3000 个请求。

对于您的字符串操作问题，QString 只是一个了不起的类。

# c - 如何在 GEdit 中获得 GTK 语法高亮显示？

> ID：779578
> 
> 赞同：0
> 
> 时间：2009-04-22T22:44:02.870
> 
> 标签：c, gtk, gedit

我刚开始使用 GTK 开发我的 GUI 应用程序。我使用 GEdit 作为我的文本编辑器，所以我怎样才能将以下内容包含在语法突出显示中：

```
GtkWidget *window;
GtkWidget *button
GtkWidget *box1;

gtk_init(&argc, &argv); 
```

好像是这样的：

```
int x = 3; 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T23:04:11.403

您可以使用包含 XML 的 .lang 文件扩展 Gedit 的语法：http: [//library.gnome.org/devel/gtksourceview-2.0/stable/lang-tutorial.html](http://library.gnome.org/devel/gtksourceview-2.0/stable/lang-reference.html)
[http://library.gnome.org/devel/gtksourceview](http://library.gnome.org/devel/gtksourceview-2.0/stable/lang-tutorial.html)
[-2.0/stable/lang-reference.html](http://library.gnome.org/devel/gtksourceview-2.0/stable/lang-reference.html)

因此，您可以更改您的 C 语言文件以添加 GTK+ 数据类型。不过，有人已经写过它，我不会感到惊讶。

# c++ - 等效于 boost::test 的 CppUnit 保护器？

> ID：779580
> 
> 赞同：2
> 
> 时间：2009-04-22T22:44:58.563
> 
> 标签：c++, unit-testing, boost, cppunit, boost-test

我已经将`CppUnit`和`boost::test`用于 C++ 单元测试。通常我更喜欢`boost::test`，主要是因为自动测试宏最大限度地减少了设置测试的工作量。但是我真的很怀念一件事`CppUnit`：注册自己的“保护器”的能力，其实例会自动包装所有运行测试。（从技术上讲，您安装了一个测试“侦听器”，它可以将每个测试包装在一个保护器范围内）。

在过去，我发现这些对于监控单元测试的意外副作用非常宝贵（例如，检查代码没有更改浮点单元状态标志）。`boost::test` [我在文档](http://www.boost.org/doc/libs/1_38_0/libs/test/doc/html/index.htm)中看不到任何等效项，尽管[`BOOST_FIXTURE_TEST_CASE`](http://www.boost.org/doc/libs/1_38_0/libs/test/doc/html/utf/user-guide/fixture/per-test-case.html)可能最接近。

关于如何最好地实现与 CppUnit 的保护器相同的事情的任何建议`boost::test`？

（我还没有真正研究过`boost::test`' 的实现，但如果它像`CppUnit`它必须使用非常像保护器本身的东西）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T23:00:45.013

我从未使用过 CppUnit，所以不确定保护器是如何工作的。您是在寻找包含单个测试或整个测试套件的东西吗？

对于前者，您可以使用您提到的固定装置，但据我了解，固定装置应被视为“测试之外”。他们设置了测试需要的任何内容，然后进行清理。任何实际的错误测试都应该在测试本身中，但可以使用 RAII 轻松实现。只需在其析构函数中定义一个检查您需要的任何内容的类，然后在测试开始时创建它的本地实例。由于它首先被构造，最后被破坏，所以它可以很容易地检查测试没有修改任何意外状态。

如果您希望它在*所有*测试执行后检查这一点，您可能需要[全局固定装置](http://www.boost.org/doc/libs/1_38_0/libs/test/doc/html/utf/user-guide/fixture/global.html)

# .net - 如何在 asp.net 网站中使用 imagemagick？

> ID：779582
> 
> 赞同：0
> 
> 时间：2009-04-22T22:45:59.370
> 
> 标签：.net, asp.net, imagemagick

我正在建立一个新网站，它将包含很多图像处理，我发现 imagemagick 的接缝非常好，但作为 .Net 开发人员的问题，我无法将它集成到我的网站中。

是否可以在 .Net 应用程序/网站中使用？
如何添加到参考以及添加哪个文件？
有什么好的例子吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T23:03:57.377

Code Project 有一篇关于此主题的文章：[VB.NET 中的 ImageMagick](http://www.codeproject.com/KB/dotnet/ImageMagick_in_VBNET.aspx)。它包括一个 C++/CLI 库，该库包装了 ImageMagick C++ 库，使 .NET 应用程序可以访问它们。

# apache-flex - 如何使用 actionscript (flex) 一个块文件？

> ID：779584
> 
> 赞同：3
> 
> 时间：2009-04-22T22:48:29.647
> 
> 标签：apache-flex, file, upload

我正在进行文件传输，但文件引用 API 不支持文件分块。有没有人这样做过？例如，我希望能够将 1 gig 文件从 AIR 客户端上传到自定义 PHP/Java/等。服务。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T03:06:32.577

看来您所要做的就是使用 upload() 例程。php 或 java 服务应该进行分块。

```
var myHugeFile = new air.File('myHugeLocal.file');
myHugeFile.upload(new URLRequest("http://your.website.com/uploadchunker.php")); 
```

在 adobe 学习领域有一个更详细的使用文件引用的示例：http: [//www.adobe.com/devnet/air/flex/articles/uploading_air_app_to_server.html](http://www.adobe.com/devnet/air/flex/articles/uploading_air_app_to_server.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-04-28T21:52:46.517

我认为 FileReference 确实是块，至少这是我观察到的。使用像 Fiddler 这样的工具，您可以观看它的运行情况。如果您分析 FileReference 上传的传出标头，它们会被分块。

如果简历是您所追求的，我不能说您将如何使用 FileReference。我已经在通用帖子中上传了小文件，但这需要 flash/air 客户端将所有字节加载到应用程序中。在 Air 中，使用 1GB 文件可能会或可能不会使闪存崩溃（我猜这取决于您的系统）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-22T04:54:11.890

三个选项跳出来：

1.  使用支持可恢复传输的 FTP 服务，假设 flash 也支持这一点。如果您想与自己的自定义服务进行通信，可能不是一个选择。
2.  利用 http 文件部分标头支持。仅当 AIR 允许访问适当的 http 标头（内容范围和内容长度）时才适用。这就是 BITS 所做的。实施起来可能有点困难。
3.  手滚您自己的 TCP 或 UDP 协议交换。不适合胆小的人。在走这条路之前，我会先查看 OSS 空间。

# installation - WAMP 简易安装程序？

> ID：779591
> 
> 赞同：2
> 
> 时间：2009-04-22T22:52:17.953
> 
> 标签：installation, lamp

有什么方法可以制作一个非常用户友好的安装程序吗？

我知道 Next Next Finished 安装程序是不可能的，但我能做些什么来简化这个过程？

视窗平台。

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-23T03:13:20.553

如果您有一个非常简单的应用程序并且基本上只需要复制一些文件，我建议您查看[NSIS](http://nsis.sf.net/)。这非常简单，您可能会在几天内完成安装程序。

如果您正在为优先考虑网络部署的企业环境开发软件，那么您可能需要仔细研究[Windows Installer](http://www.microsoft.com/downloads/details.aspx?FamilyId=6A35AC14-2626-4846-BB51-DDCE49D6FFB6)和[Windows Installer XML (WiX)](http://wix.sf.net/)。（警告：一个非常*陡峭*的学习曲线——你需要留出几个星期的时间，并可能阅读[这本书](https://rads.stackoverflow.com/amzn/click/com/1590592972)来帮助入门）

如果您想要 MSI 的好处，又不想学习底层技术的麻烦，那么像[Installshield](http://www.installshield.com/)这样的商业工具是您的最佳选择。它并不便宜，但你很快就会得到一些东西。

从长远来看，我建议学习 Windows Installer 技术。大多数开发人员都忽略了这一点，它通常被视为过于复杂和不必要的疯狂巫术，实际上它相当简单，只是一个包含大量规则、条件和怪癖的数据库，需要一些时间来适应： )

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-26T12:24:41.440

试试[BitNami WAMPStack](http://bitnami.org/stack/wampstack)，它是开源免费的（你也有 Linux 和 OS X 版本）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-23T03:15:21.843

如果我正确理解你的问题，我不确定你是怎么没有找到这个的......

[http://www.wampserver.com/en/](http://www.wampserver.com/en/)

# data-binding - 如何在 .NET Compact Framework 中模拟 ErrorProvider？

> ID：779595
> 
> 赞同：2
> 
> 时间：2009-04-22T22:54:21.690
> 
> 标签：data-binding, compact-framework, errorprovider

由于 .NETCF 中没有 ErrorProvider 类，我如何实现类似的功能（不一定*完全*像 ErrorProvider）？

我正在使用所有常规数据绑定构造将控件绑定到数据表，使用 DataRow.RowError 属性和 DataRow.SetColumnError 方法，但我无法在任何 DataTable、BindingManagerBase 等上找到可以挂钩以接收的事件任何形式的通知。

我是否坚持调用一种方法来手动遍历表单上的所有控件并更改绑定控件的某些外观/感觉？

谢谢，B先生

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-11-15T17:36:08.477

这`ErrorProvider`门课看起来很基础——实际上，有点太基础了。如果您有[Red Gate Reflector](http://www.red-gate.com/products/reflector/)，我建议您拆开该类并查看它。否则，创建一个`Dictionary<Control, String>`.

这是创建自己的提供程序的快速想法：

```
Dictionary<Control, String> ErrorSet = new Dictionary<Control, String>();

public void SetError(Control control, String message)
{
    // code for adding error information
    ErrorSet.Add(control, message);
}

public String GetError(Control control)
{
    // code for retrieving error information
    return ErrorSet[control];
}

public String Clear()
{
    // code for clearing all errors
} 
```

我这里没有 RG 反射器，否则我会提供更多示例方法。但这应该提供某种样本来工作。

# visual-studio - 构建机器是否需要单独的 Visual Studio 许可证？

> ID：779604
> 
> 赞同：28
> 
> 时间：2009-04-22T22:57:23.633
> 
> 标签：visual-studio, msbuild, msbuild-task, vdproj

我知道有些公司允许您根据需要在构建机器上安装他们的产品，而无需单独的许可证（我想到的是 DevExpress）。但是我想知道微软是否对许可证有同样的限制。

MSBuild 不直接支持 vdproj，需要您从命令行运行 Visual Studio 来构建安装项目。看[这里](http://blogs.msdn.com/nikhilsi/archive/2008/06/11/visual-studio-setup-and-deployment-projects-and-msbuild.aspx)

我需要通过自动构建生成一个设置文件；我需要为构建机器购买额外的许可证吗？

**编辑**：我已经和我们负责许可的管理员谈过了，他很高兴我在构建机器上安装 VS2008 而无需购买额外的许可证，认为不需要许可证。如果我在这里获得更多官方信息，我将再次更新。

**编辑 2**：我听说微软将允许在构建机器上安装 VS2008，只要开发人员不使用该实例进行主动开发。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-04-22T23:10:05.397

[这是协议（PDF 链接！）](http://download.microsoft.com/documents/useterms/Visual%20Studio_2008%20Professional%20Edition_English_473a7e16-65dc-4cfb-8f44-ebdd93cb1d3d.pdf)。（不同版本的VS有不同的）。所以这取决于你如何阅读......

*一般的。一位用户可以安装和使用该软件的副本来设计、开发、测试和演示您的程序。测试不包括在生产环境中的服务器上登台，例如在生产使用之前加载内容。*

对我来说，这意味着您不需要额外的许可证，因为一个用户可以安装和使用副本。但是，我不是律师。:)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2017-01-13T16:28:39.823

根据[VS 2015 Licensing White Paper](https://www.microsoft.com/en-us/download/details.aspx?id=13350)，您的构建服务器不需要单独的 VS 许可证：

> 在 Build Server 上使用 Visual Studio：如果您有一个或多个 Visual Studio Enterprise with MSDN、Visual Studio Professional with MSDN 或任何 Visual Studio 云订阅的许可用户，那么您也可以将 Visual Studio 软件作为 Team Foundation Server 的一部分安装2017 年构建服务。这样，您无需购买 Visual Studio 许可证来为每个操作启动构建的人在构建服务器上运行 Visual Studio。

## 更新（2017 年 5 月 26 日）

微软现在还发布了[Visual Studio 2017 许可白皮书](https://www.visualstudio.com/wp-content/uploads/2017/05/Visual-Studio-2017-Licensing-Whitepaper-March-2017.pdf)，其要求与上述完全相同。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T23:03:39.423

`msbuild.exe`附带 .NET **SDK**，但仅附带框架。您可以在[此处免费获取 2.0 SDK](http://www.microsoft.com/downloads/details.aspx?FamilyID=fe6f2099-b7b4-4f47-a244-c96d69c35dec&displaylang=en)，但下载量很大。[3.5 也可用](http://www.microsoft.com/downloads/details.aspx?FamilyID=e6e1c3df-a74f-4207-8586-711ebe331cdc&displaylang=en)，但更大。

# asp.net - 如何在 asp.net 中提供自定义会话 ID getter/setter

> ID：779609
> 
> 赞同：2
> 
> 时间：2009-04-22T22:59:30.540
> 
> 标签：asp.net, session

我想将 sessionID 作为 json 参数传递，我可以看到如何覆盖 SessionIDManager 等，但这仅涵盖 sessionID 的自定义创建/验证，而不是它实际获取 sessionID 的位置。

当然有'cookieless'将它放在url中，但这对我也不起作用。

所以我想覆盖会话处理，以便我可以指定它应该在哪里查找 sessionID。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-05-24T11:34:48.717

[http://msdn.microsoft.com/en-us/library/system.web.sessionstate.sessionidmanager.aspx](http://msdn.microsoft.com/en-us/library/system.web.sessionstate.sessionidmanager.aspx)

# javascript - 如何提高智能手机上表格过滤 JavaScript 的速度？

> ID：779612
> 
> 赞同：2
> 
> 时间：2009-04-22T23:00:50.210
> 
> 标签：javascript, performance, search

我想过滤带有输入框的表格。它可以工作，但在我的目标平台智能手机上运行缓慢 - Iphone、Htc Touch HD（过滤 800 行大约需要 4 秒）。

请让我知道您是否可以帮助加快速度。

```
function time(){
    var now = new Date();
    var time = now.getTime();

    return time
}

function filter (phrase, _id){
    var starttime = time();
    var words = phrase.value.toLowerCase().split(" ");
    var table = document.getElementById(_id);
    var ele = null;
    var rows = new Array();
    for (var r=0 ; r < table.rows.length; r++){
        ele = table.rows[r].innerHTML.replace(/<[^>]+>/g,"");
        var displayStyle = 'none';
        for (var i=0 ; i < words.length; i++) {
            if (ele.toLowerCase().indexOf(words[i])!=-1){
                displayStyle = '';
            }else {
                displayStyle = 'none';
                break;
            }
        }
        rows[r] = displayStyle;
    }
    alert((time() - starttime)/1000 +" Sec");
    for(var k=0; k < rows.length; k++){
        table.rows[k].style.display = rows[k];
    }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T23:40:29.443

考虑到平台，听起来性能有些合理，但这里有一些想法：

1.）不要在每次迭代期间计算数组的长度（参见[https://developer.mozilla.org/en/A_re-introduction_to_JavaScript#Arrays](https://developer.mozilla.org/en/A_re-introduction_to_JavaScript#Arrays)）

2.) 在开始时对搜索字符串执行一次 toLowerCase()，而不是在检查的每一行期间

3.) 最大的麻烦*可能是*您对 innerHTML 和 replace() 的使用，但这将取决于浏览器的实现，看看您是否可以用更有效的方法从需要比较的单元格中获取文本来替换它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-12-09T10:21:29.220

分析您的 JavaScript，例如使用[Firebug 分析器](http://getfirebug.com/javascript)。然后你可以看到哪些操作花费的时间最长。测量就是知道。

# svn - 你可以在提交后的 svn 钩子中强制重启 apache 吗？

> ID：779619
> 
> 赞同：0
> 
> 时间：2009-04-22T23:04:26.207
> 
> 标签：svn, apache, post-commit

我有以下提交后挂钩设置和运行：

```
#!/bin/bash
/usr/bin/svn update /var/www/html/dev > /var/www/svnrepo/hooks/post-commit-log 
```

我正在使用 Python/Django 进行开发，每当我对任何“.py”文件进行任何更改时，我都必须通过 SSH 和“sudo /sbin/service httpd restart”...**有没有办法将它添加到底部提交后的文件？**

我预见和/或认为的一些障碍：

*   我正在从 apache 提供我的 SVN 存储库（例如， [http://www.iq-development.com/blog/creating_a_subversion_development_environment](http://www.iq-development.com/blog/creating_a_subversion_development_environment)），因此在提交后发回“确认”之前重新启动它可能会导致一些问题......
*   我认为 post-commit 钩子在用户的“apache”下运行......这个用户是否有权 /sbin/service httpd 重新启动？

-Fedora 核心 8

谢谢！-汤姆

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-23T00:32:57.243

如果 Apache 进程正在侦听小于 1024 的端口，那么它需要是 root 才能自行停止和启动。如果您正在侦听 1024 以上的端口，那么您可以以非 root 用户身份启动它，然后使用 post-commit 挂钩重新启动它。

如果优雅的 Apache 版本可用，您还希望使用 /etc/init.d/httpd graceful 而不是重新启动来不终止正在工作的连接。

最后，提交后挂钩可以在后台启动另一个子进程，该子进程会在重新启动之前休眠几秒钟以让客户端完全完成。您必须确保钩子脚本完全脱离标准错误。例如，这作为 Subversion 1.6.1 的提交后挂钩，客户端将与服务器分离，并且睡眠仍将运行。

```
#!/bin/sh
/bin/sleep 60 2>/dev/null & 
```

如果您可以等待一分钟让站点更新，您可以放入一个由 root 运行的 cron 一个运行“svn update”的脚本，如果有更新，则退回服务器。

# asp.net-mvc - 像 Stack Overflow 这样的网站如何在 ASP.NET MVC 中传递用户信息？

> ID：779621
> 
> 赞同：4
> 
> 时间：2009-04-22T23:06:08.293
> 
> 标签：asp.net-mvc, user-controls, openid

基本上，我使用 OpenId 登录我的网站，这与我假设的非常相似。当我取回信息时，我将其放入数据库并创建我的“注册用户”。我设置了我的 AuthCookie：

```
FormsAuthentication.SetAuthCookie(user.Profile.MyProfile.DisplayName, false); 
```

然后我可以使用它作为用户名。但是，我想传入整个对象，而不仅仅是显示名称的字符串。所以我的问题是：

SO是如何做到的？

他们是否扩展/覆盖了`SetAuthCookie(string, bool)`接受 User 对象的方法，即`SetAuthCookie(User(object), bool)`.

什么是持久化 User 对象的最佳方法，以便在我的 Web 应用程序的每个页面上我的 UserControl 都可以使用它？

提前致谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-23T00:00:58.660

[您可以通过实现](http://msdn.microsoft.com/en-us/library/f1kyba5e.aspx)自定义[Membership Provider](http://msdn.microsoft.com/en-us/library/system.web.security.membershipprovider.aspx)或扩展现有的来实现此行为。提供者基于密钥（或仅按用户名）存储用户信息，并提供对[MembershipUser](http://msdn.microsoft.com/en-us/library/system.web.security.membershipuser.aspx)类的访问，您可以根据需要对其进行扩展。因此，当您调用时`FormsAuthentication.SetAuthCookie(...)`，您基本上设置了用户密钥，可以通过提供者访问。

当您调用`Membership.GetUser()`时，成员基础结构将调用底层提供者并调用其`GetUser(...)`方法，为它提供当前用户的密钥。因此，您将收到当前的用户对象。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-24T15:15:38.927

杰夫，

正如我在上面对您的问题的评论中所说，您*必须*使用 ClaimedIdentifier 作为用户名——即 SetAuthCookie 的第一个参数。这有一个巨大的安全原因。如果您想了解更多有关原因的信息，请随时在 dotnetopenid@googlegroups.com 上发起一个话题。

现在关于您关于整个用户对象的问题......如果您想将其作为 cookie 发送，您必须将您的用户对象序列化为字符串，然后您必须以某种方式对其进行签名以防止用户篡改。您可能还想加密它。Blah blah，工作量很大，你最终会得到一个大的 cookie 来回处理你不想要的每个 Web 请求。

我在我的应用程序上为解决您所说的问题所做的是将静态属性添加到名为 CurrentUser 的 Global.asax.cs 文件中。像这样：

```
public static User CurrentUser {
    get {
        User user = HttpContext.Current.Items["CurrentUser"] as User;
        if (user == null && HttpContext.Current.User.Identity.IsAuthenticated) {
            user = Database.LookupUserByClaimedIdentifier(HttpContext.Current.User.Identity.Name);
            HttpContext.Current.Items["CurrentUser"] = user;
        }
        return user;
    }
} 
```

请注意，我将结果缓存在 HttpContext.Current.Items 字典中，该字典特定于单个 HTTP 请求，并使用户只获取一次点击——并且只有在页面确实需要 CurrentUser 信息时才第一次获取它.

所以一个页面可以很容易地获取当前登录的用户信息，如下所示：

```
User user = Global.CurrentUser;
if (user != null) { // unnecessary check if this is a page that users must be authenticated to access
    int age = user.Age; // whatever you need here
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-23T00:32:17.057

一种方法是向控制器注入一个类，该类负责检索当前登录用户的信息。这是我的做法。我创建了一个名为 WebUserSession 的类，它实现了一个名为 IUserSession 的接口。然后我只是在创建控制器实例时使用依赖注入将其注入控制器。我在我的接口上实现了一个名为 GetCurrentUser 的方法，它将返回一个 User 对象，如果需要，我可以在我的操作中使用它，方法是将它传递给视图。

```
using System.Security.Principal;
using System.Web;

public interface IUserSession
{
    User GetCurrentUser();
}

public class WebUserSession : IUserSession
{
    public User GetCurrentUser()
    {
        IIdentity identity = HttpContext.Current.User.Identity;
        if (!identity.IsAuthenticated)
        {
            return null;
        }

        User currentUser = // logic to grab user by identity.Name;
        return currentUser;
    }
}

public class SomeController : Controller
{
    private readonly IUserSession _userSession;

    public SomeController(IUserSession userSession)
    {
        _userSession = userSession;
    }

    public ActionResult Index()
    {
        User user = _userSession.GetCurrentUser();
        return View(user);
    }
} 
```

如您所见，您现在可以在需要时检索用户。当然，如果您愿意，您可以更改 GetCurrentUser 方法以首先查看会话或其他方式，这样您就不会一直访问数据库。

# .net - .NET 是否支持 Windows Eventing 6.0？

> ID：779624
> 
> 赞同：2
> 
> 时间：2009-04-22T23:07:01.503
> 
> 标签：.net, windows, manifest, event-log, instrumentation

我想使用 C# 应用程序中的 Windows Eventing 6 API 将消息记录到 Windows Server 2008 事件日志中的特定通道。关于如何使用它有一个很好的例子，但它只是 C++。在示例中提到 .NET 不支持 Windows Eventing 6。[http://msdn.microsoft.com/en-us/magazine/cc163431.aspx](http://msdn.microsoft.com/en-us/magazine/cc163431.aspx)和[http://msdn.microsoft.com中有 2 个示例/en-us/library/aa382690(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa382690(VS.85).aspx)

我的问题是如何在 C# 中做到这一点，或者你知道是否有.Net 支持这个 API。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-10-27T21:30:06.150

我想你问的是 ETW 的东西。

查看：

[使用 System.Diagnostics.Eventing 编写事件](http://www.atrevido.net/blog/2008/02/28/Writing+Events+With+SystemDiagnosticsEventing.aspx)

> ... 或者，如何将 Vista 和 2008 年的新 ETW 内容与托管代码一起使用。并且，介绍 ecmanaged：做所有这些事情的一种体面的方式。

还有更多信息：

[.NET Event Tracing for Windows](https://docs.microsoft.com/en-us/archive/blogs/dixi/net-event-tracing-for-windows)，[Naveen 的博客 ETW 系列](https://web.archive.org/web/20150518012123/http://naveensrinivasan.com:80/etw/)（特别是[使用 .NET 4.0 Event Tracing for Windows (ETW) 和应用程序 ETW](https://web.archive.org/web/20150720015101/http://naveensrinivasan.com:80/2010/03/17/using-clr-4-0-event-tracing-for-windows-etw-along-with-application-etw/)）[，.NET Framework 中的 ETW 事件](http://msdn.microsoft.com/en-us/library/ee517330(v=VS.100).aspx)，[TraceEvent](https://web.archive.org/web/20170601043145/http://bcl.codeplex.com:80/wikipage?title=TraceEvent)

如果您也感兴趣，还有一些关于常规事件日志记录的信息： [EventLog](https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.eventlog?view=net-5.0)，[EventLogInstaller](https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.eventloginstaller?view=netframework-4.8)。示例：[事件记录](http://www.roque-patrick.com/windows/final/bbl0134.html)

# asp.net - ASP.NET - 如何停止将一个项目中的类/dll 编译到另一个项目中

> ID：779628
> 
> 赞同：0
> 
> 时间：2009-04-22T23:08:42.530
> 
> 标签：asp.net

我有一个烦人的问题，其中一个曾经有效的东西停止了工作。看看这段代码：

```
Assembly _abc_assembly = Assembly.LoadFile(“c:\junk\abcabstract\bin\abc.dll”);

ABC.ContentAttribute attribute;
attribute = (ABC.ContentAttribute)_abc_assembly.CreateInstance("ABC.TextAttribute"); 
```

ContentAttribute 在 dll 中定义。显然，这应该有效。您应该能够将对象投射到自身。

但它会产生这个错误：

[替代文字 http://www.yart.com.au/stackoverflow/compile1.png](http://www.yart.com.au/stackoverflow/compile1.png)

此处讨论了此错误[http://www.yoda.arachsys.com/csharp/plugin.html](http://www.yoda.arachsys.com/csharp/plugin.html)这就是我走到这一步的方式。从这篇文章中，我了解到 ContentAttribute 类以某种方式最终出现在 ABC.DLL**和**网站项目的 DLL 中。

我拥有的网站项目如下所示：

[替代文字 http://www.yart.com.au/stackoverflow/compile2.png](http://www.yart.com.au/stackoverflow/compile2.png)

现在 ContentAttribute 不在这个项目中，它在 dll ABC.DLL 中。您可以看到，当我扩展了每个分支并且文件 ContentAttribute.cs 不存在时。

然而不知何故，它最终在 dll 中为网站创建了一个重复的参考。ContentAttribute 以某种方式最终出现在 ABC.DLL 和网站项目的 DLL 中。

谁能告诉我：

a) 为什么 ContentAttribute 在两个 dll 中？我不认为在项目中包含 dll 会强制将该代码放入项目 DLL 中。

b) 如何阻止它发生？

顺便说一句，如果可以避免的话，我绝对不想将网站项目更改为网站应用程序。

笔记：

删除临时 ASP.NET 文件不起作用。一旦我编译了我的网站项目，它们就会被重新创建。

[替代文字 http://www.yart.com.au/stackoverflow/compile3.png](http://www.yart.com.au/stackoverflow/compile3.png)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-22T23:19:00.367

ABC.DLL 被您的网站引用并成为其中的一部分（位于 Bin 文件夹中）。ASP.NET 编译您的网站，并将 ABC.DLL 放置在临时位置（C:\Windows...\Temporary ASP.NET Filse...）。它由 ASP.NET 自动加载。您正在尝试从不同位置 (D:\junk\abcabstract\bin\abc.dl) 手动加载 ABC.DLL。两个程序集不匹配，因此您会收到错误消息。

为了阻止这种情况发生，我猜你必须重新考虑你的插件架构。你能提供更多信息吗？

**更新**：你为什么不这样修复它：

```
// Assembly _abc_assembly = Assembly.LoadFile(“c:\junk\abcabstract\bin\abc.dll”);
// ContentAttribute attribute;
// attribute = (ContentAttribute)_abc_assembly.CreateInstance("ABC.TextAttribute");
ContentAttribute attribute = new ContentAttribute(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T23:22:00.627

这是命名空间冲突。它不知道要使用哪个 ContentAttribute，因为它在不同的命名空间/程序集中找到 2 个。

您可能有一个以不同名称命名的 DLL 旧副本。删除您的临时 ASP.Net 目录并重新编译。

为了避免将来：

如果您需要让它工作，请为您的对象使用完全限定的名称。

```
ABC.ContentAttribute ca = new ABC.ContentAttribute(); 
```

或者如果铸造做同样的事情

```
ABC.ContentAttribute ca =(ABC.ContentAttribute)ca2; 
```

# c# - 为什么 LINQ to SQL 将重复项插入我的表中？

> ID：779636
> 
> 赞同：0
> 
> 时间：2009-04-22T23:13:29.897
> 
> 标签：c#, .net, sql, linq, linq-to-sql

我有一个从我的数据库中检索评论的 Web 服务，如果没有返回足够的评论，它会转到辅助资源并将它们获取到那里并将它们缓存在我的数据库中。我最近注意到它一直在我的数据库中创建重复项，尽管我有主键来防止它。我在想，也许我做桌子的时候做错了什么？下面是 SQL 创建表片段：

```
create table Review(  
ReviewID int IDENTITY,  
CacheDate DateTime,  
UniqueID nvarchar(50),  
Type nvarchar(100),  
AverageRating decimal,  
TotalReviews decimal,  
Rating decimal,  
Content nvarchar(max),  
Summary varchar(100),  
HelpfulVotes int,  
TotalVotes int,  
ReviewDate nvarchar(100),  
ReviewerID nvarchar(100),  
ReviewerName nvarchar(100),  
ReviewerLocation nvarchar(100),  
primary key(ReviewID,UniqueID) 
) 
```

我已经逐步完成了我的代码，当它到达 try catch 部分时，它仍然会插入该行，即使它已经存在..

```
try { db.SubmitChanges(); }  
catch (Exception ex) {..... 
```

有谁知道是什么问题？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-22T23:21:50.457

您的主键基于 ReviewID 和 UniqueID 列。所以两列的组合必须是唯一的。

您的重复项是否具有匹配的 ReviewID 和 UniqueID？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-22T23:53:05.887

Any particular reason you put the PK over both the UniqueID and the Identity column (ReviewID)? Why not, as an alternative, put a unique constraint on UniqueID and the PK just on ReviewID?

# language-agnostic - CAD 应用程序是用什么编写的，它们是如何组织的？

> ID：779639
> 
> 赞同：14
> 
> 时间：2009-04-22T23:17:37.797
> 
> 标签：language-agnostic, rhino, backend, autocad

当今的 CAD 应用程序（Rhino、Autocad）是用什么编写的，它们在内部是如何组织的？

我举了一个例子，Autocad 和 Rhino，虽然我也很想听听其他例子。我特别想知道他们的后端是用什么（多语言？）编写的，它是如何组织的，以及他们如何实时处理他们的前端（GUI）？他们是使用本机 Windows API 还是他们自己的一些库，因为我想，尽可能好，今天市场上的开源解决方案不会削减它。我可能错了...

正如大多数使用过它们的人所知道的那样，它们可以实时处理相对复杂的旋转操作（我对着色不感兴趣）。我最近一直在用几个包做一些实验，对于一些较大的模型，发现速度有很大差异，例如，其中一些（我不会命名）程序旋转（大型全船模型） . 所以我想知道他们的内部...

另外，如果有人知道一些关于这个主题的书，我很想听听。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2010-03-20T20:40:47.417

CATIAv5、Pro/Engineer 和 Solidworks 等 3D 机械 CAD 软件大多使用 C++ 编写，有时还带有用于向客户发布基本 API 的薄 COM 接口。

由于这些应用程序非常庞大并且由多个团队开发，它们依赖于大规模的 C++ 设计原则，例如接口/实现模式来隔离模块免受更改。

它们由几个子系统组成，例如：

*   提供底层操作系统抽象的基础框架
*   GUI、对话框和用户交互的框架
*   一个 3D 渲染器（主要使用带有一些自定义场景图层的 OpenGL）
*   带有镶嵌模块的几何内核（以便可以在渲染器中显示几何图形）
*   基于几何内核的参数建模器
*   以及针对不同领域（机械、制图、模拟……）的许多特定建模师

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-23T00:47:16.693

由于我的公司是 AutoCAD 的注册开发商，我确信它是用 C++ 编写的。它公开了一个 COM 接口，以及一个 .Net 包装器。此外，它的图形显示是组件化的，可能会被替换。早在其历史上，它曾经是跨平台的。然而，它的 Windows 仅使用了大约 10 年，现在利用了我见过的所有 Windows 功能。您可能对[开放设计联盟](https://www.opendesign.com/)感兴趣。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-04T21:49:47.410

AutoLISP 是一种 lisp 风格，多年来一直用于 AutoCAD 编程。非常强大，一点也不友好。AutoCAD（和大多数垂直行业）已经内置了 VBA 大约 10 年。有点强大，非常友好。VBA 项目存储在一个单独的文件中，该文件由宿主程序内部的机制加载。默认情况下，最新版本（当前为 2010）不再包含 VBA。您必须安装单独的 VBA 启用程序。这是为了让我们注意到 VBA（就此而言是 VB6）将在某个时候成为过去。.NET 平台是目前的首选。VB.NET、C#.NET、C++是常用的。有些人尝试过其他 .NET 语言，例如 F# 和 IronPython。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-22T23:29:29.360

您可能会对开源项目 BRL-CAD 感兴趣。

# svn - 如何找回 TortoiseSVN 中删除的文件？

> ID：779642
> 
> 赞同：16
> 
> 时间：2009-04-22T23:19:03.660
> 
> 标签：svn, tortoisesvn

我们的存储库中有一个文件，我们在几个修订版之前删除了该文件。我们如何在不恢复整个存储库的情况下使用 TortoiseSVN 将其取回？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-04-22T23:26:26.200

转到显示日志屏幕，并在文件被删除时搜索修订，然后右键单击文件并选择**将修订保存到...**

![tortoiseundelete.jpg](https://dl.getdropbox.com/u/35146/stackoverflow/tortoiseundelete.jpg)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-22T23:25:55.657

其他答案似乎侧重于恢复整个*修订版*（使用不同的位置），所以这里是如何只恢复一个文件，而不必检查整个修订版，使用 TortoiseSVN：

1.  打开删除文件的修订版本的修订日志。
2.  在更改列表中找到该文件。
3.  右键单击该文件并选择“Revert changes from this revision...”。回答是。

该文件被恢复并重新添加到存储库中。我不能 100% 确定 Subversion 是否会将其视为不同的文件，或作为文件的新修订版。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-22T23:24:07.877

在 repo 浏览器中，有一个菜单说明了 goto 版本的效果。从这里您可以浏览该修订版中可用的字段并将文件拖放出来。我会检查我目前在手机上的实际程序。

希望这可以帮助

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T23:24:57.750

一旦您知道文件被删除的修订号（使用存储库浏览器可能是找到此文件的最简单方法）。在该修订之前签出到新位置。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-05-31T15:18:36.310

使用 revert 选项或打开 cmd 窗口并输入：（给出您签出代码的本地路径） svn -r（在删除该路径之前输入修订号）

# c# - 将图像处理分发到多个 Windows 服务器，文件锁定 Q

> ID：779643
> 
> 赞同：0
> 
> 时间：2009-04-22T23:20:35.967
> 
> 标签：c#, asp.net, web-services, windows-server-2008, locking

我需要将大图像文件处理成更小的图像文件。我想将工作分配给许多“从属”服务器，而不是让我的主服务器负责。我正在使用 Windows Server 2005/2008、C# 和 ASP.NET。我有很多 Web 应用程序开发经验，但没有开发过分布式系统。我有一个想法，可以这样设计：

1) 文件将被放置在共享网络驱动器中

2) 从属服务器会定期轮询驱动器以获取新内容

3) 从属服务器会将新发现的文件重命名为 UNPROCESSED_appIDXXXX_jidXXXXX_photoidXXXXX.tif 并开始处理该文件。

4) 其他从服务器将通过检查文件名来避免尝试处理正在处理的文件，即如果某些内容已被命名为“未处理”，它们将不会尝试处理。

我想知道几件事：

1) 两个从服务器尝试一次“抓取”并重命名文件是否会出现问题，还是 Windows Server 会自动锁定文件？

2) 您认为通知处理新内容的最佳机制应该是什么？一个简单的想法是在每个从属系统上编写一个基本的 aspx 页面并让它在计时器上运行。一个更好的想法可能是编写一个利用 SystemFileWatcher 的 Windows 服务，并让它在每个从属系统上运行。第三个想法是让中央服务器以某种方式向给定的从属服务器发送指令以尝试处理工作，但我不知道除了让主服务器通过一个非常骇人听闻的方法之外调用这种通信的方法通过 HTTP 的消息。

我非常感谢您提供的任何指导。

干杯，-KF

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-22T23:28:32.217

如果您不想一直使用[计算集群类型的解决方案](http://www.microsoft.com/hpc/en/us/features.aspx)。你应该考虑让一个工作经理在某个地方运行来分配工作。这样，当服务器可以工作时，它会要求工作经理做一些新的工作。然后它可以告诉作业经理它已经完成，并且当整个作业的工作完成时，作业经理可以通知您的“客户”。这样，很容易注册工作并知道它是完整的，并且工作经理可以分包工作，而不必担心文件重命名的竞争条件。:)

# javascript - 如何捕获 javascript 异常/错误？（将它们登录到服务器上）

> ID：779644
> 
> 赞同：15
> 
> 时间：2009-04-22T23:21:36.073
> 
> 标签：javascript, error-handling, error-logging

### 复制：

> *   [JavaScript 错误自动反馈](https://stackoverflow.com/questions/546990/automatic-feedback-on-javascript-error)
> *   [在服务器上记录 JavaScript 错误](https://stackoverflow.com/questions/119432/logging-javascript-errors-on-server)

* * *

我将如何在 javascript 中记录错误？我不能在 try catch 块中包装每一行 javascript。

我谈论的错误，例如在 IE 中，会显示错误页面消息，并有导致错误的行和字符。如果我能弄清楚如何在客户端捕获此错误，我可以使用 ajax 调用在服务器上记录错误。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-04-22T23:26:44.530

我在所有项目中都使用此功能：

```
window.onerror = function(m,u,l){
    jQuery.post("ajax/js_error_log.php",
        { msg: m,
          url: u,
         line: l,
       window: window.location.href });
    return true}; 
```

确保它是浏览器接收到的第一个 javascript，或者至少在任何可能导致错误的代码之前。当然需要 jQuery，但如果你愿意，你可以用纯 javascript 编写 ajax 函数。

请注意：如果您有语法错误，这对您没有帮助。如果出现语法错误，所有 javascript 都会立即死亡。

# javascript - 如何在 designMode="on" 区域停止 Safari 表单提交

> ID：779645
> 
> 赞同：0
> 
> 时间：2009-04-22T23:21:48.130
> 
> 标签：javascript, forms, safari

我试图阻止表单提交在设计模式设置为 on 的 iframe 中工作。对于除 safari 之外的每个浏览器，我都可以在窗口上观察 mousedown，如果它是表单元素则停止它。在野生动物园中，我可以让它不提交的唯一方法是放 onSubmit="return false;" 但我想找到一个更全局的解决方案，比如停止鼠标按下。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-23T01:18:29.537

你有我们可以看的测试用例吗？[（或在http://bugs.webkit.org](http://bugs.webkit.org)上提交错误）

# java - 我的 Java 类是从文件系统的哪个位置加载的？

> ID：779650
> 
> 赞同：25
> 
> 时间：2009-04-22T23:22:54.243
> 
> 标签：java, debugging, classloader

我认为这是每个 Java 程序员都会遇到的情况，如果他们做的时间足够长的话。您正在做一些调试并对类进行更改。当您重新运行程序时，这些更改似乎没有被拾取，而是旧类似乎仍在运行。你清理并重建一切，同样的问题。有时，这可能归结为类路径问题，即同一个类不止一次在类路径上，但似乎没有一种简单的方法可以确定正在加载的类的来源......

有没有办法找到加载的类的文件路径？如果该类是从`.class`文件或`.jar`文件加载的，则最好使用可以工作的东西。有任何想法吗？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-04-22T23:25:52.007

只需`java`使用标准命令行开关“ [”](http://java.sun.com/javase/6/docs/technotes/tools/solaris/java.html)`-verbose:class`运行（参见[文档](http://java.sun.com/javase/6/docs/technotes/tools/solaris/java.html)）。每次加载一个类时都会打印出来，并告诉你它是从哪里加载的。[`java`](http://java.sun.com/javase/6/docs/technotes/tools/solaris/java.html)

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-04-22T23:26:44.563

如果您想从应用程序内部以编程方式执行此操作，请尝试：

```
URL loc = MyClass.class.getProtectionDomain().getCodeSource().getLocation(); 
```

（注意，getCodeSource() 可能返回 null，所以实际上不要在一行中完成所有操作 :)）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-22T23:38:15.610

```
public static URL getClassURL(Class klass) {
    String name = klass.getName();
    name = "/" + convertClassToPath(name);
    URL url = klass.getResource(name);
    return url;
}

public static String convertClassToPath(String className) {
    String path = className.replaceAll("\\.", "/") + ".class";
    return path;
} 
```

只需将其粘贴在某个地方，然后将要查找其定义的类的 Class 对象传递给它。无论从哪里调用它都应该可以工作，因为它在正在搜索的类上调用 getResource()。

```
public static void main(String[] args) {
    System.out.println(getClassURL(String.class));       
} 
```

示例输出：jar:file:/System/Library/Frameworks/JavaVM.framework/Versions/1.6.0/Classes/classes.jar!/java/lang/String.class

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T23:27:46.963

由于类需要来自类路径中的某个位置，我建议简单地[打印类路径](http://www.java-tips.org/java-se-tips/java.lang/how-to-print-classpath.html)并检查某处是否有旧版本的类。

# c++ - 带有参数和数组的对象

> ID：779655
> 
> 赞同：4
> 
> 时间：2009-04-22T23:25:05.673
> 
> 标签：c++, arrays, arguments

在 C++ 中是否有一种方法可以在对象上添加参数，其中包含一个数组，例如：

```
int x = 1;
int y = 2;

Object myObject( x, y )[5]; // does not work 
```

我希望我可以将参数放入对象中，同时创建一个包含 5 个这些对象的数组，有人知道怎么做吗？还有更好的方法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-22T23:26:43.127

在 C++ 中构造对象数组时，只能使用默认构造函数，除非您使用显式数组初始化语法：

```
Object myObject[5] = { Object( x, y ),
                       Object( x, y ),
                       Object( x, y ), 
                       Object( x, y ), 
                       Object( x, y ) } 
```

以下是 C++ FAQ 中关于此的一些有用信息：

[http://www.parashift.com/c++-faq-lite/ctors.html#faq-10.5](http://www.parashift.com/c++-faq-lite/ctors.html#faq-10.5)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-23T03:07:20.023

如果您不介意使用向量而不是数组：

```
std::vector<Object> obj_vec(5, Object(x, y)); 
```

或者，如果您真的想要一个数组并且不介意分两步初始化它：

```
Object obj_array[5];
std::fill_n(obj_array, 5, Object(x, y)); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T23:46:46.497

或者是这样的：

```
int x = 1;
int y = 2;
int numObjects = 5;

Object myObjectArray[numObjects];

for (int i=0, i<numObjects, i++) {
    myObjectArray[i] = new myObject(x,y);
} 
```

也许它是一个以 x,y 和 numObjects 作为参数的函数？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T23:31:41.803

您还没有提到哪种语言，但在 C# 3.0 中，您可以使用集合初始化器：

```
var myObject = new List<Object>() {
    new Object(x,y),
    new Object(x,y),
    new Object(x,y),
    new Object(x,y),
    new Object(x,y)
}; 
```

# javascript - 是否有可以自动格式化我的 javascript 的程序？

> ID：779664
> 
> 赞同：1
> 
> 时间：2009-04-22T23:27:45.807
> 
> 标签：javascript, pretty-print

### 复制：

> [Javascript美化器](https://stackoverflow.com/questions/18985/javascript-beautifier)

* * *

有没有办法可以自动格式化我的 javascript 使其可读？

我有一个只有一行但大约有一百万列白色的 javascript 文件。我不想浏览每个功能并通过标签来阅读它。

有人知道可以为我做这件事的程序吗？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T23:49:14.710

在 OS X 上使用带有 JavaScript 包的[Textmate 。](http://macromates.com/)

# css - 为什么我的 DIV 改变了我的光标？

> ID：779665
> 
> 赞同：0
> 
> 时间：2009-04-22T23:27:46.103
> 
> 标签：css, html

我有两个 DIV，当我将 DIV #2 放在 DIV #1 中然后查看我的页面时，当我将光标放在 DIV #2 上时，它会将光标更改为选择（突出显示）光标？

我很困扰？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T23:31:47.013

您必须在 div 中包含浏览器将其解释为文本的内容。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T23:44:18.590

是否设置了光标的 CSS 属性？它可能为其属性值设置了值“文本”。

寻找

```
div {
    cursor: text;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T23:47:02.703

“光标”以外的规则也可以更改光标。例如，我认为在某些情况下使用“缩放”可以将光标更改为高亮/文本光标。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-23T20:07:51.680

如果这是一个大问题，您可以随时在 css 中手动更改光标

```
cursor: pointer; 
```

CSS 光标参考：[http ://cndbooks.com/csscursors.htm](http://cndbooks.com/csscursors.htm)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-01T05:25:39.097

这只是带有[FireBug的](http://getfirebug.com/)[FireFox](http://www.mozilla.com/en-US/firefox/personal.html)可以立即帮助您弄清楚的类型……只需右键单击并给出“检查元素”和 CSS。瞧。

# multithreading - C# IE BHO：在保持同一个线程的同时异步工作吗？

> ID：779671
> 
> 赞同：2
> 
> 时间：2009-04-22T23:29:31.107
> 
> 标签：multithreading, internet-explorer, com, asynchronous, bho

我有一个正在用 C# 开发的 IE BHO。它应该等待用户做一些事情，联系我们的服务器并下载一些数据，然后用结果改变当前加载网页的 DOM。

我遇到了一些与 COM 划分和线程规则相关的看似无法克服的问题——即，我似乎无法在当前线程之外访问 IE DOMDocument，而且我想不出任何方法可以在不锁定的情况下异步运行某些东西启动 IE 直到完成。

我的第一次尝试是让后台服务器通信以事件驱动的方式完成它的工作：我的程序将从 mshtml 事件（例如，BeforeNaviagate2 或 DocumentComplete）中启动通信，并从单独的事件处理程序中发布结果由服务器通信对象在完成其工作时触发。

该技术在我拼凑在一起的快速模拟器中运行良好（只是一个带有 WebBrowser 控件的简单应用程序），但在 IE 中它会引发 COM 异常，因为我试图通过单独的线程更改页面 DOM。

因此，我尝试将所有内容保留在同一个函数中，并让我的代码等待服务器通信对象使用 while 循环完成其工作，如下所示：

```
 int waited = 0;
    while (!OurServerCommRequest.ready) {
        System.Threading.Thread.Sleep(1);
        Application.DoEvents();
        waited++;

        if (waited > constants.TIMEOUT_OURSERVER_REQUEST) {
            log.wL("Timed out");
        }

    } 
```

这种方法的问题在于，当代码保留在原始线程中时，它会与它触发的 IE 进程同步执行（在 IE8 中，它是每个选项卡一个进程 - 就像 Google Chrome 一样 - 似乎）......因此锁定IE 界面，直到我的服务器通信完成。

最初我想在 URL 可用时立即开始处理（通过 NavigationComplete2 事件），但我发现如果我的服务器通信在用户页面加载之前完成，等待 <body> 标记变得可用也会锁定 IE - 抛出它进入一个无限循环，而我的代码等待 HTML 正文，而页面被阻止更新自身做上述循环。

我考虑过将所有这些都移到实际用户页面的 javascript 中，但似乎这样做我打开了一罐蠕虫来解决 XSS 安全问题。

所以...我的问题是这样的：是否可以在 C# IE BHO 中异步运行代码，同时仍然能够操作用户的页面 DOM？我问了一些朋友，大多数人告诉我这不太可能。我还是 COM 和 C# 的新手，来自 C/VB.net/JS/AS。

谢谢！

-汤姆

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-23T00:05:35.780

您需要将 DOM 对象从创建它的线程编组到您的工作线程。 [以下](http://www.codeproject.com/KB/COM/cominterop.aspx)是 COM 和 C# 如何协同工作的非常详细的细分。

所有的 IE DOM 对象都是 STA 对象。

# python - 阻止python关闭错误

> ID：779675
> 
> 赞同：21
> 
> 时间：2009-04-22T23:31:27.110
> 
> 标签：python, debugging

在 python 中运行脚本时，有没有办法在吐出回溯后阻止控制台窗口关闭？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-04-23T10:03:04.830

您可以注册一个顶级异常处理程序，以在发生未处理的异常时使应用程序保持活动状态：

```
def show_exception_and_exit(exc_type, exc_value, tb):
    import traceback
    traceback.print_exception(exc_type, exc_value, tb)
    raw_input("Press key to exit.")
    sys.exit(-1)

 import sys
 sys.excepthook = show_exception_and_exit 
```

如果您在从 C 代码调用的事件处理程序中发生异常（通常不会传播错误），这将特别有用。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-04-22T23:39:11.693

如果您在 Windows 操作系统上执行此操作，您可以为快捷方式的目标添加前缀：

```
C:\WINDOWS\system32\cmd.exe /K <command> 
```

这将防止在命令退出时关闭窗口。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-04-22T23:37:20.310

```
try:
    #do some stuff
    1/0 #stuff that generated the exception
except Exception as ex:
    print ex
    raw_input() 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-04-22T23:38:52.287

你可以有第二个脚本，它导入/运行你的主要代码。该脚本将捕获所有异常，并打印回溯（然后在结束前等待用户输入）

假设您的代码是使用`if __name__ == "__main__": main()`成语构造的..

```
def myfunction():
    pass

class Myclass():
    pass

def main():
    c = Myclass()
    myfunction(c)

if __name__ == "__main__":
    main() 
```

..并且文件名为“myscriptname.py”（显然可以更改），以下将起作用

```
from myscriptname import main as myscript_main

try:
    myscript_main()
except Exception, errormsg:
    print "Script errored!"
    print "Error message: %s" % errormsg
    print "Traceback:"
    import traceback
    traceback.print_exc()
    print "Press return to exit.."
    raw_input() 
```

（请注意，在[Python 3](https://docs.python.org/3/whatsnew/3.0.html)`raw_input()`中已被替换为）`input()`

如果您没有`main()`函数，则可以使用将 import 语句放入`try:`块中：

```
try:
    import myscriptname
except [...] 
```

一种更好的解决方案，不需要额外的包装脚本，是从 IDLE 或命令行运行脚本。

在 Windows 上，转到开始 > 运行，输入`cmd`并回车。然后输入类似..

```
cd "\Path\To Your\ Script\"
\Python\bin\python.exe myscriptname.py 
```

（如果您将 Python 安装到`C:\Python\`）

在 Linux/Mac OS X 上它更容易一些，你只需`cd /home/your/script/`运行`python myscriptname.py`

最简单的方法是使用 IDLE，启动 IDLE，打开脚本并单击运行按钮（`F5`或者`Ctrl+F5`我认为）。当脚本退出时，窗口不会自动关闭，所以你可以看到任何错误

此外，正如[Chris Thornhill](https://stackoverflow.com/questions/779675/stop-python-from-closing-on-error/779693#779693)所建议的，在 Windows 上，您可以创建脚本的快捷方式，并在其属性中为目标添加前缀 ..

```
C:\WINDOWS\system32\cmd.exe /K [existing command] 
```

来自[http://www.computerhope.com/cmd.htm](http://www.computerhope.com/cmd.htm)：

> ```
> /K command - Executes the specified command and continues running. 
> ```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-04-23T06:29:48.960

在 UNIX 系统上（上面已经介绍了 Windows...），您可以更改解释器参数以包含 -i 标志：

#!/usr/bin/python -i

从手册页：

> -一世
> 
> 当脚本作为第一个参数传递或使用 -c 选项时，在执行脚本或命令后进入交互模式。它不读取 $PYTHONSTARTUP 文件。当脚本引发异常时，这对于检查全局变量或堆栈跟踪很有用。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-01-09T02:08:06.867

在 windows 中，您可以将它拖到已经打开的 CMD 窗口中，而不是双击 py 文件，然后按 Enter。它在异常后保持打开状态。

担

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-10-18T02:05:15.430

如果您使用的是 Windows，您可以这样做

```
 import os

    #code here 

    os.system('pause') 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-04-11T07:39:59.760

看看这个问题的答案：[How to find exit code or reason when atexit callback is called in Python?](https://stackoverflow.com/questions/9741351/how-to-find-exit-code-or-reason-when-atexit-callback-is-called-in-python)

您可以复制此类`ExitHooks`，然后自定义您自己的`foo`功能，然后将其注册到`atexit`.

```
import atexit
import sys, os

class ExitHooks(object):
    def __init__(self):
        self.exit_code = None
        self.exception = None

    def hook(self):
        self._orig_exit = sys.exit
        sys.exit = self.exit
        sys.excepthook = self.exc_handler

    def exit(self, code=0):
        self.exit_code = code
        self._orig_exit(code)

    def exc_handler(self, exc_type, exc, *args):
        self.exception = exc

hooks = ExitHooks()
hooks.hook()

def goodbye():
    if not (hooks.exit_code is None and hooks.exception is None):
        os.system('pause')
#       input("\nPress Enter key to exit.")

atexit.register(goodbye) 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-22T23:35:35.943

您的问题不是很清楚，但我假设发生异常时 python 解释器退出（因此调用控制台窗口关闭）。

您需要修改您的 python 应用程序以捕获异常并在不退出解释器的情况下打印它。一种方法是打印“按 ENTER 退出”，然后从控制台窗口读取一些输入，有效地等待用户按 Enter。

# algorithm - 插入 BST 时，插入的第一项是否始终是树的根？

> ID：779685
> 
> 赞同：1
> 
> 时间：2009-04-22T23:36:27.003
> 
> 标签：algorithm, data-structures, binary-tree

查看 Wikipedia 上的实现，似乎标准 BST（非自平衡）在插入期间从不重新排列自身，因此添加的第一个项目将始终是根。它是否正确？如果是这样，这是否意味着 BST 有可能经常比 O(logN) 差得多？

使用它作为递归插入的参考：

```
 /* Inserts the node pointed to by "newNode" into the subtree rooted at "treeNode" */
 void InsertNode(Node* &treeNode, Node *newNode)
 {
     if (treeNode == NULL)
       treeNode = newNode;
     else if (newNode->key < treeNode->key)
       InsertNode(treeNode->left, newNode);
     else
       InsertNode(treeNode->right, newNode);
 } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-23T00:03:29.263

是的，它*总是*在根节点上，原因很简单：

*   那是你唯一可以把它放在空树上的地方；和
*   你没有移动它。

当然，您可以删除它，这将导致另一个节点成为根，但不会将*原始*第一个节点移动到树的其他位置。

The degenerate case for an unbalanced binary tree is a linked list, which has a search time complexity of O(n).

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T23:39:16.933

是的，插入顺序会对生成的树的形状/平衡产生负面影响。正如您所指出的，树的最坏情况比 O(log(N)) 更糟糕，最终可能看起来就像一个链表。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T23:39:58.790

是的，这就是存在自平衡 BST 的原因。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T23:42:05.850

[这个SO answer](https://stackoverflow.com/questions/526718/search-times-for-binary-search-tree)中有一些很好的信息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-22T23:52:42.517

是的，不平衡的 BST 可能很糟糕。事实上，如果您将排序数据添加到 BST，您可以快速将您的树退化为单链表性能，其中插入 O(n)，假设插入在末尾。

如果您正在处理随机数据，标准的 BST 平均会做得很好。你最大的敌人是排序的，或者反向排序的数据。

这就是为什么您通常希望使用平衡的 BST（只需从您的语言库中选择一个）。

# web-applications - 在 Web 应用程序中单击鼠标右键：好主意还是坏主意？

> ID：779689
> 
> 赞同：37
> 
> 时间：2009-04-22T23:38:20.807
> 
> 标签：web-applications, right-click

我目前正在开发一个网络应用程序，上面的权力已经决定用我们自己的应用程序特定的菜单覆盖浏览器的右键菜单是要走的路。

我完全不同意。我觉得当有人使用网络浏览器时，他们对使用指针设备的右键单击功能时会发生什么有一定的期望，并且通过故意取代此功能来违反这些期望对用户来说非常令人不安（烦人？） .

你怎么看？您是否见过在 Web 应用程序中做得很好的右键单击？我的意思是，您实际上认为，“是的，这个右键单击功能是一个很棒的决定。”？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-04-22T23:44:54.957

这通常不是一个好主意：

### 期望

用户，尤其是高级用户，希望能够右键单击桌面应用程序中的元素，以获得元素特定操作的菜单。对于 Web 应用程序不存在这种期望 - 实际上，期望是右键单击网页将为您提供标准的网页菜单，您可以在其中打印、在新窗口中打开链接、查看源代码等。

### 可靠性

因为覆盖内置菜单的能力在过去被滥用（主要是天真的程序员试图禁用保存图像），许多浏览器禁止它或使客户端代码难以以可靠的方式覆盖。

### 例外

如果您正在创建一个 Web 应用程序，该应用程序与现有的知名桌面应用程序的行为非常相似，那么投入所需的精力来实现合理的右键单击菜单*可能是合适的。*但是，您还应该遵循桌面应用程序中这些菜单的通常建议：使用它们来提供对特定于上下文的操作的快速访问，同时**也提供访问相同功能的另一种方式**。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-04-22T23:43:24.630

不，因为它根本无法被发现。当然，这取决于应用程序，但可能用户不知道右键单击。

当用户在 Web（“Internet”）上时，他们希望使用一个按钮。想想所有在使用您的网站时遇到问题的 Apple Mighty Mouse 用户。

向老板证明这个想法是否可行的最简单方法：**对真实用户进行测试**。无论如何，你应该这样做。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-04-22T23:43:13.930

Google Docs 是唯一一个我很欣赏任何尝试使用右键单击功能的网络应用程序；他们已经将其实施到位。

**更新：**澄清一下，我认为实现很棒，因为谷歌文档（整个网站/应用程序）非常擅长让你忘记你在网络浏览器中。

*又想一想：*不要！在 IE6/7/8、Firefox 2/3、Chrome、Safari 和其他鲜为人知的浏览器和版本之间，全面支持听起来像是一场噩梦。除非您的用户数以百万计，否则仅进行测试可能就是避免它的充分理由。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-23T00:08:48.283

Shog9 的回答是对您问题的最佳直接回答，但在 Web 应用程序中避免使用上下文菜单的另一个原因是，它是摆脱使用上下文菜单的绝佳机会。

大多数 Windows 和 *nix GUI 应用程序严重依赖上下文菜单来实现它们的大部分功能。Mac OS 历来因其高可用性而受到称赞的一个原因是，真正的菜单选项和工具栏元素比上下文菜单更受青睐，上下文菜单很快成为嵌套列表的贫民区（尤其是在允许其他应用程序嵌入功能的情况下）。

Web 应用程序对 UI 设计师来说是一股清新的空气，正是因为界面必须可用且功能强大，无需使用右键菜单。此外，令人惊讶的是，普通用户不会被 Web 应用程序中的新 UI 范式吓倒，而在桌面上进行实验通常是令人厌恶的。

因此，浏览器内应用程序的时代是开发人员重新思考 UI 范例的绝佳机会。右键菜单是网络上的一种逃避。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-23T00:35:33.493

这取决于应用程序的类型。我一直认为这是一个坏主意，但网络应用程序一直在越来越接近桌面应用程序。所以我[问](http://www.google.com/search?q=%22right-click%22+site:useit.com)了可用性大师（尼尔森），令人惊讶[的是，他完全支持右键单击](http://www.useit.com/alertbox/features.html)！

> ...当应用程序不支持右键单击时，高技能用户通常会感到失望——例如，如果它是在 Flash 中实现的，并且会调出 Flash 播放器菜单而不是上下文适当的应用程序命令。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-22T23:44:23.100

右键单击菜单在 Web 应用程序中运行良好。只要您的用户了解发生了什么。有几种可用的上下文菜单实现。Outlook Web Access 提供了用于处理电子邮件的上下文菜单。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-22T23:51:34.127

由于在网站上很少使用右键单击，我会说这是一个坏主意，不会被视为“最佳实践”。

如果您做的事情与互联网上几乎所有网站不同，那么您就要求您的用户花时间学习您的应用程序/网站。

此外，Mac 用户传统上没有 2 个鼠标按钮，并且并非所有 Mac 用户都知道如何通过使用选项单击组合或现在的任何方式“右键单击”。

因此，除非您确实有有效的案例，否则我不会这样做。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-22T23:57:56.827

我注意到[FCKeditor](http://www.fckeditor.net/)有一个右键单击上下文菜单...在此示例中*可能*有意义，因为所见即所得编辑器通常提供给没有 HTML 经验和更多 Microsoft Word 经验的人，在这种情况下，他们期望右键单击以对他们正在输入的文本执行某些操作。

我通常会说这是不好的做法。浮动模式就足够了吗？

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-23T00:08:39.093

我对此不持立场，但...

如果您决定使用右键单击方法，请查看[YUI！框架](http://developer.yahoo.com/yui/menu/)。

他们已经有一个跨浏览器兼容的上下文菜单实现。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-04-23T01:00:55.770

如果它是一个*网站*，这是一个坏主意。用户很快就会对破坏他们喜欢的浏览器功能的网站感到恼火。不要那样做:)

如果它是一个 Web*应用程序*，这不一定是一个坏主意，但您仍然应该谨慎。

考虑是否：

*   用户将充分沉浸在您的应用程序中，他们会自然而然地想要一个上下文菜单；*   您不仅要补偿糟糕的 UI 设计；*   浏览器的现有功能在您的应用程序的上下文中是有意义的。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2014-01-22T11:15:58.533

是的：你应该有上下文菜单。 **其实，你别无选择**。浏览器会给你一个右键菜单，但唯一的上下文是网页。因此，当您单击订单行时，例如，浏览器将为您提供诸如返回、另存为、查看源代码和打印等操作。你可能对这些不满意。所以问题是：你想用更适合上下文的东西来覆盖这些吗？随着网络应用越来越像桌面应用，答案将越来越是肯定的。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-04-22T23:41:55.133

我认为拥有右键单击功能是个坏主意。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-04-22T23:43:52.290

对于普通的 Web 应用程序来说，这不是一个好主意。我已经在 flash/silverlight “web” 应用程序中看到了它，用户期望它更像是一个“桌面”应用程序。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-04-22T23:44:48.747

我认为这在很大程度上取决于它是什么类型的应用程序。

例如，它在 Google 电子表格中很有意义 - 右键单击​​更像 Excel，并为您提供诸如允许您复制突出显示的单元格范围之类的选项 - 您无法通过常规右键单击来执行此操作菜单。

但除非你的 webapp 真的需要它，否则它可能只会惹恼用户。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-04-22T23:46:55.450

这将取决于上下文。对于一个公共网站，我会反对它。对于 Web 应用程序，尤其是公司内部应用程序，我会更容易接受。

至于处理得很好的应用程序，我想到的是 Outlook 的 Web 版本。我经常使用它来访问公司电子邮件，我发现右键菜单功能非常有用。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-04-23T00:37:15.203

一般来说**，我不同意**网络应用程序中的“右键单击菜单”，**但**如果必须的话，您必须添加一种与上下文菜单**并排工作的****替代**方法，并且不依赖于用户体验。

 *** * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-04-22T23:41:03.920

不，它永远不会真正起作用，因为用户可以阻止您尝试超越它。

# .net - SqlBulkCopy 的推荐批量大小是多少？

> ID：779690
> 
> 赞同：89
> 
> 时间：2009-04-22T23:38:39.680
> 
> 标签：.net, sql-server, performance, ado.net

推荐的批量大小是`SqlBulkCopy`多少？我正在寻找一个通用公式，我可以将其用作性能调整的起点。

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2009-07-24T21:14:01.783

我有一个导入实用程序，它与我的 SQL Server 实例位于同一台物理服务器上。使用自定义`IDataReader`，它解析平面文件并使用`SQLBulkCopy`. 一个典型的文件有大约 6M 的合格行，平均 5 列十进制和短文本，每行大约 30 个字节。

鉴于这种情况，我发现 5,000 的批量大小是速度和内存消耗的最佳折衷方案。我从 500 开始，然后尝试更大。我发现 5000 平均比 500 快 2.5 倍。插入 600 万行大约需要 30 秒，批量大小为 5,000，批量大小为 500 大约需要 80 秒。

10,000 并没有明显更快。提高到 50,000 将速度提高了几个百分点，但不值得增加服务器上的负载。超过 50,000 则显示速度没有提高。

这不是一个公式，但它是供您使用的另一个数据点。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-05-15T15:00:37.870

这是一个我也花了一些时间研究的问题。我希望使用 C# 控制台应用程序 (.Net 2.0) 优化将大型 CSV 文件（16+ GB、65+ 百万条记录，并且还在增长）导入 SQL Server 2005 数据库。正如[Jeremy](https://stackoverflow.com/users/91814/jeremy)已经[指出的那样](https://stackoverflow.com/questions/779690/what-is-the-recommended-batch-size-for-sqlbulkcopy/779728#779728)，您需要针对您的特定情况进行一些微调，但我建议您将初始批量大小设置为 500，并测试高于和低于此值的值。

我从这个[MSDN 论坛帖子](http://social.msdn.microsoft.com/Forums/en-US/adodotnetdataproviders/thread/082bd7e7-f9bf-4548-8d4c-e771a6704fce)中得到了测试批量大小在 100 到 1000 之间的值的建议，我对此表示怀疑。但是当我测试 100 到 10,000 之间的批量大小时，我发现 500 是我的应用程序的最佳值。[这里](http://www.developer.com/db/article.php/10920_3702826_2)`SqlBulkCopy.BatchSize`也推荐500 的值。

要进一步优化您的 SqlBulkCopy 操作，请查看此[MSDN 建议](http://msdn.microsoft.com/en-us/library/ms190421.aspx)；我发现使用 SqlBulkCopyOptions.TableLock 有助于减少加载时间。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2011-05-18T18:13:02.353

正如其他人所说，这取决于您的环境，特别是行卷和网络延迟。

就个人而言，我会先将`BatchSize`属性设置为 1000 行，然后看看效果如何。如果它有效，那么我会继续将行数增加一倍（例如增加到 2000、4000 等），直到超时。

否则，如果在 1000 处发生超时，那么我将行数减少一半（例如 500），直到它起作用。

*在每种情况下，我都会将最后两次尝试的批量大小之间的差异*加倍（如果成功）或减半（如果失败），直到找到最佳位置。

另一个要考虑的因素是复制一批行需要*多长时间。*[`BulkCopyTimeout`](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlbulkcopy.bulkcopytimeout.aspx)如果被复制的行的批次超过了默认为 30 秒的属性，则会发生超时。您可以尝试将属性加倍`BulkCopyTimeout`至 60 秒。这允许复制更大的批次行集的时间更长。例如，一批 50,000 行可能需要大约 40 秒，刚刚超过 30 秒的时间限制，因此将其提高到 60 秒可能有助于提高性能。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-22T23:53:10.270

这一切都取决于您的实施。

您的网络可以达到什么样的速度？您是在 Forms 还是 ASP.Net 中使用它？您是否需要提醒用户进度？总工作量是多少？

根据我的经验，在没有指定批量大小的情况下运行批量复制会导致超时问题。我喜欢从 1000 条记录开始，然后从那里进行一些调整。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2021-10-19T19:54:58.053

@Alric 建议的价值观对我来说似乎非常保守。

作为我正在处理的批量大小为 10,000、100,000 和 1,000,000 的项目的一部分，我刚刚尝试过。我的目标表是聚集列存储 bigint、int、int、int、date、decimal(32,15)。

```
BatchSize
10,000       100,000      1,000,000
3:31:25 PM   3:28:43 PM   3:36:57 PM
3:35:24 PM   3:29:38 PM   3:37:44 PM
3.983333332  0.916666671  0.783333328    (minutes) 
```

5 秒刷新时的 SSMS 活动监视器在此数据库上显示 <4MB/秒的写入。这对我来说*感觉*很低，但我真的不知道如何准确地校准我的期望。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2020-01-22T19:19:21.017

我尝试了多种尺寸，在我的情况下 5000 很好

# ruby-on-rails - Ruby on Rails / Ruby 插件问题的黄色地图

> ID：779712
> 
> 赞同：1
> 
> 时间：2009-04-22T23:46:21.503
> 
> 标签：ruby-on-rails, ruby, ruby-on-rails-plugins

好的，我也通读了插件评论和文档，但我还没有想出如何做到这一点的答案。这是我的问题，我想使用 :info_window_tabs 和 :icon 选项，但我不知道以什么格式传递我的信息。根据文档，以下代码应该是正确的。这是我的代码：

```
 @mapper.overlay_init(GMarker.new([map.lat, map.lng],
        :title => map.name,
        :info_window_tabs => [
            {:tab => "HTML", :content => @marker_html}, 
            {:tab => "Attachments", :content => "stuff"}],
        :icon => {
                :image => "../images/icon.png"
                 })) 
```

可以在[此处查看自述文件和文档。](http://github.com/queso/ym4r-gm/tree/master)

而我试图与之交互的相关 ruby​​ 文件，包括作者的评论，都可以在[这里查看。](http://github.com/queso/ym4r-gm/blob/77821351d5f5b0c536e5fbdf89a4c853162ffa96/lib/gm_plugin/overlay.rb)

我已经尝试过 IRC 中的#rubyonrails 频道，并直接向作者发送电子邮件并在 GitHub 上报告问题。这实际上只是一个语法问题。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-23T03:17:33.167

好的，所以我终于弄清楚了。这是你如何做到的；:icon 接受一个 GIcon 变量， :info_window_tabs 接受一个 GInfoWindowTabs 数组。这是使用插件声明每个的方式。

**声明 GIcon**

```
 @mapper.icon_global_init(GIcon.new(:image => "../images/civil.png",
       :icon_anchor => GPoint.new(0,0),   
       :shadow => "../images/shadow.png",
       :shadow_size => GSize.new(37,32),
       :info_window_anchor => GPoint.new(9,2)), "civil_icon")

    @civil_icon = Variable.new("civil_icon") 
```

**声明 GInfoWindowTab**

```
 @tab1 = GInfoWindowTab.new('Tab 1 Label', 'HTML for inside of tab1')
    @tab2 = GInfoWindowTab.new('Tab 2 Label', 'HTML for inside of tab2')

    @window_tabs = [@tab1, @tab2] 
```

然后在您的 GMarker 声明中执行以下操作：

```
 @mapper.overlay_init(GMarker.new([map.lat, map.lng], 
            :title => map.name,
            :icon => @civil_icon,
            :max_width => 300,
            :info_window_tabs => @window_tabs)) 
```

你完成了。

# perl - 当主脚本被杀死时，如何杀死 Perl 的“系统”调用？

> ID：779719
> 
> 赞同：6
> 
> 时间：2009-04-22T23:50:00.667
> 
> 标签：perl, kill

以前对这个问题的回答主要集中在分叉上：

*   [shell脚本退出时杀死后台进程](https://stackoverflow.com/questions/360201/kill-background-process-when-shell-script-exit)
*   [父母退出后如何使子进程死亡？](https://stackoverflow.com/questions/284325/how-to-make-child-process-die-after-parent-exits#285134)
*   [当父进程被杀死时，使用 fork() 创建的子进程是否会自动被杀死？](https://stackoverflow.com/questions/395877/are-child-processes-created-with-fork-automatically-killed-when-the-parent-is-k)

对于这个问题，我只是询问对“系统”功能的调用。

假设我有一个名为*sleep.pl*的脚本：

```
use strict;
use warnings;
sleep(300); 
```

然后我有一个名为*kill.pl的脚本*

```
use strict;
use warnings;
system("sleep.pl"); 
```

我运行 kill.pl 并使用 ps 我找到了 kill.pl 的进程 ID 并杀死它（不使用 kill -9，只是正常杀死）

sleep.pl 还在睡觉。

我想我的问题的解决方案涉及一个 SIG 处理程序，但是我需要在处理程序中添加什么来杀死子进程？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-22T23:55:30.547

使用[setsid](http://www.opengroup.org/onlinepubs/009695399/functions/setsid.html)使您的进程成为新的组长。然后您可以向组 ID 发送一个 kill 并杀死属于该组的所有进程。您从领导进程产生的所有进程都继承组 ID 并属于您新创建的组。因此，向该组发送一个杀戮将杀死他们所有人。唯一棘手的事情是为了能够使用setsid，您必须关闭标准输入和输出，因为这是setsid 的要求。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-23T09:10:35.143

```
use strict;
use warnings;
setpgrp $$, 0;
system("sleep.pl");
END {kill 15, -$$} 
```

但是如果你需要这种方法，你就做错了。你不应该这样做。以正确的方式运行并终止您的终止进程。

```
$ perl -e 'system("sleep 100")' &
[1] 11928
$ ps f
  PID TTY      STAT   TIME COMMAND
 4564 pts/1    Ss     0:01 /bin/bash
11928 pts/1    S      0:00  \_ perl -e system("sleep 100")
11929 pts/1    S      0:00  |   \_ sleep 100
11936 pts/1    R+     0:00  \_ ps f
$ kill %1
[1]+  Terminated              perl -e 'system("sleep 100")'
$ ps f
  PID TTY      STAT   TIME COMMAND
 4564 pts/1    Rs     0:01 /bin/bash
11949 pts/1    R+     0:00  \_ ps f 
```

这个怎么运作？如果您在后台运行，Shell（在我的情况下为 bash）应该将您的进程设置为组长。然后，如果您使用`kill %?`语法 shell 以正确的方式杀死组。比较一下：

```
$ perl -e 'system("sleep 100")' &
[1] 12109
$ ps f
  PID TTY      STAT   TIME COMMAND
 4564 pts/1    Rs     0:01 /bin/bash
12109 pts/1    S      0:00  \_ perl -e system("sleep 100")
12113 pts/1    S      0:00  |   \_ sleep 100
12114 pts/1    R+     0:00  \_ ps f
$ kill 12109
[1]+  Terminated              perl -e 'system("sleep 100")'
$ ps f
  PID TTY      STAT   TIME COMMAND
 4564 pts/1    Ss     0:01 /bin/bash
12124 pts/1    R+     0:00  \_ ps f
12113 pts/1    S      0:00 sleep 100 
```

但`kill %?`以这种方式工作：

```
$ perl -e 'system("sleep 100")' &
[1] 12126
$ ps f
  PID TTY      STAT   TIME COMMAND
 4564 pts/1    Rs     0:01 /bin/bash
12126 pts/1    S      0:00  \_ perl -e system("sleep 100")
12127 pts/1    S      0:00  |   \_ sleep 100
12128 pts/1    R+     0:00  \_ ps f
$ kill -12126
[1]+  Terminated              perl -e 'system("sleep 100")'
$ ps f
  PID TTY      STAT   TIME COMMAND
 4564 pts/1    Ss     0:01 /bin/bash
12130 pts/1    R+     0:00  \_ ps f 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-07-06T20:21:20.723

您的问题确实是更笼统的“如何确保孩子在父母去世时死去”问题的具体实例。只是没有办法解决这个问题。system() 没有什么特别之处；它只是分叉一个子进程并等待它退出。

system() 大致是这样的：

```
sub system 
{
    my $kidpid = fork;
    if ( $kidpid )
    {
        waitpid $kidpid; 
          # parent process blocks here waiting for the child process to return
    }
    else
    {
        exec( @_ );
    }
} 
```

杀死进程组是您唯一的选择。

# javascript - 访问链接后，Firefox 会选择性地跳过状态更改或 a:visited 样式

> ID：779722
> 
> 赞同：2
> 
> 时间：2009-04-22T23:51:05.703
> 
> 标签：javascript, firefox, anchor, visited

在单击带有通用 href 的链接（本地页面或网站）并成功加载 href 后，FF2 和 IE7 都会显示带有 a:visited 样式的链接。

对于带有 href="javascript:anyfunc()" 的链接，IE7 的工作方式如上，而 FF2 不显示 a:visited 样式。任何 DOCTYPE 都没有变化。

问：JS 链接和 :visited 的行为是否被认为是正确的？

Q：FF2点击JS链接后锚点状态不变吗？

问：无需附加 onClick 处理程序或使用 JS 修改类/样式，是否有一种简洁的方法告诉 FF2 使用 :visted 样式，而与 href 是另一个页面还是 JS 链接无关？

**示例如下：**

```
<html>
<head>
<style>
div.links { font-size: 18px; }
div.links a { color: black; text-decoration: none; }

div.links a:visited { background-color: purple; color: yellow; }
div.links a:hover { background-color: yellow; color: black; }
</style>

<script>
function tfunc(info) { alert("tfunc: info = " + info) }
</script>
</head>
<body>

<div class="links">
    <a href="javascript:tfunc(10)">JS Link 1</a><br>
    <a href="javascript:tfunc(20)">JS Link 2</a><br>
    <a href="http://www.google.com/">Common href, google</a>
</div>

</body>
</html> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-23T00:08:42.510

很难设置这些链接的样式......虽然它们可能具有相同的 href，但它们可以通过 JS 做任何事情（这可能看起来访问它不会）。

有没有办法链接到诸如 HTML 页面之类的东西并将事件处理程序附加到链接（并返回 false 以停止链接单击）？如果链接实际上是 JS 钩子，我会使用诸如 a 之类的元素`<button>`并相应地对其进行样式设置...记得添加`cursor: pointer`以便最终用户知道它是*可点击*的。

在 href 中使用内联`javascript:function(something)`是不好的做法。尝试不显眼的事件处理程序。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T19:24:48.917

a:hover 必须在 CSS 定义中的 a:link 和 a:visited 之后才能生效！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T19:45:17.340

这是我的看法：

> 问：JS 链接和 :visited 的行为是否被认为是正确的？

链接的目的是检索资源。如果您的链接无处可去，您在“访问”什么？在我看来，从这个角度来看，这种行为是正确的。

> Q：FF2点击JS链接后锚点状态不变吗？

似乎它不会将链接的状态更改为 :visited ，除非它指向页面中的元素（这意味着链接指向隐式访问的当前页面）或已访问的另一个资源.

> 问：无需附加 onClick 处理程序或使用 JS 修改类/样式，是否有一种简洁的方法告诉 FF2 使用 :visted 样式，而与 href 是另一个页面还是 JS 链接无关？

我不这么认为。`href`如果您将链接指向“#”并使用`onclick`处理程序来满足您的 JavaScript 需求，您可能会获得已访问的效果。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-06-16T19:19:45.553

我遇到了我相信这个问题在问的问题。考虑这个简单的例子：

样式表：

```
#homebox { display: none;}
#contactbox { display: none; } 
```

html:

```
<a id="#home"></a>
<a href="#home" onclick="return showHideDiv(this);">Show Home</a>
<div id="homebox">Your home</div>
<a id="#contact onclick="return showHideDiv(this);"></a>
<div id="contactbox">Contact Info</div> 
```

脚本：

```
function showHideDiv(elem) {
if( elem.style.display && elem.style.display == "none"; ) elem.style.display = "block";
else if( elem.style.display && elem.style.display == "block"; ) elem.style.display = "none";
return true;
} 
```

虽然不是最漂亮的代码，但它指出了在 href 中使用 javascript onlick 时可能出现的一些问题。您可能想做这样的事情的原因是创建动态内容更改而不重新加载显示访问的样式。a 链接比按钮更方便，因此链接的访问状态保持不变，即使是内部的。但是，我注意到浏览器在内部链接上触发已访问状态的一些问题，更不用说带有 javascript onclick 事件处理程序的内部链接了。一个按钮需要编写一个函数来控制访问的样式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-23T01:50:08.883

我同意亚历克斯的观点，链接应该是指向某物的链接，而不是 JS 触发器——一个按钮在这里会更有效。

如果您确实想将一些 JS 函数附加到链接，则绝对应该使用一些不显眼的 JS 将该函数附加到单击事件。

使用 jQuery 的 EG：

```
$("#myLinkID").click(function () { 
  //function stuff
}); 
```

# delphi - 确定何时在虚拟机中运行

> ID：779723
> 
> 赞同：41
> 
> 时间：2009-04-22T23:51:13.490
> 
> 标签：delphi, vmware, virtualization, virtualbox, virtual-pc

应用程序是否有*正式*的方法来确定它是在 VMWare 还是 Virtual PC（或微软现在所称的任何东西）中运行？我看到的代码通常是利用特定版本的 VMWare 或 Virtual PC 中一些奇怪的行为副作用的 hack。

理想情况下是 Delphi 代码，但如果你可以链接到官方解释，那么我相信我可以转换它。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-04-23T01:15:48.230

去年我写了一系列关于这个的文章，带有源代码。VMware 和 Wine 检测在[这里](http://ruminatedrumblings.blogspot.com/2008/04/detecting-virtualized-environment.html)。虚拟 PC 来[了](http://ruminatedrumblings.blogspot.com/2008/04/detecting-virtual-pc.html)。所有这三个都具有相当铁定的检测，因为记录了对管理程序的回调（在 Wine 的情况下，标准 DLL 的扩展）。我在评论部分放置了一个未经测试的 VirtualBox 检测器（没有安装它来测试）。Parallels 也可以使用回调检测到，但我没有安装它。文档的链接（由于它来自专注于漏洞利用的安全研究人员，因此很差），但如果您已安装并感兴趣，则位于[此处。](http://www.symantec.com/avcenter/reference/Virtual_Machine_Threats.pdf)[这里](http://pferrie.tripod.com/papers/attacks2.ppt)还有一个PPT有一些关于检测 Sandbox、Bochs 和 Xen 的信息。里面的代码不多，但如果你必须检测这些代码，它可能会给你一个起点。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-22T23:55:18.177

代码项目展示了一种[检测您的程序是否在虚拟机](http://www.codeproject.com/KB/system/VmDetect.aspx)中运行的方法，该方法详细介绍了如何完成它以提供良好的理解

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-22T23:57:14.910

我认为最好的方法是检查硬件配置文件。虚拟化硬件通常使用公司名称的一部分。如果您在 Virtual PC 中查看主板说明，您会发现它是由“Microsoft Corporation”制造的。同样在 VMWare 中，您的以太网适配器将以 VMNet 为前缀。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-23T10:26:25.147

[SysInternals 论坛上的这个](https://social.technet.microsoft.com/Forums/en-US/ffb60194-1e92-421e-ac4a-767daf42fbc5/virtual-machine-detection?forum=windowsdevelopment)帖子有几个答案（当然是在 Delphi 中），包括一个 IsVM 函数。我已经在 VMWare 中的 XP 和 Vista 上托管的 XP 和 Win2003 上进行了测试，结果很好。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-22T23:56:50.997

这里发布了一种 WMI 方式：http: [//blogs.msdn.com/virtual_pc_guy/archive/2005/10/27/484479.aspx](http://blogs.msdn.com/virtual_pc_guy/archive/2005/10/27/484479.aspx)

我已经仔细检查了在 Virtual PC 上运行的 XP 映像，他们正在测试的值仍然相同。不过，我不能保证其他虚拟机会在这里返回什么...

实际上，我有一个我几年前编写的 Delphi 程序来获取列表并使用 WMI 更改默认打印机，而不需要 3rd 方组件或类似的东西。如果您不习惯使用 Delphi 的 WMI，我可以向您发送一份副本，以便您有一些工作要做（虽然它不一定与 Unicode 兼容，但升级它对我来说应该不会太难如果需要的话）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-24T23:39:53.270

我使用了[RedPill](http://www.invisiblethings.org/papers/redpill.html)方法（翻译为 Delphi，但代码并不难理解），效果相当好。我还使用 WMI 调用进行了一些额外的检查，以获取诸如网络适配器供应商名称和版权之类的信息，但那是为了检测特定版本的 Virtual PC。

我对 RedPill 方法的理解是它应该工作并根据其工作方式的性质检测所有虚拟机。也有可能产生误报，因为 Windows 7 的 Windows 中的新 Windows 功能可以配置为在 Windows 7 中无缝运行 Windows XP 副本中的选定程序。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-12-01T01:40:36.123

我很幸运只看 MAC 地址，因为所有制造商都有一个块，前 3 个部分对他们来说是独一无二的。

```
//look at the MAC address and determine if it's a Virtual Machine
$temp = preg_split("/\s+/",exec("/sbin/ifconfig -a eth0 2>&1 | /bin/grep HWaddr"), -1, PREG_SPLIT_NO_EMPTY);
//Virtual Box MACs all start with '08:00:27:xx:xx:xx'
if (strpos($temp[4], '08:00:27') !== false) $_SESSION['DEVELOPMENT'] = true; 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-10-20T05:07:50.783

判断机器是物理机还是虚拟机

```
dmidecode | egrep -i 'manufacturer|product' 
```

如果找不到 dmidecode 命令，请安装相应的 rpm。

这是在 EXSI、VMWARE 和 hyperv 机器下测试的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-29T08:45:20.387

如果您想普遍检测是否存在任何类型的虚拟化，则最好分析性能特征。采取一些在虚拟化中速度明显较慢的东西（例如像分叉炸弹这样的 MMU 繁重的工作负载），并将其与正常的 CPU 绑定用户空间应用程序进行比较。从比例你可以很容易地看出。

如果您只关心某些 VMM，最简单的工作就是寻找它们的硬件 - 即 VMware PCI 设备：

00:07.3 桥接器：Intel Corporation 82371AB/EB/MB PIIX4 ACPI (rev 08) 子系统：VMware Inc 虚拟机芯片组

公元 15 年：1976

供应商值为“15ad”

还有一些特定的后门端口可以跨各种版本的各种 VMM 工作。SIDT 技巧也很好，但是如果 VMM 不在他的代码正在检查的列表中怎么办？

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-11-17T20:37:10.650

```
dmidecode -s system-product-name 
```

在 VirtualBox 上测试，结果：

```
Virtualbox 
```

# sifr - Sifr 导致背景图像在页面加载时闪烁

> ID：779734
> 
> 赞同：1
> 
> 时间：2009-04-22T23:56:37.657
> 
> 标签：sifr

基本上每次刷新页面时，浏览器都会清除屏幕，使其完全变白，然后快速绘制所有内容。这会在切换页面或刷新页面时导致明显的跳转。它在 FF 中最明显，而在 IE 位于中间的 safari 中最不明显。

这是可以修复的还是只是使用 Sifr 的一个缺点？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-23T00:01:18.113

我认为使用 Flash 呈现文本是一个缺点。您是否考虑过使用服务器端语言来生成文本或[typeface.js](http://typeface.neocracy.org/)？

或者更好的是，您可以使用网络安全字体，还是客户端是不会让步的类型？

## 编辑

您可能正在谈论 FOUC ... 无样式内容的 Flash。这通常是样式表放置的 IE 问题，但我之前也曾在 Safari 中看到过。通常有解决方法。

# javascript - 如何在 Greasemonkey 脚本中包含远程 javascript 文件？

> ID：779739
> 
> 赞同：27
> 
> 时间：2009-04-22T23:58:32.347
> 
> 标签：javascript, jquery, greasemonkey

我正在尝试编写一个 Greasemonkey 脚本，并且想使用 jQuery 库来执行此操作，但我不太确定如何从网址中包含 jQuery 以开始滚动。

**我如何将 jQuery（来自 Google 的网络服务器）包含到greasemonkey 脚本**中，这样我就可以去：

```
$(document).ready(function(){
  // Greasemonkey stuff here
}); 
```

我宁愿从这个来源得到它：

```
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript" charset="utf-8"></script> 
```

**更新：**感谢您的帮助，答案非常有用。但是，我确实使用了我的 GoogleFu 并遇到了这个*解决方案*：http : [//joanpiedra.com/jquery/greasemonkey/](http://joanpiedra.com/jquery/greasemonkey/)

像魅力一样工作..只需将源更新为谷歌托管版本的 jQuery 即可完成。

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-04-24T10:21:06.933

在最近版本的greasemonkey 中推荐的方法是使用@require 注释标签。

例如

```
// ==UserScript==
// @name          Hello jQuery
// @namespace     http://www.example.com/
// @description   jQuery test script
// @include       *
// @require       http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js
// ==/UserScript== 
```

**但是...请注意，jQuery 1.4.1 和 1.4.2 与此方法不兼容**

感谢 Paul Tarjan 指出这一点。请参阅[jQuery 论坛主题](http://forum.jquery.com/topic/importing-jquery-1-4-1-into-greasemonkey-scripts-generates-an-error)。

**还要注意这些 @require 语义**

在安装用户脚本时，Greasemonkey 将下载并保存远程文件的本地缓存副本，该副本几乎可以立即读取。缓存的副本与您安装的用户脚本保存在同一文件夹中。不监视远程文件的更改。

请注意，在编写此答案时，此 @require 标记仅在安装时读取。如果您编辑现有用户脚本以添加此标签，它将被忽略。您需要卸载并重新安装您的用户脚本以获取更改。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-23T01:32:21.827

从[这里](http://www.nabble.com/Loading-jQuery-UI-dialogs-from-GreaseMonkey--td19897312s27240.html)：

```
// ==UserScript== 
// @name           jQueryTest 
// @namespace      http://www.example.com/
// @include        * 
// ==/UserScript== 

// Add jQuery 
var GM_JQ = document.createElement('script'); 
GM_JQ.src = 'http://jquery.com/src/jquery-latest.js';
GM_JQ.type = 'text/javascript'; 
document.getElementsByTagName('head')[0].appendChild(GM_JQ); 

// Check if jQuery's loaded 
function GM_wait() { 
    if(typeof unsafeWindow.jQuery == 'undefined') 
{ window.setTimeout(GM_wait,100); } 
        else { $ = unsafeWindow.jQuery; letsJQuery(); } 
} 
GM_wait(); 

// All your GM code must be inside this function 
function letsJQuery() { 

    alert($); // check if the dollar (jquery) function works 
    // the next call fails 
    $("<div id='example' class='flora' title='This is my title'>I'm in 
a dialog!</div>").dialog({ 
            buttons: { 
                "Ok": function() { 
                    alert("Ok"); 
                }, 
                "Cancel": function() { 
                    $(this).dialog("close"); 
                } 
            } 
        }); 
} 
```

它运行良好，但您可能希望限制它运行的站点或在您自己的站点上托管 jQuery js 文件，以免窃取它们的带宽。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-23T00:25:59.740

您可以尝试动态创建脚本元素：

```
var script = document.createElement("script");
script.src = "http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js";
document.getElementsByTagName("head")[0].appendChild(script); 
```

您可能需要在脚本加载时延迟一段时间（setTimeout？）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-01-26T02:00:07.953

根据[克里斯的回答](https://stackoverflow.com/a/779967/2205911)，我会根据自己的需要进行调整，如下所示。

```
// ==UserScript==
// @description require http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.jss
// @name         Baidu Mask
// @namespace    http://tampermonkey.net/
// @version      0.1
// @description  try to take over the world!
// @author       You
// @match        https://www.ibm.com/developerworks/cn/opensource/os-cn-greasemonkey/index.html
// @match        *://www.baidu.com/*
// @match        *://baike.baidu.com/*
// @match        *://zhidao.baidu.com/*
// @match        *://www.weather.com.cn/*
// @grant        none
// ==/UserScript==

(function () {
    'use strict';

    // Your code here...

    var $j;

    function GM_wait() {
        if (typeof jQuery === 'undefined') {
            window.setTimeout(GM_wait, 100);
        }
        else {
            $j = jQuery.noConflict();
            doJob();
        }
    }

    function loadJquery() {
        // Check if jQuery's loaded

        if (typeof jQuery === 'undefined') {
            // Add jQuery
            var GM_JQ = document.createElement('script');
            GM_JQ.src = 'https://code.jquery.com/jquery-1.12.4.min.js';
            GM_JQ.type = 'text/javascript';
            GM_JQ.id = 'jquery-lyz';
            document.getElementsByTagName('head')[0].appendChild(GM_JQ);
            GM_wait();
        } else {
            doJob();
        }
    }

    loadJquery();

    function doJob() {
        if (typeof $j === 'undefined') {
            $j = $;
        }

        var url_arr = [
            {'name': "baidu", 'value': "www.baidu.com"},
            {'name': "baike", 'value': "baike.baidu.com"},
            {'name': "zhidao", 'value': "zhidao.baidu.com"},
            {'name': "weather", 'value': "http://www.weather.com.cn"},
        ];
        var url = location.href;
        var siteObj = {};
        $j(url_arr).each(function (i, item) {
            if (url.indexOf(item.value) > -1) {
                siteObj = item;
                return false;
            }
        });

        var delay_arr = [];
        var timerCount = 1;

        function hideTimer() {
            timerCount++;
            if (timerCount > 20) {
                return;
            }
            delay_arr = $j.grep(delay_arr, function (_selector, i) {
                var $ele = $j(_selector);
                var visible = $ele.is(':visible');
                console.log($ele, visible);
                if (visible) {
                    $ele.hide();
                    return false;
                }

                return true; // keep the element in the array
            });
            if (delay_arr.length > 0) {
                setTimeout(hideTimer, 500);
            }
        }

        setTimeout(hideTimer, 500);
        var $frms;
        switch (siteObj.name) {
            case 'baidu':
                $j('#content_right').hide();
                break;
            case 'baike':
                $j('.topA, .lemmaWgt-promotion-slide, .union-content, .right-ad, .lemmaWgt-promotion-vbaike, .nav-menu').hide();
                delay_arr.push('#side_box_unionAd');
                break;
            case 'zhidao':
                $j('.widget-new-graphic, #union-asplu, .jump-top-box').hide();
                delay_arr.push('.wgt-daily');
                delay_arr.push('.shop-entrance');
                delay_arr.push('.cms-slide');
                delay_arr.push('.nav-menu');
                $frms = $j('iframe');
                $frms.hide();
                break;
            case 'weather':
                $j('.right, .hdImgs, .tq_zx, #di_tan, #zu_dui').hide();
                //delay_arr.push('.wgt-daily');
                $frms = $j('iframe');
                $frms.hide();
                break;
        }
    }

})(); 
```

我的脚本需要在不同的站点上运行，有些包含 jquery，有些不包含，所以我必须测试一下。**“要求”方式在这里不起作用**。

# django - 如何使用 fastcgi 在一台服务器上运行多个 Django 站点？

> ID：779743
> 
> 赞同：1
> 
> 时间：2009-04-23T00:00:22.127
> 
> 标签：django, nginx, fastcgi

我在设置了十几个虚拟主机的服务器上运行 Django。我整理的第一个 Django 站点运行良好，但我即将建立第二个站点。我需要运行第二个 fastcgi 进程吗？

对于第一个站点，我以这种方式运行 fcgi：

```
/home/django/app1/manage.py runfcgi protocol=fcgi host=127.0.0.1 port=8081 
```

域的 nginx 配置指向该 fcgi 进程（fastcgi_pass 127.0.0.1:8081）。

对于第二个站点，我是否需要运行 fcgi 的另一个副本，就像每个站点一个 fcgi 一样？：

```
/home/django/app2/manage/py runfcgi protocol=fcgi host=127.0.0.1 port=8082 
```

然后将 nginx 配置引导到该进程（fastcgi_pass 127.0.0.1:8082）？

或者有什么方法可以用一个 fastcgi 处理多个 Django 站点？是否有设置多 Django 服务器的最佳实践？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-23T00:38:33.267

这取决于您所说的站点是什么意思，以及您的 Django 配置是什么样的。

每个 Django settings.py 定义了一个且唯一的数据库，一个且唯一的 urls.py 树。

每个 Django 都有一个 settings.py——一个数据库——一个 urls.py 树。

如果每个站点都有不同的数据库，则它们需要不同的 settings.py 并且您需要不同的 fastcgi 实例。

如果所有站点都由单个数据库支持，并且具有单个 settings.py，那么您可以将它们全部挤出单个 fastcgi 实例。

请注意，Django 的 urls.py 处理程序大多会忽略请求中 url 解析中的主机名和端口号。但是，如果您包含站点模型，您可以让虚拟主机名成为请求处理的一部分。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-25T17:13:08.340

对于它的价值，您可以消除 tcp 开销并改用套接字：

/home/django/app1/manage.py runfcgi 协议=fcgi socket=/var/run/mysite.sock

套接字对于网络服务器用户必须是可读写的。

# c# - .Net 正在增加我的开发时间——我错过了什么吗？

> ID：779745
> 
> 赞同：3
> 
> 时间：2009-04-23T00:00:35.777
> 
> 标签：c#, .net

我最近开始玩 C#，但我发现它非常令人沮丧。似乎每次我想添加我认为简单的控件时，我最终要么在互联网上搜索，要么自己编写。我只是觉得我花了更多时间重新创建控件以使它们以应有的方式工作，而实际创建应用程序的时间却更少。

例如： [在另一个问题](https://stackoverflow.com/questions/745974/remove-the-border-from-a-combobox)中，我问是否可以删除组合框上的边框；我认为应该将某些东西内置到控件中，但可惜我必须为这个简单的更改构建自己的控件。

我对 C#/.net 太陌生，还是我期望太高？我知道 SO 喜欢 C#，所以不要因为这种感觉而咬我的头，只是帮助我了解我缺少什么以及我是否应该继续学习和使用 C#。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-23T00:07:27.663

我今天花了 4 个多小时来追踪 C++ 程序中的 8 字节内存泄漏。涉及线程并且附加调试器会改变线程时间，所以我什至无法做一些简单的事情，比如打破第 N 个分配以查看泄漏在哪里。此外，我通常知道在哪两个事件之间分配了内存。不幸的是，两个线程都认为这是分配大量 8 字节大小对象的好时机。在调查结束时，我发现 COM 指针上的引用计数错误导致了泄漏。

不必为这样的调查而烦恼，这就是您应该转向 C# 的原因。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-23T00:12:43.250

> 例如。在另一个问题中，我问是否可以删除组合框上的边框；我认为应该将某些东西内置到控件中，但可惜我必须为这个简单的更改构建自己的控件。

当然，您不能删除组合框上的边框。它们是**Win32**控件，它们必须按照 Win32 的规则运行。这包括给予操作系统和用户，而不是应用程序对样式的控制。

如果您想要一些可以在 Windows 上完全设置样式的东西，那么您需要查看 WPF。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-23T01:14:16.533

我认为你真正的意思是：

*.NET 上的 Windows 窗体正在增加我的开发时间 - 我错过了什么吗？*

我认为您*缺少*几件事：

*   **开放的思想**——任何新的编程语言不仅会带来新的语法，还会带来新的*范式*。如果您来自 C++ 范例，例如垃圾收集，您可能听起来“过于自动化”，并且您希望拥有更多控制权，但可惜，您必须放手。每当你从一种范式跳到另一种范式时，先决条件总是能够忘掉你一直知道的东西。
*   **Windows 控件与 Web 控件不同**- 我检查了您之前的问题，它们看起来像是来自 VBScript，这可能意味着您在 Office 或 ASP Classic 中使用它。话虽如此，当您在 Web 中时，您对易于想象的控件的需求对于 Windows 来说会更加严格——Windows 的设计*并非*易于修改。这就是制作 WPF/Silverlight 的原因。
*   **生产力是学习能力的函数**——我说过了。这可能会受到伤害，但是，如果你的学习过程中被玩世不恭或敌意阻碍，你根本*不会*很快变得富有成效。如果您已经习惯了不必学习新事物，那么您也不会很快变得富有成效。如果你认为你真的很擅长学习新事物，你会找到使用该语言提高生产力的方法——*然后*我们可以讨论你的论点相对于开发时间的优点。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-23T00:06:47.477

对于任何新技术，一开始都有相当长的学习曲线，有些技术的学习曲线比其他技术要高。我认为随着您获得更多经验，您会发现这些事情变得更加容易。C# 对 .Net 架构有很大的利用价值，但其中很多需要时间才能真正体会到。C# 也在不断变化和发展，以允许新的编码风格（新版本融合了函数式编程的许多影响），使其既流行又强大。坚持下去，继续学习。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-23T00:20:30.673

听起来你只是新手。问题不是 C#，而是 .net 框架。例如，如果您使用 VB.net，您可能会遇到同样的问题。

当我从经典 ASP 转到 ASP.net 时，我遇到了这个问题。半年左右的时间里，我觉得我想在 ASP.net 中做的事情在经典 ASP 中要容易得多。最终那件事消失了。现在，当我尝试学习 ASP.net MVC 时，我将再次经历它。我可以在 ASP.net 中在 5 分钟内完成的事情需要我几天才能在 ASP.net MVC 中弄清楚。

在您的情况下，听起来您正在使用 Windows 窗体。您以前使用过winforms（即VB6）吗？如果您想更好地控制样式，您可能需要查看 WPF。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-23T02:40:31.490

你不是第一个，也不是最后一个有这种情绪的开发者。在我看来，每次我需要做一些不属于演示的事情时，我都必须花费数小时试图弄清楚如何完成一项小任务。我的大部分挫败感都来自于 ASP.NET Web 控件。

话虽如此，我发现一旦我克服了控制开发的（恕我直言）学习曲线，我的许多挫败感都消除了。我觉得使用继承和覆盖虚拟成员来创建新行为是一种非常干净的方法。另外，它创建的输出可以很容易地重用。在我看来，使用 OO 实践总是比到处粘贴 JavaScript 片段要好。

Microsoft 在提供许多开箱即用的基本控件方面做得很好，但每个应用程序似乎总是需要一些缺少的东西。我建议学习控制开发，或者如果可能的话寻找第三方解决方案。许多公司的存在只是为了填补空白。无论哪种方式，我都不会根据默认控件集来判断整个语言。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-23T00:16:36.220

是的。你错过了一些东西——你正在使用的工具的经验。

例如，几个月前我决定我的下一个项目将使用 ASP.NET MVC。我从事 WebForms 已经好几年了，并且在几个个人应用程序中涉足了 RubyOnRails。MVC 符合我提高应用程序可测试性的愿望，而且我更喜欢在大多数情况下编写自己的 HTML。

尽管我有 ASP.NET、C# 和 RoR 中的 MVC 经验，但我仍然需要一段时间才能达到我使用 WebForms 的速度。我觉得我必须把所有的时间都花在寻找如何做事上。现在，几个月后，我觉得我能够像以前一样快速发展。更重要的是，我知道各种范式，并且在遇到与我之前解决过的问题类似的问题时可以轻松地应用它们。我还构建了一个可以反复重用的扩展、片段和组件的集合。

我建议你给 C#/.NET 一个足够长的机会来克服不可避免的早期斗争，然后确定问题是否出在技术上。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-23T00:13:44.933

会不会是你试图做的不是，比方说，常见的？大多数 GUI 开发人员都遵循某种人机界面指南，以便他们的应用程序与正在使用的操作系统的窗口管理器完美匹配。它有助于用户体验。大多数 GUI 元素的设计都考虑到了这一点。因此，您可能正试图使您的界面与大多数界面完全不同，因此发现您必须做一些自定义工作。那是正常的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-23T00:11:35.750

取决于你来自哪里。我发现 c# 非常有效。

我很少使用其他控件，因为它们通常不能 100% 地适用于我的用例，并且它们会创建对您的应用程序的依赖关系。

因此，当您想将项目升级到 c# 4 并且不能因为控制 XY 和 Z 在 c# 4 中不起作用时...您的 SOL。

所以我只是先接受打击，然后编写自己的控件，这样以后会减少悲伤。

# sql-server-2005 - 导入数据向导不喜欢我为列选择的数据类型

> ID：779754
> 
> 赞同：9
> 
> 时间：2009-04-23T00:04:26.297
> 
> 标签：sql-server-2005, ssis, import-from-excel

其他人有没有同样的问题，当您从 Excel 文件导入数据到 MSSQL Server 2005 时，如果某些列包含主要是数字数据，但即使您将列类型设置为 varchar，向导也无法导入那些无法解析的字段作为数字？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-23T01:25:19.160

试试这个（注意：这些说明基于 Excel 2007）...

以下步骤应强制 Excel 将列视为文本：

使用 Excel 打开电子表格。

通过单击列标题选择包含“主要是数字数据”的整个列。

单击功能区菜单上的数据选项卡。

选择文本到列。这将打开将文本转换为列向导。

-在第 1 步：单击下一步

-在第 2 步：单击下一步

-在第 3 步：选择文本并单击完成

保存您的 Excel 工作表。

使用 SQL Server 2005 导入数据向导重试导入。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-12T02:40:25.260

您需要编辑 SSIS 使用的连接字符串。将此添加到字符串“IMEX=1;”的末尾 （无引号）这告诉 SSIS/jet 不要试图弄清楚数据类型是什么。只需导入它们。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-03-17T05:48:04.710

您可以尝试调整 Jet 设置以导入 Excel 数据。在给定导入期间尝试确定列类型时，您可以强制 Jet 引擎对整个工作表进行采样。更改以下注册表项（先备份后），看看是否不这样做：

```
HKLM\Software\Microsoft\Jet\4.0\Engines\Excel 
```

或者在 x64 上

```
HKLM\Software\Wow6432Node\Microsoft\Jet\4.0\Engines\Excel 
```

将值 TypeGuessRows 设置为零。这将强制 Jet 对所有行进行采样以确定列类型。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-16T16:52:16.483

创建一个新列，它是一个撇号 + 要导入的列的内容。这将迫使它成为一个字符串

="'"&E2

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-03-01T15:51:09.343

在 HDR 设置对我有用**之前**添加 IMEX=1 。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-07-12T13:29:59.730

这是最好的解决方案：

1.  单击功能区菜单上的文件，然后单击选项。

2.  单击高级，然后在计算此工作簿时，选中将精度设置为显示复选框，然后单击确定。

3.  单击确定。

4.  在工作表中，选择要设置格式的单元格。

5.  在主页选项卡上，单击数字旁边的对话框启动器按钮图像。

6.  在类别框中，单击数字。

7.  在小数位数框中，输入要显示的小数位数。

# java - How do I convert XML into a java value object?

> ID：779755
> 
> 赞同：2
> 
> 时间：2009-04-23T00:04:27.780
> 
> 标签：java, xml, xml-parsing

What kind of open-source libraries are available to convert XML into a java value object?

In .Net, there is a way to easily do this with xml serialization and attributes. I would imagine there some parallel in java. I know how to do this with a DOM or SAX parser, but I was wondering if there was an easier way.

I have a predefined XML format that looks something like this.

```
<FOOBAR_DATA>
  <ID>12345</ID>
  <MESSAGE>Hello World!</MESSAGE>
  <DATE>22/04/2009</DATE>
  <NAME>Fred</NAME>
</FOOBAR_DATA> 
```

In .Net, I can do something like this to bind my object to the data.

```
using System;
using System.Xml.Serialization;

    namespace FooBarData.Serialization
    {
      [XmlRoot("FOOBAR_DATA")]
      public class FooBarData
  {
    private int _ID = 0;
    [XmlElement("ID")]
    public int ID
    {
      get { return this._ID; }
      set { this._ID = value; }
    }

    private string _Message = "";
    [XmlElement("MESSAGE")]
    public string Message
    {
      get { return this._Message; }
      set { this._Message = value; }
    }

    private string _Name = "";
    [XmlElement("NAME")]
    public string Name
    {
      get { return this._Name; }
      set { this._Name = value; }
    }

    private Date _Date;
    [XmlElement("DATE")]
    public Date Date
    {
      get { return this._Date; }
      set { this._Date= value; }
    }

    public FooBarData()
    {
    }
  }
} 
```

I was wondering if there was a method using annotations, similar to .Net or perhaps Hibernate, that will allow me to bind my value object to the predefined-XML.

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-23T00:16:22.663

I like [XStream](http://xstream.codehaus.org/) alot, especially compared to JAXB - unlike JAXB, XStream doesn't need you to have an XSD. It's great if you have a handful of classes you want to serialize and deserialize to XML, without the heavy-handed-ness of needing to create a XSD, run jaxc to generate classes from that schema, etc. XStream on the other hand is pretty lightweight.

(Of course, there are plenty of times where JAXB is appropriate, such as when you have a pre-existing XSD that fits the occasion...)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-23T00:08:20.610

[JAXB](http://jaxb.java.net/) allows you to convert an XML Schema (XSD) file into a collection of Java classes. This may be more "structured" than the `XMLEncoder`/`Serializable` approach that Andy's (excellent, by the way) answer provides.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-23T00:07:44.557

Java has an [XMLEncoder](http://java.sun.com/products/jfc/tsc/articles/persistence4/index.html) that you might be able to use to serialize an object to XML. The only requirement is that your object implements "Serializable."

Here's an example:

[http://www.developer.com/java/web/article.php/1377961](http://www.developer.com/java/web/article.php/1377961)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-29T17:03:43.160

[JiBX](http://jibx.sourceforge.net/) is another option.

For more opinions on Java-to-XML data binding, see [XML serialization in Java?](https://stackoverflow.com/questions/35785/xml-serialization-in-java)

# c# - 在 WPF 中撤消/重做？

> ID：779758
> 
> 赞同：5
> 
> 时间：2009-04-23T00:04:52.693
> 
> 标签：c#, wpf, undo-redo

WPF 是否提供了处理撤消/重做的框架？如果没有，常见的方法是什么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2011-06-21T02:59:15.323

我已经为 WPF 应用程序实现了撤消/重做，并最终将我的撤消/重做代码发布到[http://muf.codeplex.com/](http://muf.codeplex.com/)。

您也可以通过 NuGet 获取它。只需寻找“MUF”或“Monitored Undo Framework”。它包括对 Silverlight 4.0 以及 .NET 3.5、4.0 和 WP7 的支持。

欢迎在 codeplex 网站 ( [http://muf.codeplex.com/](http://muf.codeplex.com/) ) 上发表评论和提问。您还可以在那里找到完整的文档和示例应用程序。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-04-18T08:35:27.263

从 .NET 3.0 开始，这是快速获取本地化名称、按键手势和一些功能的方法：

```
<MenuItem Command="ApplicationCommands.Redo"/>
<MenuItem Command="ApplicationCommands.Undo"/> 
```

但是，如果您不采取进一步行动，每个 TextBox 都会维护自己的撤消/重做列表，并且重做/撤消命令只会影响当前具有焦点的项目。必须有某种方法可以切换到单个窗口/应用程序范围的撤消/重做列表，但我刚刚开始搜索，主要是找到“如何自己编码”文章。

[但是这里](http://learnwpf.com/post/2007/06/05/Multi-Field-UndoRedo-in-WPF-using-Attached-Properties.aspx)描述的使用附加属性的技术似乎很有前途，并且可能很容易/稳定。

# javascript - 将代码拆分为多个文件以便于管理

> ID：779769
> 
> 赞同：2
> 
> 时间：2009-04-23T00:08:31.887
> 
> 标签：javascript, jquery

我目前正在使用 jQuery 编写一个在线应用程序，从几行代码开始，现在很快就超过了 1000 行。

我的代码结构很简单。我有一个 window.load 包装了我的 javascript，在其中我开始添加我的 click 事件处理程序，以及构成我的应用程序的各种函数。

```
$(window).load(function(){
   // Code goes here...
}); 
```

我的代码功能绝对可以归类；例如，5 个函数执行动画，12 个是事件处理程序，等等。

我想将函数分组在他们自己的 js 文件中，并单独导入它们。稍后我可以使用我的 CMS 引擎即时连接和压缩文件。

这样做的最佳方法是什么。我在想，也许我可以给我的一些函数自己的命名空间以进一步清晰；例如，所有动画函数都以 ANIMATION 为前缀 - ANIMATION.moveDiv1()、ANIMATION.moveDiv2、MYEVENT.div1Clicked 等。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-23T00:33:13.497

为了便于阅读，我通常将所有相关项目粘贴到它们自己的文件中，并使用与文件匹配的命名空间。

示例文件可能如下所示：

Example.js

```
var Animation = {}; // create the namespace-like object
Animation.moveDiv1 = function() {...};
Animation.moveDiv2 = function() {...}; 
```

确实有很多方法可以做到这一点。说到压缩，有一些不错的工具可以用来压缩东西。查看[YUI 压缩机](http://developer.yahoo.com/yui/compressor/)

模块化是 Javascript 的一个很好的目标，但我想说下一个级别将是实际使用一些 Javascript OO 技术。如果您的应用程序足够简单，那么您可以不用它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-23T01:13:00.220

1.  您的代码文件应该反映您的类。
2.  你的类应该遵循良好的面向对象设计原则。

就浏览器中的加载时间而言，kekoav 和 knut 的想法是正确的 - 只需使用 YUI 或其他脚本压缩器/压缩器（以及可选的混淆器），将它们组合到一个文件中，然后从单个脚本包含指令中加载它们.

我还想看看 JS 你的类的原型属性 - 如果它们变得越来越大并且你正在创建它们的多个实例，你将开始看到通过将你的公共（以及可选的私有）的显着性能提升/privileged) 方法到类原型中。

你绝对应该为你的类使用完全限定的命名空间，或者使用微软的 Type.registerNamespace 如果你使用他们的 AJAX 解决方案，根据 kekoav 的帖子声明你自己的命名空间函数，或者使用谷歌将提供的其他类似方法.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-23T00:30:54.127

从应用程序管理的角度来看是个好主意，从加载时间的角度来看是个坏主意。浏览器必须同步加载所有这些小脚本，因此要加载每个额外的脚本需要更多时间。这不包括主要的 jQuery 库脚本、jQuery UI 以及您计划在文档中包含的任何其他内容。测试这两个前提：将函数抽象到它们自己的单独脚本中并加载它们，而不是一个只需要一次调用即可加载的大脚本。更进一步，缩小“一个大脚本”，再进一步，确保它作为压缩文件提供。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-23T00:32:19.520

您可以在开发时将 JavaScript 文件拆分为类，但您应该组合您的脚本，并在生产环境中最小化它们。请查看[YUI Compressor](http://developer.yahoo.com/yui/compressor/)以获取更多信息。

# ruby-on-rails - 如何从 rails 控制器操作发出 404 响应？

> ID：779784
> 
> 赞同：45
> 
> 时间：2009-04-23T00:13:55.323
> 
> 标签：ruby-on-rails

从 rails 控制器操作发出 404 响应的首选方法是什么？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-04-23T00:35:47.877

这个好像不错...

```
# Rails 2 and below
render :file => "#{RAILS_ROOT}/public/404.html",  :status => 404

# Rails 3 and up
render :file => "#{Rails.root}/public/404.html",  :status => 404 
```

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2011-02-01T07:42:33.757

你也可以

`raise ActiveRecord::RecordNotFound`

例外。

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2013-05-23T10:01:50.540

以下方式对我来说是最好的：

```
raise ActionController::RoutingError.new('Not Found') 
```

要不就

```
raise ActionController::RoutingError, 'Not Found' 
```

或者还有其他一些解决方案： [如何在 Rails 中重定向到 404？](https://stackoverflow.com/questions/2385799/how-to-redirect-to-a-404-in-rails)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-23T00:36:26.190

[参考](http://www.tutorialspoint.com/ruby-on-rails/rails-render.htm)：

```
render :file => '/path/to/some/filenotfound.rhtml', 
                status => 404, :layout => true 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-04-24T07:33:01.020

在 ApplicationController 中定义一个方法，如：

```
def render_404
  render :file => "#{RAILS_ROOT}/public/404.html",  :status => 404
end 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2018-06-11T22:34:32.733

在 Rails 5 中，您可以使用

```
head 404 
```

这会将您的操作的响应代码设置为`404`. 如果您在此之后立即从您的操作方法返回，您的操作将响应`404`没有实际的正文。这在您开发 API 端点时可能很有用，但对于最终用户 HTTP 请求，您可能更喜欢一些可见的主体来通知用户错误。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-10-03T00:04:12.777

如果你想在重定向时发出状态码（例如 302），你可以把它放在`routes.rb`:中
`get "/somewhere", to: redirect("/somewhere_else", status: 302)`。
但是，这仅适用于重定向，而不是直接加载页面。

# c# - 按颜色/颜色范围浏览图像：需要示例和/或代码

> ID：779788
> 
> 赞同：1
> 
> 时间：2009-04-23T00:14:33.463
> 
> 标签：c#, asp.net, actionscript, graphics, colors

我记得在很久以前的一些 Flash 会议上，我看到了一个带有颜色选择器的 Flash 应用程序的演示。根据用户的颜色选择，应用程序将向用户显示该颜色的大致范围内的一组图像：一堆大部分是红色的图像，一堆大部分是蓝色的图像等。

我正在寻找两件事：1) 指向此类应用程序演示的链接，最好是 Flash 应用程序 2) 描述如何挑选一组颜色范围内的图像的 ActionScript 或 C# 代码。

我知道如何从单个图像中提取聚合/平均 RGB 并将此信息保存到数据库中。我需要知道如何在一定的颜色容差范围内准确地选择图像。这可以纯粹使用 SQL 和 RGB 颜色代码的字母数字分配知识来完成，还是有更好的方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-23T04:05:45.717

我找不到任何示例代码，但找到了[一篇](http://www.ideeinc.com/products/piximilar/)对其过程进行高级解释的文章（来自有关 Flickr 搜索具有相似颜色的图像的功能的其他[页面）。](http://www.readwriteweb.com/archives/search_flickr_images_by_color_with_multicolr_search_lab.php)显然，[谷歌](http://images.google.com/images?hl=en&q=red+car&btnG=Search+Images&gbv=2&aq=f&oq=)还允许你通过他们的图像搜索来做到这一点（但我不知道这是来自元数据标签还是实际颜色匹配）。

现在到实际答案：

您需要存储图像的“颜色签名”，而不是仅仅存储图像的平均或聚合颜色。

我的第一个（有根据的猜测）想法需要以下步骤：

1.  从图像中生成每个色带的直方图
2.  生成一些描述每条直方图曲线的因素（均值、方差、标准差等？——这些因素将构成图像的数字签名）
3.  将这些因素存储在您的数据库中（并且这些因素中的每一个都将在数据库中具有一个索引）

然后，您将获取您的输入（颜色、颜色范围或源图像），针对该源运行直方图算法，并搜索与您的计算因子匹配的内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T23:15:39.150

我在评论中引用的 Flickr Hacks 解决方案是我发现的最好的解决方案：它涉及使用通用算法将图像大小调整为 1x1 像素，从而为您提供整个图像的平均颜色。聪明的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-24T22:31:19.470

您可以为每个图像使用一组描述符，然后匹配它们。

这里有一些很棒的工作......对于C＃。

[http://savvash.blogspot.com/p/compact-composite-descriptors.html](http://savvash.blogspot.com/p/compact-composite-descriptors.html)

还可以查看免费的 img(Rummager) 工具。它可以做你想做的事情（即找到与颜色匹配的图像）。

# sql-server - 将 SQL Server 2000 升级到 2005 或 2008 - DTS 到 SSIS

> ID：779789
> 
> 赞同：5
> 
> 时间：2009-04-23T00:14:38.083
> 
> 标签：sql-server, sql-server-2005, ssis, upgrade, dts

我们的办公室使用 SQL Server 2000，总的来说它很好地满足了我们的需求。我正在研究升级到 SQL 2005 或 2008 的可能性，因为 2000 年没有发现新功能（当我看到索引使用统计数据告诉我哪些索引是最常用的，哪些从未使用过，这让我大吃一惊） .

我不太关心如何将数据库从 2000 年移动到 2005 年或 2008 年 - 我可以进行完整备份，然后将备份恢复到新的 sql 安装。我担心的是现有的 DTS 包。我们每天都依赖其中的几十个。将现有的 DTS 包转换为 SSIS 有多难/容易？我必须注意哪些“陷阱”？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-23T04:56:48.263

进行备份和恢复以进行数据库服务器升级有很多问题。最好进行就地升级（您可能希望先对服务器进行完整备份）并让 MS 安装程序完成工作。2005 支持 2000 个 DTS 包作为旧版，因此无需学习 SSIS 并转换所有包，除非您有时间并且没有太多。

至于备份和恢复升级，不要忘记：

1.  登录，您需要传输这些，请参阅[KB246133](http://ttp://support.microsoft.com/default.aspx/kb/246133)了解更多详细信息
2.  授予系统数据库的任何用户和角色权限都需要重新创建或转移
3.  链接服务器或远程服务器将需要重新设置
4.  SQL Server 代理作业需要导出-导入
5.  任何扩展存储过程都需要重新创建
6.  需要重新设置复制
7.  日志传送需要重新设置，备用服务器也需要升级

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-23T00:24:06.297

有一个用于 DTS 包的迁移工具，但我不会使用它。SSIS比 DTS 好得多，您应该*：*

1.  了解 SSIS。适应它。为拥有实际的控制流程而高兴。
2.  花点时间了解和记录您现有的 DTS 包，同时您仍然拥有它们所针对的环境。
3.  使用这种理解来编写等效的 SSIS 包。

如果您不了解 SSIS，那么这个想法对您来说毫无意义。例如，我只是在想我过去是如何在 DTS 中进行循环的——整个业务都是查找和修改您想要循环回的优先约束。

SSIS 实际上有一个 For Loop 容器，它可以遍历一组数字、行集中的行、文件夹中的文件等。没有优先约束和少量隐藏脚本的黑客攻击。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-23T00:23:06.453

只要安装了向后兼容性，DTS 包在 2008 年仍然可以照常运行。这是使用向导进行[升级](http://msdn.microsoft.com/en-us/library/cc768544.aspx)的链接。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-23T14:05:58.253

我会推荐一个来自 Pragmatic Works 的名为 DTS xChange 的工具。它处理大部分迁移并帮助您继续工作。您将有其他机会在新事物上学习 SSIS，但您可能需要结束您的项目。可在[http://www.pragmaticworks.com下载](http://www.pragmaticworks.com)

# c++ - 性能：类的向量或包含向量的类

> ID：779791
> 
> 赞同：2
> 
> 时间：2009-04-23T00:15:25.147
> 
> 标签：c++, performance, arrays, stl

我有一个包含许多双精度值的类。这存储在一个向量中，其中类的索引很重要（它们是从其他地方引用的）。该类看起来像这样：

## 类向量

```
class A
{
  double count;
  double val;
  double sumA;
  double sumB;

  vector<double> sumVectorC;
  vector<double> sumVectorD;
}

vector<A> classes(10000); 
```

需要尽可能快地运行的代码是这样的：

```
vector<double> result(classes.size());
for(int i = 0; i < classes.size(); i++)
{
  result[i] += classes[i].sumA;
  vector<double>::iterator it = find(classes[i].sumVectorC.begin(), classes[i].sumVectorC.end(), testval);
  if(it != classes[i].sumVectorC.end())
    result[i] += *it;
} 
```

另一种方法是代替一个巨大的循环，将计算分成两个单独的循环，例如：

```
for(int i = 0; i < classes.size(); i++)
{
  result[i] += classes[i].sumA;
}
for(int i = 0; i < classes.size(); i++)
{
 vector<double>::iterator it = find(classes[i].sumVectorC.begin(), classes[i].sumVectorC.end(), testval);
  if(it != classes[i].sumVectorC.end())
    result[i] += *it;
} 
```

或将类的每个成员存储在一个向量中，如下所示：

## 向量类

```
vector<double> classCounts;
vector<double> classVal;
...
vector<vector<double> > classSumVectorC;
... 
```

然后操作为：

```
for(int i = 0; i < classes.size(); i++)
{
  result[i] += classCounts[i];
  ...
} 
```

哪种方式通常更快（跨 x86/x64 平台和编译器）？前瞻和缓存行是这里要考虑的最重要的事情吗？

## 更新

我在这里进行线性搜索（即查找）而不是哈希映射或二进制搜索的原因是 sumVectors 非常短，大​​约有 4 或 5 个元素。分析显示哈希映射较慢，二分查找稍慢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-23T00:38:17.947

由于这两种变体的实现似乎很容易，我会构建这两个版本并分析它们以找到最快的版本。

经验数据通常胜过猜测。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-23T08:49:28.203

作为一个附带问题：目前，`find()`最里面的循环对所有元素进行线性扫描，`classes[i].sumVectorC`直到找到匹配的值。如果该向量包含许多值，并且您没有理由相信它`testVal`出现在向量的开头附近，那么这将很慢 - 考虑使用具有更快查找速度的容器类型（例如`std::map`，或非标准但通常实现的`hash_map`类型之一）。

作为一般准则：**在低级实现优化之前考虑算法改进。**

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-23T00:52:18.180

正如lothar 所说，您真的应该对其进行测试。但是要回答您的最后一个问题，是的，缓存未命中将是这里的主要问题。

此外，您的第一个实现似乎会遇到编码时的加载命中存储停顿，但我不确定 x86 上存在多少问题（这是 XBox 360 和 PS3 上的一个大问题）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-23T13:15:34.023

看起来优化 find() 将是一个巨大的胜利（肯定知道配置文件）。根据不同的大小，除了用另一个容器替换向量之外，您还可以尝试对 sumVectorC 进行排序并使用 lower_bound 形式的二进制搜索。这会将你的线性搜索 O(n) 变成 O(log n)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-26T02:36:02.043

如果您可以保证这`std::numeric_limits<double>::infinity`不是一个可能的值，请确保数组在最后使用虚拟无限条目进行排序，然后手动编码查找，以便循环条件是单个测试：

```
 array[i]<test_val 
```

然后是平等测试。

那么您知道在未找到的情况下，查看值的平均数量为 (size()+1)/2。当然，如果搜索数组变化非常频繁，那么保持排序的问题就是一个问题。

当然，关于 sumVectorC 或 A 的其余部分，您并没有告诉我们太多，因此很难确定并给出真正好的建议。例如，如果 sumVectorC 永远不会更新，那么可能会找到一个非常便宜的哈希（例如，强制转换 ULL 和位提取），它在 sumVectorC 值上完美，适合 double[8]。然后开销是位提取和 1 与 3 或 6 的比较

此外，如果您对 sumVectorC.size() 有一个合理的界限（您提到了 4 或 5，所以这个假设似乎还不错），您可以考虑使用聚合数组甚至只是 a`boost::array<double>`并添加您自己的动态大小，例如：

```
class AggregatedArray : public boost::array<double>{
   size_t _size;
   size_t size() const {
      return size;
   }
   ....
   push_back(..){...
   pop(){...
   resize(...){...
}; 
```

这消除了对 sumVectorC 分配的数组数据的额外缓存行访问。

在 sumVectorC 非常不经常更新的情况下，如果找到一个完美的哈希（在您的哈希算法类别之外）相对便宜，那么当 sumVectorC 更改时您可以从中获利。这些小的查找可能是有问题的，算法复杂性通常是无关紧要的——它是占主导地位的常量。这是一个工程问题，而不是理论问题。

除非您可以保证小地图在缓存中，否则几乎可以保证使用 std::map 会产生大约 130% 的性能下降，因为树中的每个节点都将位于单独的缓存行中

因此，每次搜索不会访问 (4 × 1+1 × 2)/5 = 1.2 个缓存行（前 4 个在第一个缓存行中，第 5 个在第二个缓存行中，您将访问 (1 + 2 times 2 + 2 times 3 ) = 9/5) + 1 表示树本身 = 每次搜索 2.8 个缓存线（1 是根节点的 1 个节点，2 个节点是根节点的子节点，最后 2 个节点是根节点的孙子节点，加上树本身）

因此，对于具有 5 个条目的 sumVectorC，我预测使用 std::map 需要 2.8/1.2 = 233%

这就是我说的意思：“这是一个工程问题，而不是理论问题。”

# java - 从 Java 查询 Windows 搜索

> ID：779793
> 
> 赞同：6
> 
> 时间：2009-04-23T00:15:42.260
> 
> 标签：java, windows-search

我想从 Java 直接（或间接）查询 Windows Vista 搜索服务。

我知道可以使用 search-ms: 协议进行查询，但我想在应用程序中使用结果。

我在[Windows Search API](http://msdn.microsoft.com/en-us/library/aa906096.aspx)中找到了很好的信息， 但没有与 Java 相关的信息。

我会将提供有关如何实现此目标的有用和明确信息的答案标记为已接受。

提前致谢。

**编辑**

在我将其标记为已接受之前，是否有人有 JACOB 样本？:)

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-25T00:42:36.927

您可能想查看其中一种 Java-COM 集成技术。我曾亲自与 JACOB (JAva COM Bridge) 合作过：

*   [http://danadler.com/jacob/](http://danadler.com/jacob/)

这相当麻烦（想想只使用反射），但为我完成了工作（快速概念证明，从 Java 中访问 MapPoint）。

我知道的唯一其他此类技术是 Jawin，但我没有任何个人经验：

*   [http://jawinproject.sourceforge.net/](http://jawinproject.sourceforge.net/)

**2009 年 4 月 26 日更新：** 为了它，我对 Microsoft Windows 搜索进行了更多研究，并找到了一种使用 OLE DB 与其集成的简单方法。这是我编写的一些代码作为概念证明：

```
public static void main(String[] args) {
    DispatchPtr connection = null;
    DispatchPtr results = null;
    try {
        Ole32.CoInitialize();
        connection = new DispatchPtr("ADODB.Connection");
        connection.invoke("Open",
            "Provider=Search.CollatorDSO;" +
            "Extended Properties='Application=Windows';");
        results = (DispatchPtr)connection.invoke("Execute",
            "select System.Title, System.Comment, System.ItemName, System.ItemUrl, System.FileExtension, System.ItemDate, System.MimeType " +
            "from SystemIndex " +
            "where contains('Foo')");
        int count = 0;
        while(!((Boolean)results.get("EOF")).booleanValue()) {
            ++ count;
            DispatchPtr fields = (DispatchPtr)results.get("Fields");
            int numFields = ((Integer)fields.get("Count")).intValue();

            for (int i = 0; i < numFields; ++ i) {
                DispatchPtr item =
                    (DispatchPtr)fields.get("Item", new Integer(i));
                System.out.println(
                    item.get("Name") + ": " + item.get("Value"));
            }
            System.out.println();
            results.invoke("MoveNext");
        }
        System.out.println("\nCount:" + count);
    } catch (COMException e) {
        e.printStackTrace();
    } finally {
        try {
            results.invoke("Close");
        } catch (COMException e) {
            e.printStackTrace();
        }
        try {
            connection.invoke("Close");
        } catch (COMException e) {
            e.printStackTrace();
        }
        try {
            Ole32.CoUninitialize();
        } catch (COMException e) {
            e.printStackTrace();
        }
    }
} 
```

要编译它，您需要确保 JAWIN JAR 在您的类路径中，并且 jawin.dll 在您的路径中（或 java.library.path 系统属性）。此代码仅打开到本地 Windows 桌面搜索索引的 ADO 连接，使用关键字“Foo”查询文档，并在结果文档上打印出一些关键属性。

如果您有任何问题，或者需要我澄清任何事情，请告诉我。

**2009 年 4 月 27 日更新：** 我也尝试在 JACOB 中实现相同的功能，并将做一些基准测试来比较两者之间的性能差异。我可能在 JACOB 中做错了什么，但它似乎一直在使用 10 倍以上的内存。如果我有时间的话，我也会研究 jcom 和 com4j 的实现，并尝试找出一些我认为是由于某处缺乏线程安全而导致的怪癖。我什至可以尝试基于 JNI 的解决方案。我希望在 6-8 周内完成所有工作。

**2009 年4 月 28 日更新：** 这只是针对那些一直在关注和好奇的人的更新。事实证明没有线程问题，我只需要显式关闭我的数据库资源，因为 OLE DB 连接可能是在操作系统级别汇集的（我可能应该已经关闭了连接......）。我认为我不会对此进行任何进一步的更新。如果有人遇到任何问题，请告诉我。

**2009 年 5 月 1 日更新：** 根据 Oscar 的要求添加了 JACOB 示例。从 COM 的角度来看，这经历了完全相同的调用序列，只是使用了 JACOB。虽然最近 JACOB 确实得到了更积极的工作，但我也注意到它非常消耗内存（使用的内存是 Jawin 版本的 10 倍）

```
public static void main(String[] args) {
    Dispatch connection = null;
    Dispatch results = null;

    try {
        connection = new Dispatch("ADODB.Connection");
        Dispatch.call(connection, "Open",
            "Provider=Search.CollatorDSO;Extended Properties='Application=Windows';");
        results = Dispatch.call(connection, "Execute",
            "select System.Title, System.Comment, System.ItemName, System.ItemUrl, System.FileExtension, System.ItemDate, System.MimeType " +
            "from SystemIndex " +
            "where contains('Foo')").toDispatch();
        int count = 0;
        while(!Dispatch.get(results, "EOF").getBoolean()) {
            ++ count;
            Dispatch fields = Dispatch.get(results, "Fields").toDispatch();
            int numFields = Dispatch.get(fields, "Count").getInt();

            for (int i = 0; i < numFields; ++ i) {
                Dispatch item =
                    Dispatch.call(fields, "Item", new Integer(i)).
                    toDispatch();
                System.out.println(
                    Dispatch.get(item, "Name") + ": " +
                    Dispatch.get(item, "Value"));
            }
            System.out.println();
            Dispatch.call(results, "MoveNext");
        }
    } finally {
        try {
            Dispatch.call(results, "Close");
        } catch (JacobException e) {
            e.printStackTrace();
        }
        try {
            Dispatch.call(connection, "Close");
        } catch (JacobException e) {
            e.printStackTrace();
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-28T13:55:23.797

正如这里的一些帖子建议您可以使用商业或免费框架（如 JACOB、JNBridge、J-Integra 等）在 Java 和 .NET 或 COM 之间架起一座桥梁。实际上，我曾与这些第三方之一合作过（一个昂贵的 :-) ) 而且我必须说我会尽我所能避免以后再犯这个错误。原因是它涉及许多你无法真正调试的“巫毒”东西，当出现问题时理解问题是非常复杂的。

我建议您实施的解决方案是创建一个简单的 .NET 应用程序，该应用程序对 Windows 搜索 API 进行实际调用。这样做之后，您需要在该组件和您的 Java 代码之间建立一个通信通道。这可以通过多种方式完成，例如通过向应用程序定期提取的小型数据库发送消息。或者在机器 IIS（如果存在）上注册此组件并公开简单的 WS API 以与之通信。

我知道这听起来可能很麻烦，但明显的优势是：a）您使用 Windows 搜索 API 使用它理解的语言（.NET 或 COM）进行通信，b）您控制所有应用程序路径。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-25T00:29:36.253

有什么理由不能只使用命令的结果`Runtime.exec()`来查询`search-ms`并读取`BufferedReader`命令的结果？例如：

```
public class ExecTest {
    public static void main(String[] args) throws IOException {
        Process result = Runtime.getRuntime().exec("search-ms:query=microsoft&");

        BufferedReader output = new BufferedReader(new InputStreamReader(result.getInputStream()));
        StringBuffer outputSB = new StringBuffer(40000);
        String s = null;

        while ((s = output.readLine()) != null) {
            outputSB.append(s + "\n");
            System.out.println(s);
        }

        String result = output.toString();
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-26T17:14:26.503

有几个库用于从 java 调用 COM 对象，一些是开源的（但它们的学习曲线更高）一些是闭源的并且具有更快的学习曲线。一个封闭源代码的例子是[EZCom](http://www.ezjcom.com/download.html)。商业的也倾向于专注于从 Windows 调用 java，这是我在开源中从未见过的。

在你的情况下，我建议你做的是在你自己的 .NET 类中调用（我想使用 C#，因为它最接近 Java，而不涉及有争议的 J#），并专注于与 .NET dll 的互操作性. 这样windows编程就更容易了，windows和java的接口也更简单了。

如果您正在寻找如何使用 java com 库，MSDN 是错误的地方。但是 MSDN 将帮助您从 .NET 中编写所需的内容，然后查看 com 库教程，了解如何从 .NET 对象中调用您需要的一两个方法。

编辑：

鉴于答案中有关使用 Web 服务的讨论，您可以（并且可能会有更好的运气）构建一个调用嵌入式 Java Web 服务器的小型 .NET 应用程序，而不是尝试让 .NET 具有嵌入式 Web 服务，并拥有java 是调用的消费者。对于嵌入式 Web 服务器，我的研究表明[Winstone](http://winstone.sourceforge.net/)非常好。不是最小的，但更灵活。

使其工作的方法是从 java 启动 .NET 应用程序，并让 .NET 应用程序在计时器或循环上调用 Web 服务以查看是否有请求，如果有，处理并发送响应。

# algorithm - 如何在不将文件存储在内存中的情况下从文件中读取 N 个随机行？

> ID：779797
> 
> 赞同：9
> 
> 时间：2009-04-23T00:16:46.237
> 
> 标签：algorithm, random

我熟悉[从文件中读取单个随机行而不将整个文件读入内存的算法](http://perldoc.perl.org/perlfaq5.html#How-do-I-select-a-random-line-from-a-file%3f)。我想知道这种技术是否可以扩展到 N 条随机线？

用例是一个密码生成器，它连接从字典文件中提取的 N 个随机单词，每行一个单词（如`/usr/share/dict/words`）。你可能会想出`angela.ham.lewis.pathos`. 现在它将整个字典文件读入一个数组并从该数组中选择 N 个随机元素。我想消除数组或文件的任何其他内存存储，并且只读取一次文件。

（不，这不是一个实际的优化练习。我对算法感兴趣。）

**更新**：谢谢大家的回答。

答案分为三类：完整读取算法的修改、随机搜索或索引行并随机搜索。

随机搜索要快得多，并且相对于文件大小是恒定的，但根据文件大小而不是字数进行分布。它还允许重复（可以避免但它使算法 O(inf)）。这是我使用该算法重新实现我的密码生成器。我意识到，通过从查找点向前而不是向后读取，如果查找落在最后一行，它就会出现一个错误。更正留给编辑作为练习。

```
#!/usr/bin/perl -lw

my $Words       = "/usr/share/dict/words";
my $Max_Length  = 8;
my $Num_Words   = 4;

my $size = -s $Words;

my @words;
open my $fh, "<", $Words or die $!;

for(1..$Num_Words) {
    seek $fh, int rand $size, 0 or die $!;
    <$fh>;
    my $word = <$fh>;
    chomp $word;
    redo if length $word > $Max_Length;
    push @words, $word;
}
print join ".", @words; 
```

然后是 Guffa 的答案，这就是我想要的；原始算法的扩展。速度较慢，它必须读取整个文件，但按单词分发，允许过滤而不改变算法的效率，并且（我认为）没有重复。

```
#!/usr/bin/perl -lw

my $Words       = "/usr/share/dict/words";
my $Max_Length  = 8;
my $Num_Words   = 4;

my @words;
open my $fh, "<", $Words or die $!;
my $count = 0;
while(my $line = <$fh>) {
    chomp $line;
    $count++;
    if( $count <= $Num_Words ) {
        $words[$count-1] = $line;
    }
    elsif( rand($count) <= $Num_Words ) {
        $words[rand($Num_Words)] = $line;
    }
}

print join ".", @words; 
```

最后，索引和查找算法具有按字而不是文件大小分布的优点。缺点是它读取整个文件，内存使用量与文件中的字数成线性关系。不妨使用 Guffa 的算法。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-23T00:45:30.457

该算法在该示例中没有以非常好的和清晰的方式实现......一些更好地解释它的伪代码是：

```
cnt = 0
while not end of file {
   read line
   cnt = cnt + 1
   if random(1 to cnt) = 1 {
      result = line
   }
} 
```

如您所见，这个想法是您读取文件中的每一行并计算该行应该是所选行的概率。读第一行后概率为 100%，读第二行后概率为 50%，以此类推。

这可以扩展为选择 N 个项目，方法是保持一个大小为 N 的数组而不是单个变量，并计算一行替换数组中当前行之一的概率：

```
var result[1..N]
cnt = 0
while not end of file {
   read line
   cnt = cnt + 1
   if cnt <= N {
      result[cnt] = line
   } else if random(1 to cnt) <= N {
      result[random(1 to N)] = line
   }
} 
```

编辑：
这是用 C# 实现的代码：

```
public static List<string> GetRandomLines(string path, int count) {
    List<string> result = new List<string>();
    Random rnd = new Random();
    int cnt = 0;
    string line;
    using (StreamReader reader = new StreamReader(path)) {
        while ((line = reader.ReadLine()) != null) {
            cnt++;
            int pos = rnd.Next(cnt);
            if (cnt <= count) {
                result.Insert(pos, line);
            } else {
                if (pos < count) {
                    result[pos] = line;
                }
            }
        }
    }
    return result;
} 
```

我通过运行该方法 100000 次进行测试，从 20 行中挑选 5 行，并计算行的出现次数。这是结果：

```
25105
24966
24808
24966
25279
24824
25068
24901
25145
24895
25087
25272
24971
24775
25024
25180
25027
25000
24900
24807 
```

如您所见，分布是您所希望的。:)

（我`Random`在运行测试时将对象的创建移出方法，以避免播种问题，因为种子是从系统时钟中获取的。）

注意：
如果您希望它们被随机排序，您可能需要打乱结果数组中的顺序。由于前 N 行在数组中是按顺序放置的，所以如果它们留在最后，它们就不是随机放置的。例如，如果 N 为 3 或更大并且选择了第三行，它将始终位于数组中的第三个位置。

编辑 2：
我将代码更改为使用 a`List<string>`而不是 a `string[]`。这使得以随机顺序插入前 N 个项目变得容易。我从新的测试运行中更新了测试数据，以便您可以看到分布仍然很好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-23T00:23:48.997

这是我第一次看到一些 Perl 代码……令人难以置信的不可读……；）但这不重要。你为什么不把神秘的台词重复 N 次？

如果我必须写这个，我只会在文件中寻找一个随机位置，读取到行尾（下一个换行符），然后将一行读取到下一个换行符。如果您只是寻找最后一行，请添加一些错误处理，重复所有这些 N 次，您就完成了。我猜

```
srand;
rand($.) < 1 && ($line = $_) while <>; 
```

是执行这样一个步骤的 Perl 方式。您还可以从初始位置向后读取到 priviouse 换行符或文件的开头，然后再次向前读取一行。但这并不重要。

**更新**

我不得不承认，由于行长不同，在文件中寻找某个地方不会产生完美的均匀分布。当然，这种波动是否重要取决于使用场景。

如果您需要完美的均匀分布，则需要至少读取整个文件一次以获取行数。在这种情况下，Guffa 给出的算法可能是最聪明的解决方案，因为它需要只读取一次文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-23T00:30:53.923

现在我的 Perl 不再像以前那样了，但相信你的引用的隐含声明（这样选择的行号的分布是统一的），看起来这应该有效：

```
srand;
(rand($.) < 1 && ($line1 = $_)) || (rand($.) <1 && ($line2 = $_)) while <>; 
```

就像原始算法一样，这是一次性的和恒定的内存。

**编辑** 我刚刚意识到你需要 N，而不是 2。如果你事先知道 N，你可以重复 OR-ed 表达式 N 次。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-01-21T21:04:08.600

如果您不需要在 Perl 范围内执行此操作，则[shuf](https://www.gnu.org/software/coreutils/manual/html_node/shuf-invocation.html)是一个非常好的命令行实用程序。做你想做的事：

`$ shuf -n N file > newfile`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-23T00:50:48.823

快速而肮脏的 bash

```
function randomLine {
  numlines=`wc -l $1| awk {'print $1'}`
  t=`date +%s`
  t=`expr $t + $RANDOM`
  a=`expr $t % $numlines + 1`
  RETURN=`head -n $a $1|tail -n 1`
  return 0
}

randomLine test.sh
echo $RETURN 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-23T01:06:11.810

在文件中选择一个随机点，向后查找先前的 EOL，向前搜索当前的 EOL，然后返回该行。

```
FILE * file = fopen("words.txt");
int fs = filesize("words.txt");
int ptr = rand(fs); // 0 to fs-1
int start = min(ptr - MAX_LINE_LENGTH, 0);
int end = min(ptr + MAX_LINE_LENGTH, fs - 1);
int bufsize = end - start;

fseek(file, start);
char *buf = malloc(bufsize);
read(file, buf, bufsize);

char *startp = buf + ptr - start;
char *finp = buf + ptr - start + 1;

while (startp > buf  && *startp != '\n') {
    startp--;
}

while (finp < buf + bufsize && *finp != '\n') {
    finp++;
}

*finp = '\0';
startp++;
return startp; 
```

那里有很多一次性错误和废话，糟糕的内存管理和其他可怕的事情。如果这真的编译，你会得到一个五分钱。（请寄回邮编地址的信封和 5 美元的手续费，以获得免费的镍。）

但你应该明白这一点。

在统计上，较长的行比较短的行更有可能被选中。但是无论文件大小如何，它的运行时间实际上都是恒定的。如果你有很多长度基本相似的单词，统计学家不会高兴（他们永远不会），但实际上它会足够接近。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-04-23T00:24:44.937

我会说：

*   读取文件并搜索`\n`. 这就是行数 - 我们称之为`L`
*   将它们的位置存储在内存中的一个小数组中
*   获取两个低于 的随机行`L`，获取它们的偏移量，然后就完成了。

您只需使用一个小数组，然后读取整个文件一次 + 2 行。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2009-04-23T00:25:01.020

你可以做一个2遍算法。首先获取每个换行符的位置，将这些位置推入一个向量。然后在该向量中选择随机项目，称之为 i。

从位置 v[i] 到 v[i+1] 的文件中读取以获取您的行。

在第一次通过时，您使用小缓冲区读取文件，以免一次将其全部读入 RAM。

# java - 为什么 Java 没有众所周知的系统属性名称的常量？

> ID：779825
> 
> 赞同：15
> 
> 时间：2009-04-23T00:32:17.540
> 
> 标签：java, api, properties, constants

**java.lang.System**类定义了许多[众所周知的](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/System.html#getProperties())属性。

例如，您可以通过查找“java.io.tmpdir”属性来获取 JVM 的临时目录：

```
... = System.getProperty("java.io.tmpdir"); 
```

我不明白为什么这些属性没有被定义为常量（例如在 java.lang.System 类中）。这将比使用文字字符串更不容易出错。换句话说，我希望能够做到这一点：

```
... = System.getProperty(System.JAVA_IO_TMPDIR); 
```

任何想法为什么没有这样做？它甚至可以在不破坏向后兼容性的情况下添加到 Java 的未来版本中。还是我错过了一些明显的东西？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-23T00:44:21.287

我的猜测是 Sun 不想提交一组预定义的系统属性。如果它们未定义为常量，则它们可以随时添加系统属性（即使它们仅发布 JDK 的增量版本，例如从 1.4.1 到 1.4.2）。

**编辑：**
任何预定义的常量都必须被视为 API 的一部分。因此，即使更改常量的数量也是 API 更改。通过不定义任何常量，Sun 可以在不引入 API 更改的情况下定义新的系统属性。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-23T01:23:50.880

[System.getProperties()](http://java.sun.com/javase/6/docs/api/java/lang/System.html#getProperties() "System.getProperties()")下记录的所有属性都是标准化的——每个 Java SE 实现都必须提供它们。Java 7 没有理由不能为这些标准属性名称引入常量。它不会阻止引入新的属性。我认为这只是没有人认为值得付出努力（即使是对核心 Java API 的微不足道的添加也必须经过我认为的过程）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-09-09T14:43:14.053

很棒的[Google Guava 库](https://code.google.com/p/guava-libraries/)最近为系统属性引入了常量：参见[http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/base/StandardSystemProperty.html](http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/base/StandardSystemProperty.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-07-25T09:02:49.967

为了完整起见，Apache commons lang 有[SystemUtils](http://commons.apache.org/proper/commons-lang/javadocs/api-release/org/apache/commons/lang3/SystemUtils.html)类，它提供了公共常量和预定义的方法。

这已经存在好几年了，很有可能您已经在使用 commons lang（2 或 3）。

```
SystemUtils.getUserHome();
SystemUtils.getJavaIoTmpDir();
SystemUtils.JAVA_IO_TMPDIR;
SystemUtils.USER_HOME; 
```

* * *

## 回答 #5

> 赞同：-5
> 
> 时间：2009-04-23T00:55:06.270

a`"literal"`和 a 和有什么不一样`LITERAL`？

两个字符：`"`和`"`。

不明白为什么`LITERAL`在同样有效的情况下还要发明一组复杂的 s `"literal"`。

# jquery - 我可以像数据库记录一样在 HTML DOM 中存储自定义属性吗？

> ID：779832
> 
> 赞同：10
> 
> 时间：2009-04-23T00:34:00.063
> 
> 标签：jquery, html, dom, jquery-ui, browser

使用 jQuery 为浏览器 FF3 和 IE6/7 开发时，在 HTML 标签上设置自定义属性时是否存在兼容性问题？

首先，我知道 jQuery 的`data()`功能，它基本上可以满足我的要求，但数据无法在`clone()`功能中存活。这是使用 jQuery UI 可拖放/可拖放插件时的一个问题，因为它会在拖放过程中克隆 DOM 元素。出于这个问题的目的，我需要一个`data()`.

我想在拖放操作之间保留数据。我希望能够将数据注入到在拖放操作期间移动的 DOM 元素中。为此，我可以构建 HTML 子元素来模拟数据库记录。快速实验表明，Firefox 使用我想要存储数据字段的任何属性名称都没有问题。但是，HTML 4 规范说某些标签只能包含某些属性名称。使用非标准属性填充 DOM 会导致与我提到的浏览器不兼容的问题吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-23T00:43:19.200

看看我不久前问过的类似问题：[我可以在我的 HTML 标记上添加属性吗？](https://stackoverflow.com/questions/427262/can-i-just-make-up-attributes-on-my-html-tags)

就个人而言，我不太喜欢将所有数据放入类属性的建议答案。感觉，只是……错了你知道吗？以我的经验，虽然如果你弥补属性，你的页面将无效，但我还是这样做了。在 4 个主要浏览器中测试它，如果它有效，谁在乎？

*我能想到的最好的解决方案是现在*无效的，但会在 HTML5 中，所以很好。正如 ms2ger 在其他问题中所建议的那样，为您的自定义属性添加前缀`data-`

[http://www.whatwg.org/specs/web-apps/current-work/multipage/dom.html#embedding-custom-non-visible-data](http://www.whatwg.org/specs/web-apps/current-work/multipage/dom.html#embedding-custom-non-visible-data)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-23T01:43:30.990

在 HTML4 中没有一些标准的方法来执行此操作，我很想创建一个与我的可拖动元素相对应的隐藏元素并将相关数据存储在其中。相对于可拖动元素命名隐藏元素，以便您可以轻松查找它的信息。以下扩展使用隐藏跨度实现了这一点。注意：在测试它时，我无法用可拖动项目复制你的问题——data() 似乎对我来说工作得很好，但我没有用各种插件测试它，只是 UI.Draggable。

用法：

```
$('#draggableDiv').externalData('key','data');
var d = $('#draggableDiv').externalData('key');

jQuery.fn.externalData = function(key, data) {
    var value = this;
    this.each( function() {
        var id = this.id+'_external_data';
        var elem = jQuery('#'+id+':first');
        if (elem.size() == 0) {
            elem = $('<span style="display: none;" id="' + id + '"></span>"' );
            elem.appendTo(document.body);
        }
        if (data) {
            elem.data(key,data);
        }
        else {
            value = elem.data(key);
            return false;
        }
    });
    return value;
}; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-23T02:21:54.140

您可能正在寻找新的 HTML 5 数据属性。

[http://ejohn.org/blog/html-5-data-attributes/](http://ejohn.org/blog/html-5-data-attributes/)

[http://dev.w3.org/html5/spec/Overview.html#custom](http://dev.w3.org/html5/spec/Overview.html#custom)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-24T05:40:24.470

这是相对未知但非常有用的：[jQuery Metadata Plugin](http://plugins.jquery.com/project/metadata/)。它将允许您将数据存储在类名中以供检索。它主要用于验证插件，但实际上可以适应任何场景。

祝你工作顺利。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-23T00:37:04.597

看看[http://www.persvr.org/](http://www.persvr.org/)

Persevere 具有一个名为 JavaScriptDB 的新本机对象存储引擎，可提供高端的可扩展性和性能

[http://ajaxian.com/archives/perseveres-javascriptdb-impressive-json-performance](http://ajaxian.com/archives/perseveres-javascriptdb-impressive-json-performance)

# regex - Sed：更改替换组的大小写

> ID：779847
> 
> 赞同：10
> 
> 时间：2009-04-23T00:38:46.837
> 
> 标签：regex, sed, unix

如何使用 sed Unix 命令将匹配组的大小写从小写更改为大写？

谢谢马丁

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-11-29T02:01:52.043

将匹配的模式括在括号中，即：\(pattern\)，然后使用 \U\1 作为替换文本。\1 是匹配模式，\U 强制大写。

```
echo abcdef | sed -e 's/\(abc\)/\U\1/' 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-23T00:43:18.153

通过 tr 运行它？

只是在开玩笑。您可以使用[y///](http://www.grymoire.com/Unix/Sed.html#uh-49)转换来更改大小写。它不是很方便，但很实用。如果您的转换变得过于复杂，您可能需要考虑升级到 perl。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-09T13:21:38.047

我知道这是一个 sed 问题，只是想指出有几种方法可以实现该功能。awk 是一种用于文本处理的工具，在某些情况下更易于使用。在我看来，这是其中之一：

```
#!/bin/sh
INFO="This is a test"
ALLCAPS=`echo $INFO | awk '{print toupper($0)}'`
echo $ALLCAPS 
```

产量：这是一个测试

# c# - 在 Windows 和 Mono 中存储 C# 服务设置

> ID：779852
> 
> 赞同：9
> 
> 时间：2009-04-23T00:40:02.343
> 
> 标签：c#, windows-services, mono, settings

我正在编写一个我希望能够在 Windows 和 Mono 上使用的 C# 服务。我刚刚开始尝试使用 Mono 并试图确定存储设置以控制适用于 Windows 和 Mono 的服务的最佳方式。

1.  安装服务的设置文件

    *   优点：每个平台的代码相同，易于查找以进行编辑
    *   缺点：权限，Windows 可能不喜欢写入文件
2.  平台存储中的设置文件 (%APPDATA, /etc, ...)

    *   优点：有权限，更容易找到编辑
    *   缺点：处理每个平台需要更多编码
3.  小型数据库（可能是 SQLite？）

    *   优点：更容易编写代码来存储和检索设置
    *   缺点：不容易手动编辑，同样的存储位置问题

您认为哪个最好，或者您有更好的建议？
我也可能会编写一个命令行客户端以允许更轻松地更改设置，这会改变设置的存储方式吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-23T00:56:59.960

看看[孤立存储](http://msdn.microsoft.com/en-us/library/3ak841sy(VS.80).aspx)。这是一个为您提供每个应用程序存储的 API，它内置于 .NET 中并在 Mono 中受支持。API 为您提供存储在框架管理的位置的文件的文件 IO：在 Mono 中，它将是一个 ~/.isolatedstorage 目录，在 Windows 中，它将位于用户的文档和设置中的某个位置。

使用此 API，您可以维护您的设置文件，而不必担心操作系统细节或权限。

# c# - 如何在 Sqlite 中实现重音/变音符号不敏感搜索？

> ID：779853
> 
> 赞同：2
> 
> 时间：2009-04-23T00:40:27.863
> 
> 标签：c#, database, sqlite, search, collation

有没有办法在 sqlite 中进行重音/变音符号不敏感搜索？

谷歌搜索，我找到[了这个](http://www.nabble.com/Select-ignoring-accents-td6776946.html)，但我真的不知道如何在 C# 中创建我的“排序函数”。我正在尝试为 Sqlite 创建 pt-br 排序规则...

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2011-04-23T18:58:54.310

如果您使用的是 System.Data.Sqlite，您可以使用自定义排序规则并根据需要对其进行修改......例如：

```
/// <summary>
/// User-defined collating sequence using the current UI culture.
/// </summary>
[SQLiteFunction(Name = "MYSEQUENCE", FuncType = FunctionType.Collation)]
class MySequence : SQLiteFunction
{
  public override int Compare(string param1, string param2)
  {
    return String.Compare(param1, param2, true);
  }
} 
```

使用上述自定义排序规则的 SQL 查询可能如下所示： SELECT * FROM MyTable ORDER BY MyChineseColumn COLLATE MYSEQUENCE DESC

（来源：[http](http://sqlite.phxsoftware.com/forums/p/862/3779.aspx#3779) ://sqlite.phxsoftware.com/forums/p/862/3779.aspx#3779 ）

您只需在创建表时设置排序规则并在该列上构建索引。但请记住，您将无法从其他未定义排序规则的 sqlite 引擎访问表。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2009-04-26T18:51:43.960

虽然可以编写自己的排序规则，但这可能比使用合适的系统提供的排序规则要慢——例如，SQL_Latin1_General_CP1_CI_AS 不能满足您的需求吗？如果是这样，只需使用合适的 COLLATE 子句（在您的 SELECT 或 CREATE TABLE 查询中使用......），您应该已经准备就绪。

# eclipse - Eclipse SWT 虚拟复合问题

> ID：779860
> 
> 赞同：0
> 
> 时间：2009-04-23T00:43:03.847
> 
> 标签：eclipse, swt, virtual, composite

是否可以使用 SWT 创建虚拟合成，即可以水平或垂直滚动​​超出合成的最大显示区域？

我希望我的小部件（图像）的长度和高度保持不变，无论组合更改为什么大小。

如果要显示 50 张图像，并且在合成最大化时一次只能查看 10 张，我希望能够向右滚动以显示剩余的图像。

我无法让 ScrolledComposite 显示任何内容。

当我只使用合成并附加水平滚动条时，我能够看到前几张图像。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-23T00:47:18.860

你的意思是[滚动复合](http://www.java2s.com/Code/Java/SWT-JFace-Eclipse/Scrollacontrolinascrolledcomposite.htm)？

# c - 什么函数是从 C 中的字符串中替换子字符串？

> ID：779875
> 
> 赞同：108
> 
> 时间：2009-04-23T00:48:49.700
> 
> 标签：c, string, replace

给定一个 ( `char *`) 字符串，我想查找所有出现的子字符串并将它们替换为备用字符串。我没有看到任何简单的功能可以在`<string.h>`.

* * *

## 回答 #1

> 赞同：104
> 
> 时间：2009-04-23T01:28:05.987

优化器应该消除大部分局部变量。tmp 指针用于确保 strcpy 不必遍历字符串来查找空值。tmp 指向每次调用后结果的结尾。（请参阅[画家的 Shlemiel 算法](http://www.joelonsoftware.com/articles/fog0000000319.html)，了解 strcpy 为何令人讨厌。）

```
// You must free the result if result is non-NULL.
char *str_replace(char *orig, char *rep, char *with) {
    char *result; // the return string
    char *ins;    // the next insert point
    char *tmp;    // varies
    int len_rep;  // length of rep (the string to remove)
    int len_with; // length of with (the string to replace rep with)
    int len_front; // distance between rep and end of last rep
    int count;    // number of replacements

    // sanity checks and initialization
    if (!orig || !rep)
        return NULL;
    len_rep = strlen(rep);
    if (len_rep == 0)
        return NULL; // empty rep causes infinite loop during count
    if (!with)
        with = "";
    len_with = strlen(with);

    // count the number of replacements needed
    ins = orig;
    for (count = 0; tmp = strstr(ins, rep); ++count) {
        ins = tmp + len_rep;
    }

    tmp = result = malloc(strlen(orig) + (len_with - len_rep) * count + 1);

    if (!result)
        return NULL;

    // first time through the loop, all the variable are set correctly
    // from here on,
    //    tmp points to the end of the result string
    //    ins points to the next occurrence of rep in orig
    //    orig points to the remainder of orig after "end of rep"
    while (count--) {
        ins = strstr(orig, rep);
        len_front = ins - orig;
        tmp = strncpy(tmp, orig, len_front) + len_front;
        tmp = strcpy(tmp, with) + len_with;
        orig += len_front + len_rep; // move to next "end of rep"
    }
    strcpy(tmp, orig);
    return result;
} 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-04-23T00:53:44.213

这在标准 C 库中没有提供，因为如果仅给定一个 char*，如果替换字符串比被替换的字符串长，则无法增加分配给字符串的内存。

您可以更轻松地使用 std::string 执行此操作，但即使在那里，也没有单个函数可以为您执行此操作。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-04-23T00:52:45.680

没有一个。

您需要使用[strstr](http://www.cplusplus.com/reference/clibrary/cstring/strstr/)和 strcat 或 strcpy 之类的东西来滚动自己。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-04-23T00:51:14.453

您可以使用 strstr 构建自己的替换函数来查找子字符串，并使用 strncpy 将部分复制到新缓冲区。

除非您想要`replace_with`的长度与您想要的长度相同`replace`，否则最好使用新缓冲区将新字符串复制到。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-04-23T00:54:16.287

由于 C 中的字符串不能动态增长，就地替换通常不起作用。因此，您需要为一个有足够空间进行替换的新字符串分配空间，然后将原始字符串中的部分加上替换部分复制到新字符串中。要复制您将使用的部分[strncpy](http://en.wikipedia.org/wiki/Strncpy##strncpy)。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-04-23T01:56:50.957

这是一些执行此操作的示例代码。

```
#include <string.h>
#include <stdlib.h>

char * replace(
    char const * const original, 
    char const * const pattern, 
    char const * const replacement
) {
  size_t const replen = strlen(replacement);
  size_t const patlen = strlen(pattern);
  size_t const orilen = strlen(original);

  size_t patcnt = 0;
  const char * oriptr;
  const char * patloc;

  // find how many times the pattern occurs in the original string
  for (oriptr = original; patloc = strstr(oriptr, pattern); oriptr = patloc + patlen)
  {
    patcnt++;
  }

  {
    // allocate memory for the new string
    size_t const retlen = orilen + patcnt * (replen - patlen);
    char * const returned = (char *) malloc( sizeof(char) * (retlen + 1) );

    if (returned != NULL)
    {
      // copy the original string, 
      // replacing all the instances of the pattern
      char * retptr = returned;
      for (oriptr = original; patloc = strstr(oriptr, pattern); oriptr = patloc + patlen)
      {
        size_t const skplen = patloc - oriptr;
        // copy the section until the occurence of the pattern
        strncpy(retptr, oriptr, skplen);
        retptr += skplen;
        // copy the replacement 
        strncpy(retptr, replacement, replen);
        retptr += replen;
      }
      // copy the rest of the string.
      strcpy(retptr, oriptr);
    }
    return returned;
  }
}

#include <stdio.h>
int main(int argc, char * argv[])
{
  if (argc != 4)
  {
    fprintf(stderr,"usage: %s <original text> <pattern> <replacement>\n", argv[0]);
    exit(-1);
  }
  else
  {
    char * const newstr = replace(argv[1], argv[2], argv[3]);
    if (newstr)
    {
      printf("%s\n", newstr);
      free(newstr);
    }
    else
    {
      fprintf(stderr,"allocation error\n");
      exit(-2);
    }
  }
  return 0;
} 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2013-06-03T03:38:23.523

```
// Here is the code for unicode strings!

int mystrstr(wchar_t *txt1,wchar_t *txt2)
{
    wchar_t *posstr=wcsstr(txt1,txt2);
    if(posstr!=NULL)
    {
        return (posstr-txt1);
    }else
    {
        return -1;
    }
}

// assume: supplied buff is enough to hold generated text
void StringReplace(wchar_t *buff,wchar_t *txt1,wchar_t *txt2)
{
    wchar_t *tmp;
    wchar_t *nextStr;
    int pos;

    tmp=wcsdup(buff);

    pos=mystrstr(tmp,txt1);
    if(pos!=-1)
    {
        buff[0]=0;
        wcsncpy(buff,tmp,pos);
        buff[pos]=0;

        wcscat(buff,txt2);

        nextStr=tmp+pos+wcslen(txt1);

        while(wcslen(nextStr)!=0)
        {
            pos=mystrstr(nextStr,txt1);

            if(pos==-1)
            {
                wcscat(buff,nextStr);
                break;
            }

            wcsncat(buff,nextStr,pos);
            wcscat(buff,txt2);

            nextStr=nextStr+pos+wcslen(txt1);   
        }
    }

    free(tmp);
} 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2014-02-03T22:59:28.397

creativeandcritical.net 上的[repl_str()](http://creativeandcritical.net/str-replace-c)函数快速可靠。该页面还包括一​​个宽字符串变体[repl_wcs()](http://creativeandcritical.net/str-replace-c#repl_wcs)，它可以通过辅助函数与 Unicode 字符串一起使用，包括那些以 UTF-8 编码的字符串 - 演示代码从页面链接。迟来的全面披露：我是该页面及其功能的作者。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2015-03-09T21:14:10.190

我发现大多数提议的功能很难理解 - 所以我想出了这个：

```
static char *dull_replace(const char *in, const char *pattern, const char *by)
{
    size_t outsize = strlen(in) + 1;
    // TODO maybe avoid reallocing by counting the non-overlapping occurences of pattern
    char *res = malloc(outsize);
    // use this to iterate over the output
    size_t resoffset = 0;

    char *needle;
    while (needle = strstr(in, pattern)) {
        // copy everything up to the pattern
        memcpy(res + resoffset, in, needle - in);
        resoffset += needle - in;

        // skip the pattern in the input-string
        in = needle + strlen(pattern);

        // adjust space for replacement
        outsize = outsize - strlen(pattern) + strlen(by);
        res = realloc(res, outsize);

        // copy the pattern
        memcpy(res + resoffset, by, strlen(by));
        resoffset += strlen(by);
    }

    // copy the remaining input
    strcpy(res + resoffset, in);

    return res;
} 
```

输出必须是自由的

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2016-07-05T13:31:52.140

你可以使用这个函数（注释解释了它是如何工作的）：

```
void strreplace(char *string, const char *find, const char *replaceWith){
    if(strstr(string, replaceWith) != NULL){
        char *temporaryString = malloc(strlen(strstr(string, find) + strlen(find)) + 1);
        strcpy(temporaryString, strstr(string, find) + strlen(find));    //Create a string with what's after the replaced part
        *strstr(string, find) = '\0';    //Take away the part to replace and the part after it in the initial string
        strcat(string, replaceWith);    //Concat the first part of the string with the part to replace with
        strcat(string, temporaryString);    //Concat the first part of the string with the part after the replaced part
        free(temporaryString);    //Free the memory to avoid memory leaks
    }
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-12-16T09:15:27.233

这是我的，将它们全部设为 char*，这使得调用更容易......

```
char *strrpc(char *str,char *oldstr,char *newstr){
    char bstr[strlen(str)];
    memset(bstr,0,sizeof(bstr));
    int i;
    for(i = 0;i < strlen(str);i++){
        if(!strncmp(str+i,oldstr,strlen(oldstr))){
            strcat(bstr,newstr);
            i += strlen(oldstr) - 1;
        }else{
                strncat(bstr,str + i,1);
            }
    }

    strcpy(str,bstr);
    return str;
} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2015-11-04T22:04:58.467

修复 fann95 的响应，使用字符串的就地修改，并假设 line 指向的缓冲区大到足以容纳结果字符串。

```
static void replacestr(char *line, const char *search, const char *replace)
{
     char *sp;

     if ((sp = strstr(line, search)) == NULL) {
         return;
     }
     int search_len = strlen(search);
     int replace_len = strlen(replace);
     int tail_len = strlen(sp+search_len);

     memmove(sp+replace_len,sp+search_len,tail_len+1);
     memcpy(sp, replace, replace_len);
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2015-08-02T19:09:43.433

这是我根据这些要求创建的：

1.  无论是长还是短，都替换模式。

2.  不要使用任何 malloc（显式或隐式）从本质上避免内存泄漏。

3.  替换任意数量的模式出现。

4.  允许替换字符串的子字符串等于搜索字符串。

5.  不必检查线阵列的大小是否足以容纳替换。例如，除非调用者知道该行的大小足以容纳新字符串，否则这不起作用。

```
/* returns number of strings replaced.
*/
int replacestr(char *line, const char *search, const char *replace)
{
   int count;
   char *sp; // start of pattern

   //printf("replacestr(%s, %s, %s)\n", line, search, replace);
   if ((sp = strstr(line, search)) == NULL) {
      return(0);
   }
   count = 1;
   int sLen = strlen(search);
   int rLen = strlen(replace);
   if (sLen > rLen) {
      // move from right to left
      char *src = sp + sLen;
      char *dst = sp + rLen;
      while((*dst = *src) != '\0') { dst++; src++; }
   } else if (sLen < rLen) {
      // move from left to right
      int tLen = strlen(sp) - sLen;
      char *stop = sp + rLen;
      char *src = sp + sLen + tLen;
      char *dst = sp + rLen + tLen;
      while(dst >= stop) { *dst = *src; dst--; src--; }
   }
   memcpy(sp, replace, rLen);

   count += replacestr(sp + rLen, search, replace);

   return(count);
} 
```

任何改进此代码的建议都会被欣然接受。只需发表评论，我将对其进行测试。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2018-11-18T11:59:49.037

此功能仅在您的字符串有额外空间用于新长度时才有效

```
void replace_str(char *str,char *org,char *rep)
{
    char *ToRep = strstr(str,org);
    char *Rest = (char*)malloc(strlen(ToRep));
    strcpy(Rest,((ToRep)+strlen(org)));

    strcpy(ToRep,rep);
    strcat(ToRep,Rest);

    free(Rest);
} 
```

这只替换第一次出现

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2020-01-12T23:26:50.457

您可以使用 strrep()

char* strrep (const char * cadena, const char * strf, const char * strr)

strrep（字符串替换）。将 'cadena' 中的 'strf' 替换为 'strr' 并返回新字符串。使用 strrep 后，您需要释放代码中返回的字符串。

参数 cadena 带有文本的字符串。strf 要查找的文本。strr 替换文本。

返回 用替换更新的文本。

项目可以在[https://github.com/ipserc/strrep找到](https://github.com/ipserc/strrep)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2014-12-22T15:38:08.397

```
char *replace(const char*instring, const char *old_part, const char *new_part)
{

#ifndef EXPECTED_REPLACEMENTS
    #define EXPECTED_REPLACEMENTS 100
#endif

    if(!instring || !old_part || !new_part)
    {
        return (char*)NULL;
    }

    size_t instring_len=strlen(instring);
    size_t new_len=strlen(new_part);
    size_t old_len=strlen(old_part);
    if(instring_len<old_len || old_len==0)
    {
        return (char*)NULL;
    }

    const char *in=instring;
    const char *found=NULL;
    size_t count=0;
    size_t out=0;
    size_t ax=0;
    char *outstring=NULL;

    if(new_len> old_len )
    {
        size_t Diff=EXPECTED_REPLACEMENTS*(new_len-old_len);
        size_t outstring_len=instring_len + Diff;
        outstring =(char*) malloc(outstring_len); 
        if(!outstring){
            return (char*)NULL;
        }
        while((found = strstr(in, old_part))!=NULL)
        {
            if(count==EXPECTED_REPLACEMENTS)
            {
                outstring_len+=Diff;
                if((outstring=realloc(outstring,outstring_len))==NULL)
                {
                     return (char*)NULL;
                }
                count=0;
            }
            ax=found-in;
            strncpy(outstring+out,in,ax);
            out+=ax;
            strncpy(outstring+out,new_part,new_len);
            out+=new_len;
            in=found+old_len;
            count++;
        }
    }
    else
    {
        outstring =(char*) malloc(instring_len);
        if(!outstring){
            return (char*)NULL;
        }
        while((found = strstr(in, old_part))!=NULL)
        {
            ax=found-in;
            strncpy(outstring+out,in,ax);
            out+=ax;
            strncpy(outstring+out,new_part,new_len);
            out+=new_len;
            in=found+old_len;
        }
    }
    ax=(instring+instring_len)-in;
    strncpy(outstring+out,in,ax);
    out+=ax;
    outstring[out]='\0';

    return outstring;
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2016-02-18T00:53:04.937

你去......这是在字符串中`char x`替换每次出现的功能`char y``str`

```
char *zStrrep(char *str, char x, char y){
    char *tmp=str;
    while(*tmp)
        if(*tmp == x)
            *tmp++ = y; /* assign first, then incement */
        else
            *tmp++;

    *tmp='\0';
    return str;
} 
```

一个示例用法可能是

```
 Exmaple Usage
        char s[]="this is a trial string to test the function.";
        char x=' ', y='_';
        printf("%s\n",zStrrep(s,x,y));

  Example Output
        this_is_a_trial_string_to_test_the_function. 
```

该函数来自[我在 Github 上维护的字符串库](https://github.com/fnoyanisi/zString)，非常欢迎您查看其他可用函数甚至贡献代码:)

[https://github.com/fnoyanisi/zString](https://github.com/fnoyanisi/zString)

编辑：@siride 是对的，上面的函数只替换字符。刚刚写了这个，它替换了字符串。

```
#include <stdio.h>
#include <stdlib.h>

/* replace every occurance of string x with string y */
char *zstring_replace_str(char *str, const char *x, const char *y){
    char *tmp_str = str, *tmp_x = x, *dummy_ptr = tmp_x, *tmp_y = y;
    int len_str=0, len_y=0, len_x=0;

    /* string length */
    for(; *tmp_y; ++len_y, ++tmp_y)
        ;

    for(; *tmp_str; ++len_str, ++tmp_str)
        ;

    for(; *tmp_x; ++len_x, ++tmp_x)
        ;

    /* Bounds check */
    if (len_y >= len_str)
        return str;

    /* reset tmp pointers */
    tmp_y = y;
    tmp_x = x;

    for (tmp_str = str ; *tmp_str; ++tmp_str)
        if(*tmp_str == *tmp_x) {
            /* save tmp_str */
            for (dummy_ptr=tmp_str; *dummy_ptr == *tmp_x; ++tmp_x, ++dummy_ptr)
                if (*(tmp_x+1) == '\0' && ((dummy_ptr-str+len_y) < len_str)){
                /* Reached end of x, we got something to replace then!
                * Copy y only if there is enough room for it
                */
                    for(tmp_y=y; *tmp_y; ++tmp_y, ++tmp_str)
                        *tmp_str = *tmp_y;
            }
        /* reset tmp_x */
        tmp_x = x;
        }

    return str;
}

int main()
{
    char s[]="Free software is a matter of liberty, not price.\n"
             "To understand the concept, you should think of 'free' \n"
             "as in 'free speech', not as in 'free beer'";

    printf("%s\n\n",s);
    printf("%s\n",zstring_replace_str(s,"ree","XYZ"));
    return 0;
} 
```

下面是输出

```
Free software is a matter of liberty, not price.
To understand the concept, you should think of 'free' 
as in 'free speech', not as in 'free beer'

FXYZ software is a matter of liberty, not price.
To understand the concept, you should think of 'fXYZ' 
as in 'fXYZ speech', not as in 'fXYZ beer' 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2019-12-16T23:30:43.470

仅使用 string.h 中的 strlen

对不起我的英语不好

```
char * str_replace(char * text,char * rep, char * repw){//text -> to replace in it | rep -> replace | repw -> replace with
    int replen = strlen(rep),repwlen = strlen(repw),count;//some constant variables
    for(int i=0;i<strlen(text);i++){//search for the first character from rep in text
        if(text[i] == rep[0]){//if it found it
            count = 1;//start searching from the next character to avoid repetition
            for(int j=1;j<replen;j++){
                if(text[i+j] == rep[j]){//see if the next character in text is the same as the next in the rep if not break
                    count++;
                }else{
                    break;
                }
            }
            if(count == replen){//if count equals to the lenght of the rep then we found the word that we want to replace in the text
                if(replen < repwlen){
                    for(int l = strlen(text);l>i;l--){//cuz repwlen greater than replen we need to shift characters to the right to make space for the replacement to fit
                        text[l+repwlen-replen] = text[l];//shift by repwlen-replen
                    }
                }
                if(replen > repwlen){
                    for(int l=i+replen-repwlen;l<strlen(text);l++){//cuz replen greater than repwlen we need to shift the characters to the left
                        text[l-(replen-repwlen)] = text[l];//shift by replen-repwlen
                    }
                    text[strlen(text)-(replen-repwlen)] = '\0';//get rid of the last unwanted characters
                }
                for(int l=0;l<repwlen;l++){//replace rep with repwlen
                    text[i+l] = repw[l];
                }
                if(replen != repwlen){
                    i+=repwlen-1;//pass to the next character | try text "y" ,rep "y",repw "yy" without this line to understand
                }
            }
        }
    }
    return text;
} 
```

如果您希望 strlen 代码避免调用 string.h

```
int strlen(char * string){//use this code to avoid calling string.h
    int lenght = 0;
    while(string[lenght] != '\0'){
        lenght++;
    }
    return lenght;
} 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2016-12-13T13:53:41.973

```
/*замена символа в строке*/
char* replace_char(char* str, char in, char out) {
    char * p = str;

    while(p != '\0') {
        if(*p == in)
            *p == out;
        ++p;
    }

    return str;
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2019-04-01T17:19:23.427

这是我的，它是独立的、多功能的、高效的，它在每次递归中根据需要增加或缩小缓冲区

```
void strreplace(char *src, char *str, char *rep)
{
    char *p = strstr(src, str);
    if (p)
    {
        int len = strlen(src)+strlen(rep)-strlen(str);
        char r[len];
        memset(r, 0, len);
        if ( p >= src ){
            strncpy(r, src, p-src);
            r[p-src]='\0';
            strncat(r, rep, strlen(rep));
            strncat(r, p+strlen(str), p+strlen(str)-src+strlen(src));
            strcpy(src, r);
            strreplace(p+strlen(rep), str, rep);
        }
    }
} 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2017-10-16T15:51:34.567

```
DWORD ReplaceString(__inout PCHAR source, __in DWORD dwSourceLen, __in const char* pszTextToReplace, __in const char* pszReplaceWith)
{
    DWORD dwRC = NO_ERROR;
    PCHAR foundSeq = NULL;
    PCHAR restOfString = NULL;
    PCHAR searchStart = source;
    size_t szReplStrcLen = strlen(pszReplaceWith), szRestOfStringLen = 0, sztextToReplaceLen = strlen(pszTextToReplace), remainingSpace = 0, dwSpaceRequired = 0;
    if (strcmp(pszTextToReplace, "") == 0)
        dwRC = ERROR_INVALID_PARAMETER;
    else if (strcmp(pszTextToReplace, pszReplaceWith) != 0)
    {
        do
        {
            foundSeq = strstr(searchStart, pszTextToReplace);
            if (foundSeq)
            {
                szRestOfStringLen = (strlen(foundSeq) - sztextToReplaceLen) + 1;
                remainingSpace = dwSourceLen - (foundSeq - source);
                dwSpaceRequired = szReplStrcLen + (szRestOfStringLen);
                if (dwSpaceRequired > remainingSpace)
                {
                    dwRC = ERROR_MORE_DATA;
                }

                else
                {
                    restOfString = CMNUTIL_calloc(szRestOfStringLen, sizeof(CHAR));
                    strcpy_s(restOfString, szRestOfStringLen, foundSeq + sztextToReplaceLen);

                    strcpy_s(foundSeq, remainingSpace, pszReplaceWith);
                    strcat_s(foundSeq, remainingSpace, restOfString);
                }

                CMNUTIL_free(restOfString);
                searchStart = foundSeq + szReplStrcLen; //search in the remaining str. (avoid loops when replWith contains textToRepl 
            }
        } while (foundSeq && dwRC == NO_ERROR);
    }
    return dwRC;
} 
```

# linq - 何时不使用 LINQ 的示例

> ID：779876
> 
> 赞同：3
> 
> 时间：2009-04-23T00:49:24.487
> 
> 标签：linq

这是对我读到的这个问题的跟进： [人们在开始使用 LINQ 时犯的最大错误是什么？](https://stackoverflow.com/questions/777400/what-is-the-biggest-mistake-people-make-when-starting-to-use-linq)

最佳答案是“它应该被用于一切”。这让我想知道这到底意味着什么。

有人在不应该使用 LINQ 时使用了哪些常见示例？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-23T00:54:23.103

**当替代方案更简单或更**高效 时，您不应该使用 LINQ 。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-23T00:53:39.050

我建议在任何时候避免使用 LINQ，因为它会使代码变得不那么明显。

但是，总的来说，我认为 LINQ 使事情更容易理解，而不是更难，所以我很少避免它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-23T01:00:54.757

LINQ 可能比替代方案慢得多，尤其是在您有很多中间列表的情况下。但是，您正在谈论一些非常大的数据集，大到我没有遇到它们。

但是，要记住的一件事是，由于 IEnumerable 的工作方式，编写良好的 LINQ 查询也可以比替代查询快得多。

最后，现在使用 LINQ 将允许您在 Parallel LINQ 发布时切换到它，而几乎没有更改。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-23T01:01:09.483

用foreach还是可以的。:)

# javascript - 在 Javascript 中，你可以扩展 DOM 吗？

> ID：779880
> 
> 赞同：24
> 
> 时间：2009-04-23T00:51:59.803
> 
> 标签：javascript, dom

在 Javascript 中，您可以使用其原型对象来扩展现有类：

```
String.prototype.getFirstLetter = function() {
    return this[0];
}; 
```

是否可以使用这种方法来扩展 DOM 元素？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-04-23T00:53:30.907

我在写问题时找到了答案，但我想我还是会发布来分享信息。

您需要扩展的对象是`Element.prototype`.

```
Element.prototype.getMyId = function() {
    return this.id;
}; 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-04-23T00:59:18.443

您可以使用 Element 的原型来扩展 DOM。但是，这在 IE7 及更早版本中不起作用。您将需要扩展特定元素，一次一个。原型库就是这样做的。我建议查看[源代码](http://prototypejs.org/assets/2008/9/29/prototype-1.6.0.3.js)以确切了解它是如何完成的。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-23T07:43:02.217

您不应该直接扩展任何东西（“任何东西”是指本机 DOM 对象）——这只会导致坏事。再加上重新扩展每个新元素（你必须做的事情来支持 IE）会增加额外的开销。

为什么不采用 jQuery 方法并创建一个包装器/构造器并对其进行扩展：

```
var myDOM = (function(){
    var myDOM = function(elems){
            return new MyDOMConstruct(elems);
        },
        MyDOMConstruct = function(elems) {
            this.collection = elems[1] ? Array.prototype.slice.call(elems) : [elems];
            return this;
        };
    myDOM.fn = MyDOMConstruct.prototype = {
        forEach : function(fn) {
            var elems = this.collection;
            for (var i = 0, l = elems.length; i < l; i++) {
                fn( elems[i], i );
            }
            return this;
        },
        addStyles : function(styles) {
            var elems = this.collection;
            for (var i = 0, l = elems.length; i < l; i++) {
                for (var prop in styles) {
                    elems[i].style[prop] = styles[prop];
                }
            }
            return this;
        }
    };
    return myDOM;
})(); 
```

**`myDOM.fn`**然后你可以通过...添加你自己的方法，你可以像这样使用它：

```
myDOM(document.getElementsByTagName('*')).forEach(function(elem){
    myDOM(elem).addStyles({
        color: 'red',
        backgroundColor : 'blue'
    });
}); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-23T01:04:06.183

是的，您可以，但强烈建议不要这样做。

如果您覆盖了另一个库期望成为原始库的内容，或者另一个库覆盖了您所期望的内容.. 混乱！

将代码保存在自己的命名空间/范围内是最佳实践。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-09-18T20:52:20.630

如果有人正在寻找这个（我知道我是），这里是所有 HTML 标记的 JavaScript 类型：

```
interface HTMLElementTagNameMap {
    "a": HTMLAnchorElement;
    "abbr": HTMLElement;
    "address": HTMLElement;
    "applet": HTMLAppletElement;
    "area": HTMLAreaElement;
    "article": HTMLElement;
    "aside": HTMLElement;
    "audio": HTMLAudioElement;
    "b": HTMLElement;
    "base": HTMLBaseElement;
    "bdi": HTMLElement;
    "bdo": HTMLElement;
    "blockquote": HTMLQuoteElement;
    "body": HTMLBodyElement;
    "br": HTMLBRElement;
    "button": HTMLButtonElement;
    "canvas": HTMLCanvasElement;
    "caption": HTMLTableCaptionElement;
    "cite": HTMLElement;
    "code": HTMLElement;
    "col": HTMLTableColElement;
    "colgroup": HTMLTableColElement;
    "data": HTMLDataElement;
    "datalist": HTMLDataListElement;
    "dd": HTMLElement;
    "del": HTMLModElement;
    "details": HTMLDetailsElement;
    "dfn": HTMLElement;
    "dialog": HTMLDialogElement;
    "dir": HTMLDirectoryElement;
    "div": HTMLDivElement;
    "dl": HTMLDListElement;
    "dt": HTMLElement;
    "em": HTMLElement;
    "embed": HTMLEmbedElement;
    "fieldset": HTMLFieldSetElement;
    "figcaption": HTMLElement;
    "figure": HTMLElement;
    "font": HTMLFontElement;
    "footer": HTMLElement;
    "form": HTMLFormElement;
    "frame": HTMLFrameElement;
    "frameset": HTMLFrameSetElement;
    "h1": HTMLHeadingElement;
    "h2": HTMLHeadingElement;
    "h3": HTMLHeadingElement;
    "h4": HTMLHeadingElement;
    "h5": HTMLHeadingElement;
    "h6": HTMLHeadingElement;
    "head": HTMLHeadElement;
    "header": HTMLElement;
    "hgroup": HTMLElement;
    "hr": HTMLHRElement;
    "html": HTMLHtmlElement;
    "i": HTMLElement;
    "iframe": HTMLIFrameElement;
    "img": HTMLImageElement;
    "input": HTMLInputElement;
    "ins": HTMLModElement;
    "kbd": HTMLElement;
    "label": HTMLLabelElement;
    "legend": HTMLLegendElement;
    "li": HTMLLIElement;
    "link": HTMLLinkElement;
    "main": HTMLElement;
    "map": HTMLMapElement;
    "mark": HTMLElement;
    "marquee": HTMLMarqueeElement;
    "menu": HTMLMenuElement;
    "meta": HTMLMetaElement;
    "meter": HTMLMeterElement;
    "nav": HTMLElement;
    "noscript": HTMLElement;
    "object": HTMLObjectElement;
    "ol": HTMLOListElement;
    "optgroup": HTMLOptGroupElement;
    "option": HTMLOptionElement;
    "output": HTMLOutputElement;
    "p": HTMLParagraphElement;
    "param": HTMLParamElement;
    "picture": HTMLPictureElement;
    "pre": HTMLPreElement;
    "progress": HTMLProgressElement;
    "q": HTMLQuoteElement;
    "rp": HTMLElement;
    "rt": HTMLElement;
    "ruby": HTMLElement;
    "s": HTMLElement;
    "samp": HTMLElement;
    "script": HTMLScriptElement;
    "section": HTMLElement;
    "select": HTMLSelectElement;
    "slot": HTMLSlotElement;
    "small": HTMLElement;
    "source": HTMLSourceElement;
    "span": HTMLSpanElement;
    "strong": HTMLElement;
    "style": HTMLStyleElement;
    "sub": HTMLElement;
    "summary": HTMLElement;
    "sup": HTMLElement;
    "table": HTMLTableElement;
    "tbody": HTMLTableSectionElement;
    "td": HTMLTableDataCellElement;
    "template": HTMLTemplateElement;
    "textarea": HTMLTextAreaElement;
    "tfoot": HTMLTableSectionElement;
    "th": HTMLTableHeaderCellElement;
    "thead": HTMLTableSectionElement;
    "time": HTMLTimeElement;
    "title": HTMLTitleElement;
    "tr": HTMLTableRowElement;
    "track": HTMLTrackElement;
    "u": HTMLElement;
    "ul": HTMLUListElement;
    "var": HTMLElement;
    "video": HTMLVideoElement;
    "wbr": HTMLElement;
} 
```

取自“lib.dom.d.ts”（随 vs-code 提供）。

# xul - 为什么我不能禁用这个 XUL 菜单项？

> ID：779881
> 
> 赞同：4
> 
> 时间：2009-04-23T00:52:04.997
> 
> 标签：xul, menuitem, setattribute

我束手无策，这可能很简单。基本上我有这个代码：

```
var menuitem = document.getElementById('mymenuitem');
alert(menuitem);
alert(varImChecking == null);
menuitem.setAttribute('disabled', (varImChecking == null) ? 'true' : 'false'); 
```

它应该禁用“mymenuitem”菜单项，但没有效果。运行时，警报会显示“[Object XulElement]”，然后是“true”。我知道 getElementById 选择了正确的 menuitem 元素，因为 onclick 绑定到 menuitem 变量有效。

我尝试过的一些替代方案：

```
menuitem.setAttribute('disabled', (varImChecking == null));
menuitem.disabled = (varImChecking == null); 
```

那么为什么 setAttribute 没有任何效果呢？它甚至不会使菜单项变灰。我应该这样做吗？

**编辑：** 忘了提，控制台中没有显示警告或错误。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-11-21T01:56:46.983

关于禁用问题：如果菜单项包含命令，则只能通过设置该命令的“禁用”属性来禁用菜单项。如果 menuitem 包含 oncommand，禁用应该对 menuitem 本身起作用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-23T03:54:42.420

我相信 setAttribute*会*像您最初那样寻找字符串“true”/“false”。

虽然我没有立即看到为什么你不能*禁用*的错误。对于测试，您是否尝试过简单的 menuitem.setAttribute('disabled', 'true'); ? 如果这不起作用 - 也许什么都不会。禁用菜单项似乎很奇怪-您确定不想禁用菜单列表吗？

我确实看到您的启用代码有问题。我找不到很好的文档，但我之前确实处理过这个问题。您可以在 bugzilla 中找到一个示例，即设置 disabled=false[实际上会禁用 Linux 上的项目。](https://bugzilla.mozilla.org/show_bug.cgi?id=306162) Mozilla 推荐的方法是在您希望启用该属性时将其删除。

因此，尽管您的解决方案更简洁，但您可能应该看看更像这样的东西：

```
var menuitem = document.getElementById('mymenuitem');
alert(menuitem);
alert(varImChecking == null);
if(null==varImChecking){
   menuitem.setAttribute('disabled', 'true');
}else{
   menuitem.removeAttribute('disabled');
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-24T02:27:01.987

我想我终于想通了。问题是我试图编辑的菜单项被**硬编码在 .xul 文件**中。无论出于何种原因，这使得更改禁用或隐藏属性成为不可能。

所以我从 .xul 文件中删除了 menuitem 并**在 javascript 中动态创建它**。现在它完全按预期工作：

```
var menuitem = document.getElementById('mypopupitem').appendChild(document.createElement('menuitem'));
menuitem.setAttribute('disabled', 'true'); // Works.
menuitem.removeAttribute('disabled'); // Also works. 
```

有谁知道，这是 XUL 的一个功能/怪癖，还是我做错了？

**更新：**正如许多评论指出的那样，上述内容不正确。您绝对可以更改 XUL 文件中硬编码的项目的禁用属性。

经过更多的调试，将问题归结为核心元素，拉头发等，结果证明是……一个错字。Grrr..对不起。

原来我的 document.getElementById('menuitem') 是在抓取 XUL 元素，而不是元素。onclick 方法似乎正确触发的事实似乎要归功于事件冒泡（我猜？）。我仍然不知道为什么 setAttribute('label', 'changed') 在我尝试这样做时会起作用，但不幸的是，在疯狂的调试中，我没有该版本可以再次检查。

无论如何，它现在正在工作，而无需动态创建菜单项。感谢所有的帮助！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-09-29T00:26:31.390

我有同样的问题。我将标志性菜单项与命令一起使用。线索是将菜单项的禁用属性和命令设置为真或假。在打开父菜单弹出窗口后，我还必须设置禁用属性，即 onpopupshown 。现在我可以动态更新我的菜单项。

我已经花了一个多小时来解决这个问题 xD 我希望这将帮助人们最大限度地减少他们的时间开支。

顺便提一句：

1.  我的 xul 在 firebug 扩展中

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-23T01:15:35.470

可能这会起作用：

```
var menuitem = document.getElementById('mymenuitem');
alert(menuitem);
alert(varImChecking == null);
menuitem.setAttribute('disabled', (varImChecking == null) ? true : false); 
```

我用的是真假而不是“真”和“假”

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-08-21T05:26:43.333

我正在使用标签添加自定义上下文菜单。当我使用“onpopupshowing”事件来处理菜单项的启用/禁用时，我的上下文菜单中填充了很多我不打算添加的菜单项。这是我在 overlay.xul 中添加的新弹出标签

<popup onpopupshowing="isAssertTextEnabled(this)" id="contentAreaContextMenu">
<menuitem id="context-recorderpopup" label="Assert text present"
accesskey="T"
insertafter="context-stop" oncommand="onAssertionMenu(event )" />
</popup>

如果我错过了什么，请告诉我

谢谢， 维奈

# git - GIT 如何决定 blob 中的内容？

> ID：779883
> 
> 赞同：1
> 
> 时间：2009-04-23T00:52:42.093
> 
> 标签：git

我试图了解 Git 如何更好地工作。

给定一些任意文件和任意数量的提交，git 如何决定如何将这些文件拆分为 blob，然后用 SHA-1 哈希唯一标识？

我刚刚将大约 10 次 perl/C/java 代码和文本提交到新的 git repo 中，并且 git 以某种方式将文件分成小段，它是如何决定这些段应该如何划分的？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-23T03:00:03.440

Git 为每个文件的内容创建一个 blob，除非相同的内容已经存在（在这种情况下，它会重用该 blob）。但还有更多——git 还为每个目录、提交和签名标签创建对象。每个对象都存储在 .git/objects 中，直到重新打包存储库（自动或通过运行`git gc`），在这种情况下，一些对象将被放在一起并分解为一个包文件（在 .git/objects/pack 中）。

它不会像您想象的那样将单个文件的内容拆分为多个 blob 或小段。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-23T02:39:55.707

我建议您查看一些基本（即“低级”）参考资料。对于您的特定问题，请参阅Git 社区手册中有关[Git 对象模型的部分。](http://book.git-scm.com/1_the_git_object_model.html)

之后，您可能有兴趣阅读[Git from the Bottom Up (PDF)](http://ftp.newartisans.com/pub/git.from.bottom.up.pdf)或优秀的[Git Internals（PDF，9 美元）](http://peepcode.com/products/git-internals-pdf)，以了解 Git 的底层基础（“内容可寻址文件系统”和有向无环图关系）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-23T00:55:25.533

所有文件都进入一个 blob，但这并不一定意味着 Git 会为每个 blob 存储一个文件（Git 有一种高效的打包格式，可以将东西放在一起）。如果你对 Git 打包格式的内部结构感兴趣，最好在他们的列表上询问，或者阅读他们的架构文档。

# php - 将参数传递给类构造函数

> ID：779898
> 
> 赞同：8
> 
> 时间：2009-04-23T00:59:59.457
> 
> 标签：php, class, object

如何使用下面定义的 Object() 函数将任意数量的参数传递给类构造函数？

```
<?php

/*
./index.php
*/

function Object($object)
{
    static $instance = array();

    if (is_file('./' . $object . '.php') === true)
    {
        $class = basename($object);

        if (array_key_exists($class, $instance) === false)
        {
            if (class_exists($class, false) === false)
            {
                require('./' . $object . '.php');
            }

            /*
            How can I pass custom arguments, using the
            func_get_args() function to the class constructor?

            $instance[$class] = new $class(func_get_arg(1), func_get_arg(2), ...);
            */

            $instance[$class] = new $class();
        }

        return $instance[$class];
    }

    return false;
}

/*
How do I make this work?
*/

Object('libraries/DB', 'DATABASE', 'USERNAME', 'PASSWORD')->Query(/* Some Query */);

/*
./libraries/DB.php
*/

class DB
{
    public function __construct($database, $username, $password, $host = 'localhost', $port = 3306)
    {
        // do stuff here
    }
}

?> 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-23T08:28:03.060

```
$klass = new ReflectionClass($classname);
$thing = $klass->newInstanceArgs($args); 
```

尽管需要使用反射表明您在设计中过于复杂了。为什么要首先编写此函数？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-23T01:21:48.933

而不是你的类采用单独的参数，我会让它采用一个数组。

```
class DB
{
    public function __construct(array $params)
    {
        // do stuff here
    }
} 
```

这样您就可以将 func_get_args 的直接结果传递给您的构造函数。现在唯一的问题是能够找出数组键/值。

如果其他人有任何想法，我也很高兴知道:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-23T02:29:43.407

我还没有尝试过，但`call_user_func_array`听起来像你想要的。

```
$thing = call_user_func_array(array($classname, '__construct'), $args); 
```

查看[PHP 文档](http://www.php.net/manual/en/function.call-user-func-array.php)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-10-27T14:14:07.527

反射方法的替代方法是评估您的代码。

```
eval('$instance = new className('.implode(', ', $args).');'); 
```

# language-agnostic - 出售一家小型 ISV 公司（锁定股票和桶）

> ID：779903
> 
> 赞同：2
> 
> 时间：2009-04-23T01:01:14.180
> 
> 标签：language-agnostic

我拥有一家由 2 人组成的小型 ISV 公司。我们销售使用 Microsoft Web 技术（ASP/VB6，一些 .NET）构建的单一产品。现在经营了几年，总收入相对稳定在低 6 位数。

我正在考虑出售公司并转向其他工作，但我不清楚采取的最佳方法。我并不期待一个巨大的价格，我正在考虑一个 2 的总收入乘数（这对我来说似乎很低......但我知道什么）......所以称之为中间 6 位数。

关于如何最好地进行的任何建议？

注意：虽然不是直接与编程相关的问题，但开发人员可能会感兴趣。我编写了应用程序，每一行代码（所以它不像 phb 要求的那样）。也许版主可以给这个问题一点时间，看看社区是否感兴趣。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-23T01:28:36.517

当您说您不清楚要采取的最佳方法时，您的意思是您还没有任何买家吗？

如果这就是你要找的，我会先去你公司的网络：公司里的另一个人是谁，他想买你的股份吗？您是否有可能对收购整个公司感兴趣的外部投资者？您是否有可能感兴趣的客户（毕竟他们正在失去供应商）？您是否有可能感兴趣的供应商（他们正在失去客户）？

如果这些都不适合您，我会寻找您公司的“扩展”网络：如果您有任何业务合作伙伴（如果您从事嵌入式软件，则如硬件制造商）。看看您的客户正在购买哪些其他软件。如果这是一个非常小众的市场，并且当您共享一个客户时，他们的其他供应商可能有兴趣购买您，因为您可以通过已经建立的商业关系获得另一个收入来源。

最后，您在这个市场上的竞争对手呢？如果他们购买你，他们将主要购买你客户的投资组合。但也许他们愿意通过与您的公司“合并”以低成本扩张。

对我来说，这似乎真的就像你正在寻找一份新工作：这是关于在寻找其他地方之前先使用你所有的网络，因为它通常是你获得最佳结果的地方。

祝你好运。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-23T01:35:22.210

[考虑像www.bizbuysell.com](http://www.bizbuysell.com/)这样的“待售业务”网站之一。他们还具有“寻找经纪人”功能。

除此之外，我会与您使用的专业人士（会计师、律师等）交谈。他们可能知道有人正在寻找要购买的业务。

要记住的一个想法是，一些买家（比如我）可能有兴趣购买企业的资产（代码、客户名单、商誉），而不是公司本身。这种区别很好，但很重要。

# asp.net-mvc - 授权问题，FormsAuth 和 ASP.NET MVC

> ID：779906
> 
> 赞同：1
> 
> 时间：2009-04-23T01:02:06.360
> 
> 标签：asp.net-mvc, asp.net-membership, authorization

我有一个非常简单的 ASP.NET MVC 站点应用程序。(MVC 1.0)

我的 web.config 中没有授权部分，因为我在控制器上使用了 [Authoize] 属性。

正如预期的那样，服务器的默认 web.config 允许 * 进行表单身份验证。

我有 2 台现有的 Windows 2008 专用（托管）服务器。该网站运行良好。

我有一个新的专用服务器，除了该站点无法正常工作外，似乎相同。每个资源，甚至图像/javascript 都重定向到登录页面。

我尝试添加显式授权规则以允许 * 和 location 规则，结果相同。我检查了 .NET 信任级别，内部/完全信任。一切都在两台服务器上完美运行，只是这台忽略了所有授权规则。

有任何想法吗？谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-24T14:01:46.513

我发现了问题 :) 除非在 Windows 2008 中发生了某些变化，否则我本来希望这会显示为错误，但如上所述，它被表单身份验证隐藏了。

问题是托管公司现在将数据驱动器添加到您的网站/存储的所有服务器。没有设置允许 IIS 读取文件的权限。我找不到它的原因是我已经为应用程序池用户添加了权限，就我而言，我只是继续添加 ASPNET、网络服务、IIS 匿名用户等以获得完全权限。

我需要让每个人都至少可以读取网站文件夹，然后 IIS 显示非安全内容。我仍然认为形成身份验证很奇怪。正在踢并忽略所有 web.config 规则，但无论如何。

我通过在 IIS 7 管理器中关闭 Forms Auth 支持发现了该错误。然后由于文件权限，我得到了进程失败错误。

# c - 我应该使用 char** argv 还是 char* argv[]？

> ID：779910
> 
> 赞同：127
> 
> 时间：2009-04-23T01:02:56.267
> 
> 标签：c, arrays, pointers, standards

我刚刚学习 C 并且想知道我应该在我的主要方法中使用其中的哪一个。有什么区别吗？哪个更常见？

* * *

## 回答 #1

> 赞同：165
> 
> 时间：2009-04-23T02:59:30.197

由于您刚刚学习 C，我建议您首先真正尝试理解数组和指针之间的*区别*，而不是*常见*的东西。

在参数和数组领域，有一些令人困惑的规则在继续之前应该清楚。首先，**您在参数列表中声明的内容被视为特殊内容。**在某些情况下，事情作为 C 中的函数参数没有意义。这些是

*   作为参数的函数
*   数组作为参数

## 数组作为参数

第二个可能不是很清楚。但是，当您考虑到数组维度的大小是 C 中类型的一部分（并且未给出维度大小的数组具有不完整的类型）时，就会变得很清楚。因此，如果您要创建一个按值获取数组的函数（接收副本），那么它只能针对一种大小执行此操作！此外，数组可能会变大，C 会尽可能快。

在 C 中，由于这些原因，**数组值**不存在。如果你想获取一个数组的值，你得到的是一个指向该数组第一个元素的指针。而这里实际上已经存在解决方案。C 编译器不会预先绘制无效的数组参数，而是将相应参数的类型**转换**为指针。记住这一点，这非常重要。该参数不是数组，而是指向相应元素类型的指针。

现在，如果您尝试传递一个数组，则传递的是指向数组第一个元素的指针。

### 游览：作为参数的函数

为了完成，并且因为我认为这将帮助您更好地理解问题，让我们看看当您尝试将函数作为参数时的情况。确实，首先它没有任何意义。参数怎么可能是函数？嗯，我们当然想要那个地方的变量！因此，当这种情况发生时，编译器所做的就是再次**将**函数转换为**函数指针**。试图传递一个函数将传递一个指向相应函数的指针。因此，以下是相同的（类似于数组示例）：

```
void f(void g(void));
void f(void (*g)(void)); 
```

请注意，`*g`需要括号。否则，它将指定一个函数返回`void*`，而不是一个指向函数返回的指针`void`。

## 返回数组

现在，我在一开始就说过，数组可以有一个不完整的类型——如果你还没有给出大小，就会发生这种情况。由于我们已经确定不存在数组参数，而是任何数组参数都是指针，因此数组的大小无关紧要。这意味着，编译器将翻译以下所有内容，并且都是相同的：

```
int main(int c, char **argv);
int main(int c, char *argv[]);
int main(int c, char *argv[1]);
int main(int c, char *argv[42]); 
```

当然，能放任何大小的东西都没多大意义，直接扔掉就行了。出于这个原因，C99 为这些数字提出了新的含义，并允许在括号之间出现其他内容：

```
// says: argv is a non-null pointer pointing to at least 5 char*'s
// allows CPU to pre-load some memory. 
int main(int c, char *argv[static 5]);

// says: argv is a constant pointer pointing to a char*
int main(int c, char *argv[const]);

// says the same as the previous one
int main(int c, char ** const argv); 
```

最后两行表示您将无法在函数内更改“argv” - 它已成为 const 指针。不过，只有少数 C 编译器支持这些 C99 功能。但是这些特征清楚地表明，“阵列”实际上并不是一个。这是一个指针。

## 一句警告

请注意，只有当您将数组作为函数的**参数**时，我上面所说的都是正确的。如果您使用本地数组，则数组将不是指针。它将*表现*为指针，因为如前所述，当读取数组的值时，数组将被转换为指针。但它不应该与指针混淆。

一个经典的例子如下：

```
char c[10]; 
char **c = &c; // does not work.

typedef char array[10];
array *pc = &c; // *does* work.

// same without typedef. Parens needed, because [...] has 
// higher precedence than '*'. Analogous to the function example above.
char (*array)[10] = &c; 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-23T01:13:00.483

你可以使用任何一个。它们是完全等价的。请参阅[litb](https://stackoverflow.com/users/34509/litb)的评论和[他的回答](https://stackoverflow.com/questions/779910/should-i-use-char-argv-or-char-argv-in-c/780147#780147)。

这真的取决于你想如何使用它（在任何情况下你都可以使用）：

```
// echo-with-pointer-arithmetic.c
#include <stdio.h>
int main(int argc, char **argv)
{
  while (--argc > 0)
  {
    printf("%s ", *++argv);
  }
  printf("\n");
  return 0;
}

// echo-without-pointer-arithmetic.c
#include <stdio.h>
int main(int argc, char *argv[])
{
  int i;
  for (i=1; i<argc; i++)
  {
    printf("%s ", argv[i]);
  }
  printf("\n");
  return 0;
} 
```

至于哪个更常见——没关系。任何有经验的 C 程序员阅读您的代码都会看到两者是可互换的（在正确的条件下）。就像一个有经验的说英语的人一样容易读“他们是”和“他们是”。

更重要的是你学会阅读它们并认识到它们有多么相似。您将阅读比编写更多的代码，并且您需要对两者都同样熟悉。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-04-23T01:08:01.137

它没有什么区别，但我使用`char *argv[]`它是因为它表明这是一个固定大小的可变长度字符串数组（通常是`char *`）。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-04-23T01:04:44.793

您可以使用这两种形式中的任何一种，因为在 C 数组中，指针在函数参数列表中是可以互换的。请参阅[http://en.wikipedia.org/wiki/C_(programming_language)#Array-pointer_interchangeability](http://en.wikipedia.org/wiki/C_(programming_language)#Array-pointer_interchangeability)。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-23T01:05:24.107

它并没有真正的区别，但后者更具可读性。你得到的是一个字符指针数组，就像第二个版本说的那样。但是，它可以像第一个版本一样隐式转换为双字符指针。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-02-08T07:41:44.567

您应该将其声明为`char *argv[]`，因为有许多等效的声明方式，最接近其直观含义：字符串数组。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-23T01:10:22.097

char ** → 指向字符指针的指针，char *argv [] 表示字符指针数组。因为我们可以使用指针而不是数组，所以两者都可以使用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-23T08:25:10.837

我认为使用任何一种方法而不是另一种方法没有什么特别的优点——使用最符合您的代码其余部分的约定。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2009-04-23T01:21:38.123

如果您需要可变数量或动态数量的字符串，char** 可能更容易使用。如果您的字符串数量是固定的，那么 char* var[] 将是首选。

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2012-04-02T20:45:33.463

我知道这已经过时了，但是如果您只是学习 C 编程语言并且没有做任何主要的事情，请不要使用命令行选项。

如果您不使用命令行参数，也不要使用。只需将 main 函数声明为`int main()` If you

*   希望您的程序的用户能够将文件拖到您的程序上，以便您可以使用它来更改程序的结果，或者
*   想要处理命令行选项（`-help`,`/?`或任何其他`program name`在终端或命令提示符后出现的东西）

使用对您更有意义的那个。否则，只需使用`int main()` 毕竟，如果您最终想要添加命令行选项，您可以在以后轻松地编辑它们。

# php - 使用 OpenSSL 的 MediaWiki/Apache/PHP/MySQL 的数据库连接需要 SSL

> ID：779917
> 
> 赞同：3
> 
> 时间：2009-04-23T01:06:09.940
> 
> 标签：php, mysql, openssl, mediawiki, mysql-error-1045

对于一个学校项目，我在本地机器上安装了 MediaWiki，并且需要使用 SSL 与本地 MySQL 数据库建立任何数据库连接。我不确定如何连接所有的点。这是我到目前为止所做的：

1.  我已经安装了 OpenSSL，并创建了一个自签名证书和相关的密钥。
2.  phpinfo() 显示 OpenSSL 已启用。
3.  我已将其包含在 my.ini 的 [mysqld] 部分中：

ssl-key="C:/newcerts/server-key.pem" ssl-cert="C:/newcerts/server-cert.pem" ssl-ca="C:/newcerts/ca-cert.pem"

4.  运行 MySQL 命令行提示我输入 root 密码，输入后，我收到错误 1045:Access denied 等。

5.  从 bin 目录运行 mysql -u root -p ssl-ca="C:/newcerts/ca-cert.pem" 并输入密码成功，并给我一个mysql提示符。运行状态显示 SSL: Cipher in use is DHE-RSA-AES256-SHA。

这就是我感到困惑的地方。还需要做什么（例如通过 Apache 或 PHP 配置文件，或 MediaWiki 文件）来要求数据库连接使用 SSL？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-23T01:13:08.940

您将要使用 mysqli 扩展，因为本机 php/mysql 扩展不支持 SSL。见mysqli SSL相关函数：

[http://us.php.net/manual/en/mysqli.ssl-set.php](http://us.php.net/manual/en/mysqli.ssl-set.php)

话虽如此，MediaWiki 中的 DB 类已被抽象出来，但据我所知，现有的实现使用常规的 php/mysql，而不是 mysqli，所以我认为您将编写自己的 mysqli 适配器，或者也许有人已经有了。

无论哪种方式，您都需要让 MediaWiki 使用 mysqli 适配器。

# c - 给定日期、时间、纬度和经度的太阳方位角的 C 代码

> ID：779924
> 
> 赞同：2
> 
> 时间：2009-04-23T01:10:25.203
> 
> 标签：c, astronomy, azimuth

我似乎问错了我的问题，所以我再次强调一下。是此页面上的最佳答案

[https://stackoverflow.com/questions/257717/position-of-the-sun-given-time-of-day-and-lat-long](https://stackoverflow.com/questions/257717/position-of-the-sun-given-time-of-day-and-lat-long)

问题的解决方案还是更需要？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T01:27:22.153

你看过[USNO NOVAS](http://aa.usno.navy.mil/software/novas/novas_info.php)的套路吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-07-28T19:37:34.540

Pysolar 是 Python 中的一个实现，可以为您提供高度/方位角。[http://pysolar.org/](http://pysolar.org/) - 在意识到其他答案之一中的 NOVAS 系统不支持 Windows 后，我遇到了它。

从文档（[https://github.com/pingswept/pysolar/wiki/examples](https://github.com/pingswept/pysolar/wiki/examples)）：

```
>>> import Pysolar
>>> import datetime
>>> d = datetime.datetime.utcnow() # create a datetime object for now
>>> Pysolar.GetAltitude(42.206, -71.382, d)
-20.453156227223857
>>> d = datetime.datetime(2007, 2, 18, 20, 13, 1, 130320) # try another date
>>> Pysolar.GetAltitude(42.206, -71.382, d)
19.551710266768644 
```

# asp.net - 如何在服务器场中实现锁定？

> ID：779925
> 
> 赞同：4
> 
> 时间：2009-04-23T01:12:46.850
> 
> 标签：asp.net, mysql, locking, scalability

是否有众所周知的跨服务器场同步任务的最佳实践？例如，如果我有一个基于论坛的网站在服务器场上运行，并且有两个版主试图执行一些需要写入数据库中的多个表的操作，并且这些版主的请求正在由服务器中的不同服务器处理农场，如何实现一些锁定功能以确保他们不能同时对同一个项目执行该操作？

到目前为止，我正在考虑使用数据库中的表进行同步，例如检查表中项目的 ID，如果不存在则插入并继续，否则返回。也可能为此使用共享缓存，但我目前没有使用它。

还有什么办法吗？

顺便说一句，我使用 MySQL 作为我的数据库后端。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T12:59:28.907

您的问题暗示数据级并发控制——在这种情况下，使用 RDBMS 的并发控制机制。

如果稍后您希望控制不一定一对一映射到数据实体（例如表记录访问）的应用程序级操作，那将无济于事。一般的解决方案是有一个反向代理服务器，它理解应用程序级别的语义并在必要时进行相应的序列化。（这将对可用性产生负面影响。）

阅读 CAP 定理可能也不会有什么坏处！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-23T01:25:55.010

您可能想要研究分布式锁定服务，例如[Zookeeper](http://hadoop.apache.org/zookeeper/)。它是 Google 服务的重新实现，可为应用程序提供非常高速的分布式资源锁定协调。不过，我不知道将其整合到网络应用程序中会有多容易。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-23T01:18:26.510

如果所有状态都在（中央）数据库中，那么数据库事务应该为您处理这些。

见[http://en.wikipedia.org/wiki/Transaction_(database)](http://en.wikipedia.org/wiki/Transaction_(database))

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-08-20T07:57:20.883

它可能对你无关紧要，因为这个问题很老，但它仍然可能对其他人有用，所以我还是会发布它。

您可以在锁定对象上使用“SELECT FOR UPDATE”数据库查询，因此您实际上使用数据库来实现锁定机制。

如果你使用 ORM，你也可以这样做。例如，在 nhibernate 中，您可以执行以下操作：

```
session.Lock(Member, LockMode.Upgrade); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-23T06:59:44.147

拥有一张锁表是一种不错的方法，它既简单又有效。

您还可以将代码作为单一服务器上的服务，更像是一种 SOA 方法。

您还可以将 TimeStamp 字段与 Transactions 一起使用，如果自上次获取数据以来时间戳已更改，您可以恢复事务。因此，如果有人先进入，他们就有优先权。

# variables - 身份证，身份证，还是身份证？

> ID：779929
> 
> 赞同：34
> 
> 时间：2009-04-23T01:13:35.337
> 
> 标签：variables, naming-conventions

我`camelCase`在我的代码和数据库字段名称等中使用，但是对于最后的字段`Id`，它总是最终难以阅读。例如，`itemId`、`teacherId`、`unitId`等。在这些情况下，我考虑打破常规并编写`itemID, teacherID, or unitID`只是为了提高可读性。

你做什么？处理这个问题的一般最佳实践是什么？

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2009-04-23T01:31:46.040

Id 是缩写，而不是首字母缩略词，所以我将其命名为“Id”。UI 是首字母缩略词，而首字母缩略词——无论如何都是短的——大写：“UI”。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2009-04-23T01:20:37.283

这是我所做的一个示例：

```
id
userId
getUserId 
```

关键是保持一致。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-04-23T01:15:57.140

我做我想做的事。一般来说，你的最佳实践是倾向于可读性而不是遵守一些抽象标准。

只要保持一致。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-04-23T01:36:41.630

我实际上更喜欢“ID”。但是，正如大家所说，一致性是最重要的。

史蒂夫

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-04-23T01:18:11.313

Id，与标识符一样。Microsoft 建议的命名约定表明这是推荐的做法，并且使用代码分析进行编译将支持这一点。如果 ID 代表分别以 I 和 D 开头的两个单词，那么您将使用 ID，并且您真的不应该使用以小写字母开头但在参数中的名称。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-04-23T01:18:20.987

没关系，*只要您在整个程序中保持一致即可*。

话虽如此，我会选择“Id”。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-04-23T01:16:44.780

我也使用驼峰式，如果名称以 Id 结尾，我也会使用它。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-04-23T01:17:05.640

ID

这是我对主观问题的主观回答。

我已将其标记为 CW。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-04-23T01:22:11.523

我在所有表名中都使用下划线，所以 user_id。即使 id 是独立的，它也是小写的。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-04-23T03:16:08.067

我会在这里被投票，但我不在乎！

这显然是[id](http://en.wikipedia.org/wiki/Id_Software)。来自深处的想法！

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-04-23T04:17:47.437

它的发音是“eye dee”，而不是“id，如 id、ego 和 superego”，所以是 ID，而不是 Id。无论如何，这是我的投票。由于它的发音方式，它是缩写而不是首字母缩略词的事实是无关紧要的。它的发音好像是首字母缩写词，因此也可以这样输入。哦，骆驼案是计算史上最糟糕的想法。:)

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-04-23T14:24:12.110

数据库列和对象属性中的 ID。参数中的id：

```
this.ID == id 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-04-23T01:18:10.643

我认为可读性是最重要的，如果它要让它更容易阅读，应该覆盖你的约定。我认为如果你不能轻易阅读它，那么坚持你的枪支/约定的弊大于利（就像我们程序员讨厌打破约定和协议一样）。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-04-23T02:23:23.827

在[Machine SUIF](http://www.eecs.harvard.edu/hube/software/nci/overview.html)中，Mike Smith 和 Glenn Holloway*严格*执行大写字母标记新单词的大小写约定。因此，即使 CPS 是首字母缩略词，它也是`transformToCps`而不是`transformToCPS`. 我发现，从长远来看，他们的方法比我们在[Quick C--](http://www.cminusminus.org)中所做的更好，在 Quick C-中，我们通常对 ID 和 CPS 等案例进行全部大写。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-04-23T03:28:10.957

FxCop/代码分析会将 ID 标记为错误的缩写，因此如果您想避免禁用规则，您可能会因此而符合并使用 Id。但同样，这真的没关系，只要你是一致的，正如其他人所指出的那样。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-04-23T03:41:47.693

只要您在自己的程序中保持一致，您就可以接受任何事情。（如果你在一个团队中工作，你应该遵循团队的规则或设置一些）。

没有提到的一点是获得好字体的重要性。这将对您的程序可读性产生奇迹，并且您的约定问题可能部分是字体问题：

如果你不能轻易区分**Id**和**ld** `(Id and ld)`，你应该改变字体，也许也改变字体大小。就个人而言，我喜欢康索拉斯。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-04-23T04:06:50.223

我同意其他答案，即最重要的是要保持一致。

我要补充一点，如果您的特定代码库没有既定标准，您应该遵循您的语言或平台设置的约定。在 Java 中，标识符的首字母缩写词和其他大写单词不大写：

```
id
url
getId()
setUrlParameters() 
```

在 Objective-C 中，情况正好相反。您可能有一个小写的“id”或“url”变量，但您也有如下类：

```
NSURL
NSURLRequest 
```

所以在 Obj-C 中我会选择一个方法名，比如：

```
setURLParameters: 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-04-23T01:17:39.723

我更喜欢使用 Id，在我们公司，标准也是 Id over ID。如果您发现它更易于阅读，我认为使用 ID 没有问题。编译器不在乎 :) 我在模式 Id 列中使用相同的约定。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-04-23T01:22:28.450

不同的语言有不同的指导方针。对于 .NET，您可以阅读[Framework Design Guidelines: Conventions, Idioms, and Patterns for Reusable .NET Libraries](https://rads.stackoverflow.com/amzn/click/com/0321545613)。对于 Java，您可以阅读[Java 编程语言的代码约定](http://java.sun.com/docs/codeconv/)。

* * *

## 回答 #20

> 赞同：-2
> 
> 时间：2009-04-23T05:27:24.710

“身份证”是模棱两可的。它是人类心灵“自我”/“超我”模型的一部分吗？可能不是：您可能正在尝试缩写单词，例如“身份”或“身份”或“标识符”。

通过确定您的意思然后**不要缩写**来消除歧义（和大小写问题） 。

# magento - 如何在 Magento 中允许重复 SKU

> ID：779946
> 
> 赞同：1
> 
> 时间：2009-04-23T01:20:29.610
> 
> 标签：magento, e-commerce

我有一个零售第三方电池的客户，有些电池可以替换几个 OEM 型号。

例如，第 3 方 SKU 12345 可以替换东芝 N23 和 HP 53214，因此我的客户想在前端创建两个具有相同 SKU 的产品（它们本质上是相同的产品）。但是，Magento 默认情况下不允许重复 SKU。

我目前的解决方案是从后端将 SKU 设置为不需要，并添加另一个名为 Model 的允许重复值的属性，并在前端显示 Model。

有一个更好的方法吗？或者是否可以允许重复的 SKU？

天博
[来宝科技](http://www.noble.sg/)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-23T12:45:44.063

在我看来，您已经找到了一个很好的解决方案。我不太确定您是否应该尝试为 SKU 设置重复值，原因有两个。

首先，SKU 的全部意义在于它是一个唯一标识符。这是它存在的唯一理由。如果您将有重复的值，那么它不是唯一标识符；这只是另一个属性。但是当然，Magento 仍然需要一个唯一标识符才能工作，这意味着这是一个额外的字段，它会将我们带到您现在所在的位置。

这就是说我们来到了我的第二点，那就是......我不完全是 Magento 大师，但我已经建立了我的电子商务网站份额，我学到的一件事是它们依赖于某些牢不可破的规则正常工作。其中之一是唯一标识符在数据库和应用程序级别都是*唯一的。*因此，网站的很大一部分都依赖于此才能正常运行。我很确定 Magento 也是如此。

因此，试图在如此复杂的事物中改变这样一个基本前提只会导致恐惧和缓慢陷入疯狂。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-03-11T13:13:05.133

这听起来像是一个很好的解决方案，我进一步扩展了一点，但是我对多个商店所做的是创建一个可见属性 ITEM_SKU（项目 SKU） - 使其可见和可搜索，然后将 store_id 连接到 Magneto SKU 以使其独一无二。所以 SKU 变为 (Store_id "-" SKU)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-11-01T23:49:45.803

Why don't you create 1 product (SKU 12345) and list this product in multiple categories. So your multiple categories will be Toshiba and HP. The same product (SKU 12345) will be listed in Toshiba and HP.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-01-19T21:11:38.757

令我惊讶的是，人们愿意打破 Magento 的不知道哪些部分，只是为了让特定的部分按照他们的期望工作。

允许重复 sku 的正确方法不是（除非您想重写框架的大部分内容）。但是，您可以将自定义属性添加到与“sku”共享所有相同设置的产品中，减去要求值唯一的设置。

更改产品页面、电子邮件等以显示此值将需要一些额外的工作，但以后会为您省去麻烦。

# javascript - javascript字符串是否需要“转义”字符“<”和“>”？

> ID：779959
> 
> 赞同：17
> 
> 时间：2009-04-23T01:27:41.853
> 
> 标签：javascript, html, xss, encode

有时，服务器端会生成嵌入到内联 JavaScript 代码中的字符串。例如，如果“用户名”应该由 ASP.NET 生成。然后看起来像。

```
<script>
   var username = "<%UserName%>";
</script> 
```

这是不安全的，因为用户可以拥有他/她的名字

`</script><script>alert('bug')</script></script>`

这是XSS漏洞。

所以，基本上，代码应该是：

```
<script>
   var username = "<% JavascriptEncode(UserName)%>";
</script> 
```

**JavascriptEncode**所做的是在“/”和“'”和“””之前添加字符“\”。因此，输出html就像.var username = "</script>alert(\'bug\')</script ></脚本>";

浏览器不会将“ ***</script>*** ”解释为脚本块的结尾。所以，XSS 在避免。

但是，那里仍然有“<”和“>”。建议也转义这两个字符。首先，我不认为将“<”更改为“<”是一个好主意 和 ">" 到 ">" 这里。而且，我不确定将“<”更改为“\<”和将“>”更改为“\>”是否可以被所有浏览器识别。似乎没有必要对“<”和“>”进行进一步的编码。

对此有什么建议吗？

谢谢。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-23T08:06:50.647

根据您使用的标记语言，该问题有不同的答案。

如果您使用的是 HTML，那么您不能用实体来表示它们，因为脚本元素被标记为包含 CDATA。

如果您使用的是 XHTML，那么您可以将它们表示为带有显式 CDATA 标记的 CDATA，或者您可以将它们表示为实体。

如果您使用 XHTML，但将其作为 text/html 提供，那么您需要编写符合 XHTML 规则但仍可使用 text/html 解析器的内容。这通常意味着使用显式 CDATA 标记并在 JavaScript 中将它们注释掉。

```
<script type="text/javascript">
// <![CDATA[
  …
// ]]>
</script> 
```

前段时间，我写了一些关于[这个的方法和原因的](http://dorward.me.uk/www/comments-cdata/)文章。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-05-25T20:40:23.047

不，您不应该在 HTML 中转义`<`和`>`使用 HTML 实体`<script>`。

*   使用 JavaScript 字符串转义规则（`\`用`\\`和`"`替换`\"`）
*   *并将*所有出现的 , 替换为`</`,`<\/`以防止逃出`<script>`元素。

在 XHTML 中它更复杂。

*   如果您将 XHTML 作为 XML 发送（与 IE 不兼容的方式）并且不使用 CDATA 块，那么除了 JavaScript 字符串转义之外，您还需要转义实体。
*   如果您将 XHTML 作为 XML 发送并使用 CDATA 块，则不要转义实体，而是替换`]]>`为`]]]]><![CDATA[>`以防止转义（除了 JavaScript 字符串转义）。
*   如果您发送 XHTML `text/html`（99% 的人都这样做），那么您必须同时使用 XML CDATA 块、XML CDATA 转义和 HTML 转义。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-10-02T19:11:39.533

便宜又简单的方法：

```
<script type="text/javascript">
    var username = "<%= Encode(UserName) %>";
</script> 
```

其中的编码方案`Encode`是将输入的每个字符转换为`\xABCD`与 JavaScript 兼容的相关表示。

另一种便宜又简单的方法：

```
<script type="text/javascript">
    var username = decodeBase64("<%= EncodeBase64(UserName) %>");
</script> 
```

如果您只处理 ASCII。

当然，`pst`以严格的方式一针见血。

# linux - 遗留 gcc 编译器问题

> ID：779964
> 
> 赞同：7
> 
> 时间：2009-04-23T01:30:40.770
> 
> 标签：linux, gcc, legacy, cross-compiling, virtual-memory

我们正在使用基于 gcc 2.6.0 的旧版编译器来交叉编译我们仍在使用的旧嵌入式处理器（是的，它自 1994 年以来仍在使用！）。为这个芯片做 gcc 端口的工程师早就离开了。虽然我们可能能够从网络上的某个地方恢复 gcc 2.6.0 源，但该芯片的更改集已经在公司历史的大厅中消失了。直到最近，我们一直在糊涂，因为编译器仍在运行并生成可运行的可执行文件，但从 linux 内核 2.6.25（以及 2.6.26）开始，它会失败并显示消息`gcc: virtual memory exhausted`... 即使在没有参数或仅使用`-v`. 我已经使用 2.6.24 内核重新启动了我的开发系统（从 2.6.26 开始）并且编译器再次工作（使用 2.6.25 重新启动不会）。

我们有一个系统保持在 2.6.24，只是为了构建这个芯片，但是感觉有点暴露，以防 linux 世界发展到我们不能再重建一个可以运行的系统编译器（即我们的 2.6.24 系统死掉了，我们无法在新系统上安装和运行 2.6.24，因为某些软件部分不再可用）。

有没有人知道我们可以对更现代的安装做些什么来让这个遗留编译器运行？

**编辑**：

回答一些评论...

可悲的是，丢失了特定于我们芯片的源代码更改。这种损失发生在两个主要的公司重组和几个系统管理员（其中几个确实留下了一个烂摊子）。我们现在使用配置控制，但这对于这个问题来说太迟了。

使用虚拟机是一个好主意，并且可能是我们最终要做的事情。谢谢你的想法。

最后，我按照ehemient的建议尝试了strace，发现最后一个系统调用是brk()，在新系统（2.6.26内核）上返回错误，在旧系统（2.6.24内核）上返回成功。这表明我的虚拟内存真的用完了，除了 tcsh "limit" 在旧系统和新系统上返回相同的值，并且 /proc/meminfo 显示新系统有更多的内存和更多的交换空间。也许是碎片问题或程序加载的位置？

我做了一些进一步的研究，并在内核 2.6.25 中添加了“brk 随机化”，但`CONFIG_COMPAT_BRK`据说默认启用（禁用 brk 随机化）。

**编辑**：

好的，更多信息：看起来 brk 随机化确实是罪魁祸首，旧版 gcc 正在调用 brk() 来更改数据段的结尾，现在失败了，导致旧版 gcc 报告“虚拟内存耗尽”。有一些记录在案的方法可以禁用 brk 随机化：

*   `sudo echo 0 > /proc/sys/kernel/randomize_va_space`

*   `sudo sysctl -w kernel.randomize_va_space=0`

*   `setarch i386 -R tcsh`用（或“-R -L”）开始一个新的shell

我已经尝试过它们，它们似乎确实有效果，因为 brk() 返回值与没有它们时不同（并且始终相同）（在内核 2.6.25 和 2.6.26 上都尝试过），但是 brk()仍然失败，所以旧版 gcc 仍然失败:-(。

此外，我已经设置`vm.legacy_va_layout=1`并且`vm.overcommit_memory=2`没有任何更改，并且我已经使用/etc/sysctl.conf 中保存的设置`vm.legacy_va_layout=1`重新启动。`kernel.randomize_va_space=0`还是没有变化。

**编辑**：

在内核 2.6.26（和 2.6.25）上使用`kernel.randomize_va_space=0`会导致以下 brk() 调用被报告`strace legacy-gcc`：

`brk(0x80556d4) = 0x8056000`

这表明 brk() 失败，但看起来它失败了，因为数据段已经超出了请求的范围。使用 objdump，我可以看到数据段应该在 0x805518c 结束，而失败的 brk() 表明数据段当前在 0x8056000 结束：

```
部分：
Idx 名称大小 VMA LMA 文件关闭 Algn
  0 .interp 00000013 080480d4 080480d4 000000d4 2**0
                  内容、分配、加载、只读、数据
  1 .hash 000001a0 080480e8 080480e8 000000e8 2**2
                  内容、分配、加载、只读、数据
  2 .dynsym 00000410 08048288 08048288 00000288 2**2
                  内容、分配、加载、只读、数据
  3 .dynstr 0000020e 08048698 08048698 00000698 2**0
                  内容、分配、加载、只读、数据
  4.rel.bss 00000038 080488a8 080488a8 000008a8 2**2
                  内容、分配、加载、只读、数据
  5.rel.plt 00000158 080488e0 080488e0 000008e0 2**2
                  内容、分配、加载、只读、数据
  6 .init 00000008 08048a40 08048a40 00000a40 2**4
                  内容、分配、加载、只读、代码
  7.plt 000002c0 08048a48 08048a48 00000a48 2**2
                  内容、分配、加载、只读、代码
  8 .文本 000086cc 08048d10 08048d10 00000d10 2**4
                  内容、分配、加载、只读、代码
  9.fini 00000008 080513e0 080513e0 000093e0 2**4
                  内容、分配、加载、只读、代码
 10 .rodata 000027d0 080513e8 080513e8 000093e8 2**0
                  内容、分配、加载、只读、数据
 11 .数据 000005d4 08054bb8 08054bb8 0000bbb8 2**2
                  内容、分配、加载、数据
 12 .ctors 00000008 0805518c 0805518c 0000c18c 2**2
                  内容、分配、加载、数据
 13 .dtors 00000008 08055194 08055194 0000c194 2**2
                  内容、分配、加载、数据
 14.得到000000b8 0805519c 0805519c 0000c19c 2**2
                  内容、分配、加载、数据
 15.动态00000088 08055254 08055254 0000c254 2**2
                  内容、分配、加载、数据
 16 .bss 000003b8 080552dc 080552dc 0000c2dc 2**3
                  分配
 17 .注 00000064 00000000 00000000 0000c2dc 2**0
                  内容，只读
 18 .comment 00000062 00000000 00000000 0000c340 2**0
                  内容，只读
符号表：
没有符号

```

**编辑**：

在下面回应 ehemient 的评论：“将 GCC 视为没有源代码的二进制文件真是太奇怪了”！

因此，使用 strace、objdump、gdb 以及我对 386 汇编器和体系结构的有限理解，我将问题追溯到遗留代码中的第一个 malloc 调用。旧版 gcc 调用 malloc，它返回 NULL，这会导致 stderr 上出现“虚拟内存耗尽”消息。这个 malloc 在 libc.so.5 中，它多次调用 getenv 并最终调用 brk()...我想增加堆...失败了。

由此我只能推测问题不仅仅是 brk 随机化，或者我没有完全禁用 brk 随机化，尽管 randomize_va_space=0 和 legacy_va_layout=1 sysctl 设置。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-23T01:34:24.740

将 linux + 旧的 gcc 安装到虚拟机上。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-23T01:36:25.297

你有这个自定义编译器的*源代码吗？*如果您可以恢复 2.6.0 基线（这应该相对容易），那么 diff 和 patch 应该可以恢复您的更改集。

然后我建议使用该更改集针对最新的 gcc 构建新版本。然后将其置于配置控制之下。

对不起，不想大喊大叫。只是我在 30 年的大部分时间里一直在说同样的话。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-23T15:57:05.073

`strace`可执行文件可以`gcc-2.6.0`吗？它可能正在做一些类似阅读的事情`/proc/$$/maps`，并且当输出以微不足道的方式发生变化时会感到困惑。最近在 2.6.28 和 2.6.29 之间[发现](http://bugzilla.kernel.org/show_bug.cgi?id=13019)了一个类似的问题。

如果是这样，您可以破解`/usr/src/linux/fs/proc/task_mmu.c`或在附近恢复旧的输出，或设置一些`$LD_PRELOAD`假`gcc`以读取另一个文件。

### 编辑

既然你提到`brk`...

`CONFIG_COMPAT_BRK`使用默认值`kernel.randomize_va_space=1`而不是，但这仍然会随机化除堆 ( )`2`以外的所有内容。`brk`

`echo 0 > /proc/sys/kernel/randomize_va_space`如果您或`sysctl kernel.randomize_va_space=0`（等效），请查看您的问题是否消失。

如果是这样，添加或添加`kernel.randomize_va_space = 0`到内核命令行（等效），并再次感到高兴。`/etc/sysctl.conf``norandmaps`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-24T15:03:17.410

我遇到了[这个](http://www.arm.linux.org.uk/docs/faqs/misc.php)并考虑了你的问题。也许您可以找到一种方法来使用二进制文件将其转换为 ELF 格式？或者可能是无关紧要的，但使用 objdump 可以为您提供更多信息。

你能看看进程内存映射吗？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-27T17:03:24.023

所以我已经解决了一些问题......这不是一个完整的解决方案，但它确实解决了我在使用旧版 gcc 时遇到的原始问题。

在.plt（过程链接表）中的每个libc调用上放置断点我看到malloc（在libc.so.5中）调用getenv（）来获取：

```
    MALLOC_TRIM_THRESHOLD_
    MALLOC_TOP_PAD_
    MALLOC_MMAP_THRESHOLD_
    MALLOC_MMAP_MAX_
    MALLOC_CHECK_

```

所以我在网上搜索了这些并发现[了这个](http://www.nersc.gov/vendor_docs/cray/malloc.txt)建议

```
    setenv MALLOC_TOP_PAD_ 536870912

```

那么遗留的 gcc 工作！！！！

但不是免费的，它在失败之前就连接到了构建中的链接，所以我们拥有的传统 nld 有一些进一步的进展:-( 它正在报告：

```
    “新”中超出虚拟内存

```

在 /etc/sysctl.conf 我有：

```
    kernel.randomize_va_space=0
    vm.legacy_va_layout=1

```

如果它仍然有效

```
    kernel.randomize_va_space=1
    vm.legacy_va_layout=0

```

但不是如果

```
kernel.randomize_va_space=2
```

有人建议使用“ldd”查看共享库依赖项：旧版 gcc 只需要 libc5，但旧版 nld 还需要 libg++.so.27、libstdc++.so.27、libm.so.5，显然有libg++.so.27 (libg++27-altdev ??) 的 libc5 版本，那么 libc5-compat 呢？

所以，正如我所说，还没有回家……越来越近了。我可能会发布一个关于 nld 问题的新问题。

**编辑**：

我原本打算避免“接受”这个答案，因为我仍然对相应的遗留链接器有问题，但为了至少在这个问题上获得一些最终结果，我正在重新考虑这个立场。

谢谢你出去：

*   an0nym0usc0ward 建议使用虚拟机（最终可能成为接受的答案）
*   建议使用 strace 并帮助使用 stackoverflow
*   shodanex 建议使用 objdump

**编辑**

下面是我最后学到的东西，现在我将接受 VM 解决方案，因为我无法以任何其他方式完全解决它（至少在为此分配的时间内）。

较新的内核有一个 CONFIG_COMPAT_BRK 构建标志来允许使用 libc5，所以大概用这个标志构建一个新内核会解决这个问题（并且通过内核 src，它看起来会，但我不能确定，因为我做了不要遵循所有的路径）。还有另一种记录方式允许在运行时（而不是在内核构建时）使用 libc5：sudo sysctl -w kernel.randomize_va_space=0。然而，这并不能完成一项完整的工作，一些（大多数？）libc5 应用程序仍然会中断，例如我们的旧版编译器和链接器。这似乎是由于新旧内核之间的对齐假设存在差异。我已经修补了链接器二进制文件，使其认为它具有更大的 bss 部分，以便将 bss 的末尾带到页面边界，并且当 sysctl var 内核时，这适用于较新的内核。randomize_va_space=0。这对我来说不是一个令人满意的解决方案，因为我盲目地修补一个关键的二进制可执行文件，即使在较新的内核上运行修补的链接器会产生与在旧内核上运行的原始链接器相同的输出，但这并不能证明其他一些链接器输入（即我们更改被链接的程序）也会产生相同的结果。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-23T01:36:49.413

难道你不能简单地制作一个可以在系统死机时重新安装的光盘映像吗？或者做一个虚拟机？

# java - 空白表单文本框

> ID：779970
> 
> 赞同：0
> 
> 时间：2009-04-23T01:33:08.423
> 
> 标签：java

我正在重新填充用户之前使用 HTTP 会话填写的表单字段。我正在通过 servlet 从表单中获取字段：

```
//On servlet
String polyNum = request.getParameter("policyNum")
session.setAttribute("policyNum", polyNum);

//On JSP
<td align = "right"><font color = "#FF0000">*</font><font face= "Calibri, Arial" size = "3"> Policy #:</font></td>
<td><input type="text" name= "policyNum" size="19" tabindex = "1" value="
<% out.println(session.getAttribute("policyNum");%>"> 
```

问题：当我运行我的 JSP 页面时，我在表单的文本框中得到一个前导空格。因此，每当我提交表单时，也会将空格插入到数据库中。

有任何想法吗？任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-23T02:25:36.380

你可以这样修剪它：

```
String polyNum = request.getParameter("policyNum");
polyNum = polyNum == null ? null : polyNum.trim();
session.setAttribute("policyNum", polyNum  ); 
```

如果你的jsp看起来像

```
<input type ="text" value="
<%= session.getAttribute( "policyNum" ); %>
"/> 
```

你会得到空格。

你也没有显示你在哪里输入到数据库中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-23T18:27:05.573

事实证明，我的 jsp 页面中的 scriplets 在语法上是错误的。毕竟我不需要修剪空格。我的表格现在工作正常。

您关于 Apache 库的解决方案很有趣 Damo。感谢您的反馈。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-23T01:37:15.543

看一下 String 类中的 .trim() 方法：

[http://java.sun.com/j2se/1.5.0/docs/api/java/lang/String.html#trim()](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/String.html#trim())

“返回字符串的副本，省略前导和尾随空格。”

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-23T09:05:46.760

Apache Commons StringUtils 库非常适合修剪，因为它处理空值。

所以

```
String polyNum = request.getParameter("policyNum");
polyNum = polyNum == null ? null : polyNum.trim(); 
```

可以变成

```
String polyNum = StingUtils.stripToEmpty(request.getParameter("policyNum")); 
```

# php - 使用 PHP 的 WebDav 连接/身份验证

> ID：779973
> 
> 赞同：1
> 
> 时间：2009-04-23T01:35:12.677
> 
> 标签：php, http, webdav, remote-access, icalendar

好的，所以 PHP 脚本存在于 serverA 上。ServerA 有 php 安全模式 ON 和 WebDAV OFF。我无法改变这两个因素中的任何一个。我想在 serverA 上创建一个脚本来获取另一台服务器的用户登录名/密码，我们称之为 serverB。ServerB 已开启 WebDAV。

最终目标是用户将转到 ServerA 上的脚本，为 ServerB 输入他们的凭据，然后脚本将创建一个 iCal 文件并将其放在 ServerB 上，然后允许用户使用 Outlook/订阅 iCal 文件GoogleCalendar 等（要求文件位于 WebDAV 服务器上）。

所以，我尝试了

```
fopen(servername/filename, r) 
```

并且能够读取远程服务器上的文件。但是当我尝试

```
fopen(servername/filename, w) 
```

我收到一个错误，即 HTTP 包装器不支持写入，只支持读取。

长话短说，有没有办法连接到该服务器并进行身份验证，写入文件，然后关闭连接，而不使用任何已经存在的 PHP WebDAV 库，并且不会遇到安全模式权限错误？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-23T03:22:45.447

问题是 PHP 的 HTTP 协议包装器不执行 PUT。您应该尝试使用 fsockopen 或最好使用 curl 之类的东西编写自己的代码。

[http://ca3.php.net/manual/en/wrappers.http.php](http://ca3.php.net/manual/en/wrappers.http.php)

这与安全模式无关。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-23T02:18:25.727

这里的问题是安全模式旨在限制您，因此您无法在“安全”区域之外执行操作。

您可以尝试（如果可以）修改[`safe_mode_exec_dir`](http://is.php.net/manual/en/ini.sect.safe-mode.php#ini.safe-mode-exec-dir)php.ini 中的内容，然后您可以启动可以为您编写文件的外部程序（如果它们位于此安全模式目录中）

关于身份验证，我不确定，也许有人可以更详细地回答。

# linux - 放入手册页的最佳实践

> ID：779975
> 
> 赞同：4
> 
> 时间：2009-04-23T01:35:51.460
> 
> 标签：linux, unix, manpage

是否有编写手册页的最佳实践指南？

布局中应该包括什么？标准的有：
**名称
概要
描述
示例
参见** 

还有其他像**OPTIONS**，**AUTHOR**。

作为用户，拥有什么有用？什么没有帮助？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-23T01:51:24.307

如果您找不到任何 1970 年代贝尔实验室“troff”文档的旧装订副本，其中有一些关于编写手册页的不错的部分，:-) 那么我建议在 Jens 的网站[上尝试编写手册页的“HOWTO”](http://www.schweikhardt.net/man_page_howto.html)。

* * *

[Unix 第 7 版](http://plan9.bell-labs.com/7thEdMan/)手册以多种格式在线提供。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-23T01:43:16.963

BUGS 部分很好，EXAMPLES 部分总是有用的。一些手册页包含列出相关配置文件的 FILES 部分，或详细说明任何有影响的环境变量的 ENVIRONMENT 部分。

需要明确的是，哪些部分或类型的信息对用户有用取决于您正在记录的程序或实用程序的性质。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-23T01:51:36.243

有一个随 UNIX 系统分发的规范手册页大纲，或者至少通常有。一般来说，我会填写所有字段，如果不适用，请添加“无”之类的行。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-10-26T03:53:56.063

人们有时忘记放入手册页的一件事是函数返回值的含义。这很容易忘记，但是对于必须使用您的功能的人来说，遗漏会使生活变得更加困难。此外，SYNOPSIS 中的简单代码段或良好的最小工作示例非常有用。

我经常对手册页做的一件事是尝试找到相关的命令，即使我知道我正在查看的内容并没有达到我想要的效果。在这种情况下，SEE ALSO 很棒。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-23T01:39:43.867

这取决于你的软件是做什么的。如果它是一个小型的独立应用程序，我当然会将 AUTHOR 部分放在手册页中，这样如果用户发现错误，他们可以轻松找到电子邮件地址向您报告错误。

至于最佳实践，我不知道，除了手册页应该简洁、详细但不包含太多不需要的信息，例如，如果它只是一个工具，则不需要内部工作。

# c# - 使用 C# 和 XDocument/XElement 解析 Soap 响应

> ID：779976
> 
> 赞同：7
> 
> 时间：2009-04-23T01:35:52.147
> 
> 标签：c#, xml, soap, parsing

这是来自我的 SuperDuperService 的示例肥皂响应：

```
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
    <soap:Body>
        <MyResponse xmlns="http://mycrazyservice.com/SuperDuperService">
            <Result>32347</Result> 
        </MyResponse>
    </soap:Body>
</soap:Envelope> 
```

出于某种原因，当我尝试获取“结果”的后代或元素时，我得到空值。它与命名空间有关吗？有人可以提供一个解决方案来从中检索 Result 吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-23T01:45:33.090

您可能想尝试这样的事情：

```
string myNamespace= "http://mycrazyservice.com/SuperDuperService";

var results = from result in yourXml.Descendants(XName.Get("MyResponse", myNamespace))
              select result.Element("Result").value 
```

这台笔记本电脑上没有 VS，所以我无法仔细检查我的代码，但它应该使用 LINQ to SQL 为您指明正确的方向。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2014-02-18T02:51:30.287

用经过测试的代码扩展贾斯汀的答案，返回一个布尔值，并且响应和结果以方法名称开头（顺便说一句 - 甚至认为 XML 元素在解析时没有显示它需要的 NS）：

```
 private string ParseXml(string sXml, string sNs, string sMethod, out bool br)
    {
        br = false;
        string sr = "";
        try
        {
            XDocument xd = XDocument.Parse(sXml);

            if (xd.Root != null)
            {
                XNamespace xmlns = sNs;
                var results = from result in xd.Descendants(xmlns + sMethod + "Response")
                              let xElement = result.Element(xmlns + sMethod + "Result")
                              where xElement != null
                              select xElement.Value;
                foreach (var item in results)
                    sr = item;
                br = (sr.Equals("true"));
                return sr;
            }
            return "Invalid XML " + Environment.NewLine + sXml;
        }
        catch (Exception ex)
        {
            return "Invalid XML " + Environment.NewLine + ex.Message + Environment.NewLine + sXml;
        }
    } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-23T13:25:33.953

也许是这样的：

```
IEnumerable<XElement> list = doc.Document.Descendants("Result");
if (list.Count() > 0)
{
    // do stuff
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-01-17T22:38:15.493

您正在寻找正确的方向，它肯定与命名空间有关。

下面的代码返回为命名空间和元素名称的组合找到的第一个元素。

```
XDocument doc = XDocument.Load(@"c:\temp\file.xml");
XNamespace ns = @"http://mycrazyservice.com/SuperDuperService";
XElement el = doc.Elements().DescendantsAndSelf().FirstOrDefault( e => e.Name == ns + "Result"); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-06-29T14:50:09.023

你可以试试这个。

```
Regex regex = new Regex("<Result>(.*)</Result>");
                var v = regex.Match(yourResponse);
                string s = v.Groups[1].ToString(); 
```

# c# - C# 在全行业流行还是非典型？

> ID：779979
> 
> 赞同：12
> 
> 时间：2009-04-23T01:36:37.417
> 
> 标签：c#, c++, coding-style

我觉得我是一个全面的程序员，我对 C# 和 java（几个大型项目都有）很熟悉，但是当我有选择的时候，我倾向于将 C++ 用于大多数应用程序。（有时是 R、Python 或 Perl，视情况而定..）

但是我很惊讶地看到 C# 在 SO 上的流行。有 18500 个 C# 主题，超过 C、C++ 和 java 的总和。我从来没有*觉得*C# 对我合作过的公司有如此大的影响，但 C# 的如此受欢迎是不可否认的。

我的问题： **为什么 C# 在 Stack Overflow 上如此受欢迎？** 与 C++ 和 java 相比，我的问题**与其说**是一个 SO 问题，不如说是想了解 C# 当前的接受度/增长情况。

流行的可能解释：

*   C# 在工业界确实如此流行和接受，它无处不在！
*   SO 并不典型，它似乎吸引了不成比例的 C# 用户
*   C# 有更多需要社区帮助解决的问题/困惑
*   微软（也许在它的论坛上？）鼓励人们使用 SO 来提问

第一个解释可能是原因，但我只是没有感受到现实世界中的流行！

您在这里讨论 C# 主题的原因是什么？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-23T01:45:05.447

我认为 SO 的创始人是 .Net 大师。大多数关注他们博客的人都发现了这个网站，并开始来到这里。最初的用户群可能非常专注于 .Net/C#。

我还认为 C# 是 .Net 中的首选语言，它具有互操作性和使用旧 C 和 C++ 代码的能力。那些熟悉 C、C++ 和 Java 的人可以很容易地获得一个用 C# 构建和工作的有用应用程序，并且可以肯定它可以在任何安装了适当的 .Net 框架的系统上运行。

而且，C# 听起来很酷。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-23T02:16:17.540

[我在另一个线程](https://stackoverflow.com/questions/575513/why-is-c-suddenly-so-popular/575617#575617)上写了关于 C#的流行，但要讨论它为什么在 SO 上流行，我想说其他人有权使用它。C# 在这里很受欢迎，因为大多数第一次来到 SO 的人都是在 Jeff Attwood 的博客之后这样做的。我就是这样来到这里的。

问题是，SO 确实是语言中立的，即使它是*用*C# 编写的。Jeff 和 Joel 都用其他语言编程过，在语言方面几乎不是偏执狂。他们之所以选择 C#，是因为它确实是一种令人惊叹的编程语言。

将 C# 与 Java 和 C++ 进行比较，其增长令人震惊。首次引入 C# 时，它基本上是带有更好 GUI 库的 Java（Win.Forms 在任何一天都击败了 Swing 中令人爱不释手的鼻涕，IMO 和 WPF 在两者之上是头肩并肩）和一些额外的概念，其中最大的是作为一等公民的代表和财产。从那时起，它飞速发展，不断添加更新和更好的东西。LINQ 的整个概念彻底改变了我处理迭代的方式。将它与用于基于契约的进程间/计算机通信的 WCF 和用于构建 GUI 的真正惊人方式的 WPF 相结合，您就拥有了坚如磐石的语言和库。

该死，仅 WCF 就使 .NET 成为正确的企业/SOA 选择。

相比之下，Java 已经有 5 年没有发布新版本了？

C# 正在创新。Java 停滞不前。C++ 是......好吧，我们称它为“稳定的”，好吗？被称为“C++0x”的最新版本很快将需要被称为“C++1x”。计划中的功能需要对运行时进行如此多的更改，以至于当您完成后几乎将拥有 Java 或 C#，那么为什么还要麻烦呢*？*

最后，为了回答你的最后一个问题，我来这里回答任何主题的问题。我更喜欢处理抽象问题而不是特定于语言的问题，但无论语言如何，我总是愿意提供帮助。仅仅因为我喜欢 C# 并不意味着它就是我所知道的全部。:)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-23T01:45:33.760

我认为这是原因 2 和 3 的组合。据我所见，C# 不如 Java 流行，它可能不如 C++ 流行。

在我居住的地方，大多数人使用 Java，其次是 CPP，然后是 C#。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-23T01:59:41.480

是非典型的。

C# 非常流行，但 StackOverFlow 绝不是全行业的反映。

Dup：[为什么 C# 问题的比例如此之大？](https://stackoverflow.com/questions/352882/why-is-there-such-a-large-percentage-of-c-questions)

相关：[为什么 Ruby 的项目似乎比其他编程语言少？](https://stackoverflow.com/questions/242094/why-does-ruby-seem-to-have-fewer-projects-than-other-programming-languages)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-23T01:47:09.060

我主要避免使用 C#，因为（a）我对~~伪装成~~操作系统的程序加载器的腺体怪胎有一种愚蠢的偏见——我只是不*使用*Windows，并且（b）因为它非常像 Java我很难在脑海中将它们分开。

也就是说，有很多 C# 正在完成，如果我不是一个老手，它可能会是一门好语言。

问题是 C++ 没有辅助轮。这使得它在某些方面变得更好——我帮助构建了 C++ 中的 AS/400 操作系统，裸机——但对于大多数人大部分时间都在进行的那种应用程序编程来说并不那么好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-23T01:41:41.087

这真的取决于你是否打算使用 Windows。如果您更喜欢 Linux 或 mac，那么您可能想要使用另一种语言（尽管您可以使用 Mono.NET）。我只使用 C# 主要有 3 个原因：

1.  简单易学
2.  便于使用
3.  易于部署

但是，如果您更喜欢其他语言，请使用它。现在我正在学习 C，以便我可以为一些我最喜欢的开源 linux 应用程序做出贡献。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-23T01:47:09.670

我想这部分是由于人们通过 Jeff Atwood 的博客和 Joel Spolsky 的网站知道该网站。

尽管他们的著作不是特定于技术的，但它倾向于 MS 堆栈，因此该站点在从事 MS 工具/语言套件的开发人员中很受欢迎。

一旦网站变得更受欢迎并在谷歌中对其他工具的问题排名很高，它也会有更多关于这些主题的问题。

# php - 如何使用 CodeIgniter 框架从数组中插入多行？

> ID：779986
> 
> 赞同：134
> 
> 时间：2009-04-23T01:39:06.257
> 
> 标签：php, mysql, codeigniter, insert, bulkinsert

我正在使用插入命令通过 PHP 将大型数据集传递到 MySQL 表中，我想知道是否可以通过查询一次插入大约 1000 行，而不是将每个值附加到一英里长的字符串的末尾和然后执行它。我正在使用 CodeIgniter 框架，因此我也可以使用它的功能。

* * *

## 回答 #1

> 赞同：241
> 
> 时间：2009-04-23T02:06:55.690

在 MySQL 中，将一条语句与多行组合起来比每行`INSERT`一条语句要快得多。`INSERT`

也就是说，听起来您可能会在 PHP 中遇到字符串处理问题，这实际上是一个算法问题，而不是语言问题。基本上，在处理大字符串时，您希望尽量减少不必要的复制。首先，这意味着您要避免串联。构建大字符串（例如一次插入数百行）的最快和最节省内存的方法是利用`implode()`函数和数组分配。

```
$sql = array(); 
foreach( $data as $row ) {
    $sql[] = '("'.mysql_real_escape_string($row['text']).'", '.$row['category_id'].')';
}
mysql_query('INSERT INTO table (text, category) VALUES '.implode(',', $sql)); 
```

这种方法的优点是您不必复制和重新复制到目前为止与每个连接一起组装的 SQL 语句。相反，PHP在语句中执行此操作*一次。*`implode()`这是一个*很大*的胜利。

如果您有很多列要放在一起，并且一个或多个很长，您还可以构建一个内部循环来执行相同的操作，并使用`implode()`将 values 子句分配给外部数组。

* * *

## 回答 #2

> 赞同：63
> 
> 时间：2012-03-21T12:41:04.673

CodeIgniter 现在支持多个插入/批量插入。

```
$data = array(
   array(
      'title' => 'My title' ,
      'name' => 'My Name' ,
      'date' => 'My date'
   ),
   array(
      'title' => 'Another title' ,
      'name' => 'Another Name' ,
      'date' => 'Another date'
   )
);

$this->db->insert_batch('mytable', $data);

// Produces: INSERT INTO mytable (title, name, date) VALUES ('My title', 'My name', 'My date'), ('Another title', 'Another name', 'Another date') 
```

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2009-04-23T01:59:31.137

您可以使用 mysqli_stmt 类准备查询以插入一行，然后遍历数据数组。就像是：

```
$stmt =  $db->stmt_init();
$stmt->prepare("INSERT INTO mytbl (fld1, fld2, fld3, fld4) VALUES(?, ?, ?, ?)");
foreach($myarray as $row)
{
    $stmt->bind_param('idsb', $row['fld1'], $row['fld2'], $row['fld3'], $row['fld4']);
    $stmt->execute();
}
$stmt->close(); 
```

其中“idsb”是您要绑定的数据类型（int、double、string、blob）。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2011-03-06T22:05:26.280

PHP 5 中的 mysqli 是一个具有一些良好功能的对象，可以让您加快上述答案的插入时间：

```
$mysqli->autocommit(FALSE);
$mysqli->multi_query($sqlCombined);
$mysqli->autocommit(TRUE); 
```

插入多行时关闭自动提交会大大加快插入速度，所以关闭它，然后按上面提到的那样执行，或者只是制作一个字符串（sqlCombined），它是由分号分隔的许多插入语句，多查询可以很好地处理它们。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-04-23T02:06:27.330

你总是可以使用mysql的`LOAD DATA`：

```
LOAD DATA LOCAL INFILE '/full/path/to/file/foo.csv' INTO TABLE `footable` FIELDS TERMINATED BY ',' LINES TERMINATED BY '\r\n' 
```

做批量插入而不是使用一堆`INSERT`语句。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-04-23T02:04:06.337

好吧，您不想执行 1000 次查询调用，但这样做很好：

```
$stmt= array( 'array of statements' );
$query= 'INSERT INTO yourtable (col1,col2,col3) VALUES ';
foreach( $stmt AS $k => $v ) {
  $query.= '(' .$v. ')'; // NOTE: you'll have to change to suit
  if ( $k !== sizeof($stmt)-1 ) $query.= ', ';
}
$r= mysql_query($query); 
```

根据您的数据源，填充数组可能就像打开文件并通过`file()`.

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-07-20T11:28:02.247

```
$query= array(); 
foreach( $your_data as $row ) {
    $query[] = '("'.mysql_real_escape_string($row['text']).'", '.$row['category_id'].')';
}
mysql_query('INSERT INTO table (text, category) VALUES '.implode(',', $query)); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-08-22T10:34:26.657

您可以在 codeigniter 中通过多种方式来实现，例如

> **第**一个循环

```
foreach($myarray as $row)
{
   $data = array("first"=>$row->first,"second"=>$row->sec);
   $this->db->insert('table_name',$data);
} 
```

> **第二**——通过插入批次

```
$data = array(
       array(
          'first' => $myarray[0]['first'] ,
          'second' => $myarray[0]['sec'],
        ),
       array(
          'first' => $myarray[1]['first'] ,
          'second' => $myarray[1]['sec'],
        ),
    );

    $this->db->insert_batch('table_name', $data); 
```

> 第三种方式——通过多值传递

```
$sql = array(); 
foreach( $myarray as $row ) {
    $sql[] = '("'.mysql_real_escape_string($row['first']).'", '.$row['sec'].')';
}
mysql_query('INSERT INTO table (first, second) VALUES '.implode(',', $sql)); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-04-16T13:04:32.047

虽然现在回答这个问题为时已晚。这是我的回答。

如果您使用的是 CodeIgniter，那么您可以使用在 query_builder 类中定义的内置方法。

**$this->db->insert_batch()**

根据您提供的数据生成插入字符串，然后运行查询。您可以将数组或对象传递给函数。下面是一个使用数组的例子：

```
$data = array(
    array(
            'title' => 'My title',
            'name' => 'My Name',
            'date' => 'My date'
    ),
    array(
            'title' => 'Another title',
            'name' => 'Another Name',
            'date' => 'Another date'
    )
);

$this->db->insert_batch('mytable', $data);
// Produces: INSERT INTO mytable (title, name, date) VALUES ('My title', 'My name', 'My date'),  ('Another title', 'Another name', 'Another date') 
```

第一个参数将包含表名，第二个参数是值的关联数组。

[您可以在此处](https://www.codeigniter.com/userguide3/database/query_builder.html)找到有关 query_builder 的更多详细信息

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-05-28T06:44:47.450

我创建了一个执行多行的类，使用如下：

```
$pdo->beginTransaction();
$pmi = new PDOMultiLineInserter($pdo, "foo", array("a","b","c","e"), 10);
$pmi->insertRow($data);
// ....
$pmi->insertRow($data);
$pmi->purgeRemainingInserts();
$pdo->commit(); 
```

其中类定义如下：

```
class PDOMultiLineInserter {
    private $_purgeAtCount;
    private $_bigInsertQuery, $_singleInsertQuery;
    private $_currentlyInsertingRows  = array();
    private $_currentlyInsertingCount = 0;
    private $_numberOfFields;
    private $_error;
    private $_insertCount = 0;

    /**
     * Create a PDOMultiLine Insert object.
     *
     * @param PDO $pdo              The PDO connection
     * @param type $tableName       The table name
     * @param type $fieldsAsArray   An array of the fields being inserted
     * @param type $bigInsertCount  How many rows to collect before performing an insert.
     */
    function __construct(PDO $pdo, $tableName, $fieldsAsArray, $bigInsertCount = 100) {
        $this->_numberOfFields = count($fieldsAsArray);
        $insertIntoPortion = "REPLACE INTO `$tableName` (`".implode("`,`", $fieldsAsArray)."`) VALUES";
        $questionMarks  = " (?".str_repeat(",?", $this->_numberOfFields - 1).")";

        $this->_purgeAtCount = $bigInsertCount;
        $this->_bigInsertQuery    = $pdo->prepare($insertIntoPortion.$questionMarks.str_repeat(", ".$questionMarks, $bigInsertCount - 1));
        $this->_singleInsertQuery = $pdo->prepare($insertIntoPortion.$questionMarks);
    }

    function insertRow($rowData) {
        // @todo Compare speed
        // $this->_currentlyInsertingRows = array_merge($this->_currentlyInsertingRows, $rowData);
        foreach($rowData as $v) array_push($this->_currentlyInsertingRows, $v);
        //
        if (++$this->_currentlyInsertingCount == $this->_purgeAtCount) {
            if ($this->_bigInsertQuery->execute($this->_currentlyInsertingRows) === FALSE) {
                $this->_error = "Failed to perform a multi-insert (after {$this->_insertCount} inserts), the following errors occurred:".implode('<br/>', $this->_bigInsertQuery->errorInfo());
                return false;
            }
            $this->_insertCount++;

            $this->_currentlyInsertingCount = 0;
            $this->_currentlyInsertingRows = array();
        }
        return true;
    }

    function purgeRemainingInserts() {
        while ($this->_currentlyInsertingCount > 0) {
            $singleInsertData = array();
            // @todo Compare speed - http://www.evardsson.com/blog/2010/02/05/comparing-php-array_shift-to-array_pop/
            // for ($i = 0; $i < $this->_numberOfFields; $i++) $singleInsertData[] = array_pop($this->_currentlyInsertingRows); array_reverse($singleInsertData);
            for ($i = 0; $i < $this->_numberOfFields; $i++)     array_unshift($singleInsertData, array_pop($this->_currentlyInsertingRows));

            if ($this->_singleInsertQuery->execute($singleInsertData) === FALSE) {
                $this->_error = "Failed to perform a small-insert (whilst purging the remaining rows; the following errors occurred:".implode('<br/>', $this->_singleInsertQuery->errorInfo());
                return false;
            }
            $this->_currentlyInsertingCount--;
        }
    }

    public function getError() {
        return $this->_error;
    }
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-03-06T11:46:16.383

在 codeigniter 中使用 insert batch 插入多行数据。

```
$this->db->insert_batch('tabname',$data_array); // $data_array holds the value to be inserted 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-01-24T16:33:42.263

我不得不在一个表中插入超过 14000 行，并发现使用 Mysqli 准备好的语句的每一行花费了十多分钟，而使用相同 Mysqli 准备好的语句的字符串参数解包参数不到 10 秒。我的数据非常重复，因为它是 id 的倍数和一个常量整数。

10分钟代码：

```
 $num = 1000;
            $ent = 4;
            $value = ['id' => 1,
                      'id' => 2,
                      'id' => 3,
                      'id' => 4,
                      'id' => 5,
                      'id' => 6,
                      'id' => 7,
                      'id' => 8,
                      'id' => 9,
                      'id' => 10,
                      'id' => 11,
                      'id' => 12,
                      'id' => 13,
                      'id' => 14];
            $cnt = 0;
            $query = "INSERT INTO table (col1, col2) VALUES (?,?)";
            $stmt = $this->db->prepare($query);
            $stmt->bind_param('ii', $arg_one,$arg_two);
                    foreach ($value as $k => $val) {
                         for ($i=0; $i < $num; $i++) { 
                            $arg_one = $k;
                            $arg_two = $ent;
                            if($stmt->execute()) {
                                $cnt++;
                            }
                        }
                    } 
```

10秒代码：

```
 $ent = 4;
            $num = 1000;
            $value = ['id' => 1,
                      'id' => 2,
                      'id' => 3,
                      'id' => 4,
                      'id' => 5,
                      'id' => 6,
                      'id' => 7,
                      'id' => 8,
                      'id' => 9,
                      'id' => 10,
                      'id' => 11,
                      'id' => 12,
                      'id' => 13,
                      'id' => 14];
             $newdat = [];
             foreach ($value as $k => $val) {
                 for ($i=0; $i < $num; $i++) {
                    $newdat[] = $val;
                    $newdat[] = $ent;
                 }
             }
            // create string of data types
            $cnt = count($newdat);
            $param = str_repeat('i',$cnt);
            // create string of question marks
            $rec = (count($newdat) == 0) ? 0 : $cnt / 2 - 1;
            $id_q = str_repeat('(?,?),', $rec) . '(?,?)';
            // insert
            $query = "INSERT INTO table (col1, col2) VALUES $id_q";
            $stmt = $db->prepare($query);
            $stmt->bind_param($param, ...$newdat);
            $stmt->execute(); 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2016-12-14T13:53:28.757

我创建了这个简单的功能，你们可以轻松使用。您需要针对插入数据、数据数组传递表名`($tbl)`、表字段。`($insertFieldsArr)``($arr)`

```
insert_batch('table',array('field1','field2'),$dataArray);

    function insert_batch($tbl,$insertFieldsArr,$arr){ $sql = array(); 
    foreach( $arr as $row ) {
        $strVals='';
        $cnt=0;
        foreach($insertFieldsArr as $key=>$val){
            if(is_array($row)){
                $strVals.="'".mysql_real_escape_string($row[$cnt]).'\',';
            }
            else{
                $strVals.="'".mysql_real_escape_string($row).'\',';
            }
            $cnt++;
        }
        $strVals=rtrim($strVals,',');
        $sql[] = '('.$strVals.')';
    }

    $fields=implode(',',$insertFieldsArr);
    mysql_query('INSERT INTO `'.$tbl.'` ('.$fields.') VALUES '.implode(',', $sql));
} 
```

# python - 什么写入日志文件？

> ID：779989
> 
> 赞同：11
> 
> 时间：2009-04-23T01:41:25.410
> 
> 标签：python, logging, methodology

我的问题很简单：将什么写入日志。有什么约定吗？我必须放入什么？

由于我的应用程序必须发布，我希望有友好的日志，大多数人都可以阅读它而无需询问它是什么。

我已经有了一些想法，比如时间戳、每个函数/方法的唯一标识符等。我想要几个日志级别，比如跟踪/调试、信息、错误/警告。

您是否使用一些预先格式化的日志资源？

谢谢

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-23T01:47:54.987

这很令人愉快，并且已经实施。

阅读：[http ://docs.python.org/library/logging.html](http://docs.python.org/library/logging.html)

* * *

**编辑**

“易于解析、阅读”通常是相互矛盾的特征。英语——易读，难解析。XML——易于解析，难以阅读。没有一种格式可以做到易读易解析。一些日志格式“读起来并不可怕，也不是不可能解析”。

有些人创建多个处理程序，以便一个日志具有多种格式：供人们阅读的摘要和用于自动解析的 XML 版本。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-23T01:44:15.993

**以下是对内容的一些建议：**

*   时间戳
*   信息
*   日志消息类型（例如错误、警告、跟踪、调试）
*   线程 ID（因此您可以从多线程应用程序中理解日志文件）

**实施的最佳实践：**

*   在 write 方法周围放置一个互斥体，这样您就可以确保每次写入都是线程安全的并且有意义。
*   一次向日志文件发送 1 条消息，并每次指定日志消息的类型。然后，您可以设置程序启动时要采用的日志记录类型。
*   在文件上不使用缓冲，或者经常刷新以防程序崩溃。

**编辑：**我刚刚注意到这个问题被标记为 Python，所以请在我之前查看 S. Lott 的回答。它可能足以满足您的需求。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-23T01:48:47.527

既然你标记了你的问题 python，我也向你推荐[这个问题](https://stackoverflow.com/questions/741063/reporting-information-during-code-execution-best-design)。至于内容，布赖恩的提议很好。但是，如果您使用共享日志，请记住添加程序名称。

关于日志文件的重要一点是“greppability”。尝试在一行中提供所有信息，并使用适当的字符串标识符，这些标识符对于特定条件是唯一的（也是基数）。至于时间戳，请使用分类良好的 ISO-8601 标准。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-23T02:17:39.533

一个好主意是查看日志分析软件。除非您打算自己编写，否则您可能希望利用现有的日志分析包，例如 Analog。如果是这种情况，您可能希望生成与其接受的格式足够相似的日志输出。它将允许您以最小的努力创建漂亮的图表和图形！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-23T08:48:56.910

在我看来，最好的方法是使用现有的日志库，例如[log4j（或其他语言的变体）](http://logging.apache.org/)。它使您可以控制消息的格式，并且您可以在不接触代码的情况下对其进行更改。它遵循最佳实践，稳健且被数百万用户使用。当然，您可以编写自己的日志框架，但这样做会很奇怪，除非您需要一些非常具体的东西。无论如何，请浏览他们的文档并查看日志语句是如何呈现的。

查看 log4py - log4j 的 Python 移植版本，我认为 Python 有几种实现..

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-01-11T16:31:06.277

Python 的日志库对于单进程线程是线程安全的。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-04-23T01:57:03.203

timeStamp 即 DateTime YYYY/MM/DD:HH:mm:ss:ms 用户线程 ID 函数名 消息/错误消息/成功消息/函数跟踪

以 XML 格式保存它，然后您可以轻松地为它编写解析器。

```
<log>
  <logEntry DebugLevel="0|1|2|3|4|5....">
    <TimeStamp format="YYYY/MM/DD:HH:mm:ss:ms" value="2009/04/22:14:12:33:120" />
    <ThreadId value="" />
    <FunctionName value="" />
    <Message type="Error|Success|Failure|Status|Trace">
      Your message goes here
    </Message> 
  </logEntry>
</log> 
```

# c++ - 读取互锁变量

> ID：779996
> 
> 赞同：26
> 
> 时间：2009-04-23T01:44:36.057
> 
> 标签：c++, windows, multithreading, locking, interlocked

认为：

A. WIN32下的C++。

B. 使用`InterlockedIncrement()`和递增和递减的正确对齐的易失性整数`InterlockedDecrement()`。

```
__declspec (align(8)) volatile LONG _ServerState = 0; 
```

如果我只想读取_ServerState，是否需要通过`InterlockedXXX`函数读取变量？

例如，我见过如下代码：

```
LONG x = InterlockedExchange(&_ServerState, _ServerState); 
```

和

```
LONG x = InterlockedCompareExchange(&_ServerState, _ServerState, _ServerState); 
```

目标是简单地读取 的当前值`_ServerState`。

我不能简单地说：

```
if (_ServerState == some value)
{
// blah blah blah
} 
```

WRT这个主题似乎有些混乱。我知道寄存器大小的读取在 Windows 中是原子的，所以我认为该`InterlockedXXX`函数是不必要的。

马特·J。

* * *

好的，谢谢回复。顺便说一句，这是 Visual C++ 2005 和 2008。

如果这是真的，我应该使用一个`InterlockedXXX`函数来读取 的值`_ServerState`，即使只是为了清楚起见，最好的方法是什么？

```
LONG x = InterlockedExchange(&_ServerState, _ServerState); 
```

这具有修改值的副作用，而我真正想做的就是读取它。不仅如此，如果有上下文切换，我可能会将标志重置为错误的值，因为 的值`_ServerState`被压入堆栈以准备调用`InterlockedExchange()`.

```
LONG x = InterlockedCompareExchange(&_ServerState, _ServerState, _ServerState); 
```

我从我在 MSDN 上看到的一个例子中得到了这个。
请参阅[http://msdn.microsoft.com/en-us/library/ms686355(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms686355(VS.85).aspx)

我所需要的只是一些类似的东西：

```
lock mov eax, [_ServerState] 
```

无论如何，我认为很清楚的一点是提供对标志的线程安全访问，而不会产生关键部分的开销。我已经看到通过函数族以这种方式使用 LONG `InterlockedXXX()`，因此我提出了问题。

好的，我们正在考虑一个很好的解决这个读取当前值问题的方法是：

```
LONG Cur = InterlockedCompareExchange(&_ServerState, 0, 0); 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-23T04:41:50.593

这取决于您所说的“目标是简单地读取 _ServerState 的当前值”的意思，它取决于您使用的工具集和平台（您指定 Win32 和 C++，但不指定哪个 C++ 编译器，这可能很重要） .

如果您只是想读取该值以使该值未损坏（即，如果某些其他处理器正在将值从 0x12345678 更改为 0x87654321，您的读取将获得这两个值之一，而不是 0x12344321）那么简单地读取就可以了只要变量是：

*   标记`volatile`，
*   正确对齐，并且
*   使用具有处理器原子处理的字长的单个指令读取

C/C++ 标准没有承诺这些，但 Windows 和 MSVC 确实做出了这些保证，而且我认为大多数针对 Win32 的编译器也是如此。

但是，如果您希望您的读取与其他线程的行为同步，则存在一些额外的复杂性。假设您有一个简单的“邮箱”协议：

```
struct mailbox_struct {
    uint32_t flag;
    uint32_t data;
};
typedef struct mailbox_struct volatile mailbox;

// the global - initialized before wither thread starts

mailbox mbox = { 0, 0 };

//***************************
// Thread A

while (mbox.flag == 0) { 
    /* spin... */ 
}

uint32_t data = mbox.data;

//***************************

//***************************
// Thread B

mbox.data = some_very_important_value;
mbox.flag = 1;

//*************************** 
```

想法是线程 A 将旋转等待 mbox.flag 以指示 mbox.data 具有有效的信息。线程 B 将一些数据写入 mailbox.data 然后将 mbox.flag 设置为 1 作为 mbox.data 有效的信号。

在这种情况下，线程 A 中的 mbox.flag 的简单读取可能会获得值 1，即使线程 A 中 mbox.data 的后续读取没有获得线程 B 写入的值。

这是因为即使编译器不会对线程 B 对 mbox.data 和 mbox.flag 的写入重新排序，处理器和/或缓存也可能会。C/C++ 保证编译器将生成代码，以便线程 B 在写入 mbox.flag 之前先写入 mbox.data，但处理器和缓存可能有不同的想法 - 称为“内存屏障”或“获取和释放语义'必须用于确保低于线程指令流级别的排序。

我不确定 MSVC 以外的编译器是否对低于指令级别的排序提出任何声明。但是，MS 确实保证对于 MSVC volatile 就足够了 - MS 指定 volatile 写入具有释放语义，而 volatile 读取具有获取语义 - 尽管我不确定这适用于哪个版本的 MSVC - 请参阅[http://msdn.microsoft.com /en-us/library/12a04hfd.aspx?ppud=4](http://msdn.microsoft.com/en-us/library/12a04hfd.aspx?ppud=4)。

我还看到像您描述的那样使用互锁 API 对共享位置执行简单读取和写入的代码。我对此事的看法是使用互锁 API。无锁线程间通信充满了非常难以理解和微妙的陷阱，并且试图在可能最终导致非常难以诊断的错误的关键代码位上走捷径对我来说似乎不是一个好主意. 此外，使用联锁 API 会向维护代码的任何人发出尖叫，“这是需要与其他东西共享或同步的数据访问 -**小心行事！** ”。

此外，在使用 Interlocked API 时，您将硬件和编译器的细节排除在外 - 平台确保所有这些东西都得到正确处理 - 不用再怀疑......

阅读[Herb Sutter 的](http://herbsutter.wordpress.com/2009/04/20/effective-concurrency-use-thread-pools-correctly-keep-tasks-short-and-nonblocking/)关于 DDJ 的有效并发文章（至少对我而言，目前恰好是关闭的），以获取有关此主题的良好信息。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2013-11-14T15:54:03.333

你的方法很好：

```
LONG Cur = InterlockedCompareExchange(&_ServerState, 0, 0); 
```

我正在使用类似的解决方案：

```
LONG Cur = InterlockedExchangeAdd(&_ServerState, 0); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-23T03:19:35.720

互锁指令提供原子性**和**处理器间同步。写入和读取都必须同步，所以是的，您应该使用互锁指令来读取线程之间共享且不受锁保护的值。无锁编程（这就是您正在做的事情）是一个非常棘手的领域，因此您可以考虑使用锁来代替。除非这*确实*是您的程序必须优化的瓶颈之一？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-27T04:36:14.043

32 位读取操作在*某些*32 位系统上已经是原子的（英特尔规范说这些操作是原子的，但不能保证在其他 x86 兼容平台上也是如此）。所以你不应该将它用于线程同步。

如果您需要某种标志，则应考虑为此目的使用[`Event`](http://msdn.microsoft.com/en-us/library/ms682396%28VS.85%29.aspx)对象和函数。[`WaitForSingleObject`](http://msdn.microsoft.com/en-us/library/ms687032%28VS.85%29.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-08-08T14:33:55.873

对于必须重新访问此线程的任何人，我想添加 Bartosz 很好解释的内容，如果标准原子不可用，这`_InterlockedCompareExchange()`是标准的一个很好的替代方案。`atomic_load()`这是在 i86 Win64 上用 C 原子读取 my_uint32_t_var 的代码。`atomic_load()`包括作为基准：

```
 long debug_x64_i = std::atomic_load((const std::_Atomic_long *)&my_uint32_t_var);
00000001401A6955  mov         eax,dword ptr [rbp+30h] 
00000001401A6958  xor         edi,edi 
00000001401A695A  mov         dword ptr [rbp-0Ch],eax 
    debug_x64_i = _InterlockedCompareExchange((long*)&my_uint32_t_var, 0, 0);
00000001401A695D  xor         eax,eax 
00000001401A695F  lock cmpxchg dword ptr [rbp+30h],edi 
00000001401A6964  mov         dword ptr [rbp-0Ch],eax 
    debug_x64_i = _InterlockedOr((long*)&my_uint32_t_var, 0);
00000001401A6967  prefetchw   [rbp+30h] 
00000001401A696B  mov         eax,dword ptr [rbp+30h] 
00000001401A696E  xchg        ax,ax 
00000001401A6970  mov         ecx,eax 
00000001401A6972  lock cmpxchg dword ptr [rbp+30h],ecx 
00000001401A6977  jne         foo+30h (01401A6970h) 
00000001401A6979  mov         dword ptr [rbp-0Ch],eax 

    long release_x64_i = std::atomic_load((const std::_Atomic_long *)&my_uint32_t_var);
00000001401A6955  mov         eax,dword ptr [rbp+30h] 
    release_x64_i = _InterlockedCompareExchange((long*)&my_uint32_t_var, 0, 0);
00000001401A6958  mov         dword ptr [rbp-0Ch],eax 
00000001401A695B  xor         edi,edi 
00000001401A695D  mov         eax,dword ptr [rbp-0Ch] 
00000001401A6960  xor         eax,eax 
00000001401A6962  lock cmpxchg dword ptr [rbp+30h],edi 
00000001401A6967  mov         dword ptr [rbp-0Ch],eax 
    release_x64_i = _InterlockedOr((long*)&my_uint32_t_var, 0);
00000001401A696A  prefetchw   [rbp+30h] 
00000001401A696E  mov         eax,dword ptr [rbp+30h] 
00000001401A6971  mov         ecx,eax 
00000001401A6973  lock cmpxchg dword ptr [rbp+30h],ecx 
00000001401A6978  jne         foo+31h (01401A6971h) 
00000001401A697A  mov         dword ptr [rbp-0Ch],eax 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-23T01:50:18.553

你*应该*没事的。它是易变的，所以优化器不应该对你造成伤害，它是一个 32 位的值，所以它至少应该是原子的。一个可能的惊喜是指令流水线是否可以解决这个问题。

另一方面，使用受保护例程的额外成本是多少？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-23T01:51:06.820

当前值读数可能不需要任何锁定。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-23T01:53:14.397

Interlocked* 功能可防止两个不同的处理器访问同一块内存。在单处理器系统中，您会没事的。如果您有一个双核系统，其中不同内核上的线程都访问此值，那么在没有 Interlocked* 的情况下执行您认为是原子的操作可能会遇到问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-05-10T07:46:03.883

你的初步理解基本正确。根据 Windows 在其支持（或将支持）的所有 MP 平台上所需的内存模型，从标记为 volatile 的自然对齐变量中读取的数据是原子的，只要它们小于机器字的大小。与写入相同。您不需要“锁定”前缀。

如果您在不使用互锁的情况下进行读取，您将受到处理器重新排序的影响。这甚至可以在 x86 上发生，在有限的情况下：从变量读取可能会移到不同变量的写入之上。在 Windows 支持的几乎所有非 x86 架构上，如果您不使用显式联锁，您将面临更复杂的重新排序。

还有一个要求是，如果您使用比较交换循环，则必须将要比较交换的变量标记为 volatile。这是一个代码示例来说明原因：

```
long g_var = 0;  // not marked 'volatile' -- this is an error

bool foo () {
    long oldValue;
    long newValue;
    long retValue;

    // (1) Capture the original global value
    oldValue = g_var;

    // (2) Compute a new value based on the old value
    newValue = SomeTransformation(oldValue);

    // (3) Store the new value if the global value is equal to old?
    retValue = InterlockedCompareExchange(&g_var,
                                          newValue,
                                          oldValue);

    if (retValue == oldValue) {
        return true;
    }

    return false;
} 
```

可能出错的是编译器完全有权在任何时候从 g_var 重新获取 oldValue，如果它不是 volatile 的话。这种“重新实现”优化在许多情况下都很棒，因为它可以避免在寄存器压力很高时将寄存器溢出到堆栈中。

因此，函数的步骤 (3) 将变为：

```
// (3) Incorrectly store new value regardless of whether the global
//     is equal to old.
retValue = InterlockedCompareExchange(&g_var,
                                      newValue,
                                      g_var); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-07-07T01:36:43.843

读书就好。32 位值总是作为一个整体读取，只要它没有在高速缓存行上分割。你的 align 8 保证它总是在一个缓存行内，所以你会没事的。

忘记指令重新排序和所有这些废话。结果总是按顺序退出。否则将是处理器召回！！！

即使对于双 CPU 机器（即通过最慢的 FSB 共享），您仍然可以，因为 CPU 通过 MESI 协议保证高速缓存的一致性。您唯一不能保证的是您读取的值可能不是绝对最新的。但是，最新的*是*什么？如果您不根据读取的值回写到该位置，那么在大多数情况下您可能不需要知道这一点。否则，您首先会使用互锁操作来处理它。

简而言之，在读取时使用 Interlocked ops 将一无所获（除了可能提醒下一个维护您的代码的人要小心行事 - 再说一次，那个人可能没有资格维护您的代码）。

编辑：回应**Adrian McCarthy**留下的评论。

> 您忽略了编译器优化的效果。如果编译器认为它已经在寄存器中具有该值，那么它将重新使用该值而不是从内存中重新读取它。此外，如果编译器认为没有可观察到的副作用，它可能会进行指令重新排序以进行优化。

我并没有说从非易失性变量中读取是好的。所有的问题都是问是否需要联锁。事实上，有问题的变量显然是用 . 声明的`volatile`。还是*您*忽略了关键字的效果`volatile`？*******