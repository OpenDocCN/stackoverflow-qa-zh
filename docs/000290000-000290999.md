# StackOverflow 问答 000290000-000290999

# delphi - 如何获得 TWinControl 的 X、Y 位置（相对于屏幕）

> ID：290000
> 
> 赞同：14
> 
> 时间：2008-11-14T12:59:18.597
> 
> 标签：delphi, delphi-2009

我试图在 TWinControl 中显示自定义提示，但我不知道如何获得它的位置。

使用位置 0,0 会在我的屏幕顶部（窗口外）显示提示，所以我猜它一定是屏幕上控件的位置。

**编辑：**

我找到了返回我期望的 TControl 属性 ClientOrigin，使用 ClientOrigin.X 和 ClientOrigin.Y 是否正确？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-11-14T13:09:30.103

[TControl.ClientToScreen](http://docwiki.embarcadero.com/Libraries/en/Vcl.Controls.TControl.ClientToScreen)为您提供控件内给定点的屏幕坐标。

```
lPoint := Panel1.ClientToScreen(Point(0,0));
Label1.Caption := Format('Screen: %d, %d', [lPoint.X, lPoint.Y]); 
```

# url - 你将如何设计一个可破解的网址

> ID：290007
> 
> 赞同：2
> 
> 时间：2008-11-14T13:01:54.690
> 
> 标签：url, usability, urlhacks

想象一下，您有一组产品类别组织在一个漂亮的树形层次结构中，并且您想提供可破解的 url 来浏览这些。你可以做这样的事情

```
/catalog/categorya/categoryb/categoryc 
```

然后，您可以很容易地确定应该为哪个类别列出产品（请注意，需要完整的 URL，因为您可以拥有具有相同名称但位于层次结构中不同位置的类别）

现在，在其中添加产品信息的好方法是什么？举个例子，你想显示这个类别的产品 Oblivion

```
/catalog/games/consoles/playstation/adventure 
```

在网址末尾添加产品很诱人

```
/catalog/games/consoles/playstation/adventure/oblivion 
```

但是一旦你这样做了，你就失去了知道它的类别或产品是否被称为遗忘的能力。个人觉得不强制加.html之类的后缀

```
/catalog/games/consoles/playstation/adventure/oblivion.html 
```

将是最好的解决方案并使用某种前缀，例如

```
/catalog/games/consoles/playstation/adventure/product:oblivion 
```

您还可以添加某种触发器，例如

```
/catalog/games/consoles/playstation/adventure/PRODUCT/oblivion 
```

也没有那么好，你会（即使它不太可能成为问题）限制自己拥有一个名为*product的类别*

到目前为止，后缀解决方案看起来是我能想到的最用户友好的方法，但我不喜欢使用扩展

您对此有何看法？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-22T09:26:05.810

深沉的道路让我厌烦。他们很难分享。

```
 /product/1234/oblivion --> 直接页面
/product/oblivion --> /product/1234/oblivion 如果 oblivion 是一个独特的产品，
                  --> ~ 如果遗忘不是一个独特的产品，那么歧义页面。

/product/1234/notoblivion -> /product/1234/oblivion

/categories/79/adventure --> 游戏机冒险游戏
/categories/75/games --> 主机游戏页面
/categories/76/games --> playstation 游戏页面
/categories/games --> 消歧义页面。 
```

否则，虽然长 url*看起来*很容易破解，但需要您正确获取所有节点元素才能破解它。

拿 php.net

```
php.net/str_replace --> 转到
  http://nz2.php.net/manual/en/function.str-replace.php

```

而且这个模型非常容易破解，人们一直盲目地使用它。

注意：W3C 认为 .html 后缀在功能上无意义且多余，应避免在 URL 中使用。

[http://www.w3.org/Provider/Style/URI](http://www.w3.org/Provider/Style/URI)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-22T10:37:30.500

让我们剖析您的 URL，以便更加干燥（不重复）。这是您开始的内容：

```
/catalog/games/consoles/playstation/adventure/oblivion 
```

确实，该类别`adventure`是多余的，因为游戏可以属于多种类型。

```
/catalog/games/consoles/playstation/oblivion 
```

接下来让我印象深刻的是也不需要控制台。将 PC 和控制台机器作为一个子部分进行区分可能不是一个好主意。它们都是各种类型的机器，这样做只会增加另一层复杂性。

```
/catalog/games/playstation/oblivion 
```

现在，您正要对您的网站做出一些决定。我建议删除`playstation`页面上的类别，因为游戏可以跨多个平台存在，也可以跨`games`类别存在。您的网址应如下所示：

```
/catalog/oblivion 
```

那么如何获得 Playstation 的所有动作游戏列表呢？

```
/catalog/tags/playstation+adventure 
```

也许

```
/catalog/tags/adventure/playstation 
```

顺序并不重要。您还必须确保这`tags`是产品的保留名称。

最后，我假设您`/catalog`由于冲突而无法删除根。但是，如果您的站点很小并且没有很多其他部分，则将所有内容减少到根级别：

```
/oblivion
/tags/playstation/adventure 
```

哦，如果`oblivion`不是一个独特的产品，只需构建一个包含其 ID 的 slug：

```
/1234-oblivion 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-14T13:07:15.537

这些看起来都很好（除了带有冒号的那个）。

关键是当他们猜错时该怎么办——不要将它们发送到 404——相反，将你不知道的词发送到该词的搜索页面结果——如果可以的话，效果会更好拼写检查。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-14T13:08:19.937

如果您将不同的部分视为目标，那么产品本身只是另一个目标。所有目标都应该可以通过 target.html 访问，或者只能通过目标访问。

目录/游戏/控制台/playstation.html
目录/游戏/控制台/playstation

目录/游戏/控制台/playstation/adventure.html
目录/游戏/控制台/playstation/adventure

目录/游戏/控制台/playstation/adventure/oblivion.html
目录/游戏/控制台/playstation/adventure/oblivion

依此类推，使其保持一致。

我的5美分...

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-23T02:08:08.110

一个问题是您的用户对“以良好的树形层次结构组织的一组产品类别”的概念可能与您的概念相匹配。这是 David Weinberger 的“Everything is Miscellaneous”的谷歌技术演讲，其中包含一些关于分类的有趣想法：

[http://www.youtube.com/watch?v=x3wOhXsjPYM](http://www.youtube.com/watch?v=x3wOhXsjPYM)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-14T13:32:13.240

@Lou Franco 是的，任何一种方法都需要一个强大的后备机制并将其发送到某种建议页面或搜索引擎都是不错的选择

@Stefan 将两者都视为目标的问题是如何区分它们（就像我描述的那样）。在最坏的情况下，您首先访问数据库以查看是否有满足路径的类别，如果没有，则检查是否有满足路径的产品。问题是，对于每个产品路径，您最终都会对数据库进行无用的调用，以确保它不是一个类别。

@some 是的，分隔符可能是一种可能的解决方案，但是 .html 后缀更加用户友好并且众所周知。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-22T10:01:25.910

我喜欢/videogames/consolename/genre/title”并使用/的数量来区分类别或产品。我唯一担心的是多（或难以区分）类型。我强烈建议不要对标题进行扩展. 你也可以做类似 videogames(.php)?c=x360;t=oblivion; 并且只是猜测丢失的信息但是我喜欢 / 方法，因为它看起来更整洁。你为什么要添加流派？它可能更容易使用标题的第一个字母或只是做视频游戏/控制台/标题/

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-23T03:07:00.410

我的卑微​​经历虽然与销售游戏无关，但告诉我：

*   编辑们通常不会为这些“蛞蝓”使用最好的名字，他们没有明智地选择它们。
*   许多项目（逻辑上）属于多个类别，那么为什么将它们（技术上）限制为一个类别？

通过 id 更好地设计项目 url，（即 /item/435/ ）

*   id 是稳定的（由 db 生成，编辑器不可编辑），因此 url 有更大的机会不会随着时间的推移而改变
*   它们不会像 url 的 category/item_name 样式那样公开（或依赖）数据库中对象的组织。如果您更改底层设计（对象结构）以允许项目属于多个类别怎么办？类别/项目网址突然不再有意义；你会改变你的 url 设计，旧的 url 可能不再起作用。

标签优于类别。也就是说，允许一个项目属于多个类别是比为每个项目分配一个类别更好的方法。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-23T04:02:18.567

> 将两者都视为目标的问题是如何区分它们（就像我描述的那样）。在最坏的情况下，您首先访问数据库以查看是否有满足路径的类别，如果没有，则检查是否有满足路径的产品。问题是，对于每个产品路径，您最终都会对数据库进行无用的调用，以确保它不是一个类别。

所以呢？没有真正需要在产品和类别之间进行严格区分，尤其是在 URI 中，除了可能对额外数据库调用的性能问题。如果这对您来说真的很重要，请考虑以下两个建议：

1.  Most page views will presumably be on products, not categories. So doing the check for a product first will minimize the frequency with which you need to double up on the database lookups.
2.  Add code to your app to display the time taken to generate each page, then go out to the nearest internet cafe (*not your internal LAN!*) with a stopwatch. Bring up some pages from your site and time how long each takes to come up. Subtract the time taken to generate the page. Also compare the time taken to generate one-database-lookup pages vs. two-database-lookup pages. Then ask yourself, when it takes maybe 1-2 seconds total to establish a network connection, generate the content, and download the content, does it really matter whether you're spending an extra 0.05 second or less for an additional database lookup or not?

优化重要的地方，例如制作对人类友好的 URL（如 Chris Lloyd 的回答）。不要浪费时间试图削减最后可能的百分之一。

# c# - .NET 安装包有时不会完全删除以前的版本

> ID：290011
> 
> 赞同：4
> 
> 时间：2008-11-14T13:02:48.700
> 
> 标签：c#, .net, visual-studio

我使用 VS2008 安装包分发我的应用程序，通常效果很好。当我创建应用程序的新版本时，我进入并增加`Version`安装包上的属性并验证该`RemovePreviousVersions`属性设置为 True。

这在大多数情况下都可以正常工作 - 我只是为新版本运行安装包，旧版本被卸载，新版本替换它。

但是，有时安装包会成功运行，但是当我启动程序时，旧版本会启动。显然旧版本的 .exe 仍然存在。

我最终不得不完全卸载软件并安装新版本，这总是有效的，但很痛苦。

据我所知，该文件没有被使用，安装包也没有告诉我重新启动。

关于这里发生了什么的任何想法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-19T10:51:11.183

不是直接的答案，但升级和卸载+重新安装之间的主要区别在于，任何自定义卸载步骤都不是在 2k8 中调用，而是在 2k5 中调用。

这在[Visual Studio 2005 -> 2008/10 Service Installer Project Upgrade issue中被引用](https://stackoverflow.com/questions/370940/visual-studio-2008-service-installer-project-upgrade-issue)

与此相关的另一个区别是，在 2k8 中，文件根据版本信息资源进行升级 - 如果您的模块没有更新版本，它们不会被替换。

在某些情况下，您的强名是否也会产生影响，但我非常有信心最后一段涵盖了您所看到的问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-02-19T08:29:37.787

第二个是使用 orca

Orca 是修改 msi 文件的实用程序。

您可以从以下链接下载“Orca”。[http://www.softpedia.com/get/Authoring-tools/Setup-creators/Orca.shtml](http://www.softpedia.com/get/Authoring-tools/Setup-creators/Orca.shtml)

脚步：

```
 a. Install orca into your computer.
 b. Open orca
 c. Drag and drop your msi into orca UI
 d. Into left panel it will list the name of tables
 e. select property table
 f. go to right panel and right click
 g. click on 'Add Row'
 h. into 'Property' type REINSTALLMODE
 i. into 'Value' type amus
 j. save msi file
 k. and that's it 
```

现在，当您安装时，它将覆盖所有文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-19T08:20:27.047

我们需要将我们的 msi 文件的 REINSTALLMODE 属性设置为 amus。

以下是了解更多关于“amus”含义的链接[http://msdn.microsoft.com/en-us/library/aa371182%28VS.85%29.aspx](http://msdn.microsoft.com/en-us/library/aa371182%28VS.85%29.aspx)

有两种方法可以做到这一点。

1.  通过使用 .NET SDK 附带的 msiexec.exe（如果你有 VS 2005 或 VS 2008，它会附带它，只需浏览到 Visual Studio 的命令提示符，你就会在那里找到它）

找到 msiexec.exe 后，只需键入以下命令即可将安装程序的 REINSTALLMODE 属性设置为 amus。

msiexec.exe /i foo.msi REINSTALLMODE=amus

# c++ - 初始化 ArcEngine，让它更快？

> ID：290013
> 
> 赞同：0
> 
> 时间：2008-11-14T13:03:16.280
> 
> 标签：c++, com, arcgis

我目前正在使用 ArcEngine（来自 ESRI）开发一个 C++/COM 项目。除了在文档方面几乎没有支持（SDK 在那里）。无论如何，我想知道这里是否有人在加快 ArcEngine 的初始化过程方面有任何经验。现在只需 30-35 秒即可初始化引擎。现在我们将运行其中几个应用程序。有人对这个有经验么？

这是一个非常奇怪和奇怪的任务，但 ESRI 的开发者论坛无济于事。我在谷歌上找不到任何东西。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T17:49:13.907

我发现让 ESRI 产品启动更快（不一定是 ArcEngine，但这可能适用）有用的东西是在定义许可证服务器的注册表中指定端口号（通常为 27004）。

HKEY_LOCAL_MACHINE\SOFTWARE\ESRI\License\LICENSE_SERVER HKEY_LOCAL_MACHINE\SOFTWARE\ESRI\ArcInfo\Workstation\8.0\LICENSE_SERVER

当您在安装中或通过桌面管理员设置时，通常类似于：@yourserver.name 将其更改为 27004@yourserver.name

同样，这可能无法解决您的问题，但如果您不这样做，那么值得一试。我发现它可以在我们的环境中加快速度，既可以使用网络上的许可证管理器，也可以使用本地计算机上的硬件加密狗。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T13:26:02.677

自从我上次玩 ESRI 以来已经快十年了，所以对于 ArcEngine 的任何特定内容我都无能为力。

也许您可以合并实例？在最佳情况下，您将能够重用 ArcEngine 实例，并在完成后将实例返回到池中。如果这不可能，您至少可以尝试准备好多个实例，尽管这是否可能和/或有用在很大程度上取决于您的应用程序的具体情况。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-14T14:48:55.007

真的是COM吗？在这种情况下，ArcEngine 将公开一组 COM 接口。COM 接口不是魔术，也不是唯一绑定到一个程序。事实上，COM 明确支持代理。这例如由 DCOM 使用；您将获得远程服务器的本地代理。

在这种情况下，应该可以编写一个自定义 COM 代理来伪造初始化内容但转发其他所有内容。对于您的客户端，代理 COM 接口是相同的，只是速度更快。对于 ArcEngine，您的代理可以在两次调用之间等待很长时间。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-14T13:44:31.127

好吧，从我的理解ArcEngine初始化，初始化一个特殊的COM环境。

您永远不会对初始化的环境进行任何形式的真正处理。您能否以某种方式存储 COM 环境并将其传递给其他程序。我目前的想法是：

使用初始化的 ArcEngine 在后台运行的 Windows 服务。程序以某种方式查询服务，服务返回 COM 环境。这甚至可能吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T03:44:53.203

ESRI 论坛提供的帮助很少，我感到很伤心。感觉就像 Arc* 开发人员在很大程度上是靠自己的。

使用 ArcEngine + .Net 在我们的环境中，应用程序的初始化时间是微不足道的（可能是 1 秒？）——您使用的是慢速远程服务器还是这只是没有加载网络或地图的引擎？

每当我不得不处理大型数据集时，ESRI 都会遇到麻烦。

很高兴看到一些关于 ESRI 产品 SO 的讨论！这里还没有很多...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-06T23:12:42.143

究竟哪条线路需要 45 秒？如果我不得不做一些心理调试，我猜你的许可证服务器遇到了问题。

先检查一下。

# asp.net - 如何在中继器项中找到选中的 RadioButton？

> ID：290018
> 
> 赞同：9
> 
> 时间：2008-11-14T13:06:20.220
> 
> 标签：asp.net, javascript, repeater, radio-button

我在 ASPX 页面上有一个 Repeater 控件，定义如下：

```
<asp:Repeater ID="answerVariantRepeater" runat="server"
    onitemdatabound="answerVariantRepeater_ItemDataBound">
    <ItemTemplate>
        <asp:RadioButton ID="answerVariantRadioButton" runat="server"
            GroupName="answerVariants" 
            Text='<%# DataBinder.Eval(Container.DataItem, "Text")%>'"/>
    </ItemTemplate>
</asp:Repeater> 
```

为了允许及时选择一个单选按钮，我使用了[本文](http://www.codeguru.com/csharp/csharp/cs_controls/custom/article.php/c12371/)的技巧。

但是现在提交表单时，我想确定选中了哪个单选按钮。

我可以这样做：

```
RadioButton checkedButton = null;

foreach (RepeaterItem item in answerVariantRepeater.Items)
{
    RadioButton control=(RadioButton)item.FindControl("answerVariantRadioButton");
    if (control.Checked)
    {
        checkedButton = control;
        break;
    }
} 
```

但希望它可以以某种方式更简单地完成（可能通过 LINQ to 对象）。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2011-05-05T11:14:56.207

您总是可以使用[`Request.Form`](http://msdn.microsoft.com/en-us/library/system.web.httprequest.form.aspx)来获取提交的单选按钮：

```
var value = Request.Form["answerVariants"]; 
```

我认为提交的值默认为`<asp:RadioButton />`所选的 id，但您始终可以添加 value 属性 - 即使它不是正式的`<asp:RadioButton />`属性 - 然后这将是提交的值：

```
<asp:RadioButton ID="answerVariantRadioButton" runat="server"
    GroupName="answerVariants" 
    Text='<%# DataBinder.Eval(Container.DataItem, "Text")%>'"
    value='<%# DataBinder.Eval(Container.DataItem, "SomethingToUseAsTheValue")%>' /> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-14T14:40:01.467

由于您已经在使用 javascript 来处理客户端上的单选按钮单击事件，因此您可以同时使用所选值更新隐藏字段。

然后，您的服务器代码将只访问隐藏字段中的选定值。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-14T14:49:45.037

我很确定您可以在这里使用 LINQ to Objects 的唯一方法就是从 foreach 循环中获取条件并将它们移动到 where 子句。

```
RadioButton checked = 
    (from item in answerVariantRepeater.Items
    let radioButton = (RadioButton)item.FindControl("answerVariantRadioButton")
    where radioButton.Checked
    select radioButton).FirstOrDefault(); 
```

# chm - 使用 HH API 显示 CHM 文件时缺少工具栏和树形视图图标

> ID：290030
> 
> 赞同：0
> 
> 时间：2008-11-14T13:11:45.887
> 
> 标签：chm, html-help

刚刚遇到一个有趣的问题。我有一个 CHM 文件。如果我使用 Process.Start 显示它，它会正确显示。

但是，如果我使用 HH API 启动它，它会在工具栏和树形视图中显示没有任何图标；包括图形在内的主要内容正确显示。这是它的样子 - 一些文章标题潦草写着：[alt text http://img527.imageshack.us/img527/3430/problemhelpfilehl2.png](http://img527.imageshack.us/img527/3430/problemhelpfilehl2.png)

相同的文件在具有相同设置的同事机器上运行良好。

关于发生了什么的任何想法？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-14T17:30:41.280

似乎问题在于我为 HH API 提供了帮助文件的相对路径。现在我使用的是绝对路径，问题似乎已经消失了。

# c++ - 有没有办法在 VC++ 中使用预编译的头文件而不需要 stdafx.h？

> ID：290034
> 
> 赞同：11
> 
> 时间：2008-11-14T13:13:10.020
> 
> 标签：c++, unit-testing, dependencies, precompiled-headers, stdafx.h

我有一堆需要编写单元测试的遗留代码。它在任何地方都使用预编译的头文件，因此几乎所有的 .cpp 文件都依赖于 stdafx.h，这使得为了编写测试而打破依赖关系变得困难。

我的第一直觉是删除所有这些 stdafx.h 文件，这些文件在大多数情况下包含#include 指令，并根据需要将这些 #include 直接放在源文件中。

这将使得有必要关闭预编译的头文件，因为它们依赖于像 stdafx.h 这样的文件来确定预编译的头文件停止的位置。

有没有办法在没有 stdafx.h 依赖项的情况下保留预编译的头文件？有没有更好的方法来解决这个问题？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-15T23:21:40.663

是的，有更好的方法。

恕我直言，预编译头文件的“向导风格”的问题是它们鼓励不必要的耦合并使重用代码比应有的更难。此外，使用“将所有内容都保留在 stdafx.h”样式编写的代码很容易维护，因为更改任何头文件中的任何内容都可能导致整个代码库每次都重新编译。这可以使简单的重构花费很长时间，因为每次更改和重新编译周期都比它应该花费的时间长得多。

恕我直言，更好的方法是使用#pragma hdrstop 和/Yc 和/Yu。这使您能够轻松设置使用预编译头文件的构建配置，也可以构建不使用预编译头文件的配置。使用预编译头文件的文件不直接依赖源文件中的预编译头文件本身，这使得它们可以使用或不使用预编译头文件进行构建。项目文件确定哪个源文件构建预编译头文件，每个源文件中的#pragma hdrstop 行确定哪些包含来自预编译头文件（如果使用），哪些直接来自源文件......这意味着当做维护你会使用不' t 使用预编译的头文件，只有在头文件更改后需要重新构建的代码才会重新构建。在进行完整构建时，您可以使用预编译的头文件配置来加快编译过程。使用非预编译头文件构建选项的另一个好处是，它确保您的 cpp 文件只包含他们需要的内容并包含他们需要的所有内容（如果您使用预编译头文件的“向导样式”，这将很难做到。

我在这里写了一些关于它是如何工作的：http: [//www.lenholgate.com/blog/2004/07/fi-stlport-precompiled-headers-warning-level-4-and-pragma-hdrstop.html](http://www.lenholgate.com/blog/2004/07/fi-stlport-precompiled-headers-warning-level-4-and-pragma-hdrstop.html)（忽略关于 /FI 的东西），我在这里有一些使用 #pragma hdrstop 和 /Yc /Yu 方法构建的示例项目：http: [//www.lenholgate.com/blog/2008/04/practical-testing-16- --fixing-a-timeout-bug.html](http://www.lenholgate.com/blog/2008/04/practical-testing-16---fixing-a-timeout-bug.html)。

当然，从 'wizard style' 预编译的头文件使用到更受控制的样式通常不是微不足道的......

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-14T14:07:46.367

当您通常使用预编译头文件时，“stdafx.h”有两个目的。它定义了一组稳定、通用的包含文件。同样在每个 .cpp 文件中，它用作预编译头文件结束位置的标记。

听起来你想要做的是：

*   保持打开预编译头。
*   将“stdafx.h”保留在每个 .cpp 文件中。
*   清空“stdafx.h”中的包含。
*   对于每个 .cpp 文件，从旧的“stdafx.h”中找出需要哪些包含。在每个 .cpp 文件中的 #include "stdafx.h" 之前添加这些。

所以现在你有了最小的依赖集，你仍然在使用预编译的头文件。损失是您不会只预编译您的公共标头集一次。对于全面重建来说，这将是一个巨大的打击。对于开发模式，您一次只重新编译几个文件，它的影响较小。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-14T13:18:19.447

不，可能*没有*更好的方法。

但是，对于给定的单个 .cpp 文件，您可能会决定不需要预编译的标头。您可以修改该 .cpp 文件的设置并删除 stdafx.h 行。

（但实际上，我不知道预编译的标头方案如何干扰单元测试的编写）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-14T13:18:55.593

不，预编译的头文件依赖于以这种方式编译的所有源包含的单个头文件。您可以为单个源（或全部）指定根本不使用预编译的标头，但这不是您想要的。

过去，Borland C++ 编译器在没有特定头文件的情况下进行预编译。但是，如果两个源文件包含相同的头文件但**顺序**不同，则它们将分别编译，因为确实，C++ 中头文件的顺序可能很重要......

因此，这意味着 borland 预编译头文件只有在您非常严格地以相同顺序包含源代码或所有其他文件都包含（首先）单个包含文件时才节省时间...... - 听起来很熟悉？！？！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-14T14:43:47.090

是的。“stdafx.h/stdafx.pch”名称只是约定俗成的。您可以为每个 .cpp 提供自己的预编译头文件。这可能最容易通过一个小脚本来编辑 .vcproj 中的 XML 来实现。缺点：你最终会得到一大堆预编译的头文件，并且它们不会在 TU 之间共享。

可能，但很聪明？我不能肯定地说。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-14T13:19:18.010

我的建议是 - 不要删除预编译的头文件，除非你想让你的构建非常缓慢。您在这里基本上有三个选择：

1.  摆脱预编译的头文件（不推荐）
2.  为遗留代码创建一个单独的库；这样你就可以单独构建它。
3.  在单个项目中使用多个预编译头文件。您可以在解决方案资源管理器中选择单个 C++ 文件，并告诉他们要使用哪个预编译头文件。您还需要设置您的 OtherStdAfx.h/cpp 以生成预编译的标头。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-14T14:53:37.743

预编译的标头基于这样一个想法，即所有内容都将包含相同的内容集。如果您想使用预编译的头文件，那么您必须忍受这暗示的依赖关系。它归结为依赖关系与构建速度的权衡。如果您可以在关闭预编译头文件的情况下在合理的时间内构建，那么一定要这样做。

要考虑的另一件事是每个库可以有一个 pch。因此，您可以将代码拆分为更小的库，并让每个库都有更紧密的依赖关系。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-14T13:20:19.413

我只对需要包含 afx___ 内容的代码使用预编译的标头 - 通常只是 UI，我不对其进行单元测试。UI 代码处理 UI 并调用具有单元测试的函数（尽管大多数当前没有，因为应用程序是遗留的）。

对于大部分代码，我不使用预编译的头文件。

G。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-02-20T03:58:56.553

预编译头文件可以在重建项目时节省大量时间，但如果预编译头文件发生更改，则依赖于头文件的*每个*源文件都将重新编译，无论更改是否影响它。幸运的是，预编译的头文件用于*编译*，而不是*链接*；**每个源文件不必使用*相同*的预编译头文件。**

pch1.h：

```
#include <bigHeader1.h>
#include ... 
```

pch1.cpp：

```
#include "pch1.h" 
```

源1.cpp：

```
#include "pch1.h"
[code] 
```

pch2.h：

```
#include <bigHeader2.h>
#include ... 
```

pch2.cpp：

```
#include "pch2.h" 
```

源代码2.cpp

```
#include "pch2.h"
[code] 
```

选择*pch1.cpp*，右键单击，*Properties，Configuration Properties，C/C++，Precompiled Headers*。
**预编译头文件：** 创建(/Yc)
**预编译头文件：** pch1.h
**预编译头文件输出文件**：$(intDir)pch1.pch

选择*source1.cpp*
**预编译头文件：** 使用(/Yu)
**预编译头文件：** pch1.h
**预编译头文件输出文件**：$(intDir)pch1.pch（我认为这对 /Yu 无关紧要）

*对pch2.cpp*和*source2.cpp*做同样的事情，除了将**头文件**和**头输出文件**设置为*pch2.h*和*pch2.pch*。这对我行得通。

# c# - 如何让 C# WebBrowser 控件显示 jpeg 文件（原始）？

> ID：290035
> 
> 赞同：4
> 
> 时间：2008-11-14T13:13:22.920
> 
> 标签：c#, .net, webbrowser-control

有谁知道 .Net 2.0 - .Net 3.5 如何将 jpeg 作为字节数组加载到 System.Windows.Forms.WebControl 中并设置正确的 mimetypes 以便显示？

就像是：

```
webBrowser1.DocumentStream = new MemoryStream(File.ReadAllBytes("mypic.jpg"));
webBrowser1.DocumentType = "application/jpeg"; 
```

webBrowser1.DocumentType 似乎是只读的，所以我不知道该怎么做。一般来说，我希望能够加载任何类型的文件源，其中定义了 mimetype 到浏览器中以显示它。

编写临时文件的解决方案不是好的解决方案。目前我已经解决了这个问题，它有一个小的本地网络服务器套接字侦听器，它可以提供我要求的具有正确 mimetype 的 jpeg。

更新：由于有人删除了我有其他人可以使用的信息的答案我自己的问题，所以我会将其添加为更新。（对于那些以这种方式删除的人，请用重要信息更新问题）。

在这里完美运行的 C# 示例解决方案：http: [//www.codeproject.com/KB/aspnet/AspxProtocol.aspx](http://www.codeproject.com/KB/aspnet/AspxProtocol.aspx)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-15T20:31:08.183

您必须实现一个异步可插入协议，例如 IClassFactory、IInternetProtocol... 然后您使用 CoInternetGetSession 注册您的协议。当 IE 调用您的实现时，您可以从内存/提供 mime 类型中提供图像数据。

这有点乏味，但可行。查看[MSDN](http://msdn.microsoft.com/en-us/library/aa767743(VS.85).aspx)上的 IInternetProtocol 和可插入协议文档。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-14T18:45:03.483

你做不到。您不能将图像填充到 Microsoft 的网络浏览器控件中。

限制来自 .NET 封装的 IWebBrowser 控件本身。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T22:27:19.027

如果您想彻底破解，请尝试让您的流成为仅显示您的图片的 HTML 文件。您丢失了图像字节流，并且必须将图像写入磁盘。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-15T00:12:40.407

我不知道`WebBrowser`.NET 控件是否支持这一点，但[RFC2397](http://www.ietf.org/rfc/rfc2397.txt "RFC2397：")定义了如何使用内联图像。使用这个和动态创建的 XHTML 片段，您可以分配图像而无需将其写入文件。

```
Image someImage = Image.FromFile("mypic.jpg");

// Firstly, get the image as a base64 encoded string
ImageConverter imageConverter = new ImageConverter();
byte[] buffer = (byte[])imageConverter.ConvertTo(someImage, typeof(byte[]));
string base64 = Convert.ToBase64String(buffer, Base64FormattingOptions.InsertLineBreaks);

// Then, dynamically create some XHTML for this (as this is just a sample, minimalistic XHTML :D)
string html = "<img src=\"data:image/" . someImage.RawFormat.ToString() . ";base64, " . $base64 . "\">";

// And put it into some stream
using (StreamWriter streamWriter = new StreamWriter(new MemoryStream()))
{
    streamWriter.Write(html);
    streamWriter.Flush();
    webBrowser.DocumentStream = streamWriter.BaseStream;
    webBrowser.DocumentType = "text/html";
} 
```

不知道这个解决方案是否优雅，但我想不是。我不确定的借口是已经很晚了。:)

参考：

*   [RFC2397](http://www.ietf.org/rfc/rfc2397.txt "RFC2397：")
*   [图像到 base64 编码的字符串](http://dotnet-snippets.de/dns/c-image-zu-base64-konvertieren-und-zurueck-SID958.aspx "C# - Image zu Base64 konvertieren und zurück")

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-07T10:20:33.693

IE 只支持 base64 编码的内联图像 32KB，所以不是一个好的解决方案。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-03-28T01:16:18.440

尝试`res:`协议。

我没有尝试过使用 .net dll，但[这篇](http://www.tech-archive.net/Archive/DotNet/microsoft.public.dotnet.framework.windowsforms.controls/2005-09/msg00064.html)文章说它应该可以工作。即使它确实需要 C++ dll，就编码而言，它的使用要简单得多。

我创建了一篇文章，向您展示如何[在这里](https://stackoverflow.com/a/15672462/1413201)展示如何创建资源脚本并正确使用*res:*协议。

# excel - 将 Unicode .csv（逗号分隔）文件导出到 Excel 2003 或 Excel 2007 会导致所有列在 Excel 的第一列中结束

> ID：290037
> 
> 赞同：1
> 
> 时间：2008-11-14T13:15:30.793
> 
> 标签：excel, export-to-excel

我们可以在代码（ASP/JavaScript）或 Excel 中做些什么，以便逗号分隔的值在 Excel 中的单独列中结束？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-15T00:34:47.490

导入后，您可以转到“工具”->“文本到列...”菜单并指定分隔符。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T13:40:57.903

正如 Chei 所指出的，Excel（列表分隔符）选项的本地化或更改可能会导致错误行为。

我建议您使用 Open XML 以获得更安全的输出。

查看[在 ASP.NET 中生成 Excel 文件](https://stackoverflow.com/questions/150339/generating-an-excel-file-in-aspnet#150448)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-04-14T05:32:08.667

我只是尝试使用制表符而不是逗号作为字段分隔符，它在 Excel 2007 中工作

（至少我认为是 2007 年，在愚蠢的功能区中找不到帮助/关于）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-17T03:37:41.270

你知道 CSV 文件是否有字节顺序标记头吗？也许它没有 BOM，或者它不是区域设置的正确 BOM。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-24T21:49:58.110

Excel 似乎对 UTF-16/UTF-8 字节顺序标记感到困惑，因此请尝试摆脱它们。

对于 CSV，单元格的内容可以是 unicode 字符，但分隔符、引号和换行符始终必须是 ASCII。您可以将 CSV 视为始终是 ASCII，但每个单元格都是二进制的 blob，并且可能是一些 unicode 文本。

此外，请查看：[http](http://www.creativyst.com/Doc/Articles/CSV/CSV01.htm) ://www.creativyst.com/Doc/Articles/CSV/CSV01.htm了解更多信息。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-21T15:18:18.103

如果您使用“，” Excel 2007 会读取它，但不是 2003。如果您使用“;”，则相反。

因此，最好的方法是生成一个 html 表并将其输出为 .xls。Excel 2007 将询问其是否来自受信任的来源。

以下是如何执行此操作的代码示例：

```
private void ExportToXLSFromDataTable(DataTable dtExport, string filename)
{
    StringBuilder dataToExport = new StringBuilder();

    dataToExport.Append("<table>");
    dataToExport.Append("<tr>");

    foreach (DataColumn dCol in dtExport.Columns)
    {
        dataToExport.Append("<td>");
        dataToExport.Append(Server.HtmlEncode(dCol.ColumnName));
        dataToExport.Append("</td>");
    }

    dataToExport.Append("</tr>");

    foreach (DataRow dRow in dtExport.Rows)
    {
        dataToExport.Append("<tr>");
        foreach (object obj in dRow.ItemArray)
        {
            dataToExport.Append("<td>");
            dataToExport.Append(Server.HtmlEncode(obj.ToString()));
            dataToExport.Append("</td>");
        }
        dataToExport.Append("</tr>");
    }

    dataToExport.Append("</table>");

    if (!string.IsNullOrEmpty(dataToExport.ToString()))
    {
        Response.Clear();

        HttpContext.Current.Response.ContentType = "application/ms-excel";
        HttpContext.Current.Response.AddHeader("Content-Disposition", "attachment;filename=" + filename);

        HttpContext.Current.Response.Write(dataToExport.ToString());
        HttpContext.Current.Response.End();
    }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-14T13:21:44.353

如果您通过 Excel 的“文件 --> 打开”菜单打开文件，那么它将分隔单元格中的值。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-14T13:22:18.473

Excel 的不同本地化可能使用不同的字符来分隔列。尝试使用“;” 而不是“，”，看看它是否有帮助。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-18T16:29:18.427

您可以尝试将文件另存为 .txt，而不是 .csv，这会强制 Excel 将文本行解析为列

# c++ - 返回类型是函数签名的一部分吗？

> ID：290038
> 
> 赞同：73
> 
> 时间：2008-11-14T13:17:16.487
> 
> 标签：c++, function

在 C++ 中，返回类型是否被视为函数签名的一部分？并且只修改返回类型就不允许重载。

* * *

## 回答 #1

> 赞同：90
> 
> 时间：2008-11-14T13:20:33.453

普通函数在其签名中不包含返回类型。

[（*注意*：我已经重写了这个答案，下面的评论不适用于这个修订版 - 有关详细信息，请参阅编辑历史）。]

### 介绍

但是，标准中关于函数和函数声明的问题很复杂。有两层需要考虑：

*   声明
*   实体

所谓*函数声明*，可以声明一个函数实体，也可以声明一个模板实体。如果声明了一个函数实体，那么您要么必须处理函数模板的显式特化（指定所有参数），要么处理普通函数的声明。如果声明了模板实体，那么您声明的是主函数模板，或者未指定某些参数的显式特化。（这与“对象声明”与对象或引用的关系非常相似：前者可以声明对象或引用。所以*对象声明*不一定声明对象！）。

该标准定义了一个函数的签名以包括以下内容`1.3.10`：

> 它的参数类型，如果函数是类成员，函数本身和声明成员函数的类的 cv 限定符（如果有）。函数模板特化的签名包括其模板参数的类型。(14.5.5.1)

它缺少此定义中的返回类型，这*是*函数模板特化（即声明作为模板特化的函数的函数声明）签名的一部分，正如`14.5.5.1`（最近的 C++0x 工作论文修复了已经提到返回类型的问题`1.3.10`）：

> 函数模板特化的签名由函数模板的签名和实际模板参数（无论是显式指定还是推导）组成。
> 
> 函数模板的签名由函数签名、返回类型和模板参数列表组成。

### 那么，签名究竟包含什么内容呢？

因此，当我们询问*函数*的签名时，我们必须给出两个答案：

*   对于函数模板的特化函数，签名包括返回类型。
*   对于不是特化的函数，返回类型不是签名的一部分。

但是请注意，在任何情况下，返回类型*都是*函数类型的重要组成部分。也就是说，以下内容无效：

```
void f();
int (*pf)() = &f; // different types! 
```

### 如果只有返回类型不同，重载何时无效？

主要编译器目前拒绝以下代码：

```
int f();
double f(); // invalid 
```

但接受以下代码：

```
template<typename T> int f();
template<typename T> double f(); // invalid? 
```

但是，**标准确实禁止仅在返回类型上有所不同的函数声明**（定义重载何时有效，何时无效）。但是，它并没有准确定义“仅因返回类型而异”的含义。

* * *

标准段落参考：

*   什么时候可以重载函数声明：`13.1`
*   什么是函数声明：`7/2`和`7/5`
*   函数模板/专业化的签名是什么：`14.5.5.1`

作为参考，以下是最新的 C++0x 草案 n3000 中关于“签名”的说法`1.3.11`，它在涵盖不同类型的实体方面更加完整：

> 函数的名称和参数类型列表 (8.3.5)，以及它所属的类或命名空间。如果函数或函数模板是类成员，则其签名还包括函数或函数模板本身的 cv 限定符（如果有）和 ref 限定符（如果有）。函数模板的签名还包括其返回类型和模板参数列表。函数模板特化的签名包括作为特化的模板的签名及其模板参数（无论是显式指定的还是推导出的）。[ 注意：签名用作名称修改和链接的基础。——尾注]

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-15T10:29:10.397

这取决于函数是否是*函数模板*。

在**C++ Templates -- the complete guides**中，Jusuttis 提供了与 C++ 标准中给出的定义不同的定义，但结果相同：

我们将函数的签名定义为以下信息：

1.  函数的*非限定名称*
2.  该名称的*类*或*命名空间*范围，如果该名称具有内部链接，则声明该名称的翻译单元
3.  函数的`const`, `volatile`, 或`const volatile`限定
4.  函数参数的*类型*
5.  **它的返回*类型*，如果函数是从函数模板生成的**
6.  *模板参数*和*模板参数*，如果函数是从函数模板生成的

正如**litb 所**建议的，有必要澄清为什么返回类型是模板函数签名的一部分。

> 如果函数具有不同的签名，则它们可以在程序中共存。

. 也就是说，如果返回类型是模板参数：

```
template <typename T>
T foo(int a)
{return T();} 
```

可以实例化两个仅在返回类型上有所不同的函数：

```
foo<int>(0);
foo<char>(0); 
```

不仅：正如**litb**正确报道的那样，还可以重载两个模板函数，它们仅在返回类型上有所不同，即使返回类型不是从属名称。这是他的例子：

```
template<class T> int foo(T)
{}

template<class T> bool foo(T)
{}

// at the instantiation point it is necessary to specify the cast
// in order not to face ambiguous overload

((int(*)(char))foo<char>)('a'); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-21T18:11:50.443

它们足以成为类型的一部分，您可以基于仅返回类型不同的函数指针类型重载函数：

```
int IntFunc() { return 0; }
char CharFunc() { return 0; }

void FuncFunc(int(*func)()) { cout << "int\n"; }
void FuncFunc(char(*func)()) { cout << "char\n"; }

int main()
{
    FuncFunc(&IntFunc); // calls void FuncFunc(int_func func)
    FuncFunc(&CharFunc); // calls void FuncFunc(char_func func)
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-09-26T07:31:51.133

我发现隐式地使返回类型成为签名的一部分的有用方法是在输入中包含一个“虚拟”参数。

例如：

```
template <typename T>
T f(double x, T dummy) {
    T output;
    output = x * 2;
return output;
} 
```

在这种情况下，如果您想要双输出，请输入：

```
f(2, double(1)) 
```

它返回双 4.0，而如果你想要一个 int 输出，你输入：

```
f(2, int(1)) 
```

它返回 int 4。

# c# - 使用 IIS 7 的 Castle MonoRail 路由？

> ID：290043
> 
> 赞同：6
> 
> 时间：2008-11-14T13:19:42.907
> 
> 标签：c#, .net, asp.net-mvc, model-view-controller, castle-monorail

我正在尝试使路由模块与默认操作或控制器一起使用，但事实并非如此。我总是面对找不到 404 页面。我忘记做某事了吗？我真的很喜欢 ASP.NET MVC 特性中的路由，但我不确定我是否可以在 MR 中做同样的事情。我正在使用 IIS7 和 .NET 3.5 的城堡树干构建。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-11T21:58:18.950

如果您使用的是 IIS7，则需要在 system.webServer/httpModules 节点中注册路由模块。

system.web/httpHandlers 和 httpModules 被 IIS7 忽略。

MonoRail 路由绝对有效；我们已经启动并愉快地运行了。这是 config 和 global.asax.cs 片段：

```
 <system.web>
    <authentication mode="None" />

    <compilation debug="true" />

    <!-- IIS6 / integrated dev server handler/module config -->
    <httpHandlers>
        <clear />
        <add path="favicon.ico" verb="*" type="System.Web.StaticFileHandler"/>
        <add path="Trace.axd" verb="*" type="System.Web.Handlers.TraceHandler"/>
        <add path="*.config" verb="*" type="System.Web.HttpForbiddenHandler" />
        <add path="*.spark" verb="*" type="System.Web.HttpForbiddenHandler" />
        <add path="*.sparkjs" verb="*" type="System.Web.HttpForbiddenHandler" />
        <add path="/content/**/*.*" verb="*" type="System.Web.StaticFileHandler" />
  <add path="/content/**/**/*.*" verb="*" type="System.Web.StaticFileHandler" />
  <add path="/content/**/**/**/*.*" verb="*" type="System.Web.StaticFileHandler" />
  <add path="/content/**/**/**/**/*.*" verb="*" type="System.Web.StaticFileHandler" />
  <add path="*" verb="*" type="Castle.MonoRail.Framework.MonoRailHttpHandlerFactory, Castle.MonoRail.Framework" />
        <add verb="*" path="*.castle" type="Castle.MonoRail.Framework.MonoRailHttpHandlerFactory, Castle.MonoRail.Framework"/>
    </httpHandlers>

    <httpModules>
        <add name="routing" type="Castle.MonoRail.Framework.Routing.RoutingModuleEx, Castle.MonoRail.Framework" />
        <add name="PerRequestLifestyle" type="Castle.MicroKernel.Lifestyle.PerWebRequestLifestyleModule, Castle.MicroKernel" />
    </httpModules>

    <trace enabled="true"/>

</system.web>

<!-- IIS 7 handler/module config -->
<system.webServer>
    <handlers>
        <clear />
        <add name="FavIcon" path="favicon.ico" verb="*" type="System.Web.StaticFileHandler"/>
        <add name="Trace" path="Trace.axd" verb="*" preCondition="integratedMode" type="System.Web.Handlers.TraceHandler"/>
        <add name="BlockConfig" path="*.config" verb="*" preCondition="integratedMode" type="System.Web.HttpForbiddenHandler" />
        <add name="BlockSpark" path="*.spark" verb="*" preCondition="integratedMode" type="System.Web.HttpForbiddenHandler" />
        <add name="BlockSparkJs" path="*.sparkjs" verb="*" preCondition="integratedMode" type="System.Web.HttpForbiddenHandler" />
        <add name="content" path="/content/**/*.*" verb="*" preCondition="integratedMode" type="System.Web.StaticFileHandler" />
        <add name="content2" path="/content/**/**/*.*" verb="*" preCondition="integratedMode" type="System.Web.StaticFileHandler" />
        <add name="content3" path="/content/**/**/**/*.*" verb="*" preCondition="integratedMode" type="System.Web.StaticFileHandler" />
        <add name="content4" path="/content/**/**/**/**/*.*" verb="*" preCondition="integratedMode" type="System.Web.StaticFileHandler" />
        <add name="castle" path="*" verb="*" type="Castle.MonoRail.Framework.MonoRailHttpHandlerFactory, Castle.MonoRail.Framework" modules="ManagedPipelineHandler" scriptProcessor="" resourceType="Unspecified" requireAccess="Script" preCondition="integratedMode,runtimeVersionv2.0" />
    </handlers>

    <modules>
        <add name="routing" type="Castle.MonoRail.Framework.Routing.RoutingModuleEx, Castle.MonoRail.Framework" />
        <add name="PerRequestLifestyle" type="Castle.MicroKernel.Lifestyle.PerWebRequestLifestyleModule, Castle.MicroKernel" />
    </modules>

    <validation validateIntegratedModeConfiguration="false" />

</system.webServer> 
```

（事实上​​，我们从来没有在 IIS6 上实现过这个，但是在 web-dev 服务器上实现过——从那时起我们就得到了支持，并被告知它可以在 IIS6 级别使用 * 映射到 aspnet_isapi.dll——但是通过然后，运行 Win2003 的开发人员更新为带有 IIS7 的东西，所以我们没有尝试过）

```
 protected virtual void RegisterRoutes(IRoutingRuleContainer engine)
    {
        engine.Add
            (
            new PatternRoute(ThorController.CtlrHome, "/[controller]")
                .DefaultForController().Is(ThorController.CtlrHome)
                .DefaultForArea().Is(ThorController.AreaPublic)
                .DefaultForAction().Is(ThorController.ActionIndex)
            );

        engine.Add
            (
            new PatternRoute(ThorController.KeyDefault, "/<area>/<controller>/[action]/[id]")
                .DefaultForArea().Is(ThorController.AreaPublic)
                .DefaultForAction().Is(ThorController.ActionIndex)
                .DefaultFor(ThorController.KeyId).IsEmpty
            );
    } 
```

（第一个路由处理我们的应用程序根）

（这些值是我们的 ThorController 基类中的常量，以尝试减少字符串文字）

顺便说一句，任何人都知道是否存在语法来完成我们在一行中处理静态文件的操作？肯定有比我们的“解决方案”更好的方法;-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T13:31:51.293

你是如何配置路由的？在尝试从 web.config 管理路由规则时，我自己遇到了问题，但是将其移动到 application-start 上的内联代码对我有用。

我试图找到为什么 xml 方式不起作用的答案，但从未找到答案。自 RC3 以来，他们对路由引擎进行了重大重写，这可能会破坏它。

来自 Application_OnStart() 的示例

```
var rule = new PatternRoute("default", "/")
    .DefaultForController().Is()
    .DefaultForAction().Is("index");

RoutingModuleEx.Engine.Add( 规则 );

```

请记住在 web.config 中的 MonoRailHandler 之前加载 RoutingEngineModule。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T01:12:45.073

I've tried to register routing like this already but it still doesn't work.

Here is my configuration file:

```
<system.web>
<httpHandlers>
  <add verb="*" path="*.rail" type="Castle.MonoRail.Framework.MonoRailHttpHandlerFactory, Castle.MonoRail.Framework" />
  <add verb="*" path="*.vm" type="System.Web.HttpForbiddenHandler" />
  <add verb="*" path="*.boo" type="System.Web.HttpForbiddenHandler" />
  <add verb="*" path="*.st" type="System.Web.HttpForbiddenHandler" />
</httpHandlers> 
<httpModules>
  <add name="routing" type="Castle.MonoRail.Framework.Routing.RoutingModuleEx, Castle.MonoRail.Framework" />
</httpModules></system.web> 
<system.webServer>
    <handlers>
        <add name="MR" path="*.rail" verb="*" modules="IsapiModule" scriptProcessor="C:\Windows\Microsoft.NET\Framework\v2.0.50727\aspnet_isapi.dll" resourceType="Unspecified" preCondition="classicMode,runtimeVersionv2.0,bitness32" />
    </handlers>
</system.webServer> 
```

# asp.net - 在 ASP.NET 中编写导航逻辑的最佳方法是什么

> ID：290049
> 
> 赞同：0
> 
> 时间：2008-11-14T13:20:55.137
> 
> 标签：asp.net, architecture, design-patterns

这可以在没有 MVC 的情况下完成吗？有没有一种简单的方法来抽象或封装导航逻辑？

我目前在我的代码背后有很多以下内容（我知道这可能不是最好的做法）：

```
protected void btnNext_Click(object sender, EventArgs e)
{
   ...

   if (condition1)
   {  Response.Redirect("~/NextPage.aspx");  }
   else if (condition2)
   {  Response.Redirect("~/AnotherPage.aspx");  }
   else
   {  Response.Redirect("~/GoBackToOldKentRoad.aspx");  } 
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-14T13:38:36.973

您可能需要考虑使用 Web.sitemap 文件来保存您的导航信息。

您还可以在其中一个预览版中查看为 MVC 构建的 Routing 库，他们将这些类拆分到 System.Web.Routing 命名空间中，据我所知，它现在可以与 WebForms 一起使用。我不确定使用 WebForms 是否容易，但它可能值得研究。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T13:44:38.130

根据您的示例，我认为 MVC 并没有太大的不同。这几乎是执行多页工作流程的标准方式。MVC 可能只是将其发送到不同的视图，但基本概念是相同的。除非您有一个非常庞大和复杂的工作流程，否则这是处理它的最简单方法。

# asp.net - 如何从浏览器历史记录中删除页面？

> ID：290055
> 
> 赞同：15
> 
> 时间：2008-11-14T13:22:18.270
> 
> 标签：asp.net, browser-history

我有一个 ASP.Net 页面，其中包含一个按钮。此页面包含一个 ServerSide Paypal 按钮。

当被推送时，我的服务器在后端做了各种聪明的事情，然后将响应重写为一个表单和一些将这个表单发布到 paypal 的 javascript。

这一切都很好。

但是，如果用户随后选择单击返回，他们将到达我生成的自我发布表单，然后将它们再次转发到 Paypal。

我想如果我能找到一种方法让我生成的表单页面不存在于历史记录中，那么这将解决我的问题。但我不知道如何纠正这一点。

**如何从历史记录中删除我的页面或让它永远不会出现？**

更新：感谢所有人……这些是一些很好的答案。赞成所有好的，但由于巧妙地使用隐藏字段而不是 cookie 作为决策依据而选择了 splattne。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-14T13:42:01.710

```
window.location.replace(URL); 
```

[窗口位置](http://developer.mozilla.org/en/DOM/window.location)：

> 替换（网址）
> 
> 将当前文档替换为提供的 URL 中的文档。与 assign() 方法的不同之处在于，在使用 replace() 之后，当前页面将不会保存在会话历史记录中，这意味着用户将无法使用后退按钮导航到该页面。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-14T13:38:42.980

我不确定这是否可以做到。但这里有一个想法，您可以如何防止重新提交表单。

您可以在表单中插入一个**隐藏的输入**，该输入一开始是空的。提交时，您将在该字段中写入一个值，并确保您检查每次提交尝试是否该字段为空。

如果提交时它不为空，则您知道该表单先前已发送，您可以警告用户。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-14T13:38:29.720

作为 Web 应用程序，您永远无法完全控制用户的浏览器。即使有一种方法可以指示浏览器不要将页面存储在历史记录中，我对此表示怀疑，您也不能确定它会起作用。例如，一个聪明的用户可以调整一个开源浏览器来存储历史中的每一页，无论如何。

我认为您应该尝试从另一个角度解决问题。例如，您可以检测到它与正在转发的表单相同，而不是第二次将其发送到贝宝。重要的是在服务器端进行。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-14T13:40:32.180

也许您可以在提交表单之前设置一个 cookie。

加载页面时，检查该 cookie 是否存在（意味着表单已经提交）。如果找到，不再自动提交表单，而是再次自动返回 ( `window.history.back()`)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-14T14:09:59.483

我不确定您是否可以通过 PayPal 集成轻松做到这一点，但 [“发布/重定向/获取”](http://en.wikipedia.org/wiki/Post/Redirect/Get) 模式可用于解决此问题

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-03-29T09:54:31.867

对某些人来说，一个有用的提示可能是这个......

```
window.history.go(-2); 
```

特别是在出现负载故障警告弹出窗口时。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-01-13T18:07:48.667

如果 window.referer 是您试图避免第二次调用的 Paypal 页面，您可以简单地对页面进行编程，使其不提交，或做某事/导航到其他地方。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-04-30T17:32:36.113

```
protected void Page_Load(object sender, EventArgs e)

    {

        Page.RegisterClientScriptBlock("", "<script>if(history.length>0)history.go(+1);</script>");

    } 
```

# c# - C# 中的 '=>' 语法是什么意思？

> ID：290061
> 
> 赞同：94
> 
> 时间：2008-11-14T13:24:10.933
> 
> 标签：c#, syntax

我刚刚在这个论坛的一些问题中遇到了这种语法，但谷歌和任何其他搜索引擎往往会在搜索中屏蔽除字母和数字之外的任何内容，因此不可能搜索出“=>”。

那么谁能告诉我它是什么以及它是如何使用的？

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2008-11-14T13:25:10.963

它是 lambda 运算符。

从 C# 3 到 C# 5，这仅用于[lambda 表达式](http://msdn.microsoft.com/en-us/library/bb397687.aspx)。这些基本上是 C# 2 中引入的[匿名方法](http://msdn.microsoft.com/en-us/library/0yw3tz5k.aspx)的较短形式，但也可以转换为[表达式树](http://msdn.microsoft.com/en-us/library/bb397951.aspx)。

举个例子：

```
Func<Person, string> nameProjection = p => p.Name; 
```

相当于：

```
Func<Person, string> nameProjection = delegate (Person p) { return p.Name; }; 
```

在这两种情况下，您都在创建一个带`Person`参数的委托，并返回该人的姓名（作为字符串）。

在 C# 6 中，相同的语法用于*表达式体成员*，例如

```
// Expression-bodied property
public int IsValid => name != null && id != -1;

// Expression-bodied method
public int GetHashCode() => id.GetHashCode(); 
```

也可以看看：

*   [匿名方法 (C# 2.0) 和 lambda 表达式 (C# 3.0) 有什么区别](https://stackoverflow.com/questions/208381/whats-the-difference-between-anonymous-methods-c-20-and-lambda-expressions-c-30)
*   [什么是 Lambda？](https://stackoverflow.com/questions/150129/what-is-a-lambda)
*   [C# Lambda 表达式，我为什么要使用它？](https://stackoverflow.com/questions/167343/c-lambda-expression-why-should-i-use-this)

（确实有很多类似的问题——试试[lambda](https://stackoverflow.com/questions/tagged/lambda)和[lambda-expressions](https://stackoverflow.com/questions/tagged/lambda-expressions)标签。）

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2012-07-09T22:39:14.463

这是一种更简洁的方法表示法。以下大致等价：

```
// explicit method
int MyFunc(int pParam) {
   return pParam;
}

// anonymous (name-less) method
// note that the method is "wrapped" up in a hidden object (Delegate) this way
// so there is a very tiny bit of overhead compared to an explicit method
// (though it's really the assignment that causes that and would also happen
// if you assigned an explicit method to a reference)
Func<int, int> MyFunc = delegate (int pParam) { return pParam; };

// lambda expression (also anonymous)
// basically identical to anonymous method,
// except with everything inferred as much as possible, intended to be minimally verbose
Func<int, int> MyFunc = x => x;

// and => is now also used for "expression-bodied" methods
// which let you omit the return keyword and braces if you can evaluate
// to something in one line
int MyFunc(int pParam) =>
   pParam; 
```

将 lambda 表达式想象为“给定一些东西，返回一些东西”。在上面的示例中，lambda 表达式`x => x`表示“给定 x，返回 x”，尽管 lambda 表达式不一定需要返回某些内容，在这种情况下，您可能会将它们读作“给定 x，用 x 做某事”。

另请注意，有一种称为“代表”的三件事一开始可能会让人很困惑。

匿名方法使用`delegate`关键字，但定义了一个没有名称的方法：

```
Func<int, int> = delegate (int x) { return x; }; 
```

将方法（匿名、显式或 lambda）分配给引用会导致`Delegate`创建一个隐藏的包装对象，该对象允许引用该方法。（基本上是一种“托管函数指针”。）

然后，您还可以使用关键字声明*命名方法**签名：***`delegate`

```
public delegate int TestFunc(int x, int y);

TestFunc myFunc = delegate (int x, int y) { return x + y; }; 
```

这声明了一个命名签名`TestFunc`，它接受两个`int`s 并返回一个`int`，然后声明该类型的委托引用，然后为其分配一个具有匹配签名的匿名方法。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-11-14T13:29:32.840

这意味着令人敬畏。例如

```
x => x + 1 
```

表示将 x 作为参数并返回其后继的方法。

```
button.Click += new EventHandler((sender, e) => methodInfo.Invoke(null, new object[] { sender, e })); 
```

通过调用 MethodInfo 持有的方法将事件处理程序分配给按钮。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-11-14T13:30:29.610

这是一个来自 msdn 的简单示例

```
delegate int del(int i);
del myDelegate = x => x * x;
int j = myDelegate(5); //j = 25 
```

=> 之前的任何内容都是输入参数，之后的任何内容都是表达式。您可以有多个输入参数。Lambda 主要与 Linq 一起使用。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-11-14T13:27:59.367

而不是像这样使用匿名方法：

```
somevar.Find(delegate(int n)
{
   if(n < 10)
      return n;
}); 
```

你只需这样写：

```
somevar.Find(n => n < 10); 
```

它将根据返回值采用数据类型。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-14T13:28:41.283

它基本上意味着“进入”，就像一个参数

```
MyObjectReference => MyObjectReference.DoSomething() 
```

通常您使用它们将函数作为参数或在 LINQ 语句中传递给方法

```
MyCollection.Where(myobj => myobj.Age>10) 
```

例如。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-14T13:32:59.060

它是 lambda 表达式语法的一部分。lambda 表达式本质上是委托或匿名方法的缩写形式。为了说明，假设我有一个与字母匹配的字符串数组。我可以使用以下 LINQ 表达式挑选出该数组中包含大于“E”的值的成员：

var someLetters = alphabet.Where(l => l > "E");

“=>”左侧的 lambda 表达式部分标识测试的变量名称（设置为字母表的各个成员），“=>”右侧的 lambda 表达式部分标识处理。在这种情况下，处理会生成一个布尔值，Where 逻辑使用该布尔值来确定是否将字母表的每个成员传递给 someLetters 数组。

# c# - C1HierarchicalDataTemplate / C1TreeView 问题

> ID：290065
> 
> 赞同：1
> 
> 时间：2008-11-14T13:25:51.773
> 
> 标签：c#, silverlight, treeview, hierarchicaldatatemplate, componentone

我在使用 C1HierarchicalDataTemplate 在 Silverlight (C1TreeView) 中构建 ComponentOne TreeView 时遇到问题。详细而言，树仅显示 2 个级别（H1 和 H2），尽管通过 HierarchicalDataTemplates 定义了 3 个级别，例如：

```
<c1:C1HierarchicalDataTemplate x:Key="H3Template">
          <TextBlock FontWeight="Bold" Text="{Binding Path=Name}" />
     </c1:C1HierarchicalDataTemplate>

    <c1:C1HierarchicalDataTemplate x:Key="H2Template" ItemsSource="{Binding Path=H3Items}" ItemTemplate="{StaticResource H3Template}">
        <TextBlock FontWeight="Bold" Text="{Binding Path=Name}" />
    </c1:C1HierarchicalDataTemplate>

    <c1:C1HierarchicalDataTemplate x:Key="H1Template" ItemsSource="{Binding Path=H2Items}" ItemTemplate="{StaticResource H2Template}">
        <TextBlock FontWeight="Bold" Text="{Binding Path=Name}" />
    </c1:C1HierarchicalDataTemplate>"); 
```

我在自定义 TreeView（源自 C1TreeView）中使用此模板：

```
 <c1:C1TreeView ... ItemTemplate="{StaticResource H1Template}">
 </c1:C1TreeView> 
```

此 TreeView 的构造函数如下所示：

```
public MyTreeView(ObservableCollection<H1> h1Items)
{
    InitializeComponent();
    ItemsSource = h1Items;
} 
```

任何人都可以看到这些代码片段中的错误吗？

谢谢，多姆

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-03-22T10:16:43.240

虽然我不熟悉您正在使用的 ComponentOne TreeView，并且尽管您使用的是 Silverlight，但通常在 WPF 中，当您使用 HierarchicalDataTemplates 时，您告诉模板它的类型。子项模板同样被告知它们适用于什么类型。您**没有**具体告诉数据模板要为其使用什么模板是 ItemTemplate。这是系统根据对象的类型自动计算出来的。当您将项目集合绑定到 TreeView 时，这*也*适用——您不必指定 ItemTemplate。

因此，在您的情况下（`local:`是在您的 xaml 顶部定义的命名空间）：

```
<c1:C1HierarchicalDataTemplate DataType="{x:Type local:H1}" 
                               ItemsSource="{Binding Path=H2Items}">
  <TextBlock FontWeight="Bold" Text="{Binding Path=Name}" />
</c1:C1HierarchicalDataTemplate>

<c1:C1HierarchicalDataTemplate DataType="{x:Type local:H2}" 
                               ItemsSource="{Binding Path=H3Items}">
  <TextBlock FontWeight="Bold" Text="{Binding Path=Name}" />
</c1:C1HierarchicalDataTemplate>

<c1:C1HierarchicalDataTemplate DataType="{x:Type local:H3}">
  <TextBlock FontWeight="Bold" Text="{Binding Path=Name}" />
</c1:C1HierarchicalDataTemplate> 
```

树视图：

```
<c1:C1TreeView ItemsSource="{Binding SomeH1List}"/> 
```

当然，正如我所说，这适用于 WPF，因此它可能不适用于您的情况。

# linux - Tux，清漆还是鱿鱼？

> ID：290079
> 
> 赞同：43
> 
> 时间：2008-11-14T13:31:15.443
> 
> 标签：linux, apache, squid, varnish

我们需要一个用于静态图像的 Web 内容加速器，以位于我们的 Apache Web 前端服务器前面

我们之前的托管合作伙伴使用 Tux 取得了巨大成功，我喜欢它是我们正在使用的 Red Hat Linux 的一部分，但它的最后一次更新是在 2006 年，未来发展的机会似乎很小。我们的 ISP 建议我们在反向缓存代理角色中使用 Squid。

Tux 和 Squid 之间有什么想法吗？对我们来说，兼容性、可靠性和未来支持与性能一样重要。

另外，我在这里阅读了有关 Varnish 的其他线程；与在高流量环境中获得的 Squid 和/或 Tux 相比，有人对 Varnish 有任何实际经验吗？

干杯

伊恩

更新：我们现在正在测试 Squid。使用 ab 以 100 次并发拉取同一图像 10,000 次，Apache 本身和 Squid/Apache 都非常迅速地处理请求。但是 Squid 只向 Apache 发出了一次图像请求，然后从 RAM 中为它们提供服务，而仅 Apache 就必须派生大量工作人员才能为图像提供服务。看起来 Squid 可以很好地释放 Apache 工作人员来处理动态页面。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-04-27T16:01:35.733

根据我的经验，varnish 比 squid 快得多，但同样重要的是，它不像 squid 那样是黑匣子。Varnish 使您可以访问非常详细的日志，这些日志在调试问题时很有用。它的配置语言也比 squid 的更简单、更强大。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2010-02-15T10:46:42.100

@Daniel，@MKUltra，详细说明 Varnish 假定的 cookie 问题，实际上并没有。如果请求返回一个 cookie，*则不*缓存请求是完全正常的。Cookie 主要用于区分不同的用户偏好，所以我不认为人们会想要缓存这些（特别是如果它们包含一些秘密信息，如会话 ID 或密码！）。

如果您的服务器使用您的 .js 和图像发送 cookie，那是您后端的问题，而不是 Varnish 的问题。正如@Daniel（提供的链接）所引用的，由于 Varnish 中集成了非常酷的语言/DSL，您无论如何都可以强制缓存这些文件...

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2010-09-20T00:56:12.957

如果您希望推送大量静态图片，您可能需要先了解一些基础知识。

您的应用程序应确保传递所有正确的标头，例如 Cache-Control 和 Expires。这应该会导致客户端浏览器在本地缓存这些图像并减少您的请求计数。

使用 CDN（如果它在您的预算范围内），这会使图像更接近您的客户（通常），并为他们带来更好的用户体验。要使 CDN 成为一项富有成效的投资，您将再次需要确保正确设置所有必要的缓存标头，正如我在上一段中所说的那样。

毕竟，如果您仍然要使用反向代理，我建议在代理模式下使用 nginx，而不是 Varnish 和 squid。是的，Varnish 很快，和 nginx 一样快，但是你想做的事情真的很简单，当你想做复杂的缓存和 ESI 时，Varnish 就会出现。所以保持简单，愚蠢。nginx 确实会很好地完成你的工作。

我没有使用 Tux 的经验，所以我无法对此发表评论。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2010-02-27T07:26:32.100

值得一提的是，我最近在一个 6 年历史的低功耗网络服务器（运行 Fedora Core 2）上将 nginx 设置为 Apache 前面的反向代理，该服务器受到轻度 DDoS 攻击（10K req/sec）。页面加载速度很快（<100 毫秒），系统负载保持在 20% 左右的低 CPU 利用率，并且内存消耗非常少。袭击持续了 1 周，游客没有看到任何不良影响。

持续每分钟超过 50 万次点击还不错。请务必登录到 /dev/null。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2014-01-25T22:31:04.347

有趣的是，没有人提到 Apache Traffic Server（以前的 Yahoo! Traffic Server）[http://trafficserver.apache.org/](http://trafficserver.apache.org/)

请看看它，它的工作很漂亮。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-12-03T11:24:02.817

[我们在http://www.mangahigh.com](http://www.mangahigh.com)上使用 Varnish，并且已经能够从大约 100 个并发的 pre-varnish 扩展到超过 560 个并发的 post-varnish（此时服务器负载保持在 0，因此还有很大的增长空间！）。varnish 的文档可能会更好，但是一旦你习惯了它就会非常灵活。

Varnish 意味着比 Squid 快很多（从未使用过 Squid，我不能肯定地说）- [http://users.linpro.no/ingvar/varnish/stats-2009-05-19](http://users.linpro.no/ingvar/varnish/stats-2009-05-19)显示 Twitter， Wikia、Hulu、perezhilton.com 和许多其他大牌也在使用它。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-11-14T14:34:08.843

Squid 和 nginx 都是专门为此设计的。nginx 对于服务器场特别容易配置，也可以作为 FastCGI 的前端。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-11-14T15:02:16.553

我只用过鱿鱼，无法比较。我们使用 squid 在美国的服务器上缓存整个站点（所有数据都从德国的机器中提取）。它很容易设置并且运行良好。我发现文档有点缺乏，除非您已经知道要查找的内容。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-02-03T12:08:53.030

由于您已经有 apache 提供静态和动态内容，我建议您使用 Varnish。

通过这种方式，您可以使用 apache 传递静态内容并使用 varnish 为您缓存它。Varnish 非常灵活，为您提供缓存和负载平衡功能，以最佳方式发展您的网站。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-23T02:21:00.130

我们即将在 IIS 6 安装前推出 varnish 2.01 服务器。我们唯一需要注意的是我们的 SSL（因为 varnish 无法处理 SSL）。所以我们还安装了 Nginx 来处理这些请求。

在我们所有的测试中，我们都显示网站可以处理的流量增加了 66%。

我唯一的抱怨是 varnish 不能很好地处理 cookie，并且文档仍然有点分散。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-09-05T19:14:13.030

没有人提到 Squid 完全遵循[HTTP 规范](http://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html)（或者至少他们尝试这样做），而 Varnish 没有。在我看来，这意味着 Varnish 更适合缓存单个站点的内容（通过广泛调整 Varnish），而 Squid 更适合缓存许多站点的内容（每个站点都必须根据[规范](http://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html)使其内容“可缓存” ）。

# .net - 如何检查 DLL 是否经过调试编译

> ID：290080
> 
> 赞同：1
> 
> 时间：2008-11-14T13:31:22.353
> 
> 标签：.net, .net-1.1

> **可能重复：**
> [如何判断 .net 应用程序是在 DEBUG 还是 RELEASE 模式下编译的？](https://stackoverflow.com/questions/194616/how-to-tell-if-net-app-was-compiled-in-debug-or-release-mode)

简单的问题；有没有一种简单的方法可以检查 .NET 1.1 程序集是否经过调试编译？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-14T13:35:34.203

这取决于您要如何检查。如果您想在实际运行时签入代码，如果代码处于调试模式，您可以使用：

```
Debug.Assert(MyFunction()) 
```

使用该代码，MyFunction 只会在它所在的 dll 以调试模式编译时运行。

# c# - 如何进行动态 Linq2SQL 查询？

> ID：290087
> 
> 赞同：2
> 
> 时间：2008-11-14T13:33:04.300
> 
> 标签：c#, linq-to-sql

我正在尝试构建一个将接收 Linq 表的方法，并且应该返回一个 List<> 值，这些值将是一个 DropDownList 数据源。

这是我到目前为止所拥有的：

```
public static List<Structs.NameValuePair> GenDropDownItens<T>(string ValueField , string TextField ) where T: class 
```

我不知道该怎么做，查询表只获取传递的字段（ValueField，TextField）......

谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-14T14:13:15.297

将 LINQ2SQL 查询的结果投影到 System.Collections.Generic.KeyValuePair 对象中，如下所示：

```
 ddl.DataSource = DataContext.Table.Select(o => new KeyValuePair<string, string>(o.ID, o.DisplayField));
ddl.DataBind(); 
```

然后，您需要将 DropDownList 上的 DataValueField 和 DataTextField 属性分别设置为“Key”和“Value”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T13:58:18.167

为什么不做类似的事情；

```
var dropDownValues = dataContext.SomeTable.ToDictionary(
    s => s.Name,
    s => s.Value
);

foreach(var item in dropDownValues) {
    var OptionName = item.Key;
    var OptionValue = item.Value
}; 
```

希望这会有所帮助，我真的不认为你需要创建一个 while 方法。但是如果你想我会说让它接受一个 IDictionary 对象，然后从那里转换它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T13:48:28.980

Table.Select(t => t.field1, t.field2)

[还可以在这里](http://weblogs.asp.net/scottgu/archive/2007/05/19/using-linq-to-sql-part-1.aspx)查看 Scott Gutherie 的博客系列。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-14T14:04:40.913

您是否尝试使用您的方法执行以下操作

GetDropDownItems("Gates", "LastName") ????

如果是这样，作为 SDK 示例的一部分包含一个名为 DynamicQuery 的项目。使用它，您基本上可以创建所需查询的文本版本。你可以做类似的事情

“姓氏 == '盖茨'”

但是，自己构建表达式树同样容易。了解表达式树的最佳方式是使用 ExpressionTreeVisualizer VS 调试器插件（注意这也是 SDK CSharpSamples 中包含的另一个示例）。会是这样的

ParameterExpression 参数 = Expression.Parameter(typeof(T), "x"); var expression = Expression.Equals(Expression.Property(parameter, "LastName"), Expression.Constant("Gates")

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-14T14:22:46.523

如果“Key”和“Value”是代表您想要获取的属性名称的字符串，并且它们仅在运行时才知道......这是您的代码：

```
private static Func<T, DictionaryEntry> GetNameValuePairFunc<T>(string valueField, string textField)
{
    Func<T, DictionaryEntry> result = (item) =>
    {
        object key = typeof(T).GetProperty(valueField).GetValue(item, null);

        object text = typeof(T).GetProperty(textField).GetValue(item, null);

        return new DictionaryEntry(key, text);
    };

    return result;
} 
```

# c# - Asp.Net MVC 与 Castle MonoRail

> ID：290088
> 
> 赞同：27
> 
> 时间：2008-11-14T13:34:34.237
> 
> 标签：c#, asp.net-mvc, castle-monorail

我有一些使用 Asp.Net 构建应用程序的经验，但现在 MVC 框架变得越来越流行。我想尝试使用 Asp.Net MVC 或 Castle MonoRail 构建新的多语言 Web 应用程序，但我不知道哪个对我有好处。我不喜欢 Web 表单视图引擎，但我喜欢 Asp.Net MVC 中的路由功能。

*   谁能说说它们之间的利弊？
*   哪个 ViewEngine 更适合覆盖主模板？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-02-03T16:30:20.550

作为单轨列车的拥护者，我不得不说你应该选择 ASP.NET MVC。老实说，ASP.NET MVC 将在三年内成为默认架构这一简单事实可能会影响它。这个等式在一年前有所不同，仅仅是因为默认架构与 MonoRail 相比存在严重的生产力问题。

如果要谈技术优缺点：

*   ASP.NET AJAX 是一团糟（避免它），但他们现在有了 jQuery。事实上，对 jQuery 的支持比任何其他环境都好。当然，只有通过 IDE 与标准视图引擎的集成才能完全做到这一点。
*   有一些美学上的改进（例如，模型信息的传递方式比 Monorail 更清晰、更明显）。

另外，不要放弃标准视图引擎。您不必像使用 ASP.NET 那样对其进行控制，您可以使用与 Brail 非常相似的方式对其进行编码，仅使用 C# 而不是 Boo。

有些事情简直丑陋 * 将对象作为参数的方法的数量。祝你好运找到他们所期望的文档。* 微软喜欢抽象类而不是接口。他们有他们的理由，但我仍然不喜欢它。

此外，在许多方面，MonoRail 仍然是更完整的平台。例如，在 ASP.NET 中没有用于验证或分页的抽象。此外，绑定到模型并没有任何帮助。与它们的 Monorail 等效项相比，这些助手的功能非常少。

不过，总的来说，我认为 ASP.NET MVC 是赢家。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-14T15:21:38.433

MonoRail 和 ASP.NET MVC 本质上非常相似，你应该可以使用其中任何一个。MonoRail 存在的时间更长，因此具有更多更高级别的功能。

ASP.NET MVC 的主要优势在于它的路由引擎，公平地说，MonoRail 具有几乎等效的路由引擎，并且通过一些修改，您可以将 ASP.NET MVC 路由引擎与 MonoRail 一起使用，因为路由引擎并不是真正在 ASP 中.NET MVC 但在 System.Web.Routing 中（在 .NET 3.5 SP1 中发布）。ASP.NET MVC 和与 Visual Studio 的集成也是一个优势，并且随着我们接近 v1 的 RTM 可能会变得更好。

MvcContrib 项目包含一些很棒的视图引擎，例如 Spark、NHaml 和 Brail。没有人可以被认为是“最佳”，个人最喜欢的是 Spark。有关火花的更多信息：http: [//dev.dejardin.org/documentation/syntax](http://dev.dejardin.org/documentation/syntax)

WebForms 引擎具有智能感知功能，据我所知，这是所有替代视图引擎都缺乏的一大优势。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-13T16:02:54.800

除了感知到微软的受欢迎程度和支持之外，ASP.NET MVC 仍然缺乏 Monorail 长期以来拥有的一些核心功能，例如控制器组织（区域）、本机 ViewComponents 和可以使用 IoC 命名最重要的过滤器。

我有一些使用所有这些功能的大型应用程序，我很难将它们移植到 ASP.NET MVC。

我已经和 Monorail 合作了好几年了，虽然 MVC 看起来很有前途，而且它的灵活性很棒，但我仍然觉得对于我尝试做的每一件事，结果它都不存在，我不得不插入一点一块 MvcContrib，另一块 SharpArchitecture，自己构建，你懂的。Monorail 更容易使用（就是现在）。

我预计未来几个月情况会好转，因为一些提议的解决方案将开始对抗其他解决方案并变得更加主流。嘿，选择的多样性很好，但相信我，你不想在 3 年前进入 Java 领域，那里有如此多的 Web 框架，你可以为每个不同的页面使用一个来构建你的网站！

与此同时，我将继续缓慢地将我的 MR 应用程序移植到 MVC，以防万一。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-13T21:18:43.593

1.  我认为 MVC 胜出。它的功能集非常相似，但将成为两者中更“流行”的（因此通常在整个开发社区中得到更广泛的支持、记录和扩展）。此外，在我看来，新的 ViewEngine (Razor).. 和 IDE 改进因素对我来说，并提高了选择 MVC 而不是单轨的价值。

2.  我已经使用了几乎所有常见的 ViewEngines，但最终使用了很棒的 StringTemplate 模板引擎滚动了我自己的（为它[创建了一个开源项目）。](http://code.google.com/p/string-template-view-engine-mvc/)ST是真正的关注点分离，IMO。结果，我发现自己编写了更好的应用程序，标签汤少了很多。如果您选择在发动机上踢轮胎，我还提供了一份[快速介绍和参考指南。](http://websitelogic.net/articles/MVC/stringtemplate-viewengine-asp-net-mvc/)到目前为止，我在使用它部署的项目上非常幸运。话虽如此，Razor (MVC 3) 看起来相当令人印象深刻。

# jquery - jQuery droppables - 在放置时更改元素

> ID：290090
> 
> 赞同：4
> 
> 时间：2008-11-14T13:35:10.443
> 
> 标签：jquery, draggable, droppable

我对 jQuery 有点陌生，希望有人能帮助我。

在删除 (li) 之后，我试图将一个元素 (li) 更改为另一个元素 (div)。

示例代码：

```
$("#inputEl>li").draggable({ 
    revert: true, 
    opacity: 0.4,
    helper: "clone"
});
$("#dropEl")
    .droppable({ 
        accept: ".drag",
        hoverClass: "dropElhover",
        drop: function(ev, ui) {
            // change the li element to div here
        }
}); 
```

问题是，当我使用

```
drop: function(ev, ui) {
     $(ui.draggable).replaceWith("<div>Some content</div>");
} 
```

触发上述功能时，将禁用原始可拖动元素。

我正在使用最新的 jQuery 和 jQuery UI 稳定版本。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-14T16:01:04.207

那么，您想要的是保持原始列表完整并将列表项放入 dropEl 中？这个怎么样：

```
drop: function(ev,ui) {
     $(this).append("<div>Some content</div>");
} 
```

或者，如果你想用 div 元素替换列表元素，并且 div 元素也可以拖动，你可以试试这个：

```
drop: function(ev, ui) {
        $(ui.draggable).replaceWith("<div>Some content</div>");
        $("#inputEl>div").draggable({ 
            revert: true, 
            opacity: 0.4,
            helper: "clone"
        });
    } 
```

原始的可拖动调用仅在调用时使项目可拖动。如果您更改或添加元素并希望它们可拖动，则需要再次调用 draggable() 函数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-15T02:53:02.203

谢谢你的回复。

您的第一个代码有效，而且我还可以像这样对 droppable 中的 div 进行排序：

```
 drop: function(ev, ui) {
    $(this).append("<div>Some content</div>");
    $("#dropEl").sortable();
} 
```

~~现在的问题是，一旦我将其更改为 div，我如何知道哪个列表是哪个？~~

我使用以下代码来获取每个元素 id：

```
drop: function(ev, ui) {
            revert: true;
            var this_id = $(ui.draggable).attr("id");
            $(this).append('<div id="'+this_id+'">Some content</div>');
            $("#dropEl").sortable();
        } 
```

# sql-server - ASP.NET MVC 缓存因身份验证而异

> ID：290098
> 
> 赞同：13
> 
> 时间：2008-11-14T13:37:03.170
> 
> 标签：sql-server, asp.net-mvc, linq-to-sql, caching

我在我最近[推出的 tiny webapp](http://www.dudlers.com)上使用 ASP.NET Preview 5（将很快升级到 Beta）和 LINQ2SQL 。

我为自己的工作感到非常自豪，直到 Silverlight.net 在首页上展示了它，并且它开始接收到数量不多的访问者。

出于某种原因，用户有时会收到 LINQ2SQL 抛出的“Specified cast invalid”——这是因为未经身份验证的用户被作为“Guest”用户处理，并且控制器正在为每次点击加载有关用户“Guest”的信息。

在第一页，顶部有一个“Welcome [USERNAME]”，可以使用[Donut Caching](http://haacked.com/archive/2008/11/05/donut-caching-in-asp.net-mvc.aspx)轻松缓存。

然而，在中间，有一个“What is Dudlers.com”块应该只向未经身份验证的用户显示，另一个“About You”块应该只向经过身份验证的用户显示。这些块太复杂了，无法使用 Donut Caching 进行缓存；它们太不同了，会很混乱。

我想根据用户的身份验证状态缓存第一个。因此，未经身份验证的用户（不用说，大多数人）会获得“访客”缓存页面，而其他经过身份验证的用户会看到一个新的非缓存页面。

是否有一个选项可以指定因身份验证而异的缓存？类似于：[OutputCache(VaryBy = Authentication)]

还是有另一种非 ASP.NET MVC 解决方案？（也许调整 MS SQL）

我希望我的问题很清楚。我在同一台专用服务器上运行 Windows 2003 和 MS SQL 2005 Express。

谢谢！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-16T16:19:04.790

您不必使用甜甜圈缓存机制。ASP.NET 具有`VaryByCustom`允许您确定如何改变缓存的选项。

查看更多信息：[http ://aspadvice.com/blogs/ssmith/archive/2007/10/29/VaryByCustom-Caching-By-User.aspx](http://aspadvice.com/blogs/ssmith/archive/2007/10/29/VaryByCustom-Caching-By-User.aspx)

应该适用于 ASP.NET MVC。

# c++ - 使用 CppUnit 参数化测试

> ID：290099
> 
> 赞同：7
> 
> 时间：2008-11-14T13:37:12.000
> 
> 标签：c++, unit-testing, cppunit

我的组织正在使用 CppUnit，我正在尝试使用不同的参数运行相同的测试。在测试中运行循环不是一个好的选择，因为任何失败都会中止测试。我看过，`TestDecorator`但`TestCaller`似乎都不太合适。代码示例会很有帮助。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-14T21:13:56.007

It does not appear possible in CppUnit to parameterize a test case directly (see [here](http://sourceforge.net/tracker/index.php?func=detail&aid=1090757&group_id=11795&atid=361795) and [here](http://sourceforge.net/forum/forum.php?thread_id=1560616&forum_id=37107)). However, you do have a few options:

## Use a `RepeatedTest`

You may be able to make some clever use of the built-in [`RepeatedTest`](http://cppunit.sourceforge.net/doc/1.11.6/class_repeated_test.html) decorator. This allows a test case to be run multiple times (though without parameterization).

I'll admit to never having used this myself, but perhaps you could have the `RepeatedTest` drive some gatekeeper function, which would (using a class static variable, perhaps?) pick a different input with every run. It would in turn call the true function you'd like to test with that value as input.

## Use a `TestCase` subclass

[One person](http://sourceforge.net/forum/forum.php?thread_id=887311&forum_id=37107) on CppUnit's SourceForge page claims to have written a subclass of `TestCase` that will run a particular test an arbitrary number of times, although in a slightly different manner than the `RepeatedTest` class offers. Sadly, the poster simply described the motivation for creating the class, but did not provide the source code. There was, however, an offer to contact the individual for more details.

## Use a simple helper function

The most straight-forward (but least automated) way to do this is to create a helper function that takes the parameter you'd like to pass on to your "real" function, and then have lots of individual test cases. Each test case would call your helper function with a different value.

* * *

If you choose either of the first two options listed above, I'd be interested in hearing about your experience.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-05-17T22:43:34.110

```
class members : public CppUnit::TestFixture
{
    int i;
    float f;
};

class some_values : public members
{
    void setUp()
    {
        // initialization here
    }
};

class different_values : public members
{
    void setUp()
    {
        // different initialization here
    }
};

tempalte<class F>
class my_test : public F
{
    CPPUNIT_TEST_SUITE(my_test<F>);
    CPPUNIT_TEST(foo);
    CPPUNIT_TEST_SUITE_END();

    foo() {}
};

CPPUNIT_TEST_SUITE_REGISTRATION(my_test<some_values>);
CPPUNIT_TEST_SUITE_REGISTRATION(my_test<different_values>); 
```

我不知道根据 CppUnit 的“首选做事方式”，这是否被认为是犹太洁食，但这就是我现在采用的方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-02-26T07:32:27.410

根据 Marcin 的建议，我实现了一些宏来帮助定义参数化 CppUnit 测试。

使用此解决方案，您只需替换类头文件中的旧宏 CPPUNIT_TEST_SUITE 和 CPPUNIT_TEST_SUITE_END：

```
CPPUNIT_PARAMETERIZED_TEST_SUITE(<TestSuiteClass>, <ParameterType>);

/*
 * put plain old tests here.
 */

CPPUNIT_PARAMETERIZED_TEST_SUITE_END(); 
```

在实现文件中，您需要将旧的 CPPUNIT_TEST_SUITE_REGISTRATION 宏替换为：

```
CPPUNIT_PARAMETERIZED_TEST_SUITE_REGISTRATION ( <TestSuiteClass>, <ParameterType> ) 
```

这些宏要求您实现以下方法：

```
static std::vector parameters();
void testWithParameter(ParameterType& parameter); 
```

*   parameters()：提供带有参数的向量。
*   testWithParameter(...)：为每个参数调用。这是您实施参数化测试的地方。

可以在这里找到详细的解释：http: [//brain-child.de/engineering/parameterizing-cppunit-tests](http://brain-child.de/engineering/parameterizing-cppunit-tests)

德语版本可以在这里找到：http: [//brain-child.de/engineering/parametrierbare-tests-cppunit](http://brain-child.de/engineering/parametrierbare-tests-cppunit)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-04-17T23:57:15.803

这是一个非常古老的问题，但我只需要做类似的事情并提出以下解决方案。我对它不是 100% 满意，但它似乎做得很好

1.  为测试方法定义一组输入参数。例如，假设这些是字符串，那么让我们这样做：

    ```
    std::vector<std::string> testParameters = { "string1", "string2" };
    size_t testCounter = 0; 
    ```

2.  实现一个通用测试器函数，每次调用都会从测试数组中获取下一个参数，例如：

    ```
    void Test::genericTester()
    {
      const std::string &param = testParameters[testCounter++];

      // do something with param
    } 
    ```

3.  在测试 addTestToSuite() 方法声明（由 CPPUNIT 宏隐藏）而不是（或旁边）使用 CPPUNIT_TEST 宏定义方法时，添加类似于以下的代码：

    ```
    CPPUNIT_TEST_SUITE(StatementTest);

    testCounter = 0;
    for (size_t i = 0; i < testParameters.size(); i++) {
      CPPUNIT_TEST_SUITE_ADD_TEST(
        ( new CPPUNIT_NS::TestCaller<TestFixtureType>(
                  // Here we use the parameter name as the unit test name.
                  // Of course, you can make test parameters more complex, 
                  // with test names as explicit fields for example.
                  context.getTestNameFor( testParamaters[i] ),
                  // Here we point to the generic tester function.
                  &TestFixtureType::genericTester,
                  context.makeFixture() ) ) );
    }

    CPPUNIT_TEST_SUITE_END(); 
    ```

这样，我们多次注册 genericTester()，每个参数一个，并指定一个名称。这似乎对我很有效。

希望这可以帮助某人。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-14T14:49:14.693

我不是 C++ 程序员，但我可以在单元测试概念方面提供帮助：

测试用例旨在独立运行，不依赖于外部参数。此外，您应该将测试用例的数量保持在涵盖大部分代码的最低限度。然而，在某些情况下（我已经处理过一些），一些测试看起来相同，只是一些次要参数不同。最好的办法是编写一个带有您正在谈论的参数的*夹具*，然后为每个参数设置一个测试用例，并用它调用夹具。一个通用的例子如下：

```
class MyTestCase

  # this is your fixture
  def check_special_condition(param)
    some
    complex
    tests
  end

  # these are your test-cases
  def test_1
    check_special_condition("value_1")
  end

  def test_2
    check_special_condition("value_2")
  end

end 
```

否则，您就不会编写真正的测试用例，因为它们应该是可重现的，而执行它们的人没有太多知识。我想有一些参数作为测试的输入都很重要。那么为什么不在自己的测试用例中明确说明每一个呢？这也是最好的记录方式，而不是编写单独的文档来指导将在几年后阅读代码的程序员。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-06-14T14:04:25.283

以下类/助手宏对适用于我当前的用例。在您的`TestFixture`子类中，只需定义一个接受一个参数的方法，然后使用`PARAMETERISED_TEST(method_name, argument_type, argument_value)`.

```
#include <cppunit/extensions/HelperMacros.h>
#include <cppunit/ui/text/TestRunner.h>

template <class FixtureT, class ArgT>
class ParameterisedTest : public CppUnit::TestCase {
public:
  typedef void (FixtureT::*TestMethod)(ArgT);
  ParameterisedTest(std::string name, FixtureT* fix, TestMethod f, ArgT a) :
    CppUnit::TestCase(name), fixture(fix), func(f), arg(a) {
  }
  ParameterisedTest(const ParameterisedTest* other) = delete;
  ParameterisedTest& operator=(const ParameterisedTest& other) = delete;

  void runTest() {
    (fixture->*func)(arg);
  }
  void setUp() { 
    fixture->setUp(); 
  }
  void tearDown() { 
    fixture->tearDown(); 
  }
private:
  FixtureT* fixture;
  TestMethod func;
  ArgT arg;
};

#define PARAMETERISED_TEST(Method, ParamT, Param)           \
  CPPUNIT_TEST_SUITE_ADD_TEST((new ParameterisedTest<TestFixtureType, ParamT>(context.getTestNameFor(#Method #Param), \
                                          context.makeFixture(), \
                                          &TestFixtureType::Method, \
                                              Param)))

class FooTests : public CppUnit::TestFixture {
  CPPUNIT_TEST_SUITE(FooTests);
  PARAMETERISED_TEST(ParamTest, int, 0);
  PARAMETERISED_TEST(ParamTest, int, 1);
  PARAMETERISED_TEST(ParamTest, int, 2);
  CPPUNIT_TEST_SUITE_END();
public:
  void ParamTest(int i) {
    CPPUNIT_ASSERT(i > 0);
  }
};
CPPUNIT_TEST_SUITE_REGISTRATION(FooTests);

int main( int argc, char **argv)
{
  CppUnit::TextUi::TestRunner runner;
  CppUnit::TestFactoryRegistry &registry = CppUnit::TestFactoryRegistry::getRegistry();
  runner.addTest( registry.makeTest() );
  bool wasSuccessful = runner.run( "", false );
  return wasSuccessful;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-01-08T08:47:04.180

根据 consumerwhore 的回答，我最终得到了一种非常好的方法，我可以使用带有尽可能多的参数的单行注册宏创建多个测试。

只需定义一个参数类：

```
class Param
{
public:
    Param( int param1, std::string param2 ) :
        m_param1( param1 ),
        m_param2( param2 )
    {
    }

    int m_param1;
    std::string m_param2;
}; 
```

让您的测试夹具将其用作“非类型模板参数”（我认为这就是它的名称）：

```
template <Param& T>
class my_test : public CPPUNIT_NS::TestFixture
{
    CPPUNIT_TEST_SUITE(my_test<T>);
    CPPUNIT_TEST( doProcessingTest );
    CPPUNIT_TEST_SUITE_END();

    void doProcessingTest()
    {
        std::cout << "Testing with " << T.m_param1 << " and " << T.m_param2 << std::endl;
    };
}; 
```

有一个小宏创建一个参数并注册一个新的测试夹具：

```
#define REGISTER_TEST_WITH_PARAMS( name, param1, param2 ) \
    Param name( param1, param2 ); \
    CPPUNIT_TEST_SUITE_REGISTRATION(my_test<name>); 
```

最后，像这样添加尽可能多的测试：

```
REGISTER_TEST_WITH_PARAMS( test1, 1, "foo" );
REGISTER_TEST_WITH_PARAMS( test2, 3, "bar" ); 
```

执行此测试将为您提供：

```
my_test<class Param test1>::doProcessingTestTesting with 1 and foo : OK
my_test<class Param test2>::doProcessingTestTesting with 3 and bar : OK
OK (2)
Test completed, after 0 second(s). Press enter to exit 
```

# c# - C#为控件添加样式

> ID：290112
> 
> 赞同：11
> 
> 时间：2008-11-14T13:41:20.463
> 
> 标签：c#, asp.net, controls

我有一个面板，我在这个面板中添加控件。但是有一个我想浮动的特定控件。我该怎么做呢？

pnlOverheadDetails 是面板名称

```
pnlOverheadDetails.Controls.Add(lnkCalcOverhead); 
```

名为 lnkCalcOverhead 的控件是我想要浮动的控件。

提前致谢

编辑：浮动我的意思是css风格不是什么花哨的东西:)

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-11-14T13:49:13.487

如果您为控件定义了 CSS 类，则可以在调用`Controls.Add`方法之前执行此操作：

```
lnkCalcOverhead.CssClass = "MyClass"; 
```

如果你想直接使用 style 属性，试试这个：

```
lnkCalcOverhead.Style.Add("float", "left"); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-14T13:51:44.170

如果您在这里谈论 System.Windows.Forms（而不是 WPF 或 ASP.NET）：

当您谈论浮动时，您的意思是您想通过代码将其定位在您想要的任何位置吗？如果是这样，只需设置控件的 .Location 属性。

如果您正在谈论让程序的用户在面板内移动控件，则必须对其进行编码。这意味着捕获鼠标事件并相应地移动控件？

或者，您可以不让控件驻留在面板中，而是将其作为占据新表单的单个控件（因此您不必编写所有鼠标事件处理的代码）。只需确保窗口仅限于在“父面板”的边界内移动（只需检查窗体的移动事件是否在边界内并强制它留在里面）。

# java - 转换为日期

> ID：290116
> 
> 赞同：1
> 
> 时间：2008-11-14T13:42:28.883
> 
> 标签：java, date

我正在尝试创建多个 Evenement 实例并为它们设置日期：

```
 for (int i=2004; i<2009; i++){
           evenementen.add(new Evenement("Rock Werchter", "Rock", "Werchter", 200000,
                           (Date)formatter.parse(i+"/07/03"))); 
```

但我似乎无法让它工作，

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-14T13:54:18.953

您可能想使用日历来创建日期。

```
for (int i=2004; i<2009; i++) {
    Calendar cal = Calendar.getInstance();
    cal.clear();
    // Calendar.JULY may be different depending on the JDK language
    cal.set(i, Calendar.JULY, 3); // Alternatively, cal.set(i, 6, 3); 
    evenementen.add(new Evenement("Rock Werchter", "Rock", "Werchter", 200000,
            cal.getTime()));
} 
```

请注意，月份是从零开始的，因此 7 月是 6。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-14T13:59:35.900

注意用于日期格式化程序的语言环境（默认可以`Locale.ENGLISH`是您的操作系统设置为这种方式，这意味着年份位于末尾，而不是字符串的开头）

您需要确保将格式化程序构建为（在撰写本文时，2008，Java6，[如本答案所示](https://stackoverflow.com/a/51615452/6309)）：

```
formatter = new SimpleDateFormat("yyyy/MM/DD"); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2021-05-30T09:46:30.043

# *java.time*

`java.util`日期时间 API 及其格式化 API已`SimpleDateFormat`过时且容易出错。建议完全停止使用它们并切换到[现代 Date-Time API](https://www.oracle.com/technical-resources/articles/java/jf14-Date-Time.html) ^*。

## 使用`java.time`现代 API 的解决方案：

```
import java.time.LocalDate;
import java.time.Month;

public class Main {
    public static void main(String[] args) {
        for (int i = 2004; i < 2009; i++) {
            System.out.println(LocalDate.of(i, Month.JULY, 3));
        }
    }
} 
```

如果您想通过解析字符串（您在问题中发布的方式）来做到这一点，请使用`DateTimeFormatter`.

```
import java.time.LocalDate;
import java.time.format.DateTimeFormatter;
import java.util.Locale;

public class Main {
    public static void main(String[] args) {
        DateTimeFormatter dtf = DateTimeFormatter.ofPattern("u/M/d", Locale.ENGLISH);
        for (int i = 2004; i < 2009; i++) {
            LocalDate date = LocalDate.parse(i + "/07/03", dtf);
            System.out.println(date);
        }
    }
} 
```

**输出：**

```
2004-07-03
2005-07-03
2006-07-03
2007-07-03
2008-07-03 
```

从**[Trail: Date Time](https://docs.oracle.com/javase/tutorial/datetime/index.html)**了解更多关于`java.time`现代[日期时间 API](https://www.oracle.com/technical-resources/articles/java/jf14-Date-Time.html) ^*的信息。

* * *

^(* 出于任何原因，如果您必须坚持使用 Java 6 或 Java 7，则可以使用[***ThreeTen-Backport，***](http://www.threeten.org/threetenbp/)它将大部分*java.time*功能向后移植到 Java 6 和 7。如果您正在为 Android 项目和 Android API 工作level 仍然不符合 Java-8，请检查[Java 8+ APIs available through desugaring](https://developer.android.com/studio/write/java8-support-table)和[How to use ThreeTenABP in Android Project](https://stackoverflow.com/questions/38922754/how-to-use-threetenabp-in-android-project)。)

# javascript - ASP.NET Ajax 错误：Sys.WebForms.PageRequestManagerParserErrorException

> ID：290121
> 
> 赞同：25
> 
> 时间：2008-11-14T13:45:46.303
> 
> 标签：javascript, asp.net, .net, exception-handling, ajax.net

*在尝试执行任何*Ajax 活动时，我的网站一直给我间歇性错误。我得到的信息是

```
Sys.WebForms.PageRequestManagerParserErrorException: The message received from the server could not be parsed. Common causes for this error are when the response is modified by calls to Response.Write(), response filters, HttpModules, or server trace is enabled.

Details: Error parsing near '

<!DOCTYPE html P'. 
```

所以它显然是某种服务器超时或服务器只是返回损坏的垃圾。不幸的是，这通常会发生

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-14T13:50:29.897

Eilon Lipton 有一篇很棒的博客文章。它包含许多有关如何避免此错误的提示：

**[Sys.WebForms.PageRequestManagerParserErrorException - 它是什么以及如何避免它](http://weblogs.asp.net/leftslipper/archive/2007/02/26/sys-webforms-pagerequestmanagerparsererrorexception-what-it-is-and-how-to-avoid-it.aspx)**

也阅读评论。有同样问题的人评论说：“**我解决了它改变了 IIS 上我的应用程序池的服务器空闲时间**。它只有 5，所以我增加了它，现在可以工作了。”

*“UpdatePanel 控件使用异步回发来控制页面的哪些部分被渲染。它使用客户端上的一大堆 JavaScript 和服务器上的一大堆 C# 来做到这一点。*

*异步回发与常规回发完全相同，除了一件重要的事情：渲染。异步回发与常规页面经历相同的生命周期事件（这是我经常被问到的一个问题）。*

*只有在渲染阶段，事情才会有所不同。我们只捕获我们关心的 UpdatePanel 的渲染，并使用特殊格式将其发送给客户端。此外，我们还会发送一些其他信息，例如页面标题、隐藏的表单值、表单操作 URL 和脚本列表。”*

**该错误的最常见原因：**

1.  调用 Response.Write()：
2.  响应过滤器
3.  HttpModules
4.  服务器跟踪已启用
5.  调用 Server.Transfer()

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2011-07-19T13:14:24.700

回发时可能发生错误。在这种情况下，您可以通过将 PostBackTrigger 添加到更新面板并引用导致问题的按钮来查看有关错误的详细信息：

```
 <asp:updatepanel ID="updatepanel1" runat="server">
        <Triggers>
            <asp:PostBackTrigger ControlID="button1" /> 
        </Triggers>
        <ContentTemplate>

        </ContentTemplate>
    </asp:updatepanel> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-03-09T22:54:05.373

我发生了这种情况，并且答案中的列表中没有任何原因适用。直到我完全禁用了 AJAX，我才找到问题的根源。发现代码正在将一个对象保存到包含不可序列化对象的 ViewState 中。我使对象可序列化，它又开始工作了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-02-09T19:27:30.197

我解决了这个完全相同的问题，删除`Content-Type:`了. 这破坏了页面的编码，并以某种方式影响了 Ajax。`Custom HTTP Headers``HTTP Headers``IIS`

`Content-Type`我配置的是`IIS`将编码设置为`ISO-8859-1`.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-05-21T17:17:39.847

这可能有点hacky，但它为我解决了这个问题。我没有任何常见的错误原因，所以我只是在页面加载中放入了这个创可贴：

```
if (Session.SessionID == "")
{
    Page.Session.Add("SessionID", Session.SessionID);
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-08-04T08:48:31.100

问题：重定向页面时会发生 Sys.WebForms.PageRequestManagerParserErrorException，比如说在 aspxAjax 中的 UpdatePanel 中单击按钮。

解决方案：

1.  在使用更新面板的 aspx 页面中添加一个“转到”按钮，并将其添加到更新面板之外

2.  在您的代码中，将您刚刚注册的用户 ID 分配给会话变量，例如`Session["UseridJustregistered"]=Id`从 DB 或 UsernameField

3.  `Respose.Redirect("regSucces.aspx?urlid='" + Session["UseridJustregistered"] + "'");`

4.  检查是否`Session["UseridJustregistered"]`为空

这是可以解决我们问题的 OLD Classic ASP 方式，当微软找到解决方案时，我们可以通过这种方式解决它。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-12-23T16:35:18.070

我通过删除错误嵌套的 UpdatePanel 解决了同样的问题。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-07-31T22:14:40.697

我终于解决了同样问题的变体。我试图在网络表单的 2 个列表框之间复制/移动选定的值。就我而言，我必须在第二次执行该操作之前专门调用 {listbox}.ClearSelection() 。

所以很明显，这个问题/错误消息可能由于多种原因而发生。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-08-19T10:42:42.420

将应用程序池从 INTEGRATED 更改为 asp.net classic 为我解决了这个问题。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-05-28T18:53:44.710

在我们的案例中，问题是由途中的重写代理引起的。重写修改了更新面板响应的内容。但是这个响应也包含原始大小。重写机制无法知道响应的几个字节实际上包含原始响应大小，因此也应该对其进行修改。

更新面板响应如下所示：

```
1|#||4|30502|updatePanel|pnlUpdate| ... 
```

这`30502`是正在更新的内容的原始大小。重写引擎修改输出，但大小保持不变 => 解析器错误异常。

我看不到如何从客户端克服这个问题。我们需要知道内容是如何被修改的，然后在 UpdatePanel ClientScript 开始处理它之前以某种方式改变响应中的大小。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-09-19T00:55:23.537

我也遇到了这个错误。“user1097991”报告的解决方案解决了一段时间（我在视图状态上使用了未序列化的对象）

但后来错误又回来了，现在是随机的。经过一番搜索，我得到了答案：视图状态变得太大并且被截断了。我禁用了网格和菜单上的一些视图状态，问题没有再次出现。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-11-14T16:01:17.587

我发现我的问题与在 GridView 的数据绑定中呈现的 nul 字符有关。响应的预期长度与导致引发错误的响应文本的实际长度不匹配。修复数据库中的数据后，我不再收到错误消息。最终的解决方法是清理在 RowDataBound 事件期间呈现的文本。

查看数据库，我看不到错误数据，因为如果字符串中有 nul 字符 (Char(0))，SQL Server 2008 不会显示文本。在我的 GridView 的 RowDataBound 事件中，我添加了代码以对其中包含特殊字符的任何文本抛出异常。这就是我找到包含 nul 字符的记录的方式。

tl;dr - 检查呈现的 html 中的 nul 字符。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-12-19T21:29:33.580

另请注意，这可能是由于未正确 html 编码您可能通过部分回发呈现给页面的内容造成的。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-04-14T13:45:31.653

我有完全相同的错误。

对我来说是

```
<add name="ScriptModule" type="System.Web.Handlers.ScriptModule, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"/> 
```

缺少 web.config 的 httpModules 部分（.Net 3.5 应用程序）

这个错误似乎可能与许多不同的事情有关。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-07-14T10:18:55.413

将 ScriptMode 更新为“Release”

```
<asp:ScriptManager ID="ScriptManager" runat="server" ScriptMode="Release"></asp:ScriptManager> 
```

# multithreading - 为什么基于事件的网络应用程序天生就比线程应用程序快？

> ID：290128
> 
> 赞同：5
> 
> 时间：2008-11-14T13:48:30.150
> 
> 标签：multithreading, apache, asynchronous, lighttpd

我们都阅读了基准测试并知道事实——基于事件的异步网络服务器比线程服务器更快。想想 lighttpd 或 Zeus 与 Apache 或 IIS。这是为什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-14T13:57:41.037

我认为基于事件与基于线程不是问题 - 它是非阻塞多路复用 I/O、可选套接字、解决方案与线程池解决方案。

在第一种情况下，无论使用什么输入，您都在处理所有输入 - 因此读取没有阻塞 - 单个“侦听器”。单个侦听器线程将数据传递给不同类型的工作线程，而不是每个连接一个。同样，不会阻塞写入任何数据——因此数据处理程序可以单独运行。因为这个解决方案主要是 IO 读取/写入，所以它不会占用太多 CPU 时间——因此您的应用程序可以用它来做任何它想做的事情。

在线程池解决方案中，您有单独的线程处理每个连接，因此它们必须共享时间来上下文切换进出 - 每个“侦听”。在这个解决方案中，CPU + IO 操作在同一个线程中——这会得到一个时间片——所以你最终会等待 IO 操作来完成每个线程（阻塞），这通常可以在不使用 CPU 时间的情况下完成。

Google for non-blocking IO for more details - 你也可以找到一些与线程池的比较。

（如果有人可以澄清这些观点，请随意）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-06-29T19:05:50.013

事件驱动的应用程序*并非*天生就更快。

从[为什么事件是一个坏主意（对于高并发服务器）](https://www.usenix.org/conference/hotos-ix/why-events-are-bad-idea-high-concurrency-servers)：

```
We examine the claimed strengths of events over threads and show that the
weaknesses of threads are artifacts of specific threading implementations
and not inherent to the threading paradigm. As evidence, we present a
user-level thread package that scales to 100,000 threads and achieves
excellent performance in a web server. 
```

那是在 2003 年。从那时起，现代操作系统上的线程状态肯定有所改善。

编写基于事件的服务器的核心意味着在您的代码中重新发明协作式多任务处理（Windows 3.1 风格），很可能是在已经支持适当的抢先式多任务处理的操作系统上，并且没有透明上下文切换的好处。这意味着您必须管理通常由指令指针暗示或存储在堆栈变量中的堆上​​的状态。（如果你的语言有它们，闭包可以显着减轻这种痛苦。尝试在 C 中做到这一点就没那么有趣了。）

这也意味着您获得了协作式多任务处理所暗示的所有警告。如果您的某个事件处理程序由于某种原因需要一段时间才能运行，它会停止该事件线程。完全不相关的请求滞后。即使是冗长的 CPU 发明操作也必须发送到其他地方以避免这种情况。当您谈论高并发服务器的核心时，“冗长操作”是一个相对术语，对于预计每秒处理 100,000 个请求的服务器而言，大约为微秒。我希望虚拟内存系统永远不必为您从磁盘中提取页面！

从基于事件的架构中获得良好的性能可能会很棘手，尤其是当您考虑延迟而不仅仅是吞吐量时。（当然，线程也有很多错误。并发仍然很难。）

对于新服务器应用程序的作者，有几个重要问题：

*   线程在您今天打算支持的平台上如何执行？他们会成为你的瓶颈吗？
*   如果您仍然坚持使用错误的线程实现：为什么没有人解决这个问题？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-14T14:05:15.063

这真的取决于你在做什么；对于非平凡的应用程序，基于事件的编程肯定是棘手的。作为 Web 服务器确实是一个非常容易理解的微不足道的问题，事件驱动和线程模型在现代操作系统上都运行得很好。

在事件模型中正确开发更复杂的服务器应用程序通常非常棘手 - 线程应用程序更容易编写。这可能是决定因素而不是性能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-14T13:59:16.650

这实际上与线程无关。这是关于线程用于服务请求的方式。对于像 lighttpd 这样的东西，你有一个通过事件为多个连接提供服务的线程。对于旧版本的 apache，每个连接都有一个进程，并且该进程在传入数据时唤醒，因此当有很多请求时，您最终会得到一个非常大的数字。但是，现在使用 MPM apache 是基于事件的，请参阅[apache MPM event](http://httpd.apache.org/docs/2.2/mod/event.html)。

# perl - 如何检查数据库查询是否会返回结果？

> ID：290133
> 
> 赞同：5
> 
> 时间：2008-11-14T13:49:28.790
> 
> 标签：perl, dbi, rows

我们的网站使用 Perl 为我们的人力资源人员提供一个简单的机制来将职位空缺发布到我们的网站。它是由第三方开发的，但他们早就开始接触了，遗憾的是我们内部没有任何 Perl 技能。当营销人员绕过他们的内部 IT 团队时，就会发生这种情况！

我需要对此应用程序进行简单的更改。目前，职位空缺页面显示“我们目前有以下职位空缺：”，无论是否有职位空缺！所以我们想改变它，使这条线只在适当的时候显示。

显然，我可以开始学习一点 Perl，但我们已经在计划一个替代站点，而且它肯定不会使用 Perl。因此，由于解决方案对于具有这些技能的人来说是微不足道的，我想我会寻求一些有针对性的帮助。

以下是列出职位空缺的程序的开始。

```
sub list {
  require HTTP::Date;
  import HTTP::Date;

  my $date = [split /\s+/, HTTP::Date::time2iso(time())]->[0];

  my $dbh = DBI->connect($dsn, $user, $password)
    || die "cannot connect to $database: $!\n";

  my $sql = <<EOSQL;
SELECT * FROM $table where expiry >= '$date' order by expiry
EOSQL

  my $sth = $dbh->prepare($sql);
  $sth->execute();

  while (my $ref = $sth->fetchrow_hashref()) {
    my $temp  = $template;
    $temp     =~ s#__TITLE__#$ref->{'title'}#;

    my $job_spec = $ref->{'job_spec'};

...etc... 
```

关键线是`while (my $ref = $sth->fetchrow_hashref()) {`。我想这是在说'虽然我可以从返回的记录集中拉出另一个空缺......'。如果我将打印语句放在这一行之前，它将始终显示；在这条线之后，每个空缺都会重复。

我如何确定有一些空缺要显示，而不会过早地通过返回的记录集？

我总是可以在 while 循环中复制代码，并将其放在 if() 语句中（在 while 循环之前），该语句也将包括我的 print 语句。但我更喜欢使用更简单的方法`If any records then print "We currently have.." line`。不幸的是，即使是这条简单的代码，我也不知道如何编写代码。

看，我告诉过你这是一个微不足道的问题，即使考虑到我笨拙的解释！

TIA

克里斯

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-14T13:55:39.997

一个非常简单的方法是：

```
$sth->execute();

my $first = 1;
while (my $ref = $sth->fetchrow_hashref()) {
    if( $first ) {
        print "We currently have the following vacancies:\n";
        $first = 0;
    }
    my $temp  = $template;
    ...
}
if( $first ) {
    print "No vacancies found\n";
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-14T13:55:11.493

这与其说是一个 Perl 问题，不如说是一个数据库问题，并且在获得结果之前没有什么好方法可以知道您有多少结果。你在这里有两个选择：

1.  执行执行“选择计数（*）”的查询以查看有多少行，然后执行另一个查询以获取实际行或
2.  执行查询并将结果存储到散列中，然后计算散列中有多少条目，然后遍历散列并打印出结果。

例如，在我的脑海中：

```
my @results = ();
while (my $ref = $sth->fetchrow_hashref()) {
   push @results, $ref;
}

if ($#results == 0) {
  ... no results
} else {
  foreach $ref (@results) {
    my $temp = $template;
    ....
 } 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-14T16:51:26.537

如果您使用的是 Mysql，“rows”方法可以正常工作：

```
$sth->execute();

if($sth->rows) {
  print "We have data!\n";
}

while(my $ref = $sth->fetchrow_hashref()) {
...
} 
```

该方法和一些注意事项在“perldoc DBI”中详细记录。始终以“perldoc”开头。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-14T19:17:34.650

由于每个人都想优化在 Graeme 的解决方案中是否已打印标题的重复测试，因此我在其上提出了这个小变化：

```
$sth->execute();

my $ref = $sth->fetchrow_hashref();
if ($ref) {
  print "We currently have the following vacancies:\n";
  while ($ref) {
    my $temp  = $template;
    ...
    $ref = $sth->fetchrow_hashref();
  }
} else {
    print "No vacancies found\n";
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-10-16T14:59:53.333

由于您的查询是**SELECT**，因此您不能利用[*行或*](http://search.cpan.org/~timb/DBI-1.631/DBI.pm#rows)[*执行*](http://search.cpan.org/~timb/DBI-1.631/DBI.pm#execute)本身返回的值。

但是，您可以通过添加另一个查询来预先计算您的查询将选择多少行（即空缺）......像这样：

```
# Retrieve how many vacancies are currently offered:
my $query = "SELECT COUNT(*) AS rows FROM $table WHERE expiry >= ?";
$sth = $dbh->prepare($query);
$sth->execute($date);
$numVacancies = $numinfo->fetchrow_arrayref()->[0];

# Debug:
print "Number of vacancies: " . $numVacancies . "\n";

if ( $numVacancies == 0 ) { # no vacancy found...
    print "No vacancies found!\n";
}
else { # at least a vacancy has been found...
    print "We currently have the following vacancies:\n";

    # Retrieve the vacancies:
    my $sql = "SELECT * FROM $table where expiry >= '$date' ORDER BY expiry";
    my $sth = $dbh->prepare($sql);
    $sth->execute();

    ...
} 
```

或者，类似地，您可以使用[*selectrow_array*](http://search.cpan.org/~timb/DBI-1.631/DBI.pm#selectrow_array)在一次调用中完成所有操作，而不是*“准备”*和*“执行”*查询然后使用*“fetchrow_array”*：[](http://search.cpan.org/~timb/DBI-1.631/DBI.pm#selectrow_array)

 *```
# Retrieve how many vacancies are currently offered:
my $query = "SELECT COUNT(*) AS rows FROM $table WHERE expiry >= ?"; 
my $numVacancies = $dbh->selectrow_array($query, undef, $date);

# Debug:
print "Number of vacancies: " . $numVacancies . "\n"; 
```

[*selectall_arrayref*](http://search.cpan.org/~timb/DBI-1.631/DBI.pm#selectall_arrayref)也是如此：

```
# Retrieve how many vacancies are currently offered:
my $query = "SELECT COUNT(*) AS rows FROM $table WHERE expiry >= ?";
my $numVacancies = $dbh->selectall_arrayref($query, {Slice => {}}, $date);

# Debug:
print "Number of vacancies: " . @$numVacancies[0]->{rows} . "\n"; 
```

但是，如果您使用*selectrow_array*或*selectall_arrayref*，您也可以直接从原始查询的结果中检索空缺数量：

```
# Retrieve the vacancies:
my $sql = "SELECT * FROM $table where expiry >= ? ORDER BY expiry";
my $vacancies = $dbh->selectall_arrayref($sql, {Slice => {}}, $date);

# Debug:
print "Number of vacancies: " . scalar @{$vacancies} . "\n"; 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-14T14:03:37.703

一种更有效的方法（避免循环内的条件），如果你不介意它改变页面的输出方式（一次而不是一次），你可以创建一个变量来保存在循环之前输出：

```
my $output = ''; 
```

然后在循环内，将任何打印语句更改为如下所示：

```
$output .= "whatever we would have printed"; 
```

然后在循环之后：

```
if ($output eq '')
{
  print 'We have no vacancies.';
}
else
{
  print "We currently have the following vacancies:\n" . $output;
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-14T14:05:06.250

只需添加另一个查询.. 像这样：

```
# count the vacancies    
$numinfo = $dbh->prepare("SELECT COUNT(*) FROM $table WHERE EXPIRY >= ?");
$numinfo->execute($date);
$count = $numinfo->fetchrow_arrayref()->[0];

# print a message
my $msg = '';
if   ($count == 0) $msg = 'We do not have any vacancies right now';
else               $msg = 'We have the following vacancies';
print($msg); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-14T18:06:40.410

```
use Lingua::EN::Inflect 'PL';

$sth->execute();
my $results = $sth->fetchall_arrayref( {}, $max_rows );

if (@$results) {
    print "We currently have the following ", PL("vacancy",scalar @$results), ":\n";

    for my $ref (@$results) {
        ...
    }
} 
```

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2008-11-15T04:28:45.880

perldoc DBI 说：

```
 For a non-"SELECT" statement, "execute" returns the number of rows
 affected, if known. If no rows were affected, then "execute"
 returns "0E0", which Perl will treat as 0 but will regard as true. 
```

所以答案是检查$sth->execute()的返回值：

```
 my $returnval = $sth->execute;
 if (defined $returnval && $returnval == 0) {
     carp "Query executed successfully but returned nothing";
     return;
 } 
```

# c++ - 最小化和最大化窗口的事件处理程序

> ID：290139
> 
> 赞同：2
> 
> 时间：2008-11-14T13:51:58.677
> 
> 标签：c++, windows-mobile, pocketpc

我正在为 PocketPC 开发一个应用程序。当应用程序启动时，调用自定义函数 SetScreenOrientation(270) 旋转屏幕。当应用程序关闭时，调用函数 SetScreenOrientation(0) 来恢复屏幕方向。

这样，如果用户最小化应用程序，屏幕方向不会恢复，这是不可接受的。

有谁知道应该在哪里（在哪个事件处理程序中）调用 SetScreenOrientation(int angle) 以在应用程序启动时设置屏幕方向、在最小化时恢复方向、在最大化时设置方向并在关闭时恢复方向？

实际上我不知道哪个事件处理程序处理 Minimize 和 Maximize 事件。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-14T14:28:15.500

根据我的 Windows CE 经验，您应该处理[WM_SIZE](http://msdn.microsoft.com/en-us/library/ms915712.aspx)或[WM_WINDOWPOSCHANGED](http://msdn.microsoft.com/en-us/library/ms942858.aspx)消息。如果您正在使用 PocketPC，我建议您先查看 WM_WINDOWPOSCHANGED 消息，因为我不确定 WM_SIZE 是否具有您需要的正确参数。

从 WM_WINDOWPOSCHANGED 消息的[WINDOWPOS](http://msdn.microsoft.com/en-us/library/ms915525.aspx)结构看一下 flags 成员，特别是 SWP_SHOWWINDOW 和 SWP_HIDEWINDOW。

* * *

您需要查看的消息的特定版本因您使用的操作系统而异。Pocket PC 操作系统基于 Windows CE 3.0（及更低版本）构建，而 Windows Mobile 现在基于 Windows CE 5.0（甚至 Windows Mobile 6）构建，但也构建在 Windows CE 4 之上。[（来源）](http://www.pocketpcfaq.com/wce/versions.htm)

因此，只需在 MSDN 中的相关部分查看您正在编写的操作系统即可。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-14T14:40:41.357

正确的消息是[WM_SIZE](http://msdn.microsoft.com/en-us/library/aa453907.aspx)，但 Daemin 的回答指向了错误的 WM_SIZE 帮助主题。检查 wParam。请小心，因为您的窗口可能已最大化但被隐藏。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T14:25:25.507

我不知道这些在 C++ 世界中被称为什么，但在 .NET Compact Framework 中，当您最小化/最大化窗口时，您的应用程序窗体的 Resize 事件将被调用，然后在事件代码中您将检查 WindowState 的属性表单以查看它是最小化还是最大化。

从应用程序中更改 PDA 的状态是有风险的（尽管有很多充分的理由这样做），因为如果您的应用程序崩溃，它将使 PDA 处于任何状态。我已经做了很多 kiosk -Windows Mobile 中的（全屏）应用程序，有效执行此操作的技巧之一是隐藏 WM 标题栏（带有 Windows 开始按钮的顶行），以防止它每次闪烁一瞬间你打开一个新表格。如果应用程序崩溃，则在您重置设备之前，窗口栏将保持不可见，这不好。至少通过屏幕旋转，用户可以手动恢复它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-18T05:02:19.057

这真的取决于平台，但我会选择 WM_WINDOWPOSCHANGED 或 OnShow。这不是 wm_size .. 并不总是在所有平台上抛出。卡西欧不会在您期望的时候抛出 size 事件。TDS 和 Symbol 都可以。

尽管 MSDN 是一个很好的信息来源，但请记住，并非所有操作系统都是平等的。在 PPC 世界中，硬件供应商可以创建自己的操作系统，有时甚至会遗漏一些东西，或者故意忽略一些东西。

我在这里有一个平台（名字隐瞒以保护......好吧我）有左右按钮..当你按下它们时，你会期望能够抓住VK_LEFT，VK_RIGHT..你错了. 你实际上得到';' 或者 '：'。踢裤子怎么样。

# java - 是否有用于 Java 的数据库建模库？

> ID：290163
> 
> 赞同：5
> 
> 时间：2008-11-14T14:04:09.247
> 
> 标签：java, database, rdbms, modeling

有谁知道一个 Java 库，它为分析和操作任意关系数据库模式提供了有用的抽象？我在想一些可以做的事情

```
LibraryClass dbLib = ...;
DbSchema schema = dbLib.getSchema("my_schema");
List<DbTable> tables = schema.getTables(); 
```

和

```
DbTable myTable  = ...
for(DbColumn col : myTable.getColumns()){
    ... = col.getType();
} 
```

甚至操纵表格

```
myTable.addColumn(
    new DbColumn("my_new_column", Type.UNSIGNED_INTEGER);
);

DbColumn myColumn = ...
myTable.removeColumn(myColumn); 
```

大多数数据库建模工具在内部都会有这样的抽象，但是在 Java 中是否有一个我可以使用，或者我必须自己开发一个？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-14T14:17:01.700

JDBC 本身就有这样的抽象。查看 java.sql.DatabaseMetaData。但是，这是标准的可选部分，它取决于您使用的 JDBC 驱动程序是否已实现。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-12T04:13:45.163

[DdlUtils](http://db.apache.org/ddlutils/)有你正在寻找的东西。您可以从 XML（以 Torque 格式）或实时数据库读取/写入模式，甚至可以在纯 Java 中定义数据库模式。更好的是，阅读在线文档，它非常好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T14:09:18.377

我已经很多年没有使用它了，但是 Hibernate 曾经有用于在构建时[操作数据模型的工具。](http://www.hibernate.org/255.html)Hibernate 还具有方言的概念，如果您针对多个数据库供应商，这将很有帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-15T03:26:30.030

当我在 MetaMatrix 时，我们使用 EMF（Eclipse 建模框架）构建了这样一个东西，我们在 UML 中创建了一个表示元模型，然后从代码生成它。元建模的好处是，如果你做得好，你可以跨元模型进行互操作，前提是你对元元模型做出了很好的选择。

我们还有一个导入器，它可以从 JDBC API 导入元数据并创建适当的等效模型对象（数据库、表、列、键等）。

自从被 JBoss 收购后，这些代码可能有一天会开源，但我认为还没有。

# web-services - 计算 SOAP 内容长度

> ID：290172
> 
> 赞同：4
> 
> 时间：2008-11-14T14:06:04.407
> 
> 标签：web-services, language-agnostic, soap

你如何计算 Content-Length 是一个肥皂消息？是整个肥皂信息中的字符数吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-27T19:39:47.800

它是字节数，而不是字符数，因此它将取决于使用的文本编码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T23:51:04.287

是的。将您的 XML 消息转换为字符串并将字符串的长度用作 Content-Length。

（假设您使用的是八字节字符。）

# usability - 找人做可用性测试

> ID：290174
> 
> 赞同：3
> 
> 时间：2008-11-14T14:06:22.033
> 
> 标签：usability

有没有人有关于如何找到愿意对基于 Web 的应用程序进行可用性测试的人的建议/经验？我怀疑我可能需要可能实际上是潜在用户的人，因为我是一个商业/垂直应用程序，其中包含一些流程和术语，对于普通的 joe/jane 来说可能意义不大。

我有一个相当强大的 Web 应用程序原型，它是为销售管理人员设计的，在我进一步研究它之前，我想在一些现场用户身上尝试几个关键部分。我有一些友好的面孔我可以求助（并且已经），但我真的希望陌生人不会觉得他们需要对我好。

我很好地设计了可用性测试本身，它正在寻找被证明是困难的豚鼠。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-14T14:31:26.383

我已经使用过几次这项服务，并且对他们提供的反馈质量印象深刻。

[usertesting.com](http://www.usertesting.com/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-14T14:35:01.757

[Don't Make Me Think](https://rads.stackoverflow.com/amzn/click/com/0321344758)有你感兴趣的确切章节。基本上，你应该以这样一种方式设置你的测试，它不是关于好不好，而是关于找出用户是否可以使用它. 这样您就可以使用您想要和认识的所有亲戚或朋友。

简而言之：用可以访问您的应用程序的计算机设置一张桌子，准备两把椅子、一个记事本和一支铅笔。这本书提到了你同事的视频链接，但让我们跳过它。你拿起你的测试仪，把她放在电脑前，坐在她旁边，准备好记事本和铅笔。为了这次测试，请具体说明一下，从技术上讲，她做错了什么是不可能的，因为那是您感兴趣的。

然后让她做一些具体的任务；你在应用程序中向她展示某种状态，并要求她做某事。示例：“如果你想做一个新条目，你会怎么做”。让她描述她的想法，她的思路；“我会寻找某种‘添加’或‘+’标记的按钮，让我们看看能不能找到它。它们通常在列表下方”等。记下她的手势和面部的微妙之处，比如如果她用光标寻找什么东西，或者她是否沮丧地做鬼脸。

如果她不能足够快地找到添加按钮，则存在可用性问题。

但真的，买书。这是一本很棒的书，值得每一分钱。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-14T14:44:36.153

您是否有可能成为您应用程序潜在客户的本地公司列表？这将是一个不错的地方；您可以同时让用户进行用户测试并建立良好的联系。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-10-29T13:05:16.140

把自己带到星巴克，在你的笔记本电脑背面贴一个牌子，上面写着“向我要一杯免费咖啡”，确保你使用像[Silverback](http://silverbackapp.com/)这样的屏幕录制软件来录制会话以备后用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-14T14:09:56.050

几天前我读了这篇文章，它可能会有所帮助：

[http://www.joelonsoftware.com/uibook/fog0000000249.html](http://www.joelonsoftware.com/uibook/fog0000000249.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-14T14:22:29.880

您的组织是否有一个销售团队可以让您借用合适的用户？我认为这将是 UI 的 Alpha 测试的良好开端。之后，也许您的客户可以使用 Beta UI 进行进一步测试。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-14T14:57:54.863

信不信由你，Craig's List 中的广告对我们有用。只需提供奖励，我们使用 50 美元的预付借记卡，每个广告通常可以吸引 10 - 20 人。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-14T15:13:44.830

请参阅 useit.com - 有几个级别的可用性测试，招募代表目标市场的用户显然至关重要

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-14T15:53:55.547

您还可以查看[uTest.com](http://www.utest.com/ "uTest.com")，这是一个依赖“众包”测试过程的软件测试服务。虽然更多的是功能和技术测试，但我相信您可以协商一个更专注于可用性测试的测试项目。

# javascript - 图片显示中的浏览器依赖问题

> ID：290178
> 
> 赞同：2
> 
> 时间：2008-11-14T14:07:49.847
> 
> 标签：javascript, html, internet-explorer, image

在我的页面中，我在用户选择一些信息后显示报告。在按钮`onclick`事件中，我正在显示一个图像，该图像会自行旋转以向用户指示正在处理请求。图像在 Firefox 中旋转，但在 IE 中不旋转（它只是显示图像）。请给我你的建议。

带着敬意

普拉卡什

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-14T14:58:53.753

我猜这是因为您的页面已经向服务器提交了一个标准的同步请求并且正在等待响应。我注意到在某些版本的 IE 中，即使是动画 GIF 也会冻结。

您可能希望将服务器请求更改为异步（a la AJAX）。好处之一是不会冻结动画图像。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T14:50:47.903

你使用什么样的图像？GIF 还是 PNG？

动画 PNG (APNG) 在 Internet Explorer 中不起作用。

但是 APNG 是一种不那么流行的格式。如果您使用的是动画 gif，请检查 IE 的设置： **Internet 选项 > 高级 > 多媒体 > 在网页中播放动画**必须启用。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-14T14:22:53.653

尝试在其他机器上打开该页面。

# bash - 如何在 bash 中为别名自动引用或分组命令行参数？

> ID：290187
> 
> 赞同：3
> 
> 时间：2008-11-14T14:11:33.567
> 
> 标签：bash, alias

我有一个脚本，它接受一个命令并在远程主机上执行它。它工作正常，例如：

```
$ rexec "ant build_all" 
```

将在远程系统上执行“ant build_all”命令（通过 SSH 等传递）。

因为我很懒，我想为这个命令（最终还有其他几个）设置一个别名，例如，我可以调用

```
$ rant build_all 
```

并且 bash 会自动调用

```
$ rexec "ant build_all" 
```

我尝试使用别名来执行此操作，但如果我定义

```
alias rant=rexec ant 
```

那么传递给“rant”的任何参数都将被附加到末尾，如下所示：

```
$ rant build_all -Dtarget=Win32
(interpreted as:)
$ rexec "ant" build_all -Dtarget=Win32 
```

这失败了，因为 rexec 实际上只接受一个参数，而忽略其他参数。

我可能可以使用 bash 包装脚本来执行此操作，但我想知道 bash 是否有任何内置函数可以为我执行此操作，可能是别名的命名参数版本，或者类似 perl 的引号字符串命令（例如 qw/ / )，或类似的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-14T14:21:45.777

对于所有论点，这将起作用。

```
function rant () {
    rexec "ant $*"
} 
```

您可能需要调整引用，具体取决于您传递的参数。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-14T14:32:43.633

我最终使用了 Ken G 的答案，但更好的是：将 rex 定义为函数，如下所示：

```
function rex {
    run_remote.sh -c "$*"
} 
```

然后允许我在别名中使用 rexec，如下所示：

```
alias rant="rex ant" 
```

并且仍然让它按照我需要的方式包装论点。

我忘了我可以在 bash 中使用类似的函数。这正是我需要的，无需创建包装脚本。

很好的提示，谢谢！

编辑：将“rexec”更改为“rex”，因为我发现我的系统已经有一个名为“rexec”的程序

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T14:21:32.907

您可以将其作为函数而不是别名来执行：

```
function rant { rexec "ant $1"; } 
```

您可以像别名一样在命令行调用它

# .net - 最佳实践：ByRef 还是 ByVal？在.Net

> ID：290189
> 
> 赞同：18
> 
> 时间：2008-11-14T14:12:20.510
> 
> 标签：.net, byref, byval

在 ByRef 和 ByVal 之间进行选择时需要考虑哪些事项。

我了解两者之间的区别，但我不完全了解 ByRef 是否可以节省资源，或者我们是否甚至需要在 .Net 环境中担心这一点。

如果功能在某种情况下无关紧要，您如何在两者之间做出决定？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-11-14T14:28:02.270

有很多关于这方面的错误信息。主要是你理解了[值类型和引用类型](http://pobox.com/~skeet/csharp/references.html)的[区别，以及按值传递和按引用传递](http://pobox.com/~skeet/csharp/parameters.html)的区别。

您几乎总是希望按值传递。通过引用传递几乎总是用于“我想返回多个结果，而不仅仅是通过将内容添加到传入的列表中”。使用传递引用的方法的经典示例是[Int32.TryParse](http://msdn.microsoft.com/en-us/library/f02979c7.aspx)，其中返回值是成功/失败，解析值由 out 参数“返回”。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-11-14T14:41:21.073

对于所有类型，默认值为 byValue，但重要的是要了解这两个选项对于“引用类型”（类）而不是值类型的含义。（结构）。

对于引用类型，如果在方法中声明引用类型变量，则该变量是方法堆栈帧中的内存位置。它不在堆上。当您初始化该变量（使用 new 或工厂等）时，您已经在堆上创建了一个实际对象，并且该对象的地址存储在方法堆栈框架中声明的引用变量中。

当您通过Val将引用类型传递给另一个方法时，您正在创建存储在调用方法堆栈中的地址的副本，并将该值的副本（指针地址）传递给被调用的方法，并将其存储在新内存中被调用的方法堆栈中的插槽。在被调用的方法内部，新克隆的变量直接指向堆上的同一个对象。所以使用它可以改变同一个对象的属性。但是您不能更改原始引用变量（在调用方法堆栈上）指向的堆对象。如果，在被调用的方法中我写

```
 myVar = new object(); 
```

调用方法中的原始变量不会更改为指向新对象。

如果我通过引用传递一个引用类型，otoh，我传递了一个指向调用方法堆栈中声明变量的指针（其中包含指向堆上对象的指针）因此它是指向对象指针的指针。它指向调用方法堆栈上的内存位置，它指向堆上的对象。
所以现在，如果我在被调用方法中更改变量的值，通过将其设置为一个新的 object()，如上所述，因为它是对调用方法中变量的“引用”，我实际上是在更改哪个对象调用方法中的变量指向。所以被调用方法返回后，调用方法中的变量将不再指向堆上同一个原始对象。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-14T14:15:00.457

ByVal 应该是您的“默认值”。除非您有特定理由使用 ByRef，否则请使用它

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-11-14T14:29:39.960

在 .net 中传递对象 ByVal 不会复制对象，也不会消耗比 ByRef 更多的资源，指针仍然传递给函数。运行时只是确保您不能修改函数中的指针并为其返回不同的值。您仍然可以更改对象内的值，并且您将在函数之外看到这些更改。这就是为什么 ByRef 很少使用的原因。仅当您想要一个函数来更改返回的实际对象时才需要它；因此是一个输出参数。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-14T14:17:12.293

仅当参数为“输出”参数时才使用“ByRef”。否则使用“ByVal”。在明确不应返回值的参数上使用“ByRef”是危险的，并且很容易产生错误。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-07-07T16:35:59.017

我认为永远不应该使用 ByRef——这是一种不好的做法。我甚至会将其应用于允许函数返回多个值（通过 ByRef 参数）的典型用例。函数返回包含这些多个返回值的结构化响应会更好。如果一个函数只通过它的 return 语句返回值，那就更清楚和更明显了。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-02T21:49:25.057

将某些参数标记为 ByRef 向函数的用户显示分配给该参数的**变量****将被修改。****

**如果**对所有参数都使用 ByRef，则无法判断函数修改了哪些变量，而函数只读取了哪些变量。*（除了偷看函数源！）*

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-03-22T11:18:07.057

根据 Microsoft 的说法，选择 ByVal 或 ByRef 会影响足够大的值的性能（请参阅[Passing Arguments by Value and by Reference (Visual Basic)](https://msdn.microsoft.com/en-us/library/ddck1z30.aspx#sectionToggle1)）：

> 表现。尽管传递机制会影响代码的性能，但差异通常是微不足道的。一个例外是通过 ByVal 传递的值类型。在这种情况下，Visual Basic 复制参数的整个数据内容。因此，**对于结构体这样的大值**类型，通过 ByRef 传递**会更有效率。**

[强调补充]。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-10-02T11:17:11.930

```
Sub last_column_process()
Dim last_column As Integer

last_column = 234
MsgBox last_column

trying_byref x:=last_column
MsgBox last_column

trying_byval v:=last_column
MsgBox last_column

End Sub

Sub trying_byref(ByRef x)
x = 345
End Sub

Sub trying_byval(ByRef v)
v = 555
End Sub 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-03-17T13:54:05.347

很多困惑我会尽量简化。你基本上有4个选择：

1.  传递值类型 byVal
2.  传递一个值类型 byRef
3.  通过Val传递一个对象
4.  通过引用传递一个对象

有人说你*永远不*应该使用 byRef。虽然它们在技术上是正确的，但有一件事是肯定的。你不应该*使用从不***这个**词。如果您是从头开始设计系统，那么应该不惜一切代价避免使用 byRef。使用它会暴露一个设计缺陷。然而，在现有系统上工作可能无法提供足够的灵活性来实现良好的设计。有时你必须进行consessions，即使用byRef。例如，如果您可以使用 byRef 在 2 天内完成修复，那么这可能比重新发明轮子并花一周时间来获得相同的修复只是为了避免使用 byRef 更可取。

 *概括：

1.  在值类型上使用 byVal：将值传递给函数。这是设计函数的首选方式。
2.  在值类型上使用 byRef：对于从函数返回多个值很有用。如果您正在创建一个需要向现有系统返回多个值的函数，这可能比仅为一个函数创建一个对象（并设置属性和处置）更好。
3.  在对象上使用 byVal：将对象的指针传递给函数。该函数可以修改对象。
4.  在对象上使用 byRef：将指向对象指针的指针传递给函数。允许更改调用者指向的对象。这可能会导致一些难以找到的错误，我想不出任何好的理由来使用它。并不意味着没有，但如果有的话，它们之间就很少了。

# java - java中的滑动通知栏（a la Firefox）

> ID：290210
> 
> 赞同：3
> 
> 时间：2008-11-14T14:23:51.233
> 
> 标签：java, swing, user-interface, notifications, notification-bar

我想在 Firefox 或 IE 中为我的 java 应用程序实现一个滑动通知栏。但我不想重新发明轮子，我敢肯定有人已经做过并且愿意分享。你知道在 java/swing 中有什么开源实现吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T19:34:49.517

[Swing Hacks](https://rads.stackoverflow.com/amzn/click/com/0596009070)中有一个名为“从任务栏滑出笔记”的示例，它看起来非常接近您想要的（目前在 Google 的图书搜索中 有一个[预览）。](http://books.google.com/books?id=oNbFfcyAtv4C&pg=PA240&dq=%22Swing+hacks%22+%22slide+notes+out+from+the+taskbar%22)

该代码可从[官方 O'Reilly Swing Hacks 页面](http://oreilly.com/catalog/9780596009076/)的“示例”下免费获得。不确定许可证是什么，但值得一看（第 6 章，hack 46）。无论如何，20 美元左右的 Swing Hacks 是值得购买的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-07-13T19:21:44.040

一种标准方法是使用[Swing TrayIcon API](http://docs.oracle.com/javase/7/docs/api/java/awt/TrayIcon.html)。这也可能是最方便的方式:)

# c# - 如何通过覆盖对象序列化将多个属性组合到一个标签中

> ID：290213
> 
> 赞同：0
> 
> 时间：2008-11-14T14:25:34.960
> 
> 标签：c#, xml-serialization

当我序列化时；

```
public class SpeedDial
{
    public string Value { get; set; }
    public string TextTR { get; set; }
    public string TextEN { get; set; }
    public string IconId { get; set; }
} 
```

结果：

```
<SpeedDial>
    <Value>110</Value>
    <TextTR>Yangın</TextTR>
    <TextEN>Fire</TextEN>
    <IconId>39</IconId>
</SpeedDial> 
```

但我想要的是这样的：

```
 <speedDial>
    <value>110</value>
    <text>
      <TR>Yangın</TR>
      <EN>Fire</EN>
    </text>
    <iconId>39</iconId>
  </speedDial> 
```

我想学习规范的方法...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-14T15:01:59.097

三种方法跃入脑海：

1：创建一个用于序列化的属性，并隐藏其他属性`[XmlIgnore]` 2：实现`IXmlSerializable`并自己做 3：创建一个单独的 DTO 仅用于序列化

这是一个将“文本”部分重新分解为`XmlSerializer`喜欢的对象的示例，同时保留原始的公共 AIP：

```
[Serializable]
public class SpeedDial
{
    static void Main()
    {
        XmlSerializer ser = new XmlSerializer(typeof(SpeedDial));
        SpeedDial foo = new SpeedDial { Value = "110", TextTR = "Yangin",
            TextEN = "Fire", IconId = "39" };
        ser.Serialize(Console.Out, foo);
    }
    public SpeedDial()
    {
        Text = new SpeedDialText();
    }

    [XmlElement("text"), EditorBrowsable(EditorBrowsableState.Never)]
    public SpeedDialText Text { get; set; }

    public string Value { get; set; }
    [XmlIgnore]
    public string TextTR
    {
        get { return Text.Tr; }
        set { Text.Tr = value; }
    }
    [XmlIgnore]
    public string TextEN
    {
        get { return Text.En; }
        set { Text.En = value; }
    }

    public string IconId { get; set; }
}
[Serializable]
public class SpeedDialText
{
    [XmlElement("EN")]
    public string En { get; set; }
    [XmlElement("TR")]
    public string Tr { get; set; }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T14:54:53.013

如果我是你，我不会这样做，因为你让你的序列化器依赖于你的业务对象。对于小写，您可以使用 xml-customattributes。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T15:11:26.457

```
public class SpeedDial
{
    public string Value { get; set; }
    public TextClass text;
    public string IconId { get; set; }
}

public class TextClass
{
    public string TR { get; set; }
    public string EN { get; set; }
} 
```

# javascript - 在 AJAX 中如何从 onreadystatechange = function () 内部检索变量

> ID：290214
> 
> 赞同：0
> 
> 时间：2008-11-14T14:25:57.907
> 
> 标签：javascript, ajax

是否可以`onreadystatechange`从函数外部检索函数中设置的变量？
--edit--
关于函数的执行：
如果可能的话，我想通过单击执行 ajaxFunction()，
然后在下次单击时执行 popup()，或者以某种方式等待 ajax 函数结束然后调用警报框

在伪代码中：

```
function ajaxFunction(){
    //creating AJAX 
    ...
    // Create a function that will receive data sent from the server
    ajaxRequest.onreadystatechange = function (){
        if(ajaxRequest.readyState == 4){
            //success code
            ======>Here i want to set variable <=====
            var MyVariable='MyContent';
        }
    }
    //Retrieving page
    ....
}

function popup(){
    ajaxFunction();
    alert(MyVariable);
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-14T14:49:11.043

以下代码假定 ajax-request 是同步的：

```
function popup(){
    ajaxFunction();
    alert(MyVariable);
} 
```

但是由于同步请求会阻塞浏览器，因此您几乎在所有情况下都应该使用异步调用（如果我没记错的话，onreadystatechange 不应该在同步请求上调用，但不同的浏览器表现不同）

你可以做的是：

```
function ajaxFunction(callback){
    //creating AJAX 
     ...
    // Create a function that will receive data sent from the server
    ajaxRequest.onreadystatechange = function (){
        if(ajaxRequest.readyState == 4){
            //success code
            callback('MyContent')
        }
    }
    //Retrieving page
     ....
}

function popup() {
  ajaxFunction(function(MyVariable){alert(MyVariable););
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-27T17:14:43.770

一些评论是正确的......这与变量范围无关，并且与设置 MyVariable 值的内部函数（“onreadystatechange”函数）在警报发出时尚未执行的事实有关() 发生......所以警报将*始终*为空。

内部函数不会同步执行（即立即执行），而是延迟并稍后执行，当请求返回时，即在alert() 执行后很长时间。*唯一*的解决方案是将警报推迟到请求完成之后。

但不管这一切，内部函数*可以*在其范围之外设置变量，正如其他帖子所提到的。但是您的问题更多是关于执行顺序，而不是关于变量范围。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T14:28:11.333

为什么不将`MyVariable`' 范围更改为函数之外？

```
var MyVariable;    
function ajaxFunction(){
    //creating AJAX 
     ...
    // Create a function that will receive data sent from the server
    ajaxRequest.onreadystatechange = function (){
        if(ajaxRequest.readyState == 4){
            //success code
            ======>Here i want to set variable <=====
            MyVariable='MyContent';
        }
    }
    //Retrieving page
     ....
}

function popup(){
    ajaxFunction();
    alert(MyVariable);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-14T14:38:32.077

不，因为`MyVariable`它的作用域是函数。为了使其对 可见`popup()`，它必须在事件处理函数和`popup()`可以看到它的范围内，就像[Jenp](https://stackoverflow.com/questions/290214/in-ajax-how-to-retrive-variable-from-inside-of-onreadystatechange-function#290217)建议的那样。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-14T14:46:34.853

将变量传递给 popup() 函数：

```
var MyVariable;    
function ajaxFunction(){
    //creating AJAX 
     ...
    // Create a function that will receive data sent from the server
    ajaxRequest.onreadystatechange = function (){
        if(ajaxRequest.readyState == 4){
            //success code
            ======>Here i want to set variable <=====
            MyVariable='MyContent';
            popup(MyVariable);
        }
    }
    //Retrieving page
     ....
}

function popup(x){
    ajaxFunction();
    alert(x);
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-14T15:43:16.457

这可能会使您的问题复杂化，因此请随意插话，但使用第三方 Javascript 库可能有助于稍微减轻您的负担（正如评论者所*提到*的）。Prototype 和 JQuery 都有处理作用域的方法，比如 Prototype 中的 bind 函数。此外，您不必编写自己的 Ajax 请求代码，尽管我赞扬您深入研究并了解它是如何工作的！原型类可以帮助解决您所描述的范围问题。您可能需要重构以使用异步 Ajax 请求，这样浏览器就不必像您编写它时那样等待。以下将弹出您的警报消息并适当地设置变量，尽管我尚未对其进行错误测试。它显示了基本概念。

```
var TestClass = Class.create();
TestClass.prototype = {

    MyVariable: null,
    AjaxURL: "http://yourajaxurl.com/something.asmx",
    DoAjaxCall: function() {
          new Ajax.Request(this.AjaxURL, 
              method: 'get', 
              onSuccess: this.AjaxCallback.bind(this),
              onFailure: this.DoSomethingSmart.bind(this));
    },

    AjaxCallback: function(returnVal) {
          this.MyVariable = returnVal.responseText;   //ResponseText or whatever you need from the request...
          this.Popup(this.MyVariable);
    },

    DoSomethingSmart: function() {
          //Something smart
    },

    Popup: function(message) {
          alert(message);
    }

};

var TestClassInstance = new TestClass();
TestClassInstance.DoAjaxCall(); 
```

# html - 和之间的区别

> ID：290215
> 
> 赞同：247
> 
> 时间：2008-11-14T14:27:55.890
> 
> 标签：html, input, types

HTML`<input type='button' />`和 和有什么不一样`<input type='submit' />`？

* * *

## 回答 #1

> 赞同：247
> 
> 时间：2008-11-14T14:29:18.087

`<input type="button" />`按钮不会提交表单 - 默认情况下它们不做任何事情。它们通常与 JavaScript 结合使用，作为 AJAX 应用程序的一部分。

`<input type="submit">`按钮将在用户单击它们时提交它们所在的表单，除非您使用 JavaScript 另有指定。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-11-14T14:30:11.283

“按钮”就是一个按钮，您可以使用 Javascript 向其添加附加功能。“提交”输入类型具有提交其所在表单的默认功能（当然，您仍然可以使用 Javascript 添加其他功能）。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2011-04-26T10:45:34.337

按钮不会自行提交表单。它是一个简单的按钮，用于使用 javascript 执行某些操作，而提交是一种按钮，默认情况下，只要用户单击提交按钮，就会提交表单。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2017-03-18T09:31:48.173

还应该提到的是 type="submit" 的命名输入也将与其他表单的命名字段一起提交，而命名输入 type="button" 不会。

换句话说，在下面的示例中，命名输入`name=button1` **不会**被提交，而命名输入`name=submit1` **将**被提交。

示例 HTML 表单 (index.html)：

```
<form action="checkout.php" method="POST">

  <!-- this won't get submitted despite being named -->
  <input type="button" name="button1" value="a button">

  <!-- this one does; so the input's TYPE is important! -->
  <input type="submit" name="submit1" value="a submit button">

</form> 
```

处理上述表单操作的 PHP 脚本 (checkout.php)：

```
<?php var_dump($_POST); ?> 
```

通过在名为 /tmp/test/ 的文件夹中创建两个文件，然后从 shell 运行内置的 PHP Web 服务器，在本地计算机上测试上述内容：

```
php -S localhost:3000 -t /tmp/test/ 
```

[在http://localhost:3000](http://localhost:3000)打开浏览器并亲自查看。

有人会想为什么我们需要提交一个命名按钮？这取决于后端脚本。例如，除非`Place Order`也提交了命名按钮，否则 WooCommerce WordPress 插件不会处理发布的结帐页面。如果您将其类型从**提交**更改为**按钮**，则此按钮将不会被提交，因此结帐表单将永远不会得到处理。

这可能是一个小细节，但你知道，魔鬼在细节中。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2015-05-14T23:03:39.807

IE 8 实际上使用它遇到的第一个按钮提交或按钮。而不是通过将其设置为输入 type=submit 来轻松指示所需的内容，页面上的订单实际上很重要。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2017-08-16T13:35:47.480

`type='Submit'`设置为转发并获取 BACK-END（PHP、.NET 等）上的值。 `type='button'`将反映正常的按钮行为。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-07-31T18:36:28.877

`<input type="button">`可以在任何地方使用，而不仅仅是在表单中，如果它们在一个表单中，它们不会提交表单。更适合`Javascript`.

`<input type="submit">`只能在表单中使用，它们将向指定的 URL 发送请求（GET 或 POST）。它们不应**放在**任何 HTML 位置。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-11-13T19:20:11.767

W3C 明确，关于 Button 元素的规范

Button 可以被视为所有类型 Button 的通用类，没有默认行为。

[W3C](https://www.w3.org/TR/html401/interact/forms.html#edef-BUTTON)

# mysql - MySQL 中的 BIT 和 TINYINT 有什么区别？

> ID：290223
> 
> 赞同：114
> 
> 时间：2008-11-14T14:29:46.183
> 
> 标签：mysql, bit, tinyint

在什么情况下你会使用哪个？有很大的不同吗？持久性引擎通常使用哪个来存储布尔值？

* * *

## 回答 #1

> 赞同：133
> 
> 时间：2008-11-14T14:39:01.250

TINYINT 是一个 8 位整数值，一个 BIT 字段可以存储 1 位 BIT(1) 和 64 位 BIT(64)。对于布尔值，BIT(1) 很常见。

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2008-11-14T14:40:31.560

来自[数字类型概述](https://dev.mysql.com/doc/refman/5.0/en/numeric-type-overview.html)；

**位[(M)]**

> 位域类型。M 表示每个值的位数，从 1 到 64。如果省略 M，则默认为 1。
> 
> 这种数据类型在 MySQL 5.0.3 中为 MyISAM 添加，并在 5.0.5 中扩展到 MEMORY、InnoDB、BDB 和 NDBCLUSTER。在 5.0.3 之前，BIT 是 TINYINT(1) 的同义词。

**TINYINT[(M)] [未签名] [ZEROFILL]**

> 一个非常小的整数。有符号范围是 -128 到 127。无符号范围是 0 到 255。

Additionally consider this;

**BOOL, BOOLEAN**

> These types are synonyms for TINYINT(1). A value of zero is considered false. Non-zero values are considered true.

* * *

## 回答 #3

> 赞同：43
> 
> 时间：2011-02-08T12:34:06.793

All these theoretical discussions are great, but in reality, at least if you're using MySQL and really for SQLServer as well, it's best to stick with non-binary data for your booleans for the simple reason that it's easier to work with when you're outputting the data, querying and so on. It is especially important if you're trying to achieve interoperability between MySQL and SQLServer (i.e. you sync data between the two), because the handling of BIT datatype is different in the two of them. SO in practice you will have a lot less hassles if you stick with a numeric datatype. I would recommend for MySQL to stick with BOOL or BOOLEAN which gets stored as TINYINT(1). Even the way MySQL Workbench and MySQL Administrator display the BIT datatype isn't nice (it's a little symbol for binary data). So be practical and save yourself the hassles (and unfortunately I'm speaking from experience).

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-11-14T14:39:25.603

BIT 应该只允许 0 和 1（如果字段未定义为 NOT NULL，则为 NULL）。TINYINT(1) 允许任何可以存储在单个字节中的值，-128..127 或 0..255，具体取决于它是否是无符号的（1 表示您打算只使用单个数字，但它确实不会阻止您存储更大的值）。

对于早于 5.0.3 的版本，BIT 被解释为 TINYINT(1)，因此**没有**区别。

BIT 具有“这是一个布尔值”语义，并且某些应用程序会以相同的方式考虑 TINYINT(1)（由于 MySQL 过去处理它的方式），因此如果应用程序检查类型，则可能会将列格式化为复选框并据此决定格式。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-11-14T14:36:13.970

可能是错的，但是：

Tinyint 是 0 到 255 之间的整数

位是 1 或 0

因此对我来说 bit 是布尔值的选择

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-05-05T09:54:14.680

From my experience I'm telling you that BIT has problems on linux OS types(Ubuntu for ex). I developped my db on windows and after I deployed everything on linux, I had problems with queries that inserted or selected from tables that had BIT DATA TYPE.

Bit is not safe for now. I changed to tinyint(1) and worked perfectly. I mean that you only need a value to diferentiate if it's 1 or 0 and tinyint(1) it's ok for that

# sql - 运算符不存在：区间 > 整数

> ID：290226
> 
> 赞同：6
> 
> 时间：2008-11-14T14:30:11.753
> 
> 标签：sql, postgresql

我有一个适用于 Postgresql 7.4 但不适用于具有相同数据库的 Postgresql 8.3 的查询。

询问：

```
SELECT * FROM login_session WHERE (now()-modified) > timeout; 
```

得到以下错误：

```
ERROR:  operator does not exist: interval > integer
LINE 1: ...ELECT * FROM login_session WHERE (now()-modified) > timeout ...
                                                             ^
HINT:  No operator matches the given name and argument type(s). You might need to add explicit type casts. 
```

列`modified`是 a`timestamp`并且`timeout`是`integer`。

我需要在服务器上更改一些设置吗？

我正在为新服务器（ubuntu）上的客户端安装应用程序，因此我无法更改应用程序中的查询。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-14T15:27:17.753

7.4 和 8.3 之间有很多变化。其中一些最激烈的是删除了一些自动铸件。

我想“超时”以秒为单位？如果是这样，您可以将查询更改为：

```
SELECT
    *
FROM
    login_session
WHERE
    (CURRENT_TIMESTAMP - modified) > (timeout * '1 sec'::interval); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-14T15:39:22.267

```
create or replace function int2interval (x integer) returns interval as $$ select $1*'1 sec'::interval $$ language sql;
create cast (integer as interval) with function int2interval (integer) as implicit; 
```

应该这样做。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-14T15:47:18.833

```
CREATE OR REPLACE FUNCTION intToInterval(arg integer)
  RETURNS interval AS
$BODY$
   BEGIN      
      return CAST( arg || ' seconds' AS interval ); 
   END;
$BODY$
  LANGUAGE 'plpgsql';

CREATE CAST (integer AS interval)
WITH FUNCTION intToInterval ( integer )
AS IMPLICIT; 
```

（假设超时以秒为单位测量 - 否则相应更改）

# c# - C# 中的 Java System.currentTimeMillis() 等效项

> ID：290227
> 
> 赞同：90
> 
> 时间：2008-11-14T14:30:43.107
> 
> 标签：c#, java, .net, datetime

`System.currentTimeMillis()`C#中Java的等价物是什么？

* * *

## 回答 #1

> 赞同：96
> 
> 时间：2008-11-14T14:40:49.407

替代：

```
private static readonly DateTime Jan1st1970 = new DateTime
    (1970, 1, 1, 0, 0, 0, DateTimeKind.Utc);

public static long CurrentTimeMillis()
{
    return (long) (DateTime.UtcNow - Jan1st1970).TotalMilliseconds;
} 
```

* * *

## 回答 #2

> 赞同：78
> 
> 时间：2011-04-18T12:56:03.447

Java 中的一个常见习惯用法是将`currentTimeMillis()`用于计时或调度目的，您对自 1970 年以来的实际毫秒数不感兴趣，而是计算一些相对值并将以后的调用`currentTimeMillis()`与该值进行比较。

如果这就是您要查找的内容，则 C# 等效项是**`Environment.TickCount`**.

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2011-05-31T22:49:21.043

如果您对 TIMING 感兴趣，请添加对 System.Diagnostics 的引用并使用秒表。

例如：

```
var sw = Stopwatch.StartNew();
...
var elapsedStage1 = sw.ElapsedMilliseconds;
...
var elapsedStage2 = sw.ElapsedMilliseconds;
...
sw.Stop(); 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2018-05-30T11:07:47.497

```
DateTimeOffset.UtcNow.ToUnixTimeMilliseconds() 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-11-14T14:44:32.330

在`System.currentTimeMillis()`java 中返回从 1970 年 1 月 1 日开始的当前时间（以毫秒为单位）

c# 那将是

```
public static double GetCurrentMilli()
    {
        DateTime Jan1970 = new DateTime(1970, 1, 1, 0, 0,0,DateTimeKind.Utc);
        TimeSpan javaSpan = DateTime.UtcNow - Jan1970;
        return javaSpan.TotalMilliseconds;
    } 
```

编辑：按照建议设置为 UTC :)

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-11-14T15:08:41.410

我们也可以花点心思，把它作为一个扩展方法来做，这样它就挂在 DateTime 类上：

```
public static class DateTimeExtensions
{
    private static DateTime Jan1st1970 = new DateTime(1970, 1, 1, 0, 0, 0, DateTimeKind.Utc);
    public static long currentTimeMillis(this DateTime d)
    {
        return (long) ((DateTime.UtcNow - Jan1st1970).TotalMilliseconds);
    }
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-14T14:38:38.613

该框架不包括自 1970 年以来的旧秒数（或毫秒）。您得到的最接近的是 DateTime.Ticks，它是自 0001 年 1 月 1 日以来的 100 纳秒数。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-11-14T14:52:25.217

这是一种近似 Unix 时间戳的简单方法。使用 UTC 更接近 unix 概念，您需要从`double`转换为`long`.

```
TimeSpan ts = (DateTime.UtcNow - new DateTime(1970, 1, 1, 0, 0, 0, DateTimeKind.Utc));
long millis = (long)ts.TotalMilliseconds;
Console.WriteLine("millis={0}", millis); 
```

印刷：

```
millis=1226674125796 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2014-11-25T11:02:22.453

我只是考虑如何实现您一直在努力的最直接的方法，如下所示：

```
DateTime.Now.Ticks / TimeSpan.TicksPerMillisecond 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2017-05-23T13:59:46.470

如果您希望在 GNU/Linux 和 Windows（至少七种）下的不同进程、不同语言（Java、C、C#）之间比较时间戳：

C＃：

```
private static long nanoTime() {
   long nano = 10000L * Stopwatch.GetTimestamp();
   nano /= TimeSpan.TicksPerMillisecond;
   nano *= 100L;
   return nano;
} 
```

爪哇：

```
java.lang.System.nanoTime(); 
```

C GNU/Linux：

```
static int64_t hpms_nano() {
   struct timespec t;
   clock_gettime( CLOCK_MONOTONIC, &t );
   int64_t nano = t.tv_sec;
   nano *= 1000;
   nano *= 1000;
   nano *= 1000;
   nano += t.tv_nsec;
   return nano;
} 
```

C 窗口：

```
static int64_t hpms_nano() {
   static LARGE_INTEGER ticksPerSecond;
   if( ticksPerSecond.QuadPart == 0 ) {
      QueryPerformanceFrequency( &ticksPerSecond );
   }
   LARGE_INTEGER ticks;
   QueryPerformanceCounter( &ticks );
   uint64_t nano = ( 1000*1000*10UL * ticks.QuadPart ) / ticksPerSecond.QuadPart;
   nano *= 100UL;
   return nano;
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-02-26T16:01:10.407

我知道问题要求**等效**，但由于我将这 2 个用于我在[GetTickCount](http://msdn.microsoft.com/en-us/library/windows/desktop/ms724408%28v=vs.85%29.aspx)中抛出的相同任务。我可能很怀旧，但 System.currentTimeMillis() 和 GetTickCount() 是我用来获取刻度的唯一方法。

```
[DllImport("kernel32.dll")]
static extern uint GetTickCount();

// call
uint ticks = GetTickCount(); 
```

# web-services - 是否可以使用 SoapUI 测试有状态的 Web 服务？

> ID：290231
> 
> 赞同：1
> 
> 时间：2008-11-14T14:31:46.240
> 
> 标签：web-services, soapui, stateful

您使用什么作为有状态 Web 服务的测试客户端？是否可以使用 SoapUI？在这方面有最佳实践吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-14T14:53:34.653

您可以在 SoapUI 中执行所谓的“属性转移”。例如，我们所有的 Web 服务都必须首先调用一个身份验证 Web 服务并获取一个身份验证令牌。

我在 SoapUI 中进行了设置，以便将来自身份验证服务的返回身份验证令牌传递给后续请求。它似乎工作得很好，但除非我错过了一个技巧，否则我不想为很多网络服务设置它（即你必须为每个要向/从传输数据的呼叫输入一个条目） .

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-17T11:59:27.623

是的，构建 SoapUI 测试是一项缓慢而重复的工作。我们直到重写 SOAP 服务器才发现它，它可以进行出色的单元和系统测试，但创建它们的速度很慢。

哦，注意内存泄漏。保存非常频繁。当你用完内存时，你不能再保存了。这有点糟糕。

属性转移的东西很棒——你可以有不同的范围（测试、请求、全局），你可以使用 GroovyScript 来做动态的东西（比如查找与今天日期相关的特定日期，等等）。

使用格式正确的 WSDL 文件，它会为您生成模板请求，但是您仍然需要对它们进行适当的调整 - 或者至少，我做到了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T14:47:52.683

我不知道用 SoapUI 做这件事是否实用，但我用 iTKO LISA 和 Parasoft SOATest 都做过类似的事情。它不是用于测试有状态的 Web 服务，而是简单地执行多个测试步骤，存储用于后续步骤的结果。LISA 和 SOATest 都能够在 GUI 中定义步骤，这些步骤可以存储在以后的请求中使用的响应片段。

# security - DBO权利风险

> ID：290236
> 
> 赞同：2
> 
> 时间：2008-11-14T14:33:37.470
> 
> 标签：security, dbo

我建议管理一个 SQL 2k5 机器的朋友，该机器有几个用户可以通过 dbo 访问多个数据库。问题是：

1.  这些用户已经有几个月没有更改密码了，
2.  这些用户将他们的 ID 放入应用程序中，应用程序作为 DBO 运行。

所以 - 除了添加/更新/删除表和 procs 的明显 dbo 权限之外，对于将 dbo 访问 SQL 2005 数据库的恶意用户，我可以举出什么危险？

我想提供对数据库和其他用户造成伤害的特定场景。dbo 可以更改服务器上的文件分配吗？DBO 会影响未直接连接到该数据库的其他资源吗？

* * *

澄清一下，这是 SQL Server 2005，默认情况下 xp_cmdShell 没有为 DBO 用户授权。我仍然想知道是否存在明显的 CRUD 之外的风险。有人可以用 DBO 做什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2013-04-06T19:34:38.210

我意识到这是一个 5 年前的帖子，但它从未得到正确回答，并且发布了一些非常糟糕的信息。

首先，让我们看看 Books Online 对“DBO”角色 (priv) 的看法。重点是我的。

> **db_owner 固定数据库角色的成员可以对数据库**执行所有配置和维护活动。

总而言之，这意味着拥有“DBO”权限的人可以对拥有该权限的任何数据库执行任何他们想做的事情。截至 2005 年，这也意味着他们可以删除数据库。

另请注意，它并没有说能够控制服务器是一件多么血腥的事情。据我所知，您需要“SA”或（最近）“控制服务器”权限来执行 xp_CmdShell。DBO 没有附带 priv，因此它不能运行 xp_CmdShell 或许多其他以“xp_”甚至“sp_”开头的东西。

换档，看起来 OP 已经有点意识到，DBO privs 被认为是“提升的 privs”。我建议您**永远不要**将 DBO priv 授予应用程序（或其他前端），我只会将其授予应该是负责数据库管理员的人。这些人需要像您选择成为 DBA 的人一样明智地选择。

要回答有关 CRUD 的其他问题……在大多数情况下，CRUD 由 ORM 执行，所需的最高权限是 db_DataReader 和 db_DataWriter。老实说，我什至不允许登录拥有这些权限。我知道世界上每个前端开发人员都会对我大喊大叫，但事实是，即使 CRUD 也应该通过存储过程来完成，以防止攻击者使用允许某人从表中删除的 db_DataWriter 进入。就我而言，应用程序（和其他前端）应该只有未修改的 PUBLIC privs 和执行某些存储过程的 privs ......期间。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2020-07-30T01:20:37.190

我同意 Jeff 的观点，即从最低权限的角度来处理它。并且只是为了证明 db_owner 比人们想象的要危险得多 - 请注意，它还允许攻击者：

*   将他们的权限提升到 sysadmin 从而接管整个服务器，包括其上的所有其他数据库 [请参阅下面的参考资料了解这可能发生的 2 种不同方式]
*   通过用尽所有可用存储来执行拒绝服务
*   通过用尽所有 RAM 来执行拒绝服务
*   删除整个数据库

参考：

[https://www.anujvarma.com/db_owner-security-risks/](https://www.anujvarma.com/db_owner-security-risks/)

[https://www.itprotoday.com/sql-server/5-reasons-against-allowing-dbowner-role-permissions](https://www.itprotoday.com/sql-server/5-reasons-against-allowing-dbowner-role-permissions)

[https://akawn.com/blog/2012/02/why-you-should-be-cautious-with-the-dbo_owner-role/](https://akawn.com/blog/2012/02/why-you-should-be-cautious-with-the-dbo_owner-role/)

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-14T14:45:43.297

是的。dbo 有权对数据库做任何事情。甚至运行 xp_cmdshell。一旦你可以运行 xp_cmdshell，你就可以在系统上做几乎任何事情。这一切都是可能的，前提是 dbo 具有默认情况下具有的系统管理员权限。

# c# - 有没有办法在运行时将类文件加载到程序集中？

> ID：290238
> 
> 赞同：8
> 
> 时间：2008-11-14T14:34:39.027
> 
> 标签：c#, reflection

我正在尝试做一些事情，在运行时从用户那里获取一个 cs 文件，使其对程序集有意义，获取它的属性、方法等。

有没有办法通过 C# 中的反射来做到这一点？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-14T14:41:36.457

要即时编译文件，您需要执行以下操作（其中 sourceCode 是包含要编译的代码的字符串）：

```
CodeDomProvider codeProvider = new CSharpCodeProvider();
ICodeCompiler compiler = codeProvider.CreateCompiler();

// add compiler parameters
CompilerParameters compilerParams = new CompilerParameters();
compilerParams.CompilerOptions = "/target:library /optimize";
compilerParams.GenerateExecutable = false;
compilerParams.GenerateInMemory = true;         
compilerParams.IncludeDebugInformation = false;
compilerParams.ReferencedAssemblies.Add("mscorlib.dll");
compilerParams.ReferencedAssemblies.Add("System.dll");

// compile the code
CompilerResults results = compiler.CompileAssemblyFromSource(compilerParams, sourceCode); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-14T14:38:53.340

[您可以使用CSharpCodeProvider](http://msdn.microsoft.com/en-us/library/microsoft.csharp.csharpcodeprovider.aspx)相当容易地编译它。[您可以从C# in Depth 网站](http://csharpindepth.com/Downloads.aspx)下载我的代码片段编译器 Snippy 的源代码。它使用 CSharpCodeProvider，因此您可以将其用作示例代码。

# entity-framework - 实体框架：一个大模型还是一组小模型？

> ID：290242
> 
> 赞同：1
> 
> 时间：2008-11-14T14:36:13.893
> 
> 标签：entity-framework, .net-3.5, ado.net, linq-to-entities

最近，我们一直在讨论在工作中使用实体框架的方法。我们有一个相当大且复杂的基于网络的 n 层应用程序，该应用程序需要进行大修。

问题是：如果我们从哪里开始使用实体框架，是创建一个大模型还是一组较小的基于功能/活动的模型更好。

我对此有自己的看法，但很想听听其他人的想法。

更新（2008 年 11 月 17 日）：我一直在为家里的小项目创建一个模型，将其清除并重新创建等。虽然我没有尝试过，但我怀疑这种方法在涉及大量实体类型时会更具挑战性。

另外，有没有人在使用 TFS 或类似工具的大型团队中使用 ef 的经验？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T14:44:12.707

根据我的经验，我只会制作一个大型数据库模型。否则，可能很难跟踪哪些表在哪里发生了变化。当我对数据库进行更改时，我只需删除模型中的所有表并重新生成它。

当然，我也没有通过向它添加“实体”功能来定制我的模型（不确定它是如何工作的）。

所以我不是这方面的专家，但我通常最终使用 LINQ-To-SQL 模型/对象而不是实体框架 - 到目前为止它对我来说效果更好。

# sql-server-2000 - 使用 DTS 包或链接服务器跨 SQL Server 移动数据

> ID：290247
> 
> 赞同：-1
> 
> 时间：2008-11-14T14:38:24.077
> 
> 标签：sql-server-2000, dts

我们正在使用 SQL Server 2000，并且必须跨服务器移动数据以将其存储在中央数据库中。我们宁愿不使用 DTS 包，因为我们将很快迁移到 SQL Server 2005，并且我们不想升级到 SSIS 或必须支持旧的 DTS 包。

有没有办法使用 OSQL 脚本、vbscript 或其他命令行工具来执行此操作？

DTS 包会起作用，但我有点犹豫。他们很快变得丑陋。这项工作将必须组合来自 3 台不同服务器上 18 个数据库的总共 200 个表的数据。我不想将数百个数据转换任务拖放到 DTS 包 GUI 中。我宁愿在一个批处理文件或一组脚本中清楚地列出所有内容。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-14T14:40:28.643

您可以使用[BCP](http://msdn.microsoft.com/en-us/library/aa174646.aspx)导出然后导入数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-14T14:51:05.330

使用 Red Gate Sql Compare 和 Data Compare？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T15:49:48.050

根据 DTS 包的复杂性，SSIS 升级向导还不错。

# javascript - 如何对与 jQuery 绑定的事件进行排序

> ID：290254
> 
> 赞同：166
> 
> 时间：2008-11-14T14:39:19.830
> 
> 标签：javascript, jquery, events

假设我有一个 Web 应用程序，它的页面可能包含 4 个脚本块 - 我编写的脚本可能会在其中一个块中找到，但我不知道哪个是由控制器处理的。

我将一些`onclick`事件绑定到一个按钮，但我发现它们有时会以我没想到的顺序执行。

有没有办法确保秩序，或者你过去是如何处理这个问题的？

* * *

## 回答 #1

> 赞同：136
> 
> 时间：2008-11-14T14:49:41.353

如果顺序很重要，您可以创建自己的事件并绑定回调以在其他回调触发这些事件时触发。

```
$('#mydiv').click(function(e) {
    // maniplate #mydiv ...
    $('#mydiv').trigger('mydiv-manipulated');
});

$('#mydiv').bind('mydiv-manipulated', function(e) {
    // do more stuff now that #mydiv has been manipulated
    return;
}); 
```

至少是这样的。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2011-04-02T15:16:28.280

如果您的所有回调始终存在并且您对它们相互依赖感到满意，Dowski 的方法就很好。

但是，如果您希望回调彼此独立，则可以利用冒泡并将后续事件作为委托附加到父元素。父元素上的处理程序将在元素上的处理程序之后触发，一直持续到文档。这非常好，因为您可以使用`event.stopPropagation()`,`event.preventDefault()`等来跳过处理程序并取消或取消取消操作。

```
$( '#mybutton' ).click( function(e) { 
    // Do stuff first
} );

$( '#mybutton' ).click( function(e) { 
    // Do other stuff first
} );

$( document ).delegate( '#mybutton', 'click', function(e) {
    // Do stuff last
} ); 
```

或者，如果您不喜欢这样，您可以使用 Nick Leaches bindLast 插件来强制最后绑定事件：[https](https://github.com/nickyleach/jQuery.bindLast) ://github.com/nickyleach/jQuery.bindLast 。

或者，如果您使用的是 jQuery 1.5，您还可以使用新的 Deferred 对象做一些聪明的事情。

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2011-05-27T12:59:42.633

我已经尝试了很长时间来概括这种过程，但就我而言，我只关心链中第一个事件侦听器的顺序。

如果它有任何用处，这里是我的 jQuery 插件，它绑定了一个事件侦听器，它总是在任何其他事件之前触发：

***更新内联与 jQuery 更改（感谢 Toskan）* **

```
(function($) {
    $.fn.bindFirst = function(/*String*/ eventType, /*[Object])*/ eventData, /*Function*/ handler) {
        var indexOfDot = eventType.indexOf(".");
        var eventNameSpace = indexOfDot > 0 ? eventType.substring(indexOfDot) : "";

        eventType = indexOfDot > 0 ? eventType.substring(0, indexOfDot) : eventType;
        handler = handler == undefined ? eventData : handler;
        eventData = typeof eventData == "function" ? {} : eventData;

        return this.each(function() {
            var $this = $(this);
            var currentAttrListener = this["on" + eventType];

            if (currentAttrListener) {
                $this.bind(eventType, function(e) {
                    return currentAttrListener(e.originalEvent); 
                });

                this["on" + eventType] = null;
            }

            $this.bind(eventType + eventNameSpace, eventData, handler);

            var allEvents = $this.data("events") || $._data($this[0], "events");
            var typeEvents = allEvents[eventType];
            var newEvent = typeEvents.pop();
            typeEvents.unshift(newEvent);
        });
    };
})(jQuery); 
```

**注意事项：**

*   这还没有经过充分测试。
*   它依赖于不改变的 jQuery 框架的内部结构（仅在 1.5.2 中测试过）。
*   除了作为源元素的属性或使用 jQuery bind() 和其他相关函数之外，它不一定会在以任何方式绑定的事件侦听器之前触发。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-11-14T15:08:14.843

调用绑定回调的顺序由每个 jQuery 对象的事件数据管理。没有任何函数（据我所知）允许您直接查看和操作该数据，您只能使用 bind() 和 unbind() （或任何等效的辅助函数）。

Dowski 的方法是最好的，您应该修改各种绑定回调以绑定到自定义事件的有序序列，“第一个”回调绑定到“真实”事件。这样，无论它们以什么顺序绑定，序列都将以正确的方式执行。

我能看到的唯一选择是您真的非常不想考虑的事情：如果您知道函数的绑定语法可能在您之前已经绑定，请尝试取消绑定所有这些函数，然后重新绑定它们自己按正确的顺序。那只是自找麻烦，因为现在您有重复的代码。

如果 jQuery 允许您简单地更改对象事件数据中绑定事件的顺序，而无需编写一些代码来挂钩到 jQuery 核心，那将是很酷的，这似乎是不可能的。允许这样做可能会产生我没有想到的含义，所以这可能是故意的遗漏。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2013-10-07T15:08:25.333

请注意，在 jQuery 世界中，这必须从 1.8 版开始以不同的方式实现。以下发行说明来自[jQuery 博客：](http://blog.jquery.com/2011/11/08/building-a-slimmer-jquery/)

> .data(“events”)：jQuery 将其与事件相关的数据存储在一个名为（等待它）每个元素上的事件的数据对象中。这是一个内部数据结构，因此在 1.8 中这将从用户数据名称空间中删除，因此它不会与同名项目冲突。jQuery 的事件数据仍然可以通过 jQuery._data(element, "events") 访问

*我们确实可以完全控制处理程序在 jQuery 宇宙中的*执行顺序。Ricoo 在上面指出了这一点。看起来他的回答并没有为他赢得很多爱，但这种技术非常得心应手。例如，任何时候您需要在库小部件中的某个处理程序之前执行您自己的处理程序，或者您需要有条件地取消对小部件处理程序的调用：

```
$("button").click(function(e){
    if(bSomeConditional)
       e.stopImmediatePropagation();//Don't execute the widget's handler
}).each(function () {
    var aClickListeners = $._data(this, "events").click;
    aClickListeners.reverse();
}); 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2011-01-15T14:29:43.913

```
function bindFirst(owner, event, handler) {
    owner.unbind(event, handler);
    owner.bind(event, handler);

    var events = owner.data('events')[event];
    events.unshift(events.pop());

    owner.data('events')[event] = events;
} 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2011-12-12T01:06:08.543

只需正常绑定处理程序，然后运行：

```
element.data('events').action.reverse(); 
```

例如：

```
$('#mydiv').data('events').click.reverse(); 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-01-12T17:19:06.450

你可以尝试这样的事情：

```
/**
  * Guarantee that a event handler allways be the last to execute
  * @param owner The jquery object with any others events handlers $(selector)
  * @param event The event descriptor like 'click'
  * @param handler The event handler to be executed allways at the end.
**/
function bindAtTheEnd(owner,event,handler){
    var aux=function(){owner.unbind(event,handler);owner.bind(event,handler);};
    bindAtTheStart(owner,event,aux,true);

}
/**
  * Bind a event handler at the start of all others events handlers.
  * @param owner Jquery object with any others events handlers $(selector);
  * @param event The event descriptor for example 'click';
  * @param handler The event handler to bind at the start.
  * @param one If the function only be executed once.
**/
function bindAtTheStart(owner,event,handler,one){
    var eventos,index;
    var handlers=new Array();
    owner.unbind(event,handler);
    eventos=owner.data("events")[event];
    for(index=0;index<eventos.length;index+=1){
        handlers[index]=eventos[index];
    }
    owner.unbind(event);
    if(one){
        owner.one(event,handler);
    }
    else{
        owner.bind(event,handler);
    }
    for(index=0;index<handlers.length;index+=1){
        owner.bind(event,ownerhandlers[index]);
    }   
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-06-15T17:22:31.333

我有同样的问题并找到了这个主题。以上答案可以解决这些问题，但我认为它们不是好计划。

让我们想想现实世界。

如果我们使用这些答案，我们必须更改我们的代码。你必须改变你的代码风格。像这样的东西：

原来的：

```
$('form').submit(handle); 
```

黑客：

```
bindAtTheStart($('form'),'submit',handle); 
```

随着时间的推移，想想你的项目。代码丑陋且难以阅读！另一个原因很简单总是更好。如果你有 10 个 bindAtTheStart，它可能没有错误。如果你有 100 个 bindAtTheStart，你真的确定你可以让它们保持正确的顺序吗？

所以如果你必须绑定多个相同的事件。我认为最好的方法是控制 js-file 或 js-code 加载顺序。jquery 可以将事件数据作为队列处理。顺序是先进先出。您不需要更改任何代码。只需更改加载顺序。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-08-11T11:28:37.483

这是我对此的看法，涵盖了不同版本的 jQuery：

```
// Binds a jQuery event to elements at the start of the event chain for that type.
jQuery.extend({
    _bindEventHandlerAtStart: function ($elements, eventType, handler) {
        var _data;

        $elements.bind(eventType, handler);
        // This bound the event, naturally, at the end of the event chain. We
        // need it at the start.

        if (typeof jQuery._data === 'function') {
            // Since jQuery 1.8.1, it seems, that the events object isn't
            // available through the public API `.data` method.
            // Using `$._data, where it exists, seems to work.
            _data = true;
        }

        $elements.each(function (index, element) {
            var events;

            if (_data) {
                events = jQuery._data(element, 'events')[eventType];
            } else {
                events = jQuery(element).data('events')[eventType];
            }

            events.unshift(events.pop());

            if (_data) {
                jQuery._data(element, 'events')[eventType] = events;
            } else {
                jQuery(element).data('events')[eventType] = events;
            }
        });
    }
}); 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-02-18T03:37:51.190

在某些特殊情况下，当您无法更改点击事件的绑定方式（事件绑定是从别人的代码中进行的），并且您可以更改 HTML 元素时，这里有一个可能的解决方案（**警告**：这**不是**推荐的绑定方式事件，其他开发人员可能会因此而谋杀你）：

```
<span onclick="yourEventHandler(event)">Button</span> 
```

使用这种绑定方式，您的事件处理程序将首先添加，因此它将首先执行。

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2014-12-11T21:54:10.070

JQuery 1.5 引入了 Promise，这是我见过的用于控制执行顺序的最简单的实现。完整文档位于[http://api.jquery.com/jquery.when/](http://api.jquery.com/jquery.when/)

```
$.when( $('#myDiv').css('background-color', 'red') )
 .then( alert('hi!') )
 .then( myClickFunction( $('#myID') ) )
 .then( myThingToRunAfterClick() ); 
```

# dotnetnuke - 在 DotNetNuke 中，如何获取管理员电子邮件地址？

> ID：290285
> 
> 赞同：3
> 
> 时间：2008-11-14T14:48:11.293
> 
> 标签：dotnetnuke

我有一个模块可以将电子邮件发送到指定的电子邮件地址，但我想将电子邮件收件人默认为门户管理员。我怎样才能检索到这些信息？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-14T16:07:19.420

如果您在继承自的控件的上下文中`PortalModuleBase`，`PortalSettings`则可以作为属性使用，所以它看起来像

```
PortalSettings.Email 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-14T15:26:25.290

```
' get the current portal
Dim portSettings As PortalSettings = PortalController.GetCurrentPortalSettings

' get email address
Dim email as string = portSettings.Email 
```

# .net - 如何分别抓取 Word 文档中的每一页文本（使用 .NET）？

> ID：290287
> 
> 赞同：1
> 
> 时间：2008-11-14T14:48:58.703
> 
> 标签：.net, ms-word, full-text-search, extract

我需要确定关键字出现在 Word 文档的哪些页面上。我有一些工具可以让我获取文档的文本，但没有任何工具可以告诉我文本出现在哪些页面上。有人对我有一个好的起点吗？我正在使用.NET

谢谢！

编辑：附加约束：我不能使用任何互操作的东西。

编辑2：如果有人知道可以做到这一点的稳定库，那也会有所帮助。我使用 Aspose，但据我所知，它什么都没有。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-14T15:10:34.417

这就是我获取文本的方式，我相信您可以将选择范围设置为一个页面，然后您可以测试该文本，可能与您需要的内容有点倒退，但可能是一个开始的地方。

```
Microsoft.Office.Interop.Word.Application wordApplication = new Microsoft.Office.Interop.Word.Application();
object missing = Type.Missing;
object fileName = @"c:\file.doc";
object objFalse = false;

wordApplication.DisplayAlerts = Microsoft.Office.Interop.Word.WdAlertLevel.wdAlertsNone;
Microsoft.Office.Interop.Word.Document doc = wordApplication.Documents.Open(ref fileName, ref missing, ref missing, ref missing, ref missing, ref missing, ref missing, ref missing, ref missing, ref missing, ref missing,ref objFalse, ref missing, ref missing, ref missing, ref missing);

//I belevie you can define a SelectionRange and insert here
doc.ActiveWindow.Selection.WholeStory();
doc.ActiveWindow.Selection.Copy();

IDataObject data = Clipboard.GetDataObject();
string text = data.GetData(DataFormats.Text).ToString();

doc.Close(ref missing, ref missing, ref missing);
doc = null;

wordApplication.Quit(ref missing, ref missing, ref missing);
wordApplication = null; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-14T16:03:23.497

你如何定义一个页面？

如果您只计算部分/硬页，它会很复杂，但可行。如果要计算软分页符，任务会变得非常非常困难并且有些毫无意义。考虑到软分页符所在位置的确定是在运行时动态生成的，而不是存储在文件本身中。它取决于大量因素，包括活动的打印机驱动程序（是的，它可以针对不同计算机上的同一文件进行更改）、字体、字距调整、行距、边距等等等。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T17:55:36.923

使用 Aspose 执行此操作的一种糟糕方法是将 Word 文件转换为 PDF，然后在每一页上抓取文本。

我对 Aspose 内部结构或转换时如何定义软页面一无所知，但这是迄今为止我所拥有的最好的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-15T11:14:54.660

感谢您使用 Aspose.Words。

在公共 API 中，我们目前只有“流文档”信息，例如段落、表格、列表等。在内部，我们构建了一个页面布局模型，该模型具有页面、文本块、文本行等类。文档模型和布局模型之间当然存在内部链接，并且可以找出哪个页面在哪里结束以及所有内容。通过公共 API 提供这些信息（嗯，仍然）在我们的优先级列表中居高不下。

您是否在 Aspose.Words 支持论坛中记录了您的请求？我们使用此信息来维护投票系统，并将致力于首先获得更多选票的功能。

# graphics - 如何从 png24 中区分 png8

> ID：290296
> 
> 赞同：5
> 
> 时间：2008-11-14T14:50:37.467
> 
> 标签：graphics, png, photoshop, png-24, png-8

我正在一个使用大量 png24 文件的网站上工作，以提高透明度。

我需要用 png8 文件替换它们，因为 png24 的所有 png 修复样式 javascript 变通方法会导致 IE6 随机锁定。

请参阅此链接以了解 IE6 显示的症状 - [http://blogs.cozi.com/tech/2008/03/transparent-pngs-can-deadlock-ie6.html](http://blogs.cozi.com/tech/2008/03/transparent-pngs-can-deadlock-ie6.html)

有谁知道一种简单的方法来定位现有的 png24 文件，用 png8s 替换它们？

我使用的是 OS X，像 Adob​​e Bridge 这样的文件浏览器没有显示这一点，我也无法在命令行或 finder 上找到信息。

帮助！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-14T15:13:05.613

OSX 上的`file`实用程序可以告诉您 PNG 文件中的颜色深度，例如：

```
% file foo.png 
foo.png: PNG image data, 1514 x 1514, 8-bit grayscale, non-interlaced 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-24T18:09:47.657

您实际上可以在 PNG-8 中获得 alpha 透明度，但它非常复杂。 [http://www.sitepoint.com/blogs/2007/09/18/png8-the-clear-winner/](http://www.sitepoint.com/blogs/2007/09/18/png8-the-clear-winner/) [http://www.personal.psu.edu/drs18/blogs/davidstong/2007/09/png8_alpha_transparency_from_f。 html](http://www.personal.psu.edu/drs18/blogs/davidstong/2007/09/png8_alpha_transparency_from_f.html)

它基本上为 IE6 创建了类似 GIF 的内容，并为更好的浏览器创建了具有 alpha 透明度的真实 PNG。这是一条更令人愉快的退化路径。现在，我认为您需要 Fireworks，但我正在探索其他选择。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-12-17T18:54:50.903

要添加到 Alnitak 的答案，一旦找到要转换的所有 PNG24，您可以将它们全部批处理`pngquant`：

```
pngquant -v -f --ext .png 256 *.png 
```

这会将所有 PNG 文件就地转换为 PNG8，并覆盖它们。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-14T16:13:47.080

我想你可能问错了问题。PNG8 没有您在 IE6 中努力修复的真正 alpha。如果您将 PNG24 替换为 PNG8，那么您不会比将它们替换为 GIF 更好。

也许你可以测试一个替代的替换/修复脚本——那里有一些非常糟糕的脚本，也许这就是问题所在？

这是（我说这个舌头在脸颊！）[正确的问题](https://stackoverflow.com/questions/10243/how-to-get-png-transparency-working-in-browsers-that-dont-natively-support-it)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-14T20:48:34.937

JoeBloggs 是对的，你问错了问题。

我从来没有用一个好的 pngfix 脚本让 IE6 崩溃。你要么有一个糟糕的 pngfix 脚本，要么是一个糟糕的 IE6 安装。

PNG8 会破坏你漂亮的透明胶片，让它看起来像你在使用 GIF。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-07-16T07:19:10.213

pngcheck，一个命令行工具，可以转储你需要的信息。[http://www.libpng.org/pub/png/apps/pngcheck.html](http://www.libpng.org/pub/png/apps/pngcheck.html)

```
pngcheck.exe a.png
OK: a.png (1024x1024, 32-bit RGB+alpha, non-interlaced, 80.7%).

pngcheck.exe b.png
OK: b.png (1024x1024, 8-bit palette+trns, non-interlaced, 83.1%). 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-14T15:10:02.937

也许[imagemagick](http://www.imagemagick.org/)可以帮助您将 png24 文件转换为 png8 文件。

# asp.net - 从浏览器渲染 Excel

> ID：290297
> 
> 赞同：1
> 
> 时间：2008-11-14T14:50:41.740
> 
> 标签：asp.net, vb.net, excel

我有一些内容必须在浏览器中呈现为 excel 文件。我能够使用以下代码渲染网格内容以使其表现出色。

```
 Response.Clear();
  Response.AddHeader("content-disposition", "attachment;filename=FileName.xls");
  Response.Charset = "";
  Response.ContentType = "application/vnd.xls";
  System.IO.StringWriter stringWrite = new System.IO.StringWriter();
  System.Web.UI.HtmlTextWriter htmlWrite =
  new HtmlTextWriter(stringWrite);
  GridView1.RenderControl(htmlWrite);
  htmlWrite.Write(stringWrite);
  Response.Write(stringWrite.ToString());
  Response.End(); 
```

现在我必须为图像做类似的事情。也就是说，我想要一个可以将图像渲染为 excel 的代码。

我的意思是当用户打开 excel 时，他应该能够看到其中的图像。

是否可以将图像转换为base64sting格式并放入excel中？

如果您有类似的想法，请告诉我。

谢谢维诺德 T。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-14T15:16:01.393

我一直在使用相同的技巧将网格数据（html 标记）导入 excel。

如果您正在那里写入 HTML 数据，只需将 <IMG SRC="MYFILENAME.JPG> 添加到您想要图像的 HTML 文本中。

将会发生什么，Excel 将向您的服务器（asp.net 应用程序）询问该文件。

您可能需要添加图像的完整路径 <IMG SRC="http://myserver/subpath/MYFILENAME.JPG>

使用数据包嗅探器，我已经验证 Excel 确实会要求提供 IMG 文件，因此只需确保您已准备好下载图像即可。（作为 asp.net 流）或物理。

我的测试 HTML。
<html>
<table>
<tr><td>test</td><td>test</td<td>test</td></tr>
<tr><td>test</td><td>测试</td><td>测试</td></tr>
<tr><td>测试</td><td>测试</td><td><img src="http://myserver/ LALLAALLAA.jpg"></td></tr>
</table>
</html>

如果 ONLY Image，它与 over only 相同，根本没有表标签。只是 HTML 和 IMG 标签。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-14T17:42:45.887

哦。另一种更复杂的方法是创建一个 .MHT 文件（webarchive）文件。包含嵌入在同一文件中的 HTML 和图像。这样你就只有一个流了。但我不知道 Excel 是否会识别 MHT 内容并显示出来。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T07:02:48.487

Office 2007 文档（Word、PowerPoint 和 Excel）基于 OpenXML 格式。它们只是包含一堆 XML 和二进制部分（如图像）的 zip 文件。您可以使用框架中的任何 XML 类创建它们，然后将这些部分与打包 API（WindowsBase.dll 中的 System.IO.Packaging）放在一起。

查看 OpenXMLDeveloper.org 了解详细信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T08:30:41.873

看看[http://www.codeplex.com/OpenXMLViewer](http://www.codeplex.com/OpenXMLViewer)。也许这可以帮助你。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-15T08:58:02.287

我将此库用于 xls 输出： [CarlogAG Excel Writer](http://www.carlosag.net/Tools/ExcelXmlWriter/)

# database - 将服务器日志文件写入数据库是个好主意吗？

> ID：290304
> 
> 赞同：51
> 
> 时间：2008-11-14T14:53:16.930
> 
> 标签：database, logging, log-analysis, log-files

在阅读[了 O'Reilly 的一篇关于该主题的文章](http://www.onlamp.com/pub/a/apache/2005/02/10/database_logs.html)后，我想向 Stack Overflow 询问他们对此事的看法。

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2008-11-14T15:05:17.733

本地写入磁盘，然后定期批量插入数据库（例如在日志翻转时）。在单独的低优先级进程中执行此操作。更高效、更健壮...

（顺便说一句，确保您的数据库日志表包含“日志事件来自哪台机器”的列 - 非常方便！）

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-14T15:02:59.750

我会说不，因为相当大比例的服务器错误涉及与数据库通信的问题。如果数据库在另一台机器上，网络连接将是另一个无法记录的错误来源。

如果我要将服务器错误记录到数据库中，那么拥有一个在本地（写入事件日志或文件或其他东西）写入的备份记录器至关重要，以防数据库无法访问。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-05-08T08:57:36.477

如果可以的话，登录到数据库并且它不会减慢你的数据库:)

在数据库中查找任何内容比在日志文件中查找任何内容要快得多。特别是如果您提前考虑您将需要什么。登录 db 让我们像这样查询日志表：

```
select * from logs
where log_name = 'wcf' and log_level = 'error' 
```

然后在发现错误后，您可以看到导致此错误的整个路径

```
select * from logs
where contextId = 'what you get from previous select' order by timestamp 
```

如果您将其记录在文本文件中，您将如何获得此信息？

**编辑：** 正如 JonSkeet 建议的那样，如果我说应该考虑将日志记录到 db 异步，这个答案会更好。所以我声明它:) 我只是不需要它。例如如何做到这一点，您可以查看 Richard Kiessig 的“Ultra Fast ASP.NET”。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2017-04-19T12:07:47.480

如果数据库是生产数据库，这是一个可怕的想法。您*将*遇到备份、复制和恢复方面的问题。就像为数据库本身、副本（如果有）和备份提供更多存储空间。更多时间设置和恢复复制，更多时间验证备份，更多时间从备份中恢复数据库。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-14T15:05:49.013

如果您想要数据库中的日志，这可能不是一个坏主意，但如果您有很多日志文件条目，我会说不要遵循本文的建议。主要问题是我已经看到文件系统无法跟上来自繁忙站点的日志，更不用说数据库了。如果你真的想这样做，我会考虑在日志文件首次写入磁盘后将它们加载到数据库中。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-07-19T03:22:55.643

考虑一个使用 RAM 进行读写的正确设置数据库？这比写入磁盘要快得多，并且不会出现您在为大量客户端提供服务时看到的磁盘 IO 瓶颈手柄。

尽管我的最新应用程序正在使用数据库日志记录，但我没有任何基准来证明这些数据。如其中一个响应中所述，这将具有故障保护功能。如果无法创建数据库连接，请创建本地数据库（可能是 h2？）并写入。然后我们可以定期检查数据库连接，重新建立连接，转储本地数据库，并将其推送到远程数据库。

如果您没有 HA 站点，则可以在非工作时间完成此操作。

在未来的某个时候，我希望开发基准来证明我的观点。

祝你好运！

# database - NHibernate 多对一和唯一约束违规

> ID：290305
> 
> 赞同：4
> 
> 时间：2008-11-14T14:53:19.257
> 
> 标签：database, nhibernate, nhibernate-mapping

我在尝试在 NHibernate 中建模多对一关系时遇到问题，其中“一”侧的对象对列具有唯一约束。问题如下：

我有两张表，“Person”和“Country”。每个人都有一个且只有一个与之关联的国家。一个国家可以有很多人（真的！:)），一个国家的名字是唯一的。以下是Person端的映射：

```
<many-to-one Name="Country">
<column Name="CountryId"/>
</many-to-one> 
```

乡村方面：

```
<property name="Name" unique="true">
<column name="Name" length="50">
</property> 
```

现在在数据库中，我在 Country 表中的 Name 列上添加了一个唯一约束。如果我在 Person 实例上调用 Save()，NHibernate 只是尝试执行 INSERTS，而我希望它检查 Country Name 是否存在并在 Person 表的 CountryID 列中使用其 ID。相反，由于违反数据库中的唯一约束而引发异常。

在我看来，Nibernate 应该有足够的映射元数据来做正确的事情（或者属性上的唯一属性不能确保这一点？）。有谁知道如何做到这一点或有解决方法？

谢谢，

马汀

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-14T21:40:56.610

您需要将 Country 实例分配给 Person 实例的 Country 属性（不仅仅是设置 ID）。就像是：

```
Person p = new Person();
p.Country = session.Load<Country>(countryId);
session.Save(p); 
```

然后 NHibernate 就会知道该怎么做。这也不会导致检索国家/地区的数据库命中，因为 Load 方法将返回 Country 代理，并且您正在访问的唯一内容是 Country 实例的 ID。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-14T08:31:10.563

我有类似的要求并使用**SaveOrUpdateCopy**解决了它。

假设您有两个不同的 People 对象，每个对象都有对不同 Country 对象的引用。只要国家/地区*ID*相同，您就不会出现异常，并且只有 1 个国家/地区会在数据库中。

这种方法唯一的问题是，在调用 SaveOrUpdateCopy 之前，您需要为 Country 对象分配一个 ID。

# reporting-services - 如何自定义 SSRS 中的错误消息？

> ID：290309
> 
> 赞同：2
> 
> 时间：2008-11-14T14:54:32.107
> 
> 标签：reporting-services, message

我从报表服务器访问 SSRS 报表。如果我的报告无法在那里打开，我有什么办法可以给出我自己的错误消息？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-15T05:11:22.300

如果您使用的是 SSRS 报告管理器，我想不出任何方法来捕获 RS 错误。另一方面，如果您正在使用报表查看器控件，您可能有更高的机会捕获错误。如果您使用自定义数据集扩展来呈现报表，情况也是如此。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-04-30T11:06:06.707

1.  浏览到报告管理器文件夹。对于 SSRS 2005，其典型位置是

    > DRIVE:\Program Files\Microsoft SQL Server\MSSQL.x\Reporting Services\ReportManager，其中 x 是实例；对于 SSRS 2008 和 SSRS 2008 R2，驱动器：\Program Files\Microsoft SQL Server\MSRS10.SSRS\Reporting Services\ReportManager。

2.  制作现有 Web.config 的副本作为备份
3.  在文本编辑器或 Visual Studio 中打开 Web.config 以获得 Intellisense 支持
4.  在该部分下，找到该部分
5.  使用适当的设置修改现有部分或插入新部分
6.  重新启动报表服务器

SSRS 2008 的自定义错误消息在[这里查看](https://stackoverflow.com/questions/188373/custom-error-pages-in-reporting-services-2008)

# soap - 如何将 RPC/编码样式 WSDL 转换为文档/文字

> ID：290311
> 
> 赞同：9
> 
> 时间：2008-11-14T14:54:50.173
> 
> 标签：soap, wsdl

我需要基于旧的 RPC/编码文件以文档/文字样式生成一个新的 WSDL 文件。我在这里查看了其他 WSDL 问题 - 并阅读了[http://www.ibm.com/developerworks/webservices/library/ws-whichwsdl/](http://www.ibm.com/developerworks/webservices/library/ws-whichwsdl/)。这表明文档/文字 WSDL 应该有一个附加部分 - 但我的旧 RPC/编码文档也有这样一个部分（或更准确地说）。这是否意味着我只需要更改绑定就完成了？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-18T18:10:08.420

这篇技术文章可能会对您有所帮助：
[**将 RPC/literal 转换为 Document/literal**](https://msdn.microsoft.com/en-us/library/ms996466.aspx#rpc_literal_topic3)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-05-05T14:24:59.320

如果您使用 PHP，您可以使用 Zend 框架的 Zend_Soap_AutoDiscover 类。它具有生成不同 WSDL 样式和用途的选项。见这里：[http](http://www.phpriot.com/manual/zf/zend.soap.autodiscovery.wsdlstyles) ://www.phpriot.com/manual/zf/zend.soap.autodiscovery.wsdlstyles和这里：[http ://www.phpriot.com/articles/zend-soap/6](http://www.phpriot.com/articles/zend-soap/6)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-07-20T08:33:19.423

使用[CWSDLGeneratorDocument.php](https://github.com/Taron133/CWSDLGeneratorDocument)生成 DOCUMENT/LITERAl 样式的 WSDL 文件，并在 java 1.7 中使用标准库 JAX-WS。

很简单。

# perl - 如何使用 CGI.pm 开发 web 2.0 应用程序？

> ID：290313
> 
> 赞同：6
> 
> 时间：2008-11-14T14:55:53.870
> 
> 标签：perl

几年前，我在 CGI.pm 上做了很多工作。我正在评估再次将其用于快速项目。有人可以让我了解在“Web 2.0”世界中使用 CGI.pm 进行开发的当前状态吗？CPAN 上最好的库是什么？是否有干净的方法来包含 jQuery、YUI、其他 CSS 库等，并做一些 AJAX。CPAN 上当然有很多库，但哪些是有效的，哪些是常用的？

我们还没有这样做？

```
$JSCRIPT<<EOF;
...
EOF

```

我意识到人们会提供 Catalyst 作为答案。然而，许多人可能拥有他们只是想增强的遗留 CGI.pm 应用程序。重新开始真的是最好的答案吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-14T19:05:28.420

就个人而言，我不喜欢 Catalyst（对我的口味来说太重了）或 Mason（混合代码和 HTML 很糟糕），但我使用 CGI.pm 输入 [1] 做得很好，HTML::Template 用于输出和 CGI​​::Ajax 在需要时提供 AJAX 功能。

如果您正在查看框架，您可能还需要考虑 CGI::Application，它是 Catalyst/Mason 的一种广泛使用且重量更轻的替代方案。

[1] 我不记得上次我从 CGI.pm 调用 $q->param 或 $q->cookie 以外的任何东西是什么时候了。仍然有很多教程说要使用它的 HTML 生成功能，但这仍然以一种与使用 here docs 一样糟糕的方式混合代码和 HTML，如果不是更糟的话。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-14T14:58:04.160

考虑使用更现代的东西，例如[Catalyst](http://www.catalystframework.org/)。它会让你的生活更轻松，而且你不必重新发明轮子。我知道这只是一个小项目，但根据我的经验，许多小项目及时变成了大项目:)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-14T17:45:03.247

我使用过的“web 2.0”应用程序通常使用客户端 JavaScript 从服务器请求[JSON](http://www.json.org/)数据，然后使用该数据通过 DOM 就地更新页面。

[JSON](http://search.cpan.org/perldoc?JSON)模块对于将结构化数据返回到浏览器很有用。

至于在此处的文档中包含 JavaScript、HTML 或其他内容 - 这**从来都不**是一个好主意，现在仍然不是。相反，使用在 CPAN 上可以找到的大量模板模块之一。对于 CGI，我会避免使用像 Mason 或 Template Toolkit 这样的“重”模块，并使用更轻的模块来更快地启动，例如[Text::Template](http://search.cpan.org/perldoc?Text::Template)或[Template::Simple](http://search.cpan.org/perldoc?Template::Simple)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-14T19:36:12.867

是的，您可以编写完美的 web2.0 Web 应用程序，而无需使用任何语言 Perl、Python、Java 等在服务器端使用任何框架，也无需在客户端使用任何 JavaScript 库/框架。web 2.0 的定义有点松散，我猜是 web2.0，你的意思是 Ajax 或部分页面刷新，那么你真正需要的就是关注以下内容：

1.  了解 XmlHttpRequest 对象。
2.  知道如何将 JSON 对象从服务器返回到客户端。
3.  知道如何使用 JavaScript 安全地评估/解析 JSON 对象并知道如何操作 DOM。另外，至少了解一下innerHTML。InnerHTML 有时很有帮助。
4.  了解 CSS。

话虽如此，在服务器端使用一些框架要容易得多，但这并不是因为它是 web2.0 所要求的，而且在客户端使用一些 JavaScript（如 jQuery、mootools、YUI）要容易得多。您可以根据自己的需求和口味进行混搭。大多数 JavaScript 都提供了 XmlHttpRequest 的包装器，因此它可以在所有浏览器中运行。除非您想展示一些示例，否则没有人再写“裸”XmlHttpRequest。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-14T15:23:47.760

使用 CGI.pm 编写“Web 2.0”应用程序是完全可能的，但您必须自己完成这项工作。据我所见，Perl 开发社区的重点一直是开发 CGI 的后续框架，而不是编写帮助模块来让遗留应用程序引导到现代范式中。所以你有点靠自己。

至于是否重新开始，你真正想要完成什么？每个人对“Web 2.0”的定义都有些不同。

如果您尝试将一些现代功能（如 AJAX）引入旧版应用程序，那么您没有理由需要重新开始。

另一方面，如果您正在尝试编写真正看起来、感觉和工作起来像现代 Web 应用程序的东西（例如，远离页面加载是应用程序状态模型），您可能应该考虑从接地。试图在事后进行如此大的转变，除了最微不足道的应用程序之外，任何事情都比它的价值要麻烦得多。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-14T15:24:26.043

我同意亚当的回答，你可能想使用催化剂。话虽这么说，如果你真的不想，没有什么能阻止你只使用 CGI.pm。问题是，Catalyst 是一个包的集合，可以完成您想要使 Web 2.0 变得简单的事情。它将各种模板引擎（如 Template Toolkit 或 Mason）与各种 ORM 接口（如 DBIx::Class 和 Class::DBI）结合在一起。

当然，您不必使用这些东西来编写 Web 2.0 应用程序，这只是一个好主意。您的部分问题是想知道 jQuery 或原型之类的 javascript 和 CSS 框架是否需要服务器端代码中的任何内容。他们没有，您可以将它们与您想要的任何类型的服务器端代码一起使用。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-14T16:18:30.910

如果从 CGI.pm 跳转到 Catalyst 似乎太令人生畏，那么[蹲下](http://search.cpan.org/dist/Squatting/)之类的东西可能更合适？

[Squatting](http://groups.google.co.uk/group/squatting-framework)是一个 Web 微框架，我发现它非常适合快速原型设计和替换/升级我的旧 CGI 脚本。

我最近使用 jQuery 构建了一个小型“web 2.0”应用程序，完全没有问题。在 CPAN 发行版中有一个示例目录，其中包含一些使用 jQuery 和 AJAX 的程序，包括一个非常有趣的 [COMET]( [http://en.wikipedia.org/wiki/Comet_(programming))](http://en.wikipedia.org/wiki/Comet_(programming)))示例，它使用了[Continuity](http://continuity.tlt42.org/)（其中默认情况下蹲“蹲”）。

注意。如果需要，您可以稍后使用[Squatting::On::Catalyst将您的应用程序“蹲”到 Catalyst 上](http://search.cpan.org/dist/Squatting/lib/Squatting/On/Catalyst.pm)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-12-13T17:07:10.463

对于新应用程序，如果您不喜欢 Catalyst，[Dancer](http://www.perldancer.org/)是您可能喜欢的另一个轻量级框架。还有很多其他的，包括 CGI::Simple、Mojo/Mojolicious、Squatting...

这些轻量级框架中的任何一个都可以为您处理 Web 编程中无聊的部分，并让您继续以您想要的方式编写有趣的部分。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-12-13T09:03:47.220

还有[CGI::Ajax](http://p3rl.org/CGI%3a%3aAjax)。

# c# - Outlook 互操作：如何遍历文件夹中的所有项目

> ID：290316
> 
> 赞同：3
> 
> 时间：2008-11-14T14:57:24.723
> 
> 标签：c#, com, interop, outlook, ms-office

我想搜索所有 Outlook 项目的正文。我知道如何为四个 PIM 项目（Notes/Tasks/Appointments/Contacts）执行此操作。但是除了将 COM 对象转换为特定的项目类型（即，ContactItem、AppointmentItem 等）之外，它们的代码都是相同的。这些 PIM 项是否有父类，以便我可以在循环中执行以下操作：

```
 using Outlook = Microsoft.Office.Interop.Outlook

List SearchFolderItems( Outlook.Folder folder )
{
   List results = new List();
   foreach( object folderItem in folder.Items )
   {
      //GenericPIMItem is what I am wishing for
      Outlook.GenericPIMItem item  = (Outlook.GenericPIMItem)folderItem;
      if( item.Body.ToLower().Contains( "secret sauce" ) )
      {
         results.Add( item.Name );
      }
   }
} 

```

Body 是我想要获得的四个 PIM 项目的共同属性。有这样的父项吗？如果不是，API 设计似乎很糟糕？我想我可以抽象文件夹项目，让它看起来像有一个父项目......我也尝试使用反射来做到这一点，但不能完全到达那里。

有什么建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T16:30:59.120

查看文档，我没有看到您想要的课程。

对于 Outlook 2007，可以在 Items 集合中的对象列表位于[此处](http://msdn.microsoft.com/en-us/library/bb147566.aspx)。它包括诸如没有正文的分发列表之类的东西，这使得您想要的东西不太可能。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-24T20:49:42.760

虽然 PIM 项可能派生自一个公共类，但它不能通过 com 对象创建，但是，所有[**项**](http://msdn.microsoft.com/en-us/library/bb207137.aspx)也返回一个[**类**](http://msdn.microsoft.com/en-us/library/bb208118.aspx)属性，该属性是对它是什么类型的项的枚举。您可以在投射之前检查此属性以获得您想要的四种类型的项目，

# internet-explorer-7 - Internet Explorer 提供未知文件类型

> ID：290320
> 
> 赞同：0
> 
> 时间：2008-11-14T14:58:20.307
> 
> 标签：internet-explorer-7

我在端口 80 和端口 81 上有一个 Web 服务器。IE 可以连接到任一端口上的服务器。这一直很好，直到我在客户端 PC 上安装了一个文件类型 (.TPJ) 的 MIME 类型为 text/xml 的应用程序。此时 IE 不再打开该网站，而是提供下载文件*serverName.TPJ*。该文件包含来自网站的正确信息。

我更改了应用程序的安装程序，因此它没有注册 MIME 类型。现在客户端 PC 上的 IE 提供下载未知文件类型的文件。请注意，该应用程序从未安装在服务器 PC 上。

问题出现在 IE7 上。Firefox、Safari 或 Chrome 不会出现这种情况。

有谁知道如何解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-14T16:36:58.267

我找到了答案。注册表中有一个用于 text/xml MIME 类型的剩余条目。可以通过重新注册 MSXML3.DLL 将其恢复为默认值。

```
regsvr32 msxml3.dll 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T10:51:11.930

Windows 注册表编辑器版本 5.00

[HKEY_CLASSES_ROOT\MIME\Database\Content Type\text/xml] "CLSID"="{48123BC4-99D9-11D1-A6B3-00C04FD91555}" "Extension"=".xml" "Encoding"=hex:08,00,00 ,00

# sharepoint - SharePoint：以编程方式隐藏列表字段

> ID：290322
> 
> 赞同：8
> 
> 时间：2008-11-14T14:58:29.730
> 
> 标签：sharepoint

我试图隐藏列表中的“标题”字段。这似乎不起作用：

```
SPList myList;
...
SPField titleField = myList.Fields.GetField("Title");
//titleField.PushChangesToLists = true; <-- doesn't seem to make a difference
titleField.ShowInEditForm = false;
titleField.ShowInDisplayForm = false;
titleField.ShowInNewForm = false;
titleField.Update();
//myList.Update(); <-- make no difference 
```

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-14T15:25:13.420

试试这个：

```
field.Hidden = true;
field.Update(); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-08-01T13:17:06.667

除非 CanToggleHidden 的值为 true，否则上述设置 Hidden true 的示例均无效。问题是，CanToggleHidden 只有 Get，而不是 Set，因此您必须使用反射执行激进的“SharePoint 编程体操特技”，首先将 CanToggleHidden 从 false 翻转为 true。完成此操作后，您可以将 Hidden 更改为 true（或返回 false）。网络上有很多示例（尽管并非所有示例都正确编写）。如果需要，我可能会找到一个可行的 PowerShell 示例。

```
if(field.CanToggleHidden) {
   field.Hidden = false;
}
else
{
   // display an error message or write to your favorite logging location
   // explaining that there is no hope of changing the value of Hidden until
   // CanToggleHidden changes to TRUE first.
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T15:08:05.387

确保您正在获取一个*新*的SPWeb 实例。

```
using (SPSite site = new SPSite(webUrl))
{
    using (SPWeb web = site.OpenWeb())
    {
        try
        {
            //... Get SPList ...
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-14T15:17:17.803

我相信列表中字段的可见性由用户“获取”的默认视图控制。你不想修改视图吗？我知道您可以获得列表的视图以及默认视图。

我只是在这里吐口水......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-04-23T13:10:44.793

当您使用 Hidden 属性时，您需要付出一定的代价。

已经发现将列设置为隐藏将删除通过代码删除它的能力。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-11-23T06:00:19.300

试试这个，这会起作用......标题字段被命名为LinkTitle......其他字段可以以相同的方式隐藏。

```
SPView view = list.DefaultView;    
if(view.ViewFields.Exists("LinkTitle")) 
{    
   view.ViewFields.Delete("LinkTitle");    
   view.Update();    
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-02-20T08:05:55.267

上面的解决方案是在任何地方隐藏该字段。它也将隐藏在列表的列概览中。

如果您只想隐藏特定列表中的字段。或者，如果您仍然使用列表设置页面来操作该字段（设置回可见）。您需要在列表的“FieldLinks”属性中设置字段的“隐藏”属性。

```
myList.FieldLinks["SomeField"].Hidden = true; 
```

# java - 如何从axis2 soap响应中省略字段？

> ID：290323
> 
> 赞同：0
> 
> 时间：2008-11-14T14:58:40.977
> 
> 标签：java, axis2, pojo

我有一个请求某些对象状态的 Axis2 Web 服务。对象可以存在于服务器上，也可以不存在。

Web 服务是用 POJO 实现的，wsdl 是用 java2wsdl 工具生成的。

假设 SOAP 响应的相关部分如下所示：

字符串 int 字符串 ......

我想要做的是： - 当在对象列表中找到对象时，我希望所有字段都有一个值并发送到客户端。- 当在对象列表中找不到对象时，我只希望 objectName 和 objectStatus 字段具有值并发送到客户端。SOAP 消息中应该缺少其他对象属性值。

我怎样才能做到这一点？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T15:12:39.077

我会`boolean`在响应中添加一个标志，例如`isObjectPresent`. 然后，您的客户可以查看此标志以确定对象是否“存在”。您未在响应对象中设置的任何值都将设置其默认值（int = 0，String = ""），但这样您可以向客户端发出信号，不要关注这些字段。

# java - Java 中的 StAX XML 格式

> ID：290326
> 
> 赞同：25
> 
> 时间：2008-11-14T14:59:28.197
> 
> 标签：java, xml, formatting, stax, woodstox

是否可以使用 StAX（特别是 woodstox）使用换行符和制表符格式化输出 xml，即格式为：

```
<元素1>
  <元素2>
   一些数据
  </元素2>
</元素1>

```

代替：

```
<element1><element2>someData</element2></element1>
```

如果这在woodstox 中是不可能的，是否还有其他轻量级库可以做到这一点？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2010-09-02T08:29:01.693

有 com.sun.xml.txw2.output.IndentingXMLStreamWriter

```
XMLOutputFactory xmlof = XMLOutputFactory.newInstance();
XMLStreamWriter writer = new IndentingXMLStreamWriter(xmlof.createXMLStreamWriter(out)); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-14T15:50:05.960

通过 JDK `transformer.setOutputProperty(OutputKeys.INDENT, "yes");`：.

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2016-07-14T10:34:25.540

使用 JDK[转换](https://docs.oracle.com/javase/8/docs/api/javax/xml/transform/Transformer.html)器：

```
public String transform(String xml) throws XMLStreamException, TransformerException
{
    Transformer t = TransformerFactory.newInstance().newTransformer();
    t.setOutputProperty(OutputKeys.INDENT, "yes");
    t.setOutputProperty("{http://xml.apache.org/xslt}indent-amount", "2");
    Writer out = new StringWriter();
    t.transform(new StreamSource(new StringReader(xml)), new StreamResult(out));
    return out.toString();
} 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2010-03-03T04:09:17.857

如果您使用的是 StAX 游标 API，则可以通过将 XMLStreamWriter 包装在[缩进代理](http://ewernli.wordpress.com/2009/06/18/stax-pretty-printer/)中来缩进输出。我在自己的项目中尝试过，效果很好。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-27T20:40:01.910

[StaxMate](https://github.com/FasterXML/StaxMate)怎么样：

[http://www.cowtowncoder.com/blog/archives/2006/09/entry_21.html](http://www.cowtowncoder.com/blog/archives/2006/09/entry_21.html)

适用于 Woodstox、快速、低内存使用（未构建内存树）以及如下缩进：

* * *

```
SMOutputFactory sf = new SMOutputFactory(XMLOutputFactory.newInstance());
SMOutputDocument doc = sf.createOutputDocument(new FileOutputStream("output.xml"));
doc.setIndentation("\n ", 1, 2); // for unix linefeed, 2 spaces per level    
// write doc like:    
SMOutputElement root = doc.addElement("element1");    
root.addElement("element2").addCharacters("someData");    
doc.closeRoot(); // important, flushes, closes output 
```

* * *

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2013-02-14T15:32:23.703

我建议不要依赖可能会消失的 com.sun...class（或重命名为 com.oracle...class），而是建议从 java.net下载[StAX 实用程序类。](http://java.net/projects/stax-utils/pages/Home)这个包包含一个很好用的 IndentingXMLStreamWriter 类。（源代码和 javadoc 包含在下载中。）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-14T15:49:12.933

如果您使用的是迭代方法 (XMLEventReader)，在写入您的 XML 文件时，您不能在相关的 XMLEvents 中附加一个新行 '\n' 字符吗？

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-24T23:51:14.767

不确定stax，但最近有一个关于漂亮打印xml的讨论here

[来自java的漂亮打印xml](https://stackoverflow.com/questions/139076/how-to-pretty-print-xml-from-java)

这是我尝试的解决方案

[如何从 Java 漂亮地打印 XML？](https://stackoverflow.com/questions/139076/how-to-pretty-print-xml-from-java#260314)

使用**org.dom4j.io.OutputFormat.createPrettyPrint()**方法

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2018-07-01T12:16:49.077

如果您使用的是 XMLEventWriter，那么更简单的方法是：

```
XMLOutputFactory outputFactory = XMLOutputFactory.newInstance();
        XMLEventWriter writer = outputFactory.createXMLEventWriter(w);
        XMLEventFactory eventFactory = XMLEventFactory.newInstance();
        Characters newLine = eventFactory.createCharacters("\n"); 
        writer.add(startRoot);
        writer.add(newLine); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-09-18T15:20:09.793

使用 Spring Batch，这需要一个子类，因为这个[JIRA BATCH-1867](https://jira.springsource.org/browse/BATCH-1867)

```
public class IndentingStaxEventItemWriter<T> extends StaxEventItemWriter<T> {

  @Setter
  @Getter
  private boolean indenting = true;

  @Override
  protected XMLEventWriter createXmlEventWriter( XMLOutputFactory outputFactory, Writer writer) throws XMLStreamException {
    if ( isIndenting() ) {
      return new IndentingXMLEventWriter( super.createXmlEventWriter( outputFactory, writer ) );
    }
    else {
      return super.createXmlEventWriter( outputFactory, writer );
    }
  }

} 
```

但这需要额外的依赖，因为 Spring Batch 不包含缩进 StAX 输出的代码：

```
<dependency>
  <groupId>net.java.dev.stax-utils</groupId>
  <artifactId>stax-utils</artifactId>
  <version>20070216</version>
</dependency> 
```

# sql-server - SQL Server 和来宾帐户 - 这是做什么用的？

> ID：290330
> 
> 赞同：2
> 
> 时间：2008-11-14T15:01:14.200
> 
> 标签：sql-server, permissions

SQL Server（2000、2005、2008）中的来宾帐户应该如何使用？到底有什么好处呢？我已尝试启用该帐户，但我仍然无法让某些用户能够刷新附加到我已将 SELECT 权限授予 GUEST 的视图的 Excel 2007 数据透视表。

我错过了什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-14T15:04:25.067

Guest 主要是为了允许使用 Public 角色访问数据库。不要认为它是用户实际登录的东西......

创建数据库时，默认情况下该数据库包含 Guest 用户。授予来宾用户的权限由在数据库中没有用户帐户的用户继承。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-14T16:25:27.277

它在那里供您禁用:)

你真的不应该使用它 - 明确授予权利。

[http://sql-server-performance.com/Community/blogs/satya/archive/2007/07/31/126786.aspx](http://sql-server-performance.com/Community/blogs/satya/archive/2007/07/31/126786.aspx)

# html - 如何在 Firefox 中将元素放置在其容器的底部？

> ID：290335
> 
> 赞同：10
> 
> 时间：2008-11-14T15:02:25.370
> 
> 标签：html, css, positioning

我有一个表格单元格，我希望其中的 div 始终位于左下角。以下在 IE 和 Safari 中运行良好，但 Firefox 将`div`绝对定位在页面上，而不是在单元格内（基于解决方案解决方案的代码[here](https://stackoverflow.com/questions/104953/position-an-html-element-relative-to-its-container-using-css)）。我已经测试了使用和不使用 DTD，它将 Firefox 置于 Quirks 模式和标准模式，但都不能正常工作。我被困住了——有什么想法吗？

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <title>Test</title>
        <style type="text/css">
        table { width:500px; }
        th, td { vertical-align: top; border:1px solid black; position:relative; }
        th { width:100px; }
        .manage { text-align:right; position:absolute; bottom:0; right:0; }
        </style>
    </head>
    <body >
    <table>
        <tr>
            <th>Some info about the following thing and this is actually going to span a few lines</th>
            <td><p>A short blurb</p><div class="manage">Edit | Delete</div></td>
        </tr>
        <tr>
            <th>Some info about the following thing and this is actually going to span a few lines</th>
            <td><p>A short blurb</p><div class="manage">Edit | Delete</div></td>
        </tr>
    </table>
    </body>
</html> 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-14T15:20:48.420

根据[W3C](http://www.w3.org/TR/CSS21/visuren.html#propdef-position)， position:relative 对表格单元格没有影响：

> "'position:relative' 对 table-row-group、table-header-group、table-footer-group、table-row、table-column-group、table-column、table-cell 和 table-caption 的影响元素未定义。”

解决方案是向表格单元格添加一个额外的包装 div。

**编辑：**这个 div 需要一个`height:100%`and`position:relative;`来设置。

```
<table>
    <tr>
        <td>
            <div style="position:relative;height:100%;">
                Normal inline content.
                <div class="manage">your absolute-positioned content</div>
            </div>
        </td>
    </tr>
</table> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-07-20T15:20:08.623

把 a`display:block`放在桌子上，现在 FF 尊重位置：相对。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-14T15:15:31.520

看看这是否适合你。不确定问题的确切性质，但它与使用 td 和相对定位有关。我用 div 标签包装了表格并将其相对定位，它似乎可以满足您的需求。

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <title>Test</title>
        <style type="text/css">
        table { width:500px;  }
        th, td { vertical-align: top; border:1px solid black; }
        th { width:100px; }
        div.body {position:relative; width:500px;}
        .manage { text-align:right; position:absolute; bottom:0; right:0; display:block}
        </style>
    </head>
    <body >
    <div class="body"><table>
        <tr>
                <th>Some info about the following thing and this is actually going to span a few lines</th>
                <td><p>A short blurb</p><div class="manage">Edit | Delete</div></td>
        </tr>
    </table></div>
    </body>
</html> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-14T15:36:21.633

在 TD 内有一个宽度为 100% 和高度为 100% 的 DIV，然后将其设置为位置：相对。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-14T15:36:57.623

对了， position:relative 对表格元素没有影响，firefox 应用了这个规则。div 的解决方案有效，但在我看来这是一个糟糕的标记。

您绝对需要使用表格来显示此内容吗？（或者是相对的？）

如果没有，你为什么不使用 div 元素并做你想做的事？

使用表格来解决布局问题是 1998 年...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-14T15:17:41.640

`position: relative``td`该标签显然不受全球支持。不幸的是，我找不到确切的消息来源。

您可能希望将一个`div`块放入`td`具有所需大小的块中，然后应用`position: relative`到该块中。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-14T15:18:15.553

这听起来很明显，但是您是否尝试过`vertical-align: bottom;`在 .manage 中使用？

# windows - 一个好的，免费的屏幕共享程序，用于结对编程？

> ID：290341
> 
> 赞同：15
> 
> 时间：2008-11-14T15:05:30.417
> 
> 标签：windows, collaboration, pair-programming

我正在寻找一个好的、免费的（首选）屏幕共享程序，它适用于 Windows（Vista x64、Server 2008）的结对编程和代码审查会话。它应该允许任何一个人控制屏幕，并通过体面的宽带连接对文本编辑做出相当大的响应。其他功能，例如绘制/标记/注释其他人屏幕的能力会很好。

编辑：这将被远程位置的开发人员使用。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-15T00:13:17.830

[来自http://www.teamviewer.com/](http://www.teamviewer.com/)的 TeamViewer运行良好。我们将它用于伦敦和乌克兰之间的结对编程。

笔记：

1.  我们使用 Skype 进行语音。
2.  TeamViewer 在 Visual Studio 2008 @ 1024x768 分辨率下使用极低的带宽 - 平均 4kbyte/sec 进行编程。
3.  可以通过按钮将角色从热座切换到查看器。
4.  屏幕的远程视图可以调整大小以适应更小的区域，而不会影响可用性。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-14T15:09:19.520

[Windows 共享视图](http://connect.microsoft.com/site/sitehome.aspx?SiteID=94)对我有用。它允许您仅共享某些窗口，甚至显示您的“与会者”鼠标所在的位置。最好将它与某种 voip 连接结合使用，这样您就不必来回输入问题/回复。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-10-11T08:49:51.973

我已经检查了几个小时了。

我发现的最好和最简单的东西。 [http://www.screenleap.com/](http://www.screenleap.com/)
免费，目前没有找到任何字符串。
无需浪费时间安装或注册任何东西。

如果您有多显示器设置，则与“仅共享”完美搭配。
大多数其他软件默认共享全屏，您无法选择共享哪个显示器。

您需要注意它不会加密数据。检查常见问题解答。但是，如果你必须通过 Skype/Mymble/Whatever 单独运行语音。黑客仅仅获得 50% 的会议会造成什么伤害？

噗……哦，你希望屏幕共享……这个没有。
所以试试： http: [//www.mingleview.com/](http://www.mingleview.com/) 它有那个多显示器“错误”，你需要安装一个简单的类似插件的东西。但是“控制”就在那里，而且也很简单。

大多数其他软件都捆绑了一些不必要的功能，如日历、文档系统、文件共享，我已经有了解决方案。这就像在 excel 宏上开发游戏.. 不必要.. 开发人员请学习！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-14T15:08:16.543

我还没有真正尝试过，但它看起来很有希望。查看[DimDim](http://www.dimdim.com/)。他们在 Sourceforge 上有一个免费的 Web 服务和一个 VMWare 映像。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-08T21:49:04.117

如果您使用的是 eclipse，您可能想尝试[ECF](http://www.eclipse.org/ecf)。[这里](http://live.eclipse.org/node/543)有一个视频演示。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-14T15:38:15.280

[在www.mikogo.com](http://www.mikogo.com)上试用 Mikogo

很容易设置。防火墙等没有问题

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-14T15:45:34.767

我的最后一个建议，但这不是我尝试过的。前往[交叉环线](http://www.crossloop.com/)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-08T21:49:28.033

对于穷人的解决方案，您可以使用 RealVNC 的免费版。在服务器上，取消选中所有这些框：

[![替代文字](https://i.stack.imgur.com/pYwjB.gif)](https://i.stack.imgur.com/pYwjB.gif)
[（来源：[realvnc.com](http://www.realvnc.com/products/free/4.1/images/winvnc4_inputs.gif)）]

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-28T23:20:41.400

在 OSX 上，我使用了 vim 和多用户 GNU 屏幕会话——这比 VNC、屏幕共享等提供了更好的响应能力。我猜你可以将这些与 Cygwin 一起使用？

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-06-21T23:56:50.390

我喜欢使用 Screen Hero，它允许两个用户在共享屏幕上使用鼠标：http: [//screenhero.com/](http://screenhero.com/)

或缩放：http: [//zoom.us/](http://zoom.us/)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-14T15:11:10.547

结合人们用于演示的屏幕覆盖应用程序之一（screenpen 响铃），VNC 客户端会不会做到这一点？

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-14T15:15:36.230

你需要这个远程吗？您可以将两台显示器设置为镜像和 2 个 USB 键盘/鼠标

如果它是远程的，那么 VNC 是要走的路，如果您正在寻找免费版本，我会使用[UltraVNC](http://www.uvnc.com/) ，它比 VNC 的免费版本具有更多功能（聊天、文件传输） - 它还有一个视频驱动程序挂钩意味着它比普通 VNC 更容易受到任何奇怪的屏幕问题的影响。
如果防火墙是一个问题，您可以简单地设置一个 VPN（无论如何这可能是一个好主意 - 尽管 Ultra 可以进行加密）。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-14T15:44:24.987

另一种选择是使用 VNC，但使用反向连接。看看[这个](http://www.runpcrun.com/create_your_own_support_software)，我将它与[No-IP](http://www.no-ip.com)结合使用以获得固定地址。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-14T15:52:11.930

Joel 的[https://www.copilot.com/](https://www.copilot.com/)等服务怎么样？

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-12-08T21:41:55.507

你看过netbeans自带的协作模块吗？它对结对编程非常有用！

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2012-12-12T20:44:25.973

为了多平台的简单性，我建议

1.  [https://join.me/](https://join.me/)用于屏幕共享（您甚至可以使用 iOS 查看远程屏幕！）
2.  获取电话耳机，并使用电话获取音频。

# macos - 如何让 sendmail 在 Mac OS 10.5 上可靠地工作？

> ID：290347
> 
> 赞同：0
> 
> 时间：2008-11-14T15:06:45.033
> 
> 标签：macos, sysadmin, sendmail, mamp

我需要在办公室使用 Mac 的 sendmail。目前，我可以让它在两个开发 Mac 上工作（我认为这是由于 MAMP 正在安装和工作），但让它在其他 Mac 上运行似乎是一个问题......

我认为这归结为一些配置问题，并希望有办法解决它（而不是在每台机器上安装 MAMP！）。

我认为这可能取决于 from 的“本地”性质，但不确定。如果有帮助，这里是 /var/log/mail.log 的转储：

```
Nov 14 14:37:06 claire-g5 postfix/master[5339]: daemon started -- version 2.4.3, configuration /etc/postfix
Nov 14 14:37:06 claire-g5 postfix/qmgr[5341]: 2B625250BDB: from=<claire@claire-g5.local>, size=1131, nrcpt=1 (queue active)
Nov 14 14:37:06 claire-g5 postfix/qmgr[5341]: D5D19250D5A: from=<claire@claire-g5.local>, size=1191, nrcpt=1 (queue active)
Nov 14 14:37:06 claire-g5 postfix/smtp[5344]: 2B625250BDB: host mx01.xxx.uk[212.x.x.134] said: 451 cannot relay now to <xx@xx.com>, please try again later (in reply to RCPT TO command)
Nov 14 14:37:06 claire-g5 postfix/smtp[5346]: D5D19250D5A: host mx01.xxx.uk[212.x.x.186] said: 451 cannot relay now to <xx@xx.com>, please try again later (in reply to RCPT TO command)
Nov 14 14:37:07 claire-g5 postfix/smtp[5346]: D5D19250D5A: to=<xx@xx.com>, relay=mx01.xxx.uk[212.x.x.134]:25, delay=2350, delays=2349/0.08/0.7/0.12, dsn=4.0.0, status=deferred (host mx01.xxx.uk[212.x.x.134] said: 451 cannot
Nov 14 14:37:07 claire-g5 postfix/pickup[5340]: 1A2EC2511D1: uid=501 from=<claire 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-14T15:16:41.330

请注意，它是您在 Mac 上运行的后缀，而不是 sendmail。

问题是机器 mx01.xxx.uk[212.xx134] 被配置为阻止邮件中继（通过 SMTP 接受电子邮件并将其发送到最终邮件服务器）。postfix 配置文件通常存储在 /etc/postfix 中，因此您可以从那里开始。特别是，查看 main.cf 中的 mynetworks 设置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-14T15:22:00.010

啊哈！谢谢丹尼斯 - 这看起来像野兽......

```
### MAMP Postfix Configuration - Start ###

myorigin = example.com
myhostname = mailer.$myorigin
smtpd_sender_restrictions = permit_inet_interfaces

# smart host
relayhost = auth.example.co.uk
smtp_sasl_auth_enable = yes
smtp_sasl_password_maps = hash:/etc/postfix/sasl_MAMP_passwd
smtp_sasl_security_options = noanonymous

### MAMP Postfix Configuration - End ###
# DONT REMOVE: MAMP PRO main.cf template compatibility version: 1 
```

我会试一试，然后回复你。

# javascript - 使用 javascript 编辑所有外部链接

> ID：290368
> 
> 赞同：1
> 
> 时间：2008-11-14T15:14:27.013
> 
> 标签：javascript, html, href

如何使用 javascript 浏览 div 中的所有外部链接，添加（或附加）一个类和替代文本？

我想我需要获取 div 元素内的所有对象，然后检查每个对象是否为 a ，并检查 href 属性是否以 http(s):// 开头（应该是外部链接），然后将内容添加到alt 和 class 属性（如果它们不存在，则创建它们，如果它们存在；附加想要的值）。

但是，我如何在代码中做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-14T17:45:59.283

这个经过测试：

```
<style type="text/css">
.AddedClass
{
  background-color: #88FF99;
}
</style>
<script type="text/javascript">
window.onload = function ()
{
  var re = /^(https?:\/\/[^\/]+).*$/;
  var currentHref = window.location.href.replace(re, '$1');
  var reLocal = new RegExp('^' + currentHref.replace(/\./, '\\.'));

  var linksDiv = document.getElementById("Links");
  if (linksDiv == null) return;
  var links = linksDiv.getElementsByTagName("a");
  for (var i = 0; i < links.length; i++)
  {
    var href = links[i].href;
    if (href == '' || reLocal.test(href) || !/^http/.test(href))
      continue;
    if (links[i].className != undefined)
    {
      links[i].className += ' AddedClass';
    }
    else
    {
      links[i].className = 'AddedClass';
    }
    if (links[i].title != undefined && links[i].title != '')
    {
      links[i].title += ' (outside link)';
    }
    else
    {
      links[i].title = 'Outside link';
    }
  }
}
</script>

<div id="Links">
<a name="_Links"></a>
<a href="/foo.asp">FOO</a>
<a href="ftp://FTP.org/FILE.zip">FILE</a>
<a href="http://example.com/somewhere.html">SomeWhere</a>
<a href="http://example.com/somewhere2.html" class="Gah">SomeWhere 2</a>
<a href="http://example.com/somewhere3.html" title="It goes somewhere">SomeWhere 3</a>
<a href="https://another-example.com/elsewhere.php?foo=bar">ElseWhere 1</a>
<a href="https://another-example.com/elsewhere.php?foo=boz" class="Doh">ElseWhere 2</a>
<a href="https://another-example.com/elsewhere.php?foo=rad" title="It goes elsewhere">ElseWhere 3</a>
<a href="deep/below/bar.asp">BAR</a>
<a href="javascript:ShowHideElement('me');">Show/Hide</a>
</div> 
```

如果您使用的是共享服务器上的帐户，例如[http://big-server.com/~UserName/](http://big-server.com/~UserName/)，您可能希望对 URL 进行硬编码以超出顶层。另一方面，如果要将[http://foo.my-server.com](http://foo.my-server.com)和[http://bar.my-server.com](http://bar.my-server.com)标记为本地，则可能需要更改 RE。

[更新] 好话之后提高了健壮性...
我不强调 FTP 或其他协议，它们可能应该有一个独特的例程。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T15:48:14.853

我认为这样的事情可能是一个起点：

```
var links = document.getElementsByTagName("a"); //use div object here instead of document
for (var i=0; i<links.length; i++)
{
   if (links[i].href.substring(0, 5) == 'https')
   {
      links[i].setAttribute('title', 'abc');
      links[i].setAttribute('class', 'abc');
      links[i].setAttribute('className', 'abc');
   }
} 
```

您还可以遍历文档中的所有 A 元素，并检查父元素以查看 div 是否是您要查找的元素

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T15:36:41.757

这可以通过[Jquery](http://www.jquery.com)轻松完成。您可以将此添加到 onload：

```
$("div a[href^='http']").each(function() {
  $(this).attr("alt",altText);
  var oldClassAttributeValue = $(this).attr("class");
  if(!oldClassAttributeValue) {
   $(this).attr("class",newClassAttributeValue);
  }
}); 
```

您可以修改它以添加文本。也可以使用[css](http://docs.jquery.com/CSS)函数修改类。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-14T15:57:46.520

我的（非框架）方法将类似于：

```
window.onload = function(){
   targetDiv = document.getElementById("divName");
   linksArray = targetDiv.getElementsByTagName("a");
   for(i=0;i=linksArray.length;i++){
      thisLink = linksArray[i].href;
      if(thisLink.substring(4,0) = "http"){
         linksArray[i].className += "yourcontent";  //you said append so +=
         linksArray[i].alt += "yourcontent";
             } 
       }
   } 
```

这未经测试，但我会这样开始并从这里调试它。

# html - HTML/CSS：像 jQuery 这样的网站上的水平条/设计

> ID：290382
> 
> 赞同：2
> 
> 时间：2008-11-14T15:16:42.517
> 
> 标签：html, css, sitedesign

我确定这只是简单的 html/css，但我不知道如何调用该栏（谷歌搜索水平栏 html 总是会产生水平规则）。

[http://jquery.com/](http://jquery.com/)有一个 - 顶部的灰色条将菜单与页面内容分开。我很想自己做一个。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-14T15:23:47.773

有很多方法可以做到这一点。

在 jquery.com 上，它是应用 body 标记的背景图像的一部分。

您可以有一个标题部分，其背景与底部对齐作为图像和底部填充，以防止文本/内容覆盖该部分。最后，如果您只想使用纯色，则可以使用粗边框。我相信还有许多其他方法可以做到这一点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-14T15:38:13.457

最简单的解决方案：

```
<!-- content above bar goes here -->
<div style="height:30px;background-color:lightgray;clear:both;" ></div>
<!-- content below bar goes here --> 
```

你做的很清楚：两者都以防万一你想要保持在栏上方的浮动元素。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-14T15:33:05.290

它是应用于身体标签的[BG 图像。](http://static.jquery.com/files/rocker/images/bg_home_tile_sml.jpg)

```
body {
    background: #2a3139 url(../images/bg_home_tile_sml.jpg) repeat-x 50% 0;
} 
```

IMO 这是实现这种效果的最佳方式。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-14T15:34:33.183

如果您的设计足够静态，最好的方法（在我看来）是页面背景图像方法。否则，创建一个具有正确高度的 div，将其背景图像设置为具有正确高度/颜色/渐变属性的非常薄（1 或 2 像素）的图像，并将其平铺在 x 轴上。

我会避免使用粗边框方法，因为这可能会在不同的浏览器上呈现不同的效果。

# internet-explorer-6 - 有没有其他人看到这个 IE6.0 显示问题？

> ID：290386
> 
> 赞同：0
> 
> 时间：2008-11-14T15:18:00.407
> 
> 标签：internet-explorer-6, rendering

有人见过这种类型的 IE 显示问题吗？

[示例 http://xs133.xs.to/xs133/08465/ie_problem910.jpg.xs.jpg](http://xs133.xs.to/xs133/08465/ie_problem910.jpg.xs.jpg)

请注意，它在呈现时会进行某种自动换行/复制。

棕色框的代码和应该在其中的文本是：

```
<div class='span-23'>
    <div class='span-7'>
        <div class='info_box' style='height: 30px; padding-top: 10px'>
            <div class='span-4'><b>Vehicle Full Term Premium:</b></div>
            <div class='span-2' id='veh_ft_prem' style='text-align: right;'></div>
            <div class='span-4'><b>Vehicle Written Premium:</b></div>
            <div class='span-2' id='veh_writ_prem' style='text-align: right;'></div>
        </div>
    </div>
</div> 
```

我正在使用 BlueprintCSS 并且 info_box CSS 类是：

```
.info_box {
background: #fbe6a0;
color: #222222;
border-color: #222222;
padding:.8em;
padding-right: 0;
margin-bottom:1em;
border:2px solid #222222;} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-14T15:27:47.517

嗯..对不起，但我没有看到你的问题..即使在 IE6 中。

嗯，有几个网站在 CSS 问题等方面非常好。试试[http://www.positioniseverything.net](http://www.positioniseverything.net)是一个非常好的网站 =D

对不起，如果我不能帮助..

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-14T15:28:18.217

在最奇怪的 IE 渲染错误下，没有任何东西看起来甚至**可能**导致这种情况。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T17:05:28.803

经过一番摆弄，事实证明，如果你在我展示的盒子上方有一个隐藏的物体，那就是问题的原因。

抱歉，我没有给你更多信息，但当时，它看起来确实和 Patrick 所说的完全一样，不应该有 IE 渲染错误。

我希望这可以帮助其他人！

谢谢！

# java - Java 应用服务器性能

> ID：290392
> 
> 赞同：4
> 
> 时间：2008-11-14T15:18:32.793
> 
> 标签：java, hibernate, jakarta-ee

我在 Sun Application Server 8.1（又名 SJSAS，Glassfish 的前身）上运行了一个有点过时的 Java EE 应用程序。有 500 多个同时用户，应用程序变得非常慢，我试图帮助确定大部分执行时间花在哪里以及可以做些什么来加速它。到目前为止，我们一直在试验和测量 LoadRunner、应用服务器日志、Oracle statpack、snoop、调整应用服务器接受器和会话（工作）线程、调整 Hibernate 批量大小和连接提取使用等，但在取得了一些初步成果之后我们正在努力进一步改善问题。

好的，有了对问题的介绍，真正的问题来了：如果你有一个运行缓慢的 Java EE 应用程序，它的 CPU 和内存使用率从未超过 20%，并且在运行 500 多个用户时，你会发现两件事：1)在同一个应用服务器 JVM 进程中甚至请求静态文件都非常慢，并且 2）在应用服务器 JVM 进程之外但在同一个盒子上请求静态文件速度很快，你会调查什么？

我的想法最初跳到应用程序服务器线程，接受者和会话线程，认为即使是对静态文件的请求也在排队，等待可用线程，如果 CPU/内存没有真正被征税，那么更多的线程是有序的. 但后来我们大幅提高了接受者和会话线程，但没有任何改进。

澄清编辑：

1) 静态文件应该由 Web 服务器而不是应用服务器提供。我使用的事实是，在我们的例子中，这（不幸的是）不是配置，因此我可以看到它不执行的文件的应用服务器性能 - 因此不包括任何数据库性能成本等。

2）我认为请求者和应用服务器之间没有代理，但即使有代理，它似乎也不会超载，因为从同一应用服务器机器请求但在应用程序的 JVM 实例之外的静态文件立即返回.

3) JVM 堆大小 (Xmx) 设置为 1GB。

谢谢你的帮助！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T16:01:47.637

SunONE 本身就是个麻烦。我也有同样的问题，你知道吗？将同一个应用程序简单地重新部署到 Weblogic 中，内存消耗和 CPU 消耗减少了大约 30%。

SunONE 是一个参考实现服务器，不应该用于生产（不了解 Glassfish）。

我知道，这个答案并没有真正的帮助，但我注意到即使在非常简单的操作中也会出现相当大的停顿，例如从池中获取 bean 实例。

可能是，尝试在同一台机器上部署 JBoss 或 Weblogic 会给您一个提示吗？

PS你不应该从应用服务器下提供静态内容（虽然我有时也会这样做，当CPU充足时）。

PPS 500 并发用户的负载相当高，我肯定会将 SunONE 放在提供静态内容的缓存代理或 Apache 后面。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-15T08:12:11.797

使用 Sun 性能监控工具后，我们发现垃圾收集器每隔几秒就会运行一次，并且在 1GB 堆中只有大约 100MB 被使用。所以我们尝试添加以下 JVM 选项，到目前为止，这个新配置**大大**提高了性能。

-XX:+DisableExplicitGC -XX:+AggressiveHeap

请参阅[http://java.sun.com/docs/performance/appserver/AppServerPerfFaq.html](http://java.sun.com/docs/performance/appserver/AppServerPerfFaq.html)

我们的教训：不要将 JVM 选项调整和垃圾收集调整留到最后。如果您遇到性能问题，请在故障排除过程的早期查看这些设置。

# javascript - jQuery UI - 我什么时候应该在小部件上使用 destroy 方法

> ID：290394
> 
> 赞同：1
> 
> 时间：2008-11-14T15:19:25.957
> 
> 标签：javascript, jquery, jquery-ui, jquery-ui-plugins

当我将功能附加到一个元素时，我需要**`.widgetName('destroy')`**在从 DOM 中删除它之前调用它还是 jQuery 处理这个？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-14T15:41:03.480

尝试使用[`remove`](http://docs.jquery.com/Manipulation/remove).

我不认为这会自动发生，但话又说回来，我认为您不需要调用该`destroy`方法，因为`event handlers`删除调用会为您销毁该方法。

# python - Django 模板系统：如何解决这个循环/分组/计数？

> ID：290397
> 
> 赞同：3
> 
> 时间：2008-11-14T15:21:32.273
> 
> 标签：python, django, django-templates

我有一个文章列表，每篇文章都属于一个部分。

```
class Section(models.Model):
  name = models.CharField(max_length=200)

  def __unicode__(self):
    return self.name

class Article(models.Model):
  section = models.ForeignKey(Section)
  headline = models.CharField(max_length=200)
  # ... 
```

我想显示按部分分组的文章。

```
赞助、广告和营销
1\. 耐克为所有 18 大学装扮。孟菲斯运动队
2\. 菲尔杰克逊在新奥尔良球馆质疑哈拉斯的标牌
3\. Puma 聘请纽​​约广告代理商 Droga5 领导全球客户
4\. Pizza Patrón 取代必胜客成为 AAC 独家供应商
5\. 市场综述

体育媒体
6\. 新英格兰的许多爱国者队球迷不会看今晚的比赛
7\. ESPN 监察员称网络应该澄清霍尔茨的情况
8\. EA Sports 将在 09 年春季为 Nintendo Wii 推出健身游戏
9\. 博客猎犬：火箭-太阳混战今天的第一话题
10\. 媒体报道

联盟和理事机构
11\. DEI，Chip Ganassi Racing 合并为四车冲刺杯车队
12\. NASCAR 圆桌会议第二部分：讨论新战略、削减开支
13\. NFL 季后赛平均票价下降 10%

```

我想出了如何使用 Django 的模板系统来完成大部分工作。

```
{% regroup articles by section as articles_by_section %}

{% for article in articles_by_section %}    
    <h4>{{ article.grouper }}</h4>
    <ul>
    {% for item in article.list %}  
        <li>{{ forloop.counter }}. {{ item.headline }}</li>
    {% endfor %}
    </ul>
{% endfor %} 
```

我只是不知道如何计算数字。上面的代码将 Sports Media 中的文章编号为 1-5 而不是 6-10。有什么建议么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T16:23:07.327

按照 Jeb 在评论中的建议，我创建了一个[自定义模板标签](http://docs.djangoproject.com/en/dev/howto/custom-template-tags/#writing-custom-template-tags)。

我替换`{{ forloop.counter }}`为`{% counter %}`，一个简单地打印它被调用的次数的标签。

这是我的计数器标签的代码。

```
class CounterNode(template.Node):

  def __init__(self):
    self.count = 0

  def render(self, context):
    self.count += 1
    return self.count

@register.tag
def counter(parser, token):
  return CounterNode() 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T12:33:33.130

这并不完全整洁，但可能适合某人：

```
{% for article in articles %}        
   {% ifchanged article.section %}
      {% if not forloop.first %}</ul>{% endif %}
      <h4>{{article.section}}</h4>
      <ul>
   {% endifchanged %}
          <li>{{forloop.counter}}. {{ article.headline }}</li>
   {% if forloop.last %}</ul>{% endif %}
{% endfor %} 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-14T15:25:47.257

我认为您可以在内部循环中使用 forloop.parentloop.counter 来实现您所追求的编号。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-14T18:50:39.213

您可以只使用有序列表而不是无序列表：

```
{% regroup articles by section as articles_by_section %}

<ol>
{% for article in articles_by_section %}        
    <h4>{{ article.grouper }}</h4>
    {% for item in article.list %}  
        <li>{{ item.headline }}</li>
    {% endfor %}
{% endfor %}
</ol> 
```

# c# - RadioButtonList.SelectedIndex 与 RadioButtonList.SelectedValue

> ID：290402
> 
> 赞同：2
> 
> 时间：2008-11-14T15:22:46.420
> 
> 标签：c#, asp.net

出于好奇，任何人都知道内部实现的细节

```
ListControl.SelectedIndex = (int) <new valueIndex> 
```

VS

```
ListControl.SelectedValue = <new value>.ToString() 
```

我在使用我们在这里构建的自定义验证对象时遇到了困难，以便一次性处理所有验证。我怀疑 using`<SelectedValue = >`会引发一个`SelectedIndexChanged`事件，即使值和索引在操作之前和之后都保持不变。

（ListControl 的值以声明方式填充......）

一如既往，感谢您的宝贵时间！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-12-26T16:37:19.430

`ListItem`中的每个值都`RadioButtonList`应该是唯一的，因此`SelectedValue`表示该唯一值。SelectedIndex 表示列表中项目的索引，与文本/值无关。 `SelectedIndexChanged`仅在值实际更改时触发。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T15:32:11.313

除非用户更改了选定的值/索引并执行了回发，否则不应引发事件 SelectedIndexChanged。

如果您通过代码设置 SelectedIndex 或 SelectedValue，则不会引发 SelectedIndexChanged。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-14T15:47:28.007

并不是说听起来迟钝，但确实如此！;)

该值以编程方式设置为列表，使用：

```
((ListControl)FindControl.("controlName")).SelectedValue = {stringValue} 
```

并且`SelectedIndexChanged`事件被引发，并被我们的委托捕获，从而使输入无效。

操作前后的值和索引都相同。问题是：它是否有可能在.Net 运行时查找值以找到好的值时发生变化？

# security - 是否使用 GUID 安全性虽然默默无闻？

> ID：290405
> 
> 赞同：18
> 
> 时间：2008-11-14T15:23:01.940
> 
> 标签：security, guid, security-by-obscurity

如果您使用 GUID 作为面向公众的应用程序的密码作为访问服务的一种方式，这种安全性是通过默默无闻实现的吗？

我认为显而易见的答案是肯定的，但安全级别对我来说似乎非常高，因为猜测 GUID 的机会非常低，正确吗？

**更新**

GUID 将存储在设备中，插入后，将通过 SSL 连接通过 GUID 发送。

也许我可以生成一个 GUID，然后在 GUID 上执行 AES 128 位加密并将该值存储在设备上？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-14T15:40:04.573

在我看来，答案是否定的。

如果您将密码设置为新创建的 GUID，那么它是一个相当安全的密码：超过 8 个字符，包含数字、字母和特殊字符等。

当然，在 GUID 中 和 的位置是已知的`'{'`，`'}'`以及`'-'`所有字母都是大写的事实。因此，只要没有人知道您使用 GUID，密码就更难破解。一旦攻击者知道他正在寻找一个 GUID，暴力攻击所需的努力就会减少。从这个角度来看，它是*默默无闻的安全*。

不过，请考虑这个 GUID：`{91626979-FB5C-439A-BBA3-7715ED647504}`如果您假设攻击者知道特殊字符的位置，那么他的问题就会简化为查找字符串`91626979FB5C439ABBA37715ED647504`。暴力破解 32 个字符的密码？如果有人发明了一台工作的量子计算机，它只会在你的一生中发生。

这是*通过使用非常、非常长的密码*而不是*晦涩难懂*的安全性。

**编辑：** 阅读丹尼斯轩尼诗的答案后，我必须修改答案。如果 GUID 确实以可解密的形式包含此信息（特别是 mac 地址），则攻击者可以大大减少密钥空间。在那种情况下，它肯定是*obscurity 的安全性*，阅读：*相当不安全*。

当然，MusiGenesis 是对的：有很多工具可以生成（伪）随机密码。我的建议是坚持其中之一。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-14T15:31:53.593

实际上，使用 GUID 作为密码并不是一个好主意（与想出一个等长的真正随机密码相比）。虽然看起来很长，但实际上只有 16 个字节，通常包括用户的 MAC 地址、日期/时间和一个小的随机元素。如果黑客可以确定用户的 MAC 地址，那么猜测他可能生成的 GUID 相对简单。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-11-14T15:26:07.613

如果可以观察到正在发送的 GUID（例如通过 HTTP Auth），那么它的可猜测性就无关紧要了。

一些网站，如 Flickr，使用 API 密钥和密钥。密钥用于通过 MD5 哈希创建签名。服务器使用密钥计算相同的签名并以这种方式进行身份验证。秘密永远不需要通过网络。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-14T15:27:09.797

GUID 是为了防止意外碰撞，而不是故意碰撞。换句话说，您不太可能猜出 GUID，但不一定很难找出您是否真的想猜。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-14T15:29:11.697

起初我准备给出一个不合格的肯定，但这让我思考这是否意味着所有基于密码的身份验证都是默默无闻的安全性。在最严格的意义上，我认为它是，在某种程度上。

但是，假设您有用户使用密码登录并且您没有在任何地方发布该 GUID，我认为用户拥有的安全性较低的密码甚至 sysadmin 密码都超过了风险。

如果您说未受保护的管理页面的 URL 包含硬编码的 GUID，那么答案肯定是肯定的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-14T16:30:19.730

我同意大多数其他人的观点，它比弱密码更好，但最好使用更强大的东西，比如用于这种身份验证的证书交换（如果设备支持它）。

我还将确保您进行某种相互身份验证（即让设备验证服务器 SSL 证书以确保它是您期望的证书）。我很容易抓住设备，将其插入我的系统，并从中读取 GUID，然后将其重放回目标系统。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-15T13:09:47.497

通常，如果您将密钥**嵌入**设备中，或者在身份验证期间**传输**密钥，则会引入安全漏洞。它们的密钥是 GUID 还是密码都没有关系，因为唯一的加密区别在于它们的长度和随机性。在任何一种情况下，攻击者都可以扫描您产品的内存或窃听身份验证过程。

您可以通过多种方式缓解这种情况，每种方式最终归结为增加密钥的模糊性（或保护级别）：

*   在存储之前加密密钥。当然，现在您需要存储*该*加密密钥，但是您已经引入了一定程度的间接性。

*   *计算*密钥，而不是存储它。现在，攻击者必须对您的*算法*进行逆向工程，而不是简单地搜索密钥。

*   在身份验证期间传输密钥的*哈希值*，而不是像其他人建议的那样传输密钥本身，或者使用*质询-响应*身份验证。这两种方法都可以防止密钥以明文形式传输。SSL 也可以做到这一点，但是你依赖于用户来维护一个正确的实现；你已经*失去了对安全的控制*。

与往常一样，无论何时解决安全问题，都需要考虑各种权衡。攻击的**可能性**有多大？如果攻击成功，会有什么**风险？**在开发、支持和可用性方面的安全**成本**是多少？

一个好的解决方案通常是一种折衷方案，可以令人满意地解决这些因素中的每一个。祝你好运！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-14T15:24:57.337

我建议不要使用 GUID 作为密码（除了可能作为稍后更改的初始密码）。任何必须写下来才能记住的密码~~本质上~~都是不安全的。它会被写下来。

**编辑：** “固有地”是不准确的。在评论中查看对话

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-14T15:29:39.853

至少比使用“密码”作为密码要好。

我不认为 GUID 会被视为强密码，并且有许多强密码生成器可以像 Guid.NewGuid() 一样轻松使用。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-14T15:33:00.643

这真的取决于你想做什么。使用 GUID 作为密码本身并不是通过晦涩难懂的安全性（但要注意一个事实，即 GUID 包含 128 个总数中的许多可猜测位：有一个时间戳，一些包括生成它的机器的 MAC 地址等）但真正的问题是您将如何存储该密码并将其传达给服务器。

如果密码存储在从未向最终用户显示的服务器端脚本中，则风险不大。如果密码嵌入到用户下载到自己机器的某个应用程序中，那么您将不得不在应用程序中混淆密码，并且没有办法安全地做到这一点。通过运行调试器，用户将始终能够访问密码。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-14T15:38:34.983

当然，这是默默无闻的安全。但这很糟糕吗？任何“强”密码都是隐蔽的安全性。您指望身份验证系统是安全的，但最终，如果您的密码很容易被猜到，那么身份验证系统的好坏并不重要。因此，您制作了一个“强”和“晦涩”的密码以使其难以猜测。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-14T15:48:07.477

它只是通过默默无闻的安全性，这就是密码的含义。使用 GUID 作为密码的主要问题可能是只使用字母和数字。但是，与大多数密码相比，GUID 相当长。对于详尽的搜索，没有密码是安全的；这很明显。仅仅因为 GUID 可能有也可能没有某种时间戳或 MAC 地址的某种基础，这在某种程度上是无关紧要的。

猜测它和其他东西的概率差异非常小。某些 GUID 可能比其他 GUID 更“容易”（阅读：更快）破解。越长越好。但是，字母表的多样性也更好。但同样，详尽的搜索揭示了一切。

# python - 按谓词过滤 Python 列表

> ID：290424
> 
> 赞同：71
> 
> 时间：2008-11-14T15:30:00.883
> 
> 标签：python

我想做类似的事情：

```
>>> lst = [1, 2, 3, 4, 5]
>>> lst.find(lambda x: x % 2 == 0)
2
>>> lst.findall(lambda x: x % 2 == 0)
[2, 4] 
```

在 Python 的标准库中是否有任何接近这种行为的东西？

我知道在这里自己动手很容易，但我正在寻找一种更标准的方式。

* * *

## 回答 #1

> 赞同：111
> 
> 时间：2008-11-14T15:35:45.940

您可以使用过滤器方法：

```
>>> lst = [1, 2, 3, 4, 5]
>>> filter(lambda x: x % 2 == 0, lst)
[2, 4] 
```

或列表理解：

```
>>> lst = [1, 2, 3, 4, 5]
>>> [x for x in lst if x %2 == 0]
[2, 4] 
```

要找到单个元素，您可以尝试：

```
>>> next(x for x in lst if x % 2 == 0)
2 
```

尽管如果没有匹配项会引发异常，但您可能希望将其包装在 try/catch 中。() 括号使它成为生成器表达式，而不是列表推导。

就个人而言，虽然我只是使用常规过滤器/理解并采用第一个元素（如果有的话）。

如果什么也没找到，这些会引发异常

```
filter(lambda x: x % 2 == 0, lst)[0]
[x for x in lst if x %2 == 0][0] 
```

这些返回空列表

```
filter(lambda x: x % 2 == 0, lst)[:1]
[x for x in lst if x %2 == 0][:1] 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2020-10-21T13:07:44.860

生成器和列表推导比可链接函数更 Pythonic。

```
>>> lst = [i for i in range(1, 6)]

>>> lst
[1, 2, 3, 4, 5]

>>> gen = (x for x in lst if x % 10 == 0)

>>> next(gen, 'not_found')
'not_found'

>>> [x for x in gen]
[] 
```

例如，我有时会这样使用它：

```
>>> n = next((x for x in lst if x % 10 == 0), None)
>>> if n is None:
...     print('Not found')
... 
Not found 
```

否则，您可以像这样定义实用函数 oneliner：

```
>>> find = lambda fun, lst: next((x for x in lst if fun(x)), None)
>>> find(lambda x: x % 10 == 0, lst)
>>> find(lambda x: x % 5 == 0, lst)
5

>>> findall = lambda fun, lst: [x for x in lst if fun(x)]
>>> findall(lambda x: x % 5 == 0, lst)
[5] 
```

# mysql - 多数据库查询的ORM解决方案

> ID：290431
> 
> 赞同：0
> 
> 时间：2008-11-14T15:32:37.693
> 
> 标签：mysql, orm

在 ORM 中，您可以使用如下的语法：

```
my $results = Model.objects.all()[10]; 
```

在 Django ORM 中，它甚至可以很好地处理外键关系和多对多关系。

但是，在 MySQL 中，您可以运行如下查询：

```
SELECT t1.column1
,      t2.column2
,      t3.column3
FROM   db1.table AS t1
,      db2.table AS t2
,      db3.table AS t3
WHERE  t1.id = t2.t1_id
AND    t1.id = t3.t1_id 
LIMIT  0,10 
```

我正在寻找一个可以原生支持这些类型的查询但实际上看不到任何功能的 ORM。

是否有任何现有的 ORM 可以做到这一点？或者有解决这个问题的替代策略吗？

每当我使用 django 之类的框架来构建站点时，我都会将所有内容都保存在同一个数据库中，因为我知道它的局限性。现在我正在处理分布在许多不同数据库中的数据，除了命名空间之外没有明显的原因。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-14T16:12:35.010

可能值得在比 ORM 更低的级别上看一些东西？例如，类似于[C-JDBC](http://c-jdbc.objectweb.org/current/doc/userGuide/html/ar01s10.html)的东西提供了一个“虚拟”数据库驱动程序，它与幕后的数据库集群进行对话。（表可以跨服务器分布）

（我意识到您正在使用 Python，因此只有当您可以在 JVM 上运行 Jython 作为以这种方式集成的平台时，这个特定示例才有用 - 但是我猜可能存在类似的库更适合您的特定要求）

# c++ - 代码生成期间的宏替换

> ID：290436
> 
> 赞同：0
> 
> 时间：2008-11-14T15:34:07.333
> 
> 标签：c++, compiler-construction, macros

目前我有一些遗留代码，它生成操作码。如果代码有更多数量的宏，那么代码生成会花费很多时间（以小时计！！）。我已经完成了逻辑，他们通过搜索宏并替换其中的每个变量来处理宏，例如内联。
有没有一种方法可以在不操作字符串的情况下对其进行优化？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T20:36:30.087

在开始此类过程之前，您**必须标记您的输入。**（我不能高度推荐著名的[龙书](http://en.wikipedia.org/wiki/21st_Century_Compilers)——即使是古代版本也经受住了时间的考验，2006 年的更新版本看起来很棒）。编译是最好分成更小的阶段的工作：如果您的第一阶段对标记执行词法分析，将行拆分为关键字、标识符、常量等，那么查找对宏的引用并查看它们要简单得多在符号表中。（使用 lex 或 flex 之类的工具或它们的现代等效工具之一为您完成这项工作也相对容易，而不是尝试从头开始）。

'线索'似乎是*如果代码有更多数量的宏，那么代码生成需要很多时间*。听起来这个过程在宏的数量上是线性的，这肯定太多了。我假设这个过程一次发生一行（如果您的语言允许，显然这具有巨大的价值，因为您不需要将程序视为一个巨大的字符串），并且伪代码看起来像

```
for(each line in the program)
{
    for(each macro definition)
    {
        test if the macro appears;
        perform replacement if needed;
    }
} 
```

这显然与宏定义的数量成比例。

使用标记化，它看起来像这样：

```
for(each line in the program)
{
    tokenize the line;
    for(each token in the line)
    {
        switch(based on the token type)
        {
            case(an identifier)
                lookup the identifier in the table of macro names;
                perform replacement as necessary;
            ....
        }
    }
} 
```

这主要与程序的大小（而不是定义的数量）成比例 - 符号表查找当然可以使用更优化的数据结构来完成，而不是循环遍历它们，因此不再成为重要因素。第二步是像 yacc 和 bison（以及它们更现代的变体）这样的程序可以愉快地生成代码来做的事情。

**事后思考：**解析宏*定义*时，您也可以将它们存储为令牌流，并标记作为“占位符”名称的标识符以进行参数替换。扩展宏时，切换到该令牌流。（同样，像 flex 这样的东西很容易做到）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-14T15:51:33.880

我有一个应用程序，它有自己的语法。它支持典型编译器支持的所有类型的数据类型（甚至宏）。更准确地说，它是一种编译器，它通过将程序（使用该语法编写）作为输入来生成操作码。为了处理宏，它使用文本替换逻辑例如：

宏添加 (a:int, b:int)

```
int c = a + b 
```

结束宏

// 程序总和

..

整数 x = 10, y = 10;

添加（x，y）；

..

// 程序结束

更换后就会

// 程序总和

..

整数 x = 10, y = 10;

诠释 c = x + y

..

// 程序结束

此文本替换花费了很多时间，即用宏逻辑替换宏调用。有没有最佳的方法来做到这一点？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T19:11:36.987

如果不了解更多的预处理器/解析/编译过程，这真的很难回答。一种想法是将宏名称存储在符号表中。解析时，首先根据该表检查文本标记，如果找到匹配项，则将替换写入新字符串，并通过解析器运行，然后继续解析宏紧括号后的原始文本。

根据您的操作码语法，另一个想法可能是 - 当您在解析时遇到宏定义时，生成操作码，但用占位符代替参数。然后，当解析器遇到对宏的调用时，生成用于评估参数的代码，并将该代码插入到预生成的宏代码中的占位符的位置。

# regex - 如何在正则表达式中禁止数字？

> ID：290449
> 
> 赞同：1
> 
> 时间：2008-11-14T15:37:32.613
> 
> 标签：regex

你好，我正在写一个正则表达式（我可能会在我生命中的第一次添加），但我就是不知道如何做我想做的事。到目前为止，太好了，因为我已经只允许字母和空格（只要它不是第一个字符）现在我缺少的是我不想在字符之间允许任何数字......有人可以帮忙吗请问我？

```
/^[^\s][\sa-zA-Z]+[^\d\W]/ 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-14T15:45:23.893

好的，你需要的是：

```
/^[a-zA-Z][\sa-zA-Z]*$/ 
```

这匹配：

```
^           - start of line
[a-zA-Z]    - any letter
[\sa-zA-Z]* - zero or more letters or spaces
$           - the end of the line 
```

如果你想确保它也以字母结尾，那么再放一个

```
[a-zA-Z] 
```

之前`$`。但是请注意，字符串必须包含至少两个字母（每端一个）才能匹配。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T15:42:46.660

如果您只想允许字母和空格，那么您所拥有的几乎是正确的：

```
/^[a-zA-Z][\sa-zA-Z]*$/ 
```

`$`末尾的 表示字符串的结尾。

*感谢@Alnitak，编辑为正确答案*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-14T20:21:21.760

如果要确保仅在单词之间出现空格，请使用以下命令：

```
/^[A-Za-z]+(?:\s+[A-Za-z]+)*$/ 
```

# ruby-on-rails - 宁静的命令

> ID：290454
> 
> 赞同：5
> 
> 时间：2008-11-14T15:38:41.753
> 
> 标签：ruby-on-rails, ruby, rest

我是 RESTful 的新手。但是，我想在我的 rails 应用程序中使用它。当我将它添加到我的 routes.rb 时，`map.resources :notes`我会创建这些方法的路由：

*   指数
*   创造
*   新的
*   编辑
*   显示
*   更新
*   破坏

我想知道的是编辑/更新和创建/新建有什么区别？这些方法对如何变化以及每个方法的作用是否有任何标准定义？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-14T16:15:15.970

标准定义如下：

*   **index** - GET - 所有（或部分）记录的视图
*   **show** - GET - 单个记录的视图
*   **新**- GET - 要发布以创建的表单
*   **create** - POST - 创建新记录
*   **edit** - GET - 用于编辑单个记录的表单
*   **update** - PUT - 更新记录
*   **destroy** - DELETE - 删除一条记录

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-14T15:58:21.853

当您在 Rails 2 中使用脚手架生成器时，会在提交`create`来自该操作的表单时调用该操作。`new`同样，是在提交`update`来自操作的表单时调用的操作。`edit`

据我所知，您可以将其吹走，并根据对`create/new/edit/update`您的应用程序的意义来定义它们以做任何您想做的事情。

# python - 使用python构建web应用

> ID：290456
> 
> 赞同：8
> 
> 时间：2008-11-14T15:38:56.527
> 
> 标签：python, cgi

这是我大约一周前提出的[两个](https://stackoverflow.com/questions/269417/which-language-should-i-use) [问题](https://stackoverflow.com/questions/271488/linking-languages)的后续。这样做的结果是，我正在构建一个基于 AI 的网络应用程序原型，我想知道使用什么语言。结论似乎是我应该选择 python 之类的东西，然后将任何关键位转换为更快的东西，比如 Java 或 C/C++。

这对我来说听起来不错，但我现在想知道 python 是否真的是用于构建 Web 应用程序的正确语言。我过去开发的大多数 Web 应用程序都是 C/C++ CGI，然后是 php。我发现 php 更容易使用，因为它使将用户界面链接到后端变得更加容易，而且对我来说也更合乎逻辑。

我以前没有使用过 python，但我基本上想知道的是，在 python 中进行 CGI 编程有多容易？我是否必须回到在 C/C++ 中执行此操作的繁琐方式，您必须将 HTML 代码存储在模板中并让 CGI 读取它们并用适当的值替换特殊代码，或者是否可以让模板*成为*与 php 一样的代码？

我可能在这里问了一个非常无知的问题，对此我深表歉意，但希望有人会知道我在说什么！我的总体问题是：用 python 编写 web 应用程序是个好主意吗，它和 php 一样简单吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-14T15:59:24.410

Python 是一个不错的选择。

不过，我会避免使用 CGI 模型 - 您将为每次请求启动解释器支付巨额罚款。大多数 Python Web 框架都支持[WSGI 标准](http://www.wsgi.org/wsgi/)，并且可以通过多种方式连接到服务器，但大多数都存在于 Web 服务器与之通信的某种长期运行的进程中（通过代理、FastCGI、SCGI 等）。

说到框架，Python 环境已经成熟。这既好又坏。有很多不错的选择，但对于新手来说可能会令人生畏。

如果您正在寻找与 web/DB/模板集成预打包的东西，我建议您查看[Django](http://www.djangoproject.com)、[TurboGears](http://www.turbogears.org)或[Pylons](http://www.pylonshq.com)。如果您想更好地控制各个组件，请查看[CherryPy](http://www.cherrypy.org)、[Colubrid](http://wsgiarea.pocoo.org/colubrid/)或[web.py。](http://www.webpy.org)

至于是否“像PHP一样简单”，那是主观的。通常鼓励在 Python Web 编程世界中将模板和应用程序逻辑分开，这可以让你的*生活*更轻松。另一方面，能够在 PHP 文件中编写页面的所有代码是“简单”的另一种定义。

祝你好运。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-14T16:28:03.433

“在 python 中进行 CGI 编程有多容易？” 比 C 更容易，这是肯定的。Python 更容易，因为——简单地说——它是一种比 C 更容易使用的语言。首先，最重要的是：没有内存分配-释放。除此之外，OO 编程模型非常出色。

除了基本的语言简单性之外，Python [WSGI](http://www.wsgi.org/wsgi/)标准比 CGI 标准更容易处理。

然而，与完全简化的全 Python 框架（[TurboGears](http://turbogears.org/)、[CherryPy](http://www.cherrypy.org/)、[Django](http://www.djangoproject.com/)等）的世界相比，原始 CGI 是一个巨大的痛苦。

这些框架强加了很多（必要的）结构。对于 CGI 程序员来说，开箱即用的体验是需要学习的东西太多了。真的。所有新事物都太难学了。但是，价值远远超过投资。

使用 Django，您可以在几分钟内启动并运行。严重地。 `django-admin.py startproject`你有一些几乎可以立即运行的东西。您必须设计您的 URL、编写视图功能和设计页面模板。所有这些都是工作。但它比 C 中的 CGI 工作 *量少。*

Django 具有比 PHP 更好的架构，因为演示模板与处理完全分离。当您想在 Django 框架上使用自由且不受约束的 PHP 样式时，这会导致一些混乱（[当我将 python 代码放入 django 模板时，请参阅语法错误）。](https://stackoverflow.com/questions/276345/syntax-error-whenever-i-put-python-code-inside-a-django-template)

**将用户界面链接到后端**

Python 前端（例如 Django）使用 Python 视图函数。这些视图函数可以包含任何 Python 代码。如有必要，这包括用 C 编写并可从 Python 调用的模块。

这意味着您可以使用 Python 友好的界面编译[CLIPS模块。](http://clipsrules.sourceforge.net/)它变成了你的 Python 代码可以通过`import`语句使用的东西。

然而，有时这样做是无效的，因为您的 Django 页面正在等待 CLIPS 引擎完成。另一种方法是使用命名管道之类的东西。

你有你的基于 CLIPS 的应用程序，完全用 C 语言编写，从命名管道读取。完全用 Python 编写的 Django 应用程序写入该命名管道。因为你有两个独立的进程，你会像这样很快地最大化你的所有核心。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-14T16:08:08.683

我建议使用[Django](http://www.djangoproject.com/)，但鉴于您要求*“与 php 一样简单”，*那么您必须查看 PSP（[Python Server Pages](http://www.modpython.org/live/current/doc-html/pyapi-psp.html)）。虽然 Django 是一个完整的做网站框架，但 PSP 可以像 PHP 一样使用，无需任何框架。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-14T16:17:29.103

在 python 中编写 web 应用程序比在 php 中更容易。特别是因为 python 不是一种损坏的语言。

选择一些支持 mod_wsgi 的 web 框架或推出你自己的框架。WSGI 应用程序在您停止部署后非常容易部署。

如果你想要模板，那么 genshi 是我为 python 找到的最好的模板引擎，你可以随心所欲地使用它。

# c# - 为什么有人会在导航中使用 Button 而不是 LinkBut ton 控件

> ID：290459
> 
> 赞同：1
> 
> 时间：2008-11-14T15:39:22.360
> 
> 标签：c#, .net, web-applications

我正在修改由来自另一个国家的自由.Net 开发人员编写的应用程序中的一些 ui。

我不打算深入探讨代码有多糟糕，并将代码与结构内容和表示纠缠在一起......

但我注意到的一件事是，用于访问应用程序部分的菜单是使用 Button 控件制作的，这些控件发布到服务器并返回不同的页面。我想将按钮更改为 LinkControls 是否有人这样做？

我注意到，当我更改为 LinkBut​​tons 时，实际上有 javascript 似乎触发了发布操作。有什么理由或方法可以避免这种情况？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-14T15:52:53.113

您可以重新设置按钮的样式以使其看起来像链接，然后您可以维护任何服务器端代码，而不必像 LinkBut​​ton 那样依赖 javascript。

```
.linkButton
{
   background-color: transparent;
   border-style: none;
   color: /* Something nice */
   cursor: pointer;
   text-align: left;
   text-decoration: underline;
   display: table-cell;
} 
```

当然，如果这些按钮仅用于导航而没有任何服务器端逻辑，那么好的旧 html 链接就可以了...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-14T15:46:58.883

LinkBut​​ton 就是这样——一个带有 javascript 的锚标记，用于提交页面的表单。如果您不想要这种行为，请不要使用链接按钮。只需使用标准锚标签。

我过去使用过 LinkBut​​tons，因为它是一种非常简单的方法，可以将按钮的行为与常规 html 链接的样式合并。Noobs 也可能会使用它们，因为它是一种创建链接的简单方法，而且他们还不知道更好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T15:50:34.633

如果您想要的只是其属性可以在服务器端操作并且不会回发到服务器的锚点，那么请使用 HyperLink 控件。如果要将点击发布回服务器，请使用 LinkBut​​ton 控件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-14T16:03:29.847

如果您打算使用 Ajax，请记住一件事，如果您计划使用 Ajax 很多 Ajax 解决方案将在 LinkBut​​ton 的 OnClick 事件上插入 javascript，这对于链接来说不是有效的事件。一些浏览器会处理这些代码，例如 Internet Explorer，而另一些浏览器则会忽略它，例如 Firefox。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-14T16:08:07.250

您问什么是链接控件：

简单明了的 Link 控件显示用作服务器端表单处理的超链接的文本。超链接可以指向同一个 ASP.NET 网页上的另一个表单或任何其他 URL。

Link 控件必须放置在 Form 或 Panel 控件中，或者放置在控件的模板中。在 Text 属性中输入链接的文本。使用 NavigateUrl 属性指定链接的目标 URL。

通过数据绑定，您可以动态地为 Link 控件提供属性。因此，它在运行时才能确定的特定场景下具有相当大的可扩展性。

# api - 有人可以解释 Flickr API 以及如何建立安全性吗？为什么不使用 AES 而不是 md5？

> ID：290460
> 
> 赞同：0
> 
> 时间：2008-11-14T15:39:39.943
> 
> 标签：api, encryption, flickr

只是想了解 Flickr 的 API 设置，以及它的安全性。

[Flickr API](http://www.flickr.com/services/api/auth.howto.web.html)

为什么要使用 MD5 散列而不是 AES？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T15:43:10.327

散列严格来说是一个签名，因此像 MD5 这样的单向散列足以满足它们的使用。如果发生冲突（不太可能但可能），他们只会重新散列。

没有必要让它变得更复杂。

# automation - 如何以便宜/免费的方式设置构建服务器？

> ID：290464
> 
> 赞同：2
> 
> 时间：2008-11-14T15:40:50.377
> 
> 标签：automation, build-automation, build-server

目前我的任务是进行日常构建。我们有一个带有 SQL Server 2005 后端的 ASP.NET 2005 网站。我们当前的源代码控制是 Visual Source Safe 2005。

在这一点上，我使用日常构建的蛮力方法。

1.  获取最新版本的源代码
2.  获取最新版本的数据库发布脚本
3.  将旧网站文件备份到目录
4.  将新代码发布到我的本地机器
5.  在我的服务器上运行以保持测试/阶段站点正常工作
6.  将新创建的文件推送到网站
7.  在测试数据库上运行 SQL 脚本（假设更新，否则我不打扰）
8.  测试服务器上的测试网站。

看到自动化构建的想法让我很感兴趣，因为这意味着我每天早上做的更少。你会建议我如何进行？在我把它介绍给我的老板之前，我想有一个完整的想法。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-14T15:48:50.033

[抛弃 VSS，转移到 Subversion，然后查看 CruiseControl.NET。](http://jamesstory.wordpress.com/category/automated-builds/) 或者，如果您拥有 MSDN 开发人员许可证，则可以运行 TFS 工作组版并在任何旧 XP 机器上设置构建服务器。这是我们在我们的商店所做的。

* * *

Assaf 指出，您可以直接将 CC.NET 与 VSS 一起使用。好的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-14T15:51:32.727

[TeamCity](http://www.jetbrains.com/teamcity/)对我来说效果很好。它有一个非常简单的设置。将它与用于您的操作的 MsBuild 脚本结合起来，您就可以自动完成操作了。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-14T16:38:21.587

对于构建管理，我全心全意地推荐 TeamCity。它不需要 IIS6（就像 CC.net 一样），因为它运行在自己的 Tomcat 副本上，并且设置都是通过各种形式完成的。这对我来说很重要，因为构建服务器只是一个 XPPro 盒子。它与 SVN 很好地集成，并且没有像 CruiseControl.Net 那样疯狂的 XML 文件操作。对我来说是大胜利。

对于构建运行器，我们使用 NAnt 向不同的人发送电子邮件，将打包的构建复制到他们应该去的地方，运行 NUnit 和 NCover，并将软件部署到我们的网络农场。

对于自动化测试，我们使用 Watin。

[http://www.nunit.org/index.php](http://www.nunit.org/index.php) [http://www.jetbrains.com/teamcity](http://www.jetbrains.com/teamcity) [http://ncover.sourceforge.net/](http://ncover.sourceforge.net/) [http://subversion.tigris.org/](http://subversion.tigris.org/) [http://nant. sourceforge.net/](http://nant.sourceforge.net/) [http://watin.sourceforge.net/](http://watin.sourceforge.net/)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-14T15:49:31.093

试试 CruiseControl.Net。它是免费的，无论您希望它执行什么自定义的日常/连续例程，您都可以随时添加脚本。

请记住，这不仅仅是每天（每晚）构建，还包括让您及时发现构建错误（因为它在每次源提交/签入后不断构建）。您不一定要在每个可能的平台上测试每个代码机会并构建配置，但 CC 可以为您完全做到这一点（在后台）。

* * *

[http://confluence.public.thoughtworks.org/display/CCNET/Visual+Source+Safe+Source+Control+Block](http://confluence.public.thoughtworks.org/display/CCNET/Visual+Source+Safe+Source+Control+Block)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-14T15:48:18.350

您所做的所有事情都可以通过一组批处理文件来执行，具体取决于您的测试环境的自动化程度。主批处理文件可以在午夜或其他任何时间作为“计划任务”启动。这就是我们在这里和我工作过的其他地方“便宜”的方式。如果您需要特定批次的帮助，我可以提供样品。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-14T15:59:22.210

我第二（或第三）推荐 Subversion/CruiseControl.net。此外，如果合适，请查看 SVN 的托管服务，例如 CVSDude。在此过程中，您可能也会精通 MSBuild。一旦你得到它设置它是伟大的。

成本不一定来自工具甚至硬件的许可，而是来自您构建和维护系统的时间 - 并且取决于您在做什么，这可能会变得很重要。

从基础开始，随着时间的推移逐步改进。像其他任何事情一样，如果您尝试使用大量自动化和功能走出大门，您可能会发现自己陷入了数周的全职困境。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-23T18:18:34.767

无论您使用什么工具，都将它们存放在虚拟机（即 vmware）中。

当设备不可避免地出现故障时，您可以将映像复制到任何机器上而不会错过任何一个节拍，因为您的构建服务器决定休息一天，当然前提是您备份了。

# vim - 如何粘贴而不覆盖寄存器

> ID：290465
> 
> 赞同：129
> 
> 时间：2008-11-14T15:40:57.913
> 
> 标签：vim, vi

有谁知道在不将选择放置在默认寄存器中的情况下粘贴视觉选择区域的方法？

我知道我可以通过始终从显式寄存器粘贴来解决问题。但是打字是一件很痛苦的事情，`"``x``p`而不仅仅是`p`

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2011-02-23T15:52:05.583

使用以下内容：

```
xnoremap p pgvy 
```

这将重新选择并重新拉出以可视模式粘贴的任何文本。

编辑：为了与您一起使用，`"xp`您可以执行以下操作：

```
xnoremap p pgv"@=v:register.'y'<cr> 
```

`v:register`扩展为正常模式命令中使用的最后一个寄存器名称。

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2009-05-01T16:33:46.963

我不喜欢将使用`d`, `D`,`c`或删除的所有文本复制`C`到默认寄存器中的默认 vim 行为。

我已经通过映射`d`到`"_d`、`c`到`"_c`等来解决它。

从我的.vimrc：

```
"These are to cancel the default behavior of d, D, c, C
"  to put the text they delete in the default register.
"  Note that this means e.g. "ad won't copy the text into
"  register a anymore.  You have to explicitly yank it.
nnoremap d "_d
vnoremap d "_d
nnoremap D "_D
vnoremap D "_D
nnoremap c "_c
vnoremap c "_c
nnoremap C "_C
vnoremap C "_C 
```

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2008-11-14T17:00:32.260

`"{register}p`不会像你描述的那样工作。它将用寄存器的内容替换选择。您将不得不执行以下操作：

```
" I haven't found how to hide this function (yet)
function! RestoreRegister()
  let @" = s:restore_reg
  return ''
endfunction

function! s:Repl()
    let s:restore_reg = @"
    return "p@=RestoreRegister()\<cr>"
endfunction

" NB: this supports "rp that replaces the selection by the contents of @r
vnoremap <silent> <expr> p <sid>Repl() 
```

只要您不使用对 p 具有非 nore vmap 并且期望寄存器被覆盖的插件，这应该没问题。

[此代码在此处](https://github.com/LucHermitte/lh-misc/blob/master/plugin/repl-visual-no-reg-overwrite.vim)作为脚本提供。Ingo Karkat 还定义了一个[插件](http://www.vim.org/scripts/script.php?script_id=2703)来解决同样的问题。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2015-07-14T16:10:14.447

在你的`.vimrc`

```
xnoremap p "_dP 
```

我从类似线程的回复中找到了这一点，但原始来源是[http://vim.wikia.com/wiki/Replace_a_word_with_yanked_text](http://vim.wikia.com/wiki/Replace_a_word_with_yanked_text)。它提到了一些缺点，但是对我来说效果很好。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2012-11-21T12:05:34.587

Luc Hermitte 的解决方案很有魅力。我使用它大约一个星期左右。然后，我从[Steve Losh 的 .vimrc](https://github.com/sjl/dotfiles/blob/eea18b00b8c74943f5094fddf91d3c2a7e0a7242/vim/vimrc#L1294)中发现了一个解决方案，如果 YankRing 是您的插件/捆绑包阵容的一部分，该解决方案效果很好：

```
function! YRRunAfterMaps()                                                                                                      
    " From Steve Losh, Preserve the yank post selection/put.    
    vnoremap p :<c-u>YRPaste 'p', 'v'<cr>gv:YRYankRange 'v'<cr> 
endfunction 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2013-03-07T09:00:09.630

在你的试试这个`~/.vimrc`：

```
xnoremap <expr> p 'pgv"'.v:register.'y' 
```

*   `xnoremap`意味着这仅适用于`Visual`模式，而不适用于`Visual + Select`模式。

*   `<expr>`表示设置`{rhs}`的`xnoremap {lhs} {rhs}`值被评估为表达式。

*   在这种情况下，我们的表达式`'pgv"'.v:register.'y'`是`.`用于连接。

*   `v:register`被评估为在完成映射期间正在使用的寄存器。

的结果`"xp`将评估为，寄存器`pgv"xy`在哪里。`x`

对这个 stackoverflow 问题的回答帮助了我：[Vim - mapping with an optional register prefix](https://stackoverflow.com/questions/9954866/vim-mapping-with-an-optional-register-prefix#answer-9957686) and [Benoit](https://stackoverflow.com/users/457352) 's answer [on this page](https://stackoverflow.com/questions/290465/vim-how-to-paste-over-without-overwriting-register/290723#answer-5093286)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2010-12-15T04:10:42.427

在我进行更改以支持我设置了剪贴板=未命名的事实后，Luc 的功能对我来说效果很好：

```
function! RestoreRegister()
    let @" = s:restore_reg
    if &clipboard == "unnamed"
        let @* = s:restore_reg
    endif
    return ''
endfunction 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-10-07T09:29:05.933

Luc Hermitte 成功了！真的很好。这是他的解决方案，它带有一个切换功能，因此您可以在正常行为和无替换寄存器放置之间切换。

命令 ,u 切换行为

```
let s:putSwap = 1 
function TogglePutSwap()
    if s:putSwap
        vnoremap <silent> <expr> p <sid>Repl()
        let s:putSwap = 0 
        echo 'noreplace put'
    else
        vnoremap <silent> <expr> p p 
        let s:putSwap = 1 
        echo 'replace put'
    endif
    return
endfunction
noremap ,p :call TogglePutSwap()<cr> 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-02-03T03:28:34.473

胶带编程，但对我有用：

```
nmap viwp viwpyiw
nmap vi'p vi'pyi'
nmap vi"p vi"pyi"
nmap vi(p vi(pyi(
nmap vi[p vi[pyi[
nmap vi<p vi<pyi< 
```

* * *

## 回答 #10

> 赞同：-4
> 
> 时间：2008-11-14T15:58:48.763

尝试 -

```
:set guioptions-=a
:set guioptions-=A 
```

# sql-server-2005 - SQL Server Express 空闲模式部分数据返回？

> ID：290469
> 
> 赞同：0
> 
> 时间：2008-11-14T15:41:41.030
> 
> 标签：sql-server-2005, sql-server-2005-express

我正在尝试帮助我们的网络工程师为我们的一位客户解决问题。该客户从名副其实的“夫妻店”供应商处购买了一个销售点系统，并表示供应商推荐 SQL Server Express 2005 作为后端数据库，以使客户免于产生额外的许可费用。（请不要让我开始这样做**！**）

我们没有编写应用程序，因为它是一个商业应用程序，所以我们没有可用的源代码。（并不是说如果我们这样做了会对我们有所帮助；这个东西是在 PowerBuilder 中构建的，所以我们没有工具。）该应用程序没有自己的日志记录，这是我们可以确定的。我们所要做的就是 SQL Server Express 自己的日志记录。

在应用程序中，最终用户刷会员卡。偶尔（一天几次），滑动不会从数据库返回数据。屏幕上的消息将显示“未找到成员 123”。（会员编号实际上是六位数字，“000123”。） 之后立即重新扫描正确返回会员数据。

我们已经消除了扫描仪本身作为问题的根源——它会定期扫描完整的六位数号码。对 SQL Server Express 日志的扫描表明它正在从空闲状态重新联机，通常是在扫描时（但也可能在每天的其他几次）。[（这里解释了](http://blogs.msdn.com/sqlexpress/archive/2008/02/22/sql-express-behaviors-idle-time-resources-usage-auto-close-and-user-instances.aspx)空闲模式。）

我知道以 SQL Express 的方式分配/取消分配 RAM 是一个耗时的过程，尤其是当我们一次谈论数百兆字节时——似乎就是这种情况。

我们不确定的是我们是否正在取回部分数据，或者应用程序是否只是无法连接到数据库并显示一般错误消息。由于一切都是如此不透明，并且客户（出于显而易见的原因）不愿意付钱让我们在他们的设施中坐 8 个小时左右来亲眼目睹它的发生（也许使用网络监控/数据包嗅探工具），我们有点不知所措。

此时，我们的建议是客户端升级到具有 5 个 CAL 的 SQL Server 2005 Workgroup Edition。但这并不完全适合我作为*这个问题**的*解决方案，因为我有理由确定没有 SQL Server 会返回部分数据——如果你无法连接，你就无法连接。（也就是说，我仍然推荐它，因为它*可以*解决他们的许多其他问题！）

 **我对 Express 没有太多经验。（除了本地开发，我从不使用它，而且只在家里使用；我当然从不向我的客户推荐它。）

对于那些可能有 Express 经验的人，我的问题是，您是否见过 SQL Express 的实例返回*部分*数据，而应用程序本身不是它的原因？具体来说，您从空闲模式返回时是否看到过这种行为？

（对于它的价值，我们倾向于认为应用程序无法连接并且仅显示一般错误消息，当它连接时会在成员 ID 上删除前导零。这似乎是最合理的答案 - 第三个问题可能是，你们同意这个评价吗？）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-04T05:10:39.393

我从未听说过或体验过 SQL Server Express 返回部分数据。它本质上与完整的 SQL Server 具有相同的代码库。

由于 SQL Server Express 处于空闲状态，应用程序更有可能遇到超时（默认为 30 秒）。应用程序可能会收到一个它没有预料到的超时并且不能很好地处理它。

此论坛主题讨论了问题和可能的解决方案：http: [//social.msdn.microsoft.com/forums/en-US/sqlexpress/thread/a8fbf8d6-9949-47a5-a32b-50f8131f1127/](http://social.msdn.microsoft.com/forums/en-US/sqlexpress/thread/a8fbf8d6-9949-47a5-a32b-50f8131f1127/)

我怀疑您的连接字符串如下所示：

```
Data Source=.\SQLEXPRESS; Integrated Security=True;AttachDbFilename=|DataDirectory|\myDatabase.mdf;User Instance=True 
```

从引用的线程：

> 此连接字符串将导致与主实例 (.\SQLEXPRESS) 的初始连接，然后指示主实例在用户上下文下生成 SQL Server 的新实例，并将指定的数据库附加到该新用户实例。用户实例是一个完全独立的 SQL Server 运行实例，与用户唯一的主实例相比，当不再有任何连接时将关闭该实例。
> 
> 这与将数据库附加到主实例完全不同，主实例始终保持运行，除非您手动将其关闭。如果您的问题是关于主实例进入空闲状态，那么您的问题不是 SQL Express 独有的，您应该在数据库引擎论坛中提出这个问题。我相信所有版本的 SQL Server 都有空闲状态，而其他论坛将是您可以了解如何影响该行为的地方。

# .net - 只读访问数据源

> ID：290475
> 
> 赞同：3
> 
> 时间：2008-11-14T15:43:20.950
> 
> 标签：.net, database, ms-access, permissions

我们有一个使用 MS Access 的主要 VB6 交易应用程序（不要问！）它总是将交易爆破到 MS Access 数据库中。

这里的其他基础设施已经有了很大的发展，我想定期阅读这个 Access 数据库并将任何新交易复制到 SQL 服务器数据库中。

执行此操作所需的 SQL 和 C# 非常简单。

但我想确保我这样做不会锁定 Access 数据库或导致 VB6 应用程序出现问题。换句话说，当从 Access 填充我的 DataTable 时，我不想锁定数据库并阻止 VB6 应用程序写入它。我似乎记得从旧的 ADO 中可以使用一些共享模式来实现此目的。

我应该使用 .NET 中的哪种连接字符串来完成此操作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T16:07:28.513

为了建立马特的答案，我建议将 adOpenForwardOnly 和 adLockReadonly 组合起来： ForwardOnly 因为您只需将这些交易插入到 SQL Server 中，而 Readonly 则不会锁定其他进程（还有什么会影响这些表？）。幸运的是，这些是默认选项。:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-16T21:26:25.733

You have multiple solutions for that like opening read-only recordsets through ADO(OLEDB) connections. These recordsets can even be locally saved/archived as xml files for further use.

But the most trivial solution would be to make a copy of your original mdb file (which can be done at any time even if some of the tables are locked). You can then do whatever you want with the copied database, without any risk of interference with the running VB6 application.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T15:55:42.047

只是一个想法……但是您是否考虑过升级数据库，以便表本身实际上存储在 SQL Server 中，而 Access 只是成为前端？已经有一段时间了，但如果我没记错的话，Access 应该有一个向导（糟糕！）来帮助您执行此操作。

使用旧的 ADO，您可以将光标或锁定类型机制设置为以下之一：

**光标类型**

***adOpenForwardOnly***这种类型的游标只能用于在记录集中向前移动。当要填充列表框或组合框时使用此选项。

***adOpenKeyset***当我们期望有一个大的记录集时，这是最好的游标类型，因为当对可能影响记录集的数据进行更改时，我们不会收到通知。

***adOpenDynamic***这个游标允许我们查看其他用户所做的影响我们记录集的所有更改。它是最强大的游标类型，但速度最慢。

***adOpenStatic***当我们有一个小的记录集时，静态游标很有用。

**锁型**

***adLockReadonly***当不允许从记录集中添加、更新或删除时使用此锁定模式

***adLockPesimistic***在悲观锁定中，记录在编辑开始时被锁定并保持锁定直到编辑完成。

***adLockOptimistic***这发生在对记录调用更新方法时。即使在编辑时记录也被解锁，但在将更改保存到数据库时暂时锁定

***adLockBatchOptimistic***此选项允许我们在更新一批记录时执行乐观锁定

不确定这如何准确地转化为 .NET 世界……但也许这可以让您指出正确的方向。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-14T16:03:21.173

连接到数据库的第一个用户确定在该数据库打开期间使用的锁定模式。

将连接字符串中的模式设置为“读取”应该可以解决问题。

```
"Data Source=C:\IronSpeed\TestAccessDB\TestTypes.mdb;
Jet OLEDB:Database Locking Mode=1;
Mode=Read" 
```

一些可能有帮助的链接。

*   [连接字符串设置的体面解释](http://www.ironspeed.com/Designer/3.1.0/WebHelp/Part_IX/appSettings_Element.htm)
*   [页级锁定与记录级锁定](http://msdn.microsoft.com/en-us/library/aa189633.aspx)
*   [OLEBD 提供程序](http://msdn.microsoft.com/en-us/library/ms810660.aspx)

# php - 我应该为上传的文件设置什么文件权限

> ID：290483
> 
> 赞同：2
> 
> 时间：2008-11-14T15:45:44.750
> 
> 标签：php, upload, permissions

我有一个处理文件上传的 PHP 脚本。该脚本会尝试组织上传的文件，并可能会创建新文件夹以在需要时将文件移动到其中。这些文件将位于 www 根目录下（即，网络浏览器将能够访问它们）。

我的问题是，我应该为创建的文件夹和移动到其中的文件（使用`mkdir()`and `move_uploaded_file()`）设置什么权限？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-14T16:10:41.300

您的网络服务器需要在这些文件夹中读取和写入权限，执行权限应该被撤销（假设类 UNIX 系统）。如果没有，用户可以上传一个脚本并通过发送一个 HTTP 请求来执行它。

但 IMO 的整个概念是一个潜在的安全漏洞。最好将文件存储在网络服务器根目录*之外*的文件夹中，这样就无法直接访问。在您的 Web 应用程序中，您可以拥有一个 PHP 下载页面，该页面会扫描上传目录并显示下载链接列表。这些下载链接指向另一个脚本，该脚本从您的存储目录中读取文件并将它们发送给用户。

是的，这是更多的工作。但是这种场景很常见，所以你应该能够很容易地找到一些带有示例实现的源代码。而且让你的服务器被黑客入侵的工作要少得多......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T23:45:42.173

具体回答766（无执行权限）将是您想要使用的最宽松的。在另一端，700 将允许除了网络用户之外的任何人都无法处理该文件。但实际上，这一切都取决于您对确定最佳结果的文件所做的事情。

# c++ - C++ 中的简单文本菜单

> ID：290484
> 
> 赞同：0
> 
> 时间：2008-11-14T15:46:21.550
> 
> 标签：c++, text, lambda, menu, closures

我正在用 C++ 编写一个愚蠢的小应用程序来测试我的一个库。我希望应用程序向用户显示命令列表，允许用户键入命令，然后执行与该命令关联的操作。听起来很简单。在 C# 中，我最终会编写一个命令列表/映射，如下所示：

```
 class MenuItem
    {
        public MenuItem(string cmd, string desc, Action action)
        {
            Command = cmd;
            Description = desc;
            Action = action;
        }

        public string Command { get; private set; }
        public string Description { get; private set; }
        public Action Action { get; private set; }
    }

    static void Main(string[] args)
    {
        var items = new List<MenuItem>();

        items.Add(new MenuItem(
            "add",
            "Adds 1 and 2",
            ()=> Console.WriteLine(1+2)));
    } 
```

关于如何在 C++ 中实现这一点的任何建议？我真的不想为每个命令定义单独的类/函数。我可以使用 Boost，但不能使用 TR1。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-14T15:52:47.217

一种非常常见的技术是使用函数指针或 boost::function，由项目名称索引，或者通过它们的向量并按项目索引进行索引。使用项目名称的简单示例：

```
void exit_me(); /* exits the program */
void help(); /* displays help */

std::map< std::string, boost::function<void()> > menu;
menu["exit"] = &exit_me;
menu["help"] = &help;

std::string choice;
for(;;) {
    std::cout << "Please choose: \n";
    std::map<std::string, boost::function<void()> >::iterator it = menu.begin();
    while(it != menu.end()) {
        std::cout << (it++)->first << std::endl;
    }

    std::cin >> choice;
    if(menu.find(choice) == menu.end()) {
        /* item isn't found */
        continue; /* next round */
    }   

    menu[choice](); /* executes the function */
} 
```

C++ 还没有 lambda 特性，所以很遗憾，你真的必须使用函数来完成这项任务。您可以使用 boost::lambda，但请注意它只是模拟 lambda，远不如原生解决方案强大：

```
menu["help"] = cout << constant("This is my little program, you can use it really nicely"); 
```

注意常量（...）的使用，否则 boost::lambda 不会注意到这应该是一个 lambda 表达式：编译器会尝试使用 std::cout 输出字符串，并分配结果 (一个 std::ostream 引用）到 menu["help"]。你仍然可以使用 boost::function，因为它会接受所有返回 void 并且不带参数的东西——包括函数对象，这是 boost::lambda 创建的。

如果你真的不想要单独的函数或 boost::lambda，你可以打印出一个项目名称的向量，然后`switch`在用户给出的项目编号上。这可能是最简单、最直接的方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-14T16:19:49.253

为什么不直接将 C# 代码移植到 C++？有一些工作要做，但这样的事情应该可以完成大部分工作：

```
using std::string;
class MenuItem    
{        
    public:
        MenuItem(string cmd, string desc, boost::function<bool()> action):Command(cmd),
                                                                          Description(desc),
                                                                          Action(action) 
        {}
        boost::function<bool()> GetAction() { return Action; }
        string GetDescription() { return Description; }
        string GetCommand() { return Command; }
    private:
        string Command;
        string Description;
        boost::function<bool()> Action;
} 
```

定义好之后，您的 main() 可以使用 std::list，并使用简单的 while() 循环检查 MenuItem 的 Action 的退出值以确定它是否应该退出。

# c++ - 此代码是否删除文件扩展名？

> ID：290488
> 
> 赞同：4
> 
> 时间：2008-11-14T15:47:13.623
> 
> 标签：c++, c

这不是我的代码；我试图弄清楚这到底是做什么的。这是一个用 C 语言编写的大型古老系统的一部分（实际上它是 4 年前编写的，但很可能是由 80 年代后期的程序员编写的）。部分代码：

```
char DestFile[256];
char DestFile2[256];

//This part is just to show an example
strcpy(DestFile, "/foo/boo/goo.gz")

strcpy ( DestFile2, DestFile );
Ptr = strrchr ( DestFile2, '.' );
if ( Ptr != 0 ) {
   if ( ( strcmp ( Ptr, ".gz" ) == 0 ) ||
        ( strcmp ( Ptr, ".Z" ) == 0 ) ) {
       *Ptr = 0;
       rename ( DestFile, DestFile2 );
    }
} 
```

DestFile2 未在函数的其他任何位置设置。我编译了上面的代码，打印出 DestFile 显示没有任何变化。我唯一能想到的就是删除文件扩展名（* Ptr = 0），但我对C的了解非常有限......

有任何想法吗？看起来每次获取带有 .gz 或 .z 的文件时，它都会将文件重命名为相同的名称。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-14T15:53:11.693

你是对的。

在 C 中，字符串是由 ASCII 码 0 的字符终止的字符数组。

因此，首先，将 DestFile 复制到 DestFile2

然后从右侧执行扫描，以找到最右侧出现的“.”。这将返回一个指向匹配的 char 的指针，如果没有找到匹配项，则返回 null。

所以现在你有了（示例名称：myfile.gz）

目标文件2

> ```
>  |- Ptr
>               v    
>   M y f i l e . g z \0 
> ```

然后它比较从 Ptr 开始的字符串是否与 .Z 或 .gz 匹配，如果是，则将 Ptr 指向的字符的值设置为 \0，从而有效地截断字符串。

将 Ptr 设置为 \0 后，您现在拥有

> 我的文件\0 gz \0

请记住，当我们到达 \0 时，c 认为字符串已完成，因此最后一个重命名有效地表示

```
rename("myfile.gz", "myfile"); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T15:58:39.483

是的，在我看来也是这样。它正在重命名任何 .gz 或 .Z（gzip 或 Unix 压缩文件）以删除扩展名。

为什么它会想要这样做让我失望。我见过做这些事情的唯一用途是绕过不允许压缩附件通过的法西斯电子邮件服务器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T20:16:06.217

也许“.gz”扩展名要像“.tar.gz”一样被删除，以使扩展名变得简单，比如DOS或其他什么？其实我看不出来。再说一次，如果复合扩展甚至一开始就可用，那可能就不是了。

# asp.net - 图片下拉列表

> ID：290493
> 
> 赞同：2
> 
> 时间：2008-11-14T15:47:39.223
> 
> 标签：asp.net, jquery

我正在寻找一个下拉列表，它可以向用户展示一系列可供选择的图像。每张图像大约为 50x50 像素，图像下方将有一个小文本描述。jQuery 和兼容的 ASP.NET 解决方案将是首选。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-16T20:05:07.923

我写了一个超级基本的 jQuery 插件来完成这个。将会发生的是从现有的选择标签创建一个虚假的下拉列表。原来的选择将被隐藏，假菜单将被显示。在创建新菜单时，它会回调以获取要为每个选项显示的 HTML。在此函数中，您可以传回图像。

```
(function($) {
$.fn.templatedSelect = function(options) {

var defaults = {
    selectHandleImage : "selectHandle.gif",
    width : "65px",
    getOption : function(value, text) {
            return text;
        }
};
var opts = $.extend(defaults, options);

    var $originalSelect = this;

    var $container = $(document.createElement('div'))
        .css("clear", "both")
        .css("width", opts.width)
        .hover(
            function () {
                $selectBox.css("border-color", "#000000");
            }, 
            function () {
                if (!$menuItems.is(":visible"))
                    $selectBox.css("border-color", "#C0C0C0");
            })
        .attr('id', "imageSelect_container_" + this.attr('id'));

    var $selectBox = $(document.createElement('div'))
        .css("border", "solid 1px #C0C0C0")
        .css("overflow", "hidden")
        .css("width", "100%")

    var $selectedItem = $(document.createElement('div'))
        .css("padding", "4px");

    var $selectHandle = $(document.createElement('div'))
        .css("float", "right")
        .css("background-color", "#F0F0F0")
        .css("padding", "4px") 
        .css("cursor", "hand")          
        .click(function(e) {
            ToggleMenuItems();
        })
        .html(
            $(document.createElement('img')).attr("src", opts.selectHandleImage)
        );

    var $menuItems = $(document.createElement('div'))
        .css("position", "absolute")
        .css("margin-top", "-1px")
        .css("border", "solid 1px #000000")
        .css("background-color", "#FFFFFF")
        .hide();

    $originalSelect.children("option").each(function(i, selected) {   
        var $menuItem = $(document.createElement('div'))
            .css("padding", "4px")
            .html(opts.getOption($(this).val(), $(this).text()))
            .val($(this).val())
            .click(function(e) {
                ToggleMenuItems();
                $originalSelect.val($(this).val());
                $selectedItem.html($(this).html());
            })
            .hover(
                function () {
                    $(this).css("background-color", "#81BEF7");
                }, 
                function () {
                    $(this).css("background-color", "#FFFFFF");
                })
            .appendTo($menuItems);
    });

    //preset the selectedItem
    $selectedItem.html(
        $menuItems.children("div:eq("+$originalSelect[0].selectedIndex+")").html()
    );

    //put everything together
    $selectBox.appendTo($container);
    $selectHandle.appendTo($selectBox);
    $selectedItem.appendTo($selectBox);
    $menuItems.appendTo($container);

    //hide the original select and put ours in
    $originalSelect.hide();
    $container.insertBefore($originalSelect);

    $selectHandle.height($selectBox.height());
    $menuItems.width($selectBox.width());

    function ToggleMenuItems() {
        if ($menuItems.is(":visible")) {
            $menuItems.hide();
            $selectBox.css("border", "solid 1px #C0C0C0");
        } else {
            $menuItems.show();
            $selectBox.css("border", "solid 1px #000000");
        }
    }

}})(jQuery); 
```

要使用，请在现有选择上调用 templatedSelect。还传入一个函数来解析每个项目的模板

```
 $().ready(function() {
        $('#selectId').templatedSelect({
            getOption : function(v, t) {
                return "<img src='" + v + "'/><br/>" + t; 
            }
        }); 
```

# unix - 如何根据令牌拆分文件？

> ID：290503
> 
> 赞同：1
> 
> 时间：2008-11-14T15:49:30.610
> 
> 标签：unix, command-line, awk

假设您有一个文件，其中包含由 $ 分隔的文本（从 1 到 N）如何分割文件以使最终结果是 N 个文件？

> text1 带换行符 $
> text2 $etc... $
> textN

我正在考虑使用 awk 或 sed 的东西，但是是否有任何可用的 unix 应用程序已经执行了这种任务？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-14T18:11:25.317

> awk '开始{RS="$"; ORS=""} { textNumber++; 打印 $0 > "text"textNumber".out" }' 文件名

感谢比尔卡尔文的想法。

编辑：添加 ORS="" 以避免在每个文件的末尾打印换行符。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-14T15:53:02.240

也许`split -p` *模式*？

唔。这可能不是你想要的。它不会分割一行，它只会在看到模式时启动一个新文件。而且它似乎只在 BSD 相关系统上受支持。

你可以使用类似的东西：

```
awk 'BEGIN {RS = "$"} { ... }' 
```

**编辑：**您可能会在这里找到该`{ ... }`部分的一些灵感：

[http://www.gnu.org/manual/gawk/html_node/Split-Program.html](http://www.gnu.org/manual/gawk/html_node/Split-Program.html)

**编辑：**感谢 dmckee 的评论，但`csplit`似乎也复制了出现模式的整行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-14T16:32:28.230

如果我没看错的话，可以使用UNIX [cut命令。](http://www.manpagez.com/man/1/cut/)

```
cut -d $ -f 1- filename 
```

我的语法可能略有偏差，但这应该告诉 cut 您正在使用 $ 分隔字段并从末尾返回字段 1。

您可能需要转义 $.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-01-06T07:31:32.293

```
awk -vRS="$" '{ print $0 > "text"t++".out" }' ORS="" file 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-01-06T11:46:16.947

使用 split 命令，我们可以使用字符串进行拆分。

但是 csplit 命令也允许您根据正则表达式分割文件。

# regex - 数值的正则表达式模式

> ID：290513
> 
> 赞同：62
> 
> 时间：2008-11-14T15:51:59.980
> 
> 标签：regex

我需要一个正则表达式模式来只接受正整数。它也可以接受一个零。

我不想接受小数、负数和带前导零的数字。

有什么建议么？

* * *

## 回答 #1

> 赞同：108
> 
> 时间：2008-11-14T15:58:28.580

```
^(0|[1-9][0-9]*)$ 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-11-14T15:56:02.593

" `[1-9][0-9]*|0`"

我只是用“ `[0-9]+`”来表示正整数。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2011-11-15T19:37:03.467

**这将允许不**以零开头的十进制数（或整数） ：

```
^(([1-9]*)|(([1-9]*)\.([0-9]*)))$ 
```

如果你想允许以零开头的数字，你可以这样做：

```
^(([0-9]*)|(([0-9]*)\.([0-9]*)))$ 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-14T15:55:57.303

```
/([1-9][0-9]*)|0/ 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-14T15:56:02.063

```
/^0|[1-9]\d*$/ 
```

# performance - 你能在测试之前估计应用程序的性能吗？

> ID：290518
> 
> 赞同：5
> 
> 时间：2008-11-14T15:52:58.700
> 
> 标签：performance, load-testing, benchmarking, performance-estimation

前几天有人问我这是一个棘手的问题……我们正在开发一个非常复杂的电话 (SIP) 应用程序，其中包含混合的 C++ 和 PHP 代码以及 MySQL 数据库和几个开源组件。

一位电信工程师要求我们估计应用程序的性能（尚未准备好）。他说‘好吧，你知道每秒有多少数据包可以通过 Linux 内核，而且你可能知道你的应用程序有多快，所以告诉我每秒有多少调用会通过你的东西’。

对我来说似乎是胡说八道，因为可能会发生一百万种情况（嗯，从字面上看......）

但是......有没有办法在实际测试之前估计应用程序性能（知道它将运行的硬件，能够在其上运行标准基准测试等）？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-14T15:58:04.057

您当然可以用上限（最大吞吐量）限制问题。没有什么废话。事实上，不知道这些东西表明解决问题的方法相当随意——尤其是在电话领域。

您可以自己解决问题 - 您必须为交易或应用程序中的任何任务单元完成的最少“工作”是多少？

例如，一些往返的消息、一些处理和数据库命中？获取有关各个部分的信息将使您了解可能的最快吞吐量。如果您加载系统并发现性能显着降低，那么您可以花时间找出可能因算法效率低下而损失吞吐量的地方，等等。

**编辑**

要进行此练习，您需要了解您的应用程序为每个用例执行的所有步骤。然后，您可以确定每个用例的最大吞吐量。在发布和上线之前，您绝对应该知道这些东西。

我忽略了最坏情况的分析——正如你所指出的——要困难得多。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-14T17:28:28.583

请参阅[Web 性能的容量规划：度量、模型和方法](https://rads.stackoverflow.com/amzn/click/com/0136938221)。还有一些工具可以进行这种离散事件模拟：

*   [超形式](http://www.hyperformix.com/products/performance-optimizer)
*   [模拟](http://simpy.sourceforge.net/)
*   [维基百科的模拟工具列表](http://en.wikipedia.org/wiki/List_of_computer_simulation_software)

这东西不容易，商业工具会花你的钱。容量规划书随附一张 CD，其中包含许多 Excel 工作簿模板和模型示例，可以让您快速入门。

祝你好运 ：）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-14T16:13:24.943

如果你真的要回答这个问题，你可以这样说：

“我不知道。我会为你估算这个，但这需要时间。显然我的答案的准确性取决于我在计算我的估算时付出了多少努力（IE时间）。如何我应该花多少时间来计算我的估计？”

把负担重新推给他们。如果他们真的想要一个准确的答案，他们将不得不让您至少构建一些可以模拟实际环境的测试应用程序。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-14T16:21:54.380

您可以使用峰值来衡量性能。您的整个系统可能还没有工作，但您知道这些部件是如何组合在一起的。您可以在几个小时内完成与最终应用程序相同类型的工作，跨越所有层，并使用它来衡量您的设计性能。

**请记住：**原型很广，尖峰很深。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-09-27T07:39:24.193

您绝对可以提前进行容量规划，但估算的质量将取决于可用数据的质量。

最好的估计是在测试中构建系统，运行模拟工作负载，然后根据性能要求和工作负载预测容量。这 3 个形成一个预测空间 - 给定 3 个中的 2 个，您可以预测第三个：

1.  给定性能要求和容量（即硬件），您可以计算出您可以处理的工作负载。

2.  给定性能要求和工作负载，您可以计算出您需要的容量（即硬件）。

3.  给定工作负载和容量，您可以预测您的预期性能。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-10-07T11:23:03.580

你应该做估算。估计不会给你正确的答案。然而，它会让你思考这个问题。现在这听起来像是你的编码，并希望一切都会好起来。或者您处于恐慌模式，觉得您没有时间进行估算。

花一些时间考虑一下。分析重要的用例。想想你可能需要的内存；考虑数据库访问；考虑网络访问（本地和远程）。这些将影响系统的性能。让整个团队一起做这件事。

在这些重要用例的开发过程中，定期测量系统的性能。如果需要，可以模拟组件/其他系统。分析结果。这些与您的估计相比如何。也许组件是内存/数据库/网络绑定的。也许您需要更多内存；更少的数据库访问；更简单的查询；缓存。您不必立即进行这些更改。但是，您确实知道您的系统是如何运行的以及您需要做什么。

**结果：**系统测试中的令人讨厌的意外更少。随着发布日期的临近，人们不再恐慌。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-14T16:40:50.413

在某些领域确实如此，但除非您是该领域的专家，否则您将一无所知。例如，我编写代码来控制工业机器人。速度受机器人运动的限制，而不是代码的执行速度。知道机器人有多快和它要走多远，我们就可以对“速度”做出相当好的估计。我不知道如何估计您的申请时间。

# c# - 当基础通用列表不包含重复元素时，ListView 显示重复元素

> ID：290520
> 
> 赞同：1
> 
> 时间：2008-11-14T15:53:02.753
> 
> 标签：c#, asp.net, generics

我将通用列表绑定到 <asp:ListView /> 控件以显示标签云。列表中的元素是 Tag 对象，其中 Tag 基本上是这样的：

```
public class Tag {
    public string Name { get; set; }
    public int Total { get; set; }
} 
```

我创建 List<Tag> 对象，然后将其绑定到 ListView，但是当为页面呈现 HTML 时，某些 Tag 对象会重复，例如给定**苹果、香蕉、猕猴桃、橙子、草莓**的预期标签列表，HTML 会实际输出像***苹果，香蕉，苹果，苹果，草莓之***类的东西。

我正在将基础 List<Tag> 的内容写到 Trace.axd 中，这表明元素的顺序正确，没有重复。

有没有人遇到过类似的事情？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T21:33:06.657

能多放点代码吗？也许您正在使用一些使用相同内存位置的引用变量？您上传的代码很难分辨。

# sharepoint - 在 sharepoint 中禁止更新单个列表项

> ID：290523
> 
> 赞同：2
> 
> 时间：2008-11-14T15:53:23.300
> 
> 标签：sharepoint

我想知道如何做的是当有人编辑一个列表项时，它会通过我的事件代码，该代码在进行更改并保存时触发，我不希望任何人能够在它仍在处理时编辑该列表项本身那个请求。所以我想知道在那种情况下我是否可以禁止单个项目被其他人编辑，直到它完成它正在做的事情。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-15T21:57:10.960

不确定我是否完全了解您想要什么。

尝试向列表或内容类型添加一个字段（如果您愿意，可以隐藏）以用作标志。当您输入事件代码时，请确保先检查标志，如果未设置，请设置它并执行您的操作。完成工作后，取消设置标志。

这里有一些代码来说明。请注意，我使用了一个名为“更新”的列。如果您不想添加列，也可以使用 SPListItem 的属性。

哦，别忘了在你调用 SPListItem.Update 之前调用 DisableEventFiring ，然后再调用 EnableEventFiring() 。得到这个，你手上会有一个非常讨厌的无限循环。

.b

```
 public override void ItemAdding(SPItemEventProperties properties)
    {
        if (properties.ListItem["updating"].ToString() == "updating")
        {
            properties.Cancel = true;
            properties.ErrorMessage = "Item is currently updating, please try again later";
        }
        else
        {
            properties.ListItem["updating"] = "updating";
            this.DisableEventFiring();
            properties.ListItem.Update();
            this.EnableEventFiring();

            // do your stuff

            properties.ListItem["updating"] = "";
            this.DisableEventFiring();
            properties.ListItem.Update();
            this.EnableEventFiring();
        }
    } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-17T07:51:43.550

我毫不怀疑 Bjørns 解决方案会起作用，但在实施时必须非常小心。请。请记住，在您的更新方法中应该包含一个重置标志的“finally”，无论抛出哪个异常，否则您的列表将永远被锁定:-(

# .net - VB.NET 是否优化了字符串文字的连接？

> ID：290527
> 
> 赞同：9
> 
> 时间：2008-11-14T15:55:03.890
> 
> 标签：.net, vb.net, performance, optimization

类似于[这个](https://stackoverflow.com/questions/288794/does-c-optimize-the-concatenation-of-string-literals)问题，但是对于 VB.NET，因为我学会了这是一个语言的东西。

例如，编译器是否知道翻译

> Dim s As String = "test" + "this" + "function"

到

```
Dim s As String = "test this function" 
```

从而避免字符串连接对性能的影响？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-17T22:50:54.563

是的。它确实。我只测试了 VS 2008，但我强烈怀疑以前的版本也是如此。

VB.NET

```
Public Class Class1

    Dim s As String = "test " + "this " + "function"

    Public Function test() As String
        Return s
    End Function

End Class 
```

IL - 注意字符串“test this function”

```
{
    .maxstack 8
    L_0000: ldarg.0 
    L_0001: call instance void [mscorlib]System.Object::.ctor()
    L_0006: nop 
    L_0007: ldarg.0 
    L_0008: ldstr "test this function"
    L_000d: stfld string ClassLibrary1.Class1::s
    L_0012: nop 
    L_0013: ret 
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-09-21T13:10:45.747

**是的，它确实！让我们来测试一下。**

由于 .NET 将所有托管语言（VB、C#、C++）编译为 IL（中间语言）指令，并且`String`类型是 CLS（公共语言规范）的一部分，因此所有 .NET Framework 版本：`String`2.0、3.0、3.5、4.0 将文字串联优化为编译过程的一部分。

例如下面的 VB.NET 代码：

```
Dim s As String = "A" & "B" & "C" 
```

产生以下 IL 指令：

```
L_0008: ldstr "ABC" 
```

这清楚地证明了编译器正在优化`String`文字连接（在：ildasm.exe 中测试）

但是，如果上面的代码是用单独的语句编写的：

```
Dim s As String = "A"
s &= "B"
s &= "C" 
```

没有进行优化并且`String`在运行时执行连接（性能开销）。这同样适用于在运行时解析数据的单行语句（变量、属性、方法）。

使用下划线 _ 将上述语句连接成单个语句以强制优化：

```
Dim s As String = "A" _
& "B" _
& "C" _ 
```

如果您需要在标记之间换行，请使用`vbCrLf`(compile-time) 常量来确保优化，因为 using `Environment.NewLine`(run-time) 属性不提供优化。

**希望这可以帮助您获得性能优势！**

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-14T15:58:35.333

在我查找时，[这里是规范的下载页面](http://www.microsoft.com/downloads/details.aspx?FamilyID=39DE1DD0-F775-40BF-A191-09F5A95EF500&displaylang=en)。

第 11.2 节看起来*是*正确的——它基本上相当于 C# 3.0 规范中的 7.18——但它不包含相同的保证。我怀疑编译器仍然会这样做，但我看不到任何保证。不过我再看看。

第 11.2 节确实声明“常量表达式是一个表达式*，其值可以在编译时完全评估*”（我的重点），但我看不出它实际上保证它*会*在编译时完全评估它。坦率地说，根据这个条件制作一个表达类别但没有实际使用它是很奇怪的。

快速测试表明，当前的 VB 编译器确实在编译时进行了连接，但如果这是有意的话，规范中确实*应该*有保证。

第 7.3 节更接近一点：

> 当表达式的操作数都是原始类型常量时，编译器可以在编译时对表达式求值。这样的表达式称为常量表达式。

现在，就 CLR 而言，String 不是原始类型（[Type.IsPrimitive](http://msdn.microsoft.com/en-us/library/system.type.isprimitive.aspx)将返回 false），但就VB 规范而言，它*是原始类型。*

它仍然没有说它*会*评估它......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-17T23:03:55.037

编译器将在适当时优化字符串连接。但是，如果您不知道可能有多少串联，则应该考虑使用 StringBuilder 类。

[http://msdn.microsoft.com/en-us/library/system.text.stringbuilder.aspx](http://msdn.microsoft.com/en-us/library/system.text.stringbuilder.aspx)

从上面的文章：

> String 或 StringBuilder 对象的串联操作的性能取决于内存分配发生的频率。String 连接操作总是分配内存，而 StringBuilder 连接操作仅在 StringBuilder 对象缓冲区太小而无法容纳新数据时才分配内存。因此，如果串联固定数量的 String 对象，则 String 类更适合串联操作。在这种情况下，编译器甚至可以将各个连接操作组合成一个操作。如果串联任意数量的字符串，则 StringBuilder 对象更适合串联操作；例如，如果一个循环连接随机数量的用户输入字符串。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-09-21T14:06:44.343

Jeff Atwood 对此进行了研究并发表了博客。结果？

[它。只是。没有。事情！](http://www.codinghorror.com/blog/2009/01/the-sad-tragedy-of-micro-optimization-theater.html)

# javascript - 在 jQuery 中查找“下一个”表单输入元素的最佳方法？

> ID：290535
> 
> 赞同：40
> 
> 时间：2008-11-14T15:57:49.907
> 
> 标签：javascript, jquery

使用 jQuery，从任意元素开始在页面上查找下一个表单元素的最佳方法是什么？当我说表单元素时，我的意思是`<input>`,或。`<select>``<button>``<textarea>`

在以下示例中，id 为“this”的元素是任意起点，id 为“next”的元素是我要查找的元素。相同的答案应该适用于所有示例。

示例 1：

```
<ul>
 <li><input type="text" /></li>
 <li><input id="this" type="text" /></li>
</ul>

<ul>
 <li><input id="next" type="text" /></li>
</ul>

<button></button> 
```

示例 2：

```
<ul>
 <li><input id="this" type="text" /></li>
</ul>

<button id="next"></button> 
```

示例 3：

```
<input id="this" type="text" />
<input id="next" type="text" /> 
```

示例 4：

```
<div>
  <input id="this" type="text" />
  <input type="hidden" />
  <div>
    <table>
      <tr><td></td><td><input id="next" type="text" /></td></tr>
    </table>
  </div>
  <button></button>
</div> 
```

编辑：到目前为止提供的两个答案都需要向页面上的所有输入元素写入序列号。正如我在其中一个人的评论中提到的那样，这是我已经在做的事情，我更喜欢只读解决方案，因为这将在插件中发生。

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2008-11-15T02:04:31.630

荣誉，

使用 .index 怎么样？

例如`$(':input:eq(' + ($(':input').index(this) + 1) + ')');`

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2010-07-19T11:32:17.977

redsquare 是绝对正确的，也是一个很好的解决方案，我也在我的一个项目中使用了它。

我只是想指出他缺少一些括号，因为当前的解决方案将索引与 1 连接，而不是将它们加在一起。

所以更正的解决方案看起来像：

```
$(":input:eq(" + ($(":input").index(this) + 1) + ")"); 
```

对不起，重复发布，但我找不到评论他的帖子的方法......

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2011-12-14T00:32:43.433

此解决方案不需要索引，并且也可以很好地与 tabindex 配合使用 - 换句话说，它每次都为您提供浏览器在选项卡上为您提供的确切元素，而无需任何额外工作。

```
function nextOnTabIndex(element) {
      var fields = $($('form')
                    .find('a[href], button, input, select, textarea')
                    .filter(':visible').filter('a, :enabled')
                    .toArray()
                    .sort(function(a, b) {
                      return ((a.tabIndex > 0) ? a.tabIndex : 1000) - ((b.tabIndex > 0) ? b.tabIndex : 1000);
                    }));

      return fields.eq((fields.index(element) + 1) % fields.length);
    } 
```

它的工作原理是抓取表单中的所有可选项卡字段（如[http://www.w3.org/TR/html5/editing.html#focus-management](http://www.w3.org/TR/html5/editing.html#focus-management)所允许的），然后根据（[http://www .w3.org/TR/html5/editing.html#sequential-focus-navigation-and-the-tabindex-attribute](http://www.w3.org/TR/html5/editing.html#sequential-focus-navigation-and-the-tabindex-attribute)）来计算下一个标签到的元素。一旦有了它，它就会查看传入的字段在该数组中的位置，并返回下一个元素。

需要注意的几点：

*   jQuery 似乎支持 jQuery 对象上的 sort()，但我无法在文档中明确找到它，因此调用 toArray() 然后将数组重新包装在 jQuery 对象中。
*   还有其他字段可以选择，但我将它们排除在外，因为它们不是标准的表单字段。

我用来测试的代码是（使用 jQuery 1.7）：

```
<script>
  $(function() {
    $('a[href], button, input, select, textarea').click(function() {
      console.log(nextOnTabIndex($(this)).attr('name'));
    })
  });
</script>

<form>
  <input type='text' name='a'/>
  <input type='text' name='b' tabindex='1' />
  <a>Hello</a>
  <input type='text' name='c'/>
  <textarea name='d' tabindex='2'></textarea>
  <input id='submit' type='submit' name='e' tabindex='1' />
</form> 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2013-09-26T17:16:22.730

在尝试了我能找到的所有代码（并且在浏览器之间遇到问题）之后，我发现了一个在顶级浏览器中工作的代码。由于一些奇怪的问题，无法使用以前的例程。

```
$(document.body).keydown(function(event) {
    if(event.keyCode == 13 ) {
        $(":input")[$(":input").index(document.activeElement) + 1].focus();
        return false;
    }
}); 
```

希望这对其他人有帮助。享受。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-14T16:16:52.083

您可以为每个表单项指定一个 id（或唯一的类名），将其标识为表单元素，并为其指定一个索引。例如：

```
<div>
    <input id="FormElement_0" type="text" />
    <input id="FormElement_1" type="text" />
<div> 
```

然后，如果你想从第一个元素遍历到第二个元素，你可以这样做：

```
//I'm assuming "this" is referring to the first input

//grab the id
var id = $(this).attr('id');

//get the index from the id and increment it
var index = parseInt(id.split('_')[0], 10);
index++;

//grab the element witht that index
var next = $('#FormElement_' + index); 
```

这样做的好处是您可以将任何元素标记为下一个，无论位置或类型如何。您还可以控制遍历的顺序。因此，如果出于任何原因您想跳过某个元素并稍后再返回，您也可以这样做。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-15T14:13:20.833

您可以这样做以获取您正在寻找的表单元素的完整列表：

```
var yourFormFields = $("yourForm").find('button,input,textarea,select'); 
```

然后，应该很容易找到下一个元素：

```
var index = yourFormFields.index( this ); // the index of your current element in the list. if the current element is not in the list, index = -1

if ( index > -1 && ( index + 1 ) < yourFormFields.length ) { 

                    var nextElement = yourFormFields.eq( index + 1 );

                    } 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-14T16:28:58.970

或者您可以使用 html 属性“tabindex”，当用户在表单周围进行选项卡时，它会转到 tabindex="i" 到 tabindex="i+1"。您可以使用 jQuery 轻松获取属性。也可以很好地回退到没有启用 javascript 的用户。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-15T05:56:37.730

我想出了一个无需明确定义索引即可完成工作的函数：

```
function nextInput(form, id) {
    var aInputs = $('#' + form).find(':input[type!=hidden]');
    for (var i in aInputs) {
        if ($(aInputs[i]).attr('id') == id) {
            if (typeof(aInputs[parseInt(i) + 1]) != 'undefined') {
                return aInputs[parseInt(i) + 1];
            }
        }
    }
} 
```

这是一个工作示例。表单标签是为了保持一致。您真正需要的只是一个共同的父级，甚至可以只使用 body 标签作为父级（对函数稍作修改）。

将此粘贴到文件中并使用 firefox / firebug 打开，您将看到它为所有示例返回正确的元素：

```
<html>
  <head>
    <script src="http://www.google.com/jsapi"></script>
    <script>
      function nextInput(form, id) {
        var aInputs = $('#' + form).find(':input[type!=hidden]');
        for (var i in aInputs) {
          if ($(aInputs[i]).attr('id') == id) {
            if (typeof(aInputs[parseInt(i) + 1]) != 'undefined') {
              return aInputs[parseInt(i) + 1];
            }
          }
        }
      }

      google.load("jquery", "1.2.6");
      google.setOnLoadCallback(function() {
        console.log(nextInput('myform1', 'this1'));
        console.log(nextInput('myform2', 'this2'));
        console.log(nextInput('myform3', 'this3'));
        console.log(nextInput('myform4', 'this4'));
      });
    </script>
  </head>
  <body>
    <form id="myform1">
      <ul>
         <li><input type="text" /></li>
         <li><input id="this1" type="text" /></li>
      </ul>
      <ul>
        <li><input id="next1" type="text" /></li>
      </ul>
    </form>

    <form id="myform2">
      <ul>
         <li><input type="text" /></li>
         <li><input id="this2" type="text" /></li>
      </ul>
      <ul>
        <li><input id="next2" type="text" /></li>
      </ul>
    </form>

    <form id="myform3">
      <input id="this3" type="text" />
      <input id="next3" type="text" />
    </form>

    <form id="myform4">
      <div>
        <input id="this4" type="text" />
        <input type="hidden" />
        <div>
        <table>
          <tr><td></td><td><input id="next4" type="text" /></td></tr>
        </table>
        </div>
        <button></button>
      </div>
    </form>
  </body>
</html> 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-12-15T10:35:38.120

您可以使用 jQuery 字段插件，它允许您这样做。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-12-07T00:38:28.133

```
var elementSelector = "input:visible,textarea:visible";
var nextSibling = $(elementSelector )[$(elementSelector ).index() + 1];
//$(nextSibling).focus(); possible action 
```

我只是认为上述解决方案更简单，或者您可以根据需要将其全部添加到一行中:-)

```
var nextSibling = $("input:visible,textarea:visible")[$("input:visible,textarea:visible").index() + 1]; 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-02-20T16:48:04.810

这对我来说效果很好，它正确地跳过了隐藏的输入：

```
input_el.nextAll( 'input:visible:first' ).focus(); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-06-25T13:02:35.977

所有使用 index（或 nextAll）的解决方案仅适用于所有表单输入都是同级的情况，例如在同一个`<div>`块中。下面通过在页面上创建所有可见的、非只读输入的 id 数组来解决这个问题，并在当前控件之后挑选出第一个，如果当前控件是页面上的最后一个，则进行环绕。

```
ids = $(":input:visible:not([readonly])").map(function () { return this.id });
nextId = ids[($.inArray($(this).attr("id"), ids) + 1) % ids.length];
$("#" + nextId).focus(); 
```

使用 map 函数使其比涉及迭代器的解决方案更简洁。

# c# - 使用 Visual Studio 2008 错误地创建了输出文件夹

> ID：290537
> 
> 赞同：2
> 
> 时间：2008-11-14T15:58:18.673
> 
> 标签：c#, visual-studio-2008

我有很多项目的解决方案。实际上有一个核心项目和一些插件。我更改了所有插件的 OutputPath，因此所有二进制文件最终都位于 Core bin\debug 文件夹中。（这是必要的，因为核心没有插件引用，因此在编译时它不“包含”插件二进制文件。）

所以基本上我的文件夹结构如下：

```
解决方案
  我的解决方案.sln
  插件1\
  插件2\
  核心\bin\debug

```

每个插件 OutputPath 都是“..\Core\bin\debug”。当我打开解决方案时，Visual Studio 会在解决方案的父文件夹中创建一个文件夹“Core\bin\debug”，就好像相对路径从 .sln 文件开始一样。但是，当我构建解决方案时，二进制文件会输出到正确的路径（“Solution\Core\bin\debug”）。

核心\bin\debug

对我来说，它看起来像一个 Visual Studio 错误，但也许我在某处忽略了一些选项。任何想法如何解决这个问题？

PS：我知道这不是一个关键问题，因为一切都构建和工作正常，但是我不喜欢无意义的文件夹挂在周围的想法

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-14T16:04:47.037

与其更改插件的输出位置，不如为它们创建一个构建后脚本（Properties \ Build Events 选项卡），将它们复制到 Core 文件夹。这将防止与输出文件夹混淆。

此命令行应该为您解决问题：

```
copy "$(TargetPath)" "$(SolutionDir)Core\$(OutDir)" 
```

如果您还需要复制 .pdb 和 .config 文件，可以添加更多行：

```
copy "$(TargetPath).pdb" "$(SolutionDir)Core\$(OutDir)"
copy "$(TargetPath).config" "$(SolutionDir)Core\$(OutDir)" 
```

如果你真的想用一行来做，这也应该工作，虽然它不是那么干净：

```
copy "$(TargetPath)*" "$(SolutionDir)Core\$(OutDir)" 
```

如果您在主项目和附加组件中没有使用相同的输出路径，则需要将 $(OutDir) 替换为硬编码值。如果您将它们设置为针对典型的“\bin\Debug”文件夹（或者只是保留默认值），那么您可以使用 $(OutDir) 值。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-20T08:21:16.487

不要使用“..\Core\bin\debug”，而是使用“$(SolutionDir)\Core\bin\debug”。

# java - 如何自动将数据复制到新的 RMI 线程？

> ID：290545
> 
> 赞同：1
> 
> 时间：2008-11-14T15:59:12.803
> 
> 标签：java, multithreading, java-native-interface, rmi, securitymanager

我正在调整一个小的 rmi 客户端-服务器应用程序。我写了几件事：

```
HelloInterface -> A Hello World interface for RMI
Server -> The server app'
Client -> The client app' 
```

没什么特别的，但是...我已经将手放在一个新的 RMISecurityManager 中，它调用 JNI 方法并检查单独用户的权限：

```
package rmi;
import java.rmi.RMISecurityManager;
import java.io.*;

public class NativeRMISecurityManager extends RMISecurityManager
{
    private boolean unix;
    protected static ThreadLocal user = new ThreadLocal();

    /*
     * On interdit l'utilisation du constructeur par defaut
     * pour obliger l'utilisation du constructeur avec user. 
     */
    private NativeRMISecurityManager()
    {
        super();
    }

    public NativeRMISecurityManager (final String user)
    {
        super();
        String OS = System.getProperty("os.name").toLowerCase();
        unix = (OS.compareTo("windows") != 0); /* Assume that if not 
                            * windows, then "UNIX/POSIX" 
                            */
        /*
         * ThreadLocal's user : Each thread is considered 
         * to have different access rights to the machine
         */

        NativeRMISecurityManager.user.set(user);

        if (!unix)
        {
            System.out.println("Systeme : "+OS);
        }
    }

    public void checkRead(String file)
    {
        super.checkRead(file);
        /*
         * If we are on a **IX platform we want to check that 
         * the _user_ has access rights.
         */
        if (unix)
        {
            String str_user = (String)NativeRMISecurityManager.user.get();

            if (file == null)
            {
                throw new SecurityException("file = NULL !!!");
            }
        if (str_user == null)
            {
                throw new SecurityException("user = NULL in the ThreadLocal!!!");
            }

            int ret = c_checkRead(
                    file, 
                    str_user
                    );
            if (ret != 0)
            {
                throw new SecurityException("Access error: " + file);
            }
        }
    }

    public native int c_checkRead(String file, String user);
} 
```

在服务器类中，我正在这样做：

```
String user = "my_user";
System.setSecurityManager(new NativeRMISecurityManager(user)); 
```

这个类似乎在服务器的主线程中工作。现在的问题是当我尝试连接到该服务器类并查找注册表时。我得到了那个例外：

```
Exception in thread "RMI TCP Connection(1)-192.168.42.207"     java.lang.ExceptionInInitializerError
        at sun.rmi.transport.StreamRemoteCall.getInputStream(StreamRemoteCall.java:111)
        at sun.rmi.transport.Transport.serviceCall(Transport.java:118)
        at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:466)
        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:707)
        at java.lang.Thread.run(Thread.java:595)
Caused by: java.lang.SecurityException: user = NULL dans le ThreadLocal!!!
        at rmi.NativeRMISecurityManager.checkRead(NativeRMISecurityManager.java:62)
        at java.io.File.exists(File.java:700)
        at java.lang.ClassLoader$3.run(ClassLoader.java:1689)
        at java.security.AccessController.doPrivileged(Native Method)
        at java.lang.ClassLoader.loadLibrary0(ClassLoader.java:1686)
        at java.lang.ClassLoader.loadLibrary(ClassLoader.java:1668)
        at java.lang.Runtime.loadLibrary0(Runtime.java:822)
        at java.lang.System.loadLibrary(System.java:993)
        at sun.security.action.LoadLibraryAction.run(LoadLibraryAction.java:50)
        at java.security.AccessController.doPrivileged(Native Method)
        at sun.rmi.server.MarshalInputStream.<clinit>(MarshalInputStream.java:97)
        ... 5 more 
```

恕我直言，这意味着（隐式）创建了一个线程并将 NativeRMISecurityManager 作为其默认 SecurityManager。

有人对此有什么建议吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-15T01:56:26.687

> 恕我直言，这意味着（隐式）创建了一个线程并将 NativeRMISecurityManager 作为其默认 SecurityManager。

这是真的，尽管它不是你错误的原因；问题与 ThreadLocal 的使用有关。ThreadLocal 的关键属性是每个调用线程都有自己的值。在这种情况下，“用户”由初始化 NativeRMISecurityManager 并将其设置为系统安全管理器（可能是主线程）的线程设置（并为其设置）。

但是，其他一些线程（从外观上看是 RMI 消息处理线程）正在调用 checkRead() - 但从未为该线程设置“用户”字段！因此该值返回为空。

除非出于某种原因让不同的线程具有不同的值 - 我无法从您的示例中辨别出一个 - 我建议将“用户”字段设为 a）字符串，而不是 ThreadLocal 和 b）非静态。那应该可以解决您的空值问题。

然而，假设它是一个需求/设计约束，当前架构的问题是只有实例化 NativeRMISecurityManager 的线程才能真正拥有一个用户——所有其他线程都为空。

在更深入地研究这一点时，我认为我需要更好地了解您的问题域，以提供任何有用的修复建议。此外，Java 的安全架构没有什么快速或肮脏的。但是，我会在一些假设下尽力而为：

1.  假定系统创建的线程是可信的
2.  您的代码创建的线程必须指定用户
3.  子线程应该继承创建线程的用户

潜在实施：

```
public class NativeRMISecurityManager extends RMISecurityManager {

    private static final boolean UNIX;

    static {
        String OS = System.getProperty("os.name").toLowerCase();
        UNIX = (OS.compareTo("windows") != 0); /* Assume that if not 
                                                * windows, then "UNIX/POSIX" 
                                                */
    }

    protected static InheritableThreadLocal<String> user =
        new InheritableThreadLocal<String>();

    public static setThreadUser(String username) {
        user.set(username);
    }

    public NativeRMISecurityManager(String initialUser) {
        super();
        // Set the user for the thread that constructs the security manager
        // All threads created as a child of that thread will inherit the user
        // All threads not created as a child of that thread will have a 'null' user
        setThreadUser(initialUser);
    }

    public void checkRead(String file) {
        super.checkRead(file);
        /*
         * If we are on a **IX platform we want to check that 
         * the _user_ has access rights.
         */
        if (UNIX)
        {
            if (file == null)
            {
                throw new SecurityException("file = NULL !!!");
            }

            String str_user = NativeRMISecurityManager.user.get();

            if (str_user != null)
            {
                // Note: sanitize input to native method
                int ret = c_checkRead(file, str_user);

                if (ret != 0)
                {
                    throw new SecurityException("Access error: " + file);
                }
            }

            // Assume a system thread and allow access
        }
    }

    public native int c_checkRead(String file, String user);
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T08:33:39.020

是的 ！就是这样。

昨天下午我已经考虑过了，我采用了相同的解决方案。我会在这里为那些对此感到好奇的人发布我的代码。1) NativeRMISecurityManager 2) C 代码（您必须使用 javah 生成 .h

（注意：我不会用英文翻译它，因为有很多法语评论）

```
package rmi;

import java.rmi.RMISecurityManager;

/**
 * <p> Ce SecurityManager, qui herite de RMISecurityManager,
 * implemente une verification supplementaire des droits
 * d'acces aux fichiers.
 * A la creation du SecurityManager et lors de la creation
 * de nouveaux threads, on renseigne ThreadLocal du nom du
 * _user_ du thread.
 * <p>Ainsi, lors des checkRead() et checkWrite()
 * notre SecurityManager appelle une methode native (JNI)
 * qui va verifier directement si le user a les droits 
 * d'acces a la ressource. 
 * <p><b>Warning : NE PAS OUBLIER DE FAIRE APPEL A 
 * setCurrentUser() DANS CHAQUE THREAD CREE.</b>
 * <p> <b>Remarque :</b> Pour les informations sur la compilation 
 * et l'execution de la lib ecrite en C, cf. le fichier README. 
 * @author a_po
 */
public class NativeRMISecurityManager extends RMISecurityManager
{
    private boolean unix;
    protected ThreadLocal user = new ThreadLocal();

    /**
     * Constructeur par defaut.
     * <p><b>ATTENTION :</b> Bien faire appel a la methode setCurrentUser(String) !
     * Sinon le SecurityManager se comportera comme un RMISecurityManager classique.
     * @see public void setCurrentUser(String userName)
     */
    public NativeRMISecurityManager()
    {
        super();
        String OS = System.getProperty("os.name").toLowerCase();
        unix = (OS.compareTo("windows") != 0); /* Si le systeme 
                                                    * n'EST PAS windows, 
                                                    * alors c'est UNIX...
                                                    * 
                                                    * Pas tres rigoureux,
                                                    * mais sinon il faut tester
                                                    * Systeme V, Linux, *BSD,
                                                    * Sun OS, ...
                                                    */

        /*
         * User du ThreadLocal : Chaque thread est considere comme ayant des
         * droits d'acces au systeme potentiellement differents.
         */
        this.user.set(user);

        if (!unix)
        {
            System.out.println("Systeme : "+OS);
        }
    }

    /**
     * Verification en lecture.
     * <p>
     * Dans le cas ou l'on est sur une plateforme POSIX,
     * on souhaite verifier que le _user_ du Thread a le droit
     * de lecture sur le fichier.
     * <p>
     * De plus, dans le cas ou user est null, cela signifie
     * OBLIGATOIREMENT que le thread a ete cree "automatiquement"
     * et que le thread courant n'est pas un thread de "tache a executer".
 * <p>
     * En effet, le user est recupere dans le ThreadLocal
     * et on force l'initialisation de cette variable a l'instanciation
     * du SecurityManager (en mettant le constructeur par defaut prive) ou
     * en faisant appel a setCurrentUser(String)
     * @see void rmi.NativeRMISecurityManager.setCurrentUser(String user)
     */
    public void checkRead(String file)
    {
        super.checkRead(file);

        String str_user = (String)this.user.get();

        if (unix && str_user != null)
        {
            if (file == null)
            {
                throw new SecurityException("file = NULL !!!");
            }

            int ret = c_checkRead(file, str_user);
            if (ret != 0)
            {
                throw new SecurityException("Erreur d'acces au fichier : "     + file);
            }
        }
    }

    /**
     * Verification d'acces en ecriture sur un fichier.
     * @see void rmi.NativeRMISecurityManager.checkRead(String file)
     */
    public void checkWrite(String file)
    {
        super.checkWrite(file);
        String str_user = (String)this.user.get();

        if (unix && str_user != null)
        {
            if (file == null)
            {
                throw new SecurityException("file = NULL !!!");
            }

            int ret = c_checkWrite(file, str_user);
            if (ret != 0)
            {
                throw new SecurityException("Erreur d'acces au fichier : "         + file);
            }
        }
    }

    /**
     * Configure le thread courant pour que le user soit pris en compte
     * dans les verifications d'acces aux fichiers.
     * @param user
     */
    public void setCurrentUser(String userName)
    {
        this.user = new ThreadLocal();
        this.user.set(userName);
    }

    public String getCurrentUser()
    {
        if (user!=null){
            return (String)user.get();
        }
        else return null;
    }

    /**
     * Methode native a implementer en C.
     * @param file
     * @param user
     * @return 0 si ok <p> -1 sinon
     */
    public native int c_checkRead(String file, String user);

    /**
     * Idem que pour c_checkRead
     * @param file
     * @param user
     * @return
     * @see int rmi.NativeRMISecurityManager.c_checkRead(String file, String user)
     */
    public native int c_checkWrite(String file, String user);

    /**
     * Chargement de la bibliotheque JNI.
     */
    static
    {
        System.loadLibrary("rmi_NativeRMISecurityManager");
    }
} 
```

和 C 库：

```
#include <stdio.h>
#include <jni.h>
#include <sys/stat.h>
#include <sys/types.h>
#include <unistd.h>
#include <pwd.h>
#include <stdlib.h>
#include <grp.h>
#include <string.h>
#include "rmi_NativeRMISecurityManager.h"

/* Droits en lecture / ecriture / execution */

#define R_RIGHT 4
#define X_RIGHT 1
#define W_RIGHT 2

JNIEXPORT jint JNICALL Java_rmi_NativeRMISecurityManager_c_1checkRead
  (JNIEnv *env, jobject obj, jstring file, jstring user)
{
    int ret = check_permission(env, obj, file, user);
    /**
     * La permission d'acces a un fichier vaut ceci :
     * 1 pour l'execution
     * 2 pour l'ecriture
     * 4 pour la lecture.
     * Donc :
     * * Droit en lecture : 4, 5, 6, 7
     * * Droit en ecriture : 2, 3, 6, 7
     * * Droit en execution : 1, 3, 5, 7.
     */
    if (ret == R_RIGHT || ret == R_RIGHT + W_RIGHT || 
        ret == R_RIGHT + X_RIGHT || ret == R_RIGHT + W_RIGHT + X_RIGHT)
    {
        return 0;
    }
    else
        return -1;
}

JNIEXPORT jint JNICALL Java_rmi_NativeRMISecurityManager_c_1checkWrite
  (JNIEnv *env, jobject obj, jstring file, jstring user)
{
    int ret = check_permission(env, obj, file, user);
    /**
     * La permission d'acces a un fichier vaut ceci :
     * 1 pour l'execution
     * 2 pour l'ecriture
     * 4 pour la lecture.
     * Donc :
     * * Droit en lecture : 4, 5, 6, 7
     * * Droit en ecriture : 2, 3, 6, 7
     * * Droit en execution : 1, 3, 5, 7.
     */
    if (ret == W_RIGHT || ret == W_RIGHT + R_RIGHT || 
        ret == W_RIGHT + X_RIGHT || ret == W_RIGHT + R_RIGHT + X_RIGHT)
    {
        return 0;
    }
    else
        return -1;
}

int check_permission(JNIEnv *env, jobject obj, jstring file, jstring user)
{
    struct stat pstat;
    const char* pzcfile = (*env)->GetStringUTFChars(env, file, 0);
    const char* pzcuser = (*env)->GetStringUTFChars(env, user, 0);
    struct passwd* puserInfo;
    int bisOwner = 0;
    int bisGroup = 0;
    struct group* pgroupInfo;
    int i;
    int droits = 0;

    /* recuperer les informations relatives au fichier */
    if(lstat(pzcfile, &pstat)<0)
    {
        fprintf(stderr,"* Le fichier %s n'exite pas.\n", pzcfile);
        (*env)->ReleaseStringUTFChars(env, file, pzcfile);
        (*env)->ReleaseStringUTFChars(env, user, pzcuser);
        return -1;
    }

    /* recuperer l'identifiant du user */
    puserInfo = getpwnam(pzcuser);
    if(puserInfo == NULL)
    {
        fprintf(stderr,"* L'utilisateur %s n'est pas connu du systeme.\n", pzcuser);
        (*env)->ReleaseStringUTFChars(env, file, pzcfile);
        (*env)->ReleaseStringUTFChars(env, user, pzcuser);
        return -2;
    }

    /* regarder si le user est proprietaire du fichier */
    if(puserInfo->pw_uid == pstat.st_uid)
    {
        bisOwner = 1;
    }
    /* si le user n'est pas proprietaire, verifier s'il est membre du groupe */
    if(!bisOwner)
    {
        /* recuperer les informations relatives au groupe */
        pgroupInfo = getgrgid(pstat.st_gid);
        /* parcourir la liste des membres du groupe a la recherche du user */
        for(i=0;;i++)
        {
            if(pgroupInfo->gr_mem[i] == NULL)
            {
                break;
            }
            if(strcmp(pgroupInfo->gr_mem[i],pzcuser) == 0)
            {
                bisGroup = 1;
                break;
            }
        }
    }

    /* recuperer les droits correspondants au user */
    if(bisOwner)
    {
        droits = (pstat.st_mode & S_IRWXU) >> 6;
    }
    else if(bisGroup)
    {
        droits = (pstat.st_mode & S_IRWXG) >> 3;
    }
    else
    {
        droits = pstat.st_mode & S_IRWXO;
    }

    /* liberer les espaces memoire alloues */
    (*env)->ReleaseStringUTFChars(env, file, pzcfile);
    (*env)->ReleaseStringUTFChars(env, user, pzcuser);
    return droits;
} 
```

非常感谢格雷格案例。这让我感到安慰，因为我们找到了相同的解决方案。:)

# c# - 针对 Active Directory 验证用户名和密码？

> ID：290548
> 
> 赞同：564
> 
> 时间：2008-11-14T15:59:42.693
> 
> 标签：c#, authentication, active-directory

如何针对 Active Directory 验证用户名和密码？我只是想检查用户名和密码是否正确。

* * *

## 回答 #1

> 赞同：675
> 
> 时间：2009-01-31T22:35:10.470

如果您使用 .NET 3.5 或更高版本，则可以使用`System.DirectoryServices.AccountManagement`命名空间并轻松验证您的凭据：

```
// create a "principal context" - e.g. your domain (could be machine, too)
using(PrincipalContext pc = new PrincipalContext(ContextType.Domain, "YOURDOMAIN"))
{
    // validate the credentials
    bool isValid = pc.ValidateCredentials("myuser", "mypassword");
} 
```

它很简单，很可靠，它是 100% 的 C# 托管代码 - 您还能要求什么？:-)

在这里阅读所有相关信息：

*   [在 .NET Framework 3.5 中管理目录安全主体](http://msdn.microsoft.com/en-us/magazine/cc135979.aspx)
*   [System.DirectoryServices.AccountManagement 上的 MSDN 文档](http://msdn.microsoft.com/en-us/library/system.directoryservices.accountmanagement.aspx)

**更新：**

正如[其他 SO question (及其答案)](https://stackoverflow.com/questions/8949501/why-does-active-directory-validate-last-password)中所述，此调用存在问题，可能会返回`True`用户的旧密码。请注意这种行为，如果发生这种情况不要太惊讶:-)（感谢@MikeGledhill 指出这一点！）

* * *

## 回答 #2

> 赞同：73
> 
> 时间：2008-11-14T16:10:19.427

我们在 Intranet 上执行此操作

您必须使用 System.DirectoryServices；

这是代码的胆量

```
using (DirectoryEntry adsEntry = new DirectoryEntry(path, strAccountId, strPassword))
{
    using (DirectorySearcher adsSearcher = new DirectorySearcher(adsEntry))
    {
        //adsSearcher.Filter = "(&(objectClass=user)(objectCategory=person))";
        adsSearcher.Filter = "(sAMAccountName=" + strAccountId + ")";

        try
        {
            SearchResult adsSearchResult = adsSearcher.FindOne();
            bSucceeded = true;

            strAuthenticatedBy = "Active Directory";
            strError = "User has been authenticated by Active Directory.";
        }
        catch (Exception ex)
        {
            // Failed to authenticate. Most likely it is caused by unknown user
            // id or bad strPassword.
            strError = ex.Message;
        }
        finally
        {
            adsEntry.Close();
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：71
> 
> 时间：2012-06-14T12:55:36.397

这里介绍的几种解决方案无法区分错误的用户/密码和需要更改的密码。这可以通过以下方式完成：

```
using System;
using System.DirectoryServices.Protocols;
using System.Net;

namespace ProtocolTest
{
    class Program
    {
        static void Main(string[] args)
        {
            try
            {
                LdapConnection connection = new LdapConnection("ldap.fabrikam.com");
                NetworkCredential credential = new NetworkCredential("user", "password");
                connection.Credential = credential;
                connection.Bind();
                Console.WriteLine("logged in");
            }
            catch (LdapException lexc)
            {
                String error = lexc.ServerErrorMessage;
                Console.WriteLine(lexc);
            }
            catch (Exception exc)
            {
                Console.WriteLine(exc);
            }
        }
    }
} 
```

如果用户密码错误，或者用户不存在，错误将包含

“8009030C：LdapErr：DSID-0C0904DC，注释：AcceptSecurityContext 错误，数据 52e，v1db1”，

如果需要更改用户密码，它将包含

“8009030C：LdapErr：DSID-0C0904DC，注释：AcceptSecurityContext 错误，数据 773，v1db1”

`lexc.ServerErrorMessage`数据值是 Win32 错误代码的十六进制表示。这些错误代码与调用 Win32 LogonUser API 调用返回的错误代码相同。下面的列表总结了一系列具有十六进制和十进制值的常用值：

```
525​ user not found ​(1317)
52e​ invalid credentials ​(1326)
530​ not permitted to logon at this time​ (1328)
531​ not permitted to logon at this workstation​ (1329)
532​ password expired ​(1330)
533​ account disabled ​(1331) 
701​ account expired ​(1793)
773​ user must reset password (1907)
775​ user account locked (1909) 
```

* * *

## 回答 #4

> 赞同：36
> 
> 时间：2008-11-14T16:15:11.087

使用 DirectoryServices 的非常简单的解决方案：

```
using System.DirectoryServices;

//srvr = ldap server, e.g. LDAP://domain.com
//usr = user name
//pwd = user password
public bool IsAuthenticated(string srvr, string usr, string pwd)
{
    bool authenticated = false;

    try
    {
        DirectoryEntry entry = new DirectoryEntry(srvr, usr, pwd);
        object nativeObject = entry.NativeObject;
        authenticated = true;
    }
    catch (DirectoryServicesCOMException cex)
    {
        //not authenticated; reason why is in cex
    }
    catch (Exception ex)
    {
        //not authenticated due to some other exception [this is optional]
    }

    return authenticated;
} 
```

需要 NativeObject 访问来检测错误的用户/密码

* * *

## 回答 #5

> 赞同：28
> 
> 时间：2008-11-14T23:51:56.343

不幸的是，没有“简单”的方法来检查 AD 上的用户凭据。

到目前为止，使用每种方法，您都可能会得到一个假阴性：用户的信用是有效的，但是 AD 在某些情况下会返回 false：

*   用户需要在下次登录时更改密码。
*   用户密码已过期。

ActiveDirectory 将不允许您使用 LDAP 来确定密码是否由于用户必须更改密码或密码已过期而无效。

要确定密码更改或密码过期，您可以调用 Win32:LogonUser()，并检查以下 2 个常量的 windows 错误代码：

*   ERROR_PASSWORD_MUST_CHANGE = 1907
*   ERROR_PASSWORD_EXPIRED = 1330

* * *

## 回答 #6

> 赞同：22
> 
> 时间：2008-11-14T16:01:53.690

可能最简单的方法是 PInvoke LogonUser Win32 API.eg

> [http://www.pinvoke.net/default.aspx/advapi32/LogonUser.html](http://www.pinvoke.net/default.aspx/advapi32/LogonUser.html)

MSDN 参考这里...

> [http://msdn.microsoft.com/en-us/library/aa378184.aspx](http://msdn.microsoft.com/en-us/library/aa378184.aspx)

肯定要使用登录类型

```
LOGON32_LOGON_NETWORK (3) 
```

这只会创建一个轻量级令牌 - 非常适合 AuthN 检查。（其他类型可用于构建交互式会话等）

* * *

## 回答 #7

> 赞同：18
> 
> 时间：2008-11-14T16:17:11.130

完整的 .Net 解决方案是使用 System.DirectoryServices 命名空间中的类。它们允许直接查询 AD 服务器。这是一个可以执行此操作的小示例：

```
using (DirectoryEntry entry = new DirectoryEntry())
{
    entry.Username = "here goes the username you want to validate";
    entry.Password = "here goes the password";

    DirectorySearcher searcher = new DirectorySearcher(entry);

    searcher.Filter = "(objectclass=user)";

    try
    {
        searcher.FindOne();
    }
    catch (COMException ex)
    {
        if (ex.ErrorCode == -2147023570)
        {
            // Login or password is incorrect
        }
    }
}

// FindOne() didn't throw, the credentials are correct 
```

此代码使用提供的凭据直接连接到 AD 服务器。如果凭据无效，则 searcher.FindOne() 将抛出异常。ErrorCode 对应于“无效的用户名/密码”COM 错误。

您无需以 AD 用户身份运行代码。事实上，我成功地使用它从域外的客户端查询 AD 服务器上的信息！

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2011-04-07T21:55:24.400

Yet another .NET call to quickly authenticate LDAP credentials:

```
using System.DirectoryServices;

using(var DE = new DirectoryEntry(path, username, password)
{
    try
    {
        DE.RefreshCache(); // This will force credentials validation
    }
    catch (COMException ex)
    {
        // Validation failed - handle how you want
    }
} 
```

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2008-11-14T16:06:46.533

试试这个代码（注意：报告在 windows server 2000 上不起作用）

```
#region NTLogonUser
#region Direct OS LogonUser Code
[DllImport( "advapi32.dll")]
private static extern bool LogonUser(String lpszUsername, 
    String lpszDomain, String lpszPassword, int dwLogonType, 
    int dwLogonProvider, out int phToken);

[DllImport("Kernel32.dll")]
private static extern int GetLastError();

public static bool LogOnXP(String sDomain, String sUser, String sPassword)
{
   int token1, ret;
   int attmpts = 0;

   bool LoggedOn = false;

   while (!LoggedOn && attmpts < 2)
   {
      LoggedOn= LogonUser(sUser, sDomain, sPassword, 3, 0, out token1);
      if (LoggedOn) return (true);
      else
      {
         switch (ret = GetLastError())
         {
            case (126): ; 
               if (attmpts++ > 2)
                  throw new LogonException(
                      "Specified module could not be found. error code: " + 
                      ret.ToString());
               break;

            case (1314): 
               throw new LogonException(
                  "Specified module could not be found. error code: " + 
                      ret.ToString());

            case (1326): 
               // edited out based on comment
               //  throw new LogonException(
               //   "Unknown user name or bad password.");
            return false;

            default: 
               throw new LogonException(
                  "Unexpected Logon Failure. Contact Administrator");
              }
          }
       }
   return(false);
}
#endregion Direct Logon Code
#endregion NTLogonUser 
```

除非您需要为“LogonException”创建自己的自定义异常

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2016-12-27T21:05:07.313

Windows 身份验证可能因各种原因而失败：用户名或密码不正确、帐户被锁定、密码过期等等。要区分这些错误，请通过 P/Invoke 调用[LogonUser](https://msdn.microsoft.com/en-us/library/windows/desktop/aa378184(v=vs.85).aspx) API 函数，如果函数返回，请检查错误代码`false`：

```
using System;
using System.ComponentModel;
using System.Runtime.InteropServices;

using Microsoft.Win32.SafeHandles;

public static class Win32Authentication
{
    private class SafeTokenHandle : SafeHandleZeroOrMinusOneIsInvalid
    {
        private SafeTokenHandle() // called by P/Invoke
            : base(true)
        {
        }

        protected override bool ReleaseHandle()
        {
            return CloseHandle(this.handle);
        }
    }

    private enum LogonType : uint
    {
        Network = 3, // LOGON32_LOGON_NETWORK
    }

    private enum LogonProvider : uint
    {
        WinNT50 = 3, // LOGON32_PROVIDER_WINNT50
    }

    [DllImport("kernel32.dll", SetLastError = true)]
    private static extern bool CloseHandle(IntPtr handle);

    [DllImport("advapi32.dll", SetLastError = true)]
    private static extern bool LogonUser(
        string userName, string domain, string password,
        LogonType logonType, LogonProvider logonProvider,
        out SafeTokenHandle token);

    public static void AuthenticateUser(string userName, string password)
    {
        string domain = null;
        string[] parts = userName.Split('\\');
        if (parts.Length == 2)
        {
            domain = parts[0];
            userName = parts[1];
        }

        SafeTokenHandle token;
        if (LogonUser(userName, domain, password, LogonType.Network, LogonProvider.WinNT50, out token))
            token.Dispose();
        else
            throw new Win32Exception(); // calls Marshal.GetLastWin32Error()
    }
} 
```

示例用法：

```
try
{
    Win32Authentication.AuthenticateUser("EXAMPLE\\user", "P@ssw0rd");
    // Or: Win32Authentication.AuthenticateUser("user@example.com", "P@ssw0rd");
}
catch (Win32Exception ex)
{
    switch (ex.NativeErrorCode)
    {
        case 1326: // ERROR_LOGON_FAILURE (incorrect user name or password)
            // ...
        case 1327: // ERROR_ACCOUNT_RESTRICTION
            // ...
        case 1330: // ERROR_PASSWORD_EXPIRED
            // ...
        case 1331: // ERROR_ACCOUNT_DISABLED
            // ...
        case 1907: // ERROR_PASSWORD_MUST_CHANGE
            // ...
        case 1909: // ERROR_ACCOUNT_LOCKED_OUT
            // ...
        default: // Other
            break;
    }
} 
```

注意：LogonUser 需要与您验证的域建立信任关系。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2011-04-07T11:04:40.013

如果您坚持使用 .NET 2.0 和托管代码，这里有另一种适用于本地和域帐户的方法：

```
using System;
using System.Collections.Generic;
using System.Text;
using System.Security;
using System.Diagnostics;

static public bool Validate(string domain, string username, string password)
{
    try
    {
        Process proc = new Process();
        proc.StartInfo = new ProcessStartInfo()
        {
            FileName = "no_matter.xyz",
            CreateNoWindow = true,
            WindowStyle = ProcessWindowStyle.Hidden,
            WorkingDirectory = Environment.GetFolderPath(Environment.SpecialFolder.CommonApplicationData),
            UseShellExecute = false,
            RedirectStandardError = true,
            RedirectStandardOutput = true,
            RedirectStandardInput = true,
            LoadUserProfile = true,
            Domain = String.IsNullOrEmpty(domain) ? "" : domain,
            UserName = username,
            Password = Credentials.ToSecureString(password)
        };
        proc.Start();
        proc.WaitForExit();
    }
    catch (System.ComponentModel.Win32Exception ex)
    {
        switch (ex.NativeErrorCode)
        {
            case 1326: return false;
            case 2: return true;
            default: throw ex;
        }
    }
    catch (Exception ex)
    {
        throw ex;
    }

    return false;
} 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2015-12-27T14:14:16.853

我的简单功能

```
 private bool IsValidActiveDirectoryUser(string activeDirectoryServerDomain, string username, string password)
    {
        try
        {
            DirectoryEntry de = new DirectoryEntry("LDAP://" + activeDirectoryServerDomain, username + "@" + activeDirectoryServerDomain, password, AuthenticationTypes.Secure);
            DirectorySearcher ds = new DirectorySearcher(de);
            ds.FindOne();
            return true;
        }
        catch //(Exception ex)
        {
            return false;
        }
    } 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2020-12-16T12:30:06.933

对我来说，以下这两种方法都有效，请确保您的域在开始时使用 LDAP://

```
//"LDAP://" + domainName
private void btnValidate_Click(object sender, RoutedEventArgs e)
{
    try
    {
        DirectoryEntry de = new DirectoryEntry(txtDomainName.Text, txtUsername.Text, txtPassword.Text);
        DirectorySearcher dsearch = new DirectorySearcher(de);
        SearchResult results = null;

        results = dsearch.FindOne();

        MessageBox.Show("Validation Success.");
    }
    catch (LdapException ex)
    {
        MessageBox.Show($"Validation Failure. {ex.GetBaseException().Message}");
    }
    catch (Exception ex)
    {
        MessageBox.Show($"Validation Failure. {ex.GetBaseException().Message}");
    }
}

private void btnValidate2_Click(object sender, RoutedEventArgs e)
{
    try
    {
        LdapConnection lcon = new LdapConnection(new LdapDirectoryIdentifier((string)null, false, false));
        NetworkCredential nc = new NetworkCredential(txtUsername.Text,
                               txtPassword.Text, txtDomainName.Text);
        lcon.Credential = nc;
        lcon.AuthType = AuthType.Negotiate;
        lcon.Bind(nc);

        MessageBox.Show("Validation Success.");
    }
    catch (LdapException ex)
    {
        MessageBox.Show($"Validation Failure. {ex.GetBaseException().Message}");
    }
    catch (Exception ex)
    {
        MessageBox.Show($"Validation Failure. {ex.GetBaseException().Message}");
    }
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-02-24T04:57:48.013

这里我完整的身份验证解决方案供您参考。

首先，添加以下四个引用

```
 using System.DirectoryServices;
 using System.DirectoryServices.Protocols;
 using System.DirectoryServices.AccountManagement;
 using System.Net; 

private void AuthUser() { 

      try{
            string Uid = "USER_NAME";
            string Pass = "PASSWORD";
            if (Uid == "")
            {
                MessageBox.Show("Username cannot be null");
            }
            else if (Pass == "")
            {
                MessageBox.Show("Password cannot be null");
            }
            else
            {
                LdapConnection connection = new LdapConnection("YOUR DOMAIN");
                NetworkCredential credential = new NetworkCredential(Uid, Pass);
                connection.Credential = credential;
                connection.Bind();

                // after authenticate Loading user details to data table
                PrincipalContext ctx = new PrincipalContext(ContextType.Domain);
                UserPrincipal user = UserPrincipal.FindByIdentity(ctx, Uid);
                DirectoryEntry up_User = (DirectoryEntry)user.GetUnderlyingObject();
                DirectorySearcher deSearch = new DirectorySearcher(up_User);
                SearchResultCollection results = deSearch.FindAll();
                ResultPropertyCollection rpc = results[0].Properties;
                DataTable dt = new DataTable();
                DataRow toInsert = dt.NewRow();
                dt.Rows.InsertAt(toInsert, 0);

                foreach (string rp in rpc.PropertyNames)
                {
                    if (rpc[rp][0].ToString() != "System.Byte[]")
                    {
                        dt.Columns.Add(rp.ToString(), typeof(System.String));

                        foreach (DataRow row in dt.Rows)
                        {
                            row[rp.ToString()] = rpc[rp][0].ToString();
                        }

                    }  
                }
             //You can load data to grid view and see for reference only
                 dataGridView1.DataSource = dt;

            }
        } //Error Handling part
        catch (LdapException lexc)
        {
            String error = lexc.ServerErrorMessage;
            string pp = error.Substring(76, 4);
            string ppp = pp.Trim();

            if ("52e" == ppp)
            {
                MessageBox.Show("Invalid Username or password, contact ADA Team");
            }
            if ("775​" == ppp)
            {
                MessageBox.Show("User account locked, contact ADA Team");
            }
            if ("525​" == ppp)
            {
                MessageBox.Show("User not found, contact ADA Team");
            }
            if ("530" == ppp)
            {
                MessageBox.Show("Not permitted to logon at this time, contact ADA Team");
            }
            if ("531" == ppp)
            {
                MessageBox.Show("Not permitted to logon at this workstation, contact ADA Team");
            }
            if ("532" == ppp)
            {
                MessageBox.Show("Password expired, contact ADA Team");
            }
            if ("533​" == ppp)
            {
                MessageBox.Show("Account disabled, contact ADA Team");
            }
            if ("533​" == ppp)
            {
                MessageBox.Show("Account disabled, contact ADA Team");
            }

        } //common error handling
        catch (Exception exc)
        {
            MessageBox.Show("Invalid Username or password, contact ADA Team");

        }

        finally {
            tbUID.Text = "";
            tbPass.Text = "";

        }
    } 
```

# windows - 如何以编程方式停止/启动远程计算机上的计划任务？

> ID：290559
> 
> 赞同：52
> 
> 时间：2008-11-14T16:02:49.693
> 
> 标签：windows, scheduled-tasks

我想编写一个脚本来停止远程计算机上的计划任务，做一些事情，然后重新启动计划任务。

我该怎么做？

* * *

## 回答 #1

> 赞同：106
> 
> 时间：2008-11-14T20:46:12.990

这是我发现的。

停止：

```
schtasks /end /s <machine name> /tn <task name> 
```

开始：

```
schtasks /run /s <machine name> /tn <task name>

C:\>schtasks /?

SCHTASKS /parameter [arguments]

Description:
    Enables an administrator to create, delete, query, change, run and
    end scheduled tasks on a local or remote system. Replaces AT.exe.

Parameter List:
    /Create         Creates a new scheduled task.

    /Delete         Deletes the scheduled task(s).

    /Query          Displays all scheduled tasks.

    /Change         Changes the properties of scheduled task.

    /Run            Runs the scheduled task immediately.

    /End            Stops the currently running scheduled task.

    /?              Displays this help message.

Examples:
    SCHTASKS
    SCHTASKS /?
    SCHTASKS /Run /?
    SCHTASKS /End /?
    SCHTASKS /Create /?
    SCHTASKS /Delete /?
    SCHTASKS /Query  /?
    SCHTASKS /Change /? 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-14T16:18:46.197

**注意：** [“schtasks”](http://en.wikipedia.org/wiki/Schtasks)（参见另一个已接受的回复）已替换[为“at”](http://en.wikipedia.org/wiki/At_%28Windows%29)。但是，如果情况需要与没有 schtasks 的旧版本的 Windows 兼容，则“at”可能有用。

**“at”的命令行帮助：**

```
C:\>在 /?
AT 命令调度命令和程序在计算机上运行
指定的时间和日期。计划服务必须正在运行才能使用
AT 命令。

AT [\\计算机名] [[id] [/DELETE] | /删除[/是]]
在 [\\computername] 时间 [/INTERACTIVE]
    [ /EVERY:日期[,...] | /NEXT:date[,...]] "命令"

\\computername 指定远程计算机。命令安排在
                   如果省略此参数，则为本地计算机。
id 是分配给计划的标识号
                   命令。
/delete 取消预定的命令。如果省略 id，则所有
                   计算机上的预定命令被取消。
/yes 与取消所有作业命令一起使用
                   需要确认。
time 指定命令运行的时间。
/interactive 允许作业与用户的桌面交互
                   作业运行时登录的人员。
/every:date[,...] 在一周中的每个指定日期运行命令或
                   月。如果省略日期，则为月份的当前日期
                   假设。
/next:date[,...] 在下次出现
                   天（例如，下周四）。如果省略日期，则
                   假定为当前日期。
“command” 是要运行的 Windows NT 命令或批处理程序。

```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-10-01T22:43:45.747

怎么样`/disable`, 并`/enable`切换为`/change`命令？

```
schtasks.exe /change /s <machine name> /tn <task name> /disable
schtasks.exe /change /s <machine name> /tn <task name> /enable 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-09-21T12:30:11.397

```
schtasks /change /disable /tn "Name Of Task" /s REMOTEMACHINENAME /u mydomain\administrator /p adminpassword 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-02-24T08:18:30.730

试试这个：

```
schtasks /change /ENABLE /tn "Auto Restart" /s mycomutername /u mycomputername\username/p mypassowrd 
```

# ansi - 关于组建黑客俱乐部的建议

> ID：290570
> 
> 赞同：5
> 
> 时间：2008-11-14T16:06:03.977
> 
> 标签：ansi

我正在考虑在工作中组建一个[黑客](http://www.catb.org/~esr/jargon/html/H/hacker.html)俱乐部。我的想法是，我们每月开会，每次开会时，一名成员都会展示他创造的一个有趣的 hack。（所展示的黑客不一定是软件黑客；它们也可能是你在*MAKE*杂志上读到的那种东西。）

之后还会有[ANSI 标准比萨](http://www.catb.org/~esr/jargon/html/A/ANSI-standard-pizza.html)、素食比萨、啤酒和汽水可供社交。我什至考虑将俱乐部称为“ [TMRC](http://www.catb.org/~esr/jargon/html/T/TMRC.html) ”，尽管它与模型铁路无关。

有没有人尝试过做这样的事情或有任何建议？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-14T16:11:26.913

我们在办公室这样做。我称之为“开发者搏击俱乐部”

通常会做不同难度的挑战并相互竞争。

最后，我们会检查我们的解决方案，进行代码审查和讨论，然后使用基准测试结果或其他人作为谁获胜的决定因素。

通常，失败者必须为获胜者买午餐:)

对于要做的事情的想法，尝试来自[Top Coder](http://www.topcoder.com/tc)的东西、Stack Overflow 上的编程问题，甚至是不同编程站点上可用的简单“ [crackme ”应用程序。](http://en.wikipedia.org/wiki/Crackme)

您需要遵守的主要规则是：

*   让它变得有趣
*   使其具有教育意义
*   让它公平

尝试轮换挑战，因此要么每个人都非常擅长该主题，但同样糟糕，或者至少经常将其混合在一起，以至于它不会过多地偏爱一个人的技能组合。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T16:35:29.423

如果您的“黑客”组中有女性，请考虑[Howto Encourage Women in Linux 中](http://www.tldp.org/HOWTO/Encourage-Women-Linux-HOWTO/)给出的建议。特别是“会议地点和时间”部分。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-14T17:39:42.353

这有点超出您的要求，但是有关于如何为黑客制定计划以及如何以礼貌、黑客的方式解决成员之间问题的很好的信息。

概述： [http ://events.ccc.de/congress/2007/Fahrplan/events/2133.en.html](http://events.ccc.de/congress/2007/Fahrplan/events/2133.en.html)

视频： http:
[//chaosradio.ccc.de/23c3_m4v_1500.html](http://chaosradio.ccc.de/23c3_m4v_1500.html)
[http://chaosradio.ccc.de/24c3_m4v_2133.html](http://chaosradio.ccc.de/24c3_m4v_2133.html)

我最喜欢的是星期二模式：
如果因为日程安排冲突而导致一周中没有哪一天对每个人都有利，那么就在星期二举行活动。没有例外！简单而公平:-)

# java - JAX-RPC、Spring Web 服务和 UnsupportedOperationCallException

> ID：290574
> 
> 赞同：2
> 
> 时间：2008-11-14T16:07:47.467
> 
> 标签：java, web-services, spring, jax-rpc

我有一个试图使用 Spring 使用的 JAX-RPC Web 服务。这是我第一次使用 Spring 来使用 Web 服务，所以现在我只是想让它与 JAX-RPC Web 服务集成作为测试。

Web 服务中有几十个操作，但现在我只关心一个。以下是我在 Spring/client 端创建的接口：

```
public interface WSClient {
    public boolean userExists(int userid);
}

public interface WSService {
    //this method matches the method signature of the Web Service
    public com.company.data.User getUser(int userid);
} 
```

这是我的 applicationContext.xml：

```
<bean id="WSClient" class="com.company.ws.test.WSClientImpl">
    <property name="service" ref="myWebService"></property>
</bean>

<bean id="myWebService" class="org.springframework.remoting.jaxrpc.JaxRpcPortProxyFactoryBean">
    <property name="serviceInterface" value="com.company.ws.test.WSService"/>
    <property name="endpointAddress" value="http://1.2.3.4/web-service/data"/>
    <property name="namespaceUri" value="http://www.company.com/wdsl"/>
    <property name="serviceName" value="CompanyWebService"/>
    <property name="username" value="username"/>
    <property name="password" value="password"/>
    <property name="maintainSession" value="true"/>
</bean> 
```

使用此配置`JaxRpcPortProxyFactoryBean`，调用服务返回以下异常：

> org.springframework.remoting.RemoteProxyFailureException：无效的 JAX-RPC 调用配置；嵌套异常是操作风格：不支持“rpc”

我从来没有完全理解 RPC 和文档式 Web 服务之间的区别。但是，我相信这个 Web 服务使用的是 RPC 样式 - 所以这个异常让我感到困惑。

其次，我对应该设置哪些属性感到困惑`JaxRpcPortProxyFactoryBean`：

1.  如果我设置了该`wsdlDocumentUrl`属性，我最终会收到 HTTP 401 错误，因为此 Web 服务位于 HTTP 基本身份验证之后，并且似乎 Spring 在获取 WSDL 时不使用用户名/密码属性。
2.  如果我指定一个`PortInterface`属性（值为`CompanyWebServiceInterfacePort`），那么我会得到一个不同的异常说明：

    > 无法为 JAX-RPC 端口初始化服务 [{ [http://www.company.com/wdsl](http://www.company.com/wdsl) }CompanyWebServiceInterfacePort]; 嵌套异常是 WSDL 数据丢失，此操作不可用

换句话说，它告诉我缺少 WSDL——我无法设置它，因为 Spring 不会使用用户名/密码从服务器获取它！

我不确定这是否有任何意义，但本质上我不确定的是：

1.  对于 JAX-RPC 服务，是否需要设置 PortInterface 属性？这是我应该走的路吗？
2.  同样，Spring需要我设置`wsdlDocumentUrl`属性吗？如果是这样，有什么方法可以告诉 Spring 哪个 WSDL 并解决身份验证问题？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-14T21:09:17.530

我最终通过在本地保存 WSDL 文件的副本来解决这个问题，并且由于 JaxRpcPortProxyFactoryBean 需要`java.net.URL`属性`wsdlDocumentUrl`，因此必须使用类似`file:///c:/.../blah.wsdl`.

这并不是那么理想，我不想不得不将一个`file:///`URI 放在一个可能部署在服务器上的 Spring 上下文文件中，尤其是在不同的平台上 - 这个类的行为方式似乎很奇怪。

我猜大多数人没有使用 Spring，也没有使用 JAX-RPC。

# asp.net - 我必须使用 J2ME 进行黑莓开发吗？

> ID：290579
> 
> 赞同：1
> 
> 时间：2008-11-14T16:08:56.233
> 
> 标签：asp.net, blackberry, java-me, mobile

我想开始为 Blackberry 平台开发，特别是 Bold 以及即将推出的 Storm 设备。我是否需要学习 Java 和 J2ME 或者我可以在 ASP.NET 中开发网站并继续利用我已经拥有的技能？

我对移动平台开发完全陌生，不知道针对这些黑莓设备需要什么。我希望继续使用我的 ASP 技能。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-05T21:35:45.880

要开发功能齐全、性能可接受且外观漂亮的黑莓应用程序，您需要使用 RIM 原生 api。

您可以使用 J2ME 应用程序，但它们通常不能很好地与全键盘设备配合使用。

当然，Web 应用程序看起来会比这更糟糕。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-14T18:12:12.647

您是在谈论网站（因为您说“在 ASP.NET 中开发网站”）还是本机黑莓应用程序（因为您说“为黑莓平台开发”）？

在 Blackberry 上运行的应用程序使用 J2ME。如果您的应用程序是从 Blackberry 上的浏览​​器访问的，那么决定语言的是运行 Web 应用程序的服务器，而不是从 Blackberry 浏览器访问它。

然后是用于与企业应用程序集成的 Blackberry MDS。我对此知之甚少（从未使用过它或见过使用它的应用程序），但这里描述了它：http: [//na.blackberry.com/eng/services/mobile.jsp](http://na.blackberry.com/eng/services/mobile.jsp)

保罗

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-16T17:48:42.397

这个[问题](https://stackoverflow.com/questions/59424/creating-a-mini-site-in-aspnet-that-works-on-blackberry-windows-mobile-and-ipho)可能会对你有所帮助。“在 asp.NET 中创建一个适用于黑莓、Windows Mobile 和 iPhone 的迷你站点”

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-03T19:13:55.947

如果您只是做 Web 开发，**则不需要了解 J2ME for Blackberry**。J2ME 是设备特定应用程序的受支持的 JAVA 框架。您只需要熟悉移动设备的 HTML 渲染

假设您正在构建一个打算由黑莓浏览器加载的 Web 应用程序，我建议构建跨多种设备类型和配置交叉兼容的移动特定页面。

查看[Blackberry Browser Development Guides](http://na.blackberry.com/support/docs/subcategories/?userType=21&category=BlackBerry+Browser)，它提供了可应用于所有移动 Web 开发的移动 Web 开发建议/最佳实践。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-09-03T07:15:07.690

请阅读此[https://web.archive.org/web/20150107061257/https://www.oracle.com/technetwork/systems/index-139239.html](https://web.archive.org/web/20150107061257/https://www.oracle.com/technetwork/systems/index-139239.html)

它讨论了一个应用程序不应如何将 RIM UI API 调用与 CLDC 和 MIDP API 调用混合在一起。

当然，我还必须提到该链接确实过时了。

# mysql - 处理 MySQL 全文特殊字符

> ID：290581
> 
> 赞同：6
> 
> 时间：2008-11-14T16:10:39.957
> 
> 标签：mysql, full-text-search

在布尔模式下使用 MySQL 全文搜索时，某些字符（如 + 和 -）用作运算符。如果我搜索“C++”之类的东西，它会将 + 解释为运算符。处理这些特殊字符的最佳做法是什么？

我目前使用的方法是将数据中的所有+字符转换为_plus。它还将 &、@、/ 和 # 字符转换为文本表示。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-28T10:45:01.650

没有办法很好地使用 MySQL 的全文搜索来做到这一点。您正在做的事情（用预定义的字符串替换特殊字符）是唯一的方法。

您不妨考虑改用[Sphinx Search](http://www.sphinxsearch.com/)。它显然支持转义特殊字符，并且所有报告都比默认的全文搜索快得多。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-14T00:25:09.787

MySQL 在构建全文索引时忽略了哪些标记是相当残酷的。我会说它遇到术语“C++”的地方可能会去掉加号字符，只留下C，然后忽略它，因为它太短了。您可能可以将 MySQL 配置为包含单字母单词，但它并没有为此进行优化，我怀疑您是否可以让它按照您的意愿处理加号字符。

如果您需要一个好的内部搜索引擎，您可以在其中配置类似的内容，请查看已移植到各种语言的[Lucene ，](http://lucene.apache.org/)[包括 PHP（在 Zend 框架中）](http://ifacethoughts.net/2008/02/07/zend-brings-lucene-to-php/)。

或者，如果您比文本搜索更需要“标记”，那么其他东西可能更合适。

# winforms - 调试 .NET winform 时从 SerialPort 引起 ObjectDisposedException 的原因是什么？

> ID：290583
> 
> 赞同：0
> 
> 时间：2008-11-14T16:10:40.287
> 
> 标签：winforms, visual-studio-2008, .net-3.5, serial-port, dispose

Vista SP1 Visual Studio 2008 SP1 .NET 3.5 SP1 C#

我有一个我正在玩的 winforms 应用程序，它使用 SerialPort 对象作为私有变量。当应用程序被编译和执行时，它工作得很好。它也可以在没有任何断点的调试模式下运行。90% 的情况下，当我在断点处停止并尝试单步执行代码时，我会得到一个“出现未处理的异常”对话框，其中包含以下详细信息：

System.ObjectDisposedException 未处理 Message="Safe handle has been closed" Source="mscorlib" ObjectName="" StackTrace: at Microsoft.Win32.Win32Native.SetEvent(SafeWaitHandle handle) at System.Threading.EventWaitHandle.Set() at System。 IO.Ports.SerialStream.AsyncFSCallback(UInt32 errorCode, UInt32 numBytes, NativeOverlapped* pOverlapped) 在 System.Threading._IOCompletionCallback.PerformIOCompletionCallback(UInt32 errorCode, UInt32 numBytes, NativeOverlapped* pOVERLAP) InnerException:

令人沮丧的是，我不必跳过与串行相关的代码！我只需要对端口*做点什么*。所以我可能会读取一个字符串，操作该字符串，将两个数字相加，无论如何，然后 BANG。

同样，在不调试时，或者在没有任何断点的情况下调试时，这工作得很好。似乎有一些关于在断点处停止的东西，这使得 CLR 在不同的线程上处理 SerialStream。

网上有很多关于更新 USB 设备导致此问题的讨论。但我使用的是 COM1 上的内置主板端口。

我认为我在 .NET 2.0 中没有这个问题，所以我可能不得不回到那个问题......

在发布代码之前，我需要稍微简化一下应用程序——但是之前有没有人在调试器中看到过这样的行为？

非常感谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-16T08:02:35.760

也许您的端口正在被操作系统关闭，因为它没有得到您的应用程序的响应（它在断点处停止）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-19T15:42:47.173

我今天早上也遇到了同样的问题。令人惊讶的是，当我在 VS2008 Tools->Options->Debugging->General 中禁用以下选项时，它就消失了：

*   “启用异常助手”
*   “启用 .NET Framework 源单步执行”
*   “跳过属性和运算符”
*   “启用属性评估和其他隐式函数调用”

我不知道为什么，但它对我有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-19T12:24:24.453

好吧，我不太确定这是一个答案，但该项目肯定有一些东西。它最初是用 2.0 编写的，并被 VS2008 转换为 3.5。我在 C#-Express 2008 中创建了一个新项目，一个接一个地添加原始类，它现在就像一个魅力！不知道有什么不同。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T23:59:52.573

我也有这个。这一定是调试器的某种错误。上述建议有效：禁用“启用属性评估和其他隐式函数调用”。

我有一个具有执行串行 I/O 属性的类。我认为当我将鼠标悬停在它上面时，调试器可能有助于显示属性值，从而从调试器线程执行 IO。但情况似乎并非如此。我真的不确定原因是什么。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-05-19T12:30:59.883

我遇到了同样的问题并做了以下事情：

```
serialPortLock = Monitor.TryEnter(serialPort, 3000);
Thread.Sleep(5);
serialPort.Write(msg, 0, msg.Length); 
```

我的 Read() 也是如此。看起来这对我来说是一个很好的解决方法！

# javascript - Javascript菜单记住位置

> ID：290585
> 
> 赞同：1
> 
> 时间：2008-11-14T16:11:21.953
> 
> 标签：javascript, css

我目前正在为 Web 应用程序开发 JS 菜单。它由两个栏组成，固定的主栏和由 Javascript 函数激活的子菜单（显示：块从显示：无）。通过 onclick 事件添加 class="main_on" 和 class="sub_on" 也会突出显示主菜单和子菜单的选定选项。当用户点击 F5 或页面重新加载时，有没有办法记住显示了哪些子菜单以及哪些选项当前被归类为活动？如果可能的话，我正在寻找一种非 cookie 和非数据库的方法。

谢谢，

麦克风

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-14T16:19:08.973

您可以使单击的链接/元素（对于 onclick 事件）在地址栏中设置 URL 哈希。（即[http://server.name/page#URLhash](http://server.name/page#URLhash)）如果它是一个链接，您只需要调整 HREF 属性，否则您可能必须使用 window.location 进行操作。

这将设置当前状态。当页面（重新）加载时，检查 URL 哈希的值。有关如何访问它的详细信息，请参阅[http://developer.mozilla.org/en/DOM/window.location 。](http://developer.mozilla.org/en/DOM/window.location)如果 URL 哈希仍在地址栏中，您将能够获取该值。

然后使用该值来确定要激活哪个菜单。因此，您可以通过这种方式恢复状态。

浏览器之间存在一些差异。搜索“Ajax History”，其中有些人使用 URL 哈希来保存 Ajax 操作后的状态。与您尝试解决的问题不完全相同，但类似。查看 RSH： [http ://code.google.com/p/reallysimplehistory/](http://code.google.com/p/reallysimplehistory/)

将使用相同的想法。

# windows - 在 NLB 中服务器处于活动状态时检测死应用程序

> ID：290588
> 
> 赞同：0
> 
> 时间：2008-11-14T16:12:09.317
> 
> 标签：windows, load-balancing, cluster-computing

Windows NLB 工作得很好，当计算机死机时，它会从群集中删除计算机。

但是，如果应用程序死了，但服务器仍然可以正常工作，会发生什么？你是如何解决这个问题的？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T17:51:39.537

通过不使用 NLB。

硬件负载平衡器通常具有可配置的“探测”功能，以确定服务器是否响应请求。这可以通过访问真正的应用程序端口/URL，或某些特定的“健康检查”URL，只有在应用程序健康时才返回。

这些上的其他选项查看响应请求所花费的队列/时间

思科是这样说的：

> Cisco CSM 使用各种探测、带内健康监控、返回代码检查和动态反馈协议 (DFP) 持续监控服务器和应用程序的可用性。当真正的服务器或网关发生故障时，Cisco CSM 会将流量重定向到不同的位置。在不中断服务的情况下添加和删除服务器——系统可以轻松扩展或缩减。

（从这里：[http](http://www.cisco.com/en/US/products/hw/modules/ps2706/products_data_sheet09186a00800887f3.html#wp1002630) ://www.cisco.com/en/US/products/hw/modules/ps2706/products_data_sheet09186a00800887f3.html#wp1002630 ）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-06T13:35:38.873

网络应用程序有多个级别的健康检查。

1.  服务器机器起来了吗？
    *   应用程序（服务）是否正在运行？
    *   该服务是否接受网络连接？
    *   服务是否对“您还好”请求做出适当响应？
    *   该服务是否执行实际工作？（这还将检查您正在探测的服务背后的后端系统）

我在 NLB 方面的经验可能不完整，但我会描述一下我所知道的。NLB 可以做 1 和 2。使用自定义编码，您可以添加不同难度的其他级别。对于某些网络架构，这可能*非常*困难。

来自 Cisco 或 F5 等供应商的大多数硬件负载均衡器都可以轻松配置为执行 3 或 4。5 级测试仍然需要自定义编码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-06T11:41:40.430

大概使用 Windows NLB 有一些方法可以以编程方式设置节点的权重？节点应该自我监控，如果出现问题（例如，特定节点的磁盘空间不足），将其权重设置为零，这样它就不会接收更多流量。

但是，这需要仔细设计并进行进一步的人工监控，以确保您最终不会遇到一个故障导致整个集群宣布自己关闭的情况。

您不能真正希望处理网络负载平衡中的“拜占庭将军”情况；一个适当损坏的节点可能认为它很好，看起来很好，但完全无法做任何实际工作。诀窍是尽量减少这些情况在生产中发生的可能性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-05-03T13:30:52.810

我们从所有节点都是集群的一部分但不活动的情况开始。我们运行一个自定义服务监视器，它通过外部接口在本地对服务发出请求。如果响应成功，我们启动节点（允许它开始处理 NLB 流量）。如果响应失败，我们将停止节点接收流量。

Darron 描述的所有中间步骤都是无关紧要的。它是否有效是我们唯一关心的事情。如果机器不可访问，则 NLB 集群的其余部分会将其视为失败。

# .net - 使用键盘快捷键时控制失去焦点事件

> ID：290590
> 
> 赞同：1
> 
> 时间：2008-11-14T16:13:06.100
> 
> 标签：.net, events, lostfocus

对于 .NET Winforms 和 Windows Presentation Foundation，如果我有一个用户刚刚输入文本的文本框和一个按钮，如果用户单击该按钮，则“LostFocus”事件会在按钮单击事件触发之前触发。但是，如果用户对按钮使用键盘快捷键（例如，按钮的文本是“&Button”或“_Button”并且用户执行 Alt+B），则“LostFocus”事件会在按钮单击事件之后触发，这不太有用。

你知道合理的解决方法吗？在 ButtonClick 之前，我们希望在 LostFocus 中发生各种事情。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-14T18:20:23.660

您可以尝试在触发按钮逻辑之前跟踪是否发生了丢失焦点逻辑。无论如何，您不应该直接在处理程序中直接使用代码。你可以这样做：

```
public partial class Form1 : Form
    {
        private Boolean _didLostFocusLogic;

        public Form1()
        {
            InitializeComponent();
        }

        private void textBox1_Leave(object sender, EventArgs e)
        {
            LostFocusLogic();
        }

        private void button1_Click(object sender, EventArgs e)
        {
            ButtonClickLogic();
        }

        private void LostFocusLogic()
        {
            /* Do stuff */
            _didLostFocusLogic = true;
        }

        private void ButtonClickLogic()
        {
            if (!_didLostFocusLogic)
                LostFocusLogic();

            _didLostFocusLogic = false; // Reset for next time.

            /* Do stuff */
        }
    } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T16:31:34.330

如果您首先在按钮处理程序中执行此操作会发生什么？（或者可能是按钮的子类并覆盖 OnClick 以“全球”应用此逻辑）。

```
Button b = (Button) sender;
b.Focus(); 
```

这样能解决问题吗？

# sql-server - Sql server 抱怨这个 IF NOT EXISTS 语句

> ID：290596
> 
> 赞同：2
> 
> 时间：2008-11-14T16:14:39.670
> 
> 标签：sql-server

Sql server 抱怨这个 IF NOT EXISTS 语句，说关键字 'OR' 附近有'不正确的语法。

我的查询：

```
IF NOT EXISTS ( 
                (SELECT * FROM Users where userID = 1)
                OR
                (SELECT * FROM sales WHERE saleID = 1)
              )
BEGIN
            // blah blah blah

END 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-14T16:19:47.803

试试这种方式

```
IF 
    NOT EXISTS (SELECT 1 FROM Users where userID = 1)  
AND 
    NOT EXISTS (SELECT 1 FROM sales WHERE saleID = 1)
BEGIN 
       -- blah blah blah
END 
```

或者，如果您坚持要析取：

```
IF NOT (
    EXISTS (SELECT 1 FROM Users where userID = 1)  
    OR 
    EXISTS (SELECT 1 FROM sales WHERE saleID = 1)
)
BEGIN 
    -- blah blah blah
END 
```

EXISTS 运算符采用单个 select 语句并检查任何结果（因此您可以使用常量 1 而不是 * 或列名，这样更有效）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-14T16:18:27.180

你想要 IF NOT EXISTS ( SELECT... ) AND NOT EXISTS ( SELECT .... )

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-14T16:24:13.940

将“或”改为“并”

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-14T16:20:02.980

也许这就是你想要做的：

```
IF NOT EXISTS(SELECT * FROM Users WHERE userID = 1) OR (AND) NOT EXISTS(SELECT * FROM sales WHERE saleID = 1) 
```

# database - 数据库中的电话号码列

> ID：290597
> 
> 赞同：19
> 
> 时间：2008-11-14T16:14:43.367
> 
> 标签：database, phone-number

在我工作过的最后 3 家公司中，电话号码列的类型为 varchar(n)。原因是他们可能想要存储扩展（分机 333）。但在每种情况下，插入和更新时都会去掉“-”字符。我不明白为什么“.ext”字符可以存储，但“-”字符不行。有没有其他人看到过这个，你能想到什么解释这样做？如果您只想存储数字，那么使用 int 字段不是更好吗？相反，如果您想将数字存储为字符串/varchar，那么为什么不保留所有字符，而不用在显示时进行格式化和在写入时进行清理呢？

我也有兴趣了解在其他地方实施电话号码存储的其他方式。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-11-14T16:19:01.970

快速测试：你要加/减/乘/除电话号码吗？没有。与 SSN 类似，电话号码是可以包含实际号码的离散数据，因此字符串类型可能是最合适的。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-14T16:17:22.160

存储电话号码的一点是前导 0。

例如：01202 8765432

在 int 列中，0 将被去除，这使得电话号码无效。

我会冒险猜测 - 被换成空格是因为它们实际上没有任何意义

例如：123-456-789 = 123 456 789 = 123456789

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-14T16:28:13.603

就个人而言，我不会删除任何字符，因为根据电话号码的来源，它可能意味着不同的东西。将电话号码保留为输入的确切格式，因为显然这是输入它的人习惯于查看它的方式。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-14T17:14:50.890

你如何存储它并不重要，*只要它是一致的*。规范是去除格式化字符，但如果您需要查询这些值，您也可以单独存储国家代码、区号、交换和扩展名。同样，要求是一致的 - 否则查询它是一个 PITA。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-07-30T17:39:00.610

我能想到不将电话号码存储为“数字”而是作为字符串存储的另一个原因是，您用来访问数据库的软件堆栈的足够部分（PHP，我正在看你）不会支持足够大的整数（本机）以能够存储一些较长和/或异国情调的电话号码。

32 位可以携带的最大数字是 4294967295。这不适用于任何俄罗斯手机号码，例如数字 4959261234。

因此，您要找到一种方法来携带超过 32 位的数字数据，这给您带来了额外的不便。尽管数据库长期以来一直支持非常大的整数，但您只需要链中的一个坏链接就可以了。就像 PHP 一样。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-14T16:26:56.603

如果数据库表要驱动另一个系统（例如某种 IP 电话），则去除某些字符并允许其他字符可能会产生影响。根据所涉及的系统，将 etc.333 作为后缀可能是合法的，而开发人员可能没有考虑字符串中的“-”（是的，我猜这里......）

至于存储为 varchar 而不是 int，这对我来说只是普通的常识。如前所述，前导零可能会在 int 字段中被剥离，对 int 字段的查询可能会执行隐式数学函数（这也可以解释从文本中剥离“-”，您不想输入 555-1234 并有它存储为-679吗？）

总之，我不知道确切的推理，但可以推断出一些可能性。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-14T17:28:23.827

如果我知道电话号码只会在特定区域（例如北美）内，我喜欢做的是将条目更改为 4 个字段。3 代表区号，3 代表前缀，3 代表线路，也许 5 代表分机。然后，我将这些作为 1 个字段插入，带有“-”，可能还有一个“e”来指定扩展名。当然，任何搜索也需要遵循相同的过程。这样可以确保我获得更多常规数据，甚至可以在删除 - 和扩展名后将该号码用于实际拨打电话。我也可以轻松回到原来的 4 个字段。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-14T17:47:58.000

好东西！似乎主要的一点是电话号码的格式实际上并不是数据的一部分，而是来源国家的一个方面。尽管如此，通过保持数字的扩展部分不变，可能会破坏将格式与数据分离的模型。我怀疑所有国家/地区都使用相同的语法/格式来描述扩展名。此外，如果与电话系统集成是（可能的）要求，那么最好单独存储扩展并按预期构建消息。但马克也提出了一个很好的观点，如果你是一致的，那么你如何存储它可能并不重要，因为你也可以一致地查询和处理它。

感谢 Eric 提供另一个问题的链接。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-14T16:38:07.047

我会选择将数字存储为字符串，并在我的显示代码中添加各种“()”和“-”。国际号码确实变得更加困难。我们通过根据国家/地区采用各种“国际化”显示格式来处理它。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-11-12T23:39:31.923

当自动电话系统使用字段拨打电话时，它可能无法分辨应该使用哪些字符以及在拨号时应该忽略哪些字符。人们可能会看到“（”或“）”或“-”字符并知道这些被视为分隔电话号码的区号、npa 和 nxx 的分隔符。请记住，每个字符都代表一个二进制模式，除非预先编程为忽略，否则将由自动拨号器输入。考虑到这一点，最好只存储用户在手机上按下的字符的等价物，甚至更好地将各个值存储在单独的列中，这样拨号器就可以使用各个字段而无需解析字符串。

即使不使用拨号自动化，存储您将来不需要更新的内容也是一个好习惯。在字段之间添加字符比从字符串中删除字符要容易得多。

在评论使用如上所述的字符串与整数数据类型时，字符串是根据国家/地区之间的差异存储电话号码的正确方法。有一个重要的警告，尽管在聚合统计数据以报告（即多少数字或调用的总和）时，字符串的计数比整数慢得多。考虑到这一点，添加一个整数作为标识列很重要，您可以将其用于计数，而不是 varchar 或 char 字段数据类型。

# cocoa - 更改 Cocoa 中的字体跟踪

> ID：290598
> 
> 赞同：1
> 
> 时间：2008-11-14T16:14:51.040
> 
> 标签：cocoa, macos, fonts, tracking

我正在使用 NSAttributedString 在 Cocoa 中进行一些文本渲染，并设置字体和下划线属性等。但是，我不知道如何更改文本的跟踪。有什么建议么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-15T13:55:14.880

我不认为字体跟踪是带有属性字符串的文本布局的公开属性。

您也许可以在空白上使用可用的**扩展**属性，并手动插入带有缩放因子的空白字符以影响它们的宽度，但我希望这对于除了微不足道的情况之外的任何事情都是一种巧妙的破解。

我能想到的唯一其他途径是使用您自己的自定义属性和`NSLayoutManager`子类。可可文本系统非常灵活，但这种灵活性带来了更大程度的复杂性。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-11-14T18:56:03.477

到目前为止，我的解决方案只是使用 kerning 属性，因为跟踪和 kerning 是相似的。有没有更好的解决方案？

# linq - WebApps 中的并行 LINQ？

> ID：290602
> 
> 赞同：1
> 
> 时间：2008-11-14T16:15:33.317
> 
> 标签：linq, linq-to-sql, .net-4.0, multicore, parallel-processing

我刚刚观看了关于即将到来的 .NET 并行扩展的最后一个[Channel 9 视频。](http://channel9.msdn.com/posts/VisualStudio/Using-the-Parallel-Extensions-to-the-NET-Framework/)您将如何在 Web 应用程序中使用它？我特别考虑对 SQL 数据库使用并行 Linq 扩展。作为一种在多用户服务器应用程序中加速数据访问层的方法，这是否有意义？有哪些问题（除了使用静态集合类型的明显线程安全问题）？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-14T17:33:23.317

[我认为从这篇文章](http://msdn.microsoft.com/en-us/magazine/cc163329.aspx)中提取的这一段解释了 PLINQ-to-SQL 的用法：

> LINQ-to-SQL 和 LINQ-to-Entities 查询仍将由各自的数据库和查询提供程序执行，因此 PLINQ 不提供并行化这些查询的方法。如果您希望在内存中处理这些查询的结果，包括加入许多异构查询的输出，那么 PLINQ 会非常有用。

至于在 Web 应用程序中使用 PLINQ，如果请求需要许多内存计算，那么 PLINQ 可能会很有用（例如，如果您有多个要一起查询的数据源）我认为使用它没有问题.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-14T17:30:47.363

我相信，并行 LINQ 主要用于处理内存中的集合。您预计如何将它用于您的数据库？

鉴于 webapps 自然是相当并行的（就在单独线程上执行的单独请求而言），我怀疑 PLINQ 不会真正适用于它。

# mysql - 删除后更新排序键

> ID：290610
> 
> 赞同：2
> 
> 时间：2008-11-14T16:18:25.450
> 
> 标签：mysql, sql, sorting, sql-order-by

我有一个表，其中有一个字段`sort_id`。在该字段中，有从 1 到 n 的数字，用于定义数据集的顺序。现在我想删除一些元素，然后我想重新排序表格。因此，我需要一个查询来“找到”差距并`sort_id`根据修改更改字段。

当然，我可以这样做：

```
SELECT sort_id FROM table WHERE id = 5 
```

然后保存 sort_id，然后：

```
DELETE FROM table WHERE id = 5
UPDATE table SET sort_id = sort_id - 1 WHERE sort_id > {id from above} 
```

但我想一步完成重新排序过程。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-14T18:29:59.647

Mladen 和 Arvo 有很好的想法，但不幸的是在 MySQL 中你不能`SELECT`和`UPDATE`同一张表在同一个语句中（即使在子查询中）。这是 MySQL 的一个已知限制。

这是一个使用 MySQL 用户变量的解决方案：

```
SET @i := 0;
UPDATE mytable
SET sort_id = (@i := @i + 1)
ORDER BY sort_id; 
```

对于它的价值，无论如何我都不会打扰这样做。如果您`sort_id`仅用于排序而不是作为一种“行号”，那么在您删除 where 的行后，这些行仍按排序顺序排列`id=6`。这些值不一定必须是连续的才能进行排序。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-14T16:25:17.823

对于 sql server 2005：这是获得新序列的方式：

```
SELECT row_number() over(order by sort_id) as RN
FROM table 
```

更新表格意味着您应该将该选择加入您的更新：

```
update t1
set sort_id = t2.RN
FROM table t1 
     join (SELECT row_number() over(order by sort_id) as RN FROM table) t2 
        on t1.UniqueId = t2.UniqueId 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T17:50:04.813

我不知道 MySQL 的语法变化，也无法实时测试查询，但类似 ​​next 的内容至少应该给你一个想法：

```
update table t1
set sort_id = (select count * from table t2 where t2.sort_id <= t1.sort_id) 
```

# asp.net - 将 url 翻译成路由

> ID：290617
> 
> 赞同：2
> 
> 时间：2008-11-14T16:19:42.670
> 
> 标签：asp.net, asp.net-mvc, routing

我觉得我在这里重新发明了轮子，但我需要找到一种方法从一个包罗万象的 URL 中获取 URL，并将其重定向到另一条路线。

这样做的原因是因为我需要做一些事情，比如为某些 url 添加会话 cookie，然后将它们传递给他们的相关操作。

实现这一点的最佳方法是什么？

提前感谢您的帮助！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-20T08:05:38.873

您可以尝试在运行时更改母版页。虽然这不是最漂亮的解决方案。

[主题支持](http://frugalcoder.us/post/2008/11/ASPNet-MVC-Theming.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-15T02:51:31.613

如果我理解问题...

查看您之前的问题（[redirect-to-controller-but-with-a-different-master-using-a-catchall-wildcard](https://stackoverflow.com/questions/237440/redirect-to-controller-but-with-a-different-master-using-a-catchall-wildcard)），您想从以下位置获取通配符：

```
routes.MapRoute(
    "Partner",
    "partners/{partner}/{*wildcard}",
    new { controller = "Partners", action = "PartnerRedirect" }
); 
```

并在 Partners/PartnerRedirect 操作中，将其发送到通配符中指定的正确控制器/操作？

我不知道最好的方法来做到这一点，但在寻找对 url 路由进行单元测试的方法时提出了这一点：

[http://weblogs.asp.net/stephenwalther/archive/2008/07/02/asp-net-mvc-tip-13-unit-test-your-custom-routes.aspx](http://weblogs.asp.net/stephenwalther/archive/2008/07/02/asp-net-mvc-tip-13-unit-test-your-custom-routes.aspx)

我不确定它是否完全适合（即可能不必模拟东西），但看起来所有数据都是从 GetRouteData 返回以传递给 RedirectToAction 方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-16T22:40:29.873

哦，所以你不想要重定向？您希望 URL 保留：

mysite.com/partners/pepsi/products/cola.htm

但服务：

mysite.com/products/cola.htm

我家里没有 MVC，但你不能用不同的方式定义你的路线吗？

代替：

```
routes.MapRoute(
    "Partner",
    "partners/{partner}/{*wildcard}",
    new { controller = "Partners", action = "PartnerRedirect" }
); 
```

做：

```
routes.MapRoute(
    "Partner",
    "partners/{partner}/{controller}/{action}/{other stuff you need}",
    new { /* whatever defaults you want */ }
); 
```

该操作现在可以使用合作伙伴变量来执行任何操作，并且您可以向合作伙伴添加路由约束，以便只有有效的匹配。

（我认为）然后您可以在您的操作/控制器上使用操作过滤器来根据合作伙伴参数执行适当的操作（我认为它应该在过滤器的 httpcontext 中！）这样您就不必重复代码如果您想对合作伙伴进行一些基本的检查/操作，则在每个操作中。

这是一篇关于给猫剥皮的很多方法的不错的文章：

[http://weblogs.asp.net/stephenwalther/archive/2008/08/12/asp-net-mvc-tip-31-passing-data-to-master-pages-and-user-controls.aspx](http://weblogs.asp.net/stephenwalther/archive/2008/08/12/asp-net-mvc-tip-31-passing-data-to-master-pages-and-user-controls.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-17T09:12:37.960

不，它实际上是重定向，但重定向对用户不可见（与在 Web 窗体中完成 Server.Transfer() 的方式大致相同。

您指向的链接仅使用一个母版页，而我有许多母版页（接近 200 个）。

我曾考虑为这些合作伙伴提供单独的路由处理程序，但母版页的选择进入了等式。

我想我将不得不创建一个 ViewExtension 来克服这些问题......

# .net - Visual Studio 中运行的 .NET Web 服务的部署文件在哪里？

> ID：290621
> 
> 赞同：1
> 
> 时间：2008-11-14T16:19:53.933
> 
> 标签：.net, web-services, deployment

当我使用浏览器测试我的 Web 服务时，它会在[http://localhost:4832/](http://localhost:4832/)处打开——我在哪里可以在我的驱动器上找到它的文件？

## 更新

我不想知道我的 VS.NET 解决方案的文件在哪里，但我应该把 Web 服务的文件放在哪里……我稍后将为真正的 Web 服务安装的 .asmx、.dll 和其他文件.

## 更新 2

webservice在初始化获取插件时需要调用一些外部DLL。这就是为什么我需要知道这些文件在哪里手动放置插件 dll ......

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-14T16:38:44.393

因此，当您从 VS 启动 Web 服务时，Cassini（内置 Web 服务器）直接从该项目的 bin 文件中运行这些文件。

[http://localhost:4832/](http://localhost:4832/)将指向您的代码所在的文件夹（如 ALassek 建议的那样）并直接使用您的 asmx 文件。该 asmx 文件将从编译到 bin 文件夹的 dll 中运行。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-14T16:23:03.990

如果您选择您的解决方案，请转到查看 -> 属性窗口。路径字段将告诉您文件的位置。

* * *

程序集文件在开发过程中存储在 .Net temp 文件夹中，因为每次您进行更改时都会重新编译它们。当您发布网站时，它们被放置在 Bin 文件夹中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T18:28:38.323

LFSR 的回答很好，我已经准备好接受它，但只是为了确保我添加了这条线

代码中的“Assembly.GetExecutingAssembly().Location”向我显示正在执行的程序集的路径，并且似乎所有 DLL 都在一个临时文件夹中：

C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files\root\57e0fe88\e8cbe653\assembly...

# winforms - 无法从数据绑定 Winforms 下拉列表中跳出

> ID：290629
> 
> 赞同：7
> 
> 时间：2008-11-14T16:22:16.610
> 
> 标签：winforms, user-controls, controls

这有点奇怪，但我已经挣扎了几个小时，我不明白发生了什么。

我想知道是否有其他人遇到过这个问题，也许可以解释一下。我正在构建一个简单的 Winforms 应用程序并尝试使用许多内置控件。

基本上，我有一个带有用户控件和一些数据捕获字段的表单。其中 3 个字段是下拉列表，在用户控件上我有一个直接绑定到 Product 类的 bindingSource 控件。

在运行时，我向 BindingSource 提供 Product 类的实例，并且该类包含`ProductType`. 为简单起见，我还在`List<ProductType>`Product Class 中添加了一个 ProductTypes，它在查询时会自行加载，这意味着我可以使用相同的 bindingSource 并选择`ProductTypes`Data Member 作为下拉列表的 Datasource。

运行表单后，列表完美绑定，我可以看到列出的所有产品类型，我可以选择一个并选项卡或单击下一个字段。但显然选定的值不会绑定，因为我没有为下拉列表选择任何绑定-SelectedValue，只有一个数据源。只要我确保下拉通过绑定到 Bindings-SelectedValue 来修改 Product 的实例，然后运行表单，列表仍然会完美填充，只要我不这样做，我就可以通过控件进行选项卡从下拉列表中进行选择。如果我从下拉列表中进行选择，则下拉列表**将保持焦点**. 我无法为爱或金钱选择标签，甚至无法单击表单上的取消按钮，右上角的关闭按钮是我唯一可以单击的有效按钮，我无法单击任何其他字段或下拉菜单。一旦做出选择，这将影响所有三个下拉列表。

有人知道我缺少什么吗？

我尝试改变一些事情，并通过将下拉值提供一个字符串 [] 而不是对象的成员来取得一些成功。这似乎有效，但破坏了使用数据绑定的对象，不是吗？

任何帮助表示赞赏！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-14T16:48:30.910

只是在这里猜测，因为我现在没有时间设置测试和确认，但是你在做任何验证吗？我似乎记得如果内容不验证，数据绑定控件不会让你离开。即使您没有明确说明，尝试将 CausesValidation 设置为 False 以查看是否有任何类型的验证在幕后进行，这至少可以给您一个提示。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-08-06T14:58:45.287

感谢您对此的投入，帮助我解决了这个问题。

就我而言，事实证明在我的 ComboBox.Validating 事件的 EventHadler 之一中引发了异常。很难追踪，因为 IDE 没有向我显示该异常。我能够修改异常行为（在调试菜单中）并让它向我显示任何被抛出的 InvalidOperationException，然后我能够追踪它。

正如 Tom 建议的那样，关闭 CuasesValidation 是解决问题的关键。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T21:22:01.077

对于 Infragisticst 下拉菜单（可能不适用于其他 winform 下拉菜单）：如果您将“LimitToList”设置为 true，您可能会陷入无法在没有意识到的情况下退出的下拉菜单。甚至使用 ItemNotInList 来触发警告消息。

# nhibernate - 通过 NHibernate 进行 DB 端加密

> ID：290630
> 
> 赞同：1
> 
> 时间：2008-11-14T16:22:22.947
> 
> 标签：nhibernate, encryption

我们希望通过 NHibernate 使用 DB 端加密来加密字段（我们遇到的大多数示例都是应用端，这不是我们想要的）。这个问题已经提出了几次，但似乎还没有答案。

例如，在 SQL Server 2005 上，暂时忘记与密钥相关的问题，这意味着 INSERTing EncryptByKey(Key_GUID(MyKey), MyValueToEncrypt) 和 SELECTing DecryptByKey(MyEncryptedField)。属性可能是字符串，而字段必须是 varbinary。

通过组合成对的属性，一个映射到自定义用户类型，另一个映射到公式属性，我们模糊地找到了某个地方 - 使用 upper() 和 lower() 代替加密函数。

但是，如果有人对如何以更好的方式做到这一点有任何想法，我们将不胜感激一些指针：o）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-20T14:45:50.843

[在NHibernate 论坛](http://forum.hibernate.org/viewtopic.php?p=2400105#2400105)上发布了令人讨厌的 hack 的大纲

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T09:23:09.857

感谢您的反馈！我们将 MindLib 方法保留为最后的手段，因为它有效地将数据所有权从数据库转移到了应用程序。据我们所知，启用 TDE 的数据库（例如 SQL Server 2008 或 Oracle 10.2）可以解决问题，但并非所有客户都愿意花钱升级；o)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-15T17:52:00.190

SourceForge 上有一个项目 MindLib，它具有有用的 NHibernate 实用函数和库。其中之一是允许您存储加密字符串的 EncryptedString 库。不幸的是，这并没有按照您最初的要求在服务器端进行。

我一直在寻找类似的东西。我唯一能想到的就是在 SQL Server 中创建一个用户函数来加密字符串。像[这样](http://www.sql-server-helper.com/functions/string-encryption.aspx)的东西。

[MindLib 加密字符串](http://mindlib.wiki.sourceforge.net/EncryptedStringType)

# c++ - 如何重载不接受或不返回 ostream 的 operator<<

> ID：290632
> 
> 赞同：5
> 
> 时间：2008-11-14T16:22:50.230
> 
> 标签：c++, templates, operator-overloading

**原始问题**

我正在编写一个日志类，目标是能够做到这一点：

```
// thread one
Logger() << "Some string" << std::ios::hex << 45;
// thread two
Logger() << L"Some wide string" << std::endl; 
```

目前我的 Logger 标头看起来像这样：

```
#pragma once;
#include <ostream>    
class Logger
{
public:
    Logger();
    ~Logger();

    std::ostream* out_stream;
};

template <typename T>
Logger& operator<< (Logger& logger, T thing) {
    *logger.out_stream << thing;
    return logger;
} 
```

关于这个类的一些注意事项：

1.  跨平台兼容性不是问题。
2.  在 Logger.cpp 内部有一个单例类负责创建“真正的”ostream。
3.  Logger 构造函数和解构函数执行必要的单例锁定。

我有三个问题：

*   如何使 operator<< 函数成为朋友或成员，以便我可以将 out_stream 设置为私有？
*   如何使 operator<< 函数适用于操纵器？
*   如何添加专业化，以便如果 T 是 WCHAR* 或 std::wstring，它将在将其传递给 out_stream 之前将其转换为 char* 或 std::string？（我可以进行转换。在我的情况下，丢失高 unicode 字符不是问题。）

**答案中学到的东西总结：**

*   将模板放在朋友之前而不是之后。
*   std::ios::hex 不是操纵器。std::hex 是一个操纵器。

**最终结果**

```
#pragma once
#include <ostream>
#include <string>

std::string ConvertWstringToString(std::wstring wstr);

class Logger
{
public:
    Logger();
    ~Logger();

    template <typename T>
    Logger& operator<< (T data) {
        *out << data;
        return *this;
    }
    Logger& operator<< (std::wstring data) {
        return *this << ConvertWstringToString(data);
    }
    Logger& operator<< (const wchar_t* data) {
        std::wstring str(data);
        return *this << str;
    }

private:
    std::ostream* out;
}; 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-14T16:29:55.053

您可以使用朋友定义，它将在类的周围命名空间中定义运算符，并使其仅对运算符重载决议可见（不能使用 ::operator<<... 语法手动调用）：

```
class Logger
{
public:
    Logger();
    ~Logger();

    std::ostream* out_stream;

    template <typename T>
    friend Logger& operator<< (Logger& logger, T thing) {
        *logger.out_stream << thing;
        return logger;
    }

    /* special treatment for std::wstring. just overload the operator! No need
     * to specialize it. */
    friend Logger& operator<< (Logger& logger, const std::wstring & wstr) {
        /* do something here */
    }

}; 
```

另一种方法是，为了保持你的代码不变并且只是让 operator<< 模板成为朋友，你可以将这一行添加到你的类定义中：

```
template <typename T>
friend Logger& operator<< (Logger& logger, T thing); 
```

对于机械手问题，我将给你我前段时间写的代码：

```
#include <iostream>
#include <cstdlib>
using namespace std;

template<typename Char, typename Traits = char_traits<Char> >
struct logger{
    typedef std::basic_ostream<Char, Traits> ostream_type;
    typedef ostream_type& (*manip_type)(ostream_type&);
    logger(ostream_type& os):os(os){}
    logger &operator<<(manip_type pfn) {
        if(pfn == static_cast<manip_type>(std::endl)) {
            time_t t = time(0);
            os << " --- " << ctime(&t) << pfn; 
        } else
            os << pfn;
        return *this; 
    }
    template<typename T> 
    logger &operator<<(T const& t) { 
        os << t; 
        return *this;
    }
private:        
    ostream_type & os;
};

namespace { logger<char> clogged(cout); }
int main() { clogged << "something with log functionality" << std::endl; } 
```

};

**请注意，它是 std::hex ，但不是 std::ios::hex**。后者用作`setf`流功能的操纵器标志。请注意，对于您的示例，不需要对操纵器进行特殊处理。仅需要对 std::endl 进行上述特殊处理，因为当使用 std::endl 时，我还会流式传输时间。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-14T16:32:14.533

使用模板是正确的方法，但您只需要确保模板在**头**文件（`logger.h`或任何您调用的文件）中，*而不是*在实现文件（`logger.cpp`）中。这将自动适用于`operator <<`使用`std::ostream`. 它还将自动与流操纵器对象一起使用——这些实际上只是带有`std::ostream`参数`operator <<`的函数，并且只是在`ostream`.

您可以`operator <<`按如下方式创建朋友功能：

```
template <typename T> friend Logger& operator<< (Logger& logger, T thing); 
```

特化很容易 - 只需使用模板特化（同样，在头文件中）：

```
template <typename T>
Logger& operator<< (Logger& logger, T thing) {
    *logger.out_stream << thing;
    return logger;
}

// Template specialization - the "template <>" part is necessary
template <>
Logger& operator<< (Logger& logger, const wchar_t *wstr)
{
  // convert wstr to an ANSI string and log it
}

template <>
Logger& operator<< (Logger& logger, const std::wstring & wstr)
{
  // convert wstr to an ANSI string and log it
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-14T18:13:25.047

无需友谊声明：

```
class Logger
{
public:
    Logger();
    ~Logger();

template <typename T>
inline Logger& Display(T thing)
{
   *out_stream << thing;
    return *this;
}
private:
    std::ostream* out_stream;
};

template <typename T>
Logger& operator<< (Logger& logger, T thing) 
{
    return logger.Display(thing);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-14T16:26:55.043

为什么不使用 printf 方式并使用多参数方法（使用三个点...）。这仍然为您提供了很多格式化能力，并且不会像使用 << 时那样混乱。

例如：

```
Logger("This is my log msg %0X", 45); 
```

等两秒钟，我会为您提取代码示例。

编辑：

```
void Logger(const char* format, ...)
{
    char szMsg[3000];

    va_list args;
    va_start( args, format );
    vsnprintf( szMsg, sizeof(szMsg) - 1, format, args );
    va_end(args);

    // code to print szMsg to a file or whatever here
} 
```

如果你想把它用作一个类而不是一个独立的函数，你可以重载记录器运算符 ()，它的工作原理是一样的

# performance - 性能计数器的性能影响是什么

> ID：290634
> 
> 赞同：45
> 
> 时间：2008-11-14T16:23:11.617
> 
> 标签：performance, performancecounter

在考虑将性能计数器用作我公司的基于 .NET 的站点时，我想知道使用它们的开销有多大。

我是想让我的网站不断更新它的计数器还是我最好只在我测量时才这样做？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-11-03T12:49:13.227

设置性能计数器的开销通常不足以担心（设置共享内存区域和一些 .NET 对象，以及 CLR 开销，因为 CLR 实际上为您进行管理）。这里我指的是 PerformanceCounter 之类的类。

注册性能计数器的开销可能相当慢，但通常不是问题，因为它打算在设置时发生一次，因为您想更改机器范围的状态。你所做的任何复制都会使它相形见绌。这通常不是您想要在运行时做的事情。这里我指的是 PerformanceCounterInstaller。

更新性能计数器的开销通常归结为在共享内存上执行互锁操作的成本。这比正常的内存访问要慢，但它是一个处理器原语（这就是它如何在包括缓存在内的整个内存子系统中进行原子操作）。一般来说，这个成本并不高，不用担心。它可能是正常内存操作的 10 倍，可能更糟，具体取决于更新以及线程和 CPU 之间的争用情况。但是考虑到这一点，对于具有原子更新的跨进程通信，实际上不可能比互锁操作做得更好，并且不持有任何锁。这里我指的是 PerformanceCounter.Increment 和类似的方法。

读取性能计数器的开销通常是从共享内存中读取。正如其他人所说，您希望在合理的时间段内进行采样（就像任何其他采样一样），但只需考虑 PerfMon 并尝试将采样保持在人类规模（考虑秒而不是毫秒）并且您可能不会有任何问题。

最后，对体验的吸引力：性能计数器非常轻量级，以至于它们在 Windows 中无处不在，从内核到驱动程序再到用户应用程序。微软在内部依赖它们。

建议：性能计数器的真正问题是理解的学习曲线（适中）和衡量正确事物的曲线（看起来很容易，但你经常弄错）。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-11-14T17:08:31.590

更新时对性能的影响可以忽略不计。Microsoft 的意图是您始终写入性能计数器。正是对那些性能计数器的监视（或捕获）会导致性能下降。所以，只有当你使用像 perfmon 这样的东西来捕获数据时。

实际上，性能计数器对象将仅具有“在测量时执行”的效果。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2010-05-21T15:23:44.193

我已经测试了很多。

在一台旧的 compaq 1Ghz 1 处理器机器上，我能够创建大约 10,000 个计数器并远程监控它们大约 20% 的 CPU 使用率。这些不是自定义计数器，只是检查 CPU 或其他什么。

基本上，您可以监控任何体面的较新机器上的*所有*计数器，而影响很小。

对象的实例化可能需要很长时间，几秒钟到几分钟。我建议你为你收集的所有计数器多线程，否则你的应用程序将永远坐在那里创建这些对象。不确定 MS 在创建需要这么长时间后会做什么，但是您可以同时为 1000 个计数器和 1000 个线程执行此操作，同时您可以为 1 个计数器和 1 个线程执行此操作。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-07-14T14:34:18.117

性能计数器只是指向共享内存（也称为内存映射文件）中 4/8 字节的指针，因此它们的成本与访问 int/long 变量的成本非常相似。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-14T17:34:59.977

我同意着名的火腿三明治，但要补充一点，只要您的采样率合理（5 秒或更多）并且您监控一组合理的计数器，那么测量的影响也可以忽略不计（在大多数情况下）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-14T17:03:50.973

我发现对于大多数应用程序来说它并没有那么慢。我不会把它放在一个紧密的循环中，或者每秒调用数千次的东西。

其次，我发现以编程方式创建性能计数器非常慢，因此请确保您事先创建它们而不是在代码中。

# java - 在 linux 上使用 Java 6，如何确保使用 ipv4 套接字？

> ID：290635
> 
> 赞同：10
> 
> 时间：2008-11-14T16:23:23.677
> 
> 标签：java, linux, networking, jdk1.6

我正在尝试编写一个快速的小型 java 应用程序来读取 pcap 文件的内容（来自 Wireshark）并在 linux 机器上的网络上播放数据。该文件将仅包含 UDP 广播数据包，因此我的应用程序只需要数据包中的时间戳、端口号和数据来执行我需要的操作。我的问题是我尝试使用此代码测试的应用程序正在侦听 Windows 上的 IPv4 UDP 广播。我的测试应用程序不断打开一个 IPv6 套接字来发送数据。

我`netstat -a -u -p`用来确定套接字是 udp6 套接字。在 Windows 上，我知道它不是。

在java中强制Linux上的测试应用程序打开udp或udp4套接字的最简单或最佳方法是什么？我不想每次都被迫提供 ipv4 网络地址。我希望能够将此代码移动到另一台机器上，而不必记住它们是一些需要更改的配置。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-14T16:38:57.187

将 -Djava.net.preferIPv4Stack=true 添加到您的 Java 应用程序运行时属性。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-12-01T07:36:11.663

您也可以使用此命令（以 root 身份），并且不需要在每个 java 应用程序中添加 -Djava.net.preferIPv4Stack=true 参数：

```
 # echo 0 > /proc/sys/net/ipv6/bindv6only 
```

如果你想永远保持这个配置，你可以在一些初始脚本中编写它。

# javascript - TinyMCE 插件构建

> ID：290636
> 
> 赞同：2
> 
> 时间：2008-11-14T16:23:29.137
> 
> 标签：javascript, tinymce

我正在为 TinyMCE 修改现有的拼写检查插件。

这是应该发生的事情： 1\. 用户点击“空格”并运行拼写检查。2\. 如果单词拼写错误，单词会被 span 包裹起来并带有红色下划线

我发现发生的事情是，当用户点击空格键时，单词确实会进行拼写检查，但光标会弹回到刚刚输入的单词的末尾（而不是空格所在的位置）（您可以在[http： //mail.solidhouse.com/webmail2/test.html](http://mail.solidhouse.com/webmail2/test.html) )

这是我的伪代码： var b = this.editor.selection.getBookmark(); //对于每个节点 node.nodeValue.replace(r5, '$1$2'); this.editor.selection.moveToBookmark(b);

我怀疑 moveToBookmark 将光标保持在元素内，但我不知道该怎么做才能解决这个问题。

（我尝试增加 b.start 和 b.end 但这不起作用）

我知道这很难解释。非常感谢您对此的任何想法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-10-28T11:25:17.740

如果您还没有尝试将书签开始/结束增加 2 而不是 1。由于下划线在拼写错误的单词周围添加了一个标签，因此需要在书签中考虑另外 2 个位置：跨度的每一侧都有 1 个。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-16T04:01:43.860

你能通过抓住它的父元素来摆脱它吗？

```
this.parentNode.moveToBookmark(b); 
```

或类似的东西。

# .net - 散列一组 GUID 的最快方法

> ID：290645
> 
> 赞同：2
> 
> 时间：2008-11-14T16:26:56.133
> 
> 标签：.net, guid, hashcode

我有一个 n 个 GUID 的列表，我需要将它们散列成一个值。该值可以是 Guid 对象的大小或 Int32 的大小，这并不重要，但它确实需要在统计上是唯一的（比如可能类似于 MD5）。

因此，一种方法可能是对它们进行排序，连接字节并获取所有字节的 MD5 哈希......但这不是很快。

另一个想法：我注意到在 .NET 中将组合对象的 GetHashCode 方法实现为组合对象的哈希码的 XOR 是相当标准的做法。因此，对我的 GUID 列表进行异或运算在数学上是否合理？

欢迎任何想法！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-14T16:29:31.823

如果您希望哈希对*集合*有效（即顺序无关紧要），那么对每个 GUID 的哈希码进行异或运算是一个不错的选择。

如果您实际上有*一系列*GUID 并且顺序很重要，那么我建议使用我[在另一个答案中](https://stackoverflow.com/questions/263400/what-is-the-best-algorithm-for-an-overridden-systemobjectgethashcode#263416)写过的相同方法- 重复添加/相乘。

（请注意，对哈希码进行异或可能不会得到与对 GUID 本身进行异或然后对结果进行哈希处理相同的答案。可能是这样，但这取决于 GUID.GetHashCode() 的实现。我会对每个值和对结果进行异或运算——除此之外，这很容易实现。）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-14T16:50:13.623

不要对 GUID 进行异或运算，然后对结果进行哈希处理。除非您使用小于 GUID 的散列，否则您无法通过简单地对 GUID 进行异或运算获得任何收益。

由于您似乎真的很关心性能，因此提供更多信息会很有用 - 特别是，您是否使用内存中的 GUID 的不同组合（因此您可以在创建它们时只对它们进行一次哈希处理），或者您是否正在加载它们并处理它们，并且重复的 GUID 不太可能？

# c# - 在 ADO.NET 中获取输出参数值

> ID：290652
> 
> 赞同：99
> 
> 时间：2008-11-14T16:28:33.930
> 
> 标签：c#, .net, ado.net

我的存储过程有一个输出参数：

```
@ID INT OUT 
```

如何使用 ado.net 检索它？

```
using (SqlConnection conn = new SqlConnection(...))
{
    SqlCommand cmd = new SqlCommand("sproc", conn);
    cmd.CommandType = CommandType.StoredProcedure;

    // add parameters

    conn.Open();

    // *** read output parameter here, how?
    conn.Close();
} 
```

* * *

## 回答 #1

> 赞同：123
> 
> 时间：2008-11-14T17:24:28.653

另一个响应显示了这一点，但本质上您只需要创建一个`SqlParameter`，将其设置`Direction`为`Output`，并将其添加到`SqlCommand`的`Parameters`集合中。然后执行存储过程，获取参数的值。

使用您的代码示例：

```
// SqlConnection and SqlCommand are IDisposable, so stack a couple using()'s
using (SqlConnection conn = new SqlConnection(connectionString))
using (SqlCommand cmd = new SqlCommand("sproc", conn))
{
   // Create parameter with Direction as Output (and correct name and type)
   SqlParameter outputIdParam = new SqlParameter("@ID", SqlDbType.Int)
   { 
      Direction = ParameterDirection.Output 
   };

   cmd.CommandType = CommandType.StoredProcedure;
   cmd.Parameters.Add(outputIdParam);

   conn.Open();
   cmd.ExecuteNonQuery();

   // Some various ways to grab the output depending on how you would like to
   // handle a null value returned from the query (shown in comment for each).

   // Note: You can use either the SqlParameter variable declared
   // above or access it through the Parameters collection by name:
   //   outputIdParam.Value == cmd.Parameters["@ID"].Value

   // Throws FormatException
   int idFromString = int.Parse(outputIdParam.Value.ToString());

   // Throws InvalidCastException
   int idFromCast = (int)outputIdParam.Value; 

   // idAsNullableInt remains null
   int? idAsNullableInt = outputIdParam.Value as int?; 

   // idOrDefaultValue is 0 (or any other value specified to the ?? operator)
   int idOrDefaultValue = outputIdParam.Value as int? ?? default(int); 

   conn.Close();
} 
```

获取时要小心`Parameters[].Value`，因为需要将类型转换为`object`您声明的类型。并且`SqlDbType`创建时使用的`SqlParameter`需要匹配数据库中的类型。如果您只想将其输出到控制台，您可能只是在使用`Parameters["@Param"].Value.ToString()`（通过`Console.Write()`or`String.Format()`调用显式或隐式地使用）。

编辑：超过 3.5 年和近 2 万次观看，没有人费心提及它甚至没有编译，原因是我在原始帖子中的“小心”评论中指定的原因。好的。根据@Walter Stabosz 和@Stephen Kennedy 的好评修复它，并匹配@abatishchev 问题中的更新代码编辑。

* * *

## 回答 #2

> 赞同：61
> 
> 时间：2012-02-14T12:46:33.547

对于希望使用带有存储过程的阅读器执行类似操作的任何人，请注意阅读器必须关闭才能检索输出值。

```
using (SqlConnection conn = new SqlConnection())
{
    SqlCommand cmd = new SqlCommand("sproc", conn);
    cmd.CommandType = CommandType.StoredProcedure;

    // add parameters
    SqlParameter outputParam = cmd.Parameters.Add("@ID", SqlDbType.Int);
    outputParam.Direction = ParameterDirection.Output;

    conn.Open();

    using(IDataReader reader = cmd.ExecuteReader())
    {
        while(reader.Read())
        {
            //read in data
        }
    }
    // reader is closed/disposed after exiting the using statement
    int id = outputParam.Value;
} 
```

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2008-11-14T16:36:13.307

不是我的代码，而是我认为的一个很好的例子

来源：[http ://www.eggheadcafe.com/PrintSearchContent.asp?LINKID=624](http://www.eggheadcafe.com/PrintSearchContent.asp?LINKID=624)

```
using System; 
using System.Data; 
using System.Data.SqlClient; 

class OutputParams 
{ 
    [STAThread] 
    static void Main(string[] args) 
    { 

    using( SqlConnection cn = new SqlConnection("server=(local);Database=Northwind;user id=sa;password=;")) 
    { 
        SqlCommand cmd = new SqlCommand("CustOrderOne", cn); 
        cmd.CommandType=CommandType.StoredProcedure ; 

        SqlParameter parm= new SqlParameter("@CustomerID",SqlDbType.NChar) ; 
        parm.Value="ALFKI"; 
        parm.Direction =ParameterDirection.Input ; 
        cmd.Parameters.Add(parm); 

        SqlParameter parm2= new SqlParameter("@ProductName",SqlDbType.VarChar); 
        parm2.Size=50; 
        parm2.Direction=ParameterDirection.Output; 
        cmd.Parameters.Add(parm2); 

        SqlParameter parm3=new SqlParameter("@Quantity",SqlDbType.Int); 
        parm3.Direction=ParameterDirection.Output; 
        cmd.Parameters.Add(parm3);

        cn.Open(); 
        cmd.ExecuteNonQuery(); 
        cn.Close(); 

        Console.WriteLine(cmd.Parameters["@ProductName"].Value); 
        Console.WriteLine(cmd.Parameters["@Quantity"].Value.ToString());
        Console.ReadLine(); 
    } 
} 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2017-02-18T05:45:09.910

```
public static class SqlParameterExtensions
{
    public static T GetValueOrDefault<T>(this SqlParameter sqlParameter)
    {
        if (sqlParameter.Value == DBNull.Value 
            || sqlParameter.Value == null)
        {
            if (typeof(T).IsValueType)
                return (T)Activator.CreateInstance(typeof(T));

            return (default(T));
        }

        return (T)sqlParameter.Value;
    }
}

// Usage
using (SqlConnection conn = new SqlConnection(connectionString))
using (SqlCommand cmd = new SqlCommand("storedProcedure", conn))
{
   SqlParameter outputIdParam = new SqlParameter("@ID", SqlDbType.Int)
   { 
      Direction = ParameterDirection.Output 
   };

   cmd.CommandType = CommandType.StoredProcedure;
   cmd.Parameters.Add(outputIdParam);

   conn.Open();
   cmd.ExecuteNonQuery();

   int result = outputIdParam.GetValueOrDefault<int>();
} 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2015-11-11T12:49:55.617

```
string ConnectionString = ConfigurationManager.ConnectionStrings["DBCS"].ConnectionString;
using (SqlConnection con = new SqlConnection(ConnectionString))
{
//Create the SqlCommand object
SqlCommand cmd = new SqlCommand(“spAddEmployee”, con);

//Specify that the SqlCommand is a stored procedure
cmd.CommandType = System.Data.CommandType.StoredProcedure;

//Add the input parameters to the command object
cmd.Parameters.AddWithValue(“@Name”, txtEmployeeName.Text);
cmd.Parameters.AddWithValue(“@Gender”, ddlGender.SelectedValue);
cmd.Parameters.AddWithValue(“@Salary”, txtSalary.Text);

//Add the output parameter to the command object
SqlParameter outPutParameter = new SqlParameter();
outPutParameter.ParameterName = “@EmployeeId”;
outPutParameter.SqlDbType = System.Data.SqlDbType.Int;
outPutParameter.Direction = System.Data.ParameterDirection.Output;
cmd.Parameters.Add(outPutParameter);

//Open the connection and execute the query
con.Open();
cmd.ExecuteNonQuery();

//Retrieve the value of the output parameter
string EmployeeId = outPutParameter.Value.ToString();
} 
```

字体[http://www.codeproject.com/Articles/748619/ADO-NET-How-to-call-a-stored-procedure-with-output](http://www.codeproject.com/Articles/748619/ADO-NET-How-to-call-a-stored-procedure-with-output)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-10-08T07:14:11.400

您可以通过以下代码获得结果::

```
using (SqlConnection conn = new SqlConnection(...))
{
    SqlCommand cmd = new SqlCommand("sproc", conn);
    cmd.CommandType = CommandType.StoredProcedure;

    // add other parameters parameters

    //Add the output parameter to the command object
    SqlParameter outPutParameter = new SqlParameter();
    outPutParameter.ParameterName = "@Id";
    outPutParameter.SqlDbType = System.Data.SqlDbType.Int;
    outPutParameter.Direction = System.Data.ParameterDirection.Output;
    cmd.Parameters.Add(outPutParameter);

    conn.Open();
    cmd.ExecuteNonQuery();

    //Retrieve the value of the output parameter
    string Id = outPutParameter.Value.ToString();

    // *** read output parameter here, how?
    conn.Close();
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2018-05-14T07:20:17.457

***创建 SqlParamObject，它可以让您控制访问参数的方法***

：

> SqlParameter 参数 = 新的 SqlParameter();

*为您的参数设置名称（它应该与您声明一个变量来保存数据库中的值相同）*

：`param.ParameterName = "@yourParamterName";`

*清除值持有者以保存您的输出数据*

：`param.Value = 0;`

*设置您选择的方向（在您的情况下，它应该是输出）*

：`param.Direction = System.Data.ParameterDirection.Output;`

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-06-17T18:27:23.743

这对我来说看起来更明确：

> 诠释？id = outputIdParam.Value 是 DbNull 吗？默认（int？）：输出IdParam.Value；

# asp.net - “App”文件夹的自定义错误？(ASP.NET)

> ID：290662
> 
> 赞同：1
> 
> 时间：2008-11-14T16:31:50.180
> 
> 标签：asp.net, iis, error-handling, web-config

我可以在哪里为我的应用程序中的目录（例如 App_Code、App_Browsers 等）设置自定义错误？我已经在 web.config 中配置了 customErrors 并且按预期工作。例如，

[http://www.mysite.com/bla.aspx](http://www.mysite.com/bla.aspx) > 重定向到 404 页面

但

[http://www.mysite.com/App_Code/](http://www.mysite.com/App_Code/) > 显示“系统找不到指定的文件”。

我的站点没有物理 App_Code 目录。这是我可以在 IIS 中更改的东西吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-16T07:42:02.637

我相信您需要在 IIS 本身中设置错误页面，因为您谈论的请求永远不会到达 ASP.NET 应用程序。您的第一个示例有效的原因是 IIS 识别 .ASPX 扩展名并将其转发到 ASP.NET。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-14T16:12:40.007

您正在尝试从受保护的文件夹中提供内容服务... ??

我认为您可能需要允许访问这些文件夹才能获得您正在寻找的好错误......

[http://www.webdavsystem.com/server/documentation/hosting_iis_asp_net/protected_folders](http://www.webdavsystem.com/server/documentation/hosting_iis_asp_net/protected_folders)

话虽这么说......这些文件夹受到保护是有原因的。

我永远不会把我需要 IIS 服务的任何东西放在受保护的文件夹中。

但总有理由去做某事？在我短暂的一生中，我打破了一些规则:)

**更新：**

当我在本地尝试时发现了这个：http: [//support.microsoft.com/kb/942047/](http://support.microsoft.com/kb/942047/)

看起来那些保留的目录会抛出特殊的 404，您也许可以让 IIS 以 404.8 类型为目标...而不向这些目录开放服务

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T20:55:37.590

一种方法是在 global.asax 文件中提供重定向：

```
 void Application_Error(object sender, EventArgs e) 
{
    //uncomment this to narrow down 'helpful' microsoft messages
    //HttpRequest request = ((HttpApplication)sender).Context.Request; 

    Exception ex = Server.GetLastError();
    //ErrorManager is a custom error handling module
    ErrorManager.ProcessError(ex);
    Response.Redirect("~/error.aspx?error=" + HttpUtility.UrlEncode(ex.Message), true);
} 
```

{附带说明，我遇到了一个我无法追踪的异常 - 它只是说“找不到文件”，但没有说哪个文件丢失了。原来是 css 文件中的损坏的图像参考 - 打破上面代码的第二行有助于识别丢失的文件}

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-14T16:04:18.370

将通配符映射添加到 IIS 以通过 ASP.net 运行所有请求，然后您可以使用 Global.asax 来处理错误。

取自[这里](http://www.asp.net/learn/mvc/tutorial-08-cs.aspx)：

> 按照以下步骤使用 IIS 6.0 创建通配符脚本映射：
> 
> *   右键单击网站并选择属性
> *   选择主目录选项卡
> *   单击配置按钮
> *   选择映射选项卡
> *   单击插入按钮（参见图 4）
> *   将 aspnet_isapi.dll 的路径粘贴到 Executable 字段中（您可以从 .aspx 文件的脚本映射中复制此路径）
> *   取消选中标记为验证文件存在的复选框
> *   单击确定按钮

# c# - C# 对代码行数的惩罚？

> ID：290667
> 
> 赞同：3
> 
> 时间：2008-11-14T16:33:24.547
> 
> 标签：c#, performance, lines-of-code

我的表单中的代码量是否存在限制或性能损失`home.cs`？

我正在 Visual Studio 2008 中用 C# 编写数据库应用程序前端。事情的排列方式是，我使用标签页方式更改显示给最终用户的信息，而不是使用新表单。

来自 VBA/MS Access，我记得如果您检查一定数量的代码行，它会产生错误并且无法编译。C# 会在 Visual Studio 2008 中执行此操作，还是会影响性能？我知道代码可读性可能是个问题，因为一切都在一个地方，但我也可以将其视为在某些情况下的优势。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-14T16:49:32.500

在性能方面，您需要担心的不是 .cs 文件中的代码行，而是运行时表单上可能导致问题的控件数量。如果只是几个选项卡上的几个控件，您将没有问题。如果在许多选项卡上有数百个控件，您可能会遇到性能问题（更不用说可用性问题 - 我个人讨厌具有多行选项卡的选项卡控件）。

此外，如果 UI 的目的更像是向导，您希望用户连续与所有选项卡交互，我认为选项卡不合适。选项卡旨在向用户呈现一组选项，而不需要他们一次查看所有选项。

最后，如果每个选项卡的用途明显不同，我发现将每个功能位封装为单独的表单会更容易。使用选项卡，您至少可以将每个位封装为用户控件，然后让表单上的每个选项卡托管一个用户控件的实例。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-14T17:01:44.240

我能预见的唯一问题是，将来它会很难维护。

尝试将主表单的逻辑尽可能分解为类，以便当您需要添加某些内容时，您可以在不合适的情况下实际执行它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-14T17:00:32.650

如果您正在使用选项卡，您仍然可以创建自定义用户控件来保存选项卡中的内容。为每个选项卡制作一个控件，然后您可以将不同选项卡的代码分开。[这里](http://msdn.microsoft.com/en-us/library/a6h7e207(VS.71).aspx)有 MSDN 上的演练。

针对您上面的评论，关于不显示标签，我真的会重新考虑您是如何处理这个问题的。为什么不简单地将所有用户控件放在主窗体上，必要时在面板中，将它们全部设置为`Dock = DockStyle.Fill`，然后根据要显示的属性更改 Visible 和 Enabled 属性？你可能会让自己变得比需要的更难。

对评论的更多回复 - 您可能正在寻找类似 Java 中的 CardLayout 之类的东西。GNU Classpath 版本的源代码可以在[这里](http://cvs.savannah.gnu.org/viewvc/*checkout*/classpath/java/awt/CardLayout.java?root=classpath&content-type=text%2Fplain)找到，它可能会给你一些关于如何实现它的想法。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-15T17:13:08.380

“我知道代码可读性可能是一个问题，因为一切都在一个地方，但我也可以将其视为某些情况下的优势。”

根据我的经验，这种态度最终会让任何必须在未来维护您的代码的人感到头疼，因为模块化代码是一种公认​​的做法，以便将可能更改的部分或用于明显不同目的的部分分开彼此远离。

话虽如此，我不认为 VS 对文件长度施加了限制，但我认为随着文件变长，尤其是在设计视图和代码视图之间切换时，你会遇到一些令人沮丧的性能下降。

我会敦促您保存您未来的自我和他/她的理智，并将您的代码在逻辑上分解为单独的文件。以后你会感谢自己的！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-14T16:35:19.970

这不应该是一个问题。

只需牢记良好的编码实践并将代码模块化以提高可读性和可维护性。

另一方面，如果您在表单上放置了太多控件，则加载时间可能会更长。如果您想要一个活泼的界面，请将其纳入您的设计。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-14T16:36:00.453

听起来很可怕，但我看不出有什么原因会成为问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-06-29T14:31:40.280

我有一个表格继承了我的新工作，它有超过 30,000 行。它是完全癌变的。在编码和模块化之前请三思！

# sql-server - sqlserver中事务的基本模板

> ID：290668
> 
> 赞同：15
> 
> 时间：2008-11-14T16:33:58.867
> 
> 标签：sql-server, transactions

如果我只是用以下内容包装我的查询：

```
BEGIN TRANSACTION

COMMIT TRANSACTION 
```

如果其中有任何故障，它会自动回滚吗？

通过查看其他代码，他们似乎在检查错误，如果有错误，那么他们执行 GOTO 语句，然后调用 ROLLBACK TRANSACTION

但这似乎是一项工作，必须在每次插入/更新后检查 IF(@@ERROR <> 0)。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-11-14T17:13:03.420

我通常在我的存储过程中做这样的事情。它使事情保持良好和安全，并传递我遇到的任何错误。

```
SET XACT_ABORT ON;

BEGIN TRY
    BEGIN TRANSACTION;

    -- Code goes here

    COMMIT TRANSACTION;
END TRY
BEGIN CATCH
    IF @@TRANCOUNT > 0
        ROLLBACK TRANSACTION;

    DECLARE
        @ERROR_SEVERITY INT,
        @ERROR_STATE    INT,
        @ERROR_NUMBER   INT,
        @ERROR_LINE     INT,
        @ERROR_MESSAGE  NVARCHAR(4000);

    SELECT
        @ERROR_SEVERITY = ERROR_SEVERITY(),
        @ERROR_STATE    = ERROR_STATE(),
        @ERROR_NUMBER   = ERROR_NUMBER(),
        @ERROR_LINE     = ERROR_LINE(),
        @ERROR_MESSAGE  = ERROR_MESSAGE();

    RAISERROR('Msg %d, Line %d, :%s',
        @ERROR_SEVERITY,
        @ERROR_STATE,
        @ERROR_NUMBER,
        @ERROR_LINE,
        @ERROR_MESSAGE);
END CATCH 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-14T16:38:07.127

是的，在它不起作用的情况下显式回滚事务很重要。

我通常告诉我儿子，你只需要刷你想要保留的牙齿。

在这种情况下，您只需回滚您不想执行的命令。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-14T16:41:52.920

如果关闭错误，这将自动回滚事务

```
SET XACT_ABORT ON

BEGIN TRANSACTION
-- CODE HERE
COMMIT TRANSACTION 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-14T16:45:20.667

对于事务控制，您使用开始、提交和回滚。您通过提供 BEGIN TRANSACTION 开始交易。然后你把你需要的各种SQL语句。然后，您通过发出提交或回滚来结束事务。COMMIT TRANSACTION 将在 BEGIN 语句之后提交您对数据库所做的所有更改，并使其永久化。ROLLBACK TRANSACTION 将回滚您在 BEGIN 语句之后对数据库所做的所有更改。但是，它不会更改变量值。

例子：

```
BEGIN TRANSACTION

UPDATE table SET column = 'ABC' WHERE column = '123'

COMMIT TRANSACTION

--//column now has a value of 'ABC'

BEGIN TRANSACTION

UPDATE table SET column = 'ABC' WHERE column = '123'

ROLLBACK TRANSACTION

--//column still has it's previous value ('123') No changes were made. 
```

# java - 使用动态 JVM 语言创建存根数据结构的示例？

> ID：290679
> 
> 赞同：1
> 
> 时间：2008-11-14T16:36:34.383
> 
> 标签：java, algorithm, scala, groovy, stub-data-generation

多年来，我认为我已经看到并尝试了所有可以为复杂对象图生成存根数据结构（假数据）的方法。它总是在java中变得毛茸茸。

```
 *    *    *    *
A---B----C----D----E 
```

（请原谅廉价的 UML）

关键问题是值之间存在某些关系，因此 C 的某个实例可能暗示 E 的给定值。

我所看到的任何在 Java 中应用单个模式或一组模式来解决这个问题的尝试最终都会变得混乱。

我正在考虑 groovy 或任何动态 vm 语言是否可以做得更好。使用闭包应该可以使事情变得更简单。

任何人都可以用（最好）groovy 或 scala 很好地解决这个问题的任何参考/示例？

编辑：我不知道“对象母亲”是模式的名称，但这是我遇到的麻烦：当对象母亲生成的对象结构足够复杂时，你总是会得到Object Mother 内部的一个相当复杂的内部结构（或通过组合多个 Object Mother）。给定一个足够大的目标结构（比如 30 个类），找到实现对象母体的结构化方法真的很困难。既然我知道了模式的名称，我可以更好地用谷歌搜索它；）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-15T03:05:33.677

您可能会发现[Object Mother](http://martinfowler.com/bliki/ObjectMother.html)模式很有用。我在当前的 Groovy/Grails 项目中使用了它来帮助我创建示例数据。

它不是特定于 groovy 的，但是动态语言通常可以更容易地使用鸭子类型和闭包来创建类似的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-04-09T22:06:26.430

我通常使用构建器模式创建对象母亲。

```
public class ItineraryObjectMother
{
    Status status;
    private long departureTime;

    public ItineraryObjectMother()
    {
        status = new Status("BLAH");
        departureTime = 123456L;
    }
    public Itinerary build()
    {
        Itinerary itinerary = new Itinerary(status);
        itinerary.setDepartureTime(departureTime);
        return itinerary;
    }
    public ItineraryObjectMother status(Status status)
    {
        this.status = status;
        return this;
    }
    public ItineraryObjectMother departs(long departureTime)
    {
        this.departureTime = departureTime;
        return this;
    }

} 
```

然后可以这样使用：

```
Itinerary i1 = new ItineraryObjectMother().departs(1234L).status(someStatus).build();
Itinerary i2 = new ItineraryObjectMother().departs(1234L).build(); 
```

正如 Ted 所说，这可以通过动态语言来改进/简化。

# logging - 是否会有 Log4J 2.0 版本（如果有，何时发布）？

> ID：290685
> 
> 赞同：6
> 
> 时间：2008-11-14T16:38:18.093
> 
> 标签：logging, log4j

Log4j 的 v2 似乎已经开发了多年。[Apache Log4J 站点](http://logging.apache.org/)不再列出路线图，开发邮件列表似乎几乎完全是 1.2（非常感谢！），不鼓励使用 v1.3，并且 2.0 分支被列为“实验性” 。信徒该相信什么？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-05-29T14:53:04.403

出于所有实际目的，Log4j 开发已经停滞不前。考虑切换到 logback，log4j 的继任者。Logback 在概念上类似于 log4j，如果你喜欢 log4j，你应该更喜欢 logback。它有许多不错的功能并且有据可查。

披露：我是 log4j 和 logback 项目的创始人。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-29T19:13:52.050

logback 是 log4j 的继承者

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-04T02:22:01.293

今年早些时候，我在 log4j 列表中。最后我知道他们正忙于将 1.3 中的功能向后移植到 1.2.15 分支。在我在那里的几个月里，我从未听说过关于 log4j v 2 的任何消息，所以我认为它几乎被遗弃了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-14T17:10:24.970

那么我猜你已经回答了你自己的问题，开发人员显然很久以前就不再关注 2.0 构建，而是决定继续 1.x 代码库。

如果您在他们的邮件列表中，请询问他们问题的根源。

# c# - 您如何通过用户名监控文件服务器上的文件访问和更改？

> ID：290694
> 
> 赞同：5
> 
> 时间：2008-11-14T16:40:59.867
> 
> 标签：c#, .net, file, monitor, filesystemwatcher

我被要求找到一种方法来监视公司共享文件服务器（简单的 windows 共享目录）上特定文件夹中文件的更改（修改、重命名、删除、移动）。我用 C# 编写了一个简单的应用程序，它使用[FileSystemWatcher](http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.aspx)来监视这些更改并通知它们的特定电子邮件地址。

我现在想知道的是如何找出进行这些更改的用户/计算机的名称/IP。有任何想法吗？

作为编写我自己的软件的替代方案，是否有任何支持此功能的好（可能是免费的）软件？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-14T16:43:41.717

使用审核 - 当您获取文件/文件夹的属性时，它位于安全选项卡上。您指定要审核哪些用户的访问权限。您还必须使用安全策略 mmc 管理单元打开审核。审核将最终出现在安全日志中。

来自 MS 的详细说明：http: [//support.microsoft.com/kb/310399](http://support.microsoft.com/kb/310399)

如果您愿意，您的 C# 应用程序可以从安全事件日志中挑选事件。

# c# - 从数据库中插入 html 列表框项目

> ID：290697
> 
> 赞同：0
> 
> 时间：2008-11-14T16:42:24.013
> 
> 标签：c#, html, database, listbox

如何将项目从数据库插入到 html 列表框中？我使用asp c#。我不能让列表框在服务器上运行，因为如果我这样做，应用程序将无法工作。所以我必须将数据库中的值插入到 html 列表框中。我只需要显示 1 列数据。干杯..

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-15T03:04:46.457

您可以使用 Literal，为列表框构建 HTML，并设置 Literal 的 .Text。

[您可以手动](http://htmlhelp.com/reference/html40/forms/select.html)将列表框的 HTML 串在一起，或者您可以在 C# 中构建一个列表框并使用类似的[东西](https://stackoverflow.com/questions/288409/how-do-i-get-the-html-output-of-a-usercontrol-in-net-c)让 C# 将 HTML 字符串导出到 Literal。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-14T17:03:23.907

我可以想到两种方法：

首先，您可以`<asp:Placeholder />`在页面上放置一个标签，并在代码中生成列表框：

```
var select = new HtmlSelect() { Size = 5 };

//assuming the data has been placed in an IEnumarble
foreach (var item in items)
{
    select.Items.Add(new ListItem() { Value = item });
}
selectPlaceholder.Controls.Add(select); 
```

其次，您可以创建一个 WebService 或 ashx 处理程序来提供数据并从 javascript 填充列表。

# c++ - 警告 C4244：“参数”：从“SIZE_T”转换为“DWORD”，可能丢失数据

> ID：290699
> 
> 赞同：4
> 
> 时间：2008-11-14T16:42:53.170
> 
> 标签：c++, compiler-construction, types, warnings

我需要在我的代码中有一组重载函数，但我得到了转换警告。这是一个测试代码：

```
#include windows.h

void f(DWORD arg){...}

//void f(SIZE_T arg){}

void main(void)
{
DWORD dword=0;
SIZE_T size_t=dword;
f(size_t);

} 
```

编译器给出警告：

```
test.cpp(11) : warning C4244: 'argument' : conversion from 'SIZE_T' to 'DWORD', possible loss of data 
```

如果我取消注释 void f(SIZE_T arg) 我得到

```
test.cpp(5) : error C2084: function 'void f(DWORD)' already has a body 
```

如何避免出现此警告或错误？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-14T16:49:32.343

`size_t`保证为无符号整数类型，但未指定它的位数。它可以等于 a `DWORD`（32 位），也可以是 64 位平台上的 64 位。为了获得最大的可移植性，您不应该假设它具有一定数量的位，这是编译器警告您的。如果您知道您的值永远不会超过 2^32（在 99.99% 的情况下这是一个合理的假设），那么您可以直接转换为 a`DWORD`以消除警告：

```
SIZE_T sz = dword;
f((DWORD)sz);  // no warning here 
```

你得到的错误是因为在你的情况下，`size_t`实际上是 32 位，所以你的两个`f`函数的函数签名是相同的——它们都采用一个无符号的 32 位参数。您必须为它们使用单​​独的名称，以确保您的程序可在 32 位和 64 位平台之间移植：

```
void f_DWORD(DWORD arg) { ... }
void f_size_t(size_t arg) { ... } 
```

最后一点：`size_t`是一种内置类型。 `SIZE_T`是非标准的，几乎可以肯定是 typedef 或 #define for `size_t`. 您应该使用`size_t`instead of `SIZE_T`，并且您还应该避免命名您的 variables `size_t`，因为这会通过使用变量名称来隐藏类型名称来引入混淆。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-15T00:52:25.753

最简单的答案是摆脱`f(DWORD)`并重新定义它`f(size_t)`。当然，除非对 s`f()`以外的值进行操作`size_t`。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2016-05-05T12:02:10.150

SIZE_T 在 64 位系统中占用 8 个字节，而 DWORD 占用 4 个字节

从[Windows 数据类型](https://msdn.microsoft.com/en-us/library/windows/desktop/aa383751(v=vs.85).aspx)

```
typedef ULONG_PTR SIZE_T;

#if defined(_WIN64)
 typedef unsigned __int64 ULONG_PTR;
#else
 typedef unsigned long ULONG_PTR;
#endif 
```

# filesystems - 如何用很少的空闲磁盘空间连接两个大文件？

> ID：290700
> 
> 赞同：8
> 
> 时间：2008-11-14T16:43:03.123
> 
> 标签：filesystems, concatenation, large-files

假设您有两个要连接在一起的大文件（几 GB），但您的空闲磁盘空间非常少（比如说几百 MB）。也就是说，给定`file1`and `file2`，您希望得到一个文件，该文件是逐字节连接`file1`和在一起的结果，并删除原始文件。`file2`

你不能做明显的事情`cat file2 >> file1; rm file2`，因为在这两个操作之间，你会用完磁盘空间。

欢迎使用免费或非免费工具的任何和所有平台上的解决方案；这是我前几天在下载 Linux ISO 时想到的一个假设问题，由于无线故障，下载在中途中断。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-14T17:23:51.543

找出涉及磁盘扇区改组和文件链操作的巧妙解决方案所花费的时间：2-4 小时

获取/编写软件以进行就地复制和截断所花费的时间：2-20 小时

乘以 50 美元/小时程序员费率中位数：400-1200 美元

1TB USB 驱动器的成本：100-200 美元

理解“机会成本”一词的能力：无价的

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-14T16:59:11.483

我认为困难在于确定如何从原始文件中恢复空间。

我认为以下可能有效：

1.  分配组合大小的稀疏文件。
2.  将第二个文件末尾的 100Mb 复制到新文件的末尾。
3.  截断第二个文件末尾的 100Mb
4.  循环 2&3 直到完成第二个文件（将 2\. 修改到目标文件中的正确位置）。
5.  执行 2&3&4 但使用第一个文件。

这一切都依赖于稀疏文件支持和文件截断立即释放空间。

如果您真的想这样做，那么您应该调查该`dd`命令。哪个可以做复制步骤

另一个答案中的某人给出了一个不需要稀疏文件的简洁解决方案，但确实复制了 file2 两次：

1.  将文件 2 末尾的 100Mb 块复制到新文件 3，以相反的顺序结束。随时截断文件 2。
2.  将文件 3 末尾的 100Mb 块复制到文件 1 中，在文件 1 的末尾以原始顺序结束这些块。随时截断文件 3。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-14T17:56:47.780

[这比我的第一个答案](https://stackoverflow.com/questions/290700/how-can-you-concatenate-two-huge-files-with-very-little-spare-disk-space#290788)略有改进。

如果您有 100MB 可用空间，请从第二个文件复制最后 100MB 并创建第三个文件。截断第二个文件，使其现在小 100MB。重复此过程，直到第二个文件完全分解为单独的 100MB 块。

现在，每个 100MB 文件都可以附加到第一个文件，一次一个。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-14T16:53:32.413

有了这些限制，我希望您需要篡改文件系统；直接编辑文件大小和分配块。

换句话说，忘记打乱任何文件内容块，只需编辑有关这些文件的信息。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-07-24T23:04:34.527

如果文件是高度可压缩的（即日志）：

```
gzip file1

gzip file2

zcat file1 file2 | gzip > file3

rm file1

rm file2

gunzip file3 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-14T17:01:03.117

冒着听起来轻率的风险，您是否考虑过购买更大磁盘的选择？应该会更快...

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-14T17:30:17.270

效率不是很高，但我认为可以做到。

以追加模式打开第一个文件，然后将第二个文件中的块复制到它，直到磁盘几乎满了。对于第二个文件的其余部分，通过随机访问 I/O 将块从您停止的点复制回文件的开头。复制最后一个块后截断文件。重复直到完成。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-14T17:30:55.147

好吧，为了理论上的娱乐，只有你保证不浪费你的时间实际去做：

*   文件分片存储在磁盘上
*   这些碎片链接成一条链

因此，您可以通过以下方式连接文件：

*   将第一个文件的最后一段链接到最后一个文件的第一段
*   更改第一个文件的目录条目以更改最后一个文件和文件大小
*   删除最后一个文件的目录条目
*   清理第一个文件的文件结束标记（如果有）
*   请注意，如果第一个文件的最后一段仅部分填充，则必须将数据“向上”复制到最后一个文件的段以避免文件中间出现垃圾[感谢@Wedge！]

这将是最有效的：最少的更改、最少的复制、不需要备用磁盘空间。

现在去买一个USB驱动器;-)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-14T17:45:07.053

显然，假设这是一个可能的答案，经济的答案是购买更多的存储空间。但它可能不是——嵌入式系统无法附加更多存储空间，甚至无法访问设备本身——比如飞行中的太空探测器。

如果您有一个稀疏文件系统，那么之前提出的基于稀疏文件系统的答案是好的（如果出现问题，它的破坏性除外！）。但是，如果你不这样做呢？

从文件 2 的末尾开始，将块复制到目标文件的开头，然后将它们反转。在每个块之后，您将源文件截断为未复制的长度。对文件 #1 重复此操作。

此时目标文件包含了所有向后的数据，源文件已经没有了。

从 tart 和目标文件的末尾读取一个块，将它们反转并将它们写入另一个来自的位置。向内翻转积木。

完成后，目标文件是源文件的串联。不需要稀疏文件系统，不需要弄乱文件系统。这可以在零字节空闲时执行，因为数据可以保存在内存中。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-14T17:10:40.180

两个想法：

如果您有足够的物理 RAM，您实际上可以将第二个文件完全读入内存，将其删除，然后以附加模式将其写入第一个文件。当然，如果您在删除后但在完成写入之前断电，则您将永远丢失第二个文件的一部分。

暂时减少操作系统功能使用的磁盘空间（例如虚拟内存、“回收站”或类似的）。可能只在 Windows 上使用。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-14T17:12:05.030

我怀疑这是对这个问题的直接回答。您可以将其视为解决问题的替代方法。

我认为可以将第二个文件视为第一个文件的第 2 部分。通常在 zip 应用程序中，我们会看到一个巨大的文件被分成多个部分。如果您打开第一部分，应用程序将自动考虑其他部分进行进一步处理。

我们可以在这里模拟同样的事情。正如@edg 指出的那样，修补文件系统将是一种方法。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-14T21:19:36.730

你可以这样做：

```
head file2 --bytes=1024 >> file1 && tail --bytes=+1024 file2 >file2 
```

你可以根据你有多少额外的磁盘空间来增加 1024，然后重复这个直到所有的字节都被移动。

这可能是最快的方法（就开发时间而言）

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-14T21:36:40.363

您可以通过压缩整个文件系统来获得空间。我相信 NTFS 支持这一点，而且我确信有多种 *nix 文件系统支持它。它还有一个好处是，在复制文件后，您仍然会比开始时剩余更多的磁盘空间。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-19T04:33:55.103

好的，稍微改变一下问题。磁盘上可能还有其他您不需要的东西，但您不知道它是什么或它在哪里。如果你能找到它，你可以删除它，然后也许你会有足够的额外空间。

为了找到这些“肿瘤”，无论是几个大的，还是很多小的，我都使用了一个小采样程序。从目录（或根）的顶部开始，它进行两次传递。在第 1 步中，它遍历目录树，将所有文件的大小相加得到总共 N 个字节。在第 2 步中，它再次遍历目录树，假装它正在读取每个文件。每次通过 N/20 字节时，它都会打印出它正在“读取”的文件的目录路径和名称。所以最终结果是 20 个深度路径名样本，均匀分布在目录下的所有字节中。

然后，只需查看该列表中出现很多您不需要的东西，然后将其吹走。

（这是我用于性能优化的采样方法的空间等效值。）

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2010-02-03T03:07:51.640

“地图”

[http://www.mjmwired.net/kernel/Documentation/filesystems/fiemap.txt](http://www.mjmwired.net/kernel/Documentation/filesystems/fiemap.txt)

# c# - 使用 C# 和 gppg，我将如何构建抽象语法树？

> ID：290709
> 
> 赞同：2
> 
> 时间：2008-11-14T16:47:13.783
> 
> 标签：c#, syntax, tree, abstract, gppg

有没有办法做到这一点几乎是开箱即用的？

我可以编写一个大方法，使用收集到的标记来确定哪些叶子应该放在哪些分支中，最后填充一个 TreeNode 对象，但是由于 gppg 已经使用提供的正则表达式处理了所有事情，我想知道是否有更简单的方法吗？即使没有，任何关于如何最好地解决创建 AST 问题的指针都将不胜感激。

抱歉，如果我说了什么愚蠢的话，我才刚刚开始玩编译器游戏。:)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-05-06T00:39:21.917

1.  在你的语法文件中声明一个属性，它将保留你的 AST 的根：

    ```
    {%
    public BatchNode Batch;
    public ErrorHandler yyhldr;
    private TransformationContext _txContext = TransformationContext.Instance;
    %} 
    ```

2.  使用构建 AST 节点的操作开始编写语法：

    ```
    Batch
        : StatementList {Batch = new BatchNode($1.Statements);}
        ;

    StatementList
        : Statement {$$.Statements = new List<StatementNode>(); $$.Statements.Add($1.Statement); }
        | StatementList Statement   {$$.Statements = $1.Statements; $$.Statements.Add($2.Statement);}
        ; 
    ```

3.  调用解析器：

    ```
    var parser = new Parser.Parser();
    var scanner = new Scanner();
    parser.scanner = scanner;
    scanner.SetSource(sourceString, 0);
    bool result = parser.Parse();
    if (result)
        HandleMyAst(parser.Batch) 
    ```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T17:04:55.043

见 Mgrammar 和奥斯陆...

[http://msdn.microsoft.com/oslo](http://msdn.microsoft.com/oslo)

[http://channel9.msdn.com/pdc2008/TL31/](http://channel9.msdn.com/pdc2008/TL31/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T18:04:45.297

看看[ANTLR](http://antlr.org/)，几年前我用 C# 编写了一个简单的 .NET 编译器。

# sql-server-2005 - SQL Server 2005 复制和订阅服务器上的不同索引

> ID：290717
> 
> 赞同：8
> 
> 时间：2008-11-14T16:52:12.730
> 
> 标签：sql-server-2005, replication, pull, publisher, subscriber

我们有 SQL Server 数据库设置。我们正在设置一个复制方案，其中我们有一个发布者和订阅者。订阅者将用作报告平台，以便我们可以运行我们需要的所有 BI 查询，并且必须访问从我们的客户端接收所有数据的服务器。订阅者设置为从分发器中提取数据。

我们在发布者数据库上没有很多索引，但我们需要在报告服务器（即订阅者）上使用它们。

我的问题是：SQL Server a) 是否允许这种情况，注意订阅者上的任何更改都不会被推送回发布者。b）如果运行快照，我假设它会覆盖我们的索引，我可以阻止这种情况发生吗？c) 这是明智的做法吗？

谢谢。

保罗·金兰

[http://www.topicala.com/](http://www.topicala.com) [http://www.thecompanything.com/](http://www.thecompanything.com)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-15T02:19:13.037

您解释的场景是一种常见的场景，也是使用复制的好处之一。您在订阅者上创建的任何更改或索引都不会发送给发布者，因为这是一个单向过程。如果由于某种原因您必须重新运行快照代理并重新初始化订阅者，那么您将需要在订阅者上重新创建索引。您可以做很多事情来尽量减少重新初始化订阅者的需要，但其中一些需要一些手动步骤。通常，如果您为订阅者保持所有索引创建脚本都是最新的，那么在需要时重新运行它们通常不是什么大问题。

# java - 您可以通过编程方式在 Java 中注册 ActiveX dll 吗？

> ID：290725
> 
> 赞同：2
> 
> 时间：2008-11-14T17:00:34.740
> 
> 标签：java, eclipse, dll, activex

我有一个第三方 ActiveX dll，如果可能的话，我想在运行时以编程方式注册它。这可以用Java完成吗？我正在使用的应用程序是 Windows XP 上的 Eclipse 应用程序。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T22:05:22.410

您可以通过[ProcessBuilder](http://java.sun.com/javase/6/docs/api/java/lang/ProcessBuilder.html)类执行**regsvr32 。**

# asp.net - 多视图控件和 AjaxToolkit 选项卡之间的区别

> ID：290731
> 
> 赞同：2
> 
> 时间：2008-11-14T17:02:17.887
> 
> 标签：asp.net, ajax, ajaxcontroltoolkit

ASP.NET 2.0 中的Multiview 控件与AjaxToolkit 中的Tab 控件之间是否存在主要区别？

除了选项卡控件的内置视觉效果之外，它们处理控件隐藏/显示的方式有什么不同吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-14T17:12:35.683

有很大的不同。Ajax 选项卡控件将完成所有选项卡切换客户端，这意味着切换选项卡时没有回发/回调。每次切换时，传统的选项卡控件都会进行回发。

这意味着 ActiveTabChanged 事件不会触发，除非您将 AutoPostBack 设置为 true。不过，有一个名为 ClientActiveTabChanged 的​​事件会在 javascript 中触发，因此您可以使用它而不是强制回发。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T02:43:42.457

那么，从 DevExpress 中说的商业选项卡控件与使用基于 Javascript 的 Fireworks 制作的选项卡控件有什么区别。

# svn - 使用未版本控制的资源解锁 SVN 工作副本

> ID：290734
> 
> 赞同：12
> 
> 时间：2008-11-14T17:04:02.813
> 
> 标签：svn

我有一个存储库，其中包含一些未版本化的目录和文件。运行 svn 的服务器最近发生了变化，因为结帐是使用 url svn://OLD-IP 完成的，所以我将我的 svn 工作副本重新定位到 url svn://NEW-DOMAIN-NAME。

现在由于有一些未版本化的资源，切换没有正确发生并且工作副本被锁定。由于这些未版本化的资源，清理操作也不起作用。

我在网上查了一下，发现关于 svn ignore 并尝试过，但没有用。我无法释放所有锁。关于解决问题的任何想法？一旦我释放了锁，我相信我可以使用 svn ignore 并进行重定位操作。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-14T17:31:23.243

检查您的`svn status`输出和图例中的字母`svn help status`。

很多时候，问题是存在一个 svn 需要目录的文件，或者其他类似的混淆（字母应该告诉你它是哪个）。如果有任何冲突（`C`），请先解决它们。您可以使用 恢复丢失的目录`svn update`，并且`svn revert`通常也可以提供帮助（如果您的工作副本中有任何重要的东西不在存储库中，请先备份工作副本！）。

在消除了大部分混乱之后，`svn cleanup`/ `svn update`（`svn switch`只不过`update`是 的一种特殊情况`switch`）应该重新开始工作。

在最坏的情况下，您可以再次签出并手动复制任何本地修改的文件。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-08-16T10:58:59.093

只需运行`cleanup`命令，然后执行`update`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-07-20T17:03:21.773

我有这个问题。重命名有问题的目录并从 SVN 重建它，然后复制您修改的文件。可能需要在父目录中运行清理

# asp.net - 避免在 ASP.NET 中的 Auth Session 超时后丢失 PostBack 用户输入

> ID：290739
> 
> 赞同：3
> 
> 时间：2008-11-14T17:06:02.983
> 
> 标签：asp.net, session, forms-authentication

我有一个位于 ASP.NET 表单身份验证后面的表单。到目前为止，实现遵循典型的“开箱即用”类型配置。

一页允许用户发布消息。如果用户长时间坐在该页面上撰写消息，它可能会超过身份验证会话到期时间。在这种情况下，帖子不会被记录……它们只是被重定向到登录页面。

我应该采取什么方法来防止长消息丢失的令人沮丧的事件？

显然，我可以让身份验证会话变得非常长，但是系统中还有其他因素不鼓励这种方法。 **有没有办法让这个特定页面例外，只要它是回发，它就永远不会重定向到登录？**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T18:03:28.203

我的同事使用 HttpModule 提出了解决此类问题的通用解决方案。

请记住，他决定在此特定应用程序中处理自己的身份验证。

开始：

他创建了一个 HttpModule 来检测用户何时不再登录。如果用户不再登录，他会获取该页面的 ViewState 以及所有表单变量并将其存储到一个集合中。之后，用户被重定向到登录页面，其中包含上一页的表单变量和隐藏字段中编码的 ViewState 信息。

用户成功重新验证后，会检查隐藏字段。如果该隐藏字段可用，则会使用旧帖子的表单变量和视图状态填充 HTML 表单。然后使用 Javascript 自动将此表单提交到服务器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T19:02:08.473

请参阅此[相关问题](https://stackoverflow.com/questions/53260/retaining-http-post-data-when-a-request-is-interrupted-by-a-login-page#53315)，其中的答案几乎都是关于登录后保留值的相同概念的主题：

*   登录页面将用户名、密码和以前的 POST 变量发布到引用页面。引用页面登录用户并执行操作。
*   登录页面写出表单变量，成功登录后 Javascript 提交到引用页面
*   AJAX 登录

如果您不关心他们在发布时是否已登录（对我来说似乎有点不确定的安全性......），那么在 IHttpModule 中挂钩 HttpContext.PostAuthenticateRequest 将使您有机会使用 FormsAuthentication.SetAuthCookie 重新登录. 通过设置 HttpContext.User 可以类似地使用 FormsAuthenticationModule.Authenticate 事件：

```
// Global.asax
void FormsAuthentication_OnAuthenticate(object sender, FormsAuthenticationEventArgs e) {
   // check for postback somehow
   if (Request.Url == "MyPage.aspx" && Request.Form["MySuperSecret"] == "123") {
      e.User = new GenericPrincipal(new GenericIdentity(), new string[] { });
   }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-16T07:46:31.723

当会话超时发生时，用户的会话（和页面信息）被释放，这意味着最终的回发将失败。正如其他人所建议的那样，有一些解决方法，但他们都假设您不关心该特定页面上的身份验证和安全性。

我建议使用 Ajax 每 10 分钟左右静默回发一次以保持其活动状态，或者按照您的建议增加会话的超时时间。您可以尝试在您的网络配置中创建一个特定于页面的部分，并在其中包含更长的超时时间。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-16T14:58:30.850

我通过将表单值添加到数据库中处理了一次，由远程 IP 而不是用户 ID 标识。

```
( HttpContext.Request.UserHostAddress ) 
```

然后，登录后，您可以查看当前用户的 IP 地址在数据库中是否有一行，然后执行所需的操作。

迈克尔

# iphone - 通话结束时工具栏向上移动

> ID：290740
> 
> 赞同：1
> 
> 时间：2008-11-14T17:06:56.397
> 
> 标签：iphone, cocoa-touch, toolbar

在通话中，如果用户想要使用我的应用程序，并且如果通话结束，而用户仍在应用程序中，则工具栏向上移动，所有视图都向上移动，因此工具栏现在在底部。基本上“触摸返回通话”的高度有。我正在使用工具栏和导航控制器。导航控制器移动正常，视图中的所有内容都相应移动，唯一的问题是工具栏。所以问题是，是否有一个事件，在调用完成后调用，所以我可以再次设置我的工具栏的框架？我试过这个代表没有运气：

```
- (void)application:(UIApplication *)application willChangeStatusBarFrame:(CGRect)newStatusBarFrame 
```

仅当工具栏更改方向时才调用此选项。

[替代文字 http://is.hn/downloads/IMG_0008.PNG](http://is.hn/downloads/IMG_0008.PNG) [替代文字 http://is.hn/downloads/IMG_0009.PNG](http://is.hn/downloads/IMG_0009.PNG)

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T17:38:19.720

一般来说，正确设置自动调整大小的蒙版应该可以解决问题。您能否更新屏幕截图以准确显示调整大小问题的发生位置？

# java - 如何使用 JNI 将终端输出从 C 程序重定向到 System.out？

> ID：290743
> 
> 赞同：4
> 
> 时间：2008-11-14T17:08:39.450
> 
> 标签：java, c, java-native-interface, stdout

我正在通过打印到标准输出的 JNI 调用 C 库。如何将此输出重定向到 System.out？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-14T17:12:26.697

`System.out` **是** `stdout`。您是否遇到了一些更根本的问题（也许是混淆了输出？）。

由于另一位成员也提到了最后一点 - 我应该进一步解释：

`System.out`并且`stdout`都对应于文件描述符#1。

然而，Java `OutputStream`（和派生类）和 C 的`stdio`库都有自己的（独立的）缓冲机制，以减少对底层`write`系统调用的调用次数。仅仅因为您已经调用`printf`或类似调用，不能保证您的输出会立即出现。

因为这些缓冲方法是独立的，Java 代码中的输出（理论上）可能会混淆，或者相对于 C 代码的输出出现乱序。

如果这是一个问题，您应该`System.out.flush()`在调用 JNI 函数之前安排调用，并且在您的 C 函数中（如果它正在使用`stdio`而不是低级`write`调用），您应该`fflush(stdout)`在返回之前调用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T21:46:12.730

正如 Alnitak 所写，您应该打印到标准输出。您应该注意，消息可能需要一段时间才能出现在屏幕上。如果时间很重要，您应该在打印到标准输出时打印带有消息的时间戳。

# database - 访问数据库替换

> ID：290744
> 
> 赞同：1
> 
> 时间：2008-11-14T17:09:54.673
> 
> 标签：database, ms-access

有谁知道访问数据库的替代品，最好是开源的。我偶尔合作的一个小组正在寻找一个替代数据库，他们需要尽可能少地更改实际 SQL。他们的应用程序是 VB6/COM。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-14T17:15:16.443

SQL Server Express 是最佳选择。它可以免费使用。它使用标准 SQL，您需要更改任何使用 MS Access 函数的查询。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-16T20:49:39.613

再一次，这个问题的措辞太糟糕了，以至于无法回答。

此处是否使用“访问”一词来描述将 MDB 用于数据表并且仅需要替换的情况？

或者

使用“Access”一词是否意味着有一个成熟的 Access 应用程序用作数据库的前端？

如果是前者，那它就不是真正的Access数据库，而是Jet数据库，目前给出的答案都令人满意。

如果是后者，那么没有一个答案可以解决前端应用程序构建工具的问题。如果这是问题所在，那么您就不走运了，因为在开源世界中甚至没有任何东西可以与 Access 相提并论（在我看来，可能永远不会如此）。

但是通过正确使用术语来提出更清晰的问题会很有帮助：

*   ACCESS 是一个应用程序，您可以使用它来构建数据库应用程序前端。
*   JET 是数据库引擎，它是 Access 的默认数据存储。

当您的“Access”数据库中只有数据表时，它只是一个 Jet 数据库（因为您的 MDB 中没有 UI 对象），您应该将其称为 Jet 数据库。对纯数据 MDB 使用“Access”一词（即使您使用 Access 创建它）只会使事情变得混乱。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-14T17:26:06.920

我认为对于这些类型的场景， [**SQLite**](http://www.sqlite.org/)总是值得一提的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-14T17:18:24.407

您可以查看 OpenOffice Base。

当它第一次出现时，我尝试了一段时间，它看起来非常慢，而且功能似乎也不完整。

但它是免费和开源的 :o)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-14T17:22:22.420

OpenOffice.org 提供了一个名为 Base 的免费开源访问数据库应用程序。或者我也建议使用 SQL Server Express。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-16T20:52:28.873

我经常看到这意味着“我可以通过文件复制安装的数据库，并且不需要安装任何软件（服务、驱动程序等）”。

Access 数据库缺少什么他们想要替换它？选项将受到这个问题的答案的限制。

# api - 是否有一个 Restful 博客 API

> ID：290761
> 
> 赞同：5
> 
> 时间：2008-11-14T17:14:54.743
> 
> 标签：api, rest, blogs

我似乎找不到真正宁静的博客 API - 有吗？我正在写一些博客软件，想知道是否有标准的 RESTful API，如果没有，我会去购买 RESTful Web Services 书籍并自己设计。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-14T17:21:41.797

[AtomPub](http://www.atomenabled.org/developers/protocol/#whatIsAtom)怎么样？

> Atom 是基于 XML 的 Web 内容和元数据联合格式的名称，以及用于发布和编辑 Web 资源的应用程序级协议。

它不仅限于博客，但博客当然属于用于“发布和编辑 Web 资源”的应用程序领域。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-02T06:25:20.523

我不了解 REST，但你看过 MetaWeblog API 吗？它虽然是 XML-RPC。

# apache-flex - Flex Builder 3 执行旧的源代码

> ID：290768
> 
> 赞同：4
> 
> 时间：2008-11-14T17:20:33.700
> 
> 标签：apache-flex, flexbuilder, flex-builder-3

我一次又一次地面临这个问题，但找不到任何解决方案（除了我的，我猜这不是一个好的解决方案）。

不知道为什么，有时 Flex Builder 在进行更改后会执行旧的源代码。在调试时，我看到它是如何通过一个不存在的源（例如更改局部变量）的（即使我删除了所有的块或函数）。

我解决这个问题的方法是删除项目（当然是备份源代码）并创建一个新项目，将备份的源添加到项目中并重建。它开始按应有的方式工作，但这种方式不太舒服，尤其是在源位于远程计算机上并且您需要配置 .net 后端的情况下。

有谁知道如何解决？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T17:47:17.143

尝试 Project->Clean 转储所有内容并从头开始重建。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-15T08:32:27.370

是的，我忘了说 - 这也无济于事..通常我在这种情况下尝试的第一件事是关闭自动构建，清理项目并再次构建所有..同样的事情。

我的猜测是，也许 Builder 无法以某种方式重建远程 SWF 并运行旧的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T16:06:24.987

检查您的问题选项卡，如果有任何错误，它将启动最后一个成功的构建。

如果所有问题都解决了，并且它仍然会发生，而不是像 RickDT 所说的那样进行项目清理。

通常，当我从 SVN 更新并且 main.swf 被覆盖时，我必须 1：恢复 main.swf 和 2：执行项目清理以使其再次正常启动:)

我花了一段时间才弄清楚。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-27T08:57:55.537

我也遇到了这个问题。你可以做的是：

1.  在 Flex builder 中执行 clean 命令。
2.  关闭有问题的项目。
3.  在 Windows 资源管理器/Finder 等中转到您的项目文件夹。
4.  删除文件系统中的调试/发布文件夹。
5.  重新打开项目并重建。

问题应该在那之后解决。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-08T01:34:15.793

我已经忍受这个烦人的问题有一段时间了。这开始每隔几天发生一次。我发现的最佳解决方案是 (a) 清理 (b) 在 Windows-> 属性下更改默认 Web 浏览器。我在 FF 和 chrome 之间切换。如果您有更好的解决方案，请告诉我。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-11-15T19:45:44.370

更新：我发现我不正确地使用 SWC 并且实际上将我的项目的一部分编译到其中。当我这样做时，Flash Builder 假设我想改用 SWC 类。我在这里写了一篇关于它的博客文章：http: [//inchwormstudio.com/blog/flash-builder-flash-workflow-and-the-danger-of-careless-swcs/](http://inchwormstudio.com/blog/flash-builder-flash-workflow-and-the-danger-of-careless-swcs/)

ORIGINAL：我最近也遇到了这个问题。到目前为止，Gorro 的解决方案是唯一适合我的解决方案。备份到 SVN 或任何你使用的东西。删除 flex builder 中的项目，包括 HD 上的文件。再次签出项目并重建。这是一个非常烦人的错误，尤其是当我第一次遇到它时，我差点心脏病发作。当您意识到您的源代码很好但编译器只是在做它喜欢的事情时，它有点把 SVN 的安全网抛到了窗外。我应该指出，这发生在 Flash Builder 和 Flex Builder 中。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-04-24T21:21:21.183

我从 HTML 模板目录中删除了 myProject.swf ......似乎当时和那里都对我有用。

# sql-server - 识别 Microsoft SQL Server 2005 中未使用的对象

> ID：290773
> 
> 赞同：17
> 
> 时间：2008-11-14T17:25:31.803
> 
> 标签：sql-server, maintenance

找出一个对象是否被其他东西引用是一项微不足道的任务。我想做的是确定它是否**实际被使用**。

我的解决方案最初涉及包含数据库中对象列表的表和每小时作业的组合。

这项工作做了两件事。首先，它查找自上次运行以来已添加到数据库中的新对象。其次，它查看了sql的对象缓存。如果表中的一个对象列在缓存中，它在表中被标记为最近“看到”在使用中。

在六个月或其他时间结束时，检查表的内容。自从我开始监视以来，表中列出的任何未曾被引用的内容都可能可以安全地备份和删除。

当然，有可能只使用一年一次或其他什么的对象，但它似乎在大多数情况下都有效。

不过，与它一起工作有点痛苦。

我正在使用大约六个数据库，其中大多数都有大量遗留表，这些表在它们的原始创建者转移到其他公司之后仍然存在很长时间。

我正在寻找的是一种相当可靠的方法来跟踪对象（表、视图、存储过程或函数）何时被调用。

对于目前监视此类事情的那些人，您使用什么方法/代码，您会推荐它吗？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-11-15T12:17:46.433

使用 SQL Server 2005，您可以使用动态管理视图 sys.dm_db_index_usage_stats。名称上写着“索引”，但这有点误导 - 每个表在此处都有一个条目，即使它没有任何索引。这是 SQL Magazine 中的一个有用查询：

```
SELECT 
  t.name AS 'Table', 
  SUM(i.user_seeks + i.user_scans + i.user_lookups) 
    AS 'Total accesses',
  SUM(i.user_seeks) AS 'Seeks',
  SUM(i.user_scans) AS 'Scans',
  SUM(i.user_lookups) AS 'Lookups'
FROM 
  sys.dm_db_index_usage_stats i RIGHT OUTER JOIN 
    sys.tables t ON (t.object_id = i.object_id)
GROUP BY 
  i.object_id, 
  t.name
ORDER BY [Total accesses] DESC 
```

这是原始文章：

[http://www.sqlmag.com/Article/ArticleID/53878/sql_server_53878.html](http://www.sqlmag.com/Article/ArticleID/53878/sql_server_53878.html)

请记住，这些使用情况统计信息会在 SQL Server 重新启动时重置。

# c# - 如何在 .NET 中完全摆脱 View State

> ID：290774
> 
> 赞同：6
> 
> 时间：2008-11-14T17:25:43.347
> 
> 标签：c#, .net, asp.net

我怎样才能摆脱：

```
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="..."/> 
```

完全地 ！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-14T17:38:30.733

您需要将 EnableViewState="false" 添加到 Default.aspx 文件中的 @Page 指令。

```
<%@ Page Language="C#" AutoEventWireup="true"
Codebehind="Default.aspx.cs" Inherits="Sample._Default"
EnableViewState="false" %> 
```

然后，将以下代码添加到 Default.aspx.cs 文件中。这会从生成的 HTML 中删除隐藏字段。

```
 #region Disable ViewState
    protected override void SavePageStateToPersistenceMedium(object state)
    {
    }
    protected override object LoadPageStateFromPersistenceMedium()
    {
        return null;
    }
    #endregion 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-14T17:28:40.830

在控制级别，EnableViewState="false"。

在页面级别，Page 指令中的 EnableViewState=false。

在应用程序级别将其添加到 .config，< pages enableViewState="false" >

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-14T17:27:30.707

我认为您可以在 machine.config 中禁用它：

< 页面 enableViewState="false"/>

这应该禁用所有页面的视图状态。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-24T14:43:25.603

```
#region Disable ViewState
protected override void SavePageStateToPersistenceMedium(object state)
{
}
protected override object LoadPageStateFromPersistenceMedium()
{
    return null;
}
#endregion 
```

这太棒了。然而，只是为了让大家知道它仍然在渲染一个空的 viewstate 隐藏字段

```
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="" /> 
```

# c# - Service.Controller 状态/轮询

> ID：290778
> 
> 赞同：3
> 
> 时间：2008-11-14T17:26:56.513
> 
> 标签：c#, windows, visual-studio, winapi

我正在使用的管理应用程序有问题。我正在构建一个界面，用于停止、启动和查询 40 台左右的服务器上的各种服务。

我正在查看 service.controller 并已成功通过按钮事件停止和启动各种服务，但现在我试图找出一种方法将服务状态返回到文本框并每 10 秒查询一次服务状态或所以，我觉得我正在撞到一堵砖墙。

有没有人有任何提示或见解？

谢谢！！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-14T18:08:43.247

您可以使用 Timer 对象触发定期服务检查。您可以对 Elapsed 事件运行服务查询。

```
 private void t_Elapsed(object sender, ElapsedEventArgs e)
    {
        // Check service statuses
    } 
```

至于在文本框中显示状态，您应该能够在服务状态上使用 ToString() 方法并将其显示在常规文本框中。请记住，在对计时器事件做出反应时，您可能在也可能不在 GUI 线程上，因此您需要在主线程上调用自己。

```
 private delegate void TextUpdateHandler(string updatedText);

    private void UpdateServerStatuses(string statuses)
    {
        if (this.InvokeRequired)
        {
            TextUpdateHandler update = new TextUpdateHandler(this.UpdateServerStatuses);
            this.BeginInvoke(update, statuses);
        }
        else
        {
            // load textbox here
        }
    } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-08-08T13:19:19.263

也许你不想投票：

```
Private serviceController As ServiceController = Nothing 
Private serviceControllerStatusRunning = False

Private Sub Form1_Load(sender As Object, e As System.EventArgs) Handles Me.Load
    Try
        serviceController = New ServiceController("NameOfTheTheServiceYouWant")
        If serviceController.Status = ServiceControllerStatus.Stopped Then
            ' put code for stopped status here
        Else
            ' put code for running status here
        End If
        BackgroundWorker1.RunWorkerAsync()
    Catch ex As Exception
        MessageBox.Show("error:" + ex.Message)
        serviceController = Nothing
        Me.Close()
        Exit Sub
    End Try
End Sub

Private Sub BackgroundWorker1_DoWork(sender As System.Object, e As System.ComponentModel.DoWorkEventArgs) Handles BackgroundWorker1.DoWork
    If serviceControllerStatusRunning Then
        serviceController.WaitForStatus(ServiceControllerStatus.Stopped)
        serviceControllerStatusRunning = False
    Else
        serviceController.WaitForStatus(ServiceControllerStatus.Running)
        serviceControllerStatusRunning = True
    End If
End Sub

Private Sub BackgroundWorker1_RunWorkerCompleted(sender As System.Object, e As System.ComponentModel.RunWorkerCompletedEventArgs) Handles BackgroundWorker1.RunWorkerCompleted
     if serviceControllerStatusRunning then
       ' put code for running status here
     else
       ' put code for stopped status here
     end if
     BackgroundWorker1.RunWorkerAsync() ' start worker thread again
End Sub 
```

干杯进化

# oop - 更重要的是代码的可测试性，还是遵守 OOP 原则？

> ID：290779
> 
> 赞同：17
> 
> 时间：2008-11-14T17:27:23.517
> 
> 标签：oop, mocking, tdd

我的团队对 TDD 的演变包括似乎与传统 oop 的不同之处。

1.  远离自给自足的类 我们仍然在适当的地方封装数据。但是为了模拟任何辅助类，我们通常创建一些方法来通过构造函数或修改器从外部设置它们。

2.  我们从不使用私有方法。为了利用我们的模拟框架（RhinoMocks），方法不能是私有的。这是向我们的传统开发者“出售”的最大的一个。在某种程度上，我明白他们的观点。我只是更重视测试。

你怎么认为？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-11-14T17:41:53.457

OOP 只是众多可能的范例之一。它本身不是一个目标，它是达到目的的一种手段。如果其他范例更适合您，您不必编写面向对象的程序。

在你之前无数聪明的人已经说过单元测试在面向函数的语言中往往比面向对象的语言容易得多，因为测试的自然单元*是*一个函数。它不是一个类（可能有私有方法和各种奇怪的状态），而是一个函数。

另一方面，可测试性本身确实具有价值。如果你的代码不可测试，你就不能测试它（很明显），如果你不能测试它，你怎么能说它有效呢？因此，如果您必须选择一个极端或另一个，我当然会选择可测试性。

但一个明显的问题是，你真的需要测试每一个私有方法吗？这些不是一个类的公共契约的一部分，孤立起来可能没有意义。公共方法对测试很重要，因为它们有特定的目的，它们必须履行这个非常特定的契约，并使对象保持一致的状态等等。它们本质上是可测试的，而私有方法可能不是。（谁在乎私有方法的作用？它不是类契约的一部分）

也许更好的解决方案是将一些原本私有的东西重构到单独的类中。也许测试私有方法的需求并不像您想象的那么大。

另一方面，其他模拟框架也允许你模拟私有的东西。

编辑：在进一步考虑之后，我想强调一下，仅仅公开私人成员可能是一个可怕的想法。首先我们有私有成员的原因是：类不变量必须始终保持。外部代码一定不可能使您的类进入无效状态。这不仅仅是 OOP，它也是常识。私有方法只是为了让您在类内部有更精细的粒度，将一些任务分解为多个方法等，但它们通常*不会*保持类不变。他们完成了一半的工作，然后依靠之后调用的其他私有方法来完成另一半。这是安全的，因为它们通常无法访问。只有其他类方法可以调用它们，所以只要它们保持不变量，一切都很好。

因此，虽然是的，您通过将私有方法公开来使它们可测试，但您也引入了单元测试*无法*轻易捕获的错误来源。您可以使用“错误”类。一个设计良好的类总是保持它的不变性，不管它如何被外部代码使用。一旦你把所有东西都公开了，那就不可能了。外部代码可以调用可能不会在该上下文中使用的内部辅助函数，这将使类进入无效状态。

并且单元测试并不能真正保证这不会发生。因此，我会说您可能会引入比您预期的更大的错误来源。

当然，鉴于上述私有成员的定义（那些不保留类不变量的成员），可能可以安全地将许多其他方法公开，因为它们*确实*保留了不变量，因此无需隐藏它们来自外部代码。因此，通过为您提供*更少的*私有方法，但不允许外部代码破坏您的类，这可能会减轻您的问题，如果*一切*都是公共的，这将是可能的。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-14T17:33:12.880

我对 rhinomocks 不熟悉，实际上从未使用过或需要过模拟工具，所以我可能离这里很远，但是：

*   OO原则和TDD之间不应该有*冲突*，因为
*   私有方法不需要进行单元测试，只有公共方法

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-11-14T20:57:58.240

您正在经历的是测试对设计施加了力量。这实际上就是为什么 TDD 主要是一种*设计策略的原因 -**如果*您注意并知道如何阅读这些标志，那么编写测试会强制进行更好的解耦设计。

将“辅助对象”注入类实际上是一件好事。但是，您不应该将它们视为*辅助*对象。它们是常规对象，希望处于不同的抽象级别。它们基本上是策略，用于配置如何填充更高级别算法的细节。（我通常使用构造函数注入它们，并提供另一个自动使用默认生产实现的构造函数，如果有的话。）*但要小心 -根据我的经验，嘲笑也可能过头了。*查看[http://martinfowler.com/articles/mocksArentStubs.html](http://martinfowler.com/articles/mocksArentStubs.html)以了解有关该主题的一些有趣想法。

关于私有方法，我不完全理解这与你的模拟框架有什么关系——通常，你应该模拟只有公共方法的接口，无论如何，它们是公共合同的一部分。

无论如何，在我看来，复杂的私有方法是一种代码味道——这表明该类可能承担了太多责任，违反了单一责任原则。想想什么样的类实际上*不会*违反封装来公开。将方法移动到该类（可能在途中创建它）可能会在耦合和内聚方面改进您的设计。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-14T18:21:36.137

好的 OO 设计不仅仅是封装，也不仅仅是拥有私有方法。

主要的设计气味之一是系统不同部分之间的耦合。在您将帮助程序类注入到您的对象中以测试它们之前，您的对象是如何访问这些帮助程序的？

我的猜测是，通过切换到依赖注入，您降低了系统中的耦合。

还有[开闭原则](http://www.objectmentor.com/resources/articles/ocp.pdf)。通过注入辅助类，您可以对行为进行多态替换。

如果担心在类上显示非私有方法，请通过其接口使用该类，这无论如何都是个好主意，对吧？

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-14T18:28:46.090

可维护性更重要。

不要错过单元测试和 OOP 的共同目标这一点。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-14T18:42:05.987

OOP 是一个工具，而不是一个目标

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-14T17:35:16.760

依赖注入和控制反转是两全其美的好方法。好的设计不应该限制你以不同方式（测试）使用代码的能力，它应该改进它。

我们现在正在重写一大堆单例以使用 DI/IOC，以便我们可以测试它们（即将在您附近的有线电视盒中使用）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-14T17:36:23.933

您还可以研究[依赖注入](http://en.wikipedia.org/wiki/Dependency_injection)作为外部化一些帮助类的一种方式

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-14T17:40:26.190

如果有一个框架限制我使用私有方法之类的东西，我会放弃它。时期。这是大多数语言中需要的基本内容之一。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-14T17:44:58.893

我使用 Rhino Mocks 并且使用了很多私有方法。我通常编写我的类以依赖于接口而不是其他类，因为这使得模拟更容易。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-14T17:55:52.990

关于类范围，您可以使用内部来简化框架（针对最终用户）并在框架项目 AssemblyInfo.cs 中指定

```
[assembly: InternalsVisibleTo("MyAssembly.Tests")]
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-14T18:41:18.423

我不熟悉它们之间的任何冲突。高内聚和低耦合是OO的核心，而这恰好也是测试的核心。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-14T17:33:37.980

作为 Intellisense 的普通用户，所有方法都公开的要求会让我发疯。我个人会在此基础上坚持 OOP。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-14T19:25:27.910

为什么不只使用宏而不是 private 关键字。当您使用“testmode”编译时，这些方法是公开的。否则它们是私有的。使用宏，当你公开使用你的私有方法时，你仍然会收到编译器警告，一旦你编译不是在测试模式下。有趣的是，让您的私有方法未能通过其单元测试并不意味着您的程序中存在错误，尽管它可能等同于拥有一个`CauseBSOD`从未调用过的函数“”。这是一个严重损坏的功能（假设不打算导致 BSOD），但就用户而言，它不是一个错误。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-11-14T21:04:15.217

为什么不能使用仅作为测试类的朋友类？或者，您的测试类派生自具有私有成员的父类。

在我看来，为了迎合糟糕的测试工具而公开所有内容是一个错误。正如其他人所说 - 这不应该是一个选择。设计好的软件。好好测试并使用好的工具。如果您必须为某些测试工具打破众所周知的最佳实践，那么是时候重新考虑您的测试工具了......

# web-services - Sabre 网络服务 DepartureWindow 格式

> ID：290786
> 
> 赞同：2
> 
> 时间：2008-11-14T17:29:17.617
> 
> 标签：web-services, sabre

你知道 sabre web-services 的 OTA_AirLowFareSearch 调用的 DepartureWindow 参数的格式是什么吗？无论我通过什么，它都会向我显示一个错误。

这是这些参数的完整文档（我不骗你）：

```
<!--"DepartureDateTime" represents the date and time of departure.-->
<DepartureDateTime>2004-11-22T15:00:00</DepartureDateTime>
<!--"DepartureWindow" represents a window of time to search prior and post departure.-->
<!--Example: JR.DFW/S-OYLAS22NOV1500‡ZRD09001700-->
<DepartureWindow>09001700</DepartureWindow> 
```

我已经尝试传递自 DepartureDateTime 以来的秒数和 unix 时间戳，但没有成功。错误信息是：

```
Error response received. The error was: INVALID TIME WINDOW IN  Z FIELDS 
```

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-07T10:04:42.933

您必须在 DepartureDateTime 的窗口内指定时间

```
 <ns1:DepartureDateTime>2009-01-03T15:00:00</ns1:DepartureDateTime>
 <ns1:DepartureWindow>11001559</ns1:DepartureWindow> 
```

对我来说很好

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-18T16:16:49.667

此外，您可以改用 OriginDestinationInformation.TPA_Extensions.AlternateTime

# delphi - 如何在 Delphi 中自动设置版本信息？

> ID：290792
> 
> 赞同：6
> 
> 时间：2008-11-14T17:31:02.277
> 
> 标签：delphi, build-automation, manifest

我想让我的 CodeGear Delphi 2007 项目根据我的项目是处于调试模式还是发布模式自动设置调试模块属性。

我可以通过右键单击项目->版本信息->根据需要编辑值来手动设置此值。这些是针对整个项目的，对于调试和发布版本也是一样的。

如果存在#debug 编译器指令，有没有办法自动将清单设置为调试？

是否有另一种方法可以轻松检测 exe 是作为调试版本还是发布版本构建的？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-14T18:46:28.693

如果你使用命令行编译器，你可以反过来做。告诉编译器为调试或发布而编译。将编译器指令设置为 DEBUG 以进行调试构建（默认情况下会这样做）。

msbuild YourProject.dproj /p:Configuration=Release

msbuild YourProject.dproj /p:Configuration=Debug

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T17:47:28.280

有一篇关于这个问题的 Delphi wiki 文章：

[在“调试”和“发布”构建之间轻松切换](http://delphi.wikia.com/wiki/Easily_Switching_between_%22Debug%22_and_%22Release%22_Builds)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-15T09:52:39.127

另一种解决方案是使用资源编辑器后期构建来更改它。喜欢[http://www.heaventools.com/rtconsole-update-version-info.htm](http://www.heaventools.com/rtconsole-update-version-info.htm)

# c - 如何找出给定对象所在的库？

> ID：290799
> 
> 赞同：4
> 
> 时间：2008-11-14T17:33:59.290
> 
> 标签：c, unix, linker, fortran, sgi

我在运行 Irix 6.5 的 SGI 上用 FORTRAN 和 C 编程，但这应该适用于所有类 Unix 系统。当我收到“未解析的文本符号”链接错误时，如何找到需要链接到我的程序的库？这是我从链接器看到的示例：

```
ld32: ERROR  33 Unresolved text symbol "ortho2_" -- first referenced by ./libfoo.a 
```

我只需要知道需要哪些库，还是有一些工具或命令可以帮助我解决这个问题？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-14T17:40:20.730

您可以使用该`nm`命令列出共享库中的动态符号：

```
nm -D /lib/libc.so.6 
```

然后`grep`是您正在寻找的符号。省略静态库的 -D。您可以在循环中或与 xargs 一起使用它来扫描多个库。

我通常只使用 google（假设该符号来自公开可用的库）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-14T17:55:56.657

使用`nm`（如[Robert Gamble 的回答](https://stackoverflow.com/questions/290799/how-can-i-find-out-which-library-is-home-to-a-given-object#290815)）是您问题的正确答案。诀窍在于知道在哪里寻找图书馆。你的程序是做什么的？如果有大量的数字在进行，很可能您应该链接数学库（如 LAPACK 或 BLAS）并且可能想要开始查找那里。网络搜索也很有帮助——我在我最喜欢的搜索引擎中输入了“ortho2”并得到了[表明](http://inetsd01.boulder.ibm.com/pseries/en_US/infocenter/base/43_docs/libs/gl32tref/ortho.htm)它在`libfgl.a`

请注意，当您搜索时，您可能应该省略结尾的下划线 - 它通常由编译器添加到例程名称中。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-15T16:55:48.853

我抵制了将其添加到 Robert Gamble 的答案的诱惑 - 将其视为对它的补充。

谨防简单地假设“任何匹配”都可以使用。在另一个 SO question 中有一个案例，其中一段代码从 Windows 移动到 Unix，而 Windows 代码用于`getch()`从输入中读取单个字符。用户经历了与此类似的过程，并在库`getch()`中的 Unix 上找到。`curses`因此，用户与`curses`库链接并想知道为什么代码核心转储。问题是，`getch()`实际使用的假设是正确的初始化已经完成，而正确的初始化没有完成。事实上，这可能不是我们需要的例行程序。

在 Solaris 上，有一些选项可以`nm`告诉您库名称，甚至库中包含符号的目标文件（这些`-r`用于库名称和`-R`库中的对象）。

也要小心 C++ 错误的名称。该`ortho2`示例显然不是 C++ 损坏的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-15T17:21:27.723

如果它是一个标准函数，可能是 ortho2，手册页会告诉你它在哪个库中。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-17T15:56:49.390

我有一个小查找脚本。输入查找 func_name

```
#!/bin/csh
foreach i (*.o *.a *.so)
 echo $i
 nm $i | grep -i $1
end 
```

# .net - 委托和回调是否相同或相似？

> ID：290819
> 
> 赞同：58
> 
> 时间：2008-11-14T17:41:46.747
> 
> 标签：.net, callback, delegates

委托与回调是一回事吗？或者它们是否以某种方式相关？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-11-14T17:58:36.667

“回调”是指编码设计模式的术语，可用于任何具有函数指针的语言或函数指针的类似物（有点像委托）

在这种模式中，您将一个函数指针传递给另一个函数，以便在被调用函数中，它可以“回调”您传递给它的函数。通过这种方式，您可以从方法外部控制方法的大部分内部行为，方法是每次调用时将指针传递给不同的“回调”函数......回调的一个例子是当你有一个排序算法时必须传递一个指向函数的指针，该函数将“比较”要排序的列表中的任意一对对象，以确定哪个在另一个之前。在一次调用 sort 方法时，您可能会传递一个按对象名称进行比较的回调函数，而另一次则传递一个按对象权重或其他方式进行比较的函数...

委托，otoh，是一种特定的 .Net 类型，它充当函数指针的特定于签名的容器......在 .Net 托管代码中，委托是创建和使用函数指针的唯一方法。所以在.Net中做回调，其实是在传递一个委托……但是委托除了回调之外还可以用在其他场景。（具体来说，委托也可用于实现 .Net 线程池中的多线程）

回调也用于实现“观察者”模式（在 .Net 中使用事件实现，事件本身就是一种特殊类型的委托）

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-11-14T17:45:14.213

（我假设您在这里谈论的是 .NET。如果不是，请详细说明。）

委托是在 .NET 中实现回调的惯用方式 - 但您不必这样做。例如，您可以使用接口。（特别是你可以有一个回调，一个方法调用错误，一个调用成功。当然，你可以取两个委托......）

除了 .NET 中的回调之外，委托还有很多用途——它完全取决于您认为回调的内容，但是 LINQ to Objects 中的 GUI 事件处理程序、线程启动器、过滤器和投影（以及更多！）都使用委托。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-14T17:49:17.247

它们是手牵手相关的。委托是对回调函数外观的描述：

```
delegate void MyDelegate(string Text); 
```

然后，您可以拥有一个可以将回调作为参数接收的函数。

```
//This will result in a MessageBox with "Lalalala"
MyFunctionThatGetsTheCallbackFunctionRef(MyCallBackFunc); 

void MyFunctionThatGetsTheCallbackFunctionRef(MyDelegate TheFunction){
 TheFunction("Lalalala");
}

void MyCallBackFunc(string Text){
  //my callback
  MessageBox.Show(Text);
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-14T17:44:44.120

通常，委托是用于访问拥有该方法的对象外部的方法的对象，而回调是保存委托的变量

在 C# 中，这些术语可以互换使用

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-02-08T19:41:45.660

服务类有一个称为委托的变量函数。调用类有一个它想要运行的首选函数，称为回调。

调用类将委托设置为其回调。

委托和回调之间的区别在于视角：服务类调用设置为调用类回调的委托。

# mysql - MySQL 中的数组切片/group_concat 限制

> ID：290840
> 
> 赞同：0
> 
> 时间：2008-11-14T17:46:18.657
> 
> 标签：mysql, greatest-n-per-group

假设我有一张桌子：

```
ij
---
一个 1
a2
一个 3
一个 4
b 5
b 6
b 7
b 8
b 9

```

显然`SELECT a, GROUP_CONCAT(b SEPARATOR ',') GROUP BY a`会给我

```
一个 1,2,3,4
b 5,6,7,8,9

```

但是如果我只想获得有限数量的结果，比如 2，例如：

```
一个 1,2
b 5,6

```

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2013-07-08T12:56:41.740

最好的方法是使用`SUBSTRING_INDEX()`and `GROUP_CONCAT()`。

```
SELECT i, SUBSTRING_INDEX( GROUP_CONCAT(j), ',', 2)
FROM mytable
GROUP BY i; 
```

您不必知道`j`这里的字段长度。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-16T01:14:14.120

一种解决方案是在计算聚合之前将组中的行限制为前两行。

```
SELECT t.i, GROUP_CONCAT(t.j)
FROM
  (SELECT t1.i, t1.j
   FROM mytable AS t1
     LEFT JOIN mytable AS t2
       ON (t1.i = t2.i AND t1.j >= t2.j) 
   GROUP BY t1.i, t1.j
   HAVING COUNT(*) <= 2) AS t
GROUP BY t.i; 
```

如果您知道其中的值`j`是固定长度的，另一种解决方案是简单地使用`SUBSTRING()`结果：

```
SELECT i, SUBSTRING( GROUP_CONCAT(j), 1, 3 )
FROM mytable
GROUP BY i; 
```

# php - 如何检测文档的语言 - 在 PHP 中？

> ID：290851
> 
> 赞同：1
> 
> 时间：2008-11-14T17:48:26.733
> 
> 标签：php, language-detection

[这里](https://stackoverflow.com/questions/257125/human-language-of-a-document)已经回答了基础知识。但是是否有一个预先构建的 PHP 库与来自 CPAN 的 Lingua::Identify 一样？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-14T17:53:19.860

有一个[`Text_LanguageDetect`](http://pear.php.net/package/Text_LanguageDetect)我以前用过的 PEAR 包。把工作做得足够好。我不确定任何其他更成熟的库。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-14T18:17:35.630

1-您可以自己做（困难的方法）-通过查看字符和 n-gram 频率来检测语言和代码页。您将需要大量“训练”数据，但这是可行的。

2-您可以运行 perl 脚本来为您进行检测（容易得多）。

# c# - 在 windows 框中使用 Mono 和 XSP 的示例网页

> ID：290860
> 
> 赞同：0
> 
> 时间：2008-11-14T17:51:40.580
> 
> 标签：c#, asp.net, windows, mono, xsp

我正在尝试让我的第一个 ASP.NET 网页使用[Mono](http://www.mono-project.com/Main_Page)和 XSP Web 服务器在 Windows 上运行。

我正在关注这个 chaps[示例](http://www.codeproject.com/KB/cross-platform/introtomono2.aspx)。他的示例的[第一部分](http://www.codeproject.com/KB/cross-platform/introtomono1.aspx)非常适用于最新版本的单声道。但是，Web 部件似乎因以下错误而崩溃

> '{Path Name}\Index.aspx.cs' 不是有效的虚拟路径。

这是完整的堆栈跟踪：

```
System.Web.HttpException: 'C:\Projects\Mono\ASPExample\simpleapp\index.aspx.cs' is not a valid virtual path.  
   at System.Web.HttpRequest.MapPath (System.String virtualPath, System.String baseVirtualDir, Boolean allowCrossAppMapping) [0x00000]   
   at System.Web.HttpRequest.MapPath (System.String virtualPath) [0x00000]   
   at System.Web.Compilation.BuildManager.AddToCache (System.String virtualPath, System.Web.Compilation.BuildProvider bp) [0x00000]   
   at System.Web.Compilation.BuildManager.BuildAssembly (System.Web.VirtualPath virtualPath) [0x00000]   
   at System.Web.Compilation.BuildManager.GetCompiledType (System.String virtualPath) [0x00000]   
   at System.Web.Compilation.BuildManager.CreateInstanceFromVirtualPath (System.String virtualPath, System.Type requiredBaseType) [0x00000]   
   at System.Web.UI.PageParser.GetCompiledPageInstance (System.String virtualPath, System.String inputFile, System.Web.HttpContext context) [0x00000]
   at System.Web.UI.PageHandlerFactory.GetHandler (System.Web.HttpContext context, System.String requestType, System.String url, System.String path) [0x00000]
   at System.Web.HttpApplication.GetHandler (System.Web.HttpContext context, System.String url, Boolean ignoreContextHandler) [0x00000]
   at System.Web.HttpApplication.GetHandler (System.Web.HttpContext context, System.String url) [0x00000]
   at System.Web.HttpApplication+<Pipeline>c__Iterator5.MoveNext () [0x00000] 
```

我想知道是否有人知道这个错误是什么意思。我想我正在寻找一位尝试过 windows 版本的单声道专家。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-15T03:21:25.610

你能粘贴你用来启动xsp的命令行吗？如果您只是运行一个 webapp，那么实际上并不需要这样的东西，并且可能是问题的根源：

xsp --applications /SimpleWebApp:C:\Projects\Mono\ASPExample\

只需 cd 到 ASPExample 目录并运行不带参数的 xsp。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-17T10:56:08.033

我使用的命令是这样的：

```
@echo off
call C:\PROGRA~1\MONO-2~1.1\bin\setmonopath.bat
xsp --root . --port 8088 --applications /:. 
```

我尝试只运行不带参数的 XSP，得到以下输出：

> xsp2 监听地址：0.0.0.0 根目录：C:\Projects\Mono\ASPExample 监听端口：8080（非安全） 点击返回停止服务器。

当我尝试浏览到项目时

[http://localhost:8080](http://localhost:8080)

我得到与以前相同的输出，即抱怨 cs 文件不是有效的虚拟路径。

我认为 ASPX 页面的 src 属性是问题所在。也许它已在新版本的 Mono 中进行了更新。我要调查一下。

感谢您的回复顺便说一句。

戴夫

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T12:27:19.453

嘿，我不知道如何让“代码背后”的东西工作，但我找到了一个我很满意的解决方法。我想我会把它贴在这里以造福他人。基本上，您将后面的代码移到主页中，只需使用

XSD 命令并且没有参数。

```
<%@ Page Language="C#" %>
<%@ Import Namespace="System.Data" %>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <title>Code behind Arrrrrrrrrrgh</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <script runat="server">
    private void Page_Load(Object sender, EventArgs e)
    {
       DisplayServerDetails();
       DisplayRequestDetails();

    }

    private void DisplayServerDetails()
      {
        serverName.Text = Environment.MachineName;
        operatingSystem.Text = Environment.OSVersion.Platform.ToString();
        operatingSystemVersion.Text = Environment.OSVersion.Version.ToString();
      }

      private void DisplayRequestDetails()
      {
         requestedPage.Text = Request.Url.AbsolutePath;
         requestIP.Text = Request.UserHostAddress;
         requestUA.Text = Request.UserAgent;
      }

    </script>

  </head>

  <body>
    <form method="post" runat="server">
         <table width="450px" border="1px">
            <tr>
               <td colspan="2"><strong>Server Details</strong></td>
            </tr>
            <tr>
               <td>Server Name:</td>
               <td>
                  <asp:Label id="serverName" runat="server"></asp:Label></td>
            </tr>
            <tr>
               <td>Operating System:</td>
               <td>
                  <asp:Label id="operatingSystem" runat="server"></asp:Label>
               </td>
            </tr>
            <tr>
               <td>Operating System Version:</td>
               <td>
                  <asp:Label id="operatingSystemVersion" runat="server">
                  </asp:Label>
               </td>
            </tr>
         </table>
         <br>
         <table width="450px" border="1px">
            <tr>
               <td colspan="2"><strong>Request Details</strong></td>
            </tr>
            <tr>
               <td>Page Requested:</td>
               <td>
                  <asp:Label id="requestedPage" runat="server"></asp:Label>
               </td>
            </tr>
            <tr>
               <td>Request From:</td>
               <td>
                  <asp:Label id="requestIP" runat="server"></asp:Label>
               </td>
            </tr>
            <tr>
               <td>User Agent:</td>
               <td>
                  <asp:Label id="requestUA" runat="server"></asp:Label>
               </td>
            </tr>
         </table>
      </form>
  </body> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-18T19:25:00.297

您是否尝试过运行 xsp2 而不是 xsp？

# c# - 如何 XML 序列化“类型”

> ID：290867
> 
> 赞同：12
> 
> 时间：2008-11-14T17:54:38.703
> 
> 标签：c#, xml, serialization

如何序列化“类型”？

我想将一个对象序列化为 XML，该对象具有一个对象类型的属性。这个想法是，当它被反序列化时，我可以创建一个该类型的对象。

```
public class NewObject
{
}

[XmlRoot]
public class XmlData
{
    private Type t;

    public Type T
    {
        get { return t; }
        set { t = value; }
    }
}
    static void Main(string[] args)
    {
        XmlData data = new XmlData();
        data.T = typeof(NewObject);
        try
        {
            XmlSerializer serializer = new XmlSerializer(typeof(XmlData));
            try
            {
                using (FileStream fs = new FileStream("test.xml", FileMode.Create))
                {
                    serializer.Serialize(fs, data);
                }
            }
            catch (Exception ex)
            {

            }
        }
        catch (Exception ex)
        {

        }
    } 
```

我得到这个异常：“类型 ConsoleApplication1.NewObject 不是预期的。使用 XmlInclude 或 SoapInclude 属性来指定静态未知的类型。”

我在哪里放置 [XmlInclude]？这甚至可能吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2011-07-06T18:54:17.093

`Type`类无法序列化，因为`System.RuntimeType`我们的代码无法访问，它是内部 CLR 类型。您可以通过使用类型的名称来解决此问题，如下所示：

```
public class c 
{       
    [XmlIgnore]
    private Type t;
    [XmlIgnore]
    public Type T {
        get { return t; }
        set { 
                t = value;
                tName = value.AssemblyQualifiedName;
            }
    }

    public string tName{
        get { return t.AssemblyQualifiedName; }
        set { t = Type.GetType(value);}
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-14T18:11:49.200

您可能会实现[`IXmlSerializable`](http://msdn.microsoft.com/en-us/library/system.xml.serialization.ixmlserializable.aspx)接口并使用`Type.FullName`（您可能还需要`Type.AssemblyQualifiedName`）进行`Assembly.GetType(string)`类型元素的序列化和反序列化。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-14T19:36:48.670

我最终将类型名称转换为字符串以将其保存为 XML。

反序列化时，我加载所有 DLL 并将类型名称保存在字典中。当我使用类型名称加载 XML 时，我可以在字典键中查找名称并根据字典值知道类型。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-30T14:37:21.260

XML 序列化仅将对象的公共字段和属性值序列化为 XML 流。**XML 序列化不包括类型信息。**例如，如果您有一个 Book 对象存在于 Library 命名空间中，则无法保证它将被反序列化为相同类型的对象。

来源：[XML 序列化细节 | 微软文档](https://docs.microsoft.com/en-us/dotnet/standard/serialization/introducing-xml-serialization)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-16T07:39:27.773

问题是 XmlData.T 的类型实际上是“System.RuntimeType”（Type 的子类），遗憾的是它不是公开的。这意味着没有办法告诉序列化期望什么类型。我建议只序列化类型的名称，或 Jay Bazuzi 建议的完全限定名称。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-01-24T08:39:31.710

丑陋但有效。创建一个包含对象类型和序列化字符串的类。

前任

```
Class dummie
{
    Type objType;
    string xml;
} 
```

# rtml - 你如何评论你的 RTML 代码？

> ID：290875
> 
> 赞同：3
> 
> 时间：2008-11-14T17:56:17.763
> 
> 标签：rtml

<rant-mode> 你见过不允许在代码中添加注释的编程语言吗？欢迎来到 RTML 的世界（愿它在地狱中燃烧）！</rant-mode>

## 问题

> 您用来注释 RTML 代码的最佳技术（如果有的话）是什么？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-12-13T00:31:10.997

要在 RTML 中创建评论，请单击您的模板，然后单击 ，然后`New`在“简单”的文本框中输入（用引号括起来）您的评论。

```
"**************** My comment and stuff ******************" 
```

如果您想注释掉一段代码，请在将`MULTI`多个 RTML 语句分组的 a 之后插入您的代码，然后将`WHEN nil`. 之后的一切都`WHEN nil`不会被执行。

```
WHEN nil
    MULTI
        TEXT @a-random-variable 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-14T18:46:24.497

我只是看了一下 RTML，我不喜欢直接使用它（它非常难看）。

似乎最好的方法是拥有源文件和一个去除注释并可能包含快捷方式和新功能的预处理器，然后自动上传 RTML（甚至可能是 RTML 的芥末）。

[你需要用一种真实的语言来做，或者用ANTLR](http://www.antlr.org/)之类的东西全力以赴。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-03-28T20:40:34.163

COMMENT 在当前页面中插入注释。相当于 HTML 的构造。注释只是成为页面 HTML 源的一部分但不会显示在屏幕上的一些文本。注释的实际文本必须是用双引号括起来的字符串（或文本类型的变量）。

例子：

```
 COMMENT "nosearch"
 HEAD
 TITLE "untitled"
 BODY
 TEXT "This 
```

请参阅： [可用的 RTML 书籍和资源列表](https://stackoverflow.com/questions/5464944/list-of-available-rtml-books-and-resources)

# c#-2.0 - 视图状态/功能/服务器与开发服务器不一致

> ID：290880
> 
> 赞同：0
> 
> 时间：2008-11-14T17:57:58.900
> 
> 标签：c#-2.0, viewstate

代码是这样的：

```
protected bool IsOKToSend()
{
    bool IsOK = true;        
    lblErrorSending.Visible = false;
    if (txtUserName.Text == "" )
    { 
    lblErrorSending.Text = "Please enter your username before sending.";
    IsOK = false;
    }
    return IsOK;
}

    protected void btnSubmit_Click(object sender, EventArgs e)
{

    if (IsOKToSend())
    {
        adsUser.Insert();
        Response.Redirect("complete.aspx");
    }
    else
    {
        lblErrorSending.Visible = true;
    }
} 
```

由于某种原因，它不能在实时服务器上始终如一地工作。请记住，它总是在我的本地开发机器上工作，有时（大约 3 次尝试中的 1 次）在现场机器上工作。当它在实时服务器上失败时，页面会重新加载并且所有视图状态都会丢失。

我的 webconfig 文件中有一个默认错误捕获，并且该页面永远不会重定向到错误页面。

一致的错误很容易解决，但这样的事情并非如此。

关于什么可以使此页面有时工作有时不工作和/或为什么视图状态在它无法工作时不保留的任何想法？为什么我在本地机器上没有遇到同样的问题？

我尝试合并这两个函数以查看调用外部函数是否导致问题，但不幸的是它没有改变任何东西。此外， IsOK 的值似乎不会影响我是否会得到错误。

我删除了页面加载功能中的所有代码以确保正确排除故障，但我仍然遇到同样的问题。

任何想法将不胜感激。

编辑：我打算按原样发送，但我决定尝试以下方法：

```
protected void btnSubmit_Click(object sender, EventArgs e)
{
    bool IsOK = true;        
    lblErrorSending.Visible = false;
    if (txtUserName.Text == "" )
    { 
        lblErrorSending.Text = "Please enter your username before sending.";
        IsOK = false;
    }
    lblErrorSending.Visible = !IsOK;        
} 
```

如果我在按钮上单击几次，则在几次尝试后页面确实会丢失视图状态值，但并非总是如此。因此，这里的主要问题似乎是视图状态始终无法正常工作的问题。任何的想法？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T18:14:35.510

我会在这里大胆猜测一下，说您没有在生产中使用粘性会话，并且您有多个 Web 服务器。但是在开发中，您只有一台服务器。您正在使用负载平衡，并且每隔一段时间，您就会在 macing.config 中使用不同的机器密钥被踢到不同的服务器。应用程序蓬勃发展。

或者这根本不是。:)

如果是问题所在，您可以关闭视图状态或同步 machine.config 中的密钥，问题应该会消失。

# java - “无法从静态上下文引用非静态方法”背后的原因是什么？

> ID：290884
> 
> 赞同：326
> 
> 时间：2008-11-14T17:59:30.660
> 
> 标签：java, static

非常常见的初学者错误是当您尝试“静态”使用类属性而不创建该类的实例时。它会给您留下提到的错误消息：

> 您可以将非静态方法设为静态，也可以将该类的实例设为使用其属性。

**这背后的原因是什么？我不关心解决方案，而是关心原因。**

```
private java.util.List<String> someMethod(){
    /* Some Code */
    return someList;            
}

public static void main(String[] strArgs){          
     // The following statement causes the error. 
    java.util.List<String> someList = someMethod();         
} 
```

* * *

## 回答 #1

> 赞同：443
> 
> 时间：2008-11-14T18:10:50.620

你不能调用不存在的东西。由于您尚未创建对象，因此非静态方法尚不存在。静态方法（根据定义）始终存在。

* * *

## 回答 #2

> 赞同：86
> 
> 时间：2008-11-14T18:04:17.810

您尝试调用的方法是实例级方法；你没有实例。

`static`方法属于类，非`static`方法属于类的实例。

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2009-07-16T21:30:10.103

面向对象编程的本质是将逻辑及其操作的数据封装在一起。

实例方法是逻辑，实例字段是数据。它们一起形成一个对象。

```
public class Foo
{
    private String foo;
    public Foo(String foo){ this.foo = foo; }
    public getFoo(){ return this.foo; }

    public static void main(String[] args){
        System.out.println( getFoo() );
    }
} 
```

运行上述程序可能会产生什么结果？

没有对象，就没有实例数据，虽然实例方法作为类定义的一部分存在，但它们需要一个对象实例来为它们提供数据。

理论上，不访问任何实例数据的实例方法可以在静态上下文中工作，但实际上没有任何理由让它成为实例方法。这是一个语言设计决定，无论如何都要允许它，而不是制定一个额外的规则来禁止它。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-11-15T07:28:36.610

我刚刚意识到，我认为人们不应该很早就接触到“静态”的概念。

静态方法可能应该是例外而不是规范。如果您想学习 OOP，尤其是在早期。（为什么要从规则的例外开始？）这与 Java 的教学非常相反，您应该学习的“第一”东西是 public *static* void 主要的东西。（无论如何，很少有真正的 Java 应用程序有自己的主要方法。）

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2012-07-15T19:20:31.090

我认为值得指出的是，根据 Java 语言的规则，Java 编译器插入了“this”的等价物。当它注意到您正在访问没有显式实例的实例方法或实例字段时。当然，编译器知道它只能在具有“this”变量的实例方法中执行此操作，而静态方法则不能。

这意味着当您使用实例方法时，以下内容是等效的：

```
instanceMethod();
this.instanceMethod(); 
```

这些也是等价的：

```
... = instanceField;
... = this.instanceField; 
```

编译器有效地插入了“this”。当您不提供特定实例时。

编译器的这种（双关语）“魔术帮助”可能会使新手感到困惑：这意味着实例调用和静态调用有时看起来具有相同的语法，而实际上是不同类型和底层机制的调用。

由于支持多态的虚方法的行为，实例方法调用有时被称为方法调用或分派；无论您是否编写了要使用的显式对象实例或编译器插入了“this.”，调度行为都会发生。

静态方法调用机制更简单，就像非 OOP 语言中的函数调用一样。

*就个人而言，我认为该错误消息具有误导性，它可能是“在不指定显式对象实例的*情况下无法从静态上下文引用非静态方法”。

* * *

编译器抱怨的是它不能简单地插入标准的“this”。就像在实例方法中一样，因为此代码在静态方法中；然而，也许作者只是忘记提供此调用感兴趣的实例——例如，可能作为参数提供给静态方法的实例，或在此静态方法中创建的实例。

简而言之，您当然可以从静态方法中调用实例方法，您只需要拥有并为调用指定一个显式实例对象。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-11-15T07:18:41.420

到目前为止的答案描述了原因，但您可能还需要考虑其他一些问题：

您可以通过将方法调用附加到其构造函数来从可实例化类调用方法，

```
Object instance = new Constuctor().methodCall(); 
```

或者

```
primitive name = new Constuctor().methodCall(); 
```

如果您只想在单个范围内使用可实例化类的方法一次，这很有用。如果您在单个范围内从可实例化类调用多个方法，请务必创建一个可引用实例。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2014-06-05T20:46:19.207

如果我们尝试从静态上下文访问实例方法，编译器无法猜测您指的是哪个实例方法（哪个对象的变量）。不过，您始终可以使用对象引用来访问它。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-11-14T18:11:16.470

静态方法将动作与对象类型相关联，而非静态方法将动作与该对象类型的实例相关联。通常，它是一种与实例相关的方法。

前任：

Car 类可能有一个wash 方法，表示清洗特定的汽车，而静态方法将应用于汽车类型。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-11-14T18:11:50.290

如果方法不是静态的，则“告诉”编译器该方法需要访问类中的实例级数据（如非静态字段）。除非已创建该类的实例，否则此数据将不可用。因此，如果您尝试从静态方法调用该方法，编译器会抛出错误。如果该方法实际上没有引用该类的任何非静态成员，请将该方法设为静态。

例如，在 Resharper 中，仅创建一个不引用类的任何静态成员的非静态方法会生成警告消息“此方法可以设为静态”

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-04-07T14:09:24.790

编译器实际上为非静态方法添加了一个参数。它添加了一个`this pointer/reference. This is also the reason why a static method can not use this`, 因为没有对象。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2014-08-20T21:48:24.430

所以你问一个非常核心的原因？

好吧，由于您使用 Java 进行开发，因此编译器会生成 Java 虚拟机可以解释的目标代码。无论如何，JVM 是一个以机器语言运行的二进制程序（可能特定于您的操作系统和硬件的 JVM 版本以前由另一种编程语言（如 C）编译，以便获得可以在您的处理器中运行的机器代码）。最后，任何代码都被翻译成机器代码。因此，创建一个对象（一个类的实例）相当于保留一个内存空间（当操作系统的 CPU 调度程序将您的程序放在队列顶部以执行它时，内存寄存器将成为处理器寄存器）要有一个可以读写数据的数据存储地方。如果您没有类的实例（发生在静态上下文中），那么你没有那个内存空间来读取或写入数据。事实上，就像其他人所说的那样，数据不存在（因为从一开始你就没有写过，也没有预留内存空间来存储它）。

对不起我的英语不好！我是拉丁人！

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-07-05T14:23:05.647

这背后的简单原因是可以访问父类的静态数据成员（仅当它们未被覆盖时）但例如（非静态）数据成员或方法我们需要它们的引用，因此它们只能通过对象调用.

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2014-09-13T15:10:07.890

非静态方法依赖于对象。一旦对象被创建，它就会被程序识别。

甚至可以在创建对象之前调用静态方法。静态方法非常适合进行不依赖于您计划使用的实际对象的比较或操作。

# sql - SQL Server 2000 “NO JOIN PREDICATE”警告 - 为什么？

> ID：290885
> 
> 赞同：0
> 
> 时间：2008-11-14T17:59:43.140
> 
> 标签：sql, sql-server, tsql, warnings

我在使用 SQL Server 2000 时遇到了一个奇怪的问题，我只是想不出发生这种情况的原因。

有两个表，都有一个组合主键和一个聚集索引，两个键具有相同的结构：

```
(VARCHAR(11), INT, DATETIME)   /* can't change this, so don't suggest I should */ 
```

所以，像这样加入他们很容易：

```
SELECT t1.Foo, t2.Bar
FROM   table1 t1 INNER JOIN table2 t2 ON t1.VarcharKey = t2.VarcharKey
WHERE  t1.VarcharKey = 'Foo' 
```

查看查询执行计划，我看到：

*   聚集索引搜索 [db].[dbo].[table1].[PK_table1] (48%)
*   聚集索引搜索 [db].[dbo].[table2].[PK_table2] (51%)
*   嵌套循环（内部连接）（1%）**警告：没有连接预测**
*   选择 (0%)

现在如果我这样做（注意 NVARCHAR 字符串！）：

```
SELECT t1.Foo, t2.Bar
FROM   table1 t1 INNER JOIN table2 t2 ON t1.VarcharKey = t2.VarcharKey
WHERE  t1.VarcharKey = N'Foo' 
```

我得到：

*   聚集索引扫描 [db].[dbo].[table1].[PK_table1] (98%)
*   聚集索引搜索 [db].[dbo].[table2].[PK_table2] (1%)
*   嵌套循环（内部连接）（1%）*这里没有警告*
*   选择 (0%)

这种行为让我有点困惑。

*   为什么会出现“NO JOIN PREDICATE”警告，为什么当我更改`'Foo'`为时它会消失`N'Foo'`？我的键列不是 NVARCHAR 类型，所以这不应该有任何区别，还是应该？
*   此警告的存在是否有负面影响，或者我可以忽略它吗？
*   为什么它会从 Index Seek 切换到 Index Scan？

* * *

一些背景信息：表基数约为。一张表有 25,000 条记录，大约 12,000 条记录在另一个。数据库兼容级别是 80 (SQL Server 2000)，默认排序规则是`SQL_Latin1_General_CP1_CI_AS`，如果这有什么不同的话。

以下是 的内容`@@VERSION`：

> Microsoft SQL Server 2000 - 8.00.2273 (Intel X86) Mar 7 2008 22:19:58 版权所有 (c) 1988-2003 Microsoft Corporation Enterprise Edition on Windows NT 5.0 (Build 2195: Service Pack 4)

PS：我知道[KB322854](http://support.microsoft.com/kb/322854)，但这显然不是。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-14T18:31:13.373

> 为什么它会从 Index Seek 切换到 Index Scan？

这在很大程度上是一个猜测，但这里有：

在第一种情况（'Foo'）中，MSSQL 识别出正在搜索的值与 t1 上索引的第一部分完美匹配，因此使用索引在 t1 中查找记录（Index Seek，可能是二进制搜索）。在 t1 中找到一条索引与 t2 完全匹配的记录后，它可以使用该索引来查找 t2 中的记录。

在第二种情况下，(N'Foo')，MSSQL 认识到它在索引和正在寻找的值之间没有完美匹配，因此它不能将索引用作索引，而必须进行全表扫描。但是，由于索引包含所需的信息（以不同的形式）并且小于完整表，因此它可以像对表一样对索引进行完整扫描（这比扫描表要快，因为页面更少需要为磁盘读取；尽管如此，它似乎比索引查找花费了大约 90 倍的时间）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-14T18:18:14.630

[从 SqlServerCentral](http://www.sqlservercentral.com/Forums/Topic464285-146-2.aspx)：

查询可以具有看起来完美的连接条件。但是，当您检查查询计划时，您将看到一条警告，指示“无连接谓词”，表明其中 2 个涉及的表没有谓词（连接时）。向查询添加选项（强制顺序）会产生完全不同的计划，并且警告会消失（在某些情况下）。这样你就知道这是问题所在。我看到的大多数在 SQL 2000 上执行得更好的查询都表现出这个问题。SP 2 的累积更新 4 应该可以解决这个问题。

# video - 具有嵌入式上传控制的视频共享网站

> ID：290888
> 
> 赞同：3
> 
> 时间：2008-11-14T18:00:51.420
> 
> 标签：video, vimeo, video-embedding

我正在构建一个带有嵌入式视频的网站。我不想自己处理视频，而是使用 Vimeo Plus 之类的东西。我还希望该站点的未来管理员能够直接从站点的管理界面上传视频（即，这样他们就不必去 Vimeo 进行上传）。Vimeo 似乎没有可嵌入的上传控件。我可以先将视频上传到我的服务器，然后使用他们的 API 将其传输到 Vimeo，但在此过程中可能会出现很多问题......

有没有人找到带有可嵌入上传控件的视频服务，或者以其他方式解决了这个问题？

更新：看起来[bitsontherun](http://www.bitsontherun.com/api-documentation/)可能是一个选项，或者可能是[brightcove](http://www.brightcove.com/products/developer-tools/technology-integrations/)。（结果都没有预先打包的上传组件）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-19T17:23:40.460

Brightcove 绝对是一种方法。他们有完整的 API，允许您构建一个用于上传的组件。他们还提供批量摄取过程。我知道这并不能解决您对可嵌入组件的需求，但这可以帮助您创建一个。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-11-14T20:23:11.400

我刚刚部署了一个站点，管理员可以使用连接到 Drupal 站点的[FCKEditor的上传功能将视频上传到服务器。](http://www.fckeditor.net/)安全性不是那么令人担忧，因为该功能是按角色锁定的，就像您说的那样，一旦视频文件在您的服务器上，您就可以对它做任何您想做的事情。

# python - Django 表单 - 如何不验证？

> ID：290896
> 
> 赞同：7
> 
> 时间：2008-11-14T18:04:27.247
> 
> 标签：python, django, forms

假设我有这个简单的形式：

```
class ContactForm(forms.Form):
    first_name = forms.CharField(required=True)
    last_name = forms.CharField(required=True) 
```

我有一个字段的默认值，但没有另一个字段。所以我这样设置：

```
default_data = {'first_name','greg'}
form1=ContactForm(default_data) 
```

但是现在当我去显示它时，Django 显示一个验证错误，说需要 last_name：

```
print form1.as_table() 
```

这样做的正确方法是什么？由于这不是用户提交的数据，只是我想预填的数据。

**注意：** required=False 将不起作用，因为我确实希望用户提交数据时需要它。就在我第一次在页面上显示表单时，我没有默认值。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-14T18:32:12.340

表单构造函数具有`initial`允许为字段提供默认值的参数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T18:10:27.813

来自 django 文档是这样的：

```
from django import forms
class ContactForm(forms.Form):
    subject = forms.CharField(max_length=100)
    message = forms.CharField()
    sender = forms.EmailField()
    cc_myself = forms.BooleanField(required=False) 
```

“required=False”应该会产生你想要的效果。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-10-07T09:29:19.993

以后也可以手动验证和清除错误：`form.errors.clear()`

# c - 使用 Linux 内核中的模块覆盖功能

> ID：290898
> 
> 赞同：21
> 
> 时间：2008-11-14T18:04:46.467
> 
> 标签：c, linux, module, kernel

在没有详细说明*原因*的情况下，我正在寻找一种干净的（尽可能）方法来替换可加载模块中的内核函数和系统调用。我最初的想法是写一些代码来覆盖一些函数，它会取原来的函数（也许，如果可能的话，*调用*函数），然后添加一些我自己的代码。关键是我编写的函数必须具有原始函数的名称，因此其他代码在尝试访问它时会访问我的。

我可以通过将我的代码放入适当的函数中轻松（相对地）直接在内核中执行此操作，但我想知道是否有人知道一点 C 魔法，它*不一定是*可怕的内核（或 C）编码实践，可以实现同样的结果。

#defines 和 typedefs 的想法浮现在脑海，但我无法在脑海中完全破解它。

简而言之：有没有人知道一种有效地覆盖 Linux 内核（从模块）中的功能的方法？

编辑：既然有人问过，我基本上想*从内核*中记录某些功能（创建/删除目录等） ，但为了理智，一个可加载的模块似乎是有意义的，而不是必须写一个大补丁内核代码并在每次更改时重新编译。向内核添加少量代码是可以的，但我想将大部分工作卸载到模块中。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2011-11-10T17:10:22.850

我意识到这个问题已经存在三年了，但是为了其他尝试做这类事情的人的利益，内核有一个名为[kprobes](http://www.mjmwired.net/kernel/Documentation/kprobes.txt "探针")的接口来做你需要的事情。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-14T20:19:26.837

您可能想要[挂钩系统调用](http://rtg.informatik.tu-chemnitz.de/docs/da-sa-txt/sa-dienelt.pdf)（PDF 链接），这将有效地让您记录调用内核函数的用户进程。如果您真的想记录内核函数的*内核*使用，您需要查看[内核函数跟踪](http://elinux.org/Kernel_Function_Trace)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-14T18:48:25.380

我不完全确定我理解你想要做什么，但我认为[ksplice](http://www.ksplice.com/)可能是一个很好的解决方案。它仍在开发中，所以我不知道它现在是否处于任何可用状态。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-07-28T23:03:59.913

您是否考虑过使用 LD_PRELOAD 部署您的功能？

您的函数将通过共享库进行部署，该库将位于环境变量 LD_PRELOAD 指定的目录中。

惯例是你拦截系统调用，然后在执行你的魔法之后，将调用传递给实际的系统 shlib。但你不必这样做。

不妨看看文章“[为乐趣和利润而构建库插入器](http://www.itworld.com/UIR000929interposers)”。虽然它是特定于 Solaris 的，但它也适用于 Linux。

顺便说一句，这就是大多数内存分析工具（例如 Purify）的工作方式。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-17T20:01:44.497

内核中已经做了很多工作来确保不会发生这种情况，特别是不将系统调用表暴露给模块的工作。唯一支持的日志文件访问机制是[LSM](http://en.wikipedia.org/wiki/Linux_Security_Modules)，但它是面向安全的，[前途未卜](http://kerneltrap.org/Linux/Linux_Security_Modules_Sans_Modules)。[这](http://www.kroah.com/linux/talks/ols_2002_lsm_paper/lsm.pdf)是一个记录 API 的 PDF，但它可能不是最新的。

inotify 是一种比试图破坏内核系统调用函数更好的方法来监视文件的创建、删除和修改，但它可以在用户空间工作。

引用自 Wikipedia ( [http://en.wikipedia.org/wiki/Inotify](http://en.wikipedia.org/wiki/Inotify) )：可以监控的一些事件是：

```
* IN_ACCESS - read of the file
* IN_MODIFY - last modification
* IN_ATTRIB - attributes of file change
* IN_OPEN and IN_CLOSE - open or close of file
* IN_MOVED_FROM and IN_MOVED_TO - when the file is moved or renamed
* IN_DELETE - a file/directory deleted
* IN_CREATE - a file/directory created
* IN_DELETE_SELF - file monitored is deleted 
```

inotify 从 2.6.13 开始就存在于内核中，它的前身是 dnotify ( [http://en.wikipedia.org/wiki/Dnotify](http://en.wikipedia.org/wiki/Dnotify) )。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-19T17:16:52.553

我认为您可以为此使用[审核](http://www.cyberciti.biz/tips/linux-audit-files-to-see-who-made-changes-to-a-file.html)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-11-05T09:31:16.187

[这](http://blinkeye.ch/dokuwiki/doku.php/projects/lkm)可能对您有用。

基本上，由于系统调用表不是直接在较新的内核中导出的，因此您必须自己进行一些搜索以确定其位置。然后，您可以拦截您选择的系统调用并对其进行操作。但是，替换其他内核函数会困难得多，除非其中一些函数的组织方式与系统调用相同（它们出现在某些调度表上等）——这根本不常见。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-14T19:04:02.120

大多数文件系统工作已经在模块中完成，假设文件系统代码是作为模块构建的，而不是内置到内核中（这意味着“真正的”答案取决于内核构建选项）。

假设您要记录的所有位都与文件系统相关，并且这些文件系统例程是作为模块构建的，那么您应该能够更改您感兴趣的文件系统模块并重新加载它们。

如果这些假设不成立，或者不能成立，那么事情显然会变得更加棘手，我真的无法进一步指出你。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-14T20:30:24.927

由于您只想记录调用（即您实际上不会覆盖它们），并且对内核代码进行少量更改是可以接受的，因此最简洁的方法是为您感兴趣的每个函数添加一个挂钩（使用通知链甚至是普通的函数指针）。然后，您的模块只需将自己注册到您添加的所有钩子（并在卸载时从它们中注销）。

也很可能其他人已经为您完成了添加钩子的工作。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-14T21:05:29.193

你不想修改现有的系统调用，你想检测它们。这就是[SystemTap](http://sourceware.org/systemtap/)的用途。如果您真的想通过编写自己的模块来实现并拦截系统调用，我建议您阅读一些 rootkit 文献，但我没有任何方便的链接（尽管想到了 phrack）。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-11T00:08:44.333

看看[http://www.tldp.org/LDP/lkmpg/2.6/html/x978.html](http://www.tldp.org/LDP/lkmpg/2.6/html/x978.html)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-11-05T09:14:05.517

根据 KernelTrap.org [，您可以做一个简单的补丁](http://kerneltrap.org/node/4010)并重新编译内核以导出 sys_call_table 变量：

```
// add the following in the file arch/i386/kernel/i386_ksyms.c
extern void* sys_call_table[];
EXPORT_SYMBOL(sys_call_table); 
```

然后只需按照[以下过程替换](http://tldp.org/LDP/lkmpg/2.6/html/x978.html)Linux 内核模块编程指南中的系统调用：

> 这里的源代码就是这样一个内核模块的一个例子。我们想“窥探”某个用户，并`printk()`在该用户打开文件时查看消息。为此，我们将打开文件的系统调用替换为我们自己的函数，称为`our_sys_open`. 该函数检查当前进程的 uid（用户 id），如果它等于我们窥探到的 uid，则调用它`printk()`以显示要打开的文件的名称。`open()` 然后，无论哪种方式，它都会调用具有相同参数的原始函数来实际打开文件。
> 
> 该`init_module`函数替换了适当的位置`sys_call_table` 并将原始指针保存在变量中。该`cleanup_module`函数使用该变量将一切恢复正常。这种方法很危险，因为两个内核模块可能会更改同一个系统调用。假设我们有两个内核模块，A 和 B。A 的`open`系统调用是`A_open` ，B 的系统调用是`B_open`。现在，当 A 插入内核时，系统调用被替换为`A_open`，完成后将调用原来`sys_open`的。接下来，将 B 插入内核，将系统调用替换为，当它完成时`B_open`，它将调用它认为是原始系统调用 的 ， 。`A_open`

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-09-10T19:50:58.467

如果共享库调用系统调用，您将无法创建一个更改该系统调用的模块。有关更改系统调用的更多信息，您可能想查看这里 [http://www.xml.com/ldd/chapter/book/](http://www.xml.com/ldd/chapter/book/) 那里有一些关于它们如何更改 open() 系统调用的内容。一个例子在这里 [http://tldp.org/LDP/lkmpg/x931.html](http://tldp.org/LDP/lkmpg/x931.html)

# windows - 如何使用 VB6 调用 Windows shell 命令？

> ID：290899
> 
> 赞同：10
> 
> 时间：2008-11-14T18:05:16.840
> 
> 标签：windows, command-line, vb6

究竟如何使用 VB6 才能像从命令行一样调用任何 Windows shell 命令？

例如，一些微不足道的事情：

```
echo foo 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-14T18:11:00.793

这是你如何做到的：

```
Shell "cmd echo foo", vbNormalFocus 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-25T18:38:55.490

我一直使用 wshShell 对象的 Run 方法，在您在项目中引用 Windows 脚本宿主对象模型后可用：

```
Dim shell As wshShell
Dim lngReturnCode As Long
Dim strShellCommand As String

Set shell = New wshShell

strShellCommand = "C:\Program Files\My Company\MyProg.exe " & _
   "-Ffoption -Ggoption"

lngReturnCode = shell.Run(strShellCommand, vbNormalFocus, vbTrue) 
```

您将获得与普通 Shell 语句相同的功能，但最后一个参数让您决定是否同步运行带壳程序。使用 vbTrue 的上述调用是同步的。使用 vbFalse 异步启动程序。

而且，如前面的答案中所述，您需要使用“/c”开关运行命令外壳来执行内部命令，例如您问题中的“echo foo”。您将“cmd /c echo foo”发送到 Run 方法。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-14T18:07:47.850

壳牌和壳牌执行？

[http://msdn.microsoft.com/en-us/library/aa242087.aspx](http://msdn.microsoft.com/en-us/library/aa242087.aspx)

```
Dim RetVal
RetVal = Shell("C:\WINDOWS\CALC.EXE", 1)   ' Run Calculator. 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-27T19:54:30.580

```
Shell "cmd /c echo foo" 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-27T04:56:11.453

所有的组合

```
Shell Environ("COMSPEC") & " /c echo foo", vbNormalFocus 
```

如果您希望支持 Windows 9x 或 me 等早期系统，您应该考虑扩展 COMSPEC 环境变量。

您还可以使用以下方法获取进程 ID

```
pid = Shell(Environ("COMSPEC") & " /c echo foo", vbNormalFocus) 
```

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2015-06-11T23:34:23.047

只使用双引号：`""...""`

示例 - 发送确认通行证以执行任务：

```
shell (""echo pass|schtasks /create /TR "C:\folder\...\program.exe" /more_parameters"") 
```

因为第一个`"`是封闭的`"C:\...`，字符串会停止。

# .net - 机器联机时的 WMI 事件

> ID：290908
> 
> 赞同：2
> 
> 时间：2008-11-14T18:09:02.200
> 
> 标签：.net, wmi

是否有您可以订阅的 WMI 事件，当远程计算机启动并联机或脱机时会触发该事件？

我的应用程序需要能够监控机器的可用性，理想情况下，我想要一些可以通过事件而不是连续轮询工作的东西。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-02T19:05:05.530

订阅关闭事件在理论上是可能的。您可以订阅以获取“系统”事件日志的更新。您将从 Source = "EventLog" 和 EventID = 6006 中查找事件。此事件包含以下消息：

> 事件日志服务已停止。

这通常是关机时写入的最后一条消息。可是等等！通过 WMI 接收此信息可能会有问题。为什么？可能是 WMI 服务本身在 EventLog 之前关闭，因此它可能是 Catch 22。您可能会在您正在监视的服务器上查找关闭期间较早发生的另一条消息，并注意这一点。

启动事件伴随着一组更麻烦的 Catch 22s。想一想 WMI 事件是如何工作的。要获取事件，您必须通过 DCOM 打开与远程 WMI 服务器的连接，并发出 WQL 查询以指示您想要什么事件。为了接收启动事件，您必须“神奇地”知道在事件被触发之前打开所述连接并发出所述查询。

几年前，我编写了一项服务，该服务从远程服务器收集事件日志条目，用于网络监控应用程序。只是检测到遥控器的 DCOM 连接何时丢失并需要重建的逻辑是一个主要的痛苦。碰巧这是一个更大系统中的一个组件，它无论如何都会 ping 远程主机，所以我们最终依靠该信息来知道何时重建我们的 DCOM 连接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-02T19:23:31.700

这些系统是否使用 DHCP？监视 DHCP 续订以查看系统何时重新联机可能更容易。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T21:00:54.710

对 Microsoft 和其他站点的细读不会产生有关 WMI 中“启动”事件的任何信息。但是，此[线程](http://bytes.com/forum/thread838283.html)建议在您要监视的服务器上的启动文件夹中安装一些东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-02T19:39:19.843

通常，根据我的经验，最好使用 active (polling/pinging/whatever you want to call it)

你不喜欢投票怎么办？（总的来说，我和你一样不喜欢大多数用途的轮询，但在这种情况下，它可能是一个很好的解决方案）

至少您可以创建一些小型轻量级轮询过程，然后在机器状态发生变化时向一组订阅者触发事件。

然后，如果您找到更好的解决方案，您已经有了事件接口。

# c++ - C ++：派生+基类实现单个接口？

> ID：290913
> 
> 赞同：12
> 
> 时间：2008-11-14T18:11:07.110
> 
> 标签：c++, class, inheritance, interface

在 C++ 中，是否可以让基类和派生类实现单个接口？

例如：

```
class Interface
{
    public:
        virtual void BaseFunction() = 0;
        virtual void DerivedFunction() = 0;
};

class Base
{
    public:
        virtual void BaseFunction(){}
};

class Derived : public Base, public Interface
{
    public: 
        void DerivedFunction(){}
};

void main()
{
    Derived derived;
} 
```

这失败了，因为 Derived 无法实例化。就编译器而言，从未定义过 Interface::BaseFunction。

到目前为止，我发现的唯一解决方案是在 Derived 中声明一个传递函数

```
class Derived : public Base, public Interface
{
    public: 
        void DerivedFunction(){}
        void BaseFunction(){ Base::BaseFunction(); }
}; 
```

有没有更好的解决方案？

* * *

**编辑：**如果重要的话，这是我在使用 MFC 对话框时遇到的一个现实问题。

我有一个从 CDialog 派生的对话框类（可以说是 MyDialog）。由于依赖问题，我需要创建一个抽象接口（MyDialogInterface）。使用 MyDialogInterface 的类需要使用 MyDialog 特有的方法，但也需要调用 CDialog::SetParent。我刚刚通过创建 MyDialog::SetParent 并将其传递给 CDialog::SetParent 来解决它，但想知道是否有更好的方法。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-14T18:14:03.437

C++ 没有注意到从 Base 继承的函数已经实现`BaseFunction`：该函数必须在派生自`Interface`. 以这种方式更改它：

```
class Interface
{
    public:
        virtual void BaseFunction() = 0;
        virtual void DerivedFunction() = 0;
};

class Base : public Interface
{
    public:
        virtual void BaseFunction(){}
};

class Derived : public Base
{
    public: 
        virtual void DerivedFunction(){}
};

int main()
{
    Derived derived;
} 
```

如果您希望能够只实现其中一个，请拆分`Interface`为两个接口：

```
class DerivedInterface
{
    public:
        virtual void DerivedFunction() = 0;
};

class BaseInterface
{
    public:
        virtual void BaseFunction() = 0;
};

class Base : public BaseInterface
{
    public:
        virtual void BaseFunction(){}
};

class Derived : public DerivedInterface
{
    public: 
        virtual void DerivedFunction(){}
};  

class Both : public DerivedInterface, public Base {
    public: 
        virtual void DerivedFunction(){}
};

int main()
{
    Derived derived;
    Base base;
    Both both;
} 
```

注意：main 必须返回 int
注意：最好`virtual`将派生的成员函数放在基类中的虚拟成员函数的前面，即使不是严格要求也是如此。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-14T18:40:38.157

看起来 Derived “is-a” Base 的情况并非如此，这表明包含可能是比继承更好的实现。

此外，您的 Derived 成员函数也应该被标记为虚拟函数。

```
class Contained
{
    public:
        void containedFunction() {}
};

class Derived
{
    public:
        virtual void derivedFunction() {}
        virtual void containedFunction() {return contained.containedFunction();}
    private:
        Containted contained;
}; 
```

如果要隐藏实现细节，可以使包含的成员成为引用或智能指针。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-14T18:16:12.997

问题是，在您的示例中，您有两个实现`Interface`，一个来自`Base`，一个来自`Derived`。这是 C++ 语言的设计。正如已经指出的，只需`Interface`删除`Derived`.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-14T20:53:22.947

我同意 litb 的回答。但是，这里有机会了解一些虚函数和多重继承是如何工作的。

当一个类有多个基类时，每个基类都有单独的 vtable。`Derived`将具有如下所示的 vtable 结构：

```
Derived
 vtable: Interface
   BaseFunction*
   DerivedFunction*
 vtable: Base
   BaseFunction* 
```

此外，每个基类只能看到自己的 vtable。当`Base`被实例化时，它填充`Base::BaseFunction`了vtable中的指针，但是看不到Interface的vtable。

如果您提供的代码可以编译，则生成的实例的 vtable 结构`Derived`将如下所示：

```
Derived
 vtable: Interface
   BaseFunction* = 0
   DerivedFunction* = Derived::DerivedFunction
 vtable: Base
   BaseFunction* = Base::BaseFunction 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-15T01:57:41.910

我发现 litb 的回答缺少一件事。如果我有一个`Derived`实例，我可以得到一个`DerivedInterface`and `BaseInterface`。但是，如果我只有一个，`DerivedInterface`我就无法得到一个`BaseInterface`，因为派生`DerivedInterface`自`BaseInterface`将不起作用。

但是，由于某种原因，我一直在限制自己进行编译时间检查。这`DerivedInterface`很好用：

```
class DerivedInterface
{
    public:
        virtual void DerivedFunction() = 0;
        BaseInterface* GetBaseInterface()
            {return dynamic_cast<BaseInterface*>(this);}
};

void main()
{
    Derived derived;

    DerivedInterface* derivedInterface = &derived;
    derivedInterface->GetBaseInterface()->BaseFunction();
} 
```

Derived 中不需要传递函数，每个人都很高兴。当然，它不再是严格意义上的接口，但没关系。为什么我没有早点想到呢？:)

# sql-server - 如何在远程 SQL Server 上应用 SQL 脚本？

> ID：290922
> 
> 赞同：2
> 
> 时间：2008-11-14T18:14:07.930
> 
> 标签：sql-server, build-automation, sql-scripts

我正在尝试完全自动化我的构建，其中一部分是将 SQL 脚本应用于 SQL Server。
我创建了一个批处理文件，它调用 SQL Server 实用程序 (OSQL.EXE) 来应用脚本，如果我直接在 SQL Server 上调用它，它就可以工作。
但是我不能在我的构建机器上使用它，因为它没有安装 SQL Server。

有没有办法从我的构建机器在远程机器上启动我的批处理？
这个问题还有其他解决方案吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-14T18:28:40.087

您可以在客户端计算机上免费安装**SQLExpress**并使用**sqlcmd.exe**，它相当于 MSSQLServer 上的 osql 和 isql 工具。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-15T01:36:48.410

只安装[Sql Server 客户端](http://www.microsoft.com/downloads/details.aspx?FamilyID=d09c1d60-a13c-4479-9b91-9e8b9d835cdc&DisplayLang=en)

> *   Microsoft SQL Server 2005 管理对象集合：然后您可以使用它来运行任何脚本或来自 C# 的任何其他内容。因此您可以创建一个使用 SMO 完成这些工作的项目，并在您的构建设置中使用它。
>     
>     
> *   Microsoft SQL Server 2005 命令行查询实用程序：只安装 SQLCMD 并用它来做事。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T18:20:47.217

要使用 osql，您需要安装 SQL Server，但您可以使用其他数据访问方法从远程计算机与 SQL Server 计算机进行通信。例如，您可以让 .VBS 脚本使用 ADO。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-14T18:24:02.967

两个想法：

1.  您是否尝试过复制 OSQL.exe 并在构建机器上安装客户端 SQL Server 库？我没有，但我认为值得一试。

2.  编写一个连接和提供数据的程序，应该不会太难。从文件中读取 SQL 并将其提供给指定的 SQL Server。

# version-control - 如何禁用 CVS 粘性选项 -kk 进行关键字替换？

> ID：290923
> 
> 赞同：3
> 
> 时间：2008-11-14T18:14:34.997
> 
> 标签：version-control, cvs, keyword-substitution

我在 cvs 中有一个将 Sticky Options 设置为`-kk`. 这将所有 cvs 关键字替换为仅关键字名称以促进差异。例如，`$Author: Alex B$`变成`$Author$`。

如何禁用该`-kk`行为并返回替换关键字的“正常” cvs？我试过`rm`'ing文件和更新，我试过`cvs update -A`了，都没有改变标志。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-14T18:24:52.620

```
cvs update -kkv <filename> 
```

会将粘性选项重置为`keyword`和`value`

**编辑：** 更正`checkout`为`update`，感谢[Alex B](https://stackoverflow.com/users/6180/alex-b)的更正。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-09-14T15:46:34.123

在文件上运行 cvs 状态仍然会导致设置“粘性选项”，例如：

`Sticky options: -kk`

要完全删除这些，请编辑 CVS/Entries 文件并从相关条目中删除“-kk”。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-11-02T12:33:56.917

你应该使用

```
cvs admin -kkv <filename> 
```

永久更改模式。使用

```
cvs update -kkv <filename> 
```

只会在您的本地机器上更改它

# asp.net-mvc - HttpContext.Current 调用背后有多少计算量？

> ID：290927
> 
> 赞同：5
> 
> 时间：2008-11-14T18:16:36.443
> 
> 标签：asp.net-mvc, performance

这个很贵吗？

我正在开发一个直接呈现给 Response.Output 的 HtmlHelper，以节省不必要的字符串创建，我需要在以下之间进行选择：

```
<% Validator.RenderClient(Response.Output); %> 
```

和

```
<% Validator.RenderClient(); %> 
```

并从 HttpContext.Current.Response 获取 textWriter

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-01-08T13:37:00.400

@道金斯

100 次运行太少，您需要运行大约 10000 次并重复它，然后取其平均值以获得可靠的结果。在您的示例中，误差幅度很大，但这是正确的方法。

这是我所做的：

```
var results1 = new List<long>();
var results2 = new List<long>();

for (int j = 0; j < 100; j++)
{
    var sp = new System.Diagnostics.Stopwatch();

    // With HttpContext.Current: 
    sp.Start();
    for (int i = 0; i < 10000; i++)
    {
        HttpContext.Current.Response.Output.Write(i);
    }
    sp.Stop();

    results1.Add(sp.ElapsedTicks);

    // Without: 
    TextWriter output2 = HttpContext.Current.Response.Output;
    sp.Reset();

    sp.Start();
    for (int i = 0; i < 10000; i++)
    {
        output2.Write(i);
    }
    sp.Stop();

    HttpContext.Current.Response.Clear();

    results2.Add(sp.ElapsedTicks);
}

results1.Sort();
results2.Sort();

HttpContext.Current.Response.Write(string.Format("HttpContext.Current={0:0.000}ms, Local variable={1:0.000}ms, R={2:0.0%}<br/>", results1[results1.Count / 2] / (double)TimeSpan.TicksPerMillisecond, results2[results2.Count / 2] / (double)TimeSpan.TicksPerMillisecond, (double)results1[results1.Count / 2] / (double)results2[results2.Count / 2])); 
```

您的结果表明存在 18% 的性能差异，这表明它更昂贵，但下降了 8%。

我重新计算了几次，得出了 10% 的差异，误差小于 1%。

它围绕着：

```
HttpContext.Current=0,536ms, Local variable=0,486ms, R=110,2% 
```

无论如何， HttpContext.Current 会造成一个重大的性能问题，您需要将其称为每个请求超过 10000 个（成本主要由 Response.Write 调用组成）。这很可能不会发生。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-14T18:25:48.827

从反射器

```
public static HttpContext get_Current()
{
    return (ContextBase.Current as HttpContext);
} 
```

调用 ContextBase 调用

```
public static object HostContext
{
    get
    {
        object hostContext = 
          Thread.CurrentThread.GetIllogicalCallContext().HostContext;
        if (hostContext == null)
        {
            hostContext = GetLogicalCallContext().HostContext;
        }
        return hostContext;
    } 
```

...

所以有一些线程“东西”正在发生；具体的我真的不知道。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-16T11:57:54.210

它根本不是密集的。我不知道为什么我没有第一次尝试这个：

```
 System.Diagnostics.Stopwatch sp = new System.Diagnostics.Stopwatch();

        // With HttpContext.Current:
        sp.Start();
        for (int i = 0; i < 100; i++)
        {
            HttpContext.Current.Response.Output.Write(i.ToString());
        }
        sp.Stop();
        long result1 = sp.ElapsedTicks;

        // Without:
        TextWriter output2 = HttpContext.Current.Response.Output;
        sp.Reset();
        sp.Start();
        for (int i = 0; i < 100; i++)
        {
            output2.Write(i.ToString());
        }
        sp.Stop();
        long result2 = sp.ElapsedTicks; 
```

我的计算机结果是：

结果1= 395 滴答 结果2= 332 滴答

所以它非常快！

# java - 使用 ActiveMQ 5，是否可以在内存和网络连接中配置代理？

> ID：290928
> 
> 赞同：4
> 
> 时间：2008-11-14T18:16:41.513
> 
> 标签：java, jms, activemq

我们有一组应用程序，我想使用 JMS 在它们之间进行消息传递。现在，我们的应用程序都与 ActiveMQ 代理建立 TCP 连接。是否可以让同一主机上的 15 个左右的应用程序使用 inVM 连接或使用某种形式的共享内存，而该主机上的其余 20 个左右的应用程序仍然使用 TCP？

基本上，我想将一个配置有 inVM 的代理和一个配置有 TCP 的代理结合起来。我可以这样做，还是必须进行网桥配置？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T12:33:32.720

仅当应用程序位于同一 JVM 中时，inVM 连接才有效。

如果它们在同一个盒子上但在不同的进程中，那么 TCP 是最好的选择。大多数操作系统将使用高效的 TCP 实现，因此您实际上不会进入网络在本地进程之间进行通信。

消息是基于流的，所以共享内存对 ActiveMQ 没有帮助。如果您的应用程序与代理在同一个 JVM 中，它实际上只是 TCP 或 VM 的一种选择

# javascript - 确定浏览器是否允许关注单选框/复选框

> ID：290940
> 
> 赞同：0
> 
> 时间：2008-11-14T18:21:19.303
> 
> 标签：javascript, browser

有谁知道是否可以使用 JavaScript 确定用户的浏览器是否允许选中复选框和单选按钮？换句话说，您是否可以通过选项卡来选择它们。

我不能只使用浏览器检测来做到这一点，因为在至少一种情况下（Safari），用户可以打开和关闭该功能。

同样在 Safari 中，即使关闭此功能，也定义了 focus() 函数，并且它不会引发错误。因此，检查该功能将不起作用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-15T00:16:02.210

一种方法是尝试设置焦点，然后检测它是否成功。通过分配一个将变量设置为 true 的 onfocus 事件来执行此操作，尝试聚焦它，然后检查变量是否为 true。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-14T20:24:49.790

JavaScript 无法读取浏览器的设置。这样做将违反安全规定。

话虽如此，如果需要用户交互而不给他们明确的指示以执行可测试的操作，则无法测试**未发生的事情。**所以没有被动的方法来测试禁用标签的用户。

这就像在 Windows 中更改屏幕分辨率。用户更改分辨率，因为 VGA 是被动的，除非用户执行操作，否则操作系统无法判断更改是否成功。您需要询问他们，设置超时并假设如果您得到否定结果它不起作用。您无法区分否定结果和无用户交互之间的区别。

# apache-flex - CakePHP 和 Flex - 如何保持 $this->Auth->user() 有效？

> ID：290948
> 
> 赞同：2
> 
> 时间：2008-11-14T18:25:31.013
> 
> 标签：apache-flex, authentication, cakephp

大家好......我在将 flex 和 cakephp 之间的集成与身份验证一起工作时遇到了一点困难......

我在 Flex 上有一个 MVC，它与 cakephp 上的用户 MVC 通信。它验证并将登录的用户发回给我，但是当我尝试访问另一个控制器时，$this->Auth->user() 的值始终为空......

身份验证不是持久的....

最有趣的是......如果我首先登录 cakephp（通过 cakephp 视图）然后开始在 Flex 端工作，一切正常，直到达到超时......当我调用 /当我通过 flex 调用服务时，通过 cakephp 登录的用户/登录不起作用....

附加信息：我正在使用 CakeAMF/amfext 和 Fake 使这种集成成为可能

任何想法 ？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T19:47:52.267

看来cookie是问题....

从 Flex 登录时，不会创建会话中带有 CAKEPHP 键的 cookie....

到目前为止唯一的解决方案是从 Cake 登录并重定向到 Flex...

似乎在使用 Flex 应用程序时会话保持不变

# authentication - Web 登录/身份验证的最佳实践？

> ID：290951
> 
> 赞同：24
> 
> 时间：2008-11-14T18:27:00.197
> 
> 标签：authentication

为网站的用户身份验证部分（包括帐户注册、登录和密码重置）编写代码非常简单，但是您需要什么才能进行真正*好的*用户身份验证设置呢？例如，我认为不存储明文密码是网站的最低要求，但这条建议似乎主要是通过口耳相传的方式传播的，许多网站仍然没有遵循它。

对于网站的用户身份验证部分，还有哪些其他好的建议或好的要求？例如，用户名应该是用户选择的，还是应该是电子邮件地址？用户注册部分有什么陷阱吗？（验证码本身可能值得一整个话题。）密码重置部分有什么陷阱吗？还要别的吗？

### 编辑：

这里有些重复：[best-practices-for-login-pages](https://stackoverflow.com/questions/243957/best-practices-for-login-pages)

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-11-14T18:45:54.137

**加密**

昨天有一个关于这个的问题——“[我为什么要关心散列密码？](https://stackoverflow.com/questions/287597/why-should-i-care-about-hashing-passwords-anyway) ”它涵盖了你应该这样做的所有原因。

**验证码**

我不同意 Ricardo 关于验证码的观点 - 总是需要验证码，即使是非常不受欢迎的网站也会成为垃圾邮件发送者的目标。我设置了一些博客来测试一些我从未从其他任何地方链接过的代码，这些代码被垃圾邮件发送者奇迹般地发现了。当垃圾邮件发送者在您的网站上充斥着无数关于伟哥的相同帖子时，您会后悔没有多花 20 分钟来安装验证码。[reCaptcha](http://recaptcha.net/)有一些[插件](http://recaptcha.net/resources.html)可以让安装变得非常简单，而且你可以帮助他们对书籍进行数字化。

不要忘记视障用户需要音频验证码。

**忘记密码**

如果您已经确认了用户的电子邮件地址，那么您可以为他们生成一个随机的新密码。确保立即提示他们更改密码，因为人们会立即忘记随机生成的密码。

**电子邮件**

不要费心尝试实现涵盖所有可能电子邮件地址的复杂正则表达式。对@ 进行简单检查，然后让用户单击发送到其电子邮件地址的链接进行验证。这些天来这是常见的做法，但我仍然遇到试图“聪明”的人。

**表单验证**

除了在注册表单上进行服务器端验证外，您还应该以 AJAX 的形式进行客户端验证，以让用户在填写时知道他们是否使用了他们选择的用户名，他们的密码是否可以接受等。用户可能会因为不得不多次重新提交注册表而感到沮丧。

**身份验证本身**

让人们使用他们的用户名或电子邮件地址登录很好，因为人们更容易记住电子邮件地址而不是用户名，特别是如果他们有一段时间没有访问您的网站。

如果您的站点需要增加安全性（例如，如果您正在销售商品，而人们只需登录即可获得），请请求另一条信息。询问他们的邮政编码是一个好主意，因为它只需要几秒钟的额外输入时间，并且使暴力破解密码变得更加困难。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-14T18:34:52.257

关于用户名主题，这取决于用户名在网站上的使用方式（除了登录）。如果您的网站基于用户生成的内容，并且您在内容中显示用户名，请允许用户自己选择并确保它不是电子邮件地址。另外，如果要显示用户名，我通常会在注册表单上提供一些警告让用户知道，这样他们就不会使用全名，只是为了稍后在网站上显示时会生气。

我建议在用户在表单上时通过某种类型的 Ajax 调用检查用户名的可用性和有效性。在密码和密码确认消失的情况下重新加载表单，只需要考虑一个新的用户名并重新输入数据是一件痛苦的事情。

其他要考虑的事情是强制执行最小/最大长度和一些关于密码的规则……但不要让注册变得困难。此外，接受密码中的特殊字符。我有几个我喜欢使用的非常强大的密码，而且很多网站都不允许我使用它们，所以我的帐户最终不如我自己创建的安全。

CAPTCHA 是一个好主意，只要确保它不是非常难以弄清楚，这也可能令人沮丧。

有很多事情需要考虑，每个选项都有几个选项，但希望这会让你开始。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-14T18:58:32.863

还请确保您的登录页面使用 SSL 保护，如果您不这样做，那么无论如何用户名和密码将以明文形式通过 Internet 发送。如果其他任何地方都没有敏感信息，则您网站的其余部分不需要受 SSL 保护。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-10-31T06:53:52.770

我会说您使用许多广泛可用的社交网络 API 来为您完成工作。这样做，您将能够完全消除您的页面在登录和用户身份验证（读取密码和用户数据）方面的许多安全漏洞，并将其传递给上述社交网络的稳定人员。

> 而且由于整个过程可以一键完成，这也让你的用户体验更好，可以顺利融入你的用户界面。

此类 API 的一些示例是 Facebook、Google、LinkedIn、Twitter、Dribbble。根据您对目标用户群的想法选择您的。

> 此外，根据我最近的经验，[hello.js](https://github.com/MrSwitch/hello.js/ "你好.js")框架使这项任务变得非常容易。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-18T14:07:01.890

MSDN 发表了一篇文章，涉及其中一些问题；可[在此处](http://www.jeffblankenburg.com/2008/10/6-tips-for-making-website-registration.aspx)获得副本。大多数建议都反映了这里的想法；该文章的另一个想法是“通过您的注册渠道跟踪流量”。跟踪对系统的错误、警告和恢复部分的命中，以查看您是否需要进行一些可用性增强。

# c++ - 当给定的宏/预处理器符号被声明时，如何知道（在 GCC 中）？

> ID：290952
> 
> 赞同：10
> 
> 时间：2008-11-14T18:28:19.430
> 
> 标签：c++, gcc, c-preprocessor

假设我在各种头文件中有#define foo。它可能会扩展到一些不同的事物。我想知道（在编译 .cc 文件时）遇到#define 时，它​​会扩展什么，它是哪个文件以及它是从哪里包含的。

是否可以？如果没有，是否有任何可能有帮助的部分解决方案？

随时添加带有澄清请求的评论。

**编辑：当前的答案似乎集中在有一个#define 并且我只想跳到定义或知道定义是什么的情况上。这是简单的情况，是的，您的解决方案有效。但是当我在不同的文件中有相同的#define，并且想知道哪个是第一个启动时，这些技术都没有用。好的，我实际上使用#warning 仔细找到了正确的位置。但这需要做很多工作。**

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-14T18:48:32.870

你看 ：

```
# shows preprocessed source with cpp internals removed
g++ -E -P file.cc
# shows preprocessed source kept with macros and include directives 
g++ -E -dD -dI -P file.cc 
```

上面的内部是 gcc 的行标记，当您阅读输出时会有点混乱。`-P`剥去他们

```
-E 预处理阶段后停止；不要正确运行编译器。  
     输出以预处理源代码的形式发送到
     标准输出。

     不需要预处理的输入文件将被忽略。
```

注意：评论正确地抱怨这只是部分解决方案。它不会告诉您何时替换宏。它向您显示了预处理的源代码，无论如何这都会有所帮助。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-15T00:45:09.607

> 我想知道（在编译 .cc 文件时）遇到#define 时，

[我知道一个解决方案](http://blogs.msdn.com/oldnewthing/archive/2008/04/10/8373617.aspx)。使用已定义为非法 C++ 代码的符号编译文件（链接到的文章使用“@”）。所以，对于 GCC，你会写

```
gcc my_file.c -Dfoo=@ 
```

当它扩展时，它肯定会导致语法错误，编译器应该告诉你语法错误在哪个文件中，这将非常有帮助。

如果您使用 Raymond Chen 建议的技巧，编译器*可能会*告诉您“冲突”定义的来源，并*可能会*为您提供包含它的列表。但不能保证。因为我不使用宏（我更喜欢 const 和 enum），所以我不能说 GCC 是否是这方面更智能的编译器之一。我不相信 C 或 C++ 标准对此有任何说明，除非一旦预处理器运行，您就会丢失各种有用的信息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-14T18:51:49.993

它不会帮助您找到它的定义位置，但您可以使用 -E -dM 标志查看特定文件的定义

```
g++ -E -dM file.cpp | grep MACRO 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-14T18:51:26.607

对于“它将扩展什么”，我使用 gcc 中的 -E 开关，它给出了预处理的输出。但是没有回溯哪个宏来自哪里（或者是否有宏）。

您可能使用的另一个选项是-g3，这会添加有关宏的调试信息，即稍后您可以在调试器中查看每个宏的定义。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-14T19:20:33.490

一个好的 IDE 可以通过某种形式的跳转到定义按需为您执行此操作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-14T18:48:03.400

使用#warning。它在[这里](http://gcc.gnu.org/onlinedocs/gcc-3.1.1/cpp/Diagnostics.html#Diagnostics)描述。

# asp.net - 常规和安全域路径之间的 Webresource.axd 问题

> ID：290958
> 
> 赞同：0
> 
> 时间：2008-11-14T18:31:01.500
> 
> 标签：asp.net, iis, path, webresource.axd

在我们的设置中，IIS 7 设置中有两个不同的网站指向相同的物理路径。**一个绑定**http://websitename.domain.com/ *（虚拟根~是/*）

 *第二个在[https://webserver.domain.com/userid/websitename](https://webserver.domain.com/)（*所以虚拟根 ~ 是 /userid* **/** websitename **）**。我们将第二个用于每个网站的安全方面。

 *这会导致为生成的 css 加载 Webresources.axd 文件以及为 AJAX.net 工具包加载 javascript 时出现问题。

有没有办法修改这些生成的资源文件的路径。或者以某种方式设置每个应用程序的虚拟根路径。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-14T18:46:29.597

我找到了一种解决方案，使用 Render() 方法将 url 路径替换为正确的路径。此[论坛帖子](http://forums.asp.net/p/1119487/1750443.aspx)包含有关此解决方案的信息。我必须修改它以检查 Request.Url 以查看页面请求来自哪个域。

```
protected override void Render(HtmlTextWriter writer)
{
     try
     {                  
          StringBuilder renderedOutput = new StringBuilder();    
          StringWriter strWriter = new StringWriter(renderedOutput);    
          HtmlTextWriter tWriter = new HtmlTextWriter(strWriter);    
          base.Render(tWriter);

          //this string is to be searched for src="/" mce_src="/" and replace it with correct src="./" mce_src="./". 

          string s = renderedOutput.ToString();
          s = Regex.Replace(s, "(?<=<img[^>]*)(src=\\\"/)", "src=\"./", RegexOptions.IgnoreCase);
          s = Regex.Replace(s, "(?<=<script[^>]*)(src=\\\"/)", "src=\"./", RegexOptions.IgnoreCase);
          s = Regex.Replace(s, "(?<=<a[^>]*)(href=\\\"/)", "href=\"./", RegexOptions.IgnoreCase);

          writer.Write(s);
      }
      catch
      {
      }
  }
} 
```

# .net - Memcached 可以与 ASP.NET 状态服务器互换吗？

> ID：290966
> 
> 赞同：5
> 
> 时间：2008-11-14T18:34:13.257
> 
> 标签：.net, asp.net, memcached

我在负载平衡的 Web 服务器环境中使用 ASP.NET 和 WCF 服务，在服务层使用 Memcached。

我还想用 Memcached 替换使用 ASP.NET 状态服务器（用于会话状态）。现在恐怕这不是一件好事，因为据我了解，Memcached 是缓存服务器而不是状态服务器，这是真的吗？

如果我理解正确，Memcached 不会将数据分发到 Memcached 场中的其他节点。相反，使用一种特殊的散列算法来确定场中的哪个节点包含请求的密钥的数据，而 ASP.NET 状态服务器在添加数据后尽快分发数据，以防止单点故障。

换句话说，Memcached 应该仅用于性能原因，存储在其中的数据应该始终是可重新创建的，以防项目已被删除为新对象腾出空间，或者在实际存储数据的单台机器发生故障的情况下向下。

那么我不能仅仅依靠 Memcached 来存储会话状态数据吗？如果我不能，那么我不明白 Memcached 是如何经常被比较并被视为使用 ScaleOut StateServer 和 ASP.NET 状态服务器的替代方案，因为它们实际上是状态服务器，这是另一回事，对吗？

我现在有点不确定在 Web 服务器场中实现高性能分布式会话状态的最佳方法是什么。

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-31T22:25:35.230

[http://www.codeplex.com/memcachedproviders](http://www.codeplex.com/memcachedproviders)有一个用于 asp.net 的会话状态提供程序，它将值存储在 memcached 中。它提供了在 SQL Server 中备份会话数据的能力。正如 yogman 所说，会话数据存储为一个值。如果发生驱逐，该用户的整个会话将丢失，用户将被引导到登录屏幕。Memcached 不会在过期之前驱逐任何数据，除非它没有足够的空间来保存新数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T19:29:16.657

Memcached 目前不支持数据镜像，它只提供将条目拆分到多台服务器的能力，以防止其中一台被淹没。这可以通过使用服务器地址对您的密钥进行散列，或使用一致的散列算法 (libketama) 来实现。

但总的来说，不应将 Memcached 视为持久存储层，并且在几乎所有情况下，缓存中的数据都应该与数据库中的数据相同。如果您正在更改用户的会话数据并想要缓存它，请在 Memcached 中更新它，然后立即在数据库中更新它。如果你想非常小心，你可以实现一个简单的日志系统，以确保这些数据在系统故障的情况下保持一致。

尽管如此，Memcached 肯定被用于缓存会话，创建者在 Jinux Journal 文章中也这么说。它实际上仅用于优化读取操作，归根结底，您关心的任何数据都应存储在数据库中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T21:45:24.697

在理想情况下，会话数据只是单个值，即用户 ID 的内部数字表示。这意味着用户已成功通过登录页面并提供了正确的密码。

但是其他人喜欢呢，以stackoverflow为例，页面上的动态数据取决于用户：用户的昵称，信誉数，获得的徽章，发表评论的权限。它们通常是跨多个数据库表的多个 JOIN 的结果。

如果不使用 memcached，这些查询几乎总是从磁盘读取数据，这是一个非常缓慢且扩展性不强的操作。数据库里面的缓存？您认为命中率会考虑到数据库在管理会话数据之外的其他事情吗？为什么你必须从磁盘读取而你可以从内存中读取？

当然，任何对相关用户信息的写入都应该使 memcached 中的相应会话失效。

# database - 从一个 DBMS 迁移到另一个

> ID：290970
> 
> 赞同：1
> 
> 时间：2008-11-14T18:36:41.567
> 
> 标签：database, migration, rdbms

有没有人有从一个 DBMS 迁移到另一个 DBMS 的经验？如果你这样做了，你为什么要这样做？特征？成本？公司指令？

有时，我与坚持不使用特定于 DBMS 的特性（例如，SQL Server 中的 CLR 存储过程）的 DBA 合作。如果必须，切换到另一个 DBMS。但到目前为止，我从未被要求切换。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-14T18:49:15.380

在我看来，不利用您使用的数据库的所有功能是愚蠢的。无论您使用多少功能，都很难更改 DBMS。系统之间存在细微的差异（例如一些记录日期和一些记录日期和时间），这将导致令人头疼的变化。没有这样的事情只是切换到一个新的 dbms。

从商业角度来看，还有很多工作要做。分析要更改的新数据库。弄清楚更改数据库对新系统的影响。让开发更改现有系统，测试更改等。列表不胜枚举。在企业系统上进行这样的切换需要几个月甚至几年的时间。我工作的最后一个地方不得不改变 dbs，我们花了整整 11 个月的时间才完成，大约 200 万美元用于顾问、硬件、软件和员工工资。这是一件大事。如果有人说不要使用功能，因为那“可能”有一天会发生，并且会更容易做到，那么很可能，那个人已经不在他们的摇杆上了。与其他一切（很可能）相比，转换这些功能所需的额外时间和金钱是微不足道的。

我们这样做是因为我们在旧 dbms 上运行的系统太大了。数据太多，我们需要更强大的东西。另外，它不再受支持。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-14T19:04:01.230

多次切换。主要是因为“非自愿转换”——旧产品不再受支持或不再适用。

*   DB2 到 Oracle。Pre-UDB 数据被保留并移至 Oracle。
*   MS-访问 Oracle。继续在 Oracle 表上使用 Access 前端。
*   甲骨文到甲骨文。6到8，我觉得...

“你为什么要那么做？” 不是特征。不是成本。在所有情况下，都有一些东西坏了。

*   旧产品不再有效。操作系统升级或其他原因导致旧产品中断。
*   旧产品无法扩展。

切换很少是您选择做的事情。当供应商停业（Ingres 曾经这样做过）或停止支持您的版本（Microsoft 经常这样做）时，您会被迫这样做。

然后，当然，这是一场危机。触发器和存储过程更改的技术复杂性使情况更加复杂。如果只是数据，那不会是太大的危机。转储到某种标准格式（例如 CSV），重新加载，然后您就可以开始运行了。

更重要的是，数据库中的“东西”（存储过程、触发器等）越多，您的应用程序软件就越会变成一堆难以理解（和难以维护）的杂物。没有什么比等待数周才能找到存储过程名称更令人沮丧的了。如果它是 VB 代码，那么每个人都可以访问它。但由于它在数据库中，它变得——自相矛盾地——变得不那么明显了。代码就是代码，应该远离数据。

请参阅[将代码放在哪里 - 数据库与应用程序？](https://stackoverflow.com/questions/22818/where-to-put-your-code-database-vs-application)有关此主题的更多信息。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-14T19:16:33.170

我在一家公司工作了多年，该公司的产品支持 Oracle 或 SQL Server。我们在 Erwin 中维护模型，并从中生成模式脚本、触发器和 Oracle 包。这些包用于使 Oracle 触发器的工作方式类似于 SQL Server 触发器（具有逻辑“插入”和“删除”表）。我们保留了两组存储过程脚本。

有了这些混乱，我建议您可以迁移大型项目，只要您可以成功地使您的数据层与任何逻辑代码完全分离。如果你能做到这一点，那么你就可以在不影响核心应用程序的情况下实现任何数据库功能来加速数据层中的应用程序。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-14T19:14:05.017

我参与了几个将数据从一个数据库迁移到另一个数据库的项目。在每种情况下，迁移的是数据，而不是 RDMBS。如果应用程序正在运行，那么为了切换而切换数据库不会有任何压力。迁移的动力通常是因为旧系统的数据要么过时，要么不兼容，或者两者兼而有之，这也提供了切换 RDBMS 的机会。

最可能的变化是将参考数据（员工、客户等）整合到现有的主数据库中（为了一致性和易用性），然后修改所有其他表，以便键指向新的参考数据. 这需要在堆栈上下更改架构和相应的代码。这是一次数据迁移，而不是数据库迁移。您很可能希望利用这个机会添加数据，或标准化名称，或 (de)-normalize 表格等。

结果是这些项目几乎总是对数据、模式和代码产生巨大的影响，而任何将 T-SQL 翻译成 PL-SQL 所需的工作都只是项目的一小部分。 . 因此，如果您为一个不错的 RDBMS 付费，请使用它。否则，就像不使用新车的后备箱或手套箱一样，这样在购买新车时换车会更容易。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-14T19:18:34.027

还有一点（支持 S.Lott）。根据您的开发环境，您的开发人员可能无法轻松开发甚至查看存储过程。在两组不同的开发工具和执行环境之间拆分您的应用程序代码可能会变得很复杂，并且会更难找到熟练的员工。

我不认为这是反对存储过程的论据，但在决定应用程序的给定组件的代码应该驻留在哪里时，这肯定是需要考虑的事情。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-07-05T00:36:55.190

我们完成了从 HP3000 到 Oracle 的迁移。这让我们损失了 2500 万美元，还增加了损失 2 亿美元数据的成本，因为他们太匆忙了，根本没有考虑自己在做什么。此外，我发现很多地方只是将其视为一个举动。他们会在以后弄清楚其余的......很久以后。

# silverlight - Silverlight 控件模板颜色属性

> ID：290979
> 
> 赞同：1
> 
> 时间：2008-11-14T18:41:39.683
> 
> 标签：silverlight, xaml, silverlight-2.0, templating

我正在为 Silverlight 2 中的 Button 控件创建一个控件模板。我从一个空模板开始，并添加了我想要的视觉元素。主要的视觉元素只是一个充满颜色的路径（形状）。按钮控件已经有一个与之关联的 Color 属性，我想知道是否可以将按钮控件的 Color 属性与模板内路径的 Color 属性链接起来？在 Button 上有一个实际上对按钮没有影响的 Color 属性似乎毫无意义。

我在我的应用程序中的实际目标是让这个按钮有 4 种不同的颜色可用，到目前为止我能想到的唯一选项是 4 个不同的模板或编写一个继承自 Button 的新控件，这些解决方案似乎都不像他们正在采用控制模板思想的优势。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-14T19:26:55.257

Silverlight 可能没有它可用，但您应该能够使用模板绑定：

```
<Path Fill="{TemplateBinding BackgroundColor}" /> 
```

然后你可以使用

```
<Button Background="Blue" />
<Button Background="Red" />
<Button Background="Green" />
<Button Background="Yellow" /> 
```

高温高压

# c# - 错误：需要强命名程序集

> ID：290980
> 
> 赞同：32
> 
> 时间：2008-11-14T18:41:42.337
> 
> 标签：c#, .net

我有一个 Windows 窗体项目（VS 2005，.net 2.0）。该解决方案引用了 9 个项目。在我的一台计算机上一切正常并编译良好。当我将它移动到第二台计算机时，9 个项目中有 8 个编译没有问题。当我尝试编译第 9 个项目（应用程序的主项目 - 生成 .exe 文件来执行应用程序）时，我收到以下错误：

```
'Error 3: A strongly-named assembly is required. (Exception from HRESULT: 0x80131044)' 
```

错误的文件位置列为“C:\PATH-TO-APP\LC”。

我已经检查了项目属性，并且所有项目都设置为在调试模式下构建，它们都不应该被签名。在失败的项目中，它引用的唯一一个不在任何其他项目中的程序集是 Microsoft.VisualBasic（一个 .net 2.0 程序集）。所以我不知道是什么 id 导致了这个错误（上面在错误消息中引用的文件 - “LC” - 不存在。

任何人都知道我如何强制项目接受所有未签名的程序集，或者确定哪个程序集是罪魁祸首？

这个工作的开发环境和当前的开发环境之间唯一有意义的区别是第一个是 XP，这是 Vista64。但是，我的一位使用 XP 的同事遇到了同样的错误。

**正在使用的第三方程序集：**

*   ComponentFactory.Krypton.Toolkit
*   组件工厂.氪.导航器
*   VistaDB.NET20

所有这些都在解决方案中的其他项目中引用，这些项目构建没有问题，所以看起来这些不是问题。

到目前为止，我已经尝试删除 suo 文件、全部重建、从解决方案中卸载和重新加载项目、删除和读取引用的程序集。没有任何效果。

 `* * *

## 回答 #1

> 赞同：17
> 
> 时间：2020-11-13T20:34:54.743

## 错误是什么意思

*“强名称：表示引用已使用密钥对进行签名。”*

如果您当前项目的程序集已签名，那么您的所有参考程序集也**必须**签名。**否则将导致此错误。**

* * *

## 如何检查

解决方案资源管理器 > 参考 > [单击有问题的参考] > 属性

[![强名称 = TRUE](https://i.stack.imgur.com/30ZCG.png)](https://i.stack.imgur.com/30ZCG.png)

* * *

## 怎么修

***方法 1***：取消签名当前项目的程序集。

项目属性 > 签名 > 签署程序集（复选框）

[![在此处输入图像描述](https://i.stack.imgur.com/jH7bO.png)](https://i.stack.imgur.com/jH7bO.png)

***方法2***：对参考项目的程序集进行签名。（如果您自己构建它）

[![位于项目属性](https://i.stack.imgur.com/UsJIU.png)](https://i.stack.imgur.com/UsJIU.png)

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2016-07-01T10:53:05.427

### 还有一个可能的原因：

（对于绝望的疑难解答者）

在“**解决方案资源管理器**”窗口中，如果您在参考列表中向下走并在“**属性**”窗口中检查每个，看到属性**Strong Name = False**指向潜在问题。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-02-25T17:13:02.700

我只是通过执行以下操作来构建它：

有问题的项目的属性中有一个许可证文件。删除文件（不再需要）后，项目能够成功构建。所以看起来那是罪魁祸首。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-12-23T07:14:35.850

我已经从我的项目文件夹中删除了许可证文件，并再次重新构建，它已成功构建。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-14T18:46:50.080

检查解决方案资源管理器中每个项目的引用部分...查找对第三方供应商程序集（如 Infragistics 或 Data Dynamics 等）的引用，这些程序集可能未安装在您遇到问题的计算机上

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-14T20:03:07.070

好的，不确定这是否有帮助，但如果您可以访问 ildasm，请检查三个第三方程序集并检查以下内容：

（我在你的错误消息中发现了以下谷歌搜索）它来自另一个人的帖子，所以忽略名称，但关键是清单内的行应该是“.publickeytoken”而不是“.publickey”链接到这个线程是：

[http://social.msdn.microsoft.com/Forums/en-US/clr/thread/56e13ab1-4c03-4571-92f1-759081bcc78b/](http://social.msdn.microsoft.com/Forums/en-US/clr/thread/56e13ab1-4c03-4571-92f1-759081bcc78b/)

```
Public Key or Token: ab 1a 81 37 f9 79 0c 88 
```

看起来不错，对吧？该序列确实是 Reflex.dll 的公钥标记。

如果我们使用 ildasm gui 并单击“manifest”，可以看到问题：

```
.assembly extern Reflex
{
.publickey = (2F 5A 20 3A 86 D3 5F 71 ) // /Z :.._q
.ver 1:0:0:0
} 
```

注意`.publickey`线。

应该说`.publickeytoken`！！！

问题是 Cecil 模块在创建修改后的程序集时，将公钥令牌放在公钥字段中（或者忘记打开一些标志，表明这是一个令牌，而不是完整的公钥。我不知道的细节）。

所以这相当于塞西尔的一个可能的错误。我应该改用盖尔的东西。:)

无论如何，现在我知道原始脚本的唯一问题（在我搬到 Cecil 之前）是它在强命名程序集 (FXCOP) 中引用了非强命名程序集 (Reflex)。

所以我现在修复了它并重新运行了我的原始脚本和......中提琴！有用！！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-08-17T16:11:27.490

我一直在使用许多第三方库（MS Ent Lib），并决定将一些 dll 移动到“未使用”文件夹中。这给了我有问题的错误。我相信我引用的其中一个库实际上引用了另一个需要放在它旁边的库（即使您的项目中不需要引用 dll）。

将库移回后编译的所有内容均未出现此错误。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-25T14:08:35.097

可能是您必须明确指定目标平台并将其设置为 x86。64位版本可能存在问题。

另一件事：您是否以管理员身份运行 VS？当 VS2005 在 Vista 上没有以海拔高度运行时，它会出现问题，也许这个奇怪的编译错误就是其中之一。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-01-06T13:53:27.490

对我来说是一个奇怪的修复，但我刚刚从源代码管理中提取了这个解决方案。

收到此错误，查看了上面的大部分答案，然后删除了解决方案并从源代码管理中重新提取了解决方案。

工作。

只适用于少数人，但我想我是少数人之一，所以会有更多。不知道第一次发生了什么，但不知何故，当我把它们拉过来时，某些组件一定有一些问题。

基本上将其关闭并再次打开。

# java - Java 类类型

> ID：290982
> 
> 赞同：8
> 
> 时间：2008-11-14T18:43:18.793
> 
> 标签：java, generics

我有一个有效的代码块，我想问这里到底发生了什么？

```
Class<?> normalFormClass = null; 
```

- -添加 - -

通配符“ `<?>`”是让我感到困惑的部分。为什么要使用而不是不使用它（泛型）？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-14T18:46:52.153

这意味着它可以是任何类型的类。? 是一个通配符，表示所有类型的集合，或“任何”。所以你以后可以做

```
Integer normalForm = new Integer();
normalFormClass = normalForm.getClass(); 
```

或者

```
String normalForm = new String();
normalFormClass = normalForm.getClass(); 
```

如果您不了解 Java 上的泛型，请阅读[http://java.sun.com/developer/technicalArticles/J2SE/generics/](http://java.sun.com/developer/technicalArticles/J2SE/generics/)

至于为什么，我想可能是为了严格说明你到处*都在*使用泛型并且你的代码与旧的 Java 版本不兼容，或者可能是为了关闭一些触发快乐的 IDE。是的，

```
Class foo 
```

和

```
Class<?> foo 
```

是等价的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-14T20:17:09.227

此外，通用版本

```
Class<?> normalClass = null; 
```

几乎等同于原始类型版本，

```
Class normalClass = null; 
```

主要区别在于后者将与不支持泛型的 Java 版本兼容，例如 Java 1.4。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-15T03:17:55.167

Class<T> 表示从 JDK 1.5 开始，Class 由类定义的类型生成。考虑这一点的一种方法是 Class 是一个用于创建其类型实例的工厂。
具体来说， Class<T> 从 Class.newInstance() 方法创建类型 T 的实例。

从 JDK 1.5 开始，Java 语言规范建议您不要使用原始类型。因此，强烈建议在处理未知类型的 Class 实例时，应将其称为“Class<?>”而不仅仅是“Class”。当然，如果您确实知道类型或某个界限，您可能会发现指定它的一些好处。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-14T19:36:02.820

Class 或 Class<?> 效果同样好。使用后者的一个原因是消除 ide 或编译器在使用第一种形式时会向您抛出的一些警告。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-14T18:45:27.913

我怀疑这是家庭作业，因为我从来没有上过谈论反思的课。

但这是一个简单的空赋值。它什么也没做。

# user-interface - 什么时候应该更新 UI？

> ID：290993
> 
> 赞同：3
> 
> 时间：2008-11-14T18:46:49.910
> 
> 标签：user-interface, layout, software-design

我正在为我的教职员工开发一个在线工具，以计算他们的学位最终成绩，有一段时间我遇到了一些小问题。学生们似乎喜欢使用新的 UI，而且我已经有一段时间没有受到批评了。现在，我需要为程序添加一些功能，这意味着 UI 将不得不稍微碰巧，但在一些非常引人注目的地方。

在观看了整个新 Facebook 的开始之后，以及SO 上[UI 不好的应用程序](https://stackoverflow.com/questions/238177/worst-ui-youve-ever-used)和 MS Office 上的 Ribbon 收到了褒贬不一的评价后，我一直在想，如果用户似乎喜欢，是否真的应该改变 UI它。是否应该在多年后更新 UI 以保持用户的兴趣/提高效率？为了干净的 UI 是否应该保留功能？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-14T19:26:20.873

有趣的。我现在就在那个地方。我们基于网络的系统有一个围绕可靠的可用性概念设计的用户界面，用户喜欢它。（超过 1000 名用户和大量反馈）。

但是营销人员大约每年敲一次我，让系统“更性感”，因为“他们卖不出去”。现在我坚持认为，鉴于用户反馈，如果只有“嘶嘶声”会赢得他们的青睐，他们可能是在向错误的受众进行营销，但仍然......

我通过一些精心选择的参数让他们放松，以重新设计主 UI（菜单外观、徽标位置），如果它不会对可用性产生负面影响，那么我会进行更改。正如我所说，它大约每年发生一次。

有趣的是两件事。

1.  因为没有真正的可用性项目被改变，用户仍然喜欢这个系统。
2.  只需对一般的“外观和感觉”进行细微的改变，就可以让销售人员欣喜若狂。
3.  用户实际上也对这些变化做出了非常积极的反应。每次我们更改时，他们都觉得我们“保持最新”，但总是提到他们喜欢我们不篡改网站工作的事实。

干杯，

-R

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-14T18:53:49.317

这是一个艰难的。

有时无法避免更改 UI 以适应新功能，但如果您真的担心这些更改的影响，您可能希望退后一步，尝试重新陈述您的问题。有没有其他方法来处理这些功能？有没有办法减少对 UI 的影响？您甚至可能想尝试重新考虑整个 UI，并制作一些包含新功能的模型，就好像您是第一次构建它一样。您不必进行更改，但该练习可能会帮助您以新的方式思考问题。您可能还会发现新的 UI 效果更好，如果您让它足够直观，那么更改可能会受到欢迎。如果你要走这条路，我会尝试一个试点，获得一些反馈，并准备好在出现问题时回到旧 UI。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-14T18:52:46.933

理想情况下，当您第一次设计 UI 时，您会创建足够灵活的东西，以便在将来添加您想要的任何功能。在现实世界中，这种情况很少发生。如果可能的话，我会说 UI 更新应该是缓慢而渐进的（这是 facebook 变化的真正问题，突然发生了一个大变化），如果不是这样，那么人们应该得到足够的变化通知，并且在您进行更改时，您应该确保为将来的添加做好计划，以免不必要地频繁惹恼您的用户群。

# c - 带有 libcurl 的 Http 状态码？

> ID：290996
> 
> 赞同：98
> 
> 时间：2008-11-14T18:47:09.300
> 
> 标签：c, http, libcurl

调用 curl_easy_perform 后如何获取 HTTP 状态码（例如 200 或 500）？

* * *

## 回答 #1

> 赞同：146
> 
> 时间：2008-11-14T18:51:13.597

[http://curl.haxx.se/libcurl/c/curl_easy_getinfo.html](http://curl.haxx.se/libcurl/c/curl_easy_getinfo.html)

```
CURLINFO_RESPONSE_CODE

传递一个指向 long 的指针以接收最后收到的 HTTP 或 FTP 代码。这
选项在 libcurl 7.10.7 及更早版本中称为 CURLINFO_HTTP_CODE。这
如果没有收到服务器响应代码，则为零。请注意，一个
代理的 CONNECT 响应应该用 CURLINFO_HTTP_CONNECTCODE 读取
而不是这个。

```

```
curl_code = curl_easy_perform (session);
long http_code = 0;
curl_easy_getinfo (session, CURLINFO_RESPONSE_CODE, &http_code);
if (http_code == 200 && curl_code != CURLE_ABORTED_BY_CALLBACK)
{
         //Succeeded
}
else
{
         //Failed
} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2018-02-12T13:49:13.410

另一个答案是绝对正确的，但我还要补充一点，手动检查错误代码可能不明智，`200`代码并不是唯一表示成功的代码。

我建议使用 libcurl 选项[CURLOPT_FAILONERROR](https://curl.haxx.se/libcurl/c/CURLOPT_FAILONERROR.html)，当它被激活时，将使 libcurl 考虑`400`和`500`-category 状态请求失败并且不会`CURLE_OK`从执行返回。

# delphi - 如何强制 Descendant 类直接使用 Ancestor 方法或有一个不调用继承的新实现？

> ID：290997
> 
> 赞同：2
> 
> 时间：2008-11-14T18:47:38.080
> 
> 标签：delphi, inheritance

我们有一个 TAncestor 类，它有一个虚方法 GetFile。
我们将有一些 TDescendant = class(TAncestor) 可以覆盖 GetFile。
我们希望确保在这种情况下，那些被覆盖的方法不会在其实现中调用继承。
但是如果他们不实现 GetFile 并且只使用来自 TAncestor 的那个，那很好。
有没有（简单的）方法可以做到这一点？

为了更清楚：
-是的，文档清楚地说“不要在您的后代类中使用继承”
-我无法控制其他人在覆盖时将编码什么，也不依赖他们阅读文档
-我不能将执行限制为确切的类 TAncestor 因为如果后代不提供自己的实现，它是合法的，
因为它需要有一个默认实现，所以我不能使其抽象
化——我想通过在基础中检测的方式来执行它通过后代覆盖实现调用代码的类
- 查看堆栈似乎有点过头了，但这是我迄今为止的第一个想法

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-14T19:32:14.700

不，没有办法强制您无法控制的代码*不*调用其他完全可访问的东西。您能做的最好的事情就是强烈反对课程文档中的做法。

如果后代调用继承的方法会有什么后果？如果这意味着程序停止工作，那就这样吧。编写后代类的程序员将测试代码，注意到它不起作用，然后查阅该方法的文档以确保他正确使用它（此时他会知道他不是）。

你可以采取另一种方法。与其使函数成为虚拟函数，并让后代覆盖它，不如提供一个受保护的方法指针属性。

```
type
  TGetFileImpl = procedure of object;

  TAncestor = class
  private
    FGetFile: TGetFileImpl;
  protected
    property GetFileImpl: TGetFileImpl write FGetFile write FGetFile;
  public
    procedure GetFile; // not virtual.
  end;

  TDescendant = class(TAncestor)
  private
    procedure SpecializedGetFile;
  public
    constructor Create;
  end;

procedure TAncestor.GetFile;
begin
  if Assigned(GetFileImpl) then
    GetFileImpl
  else begin
    // Do default implementation instead
  end;
end;

constructor TDescendant.Create;
begin
  GetFileImpl := SpecializedGetFile;
end; 
```

基类提供了一个方法指针，后代可以分配它以指示他们想要自己的特殊处理。如果后代为该属性提供了一个值，那么基类的`GetFile`方法将使用它。否则，它将使用标准实现。定义`TGetFileImpl`以匹配`GetFile`将要的任何签名。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T19:25:57.707

如果后代在您的控制之下，只需覆盖该方法而不使用**继承**关键字。否则，可以做的并不多——这取决于覆盖 GetFile 方法的人是否使用它的继承方法。除了，也许，杰米的想法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-14T19:04:44.957

实现祖先时，覆盖方法，但不要在方法内部调用继承。

```
procedure TDescentdent.GetFile;
begin
  //do not call inherited
  //Do something new
end; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-14T19:05:25.830

可以使 TAncestor.GetFile 抽象，因此它必须被覆盖，但为不想自己实现它的人提供一个辅助方法？

此外，您是否无法控制谁在覆盖此方法？例如，它是否被团队外部的人使用？

```
procedure TDescentdent.GetFile;
begin
  FileUtils.GetFile    
end; 
```

编辑：如果您可以控制后代代码，史蒂夫当然是对的

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-14T19:25:31.687

我不认为你真的想这样做，但无论如何听起来你都没有正确使用继承。

如果你真的需要做这样的事情，也许你可以使用[策略模式](http://en.wikipedia.org/wiki/Strategy_pattern)来代替？将 GetFile 提取到它自己的类层次结构中，其中包含定义合同的抽象类（例如，TAbstractFileUtils）和实现它的具体子类（包括您的默认 TDefaultFileUtils）。构造函数可以采用 TAbstractFileUtils 的实例。这意味着调用者（或工厂方法）负责提供正确的实现。

这不会阻止其他人继承 TDefaultFileUtils 并调用继承的 GetFile，但这并不是继承的工作方式。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-14T21:58:28.743

好吧，不得不澄清这个问题给了我一个解决方案：

```
type
  TForm1 = class(TForm)
    btnGoodDescendant: TButton;
    btnBadDescendant: TButton;
    btnSimpleDescendant: TButton;
    procedure btnGoodDescendantClick(Sender: TObject);
    procedure btnBadDescendantClick(Sender: TObject);
    procedure btnSimpleDescendantClick(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

  TAncestor = class
  public
    procedure GetFile; virtual;
  end;

  TBadDescendant = class(TAncestor)
  public
    procedure GetFile; override;
  end;

  TGoodDescendant = class(TAncestor)
  public
    procedure GetFile; override;
  end;

  TDescendant = class(TAncestor)
  public
  end;

var
  Form1: TForm1;

implementation

{$R *.dfm}

procedure TAncestor.GetFile;
type
  TGetFileImpl = procedure of object;
var
  BaseGetFile, GetFileImpl: TGetFileImpl;
  ClassAncestor: TClass;
begin
  // detecting call through inherited...
  GetFileImpl := GetFile; // method actually called
  ClassAncestor := ClassType;
  while (ClassAncestor <> nil) and (ClassAncestor <> TAncestor) do
    ClassAncestor := ClassAncestor.ClassParent;
  if ClassAncestor = nil then
    raise Exception.Create('no ancestor???');
  BaseGetFile := TAncestor(@ClassAncestor).GetFile; // TAncestor code
  // if we are here, we should be directly using TAncestor code, not
  // not calling inherited from a derived class
  // thus the actual code should be exactly TAncestor code.
  if TMethod(GetFileImpl).Code <> TMethod(BaseGetFile).Code then
    raise Exception.Create('You must not call inherited!');

  // this is the Ancestor work code here
  ShowMessage('Ancestor code for GetFile');
end;

{ TBadDescendant }

procedure TBadDescendant.GetFile;
begin
  inherited;
  ShowMessage('TBadDescendant code for GetFile');
end;

{ TGoodDescendant }

procedure TGoodDescendant.GetFile;
begin
  ShowMessage('TGoodDescendant code for GetFile');
end;

procedure TForm1.btnGoodDescendantClick(Sender: TObject);
begin
  with TGoodDescendant.Create do
    GetFile;
end;

procedure TForm1.btnBadDescendantClick(Sender: TObject);
begin
  with TBadDescendant.Create do
    GetFile;
end;

procedure TForm1.btnSimpleDescendantClick(Sender: TObject);
begin
  with TDescendant.Create do
    GetFile;
end; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-21T12:00:11.007

当然，没有完美的解决方案，例如：

```
procedure TBadDescendant.GetFile;
var
  AncestorImpl : procedure(This : TObject);
  ThisClass : TClass;
begin
  AncestorImpl := @TAncestor.GetFile;
  ThisClass := ClassType;
  PPointer(Self)^ := TAncestor;
  AncestorImpl(Self);
  PPointer(Self)^ := ThisClass;
  ShowMessage('TBadDescendant code for GetFile');
end; 
```

如果 GetFile 不调用其他虚拟方法并且您不关心并发性，这将起作用。`******