# StackOverflow 问答 000241000-000241999

# java - 如何从最后插入的行中获取值？

> ID：241003
> 
> 赞同：59
> 
> 时间：2008-10-27T18:42:11.230
> 
> 标签：java, database, postgresql, jdbc

有没有办法从最后插入的行中获取值？

我正在插入一个 PK 会自动增加的行，我想得到这个 PK。只有 PK 保证在表中是唯一的。

我将 Java 与 JDBC 和 PostgreSQL 一起使用。

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2008-10-27T20:13:00.907

使用 PostgreSQL，您可以通过 RETURNING 关键字来实现：

[PostgresSQL - 返回](http://www.postgresql.org/docs/8.3/interactive/sql-insert.html)

```
INSERT INTO mytable( field_1, field_2,... )
VALUES ( value_1, value_2 ) RETURNING anyfield 
```

它将返回“anyfield”的值。“anyfield”可能是一个序列，也可能不是。

要将它与 JDBC 一起使用，请执行以下操作：

```
ResultSet rs = statement.executeQuery("INSERT ... RETURNING ID");
rs.next();
rs.getInt(1); 
```

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-10-27T21:02:10.307

请参阅[java.sql.Statement](http://java.sun.com/javase/6/docs/api/java/sql/Statement.html)的 API 文档。

基本上，当您调用`executeUpdate()`or时`executeQuery()`，使用`Statement.RETURN_GENERATED_KEYS`常量。然后，您可以调用`getGeneratedKeys`以获取该执行创建的所有行的自动生成键。（假设您的 JDBC 驱动程序提供了它。）

它是这样的：

```
Statement stmt = conn.createStatement();
stmt.execute(sql, Statement.RETURN_GENERATED_KEYS);
ResultSet keyset = stmt.getGeneratedKeys(); 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-10-27T22:18:33.650

如果您使用的是 JDBC 3.0，那么您可以在插入 PK 后立即获取它的值。

这是一篇关于如何讨论的文章：[https ://www.ibm.com/developerworks/java/library/j-jdbcnew/](https://www.ibm.com/developerworks/java/library/j-jdbcnew/)

```
Statement stmt = conn.createStatement();
// Obtain the generated key that results from the query.
stmt.executeUpdate("INSERT INTO authors " +
                   "(first_name, last_name) " +
                   "VALUES ('George', 'Orwell')",
                   Statement.RETURN_GENERATED_KEYS);
ResultSet rs = stmt.getGeneratedKeys();
if ( rs.next() ) {
    // Retrieve the auto generated key(s).
    int key = rs.getInt(1);
} 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2010-06-01T21:28:50.107

自从 PostgreSQL JDBC 驱动程序版本[8.4-701](http://jdbc.postgresql.org/changes.html#version_8.4-701)以来，[`PreparedStatement#getGeneratedKeys()`](http://java.sun.com/javase/6/docs/api/java/sql/Statement.html#getGeneratedKeys%28%29)终于可以完全正常工作了。我们在生产中使用了将近一年，对此我们非常满意。

在“plain JDBC”中，`PreparedStatement`需要按如下方式创建以使其返回键：

```
statement = connection.prepareStatement(SQL, Statement.RETURN_GENERATED_KEYS); 
```

[您可以在此处](http://jdbc.postgresql.org/download.html#current)下载当前的 JDBC 驱动程序版本（目前仍为 8.4-701）。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-27T18:44:59.447

postgresql 中的序列是事务安全的。所以你可以使用

```
currval(sequence) 
```

[引用：](http://www.postgresql.org/docs/7.4/interactive/functions-sequence.html)

> 曲线
> 
> > 返回当前会话中此序列的 nextval 最近获得的值。（如果在此会话中从未为此序列调用过 nextval，则会报告错误。）请注意，由于这将返回会话本地值，因此即使其他会话同时执行 nextval，它也会给出可预测的答案。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-10-28T11:32:48.240

根据此处的答案，这是我解决它的方法：

```
Connection conn = ConnectToDB(); //ConnectToDB establishes a connection to the database.
String sql = "INSERT INTO \"TableName\"" +
        "(\"Column1\", \"Column2\",\"Column3\",\"Column4\")" +
        "VALUES ('value1',value2, 'value3', 'value4') RETURNING 
         \"TableName\".\"TableId\"";
PreparedStatement prpState = conn.prepareStatement(sql);
ResultSet rs = prpState.executeQuery();
if(rs.next()){
      System.out.println(rs.getInt(1));
        } 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2013-05-01T14:23:38.957

如果您正在使用`Statement`，请执行以下操作

```
//MY_NUMBER is the column name in the database 
String generatedColumns[] = {"MY_NUMBER"};
Statement stmt = conn.createStatement();

//String sql holds the insert query
stmt.executeUpdate(sql, generatedColumns);

ResultSet rs = stmt.getGeneratedKeys();

// The generated id

if(rs.next())
long key = rs.getLong(1); 
```

如果您正在使用`PreparedStatement`，请执行以下操作

```
String generatedColumns[] = {"MY_NUMBER"};
PreparedStatement pstmt = conn.prepareStatement(sql,generatedColumns);
pstmt.setString(1, "qwerty");

pstmt.execute();
ResultSet rs = pstmt.getGeneratedKeys();
if(rs.next())
long key = rs.getLong(1); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-27T18:47:33.997

在 postgres 中为 id 列使用序列：

```
INSERT mytable(myid) VALUES (nextval('MySequence'));

SELECT currval('MySequence'); 
```

currval 将返回同一会话中序列的当前值。

（在 MS SQL 中，您将使用 @@identity 或 SCOPE_IDENTITY()）

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-01-07T08:45:03.177

```
PreparedStatement stmt = getConnection(PROJECTDB + 2)
    .prepareStatement("INSERT INTO fonts (font_size) VALUES(?) RETURNING fonts.*");
stmt.setString(1, "986");
ResultSet res = stmt.executeQuery();
while (res.next()) {
    System.out.println("Generated key: " + res.getLong(1));
    System.out.println("Generated key: " + res.getInt(2));
    System.out.println("Generated key: " + res.getInt(3));
}
stmt.close(); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-05-25T20:22:10.800

不要使用 SELECT currval('MySequence') - 该值会在插入失败时递增。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-04-16T20:28:25.833

对于带有注释和 Postgresql 驱动程序 9.0-801.jdbc4 的 MyBatis 3.0.4，您可以在 Mapper 中定义一个接口方法，例如

```
public interface ObjectiveMapper {

@Select("insert into objectives" +
        " (code,title,description) values" +
        " (#{code}, #{title}, #{description}) returning id")
int insert(Objective anObjective); 
```

请注意，使用@Select 而不是@Insert。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-05-31T02:59:10.570

例如：

```
连接 conn = null;
            PreparedStatement sth = null;
            结果集 rs =null;
            尝试 {
                conn = delegate.getConnection();
                sth = conn.prepareStatement(INSERT_SQL);
                sth.setString(1, pais.getNombre());
                sth.executeUpdate();
                rs=sth.getGeneratedKeys();
                如果（rs.next（））{
                    整数 id = (整数) rs.getInt(1);
                    pais.setId(id);
                }
            }

```

没有`,Statement.RETURN_GENERATED_KEYS);"`找到。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-06-28T12:36:22.147

使用那个简单的代码：

```
// Do your insert code

myDataBase.execSQL("INSERT INTO TABLE_NAME (FIELD_NAME1,FIELD_NAME2,...)VALUES (VALUE1,VALUE2,...)");

// Use the sqlite function "last_insert_rowid"

Cursor last_id_inserted = yourBD.rawQuery("SELECT last_insert_rowid()", null);

// Retrieve data from cursor.

last_id_inserted.moveToFirst(); // Don't forget that!

ultimo_id = last_id_inserted.getLong(0);  // For Java, the result is returned on Long type  (64) 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-04-03T08:32:40.017

如果您处于事务中，则可以`SELECT lastval()`在插入后使用以获取最后生成的 id。

# python - 可以集成 Google AppEngine 和 Google Code 以进行持续集成吗？

> ID：241007
> 
> 赞同：18
> 
> 时间：2008-10-27T18:43:41.087
> 
> 标签：python, svn, google-app-engine, continuous-integration, google-code

任何人对如何/是否可以集成 Google 代码提交以导致 Google AppEngine 部署最新代码有任何想法？

我有一个简单的 Google AppEngine 项目的源代码托管在 Google Code 上，如果我每次提交 Subversion 时，AppEngine 都会反映最新的提交，我会很高兴。我不介意现场是否有问题，因为该项目主要供个人使用和学习。

任何人都对如何绑定到代码存储库的颠覆提交和/或如何启动到 AppEngine 的部署有任何想法？理想情况下，该解决方案不需要我的任何手动操作，也不需要我机器上的任何类型的服务器/侦听器软件。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-04T21:37:02.337

[Made By Sofa](http://www.madebysofa.com)有[一篇](http://www.madebysofa.com/#blog/appengine_hosting)关于他们使用 Google App Engine 的工作流程的博文。在倒数第二段中，他们[附加了一个颠覆挂钩](http://www.madebysofa.com/media/downloads/appengine_deploy.sh)，当有人提交代码时，它将自动部署到 Google App Engine。这需要一些调整（因为它在服务器端而不是客户端上工作）但你可以做同样的事情。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-21T17:34:57.507

Google 代码项目托管现在支持[Post-Commit Web Hooks](http://code.google.com/p/support/wiki/PostCommitWebHooks)，它在每次提交后 ping 一个项目所有者指定的 URL。这将消除定期轮询您的 Google 代码存储库的需要。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-28T04:31:13.537

您可能必须在另一台监视 SVN 提交并为您部署新版本的计算机上安装一些胶水。Google Code 尚未开发和发布 API（如果他们认真对待整个开发工作，他们需要尽快完成），但 GAE 可以相对轻松地部署到自动化，所以我不认为它应该是这么难。但是，部署过程会因每个项目而异，因此您需要自己整理一下（您可能想看看[结构](http://www.nongnu.org/fab/)部署系统）。然后，只需设置一个 cron 作业来更新中间机​​器上的本地 SVN 结帐，就完成了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-27T19:26:59.830

非常有趣，但还不可能，AFAIK。我一直在谷歌代码中寻找这个选项，但没有成功。

我能想到的唯一解决方案是在你的机器上安装一些东西来检查你的 SVN 存储库中的更改。

我很高兴听到其他方法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-27T23:02:16.587

对于我们这些使用 Github 的人来说，GAE 团队的这个功能会让我们都认真考虑切换到谷歌代码......

# vb.net - MyProject.MyClass - vb.NET 自定义控件

> ID：241009
> 
> 赞同：1
> 
> 时间：2008-10-27T18:44:06.420
> 
> 标签：vb.net, visual-studio-2005, controls, code-generation

在一个 Visual Basic 项目中，我创建了一个自制的 TabControl 以修复一个视觉错误。该控件正常工作，但是每当我使用选项卡修改表单时，Visual Studio 在其声明中的控件前面添加 MyProject：

```
Me.tabMenu = New MyProject.MyClass 'Gives a BC30002 compile error 
```

如果我删除`MyProject.`，项目编译正确。

MyClass 位于单独的文件 MyClass.vb 中，大致如下所示：

```
Public Class MyClass
Inherits System.Windows.Forms.TabControl

Public Sub New()
    InitializeComponent()
    MyBase.DrawMode = System.Windows.Forms.TabDrawMode.OwnerDrawFixed
End Sub

Protected Overrides Sub OnDrawItem(ByVal e As System.Windows.Forms.DrawItemEventArgs)
    //OnDrawItem code
End Sub

Private Sub My_DrawItem(ByVal sender As Object, ByVal e As System.Windows.Forms.DrawItemEventArgs) Handles Me.DrawItem
    //My_DrawItem code
End Sub
End Class 
```

我尝试删除文件并再次添加，复制并粘贴里面的类`MyForm.designer.vb`，添加`MyProject.`到类名，但没有什么阻止 Visual Studio 添加这个讨厌的`MyProject`.

**关于[这个答案](https://stackoverflow.com/questions/241009/myprojectmyclass-vbnet-custom-controls#241077)的编辑：**

我了解命名空间的事情，但是我的问题主要是编译器无法识别附加了项目名称的类，但仍然每次都添加它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-06T19:59:27.540

您得到的实际编译错误是什么？VB 编译器是否有可能将 MyProject 解释为命名空间标识符以外的东西？您还可以尝试更改项目的默认命名空间，然后查看它的作用，它可能会提示您实际问题是什么。您也可以尝试将违规行更改为

```
Me.tabMenu = New Global.MyProject.MyClass 
```

然后让我们知道结果是什么。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T19:07:24.503

默认情况下，Visual Basic .NET 为您的项目分配了一个默认命名空间。（我相信默认值实际上是`MyProject`.）

这是前面的内容，并且正在执行以在设计器中明确标识您的类。

无论项目的默认命名空间是什么，WinForms 设计器都会将命名空间名称添加到 .designer.vb 文件中。

要更改默认命名空间，请转到您的项目属性；它应该出现在第一个选项卡上。

此外，如果可以避免，一般不要修改 .designer.vb 文件。*这些文件经常*被 Visual Studio 彻底清除和重建，因此您的更改很可能会被消除。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T14:33:58.833

当您有一个与默认命名空间（项目名称）同名的公共模块时，我之前已经看到过这种情况。如果是这种情况，请重命名模块或默认命名空间，问题应该会消失。

# html - 问号字符显示在文本中。为什么是这样？

> ID：241015
> 
> 赞同：27
> 
> 时间：2008-10-27T18:44:57.603
> 
> 标签：html, backup, character-encoding, mirror

我有一个备份服务器，可以自动备份我的实时站点，包括文件和数据库。

在实时站点上，文本看起来不错，但是当您查看它的镜像版本时，它会显示“？” 在一些文本中。此文本存储在新闻数据库表中。

这是它在实时服务器上和镜像服务器上的屏幕截图。

在将其备份到镜像服务器的过程中会发生什么？

![替代文字](https://i.stack.imgur.com/ftKNy.jpg)

实时服务器是[Solaris](https://en.wikipedia.org/wiki/Solaris_%28operating_system%29)，镜像服务器是 Linux [Red Hat Linux](https://en.wikipedia.org/wiki/Red_Hat_Linux) 5。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-27T18:50:58.327

以下文章将很有用：

*[10.3 指定字符集和排序规则](http://dev.mysql.com/doc/refman/5.0/en/charset-syntax.html)*

*[10.4 连接字符集和排序规则](http://dev.mysql.com/doc/refman/5.0/en/charset-connection.html)*

连接到数据库后，发出以下命令：

```
SET NAMES 'utf8'; 
```

确保您的网页也使用 UTF-8 编码：

```
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /> 
```

PHP 还提供了几个对转换有用的函数：

*   *[图标v](http://us3.php.net/manual/en/function.iconv.php)*
*   *[mb_convert_encoding](http://us.php.net/mb_convert_encoding)*

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2012-04-22T07:12:16.337

在“镜像”服务器（有问题的服务器）上编辑 Apache 配置文件，并注释掉以下行：

```
AddDefaultCharset UTF-8 
```

然后重启 Apache：

```
service httpd restart 
```

问题是“AddDefaultCharset UTF-8”行覆盖了*.html*文件中指定的*Content-Type ；*例如：

 *```
<meta http-equiv=Content-Type content="text/html; charset=windows-1252"> 
```

最常见的症状是 127 以上的字符代码显示为带有问号的黑色菱形（在 Chrome、Safari 或 Firefox 中）或小方框（在 Internet Explorer 和[Opera](https://en.wikipedia.org/wiki/Opera_%28web_browser%29)中）。

Microsoft Word 生成的 HTML 文件通常有很多这样的字符，最常见的是字符代码 160 = 0xA0，相当于“ ” 在[Windows-1252](https://en.wikipedia.org/wiki/Windows-1252)编码中，并且经常出现在 span 标签之间，如下所示：

```
<span style="mso-spacerun: yes">ááá </span> 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2013-02-08T16:41:22.487

我来这里是为了寻找在浏览器中显示的 JavaScript 的解决方案，虽然与数据库没有直接关系......

就我而言，我将在 Internet 上找到的一些文本复制并粘贴到 JavaScript 文件中，并使用 Windows [Notepad](https://en.wikipedia.org/wiki/Notepad_%28software%29)保存。

当使用该 JavaScript 文件的页面输出字符串时，会有问号（如问题中显示的那些）而不是特殊字符（如重音字母等）。

[我使用Notepad++](http://notepad-plus-plus.org/)打开了文件。打开文件后，我看到字符编码设置为*ANSI*，如下图所示（鼠标光标在页脚上）：

![在此处输入图像描述](https://i.stack.imgur.com/UxtX7.png)

要解决此问题，请单击Notepad++ 中的*Encoding菜单，然后选择**Encode in UTF-8*。你应该很高兴。:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-27T18:49:13.227

Unicode 或其他字符集字符落空？

当文本从电子邮件或其他文档格式（例如单词）复制到文本编辑器时，我经常在我工作过的网站上看到类似的“奇怪”字符。编辑器可以显示非 ASCII 字符，但浏览器不能。对于该网站，我建议查找该字符的 HTML 实体代码并插入它……或者切换到更标准的代码。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-27T18:49:20.140

您的浏览器没有正确解释页面的编码（可能是因为您已将其强制为特定设置，或者页面设置不正确），因此无法显示某些字符。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-27T18:50:23.727

这将与字符编码有关。

您确定镜像站点在字符编码方面与您的主服务器具有相同的属性吗？

根据您拥有的服务器类型，这可能是服务器进程本身的属性，也可能是环境变量。

例如，如果这是一个 UNIX 环境，也许尝试比较 LANG 或 LC_ALL？

另请参阅[此处](http://www.opengroup.org/onlinepubs/007908799/xbd/envvar.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-27T18:51:45.127

检查镜像服务器发出的字符集。这似乎与主服务器有所不同——实时站点似乎正在输出 Unicode，而镜像则没有。此外，清理传入内容中的 Unicode 字符并将其替换为相应的 HTML 实体通常是个好主意。

您的具体问题与“智能引号”、“短划线”和“短划线”有关。我知道你可以用 em dashes`&mdash;`和 n-dashes 替换`&ndash;`（这应该在你的数据库的输入端完成）；我不知道智能引号的正确替换是什么。（我通常只是用 ' 替换所有大弯单引号，用 " 替换所有大弯双引号......印刷极客可能会在看到我时随意射击。）

我应该注意到，在这个问题上，一些浏览器比其他浏览器更宽容——Windows 上的 Internet Explorer 倾向于自动检测并“修复”这个问题；Firefox 和大多数其他浏览器显示问号。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-27T19:16:19.757

我通常诅咒 MS Word，然后运行以下[Windows Script Host](https://en.wikipedia.org/wiki/Windows_Script_Host)脚本。

```
// Replace with path to a file that needs cleaning
PATH = "test.html"

var go = WScript.CreateObject("Scripting.FileSystemObject");
var content = go.GetFile(PATH).OpenAsTextStream().ReadAll();
var out = go.CreateTextFile("clean-"+PATH, true);

// Symbols
content = content.replace(/“/g, '"');
content = content.replace(/”/g, '"');
content = content.replace(/’/g, "'");
content = content.replace(/–/g, "-");
content = content.replace(/©/g, "&copy;");
content = content.replace(/®/g, "&reg;");
content = content.replace(/°/g, "&deg;");
content = content.replace(/¶/g, "<p>");
content = content.replace(/¿/g, "&iquest;");
content = content.replace(/¡/g, '&iexcl;');
content = content.replace(/¢/g, '&cent;');
content = content.replace(/£/g, '&pound;');
content = content.replace(/¥/g, '&yen;');

out.Write(content); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-05-30T05:14:24.177

我遇到了这个问题，所以我只是把我的所有内容复制/粘贴到[记事本](https://en.wikipedia.org/wiki/Notepad_%28software%29)中，制作了一个新的 PHP 文件，重新粘贴，重新保存并覆盖，然后.. 成功了！

它确实是 Microsoft Word 编辑的一些遗物……

# java - 如何远程关闭 Java RMI 服务器

> ID：241034
> 
> 赞同：8
> 
> 时间：2008-10-27T18:51:28.013
> 
> 标签：java, rmi

我有一个非常简单的 Java RMI 服务器，如下所示：

```
 import java.rmi.*;
    import java.rmi.server.*;

    public class CalculatorImpl extends UnicastRemoteObject implements Calculator {

        private String mServerName;

        public CalculatorImpl(String serverName) throws RemoteException
        {
            super();
            mServerName = serverName;
        }

        public int calculate(int op1, int op2) throws RemoteException
        {
            return op1 + op2;
        }

        public void exit() throws RemoteException
        {
            try{
                Naming.unbind(mServerName);
                System.out.println("CalculatorServer exiting.");
            }
            catch(Exception e){}

            System.exit(1);
        }

        public static void main(String args[]) throws Exception
        {
            System.out.println("Initializing CalculatorServer.");

            String serverObjName = "rmi://localhost/Calculator";

            Calculator calc = new CalculatorImpl(serverObjName);

            Naming.rebind(serverObjName, calc);

            System.out.println("CalculatorServer running.");
        }
} 
```

当我调用 exit 方法时， System.exit(1) 抛出以下异常：

```
CalculatorServer exiting.
java.rmi.UnmarshalException: Error unmarshaling return header; nested exception is:
        java.io.EOFException
        at sun.rmi.transport.StreamRemoteCall.executeCall(StreamRemoteCall.java:203)
        at sun.rmi.server.UnicastRef.invoke(UnicastRef.java:126)
        at CalculatorImpl_Stub.exit(Unknown Source)
        at CalculatorClient.<init>(CalculatorClient.java:17)
        at CalculatorClient.main(CalculatorClient.java:29)
Caused by: java.io.EOFException
        at java.io.DataInputStream.readByte(DataInputStream.java:243)
        at sun.rmi.transport.StreamRemoteCall.executeCall(StreamRemoteCall.java:189)
        ... 4 more
[2]+  Exit 1                  java CalculatorImpl 
```

我在这种方法中做错了什么？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-27T20:02:38.993

如果有人遇到类似的问题，我自己想出了答案。这是我的 exit() 方法：

```
public void exit() throws RemoteException
{
    try{
        // Unregister ourself
        Naming.unbind(mServerName);

        // Unexport; this will also remove us from the RMI runtime
        UnicastRemoteObject.unexportObject(this, true);

        System.out.println("CalculatorServer exiting.");
    }
    catch(Exception e){}
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-08-22T11:50:59.970

实际上只是取消注册并立即调用 System.exit 并不能完全关闭。它基本上在通知客户端消息已完成之前断开连接。有效的是启动一个关闭系统的小线程，例如：

```
public void quit() throws RemoteException {
  System.out.println("quit");
  Registry registry = LocateRegistry.getRegistry();
  try {
    registry.unbind(_SERVICENAME);
    UnicastRemoteObject.unexportObject(this, false);
  } catch (NotBoundException e) {
    throw new RemoteException("Could not unregister service, quiting anyway", e);
  }

  new Thread() {
    @Override
    public void run() {
      System.out.print("Shutting down...");
      try {
        sleep(2000);
      } catch (InterruptedException e) {
        // I don't care
      }
      System.out.println("done");
      System.exit(0);
    }

  }.start();
} 
```

该线程需要能够让将来发生某些事情，同时仍然从退出方法返回。

# security - 来自图像的跨站点脚本

> ID：241040
> 
> 赞同：6
> 
> 时间：2008-10-27T18:52:52.893
> 
> 标签：security, xss

我的网站上有一个富文本编辑器，我试图保护它免受 XSS 攻击。我想我已经处理了几乎所有事情，但我仍然不确定如何处理图像。现在我正在使用以下正则表达式来验证图像 URL，我假设它会阻止内联 javascript XSS 攻击：

```
"https?://[-A-Za-z0-9+&@#/%?=~_|!:,.;]+" 
```

我不确定这对来自远程图像的 XSS 攻击有多开放。链接到外部图像是否构成严重的安全威胁？

我唯一能想到的是，输入的 URL 引用了一个资源，该资源返回“ `text/javascript`”作为其 MIME 类型而不是某种图像，然后执行 javascript。

那可能吗？我还应该考虑其他安全威胁吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-27T19:03:22.980

另一件需要担心的事情是，您可以轻松地将 PHP 代码嵌入到图像中并在大多数情况下上传。攻击唯一需要做的就是找到一种包含图像的方法。（只有 PHP 代码会被执行，其余的只是回显）。检查 MIME 类型对您没有帮助，因为攻击者可以轻松地上传具有正确前几个字节的图像，然后是任意 PHP 代码。（HTML 和 Javascript 代码也是如此）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T05:25:47.297

如果最终查看者位于密码保护区域，并且您的应用包含基于 GET 请求启动操作的 Url，则您可以代表用户发出请求。

例子：

*   src="http://yoursite.com/deleteuser.xxx?userid=1234"
*   src="http://yoursite.com/user/delete/1234"
*   src="http://yoursite.com/dosomethingdangerous"

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-27T19:38:34.690

在这种情况下，看看它周围的上下文：用户是否只提供一个 URL？在这种情况下，只需验证 URL 语义和 MIME 类型就可以了。如果用户还可以输入某种类型的标签，则必须确保它们不可被操纵以执行除显示图像之外的任何操作。

# asp.net-mvc - 为什么 Nant 不与 TeamCity 合作？

> ID：241051
> 
> 赞同：7
> 
> 时间：2008-10-27T18:56:52.840
> 
> 标签：asp.net-mvc, nant, teamcity

我已经 nant 设置来构建我的 ASP.NET MVC 项目，它在本地运行良好。我将 nant 添加到工具文件夹并将其添加到版本控制中。TeamCity 获取我的更改并开始构建，但它失败了。

我相信我使用的是最新版本的 Nant，并且我已将 .net framework 3.5 添加到 nant.exe.config。我在服务器上缺少什么，是的，.net 框架安装在服务器上，因为如果我手动构建和部署，asp.net mvc 应用程序确实可以工作？

构建文件如下：

```
<target name="compile" description="Compiles using the AutomatedDebug Configuration">
    <msbuild project="Tolt.Sims.sln" />
</target> 
```

这是错误：

```
BUILD FAILED 无法初始化“Microsoft .NET Framework 2.0”（net-2.0）目标框架。
属性评估失败。表达式：${path::combine(sdkInstallRoot, 'bin')} ^^^^^^^^^^^^^^ 属性 'sdkInstallRoot' 尚未设置。
有关构建失败原因的更多信息，请在调试模式下再次运行构建。尝试“nant -help”以获取更多信息

```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-27T20:44:25.010

如果您使用的是 NAnt 的 beta 版本（目前这是您获得针对高于 2.0 框架的任何东西的支持的唯一方法），您可能会遇到注册表问题。[Tim Barcz 报告了](http://www.timbarcz.com/blog/NantSetupForVisualStudio2008AndNet35.aspx)一个类似的问题。

事情几乎可以归结为指向 2.0 版本的 msbuild 的 NAntContrib（msbuild 任务的提供者）。查看他的解决方案，看看它是否适用于您的场景。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-11T10:30:12.847

您可能没有安装 .NET Framework 2.0 SDK。

您可以从 [http://www.microsoft.com/downloads/details.aspx?familyid=fe6f2099-b7b4-4f47-a244-c96d69c35dec&displaylang=en安装它](http://www.microsoft.com/downloads/details.aspx?familyid=fe6f2099-b7b4-4f47-a244-c96d69c35dec&displaylang=en)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-16T09:20:14.667

我通过在注册表中添加以下内容来解决此问题：

新字符串值位于：HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft.NETFramework

命名：sdkInstallRootv2.0

使用值：C:\Program Files\Microsoft Visual Studio 8\SDK\v2.0\

仿佛生机勃勃...

w://

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-06-30T21:45:46.260

这在 0.86 beta1 版本之后得到了修复。2010 年 4 月 1 日，发布了 0.90，其中包含修复程序，以防您可以选择升级 nant。为了提供更多详细信息，0.90 中的修复版本似乎是对 nant.exe.config 文件的简单更改。添加了下面的粗体文本，可能无需安装 2.0 SDK 即可解决问题。

> `<directory name="${path::combine(sdkInstallRoot, 'bin')}"` **if="${property::exists('sdkInstallRoot')}"** />

更新 net-2.0 部分以修复它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-08T10:35:17.473

见[http://www.mail-archive.com/nant-developers@lists.sourceforge.net/msg07519.html](http://www.mail-archive.com/nant-developers@lists.sourceforge.net/msg07519.html)；这是 0.86 beta1 中的一个已知错误。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-01-10T17:21:39.063

我遇到了与 NAnt 类似的问题。我知道这不是*最好*的解决方案，但如果您需要让您的项目动起来，它是一种有效的解决方案。

我发现在服务器上安装开发环境（C# Express 对我不起作用，但 VS 2008 对我有用）可以解决这个问题。（是的，我意识到这违背了正常的最佳实践，但它可以工作并让我的脚本运行，这样我就可以重新开始编码。）

只是想我会分享其他人处于类似情况的情况..（这对我来说对 CruiseControl.Net 和 Hudson 都有效）。

# c# - 使用企业库的优缺点

> ID：241054
> 
> 赞同：23
> 
> 时间：2008-10-27T18:58:43.740
> 
> 标签：c#, .net, enterprise-library

我刚刚开始一个项目，由于这个项目是个人的，我想知道使用 Enterprise Library 有什么好处？我们在办公室的几个项目中使用版本 2，但我不太确定（除了良好实践之外）它的优势，尤其是在数据库组件中。有什么建议吗？谢谢

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-27T19:14:57.747

对于数据库应用程序块，主要优点是它可以更轻松地生成与数据库无关的代码。开发人员主要与通用数据库和 DbCommand 对象交互，而不是 SqlConnection、SqlCommand 等。因此，切换到不同的数据库（即 Oracle）变得更加可行。根据您的业务需求，这可能是一个明显的优势。EntLib 还温和地鼓励开发人员使用 DbParameter 查询参数，从而降低 SQL 注入攻击的风险。

正如另一张海报提到的那样，数据应用程序块比直接的 ADO.NET 类更高级别，因此它往往需要更少的代码行来执行相同的操作。

从我的角度来看，数据、异常和日志记录块是最有用的。Exception 和 Logging 一起使得将异常（duh）记录到许多地方和以多种格式变得非常容易。例如，他们可以将整个异常日志条目（包括堆栈跟踪）放在 Windows 事件日志中，从而相对容易诊断问题。

EntLib 的一个缺点是一些应用程序块将相当多的逻辑放入配置文件中。所以你的逻辑更加分散；其中一些在代码中，一些在配置文件中。好处是可以在构建后甚至部署后修改配置。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-27T19:28:27.207

作为我们产品线重新设计的一部分，我的团队在大约 2 年前对[Microsoft 模式和实践企业库进行了评估。](http://msdn.microsoft.com/en-us/library/cc467894.aspx)我们最终使用的唯一部分是数据库块。我们甚至将它封装在一些我们可以实例化的类中，这样我们就可以模拟 DAL 进行单元测试；Microsoft 代码块使用静态调用进行数据库工作。我不确定微软是否已将任何 LINQtoSQL 或实体框架的东西集成到 db 块中。如果它不利用其中之一，我现在会犹豫是否使用 db 块。

就日志记录而言，我们发现[Log4Net](http://logging.apache.org/log4net/index.html)是一个比 Microsoft 日志记录更加强大和灵活的解决方案。为了满足我们的日志记录需求，我们选择了它。

对于异常处理，我们推出了自己的。Microsoft 代码没有处理我们想要处理的远程处理案例，并且由于我们使用的是第 3 方日志记录框架，因此编写我们自己的异常库并与之集成更有意义。我发现将日志框架某种程度的集成到异常框架中是非常有用的。我们围绕 Log4Net 编写了一些轻量级的包装类，并从我们的异常日志中调用它们，因此我们没有引入对 Log4Net 的依赖。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-27T19:29:03.367

除了 Paul 提到的关于数据应用程序块的项目之外，我还想指出，根据我的经验，数据应用程序块也提供了一种更快的方式来编写所需的数据库代码，并使用现有的帮助程序。我使用它是因为它具有一致的外观/感觉和开发速度。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-10-16T08:03:14.583

不能为我使用 EF 的选择受我环境中的约束条件的约束，这些约束要求应用程序每小时处理数百万个事务。这是电信环境中的处理量。

是否使用 EF 完全取决于您的环境和选择（只要您知道所选技术的局限性）。如果您的系统不需要如此高的负载，我预计您在使用 EF 时不会遇到任何问题。

# php - 如何阻止用户规避付款？

> ID：241063
> 
> 赞同：10
> 
> 时间：2008-10-27T19:00:38.137
> 
> 标签：php, cookies, paypal

我有一个使用贝宝为电子显示数据收集付款的网站。变量不能通过贝宝与 URL 一起传递（或者我无法让它们工作），所以我使用 cookie 来传递项目编号。但是，狡猾的用户可以在cookie写入部分之后，直接在地址栏中输入paypal重定向URL并免费获取电子数据。绕过贝宝。我怎样才能解决这个问题？

这是一些代码。你会看到我试图通过直接通过 cookie 写入 (pre_contact.php) 和 paypal 重定向 URL (step.php) 来让用户感到困难。

```
//pre_contact.php
<?PHP
global $id;
setcookie("property", $id, time()+1800);
echo "<META HTTP-EQUIV=Refresh CONTENT=\"0; URL=contact.php\">";
?>

//contact.php - paypal pay button
echo "<form action='https://www.paypal.com/cgi-bin/webscr' method='post'>";
echo "<input type='hidden' name='cmd' value='_s-xclick'>";
echo "<input type='hidden' name='hosted_button_id' value='156320'>";
echo "<input type='image'
src='https://www.paypal.com/en_GB/i/btn/btn_paynowCC_LG.gif' border='0' name='submit' 
alt='Click to pay'>";
echo "<img alt='' border='0' src='https://www.paypal.com/en_GB/i/scr/pixel.gif'  width='1' height='1'>";
echo "</form>";

//step.php - paypal redirect on successful payment
<?PHP
require("generate_url.php");
?>

//generate_url.php - This generates a unique URL so the info can only be accessed once
<?PHP
if (eregi("generate_url.php", $_SERVER['SCRIPT_NAME'])) {
Header("Location: index.php"); die();
}
$token = md5(uniqid(rand(),1));
setcookie("token", $token, time()+4);
$cwd = substr($_SERVER['PHP_SELF'],0,strrpos($_SERVER['PHP_SELF'],"/"));
Header("Location: $cwd/get_file.php?q=$token"); die();
?>

//get_file.php - displays the file after payment
$qtoken = $_GET['q'];
if ($qtoken===$_COOKIE["token"]){
$id=$_COOKIE["property"];
DISPLAY FILE HERE!! 
```

提前致谢

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-27T20:09:15.110

您可能正在寻找的是 Paypal IPN（即时付款通知）.. 基本上有人从您那里购买产品.. Paypal 将数据发布到您指定的脚本/网址（只有您和他们知道）.. 然后您做什么将数据回发到贝宝，以确认他们发送的帖子是真实的，而不是由某人模拟/伪造的。此时您知道交易是有效的。

一旦您收到有效付款的通知，您就可以通过电子邮件发送下载 url，或者使用简单的 HTACCESS auth 将所有这些信息打包到一个小型登录/密码系统中，然后您就可以开始了。

祝你好运。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-27T19:07:04.223

我不认为您将能够通过您所采用的方法一步完成您想做的事情，因为您的代码无法知道事务是否实际成功完成。

我认为上述方法可行的唯一方法是，如果您不自动将它们发送到他们支付的文件中。

相反，他们必须等待您通过 Paypal 验证他们的交易，然后通过电子邮件向他们发送下载链接。

* * *

这可能都可以使用[Paypal API](https://developer.paypal.com/)自动完成。我对 Paypal API 不太熟悉，但它应该像这样工作。

1.  用户决定向你购买东西
2.  您启动一个将用户发送到 Paypal 的交易，并且可能会生成某种交易 ID。
3.  用户支付（或决定取消和/或不支付）
4.  用户回到您的网站
5.  您获取交易ID并验证付款成功
6.  如果支付成功，给用户他们支付的东西。

* * *

## [贝宝 API 参考](https://www.paypal.com/IntegrationCenter/ic_api-reference.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-15T22:58:34.073

在其他问题中有很多关于 PayPal IPN 的信息，从[设置 Paypal 以连接到脚本开始](https://stackoverflow.com/questions/1115822/setting-up-paypal-to-connect-to-script)

# sql-server - 使用 SQL Management Studio 为 SQL Server 生成 sql 脚本

> ID：241064
> 
> 赞同：3
> 
> 时间：2008-10-27T19:01:11.113
> 
> 标签：sql-server, ssms

是否有可能没有：

/****脚本日期：10/27/2008 09:05:41 ******/

在输出中？

我想使用 Diff's，这样我就可以看到发生了什么变化，拥有时间戳会变得很困难！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-27T19:06:11.773

工具|选项|脚本|包括描述性标题-> false

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-27T19:05:02.057

选项“脚本描述性标题” - 将其设置为 false，应该这样做。

# ruby-on-rails - 如何在 Rails 应用程序中使用 SQL_ASCII 编码？

> ID：241080
> 
> 赞同：1
> 
> 时间：2008-10-27T19:08:02.380
> 
> 标签：ruby-on-rails, postgresql, encoding, character-encoding

我必须连接到具有**ENCODING = 'SQL_ASCII';的旧版 postgres 数据库。**.

如何在我的 Rails 应用程序中设置此编码？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-27T19:47:46.293

你可以在你的 database.yml 中设置它：

```
development:
  adapter: postgresql
  encoding: sql_ascii
  database: appname_development
  username: root
  password:
  host: localhost 
```

# .net - GridView 复选框列

> ID：241083
> 
> 赞同：1
> 
> 时间：2008-10-27T19:10:47.163
> 
> 标签：.net, asp.net, gridview, controls, code-reuse

我曾经在 1.1 中有一个从 DataGridColumn 类继承的 Datagrid 类。这使我可以在标题中创建一个带有客户端取消/选中所有框的复选框列。然后当我设计我的网格时，我会添加我的自定义列。

我目前在一个项目中，我需要类似的网格视图功能，但是，似乎没有办法继承或向列添加功能。

所以我的问题是，有没有办法覆盖列？或者此代码是否已经以可重用的方式存在？

需求很简单：我希望它只在页面上注册 JavaScript 并呈现一列复选框。

我已经遇到了 4guys 示例，但他们只是将所有代码放入后面的代码中，我正在寻找一些少一点复制/粘贴的东西。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-27T19:28:12.417

我从 System.Web.UI.WebControls.BoundField 和 .HyperLinkField 派生类您可能有兴趣从 CheckBoxField 类继承[http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.checkboxfield .aspx](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.checkboxfield.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T22:35:49.650

您可以在 DataGrid 列中使用包含 CheckBox 的 TemplateColumn 和 ItemTemplate 吗？

就像是：

```
<asp:DataGrid id="DG1" runat = "server" DataKeyField = "ID">
<Columns>
<asp:TemplateColumn HeaderText="ProductName">
<ItemTemplate>
<asp:CheckBox id="chkBox1" runat="server" 
Text =<%# DataBinder.Eval(Container.DataItem,"yourDataToBind") %>
checked='<%# DataBinder.Eval(Container.DataItem,"yourBoolToBind")  %>'>
</asp:CheckBox>
</ItemTemplate>
</asp:TemplateColumn>
</Columns>
</asp:DataGrid> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T13:52:18.147

我继承了 BoundField 并想出了这个：

页面代码：

```
<%@ register tagprefix="CAC" namespace="UI.Controls" assembly="UI.Controls" %>    
<asp:gridview id="grdPrint" runat="server" autogeneratecolumns="False">
    <columns>
        <cac:checkallcolumn />
        <asp:boundfield datafield="CompanyName" headertext="Company Name" />
    </columns>
</asp:gridview> 
```

这是控制：

```
Imports system.Web.UI
Imports system.Web.UI.WebControls

Public Class CheckAllColumn
    Inherits BoundField

    Public Sub New()
        MyBase.New()
    End Sub

    Public ReadOnly Property SelectedIndexes() As List(Of Int32)
        Get
            Dim selectedIndexList As New List(Of Int32)
            Dim grdParent As GridView = CType(Me.Control, GridView)
            For Each item As GridViewRow In grdParent.Rows
                Dim chkBox As CheckBox = CType(item.FindControl("checkboxCol"), CheckBox)
                If ((Not (chkBox) Is Nothing) _
                            AndAlso chkBox.Checked) Then
                    selectedIndexList.Add(item.DataItemIndex)
                End If
            Next
            Return selectedIndexList
        End Get
    End Property

    Public ReadOnly Property SelectedDataKeys() As Object()
        Get
            Dim dataKeyList As ArrayList = New ArrayList
            Dim grdParent As GridView = CType(Me.Control, GridView)
            If (grdParent.DataKeys.Count > 0) Then
                For Each selectedIndex As Int32 In SelectedIndexes
                    Dim DataKey As Object = grdParent.DataKeys(selectedIndex).ToString
                    dataKeyList.Add(DataKey)
                Next
            End If
            Return CType(dataKeyList.ToArray(GetType(System.Object)), Object())
        End Get
    End Property

    Public Overrides Sub InitializeCell(ByVal cell As DataControlFieldCell, ByVal cellType As DataControlCellType, ByVal rowState As DataControlRowState, ByVal rowIndex As Integer)
        If cell Is Nothing Then
            Throw New ArgumentNullException("cell", "cell is null.")
        End If
        MyBase.InitializeCell(cell, cellType, rowState, rowIndex)
        If (cellType = DataControlCellType.Header) OrElse (cellType = DataControlCellType.DataCell) Then
            Dim checkbox As CheckBox = New CheckBox
            If cellType = DataControlCellType.Header Then
                checkbox.ID = "checkboxHead"
            Else
                checkbox.ID = "checkboxCol"
            End If
            cell.Controls.Add(checkbox)
        End If
    End Sub

    Public Shared Sub RegisterClientCheckEvents(ByVal pg As Page, ByVal formID As String)
        If pg Is Nothing Then
            Throw New ArgumentNullException("pg", "pg is null.")
        End If
        If formID Is Nothing OrElse formID.Length = 0 Then
            Throw New ArgumentException("formID is null or empty.", "formID")
        End If
        Dim strCol As String = GetCheckColScript()
        Dim strHead As String = GetCheckHeadScript()
        If Not pg.ClientScript.IsClientScriptBlockRegistered("clientScriptCheckAll") Then
            pg.ClientScript.RegisterClientScriptBlock(pg.GetType, "clientScriptCheckAll", strHead.Replace("[frmID]", formID))
        End If
        If Not pg.ClientScript.IsClientScriptBlockRegistered("clientScriptCheckChanged") Then
            pg.ClientScript.RegisterClientScriptBlock(pg.GetType, "clientScriptCheckChanged", strCol.Replace("[frmID]", formID))
        End If
        RegisterAttributes(pg)
    End Sub

    Private Shared Sub RegisterAttributes(ByVal ctrl As Control)
        For Each wc As Control In ctrl.Controls
            If wc.HasControls Then
                RegisterAttributes(wc)
            End If
            If TypeOf (wc) Is CheckBox Then
                Dim chk As CheckBox = DirectCast(wc, CheckBox)
                If Not chk Is Nothing AndAlso chk.ID = "checkboxCol" Then
                    chk.Attributes.Add("onclick", "CheckChanged()")
                ElseIf Not chk Is Nothing AndAlso chk.ID = "checkboxHead" Then
                    chk.Attributes.Add("onclick", "CheckAll(this)")
                End If
            End If
        Next
    End Sub

    Private Shared Function GetCheckColScript() As String
        Dim strScript As String
        strScript = " <script language=JavaScript>"
        strScript &= " function CheckAll( checkAllBox )"
        strScript &= " {"
        strScript &= " var frm = document.[frmID];"
        strScript &= "  var ChkState=checkAllBox.checked;"
        strScript &= "  for(i=0;i< frm.length;i++)"
        strScript &= "  {"
        strScript &= "         e=frm.elements[i];"
        strScript &= "        if(e.type=='checkbox' && e.name.indexOf('checkboxCol') != -1)"
        strScript &= "            e.checked= ChkState ;"
        strScript &= "  }"
        strScript &= " }"
        strScript &= "  </script>"
        Return strScript
    End Function

    Private Shared Function GetCheckHeadScript() As String
        Dim strScript As String
        strScript = "<script language=JavaScript>"
        strScript &= "function CheckChanged()"
        strScript &= "{"
        strScript &= "  var frm = document.[frmID];"
        strScript &= "  var boolAllChecked;"
        strScript &= "  boolAllChecked=true;"
        strScript &= "  for(i=0;i< frm.length;i++)"
        strScript &= "  {"
        strScript &= "    e=frm.elements[i];"
        strScript &= "  if ( e.type=='checkbox' && e.name.indexOf('checkboxCol') != -1 )"
        strScript &= "      if(e.checked== false)"
        strScript &= "      {"
        strScript &= "         boolAllChecked=false;"
        strScript &= "         break;"
        strScript &= "      }"
        strScript &= "  }"
        strScript &= "  for(i=0;i< frm.length;i++)"
        strScript &= "  {"
        strScript &= "    e=frm.elements[i];"
        strScript &= "    if ( e.type=='checkbox' && e.name.indexOf('checkboxHead') != -1 )"
        strScript &= "    {"
        strScript &= "      if( boolAllChecked==false)"
        strScript &= "         e.checked= false ;"
        strScript &= "      else"
        strScript &= "         e.checked= true;"
        strScript &= "      break;"
        strScript &= "    }"
        strScript &= "   }"
        strScript &= " }"
        strScript &= " </script>"
        Return strScript
    End Function
End Class 
```

# documentation - 您可以真正参考的规范文档

> ID：241085
> 
> 赞同：2
> 
> 时间：2008-10-27T19:11:51.107
> 
> 标签：documentation, specifications

目前我正在使用 Visual Source Safe（是的，是的！）来存储我的技术规范文档。

实际的文档是用 MS Word 编写的。

如果发现以 word 格式编写规范是一个很大的负担，那么要真正使用规范，就不应该有任何使用障碍，更重要的是**访问**。

如果我不能快速扫描文档、超链接到其他相关文档或部分，那么这一切有什么用？

因此，以此为背景：

**有什么软件可以创建真正可访问的文档？即到其他页面/部分等的超链接？甚至可查询，因此我可以查看依赖于模块 4.5.3 的所有文档**

它基本上只是一个维基吗？还要别的吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-27T19:16:48.867

Wiki 非常适合创建和维护规范。但是，很难生成一个大的纸质文档，当您将它放在人们的办公桌上时会发出令人满意的“砰砰”声。

我已经用 Word 了。只要学会利用它在交叉引用、索引、表格、分页等方面的所有自动化。

我认为规范有两个受众：决策者和开发者。Word 文档是为决策者准备的。开发人员稍后会在实施规范时提出一些有用的东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T20:02:38.243

Java 有由 javadoc 生成的 API 文档，Python 有由 epydoc 等工具生成的 API 文档。

你用什么语言工作？您是否为您的语言寻找过 javadoc 或 epydoc 之类的工具？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T02:18:07.097

我们刚刚开始将 Confluence 用于技术文档和注释： http: [//www.atlassian.com/software/confluence/](http://www.atlassian.com/software/confluence/)

这是一个功能齐全的基于浏览器的 wiki，开箱即用，尽管您可以根据自己的喜好对其进行调整*。*它具有您对专业 wiki 的所有期望，包括安全性、富文本、超链接和附件；它足够直观，即使是我们的非技术人员（以“C”开头的 3 个字母标题）也使用它。

如果您访问 Atlassian 的网站（请参阅上面的链接），您可以玩他们的在线演示......他们吃自己的狗粮来提供社区支持。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-27T19:15:10.913

我相信 Word 支持子文档（指向其他文档的链接）的想法，但是我不确定没有 VSS 的情况如何，更不用说使用 VSS。但这是需要调查的。

然而，wiki 几乎就是您要寻找的东西。

# nhibernate - NHibernate Oracle 连接？

> ID：241086
> 
> 赞同：3
> 
> 时间：2008-10-27T19:12:49.313
> 
> 标签：nhibernate

我是第一次为 NHibernate 设置 Oracle 连接。我已将 Oracle.DataAccess.dll 文件复制到我的 bin 文件夹中。无论我尝试什么，我都会遇到同样的错误：

```
Could not load type >NHibernate.Driver.OracleDataClientDriver. Possible cause: no assembly name specified. 
```

我正在使用以下配置：

```
<?xml version="1.0" encoding="utf-8" ?>
<hibernate-configuration xmlns="urn:nhibernate-configuration-2.2">
    <session-factory name="DefaultSessionFactory">
        <property name="connection.provider">NHibernate.Connection.DriverConnectionProvider</property>
        <property name="dialect">NHibernate.Dialect.Oracle9Dialect</property>
        <property name="connection.driver_class">>NHibernate.Driver.OracleDataClientDriver</property>
        <property name="connection.connection_string">Data Source=DB;User ID=USERPassword=****;</property>       
        <property name="show_sql">true</property>
        <mapping assembly="NHibernateExample.DataAccess"/>
    </session-factory>
</hibernate-configuration> 
```

我以前只为 SQL Server 设置了 NHibernate。我在这里错过了什么吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-27T19:28:41.370

您是否复制并粘贴了代码？因为在 connection.driver_class 行中有一个额外的 >

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-29T02:45:49.007

用户 ID 值和密码之间缺少半冒号分隔符。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-10-12T21:57:16.313

关于将 NHibernate 连接到 Oracle 的优秀分步教程：http: [//nhbwithoracle.blogspot.com/](http://nhbwithoracle.blogspot.com/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-27T19:36:17.940

一旦我遇到类似的问题，我通过添加`hibernate`到属性名称来修复它，在你的情况下：

```
<property name="hibernate.connection.provider">NHibernate.Connection.DriverConnectionProvider</property>
<property name="hibernate.dialect">NHibernate.Dialect.Oracle9Dialect</property>
<property name="hibernate.connection.driver_class">NHibernate.Driver.OracleDataClientDriver</property>
<property name="hibernate.connection.connection_string">Data Source=DB;User ID=USERPassword=****;</property> 
```

希望能帮助到你

# java - Java中的花括号本身是什么意思？

> ID：241088
> 
> 赞同：81
> 
> 时间：2008-10-27T19:13:12.400
> 
> 标签：java, syntax, scope, curly-braces

我有一些 Java 代码以两种方式使用花括号

```
// Curly braces attached to an 'if' statement:
if(node.getId() != null)
{
    node.getId().apply(this);
}

// Curly braces by themselves:
{
    List<PExp> copy = new ArrayList<PExp>(node.getArgs());
    for(PExp e : copy)
    {
        e.apply(this);
    }
}
outAMethodExp(node); 
```

第一个语句之后的那些独立的花括号`if`是什么意思？

* * *

## 回答 #1

> 赞同：122
> 
> 时间：2008-10-27T19:15:40.553

额外大括号的唯一目的是提供范围限制。将`List<PExp> copy`只存在于这些大括号中，并且在它们之外没有范围。

如果这是生成的代码，我假设代码生成器会这样做，因此它可以插入一些代码（例如这个），而不必担心它插入了多少次 a`List<PExp> copy`并且不必担心如果这个片段可能重命名变量多次插入同一个方法。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-10-28T01:17:13.070

我支持 matt b 所写的内容，并且我将补充一点，我看到的匿名大括号的另一个用途是在匿名类中声明一个隐式构造函数。例如：

```
 List<String> names = new ArrayList<String>() {
    // I want to initialize this ArrayList instace in-line,
    // but I can't define a constructor for an anonymous class:
      {
        add("Adam");
        add("Eve");
      }

  }; 
```

一些单元测试框架已经将这种语法提升到了另一个层次，它确实允许一些看起来完全无法编译的巧妙的东西工作。由于它们*看起来*不熟悉，因此我自己并不是那么大的粉丝，但是如果您遇到这种用法，至少要认识到发生了什么是值得的。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-28T01:21:22.937

我同意范围限制的答案，但会添加一件事。

有时你会在喜欢折叠部分代码并拥有可以自动折叠大括号的编辑器的代码中看到类似的结构。他们使用它将代码折叠在不属于通常会折叠的函数、类、循环等的逻辑部分中。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-27T19:18:03.810

我实际上猜想有人忘记了 else 声明。

很少有充分的理由去创建额外的块作用域。在这种情况下，大多数情况下，与他们正在做一些聪明的事情相比，有人可能忘记输入他们的控制语句的可能性要大得多。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-27T19:14:22.897

他们制作了一个内部范围。在这些大括号内声明的变量在它们之外是不可见的。这也适用于 C/C++。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-12-16T22:39:56.973

它也用于[初始化块](http://download.oracle.com/javase/tutorial/java/javaOO/initial.html)。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-03-16T10:23:08.227

大括号对于缩小 switch/case 语句的范围也很有用。

```
switch(foo) {
  case BAR:
     int i = ...
     ...
  case BAZ:
     int i = ... // error, "i" already defined in scope
} 
```

但是你可以写

```
switch(foo) {
  case BAR:{
     int i = ...
     ...
  }
  case BAZ:{
     int i = ... // OK
  }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-27T19:14:51.290

我认为他们只是定义了一个未命名的范围级别。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-27T19:15:15.813

他们定义了一个新的范围，这意味着在这个范围内声明的所有内容在花括号之外都是不可见的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-27T19:18:04.060

带一个作用域，**副本**在它之外将不可见，因此您可以稍后声明另一个具有相同名称的变量。它可以在您退出该范围后立即由垃圾收集器收集。在这种情况下，**副本**用作临时变量，所以它是一个很好的例子。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-27T19:47:27.730

作为一个有趣的说明：大括号实际上启用了一类语句：声明。

这是非法的：`if(a) int f;`

但这是合法的：`if(a) { int f; }`

# eclipse - 我如何知道用户何时最小化/最大化 Eclipse？

> ID：241089
> 
> 赞同：0
> 
> 时间：2008-10-27T19:13:46.703
> 
> 标签：eclipse

我需要响应最小化/最大化 Eclipse 窗口的事件。我怎么做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T22:27:25.953

我可以建议一个方法：你可以为它写一个插件。
例如看这个即兴的“教程”，我做了，尝试了它在 Ganymede 上的工作。最终的 Shell 变量有点难看，但可以工作。如果您知道更好的解决方案，只需拍摄:)（（实际上有一种方法：扩展您自己的 ControlListener 类，但这需要更多编码:)）

1.  创建一个新的插件项目，根据需要命名，从一个名为：Hello World Command 的模板创建它
2.  打开 SampleHandler 类，然后用此代码替换 execute() 函数。

    ```
    public Object execute(ExecutionEvent event) throws ExecutionException {
            IWorkbenchWindow window = HandlerUtil
                    .getActiveWorkbenchWindowChecked(event);
            final Shell s = window.getShell();

    window.getShell().addControlListener(new ControlListener() {

            @Override
            public void controlMoved(ControlEvent e) {
                // TODO Auto-generated method stub

            }

            @Override
            public void controlResized(ControlEvent e) {
                MessageDialog.openInformation(s,
                        "WindowEventHandler Plug-in", "RESIZED: "
                                + e.toString() + "\nHello, Eclipse world");
            }

        });
        MessageDialog.openInformation(window.getShell(),
                "WindowEventHandler Plug-in",
                "Hello, Eclipse world, resize will be taken care of.");

        return null;
    } 
    ```

3.  现在。启动项目（运行方式-> Eclipse 应用程序），您将在工具栏上看到一个 Eclipse 按钮​​。点击它！它触发上述代码的运行，其本质是 window.getShell() 与主窗口组件一起返回，以便您可以向其添加侦听器。

如果你想让它自动运行，而不仅仅是一个按钮，你必须找到一个插件，入口点连接到应用程序的启动。

希望这可以帮助。

b

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-20T20:29:06.473

找到了一种简单的方法：您必须创建一个`ShellListener`or `ShellAdapter`，它具有在外壳图标化、去图标化、激活、停用和关闭时调用的方法。

创建它后，使用以下行将其添加为侦听器：

```
int i;

PlatformUI.getWorkbench().getActiveWorkbenchWindow().getShell().addShellListener( yourListenerHere); 
```

如果您曾经将它从 shell 的侦听器列表中删除，请确保 Workbench、ActiveWorkbnchWindow 和 Shell 不为空。

# .net - 如何手动下拉 DataGridViewComboBoxColumn？

> ID：241100
> 
> 赞同：20
> 
> 时间：2008-10-27T19:16:40.240
> 
> 标签：.net, datagridview

我的 WinForms 应用程序中有一个 DataGridView 和一个 DataGridViewComboBoxColumn。我需要手动下拉（打开）这个 DataGridViewComboBoxColumn，比如说在单击按钮之后。

我需要这个的原因是我已将 SelectionMode 设置为 FullRowSelect 并且我需要单击 2-3 次才能打开组合框。我想单击组合框单元格，它应该立即下拉。我想用 CellClick 事件来做这件事，还是有其他方法？

我正在谷歌和 VS 帮助中搜索，但我还没有找到任何信息。

有人可以帮忙吗？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-27T20:05:37.113

我知道这不是理想的解决方案，但它确实创建了一个在单元格内工作的单击组合框。

```
 Private Sub cell_Click(ByVal sender As System.Object, ByVal e As DataGridViewCellEventArgs) Handles DataGridView1.CellClick
        DataGridView1.BeginEdit(True)
        If DataGridView1.Rows(e.RowIndex).Cells(ddl.Name).Selected = True Then
            DirectCast(DataGridView1.EditingControl, DataGridViewComboBoxEditingControl).DroppedDown = True
        End If
    End Sub 
```

其中“ddl”是我在 gridview 中添加的组合框单元格。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-10-28T10:16:27.787

感谢 ThisMat，您的解决方案完美运行。

我在 C# 中的代码：

```
private void dataGridViewWeighings_CellClick(object sender, DataGridViewCellEventArgs e) {
    if (e.RowIndex < 0) {
        return;     // Header
    }
    if (e.ColumnIndex != 5) {
        return;     // Filter out other columns
    }

    dataGridViewWeighings.BeginEdit(true);
    ComboBox comboBox = (ComboBox)dataGridViewWeighings.EditingControl;
    comboBox.DroppedDown = true;
} 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-10-27T20:28:09.363

我已经能够通过设置接近你正在寻找的东西

```
DataGridView1.EditMode = DataGridViewEditMode.EditOnEnter 
```

只要没有显示其他单元格的下拉列表，它就应该立即显示所选单元格的下拉列表。

如果有任何事情发生，我会继续思考和更新。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-07-19T18:18:00.530

感谢 C# 版本。这是我对按组合列名称进行搜索的贡献：

```
private void dgv_CellClick(object sender, DataGridViewCellEventArgs e)
{
    string Weekdays = @"MondayTuesdayWednesdayThursdayFridaySaturdaySunday";
    if (Weekdays.IndexOf(dgv.Columns[e.ColumnIndex].Name) != -1)
    {
        dgv.BeginEdit(true);
        ComboBox comboBox = (ComboBox)dgv.EditingControl;
        comboBox.DroppedDown = true;
    }
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-01-06T07:25:56.117

我也在寻找这个问题的答案。我最终编写了一个可以从任何 DataGridView 调用的通用子程序，因为我的应用程序中有很多，并且我希望它们都以相同的方式运行。这对我来说效果很好，所以我想与其他偶然发现这篇文章的人分享。

在 DGV 的 MouseClick 事件中，我添加了代码

```
Private Sub SomeGrid_MouseClick(sender As Object, e As MouseEventArgs) Handles SomeGrid.MouseClick
    DGV_MouseClick(sender, e)
End Sub 
```

它调用了我存储在共享模块中的以下子

```
Public Sub DGV_MouseClick(ByVal sender As Object, ByVal e As System.Windows.Forms.MouseEventArgs)
    Try
        Dim dgv As DataGridView = sender
        Dim h As DataGridView.HitTestInfo = dgv.HitTest(e.X, e.Y)
        If h.RowIndex > -1 AndAlso h.ColumnIndex > -1 AndAlso dgv.Columns(h.ColumnIndex).CellType Is GetType(DataGridViewComboBoxCell) Then
            Dim cell As DataGridViewComboBoxCell = dgv.Rows(h.RowIndex).Cells(h.ColumnIndex)
            If Not dgv.CurrentCell Is cell Then dgv.CurrentCell = cell
            If Not dgv.IsCurrentCellInEditMode Then
                dgv.BeginEdit(True)
                CType(dgv.EditingControl, ComboBox).DroppedDown = True
            End If
        End If
    Catch ex As Exception
    End Try
End Sub 
```

我从来没有发现任何错误，我只包含了一些我想不到的罕见实例的 Try..Catch 代码，这可能会引发异常。我不希望用户被这种场景的错误消息所困扰。如果潜艇发生故障，那么 DGV 很可能会像往常一样正常运行。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-08-26T10:26:54.200

**通过将 DataGridView 的EditMode**属性设置为**EditOnEnter** 并创建**EditingControlShowing**事件并添加代码以在此事件中下拉组合框，我能够激活组合框并使用单击鼠标将其下拉。这是示例代码 -

```
//to get the correct cell get value of row and column indexs of the cell
 ColIndex = 1;
 RowIndex = 1;

 DataGridViewComboBoxCell ComboBoxCell = new DataGridViewComboBoxCell();
 ComboBoxCell.Items.AddRange("XYZ", "ABC", "PQR");
 ComboBoxCell.Value = "XYZ";
 datagridview1[ColIndex, RowIndex] = ComboBoxCell; 
```

从上面的代码中，位置 (1,1) 的 DataGirdCell 将转换为“DataGridViewComboBoxCell”，并且组合框将显示在单元格中。

下拉组合框可能需要多次单击鼠标。要在单击时激活组合框，需要执行以下步骤 -

1.  将组合框单元格的 ReadOnly 属性设置为 false
2.  将 DataGridView 的 EditMode 属性设置为 EditOnEnter
3.  创建 EditingControlShowing 事件并添加代码以下拉组合框

这是下拉组合框并单击激活它的示例代码 -

```
private void datagridview1_EditingControlShowing(object sender, DataGridViewEditingControlShowingEventArgs e)
    {
ComboBox ctrl = e.Control as ComboBox;
ctrl.Enter -= new EventHandler(ctrl_Enter);
ctrl.Enter += new EventHandler(ctrl_Enter);        
}
void ctrl_Enter(object sender, EventArgs e)
{
(sender as ComboBox).DroppedDown = true;
} 
```

有关更多详细信息，请查看 - [http://newapputil.blogspot.in/2015/08/add-combo-box-in-cell-of-datagridview.html](http://newapputil.blogspot.in/2015/08/add-combo-box-in-cell-of-datagridview.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-05-10T16:05:02.370

仅供参考：这是[nvivekgoyal](https://stackoverflow.com/users/1005063/nvivekgoyal)在他的[回答](https://stackoverflow.com/a/32224097/3519108)中参考的代码：

```
private void datagridview1_EditingControlShowing(object sender, DataGridViewEditingControlShowingEventArgs e)
{
    ComboBox ctrl = e.Control as ComboBox;
    ctrl.Enter -= new EventHandler(ctrl_Enter);
    ctrl.Enter += new EventHandler(ctrl_Enter);
}

void ctrl_Enter(object sender, EventArgs e)
{
    (sender as ComboBox).DroppedDown = true;
} 
```

# css - 确定 CSS 问题根源的最佳方法是什么

> ID：241102
> 
> 赞同：4
> 
> 时间：2008-10-27T19:17:55.183
> 
> 标签：css, internet-explorer, styling

我一直在做一个网页。这是我第一次尝试使用图像进行设计，然后使用适当的 CSS 布局而不是表格。

[http://www.roccocammisola.com/proj/brunel/bgimage.html](http://www.roccocammisola.com/proj/brunel/bgimage.html)

我一直对主要内容区域两侧的阴影有疑问。当然这些只是IE中的一个问题。如您所见，阴影已被削减到其实际高度的 10% 左右。

由于我相对缺乏经验，我该如何寻找解决这个问题的相关方法。

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-27T19:21:48.543

[FireBug](http://en.wikipedia.org/wiki/Firebug_(Firefox_extension))，除其他外，调试 CSS 的最重要工具。

[在这里得到它](http://getfirebug.com/)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-27T19:24:26.807

[IE Web 开发工具栏](http://www.microsoft.com/downloads/details.aspx?familyid=e59c3964-672d-4511-bb3e-2d5e1db91038&displaylang=en) 它不如一般的 firebug 好，但是当您遇到特定于 IE 的问题时它会有所帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-27T20:27:17.493

除了[Firebug](http://getfirebug.com/)之外，确保您的 HTML 有效是一个非常宝贵的工具，可以最大程度地减少 CSS 问题。有时您的 CSS 可能无法正常工作，因为 HTML 中存在错误。不同的浏览器有不同的方式来处理不正确编写的 HTML，这有时会使它看起来像是存在跨浏览器的 CSS 问题。验证器可以帮助您发现标记中的错误。

[http://validator.w3.org/](http://validator.w3.org/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-27T19:22:32.177

+1 萤火虫

在这种特殊情况下，我只想为您的阴影建议一种新方法。目前，您将它们作为项目。您通常希望将 CSS 背景图像用于此类事情。

```
.mainShadowRight {
*/ your other stuff */
url('images/mainShadowRight.gif');
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-27T19:33:38.927

您的 .mainShadowRight CSS 类指定了最小高度（IE6 无法理解，IE7 并不总是 100% 正确）

正如 Dlarsen 指出的那样，您似乎缺少背景图像： url(); 少量。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-27T21:41:45.860

感谢您的所有回答，似乎已经成功了。

我想我对上传感到震惊，因为我应该定义在那里有 bg-image 的东西。

那个 IE web 开发工具栏看起来也不错，因为我有 FF 的 firebug 和 web 开发工具栏。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-28T15:01:56.337

[另一个用于调试 CSS- CSS Viewer](https://addons.mozilla.org/en-US/firefox/addon/2104)的热门推荐。

这是一个 Firefox 插件，允许您将鼠标悬停在网页中的元素上并查看它们的确切样式。通常你会发现最终的风格不是你的意思，可能是由于一些风格的继承。

# compiler-construction - 添加了代码，swf 大小变小了？

> ID：241111
> 
> 赞同：3
> 
> 时间：2008-10-27T19:19:11.873
> 
> 标签：compiler-construction, flash, filesize

...我正在研究几种理论，但我很想听听其他意见。

这已经在三台不同的机器上得到验证，两个 Windows 另一个 linux。使用的编译器是flexbuild（大概是mxmlc）和ant with mxmlc。

我们*将*代码添加到一个小的独立单个 .as 文件项目中，编译后的 swf 文件大小减少了 20k，在 linux 机器上从 32k 减少到 12k。windows 盒子上略有不同，从 27k 到 8.5k。

通过自定义工具，我们验证了两个版本都使用原生 swf 压缩，没有大量额外的元数据，对 ant 构建脚本的唯一修改是在构建中*添加*一个 swc 文件。

没有删除代码（没有删除导入，没有删除变量，nada），只有添加并且非常简单，几个组件添加到阶段，启用，几个小功能等，没有修改循环，没有什么明显的将导致更少的代码。

使用源代码控制来构建旧版本仍然会导致文件更大，因此它似乎不是库或编译器中的更改。

没有代码使用 Flex 组件，只是直接“flash.etc...”类型导入。

有没有人见过这样的行为？您认为这可能是什么原因造成的？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-27T19:30:54.720

以前在 .NET 程序集中看到过这种行为。

我对这种行为（无论它发生在哪里）的猜测是，无论添加什么，编译器都可以进行比以前更多的优化。

为什么这可能需要比我更详细地了解编译器的内部工作原理（以及为什么会发生这种情况——如果这实际上是这里的原因——在你的情况下，Adobe 可能只能充分解释工程师）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T19:34:18.457

我只是在猜测，但是当涉及到这么小的文件时，也许您会看到硬盘驱动器扇区的松弛？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-27T20:20:27.740

我的第一个预感是第一个 swf 是在调试模式下编译的，它添加了一堆信息。如果不是这种情况，那么我猜第二个是用 -optimize=true 编译的。

但是，如果两者都不是，那确实**很**有趣！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-27T20:58:45.027

我以前也看到过同样的行为。我认为这是两个因素的组合：优化和压缩。您的新代码可能允许优化器以不同的方式做事（或者，不直观地，阻止了它之前所做的某种内联或循环展开）。我会说存在的附加数据更有可能使其成为更好的压缩候选者，因为所有闪存文件都被压缩，因此压缩它的效率更高。这两种理论都只是半知半解的猜测。

# php - 哪个更适合为 RSS 编码 HTML？

> ID：241112
> 
> 赞同：4
> 
> 时间：2008-10-27T19:19:13.013
> 
> 标签：php, rss, cdata

我最近在我发布的一些 RSS 提要中引入了 HTML（到目前为止只有纯文本，没有标记），我想知道哪种方法更好：使用字符编码（例如 htmlspecialchars）还是将所有内容封装在 CDATA 中？

在我看来，CDATA 可能更容易，但我不清楚是否有任何理由（微妙或其他）选择一种方法而不是另一种方法。（对于初学者来说，CDATA 方法在查看源代码时会更容易阅读......）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T11:44:59.887

CDATA 用于不应由 XML 解析器解析的任何数据。任何不在 CDATA 块中的标记**都将由**XML 解析器解析，并且可能具有不同的含义。

如果不需要，CDATA 也会导致解析器的开销。只要您知道不会使用 HTML（或其他方式），请尽量避免使用 CDATA 块，否则请使用它。

也就是说，我确实同意 jamesh，因为您应该始终更喜欢 Atom 而不是 RSS。我制作了一个提要阅读器，在抓取提要时，总是更喜欢 Atom 而不是 RSS。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-27T19:24:25.200

就个人而言，CDATA 更​​容易，因为它允许订阅者显示实际的 HTML，而不需要他们的读者做任何有趣的事情。

如果您使用 HTML 编码，订阅者阅读器或网站本身必须解码源以显示 HTML

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-27T19:23:34.267

冒着给出您可能不想听到的答案的风险：使用[Atom](http://www.atomenabled.org/) *而不是*RSS。

Atom 是很好的命名空间 XML，因此您可以直接混合和匹配 XHTML，而不必担心您询问的编码问题。

RSS 几乎在任何地方都支持它，而且因为它只是普通的 Atom，如果你真的不想使用库来操作它，那么你自己的会更容易。

Atom 也是 IETF 标准，而 RSS 不是。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-02-25T22:05:34.763

htmlentities() 就像一个魅力。无需使用 CDATA。 [http://php.net/manual/en/function.htmlentities.php](http://php.net/manual/en/function.htmlentities.php)

# eclipse - 如何将源代码位置附加到 Eclipse RCP 目标平台中的插件？

> ID：241131
> 
> 赞同：10
> 
> 时间：2008-10-27T19:29:28.653
> 
> 标签：eclipse, eclipse-pde, eclipse-3.4

我有一个包含多个 RCP 插件项目的工作区。

我们已经设置了目标平台，因此我们可以针对一组标准插件进行构建，但无法查看所有平台插件的源代码和 Javadoc。

Windows -> Preferences -> Plug-in Development -> Target Platform -> Source Code Locations 页面在我添加eclipse目录时似乎没有任何效果（它只允许您添加目录）。

将源 jar 从 eclipse 目录复制到目标平台具有类似的效果。

我究竟做错了什么？如何将一组源 jar 附加到我的目标平台？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2011-01-09T14:01:10.020

我今天遇到了同样的问题。在我的例子中，我想调试插件嵌入式码头（org.mortbay.jetty_5.1.14.v200806031611.jar）的源代码，它是Eclipse Equinox（OSGI）的一部分，它是我的Eclipse目标平台的一部分。

当调试并想要进入码头包内的任何类时，我总是收到消息，它是插件依赖项中的一个类，并且源附件无法修改。

**我是这样解决的：**

1.  切换到 Eclipse 中的插件视图（*窗口/显示视图/插件*）
2.  找到捆绑包 org.mortbay.jetty
3.  右键单击该捆绑包并选择“导入为”->“带有链接内容的二进制项目”

现在 Bundle 在您的 Package Explorer 中显示为一个新的 Eclipse 项目，在我的例子中是*org.mortbay.jetty*。

现在在包资源管理器中右键单击该新项目并转到“属性/Java 构建路径/库”。您会在那里看到码头 jar 文件，如果您展开此条目，您可以像往常一样编辑“源附件”。我将其指向下载的 Jetty 源代码，该代码位于与我用于项目的目标平台完全不同的文件夹中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-19T21:17:32.303

如果您在构建目标平台时使用 Eclipse **SDK**包，则应立即为每个 Eclipse 插件提供“Java 源附件”和“Javadoc 位置”。例如，我使用“Eclipse Platform SDK”（eclipse-platform-SDK-3.4.2-win32）作为目标空间，当我显示您提到的“源代码位置页面”时，它填充了“声明的源位置”目标平台”。在 Eclise IDE 中，我可以看到 Eclipse 核心插件源代码和 javadoc（例如在 JFace 包中）。

否则，添加插件源代码位置并不容易，但您可以通过两种方式成功：

*   将“源插件”（如果插件提供者也提供源插件，则最简单的方法）作为普通插件提供到目标平台（PDE 会识别它）
*   提供额外的源位置（不是简单的方法......）

您可以在 Eclipse 帮助中找到有关目标源代码位置的更多信息，主题如下： *插件开发环境指南 > 工具 > 首选项 > 目标平台首选项 > 源代码位置*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-09-21T17:13:12.823

如果您从主下载页面下载“Eclipse for RCP and RAP Developers”构建，则所有资源都可用。至少，这就是 Juno 版本的名称，它曾经被称为`Eclipse for RCP/Plug-in Developers`.

看起来插件源代码不再可通过标准 Java/J2ee Eclipse 构建获得。我假设源可以通过更新机制获得，但无法找到正确的更新站点/功能。如果有人知道，请发表评论。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-27T19:55:16.263

我可以使用`-install`运行时选项在运行时修改目标平台。将 targetPlatform 保留为 Eclipse 平台。

然而，这首先失去了使用目标平台的许多好处——即编译时安全。

# c# - C# 或 .NET 中最糟糕的问题是什么？

> ID：241134
> 
> 赞同：380
> 
> 时间：2008-10-27T19:30:08.857
> 
> 标签：c#, .net

我最近在处理一个`DateTime`对象，并写了这样的东西：

```
DateTime dt = DateTime.Now;
dt.AddDays(1);
return dt; // still today's date! WTF? 
```

intellisense 文档`AddDays()`说它在日期上添加了一天，但它没有 - 它实际上*返回*一个添加了一天的日期，所以你必须这样写：

```
DateTime dt = DateTime.Now;
dt = dt.AddDays(1);
return dt; // tomorrow's date 
```

这个之前已经咬过我很多次了，所以我认为对最糟糕的 C# 陷阱进行分类会很有用。

* * *

## 回答 #1

> 赞同：307
> 
> 时间：2008-10-27T19:52:18.670

```
private int myVar;
public int MyVar
{
    get { return MyVar; }
} 
```

布拉莫。您的应用程序在没有堆栈跟踪的情况下崩溃。无时无刻不在发生。

（注意 getter 中的大写`MyVar`而不是小写`myVar`。）

* * *

## 回答 #2

> 赞同：256
> 
> 时间：2008-10-27T19:47:12.143

**类型.GetType**

我见过咬很多人的是[`Type.GetType(string)`](http://msdn.microsoft.com/en-us/library/w3f99sx1.aspx)。他们想知道为什么它适用于他们自己程序集中的类型，以及某些类型，例如`System.String`，但不是`System.Windows.Forms.Form`。答案是它只在当前程序集和`mscorlib`.

* * *

**匿名方法**

C# 2.0 引入了匿名方法，导致了这样的恶劣情况：

```
using System;
using System.Threading;

class Test
{
    static void Main()
    {
        for (int i=0; i < 10; i++)
        {
            ThreadStart ts = delegate { Console.WriteLine(i); };
            new Thread(ts).Start();
        }
    }
} 
```

那会打印什么？好吧，这完全取决于调度。它将打印 10 个数字，但它可能不会打印 0、1、2、3、4、5、6、7、8、9，这正是您所期望的。问题是它是`i`被捕获的变量，而不是它在创建委托时的值。这可以通过适当范围的额外局部变量轻松解决：

```
using System;
using System.Threading;

class Test
{
    static void Main()
    {
        for (int i=0; i < 10; i++)
        {
            int copy = i;
            ThreadStart ts = delegate { Console.WriteLine(copy); };
            new Thread(ts).Start();
        }
    }
} 
```

* * *

**迭代器块的延迟执行**

这个“穷人的单元测试”没有通过——为什么不呢？

```
using System;
using System.Collections.Generic;
using System.Diagnostics;

class Test
{
    static IEnumerable<char> CapitalLetters(string input)
    {
        if (input == null)
        {
            throw new ArgumentNullException(input);
        }
        foreach (char c in input)
        {
            yield return char.ToUpper(c);
        }
    }

    static void Main()
    {
        // Test that null input is handled correctly
        try
        {
            CapitalLetters(null);
            Console.WriteLine("An exception should have been thrown!");
        }
        catch (ArgumentNullException)
        {
            // Expected
        }
    }
} 
```

答案是在第一次调用迭代器的方法`CapitalLetters`之前，代码源中的代码不会被执行。`MoveNext()`

我的[脑筋急转弯页面](https://jonskeet.uk/csharp/teasers.html)上还有其他一些奇怪的东西。

* * *

## 回答 #3

> 赞同：200
> 
> 时间：2010-02-11T15:14:38.963

**海森堡观察窗**

如果您正在做按需加载的事情，这可能会严重影响您，如下所示：

```
private MyClass _myObj;
public MyClass MyObj {
  get {
    if (_myObj == null)
      _myObj = CreateMyObj(); // some other code to create my object
    return _myObj;
  }
} 
```

现在假设您在其他地方有一些使用此代码的代码：

```
// blah
// blah
MyObj.DoStuff(); // Line 3
// blah 
```

现在你想调试你的`CreateMyObj()`方法。所以你在上面的第 3 行设置了一个断点，打算单步执行代码。只是为了更好地衡量，您还在上面写着的行上放置了一个断点`_myObj = CreateMyObj();`，甚至在其内部也放置了一个断点`CreateMyObj()`。

代码在第 3 行遇到断点。您进入代码。你期望输入条件码，因为`_myObj`显然是空的，对吧？呃……所以……为什么会跳过条件直接进入`return _myObj`？！您将鼠标悬停在 _myObj 上...确实，它确实有价值！那是怎么发生的？！

答案是您的 IDE 导致它获取一个值，因为您打开了一个“监视”窗口 - 尤其是“自动”监视窗口，它显示与当前或上一个执行行相关的所有变量/属性的值。`MyObj`当您在第 3 行遇到**断点**时，监视窗口决定您`MyObj`有**兴趣`CreateMyObj()`知道设置 _myObj 的值！**

这就是为什么我称之为海森堡观察窗口——你不能在不影响它的情况下观察这个值...... :)

**明白了！**

* * *

**编辑**- 我觉得@ChristianHayter 的评论应该包含在主要答案中，因为它看起来是解决这个问题的有效方法。所以任何时候你有一个延迟加载的属性......

> 使用 [DebuggerBrowsable(DebuggerBrowsableState.Never)] 或 [DebuggerDisplay("<loaded on demand>")] 装饰您的财产。——克里斯蒂安·海特

* * *

## 回答 #4

> 赞同：194
> 
> 时间：2008-10-28T00:34:34.000

# 重新抛出异常

吸引许多新开发人员的一个问题是重新抛出异常语义。

很多时候我看到如下代码

```
catch(Exception e) 
{
   // Do stuff 
   throw e; 
} 
```

问题是它会擦除堆栈跟踪并使诊断问题变得更加困难，因为您无法跟踪异常的来源。

正确的代码是不带参数的 throw 语句：

```
catch(Exception)
{
    throw;
} 
```

或者将异常包装在另一个中，并使用内部异常来获取原始堆栈跟踪：

```
catch(Exception e) 
{
   // Do stuff 
   throw new MySpecialException(e); 
} 
```

* * *

## 回答 #5

> 赞同：145
> 
> 时间：2008-10-27T19:49:34.650

这是另一个让我感动的时间：

```
static void PrintHowLong(DateTime a, DateTime b)
{
    TimeSpan span = a - b;
    Console.WriteLine(span.Seconds);        // WRONG!
    Console.WriteLine(span.TotalSeconds);   // RIGHT!
} 
```

* * *

[TimeSpan.Seconds](http://msdn.microsoft.com/en-us/library/system.timespan.seconds.aspx)是时间跨度的秒部分（2 分 0 秒的秒值为 0）。

[TimeSpan.TotalSeconds](http://msdn.microsoft.com/en-us/library/system.timespan.totalseconds.aspx)是以秒为单位测量的整个时间跨度（2 分钟的总秒值为 120）。

* * *

## 回答 #6

> 赞同：80
> 
> 时间：2009-09-10T12:27:47.953

由于您没有取消挂钩事件而导致内存泄漏。

这甚至引起了我认识的一些高级开发人员的注意。

想象一个 WPF 表单，里面有很多东西，你订阅了一个事件。如果您不取消订阅，那么整个表单在关闭和取消引用后都会保留在内存中。

我相信我看到的问题是在 WPF 表单中创建 DispatchTimer 并订阅 Tick 事件，如果您不在计时器上执行 -= 您的表单会泄漏内存！

在这个例子中，你的拆解代码应该有

```
timer.Tick -= TimerTickEventHandler; 
```

这个特别棘手，因为您在 WPF 表单中创建了 DispatchTimer 的实例，因此您会认为它是垃圾收集过程处理的内部引用......不幸的是，DispatchTimer 使用订阅和服务的静态内部列表UI 线程上的请求，因此引用由静态类“拥有”。

* * *

## 回答 #7

> 赞同：63
> 
> 时间：2009-10-15T11:53:15.423

也许不是一个真正的陷阱，因为该行为在 MSDN 中清楚地写了，但是我发现它很违反直觉，所以有一次摔断了我的脖子：

```
Image image = System.Drawing.Image.FromFile("nice.pic"); 
```

这个人将`"nice.pic"`文件锁定，直到图像被处理。在我面对它的时候，我认为动态加载图标会很好，但没有意识到（起初）我最终得到了几十个打开和锁定的文件！图像跟踪它从哪里加载文件...

如何解决这个问题？我认为一个班轮就可以完成这项工作。我期待一个额外的参数`FromFile()`，但没有，所以我写了这个......

```
using (Stream fs = new FileStream("nice.pic", FileMode.Open, FileAccess.Read))
{
    image = System.Drawing.Image.FromStream(fs);
} 
```

* * *

## 回答 #8

> 赞同：51
> 
> 时间：2008-10-27T19:47:23.173

重载 == 运算符和无类型容器（数组列表、数据集等）：

```
string my = "my ";
Debug.Assert(my+"string" == "my string"); //true

var a = new ArrayList();
a.Add(my+"string");
a.Add("my string");

// uses ==(object) instead of ==(string)
Debug.Assert(a[1] == "my string"); // true, due to interning magic
Debug.Assert(a[0] == "my string"); // false 
```

解决方案？

*   `string.Equals(a, b)`比较字符串类型时总是使用

*   使用泛型`List<string>`来确保两个操作数都是字符串。

* * *

## 回答 #9

> 赞同：51
> 
> 时间：2008-10-27T22:35:16.657

如果算上 ASP.NET，我会说 webforms 生命周期对我来说是一个很大的问题。我已经花费了无数个小时来调试编写不佳的 webforms 代码，只是因为很多开发人员并不真正了解何时使用哪个事件处理程序（遗憾的是，我也包括在内）。

* * *

## 回答 #10

> 赞同：50
> 
> 时间：2009-09-08T15:47:03.340

```
[Serializable]
class Hello
{
    readonly object accountsLock = new object();
}

//Do stuff to deserialize Hello with BinaryFormatter
//and now... accountsLock == null ;) 
```

故事的寓意：反序列化对象时不运行字段初始化程序

* * *

## 回答 #11

> 赞同：46
> 
> 时间：2009-06-26T08:46:21.960

**DateTime.ToString("dd/MM/yyyy")** ; 这实际上**并不**总是为您提供 dd/MM/yyyy，而是会考虑区域设置并根据您所在的位置替换您的日期分隔符。所以你可能会得到 dd-MM-yyyy 或类似的东西。

正确的方法是使用**DateTime.ToString("dd'/'MM'/'yyyy");**

* * *

**DateTime.ToString("r")**应该转换为使用 GMT 的 RFC1123。GMT 与 UTC 相差不到几分之一秒，但“r”格式说明符[不会转换为 UTC](http://msdn.microsoft.com/en-us/library/az4se3k1.aspx#RFC1123)，即使相关的 DateTime 被指定为 Local。

这将导致以下问题（取决于您的本地时间与 UTC 的距离）：

```
DateTime.Parse("Tue, 06 Sep 2011 16:35:12 GMT").ToString("r")
>              "Tue, 06 Sep 2011 17:35:12 GMT" 
```

哎呀！

* * *

## 回答 #12

> 赞同：45
> 
> 时间：2008-10-27T19:32:04.483

前几天看到这个贴的，我觉得挺晦涩难懂的，不知道的人很痛苦

```
int x = 0;
x = x++;
return x; 
```

因为这将返回 0 而不是大多数人期望的 1

* * *

## 回答 #13

> 赞同：40
> 
> 时间：2009-07-17T01:43:29.060

我参加这个聚会有点晚了，但我有两个最近都咬我的陷阱：

# 日期时间分辨率

Ticks 属性以百万分之一秒（100 纳秒块）为单位测量时间，但分辨率不是 100 纳秒，大约是 15 毫秒。

这段代码：

```
long now = DateTime.Now.Ticks;
for (int i = 0; i < 10; i++)
{
    System.Threading.Thread.Sleep(1);
    Console.WriteLine(DateTime.Now.Ticks - now);
} 
```

会给你一个输出（例如）：

```
0
0
0
0
0
0
0
156254
156254
156254 
```

同样，如果您查看 DateTime.Now.Millisecond，您将获得 15.625 毫秒的舍入块中的值：15、31、46 等。

此特定行为[因系统而异](https://stackoverflow.com/questions/307582/how-frequent-is-datetime-now-updated-or-is-there-a-more-precise-api-to-get-the/4962857#4962857)，但此日期/时间 API 中[还有其他与分辨率相关的问题。](https://stackoverflow.com/questions/4672359/why-does-timespan-fromsecondsdouble-round-to-milliseconds)

* * *

# 路径组合

组合文件路径的好方法，但它并不总是按照您期望的方式运行。

如果第二个参数以`\`字符开头，它不会给你一个完整的路径：

这段代码：

```
string prefix1 = "C:\\MyFolder\\MySubFolder";
string prefix2 = "C:\\MyFolder\\MySubFolder\\";
string suffix1 = "log\\";
string suffix2 = "\\log\\";

Console.WriteLine(Path.Combine(prefix1, suffix1));
Console.WriteLine(Path.Combine(prefix1, suffix2));
Console.WriteLine(Path.Combine(prefix2, suffix1));
Console.WriteLine(Path.Combine(prefix2, suffix2)); 
```

给你这个输出：

```
C:\MyFolder\MySubFolder\log\
\log\
C:\MyFolder\MySubFolder\log\
\log\ 
```

* * *

## 回答 #14

> 赞同：39
> 
> 时间：2008-10-27T20:58:07.803

当您启动写入控制台的进程（使用 System.Diagnostics），但您从未读取 Console.Out 流时，在一定数量的输出后，您的应用程序将出现挂起。

* * *

## 回答 #15

> 赞同：36
> 
> 时间：2009-12-06T11:11:01.100

**Linq-To-Sql 中没有运算符快捷方式**

见[这里](https://stackoverflow.com/questions/1855056/conditional-shortcuts-in-linq-query)。

简而言之，在 Linq-To-Sql 查询的条件子句中，不能使用 和 之类的条件快捷方式`||`来`&&`避免空引用异常；即使第一个条件不需要评估第二个条件，Linq-To-Sql 也会评估 OR 或 AND 运算符的两边！

* * *

## 回答 #16

> 赞同：31
> 
> 时间：2010-05-14T20:21:17.353

**将默认参数与虚拟方法一起使用**

```
abstract class Base
{
    public virtual void foo(string s = "base") { Console.WriteLine("base " + s); }
}

class Derived : Base
{
    public override void foo(string s = "derived") { Console.WriteLine("derived " + s); }
}

...

Base b = new Derived();
b.foo(); 
```

> 输出：
> 派生基地

* * *

## 回答 #17

> 赞同：28
> 
> 时间：2008-10-27T21:47:18.157

## 可变集合中的值对象

```
struct Point { ... }
List<Point> mypoints = ...;

mypoints[i].x = 10; 
```

没有效果。

`mypoints[i]``Point`返回值对象的副本。C# 很高兴让您修改副本的字段。默默无事。

* * *

**更新：** 这似乎已在 C# 3.0 中修复：

```
Cannot modify the return value of 'System.Collections.Generic.List<Foo>.this[int]' because it is not a variable 
```

* * *

## 回答 #18

> 赞同：26
> 
> 时间：2010-03-31T20:46:14.407

也许不是最糟糕的，但是 .net 框架的某些部分[使用度数](http://msdn.microsoft.com/en-us/library/a0z3f662.aspx)，而其他部分使用[弧度](http://msdn.microsoft.com/en-us/library/system.math.tan.aspx) *（并且 Intellisense 出现的文档从不告诉您哪个，您必须访问 MSDN 才能找到）*

所有这一切都可以通过`Angle`上课来避免......

* * *

## 回答 #19

> 赞同：22
> 
> 时间：2009-03-12T21:36:56.610

对于 C/C++ 程序员来说，过渡到 C# 是很自然的。但是，我个人遇到的最大问题（并且已经看到其他人进行相同的转换）没有完全理解 C# 中类和结构之间的区别。

在 C++ 中，类和结构是相同的；它们仅在默认可见性上有所不同，其中类默认为私有可见性，结构默认为公共可见性。在 C++ 中，此类定义

```
 class A
    {
    public:
        int i;
    }; 
```

在功能上等同于这个结构定义。

```
 struct A
    {
        int i;
    }; 
```

然而，在 C# 中，类是引用类型，而结构是值类型。这在 (1) 决定**何时**使用其中一个，(2) 测试对象相等性，(3) 性能（例如，装箱/拆箱）等方面产生了很大的不同。

网上有各种关于两者之间差异的信息（例如，[这里](http://msdn.microsoft.com/en-us/library/ms173109.aspx)）。我强烈鼓励任何过渡到 C# 的人至少对差异及其影响有一个实际的了解。

* * *

## 回答 #20

> 赞同：19
> 
> 时间：2008-10-27T20:07:11.307

垃圾收集和 Dispose()。虽然你不需要做任何事情来释放*内存*，你仍然需要通过 Dispose()来释放*资源。*当您使用 WinForms 或以任何方式跟踪对象时，这是一件非常容易忘记的事情。

* * *

## 回答 #21

> 赞同：19
> 
> 时间：2010-06-15T12:42:21.253

**数组实现`IList`**

但不要实施。当您调用 Add 时，它会告诉您它不起作用。那么为什么一个类在它不能支持的时候实现一个接口呢？

编译，但不起作用：

```
IList<int> myList = new int[] { 1, 2, 4 };
myList.Add(5); 
```

我们经常遇到这个问题，因为序列化程序 (WCF) 将所有 IList 转换为数组，并且我们会遇到运行时错误。

* * *

## 回答 #22

> 赞同：18
> 
> 时间：2008-10-27T21:11:24.953

foreach 循环变量范围！

```
var l = new List<Func<string>>();
var strings = new[] { "Lorem" , "ipsum", "dolor", "sit", "amet" };
foreach (var s in strings)
{
    l.Add(() => s);
}

foreach (var a in l)
    Console.WriteLine(a()); 
```

打印五个“amet”，而以下示例工作正常

```
var l = new List<Func<string>>();
var strings = new[] { "Lorem" , "ipsum", "dolor", "sit", "amet" };
foreach (var s in strings)
{
    var t = s;
    l.Add(() => t);
}

foreach (var a in l)
    Console.WriteLine(a()); 
```

* * *

## 回答 #23

> 赞同：18
> 
> 时间：2009-09-10T09:42:50.183

MS SQL Server 无法处理 1753 年之前的日期。值得注意的是，这与 .NET`DateTime.MinDate`常量（即 1/1/1）不同步。因此，如果你试图保存一个记忆、一个格式错误的日期（就像我最近在数据导入中发生的那样）或者只是征服者威廉的出生日期，你就会遇到麻烦。对此没有内置的解决方法；如果您可能需要使用 1753 之前的日期，则需要编写自己的解决方法。

* * *

## 回答 #24

> 赞同：18
> 
> 时间：2009-09-30T16:40:06.807

**讨厌的 Linq 缓存问题**

请参阅导致此发现的[我的问题，以及发现问题](https://stackoverflow.com/questions/1499015/linq-caching-data-values-major-concurrency-problem)[的博主](http://www.rocksthoughts.com/blog/archive/2008/01/14/linq-to-sql-caching-gotcha.aspx)。

简而言之，DataContext 保留了您曾经加载的所有 Linq-to-Sql 对象的缓存。如果其他人对您之前加载的记录进行任何更改，您将无法获得最新数据，**即使您明确重新加载记录！**

这是因为`ObjectTrackingEnabled`DataContext 上调用了一个属性，默认情况下该属性为 true。如果将该属性设置为 false，则每次都会重新加载记录……**但是**……您不能使用 SubmitChanges() 对该记录进行任何更改。

**明白了！**

* * *

## 回答 #25

> 赞同：18
> 
> 时间：2011-01-28T22:45:49.900

**Stream.Read 上的合同**是我见过很多人绊倒的东西：

```
// Read 8 bytes and turn them into a ulong
byte[] data = new byte[8];
stream.Read(data, 0, 8); // <-- WRONG!
ulong data = BitConverter.ToUInt64(data); 
```

这是错误的原因是它**最多**`Stream.Read`会读取指定数量的字节，但**完全可以**只读取 1 个字节，即使在流结束之前还有另外 7 个字节可用。

 ****这与 看起来如此相似并没有帮助，如果它毫无例外地返回`Stream.Write`，*则*保证已写入所有字节。*上面的代码几乎一直有效*也无济于事。当然，没有现成的、方便的方法可以正确读取 N 个字节，这也无济于事。

因此，为了堵住漏洞并提高对此的认识，这里有一个正确方法的示例：

```
 /// <summary>
    /// Attempts to fill the buffer with the specified number of bytes from the
    /// stream. If there are fewer bytes left in the stream than requested then
    /// all available bytes will be read into the buffer.
    /// </summary>
    /// <param name="stream">Stream to read from.</param>
    /// <param name="buffer">Buffer to write the bytes to.</param>
    /// <param name="offset">Offset at which to write the first byte read from
    ///                      the stream.</param>
    /// <param name="length">Number of bytes to read from the stream.</param>
    /// <returns>Number of bytes read from the stream into buffer. This may be
    ///          less than requested, but only if the stream ended before the
    ///          required number of bytes were read.</returns>
    public static int FillBuffer(this Stream stream,
                                 byte[] buffer, int offset, int length)
    {
        int totalRead = 0;
        while (length > 0)
        {
            var read = stream.Read(buffer, offset, length);
            if (read == 0)
                return totalRead;
            offset += read;
            length -= read;
            totalRead += read;
        }
        return totalRead;
    }

    /// <summary>
    /// Attempts to read the specified number of bytes from the stream. If
    /// there are fewer bytes left before the end of the stream, a shorter
    /// (possibly empty) array is returned.
    /// </summary>
    /// <param name="stream">Stream to read from.</param>
    /// <param name="length">Number of bytes to read from the stream.</param>
    public static byte[] Read(this Stream stream, int length)
    {
        byte[] buf = new byte[length];
        int read = stream.FillBuffer(buf, 0, length);
        if (read < length)
            Array.Resize(ref buf, read);
        return buf;
    } 
```

* * *

## 回答 #26

> 赞同：16
> 
> 时间：2009-07-08T10:55:08.380

今天我修复了一个很久没有解决的错误。该错误位于多线程场景中使用的通用类中，并且静态 int 字段用于使用 Interlocked 提供无锁同步。该错误是由于类型的泛型类的每个实例化都有其自己的静态而引起的。所以每个线程都有自己的静态字段，并且没有按预期使用锁。

```
class SomeGeneric<T>
{
    public static int i = 0;
}

class Test
{
    public static void main(string[] args)
    {
        SomeGeneric<int>.i = 5;
        SomeGeneric<string>.i = 10;
        Console.WriteLine(SomeGeneric<int>.i);
        Console.WriteLine(SomeGeneric<string>.i);
        Console.WriteLine(SomeGeneric<int>.i);
    }
} 
```

这打印 5 10 5

* * *

## 回答 #27

> 赞同：16
> 
> 时间：2010-06-15T12:44:42.203

**活动**

我从来不明白为什么事件是一种语言特征。它们使用起来很复杂：您需要在调用之前检查null，您需要取消注册（您自己），您无法找出谁注册了（例如：我注册了吗？）。为什么事件不只是图书馆中的一个类？基本上是专门的`List<delegate>`？

* * *

## 回答 #28

> 赞同：14
> 
> 时间：2013-05-14T14:53:21.297

刚刚发现一个让我陷入调试一段时间的奇怪问题：

您可以为可为 null 的 int 增加 null 而不会引发异常，并且该值保持为 null。

```
int? i = null;
i++; // I would have expected an exception but runs fine and stays as null 
```

* * *

## 回答 #29

> 赞同：13
> 
> 时间：2009-12-28T14:17:52.463

**枚举可以被多次评估**

当你有一个惰性枚举的枚举并且你迭代它两次并得到不同的结果时，它会咬你。（或者你得到相同的结果，但它不必要地执行了两次）

例如，在编写某个测试时，我需要一些临时文件来测试逻辑：

```
var files = Enumerable.Range(0, 5)
    .Select(i => Path.GetTempFileName());

foreach (var file in files)
    File.WriteAllText(file, "HELLO WORLD!");

/* ... many lines of codes later ... */

foreach (var file in files)
    File.Delete(file); 
```

想象一下我`File.Delete(file)`投掷时的惊喜`FileNotFound`！

这里发生的情况是，`files`可枚举对象被迭代了*两次*（第一次迭代的结果根本*不会*被记住），并且在每次新的迭代中你都会重新调用`Path.GetTempFilename()`，所以你会得到一组不同的临时文件名。

当然，解决方案是通过使用`ToArray()`or来急切枚举值`ToList()`：

```
var files = Enumerable.Range(0, 5)
    .Select(i => Path.GetTempFileName())
    .ToArray(); 
```

当你在做一些多线程的事情时，这甚至更可怕，比如：

```
foreach (var file in files)
    content = content + File.ReadAllText(file); 
```

你发现`content.Length`在所有的写入之后仍然是 0 ！！然后，您开始严格检查您是否没有竞争条件......在浪费了一个小时之后......您发现这只是您忘记的那个小小的 Enumerable gotcha 事情......

* * *

## 回答 #30

> 赞同：10
> 
> 时间：2010-03-30T01:24:33.923

```
TextInfo textInfo = Thread.CurrentThread.CurrentCulture.TextInfo;

textInfo.ToTitleCase("hello world!"); //Returns "Hello World!"
textInfo.ToTitleCase("hElLo WoRld!"); //Returns "Hello World!"
textInfo.ToTitleCase("Hello World!"); //Returns "Hello World!"
textInfo.ToTitleCase("HELLO WORLD!"); //Returns "HELLO WORLD!" 
```

是的，这种行为已记录在案，但这肯定不正确。

* * *

## 回答 #31

> 赞同：10
> 
> 时间：2012-12-05T13:58:09.010

这是我浪费了 2 天时间进行故障排除的一个超级问题。它没有抛出任何异常，只是用一些[奇怪的错误消息](http://social.msdn.microsoft.com/Forums/en-US/csharplanguage/thread/84da7fd7-30b8-4e5f-b82c-3e340170a1c6/)使网络服务器崩溃。我无法在 DEV 中重现该问题。此外，项目构建设置的实验以某种方式使其在 PROD 中消失，然后又回来了。终于我明白了。

如果您在以下代码中发现问题，请告诉我：

```
private void DumpError(Exception exception, Stack<String> context)
{
    if (context.Any())
    {
        Trace.WriteLine(context.Pop());
        Trace.Indent();
        this.DumpError(exception, context);
        Trace.Unindent();
    }
    else
    {
        Trace.WriteLine(exception.Message);
    }
} 
```

因此，如果您重视自己的理智：

**！！！永远不要在 Trace 方法中添加任何逻辑！！！**

代码一定是这样的：

```
private void DumpError(Exception exception, Stack<String> context)
{
    if (context.Any())
    {
        var popped = context.Pop();
        Trace.WriteLine(popped);
        Trace.Indent();
        this.DumpError(exception, context);
        Trace.Unindent();
    }
    else
    {
        Trace.WriteLine(exception.Message);
    }
} 
```

* * *

## 回答 #32

> 赞同：9
> 
> 时间：2008-12-08T20:30:29.190

`MemoryStream.GetBuffer()`与`MemoryStream.ToArray()`。前者返回整个缓冲区，后者只返回使用的部分。呸。

* * *

## 回答 #33

> 赞同：8
> 
> 时间：2008-10-27T21:15:36.770

关于[.NET Gotchas有一整本书](http://oreilly.com/catalog/9780596009090/)

我最喜欢的是在 C# 中创建一个类，将其继承到 VB，然后尝试重新继承回 C#，但它不起作用。ARGGH

* * *

## 回答 #34

> 赞同：8
> 
> 时间：2009-06-26T07:59:04.363

Dictionary<,>：“项目返回的顺序未定义”。这太可怕了，因为它有时会咬你，但对其他人有用，如果你只是盲目地认为 Dictionary 会很好玩（“为什么不应该呢？我想，List 会”），你真的必须在您最终开始质疑您的假设之​​前，请先了解一下。

[（这里](https://stackoverflow.com/questions/194484/whats-the-strangest-corner-case-youve-seen-in-c-or-net/311831#311831)有类似的问题。）

* * *

## 回答 #35

> 赞同：7
> 
> 时间：2010-04-28T16:34:11.927

所有 UserControls 中的[DesignMode属性](http://msdn.microsoft.com/en-us/library/system.web.ui.control.designmode.aspx)[实际上并不告诉您](https://connect.microsoft.com/VisualStudio/feedback/details/309922/designmode-property-doesnt-behave-as-anticipated)是否处于设计模式。

* * *

## 回答 #36

> 赞同：7
> 
> 时间：2010-04-28T16:55:08.640

在调试环境中评估时，该`base`关键字无法按预期工作：方法调用仍使用虚拟调度。

当我偶然发现它时，这浪费了我很多时间，我以为我在 CLR 的时空中遇到了某种裂痕，但后来我意识到这是一个已知的（甚至是故意的）错误：

[http://blogs.msdn.com/jmstall/archive/2006/06/29/funceval-does-virtual-dispatch.aspx](http://blogs.msdn.com/jmstall/archive/2006/06/29/funceval-does-virtual-dispatch.aspx)

* * *

## 回答 #37

> 赞同：7
> 
> 时间：2011-04-27T06:02:12.383

静态构造函数在锁定下执行。因此，从静态构造函数调用线程代码可能会导致死锁。这是一个演示它的示例：

```
using System.Threading;
class Blah
{
    static void Main() { /* Won’t run because the static constructor deadlocks. */ }

    static Blah()
    {
        Thread thread = new Thread(ThreadBody);
        thread.Start();
        thread.Join();
    }

    static void ThreadBody() { }
} 
```

* * *

## 回答 #38

> 赞同：6
> 
> 时间：2008-10-27T20:47:09.370

如果您正在为 MOSS 编码并且您通过这种方式获得站点参考：

```
SPSite oSiteCollection = SPContext.Current.Site; 
```

稍后在您的代码中您说：

```
oSiteCollection.Dispose(); 
```

来自[MSDN](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.spsite.dispose.aspx)：

> 如果您创建一个 SPSite 对象，您可以使用 Dispose 方法关闭该对象。但是，如果您有对共享资源的引用，例如当对象由 GetContextSite 方法或 Site 属性（例如，SPContext.Current.Site）提供时，请不要使用 Dispose 方法关闭该对象，而应改为允许 Windows SharePoint Services 或您的门户应用程序管理对象。有关对象处置的详细信息，请参阅最佳实践：使用可处置的 Windows SharePoint Services 对象。

这发生在每个 MOSS 程序员身上，而且在某些方面。

* * *

## 回答 #39

> 赞同：6
> 
> 时间：2009-09-10T09:39:50.037

**ASP.NET：**

如果您使用的是 Linq-To-SQL，`SubmitChanges()`则调用数据上下文并引发异常（例如重复键或其他约束违规），在您调试时，违规对象值仍保留在您的内存中，并且每次都会重新提交您随后调用`SubmitChanges()`.

现在这是**真正的问题：****即使您在 IDE 中按下“停止”按钮并重新启动**，错误的值仍会保留在内存中！我不明白为什么有人认为这是一个好主意——但是系统托盘中弹出的那个小小的 ASP.NET 图标一直在运行，它似乎可以保存你的对象缓存。如果你想刷新你的内存空间，你必须右键单击该图标并强行关闭它！**明白了！**

* * *

## 回答 #40

> 赞同：6
> 
> 时间：2012-12-06T06:14:45.837

```
enum Seasons
{
    Spring = 1, Summer = 2, Automn = 3, Winter = 4
}

public string HowYouFeelAbout(Seasons season)
{
    switch (season)
    {
        case Seasons.Spring:
            return "Nice.";
        case Seasons.Summer:
            return "Hot.";
        case Seasons.Automn:
            return "Cool.";
        case Seasons.Winter:
            return "Chilly.";
    }
} 
```

错误？
**并非所有代码路径都返回一个值……**
你在开玩笑吗？我敢打赌，所有代码路径都会返回一个值，因为`Seasons`这里提到了每个成员。它应该检查所有枚举成员，如果在 switch 案例中没有成员，那么这样的错误将是有意义的，但现在我应该添加一个`Default`多余的案例，并且永远不会被代码访问。

**编辑：**
在对这个问题进行了更多研究之后，我来到了[Eric Lippert 写得很好且有用的帖子](http://blogs.msdn.com/b/ericlippert/archive/2009/08/13/four-switch-oddities.aspx)，但它仍然有点奇怪。你同意？

* * *

## 回答 #41

> 赞同：5
> 
> 时间：2008-10-27T21:15:01.297

我经常要提醒自己 DateTime 是一种值类型，而不是 ref 类型。对我来说似乎太奇怪了，特别是考虑到它的构造函数的多样性。

* * *

## 回答 #42

> 赞同：5
> 
> 时间：2009-01-30T20:35:17.483

到目前为止我最糟糕的一个我今天才发现......如果你覆盖 object.Equals(object obj)，你最终会发现：

```
((MyObject)obj).Equals(this); 
```

与以下行为不同：

```
((MyObject)obj) == this; 
```

一个会调用您的覆盖函数，另一个不会。

* * *

## 回答 #43

> 赞同：5
> 
> 时间：2010-03-30T01:22:11.367

对于 LINQ-to-SQL 和 LINQ-to-Entities

```
return result = from o in table
                where o.column == null
                select o;
//Returns all rows where column is null

int? myNullInt = null;
return result = from o in table
                where o.column == myNullInt
                select o;
//Never returns anything! 
```

[这里](https://connect.microsoft.com/data/feedback/details/607404/entity-framework-and-linq-to-sql-incorrectly-handling-nullable-variables)有 LINQ-to-Entites 的错误报告，尽管他们似乎不经常查看该论坛。也许有人也应该为 LINQ-to-SQL 提交一份文件？

* * *

## 回答 #44

> 赞同：5
> 
> 时间：2010-10-06T21:31:33.873

**Oracle 参数必须按顺序添加**

这是 ODP .Net 实现 Oracle 参数化查询的一个主要问题。

将参数添加到查询时，默认行为是**忽略**参数名称，并按照添加的顺序使用值。

解决方案是将对象的`BindByName`属性设置为-默认情况下...这是定性的（如果不是完全定量的），就像使用默认值调用的属性一样。`OracleCommand``true``false``DropDatabaseOnQueryExecution``true`

[他们称之为功能](http://download.oracle.com/docs/cd/E11882_01/win.112/e12249/OracleCommandClass.htm#i997666)；[我称之为公有领域的坑](https://stackoverflow.com/questions/3876856/oracle-ignores-parameter-names-and-works-in-order-of-adding-parameters)。

有关更多详细信息，请参见[此处](https://stackoverflow.com/questions/3876856/oracle-ignores-parameter-names-and-works-in-order-of-adding-parameters)。

* * *

## 回答 #45

> 赞同：5
> 
> 时间：2012-09-19T20:48:56.603

看看这个：

```
class Program
{
    static void Main(string[] args)
    {
        var originalNumbers = new List<int> { 1, 2, 3, 4, 5, 6 };

        var list = new List<int>(originalNumbers);
        var collection = new Collection<int>(originalNumbers);

        originalNumbers.RemoveAt(0);

        DisplayItems(list, "List items: ");
        DisplayItems(collection, "Collection items: ");

        Console.ReadLine();
    }

    private static void DisplayItems(IEnumerable<int> items, string title)
    {
        Console.WriteLine(title);
        foreach (var item in items)
            Console.Write(item);
        Console.WriteLine();
    }
} 
```

输出是：

```
List items: 123456
Collection items: 23456 
```

接受 IList 的集合构造函数创建一个围绕原始 List 的包装器，而 List 构造函数创建一个新 List 并将所有引用从原始列表复制到新 List。

在此处查看更多信息：http: [//blog.roboblob.com/2012/09/19/dot-net-gotcha-nr1-list-versus-collection-constructor/](http://blog.roboblob.com/2012/09/19/dot-net-gotcha-nr1-list-versus-collection-constructor/)

* * *

## 回答 #46

> 赞同：4
> 
> 时间：2010-09-02T12:14:19.833

**递归属性陷阱**

我认为并非特定于 C#，而且我确信我已经在 SO 的其他地方看到过它（这是让我想起它的问题[）](https://stackoverflow.com/questions/3626833/inotifypropertychanged-on-a-usercontrol-return-an-infinite-loop)

它可以通过两种方式发生，但最终结果是相同的：

`base.`覆盖属性时忘记引用：

```
 public override bool IsRecursive
 {
     get { return IsRecursive; }
     set { IsRecursive = value; }
 } 
```

从 auto- 更改为 backed- 属性，但并非一直如此：

```
public bool IsRecursive
{
    get { return IsRecursive; }
    set { IsRecursive = value; }
} 
```

* * *

## 回答 #47

> 赞同：3
> 
> 时间：2009-07-08T12:26:49.350

发生在我身上的最糟糕的事情是 webBrowser documentText 问题：

[http://geekswithblogs.net/paulwhitblog/archive/2005/12/12/62961.aspx#107062](http://geekswithblogs.net/paulwhitblog/archive/2005/12/12/62961.aspx#107062)

AllowNavigation 解决方案适用于 Windows 窗体...

但在紧凑的框架中，该属性不存在......

...到目前为止，我发现的唯一解决方法是重建浏览器控件：

[http://social.msdn.microsoft.com/Forums/it-IT/netfxcompact/thread/5637037f-96fa-48e7-8ddb-6d4b1e9d7db9](http://social.msdn.microsoft.com/Forums/it-IT/netfxcompact/thread/5637037f-96fa-48e7-8ddb-6d4b1e9d7db9)

但是这样做，您需要处理手头的浏览器历史记录......：P

* * *

## 回答 #48

> 赞同：3
> 
> 时间：2009-09-10T09:49:24.233

**Linq-To-Sql 和数据库/本地代码歧义**

有时 Linq 无法确定某个方法是要在数据库上执行还是在本地代码中执行。

有关问题陈述和解决方案，请参见[此处](https://stackoverflow.com/questions/1264985/linq-could-not-translate-expression-into-sql-and-could-not-treat-it-as-a-loca)和[此处](https://stackoverflow.com/questions/1358218/why-linq-cant-translate-expression-treat-as-local-expression-and-throws-an-excep)。

* * *

## 回答 #49

> 赞同：3
> 
> 时间：2010-04-07T20:38:41.743

[VisibleChanged](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.visiblechanged.aspx)通常不会在 Visible 更改时[调用。](http://memprofiler.com/articles/thecontrolvisiblechangedevent.aspx)

* * *

## 回答 #50

> 赞同：2
> 
> 时间：2009-09-10T09:45:07.960

**LINQ to SQL 和一对多关系**

这是一个可爱的，已经咬了我好几次，MS 把它留给了他们自己的一位开发人员把它放在[她的博客](http://blogs.msdn.com/bethmassi/archive/2007/10/02/linq-to-sql-and-one-to-many-relationships.aspx)中。我不能说比她做得更好，所以看看那里。

* * *

## 回答 #51

> 赞同：2
> 
> 时间：2010-01-31T16:03:12.327

**相关对象和外键不同步**

[微软已经承认了这个错误](https://connect.microsoft.com/VisualStudio/feedback/details/529623/linq-to-sql-related-object-and-fk-not-in-synch?wa=wsignin1.0#tabs)。

我有一堂课`Thing`，里面有一个FK到`Category`。Category 与 Thing 没有明确的关系，以免污染界面。

```
var thing = CreateThing(); // does stuff to create a thing
var category = GetCategoryByID(123); // loads the Category with ID 123
thing.Category = category;
Console.WriteLine("Category ID: {0}", thing.CategoryID); 
```

输出：

```
Category ID: 0 
```

相似地：

```
var thing = CreateThing();
thing.CategoryID = 123;
Console.WriteLine("Category name: {0}", order.Category.Name); 
```

抛出一个`NullReferenceException`. 相关对象`Category`不加载 ID 为 123 的类别记录。

但是，在您向数据库提交更改后，这些值会同步。但是在访问数据库之前，FK 值和相关对象实际上是独立运行的！

（有趣的是，FK 值与相关对象同步失败似乎只发生在没有定义子关系的情况下，即 Category 没有“Things”属性。但是当你只设置 FK 值时的“按需加载” NEVER作品。）

**明白了！**

* * *

## 回答 #52

> 赞同：2
> 
> 时间：2011-02-23T08:32:34.200

我一直认为`value`types 总是 on`stack`并且`reference`types on `heap`。

好吧，事实**并非如此**。当我最近在 SO 上看到[这个问题](https://stackoverflow.com/q/5088216/399722)（并且可以说回答错误）时，我开始知道事实并非如此。

正如[Jon Skeet](https://stackoverflow.com/questions/5088216/where-these-are-stored/5088328#5088328)回答的那样（参考[Eric Lippert 的博客文章](http://blogs.msdn.com/b/ericlippert/archive/2010/09/30/the-truth-about-value-types.aspx)）它是一个**神话**。

相当重要的链接：

[关于值类型的真相](http://blogs.msdn.com/b/ericlippert/archive/2010/09/30/the-truth-about-value-types.aspx)

[引用不是地址](http://blogs.msdn.com/b/ericlippert/archive/2009/02/17/references-are-not-addresses.aspx)

[堆栈是实现细节第 1 部分](http://blogs.msdn.com/b/ericlippert/archive/2009/04/27/the-stack-is-an-implementation-detail.aspx)

[堆栈是实现细节第 2 部分](http://blogs.msdn.com/ericlippert/archive/2009/05/04/the-stack-is-an-implementation-detail-part-two.aspx)

* * *

## 回答 #53

> 赞同：1
> 
> 时间：2008-10-27T19:37:18.903

```
mystring.Replace("x","y") 
```

虽然它看起来应该对正在调用它的字符串进行替换，但实际上它返回一个新字符串，并在不更改调用它的字符串的情况下进行替换。您需要记住字符串是不可变的。

* * *

## 回答 #54

> 赞同：1
> 
> 时间：2008-10-28T03:54:33.313

以下不会在.Net 中捕获异常。相反，它会导致 StackOverflow 异常。

```
private void button1_Click( object sender, EventArgs e ) {
    try {
        CallMe(234);
    } catch (Exception ex) {
        label1.Text = ex.Message.ToString();
    }
}
private void CallMe( Int32 x ) {
    CallMe(x);
} 
```

**对于评论者（和反对票）：**
堆栈溢出如此明显是极其罕见的。但是，如果发生这种情况，您将无法捕捉到异常，并且可能会花费几个小时试图找出问题的确切位置。如果 SO 出现在很少使用的逻辑路径中，尤其是在您可能不知道引发问题的确切条件的 Web 应用程序中，情况可能会更加复杂。

这与该问题的公认答案完全相同（[https://stackoverflow.com/a/241194/2424](https://stackoverflow.com/a/241194/2424)）。该答案的属性获取器本质上与上面的代码完全相同，并且在没有堆栈跟踪的情况下崩溃。

* * *

## 回答 #55

> 赞同：1
> 
> 时间：2010-03-16T17:56:38.480

**LinqToSQL 和空集聚合**

看到[这个问题](https://stackoverflow.com/questions/2455500/how-to-do-linq-aggregates-when-there-might-be-an-empty-set)。

如果您有一个正在运行聚合的 LinqToSql 查询 - 如果您的结果集为空，则即使已声明，Linq 也无法确定数据类型是什么。

例如，假设您有一个`Claim`带有字段的表，该字段`Amount`在 LinqToSql 中属于类型`decimal`。

```
var sum = Claims.Where(c => c.ID < 0).Sum(c => c.Amount); 
```

显然，没有任何声明的 ID 小于零，所以您希望看到 sum = null，对吧？ **错误的！** 你得到一个`InvalidOperationException`, 因为 Linq 查询基础的 SQL 查询没有数据类型。你必须明确告诉 Linq 它是小数！因此：

```
var sum = Claims.Where(c => c.ID < 0).Sum(c => (decimal?)c.Amount); 
```

这真的很愚蠢，而且 IMO 是微软的设计错误。

**明白了！**

* * *

## 回答 #56

> 赞同：1
> 
> 时间：2013-04-05T10:09:34.223

有时堆栈跟踪中的行号与源代码中的行号不匹配。这可能是由于用于优化的简单（单行）函数的内联。对于使用日志进行调试的人来说，这是一个严重的混淆来源。

编辑：示例：有时您会在堆栈跟踪中看到一个空引用异常，它指向一行代码，绝对没有空引用异常的机会，例如简单的整数赋值。

* * *

## 回答 #57

> 赞同：1
> 
> 时间：2014-01-17T22:41:02.547

不是最坏的，但还没有被提出来。作为参数传递给 System.Collections.Concurrent 方法的工厂方法可以被多次调用，即使曾经只使用一个返回值。考虑到 .NET 有多么强烈地试图保护您免受线程原语中的虚假唤醒，这可能会让人感到意外。

```
using System;
using System.Collections.Generic;
using System.Collections.Concurrent;
using System.Linq;
using System.Text;
using System.Threading;
using System.Threading.Tasks;

namespace ValueFactoryBehavingBadlyExample
{
    class Program
    {
        static ConcurrentDictionary<int, int> m_Dict = new ConcurrentDictionary<int, int>();
        static ManualResetEventSlim m_MRES = new ManualResetEventSlim(false);
        static void Main(string[] args)
        {
            for (int i = 0; i < 8; ++i)
            {
                Task.Factory.StartNew(ThreadGate, TaskCreationOptions.LongRunning);
            }
            Thread.Sleep(1000);
            m_MRES.Set();
            Thread.Sleep(1000);
            Console.WriteLine("Dictionary Size: " + m_Dict.Count);
            Console.Read();
        }

        static void ThreadGate()
        {
            m_MRES.Wait();
            int value = m_Dict.GetOrAdd(0, ValueFactory);
        }

        static int ValueFactory(int key)
        {
            Thread.Sleep(1000);
            Console.WriteLine("Value Factory Called");
            return key;
        }
    }
} 
```

（可能）输出：

```
Value Factory Called
Value Factory Called
Value Factory Called
Value Factory Called
Dictionary Size: 0
Value Factory Called
Value Factory Called
Value Factory Called
Value Factory Called 
```

* * *

## 回答 #58

> 赞同：1
> 
> 时间：2014-03-21T09:55:07.497

**将容量传递给`List<int>`而不是使用集合初始值设定项。**

```
var thisOnePasses = new List<int> {2}; // collection initializer
var thisOneFails = new List<int> (2);  // oops, use capacity by mistake #gotcha#

thisOnePasses.Count.Should().Be(1);
thisOnePasses.First().Should().Be(2);

thisOneFails.Count.Should().Be(1);     // it's zero
thisOneFails.First().Should().Be(2);   // Sequence contains no elements... 
```

* * *

## 回答 #59

> 赞同：0
> 
> 时间：2010-05-05T12:50:14.687

**LinqToSql 批次随着批次大小的平方而变慢**

[这是](https://stackoverflow.com/questions/2767341/how-to-avoid-geometric-slowdown-with-large-linq-transactions)我探索这个问题 的问题（和[答案）。](https://stackoverflow.com/questions/2767341/how-to-avoid-geometric-slowdown-with-large-linq-transactions/2773207#2773207)

简而言之，如果您在调用 之前尝试在内存中建立太多对象`DataContext.SubmitChanges()`，您就会开始以几何速度体验迟缓。我还没有 100% 确认是这种情况，但在我看来，调用 to`DataContext.GetChangeSet()`会导致数据上下文对更改集中 2 个项目的每个组合执行等效评估 ( `.Equals()`)，可能是为了确保它不是双重插入或导致其他并发问题。*问题是，如果您有非常大的批次，则比较次数与n*的平方成比例增加，即*(n^2+n)/2*。内存中的 1,000 个项目意味着超过 500,000 次比较……这可能需要很长时间。

为避免这种情况，您必须确保对于预期有大量项目的任何批次，您在事务边界内完成整个操作，在创建每个单独项目时保存它，而不是在最后一次大保存。

* * *

## 回答 #60

> 赞同：0
> 
> 时间：2011-01-09T10:21:28.267

**Linq2SQL：不支持接口成员 [...] 的映射。**

如果您对实现接口的对象执行 Linq2Sql 查询，您会得到一个非常奇怪的行为。假设您有一个`MyClass`实现 interface的类`IHasDescription`，因此：

```
public interface IHasDescription {
  string Description { get; set; }
}

public partial class MyClass : IHasDescription { } 
```

（另一半`MyClass`是一个Linq2Sql生成的类，包括属性`Description`。）

现在您编写一些代码（通常这发生在通用方法中）：

```
public static T GetByDescription<T>(System.Data.Linq.Table<T> table, string desc) 
  where T : class, IHasDescription {
  return table.Where(t => t.Description == desc).FirstOrDefault();
} 
```

编译得很好 - 但是你得到一个运行时错误：

```
NotSupportedException: The mapping of interface member IHasDescription.Description is not supported. 
```

现在whaddaya做什么呢？好吧，这很明显：只需将您的更改`==`为`.Equals()`，因此：

```
return table.Where(t => t.Description.Equals(desc)).FirstOrDefault(); 
```

现在一切正常！

见[这里](http://social.msdn.microsoft.com/Forums/en/linqtosql/thread/bc2fbbce-eb63-4735-9b2d-26b4ab8fe589)。

* * *

## 回答 #61

> 赞同：-1
> 
> 时间：2008-10-27T20:39:23.413

一些代码：

```
 List<int> a = new List<int>();
        for (int i = 0; i < 10; i++)
        {
            a.Add(i);
        }

        var q1 = (from aa in a
                  where aa == 2
                  select aa).Single();

        var q2 = (from aa in a
                  where aa == 2
                  select aa).First(); 
```

q1 - 在此查询中检查列表中的所有整数；q2 - 检查整数，直到找到“正确的”整数。

# python - Python 懒惰列表

> ID：241141
> 
> 赞同：15
> 
> 时间：2008-10-27T19:32:52.593
> 
> 标签：python

我想创建自己的集合，该集合具有 python 列表的所有属性，并且还知道如何将自身保存/加载到数据库中。另外我想让加载隐式和惰性，因为它不会在创建列表时发生，而是等到它第一次使用。

是否有一种`__xxx__`方法可以在第一次使用任何列表属性（例如，...等）时覆盖加载列表，`len`而`getitem`不必`iter`全部覆盖它们？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2011-02-24T12:39:42.193

不是一个*，*但 5 就足够了：

```
from collections import MutableSequence

class Monitored(MutableSequence):
    def __init__(self):
        super(Monitored, self).__init__()
        self._list = []

    def __len__(self):
        r = len(self._list)
        print "len: {0:d}".format(r)
        return r

    def __getitem__(self, index):
        r = self._list[index]
        print "getitem: {0!s}".format(index)
        return r

    def __setitem__(self, index, value):
        print "setitem {0!s}: {1:s}".format(index, repr(value))
        self._list[index] = value

    def __delitem__(self, index):
        print "delitem: {0!s}".format(index)
        del self._list[index]

    def insert(self, index, value):
        print "insert at {0:d}: {1:s}".format(index, repr(value))
        self._list.insert(index, value) 
```

检查某个东西是否实现了整个列表接口的正确方法是检查它是否是`MutableSequence`. `collections`在模块中找到的 ABC （其中`MutableSequence`之一）有两个原因：

1.  允许您创建自己的类来模拟内部容器类型，以便它们可以在普通内置的任何地方使用。

2.  用作参数`isinstance`并`issubclass`验证对象是否实现了必要的功能：

```
>>> isinstance([], MutableSequence)
True
>>> issubclass(list, MutableSequence)
True 
```

我们的`Monitored`班级是这样工作的：

```
>>> m = 监控（）
>>> m.append(3)
长度：0
在 0: 3 处插入
>>> m.extend((1, 4))
长度：1
插入 1:1
长度：2
在 2:4 插入
>>> 毫升
[3, 1, 4]
>>> m.remove(4)
获取项目：0
获取项目：1
获取项目：2
删除：2
>>> m.pop(0) # 之后，ml == [1]
获取项目：0
删除：0
3
>>> m.insert(0, 4)
在 0:4 处插入
>>> m.reverse() # 反转后，ml == [1, 4]
长度：2
获取项目：1
获取项目：0
套装0：1
第 1 组：4
>>> m.index(4)
获取项目：0
获取项目：1
1

```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-28T02:59:18.200

不完全是。为了模拟列表以外的东西*，*有`__getattribute__`，但不幸的是，Python 不认为运算符like `x[y]`or`x(y)`与or*完全相同*。像这样的运算符是类的属性，而不是实例的属性，如您在此处看到的：`x.__getitem__(y)``x.__call__(y)`

```
>>> class x(object):
...     def __getattribute__(self, o):
...         print o
... 
>>> x()[3]
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: 'x' object does not support indexing 
```

但是，您可以利用 Python 的动态特性来有效地消除这种区别。如果您主要关心的是节省自己的打字时间，并减少需要维护的代码，您可以执行以下操作：

```
class override(object):
    def __init__(self, methodName):
        self.methodName = methodName

    def __get__(self, oself, cls):
        oself._load(self.methodName)
        return getattr(super(oself.__class__, oself), self.methodName)

class LazyList(list):
    def _load(self, name):
        print 'Loading data for %s...' % (name,)

    for methodName in set(dir(list)) - set(dir(object)):
        locals()[methodName] = override(methodName) 
```

您可能不想`dir()`在现实生活中使用，但合适的固定字符串列表可以作为替代品。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-27T19:42:08.253

[`__getattribute__`](http://www.python.org/doc/2.5.2/ref/new-style-attribute-access.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-27T21:56:35.660

不，没有。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-09-05T13:57:11.927

没有单一的方法。你必须重新定义它们中的很多。MutableSequence 似乎是现代的做法。这是一个适用于 Python 2.4+ 的版本::

```
class LazyList(list):
    """List populated on first use."""
    def __new__(cls, fill_iter):

        class LazyList(list):
            _fill_iter = None

        _props = (
            '__str__', '__repr__', '__unicode__',
            '__hash__', '__sizeof__', '__cmp__', '__nonzero__',
            '__lt__', '__le__', '__eq__', '__ne__', '__gt__', '__ge__',
            'append', 'count', 'index', 'extend', 'insert', 'pop', 'remove',
            'reverse', 'sort', '__add__', '__radd__', '__iadd__', '__mul__',
            '__rmul__', '__imul__', '__contains__', '__len__', '__nonzero__',
            '__getitem__', '__setitem__', '__delitem__', '__iter__',
            '__reversed__', '__getslice__', '__setslice__', '__delslice__')

        def lazy(name):
            def _lazy(self, *args, **kw):
                if self._fill_iter is not None:
                    _fill_lock.acquire()
                    try:
                        if self._fill_iter is not None:
                            list.extend(self, self._fill_iter)
                            self._fill_iter = None
                    finally:
                        _fill_lock.release()
                real = getattr(list, name)
                setattr(self.__class__, name, real)
                return real(self, *args, **kw)
            return _lazy

        for name in _props:
            setattr(LazyList, name, lazy(name))

        new_list = LazyList()
        new_list._fill_iter = fill_iter
        return new_list 
```

# c# - C# .NET：如何检查我们是否使用电池运行？

> ID：241142
> 
> 赞同：29
> 
> 时间：2008-10-27T19:33:11.597
> 
> 标签：c#, performance, optimization

我想成为一名优秀的开发者公民，[缴纳税款](http://blogs.msdn.com/oldnewthing/archive/2005/08/22/454487.aspx)，并在我们通过远程桌面运行或使用电池运行时禁用某些东西。

如果我们在远程桌面上运行（或等效地在终端服务器会话中），我们必须禁用动画和双缓冲。您可以通过以下方式检查：

```
/// <summary>
/// Indicates if we're running in a remote desktop session.
/// If we are, then you MUST disable animations and double buffering i.e. Pay your taxes!
/// 
/// </summary>
/// <returns></returns>
public static Boolean IsRemoteSession
{
    //This is just a friendly wrapper around the built-in way
    get
    {
        return System.Windows.Forms.SystemInformation.TerminalServerSession;
    }
} 
```

现在我需要确定用户是否使用电池供电。如果是，我不想炸毁他们的电池。我想做一些事情，比如

*   禁用动画
*   禁用后台拼写检查
*   禁用后台打印
*   关闭渐变
*   采用`graphics.SmoothingMode = SmoothingMode.HighSpeed;`
*   采用`graphics.InterpolationMode = InterpolationMode.Low;`
*   采用`graphics.CompositingQuality = CompositingQuality.HighSpeed;`
*   最小化硬盘访问 - 避免启动
*   最小化网络访问 - 以节省 WiFi 电量

有没有一种管理方法可以查看机器当前是否**正在**使用电池运行？

## 奖金阅读

*   [你如何说服开发商支付他们的“税款”？](http://blogs.msdn.com/oldnewthing/archive/2005/08/22/454487.aspx) *（[存档.is](https://archive.fo/iNVg5)）*
*   [税收：远程桌面连接和绘画](http://blogs.msdn.com/oldnewthing/archive/2006/01/03/508694.aspx) *（[archive.is](https://archive.fo/lJx1u)）*
*   [GetSystemMetrics(SM_REMOTESESSION)](http://msdn.microsoft.com/en-us/library/ms724385(VS.85).aspx) *( [archive.is](https://archive.fo/Ywbw7) )*

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-10-27T19:39:24.033

我相信您可以检查[SystemInformation.PowerStatus](http://msdn.microsoft.com/en-us/library/system.windows.forms.systeminformation.powerstatus(VS.80).aspx)以查看它是否使用电池。

```
Boolean isRunningOnBattery =
      (System.Windows.Forms.SystemInformation.PowerStatus.PowerLineStatus == 
       PowerLineStatus.Offline); 
```

编辑：除了上述之外，还有一个 System.Windows.Forms。[电源状态](http://msdn.microsoft.com/en-us/library/system.windows.forms.powerstatus(VS.80).aspx)类。它的一种方法是[PowerLineStatus](http://msdn.microsoft.com/en-us/library/system.windows.forms.powerstatus.powerlinestatus(VS.80).aspx)，如果它使用交流电源，它将等于 PowerLineStatus.Online。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-27T19:44:51.523

R. Bemrose 找到了托管呼叫。这是一些示例代码：

```
/// <summary>
/// Indicates if we're running on battery power.
/// If we are, then disable CPU wasting things like animations, background operations, network, I/O, etc
/// </summary>
public static Boolean IsRunningOnBattery
{
   get
   {
      PowerLineStatus pls = System.Windows.Forms.SystemInformation.PowerStatus.PowerLineStatus;

      //Offline means running on battery
      return (pls == PowerLineStatus.Offline);
   }
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-27T19:37:55.783

您可以通过 P/Invoke 使用 GetSystemPowerStatus 函数。请参阅：http: [//msdn.microsoft.com/en-gb/library/aa372693.aspx](http://msdn.microsoft.com/en-gb/library/aa372693.aspx)

这是一个例子：

```
using System;
using System.Runtime.InteropServices;
namespace PowerStateExample
{
    [StructLayout(LayoutKind.Sequential)]
    public class PowerState
    {
        public ACLineStatus ACLineStatus;
        public BatteryFlag BatteryFlag;
        public Byte BatteryLifePercent;
        public Byte Reserved1;
        public Int32 BatteryLifeTime;
        public Int32 BatteryFullLifeTime;

        // direct instantation not intended, use GetPowerState.
        private PowerState() {}

        public static PowerState GetPowerState()
        {
            PowerState state = new PowerState();
            if (GetSystemPowerStatusRef(state))
                return state;

            throw new ApplicationException("Unable to get power state");
        }

        [DllImport("Kernel32", EntryPoint = "GetSystemPowerStatus")]
        private static extern bool GetSystemPowerStatusRef(PowerState sps);
    }

    // Note: Underlying type of byte to match Win32 header
    public enum ACLineStatus : byte
    {
        Offline = 0, Online = 1, Unknown = 255
    }

    public enum BatteryFlag : byte
    {
        High = 1, Low = 2, Critical = 4, Charging = 8,
        NoSystemBattery = 128, Unknown = 255
    }

    // Program class with main entry point to display an example.
    class Program
    {        
        static void Main(string[] args)
        {
            PowerState state = PowerState.GetPowerState();
            Console.WriteLine("AC Line: {0}", state.ACLineStatus);
            Console.WriteLine("Battery: {0}", state.BatteryFlag);
            Console.WriteLine("Battery life %: {0}", state.BatteryLifePercent);
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-27T19:37:21.523

您可以使用 WMI (Windows Management Instrumentation) 向操作系统查询电池状态。

您可以在此处找到更多信息：

*   [http://69.10.233.10/KB/system/Wmi_Processor_infoWrapper.aspx](http://69.10.233.10/KB/system/Wmi_Processor_infoWrapper.aspx)
*   [http://www.microsoft.com/technet/scriptcenter/resources/qanda/apr07/hey0409.mspx](http://www.microsoft.com/technet/scriptcenter/resources/qanda/apr07/hey0409.mspx)
*   [http://www.codeproject.com/KB/cs/EverythingInWmi03.aspx](http://www.codeproject.com/KB/cs/EverythingInWmi03.aspx)

希望有帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-08-02T05:10:13.940

Powerlord 的回答似乎不起作用，可能是因为它是在 2008 年回答的。

这是一个对我有用的版本：

```
Boolean x = (System.Windows.SystemParameters.PowerLineStatus == System.Windows.PowerLineStatus.Offline); 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-27T19:39:34.093

我不相信它在托管代码中公开，但您可以通过 pinvoke 使用 Win32 GetSystemPowerStatus 来获取此信息。

顺便说一句，您可能需要考虑使用 GetCurrentPowerPolicies 或类似方法来确定与性能/电源管理相关的用户偏好。

# c++ - 如何设置 QScrollArea 的初始大小？

> ID：241144
> 
> 赞同：3
> 
> 时间：2008-10-27T19:33:15.510
> 
> 标签：c++, qt, scroll, widget

我知道这是一个非常具体的 C++ 和 Qt 相关问题，但也许有人可以帮助我，无论如何......

请参阅下面的代码：我想在滚动区域内显示图像。滚动区域的视口应具有定义的初始大小。这意味着，如果图像的大小大于视口的初始大小，则滚动条将可见，否则不可见。

```
// create label for displaying an image
QImage image( ":/test.png" );
QLabel *label = new QLabel( this );
label->setPixmap( image.toPixmap() );

// put label into scroll area
QScollArea *area = new QScrollArea( this );
area->setWidget( label );

// set the initial size of the view port
// NOTE: This is what I'd like to do, but this method does not exist :(
area->setViewPortSize( QSize( 300, 300 ) ); 
```

应该可以调整整个应用程序的大小，以便视口将获得不同于初始大小的大小。

不幸的是，我无法找到如何设置视口的大小。Qt 的布局机制似乎为视口设置了默认大小，但到目前为止我还无法更改它。设置新尺寸

```
area->setMinimumSize( QSize( 300, 300 ) ); 
```

实际上将设置所需的大小，但随后滚动区域失去了将大小调整为小于 300x300 的大小的能力。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T20:13:45.660

我认为您以错误的方式看待问题。QScrollArea 只是一个放在框架或 QMainWindow 中的小部件。小部件的大小由包含它的小部件的布局控制。

看看这个来自 Trolltech 的示例：[图像查看器示例](http://doc.qt.io/qt-5/qtwidgets-widgets-imageviewer-example.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-02T19:52:20.630

滚动区域是顶级小部件吗？如果是这样，只需调用

```
area->resize(300,300); 
```

如果它在层次结构中，则需要适当地调整顶层大小（复杂），或设置区域的 minimumSize。您也可以尝试使用 LayoutPolicy - 假设 sizeHint 为 QSize(300,300) 您可以根据[https://doc.qt.io/qt-5/qsizepolicy.html#Policy中定义的内容为其提供适当的大小策略-枚举](https://doc.qt.io/qt-5/qsizepolicy.html#Policy-enum)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T14:00:07.990

你可以试试：

```
class MyScrollArea : public QScrollArea
{
    virtual QSize sizeHint() const { return QSize( 300, 300 ); }
};

// create label for displaying an image
QImage image( ":/test.png" );
Label *label = new QLabel;
label->setPixmap( image.toPixmap() );

// put label into scroll area
QScollArea *area = new MyScrollArea( this );
area->setWidget( label ); 
```

然而布局和 Qt 是惊人的巫毒。它是 IMO 功能最少的部分。

如果这不起作用，请尝试在各种小部件上调用 QWidget::resize() 。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T14:36:53.237

我不认为你可以很容易地做到这一点，也就是说（如果我没看错的话），调整小部件的大小，使内部区域为 300x300。但是，您可能可以捏造它，因为滚动区域是一种框架，它继承自 QWidget。这意味着您可以只调用`area->resize( 300 + fudge, 300 + fudge )`，其中您的软糖值说明了框架绘图占用的额外位。

但是，我不确定这是否可以在动态调整大小的对话框中工作。我从来没有做过这样的事情。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-04T22:46:12.010

如果您尝试在滚动区域内显示图像，最好不要使用标签。

您应该尝试使用 QGraphicsView/QGraphicsScene/QGraphicPixmapItem（而不是滚动区域和标签）。显示图像时性能要好得多。当您使用滚动条四处移动时，滚动区域和标签将非常糟糕地重新绘制图像。

例如，您有一个“.ui”文件，在 gui 上有一个名为“qgvImageView”的 QGraphicsView 和一个名为“image”的 QImage ...

```
QGraphicsScene *scene = new QGraphicsScene(qgvImageView);
QPixmap pixTmp(QPixmap::fromImage(image));
QGraphicsPixmapItem * ppixItem = scene->addPixmap( pixTmp );
ppixItem->setPos(0,0); 
```

查看 QT 文档。顺便说一句：这是在 Qt 4.2 中引入的

我不确定这是否会专门解决问题，但 QGraphicsView 有可能对您尝试做的事情做出更好的反应。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-03T19:00:46.677

怎么用

```
area->setGeometry(int x, int y, int w, int h); 
```

# javascript - jQuery Validate Plugin - 如何创建一个简单的自定义规则？

> ID：241145
> 
> 赞同：370
> 
> 时间：2008-10-27T19:33:21.063
> 
> 标签：javascript, jquery, jquery-validate

[`addMethod`](http://jqueryvalidation.org/jQuery.validator.addMethod)如何使用不使用正则表达式的 jQuery Validate 插件（使用）创建简单的自定义规则？

例如，什么函数会创建一个规则，仅当至少一组复选框被选中时才进行验证？

* * *

## 回答 #1

> 赞同：397
> 
> 时间：2008-10-27T19:56:52.717

您可以通过执行以下操作来创建一个简单的规则：

```
jQuery.validator.addMethod("greaterThanZero", function(value, element) {
    return this.optional(element) || (parseFloat(value) > 0);
}, "* Amount must be greater than zero"); 
```

然后像这样应用它：

```
$('validatorElement').validate({
    rules : {
        amount : { greaterThanZero : true }
    }
}); 
```

只需更改“addMethod”的内容即可验证您的复选框。

* * *

## 回答 #2

> 赞同：101
> 
> 时间：2010-02-18T15:59:17.693

```
$(document).ready(function(){
    var response;
    $.validator.addMethod(
        "uniqueUserName", 
        function(value, element) {
            $.ajax({
                type: "POST",
                url: "http://"+location.host+"/checkUser.php",
                data: "checkUsername="+value,
                dataType:"html",
                success: function(msg)
                {
                    //If username exists, set response to true
                    response = ( msg == 'true' ) ? true : false;
                }
             });
            return response;
        },
        "Username is Already Taken"
    );

    $("#regFormPart1").validate({
        username: {
            required: true,
            minlength: 8,
            uniqueUserName: true
        },
        messages: {
            username: {
                required: "Username is required",
                minlength: "Username must be at least 8 characters",
                uniqueUserName: "This Username is taken already"
            }
        }
    });
}); 
```

* * *

## 回答 #3

> 赞同：71
> 
> 时间：2010-11-23T16:15:43.930

```
// add a method. calls one built-in method, too.
jQuery.validator.addMethod("optdate", function(value, element) {
        return jQuery.validator.methods['date'].call(
            this,value,element
        )||value==("0000/00/00");
    }, "Please enter a valid date."
);

// connect it to a css class
jQuery.validator.addClassRules({
    optdate : { optdate : true }    
}); 
```

* * *

## 回答 #4

> 赞同：52
> 
> 时间：2015-11-26T14:39:25.560

## 自定义规则和数据属性

您可以`data`使用语法创建自定义规则并将其附加到元素上`data-rule-rulename="true";`

因此，要检查是否至少选中了一组复选框中的一个：

**数据规则一或更多检查**

```
<input type="checkbox" name="colours[]" value="red" data-rule-oneormorechecked="true" /> 
```

**添加方法**

```
$.validator.addMethod("oneormorechecked", function(value, element) {
   return $('input[name="' + element.name + '"]:checked').length > 0;
}, "Atleast 1 must be selected"); 
```

您还可以使用语法 覆盖规则的消息*（即：必须选择至少 1 个）*`data-msg-rulename="my new message"`。

**笔记**

如果您使用该`data-rule-rulename`方法，则需要确保规则名称全部为小写。这是因为 jQuery 验证功能`dataRules`适用`.toLowerCase()`于比较，而[**HTML5**](http://www.w3.org/html/wg/drafts/html/master/dom.html#embedding-custom-non-visible-data-with-the-data-*-attributes)规范不允许大写。

**工作示例**

```
$.validator.addMethod("oneormorechecked", function(value, element) {
  return $('input[name="' + element.name + '"]:checked').length > 0;
}, "Atleast 1 must be selected");

$('.validate').validate();
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.14.0/jquery.validate.min.js"></script>

<form class="validate">
    red<input type="checkbox" name="colours[]" value="red" data-rule-oneormorechecked="true" data-msg-oneormorechecked="Check one or more!" /><br/>
    blue<input type="checkbox" name="colours[]" value="blue" /><br/>
    green<input type="checkbox" name="colours[]" value="green" /><br/>
    <input type="submit" value="submit"/>
</form>
```

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2008-10-28T15:03:41.263

谢谢，它奏效了！

这是最终的代码：

```
$.validator.addMethod("greaterThanZero", function(value, element) {
    var the_list_array = $("#some_form .super_item:checked");
    return the_list_array.length > 0;
}, "* Please check at least one check box"); 
```

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2016-06-01T08:09:21.377

您可以像这样添加自定义规则：

```
$.validator.addMethod(
    'booleanRequired',
    function (value, element, requiredValue) {
        return value === requiredValue;
    },
    'Please check your input.'
); 
```

并将其添加为这样的规则：

```
PhoneToggle: {
    booleanRequired: 'on'
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2018-01-03T09:28:13.280

对于这种情况：用户注册表单，用户必须选择未使用的用户名。

这意味着我们必须创建一个自定义的验证规则，它将向远程服务器发送异步 http 请求。

1.  在您的 html 中创建一个输入元素：

```
<input name="user_name" type="text" > 
```

2.  声明您的表单验证规则：

```
 $("form").validate({
    rules: {
      'user_name': {
        //  here jquery validate will start a GET request, to 
        //  /interface/users/is_username_valid?user_name=<input_value>
        //  the response should be "raw text", with content "true" or "false" only
        remote: '/interface/users/is_username_valid'
      },
    }, 
```

3.  远程代码应该是这样的：

```
class Interface::UsersController < ActionController::Base
  def is_username_valid
    render :text => !User.exists?(:user_name => params[:user_name])
  end
end 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-01-30T08:52:39.387

**第 1 步**包括类似的 CDN

```
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

     <script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/jquery.validate.min.js"></script> 
```

**第 2 步**代码喜欢

```
 $(document).ready(function(){
        $("#submit").click(function () {
              $('#myform').validate({ // initialize the plugin
                rules: {
                    id: {
                        required: true,
                        email: true
                    },
                    password: {
                        required: true,
                        minlength: 1
                    }
                },
                messages: {
                    id: {
                        required: "Enter Email Id"

                    },
                    password: {
                        required: "Enter Email Password"

                    }
                },
                submitHandler: function (form) { // for demo
                    alert('valid form submitted'); // for demo
                    return false; // for demo
                }
            });
       }):
  }); 
```

# c - 将 unicode 代码点转换为 UTF-8 的最简单方法

> ID：241148
> 
> 赞同：7
> 
> 时间：2008-10-27T19:34:12.297
> 
> 标签：c, unicode, utf-8

在 C 中将 Unicode 代码点转换为 UTF-8 字节序列的最简单方法是什么？想到的唯一方法是使用`iconv`从 UTF-32LE 代码页映射到 UTF-8，但这似乎有点矫枉过正。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-27T19:37:19.077

Unicode 转换不是一项简单的任务。对我来说，使用 iconv 似乎并不过分。也许有一个 iconv 的库版本可以用来避免进行 system() 调用，如果这是你想要避免的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-27T19:53:16.500

我可以建议[ICU](http://icu-project.org/)吗？这是处理 i18n 问题的合理“行业标准”方式。

我自己没有使用过 C 版本，但我怀疑[ucnv_fromUnicode](http://icu-project.org/apiref/icu4c/ucnv_8h.html#4a1f09772549fbcd7dd782297212c19f)可能是您所追求的功能。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-27T19:47:06.560

UTF8 通过将编码代码点的长度编码为编码字节的最高位来工作。见[http://en.wikipedia.org/wiki/UTF-8#Description](http://en.wikipedia.org/wiki/UTF-8#Description)

我在这里[http://www.deanlee.cn/programming/convert-unicode-to-utf8/](http://www.deanlee.cn/programming/convert-unicode-to-utf8/)在 C 中找到了这个小函数，但没有测试它。

# jquery - jQuery UI：过滤日期选择器上的可选日期

> ID：241150
> 
> 赞同：3
> 
> 时间：2008-10-27T19:34:26.880
> 
> 标签：jquery, datepicker

我想过滤日期选择器上的可选日期。我基本上需要按工作日过滤 - 即让假期和周末不可选。

我知道您可以使用 beforeShowDate: 中的函数指定日期，也可以使用 $.datepicker.noWeekends。

问题是：你可以两者都做吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-27T20:14:27.300

$.datepicker.noWeekends 是一段非常简单的代码：

```
function (date) { 
    var day = date.getDay(); 
    return [day > 0 && day < 6, ""]; 
} 
```

由于您将不得不为假期编写函数，因此您也可以在该函数中包含此逻辑。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T17:19:55.037

你能做相反的事情，输入哪些日期是可选的，而其余的都被过滤掉了吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-15T13:09:20.083

是的你可以。

即，如果您只希望用户能够选择星期一，您可以添加如下内容：

```
onlyMondays: function(date){
    var day = date.getDay();
    return [(day == 1), ""]
} 
```

# iphone - 处理子 UIScrollView 中的触摸事件

> ID：241152
> 
> 赞同：6
> 
> 时间：2008-10-27T19:34:41.920
> 
> 标签：iphone

我在 UIScrollView 中显示一系列图像。我非常想复制照片应用程序。

我目前的架构是：

*   一个父 UIScrollView，其内容大小足以容纳*x*个页面 + 一些额外的空间用于图像之间的边距。*   每个图像都包含在 UIImageView 中。*   每个 UIImageView 都包含在它自己的 UIScrollview 中，它们是父 UIScrollView 的子视图。

    所以我基本上在父 UIScrollView 中有一行 UIScrollViews。

    父 UIScrollView 启用了分页，因此我可以毫无问题地从一个页面滚动到另一个页面。

    问题是如何无缝平移放大的图像。当用户捏入/捏出时，我已经重写了`viewForZoomingInScrollView`返回适当 UIImageView 的方法。 如果缩放比例大于 1，我已经重写了`scrollViewDidEndZooming`将父视图的`canCancelContentTouches`属性设置为的方法。`NO`

    因此，用户可以平移图像。但是，在将触摸事件发送到子视图之前，他们必须按住手指片刻以克服父滚动视图的小延迟。此外，一旦用户在一个图像中平移，当用户到达当前图像的边界时，下一个/上一个图像不会进入可视区域。

    有任何想法吗？

    谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-06T19:20:32.200

耶！我试图只用一个 UIScrollView 来解决这个问题，我想我找到了解决方案。

在用户开始缩放之前（in `viewForZoomingInScrollView:`），我将滚动视图切换到缩放模式（删除所有其他页面，重置内容大小和偏移量）。当用户缩小到 1.00（in `scrollViewDidEndZooming:withView:atScale:`）时，我切换回分页视图（添加所有页面，调整内容大小和偏移量）。

Here's the code of a simple view controller that does just that. This sample switches between, zooms and pans three large UIImageViews.

Note that a single view controller with a handful of functions is all it takes, no need to subclass UIScrollView or something.

```
typedef enum {
    ScrollViewModeNotInitialized,           // view has just been loaded
    ScrollViewModePaging,                   // fully zoomed out, swiping enabled
    ScrollViewModeZooming,                  // zoomed in, panning enabled
    ScrollViewModeAnimatingFullZoomOut,     // fully zoomed out, animations not yet finished
    ScrollViewModeInTransition,             // during the call to setPagingMode to ignore scrollViewDidScroll events
} ScrollViewMode;

@interface ScrollingMadnessViewController : UIViewController <UIScrollViewDelegate> {
    UIScrollView *scrollView;
    NSArray *pageViews;
    NSUInteger currentPage;
    ScrollViewMode scrollViewMode;
}

@end

@implementation ScrollingMadnessViewController

- (void)setPagingMode {
    NSLog(@"setPagingMode");
    if (scrollViewMode != ScrollViewModeAnimatingFullZoomOut && scrollViewMode != ScrollViewModeNotInitialized)
        return; // setPagingMode is called after a delay, so something might have changed since it was scheduled
    scrollViewMode = ScrollViewModeInTransition; // to ignore scrollViewDidScroll when setting contentOffset

    // reposition pages side by side, add them back to the view
    CGSize pageSize = scrollView.frame.size;

    NSUInteger page = 0;
    for (UIView *view in pageViews) {
        if (!view.superview)
            [scrollView addSubview:view];
        view.frame = CGRectMake(pageSize.width * page++, 0, pageSize.width, pageSize.height);
    }

    scrollView.pagingEnabled = YES;
    scrollView.showsVerticalScrollIndicator = scrollView.showsHorizontalScrollIndicator = NO;
    scrollView.contentSize = CGSizeMake(pageSize.width * [pageViews count], pageSize.height);
    scrollView.contentOffset = CGPointMake(pageSize.width * currentPage, 0);

    scrollViewMode = ScrollViewModePaging;
}

- (void)setZoomingMode {
    NSLog(@"setZoomingMode");
    scrollViewMode = ScrollViewModeInTransition; // to ignore scrollViewDidScroll when setting contentOffset

    CGSize pageSize = scrollView.frame.size;

    // hide all pages besides the current one
    NSUInteger page = 0;
    for (UIView *view in pageViews)
        if (currentPage != page++)
            [view removeFromSuperview];

    // move the current page to (0, 0), as if no other pages ever existed
    [[pageViews objectAtIndex:currentPage] setFrame:CGRectMake(0, 0, pageSize.width, pageSize.height)];

    scrollView.pagingEnabled = NO;
    scrollView.showsVerticalScrollIndicator = scrollView.showsHorizontalScrollIndicator = YES;
    scrollView.contentSize = pageSize;
    scrollView.contentOffset = CGPointZero;

    scrollViewMode = ScrollViewModeZooming;
}

- (void)loadView {
    CGRect frame = [UIScreen mainScreen].applicationFrame;
    scrollView = [[UIScrollView alloc] initWithFrame:frame];
    scrollView.delegate = self;
    scrollView.maximumZoomScale = 2.0f;
    scrollView.minimumZoomScale = 1.0f;

    UIImageView *imageView1 = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@"red.png"]];
    UIImageView *imageView2 = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@"green.png"]];
    UIImageView *imageView3 = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@"yellow-blue.png"]];

    // in a real app, you most likely want to have an array of view controllers, not views;
    // also should be instantiating those views and view controllers lazily
    pageViews = [[NSArray alloc] initWithObjects:imageView1, imageView2, imageView3, nil];

    self.view = scrollView;
}

- (void)setCurrentPage:(NSUInteger)page {
    if (page == currentPage)
        return;
    currentPage = page;
    // in a real app, this would be a good place to instantiate more view controllers -- see SDK examples
}

- (void)viewDidLoad {
    scrollViewMode = ScrollViewModeNotInitialized;
    [self setPagingMode];
}

- (void)viewDidUnload {
    [pageViews release]; // need to release all page views here; our array is created in loadView, so just releasing it
    pageViews = nil;
}

- (void)scrollViewDidScroll:(UIScrollView *)aScrollView {
    [NSObject cancelPreviousPerformRequestsWithTarget:self selector:@selector(setPagingMode) object:nil];
    CGPoint offset = scrollView.contentOffset;
    NSLog(@"scrollViewDidScroll: (%f, %f)", offset.x, offset.y);
    if (scrollViewMode == ScrollViewModeAnimatingFullZoomOut && ABS(offset.x) < 1e-5 && ABS(offset.y) < 1e-5)
        // bouncing is still possible (and actually happened for me), so wait a bit more to be sure
        [self performSelector:@selector(setPagingMode) withObject:nil afterDelay:0.1];
    else if (scrollViewMode == ScrollViewModePaging)
        [self setCurrentPage:roundf(scrollView.contentOffset.x / scrollView.frame.size.width)];
}

- (UIView *)viewForZoomingInScrollView:(UIScrollView *)aScrollView {
    if (scrollViewMode != ScrollViewModeZooming)
        [self setZoomingMode];
    return [pageViews objectAtIndex:currentPage];
}

- (void)scrollViewDidEndZooming:(UIScrollView *)aScrollView withView:(UIView *)view atScale:(float)scale {
    NSLog(@"scrollViewDidEndZooming: scale = %f", scale);
    if (fabsf(scale - 1.0) < 1e-5) {
        if (scrollView.zoomBouncing)
            NSLog(@"scrollViewDidEndZooming, but zoomBouncing is still true!");

        // cannot call setPagingMode now because scrollView will bounce after a call to this method, resetting contentOffset to (0, 0)
        scrollViewMode = ScrollViewModeAnimatingFullZoomOut;
        // however sometimes bouncing will not take place
        [self performSelector:@selector(setPagingMode) withObject:nil afterDelay:0.2];
    }
}

@end 
```

Runnable sample project is available at [http://github.com/andreyvit/ScrollingMadness/](http://github.com/andreyvit/ScrollingMadness/) (if you don't use Git, just click Download button there). A README is available there, explaining why the code was written the way it is.

(The sample project also illustrates how to zoom a scroll view programmatically, and has ZoomScrollView class that encapsulates a solution to that. It is a neat class, but is not required for this trick. If you want an example that does not use ZoomScrollView, go back a few commits in commit history.)

P.S. For the sake of completeness, there's TTScrollView — UIScrollView reimplemented from scratch. It's part of the great and famous [Three20 library](http://github.com/joehewitt/three20/). I don't like how it feels to the user, but it does make implementing paging/scrolling/zooming dead simple.

P.P.S. The real Photo app by Apple has pre-SDK code and uses pre-SDK classes. One can spot two classes derived from pre-SDK variant of UIScrollView inside PhotoLibrary framework, however it is not immediately clear what they do (and they do quite a lot). I can easily believe this effect used to be harder to achieve in pre-SDK times.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-27T20:00:43.833

我必须进行类似的设置，但我基本上是自定义编写了整个内容。我不确定当您到达边缘时，您将如何解决从子 UIScrollView 到父 UISscrollView 的“移交”触摸事件的问题。您可以尝试在您的父 UIScrollView 中覆盖 UITouchesBegan:withEvent:，并直接转储给孩子。祝你好运！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-26T19:07:10.087

**This is the Andrey's code with c# translation for monotouch developers...** First you need to edit your xib file.. Insert 3 view controllers and make outlets like _page1, _page2, _mainpage.. and link these outlets with views. note you must referance to view controller's view outlet with _mainpage view. (sorry for my english)

```
 public partial class Test_Details_Controller : UIViewController
{
    private UIPageControl _pageCont;

    private UIScrollView _scView;
    private Object[] _pageViews;
    private int _currentPageIndex;        
    private bool _rotationInProgress;

    void InitializeAfterLoad ()
    { 

        this.Title = "Test";

        this._pageCont = CreatePageControll();

    }

    private UIPageControl CreatePageControll()
    {
        UIPageControl pageControll = new UIPageControl( new RectangleF( 146,348, 38, 20 ) );
        pageControll.BackgroundColor = UIColor.Red;
        pageControll.Alpha = 0.7f;

        return pageControll;
    }

    private void UpdatePageControll(UIPageControl cont, int current, int pages, UIView showed)
    {
        cont.CurrentPage = current;
        cont.Pages = pages;
        cont.UpdateCurrentPageDisplay();

        UIPageControl.AnimationsEnabled = true;
        UIPageControl.BeginAnimations(string.Empty, this.Handle);
        cont.Frame = new RectangleF(showed.Frame.Location.X 
                                        , cont.Frame.Location.Y , pageSize().Width, cont.Frame.Height);         
        UIPageControl.CommitAnimations();

    }

    private UIView loadViewForPage(int pageIndex){
        UIView _view = null;
        switch ( pageIndex ) {
        case 1:
            _view = this._page1;
        break;
        case 2:
            _view = this._page2;
        break;
        default:
            _view = this._page1;
        break;
        }
        return _view;
    }

    private int numberOfPages(){
        return (int)this._pageViews.Count();
    }

    private UIView viewForPage( int pageIndex ){
        UIView pageView;
        if(this._pageViews.ElementAt( pageIndex ) == null)
        {
            pageView = loadViewForPage( pageIndex );
            _pageViews[ pageIndex ] = pageView;
        }
        else{
            pageView = (UIView)_pageViews[ pageIndex ];
        }

        _scView.AddSubview( pageView );

        return pageView;                
    }

    private SizeF pageSize(){
        return this._scView.Frame.Size;
    }

    private bool isPageLoaded( int pageIndex ){
        return this._pageViews.ElementAt( pageIndex ) != null;
    }

    private void layoutPage( int pageIndex ){

        SizeF pageSize = this.pageSize();
        ((UIView)this._pageViews[pageIndex]).Frame = new RectangleF( pageIndex * pageSize.Width,0, pageSize.Width, pageSize.Height );
        this.viewForPage( pageIndex );  

    }

    private void loadView(){
        this._scView = new UIScrollView();
        this._scView.Delegate = new ScViewDelegate( this );
        this._scView.PagingEnabled = true;
        this._scView.ShowsHorizontalScrollIndicator = false;
        this._scView.ShowsVerticalScrollIndicator = false;
        this._scView.Layer.BorderWidth = 2;
        this._scView.AddSubview( _pageCont );
        this.View = this._scView;

    }

    public override void ViewDidLoad ()
    {
        base.ViewDidLoad ();
        InitializeAfterLoad ();
        this._pageViews = new Object[]{ _page1, _page2 };
        this.loadView();    
    }           

    private void currentPageIndexDidChange(){
        this.layoutPage( _currentPageIndex );

        if(_currentPageIndex+1 < this.numberOfPages()){
            this.layoutPage( _currentPageIndex + 1 );
        }
        if(_currentPageIndex >0){
            this.layoutPage( _currentPageIndex - 1 );
        }

        this.UpdatePageControll( _pageCont, _currentPageIndex, this.numberOfPages(), ((UIView)this._pageViews[_currentPageIndex]) );
        this._scView.BringSubviewToFront( _pageCont );

        this.NavigationController.Title = string.Format( "{0} of {1}", _currentPageIndex + 1, this.numberOfPages() );
    }

    private void layoutPages(){
        SizeF pageSize = this.pageSize();
        this._scView.ContentSize = new SizeF( this.numberOfPages() * pageSize.Width, pageSize.Height );
        // move all visible pages to their places, because otherwise they may overlap
        for (int pageIndex = 0; pageIndex < this.numberOfPages(); pageIndex++) {
            if(this.isPageLoaded( pageIndex ))
                this.layoutPage( pageIndex );
        }
    }

    public override void ViewWillAppear (bool animated)
    {
        this.layoutPages();
        this.currentPageIndexDidChange();
        this._scView.ContentOffset = new PointF( _currentPageIndex * this.pageSize().Width, 0 );
    }

    class ScViewDelegate : UIScrollViewDelegate
    {
        Test_Details_Controller id;
        public ScViewDelegate ( Test_Details_Controller id )
        {
            this.id = id;
        }
        public override void Scrolled (UIScrollView scrollView)
        {

            if(id._rotationInProgress)
                return;// UIScrollView layoutSubviews code adjusts contentOffset, breaking our logic

            SizeF pageSize = id.pageSize();
            int newPageIndex = ((int)id._scView.ContentOffset.X + (int)pageSize.Width / 2) / (int)pageSize.Width;
            if( newPageIndex == id._currentPageIndex )
                return;

            id._currentPageIndex = newPageIndex;
            id.currentPageIndexDidChange();
        }
    }

    public override bool ShouldAutorotateToInterfaceOrientation (UIInterfaceOrientation toInterfaceOrientation)
    {
        return toInterfaceOrientation != UIInterfaceOrientation.PortraitUpsideDown;
    }

    public override void WillRotate (UIInterfaceOrientation toInterfaceOrientation, double duration)
    {           
        _rotationInProgress = true;
        // hide other page views because they may overlap the current page during animation
        for (int pageIndex = 0; pageIndex < this.numberOfPages(); pageIndex++) {
            if(this.isPageLoaded( pageIndex ))
                this.viewForPage( pageIndex ).Hidden = ( pageIndex != _currentPageIndex );
        }
    }
    public override void WillAnimateRotation (UIInterfaceOrientation toInterfaceOrientation, double duration)
    {
    // resize and reposition the page view, but use the current contentOffset as page origin
    // (note that the scrollview has already been resized by the time this method is called)
        SizeF pageSize = this.pageSize();
        UIView pageView = this.viewForPage( _currentPageIndex );
        this.viewForPage( _currentPageIndex ).Frame = new RectangleF( this._scView.ContentOffset.X, 0, pageSize.Width, pageSize.Height );           
    }
    public override void DidRotate (UIInterfaceOrientation fromInterfaceOrientation)
    {
        base.DidRotate (fromInterfaceOrientation);

        // adjust frames according to the new page size - this does not cause any visible changes
        this.layoutPages();
        this._scView.ContentOffset = new PointF( _currentPageIndex * this.pageSize().Width, 0 );

        //unhide
        for (int pageIndex = 0; pageIndex < this.numberOfPages(); pageIndex++) {
            if( this.isPageLoaded( pageIndex ) )
                this.viewForPage( pageIndex ).Hidden = false;
        }

        _rotationInProgress = false;
    }               

    public override void DidReceiveMemoryWarning ()
    {
        //SuperHandle = DidReceiveMemoryWarning();
        if(this._pageViews != null)
        {
            // unload non-visible pages in case the memory is scarse
            for (int pageIndex = 0; pageIndex < this.numberOfPages(); pageIndex++) {
                if( pageIndex < _currentPageIndex - 1 || pageIndex > _currentPageIndex + 1 )
                    if( this.isPageLoaded(pageIndex) ){
                        UIView pageview = (UIView)this._pageViews[ pageIndex ];
                        this._pageViews[ pageIndex ] = null;
                        pageview.RemoveFromSuperview();
                    }
            }
        }
    }
    public override void ViewDidUnload ()
    {
        this._pageViews = null;
        this._scView = null;
    }       
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-05-21T13:17:29.640

I have a sample project and it works perfect.

[https://code.google.com/p/uiscrollview-touch-events/](https://code.google.com/p/uiscrollview-touch-events/)

# asp.net - “自动完成关闭”在 IE 中不起作用 - ASP.Net

> ID：241166
> 
> 赞同：5
> 
> 时间：2008-10-27T19:39:48.087
> 
> 标签：asp.net, internet-explorer, controls, autocomplete

问题： ASP 上的 Autocomplete=off 是否有任何原因：文本框在 IE 7 中不起作用？

如果这是最好的术语，IE 自动完成功能就是下拉列表，类似于从文本框中下拉的内容，并显示您过去输入的内容。

我需要 IE 自动完成功能此时不能用于作为用户控件的一部分的文本框，该控件的工作方式类似于 Ajax 自动完成控件。问题是，当 Ajax 自动完成选择列表出现时，IE 自动完成选择框也会出现。（在我可能双击文本框的情况下）我正在使用这个：

```
someTextbox.AutoCompleteType = AutoCompleteType.Disabled; 
```

但它仍然出现。我尝试从 IE 自动完成中删除这些项目，但下次我输入内容并按 Enter 时，问题再次出现。有任何想法吗？

注意：查看源代码时，文本框使用 Autocomplete=off 标签呈现。

注2：尝试过 someTextbox.Attributes.Add("autocomplete", "off"); 也没有成功

*** 更新，不久前想通了，但忘记了 ***

```
test.AutoCompleteType = AutoCompleteType.None; 
```

这确实有效。我不确定有什么区别。假设我会在某个时候查一下。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-27T19:48:22.063

尝试将 AUTOCOMPLETE="off" 也添加到您的表单标签中：

```
<form name="form1" id="form1" method="post" autocomplete="off"> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-14T14:06:40.893

试图清除我在原始帖子中回答的未回答的问题。

```
test.AutoCompleteType = AutoCompleteType.None; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-27T19:44:04.397

试试这个：

```
someTextbox.Attributes.Add("autocomplete", "off"); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-10T07:23:21.727

在页面加载

```
txtusername.AutoCompleteType = AutoCompleteType.Disabled; 
```

# php - PHP5 或替代方案中的沙箱建议？

> ID：241168
> 
> 赞同：1
> 
> 时间：2008-10-27T19:41:55.493
> 
> 标签：php, sandbox

我一直在慢慢地从事一个人事项目，以使用 extjs 作为我的前端来运行类似 webmud 的游戏。我做出的设计选择之一是允许用户为游戏逻辑生成评估代码。因此，当玩家进入一个新的“房间”时，会调用一些状态脚本，如“玩家以前来过这里吗，如果他们在这里，他们是否有 x 个库存物品”，然后做出相应的响应。此外，基本的房间“动作”将被硬编码（ go N/S/E/W ），但高级动作将作为相同的用户生成的评估脚本可用。

最初我打算偷懒并使用评估的 PHP 来处理这个逻辑，但我的偏执感正在发挥作用。所以我发现的两个替代方案是 runkit_sandbox，但它不支持主线程和沙箱之间的对象交换（只是简单的数据类型和数组）或者使用 ecmascript 作为我的游戏逻辑[http://ejohn.org/blog/spicing-up-embedded-javascript/](http://ejohn.org/blog/spicing-up-embedded-javascript/)。

两者的优缺点是，使用 runkit，我可以以极大的速度锁定脚本，而 ecma 解释器允许我有选择地将变量、函数和可能的对象绑定到 javascript 运行空间，但它的仍处于测试状态，我还没有看到它运行得如何。

这些是用于选择还是有其他我不知道的东西可能是更好的选择？环境：linux、PHP-CGI 5.3 或作为谷歌应用引擎。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-27T20:33:55.560

我不建议评估用户贡献的 PHP 代码——即使在 runkit 沙箱中也是如此。PHP 是一种非常复杂的语言，并且与它的环境密切相关。在不知道具体细节的情况下，我预计人们可以利用许多漏洞来突破沙箱。

除了 javascript，您还可以嵌入其他语言。[Lua](http://www.lua.org/)是这类事情的流行选择。[pecl](http://pecl.php.net/package/lua)中甚至还有一个php 扩展，并为其绑定。

如果您仍然要使用 runkit 路线，则可以研究共享内存解决方案，例如[memcache](http://docs.php.net/manual/en/book.memcache.php)，用于在进程之间交换数据。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-01-04T10:11:38.593

有一个 PHP 沙箱可用于基本的东西。这是早期阶段，但看起来很有希望。

[http://www.phpclasses.org/package/7015-PHP-Execute-external-PHP-scripts-in-a-separate-process.html](http://www.phpclasses.org/package/7015-PHP-Execute-external-PHP-scripts-in-a-separate-process.html)

或来自 GitHub： [https ://github.com/fregster/PHPSandbox](https://github.com/fregster/PHPSandbox)

保罗

# windows - 用于找出谁在锁定文件的命令行工具

> ID：241178
> 
> 赞同：67
> 
> 时间：2008-10-27T19:46:43.470
> 
> 标签：windows, command-line, locking

我想知道谁在锁定文件（win32）。我知道[WhoLockMe](http://www.dr-hoiby.com/WhoLockMe/)，但我想要一个或多或少做同样事情的**命令行工具。**

我也看了[这个问题](https://stackoverflow.com/questions/208283/is-it-possible-to-programatically-find-out-what-process-is-locking-a-file-acros)，但它似乎只适用于远程打开的文件。

* * *

## 回答 #1

> 赞同：101
> 
> 时间：2008-10-27T19:49:16.943

[手柄](http://technet.microsoft.com/en-us/sysinternals/bb896655.aspx)应该可以解决问题。

> 有没有想过哪个程序打开了特定的文件或目录？现在你可以找出答案了。Handle 是一个实用程序，它显示有关系统中任何进程的打开句柄的信息。您可以使用它来查看打开文件的程序，或查看程序所有句柄的对象类型和名称。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-10-27T19:49:25.230

handle.exe [http://technet.microsoft.com/en-us/sysinternals/bb896655.aspx](http://technet.microsoft.com/en-us/sysinternals/bb896655.aspx)

这帮助了我很多次......

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2015-05-04T05:48:06.107

下载句柄。

[https://technet.microsoft.com/en-us/sysinternals/bb896655.aspx](https://technet.microsoft.com/en-us/sysinternals/bb896655.aspx)

如果您想查找某个程序对某个文件有句柄，请从 Handle.exe 提取到的目录中运行它。除非您已将 Handle.exe 添加到`PATH`环境变量中。并且文件路径是 C:\path\path\file.txt"，运行这个：

```
handle "C:\path\path\file.txt" 
```

这将告诉您哪些进程锁定了文件（或文件夹）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-12-17T13:29:02.013

[![在此处输入图像描述](https://i.stack.imgur.com/0hBT7.png)](https://i.stack.imgur.com/0hBT7.png)

计算机管理->共享文件夹->打开文件

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-09-12T23:07:43.013

Handle 没有发现 WhatsApp 锁定了临时文件夹中的 .tmp.node 文件。ProcessExplorer - Find 效果更好看看这个答案[https://superuser.com/a/399660](https://superuser.com/a/399660)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2019-04-10T15:28:28.403

在我的情况下`Handle.exe`没有帮助。来自微软官方的名为[Process Explorer](https://docs.microsoft.com/en-us/sysinternals/downloads/process-explorer)的简单程序很有用。只需以管理员身份打开并按`Ctrl+f`，键入文件名的一部分，它将显示使用文件的进程。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-09-15T15:43:23.287

我已经使用[Unlocker](http://www.majorgeeks.com/files/details/unlocker.html)多年并且非常喜欢它。它不仅可以识别程序并提供解锁文件夹\文件，还可以让您终止具有锁定的处理。

此外，它还提供对相关锁定文件执行的操作，例如删除它。

> Unlocker 帮助删除带有错误消息的锁定文件，包括“无法删除文件”和“访问被拒绝”。提供视频教程。
> 
> Unlocker 可以帮助您解决的一些错误可能包括：
> 
> *   无法删除文件：访问被拒绝。
> *   存在共享冲突。
> *   源文件或目标文件可能正在使用中。
> *   该文件正被另一个程序或用户使用。
> *   确保磁盘未满或未写保护，并且文件当前未在使用中。

# java - 如何嵌套 Spring JMS MessageConverters

> ID：241185
> 
> 赞同：1
> 
> 时间：2008-10-27T19:48:30.677
> 
> 标签：java, spring, jms

我想编写一个可以包装另一个 MessageConverter 的 MessageConverter 类。此 MessageConverter 将调用子转换器，假定它生成一个 TextMessage。它将获取有效负载并 GZIP 压缩它，创建一个 BytesMessage 最终返回给发送者。

问题出在 fromMessage() 中。我可以将有效负载转换回字符串，但随后我想创建一个“虚拟”TextMessage 将字符串填充到然后传递给子 MessageConverter 的 fromMessage() 方法。在那里我碰壁了，因为我无法在没有 JMS 会话对象的情况下创建 TextMessage，而且似乎根本无法在这种情况下获得会话。

我可以创建额外的属性来将更多的东西连接到这个类，但看起来我什至不能轻松地从 JMSTemplate 对象获取会话，而且我无法想象我还需要什么。

我即将在此代码中创建一个私有 TextMessage 实现，只是为了为子 MessageConverter 包装一个字符串。该类将需要大量的虚拟方法来充实界面，所有这些打字都会让婴儿耶稣哭泣。

任何人都可以提出更好的方法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T06:16:04.853

您真的想将 MessageConverter 实例包装在其他 MessageConverter 实例中吗？MessageConverter 的全部意义在于将消息转换为其他内容（不是 JMS 消息）。它并不是真正设计为链接它们（每一步都制作一个虚假的 JMS 消息）。

为什么不直接介绍自己的界面

```
interface MessageBodyConverter {
  /** return a converted body of the original message */
  Object convert(Object body, Message originalMessage);
} 
```

然后，您可以创建一个调用其中之一的 MessageConverter（然后可以嵌套任意深度）

```
class MyMessageConverter implements MessageConverter {
  private final MessageBodyConverter converter;

  public Object fromMessage(Message message) {
    if (message instanceof ObjectMessage) {
       return converter.convert(objectMessage.getObject(), message);
    ...
  }
} 
```

然后，您可以尽可能多地链接这些 MessageBodyConverter 对象 - 加上您可以访问原始 JMS 消息（获取标头等），而不必尝试创建 Message 的伪（可能不符合 JMS）实现？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T23:19:50.560

所以，事实上，我做了其中之一：

```
 private static class FakeTextMessage implements TextMessage {
            public FakeTextMessage(Message m) { this.childMessage = m; }
            private String text;
            private Message childMessage;
            public void setText(String t) { this.text = t; }
            public String getText() { return this.text; }

            // All the rest of the methods are simply pass-through
            // implementations of the rest of the interface, handing off to the child message.
            public void acknowledge() throws JMSException { this.childMessage.acknowledge(); }
            public void clearBody() throws JMSException { this.childMessage.clearBody(); }
            public void clearProperties() throws JMSException { this.childMessage.clearProperties(); }
            public Enumeration getPropertyNames() throws JMSException { return this.childMessage.getPropertyNames(); }
            public boolean propertyExists(String pn) throws JMSException { return this.childMessage.propertyExists(pn); }

            // and so on and so on
    } 
```

让我渴望目标 C。这怎么可能？:)

# c# - Vista，Office 互操作不工作

> ID：241190
> 
> 赞同：3
> 
> 时间：2008-10-27T19:50:45.193
> 
> 标签：c#, interop, ms-office, office-2007

有谁知道如何让 MS Office 2007 .NET C# Interop 库与 Vista 一起使用？

我有一个已设置为作为 Windows 服务运行的 .NET C# 应用程序。该程序将根据情况打开一个 Word 或 Excel 模板并修改其内容，然后将文档保存回来。当我在使用 Office 2007 的 Windows Server 2003 或 XP 机器上执行此操作时，所有这些都非常有效。当我将所有内容移至 Server 2008 机器时，一切都停止工作了。例如，在 Excel 中，我收到一个 COM 异常，告诉我当文件明显存在时无法打开 Excel 文件，而我可以在手动打开它时很好地打开它。Windows 服务在我登录机器的同一用户帐户下运行，该帐户是管理员。

有谁知道该怎么做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-23T06:36:04.527

在 Vista 和 Windows Server 2008 上，服务在称为 Session0 的东西中运行。在 Vista 之前，常规程序将与服务一起在 Session0 中运行。

这意味着 Session0 已成为一个没有桌面的荒地，您的服务甚至无法访问 explorer.exe。我很确定问题在于 Office 应用程序期望能够访问通常在桌面上的一些组件。

由于 Excel、Word 等仅在桌面版会话中受支持，因此您只有几个选择：

1.  在您的服务属性的登录选项卡中设置桌面复选框，并祈祷它安抚办公室之神。（它可能不会。）
    *   尝试 1 后，检查您的代码并尝试删除/解决任何导致其崩溃的问题。
2.  使用远程处理/WCF 使执行互操作工作的服务器，并使您的服务与之通信。
    *   您需要有一个登录的交互式用户，并且该用户需要以某种方式启动服务器应用程序。也许最好使用自动启动。
    *   You can try turning on Automatic login. [http://support.microsoft.com/kb/324737](http://support.microsoft.com/kb/324737)
3.  Try impersonating a Logged in user using CreateProcessAsUser and friends.
    *   Note: I don't know how well this works unless a user is actually logged in, so it might not be any more useful than 2 above, and is much harder to pull off. (Needs P/Invoke)
4.  Rewrite your program to use the OpenXML sdk or use something like SpreadsheetGear.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T19:16:46.067

我确实从微软找到了一篇[有趣的文章](http://support.microsoft.com/default.aspx?scid=kb;EN-US;q257757#kb2)，基本上说不要做 Office 自动化。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T16:27:44.423

[从http://www.microsoft.com/downloads/details.aspx?FamilyID=59daebaa-bed4-4282-a28c-b864d8bfa513&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=59daebaa-bed4-4282-a28c-b864d8bfa513&displaylang=en)获取安装 程序

将它安装在您的系统上并在您的解决方案中引用 excel dll，希望它应该可以工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-30T19:44:27.957

您确实应该避免将 Office 客户端作为服务器端应用程序运行。考虑使用 xml 作为文件格式（Office 2007 使用 xlsx，或者（有些）旧版本使用 Excel 工作簿 xsd。）然后您就可以从使用服务器上的 Excel API 中解放出来。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-27T20:10:56.887

您是否在服务器上安装了主要的互操作程序集？这些通常位于 GAC 中，并且在您构建程序时不包含在 bin 目录中，因此需要将它们本地安装在服务器上。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-11T16:31:52.543

这只是一个猜测，但它可能是 UAC。我知道特权（管理员）应用程序和用户应用程序不能相互发送消息或以任何方式进行通信。您的服务以管理员身份运行，但您的桌面在 UAC 下以普通用户身份运行，即使他们是同一用户。我还希望 Office 在启动时已启动（预加载）自身的一部分，并且将作为普通用户运行。

尝试关闭 UAC，看看是否有帮助。如果是这样，至少你知道它是什么。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-11T20:14:47.633

你留下一个登录到机器的帐户吗？Office 不是服务器端应用程序，如果您尝试在没有桌面上下文的情况下启动任何可执行文件，您将收到随机错误。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-12T14:00:29.807

关于 Office 的一些事情要记住。它仅适用于 x86，因此如果您在 x64 中创建应用程序，您将无法访问 Office 底层 COM 对象。您需要在 x86 中编译您的应用程序，然后它才能工作。

您可以通过进入项目的属性，然后在 Visual Studio 的构建选项卡下选择 x86 来做到这一点。

这一切都假设您的应用程序正在 x64 环境中开发/运行。

# php - Windows 是否包含 PHP？

> ID：241193
> 
> 赞同：5
> 
> 时间：2008-10-27T19:51:45.693
> 
> 标签：php, windows, pecl

是否有用于[PHP](http://us2.php.net/manual/en/intro.inclued.php)的包含扩展的[.dll](http://t3.dotgnu.info/blog/php/messy-programmers-beware.html)版本？[PECL4WIN 上包含](http://pecl4win.php.net/ext.php/php_inclued.dll)的手册链接没有帮助。我没有编译器来构建我自己的 DLL。

注意：拼写“包括”是正确的！

编辑：我没有编译器，但确实认识有编译器的人......不过，这确实是最后的手段。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-27T20:12:48.973

据我所知，Windows 版本不再存在。也许之前维护它的人出于某种原因不得不停下来。

我想知道在 Windows 下编译 PECL 扩展需要什么。

* * *

**编辑**

[这是有关在 Windows](http://groups.google.co.uk/group/phpsoa/web/build-the-sca-sdo-pecl-extension)上编译不同 PECL 扩展的一些信息。您也许可以推断到包含的扩展名。

* * *

**编辑**

[WAMP 服务器](http://www.wampserver.com/en/)带有 PECL 和 PEAR。我实际上可以从 Windows 命令行运行命令**pecl install inclued-alpha**，它会出去并尝试从 PECL 站点获取包含的扩展名。

不幸的是，当它解压 .tgz 文件并尝试编译它时它死了

```
ERROR:  The DSP inclued.dsp does not exist. 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-28T11:50:52.853

您正在运行哪个版本的 PHP？我知道有人可以为您编译一个版本。

## 更新

好的，编译好了 - 我已经在我的 5.2.6 版本上进行了测试，它似乎工作正常。

我被告知在线程环境（例如 Windows）中使用它可能会出现问题，但这只是一个可能。还：

```
[13:10] <g0pz> the inclued dumpfiles will collide, because it uses PID # + increments
[13:11] <g0pz> but command line should work ok
[13:12] <g0pz> is the threaded apache version which'll have the same PID and well, a "possible" collision 
```

祝你好运:)

### [下载](http://www.uvshock.co.uk/php_inclued.dll)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T13:30:45.507

如果您对包含有任何问题，请戳我。

我即将发布一个版本，我将在 windows 中执行 mkstemp() 而不是选择 PID + 计数。

希望还有一个 gensvg.php，它将使用 pear::Image::GraphViz 在浏览器中呈现有向图。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-27T20:06:22.073

这不是他们的DLL下载站点吗？[http://pecl4win.php.net/list_dlls.php](http://pecl4win.php.net/list_dlls.php)

除非我停止浏览该网站？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-27T20:07:13.743

这是您要查找的页面吗？

[http://pecl4win.php.net/list_dlls.php](http://pecl4win.php.net/list_dlls.php)

..edit：（伙计，我们很快。我发誓这两个重复的答案是同时发布的）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-07-05T07:03:09.107

[Windows](http://windows.php.net/)的官方PHP网站说：

> **用于 Windows 的 PECL**
> 
> Windows 的 PECL 扩展正在开发中。pecl 网站上的界面很可能会更新为直接从该网站提供 Windows DLL 下载。同时，可以在 **[这里](http://downloads.php.net/pierre/)**找到一些扩展。

该“此处”链接指向[http://downloads.php.net/pierre/](http://downloads.php.net/pierre/)，在众多其他扩展中，您会发现包含 PHP 5.2 和 5.3、VC6 和 VC9、线程安全和非-线程安全。与我的 PHP 版本匹配的那个似乎正在工作。

# asp.net - GAC 会修复 ASP.NET/IIS6.0 System.OutOfMemoryException 吗？

> ID：241211
> 
> 赞同：2
> 
> 时间：2008-10-27T20:01:07.700
> 
> 标签：asp.net, exception, .net-2.0, iis-6, out-of-memory

我在同一应用程序池下的 IIS 6.0、Windows Server 2003 框中安装了许多应用程序实例。它们共享许多相同的程序集，并且不能加入到单个应用程序中。

我最近添加了一个新的应用程序实例，并在尝试加载 ASP.NET 2.0 应用程序时获得了 System.OutOfMemoryException。

使用 GAC 存储通用程序集会修复此错误，还是只能通过在不同应用程序池之间设置站点来解决此问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-27T20:04:38.193

将某些内容放入 GAC 只会更改 DLL 的物理位置（和安全设置），它不会更改加载到内存中的内容。

大多数人倾向于认为 GAC 是“微软放置他们的东西的地方”。我还没有看到很多由“其他人”创建的应用程序可以证明使用 GAC 是合理的。

您可能应该开始考虑一个负载平衡解决方案，因为您正在给您的机器施加如此大的 RAM 压力。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-03T18:00:24.537

确保您在 Machine.Config 中设置了部署零售 =“true”：

```
<system.web>
    <!--
        <deployment
            retail = "false" [true|false]
        />
    --> 
   <deployment retail="true" />
</system.web> 
```

调试代码比非调试代码占用更多的内存，并且编译成单个程序集而不是每页一个将减少程序集加载的内存开销。

确保您的应用程序池上的内存设置设置得足够高，并且您可能还想查看 ProcessModel MemoryLimit 设置：http: [//msdn.microsoft.com/en-us/library/7w2sway1 (VS .71).aspx](http://msdn.microsoft.com/en-us/library/7w2sway1(VS.71).aspx)

并尝试使用 80% 或 85% 设置：

```
<processModel 
  memoryLimit="80"
/> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-22T14:45:06.617

将共享程序集放入 GAC 可以节省驱动器空间，例如。如果您有 20 个使用相同 dll 的 asp 应用程序。可能是您将更少的相同 dll 副本加载到内存中，我不确定。也就是说，OutOfMemoryErrors 更有可能是由于将非常大的对象加载到内存中引起的，典型的例子是 DataSet。与内存中的大型数据集或大型 xml 文件所占用的内存相比，程序集很小。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-22T15:02:25.647

这发生在什么类型的请求上？您可能想[了解 OutOfMemoryExceptions 的这个常见原因](http://nathanaeljones.com/11081_Using_a_custom_VirtualPathProvider_can_cause_OutOfMemoryExceptions)。

# clearquest - ClearQuest 中有没有一种方法可以查询文档中包含的列表？

> ID：241212
> 
> 赞同：4
> 
> 时间：2008-10-27T20:02:28.167
> 
> 标签：clearquest

我有一个包含在 Word 文档中的缺陷 ID 编号列表，我想知道是否有办法在 ClearQuest 查询或 ClearQuest 中的 SQL 查询中使用该列表来将这些缺陷转移到新状态。我们说的可能是数百个缺陷中的数百个，所以我不想从所有缺陷中单独选择缺陷。

谢谢你。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-10-23T20:35:49.533

如果您可以使用 CQPerl，您可以轻松地在外部脚本中执行此操作。

读入数据，然后像这样循环遍历它：

```
foreach $id (@idList) {
    my $entity = $session->GetEntity('defect', $id);
    $session->EditEntity($entity, $action);
    my $validate = $entity->Validate();
    print "Validate results $validate.";
    $entity->Commit();
} 
```

如果您需要直接从 word 中阅读，可以在这里查看： [http ://www.wellho.net/solutions/perl-using-perl-to-read-microsoft-word-documents.html](http://www.wellho.net/solutions/perl-using-perl-to-read-microsoft-word-documents.html)

```
use Win32::OLE;
use Win32::OLE::Enum;

$document = Win32::OLE -> GetObject($ARGV[1]);
open (FH,">$ARGV[0]");

print "Extracting Text ...\n";

$paragraphs = $document->Paragraphs();
$enumerate = new Win32::OLE::Enum($paragraphs);
while(defined($paragraph = $enumerate->Next()))
    {
    $style = $paragraph->{Style}->{NameLocal};
    print FH "+$style\n";
    $text = $paragraph->{Range}->{Text};
    $text =~ s/[\n\r]//g;
    $text =~ s/\x0b/\n/g;
    print FH "=$text\n";
    } 
```

# c# - 需要在 Windows C#/.Net 中禁用屏幕保护程序/屏幕锁定

> ID：241222
> 
> 赞同：27
> 
> 时间：2008-10-27T20:08:05.893
> 
> 标签：c#, screensaver

对于特定的应用程序，我需要在运行时禁用屏幕保护程序。操作员可以手动将其关闭，然后再打开，但最简单的做法是在应用程序运行时保持屏幕保护程序处于关闭状态。

我该怎么做呢？我找到了使用 SPI_SETSCREENSAVEACTIVE 实际关闭屏幕保护程序的代码，但我认为这不是我想要的。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2010-09-17T23:16:11.697

**编辑 - 我在`SetThreadExecutionState`这里使用现代电源可用性请求 API（取代）有一个更新的答案：[https ://stackoverflow.com/a/63632916/67824](https://stackoverflow.com/a/63632916/67824)**

```
[FlagsAttribute]
public enum EXECUTION_STATE : uint
{
    ES_SYSTEM_REQUIRED = 0x00000001,
    ES_DISPLAY_REQUIRED = 0x00000002,
    // Legacy flag, should not be used.
    // ES_USER_PRESENT   = 0x00000004,
    ES_AWAYMODE_REQUIRED = 0x00000040,
    ES_CONTINUOUS = 0x80000000,
}

public static class SleepUtil
{
    [DllImport("kernel32.dll", CharSet = CharSet.Auto, SetLastError = true)]
    public static extern EXECUTION_STATE SetThreadExecutionState(EXECUTION_STATE esFlags);
}

public void PreventSleep()
{
    if (SleepUtil.SetThreadExecutionState(EXECUTION_STATE.ES_CONTINUOUS
        | EXECUTION_STATE.ES_DISPLAY_REQUIRED  
        | EXECUTION_STATE.ES_SYSTEM_REQUIRED 
        | EXECUTION_STATE.ES_AWAYMODE_REQUIRED) == 0) //Away mode for Windows >= Vista
        SleepUtil.SetThreadExecutionState(EXECUTION_STATE.ES_CONTINUOUS
            | EXECUTION_STATE.ES_DISPLAY_REQUIRED 
            | EXECUTION_STATE.ES_SYSTEM_REQUIRED); //Windows < Vista, forget away mode
} 
```

信用：[P/Invoke](http://www.pinvoke.net/default.aspx/kernel32/SetThreadExecutionState.html)，[死点](https://stackoverflow.com/questions/629240/prevent-windows-from-going-into-sleep-when-my-program-is-running/629286#629286)

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-08-23T13:59:39.477

[theoldnewthing](http://blogs.msdn.com/b/oldnewthing/archive/2009/08/20/9876113.aspx "Raymond Chen，新旧事物")有你的答案：使用[`SetThreadExecutionState(ES_DISPLAY_REQUIRED)`](http://msdn.microsoft.com/en-us/library/windows/desktop/aa373208(v=vs.85).aspx).

这由视频播放器和 PowerPoint 使用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-01-23T14:37:09.993

```
SetThreadExecutionState(EXECUTION_STATE.ES_CONTINUOUS
            | EXECUTION_STATE.ES_DISPLAY_REQUIRED 
            | EXECUTION_STATE.ES_SYSTEM_REQUIRED); 
```

## 这对 XP 没有帮助。

事实上，这个函数在不同的 Windows 版本之间是不能交叉操作的（尽管它在 Windows Vista 或更高版本中运行得很好）......在 Windows XP / 2003 中，这个函数应该用 ES_USER_PRESENT | 调用。ES_CONTINUOUS（都应该调用）...这将定期重置系统和显示空闲计时器...在其他 Windows 版本中，建议您使用 ES_SYSTEM_REQUIRED | ES_DISPLAY_REQUIRED | ES_CONTINUOUS | ES_AWAYMODE_REQUIRED...

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-27T20:12:01.487

带有 SPI_SETSCREENSAVEACTIVE 的 SystemParametersInfo 是执行此操作的正常方法。但是，它不会禁用屏幕锁定。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-03-15T12:32:39.217

尝试使您的表单最高值**正确**，它对我有用，即使在空闲时间之后屏幕保护程序也不会出现...

# asp.net - 在 ASP.NET web.config 文件中设置备份数据库服务器

> ID：241230
> 
> 赞同：3
> 
> 时间：2008-10-27T20:11:03.577
> 
> 标签：asp.net, sql-server, web-config, failover

我目前有一个托管在两个 Web 服务器上的 asp.net 网站，这些服务器位于 Cisco 负载均衡器后面。两个 Web 服务器引用一个 MSSQL 数据库服务器。

由于此数据库服务器是单点故障，因此我添加了一个额外的 MSSQL 服务器进行备份。我想设置我的 web.config 文件以将所有内容写入两个 MSSQL 服务器，但只能从“主”数据库服务器读取，除非由于某种原因无法访问，此时将使用备份 MSSQL 服务器。

这可以通过 web.config 文件设置实现，还是必须在代码中完成？提前感谢您的帮助。

新信息：在过去几天的研究之后，我只是想添加有关此主题的更多信息 - Microsoft TechNet 有一篇很好的文章标题“使用数据库镜像实现应用程序故障转移”（[http://www.microsoft.com/technet/ prodtechnol/sql/bestpractice/implappfailover.mspx#EMD](http://www.microsoft.com/technet/prodtechnol/sql/bestpractice/implappfailover.mspx#EMD)）。

这特别涵盖了 Microsoft SQL Server 2005 中的数据库镜像功能和新的“故障转移伙伴”连接字符串关键字，它允许您在单个连接字符串中指定两个服务器/数据库实例。

如果您对实现此类功能感兴趣，这篇文章非常值得一读。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-27T20:36:51.670

您想要的称为“故障转移”，如果一个数据库发生故障，您的查询将自动重定向到另一个。这是在数据库级别实现的，而不是应用程序。有很多设置故障转移集群的演练等：这里有一个用于[SQL 2000](http://www.microsoft.com/technet/prodtechnol/sql/2000/maintain/failclus.mspx)，另一个用于[SQL 2005](http://www.microsoft.com/downloads/details.aspx?FamilyID=818234dc-a17b-4f09-b282-c6830fead499&displaylang=en)。基本上，一旦设置好，主数据库就会将所有活动传递给辅助数据库。如果主服务器发生故障，则辅助服务器（几乎）是最新的并接管。

这些服务器形成一个集群，看起来像一个单一的单元——类似于负载平衡的 Web 服务器对外部世界的看法。备份监控主服务器，如果主服务器停止响应，备份将接管接收查询。如果您在谷歌搜索，请尝试添加关键字“数据库镜像”和“仲裁”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T20:28:39.377

它比那复杂一点。您的网页是否写入数据库？还是只是阅读？

如果他们写，那么您将不得不担心保持 2 个数据库同步，可能使用镜像或日志传送。

但是你（本质上）谈论的是建立一个 SQL 集群。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T00:51:48.690

我写了一篇博客文章，展示了如何设置 MSSQL 数据库镜像以及如何从托管代码的角度实际使用它： [http ://www.improve.dk/blog/2008/03/23/sql-server -镜像实用方法](http://www.improve.dk/blog/2008/03/23/sql-server-mirroring-a-practical-approach)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-31T11:48:42.917

“Rick”的回答很好，但我只想添加我的 2 美分信息。通常对于没有大量昂贵设备的故障转移设置，我会这样设置：

您可以让您的 2 个 SQL Server 盒子等待请求，并拥有第三个带有 SQL Server 2005 Express 的低端系统作为“健康监控”。为您节省 10K 美元的盒子和一个 SQL Server 许可证。SQL Server Express（与 Free 一样）可以毫无问题地在 2 个数据库服务器之间进行健康监控。

那是我的设置:)

# .net - 程序化远程应用安装

> ID：241234
> 
> 赞同：1
> 
> 时间：2008-10-27T20:12:15.370
> 
> 标签：.net, windows, deployment

Windows 和 .Net 框架中是否内置了任何东西，用于以编程方式远程安装和执行应用程序？即：用于远程软件部署的 API。我想构建一个工具，可以从一个中央管理工作站在一组新计算机上安装服务。

更新：计算机是内部 IT 网络的一部分，应用程序和服务大多是内部开发的。部署计划将完全是内部的，而不是商业销售。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-27T21:00:36.613

“我想构建一个工具，可以从一个中央管理工作站在一组新计算机上安装服务。”

其他想要构建僵尸网络以整天发送垃圾邮件的人也会如此。当然，您可能有*充分的*理由这样做。但是有一些安全方面的考虑使这变得不受欢迎且相当困难。

[从Microsoft 部署服务](http://technet.microsoft.com/en-us/library/cc546607.aspx)开始。

Microsoft 拥有广泛的[桌面部署](http://technet.microsoft.com/en-us/desktopdeployment/default.aspx)信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-02T11:24:09.267

我假设所有相关的计算机都是 XP Pro，是 AD 域的成员，并且在一家公司的控制下。这与我们在工作中的设置相同。我们使用组策略在成员计算机上设置防火墙配置，这会打开 DCOM 端口，因为它是允许“提供远程协助”工作所必需的。显然，我们的网络通过防火墙与 Internet 隔离，不允许此类流量进入！DCOM 端口还允许 WMI 远程执行。XP 还公开了管理共享（c$ 等），因此您可以将文件复制到 PC 上。如果您可以设置您的安装程序以便它可以在无人值守的情况下运行，那么您没有理由不能将它复制到远程计算机上然后运行它。然后，您还应该能够使用 WMI 远程启动该服务。

您应该先尝试组策略。我们在工作中使用它来进行多个软件部署并且它有效。不过，我们未能使其部署 .net 编写的服务，而且我们还为 .net 客户端应用程序提供了一个替代的内部系统，该系统在运行应用程序之前对其进行更新，所以我接受它有一些缺点。

我们目前正在推出 SCCM (SMS)，因此我无法评论它的能力，但如果您的组织能够负担得起，那么我预计它会比内部系统更好。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-03T00:55:08.037

*   PsExec 是一种穷人的方式，我用过很多次。
*   [Microsoft 部署工具包](http://technet.microsoft.com/en-us/desktopdeployment/default.aspx)具有用于部署应用程序的工具。它是免费的，但据我了解，还有很多东西要学。然而，这可能是一项明智的投资。
*   The most flexible way which wouldn't require a ton of work is to [assign MSIs using group policy](http://support.microsoft.com/kb/816102). You won't have to install extra software or think about how the bits get from one place to another.
*   There are a ton of third-party apps which, based on the size of your environment and your current IT infrastructure, may have added benefits beyond app deployment in adopting. You have System Center, Symantec Altiris, and plenty more.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-27T20:19:32.937

所有的部分都在那里（将文件复制到远程机器上，在远程机器上生成一个进程等）。您将看到相当多的编程来将它们组合成一个健壮的应用程序。您还需要确保客户端配置正确且安全。天真地配置客户端以允许您执行此操作很可能会在您的客户端计算机上出现大量安全漏洞。我建议查看 SMS 或许多类似的第三方应用程序之一。至少，即使您负担不起使用已经编写好的应用程序（强烈建议您这样做），您也可以查看他们的功能列表，以了解您需要考虑哪些类型的问题。

通过进一步提供的信息，我会问您是否在您的环境中使用组策略。如果您是，那么您可以将您的应用程序打包为 MSI，然后通过策略进行部署。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-28T03:30:56.530

根据您的需要，SysInternals 的[PsExec 程序](http://technet.microsoft.com/en-us/sysinternals/bb897553.aspx)可能适合您。文档说您不需要在其他计算机上安装任何东西。我在工作中使用它来启动远程机器上的构建过程。

# wpf - 无法从程序集 PresentationFramework 加载类型“System.Windows.Controls.Primitives.MultiSelector”

> ID：241236
> 
> 赞同：4
> 
> 时间：2008-10-27T20:12:41.610
> 
> 标签：wpf, xaml, datagrid, wpftoolkit

我正在尝试使用 WPFToolkit 中的 Grid，但出现错误：

```
DisplayDataMapping.xaml (9,89):
    errorMC1000: Unknown build error, 
    'Could not load type 'System.Windows.Controls.Primitives.MultiSelector' from assembly 
    'PresentationFramework, Version=3.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35'. Line 9 Position 89.' 
```

这是xaml：

```
    <UserControl x:Class="DisplayDataMapping"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:toolkit="http://schemas.microsoft.com/wpf/2008/toolkit">
        <StackPanel 边距="10">
            <Border CornerRadius="5" BorderThickness="1" Padding="5" BorderBrush="WhiteSmoke">
                <toolkit:DataGrid x:Name="dataGridPostings" 背景="透明"
                            AlternatingRowBackground="LightSteelBlue" RowBackground="白色"
                            GridLinesVisibility="无" Horizo​​ntalGridLinesBrush="SlateGray">
                </toolkit:DataGrid>
            </边框>
        </堆栈面板>
    </用户控制>

```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T06:19:35.550

WPF 工具包依赖于 .NET Framework 3.5 SP1（以防万一您还不知道）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T20:28:30.980

尝试安装VS08 SP1

# c# - 如何从 XmlNode 实例中获取 xpath

> ID：241238
> 
> 赞同：53
> 
> 时间：2008-10-27T20:12:45.883
> 
> 标签：c#, .net, xml, .net-2.0

有人可以提供一些代码来获取 System.Xml.XmlNode 实例的 xpath 吗？

谢谢！

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2008-10-27T20:35:17.477

好吧，我忍不住想试一试。它只适用于属性和元素，但是嘿......你能在 15 分钟内期待什么 :) 同样，很可能有一种更清洁的方式来做这件事。

在每个元素（尤其是根元素！）上包含索引是多余的，但它比尝试找出是否存在任何歧义更容易。

```
using System;
using System.Text;
using System.Xml;

class Test
{
    static void Main()
    {
        string xml = @"
<root>
  <foo />
  <foo>
     <bar attr='value'/>
     <bar other='va' />
  </foo>
  <foo><bar /></foo>
</root>";
        XmlDocument doc = new XmlDocument();
        doc.LoadXml(xml);
        XmlNode node = doc.SelectSingleNode("//@attr");
        Console.WriteLine(FindXPath(node));
        Console.WriteLine(doc.SelectSingleNode(FindXPath(node)) == node);
    }

    static string FindXPath(XmlNode node)
    {
        StringBuilder builder = new StringBuilder();
        while (node != null)
        {
            switch (node.NodeType)
            {
                case XmlNodeType.Attribute:
                    builder.Insert(0, "/@" + node.Name);
                    node = ((XmlAttribute) node).OwnerElement;
                    break;
                case XmlNodeType.Element:
                    int index = FindElementIndex((XmlElement) node);
                    builder.Insert(0, "/" + node.Name + "[" + index + "]");
                    node = node.ParentNode;
                    break;
                case XmlNodeType.Document:
                    return builder.ToString();
                default:
                    throw new ArgumentException("Only elements and attributes are supported");
            }
        }
        throw new ArgumentException("Node was not in a document");
    }

    static int FindElementIndex(XmlElement element)
    {
        XmlNode parentNode = element.ParentNode;
        if (parentNode is XmlDocument)
        {
            return 1;
        }
        XmlElement parent = (XmlElement) parentNode;
        int index = 1;
        foreach (XmlNode candidate in parent.ChildNodes)
        {
            if (candidate is XmlElement && candidate.Name == element.Name)
            {
                if (candidate == element)
                {
                    return index;
                }
                index++;
            }
        }
        throw new ArgumentException("Couldn't find element within parent");
    }
} 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-10-27T21:42:43.363

Jon 认为有任意数量的 XPath 表达式会在实例文档中产生相同的节点是正确的。构建明确产生特定节点的表达式的最简单方法是使用谓词中的节点位置的节点测试链，例如：

```
/node()[0]/node()[2]/node()[6]/node()[1]/node()[2] 
```

显然，这个表达式没有使用元素名称，但是如果你想要做的只是在文档中定位一个节点，你就不需要它的名称。它也不能用于查找属性（因为属性不是节点并且没有位置；您只能通过名称查找它们），但它会查找所有其他节点类型。

要构建此表达式，您需要编写一个方法来返回节点在其父节点的子节点中的位置，因为`XmlNode`它不会将其作为属性公开：

```
static int GetNodePosition(XmlNode child)
{
   for (int i=0; i<child.ParentNode.ChildNodes.Count; i++)
   {
       if (child.ParentNode.ChildNodes[i] == child)
       {
          // tricksy XPath, not starting its positions at 0 like a normal language
          return i + 1;
       }
   }
   throw new InvalidOperationException("Child node somehow not found in its parent's ChildNodes property.");
} 
```

（使用 LINQ 可能有一种更优雅的方式来做到这一点，因为`XmlNodeList`implements `IEnumerable`，但我在这里使用我所知道的。）

然后你可以写一个这样的递归方法：

```
static string GetXPathToNode(XmlNode node)
{
    if (node.NodeType == XmlNodeType.Attribute)
    {
        // attributes have an OwnerElement, not a ParentNode; also they have
        // to be matched by name, not found by position
        return String.Format(
            "{0}/@{1}",
            GetXPathToNode(((XmlAttribute)node).OwnerElement),
            node.Name
            );            
    }
    if (node.ParentNode == null)
    {
        // the only node with no parent is the root node, which has no path
        return "";
    }
    // the path to a node is the path to its parent, plus "/node()[n]", where 
    // n is its position among its siblings.
    return String.Format(
        "{0}/node()[{1}]",
        GetXPathToNode(node.ParentNode),
        GetNodePosition(node)
        );
} 
```

正如你所看到的，我也以某种方式破解了它来查找属性。

在我写我的版本时，乔恩偷偷加入了他的版本。他的代码有些地方现在会让我有点咆哮，如果这听起来像是我对乔恩的抨击，我提前道歉。（我不是。我很确定 Jon 必须向我学习的东西非常短。）但我认为我要说明的一点对于任何使用 XML 的人来说都是非常重要的。想一想。

我怀疑 Jon 的解决方案源于我看到许多开发人员所做的事情：将 XML 文档视为元素和属性的树。我认为这主要来自开发人员，他们主要使用 XML 作为序列化格式，因为他们习惯使用的所有 XML 都是以这种方式构建的。您可以发现这些开发人员，因为他们交替使用术语“节点”和“元素”。这导致他们提出将所有其他节点类型视为特殊情况的解决方案。（很长一段时间以来，我自己都是这些人中的一员。）

这感觉就像你在做的时候这是一个简化的假设。但事实并非如此。它使问题更难，代码更复杂。它引导您绕过`node()`专门设计用于通用处理所有节点类型的 XML 技术（如 XPath 中的函数）。

Jon 的代码中有一个危险信号，即使我不知道要求是什么，我也会在代码审查中查询它，那就是`GetElementsByTagName`. 每当我看到使用该方法时，脑海中浮现的问题总是“为什么它必须是一个元素？” 答案通常是“哦，这段代码也需要处理文本节点吗？”

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2013-08-12T10:25:59.783

我知道，旧帖子，但我最喜欢的版本（带有名称的版本）存在缺陷：当父节点具有不同名称的节点时，它会在找到第一个不匹配的节点名称后停止计算索引。

这是我的固定版本：

```
/// <summary>
/// Gets the X-Path to a given Node
/// </summary>
/// <param name="node">The Node to get the X-Path from</param>
/// <returns>The X-Path of the Node</returns>
public string GetXPathToNode(XmlNode node)
{
    if (node.NodeType == XmlNodeType.Attribute)
    {
        // attributes have an OwnerElement, not a ParentNode; also they have             
        // to be matched by name, not found by position             
        return String.Format("{0}/@{1}", GetXPathToNode(((XmlAttribute)node).OwnerElement), node.Name);
    }
    if (node.ParentNode == null)
    {
        // the only node with no parent is the root node, which has no path
        return "";
    }

    // Get the Index
    int indexInParent = 1;
    XmlNode siblingNode = node.PreviousSibling;
    // Loop thru all Siblings
    while (siblingNode != null)
    {
        // Increase the Index if the Sibling has the same Name
        if (siblingNode.Name == node.Name)
        {
            indexInParent++;
        }
        siblingNode = siblingNode.PreviousSibling;
    }

    // the path to a node is the path to its parent, plus "/node()[n]", where n is its position among its siblings.         
    return String.Format("{0}/{1}[{2}]", GetXPathToNode(node.ParentNode), node.Name, indexInParent);
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-08-09T16:37:45.000

这是我使用过的一种简单方法，对我有用。

```
 static string GetXpath(XmlNode node)
    {
        if (node.Name == "#document")
            return String.Empty;
        return GetXpath(node.SelectSingleNode("..")) + "/" +  (node.NodeType == XmlNodeType.Attribute ? "@":String.Empty) + node.Name;
    } 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-12-18T01:37:45.053

我的 10 便士价值是罗伯特和科里的答案的混合体。我只能为额外的代码行的实际输入要求功劳。

```
 private static string GetXPathToNode(XmlNode node)
    {
        if (node.NodeType == XmlNodeType.Attribute)
        {
            // attributes have an OwnerElement, not a ParentNode; also they have
            // to be matched by name, not found by position
            return String.Format(
                "{0}/@{1}",
                GetXPathToNode(((XmlAttribute)node).OwnerElement),
                node.Name
                );
        }
        if (node.ParentNode == null)
        {
            // the only node with no parent is the root node, which has no path
            return "";
        }
        //get the index
        int iIndex = 1;
        XmlNode xnIndex = node;
        while (xnIndex.PreviousSibling != null) { iIndex++; xnIndex = xnIndex.PreviousSibling; }
        // the path to a node is the path to its parent, plus "/node()[n]", where 
        // n is its position among its siblings.
        return String.Format(
            "{0}/node()[{1}]",
            GetXPathToNode(node.ParentNode),
            iIndex
            );
    } 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-27T20:19:00.300

没有节点的“the” xpath 这样的东西。对于任何给定的节点，很可能有许多 xpath 表达式将匹配它。

考虑到特定元素的索引等，您可能可以对树进行处理以构建与其匹配*的*表达式，但这不会是非常好的代码。

你为什么需要这个？可能有更好的解决方案。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-08-31T09:34:31.333

如果你这样做，你将得到一个带有节点名称和位置的路径，如果你有同名的节点，如下所示：“/Service[1]/System[1]/Group[1]/Folder[2 ]/文件[2]"

```
public string GetXPathToNode(XmlNode node)
{         
    if (node.NodeType == XmlNodeType.Attribute)
    {             
        // attributes have an OwnerElement, not a ParentNode; also they have             
        // to be matched by name, not found by position             
        return String.Format("{0}/@{1}", GetXPathToNode(((XmlAttribute)node).OwnerElement), node.Name);
    }
    if (node.ParentNode == null)
    {             
        // the only node with no parent is the root node, which has no path
        return "";
    }

    //get the index
    int iIndex = 1;
    XmlNode xnIndex = node;
    while (xnIndex.PreviousSibling != null && xnIndex.PreviousSibling.Name == xnIndex.Name)
    {
         iIndex++;
         xnIndex = xnIndex.PreviousSibling; 
    }

    // the path to a node is the path to its parent, plus "/node()[n]", where
    // n is its position among its siblings.         
    return String.Format("{0}/{1}[{2}]", GetXPathToNode(node.ParentNode), node.Name, iIndex);
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-09-27T02:18:44.310

我发现以上都不适用于`XDocument`，所以我编写了自己的代码来支持`XDocument`并使用递归。我认为这段代码比这里的一些其他代码更好地处理多个相同的节点，因为它首先尝试尽可能深入地进入 XML 路径，然后备份以仅构建所需的内容。因此，如果您有`/home/white/bob`并且`/home/white/mike`想要创建`/home/white/bob/garage`代码，那么您将知道如何创建它。但是，我不想弄乱谓词或通配符，所以我明确禁止使用它们；但是添加对它们的支持很容易。

```
Private Sub NodeItterate(XDoc As XElement, XPath As String)
    'get the deepest path
    Dim nodes As IEnumerable(Of XElement)

    nodes = XDoc.XPathSelectElements(XPath)

    'if it doesn't exist, try the next shallow path
    If nodes.Count = 0 Then
        NodeItterate(XDoc, XPath.Substring(0, XPath.LastIndexOf("/")))
        'by this time all the required parent elements will have been constructed
        Dim ParentPath As String = XPath.Substring(0, XPath.LastIndexOf("/"))
        Dim ParentNode As XElement = XDoc.XPathSelectElement(ParentPath)
        Dim NewElementName As String = XPath.Substring(XPath.LastIndexOf("/") + 1, XPath.Length - XPath.LastIndexOf("/") - 1)
        ParentNode.Add(New XElement(NewElementName))
    End If

    'if we find there are more than 1 elements at the deepest path we have access to, we can't proceed
    If nodes.Count > 1 Then
        Throw New ArgumentOutOfRangeException("There are too many paths that match your expression.")
    End If

    'if there is just one element, we can proceed
    If nodes.Count = 1 Then
        'just proceed
    End If

End Sub

Public Sub CreateXPath(ByVal XDoc As XElement, ByVal XPath As String)

    If XPath.Contains("//") Or XPath.Contains("*") Or XPath.Contains(".") Then
        Throw New ArgumentException("Can't create a path based on searches, wildcards, or relative paths.")
    End If

    If Regex.IsMatch(XPath, "\[\]()@='<>\|") Then
        Throw New ArgumentException("Can't create a path based on predicates.")
    End If

    'we will process this recursively.
    NodeItterate(XDoc, XPath)

End Sub 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-06-27T12:45:57.983

使用类扩展怎么样？;) 我的版本（建立在其他作品的基础上）使用语法 name[index]... 省略了索引是元素没有“兄弟”。获取元素索引的循环在独立例程（也是类扩展）之外。

任何实用程序类（或主程序类）中的以下内容

```
static public int GetRank( this XmlNode node )
{
    // return 0 if unique, else return position 1...n in siblings with same name
    try
    {
        if( node is XmlElement ) 
        {
            int rank = 1;
            bool alone = true, found = false;

            foreach( XmlNode n in node.ParentNode.ChildNodes )
                if( n.Name == node.Name ) // sibling with same name
                {
                    if( n.Equals(node) )
                    {
                        if( ! alone ) return rank; // no need to continue
                        found = true;
                    }
                    else
                    {
                        if( found ) return rank; // no need to continue
                        alone = false;
                        rank++;
                    }
                }

        }
    }
    catch{}
    return 0;
}

static public string GetXPath( this XmlNode node )
{
    try
    {
        if( node is XmlAttribute )
            return String.Format( "{0}/@{1}", (node as XmlAttribute).OwnerElement.GetXPath(), node.Name );

        if( node is XmlText || node is XmlCDataSection )
            return node.ParentNode.GetXPath();

        if( node.ParentNode == null )   // the only node with no parent is the root node, which has no path
            return "";

        int rank = node.GetRank();
        if( rank == 0 ) return String.Format( "{0}/{1}",        node.ParentNode.GetXPath(), node.Name );
        else            return String.Format( "{0}/{1}[{2}]",   node.ParentNode.GetXPath(), node.Name, rank );
    }
    catch{}
    return "";
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-11-14T21:50:09.727

我为 Excel 制作了 VBA 来为工作项目执行此操作。它输出 Xpath 的元组和来自元素或属性的关联文本。目的是让业务分析师识别和映射一些 xml。感谢这是一个 C# 论坛，但认为这可能很有趣。

```
Sub Parse2(oSh As Long, inode As IXMLDOMNode, Optional iXstring As String = "", Optional indexes)

Dim chnode As IXMLDOMNode
Dim attr As IXMLDOMAttribute
Dim oXString As String
Dim chld As Long
Dim idx As Variant
Dim addindex As Boolean
chld = 0
idx = 0
addindex = False

'determine the node type:
Select Case inode.NodeType

    Case NODE_ELEMENT
        If inode.ParentNode.NodeType = NODE_DOCUMENT Then 'This gets the root node name but ignores all the namespace attributes
            oXString = iXstring & "//" & fp(inode.nodename)
        Else

            'Need to deal with indexing. Where an element has siblings with the same nodeName,it needs to be indexed using [index], e.g swapstreams or schedules

            For Each chnode In inode.ParentNode.ChildNodes
                If chnode.NodeType = NODE_ELEMENT And chnode.nodename = inode.nodename Then chld = chld + 1
            Next chnode

            If chld > 1 Then '//inode has siblings of the same nodeName, so needs to be indexed
                'Lookup the index from the indexes array
                idx = getIndex(inode.nodename, indexes)
                addindex = True
            Else
            End If

            'build the XString
            oXString = iXstring & "/" & fp(inode.nodename)
            If addindex Then oXString = oXString & "[" & idx & "]"

            'If type is element then check for attributes
            For Each attr In inode.Attributes
                'If the element has attributes then extract the data pair XString + Element.Name, @Attribute.Name=Attribute.Value
                Call oSheet(oSh, oXString & "/@" & attr.Name, attr.Value)
            Next attr

        End If

    Case NODE_TEXT
        'build the XString
        oXString = iXstring
        Call oSheet(oSh, oXString, inode.NodeValue)

    Case NODE_ATTRIBUTE
    'Do nothing
    Case NODE_CDATA_SECTION
    'Do nothing
    Case NODE_COMMENT
    'Do nothing
    Case NODE_DOCUMENT
    'Do nothing
    Case NODE_DOCUMENT_FRAGMENT
    'Do nothing
    Case NODE_DOCUMENT_TYPE
    'Do nothing
    Case NODE_ENTITY
    'Do nothing
    Case NODE_ENTITY_REFERENCE
    'Do nothing
    Case NODE_INVALID
    'do nothing
    Case NODE_NOTATION
    'do nothing
    Case NODE_PROCESSING_INSTRUCTION
    'do nothing
End Select

'Now call Parser2 on each of inode's children.
If inode.HasChildNodes Then
    For Each chnode In inode.ChildNodes
        Call Parse2(oSh, chnode, oXString, indexes)
    Next chnode
Set chnode = Nothing
Else
End If

End Sub 
```

使用以下方法管理元素的计数：

```
Function getIndex(tag As Variant, indexes) As Variant
'Function to get the latest index for an xml tag from the indexes array
'indexes array is passed from one parser function to the next up and down the tree

Dim i As Integer
Dim n As Integer

If IsArrayEmpty(indexes) Then
    ReDim indexes(1, 0)
    indexes(0, 0) = "Tag"
    indexes(1, 0) = "Index"
Else
End If
For i = 0 To UBound(indexes, 2)
    If indexes(0, i) = tag Then
        'tag found, increment and return the index then exit
        'also destroy all recorded tag names BELOW that level
        indexes(1, i) = indexes(1, i) + 1
        getIndex = indexes(1, i)
        ReDim Preserve indexes(1, i) 'should keep all tags up to i but remove all below it
        Exit Function
    Else
    End If
Next i

'tag not found so add the tag with index 1 at the end of the array
n = UBound(indexes, 2)
ReDim Preserve indexes(1, n + 1)
indexes(0, n + 1) = tag
indexes(1, n + 1) = 1
getIndex = 1

End Function 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-05-18T14:23:32.823

您的问题的另一个解决方案可能是“标记”您以后要使用自定义属性标识的 xmlnodes：

```
var id = _currentNode.OwnerDocument.CreateAttribute("some_id");
id.Value = Guid.NewGuid().ToString();
_currentNode.Attributes.Append(id); 
```

例如，您可以将其存储在字典中。稍后您可以使用 xpath 查询来识别节点：

```
newOrOldDocument.SelectSingleNode(string.Format("//*[contains(@some_id,'{0}')]", id)); 
```

我知道这不是您问题的直接答案，但是如果您希望知道节点的 xpath 的原因是在您在代码中丢失对它的引用之后有一种“到达”节点的方式，它会有所帮助.

这也克服了文档添加/移动元素时的问题，这可能会弄乱 xpath（或索引，如其他答案中所建议的）。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-06-23T15:44:27.123

这更容易

```
 ''' <summary>
    ''' Gets the full XPath of a single node.
    ''' </summary>
    ''' <param name="node"></param>
    ''' <returns></returns>
    ''' <remarks></remarks>
    Private Function GetXPath(ByVal node As Xml.XmlNode) As String
        Dim temp As String
        Dim sibling As Xml.XmlNode
        Dim previousSiblings As Integer = 1

        'I dont want to know that it was a generic document
        If node.Name = "#document" Then Return ""

        'Prime it
        sibling = node.PreviousSibling
        'Perculate up getting the count of all of this node's sibling before it.
        While sibling IsNot Nothing
            'Only count if the sibling has the same name as this node
            If sibling.Name = node.Name Then
                previousSiblings += 1
            End If
            sibling = sibling.PreviousSibling
        End While

        'Mark this node's index, if it has one
        ' Also mark the index to 1 or the default if it does have a sibling just no previous.
        temp = node.Name + IIf(previousSiblings > 0 OrElse node.NextSibling IsNot Nothing, "[" + previousSiblings.ToString() + "]", "").ToString()

        If node.ParentNode IsNot Nothing Then
            Return GetXPath(node.ParentNode) + "/" + temp
        End If

        Return temp
    End Function 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2018-04-28T14:55:24.310

我最近不得不这样做。只有元素需要考虑。这就是我想出的：

```
 private string GetPath(XmlElement el)
    {
        List<string> pathList = new List<string>();
        XmlNode node = el;
        while (node is XmlElement)
        {
            pathList.Add(node.Name);
            node = node.ParentNode;
        }
        pathList.Reverse();
        string[] nodeNames = pathList.ToArray();
        return String.Join("/", nodeNames);
    } 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2017-06-29T08:26:54.937

```
 public static string GetFullPath(this XmlNode node)
        {
            if (node.ParentNode == null)
            {
                return "";
            }
            else
            {
                return $"{GetFullPath(node.ParentNode)}\\{node.ParentNode.Name}";
            }
        } 
```

# refactoring - 提出将桌面应用程序转换为客户端-服务器应用程序所需的时间/人员估算

> ID：241249
> 
> 赞同：2
> 
> 时间：2008-10-27T20:17:06.017
> 
> 标签：refactoring

我的老板正在投标一个项目，将桌面应用程序转换为作为客户端-服务器应用程序在线运行的应用程序。最初的应用程序有一百万行 C++ (MFC) 代码中的四分之一多一点，这些代码在引擎和前端之间没有明确划分。

我需要估算出这样一个项目需要多长时间以及需要多少人。我们没有任何员工有能力做这个项目，我们也没有任何 Windows 机器，所以我们不得不分包/外包。

或者，我可以用什么论据来说服我的老板这个项目是个坏主意？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-27T20:23:17.330

我需要很长时间，因为很可能，您将不得不更改语言。它基本上将是一个完整的重写。您甚至可以更好地定义旧系统的功能，然后从头开始重写，仅在需要复制业务逻辑时才参考旧代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T20:19:47.227

如果引擎和前端之间没有明确的划分，这是个坏主意。将代码交给承包商等需要大量培训才能理解代码，包括旨在重写为 Web 应用程序的部分。

您首先需要估计清楚定义该边界需要多长时间，然后您可以计算出项目的其余部分需要多长时间。这样，您可以在与表示层和引擎 API 相关的部分培训承包商等，而无需解释引擎的工作原理（这应该与表示组件无关）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-27T21:20:34.327

将信息提供给合格的顾问/外包商（例如，将其发送给我）并根据他们的估计考虑投资回报率

听起来你肯定没有能力在内部有效地做到这一点，但这并不意味着这是一个坏主意——这取决于投资回报率

例如，如果你的老板认为这件事可以在第一年产生 100 万美元的收入，而承包商可以在 6 个月内以 25 万美元的价格完成转换，那么投资回报率（18 个月内 300%）可能足以做到这一点

如果数字颠倒了，那显然是个坏主意；-)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T19:17:34.357

这听起来像是[COCOMO II](http://sunset.usc.edu/csse/research/COCOMOII/cocomo_main.html)的工作。COCOMO 已成功用于估计规模和成本以及人员规模，但这可能会很痛苦。这需要很多细节和时间。但它确实回答了如何估计项目规模、所需人数和所需时间的问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-09-28T19:58:09.643

正确估计这一点的唯一方法是将其提供给 1\. 将致力于此的人；2\. 理解它所使用的语言以及您要转换的语言。

无论如何，对没有经验的项目进行投标**总是**一个**坏主意。**每次我看到有人这样做时，他们的出价都大大降低。不仅在所需的工作量方面，而且在开始理解底层过程所必需的学习曲线方面。

尤其要注意在投标一个您没有经验的项目时明确告诉分包商他们完成项目的预算是多少。我再也不会在那种条件下工作了，因为 100% 的时间做投标的人都会弄错。

还有一件事，如果它是一个带有后端的桌面应用程序，那么它已经是客户端服务器......您的意思是将现有的客户端/服务器应用程序转换为 Web 应用程序吗？

# python - Django中的单表继承

> ID：241250
> 
> 赞同：34
> 
> 时间：2008-10-27T20:18:08.133
> 
> 标签：python, django, django-models, single-table-inheritance

Django 中是否明确支持单表继承？上次我听说，该功能仍在开发和辩论中。

是否有我可以同时使用的库/黑客来捕获基本行为？我有一个混合不同对象的层次结构。具有 Employee 类、员工类型的子类和 manager_id (parent_id) 的公司结构的典型示例将是我正在解决的问题的一个很好的近似值。

就我而言，我想代表一个员工可以管理其他员工同时由不同的员工管理的想法。Manager 和 Worker 没有单独的类，这使得它很难跨表传播。子类将代表员工的类型——程序员、会计师、销售等，并且独立于谁监督谁（好吧，我想它在某些方面不再是典型的公司）。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2020-03-27T21:54:23.090

## 概括

Django 的[代理模型](https://docs.djangoproject.com/en/3.0/topics/db/models/#proxy-models)为单表继承提供了基础。

但是，需要一些努力才能使其发挥作用。

跳到最后一个可重用的例子。

## 背景

[Martin Fowler](https://martinfowler.com/eaaCatalog/singleTableInheritance.html)对单表继承 (STI) 的描述如下：

> 单表继承将继承结构的所有类的所有字段映射到一个表中。

这正是 Django 的[代理模型继承](https://docs.djangoproject.com/en/3.0/topics/db/models/#proxy-models)所做的。

请注意，根据[2010 年的这篇博文](https://lincolnloop.com/blog/using-proxy-models-customize-django-admin/)，`proxy`模型自 Django 1.1 以来就已经存在。

一个“正常”的 Django 模型是一个*具体*的模型，即它在数据库中有一个专用的表。有两种类型的 Django 模型*没有*专用的数据库表，即。*抽象*模型和*代理*模型：

*   抽象模型充当具体模型的*超类*。抽象模型可以定义字段，但它没有数据库表。这些字段仅添加到其具体子类的数据库表中。

*   代理模型充当具体模型的*子类*。代理模型不能定义新字段。相反，它对与其具体超类关联的数据库表进行操作。换句话说，一个 Django 具体模型和它的代理都共享一个表。

Django 的代理模型为单表继承提供了基础，即。它们允许不同的模型共享一个表，并且它们允许我们在 Python 端定义代理特定的行为。但是，Django 的默认对象关系映射 (ORM) 并没有提供所有预期的行为，因此需要进行一些定制。多少，这取决于你的需求。

让我们根据下图中的简单数据模型逐步构建一个最小示例：

[![简单的当事人数据模型](https://i.stack.imgur.com/xiJOA.png)](https://i.stack.imgur.com/xiJOA.png)

## 第一步：基本的“代理模型继承”

以下`models.py`是基本代理继承实现的内容：

```
from django.db import models

class Party(models.Model):
    name = models.CharField(max_length=20)
    person_attribute = models.CharField(max_length=20)
    organization_attribute = models.CharField(max_length=20)

class Person(Party):
    class Meta:
        proxy = True

class Organization(Party):
    class Meta:
        proxy = True 
```

`Person``Organization`是两种类型的聚会。

只有`Party`模型有一个数据库表，所以*所有*字段都在这个模型上定义，包括特定于`Person`或 的任何字段`Organization`。

因为`Party`、`Person`和`Organization`都使用`Party`数据库表，所以我们可以为 定义一个`ForeignKey`字段`Party`，并将三个模型中的任何一个的实例分配给该字段，如图中的继承关系所示。请注意，如果没有继承，我们将需要`ForeignKey`为每个模型一个单独的字段。

例如，假设我们定义一个`Address`模型如下：

```
class Address(models.Model):
    party = models.ForeignKey(to=Party, on_delete=models.CASCADE) 
```

`Address`然后我们可以使用 eg`Address(party=person_instance)`或初始化一个对象`Address(party=organization_instance)`。

到现在为止还挺好。

但是，如果我们尝试获取与代理模型相对应的对象列表，使用 eg `Person.objects.all()`，我们将获得*所有* `Party`对象的列表，即`Person`对象和`Organization`对象。这是因为代理模型仍然使用超类（即`Party`）的模型管理器。

## 第 2 步：添加代理模型管理器

为了确保`Person.objects.all()`只返回`Person`对象，我们需要分配一个单独的[模型管理器](https://docs.djangoproject.com/en/3.0/topics/db/models/#proxy-model-managers)来过滤查询`Party`集。要启用此过滤，我们需要一个字段来指示应该为对象使用哪个代理模型。

需要明确的是：创建一个`Person`对象意味着向`Party`表中添加一行。也是如此`Organization`。为了区分这两者，我们需要一个列来指示一行是代表 a`Person`还是代表 a `Organization`。为了方便和清晰，我们添加了一个名为 的字段（即列）`proxy_name`，并使用它来存储代理类的名称。

因此，输入`ProxyManager`模型管理器和`proxy_name`字段：

```
from django.db import models

class ProxyManager(models.Manager):
    def get_queryset(self):
        return super().get_queryset().filter(proxy_name=self.model.__name__)

class Party(models.Model):
    proxy_name = models.CharField(max_length=20)
    name = models.CharField(max_length=20)
    person_attribute = models.CharField(max_length=20)
    organization_attribute = models.CharField(max_length=20)

    def save(self, *args, **kwargs):
        self.proxy_name = type(self).__name__
        super().save(*args, **kwargs)

class Person(Party):
    class Meta:
        proxy = True

    objects = ProxyManager()

class Organization(Party):
    class Meta:
        proxy = True

    objects = ProxyManager() 
```

现在返回的查询集`Person.objects.all()`将只包含`Person`对象（对于 也是如此`Organization`）。

`ForeignKey`但是，这在与 的关系的情况下不起作用`Party`，如上所述，因为无论字段的值如何，`Address.party`它总是会返回一个`Party`实例（另请参阅[docs](https://docs.djangoproject.com/en/3.0/topics/db/models/#querysets-still-return-the-model-that-was-requested)）。例如，假设我们创建一个，那么将返回一个实例，而不是一个实例。`proxy_name``address = Address(party=person_instance)``address.party``Party``Person`

## 第三步：扩展`Party`构造函数

处理相关字段问题的一种方法是扩展该`Party.__new__`方法，因此它返回“proxy_name”字段中指定的类的实例。最终结果如下所示：

```
class Party(models.Model):
    PROXY_FIELD_NAME = 'proxy_name'

    proxy_name = models.CharField(max_length=20)
    name = models.CharField(max_length=20)
    person_attribute = models.CharField(max_length=20)
    organization_attribute = models.CharField(max_length=20)

    def save(self, *args, **kwargs):
        """ automatically store the proxy class name in the database """
        self.proxy_name = type(self).__name__
        super().save(*args, **kwargs)

    def __new__(cls, *args, **kwargs):
        party_class = cls
        try:
            # get proxy name, either from kwargs or from args
            proxy_name = kwargs.get(cls.PROXY_FIELD_NAME)
            if proxy_name is None:
                proxy_name_field_index = cls._meta.fields.index(
                    cls._meta.get_field(cls.PROXY_FIELD_NAME))
                proxy_name = args[proxy_name_field_index]
            # get proxy class, by name, from current module
            party_class = getattr(sys.modules[__name__], proxy_name)
        finally:
            return super().__new__(party_class) 
```

如果字段为.Now`address.party`将实际返回一个`Person`实例。`proxy_name``Person`

作为最后一步，我们可以使整个东西可重用：

## 第 4 步：使其可重复使用

为了使我们基本的单表继承实现可重用，我们可以使用 Django 的抽象继承：

`inheritance/models.py`：

```
import sys
from django.db import models

class ProxySuper(models.Model):
    class Meta:
        abstract = True

    proxy_name = models.CharField(max_length=20)

    def save(self, *args, **kwargs):
        """ automatically store the proxy class name in the database """
        self.proxy_name = type(self).__name__
        super().save(*args, **kwargs)

    def __new__(cls, *args, **kwargs):
        """ create an instance corresponding to the proxy_name """
        proxy_class = cls
        try:
            field_name = ProxySuper._meta.get_fields()[0].name
            proxy_name = kwargs.get(field_name)
            if proxy_name is None:
                proxy_name_field_index = cls._meta.fields.index(
                    cls._meta.get_field(field_name))
                proxy_name = args[proxy_name_field_index]
            proxy_class = getattr(sys.modules[cls.__module__], proxy_name)
        finally:
            return super().__new__(proxy_class)

class ProxyManager(models.Manager):
    def get_queryset(self):
        """ only include objects in queryset matching current proxy class """
        return super().get_queryset().filter(proxy_name=self.model.__name__) 
```

然后我们可以实现我们的继承结构如下：

`parties/models.py`：

```
from django.db import models
from inheritance.models import ProxySuper, ProxyManager

class Party(ProxySuper):
    name = models.CharField(max_length=20)
    person_attribute = models.CharField(max_length=20)
    organization_attribute = models.CharField(max_length=20)

class Person(Party):
    class Meta:
        proxy = True

    objects = ProxyManager()

class Organization(Party):
    class Meta:
        proxy = True

    objects = ProxyManager()

class Placement(models.Model):
    party = models.ForeignKey(to=Party, on_delete=models.CASCADE) 
```

根据您的需要，可能需要做更多的工作，但我相信这涵盖了一些基础知识。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-11-12T08:25:21.663

我认为 OP 正在询问[此处定义](http://www.martinfowler.com/eaaCatalog/singleTableInheritance.html)的单表继承：

> 关系数据库不支持继承，所以当从对象映射到数据库时，我们必须考虑如何在关系表中表示我们良好的继承结构。当映射到关系数据库时，我们会尽量减少在处理多个表中的继承结构时可能快速安装的连接。单表继承将继承结构的所有类的所有字段映射到一个表中。

也就是说，实体类的整个层次结构的单个数据库表。Django 不支持这种继承。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-10-28T14:29:20.990

目前Django中有两种继承形式——MTI（模型表继承）和ABC（抽象基类）。

我写了一篇关于幕后发生的事情的[教程。](http://web.archive.org/web/20090227074910/http://thisweekindjango.com/articles/2008/jun/17/abstract-base-classes-vs-model-tab/)

您还可以参考[模型继承](http://docs.djangoproject.com/en/dev/topics/db/models/#model-inheritance)的官方文档。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-04-11T01:00:01.807

看看我的尝试：

[http://djangosnippets.org/snippets/2408/](http://djangosnippets.org/snippets/2408/)

> 在 Django 中模拟“每个层次结构的表”又名“单表继承”。基类必须包含所有字段。它的子类不允许包含任何额外的字段，最好它们应该是代理。

不完全是“单表继承”，但对于许多情况来说足够接近。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-03-05T00:28:58.310

我认为你可以做类似的事情。

我必须自己实现这个问题的解决方案，这就是我解决它的方法：

```
class Citrus(models.Model):
    how_acidic = models.PositiveIntegerField(max_value=100)
    skin_color = models.CharField()
    type = models.CharField()

class TangeloManager(models.Manager):
    def get_query_set(self):
        return super(TangeloManager, self).get_query_set().filter(type='Tangelo')

class Tangelo(models.Model):
   how_acidic = models.PositiveIntegerField(max_value=100)
   skin_color = models.CharField()
   type = models.CharField()
   objects = TangeloManager()

   class Meta:
       # 'appname' below is going to vary with the name of your app
       db_table = u'appname_citrus' 
```

这可能有一些锁定问题......我不太确定 django 是如何处理这个问题的。另外，我并没有真正测试上面的代码，这完全是为了娱乐目的，希望能让你走上正轨。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-02-02T12:31:11.727

这可能有用：[https](https://github.com/craigds/django-typed-models) ://github.com/craigds/django-typed-models 它看起来有点像单表继承的实现，但它的限制是子类不能有任何额外的字段。

这是最近关于 STI 的 django 开发者邮件列表的讨论： [https ://groups.google.com/forum/#!msg/django-developers/-UOM8HNUnxg/6k34kopzerEJ](https://groups.google.com/forum/#!msg/django-developers/-UOM8HNUnxg/6k34kopzerEJ)

# algorithm - 音乐表演中的元作曲

> ID：241257
> 
> 赞同：12
> 
> 时间：2008-10-27T20:20:23.497
> 
> 标签：algorithm, midi, composition

几周前，我和我的钢琴老师在元创作音乐软件方面相互交流。想法是这样的：

有一个系统从一堆乐器中获取 midi 输入，并将输出推送到扬声器和灯光。在这个系统上运行的软件会分析它获取的 MIDI 数据，并根据作曲家设置的触发器确定要使用的声音（当我在 2 秒内弹奏 F7 和弦 3 次时，从大键琴声音切换到钢琴声音)、踏板或音乐的实际实时分析。它将根据乐器的性能和声音以类似的方式控制灯光——音乐家只需要模糊地指定他们想要的东西——剩下的就是实时分析他们的演奏。动态生成的音乐也可以与音乐家一起演奏。本质上，该软件将与表演者一起演奏，一个指导另一个。

我是即兴爵士乐的忠实粉丝。其他艺术形式所缺乏的即兴表演的一个特点是它的时间性。一幅画可以在画完 10 年或 1000 年后被欣赏，但音乐（尤其是即兴音乐）是关于表演的，因为它是创作。我认为我描述的软件会大大增加表演，因为每次播放完全相同的乐曲都会导致完全不同的表演。

所以，现在回答问题。

我疯了吗？

是否存在执行任何或所有这些操作的软件？我做了一些研究，没有发现任何东西。这个系统的关键是它在演出期间运行。

如果我要写这样的东西，像 Python 这样的脚本语言会足够快来完成我需要的计算吗？大概它会在一个相当快的系统上运行，并且可以利用英特尔不断发布的 2^n 核心处理器。

你们中的任何人都可以分享有关与乐器和灯光等接口的经验和建议吗？

有什么想法或建议吗？冷酷严厉的批评？

感谢您花时间阅读本文，以及所有建议！（对于标签中的笑话，我无法抗拒。）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-27T20:45:15.770

人们使用[Max MSP](http://www.cycling74.com/products/max5)用 Midi 做这种事情并创建视频伴奏，或者只是 Midi 伴奏。这是一个完全针对特定领域的应用程序，可能是受到闲聊之类的启发，几乎没有真正的程序员会喜欢，但音乐家程序员喜欢。

尽管我刚刚链接到的网站上有文字，而且“每个人”都使用商业版本，但它并不总是商业产品。[Ircam](http://www.ircam.fr/)最终发布了它自己的[血统](http://freesoftware.ircam.fr/article.php3?id_article=5)。它被称为[jMax](http://freesoftware.ircam.fr/rubrique.php3?id_rubrique=14)。[PureData](http://puredata.info/)在这里的另一篇文章中提到是对该谱系的另一种重写。

还有 CSound；这并不意味着是实时的，但与 CSound 开始的地方相比，由于您拥有一台不错的计算机，因此很可能是实时的。

有些人还破解了 Macromedia Director 扩展，以允许在 Lingo 中进行 midi 操作……这已经过时了，因此其中一些人已经转移到[更现代](http://www.adobe.com/newsletters/edge/september2007/articles/article2/index.html)的Adob​​e 环境中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-27T20:42:40.020

看看[PureData](http://puredata.info/)。它可以进行广泛的 midi 分析，人们将其用于性能。

事实上，这是一个闪过纯数据屏幕的[视频。](http://www.liveleak.com/view?i=31d_1222611500)它显示有人使用 PD 与相当复杂的仪器进行交互。

另外，看看[CSounds](http://www.csounds.com/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-27T20:27:38.147

我已经非常广泛地使用 PyAudio 来处理原始音频输入，并且发现它非常不符合 Python 标准，更像是 C 代码上的一个*非常*薄的包装器。但是，如果您处理的是 midi，而不是原始波形，那么您的任务会简单得多，并且 python 应该足够快，除非您以每分钟 10000 拍的速度播放 :)

一些问题：检测同时性、谐波（形式化——即和弦结构）分析。

这也是一个 80/20 的问题，如果你限制允许的和弦进行，那么它会变得相当简单。毕竟，无论如何，“一起玩”是什么意思，对吧？

（另外，在我也去过的电子音乐会议上，有很多人根据输入的声音和动作进行各种实时伴奏实验）。祝你好运！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-30T05:18:00.027

您还可以查看[ChucK](http://chuck.cs.princeton.edu/)和[SuperCollider](http://supercollider.sourceforge.net/)，这两种最流行的“真实”实时音乐编程语言。

[此外，您可能会对使用Ableton Live](http://ableton.com)机架可以完成多少工作感到惊讶。

（它是 CSound。最后没有“s”）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-02T00:38:19.860

也可以看看：

*   [钥匙包](http://en.wikipedia.org/wiki/Keykit)
*   [阿尔克斯](http://gilesbowkett.blogspot.com/2008/02/archaeopteryx-ruby-midi-generator.html)

我不知道第二个是真的还是值得一看。然而，Keykit 是。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-02T01:43:14.677

您可以联系欧柏林[TIMRA 部门](http://timara.con.oberlin.edu/faculty.htm)的Gary Lee Nelson 。20 年前，我做了一个项目，可以自动生成 12 小节布鲁斯的节奏部分，我记得他描述了一个他知道的工具，基本上就是你所描述的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-02T02:58:31.043

您可能对[GenJam感兴趣](http://www.it.rit.edu/~jab/GenJam.html)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-04-10T16:18:00.907

你的问题的答案是否定的——你没有疯。存在类似的系统，但是您的描述一开始就很模糊，因此判断的规范并不多。

我建议你开始写一个原型，看看它是怎么做的。非常小而简单的东西。现有系统该死。

我在win32 api（没有mfc）上使用c++。开始在 Amiga500 上写回我的音序器。它不做灯光，但在音乐方面有很多事情要做。

祝你好运。这是一个非常有趣的项目。我会说-不要-将您的项目设计为其他项目的工作方式。因为，如果您问我，它们的工作效果并不好；）而且乐趣在于能够做一些不同的事情。

# email - 电子邮件测试方法

> ID：241269
> 
> 赞同：27
> 
> 时间：2008-10-27T20:26:54.543
> 
> 标签：email, testing, smtp

我正在编写一个程序，它将通过电子邮件发送许多（约 100 个）客户的报告，我想在向所有人发送垃圾邮件之前对其进行测试。

我想对我的生产数据进行测试运行并将消息实际发送到 SMTP 服务器，但我不希望 SMTP 服务器实际传递消息。从我的应用程序的角度来看，我希望服务器充当真正的 SMTP 服务器，但我不希望传递消息，而是希望它存储消息并记录发生的事情。

是否有专门为测试目的设计的 SMTP 服务器？

有谁知道配置 exim 或 postfix 的方法来表现得像我上面描述的那样

你用什么来测试群发邮件的传递？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-27T20:29:28.410

在java中你可以使用[dumbster](http://quintanasoft.com/dumbster/)

它易于使用，您可以验证您拦截的电子邮件的各个方面。

这是一个用于单元测试的 Java SMTP 服务器实现。（只要确保您将电子邮件重定向到运行笨蛋的机器......）

* * *

我刚刚找到了另一个几乎相同的替代方案：[Greenmail](http://www.icegreen.com/greenmail/)

Greenmail 还支持 POP3、带 SSL 的 IMAP，因此您可以针对它测试您的客户端。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-31T13:27:57.380

对于 .NET，我将配置文件设置为将邮件发送到文件夹，然后您可以让自动化测试检查目录和文件。

```
<system.net>
 <mailSettings>
  <smtp deliveryMethod="SpecifiedPickupDirectory">
   <specifiedPickupDirectory pickupDirectoryLocation="c:\pickupDirectory"/>
  </smtp>
 </mailSettings>
</system.net> 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-28T22:33:14.150

While searching for options I found the following that may be useful.

*   [DevNullSmtp](http://www.aboutmyip.com/AboutMyXApp/DevNullSmtp.jsp)
*   [Use a null SMTP server for testing](http://blog.componentoriented.com/?p=261)
*   [Fake SMTP Service](http://code.msdn.microsoft.com/fakesmtpservice)
*   [twisted examples/emailserver.tac](http://twistedmatrix.com/trac/browser/trunk/doc/mail/examples/emailserver.tac)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-08-28T11:50:31.670

一个很好的电子邮件测试程序是[smtp4dev](http://smtp4dev.codeplex.com/)（仅限 Windows）。

这是一个虚拟的 SMTP 服务器。位于系统托盘中，不传递收到的消息。可以快速查看、保存收到的消息并检查源/结构。

[http://smtp4dev.codeplex.com/](http://smtp4dev.codeplex.com/)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-07-06T03:07:19.950

“用于单元测试邮件的 Wiser 框架”

我听说其他一些开发人员从 Dumbster 迁移到 Wiser，并且也迁移了我的测试代码。我使用的其中一个 Java 组件每天发送数千封电子邮件，并且我使用 Dumbster 和 Wiser 为不同的电子邮件模板和场景编写了单元测试。我更喜欢威瑟。

来自 Wiser 网站 ( [http://code.google.com/p/subethasmtp/wiki/Wiser](http://code.google.com/p/subethasmtp/wiki/Wiser) ) 的片段：

Wiser 是 Dumbster 的智能替代品，构建在 SubEtha SMTP Java 库之上，它允许您的 Java 应用程序使用简单、易于理解的 API 接收 SMTP 邮件。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-27T20:30:47.923

[http://skaraarslan.blogspot.com/2008/02/how-to-check-email-works-without-using.html](http://skaraarslan.blogspot.com/2008/02/how-to-check-email-works-without-using.html)

（这假设您正在使用 .net 发送电子邮件）

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-27T20:56:00.353

鉴于您提到了 exim 和 postfix （我将其视为某种 unix 的东西），这个答案可能没有它应该的那么有用，但请查看[Neptune](http://donovanbrown.com/post/2008/10/20/Neptune.aspx)。这是一个为自动化测试而设计的假 SMTP 服务器。如果您有一个备用的 Windows 盒子，您可以将 Neptune 放在上面，然后配置您的应用程序以“通过”Neptune 服务器发送。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-01T01:11:02.930

Exim 可以配置为接受传入的邮件但不传递它们。在文档中查找关键字**queue_only**和**queue_only_file**。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-27T20:28:41.280

我亲自修改了电子邮件地址以进行测试，我将它们发送到我的一个虚拟帐户，这样我不仅可以验证它们是否发送，而且它们以正确的格式显示。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-27T20:50:10.427

在我的办公室，我们有一台服务器，它被设置为始终将所有收到的邮件发送到一个地址，而不管它实际发给谁。我们只需将所有测试环境指向该服务器，然后观察 QA 邮箱填满。我不知道它是什么服务器，但它可能是有人发现的一些开源东西。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-27T20:57:59.117

Sendmail 有一个测试模式。

您只需使用**-bt**参数调用 sendmail。举个例子：

`/usr/lib/sendmail -bt -Ciu-testconfiguration.cf`

请注意，在此方法中，Sendmail 需要对重写规则进行特殊配置。您需要了解 Sendmail 如何重写地址以便为测试模式正确创建 .cf 文件。

* * *

编辑：见这篇文章：[http ://ussg.iu.edu/usail/mail/debugging/](http://ussg.iu.edu/usail/mail/debugging/)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-11-28T14:06:55.837

在对找到的解决方案不满意后，我最终编写了[developmentSMTP](https://github.com/yankee42/developmentSMTP)，易于使用，100% Java --> 跨平台。

支持将电子邮件写入文件、转发电子邮件或简单地将它们打印到标准输出上。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-08-05T17:57:47.273

如果您希望手动测试电子邮件是否发送并且电子邮件模板具有您期望的正确类型的 html 和 css，那么我建议您使用 maildev [https://www.npmjs.com/package/maildev](https://www.npmjs.com/package/maildev)。您可以将其作为节点模块安装和运行，也可以作为 docker 容器安装和运行！我发现它对于电子邮件的基本健全性测试非常方便。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-07-24T22:23:43.807

Post Hoc is a pure Java application that looks exactly like an SMTP server to the application you are testing, but it simply collects all the email messages and allows you to inspect them using a web interface.

Freely available at: [Post Hoc GitHub Site](https://github.com/agilepro/posthoc)

For more information: [PostHoc: Testing Apps that Send Email](https://agiletribe.wordpress.com/2017/07/24/posthoc-testing-apps-that-send-email/)

# c++ - 构建 XML 文件时如何查看 IXMLDOMElementPtr 的内容？

> ID：241274
> 
> 赞同：3
> 
> 时间：2008-10-27T20:27:55.620
> 
> 标签：c++, xml, dom

我在 MSXML 6 中使用 IXMLDOM 在 C++ MFC 应用程序中构建 XML 文件。有没有办法在内存中查看 xml 文档的内容？

例如，XPATH 查询在创建文件的中途失败。我将如何查看 xml 文档的全部内容？

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-27T20:58:28.257

`IXMLDOMElement`派生自`IXMLDOMNode`，并且`IXMLDOMNode`具有`xml`可用于获取内存中 XML 的文本表示的属性。

```
IXMLDOMElementPtr spElement = ...;
_bstr_t xmlContents = spElement->xml(); 
```

如果您正在寻找一种在调试器中查看 XML 内容而不更改现有代码来添加此调用的方法，那可能是可能的，但我不确定在哪里查找。

# security - 基于 URL 的身份验证链接

> ID：241282
> 
> 赞同：3
> 
> 时间：2008-10-27T20:31:28.903
> 
> 标签：security, http, authentication, single-sign-on

有哪些好的建议或资源可以帮助我保护基于单击 URL 的身份验证？

本质上，这种情况是第三方系统通过浏览器接受 HTTPS 请求，您在浏览器中提供身份验证信息（un、pw、authkey 等）。然后，该服务在验证提供的凭据后，将允许或拒绝登录访问。关键是，如果有人点击链接，他们会自动获得访问该第三方系统的权限。

目前，整个过程并没有太多的安全措施（这没什么大不了的，因为该产品尚未投入生产），第三方愿意进行一些修改以确保这一点.

我已经确定我需要对信息进行哈希处理，甚至可能通过 POST 提交它，以防止它在浏览器历史记录中显示信息。但我想谈谈你们将如何处理这样的事情。

[编辑：请求将继续通过 HTTPS 发送。我还修改了以前使用的HTTP是HTTPS]

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-27T20:37:25.787

1.  不要考虑“稍微保护一下”。它要么从头开始就很安全，要么有漏洞，会让你付出高昂的代价。

2.  查看[HTTP Digest Authentication](http://en.wikipedia.org/wiki/Digest_access_authentication)。它简单、可靠并且在大多数情况下都能很好地工作。

3.  查看[OWASP.org](http://www.owasp.org/index.php/Category:OWASP_Top_Ten_Project)的前 10 个漏洞。确保你理解并解决每一个问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-27T20:40:05.877

您可能应该使用 HTTPS 来避免凭据在传输到第三方 Web 服务器时被窃听。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-09-30T14:03:40.817

保护自己不要使用陈旧的链接来访问应用程序。使链接依赖于当前时间值

# regex - 匹配正则表达式中的可选子字符串

> ID：241285
> 
> 赞同：56
> 
> 时间：2008-10-27T20:32:47.217
> 
> 标签：regex

我正在开发一种算法来解析一系列短字符串中的数字。这些字符串有些规则，但有一些不同的一般形式和几个例外。我正在尝试构建一组处理各种形式和异常的正则表达式；我会一个接一个地应用它们，看看我是否得到匹配。

其中一种形式是这样的：

```
X (Y) Z 
```

在哪里：

*   `X`是我要捕获的数字。
*   `Z`是静态的、预定义的文本。这基本上是我确定这种特定形式是否适用的方式。
*   `Y`是一个长度和内容未知的字符串，用括号括起来。

另外：`Y`是可选的；它并不总是出现在带有`Z`and的字符串中`X`。所以，我希望能够从所有这些字符串中提取数字：

*   `10 Z`
*   `20 (foo) Z`
*   `30 (bar) Z`

现在，我有一个正则表达式可以捕获第一个：

```
([0-9]+) +Z 
```

我的问题是我不知道如何构建一个匹配一系列字符的正则表达式，当且仅当它们被括在括号中时。这可以在一个正则表达式中完成吗？

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2008-10-27T20:39:53.690

```
(\d+)\s+(\(.*?\))?\s?Z 
```

请注意转义的括号和`?`（零或一次）量词。您不想捕获的任何组都可以是（`?:`非捕获组）。

我同意空间。`\s`那里是一个更好的选择。我还更改了量词以确保开头有数字。至于换行符，这将取决于上下文：如果文件被逐行解析，那将不是问题。另一种选择是锚定行的开头和结尾（`^`在前面添加 a，`$`在末尾添加 a）。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-10-27T20:52:33.620

这应该有效：

```
^\d+\s?(\([^\)]+\)\s?)?Z$ 
```

虽然还没有测试过，但是让我给你分解一下，所以如果还有任何错误，它们应该很容易找到：

首先是开头：

```
^ = beginning of string
\d+ = one or more decimal characters
\s? = one optional whitespace 
```

然后这部分：

```
(\([^\)]+\)\s?)? 
```

实际上是：

```
(.............)? 
```

这使得以下内容是可选的，只有当它完全存在时

```
\([^\)]+\)\s?

\( = an opening bracket
[^\)]+ = a series of at least one character that is not a closing bracket
\) = followed by a closing bracket
\s? = followed by one optional whitespace 
```

最后是由

```
Z$ 
```

在哪里

```
Z = your constant string
$ = the end of the string 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-27T20:36:16.443

你可以这样做：

```
([0-9]+) (\([^)]+\))? Z 
```

但是，这不适用于 Y 的嵌套括号。嵌套需要递归，它不再是严格规则的（但与上下文无关）。现代正则表达式引擎仍然可以处理它，尽管有一些困难（反向引用）。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-27T20:34:21.863

试试这个：

```
X (\(Y\))? Z 
```

# tfs - 有没有办法在 TFS 中跨项目链接工作项

> ID：241289
> 
> 赞同：8
> 
> 时间：2008-10-27T20:34:50.473
> 
> 标签：tfs

在 Team Foundation Server 中，有一种方法可以将一个项目中的工作项链接到其他项目，以便它们显示在两个项目的报告中。我们正在考虑将发布工程项目保留在他们自己的项目中，并希望它们也与他们实际支持的项目相关联。这可能吗？因此，例如，我将在发布工程下创建项目，将其分配给工程师，然后将其链接到产品 X，因此它也显示为项目 X 的​​工作项目。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2011-04-11T02:48:05.877

这至少在 TFS 2010 中是可能的：[将 tfs 工作项链接到不同的项目](https://stackoverflow.com/questions/4410083/link-tfs-work-item-to-different-project)

但不确定对报告的影响。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-27T20:36:26.960

不是开箱即用的，因为项目是离散的。然而，没有什么可以阻止您编写 API 来满足这一需求，尽管这需要一些相当大的工作。

现在是好消息。如果你把眼睛[留在这里](http://blogs.msdn.com/bharry/)，你可能会及时找到答案。正如我所见，跨项目报告计划在[罗萨里奥](http://blogs.msdn.com/bharry/archive/2008/09/29/shining-the-light-on-rosario.aspx)

# sql-server - SqlCacheDependecy 命令通知不起作用

> ID：241299
> 
> 赞同：0
> 
> 时间：2008-10-27T20:36:53.807
> 
> 标签：sql-server, linq-to-sql, caching

我一直在尝试让 sqlcachedependecy 工作，但它似乎不起作用

我在我的 web.config 和 global.asa 中得到了正确的设置，但是当我运行这个查询并且从网站内部或外部对数据库进行更改时，缓存的对象没有更新，请有人帮忙吗？我知道这不是因为此查询正在查询视图，因为我使用直接 SqlDependecy 进行了测试，并且通知工作正常。

```
 public IQueryable<VictoryList> GetVictoryList()
   {
                string cacheKey = HttpContext.Current.User.Identity.Name + "victoryCacheKey";
                IQueryable<VictoryList> cachednews = (IQueryable<VictoryList>)HttpContext.Current.Cache.Get(cacheKey);

                if (cachednews == null)
                {

                    var results = from v in _datacontext.ViewVictoryLists
                                  orderby _datacontext.GetNewId()
                                  select new VictoryList
                                  {
                                      MemberID = v.MemberID,
                                      Username = v.Aspnetusername,
                                      Location = v.Location,
                                      DaimokuGoal = v.DaimokuGoal,
                                      PreviewImageID = v.PreviewImageID,
                                      TotalDaimoku = v.TotalDaimoku,
                                      TotalDeterminations = v.TotalDeterminations,
                                      DeterminationID = v.DeterminationID,
                                      DeterminationName = v.DeterminationName
                                  };
                    results = results.ToList().AsQueryable();
                    SqlCacheDependencyAdmin.EnableNotifications(_datacontext.Connection.ConnectionString);
                    SqlCacheDependency dependency =
                     new SqlCacheDependency(_datacontext.GetCommand(results) as SqlCommand);

                    HttpContext.Current.Cache.Insert(cacheKey, results, dependency);

                    return results;
                }
                return cachednews;
   } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-27T23:44:16.067

根据规定的创建通知查询的限制，列在[msdn](http://msdn.microsoft.com/en-us/library/ms181122.aspx) ...

该语句不得引用视图。

# svn - Web Subversion 存储库浏览工具，有一个转折

> ID：241301
> 
> 赞同：4
> 
> 时间：2008-10-27T20:37:27.177
> 
> 标签：svn, browser, repository

我看到很多关于 Web SVN 存储库浏览工具的问题。但是，在我看过的那些中，它们要么需要配置特定的用户名/密码，要么依赖对可用存储库的默认访问权限，要么需要 Subversion 之外的单独用户数据库。

在公司环境中，SVN 存储库管理员可能会锁定存储库，以便没有“访客”或“匿名”帐户可以访问。如果他们使用域用户名/密码来访问这些，那么将真实用户的身份验证详细信息嵌入到这样的配置文件中并不是一个好主意。

是否有一个 Subversion 存储库浏览器从用户那里获取用户名/密码信息并使用它来验证代表他们发出的任何 SVN 请求？

编辑：我应该声明我们已经*有*一个通过经过身份验证的 HTTPS 提供的 SVN 存储库。我们通过 TortoiseSVN 和 Subclipse 等厚客户端访问它。我正在寻找一个基于 Web 的客户端，它提供对以前的修订、差异等的浏览，但它不需要预先配置的身份验证信息来连接到存储库。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-27T20:41:58.507

SVN 实际上可以通过 Apache 提供服务并允许 LDAP 身份验证。我以前设置过这个。

有一个预先打包的 Windows 管理单元，类似于服务器，它与称为 VisualSVN 的 SVN 版本保持同步，这基本上是一个 SVN 存储库，通过构建 LDAP 模块的 apache 包装器提供服务。

[http://blogs.open.collab.net/svn/2007/03/subversion_ldap.html](http://blogs.open.collab.net/svn/2007/03/subversion_ldap.html)

[http://www.visualsvn.com/](http://www.visualsvn.com/)

这将使您不必在 SVN 中维护凭据。至少密码。

我必须注意，VisualSVN **Server**是免费软件，不需要许可

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-04T00:49:25.240

ViewVC 1.1.x，支持 Subversion authz 规则。最新版本的 ViewVC 包含在 CollabNet Subversion Edge 中。如果您安装 Subversion Edge，则会有一个 Web UI 来编辑 Subversion authz 规则，并且 Subversion 服务器和 ViewVC 都配置为使用这些相同的规则。因此，您无需在配置方面做任何事情，您甚至可以从 Web 浏览器编辑文件。

如果您想自己配置 ViewVC，您只需要安装它并配置 viewvc.conf 文件，使其指向您的 authz 规则。文件中的注释为您指明了正确的方向。

在此处获取 ViewVC：

[http://www.viewvc.org/](http://www.viewvc.org/)

在此处获取 Subversion Edge（包括 Apache、Subversion 和 ViewVC）：

[http://www.open.collab.net/products/subversion/getit.html](http://www.open.collab.net/products/subversion/getit.html)

标记

# java - java消息包 - 使用变体时的属性文件命名约定？

> ID：241306
> 
> 赞同：1
> 
> 时间：2008-10-27T20:39:22.663
> 
> 标签：java, locale

使用变体时消息包属性文件的命名约定是什么？

例如，如果语言环境是 EN US，则属性文件查找将是

message_en_US.properties

但是，如果我实例化一个本地 EN US 虽然变体字符串是“DEVL”

搜索顺序是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-27T22:12:10.540

[API](https://docs.oracle.com/javase/10/docs/api/java/util/ResourceBundle.html)建议如下：

```
baseName + "_" + language1 + "_" + country1 + "_" + variant1 
```

# php - 在 PHP 中通过引用传递数据库连接

> ID：241311
> 
> 赞同：12
> 
> 时间：2008-10-27T20:41:27.247
> 
> 标签：php, mysql, database

问题是数据库连接应该通过引用还是按值传递？

对我来说，我特别质疑 PHP 到 MySQL 的连接，但我认为它适用于所有数据库。

我听说在 PHP 中，当您将变量传递给函数或对象时，它会被复制到内存中，因此会立即使用两倍的内存。我还听说只有在对值进行更改后才复制它（例如从数组中添加/删除键）。

在数据库连接中，我认为它在函数中被更改，因为查询可能会更改最后插入 id 或 num 行之类的内容。（我想这是另一个问题：是像 num rows 和 insert id 这样的东西存储在连接中还是实际调用回数据库？）

那么，如果连接是通过引用或值传递的，内存或速度是否重要？PHP 4 和 5 有区别吗？

```
// $connection is resource
function DoSomething1(&$connection) { ... }
function DoSomething2($connection) { ... } 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-27T20:58:06.090

PHP 资源是一种特殊的类型，它本身就是一个引用。通过值或通过引用显式传递它不会产生影响（即，它仍然是一个引用）。你可以在 PHP4 下自己检查：

```
function get_connection() {
  $test = mysql_connect('localhost', 'user', 'password');
  mysql_select_db('db');
  return $test;
}

$conn1 = get_connection();
$conn2 = get_connection(); // "copied" resource under PHP4

$query = "INSERT INTO test_table (id, field) VALUES ('', 'test')";
mysql_query($query, $conn1);
print mysql_insert_id($conn1)."<br />"; // prints 1

mysql_query($query, $conn2);
print mysql_insert_id($conn2)."<br />"; // prints 2

print mysql_insert_id($conn1); // prints 2, would print 1 if this was not a reference 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-27T20:49:04.860

调用时传递引用正在贬值，所以我不会使用首先描述的方法。另外，一般来说，资源在 PHP 5 中默认是通过引用传递的。因此，不应要求提供任何引用，并且除非您确实需要它，否则您永远不应打开多个数据库连接。

就我个人而言，我为我的数据库连接使用了一个单例工厂类，每当我需要一个数据库引用时，我只需调用 Factory::database()，这样我就不必担心多个连接或传递/接收引用。

```
<?php
Class Factory
{
  private static $local_db;

/**
* Open new local database connection
*
* @return MySql
*/
public static function localDatabase() {
    if (!is_a(self::$local_db, "MySql")) {
        self::$local_db = new MySql(false);
        self::$local_db->connect(DB_HOST, DB_USER, DB_PASS, DB_DATABASE);
        self::$local_db->debugging = DEBUG;
    }
    return self::$local_db;
}
}
?> 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-27T22:35:12.710

您应该关心的不是速度，而是内存。

在 PHP 4 中，数据库连接和结果集之类的东西应该通过引用显式传递。在 PHP 5 中，这是自动完成的，因此您不必明确说明。

顺便说一句，用于创建数据库句柄的单例方法是一个好主意：您可以这样做`$db = & Database::Connection();`并且始终获得正确的句柄。这使您免于使用全局，并且静态方法可以为您做额外的魔法（比如自动打开它）。当你的应用程序扩展到需要多个数据库时要小心：那么你的魔法函数将必须知道如何把正确的返回给你。IME 这不是很困难；解决这个问题的基本方法是代码层需要数据库句柄知道如何请求正确的句柄。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-27T20:58:50.737

数据库*连接*实际上并不保存基础值，因此您不必担心丢失函数内部所做的分配。打个比方，您可以将 DB*连接*视为跑道号——“OK，DB 连接 12 已被清除以用于查询”——查询和结果集*使用*该连接，并且可能需要独占访问一段时间，但连接对底层数据一无所知。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-27T22:34:57.033

一些人说过，对于 PHP 5，您无需担心这一点。这是不正确的，如果您有一个用于所有访问的数据库 OBJECT。在这种情况下，您确实需要通过引用传递，否则它会实例化一个新的 DB 对象，该对象（通常）会创建与数据库的新连接。

我使用 XDebug 和 WinCacheGrind 发现了这一点，它友好地显示了所有被调用的析构函数——在我的例子中，是六个或更多的数据库对象。

澄清一下：我指出这一点的原因是这是使用数据库连接而不是原始连接资源的常用方式。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-27T20:49:35.933

我对 php 并没有真正的具体答案，但总的来说，如果您不确定在按值传递时遇到性能问题，您可能希望通过引用传递它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-27T22:11:35.533

一般来说，引用在 PHP 中并不快。这是一个常见的误解，因为它们在语义上与 C 指针相似，所以熟悉 C 的人通常认为它们的工作方式相同。不是这样。实际上，引用比副本慢一点，除非您实际分配给变量（无论如何这都是不好的样式，除非变量是对象）。

PHP 有一种称为 copy-on-write 的机制，这意味着变量在需要之前*实际上并没有被复制。*您可以将巨大的数据结构传递给函数；只要它只是从中读取，就没有区别。然而，引用需要在内部寄存器中添加一个额外的条目，因此它实际上需要一些额外的处理（虽然几乎不明显）。

# regex - 颜色正则表达式匹配 - 不丢失

> ID：241325
> 
> 赞同：21
> 
> 时间：2008-10-27T20:46:45.970
> 
> 标签：regex, linux

使用时，`grep --color=always`我可以为正则表达式匹配获得漂亮的颜色突出显示。

但是，`grep`只返回至少有一个匹配的行。相反，我正在寻找一种方法来简单地突出显示正则表达式匹配，同时保留所有其他输入，而不会删除没有任何匹配的行。

我试图让颜色工作`sed`，并阅读`grep`文档，但我似乎无法得到我想要的。

如果我的描述不明显，我想要：

输入：

*   弗雷德
*   泰德
*   红色的
*   带领

正则表达式：

*   “。*红色的”

输出：

*   弗雷德（红色）
*   泰德
*   红色（红色）
*   带领

这样我就可以做到：

```
list_stuff | color_grep "make_this_stand_out_but_dont_hide_the_rest" 
```

编辑：

我找到了一个不漂亮的解决方案，但它有效：

感谢： [http ://www.pixelbeat.org/docs/terminal_colours/](http://www.pixelbeat.org/docs/terminal_colours/)

特别是脚本（我修改/简化）： [http ://www.pixelbeat.org/talks/iitui/sedgrep](http://www.pixelbeat.org/talks/iitui/sedgrep)

```
function sedgrep ()
{
    C_PATT=`echo -e '\033[33;01m'`
    C_NORM=`echo -e '\033[m'`

    sed -s "s/$1/${C_PATT}&${C_NORM}/gi"
} 
```

仍在寻找更简单的方法来做到这一点！

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2012-01-04T12:17:28.037

最简单的解决方案是使用`egrep --color=always 'text|^'`匹配所有行开头但只为所需文本着色的方法。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2012-11-27T21:23:45.363

这是我用来为输出着色的脚本。

我想我在某种博客或 bash/sed 教程上找到了这个想法/片段 - 再也找不到了，那是很久以前的事了。

```
#!/bin/bash

red=$(tput bold;tput setaf 1)            
green=$(tput setaf 2)                    
yellow=$(tput bold;tput setaf 3)         
fawn=$(tput setaf 3)
blue=$(tput bold;tput setaf 4)           
purple=$(tput setaf 5)
pink=$(tput bold;tput setaf 5)           
cyan=$(tput bold;tput setaf 6)           
gray=$(tput setaf 7)                     
white=$(tput bold;tput setaf 7)          
normal=$(tput sgr0)                      

sep=`echo -e '\001'` # use \001 as a separator instead of '/'

while [ -n "$1" ] ; do
  color=${!1}
  pattern="$2"
  shift 2

  rules="$rules;s$sep\($pattern\)$sep$color\1$normal${sep}g"
done

#stdbuf -o0 -i0 sed -u -e "$rules"
sed -u -e "$rules" 
```

用法：

```
./colorize.sh color1 pattern1 color2 pattern2 ... 
```

例如

```
dmesg | colorize.sh red '.*Hardware Error.*' red 'CPU[0-9]*: Core temperature above threshold' \
green 'wlan.: authenticated.*' yellow 'wlan.: deauthenticated.*' 
```

不适用于重叠模式，但无论如何我发现它非常有用。

高温高压

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-27T21:06:10.690

这个小功能在我的 ZShell 中运行良好：

```
function color_grep {
    sed s/$1/$fg[yellow]$1$terminfo[sgr0]/g
} 
```

（需要

```
autoload colors zsh/terminfo 
```

)

也许你可以做类似的事情？

编辑：对不起，这不适用于正则表达式。你将不得不稍微调整它......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-27T22:10:01.513

您现在执行此操作的方式可能与您期望的一样干净，除非您当然编写自己的 grep 工具。如果您不一定关心保留输出的顺序，这是我能想到的另一种方法：

```
function colormatch ()
{
    tee - | grep --color=always $1 | sort | uniq
} 
```

不如使用 sed 效率高（创建更多进程，并输出输出），所以我可能会建议坚持使用您的 sed 解决方案。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-27T23:50:22.747

您可以使用`-C<num>` grep 选项来显示`<num>`您匹配的上下文行。只需确保`<num>`至少与文件中的行数一样大。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-09T16:11:27.973

我最近做了一个类似过滤器的东西。我用它为带有多个文件的尾部的“标题”着色，如下所示：

tail -f access.log error.log foo.log | logcol.sh

标题如下所示：

==> 访问日志 <==

我对不同日志文件之间的快速变化感到困惑，所以这个 logcol.sh 有帮助。==> 针对特定用途进行了硬编码，但也可以是参数。

```
#!/bin/sh
while read line
do
  if test `expr "$line" : "==>.*"`  -eq 0 ;
  then
    printf '\033[0m%s\n' "$line"
  else
    printf '\033[0;31m%s\n' "$line"
  fi
done 
```

也许不是最优雅的，但我认为它很有可读性。我希望我没有任何错别字;-) HTH，抢劫

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-02-12T18:48:39.503

我正在挖掘这个小的 python 实用程序。如果不在 debian 上，请使用 alien 转换为 rpm。

[http://korpus.juls.savba.sk/~garabik/software/grc.html](http://korpus.juls.savba.sk/~garabik/software/grc.html)

```
regexp=.*red
colours="\033[38;5;160m"
count=once 
```

这是一个关于终端颜色的好页面。

[http://www.pixelbeat.org/docs/terminal_colours/](http://www.pixelbeat.org/docs/terminal_colours/)

（女王的英语真是丰富多彩。）

# c++ - 使用 Python 删除 C 和 C++ 注释？

> ID：241327
> 
> 赞同：48
> 
> 时间：2008-10-27T20:47:24.333
> 
> 标签：c++, python, c, regex, comments

我正在寻找从字符串中删除 C 和 C++ 注释的 Python 代码。（假设字符串包含整个 C 源文件。）

我意识到我可以使用正则表达式 .match() 子字符串，但这并不能解决嵌套问题`/*`，或者`//`在`/* */`.

理想情况下，我更喜欢能够正确处理尴尬情况的非天真的实现。

* * *

## 回答 #1

> 赞同：98
> 
> 时间：2008-10-27T21:48:07.737

它处理 C++ 风格的注释、C 风格的注释、字符串和它们的简单嵌套。

```
def comment_remover(text):
    def replacer(match):
        s = match.group(0)
        if s.startswith('/'):
            return " " # note: a space and not an empty string
        else:
            return s
    pattern = re.compile(
        r'//.*?$|/\*.*?\*/|\'(?:\\.|[^\\\'])*\'|"(?:\\.|[^\\"])*"',
        re.DOTALL | re.MULTILINE
    )
    return re.sub(pattern, replacer, text) 
```

需要包含字符串，因为其中的注释标记不会开始注释。

**编辑：** re.sub 没有带任何标志，所以必须先编译模式。

**Edit2：**添加了字符文字，因为它们可能包含否则会被识别为字符串分隔符的引号。

**Edit3：**通过用空格而不是空字符串替换注释，修复了无法编译的合法表达式的情况`int/**/x=5;`。`intx=5;`

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-10-27T20:48:57.650

C（和 C++）注释不能嵌套。正则表达式效果很好：

```
//.*?\n|/\*.*?\*/ 
```

这需要“单行”标志 ( `Re.S`)，因为 C 注释可以跨越多行。

```
def stripcomments(text):
    return re.sub('//.*?\n|/\*.*?\*/', '', text, flags=re.S) 
```

这段代码应该可以工作。

/编辑：请注意，我上面的代码实际上对行尾做了一个假设！此代码不适用于 Mac 文本文件。但是，这可以相对容易地修改：

```
//.*?(\r\n?|\n)|/\*.*?\*/ 
```

这个正则表达式应该适用于所有文本文件，无论它们的行尾如何（包括 Windows、Unix 和 Mac 行尾）。

/编辑：MizardX 和 Brian（在评论中）对字符串的处理做了一个有效的评论。我完全忘记了这一点，因为上面的正则表达式是从一个解析模块中提取的，该模块对字符串有额外的处理。MizardX 的解决方案应该工作得很好，但它只处理双引号字符串。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-28T02:57:06.863

不要忘记，在 C 中，反斜杠换行符在处理注释之前被消除，并且在此之前处理三元组（因为 ??/ 是反斜杠的三元组）。我有一个名为 SCC 的 C 程序（去除 C/C++ 注释），这是测试代码的一部分......

```
" */ /* SCC has been trained to know about strings /* */ */"!
"\"Double quotes embedded in strings, \\\" too\'!"
"And \
newlines in them"

"And escaped double quotes at the end of a string\""

aa '\\
n' OK
aa "\""
aa "\
\n"

This is followed by C++/C99 comment number 1.
// C++/C99 comment with \
continuation character \
on three source lines (this should not be seen with the -C fla
The C++/C99 comment number 1 has finished.

This is followed by C++/C99 comment number 2.
/\
/\
C++/C99 comment (this should not be seen with the -C flag)
The C++/C99 comment number 2 has finished.

This is followed by regular C comment number 1.
/\
*\
Regular
comment
*\
/
The regular C comment number 1 has finished.

/\
\/ This is not a C++/C99 comment!

This is followed by C++/C99 comment number 3.
/\
\
\
/ But this is a C++/C99 comment!
The C++/C99 comment number 3 has finished.

/\
\* This is not a C or C++  comment!

This is followed by regular C comment number 2.
/\
*/ This is a regular C comment *\
but this is just a routine continuation *\
and that was not the end either - but this is *\
\
/
The regular C comment number 2 has finished.

This is followed by regular C comment number 3.
/\
\
\
\
* C comment */ 
```

这没有说明三元组。注意，一行的末尾可以有多个反斜杠，但是行拼接并不关心有多少个，但后续处理可能会。等等。编写一个单一的正则表达式来处理所有这些情况将是不平凡的（但这不同于不可能）。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2013-08-14T14:36:25.220

该帖子提供了对 Markus Jarderot 代码改进的编码版本，由 atikat 在对 Markus Jarderot 帖子的评论中描述。（感谢两位提供原始代码，这为我节省了很多工作。）

更全面地描述改进：改进保持行号不变。（这是通过在替换 C/C++ 注释的字符串中保持换行符不变来完成的。）

此版本的 C/C++ 注释删除功能适用于您希望向用户生成包含行号（即对原始文本有效的行号）的错误消息（例如解析错误）。

```
import re

def removeCCppComment( text ) :

    def blotOutNonNewlines( strIn ) :  # Return a string containing only the newline chars contained in strIn
        return "" + ("\n" * strIn.count('\n'))

    def replacer( match ) :
        s = match.group(0)
        if s.startswith('/'):  # Matched string is //...EOL or /*...*/  ==> Blot out all non-newline chars
            return blotOutNonNewlines(s)
        else:                  # Matched string is '...' or "..."  ==> Keep unchanged
            return s

    pattern = re.compile(
        r'//.*?$|/\*.*?\*/|\'(?:\\.|[^\\\'])*\'|"(?:\\.|[^\\"])*"',
        re.DOTALL | re.MULTILINE
    )

    return re.sub(pattern, replacer, text) 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-28T04:03:20.753

我不知道您是否熟悉`sed`基于 UNIX（但 Windows 可用）的文本解析程序，但我在[这里](http://sed.sourceforge.net/grabbag/scripts/remccoms3.sed)找到了一个 sed 脚本，它将从文件中删除 C/C++ 注释。它非常聪明；例如，如果在字符串声明等中找到 '//' 和 '/*'，它将忽略。在 Python 中，可以使用以下代码使用它：

```
import subprocess
from cStringIO import StringIO

input = StringIO(source_code) # source_code is a string with the source code.
output = StringIO()

process = subprocess.Popen(['sed', '/path/to/remccoms3.sed'],
    input=input, output=output)
return_code = process.wait()

stripped_code = output.getvalue() 
```

在这个程序中，`source_code`是保存 C/C++ 源代码的变量，最终`stripped_code`将保存删除注释的 C/C++ 代码。当然，如果您在磁盘上有文件，则可以将`input`和`output`变量作为指向这些文件的文件句柄（`input`在读取模式下，`output`在写入模式下）。`remccoms3.sed`是来自上述链接的文件，它应该保存在磁盘上的可读位置。`sed`也可以在 Windows 上使用，并且默认安装在大多数 GNU/Linux 发行版和 Mac OS X 上。

这可能会比纯 Python 解决方案更好；无需重新发明轮子。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-28T02:58:24.957

在某些情况下，正则表达式案例会失败，例如字符串文字包含与注释语法匹配的子序列。你真的需要一个解析树来处理这个问题。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-27T20:50:45.837

您也许可以利用[py++](http://www.language-binding.net/pyplusplus/pyplusplus.html)使用 GCC 解析 C++ 源代码。

> Py++ 不会重新发明轮子。它使用 GCC C++ 编译器来解析 C++ 源文件。更准确地说，工具链如下所示：
> 
> 源代码被传递给 GCC-XML GCC-XML 将它传递给 GCC C++ 编译器 GCC-XML 从 GCC 的内部表示生成 C++ 程序的 XML 描述。Py++ 使用 pygccxml 包来读取 GCC-XML 生成的文件。底线 - 您可以确定，您的所有声明都已正确阅读。

或者可能不是。无论如何，这不是一个简单的解析。

@ 基于 RE 的解决方案 - 您不太可能找到正确处理所有可能的“尴尬”情况的 RE，除非您限制输入（例如，没有宏）。对于一个防弹解决方案，你真的别无选择，只能利用真正的语法。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-07-03T09:08:24.783

很抱歉，这不是 Python 解决方案，但您也可以使用了解如何删除注释的工具，例如您的 C/C++ 预处理器。以下是 GNU CPP 的[做法](http://gcc.gnu.org/onlinedocs/cpp/Invocation.html#index-fpreprocessed-171)。

```
cpp -fpreprocessed foo.c 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-08-18T14:18:07.737

还有一个非 python 的答案：使用程序[stripcmt](http://www.bdc.cx/software/stripcmt/)：

> StripCmt 是一个用 C 语言编写的简单实用程序，用于从 C、C++ 和 Java 源文件中删除注释。在 Unix 文本处理程序的伟大传统中，它既可以用作 FIFO（先进先出）过滤器，也可以在命令行上接受参数。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-09-25T05:27:45.570

以下对我有用：

```
from subprocess import check_output

class Util:
  def strip_comments(self,source_code):
    process = check_output(['cpp', '-fpreprocessed', source_code],shell=False)
    return process 

if __name__ == "__main__":
  util = Util()
  print util.strip_comments("somefile.ext") 
```

这是子进程和 cpp 预处理器的组合。对于我的项目，我有一个名为“Util”的实用程序类，我保留了我使用/需要的各种工具。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2020-12-02T07:54:54.263

我已经使用 pygments 来解析字符串，然后忽略所有来自它的注释的标记。与 pygments 列表上的任何词法分析器（包括 Javascript、SQL 和 C Like）一起工作就像一个魅力。

```
from pygments import lex
from pygments.token import Token as ParseToken

def strip_comments(replace_query, lexer):
    generator = lex(replace_query, lexer)
    line = []
    lines = []
    for token in generator:
        token_type = token[0]
        token_text = token[1]
        if token_type in ParseToken.Comment:
            continue
        line.append(token_text)
        if token_text == '\n':
            lines.append(''.join(line))
            line = []
    if line:
        line.append('\n')
        lines.append(''.join(line))
    strip_query = "\n".join(lines)
    return strip_query 
```

使用类似 C 的语言：

```
from pygments.lexers.c_like import CLexer

strip_comments("class Bla /*; complicated // stuff */ example; // out",CLexer())
# 'class Bla  example; \n' 
```

使用 SQL 语言：

```
from pygments.lexers.sql import SqlLexer

strip_comments("select * /* this is cool */ from table -- more comments",SqlLexer())
# 'select *  from table \n' 
```

使用类似 Javascript 的语言：

```
from pygments.lexers.javascript import JavascriptLexer
strip_comments("function cool /* not cool*/(x){ return x++ } /** something **/ // end",JavascriptLexer())
# 'function cool (x){ return x++ }  \n' 
```

由于此代码仅删除注释，因此将保留任何奇怪的值。因此，这是一个非常强大的解决方案，甚至能够处理无效输入。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-07-03T08:38:46.277

您实际上并不需要解析树来完美地执行此操作，但实际上您确实需要与编译器前端生成的令牌流等效的令牌流。这样的令牌流必须处理所有奇怪的问题，例如续行注释开始、以字符串开头的注释、三元组规范化等。如果您有令牌流，删除注释很容易。（我有一个工具可以准确地产生这样的令牌流，你猜怎么着，一个真正的解析器的前端会产生一个真正的解析树:)。

正则表达式可以单独识别标记这一事实表明，原则上，您可以编写一个正则表达式来挑选注释词位。为分词器设置的正则表达式的真正复杂性（至少是我们编写的那个）表明您在实践中不能这样做；单独写它们已经够难的了。如果您不想完美地做到这一点，那么，上面的大多数 RE 解决方案都可以。

现在，除非您正在构建代码混淆器，否则您*为什么*想要剥离注释超出了我的范围。在这种情况下，您必须完全正确。

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2011-03-07T16:10:54.113

我最近在上课时遇到了这个问题，教授要求我们从源代码中删除 javadoc，然后再提交给他进行代码审查。我们不得不多次这样做，但我们不能只是永久删除 javadoc，因为我们还需要生成 javadoc html 文件。这是我为解决问题而制作的一个小 Python 脚本。由于 javadoc 以 /** 开头并以 */ 结尾，因此脚本会查找这些标记，但可以修改脚本以满足您的需要。它还处理单行块注释和块注释结束但在与块注释结束的同一行上仍有未注释代码的情况。我希望这有帮助！

*警告：此脚本会修改传入文件的内容并将其保存到原始文件中。明智的做法是在其他地方进行备份*

```
#!/usr/bin/python
"""
 A simple script to remove block comments of the form /** */ from files
 Use example: ./strip_comments.py *.java
 Author: holdtotherod
 Created: 3/6/11
"""
import sys
import fileinput

for file in sys.argv[1:]:
    inBlockComment = False
    for line in fileinput.input(file, inplace = 1):
        if "/**" in line:
            inBlockComment = True
        if inBlockComment and "*/" in line:
            inBlockComment = False
            # If the */ isn't last, remove through the */
            if line.find("*/") != len(line) - 3:
                line = line[line.find("*/")+2:]
            else:
                continue
        if inBlockComment:
            continue
        sys.stdout.write(line) 
```

# video - 如何在不使用 RealServer (Helix) 和 Real Player 的情况下流式传输跨平台视频？

> ID：241328
> 
> 赞同：2
> 
> 时间：2008-10-27T20:48:49.790
> 
> 标签：video, streaming, platform, realplayer, helix-server

多年来，我们一直在使用 RealNetworks 的 Helix 服务器来提供流媒体视频课程。

到目前为止，它一直是一个非常可靠的解决方案。

最近，由于 RealPlayer 问题，我们的支持电话从每周 2 到 3 次（主要是 PEBKAC 或防火墙问题）增加到每天 10 次左右。

我一直在争论要抛弃 Real 来支持别的东西，但我真的需要提出一个建议。

### 要求：

1.  流式传输，而不是下载和播放。

2.  嵌入在视频中的可点击书签（Real Text）；

3.  能够处理大约 100 个同时连接。

4.  能够识别来自同一网络上另一台服务器的身份验证。

### 约束：

1.  小型、免费（如啤酒）客户端/播放器（即没有嵌入式 iTunes！）

2.  客户端/播放器的平台独立性（播放器必须适用于 windows/mac/linux）

评估产品时我应该寻找什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-27T22:15:52.453

你可以像[youtube](http://www.youtube.com/) / [google video](http://video.google.com/) /[许多其他网站](http://www.google.com/search?hl=en&q=online+video&btnG=Search)那样做。10 个 bajillion 视频不会错，对吧？

基本上有三个主要部分：

1.  通过标准 HTTP 流式传输 FLV 或 M4V 视频，可以为此使用任何旧的网络服务器，如 apache
2.  客户端是一个 Flash 应用程序。跨浏览器，跨平台，人人可看
3.  在流中寻找而不必先缓冲整个视频——这是通过一些服务器端的诡计来实现的。基本上，如果您在 30 分钟的视频开始时观看，然后在第 23 分钟时立即点击，您不想等待整个内容首先下载。那么会发生什么，是浏览器发出点[赞 http://example.com/getvideo.php?id=1234&position=23](http://example.com/getvideo.php?id=1234&position=23)的请求- 然后服务器端脚本在最近的关键帧处动态剪切视频，拍一个 FLV标头到它上面，并从该点开始流式传输视频。那里有几个预制脚本，我没有尝试过，但[xmoov](http://xmoov.com/xmoov-php/)看起来不错。

至于你的要求：

1.  流媒体 - 是的
2.  可点击的书签——你可以用一些 Flash 脚本来做到这一点。书签将与时间码一起存储在单独的文件（可能是 XML）中，Flash 播放器将根据视频中播放头的位置显示正确的书签
3.  当然，可以处理尽可能多的网络浏览器。如果 apache/IIS 不够快，也许可以研究一下[lighttpd](http://www.lighttpd.net/)
4.  不确定来自其他服务器的身份验证是什么意思。需要对此进行更多解释。

约束：

1.  是的，播放器是免费的。甚至不需要安装，直接从浏览器运行。您可以仅使用开源工具编写完整的闪存应用程序。（一些来自 adobe 的官方，一些 3rd 方的，取决于您的需要）
2.  它是 flash，到处运行（除了 64bit linux 上的 64bit firefox，但他们不值得 flash，他们抱怨太多）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-02-01T14:48:27.493

这个问题的解决方案是 iSpring player。

它实际上是一个强大的解决方案，带有一个 PowerPoint 插件，允许您将带有画外音的 PP 演示文稿直接转储到 Flash。

它还有一个不错的测验组件，它将 xml 结果提交到服务器，以便可以将其存储在数据库中。（警告 - 考试不安全，但测验很好。）

他们现在承诺每年都会推出 HTML5 视频，这将使我们在平板电脑/手机出现时解决问题。

# unix - 如何更改模板中替换变量的格式

> ID：241334
> 
> 赞同：3
> 
> 时间：2008-10-27T20:51:06.367
> 
> 标签：unix, sed, text-files

我需要遍历目录中的文件并执行以下替换。

**前：**

> 您好 ${USER_NAME}，您住在 ${HOME_ADDRESS}。现在是 ${TIME}

**后：**

> 您好 ${userName}，您住在 ${homeAddress}。现在是 ${time}

${} 中出现的不同标记的数量很大，因此运行起来并不可行：

```
find . -name '*' -exec sed -i 's/${USER_NAME}/${userName}/g' {} \;
find . -name '*' -exec sed -i 's/${TIME}/${time}/g' {} \; 
```

等等

我希望可以使用单个命令执行此替换，如下所示：

```
find . -name '*' -exec sed 's/XXX/YYY/g' {} \; 
```

但我不知道用什么来代替 XXX 和 YYY。是否可以在单个命令中执行此操作？

干杯，多纳尔

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-27T21:05:09.477

为清晰起见格式化：

```
sed -i '/^Hello/ { s/\$\{USER_NAME\}/\$\{userName\}/g 
                   s/\$\{HOME_ADDRESS\}/\$\{homeAddress\}/g 
                   s/\$\{TIME\}/\$\{time\}/g
                  }' 
```

Where`/^Hello/`标识您希望操作的行（如果需要，使其更具体），其余的替换每个变量名称。

* * *

如果将其写入脚本，请考虑使用 HERE 文档来保持格式并使其更易于阅读和更新...

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-27T20:57:02.813

sed的`-i`标志将就地编辑文件。对于 XXX 和 YYY，您可以使用如下内容：

```
sed -i 's/USER_NAME/userName/g' 
```

等等。

更新：我看到您的问题实际上是关于自动将“USER_NAME”更改为“userName”。你可以试试这个 Perl 脚本：

```
sub convert {
    my $r = lc $_[0];
    $r =~ s/_(.)/\U$1\E/g;
    return $r;
}
while (<>) {
    s/\${([A-Z_]+)}/\${@{[convert $1]}}/g;
    print;
} 
```

像这样运行它：

```
perl -i convert.pl inputfile.txt 
```

样本输出：

```
$ cat inputfile.txt
Hello ${USER_NAME}, you live at ${HOME_ADDRESS}. It is now ${TIME}
$ perl -i convert.pl inputfile.txt
$ cat inputfile.txt
Hello ${userName}, you live at ${homeAddress}. It is now ${time} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-27T21:12:29.787

上面的答案非常有效。为了完整起见，我可能会补充一点，您可以这样做：

```
sed '/^Hello/ { s/\$\{USER_NAME\}/\$\{userName\}/g' <filename> \
   | sed 's/\$\{HOME_ADDRESS\}/\$\{homeAddress\}/g' \
   | sed 's/\$\{TIME\}/\$\{time\}/g' 
```

它们在功能上是相同的（除了我的转储到标准输出；你必须把它放在某个地方（但你必须保留原件，以防你经常弄乱你的正则表达式）。我喜欢我的公式只是因为我可以从一个 sed 命令开始，然后添加更多

```
!! | sed 'yet-enother-regexp' 
```

方向键？vi模式？谁需要那些东西？:)

# c# - XmlReader - 自关闭元素不会触发 EndElement 事件？

> ID：241336
> 
> 赞同：38
> 
> 时间：2008-10-27T20:52:22.230
> 
> 标签：c#, .net, xml, .net-2.0, xmlreader

我在 .NET 中使用 XmlReader 使用循环解析 XML 文件：

```
while (xml.Read()) {
   switch xml.NodeType {
     case XmlNodeType.Element:
      //Do something
     case XmlNodeType.Text:
      //Do something
     case XmlNodeType.EndElement:  
      //Do something
   }
} 
```

我想知道以下 XML 代码不产生一些 EndElement 节点是否正常？请注意 /> 之前缺少的空格，但我认为这不是问题。

```
<date month="November" year="2001"/>
<zone name="xml"/> 
```

是否有不同的 NodeType 或属性来指示自闭合元素？

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2008-10-27T21:03:15.157

不，您可以通过查看[XmlReader.IsEmptyElement](http://msdn.microsoft.com/en-us/library/system.xml.xmlreader.isemptyelement.aspx)来检查它。

在该属性的文档中：

> 不会为空元素生成相应的 EndElement 节点。

# c# - 何时在 C# 中使用静态类

> ID：241339
> 
> 赞同：654
> 
> 时间：2008-10-27T20:53:37.673
> 
> 标签：c#, class, static

以下是[MSDN 在*When to Use Static Classes*](https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/static-classes-and-static-class-members)下所说的：

> ```
> static class CompanyInfo
> {
>     public static string GetCompanyName() { return "CompanyName"; }
>     public static string GetCompanyAddress() { return "CompanyAddress"; }
>     //...
> } 
> ```
> 
> 使用静态类作为与特定对象无关的方法的组织单元。此外，静态类可以使您的实现更简单、更快，因为您不必创建对象即可调用其方法。以有意义的方式组织类内部的方法很有用，例如 System 命名空间中的 Math 类的方法。

对我来说，这个例子似乎并没有涵盖静态类的很多可能的使用场景。过去，我曾将静态类用于相关函数的无状态套件，但仅此而已。那么，在什么情况下应该（也不应该）将一个类声明为静态的？

* * *

## 回答 #1

> 赞同：763
> 
> 时间：2008-10-27T21:01:00.293

我在早期的 Stack Overflow 答案中写下了我对静态类的想法： *[Class with single method -- best approach?](https://stackoverflow.com/questions/205689/class-with-single-method-best-approach#206481)*

我曾经喜欢充满静态方法的实用程序类。他们对辅助方法进行了极大的整合，否则这些方法会导致冗余和维护地狱。它们非常易于使用，无需实例化，无需处置，只需一劳永逸。我想这是我第一次在不知情的情况下尝试创建面向服务的架构——许多无状态服务只是完成了它们的工作，没有别的。然而，随着系统的发展，巨龙即将到来。

**多态性**

假设我们有方法 UtilityClass.SomeMethod 愉快地嗡嗡作响。突然我们需要稍微改变一下功能。大多数功能是相同的，但我们仍然必须更改几个部分。如果它不是静态方法，我们可以创建一个派生类并根据需要更改方法内容。因为它是一个静态方法，我们不能。当然，如果我们只需要在旧方法之前或之后添加功能，我们可以创建一个新类并在其中调用旧类——但这很糟糕。

**接口问题**

由于逻辑原因，不能通过接口定义静态方法。而且由于我们不能覆盖静态方法，所以当我们需要通过接口传递静态类时，它们是无用的。这使我们无法使用静态类作为策略模式的一部分。[我们可能会通过传递委托而不是接口来](https://docs.microsoft.com/archive/blogs/kirillosenkov/how-to-override-static-methods)修补一些问题。

**测试**

这基本上与上面提到的界面问题密切相关。由于我们交换实现的能力非常有限，我们也很难用测试代码替换生产代码。同样，我们可以将它们包装起来，但这需要我们更改大部分代码才能接受包装器而不是实际的对象。

**促进斑点**

由于静态方法通常用作实用方法，而实用方法通常有不同的用途，我们很快就会得到一个充满不连贯功能的大型类——理想情况下，每个类在系统中应该有一个单一的用途。只要他们的目的明确，我宁愿有五倍的课程。

**参数蠕变**

首先，那个可爱又纯真的静态方法可能只需要一个参数。随着功能的增长，添加了几个新参数。很快就会添加更多可选参数，因此我们创建方法的重载（或仅添加默认值，使用支持它们的语言）。不久之后，我们就有了一个需要 10 个参数的方法。只有前三个是真正需要的，参数 4-7 是可选的。但是如果指定了参数 6，那么 7-9 也需要填写...如果我们创建一个类的目的只是为了做这个静态方法所做的事情，我们可以通过在构造函数，并允许用户通过属性设置可选值，或者同时设置多个相互依赖的值的方法。此外，如果一种方法已经发展到如此复杂的程度，

**无缘无故要求消费者创建类的实例**

最常见的论点之一是：为什么要求我们类的消费者创建一个实例来调用这个单一方法，而之后却没有使用该实例？在大多数语言中，创建类的实例是一项非常便宜的操作，因此速度不是问题。向消费者添加额外的代码行成本很低，可以为未来更易于维护的解决方案奠定基础。最后，如果您想避免创建实例，只需创建一个允许轻松重用的类的单例包装器 - 尽管这确实要求您的类是无状态的。如果它不是无状态的，您仍然可以创建处理所有内容的静态包装器方法，同时从长远来看仍然为您提供所有好处。最后，`new MyClass();`

**只有西斯在绝对交易**

当然，我不喜欢静态方法也有例外。不会造成任何膨胀风险的真正实用程序类是静态方法的极好案例 - 以 System.Convert 为例。如果您的项目是一次性的，对未来的维护没有要求，那么整体架构真的不是很重要 - 静态或非静态，并不重要 - 但是开发速度确实如此。

**标准，标准，标准！**

使用实例方法不会阻止您也使用静态方法，反之亦然。只要差异化背后有推理并且它是标准化的。没有什么比查看具有不同实现方法的业务层更糟糕的了。

* * *

## 回答 #2

> 赞同：162
> 
> 时间：2012-02-01T02:50:11.207

在决定将类设为静态还是非静态时，您需要查看您尝试表示的信息。这需要一种更“**自下而上**”的编程风格，您首先关注您所代表的数据。你正在写的课程是像石头还是椅子这样的真实世界的对象？这些东西是物理的，并且具有诸如颜色、重量等物理属性，这告诉您您可能想要实例化具有不同属性的多个对象。我可能同时想要一把黑色椅子和一把红色椅子。如果您同时需要两个配置，那么您会立即知道您希望将其实例化为一个对象，这样每个对象都可以是唯一的并且可以同时存在。

另一方面，静态函数倾向于更多地用于不属于现实世界对象或您可以轻松表示的对象的动作。请记住，C# 的前身是 C++ 和 C，您可以在其中定义类中不存在的全局函数。这有助于“**自上而下**”的编程。静态方法可用于“对象”执行任务没有意义的情况。通过强制您使用类，这使得对相关功能进行分组变得更加容易，从而帮助您创建更可维护的代码。

大多数类都可以用静态或非静态来表示，但是当您有疑问时，只需回到您的 OOP 根源并尝试考虑您所表示的内容。这是一个正在执行动作的对象（一辆可以加速、减速、转弯的汽车）还是更抽象的东西（比如显示输出）。

与你内心的 OOP 联系，你永远不会出错！

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2008-10-27T20:57:06.323

对于 C# 3.0，扩展方法可能只存在于顶级静态类中。

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2008-10-27T21:39:12.730

如果您使用代码分析工具（例如[FxCop](https://en.wikipedia.org/wiki/FxCop)`static` ），如果该方法不访问实例数据，它会建议您标记该方法。理由是有性能提升。[MSDN：CA1822 - 将成员标记为 static](https://msdn.microsoft.com/library/ms245046)。

与其说是规则，不如说是指导方针，真的……

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2008-10-27T21:11:55.670

我确实倾向于对工厂使用静态类。例如，这是我的一个项目中的日志记录类：

```
public static class Log
{
   private static readonly ILoggerFactory _loggerFactory =
      IoC.Resolve<ILoggerFactory>();

   public static ILogger For<T>(T instance)
   {
      return For(typeof(T));
   }

   public static ILogger For(Type type)
   {
      return _loggerFactory.GetLoggerFor(type);
   }
} 
```

您甚至可能已经注意到 IoC 是使用静态访问器调用的。 *对我来说，大多数*时候，如果你可以在一个类上调用静态方法，那就是你所能做的，所以为了更加清晰，我将这个类标记为静态。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2013-01-04T23:47:16.640

静态类非常有用并且占有一席之地，例如库。

我能提供的最好的例子是 .Net Math 类，它是一个包含数学函数库的系统命名空间静态类。

就像其他任何事情一样，使用正确的工具来完成工作，否则任何事情都可能被滥用。

盲目地将静态类视为错误，不要使用它们，或者说“只能有一个”或没有，与过度使用它们一样错误。

C#.Net 包含许多与 Math 类一样使用的静态类。

因此，如果实现正确，它们将非常有用。

我们有一个包含许多与业务相关的时区函数的静态 TimeZone 类，不需要像 Math 类那样创建该类的多个实例，它在静态类中包含一组全局可访问的 TimeZone 相关函数（方法） .

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2011-07-01T09:34:51.860

当我希望使用函数而不是类作为我的重用单元时，我已经开始使用静态类。以前，我都是关于静态类的邪恶的。然而，学习[F#](http://en.wikipedia.org/wiki/F_Sharp_%28programming_language%29)让我对它们有了新的认识。

我这是什么意思？好吧，假设在处理一些超级[DRY](http://en.wikipedia.org/wiki/Don%27t_repeat_yourself)代码时，我最终得到了一堆单一方法类。我可能只是将这些方法拉入一个静态类，然后使用委托将它们注入到依赖项中。这也与我选择 Autofac 的[依赖注入(DI) 容器配合得很好。](http://en.wikipedia.org/wiki/Dependency_injection)

当然，直接依赖静态方法*通常*仍然是邪恶的（有一些非邪恶的用途）。

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2008-10-27T21:05:24.577

我使用静态类来定义给定类型的对象可以在特定上下文中使用的“额外功能”。通常它们是实用程序类。

除此之外，我认为“使用静态类作为与特定对象无关的方法的组织单元”。很好地描述了它们的预期用途。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2014-10-17T07:46:33.183

这是自 OOP 开始以来另一个古老但非常热门的问题。当然，使用（或不使用）静态类的原因有很多，其中大部分已经在众多答案中涵盖。

我将为此添加我的 2 美分，说，我将一个类设为静态，当这个类在系统中是唯一的并且在程序中拥有它的任何实例时真的没有意义。但是，我将这种用法保留给大班。我从不将 MSDN 示例中的小类声明为“静态”，当然，也不会声明将成为其他类成员的类。

我还想指出，静态*方法*和静态*类*是需要考虑的两件不同的事情。接受的答案中提到的主要缺点是静态*方法*。静态*类*提供与普通类相同的灵活性（涉及属性和参数），其中使用的所有方法都应与类存在的目的相关。

在我看来，静态类候选的一个很好的例子是“FileProcessing”类，它将包含与程序的各种对象相关的所有方法和属性，以执行复杂的 FileProcessing 操作。拥有多个此类的实例几乎没有任何意义，并且静态将使程序中的所有内容都可以轻松使用它。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-10-27T21:00:33.883

我只对辅助方法使用静态类，但随着 C# 3.0 的出现，我宁愿使用扩展方法。

我很少使用静态类方法，原因与我很少使用单例“设计模式”的原因相同。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-12-12T06:57:49.827

基于[MSDN](http://msdn.microsoft.com/en-us/library/79b3xss3(VS.80).aspx)：

1.  您不能为静态类创建实例
2.  如果类声明为静态，则该类的成员变量应该是静态的
3.  封印【不可继承】
4.  不能包含实例构造函数
5.  内存管理

示例：数学计算（数学值）不会改变 [STANDARD CALCULATION FOR DEFINED VALUES]

# windows - 对于 ruby /webrick，我需要 windows 来识别 shebang (#!) 符号

> ID：241341
> 
> 赞同：2
> 
> 时间：2008-10-27T20:54:26.097
> 
> 标签：windows, ruby, exec, fork, shebang

（请耐心等待，我保证这会到达 shebang 和 windows。）

我将最简单的 WEBRick 服务器放在一起：

```
require 'webrick'
include WEBrick

s = HTTPServer.new(:Port=>2000, :DocumentRoot=>Dir::pwd)
s.start 
```

再简单不过了。这个基本服务器确实接受 http 连接（firefox、internetexplorer、wget、TELENT）并适当地处理它们，只要我只是获取静态文档。但是，如果我将目录中的一个文件设置为具有 .cgi 扩展名，我会在服务器终端上得到 500 和以下信息：

```
ERROR CGIHandler: c:/rubyCGI/test.cgi: 
C:/...[snip]...webrick/httpservlet/cgi_runner.rb:45: in 'exec': Exec format error - ...[snip]... 
```

我在命令行上做了一些事情来模仿 cgi_runner.rb 第 45 行发生的事情

```
c:\>ruby
exec "c:/rubyCGI/test.cgi"
^Z
(same error erupts)

c:\>ruby
exec "ruby c:/rubyCGI/test.cgi"
^Z
Content-type: text/html

Mares eat oats and does eat oats and I'll be home for Christmas. 
```

显然，WEBrick 尚未获准登陆 Windows。您通常对公司偏执的头痛使我无法修改 webrick，所以**我可以在 c:/rubyCGI/test.cgi 中获得操作系统（windows）识别的 shebang 表示法，这样我就不必每次都明确告诉它要使用哪个解释器采用？** 我可以将所有 .cgi 文件分配为与 ruby​​ 相关联，但从长远来看，这会受到限制。

更新：自从发布此内容后，我想到可能根本无法从 ruby​​ 运行 cgi Web 服务器；ruby 没有分叉支持。由于无法派生进程，cgi 服务器将不得不一次执行每个 cgi 脚本，在第一个完成时忽略所有并发请求。虽然这对某些人来说可能是可以接受的，但它不适用于我的应用程序。尽管如此，我仍然对我最初的问题的答案非常感兴趣——让 shebang 在 windows 下工作。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-27T21:46:08.037

我认为您想要的是将文件扩展名与 Ruby 相关联。我认为不可能让 !# 符号在 Windows 上工作，但可以让 Windows 自动启动带有特定解释​​器的脚本（如第二个示例中所示）。关于您想要做什么的逐步讨论在[这里。](http://support.microsoft.com/kb/307859) 您特别想要标题为：“为未关联的文件类型创建文件关联”的部分。我认为这将完成你想要做的事情。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-28T08:49:01.750

适用于 Windows 上的 Ruby 1.8.6.pxxx 和 1.9.1.p0 的通用解决方案如下：

编辑文件：c:\ruby\lib\ruby\1.9.1\webrick\httpservlet\cgi_runner.rb

在文件顶部添加以下行：

```
如果“1.9.1”== RUBY_VERSION
  require 'rbconfig' #constants 告诉 Ruby 从哪里运行
结尾

```

现在，找到最后一行： exec ENV["SCRIPT_FILENAME"] 注释掉该行并添加以下代码：

```
＃  - - 从这里  - -
如果“1.9.1”== RUBY_VERSION #使用 RbConfig
  Ruby = File::join(RbConfig::CONFIG['bindir'],
                        RbConfig::CONFIG['ruby_install_name'])
  Ruby << RbConfig::CONFIG['EXEEXT']
其他 # 使用 ::Config
  Ruby = File::join(::Config::CONFIG['bindir'],
                        ::Config::CONFIG['ruby_install_name'])
  Ruby << ::Config::CONFIG['EXEEXT']
结尾

如果 /mswin|bccwin|mingw/ =~ RUBY_PLATFORM
  执行“#{Ruby}”，ENV[“SCRIPT_FILENAME”]
别的
  执行 ENV["SCRIPT_FILENAME"]
结尾
＃  - - 到这里  - -

```

保存文件并重新启动 webrick 服务器。

说明：这段代码只是用“ruby.exe”的完整路径构建了一个变量“Ruby”，并且（如果你在Windows上运行）它传递了附加参数“c:\ruby\bin\ruby.exe”，到 Kernel.exec() 方法，以便您的脚本可以执行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T08:36:00.377

不是真的要争论......但是当 mongrel 速度更快并且使用 Windows 编译的本机编译时，为什么还要打扰 webrick？因为，这意味着不需要shebang。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-09-07T22:33:15.533

实际上，可以让 Windows 识别脚本文件中的 shebang 表示法。它可以在相对较短的脚本中完成，比如 Ruby 或 AutoIt。脚本文件的第一行只需要一个相当简单的解析器，以及一些文件操作。当需要脚本文件的交叉兼容性或 Windows 文件扩展名不够用时，我已经这样做了几次。

# java - 是否可以在 JSP 中显示 Swing 组件？

> ID：241342
> 
> 赞同：2
> 
> 时间：2008-10-27T20:54:59.230
> 
> 标签：java, swing, jsp

`JOptionPane`我想知道是否可以使用 JSP 从浏览器中弹出s 或其他 Swing 组件。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-27T20:55:39.183

如果你嵌入一个小程序。但我认为这不是你想要的。Swing 适用于桌面应用程序。JSP 网页。如果您想要组件，请尝试查看 JSF 或许多 AJAX Javascript 框架中的一些，例如原型。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-23T19:00:14.277

您可能还需要考虑 GWT，它使您能够使用 Java 代码开发 Web 界面（Java 代码由 GWT 编译器转换为 HTML 和 JavaScript）。尽管在编写 GWT 应用程序时不*直接*使用 Swing API进行编程，但 GWT API 在风格上与 Swing 编程非常相似。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-23T19:09:30.483

假设您熟悉 Swing，您可能想向自己介绍[Apache Wicket](http://wicket.apache.org/)，它与您构建网页的方式非常相似，就像 Swing 构建 GUI:s 一样。也就是说，在 Wicket 中，您将 Label、Button、DataTable 等的新实例添加到页面并将它们链接到 bean 属性数据，然后最终将其转换为功能齐全的网页。

至于实际问题，你真的不能按原样做。如果无法选择一个新的/不同的/另一个 Web 框架来帮助您，那么我能想到的唯一正确的方法就是按照 sblundy 的建议进行操作。

# oracle - 用句点分隔的 oracle 连接标识符到底是怎么回事

> ID：241361
> 
> 赞同：4
> 
> 时间：2008-10-27T20:58:40.893
> 
> 标签：oracle, configuration, tnsnames

我一直在想这个问题，但由于它没有出现太多，所以我把它留在了“神秘的巫师”一栏中。

在我看来，像 ABC 和 ABC.DEFG 这样的连接标识符之间存在某种关系，我不太明白它是什么。

例如，我刚刚设置的一台机器在使用标识符 ED2 时遇到问题，即使在我的 tnsnames 文件中我显然有

```
EDC2 = (....) 
```

这是从另一台运行良好的计算机复制和粘贴的。但是，做 tnsping EDC2 将无法解决，直到我将其更改为

```
EDC2.WORLD = (...) 
```

此时解析到 EDC2 开始工作。这里发生了什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-27T21:07:46.710

tnsnames.ora 文件中的 TNS 别名与参数交互

```
NAMES.DEFAULT_DOMAIN 
```

在 sqlnet.ora 文件中。例如，如果`NAMES.DEFAULT_DOMAIN`设置为 WORLD，那么当您尝试连接到没有域的别名时，sqlnet.ora 文件会告诉 Oracle 在 tnsnames.ora 文件中进行查找之前自动附加域。如果您尝试使用域连接到别名，`NAMES.DEFAULT_DOMAIN`则会被忽略。

我的一般偏好/建议是`NAMES.DEFAULT_DOMAIN`在 sqlnet.ora 中设置为 WORLD，并在 tnsnames.ora 文件中指定 EDC2.WORLD。这样，连接标识符 EDC2 和 EDC2.WORLD 都将起作用——前者因`DEFAULT_DOMAIN`参数而更改为后者。

# unit-testing - 您如何对不同的类访问级别进行单元测试？

> ID：241364
> 
> 赞同：4
> 
> 时间：2008-10-27T20:59:02.327
> 
> 标签：unit-testing

我承认 - 在单元测试方面我是一个完全的新手。我可以很容易地掌握这些概念（测试一件事，break-fix-test-repeat 等），但是我在解决这个问题时遇到了一些问题......

我的任务是重写我们应用程序的很大一部分，并且我已经很好地整理了类结构。我们将我们的测试项目与解决方案的其余部分混合在一起，并且所有参考都按照我们希望的方式排列。不幸的是，有一些 Friend 类只能从同一个命名空间内访问。就目前而言，测试类不是此命名空间的成员，因此我无法直接访问任何**真正**需要测试的底层方法。

从我一直在阅读的内容来看，我可以创建一个有问题的类的公共模型并以这种方式进行测试，但我担心将来有人会对生产代码进行更改而不是将其复制到测试代码，完全违背了测试的目的。另一种选择是更改类本身的访问级别，但这会涉及大量开销和摆弄已经存在的代码。编写接口的想法也出现了，但是为了测试而创建一个完整的接口结构并没有在管理中流行起来。

我只是在这里遗漏了什么吗？在不更改对它们的访问权限的情况下，确保这些底层类确实正常运行的最佳方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-27T21:03:56.497

我不确定您是否引用 .NET/C# 项目，但您可以将该`InternalsVisibleTo`属性添加到 AssemblyInfo.cs 文件中，以将您的`internal`类公开给单元测试程序集。

假设您创建了一个名为“MyApplication.Tests”的单元测试项目，将其添加到“MyApplication”项目的 AssemblyInfo.cs 文件（位于“Properties”下）：

`[assembly: InternalsVisibleTo("MyApplication.Tests")]`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-27T21:12:11.007

您还可以创建与测试主题在同一名称空间中的测试主题的子类，并且该子类可以公开测试所需的任何功能。

假设您有某种方法可以给这个子类一个“测试”范围，那么您就可以回家了。（你不希望这个类出现在你的常规代码中，因为它破坏了封装）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-27T21:22:43.543

我认为您的单元测试不应该*需要*任何源代码，所以第一个答案肯定有效。您是否考虑过使用反射？我认为它可以绕过更改源代码；这里有一个很好的讨论：[CodeProject](http://www.codeproject.com/KB/cs/testnonpublicmembers.aspx)

# asp.net - 在服务器（asp.net）上生成和突出显示菜单项的最佳方法

> ID：241373
> 
> 赞同：0
> 
> 时间：2008-10-27T21:01:07.923
> 
> 标签：asp.net, menu, menu-items

我有一个 ascx 组件，它包含两级菜单，因为有几种用户类型，并且需要在服务器上计算菜单。

无论如何 - 我也在服务器上突出显示当前菜单项（将选定的类/css添加到项目中）。使用 javascript 突出显示不是一个好的选择，因为数据网格中有内容，这会导致回发并且需要将菜单保持在与选定值相同的位置。因此，我将其作为某种与哈希表的映射（例如，对（站点的 URL，菜单项到突出显示））进行此操作，并且我必须为我的 Web 应用程序包含的每个站点包含一个映射为了我想要突出显示菜单......所以不知何故，它让我感到困扰，必须有更好的方法来做到这一点。有没有更好的技术？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-27T21:13:12.190

我在使用 .NET 2.0 的母版页/内容页上使用的一种技术是拥有一个名为“SetNavigation”的可公开访问的方法，该方法采用与我要突出显示的超链接控件相关的字符串字符。该方法所做的是将指定超链接的 CSS 样式表设置为我的“选定”超链接。

然后在我的子页面中，在Page_Load方法中，调用SetNavigation方法，根据我所在的当前页面传入链接，比如SetNavigation("hypSearch")

我想你可以在你的 ASCX 控件上创建一个类似的控件，然后让你的 Page_Load 事件，甚至按钮单击事件调用该方法（如果需要）。

# perl - $#array 在 Perl 中是什么意思？

> ID：241388
> 
> 赞同：19
> 
> 时间：2008-10-27T21:05:44.357
> 
> 标签：perl

我正在查看以下代码片段：

```
my @ret = <someMethod>
return (undef) if( $DB_ERROR );
return (undef) unless ($#ret >= 0); 
```

只是给你`$#`一个数组中的元素计数吗？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-10-27T21:06:53.963

`$#arrayname`为您提供最后一个元素的索引，因此如果数组`@ret`有 2 个元素，`$#ret`则为 1。

而且，正如 Barry Brown 所指出的，空数组给出 -1。

要获得长度，您可以在标量上下文中使用数组：

```
print scalar @ret; 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-10-27T21:29:43.403

edg 是正确的，但原始代码不必要地迟钝。在大多数情况下，`$#foo`这是一个危险信号，表明代码可以更简单地使用`scalar @foo`.

```
return (undef) unless ($#ret >= 0); 
```

`unless foo >= bar`很难解开。首先，把它变成一个积极的陈述。

```
return (undef) if ($#ret < 0); 
```

什么时候 $#ret < 0？当它是-1。-1 的 $#ret 是长度为 0 的数组。所以上面可以更简单地写成...

```
return (undef) if scalar @ret <= 0; 
```

但是你不能有一个负长度数组，所以......

```
return (undef) if scalar @ret == 0; 
```

并且 == 在标量上下文中，因此“标量”是多余的......

```
return (undef) if @ret == 0; 
```

但这只是“如果`@ret`是假的”的一种冗长的说法。

```
return (undef) if !@ret; 
```

我认为对于简单的语句修饰符，用除非更好地表达。

```
return (undef) unless @ret; 
```

这不是更容易跟随吗？

作为最后的旁注，`return undef`不鼓励，因为它在列表上下文中做错了事。你得到一个包含一个 undef 元素的列表，这是真的。相反，只需使用一个空白返回，它在标量上下文中返回 undef，在列表上下文中返回一个空列表。

```
return unless @ret; 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-27T21:27:03.143

请注意，当数组的元素为零时，$#array 表达式将返回 -1。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-01-02T09:00:39.780

总结一下其他人，如果这样写，该代码会更清晰：

```
my @ret = someMethod();
return if $DB_ERROR;
return unless @ret; 
```

# windows - 具有开发人员许可证的旧版 MS 软件？

> ID：241396
> 
> 赞同：4
> 
> 时间：2008-10-27T21:07:15.540
> 
> 标签：windows, testing

我生产服务器软件，到目前为止，所有 Linux 环境都很好，无论是生产环境还是部署目标。但是，我希望在未来提供更广泛的目标环境选择，并且我还计划使用和生成 Office 文档的功能。

作为第一步，我正在寻找一种在我的测试设置中获得一些 MS 软件产品（XP、Vista、Server 2003 和 2008、Office 2000、2003 和 2007 ......）的好方法，这样我就可以开始玩了。

到目前为止，我从阅读有关 MS 的合作伙伴计划（又名 Action Pack）的内容中得到了很好的印象。该网站告诉我的唯一信息是旧软件版本。由于我想模仿可能的客户设置并且总是有很多人运行旧版本，这对于测试场景非常重要。

最终，我将在 Apple OS X 上遇到类似的问题，所以如果有人对此有一些提示，我也会很高兴。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-27T21:11:49.977

我真的认为您正在寻找 MSDN 订阅，通过 MSDN 订阅，您可以访问旧软件并用于开发/测试。

我会阅读 MSDN 网站上的详细信息。他们列出了操作系统版本和您可以随每个版本获得的项目。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-27T21:14:29.987

作为 Microsoft 认证合作伙伴，您可以访问 MSDN 订阅者下载。在那里，您将找到所有 (?) 版本的 windows 回到 3.1 和大多数版本的 office（回到 office 95，但不包括 Office 2000）。

许可证允许您将软件用于开发，但不能用于生产，因此您应该可以使用它。

# continuous-integration - 持续集成：您如何将构建与需求/任务/错误联系起来？

> ID：241397
> 
> 赞同：8
> 
> 时间：2008-10-27T21:07:22.327
> 
> 标签：continuous-integration, task, traceability

您如何回答团队中的经理、测试人员和其他人员提出的以下问题：

在哪个版本中修复了错误 #829？在我们当前的测试版本中完成了哪些任务？

简而言之，从报告报告到部署，您如何实现需求、任务和错误的可追溯性？您正在使用哪些流程、工具和技术来实现这一目标？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-27T21:14:13.780

我们在公司中使用带有[SVN的](http://subversion.tigris.org/)[TRAC](http://trac.edgewall.org/)并执行每日滚动构建到 DEV / STAGING 和 STABLE 环境，并定期安排部署（每月一次...... ish）到生产环境。

当一个错误被报告时，它被输入到 TRAC 并给出一个门票编号（例如 #1001）

修复错误后，代码将使用 SVN Checkin 注释中的票号 (#1001) 重新签入 SVN。

开发人员记下 SVN Changeset 编号（例如 [5000]）并打开 TRAC web ui。关闭工单时，他们将变更集编号放在工单的注释中。

这样，SVN checkin 引用票证...并且票证引用 SVN Checkin。

然后，我们的日常构建针对 SVN 变更集执行（例如，今天的构建是变更集 [5050] 的所有内容），并在我们的部署通知中对此进行了说明。

```
Deployed On   |  Environment            | Changeset
--------------+-------------------------+--------------------------
10-01-2008    |  DEV                    | 5100
10-01-2008    |  STAGING                | 5080
10-01-2008    |  STABLE                 | 5050
01-01-2008    |  PRODUCTION             | 5000 
```

这样，测试人员在检查修复以进行测试时，可以通过票证评论中的变更集了解他们正在查看的构建是否包含修复。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-27T21:18:26.390

我们将 TFS 与 JetBrains 的 TeamCity 结合用于 CI。

将签入与任务关联时，我们的自定义签入策略会将关联的任务和错误及其 ID 和标题添加到签入注释中。

然后使用这些注释生成发行说明，这些说明会为每个构建自动生成。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-27T21:09:35.597

我们使用已修复的缺陷编号或已实施的增强编号标记源代码控制签入。

通过检索两个构建之间的签入日志，您可以确定已实施或修复的内容。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-27T21:30:00.453

我们使用名为 Beanstalk ( [http://www.beanstalkapp.com/](http://www.beanstalkapp.com/) ) 的托管 SVN 服务，它允许您轻松地与许多 Bug/Feature 管理系统配合使用。在我们的例子中，我们使用 Fog Creek 的 FogBugz 来达到这个目的。SVN/Beanstalk 允许您在签入构建时做笔记，这反过来会影响一个或多个[FogBugz](http://www.fogcreek.com/FogBugz/)案例的状态。

在客户端，我们使用 Tortoise SVN 和 Visual SVN 来管理本地客户端和 Beanstalk SVN 服务器的交互（Tortoise 提供实际服务，Visual SVN 提供 Tortoise SVN 和 MS Visual Studio 之间的集成）。

我强烈推荐这两种服务和 Tortoise/Visual SVN 客户端。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-27T21:52:29.490

我们正在使用具有内置颠覆集成的 Fogbugz。基本上有一个 Fogbugz 插件，可以在后台检查 SVN 签入。因此，如果您在签到时提供 Fogbugz-case id，它会自动与此签到相关联。

据我所知，您不需要任何特殊应用程序（例如 Beanstalk）。

反过来就有点棘手了。在我们公司有一个约定，对于每个（未来或过去）构建，Fogbugz 中都有一个“发布”。如果您修复了错误或实现了某个功能，您可以将案例分配给正确的版本。

然后很容易获得构建 X 的所有实现功能的列表。

# c# - WinForms 中的标题控件 - 有这样的东西吗？

> ID：241399
> 
> 赞同：5
> 
> 时间：2008-10-27T21:07:49.767
> 
> 标签：c#, winforms, listview

我正在尝试使用 Windows 本机（主题感知）标题控件来显示一些列标题。主要目的是避免手动绘制列标题并依赖本机支持的功能。

所以我想到的两个选项是：

1.  使用`HeaderControl`, 并向其添加列（我似乎找不到 WinForms 支持的标题控件）。

2.  使用`ListView`控件，并告诉它不显示任何行（或基本上将其高度设置为列标题的高度） - 找不到任何方法来确定我应该为控件分配哪个高度。

任何好的想法都非常感谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T20:03:43.500

`HeaderControl`到目前为止，.NET 框架中还没有WinForms（`ListView`使用`ColumnHeader`该类，但这仅对 .NET 有用`ListView`）。如果您只针对 Microsoft Windows，您可以考虑包装 Win32 控件以在 .NET 中使用，尽管我预计这将是一项实质性工作。

您的第二个选项是一种有效的可能性，即使它感觉有些笨拙。我可以看到在正确调整列表大小以使标题和只有标题可见时出现的困难。

第三种选择是滚动你自己`HeaderButton`的代表一列（如`ColumnHeader`）并使用主题绘图调用来绘制它，然后将它们组合在 a`FlowLayoutPanel`或`TableLayoutPanel`标题栏中。如果要调整大小，可以使该`HeaderButton`区域具有一个抓取区域，您可以拾取该区域并更改其宽度。

我认为第三个选项的创建相当简单，即使具有调整大小的能力，所以我建议采用这条路线（我什至可以在今晚回家时自己尝试一下）。

# javascript - 我可以在元素关闭之前定位它吗？

> ID：241402
> 
> 赞同：3
> 
> 时间：2008-10-27T21:08:20.453
> 
> 标签：javascript, jquery, html, css, dom

我想在不等待 DOM 加载的情况下向 body 标签添加一个类，但我想知道以下方法是否有效。我更关心有效性，而不是浏览器现在是否支持它。

```
<body>
  $("body").addClass("active");
  ...
</body> 
```

谢谢，史蒂夫

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-27T21:14:01.203

如果该元素在 DOM 中不存在，则搜索将无法找到它并且不会应用该操作。如果您不能在 $(document).ready() 函数中执行此操作，您可能想尝试将代码放在被引用的元素之后。我相信这会奏效。

```
<body>
   <div id='topStories'></div>
   <script type='text/javascript'>
     $('div#topStories').addClass('active');
   </script>
</body> 
```

如果您需要将类添加到正文中，我肯定会使用 $(document).ready()。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-27T22:01:53.010

简短的回答：这取决于。显然，根据我的测试，答案似乎是肯定的，这取决于你想要什么。我刚刚测试了这个：

```
<html>
<head>
    <style type="text/css">
        .foobar { background-color: #CCC; }
    </style>
</head>
<body>
    <script type="text/javascript">
        window.document.body.className = "foobar";
    </script>
    <div style="border: solid 1px"><br /></div>
    <script type="text/javascript">
    // happens before DOM is fully loaded:
        alert(window.document.body.className);
    </script>
    <span>Appears after the alert() call.</span>
</body>
</html> 
```

在 IE 7 中，当`alert()`发生时，值设置正确，但尚未应用样式（一旦 DOM 完成加载，它就会快速应用）。

在 Firefox 中，样式在发生时已被应用`alert()`。

无论如何，希望这对你有帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-28T01:29:12.687

[.elementReady() 插件](http://plugins.jquery.com/project/elementReady)似乎与您正在寻找的非常接近。

它通过使用`setInterval`循环进行操作，一旦`document.getElementById()`返回给定的元素就退出`id`。

您可能可以对该插件进行轻微修改（或提交更新/补丁）以允许通用选择器（至少对于“tagNames”）而不仅仅是`id`s.

我不相信有任何真正可靠的跨浏览器兼容方式来在加载元素之前对其进行寻址 - 除了这种`setInterval`黑客攻击

除非您能够像 @JasonBunting 建议的那样将您的 javascript 命令*放在目标元素中。*

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-28T00:52:24.807

基本上，答案是否定的。在 IE6 和 Firefox 2（我最有经验的浏览器）中，元素直到关闭标记之后才在 DOM 中（或者页面完成渲染，对于无效的 XHTML）。我知道 jQuery 提供了一种方便的方法，在大多数情况下似乎反应足够快以避免“闪烁”。你会像这样使用它：

```
<script>
  $(document).ready(function() {
    $("body").addClass("active");
  });
</script>
<body>
  ..
  ..
  ..
</body> 
```

但这就是javascript。

当然，在您提供的示例中，您可以轻松地完成相同的效果：

```
<body class="active">
</body> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-27T22:10:21.590

这非常有帮助。

把一个小现实世界放在这个问题上。

我假设不支持 JavaScript，然后用 JavaScript 覆盖。问题是，当我必须等待 DOM 加载之前，我的覆盖启动站点会在构建时经历闪烁阶段。我希望，如果我可以在加载站点的其余部分之前向 body 元素添加一个“活动”类，我将能够在页面呈现之前应用 JavaScript 假定样式。

我不想做的是添加它，然后在 Firefox4 出现时接到我不应该这样做的电话。

如果你看一下我建立的一个网站，你会发现它的降级很优雅，但那更容易让我烦恼（特别是如果一个广告挂起该网站）。我可以采用其他人的方法并假设使用 JS 构建它，但是来吧 - 这只是懒惰......

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-29T12:08:48.277

您可能会发现将类添加到 <html> 标记更容易，而不是向 <body> 标记添加类：

```
<script type="text/javascript">
    document.documentElement.className = 'active';
</script> 
```

# c++ - 如何使用 win32 api 获取域用户帐户列表？

> ID：241403
> 
> 赞同：3
> 
> 时间：2008-10-27T21:08:39.110
> 
> 标签：c++, winapi, active-directory

如何使用 win32 api 获取域用户帐户列表？

特别是，当计算机不是域控制器时，我无法获取此列表。相反，它是域的成员。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-27T22:26:06.287

查看 LDAP API。这将让您查询具有用户帐户列表的 LDAP 服务器。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T14:05:10.150

只需使用网络 API。

# .net - 如何在 .NET 中将字符串转换为字节数组？

> ID：241405
> 
> 赞同：74
> 
> 时间：2008-10-27T21:09:40.417
> 
> 标签：.net, string, bytearray

我有一个字符串，需要将其转换为 .NET 中的等效字节数组。

这应该很容易，但我有脑抽筋。

* * *

## 回答 #1

> 赞同：99
> 
> 时间：2008-10-27T21:11:37.823

[您需要使用编码](https://docs.microsoft.com/en-us/dotnet/api/system.text.encoding?redirectedfrom=MSDN&view=netframework-4.7.2)( `System.Text.Encoding`) 来告诉 .NET 您期望的输出是什么。例如，在[UTF-16 (= `System.Text.Encoding.Unicode`)](https://docs.microsoft.com/en-us/dotnet/api/system.text.encoding.unicode?view=netframework-4.7.2#System_Text_Encoding_Unicode)中：

```
var result = System.Text.Encoding.Unicode.GetBytes(text); 
```

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2008-10-27T21:33:07.063

首先确定您想要哪种编码：您需要先了解[一些关于 Unicode 的](http://pobox.com/~skeet/csharp/unicode.html)知识。

接下来找出[`System.Text.Encoding`](http://msdn.microsoft.com/en-us/library/system.text.encoding.aspx)对应的。我的[Core .NET refcard](http://refcardz.dzone.com/refcardz/coredotnet)描述了大多数常见的，以及如何获取实例（例如，通过静态属性`Encoding`或调用[`Encoding.GetEncoding`](http://msdn.microsoft.com/en-us/library/system.text.encoding.getencoding.aspx).

最后，确定您是否需要一次获得所有字节（这是最简单的工作方式 - 调用一次[Encoding.GetBytes(string)](http://msdn.microsoft.com/en-us/library/system.text.encoding.getbytes.aspx)就完成了）或者是否需要将其分成块 - 在这种情况下，您我想使用[Encoding.GetEncoder](http://msdn.microsoft.com/en-us/library/system.text.encoding.getencoder.aspx)然后一次编码一点。例如，编码器负责保持调用之间的状态，以防您需要在字符中途中断。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-10-27T21:29:12.313

您使用的是什么编码？康拉德已经搞定了，但是还有其他的，你可能会用错误的结果得到愚蠢的结果：

```
byte[] bytes = System.Text.Encoding.XXX.GetBytes(text) 
```

`XXX`可以在哪里：

```
ASCII
BigEndianUnicode
Default
Unicode
UTF32
UTF7
UTF8 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-10-27T21:11:44.673

像这样：

```
 string test = "text";
    byte[] arr = Encoding.UTF8.GetBytes(test); 
```

# .net - 从 SQL XML 列中的元素获取属性名称

> ID：241407
> 
> 赞同：6
> 
> 时间：2008-10-27T21:11:25.750
> 
> 标签：.net, sql-server, xml, xpath, sqlclr

对于此 xml（在 SQL 2005 XML 列中）：

```
<doc>
 <a>1</a>
 <b ba="1" bb="2" bc="3" />
 <c bd="3"/>
<doc> 
```

我希望能够检索属性的名称（ba、bb、bc、bd），而不是*SQL Server 2005*中的值。好吧，XPath 确实允许使用 name() 进行此操作，但 SQL 不支持此操作。这是我对在 SQL 中使用 XML 的主要抱怨；您必须弄清楚 XML/Xpath/XQuery 规范的哪些部分在其中。

我能想到的唯一方法是构建一个 CLR proc，将 XML 加载到 XML Document (iirc) 中并运行 XPath 以提取节点的名称。我愿意接受这里的建议。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-11-11T16:19:42.183

```
DECLARE @xml as xml

SET @xml = 
'<doc>
 <a>1</a>
 <b ba="1" bb="2" bc="3" />
 <c bd="3"/>
</doc>'

SELECT DISTINCT
 CAST(Attribute.Name.query('local-name(.)') AS VARCHAR(100)) Attribute,
 Attribute.Name.value('.','VARCHAR(100)') Value
FROM @xml.nodes('//@*') Attribute(Name) 
```

回报：

属性值

巴 1

BB 2

公元前3

BD 3

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-27T23:12:41.543

```
DECLARE @xml as xml
DECLARE @path as varchar(max)
DECLARE @index int, @count int

SET @xml = 
'<doc>
 <a>1</a>
 <b ba="1" bb="2" bc="3" />
 <c bd="3"/>
</doc>'

SELECT @index = 1

SET @count = @xml.query('count(/doc/b/@*)').value('.','int')

WHILE @index <= @count 
BEGIN
    SELECT  @xml.value('local-name((/doc/b/@*[sql:variable("@index")])[1])', 'varchar(max)')
    SET @index = @index + 1
END 
```

对于元素“b”

它返回

*   巴
*   bb
*   公元前

您可以构建一个循环来获取 xml 中每个元素的属性。

顺便说一句，您的示例中的 XML 应该在关闭 doc 标记时关闭。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-11-03T12:43:53.203

这：

```
declare @xml as xml

set @xml = 
'<doc>
 <a>1</a>
 <b ba="1" bb="2" bc="3" />
 <c bd="3"/>
</doc>'

select @xml.query('
    for $attr in /doc/b/@*
    return local-name($attr)') 
```

返回：

ba bb bc

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2018-09-07T10:23:42.447

```
Declare @xml Xml = '<doc><a>1</a><b ba="1" bb="2" bc="3" /><c bd="3"/></doc>'

Select n.value('local-name(.)', 'varchar(max)')  from @xml.nodes('/doc/*/@*') a(n) 
```

返回 ba bb bc bd

# mobile - 如何在诺基亚 S60 SDK 模拟器中设置特定的 IMEI

> ID：241425
> 
> 赞同：1
> 
> 时间：2008-10-27T21:15:57.380
> 
> 标签：mobile, symbian, nokia, mobile-devices

我也对其他允许设置模拟器 IMEI 的 Symbian SDK 感兴趣。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T09:31:33.827

我对这类事情的一般方法是**在软件中进行**。

1.  将提取IMEI码放入一个全局可访问的函数中，该函数仅用于提取IMEI。
2.  **`#ifdef __WINS__`**可以在 C++ 代码中使用，以选择性地在您想要在模拟器中返回的硬编码 IMEI 中进行编译。在 Java 中，您可能可以通过其他方式告诉您自己在模拟器中（例如，如果返回的 IMEI 是模拟器中固定的怪异值），并采取相应的行动。
3.  您可以更进一步，拥有一个动态的 IMEI。一旦你这样做了，你会发现用不同的 IMEI 测试你的代码变得容易得多。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-27T11:06:23.420

模拟器的 IMEI 硬编码为“000000000000000”。用您想要使用的任何内容替换它并继续运行您的代码。

塞班 C++：

```
 TPlpVariantMachineId imei;
    PlpVariant::GetMachineIdL(imei); 
    imei.Copy(_L("123456789012345")); 
```

适用于 S60 (PyS60) 的 Python：

```
 import sysinfo
    my_imei = sysinfo.imei()
    my_imei = u"123456789012345" 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T11:57:03.887

我从未真正尝试过，但这是我最好的猜测：

模拟器没有适当的电话实现，除非：

*   您通过红外线/USB/串行将其链接到实际电话。在这种情况下，模拟器电话组件将需要配置以使用 AT 命令来引导电话（即使电话不是 Symbian 电话）。这使您可以拨打电话、发送和接收短信/彩信，但肯定不会更改 IMEI。

*   您使用 SIMTSY 模块。这是一个使用配置文件来模拟电话事件的组件。它可以假装发送短信/彩信，假装你正在接听电话……这些都不会真正造成任何类型的网络流量，你懂的。我假设 IMEI 在配置文件中，但我不希望您可以在不重新启动模拟器的情况下正确更改它。我从未见过 SIMTSY 在 Symbian 本身之外使用，所以我不知道它是否可供第三方开发人员使用。不过，它应该在未来 2 年内与操作系统的其余部分一起开源。

还有一种可能是 SDK 本身的构建方式禁用了模拟器的大部分电话框架，使用构建时宏。你应该检查[http://forum.nokia.com](http://forum.nokia.com)

# windows-installer - MSI中CHECKDB=FALSE是什么意思？

> ID：241450
> 
> 赞同：1
> 
> 时间：2008-10-27T21:23:41.793
> 
> 标签：windows-installer

当通过命令行运行 MSI 时，传递参数“CHECKDB=FALSE”的真正作用是什么？

MSI 当然可以是任何东西，从 Microsoft 到 Compuware DevPartner，再到程序员从 .NET 编译的 MSI。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-27T21:44:29.473

使用该参数运行 MSI 会将名为 CHECKDB 的公共属性设置为 false 值。我以前没有见过那个特定的财产，也没有在网上看到任何对它的引用。我怀疑它特定于您使用的 MSI。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-05-19T00:08:12.490

我不确定，但 CHECKDB 可能是添加到 Installshield 的默认模板文件的属性。由于许多设置都是基于这些模板进行的，因此您最终会在许多 MSI 文件中显示该属性。我怀疑它可能被 Installshield 的 SQLServer 部署功能使用，如果我猜测我认为将属性设置为 FALSE 会跳过一些与数据库部署相关的自定义操作。

# java - 如何在 JavaFX 中播放声音？

> ID：241453
> 
> 赞同：0
> 
> 时间：2008-10-27T21:24:43.180
> 
> 标签：java, audio, javafx, javafx-1

我正在尝试用 JavaFX 制作一个小游戏。

我想添加声音。如何？

我尝试`MediaPlayer`使用`media`相关`source`属性定义，例如：

```
attribute media = Media{
    source: "{__FILE__}/sound/hormpipe.mp3"        
}
attribute player = MediaPlayer{
    autoPlay:true
    media:media
} 
```

它不播放。我明白了

> `FX Media Object caught Exception com.sun.media.jmc.MediaUnavailableException: Media unavailable: file: ... Sound.class/sound/hormpipe.mp3`

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T17:04:51.330

只是一个猜测，但该文件是“hormpipe.mp3”而不是“hormpipe.mp3”（带有 m）吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T12:44:07.540

var player = javafx.scene.media.MediaPlayer { repeatCount: javafx.scene.media.MediaPlayer.REPEAT_FOREVER media: Media { source: "{__DIR__}clip.wav" }; }; 播放器.play();

您必须在 build/compiled 目录中包含音频文件，以便 Netbeans 可以将其打包到 jar 文件中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-19T15:34:50.860

另请注意，它`{__DIR__}`包含尾随 /，因此请尝试以下操作：

```
attribute media = Media{
source: "{__DIR__}sound/hormpipe.mp3"} 
```

编辑：我做了一些挖掘，显然，媒体对象的源必须是远程 URL 或绝对文件路径，因为 JAR 中不允许媒体文件（我希望将来的版本会改变这一点，因为我真的很喜欢 JavaFX，并希望能够用它制作桌面应用程序）。请参阅：[JavaFX 常见问题解答](http://javafx.com/faq/#5.3)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-01-02T19:32:20.847

这对我有用：

```
MediaPlayer audio = new MediaPlayer(
    new Media(
        new File("file.mp3").toURI().toString())); 
```

源文件应该在项目的根目录中（不是 src，不是 dist）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-06-02T11:28:08.577

只是猜测，但我认为您`{__FILE__}`将扩展为文件名。尝试将其替换为`{__DIR__}`.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-09-28T03:25:46.493

好的，使用这个问题让 MP3 音频正常工作（有点），我学到了以下内容（不多）。

1) 压缩格式的音频非常依赖于平台。我不断升级的 Mint 17.1->18 机器使用 Media 和 MediaPlayer 可以很好地播放 mp3。Mint 18 的全新安装不会（使用开发工具）。

所以使用 .wav 文件。

```
Media sound=new Media(new File("noises/roll.wav").toURI().toString());
MediaPlayer mediaPlayer=new MediaPlayer(sound);
mediaPlayer.play(); 
```

2) 使用 Media/MediaPlayer 需要注意的一件事是，为了多次播放（重复或一次全部播放，即按下按钮/游戏中的任何内容），您必须生成 N 个 MediaPlayer对象，每个对象将播放一次然后停止。

所以使用 javafx.scene.media.AudioClip

```
AudioClip soundMyNoise = new AudioClip(new File("noises/roll.wav").toURI().toString());
soundMyNoise.play(); 
```

AudioClip 也有它的问题，其中包括将原始音频数据一次性存储在 RAM 中，而不是缓冲。因此存在内存使用过多的可能性。

无论您最终采用哪种方法，**daevon**早些时候提到了一件需要严格注意的事情 - 路径问题。使用 NetBeans，您拥有 NetBeansProjects/yourproject/src/yourproject/foo.java。上例中的声音位于 NetBeansProjects/yourproject/noises/roll.wav

# java - 为 Java servlet 管理数据库连接的最佳方法

> ID：241454
> 
> 赞同：27
> 
> 时间：2008-10-27T21:24:58.123
> 
> 标签：java, database, servlets, connection

在 Java servlet 中管理数据库连接的最佳方法是什么？

目前，我只是在函数中打开一个连接`init()`，然后在`destroy()`.

但是，我担心“永久”保持数据库连接可能是一件坏事。

这是处理这个问题的正确方法吗？如果没有，有什么更好的选择？

编辑：提供更多说明：我尝试简单地为每个请求打开/关闭一个新连接，但是通过测试我发现由于创建太多连接而导致性能问题。

通过多个请求共享连接有什么价值吗？对这个应用程序的请求几乎都是“只读的”并且来得相当快（尽管请求的数据相当小）。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-05-25T16:27:51.203

正如大家所说，您需要使用连接池。为什么？怎么了？等等。

**您的解决方案有什么问题**

我知道这一点，因为从前我也认为这是一个好主意。问题有两个方面：

1.  所有线程（每个 servlet 请求由一个线程提供服务）将共享相同的连接。因此，请求将一次处理一个。即使您只是坐在单个浏览器中并靠在 F5 键上，这也很慢。试试看：这些东西听起来很高级和抽象，但它是经验性的和可测试的。
2.  如果连接因任何原因中断，则不会再次调用 init 方法（因为 servlet 不会停止服务）。不要尝试通过在 doGet 或 doPost 中放置 try-catch 来解决此问题，因为那样您将陷入困境（有点像在不被询问的情况下编写应用程序服务器）。
3.  与人们可能想的相反，事务不会有问题，因为事务开始与线程相关联，而不仅仅是连接。我可能是错的，但由于无论如何这是一个糟糕的解决方案，请不要担心。

**为什么连接池**

连接池为您提供了一大堆优势，但最重要的是它们解决了以下问题

1.  建立真正的数据库连接成本很高。连接池总是有一些额外的连接，并为您提供其中之一。
2.  如果连接失败，连接池知道如何打开一个新的
3.  非常重要：每个线程都有自己的连接。这意味着线程在它应该在的地方处理：在数据库级别。数据库非常高效，可以轻松处理并发请求。
4.  其他东西（如 JDBC 连接字符串的集中位置等），但在这方面有数百万篇文章、书籍等

**何时获得连接**

在您的服务委托（doPost、doGet、doDisco 等）中启动的调用堆栈中的某个地方，您应该获得一个连接，然后您应该做正确的事情并在 finally 块中返回它。我应该提一下，C# 的主要架构师曾经说过，你应该使用`finally`块 100 倍于`catch`块。真实的话从来没有说过...

**哪个连接池**

您在一个 servlet 中，因此您应该使用容器提供的连接池。除了获取连接的方式之外，您的 JNDI 代码将完全正常。据我所知，所有 servlet 容器都有连接池。

对上述答案的一些评论建议使用特定的连接池 API。您的 WAR 应该是可移植的并且“只需部署”。我认为这基本上是错误的。如果您使用容器提供的连接池，您的应用程序将可部署在跨多台机器的容器以及 Java EE 规范提供的所有花哨的东西上。是的，必须编写容器特定的部署描述符，但这是 EE 方式，mon。

一位评论者提到某些容器提供的连接池不适用于 JDBC 驱动程序（他/她提到了 Websphere）。这听起来完全牵强和荒谬，所以它可能是真的。当这样的事情发生时，把你“应该做”的一切都扔进垃圾箱，尽你所能。这就是我们得到报酬的原因，有时:)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-27T22:57:02.213

我实际上不同意使用 Commons DBCP。您应该真正遵从容器来为您管理连接池。

由于您使用的是 Java Servlet，这意味着在 Servlet 容器中运行，并且我熟悉的所有主要 Servlet 容器都提供连接池管理（Java EE 规范甚至可能需要它）。如果您的容器碰巧使用 DBCP（就像 Tomcat 一样），那很好，否则，只需使用您的容器提供的任何内容。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-27T21:40:31.057

我会使用[Commons DBCP](http://commons.apache.org/dbcp/)。这是一个为您管理连接池的 Apache 项目。

您只需在 doGet 或 doPost 中运行您的查询，然后在 finally 块中关闭连接。（con.close() 只是将它返回到池中，实际上并没有关闭它）。

DBCP 可以管理连接超时并从中恢复。如果您的数据库在任何时间段内出现故障，您当前的处理方式将不得不重新启动您的应用程序。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-27T21:35:02.177

你在汇集你的连接吗？如果没有，您可能应该减少打开和关闭连接的开销。

一旦这不碍事，只要它需要，只要保持连接打开，就像约翰建议的那样。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-27T21:35:23.173

最好的方法，我目前正在通过谷歌寻找更好的参考表，是使用池。

在初始化时，您创建一个包含 X 个数据库的 SQL 连接对象的池。将这些对象存储在某种列表中，例如 ArrayList。这些对象中的每一个都有一个用于“isLeased”的私有布尔值，一个表示上次使用时间的 long 和一个 Connection。每当您需要连接时，您都可以从池中请求一个。池要么为您提供第一个可用连接，检查 isLeased 变量，要么创建一个新连接并将其添加到池中。确保设置时间戳。完成连接后，只需将其返回到池中，这会将 isLeased 设置为 false。

为了避免经常有连接占用数据库，您可以创建一个工作线程，它偶尔会通过池并查看上次使用连接的时间。如果它已经足够长，它可以关闭该连接并将其从池中删除。

使用它的好处是，您无需等待 Connection 对象连接到数据库的时间很长。您已经建立的连接可以尽可能多地重复使用。您将能够根据您认为应用程序的繁忙程度来设置连接数。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-27T21:31:30.500

您应该只在需要时保持数据库连接打开，这取决于您正在做的事情可能在您的`doGet/doPost`方法范围内。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-27T22:15:53.873

与数据源关联的连接池应该可以解决问题。`doget`您可以在 servlet 请求方法（ /`dopost`等）中从 dataSource 获取连接。

dbcp、c3p0 和许多其他连接池可以满足您的需求。在合并连接时，您可能希望合并 Statements 和 PreparedStatements；此外，如果您是如您所指示的 READ HEAVY 环境，您可能希望使用 ehcache 之类的东西缓存一些结果。

BR，
~A

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-27T23:35:04.617

汇集它。

此外，如果您正在使用原始 JDBC，您可以查看一些可以帮助您管理 Connection、PreparedStatement 等的东西。除非您有非常严格的“轻量级”要求，例如，使用 Spring 的 JDBC 支持将简化您的代码很多-并且您不会被迫使用 Spring 的任何其他部分。

在此处查看一些示例：

[http://static.springframework.org/spring/docs/2.5.x/reference/jdbc.html](http://static.springframework.org/spring/docs/2.5.x/reference/jdbc.html)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-27T21:35:49.977

通常你会发现每个请求打开连接更容易管理。这意味着在您的 servlet 的 doPost() 或 doGet() 方法中。

在 init() 中打开它使其可用于所有请求，当您有并发请求时会发生什么？

# linq - 有谁知道有人在使用 LINQ-to-Memcached 提供程序？

> ID：241467
> 
> 赞同：5
> 
> 时间：2008-10-27T21:33:12.633
> 
> 标签：linq, caching, memcached

如题。无论如何，我没有通过谷歌找到一个。

更新：感谢两个答案的链接；这非常有用，但不是我想要的——我很想知道是否可以查询由 RDBMS 支持的 memcached（或其他一些分布式缓存）支持的 IRepository。我真的不知道这在实践中如何运作。我不太了解分布式缓存或 LINQ 提供程序的内部结构。

我可能正在设想类似于缓存 LINQ 提供程序根据查询自动生成缓存键（其中查询可以是 Expression> 或某种规范模式实现），并且基本上可以在我的应用程序和我的数据库之间进行填充。听起来有用吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-27T21:53:12.373

如果您不介意在它们之间使用[NHibernate](http://www.hibernate.org/343.html)，您可以使用[LINQ to NHibernate](http://ayende.com/Blog/archive/2007/03/16/Linq-for-NHibernate.aspx)来查询[可以设置](http://www.hibernate.org/hib_docs/nhibernate/1.2/reference/en/html/caches.html)为使用[memcached](http://www.hibernate.org/hib_docs/nhibernate/1.2/reference/en/html/caches.html)作为缓存的实体。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T08:00:59.407

I dont if this is what you want, you can check in this [website](http://latebound.blogspot.com/2008/10/using-memcached-from-c.html). In there you can query Memcached as well as query linq to object.

```
 public static IEnumerable<User> GetAllUsers()  
   {  
       // Retrieve from cache if it exists, otherwise run the query  
       return (from u in ctx.Users select u).CachedQuery("allusers");  
   } 
```

Is this what you want ?

Here is the source code

```
public static IEnumerable<T> CachedQuery<T>
        (this IQueryable<T> query, string key) where T : class
{
    if (cache.KeyExists(key))
    {
        return (IEnumerable<T>)cache.Get(key);
    }
    else
    {
        IEnumerable<T> items = query.ToList();
        cache.Set(key, items);
        return items;
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T08:11:01.977

因为我不知道 memcached 是什么，所以我四处搜索并找到了这个链接：

[http://latebound.blogspot.com/2008/10/using-memcached-from-c.html](http://latebound.blogspot.com/2008/10/using-memcached-from-c.html)

其中在底部附近有一个关于在 memcached 上使用 LINQ 查询的部分。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-23T03:49:33.200

我也遇到了一些用于 memcached 的 linq 问题。但是您应该检查 linq DBML 的序列化是否是单向的。

您可能对这个解决方案很幸运，值得一试。对我来说，我对 linq 有问题，但其他具有 [Serilizable] 属性的对象工作正常。

# c# - 时间序列的“加入”

> ID：241470
> 
> 赞同：3
> 
> 时间：2008-10-27T21:34:31.913
> 
> 标签：c#, linq, linq-to-objects, time-series

我正在设计一个简单的内部框架来处理时间序列数据。鉴于 LINQ 是我目前的玩具锤，我想用它击打所有东西。

我想在 TimeSeries 类中实现方法（Select()、Where() 等），这样我就可以使用 LINQ 语法来处理时间序列数据

有些事情是直截了当的，例如（从 A 中的 x 选择 x+10），给出一个新的时间序列。

组合两个或多个时间序列的最佳语法设计是什么？(from a in A from b in B select a+b) 不是很好，因为它表示一个嵌套循环。也许有人加入？这应该对应于隐式时间变量的连接。（我想到的对应 lisp 'zip' 功能）

* * *

**编辑：** *一些澄清是必要的。*

时间序列是一种依赖于时间的函数，例如股票报价。时间序列的组合可能是两个股票价格之间的差异，作为时间的函数。

```
Stock1.MyJoin(Stock2, (a,b)=>a-b) 
```

是可能的，但是可以使用一些 LINQ 语法巧妙地表达吗？我期待自己实现 LINQ 方法`class MyTimeSeries`。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-27T21:38:20.533

`Union`听起来是正确的方法 - 不支持查询表达式，但我认为它表达了你的意思。

您可能有兴趣查看[MiscUtil](http://pobox.com/~skeet/csharp/miscutil)中基于 Range 的类，这些类可以很好地使用。结合一点扩展方法的乐趣，你可以做到：

```
foreach (DateTime day in 19.June(1976).To(DateTime.Today).Step(1.Day()))
{
    Console.WriteLine("I'm alive!");
} 
```

我并不是建议这应该取代你正在做的任何事情，只是你可以采取一些想法让它变得更整洁。也可以随意回馈:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-27T22:27:35.893

从我的[NExtension](http://www.codeplex.com/nextension)项目：

```
public static IEnumerable<TResult> Zip<T1, T2, TResult>(
    this IEnumerable<T1> source1, 
    IEnumerable<T2> source2, 
    Func<T1, T2, TResult> combine)
{
    if (source1 == null)
        throw new ArgumentNullException("source1");
    if (source2 == null)
        throw new ArgumentNullException("source2");
    if (combine == null)
        throw new ArgumentNullException("combine");

    IEnumerator<T1> data1 = source1.GetEnumerator();
    IEnumerator<T2> data2 = source2.GetEnumerator();
    while (data1.MoveNext() && data2.MoveNext())
    {
        yield return combine(data1.Current, data2.Current);
    }
} 
```

语法是：

```
Stock1.Zip(Stock2, (a,b)=>a-b) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-27T22:31:29.393

Bjarke，看看 NEsper，它是一个开源的复杂事件处理应用程序，其中包括类似 SQL 的时间序列查询。您可以了解他们是如何做到的，或者甚至可以利用他们的代码来实现您的目标。链接在这里[http://esper.codehaus.org/about/nesper/nesper.html](http://esper.codehaus.org/about/nesper/nesper.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-27T22:15:09.367

如果我正确理解了这个问题，您想根据它们在序列中的位置加入多个序列吗？

类中没有任何东西`System.Linq.Enumerable`可以做到这一点，因为`Join`和`GroupJoin`方法都是基于连接键的。但是，巧合的`PositionalJoin`是，几天前我为此目的编写了一个方法，在您的示例中使用：

```
sequenceA.PositionalJoin(sequenceB, (a, b) => new { a, b }); 
```

下面显示的方法的语义是它不需要序列长度相等，但是修改它以要求它是微不足道的。我还注释掉了参数检查的位置，因为它使用了我们的内部帮助类。

```
public static IEnumerable<TResult> PositionalJoin<T1, T2, TResult>(
    this IEnumerable<T1> source1, 
    IEnumerable<T2> source2, 
    Func<T1, T2, int, TResult> selector)
{
    // argument checking here
    return PositionalJoinIterator(source1, source2, selector);
}

private static IEnumerable<TResult> PositionalJoinIterator<T1, T2, TResult>(
    IEnumerable<T1> source1, 
    IEnumerable<T2> source2, 
    Func<T1, T2, TResult> selector)
{
    using (var enumerator1 = source1.GetEnumerator())
    using (var enumerator2 = source2.GetEnumerator())
    {
        bool gotItem;
        do
        {
            gotItem = false;

            T1 item1;
            if (enumerator1.MoveNext())
            {
                item1 = enumerator1.Current;
                gotItem = true;
            }
            else
            {
                item1 = default(T1);
            }

            T2 item2;
            if (enumerator2.MoveNext())
            {
                item2 = enumerator2.Current;
                gotItem = true;
            }
            else
            {
                item2 = default(T2);
            }

            if (gotItem)
            {
                yield return selector(item1, item2);
            }
        }
        while (gotItem);
    }
} 
```

不确定这是否正是您正在寻找的，但希望能有所帮助。

# jquery - 使用 jQuery 的最佳参考资料是什么？

> ID：241479
> 
> 赞同：5
> 
> 时间：2008-10-27T21:38:52.357
> 
> 标签：jquery, reference

我对您找到的学习和使用 jQuery 的最佳开发参考感兴趣。书籍、网站等都是受欢迎的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-27T21:39:50.233

[jQuery在](http://www.manning.com/bibeault/)行动

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-27T21:40:43.803

我发现[官方文档](http://docs.jquery.com/Main_Page)和[VisualJQuery](http://visualjquery.com/)参考资料都非常可靠。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-27T21:43:48.150

请参阅[在哪里可以找到开始学习 jQuery 的教程？](https://stackoverflow.com/questions/168802/where-can-i-find-a-tutorial-to-get-started-learning-jquery#168810)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-27T21:40:48.373

到目前为止，最好的参考是[jQuery 文档页面](http://docs.jquery.com/Main_Page)本身 :)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-27T21:50:56.997

Rick Strahl 的[jQuery 文章](http://www.west-wind.com/Weblog/ShowPosts.aspx?Category=jQuery) Dave Ward 的[jQuery](http://encosia.com/category/jquery/)文章也可以 查看[.Net Answers 博客](http://blog.dmbcllc.com/tag/jquery/)

# blogs - Movable Type mt-*.cgi 脚本的用途？

> ID：241502
> 
> 赞同：1
> 
> 时间：2008-10-27T21:46:15.290
> 
> 标签：blogs, movabletype

我在[Movable Type](http://movabletype.org/)之上构建了一个额外的层，用于与另一个系统集成。其中一部分涉及在请求到达 MT 脚本之前对请求进行预处理和过滤（评论控制、将外部用户转换为 MT 用户等）。

例如，对帖子的新评论会在请求传递到之前提交到新层中的脚本`mt-comments.cgi`。在这种情况下，我拒绝`mt-comments.cgi`从除特定 IP 之外的所有 IP 访问，因为我不希望人们能够“直接”发布新评论。

我想知道所有`mt-*.cgi`脚本的一般用途，以便我可以拒绝访问那些不相关的脚本并控制对所有其他脚本的访问。

我拥有的`mt-*.cgi`脚本及其（估计的）目的是：

```
*脚本* *私人访问？* *目的*
mt-add-notify.cgi ? ?
mt-atom.cgi ? ?
mt.cgi 是 主 MT 引擎
mt-check.cgi ? ?
mt-comments.cgi 是 处理入站新评论
mt-config.cgi 是 存储主要 MT 配置
mt-feed.cgi ? ?
mt-ftsearch.cgi ? ?
mt-search.cgi 是 处理搜索请求，返回结果
mt-tb.cgi ? ?
mt-testbg.cgi ? ?
mt-upgrade.cgi 是 升级工具
mt-wizard.cgi 是 设置/配置向导
mt-xmlrpc.cgi ? ?

```

我将不胜感激填写空白的答案。

通过“私人访问”，我的意思是：是否*可以将*访问限制（例如通过.htaccess）仅限于一组已知的IP？与此相反的是：所有 IP 都*必须*可以访问吗？

始终欢迎明确详细说明脚本的目的和用途的答案，以便对其他人有用。

非常感谢任何可以提供帮助的人！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-05T03:17:13.973

我已经填写了每一个的目的。我很确定只要您正确代理请求，一切都可以是私有的，但不是积极的。其中一些脚本可以（并且应该）被完全屏蔽。

```
*Script*             *Private access?*   *Purpose*
mt-add-notify.cgi     ?                   Provide Movable Type email notification support
mt-atom.cgi           ?                   An Atom Publishing API interface for communicating with Movable Type.
mt.cgi                Yes                 Main MT engine
mt-check.cgi          ?                   Determines whether you have all of the components you need to run Movable Type
mt-comments.cgi       Yes                 Handles inbound new comments
mt-config.cgi         Yes                 Stores main MT configuration
mt-feed.cgi           ?                   Movable Type application for producing activity feeds. 
mt-ftsearch.cgi       ?                   Freetext search
mt-search.cgi         Yes                 Handles search requests, returns results
mt-tb.cgi             ?                   Handles blog trackbacks
mt-testbg.cgi         ?                   Tests for background tasks
mt-upgrade.cgi        Yes                 Upgrade tool
mt-wizard.cgi         Yes                 Setup/config wizard
mt-xmlrpc.cgi         ?                   XML RPC interface (external blog tool posting) 
```

我知道其中的一些，但找出每个模块的作用的最简单方法是打开文件并查看它调用的 Perl 模块（例如 at `MT::Trackback`），然后`perldoc lib/MT/Trackback.pm`为每个模块运行。它将为您提供有关每个脚本可以做什么的各种信息。

# python - 使用 Universal Feed Parser 读取 RSS 提要中的扩展元素集合

> ID：241503
> 
> 赞同：4
> 
> 时间：2008-10-27T21:46:19.207
> 
> 标签：python, rss, adobe, feed

有没有办法使用[Universal Feed Parser](http://www.feedparser.org/)读取扩展元素的集合？

这只是 Kuler RSS 提要的一个简短片段：

```
<channel>
  <item>
    <!-- snip: regular RSS elements -->
    <kuler:themeItem>
      <kuler:themeID>123456</kuler:themeID>
      <!-- snip -->
      <kuler:themeSwatches>
        <kuler:swatch>
          <kuler:swatchHexColor>FFFFFF</kuler:swatchHexColor>
          <!-- snip -->
        </kuler:swatch>
        <kuler:swatch>
          <kuler:swatchHexColor>000000</kuler:swatchHexColor>
          <!-- snip -->
        </kuler:swatch>
      </kuler:themeSwatches>
    </kuler:themeItem>
  </item>
</channel> 
```

我尝试了以下方法：

```
>>> feed = feedparser.parse(url)
>>> feed.channel.title
u'kuler highest rated themes'
>>> feed.entries[0].title
u'Foobar'
>>> feed.entries[0].kuler_themeid
u'123456'
>>> feed.entries[0].kuler_swatch
u'' 
```

`feed.entries[0].kuler_swatchhexcolor`只返回最后一个`kuler:swatchHexColor`。有没有办法用 检索所有元素`feedparser`？

我已经通过使用 minidom 解决了这个问题，但如果可能的话，我想使用 Universal Feed Parser（由于 API 非常简单）。可以延长吗？我在文档中没有找到任何关于此的内容，所以如果有人对图书馆有更多的经验，请告诉我。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-28T04:23:48.747

Universal Feed Parser 对于大多数的 feed 来说真的很不错，但是对于扩展的 feed，你可能想尝试一些叫做[BeautifulSoup](http://crummy.com/software/BeautifulSoup)的东西。它是一个最初为屏幕抓取而设计的 XML/HTML/XHTML 解析库；事实证明，这种事情也很出色。文档非常好，并且它有一个不言自明的 API，所以如果您正在考虑使用其他任何东西，这就是我的建议。

我可能会这样使用它：

```
>>> import BeautifulSoup
>>> import urllib2

# Fetch HTML data from url
>>> connection = urllib2.urlopen('http://kuler.adobe.com/path/to/rss.xml')
>>> html_data = connection.read()
>>> connection.close()

# Create and search the soup
>>> soup = BeautifulSoup.BeautifulSoup(html_data)
>>> themes = soup.findAll('kuler:themeitem') # Note: all lower-case element names

# Get the ID of the first theme
>>> themes[0].find('kuler:themeid').contents[0]
u'123456'

# Get an ordered list of the hex colors for the first theme
>>> themeswatches = themes[0].find('kuler:themeswatches')
>>> colors = [color.contents[0] for color in
... themeswatches.findAll('kuler:swatchhexcolor')]
>>> colors
[u'FFFFFF', u'000000'] 
```

所以你可能会觉得这是一个非常酷的库。如果您正在解析任何旧的 RSS 提要，这不会太好，但由于数据来自 Adob​​e Kuler，您可以确定它不会变​​化到足以破坏您的应用程序（即它是一个足够受信任的来源）。

更糟糕的是试图解析 Adob​​e 的该死的 .ASE 格式。我尝试为它编写一个解析器，它变得非常可怕，非常快。呃。所以，是的，RSS 提要可能是与 Kuler 交互的最简单方式。

# cocoa - 如何在 Cocoa/IB 中实现类似于 Mail/iTunes/Finder/etc 的侧边栏？

> ID：241507
> 
> 赞同：22
> 
> 时间：2008-10-27T21:49:05.487
> 
> 标签：cocoa, interface-builder

我认为标题几乎说明了一切......我正在寻找一个类似于上述所有程序中使用的标准 OS X 侧边栏的界面，我想知道是否有人对最简单的方法有任何想法要做到这一点，即关于左手选择窗格使用什么视图。真的，我认为我什至不需要在苹果应用程序中看到的分层组件，我只需要一个好看的平面选项列表来确定右侧窗格中显示的内容。

显而易见的开始是垂直拆分布局视图，但除此之外，我不完全确定该去哪里。只有一列或类似的集合视图？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-10-27T22:37:19.803

我已经完成了一些使用类似设置的应用程序。

我通常使用 NSSplitView，在左窗格中使用单列 NSTableView。不要忘记禁用标题，并使其显示为“源视图”样式。

如果你想要显示三角形，那么你会想要使用 NSOutlineView 而不是 NSTableView，但至少在第一次使用时，我会坚持使用简单的 NSTableView。

我还使用的一种模式是使 NSTableView 比 NSSplitView 略短，并在底部有按钮（添加、删除等）。我通常围绕核心数据构建程序，因此很容易将这些连接到创建/删除对象的方法，然后将 NSTableView 绑定到对象数组。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-10-28T00:36:17.567

Leopard 中添加了对此类事物的直接支持。它被称为“源列表”。

请参阅[AppKit 发行说明](http://developer.apple.com/releasenotes/Cocoa/AppKit.html)。在文档中搜索 NSTableViewSelectionHighlightStyleSourceList。

或者，拖出一个表格视图并`Highlight: Source List`在 Interface Builder 中选择。

# html - 管理内联列表项之间空格的最佳方法

> ID：241512
> 
> 赞同：34
> 
> 时间：2008-10-27T21:51:29.617
> 
> 标签：html, css, html-lists, navigation-style

我的HTML如下：

```
<ul id="nav">
    <li><a href="./">Home</a></li>
    <li><a href="/About">About</a></li>
    <li><a href="/Contact">Contact</a></li>
</ul> 
```

我的CSS：

```
#nav {
    display: inline;
} 
```

然而 li 之间的空白出现了。我可以通过像这样折叠它们来删除空格：

```
<ul id="nav">
    <li><a href="./">Home</a></li><li><a href="/About">About</a></li><li><a href="/Contact">Contact</a></li>
</ul> 
```

但这主要是手动维护的，我想知道是否有更清洁的方法。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-10-27T21:58:17.963

这里有几个选项，首先我会给你我在创建内联列表时的常规做法：

```
<ul id="navigation">
  <li><a href="#" title="">Home</a></li>
  <li><a href="#" title="">Home</a></li>
  <li><a href="#" title="">Home</a></li>
</ul> 
```

然后 CSS 使其按您的意图运行：

```
#navigation li 
  {
    display: inline;
    list-style: none;
  }
#navigation li a, #navigation li a:link, #navigation li a:visited
  {
    display: block;
    padding: 2px 5px 2px 5px;
    float: left;
    margin: 0 5px 0 0;
  } 
```

显然我省略了悬停和活动集，但这创造了一个很好的块级导航，并且是一种非常常见的方法，同时仍然符合标准。/* 记得根据自己的喜好进行调整，为背景添加颜色等等 */

如果您只想使用文本和内联保留它，我相信您不会添加任何块元素：

```
 margin: 0 5px 0 0; /* that's, top 0, right 5px, bottom 0, left 0 */ 
```

意识到您想删除空白，只需相应地调整边距/填充。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2010-09-01T10:57:53.540

消除空格的另一种有用方法是将列表的`font-size`属性设置为`0`并将列表元素的属性设置回所需的大小。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2010-06-29T18:05:28.060

你真正想要的是 CSS3 [white-space-collapse: discard](http://www.w3.org/TR/css3-text/#white-space-collapse)。但我不确定是否有任何浏览器真正支持该属性。

一些替代解决方案是让标签的尾部消耗空格。例如：

```
<ul id="nav"
    ><li><a href="./">Home</a></li
    ><li><a href="/About">About</a></li
    ><li><a href="/Contact">Contact</a></li
></ul> 
```

我见过的另一件事是使用 HTML 注释来消耗空格

```
<ul id="nav"><!--
    --><li><a href="./">Home</a></li><!--
    --><li><a href="/About">About</a></li><!--
    --><li><a href="/Contact">Contact</a></li><!--
--></ul> 
```

如果您可以使用浮点数，请参阅 thismat 的解决方案，并且根据您可能需要添加`<li>`设置为`clear: both;`.

但是 CSS3 属性可能是*最好*的理论方法。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2011-08-05T14:55:21.640

列表项的更好解决方案是使用：

```
#nav li{float:left; width:auto;} 
```

具有完全一样的视觉效果，不会让人头疼。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2011-01-31T09:29:58.400

采用非基于 XML 的 HTML 并省略`</li>`.

```
<ul id="nav">
    <li><a href="./">Home</a>
    <li><a href="/About">About</a>
    <li><a href="/Contact">Contact</a>
</ul> 
```

然后将项目的显示属性设置为 inline-block 而不是 inline。

```
#nav li {
    display: inline-block;
    /display: inline; /* for IE 6 and IE 7 */
    /zoom: 1; /* for IE 6 and IE 7 */
} 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2013-06-04T02:00:26.823

问题是 UL 中的字体大小。将其设置为 0 它将消失，但您不希望将实际文本设置得如此之小，因此请将您的 LI 字体大小设置为您想要的任何值。

```
<ul style="font-size:0px;">
<li style="font-size:12px;">
</ul> 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-10-10T20:16:20.460

我有同样的问题，以上解决方案都无法解决。但我发现这对我有用：

而不是这个：

```
<ul id="nav">
   <li><a href="./">Home</a></li>
   <li><a href="/About">About</a></li>
   <li><a href="/Contact">Contact</a></li>
</ul> 
```

像这样构建您的html代码（链接文本之前和之后的空格）：

```
<ul id="nav">
   <li><a href="./"> Home </a></li>
   <li><a href="/About"> About </a></li>
   <li><a href="/Contact"> Contact </a></li>
</ul> 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-01-30T06:41:26.973

```
<html>
<head>
<style>
ul li, ul li:before,ul li:after{display:inline;  content:' '; }
</style>
</head>
<body>
<ul><li>one</li><li>two</li><li>three</li></ul>
<ul>
    <li>one</li>
    <li>two</li>
    <li>three</li>
</ul>
</body>
</html> 
```

# sharepoint - 部署新的 Web 部件

> ID：241513
> 
> 赞同：2
> 
> 时间：2008-10-27T21:52:05.403
> 
> 标签：sharepoint, deployment, web-parts

我一直在尝试关注以下信息：

[长 URL 被剪裁以停止破坏页面](http://www.datasprings.com/Resources/ArticlesInformation/Sharepoint2007CustomWebParts/tabid/775/Default.aspx)

和

[http://msdn.microsoft.com/en-us/library/ms415817.aspx](http://msdn.microsoft.com/en-us/library/ms415817.aspx)

哪个或多或少有相同的说明。我一直在将 .dll 文件从构建复制到 Sharepoint 站点的 BIN 目录。

当我单击 Web 部件库并点击新建时，两篇文章都说 Web 部件应该显示在列表中。

我已经尝试了我能想到的所有可能的方式，但我的 Web 部件不会显示在该列表中。有没有我在某处错过的步骤？是否有我应该考虑的权限？Sharepoint 究竟如何识别有一个新的 Web 部件。仅仅是将程序集放在 BIN 目录中，还是将控件添加到 web.config 的安全列表中？

我已将其添加到安全控件列表中。我尝试了所有我能想到的不同组合，但没有任何效果。

我是否需要将 .DLL 程序集重命名为其他名称？

对于我的生活，我无法弄清楚这一点。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-27T22:00:30.393

我相信您需要在 webPart 目录的“新”部分中显示 WP 的最低要求，您需要“bin”文件夹中的 dll（web 目录中的 bin，而不是 12 hive :)）或GAC 和安全控制条目。我会验证安全控件条目：
Assembly = dll
的名称 NameSpace = 好... WebPart 类所在的 NameSpace
TypeName = webPart 类的名称

您可以通配 NameSpace 和 TypeName 以确保您到达那里：

`... Namespace="*" TypeName="*" ...`

我还建议签署程序集并放入 PublicKeyToken=...

此外，尝试将信任级别设置为 WSS_Medium 或 Full。

如果这不起作用，您可以尝试将 .webpart 文件添加到 Web 目录中的 wpCatalog 文件夹。

编辑：澄清

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-28T15:02:26.900

这必须是您的程序集与为安全控制条目输入 web.config 的内容不匹配。

安全控制条目区分大小写 - 最小的错误将停止显示在 Web 部件库的“新”列表中。

还要确保您正在编辑正确的 web.config！:-) 另一个常见的问题是您的 Web 部件类必须是公开的。

希望这可以帮助

尼克·斯旺

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-28T15:16:07.103

您是否尝试过使用 Microsoft 的[WPPackager 工具](http://msdn.microsoft.com/en-us/library/ms916841.aspx#sharepoint_deployingwebparts_msi_creatingamanifestfile)？自 v2003 以来，我没有接触过 SharePoint，而且我知道有一个方便的工具可用于该平台的 WP 部署。我会提供它的链接，但是 1) 我不记得它的名称，以及 2) 我不确定它是否是您的 SharePoint 版本的有效安装路径。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-28T01:02:33.600

哇，你把我难住了......我会尝试手动部署一些其他的第 3 方“免费”网络部件，看看你是否能让它们出现。这个网站有几个： [http ://www.sharepointblogs.com/mkruger/archive/2007/06/26/free-sharepoint-web-parts-3rd-party.aspx](http://www.sharepointblogs.com/mkruger/archive/2007/06/26/free-sharepoint-web-parts-3rd-party.aspx)

您是否确定`[assembly: AllowPartiallyTrustedCallers]` 在您的 AssemblyInfo 文件中设置：

我很惊讶没有其他人对此发表意见。我想下一步将尝试将其部署为功能/解决方案。

这是一个简单的 hello world wp 还是您正在做更多的事情？

老实说，我开始相信是您的 wss/moss 配置/设置目前阻碍了您的努力。您是否曾经成功地将 WP 部署到您的农场？... 这是 VPC 开发农场还是生产环境？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-03T19:08:49.437

在过去 2 周中，我一直在创建一些 Web 部件，但我没有使用 Web 部件库的“新建 Web 部件”部分。相反，我创建了一个 .dwp 文件（例如 MyWebPart.dwp），它或多或少是一个描述 Web 部件的 XML 文件，然后我将它手动导入到库中。

我的 .dwp 文件的格式通常如下所示：

```
<?xml version="1.0" encoding="utf-8"?>
<WebPart xmlns="http://schemas.microsoft.com/WebPart/v2" >
  <Title>My Sample Web Part</Title>
  <Description>This web part displays "Hello World" on the page.</Description>
  <Assembly>My.Assembly, Version=1.0.0.0, Culture=neutral, PublicKeyToken=3ed03eac7f647a61</Assembly>
  <TypeName>My.Assembly.MyWebPartClassName</TypeName>
  <!-- Specify initial values for any additional base class or custom properties here. -->
</WebPart> 
```

这当然假设您已将此程序集添加为“安全控制”。编译程序集并将其移至 SharePoint 计算机的 bin/GAC 后，返回 Web 部件库，单击“上传”，然后上传 .dwp 文件。上传后您必须指定一些属性。

假设您的 Web 部件存在于您的 .dll 中，那么您应该会看到它已添加到库列表中，并且您可以在此时预览它或将其添加到页面中。

# c++ - 如何确定字符串的大小在 wxWidgets 中给出当前字体

> ID：241516
> 
> 赞同：2
> 
> 时间：2008-10-27T21:53:49.703
> 
> 标签：c++, wxwidgets

有没有办法根据 (C++) wxWidgets 中当前选择的字体来确定给定字符串的显示长度（以像素为单位）？

例如，如果我打印出字符串“Speed:”并希望在 ':' 和后面的值之间放置 10 个像素，我需要知道“Speed:”字符串有多长。有没有办法确定这一点？我似乎在 API 文档中找不到任何东西，但我可能遗漏了一些东西。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-27T21:56:48.513

也许[http://docs.wxwidgets.org/stable/wx_wxdc.html#wxdcgettextextent](http://docs.wxwidgets.org/stable/wx_wxdc.html#wxdcgettextextent)？

注意：我不是 wxWidgets 用户。

# c# - 从字符串中剥离 WordML

> ID：241526
> 
> 赞同：2
> 
> 时间：2008-10-27T21:59:20.973
> 
> 标签：c#, asp.net, xml, rss, xslt

我的任务是为我公司的工作列表构建一个可访问的 RSS 提要。我已经从我们的招聘合作伙伴那里获得了 RSS 提要；所以我将他们的 RSS XML 转换为我们自己的代理 RSS 提要，以添加额外的数据以及限制提要中的项目数量，以便我们列出最新的工作。

RSS 通过 feedvalidator.org 进行验证（带有警告）；但问题是这样的。不幸的是，无论我告诉他们多少次不要这样做；我公司的人力资源团队在插入新的工作列表时直接将他们的 Word 文档复制并粘贴到我们的招聘合作伙伴 CMS 中，而 WordML 则留在了我的提要中。我相信这个 WordML 会导致 Feedburner 的 BrowserFriendly 功能出现问题；我们希望显示它以使人们更容易订阅。因此，我需要删除提要中的 WordML 标记。

有人有这样做的经验吗？谁能指出我解决这个问题的好方法？

优选；我想指出 .Net（VB 或 C# 很好）和/或 XSL 中的解决方案。

非常感谢您对此的任何建议。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T13:57:04.457

我还没有使用过 WordML，但假设它的元素位于与 RSS 不同的名称空间中，使用 XSLT 应该很简单。

从基本的身份转换（将输入文档中的所有节点“按原样”添加到输出树的样式表）开始。你需要这两个模板：

```
 <!-- Copy all elements, and recur on their child nodes. -->
  <xsl:template match="*">
    <xsl:copy>
      <xsl:apply-templates select="@*"/>
      <xsl:apply-templates/>
    </xsl:copy>
  </xsl:template>

  <!-- Copy all non-element nodes. -->
  <xsl:template match="@*|text()|comment()|processing-instruction()">
    <xsl:copy/>
  </xsl:template> 
```

使用仅包含上述两个模板的样式表的转换将准确地在输出上重现其输入文档，以符合标准的 XML 处理器允许更改的那些内容为模，例如实体替换。

现在，添加与 WordML 命名空间中的任何元素匹配的模板。为了这个例子的目的，让我们给它命名空间前缀'wml'：

```
 <!-- Do not copy WordML elements or their attributes to the 
       output tree; just recur on child nodes. -->
  <xsl:template match="wml:*">
    <xsl:apply-templates/>
  </xsl:template> 
```

样式表的开头和结尾留给编码人员练习。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T22:14:54.687

我会做这样的事情：

```
char[] charToRemove = { (char)8217, (char)8216, (char)8220, (char)8221, (char)8211 };
char[] charToAdd = { (char)39, (char)39, (char)34, (char)34, '-' };
string cleanedStr = "Your WordML filled Feed Text.";

for (int i = 0; i < charToRemove.Length; i++)
{
    cleanedStr = cleanedStr.Replace(charToRemove.GetValue(i).ToString(), charToAdd.GetValue(i).ToString());
} 
```

这将查找引用的字符，（哪些是 Word 特殊字符，会弄乱所有内容并用它们的 ASCII 等效字符替换它们。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T09:56:56.623

Jeff Attwood 不久前在博客中介绍了如何做到这一点。他的帖子包含一些可以清理 WordML 的 c# 代码。

[http://www.codinghorror.com/blog/archives/000485.html](http://www.codinghorror.com/blog/archives/000485.html)

# python - 我想要一个将所有可能的组合写入文本文件的不同行的程序

> ID：241533
> 
> 赞同：4
> 
> 时间：2008-10-27T22:03:06.677
> 
> 标签：python, recursion

我想编写一个程序，将一组变量的每个组合打印到一个文本文件中，创建一个单词列表。每个答案应写在单独的行上，并将 1 位、2 位和 3 位的所有结果写入单个文本文件。

有没有一种简单的方法可以编写一个可以完成此任务的 python 程序？这是打印 1、2 和 3 位可能的所有二进制数字组合时我期望的输出示例：

```
Output:
0  
1

00  
01  
10  
11

000  
001  
010  
011  
100  
101  
110  
111 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-27T22:12:51.977

```
# Given two lists of strings, return a list of all ways to concatenate
# one from each.
def combos(xs, ys):
    return [x + y for x in xs for y in ys]

digits = ['0', '1']
for c in combos(digits, combos(digits, digits)):
    print c

#. 000
#. 001
#. 010
#. 011
#. 100
#. 101
#. 110
#. 111 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-28T03:22:09.120

一个可以解决问题并且对于您可能拥有的任何应用程序都足够通用的简单解决方案是：

```
def combinations(words, length):
    if length == 0:
        return []
    result = [[word] for word in words]
    while length > 1:
        new_result = []
        for combo in result:
            new_result.extend(combo + [word] for word in words)
        result = new_result[:]
        length -= 1
    return result 
```

基本上，这会逐渐在所有组合的内存中建立一棵树，然后返回它们。然而，它是内存密集型的，因此对于大规模组合是不切实际的。

该问题的另一个解决方案确实是使用计数，但随后将生成的数字转换为单词列表中的单词列表。为此，我们首先需要一个函数（称为`number_to_list()`）：

```
def number_to_list(number, words):
    list_out = []
    while number:
        list_out = [number % len(words)] + list_out
        number = number // len(words)
    return [words[n] for n in list_out] 
```

事实上，这是一个将十进制数转换为其他基数的系统。然后我们编写计数函数；这相对简单，将构成应用程序的核心：

```
def combinations(words, length):
    numbers = xrange(len(words)**length)
    for number in numbers:
        combo = number_to_list(number, words)
        if len(combo) < length:
            combo = [words[0]] * (length - len(combo)) + combo
        yield combo 
```

这是一个 Python 生成器；使其成为生成器可以使其使用更少的 RAM。把数字变成单词列表后还有一点工作要做；这是因为这些列表需要填充，以便它们处于请求的长度。它将像这样使用：

```
>>> list(combinations('01', 3))
[['0', '0', '0'], ['0', '0', '1'],
['0', '1', '0'], ['0', '1', '1'],
['1', '0', '0'], ['1', '0', '1'],
['1', '1', '0'], ['1', '1', '1']] 
```

如您所见，您会返回一个列表列表。这些子列表中的每一个都包含一系列原始单词；然后，您可能会执行类似`map(''.join, list(combinations('01', 3)))`检索以下结果的操作：

```
['000', '001', '010', '011', '100', '101', '110', '111'] 
```

然后您可以将其写入磁盘；然而，一个更好的主意是使用生成器具有的内置优化并执行以下操作：

```
fileout = open('filename.txt', 'w')
fileout.writelines(
    ''.join(combo) for combo in combinations('01', 3))
fileout.close() 
```

这只会使用尽可能多的 RAM（足以存储一个组合）。我希望这有帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-27T22:06:54.967

在大多数语言中应该不会太难。以下伪代码有帮助吗？

```
for(int i=0; i < 2^digits; i++)
{
     WriteLine(ToBinaryString(i));
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-27T22:21:14.703

下面给出了产生列表所有排列的基本函数。在这种方法中，排列是通过使用生成器懒惰地创建的。

```
def perms(seq):
    if seq == []:
        yield []
    else:
        res = []
        for index,item in enumerate(seq):
            rest = seq[:index] + seq[index+1:]
            for restperm in perms(rest):
                yield [item] + restperm

alist = [1,1,0]
for permuation in perms(alist):
    print permuation 
```

# linq-to-sql - LinqToSql 最佳实践

> ID：241535
> 
> 赞同：7
> 
> 时间：2008-10-27T22:03:55.817
> 
> 标签：linq-to-sql

我刚刚开始使用 LinqToSql 创建我的数据访问层。每个人都在谈论很酷的语法，我真的很喜欢 Linq。

但是当我看到如果你在 LinqContext 上拖动一些表时你的类是如何生成的，我很惊讶：这么多没人需要的代码？！

所以我查看了其他人如何使用 LinqToSql，例如 Rob Connery 在他的 StoreFront Demo 中。

因为我不喜欢生成所有这些代码的方式，所以我手动创建了我的域层并使用生成的类作为参考。使用该解决方案我很好，因为我可以使用 Linq 提供的功能（延迟执行、延迟加载……），而且我的域层很容易理解。

你是如何使用 LinqToSql 的？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-27T22:11:38.607

创建的类并不像看起来那么重。当然，它需要相当多的代码行，但总而言之，对于它提供的功能来说，它是尽可能轻量级的。

我以前也创建自己的表，但现在我只使用 LINQtoSQL DataContext。为什么？创建更简单，功能更好，互操作性有效，它可能甚至比我自己的东西更快（不是在所有方面。通常我自己的东西在一件事上非常快，但通用的东西在其他所有方面都更快）。
但最重要的部分是：将新开发人员引入 LINQ 比引入我自己的要容易。有教程、示例代码、文档等等，我必须自己为我的代码创建。将我的东西与其他技术（如 WCF 或数据绑定）一起使用也是如此。有很多陷阱需要注意。

我学会了不让自己陷入困境，一开始看起来又快又容易，比学习如何使用库有趣得多，但几个月后真的很痛苦，通常甚至是我自己。

一段时间后，创建自己的数据容器的新鲜感消失了，我注意到与添加功能相关的痛苦。如果我使用了提供的课程，我将免费拥有一个功能。
接下来我必须向其他程序员解释我的代码。如果我使用提供的课程，我可以将他指向一些网站来了解这些东西。但是对于我的课程，我必须亲自训练他，这需要很长时间，并且很难让新人参与一个项目。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-27T22:51:43.333

LinqToSql 为您的表生成一组部分类。您可以将接口定义添加到实现域模型的这些部分类的“另一半”。

然后，如果您使用存储库模式来包装对 Linq 查询的访问，以便它们返回您的对象（底层 Linq 对象）的接口实现，LinqToSql 变得非常灵活。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T00:56:10.913

您可以手动编写自己的类，并使用 LINQ to SQL 属性来声明映射或外部 XML 文件。

如果您想坚持使用现有设计器并只修改代码生成过程，请选择我的[模板，让您定制生成的代码](http://damieng.com/blog/2008/09/14/linq-to-sql-template-for-visual-studio-2008)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-27T22:28:17.687

使用编译查询。否则，Linq to SQL 会很慢。[真的](http://blogs.msdn.com/ricom/archive/2007/06/22/dlinq-linq-to-sql-performance-part-1.aspx)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-27T22:39:48.677

我们使用我们手工制作的域模型以及生成的类，以及一个简单的实用程序，该实用程序在需要时利用反射在它们之间进行转换。如果我们达到反射造成性能瓶颈的地步，我们已经考虑编写一个转换器生成器。

# .net - 终结器线程的范围是什么 - 每个应用程序域或每个进程？

> ID：241537
> 
> 赞同：14
> 
> 时间：2008-10-27T22:04:26.640
> 
> 标签：.net, multithreading, process, appdomain, finalizer

根据我所有的阅读，应该有一个 GC 线程来调用所有终结器。现在，问题是这个“一个”线程的范围是什么——每个进程或每个应用程序域，因为域的全部意图是在一个进程空间中分离并制作“独立”的不同应用程序。

[我在这里](http://dn.codegear.com/article/29365#MoreFinalizerIssues)读到：

> 如果在终结器中发生未处理的异常，CLR 的执行线程将吞下该异常，将终结器视为正常完成，将其从易碎队列中删除并移至下一个条目。
> 
> 更严重的是，如果你的终结器由于某种原因没有退出会发生什么，例如它阻塞，等待一个永远不会发生的条件。**在这种情况下，终结器线程将被挂起，因此不再有可终结的对象被垃圾收集。**您应该非常了解这种情况，并坚持编写最简单的代码来释放终结器中的非托管资源。
> 
> 另一个考虑因素是应用程序关闭期间会发生什么。当程序关闭时，垃圾收集器将努力调用所有可终结对象的终结器，但有一定的限制：
> 
> *   在关闭期间，可终结对象不会提升到更高的堆代。
>     
>     
> *   任何单独的终结器将有最多 2 秒的时间来执行；如果需要更长的时间，它将被杀死。
>     
>     
> *   所有终结器的执行时间最长为 40 秒；如果此时任何终结器仍在执行或未决，则整个过程会突然终止。

太多帖子（甚至官方文档）滥用术语“应用程序”、“进程”和“应用程序域”——其中大多数甚至假设它们是相等的，因为通常应用程序在单个进程中的单个应用程序域中运行. 这种滥用使所有这些文档都难以阅读，甚至没有用处。

因此，我的问题假设有多个应用程序，每个应用程序都在单个进程的单独应用程序域中运行。

所有这些应用程序是否共享相同的 GC 和终结器线程？上面文章中描述的问题（挂起终结器线程）会影响该进程中的所有应用程序吗？如果是 - 是否有解决方法（除了不使用不良应用程序），例如以某种方式发现终结器线程并将其发送 Thread.Abort？

以上都是因为我遇到了类似的问题。我的应用程序作为第三方软件 (Outlook) 的插件在单独的应用程序域中运行。由于各种原因，我需要调用 GC.Collect 和 GC.WaitForPendingFinalizers 来完全释放 COM 引用（通常的互操作例程对于 Office/Outlook 来说是不够的），当某个特定的其他第三方插件运行时，我的 GC.WaitForPendingFinalizers 永远挂起，所以我怀疑第三方添加中有一个“坏”的终结器。我无法控制替换/删除添加（客户的要求），所以我必须自己弄清楚如何使它们共存。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-27T23:02:01.830

看起来它确实只是进程中每个 CLR 实例的一个线程——无论如何，目前。这里有一些代码可以证明：

测试.cs：

```
using System;

class Test
{
    static void Main()
    {
        AppDomain.CreateDomain("First")
                 .ExecuteAssembly("ShowFinalizerThread.exe");
        AppDomain.CreateDomain("Second")
                 .ExecuteAssembly("ShowFinalizerThread.exe");
    }
} 
```

ShowFinalizerThread.cs：

```
using System;
using System.Threading;

class ShowFinalizerThread
{
    static Random rng = new Random();

    ~ShowFinalizerThread()
    {
        Console.WriteLine("Thread/domain: {0}/{1}",
                          Thread.CurrentThread.ManagedThreadId,
                          AppDomain.CurrentDomain.FriendlyName);
        if (rng.Next(10) == 0)
        {
            Console.WriteLine("Hanging!");
            Thread.Sleep(2000);
        }
    }

    static void Main()
    {
        new Thread(LoopForever).Start();
    }

    static void LoopForever()
    {
        while (true)
        {
            new ShowFinalizerThread();
            GC.Collect();
            GC.WaitForPendingFinalizers();
            Thread.Sleep(300);
        };
    }
} 
```

将每个编译为控制台应用程序，然后运行 ​​test.exe（从命令行最简单，IMO）。您会看到一个应用程序域的终结器阻止了另一个。

将来我不会惊讶地看到每个*核心*而不是每个 AppDomain 有一个终结器线程 - 但听起来你仍然会遇到问题:(

你有我最深切的同情（虽然不是一个解决方案） - 一旦我在一个 Oracle Blob 中找到一个死锁。我们能够通过妥善处理它来解决这个问题，但我知道并非所有东西都能很好地工作——即使找到那个也真的很痛苦！

# java - 使用原始类型参数覆盖方法时可以避免未经检查的警告吗？

> ID：241539
> 
> 赞同：16
> 
> 时间：2008-10-27T22:05:09.853
> 
> 标签：java, generics, suppress-warnings, raw-types

我正在扩展一个库中定义的类，我无法更改：

```
public class Parent
{
    public void init(Map properties) { ... }
} 
```

如果我正在定义一个扩展 Parent 的类 'Child' 并且我使用 Java 6 和泛型，那么在不收到未经检查的警告的情况下覆盖 init 方法的最佳方法是什么？

```
public class Child extends Parent
{
    // warning: Map is a raw type. References to generic type Map<K,V> should be parameterized
    public void init(Map properties) { }
} 
```

如果我添加泛型参数，我会得到：

```
 // error: The method init(Map<Object,Object>) of type Child has the same erasure as init(Map) of type Parent but does not override it
   public void init(Map<Object,Object>) { ... }
   // same error
   public void init(Map<? extends Object,? extends Object>) { ... }
   // same error
   public void init(Map<?,?>) { ... } 
```

无论我使用特定类型、有界通配符还是无界通配符，都会出现此错误。是否有正确或惯用的方法来覆盖非泛型方法而不发出警告，并且不使用 @SuppressWarnings("unchecked")？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-28T01:09:43.867

是的，您必须使用与父类中相同的签名声明覆盖方法，而无需添加任何泛型信息。

我认为你最好的选择是将`@SuppressWarnings("unchecked")`注释添加到原始类型参数，而不是方法，这样你就不会压制你自己的代码中可能有的其他泛型警告。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-28T01:05:22.937

简短的回答：没有办法做到这一点。

不满意的答案：禁用 IDE/build.xml 中的（特定）警告。

如果你不能改变库，唉，你必须坚持使用非泛型方法。

问题是，尽管在类型擦除之后，两个 init() 都具有相同的签名，但它们实际上可能是不同的方法——或者相同的 (*)。编译器无法判断它应该覆盖还是重载，所以它是被禁止的。

(*) 假设库开发者的意思是 init(Map<String,Integer>)。现在您正在实现 init(Map<String,String>)。这是重载，在 Child 类的 vtable 中应该存在两个方法。

但是如果库开发者的意思是 init(Map<String,String>) 呢？然后它是覆盖的，并且您的方法应该**替换**Child类中的原始init，并且Child的vtable中只有一个方法。

PS 我讨厌泛型是如何在 Java 中实现的 :-(

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-04-28T17:33:14.540

我认为上面的答案是说 @SuppressWarnings("rawtypes") 。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T17:57:41.960

您必须声明与父方法具有相同签名的方法，因此编译时会收到警告。您可以使用 @SuppressWarnings("unchecked") 压制它们

无法摆脱这种情况的原因是，警告的存在是为了让您知道可以创建其中包含无效类型的集合。只有当所有可能允许的代码都被删除时，警告才会消失。由于您是从非泛型类继承的，因此始终可以创建包含无效内容的 Collection。

# open-source - 如何使用开源许可证

> ID：241540
> 
> 赞同：17
> 
> 时间：2008-10-27T22:05:48.900
> 
> 标签：open-source, licensing

我有点不确定开源许可的工作原理。如果我要选择一个特定的开源许可证，您实际上需要做什么才能使其适用于您的软件？我想这将比仅仅“声明”您在 LGPL 下发布您的软件更复杂一些。这份“合同”如何合法地绑定到您的软件？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-27T22:09:21.857

这就像决定在特定许可证下许可您的软件一样简单。这在技术上不是合同法，而是版权法。作为您的知识产权（源代码和二进制文件）的所有者/许可人，您可以以任何您认为合适的方式许可其分发。就许可下的接收者权利提供明确的免责声明是必要的。如果没有许可证，无论是封闭的还是开放的，任何人都无权分发您的受版权保护的作品。所有许可的目的都是为了将​​您的某些权利授予其他方。

[请参阅此处](http://eu.conecta.it/paper/Open_source_copyright_law.html)了解更多信息。或者，可能有太多信息，请查看 O'Reilly 的[理解开源和自由软件许可](http://oreilly.com/catalog/osfreesoft/book/)。

~ 威廉·莱利-兰德

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-27T22:12:26.423

不，差不多就是这样。从[GPLv3 文本](http://www.fsf.org/licensing/licenses/gpl.html)中，将其添加到您的程序中：

```
<one line to give the program's name and a brief idea of what it does.>
Copyright (C) <year>  <name of author>

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>. 
```

“合同”是这样的：没有 GPL，除了你之外，没有人有权分发你的程序。他们没有复制权。GPL 说，如果他们遵守其条款，那么您授予他们分发您的代码副本的额外权利。

还有其他免费/开源软件许可证，但我只是以此为例。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-27T22:09:44.727

至少对于 GNU 许可证，您按照[他们的说明进行操作](http://www.fsf.org/licensing/licenses/gpl-howto.html)，然后根据该许可证授权您的软件（或文档）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-27T22:10:35.473

这取决于您尝试使用的开源许可证的类型，它们都有非常不同的含义和需要考虑的事项。甚至您的设计也可能会受到影响，具体取决于您使用的开源许可证类型。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-27T22:15:41.453

在美国，您拥有的版权是“自动的”——即未经许可，任何人都不能重新分发您的作品。

所有这些开源许可证只有一个目的 - 授予此权限（在某些条件下）。

实际上，您只需要声明，您在某些许可下分发您的软件，这就足够了。用户必须遵守此许可证，否则他/她未经许可使用您的软件，侵犯了您的版权。

由你来选择使用哪一个，或者甚至用这些简单的词写一个你自己的“你可以做任何你想做的事，我没有任何保证。”

除非您明确自己的要求，否则没有人可以帮助您选择适合您需求的“现成”许可证。

# .net - 如果我有最低要求的版本，如何回滚 clickOnce？

> ID：241541
> 
> 赞同：4
> 
> 时间：2008-10-27T22:06:22.970
> 
> 标签：.net, clickonce

我们决定在 clickOnce 应用程序清单中使用 minimumRequiredVersion，现在当我们尝试在用户启动应用程序时回滚到以前的版本时，它无法启动。它说应用程序清单的版本比所需版本早，用户无法使用该应用程序。如果没有 minimumRequiredVersion，我们没有这个问题，但我们想使用它。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-27T22:11:44.287

您必须部署具有更高版本号的新版本。没有内置的回滚功能。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T21:37:35.643

您可以使用 Mage.exe 将您的部署清单（.application 文件扩展名）更新到更高版本，并选择之前版本的应用程序清单。就像chilltemp 说的那样，您仍然需要使用更高版本，但您不必重新部署代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-27T09:00:37.537

如果您想将版本回滚到客户端最低要求版本之前的上一个版本，那么您需要重新安装 clickonce 应用程序。

查看此链接以了解如何在代码中完成它：[ClickOnce 和 Expiring Code Signing Certificates](http://www.jamesharte.com/blog/?p=11)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-07-01T13:22:35.290

如果您知道发布者 uri 以及部署和应用程序的名称、版本语言公钥令牌和处理器架构，这可以通过反射来完成。

下面的代码将尝试回滚“coolapp.app”点击一次应用程序。如果无法回滚，它会尝试卸载它。

```
 using System;
using System.Deployment.Application;
using System.Reflection;

namespace ClickOnceAppRollback
{
    static class Program
    {
        /// 
        /// The main entry point for the application.
        /// 
        static void Main()
        {
            string appId = string.Format("{0}#{1}, Version={2}, Culture={3}, PublicKeyToken={4}, processorArchitecture={5}/{6}, Version={7}, Culture={8}, PublicKeyToken={9}, processorArchitecture={10}, type={11}",
                /*The URI location of the app*/@"http://www.microsoft.com/coolapp.exe.application",
                /*The application's assemblyIdentity name*/"coolapp.app",
                /*The application's assemblyIdentity version*/"10.8.62.17109",
                /*The application's assemblyIdentity language*/"neutral",
                /*The application's assemblyIdentity public Key Token*/"0000000000000000",
                /*The application's assemblyIdentity processor architecture*/"msil",
                /*The deployment's dependentAssembly name*/"coolapp.exe",
                /*The deployment's dependentAssembly version*/"10.8.62.17109",
                /*The deployment's dependentAssembly language*/"neutral",
                /*The deployment's dependentAssembly public Key Token*/"0000000000000000",
                /*The deployment's dependentAssembly processor architecture*/"msil",
                /*The deployment's dependentAssembly type*/"win32");

            var ctor = typeof(ApplicationDeployment).GetConstructor(BindingFlags.Instance | BindingFlags.NonPublic, null, new Type[] { typeof(string) }, null);
            var appDeployment = ctor.Invoke(new object[] { appId });

            var subState = appDeployment.GetType().GetField("_subState", BindingFlags.NonPublic | BindingFlags.Instance).GetValue(appDeployment);
            var subStore = appDeployment.GetType().GetField("_subStore", BindingFlags.NonPublic | BindingFlags.Instance).GetValue(appDeployment);
            try
            {
                subStore.GetType().GetMethod("RollbackSubscription").Invoke(subStore, new object[] { subState });
            }
            catch
            {
                subStore.GetType().GetMethod("UninstallSubscription").Invoke(subStore, new object[] { subState });
            }
        }
    }
} 
```

# c# - 突出显示 .net Web 浏览器控件中的文本

> ID：241543
> 
> 赞同：2
> 
> 时间：2008-10-27T22:07:27.993
> 
> 标签：c#, .net, browser, highlighting

我想突出显示在嵌入式网络浏览器控件中显示的文档中的某些单词。我可以设想一个解决方案，其中修改文档的 innerhtml 属性以在所需文本周围添加一个着色 <span> 标记，但我不禁觉得必须有一个更简单的方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-27T22:13:13.160

我编写了一个控件，在其中我使用[Menees Diff 库](http://www.menees.com/index.html)来识别差异发生的位置（更改、加法、减法），然后我从文档末尾开始在适当的位置插入跨度，并在跨度具有关联的地方反向插入CSS 类名。

我不知道是否有更简单的方法，但上面的解决方案适合我的需要，并且实施时间不超过几个小时。我在实施之前做了一些研究，但一无所获。

# javascript - jQuery & ASP.Net 资源 & 陷阱

> ID：241550
> 
> 赞同：2
> 
> 时间：2008-10-27T22:10:51.247
> 
> 标签：javascript, jquery, asp.net, .net, resources

与 ASP.Net 一起使用时，有哪些好的 jQuery 资源以及一些陷阱？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-27T22:26:40.467

ASP.Net 的自动生成 id 使得使用 jQuery 的选择器语法有些困难。

解决此问题的两种简单方法：

*   使用 css 类而不是 id 搜索对象
*   您可以使用以下方法清除 uniqueid 垃圾：`$('[id$=myid]')`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-27T22:57:27.330

需要注意的一点是，如果您将 WebMethods 用于 Ajax，出于安全原因，响应值将被包装在一个名为“d”的对象中。您必须解开该值，这通常不是问题，除非您使用依赖于 jquery ajax 的组件（例如 jqGrid 插件）。为了解决这个问题，我只是更改了网格中调用 ajax 的代码并插入了一些代码来解包。我确实计划向 jquery 团队发送一些代码，看看它是否可以被未来的版本接受。

如前所述，接下来的事情是 ids。如果您有时间和兴趣，我实际上将所有 HTML 控件子类化以使参与 NamingContainer 成为可选，如下所示：

```
protected override void RenderAttributes(HtmlTextWriter writer) {
    HtmlControlImpl.RenderAttributes(this, writer);
} 
```

然后辅助对象（以防止在每个对象中编写相同的代码）如下所示：

```
public static void RenderAttributes(IFormControl cntrl, HtmlTextWriter writer) {
    if (cntrl.ID != null) {
        cntrl.Attributes.Remove("id");
        cntrl.Attributes.Remove("name");
        writer.WriteAttribute("id", cntrl.RenderedId);
        writer.WriteAttribute("name", cntrl.RenderedName);
    }
    cntrl.Attributes.Render(writer);
    HtmlContainerControl containerCntrl = cntrl as HtmlContainerControl;
    if (containerCntrl == null)
        writer.Write(" /");
}

public static string GetRenderedId(IFormControl cntrl) {
    return cntrl.UseNamingContainer ? cntrl.ClientID : cntrl.ID;
}

public static string GetRenderedName(IFormControl cntrl) {
    return cntrl.UseNamingContainer ? cntrl.UniqueID : cntrl.ID;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-27T22:37:45.263

[Rick Strahl 的博客](http://www.west-wind.com/Weblog/)是一个很好的起点。他有很多 jQuery 帖子。

# javascript - 使用javascript自动开始打印html页面

> ID：241570
> 
> 赞同：71
> 
> 时间：2008-10-27T22:16:43.810
> 
> 标签：javascript, html, printing

`javascript:window.print()`页面加载完成后是否会自动运行？

* * *

## 回答 #1

> 赞同：134
> 
> 时间：2008-10-27T22:18:07.300

`<body onload="window.print()">` 或者 `window.onload = function() { window.print(); }`

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2012-05-06T00:19:44.833

以下代码必须放在 HTML 文件的**末尾**，以便在加载内容后，将执行脚本并打印窗口。

```
<script type="text/javascript">
<!--
window.print();
//-->
</script> 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2018-10-06T15:39:57.560

在您的 HTML 页面中添加以下代码，它将在页面加载时显示打印预览。

```
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>

<script type="text/javascript">

$(document).ready(function () {
    window.print();
});

</script> 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2016-08-23T12:07:33.663

使用这个脚本

```
 <script type="text/javascript">
      window.onload = function() { window.print(); }
 </script> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-10-06T16:04:45.127

该脚本将在整个页面加载后运行。

```
 <script type="text/javascript">   
     $(window).load(function() {
      //This execute when entire finished loaded
      window.print();
    });
</script> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-04-10T01:43:52.547

对我来说，添加`<script>window.print();</script>`到页面末尾是有效的。

* * *

我不需要该`type="text/javascript"`属性，甚至不需要将页面包装在`<body>`标签中。但是，我以前所有尝试直观地使用此处建议的答案，只是编写`window.onload=window.print`或更长的版本（例如`window.onload=()=>window.print();`不起作用），当然在新创建的窗口上调用 print 不会等待内容加载。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-11-09T17:48:20.897

如果您想要从 Web 浏览器打开一个单独的窗口，您可以使用：

```
 window.open(basePath + "Controller/Route/?ID=" + param, '_blank').print(); 
```

# visual-studio-2008 - Visual Studio Team System 2008 测试版书籍还是在线培训？

> ID：241574
> 
> 赞同：6
> 
> 时间：2008-10-27T22:19:01.650
> 
> 标签：visual-studio-2008, testing

我们的测试人员正在评估 Visual Studio Team System 2008 测试版。由于他们不熟悉 Visual Studio 的使用，我想尽可能多地帮助他们。

我在亚马逊上看过 VS.Net 测试版的书籍，但只有一本 VS.Net 2005 测试版书籍。

有没有人知道任何特别关注 Visual Studio Team System 2008 测试版功能的好书或在线培训资源？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-03T04:48:32.293

对于不太熟悉 Visual Studio 的评估功能的人，我会推荐几个地方的视频：

*   [“我如何？” 团队系统视频](http://msdn.microsoft.com/en-us/vsts2008/bb507749.aspx?wt.slv=topsectionsee)
*   [ASP.net 的学习部分](http://www.asp.net/learn/vsts-videos/)
*   [TeamSystemRocks.com 上的视频教程](http://teamsystemrocks.com/tutorials/default.aspx)

这些网站之间有大量关于各种 VSTS 测试版功能的视频。请注意，很多都是关于 VS2005 的，但基本概念在迁移到 2008 时并没有改变。

一旦他们获得了基本功能，这里是[VS2008 测试版中的新增](http://msdn.microsoft.com/en-us/vsts2008/products/bb933755.aspx)功能的摘要。

也可以看看：

*   [VSTS 2008 测试版主页](http://msdn.microsoft.com/en-us/vsts2008/test/default.aspx)（顺便说一句，右侧有一个指向带有 TFS 和 VSTS 套件的试用 VPC 的链接）
*   [Visual Studio 2008 培训工具包](http://www.microsoft.com/downloads/details.aspx?familyid=8BDAA836-0BBA-4393-94DB-6C3C4A0C98A1&displaylang=en)——这里没有很多关于 VSTS 的内容，但是有一些涉及测试功能的演示和资源，无论如何，它是一个很好的通用资源。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-06T21:21:30.633

我还将人们指向 MSDN 上的虚拟实验室：

[http://msdn.microsoft.com/virtuallabs](http://msdn.microsoft.com/virtuallabs)

尤其：

[Microsoft Visual Studio Team System 虚拟实验室](http://msdn.microsoft.com/en-us/virtuallabs/aa740411.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-15T13:29:48.903

另外，看看msdn：

测试版演练
[http://msdn.microsoft.com/en-us/library/ms182417.aspx](http://msdn.microsoft.com/en-us/library/ms182417.aspx)

Web 测试演练
[http://msdn.microsoft.com/en-us/library/aa337591.aspx](http://msdn.microsoft.com/en-us/library/aa337591.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-12-26T15:56:55.533

现在有一本书可用

[http://www.packtpub.com/software-testing-with-visual-studio-team-system-2008/book/sb/msax-abr1/1209?utm_source=sb_msax_abr1_1209&utm_medium=content&utm_campaign=santi](http://www.packtpub.com/software-testing-with-visual-studio-team-system-2008/book/sb/msax-abr1/1209?utm_source=sb_msax_abr1_1209&utm_medium=content&utm_campaign=santi)

希望它可以帮助其他人。

萨里达扬

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-06-08T18:58:59.573

请检查以下链接 -

Visual Studio Team System 测试版常见问题解答 [http://msdn.microsoft.com/en-us/library/ee338734(v=vs.90).aspx](http://msdn.microsoft.com/en-us/library/ee338734(v=vs.90).aspx)

Visual Studio 性能测试快速参考指南（2.0 版）已发布 [http://blogs.msdn.com/b/edglas/archive/2010/04/13/visual-studio-performance-testing-quick-reference-guide-version- 2-0-published.aspx](http://blogs.msdn.com/b/edglas/archive/2010/04/13/visual-studio-performance-testing-quick-reference-guide-version-2-0-published.aspx)

使用 Visual Studio ALM 2010 进行软件测试的书籍 [http://blogs.msdn.com/b/anutthara/archive/2011/04/04/books-on-software-testing-with-visual-studio-alm-2010.aspx](http://blogs.msdn.com/b/anutthara/archive/2011/04/04/books-on-software-testing-with-visual-studio-alm-2010.aspx)

Web 应用程序性能测试指南 [http://msdn.microsoft.com/en-us/library/bb924375.aspx](http://msdn.microsoft.com/en-us/library/bb924375.aspx)

# python - 企业网站和内部网的框架/CMS 建议（我必须说服总统它是可靠的！）

> ID：241575
> 
> 赞同：8
> 
> 时间：2008-10-27T22:19:33.507
> 
> 标签：python, frameworks, content-management-system, enterprise

亲爱的堆栈溢出社区，

我的任务是为我工作的一家大公司改造几个网站，并为组织内的内容管理和文档存储开发一个内部 Intranet 站点。

我的“问题”是这样的：他们希望我使用一个框架/一组语言/技术，我可以向他们证明这些框架/一组语言/技术是“具有良好记录的稳定、企业级技术”。

规范的“大图”实际上并不太复杂：实施企业级 CMS 来管理每个部门的网页，这些网页主要处理产品信息和文档（即 www.linksys.com 的更简单版本）。

作为一名开源程序员，我想将 Python 与 TurboGears 一起使用并从头开始构建它，但我真的无法找到一种方法来向总裁证明 TurboGears 拥有巨大的企业业绩记录。Zope 似乎有很多企业用途，但在我看来有点臃肿。Django 可能是一种选择，但似乎不如 TurboGears 灵活。

我宁愿不使用 PHP，但 Drupal 有一份非常不错的简历，其中包含“正确”的名称（AOL、Sony、MTV）；另外，它可以帮助我从头开始构建许多 CMS 组件。

Rails 可能是另一种选择，但我对它不太熟悉（作为 Python/PHP 程序员，Ruby 的语法让我发疯）。

SO 社区对这样的项目有什么建议？我相信你们中的许多人都面临着同样的困境。什么最终为您工作/不工作？正如我之前所说，我的第一选择是 Python，第二是 PHP，第三是 Rails。

谢谢你，赛斯

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-27T22:44:34.937

这是一个自相矛盾的说法：“规范的“大图”实际上并不太复杂：实施企业级 CMS 来管理每个部门的网页”。

“企业级”和“不太复杂”不属于同一个句子。严重地。

“企业级”的东西很复杂，因为“企业级”的任务和环境很复杂。

请注意，仅仅因为在企业中部署了某些东西并不意味着它需要“企业级”工具。但是那些确实有“企业级”要求的人很复杂，因为问题域和部署环境很复杂。

所以，你需要比“符合流行语”、“我的老板听说过”、“永不中断”等更清楚你的规范。

CMS 看似简单，但事实并非如此。如果是极客为极客管理东西，那是一回事，但 CMS 往往会对非技术最终用户产生巨大影响，这会使用户界面、安全性、工作流程、支持等变得非常复杂。想想“营销想要维护网站”，他们会让他们的初级实习生去做。

所以，严肃地说，没有真正的要求，很难提出任何建议。如果没有真正的要求，也没有对您的用户群有深入的了解，您当然不应该只是“自己动手”。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-27T22:22:38.883

如果你喜欢 Python，并且想要一个 Web 框架，我不会放弃 Django。它简单、功能强大，并且可以运行大量企业级站点。

一些使用 Django 的大型网站是[Lawrence.com](http://www.lawrence.com/)、[Curse Gaming](http://www.curse.com/)和一些[华盛顿邮报](http://projects.washingtonpost.com/congress/)网站。它最近也刚刚升级到 1.0 版，因此您可以使用可靠的代码库。

如果您愿意，您可以随时[列出使用 Python 的公司，其中包括 Google、Yahoo 和 NASA 等公司。](http://wiki.python.org/moin/OrganizationsUsingPython)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-28T14:21:14.923

如果你想要一个企业 CMS，你不能用一个框架从头开始构建它。企业 CMS 需要成千上万人的工作，例如 Plone。这是企业中的 Plone：

[http://plone.net](http://plone.net)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-28T13:37:43.077

如果您正在寻找企业级 CMS，为什么要从头开始实施？有一个完善的、成熟的、基于 Python 的企业级 CMS 已经可用，称为 Plone。

它最近被一家主要的 IT 出版物审查：

“Plone 只做一件事——Web 内容管理——并且沉着地做。这就是为什么你会发现大多数行业的知名美国和国际组织都使用 Plone 运行他们的网站、互联网和外联网。” [Inforworld，“开源 CMS 证明物有所值”2007 年 10 月](http://tinyurl.com/35toee)

开箱即用的 Plone 提供了您需要的大部分（如果不是全部）功能，并且有数百个[免费插件](http://plone.org/products)可用于实现您需要的任何其他功能，您可能不需要进行任何编码来启动您的网站跑步。

它被政府、非营利组织、教育和企业使用。名称，例如 Novell、gnome.org、Discover Magazine 等等。你可以肯定它是安全的，CIA 正在使用它来运行其面向公众的网站。

Plone 社区非常强大，它是地球上最大的开源项目之一。全球有数百家 Plone 服务提供商为您的部署提供支持。

[您可以在Plone.org](http://plone.org)网站上阅读该项目本身。还有[Plone.net](http://plone.net)，它提供案例研究和成功案例、全球服务提供商列表和更多媒体报道。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-27T23:42:03.853

我同意[威尔的评论](https://stackoverflow.com/questions/241575/frameworkcms-suggestions-for-enterprise-website-intranet-ive-got-to-convince-th#241637)。构建 CMS、Intranet 和文档管理系统听起来像是一项繁重的工作。我的公司可能会在**其中一个**系统的要求上花费 6 个月的时间，但**仍会**提交模糊/不完整的要求。

这里有几个问题：

1.  完成后，谁将维护 CMS 和文档管理系统？如果您在一群受薪 Java 开发人员中间放弃一个自定义 Python 应用程序，那么这些应用程序成功的几率就会下降。我并不是说它行不通，只是说可能性不利于它。
2.  您是否正在寻找一个应用程序/框架来为外部站点创建 CMS、为内部网创建 CMS 和文档管理系统？如果是这样，那应该会大大缩小可能的 CMS 的范围。例如，我认为 Drupal 不能很好地处理文档管理（如果它完全处理它的话。）
3.  谁是系统的用户？使用文档管理系统的人和管理网站和内网的人是一样的吗？
4.  系统会共享工作流程吗？（文档管理系统的内容会留在它的孤岛中，还是文档可以迁移到 Web CMS 或 Intranet？系统的每个区域是否有不同的“审批者”或一组霸主？）

祝你好运！

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-27T23:59:06.177

这里首先想到的是你正在接近这一切都是错误的。看起来你正在为自己寻找一个宠物项目，并试图决定你最想做的事情。您没有指定谁将管理该站点的范围......这是真正的问题。只有你吗？是管理团队吗？是每个部门吗？

做出这样的重大决定需要大量时间和思考。我们花费大量时间帮助我们的客户选择适合他们需求的 CMS。那里有很多，像这样的决定不能掉以轻心。很多在正确的情况下是好的，而在其他情况下是可怕的。此外，适合作为开发人员的您不一定适合您的最终用户。

正如上面有人建议的那样，在任何人（包括开发人员社区）可以就什么是最好的使用提出任何建议之前，您需要对需求进行更多的研究。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-28T00:03:04.187

我同意 Will、braveterry 和 Divamatrix 的评论。完全。

为了成功地为大中型企业推出 CMS 解决方案，需要考虑大量的问题/问题/风险/注意事项。我不会重复威尔和勇敢者所说的话，我将提供不同的观点：

**大中型公司的 CMS 与软件无关。它是关于流程和政策的。**

使用哪个框架/工具必须取决于确切的要求（内容类型、内容来源、谁将负责捕获和创建内容、他们的能力、谁将批准内容更新、哪些部门将有发言权什么进入主页？，在哪些政策下将选择主页的内容？，主页的目的是什么？（营销？销售？技术？品牌？）。

如果您不清楚这些问题（还有更多）的答案，或者即使您不明白为什么如此重要。那么我认为你需要与一家经验丰富的咨询公司签约。

PS：这给了我发表一些关于这个主题的论文的想法，但这需要几天时间，因为我目前没有时间准备它。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-28T00:26:55.560

“他们希望我使用一个框架/一组语言/技术，我可以向他们证明这些框架/技术是“具有良好记录的稳定、企业级技术”。

没有这些功能的证据。没有任何。

他们是否希望您使用某些现有技术？如果是这样，您可能正在逆流而上。

*   如果您正在为自己喜欢的技术而战，那么如果没有认真的概念证明或试点项目之类的东西，您可能无法赢得他们的心。

*   如果他们愿意听，如果您有一个演示来展示您首选的方法是多么坚如磐石，他们会更愿意听。

如果没有现任者，那么他们只是在绞尽脑汁。在这种情况下，您需要一些他们真正相信的证据——一个试点项目或概念证明。

这个行业没有证据。对于每一种技术，您都可以找到支持者和反对者。即使是垃圾技术也有支持者。忘记证明。

只需选择可以快速使用的**东西**。以如此高的质量快速启动并运行某些东西，以至于您显然是正确的，而您的其他意见也必须同样正确。

因此，灵活性没有任何价值。使用 Django 并尽快运行。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-28T16:23:54.393

您想从头开始构建企业级 CMS？只为一个项目？你疯了吗？除非计划进入 CMS 业务并拥有成千上万小时的开发时间，否则绝对没有必要创建一个新的。那里已经有优秀的 CMS。我认为 Drupal 和 Plone 是最好的。我喜欢 Plone，因为它使用起来令人愉快。它被 CIA、NASA、Akami、Novell 和 Ebay 使用。

最好的祝愿，

托尼

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-09-05T18:50:15.723

“企业”是一个营销术语。它的技术意义几乎为零。如果您的老板想听 Enterprise，那么他会的，但这并不意味着给定的系统适合您的需求。

注意使用给定软件套件的公司列表。“Ebay 使用 Plone”和“Ebay 在 Plone 上运行”是两种截然不同的说法。

大多数情况下，如果您正在做“企业”CMS（无论该术语的价值如何），您应该期望有一个学习曲线，该曲线只会在一个重要项目结束时才*开始*变平。

对于您的项目，我建议您尝试弄清楚您真正需要什么。如果您认为 TurboGears（或任何其他框架）很合适，请与您的老板讨论一些风险管理策略。也许从一个小飞行员开始。采用新技术是有风险的。如今，许多“大公司”网站都对任务至关重要。

物有所值。我喜欢 Plone，但我只将它用于非公司的东西。我个人不知道任何“企业”实现。在工作中，我使用 Tridion，并且我知道该级别的许多实现。（如果您正在寻找可以让您在 Python 中工作的选择，那么 Tridion 并不适合。）

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-27T22:29:01.023

无论您选择什么，都不要使用 Typo3。这是一个巨大的无法破解的混乱，它有自己的愚蠢的模板“脚本”语言，几乎不可能快速学习，很难教给你的企业用户并且该死的丑陋。难怪有些商店只做 Typo3 咨询谋生。它有点流行，但不认为有任何像样的文档。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-28T21:31:13.760

赛斯，如果你真的想要一个 E-CMS，不要试图重新发明轮子。周围有很多经过测试的 E-CMS。例如一些基于 Zope/Python 的解决方案，如 Plone。它经过企业测试，易于使用，可扩展性极强（因为您在后端拥有完整的应用程序服务器），有书籍为作者/编辑、网站管理员和开发人员解释它。在不适合的地方进化它。如果您需要更多信息，请在 IRC (OPN/freenode, #plone) 询问，或者如果 59 个世界克隆日 [1] 地点之一距离 2008 年 11 月 7 日不远，请与 Plone 及其庞大的和乐于助人的社区。[1] [http://plone.org/wpd](http://plone.org/wpd)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-17T02:06:36.260

> 大中型公司的 CMS 与软件无关。它是关于流程和政策的。

非常真实！

与有声望的名字的关联不一定是令人愉悦的最终结果的指标。

我喜欢索尼的产品，是的，但是在我从索尼网站寻求支持的各种场合中，我都觉得自己的头撞到了砖墙上！那些令人头疼的网站可能不是面向 Drupal 的，我不知道，但重点是：不要只被大牌所吸引。

您应该预料到的一个问题是：对系统可能实现（或限制）什么的先入之见。

给自己一些使用 Plone 的学习时间——理想情况下，对于像这样的大型项目，*投资*专家建议——你会意识到 Plone 的能力超出了关于系统可以或应该完成什么的传统想法。

以非常开放的心态衡量用户需求（而不是基于诸如“我想要一个等于系统 x 的系统”之类的简单性）然后来 plone.org | 支持 | 聊天室进一步讨论您的要求。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-17T02:16:15.053

密切关注 Flossquality - 开源质量研究 [http://flossquality.eu/](http://flossquality.eu/)

关于 Flossquality 和该标题下的三个质量相关项目，在[http://n2.nabble.com/Plone-and-QUALOSS---QUALity-in-Open-Source-Software-tp1402419p1446439.html](http://n2.nabble.com/Plone-and-QUALOSS---QUALity-in-Open-Source-Software-tp1402419p1446439.html)我想象了一些问题开源社区中的人（不仅仅是在 Plone 中）可能会询问整个 caboodle。

最近，我收到了一些对这些问题的回复，不在名单之列。一旦我有时间阅读相关的电子邮件，我将致力于分享或至少抽象出回复。

# sql-server - Reporting Services 2000 - 通过电子邮件将不同的报告发送给许多人

> ID：241576
> 
> 赞同：1
> 
> 时间：2008-10-27T22:20:34.673
> 
> 标签：sql-server, reporting-services, reportingservices-2000

Reporting Services 2000 标准版（目前是 RTM，但希望很快有 SP2）。

我有一个包含参数的报告 - PlantID

我想每月通过电子邮件将此报告的 pdf 文件发送给 80 位不同的工厂经理

所以我有一张桌子：

```
PlantID    ManagerEmail
1          BillySmith@company.com
2          FredJones@asdf.com
3          JohnLonestar@rrr.com 
```

我目前可以设置订阅以每月通过电子邮件将报告发送给多个用户（使用 SQL 代理）。

但是我想将报告的输入参数（PlantID）指定给电子邮件的收件人（ManagerEmail）。

关于如何做到这一点的想法？我目前的想法是构建一个 C# 应用程序，它使用正确的输入参数调用 RS 的 URL。然后取回 pdf，然后从 C# 发送电子邮件。

非常感谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T13:06:14.607

数据驱动订阅将是理想的答案，但我发现数据驱动订阅在 RS 2000 标准中不可用。

[本文](http://www.codeproject.com/KB/database/DataDrivenSubscriptions.aspx)讨论如何使用存储过程来调整 Reporting Services 订阅并将您自己的值插入到相应的字段中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T23:39:54.857

这也是我对如何做到这一点的第一个想法。

您也许还可以设置一个预定的存储过程来为您执行它，但这更多的是猜测而不是经验丰富的建议。

# perl - 在 Perl 中将月份的缩写转换为数字的最简单或最有效的方法是什么？（即“一月”到1）

> ID：241579
> 
> 赞同：8
> 
> 时间：2008-10-27T22:23:27.070
> 
> 标签：perl, date, abbreviation

如果我导入一个库来使用一种方法，是否值得？导入会占用大量内存吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-27T22:27:16.657

[从这里](http://www.perlmonks.org/?node_id=95456)借来的

```
%mon2num = qw(
    jan 1  feb 2  mar 3  apr 4  may 5  jun 6
    jul 7  aug 8  sep 9  oct 10 nov 11 dec 12
); 
```

并检索

```
$mon2num{"jan"} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-28T02:09:18.753

这是另一种方法：

```
my %month; @month{qw/jan feb mar apr may jun
                     jul aug sep oct nov dec/} = (1 .. 12); 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-27T22:25:12.917

导入这样的模块不太可能花费太多的内存，您应该避免使用它，尽管在这种情况下，一个简单的散列可能同样好。就像是

```
my %number_for = (
    jan => 1,
    feb => 2,
#etc...
);
#...
do_something_with($number_for{$month}) 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-29T23:45:36.203

使用哈希切片的另一种方法：

```
@month{qw(jan feb mar apr may jun jul aug sep oct nov dec)} = 1..12; 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-28T00:31:10.107

```
my %month_num = do { my $i = 1; map {; $_ => $i++ } (
    qw( jan feb mar apr may jun jul aug sep oct nov dec )
) }; 
```

或许：

```
my %month_num;
$month_num{ $_ } = 1 + keys %month_num for (
    qw( jan feb mar apr may jun jul aug sep oct nov dec )
); 
```

或使用[zip 功能](/questions/38345/elegant-zip-in-perl-5#71895)：

```
my %month_num = do {
    my @month = qw( jan feb mar apr may jun jul aug sep oct nov dec );
    zip2( 1 .. 1+$#month, @month );
}; 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-28T17:57:14.270

嗯 - 似乎有很多过于复杂的方法可以做到这一点。对于某些事情，这个简单的清晰度是关键：

```
# create a lookup table of month abbreviations to month numbers
my %month_abbr_to_number_lkup = (
    jan => 1,
    feb => 2,
    mar => 3,
    apr => 4,
    may => 5,
    jun => 6,
    jul => 7,
    aug => 8,
    sep => 9,
    oct => 10,
    nov => 11,
    dec => 12,
);

# get the number for a month
my $number = $month_abbr_to_number_lkup{$abbr}
    || die "Could not convert month abbreviation '$abbr' to a number."; 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-28T21:06:07.320

另请注意，哈希键区分大小写；根据您的缩写来自哪里，您可能希望首先将它们小写以匹配哈希键。

```
%mon_2_num = (jan => 1,
              feb => 2,
              ...);

$month_number = $mon_2_num{lc($month_name_abbrev)}; 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-28T03:59:28.390

这取决于您打算进行多少日期操作。起初你可能会更好地用手滚动它，例如

```
my @months = qw(Jan Feb Mar Apr May Jun
                Jul Aug Sep Oct Nov Dec);
my %monthnum = map { $_ => $months[ $_ - 1 ] } 1..12; 
```

（我更喜欢这种方法，因为你在做什么比较明显——你有一个月份列表，然后你将它们从 1..12（对人类有意义的数字）映射到 0..11（对人类有意义的数字）对计算机有意义）。代码中的性能瓶颈不会出现在这类代码中，它们会出现在网络、数据库或磁盘访问代码中，因此请专注于使代码可读。）

当您开始添加代码时，您可能会发现很多这些东西已经由现有模块完成，使用 Date::Calc 等一些简单的东西可能会更容易。或者您可能会找到更适合您需求的日期/时间模块；这超出了这个问题的范围。

还请记住，某些模块使用自动拆分，仅加载需要的模块部分。此外，使用大型模块的主要性能影响不一定是 RAM，它可能更可能是在任何代码运行之前加载和编译它的时间/CPU 开销。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-28T12:42:48.537

正如其他人所建议的那样，绝对是一个哈希。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-07-25T21:33:22.493

我喜欢有机会在一个 12 岁的问题上做 TMTOWTDI！

正如其他人提到的，哈希值将区分大小写。所以让我们改用正则表达式！

```
my $months = '1=January 2=February 3=March 4=April 5=May 6=June 7=July 8=August 9=September 10=October 11=November 12=December';

my $month = 'jan'; # anything that looks like a month name
my $monthnumber = $1 if $months =~ m"(\d+)=$month"i;
my $monthname = $1 if $months =~ m"$monthnumber=(\S+)";
my $monthabbreviation = $1 if $months =~ m"$monthnumber=(...)"; 
```

这是一个示例，显示了它的灵活性：

```
foreach my $month ('jan', 'Feb','MAR','Ap','May','Jun','july','Aug','sep','oct','NOVEM','DECEMBER') {
    my $monthnumber = $1 if $months =~ m"(\d+)=$month"i;
    my $monthname = $1 if $months =~ m"$monthnumber=(\S+)";
    my $monthabbreviation = $1 if $months =~ m"$monthnumber=(...)";
    printf "    %-9s %2d %3s %s\n",$month,$monthnumber,$monthabbreviation,$monthname;
} 
```

输出：

```
jan        1 Jan January
Feb        2 Feb February
MAR        3 Mar March
Ap         4 Apr April
May        5 May May
Jun        6 Jun June
july       7 Jul July
Aug        8 Aug August
sep        9 Sep September
oct       10 Oct October
NOVEM     11 Nov November
DECEMBER  12 Dec December 
```

# c++ - 用于 gcc-arm 工具链的 Boost C++ 库

> ID：241581
> 
> 赞同：5
> 
> 时间：2008-10-27T22:23:57.397
> 
> 标签：c++, gcc, boost, arm

我在 timesys arm-gcc 工具链上构建 1.35.0 和 1.36.0 都没有问题，无论是静态（链接静态）还是动态（.so，默认选项）。

但是，当我尝试链接一个简单的示例文件系统应用程序时：

```
#include <boost/filesystem.hpp>
#include <iostream>

namespace fs = boost::filesystem;

int main(int argc, char *argv[]) {
    const char* fileName = argv[1];
    std::cout << "file: " << fileName << " => " << fs::exists(fileName) << std::endl;
    return 0;
} 
```

我收到以下链接器错误：

```
 developer@eldp01:~/boost/test$ /opt/timesys/at91sam9263_ek/toolchain/bin/armv5l-timesys-linux-gnueabi-gcc 
  exists.cpp -o exists.exe -I ../boost_1_35_0/ -lboost_filesystem -lboost_system -lstdc++ -L .

/tmp/ccex3NGb.o: In function `boost::detail::atomic_decrement(int*)':
exists.cpp:(.text._ZN5boost6detail16atomic_decrementEPi[boost::detail::atomic_decrement(int*)]+0x1c): 
  undefined reference to `__sync_fetch_and_add_4'

/tmp/ccex3NGb.o: In function `boost::detail::atomic_increment(int*)':
exists.cpp:(.text._ZN5boost6detail16atomic_incrementEPi[boost::detail::atomic_increment(int*)]+0x1c): 
  undefined reference to `__sync_fetch_and_add_4'

collect2: ld returned 1 exit status 
```

有谁知道我怎样才能让 Boost 为 gcc-arm 工具链构建？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-27T22:52:58.650

Boost 邮件列表中回答[了一个几乎相同的问题。](http://lists.boost.org/Archives/boost/2008/04/135597.php)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-28T00:29:55.863

您需要添加文件'boost_1_35_0/boost/config/user.hpp'：

```
#define BOOST_SP_USE_PTHREADS 
```

顺便说一句，您需要将文件 'boost_1_35_0/tools/build/v2/user-config.jam' 中的 gcc 工具链设置为：

> ```
> using gcc
>         : arm
>         : /opt/timesys/at91sam9263_ek/toolchain/bin/armv5l-timesys-linux-gnueabi-gcc
> ; 
> ```

这将解决现在链接的问题。

# .net - 您最喜欢的 .NET 图表和仪表的开源或免费库是什么？

> ID：241594
> 
> 赞同：9
> 
> 时间：2008-10-27T22:29:02.410
> 
> 标签：.net, charts, open-source

对于内部硬件监控实用程序，我需要使用仪表和图表来帮助可视化各种指标。.NET 是否有任何好的开源或免费图表和仪表库？我对购买任何组件都不感兴趣（不包括 Dundas Charts & Graph 之类的组件，我知道这些组件可以胜任，但不符合我们的预算）。

**编辑：**我也知道 Google Charts API。实际的应用程序需要在没有互联网连接的情况下工作，因此在这种特殊情况下是不可能的。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-27T23:01:56.807

我知道这不是开源的，但值得注意的是微软刚刚发布了一个免费的 ASP.NET 和 WinForms 图表包。更多细节[在这里](http://blogs.msdn.com/sqlrsteamblog/archive/2008/10/25/microsoft-chart-controls-for-net-framework-35.aspx)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-27T22:38:52.907

我最喜欢的是[ZedGraph。](http://zedgraph.org/wiki/index.php?title=Main_Page)

绝对是一个很棒的图表库。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-27T22:57:03.820

我碰巧在我的 del.icio.us 帐户中有两个：

是jQuery 的[FLOT](http://code.google.com/p/flot/)。

[以及甘特图](http://www.codeproject.com/KB/miscctrl/Gantt_Chart.aspx)代码项目中的此帖子

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-27T17:19:15.150

ZedGraph 绝对。

我将图表用于大型数据集，1,000,000 个数据点及以上。ZedGraph 简洁、高效，并且比我尝试过的许多商业产品更快地成功呈现这些类似野兽的图表：Nevron SyncFusion DevExpress ChartFX Dundas（因此也是 Microsoft Charts）

ZedGraph 具有一些无与伦比的特定高性能功能，例如[FilterPointList](http://zedgraph.sourceforge.net/documentation/html/T_ZedGraph_FilteredPointList.htm)，它在缩小时动态快照您的数据，而在放大时不使用快照。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-01-05T05:34:03.013

[http://www.codeproject.com/KB/miscctrl/A_Gauge.aspx?msg=1900283](http://www.codeproject.com/KB/miscctrl/A_Gauge.aspx?msg=1900283)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-27T22:32:12.497

我正在看 NPlot，但乍一看似乎有点难以理解。

# asp.net - ASP.NET、ASP 和 PHP 之间的 SSO

> ID：241595
> 
> 赞同：0
> 
> 时间：2008-10-27T22:29:34.860
> 
> 标签：asp.net, authentication, single-sign-on

我正在一个站点上工作，该站点是许多站点的核心/主站点。我们还负责处理品牌旗下所有网站的身份验证。

客户希望包含单点登录操作，因此如果我要登录任何站点，我将登录到所有站点。我们通过重定向到主站点（我们的）并执行登录来处理*子*站点登录。

决定 SSO 将通过将图像标签嵌入页面然后调用每个子站点上的页面来运行。这将打开到他们网站的客户端会话，以便他们可以设置 cookie/做他们想要处理登录的事情。

这*在大多数情况*下都有效，它已经在 IE7、FF 2 和 3 上进行了测试，它们都可以工作。目前有问题的浏览器是 Safari（和 Chrome）。尽管图像确实似乎在客户端会话中加载，但似乎没有打开，但我们没有从子站点集中获得任何 cookie。问题似乎是基于 WebKit 的浏览器，其中 Safari 和 Chrome 是问题（我认为 konqueror 可能会遭受同样的命运，但目前我没有安装 Linux）。

有谁知道让 Safari 将嵌入的图像标签识别到外部主机作为打开客户端上下文的方法？或者有人可以提供一种更好的方法来从 ASP.NET 到不是 ASP.NET 的站点进行 SSO？

**注意：**是的，我知道到目前为止我们所做的 SSO 概念在禁用图像方面存在问题。提出的解决方案不是我的，我只是坚持下去。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-27T23:40:23.360

我使用过的大多数 SSO 东西都使用集中式身份验证服务器 ( [CAS](http://www.ja-sig.org/products/cas/) )，并使用通过查询参数和 cookie 传递的票证进行操作。

基本思想是，如果您的网站没有检测到票证，它会重定向到您的 CAS 网站。网站执行身份验证，设置身份验证 cookie，并使用唯一的一次性票证（作为查询参数）重定向回您的站点。重定向后，您的站点会检测到票证并回调到 CAS 服务器以使用带外 Web 请求兑换票证。此请求返回已登录用户的 id。您可以使用它在应用程序中设置经过身份验证的用户。

CAS 服务器跟踪哪些应用程序允许彼此进行 SSO。当身份验证请求来自 SSO 池中的站点并且身份验证票证对应于池中的另一个站点时，CAD 服务器会使用票证进行响应，而不会强制重新进行身份验证。这样一来，您的站点就可以相互链接，而无需任何特殊的“魔法”，这取决于 CAS cookie 是否会实现这一事实，因此用户可以绕过相关站点之间的重新身份验证。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-27T23:31:53.267

*它看起来像 Safari（至少在我的 OS X 上 - 这应该是默认设置），而且我假设 Chrome，默认情况下*不允许 3rd 方 cookie 。

Safari->首选项->安全->接受 Cookie：

o 总是
o 从不
+ 仅来自您导航到的站点

有一些[AJAX 黑客](http://trainofthoughts.org/blog/2007/04/14/cross-site-cookies/)可以让*您的*文档域设置 cookie，但我认为这并不能真正解决您的问题。我认为 Safari 甚至禁止 iframe 设置 3rd 方 cookie，除非您设置了 document.domain（不过，如果您共享一个公共域，您可能只需设置 cookie 域并完成所有操作）。

缺少 window.open 或一系列重定向，我真的想不出你可以做些什么来解决 3rd 方 cookie 问题 - 所以我可能会放弃嵌入图像的技巧并从头开始。

# crc - CRC预设和残留

> ID：241605
> 
> 赞同：6
> 
> 时间：2008-10-27T22:33:57.830
> 
> 标签：crc, preset

我正在使用需要我生成 16 位 CRC 的设备。

该设备的数据表表明它需要以下 CRC 定义：

```
CRC 类型 长度 多项式 方向 预设 残差
CRC-CCITT 16 位 x16 + x12 + x5 + 1 前向 FFFF (16) 1D0F (16)

```

其中预设=FFFF（16 位）和残差=1D0F（16 位）

我搜索了一个 CRC 算法并找到了这个链接： [http ://www.lammertbies.nl/comm/info/crc-calculation.html](http://www.lammertbies.nl/comm/info/crc-calculation.html)

它上面都有。CRC-CCITT (0xFFFF) CRC-CCITT (0x1D0F)

预设和残差有什么区别？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-28T03:33:10.003

在输入消息之前，您使用***预设***初始化 CRC 寄存器。

***残差***是在输入消息后应该留在 CRC 寄存器中的内容，加上其正确的 CRC。

如果您只想发送消息，您将看不到剩余值。但是当设备再次通过 CRC 算法运行你的 message+CRC 时，如果没有传输错误，它会看到最终值 0x1D0F。

* * *

您也可以在不涉及设备的情况下向自己展示这一点。这可以帮助您确认您的算法正在执行的操作至少类似于 CRC。

*   首先，计算您的消息的 CRC。
*   附加您的消息和该 CRC，然后通过新的 CRC 计算传递整个内容（请记住先重置为预设值。）
*   如果一切顺利，您的 CRC 寄存器应该包含残差值。

* * *

我找到的最好的 CRC 解释在这里：

[https://archive.org/stream/PainlessCRC/crc_v3.txt](https://archive.org/stream/PainlessCRC/crc_v3.txt)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T00:47:20.493

不同之处在于算法对这两个值的作用。我只是自己查看了一个 CRC 算法，它看起来很简单。

Preset 是它开始的值，residual 与最后的值进行异或。

现在，我不知道为预设和残差选择特定值的**原因。**

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T00:52:24.133

这里有点不对劲。

您正在寻找 16 位 CRC，但您指定了 24 位预设和残差。发布您正在查看的设备的数据表链接。

顺便说一下，CRC 信息的最佳来源是[Ross Williams 的 CRC 指南。](http://www.ross.net/crc/download/crc_v3.txt)

编辑：啊哈，我看到“24 位”预设只是表格的格式。

# sql - 使用 Oracle 进行分页

> ID：241622
> 
> 赞同：117
> 
> 时间：2008-10-27T22:37:21.363
> 
> 标签：sql, oracle, stored-procedures

我不像我想的那样熟悉 Oracle。我有一些 250k 记录，我想每页显示 100 条记录。目前，我有一个存储过程，它使用数据适配器、数据集和存储过程结果的 dataadapter.Fill(dataset) 方法将一百万条记录的所有四分之一检索到数据集。如果我将“页码”和“每页的记录数”作为整数值，我可以作为参数传递，那么返回该特定部分的最佳方法是什么。比如说，如果我将 10 作为页码传递，将 120 作为页数传递，那么从 select 语句中它会给我第 1880 到第 1200，或者类似的东西，我脑海中的数学可能会出错。

我在.NET中用C#做这件事，认为这并不重要，如果我能在sql方面做到这一点，那么我应该很酷。

更新：我能够使用布赖恩的建议，而且效果很好。我想进行一些优化，但是页面会在 4 到 5 秒而不是一分钟内出现，而且我的分页控件能够很好地与我的新存储过程集成。

* * *

## 回答 #1

> 赞同：160
> 
> 时间：2008-10-27T22:46:30.597

像这样的东西应该可以工作：[来自 Frans Bouma 的博客](http://weblogs.asp.net/fbouma/archive/2007/05/21/api-s-and-production-code-shouldn-t-be-designed-by-scientists.aspx)

```
SELECT * FROM
(
    SELECT a.*, rownum r__
    FROM
    (
        SELECT * FROM ORDERS WHERE CustomerID LIKE 'A%'
        ORDER BY OrderDate DESC, ShippingDate DESC
    ) a
    WHERE rownum < ((pageNumber * pageSize) + 1 )
)
WHERE r__ >= (((pageNumber-1) * pageSize) + 1) 
```

* * *

## 回答 #2

> 赞同：145
> 
> 时间：2008-10-27T22:57:20.233

[向 Tom 询问](https://blogs.oracle.com/oraclemagazine/post/on-top-n-and-pagination-queries)分页和非常非常有用的分析功能。

这是该页面的摘录：

```
select * from (
    select /*+ first_rows(25) */
     object_id,object_name,
     row_number() over
    (order by object_id) rn
    from all_objects
)
where rn between :n and :m
order by rn; 
```

* * *

## 回答 #3

> 赞同：96
> 
> 时间：2015-04-28T19:04:42.527

为了完整起见，对于寻求更现代解决方案的人们，**Oracle 12c**中有一些新特性，包括更好的分页和顶部处理。

**寻呼**

分页看起来像这样：

```
SELECT *
FROM user
ORDER BY first_name
OFFSET 5 ROWS FETCH NEXT 10 ROWS ONLY; 
```

**前 N 条记录**

获取最高记录如下所示：

```
SELECT *
FROM user
ORDER BY first_name
FETCH FIRST 5 ROWS ONLY 
```

请注意上述两个查询示例如何具有`ORDER BY`子句。新命令尊重这些并在排序后的数据上运行。

我找不到一个好的 Oracle 参考页面，`FETCH`或者`OFFSET`但是[这个页面](http://oracle-base.com/articles/12c/row-limiting-clause-for-top-n-queries-12cr1.php)对这些新特性有很好的概述。

**表现**

正如@wweicker 在下面的评论中指出的那样，性能是 12c 中新语法的一个问题。我没有 18c 的副本来测试 Oracle 是否对其进行了改进。

有趣的是，当我第一次在我的表（1.13 亿多行）上运行新方法的查询时，我的实际结果返回得稍微快一些：

*   新方法：0.013 秒。
*   旧方法：0.107 秒。

然而，正如@wweicker 所提到的，新方法的解释计划看起来更糟：

*   新方法成本：300,110
*   旧方法成本：30

新语法导致对我的列上的索引进行全面扫描，这是全部成本。当限制未索引的数据时，情况可能会变得更糟。

让我们看看在前一个数据集上包含单个未索引列时：

*   新方法时间/成本：189.55 秒/998,908
*   旧方法时间/成本：1.973 秒/256

总结：在 Oracle 改进此处理之前谨慎使用。如果你有一个索引可以使用，也许你可以使用新方法。

希望我很快就会有 18c 的副本可以玩并且可以更新

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2015-11-03T11:32:28.000

只是想总结一下答案和评论。有很多方法可以进行分页。

在 oracle 12c 之前，没有 OFFSET/FETCH 功能，因此请按照@jasonk 的建议查看[白皮书。](http://www.inf.unideb.hu/~gabora/pagination/article/Gabor_Andras_pagination_article.pdf)这是我找到的关于不同方法的最完整的文章，并详细解释了优缺点。在这里复制粘贴它们需要大量时间，所以我不会这样做。

jooq 创建者还发表了一篇很好的文章，解释了 Oracle 和其他数据库分页的一些常见警告。[jooq 的博文](http://blog.jooq.org/2014/06/09/stop-trying-to-emulate-sql-offset-pagination-with-your-in-house-db-framework/)

好消息，从 oracle 12c 开始，我们有了新的 OFFSET/FETCH 功能。[OracleMagazine 12c 新特性](http://www.oracle.com/technetwork/issue-archive/2013/13-sep/o53asktom-1999186.html)。请参考《Top-N 查询与分页》

您可以通过发出以下语句来检查您的 oracle 版本

```
SELECT * FROM V$VERSION 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2013-12-16T17:33:01.250

尝试以下操作：

```
SELECT *
FROM
  (SELECT FIELDA,
    FIELDB,
    FIELDC,
    ROW_NUMBER() OVER (ORDER BY FIELDC) R
  FROM TABLE_NAME
  WHERE FIELDA = 10
  )
WHERE R >= 10
AND R   <= 15; 
```

通过[[技术]](http://mbfu.it/r/ta)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-04-06T15:06:37.970

在我的项目中，我使用了**Oracle 12c 和 java**。分页代码如下所示：

```
 public public List<Map<String, Object>> getAllProductOfferWithPagination(int pageNo, int pageElementSize, Long productOfferId, String productOfferName) {
    try {

        if(pageNo==1){
            //do nothing
        } else{
            pageNo=(pageNo-1)*pageElementSize+1;
        }
        System.out.println("algo pageNo: " + pageNo +"  pageElementSize: "+ pageElementSize+"  productOfferId: "+ productOfferId+"  productOfferName: "+ productOfferName);

        String sql = "SELECT * FROM ( SELECT * FROM product_offer po WHERE po.deleted=0 AND (po.product_offer_id=? OR po.product_offer_name LIKE ? )" +
             " ORDER BY po.PRODUCT_OFFER_ID asc) foo OFFSET ? ROWS FETCH NEXT ? ROWS ONLY ";

       return jdbcTemplate.queryForList(sql,new Object[] {productOfferId,"%"+productOfferName+"%",pageNo-1, pageElementSize});

    } catch (Exception e) {
        System.out.println(e);
        e.printStackTrace();
        return null;
    } 
```

# base64 - 编写 URL 时如何避免使用非法字符？

> ID：241631
> 
> 赞同：8
> 
> 时间：2008-10-27T22:40:34.337
> 
> 标签：base64

我正在编写一个基于某些输入*动态*创建 URL 的 Web 应用程序，以供客户端在其他时间使用。为了讨论起见，这些 URL 可以包含某些字符，例如**正斜杠（即 '/'）**，不应将其解释为实际 URL 的一部分，而应仅作为参数。例如：

```
http://mycompany.com/PartOfUrl1/PartOfUrl2/ArgumentTo/Url/GoesHere
```

如您所见，**ArgumentTo/Url/GoesHere**确实有正斜杠，但这些应该被*忽略或转义*。

这可能是一个不好的例子，但手头的问题更笼统，适用于其他*特殊字符*。

### 那么，如果 URL 的某些部分只是*参数*，不应该用于解析实际的 Web 请求，那么有什么好的方法来处理呢？

# 更新：

鉴于一些答案，我意识到我没有指出一些希望有助于澄清的部分。

我想保持这种相当语言不可知论，因为如果客户可以提出请求，那就太好了。例如，如果客户端知道它想要传递**ArgumentTo/Url/GoesHere**，那么如果可以将其*编码*为一个*唯一的*字符串，服务器可以在其中转身并对其进行*解码*以供使用，那就太好了。

我们是否可以假设 .NET Framework 中的 HttpUtility.HtmlEncode/HtmlDecode 等类似功能在其他系统/平台上可用？URL 不一定要*漂亮*，因此路径中包含*真实的单词*并不重要。

### 像参数的base64编码这样的东西会起作用吗？

似乎 base64 编码/解码在任何平台/语言上都相当容易获得。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-27T22:46:11.300

您没有说您使用的是哪种语言，但 PHP 具有有用的`urlencode`功能，而 C# 具有`HttpUtility.URLEncode`并且`Server.UrlEncode`应该很好地编码您的部分 URL。

如果您需要另一种方式，[此页面](http://www.december.com/html/spec/esccodes.html)有一个编码值列表。例如：`/ == %2f`。

### 更新

根据您更新的内容，我会说使用 Voyagerfan 的 URLRewriting 的想法来制作类似的东西：

```
http://www.example.com/([A-Za-z0-9/]+) http://www.example.com/?page=$1 
```

然后使用应用程序 GET 解析器将其过滤掉。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-27T22:51:35.750

您可以使用[Apache 重写](http://httpd.apache.org/docs/2.0/misc/rewriteguide.html)来重写`http:// mycompany.com/PartOfUrl1/PartOfUrl2`，`http:// mycompany.com/path/to/program.php`然后`ArgumentTo/Url/GoesHere`作为标准 GET 参数传入。所以服务器实际上发回的是响应`http:// mycompany.com/path/to/program.php?arg=ArgumentTo/Url/GoesHere`

重写是防止技术变化的好方法（例如，从 PHP 切换到 ASP 不会改变您的 URL）并同时为您的用户提供友好的 URL。

## 更新

使用您的示例 URL 并以我之前所说的内容为基础，我会说在您的 httpd.conf 或 .htaccess 中使用此代码：

`RewriteEngine On`

`RewriteRule http:// mycompany.com/PartOfUrl1/PartOfUrl2/([A-Za-z0-9]) http://mycompany.com/path/to/program.php?arg=$1`

`http://`（顺便说一句，删除 中第一个之后的空格`RewriteRule`，加上该行需要不包含*换行符*。）

更改路径、文件名、arg 名称等都可以；这里的关键部分是正则表达式 ( `([A-Za-z0-9])`) 和`$1`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-27T23:28:23.383

是的，Base64 编码您的参数将适用于您，但是您需要确保您的整个 URL 在目标浏览器的大小限制之下（[根据此页面](http://support.microsoft.com/kb/208427)，IE 4-7 为 2083 个字符）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-27T22:46:17.417

我相信如果使用.net，您正在寻找的是 HttpUtility.EncodeUrl() 方法，因为它有很多覆盖。看这里：http: [//msdn.microsoft.com/en-us/library/system.web.httputility.urlencode.aspx](http://msdn.microsoft.com/en-us/library/system.web.httputility.urlencode.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-27T22:46:22.843

在服务器对象上使用 HtmlEncode 和 Decode 方法。我相信这将删除大多数不应该出现的字符并处理其他内容，例如空格等。

这是 MSDN 文章：http: [//msdn.microsoft.com/en-us/library/ms525347.aspx](http://msdn.microsoft.com/en-us/library/ms525347.aspx)

# windows - 如何检测如何转义路径中的空格

> ID：241634
> 
> 赞同：0
> 
> 时间：2008-10-27T22:43:21.587
> 
> 标签：windows, ruby, cygwin

在 Cygwin 中，路径中的空格必须用反斜杠转义 在 Windows 中不正确，将整个路径放在引号中

有没有办法在 Ruby 中自动转换为这个？

否则，如何在 Ruby 中检测我是使用 Windows 还是 Cygwin 运行？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-27T22:56:50.793

Cygwin 中的引用路径应该可以正常工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-17T11:49:52.423

[http://rant.rubyforge.org/](http://rant.rubyforge.org/)

```
sys.escape("foo bar")
# gives on Windows: '"foo bar"'
# other systems: 'foo\ bar' 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T14:07:06.730

我至少找到了如何检测平台 - RUBY_PLATFORM 常量定义了这一点。

# php - 如何为 Drupal View 的模块创建自定义过滤器？

> ID：241645
> 
> 赞同：11
> 
> 时间：2008-10-27T22:48:19.050
> 
> 标签：php, drupal, drupal-6, drupal-views

我在 Drupal 6 站点上安装了 Profile、CCK 和 Views2 模块。我在用户配置文件中添加了一个字符串字段。我可以通过 Views GUI builder 轻松过滤预设值，非常好。但是，我希望根据其他环境变量（即`$_SERVER['SERVER_NAME']`）动态设置过滤条件。

那里有一个基本的“如何编写自定义drupal-views-filter”吗？我一直在查看文档，但是对于我的简单想法来说，如何做到这一点并不明显。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T15:55:57.330

您可以创建自己的函数，如下所示添加自己的过滤器。

```
<?php custom_views_embed_view($view_name, $display_id) {
$view = views_get_view($view_name);
$view->set_display($display_id);
$id = $view->add_item($display_id, 'filter', 'node', 'created',
                      array( 'value' => array('type' => 'date', 'value' => date('c')), 'operator' => '<='));
return $view->execute_display($display_id);
}
?> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-01-29T08:04:03.587

I have a similar problem and this article has been very helpful in resolving the problem.

[http://www.metaltoad.com/blog/drupal-7-tutorial-creating-custom-filters-views](http://www.metaltoad.com/blog/drupal-7-tutorial-creating-custom-filters-views)

And hook_views_data oficial documentation

[http://api.drupal.org/api/views/docs%21docs.php/function/hook_views_data/6](http://api.drupal.org/api/views/docs%21docs.php/function/hook_views_data/6)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T22:18:45.270

在查看为我自己的站点安装的过滤器类型之后，有可能过滤器必须基于某个数据库字段，在这种情况下，您尝试实现的目标是不可能的。过滤器似乎为生成的 SQL 查询提供了 WHERE 子句。

说了这么多，如果你想更进一步，最好的办法是从一个已经为视图提供过滤器的模块开始。节点模块的视图提供了过滤器；或者，您可以查看还提供一些过滤器的[音频模块。](http://drupal.org/project/audio)此外，发布到 Drupal 论坛或支持列表可能会打开另一个模块，让您实现您正在尝试的目标。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T06:52:57.350

是的，你可以做到。尝试使用模块“视图过滤块”。一旦启用块..在查看页面时从“查看源代码”中提取块的 html。现在禁用“视图过滤器块”...创建您自己的自定义块..使用您喜欢的任何 css 添加代码使其看起来很漂亮。在此代码中，使用 php 动态指定您希望过滤器初始选择的内容。确保您实际选择了过滤器所基于的字段..然后在自定义 php 块中使用 php 代码编写 IF 条件来检查 server_name 值并相应地为过滤器变量分配正确的值。”

可能还有其他（可能甚至更好）的方法来实际编写一个模块来使用 filter 。所以这只是一个建议。也试试“Views PHP Filter”。我还没有使用它，但听起来值得一试。

*   通过drupal用户（drupal用户名：drupdrips）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-11-22T10:34:53.293

您可以使用[`viewsphpfilter`](http://drupal.org/project/viewsphpfilter)允许过滤视图的模块，`node id.`但是如果您需要将其扩展为`user views`

# database - 插入记录时索引与不索引

> ID：241650
> 
> 赞同：2
> 
> 时间：2008-10-27T22:51:49.213
> 
> 标签：database, sorting, clustered-index

我有几个关于不使用索引是否最好的问题。

背景：我的记录有时间戳属性，记录会按照时间戳的顺序插入（即按时间顺序插入）。

问题：

1.  如果我不使用索引，数据库是否通常按照插入的顺序插入记录？

2.  如果对#1 的回答是肯定的，那么当我执行“SELECT .. WHERE timestamp > X”类型查询时，数据库是否会有效，或者它是否必须遍历每条记录，因为它没有被索引？我假设如果没有索引，数据库将不会“知道”记录是按排序顺序插入的，因此无法使用数据库的排序属性。

我认为聚集索引最适合这些类型的记录及其插入。

请让我知道你们的想法。

谢谢，jbu

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-27T22:57:40.107

以我的经验，是的，数据库会按时间顺序插入内容，尤其是在您从不删除任何内容的情况下。但是，这并不能保证，并且尝试依赖无法保证的行为是一个非常糟糕的主意。

此外，查询规划器不会知道这一事实，因此您在没有索引的情况下执行的任何查询都会导致全表扫描。这是否比索引查询慢在很大程度上取决于您拥有的数据类型，以及查询中“X”之后的百分比。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T10:47:52.280

聚集索引是记录在磁盘上存在的顺序。无论您是否指定一个，总会有一个，因为磁盘上必须有一个订单。

主键也是聚集索引是正常的，但不一定是这种情况。

如果您正在执行批量插入，您可能会插入多个具有相同时间戳的记录。显然，这不能成为主键。

为了执行像“SELECT .. WHERE timestamp > X”这样的查询，“timestamp”字段上的索引将提高该查询的性能，无论它是否是集群的。

'timestamp' 字段上的索引是否应该聚集以及是否还需要其他索引将取决于您需要对数据执行的所有查询。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-27T22:58:01.073

当然，这取决于您使用的数据库！

一般来说，如果你有很多插入要做，最好禁用索引，执行插入，然后重新创建索引

使用时间戳作为聚集索引（即存储行的顺序）仅在您最常见的查询按时间顺序（而不是检索此行）并且没有重复的时间戳时才重要

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-27T22:58:12.447

如果表中从未有任何删除，您可以假设数据库将简单地将新块添加到表的末尾。但是，不能保证磁盘上的这些块是否是连续的，或者是否正确推进（即，表很可能会随着时间的推移而碎片化）。

来自没有索引的表的任何 SELECT 都将导致表扫描。索引是您如何“告诉”数据库有关“时间戳按升序排列”之类的信息。

聚集索引可以很好地告诉数据库您希望在表中保持行的索引顺序。但是，它通常（取决于您的实现）仅对合理的静态数据有价值，因为这是数据库确保表的行确实按索引顺序排列的唯一方法，因为它通过重建表来做到这一点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-27T22:58:20.107

什么数据库？

1）
没有索引的表称为堆。堆将按照插入的顺序存储记录。只要您不从多个线程插入，您就可以预测数据库存储记录的顺序。正如其他人指出的那样，这确实假定您不进行删除，在这种情况下您的 DBMS 可能用新行填充空白页面。

2)
如果没有索引，DBMS 将不得不进行一次完整的表扫描（它以与记录数相关的线性时间运行）。对于插入时间戳增加的记录的记录，聚集索引会很好。只要您不插入旧时间戳，DBMS 就必须重新排列由于聚集索引而物理上的行。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-27T23:07:22.630

我是帖子创建者jbu。

感谢大家的快速输入。

要解决更多问题：

是的，我有静态数据 - 我不会删除。

我正在测试几个不同的数据库：Sybase SQL Anywhere、Oracle Berkeley DB、H2、Firebird、SQLite，可能还有其他一些。

致 Steven Lowe：我的表将有数百万条记录（最多会增长到 32GB）。如果我关闭索引一段时间，然后重新创建索引，那会不会需要很长时间 - 至少几分钟（我会假设它可能需要更长的时间）？另外，我认为您假设插入的连续流动将会中断。我几乎会一直使用批量插入提交进行插入，所以我认为我的 CPU 和磁盘永远不会真正有休息时间来重新索引。

再次，感谢输入的家伙。

朱布

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-27T23:09:17.727

这是典型的，但任何特定的实现都不能保证，AFAIK。因此，依赖它是不明智的。查询优化器也不依赖它，因此它会进行表扫描。

在您的情况下，时间戳上的聚集索引确实没有缺点。你可以填满 100% 的数据页，但你仍然不会比堆更糟。然而，查询可以利用它，并且可以从略微（如果您返回，例如，90% 的表格）到可笑（如果您要返回，例如，1% 的表格）更快.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-28T00:22:00.780

我相信根据 sql 标准，您永远无法确定在非有序列中选择行的顺序。即使您测试给定的数据库并发现它当前是正确的，但在数据库的下一个修订版中可能并非如此。我的经验秒 Steven Lowe's。如果要在表中插入大量行，请在插入之前禁用（或删除）这些行。插入后重新创建索引将比打开索引的插入花费更少的时间。

艾伦

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-28T10:18:08.470

您需要在时间戳列上创建一个索引才能搜索我的时间戳。做它（TM）。

聚集索引仅在您按主键搜索时对您有帮助。您可以将时间戳作为主键来利用它。

# php - 使用 stream_filter_* 在 PHP 中处理大型（超过 1 Gig）文件

> ID：241663
> 
> 赞同：3
> 
> 时间：2008-10-27T22:58:50.463
> 
> 标签：php, stream, large-files

```
$fp_src=fopen('file','r');

$filter = stream_filter_prepend($fp_src, 'convert.iconv.ISO-8859-1/UTF-8');

while(fread($fp_src,4096)){
    ++$count;
    if($count%1000==0) print ftell($fp_src)."\n";
} 
```

当我运行这个脚本时，在浏览了 35MB 的文件后最终消耗了大约 200MB 的 RAM。

在没有 stream_filter 的情况下运行它，内存占用约为 10 MB。

是什么赋予了？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-27T23:32:12.657

您只需要注册自定义过滤器。iconv 是内置的。这不是特定的操作，使用 rot13 的流过滤器表现出类似的行为。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T23:22:21.850

从我在[这里](http://us3.php.net/manual/en/function.stream-filter-register.php)阅读的内容来看，您没有`stream_filter_prepend()`正确实施，尽管我可能对这个过程有误解。

另外，我不完全确定，但我敢打赌，这与 iconv 是一个昂贵的过程这一事实有关，而与您将其用作流过滤器这一事实关系不大。

祝你好运。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T04:06:23.807

您想使用 stream_filter_prepend() 的任何特殊原因？如果它导致内存问题，那么我会找到另一种方法来完成它的工作。

# php - 不能在正则表达式中使用某些字符

> ID：241673
> 
> 赞同：1
> 
> 时间：2008-10-27T23:02:44.573
> 
> 标签：php, regex

```
if(!eregi("^([0-9a-z_\[\]\*\- ])+$", $subuser))
    $form->setError($field, "* Username not alphanumeric"); 
```

谁能告诉我为什么它不允许诸如`-`and之类的字符`*`？

```
if(!eregi("^([0-9a-z])+$", $subuser))
    $form->setError($field, "* Username not alphanumeric"); 
```

那是原始的代码。一位朋友将其更改为顶部，它将允许 az 和 0-9，但它不允许我需要的其他字符。谁能帮我？

提前致谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-27T23:08:07.200

您的正则表达式使用 PCRE 语法，因此您必须使用 preg_match() 而不是 eregi()。

试试这个代码：

```
else if (!preg_match("/^([0-9a-z_\[\]* -])+$/i", $subuser)) {
$form->setError($field, "* Username not alphanumeric");
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-27T23:10:46.867

对于括号表达式：

要在列表中包含文字，请将其设为`]`第一个字符（在可能的 之后`^`）。要包含文字`-`，请将其设为第一个或最后一个字符，或范围的第二个端点。要将文字`-`用作范围的第一个端点，请将其括在`[.`其中并`.]`使其成为整理元素（见下文）。除了这些和一些使用组合`[`（参见下一段）之外，所有其他特殊字符，包括`\`，在括号表达式中都失去了它们的特殊意义。

所以这应该做你想要的：

```
"^([]0-9a-z_[* -])+$" 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-27T23:10:16.260

不要使用 ereg 系列函数 - 它们速度较慢，如果我没记错的话，最终会被弃用。

这应该解决它

```
if ( preg_match( "/^[^0-9a-z_\[\]* -]$/i", $subuser )
{
    $form->setError( $field, "* Username not alphanumeric" );
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-27T23:09:29.647

即使使用 preg_* 函数，模式也需要包含在非字母分隔符中：

"~^([0-9a-z_[]*- ])+$~"

# ruby - 红宝石中的埃拉托色尼筛

> ID：241691
> 
> 赞同：15
> 
> 时间：2008-10-27T23:16:29.303
> 
> 标签：ruby, sieve-of-eratosthenes

我不想从网上刮掉这个算法的 Ruby 版本，而是想根据[这里](http://en.wikipedia.org/wiki/Sieve_of_Eratosthenes)的描述创建自己的。但是我无法弄清楚两件事

```
def primeSieve(n)
  primes = Array.new

  for i in 0..n-2
   primes[i] = i+2
  end

  index = 0
  while Math.sqrt(primes.last).ceil > primes[index]
    (primes[index] ** 2).step(primes.length - 1, primes[index]) 
      {|x| x % primes[index] == 0 ? primes.delete(x) : ""}
    index += 1
  end

  primes
end 
```

1.  为什么它不迭代到数组的末尾？
2.  根据上面链接中的描述，当数组中最后一个元素的平方根大于当前素数时，循环应该被打破——我之前做过这个。

我相当确定它与修改数组长度的删除操作有关。例如，当我输入 n=10 时，我的函数当前会产生 2,3,5,7,9,10，这显然是不正确的。关于如何改变它以使其按预期工作的任何建议？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-11T12:57:56.693

[www.scriptol.org](http://www.scriptol.org/sieve.php#ruby)有一个更快的实现：

```
def sieve_upto(top)
  sieve = []
  for i in 2 .. top
    sieve[i] = i
  end
  for i in 2 .. Math.sqrt(top)
    next unless sieve[i]
    (i*i).step(top, i) do |j|
      sieve[j] = nil
    end
  end
  sieve.compact
end 
```

我认为它可以稍微改进一下：

```
def better_sieve_upto(n)
  s = (0..n).to_a
  s[0] = s[1] = nil
  s.each do |p|
    next unless p
    break if p * p > n
    (p*p).step(n, p) { |m| s[m] = nil }
  end
  s.compact
end 
```

...主要是因为更快的数组初始化，我认为，但它是微不足道的。（我添加`#compact`到两者以消除不需要`nil`的 s）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-27T23:50:22.497

以下似乎有效。我取出浮点运算并平方而不是平方根。我还用“选择”调用替换了删除循环。

```
while primes[index]**2 <= primes.last
      prime = primes[index]
      primes = primes.select { |x| x == prime || x%prime != 0 }
      index += 1
end 
```

编辑：我想我知道你是如何做到这一点的。以下似乎可行，并且似乎更符合您的原始方法。

```
while Math.sqrt(primes.last).ceil >= primes[index]
    (primes[index] * 2).step(primes.last, primes[index]) do
      |x|
      primes.delete(x)
    end
    index += 1
end 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-03-05T09:13:05.593

这是[维基百科文章伪代码](http://en.wikipedia.org/wiki/Sieve_of_Eratosthenes)的一个非常简单的实现，使用[位数组。](https://github.com/ingramj/bitarray)

```
#!/usr/bin/env ruby -w

require 'rubygems'
require 'bitarray'

def eratosthenes(n)

   a = BitArray.new(n+1)

   (4..n).step(2) { |i|
      a[i] = 1
   }

   (3..(Math.sqrt(n))).each { |i|
       if(a[i] == 0)
           ((i*i)..n).step(2*i) { |j|
               a[j] = 1
           }
       end
   }
   a
 end

def primes(n)
    primes = Array.new
     eratosthenes(n).each_with_index { |isPrime, idx|
        primes << idx if isPrime == 0
     }
     primes[2..-1]
end 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-05-11T02:02:10.773

这是有兴趣的人的参考。代码来自[这个站点](https://github.com/morizyun/aoj-ruby-python/blob/master/ruby/0009.rb)。

这段代码也使用了埃拉托色尼筛法。

```
n = 1000000
ns = (n**0.5).to_i + 1
is_prime = [false, false] + [true]*(n-1)
2.upto(ns) do |i|
  next if !is_prime[i]
  (i*i).step(n, i) do |j|
    is_prime[j] = false
  end
end

count = 0
list = (0..n).map do |i|
  count += 1 if is_prime[i]
  count
end

while gets
  puts list[$_.to_i]
end 
```

这是[另一个](http://rosettacode.org/wiki/Sieve_of_Eratosthenes#Ruby)。

```
def eratosthenes(n)
  nums = [nil, nil, *2..n]
  (2..Math.sqrt(n)).each do |i|
    (i**2..n).step(i){|m| nums[m] = nil}  if nums[i]
  end
  nums.compact
end

p eratosthenes(100) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-10-17T01:01:34.380

或者

```
x = []
Prime.each(123) do |p|
  x << p
end 
```

可能有一种方法可以在这里使用注入，但是今天开始的事情让我很头疼。

# c# - C#如何将中断发送到另一个子例程？

> ID：241694
> 
> 赞同：8
> 
> 时间：2008-10-27T23:19:17.380
> 
> 标签：c#, multithreading

我有一个循环正在运行，它将处理 1000 条记录，目前一旦循环运行它就无法停止，用户必须等到它完成。当有人单击“取消”按钮时，如何停止循环？我如何闯入其他例行程序？

谢谢

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-27T23:21:13.367

您可以在自己的线程中运行它并中止线程。请注意，这可能会使操作处于不良状态。

相反，您**应该**创建一个线程在安全点检查的退出标志。如果它被标记为退出，线程将在安全时立即停止。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-27T23:27:40.217

**您可以只使用[BackgroundWorker](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker_members.aspx)组件。**

它是基于事件的，非常易于使用。看起来非常适合您所描述的内容。

它对*取消信号*以及*进度报告*也有很好的支持。

还有很多代码示例，您可以在 google 上查找。

* * *

设置[WorkerSupportsCancellation](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.workersupportscancellation.aspx)属性，使其为真。

```
backgroundworker1.WorkerSupportsCancellation = true; 
```

*在启动*工作程序之前执行此操作。

然后，在循环中，您可以轮询[CancellationPending](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.cancellationpending.aspx)属性：

```
if (backgroundWorker1.CancellationPending) return; 
```

只是一个例子，但你应该明白。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T00:06:34.757

感谢您的回复。这是一个`backgroundworker`但是当我使用`backgroundworker1.cancelAsync();`我得到异常：

> “此 BackgroundWorker 声明它不支持取消。修改 WorkerSupportsCancellation 以声明它确实支持取消”

我该如何改变这个？这是继承的代码，对不起！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-27T23:25:26.370

正如马克所说，您需要实现某种合作同步。人们经常倾向于在这里使用 Thread.Abort ......但这是一个坏主意。

有许多问题可以解决这个问题，例如，请参阅：“ [C# 中是否有一种好的方法可以在给定线程上引发异常。](https://stackoverflow.com/questions/44656/is-there-a-good-method-in-c-for-throwing-an-exception-on-a-given-thread) ”

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-27T23:28:56.720

您可以添加一个设置布尔标志的取消按钮

在循环内的关键点添加“Application.DoEvents”，然后检查布尔标志。如果标志已被触发，请执行清理并退出循环。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-28T00:11:26.870

将`WorkerSupportsCancellation`您的属性设置`BackgroundWorker`为 true :-)

您还必须检查`CancellationPending`循环内的属性以查看是否应该中止处理。chakrit 链接的 MSDN 文章有一个很好的示例代码块

编辑：D'oh，你让我在几秒钟内得到了 chakrit :)

# php - 如何禁用 PHP 会话 cookie？

> ID：241715
> 
> 赞同：10
> 
> 时间：2008-10-27T23:33:25.807
> 
> 标签：php, session

我正在编写 PHP 代码，我想自己使用 POST 传递会话 ID。我不希望 cookie 存储会话，因为当用户退出 POST 周期时它应该会丢失。

PHP 会自动设置可用的 cookie。我了解到可以通过`session.use_cookies`在`php.ini`. 不幸的是，我无权访问该文件，我也不想破坏在同一服务器上运行的其他脚本的行为。

有没有办法禁用或取消 PHP 脚本中的会话 cookie？

**编辑：**由于建议的解决方案对我不起作用，我在代码中发现会话应该无效的位置使用了 $_SESSION = array() 。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-10-27T23:35:13.667

使用[ini_set()](http://php.net/ini_set)：

```
ini_set('session.use_cookies', '0'); 
```

或者在您的 php.ini 文件中：

```
session.use_cookies = 0 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-27T23:38:32.177

错误可以通过创建自己的 .htaccess 文件来覆盖主机的默认设置，如果你还没有接触过，这里有一个很棒的教程 [http://www.askapache.com/htaccess/apache-htaccess.html](http://www.askapache.com/htaccess/apache-htaccess.html)

或者如果您懒得学习，只需在您的站点目录上创建一个“.htaccess”文件（是的，这就是文件名）并放置以下代码

```
SetEnv session.use_cookies='0'; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-27T23:40:14.793

您还可以将该设置放在 .htaccess 中，使其适用于所有脚本，否则您需要确保在每个请求上调用代码。

例如。

php_value session.use_cookies 0

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-28T19:53:18.777

如果您只需要能够在给定时间取消会话，请使用 session_destroy()。如果您想完全结束会话，这里是直接从文档中复制/粘贴的片段：

```
// Initialize the session.
// If you are using session_name("something"), don't forget it now!
session_start();

// Unset all of the session variables.
$_SESSION = array();

// If it's desired to kill the session, also delete the session cookie.
// Note: This will destroy the session, and not just the session data!
if (isset($_COOKIE[session_name()])) {
    setcookie(session_name(), '', time()-42000, '/');
}

// Finally, destroy the session.
session_destroy(); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-01-08T15:17:45.967

我在使用 PHP 记录的销毁带有 cookie 的会话的方法时遇到了麻烦。

```
// If it's desired to kill the session, also delete the session cookie.
// Note: This will destroy the session, and not just the session data!
if (ini_get("session.use_cookies")) {
    $params = session_get_cookie_params();
    setcookie(session_name(), '', time() - 42000,
        $params["path"], $params["domain"],
        $params["secure"], $params["httponly"]
    );
} 
```

这导致我看到 cookie 设置了两次：

```
Set-Cookie: SESSION_NAME=deleted; expires=Sat, 08-Jan-2011 14:09:10 GMT; path=/; secure
Set-Cookie: SESSION_NAME=1_4f09a3871d483; path=/ 
```

如 PHP 注释中所述，将 cookie 值设置为空 ('') 以外的值会删除“已删除”值，但保留第二个 cookie 集。

为了摆脱这种情况，我不得不添加上面建议的代码：

```
ini_set('session.use_cookies', '0'); 
```

我没有查看会话处理的源代码，但我的猜测是 setcookie(...) 绕过了会话模块，所以会话不知道我调用了它。所以，在我设置了一个已删除的 cookie 后，它正在设置一个默认 cookie。

我在 Mac 上测试：带有 Suhosin-Patch (cli) 的 PHP 5.3.6（构建时间：2011 年 9 月 8 日 19:34:00）

* * *

## 回答 #6

> 赞同：-4
> 
> 时间：2008-10-28T01:09:51.947

这样做的方法是自己设置会话。

在所有其他文件都包含的中央包含文件中（您确实有其中一个，对吗？），您需要尽早做一些事情。

```
if( !array_key_exists('sessionid', $_POST) ) {
    // recreate the sessionid
    $sessionid = md5(rand().' '.microtime()); // Or something
} else {
    $sessionid = $_POST['sessionid'];

session_id($sessionid);
session_start(); 
```

现在您必须记住，一旦您开始填写表格，您需要包括：

```
<input type='hidden' name='sessionid'><?= session_id() ?></input> 
```

# monitoring - 在 Windows 中使用 Nagios/Monit/Munin

> ID：241723
> 
> 赞同：3
> 
> 时间：2008-10-27T23:36:53.443
> 
> 标签：monitoring, munin

我正在构建一个 .NET 3.5 Web 应用程序，并且在我完成项目时正在考虑所有基本问题，例如监控、异常处理等等。

该应用程序在推出时显然会很小，因为在网站大力推广之前它不会有高负载（代码行数/圈复杂度等会很高，并且该应用程序将具有商业规模与 Facebook 等大型系统相同的考虑因素）。

无论如何，我将把监控等“基础”服务外包给开源解决方案，以削减成本和开发时间，这样我就可以专注于业务功能和推广。我想使用带有 monit 和 munin 的 nagios 作为我的工具来监控我的系统。问题是，这些工具是为 Linux/Unix 堆栈设计的。这里有没有人有让它与 Windows 一起工作的经验？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-28T00:41:25.903

您可能会发现运行第二台运行 Linux 的服务器比将 nagios 和公司硬塞到一个它们不是为之开发的环境中要容易得多。

如果您确实坚持尝试在 Windows 中运行它们，并且如果您遇到很多很多问题，*请*在您没有按预期使用这些产品时抵制这些产品的坏话。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-04T22:29:23.557

您可以使用 VMWare 或 VirtualBox for Windows，而不是拥有额外的硬件服务器，托管一个小型 Linux VM 并在其上安装 Nagios。这非常简单，Nagios 安装对于基于 DEB 和 RPM 的发行版（可能还有其他发行版，但不确定）也很简单。

//尼古拉斯

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-13T09:30:34.693

来自全 Windows 环境，我们不得不“咬紧牙关”并在 VMWare 上安装 linux，以便稍后运行 Munin 和 maby Nagios。我们唯一遇到的问题是学习 Linux。

# iphone - 如何在我的 iPhone 应用程序中使 UIView “可滚动”？

> ID：241724
> 
> 赞同：3
> 
> 时间：2008-10-27T23:37:05.020
> 
> 标签：iphone, cocoa-touch, uiscrollview

我有一个`UIView`最终将包含大约 2 个屏幕的信息。我想让用户能够通过轻弹向下滚动（就像 Safari 中的标准轻弹）。
我该怎么做呢？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-27T23:40:45.730

把你的`UIView`里面一个`UIScrollView`. Apple 在他们的开发者页面上有一些很好的示例代码。

# web-services - 使用 SOAP 从 VBA 调用 Web 服务

> ID：241725
> 
> 赞同：8
> 
> 时间：2008-10-27T23:37:36.173
> 
> 标签：web-services, vba, excel

我正在尝试在 Excel 宏中调用 Web 服务：

```
Set objHTTP = New MSXML.XMLHTTPRequest
objHTTP.Open "post", "https://www.server.com/EIDEServer/EIDEService.asmx"
objHTTP.setRequestHeader "Content-Type", "text/xml"
objHTTP.setRequestHeader "SOAPAction", "PutSchedule"
objHTTP.send strXML 
```

我得到以下回复：

```
 <?xml version="1.0" encoding="utf-8"?>
  <soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
    <soap:Body>
      <soap:Fault>
        <faultcode>soap:Client</faultcode>
        <faultstring>Server did not recognize the value of HTTP Header SOAPAction: PutSchedule.</faultstring>
        <detail />
      </soap:Fault>
    </soap:Body>
  </soap:Envelope> 
```

以前有人做过这样的事情吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T01:20:11.737

您的 SOAP 操作还应包括方法的名称空间，例如

```
"http://tempri.org/PutSchedule" 
```

找出你的 Service 的命名空间，并将其添加到方法名称 PutSchedule 的前面。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-04T12:09:25.650

看起来更像是您使用 xml-rpc 而不是肥皂。使用soap类型库与webservice交互：http: [//msdn.microsoft.com/en-us/library/aa192537](http://msdn.microsoft.com/en-us/library/aa192537(office.11).aspx) (office.11​​).aspx ，或者与你的ms office版本对应的那个

# javascript - 如何使用 jQuery 在下拉列表中通过其文本值选择一个项目？

> ID：241727
> 
> 赞同：15
> 
> 时间：2008-10-27T23:39:03.877
> 
> 标签：javascript, jquery, dom

如果我有以下选择，并且不知道用于提前选择项目的值（如在这个[问题](https://stackoverflow.com/questions/196684/jquery-get-select-option-text)中或我想要选择的项目的索引），如果我知道如何使用 jQuery 选择其中一个选项像选项 C 一样的文本值？

```
<select id='list'>
<option value='45'>Option A</option>
<option value='23'>Option B</option>
<option value='17'>Option C</option>
</select> 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-27T23:45:24.380

```
var option;
$('#list option').each(function() {
    if($(this).text() == 'Option C') {
        option = this;
        return false;
    }
}); 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-27T23:50:13.213

这应该可以解决问题：

```
// option text to search for
var optText = "Option B";
// find option value that corresponds
var optVal = $("#list option:contains('"+optText+"')").attr('value');
// select the option value 
$("#list").val( optVal ) 
```

正如 eyeliidlessness 指出的那样，当正在搜索的文本可以在多个选项中找到时，这将表现得不可预测。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2011-01-11T03:27:24.160

```
$("#list option").each(function() {
  this.selected = $(this).text() == "Option C";
}); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-09-01T20:33:09.800

```
function SelectItemInDropDownList(itemToFind){    
         var option;
         $('#list option').each(function(){
             if($(this).text() == itemToFind) {
                 option = this;
                 option.selected = true;
                 return false;    
                }
           });  } 
```

我只修改了前面的代码，因为它只定位了选择列表中的选项，有些人可能想要文字演示。

# windows - 有没有绕过运行 EXE 文件限制的好方法？

> ID：241731
> 
> 赞同：3
> 
> 时间：2008-10-27T23:40:16.353
> 
> 标签：windows, restriction

这些天我必须经常在图书馆进行计算，并且我的 U3 智能驱动器一直存在一些问题。尽管在某些计算机上工作，但这里的公共库限制 EXE 文件的执行并禁用自动播放，使我的 U3 应用程序无用。有没有一种很好的方法可以绕过限制并获得一些东西 - 任何东西 - 运行？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-28T00:37:31.620

如果您成功绕过限制并被抓住，您可能会被完全禁止使用图书馆的计算机。我建议在没有可执行文件的情况下生活，或者找一台计算机在其他地方使用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-27T23:41:57.257

我怀疑这些限制是为了防止这种情况发生。也许这些限制正在按预期运行。

# database - 大多数表中的相同字段

> ID：241746
> 
> 赞同：6
> 
> 时间：2008-10-27T23:46:49.133
> 
> 标签：database, entity-relationship

在数据库原型中，我有一组字段（如名称、描述、状态），这些字段在多个功能不同的表中是必需的。

这些字段始终具有相同的最终用户功能，用于标记、显示、搜索、过滤等。它们不是外键约束的一部分。这应该如何建模？

我可以想到以下变体：

*   每个表都获得所有这些属性。在这种情况下，您将如何命名它们？相同，在每个表中，或带有表名前缀（如 usrName、prodName）

*   将它们移动到表属性中，将外键添加到“核心”表中，引用 Attributes.PK

*   如上所述，但不是外键，而是在各自的核心表中使用 Attributes.PK 作为 PK。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-28T00:28:39.313

听起来您可能将标准化的想法走得太远了。请记住，这是您减少**数据**冗余的想法。您的示例似乎表明您担心数据库设计的元信息中的“冗余”。

最终，`user.name`和的功能与和`user.description`不同，应该这样对待。因为，这取决于你的意思。是否只是产品/用户记录处于活动状态的指标？如果是这样，那么将其拆分到另一个表可能是有意义的。`product.name``product.description``status``status`

使用您提供的信息，如果“活动/过期/已删除”只是数据库中状态的指示，那么我肯定会同意这样的表结构：

```
users            products         status
  id               id               id
  name             name             name
  description      description
  status_id        status_id 
```

但是，如果`status`可以想象可以改变以表示语义上不同的东西（即，对于用户，可能是“活跃/退休/解雇”，我建议将其拆分为未来的设计证明：

```
user_status     product_status
  id              id
  name            name 
```

简而言之，规范化你的数据，而不是你的数据库设计。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-28T00:27:23.577

除非您跨表使用相同的名称或描述*值*，否则不应规范化该数据。状态类型倾向于被重用，因此，将它们标准化。例如：

```
order_status_types
- id
- name
- description

shipping_accounts
- id
- name
- description

orders
- order_status_type_id
- shipping_account_id

preferences
- shipping_account_id 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-27T23:54:39.150

规范化通常是任何关系数据库中的最佳实践（在合理范围内）。

如果您有像州这样的字段（表示一个国家/地区的州），那么像“州”这样带有（id、短名称、长名称等）的引用表可能是要走的路，那么每条记录只引用一个州需要一个 state_id 列，正如您所提到的，它是对 State 表中记录的引用。

但是，在某些情况下，不一定需要对所有数据进行规范化，因为它只会使事情复杂化，但在哪里做和不做的地方应该很明显。

希望这可以帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-28T00:28:53.823

我会给每个表自己的一组列，即使它们具有相同的名称并且在逻辑上相似。

如果您需要通过添加或删除其中一些列或更改它们的数据类型来更改其中一个表，那么您只能在它相关的表中执行此操作，而不是弄清楚如何使您的共享属性表复杂化.

让每个表控制自己的属性可以促进[Cohesion](http://c2.com/cgi/wiki?CouplingAndCohesion)，这是一件好事。它还避免了您关于外键去向的问题。

至于列命名，没有必要也不建议在列名上加上前缀。如果您执行的连接导致来自两个表的同名列，请使用别名来区分它们。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-10-22T22:11:44.653

我总是给每个表一个 3 个字母的代码，然后我在所有字段名称中使用它。这样，在产品表中我有 prdname、prddescription、prdstatus，在供应商文件中我有 venname、vendescription、venstatus。当事物加入时，无需担心相同的命名字段。

当然，这些表都有一个名为plain old **id**的字段，而product 表将有一个名为venid 的字段，它引用vendor 表中的id 字段。在这种情况下，我没有在它上面加上 prd 前缀，因为 venid 非常有意义并且是明确的。

# vb.net - VB.NET 中 Array() 的等价物？

> ID：241758
> 
> 赞同：7
> 
> 时间：2008-10-27T23:52:51.650
> 
> 标签：vb.net, vb6

在 VB6 中，您可以这样做：

```
Dim a As Variant
a = Array(1, 2, 3)
```

你能在 VB.NET 中用特定类型做类似的事情吗，像这样？：

```
Dim a() As Integer
a = **Array**(1, 2, 3)
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-27T23:53:58.900

```
Dim a() As Integer = New Integer() {1, 2, 3} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T00:03:20.740

如果您是 .NET 新手，您会想了解 List 集合以及它在[排序、过滤和迭代方面为](http://msdn.microsoft.com/en-us/library/41107z8a(VS.80).aspx)您提供的灵活性。

# perl - Net::SSLeay post_https 编译错误：参数太多

> ID：241783
> 
> 赞同：2
> 
> 时间：2008-10-28T00:02:17.073
> 
> 标签：perl, openssl, perldoc

我正在与支付网关交互，但对 Net::SSLeay 及其 post_https 子例程没有任何帮助。支付网关已向我颁发了必须用于身份验证的客户端证书。Net::SSLeay perldoc 具有以下示例：

```
($page, $response, %reply_headers)
         = post_https('www.bacus.pt', 443, '/foo.cgi',           # 3b
              make_headers('Authorization' =>
                           'Basic ' . MIME::Base64::encode("$user:$pass",'')),
              make_form(OK   => '1', name => 'Sampo'),
              $mime_type6, $path_to_crt7, $path_to_key8); 
```

我自己的版本如下并返回错误**Net::SSLeay::post_https 的参数太多**：

```
#!/usr/bin/perl

use strict;
use warnings;
use Net::SSLeay qw(post_https);

my %post = (
    #snip
);

my ($page, $response, %reply_headers) = post_https(
    'www.example.com',
    443,
    '/submit',
    '',
    make_form(%post),
    'text/xml',
    '/path/to/cert',
    '/path/to/key',
); 
```

为什么会出现这个错误？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T00:33:03.923

Net::SSLeay 的新版本没有旧版本的原型。阅读新旧版本的源代码我会说原型是一个错误（它调用的代码可以处理比宣传更多的变量）。

我推荐的解决方案是升级到较新版本的 Net::SSLeay。如果这不可能，那么将其称为 &post_https 可能是一个快速但丑陋的解决方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T00:10:26.653

文档不正确。在我的副本（Net::SSLeay 1.04）中，post_https 与您引用的示例一起显示在文档中，但声明最多采用 6 个参数：

```
sub post_https ($$$;***) { do_httpx2(POST => 1, @_) } 
```

我还不确定如何使它工作。

编辑：尝试以老式方式调用 post_https，作为使用 &post_https(...) 的子例程。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-10-28T00:11:11.253

'/path/to/key' 后面多了一个逗号

# c# - 使用 PST/CEST/UTC/等形式的时区解析 DateTime

> ID：241789
> 
> 赞同：62
> 
> 时间：2008-10-28T00:06:29.423
> 
> 标签：c#, .net, parsing, datetime, timezone

我正在尝试解析类似于以下内容的国际日期时间字符串：

```
24-okt-08 21:09:06 CEST 
```

到目前为止，我有类似的东西：

```
CultureInfo culture = CultureInfo.CreateSpecificCulture("nl-BE");
DateTime dt = DateTime.ParseExact("24-okt-08 21:09:06 CEST",
    "dd-MMM-yy HH:mm:ss ...", culture); 
```

问题是我应该为格式字符串中的“...”使用什么？查看[自定义日期和时间格式字符串](http://msdn.microsoft.com/en-us/library/8kb3ddd4.aspx)MSDN 页面似乎没有列出用于解析 PST/CEST/GMT/UTC 形式的时区的格式字符串。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-10-28T00:51:36.023

AFAIK 时区缩写无法识别。但是，如果您将缩写替换为时区偏移量，就可以了。例如：

```
DateTime dt1 = DateTime.ParseExact("24-okt-08 21:09:06 CEST".Replace("CEST", "+2"), "dd-MMM-yy HH:mm:ss z", culture);
DateTime dt2 = DateTime.ParseExact("24-okt-08 21:09:06 CEST".Replace("CEST", "+02"), "dd-MMM-yy HH:mm:ss zz", culture);
DateTime dt3 = DateTime.ParseExact("24-okt-08 21:09:06 CEST".Replace("CEST", "+02:00"), "dd-MMM-yy HH:mm:ss zzz", culture); 
```

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2014-04-04T16:58:23.797

快速的答案是，你不能这样做。

* * *

这就是为什么，

有一个权威的世界时区数据库，您可以从[IANA](http://www.iana.org/time-zones)获得它。

问题是，3 或 4 个字母的缩写与 IANA 时区具有多对一的关联。例如[`"AMT"`](http://www.timeanddate.com/library/abbreviations/timezones/)，意味着不同的东西，这取决于您的文化、您所处的世界的哪个部分以及您的应用程序的上下文。

```
AMT "Armenia Time" Asia          UTC + 4 hours 
AMT "Amazon Time"  South America UTC - 4 hours 
```

如果你真的想解决这个问题，我建议使用[Noda Time](http://nodatime.org/)来代表你`Instance`的 s。您必须编写一些代码来将缩写转换为标准 IANA 时区。

**我们不能为您执行此操作，这取决于您的应用程序的上下文。**

* * *

另一个很好的例子是[`"CST"`](http://www.timeanddate.com/library/abbreviations/timezones/)。

```
CST "China Standard Time"   Asia            UTC + 8 hours 
CST "Central Standard Time" Central America UTC - 6 hours 
CST "Cuba Standard Time"    Caribbean       UTC - 5 hours 
CST "Central Standard Time" North America   UTC - 6 hours 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2015-05-18T12:46:03.530

如果您决定采用搜索和替换路线（我做过），请使用缩写字典。

```
Dictionary<string, string> _timeZones = new Dictionary<string, string>() {
            {"ACDT", "+1030"},
            {"ACST", "+0930"},
            {"ADT", "-0300"},
            {"AEDT", "+1100"},
            {"AEST", "+1000"},
            {"AHDT", "-0900"},
            {"AHST", "-1000"},
            {"AST", "-0400"},
            {"AT", "-0200"},
            {"AWDT", "+0900"},
            {"AWST", "+0800"},
            {"BAT", "+0300"},
            {"BDST", "+0200"},
            {"BET", "-1100"},
            {"BST", "-0300"},
            {"BT", "+0300"},
            {"BZT2", "-0300"},
            {"CADT", "+1030"},
            {"CAST", "+0930"},
            {"CAT", "-1000"},
            {"CCT", "+0800"},
            {"CDT", "-0500"},
            {"CED", "+0200"},
            {"CET", "+0100"},
            {"CEST", "+0200"},
            {"CST", "-0600"},
            {"EAST", "+1000"},
            {"EDT", "-0400"},
            {"EED", "+0300"},
            {"EET", "+0200"},
            {"EEST", "+0300"},
            {"EST", "-0500"},
            {"FST", "+0200"},
            {"FWT", "+0100"},
            {"GMT", "GMT"},
            {"GST", "+1000"},
            {"HDT", "-0900"},
            {"HST", "-1000"},
            {"IDLE", "+1200"},
            {"IDLW", "-1200"},
            {"IST", "+0530"},
            {"IT", "+0330"},
            {"JST", "+0900"},
            {"JT", "+0700"},
            {"MDT", "-0600"},
            {"MED", "+0200"},
            {"MET", "+0100"},
            {"MEST", "+0200"},
            {"MEWT", "+0100"},
            {"MST", "-0700"},
            {"MT", "+0800"},
            {"NDT", "-0230"},
            {"NFT", "-0330"},
            {"NT", "-1100"},
            {"NST", "+0630"},
            {"NZ", "+1100"},
            {"NZST", "+1200"},
            {"NZDT", "+1300"},
            {"NZT", "+1200"},
            {"PDT", "-0700"},
            {"PST", "-0800"},
            {"ROK", "+0900"},
            {"SAD", "+1000"},
            {"SAST", "+0900"},
            {"SAT", "+0900"},
            {"SDT", "+1000"},
            {"SST", "+0200"},
            {"SWT", "+0100"},
            {"USZ3", "+0400"},
            {"USZ4", "+0500"},
            {"USZ5", "+0600"},
            {"USZ6", "+0700"},
            {"UT", "-0000"},
            {"UTC", "-0000"},
            {"UZ10", "+1100"},
            {"WAT", "-0100"},
            {"WET", "-0000"},
            {"WST", "+0800"},
            {"YDT", "-0800"},
            {"YST", "-0900"},
            {"ZP4", "+0400"},
            {"ZP5", "+0500"},
            {"ZP6", "+0600"}
        }; 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-28T03:18:23.700

我有两个答案，因为我不确定你在问什么。

1）我看到您正在使用 CultureInfo，因此，如果您只想将日期和时间**格式化** 为特定于文化的格式，我会将日期/时间和时区分开，在日期/时间上应用文化方法并附加时区。如果“CEST”对于不同的文化是不同的，你将不得不通过列出所有的选项来改变它（也许在一个案例陈述中）。

2) 如果您想将日期/时间转换为另一个时区，则不能使用 CultureInfo，

我建议阅读：http: [**//msdn.microsoft.com/en-us/library/ms973825.aspx**](http://msdn.microsoft.com/en-us/library/ms973825.aspx)

您还可以使用 .net framework 3.5 类 TimeZoneInfo（不同于 TimeZone）让您的生活更轻松。

[http://msdn.microsoft.com/en-us/library/system.timezoneinfo.aspx](http://msdn.microsoft.com/en-us/library/system.timezoneinfo.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-03-13T09:26:05.683

这是如何：

1.  获取字符串（前提条件：格式：ddd，dd MMM yyyy HH:mm:ss zzz）
2.  获取最后一个空格
3.  从字符串中删除 zzz，但保存 zzz 的值
4.  zzz 的查找偏移量
5.  将偏移量添加到字符串

> ```
> string dateString = reader.ReadContentAsString();
> int timeZonePos = dateString.LastIndexOf(' ') + 1;
> string tz = dateString.Substring(timeZonePos);
> dateString = dateString.Substring(0, dateString.Length - tz.Length );
> dateString += s_timeZoneOffsets[tz];
> 
> // https://msdn.microsoft.com/en-us/library/w2sa9yss(v=vs.110).aspx
> //string es = reader.ReadElementString("pubDate");
> this.m_value = System.DateTime.ParseExact(dateString, "ddd, dd MMM yyyy HH:mm zzz", System.Globalization.CultureInfo.InvariantCulture); 
> ```

和

```
private static System.Collections.Generic.Dictionary<string, string> s_timeZoneOffsets =
    new System.Collections.Generic.Dictionary<string, string>() {
    {"ACDT", "+10:30"},
    {"ACST", "+09:30"},
    {"ADT", "-03:00"},
    {"AEDT", "+11:00"},
    {"AEST", "+10:00"},
    {"AHDT", "-09:00"},
    {"AHST", "-10:00"},
    {"AST", "-04:00"},
    {"AT", "-02:00"},
    {"AWDT", "+09:00"},
    {"AWST", "+08:00"},
    {"BAT", "+03:00"},
    {"BDST", "+02:00"},
    {"BET", "-11:00"},
    {"BST", "-03:00"},
    {"BT", "+03:00"},
    {"BZT2", "-03:00"},
    {"CADT", "+10:30"},
    {"CAST", "+09:30"},
    {"CAT", "-10:00"},
    {"CCT", "+08:00"},
    {"CDT", "-05:00"},
    {"CED", "+02:00"},
    {"CET", "+01:00"},
    {"CEST", "+02:00"},
    {"CST", "-06:00"},
    {"EAST", "+10:00"},
    {"EDT", "-04:00"},
    {"EED", "+03:00"},
    {"EET", "+02:00"},
    {"EEST", "+03:00"},
    {"EST", "-05:00"},
    {"FST", "+02:00"},
    {"FWT", "+01:00"},
    {"GMT", "+00:00"},
    {"GST", "+10:00"},
    {"HDT", "-09:00"},
    {"HST", "-10:00"},
    {"IDLE", "+12:00"},
    {"IDLW", "-12:00"},
    {"IST", "+05:30"},
    {"IT", "+03:30"},
    {"JST", "+09:00"},
    {"JT", "+07:00"},
    {"MDT", "-06:00"},
    {"MED", "+02:00"},
    {"MET", "+01:00"},
    {"MEST", "+02:00"},
    {"MEWT", "+01:00"},
    {"MST", "-07:00"},
    {"MT", "+08:00"},
    {"NDT", "-02:30"},
    {"NFT", "-03:30"},
    {"NT", "-11:00"},
    {"NST", "+06:30"},
    {"NZ", "+11:00"},
    {"NZST", "+12:00"},
    {"NZDT", "+13:00"},
    {"NZT", "+12:00"},
    {"PDT", "-07:00"},
    {"PST", "-08:00"},
    {"ROK", "+09:00"},
    {"SAD", "+10:00"},
    {"SAST", "+09:00"},
    {"SAT", "+09:00"},
    {"SDT", "+10:00"},
    {"SST", "+02:00"},
    {"SWT", "+01:00"},
    {"USZ3", "+04:00"},
    {"USZ4", "+05:00"},
    {"USZ5", "+06:00"},
    {"USZ6", "+07:00"},
    {"UT", "-00:00"},
    {"UTC", "-00:00"},
    {"UZ10", "+11:00"},
    {"WAT", "-01:00"},
    {"WET", "-00:00"},
    {"WST", "+08:00"},
    {"YDT", "-08:00"},
    {"YST", "-09:00"},
    {"ZP4", "+04:00"},
    {"ZP5", "+05:00"},
    {"ZP6", "+06:00"}
}; 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2011-10-05T13:44:16.750

这是我必须做的。

我从 javascript 接收日期时间，然后将其传递给 ASP.NET 以存储在 Oracle 数据库中。这是我的东部和中部时代的 C# 代码。

```
string datetimevalue = hidfileDateTime.Value; 

datetimevalue= datetimevalue.Replace("EDT", "EST"); 
datetimevalue = datetimevalue.Replace("CDT", "CST");
if (datetimevalue.Contains("CST"))
{
    filedt = DateTime.ParseExact(datetimevalue, "ddd MMM d HH:mm:ss CST yyyy", provider).ToUniversalTime().AddHours(1).ToLocalTime();
}
else
{
    filedt = DateTime.ParseExact(datetimevalue, "ddd MMM d HH:mm:ss EST yyyy", provider);
} 
```

# c# - 访问用户/站点设置的最佳方式

> ID：241790
> 
> 赞同：1
> 
> 时间：2008-10-28T00:06:30.780
> 
> 标签：c#, asp.net, settings

有几个问题可以解决这个问题，但没有涵盖我的确切问题，所以我们开始吧。

对于站点设置，如果这些存储在数据库中，您是否：

1.  每次有人提出请求时从数据库中检索它们
2.  登录时将它们存储在会话变量中
3.  ？？？？？？

对于用户特定的设置，我是否与站点设置一样？

任何指导/最佳实践将不胜感激。

干杯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T00:22:49.933

我建议创建一个模块来检索可以以任何一种方式实现的首选项，然后对于您的第一个实现，每次都访问数据库，因为这样更容易。如果您有性能问题，请向模块添加缓存以减少数据库流量。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T01:15:15.743

我更喜欢 Glomek 建议的方法……在 WebCache 中缓存设置将大大提高访问速度。考虑以下：

```
 #region Data Access

private string GetSettingsFromDb(string settingName)
{
    return "";
}
private Dictionary<string,string> GetSettingsFromDb()
{
    return new Dictionary<string, string>();
}

#endregion

private const string KEY_SETTING1 = "Setting1";
public string Setting1
{
    get
    {
        if (Cache.Get(KEY_SETTING1) != null)
            return Cache.Get(KEY_SETTING1).ToString();

        Setting1 = GetSettingsFromDb(KEY_SETTING1);

        return Setting1;

    } 
    set
    {
        Cache.Remove(KEY_SETTING1);
        Cache.Insert(KEY_SETTING1, value, null, Cache.NoAbsoluteExpiration, TimeSpan.FromHours(2));
    }
}

private Cache Cache { get { return HttpContext.Current.Cache; } } 
```

您将获得动态加载的好处，在 2 小时不使用后将项目从缓存中扔出的内存保护，以及修改设置时需要的刷新和重新加载。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T00:21:17.973

通常我会将站点设置放在 web.config 文件中，除非您正在构建一个具有多个站点并且经常被应用程序本身更改的应用程序，否则通常将其放在数据库中通常没有意义。

对于用户特定的设置，我会考虑从默认的 asp.net 配置文件提供程序开始，它将设置存储在数据库中并管理每个请求一次用户设置的检索并将更新保存到最后以最小化数据库调用的数量. 一旦您开始遇到性能问题，您可以考虑扩展配置文件提供程序以用于缓存和/或您的特定需求。

# java - Java：Java 6 何时准备好用于最终用户桌面应用程序？

> ID：241813
> 
> 赞同：4
> 
> 时间：2008-10-28T00:15:48.170
> 
> 标签：java, swing, macos, java-6

我正在编写一个使用 Java 1.5 开发的 Swing 桌面应用程序。有些用户似乎在使用 Mac，但我对 Java 6 的脚本功能很感兴趣（Java 6 附带 Rhino）。Java 6 虽然在 2 年前就问世了，但似乎并没有被广泛使用。我还听说[Apple 仅为 Intel 64 Mac 提供 Java 6](https://stackoverflow.com/questions/230253/java-16-sdk-on-mac-os-105)。[Java 1.5 是最后一个无处不在的 Java 吗？](http://refactorama.blogspot.com/2008/05/java-6-compile-once-run-nowhere.html)

Java 6 现在是否已准备好用于最终用户桌面应用程序？如果不是现在，那是什么时候？

**编辑**：不要太拘泥于我正在使用 Swing 的事实。我想知道什么时候可以认为 Java 6 已准备好迎接黄金时间，而不是 UI 库的选择。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-28T00:48:10.633

据我所知，它已经是，而且已经有一段时间了。Swing 非常适合编写具有原生外观的应用程序。

但确实，如果您的目标是较旧的 Mac，您将永远无法使用 Java 6。

您是在询问 Java 6 Update 10（AKA，面向消费者的 JRE）吗？刚刚出来，还不能用于 Mac，但我认为这不会影响你，真的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T00:18:08.463

Java 6 尚未正式推出适用于所有 Mac。如果您想被更广泛地接受，请选择 1.5 (5)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T02:16:42.327

Mac 上 1.6 的可用性速度是 Apple 的问题（这与政治有关，而不是“准备”）。如果需要嵌入在 JVM 中的脚本支持，则您必须等待在 Mac 上获得该支持。或者你可以用你的发行版加载 Rhino 库并使用它......这是参考实现 - 我不确定它们需要多少 JRE 1.6 才能运行（如果不是，可能不需要太多） - [https：/ /scripting.dev.java.net/ 一定](https://scripting.dev.java.net/) 会喜欢 JCP :-)

请注意，虽然 Rhino 附带 Sun 的 JRE 1.6 实现，但它不是 JRE 标准的一部分，因此 Apple 很可能不会选择将它包含在他们的发行版中。

如果这是1.6 中*唯一*让您退缩的东西，请不要让它。Java 已经为桌面做好了充分的准备，我们有几条产品线是 Swing 应用程序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-16T12:55:38.503

正如最佳答案所说，Apple 的 Java 6 版本自 2008 年 4 月 29 日起可用于 Mac OS X 10.5。（可以在[此处](http://www.apple.com/downloads/macosx/apple/application_updates/javaformacosx105update1.html)下载。）

不幸的是，Rhino 不是该软件包的一部分。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-10-28T11:41:04.760

Java 1.6 非常适合桌面。我不知道苹果的问题是什么。我只是不再支持 Mac，直到 Apple 能够齐心协力。

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2008-10-28T00:44:08.113

据我所知，大多数真正成功的 Java 桌面应用程序都没有使用 Swing。它变得更快了，但大多数人希望他们的窗口“看起来很原生”，而 Swing 就是不擅长这一点。如果您想要一个真正“专业”的最终用户应用程序，您可能想看看[Eclipse Runtime](http://www.eclipse.org/rt/)。Eclipse 应用程序和 Azureus 使用它来为用户呈现原生外观窗口。

当然，很难找到关于如何为 Eclipse Runtime 编写的优秀教程，至少与用于编写 Swing 应用程序的优秀示例代码、书籍和教程相比是这样。

Java 6 已经推出将近两年了……它对于开发来说已经足够稳定了，尽管出于某种原因，正如其他海报所指出的那样，Mac 版本还没有出现。

# xml - XML 最佳实践：属性与附加元素

> ID：241819
> 
> 赞同：78
> 
> 时间：2008-10-28T00:20:11.610
> 
> 标签：xml

两者之间有什么区别以及我应该何时使用它们：

```
<person>
     <firstname>Joe</firstname>
     <lastname>Plumber</lastname>
</person> 
```

相对

```
<person firstname="Joe" lastname="Plumber" /> 
```

谢谢

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2008-10-28T00:33:56.793

有以元素为中心和以属性为中心的 XML，在您的示例中，第一个是以元素为中心的，第二个是以属性为中心的。

大多数时候，这两种模式是等价的，但也有一些例外。

**以属性为中心**

*   比以元素为中心的尺寸更小。
*   互操作性不强，因为大多数 XML 解析器会认为用户数据是由元素呈现的，因此使用属性来描述元素。
*   无法为某些数据类型呈现可为空的值。例如可为空的 int
*   不能表达复杂类型。

**以元素为中心**

*   复杂类型只能呈现为元素节点。
*   非常具有互操作性
*   比以属性为中心的大小更大。（压缩可用于显着减小大小。）
*   可空数据可以用属性 xsi:nil="true" 表示
*   由于解析器只查找用户数据的元素，因此解析速度更快。

**实际的**

如果您真的关心 XML 的大小，请尽可能使用属性（如果合适的话）。在需要可为空、复杂类型或保存大文本值的地方使用元素。如果您不关心 XML 的大小，或者您在传输过程中启用了压缩，请坚持使用元素，因为它们更具可扩展性。

**背景**

在 DOT NET 中，XmlSerializer 可以将对象的属性序列化为属性或元素。在最近的 WCF 框架中，DataContract 序列化器只能将属性序列化为元素，比 XmlSerializer 快；原因很明显，它只需要在反序列化时从元素中查找用户数据。

这里有一篇文章也解释了它 [元素与属性](http://www.ibm.com/developerworks/xml/library/x-eleatt.html)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-28T00:28:21.780

将来某个时候，当您添加一个`<address>`属性时，您不希望将其设为 XML 属性。这是因为 an`<address>`可能是由街道地址、城市、国家等组成的更复杂的元素。

出于这个原因，您可能希望选择第一个子元素形式，除非您确实确定该属性不需要更深入。第一种形式允许将来有更大的可扩展性。

如果您完全关心空间，请压缩您的 XML。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-28T00:25:51.270

在我的公司，我们倾向于第二种方法。

我们认为“firstname”和“lastname”是“person”节点的*属性*，而不是“person”节点的*子字段*。这是一个微妙的区别。

在我看来，第二种方法更简洁，可读性/可维护性显着提高，这非常重要。

当然，这取决于您的应用程序。我认为没有涵盖所有情况的一揽子规则。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2015-06-20T08:29:44.027

我发现以下信息非常有助于简短地解释属性与元素的选择

使用属性的一些问题是：

属性不能包含多个值（元素可以）
属性不能包含树结构（元素可以）
属性不容易扩展（以备将来更改）

属性难以阅读和维护。使用数据元素。对与数据不相关的信息使用属性。

来源：[http ://www.w3schools.com/xml/xml_attributes.asp](http://www.w3schools.com/xml/xml_attributes.asp)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-28T00:26:03.563

属性不区分顺序。根据您的情况，这可能是优势或劣势。

属性不能重复。如果“Joe”有两个名字，那么节点是唯一的方法。

# .net - 面向 VB6 程序员的 VB.NET 中的 VB 运行时函数

> ID：241822
> 
> 赞同：6
> 
> 时间：2008-10-28T00:22:13.120
> 
> 标签：.net, vb.net, vb6

我正在准备一个关于 Visual Basic 2005 的课程，目标是迁移到 .NET 平台的 Visual Basic 6 程序员。

我主要关心的是教我的学生在 .NET 中开发的最佳实践，我想知道是否考虑使用 VB 运行时函数 VB.NET 合法与否。

我已经读过 VB.NET 中的许多 VB 函数实际上调用了 .NET Framework 上的方法，因此它们的存在似乎主要是为了简化从早期版本的 Visual Basic 到 VB.NET 的转换。但是，[VB.NET 团队](http://blogs.msdn.com/vbteam/)似乎建议尽可能使用它们，因为他们声称他们在 .NET 框架 API 之上进行了一些优化。

你对此有何看法？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-28T01:05:37.540

在我所处的位置，我必须经常在 C# 和 VB.Net 之间来回移动。考虑到这一点，我们真的不喜欢旧的 VB 函数，尤其是字符串函数： `Trim(), Replace(), Len(), UCase()`等。它们在 .Net 程序中看起来很奇怪，我不想在我必须处理的代码中看到它们.

唯一的例外可能是`Len()`，如果您使用`of`动词在脑海中阅读代码。在这种情况下，阅读`Len(theString)`as`length of theString`似乎是有道理的。在其他情况下，它更多是由字符串执行的操作，所以我想看看 . （点）符号。

另一方面，我很难摆脱转换运算符：`CStr, CInt, CDbl`等。

我不能告诉你为什么我喜欢一种而不喜欢另一种；可能只是我发现 Convert.To___() 过于冗长，或者可能与它们是*运算符*而不是函数有关。

**编辑**
这一点在我的帖子的其余部分有点迷失了，所以我想再次强调一下：

在很多地方，VB.Net 与 C# 共存。我认为您看到的仅限 VB.Net 的商店不像 C# 那样多。它只是没有那么流行，许多 VB.Net 商店迁移到 VB.Net 只是作为一种过渡状态，而程序员也学习 C#。 *在这些混合环境中，如果在新代码中严格禁止旧的 VB 函数，那就很有意义了。* 你永远不知道什么时候需要移动一个模块，并且必须能够同时理解两种风格有一些共同的开销。因此，不理解两者确实是一个坏主意。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-28T00:34:24.403

好吧，我想你必须从表面上看。我主要是一名 C# 程序员，但过去 6-8 周一直在开发 VB.NET Web 应用程序。

我的裤子估计表明，使用 CInt、CDate 等转换函数与使用 Convert.Toxxx 方法一样快。

我的建议是：如果它更容易，并且没有性能损失，那就去吧！我也会教他们 .NET 方法，让用户自己决定。

顺便说一句，作为一个 C# 人，我喜欢 Cxxx 例程的简单性。仅仅因为它们仅在 VB.NET 中可用并不意味着您不应该使用它们（恕我直言）。课程用马等等。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-03T19:13:23.547

VB6 程序员在迁移到 VB.NET 时已经有很多东西需要学习。为什么不先让他们使用 VB 功能，而是教他们 .NET 框架版本。稍后他们可以切换到 .NET 框架功能，特别是如果他们也可能需要使用 C#。

编辑（很久以后）：两位著名的 VB 大师持相反的观点！

*   Francesco Balena（在他的畅销书[Programming Microsoft Visual Basic 2005: The Language](https://rads.stackoverflow.com/amzn/click/com/0735621837)中）建议前 VB6 开发人员在对新语言感到满意时立即学习 .NET 语法，并尽可能避免在 Microsoft.VisualBasic 命名空间中使用方法和类 [页。100]。他的观点是，一般来说，原生 .NET 方法提供了更好的灵活性，学习它们是一种投资，以防您以后需要使用 C# 或其他 .NET 语言。
*   Dan Appleman（在*他*广受欢迎的《[迁移到 VB.NET：策略、概念和代码》](https://rads.stackoverflow.com/amzn/click/com/1893115976)一书中）建议您随意坚持使用本机 Microsoft.VisualBasic 命名空间，避免仅使用 Microsoft.VisualBasic.Compatibility.VB6 命名空间中的那些 [p. 265]。他的观点是 Microsoft.VisualBasic 是 .NET 框架的核心部分。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-28T16:21:43.183

如果您想教授可以在语言之间来回移动的 .Net 框架最佳实践，我建议您删除 Microsoft.VisualBasic 的全局导入。这实际上迫使您执行 Microsoft.VisualBasic.Trim() 等。而不仅仅是“Trim()”。

如果我没记错的话，在 Visual Studio 2008 中，您现在可以一起删除 vb.net 中“纯”.Net 模式的引用，这样可以更轻松地在语言之间来回移动。

如果您只是在教 vb.net 人，就像上面提到的海报一样，请使用它们，因为它们可用并且需要更少的输入。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-04T13:04:40.203

如果您同时提到框架方法和 VB.NET 函数，您可能应该提到的一件事是，尽管它们有时感觉它们是相同的，但它们实际上可以做一些微妙的不同的事情。

例如，字符串的等号运算符将空字符串视为与 String.Empty 相同（有关忘记时会发生什么的示例，请参阅[性能的实际成本！）](http://www.codinghorror.com/blog/archives/000181.html "编码恐怖：真正的性能成本")

此外，VB.NET 函数通常为执行相关操作提供了很好的默认设置，但是在您需要更多控制的情况下，通常需要返回到框架方法 - 例如，如果您需要[创建字符串在不同的文化中转换](http://msdn.microsoft.com/en-us/library/ms235309.aspx "文化如何影响 Visual Basic 中的字符串")。

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2008-10-28T00:31:57.187

如果您正在教授 VB，那么这些函数就是 VB 的一部分。如果您正在教授 .Net 框架，那么这些功能不是框架的一部分。如果您正在尝试完成工作并且您有可用的工具，请使用您的工具。

# c - 你如何去编译一个修改版的 FreeBSD？

> ID：241825
> 
> 赞同：2
> 
> 时间：2008-10-28T00:24:05.457
> 
> 标签：c, tcp, freebsd

我正在大学从事一个分配的小组项目，我们必须重新实现 TCP/IP 堆栈以支持一些额外的东西（[http://discolab.rutgers.edu/mtcp/](http://discolab.rutgers.edu/mtcp/)），然后进行演示。

我们正在研究的论文/设计说，最初的研究人员更改了 FreeBSD 的源代码以支持额外的比特和 bobs。

我们已经有了一个 FreeBSD 版本，并且已经开始进行我们想要的更改，但是无法弄清楚如何 1) 编译整个 FreeBSD 源代码，以便我们可以通过安装无数版本的稍微修改过的 FreeBSD 来测试事物或 2) 编译只是我们的更改，并以某种方式将其链接到已经编译和工作的 FreeBSD 版本作为补丁或 API 或其他东西。

任何指针都会很棒！干杯，乔恩

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-28T00:34:48.787

[FreeBSD 手册](http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/)包含关于[构建和安装自定义内核](http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/kernelconfig-building.html)的部分。该手册对许多 FreeBSD 管理任务有很好的指导。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-12T16:37:32.350

为什么要通过简单的负载平衡解决方案这样做？TCP/IP 的目标是通过网络在两台机器之间可靠地处理数据。还有其他抽象层更有能力处理服务器拥塞问题，不需要对基本互联网协议进行重大更改。甚至不要让我开始在您没有明确控制的网络上（例如通过互联网）路由此类数据包的麻烦。

# performance - 什么是分析 Web 用户连接速度的好方法？

> ID：241830
> 
> 赞同：2
> 
> 时间：2008-10-28T00:26:32.127
> 
> 标签：performance, bandwidth

我有一个客户，其所需的 Web UI 图形密集；我们想收集有关连接到该站点的平均带宽的统计数据。有没有简单的方法可以做到这一点？“可能工作的最简单的事情”似乎是一个 Flash 或 Silverlight 组件，它对下载某个大小（比如 200K）的文件进行计时，然后将结果发布到保存数据的 URI。那会奏效吗？我应该自己写还是有一个简单的插入元素可以从某个地方下载？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-28T00:38:46.627

我会看看谷歌分析。这是您在页面中包含的一个简单的 javascript，它使用 Google 的海量分析数据库来跟踪谁通过何种连接访问您的网站，所有这些都在他们维护的数据库中。

您当然可以编写 Flash 或 Silverlight（或 javascript）组件来在后台下载文件、计时并报告，但您可能会因为填满他们的管道而激怒用户。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T00:48:50.040

没有太多工具可以做到这一点。

您可以尝试 BrowserHawk ( [http://www.cyscape.com/products/bhawk/features.aspx](http://www.cyscape.com/products/bhawk/features.aspx) )。请参阅[http://www.cyscape.com/showbrow.aspx?bhcp=1](http://www.cyscape.com/showbrow.aspx?bhcp=1)并向下滚动到连接详细信息。

可能最有效的方法是让访问者决定。您可以有一个带有两个大按钮的登录页面，上面写着“快速连接”和“慢速连接”，然后让他们单击一个。

请记住，如果您这样做，您将在该页面失去一定数量的访问者，因为他们太懒或没有兴趣来打扰点击。您可能只想使用网站的重型版本，并在导航中的某处有一个按钮，让他们来回切换。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T00:54:56.017

这对我来说似乎很容易。

1.  获取您的网络服务器日志并扫描您的索引页面以及从该索引页面链接的所有图像。
2.  获取最后一个图像完整时间戳和索引完整时间戳之间的差异。
3.  总计所有已完全加载的图像的大小（未缓存的 if-modified-since 304s）。
4.  将该总数除以时差。

您应该为该用户提供每秒有效字节数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T00:57:20.567

Apache 网络服务器可以记录一个请求需要多长时间（以秒为单位）；将此与 mod_logio 之类的内容结合起来，以告诉您实际发送给客户端的数据量并确定 KB/秒。

[http://httpd.apache.org/docs/2.0/mod/mod_logio.html](http://httpd.apache.org/docs/2.0/mod/mod_logio.html)

[http://httpd.apache.org/docs/2.0/mod/mod_log_config.html](http://httpd.apache.org/docs/2.0/mod/mod_log_config.html) - 寻找 '%...T'

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-07-26T16:27:03.153

谷歌从 2011 年开始停止记录用户的连接速度。这是谷歌在 2011 年 3 月 23 日发布的博客文章 -

[https://analytics.googleblog.com/2011/03/fond-farewell-to-connection-speed.html](https://analytics.googleblog.com/2011/03/fond-farewell-to-connection-speed.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-07-26T16:54:36.943

不是直接的答案 - 但您可能正在解决错误的问题。

根据您收听的人，大约 60% 的网站用户在移动设备上浏览。移动设备具有高度不可预测的带宽——从在快速 WiFi 网络上的“无限”到远离手机信号塔时的“1990 年代拨号”。如果他们将 50% 的时间花在 100Mbps 的企业 wifi 上，而将一半的时间花在 500Kbps 的蜂窝网络上，那么在 50% 的时间里，平均值将不能很好地反映他们的体验。

如果您查看平均值并说“嘿，平均值远远超过 10Mbps，所以我们可以假设 1Mbps 是一个安全的最小值”，您的用户将有一半的时间体验很糟糕。

此外，文件大小、Web 浏览器的并发下载数量以及最终用户的主观体验之间存在复杂的相互作用。如果你有一个总共需要 5000Kb 下载的网页，并且在页面完全下载之前它不会渲染任何东西，那么它会感觉超级慢。如果您逐步加载项目，并在用户滚动时延迟加载，那么网站会感觉很快。

接下来，您将获得浏览器缓存——如果您有一个庞大的网站，但您可以在浏览器中缓存大量资产，那么主观体验会非常好（在第一次下载之后）。

我的建议是商定您的站点将支持的最低带宽以及合理的经验 - 并基于您目标市场的移动网络性能。在移动覆盖良好的国家，我假设为 500Kbps；在拥有广泛 4G 的国家/地区，我会达到 1Mbps。

# content-management-system - MySource 矩阵 - 意见

> ID：241838
> 
> 赞同：2
> 
> 时间：2008-10-28T00:29:10.030
> 
> 标签：content-management-system, matrix, mysource

有没有人有使用 MySource Matrix 作为内容管理系统的经验？如果是这样，想法/意见/评论？

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T21:07:45.787

绝对优秀。很快就可以习惯它的资产结构如何做事，但它确实非常灵活和强大。简单的编辑界面也很棒。

确保给它足够的硬件。如果你想要动态内容而不需要缓存，你需要大量的咕噜声才能让它嗡嗡作响。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-23T21:19:02.333

放下我用过的最好的 CMS。我们在[太平洋联合学院](http://www.puc.edu)网站以及许多附带项目中使用它。与其他非免费产品相比，我仍然对它所提供的一切感到惊讶。

好好看看，花一些时间来克服学习曲线，但是一旦你这样做了，这将是非常值得的。:)

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-09-24T00:23:35.147

我最近一直在尝试在许多非高级用户正在生成内容的组织中使用它。- 它有许多界面错误和奇怪的行为，因此许多简单的任务（即加载图像）通常必须由高级用户（即我）完成。

当您编辑页面内容的 HTML 时，不会保留空白。如果您在 WYSIWYG 编辑器中格式化 HTML，保存更改，然后返回您添加的空白将被删除 - 实际上，当您将 WYSIWYG 编辑器切换到 HTML 模式时，它不会向您显示确切的 HTML，并做了一些愚蠢的事情——比如按回车键会插入不间断的空格——但在你保存并重新进入 HTML 模式之前不会显示它们。

正是这样的一些小细节，使得这里的每个人都很难使用和不喜欢。

# database - 如何判断应用程序使用了多少主内存

> ID：241839
> 
> 赞同：0
> 
> 时间：2008-10-28T00:29:50.763
> 
> 标签：database, memory, footprint

我需要选择一个使用最少主内存的数据库管理系统 (DBMS)，因为我们受到严格限制。由于 DBMS 将使用越来越多的内存来保存主内存中的索引，我如何准确判断哪个 DBMS 具有最小的内存占用？

现在我只打开了一个内存监视器程序，同时执行一系列我们将调用 X 的查询。然后我在不同的 DBMS 上运行同一组查询 X 并查看其生命周期中使用了多少内存并与其他内存占用。

这是一种不愚蠢的方式吗？有没有更好的办法？

谢谢，杰布

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T10:33:11.967

只需使用 SQLite。在一个单一的过程中。最好使用 C++。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T01:36:23.093

您可以在应用程序中做的是管理获取数据的方式。如果您从给定查询中获取所有行，它可能会尝试`Collection`在您的应用程序中构建一个，如果您不小心，它会很快消耗内存。这可能是内存耗尽的最可能原因。

要解决此问题，请打开查询游标并一一获取行，在遍历结果集时丢弃行对象。这样您一次只存储一行，并且可以更轻松地预测“高水位线”。

根据 JDBC 驱动程序（即您要连接的数据库品牌），说服 JDBC 驱动程序*不要*执行 fetchall 可能会很棘手。例如，一些驱动程序获取整个结果集以允许您向后和向前滚动它。尽管 JDBC 是一个标准接口，但将其配置为一次执行一行而不是 fetchall 可能涉及专有选项。

在数据库服务器端，您应该能够管理它分配给索引缓存等的内存量，但是您可以配置的具体内容在每个品牌的数据库中是不同的。没有捷径可以自学如何调整每台服务器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T00:35:51.483

最终，这种优化可能回答了错误的问题。

您通过此类测试收集的答案很可能会产生误导，因为 DBMS 在“实时”环境下的反应与您在测试期间的反应不同。此外，您将自己锁定在特定的架构中。一旦您编写了针对它的代码，就很难在以后更改 DBMS。您最好找到哪个 DBMS 将满足您的需求并简化您的开发过程，然后确保您正在优化您的 SQL 查询和索引以满足您的应用程序的需求。

# iphone - 在 Cocoa 中解析 NSXMLElement

> ID：241857
> 
> 赞同：2
> 
> 时间：2008-10-28T00:37:59.093
> 
> 标签：iphone, objective-c, xml, cocoa, xpath

我正在尝试使用 XPath 来解析 XML 文档。假设地说，我的 NSXMLElement 之一如下所示：

```
<foo bar="yummy"> 
```

我正在尝试获取属性 bar 的值，但是我使用的任何代码解释都会返回 bar="woo"，这意味着我需要进行进一步的字符串处理才能单独访问 woo 和 woo。

本质上我正在做类似的事情

```
NSArray *nodes = [xmlDoc nodesForXPath:@"foo/@bar" error:&error];
xmlElement = [nodes objectAtIndex:0]; 
```

无论如何编写上面的代码只是为了给我好吃，而不是 bar="yummy" 这样我就可以不用解析字符串了？

谢谢。

* * *

假设正在使用 TouchXML，是否仍然可以获得类似的结果？就像只获取属性的值，没有属性 =“值”？这导致随后必须进一步解析字符串以获取值。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T03:59:32.277

TouchXML API 应该是 Apple 的 NSXML 实现的完全相同的副本，因此它应该是相同的，除非您将所有 NS-Method 替换为 C-Methods。

> TouxhXML 类直接映射到 NSXML 类。**NSXMLNode -> CXMLNode**，**NSXMLDocument -> CXMLDocument**，**NSXMLElement -> CXMLElement**。由于显而易见的原因，您不能混合和匹配 NSXML 和 TouchXML 类。
> 
> TouxhXML 方法也直接映射到 NSXML 方法，但只支持一小部分方法。常量和枚举名称几乎是等价的（CXML... vs NSXML...），但常量值不等价

[参考](http://code.google.com/p/touchcode/wiki/TouchXMLImplementation)

使用常规 Apple 类或 TouchXML 框架，以下代码将为您的示例提供字符串“yummy”。

```
 NSArray *nodes = [xmlDoc nodesForXPath:@"./foo/@bar" error:&err];
 NSString *value = [[nodes objectAtIndex:0] stringValue]; 
```

祝你好运，

**布莱恩·G**

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-28T00:52:06.180

如果您尝试在 iPhone 上使用 NSXMLDocument 类，您会非常失望，因为该类（以及相关的 NSXMLNode、NSXMLElement 等类）在手机上不可用（它们在模拟器中可用，这可能会令人困惑）。

看看 libxml2 在手机上做 XML 解析。有几个免费的框架（我相信 TouchXML 是一个很好的框架）可以做到这一点。

话虽如此，如果你想在 Mac 上运行这段代码，你可以使用 NSXMLElement 方法`-attributeForName:`来提取你想要的属性。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-28T01:59:09.117

Ben 是对的——虽然 iPhone-SDK 代码将使用 NSXMLDocument 构建并在模拟器中运行，但它根本无法在设备上运行。文档可能在某处提到它，但它相当模糊。TouchXML 是 TouchCode 的一部分；[您可以在此处](http://code.google.com/p/touchcode/wiki/TouchXML)找到有关它的更多信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-19T21:49:58.740

iPhone 确实可以访问 NSXMLParser，它是一个不错的小型 sax 解析器。Aaron Hillegass 有一篇关于使用 NSXMLParser 的好文章。它不支持 XPath，但在将 xml 转换为数据对象时非常方便。

[在 Cocoa 中解析 XML](http://weblog.bignerdranch.com/?p=48)

# iphone - 使用 Cocoa/iPhoneSDK 获取 URL 的字符串内容的最快方法是什么？

> ID：241860
> 
> 赞同：3
> 
> 时间：2008-10-28T00:38:35.677
> 
> 标签：iphone, objective-c, http, url, networking

假设我想获取的 HTML

```
http://www.google.com
```

使用 Cocoa Touch 框架的一些内置类作为字符串。

我需要编写的最少代码量是多少？

我已经走了这么远，但不知道如何进步。必须有更简单的方法。

```
CFHTTPMessageRef req;
NSURL *url = [NSURL URLWithString:@"http://www.google.com"];
req = CFHTTPMessageCreateRequest(kCFAllocatorDefault,
                                 CFSTR("GET"),
                                 (CFURLRef)url,
                                 kCFHTTPVersion1_1); 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-28T00:47:28.513

*最快*的方法是使用 NSString 的`+stringWithContentsOfURL:`方法。但是，这是一个模态调用，您的应用程序在运行时将无响应。您可以将其移至后台线程，或使用 NSURLConnection 类发出正确的异步请求。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-28T04:27:53.997

一种方法如下，但是正如**Ben Gottlieb**指出的那样，这是一个同步请求，将导致您的程序执行等待此函数调用的返回，可能使您的应用程序无响应。

```
NSURL *url = [ NSURL URLWithString: @"http://www.google.com"]; 
NSURLRequest *req = [ NSURLRequest requestWithURL:url
                                      cachePolicy:NSURLRequestReloadIgnoringCacheData
                                  timeoutInterval:30.0 ];
NSError *err;
NSURLResponse *res;
NSData *d = [ NSURLConnection sendSynchronousRequest:req
                                   returningResponse:&res
                                               error:&err ]; 
```

您可以在 Apple dev-docs 上找到有关编写正确的委托方法来处理异步连接[的信息。](http://developer.apple.com/documentation/Cocoa/Conceptual/URLLoadingSystem/Tasks/UsingNSURLConnection.html#//apple_ref/doc/uid/20001836-170129)

# deployment - 如何集中整个网站引擎？

> ID：241866
> 
> 赞同：3
> 
> 时间：2008-10-28T00:41:42.907
> 
> 标签：deployment, hosting, automated-deploy, deployment-project

如果可能，更喜欢通过 php 或 ROR 响应！

**例子：**

> www.slide.com 上的幻灯片小部件可以部署在网络上的任何位置。但是幻灯片开发人员对这些小部件具有集中编辑功能。对小部件核心的更改将在所有已安装的小部件中更新。

这可以用整个网站引擎来完成吗？

> 假设我编写了 Wordpress 引擎。我是否可以将我的引擎部署在我的客户自己域中的服务器上，同时仍然能够控制/更新/编辑核心并让它更新我所有的客户引擎。

主要原因是客户对其内容和品牌拥有所有权。客户可能需要建立他的在线形象，因此他需要自己的域，但他仍然可以支付服务费用来让他的引擎得到专业的管理和维护。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T01:19:39.993

据我所知，slide.com 小部件中的 Flash 对象托管在他们的服务器上，所有部署在其他地方的都是引用小部件的标记，类似于嵌入 YouTube 视频。除非那里有我看不到的东西。

有两种方法可以做我认为你要问的事情。

1) 您可以提供在您的服务器上托管 Web 应用程序的服务。用户可以将他们的域指向您的服务器，您将在虚拟主机下运行应用程序，并授予他们对应用程序的管理员访问权限以对其进行品牌化。本质上，您将提供预安装应用程序引擎的网络托管服务。

2）您可以允许他们将其部署在他们的服务器上并提供自动更新，当应用程序文件在核心中发生更改时将下载并替换它们。但是，这将需要对存储脚本的每个文件夹进行脚本写入访问，因此会在其服务器上造成安全问题。

根据应用程序的类型，您还可以将其中的大部分部署为服务器上的服务，以及部署在与您的服务通信的客户服务器上的某种类型的基本包装器。然后，您可以集中所有业务逻辑，并将图像和模板等存储在他们的服务器上，可能还有与他们的数据库通信的脚本。

# sql-server - 我可以恢复错误存储在 varchar 字段中的国际字符吗？

> ID：241868
> 
> 赞同：5
> 
> 时间：2008-10-28T00:43:52.780
> 
> 标签：sql-server, unicode, utf-8, sql-server-2000

我的客户有一个旧的 MS SQL 2000 数据库，它使用 varchar(50) 字段来存储名称。他试图使用这个数据库来捕获一些数据（通过网络表单）。一些表单填写者来自其他国家，当这些人中的一些人输入他们的名字时，varchar 字段变得疯狂。是否有可能以某种方式恢复数据？也许通过根据它在 ASCII/varchar 中解析的内容以及该人来自的国家/地区来猜测该字符应该是什么？部分数据：

姓名/国家/地区/名字或姓氏？
JiÅ™Ã / CZE / F
Torbjörn / FIN / F
HuszÃ¡r / HUN / L
JÃ¼rgen / DEU / F
Müller / CHE / L
BumbÃ¡lkovÃ¡ / CZE / L
DoleÅ¾al / CZE / L
Loïc / DEU / L

顺便说一句，网络表单指定了这个内容类型：

```
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-28T01:17:29.747

从第 5 个示例开始工作。

Ã 是 ascii #195 (C3)。¼ 是 ascii #188 (BC)。

我猜想穆勒就是穆勒。

如果这是 UTF-8，基于 [http://en.wikipedia.org/wiki/UTF-8#Description](http://en.wikipedia.org/wiki/UTF-8#Description)

我们有 C3 BC = 1100 0011 1011 1100

应用 UTF-8 映射：

(110) 00011 (10) 11 1100

0000 0000 1111 1100

00FC 是 Unicode ü

U+00FC（见[http://en.wikipedia.org/wiki/Latin_characters_in_Unicode](http://en.wikipedia.org/wiki/Latin_characters_in_Unicode)）

在我看来，您可以以编程方式完成此工作。

现在解决第一个例子：

Jiå™ã实际上是JiÅ™Ã（最后一个字符未显示）。

无视吉，这是正确的，

C5 99 c3 广告

(110)0 0101 (10)01 1001 (110)0 0011 (10)10 1101

0159 00ED

日

所以名字是：Jiří。维基百科说特殊的 r 是捷克语，i 也是。此外，如果我用谷歌搜索 Jiří ( [http://www.google.com/search?q=Ji%C5%99%C3%AD&ie=utf-8&oe=utf-8](http://www.google.com/search?q=Ji%C5%99%C3%AD&ie=utf-8&oe=utf-8) ) 我会得到很多点击。我们在这里赢了。

第二个例子，Torbjörn，很好地映射到 Torbjörn，这听起来很有说服力。

恕我直言，不需要人工检查这些，它们似乎只是工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T01:28:55.793

俄罗斯邮局做到了。有没有人在它消失之前保存图像？

[http://forums.thedailywtf.com/forums/p/7156/133456.aspx](http://forums.thedailywtf.com/forums/p/7156/133456.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T01:15:04.727

您基本上需要通过 libiconv 戳它，将其转换为 UTF8。

适当字符集的完整列表将取决于您的应用程序，但您可以根据国家代码进行一些猜测。从[WikiPedia 上的这个页面开始](http://en.wikipedia.org/wiki/8859)。

警告：**您需要人工来验证*每次*转换。**

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T03:42:39.877

根据 Richard 的评论：如果包含表单的网页指定了字符集（例如 iso-8859-1 == unicode）和编码（例如 utf-8），那么符合标准的浏览器应该使用该字符集提交表单数据，并且编码。如果您的网页指定了 unicode，那么您不必处理数据中的随机 Microsoft 代码页 - 它应该都是 unicode。

# visual-studio - Visual Studio 源代码管理资源管理器显示错误的文件夹名称

> ID：241871
> 
> 赞同：1
> 
> 时间：2008-10-28T00:45:41.853
> 
> 标签：visual-studio

我的源代码管理资源管理器显示错误的随机名称或空名称，即在文件夹区域中我看到 TFSServer > TeamProject > 分支 > “不共享 t”，而源位置文本框具有正确的 $/TFSServer/TeamProject/Branch/FolderName。我不确定这是否与在构建机器上共享放置位置文件夹有关。有没有人经历过类似的事情或知道如何解决这个问题？

这发生在 Visual Studio 2005 和 2006 Team Edition 中。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T21:16:25.707

禁用 AVG 链接扫描程序后，该问题似乎得到解决。

# svn - SVN 关注列表？

> ID：241872
> 
> 赞同：4
> 
> 时间：2008-10-28T00:46:47.327
> 
> 标签：svn

我知道可以让 SVN 在使用钩子提交后发送电子邮件，但我只是想知道是否有任何方法可以创建像 MediaWiki (Wikipedia) 那样的个人“监视列表”，只有在有更改某些文件？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T09:45:00.220

我们处理这个问题的方式是我们有一个 watch 属性，您将您的电子邮件地址添加到任何目录中的该属性中，并且您会收到有关该目录中或下方的任何更改的电子邮件。

在幕后实现这一点的方式是，提交后脚本检查提交中的每个文件的每个目录，并在读取属性时将其返回到项目，并由此构建一个电子邮件地址列表以向其发送通知。这需要十几行 python。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T00:53:42.057

[SVN-Monitor](http://www.svnmonitor.com/default.shtml)似乎有几个监控选项，可以通过多种不同的方式进行通知。您可以过滤某些事件以触发某些类型的通知。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T00:50:02.033

我们当然可以开发出这样一个作为 Subversion 钩子运行的东西。我们在几年前工作的一个地方为 CVS 邮件设置了类似的系统。

Subversion 本身没有内置此功能，但我怀疑至少有一个插件可以做到这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-20T08:23:38.993

[http://www.svnmonitor.com](http://www.svnmonitor.com)

# unix - 从标准输入中删除第一行并重定向到标准输出

> ID：241873
> 
> 赞同：12
> 
> 时间：2008-10-28T00:46:53.427
> 
> 标签：unix, stdout, stdin

我需要将除第一行之外的程序的所有标准输出重定向到文件中。

是否有一个通用的 unix 程序可以从标准输入中删除行并将其余的输出到标准输出？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-10-28T00:51:16.773

其他人已经提到了“尾巴”。sed 也可以：

```
sed 1d 
```

和 Awk 一样：

```
awk 'NR > 1' 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-28T00:50:02.033

尾 -n +2 -f -

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T00:50:51.610

sed -e 1d <输入>输出

# java - j2me 中的全分辨率相机访问

> ID：241882
> 
> 赞同：5
> 
> 时间：2008-10-28T00:50:52.063
> 
> 标签：java, java-me, mobile, camera, mmapi

我正在尝试在高端诺基亚手机 (N95) 上进行图像捕捉。手机的内置摄像头非常好（4 兆像素），但在 j2me 中我似乎只能获得最大 1360x1020 的图像。我主要从这个例子[http://developers.sun.com/mobility/midp/articles/picture/](http://developers.sun.com/mobility/midp/articles/picture/)

我所做的是从 640x480 开始，并将宽度和高度分别增加 80 和 60，直到失败。代码行是：

jpg = mVideoControl.getSnapshot("encoding=jpeg&quality=100&width=" + width + "&height=" + height);

所以这两个问题是： 1.手机在获取大于1360x1020的图像时会抛出异常。2\. 较高分辨率的图像似乎只是较小图像的平滑版本。例如，当我拍摄一张 640x480 的图像并在 Photoshop 中将其放大时，我无法区分这与所谓的 1360x1020 之间的区别。

这是手机上j2me的限制吗？如果是这样，是否有人知道从 j2me 应用程序中获得更高分辨率的方法和/或如何从另一个应用程序中访问本机相机？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-02T14:40:34.550

诺基亚论坛上的这个[解释可能会对您有所帮助。](http://www.forum.nokia.com/document/Java_ME_Developers_Library/?content=GUID-00C29EFF-1A32-49D6-9AF4-0E5D8F1EE772.html)

它说“可以捕获的最大图像大小取决于所选的图像格式、编码选项和可用的可用堆内存。”

和

“因此强烈建议至少将较大的图像（大于 1mpix）捕获为 JPEG 图像并以通用图像尺寸（例如 1600x1200 用于 2mpix 等）。支持的通用图像尺寸取决于产品和平台版本。”

因此，我建议您尝试 1\. 使用 1600x1200、1024x768 以及您的 N95 指南中提到的任何图像分辨率 2\. 使用 BMP 和 PNG。

无论如何，根据我之前的经验（可能已经过时），j2me 实现充满了错误，因此可能没有有效的解决方案来解决您的问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-07T08:57:18.653

您的相机分辨率本机为： 2582 x 1944 。尝试在那里捕捉，看看情况如何。

这个地方：http: [//developers.sun.com/mobility/midp/articles/picture/index.html](http://developers.sun.com/mobility/midp/articles/picture/index.html)

提到使用：

```
byte[] raw = mVideoControl.getSnapshot(null);
Image image = Image.createImage(raw, 0, raw.length); 
```

使用 raw 似乎很有趣，以获得原始分辨率。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T08:48:10.633

JPEG 的“质量”（由代码解释）与分辨率无关。相反，它与图像的压缩程度有关。质量为 100 的 640x480 图像明显优于质量为 50 的 640x480 图像，但会占用更多存储空间。

试试这个：

```
jpg = mVideoControl.getSnapshot("encoding=jpeg&quality=100&width=2048&height=1536"); 
```

# c# - 复合对象上的属性网格

> ID：241887
> 
> 赞同：2
> 
> 时间：2008-10-28T00:51:54.727
> 
> 标签：c#, propertygrid

当我绑定这个对象

```
public class MyObject
{ 
  public AgeWrapper Age
{
get;
set;
}
}

public class AgeWrapper
{
public int Age
{
get;
set;
}
} 
```

对于属性网格，属性网格的 value 部分显示的是 AgeWrapper 的类名，但 AgeWrapper.Age 的值。

有没有办法让它在属性网格中显示复合对象的值（在这种情况下，它是 AgeWrapper.Age），而不是该复合对象的类名？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-28T01:14:40.970

您需要创建一个类型转换器，然后使用属性将其应用于 AgeWrapper 类。然后属性网格将使用该类型转换器来获取要显示的字符串。创建一个像这样的类型转换器......

```
public class AgeWrapperConverter : ExpandableObjectConverter
{
  public override bool CanConvertTo(ITypeDescriptorContext context, 
                                    Type destinationType)
  {
    // Can always convert to a string representation
    if (destinationType == typeof(string))
      return true;

    // Let base class do standard processing
    return base.CanConvertTo(context, destinationType);
  }

  public override object ConvertTo(ITypeDescriptorContext context, 
                                   System.Globalization.CultureInfo culture, 
                                   object value, 
                                   Type destinationType)
  {
    // Can always convert to a string representation
    if (destinationType == typeof(string))
    {
      AgeWrapper wrapper = (AgeWrapper)value;
      return "Age is " + wrapper.Age.ToString();
    }

    // Let base class attempt other conversions
    return base.ConvertTo(context, culture, value, destinationType);
  }  
} 
```

请注意，它继承自 ExpandableObjectConverter。这是因为 AgeWrapper 类有一个名为 AgeWrapper.Age 的子属性，需要通过网格中 AgeWrapper 条目旁边的 + 按钮来公开该属性。如果您的类没有您想要公开的任何子属性，则改为从 TypeConverter 继承。现在将此转换器应用于您的班级...

```
[TypeConverter(typeof(AgeWrapperConverter))]
public class AgeWrapper 
```

# python - SUDS - 以编程方式访问方法和类型

> ID：241892
> 
> 赞同：23
> 
> 时间：2008-10-28T00:52:41.187
> 
> 标签：python, suds

我正在调查 SUDS 作为 python 的 SOAP 客户端。我想检查指定服务中可用的方法，以及指定方法所需的类型。

目的是生成用户界面，允许用户选择方法，然后在动态生成的表单中填写值。

我可以获得有关特定方法的一些信息，但不确定如何解析它：

```
client = Client(url)
method = client.sd.service.methods['MyMethod'] 
```

我无法以**编程** 方式确定需要创建什么对象类型才能调用服务

```
obj = client.factory.create('?')

res = client.service.MyMethod(obj, soapheaders=authen) 
```

有人有一些示例代码吗？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-12-07T06:12:25.547

好的，所以 SUDS 确实很神奇。

A `suds.client.Client`, 是从 WSDL 文件构建的：

```
client = suds.client.Client("http://mssoapinterop.org/asmx/simple.asmx?WSDL") 
```

它下载 WSDL 并在`client.wsdl`. 当您通过使用 SUDS 调用方法时，`client.service.<method>`它实际上是在幕后针对该解释的 WSDL 执行大量递归解析魔术。要发现方法的参数和类型，您需要自省此对象。

例如：

```
for method in client.wsdl.services[0].ports[0].methods.values():
    print '%s(%s)' % (method.name, ', '.join('%s: %s' % (part.type, part.name) for part in method.soap.input.body.parts)) 
```

这应该打印如下内容：

```
echoInteger((u'int', http://www.w3.org/2001/XMLSchema): inputInteger)
echoFloatArray((u'ArrayOfFloat', http://soapinterop.org/): inputFloatArray)
echoVoid()
echoDecimal((u'decimal', http://www.w3.org/2001/XMLSchema): inputDecimal)
echoStructArray((u'ArrayOfSOAPStruct', http://soapinterop.org/xsd): inputStructArray)
echoIntegerArray((u'ArrayOfInt', http://soapinterop.org/): inputIntegerArray)
echoBase64((u'base64Binary', http://www.w3.org/2001/XMLSchema): inputBase64)
echoHexBinary((u'hexBinary', http://www.w3.org/2001/XMLSchema): inputHexBinary)
echoBoolean((u'boolean', http://www.w3.org/2001/XMLSchema): inputBoolean)
echoStringArray((u'ArrayOfString', http://soapinterop.org/): inputStringArray)
echoStruct((u'SOAPStruct', http://soapinterop.org/xsd): inputStruct)
echoDate((u'dateTime', http://www.w3.org/2001/XMLSchema): inputDate)
echoFloat((u'float', http://www.w3.org/2001/XMLSchema): inputFloat)
echoString((u'string', http://www.w3.org/2001/XMLSchema): inputString) 
```

所以部件类型元组的第一个元素可能是你所追求的：

```
>>> client.factory.create(u'ArrayOfInt')
(ArrayOfInt){
   _arrayType = ""
   _offset = ""
   _id = ""
   _href = ""
   _arrayType = ""
 } 
```

更新：

对于 Weather 服务，“参数”似乎是一个`element`not a的一部分`type`：

```
>>> client = suds.client.Client('http://www.webservicex.net/WeatherForecast.asmx?WSDL')
>>> client.wsdl.services[0].ports[0].methods.values()[0].soap.input.body.parts[0].element
(u'GetWeatherByZipCode', http://www.webservicex.net)
>>> client.factory.create(u'GetWeatherByZipCode')
(GetWeatherByZipCode){
   ZipCode = None
 } 
```

但这对方法调用的参数很神奇（a la `client.service.GetWeatherByZipCode("12345")`. IIRC，这是 SOAP RPC 绑定样式？我认为这里有足够的信息可以帮助您入门。提示：Python 命令行界面是您的朋友！

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-12-03T20:46:55.580

根据`suds` [文档](https://fedorahosted.org/suds/wiki/Documentation#BASICUSAGE)，您可以`service`使用`__str()__`. 因此，以下获取方法和复杂类型的列表：

```
from suds.client import Client;

url = 'http://www.webservicex.net/WeatherForecast.asmx?WSDL'
client = Client(url)

temp = str(client); 
```

上面的代码产生以下结果（的内容`temp`）：

```
Suds ( https://fedorahosted.org/suds/ )  version: 0.3.4 (beta)  build: R418-20081208

Service ( WeatherForecast ) tns="http://www.webservicex.net"
   Prefixes (1)
      ns0 = "http://www.webservicex.net"
   Ports (2):
      (WeatherForecastSoap)
         Methods (2):
            GetWeatherByPlaceName(xs:string PlaceName, )
            GetWeatherByZipCode(xs:string ZipCode, )
         Types (3):
            ArrayOfWeatherData
            WeatherData
            WeatherForecasts
      (WeatherForecastSoap12)
         Methods (2):
            GetWeatherByPlaceName(xs:string PlaceName, )
            GetWeatherByZipCode(xs:string ZipCode, )
         Types (3):
            ArrayOfWeatherData
            WeatherData
            WeatherForecasts 
```

这将更容易解析。还列出了每个方法及其参数及其类型。您甚至可以只使用正则表达式来提取您需要的信息。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2013-05-17T19:25:56.857

这是我根据上述信息编写的快速脚本，用于列出 WSDL 上可用的输入法 suds 报告。传入 WSDL URL。适用于我目前正在进行的项目，我不能保证它适用于你的项目。

```
import suds

def list_all(url):
    client = suds.client.Client(url)
    for service in client.wsdl.services:
        for port in service.ports:
            methods = port.methods.values()
            for method in methods:
                print(method.name)
                for part in method.soap.input.body.parts:
                    part_type = part.type
                    if(not part_type):
                        part_type = part.element[0]
                    print('  ' + str(part.name) + ': ' + str(part_type))
                    o = client.factory.create(part_type)
                    print('    ' + str(o)) 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-07-24T09:43:44.203

您可以访问 suds 的 ServiceDefinition 对象。这是一个快速示例：

```
from suds.client import Client
c = Client('http://some/wsdl/link')

types = c.sd[0].types 
```

现在，如果您想知道类型的前缀名称，也很容易：

```
c.sd[0].xlate(c.sd[0].types[0][0]) 
```

这个双括号表示法是因为类型是一个列表（因此是第一个 [0]），然后在这个列表的每个项目中可能有两个项目。但是，suds 的内部实现`__unicode__`正是这样做的（即仅采用列表中的第一项）：

```
s.append('Types (%d):' % len(self.types))
    for t in self.types:
        s.append(indent(4))
        s.append(self.xlate(t[0])) 
```

快乐编码；）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-12-23T20:01:30.083

一旦您创建了 WSDL 方法对象，您就可以从它获取有关它的信息`__metadata__`，包括它的参数名称列表。

给定参数的名称，您可以在创建的方法中访问它的实际实例。该实例还包含它的信息，在`__metadata__`那里你可以得到它的类型名称

```
# creating method object
method = client.factory.create('YourMethod')
# getting list of arguments' names
arg_names = method.__metadata__.ordering
# getting types of those arguments
types = [method.__getitem__(arg).__metadata__.sxtype.name for arg in arg_names] 
```

免责声明：这只适用于复杂的 WSDL 类型。简单类型，如字符串和数字，默认为 None

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-11-23T10:42:42.387

```
from suds.client import Client
url = 'http://localhost:1234/sami/2009/08/reporting?wsdl'
client = Client(url)
functions = [m for m in client.wsdl.services[0].ports[0].methods]
count = 0
for function_name in functions:
    print (function_name)
    count+=1
print ("\nNumber of services exposed : " ,count) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-05-13T06:07:05.980

我需要一个将泡沫与对象一起使用的示例。除了在这里找到的答案之外，我还发现了一篇非常好的[文章](https://webkul.com/blog/python-suds-client/) ，可以进一步回答我的问题。

这是一个简短的总结：

首先，打印客户端以查看其内容的概述。

```
from suds.client import Client client =
Client("https://wsvc.cdiscount.com/MarketplaceAPIService.svc?wsdl")
print client 
```

其次，创建一个类型的实例（使用它的名称，包括它的前缀 ns*.），然后打印它，以查看它的成员数据。

```
HeaderMessage = client.factory.create('ns0:HeaderMessage')
print HeaderMessage 
```

要填充对象的数据成员，可以将标量成员的标量值或 dict 分配给对象成员。

```
HeaderMessage.Context =  {
     "CatalogID": "XXXXX"
     "CustomerID": 'XXXXX'
     "SiteID": 123
 } 
```

类型名称以 ArrayOf 开头的成员需要一个类型名称其余部分中提到的类型的对象列表。

```
ArrayOfDomainRights = client.factory.create('ns0:ArrayOfDomainRights')
ArrayOfDomainRights.DomainRights = [XXXXXXXXXXXXX, XXXXXXXXXXXX] 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-05-16T20:04:55.567

我需要一个将泡沫与对象一起使用的示例。除了在这里找到的答案之外，我还发现了一篇非常好的[文章](https://webkul.com/blog/python-suds-client/) ，可以进一步回答我的问题。

这是一个简短的总结：

首先，打印客户端以查看其内容的概述。

```
from suds.client import Client client =
Client("https://wsvc.cdiscount.com/MarketplaceAPIService.svc?wsdl")
print client 
```

其次，创建一个类型的实例（使用它的名称，包括它的前缀 ns*.），然后打印它，以查看它的成员数据。

```
HeaderMessage = client.factory.create('ns0:HeaderMessage')
print HeaderMessage 
```

要填充对象的数据成员，可以将标量成员的标量值或 dict 分配给对象成员。

```
HeaderMessage.Context =  {
     "CatalogID": "XXXXX"
     "CustomerID": 'XXXXX'
     "SiteID": 123
 } 
```

类型名称以 ArrayOf 开头的成员需要一个类型名称其余部分中提到的类型的对象列表。

```
ArrayOfDomainRights = client.factory.create('ns0:ArrayOfDomainRights')
ArrayOfDomainRights.DomainRights = [XXXXXXXXXXXXX, XXXXXXXXXXXX] 
```

# php - 是什么让 PHP 的 fgets() 在大文件上变得如此可怕？

> ID：241894
> 
> 赞同：1
> 
> 时间：2008-10-28T00:52:46.410
> 
> 标签：php, fgets

是什么让它`fgets()`在大文件上变得如此可怕`fread`？

为了演示，运行以下代码：

```
<?php
$line = str_repeat('HelloWorld', 100000) . "\n";
for($i=0; $i<10000; ++$i)
    file_put_contents('myfile', $line, FILE_APPEND);
//now we have roughly a 1gig file

// We'll even let fread go first incase
// the subsequent test would have any caching benefits
$fp = fopen('myfile2','r');
$start = microtime(true);
while (fread($fp,4096));
$end = microtime(true);
print ($end-$start) . " using fread\n";
fseek($fp, 0);

$start = microtime(true);
while (fgets($fp));
$end = microtime(true);
print ($end-$start) . " using fgets\n";
?> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-28T02:36:56.483

It might have something to do with how you're calling `fgets`. From the manual, it says that if you leave the second parameter out, then:

> If no length is specified, it will keep reading from the stream until it reaches the end of the line.

If the data your working with has some very long lines (eg: "HelloWorld" 100,000 times = 1,000,000 characters), then it has to read that whole thing.

Again, from the manual:

> If the majority of the lines in the file are all larger than 8KB, it is more resource efficient for your script to specify the maximum line length.

# html - 如何使用 JSP 交替 HTML 表格行颜色？

> ID：241897
> 
> 赞同：29
> 
> 时间：2008-10-28T00:53:43.320
> 
> 标签：html, css, jsp, jstl

如何使用 JSP 替换 HTML 表格行颜色？

我的 CSS 看起来像：

```
tr.odd {background-color: #EEDDEE}
tr.even {background-color: #EEEEDD} 
```

我想用来`<c:forEach>`迭代一个集合。

```
<c:forEach items="${element}" var="myCollection">
  <tr>
    <td><c:out value="${element.field}"/></td>
    ...
  </tr>
</c:forEach> 
```

我需要一个 int 计数变量或布尔奇数/偶数变量来跟踪行。然后我的`<tr>`标签看起来像：

```
<tr class="odd or even depending on the row"> 
```

* * *

## 回答 #1

> 赞同：89
> 
> 时间：2008-10-28T01:12:51.143

在您的标签上使用该`varStatus`属性，JSTL 将在您指定的变量名称中为您`forEach`管理一个实例。[`javax.servlet.jsp.jstl.core.LoopTagStatus`](http://java.sun.com/products/jsp/jstl/1.1/docs/api/javax/servlet/jsp/jstl/core/LoopTagStatus.html)

然后，您可以使用三元运算符轻松输出适当的类名：

```
<c:forEach items="${element}" var="myCollection" varStatus="loopStatus">
  <tr class="${loopStatus.index % 2 == 0 ? 'even' : 'odd'}">
    ...
  </tr>
</c:forEach> 
```

这本来自 IBM 的[JSTL 入门](http://www.ibm.com/developerworks/java/library/j-jstl0318/)提供了有关`core`标记库及其提供给您的更多信息。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-09-29T08:32:29.970

就这样做，就可以工作了：

```
table tr:nth-child(odd) { background-color: #ccc; } 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-28T01:31:25.693

如果您愿意在客户端实现这一点，您可以使用 JQuery 进行 Zebra Striping。

只需几行代码即可完成，但您必须在文件中包含 jquery 库。

[http://docs.jquery.com/Tutorials:Zebra_Striping_Made_Easy](http://docs.jquery.com/Tutorials:Zebra_Striping_Made_Easy)

[http://docs.jquery.com/Selectors/odd](http://docs.jquery.com/Selectors/odd)

[http://docs.jquery.com/Selectors/even](http://docs.jquery.com/Selectors/even)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-28T01:50:14.517

（这个答案只适用于 CSS 方面......）

当然，我总是像这样针对儿童TD：

```
tr.odd td {}
tr.even td {} 
```

原因是 IE 实际上通过删除 TR 上设置的值并将其应用于该 TR 中的每个单独的 TD 来应用 TR 背景颜色。有时你可能有一个 css 重置或其他 css 规则覆盖 IE 的奇怪的做 TR 背景颜色的方式，所以这是一种确保你避免这种情况的方法。

此外，您可能需要考虑仅设置

```
tr td {background-color: #EEDDEE} 
```

和

```
tr.odd td {background-color: #EEEEDD} 
```

所以你的代码稍微不那么冗长

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-28T01:02:18.543

我不使用 JSP，所以我不能用你的语言给你答案，但这就是我所做的（使用伪代码）

```
counter = 0
foreach (elements)
    counter = counter + 1
    output: <tr class="row{counter % 2}">...</tr> 
```

就个人而言，我将类命名为“row0”和“row1”，这样您就可以通过简单的模数计算在它们之间进行交替，此外，如果您决定让行以三元组或四元组（而不是成对）交替，您可以轻松扩展它，并将您的输出代码更改为`row2`等。`row3``counter % 4`

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-28T01:08:15.413

在这种情况下，我使用了三级运算符。它看起来像：

```
String oddEven="";
<c:forEach items="${element}" var="myCollection">
    oddEven = (oddEven == "even") ? "odd" : "even";
    <tr class='"'+oddEven+'"'>
        <td><c:out value="${element.field}"/></td>
        ...
    </tr>
</c:forEach> 
```

# asp.net - 如何创建使用和生成 JSON 对象的 ASP.Net 2.0 Web 服务？

> ID：241899
> 
> 赞同：1
> 
> 时间：2008-10-28T00:54:02.790
> 
> 标签：asp.net, ajax, web-services, json

我想在 ASP.Net 2.0 中创建一个支持 JSON 的 Web 服务。没有 WCF 和 .Net 3.5 有没有办法做到这一点？谁能给我指出一篇好文章或示例代码？

**澄清**

我需要使用 .Net 2.0 框架将 JSON 对象传递给客户端的最佳方法的指导。是否可以在不将对象序列化为字符串然后在客户端反序列化的情况下执行此操作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-05T19:59:20.597

使用杰伊洛克！

JayRock 将与 .net 2.0 一起使用

[http://jayrock.berlios.de/](http://jayrock.berlios.de/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T01:02:10.933

WCF 很棒，但需要 .net 3.5。

查看 MSDN 上的这篇文章，该文章从介绍性级别描述了很多关于 JSON 和 asp.net 的内容。

[http://msdn.microsoft.com/en-us/library/bb299886.aspx](http://msdn.microsoft.com/en-us/library/bb299886.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-05T20:13:55.670

如果没有序列化，您无法使用标准 2.0 来做到这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T00:58:28.350

您可以将 WCF 用于您的网站，WCF JSON 端点甚至可以为服务生成 javascript 客户端代理。

看看这个帖子

[WCF 服务的 REST / SOAP 端点](https://stackoverflow.com/questions/186631/rest-soap-endpoints-for-a-wcf-service#186695)

可以找到下载示例

[http://www.codemeit.com/wcf/wcf-restful-pox-json-and-soap-coexist.html](http://www.codemeit.com/wcf/wcf-restful-pox-json-and-soap-coexist.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-28T15:08:16.903

我发现[这个用于 LINQ to JSON 的 API](http://www.codeplex.com/Json)非常有用且简单。

# .net - 64 位系统上的 NCover

> ID：241903
> 
> 赞同：5
> 
> 时间：2008-10-28T00:55:52.833
> 
> 标签：.net, 64-bit, code-coverage, ncover

您建议在 64 位环境中使用什么来进行代码覆盖。似乎 NCover 仅在 Enterprise 版本中支持 64 位，这似乎相当昂贵。或者不是吗？人们在 64 位系统上使用什么来进行 .NET 代码覆盖？

编辑：我知道 CorFlag 解决方法。我想知道其他人在做什么/使用什么。您是在使用其他东西还是在使用带有 CorFlag 技巧的 NCover（免费版）？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-28T03:58:33.120

谷歌找到了我：[http ://rabdullin.com/how-to-run-free-ncover-on-a-64-bit-machine/](http://rabdullin.com/how-to-run-free-ncover-on-a-64-bit-machine/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-11T16:38:25.147

大卫，我最近看了开源的[Part Cover](http://sourceforge.net/projects/partcover/)。它也有 64 位的问题，[解决](http://sourceforge.net/forum/forum.php?thread_id=1981722&forum_id=605221)方法也是 corflag，由 Sharp Develop 贡献者提供，他们打包并与 Part Cover 集成。

snk 文件在他们的[SVN repo](http://partcover.svn.sourceforge.net/viewvc/partcover/)中。

NCover Enterprise 值得吗？我想只有你才能真正做出这个决定。有 21 天的试用期。如果您无法证明支出的合理性，Part Cover 可以帮助您。

似乎所有 .NET 代码覆盖工具都使用打包为 COM 的 c++。除非有人可以提出托管代码实现，否则我怀疑将始终需要 64 位构建。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-11T12:10:18.777

.Net Coverage Validator 呢？它适用于所有版本的 .Net，并且适用于 32 位和 64 位版本。[http://www.softwareverify.com/dotNet/coverage/index.html](http://www.softwareverify.com/dotNet/coverage/index.html)

代码探查器的托管实现是不可能的（对于 Java 也是如此），因为探查器将自行检测。因此，所有 .Net/Java 分析器都是以您想要的任何语言编写的本机非托管代码（尽管通常是 C 或 C++）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T10:54:43.573

NCover 的 Classic 和 Complete 版本都支持 64 位。

谢谢，

乔·费瑟

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-09-09T10:02:17.740

请参阅[SD C# 测试覆盖率](http://www.semanticdesigns.com/Products/TestCoverage/CSharpTestCoverage.html)，了解可处理 32 位和 64 位 C# 版本的工具。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-09-02T16:47:30.487

我终于找到了一个不错的解决方案。[JetBrains](http://www.jetbrains.com/)的[dotCover](http://www.jetbrains.com/dotcover/)运行良好，并与[Visual Studio](http://www.microsoft.com/visualstudio/)和[ReSharper](http://www.jetbrains.com/resharper/)集成。感谢大家的回答。

# sql - 是否可以从 SQL 查询中执行文本文件？

> ID：241925
> 
> 赞同：39
> 
> 时间：2008-10-28T01:07:47.207
> 
> 标签：sql, sql-server, sql-server-2005

我有许多要连续运行的生成的 .sql 文件。我想从查询中的 SQL 语句运行它们（即查询分析器/服务器管理工​​作室）。
是否可以做这样的事情，如果可以，这样做的语法是什么？

我希望有类似的东西：

```
exec 'c:\temp\file01.sql' 
exec 'c:\temp\file02.sql' 
```

我正在使用 SQL Server 2005 并在管理工作室中运行查询。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-10-28T01:12:54.203

使用[xp_cmdshell](http://msdn.microsoft.com/en-us/library/aa260689(SQL.80).aspx)和[sqlcmd](http://msdn.microsoft.com/en-us/library/ms166559.aspx)

```
EXEC xp_cmdshell  'sqlcmd -S ' + @DBServerName + ' -d  ' + @DBName + ' -i ' + @FilePathName 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2012-08-02T10:50:11.910

非常有帮助，谢谢，另请参阅此链接： [执行 SQL Server 脚本](https://stackoverflow.com/questions/3523365/execute-sql-server-scripts?rq=1) 以获取类似示例。要打开`xp_cmdshell`和关闭，请参见下文：

在

```
SET NOCOUNT ON  
EXEC master.dbo.sp_configure 'show advanced options', 1 
RECONFIGURE 
EXEC master.dbo.sp_configure 'xp_cmdshell', 1 
RECONFIGURE 
```

离开

```
EXEC master.dbo.sp_configure 'xp_cmdshell', 0 
RECONFIGURE 
EXEC master.dbo.sp_configure 'show advanced options', 0 
RECONFIGURE  
SET NOCOUNT OFF 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2016-12-06T15:13:41.483

或者只是使用 openrowset 将您的脚本读入一个变量并执行它（抱歉恢复了一个 8 年前的话题）：

```
DECLARE @SQL varchar(MAX)
SELECT @SQL = BulkColumn
FROM OPENROWSET
    (   BULK 'MeinPfad\MeinSkript.sql'
    ,   SINGLE_BLOB ) AS MYTABLE

--PRINT @sql
EXEC (@sql) 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2011-07-07T17:35:28.980

这就是我使用的。效果很好，并且易于重复使用。可以更改为读取目录中的所有文件，但这样我可以控制要执行的文件。

```
/*  
execute a list of .sql files against the server and DB specified  
*/  
SET NOCOUNT ON  

SET XACT_ABORT ON  
BEGIN TRAN  

DECLARE @DBServerName   VARCHAR(100) = 'servername'  
DECLARE @DBName VARCHAR(100) = 'db name'  
DECLARE @FilePath   VARCHAR(200) = 'path to scrips\'  
/*

create a holder for all filenames to be executed  

*/  
DECLARE @FileList TABLE (Files NVARCHAR(MAX))  

INSERT INTO @FileList VALUES ('script 1.sql')  
INSERT INTO @FileList VALUES ('script 2.sql')  
INSERT INTO @FileList VALUES ('script X.sql')  

WHILE (SELECT COUNT(Files) FROM @FileList) > 0  
BEGIN  
   /*  
   execute each file one at a time  
   */  
   DECLARE @FileName NVARCHAR(MAX) = (SELECT TOP(1) Files FROM @FileList)  
   DECLARE @command  VARCHAR(500)  = 'sqlcmd -S ' + @DBServerName + ' -d  ' + @DBName + ' -i "' + @FilePath + @Filename +'"'  
   EXEC xp_cmdshell  @command   

   PRINT 'EXECUTED: ' + @FileName     
   DELETE FROM @FileList WHERE Files = @FileName  
END  
COMMIT TRAN 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-28T01:13:57.507

我不建议这样做，但如果你真的必须这样做，那么扩展存储过程[`xp_cmdshell`](http://msdn.microsoft.com/en-us/library/aa260689(SQL.80).aspx)就是你想要的。您必须首先将文件的内容读入变量，然后使用如下内容：

```
DECLARE @cmd sysname, @var sysname
SET @var = 'Hello world'
SET @cmd = 'echo ' + @var + ' > var_out.txt'
EXEC master..xp_cmdshell @cmd 
```

注意：xp_cmdshell 在后台运行命令，因此不能用于运行需要用户输入的程序。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-28T01:36:20.253

看看 OSQL。此实用程序允许您从命令提示符运行 SQL。它很容易安装在系统上，我认为它带有免费的 SQL Server Express。

[使用 osql 实用程序](http://msdn.microsoft.com/en-us/library/aa213090(SQL.80).aspx)

在堆栈溢出时快速搜索“OSQL”会发现有很多可用的东西。

要正确处理的主要事情是在命令行中传入的用户和密码帐户参数。我已经看到使用 NT 文件访问权限的批处理文件，通过密码控制文件，然后使用该文件的内容来启动脚本。您还可以使用 Process 类编写一个快速的 C# 或 VB 程序来运行它。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2019-09-04T18:53:58.730

对于 Windows 身份验证，如果您以其他用户身份运行：以 Windows 用户身份打开命令提示符（右键单击它，打开文件位置，Shift + 右键单击​​，以其他用户身份运行）

```
 sqlcmd -S localhost\SQLEXPRESS -d DatabaseName-i "c:\temp\script.sql" 
```

或者，如果您使用的是 Sql Server 用户：

```
sqlcmd -S localhost\SQLEXPRESS -d DatabaseName-i "c:\temp\script.sql" -U UserName -P Password 
```

如果不是本地服务器，请将 localhost\SQLEXPRESS 替换为您的服务器名称。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2018-10-25T11:38:40.207

打开 Windows 命令行 (CMD)

```
sqlcmd -S localhost -d NorthWind -i "C:\MyScript.sql" 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2019-08-20T11:45:30.023

对于任何像我一样偶然发现这个问题并且可能会发现这很有用的人，我喜欢[Bruce Thompson 的回答](https://stackoverflow.com/a/6614716/1339507)（它在循环中从文件中运行 SQL），但我更喜欢[Pesche Helfer 的文件执行方法](https://stackoverflow.com/a/40998657/1339507)（因为它避免使用 xp_cmdshell）。

所以我将两者结合起来（并稍微调整了一下，让它从文件夹而不是手动创建的列表中运行所有内容）：

```
DECLARE @Dir NVARCHAR(512) = 'd:\SQLScriptsDirectory'

DECLARE @FileList TABLE (
  subdirectory NVARCHAR(512),
  depth int,
  [file] bit
)

INSERT @FileList
EXEC Master.dbo.xp_DirTree @Dir,1,1

WHILE (SELECT COUNT(*) FROM @FileList) > 0  
BEGIN  
   DECLARE @FileName NVARCHAR(MAX) = (SELECT TOP(1) subdirectory FROM @FileList) 
   DECLARE @FullPath NVARCHAR(MAX) = @Dir + '\' + @FileName

   DECLARE @SQL NVARCHAR(MAX)
   DECLARE @SQL_TO_EXEC NVARCHAR(MAX)
   SELECT @SQL_TO_EXEC = 'select @SQL = BulkColumn
   FROM OPENROWSET
       (   BULK ''' + @FullPath + '''
       ,   SINGLE_BLOB ) AS MYTABLE'

   DECLARE @parmsdeclare NVARCHAR(4000) = '@SQL varchar(max) OUTPUT'  

   EXEC sp_executesql @stmt = @SQL_TO_EXEC
                 , @params = @parmsdeclare
                 , @SQL = @SQL OUTPUT  

   EXEC (@sql)
   DELETE FROM @FileList WHERE subdirectory = @FileName  

   PRINT 'EXECUTED: ' + @FileName     
END 
```

# c++ - 轻柔介绍JIT和动态编译/代码生成

> ID：241936
> 
> 赞同：3
> 
> 时间：2008-10-28T01:12:26.323
> 
> 标签：c++, assembly, code-generation

C/C++ 框架内动态代码生成的看似简单的基础已经在[另一个问题](https://stackoverflow.com/questions/45408/)中讨论过。是否有关于代码示例的温和介绍？

当我的需求更加温和时，我开始盯着高度复杂的开源 JIT 编译器流血。

是否有关于该主题的好文章不假定计算机科学博士学位？我正在寻找磨损良好的图案、需要注意的事项、性能考虑等。电子或基于树的资源可能同样有价值。您可以假设（不仅仅是 x86）汇编语言的工作知识。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T01:47:06.100

好吧，我在模拟器中使用的模式是这样的：

```
typedef void (*code_ptr)();
unsigned long instruction_pointer = entry_point;
std::map<unsigned long, code_ptr> code_map;

void execute_block() {
    code_ptr f;
    std::map<unsigned long, void *>::iterator it = code_map.find(instruction_pointer);
    if(it != code_map.end()) {
        f = it->second
    } else {
        f = generate_code_block();
        code_map[instruction_pointer] = f;
    }
    f();
    instruction_pointer = update_instruction_pointer();
}

void execute() {
    while(true) {
        execute_block();
    }
} 
```

这是一个简化，但想法就在那里。基本上，每次引擎被要求执行一个“基本块”（通常是下一个流控制操作或可能的整个功能的所有内容）时，它都会查找它是否已经创建。如果是，则执行它，否则创建它，添加它然后执行。

冲洗重复:)

至于代码生成，这有点复杂，但我们的想法是发出一个适当的“函数”，它在 VM 的上下文中完成基本块的工作。

编辑：请注意，我也没有展示任何优化，但您要求“温和介绍”

编辑 2：我忘了提到你可以用这种模式实现的最直接的生产加速之一。基本上，如果你*从不*从树中删除一个块（如果你这样做了，你可以解决它，但如果你从不这样做会更简单），那么你可以将块“链接”在一起以避免查找。这是概念。每当您从 f() 返回并即将执行“update_instruction_pointer”时，如果您刚刚执行的块以调用、无条件跳转或根本没有以流控制结束，那么您可以“修复”它*如果*您已经发出了带有直接 jmp 的 ret 指令，它将执行下一个块（因为它总是相同的） 。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T01:27:30.100

我不知道有任何专门与 JIT 相关的来源，但我想它很像一个普通的编译器，如果你不担心性能，它只会更简单。

最简单的方法是从 VM 解释器开始。然后，对于每条 VM 指令，生成解释器将执行的汇编代码。

除此之外，我想您会解析 VM 字节代码并将它们转换为某种合适的中间形式（三地址代码？SSA？），然后像在任何其他编译器中一样优化和生成代码。

对于基于堆栈的 VM，在将字节码转换为中间形式并将每个堆栈位置视为变量时，跟踪“当前”堆栈深度可能会有所帮助。例如，如果您认为当前堆栈深度为 4，并且您看到“push”指令，您可能会生成对“stack_variable_5”的赋值并增加编译时堆栈计数器，或类似的东西。堆栈深度为 5 时的“添加”可能会生成代码“stack_variable_4 = stack_variable_4+stack_variable_5”并减少编译时堆栈计数器。

也可以将基于堆栈的代码翻译成语法树。维护一个编译时堆栈。每个“推送”指令都会将被推送的事物的表示存储在堆栈中。运算符创建包含其操作数的语法树节点。例如，“XY +”可能导致堆栈包含“var(X)”，然后是“var(X) var(Y)”，然后 plus 会弹出两个 var 引用并推送“plus(var(X),各不相同））”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T03:44:33.773

给自己买一本 Joel Pobar 关于转子的书（当它出版时），并深入研究[SSCLI](http://research.microsoft.com/sscli/)的源代码。当心，精神错乱在于:)

# mfc - CListCtrl 可以使用 OnMeasureItem() 方法吗？

> ID：241949
> 
> 赞同：1
> 
> 时间：2008-10-28T01:16:32.417
> 
> 标签：mfc, listview

我想根据滑块更改项目的高度和宽度，但据我所知，没有像 CListBox 这样的 measureitem 方法。我怎样才能解决这个问题？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T01:35:26.763

CListCtrl 中的所有项目必须具有相同的大小。我相信您可以在包含 CListCtrl 的容器中使用 OnMeasureItem，但不会为每个项目调用它，而对整个控件仅调用一次。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T23:14:24.223

解决方法是将**图像列表**附加到**CListCtrl**。然后，这些行将采用基于图像列表高度的高度。

# php - 就地编辑更新脚本安全

> ID：241953
> 
> 赞同：2
> 
> 时间：2008-10-28T01:18:47.467
> 
> 标签：php, jquery, ajax, security, edit-in-place

我正在使用一个*Edit in Place* jquery 插件，它需要将数据发布到将执行实际数据库更新的脚本。

这个更新脚本的 URL 可以在 html 源代码和 Firebug 中轻松查看，因此我需要在处理更新之前添加某种身份验证检查。这当然是为了让用户不能只传递他们想要的任何旧用户标识/字段/值并弄乱其他人的记录。

我最初也传递了他们的用户名和密码，但这并不理想，因为它在 GET 请求中，所以它都在 URL 中。该网站本身至少是 SSL，但无论如何都不是最佳实践。

验证此类更新的最佳方法是什么？

FWIW，更新脚本在 PHP 中，并且 Edit in Place 插件是：[jeditable](http://www.appelsiini.net/projects/jeditable)。

**编辑：**澄清：实际数据有效负载已发布到脚本，但就地编辑插件没有明确的身份验证方法，因此我将身份验证作为 URL 的一部分传递给更新脚本，然后获取这些变量通过 GET 并使用它们进行检查。

**编辑 2：**是的，我可以从更新脚本访问会话信息，所以我决定只提取以前保存的用户 ID 并在 db update 语句中使用它。这似乎是最安全的方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-28T01:35:32.033

我认为您最好将脚本切换为 POST 方法，因为大多数就地编辑使用太大而无法实际使用 GET。您永远不应该使用 SessionId 或密码作为 URL 参数，除了查看公共配置文件之外，我不会将用户名用于任何事情。如果您的 AJAX URL 是 PHP 文件，我相当肯定它*应该*能够访问会话，而无需将其传递到 GET 或 POST 数组中。作为附加说明，请确保在更新数据库之前验证和清理所有信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T01:54:23.293

**更新（基于评论和问题更新）：**您可以将用户名/密码作为`submitdata`选项传递给 Jeditable，如下所示：

```
$(".edit_area")
    .editable("http://www.example.com/save.php", { 
         submitdata: { userid:'johnsmith',  passwd:'god' }
         // ..other settings, etc.
      }); 
```

快速而*肮脏*的解决方案 - 肮脏，因为它以明文形式（通过查看源代码）公开了用户的隐私。

由于您*确实*可以访问服务器上的用户 ID/会话 ID，因此使用该选项是迄今为止最明智的选择。

~~嗯...既然您说 Jeditable 使用 GET，我只能假设您正在使用该`loadurl`选项（因为 Jeditable 用于`$.post()`保存更改，并且`$.post()` *始终*使用 POST）。~~

那么，您是否尝试过将 Jeditable 的`loadtype`设置切换为“POST”，并像以前一样发送用户名/密码？

```
$(".edit_area")
    .editable("http://www.example.com/save.php", { 
         loadurl: 'http://www.example.com/load.php',
         loadtype: 'POST'
         // ..other settings, etc.
      }); 
```

这听起来像是一个快速而肮脏的解决方案——假设您在服务器端没有任何标准的用户/会话处理。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-18T16:10:19.197

如果您只是在会话中查找用户，该站点是否仍然容易受到跨站点请求伪造的攻击？

如果您包含根据不可编辑的 POST 字段的值计算的加盐哈希字段，则可以 POST 所有需要的信息。如果包含时间戳，也可以防止脚本重播。

例子：

```
$(".edit_area")
  .editable("http://www.example.com/save.php", { 
    submitdata: { 
      userid: 'johnsmith',
      pageid: '123',  // or other value unique to the page
      timestamp: '1324354657',  // time when page loaded
      hash: '0bee89b07a248e27c83fc3d5951213c1' }
    // ..other settings, etc.
}); 
```

散列可以是例如 的 MD5 `'johnsmith$123$1324354657$' + $secret_salt`。在保存之前检查它是否匹配。如果时间过少或过长，可选择拒绝。

django-magicforms的[ditch-pycrypto 分支将其](http://github.com/akaihola/django-magicforms/tree/ditch-pycrypto/magicforms.py)实现为 Django 的可重用 Form 基类。它并不直接适用于 AJAX 请求，但文档和单元测试应该为其他实现提供良好的基础。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-10-28T01:25:17.157

要传递信息，您应该在实际的 GET 字符串中使用会话 ID。这样，php 脚本可以连接到会话，验证用户，并查看用户是否有权编辑他们发布的内容。然后，如果他们有权限，则继续，否则返回错误消息。

我相信您可以在 javascript 中获取会话 ID，因此无需公开传递。

# c++ - 检查列表和运行处理程序

> ID：241955
> 
> 赞同：1
> 
> 时间：2008-10-28T01:19:54.563
> 
> 标签：c++, c, idioms

我发现自己编写的代码看起来很多：

```
set<int> affected_items;
while (string code = GetKeyCodeFromSomewhere())
{
    if (code == "some constant" || code == "some other constant") {
        affected_items.insert(some_constant_id);
    } else if (code == "yet another constant" || code == "the constant I didn't mention yet") {
        affected_items.insert(some_other_constant_id);
    } // else if etc...
}
for (set<int>::iterator it = affected_items.begin(); it != affected_items.end(); it++)
{
    switch(*it)
    {
        case some_constant_id:
           RunSomeFunction(with, these, params);
        break;
        case some_other_constant_id:
           RunSomeOtherFunction(with, these, other, params);
        break;
        // etc...
    }
} 
```

我最终编写此代码的原因是我只需要运行第二个循环中的函数一次，即使我收到了多个可能导致它们运行的​​关键代码。

这似乎不是最好的方法。有没有更简洁的方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T01:46:43.493

一种方法是维护从字符串到布尔值的映射。主要逻辑可以从以下内容开始：

```
if(done[code])
    continue;
done[code] = true; 
```

然后，您可以在识别代码后立即执行适当的操作。

另一种方法是将某些可执行文件（对象、函数指针等）存储到某种“待办事项列表”中。例如：

```
while (string code = GetKeyCodeFromSomewhere())
{
    todo[code] = codefor[code];
} 
```

为每个代码值初始化 codefor 以包含适当的函数指针或从公共基类子类化的对象。如果相同的代码多次出现，则 todo 中的相应条目将被其已有的相同值覆盖。最后，遍历 todo 并运行它的所有成员。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T01:29:57.490

由于您似乎并不关心集合中的实际值，因此您可以将其替换为 int 中的设置位。您还可以将线性时间搜索逻辑替换为日志时间搜索逻辑。这是最终的代码：

```
// Ahead of time you build a static map from your strings to bit values.
std::map< std::string, int > codesToValues;
codesToValues[ "some constant" ] = 1;
codesToValues[ "some other constant" ] = 1;
codesToValues[ "yet another constant" ] = 2;
codesToValues[ "the constant I didn't mention yet" ] = 2;

// When you want to do your work
int affected_items = 0;
while (string code = GetKeyCodeFromSomewhere())
    affected_items |= codesToValues[ code ];

if( affected_items & 1 )
    RunSomeFunction(with, these, params);
if( affected_items & 2 )
    RunSomeOtherFunction(with, these, other, params);
// etc... 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T01:30:14.963

它当然不是更整洁，但您可以维护一组标志，说明您是否调用了该特定函数。这样，您就不必将东西保存在一组中，您只需拥有标志。

由于存在（可能从它的编写方式），在编译时固定数量的不同 if/else 块，您可以使用 bitset 轻松完成此操作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T03:41:22.640

显然，这将取决于具体情况，但最好让您调用的函数跟踪它们是否已经运行并在需要时提前退出。

# grails - Grails 应用程序中的 Groovlet

> ID：241960
> 
> 赞同：3
> 
> 时间：2008-10-28T01:25:01.603
> 
> 标签：grails, groovy

如何将 Groovlet 放入 Grails 应用程序？比如说，在 web-app/groovlet.groovy

```
导入 java.util.Date

如果（会话 == null）{
  会话 = request.getSession(true);
}

if (session.counter == null) {
  session.counter = 1
}

打印"""
<html>
    <头部>
        <title>Groovy Servlet</title>
    </head>
    <正文>
您好，${request.remoteHost}：计数器：${session.counter}！日期：${新日期（）}
<br>
"""

```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-28T02:19:33.007

1.  `grails install-templates`
2.  编辑`src/templates/web/web.xml`以包含您的 groovlet
3.  `grails war`
4.  部署

我没有亲自这样做来合并一个 groovlet，但这是修改已部署 Grails 的文档化方法`web.xml`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T02:11:09.997

我的理解是，当你有一个支持 Groovy 脚本的 Servlet 容器时，就会使用 groovlets，

我认为在 Grails 中，您需要将业务逻辑代码移至[控制器](http://grails.org/Controllers)，并将视图部分留给 HTML 或[GS​​P 文件](http://grails.org/doc/1.0.x/guide/6.%20The%20Web%20Layer.html#6.2)。

这些方面的东西（我头顶的元代码，未经测试）：

grails-app/controllers/SampleController.groovy

```
class DateController {
    def index = {
        if (session == null) {
          session = request.getSession(true);
        }

        if (session.counter == null) {
          session.counter = 1
        }
    }
} 
```

网络应用程序/示例/index.gsp

```
<html>
    <head>
    <title>Groovy Servlet</title>
    </head>
    <body>
Hello, ${request.remoteHost}: Counter: ${session.counter}! Date: ${new Date()}
<br> 
```

希望有帮助！

# c# - 如何在 .Net 中将区域性更改为 DateTimepicker 或日历控件

> ID：241964
> 
> 赞同：15
> 
> 时间：2008-10-28T01:27:51.473
> 
> 标签：c#, .net, internationalization, datetimepicker, culture

当期望文化与 PC 中安装的文化不同时，如何在 .Net 中将国际化设置为`DateTimepicker`或控制？`Calendar WinForm`

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-28T13:01:28.797

似乎不可能改变文化。请参阅此[知识库文章](http://support.microsoft.com/Default.aspx?scid=kb%3ben-us%3b889834&x=18&y=19)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-01-08T14:58:36.173

基于以前的解决方案，我认为更好的是：

```
dateTimePicker.Format = DateTimePickerFormat.Custom;
dateTimePicker.CustomFormat = Application.CurrentCulture.DateTimeFormat.ShortDatePattern; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-15T20:57:40.030

```
System.Threading.Thread.CurrentThread.CurrentCulture = System.Globalization.CultureInfo.CreateSpecificCulture("fr");
System.Threading.Thread.CurrentThread.CurrentUICulture = System.Threading.Thread.CurrentThread.CurrentCulture; 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-28T01:55:09.983

对于日期时间选择器

```
dtp.Format = DateTimePickerFormat.Custom;
dtp.CustomFormat = "yyyy-MM-dd"; // or the format you prefer 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-12-29T01:54:28.647

我认为有弯路。

1.  设置事件处理程序“ValueChanged”
2.  代码

    ```
    dateTimePicker.Format = DateTimePickerFormat.Custom;
    string[] formats = dateTimePicker.Value.GetDateTimeFormats(Application.CurrentCulture);
    dateTimePicker.CustomFormat = formats[0]; 
    ```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2019-10-01T06:52:51.383

使用 Telerik radDateTimePicker 并在 InitializeComponent() 之后编写此代码，并使用您的文化而不是“fa-IR”。

```
Application.CurrentCulture = new CultureInfo("fa-IR"); 
radDateTimePicker1.Format = DateTimePickerFormat.Custom;
radDateTimePicker1.CustomFormat = Application.CurrentCulture.DateTimeFormat.ShortDatePattern; 
```

# linq - 关于 .Select 的 Linq/lambda 问题（newby learning 3.0）

> ID：241967
> 
> 赞同：8
> 
> 时间：2008-10-28T01:29:02.203
> 
> 标签：linq, c#-3.0, lambda

我正在玩 C#3.0 的新东西，我有这段代码（主要取自[MSDN](http://msdn.microsoft.com/en-us/vcsharp/aa336746.aspx)），但我只能得到真、假、真......而不是真正的价值：

```
 int[] numbers = { 5, 4, 1, 3, 9, 8, 6, 7, 2, 0 };

        var oddNumbers = numbers.Select(n => n % 2 == 1);

        Console.WriteLine("Numbers < 5:");
        foreach (var x in oddNumbers)
        {
            Console.WriteLine(x);
        } 
```

我该如何解决这个问题以显示整数列表？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-28T01:30:21.437

将“选择”更改为“位置”

```
 int[] numbers = { 5, 4, 1, 3, 9, 8, 6, 7, 2, 0 };

    var oddNumbers = numbers.Where(n => n % 2 == 1);

    Console.WriteLine("Odd Number:");
    foreach (var x in oddNumbers)
    {
        Console.WriteLine(x);
    } 
```

“选择”方法正在为每个元素（真/假）创建一个新的 lambda 结果列表。“Where”方法是基于 lambda 过滤。

在 C# 中，您也可以使用此语法，您可能会发现它更清晰：

```
 var oddNumbers = from n in numbers
                         where n % 2 == 1
                         select n; 
```

编译器将其转换为：

```
var oddNumbers = numbers.Where(n => n % 2 == 1).Select(n => n); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-28T01:33:47.233

> ```
> numbers.Select(n => n % 2 == 1); 
> ```

将此更改为

```
numbers.Where(n => n % 2 == 1); 
```

select 所做的是将一件事“转换”为另一件事。所以在这种情况下，它是“转换” n 到“n % 2 == 1”（这是一个布尔值）——因此你得到了所有的真假。

它通常用于获取事物的属性。例如，如果您有一个`Person`对象列表，并且想要获取它们的名称，您会这样做

```
var listOfNames = listOfPeople.Select( p => p.Name ); 
```

你可以这样想：

*   使用以下方法将人员列表转换为字符串列表：( p => p.Name)

要“选择”（在“过滤”这个词的意义上）集合的子集，您需要使用 Where。

感谢微软糟糕的命名

# c# - 即使虚拟目录允许匿名访问，Web 服务也会出现“HTTP 状态 401：访问被拒绝”错误

> ID：241971
> 
> 赞同：5
> 
> 时间：2008-10-28T01:29:24.200
> 
> 标签：c#, .net, asp.net, web-services, iis

我在另一台服务器上托管了一个 Web 服务，IIS 中的匿名访问复选框已被选中。当我的本地 Web 应用程序尝试访问 Web 服务时，我仍然收到“请求失败，HTTP 状态 401：访问被拒绝”。错误。我的 Web 应用程序正在调用 Web 服务，如下所示：

MyObject.WebService ws = new MyObject.WebService (); ws.Retrieve(someParams);

我在这里想念什么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-28T02:20:37.187

[Here](http://blogs.msdn.com/b/david.wang/archive/2005/07/14/howto-diagnose-iis-401-access-denied.aspx) is a good reference on diagnosing 401 errors.

From that, one place to start is looking at the credentials you configure for the anonymous user. If they are incorrect (if perhaps the user password was changed elsewhere) you will get an HTTP 401.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T02:21:26.093

Make sure your directory permissions are also set to allow everyone read access. A lot of times doing local dev work I will forgot that the directory being accessed has a seperate set of permissions that need to be altered.

Cheers!

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-10-18T06:44:56.947

检查这个[http://www.c-sharpcorner.com/UploadFile/mahesh/40107282006095201AM/401.aspx](http://www.c-sharpcorner.com/UploadFile/mahesh/40107282006095201AM/401.aspx)。

`//Assigning DefaultCredentials to the Credentials property //of the Web service client proxy (myProxy). myProxy.Credentials= System.Net.CredentialCache.DefaultCredentials;`

这段代码对我有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-03T06:03:28.430

我认为可能发生的情况是您收到了 401 - 权限被拒绝，但权限被拒绝的对象尚不清楚。我猜此时您已经检查了机器上的 NTFS 权限，并确认您确实具有访问权限。

接下来，我将查看应用程序池使用的帐户。如果它是默认设置，它可能是 NT 网络服务帐户。如果是这种情况，请确认该帐户确实有权访问应用程序目录。如果也是这种情况，它可能是 COM+ 安全设置。默认情况下，您的网络服务帐户无权远程启动组件。如果是这种情况，您将在系统和安全日志中看到错误链接，“无法启动组件”

查看 IIS 日志文件以及 iis 服务器上的系统和安全事件日志通常会产生更多线索。

希望它有助于最好的问候 Rihan Meij

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-28T02:10:54.867

你有没有尝试取消选择允许 iis 控制密码，有时会离开接收器。

尝试该站点，它可能会起作用。在那之后你就可以重新启用控制了

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-28T02:48:11.890

Try the following (note the PreAuthenticate thingy):

```
MyObject.WebService ws = new MyObject.WebService(); 
ws.PreAuthenticate = true;
response = ws.Retrieve(someParams); 
```

For more detailed explanation why this may work you can reference following answer here [http://social.msdn.microsoft.com/Forums/en-US/asmxandxml/thread/3ae9753d-2d97-45b9-9ba2-6d551fe60a48/](http://social.msdn.microsoft.com/Forums/en-US/asmxandxml/thread/3ae9753d-2d97-45b9-9ba2-6d551fe60a48/).

# php - 我可以在 PHP 中注册多个关闭函数吗？

> ID：241976
> 
> 赞同：3
> 
> 时间：2008-10-28T01:30:58.143
> 
> 标签：php

使用`register_shutdown_function`我可以注册代码以“无论如何”在 PHP 脚本执行结束时执行。

我可以注册多个功能吗？

之所以会出现这个问题，是因为当我准备自己注册时，我可能不知道是否有人已经注册了。

谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-28T01:33:26.860

没关系，答案是肯定的。手动的：

[http://ca3.php.net/register_shutdown_function](http://ca3.php.net/register_shutdown_function)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T01:33:43.147

是的，每个都将按照[PHP 文档](http://us2.php.net/register_shutdown_function)的注册顺序被调用。

# apache - 如何修复 apache2 时间戳，不正确的值

> ID：241989
> 
> 赞同：2
> 
> 时间：2008-10-28T01:37:37.023
> 
> 标签：apache, configuration, apache2

当我重新启动 apache2 并重新加载页面时，日志文件显示

```
boogie.tontut.fi - - [28/Oct/2008:03:27:49 +0200] "GET /test HTTP/1.1" 404 457 "-" "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.0.3) Gecko/2008092417 Firefox/3.0.3" 
```

……应该如此，就像`03:27:49`现在一样。但是，当我再次单击刷新按钮时，新的日志条目是：

```
boogie.tontut.fi - - [27/Oct/2008:21:27:52 -0400] "GET /test HTTP/1.1" 404 457 "-" "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.0.3) Gecko/2008092417 Firefox/3.0.3" 
```

偏移量已经改变`+0200 to -0400`，我不知道这是从哪里来的。

如何开始解决此问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2014-08-14T07:25:06.063

须藤 vim /etc/php5/apache2/php.ini

# 添加时区

date.timezone="欧洲/伦敦"

重启 apache2 /etc/init.d/apache2 重启

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T03:43:19.810

在 apache 中运行的东西是否可能会更改其环境中的语言环境设置？

就像是：

1.  第一次重新加载：记录消息`GMT+2`
2.  Apache 运行 /weird_script.php 调用某种`setlocale()`
3.  第二次重新加载，新环境设置生效，导致日志消息`GMT-4`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T01:56:32.617

尝试在以下位置明确设置您的时区`httpd.conf`：

```
SetEnv TZ GMT+2 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T03:18:43.963

Maybe looking at the system call would help; on Unix its `gettimeofday` and on Windows its `GetSystemTime`.

# sharepoint - 将 Word 2007 保存到 MOSS 会提供永无止境的“获取可用内容类型列表...”对话框

> ID：241991
> 
> 赞同：1
> 
> 时间：2008-10-28T01:42:56.777
> 
> 标签：sharepoint, sharepoint-2007, moss, content-type, office-2007

从 Word 2007 保存到我们的 SharePoint 2007 (MOSS) 文档库时，我们遇到了一个奇怪的间歇性问题，它提供了一个永远不会消失的对话框 - 它的标题是“内容类型”和消息“正在获取可用内容类型的列表... " 带有一个持续滚动的绿色进度条。它在我们的训练服务器（具有独立 SQL Server 的自包含虚拟机）上发生了很多，但更令人担忧的是在我们的实时生产服务器上发生SQL 服务器）。场中的所有服务器都是 64 位的。

这是奇怪的随机 - 用户必须杀死 Word 2007，然后他们恢复他们的文档并尝试保存到同一个文档库，它保存没有问题。

它发生在训练服务器上比实时服务器上更多。实时 Web 应用程序服务器很少超过 20% 的 CPU（通常为 5% 左右），内存峰值为可用 4Gb 的 2Gb（通常为 1.5Gb），所以我认为这不是资源问题。

使用解决方案中的功能自定义和部署文档库。其中唯一的内容类型是标准的 Documents 内容类型。

**更新**我们将此作为支持问题与 Microsoft 一起打开，这是一个已知问题，目标是在 2009 年 2 月的 SharePoint 累积更新修补程序包中解决。

*编辑*将上述回复复制到一个答案，以便可以将此问题标记为已回答。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-08T01:56:59.393

我们将此作为支持问题与 Microsoft 一起打开，这是一个已知问题，目标是在 2009 年 2 月的 SharePoint 累积更新修补程序包中解决。

编辑：截至 2009 年 1 月 27 日，我们有测试补丁，所以看起来官方补丁将按时发布。

编辑：此问题已由 2 月累积更新修复，该更新也是 SP2 的一部分：http: [//blogs.msdn.com/sharepoint/archive/2009/04/28/announcing-service-pack-2-for-office- sharepoint-server-2007-and-windows-sharepoint-services-3-0.aspx](http://blogs.msdn.com/sharepoint/archive/2009/04/28/announcing-service-pack-2-for-office-sharepoint-server-2007-and-windows-sharepoint-services-3-0.aspx)

但是，您还需要修补 Word 才能使其生效；该补丁可在此处获得：http: [//support.microsoft.com/ ?id=962872](http://support.microsoft.com/?id=962872)

那是Word 2007，其他版本可能需要其他补丁。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-08T20:39:27.073

我也遇到过这个问题。你知道它是否在 MOSS Service Pack 2 中得到纠正吗？您是否有来自 Microsoft 的 KB# 或其他 ID 引用此问题？

# .net - 在 .NET 中为变量赋值更有效的方法是什么？

> ID：241994
> 
> 赞同：7
> 
> 时间：2008-10-28T01:46:36.613
> 
> 标签：.net, performance

这是我一直想知道的事情，但从来没有打扰过。

将值分配给临时变量是否比继续使用该值更有效。一个例子可能更清楚：

```
string s = reader.GetItem[0].ToString();
someClass.SomeField  = s;
someOtherClass.someField = s; 
```

或者

```
someClass.SomeField  = reader.GetItem[0].ToString();
someOtherClass.someField = reader.GetItem[0].ToString(); 
```

我最初的想法是顶级示例会更有效，因为它不必访问 Item 集合或调用 ToString。

有兴趣听听其他人的想法，或者以任何一种方式给出明确的答案。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-28T01:50:51.350

编译器无法知道右侧的表达式是否有副作用，因此如果您对其进行两次编码，它必须重新评估它。因此，第一个更有效，因为它不会重新执行 GetItem 和 ToString 调用。

因此，如果您的程序员知道这些调用是纯/幂等的，那么您应该以第一种方式编写代码。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-28T01:55:05.303

正如[布赖恩](https://stackoverflow.com/questions/241994/which-is-more-efficient-way-to-assign-values-to-variables-in-net#242004)所说，第一种方法会更有效，尽管它在现实世界中是否有很大的不同取决于重复函数的成本，以及这段代码作为一个整体被调用的频率。

然而，除了更有效之外，第一种方式更好地表明意图 - 您的意思是为两件事分配相同的值。它还有助于可维护性，因为如果需要更改，您只需在一个地方进行更改。对我来说，这两者通常都比效率更重要。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-28T06:49:06.910

还有另一种选择 - 复合分配：

```
someOtherClass.someField  = someClass.SomeField  = reader.GetItem[0].ToString(); 
```

使用这种用法，编译器将评估`reader.GetItem[0].ToString()` *一次*，并使用它分配给两个成员（它不*使用*of `get`）`someClass`。它通过复制堆栈上的值（不需要显式本地）来做到这一点。

非常有效，但老实说，我不会对带有变量的原始版本感到太兴奋。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T01:54:17.443

好吧，假设该`ToString`函数不只是提供对某个预制内部对象的引用，那么必须非常清楚的是，第一个版本（仅对其进行一次调用）将是最快的。但是，如果这是一个性能问题，您是否应该关心则完全不同。

**然而，需要**考虑的一个问题是，如果从另一个线程同时访问/更改项目，第二个示例可能会在第一行和第二行呈现不同的结果。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-28T02:44:11.630

如果我要多次使用它，我只是习惯将一个值存储在局部变量中。但是，通常这是因为我更喜欢代码的紧凑性，而不是过于关注效率——尽管，如果在循环中重复使用它，我肯定会这样做。

有时，我会前后不一致，只会重新输入，尤其是在仅使用访问器而不调用需要计算的方法时。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-28T03:18:27.117

这是我的经验法则。如有疑问，[请分析您的代码](http://www.microsoft.com/downloads/details.aspx?FamilyId=A362781C-3870-43BE-8926-862B40AA0CD0&displaylang=en)。优化编译器可以删除大量代码，从而使您的代码运行得更快。

还必须考虑两个事实：

*   .NET 分配内存非常快。
*   由于额外的页面错误、引用的局部性差、过多的垃圾收集，过多的垃圾会减慢您的应用程序。

这意味着在粗略的观察下，您的代码可能非常快，但是如果您生成大量垃圾，您的程序的性能将在运行一段时间后受到影响。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-28T03:25:58.007

可读性很重要。“s”命名变量有什么用？

此外，而不是使用 [0]，字段名称将更有意义。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-09-19T23:07:58.310

还有其他问题需要考虑。如果分配给其他变量的 , 的使用与由多于几行代码初始化的`s`where 分开，则您可能会发现其他人会出现并稍后添加代码以更改其使用之间的值，或者以某种方式围绕原始分配分支到.`s``s``s`

我经常看到的一件事是将函数赋值给一个变量，即使该值仅在一个地方使用，我讨厌这一点，因为（并且该变量的名称无关紧要）不可避免地导致必须去查找该变量的分配位置才能知道它真正代表什么。将函数的返回值直接分配给将要使用它的对象，明确指示正在发生的事情。

编程中有一个派别相信“无变量编程”（几十年前著名的“无跳转编程”论文的味道）。例如，XSL，虽然它确实有“变量”，但它们在初始分配后在单个范围内是不可变的。有人说，这有助于保证没有意外的副作用。

# python - 有没有办法在 pydev 中获得 REPL？

> ID：241995
> 
> 赞同：9
> 
> 时间：2008-10-28T01:46:37.037
> 
> 标签：python, ide, pydev, read-eval-print-loop

我希望能够从调试器中删除到 python REPL——如果这是不可能的，除了手动将它们全部添加为监视表达式之外，是否有一种更简单的方法可以在当前断点的上下文中评估 python 表达式？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-05T15:52:58.953

通过单击控制台视图中的“新控制台”下拉菜单，可以使用专用的 Pydev 控制台。

见[http://pydev.sourceforge.net/console.html](http://pydev.sourceforge.net/console.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-28T10:21:22.660

我不使用*pydev*，而是从代码中删除到 python 的交互式 REPL：

```
import code
code.interact(local=locals()) 
```

从代码中删除到 python 的调试器：

```
import pdb
pdb.set_trace() 
```

最后，要在运行一些代码后运行交互式 REPL，可以使用 python 的`-i`开关：

```
python -i script.py 
```

这将在代码之后给你一个 python 提示，即使它抛出一个异常。

我认为，您也许可以将其中一些解决方案挂钩到*pydev*中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-01-04T12:05:17.070

正如 Dag Høidahl 所说，PyDev 控制台实际上是最好的选择（至少在 Eclipse Indigo 上是这样），不需要到处乱搞。

只需转到打开控制台： ![打开控制台](https://i.stack.imgur.com/nXYND.png)

然后选择 PyDev 控制台：

![PyDev 控制台](https://i.stack.imgur.com/nx9M1.png)

如果您需要添加特定的参数（例如 Jython 往往会错过 python.os VM 属性），您可以在 Window -> Properties -> PyDev -> Interactive Console 下更改它们。 ![在此处输入图像描述](https://i.stack.imgur.com/ysj5d.png)*****