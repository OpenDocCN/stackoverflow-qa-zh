# StackOverflow 问答 000287000-000287999

# javascript - 参考路径重新 javascript 智能感知

> ID：287000
> 
> 赞同：12
> 
> 时间：2008-11-13T14:06:14.763
> 
> 标签：javascript, visual-studio-2008, intellisense

我正在尝试从我编写的另一个 js 库/文件中的 js 文件 foo.js 中获取 VS2008 中的智能感知，但无法找出参考路径？语法？/？字符串？

该库位于一个名为 common.js 的文件中，该文件与我正在处理的 foo.js 位于同一文件夹中。

这是我尝试过的路径...

```
/// <reference path="../../scripts/common.js"/>
/// <reference path="/../scripts/common.js"/>
/// <reference path="../scripts/common.js"/>
/// <reference path="/scripts/common.js"/>
/// <reference path="scripts/common.js"/>
/// <reference path="/common.js"/>
/// <reference path="../common.js"/>
/// <reference path="/common.js"/>
/// <reference path="common.js"/> 
```

我缺少什么秘密路径语法/字符串？

FWIW 顶部路径是在此 MVC 应用程序的母版页中设置的内容......就像这样

`<script type="text/javascript" src="../../scripts/common.js"></script>`

谢谢格雷格

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-13T17:14:38.300

首先，确保“common.js”在您的 Web 项目中。然后将“common.js”从解决方案资源管理器拖到要从中引用它的文件的编辑器窗口中。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-12-31T13:37:50.117

最后......终于让 jQuery intellisense 工作......
从这里[http://blogs.msdn.com/webdevtools/archive/2007/11/06/jscript-intellisense-a-reference-for-the-reference-tag .aspx](http://blogs.msdn.com/webdevtools/archive/2007/11/06/jscript-intellisense-a-reference-for-the-reference-tag.aspx)

作者说

> 以下是其他一些微妙的提示：
> 
> *   请记住，引用语句必须位于文件中的所有其他内容之前——即使是普通注释。

这就是为我解决问题的原因......将参考声明放在最上面，然后......瞧！......智能感知工作！

所以只是为了笑，这就是我文件的第一行的样子

```
/// <reference path="common.js" />
/// <reference path="jquery-1.2.6.js" />
/// <reference path="jquery.formatCurrency.js" />
/*
 * Foo Scripts/foo Script: foo.js
 * Version 1.0
 * Copyright(c) 2008 FUBAR Management, LLC. All Rights Reserved.    
 */ 
```

最初我在 Foo Scripts 评论下有参考语句 arghhhh！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-11-14T02:08:42.400

关于 VS2010 javascript intellisense 的其他一些好的文档：

[http://msdn.microsoft.com/en-us/library/bb385682.aspx](http://msdn.microsoft.com/en-us/library/bb385682.aspx)（参考详情） [http://www.scottlogic.co.uk/2010/08/vs-2010-vs-doc-and- javascript-intellisense](http://www.scottlogic.co.uk/2010/08/vs-2010-vs-doc-and-javascript-intellisense) （有关 XML 注释的详细信息）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T14:15:38.710

似乎有一些声音说在这方面有些问题。[例如，Beta 2 JavaScript IntelliSense 和着色问题](http://blogs.msdn.com/webdevtools/archive/2007/07/30/workaround-for-beta-2-javascript-intellisense-and-colorization-issue.aspx)的解决方法。

一个似乎您已经尝试过的建议是[来自 ScottGu 的 VS 2008 JavaScript Intellisense for Silverlight](http://vincenthomedev.wordpress.com/2007/08/09/vs-2008-javascript-from-scottgu/)，但您也可以查看[Visual Studio 2008](http://www.asp.net/learn/3.5-videos/video-223.aspx)视频中的 JavaScript Intellisense 支持。

HTH。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-11-13T15:06:30.667

您是否尝试过 jQuery 智能感知的 VS 修补程序？ [http://blogs.msdn.com/webdevtools/archive/2008/02/08/jscript-intellisense-working-with-jquery.aspx](http://blogs.msdn.com/webdevtools/archive/2008/02/08/jscript-intellisense-working-with-jquery.aspx)

# asp.net-mvc - ASP.Net MVC 加载进度指示器

> ID：287014
> 
> 赞同：15
> 
> 时间：2008-11-13T14:13:03.347
> 
> 标签：asp.net-mvc, indicator

我有一个 MVC 控制器，它通过一个进程运行，设置一些视图数据，然后在视图中将此数据的结果返回给用户。处理时间取决于正在处理的数据量。我需要一种在进程运行时在视图中显示动画 .gif 的好方法，让用户知道正在发生的事情。

我查看了各种 AJAX 方法和部分视图，但仍然找不到实现此目的的好方法。我真正希望我能做的是有一个 ActionFilter，它会在显示此动画 .gif 的 OnActionExecuting 事件期间返回一个视图或部分视图，然后一旦控制器完成处理并返回 ViewData，视图或部分视图与实际视图可以显示数据。

jQuery 似乎也能够提供一种很好的异步方式来在后台调用控制器操作，然后渲染视图。任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-11-13T17:05:09.693

在您的控制器中：

```
public JsonResult GetSomething(int id)
{
    return Json(service.GetSomething(id));
} 
```

在视图中（javascript，使用 JQuery）：

```
$('#someLink').click(function()
{
    var action = '<%=Html.ResolveUrl("~/MyController.mvc/GetSomething/")%>' + $('#someId').val() + '?x=' + new Date().getTime();
    $('#loading').show()
    $.getJSON(action, null, function(something) 
    {
        do stuff with something
        $('#loading').hide()
    });
}); 
```

请注意，这假定了“id”在操作之后出现的路线。操作上的“x”参数是为了阻止 IE 中的激进缓存。

在视图（标记）中：

```
<img id="loading" src="images/ajax-loader.gif" alt=""/> 
<!-- use a css stlye to make display:none --> 
```

[在此处](http://www.ajaxload.info/)获取加载程序 gif 。

另请注意，您不必对 Json 执行此操作。如果您愿意，您可以从控制器操作中获取其他内容，例如 HTML 或 XML。

# asp.net - 关闭浏览器实际上应该清除会话变量一个 ASP.net 会话 ID

> ID：287022
> 
> 赞同：4
> 
> 时间：2008-11-13T14:15:12.517
> 
> 标签：asp.net, session

我有一个 ASP.net 页面。当我关闭网页时，我需要清除会话变量。

如何处理这个我需要将超时保持在 20 分钟。如果他在 20 分钟超时时间内关闭并登录任意次数

是否有可能清除 ASP.net 会话 ID

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-13T14:35:46.343

你不能这样做。

1.  您不能依赖浏览器上发生的事件
2.  服务器没有办法联系浏览器看它是否还活着

您无法控制最终用户的浏览器。用户可能会关闭浏览器、崩溃、断开与 Internet 的连接、禁用或崩溃 javascript 等等。或者用户可能只是输入另一个 url（然后用户可能会使用后退按钮返回您的页面，并且希望继续他/她与您的网站的会话）。

每次卸载页面都会触发 window.onbeforeunload。即使用户浏览到您网站上的另一个页面，他们也可能再次需要您的会话。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-13T14:16:16.257

[编辑] 正如其他人所建议的那样，您的会话最终应该超时，但是如果您想在超时之前关闭会话（例如清理大型会话对象）并且您可以使用 javascript...

您可以使用`window.onbeforeunload`回发到注销页面的处理程序来执行此操作。

```
function CloseSession( )
{
    location.href = 'SignOut.aspx'; 
}
window.onbeforeunload = CloseSession; 
```

你也可以通过 AJAX 来实现。SignOut.aspx 页面（或您正在使用的任何平台）应该放弃用户的会话。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-13T14:25:36.287

我认为这样做的唯一好方法是在服务器上的会话变量上设置超时。Web 服务器无法确定用户是否关闭了浏览器。

Javascript 不是一个好的选择，因为您可以在客户端禁用它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-13T14:26:41.760

如果浏览器进程结束怎么办？

[这](http://www.webxpertz.net/forums/showthread.php?t=5236)是一个技巧

您不应该有太多需要清理的会话变量。有关其他选项，请参阅[此](https://stackoverflow.com/questions/167873/repeated-cookie-query-or-storing-in-viewstate-which-is-the-better-practice#168050)帖子。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T15:23:37.543

我不具体知道 ASP.Net 是如何实现其会话的，但 Cookie RFC 的一部分是会话 cookie（没有特定“到期”日期的）在浏览器关闭时被清除。

当然有一种方法可以让 ASP.Net 使用正确的会话 cookie 而不是具有固定超时的那些？

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2013-11-18T11:45:28.457

你好试试这个javascript函数

```
function ConfirmClose()  
{  
if (event.clientY < 0)  
{  
      /* Your asynchronouse request to the page and call that function*/ 
}  
}
/*now call this method on event of javascript*/ 
```

我没有尝试过，但它只是从脑海中浮现出来

# asp.net - 如何以声明方式将页面的属性值插入到它的呈现中？

> ID：287035
> 
> 赞同：2
> 
> 时间：2008-11-13T14:19:05.097
> 
> 标签：asp.net, properties, declarative

我想要一个包含类似...的aspx页面

```
<form id="form1" runas=server >
    Hello <%= Me.UserName() %>
</form> 
```

和一个代码隐藏的东西，比如......

```
Public Class Somepage
    inherits SomeOtherPage
    Private Readonly Property UserName() as String
    Get
        return "Rory"
    End Get
    End Property
End Class 
```

我已经尝试过此代码，但 aspx 错误声称未声明 UserName。

**这样做的正确方法是什么？**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T14:21:57.760

将属性标记为受保护，而不是私有。

```
Protected Readonly Property UserName() as String    
     Get        
          return "Rory"    
     End Get    
End Property 
```

# web-applications - 语言的选择是否会影响谁将使用该应用程序，尤其是在 Web 应用程序方面？

> ID：287037
> 
> 赞同：0
> 
> 时间：2008-11-13T14:19:39.823
> 
> 标签：web-applications, programming-languages

我认为这主要适用于 Web 应用程序，因为您经常在 Web 应用程序中看到语言和数据库供应商之类的东西，但在桌面应用程序中却没有那么多。

如果一个 Web 应用程序是使用 X 语言创建的，这会对谁部署该应用程序有任何明显的影响吗？例如，使用 .NET 产品的公司是否会考虑使用满足其需求的 Python 应用程序，或者他们是否倾向于找到可以使用的 .NET 产品？

编辑 1：细化问题以指代要部署的应用程序，而不仅仅是使用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T14:28:32.053

我假设您谈论的是在其组织内购买和部署 Web 应用程序的公司。如果您只是在谈论使用外部应用程序，我认为他们不会注意到或关心。

我认为这是非常主观的，但根据我过去的经验，公司倾向于使用他们已经安装和运行的技术。他们倾向于这样做有几个原因。

*   新应用程序将需要对现有基础架构进行更少的更改（例如，让 PHP 在 IIS 上运行）
*   与现有应用程序的互操作可能会更容易
*   他们可能已经在内部拥有专业知识来支持他们当前正在运行的任何语言/服务器/数据库等。
*   他们的 IT 人员可能已经对其他语言/OS/db 形成了偏见

过去每次我出去评估 Web 应用程序时，我都会将搜索范围限制在我们已经使用的技术上。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T14:23:01.750

这实际上取决于需要多少定制和集成——以及应用程序是否向其公开任何类型的合理 API。

例如，您可能需要以下类型的自定义：

*   通过模块自定义身份验证；平台可能很重要
*   生成您自己的报告；数据库可能很重要
*   针对作为应用程序一部分的网络服务采取行动；协议（SOAP、REST、自定义等）可能很重要，但不是实现语言

此外，还有支持和维护的问题——例如，Windows ISV 在保持 IIS 运行方面可能比 Apache 更好，反之亦然。同样，如果您已经拥有运行所需操作系统的服务器，它会有所帮助......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T14:25:01.827

我认为大多数公司甚至都不知道您在说什么，尤其是对于 Web 应用程序。我以写这些东西为生，甚至我也不知道是什么平台在为我最喜欢的网站提供动力。就此而言，我什至不知道 SO 运行的是什么。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T14:26:04.787

不，除非语言的选择对功能有明显的影响。理想情况下不会。

两个例子： jEdit 是一个了不起的程序，但它的 Java 根源确实阻碍了它。它默认为 Java GUI 的外观（swing？）。它也很慢（尽管 Java 程序不需要很慢，这个就是）。

另一方面，Stack Overflow 网站是基于 .NET 的——但这有什么关系呢？它对站点功能几乎没有影响。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T14:26:05.490

创建一个应用程序（比如 ASP.NET）将是一个有趣的实验，然后稍微修改它，将它放在另一个 Web 服务器上并重写扩展名（从 .aspx 到 .py 或 .php）并查看最终结果更受欢迎。

# .net - Windows Forms .NET 2.0：如何绘制 PNG 图标？

> ID：287041
> 
> 赞同：11
> 
> 时间：2008-11-13T14:20:42.503
> 
> 标签：.net, winforms, graphics, windows-vista

**注意：**[在应用程序中使用 256 x 256 Vista 图标的](https://stackoverflow.com/questions/220465/using-256-x-256-vista-icon-in-application)问题涉及使用“Vista”图标作为应用程序的图标。这个问题涉及手动绘制 Vista 图标。

**注意：**问题[WinForms .NET 2.0：如何绘制适当大小的图标？](https://stackoverflow.com/questions/281999/winforms-net-20-how-to-paint-with-the-proper-icon)处理绘制从文件加载的 Vista 图标。此问题涉及绘制从 .resource 加载的 Vista 图标。

* * *

我在我的 Visual Studio 项目中包含了一个具有各种格式的图标：

*   16x16
*   32x32
*   48x48
*   256x256（PNG 压缩）

现在想画256x256的版本。我尝试过的以下任何事情都不起作用。

**下面绘制了拉伸到 256x256 的 32x32 格式：**

```
Icon ico = Properties.Resources.TestIconThatHasA256PNGFormat;
e.Graphics.DrawIcon(ico, new Rectangle(0, 0, 256, 256)); 
```

**下面绘制了未拉伸的 32x32 格式：**

```
Icon ico = Properties.Resources.TestIconThatHasA256PNGFormat;
e.Graphics.DrawIconUnstretched(ico, new Rectangle(0, 0, 256, 256)); 
```

**下面绘制了拉伸到 256x256 的 32x32 格式：**

```
Icon ico = Properties.Resources.TestIconThatHasA256PNGFormat;
e.Graphics.DrawImage(ico.ToBitmap(), new Rectangle(0, 0, 256, 256)); 
```

**下面绘制了拉伸到 256x256 的 48x48 格式：**

```
Icon ico = Properties.Resources.TestIconThatHasA256PNGFormat;
e.Graphics.DrawIcon(
      new Icon(ico, new Size(256, 256)),
      new Rectangle(0, 0, 256, 256)); 
```

如何绘制 256x256 格式的图标？

* * *

笔记：

1.  该图标不是来自文件，因此[PInvoking](https://stackoverflow.com/questions/220465/using-256-x-256-vista-icon-in-application) LoadImage() 将无济于事。

2.  该图标不是与文件关联的图标，因此[PInvoking](http://support.microsoft.com/kb/319350) SHGetFileInfo()[将](https://stackoverflow.com/questions/287041/winforms-net-20-how-to-draw-a-vista-icon#287076)无济于事。也不会[使用 Icon.ExtractAssociatedIcon](https://stackoverflow.com/questions/220465/using-256-x-256-vista-icon-in-application)。

3.  我也没有尝试在运行时创作 256x256 格式的图标，因此[旨在执行此操作的库](http://www.codeproject.com/KB/cs/IconLib.aspx)将无济于事。

    [2](https://stackoverflow.com/questions/281999/winforms-net-20-how-to-paint-with-the-proper-icon)：问题[WinForms .NET 2.0：如何绘制适当大小的图标？](https://stackoverflow.com/questions/281999/winforms-net-20-how-to-paint-with-the-proper-icon)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-30T05:03:27.753

根据`ResourceManager`存储在资源中的位加载图标。但是，它处理加载的方式不允许您访问 256x256 图标（此信息不会进入`System.Drawing.Icon`您返回的图标）。

很抱歉让您失望，但我知道的唯一有效方法是通过 P/Invoke 加载图标`LoadImage`并使用文件（是的，我知道，这不是您想要的）。所以新的问题应该是：我如何提取给定资源的位，以便我可以将它们存储到文件中？我担心这也是不可能的`System.Resources.ResourceReader`，因为资源数据似乎是序列化的 .NET 对象的集合。

无论如何，对于那些有能力从 .ICO 文件加载图标的人（对于我自己，作为未来如何加载 256x256 图标的参考），请致电`IconConverter.LoadIcon`：

```
using System.Runtime.InteropServices;

static class IconConverter
{
    public static System.Drawing.Icon LoadIcon(string path, int width, int height)
    {
        System.IntPtr hIcon;
        hIcon = LoadImage (System.IntPtr.Zero, path, IMAGE_ICON, width, height,
                           LR_LOADFROMFILE);
        if (hIcon == System.IntPtr.Zero)
        {
            return null;
        }
        return System.Drawing.Icon.FromHandle (hIcon);
    }

    const int IMAGE_ICON = 1;
    const int LR_LOADFROMFILE = 0x0010;

    [DllImport ("user32.dll", SetLastError=true, CharSet=CharSet.Auto)]
    static extern System.IntPtr LoadImage(System.IntPtr hInstance,
                                          string lpszName, uint uType,
                                          int cxDesired, int cyDesired,
                                          uint fuLoad);
} 
```

获得`System.Drawing.Icon`预期尺寸后，只需使用`graphics.DrawIconUnstretched`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T14:29:15.857

不久前我问了一个类似的问题，但运气不佳。我帖子中的一些答案可能会对您有所帮助，有一种方法，但看起来很难。链接到我的帖子[在这里](https://stackoverflow.com/questions/220465/using-256-x-256-vista-icon-in-application)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-22T11:13:24.427

今天，我做了一个非常好的函数，可以**从 Vista 图标中提取 256x256 位图**。

我用它在“关于”框中将大图标显示为位图。

该函数将 Icon 对象作为参数。因此，您可以将它与任何图标一起使用——**来自资源**、来自文件、来自流等等。它可以在**任何操作系统**上运行，因为它不**使用**任何 Win32 API，它是 100% 托管代码 :-)

```
Bitmap ExtractVistaIcon(Icon icoIcon) 
```

我在这里发布了我的函数：[ExtractVistaIcon()](https://stackoverflow.com/questions/220465/using-256-x-256-vista-icon-in-application/1945764#1945764)

# c++ - 如何确定 mpeg-2 程序流文件的视频尺寸

> ID：287053
> 
> 赞同：3
> 
> 时间：2008-11-13T14:23:46.507
> 
> 标签：c++, video, mpeg-2, transport-stream

如何以编程方式找出 mpeg-2~~传输~~程序流文件中视频的宽度和高度？

编辑：我正在使用 C++，但很高兴看到任何语言的示例。编辑：更正的问题 - 这可能是我要问的程序流

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T16:37:18.767

查看[libmpeg2](http://libmpeg2.sourceforge.net/)的源代码，这是一个 F/OSS MPEG2 解码器。看起来宽度和高度是在`mpeg2_header_sequence()`函数中设置的`header.c`。不过，我不确定控制如何流向该特定功能。我建议使用 libmpeg2 （例如[MPlayer](http://www.mplayerhq.hu)）打开一个 MPEG2 文件并附加一个调试器以更准确地查看它在做什么。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T16:47:12.460

如果你使用的是 DirectX，在 VMRWindowlessControl 接口中有一个方法：

```
piwc->GetNativeVideoSize(&w, &h, NULL, NULL); 
```

或者 IBasicVideo 接口：

```
pivb->GetVideoSize(&w, &h); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-16T17:45:38.637

对于 MPEG2 视频，水平和垂直大小可以在视频序列头（来自视频比特流）中找到。序列头代码为 0x000001B3。下面的一些示例代码。但是，如果在序列扩展标头中指定，它不会考虑水平/垂直尺寸扩展。

```
#define VIDEO_SEQUENCE_HDR  0xB3
#define HOR_SIZE_MASK       0xFFF00000
#define HOR_SIZE_SHIFT      20
#define VER_SIZE_MASK       0x000FFF00
#define VER_SIZE_SHIFT      8

unsigned char *pTmp = tsPacket;
int len = 188;
int horizontal, vertical;

 while(len>0 && !horizontal && !vertical)
 {        
        if(*pTmp == 0 && *(pTmp+1) == 0
           && *(pTmp+2)== 0x01 && *(pTmp+3) == 0xB3 && (len-1) >0)
        {
            unsigned int *pHdr = (unsigned int *)pTmp;    
            pHdr++ ; 
            unsigned int secondByte = ntohl(*pHdr);
            horizontal = (secondByte & HOR_SIZE_MASK) >> HOR_SIZE_SHIFT;
            vertical = (secondByte & VER_SIZE_MASK) >> VER_SIZE_SHIFT;           
            break;
        }
        pTmp++;
        len--;
    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-07-20T15:37:12.400

hamishmcn 说，Adam Rosenfield 的回答正是他所需要的。这让我怀疑这个问题的准确性。MPEG 传输流没有***视频***序列标头。该标头可在 MPEG 程序流中找到。

我没有答案。我只是希望有人的答案是正确的，因为我需要一个。

# php - 如何使用 PHP 在动态生成的 MS Excel 文件中插入/嵌入图像？

> ID：287054
> 
> 赞同：1
> 
> 时间：2008-11-13T14:23:49.567
> 
> 标签：php, mysql

我需要使用 PHP 即时将报告导出到 Excel 文件。我实际上是从 MySQL 获取数据并将其呈现在 HTML 表中。

我能够将所有这些数据导出为 Excel 文件格式，图像除外。我不能将图像源指向一个绝对 URL，因为这个文件也需要离线工作。

有什么方法可以在不使用任何库的情况下将图像嵌入/插入到这个 Excel 文件中，即只有 PHP 代码或不需要 PEAR/PECL 扩展的库。我正在使用 LAMP 堆栈，所以 COM 不是一个选项。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T15:05:06.613

我不确定您不使用 PEAR 的原因是什么，但是PEAR [Spreadsheet Excel Writer有一个修改版本（](http://pear.php.net/package/Spreadsheet_Excel_Writer) [PHP Excel Creator 库](http://pizzaseo.com/php-excel-creator-class)），它与 PEAR 的其余部分没有任何依赖关系。

我知道原始 PEAR 版本有一个方法[Worksheet::insertBitmap()](http://pear.php.net/manual/en/package.fileformats.spreadsheet-excel-writer.spreadsheet-excel-writer-worksheet.insertbitmap.php)。如果还没有图像，则需要将图像转换为位图（可能在 PHP 中使用 GD）

如果您在 Windows 上并且可以正常访问服务器，您也可以尝试使用 COM 与 Excel 对话并以这种方式生成文件。

# sql-server - 在 SQL Server 上按计划运行存储过程

> ID：287060
> 
> 赞同：65
> 
> 时间：2008-11-13T14:25:43.663
> 
> 标签：sql-server, tsql

是否可以以某种方式设置 Microsoft SQL Server 以定期运行存储过程？

* * *

## 回答 #1

> 赞同：113
> 
> 时间：2008-11-13T14:28:31.803

是的，在 MS SQL Server 中，您可以创建计划作业。在 SQL Management Studio 中，导航到服务器，然后展开 SQL Server Agent 项，最后展开 Jobs 文件夹以查看、编辑、添加计划作业。

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2009-11-20T09:49:17.070

如果正在使用 MS SQL Server Express Edition，则 SQL Server 代理不可用。我发现以下适用于所有版本：

```
USE Master
GO

IF  EXISTS( SELECT *
            FROM sys.objects
            WHERE object_id = OBJECT_ID(N'[dbo].[MyBackgroundTask]')
            AND type in (N'P', N'PC'))
    DROP PROCEDURE [dbo].[MyBackgroundTask]
GO

CREATE PROCEDURE MyBackgroundTask
AS
BEGIN
    -- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    SET NOCOUNT ON;

    -- The interval between cleanup attempts
    declare @timeToRun nvarchar(50)
    set @timeToRun = '03:33:33'

    while 1 = 1
    begin
        waitfor time @timeToRun
        begin
            execute [MyDatabaseName].[dbo].[MyDatabaseStoredProcedure];
        end
    end
END
GO

-- Run the procedure when the master database starts.
sp_procoption    @ProcName = 'MyBackgroundTask',
                @OptionName = 'startup',
                @OptionValue = 'on'
GO 
```

一些注意事项：

*   值得在某处编写审计条目，以便您可以看到查询实际运行。
*   服务器需要重新启动一次以确保脚本第一次运行。
*   一个相关的问题是：[如何在 SQL Server Express Edition 中每天运行一个存储过程？](https://stackoverflow.com/questions/1675206/how-to-run-a-stored-procedure-every-day-in-sql-server-express-edition)

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-11-13T14:35:44.707

是的，如果您使用 SQL Server 代理。

打开您的企业管理器，然后转到您感兴趣的 SQL Server 实例下的管理文件夹。在那里您将看到 SQL Server 代理，在其下方您将看到一个作业部分。

在这里您可以创建一个新作业，您将看到需要创建的步骤列表。创建新步骤时，可以指定实际运行存储过程的步骤（类型 TSQL 脚本）。选择数据库，然后在命令部分输入如下内容：

```
exec MyStoredProcedure
```

这就是概述，如果您需要任何进一步的建议，请在此处回复。

[我实际上以为我可能会先参加这个，男孩是我错了:)]

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2014-03-07T19:29:40.230

[可能不是您正在寻找的答案，但我发现简单地使用Windows Server 任务计划程序](http://msdn.microsoft.com/en-us/library/ms162773.aspx "Windows Server Task Scheduler")更有用

可以直接使用命令`sqlcmd.exe -S "." -d YourDataBase -Q "exec SP_YourJob"`

甚至创建一个`.bat`文件。因此，您甚至可以按需点击 2 次任务。

这也已在[此处处理](https://stackoverflow.com/questions/1675206/how-to-run-a-stored-procedure-every-day-in-sql-server-express-edition%20HERE)

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-11-13T14:39:38.253

我要补充一件事：在我所在的地方，我们过去每天晚上都有一堆批处理作业。但是，我们正在从这种方式转移到使用在启动每个作业的 Windows 计划任务中计划的客户端应用程序。这有（至少）三个原因：

1.  我们有一些控制台程序也需要每晚运行。这样，所有计划任务都可以放在一个地方。当然，这会造成单点故障，但如果控制台作业不运行，我们第二天就会失去一天的工作。
2.  启动作业的程序从服务器捕获打印消息和错误，并将它们写入我们所有批处理进程的通用应用程序日志。它使使用 sql 作业的日志记录变得更加简单。
3.  如果我们需要升级服务器（我们希望尽快这样做），我们无需担心将工作转移。只需重新指向应用程序一次。

这是一个真正简短的 VB.Net 应用程序：如果有人感兴趣，我可以发布代码。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2017-01-28T12:31:52.770

您可以使用**[SQL Server Service Broker](https://msdn.microsoft.com/en-us/library/bb522893.aspx)**创建自定义机制。

想法（简化）：

1.  编写一个存储过程/触发器，开始对话（[BEGIN DIALOG](https://msdn.microsoft.com/en-us/library/ms187377.aspx)）作为环回（从 my_service 到 my_service） - 获取对话处理程序

    ```
    DECLARE @dialog UNIQUEIDENTIFIER;

    BEGIN DIALOG CONVERSATION @dialog
            FROM SERVICE   [name] 
            TO SERVICE      'name' 
            ...; 
    ```

2.  启动对话计时器

    ```
    DECLARE @time INT;
    BEGIN CONVERSATION TIMER (@dialog)  TIMEOUT = @time; 
    ```

3.  在指定的秒数后，一条消息将被发送到服务。它将与关联的队列一起排队。

    ```
    CREATE QUEUE queue_name WITH STATUS = ON, RETENTION = OFF
                 , ACTIVATION (STATUS = ON, PROCEDURE_NAME = <procedure_name>
                 , MAX_QUEUE_READERS = 20, EXECUTE AS N'dbo')
                  , POISON_MESSAGE_HANDLING (STATUS = ON) 
    ```

4.  程序将执行特定代码并重新启动计时器以再次触发。

* * *

**您可以找到由Michał Gołoś**编写的名为**[Task Scheduler](http://toolien.pl/taskscheduler/)**的完整解决方案（T-SQL）

**博客中的关键点：**

**优点：**

*   每个版本都支持（从 Express 到 Enterprise）。SQL Server 代理作业不适用于 SQL Server Express
*   范围为数据库级别。您可以轻松地移动具有相关任务的数据库（尤其是当您必须将大约 100 个作业从一个环境移动到另一个环境时）
*   查看/操作任务所需的较低权限（数据库级别）

**建议的区别：**

SQL Server 代理（维护）：

*   备份
*   索引/统计信息重建
*   复制

任务计划程序（业务流程）：

*   删除旧数据
*   预聚合/循环重新计算
*   非规范化

**如何设置：**

*   从“Do pobrania”部分获取源代码 - 下载（启用代理/设置模式 tsks/配置表 + 触发器 + 存储过程）/设置代理事物）
*   设置配置表`[tsks].[tsksx_task_scheduler]`以添加新任务（列名称是自描述的，包括示例任务）

***警告：博客是用波兰语写的，但相关的源代码是英文的，很容易理解。***

***警告2：在使用前，请确保您已经在非生产环境中进行了测试。***

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-13T14:28:32.083

使用 Management Studio - 您可以创建一个作业（在 SQL Server 代理下）一个作业可能包括从 T-SQL 脚本到 SSIS 包的多个步骤

杰布更快；）

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-11-13T14:28:54.097

您应该查看[使用 SQL Server 代理计划的作业](http://technet.microsoft.com/en-us/library/ms189237.aspx)。

# c# - 在 IIS 7 上使用 HttpHandler 取消请求验证

> ID：287065
> 
> 赞同：3
> 
> 时间：2008-11-13T14:26:35.020
> 
> 标签：c#, .net, asp.net, iis, iis-7

我有一个应用程序必须处理在其 URL 中获取“特殊”字符（如 &、+、% 等）。当我使用这些字符向应用程序发送请求时（当然我发送它们是转义的），我收到带有消息“ASP.NET 检测到 URL 中的无效字符”的“错误请求”响应代码。跟踪请求显示错误是从“身份验证模块”引发的。

我搜索了一下，发现每个页面都有一个 ValidateRequest 并将其值更改为 false 可以解决问题。不幸的是，我正在使用 Httphandler。有谁知道如何使用 http 处理程序停止请求验证？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T01:28:20.003

我遇到了同样的问题（创建一个需要在 URL 中接收带有特殊字符的请求的 IHttpHandler）。我必须做两件事来修复它：

1.  创建以下值为 1 的 DWORD 注册条目：`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\ASP.NET\VerificationCompatibility`

2.  在 web.config 中，将 requestFiltering 元素的 allowDoubleEscaping 属性设置为 true。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-06-23T09:40:18.133

我遇到了同样的问题，并通过设置 validateRequest="false" 以及 requestValidationMode="2.0" 使其工作，如下所示。没有注册表编辑。

```
<system.web>
  <httpRuntime requestValidationMode="2.0" />
  ...
  <pages ... validateRequest="false" />
</system.web> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-10-13T15:37:55.350

应用程序或机器级别的批发更改对我来说是不可接受的。我只有一个参数，客户端发送不正确，我需要清理。

我发现，当使用 html 或查询字符串中的其他潜在危险项发出请求时，您可以使用`context.Request.RawUrl`清理字符串，一旦查询字符串被清理，请使用`context.RewritePath(scrubbedUrl)`.

1.  处理程序中的第一件事，获取`context.Request.RawUrl`
2.  清除错误的请求 RawUrl 以获取错误的输入
3.  `context.RewritePath(srubbedUrl)`
4.  利润

似乎请求验证只关心访问`context.Request.Params[]`，所以如果你在访问 Params 集合之前擦洗并重写路径（到相同的路径），你就是黄金。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-05-04T11:06:07.127

以下解决方案对我有用 - 创建以下值为 1 的 DWORD 注册条目：`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\ASP.NET\VerificationCompatibility`

在 中`web.config`，将元素的`allowDoubleEscaping`属性设置为。`requestFiltering``true`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T15:43:51.400

您可以删除所有模块

```
<httpModules>
  <clear />
</httpModule> 
```

使请求到达您的处理程序。或者，也许您可​​以删除阻止您的请求的特定模块。

这是在 ASP.NET 2.0 中从[这里默认加载的模块列表](http://msdn.microsoft.com/es-es/library/9b9dh535(VS.80).aspx)

```
<httpModules>
     <add name="OutputCache" type="System.Web.Caching.OutputCacheModule" />
     <add name="Session" type="System.Web.SessionState.SessionStateModule" />
     <add name="WindowsAuthentication" type="System.Web.Security.WindowsAuthenticationModule" />
     <add name="FormsAuthentication" type="System.Web.Security.FormsAuthenticationModule" />
     <add name="PassportAuthentication" type="System.Web.Security.PassportAuthenticationModule" />
     <add name="RoleManager" type="System.Web.Security.RoleManagerModule" />
     <add name="UrlAuthorization" type="System.Web.Security.UrlAuthorizationModule" />
     <add name="FileAuthorization" type="System.Web.Security.FileAuthorizationModule" />
     <add name="AnonymousIdentification" type="System.Web.Security.AnonymousIdentificationModule" />
     <add name="Profile" type="System.Web.Profile.ProfileModule" />
</httpModules> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-19T03:59:14.440

这个怎么样？

```
<system.web>
    <pages validateRequest="false">
    </pages>
</system.web> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-02-21T16:14:18.373

从 .NET Framework 4.5 开始，您可以使用该[`Unvalidated`](https://docs.microsoft.com/en-us/dotnet/api/system.web.httprequest.unvalidated)属性`HttpRequest`或`HttpRequestBase`以不会触发请求验证的方式访问表单、查询字符串和 URL 数据。如果您避免以任何其他方式访问这些值（包括在同一请求中运行的辅助方法或其他 HTTP 模块中），您将不需要其他任何东西来避免请求验证。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-11-13T14:34:44.333

您可以在 web.config 的 pages 部分将 validateRequest 设置为 false。也许这也适用于 HttpHandlers？

# couchdb - 您可以将 couchDB 用于 ebay 等 Web 应用程序吗？

> ID：287073
> 
> 赞同：0
> 
> 时间：2008-11-13T14:28:53.830
> 
> 标签：couchdb

我的意思是，您可以将 couchDB 用于：

*   项目、用户的 CRUD
*   投标和拍卖决议
*   双向校准
*   论坛
*   项目比较

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T15:05:42.680

You could try to use CouchDB for an application - as to whether you would be successful is another question.

Something on the scale of eBay will have special requirements that are not representative of a typical application, If you are building a small auction site then perhaps CouchDB would suffice. A document-oriented database like CouchDB may not be so hot when you have to deal with transactional/records-based data like that associated with auctions.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T19:01:39.210

我认为 couchdb 可以很好地解决部分问题，尽管有一些元素不是很好。特别是，分布式节点的最终一致性对于实时竞价来说似乎真的很糟糕。

您可以在 CouchDB 中保留项目和用户信息，以及论坛和许多类似的东西，但某些功能（出价跟踪、搜索）将更适合其他后端。例如，CouchDB 的人正在考虑将 CouchDB 与其他工具（如 SOLR）结合起来进行索引等。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-28T17:09:42.383

正如您[在这里](https://stackoverflow.com/questions/1234158/trying-to-understand-ebays-schema/1234177#1234177)看到的，他们确实使用了非关系方法，所以我猜您正朝着正确的方向前进（至少在灵活性方面）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T16:31:45.157

我想看看亚马逊如何在内部使用 SimpleDB（或者他们是如何使用的？）。可能有一些关于使用基于文档的数据库的正确方法的线索。

# vba - 迭代未注册的加载项 (.xla)

> ID：287077
> 
> 赞同：10
> 
> 时间：2008-11-13T14:29:21.443
> 
> 标签：vba, excel, add-in, excel-addins

我需要帮助

*   弄清楚如何使用菜单路径遍历尚未在 Excel 中注册的当前打开的 Excel 加载项文件*(.xla) 。*`Tools > Add-ins`
*   更具体地说，我对任何未出现在加载项对话框中但具有`ThisWorkbook.IsAddin = True`.

证明问题：

尝试按如下方式遍历工作簿不会获得具有以下内容的工作簿`.AddIn = True`：

```
Dim book As Excel.Workbook

For Each book In Application.Workbooks
    Debug.Print book.Name
Next book 
```

循环通过加载项不会获取未注册的加载项：

```
Dim addin As Excel.AddIn

For Each addin In Application.AddIns
    Debug.Print addin.Name
Next addin 
```

循环遍历 VBProjects 集合有效，但前提是用户在宏安全设置中具有对 Visual Basic 项目的特别受信任的访问权限 - 这很少：

```
Dim vbproj As Object

For Each vbproj In Application.VBE.VBProjects
    Debug.Print vbproj.Filename
Next vbproj 
```

但是，如果知道工作簿的名称，则可以直接引用该工作簿，而不管它是否是加载项：

```
Dim book As Excel.Workbook
Set book = Application.Workbooks("add-in.xla") 
```

但是，如果名称未知，并且不能依赖用户的宏安全设置，那么如何获得对这个工作簿的引用呢？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2013-01-17T20:30:37.643

从 Office 2010 开始，有一个新的集合 .AddIns2 与 .AddIns 相同，但还包括未注册的 .XLA 插件。

```
Dim a As AddIn
Dim w As Workbook

On Error Resume Next
With Application
    For Each a In .AddIns2
        If LCase(Right(a.name, 4)) = ".xla" Then
            Set w = Nothing
            Set w = .Workbooks(a.name)
            If w Is Nothing Then
                Set w = .Workbooks.Open(a.FullName)
            End If
        End If
    Next
End With 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-09-21T04:37:46.700

我遇到了无法通过用户`Addin`在 Exel 2013 上（在工作环境中）安装的插件（以及在 VBE 中）的问题。

修补Chris C[的解决方案提供了一个很好的解决方法。](https://stackoverflow.com/a/14387580/641067)

```
Dim a As AddIn
Dim wb As Workbook

On Error Resume Next
With Application
    .DisplayAlerts = False
        For Each a In .AddIns2
        Debug.Print a.Name, a.Installed
            If LCase(Right$(a.Name, 4)) = ".xla" Or LCase(Right$(a.Name, 5)) Like ".xla*" Then
                Set wb = Nothing
                Set wb = .Workbooks(a.Name)
                wb.Close False
                Set wb = .Workbooks.Open(a.FullName)
            End If
        Next
   .DisplayAlerts = True
End With 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T16:20:02.263

我仍在寻找针对此问题的合理解决方案，但目前看来，阅读所有工作簿窗口的窗口文本可以提供所有打开的工作簿的集合，无论是否加载：

```
Private Declare Function FindWindowEx Lib "user32" Alias "FindWindowExA" (ByVal hWnd1 As Long, ByVal hWnd2 As Long, ByVal lpsz1 As String, ByVal lpsz2 As String) As Long
Private Declare Function GetClassName Lib "user32" Alias "GetClassNameA" (ByVal hWnd As Long, ByVal lpClassName As String, ByVal nMaxCount As Long) As Long
Private Declare Function GetWindowText Lib "user32" Alias "GetWindowTextA" (ByVal hWnd As Long, ByVal lpString As String, ByVal cch As Long) As Long

Public Function GetAllOpenWorkbooks() As Collection

'Retrieves a collection of all open workbooks and add-ins.

Const EXCEL_APPLICATION_WINDOW  As String = "XLDESK"
Const EXCEL_WORKBOOK_WINDOW     As String = "EXCEL7"

Dim hWnd                As Long
Dim hWndExcel           As Long
Dim contentLength       As Long
Dim buffer              As String
Dim bookName            As String
Dim books               As Collection

Set books = New Collection

'Find the main Excel window
hWndExcel = FindWindowEx(Application.hWnd, 0&, EXCEL_APPLICATION_WINDOW, vbNullString)

Do

    'Find next window
    hWnd = FindWindowEx(hWndExcel, hWnd, vbNullString, vbNullString)

    If hWnd Then

        'Create a string buffer for 100 chars
        buffer = String$(100, Chr$(0))

        'Get the window class name
        contentLength = GetClassName(hWnd, buffer, 100)

        'If the window found is a workbook window
        If Left$(buffer, contentLength) = EXCEL_WORKBOOK_WINDOW Then

            'Recreate the buffer
            buffer = String$(100, Chr$(0))

            'Get the window text
            contentLength = GetWindowText(hWnd, buffer, 100)

            'If the window text was returned, get the workbook and add it to the collection
            If contentLength Then
                bookName = Left$(buffer, contentLength)
                books.Add Excel.Application.Workbooks(bookName), bookName
            End If

        End If

    End If

Loop While hWnd

'Return the collection
Set GetAllOpenWorkbooks = books

End Function 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T11:58:57.887

那这个呢：

```
Public Sub ListAddins()

Dim ai As AddIn

    For Each ai In Application.AddIns
        If Not ai.Installed Then
            Debug.Print ai.Application, ai.Parent, ai.Name, ai.FullName
        End If
    Next

End Sub 
```

有什么用？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-28T13:40:01.850

使用 =DOCUMENTS，一个 Excel4 宏函数。

```
Dim Docs As Variant
Docs = Application.Evaluate("documents(2)") 
```

这是它的文档（可[在此处](http://support.microsoft.com/kb/109976 "这里")获得）：

**DOCUMENTS**
以文本形式的水平数组形式返回按字母顺序排列的指定打开工作簿的名称。使用 DOCUMENTS 检索打开的工作簿的名称，以在其他操作打开的工作簿的函数中使用。

**语法**
DOCUMENTS(type_num, match_text)
Type_num 是一个数字，指定是否在工作簿数组中包含加载项工作簿，如下表所示。

```
Type_num       Returns
1 or omitted   Names of all open workbooks except add-in workbooks
2              Names of add-in workbooks only
3              Names of all open workbooks 
```

Match_text 指定要返回其名称的工作簿，并且可以包含通配符。如果省略 match_text，则 DOCUMENTS 返回所有打开的工作簿的名称。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-12T14:16:51.320

是否有可能遍历注册表？我知道这并没有给你一个关于你的 Excel 实例正在使用什么的快照，而是一个新实例将使用什么 - 但取决于你需要它的用途，它可能已经足够好了。

相关键是：

```
'Active add-ins are in values called OPEN*
HKEY_CURRENT_USER\Software\Microsoft\Office\12.0\Excel\Options

'Inactive add-ins are in values of their full path
HKEY_CURRENT_USER\Software\Microsoft\Office\12.0\Excel\Add-in Manager 
```

# git - Git - 与克隆工作副本相同的主工作副本

> ID：287081
> 
> 赞同：1
> 
> 时间：2008-11-13T14:31:05.947
> 
> 标签：git

我对克隆的 git 存储库进行了很多更改。现在我希望主人看起来与克隆副本完全一样 - 我需要执行什么命令才能使主人与克隆同步？

**重复：** [Git - 将更改从克隆拉回主服务器](https://stackoverflow.com/questions/286988/git-pulling-changes-from-clone-back-onto-the-master)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T14:49:28.173

Assuming you cloned the repository with:

```
git clone >>wherever<< 
```

you push it back (from the copy) with:

```
git push origin master 
```

Note that *master* stands for master branch of your repository and *origin* is automatically created reference to the original repository.

# python - *args 和 **kwargs 是什么意思？

> ID：287085
> 
> 赞同：281
> 
> 时间：2008-11-13T14:33:51.947
> 
> 标签：python

究竟是什么`*args`意思`**kwargs`？

根据 Python 文档，从表面上看，它传入了一个参数元组。

```
def foo(hello, *args):
    print hello

    for each in args:
        print each

if __name__ == '__main__':
    foo("LOVE", ["lol", "lololol"]) 
```

这打印出来：

```
LOVE
['lol', 'lololol'] 
```

你如何有效地使用它们？

* * *

## 回答 #1

> 赞同：268
> 
> 时间：2008-11-13T14:41:27.313

将`*args`和/或`**kwargs`作为函数定义的参数列表中的最后一项允许该函数接受任意数量的参数和/或关键字参数。

例如，如果你想编写一个返回所有参数总和的函数，无论你提供多少参数，你都可以这样写：

```
def my_sum(*args):
    return sum(args) 
```

它可能更常用于面向对象的编程中，当您重写一个函数并希望使用用户传入的任何参数调用原始函数时。

您实际上不必调用它们`args`and `kwargs`，这只是一个约定。它是`*`and`**`做魔法。

官方 Python 文档有[更深入的外观](http://docs.python.org/2/tutorial/controlflow.html#more-on-defining-functions)。

* * *

## 回答 #2

> 赞同：94
> 
> 时间：2008-11-13T15:44:56.767

此外，我们使用它们来管理继承。

```
class Super( object ):
   def __init__( self, this, that ):
       self.this = this
       self.that = that

class Sub( Super ):
   def __init__( self, myStuff, *args, **kw ):
       super( Sub, self ).__init__( *args, **kw )
       self.myStuff= myStuff

x= Super( 2.7, 3.1 )
y= Sub( "green", 7, 6 ) 
```

这样 Sub 并不真正知道（或关心）超类初始化是什么。如果您意识到您需要更改超类，您可以解决问题，而无需费心处理每个子类中的细节。

* * *

## 回答 #3

> 赞同：71
> 
> 时间：2008-11-13T17:23:43.557

[请注意S.Lott 的评论](https://stackoverflow.com/questions/287085/what-does-args-and-kwargs-mean#287293)中很酷的一点——您还可以调用带有`*mylist`和解`**mydict`包位置和关键字参数的函数：

```
def foo(a, b, c, d):
  print a, b, c, d

l = [0, 1]
d = {"d":3, "c":2}

foo(*l, **d) 
```

将打印：`0 1 2 3`

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2008-11-13T17:31:35.863

`*args`and的另一个好用处`**kwargs`：你可以定义通用的“catch all”函数，这对于你返回这样一个包装器而不是原始函数的装饰器来说非常有用。

一个简单的缓存装饰器的例子：

```
import pickle, functools
def cache(f):
  _cache = {}
  def wrapper(*args, **kwargs):
    key = pickle.dumps((args, kwargs))
    if key not in _cache:
      _cache[key] = f(*args, **kwargs) # call the wrapped function, save in cache
    return _cache[key] # read value from cache
  functools.update_wrapper(wrapper, f) # update wrapper's metadata
  return wrapper

import time
@cache
def foo(n):
  time.sleep(2)
  return n*2

foo(10) # first call with parameter 10, sleeps
foo(10) # returns immediately 
```

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2013-06-23T14:41:37.107

只是为了澄清如何解包参数，并处理丢失的参数等。

```
def func(**keyword_args):
  #-->keyword_args is a dictionary
  print 'func:'
  print keyword_args
  if keyword_args.has_key('b'): print keyword_args['b']
  if keyword_args.has_key('c'): print keyword_args['c']

def func2(*positional_args):
  #-->positional_args is a tuple
  print 'func2:'
  print positional_args
  if len(positional_args) > 1:
    print positional_args[1]

def func3(*positional_args, **keyword_args):
  #It is an error to switch the order ie. def func3(**keyword_args, *positional_args):
  print 'func3:'
  print positional_args
  print keyword_args

func(a='apple',b='banana')
func(c='candle')
func2('apple','banana')#It is an error to do func2(a='apple',b='banana')
func3('apple','banana',a='apple',b='banana')
func3('apple',b='banana')#It is an error to do func3(b='banana','apple') 
```

# api - API 的代码覆盖率目标

> ID：287089
> 
> 赞同：1
> 
> 时间：2008-11-13T14:36:04.050
> 
> 标签：api, code-coverage

对于想要 API 代码覆盖率的具体目标数字的人，您会给多少数字？

更新：为了澄清语句/行代码覆盖率。我意识到具体数字没有多大意义，但这是针对您告诉人们具体数字没有多大意义而他们无论如何都坚持要从您那里获得数字的情况。我专门编写了 API/SDK，因为有些人可能会发现应用程序/GUI 级软件更容易接受较低的代码覆盖率，而不是暴露更多接口的库。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-13T14:47:36.803

实际上，具体数字没有多大意义。

如果有 14 个等效案例，如果您不测试所有 14 个案例，您的测试是否更容易出错？如果您有一个不可能失败的边界检查怎么办（我喜欢在这些情况下抛出描述性异常，然后通过电子邮件发送给我们的开发人员）？

最好确保覆盖所有逻辑路径。

有关更详细的答案，请参阅[这个（非常相似的）问题](https://stackoverflow.com/questions/90002/what-is-a-reasonable-code-coverage-for-unit-tests-and-why)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T14:47:58.737

我会给他们的建议是，他们需要检查 API 的各个部分，以确定哪些实际上无关紧要并且需要不超过 20%，哪些部分非常关键并且需要 > 90%。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-25T01:01:26.330

如果您使用的是 PHP，80% 似乎是一个不错的建议：http: [//jordionsoftware.blogspot.com/2009/09/code-coverage-targets.html](http://jordionsoftware.blogspot.com/2009/09/code-coverage-targets.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T14:51:27.700

Take a look at C.R.A.P. -- it combines coverage with complexity analysis. There is a [Crap4J](http://www.crap4j.org/) implementation if you are Java. We have been putting together a Crap4Net that we blogged about here:

[http://www.atalasoft.com/cs/blogs/insertqualityhere/archive/2008/03/28/crap4j-port-to-net.aspx](http://www.atalasoft.com/cs/blogs/insertqualityhere/archive/2008/03/28/crap4j-port-to-net.aspx)

The idea is that you get good numbers if you have small simple methods or if the more complex ones have good coverage.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-20T08:39:11.527

您可以获得一些代码覆盖率工具来为您提供“功能覆盖率”，例如，是否执行了某个功能。我坚持要涵盖 API 中的每个函数。

API 实现内部的行覆盖是另一回事。好的做法建议根据行或语句和总大小拍摄 70-80% 的覆盖率。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-16T23:23:39.223

忘记代码覆盖率。只是一个数字，不能作为测试代码的重点。场景必须是焦点，然后是高质量的 API。我知道这听起来可能是胡说八道，但您必须将思维方式从代码覆盖转变为场景：您是否正在测试您的 API 打算处理的大量场景？

代码覆盖率将有助于检测您是否遗漏了一些场景，如果您编写了很多好的场景，您将拥有接近 100% 的覆盖率，但同样，它只是一个数字，不能成为您的重点。

亲切的问候

# design-patterns - 我可以使用什么架构来处理每个产品需要保存不同属性的购物车

> ID：287093
> 
> 赞同：4
> 
> 时间：2008-11-13T14:37:08.087
> 
> 标签：design-patterns, architecture

我正在构建一个与购物车非常相似的应用程序。用户从列表中选择一个产品，然后基于该产品，需要设置和保存一些属性。

例子。

如果用户选择允许自定义颜色匹配的涂料类型，那么我必须允许他们输入他们通过颜色匹配过程收到的配方编号。所以我有一个产品的订单详细信息项目，它是一种油漆类型，并且该 sku 具有“AllowsCustomColorMatch”属性，但我还需要将公式编号存储在某处。

我不确定如何在我的代码中优雅地处理这个问题。我应该创建子类还是产品？现在，我将用户输入的数据保存在 OrderDetails 对象中，该对象引用了与之关联的 Product。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-13T14:47:28.130

您可以拥有一个包含产品属性集合的 Product 类

```
 public class Product
    {
        private Dictionary<string, string> properties;

        /// <summary>
        /// Gets or sets the name.
        /// </summary>
        /// <value>The name.</value>
        public string Name
        {
            get;
            set;
        }

        /// <summary>
        /// Gets or sets the price.
        /// </summary>
        /// <value>The price.</value>
        public double Price
        {
            get;
            set;
        }

        public Dictionary<string, string> Properties
        {
            get;
        }

        public Product()
        {
            properties = new Dictionary<string, string>();
        }

    } 
```

在数据源中，您可以拥有一个定义每种产品类型的属性的表。然后，当您呈现页面时，您就知道要显示哪些属性以及要在字典中给出的名称。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T14:52:28.727

我会避免为每种产品开设课程。您的每个产品都是同一产品类的*实例*。

有了这样的可变属性，字典方法（基本上是键值对的映射，类型特定与否，是保持设计灵活性的好方法。你不是在谈论 amazon.com 大小的产品库存，所以我认为对于您需要的性能，这是一个足够好的设计。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-29T03:05:12.020

取决于您如何设置当前对象；我会创建 2 个 Paint 类。第一个 Paint 类采用paint 中的所有常见属性/字段。然后我会创建第二个类，我们称之为 PaintSpecialize。PaintSpecialize 将继承自 Paint（为此类提供所有 Paint 的属性和方法）。然后，在 PaintSpecialize 中，您可以将 Formula 属性添加到类中。之后，这只是铸造对象的问题。C# 例如：

```
public class Paint {
private decimal _price;
private bool _allowFormula;

public Paint() { ... }
public Paint(int price) {
   _price = price;
}
public ChangePrice(decimal p) {
      _price = p;
   }
} 
```

等等。

PaintSpecialize 看起来像这样：

```
public class PaintSpecialize : Paint {
string _formula;
[...]
public PaintSpecialize(int price, string formula) : base(price) {
   _formula=formula;
} 
```

在代码中之后，可以：

```
PaintSpecialize ps  = new PaintSpecialize(15.00, "FormulaXXYY");
ps.ChangePrice(12.00);
List<Paint> plist = new List<Paint>();
plist.Add((Paint)ps);
foreach(Paint p in plist) {
if(p.AllowFormula) {
  PaintSpecialize tmp = (PaintSpecialize)p;
  MessageBox.Show(tmp._formula);
} 
```

上面的代码简单（而且不是很完整）看看你可以用油漆做什么。该列表现在可以同时包含 Paint 和 PaintSpecialize，只要后者正确转换即可。您可以随时简单地操作列表中的 PaintSpecialize，方法是将其从简单的 Paint 转换为 PaintSpecialize。

因此，如果客户想要常规绘画，请创建一个 Paint 对象，如果他想要自定义绘画，请创建一个 PaintSpecialize。如果客户想要一种常规和定制的油漆，请创建每种油漆。将它们都称为 Paint，直到您需要使用 PaintSpecialize 类中的某些内容。

请注意，应在基类中设置 AllowsCustomColorMatch 属性，否则您可能需要更加努力地确定该类是否属于 PaintSpecialize 类型。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-29T03:15:11.207

由于您正在寻找一个优雅的解决方案，您可能想看看 Adaptive Object-Model Architectural 风格。你可以[在这里](http://www.adaptiveobjectmodel.com/)搜索，或者[在这里](http://scholar.google.pt/scholar?q=adaptive+object+model&hl=en&lr=&btnG=Search)。基本上，您的问题可以通过简单地使用 TypeSquare 模式来解决，也许使用业务规则的解释器模式（如果它变得那么复杂）。

# database - 库存数据库设计

> ID：287097
> 
> 赞同：78
> 
> 时间：2008-11-13T14:38:52.140
> 
> 标签：database, inventory

这是一个与“编程”无关的问题（不是特定于任何语言或数据库），而是更多的设计和体系结构。这也是“什么是做 X 的最佳方式”类型的问题。我希望不会引起太多“宗教”争议。

在过去，我开发了一种系统，以一种或另一种方式保留某种形式的项目库存（与哪些项目无关）。一些使用不支持事务的语言/数据库。在这些情况下，我选择不在项目记录的字段中保存*手头的项目数量。*相反，现有*数量*是计算收到的总库存 - 已售库存的总和。由于软件，这导致库存几乎没有差异。这些表已正确索引并且性能良好。如果记录量开始影响性能，则会有一个归档过程。

现在，几年前我开始在这家公司工作，我继承了一个跟踪库存的系统。但是数量保存在一个字段中。注册条目后，收到的数量将添加到项目的数量字段中。当一件商品售出时，数量会被减去。这导致了分歧。在我看来，这不是正确的方法，但这里以前的程序员发誓。

我想知道对于设计这样的系统的正确方法是否有共识。还有什么可用的资源，印刷的或在线的，以寻求这方面的指导。

谢谢

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2008-11-13T14:47:24.917

我在我现在的公司看到了这两种方法，并且肯定会倾向于第一种（根据股票交易计算总数）。

如果您只在某个字段中存储总数量，您将不知道您是如何得出该数字的。没有交易历史记录，您最终可能会遇到问题。

我编写的最后一个系统通过将每笔交易存储为具有正数或负数的记录来跟踪库存。我发现它工作得很好。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-11-13T16:10:05.437

*   [数据模型资源书，卷。1：适用于所有企业的通用数据模型库](https://rads.stackoverflow.com/amzn/click/com/0471380237)
*   [数据模型资源书，卷。2：特定行业的数据模型库](https://rads.stackoverflow.com/amzn/click/com/0471353485)
*   [数据模型资源书：数据建模的通用模式](https://rads.stackoverflow.com/amzn/click/com/0470178450)

我有第 1 卷和第 2 卷，这些在过去很有帮助。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-11-13T14:50:07.423

视情况而定，库存系统不仅仅是对物品进行计数。例如，出于会计目的，您可能需要了解基于 FIFO（先进先出）模型的库存会计价值。这不能通过简单的“收到的总库存 - 售出的总库存”公式来计算。但是他们的模型可能会很容易地计算出这一点，因为他们会随时修改会计价值。我不想详细说明，因为这不是编程问题，但如果他们发誓，也许你没有完全理解他们必须满足的所有要求。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-13T15:29:30.213

两者都是有效的，视情况而定。当以下条件成立时，前者是最好的：

*   要求和的项目数相对较少
*   很少或没有特殊情况需要考虑（退货、调整等）
*   库存项目数量不是经常需要

另一方面，如果你有大量的物品，有几个例外情况，并且经常访问，那么保持物品数量会更有效率

另请注意，如果您的系统存在差异，则*它存在*应追踪和消除的错误

我已经完成了两种方式的系统，两种方式都可以正常工作 - 只要你不忽略错误！

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-13T15:07:26.717

重要的是要考虑现有系统以及更改它的成本和风险。我使用的数据库存储类似于您的库存，但它包括审计周期和存储调整，就像收据一样。它似乎运作良好，但所涉及的每个人都训练有素，而且仓库工作人员学习新程序的速度并不快。

在您的情况下，如果您正在寻找更多跟踪而不更改整个数据库结构，那么我建议添加一个跟踪表（类似于您的“事务”解决方案），然后将更改记录到库存级别。将大多数更改更新到库存级别应该不会太难，以便它们也留下交易记录。您还可以添加一个定期任务以每隔几个小时左右将库存级别备份到事务表中，这样即使您错过了一个事务，您也可以发现更改发生的时间或回滚到以前的状态。

如果您想了解大型应用程序如何查看[SugarCRM](http://www.sugarcrm.com)，他们有库存管理模块，但我不确定它如何存储数据。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-13T15:32:23.547

我认为这实际上是一个一般的最佳实践问题，关于每次需要总数时进行（相对）昂贵的计数与每次发生变化时进行计数，然后将计数存储在字段中并在需要时读取该字段全部的。

如果我不能使用事务，我会在每次需要总数时使用实时计数。如果交易可用，则可以安全地执行库存更新操作并在同一交易中保存重新盘点的总数，这将确保计数的准确性（尽管我不确定这是否适用于多个用户打数据库）。

但是，如果性能不是一个真正的大问题（并且现代数据库在计算行数方面足够好，我什至很少担心这一点），我每次都会坚持使用实时计数。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-11-13T14:46:10.737

我会选择第一种方式，在哪里

> 现有数量是根据收到的总库存计算的 - 已售库存的总和

正确的方式，国际海事组织。

**编辑：**我还想将系统中的任何库存损失/损坏考虑在内，但我相信你已经涵盖了。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-13T16:31:01.603

我以前研究过解决这个问题的系统。我认为理想的解决方案是预先计算的列，它可以让您两全其美。您的总数将是某处的一个字段，因此无需昂贵的查找，但它不能与您的其余数据不同步（数据库保持完整性）。我不记得哪些 RDMS 支持预先计算的列，但如果您没有事务，那也可能不可用。

您可能会使用触发器伪造预先计算的列（非常有效......我认为没有缺点）。不过，您可能需要交易。恕我直言，在进行这种受控非规范化时保持数据完整性是触发器的唯一合法用途。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-10-03T05:22:35.177

[Django-inventory](http://code.google.com/p/django-inventory/)更适合固定资产，但可能会给你一些想法。

IE：ItemTemplate（类）-> ItemsOnHand（实例）

ItemsOnHand 可以链接到更多的 ItemTemplates；示例打印机和墨盒是必需的。这也允许为每个 ItemOnHand 设置重新订购点。

每个 ItemsOnHand 都链接到 InventoryTransactions，这样便于审计。为了避免从数千个库存交易中计算实际的现有项目，使用了只是余额 + 日期的检查点。计算手头上的项目以查找最近的检查点并开始添加或减去项目以查找当前的项目余额。定期定义新的检查点。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-13T15:10:44.760

我可以看到拥有两列的一些好处，但我没有关注关于差异的部分 - 您似乎暗示拥有两列（进出）比单列（当前）更不容易出现差异。这是为什么？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-13T15:39:18.743

没有一两列，我的意思是“收到的总库存 - 售出的总库存”是这样的：

```
Select sum(quantity) as inventory_received from Inventory_entry
Select sum(quantity) as inventory_sold from Sales_items 
```

然后

```
Qunatity_on_hand = inventory_received - inventory_sold 
```

请记住，我过度简化了这一点和我最初的解释。我知道库存还有更多只是跟踪数量，但在这种情况下，这就是问题所在，也是我们想要解决的问题。此时改变它的原因恰恰是支持当前设计引起的问题的成本。

我还想提一下，虽然这不是“编码”问题，但与算法和设计有关，恕我直言，这是非常重要的主题。

到目前为止，感谢大家的回答。

纳尔逊马尔莫尔

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-13T15:55:11.083

我们解决不同的问题，但我们处理其中一些问题的方法可能会让您感兴趣。

我们允许系统做出“最佳猜测”，并定期向用户提供关于任何看起来错误的猜测的反馈。

要将其应用于库存，您可以有 3 个字段：

```
inventory_received
inventory_sold
estimated_on_hand 
```

然后，您可以按照以下方式运行一个流程（每天？）：

```
SELECT * 
FROM   Inventory
WHERE  estimated_on_hand != inventory_received - inventory_sold 
```

当然，这取决于用户查看此警报并对其采取措施。

此外，您可以通过更新inventory_sold/received 或添加另一个字段“inventory_adjustment”来以某种方式重置库存，这可能是正数或负数。

...只是一些想法。希望它有帮助。

# ssl - 在 Active Directory 中设置 SSL 操作方法

> ID：287100
> 
> 赞同：7
> 
> 时间：2008-11-13T14:41:26.597
> 
> 标签：ssl, active-directory, ldap, adam, lds

我需要通过 Active Directory 设置 SSL。我用谷歌搜索了很多，但找不到一篇关于如何做到这一点的像样的文章。如果你知道一些关于这方面的好资源，请告诉我。谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-15T00:09:41.347

听起来很容易——但我遇到了很多问题，让 SSL 在我们的环境中工作的可信连接。这篇文章是关于 ADAM 的，但同样适用于 AD。在我们的环境中，我无法安装与域相关的服务，如 cert-server，也无法充当域管理员。

我在博客上写过我是如何让这个工作的

> [http://stephbu.wordpress.com/2006/11/29/using-adam-with-asp-net-2-0-activedirectorymembershipprovider/](http://stephbu.wordpress.com/2006/11/29/using-adam-with-asp-net-2-0-activedirectorymembershipprovider/)

Dan 和 Erlend 的帖子非常宝贵。

做了一些后空翻来完成它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T16:08:49.457

轻量级目录访问协议 (LDAP) 用于读取和写入 Active Directory。默认情况下，LDAP 流量是不安全地传输的。您可以使用安全套接字层 (SSL) / 传输层安全 (TLS) 技术使 LDAP 流量保密且安全。根据本文中的指南，您可以通过从 Microsoft 证书颁发机构 (CA) 或非 Microsoft CA 安装格式正确的证书来启用 LDAP over SSL (LDAPS)。

[http://support.microsoft.com/kb/321051](http://support.microsoft.com/kb/321051)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-15T00:03:38.223

你可以说得更详细点吗。客户想做什么？Active Directory 默认支持 ldap over ssl。没有什么可以激活它。它在端口 636/tcp 中完成。[http://technet.microsoft.com/en-us/library/bb727063.aspx](http://technet.microsoft.com/en-us/library/bb727063.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T10:18:23.317

将 SSL 安装到 AD 中绝对最快的方法是加载 MS 证书服务。安装后，所有域控制器将自动请求新证书并自行更新...

# mysql - MySQL去除非数字字符进行比较

> ID：287105
> 
> 赞同：51
> 
> 时间：2008-11-13T14:43:20.977
> 
> 标签：mysql, regex

我正在寻找与用户输入的特定数字匹配的表中的记录。因此，用户可以输入 12345，但这可能是数据库中的 123zz4-5。

我想这样的事情会起作用，如果 PHP 函数在 MySQL 中工作。

```
SELECT * FROM foo WHERE preg_replace("/[^0-9]/","",bar) = '12345' 
```

仅使用 MySQL 的等效功能或方法是什么？

*速度并不重要。*

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2012-08-21T14:40:17.753

我意识到这是一个古老的话题，但是在谷歌搜索这个问题时我找不到一个简单的解决方案（我看到了古老的代理，但认为这是一个更简单的解决方案）所以这是我写的一个函数，似乎工作得很好。

```
DROP FUNCTION IF EXISTS STRIP_NON_DIGIT;
DELIMITER $$
CREATE FUNCTION STRIP_NON_DIGIT(input VARCHAR(255))
   RETURNS VARCHAR(255)
BEGIN
   DECLARE output   VARCHAR(255) DEFAULT '';
   DECLARE iterator INT          DEFAULT 1;
   WHILE iterator < (LENGTH(input) + 1) DO
      IF SUBSTRING(input, iterator, 1) IN ( '0', '1', '2', '3', '4', '5', '6', '7', '8', '9' ) THEN
         SET output = CONCAT(output, SUBSTRING(input, iterator, 1));
      END IF;
      SET iterator = iterator + 1;
   END WHILE;
   RETURN output;
END
$$ 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2016-03-10T18:19:07.857

上面最受欢迎的[答案](https://stackoverflow.com/a/12057337/1393894)并不是最快的。
对他们提出工作建议以反弹表示完全的敬意！

这是一个改进的版本：

```
DELIMITER ;;
DROP FUNCTION IF EXISTS `STRIP_NON_DIGIT`;;

CREATE DEFINER=`root`@`localhost` FUNCTION `STRIP_NON_DIGIT`(input VARCHAR(255)) RETURNS VARCHAR(255) CHARSET utf8
READS SQL DATA
BEGIN
   DECLARE output    VARCHAR(255) DEFAULT '';
   DECLARE iterator  INT          DEFAULT 1;
   DECLARE lastDigit INT          DEFAULT 1;
   DECLARE len       INT;

   SET len = LENGTH(input) + 1;
   WHILE iterator < len DO
      -- skip past all digits
      SET lastDigit = iterator;
      WHILE ORD(SUBSTRING(input, iterator, 1)) BETWEEN 48 AND 57 AND iterator < len DO
         SET iterator = iterator + 1;
      END WHILE;

      IF iterator != lastDigit THEN
         SET output = CONCAT(output, SUBSTRING(input, lastDigit, iterator - lastDigit));
      END IF;

      WHILE ORD(SUBSTRING(input, iterator, 1)) NOT BETWEEN 48 AND 57 AND iterator < len DO
         SET iterator = iterator + 1;
      END WHILE;
   END WHILE;

   RETURN output;
END;; 
```

在测试服务器上测试 5000 次：

```
-- original
Execution Time : 7.389 sec
Execution Time : 7.257 sec
Execution Time : 7.506 sec

-- ORD between not string IN
Execution Time : 4.031 sec

-- With less substrings
Execution Time : 3.243 sec
Execution Time : 3.415 sec
Execution Time : 2.848 sec 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2018-05-04T14:07:51.450

你可以轻松地做你想做的事`REGEXP_REPLACE`（兼容 MySQL 8+ 和 MariaDB 10.0.5+）

> `REGEXP_REPLACE(expr, pat, repl[, pos[, occurrence[, match_type]]])`
> 
> 用替换字符串 repl 替换字符串 expr 中匹配由模式 pat 指定的正则表达式的匹配项，并返回结果字符串。如果 expr、pat 或 repl 为 NULL，则返回值为 NULL。
> 
> 转到 REGEXP_REPLACE 文档：[MySQL](https://dev.mysql.com/doc/refman/8.0/en/regexp.html#function_regexp-replace)或[MariaDB](https://mariadb.com/kb/en/library/regexp_replace/)

**尝试一下：**

```
SELECT REGEXP_REPLACE('123asd12333', '[a-zA-Z]+', ''); 
```

**输出：**

```
12312333 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-13T15:23:23.987

虽然它不漂亮并且显示的结果不匹配，但这有助于：

```
SELECT * FROM foo WHERE bar LIKE = '%1%2%3%4%5%' 
```

我仍然想找到一个更好的解决方案，类似于原始问题中的项目。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-11-13T15:57:39.110

没有正则表达式替换，只有纯字符串 REPLACE()。

MySQL 有 REGEXP 运算符，但它只是一个匹配测试器而不是一个替换器，所以你必须把逻辑从里到外：

```
SELECT * FROM foo WHERE bar REGEXP '[^0-9]*1[^0-9]*2[^0-9]*3[^0-9]*4[^0-9]*5[^0-9]*'; 
```

这就像您的 LIKE 版本，但匹配更准确。两者的表现同样糟糕，需要在没有索引的情况下进行全表扫描。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-13T14:59:50.290

我能想到的最简单的方法是使用 MySQL REGEXP 运算符 a la：

```
WHERE foo LIKE '1\D*2\D*3\D*4\D*5' 
```

它不是特别漂亮，但 MySQL 没有`preg_replace`功能，所以我认为它是你能得到的最好的。

就个人而言，如果这个只有数字的数据如此重要，我会保留一个单独的字段来包含剥离的数据。它将使您的查找比使用正则表达式搜索快得多。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2012-03-01T00:05:36.067

这篇博文详细介绍了如何通过 MySQL 函数从字符串中去除非数字字符：

`SELECT NumericOnly("asdf11asf");`

返回`11`

[http://venerableagents.wordpress.com/2011/01/29/mysql-numeric-functions/](http://venerableagents.wordpress.com/2011/01/29/mysql-numeric-functions/)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2019-07-10T20:54:22.130

在 MySQL 8.0+ 上，有一个名为 REGEXP_REPLACE 的新本机函数。这个问题的一个干净的解决方案是：

```
SELECT * FROM foo WHERE REGEXP_REPLACE(bar,'[^0-9]+',"") = '12345' 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-13T15:33:37.740

就我而言，没有正则表达式替换，但我找到了这个解决方案；

```
--Create a table with numbers
DROP TABLE IF EXISTS ints;
CREATE TABLE ints (i INT UNSIGNED NOT NULL PRIMARY KEY);

INSERT INTO ints (i) VALUES
( 1), ( 2), ( 3), ( 4), ( 5), ( 6), ( 7), ( 8), ( 9), (10),
(11), (12), (13), (14), (15), (16), (17), (18), (19), (20);

--Then extract the numbers from the specified column
SELECT
    bar,
    GROUP_CONCAT(SUBSTRING(bar, i, 1) ORDER BY i SEPARATOR '')
FROM foo
JOIN ints ON i BETWEEN 1 AND LENGTH(bar)
WHERE
    SUBSTRING(bar, i, 1) IN ('0', '1', '2', '3', '4', '5', '6', '7', '8', '9')
GROUP BY bar; 
```

它对我有用，我使用 MySQL 5.0

我还发现这个[地方](http://www.php-groupies.de/blogs/archives/17-Regular-Expression-Functions-for-MySQL.html)可以提供帮助。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-11-18T20:32:38.063

我有类似的情况，将产品与有时不存储任何字母数字的条形码进行匹配，因此在搜索 1022234 时需要在数据库中找到 102.2234。

最后，我只是在产品表中添加了一个新字段 reference_number，并让 php 在添加新产品时删除 product_number 中的非字母数字以填充 reference_number。

您需要对表进行一次扫描，以便为现有产品创建所有 reference_number 字段。

然后，您可以设置索引，即使速度不是此操作的一个因素，保持数据库运行良好仍然是一个好主意，这样该查询就不会拖慢它并减慢其他查询。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2014-12-05T02:08:38.520

我遇到了这个解决方案。user1467716 的最佳答案将在 phpMyAdmin 中使用，只需稍作改动：在代码末尾添加第二个分隔符标记。

phpMyAdmin 版本为 4.1.14；MySQL 版本 5.6.20

我还使用添加了一个长度限制器

`DECLARE count INT DEFAULT 0;`在声明中

`AND count < 5`在`WHILE`声明中

`SET COUNT=COUNT+1;`在`IF`声明中

最终形式：

```
DROP FUNCTION IF EXISTS STRIP_NON_DIGIT;
DELIMITER $$
CREATE FUNCTION STRIP_NON_DIGIT(input VARCHAR(255))
   RETURNS VARCHAR(255)
BEGIN
   DECLARE output   VARCHAR(255) DEFAULT '';
   DECLARE iterator INT          DEFAULT 1;
   DECLARE count INT DEFAULT 0;
   WHILE iterator < (LENGTH(input) + 1) AND count < 5 DO --limits to 5 chars
      IF SUBSTRING(input, iterator, 1) IN ( '0', '1', '2', '3', '4', '5', '6', '7', '8', '9' ) THEN
         SET output = CONCAT(output, SUBSTRING(input, iterator, 1));
         SET COUNT=COUNT+1;
      END IF;
      SET iterator = iterator + 1;
   END WHILE;
   RETURN output;
END
$$
DELIMITER $$ --added this 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-13T15:36:02.273

带 foo 的桌子有多大？如果它很小，而且速度真的无关紧要，您可能会提取行 ID 和 foo，使用 PHP 替换函数对其进行循环比较，然后按行号提取您想要的信息。

当然，如果表太大，这将无法正常工作。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-08-03T05:26:32.623

试试这个例子。这用于电话号码，但是您可以根据需要对其进行修改。

```
 -- function removes non numberic characters from input
-- returne only the numbers in the string

CREATE DEFINER =`root`@`localhost` FUNCTION `remove_alpha`(inputPhoneNumber VARCHAR(50))
  RETURNS VARCHAR(50)
  CHARSET latin1
DETERMINISTIC
  BEGIN

    DECLARE inputLenght INT DEFAULT 0;
    -- var for our iteration 
    DECLARE counter INT DEFAULT 1;
    -- if null is passed, we still return an tempty string
    DECLARE sanitizedText VARCHAR(50) DEFAULT '';
    -- holder of each character during the iteration
    DECLARE oneChar VARCHAR(1) DEFAULT '';

    -- we'll process only if it is not null.
    IF NOT ISNULL(inputPhoneNumber)
    THEN
      SET inputLenght = LENGTH(inputPhoneNumber);
      WHILE counter <= inputLenght DO
        SET oneChar = SUBSTRING(inputPhoneNumber, counter, 1);
        IF (oneChar REGEXP ('^[0-9]+$'))
        THEN
          SET sanitizedText = Concat(sanitizedText, oneChar);
        END IF;

        SET counter = counter + 1;
      END WHILE;
    END IF;

    RETURN sanitizedText;
      END 
```

* * *

使用此用户定义函数 (UDF)。假设您有一列电话号码：

```
col1
(513)983-3983
1-838-338-9898
phone983-889-8383 
```

* * *

```
select remove_alpha(col1) from mytable 
```

* * *

结果是；

```
5139833983
18383389898
9838898383 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2019-02-27T01:09:00.200

以为我会分享这个，因为我从这里建立了它的功能。我重新排列只是为了更容易阅读（我只是服务器端）。

您可以通过传入表名和列名来调用它，以使其从该列中删除所有现有的非数字字符。我继承了许多将大量 int 字段作为 varchar 的不良表结构，因此我需要一种方法来快速清理这些字段，然后才能将列修改为整数。

```
drop procedure if exists strip_non_numeric_characters;
DELIMITER ;;

CREATE PROCEDURE `strip_non_numeric_characters`(
    tablename varchar(100)
    ,columnname varchar(100)
    )
BEGIN

-- =============================================
-- Author:      <Author,,David Melton>
-- Create date: <Create Date,,2/26/2019>
-- Description: <Description,,loops through data and strips out the bad characters in whatever table and column you pass it>
-- =============================================

#this idea was generated from the idea STRIP_NON_DIGIT function
#https://stackoverflow.com/questions/287105/mysql-strip-non-numeric-characters-to-compare

declare input,output varchar(255);
declare iterator,lastDigit,len,counter int;
declare date_updated varchar(100);

select column_name 
    into date_updated
    from information_schema.columns 
    where table_schema = database() 
    and extra rlike 'on update CURRENT_TIMESTAMP'
    and table_name = tablename
    limit 1;

#only goes up to 255 so people don't run this for a longtext field
#just to be careful, i've excluded columns that are part of keys, that could potentially mess something else up
set @find_column_length = 
concat("select character_maximum_length
    into @len
    from information_schema.columns
    where table_schema = '",database(),"'
    and column_name = '",columnname,"'
    and table_name = '",tablename,"'
    and length(ifnull(character_maximum_length,100)) < 255
    and data_type in ('char','varchar')
    and column_key = '';");

prepare stmt from @find_column_length;
execute stmt;
deallocate prepare stmt;

set counter = 1;        
set len = @len;

while counter <= ifnull(len,1) DO

    #this just removes it by putting all the characters before and after the character i'm looking at
    #you have to start at the end of the field otherwise the lengths don't stay in order and you have to run it multiple times
    set @update_query = 
    concat("update `",tablename,"`
        set `",columnname,"` = concat(substring(`",columnname,"`,1,",len - counter,"),SUBSTRING(`",columnname,"`,",len - counter,",",counter - 1,"))
        ",if(date_updated is not null,concat(",`",date_updated,"` = `",date_updated,"`
        "),''),
        "where SUBSTRING(`",columnname,"`,",len - counter,", 1) not REGEXP '^[0-9]+$';");

    prepare stmt from @update_query;
    execute stmt;
    deallocate prepare stmt;

    set counter = counter + 1;

end while;

END ;;
DELIMITER ; 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-01-22T03:14:09.540

要在字符串中搜索与特定数字模式匹配的数字，首先以类似于以下的方式删除所有字母和特殊字符，然后将值转换为整数，然后搜索

```
SELECT * 
FROM   foo 
WHERE  Convert(Regexp_replace(bar, '[a-zA-Z]+', ''), signed) = 12345 
```

# c# - LINQ-to-SQL：返回单个标量值的存储过程？

> ID：287106
> 
> 赞同：13
> 
> 时间：2008-11-13T14:43:35.627
> 
> 标签：c#, linq-to-sql

我正在将 LINQ-to-SQL 用于查询旧数据库的应用程序。我需要调用一个存储过程，它选择一个整数值。更改存储过程不是一种选择。

设计器使用此签名创建一个方法：

```
private ISingleResult<sp_xal_seqnoResult> NextRowNumber([Parameter(DbType="Int")] System.Nullable<int> increment, [Parameter(DbType="Char(3)")] string dataset) 
```

我希望返回类型为 int。如何使用 LINQ-to-SQL 做到这一点？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-13T14:49:46.050

对于标量函数 (UDF) 而不是 SP，这将是微不足道的。但是，它应该很容易工作 - 尽管如果 SP 很复杂（即 FMT_ONLY 不能 100% 检查它），那么您可能需要“帮助”它......

这是我从返回整数的简化 SP 生成的一些 dbml；您可以通过“使用... xml 编辑器打开”编辑 dbml：

```
<Function Name="dbo.foo" Method="foo">
    <Parameter Name="inc" Type="System.Int32" DbType="Int" />
    <Parameter Name="dataset" Type="System.String" DbType="VarChar(20)" />
    <Return Type="System.Int32" />
</Function> 
```

（请注意，您显然需要调整名称和数据类型）。

这是生成的 C#：

```
[Function(Name="dbo.foo")]
public int foo([Parameter(DbType="Int")] System.Nullable<int> inc, [Parameter(DbType="VarChar(20)")] string dataset)
{
    IExecuteResult result = this.ExecuteMethodCall(this, ((MethodInfo)(MethodInfo.GetCurrentMethod())), inc, dataset);
    return ((int)(result.ReturnValue));
} 
```

如果您当前的 SP 使用 SELECT（而不是 RETURN），那么 DBML 将需要反映这一点。您可以通过隐藏实现细节并在部分类中提供公共包装器来解决此问题；例如：

```
<Function Name="dbo.foo" Method="FooPrivate" AccessModifier="Private">
    <Parameter Name="inc" Type="System.Int32" DbType="Int" />
    <Parameter Name="dataset" Type="System.String" DbType="VarChar(20)" />
    <ElementType Name="fooResult" AccessModifier="Internal">
      <Column Name="value" Type="System.Int32" DbType="Int NOT NULL" CanBeNull="false" />
    </ElementType>
</Function> 
```

上面描述了一个返回单列单表的SP；但我已将 SP 设为数据上下文的“私有”，并将结果类型设为程序集的“内部”（隐藏它）：

```
[Function(Name="dbo.foo")]
private ISingleResult<fooResult> FooPrivate(
    [Parameter(DbType="Int")] System.Nullable<int> inc,
    [Parameter(DbType="VarChar(20)")] string dataset)
{
    IExecuteResult result = this.ExecuteMethodCall(this, ((MethodInfo)(MethodInfo.GetCurrentMethod())), inc, dataset);
    return ((ISingleResult<fooResult>)(result.ReturnValue));
} 
```

现在*在我自己的类文件中，*我可以在正确的命名空间中添加一个新的部分类（一个新的 .cs 文件），从而更方便地公开该方法：

```
namespace MyNamespace {
    partial class MyDataContext
    {
        public int Foo(int? inc, string dataSet)
        {
            return FooPrivate(inc, dataSet).Single().value;
        }
    }
} 
```

（命名空间和上下文名称需要与实际的数据上下文相同）。这添加了一个公共方法，该方法对调用者隐藏了蹩脚的细节。

**不要**直接编辑designer.cs文件；您的更改将丢失。只编辑 dbml 或部分类。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-12-07T19:04:24.433

RETURN @VALUE 作为 proc 的最后一条语句。

然后它将自动检测类型 int、string、bool 等并相应地生成包装方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-03-29T21:31:02.660

如果您在 Linq to SQL 类项目中使用 Visual Studio 的 .xsd 文件，请确保：

1.  右键单击适配器中的存储过程或函数调用。
2.  选择属性
3.  **将执行模式更改为标量**

这将使您的适配器函数返回类型为“对象”。然后，您需要将其转换为 int 或 string，或者它应该是的任何类型。

# .net - 如何从 .NET 发布 SOAP 请求？

> ID：287126
> 
> 赞同：30
> 
> 时间：2008-11-13T14:49:00.607
> 
> 标签：.net, xml, web-services, soap

我在 XML 文件中有 SOAP 请求。我想将请求发布到 .net 中的 Web 服务如何实现？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-13T15:12:41.697

```
var uri = new Uri("http://localhost/SOAP/SOAPSMS.asmx/add");

var req = (HttpWebRequest) WebRequest.CreateDefault(uri); 
req.ContentType = "text/xml; charset=utf-8"; 
req.Method = "POST"; 
req.Accept = "text/xml"; 
req.Headers.Add("SOAPAction", "http://localhost/SOAP/SOAPSMS.asmx/add"); 

var strSoapMessage = @"<?xml version='1.0' encoding='utf-8'?>
<soap:Envelope xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/' 
               xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' 
               xmlns:xsd='http://www.w3.org/2001/XMLSchema'>
  <soap:Body><add xmlns='http://tempuri.org/'><a>23</a><b>5</b></soap:Body>
</soap:Envelope>"; 

using (var stream = new StreamWriter(req.GetRequestStream(), Encoding.UTF8)) 
    stream.Write(strSoapMessage); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-13T15:18:11.797

I've done something like this, building an xml request manually and then using the webrequest object to submit the request:

```
string data = "the xml document to submit";
string url = "the webservice url";
string response = "the response from the server";

// build request objects to pass the data/xml to the server
byte[] buffer = Encoding.ASCII.GetBytes(data);
HttpWebRequest request = WebRequest.Create(url) as HttpWebRequest;
request.Method = "POST";
request.ContentType = "application/x-www-form-urlencoded";
request.ContentLength = buffer.Length;
Stream post = request.GetRequestStream();

// post data and close connection
post.Write(buffer, 0, buffer.Length);
post.Close();

// build response object
HttpWebResponse response = request.GetResponse() as HttpWebResponse;
Stream responsedata = response.GetResponseStream();
StreamReader responsereader = new StreamReader(responsedata);
response = responsereader.ReadToEnd(); 
```

The string variables at the start of the code are what you set, then you get a string response (hopefully...) from the server.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-13T14:56:57.517

This isn't the normal way. Usually you would use WCF or the older style web service reference to generate a proxy client for you.

However, what you need to do generally is use HttpWebRequest to connect to the URL and then send the XML in the body of the request.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-13T15:05:40.543

I'm wondering how's the XML generated and is it a valid SOAP message? You can post it via HTTP as suggested by the folks above.

If you want to test if that's going to work, you can give [SoapUI](http://www.soapui.org/) a try (for testing I mean).

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-14T04:32:08.443

这是另一个例子——这个在 VB 中：

```
 Dim manualWebClient As New System.Net.WebClient()

    manualWebClient.Headers.Add("Content-Type", "application/soap+xml;  charset=utf-8")

    ' Note: don't put the <?xml... tag in--otherwise it will blow up with a 500 internal error message!
    Dim bytArguments As Byte() = System.Text.Encoding.ASCII.GetBytes( _
        "<soap12:Envelope xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"" xmlns:xsd=""http://www.w3.org/2001/XMLSchema"" xmlns:soap12=""http://www.w3.org/2003/05/soap-envelope"">" & System.Environment.NewLine & _
        "  <soap12:Body>" & System.Environment.NewLine & _
        "    <Multiply xmlns=""http://cptr446.class/"">" & System.Environment.NewLine & _
        "      <x>5</x>" & System.Environment.NewLine & _
        "      <y>4</y>" & System.Environment.NewLine & _
        "    </Multiply>" & System.Environment.NewLine & _
        "  </soap12:Body>" & System.Environment.NewLine & _
        "</soap12:Envelope>")
    Dim bytRetData As Byte() = manualWebClient.UploadData("http://localhost/CPTR446.asmx", "POST", bytArguments)

    MessageBox.Show(System.Text.Encoding.ASCII.GetString(bytRetData)) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-02-25T09:44:23.600

很抱歉碰到了一个旧线程，这是我的解决方案

```
''' <summary>
''' Sends SOAP to a web service and sends back the XML it got back.
''' </summary>
Public Class SoapDispenser
    Public Shared Function CallWebService(ByVal WebserviceURL As String, ByVal SOAP As String) As XmlDocument
        Using wc As New WebClient()
            Dim retXMLDoc As New XmlDocument()

            wc.Headers.Add("Content-Type", "application/soap+xml; charset=utf-8")
            retXMLDoc.LoadXml(wc.UploadString(WebserviceURL, SOAP))

            Return retXMLDoc
        End Using
    End Function
End Class 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-13T14:53:50.910

You need to post the data over HTTP. Use the [WebRequest class](http://msdn.microsoft.com/en-us/library/debx8sh9.aspx) to post the data. You will need to send other data with the post request to ensure you have a valid SOAP envelope. Read the [SOAP spec](http://www.w3.org/TR/soap/) for all of the details.

# sql-server - 检索 SQL Server 全文索引词

> ID：287133
> 
> 赞同：17
> 
> 时间：2008-11-13T14:51:55.080
> 
> 标签：sql-server, full-text-search

使用 Lucene，可以检索索引中包含的术语，即索引中的文档包含的唯一的词干词，不包括停用词。这对于生成自动完成建议非常有用。MS SQL Server 全文索引是否有类似的可能？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-03T12:58:39.107

您可以使用 SQL Server 2008 中的新系统视图来获取术语和出现次数，这是您想要的吗？

```
sys.dm_fts_index_keywords_by_document
( 
    DB_ID('database_name'),     
    OBJECT_ID('table_name') 
) 
```

您需要提供全文表格的`db_id`和`object_id`。这是 MSDN 链接：[sys.dm_fts_index_keywords_by_document](http://msdn.microsoft.com/en-us/library/cc280607.aspx)。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-11-20T22:00:32.307

我同意这些信息（索引中的词、词干等）很有用——如果 SQL Server 认真考虑提供搜索平台，则需要公开这些信息。据我所知，它在以前的版本中确实不可用。但是，SQL Server 2008 中的游戏规则发生了变化。

SQL Server 2008 提供了新的动态管理视图，为全文提供了这种元数据。请特别注意 sys.dm_fts_parser 和 sys.dm_fts_index_keywords。

sys.dm_fts_parser 视图接收一个短语以及几个其他参数，并输出一个显示行集的表格，在分词器将它们视为单独的单词后显示单个单词的词干版本。

MSDN 给出了针对视图的此查询示例：

```
SELECT * FROM sys.dm_fts_parser (' "The Microsoft business analysis" ', 1033, 0, 0) 
```

要获取关键字，您可以使用 sys.dm_fts_index_keywords。

我希望这能为您指明正确的方向。干杯。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-09-17T19:23:08.410

使用以下内容，您可以将表名和列名作为变量。它将在它运行的当前数据库上工作，省略文件结尾结果并按出现次数降序排列结果。

请注意，必须在该表和列上启用全文索引

```
DECLARE @TableName NVARCHAR(200) = 'MyTable'
DECLARE @ColumnName NVARCHAR(200) = 'MyColumn'

SELECT DISTINCT(display_term), occurrence_count FROM sys.dm_fts_index_keywords_by_document
( 
    DB_ID(),     
    OBJECT_ID(@TableName) 
)
WHERE column_id =
(
    SELECT TOP 1 col.column_id FROM sys.objects obj
    INNER JOIN sys.columns col ON col.object_id = obj.object_id
    WHERE obj.name = @TableName
    AND col.name = @ColumnName
)
AND keyword != 0xFF
ORDER BY occurrence_count DESC 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-07-10T15:58:23.273

`sys.dm_fts_index_keywords`给出返回带有附加统计信息的索引词列表，而不是由于`sys.fulltext_stopwords`.

# java - 是否有基于 Java bean 生成网页的工具？

> ID：287137
> 
> 赞同：2
> 
> 时间：2008-11-13T14:53:16.603
> 
> 标签：java, web-applications, javabeans, pojo

**有没有一种工具可以带你使用 java bean (pojos) 并自动将它们变成网页的表单？**

更清楚地说，我有一堆 Jaxb 对象，我希望能够在表单中显示而无需编写一堆 html。是否有工具可以读取 jaxb 对象并为我生成可编辑表单？此外，这需要在 glassfish 服务器上运行......

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T15:08:48.477

如果我从字面上解释你的问题，那么你应该看看 ROMA 框架：[http](http://www.romaframework.org/) ://www.romaframework.org/ 。它尝试采用带有注释并自动生成用户界面的 POJO（bean）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T15:02:11.343

我认为这个问题的目的是

'如何呈现代表给定 bean 的所有字段的 HTML 表单 - 这将使我不必手动输入 HTML'

从理论上讲，这可以通过反射来实现，但要知道应该包含哪些字段总是很棘手，因此结果并不总是您想要的。

你能确认这个问题背后的动机吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T15:29:32.490

看看[Grails](http://grails.org)，特别是[Scaffolding](http://grails.org/Scaffolding)。这是一个 Groovy 框架，但您的 POJO 将直接插入。

# templates - 用于 Web 开发的快速入门基本布局/模板？

> ID：287141
> 
> 赞同：3
> 
> 时间：2008-11-13T14:55:05.057
> 
> 标签：templates

我正在寻找快速入门或模板或其他东西，以快速完成网站的基本布局并看起来相当专业，然后让我进行编码。我不想要一个 CMS，因为这是一个高度定制的报告应用程序，但我需要像框架标题和两列和框架页脚这样的东西。我可以自己为宽右栏设计漂亮的报告，作为左栏菜单。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-13T14:59:51.007

像 YUI Grids CSS 之类的东西？

[http://developer.yahoo.com/yui/grids/](http://developer.yahoo.com/yui/grids/)

还是蓝图 CSS？

[http://www.blueprintcss.org/](http://www.blueprintcss.org/)

还是 CSS 样板文件？

[http://code.google.com/p/css-boilerplate/](http://code.google.com/p/css-boilerplate/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T15:01:25.950

您可以使用[BluePrint CSS 框架](http://www.blueprintcss.org/)或查看[CSS 模板](http://www.freecsstemplates.org/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T15:05:18.997

您没有提及您使用的是什么语言，但如果它是 Java，[Appfuse](http://appfuse.org/)是一个非常棒的工具，可以从可配置的模板创建整个（骨架）Web 应用程序项目。这个框架包括一个初始的 HTML/CSS/Javascript UI，其中包括常见的元素，例如登录页面、“添加用户”页面等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T15:34:10.330

根据您的 IDE，Eric Meyer 编写了一个名为[CSS Sculptor](http://www.webassist.com/professional/products/productdetails.asp?PID=253)的程序，您可以使用它来快速开发基于标准的布局。我用过，很好用。

# c# - Invoke() 被阻塞

> ID：287142
> 
> 赞同：23
> 
> 时间：2008-11-13T14:55:06.587
> 
> 标签：c#, .net, winforms, .net-2.0

我的应用程序 GUI 有时会停止重绘。有很多线程正在触发各种事件（如计时器或网络数据就绪等）。还有很多订阅这些事件的控件。因此，所有事件处理程序都玩 InvokeRequired/Invoke 游戏。现在我发现当 GUI 冻结时，很多线程都在等待 Invoke() 返回。看起来消息泵停止了泵送。处理程序如下所示：

```
private void MyEventHandler( object sender, EventArgs e ) {
    if ( InvokeRequired ) {
        Invoke( new EventHandler( MyEventHandler ), sender, e );
        return;
    }

    SetSomeStateVariable();
    Invalidate();
} 
```

有任何想法吗？

解决方案：BeginInvoke()。看起来你应该总是使用 BeginInvoke() 如果你有很多 CrossThread-Events ......

谢谢。

谢谢大家。

**编辑：**看起来`BeginInvoke()`真的解决了它。直到现在都没有结冰。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-11-13T14:57:59.137

Invoke 一直等到事件在 GUI 线程中得到处理。如果您希望它是异步的，请使用 BeginInvoke()

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-13T14:57:37.780

可能是死锁？您是否确保在持有锁时永远不会触发事件？

你能在附加调试器的情况下看到这个吗？如果是这样，让它冻结，然后点击“暂停”按钮 - 看看 UI 线程在做什么。

请注意，如果您能够使用 BeginInvoke 而不是 Invoke，生活会更轻松一些，因为它不会阻塞。

另请注意，您不需要“新 EventHandler”位 - 只需

```
Invoke((EventHandler) MyEventHandler, sender, e); 
```

应该没事。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-13T15:57:44.370

通过观看这个问题，我可以看到您不会得到任何可以立即解决问题的答案，因为它们中的大多数都需要您调试事件，而且这种情况很少发生，这几乎是不可能的。因此，让我建议您进行一些代码更改，以帮助您识别该领域的罪魁祸首。

我建议您创建一个静态类，其唯一目的是处理您的所有 Invoke 调用。我建议这个类有一个方法，它接受一个 Control，（调用 Invoke）一个 Action（要调用的方法）和一个描述（包含你需要知道的信息来识别方法和它是什么将要做）。

在这个方法的主体中，我建议你将这些信息（方法、描述）排入队列并立即返回。

队列应该由单个线程提供服务，该线程将动作/消息对从队列中弹出，在一对属性中记录当前时间和动作的描述，然后调用（）动作。当 Action 返回时，描述和时间被清除（您的 DateTime 可以为空，或将其设置为 DateTime.Max）。请注意，由于一次将所有 Invokes 编组到 UI 线程上，因此在这里通过单个线程为队列提供服务不会丢失任何内容。

现在，这就是我们要达到的目的。我们的 Invoking 类应该有一个心跳 System.Threading.Timer 线程。这不应该是 windows.forms.timer 对象，因为它在 UI 线程上运行（并且会在 ui 被阻止时被阻止！！！）。

此计时器的工作是定期查看当前操作被调用的时间。如果 DateTime.Now - BeginTime > X，心跳计时器将判定此 Action 已被阻止。心跳计时器将记录（无论您如何记录）为该操作记录的说明。您现在可以记录您的 UI 锁定时发生的事情，并且可以更好地对其进行调试。

我知道这不是您问题的答案，但至少通过这样做，您可以很好地了解您被阻止时发生的事情。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T15:34:59.343

已经提出了最可能的答案（死锁）。

另一种模拟这种行为的方法是减少池线程和 IO 完成端口的数量；你没有打电话`ThreadPool.SetMaxThreads(...)`吗？

# php - Need a good regex to convert URLs to links but leave existing links alone

> ID：287144
> 
> 赞同：21
> 
> 时间：2008-11-13T14:55:59.533
> 
> 标签：php, html, regex, url

I have a load of user-submitted content. It is HTML, and may contain URLs. Some of them will be `<a>`'s already (if the user is good) but sometimes users are lazy and just type www.something.com or at best [http://www.something.com](http://www.something.com).

I can't find a decent regex to capture URLs but ignore ones that are immediately to the right of either a double quote or '>'. Anyone got one?

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-13T15:11:20.390

Jan Goyvaerts, creator of [RegexBuddy](http://www.regexbuddy.com), has [written a response](http://www.regexguru.com/2008/11/detecting-urls-in-a-block-of-text/) to Jeff Atwood's blog that addresses the issues Jeff had and provides a nice solution.

```
\b(?:(?:https?|ftp|file)://|www\.|ftp\.)[-A-Z0-9+&@#/%=~_|$?!:,.]*[A-Z0-9+&@#/%=~_|$] 
```

In order to ignore matches that occur right next to a " or >, you could add `(?<![">])` to the start of the regex, so you get

```
(?<![">])\b(?:(?:https?|ftp|file)://|www\.|ftp\.)[-A-Z0-9+&@#/%=~_|$?!:,.]*[A-Z0-9+&@#/%=~_|$] 
```

This will match full addresses ([http://..](http://..).) and addresses that start with www. or ftp. - you're out of luck with addresses like ars.userfriendly.org...

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2012-05-08T14:03:12.910

这个线程像山一样古老，但我在解决自己的问题时遇到了它：也就是说，将任何 url 转换为链接，但不要管任何已经在锚标记中的链接。过了一会儿，弹出来的是这样的：

```
(?!(?!.*?<a)[^<]*<\/a>)(?:(?:https?|ftp|file)://|www\.|ftp\.)[-A-Z0-9+&#/%=~_|$?!:,.]*[A-Z0-9+&#/%=~_|$] 
```

使用以下输入：

```
http://www.google.com
http://google.com
www.google.com

<p>http://www.google.com<p>

this is a normal sentence. let's hope it's ok.

<a href="http://www.google.com">www.google.com</a> 
```

这是 preg_replace 的输出：

```
<a href="http://www.google.com" rel="nofollow">http://www.google.com</a>
<a href="http://google.com" rel="nofollow">http://google.com</a>
<a href="www.google.com" rel="nofollow">www.google.com</a>

<p><a href="http://www.google.com" rel="nofollow">http://www.google.com</a><p>

this is a normal sentence. let's hope it's ok.

<a href="http://www.google.com">www.google.com</a> 
```

只是想回馈以节省一些时间。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2010-06-01T15:56:15.783

我对原始答案中包含的正则表达式做了一些修改：

```
(?<![.*">])\b(?:(?:https?|ftp|file)://|[a-z]\.)[-A-Z0-9+&#/%=~_|$?!:,.]*[A-Z0-9+&#/%=~_|$] 
```

它允许更多的子域，并且还对标签进行更全面的检查。要将其应用于 PHP 的 preg 替换，您可以使用：

```
$convertedText = preg_replace( '@(?<![.*">])\b(?:(?:https?|ftp|file)://|[a-z]\.)[-A-Z0-9+&#/%=~_|$?!:,.]*[A-Z0-9+&#/%=~_|$]@i', '<a href="\0" target="_blank">\0</a>', $originalText ); 
```

请注意，我从正则表达式中删除了 @，以便将其用作 preg_replace 的分隔符。无论如何，在 URL 中使用 @ 是非常罕见的。

显然，您可以修改替换文本，删除 target="_blank"，或者添加 rel="nofollow" 等。

希望有帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-06-21T21:38:33.243

```
if (preg_match('/\b(?<!=")(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[A-Z0-9+&@#\/%=~_|](?!.*".*>)(?!.*<\/a>)/i', $subject)) {
    # Successful match
} else {
    # Match attempt failed
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-02-24T17:23:47.740

要跳过现有的，只需使用look-behind - 添加`(?<!href=")`到正则表达式的开头，因此它看起来像这样：

```
/(?<!href=")http://\S*/ 
```

显然，这不是*查找*所有类型 URL 的完整解决方案，但这应该可以解决您弄乱现有 URL 的问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-13T16:46:04.507

无耻插件：你可以看这里（[正则表达式用链接替换单词](https://stackoverflow.com/questions/276029/#276109)）寻找灵感。

该问题要求用某个链接替换某些单词，除非已经存在链接。所以你遇到的问题或多或少是一样的。

您只需要一个匹配 URL（代替单词）的正则表达式。最简单的假设是这样的：一个 URL（可选）以 或 开头，`"http://"`只要没有空格字符、换行符、标签括号或引号就可以持续）。`"ftp://"``"mailto:"`

当心，前面的正则表达式很长。应用不区分大小写。

```
(href\s*=\s*['"]?)?((?:http://|ftp://|mailto:)?[^.,<>"'\s\r\n\t]+(?:\.(?![.<>"'\s\r\n])[^.,!<>"'\s\r\n\t]+)+) 
```

请注意 - 这也将匹配*技术上*无效的 URL，并将 things.formatted.like.this 识别为 URL。如果它太不敏感，这取决于您的数据。如果您有返回误报的示例，我可以微调正则表达式。

正则表达式将产生两个匹配组。第 2 组将包含匹配的内容，这很可能是一个 URL。第 1 组将包含一个空字符串或一个`'href="'`. 您可以将其用作此匹配发生*在*现有链接的 href 参数内的指示符，而您不必触摸该匹配。

一旦您确认这在*大多数情况下*对您来说都是正确的（使用用户提供的数据，您永远无法确定），您可以分两步完成其余的工作，正如我在另一个问题中提出的那样：

1.  在每个 URL 周围建立一个链接（**除非**匹配组 1 中有东西！）这*将为*`<a>`已经有链接的东西生成双重嵌套标签。
2.  扫描错误嵌套`<a>`的标签，删除最里面的标签

# wcf - Silverlight and WCF or not?

> ID：287165
> 
> 赞同：0
> 
> 时间：2008-11-13T15:04:53.040
> 
> 标签：wcf, silverlight

When developing an application wich will be used inside an intranet do you think Silverlight and WCF is a good solution ?

Whould you use WCF Services or WCF Web Services to expose your model to the client ?

When consuming a WCF Service the proxies will be generated under a reference and you can only have 1 service reference per service, How can I have the application domain model created under the same service reference ?

Thanks.
A. Lampard.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T15:09:19.943

Not yet. I had a difficult time getting WCF configured, and Silverlight 2 beta was not well documented.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T15:39:06.810

Silverlight 现已退出 Beta 版，并且与 WPF 的兼容性得到了改进。如果您的技能一般都在 .NET 中并且您想要一个富 Web 应用程序，那么 Silverlight 应该是不费吹灰之力的，尤其是在您可以合理地保证每个人都安装了 Silverlight 的 Intranet 上。另外，它在 Mac 上运行良好。

对于服务，WCF 与 Silverlight 一起使用，并且有许多关于它们如何协同工作的示例。这是官方网站上关于该主题的视频：

[http://silverlight.net/learn/learnvideo.aspx?video=47177](http://silverlight.net/learn/learnvideo.aspx?video=47177)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T15:38:00.883

你的问题太笼统了。真的很难回答这类问题，因为，真的，“任何”技术都适用于“任何”解决方案。否则每个人都只会使用一个！

您的应用程序应该做什么，您需要多长时间完成它，是否对相同或其他技术进行任何现有投资......等等？

话虽如此，回答你的问题：是的。

不确定我是否理解您的第二个问题...不知道您为什么要为每项服务提供多个参考...？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T16:04:08.927

“不知道我是否理解你的第二个问题......不知道你为什么要每个服务超过 1 个参考......？”

例如，当您拥有使用 Product 和 Family 类的 ProductService 时，如果您为此服务创建代理，您将获得：ServiceReference1.Family 和 ServiceReference1.Product。现在假设您创建了 FamilyService，当使用此服务时，您将再次创建 Family 代理，但在 ServiceReference2 下！

# c# - 包含 () 以及如何实现它

> ID：287178
> 
> 赞同：3
> 
> 时间：2008-11-13T15:07:41.707
> 
> 标签：c#, linq

说一堂课

```
Person  
+Name: string  
+Contacts: List<Person> 
```

我希望能够检查一个人是否有某个名字的联系人，而不必创建一个虚拟的 Person 实例。

```
person.Contacts.Contains<string>("aPersonName"); 
```

这应该检查联系人列表中的所有人员，如果他们的 Name.Equals("aPersonName"); 我看到有一个 Contains 已经可用，但我不知道我应该在哪里实现它的逻辑。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-13T15:12:43.897

使用[Enumerable.Any](http://msdn.microsoft.com/en-us/library/bb534972.aspx)可能是最简单的：

```
 return person.Contacts.Any(person => person.Name=="aPersonName"); 
```

或者，项目然后包含：

```
 return person.Select(person => person.Name).Contains("aPersonName"); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T15:14:41.100

我假设联系人是相关人员的联系人（您的代码片段中的人员）

List 有一个 contains 方法，它将 T 类型的对象作为参数，如果该对象存在于列表中，则返回 true 或 false。你想要的是 IList.Exists 方法，它需要一个谓词。

示例 (c# 3.0)

```
bool hasContact = person.Contacts.Exists(p => p.Name == "aPersonName"); 
```

或 (c# 2.0)

```
bool hasContact = person.Contacts.Exists(delegate(Person p){ return p.Name == "aPersonName"; }); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T15:18:39.673

我同意 Jon 的`Any`，但是如果您坚持使用 C# 2.0 或带有 .NET 2.0/3.0 且没有 LINQBridge 的 C# 3.0，那么另一种方法是`List<T>.Find`or `List<T>.Exists`。我会用 来说明`Find`，因为`Exists`在我正要按下按钮时发布了；-p

```
// C# 2.0
bool knowsFred = person.Contacts.Find(delegate(Person x) { return x.Name == "Fred"; }) != null;
// C# 3.0
bool knowsFred = person.Contacts.Find(x => x.Name == "Fred") != null; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T15:13:56.190

您可以创建扩展方法

```
public static bool Contains(this IList<Person> list, string name) {
    return list.Any(c => c.Name == name);
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T15:23:40.163

Jon Skeet 和 yapiskan 已经提出的解决方案是可行的方法。如果您确切需要您所说的内容，那么您可以编写一个扩展方法：

```
public static class ContactListExtensions
{
    public static bool Contains<T>(this List<Person> contacts, string aPersonName)
    {
        //Then use any of the already suggested solutions like:
        return contacts.Contains(c => c.Name == aPersonName);
    }
} 
```

# sql-server - 事务级别、nolock/readpast 和并发

> ID：287179
> 
> 赞同：5
> 
> 时间：2008-11-13T15:08:21.160
> 
> 标签：sql-server, optimization, concurrency, transactions, locking

我们有一个系统，从多个站点同时插入大量数据，同时还暴露了一个数据查询接口。架构看起来像这样（抱歉格式不好）：

```
[SyncTable]
  SyncID
  StationID
  MeasuringTime

[DataTypeTable]
  TypeID
  TypeName

[DataTable]
  SyncID
  TypeID
  DataColumns... 
```

数据插入是在“同步”中完成的，就像这样（我们只将数据插入系统，我们从不更新）

```
INSERT INTO SyncTable(StationID, MeasuringTime) VALUES (X,Y); SELECT @@IDENTITY

INSERT INTO DataTable(SyncID, TypeID, DataColumns) VALUES 
  (SyncIDJustInserted, InMemoryCachedTypeID, Data)
  ... lots (500) similar inserts into DataTable ... 
```

查询是这样的（对于给定的站点，测量时间和数据类型）

```
SELECT SyncID FROM SyncTable WHERE StationID = @StationID 
                               AND MeasuringTime = @MeasuringTime 
SELECT DataColumns FROM DataTable WHERE SyncID = @SyncIDJustSelected
                                  AND DataTypeID = @TypeID 
```

我的问题是我们如何结合插入的事务级别和查询的 NOLOCK/READPAST 提示，以便：

1.  我们在支持插入的同时最大化系统中的并发性（我们需要存储大量数据，每秒高达 2000 多条记录）
2.  查询仅从“已提交”同步返回数据（我们不希望结果集包含半插入同步或由于锁跳过而包含一些跳过条目的同步）
3.  我们不关心查询中是否包含“最新”数据，我们更关心一致性和响应能力，而不是“实时”和最新数据

这可能是非常矛盾的目标，并且可能需要高事务隔离级别，但我对所有技巧和优化感兴趣，以实现对插入和选择的高响应性。如果需要更多细节来消除更多调整和技巧，我将很乐意详细说明。

更新：只需为将来的回复添加更多信息。我们在最初具有 5+ TB 存储的 SAN 网络上运行 SQL Server 2005（可能在 6 个月内 2008）。我不确定 SAn 设置了哪种 RAID，以及我们有多少磁盘可用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T00:12:36.553

如果您正在运行 SQL 2005 及更高版本，请考虑实施[快照隔离](http://msdn.microsoft.com/en-us/library/ms345124.aspx)。使用 nolock 将无法获得一致的结果。

在 SQL 2000 上解决这个问题要困难得多。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-15T12:32:11.147

这是 SQL Server 2005/2008 Enterprise 的分区功能的绝佳方案。您可以为每个 StationID 创建一个分区，并且每个 StationID 的数据可以进入其自己的文件组（如果需要，根据您的负载可能不需要。）

这为您带来了一些并发优势：

*   如果您按 stationid 分区，则用户可以对当前未加载的 stationid 运行选择查询，并且他们根本不会遇到任何并发问题
*   如果您按 stationid 分区，则多个站可以同时插入数据而不会出现并发问题（只要它们位于不同的文件组上）
*   如果您按同步 ID 范围进行分区，那么您可以将较旧的数据放在较慢的存储上。
*   如果您按同步 ID 范围进行分区，并且如果您的范围足够小（意味着不是具有数千个同步 ID 的范围），那么您可以在用户查询的同时进行加载，而不会遇到并发问题

您所描述的场景与数据仓库夜间加载有很多共同点。Microsoft 做了一个名为 Project Real 的技术参考项目，您可能会觉得它很有趣。他们将其作为标准发布，您可以通读设计文档和实现代码，以了解它们如何实现快速加载：

[http://www.microsoft.com/technet/prodtechnol/sql/2005/projreal.mspx](http://www.microsoft.com/technet/prodtechnol/sql/2005/projreal.mspx)

分区在 SQL Server 2008 中甚至更好，尤其是在并发方面。它仍然不是灵丹妙药——它需要由熟练的 DBA 进行手动设计和维护。它不是一劳永逸的功能，它确实需要企业版，它的成本高于标准版。不过，我喜欢它——我已经使用了好几次，它为我解决了特定的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T19:04:41.557

1.  您将使用什么类型的磁盘系统？如果您有一个大型条带化 RAID 阵列，则写入性能应该很好。如果您可以估计每秒所需的读取和写入，您可以将这些数字代入公式，看看您的磁盘子系统是否能跟上。也许您无法控制硬件...

2.  您不会将插入包装在事务中，这会使它们在插入完成之前对读取不可用？

3.  如果您的硬件配置正确并且您正在关注您的 SQL 编码，那么这应该遵循 - 看起来您就是这样。

查看 SQLIO.exe 和 SQL Stress 工具：

SQLIOStress.exe SQLIOStress.exe 模拟 SQL Server 2000 I/O 行为的各种模式以确保基本的 I/O 安全。

SQLIOStress 实用程序可以从 Microsoft 网站下载。请参阅以下文章。

• 如何使用 SQLIOStress 实用程序对磁盘子系统（例如 SQL Server）施加压力 [http://support.microsoft.com/default.aspx?scid=kb;en-us;231619](http://support.microsoft.com/default.aspx?scid=kb;en-us;231619)

重要 下载包含一份完整的白皮书，其中包含有关该实用程序的详细信息。

SQLIO.exe SQLIO.exe 是用于建立基本基准测试结果的 SQL Server 2000 I/O 实用程序。

SQLIO 实用程序可以从 Microsoft 网站下载。请参阅以下内容： • SQLIO 性能测试工具（SQL 开发）- 客户可用 [http://download.microsoft.com/download/f/3/f/f3f92f8b-b24e-4c2e-9e86-d66df1f6f83b/SQLIO.msi](http://download.microsoft.com/download/f/3/f/f3f92f8b-b24e-4c2e-9e86-d66df1f6f83b/SQLIO.msi)

# coldfusion - 使用相对路径扩展 CFC

> ID：287187
> 
> 赞同：10
> 
> 时间：2008-11-13T15:11:45.163
> 
> 标签：coldfusion, cfc

我想在不同的目录中扩展 CFC，我有几个选项，但不知道如何做到这一点：

A）使用动态映射（这必须是基于站点的动态映射，例如，对于实时站点，它将是 cfc.myPackage.MyCFC，但在开发站点上它将是 myCfcRoot.myPackage.MyCFC） - 我已经尝试过将表达式放入扩展位，但显然 CF 不喜欢这样，例如：

```
<cfcomponent name="MyComponent" extends="#config.cfcRoot#.BaseComponent"> 
```

或者

```
<cfcomponent name="MyComponent" extends="#GetRealPath(../BaseComponent.cfc)#"> 
```

B) 提供 CFC 的相对路径（以某种方式）以进行扩展。

我担心我做不到，但我希望我错过了一些东西。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-13T16:10:36.167

丹尼尔基本上是正确的，你需要一个映射。但是，有 3 种解决方法。

CFC 会选择当前路径作为相对根映射，所以如果你的 CFC 都在同一个目录中，你可以说

```
<cfcomponent name="MyComponent" extends="Example"> 
```

或者，如果您的组件位于当前 cfc 的子目录中，您可以访问它：

```
<cfcomponent name="MyComponent" extends="subdirectory.Example"> 
```

其次，如果您在 ColdFusion 8 上运行，您可以使用如下映射结构在 application.cfc 中定义映射：

```
<cfset this.mappings["/MyApp"] = expandPath(".") /> 
```

Application.cfc 有两个很好的参考，第一个是[Ray Camden 的示例 Application.cfc](http://www.coldfusionjedi.com/downloads/application.cfc.txt)，它只是提供了一个很好的视图去哪里，然后是[CF8 Live Docs 应用程序设置](http://livedocs.adobe.com/coldfusion/8/htmldocs/help.html?content=appFramework_04.html)页面，其中有一个关于映射的部分以及一些很好的评论。

最后，您可以使用 Web 根目录的内置映射，因此如果您的应用程序位于 Web 根目录之外的名为“MyApp”的子目录中，那么您的根映射将是“MyApp”。假设您正确地将组件放入：

```
wwwroot\MyApp\com\MyApp\example.cfc 
```

在这种情况下，到此 cfc 的映射将是：

```
MyApp.com.MyApp.Example 
```

并使用您的示例，您可以像这样扩展：

```
<cfcomponent name="MyComponent" extends="MyApp.com.MyApp.Example"> 
```

其他任何事情，例如您的组件是否位于 Web 根目录之外，或者您不确定已完成应用程序的文件夹结构是什么，您需要在 CF Administrator 中设置映射。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-18T21:59:53.760

现在这仅在 cf8 中进行了测试，因此其他引擎可能会有所不同。

如果您想使用相对路径来扩展应用程序，您可以，但您必须以“ **/.** ”开头。例如，您可以这样做将 application.cfc 从您的 Web 根目录扩展到您的 Web 根目录下的目录：

```
<cfcomponent output="false" extends="/.application">
 <!--- whatever code you have --->
</cfcomponent> 
```

现在假设我的应用程序中有以下路径：

```
[webroot]/1/1a
[webroot]/2 
```

假设**[webroot]/1/1a**中的 application.cfc 扩展了**[webroot]**中的 application.cfc 。现在我想在 [webroot]/2 中放置一个 application.cfc**并在****[webroot]/1/1a**中扩展 application.cfc 。我在我的 [webroot]/2/application.cfc 中要做的所有事情如下：

```
<cfcomponent output="false" extends="/./1/1a/application">
 <!--- whatever code you have --->
</cfcomponent> 
```

希望这是有道理的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T15:18:37.473

除非 CFC 与调用脚本位于同一目录中，否则必须从相对于“映射”的路径定位和引用 CFC。

我发现有时您需要确保将“/”映射到您的网络服务器的文档根目录，并成为所有相对路径的基础。或者，您可以为包含所有常用 CFC 的 CFC 目录设置映射。

此屏幕位于 ColdFusion Admin 中的“服务器设置”->“映射”下。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-07-05T12:23:40.933

关于方法 B。可以在您的示例中使用附加文件来完成。对于每个要扩展的目录，每个 cfc 都有一个额外的文件。

所需的 3 个文件。

*   /somepathtobasecomponent/basecomponent.cfc（您的基本组件文件）
*   /pathtoworkingcfc/function.cfc（具有扩展属性的文件）
*   /pathtoworkingcfc/basecomponent_extend.cfc（将进行扩展的新文件）

**/somepathtobasecomponent/basecomponent.cfc**

这里没什么可改变的。这保持不变。

**/pathtoworkingcfc/function.cfc**

在`cffunction`标签集中延伸到`extends="basecomponent_extend"`

**/pathtoworkingcfc/basecomponent_extend.cfc**

文件的唯一内容是`cfinclude`

```
<cfinclude template="/somepathtobasecomponent/basecomponent.cfc"> 
```

# jquery - 如何知道所有ajax调用何时完成

> ID：287188
> 
> 赞同：78
> 
> 时间：2008-11-13T15:12:26.613
> 
> 标签：jquery, ajax

我有一个带有行的表格样式页面。每行都有一个复选框。我可以选择所有/许多复选框并单击“提交”，所做的是对每一行进行 Jquery ajax 调用。

基本上我每行都有一个表单，我遍历所有检查的行并提交执行 jquery ajax 调用的表单。

所以我有一个按钮：

```
 $("input:checked").parent("form").submit(); 
```

然后每一行都有：

```
 <form name="MyForm<%=i%>" action="javascript:processRow(<%=i%>)" method="post" style="margin:0px;">
                <input type="checkbox" name="X" value="XChecked"/>
                <input type="hidden" id="XNumber<%=i%>" name="X<%=i%>" value="<%=XNumber%>"/>
                <input type="hidden" id="XId<%=i%>" name="XId<%=i%>" value="<%=XNumber%>"/>
                <input type="hidden" id="XAmt<%=i%>" name="XAmt<%=i%>" value="<%=XAmount%>"/>
                <input type="hidden" name="X" value="rXChecked"/>
            </form> 
```

此表单提交给 processRow：

```
 function processRow(rowNum)
   {
        var Amount = $('#XAmt'+rowNum).val();
        var XId = $('#XId'+rowNum).val();
        var XNum = $('#OrderNumber'+rowNum).val();
        var queryString = "xAmt=" + "1.00" + "&xNumber=" + OrdNum + "&xId=" + xId;

        $('#coda_'+rowNum).removeClass("loader");
        $('#coda_'+rowNum).addClass("loading");

        $.ajax({
          url: "x.asp",
          cache: false,
          type:  "POST",
          data:  queryString,
          success: function(html){
            $('#result_'+rowNum).empty().append(html);
            $('#coda_'+rowNum).removeClass("loading");
            $('#coda_'+rowNum).addClass("loader");
          }
        });
   } 
```

我想知道的是，有没有一种方法可以告诉我所有的 Ajax 调用是否都已完成。原因是希望在所有这些调用发生时启用/禁用提交按钮。

谢谢，请注意，由于应用程序的敏感性，我不得不修改我的变量名，所以其中很多可能是重复的。

* * *

## 回答 #1

> 赞同：144
> 
> 时间：2008-11-13T15:20:05.460

# 简单的方法

最简单的方法是使用[`.ajaxStop()`事件处理程序](http://api.jquery.com/ajaxStop/)：

```
$(document).ajaxStop(function() {
  // place code to be executed on completion of last outstanding ajax call here
}); 
```

# 艰难的路

您还可以手动检测是否有任何 ajax 调用仍处于活动状态：

创建一个包含活动 Ajax 连接数的变量：

```
var activeAjaxConnections = 0; 
```

就在打开新的 Ajax 连接之前增加该变量

```
$.ajax({
  beforeSend: function(xhr) {
    activeAjaxConnections++;
  },
  url (...) 
```

部分检查该`success`变量是否等于零（如果是，则最后一个连接已完成）

```
success: function(html){
  activeAjaxConnections--;
  $('#result_'+rowNum).empty().append(html);
  $('#coda_'+rowNum).removeClass("loading");
  $('#coda_'+rowNum).addClass("loader");
  if (0 == activeAjaxConnections) {
    // this was the last Ajax connection, do the thing
  }
},
error: function(xhr, errDesc, exception) {
  activeAjaxConnections--;
  if (0 == activeAjaxConnections) {
    // this was the last Ajax connection, do the thing
  }
} 
```

如您所见，我还添加了检查返回错误

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2011-09-30T13:06:53.887

一个巧妙的解决方案是使用；

```
$("body").ajaxStop(function() {
    //Your code
}); 
```

有关更多信息，请查看[http://api.jquery.com/ajaxStop/上的 jQuery .ajaxStop 函数](http://api.jquery.com/ajaxStop/)

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2013-03-05T14:55:04.870

也许：

```
jQuery.active == 0 
```

盗取自：

[http://artsy.github.com/blog/2012/02/03/reliably-testing-asynchronous-ui-w-slash-rspec-and-capybara/](http://artsy.github.com/blog/2012/02/03/reliably-testing-asynchronous-ui-w-slash-rspec-and-capybara/)

关于 StackOverflow 的更多信息：

[jQuery.active 函数](https://stackoverflow.com/questions/3148225/jquery-active-function)

* * *

## 回答 #4

> 赞同：-4
> 
> 时间：2016-04-25T14:10:19.650

简单地使用**if**怎么样？

```
success: function(html){
   if(html.success == true ){
            $('#result_'+rowNum).empty().append(html);
            $('#coda_'+rowNum).removeClass("loading");
            $('#coda_'+rowNum).addClass("loader");

          }
   } 
```

# asp.net - 如何使用分页对网格进行单元测试

> ID：287192
> 
> 赞同：0
> 
> 时间：2008-11-13T15:13:45.610
> 
> 标签：asp.net, unit-testing, grid, paging

一种常见的 Web UI 设计是显示带有分页的可排序网格（GridView、ListView、DataGrid）。也就是说，用户可以单击任何列标题以使记录按该列数据的升序或降序排序。而且，用户可以一次在 10 个记录的页面之间导航。

*   可能有数百万条数据库记录可能显示在网格上。
*   有许多可能的过滤器可以应用于数据选择。显示的记录可能适用于当前用户、日期范围或客户、部门、产品、订单。
*   用户可以对任何列上显示的记录进行排序，并且可以在页面之间导航。

对于此过滤器、此页面和此排序顺序，您将如何编写单元测试以确认所选记录是正确的记录？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T15:26:45.647

你不得不

*   将过滤、排序与实际源分离，以便您可以模拟数据源并测试逻辑是否返回正确的记录。
*   将分页逻辑与网格分离，以便您可以测试分页是否返回正确的索引。

这样您就可以在单独的单元中测试过滤和分页逻辑。

接下来，您还可以使用自动 webtest 来测试完整的东西（集成测试）。

# wpf - WPF中有向导控件吗？

> ID：287193
> 
> 赞同：35
> 
> 时间：2008-11-13T15:13:45.737
> 
> 标签：wpf, wizard

WPF 中有向导类型的控件吗？我需要可以前进和后退并使用选项卡选择特定项目的功能，该项目将显示嵌套项目的详细信息。我可以使用 TabControl 控件，但选项卡项是动态的，因此我不能将区域嵌套在选项卡项内。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-11-13T15:18:47.987

WPF 具有内置的导航基础结构：

[WPF 导航概述](http://msdn.microsoft.com/en-us/library/ms750478.aspx)

另请查看[向导示例](http://msdn.microsoft.com/en-us/library/aa972123.aspx)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2011-02-18T12:48:35.380

我用于基本向导的另一种简单方法是使用多个网格并在单击按钮时更改可见性属性，使用 int 来跟踪“步骤号”

```
 <Grid Name="Page1">
        <TextBlock>Page 1</TextBlock>
    </Grid>

    <Grid Name="Page2" Visibility="Hidden">
        <TextBlock>Page 2</TextBlock>
    </Grid> 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2010-11-12T23:21:14.713

您可以尝试开源[Avalon Wizard](https://bitbucket.org/PahanMenski/avalonwizard/src/default/)。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2014-03-19T13:14:47.903

检查[此链接](https://github.com/xceedsoftware/wpftoolkit)。您可以使用扩展的 wpf 工具包创建精彩的向导。

![向导](https://i.stack.imgur.com/vg7E9.jpg)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-04-19T16:30:42.397

在 codeproject 上找到了这个很好的示例，它应该为您提供所需的一切：

[http://www.codeproject.com/Articles/31837/Creating-an-Internationalized-Wizard-in-WPF](http://www.codeproject.com/Articles/31837/Creating-an-Internationalized-Wizard-in-WPF)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2018-08-11T22:07:16.053

[MVVM 向导](https://github.com/lezhkin11/mvvm-wizard)- 像这样使用（需要 DI 容器，在第一次导航时创建视图）

```
<controls:Wizard>
    <controls:WizardStep ViewType="{x:Type test:View1}"  />
    <controls:WizardStep ViewType="{x:Type test:View2}" />
    <controls:WizardStep ViewType="{x:Type test:View3}" />
</controls:Wizard> 
```

或像这样（不需要 DI，但会立即创建所有视图）

```
<controls:Wizard>

    <controls:WizardStep>
        <test:View1 />
    </controls:WizardStep>

    <controls:WizardStep>
        <test:View2 />
    </controls:WizardStep>

    <controls:WizardStep>
        <test:View3 />
    </controls:WizardStep>

</controls:Wizard> 
```

# c# - 如何在消费时将项目添加到集合中？

> ID：287195
> 
> 赞同：2
> 
> 时间：2008-11-13T15:13:49.793
> 
> 标签：c#, .net

下面的示例抛出 InvalidOperationException，“集合已修改；枚举操作可能无法执行。” 执行代码时。

```
var urls = new List<string>();
urls.Add("http://www.google.com");

foreach (string url in urls)
{
    // Get all links from the url
    List<string> newUrls = GetLinks(url);

    urls.AddRange(newUrls); // <-- This is really the problematic row, adding values to the collection I'm looping
} 
```

我怎样才能以更好的方式重写它？我猜是递归解决方案？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-13T15:20:40.370

你不能，基本上。你真正想要的是一个队列：

```
var urls = new Queue<string>();
urls.Enqueue("http://www.google.com");

while(urls.Count != 0)
{
    String url = url.Dequeue();
    // Get all links from the url
    List<string> newUrls = GetLinks(url);
    foreach (string newUrl in newUrls)
    {
        queue.Enqueue(newUrl);
    }
} 
```

由于没有`AddRange`方法，它有点难看，`Queue<T>`但我认为这基本上是你想要的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-13T15:24:36.947

您可以使用三种策略。

1.  将 List<> 复制到第二个集合（列表或数组 - 可能使用 ToArray()）。循环遍历第二个集合，将 url 添加到第一个集合。
2.  创建第二个 List<>，并循环遍历您的 url List<> 将新值添加到第二个列表。完成循环后将它们复制到原始列表。
3.  使用*for*循环而不是*foreach*循环。提前数数。列表应该正确地对事物进行索引，因此您添加的事物将位于列表的末尾。

我更喜欢#3，因为它没有与#1 或#2 相关的任何开销。这是一个例子：

```
var urls = new List<string>();
urls.Add("http://www.google.com");
int count = urls.Count;

for (int index = 0; index < count; index++)
{
    // Get all links from the url
    List<string> newUrls = GetLinks(urls[index]);

    urls.AddRange(newUrls);
} 
```

* * *

编辑：最后一个示例（#3）假设您**不想**处理在循环中找到的其他 URL。如果您**确实**想在找到其他 URL 时对其进行处理，只需在*for循环中使用 urls.Count 而不是*[配置](/users/9536/configurator)器在此答案的评论中提到的本地*count变量。*

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T15:23:06.483

将 foreach 与 lambda 一起使用，更有趣！

```
var urls = new List<string>();
var destUrls = new List<string>();
urls.Add("http://www.google.com");
urls.ForEach(i => destUrls.Add(GetLinks(i)));
urls.AddRange(destUrls); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T15:16:41.237

我将创建两个列表添加到第二个列表中，然后像这样更新引用：

```
var urls = new List<string>();
var destUrls = new List<string>(urls);
urls.Add("http://www.google.com");
foreach (string url in urls)
{    
    // Get all links from the url    
    List<string> newUrls = GetLinks(url);    
    destUrls.AddRange(newUrls);
}
urls = destUrls; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-13T15:19:50.310

或者，您可以将集合视为队列

```
IList<string> urls = new List<string>();
urls.Add("http://www.google.com");
while (urls.Count > 0)
{
    string url = urls[0];
    urls.RemoveAt(0);
    // Get all links from the url
    List<string> newUrls = GetLinks(url);
    urls.AddRange(newUrls);
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-13T15:20:22.837

不要更改每个循环通过的集合。只需在列表的 Count 属性上使用 while 循环并按索引访问列表项。这样，即使您添加项目，迭代也应该获取更改。

编辑：再说一次，这有点取决于您是否希望添加的新项目被循环拾取。如果没有，那么这将无济于事。

编辑2：我想最简单的方法是将循环更改为：foreach（urls.ToArray（）中的字符串url）

这将创建列表的 Array 副本，并且它将循环遍历此列表而不是原始列表。这将具有不循环您添加的项目的效果。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-13T15:20:32.133

考虑使用带有 while 循环的队列（当 q.Count > 0，url = q.Dequeue()）而不是迭代。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-13T15:24:13.873

我假设您想遍历整个列表，以及添加到其中的每个项目？如果是这样，我会建议递归：

```
var urls = new List<string>();
var turls = new List<string();
turls.Add("http://www.google.com")

iterate(turls);

function iterate(List<string> u)
{
    foreach(string url in u)
    {
        List<string> newUrls = GetLinks(url);

        urls.AddRange(newUrls);

        iterate(newUrls);
    }
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-13T15:29:37.530

您可能还可以创建一个递归函数，如下所示（未经测试）：

```
IEnumerable<string> GetUrl(string url)
{
  foreach(string u in GetUrl(url))
    yield return u;
  foreach(string ret_url in WHERE_I_GET_MY_URLS)
    yield return ret_url;
}

List<string> MyEnumerateFunction()
{
  return new List<string>(GetUrl("http://www.google.com"));
} 
```

在这种情况下，您不必创建两个列表，因为 GetUrl 会完成所有工作。

但我可能错过了你节目的重点。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-13T21:55:25.067

乔恩的方法是正确的；队列是此类应用程序的正确数据结构。

假设您最终希望您的程序终止，我会建议另外两件事：

*   不要`string`用于您的 URL，请使用`System.Web.Uri`: 它提供 URL 的规范字符串表示。这对于第二个建议很有用，即...
*   将您处理的每个 URL 的规范字符串表示形式放在字典中。在将 URL 排入队列之前，请先检查它是否在 Dictionary 中。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-13T22:36:00.913

如果不知道 GetLinks() 做了什么，就很难让代码变得更好。无论如何，这避免了递归。标准习惯用法是在枚举集合时不要更改集合。虽然运行时可以让您这样做，但原因是它是错误的来源，因此最好自己创建一个新集合或控制迭代。

1.  创建一个包含所有 url 的队列。
2.  当出队时，我们几乎说我们已经处理了它，所以将它添加到结果中。
3.  如果 GetLinks() 返回任何内容，请将它们添加到队列中并同时处理它们。

.

```
public List<string> ExpandLinksOrSomething(List<string> urls)
{
    List<string> result = new List<string>();
    Queue<string> queue = new Queue<string>(urls);

    while (queue.Any())
    {
        string url = queue.Dequeue();
        result.Add(url);

        foreach( string newResult in GetLinks(url) )
        {
            queue.Enqueue(newResult);
        }

    }

    return result;
} 
```

天真的实现假定`GetLinks()`不会返回循环引用。例如，A 返回 B，B 返回 A。这可以通过以下方式解决：

```
 List<string> newItems = GetLinks(url).Except(result).ToList();
        foreach( string newResult in newItems )
        {
            queue.Enqueue(newResult);
        } 
```

* 正如其他人指出的那样，根据您处理的项目数量，使用字典可能更有效。

* * *

我觉得奇怪的是 GetLinks() 会返回一个值，然后再将其解析为更多的 Url。也许你想做的只是1级扩展。如果是这样，我们可以完全摆脱队列。

```
public static List<string> StraightProcess(List<string> urls)
{
    List<string> result = new List<string>();

    foreach (string url in urls)
    {
        result.Add(url);
        result.AddRange(GetLinks(url));
    }

    return result;
} 
```

我决定重写它，因为虽然其他答案使用队列，但很明显它们不会永远运行。

# c# - Add my linq query resultset to a dataset, c# asp.net 3.5

> ID：287199
> 
> 赞同：3
> 
> 时间：2008-11-13T15:14:20.523
> 
> 标签：c#, asp.net, linq, data-binding

My query is:

```
var query1 = from u in dc.Usage_Computers.AsEnumerable
             where u.DomainUser == s3
             orderby u.OperationTime descending
             select new
             {
                 u.ProgramVersion,
                 u.OperationTime,
                 u.IPaddress,
                 u.ComputerName,
                 u.DomainUser,
                 u.OnNetwork,
                 Operation = u.Operation == 1 ? "Login" :
                             u.Operation == 2 ? "Logoff" :
                             u.Operation == 3 ? "AGNS Connect" :
                             u.Operation == 4 ? "AGNS Disconnect" :
                             "None"
             };

GridView1.DataSource = query1;
GridView1.DataBind(); 
```

After databinding with gridview I wanted to add the result set "query1" into dataset or datatable.Can anyone give me any idea how to do it?

I saw another post here with same problem but that answer did not work in mine...

**Note: I am using VS 2008 **

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-13T15:26:58.267

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Data;

public static class IEnumerableExt
{
    public static DataTable ToDataTable<T>(this IEnumerable<T> things) where T : class
    {
        DataTable tbl = new System.Data.DataTable();
        bool buildColumns = false;
        foreach (var item in things)
        {
            Type t = item.GetType();
            var properties = t.GetProperties();
            if (!buildColumns)
            {
                foreach (var prop in properties)
                {
                    Type ptype = prop.PropertyType;
                    if (prop.PropertyType.IsGenericType && prop.PropertyType.GetGenericTypeDefinition() == typeof(Nullable<>))
                    {
                        ptype = Nullable.GetUnderlyingType(prop.PropertyType.UnderlyingSystemType);
                    }
                    DataColumn col = new DataColumn(prop.Name, ptype);
                    tbl.Columns.Add(col);
                }
                buildColumns = true;
            }
            DataRow row = tbl.NewRow();

            foreach (var prop in properties)
            {
                if (prop.GetValue(item, null) == null)
                {
                    row[prop.Name] = DBNull.Value;
                }
                else
                {
                    row[prop.Name] = prop.GetValue(item, null);
                }
            }

            tbl.Rows.Add(row);
        }

        return tbl;
    }
} 
```

there is no CopyToDataTable unless your dealing with DataRows look at these:

[http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=2162392&SiteID=1](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=2162392&SiteID=1)

[http://oakleafblog.blogspot.com/2007/03/linq-missing-todatatable-method-saga.html](http://oakleafblog.blogspot.com/2007/03/linq-missing-todatatable-method-saga.html)

good alternative alot more involved than my code: [http://blogs.msdn.com/aconrad/archive/2007/09/07/science-project.aspx](http://blogs.msdn.com/aconrad/archive/2007/09/07/science-project.aspx)

Edit: Updated so it works

# java - 如何持久化 List 类型的属性 在 JPA 中？

> ID：287201
> 
> 赞同：196
> 
> 时间：2008-11-13T15:15:23.860
> 
> 标签：java, orm, jpa

持久化具有 List 类型字段的实体的最聪明方法是什么？

## 命令.java

```
package persistlistofstring;

import java.io.Serializable;
import java.util.ArrayList;
import java.util.List;
import javax.persistence.Basic;
import javax.persistence.Entity;
import javax.persistence.EntityManager;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.Persistence;

@Entity
public class Command implements Serializable {

    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    Long id;
    @Basic
    List<String> arguments = new ArrayList<String>();

    public static void main(String[] args) {
        Command command = new Command();

        EntityManager em = Persistence
                .createEntityManagerFactory("pu")
                .createEntityManager();
        em.getTransaction().begin();
        em.persist(command);
        em.getTransaction().commit();
        em.close();

        System.out.println("Persisted with id=" + command.id);
    }
} 
```

* * *

此代码产生：

```
> Exception in thread "main" javax.persistence.PersistenceException: No Persistence provider for EntityManager named pu: Provider named oracle.toplink.essentials.PersistenceProvider threw unexpected exception at create EntityManagerFactory: 
> oracle.toplink.essentials.exceptions.PersistenceUnitLoadingException
> Local Exception Stack: 
> Exception [TOPLINK-30005] (Oracle TopLink Essentials - 2.0.1 (Build b09d-fcs (12/06/2007))): oracle.toplink.essentials.exceptions.PersistenceUnitLoadingException
> Exception Description: An exception was thrown while searching for persistence archives with ClassLoader: sun.misc.Launcher$AppClassLoader@11b86e7
> Internal Exception: javax.persistence.PersistenceException: Exception [TOPLINK-28018] (Oracle TopLink Essentials - 2.0.1 (Build b09d-fcs (12/06/2007))): oracle.toplink.essentials.exceptions.EntityManagerSetupException
> Exception Description: predeploy for PersistenceUnit [pu] failed.
> Internal Exception: Exception [TOPLINK-7155] (Oracle TopLink Essentials - 2.0.1 (Build b09d-fcs (12/06/2007))): oracle.toplink.essentials.exceptions.ValidationException
> Exception Description: The type [interface java.util.List] for the attribute [arguments] on the entity class [class persistlistofstring.Command] is not a valid type for a serialized mapping. The attribute type must implement the Serializable interface.
>         at oracle.toplink.essentials.exceptions.PersistenceUnitLoadingException.exceptionSearchingForPersistenceResources(PersistenceUnitLoadingException.java:143)
>         at oracle.toplink.essentials.ejb.cmp3.EntityManagerFactoryProvider.createEntityManagerFactory(EntityManagerFactoryProvider.java:169)
>         at javax.persistence.Persistence.createEntityManagerFactory(Persistence.java:110)
>         at javax.persistence.Persistence.createEntityManagerFactory(Persistence.java:83)
>         at persistlistofstring.Command.main(Command.java:30)
> Caused by: 
> ... 
```

* * *

## 回答 #1

> 赞同：223
> 
> 时间：2009-09-15T17:14:43.723

使用一些 JPA 2 实现：它添加了一个类似于 Hibernate 的 @ElementCollection 注释，这正是您需要的。[这里](http://jazzy.id.au/2008/03/24/jpa_2_0_new_features_part_1.html)有一个例子。

**编辑**

正如下面评论中提到的，正确的 JPA 2 实现是

```
javax.persistence.ElementCollection

@ElementCollection
Map<Key, Value> collection; 
```

**请参阅：[http ://docs.oracle.com/javaee/6/api/javax/persistence/ElementCollection.html](http://docs.oracle.com/javaee/6/api/javax/persistence/ElementCollection.html)**

* * *

## 回答 #2

> 赞同：86
> 
> 时间：2018-05-21T11:43:35.843

如果有人正在寻找一种替代解决方案，您可以将字符串列表作为一个字段存储在数据库中，这就是我解决这个问题的方法。像这样创建一个转换器：

```
import java.util.Arrays;
import java.util.List;

import javax.persistence.AttributeConverter;
import javax.persistence.Converter;

import static java.util.Collections.*;

@Converter
public class StringListConverter implements AttributeConverter<List<String>, String> {
    private static final String SPLIT_CHAR = ";";

    @Override
    public String convertToDatabaseColumn(List<String> stringList) {
        return stringList != null ? String.join(SPLIT_CHAR, stringList) : "";
    }

    @Override
    public List<String> convertToEntityAttribute(String string) {
        return string != null ? Arrays.asList(string.split(SPLIT_CHAR)) : emptyList();
    }
} 
```

现在在您的实体上使用它，如下所示：

```
@Convert(converter = StringListConverter.class)
private List<String> yourList; 
```

在数据库中，您的列表将存储为`foo;bar;foobar`，在您的 Java 对象中，您将获得包含这些字符串的列表。

* * *

## 回答 #3

> 赞同：54
> 
> 时间：2019-07-28T13:56:36.100

似乎没有一个答案探讨了[`@ElementCollection`](https://docs.oracle.com/javaee/7/api/javax/persistence/ElementCollection.html)映射最重要的设置。

当您使用此注释映射列表并让 JPA/Hibernate 自动生成表、列等时，它也将使用自动生成的名称。

所以，让我们分析一个基本的例子：

```
@Entity
@Table(name = "sample")
public class MySample {

    @Id
    @GeneratedValue
    private Long id;

    @ElementCollection // 1
    @CollectionTable(name = "my_list", joinColumns = @JoinColumn(name = "id")) // 2
    @Column(name = "list") // 3
    private List<String> list;

} 
```

1.  基本`@ElementCollection`注释（您可以在其中定义已知`fetch`和`targetClass`首选项）
2.  当[`@CollectionTable`](https://docs.oracle.com/javaee/7/api/javax/persistence/CollectionTable.html)为将要生成的表命名时，注释非常有用，以及像`joinColumns`, `foreignKey`'s, `indexes`,`uniqueConstraints`等定义。
3.  `@Column`定义将存储`varchar`列表值的列的名称很重要。

生成的 DDL 将是：

```
-- table sample
CREATE TABLE sample (
  id bigint(20) NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (id)
);

-- table my_list
CREATE TABLE IF NOT EXISTS my_list (
  id bigint(20) NOT NULL,
  list varchar(255) DEFAULT NULL,
  FOREIGN KEY (id) REFERENCES sample (id)
); 
```

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2008-11-13T15:34:46.943

这个答案是在 JPA2 之前实现的，如果您使用的是 JPA2，请参阅上面的 ElementCollection 答案：

模型对象内的对象列表通常被认为是与另一个对象的“OneToMany”关系。但是，字符串（本身）不是一对多关系的允许客户端，因为它没有 ID。

因此，您*应该*将字符串列表转换为包含 ID 和字符串的 Argument 类 JPA 对象列表。您可能会使用字符串作为 ID，这样可以节省表中的一点空间，既可以删除 ID 字段，也可以合并字符串相等的行，但是您将无法将参数重新排序为原始顺序（因为您没有存储任何订购信息）。

或者，您可以将列表转换为 @Transient 并将另一个字段 (argStorage) 添加到您的类中，该字段是 VARCHAR() 或 CLOB。然后，您需要添加 3 个函数：其中 2 个是相同的，并且应该将您的字符串列表转换为单个字符串（在 argStorage 中），以您可以轻松分隔它们的方式分隔。用@PrePersist 和@PreUpdate 注释这两个函数（它们都做同样的事情）。最后，再次添加将 argStorage 拆分为字符串列表的第三个函数，并将其注释为 @PostLoad。这将在您存储命令时使用字符串更新您的 CLOB，并在将 argStorage 字段存储到数据库之前保持更新。

我仍然建议做第一个案例。这是以后真正建立关系的好习惯。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2008-11-13T15:26:32.717

根据[Java Persistence with Hibernate](http://manning.com/bauer2/)

> 使用注释映射值类型的集合 [...]。在撰写本文时，它不是 Java Persistence 标准的一部分

如果您使用的是 Hibernate，则可以执行以下操作：

```
@CollectionOfElements(targetElement = String.class)
@JoinTable(name = "foo", joinColumns = @JoinColumn(name = "foo_id"))
@IndexColumn(name = "POSITION", base = 1)
@Column(name = "baz", nullable = false)
private List<String> arguments = new ArrayList<String>(); 
```

***更新：注意，这现在在 JPA2 中可用。***

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2017-08-08T16:58:49.600

我们也可以使用这个。

```
@Column(name="arguments")
@ElementCollection(targetClass=String.class)
private List<String> arguments; 
```

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2008-12-24T11:38:39.863

在使用 JPA 的 Hibernate 实现时，我发现只需将类型声明为 ArrayList 而不是 List 就可以让 hibernate 存储数据列表。

显然，与创建实体对象列表相比，这有许多缺点。没有延迟加载，无法从其他对象引用列表中的实体，可能更难构建数据库查询。但是，当您处理相当原始类型的列表时，您总是希望与实体一起急切地获取，那么这种方法对我来说似乎很好。

```
@Entity
public class Command implements Serializable {

    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    Long id;

    ArrayList<String> arguments = new ArrayList<String>();

} 
```

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2009-12-21T16:07:59.993

我遇到了同样的问题，所以我投资了给出的可能解决方案，但最后我决定实施我的';' 分隔的字符串列表。

所以我有

```
// a ; separated list of arguments
String arguments;

public List<String> getArguments() {
    return Arrays.asList(arguments.split(";"));
} 
```

这样列表在数据库表中很容易阅读/编辑；

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2016-11-20T21:52:20.007

好的，我知道它有点晚了。但是对于那些随着时间的流逝会看到这一点的勇敢的灵魂。

如[文档](http://docs.oracle.com/javaee/6/api/javax/persistence/Basic.html)中所述：

> @Basic：映射到数据库列的最简单类型。Basic 注释可以应用于以下任何类型的持久属性或实例变量：Java 原始类型、[...]、枚举和任何其他实现 java.io.Serializable 的类型。

重要的部分是**实现 Serializable 的类型**

到目前为止，最简单和最容易使用的解决方案是简单地使用 ArrayList 而不是 List（或任何可序列化容器）：

```
@Basic
ArrayList<Color> lovedColors;

@Basic
ArrayList<String> catNames; 
```

但是请记住，这将使用系统序列化，因此需要付出一些代价，例如：

*   如果序列化对象模型发生变化，您可能无法恢复数据

*   为存储的每个元素添加了少量开销。

简而言之

存储标志或少量元素非常简单，但我不建议使用它来存储可能会变大的数据。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2017-05-29T07:36:26.457

蒂亚戈的回答是正确的，添加更具体到问题的示例，**@ElementCollection**将在您的数据库中创建新表，但没有映射两个表，这意味着该集合不是实体的集合，而是简单类型（字符串等）的集合.) 或可嵌入元素的集合（使用**@Embeddable**注释的类）。

这是持久化**字符串列表的示例**

```
@ElementCollection
private Collection<String> options = new ArrayList<String>(); 
```

这是保留**自定义对象列表的示例**

```
@Embedded
@ElementCollection
private Collection<Car> carList = new ArrayList<Car>(); 
```

对于这种情况，我们需要使类**Embeddable**

```
@Embeddable
public class Car {
} 
```

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2020-04-17T10:44:55.970

这是使用 @Converter 和 StringTokenizer 存储 Set 的解决方案。对[@jonck-van-der-kogel](https://stackoverflow.com/users/718849/jonck-van-der-kogel)解决方案进行更多检查。

在您的实体类中：

```
@Convert(converter = StringSetConverter.class)
@Column
private Set<String> washSaleTickers; 
```

字符串集转换器：

```
package com.model.domain.converters;

import javax.persistence.AttributeConverter;
import javax.persistence.Converter;
import java.util.HashSet;
import java.util.Set;
import java.util.StringTokenizer;

@Converter
public class StringSetConverter implements AttributeConverter<Set<String>, String> {
    private final String GROUP_DELIMITER = "=IWILLNEVERHAPPEN=";

    @Override
    public String convertToDatabaseColumn(Set<String> stringList) {
        if (stringList == null) {
            return new String();
        }
        return String.join(GROUP_DELIMITER, stringList);
    }

    @Override
    public Set<String> convertToEntityAttribute(String string) {
        Set<String> resultingSet = new HashSet<>();
        StringTokenizer st = new StringTokenizer(string, GROUP_DELIMITER);
        while (st.hasMoreTokens())
            resultingSet.add(st.nextToken());
        return resultingSet;
    }
} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2012-04-25T12:34:47.837

我对这个问题的解决方法是将主键与外键分开。如果您使用 eclipse 并进行了上述更改，请记得刷新数据库资源管理器。然后从表中重新创建实体。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2021-05-20T08:52:38.620

我想要的是一种在表格列中持久保存一组字符串的简单方法。

我最终使用了 JSON，因为 MySQL 5.7+ 具有原生支持。这是我的解决方案

```
 @Column(name = "eligible_approvers", columnDefinition = "json")
    @Convert(converter = ArrayJsonConverter.class)
    private Set<String> eligibleApprovers; 
```

然后写一个很基础的转换器

```
@Converter(autoApply = true)
public class ArrayJsonConverter implements AttributeConverter<Set, String> {

    static final ObjectMapper mapper = new ObjectMapper();

    @Override
    public String convertToDatabaseColumn(Set list) {
        if (list == null)
            return null;
        try {
            return mapper.writeValueAsString(list);
        } catch (JsonProcessingException e) {
            throw new RuntimeException(e);
        }
    }

    @Override
    public Set convertToEntityAttribute(String dbJson) {
        if (dbJson == null)
            return null;
        try {
            return mapper.readValue(dbJson, new TypeReference<Set<String>>() {
            });
        } catch (JsonProcessingException e) {
            throw new RuntimeException(e);
        }
    }
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-12-10T12:09:19.687

由于我的声誉还不足以评论@razvang 写的被低估的答案：

正如十多年前提出的这个问题一样，请记住，从那时起，世界大部分地区都发生了变化。我们现在拥有支持本机 JSON 列的数据库，并且可以使用此功能，而不是使用其他答案使用的单独实体、连接或自定义字符串到列表转换器。

不过，让我建议对@razvang 的出色答案进行两个纯可选的更改，根据*您的具体情况*，这可能会很有趣：

1.  您可以省略`auto_apply = true`和添加`@Convert(converter = <CONVERTER_CLASS_NAME>.class)`到实体字段以控制何时使用转换器。
2.  您可以在此处处理错误（例如传递一个空列表并写入一条日志消息），而不是在转换失败时抛出一个`RuntimeException`错误，以使其稍微优雅地失败。

# python - Python程序启动

> ID：287204
> 
> 赞同：22
> 
> 时间：2008-11-13T15:16:35.153
> 
> 标签：python

我应该用以下方式启动 Python 程序：

```
if__name__ == '__main__':
some code... 
```

如果是这样，为什么？我看过很多次，但没有任何线索。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-11-13T15:20:28.127

如果您的程序可用作库，但您也有一个主程序（例如，用于测试库），则该构造允许其他人将文件作为库导入而不运行您的主程序。如果您的程序名为 foo.py 并且您从另一个 python 文件执行“import foo”，则`__name__`计算结果为`'foo'`，但如果您从命令行运行“python foo.py”，则`__name__`计算结果为`'__main__'`.

请注意，您确实需要在 if 和 _ 之间插入一个空格，并缩进主程序：

```
if __name__ == '__main__':
    main program here 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-11-13T15:26:28.380

一个更好的模式是这样的：

```
def main():
   ...

if __name__ == '__main__':
   main() 
```

这允许您的代码被导入它的人调用，同时也使[pychecker](http://pychecker.sourceforge.net/)和[pylint](http://www.logilab.org/projects/pylint)等程序工作。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-11-13T17:09:51.290

Guido Van Rossum[建议](http://www.artima.com/weblogs/viewpost.jsp?thread=4829)：

```
def main(argv=None):
  if argv is None:
    argv = sys.argv
  ...

if __name__ == "__main__":
    sys.exit(main()) 
```

这样，您可以`main()`从其他地方运行（提供参数），并且如果您想从 退出并返回错误代码`return 1`，`main()`并且它不会错误地使交互式解释器退出。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-13T15:25:37.210

这是一个很好的做法。首先，它清楚地标记了您的模块入口点（假设您在顶层没有任何其他可执行代码 - 呸）。其次，它使您的模块无需执行即可被其他模块导入，这是一些工具（如代码检查器、打包器等）需要做的。

# erlang - 当数据不适合内存时，适合 Erlang 应用程序的数据存储后端

> ID：287233
> 
> 赞同：4
> 
> 时间：2008-11-13T15:25:03.093
> 
> 标签：erlang, mnesia, data-storage, dets

我正在研究如何为 Erlang 应用程序组织数据存储的可能选项。它应该使用的数据基本上是由短字符串 id 索引的大量二进制 blob 集合。每个 blob 小于 10 Kb，但其中有很多。我希望它们的总大小可达 200 Gb，因此显然它无法装入内存。对该数据的典型操作是通过其 id 读取 blob 或通过其 id 更新 blob 或添加新的 blob。在一天中的每个给定时间段，只有一个 id 子集被使用，因此数据存储访问性能可能会受益于内存缓存。谈到性能 - 这是非常关键的。目标是在商用硬件（比如 EC2 VM）上每秒进行大约 500 次读取和 500 次更新。

有什么建议在这里使用吗？据我了解，dets 是毫无疑问的，因为它仅限于 2G（或者是 4G？）。Mnesia 也可能没有问题；我的印象是它主要是为数据适合内存的情况设计的。我正在考虑尝试 EDTK 的 Berkeley DB 驱动程序来完成这项任务。它会在上述情况下工作吗？有没有人有在类似条件下在生产中使用它的经验？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-25T17:22:00.340

[tcerl](http://dukesoferl.blogspot.com/2008/06/tokyocabinet-and-mnesia.html)面临相同的大小限制。这些天我没有使用 Erlang，但这听起来像你在找的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-25T16:58:57.453

你看过 CouchDB 在做什么吗？它可能不是您所追求的产品，但其中有很多用于存储数据的 erlang 代码。还有一些关于提供本机 erlang 接口而不是 REST api 的讨论。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-25T20:31:49.647

有什么理由不能只使用文件系统，将文件名视为字符串 id，将文件内容视为二进制 blob？您可以选择一个适合您的性能要求的（文件系统），并且您应该基本上免费获得由您的操作系统提供的缓存。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-17T18:34:57.060

Mnesia 可以很好地将数据存储在磁盘上。还有大致类似于 Berkeley DB 的 dets（基于磁盘的术语存储）。它在标准库中：[http ://www.erlang.org/doc/apps/stdlib/index.html](http://www.erlang.org/doc/apps/stdlib/index.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-07T16:42:55.923

我会推荐 Apache CouchDB。

它非常适合 Erlang，并且从它的声音（您提到基于 ID 的 blob 并且没有提及任何关系要求）来看，您正在寻找一个面向文档的数据库。

由于接口是 REST，如果需要缓存，您可以非常简单地在其前面添加商品 HTTP 缓存。

CouchDB 的文档质量非常高。

它还具有内置的 Map-Reduce :)

# custom-error-pages - 专业和有用的错误页面示例

> ID：287236
> 
> 赞同：6
> 
> 时间：2008-11-13T15:26:04.340
> 
> 标签：custom-error-pages

你见过哪些现实生活中的错误网页给你留下了深刻的印象，并且对所有类型的用户（精明的、新手、悠闲的、沮丧的等）都真正有用。为什么你对这个错误印象深刻？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T15:35:24.633

查看[此](http://www.artlebedev.com/mandership/93/)页面，您将知道如何创建正确的 404 页面 :)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-13T15:34:10.780

不完全专业，但它明白了这一点： [http ://www.thecenter2000.com/last/](http://www.thecenter2000.com/last/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-13T15:49:27.397

它不仅是网页，而且[About Face](http://www.amazon.co.uk/About-Face-Essentials-Window-Interface/dp/1568843224)（Alan Cooper 的书）有一个关于错误消息的好部分。就像是：

*   发生了什么。通俗地说。

*   这对用户有何影响。他们是否丢失了数据？只是烦恼？

*   他们现在应该做什么（重新启动，再试一次等​​）

并将techo信息放在隐藏区域（即，单击此处获取螺旋桨头版本）

我在 WinForms 中为一个项目做了这个，效果很好，虽然我们没有从客户那里得到太多反馈（虽然他们也没有抱怨）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-13T15:35:37.253

Firefox 扩展“复活页面”。这取代了 Firefox 的标准错误页面，该页面提供了相当丰富的信息，但只有一点点有用，一个页面同样提供信息，但也为用户提供了一些工具来帮助解决该问题。

[http://trac.arantius.com/wiki/Extensions/Resurrect#Screenshots](http://trac.arantius.com/wiki/Extensions/Resurrect#Screenshots)

编辑：是的，我知道它本身不是一个网页，但是没有理由一个实际的网页不能至少这么好和有用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-13T15:32:47.320

Stackoverflow :) 使用我的 claimID 时出错，...

我在错误消息/网站上读到的好处是，这不是我的错，而是由于内部错误（还有可选的联系人）

为什么我认为这令人印象深刻？

有数以千计的站点，您在其中遇到错误，它只是说“404”或“错误，再试一次” - 如果我可能做错了什么或内部问题，或者......

# javascript - JavaScript 模态对话框能否仅对选项卡而不是整个浏览器窗口模态？

> ID：287242
> 
> 赞同：6
> 
> 时间：2008-11-13T15:29:28.310
> 
> 标签：javascript, modal-dialog

现代浏览器具有多选项卡界面，但 JavaScript 函数`window.showModalDialog()`会创建一个模式对话框来阻止*所有*选项卡。

我想知道是否有一种方法可以创建一个仅阻止创建它的选项卡的模式对话框？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-13T15:33:50.890

您可以使用更“类似 Ajax”的模式对话框之一，它只是绝对定位的 div，浮动在其他所有内容之上。

这些是“文档”而不是浏览器的模式。

例如看看[这个 jQuery 插件](http://www.ericmmartin.com/projects/simplemodal/)

PS`showModalDialog()`是一个仅限 IE 的调用，因此您可能不想完全使用它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T15:46:13.253

没有。可以想象，IE8 的“松散耦合”在某些时候可能会表现得像这样，但在当前的 beta 版本中并没有。

我赞同 Michiel 的建议。通过隐藏页面的其余部分、在顶部浮动一个 div 并在完成后调用脚本来工作的伪模态对话是：

*   比真正的模态对话框更有用/更不烦人
*   兼容任何浏览器

showModalDialog/showModelessDialog 本身通常是要避免的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-31T05:22:10.150

[Firefox 3 支持 window.showModalDialog](https://developer.mozilla.org/en/DOM/window.showModalDialog)（但它也阻止所有选项卡）。

# ms-office - 是否可以为 Microsoft Office Communicator 开发插件？

> ID：287248
> 
> 赞同：3
> 
> 时间：2008-11-13T15:31:35.030
> 
> 标签：ms-office, chat, office-communicator

是否可以为 Microsoft Office Communicator 开发插件？如果是这样，从哪里开始 - 是否有 SDK？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-25T10:43:17.803

自[定义选项卡](http://www.microsoft.com/downloads/details.aspx?FamilyId=621C675C-46B7-4F68-ADDC-9F44E5594BFB&displaylang=en)示例应用程序可能正是您正在寻找的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T15:34:11.483

[SDK](http://www.microsoft.com/downloads/details.aspx?FamilyID=ed1cce45-cc22-46e1-bd50-660fe6d2c98c&displaylang=en)是一个很好的起点。我不确定你是否可以为它创建插件，但由于它有一个 API，你绝对可以从外部应用程序或网页中连接到它。

# c++ - 用于 linux 的最小 c++ make 文件

> ID：287259
> 
> 赞同：25
> 
> 时间：2008-11-13T15:35:15.303
> 
> 标签：c++, makefile, compilation

我正在寻找一个简单的推荐用于 linux 的“最小”c++ makefile，它将使用 g++ 编译和链接单个文件和 h 文件。理想情况下，make 文件中甚至没有物理文件名，只有 .cpp 到 .o 的转换。生成这样一个 makefile 而不深入到 autoconf 的恐怖中的最佳方法是什么？

当前目录包含，例如

t.cpp th

我想要一个生成文件来创建它。我尝试了 autoconf，但它假设 .h 是 gcc 而不是 g++。是的，虽然不是初学者，但我正在从几年前重新学习项目操作的最佳方法，因此正在寻找自动化的方法来为小型项目创建和维护 makefile。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-11-13T15:36:40.277

如果是单个文件，可以输入

```
make t 
```

它会调用

```
g++ t.cpp -o t 
```

这甚至不需要目录中的 Makefile，尽管如果你有一个 t.cpp 和一个 tc 和一个 t.java 等等，它会变得混乱。

也是一个真正的 Makefile：

```
SOURCES := t.cpp
# Objs are all the sources, with .cpp replaced by .o
OBJS := $(SOURCES:.cpp=.o)

all: t

# Compile the binary 't' by calling the compiler with cflags, lflags, and any libs (if defined) and the list of objects.
t: $(OBJS)
    $(CC) $(CFLAGS) -o t $(OBJS) $(LFLAGS) $(LIBS)

# Get a .o from a .cpp by calling compiler with cflags and includes (if defined)
.cpp.o:
    $(CC) $(CFLAGS) $(INCLUDES) -c $< 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-11-13T15:52:34.253

这是我的代码片段目录中的通用生成文件：

```
SOURCES=$(wildcard *.cpp)
OBJECTS=$(SOURCES:.cpp=.o)
DEPS=$(SOURCES:.cpp=.d)
BINS=$(SOURCES:.cpp=)

CFLAGS+=-MMD
CXXFLAGS+=-MMD

all: $(BINS)

.PHONY: clean

clean:
    $(RM) $(OBJECTS) $(DEPS) $(BINS)

-include $(DEPS) 
```

只要您有一个生成一个二进制文件的 .cpp 源，您就不需要其他任何东西了。我只将它与 GNU make 一起使用，并且依赖项生成使用 gcc 语法（也受 icc 支持）。如果您使用的是 SUN 编译器，则需要将“-MMD”更改为“-xMMD”。此外，请确保在`clean:`粘贴此代码时行首的制表符不会更改为空格，否则`make`会出现缺少分隔符的错误。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-13T15:43:06.753

你看过[SCons](http://www.scons.org/)吗？

只需使用以下内容创建一个 SConstruct 文件：

```
Program("t.cpp") 
```

然后输入：

```
scons 
```

完毕！

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-13T15:44:00.370

假设没有预配置的系统范围`make`设置：

```
CXX = g++
CPPFLAGS =        # put pre-processor settings (-I, -D, etc) here
CXXFLAGS = -Wall  # put compiler settings here
LDFLAGS =         # put linker settings here

test: test.o
    $(CXX) -o $@ $(CXXFLAGS) $(LDFLAGS) test.o

.cpp.o:
    $(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $<

test.cpp: test.h 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-01-31T13:04:05.557

一个相当小的 GNU Makefile，使用预定义的规则和自动依赖：

```
CC=c++
CXXFLAGS=-g -Wall -Wextra -MMD
LDLIBS=-lm
program: program.o sub.o
clean:
    $(RM) *.o *.d program
-include $(wildcard *.d) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-14T09:08:23.883

你看过[OMake](http://omake.metaprl.org/manual/omake-doc.html)吗？

**OMakeroot**

```
open build/C
DefineCommandVars()
.SUBDIRS: . 
```

**生成文件**

```
.DEFAULT: $(CXXProgram test, test) 
```

然后在 Linux 或 Windows 上，只需键入：

```
omake 
```

作为奖励，您将自动获得：

*   使用 -j 选项进行并行构建（与 make 相同）。
*   MD5 校验和而不是时间戳（构建对时间同步失败具有弹性）。
*   自动和准确的 C/C++ 头文件依赖项。
*   准确的目录间依赖关系（递归 make 不提供的东西）。
*   可移植性（1 个构建链来统治它们，不受路径样式问题的影响）。
*   一种真正的编程语言（比 GNU make 更好）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-13T15:46:46.560

关于创建基本 Makefile 的一些很好的参考资料

[http://en.wikipedia.org/wiki/Make_（软件）](http://en.wikipedia.org/wiki/Make_(software))

[http://mrbook.org/tutorials/make/](http://mrbook.org/tutorials/make/)

[http://www.opussoftware.com/tutorial/TutMakefile.htm](http://www.opussoftware.com/tutorial/TutMakefile.htm)

[http://www.hsrl.rutgers.edu/ug/make_help.html](http://www.hsrl.rutgers.edu/ug/make_help.html)

特别是第一对像您描述的那样具有最小的示例 Makefile。希望有帮助。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-14T00:53:14.083

带有调试选项的 SConstruct：

```
env = Environment()

if ARGUMENTS.get('debug', 0):
    env.Append(CCFLAGS = ' -g')

env.Program( source = "template.cpp" ) 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-14T08:18:35.823

弗洛林有一个很好的起点。我不喜欢 gnu autoconf，所以我从那里开始并进一步了解了这个概念并将其称为 MagicMakefile。我有 3 个版本，从简单到复杂。最新的现在在 github 上：[https ://github.com/jdkoftinoff/magicmake](https://github.com/jdkoftinoff/magicmake)

基本上，它假定您有项目源文件的标准布局，并使用通配符函数动态创建生成文件规则，然后对其进行评估，处理头文件依赖关系、交叉编译、单元测试、安装和包装。

[编辑] 此时我将 cmake 用于我的所有项目，因为它为许多构建系统生成有用的项目文件。

杰夫·科夫蒂诺夫

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-01-27T23:20:03.593

我正在寻找一个最小的 Makefile 可能看起来像什么，而不是

```
some_stuff:
    @echo "Hello World" 
```

我知道我参加这个聚会迟到了，但我想我也会把帽子扔进戒指。以下是我使用多年的一个目录项目 Makefile。稍加修改即可使用多个目录（例如 src、obj、bin、header、test 等）。假设所有头文件和源文件都在当前目录中。并且，必须给项目一个名称，用于输出二进制名称。

```
NAME = my_project

FILES = $(shell basename -a $$(ls *.cpp) | sed 's/\.cpp//g')
SRC = $(patsubst %, %.cpp, $(FILES))
OBJ = $(patsubst %, %.o, $(FILES))
HDR = $(patsubst %, -include %.h, $(FILES))
CXX = g++ -Wall

%.o : %.cpp
        $(CXX) $(HDR) -c -o $@ $<

build: $(OBJ)
        $(CXX) -o $(NAME) $(OBJ)

clean:
        rm -vf $(NAME) $(OBJ) 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-11-13T15:45:06.530

如果您的问题是因为 autoconf 认为 .h 文件是 ac 文件，请尝试将其重命名为 .hpp 或 .h++

# asp.net - asp.net wiki 用户控制

> ID：287266
> 
> 赞同：0
> 
> 时间：2008-11-13T15:36:44.457
> 
> 标签：asp.net, user-controls, wiki, web-controls

我正在编写一个 asp.net Web 应用程序，我希望用户能够将简单的格式应用于他们在文本区域中输入的文本。

其中一种可能性是使用 javascript wisywig 编辑器（如 tinymce）。但是，为了保持文本 html-clean 和可读性，我希望用户必须以与在 wiki 中完全相同的方式自己进行格式化。

我在网上找不到免费或不太昂贵的控件。有人用过第三方控件吗？对此有何建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T16:10:02.860

您可以使用这样的降价编辑器：

[http://wmd-editor.com/](http://wmd-editor.com/)

然后你希望能够用 HTML 显示结果：

[http://aspnetresources.com/blog/markdown_announced.aspx](http://aspnetresources.com/blog/markdown_announced.aspx)

本质上，这就是[StackOverflow](http://Stackoverflow.com)所做的（通过他们的定制）。[他们在播客](https://stackoverflow.fogbugz.com/default.asp?W12621)中讨论他们是如何做到的。

# unit-testing - 在 Team Foundation Server (TFS) 构建上运行单元测试

> ID：287271
> 
> 赞同：24
> 
> 时间：2008-11-13T15:37:41.477
> 
> 标签：unit-testing, tfs, installation, mstest

在给定构建运行时，让 Team Foundation Server 运行单元测试的步骤是什么？

首次设置 TFS 服务器以执行此操作时，开发人员或系统管理员应注意哪些警告/陷阱/解决方法？

构建期间单元测试问题的常见故障排除步骤是什么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-14T08:30:14.693

这取决于您运行的 TFS 版本，所以我假设它是 2008。

首先，您必须在将充当构建代理的计算机上安装 Team Edition for Testers，如[如何：创建构建定义中所述](http://msdn.microsoft.com/en-us/library/ms181716.aspx)

有几种方法可以告诉 Team Build 为您的构建运行测试。

1.  单元测试可以从正在构建的解决方案中定义的测试列表运行。此列表由构建定义引用，并执行所选列表中的所有测试。更多信息[在这里](http://msdn.microsoft.com/en-us/library/ms182461.aspx)
2.  通配符测试也可以通过定义通配符掩码（即 Test*.dll）来执行，该掩码指示 Team Build 运行与掩码匹配的程序集中存在的任何测试。这也是在定义构建定义时完成的。

*注意事项：*

如果您打算使用通配符方法并希望为您的测试配置启用代码覆盖率，则必须将以下内容添加到您的构建定义文件中以启用它。

```
<RunConfigFile>$(SolutionRoot)\TestRunConfig.testrunconfig</RunConfigFile> 
```

有关更多信息，请参阅我之前的[问题](https://stackoverflow.com/questions/80486/how-do-you-turn-on-code-coverage-in-builds-within-tfs)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-15T15:02:22.170

如果您不想使用测试配置（管理起来很麻烦），只需将其添加到构建配置中即可在 .dll 中运行所有测试：

```
<ItemGroup>
    <TestContainerInOutput Include="MyProject.UnitTests.dll" />
</ItemGroup> 
```

整个过程顺利且相当简单。您可以通过在本地打开测试结果文件来检查构建服务器上的单元测试（有点痛苦），但通常您只需在本地运行单元测试，您就可以立即看到结果。

如果您习惯于 NUnit，您可以选择按类名对测试进行排序，它提供了类似的视图。

小心代码覆盖率，它会在编译时生成二进制文件的完整副本。如果你的二进制文件足够大并且你经常编译，它会很快耗尽驱动器空间。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-05-23T00:54:14.693

[http://msdn.microsoft.com/en-us/library/cc981972(v=vs.90).aspx](http://msdn.microsoft.com/en-us/library/cc981972%28v=vs.90%29.aspx)

我喜欢这个定义，因为它为您提供了一个完整的“演练”，从创建项目创建单元测试项目到配置团队构建以使用它单元测试

# visual-studio - 在项目中重写方法

> ID：287274
> 
> 赞同：1
> 
> 时间：2008-11-13T15:38:17.420
> 
> 标签：visual-studio, refactoring

作为一个成长中的开发团队，我们开始遇到重写以相似/相同方式运行的函数的问题。

我们都为未能编写文档而感到内疚，因为时间是一个限制因素，但是收集所有当前功能（重复和全部）并使用该列表以及应用的关键字和方法摘要来识别当前方法的想法在我们重写它们之前已提出。

现在，在我去写一个解决方案之前，我只是想确保那里没有一个完美的解决方案，我已经完成了显而易见的事情并进行了一些搜索，但是谷歌搜索 Visual Studio + 返回函数列表和其他变体令人惊讶地返回不是一大堆。

任何建议将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T15:47:58.070

一种选择是使用 Obsolete 属性标记可疑函数并计算引发的警告。重复冗余功能。使用它，您可以找出调用更多的方法，并省去在更多位置更新它的工作。这当然假设函数具有不同的签名，并且简单的查找和替换操作不能解决您的问题。

与任何大型事业一样，您可能不应该一次完成所有工作。当发现可疑函数时，一次处理一个，并逐渐将多余的代码重构出系统。这样你就不会在前面花费太多时间，而是在不断进步。

# optimization - 特定例程的性能指标：任何最佳实践？

> ID：287278
> 
> 赞同：6
> 
> 时间：2008-11-13T15:39:25.903
> 
> 标签：optimization, performance

我想收集关于我的代码的特定例程的指标，看看我可以在哪里进行最佳优化。举个简单的例子，假设我有一个包含多个“学生”的“班级”数据库。假设当前代码为每个学生调用数据库，而不是一次批量获取所有学生。我想看看每个学生行每次访问数据库需要多长时间。

这是在 C# 中，但我认为它适用于任何地方。通常当我对特定例程的性能感到好奇时，我会在它运行之前创建一个 DateTime 对象，运行该例程，然后在调用之后创建另一个 DateTime 对象，并取两者之间的毫秒差来查看它运行了多长时间. 通常我只是在页面的跟踪中输出它......所以它有点低保真。有什么最佳实践吗？我想过能够将网络应用程序置于某种“诊断”模式，并使用我所追求的任何东西进行详细的日志记录/事件日志写入，但我想看看 stackoverflow 蜂巢思维是否有更好的主意。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T15:53:06.953

对于数据库查询，您有两个小问题。缓存：数据缓存和语句缓存。

如果您运行一次查询，则该语句将被解析、准备、绑定和执行。数据从文件中提取到缓存中。

当您第二次执行查询时，会使用缓存，并且性能通常要好得多。

哪个是“真正的”性能数字？第一个还是第二个？有些人说“最坏情况”是真实数字，我们必须优化它。其他人说“典型案例”并运行两次查询，忽略第一次。其他人说“平均”并运行 30 次，平均所有这些。其他人说“典型平均值”，运行 31 次并平均最后 30 次。

我建议“31 个中的最后 30 个”是最有意义的数据库性能数字。不要为你无法控制（解析、准备、绑定）的事情出汗。出汗你可以控制的东西——数据结构、I/O 加载、索引等。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T15:51:47.890

我有时会使用这种方法，发现它相当准确。问题在于，在具有大量调试日志的大型应用程序中，在日志中搜索这些信息可能会很痛苦。所以我使用外部工具（我主要用 Java 编程，并使用 JProbe），它允许我查看我的方法的平均和总时间，特定方法专门花费了多少时间（而不是该方法花费的累积时间）和它调用的任何方法），以及内存和资源分配。

这些工具可以帮助您衡量整个应用程序的性能，如果您在性能很重要的领域进行大量开发，您可能需要研究可用的工具并学习如何使用它们。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T15:53:34.033

有一些[Profiler](http://nprof.sourceforge.net/Site/Description.html)可用，但坦率地说，我认为您的方法更好。探查器方法是矫枉过正的。如果您完全不知道瓶颈在哪里，也许使用分析器是值得的。我宁愿花一点时间预先分析问题并放置一些战略性的打印语句，也不愿弄清楚如何为您的应用程序进行分析，然后倾注大量报告，其中每个可执行代码行都是定时的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T15:56:03.700

如果您正在使用 .NET，那么我建议您查看[Stopwatch](http://msdn.microsoft.com/en-us/library/system.diagnostics.stopwatch.aspx)类。您从中得到的时间将比使用 DateTime 的等效样本准确得多。

我还建议查看[ANTS Profiler](http://www.red-gate.com/Products/ants_profiler/index.htm)以了解性能非常重要的场景。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-13T16:52:49.953

值得考虑投资一个好的商业分析器，特别是如果您希望第二次这样做。

我使用的[JProfiler](http://www.ej-technologies.com/products/jprofiler/overview.html)在 Java 世界中工作，并且可以附加到已经运行的应用程序，因此不需要特殊的工具（至少对于较新的 JVM）。

它非常快速地在您的代码中构建一个排序的热点列表，显示您的代码大部分时间都在其中花费的方法。默认情况下，它非常智能地过滤，并允许您在需要时进一步调整过滤，这意味着您可以忽略第三方库的细节，同时挑选出那些一直在使用的方法。

此外，您还会获得许多其他有用的关于您的代码正在做什么的报告。它在我第一次使用它时节省了许可证的费用；我不必添加大量日志语句并构建一种机制来分析输出：分析器的开发人员已经为我完成了所有这些工作。

除了成为一个非常满意的客户外，我与 ej-technologies 没有任何关系。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-17T14:55:26.973

有时您采用的方法可以让您最好地了解应用程序的性能。我可以推荐的一件事是使用 System.Diagnostics.Stopwatch 而不是 DateTime ， DateTime 的准确度最高为 16 ms，而 Stopwatch 的准确度最高可达 cpu 滴答声。

但我建议使用自定义性能计数器来补充它，以便在开发期间在分析器下运行应用程序。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-13T15:45:15.767

我使用这种方法，我认为它非常准确。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-13T16:01:29.167

我认为你有一个很好的方法。我建议您在日志文件中生成“机器友好”记录，以便您可以更轻松地解析它们。类似 CSV 或其他分隔的记录，结构一致。

# c# - 如何对 FileSystemWatcher 事件进行单元测试？

> ID：287279
> 
> 赞同：5
> 
> 时间：2008-11-13T15:40:26.477
> 
> 标签：c#, unit-testing, filesystemwatcher

我正在开发一个处理转储到目标目录中的文档的系统。我通过检测 FileSystemWatcher OnChanged 事件来获取文件。

作为单元测试的一部分，我应该如何自动化呢？我应该如何组织比较的输入文件和输出文件以验证转换是否正确？这是否可以通过发出 diff 命令的批处理文件更好地处理？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-13T15:44:12.227

好吧，首先考虑一下您要测试的到底是什么。

是不是在你检测到一个文件有变化之后，它就被正确处理了？

还是 FileSystemWatcher 类有效？

还是操作系统以正确的顺序向您发送正确的通知（*正确*的意思基本上是*您所期望的*）？

如果只需要完成处理，我会考虑模拟观察者类，或者使用 IoC 容器为您提供触发单元测试事件的东西。

如果操作系统是否以正确的顺序提供正确的事件，那么我会模拟处理文件的代码，只是为了保存状态“是的，我被告知该文件已更改”，然后进行单元测试然后将操作临时目录中的文件。

但是请注意，您的单元测试所依赖的外部复杂性越多，它就越容易被破坏。

# jquery - jQuery：req.readyState == 3 可能吗？

> ID：287286
> 
> 赞同：2
> 
> 时间：2008-11-13T15:42:04.197
> 
> 标签：jquery, ajax

我是 jQuery 的忠实粉丝，我将它用于 95% 的 Javascript 需求。但是，我正在使用 COMET 方法加载实时页面；在 Javascript 中，我使用 AJAX 在`req.readyState == 3`. 我很好奇是否也可以使用 jQuery 来执行此操作`$.ajax`（我在文档中找不到任何内容）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-02-23T22:00:52.383

如[https://coderwall.com/p/gi-f2g/accessing-the-xhr-object-in-jquery-s-ajax中所述](https://coderwall.com/p/gi-f2g/accessing-the-xhr-object-in-jquery-s-ajax)

```
var xhr = $.ajaxSettings.xhr();

//Do what you want with the XHR Object. For Example:

xhr.upload.addEventListener( function( event ) {
//CODE!!!
}, false );

//Store the XHR in a closure.
function xhrProvider() { 
    return xhr;
}

//Then when using $.ajax specifiy a custom xhr like this:
$.ajax( {
    url: 'http://w00wz3rs.com',
    xhr: xhrProvider
} ); 
```

# .net - ListView 空标记文本

> ID：287298
> 
> 赞同：2
> 
> 时间：2008-11-13T15:45:37.827
> 
> 标签：.net, winforms, listview, windows-vista, interop

Vista 引入了一个新的 API，当它没有任何项目时，它可以在列表视图控件中显示文本。正如 MSDN 库所述，我应该处理`LVN_GETEMPTYMARKUP`通知。

在继承的`ListView`控件中，该`WndProc`方法被覆盖：

```
protected override void WndProc(ref Message m) {
  try {
    if(m.Msg == 78 /* WM_NOTIFY */) {
      var nmhdr = (NMHDR)Marshal.PtrToStructure(m.LParam, typeof(NMHDR));
      if(nmhdr.code == -187 /* LVN_GETEMPTYMARKUP */) {
        var nmlvemptymarkup =
          (NMLVEMPTYMARKUP)Marshal.PtrToStructure(m.LParam, typeof(NMLVEMPTYMARKUP));
        nmlvemptymarkup.szMarkup = "The ListView is empty.";
        m.Result = (IntPtr)1;
      }
    }
  } finally {
    base.WndProc(ref m);
  }
} 
```

但是，它不起作用（尽管它不会引发任何异常）。实际上我从来没有得到`nmhdr.code`等于-187。有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-29T05:16:32.313

`WM_NOTIFY`消息不会发送到控件（列表视图），而是发送到父级（表单）。这在 Win32 世界中是有道理的，因为这些消息对于拦截非常有用，但是对控件进行子类化是相当痛苦的，尤其是当您希望在每种情况下都有不同的行为时。有了 .NET，情况就不再如此了。

方便的是，标准的 .NET 消息处理将消息“反射”回控件，以便您可以截获消息并在控件的 WndProc 中处理它——但反射的消息不再是`WM_NOTIFY`(0x004E)，而是`WM_REFLECT`| `WM_NOTIFY`(0x204E)。

因此，如果您修改 WndProc 以查找该值，那么它应该可以工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T15:54:14.250

[如本文](http://msdn.microsoft.com/en-us/magazine/cc163384.aspx)所述，您是否尝试过调用`SetWindowTheme`控件？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T15:59:17.830

另一种解决方案（这样您就不必监视 WndProc）是添加一个绘制处理程序，如下所示：

```
listview_onPaint(object sender, eventargs e)
{
  if ( listview.items.count <= 0 )
  {
     e.graphics.drawstring("The Listview is empty"); //put all the proper args in here!
  }
} 
```

那是凭记忆，但你应该明白。

希望这对您有所帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-04T15:11:20.193

我自己在这个问题上挣扎了很多。

要使原始问题中的代码正常工作，请使用 [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Unicode)] 标记 NMLVEMPTYMARKUP 结构（CharSet.Unicode 很重要）。

此外，在设置标记值后，调用 Marshal.StructureToPtr(nmlvemptymarkup, m.LParam, false) 将数据复制回 LParam 指向的缓冲区。

# sql-server - 使用过滤器减少 SQL 跟踪的开销

> ID：287305
> 
> 赞同：6
> 
> 时间：2008-11-13T15:47:32.737
> 
> 标签：sql-server, sql-server-2000, sql-server-profiler

我们有一个 SQL 2000 服务器，它有各种各样的作业，在一天中的不同时间，甚至一个月中的不同日子运行。通常，我们只使用 SQL 探查器在很短的时间内运行跟踪以进行性能故障排除，但在这种情况下，这确实不能让我对在一天或一周或一个月的课程。

如何最小化长时间运行的 SQL 跟踪的性能开销？我已经知道：

*   执行跟踪服务器端 (sp_create_trace)，而不是使用 SQL Profiler UI。
*   跟踪文件，而不是数据库表（这会增加数据库服务器的额外开销）。

我的问题实际上是关于过滤器的。如果我添加一个过滤器以仅记录运行超过特定持续时间或读取的查询，它仍然必须*检查*服务器上的所有活动以确定是否需要记录它，对吗？因此，即使使用该过滤器，跟踪是否会为已经处于不可接受性能边缘的服务器创建不可接受的开销水平？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T16:11:19.863

添加过滤器确实可以最大限度地减少事件收集的开销，并且还可以防止服务器记录您不需要的事务条目。

至于跟踪是否会产生不可接受的开销水平，您只需要对其进行测试并在有其他投诉时停止它。不过，使用该生产跟踪文件获取 DB Tuning Advisor 的提示可以提高每个人明天的性能。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T19:28:25.193

您实际上不应该让服务器处理跟踪，因为这可能会导致问题：“当服务器处理跟踪时，不会丢弃任何事件 - 即使这意味着牺牲服务器性能来捕获所有事件。而如果 Profiler 正在处理跟踪，如果服务器太忙，它将跳过事件。” （来自 SQL 70-431 考试书籍最佳实践。）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-30T15:34:57.977

我发现一篇文章实际上测量了 SQL 分析器会话与服务器端跟踪的性能影响：

[http://sqlblog.com/blogs/linchi_shea/archive/2007/08/01/trace-profiler-test.aspx](http://sqlblog.com/blogs/linchi_shea/archive/2007/08/01/trace-profiler-test.aspx)

这确实是我的根本问题，如何确保在跟踪期间不会让生产服务器陷入困境。看来，如果你做对了，就会有最小的开销。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-11-18T17:52:28.267

实际上，可以收集比从 Profiler 收集的更详细的测量结果——并在整个实例中 24x7 进行——而不会产生任何开销。这避免了提前弄清楚你需要过滤什么的必要性……这可能很棘手。

完全披露：我为提供此类工具的供应商之一工作……但无论您使用我们的还是其他人的……这可能会让您绕过这里的核心问题。

有关我们工具的更多信息，请点击此处[http://bit.ly/aZKerz](http://bit.ly/aZKerz)

# matlab - 在matlab PNN中查找类概率并制作ROC图

> ID：287309
> 
> 赞同：3
> 
> 时间：2008-11-13T15:50:55.863
> 
> 标签：matlab, machine-learning, neural-network, roc

我在 MATLAB 中设置了概率神经网络分类实验。`sim`我可以使用该命令获取未见数据的类。有什么方法可以得到分类器计算的类的概率？另外，有没有直接的方法来绘制接收器操作特性曲线并为我的分类器计算 ROC 下的面积？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-08-19T04:28:52.300

如果您有统计工具箱，您可以使用最近版本的 MATLAB 中添加的**[perfcurve](http://www.mathworks.com/access/helpdesk/help/toolbox/stats/perfcurve.html)**函数来绘制 ROC 曲线并获得 AUC。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T00:03:30.373

如果您包含更多背景知识并定义您的术语，您可能会更幸运地获得回复。我认为 ROC 是接收器操作特征曲线，但 PNN 和 AUC 对我来说只是字母汤。不要错误地假设您非常具体的问题领域之外的人无法帮助您。不过，您必须先解释您的行话，从而搭建一个语言桥梁。这有一个额外的好处，即当最终回答这个特定问题时，它对整个 stackoverflow 社区更有用。

# windows-mobile - 如何在 Windows CE 设备上自动导入证书？

> ID：287316
> 
> 赞同：1
> 
> 时间：2008-11-13T15:53:32.257
> 
> 标签：windows-mobile, mobile, import, certificate, windows-ce

我想在 Windows CE 设备上自动导入证书。将证书下推到设备上不是问题，但是一旦它们在那里，我无法确定如何在不使用 UI 的情况下导入它们。

（我目前正在使用 Avalanche Mobility Center）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T21:34:53.300

将证书推送到 Windows 移动设备的另一种方法是使用 Windows Mobile Device Provisioning。

[MSDN 配置移动设备文章](http://msdn.microsoft.com/en-us/magazine/cc500581.aspx)

对于证书配置的示例，在任何 Windows Mobile SDK 目录中，都有一个带有示例 xml 文件的 SDKTools 目录。例如，在安装了 SmartDeice SDK 的标准 VS 2008 安装中

...\Microsoft Visual Studio 9.0\SmartDevices\SDK\SDKTools

正如上面的文章所指出的，您可以通过多种方式来配置设备。安装程序 CAB 或 CPF、使用 API 的本机应用程序或使用 RAPI 或无线远程连接的设备（除非您是移动运营商，否则无线不是真正的选择）。

[MSDN：CertificateStore 配置服务提供者](http://msdn.microsoft.com/en-gb/bb737346.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T15:58:21.077

您需要从命令行执行证书。找出正在发生的事情的最简单方法是进入 Windows ME 中的 .cert 扩展名，查看双击发生时执行的命令。

# asp.net - 如果您不知道当前密码，如何使用 asp.net 会员提供程序更改散列密码？

> ID：287320
> 
> 赞同：57
> 
> 时间：2008-11-13T15:54:45.967
> 
> 标签：asp.net, membership-provider

问题，没有方法：

```
bool ChangePassword(string newPassword); 
```

您必须知道当前密码（可能已被散列并被遗忘）。

* * *

## 回答 #1

> 赞同：130
> 
> 时间：2008-11-13T15:55:25.793

这是一个简单的，我浪费了太多时间。希望这篇文章可以避免其他人像我一样用力拍打额头的痛苦。

解决方案，随机重置密码并将其传递给更改方法。

```
MembershipUser u = Membership.GetUser();
u.ChangePassword(u.ResetPassword(), "myAwesomePassword"); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-02-04T16:38:09.577

如果 requiresQuestionAndAnswer="true"，您将无法更改密码

我得到了解决这个问题

在 web.config 中创建了两个会员提供程序

我正在使用 AspNetSqlMembershipProviderReset 提供程序来重置密码，因为它具有 requiresQuestionAndAnswer=false ，其中 AspNetSqlMembershipProvider 是使用的默认提供程序。

我编写了以下代码来重置用户的密码。

public bool ResetUserPassword(String psUserName, String psNewPassword) { try { // 使用第二个会员提供者获取会员用户详细信息，并将所需的问题答案设置为 false。

```
 MembershipUser currentUser = Membership.Providers["AspNetSqlMembershipProviderReset"].GetUser(psUserName,false);

        //Reset the user password.
        String vsResetPassword = currentUser.ResetPassword();            

        //Change the User password with the required password            
        currentUser.ChangePassword(vsResetPassword, psNewPassword);
        //Changed the comments to to force the user to change the password on next login attempt
        currentUser.Comment = "CHANGEPASS";
        //Check if the user is locked out and if yes unlock the user
        if (currentUser.IsLockedOut == true)
        {
            currentUser.UnlockUser();
        }
        Membership.Providers["AspNetSqlMembershipProviderReset"].UpdateUser(currentUser);            return true;
    }
    catch (Exception ex)
    {
        throw ex;
        return false;
    }
} 
```

# linux - 现场安全更新嵌入式 Linux 的推荐技术

> ID：287331
> 
> 赞同：10
> 
> 时间：2008-11-13T15:59:29.450
> 
> 标签：linux, embedded, maintenance, reliability

基于嵌入式 Linux 的设备通常需要一种机制来更新应用程序和系统文件。例如，带有 USB 端口的（非联网）实验室仪器可以从 U 盘获取软件更新。

运行脚本将文件复制到设备内部闪存上的位置将是一件简单的事情。但是，存在设备在更新过程中断电并最终变成砖块的危险。

应用程序文件的情况稍微容易一些，因为有空间复制应用程序目录、更新一个副本以及快速交换新旧目录，从而最大限度地减少故障窗口。

对于内核和系统文件来说，事情变得更加复杂，因为它们分布在整个文件系统中。

我们在文件系统中使用硬链接和软链接来识别关键文件。我们对文件和档案使用哈希来验证文件完整性。如果从更新的文件系统启动失败，我们已经考虑在内核中使用紧急 ramfs 来提供回退。

你对这个要求有什么方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T16:10:13.050

如果一定要保证可靠性，可以有两个闪存分区（甚至芯片），一个是当前工作配置，一个是新配置。然后使用硬件看门狗将重置单元并将活动引导闪存分区切换到“最后一次正确”配置。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-12-01T05:56:47.293

至少有两个分区。我建议4

*   开机

*   备用引导

*   程序数据备份

*   程序易失性数据

如果引导失败，请使用 grub 后备引导来替代引导。

因此，如果更新失败，替代方案将起作用。

永远不要更新引导加载程序。

如果数据分区已烘烤，请重新格式化并复制备份数据分区。

现在你不能失败，除非闪存盘死了。如果您使用的是 COTS 硬件，并且主磁盘是紧凑型闪存，那么您可以在一个小 USB 密钥上进行物理隔离备份。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T16:11:30.767

我会采用与应用程序文件相同的方法：制作关键文件并完成自己的分区，链接到它们，然后复制分区。在所有初始化中，您应该首先检查链接是否全部显示到同一个分区，如果没有，请将它们重置（到具有某个文件最新日期的文件的分区）。如果要更新，只需将所有内容复制到新分区上，如果一切正常（crcs ok），则循环遍历文件并为每个文件系统设置从一个文件系统到另一个文件系统的链接。

这样，您的关键文件应该始终处于正常状态。

场景：

1.  将文件复制到新分区时更新失败

    没问题，因为链接仍然显示为旧的工作链接。

2.  链接时更新失败

    没问题，因为所有新文件都是有效的并且已经复制（否则重新链接步骤不会开始），设置检查更正此

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-01-02T12:45:53.353

恕我直言，任何非原子更新都可能破坏系统或使一致性检查变得非常困难。我同意必须避免更新引导加载程序，因为它不是断电安全的。通常，制造商希望将固件 xxx 更新到 yyy 版本，而无需担心内核和/或单个文件是否已更新。更新单个文件可能成为服务的噩梦，因为很难理解客户硬件上运行的内容。也许您正在将双副本方法（应用程序是多余的）与单副本方法混合使用。我认为这并没有太大帮助，因为系统的完整性是由链中的弱组件完成的。如果根文件系统的更新失败，那么复制应用程序并不重要。

如果您需要，双副本方法可以保证更新而不会停止服务。但它需要大量资源，因为必须复制所有组件。就个人而言，我使用回退方法，如果主应用程序失败或上次更新不成功，则在 RAM 中启动一个小的 rootfs。如果出现任何问题，此后备系统由引导加载程序自动启动，通过 USB 笔更新系统（如果需要本地更新）。

我从来没有找到一个关于这些问题的 OSS 项目，最近我根据我以前的经验开始了一个新项目。我有几个产品在运行它，我的客户对此很满意。

也许你可以看看它。您可以在以下位置找到“swupdate”（项目名称）的来源[`github.com/sbabic/swupdate`](https://github.com/sbabic/swupdate)。

斯特凡诺

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-08-04T22:45:44.197

我认为您在这里试图实现的是更新过程的原子性。原子性对于嵌入式设备至关重要，其中一个突出的原因是功率损耗；但可能还有其他硬件/网络问题。我在更新上下文中使用的原子性定义是：

*   更新总是要么完全完成，要么根本不完成
*   除了更新程序之外，没有任何软件组件会看到安装了一半的更新

对于嵌入式 Linux，您可能需要更新多个软件组件以及可供选择的不同设计；这里有一篇论文：[https ://mender.io/user/pages/04.resources/_white-papers/Software%20Updates.pdf](https://mender.io/user/pages/04.resources/_white-papers/Software%20Updates.pdf)

# mysql - 如何“选择直到”达到总和

> ID：287333
> 
> 赞同：6
> 
> 时间：2008-11-13T16:00:58.637
> 
> 标签：mysql, sql

我正在寻找一种方法来选择，直到达到总和。

我的“文档”表有“ `tag_id`”和“ `size`”字段。

我想选择所有文档，`tag_id = 26`但我知道我只能处理 600 个单位的大小。因此，当我知道前 10 个文档已经加起来超过 600 个单位时，选择 100 个文档并丢弃其中的 90 个是没有意义的。

所以，目标是：当我要丢弃大部分数据时，不要带回大量数据进行解析。

...但我也很想避免在这个应用程序中引入使用光标的工作。

我正在使用 MySQL。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-13T16:17:45.700

当加起来达到最大单位时，您需要某种方式来排序哪些记录优先于其他记录。否则，您怎么知道您保留了哪一组总计多达 600 条的记录？

```
SELECT d.id, d.size, d.date_created
FROM documents d
INNER JOIN documents d2 ON d2.tag_id=d.tag_id AND d2.date_created >= d.date_created
WHERE d.tag_id=26
GROUP BY d.id, d.size, d.date_created
HAVING sum(d2.size) <= 600
ORDER BY d.date_created DESC 
```

这只是一个让您入门的基本查询，还有许多问题需要解决：

*   它在 <= 600 处停止，因此在大多数情况下，您不会完全填满您的大小限制。这意味着您可能需要对其进行调整以允许更多记录。例如，如果第一条记录 > 600，则查询将不返回任何内容，这可能是个问题。
*   它不会做任何事情来检查以后可能仍然适合上限的其他较小的记录。
*   具有相同 date_created 值的记录可能会在这里和那里进行“双重计算”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T16:20:27.007

这效率要低得多，但确实避免了游标（假设您的文档表也有一个序列号列）：

```
select a.id, (select sum(b.size) from documents b where b.id <= a.id and b.tag_id = 26)
from documents a
where a.tag_id = 26
order by a.id 
```

此外，这是在 pgsql 中完成的，所以我不确定这个确切的语法是否适用于 mysql。

然后您可以将其包装在另一个查询中，该查询查找总和 > 600 的那些（您必须命名总和列）并获取第一个 id。然后处理下面的所有 id，包括那个。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T16:21:43.853

您必须首先将文档存储在表变量中，按照您想要检索它们的顺序对它们进行排序，然后使用累积值更新每一行，以便您可以对其进行选择。

```
 declare @documents_temp table (
    tag_id int,
    size int,
    cumulative_size int null)

insert into @documents_temp
select tag_id, size, size from documents order by tag_id

update @documents_temp d set d.cumulative_size = d.size + 
    (select top 1 cumulative_size from @documents_temp 
     where tag_id < d.tag_id order by tag_id desc)

select tag_id, size from @documents_temp where cumulative_size <= 600 
```

不知道值不值得。

# maven-2 - 使用 maven 作为 Weblogic 10.3 的构建工具

> ID：287335
> 
> 赞同：17
> 
> 时间：2008-11-13T16:02:27.103
> 
> 标签：maven-2, integration, weblogic

我正在尝试设置 Weblogic Server 10.3（和 Portal 等）以使用[maven](http://maven.apache.org/)作为构建工具。我正在尝试找到一个体面的教程或文档来做到这一点。有一些针对 9.0 等旧版本的教程，但关于 10 版的信息很少。

我正在寻找一种用 maven 构建 weblogic 的 ear 文件的方法。人们真的在这样做吗？使用 maven 值得麻烦吗？

我想使用 maven 以便更轻松地与[Hudson](http://hudson-ci.org/)等持续集成工具集成。

编辑：似乎有一种方法可以直接导出 Maven 文件[http://edocs.bea.com/wlw/docs102/guide/ideuserguide/build/conMavenScript.html](http://edocs.bea.com/wlw/docs102/guide/ideuserguide/build/conMavenScript.html)。但这些文件是 ant 的简单包装器。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-10T11:49:05.910

我正在使用 maven 构建一个部署 WebLogic Server 10.3 的 EAR。棘手的部分是：

*   查找 weblogic-maven-plugin 的所有依赖项
*   将所有依赖项放在 maven repo 中（我真的推荐[Sonatype Nexus](http://nexus.sonatype.org/)）
*   将 noExit 设置为 true （否则你会在 hudson 遇到问题！）

我在 EAR 项目中使用以下目录结构：

```
pom.xml
src/
   main/
        app/
            META-INF/
                     weblogic-application.xml 
```

以下内容来自我的 pom.xml：

```
<build>
    <plugins>
        <plugin>
            <artifactId>maven-ear-plugin</artifactId>
            <configuration>
                <displayName>My Project</displayName>
                <earSourceDirectory>src/main/app</earSourceDirectory>
                <modules>
                    <webModule>
                        <groupId>com.somecompany</groupId>
                        <artifactId>webapp</artifactId>
                    </webModule>
                </modules>
            </configuration>
        </plugin>
        <plugin>
            <groupId>org.codehaus.mojo</groupId>
            <artifactId>weblogic-maven-plugin</artifactId>
            <version>2.9.1</version>
            <executions>
                <execution>
                    <phase>deploy</phase>
                    <goals>
                        <goal>deploy</goal>
                        <goal>start</goal>
                    </goals>
                </execution>
            </executions>
            <configuration>
                <name>my-project</name>
                <adminServerHostName>${wls.adminServerHostName}</adminServerHostName>
                <adminServerPort>${wls.adminServerPort}</adminServerPort>
                <adminServerProtocol>t3</adminServerProtocol>
                <userId>${wls.userId}</userId>
                <password>${wls.password}</password>
                <upload>true</upload>
                <remote>true</remote>
                <verbose>false</verbose>
                <debug>false</debug>
                <targetNames>AdminServer</targetNames>
                <noExit>true</noExit>
            </configuration>
            <dependencies>
                <dependency>
                    <groupId>com.sun</groupId>
                    <artifactId>tools</artifactId>
                    <version>1.5</version>
                    <scope>system</scope>
                    <systemPath>${java.home}/../lib/tools.jar</systemPath>
                </dependency>
                <dependency>
                    <groupId>weblogic</groupId>
                    <artifactId>weblogic</artifactId>
                    <version>${weblogic.version}</version>
                    <scope>provided</scope>
                </dependency>
                <dependency>
                    <groupId>weblogic</groupId>
                    <artifactId>webservices</artifactId>
                    <version>${weblogic.version}</version>
                    <scope>provided</scope>
                </dependency>
                <dependency>
                    <groupId>weblogic</groupId>
                    <artifactId>com.bea.core.utils.full</artifactId>
                    <version>${weblogic.version}</version>
                    <scope>provided</scope>
                </dependency>
                <dependency>
                    <groupId>weblogic</groupId>
                    <artifactId>com.bea.core.i18n</artifactId>
                    <version>${weblogic.version}</version>
                    <scope>provided</scope>
                </dependency>
                <dependency>
                    <groupId>weblogic</groupId>
                    <artifactId>com.bea.core.weblogic.rmi.client</artifactId>
                    <version>${weblogic.version}</version>
                    <scope>provided</scope>
                </dependency>
                <dependency>
                    <groupId>weblogic</groupId>
                    <artifactId>javax.enterprise.deploy</artifactId>
                    <version>${weblogic.version}</version>
                    <scope>provided</scope>
                </dependency>
                <dependency>
                    <groupId>weblogic</groupId>
                    <artifactId>webserviceclient</artifactId>
                    <version>${weblogic.version}</version>
                    <scope>provided</scope>
                </dependency>
                <dependency>
                    <groupId>weblogic</groupId>
                    <artifactId>com.bea.core.weblogic.security.wls</artifactId>
                    <version>${weblogic.version}</version>
                    <scope>provided</scope>
                </dependency>
                <dependency>
                    <groupId>weblogic</groupId>
                    <artifactId>com.bea.core.weblogic.security.identity</artifactId>
                    <version>${weblogic.version}</version>
                    <scope>provided</scope>
                </dependency>
                <dependency>
                    <groupId>weblogic</groupId>
                    <artifactId>com.bea.core.weblogic.security</artifactId>
                    <version>${weblogic.version}</version>
                    <scope>provided</scope>
                </dependency>
                <dependency>
                    <groupId>weblogic</groupId>
                    <artifactId>wlclient</artifactId>
                    <version>${weblogic.version}</version>
                    <scope>provided</scope>
                </dependency>
                <dependency>
                    <groupId>weblogic</groupId>
                    <artifactId>com.bea.core.transaction</artifactId>
                    <version>${weblogic.version}</version>
                    <scope>provided</scope>
                </dependency>
                <dependency>
                    <groupId>weblogic</groupId>
                    <artifactId>com.bea.core.utils.classloaders</artifactId>
                    <version>${weblogic.version}</version>
                    <scope>provided</scope>
                </dependency>
                <dependency>
                    <groupId>weblogic</groupId>
                    <artifactId>wljmsclient</artifactId>
                    <version>${weblogic.version}</version>
                    <scope>provided</scope>
                </dependency>
                <dependency>
                    <groupId>weblogic</groupId>
                    <artifactId>com.bea.core.management.core</artifactId>
                    <version>${weblogic.version}</version>
                    <scope>provided</scope>
                </dependency>
                <dependency>
                    <groupId>weblogic</groupId>
                    <artifactId>wls-api</artifactId>
                    <version>${weblogic.version}</version>
                    <scope>provided</scope>
                </dependency>
                <dependency>
                    <groupId>weblogic</groupId>
                    <artifactId>com.bea.core.descriptor</artifactId>
                    <version>${weblogic.version}</version>
                    <scope>provided</scope>
                </dependency>
                <dependency>
                    <groupId>weblogic</groupId>
                    <artifactId>com.bea.core.logging</artifactId>
                    <version>${weblogic.version}</version>
                    <scope>provided</scope>
                </dependency>
                <dependency>
                    <groupId>weblogic</groupId>
                    <artifactId>com.bea.core.weblogic.socket.api</artifactId>
                    <version>${weblogic.version}</version>
                    <scope>provided</scope>
                </dependency>
                <dependency>
                    <groupId>weblogic</groupId>
                    <artifactId>com.bea.core.weblogic.security.digest</artifactId>
                    <version>${weblogic.version}</version>
                    <scope>provided</scope>
                </dependency>
                <dependency>
                    <groupId>weblogic</groupId>
                    <artifactId>com.bea.core.weblogic.workmanager</artifactId>
                    <version>${weblogic.version}</version>
                    <scope>provided</scope>
                </dependency>
                <dependency>
                    <groupId>weblogic</groupId>
                    <artifactId>com.bea.core.weblogic.lifecycle</artifactId>
                    <version>${weblogic.version}</version>
                    <scope>provided</scope>
                </dependency>
                <dependency>
                    <groupId>weblogic</groupId>
                    <artifactId>com.bea.core.utils.wrapper</artifactId>
                    <version>${weblogic.version}</version>
                    <scope>provided</scope>
                </dependency>
                <dependency>
                    <groupId>weblogic</groupId>
                    <artifactId>wlsafclient</artifactId>
                    <version>${weblogic.version}</version>
                    <scope>provided</scope>
                </dependency>
                <dependency>
                    <groupId>weblogic</groupId>
                    <artifactId>com.bea.core.management.jmx</artifactId>
                    <version>${weblogic.version}</version>
                    <scope>provided</scope>
                </dependency>
                <dependency>
                    <groupId>weblogic</groupId>
                    <artifactId>com.bea.core.descriptor.wl</artifactId>
                    <version>${weblogic.version}</version>
                    <scope>provided</scope>
                </dependency>
            </dependencies>
        </plugin>
    </plugins>
</build> 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-13T08:33:59.280

如果您的 Weblogic 10.3 安装在本地机器上，请尝试使用[Cargo——](http://cargo.codehaus.org/WebLogic+10.3.x)设置起来要容易得多。这是我必须添加的内容`pom.xml`：

```
 <plugin>
    <groupId>org.codehaus.cargo</groupId>
    <artifactId>cargo-maven2-plugin</artifactId>
    <version>1.0-SNAPSHOT</version>
    <configuration>
            <container>
                    <containerId>weblogic103x</containerId>
                    <home>/path/to/your/wlserver_10.3</home>
            </container>
    </configuration>
    </plugin> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-06-27T10:33:54.237

[http://mojo.codehaus.org/weblogic-maven-plugin/](http://mojo.codehaus.org/weblogic-maven-plugin/)是之前用来部署ear 项目到weblogic 的插件，但是看起来很繁琐。Oracle 发布了其用于 weblogic 的后续插件。这个插件比较容易使用和配置[http://download.oracle.com/docs/cd/E17904_01/web.1111/e13702/maven_deployer.htm](http://download.oracle.com/docs/cd/E17904_01/web.1111/e13702/maven_deployer.htm)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-06-20T20:31:17.860

您还可以使用我在此博客中说明的 Maven ANTRUN 插件：

[http://loutilities.wordpress.com/2012/06/20/use-your-maven-build-to-auto-deploy-to-weblogic-10-3/](http://loutilities.wordpress.com/2012/06/20/use-your-maven-build-to-auto-deploy-to-weblogic-10-3/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-05-11T09:51:05.370

Oracle 还提供了一个 Maven 插件：[http ://docs.oracle.com/cd/E21764_01/web.1111/e13702/maven_deployer.htm](http://docs.oracle.com/cd/E21764_01/web.1111/e13702/maven_deployer.htm)

# xml - 您可以为 Adob e Flex 应用程序使用 XML-RPC 数据源吗？

> ID：287345
> 
> 赞同：3
> 
> 时间：2008-11-13T16:06:25.520
> 
> 标签：xml, apache-flex, xml-rpc

Adobe 的 Flex 是否可以进行 XML-RPC 调用并使用生成的 XML 响应？

非 XML 响应是否会更好地为 Flex 提供服务？如果可以，采用什么格式？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T16:23:58.607

如果您想使用 XML-RPC，可以查看[as3-rpclib项目。](http://code.google.com/p/as3-rpclib/)

Flex 标准库具有 SOAP 支持（参见 参考资料[`mx.rpc.soap`](http://livedocs.adobe.com/flex/3/langref/mx/rpc/soap/package-detail.html)），因此这也是一种替代方法。不过，最有效的协议是[AMF](http://en.wikipedia.org/wiki/Action_Message_Format)，Flex 也包含对它的支持（请参阅 参考资料[`mx.rpc.remoting.RemoteObject`](http://livedocs.adobe.com/flex/3/langref/mx/rpc/remoting/RemoteObject.html)）（[维基百科](http://en.wikipedia.org/wiki/Action_Message_Format)有一些服务器端 AMF 库的链接）。

# c# - 如何更改 InfoPath 文本字段的文本颜色？

> ID：287352
> 
> 赞同：0
> 
> 时间：2008-11-13T16:09:51.363
> 
> 标签：c#, xml, infopath

我在重复表中有一个文本字段。我能够验证里面的内容，但如果文本没有通过我的验证，它应该将它的颜色更改为红色。

有人知道我如何通过代码实现这个目标吗？

通过将 innerXml 设置为以下内容，我找到了富文本框的解决方案：

```
"This is just a piece of <span xmlns="http://www.w3.org/1999/xhtml" style="color:red">red text</span>." 
```

不幸的是，这不起作用。发生命名空间错误：/ 但即使这可行，我也不希望有一个丰富的文本框，因为 InfoPath 表单中的文本字段不应该在字段上方有“菜单”。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-18T10:30:51.707

也许是妥协：

在主数据源 (FieldXYValid) 中设置一个布尔字段。如果 FieldXYValid 为 false，则创建规则以将 Textfield 颜色设置为红色。

验证后在 C# 代码中设置 FieldXYValid 的值。

# c# - 如何将 Container.DataItem 作为参数传递？

> ID：287358
> 
> 赞同：9
> 
> 时间：2008-11-13T16:11:14.683
> 
> 标签：c#, asp.net

我正在使用中继器控件，并且正在尝试这样传递参数：

```
<%# SomeFunction( DataBinder.Eval(Container.DataItem, "Id") ) %> 
```

它基本上是在调用：

```
public string SomeFunction(long id) {

    return "Hello";        

} 
```

由于出现错误，我无法做到这一点：

错误 CS1502：最佳重载方法匹配 ... SomeFunction(long id) ... 有一些无效参数。

有任何想法吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-13T16:15:25.690

您需要将结果转换为 long，因此：

```
<%# SomeFunction( (long)DataBinder.Eval(Container.DataItem, "Id") ) %> 
```

另一种方法是执行以下操作：

```
<%# SomeFunction(Container.DataItem) %> 
```

和...

```
public string SomeFunction(object dataItem) {
    var typedDataItem = (TYPED_DATA_ITEM_TYPE)dataItem;

    // DO STUFF HERE WITH THE TYPED DATA ITEM

    return "Hello";        

} 
```

这至少允许您使用数据项（DataRows 等）中的多个值。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T16:14:34.037

我认为您应该将 DataBinder.Eval(Container.DataItem, "Id") 施放多久。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-03-19T14:12:34.553

我成功地使用了这个。数据源是一个列表集合。

```
OnClientClick='<%# "return myFunction(\""+ Container.DataItem + "\");" %>' 
```

和javascript函数...

```
function myFunction(imgPath)
{
    alert(imgPath);
} 
```

# memory - 在 MATLAB 中处理大量结构

> ID：287362
> 
> 赞同：4
> 
> 时间：2008-11-13T16:11:37.150
> 
> 标签：memory, matlab, struct

我需要处理大量（数千万）的 MATLAB 结构；我需要十几个字段，所以我认为在我发现这一点之前记忆不会成为问题（[解释](http://www.mathworks.com/access/helpdesk/help/techdoc/index.html?/access/helpdesk/help/techdoc/matlab_prog/brh72ex-2.html)）

```
>> s=[];
>> s.first=1;
>> whos
  Name      Size            Bytes  Class     Attributes

  s         1x1               132  struct              

>> s.second=2;
>> whos
  Name      Size            Bytes  Class     Attributes

  s         1x1               264  struct              

>> s.third=3;
>> whos
  Name      Size            Bytes  Class     Attributes

  s         1x1               396  struct 
```

这显然阻止了我使用数千万个更大的结构。

诉诸类解决了内存使用问题（每个结构数组 56 个字节的标记），但在构造和销毁对象时速度慢得令人望而却步。

如何创建轻量级（如 C 结构）且快速的结构？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T17:55:33.727

Convert these structs into arrays, and then provide accessor methods via a class.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-17T14:26:35.750

(a) 正如 Pyrolistical 所建议的那样，使用大数组（其中结构 1 的“第一个”字段是“第一个”数组的元素 1，对于结构 2，它在元素 2 中，等等）。

(b) 考虑使用另一种语言，如 C++（或者可能是 Java），它可以更好地控制内存使用。您可以通过 mex 函数访问 C++ 代码（有时会有点困难）。您可以直接从 Matlab 评估 Java 字节码。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-27T05:55:14.860

另一种选择：将数组结构保存在隐藏的全局结构中。创建一个深入研究这个全局结构的类对象，以切出仅适用于该实例的数据。

使用 PERSISTENT 关键字和/或使用 private/ 目录来隐藏信息可以更干净地实现全局结构。如果您使用的是 2008a 或更新版本，新的句柄对象系统应该有助于使实现更加简洁。

如果你真的有大而复杂的数据结构，我会认真考虑另一种语言，如 C++、Java 或带有 numpy 的 Python。当我的任务很好地映射到它时，我喜欢 Matlab。数据结构不是 Matlab 的强项之一，尤其是 2008a 之前的版本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T16:23:35.750

你说的类是什么意思？据我所知，类是matlab中类型的术语。我猜你的意思是一个自定义类。

一个解决方案（在 matlab 文档中也被推荐）是从结构数组切换到数组结构（在 R、G、B 的链接中查看）示例。

# visual-studio - 有没有办法阻止 Visual Studio 自动从 obj/Debug 添加到变更集？

> ID：287365
> 
> 赞同：0
> 
> 时间：2008-11-13T16:12:25.447
> 
> 标签：visual-studio, visual-studio-2008, tfs, projects-and-solutions

对于某些解决方案，当我打开它们时，Visual Studio 将获取不在项目中的文件（特别是来自 obj/Debug）并将其添加到变更集中，我**总是**必须对它们执行*Undo Pending Changes*操作。它很烦人。有没有办法阻止 Visual Studio 以这种方式运行？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T16:20:40.687

添加解决方案时，通常不会将 obj/debug 文件夹添加为源代码管理的一部分。我的猜测是有人在迁移您的解决方案时明确地将它们添加到源代码管理中。

如果您在源代码管理树中看到这两个文件夹，我会删除它们。它们仍将由本地计算机上的构建生成，但不会参与签入过程。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-25T23:19:16.593

这通常只是网站项目的问题。因为它们将 vroot 中的所有内容都包含在“项目”中（实际上并不存在），并且如果您将该 vroot 绑定到版本控制，那么 TFS 会说“嘿，如果它在项目中，它应该在版本控制中”。Web 应用程序项目没有这个问题。

如果在有人递归添加文件时发生这种情况，那么他们应该在构建上运行“清理”，在添加之前删除 .suo 和 csproj.user 文件。

# excel - 使用 WMI 在 VBA 中获取当前的 Windows 用户名

> ID：287369
> 
> 赞同：1
> 
> 时间：2008-11-13T16:15:48.123
> 
> 标签：excel, automation, wmi, vba

我想知道是否有一种简单的方法可以使用 WMI 为您获取当前带有域的 Windows 用户名。Windows API 调用只会为您获取简短的用户名，因此您最终会再次调用域名。我有一些代码，但出现自动化错误。有任何想法吗？我认为我走在正确的道路上，但我对 WMI 有点陌生。

```
函数 GetFullName() 作为字符串
    将计算机调暗为字符串
    电脑=“。”
    暗淡 objWMIService，colProcessList 作为对象
    设置 objWMIService = GetObject("winmgmts:\\" & computer & "\root\cimv2")
    设置 colProcessList = objWMIService.ExecQuery _
        ("SELECT TOP 1 * FROM Win32_Process WHERE Name = 'EXCEL.EXE'")
    Dim uname, udomain As String
    将 objProcess 调暗为对象
    对于 colProcessList 中的每个 objProcess
        objProcess.GetOwner uname, udomain
    下一个
    GetFullName = UCase(udomain) & "\" & UCase(uname)
结束功能

```

更新：查看对已接受答案的评论

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T23:31:15.000

怎么样

```
UserName = Environ("Username")
Domain = Environ("UserDomain")
Combined= Environ("UserDomain") & "\" & Environ("Username") 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-04-19T11:41:06.243

意识到这是旧的，但是为了处理多个 excel 实例，另一篇文章（链接如下）阐明了如何获取当前应用程序的进程 ID：

```
Declare Function GetCurrentProcessId Lib "kernel32" () As Long
...
ProcessID = GetCurrentProcessId

Set ColProcessIDList = objWMIService.ExecQuery( _
    "SELECT * FROM Win32_Process WHERE ProcessID = '" & ProcessID & "'")
... 
```

[如何在不使用标题的情况下通过 VBA 获取当前 Excel 实例的进程 ID？](https://stackoverflow.com/questions/942058/how-to-get-the-process-id-of-the-current-excel-throught-vba-without-relying-on)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T17:44:13.000

WQL 中没有 TOP 1 子句。离开它，您的查询应该可以工作：

```
"SELECT * FROM Win32_Process WHERE Name = 'EXCEL.EXE'" 
```

# asp-classic - ASP/VBScript“陷阱”

> ID：287370
> 
> 赞同：9
> 
> 时间：2008-11-13T16:15:58.030
> 
> 标签：asp-classic, vbscript, decimal

我正在支持/增强用 Classic ASP/VBScript 编写的 Web 应用程序。自从我每天使用这两种容量以来，已经有大约 10 年了。我刚刚遇到了一个我认为是“陷阱”的问题，并且想知道其他人是否有类似的事情我应该学会注意。

我的问题：
我必须将 SQL 表中的列从浮点数转换为十进制数。事实证明，十进制不是 vbscript 中真正支持（或支持良好）的类型。所以下面的代码：

```
Dim var1, var2

var1 = rs("DecimalField1").Value
var2 = rs("DecimalField2").Value

If (var1 <> var2) Then
    'Do Something'
End If 
```

会在行上出现类型不匹配错误：

```
If (var1 <> var2) Then 
```

经过大量搜索，我发现：

```
var1 = CDBL(rs("DecimalField1").Value)
var2 = CDBL(rs("DecimalField2").Value) 
```

解决了这个问题。但这似乎不是一件显而易见的事情，我花了一段时间才弄清楚为什么我在那条线上得到了类型不匹配。

所以我对大家的问题是，你还遇到过哪些类似的小怪癖？ASP/vbscript 中有哪些您认为是我应该注意的“陷阱”的东西？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-21T22:45:00.923

**Repeat after me:** All good VB programmers use `Option Explicit`

It will keep you from accidentally declaring a new variable and using it - thus throwing off whatever you are doing.

Beyond that, it depends on what you're doing.

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-23T05:25:31.443

当您看到以下行时要小心：

```
On Error Resume Next 
```

这将是我在使用经典 ASP 时的谨慎。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-23T04:13:14.130

条件有时有点不直观。

例如，在处理`Null`s 时：虽然`True`和`Null`不相等，但下面的表达式会表现得像`False`。在这种情况下，最好检查`Null`明确使用`IsNull`.

```
valueIsTrue = True
valueIsNull = Null
If valueIsTrue <> valueIsNull Then ... 
```

此外，与其他一些语言不同，条件的所有部分都会被评估，即使第一部分是`False`. 例如，如果`myObject`是，以下示例将返回错误`Nothing`：

```
If Not IsNothing(myObject) And myObject.IsValid() Then ... 
```

解决方案是使用嵌套`If`s或其他方式分隔条件：

```
If Not IsNothing(myObject) Then
    If myObject.IsValid() Then
        ... 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-14T06:18:30.730

使用 HTML 表单时的一个常见问题是表单页面的 CharSet 和接收页面的 CodePage 不匹配。

一个典型的例子是表单页面将其 CodePage 设置为 65001，并将响应 CharSet 设置为 UTF-8。这会导致输入到表单中的任何值都使用 UTF-8 编码回传。接收页面离开其 CodePage 设置系统 OEM 代码页，例如 1252。

反直觉地，ASP 使用 Response.CodePage 来确定应如何解释表单 post 中的字符，因此 UTF-8 编码被错误地接受为破坏输入的 1252 个字符。

有时这未被检测到，因为页面响应将其 Reponse.CharSet 设置为 UTF-8，但保持其 CodePage 不变。用户的结果看起来不错，但输入数据库的数据已损坏。

我的建议是另存为 UTF-8，在所有页面中使用 @codepage = 65001 并始终将 Response.CharSet 设置为 UTF-8。这涵盖了一切。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-26T20:14:47.593

如果您只有 1 个参数，VBScript 有一种令人讨厌的方法可以让您用括号调用 subs。但是，如果该参数是通过引用传递的，则如果使用括号，则返回值不会出现：

```
<% OPTION EXPLICIT %>
<%

sub MakeLonger(byref something)
    something = "hello " & something 
end sub

dim msg
msg = "World"

MakeLonger(msg)
response.write msg
response.write "<br />"

MakeLonger msg
response.write msg

%> 
```

输出是：

```
World 
hello World 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-13T16:34:06.433

确保*`Set`*用于对象引用：

```
 Dim rs : Set rs = CreateObject("ADODB.Recordset"); 
```

如果不这样做，您将获得无效的变量引用或**默认属性**

```
 Dim field      : Set field  = rs(0)
 Dim fieldValue : fieldValue = rs(0) 'Same as field.Value 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-13T16:37:27.847

将参数传递给函数时可以省略括号，但前提是函数调用是语句中的唯一表达式：

```
 DoSomething withThisArgument
 Dim result : result = DoSomething(withThisArgument)
 result = DoSomething withThisArgument 'SYNTAX ERROR 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-27T03:43:15.210

classic ASP has a lot of gotchas if u never worked with it :) i would recommend having a look at [ajaxed library](http://www.ajaxed.org) which is a still maintained classic asp library. It helps you to get rid of most common gotchas when dealing with legacy apps.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-13T16:37:55.707

自动变量分配可能是最大的问题之一。

```
Dim varA, varB

varA = varA + varV 
```

哎呀！你`varV`问什么？嗯..我只是把 B 打错了 V 并且一切仍然完美.. 这一定是件好事！

除了为什么不将 varB 添加到 varA ？那一定是微软的bug！

# wpf - WPF：将值绑定到 GridViewColumn 内的 ComboBox 出现问题

> ID：287372
> 
> 赞同：1
> 
> 时间：2008-11-13T16:17:02.847
> 
> 标签：wpf, data-binding, combobox, gridviewcolumn

我的视图 dataContext 绑定到具有两个 observableCollections 成员的presentationModel。在视图中，我有一个 ListView，ItemSource 绑定到的是第一个 observableCollection。在 LilstViews 列之一中，我想在我的presentationModel 中显示来自第二个可观察集合的值。我不知道如何将 observableCollection 中的值获取到我的组合框中。有谁知道如何解决这个问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T21:16:05.023

您需要做的第一件事是创建一个包含 ComboBox 的数据模板，在这种情况下，我已将 ItemsSource 绑定到主机窗口上的 DependencyProperty。这包含表示模型，它有一个名为 ComboSource 的属性。SelectedValue 已通过 ListViewItem 的 DataContext 绑定到保存所选值的属性。

```
<ListView.Resources>
    <DataTemplate x:Key="comboBoxTemplate">
        <ComboBox
            ItemsSource="{Binding 
                            Path=ModelData.ComboSource, 
                            RelativeSource={RelativeSource AncestorType=Window}}"
            SelectedValue="{Binding 
                            Path=DataContext.Selection, 
                            RelativeSource={RelativeSource AncestorType=ListViewItem}}"
            DisplayMemberPath="Item"
            SelectedValuePath="Id"
            />
    </DataTemplate>
</ListView.Resources> 
```

然后你需要从 GridViewColumn 上的 CellTemplate 中引用它

```
<GridViewColumn
    Header="Selection"
    Width="160"
    CellTemplate="{StaticResource comboBoxTemplate}"
    /> 
```

# sql - 如何使用 sql 查找字符串中特定字符的出现次数？

> ID：287373
> 
> 赞同：29
> 
> 时间：2008-11-13T16:17:03.207
> 
> 标签：sql, string, search

如何使用 sql 查找字符串中特定字符的出现次数？

示例：我想查找字母 'd' 在此字符串中出现的次数。

```
declare @string varchar(100)
select @string = 'sfdasadhfasjfdlsajflsadsadsdadsa' 
```

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2008-11-13T16:20:41.983

干得好：

```
declare @string varchar(100)
select @string = 'sfdasadhfasjfdlsajflsadsadsdadsa'
SELECT LEN(@string) - LEN(REPLACE(@string, 'd', '')) AS D_Count 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2010-03-11T01:32:57.770

如果你想让它更通用一点，你应该除以你要找的东西的长度。像这样：

```
declare @searchstring varchar(10);
set @searchstring = 'Rob';

select original_string, 
(len(orginal_string) - len(replace(original_string, @searchstring, '')) 
   / len(@searchstring)
from someTable; 
```

这是因为每次找到“Rob”时，都会删除三个字符。因此，当您删除六个字符时，您会找到两次“Rob”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2020-02-18T16:24:24.237

对于那里的所有 Sybase ASE 15 恐龙，您需要将 '' 替换为 null，即

```
SELECT LEN(@string) - LEN(REPLACE(@string, 'd', null)) AS D_Count 
```

# vba - 我可以使用 VBA 以编程方式控制 HP 打印机驱动程序设置中的“旋转 180 度复选框”选项吗？

> ID：287378
> 
> 赞同：0
> 
> 时间：2008-11-13T16:18:30.630
> 
> 标签：vba, ms-word, printing, rotation, duplex

我正在尝试使用双面打印单元打开和关闭 HP Laserjet 打印机 (4200/ 4350) 的旋转 180 度设置。

企业需要“双面打印”，为了最大限度地控制我希望能够在打印时（通过打印宏）操作是否为每种不同类型的文档启用双面打印业务合作。

我可以控制纸盘分配、打印顺序以及打开和关闭双面打印。但是，无法弄清楚如何控制旋转选项（打开和关闭此选项）。

除毯子之外的任何可用解决方案 - 在打印服务器上为所有文档/用户启用此选项？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T17:48:20.590

Perhaps the HP duplex option can be controlled from:

Printer Object: Access 2003 VBA Language Reference ([http://msdn.microsoft.com/en-us/library/aa223133(office.11).aspx](http://msdn.microsoft.com/en-us/library/aa223133(office.11).aspx))

More specifically:

Duplex Property ([http://msdn.microsoft.com/en-us/library/aa195860(office.11).aspx](http://msdn.microsoft.com/en-us/library/aa195860(office.11).aspx))

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-22T19:20:12.793

COM 接口就是您所需要的。更换托盘的 Python 代码如下： VB 遵循相同的基本步骤。

```
import win32print
PRINTER_DEFAULTS = {"DesiredAccess":win32print.PRINTER_ALL_ACCESS}
pHandle = win32print.OpenPrinter('PRINTERNAME', PRINTER_DEFAULTS)
properties = win32print.GetPrinter(pHandle, 2) #get the properties
pDevModeObj = properties["pDevMode"] #get the devmode
pDevModeObj.DefaultSource = tray_three #change some sort of setting... this case is the tray
properties["pDevMode"]=pDevModeObj #write the devmode back to properties
win32print.SetPrinter(pHandle,2,properties,0) #save the properties to the printer 
```

当然，您可能只需在 word 中通过 vba 更改打印机设置。如果您使用的是 excel 或任何其他办公产品，它将无法正常工作。

# python - 解析 C++ 预处理器 #if 语句

> ID：287379
> 
> 赞同：4
> 
> 时间：2008-11-13T16:18:37.383
> 
> 标签：python, c++, c, parsing, c-preprocessor

我有一个带有条件编译的 C/C++ 源文件。在将它交付给客户之前，我想删除大部分 #if 语句，这样我的客户就不必担心将正确的 -D 选项传递给编译器。

我已经在 Python 中实现并工作，但它只能正确处理 #ifdef 和 #ifndef 语句。我需要添加对#if 语句的支持，但#if 的语法要复杂得多。（例如，您可以使用 &&、||、!、括号、关系运算符、算术等）。

是否有任何现有的开源代码来解析和评估#if 语句？（最好在 Python 中）。

我知道的唯一实现是 GCC，这对于这项任务来说太复杂了。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-13T17:02:13.647

正如[KeithB 所说](https://stackoverflow.com/questions/287379/parsing-c-preprocessor-if-statements#287405)，您可以让预处理器为您执行此操作。

但是，如果您不想隐藏某些东西（即，条件编译的代码中可能存在您不希望或不允许提供给其他人的东西），那么一个更简单的选择就是放`#define`全局包含的标头中的正确指令。

*   您的客户无需担心`-D`选项
*   您不必在构建过程中有一些自定义步骤
*   您提供给客户的代码可能不会被半混淆
*   您不会引入错误，因为该工具所做的事情与 C 预处理器略有不同
*   您不必维护一些自定义工具

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-13T16:25:25.013

只是通过 C 预处理器，然后让它完成工作怎么样。它将摆脱所有这些，因此您可能需要一个预处理器步骤和一个后预处理器步骤来保护您不想被扩展的东西。

1.  将所有#include 更改为@include
2.  通过预处理器传递文件
3.  将@include 改回#include

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-13T16:23:07.733

与其重新发明轮子，不如下载“unifdef”。如果您使用某种 Linux 风格，您可能可以找到它的软件包，否则它在[FreshMeat上](http://freshmeat.net/projects/unifdef/)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-13T16:21:59.560

你看过[Boost.Wave](http://www.boost.org/libs/wave)吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T16:22:24.677

GCC 预处理器通常是一个独立的程序，通常称为`cpp`. 当然，这也可能会删除您的评论。

# algorithm - finding all vertices in a graph with degree smaller than their neighbors

> ID：287385
> 
> 赞同：2
> 
> 时间：2008-11-13T16:20:20.970
> 
> 标签：algorithm, graph-theory

I'm trying to write an algorithm that will find the set of all vertices in a graph with degree smaller than their neighbors. My initial approach is to find the degree of each vertex, then work through the list, comparing the degree of each vertex with the degree(s) of its neighbors. Unfortunately, this looks like it could be very time consuming. Is there a more efficient way to find this set?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T16:25:34.420

One comment - *if you're working with undirected graphs* (thanks, [Brian R. Bondy](https://stackoverflow.com/users/3153/brian-r-bondy)), once you've determined that a vertex has degree less than that of all its neighbours, you don't need to check the neighbours, as none of them will have that property. Consider using that knowledge to help you out and speed things up.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T21:37:06.273

Perhaps "this looks like it could be very time consuming", but there is a better way of finding out :-)

Suppose you've stored your graph as an adjacency list. To find the set you're seeking, you necessarily have to look at all the edges, so we have a **lower bound** of Ω(|E|) for the algorithm. Finding the degree of every vertex takes time O(|E|) (because you look at every edge exactly once; another proof is to use the fact that ∑d(v)=2|E|). Comparing the degree of each vertex with all its neighbours also takes only O(|E|) time (again, for each edge, you make only one comparison). This means that your algorithm runs in O(|E|) time (about 2|E| "steps", but the precise number of CPU instructions depends on your implementation), which meets the lower bound. Thus your "brute-force" algorithm, in the worst case, is essentially (up to a small constant) **as fast as possible**, so it is not worth optimizing any further.

If you are doing this for a real-world application and you indeed find that your algorithm is taking too much time, then use a profiler to find what parts to optimize. It is not at all obvious that optimizing the second phase of the algorithm is crucial.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T17:09:40.323

I would imagine a greedy approach for an undirected graph as follows:

```
let Q = all nodes which haven't been checked (initialize all V)
let Q* = all nodes which satisfy the required condition (initialize to empty)
start with an arbitrary node, v in Q
while Q is not empty
    let minDeg be the minimum degree of all v's neighbors
    if degree(v) < minDeg
        add v to Q*
        remove all neighbors of v from Q
        remove v from Q
        set v = new arbitrary node, v in Q
    else
        remove v from Q
        set v = v's neighbor in Q of minimum degree 
```

This algorithm may be slightly more efficient because at each iteration, it either finds a satisfying node, or checks a new node of lesser degree and removes a node from the graph.

At worst case, it will be equivalent to your brute-force algorithm. On average, though, I think it should perform better.

# apache-flex - Flex dataGrid itemRenderer，访问单元格宽高

> ID：287398
> 
> 赞同：3
> 
> 时间：2008-11-13T16:23:53.490
> 
> 标签：apache-flex, actionscript, datagrid, itemrenderer

在编写自定义 itemRenderer 时，如何引用将在其中渲染的网格单元格的高度和宽度？这样在调整网格大小时它会正确调整大小。

我正在编写一个 dataGrid itemRenderer，它在表格的最后一列中绘制条形图。

我试过引用“this”、“this.parent”和其他一些没有成功的东西。我的临时 hack 解决方案是将此数据添加到数据集合中，但是当网格更改大小时这将不起作用，因此我每次都必须对其进行编辑。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-14T04:07:07.813

包括单元格渲染器在内的所有 flex 组件都知道它们自己的宽度和高度，因此您应该能够访问 this.width 和 this.height

如果您正在寻找告诉您何时调整单元格大小的事件，您可以监听该 `ResizeEvent.RESIZE`事件或覆盖 `protected function updateDisplayList(unscaledWidth:Number, unscaledHeight:Number):void`组件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-04-15T15:07:30.483

最后一列的 itemRenderer 继承了布局的大小。对 MXML itemRenderer 使用绝对布局，它将缩放以适应。

# visual-studio - MSBuild - 它可以解决解决方案文件中的项目依赖关系吗？如果有怎么办？

> ID：287399
> 
> 赞同：21
> 
> 时间：2008-11-13T16:23:56.000
> 
> 标签：visual-studio, msbuild

我有一个 msbuild 项目，它从 Visual Studio 构建一个 SLN 文件，其中包含所有项目（大约 70 多个项目），并且许多项目相互依赖，这意味着它们需要按顺序构建 - 有时开发人员会忘记在解决方案文件中的 Visual Studio 中手动设置构建顺序，导致干净解决方案上的 msbuild 失败，因为某些东西构建无序/找不到 dll。

msbuild 有没有办法获取所有项目并解决依赖关系并按顺序构建项目，如果有我该怎么做？使用 MSBuild 任务？对于当前的尝试，它似乎只是按照它读取项目的顺序构建 - 如果我传入项目文件+路径的列表。

目前我能想到解决这个问题的唯一方法是一个外部应用程序，它扫描项目文件和引用，然后每次手动创建一个解决方案..但这对于这么简单的事情来说似乎有点矫枉过正。

有人解决过/见过这个吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-18T17:08:41.743

你怎么称呼MSBuild？如果将 MSBuild 指向解决方案文件，它应该能够解决依赖关系。如果您将其指向单个项目文件，那么它将无法解析任何项目引用。

如果您不使用项目引用，您仍然可以通过使用“项目依赖项”对话框手动设置依赖项来控制解决方案中的依赖项顺序。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-04-13T23:39:06.353

虽然项目依赖项很难维护并且不能在 .sln 文件之间共享，但项目*引用*很受尊重，并且确实一致地规定了顺序 - 请参阅 .sln 中的`ResolveReferences`任务`Microsoft.Common.targets`。

旁白：“我的一个朋友”可能“在重构期间”不小心中断了他们的构建`Task`，并且它`DependsOnTargets`与任务的联系`Microsoft.Common.targets` `ResolveReferences`最终`ProjectReferences`没有以听起来像这里的问题的方式得到尊重。如果您[阅读了其中的一些帖子](http://social.msdn.microsoft.com/Forums/en/msbuild/thread/80cc6447-b720-4806-8395-7c257b207613?prof=required)，您可能会认为这一切都是疯狂的摇摇欲坠——事实并非如此；不稳定的位是项目*依赖项*，而不是项目*引用*。

* * *

请参阅[Dan Moseley 撰写的这篇出色的 MSDN 博客文章，该文章](http://blogs.msdn.com/b/msbuild/archive/2010/12/21/incorrect-solution-build-ordering-when-using-msbuild-exe.aspx)真正解释了该主题，包括一些有用的变通策略。（通过[这个与构建 xUnit.net 轻微相关的问题](http://xunit.codeplex.com/discussions/354418)）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T16:58:34.743

如果您的所有依赖项目都在解决方案中，并且您正在使用项目引用，则 Visual Studio 应管理您的依赖项并按照该依赖项列表的顺序构建。

听起来您没有使用项目引用。我总是推荐项目参考。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-01-28T22:35:07.880

这是一个老问题，但问题很可能是解决方案中的项目使用了对依赖 DLL 的直接引用（添加引用 > 选择浏览选项卡 > 选择依赖 DLL）而不是使用项目引用（添加引用 > 选择项目选项卡 > 选择依赖项目）。使用直接引用，Visual Studio 无法找出依赖链。您必须通过右键单击解决方案节点并选择属性来告诉它。选择 Common Properties > Project Dependencies 来设置所需的项目。克劳斯先生是正确的，但我想记录如何解决这个问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-01-08T18:03:09.313

没有任何 Microsoft 工具可以检查您的 70 多个项目的所有依赖项并生成一个解决方案文件，其中明确为您声明了依赖项。

您必须使用 2 种不同的方法自行完成：

1.  在 Visual Studio 中为解决方案手动指定依赖项。
2.  在项目文件本身中指定项目引用。

如果您不想这样做，那么您将不得不吞下药物并接受您将使用外部工具为您执行此操作的事实。是的，它很笨重，但可以让它工作。如果您将解决方案文件签入源代码管理，则可以缓解这些问题。只要您有一个活动的解决方案文件可以使用。

我有一次没有，我在构建中有 600 多个项目。所以我写了一个工具（几年前），它可以自动化 99% 的工作。它使用 .NET MSBuild API 来读取 msbuild 文件（这里没有使用 xml api 重新创建轮子）。然后它检查输出和输入并生成一个依赖树，然后我可以用它做一些事情：

1.  吐出一个解决方案文件。
2.  做一个依赖排序（在学术界也是一种拓扑排序），然后按应该构建的顺序列出这些项目（对于非并行类型的构建，这有时很有用）。
3.  打印出有关依赖关系的各种诊断信息。

我使用该工具看到的唯一限制是一些疯狂的 COM 依赖项，这些依赖项无论如何都非常粗略。我添加了一个超级简单的解决方法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-30T14:48:58.850

虽然在使用项目依赖项时 MSBuild 应该遵守构建顺序是正确的，但有一个警告。目前，在构建干净目标时，它不会观察反向构建顺序（正如我在[此处](http://brumlemann.blogspot.com/2008/12/why-it-is-error-for-msbuild-to-build.html)写的博客）。但是，对于常规构建，它可以很好地工作，正如此处其他人所描述的那样。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-02-12T13:54:18.377

我正在使用位于 c:\Windows\Microsoft.NET\Framework\v4.0.30319\MSBuild.exe 的 Msbuild 4 似乎可以解决问题。

# java - 在不破坏构建的情况下向 Java 代码引入泛型

> ID：287401
> 
> 赞同：1
> 
> 时间：2008-11-13T16:24:27.247
> 
> 标签：java, generics

以下代码无法编译：

```
public class GenericsTest {    
    public static void main(String[] args) {
        MyList<?> list = new MyList<Object>();
        Class<?> clazz = list.get(0);

        // Does not compile with reason 
        // "Type mismatch: cannot convert from Object to Class"
        MyList list2 = new MyList();
        Class clazz2 = list2.get(0);
    }
    static class MyList<T> extends ArrayList<Class<T>> {
    }
} 
```

我想这样做是为了在不破坏构建的情况下将泛型引入旧代码。

这是编译器（eclipse和javac）中的一个错误还是我在这里遗漏了什么？将泛型引入 MyList 还有什么其他可能性？

**编辑**

为了澄清：

我有通用类

```
public class MyList extends ArrayList<MyObject> {} 
```

和

```
public class MyObject {} 
```

和使用 MyList 的代码

```
MyList list = new MyList();
...
MyObject o = list.get(0); 
```

现在在开发过程中，我看到我想向 MyObject 引入泛型

```
public class MyObject<T> {} 
```

现在我也想在 MyList 中拥有这个新的通用东西

```
public class MyList<T> extends ArrayList<MyObject<T>> {} 
```

但这确实破坏了我的构建。有趣的是

```
public class MyList<T> extends ArrayList<MyObject<T>> {
    public MyObject<T> get(int i) {
        return super.get(i);
    }
} 
```

将允许旧代码

```
MyList list = new MyList();
...
MyObject o = list.get(0); 
```

编译。

好的，似乎当我介绍这个泛型时，我将不得不将所有对 MyList 的调用更改为泛型形式。我希望旧代码只引入警告而不是错误。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-13T16:34:22.470

我认为您不太了解泛型是如何工作的。

```
MyList<?> list = new MyList<Object>();
Class<String> clazz= list.get(0); 
```

此代码片段无法编译，因为您告诉编译器`list`将保存`Class<Object>`类型 - 然后在下一行您希望它返回一个`Class<String>`. Java 中的泛型系统不能像您想象的那样基于继承转换与泛型一起使用的类型。

如果您希望`list`持有`Class<String>`，那么您需要将其声明为 - 或者，如果您希望它能够持有任何类型，那么您不能在没有强制转换的情况下执行第二行。

```
MyList<String> list = new MyList<String>();
Class<String> clazz = list.get(0); 
```

或者

```
MyList<?> list = new MyList<Object>();
//generates a warning about an unchecked cast
Class<String> clazz = (Class<String>) list.get(0); 
```

* * *

第二个代码片段不起作用，因为当您使用原始类型时，您仍然需要将`Object`返回的 by`get()`强制转换为您正在使用的声明类型（一直如此）。

```
MyList list2 = new MyList();
Class clazz2 = (Class) list2.get(0); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T16:36:55.850

我在这台机器上没有编译器，但这应该可以工作。

```
public class GenericsTest {    
    public static void main(String[] args) {
        MyList<Object> list = new MyList<Object>();
        Class<?> clazz= list.get(0);

    }

    static class MyList<T> extends ArrayList<Class<? extends T>> {
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T19:59:09.640

在您的示例中，MyList 是您想要更新以支持泛型的旧代码吗？如果是这样，我的列表应该包含什么类型的对象？

正如在其他地方提到的，编译错误是有效的。这是因为在访问原始列表时没有将 get 强制转换为 Class。因此代码试图将一个对象分配给一个类的引用。它等价于：

```
Object o = new Object();
Class c = o; 
```

这根本无法编译。此外，要充分利用泛型，您应该使用 Class<?> 而不是 Class。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-14T04:07:07.487

在您的示例中，第二个示例不起作用，因为您没有使用泛型，因此这意味着 get() 方法将返回一个 Object，您需要将其强制转换为 Class。当您没有为 MyList 指定类型时：

> MyList list2 = new MyList();

然后你就失去了泛型的优势，你需要在调用 get() 方法时强制转换对象，就像在过去的美好时光一样。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-11-13T16:33:32.673

你有没有尝试过：

```
Class clazz2 = list2.get(0).getClass(); 
```

阅读：http: [//java.sun.com/j2se/1.5.0/docs/api/java/lang/Object.html#getClass()](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Object.html#getClass())

# mysql - MySQL 可选存储过程参数

> ID：287403
> 
> 赞同：0
> 
> 时间：2008-11-13T16:25:00.647
> 
> 标签：mysql, database

在 MSSQL 中，当我想忽略一个空的过滤器参数时，我执行以下操作

```
SELECT * FROM Table WHERE EmployeeName = ISNULL(@EmployeeName, EmployeeName); 
```

我将如何在 MySQL 中实现这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T16:31:06.097

你可以`coalesce()`改用。

# regex - 在 Notepad++ 和 Vim 中使用正则表达式进行批量替换

> ID：287404
> 
> 赞同：32
> 
> 时间：2008-11-13T16:25:07.323
> 
> 标签：regex, vim, notepad++

所以我有一个大文本文件，如下所示：

```
<option value value='1' >A
<option value value='2' >B
<option value value='3' >C
<option value value='4' >D 
```

它有几百行长，我真的不想手动做。我试图使用的表达是：

```
<option value='.{1,}' > 
```

当我通过几个在线正则表达式测试器运行它时，它按预期工作。我基本上想删除 A、B、C 等之前的所有内容。问题是当我尝试在 Vim 和 Notepad++ 中使用该表达式时，它似乎找不到任何东西。

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2010-11-16T17:20:30.803

在 Notepad++ 中，您不需要为此使用正则表达式。

按住 alt 可让您一次在多行中选择一个文本矩形。选择要删除的块，然后按删除。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-01-07T20:07:02.687

**在记事本++中：**

```
<option value value='1' >A
<option value value='2' >B
<option value value='3' >C
<option value value='4' >D

Find what: (.*)(>)(.)
Replace with: \3

Replace All

A
B
C
D 
```

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-11-13T17:25:14.177

**在A**、**B**、**C**等之前的所有内容。

这似乎很简单，我一定是误解了你。只是

```
:%s/<.*>// 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-11-13T17:01:21.183

除非我不明白这个问题，否则有一个非常简单的解决方案。以下正则表达式：

```
(.*)(>)(.*) 
```

将匹配您帖子中指定的模式。

因此，在 notepad++ 中，您可以找到`(.*)(>)(.*)`并将其替换为`\3`.

从某种意义上说，正则表达式基本上是贪婪的，如果您指定`(.*)`它将匹配整行并且您想要做的是以某种方式将其分解，以便您可以提取您想要保留的字符串。在这里，我做了完全相同的事情，它在 Notepad++ 和 Editplus3 中运行良好。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-11-13T16:43:27.537

您的原始解决方案存在两个问题。首先，您的示例文本：

```
<option value value='1' >A 
```

有两次出现的“价值”词。你的正则表达式没有。此外，您需要在正则表达式的量词中转义左大括号，否则 Vim 会将其解释为文字大括号。此正则表达式有效：

```
:%s/<option value value='.\{1,}' >//g 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-11-13T16:29:50.590

这将删除`option`标签并将字母留在 vim 中：

```
:%s/<option.*>//g 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-13T16:30:24.100

如果您不太具体，它可能会有所帮助。你的表情是“贪婪”，不同的程序可能会以不同的方式解释。在 vim 中试试这个：

```
%s/^<[^>]+>// 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2011-03-29T09:48:01.807

在记事本++

搜索

```
(<option value="\w\w">)\w+">(.+) 
```

用。。。来代替

```
\1\2 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-11-13T17:01:38.810

在 vim 中

```
:%s/<option value='.\{1,}' >// 
```

或者

```
:%s/<option value='.\+' >// 
```

在 vim 正则表达式中，您必须转义一个或多个符号、捕获括号、有界数字花括号和其他一些符号。

查看`:help /magic`哪些特殊字符需要转义（以及如何更改）。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2010-04-21T07:43:00.600

遇到同样的问题（使用 jQuery“完成...”字符串），但仅在 Notepad++ 中，我问，收到了很好的友好回复（这让我明白我错过了什么），然后花时间构建详细的逐步- 步骤说明，请参阅**[在 Notepad++ 中使用正则表达式查找行开头](https://stackoverflow.com/questions/2681399/finding-line-beginning-using-regular-expression-in-notepad)**

凡尔赛，2010 年 4 月 27 日星期二 22:53:25 +0200

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2013-04-22T08:07:33.763

记事本++：搜索模式=正则表达式

查找内容：(.*>)(.)

替换为：\2

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-13T16:31:12.927

这将起作用。在我的vim中测试过。单引号是麻烦。

```
1,$s/^<option value value=['].['] >/ 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-11-13T16:33:03.907

维姆：

:%s/.* >//

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-12-24T08:06:39.700

事后不久，但如果它对任何人有用，我能够按照此处的一个示例（由 sdgfsdg 提供）并快速获取 Notepad++ 的正则表达式。

我必须同样从 HTML 选择下拉选项列表中提取一些冗余数据，格式如下：

```
<select>
  <option value="AC">saint_helena">Ascension Island</option>
  <option value="AD">andorra">Andorra</option>
  <option value="AE">united_arab_emirates">United Arab Emirates</option>
  <option value="AF">afghanistan">Afghanistan</option>:
  ...
</select> 
```

而我真正想要的是：

```
<select>
  <option value="AC">Ascension Island</option>
  <option value="AD">Andorra</option>
  <option value="AE">United Arab Emirates</option>
  <option value="AF">Afghanistan</option>
  ...
</select> 
```

经过一番拉扯后，我意识到从 5.8.5 版（2010 年 9 月）开始，正则表达式似乎仍然不允许表达式中的某些循环（除非有另一种语法），例如，下面会发现甚至">united_arab_emirated_emirates"> 尽管有额外的分隔下划线：

```
(">)([a-z]+([_]*[a-z]*)*)(">) 
```

此查询在大多数通用[RegEx 工具](http://erik.eae.net/playground/regexp/regexp.html)中都有效，但在 Notepad++ 中，我必须手动计算嵌套下划线的最大数量（不幸的是 8 个），使用更丑陋的：

```
(">)([a-z]+[_]*[a-z]*[_]*[a-z]*[_]*[a-z]*[_]*[a-z]*)[_]*[a-z]*[_]*[a-z]*[_]*[a-z]*[_]*[a-z]*(">) 
```

如果有人知道在 Notepad++ 的替换功能中模拟正则表达式循环的方法，请告诉我。

* * *

## **查找内容：** *(">)([az]+[_] *[az]* [_] *[az]* [_] *[az]* [_] *[az]* )[_] *[az]* [_] *[az]* [_] *[az]* [_] *[az]* (">)*

* * *

## **替换为：** *">*

* * *

## **结果：** *替换了 255 次。*

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2011-01-21T08:51:07.283

这是一篇关于 Notepad++ 正则表达式的好文章
[http://markantoniou.blogspot.com/2008/06/notepad-how-to-use-regular-expressions.html](http://markantoniou.blogspot.com/2008/06/notepad-how-to-use-regular-expressions.html)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2016-05-09T06:29:28.827

非常简单，只需查找：

```
<option value value=.*?> 
```

并单击替换

# javascript - 如何暂时停止标题属性显示工具提示？

> ID：287407
> 
> 赞同：5
> 
> 时间：2008-11-13T16:26:08.180
> 
> 标签：javascript, jquery, html

我在右键单击时显示了一个弹出 div（我知道这会破坏预期的功能，但 Google Docs 会这样做，为什么不呢？）但是我显示我的弹出窗口的元素有一个“标题”属性集，它出现在顶部我的分区。我仍然希望工具提示能够工作，但不是在弹出窗口存在时。

在弹出窗口打开/打开时停止显示工具提示的最佳方法是什么？

编辑：我正在使用 jQuery

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T16:45:35.973

使用[jquery](http://jquery.com)，您可以绑定悬停功能以将 title 属性设置为空白 onmouseover，然后在鼠标移出时将其重置。

```
$("element#id").hover(
 function() {
  $(this).attr("title","");
  $("div#popout").show();
 },
 function() {
  $("div#popout").hide();
  $(this).attr("title",originalTitle);
 }
); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-10-29T14:55:41.387

这是另一个如何通过使用[`data`](http://api.jquery.com/data/)值存储和[`prop`](http://api.jquery.com/prop/)赋值来完成的示例

```
$('[title]').on({
    mouseenter : function()
    {
        $(this).data('title', this.title).prop('title', '');
    },
    mouseleave: function()
    {
        $(this).prop('title', $(this).data('title'));
    }
}); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T16:28:40.373

我认为设置为空白，当弹出窗口关闭时，再次设置正确的文本。我认为这是阻止它的最简单方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-05-13T10:38:26.453

对我来说，我不在乎标题标签的内容是什么。我已经做了：

```
$('a').hover(function() {

    $(this).attr('title', '');

}); 
```

这阻止了标题标签的显示。

# linux - 拒绝不在 AD“域管理员”组中的用户登录 linux 机器？

> ID：287408
> 
> 赞同：2
> 
> 时间：2008-11-13T16:27:11.937
> 
> 标签：linux, ubuntu, active-directory

所以我设置了一个运行 8.04 版本的 Ubuntu 服务器。[我使用这些说明](http://devarthur.blogspot.com/2008/05/integrating-ubuntu-hardy-heron-804-with.html)将其设置为使用同样打开的包向我们的 Active Directory 进行身份验证。该设置的一部分是为登录机器的域管理员用户提供 sudo 访问权限。

现在，我想拒绝所有域登录的登录权限，但“域管理员”组中的用户除外。本地用户应该仍然可以登录。任何人都知道如何做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T22:01:46.817

我要回答我自己的问题！Jim 的思路似乎很有希望，但我对其进行了试验，它看起来不像同样开放的 LDAP 身份验证使用 /etc/passwd 文件中的任何内容。

我让它工作的正确方法是编辑 /etc/security/pam_lwidentity.conf 并取消注释并编辑以下部分：

```
# make successful authentication dependent on membership of one of
# the following SIDs/groups/users (comma-separated)
require_membership_of = MYDOMAIN\domain^admins 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T18:26:48.717

在 Windows 上，这是通过组策略完成的。Samba 目前不支持使用组策略管理 *nix 客户端（可能是 Samba 4？？）。

您可以尝试允许完全控制“域管理员”的计算机对象，并删除“所有人”的所有权限，但我认为这不会阻止登录。我只是想知道如果没有“允许验证”权限可能会无意中阻止登录。我远不是广告专家，所以这只是一个猜测。

[同样有一个产品来处理这个，但我认为它只在他们的企业包](http://www.likewisesoftware.com/products/likewise_enterprise/group_policy.php)中。

[编辑] 附录

您可以尝试使用 /etc/password 中的网络组语法。您可以通过运行“id”来验证您所在组的全名。如果您的组名有“\”或“”，您可能需要转义它们。

在 /etc/password 文件的末尾添加该行

```
+@AdminGroup::::::/bin/bash
+@Everyone::::::/sbin/nologin 
```

这是为 nis 网络组设计的，但值得一试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T18:52:00.850

3 ... 2 ... 1 结束

当这样的问题（非编程）被关闭时，我无法忍受。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-28T09:47:16.737

这里有一些可能有帮助的更多信息，

[Ubuntu - 加入/登录 Windows 域](http://www.petenetlive.com/KB/Article/0000384.htm)

皮特

# database - 版本控制中的 Oracle 包？

> ID：287409
> 
> 赞同：4
> 
> 时间：2008-11-13T16:27:16.510
> 
> 标签：database, oracle

幸运的是，我必须与 Oracle 合作。和包裹。

我有一个很多不同的开发人员都在接触的包，这让我很害怕。是否可以将包放入版本控制中？是否有某种软件已经可以做到这一点？如果没有，是否有某种出口程序？我可以从文件系统中获取文件吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T16:41:25.387

他们是如何输入的？我们在上一份工作中的工作方式是编辑一个文本文件，然后用 SQL*Plus 加载它。您可以将该源文件置于版本控制之下。

源必须在“ `CREATE OR REPLACE PACKAGE MYPACKAGE AS`”和“ `END;`”之间，后跟一个斜杠（“/”）；同上“PACKAGE BODY”而不是“PACKAGE”。

是的，有一种方法可以将源代码从 Oracle 中提取出来。它在一个表中，逐行查找[ALL_SOURCE](http://www.enterprisedb.com/docs/en/8.3/oracompat/EnterpriseDB_OraCompat_EN_8.3-239.htm)和 USER_SOURCE。您可以使用以下查询将其拉出

```
SELECT TEXT FROM ALL_SOURCE
WHERE TYPE='PACKAGE BODY'
  AND NAME='MYPACKAGE' 
  AND OWNER='MYPACKAGEOWNER'
ORDER BY LINE 
```

（未经测试，因为我不再有权访问 Oracle）和“PACKAGE”同上。

我认为最好使用 SQL*Plus 将其再次加载到 Oracle 中；确保设置为“SCAN OFF”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T19:05:38.950

我们有一个数据库级触发器来捕获对包的更改并将源代码保存在单独的表中。它不如版本控制好，但至少你知道什么时候发生了变化，并且如果以后的变化践踏它，你可以检索它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-02T05:49:41.887

您可以免费下载 sql developer：[http](http://www.oracle.com/technology/products/database/sql_developer/files/what_is_sqldev.html) ://www.oracle.com/technology/products/database/sql_developer/files/what_is_sqldev.html 。它与颠覆和 cvs 集成。

还有一个 Visual Studio 插件 ( [http://www.oracle.com/technology/tech/windows/odpnet/index.html](http://www.oracle.com/technology/tech/windows/odpnet/index.html) )。不知道你有没有用Visual Studio？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-04-29T14:33:07.567

尝试[http://code.google.com/p/oracle-ddl2svn/](http://code.google.com/p/oracle-ddl2svn/)版本控制 Oracle

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2011-03-09T14:35:52.783

也看看[这个链接](http://deltasql.sourceforge.net)。它是一个 PHP/mySQL 版本控制工具，适用于任何数据库类型，而且学习起来相当简单。

# iis - 如何在 IIS 中设置静态文件的可缓存性？

> ID：287414
> 
> 赞同：3
> 
> 时间：2008-11-13T16:29:23.727
> 
> 标签：iis, iis-6, cache-control, content-expiration

我在基于 IIS 6 的网站上的文件夹中有一些静态图像，我希望尽可能少地下载这些图像（以节省带宽）。我已将内容过期设置为 30 天后过期。我可以在 IIS 中做些什么来尝试最大化浏览器、代理和网关缓存的缓存吗？

比如添加一个Cache-Control头？还要别的吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T16:43:43.527

[http://www.galcho.com/Blog/post/2008/02/27/IIS7-How-to-set-cache-control-for-static-content.aspx](http://www.galcho.com/Blog/post/2008/02/27/IIS7-How-to-set-cache-control-for-static-content.aspx)

这是一篇博客文章，涵盖以下内容：

1.  允许覆盖静态内容设置
2.  使用以下命令设置缓存设置
3.  在客户端缓存

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T22:53:35.310

这是我对这个问题的回答：[静态内容的 http 标头中的“过期”？如何](https://stackoverflow.com/questions/102215/expires-in-http-header-for-static-content-how-to)

```
@ECHO OFF 
REM ---------------------------------------------------------------------------
REM Caching - sets the caching on static files in a web site
REM syntax 
REM     Caching.CMD 1 d:\sites\MySite\WWWRoot\*.CSS
REM 
REM   %1 is the WebSite ID
REM   %2 is the path & Wildcard - for example, d:\sites\MySite\WWWRoot\*.CSS
REM   _adsutil is the path to ADSUtil.VBS
REM ---------------------------------------------------------------------------

SETLOCAL
REM *******
REM SET THIS TO POINT TO adsutil.vbs - TYPICALLY c:\inetpub\adminscripts\adsutil.vbs
REM *******
SET _adsutil=D:\Apps\Scripts\adsutil.vbs

FOR %%i IN (%2) DO (
  ECHO Setting Caching on %%~ni%%~xi
  CSCRIPT %_adsutil% CREATE W3SVC/%1/root/%%~ni%%~xi "IIsWebFile"
  CSCRIPT %_adsutil% SET    W3SVC/%1/root/%%~ni%%~xi/HttpExpires "D, 0x69780"
  ECHO.
) 
```

它将 Web 根目录中每个 CSS 文件的缓存值设置为 5 天，然后像这样运行它：

```
Caching.CMD 1 \site\wwwroot\*.css
Caching.CMD 1 \site\wwwroot\*.js
Caching.CMD 1 \site\wwwroot\*.html
Caching.CMD 1 \site\wwwroot\*.htm
Caching.CMD 1 \site\wwwroot\*.gif
Caching.CMD 1 \site\wwwroot\*.jpg 
```

有点痛苦，但可行。

顺便说一句 - 要获取 HttpExpires 的值，请在 GUI 中设置值，然后运行

```
AdsUtil.vbs ENUM W3SVC/1/root/File.txt 
```

获得您需要的实际价值

# sql-server - 创建 1K 个 ID，为所有行分配一个 transactionID，同时考虑到并发性

> ID：287422
> 
> 赞同：0
> 
> 时间：2008-11-13T16:32:10.430
> 
> 标签：sql-server, concurrency, transactions

1.  客户端将向服务器请求 1K 行 ID。
2.  我必须确保我们有 1K 个 ID，clientID = -1，如果没有，我必须在表中插入 1K 个新 ID。
3.  然后我必须将那些 1K ID 与 clientID 链接起来
4.  将保留的 1K ID 返回给客户端。

是否就像将所有这些包装到一个事务中一样简单？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-15T12:23:19.697

您想添加第二个包含可用 ID 的表，如下所示：

AssignedIdsByClient：

*   AssignedId int 身份

*   ClientId int - 您将此 ID 范围提供给的客户

但是当您需要 1,000 个 ID 时，不要在此处插入 1,000 条记录：取而代之的是，取这个 AssignedID 并将其乘以 1,000。例如，如果某人的 AssignedID 为 15，这意味着他们在您实际需要 ID 的另一个表中拥有从 15,000 到 15,999 的 ID。

否则，如果每次有人想要一个 ID 范围时，您都尝试在单个事务中插入 1,000 条记录，那么您将面临并发噩梦。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T16:33:47.040

是的，您可以将这些全部包装在一个事务中，并且在您提交之前，其他客户端将无法看到它们。

# .net - 有没有办法在不使用 MSI 的情况下部署 .Net 应用程序？

> ID：287431
> 
> 赞同：1
> 
> 时间：2008-11-13T16:35:52.873
> 
> 标签：.net, windows, deployment, windows-installer, installation

我有一个要安装在终端服务器上的 .Net 程序。在过去，我创建了安装程序项目并生成了一个 MSI。但是，终端服务器要求在运行 MSI 之前关闭所有用户，我想避免这种情况。有没有办法在没有 MSI 的情况下进行安装？

有时对于某些用户帐户，我可以简单地复制 .exe 并使用它。但是对于其他用户，这样做会为明显存在的文件引发奇怪的“找不到文件”错误。（显然，如果该 exe 没有通过 MSI“正式”安装，则必须存在注册表设置才能运行 .net exe 可能存在也可能不存在？）

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-13T16:39:47.077

是的，一般来说，除非您需要将组件安装到全局程序集缓存 (GAC) 中，否则您需要做的就是将文件复制到要运行它的计算机上的文件夹中。要运行它，所有你需要做的是双击.exe文件。

唯一需要注意的是，机器必须已经安装了正确的 .net 框架......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T16:44:57.673

正如建议的那样，复制将是最简单的。

如果要创建非 MSI 安装程序，请查看[NSIS](http://nsis.sourceforge.net/Main_Page)。您还可以[在 NSIS 论坛](http://forums.winamp.com/forumdisplay.php?s=&forumid=65)上获得大力支持。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T17:28:07.337

我想知道为什么没有提到 ClickOnce ......它是一个“轻量级”安装，作为开发人员要做的工作最少（只需填写几个字段并在项目属性中按“发布”）并使用户的事情变得容易。名字就是座右铭：用户必须启动 ClickOnce-Application 并接受它的安装。.NET Framework 会将文件复制到一个特殊的 ClickOnce-Cache，创建一些到应用程序的链接（如果启用），甚至可以轻松进行开箱即用的自动更新。还可以检查先决条件，例如正确的 .NET Framework 或 SQL Server。

您可以在 wikipedia 中找到有关它的更多信息：[http ://en.wikipedia.org/wiki/ClickOnce](http://en.wikipedia.org/wiki/ClickOnce)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T16:39:24.317

.Net 应用程序通常不需要“安装”。您通常可以将所需的文件放在文件系统的某个位置，并为您的用户提供启动它的快捷方式。

但是，在某些情况下它是可取的。例如，如果您想将程序集添加到 GAC，安装可以自动执行该操作。如果您是这种情况，您是否考虑过 ClickOnce 部署？它可能能够处理你需要的东西。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-13T16:40:23.987

我们使用 Inno Setup ( [http://www.innosetup.com/isinfo.php](http://www.innosetup.com/isinfo.php) )。我对这个工具有最好的体验。它简单、轻量、免费和快速。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-13T17:22:03.230

如果您只想更新应用程序（而不是安装新的快捷方式或诸如此类的东西），那么我只会制作一个 WinRAR 自解压文件。您甚至可以在其中嵌入目标目录并指定安静安装。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-14T15:49:21.390

ByteEssence InstallMaker 是另一个免费选项：

[http://www.bytessence.com/bim.html](http://www.bytessence.com/bim.html)

# apache - apache 基准 postfile 的正确格式是什么？

> ID：287437
> 
> 赞同：20
> 
> 时间：2008-11-13T16:37:34.583
> 
> 标签：apache, benchmarking

apache 基准 postfile 的正确格式是什么？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-13T16:42:21.830

没关系，我找到了答案：

-p POST 文件 包含程序将在任何 HTTP POST 请求中发送到 Apache 服务器的数据的文件。文件的内容应该看起来像 **name=value&something=other**，带有特殊字符的 URL 编码。

[http://httpd.apache.org/docs/2.4/programs/ab.html](http://httpd.apache.org/docs/2.4/programs/ab.html)

# ruby-on-rails - 如何使用 Rails 的“查找”方法执行 AND 或 OR 查询？

> ID：287441
> 
> 赞同：5
> 
> 时间：2008-11-13T16:38:37.063
> 
> 标签：ruby-on-rails

假设我有一个名为“产品”的模型。假设产品具有三个字段。这些字段是“名称”（字符串类型）、“成本”（整数类型）和“is_visible”（布尔类型）。

1）如何使用Rails“查找”方法进行搜索查询（如果有其他方法，那很好），以便我可以搜索成本大于100的所有产品并且is_visible是真的？

2) 如果我们想将其更改为搜索到 name != '' OR cost == 0 怎么办？

执行 SQL 不是问题，但我想 Rails 有一种方法可以在不使用 SQL 的情况下对数据库执行 AND/OR 查询。

谢谢！

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-13T17:09:47.903

您需要在 find 方法上使用条件选项。条件选项可以是哈希、数组或字符串。条件有很多选项，所以我建议阅读它的[API 帮助](http://api.rubyonrails.org/classes/ActiveRecord/Base.html)。例如，如果您想 (1)：

```
Product.find(:all, :conditions => ['cost > ? and is_visible is true', 100]) 
```

或 (2)

```
Product.find(:all, :conditions => ["name != '' or cost =0]) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-13T17:50:12.067

如果您想要 LINQ 之类的东西，您可以检查提供更复杂过滤功能的替代 Ruby ORM，例如[DataMapper](http://www.datamapper.org/doku.php?id=docs:finders)或[Sequel 。](http://sequel.rubyforge.org/rdoc/files/doc/dataset_filtering_rdoc.html)

例如，在 Sequel 2 中，您可以编写：

```
items.filter((:cost > 100) & (:is_visible = 1)) 
```

您也可以使用按位“|” 运算符获取 OR 条件。

在 DataMapper 中，这看起来像：

```
Model.all(:cost.gt => 100, :is_visible.eq => 1) 
```

然而，有些人不喜欢这些特性是通过重载标准 Symbol 类来实现的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T17:10:09.603

这正是 SQL 旨在解决的问题，那么为什么不使用它呢？只需添加适当的 :condition 即可解决您的问题。

# .net - ADO.NET：将 DataRelation 添加到 DataSet；哪个是父母，哪个是孩子？

> ID：287443
> 
> 赞同：4
> 
> 时间：2008-11-13T16:39:03.740
> 
> 标签：.net, database, ado.net

考虑一个包含以下内容的 SQL Server 表：

```
ID   ParentID   Text
===  =========  =============
1    (null)     Product
2    (null)     Applications
3    1          Background
4    1          Details 
5    2          Mobile 
```

我用表填充了一个 SqlDataSet，现在我想将父子关系添加到 DataSet：

```
public DataRelation(
    string relationName,
    DataColumn parentColumn,
    DataColumn childColumn,
    bool createConstraints
) 
```

现在[这个人](http://aspalliance.com/822)使用：

```
DataRelation relation = newDataRelation("ParentChild",
    ds.Tables[0].Columns["ID"], //parentColumn
    ds.Tables[0].Columns["ParentID"] //childColumn, 
    true //createConstraints
); 
```

但是当我这样做时，我得到了例外：

```
This constraint cannot be enabled 
as not all values have corresponding parent values. 
```

人们建议将 false 传递给`createConstraints`; 但是为什么它对他有用呢？

什么是孩子，什么是父母？我会认为**子列**是需要指向父列的列，而**父列**是指向的东西，这将反转关系：

```
DataRelation relation = newDataRelation("ParentChild",
    ds.Tables[0].Columns["ParentID"], //parentColumn
    ds.Tables[0].Columns["ID"], //childColumn
    true //createConstraints
); 
```

那么它是哪一个？为什么他的工作？有什么例外？当他有空值时，为什么他可以创建约束？

*天，这里好热。*

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-04-18T02:17:08.213

哇没有人有正确的答案....

问题是您正在阅读的示例位于“第 3 步 - 检索数据和创建**嵌套关系**”标签下。

如果您想在 SAME TABLE（嵌套）的两列之间添加关系，则必须将“嵌套”变量设置为 true（在添加之前），如他的网站上所示。

> ```
> relation.Nested = true;
> ds.Relations.Add(relation); 
> ```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T16:55:04.613

父子关系也称为一对多关系，其中“one”是父母，“many”是孩子

孩子有一列保存父母的键（又名“外键”列）

在您的示例中，它可能不喜欢父 ID 的空值；传递 false 以避免启用约束可能会使错误消失

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T16:57:50.020

他的作品的一个原因可能是因为他的结果集中的所有行都可能有一个 parentID。子列是引用的列，父列是子列引用的列。换句话说，孩子指的是父母。因此，在您的情况下，Id 是父列，而 parentId 是子列。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T23:13:18.780

尝试反转关系的参数。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-02-07T15:36:44.670

[在数据关系标题下](http://www.roque-patrick.com/windows/final/bbl0201.html)查看这一点，它可能是什么是父项和什么是子项的答案

# sql - 为什么人们如此讨厌 SQL 游标？

> ID：287445
> 
> 赞同：129
> 
> 时间：2008-11-13T16:39:14.753
> 
> 标签：sql, database-cursor

我可以理解由于开销和不便而想要避免使用光标，但看起来有一些严重的光标恐惧症正在发生，人们会竭尽全力避免使用光标。

例如，一个问题询问如何用游标做一些明显微不足道的事情，并且接受的答案是使用带有递归自定义函数的公用表表达式 (CTE) 递归查询提出的，即使这将可以处理的行数限制为 32 （由于 sql server 中的递归函数调用限制）。这让我觉得这是一个糟糕的系统寿命解决方案，更不用说为了避免使用简单的光标而付出的巨大努力。

这种疯狂仇恨的原因是什么？是否有一些“著名的权威”发布了针对游标的教令？游标的心中是不是潜伏着某种无法言喻的邪恶，败坏了孩子们的品德之类的？

维基问题，对答案比代表更感兴趣。

相关信息：

[SQL Server 快进游标](https://stackoverflow.com/questions/37029/sql-server-fast-forward-cursors)

编辑：让我更准确地说：我知道**不应使用游标代替正常的关系操作**；这很简单。我不明白的是，即使光标是一个更简单和/或更有效的解决方案，人们也会竭尽全力避免光标，就像他们有笨蛋或其他东西一样。让我困惑的是非理性的仇恨，而不是明显的技术效率。

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2008-11-13T16:52:42.947

游标的“开销”只是 API 的一部分。游标是 RDBMS 的各个部分在幕后工作的方式。经常`CREATE TABLE`和`INSERT`有`SELECT`语句，并且执行是明显的内部游标实现。

使用更高级别的“基于集合的运算符”将游标结果捆绑到单个结果集中，这意味着更少的 API 来回。

游标早于提供一流集合的现代语言。旧的 C、COBOL、Fortran 等必须一次处理一行，因为没有可以广泛使用的“集合”概念。Java、C#、Python 等具有一流的列表结构来包含结果集。

**缓慢的问题**

在某些圈子里，关系连接是个谜，人们会编写嵌套游标而不是简单的连接。我已经看到真正史诗般的嵌套循环操作被写成大量的游标。击败 RDBMS 优化。而且跑得很慢。

简单的 SQL 重写以用连接替换嵌套的游标循环，单个平面游标循环可以使程序在 100 次内运行。[他们认为我是优化之神。我所做的只是用连接替换嵌套循环。仍然使用游标。]

这种混淆常常导致对游标的指控。但是，问题不是光标，而是光标的滥用。

**尺寸问题**

对于真正史诗般的结果集（即，将表转储到文件），游标是必不可少的。基于集合的操作无法将非常大的结果集具体化为内存中的单个集合。

**备择方案**

我尝试尽可能多地使用 ORM 层。但这有两个目的。首先，游标由 ORM 组件管理。其次，将 SQL 从应用程序中分离到一个配置文件中。并不是游标不好。对所有这些打开、关闭和获取进行编码不是增值编程。

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2008-11-13T16:41:24.203

光标使人们过度地将程序性思维方式应用于基于集合的环境。

而且他们很**慢**！

从[SQLTeam](http://www.sqlteam.com/article/cursors-an-overview)：

> 请注意，游标是访问 SQL Server 内部数据的最慢方式。仅当您确实需要一次访问一行时才应使用。我能想到的唯一原因是在每一行上调用一个存储过程。在[Cursor Performance 文章中](http://www.sqlteam.com/article/cursor-performance)，我发现游标**比基于集合的替代方案慢 30 倍以上**。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-11-13T16:48:09.743

上面有一个答案，上面写着“游标是访问 SQL Server 内部数据的最慢的方式......游标比基于集合的替代方案慢三十倍以上。”

这种说法在许多情况下可能是正确的，但作为一个笼统的说法，它是有问题的。例如，在我想要执行更新或删除操作影响正在接收持续生产读取的大表的许多行的情况下，我充分利用了游标。运行一次执行这些更新的存储过程最终比基于集合的操作更快，因为基于集合的操作与读取操作冲突并最终导致可怕的锁定问题（并可能完全杀死生产系统，在极端的情况下）。

在没有其他数据库活动的情况下，基于集合的操作普遍更快。在生产系统中，这取决于。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-11-13T16:43:29.707

在基于集合的操作会更好的地方，初学 SQL 开发人员往往会使用游标。尤其是当人们在学习了传统的编程语言后学习 SQL 时，“迭代这些记录”的心态往往会导致人们不恰当地使用游标。

大多数严肃的 SQL 书籍都包含一章禁止使用游标；写得好的游标清楚地表明游标有它们的位置，但不应该用于基于集合的操作。

显然，在某些情况下，游标是正确的选择，或者至少是正确的选择。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-11-13T16:44:52.887

当使用游标方法时，优化器通常不能使用关系代数来转换问题。游标通常是解决问题的好方法，但 SQL 是一种声明性语言，数据库中有很多信息，从约束到统计信息和索引，这意味着优化器有很多选项来解决问题。问题，而游标非常明确地指示解决方案。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-01-10T13:08:21.167

在 Oracle PL/SQL 中，游标不会导致表锁定，并且可以使用批量收集/批量提取。

Oracle 10 中常用的隐式游标

```
 for x in (select ....) loop
    --do something 
  end loop; 
```

一次隐式获取 100 行。显式批量收集/批量获取也是可能的。

但是 PL/SQL 游标是最后的手段，当您无法解决基于集合的 SQL 的问题时使用它们。

另一个原因是并行化，数据库并行化基于集合的大型语句比逐行命令式代码更容易。这与函数式编程变得越来越流行（Haskell、F#、Lisp、C# LINQ、MapReduce ...）的原因相同，函数式编程使并行化更容易。每台计算机的 CPU 数量正在增加，因此并行化变得越来越成为一个问题。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-11-13T16:41:13.080

一般来说，因为在关系数据库上，使用游标的代码性能比基于集合的操作差一个数量级。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-12-28T16:51:08.667

上面的答案并没有足够强调锁定的重要性。我不是游标的忠实拥护者，因为它们通常会导致表级锁定。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-11-14T00:53:46.487

值得我读的是，游标将执行其基于集合的对应物的“一个”位置在运行总数中。在一个小表上，按列对行求和的速度有利于基于集合的操作，但随着表的行大小增加，游标将变得更快，因为它可以简单地将运行总值带到下一次遍历环形。现在你应该*在哪里*做一个运行总计是一个不同的论点......

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-06-09T22:55:09.720

除了性能（非）问题之外，我认为游标的最大失败是调试起来很痛苦。尤其是与大多数客户端应用程序中的代码相比，调试往往相对容易，语言功能往往更容易。事实上，我认为几乎所有在 SQL 中使用游标执行的操作都应该首先发生在客户端应用程序中。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-13T16:45:14.180

您可以发布该光标示例或链接到该问题吗？可能有比递归 CTE 更好的方法。

除了其他注释之外，游标使用不当（通常）会导致不必要的页/行锁定。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-13T17:55:37.453

您可能会在第二段之后结束您的问题，而不是仅仅因为他们与您的观点不同而称他们为“疯子”，或者试图嘲笑可能有充分理由感受他们的方式的专业人士。

至于您的问题，虽然在某些情况下可能需要使用光标，但根据我的经验，开发人员决定“必须”比实际情况更频繁地使用光标。在我看来，有人在过多使用游标与不使用游标时犯错的机会要高得多。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-13T16:56:39.787

基本上 2 块代码做同样的事情。也许这是一个有点奇怪的例子，但它证明了这一点。SQL Server 2005：

```
SELECT * INTO #temp FROM master..spt_values
DECLARE @startTime DATETIME

BEGIN TRAN 

SELECT @startTime = GETDATE()
UPDATE #temp
SET number = 0
select DATEDIFF(ms, @startTime, GETDATE())

ROLLBACK 

BEGIN TRAN 
DECLARE @name VARCHAR

DECLARE tempCursor CURSOR
    FOR SELECT name FROM #temp

OPEN tempCursor

FETCH NEXT FROM tempCursor 
INTO @name

SELECT @startTime = GETDATE()
WHILE @@FETCH_STATUS = 0
BEGIN

    UPDATE #temp SET number = 0 WHERE NAME = @name
    FETCH NEXT FROM tempCursor 
    INTO @name

END 
select DATEDIFF(ms, @startTime, GETDATE())
CLOSE tempCursor
DEALLOCATE tempCursor

ROLLBACK 
DROP TABLE #temp 
```

单次更新需要 156 毫秒，而光标需要 2016 毫秒。

# silverlight - Silverlight 2.0 - 保存到文本文件

> ID：287447
> 
> 赞同：1
> 
> 时间：2008-11-13T16:39:30.930
> 
> 标签：silverlight

我想将一些简单的文本数据保存到我的 Silverlight 应用程序中的文件中 - 保存到 CSV 文件中。

用户按下一个按钮，代码在内存中生成文件的内容（一个字符串），然后出现一个提示，要求打开文件或保存到磁盘，就像通过普通网页一样。

我找到了一种复杂的方法： http: [//pagebrooks.com/archive/2008/07/16/save-file-dialog-in-silverlight.aspx](http://pagebrooks.com/archive/2008/07/16/save-file-dialog-in-silverlight.aspx)

但想知道是否有更简单的方法？尤其是最近发布的 Silverlight 2.0。

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T16:58:55.120

现在 Silverlight 2 不支持直接保存到用户的磁盘，即使有提示也是如此。这是未来版本正在考虑的一项功能，但让服务器推出数据的工作是当前的解决方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-23T20:45:24.370

只是为了更新这个线程—— Silverlight 3 现在有这个功能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-26T13:40:33.000

我现在使用 Silverlight 2.0 执行此操作，但关键是文件保存在托管 Silverlight 应用程序的 Web 服务器上，方法是让 Silverlight 应用程序调用 Web 服务。

可能不是您要找的东西，但这是一个选择。

*   Silverlight 应用程序调用 Web 服务，该服务发布字符串
*   Web 服务将字符串保存为服务器上的文件
*   文件可通过网络应用程序或其他方式获得

# asp.net - 任何免费的 ASP.NET 3.5 应用程序主机？

> ID：287449
> 
> 赞同：2
> 
> 时间：2008-11-13T16:39:54.143
> 
> 标签：asp.net, web-hosting

我想在 ASP.NET 3.5 中托管一个测试应用程序，但我在任何地方都找不到像样的免费主机！

我尝试了[http://www.aspspider.com/](http://www.aspspider.com/)，几天后我仍然有一个挂起的虚拟目录创建。

即使它上面有很多带有酒吧的横幅，也没关系。我只是想尝试一些东西！

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T16:45:51.463

如果您只是想尝试一些东西，总是[有动态 dns 方式](http://www.lullabot.com/articles/use-dynamic-dns-host-website-your-laptop)。

还有一些动态 dns 提供商：[dyndns](http://www.dyndns.com/)和[no-ip](http://www.no-ip.com/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T16:53:37.860

您的应用程序的性质是什么？我的服务器上可能有一些空间给你。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T16:55:05.127

如果只是为了测试一个应用程序，也有很多主机有 x 天的免费试用期，那么只需尝试其中一个。

当然也有退款保证，但这会有点阴暗。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-04T18:30:42.953

我觉得有另一个线程问同样的问题，因为我很确定那是我得到这个链接的地方；

[http://www.webhostforasp.net/freeaspwebhosting.aspx](http://www.webhostforasp.net/freeaspwebhosting.aspx)

它在他们进行升级时暂时关闭，但对于将来搜索论坛的任何人来说，值得一试。

# memory-leaks - 框架中的静态 EventHandler 内存泄漏

> ID：287456
> 
> 赞同：0
> 
> 时间：2008-11-13T16:41:50.613
> 
> 标签：memory-leaks

我正在解决我们在 .NET WinForms 应用程序中遇到的一些内存问题。我正在使用[SciTech 的 .NET Memory Profiler](http://memprofiler.com/)和[dotTrace](http://www.jetbrains.com/profiler/)，它们似乎都在通过 .NET Framework 控件中的静态事件处理程序指示根分配。从 google'ing 周围，我在[这里](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=115600)和[这里](http://www.scitech.se/blog/index.php/2007/10/05/memory-leak-in-toolstriptextboxcontrol/)找到了这方面的报告，但这似乎是在 .NET Framework 的 v1.1 和承诺的 2.0 修复上报告的。我们在 2.0 上运行，我们仍然看到这些问题。我发现的前 25 个内存违规者都指向这些静态事件处理程序，特别是 SystemEvents.UserPreferenceChanged。 [这家伙](http://www.scitech.se/blog/index.php/2007/10/05/memory-leak-in-toolstriptextboxcontrol/)竭尽全力寻找一种方法来放松这些处理程序。我还没有尝试过，但我确实尝试了 Microsoft 支持票中提到的解决方法，但没有一个对我有用。

我很清楚事件处理程序（尤其是长期存在的静态处理程序）的泄漏潜力，但这几乎是我无法控制的。有人对此有经验吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T18:24:40.280

对于 CLR 中真正严重的内存泄漏问题，我发现最好的工具是 windbg。如果你能克服神秘的语法，它是一个非常有效的调试器和泄漏跟踪器。缺点是使用起来不是很直观，而且学习曲线非常陡峭。

学习windbg的最好方法是做。这里有几篇关于使用 windbg 追踪泄漏的文章。

*   [http://blogs.msdn.com/ricom/archive/2004/12/10/279612.aspx](http://blogs.msdn.com/ricom/archive/2004/12/10/279612.aspx)
*   [http://weblogs.asp.net/scottgu/archive/2006/02/02/437231.aspx](http://weblogs.asp.net/scottgu/archive/2006/02/02/437231.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T18:49:08.580

我不知道 WinDBG 是否会在这里提供帮助。听起来这确实是框架中的一个错误。有没有办法可以发布一个简单的复制？如果是这样，那么我可以深入研究到底发生了什么，看看是否有解决方法。否则，您最好的选择是在[Connect](http://connect.microsoft.com)上开票。他们很擅长回到人身边。

如果您确实想使用 WinDBG 进行调查，您可以调查堆上发生的事情以了解发生了什么。开始查看周围挂着的对象是由什么根植的。我的猜测是，您将在上面的分析器中看到几乎所有内容。WinDBG 的棘手之处在于它可以告诉你任何你想要的东西——你必须知道你想要回答的问题。

# sql - SQL中的HAVING和WHERE有什么区别？

> ID：287474
> 
> 赞同：280
> 
> 时间：2008-11-13T16:46:11.727
> 
> 标签：sql, where-clause, having

`HAVING`声明中和`WHERE`有什么区别`SQL SELECT`？

编辑：我已将史蒂文的答案标记为正确答案，因为它包含链接上的关键信息：

> `GROUP BY`不使用时，行为`HAVING`类似于`WHERE`子句

我所看到的`WHERE`情况并没有`GROUP BY`，这也是我开始困惑的地方。当然，在您知道这一点之前，您无法在问题中指定它。

* * *

## 回答 #1

> 赞同：397
> 
> 时间：2008-11-13T16:53:37.983

HAVING：用于在聚合发生*后检查条件。*
WHERE：用于在聚合发生*之前检查条件。*

这段代码：

```
select City, CNT=Count(1)
From Address
Where State = 'MA'
Group By City 
```

为您提供 MA 中所有城市的表格以及每个城市的地址数量。

这段代码：

```
select City, CNT=Count(1)
From Address
Where State = 'MA'
Group By City
Having Count(1)>5 
```

为您提供 MA 中超过 5 个地址的城市表以及每个城市的地址数。

* * *

## 回答 #2

> 赞同：100
> 
> 时间：2008-11-13T16:48:26.233

> HAVING 为 SELECT 语句中使用的组或聚合函数指定搜索条件。

[来源](http://blog.sqlauthority.com/2007/07/04/sql-server-definition-comparison-and-difference-between-having-and-where-clause/)

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2011-11-28T10:15:32.270

对我来说，第一个区别：如果`HAVING`从 SQL 语言中删除，那么生活或多或少会像以前一样继续。当然，少数查询需要使用派生表、CTE 等重写，但可以说它们更容易理解和维护。也许需要重写供应商的优化器代码来解决这个问题，这又是行业内改进的机会。

现在考虑一下`WHERE`从语言中删除。这一次，存在的*大多数*查询都需要在没有明显替代构造的情况下重写。编码人员将不得不使用该子句来模拟先前的子句，例如对已知仅包含一行的表进行内部连接（例如`DUAL`在 Oracle 中）。这样的结构是人为的；很明显，语言中缺少某些东西，结果情况会更糟。`ON``WHERE`

TL;DR 我们`HAVING`明天可能会输，情况不会更糟，可能会更好，但不能这样说`WHERE`。

* * *

从这里的答案来看，似乎很多人没有意识到`HAVING`可以在没有从句的情况下使用`GROUP BY`从句。在这种情况下，`HAVING`子句应用于整个表表达式，并且要求`SELECT`子句中只出现常量。通常，该`HAVING`子句将涉及聚合。

这比听起来更有用。例如，考虑这个查询来测试`name`列对于 中的所有值是否是唯一的`T`：

```
SELECT 1 AS result
  FROM T
HAVING COUNT( DISTINCT name ) = COUNT( name ); 
```

只有两种可能的结果：如果`HAVING`子句为真，则结果为包含 value 的单行`1`，否则结果将为空集。

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2008-11-13T16:47:53.253

HAVING 子句被添加到 SQL 中，因为 WHERE 关键字不能与聚合函数一起使用。

查看此[w3schools 链接](http://www.w3schools.com/SQL/sql_having.asp)以获取更多信息

句法：

```
SELECT column_name, aggregate_function(column_name)
FROM table_name
WHERE column_name operator value
GROUP BY column_name
HAVING aggregate_function(column_name) operator value 
```

* * *

像这样的查询：

```
SELECT column_name, COUNT( column_name ) AS column_name_tally
  FROM table_name
 WHERE column_name < 3
 GROUP 
    BY column_name
HAVING COUNT( column_name ) >= 3; 
```

...可以使用派生表重写（并省略`HAVING`），如下所示：

```
SELECT column_name, column_name_tally
  FROM (
        SELECT column_name, COUNT(column_name) AS column_name_tally
          FROM table_name
         WHERE column_name < 3
         GROUP 
            BY column_name
       ) pointless_range_variable_required_here
 WHERE column_name_tally >= 3; 
```

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2012-08-29T00:57:57.793

两者的区别在于与 GROUP BY 子句的关系：

*   WHERE 在 GROUP BY 之前；SQL 在对记录进行分组之前评估 WHERE 子句。

*   HAVING 在 GROUP BY 之后；SQL 在对记录进行分组后评估 HAVING。

[![选择语句图](https://i.stack.imgur.com/PCCsI.gif)](https://i.stack.imgur.com/PCCsI.gif)

**参考**

*   [SQLite SELECT 语句语法/铁路图](http://www.sqlite.org/images/syntax/select-stmt.gif)

*   [Informix SELECT 语句语法/铁路图](http://www.pacs.tju.edu/informix/answers/english/docs/visionary/infoshelf/sqls/01select.fm.html#148676)

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2008-11-13T16:47:06.703

`HAVING`当您使用聚合（例如`GROUP BY`.

```
SELECT edc_country, COUNT(*)
FROM Ed_Centers
GROUP BY edc_country
HAVING COUNT(*) > 1
ORDER BY edc_country; 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-11-13T16:53:49.903

WHERE 作为对 SQL 返回的集合的限制；它使用 SQL 的内置集合操作和索引，因此是过滤结果集的最快方法。尽可能始终使用 WHERE。

HAVING 对于某些聚合过滤器是必需的。它在 sql 检索、组装和排序结果之后过滤查询。因此，它比 WHERE 慢得多，除非在需要它的情况下，否则应避免使用它。

即使在 WHERE 更快的情况下，SQL Server 也会让您轻松使用 HAVING。不要这样做。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2016-03-17T12:49:58.230

WHERE 子句不适用于聚合函数
意味着：你不应该使用这样的奖励：表名

```
SELECT name  
FROM bonus  
GROUP BY name  
WHERE sum(salary) > 200 
```

HERE 而不是使用 WHERE 子句，您必须使用 HAVING..

不使用 GROUP BY 子句，HAVING 子句仅用作 WHERE 子句

```
SELECT name  
FROM bonus  
GROUP BY name  
HAVING sum(salary) > 200 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2016-12-31T05:17:17.117

**区别黑白`WHERE`和`HAVING`子句：**

`WHERE`and`HAVING`子句的主要区别在于，`WHERE`用于行操作和`HAVING`用于列操作。

为什么我们需要`HAVING`从句？

众所周知，聚合函数只能在列上执行，所以我们不能在`WHERE`子句中使用聚合函数。`HAVING`因此，我们在子句中使用聚合函数。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2016-12-31T05:06:37.540

一种思考方式是，have 子句是 where 子句的附加过滤器。

**WHERE**子句用于过滤结果中的记录。过滤器发生在进行任何分组之前。**HAVING**子句用于过滤组中的值

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-13T16:56:27.463

在聚合查询中，（使用聚合函数的任何查询）where 子句中的谓词在生成聚合中间结果集之前进行评估，

Have 子句中的谓词在生成聚合结果集后应用于聚合结果集。这就是为什么聚合值的谓词条件必须放在Having 子句而不是Where 子句中的原因，以及为什么您可以在Having 子句中使用Select 子句中定义的别名，而不是在Where 子句中。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-03-09T16:50:57.423

`WHERE`我遇到了一个问题，发现和之间的另一个区别`HAVING`。它对索引列的作用不同。

`WHERE my_indexed_row = 123`将显示行并在其他索引行上自动执行“ORDER ASC”。

`HAVING my_indexed_row = 123`显示从最旧的“插入”行到最新行的所有内容，没有排序。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2016-10-02T20:09:56.680

当`GROUP BY`不使用时，`WHERE`and`HAVING`子句本质上是等价的。

但是，何时`GROUP BY`使用：

*   该`WHERE`子句用于从结果中过滤记录。过滤发生在进行任何分组之前。
*   该`HAVING`子句用于过滤组中的值（即，在执行聚合到组后检查条件）。

*来自[这里的资源](https://www.toptal.com/sql/interview-questions#iquestion-91242)*

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-13T16:50:14.763

从[这里](http://dev.mysql.com/doc/refman/5.0/en/select.html)。

> SQL 标准要求 HAVING 必须仅引用 GROUP BY 子句中的列或聚合函数中使用的列

与应用于数据库行的 WHERE 子句相反

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2012-06-06T10:26:58.647

在做一个项目时，这也是我的问题。如上所述，**HAVING**检查已经找到的查询结果的条件。但是**WHERE**用于在查询运行时检查条件。

让我举一个例子来说明这一点。假设你有一个这样的数据库表。

> usertable{ int userid, date datefield, int dailyincome }

假设，以下行在表中：

> 1, 2011-05-20, 100
> 
> 1, 2011-05-21, 50
> 
> 1、2011-05-30、10
> 
> 2、2011-05-30、10
> 
> 2、2011-05-20、20

现在，我们想要得到`userid`s 和`sum(dailyincome)`who`sum(dailyincome)>100`

如果我们写：

> SELECT userid, sum(dailyincome) FROM usertable WHERE sum(dailyincome)>100 GROUP BY userid

这将是一个错误。正确的查询是：

> SELECT userid, sum(dailyincome) FROM usertable GROUP BY userid HAVING sum(dailyincome)>100

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-01-29T10:33:42.847

WHERE 子句用于比较基表中的值，而 HAVING 子句可用于过滤查询结果集中聚合函数的结果 点击[这里](http://techformobile.com/techforum/php/where-clause-and-having-clause/ "这个 where_and-having 子句")！

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-06-23T14:47:11.527

当不使用 GROUP BY 时，WHERE 和 HAVING 子句本质上是等价的。

但是，当使用 GROUP BY 时：

*   WHERE 子句用于从结果中过滤记录。过滤发生在进行任何分组之前。
*   HAVING 子句用于过滤组中的值（即，在执行聚合到组后检查条件）。

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2008-11-13T16:49:08.743

我使用 HAVING 来约束基于聚合函数结果的查询。EG select * in blahblahblah group by SOMETHING with count(SOMETHING)>0

# com - 何时更改类型库上的 GUID

> ID：287476
> 
> 赞同：4
> 
> 时间：2008-11-13T16:47:10.103
> 
> 标签：com, guid, typelib

我知道当您在 COM 接口中添加/更改/删除方法时，您应该更改接口/coclass GUID，但是类型库呢。什么时候应该更改类型库的 GUID？如果类型库中的 GUID 已更改，您会更改它吗？或者您是否应该仅在类型库中没有自己的 GUID 的内容发生更改时更改它。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T18:07:26.447

基本原则是 COM 接口和类型库应该是不可变的（也就是说，它们永远不应该改变）。如果您更改 COM 接口中的一项，则新版本需要是与先前版本完全分离的实体。这样做的唯一方法是更改​​库中每个接口的 GUID 和类型库本身的 GUID。更改类型库的名称也是一个好主意（为了您自己的个人理智）。

理想情况下，您永远不应该更改 COM 接口。而是创建一个新的派生 COM 接口并在新的类型库中发布。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T23:26:20.217

我有一个类似的问题。

我有一个带有 CLSID_A 的原始控件，它在一些带有 GUID_A 的 1.0 类型库中实现了接口 IID_A

后来，我决定在原来的控件上增加一个新的界面。然后它将实现 IID_A 和 IID_B 接口。我想我可能应该保持相同的 CLSID，但不知道如何处理 typelib 本身。我主要是在做涉及 QueryInterface 的 VC++ 编程的东西，并且不太关心版本控制和类型库。您想创建一个具有特定 CLSID 的对象，您只需询问 CoCreated 实例……然后查询接口以获取对新接口的潜在支持……

现在，当我进入 LabVIEW 等更高级的环境或 Microsoft .NET 等设计时插入式开发环境时，MFC 的东西似乎就坏了。

您在回答中提到要更改所有 GUID。基于可用功能调整应用程序的整个范例是否已死，新应用程序仍然可以将其基本功能与旧版本的控件一起使用？也许我没有抓住后来的浪潮：使用旧的控件版本来调整应用程序运行没有意义，它只需要特定的控件版本。这就是 M$ 也推出 ASSEMBLY 的原因。

# c# - 什么是控制反转/面向方面意义上的 .NET 代理对象？

> ID：287479
> 
> 赞同：4
> 
> 时间：2008-11-13T16:47:26.420
> 
> 标签：c#, .net, inversion-of-control, aop, proxy-classes

什么是控制反转/面向方面意义上的代理对象？

关于代理对象是什么的任何好文章？
为什么要使用一个？
以及如何用 C# 编写一个？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-13T17:05:24.920

一般来说，代理对象是一个对象（类的实例），它公开与“真实类”完全相同的公共接口，但只是将对其成员的所有调用转发给另一个真实类。使用代理对象有多种原因...

一个目的是“假装”成为真正的类，以便客户端组件（或对象）可以“相信”它正在与“真实”对象交谈，但在代理内部，其他东西（如日志记录、事务支持等） ) 正在同时进行...其次，与真实对象相比，代理可能非常便宜。并且经常用于当客户端不使用它们时，可以保存真实对象（关闭或释放到池中以供其他客户端使用）......代理保持“活动”并且客户端认为它仍然有与真实对象的连接，但每当它“调用”对象时，它实际上是在调用代理，代理会获取另一个真实对象来处理调用，然后在调用完成时释放真实对象。

至于**控制反转**（IOC）。这是指一种通用模式（也称为依赖注入），其中类内部的依赖对象从客户端代码“注入”到类的实例中，以控制哪个实例将使用的依赖对象的版本... IOC 可用于将“代理”对象注入到它认为正在使用真实对象的类中...*控制反转*一词指的是在使用在这种模式下，关于调用哪个实际实现的决定不再由进行调用的类控制，而是由该类的客户端控制，当它将依赖对象的实例*注入*要用于此的类中时称呼。

通常，术语 IOC 与所谓的*IOC 容器一起使用*，这是一个专门设计用于创建依赖类实例的类，该类基于它从硬连线依赖以外的其他来源（通常来自某种配置文件）获得的那些类（类型）的松散耦合信息. 通常，当您使用 IOC 容器时，您会在应用程序启动时创建它的实例，然后（通过读取配置数据或其他）“注册”IOC 容器将负责的每个类（类型） , 有一个键值。关键通常是这个注册的所有实例必须实现的抽象类型或接口）。然后，在您的应用程序的正常操作中，您可能已经新建了其中一种类型的实例，您调用 IOC 容器，并要求它提供一个实例，使用抽象类型/接口作为键。然后，IOC 容器使用反射或动态加载（或其他）来创建已使用该密钥“注册”的任何类型的实例。这样，只需更改配置数据，您就可以控制应用程序使用的实际类型，将它们在一个环境或部署位置从另一个环境中使用的那些更改。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T19:53:16.187

关于这方面的一个很好的资源是旧的“四人帮”设计模式书。这本书对任何开发面向对象软件的人都非常有用。我个人使用代理对象来延迟加载 NHibernate。我不使用具有控制反转的代理，因为我只使用我的 IoC 解析接口类型。

Charles Bretana 的解释非常好。

我无法想象代理和 AoP 之间的关系。有人可以在这里解释吗？

# jquery - jQuery斑马选择器

> ID：287489
> 
> 赞同：5
> 
> 时间：2008-11-13T16:51:02.403
> 
> 标签：jquery

我有一个名为 grid 的 CSS 类，我把它放在我的桌子上。我想 Zebra 剥离我的偶数行，所以我使用以下 jQuery 代码

```
$(".grid tr:nth-child(even)").addClass("even"); 
```

这基本上是说“将 css 类应用到任何 tr 标签，它的父标签（在任何级别）都有一个网格类。” 问题是当我有嵌套表时，子表的 tr 标签也将获得偶数样式。由于我没有用网格类指定子表，我不希望它拾取斑马条纹。

如何指定仅在 tr 标签上应用偶数类，这些标签是具有网格类的标签的直接后代？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-13T16:54:19.123

您想使用不同的选择器，例如子选择器：

```
$(".grid > tr:nth-child(even)").addClass("even"); 
```

这将选择限制为您`.grid`唯一的指导孩子。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T17:46:27.427

有一篇很棒的 jQuery 博客文章可能对您有用： [Zebra Table Showdown](http://blog.jquery.com/2006/10/18/zebra-table-showdown/)。

这篇文章还包括一个关于如何在大多数其他主要 JavaScript 库中进行斑马条纹的有趣讨论。

向下滚动查看有关使用 jQuery 为斑马条纹添加悬停效果的评论。

# security - 加密/散列数据库中的纯文本密码

> ID：287517
> 
> 赞同：62
> 
> 时间：2008-11-13T17:00:41.730
> 
> 标签：security, encryption, passwords, security-by-obscurity

我**继承**了一个 Web 应用程序，我刚刚发现它在 SQL Server 数据库中以纯文本形式存储了超过 300,000 个用户名/密码。我意识到这是一件非常糟糕的事情™。

知道我必须更新登录和密码更新过程以加密/解密，并且对系统其余部分的影响最小，您会推荐什么作为从数据库中删除纯文本密码的最佳方法？

任何帮助表示赞赏。

**编辑：对不起，如果我不清楚，我的意思是问你加密/散列密码的程序是什么，而不是特定的加密/散列方法。**

我应该：

1.  备份数据库
2.  更新登录/更新密码代码
3.  几个小时后，检查用户表中的所有记录，对密码进行哈希处理并替换每一个
4.  测试以确保用户仍然可以登录/更新密码

我想我的担忧更多来自于用户的数量，所以我想确保我做的正确。

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2008-11-13T19:02:27.147

编辑（2016）：按优先顺序使用[Argon2](https://en.wikipedia.org/wiki/Argon2)、[scrypt](https://en.wikipedia.org/wiki/Scrypt)、[bcrypt](https://en.wikipedia.org/wiki/Bcrypt)或[PBKDF2](https://en.wikipedia.org/wiki/PBKDF2)。在您的情况下使用尽可能大的减速因子。使用经过审查的现有实施。确保使用适当的盐（尽管您使用的库应该为您确保这一点）。

* * *

当您散列密码时，请使用**DO NOT USE PLAIN MD5**。

使用[PBKDF2](https://www.rfc-editor.org/rfc/rfc2898#section-5.2)，这基本上意味着使用随机盐来防止[彩虹表](http://en.wikipedia.org/wiki/Rainbow_table)攻击，并迭代（重新散列）足够多的时间来减慢散列速度 - 不是你的应用程序花费太长时间，而是足以让攻击者暴力破解大量不同的密码会通知

从文件：

*   迭代至少 1000 次，最好更多 - 为你的实现计时，看看有多少迭代对你来说是可行的。
*   8 字节（64 位）的 salt 就足够了，而且随机数不需要是安全的（salt 是未加密的，我们不担心有人会猜到它）。
*   在散列时应用盐的一个好方法是将 HMAC 与您最喜欢的散列算法一起使用，使用密码作为 HMAC 密钥，盐作为要散列的文本（请参阅文档的[这一部分](https://www.rfc-editor.org/rfc/rfc2898#appendix-B.1)）。

Python 中的示例实现，使用 SHA-256 作为安全哈希：

**编辑**：正如 Eli Collins 所述，这不是 PBKDF2 实现。您应该更喜欢遵循标准的实现，例如[PassLib](http://packages.python.org/passlib/)。

```
from hashlib import sha256
from hmac import HMAC
import random

def random_bytes(num_bytes):
  return "".join(chr(random.randrange(256)) for i in xrange(num_bytes))

def pbkdf_sha256(password, salt, iterations):
  result = password
  for i in xrange(iterations):
    result = HMAC(result, salt, sha256).digest() # use HMAC to apply the salt
  return result

NUM_ITERATIONS = 5000
def hash_password(plain_password):
  salt = random_bytes(8) # 64 bits

  hashed_password = pbkdf_sha256(plain_password, salt, NUM_ITERATIONS)

  # return the salt and hashed password, encoded in base64 and split with ","
  return salt.encode("base64").strip() + "," + hashed_password.encode("base64").strip()

def check_password(saved_password_entry, plain_password):
  salt, hashed_password = saved_password_entry.split(",")
  salt = salt.decode("base64")
  hashed_password = hashed_password.decode("base64")

  return hashed_password == pbkdf_sha256(plain_password, salt, NUM_ITERATIONS)

password_entry = hash_password("mysecret")
print password_entry # will print, for example: 8Y1ZO8Y1pi4=,r7Acg5iRiZ/x4QwFLhPMjASESxesoIcdJRSDkqWYfaA=
check_password(password_entry, "mysecret") # returns True 
```

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2008-11-13T18:13:02.753

基本策略是使用密钥派生函数用一些盐“散列”密码。盐和哈希结果存储在数据库中。当用户输入密码时，盐和他们的输入以相同的方式散列并与存储的值进行比较。如果它们匹配，则对用户进行身份验证。

细节决定成败。首先，很大程度上取决于所选择的哈希算法。像 PBKDF2 这样的密钥派生算法，基于基于哈希的消息身份验证代码，使得查找将产生给定输出（攻击者在数据库中找到的内容）的输入（在本例中为密码）“在计算上不可行” ）。

预计算字典攻击使用从哈希输出到密码的预计算索引或字典。散列很慢（或者它应该是，无论如何），所以攻击者对所有可能的密码进行一次散列，并以这样的方式存储索引的结果，给定一个散列，他可以查找相应的密码。这是空间与时间的经典权衡。由于密码列表可能很大，因此有一些方法可以调整权衡（如彩虹表），以便攻击者可以放弃一点速度来节省大量空间。

通过使用“加密盐”来阻止预计算攻击。这是一些使用密码散列的数据。**它不需要是秘密，**它只需要对于给定的密码是不可预测的。对于盐的每个值，攻击者都需要一个新字典。如果您使用一个字节的盐，攻击者需要 256 个字典副本，每个副本使用不同的盐生成。首先，他会使用盐来查找正确的字典，然后他会使用散列输出来查找可用的密码。但是如果你添加 4 个字节呢？现在他需要40亿本词典。通过使用足够大的盐，可以排除字典攻击。在实践中，来自加密质量随机数生成器的 8 到 16 字节数据是一种很好的盐。

通过预先计算，攻击者每次尝试都会计算哈希值。现在找到密码需要多长时间完全取决于散列候选人需要多长时间。该时间通过散列函数的迭代而增加。迭代次数一般是密钥推导函数的参数；今天，许多移动设备使用 10,000 到 20,000 次迭代，而服务器可能使用 100,000 或更多。（bcrypt 算法使用术语“成本因子”，它是所需时间的对数度量。）

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-11-13T17:07:42.340

我想你将不得不为加密密码添加一列到数据库中，然后对获取当前密码的所有记录运行批处理作业，对其进行加密（正如其他人提到的那样，像 md5 这样的哈希是非常标准的**编辑：但不应该单独使用 - 请参阅其他答案以获得良好的讨论**），将其存储在新列中并检查一切顺利进行。

然后，您将需要更新您的前端以在登录时对用户输入的密码进行哈希处理，并验证与存储的哈希值相比，而不是检查明文与明文。

在我最终将明文密码全部删除之前，将两列都保留一段时间以确保没有发生任何事情，这对我来说似乎是谨慎的。

也不要忘记，只要密码被访问，代码就必须更改，例如密码更改/提醒请求。您当然会失去通过电子邮件发送忘记密码的能力，但这并不是一件坏事。您将不得不使用密码重置系统。

编辑：最后一点，您可能要考虑避免我第一次尝试在测试平台安全登录网站上犯的错误：

处理用户密码时，请考虑散列发生的位置。在我的例子中，哈希是由运行在网络服务器上的 PHP 代码计算出来的，但是密码是从用户的机器上以明文形式传输到页面的！这在我工作的环境中没问题（ish），因为它无论如何都在 https 系统中（uni 网络）。但是，在现实世界中，我想您可能希望在密码离开用户系统之前使用 javascript 等对密码进行哈希处理，然后将哈希传输到您的站点。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-13T17:18:31.927

遵循[Xan 的建议](https://stackoverflow.com/questions/287517/encrypting-plain-text-passwords-in-database#287538)，将当前密码列保留一段时间，这样如果出现问题，您可以快速轻松地回滚。

至于加密你的密码：

*   用盐
*   使用适用于密码的哈希算法（即 - 它很*慢*）

有关详细信息，请参阅 Thomas Ptacek 的[《彩虹表足够：您需要了解](http://www.securityfocus.com/blogs/262)的有关安全密码方案的内容》。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-13T17:19:31.817

我认为您应该执行以下操作：

1.  创建一个名为 HASHED_PASSWORD 或类似名称的新列。
2.  修改您的代码，使其检查两列。
3.  逐渐将密码从非散列表迁移到散列表。例如，当用户登录时，将他或她的密码自动迁移到散列列并删除未散列的版本。所有新注册的用户都将拥有散列密码。
4.  几个小时后，您可以运行一个脚本，该脚本一次迁移 n 个用户
5.  当您没有更多未散列的密码时，您可以删除旧密码列（您可能无法这样做，具体取决于您使用的数据库）。此外，您可以删除处理旧密码的代码。
6.  你完成了！

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-02T17:00:52.237

这是我几周前的一个问题。我们正在将一个大型 MIS 项目部署到 975 个不同的地理位置，我们自己的用户凭证存储将用作不同组已实施和正在使用的应用程序的身份验证器。我们已经提供了基于 REST 和 SOAP 的身份验证服务，但客户坚持能够从其他应用程序访问用户凭据存储，只需一个数据库连接到相关表或视图的只读视图。叹息...... *（这个高度耦合的糟糕设计决策是另一个问题的主题）。*

这迫使我们坐下来将我们的加盐和迭代哈希密码存储方案转换为规范，并提供一些不同的语言实现以便于集成。

我们简称它为相当安全的散列密码或[FSHP](http://github.com/bdd/fshp)。在 Python、Ruby、PHP5 中实现它并将其发布到公共领域。可在[http://github.com/bdd/fshp上的 GitHub 上消费、分叉、燃烧或吐出](http://github.com/bdd/fshp)

FSHP 是一种加盐的、迭代散列的密码散列实现。

设计原理与RFC 2898 中 的[PBKDF1规范](http://www.faqs.org/rfcs/rfc2898.html)*（又名：PKCS #5：基于密码的加密规范 2.0 版）* 类似。FSHP 允许在 SHA-1 和 SHA-2 中选择盐长度、迭代次数和底层加密哈希函数（256、384、512）。在每个输出的开头自定义元前缀使其可移植，同时让消费者选择自己的密码存储安全基线。

**安全**：

默认 FSHP1 使用 8 字节盐，SHA-256 散列的 4096 次迭代。- 通过将所需空间乘以 2^64，8 字节盐使彩虹表攻击变得不切实际。- 4096 次迭代导致蛮力攻击相当昂贵。- 在此版本发布时，没有已知的针对 SHA-256 的攻击可以通过少于 2^128 次操作的计算工作来发现冲突。

**实现：**

*   Python：使用 2.3.5（带 hashlib）、2.5.1、2.6.1 进行测试
*   Ruby：用 1.8.6 测试
*   PHP5：用 5.2.6 测试

非常欢迎每个人创建缺失的语言实现或完善当前的实现。

**基本操作*（使用 Python）*：**

```
>>> fsh = fshp.crypt('OrpheanBeholderScryDoubt')
>>> print fsh
{FSHP1|8|4096}GVSUFDAjdh0vBosn1GUhzGLHP7BmkbCZVH/3TQqGIjADXpc+6NCg3g==
>>> fshp.validate('OrpheanBeholderScryDoubt', fsh)
True 
```

**自定义地穴：**

让我们削弱我们的密码散列方案。- 将盐长度从默认的 8 减少到 2。 - 将迭代轮次从默认的 4096 减少到 10。 - 选择具有 SHA-1 的 FSHP0 作为底层哈希算法。

```
>>> fsh = fshp.crypt('ExecuteOrder66', saltlen=2, rounds=10, variant=0)
>>> print fsh
{FSHP0|2|10}Nge7yRT/vueEGVFPIxcDjiaHQGFQaQ== 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-13T17:06:52.187

正如其他人所提到的，如果可以提供帮助，您就不想解密。标准的最佳实践是使用单向哈希进行加密，然后在用户登录时对其密码进行哈希比较。

否则，您将不得不使用强加密来加密然后解密。如果政治原因很强烈（例如，您的用户习惯于致电服务台以检索他们的密码，并且您有来自高层的强烈压力不要更改密码），我只会建议这样做。在这种情况下，我将从加密开始，然后开始构建业务案例以转向散列。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-13T17:09:19.187

出于身份验证的目的，您应该避免使用可逆加密存储密码，即您应该只存储密码哈希，并根据您存储的哈希检查用户提供的密码的哈希。但是，这种方法有一个缺点：如果攻击者掌握了您的密码存储数据库，它很容易受到[彩虹表攻击。](http://en.wikipedia.org/wiki/Rainbow_table)

您应该做的是存储预选（和秘密）盐值 + 密码的哈希值。即，连接盐和密码，散列结果，并存储这个散列。进行身份验证时，请执行相同的操作 - 连接您的盐值和用户提供的密码、哈希，然后检查是否相等。这使得彩虹表攻击不可行。

当然，如果用户通过网络发送密码（例如，如果您正在使用 Web 或客户端-服务器应用程序），那么您不应该以明文形式发送密码，而不是存储散列（salt +密码）您应该存储并检查哈希（盐+哈希（密码）），并让您的客户端对用户提供的密码进行预哈希并通过网络发送该密码。这也可以保护您的用户密码，以防用户（许多人）将相同的密码用于多种用途。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-13T17:21:33.560

*   使用 MD5 之类的加密，将其编码为十六进制字符串
*   你需要盐；在您的情况下，用户名可以用作盐（它必须是唯一的，用户名应该是可用的最唯一的值;-)
*   使用旧密码字段存储 MD5，但标记 MD5（例如“MD5:687A878....”）以便旧（纯文本）和新（MD5）密码可以共存
*   如果有 MD5，则更改登录过程以验证 MD5，否则验证明文密码
*   更改“更改密码”和“新用户”功能以仅创建 MD5 密码
*   现在您可以运行转换批处理作业，这可能需要尽可能长的时间
*   运行转换后，删除 legacy-support

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-14T17:25:52.210

步骤 1：将加密字段添加到数据库

第 2 步：更改代码，以便在更改密码时，它会更新两个字段，但登录仍使用旧字段。

第 3 步：运行脚本以填充所有新字段。

第 4 步：更改代码以便使用新字段登录并更改密码停止更新旧字段。

第 5 步：从数据库中删除未加密的密码。

这应该允许您在不中断最终用户的情况下完成转换。

另外：我要做的是将新数据库字段命名为与密码完全无关的名称，例如“LastSessionID”或类似无聊的名称。然后不用删除密码字段，只需填充随机数据的哈希值。然后，如果您的数据库遭到入侵，他们可以花费所有时间尝试解密“密码”字段。

这实际上可能不会完成任何事情，但想想有人坐在那里试图找出毫无价值的信息是很有趣的

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-13T17:10:40.633

与所有安全决策一样，需要权衡取舍。如果您对密码进行哈希处理（这可能是您最简单的操作），您将无法提供返回原始密码的密码检索功能，您的员工也无法通过查找某人的密码来访问他们的帐户。

您可以使用对称加密，它有其自身的安全缺陷。（如果您的服务器遭到破坏，对称加密密钥也可能遭到破坏）。

您可以使用公钥加密，并在单独的机器上运行密码检索/客户服务，该机器将私钥与 Web 应用程序隔离存储。这是最安全的，但需要两台机器的架构，并且可能在两者之间有防火墙。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-14T16:45:32.493

MD5 和 SHA1 显示出一些弱点（两个字可能导致相同的散列），因此建议使用 SHA256-SHA512 / 迭代散列来散列密码。

我会用编写应用程序的语言编写一个小程序，该程序会生成一个对每个用户都是唯一的随机盐和密码的哈希值。我倾向于使用与验证相同的语言的原因是不同的加密库可以做的事情略有不同（即填充），因此使用相同的库来生成哈希并验证它可以消除这种风险。如果您愿意，该应用程序还可以在更新表后验证登录，因为它仍然知道纯文本密码。

1.  不要使用 MD5/SHA1
2.  生成一个好的随机盐（许多加密库都有一个盐生成器）
3.  orip 推荐的迭代哈希算法
4.  确保密码不是通过网络以纯文本形式传输的

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-22T17:37:01.860

我想建议对[Orip 发布的出色 python 示例](https://stackoverflow.com/questions/287517/encrypting-hashing-plain-text-passwords-in-database/287883#287883)进行一项改进。我会将`random_bytes`函数重新定义为：

```
def random_bytes(num_bytes):
    return os.urandom(num_bytes) 
```

当然，您必须导入`os`模块。该`os.urandom`函数提供可以在加密应用程序中安全使用的随机字节序列。有关详细信息，请参阅[此功能的参考帮助](http://docs.python.org/library/os.html#os.urandom)。

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2008-11-13T17:07:43.230

要散列密码，您可以使用[HashBytes](http://msdn.microsoft.com/en-us/library/ms174415.aspx)函数。返回一个 varbinary，因此您必须创建一个新列，然后删除旧的 varchar 列。

像

```
ALTER TABLE users ADD COLUMN hashedPassword varbinary(max);
ALTER TABLE users ADD COLUMN salt char(10);
--Generate random salts and update the column, after that
UPDATE users SET hashedPassword = HashBytes('SHA1',salt + '|' + password); 
```

然后你修改代码来验证密码，使用类似的查询

```
SELECT count(*) from users WHERE hashedPassword = 
HashBytes('SHA1',salt + '|' + <password>) 
```

其中 <password> 是用户输入的值。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2008-11-13T18:05:08.543

我不是安全专家，但我认为目前的建议是使用 bcrypt/blowfish 或 SHA-2 变体，而不是 MD5 / SHA1。

可能您也需要考虑全面的安全审计

# javascript - 框架集 - 使用 javascript 将列与行交换

> ID：287523
> 
> 赞同：0
> 
> 时间：2008-11-13T17:02:52.583
> 
> 标签：javascript, browser, attributes, frameset

我现在有一个框架集，它的 cols 属性设置为“50%,50%”。我有一个在单击元素后调用的 toggleView 方法。

我的目标是将框架集从显示列更改为行，再次划分为 50/50。

我试图在框架集上执行 removeAttribute("cols") ，虽然这确实删除了 "cols" 属性，但它似乎没有在页面上更新（使用 firebug 进行实时测试）。

然后我会继续添加一个 rows 属性（createAttribute 和 setAttribute 是否是执行此操作的有效方法？）以完成切换。

我想知道这是否可行，因为删除列似乎没有任何作用。

非常感谢您的帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T17:58:24.843

这对我来说很好：

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Frameset//EN" "http://www.w3.org/TR/html4/frameset.dtd">
<html>
  <head>
    <title>A simple frameset document</title>
    <script type="text/javascript">
      function onloadHandler() {
        setTimeout(function() {
          var myFrameset = document.getElementById("myFrameset");
          var value = myFrameset.getAttribute("cols");
          myFrameset.removeAttribute("cols");
          myFrameset.setAttribute("rows", value);
        }, 2500);
      }
    </script>
  </head>
  <frameset id="myFrameset" onload="onloadHandler()" cols="50%, 50%">
    <FRAME src="page1.htm">
    <FRAME src="page1.htm">
  </frameset>
</html> 
```

基本上，它在页面加载后 2.5 秒交换。让我知道您是否需要其他任何东西，或者由于某种原因这对您不起作用。我只在 IE7 中对其进行了测试（不幸的是，我最近一直在为此开发应用程序）。

# c# - 在 UserControl 中处理异常的正确方法

> ID：287525
> 
> 赞同：2
> 
> 时间：2008-11-13T17:03:00.680
> 
> 标签：c#, winforms, .net-3.5

我正在构建一个 UserControl，但我不确定如何处理异常，控件本身并不是很复杂，用户从磁盘中选择了一个图像以便他们可以对其进行授权，我不知道该控件将如何使用所以如果我使用 MessageBox 我可能会阻止应用程序，如果我只是重新抛出它，我可能会崩溃它。

提前致谢。

胡安·扎穆迪奥

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T17:14:11.967

这是构建库的开发人员面临的常见问题。尝试清除错误并决定剩余的错误情况是预期错误（您的控件不应该抛出异常，而是优雅地处理错误）还是意外异常情况（您的控件必须尽快抛出异常）。

您还可以查看[Design By Contract](http://www.google.com/search?q=Design+By+Contract)，这是一种声明所需先决条件和保证后置条件的方法。这可能听起来很学术，但它会导致更健壮的代码。

更新：一个很好的介绍是[http://se.ethz.ch/~meyer/publications/computer/contract.pdf](http://se.ethz.ch/~meyer/publications/computer/contract.pdf)

问候，坦伯格

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T17:10:56.500

绝对应该抛出未处理的异常，以便使用您的控件的人可以看到问题所在。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T17:16:39.373

仅处理您知道并知道如何处理的异常。不要打扰通用处理程序，例如 MessageBox。只需让它传播到有更多上下文来诊断错误的应用程序。他们有责任捕获任何异常，以免应用程序崩溃。在出现异常的情况下，他们无能为力，因为它与控件的内部有关，您应该自己处理，如果部分是用户的错，请用一条消息包装异常，说明缺少什么，用原始的异常可通过 InnerException 属性获得。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T17:34:38.293

除了已经说过的内容之外，我还想提一下，您应该尝试通过检查不同的对象状态并“防止”而不是允许引发异常来让您的控件避免异常。

请记住，**抛出异常是一个相当昂贵的过程**，并且（正如我过去被告知的那样）异常应该保留给真正的“异常”意外情况......

最好的问候，
弗兰克

# perl - 如何在 Template::Toolkit 中分析模板性能？

> ID：287531
> 
> 赞同：12
> 
> 时间：2008-11-13T17:04:37.743
> 
> 标签：perl, templates, profiling, template-toolkit

[使用Template::Toolkit](http://search.cpan.org/dist/Template-Toolkit/)时对各种模板的性能进行基准测试的最佳方法是什么？

我想要一些能够分解处理每个块或模板文件所花费的 cpu/系统时间的东西，不包括处理其中其他模板所花费的时间。 [例如， Devel::DProf](http://search.cpan.org/~rgarcia/perl-5.10.0/ext/Devel/DProf/DProf.pm)对此毫无用处，因为它只是告诉我在 Template 模块的各种内部方法中花费了多少时间。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-13T17:09:06.300

事实证明，谷歌搜索**template::toolkit 分析产生了最好的结果，这**[是 Randal Schwartz 2005 年 11 月](http://www.stonehenge.com/merlyn/LinuxMag/col75.html)的一篇文章。由于版权原因，我无法在此处复制和粘贴任何文章，但可以说您只需获取[他的来源](http://www.stonehenge.com/merlyn/LinuxMag/col75.listing.txt)并将其用作模板后的模块，如下所示：

```
use Template;
use My::Template::Context; 
```

当你的脚本运行时，你会得到这样的输出到 STDERR：

```
-- info.html 于 2008 年 11 月 13 日星期四 09:33:26：
cnt clk 用户 sys cuser csys 模板
  1 0 0.06 0.00 0.00 0.00 动作.html
  1 0 0.00 0.00 0.00 0.00 横幅.html
  1 0 0.00 0.00 0.00 0.00 common_javascript.html
  1 0 0.01 0.00 0.00 0.00 日期时间.html
  1 0 0.01 0.00 0.00 0.00 diag.html
  3 0 0.02 0.00 0.00 0.00 字段表
  1 0 0.00 0.00 0.00 0.00 header.html
  1 0 0.01 0.00 0.00 0.00 信息.html
  1 0 0.01 0.01 0.00 0.00 my_checklists.html
  1 0 0.00 0.00 0.00 0.00 my_javascript.html
  1 0 0.00 0.00 0.00 0.00 qualifier.html
 52 0 0.30 0.00 0.00 0.00 推荐选项
  1 0 0.01 0.00 0.00 0.00 关系块
  1 0 0.00 0.00 0.00 0.00 set_bgcolor.html
  1 0 0.00 0.00 0.00 0.00 shared_javascript.html
  2 0 0.00 0.00 0.00 0.00 表块
  1 0 0.03 0.00 0.00 0.00 ticket.html
  1 0 0.08 0.00 0.00 0.00 ticket_actions.html
-  结尾

```

请注意，列出了块以及单独的文件。

恕我直言，这比 CPAN 模块[Template::Timer](http://search.cpan.org/~petdance/Template-Timer-0.04/Timer.pm)有用得多。

# unix - 你如何对 Solaris 5.7 进行 Cygwin 无密码 rlogin 或 rsh

> ID：287536
> 
> 赞同：0
> 
> 时间：2008-11-13T17:06:43.870
> 
> 标签：unix, networking, cygwin, remoting

我正在尝试从 Windows 上的 cygwin 登录到我的作品 Solaris 框。不支持 SSH。我在 .rhosts 中尝试了不同的组合，但没有运气

我没有root权限。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T17:28:32.470

我找到了答案。当我输入密码时，它认为我的登录方式位于屏幕顶部（这不是您所期望的）。我把它放在 .rhosts 中，它起作用了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T16:40:06.520

虽然您使用 rlogin/rsh 找到了问题的答案，但我的建议是停止使用这些不安全的程序。两者都已知有缓冲区溢出漏洞，并且它们都以明文形式发送密码。

这些天真的没有理由不使用 SSH。告诉拥有/管理系统的人启用它。无论如何，这确实符合他们的最大利益。它默认安装在大多数 Unix 版本上，并且可以从大多数供应商处以软件包的形式获得。

任何运行 Unix/Linux 系统并且不使用 SSH 的人都是不负责任的。

# c# - 如何测试远程连接（检查状态）

> ID：287540
> 
> 赞同：5
> 
> 时间：2008-11-13T17:08:16.067
> 
> 标签：c#, .net, .net-2.0, remoting

我在主机应用程序中创建了一个对象，并且可以使用远程处理远程访问它，有什么方法可以测试连接以确保它仍然“活动”？如果远程连接断开连接，或者某些属性可以告诉我远程连接的状态，我可以使用它触发的事件。有这样的东西吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-13T17:18:31.867

我通常在远程服务器 MarshallByRef 类中添加另一种方法，（我通常将其命名为 Ping()，如下所示：

```
 public void Ping() {} 
```

什么都不做，什么也不返回。然后为了“测试”我的连接，我调用这个方法......如果它抛出 System.Net.Sockets.Exception，我已经失去了连接......

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-13T18:34:18.267

检查连接有什么好处？即使您 ping 它，也不意味着在下一刻您进行远程调用时连接仍然存在。

只需尝试/接听您的远程呼叫，您就会知道。

这种类型的检查是没有意义的（网络连接、文件锁定等）。因为您检查的事物的状态可以在检查后立即更改。您只需托盘，如果失败则清理/重试。

# javascript - 您如何在 HTML/CSS/JS 中实现类似 Excel 2007 的数据栏？

> ID：287541
> 
> 赞同：1
> 
> 时间：2008-11-13T17:08:55.753
> 
> 标签：javascript, excel, user-interface

我想做的是生成以下内容的 HTML/CSS/JS 版本。网格线和其他方面并不重要。如何做后台数据栏更多的是一个问题。

[![替代文字](https://i.stack.imgur.com/tPLAD.png)](https://i.stack.imgur.com/tPLAD.png)
[（来源：[tech-recipes.com](http://blogs.tech-recipes.com/shamanstears/files/2008/04/excel_databars2.png)）]

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T17:31:58.080

将条形图作为背景图像并将它们定位以显示值。例如。固定列宽为 100px：

```
<div style="background: url(bg.gif) -50px 0 no-repeat;">5</div>
<div style="background: url(bg.gif) -20px 0 no-repeat;">8</div> 
```

如果您的列必须是灵活的大小（不是固定的，并且在生成页面时不知道），这有点棘手：

```
<style type="text/css">
    .cell { position: relative; }
    .cell .back { position: absolute; z-index: 1; background: url(bg.gif); }
    .cell .value { position: relative; z-index: 2; }
</style>

<div class="cell">
    <div class="back" style="width: 50%;">&nbsp;</div>
    <div class="value">5</div>
</div>
<div class="cell">
    <div class="back" style="width: 80%;">&nbsp;</div>
    <div class="value">8</div>
</div> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T17:21:28.723

像这种[跨浏览器渐变](http://slayeroffice.com/code/gradient/)这样的基于 javascript 的解决方案可能是一个好的开始。

使用一些 DHTML，您可以制作一个[给定长度的条形图](http://slayeroffice.com/code/gradientProgressBar/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T17:30:37.567

我会使用[Ext JS](http://extjs.com/products/extjs/)库中的 Grid 组件或Yahoo 的 YUI 库中的[DataTable组件。](http://developer.yahoo.com/yui/datatable/)跨浏览器兼容性等工作为您完成。

# ios - 如何以编程方式感知 iPhone 静音开关？

> ID：287543
> 
> 赞同：51
> 
> 时间：2008-11-13T17:09:11.837
> 
> 标签：ios, audio, avaudiosession

我似乎无法在 SDK 中找到如何以编程方式感知 iPhone 上的静音按钮/开关。当我的应用程序播放背景音乐时，它会正确响应音量按钮，而无需我遵循任何代码，但是，当我使用静音开关时，它只会继续播放。

如何测试静音的位置？

（注意：我的程序有自己的静音开关，但我希望物理开关覆盖它。）

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-11-15T19:03:41.310

谢谢，摩根大通。实际上，您提供的链接会导致正确答案（最终。;）为了完整性（因为 SO 应该是快速答案的来源！）...

```
// "Ambient" makes it respect the mute switch
// Must call this once to init session
if (!gAudioSessionInited)
{
    AudioSessionInterruptionListener    inInterruptionListener = NULL;
    OSStatus    error;
    if ((error = AudioSessionInitialize (NULL, NULL, inInterruptionListener, NULL)))
    {
        NSLog(@"*** Error *** error in AudioSessionInitialize: %d.", error);
    }
    else
    {
        gAudioSessionInited = YES;
    }
}

SInt32  ambient = kAudioSessionCategory_AmbientSound;
if (AudioSessionSetProperty (kAudioSessionProperty_AudioCategory, sizeof (ambient), &ambient))
{
    NSLog(@"*** Error *** could not set Session property to ambient.");
} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2011-01-16T16:47:34.093

我在这里回答了一个类似的问题[（链接）](https://stackoverflow.com/questions/833304/how-to-detect-iphone-is-on-silent-mode/4701308#4701308)。相关代码：

```
 -(BOOL)silenced {
     #if TARGET_IPHONE_SIMULATOR
         // return NO in simulator. Code causes crashes for some reason.
         return NO;
     #endif

    CFStringRef state;
    UInt32 propertySize = sizeof(CFStringRef);
    AudioSessionInitialize(NULL, NULL, NULL, NULL);
    AudioSessionGetProperty(kAudioSessionProperty_AudioRoute, &propertySize, &state);
    if(CFStringGetLength(state) > 0)
            return NO;
    else
            return YES;

    } 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2011-08-02T10:24:34.067

如果您不在环境模式下，其他答案（包括接受的答案）中的某些代码可能无法工作，在这种模式下静音开关受到尊重。

我编写了下面的例程来切换到环境，读取开关，然后返回到我的应用程序中需要的设置。

```
-(BOOL)muteSwitchEnabled {

#if TARGET_IPHONE_SIMULATOR
    // set to NO in simulator. Code causes crashes for some reason.
    return NO;
#endif

// go back to Ambient to detect the switch
AVAudioSession* sharedSession = [AVAudioSession sharedInstance];
[sharedSession setCategory:AVAudioSessionCategoryAmbient error:nil];

CFStringRef state;
UInt32 propertySize = sizeof(CFStringRef);
AudioSessionInitialize(NULL, NULL, NULL, NULL);
AudioSessionGetProperty(kAudioSessionProperty_AudioRoute, &propertySize, &state);

BOOL muteSwitch = (CFStringGetLength(state) <= 0);
NSLog(@"Mute switch: %d",muteSwitch);

// code below here is just restoring my own audio state, YMMV
_hasMicrophone = [sharedSession inputIsAvailable];
NSError* setCategoryError = nil;

if (_hasMicrophone) {

    [sharedSession setCategory: AVAudioSessionCategoryPlayAndRecord error: &setCategoryError];

    // By default PlayAndRecord plays out over the internal speaker.  We want the external speakers, thanks.
    UInt32 ASRoute = kAudioSessionOverrideAudioRoute_Speaker;
    AudioSessionSetProperty (kAudioSessionProperty_OverrideAudioRoute,
                             sizeof (ASRoute),
                             &ASRoute
                             );
}
else
    // Devices with no mike don't support PlayAndRecord - we don't get playback, so use just playback as we don't have a microphone anyway
    [sharedSession setCategory: AVAudioSessionCategoryPlayback error: &setCategoryError];

if (setCategoryError)
    NSLog(@"Error setting audio category! %@", setCategoryError);

return muteSwitch;
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-08-03T15:14:15.967

为了找出静音开关*和*音量控制的状态，我编写了这两个函数。如果您希望在用户尝试创建音频输出之前警告他们，这些是理想的选择。

```
-(NSString*)audioRoute
{
    CFStringRef state;
    UInt32 propertySize = sizeof(CFStringRef);
    OSStatus n = AudioSessionGetProperty(kAudioSessionProperty_AudioRoute, &propertySize, &state);
    if( n )
    {
        // TODO: Throw an exception
        NSLog( @"AudioSessionGetProperty: %@", osString( n ) );
    }

    NSString *result = (NSString*)state;
    [result autorelease];
    return result;
}

-(Float32)audioVolume
{
    Float32 state;
    UInt32 propertySize = sizeof(CFStringRef);
    OSStatus n = AudioSessionGetProperty(kAudioSessionProperty_CurrentHardwareOutputVolume, &propertySize, &state);
    if( n )
    {
        // TODO: Throw an exception
        NSLog( @"AudioSessionGetProperty: %@", osString( n ) );
    }
    return state;
} 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-08-05T18:56:04.557

```
-(BOOL)isDeviceMuted
{
 CFStringRef state;
 UInt32 propertySize = sizeof(CFStringRef);
 AudioSessionInitialize(NULL, NULL, NULL, NULL);
 AudioSessionGetProperty(kAudioSessionProperty_AudioRoute, &propertySize, &state);
 return (CFStringGetLength(state) > 0 ? NO : YES);
} 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2010-04-22T05:43:14.720

我在这里遵循了一般理论并使它起作用 [http://inforceapps.wordpress.com/2009/07/08/detect-mute-switch-state-on-iphone/](http://inforceapps.wordpress.com/2009/07/08/detect-mute-switch-state-on-iphone/)

这里是一个回顾：播放一个简短的无声的声音。时间玩多久。如果静音开关打开，声音的播放将比声音本身短得多。我使用了 500 毫秒的声音，如果声音播放的时间少于这个时间，那么静音开关就打开了。我使用音频服务来播放无声的声音（它总是尊重静音开关）。这篇文章说你可以使用 AVAudioPlayer 来播放这个声音。如果您使用 AVAudioPlayer，我假设您需要设置 AVAudioSession 的类别以支持静音开关，但我还没有尝试过。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-12-09T18:47:46.063

使用**环境**模式播放视频和**使用 PlayAndRecord**模式在相机屏幕上录制视频，解决了我们案例中的问题。

应用程序中的代码：didFinishLaunchingWithOptions：

```
NSError *error = nil;
[[AVAudioSession sharedInstance] setCategory:AVAudioSessionCategoryAmbient error:&error];
[[AVAudioSession sharedInstance] setMode:AVAudioSessionModeVideoRecording error:&error];
[[AVAudioSession sharedInstance] setActive:YES error:&error]; 
```

如果您必须在应用程序中使用摄像头或录制，则 viewWillAppear 中的代码会显示在 cameraController 上

```
[[AVAudioSession sharedInstance] setCategory:AVAudioSessionCategoryPlayAndRecord error:nil]; 
```

viewWillDisappear 中的代码在 cameraController 上

```
[[AVAudioSession sharedInstance] setCategory:AVAudioSessionCategoryAmbient error:nil]; 
```

使用这些行，我们的应用程序录制和播放视频和静音开关在 iOS8 和 iOS7 下都能完美运行！！！

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2018-03-29T09:12:38.557

> **对于斯威夫特**

以下框架在设备中完美运行

[https://github.com/akramhussein/静音](https://github.com/akramhussein/Mute)

只需使用**pod**安装或从 Git 下载

```
pod 'Mute' 
```

并使用如下代码

```
import UIKit
import Mute

class ViewController: UIViewController {

    @IBOutlet weak var label: UILabel! {
        didSet {
            self.label.text = ""
        }
    }

    override func viewDidLoad() {
        super.viewDidLoad()

        // Notify every 2 seconds
        Mute.shared.checkInterval = 2.0

        // Always notify on interval
        Mute.shared.alwaysNotify = true

        // Update label when notification received
        Mute.shared.notify = { m in
            self.label.text = m ? "Muted" : "Not Muted"
        }

        // Stop after 5 seconds
        DispatchQueue.main.asyncAfter(deadline: .now() + 5.0) {
            Mute.shared.isPaused = true
        }

        // Re-start after 10 seconds
        DispatchQueue.main.asyncAfter(deadline: .now() + 10.0) {
            Mute.shared.isPaused = false
        }
    }

} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-13T20:15:45.423

奥利，

我相信你可以在这里找到你的问题的答案：

[https://devforums.apple.com/message/1135#1135](https://devforums.apple.com/message/1135#1135)

我假设您可以访问 Apple.com 上的开发者论坛 :)

# coding-style - 样式执行工具有用吗？

> ID：287551
> 
> 赞同：3
> 
> 时间：2008-11-13T17:10:52.817
> 
> 标签：coding-style

最近[一个关于 StyleCop](https://stackoverflow.com/questions/286180/)的问题提醒我使用工具来强制编码风格。如果我在开发时被要求运行其中一个工具，我会感到非常恼火。人们真的觉得它们有用吗？为什么或者为什么不？

到目前为止，回答过的每个人都表示他们认为样式/格式规则很有用，我 100% 同意这一点。但是使用工具来执行，而不是样式指南和定期的代码审查呢？人们发现这在实践中有用吗？为什么或者为什么不？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T17:20:19.350

是的，它非常有帮助——尤其是在大型项目中。这意味着您可以访问任何其他人的代码，而且它对您来说并不陌生。这意味着人们在项目之间更便携，这为个人和公司提供了更多的灵活性。

缺点是可能会花费大量时间来争论使用哪种样式。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T17:34:49.307

编码风格和格式风格是有区别的。编码风格强制执行良好实践。'IF' 语句的主体必须包含在左大括号和右大括号中 格式样式是代码的外观。其中“{”出现在“IF”语句中。

在团队环境中；

一个好的格式化工具将允许所有开发人员以他们希望查看代码的方式查看代码。一个好的样式工具将确保所有代码都遵循相同的准则

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-23T03:59:49.010

我喜欢 StyleCop 的概念，虽然我并不真正关心很多规则。风格是如此主观，以至于我发现自己很难坚定地决定它是否应该成为我们流程的一部分。不过，我真的更希望看到球队有统一的风格，这就是为什么我如此痛苦。

显然，等式的另一面，使用像 FxCop（或其他 TFS 用户的代码分析）这样的工具更多地基于实践，因此决策变得比个人和风格更具技术性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T17:16:09.593

如果样式指的是*格式*（例如 '{' 必须位于行尾或行首），则可能会非常烦人，尤其是在涉及合并并且该样式并非对所有开发人员都严格执行的情况下。

如果样式指的是“**良好实践**”（就像“if”语句的主体必须用大括号括起来），它实际上可能非常有用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T17:16:58.093

我认为在一个大型团队中，统一的编码风格是必不可少的。有一些标准有助于可维护性，因为可以让新的开发人员来维护旧代码，并且学习曲线最小。

至于*强制*样式差异（例如'{'来自哪里）可以很容易地通过自动化工具完成，而不会对开发过程施加太多影响。Eclipse 和 Visual Studio 都有一组非常丰富的选项，可以根据大量选项自动格式化您的代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-13T17:26:13.753

对编程或格式化风格的限制可能有助于减少多人团队中的摩擦。

对语言特性的限制（尤其是仅使用 C# 的一个子集）可以帮助您专注于问题领域，而不必处理大量的概念。如果您的软件必须强大且易于理解，这很重要。

问候，坦伯格

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-08-07T08:59:08.903

如果您使用的是版本控制系统，如果每个开发人员在接触文件时根据自己的喜好重新格式化代码，就会变得非常难看。在开发人员没有必要的沟通技巧的地方，如果每个开发人员都被动地坚持“他的”标准，则可能会发生类似维基百科的编辑战。

总的来说，如果两个人处理同一个文件，手动重新格式化也会导致更多的签入冲突。

因此，如果您使用的是 VCS，我什至建议您执行格式化规则。强制执行样式规则可以提高代码质量。

# asp.net - 任何人都知道免费的日期和*时间* ASP.NET 自定义控件

> ID：287553
> 
> 赞同：0
> 
> 时间：2008-11-13T17:12:07.447
> 
> 标签：asp.net, datetime, calendar, custom-controls

每次我必须构建一个带有`DateTime`字段的表单时，我都会尝试找到一个像样的免费自定义控件 - 我总是失败。

我不知道为什么它不是在 .NET 中构建的，但让我们暂时忘掉它并专注于我的问题：D

有人有吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T17:15:24.773

只需将这两个结合起来

[http://www.kelvinluck.com/assets/jquery/datePicker/v2/demo/](http://www.kelvinluck.com/assets/jquery/datePicker/v2/demo/)

[http://keith-wood.name/timeEntry.html](http://keith-wood.name/timeEntry.html)

jQuery就是它的所在！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T17:21:28.880

查看[MS AJAX Control Toolkit中的](http://www.asp.net/AJAX/AjaxControlToolkit/)[Calendar 控件](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/Calendar/Calendar.aspx)扩展器，我真的很喜欢它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T18:40:17.630

使用两个单独的文本框，一个用于日期，一个用于时间。正如其他人指出的那样，对于日期一，使用 ASP.NET Ajax Control Toolkit [Calendar控件。](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/Calendar/Calendar.aspx)

对于 TextBox，请查看同一工具包中的[MaskedEditExtender](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/MaskedEdit/MaskedEdit.aspx)控件。您可以将其设置为显示**:** :__ AM/PM 并让用户填写。如果他们只是键入“3p”并制表符，您可以用零填写。

要使用它，您需要一个 TextBox。您将 MaskedEditExtender 的 TargetControlID 设置为 TextBox 的 ID。以下是您需要在 MaskedEditExtender 标记中设置时间输入的一些属性：

```
Mask="99:99"
AutoCompleteValue="00:00"
AcceptAMPM="true"
MaskType="Time" 
```

此外，如果您遇到与 FindControl 相关的奇怪错误，请确保您的 MaskedEditExtenders 都设置了 ID。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T17:14:43.840

我刚刚做了一个快速的谷歌并遇到了这个......

[http://www.softcomplex.com/products/tigra_calendar/demo1.html](http://www.softcomplex.com/products/tigra_calendar/demo1.html)

看起来它支持日期和时间，而且它似乎是免费的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T17:20:33.797

我在这个方面运气不错：

[http://www.eworldui.net/](http://www.eworldui.net/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-14T11:14:11.867

这确实很好用。

```
<asp:TextBox runat="server" ID="startDate" autocomplete="off" />
<ajaxToolkit:CalendarExtender 
    ID="defaultCalendarExtender" 
    runat="server" 
    TargetControlID="startDate" />
<asp:TextBox ID="startTime" runat="server" Columns="8"></asp:TextBox>
<ajaxToolkit:MaskedEditExtender 
    ID="startTime_MaskedEditExtender1" runat="server" 
    Enabled="True" 
    TargetControlID="startTime" 
    MaskType="Time" 
    AutoCompleteValue="09:00"
    Mask="99:99"
    AcceptAMPM="true">
</ajaxToolkit:MaskedEditExtender>
<ajaxToolkit:MaskedEditValidator 
    ID="MaskedEditValidator1" 
    runat="server" 
    ControlExtender="startTime_MaskedEditExtender1"
    ControlToValidate="startTime" 
    IsValidEmpty="False"
    EmptyValueMessage="Time is required"
    InvalidValueMessage="Time is invalid"
    Display="Dynamic"
    TooltipMessage="Input a time"
    EmptyValueBlurredText="*"
    InvalidValueBlurredMessage="Check time"> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-25T00:53:48.620

[Ra-Ajax 日历控件](http://ra-ajax.org/samples/Ajax-Calendar.aspx)实际上将在即将到来的星期五（2008 年 11 月 28 日）发布，支持时间（今天按钮和日期之间的两个文本框）

Ra-Ajax 已获得 LGPL 许可，可免费使用...

# oracle - 在 Oracle 中，如何检测夏令时开始/结束的日期？

> ID：287563
> 
> 赞同：5
> 
> 时间：2008-11-13T17:16:11.263
> 
> 标签：oracle, dst

Oracle 中有没有办法为我的语言环境选择夏令时切换的日期？

模糊地等同于这个的东西会很好：

```
SELECT CHANGEOVER_DATE
FROM SOME_SYSTEM_TABLE
WHERE DATE_TYPE = 'DAYLIGHT_SAVINGS_CHANGEOVER'
  AND TO_CHAR(CHANGEOVER_DATE,'YYYY') = TO_CHAR(SYSDATE,'YYYY');  -- in the current year 
```

*编辑：我希望有一个在国会调整 DST 法律时不需要更改的解决方案，就像他们在 2007 年所做的那样。不过，发布的解决方案将起作用。*

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2014-12-12T19:50:15.847

为了改进 Leigh Riffel 的答案，使用相同的逻辑要简单得多：

```
Function DaylightSavingTimeStart (p_Date IN Date)
Return Date Is
Begin
   Return NEXT_DAY(TO_DATE(to_char(p_Date,'YYYY') || '/03/01 02:00 AM', 'YYYY/MM/DD HH:MI AM') - 1, 'SUN') + 7;
End;

Function DaylightSavingTimeEnd (p_Date IN Date)
Return Date Is
Begin
   Return NEXT_DAY(TO_DATE(to_char(p_Date,'YYYY') || '/11/01 02:00 AM', 'YYYY/MM/DD HH:MI AM') - 1, 'SUN');
End; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-13T18:51:10.027

我们使用以下两个函数来计算任何给定年份（2007 年后，美国）的开始日期和结束日期。

```
Function DaylightSavingTimeStart (p_Date IN Date)
Return Date Is
   v_Date       Date;
   v_LoopIndex  Integer;
Begin
   --Set the date to the 8th day of March which will effectively skip the first Sunday.
   v_Date := to_date('03/08/' || to_char(p_Date,'YYYY') || '02:00:00 AM','MM/DD/YYYY HH:MI:SS PM');
   --Advance to the second Sunday.
   FOR v_LoopIndex IN 0..6 LOOP
      If (RTRIM(to_char(v_Date + v_LoopIndex,'DAY')) = 'SUNDAY') Then
         Return v_Date + v_LoopIndex;
      End If;
   END LOOP;
End;

Function DaylightSavingTimeEnd (p_Date IN Date)
Return Date Is
   v_Date       Date;
   v_LoopIndex  Integer;
Begin
   --Set Date to the first of November this year
   v_Date := to_date('11/01/' || to_char(p_Date,'YYYY') || '02:00:00 AM','MM/DD/YYYY HH:MI:SS PM');
   --Advance to the first Sunday
   FOR v_LoopIndex IN 0..6 LOOP
      If (RTRIM(to_char(v_Date + v_LoopIndex,'DAY')) = 'SUNDAY') Then
         Return v_Date + v_LoopIndex;
      End If;
   END LOOP;
End; 
```

可能有一种更简单的方法可以做到这一点，但这些方法对我们有用。当然，此查询不知道您所在的位置是否遵守夏令时。为此，您将需要[位置数据](http://www.zipcodedownload.com/)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-05-31T08:55:29.673

除了循环获取下一个星期日，您还可以使用 oracle 的 next_day(date, 'SUN') 函数。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T18:20:08.183

在美国，夏令时定义为从 3 月的第二个星期日开始，到 11 月的第一个星期日结束，对于遵守 DST 的地区，在 2007 年之后的几年中。

我不认为有一种简单的方法可以从 Oracle 获取这些信息，但是根据标准定义，您应该能够编写一个使用[Doomsday Algorithm](http://en.wikipedia.org/wiki/March_0)计算开始和结束日期的存储过程。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-14T04:05:22.403

这是一种使用 Oracle 内部关于时区是否遵守夏令时的知识来确定它的开始和结束的方法。除了它的复杂性和普遍的陌生性之外，它还需要知道两个时区在夏令时无效时具有相同的时间，而在夏令时有效时则具有不同的时间。因此，它对夏令时发生时的国会变化具有弹性（假设您的数据库是最新的补丁），但对影响时区的区域变化没有弹性。有了这些警告，这就是我所拥有的。

```
ALTER SESSION SET time_zone='America/Phoenix';
DROP TABLE TimeDifferences;
CREATE TABLE TimeDifferences(LocalTimeZone TIMESTAMP(0) WITH LOCAL TIME ZONE);
INSERT INTO TimeDifferences
(
   SELECT to_date('01/01/' || to_char(sysdate-365,'YYYY') || '12:00:00','MM/DD/YYYYHH24:MI:SS')+rownum-1 
   FROM dual CONNECT BY rownum<=365
);
COMMIT;

ALTER SESSION SET time_zone='America/Edmonton';
SELECT LocalTimeZone-1 DaylightSavingTimeStartAndEnd
FROM
(
   SELECT LocalTimeZone, 
      to_char(LocalTimeZone,'HH24') Hour1,
      LEAD(to_char(LocalTimeZone,'HH24')) OVER (ORDER BY LocalTimeZone) Hour2 
   FROM TimeDifferences
)
WHERE Hour1 <> Hour2; 
```

我告诉过你这很奇怪。该代码仅计算更改的日期，但可以增强以显示小时。目前它返回 09-MAR-08 和 02-NOV-08。它对一年中运行的时间也很敏感，这就是为什么我必须使用 -365...+365。总而言之，我不推荐这种解决方案，但调查起来很有趣。也许别人有更好的东西。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-05-24T19:18:34.957

这是我上面的版本。它的优点是它不需要第二个“更改会话设置时区”，并且可以更轻松地从应用程序中使用。您创建存储函数，然后您只需使用： ALTER SESSION SET time_zone='Asia/Jerusalem'; 选择 GetDSTDates(2012,1) DSTStart,GetDSTDates(2012,2) DSTEnd,SessionTimeZone TZ from dual;

这将返回指定年份的 dst 开始日期、dst 结束日期、时区。

```
create or replace function GetDSTDates
(
  year integer,
  GetFrom integer
)
return Date
as
  cursor c is
    select 12-to_number(to_char(LocalTimeZone at time zone '+00:00','HH24')) offset,
    min(to_char(LocalTimeZone at time zone '+00:00','DD/MM/YYYY')) fromdate,
    max(to_char(LocalTimeZone at time zone '+00:00','DD/MM/YYYY')) todate 
        from (
        SELECT cast((to_date('01/01/'||to_char(year)||'12:00:00','MM/DD/YYYYHH24:MI:SS')+rownum-1) as timestamp with local time zone) LocalTimeZone
        FROM dual CONNECT BY rownum<=365
        )
    group by 12-to_number(to_char(LocalTimeZone at time zone '+00:00','HH24'));
  dstoffset integer;
  offset integer;
  dstfrom date;
  dstto date;
begin
  offset := 999;
  dstoffset := -999;
  for rec in c
  loop 
    if rec.offset<offset
    then
      offset := rec.offset;
    end if;
    if rec.offset>dstoffset
    then
      dstoffset := rec.offset;
      dstfrom := to_date(rec.fromdate,'DD/MM/YYYY');
      dstto :=to_date(rec.todate,'DD/MM/YYYY');
    end if;
  end loop;
  if (offset<999 and dstoffset>-999 and offset<>dstoffset)
  then
    if GetFrom=1
    then
      return dstfrom;
    else 
      return dstto;
    end if;
  else
    return null;
  end if;
end;
/
ALTER SESSION SET time_zone='Asia/Jerusalem';
select GetDSTDates(2012,1) DSTStart,
       GetDSTDates(2012,2) DSTEnd,
       SessionTimeZone TZ from dual; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-03-16T17:02:16.743

老问题，但这里有一个新答案。使用 08-MAR 作为第一个日期，因为它跳过了第一周

```
--Start of DST
select next_day(to_date('08-MAR-' || to_char(sysdate, 'YYYY')), 'SUN') from dual

--End of DST
select next_day(to_date('01-NOV-' || to_char(sysdate, 'YYYY')), 'SUN') from dual 
```

# mysql - 表的最佳数据量是多少？

> ID：287575
> 
> 赞同：0
> 
> 时间：2008-11-13T17:21:20.317
> 
> 标签：mysql

一个表中应该有多少数据才能使读取达到最佳状态？假设我有 3 个字段 varchar(25)。这是在 MySQL 中。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T17:36:28.210

我建议您在优化数据库设计时考虑以下事项：

1.  考虑你想用数据库完成什么。您会以非常高的速率对单个表执行大量插入操作吗？或者您将使用数据执行报告和分析功能？
2.  一旦您确定了数据库的用途，请定义您需要存储哪些数据来执行任何必要的功能。
3.  正常化直到它受伤。如果您正在执行事务处理（数据库最常见的功能），那么您将需要一个高度规范化的数据库结构。如果您正在执行分析功能，那么您将需要一个更加非规范化的结构，该结构不必依赖连接来生成报告结果。
4.  通常，如果您真的对结构进行了规范化，直到它受到伤害，那么您需要将规范化后退一步或两步，以拥有一个既规范化又能正常工作的数据结构。
5.  如果您不使用密钥，规范化的数据库几乎毫无意义。确保每个表都定义了一个主键。不要使用代理键只是因为它是你经常看到的。考虑任何给定表中可能存在哪些自然键。一旦确定每个表都有正确的主键，则需要定义外键引用。建立显式外键关系而不是依赖隐式定义将提高性能，为您的数据提供完整性，并自行记录数据库结构。
6.  查找表中存在的其他索引。您是否有会经常搜索的一列或一组列，例如用户名和密码字段？索引可以位于单个列或多个列上，因此请考虑如何查询数据并根据需要为要查询的值创建索引。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T17:24:30.963

行数应该无关紧要。确保您搜索的字段已正确编入索引。如果您只有 3 个 varchar(25) 字段，那么您可能需要添加一个不是 varchar 的主键。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T17:27:07.403

同意你应该确保你的数据被正确索引。

除此之外，如果您担心表大小，您可以随时实施某种类型的数据归档策略以备后用。

在你发现问题出现之前不要太担心这一点，也不要过早优化。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T17:28:28.757

为了获得最佳阅读效果，您应该有一个索引。存在一个表来保存它设计包含的行。随着行数的增加，索引的值开始发挥作用，读取仍然活跃。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T17:33:09.760

像这样的措辞我不知道如何回答这个问题。包含 100,000 条记录的索引表比包含 1,000 条记录的未索引表要快。

你有什么要求？你有多少数据？一旦你知道这些问题的答案，你就可以做出关于索引和/或分区的决定。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-13T17:58:55.607

这是一个非常松散的问题，所以一个非常松散的答案:-)

一般来说，如果你做基础——合理的规范化、合理的主键和普通查询——那么在今天的硬件上，你会在中小型数据库上处理大多数事情——即最大的数据库少于 50,000 条记录的表。

但是，一旦超过 50k - 100k 行，这大致对应于 rdbms 可能受到内存限制的点 - 那么除非您正确设置访问路径（即索引），否则性能将开始灾难性地下降。这是在数学意义上 - 在这种情况下，如果表大小翻倍，性能下降一到两个数量级并不罕见。

显然，因此您需要注意的关键表大小将根据行大小、机器内存、活动和其他环境问题而有所不同，因此没有单一的答案，但要注意性能通常不会优雅地下降与表大小和相应的计划。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-13T18:10:45.363

我不得不不同意 Cruachan 关于“50k - 100k 行 .... 大致对应于 rdbms 可能受到内存限制的点”。如果没有两个额外的数据，这个笼统的陈述只是误导性的：大约。行的大小和可用内存。我目前正在开发一个数据库来查找源代码文件中最长的公共子序列（a la bio-informatics），并在一个表中达到数百万行，即使 VARCHAR 字段接近 1000，在它成为内存之前约束。因此，对于最初的问题，通过适当的索引和足够的 RAM（一个或两个 Gig），最多有 75 个字节的行，建议的表没有理由不能容纳数千万条记录。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-13T18:12:23.207

适当的数据量是您的应用程序的功能，而不是数据库的功能。如果这是您的问题的意图，则很少有通过将表分解为多个子表来解决 MySQL 问题的情况。

如果您遇到查询速度很慢的特定情况，那么讨论如何通过修改查询或表设计来改善这种情况可能会更有用。

# crystal-reports - 水晶报表问题

> ID：287581
> 
> 赞同：0
> 
> 时间：2008-11-13T17:23:07.973
> 
> 标签：crystal-reports

我在以下行中遇到问题：

```
rd.PrintOptions.PaperSize = PaperSize.PaperFanfoldStdGerman; 
```

它抛出一个异常说 HRESULT: 0x8002000B (DISP_E_BADINDEX))

如果我跳过这一行，这里会出现同样的错误：

```
rd.PrintOptions.ApplyPageMargins(config) 
```

以前有人遇到过这个问题吗？谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-13T17:29:14.793

我的猜测是，您之前的线路出现故障，因此会在下一次通话中报告。之前检查线路

```
rd.PrintOptions.PaperSize = PaperSize.PaperFanfoldStdGerman; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T21:26:59.103

固定的！

问题是数据集中不存在的字段。

# c# - 如何在企业库中的 DbCommand 上传递 MySQL 空参数

> ID：287585
> 
> 赞同：0
> 
> 时间：2008-11-13T17:25:08.170
> 
> 标签：c#, .net, mysql, enterprise-library

我试图在下面的代码中为第一个参数传递一个空值，但 MySQL 抱怨说

```
PROCEDURE myProc 的参数数量不正确；预期 2，得到 1

```

当我手动调用第一个参数为 null 的过程时，它可以工作，但是当`EmptyAsNullStartsWith(employeeNumberText.Text)`返回 null 时，它会抱怨。

```
Database db = DatabaseFactory.CreateDatabase(
  ConfigurationManager.AppSettings["dbType"]
);
DbCommand cmd = db.GetStoredProcCommand("staff_listforinquiry");
db.AddeParameter(
  cmd, 
  "in_employeeNumber", 
  DbType.String, 
  EmptyAsNullStartsWith(employeeNumberText.Text)
);
db.AddeParameter(
  cmd, 
  "in_name", 
  DbType.String, 
  EmptyAsNullContains(employeeNameText.Text)
); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T18:20:59.463

您是否尝试过让 EmptyAsNullContains(employeeNameText.Text) 返回 DBNull 而不是常规的 null？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-02-02T12:35:30.770

```
if(employeeNumberText.Text != "")
      db.AddInParameter(dbCommand, "in_employeeNumber", DbType.String, employeeNumberText.Text);
else
      db.AddInParameter(dbCommand, "in_employeeNumber", DbType.String, DBNull.Value); 
```

# asp.net - 如何在 ASP.NET MVC 中创建 4 列 - 如何减少我当前的代码

> ID：287587
> 
> 赞同：2
> 
> 时间：2008-11-13T17:25:18.857
> 
> 标签：asp.net, asp.net-mvc

我有以下代码，我正在尝试获取一个包含 4 列的表。如果我用完了列，请创建一个新行并再创建 4 个列。冲洗。泡沫。重复。

```
<tbody>
<%
int i = 0;
foreach (ItmXtnMultimedia multimedia in ViewData.Model.ItmXtnMultimedia) {
  if (i%4 == 0 && i== 0)
  {
    %><tr><%
  }
  if (i%4 == 0 && i != 0)
  {
    %></tr><tr><%
  }
  %>                    
  <td><%= multimedia.ImgTag100 %></td>                            
  <%
  i++;
  } %> 
```

它有效，但很糟糕。框架中是否有内置的东西或我可以使用的扩展方法？我想我可以自己动手，但我想肯定有什么东西在那里。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T18:30:39.723

这是创建扩展方法的好地方。这是一些几乎可编译的 C# 伪代码：

```
public static void IDunnoWhatToCallThis<T>(
    this HtmlHelper me, 
    T[] items,
    int columns,
    Action headerTemplate,
    Action<T> itemTemplate,
    Action newRowTemplate,
    Action footerTemplate )
{
  headerTemplate();

  for(int i = 0;i < items.Length; i++)
  {
    if(i != 0 && i%columns == 0)
      newRowTemplate();

    itemTemplate(items[i]);
  }

  footerTemplate();
} 
```

这是一个正在使用的示例：

```
<% Html.IDunnoWhatToCallThis(
  ViewData.Model.ItmXtnMultimedia,
  4,
  () => %><table><tr><%,
  (item) => %><td><%= item.ImgTag100 %></td><%,
  () => %></tr><tr><%,
  () => %></tr></table><%);%> 
```

我喜欢这样的助手，混合内联代码、lambda 和标记。就像看魔术一样。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T17:57:14.940

实际上，我将冷杉从循环中弹出......（但仍然闻起来）

```
 <tbody>
                    <tr>
                    <%
                    int i = 0;
                    foreach (ItmXtnMultimedia multimedia in ViewData.Model.ItmXtnMultimedia) {

                        if (i%4 == 0)
                        {
                            %></tr><tr><%
                        }
                        %>                    
                        <td><%= multimedia.ImgTag100 %></td>                            
                        <%
                        i++;
                    } %>                    
                </tbody> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T17:46:11.717

您应该将第二个 if 替换为 else if .. 除此之外，没关系。

```
foreach (ItmXtnMultimedia multimedia in ViewData.Model.ItmXtnMultimedia) 
{
  if (i%4 == 0 && i== 0)
  {
      %><tr><%
  }
  else if (i%4 == 0 && i != 0)
  {
      %></tr><tr><%
  }
  %><td><%= multimedia.ImgTag100 %></td><%
  i++;
}%> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T18:17:23.447

我假设 ViewData.Model.ItmXtnMultimedia 是某种列表：

```
<tbody>
<%
    for (int i = 0; i < ViewData.Model.ItmXtnMultimedia.Count; i++ )
    {
        %><tr><%
        for (int j = 0; i < 4; j++)
        {
            if (i < ViewData.Model.ItmXtnMultimedia.Count)
            {
                %><td><%= ViewData.Model.ItmXtnMultimedia[i].ImgTag100 %> %></td><%
            }
            else
            {
                %><td></td><%
            }
        }
        %></tr><%
    } 
%>
</tbody> 
```

仍然是一堆乱七八糟的代码，但也许更具可读性？

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-11-13T18:06:03.313

稍微重构一下怎么样？

```
<%
foreach (ItmXtnMultimedia multimedia in ViewData.Model.ItmXtnMultimedia) {
  manageColumnsForMe( 4 )
  %><td><%= multimedia.ImgTag100 %></td><%
  } 
%> 
```

并将其他代码放入使用静态变量存储 i 的函数中

您可以使用不同数量的列重用相同的功能

# tsql - t-sql 十进制赋值更改值

> ID：287588
> 
> 赞同：1
> 
> 时间：2008-11-13T17:25:25.410
> 
> 标签：tsql, decimal

为什么下面的 select 语句会返回两个不同的值？

```
declare @tempDec decimal
set @tempDec = 1.0 / (1.0 + 1.0)
select @tempDec, 1.0 / (1.0 + 1.0) 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T21:02:30.587

这对于像 1.0 这样的文字很好，但是如果您从表列中提取数据，则需要转换/转换等式中的第一个评估数字：

```
convert(decimal, [col1]) / ([col2] + [col3]) 
```

-或者-

```
convert(decimal(15, 2), [col1]) / ([col2] + [col3]) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T17:28:41.517

就在我发布此消息时，我从同事那里得知。

您需要指定默认精度和比例。

这适用于这种情况：声明@tempDec decimal(3,2)

来自 MSDN：

decimal[ (p[ , s] )] 和 numeric[ (p[ , s] )] 固定精度和小数位数。使用最大精度时，有效值从 - 10^38 +1 到 10^38 - 1。十进制的 SQL-92 同义词是 dec 和 dec(p, s)。numeric 在功能上等同于十进制。

p（精度）可以存储的小数位数的最大总数，包括小数点的左侧和右侧。精度必须是 1 到最大精度 38 之间的值。默认精度为 18。

s（刻度）小数点右侧可以存储的最大小数位数。比例必须是从 0 到 p 的值。仅当指定精度时才能指定比例。默认比例为 0；因此，0 <= s <= p。最大存储大小因精度而异。

# c - 为什么会发生这种情况（见图）？

> ID：287592
> 
> 赞同：6
> 
> 时间：2008-11-13T17:26:17.420
> 
> 标签：c, console, terminal, reset

为什么以下内容会产生效果 - 它打印一个充满随机字符的终端，然后退出，留下一个命令提示符，当您输入它时会产生垃圾。（我尝试过是因为我认为它会产生段错误）。

![http://oi38.tinypic.com/r9qxbt.jpg](https://i.stack.imgur.com/kGkf4.png)

```
#include <stdio.h>

int main(){
    char* s = "lololololololol";
    while(1){
        printf("%c", *s);
        s++;
    }
} 
```

它是用以下方式编译的：

```
gcc -std=c99 hello.c
```

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-13T17:31:14.617

It will eventually seg fault, but before that it'll print out whatever bytes are in the same page. That's why you see random chars on the screen.

Those may well include escape sequences to change (say) the character encoding of the console. That's why you end up with gibberish when you type on the console after it's exited, too.

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-13T17:28:11.487

You are just printing out what is in memory because your loop doesn't stop at the end of the string. Each random byte is interpreted as a character. It will seg fault when you reach the end of the memory page (and get into unreadable territory).

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-13T17:29:11.610

Because you have an infinite loop (`while(1)`), and you keep getting the current value of pointer (`*s`), and then moving the pointer one char forward (`s++`). This has the effect of marching well past the end of the string into "garbage" (uninitialized memory), which gets printed to the console as a result.

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-13T17:37:52.950

In addition to what everyone else said in regards to you ignoring the string terminal character and just printing willy-nilly what's in memory past the string, the reason why your command prompt is also "garbage" is that by printing a particular "unprintable" character, your terminal session was left in a strange character mode. (I don't know which character it is or what mode change it does, but maybe someone else can pipe in about it that knows better than I.)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-13T18:43:30.463

在此处给出的答案上略微扩展（都非常好）......当我刚开始使用 C 时，我自己不止一次遇到过这个问题，这是一个容易犯的错误。

快速调整您的`while`循环将解决它。其他人都给了你为什么，我会告诉你如何：

```
#include <stdio.h>

int main() {
    char *s = "lolololololololol";
    while (*s != '\0') {
        printf("%c", *s);
        s++;
    }
} 
```

请注意，我们正在执行循环检查而不是无限循环 ( `while(1)`)，以确保我们拉出的指针不是字符串的空终止符，从而避免您遇到的溢出。

如果您完全需要`while(1)`（例如，如果这是家庭作业并且教师希望您使用它），请使用`break`关键字退出循环。以下代码闻起来很臭，至少对我来说，但它有效：

```
#include <stdio.h>

int main() {
    char *s = "lolololololololol";
    while (1) {
        if (*s == '\0')
            break;
        printf("%c", *s);
        s++;
    }
} 
```

两者都产生相同的控制台输出，最后没有换行符：

> 洛洛洛洛洛洛

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-18T21:04:53.420

您的循环不会终止，因此 println 在您编写的文本之后打印内存中的任何内容；最终它将访问不允许读取的内存，导致它出现段错误。

您可以按照其他人的建议更改循环，或者您可以利用在 c 中，零为假且 null（终止所有字符串）也为零的事实，因此您可以将循环构造为：

```
while (*s) { 
```

而不是：

```
while (*s != '\0') 
```

第一个可能更难理解，但它确实具有简洁的优点，因此通常用于节省一些打字。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-02T21:16:02.037

此外，您通常可以使用“重置”命令返回命令提示符，当然是盲目输入。（输入、重置、回车）

# asp.net-mvc - 使用 Linq、ASP.NET MVC 插入多个数据库表

> ID：287594
> 
> 赞同：8
> 
> 时间：2008-11-13T17:27:13.580
> 
> 标签：asp.net-mvc, linq-to-sql

我有一个相当简单的场景，我有两个要在其中添加数据的表。它们使用主键/外键进行管理。我想将新数据添加到表 A 中，然后检索 Id 并插入到表 B 中。

我当然可以使用存储过程来做到这一点，但我正在考虑尝试使用 Linq 来做到这一点。

最好的方法是什么？

我当然可以获得 ID 并进行两次单独的插入，但这似乎并不是一种很好的做事方式。

```
db.Table.InsertOnSubmit(dbObject);
db.SubmitChanges();

Int32 id = dbOject.Id;

//Rest of the code 
```

有什么方法可以优雅地做到这一点？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-23T22:27:10.427

您是否在设计的对象关系中定义了两个表之间的关系？如果是这样，您可以让 linq 自动分配第二个表的 ID 属性。

示例...
表 A – Order
OrderId
OrderDate

表 B – Order Item
OrderItemId
OrderId
ItemId

代码（使用 LINQ-to-SQL）：

```
Order order = new Order();
Order.OrderDate = DateTime.Now();
dataContext.InsertOnSubmit(order);

OrderItem item1 = new OrderItem();
Item1.ItemId = 123;
//Note: We set the Order property, which is an Order object
// We do not set the OrderId property
// LINQ will know to use the Id that is assigned from the order above
Item1.Order = order;  
dataContext.InsertOnSubmit(item1);

dataContext.SubmitChanges(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-07-21T12:00:58.003

嗨，我使用此代码将数据插入三个表

```
 Product_Table AddProducttbl = new Product_Table();
        Product_Company  Companytbl = new Product_Company();
        Product_Category Categorytbl = new Product_Category();

        // genrate product id's
        long Productid = (from p in Accountdc.Product_Tables 
                        select p.Product_ID ).FirstOrDefault();
        if (Productid == 0)
            Productid++;
        else
            Productid = (from lng in Accountdc.Product_Tables 
                         select lng.Product_ID ).Max() + 1;
        try
        {
            AddProducttbl.Product_ID = Productid;
            AddProducttbl.Product_Name = Request.Form["ProductName"];
            AddProducttbl.Reorder_Label = Request.Form["ReorderLevel"];
            AddProducttbl.Unit = Convert.ToDecimal(Request.Form["Unit"]);
            AddProducttbl.Selling_Price = Convert.ToDecimal(Request.Form["Selling_Price"]);
            AddProducttbl.MRP = Convert.ToDecimal(Request.Form["MRP"]);
            // Accountdc.Product_Tables.InsertOnSubmit(AddProducttbl );
            // genrate category id's
            long Companyid = (from c in Accountdc.Product_Companies
                              select c.Product_Company_ID).FirstOrDefault();
            if (Companyid == 0)
                Companyid++;
            else
                Companyid = (from Ct in Accountdc.Product_Companies
                             select Ct.Product_Company_ID).Max() + 1;

            Companytbl.Product_Company_ID = Companyid;
            Companytbl.Product_Company_Name = Request.Form["Company"];

            AddProducttbl.Product_Company = Companytbl;
            //Genrate Category id's
            long Categoryid = (from ct in Accountdc.Product_Categories
                               select ct.Product_Category_ID).FirstOrDefault();
            if (Categoryid == 0)
                Categoryid++;
            else
                Categoryid = (from Ct in Accountdc.Product_Categories
                              select Ct.Product_Category_ID).Max() + 1;
            Categorytbl.Product_Category_ID = Categoryid;
            Categorytbl.Product_Category_Name = Request.Form["Category"];
            AddProducttbl.Product_Category = Categorytbl;

            Accountdc.Product_Tables.InsertOnSubmit(AddProducttbl);
            Accountdc.SubmitChanges();

        }
        catch 
        {
            ViewData["submit Error"] = "No Product Submit";
        } 
```

# winforms - 在 Windows 窗体中挂起控制事件的最佳方法？

> ID：287595
> 
> 赞同：10
> 
> 时间：2008-11-13T17:27:32.067
> 
> 标签：winforms, events, suspend

这似乎是一个非常简单且非常普遍的问题。我能想到的最简单的例子是：

该表单有五个复选框，上面有一个“全选/全选”复选框。当用户选择检查所有复选框时，我会切换“孩子”的状态 - 显然，在我完成所有复选框的设置之前，我不想触发所有孩子的检查事件。

我找不到表单范围的挂起控制事件。如果我只是想念它，那么很好的简单答案。除非我只是缺少一个简单的解决方案，否则暂停表单控制事件的最佳方法是什么（最佳实践？接受的解决方案？）？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-13T17:47:29.157

我以前遇到过这种情况，通常看到人们这样做：

```
/*SNIP*/

private bool isMassUpdate;

public void Check1_Check(object sender, EventArgs e)
{
   if(!isMassUpdate)
   {
       do some stuff
   }
}

/*SNIP*/ 
```

您还可以分离和重新附加事件处理程序，但是，我被告知这可能是内存泄漏的来源。

有关内存泄漏和事件处理程序的信息：它们与附加和分离没有直接联系，但我们在其中一个应用程序中看到，对继承树的事件处理程序的错误引用可能会导致这种情况。

*   *[.NET 内存泄漏案例研究：造成内存气球的事件处理程序](http://blogs.msdn.com/tess/archive/2006/01/23/net-memory-leak-case-study-the-event-handlers-that-made-the-memory-baloon.aspx)*

*   *[关于事件处理程序和内存泄漏](http://forum.umbraco.org/yaf_postst6558_Net-Experts-Question-on-Event-Handlers-and-Memory-Leaks.aspx)*

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-13T23:27:15.523

我在这些情况下所做的不是使用暂停事件的布尔值，而是使用计数器。当计数 > 0 时，则暂停事件，当计数 = 0 时，则恢复事件。如果我有多个可能要求暂停事件的事情，这有助于解决问题。

另一个有用的事情是，如果我需要在一个块中暂停事件，我创建一个 IDisposable 的小助手类，我可以在“使用”块（在 C# 中）中使用它，这样我就不会忘记减少计数器一旦我超出范围。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-13T17:44:21.690

根据您的另一个问题，我猜您正在使用 VB .NET。所以，RemoveHandler 是你最好的选择。通常在 VB 中，人们使用 Handles 子句设置事件处理程序。但你也可以这样做：

```
AddHandler chk1.CheckedChanged, AddressOf DoSomething 
```

DoSomething 可能看起来像这样：

```
Private Sub DoSomething(ByVal sender As Object, ByVal e As EventArgs)
    ' whatever
End Sub 
```

AddHandler 连接事件，所以它会触发。要让它不触发，请使用 RemoveHandler：

```
RemoveHandler chk1.CheckedChanged, AddressOf DoSomething 
```

在更新子复选框的 Checked 属性之前，请在每个复选框上调用 RemoveHandler；然后当你完成后，调用 AddHandler 将事件处理程序放回去。如果您的所有复选框都使用相同的处理程序，您可以将它们放在一个集合中并循环访问该集合以添加或删除处理程序。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T17:51:43.187

您还可以考虑处理按钮的“单击”事件，而不是检查更改。这可能更接近您的意图。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-13T21:02:30.540

在我的[Visual Basic 6.0](http://en.wikipedia.org/wiki/Visual_Basic#Timeline)应用程序中，我必须处理用户双击*所有内容*，所以在我的所有事件处理程序中，我有一行检查全局变量

```
Private bSuspendEvents as Boolean

Private Sub Button1_Click()

    On Error Goto ErrorHandler

    If bSuspendEvents then Exit Sub

    bSuspendEvents = True

    'Do stuff

    NormalExit:
        bSuspendEvents = False
        Exit Sub

    ErrorHandler:
        'Handle Error
        Resume NormalExit

End Sub 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-10-03T03:34:55.057

请参阅堆栈溢出问题*[如何在 C# Windows 窗体中更改控件状态时忽略触发的简单事件？](https://stackoverflow.com/a/6604753/101252)*

> 对于更一般的情况，如果控件之间有复杂的关系，则可以通过检查其自己的 Focused 属性来检查哪个控件触发了事件……每个对象仅依赖于自身。

# sql - 对选择语句和插入语句使用 MS SQL 的 WITH (NOLOCK) 选项是否安全？

> ID：287596
> 
> 赞同：1
> 
> 时间：2008-11-13T17:27:34.327
> 
> 标签：sql, sql-server-2005

如果您从不修改行，而只插入或删除行，那么对 select 语句和 insert 语句使用 MS SQL 的 WITH (NOLOCK) 选项是否安全？

即你永远不会对任何行进行更新。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-13T17:37:45.133

如果您询问是否会获得可能不再准确的数据，那么这取决于您的查询。例如，如果您执行以下操作：

```
SELECT
     my_id,
     my_date
FROM
     My_Table
WHERE
     my_date >= '2008-01-01' 
```

在插入日期为 2008-01-01 或之后的行的同时，您可能无法获得该新行。这也会影响生成聚合的查询。

如果您只是通过删除/插入来模拟更新，那么您也可能会获得数据的“旧”版本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T20:19:01.563

一般不会。（即 UPDATE 不是唯一的锁定问题）

如果您正在插入（或删除）记录，并且选择可能会指定该集合中的记录，那么是的，NOLOCK 会给您一个脏读，可能包括也可能不包括这些记录。

如果永远不会选择插入或删除（例如，读取的数据始终是昨天的数据，而今天进入或被操作的数据永远不会被读取），那么是的，它是“安全的”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T17:41:17.047

如果您从不进行任何更新，那么为什么锁定首先会给您带来问题？

如果存在引用完整性或触发问题，那么 NOLOCK 只会将这些错误变成神秘的不一致。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-09-29T23:03:34.800

好吧，“安全”是一个非常笼统的术语；这一切都取决于您的应用程序的上下文及其使用。但是当使用 NOLOCK 提示时，总是有可能跳过和重复计算以前提交的行。

无论如何，请阅读以下内容：http: [//blogs.msdn.com/b/sqlcat/archive/2007/02/01/previously-committed-rows-might-be-missed-if-nolock-hint-is-使用过的.aspx](http://blogs.msdn.com/b/sqlcat/archive/2007/02/01/previously-committed-rows-might-be-missed-if-nolock-hint-is-used.aspx)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-11-13T17:44:01.673

如果您将自己限制为 INSERT 和 DELETE，则不确定 SELECT 语句会如何发生冲突。INSERT 是有问题的，例如，在查询期间可能插入了冲突的主键。INSERT 和 DELETE 都将您暴露于 WHERE 子句中表达的条件，或者 JOIN 等可能在您的语句执行期间变得无效。

# security - Why should I care about hashing passwords anyway?

> ID：287597
> 
> 赞同：19
> 
> 时间：2008-11-13T17:27:39.913
> 
> 标签：security, encryption

If a hacker has access to the hashes in my DB, he has access to the rest of the information in the DB anyways. So why would he bother trying to decrypt the passwords? Should I be storing the passwords on a different server to the rest of my data? That is the only scenario in which I can envision it being useful.

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-11-13T17:30:53.993

1.  Sometimes a hacker doesn't get full access to your DB. Sometimes they find a little SQL injection hole or other weakness that someone didn't code correctly, and so they can only do simple things at first like print out database cells one at a time. If they can print out a real password all of a sudden things get much worse.

2.  Things happen: backup tapes are lost, accidentally thrown away, or stolen. A retired system wasn't wiped properly. A breach elsewhere leads to accidental exposure of a database. If a hacker gets access to a snapshot like this he can learn a lot about your system. But if the passwords are still hashed he can't also use the system to do something malicious, like log in as a different user and start changing things.

3.  I've heard that most hacks are an inside job. Better to remove the ability even for people you trust to log in as others.

4.  It's not about just you. Users tend to share passwords across systems. Maybe some day (God forbid) you have a breach that has nothing to do with passwords, but in the course of that breach your authentication tables will be one of the attacker's targets. If you store passwords in plain-text, you have also just compromised user accounts at many other services, and your very bad day just got quite a lot worse.

If you think this kind of thing doesn't happen, go talk to the guys at reddit.

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2008-11-13T17:31:34.397

1.  People often use the same username/password for different accounts on other websites (including, e.g., online access to bank accounts).

2.  Once you've discovered this hack and have secured your database, the hacker will still have the ability to login to your user's accounts.

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-11-14T02:39:59.627

**最佳安全实践**建议：

*   您应该为您拥有的每个帐户使用唯一的 (userId, password) 对。但是大多数人将一对用于许多资源（电子邮件、银行*等*）。攻击者可以从一个资源中窃取它们并使用它们来访问另一个资源。*用盐*对密码进行散列（参见[http://en.wikipedia.org/wiki/Salt_(cryptography)）](http://en.wikipedia.org/wiki/Salt_(cryptography))可以防止这种攻击。

*   您应该加密数据库中的*所有*敏感数据，而不仅仅是密码。您关于有人可能会窃取您的整个数据库（或您的服务器）的观点是完全正确的。

*   您应该将 Web 服务器与数据库和任何其他宝贵资源分开，以隔离对您最不有价值资产的攻击。

哈希密码也有**商业原因**。请记住，散列意味着*您不会将用户的密码存储*在设备的任何位置。

*   根据适用的法律，在某些情况下您可能*需*要这样做。

*   如果您的数据被盗，您将大大减少风险。

*   *社交工程*攻击让您更安全，攻击者冒充有效用户并诱使员工泄露密码。请参阅[http://en.wikipedia.org/wiki/Social_engineering_(security)](http://en.wikipedia.org/wiki/Social_engineering_(security))。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-13T17:34:32.100

> Should I be storing the passwords on a different server to the rest of my data?

This adds complexity to your system, but if it's something you can do it's definitely an improvement.

Note that using authentication servers such as Kerberos, RADIUS, or Windows domain authentication effectively put you passwords on another server.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-13T17:32:15.800

Because even if you have access to the data, having access to the APPLICATION is actually more important. The Application makes it much easier to manipulate the data, for example.

Hashing the password prevents casual exposure from all eyes.

For example, you may well have the same password across several sites. A quick glance at the DB not only compromises your application, but perhaps several others.

It's just a good, solid practice to hash you passwords.

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-13T17:53:17.130

Mainly because it's nearly trivial to do it well, and the benefits can be very high.

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-13T17:42:39.773

Sometime, you don't know who will be the system administrator. You still want to protect your users from them.. So, by hashing passwords and all important information (such as credit card), you make it really harder for the hacker or administrator. And, I think password should never be written literally. I mean, I used a password since 2 years and I have never seen it written down.. why an administrator that I don't know should see MY password ?!

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-13T17:49:55.797

Using a hashed password prevents the attacker from being able to log into your app even if they know the hash. Your login page asks for the original password, so to log in using it, they'd have to reverse the hash (compute a collision). Using a rainbow table, that's fairly trivial for MD5, for example, which is where salting comes in. Then the attacker needs to know 1) the way you combine the salt and the password (not much security there), 2) the salt (which is likely in the db already) and 3) they have to compute that value for each combination of password and salt. That's a lot more than just computing hashes of common passwords and looking for a match.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-22T04:26:52.010

当黑客访问您的数据库时，这并不意味着他可以访问程序代码，这些程序可以更改被黑客入侵的数据库边界之外的数据库，或者可以更改其他程序。

顺便问一下，我要问你一个问题：如果一个用户被黑了并且有人知道了他或她的密码，你如何明确这不是你的应用程序或安全错误？

如果您没有存储密码，您就没有这种责任！

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-04-22T16:50:58.963

如果他可以解密密码，他可能也可以访问您用户在其他网站上的帐户（因为无论我们告诉人们不要重复使用密码多少次，他们都会这样做）。存储明文密码是放弃所有用户的 PayPal、eBay 和 Amazon 帐户的好方法。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-22T04:40:36.827

如果应用程序要在大学显示成绩信息，那么访问密码将允许您获得该人的成绩。如果密码还允许您登录在线课程系统，那么您可以以该用户身份提交测试。

如果数据更加敏感，例如信用卡号码或健康记录，您可能会面临诉讼。

奇怪的是，更敏感的信息可能位于更安全的系统上，位于更强大的防火墙后面，因此他们可能通过入侵身份验证数据库发现了弱点。

通过对密码进行哈希处理，那些有权访问身份验证数据库的人就看不到密码，因此以不同的用户身份登录到非常敏感的系统。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-04-21T16:26:10.220

整个[LinkedIn](http://thenextweb.com/socialmedia/2012/06/06/bad-day-for-linkedin-6-5-million-hashed-passwords-reportedly-leaked-change-yours-now/) [“丑闻”](http://it.slashdot.org/story/12/06/06/1335228/linkedin-password-hashes-leaked-online)都是关于泄露的散列密码。

正如我所看到的，除了使数据检索*不方便*之外，安全性无关紧要。

理想情况下的*不方便*是指您需要*数百万年的计算时间才能访问*（即尝试猜测密码的单个 CPU 将需要数百万年的规模）。

如果您以明文形式存储密码，则总共需要 0 个计算年才能访问。LinkedIn 的丑闻看起来会更糟。您所要做的就是`SELECT * FROM USERS`（通过注入或内部人员）。

人们经常重复使用密码，因此如果人们知道了您的密码，这意味着他们可以访问整个世界的数据（例如，不仅仅是他们的 LinkedIn）。所以它变成了一个非常个人的风险。作为网站管理员***，至少***不要散列密码是**不礼貌**的：您对您的用户采取基本步骤来保护他们的信息没有那么大的尊重。

 *即使散列密码可以被破解，您至少要采取最低限度的步骤来保护您的用户。

# sql-server - 找出sql server硬件或速度测试

> ID：287600
> 
> 赞同：3
> 
> 时间：2008-11-13T17:28:00.863
> 
> 标签：sql-server

我经常使用 sql server，最近对性能感到沮丧。我很难直接访问以找出硬件，所以：

管理工作室中是否有直接的方法来评估性能或找出确切的硬件。

或者，是否有人有一组测试 sql 程序，我可以尝试并理想地与其他结果进行比较，以了解它的性能。

到目前为止，我已经在我的本地机器 sql express 服务器上设置了一些快速查询，就像测试这些似乎比网络上的 sql server 运行得更快，这意味着高性能，尽管没有人知道它上次升级的时间我有一个感觉已经六七年了。显然，这些测试没有考虑其他人同时查询或网络传输结果的可能性......希望有人有更好的解决方案。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T17:41:25.983

你不能只问你的服务员吗？如果您无法获得硬件指标，似乎会有相当多的不信任。CPU 数量、总内存等。

如果有这么多的不信任，即使你从数据库服务器中找到了答案，也无法纠正它。如果你不能得到当前的参数，你怎么能通过服务器的人来改变硬件呢？

开始建立融洽关系。世界上让某人站在你这边的最好的台词是，“我有麻烦了，我需要你的帮助……”你提升了他们并征服了自己，你让他们处于拯救你的位置。你会惊讶于你能以这种方式从别人身上得到多少。

至于标准查询。您可以查看[TPC](http://www.tpc.org)查询。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T19:09:12.157

如果您在 2005 年：

选择 * FROM sys.dm_os_performance_counters

这将为您提供一些仅 sql 的统计信息。至少没有终端访问权限，您将找不到有关机器的太多信息。在 sql 启动日志中，您还可以看到有关处理器的一些信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T17:45:42.060

您也可以尝试在您的服务器中更新您的引用。不久前我遇到了一个问题，即 1 个查询在 100 毫秒内返回，一个相同的查询在 5 分钟内返回，而 2 之间的唯一区别是我的查询中表名中的大写字母（这显然无关紧要）。

经过一番搜索和[SO-Questioning](https://stackoverflow.com/questions/150017/case-sensitivity-when-querying-sql-server-2005-from-net-using-oledb)，我发现我需要更新我的统计数据。您的数据库/SQL Server 也需要这样的东西吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T18:00:15.370

这种事情可能是非常政治化的，尤其是在具有地方性 CYA 文化的公司（描述了大多数金融服务公司）。如果没有合理的期望与生产人员建立良好的工作关系，一些方法是：

*   查看查询的查询计划。检查它们是否合理（应该使用索引等）

*   让它正式。让他们的经理了解机器的规格、磁盘布局和服务器配置以及所有表和索引的最后一次更新统计信息。清楚地表明机器似乎性能不佳。

*   如果统计信息过时，请更新它们。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T21:56:03.257

还有一个

选择 * 从 sys.dm_os_sys_info

# sql - 查询连接问题

> ID：287630
> 
> 赞同：1
> 
> 时间：2008-11-13T17:36:25.260
> 
> 标签：sql, mysql, join

我有一个正确的外部连接，几乎可以满足我的需求......

```
SELECT
users_usr.firstname_usr,
users_usr.lastname_usr,
credit_acc.given_credit_acc,
users_usr.created_usr,
users_usr.sitenum_usr,
users_usr.original_aff_usr,
users_usr.id_usr
FROM
credit_acc
right Outer Join users_usr ON credit_acc.uid_usr = users_usr.id_usr 
```

问题是，我想添加一个

```
where credit_acc.type_acc = 'init' 
```

但这摆脱了所有在 credit_acc 中没有一行的用户......这就是为什么我需要一个右外连接。

有没有办法在不必做两个查询和一个联合的情况下得到这个？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T17:39:00.997

```
SELECT
users_usr.firstname_usr,
users_usr.lastname_usr,
credit_acc.given_credit_acc,
users_usr.created_usr,
users_usr.sitenum_usr,
users_usr.original_aff_usr,
users_usr.id_usr
FROM
credit_acc
right Outer Join users_usr ON credit_acc.uid_usr = users_usr.id_usr
WHERE credit_acc.type_acc = 'init' OR credit_acc.type_acc is NULL 
```

或者，正如@Tomalak 指出的那样：

```
WHERE COALESCE(credit_acc.type_acc, 'init') = 'init' 
```

这*可能*更快（见评论）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T17:42:03.550

如果该行不存在，*credit_acc.type_acc*应该为空。你可以尝试这样的事情：

```
WHERE credit_acc.type_acc = 'init' OR credit_acc.type_acc IS NULL; 
```

这只有在*credit_acc.type_acc*中没有空字段时才有效。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T17:41:20.353

您是否尝试过以下操作？

```
SELECT
users_usr.firstname_usr,
users_usr.lastname_usr,
credit_acc.given_credit_acc,
users_usr.created_usr,
users_usr.sitenum_usr,
users_usr.original_aff_usr,
users_usr.id_usr
FROM
credit_acc
right Outer Join users_usr ON credit_acc.uid_usr = users_usr.id_usr and credit_acc.type_acc = 'init' 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T17:45:27.007

您想要两个表中的所有记录，在用户 ID 上加入，在哪里 credit_acc 是 'init' 或者没有要加入的 credit_acc 行？怎么样

```
where credit_acc.type_acc is null  OR credit_acc.type_acc = 'init' 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T18:54:29.847

我会做谓词：

```
WHERE credit_acc.uid_usr IS NULL OR credit_acc.type_acc = 'init' 
```

这将为您提供 UID_USR 上不匹配的行，以及存在匹配且帐户类型为“init”的行。

建议的另一个解决方案（检查 type_acc 是否为 NULL）也会为您提供与 UID_USR 匹配且帐户类型的实际值为 NULL 的行。

如果 credit_acc.type_acc 不能为 NULL，则两者没有区别。如果可以，您需要决定是否要将这些行包含在结果集中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-13T19:14:54.720

只需将另一个谓词添加到联接条件。

```
SELECT  U.firstname_usr, U.lastname_usr, C.given_credit_acc, 
        U.created_usr, U.sitenum_usr, U.original_aff_usr, U.id_usr
From credit_acc C Right Join users_usr U
   On C.uid_usr = U.id_usr
      And C.type_acc = 'init' 
```

之所以有效，是因为在将“外部”连接的“另一”侧的不匹配记录添加到结果集中之前应用了连接条件，而在连接两个表之后应用了 Where 条件......

这种语法也更清楚地代表了您的意图......

# asp.net - Response.Write DataTable 数据到文本文件，ASP.net 挂起

> ID：287632
> 
> 赞同：2
> 
> 时间：2008-11-13T17:36:36.417
> 
> 标签：asp.net, export, text-files, response.write

非常奇怪的问题，因为这在我们旧的 Classic ASP 站点上运行良好。我们基本上是在查询数据库并通过 Response.Write 将大约 2200 行文本导出到文本文件以输出到对话框并允许用户保存文件。

Response.Clear() Response.ClearContent() Response.ClearHeaders()

```
 Dim fileName As String = "TECH" & test & ".txt"

    Response.AddHeader("Content-Disposition", String.Format("attachment; filename={0}", fileName))
    Response.ContentType = "text/plain"

    Response.Write(strHeader)

    Dim sw As New IO.StringWriter()

    Dim dtRow As DataRow
    For Each dtRow In dt3.Rows
        sw.Write(dtRow.Item("RECORD") & vbCrLf)
    Next

    Response.Write(sw.ToString)
    Response.Write(strTrailer & intRecCount)
    Response.End() 
```

我可以使用 StringWriter 或简单地使用 Response.Write(dt.Rows(i).Item("RECORD").toString

无论哪种方式，Export 都会在我们的开发站点上造成可怕的挂起。我的本地机器不会导致挂起，几乎是瞬时的。记录集不是很大，它正在写入的行很小。

任何人都知道为什么这会被挂起？它最终允许保存和显示文件，但它远远超过 3-4 分钟。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T17:38:07.987

附加一个远程调试器并找到它挂在哪里？

您需要确定它是字符串编写器循环，还是实际的查询代码（此处未提供）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T17:40:05.473

听起来你可能溢出了输出缓冲区。也许在那里添加一个计数器以每隔几百行刷新一次。

此外，Response 对象基本上为您完成了 StringWriter 的大部分工作。使用 StringWriter 作为中介可能是多余的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T18:05:26.280

使用 StringWriter 和 DataTable 都过大了。

为什么不直接使用SqlReader从数据库中获取结果，同时读取reader，直接写入输出流呢？速度更快，消耗的内存更少。

作为对第二个问题的回答——为什么 ASP 工作正常，我怀疑你是否在内存中存储了 3 次相同的内容以便输出它（在 DataTable、StringWriter 和输出缓冲区中）。我的 ASP 有点生疏，但我猜你正在使用某种数据库阅读器。

此外，最好使用一些日志记录基础设施（NLog、log4net），这样您就可以输出一些关于哪个操作延迟多少的时间，作为附加远程调试器的替代方法。

# java - Java - C-Like Fork？

> ID：287633
> 
> 赞同：55
> 
> 时间：2008-11-13T17:37:01.313
> 
> 标签：java, c, fork

是否可以使用新的独立 jvm 进程在 java 中进行“C 类”分叉？

如何？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2010-11-30T15:24:06.033

这个答案可能有点晚了，但是：

[http://akuma.kohsuke.org/](http://akuma.kohsuke.org/)

似乎正是您要找的

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-13T17:44:47.053

有趣的是，我正在研究这个：一个运行其他 Java 进程的 Java 进程。我使用[从 Runtime.exec() 到 ProcessBuilder](https://www.java-tips.org/java-se-tips-100019/88888889-java-util/426-from-runtimeexec-to-processbuilder.html)的文章作为一个坚实的基础，[当 Runtime.exec() 不会](http://www.javaworld.com/javaworld/jw-12-2000/jw-1229-traps.html)作为如何吞噬输出流的好建议。

PS.：对于那些想知道的人，我不得不这样做（而不是产生新线程），因为另一个 Java 进程正在检查这些进程的存在，这些进程通常与 shell 命令分开运行。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-01-09T18:21:30.470

[应用程序隔离 API (JSR 121)](https://jcp.org/en/jsr/detail?id=121)介绍`Isolate`了解决此用例的方法。

# java - 如何使用反射检查方法是否是静态的？

> ID：287645
> 
> 赞同：108
> 
> 时间：2008-11-13T17:40:34.707
> 
> 标签：java, reflection

我只想在运行时发现一个类的静态方法，我该怎么做？或者，如何区分静态和非静态方法。

* * *

## 回答 #1

> 赞同：190
> 
> 时间：2008-11-13T17:43:37.180

使用`Modifier.isStatic(method.getModifiers())`.

```
/**
 * Returns the public static methods of a class or interface,
 *   including those declared in super classes and interfaces.
 */
public static List<Method> getStaticMethods(Class<?> clazz) {
    List<Method> methods = new ArrayList<Method>();
    for (Method method : clazz.getMethods()) {
        if (Modifier.isStatic(method.getModifiers())) {
            methods.add(method);
        }
    }
    return Collections.unmodifiableList(methods);
} 
```

注意：从安全角度来看，这种方法实际上是危险的。Class.getMethods “绕过[es] SecurityManager 根据直接调用者的类加载器进行检查”（参见 Java 安全编码指南的第 6 节）。

免责声明：未经测试甚至编译。

注意`Modifier`应小心使用。以整数表示的标志不是类型安全的。一个常见的错误是在不适用的反射对象类型上测试修改器标志。可能会设置相同位置的标志以表示某些其他信息。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-11-13T17:51:26.323

您可以像这样获得静态方法：

```
for (Method m : MyClass.class.getMethods()) {
   if (Modifier.isStatic(m.getModifiers()))
      System.out.println("Static Method: " + m.getName());
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-13T17:48:44.487

为了充实之前的（正确）答案，这里有一个完整的代码片段，可以满足您的需求（忽略异常）：

```
public Method[] getStatics(Class<?> c) {
    Method[] all = c.getDeclaredMethods()
    List<Method> back = new ArrayList<Method>();

    for (Method m : all) {
        if (Modifier.isStatic(m.getModifiers())) {
            back.add(m);
        }
    }

    return back.toArray(new Method[back.size()]);
} 
```

# c# - Looking for *small*, open source, c# project with extensive Unit Testing

> ID：287646
> 
> 赞同：14
> 
> 时间：2008-11-13T17:40:43.100
> 
> 标签：c#, unit-testing, open-source

(I asked [this](https://stackoverflow.com/questions/282830/looking-for-small-open-source-vbnet-project-with-extensive-unit-testing) question but did not receive much response. It was recommended that I ask the same question with regards to C#. )

I am a VB.NET developer with little C# experience (yes, I know I need to write more in C#), looking for small open source projects that demonstrate high unit testing coverage from which to learn.

I'm looking for ***small*** projects because I don't want to have to wade through a ton of code to get a better understanding of how to apply unit testing in my own situation, in which I write mostly IT business apps used internally by my company.

UPDATE: Original question that got me asking about this is [here](https://stackoverflow.com/questions/236156/could-you-recommend-any-open-source-projects-where-the-source-is-extensively-te)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T17:59:49.193

我的[MiscUtil](http://pobox.com/~skeet/csharp/miscutil)库具有可变的测试覆盖率——一些部分经过了非常彻底的测试，而另一些部分是在我了解单元测试之前编写的。

如果您想通过为未发现的内容编写一些测试来学习，我们将非常欢迎您 :)

这是一个很大的有用零碎的抓包 - 这在某些方面很方便，因为您几乎可以拿走任何一点并自己研究它。没有要学习的“整体架构”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T17:43:26.870

Try looking at FileHelpers ([http://www.filehelpers.net/](http://www.filehelpers.net/)). I recently had to make an edit to it and found the source code easy to wade through. It has a large number of tests.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T18:19:09.683

我建议看一下 CarTrackr，它具有开发人员应该熟悉的各种 .Net 技术（尤其是 Unity、MVC 框架），并且具有广泛的单元测试。该项目足够简单，可以一口气消化，但又足够复杂，实际上不仅仅是概念验证。他们的 codeplex 网址位于[http://www.codeplex.com/CarTrackr](http://www.codeplex.com/CarTrackr)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T18:17:18.550

此链接与 Silverlight 相关，但概念可能非常相似（从 TDD 的角度来看）： http: [//www.jeff.wilcox.name/2008/11/04/test-framework-source/](http://www.jeff.wilcox.name/2008/11/04/test-framework-source/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T18:20:54.907

我的[GeoNames .NET WCF 客户端](http://www.codeproject.com/KB/WCF/GeoNames-WCFClient.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-12T20:55:28.820

[codecampserver.org](http://codecampserver.org)

# opengl - OpenGL围绕一个点旋转相机

> ID：287655
> 
> 赞同：29
> 
> 时间：2008-11-13T17:43:38.943
> 
> 标签：opengl, camera, rotation, 3d

在 OpenGL 中，我试图围绕一个点旋转相机，相机与该点的距离为 r，并且在旋转时面向该点。换句话说，我希望相机沿距离中心半径为 r 的圆的圆周移动，相机在圆周上的任何点面向中心。

假设在 3d 空间中，圆的中心是 (3, 0, 3)；

我试过了：

```
// move to center of circle    
glTranslatef(-3, 0, -3)
// move a distance away from the circle
glTranslatef(0, 0, r);
// rotate along the y "up" axis
glRotatef(CameraAngle, 0, 1, 0); 
```

其中 CameraAngle 是围绕圆圈移动的度数。

我的最终结果是相机仍然沿原点旋转，而不是圆心。谁能帮我解决这个问题？谢谢！

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-11-13T17:48:52.880

您需要：

*   围绕原点旋转相机，然后平移它 (*)

或者：

*   用于`gluLookAt`保持相机指向圆心

(*) 旋转函数通常围绕原点旋转。要围绕另一个点旋转，`P`您必须：

*   翻译(-P)
*   旋转
*   翻译(P)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-03T07:18:55.263

这有点令人困惑，但我认为你应该：

```
// move camera a distance r away from the center
glTranslatef(0, 0, -r);

// rotate 
glRotatef(angley, 0, 1, 0);
glRotatef(anglex, 1, 0, 0);

// move to center of circle    
glTranslatef(-cx, -cy, -cz) 
```

请注意，不得更改订单。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T18:49:38.733

为什么要麻烦旋转相机而不是旋转场景本身呢？
它更直接。只需围绕原点旋转模型视图矩阵。你会得到完全相同的结果。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T17:53:41.203

我发现使用 gluLookAt() 可以更轻松地解决此类问题。您为相机定义一条路径（一个圆圈很简单！）并保持“中心”点固定（即您正在看的东西）。

唯一可能的技巧是定义一个好的向上向量——但通常不需要太多的工作。如果路径和目标点在同一平面上，则每次都可以使用相同的向上向量！

# c# - 如何取消注册表单事件的所有处理程序？

> ID：287663
> 
> 赞同：2
> 
> 时间：2008-11-13T17:45:25.570
> 
> 标签：c#, handler

我有 2 个使用相同表单的处理程序。如何在添加新的处理程序（C#）之前删除处理程序？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-13T17:55:00.903

如果您正在使用表单本身，您应该能够执行以下操作：

伪代码：

```
Delegate[] events = Form1.SomeEvent.GetInvokationList();

foreach (Delegate d in events)
{
     Form1.SomeEvent -= d;
} 
```

在表格之外，您的 SOL。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-13T17:50:12.363

如果您知道这些处理程序是什么，只需以与您订阅它们相同的方式删除它们，除了使用 -= 而不是 +=。

如果您不知道处理程序是什么，则无法删除它们 - 事件封装的想法是防止感兴趣的一方在观察事件时破坏另一类的利益。

编辑：我一直假设您正在谈论由不同类实现的事件，例如控件。如果您的班级“拥有”该事件，则只需将相关变量设置为 null。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-08-06T18:59:18.613

我意识到这个问题已经很老了，但希望它能帮助别人。您可以通过一点反射取消注册任何类的所有事件处理程序。

```
public static void UnregisterAllEvents(object objectWithEvents)
{
    Type theType = objectWithEvents.GetType();

    //Even though the events are public, the FieldInfo associated with them is private
    foreach (System.Reflection.FieldInfo field in theType.GetFields(System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance))
    {
        //eventInfo will be null if this is a normal field and not an event.
        System.Reflection.EventInfo eventInfo = theType.GetEvent(field.Name);
        if (eventInfo != null)
        {
            MulticastDelegate multicastDelegate = field.GetValue(objectWithEvents) as MulticastDelegate;
            if (multicastDelegate != null)
            {
                foreach (Delegate _delegate in multicastDelegate.GetInvocationList())
                {
                    eventInfo.RemoveEventHandler(objectWithEvents, _delegate);
                }
            }
        }
    }
} 
```

# asp.net-mvc - 在 ASP.NET MVC 中使用控制器和用户控件设置活动选项卡的简单方法？

> ID：287679
> 
> 赞同：14
> 
> 时间：2008-11-13T17:50:44.623
> 
> 标签：asp.net-mvc, css, user-interface, tabs

如何在 UI 中突出显示“当前”选项卡来创建选项卡式导航？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-13T17:53:38.190

在 MVC 之前，我查看了文件路径并找出了当前的选项卡。现在容易多了，你可以根据当前控制器分配当前选项卡。

看看这个 ...

大部分工作发生在用户控件中。

```
public partial class AdminNavigation : ViewUserControl
{
    /// <summary>
    /// This hold a collection of controllers and their respective "tabs." Each Tab should have at least one controller in the collection.
    /// </summary>
    private readonly IDictionary<Type, string> dict = new Dictionary<Type, string>();

    public AdminNavigation()
    {
        dict.Add(typeof(BrandController), "catalog");
        dict.Add(typeof(CatalogController), "catalog");
        dict.Add(typeof(GroupController), "catalog");
        dict.Add(typeof(ItemController), "catalog");
        dict.Add(typeof(ConfigurationController), "configuration");
        dict.Add(typeof(CustomerController), "customer");
        dict.Add(typeof(DashboardController), "dashboard");
        dict.Add(typeof(OrderController), "order");
        dict.Add(typeof(WebsiteController), "website");
    }

    protected string SetClass(string linkToCheck)
    {
        Type controller = ViewContext.Controller.GetType();
        // We need to determine if the linkToCheck is equal to the current controller using dict as a Map
        string dictValue;
        dict.TryGetValue(controller, out dictValue);

        if (dictValue == linkToCheck)
        {
            return "current";
        }
        return "";
    }
} 
```

然后在用户控制的 .ascx 部分调用 SetClass 方法来检查与字典的链接。像这样：

```
<li class="<%= SetClass("customer") %>"><%= Html.ActionLink<CustomerController>(c=>c.Index(),"Customers",new{@class="nav_customers"}) %></li> 
```

您现在需要的只是 CSS 来突出显示当前选项卡。有很多不同的方法可以做到这一点，但你可以在这里开始一些想法：[http](http://webdeveloper.econsultant.com/css-menus-navigation-tabs/) ://webdeveloper.econsultant.com/css-menus-navigation-tabs/ 哦，别忘了把用户控件在您的页面（或 MasterPage）上...

```
<% Html.RenderPartial("AdminNavigation"); %> 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2010-05-28T07:32:15.627

我写了一些简单的帮助类来解决这个问题。该解决方案着眼于使用哪个控制器以及控制器中的哪个操作。

```
public static string ActiveTab(this HtmlHelper helper, string activeController, string[] activeActions, string cssClass)  
{  
     string currentAction = helper.ViewContext.Controller.  
     ValueProvider.GetValue("action").RawValue.ToString();
     string currentController = helper.ViewContext.Controller.  
     ValueProvider.GetValue("controller").RawValue.ToString();  
     string cssClassToUse = currentController == activeController &&  
                            activeActions.Contains(currentAction)  
                            ? cssClass  
                            : string.Empty;  
     return cssClassToUse;  
} 
```

您可以使用以下方法调用此扩展方法：

```
Html.ActiveTab("Home", new string[] {"Index", "Home"}, "active") 
```

如果我们在“Index”或“Home”操作中的 HomeController 上，这将返回“active”。我还为 ActiveTab 添加了一些额外的重载以使其更易于使用，您可以阅读整个博客文章：[http ://www.tomasjansson.com/blog/2010/05/asp-net-mvc-helper-for- active-tab-in-tab-menu/](http://blog.tomasjansson.com/2010/09/asp-net-mvc-helper-for-active-tab-in-tab-menu/)

希望这会对某人有所帮助。

问候，--托马斯

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-08-10T13:30:59.793

我在当前项目中使用的一种方法 - 这也有助于其他特定于页面的 CSS 需求。

首先，一个 HTML 帮助器，它返回一个代表当前控制器和动作的字符串：

```
public static string BodyClass(RouteData data) {
   return string.Format("{0}-{1}", data.Values["Controller"], data.Values["Action"]).ToLower();
} 
```

然后，在您的母版页中添加对此帮助程序的调用：

```
<body class="<%=AppHelper.BodyClass(ViewContext.RouteData) %>">
...
</body> 
```

现在，您可以使用 CSS 定位特定页面。要回答有关导航的确切问题：

```
#primaryNavigation a { ... }
.home-index #primaryNavigation a#home { ... }
.home-about #primaryNavigation a#about { ... }
.home-contact #primaryNavigation a#contact { ... }
/* etc. */ 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-07-09T05:46:15.307

MVC 的默认值`Site.css`带有一个名为的类`'selectedLink'`，应该用于此目的。

将以下内容添加到您的`ul`列表中`_Layout.cshtml`：

```
@{
    var controller = @HttpContext.Current.Request.RequestContext.RouteData.Values["controller"].ToString();
}
<ul id="menu">                
    <li>@Html.ActionLink("Home", "Index", "Home", null, new { @class = controller == "Home" ? "selectedLink" : "" })</li>
    ...
</ul> 
```

我知道这不干净。但这只是一种快速而肮脏的方式来让事情滚动而不会弄乱局部视图或任何类似的东西。

# .net - 正则表达式验证十六进制字符串

> ID：287684
> 
> 赞同：14
> 
> 时间：2008-11-13T17:51:57.773
> 
> 标签：.net, regex

我正在使用这个简单的正则表达式来验证一个十六进制字符串：

```
^[A-Fa-f0-9]{16}$ 
```

如您所见，我使用量词来验证字符串是否为 16 个字符长。我想知道是否可以在同一个正则表达式中使用另一个量词来验证字符串长度是 16 还是 18（不是 17）。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2008-11-13T17:54:42.620

我相信

```
^([A-Fa-f0-9]{2}){8,9}$ 
```

将工作。

这很好，因为它可以推广到任何偶数长度的字符串。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-13T17:54:28.610

这只是一个 16 个字符的要求，之后还有一个可选的 2 个字符：

```
^[A-Fa-f0-9]{16}([A-Fa-f0-9]{2})?$ 
```

括号可能不是必需的 - 恐怕我不是一个正则表达式大师来临时知道。如果有人想编辑它，请随意...

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-13T17:53:24.773

```
^(?:[A-Fa-f0-9]{16}|[A-Fa-f0-9]{18})$ 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T18:50:58.293

我可能会去

```
/^[a-f0-9]{16}([a-f0-9]{2})?$/i 
```

我。我认为将正则表达式设置为不区分大小写并且只列出一次字符范围更具可读性。也就是说，几乎所有这些答案都有效。

# c# - 手动在控件上引发 LostFocus 事件

> ID：287685
> 
> 赞同：1
> 
> 时间：2008-11-13T17:52:48.660
> 
> 标签：c#, .net

我在带有工具条容器和工具条按钮的表单上有一堆控件（文本框和组合框），用于保存、取消等进行编辑。我们正在使用 .Net 3.5 SP1
有一堆逻辑写在 control.lostfocus 和 control.leave 事件中。单击工具条按钮时不会调用这些事件。有没有办法在按下这些按钮中的任何一个时手动调用这些事件。

谢谢。
基肖尔

[编辑]

这就是我解决问题的方法。感谢*[Chris Marasti-Georg](https://stackoverflow.com/questions/287685/raise-lostfocus-event-on-a-control-manually-c#287740)*的指点。在按钮单击事件中，我调用工具条而不是按钮上的焦点，因为工具条按钮没有焦点事件。我们可以访问放置按钮的工具条

((ToolStripButton)sender).Owner.Focus()

-基肖尔

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T18:13:30.990

您可以侦听按钮上的单击事件，并在处理程序中调用它们的焦点方法。这将（希望）导致先前集中的控件正确响应。将以下处理程序添加到每个按钮的单击事件：

```
private void ButtonClick(object sender, EventArgs e) {
    if(sender != null) {
        sender.Focus();
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T18:07:54.497

您可以扩展这些控件，然后调用基类的 OnLostFocus 和 OnLeave 保护方法...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T18:21:08.010

我建议将登录名移至事件处理程序之外的方法并调用该方法...

# javascript - Thoughts on making a webapp fullscreen in a pop-up

> ID：287698
> 
> 赞同：0
> 
> 时间：2008-11-13T17:56:01.180
> 
> 标签：javascript, web-applications

At my company most inventory tracking is done via an ASP.NET web application. The application is poorly conceived, poorly designed, poorly implemented, and somewhat of a hassle for a user to work with. These are things that are my opinion though and management has its own thoughts on the matter.

Such luxuries as the browser's back button and bookmarking pages are already not an option because of heaps and heaps of ancient Ajax code and now one of my bosses has the idea that he would prefer for the URL bar and browser buttons not to appear at all.

At first I told him that it was impossible but after thinking about it I suppose it could work if you used Javascript to create a fullscreen pop-up and run the application in that.

I personally am against this idea though since I'm the one who would do the work my own subconscious motivations are suspect so I'd like to gather some opinions on running an application in such a manner.

In addition, has anyone had any experience with transferring a regular webapp to such a setup? I'd like to know how much work could be in store for me.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T18:01:09.610

下一次，为了世界的利益，把这些想法留给自己。看来你的老板没有资格打这样的电话，所以替他打吧。

如果您的老板认为 url 栏和浏览器按钮不应该存在，那么将其转换为独立的应用程序。如果它不应该是一个，不要试图将它塞进一个网络平台。

你知道问题所在，所以为你认为正确的事情而奋斗。不要实施任何你不会引以为豪的事情。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T18:33:17.860

您可能会发现[Prism](http://labs.mozilla.com/2007/10/prism/)很有趣

全屏，无栏，只有 WebApp

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-01T16:34:04.570

我很想简单地添加一个按钮，*让*您弹出应用程序，而不删除正常模式。

如有必要，将它与一些关于用户感到困惑或无法重新打开它或其他东西的华夫饼一起出售。或者甚至假装没有它就不可能做到。

这在某种程度上有助于用户友好。无论如何都要拯救你的良心

# c++ - 可执行读取本身

> ID：287702
> 
> 赞同：3
> 
> 时间：2008-11-13T17:57:24.987
> 
> 标签：c++, winapi, file

我需要从该可执行文件中读取添加到该可执行文件末尾的数据。
在 win32 上我有一个问题，我无法打开 .exe 进行阅读。我试过 CreateFile 和 std::ifstream。
有没有一种方法可以指定对最初未通过共享打开的文件的非独占读取访问权限。

编辑 - 关于 stackoverflow，你问错了问题并得到了正确的答案。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T18:04:36.343

为什么不只使用专为此功能设计的资源。它不会在最后，但会在可执行文件中。

如果您在构建后添加到 .exe - 您不必添加到最后，您可以更新构建的 .exe 上的资源

[http://msdn.microsoft.com/en-us/library/ms648049(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms648049(VS.85).aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T18:14:14.420

我们在我们的一个项目中这样做。它有什么问题？如果 EXE 正在运行，那么它已经处于打开状态以供阅读，您可以继续以只读方式打开它多次。我刚刚检查了我们的代码，我们只是使用：

```
HANDLE file=CreateFile(filename, GENERIC_READ, FILE_SHARE_READ, 0, OPEN_EXISTING, 0, 0); 
```

迄今为止，这在所有 32 位和 64 位 Windows 版本上都可以正常工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T18:14:34.187

使用以下任一语句打开进程的可执行映像都没有问题：

```
FILE* f = fopen( fname, "rb");

hFile = CreateFile( fname, FILE_READ_DATA, FILE_SHARE_READ, NULL, OPEN_EXISTING, 0, NULL); 
```

你的代码是什么？

# .net - IIS 6 使用通配符应用程序映射时压缩静态文件

> ID：287703
> 
> 赞同：2
> 
> 时间：2008-11-13T17:57:32.083
> 
> 标签：.net, asp.net, episerver

我正在使用带有 EPiserver CMS 的 IIS 6，它要求所有请求都通过 aspnet_isapi.dll。

我想压缩我所有的静态文件（主要是 js、css）。尝试在 IIS 中设置压缩不起作用。

EPiServer 中是否有允许我实现此目的的设置？.net 框架可以自动压缩文件吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T18:25:40.093

您需要将 IIS 元数据库中的 html 扩展配置**为动态压缩扩展**。您可能将其视为静态页面。如果 .js 和 .css 扩展名映射到 aspnet_isapi 它们被视为动态页面。

[metabase.xml](http://www.microsoft.com/technet/prodtechnol/windowsserver2003/library/iis/a0ea8e51-fb2a-4e80-9d5a-7fe3ae246570.mspx)中的设置应如下所示：

```
HcScriptFileExtensions="asp
dll 
exe 
js
css" 
```

如果您之前将扩展名插入到那里，请不要忘记从`HcFileExtensions`（静态文件）中删除扩展名。

*希望这可以帮助。*

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-02-22T04:04:26.933

如果您想对所有文件进行 gzip 压缩（用于具有无扩展 URL 的 Web 服务）怎么办？

# .net - 将文件上传到数据库的最佳实践

> ID：287708
> 
> 赞同：6
> 
> 时间：2008-11-13T17:58:12.877
> 
> 标签：.net, asp.net, database, upload

我正在寻找有关如何从 .NET Web 应用程序创建与数据库的接口以从 Excel 文件上传数据的任何最佳实践或想法我应该使用一种允许加载所有记录并标记错误的机制还是应该我使用一种在发生错误时停止加载的机制。

我以前从来没有处理过这种类型的要求，所以任何帮助都会非常棒！

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-13T18:38:39.770

我会尝试以下过去运作良好的方法。

1.  允许用户上传文件，将其放在磁盘的某个位置。
2.  将文件的结果绑定到某个网格（您可以使用传统的 Connection/Command 对象使用 ODBC/OLE DB 连接到 Excel 文件）。
3.  根据一组业务规则对网格中的行应用验证（excel 数据通常很脏）。
4.  允许用户更新网格中的值并纠正验证问题。
5.  当所有数据都符合要求并且用户对它感到满意时，在事务中执行批量插入。
6.  如果有任何“坏”发生回滚并呈现一些用户反馈。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T18:17:27.550

您应该上传数据，然后在验证检查失败时对其进行标记。对于实际加载数据，您有几个选项：

*   ADO.Net 批量加载 API - 使用批量加载 API 将其放入临时表中。下面的代码片段显示了打开 .CSV 文件并以编程方式将其加载到临时表中的过程。

.

```
 public void Load() {
        bool OK = File.Exists(_filename);
        if (OK) {
            string sql = String.Format("Select * from {0}", FileName);
            OleDbConnection csv = new OleDbConnection();
            OleDbCommand cmd = new OleDbCommand(sql, csv);
            OleDbDataReader rs = null;
            SqlConnection db = null;
            SqlCommand clear = null;

            SqlBulkCopy bulk_load = null;
            try {
                    // Note two connections: one from the csv file
                    // and one to the database;
                    csv = new OleDbConnection();
                    csv.ConnectionString = ConnectionString;
                    csv.Open();
                    cmd = new OleDbCommand(sql, csv);
                    rs = cmd.ExecuteReader();

                    // Dung out the staging table
                    db = // [Create A DB conneciton Here]
                    clear = new SqlCommand("Truncate table Staging", db); // Left to the reader
                    clear.ExecuteNonQuery();

                   // Import into the staging table
                    bulk_load = new SqlBulkCopy(db);
                    bulk_load.DestinationTableName = Destination; // Actually an instance var
                    bulk_load.WriteToServer(rs);
                } catch (Exception ee) {
                    string summary = ee.Message;
                    string detail = ee.StackTrace;
                    //Notify(DisplayType.error, summary, detail);
                } finally {
                    if (rs != null) rs.Close();
                    if (csv != null) csv.Close();
                    if (bulk_load != null) bulk_load.Close();
                }
            }
        } 
```

*   使用 BCP 或 SSIS 直接从电子表格或 .CSV 文件导入它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T18:15:25.497

如果您的数据库中的数据完整性很重要，则不允许导入有错误或不符合您的数据库验证要求的数据。

由于这些是 Excel 文件，用户应该很容易更正 Excel 文件中的数据，而不是尝试使用其他界面来修复数据。只需确保错误消息将用户引导至问题所在的字段并清楚地解释问题所在。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T18:07:05.543

你想把 excel 文件作为 blob 放在数据库中吗？还是您想解析文件并将文件中的记录放入数据库中？

我假设是后者。

作为用户，我希望可以选择知道错误是什么，以便我可以修复它们并重试。我认为我如何重试取决于我上传了多少数据。

我会尝试做一个混合解决方案..如果只有几个错误显示一个屏幕来纠正这些错误，以便用户可以快速继续。如果有大量错误，您应该可以做到并让用户重新尝试。

至于数据库。要么有一个单独的表格供上传，直到它们被检查并获取您的“真实”数据，或者有一个 UploadUniqueId 列，这样您就可以回滚任何上传而不会大惊小怪。

删除表名，其中 UploadUniqueId = 'GUID'

# ruby - 如何使用 Ruby 删除回车？

> ID：287713
> 
> 赞同：79
> 
> 时间：2008-11-13T18:00:41.843
> 
> 标签：ruby, regex

我认为这段代码可以工作，但正则表达式与 \r\n 不匹配。我在十六进制编辑器中查看了我正在读取的数据，并验证文件中确实存在十六进制 D 和十六进制 A 模式。

我也尝试过正则表达式 /\xD\xA/m 和 /\x0D\x0A/m 但它们也不匹配。

这是我现在的代码：

```
 lines2 = lines.gsub( /\r\n/m, "\n" )
   if ( lines == lines2 )
       print "still the same\n"
   else
       print "made the change\n"
   end 
```

除了替代方案之外，很高兴知道我做错了什么（以促进我的一些学习）。:)

* * *

## 回答 #1

> 赞同：178
> 
> 时间：2011-08-17T15:20:39.320

使用[字符串#strip](http://ruby-doc.org/core-2.0.0/String.html#method-i-strip)

> 返回删除前导和尾随空格的 str 副本。

例如

```
"    hello    ".strip   #=> "hello"   
"\tgoodbye\r\n".strip   #=> "goodbye" 
```

* * *

使用 gsub

```
string = string.gsub(/\r/," ")
string = string.gsub(/\n/," ") 
```

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2008-11-13T18:38:45.463

通常，当我处理剥离 \r 或 \n 时，我会通过执行类似的操作来寻找两者

```
lines.gsub(/\r\n?/, "\n"); 
```

我发现根据数据的保存方式（使用的操作系统、使用的编辑器、当时木星与 Io 的关系），回车后可能有也可能没有换行符。您在十六进制模式下看到这两个字符似乎很奇怪。希望这可以帮助。

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2016-02-26T13:07:14.607

如果你使用 Rails，有一个`squish`方法

`"\tgoodbye\r\n".squish => "goodbye"`

`"\tgood \t\r\nbye\r\n".squish => "good bye"`

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2008-11-13T19:03:49.437

当你做的时候你会得到什么`puts lines`？这会给你一个线索。

默认情况下`File.open`以文本模式打开文件，因此您的`\r\n`字符将自动转换为`\n`. 也许这就是`lines`总是等于的原因`lines2`。要防止 Ruby 解析行尾，请使用以下`rb`模式：

```
C:\> 复制 con lala.txt
一种
文件
和
许多
线条
^Z

C:\> irb
irb(main):001:0> text = File.open('lala.txt').read
=> "一个\n文件\n与\n许多\n行\n"
irb(main):002:0> bin = File.open('lala.txt', 'rb').read
=> "一个\r\n文件\r\n与\r\n许多\r\n行\r\n"
irb（主）：003：0>

```

但是从您的问题和代码中，我看到您只需要使用默认修饰符打开文件即可。您不需要任何转换，可以使用较短的`File.read`.

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2012-01-17T08:00:29.460

```
modified_string = string.gsub(/\s+/, ' ').strip 
```

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2008-11-13T18:11:37.017

```
lines2 = lines.split.join("\n") 
```

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2011-12-01T11:45:03.177

`"still the same\n".chomp`
或者
`"still the same\n".chomp!`

[http://www.ruby-doc.org/core-1.9.3/String.html#method-i-chomp](http://www.ruby-doc.org/core-1.9.3/String.html#method-i-chomp)

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-11-13T18:13:11.427

下面的呢？

```
irb(main):003:0> my_string = "Some text with a carriage return \r"
=> "Some text with a carriage return \r"
irb(main):004:0> my_string.gsub(/\r/,"")
=> "Some text with a carriage return "
irb(main):005:0> 
```

或者...

```
irb(main):007:0> my_string = "Some text with a carriage return \r\n"
=> "Some text with a carriage return \r\n"
irb(main):008:0> my_string.gsub(/\r\n/,"\n")
=> "Some text with a carriage return \n"
irb(main):009:0> 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2017-10-05T17:31:45.890

我认为你的正则表达式几乎是完整的 - 这就是我要做的：

```
lines2 = lines.gsub(/[\r\n]+/m, "\n") 
```

在上面，我将 \r 和 \n 放入一个类中（这样它们可能出现的顺序无关紧要）并添加了“+”限定符（这样“\r\n\r\n \r\n" 也将匹配一次，整个内容替换为 "\n")

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2018-02-14T10:28:51.963

只是另一个变体：

```
lines.delete(" \n") 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2011-08-17T22:01:13.763

为什么不以文本模式读取文件，而不是二进制模式？

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2017-08-18T14:36:18.663

```
lines.map(&:strip).join(" ") 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-06-03T15:41:15.873

你可以使用这个：

```
my_string.strip.gsub(/\s+/, ' ') 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-03-22T09:30:50.800

```
def dos2unix(input)
  input.each_byte.map { |c| c.chr unless c == 13 }.join
end

remove_all_the_carriage_returns = dos2unix(some_blob) 
```

# objective-c - OOP：设计菜单系统

> ID：287717
> 
> 赞同：3
> 
> 时间：2008-11-13T18:01:45.913
> 
> 标签：objective-c, model-view-controller, oop

我目前正在尝试为游戏创建一个菜单系统，但无法找到任何真正合理的方式来做到这一点。有几个菜单屏幕，每个屏幕都不重要，所以我想将它们作为单独的类。我遇到的主要问题是在这些菜单屏幕之间传递控制。

我尝试将每个屏幕构建为单例并直接从另一个屏幕调用一个屏幕，即。类似于`[[MainMenu instance] display]`Objective C中的东西。这有点混乱，因为（1）我必须为每个菜单屏幕编写单例样板代码，（2）类相互依赖，有时我必须围绕循环依赖进行编码等等

我考虑过让类完全静态以绕过实例管理（在这种情况下有点额外，因为每个屏幕实际上只有一个实例）。但这看起来也很丑陋，尤其是 Objective C 不得不通过声明它们来“伪造”类变量`static`。

然后我想到了一些“管理器”类来创建实例并传递控制权，但我不确定引入一个额外的类是否能解决问题，特别是如果这个类被命名为 Manager :-)

我应该注意到我*确实*有一个工作系统，只是感觉不太好。我的意思是有一些代码重复，如果我不小心，事情可能会挂起，等等。有任何想法吗？我知道这是未充分说明的，因此讨论可能更像是一场头脑风暴，但无论如何我对这些想法很感兴趣，即使它们不能彻底解决我的问题。

**更新：谢谢大家的想法。我最后做了什么：**

我重新设计了菜单内容（按钮、图形等）以适应一个名为`ScreenView`. 这是一个看起来像这样的通用界面：

```
@protocol ScreenView

- (void) draw;
- (BOOL) handlesPoint: (CGPoint) p;

- (void) appearWithAnimation;
- (void) disappearWithAnimation;
- (BOOL) hasFinishedAnimating;

@optional

- (void) fingerDown;
- (void) fingerUp;

@end 
```

多亏了这个协议，我能够丢弃所有特定的菜单屏幕并创建一个通用菜单屏幕，该菜单屏幕采用子视图列表来显示并处理所有演示文稿，如绘图、转换、事件等。这个通用菜单屏幕并没有太多子类化，因为大多数菜单屏幕都乐于简单地显示子视图列表。这将是 MVC 中的 V。

然后我还创建了一个控制器类来处理某个菜单屏幕的所有事件。（显然是 MVC 中的 C。）根控制器类处理实例管理、菜单之间的转换和其他一些小事情。大多数菜单屏幕都有一个自定义的控制器子类，用于处理来自按钮和其他子视图的事件。

类的数量增加了，但代码更干净，不会重复，更不容易出错。实例管理仍然不完美，但我对设计相当满意。再次感谢所有回答的人。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T19:20:51.917

我学到的体面设计技巧之一总是将数据与代码分开。这将为您的特定问题带来奇迹。

我的意思是菜单项（字符串）和菜单之间的关系应该存储在数组或单独文件中的某个位置（并读入数组）。

然后使用这个数组来实例化所有的菜单类。

一旦你重新编码它以这种方式工作（我已经用菜单完成了这个），你所有的代码都会到位，你也会考虑到 - 90％的菜单代码（每个菜单将不再是它自己的类，只是用自己独特的数据实例化的同一个类。

菜单项的目标也存储在“数据”中（作为方法指针或类实例）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T18:28:18.013

我认为 MenuManager 类将是要走的路。您将有一个 Menu 基类，所有菜单屏幕都从该基类派生，并且管理器将有一个指向当前活动菜单屏幕的指针。例如，它还可以跟踪以前的菜单屏幕，以便在任意菜单屏幕调用中轻松使用菜单屏幕上的后退按钮。也许只需为此使用 std::vector，这样您就不必在返回时重新创建以前的菜单屏幕（这也可以防止输入的信息丢失，例如在带有高级子菜单的选项菜单中）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T18:45:22.253

将菜单的所有内容放入字典，转储到 plist 并根据需要通过菜单屏幕阅读每个内容可能是最简单的方法，但老实说，您应该考虑采用更以 MVC 为中心的方法来解决问题。屏幕应该用于展示数据而不是存储数据。如果您提供数据与视图的清晰分离，问题就会自行解决。

# asp.net - 在 ASP.NET 应用程序中使用 mySql 数据

> ID：287741
> 
> 赞同：3
> 
> 时间：2008-11-13T18:14:03.673
> 
> 标签：asp.net, mysql, apache

我是 ASP 的新手，我想通过使用 .net 2008 和学校的 apache 服务器上的 mySql 数据库为我学校的一个俱乐部编写一个网站来试验它。最好的设置方法是什么，因为我看到了很多将 Web 应用程序连接到 SQL Server 或 Oracle 数据库的选项，但我担心它无法与 mySql 正常工作。

另外，我还能使用 LINQ 查询吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-13T18:18:36.940

获取适用于 ASP.NET 的[MySQL 连接器](http://dev.mysql.com/downloads/connector/net/5.2.html)并像往常一样开始为 MySQL 编码。该连接器在您习惯用于 SQL 或 Oracle 的典型 ADO.NET 结构中为您提供了数据适配器、数据读取器等的所有优势。这样，如果您将来在后端换出东西，您就不必担心换出所有的连接/查询代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T18:18:19.653

看看这个网址： [http ://dev.mysql.com/tech-resources/articles/dotnet/index.html](http://dev.mysql.com/tech-resources/articles/dotnet/index.html)

# javascript - 如何预缓存图像以便使用 javascript 快速查看？

> ID：287750
> 
> 赞同：17
> 
> 时间：2008-11-13T18:17:56.927
> 
> 标签：javascript, html

我有一个网页，我希望用户在将鼠标放在图像的某个部分上时看到新图像。我使用了图像映射。

```
<img src="pic.jpg" usemap="#picmap" />
<map id="picmap" name="picmap"><area shape="rect" coords ="10,20,30,40"
onMouseOver="mouse_on_write('mouse is on spot')"
onMouseOut="mouse_off('mouse is off spot')"
href="http://www....html" target="_blank" />
</map>
<p id="desc"></p> 
```

我在标题中定义了这些函数：

```
 <script type="text/javascript">
 function mouse_off(txt)
    {
    document.getElementById("desc").innerHTML=txt;
    document.p1.src="pic.jpg";
    }
 function mouse_on_write(txt)
    {
    document.getElementById("desc").innerHTML=txt;
    document.p1.src="pic2.jpg";
  </script> 
```

它有效，但速度很慢。当鼠标放在第二张图片上时，需要几秒钟才能出现；我的临时解决方案是大幅减小图像的大小，因为它们很大（2.5mb 现在切换速度很快，但仍然不是无缝的）。 **如何在不降低画质的情况下让图像切换更加无缝？** 再三考虑，我意识到我也可以同时显示两个图像，无论是小比例还是大比例，**鼠标悬停时它们会切换位置；我该怎么做？**这会减少延迟吗？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-11-13T18:27:50.057

您不需要创建任何页面元素，都可以使用 JavaScript 预加载：

```
tempImg = new Image()
tempImg.src="pic2.jpg" 
```

编辑：

如果你有很多图片，你可以使用穷人的多预加载器：

```
preloads = "red.gif,green.gif,blue.gif".split(",")
var tempImg = []

for(var x=0;x<preloads.length;x++) {
    tempImg[x] = new Image()
    tempImg[x].src = preloads[x]
} 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-13T18:57:42.540

使用 sprite 执行此操作是一个很好的解决方案，因为您不必等待加载新图像。精灵通过将两个图像合二为一并在鼠标悬停时更改背景偏移来工作。

您甚至可以改用 CSS，以获得更快的结果。[这里](http://www.alistapart.com/articles/sprites/)有一个很好的教程。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2011-08-09T02:07:00.037

从 Javascript 1.6 开始，这可以在没有任何命名变量的情况下完成：

```
imageList.forEach( function(path) { new Image().src=path } ); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-13T18:50:24.003

您还可以将两个图像放在同一个文件中并上下偏移。如果它应该影响你用鼠标越过的元素，它可能看起来像

```
a {  
  background-image: url(back.png);  
  background-repeat: no-repeat;  
  background-attachment:fixed;  
  background-position: 0 0;
}

a:hover {
  background-image: url(back.png);  
  background-repeat: no-repeat;  
  background-attachment:fixed;  
  background-position: 0 20px;  
} 
```

这样它就可以在没有 javascript 的情况下工作。

如果我正确理解您的情况，您仍然需要 javascript，但是您仍然可以通过这种方式“预加载”图像。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-13T18:23:22.623

您要做的是在幕后预加载图像。

然后，当鼠标悬停时，浏览器将已经在其缓存中拥有该图像，并将非常快速地切换它。

```
function preloadImage(imagePath)
{
    var img = document.createElement('IMG');
    img.src = imagePath;        
}

preloadImage('BigImage'); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-13T19:10:09.830

来自 Diodeus 的巧妙解决方案。但是，除非有充分的理由不这样做，否则您应该真正考虑使用精灵。设置它们需要一些工作，但净效率确实值得。

这种方法是 Steve Souder 的[高性能网站](http://stevesouders.com/hpws/rules.php)中的第一条规则。

**“规则 1 - 减少 HTTP 请求”**

祝好运并玩得开心点。-D。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-13T21:04:45.670

我注意到到目前为止，“预加载”到 .src 并不能在所有浏览器中始终如一地工作 - IE7**仍然**无法弄清楚如何缓存/使用预加载的图像 - 你可以清楚地看到每次你都有一个服务器请求鼠标移到。

我所做的是通过标准 HTML 放置加载所有图像，然后打开和关闭 style.display。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-13T19:02:07.943

使用`display: none;`，然后让 Javascript 将其更改为`display: inline`您想要显示它的时间。这具有额外的优势，即能够将图像准确地放在页面源中您想要的位置，而不必稍后使用 Javascript 添加它。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-13T20:12:39.550

这是我在纯 JavaScript 中的做法：

```
var myImgs = ['path/to/img1.jpg', 'path/to/img2.gif'];

function preload(imgs) {
    var img;
    for (var i = 0, len = imgs.length; i < len; ++i) {
        img = new Image();
        img.src = imgs[i];
    }
}

preload(myImgs); 
```

也就是说，ALassek 关于使用 CSS sprites 的建议是一个很好的建议，如果你有足够的空间去做的话。sprite 的优点有很多：更少的 HTTP 请求，更小的下载大小（通常），在没有启用 JavaScript 的情况下工作。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-13T23:06:46.170

[http://www.filamentgroup.com/lab/update_automatically_preload_images_from_css_with_jquery/](http://www.filamentgroup.com/lab/update_automatically_preload_images_from_css_with_jquery/)

当我们第一次启动实验室时，我们发布了一个 jQuery 插件，它可以自动预加载 CSS 文件中引用的所有图像。我们发现该脚本在开发快速应用程序方面非常有帮助，这些应用程序在我们需要时始终准备好图像。这篇文章描述了对脚本的重大更新，这将使其更容易集成到现有项目中。

# python - Python 的 ConfigParser 每个部分的唯一键

> ID：287757
> 
> 赞同：9
> 
> 时间：2008-11-13T18:20:11.367
> 
> 标签：python, configuration-files

我阅读了[文档](http://docs.python.org/library/configparser.html)的一部分，发现它`ConfigParser`返回了一个部分中选项的键/值对列表。我认为键在一个部分中不需要是唯一的，否则解析器只会返回一个映射。我围绕这个假设设计了我的配置文件架构，然后遗憾地意识到事实并非如此：

```
>>> from ConfigParser import ConfigParser
>>> from StringIO import StringIO
>>> fh = StringIO("""
... [Some Section]
... spam: eggs
... spam: ham
... """)
>>> parser = ConfigParser()
>>> parser.readfp(fh)
>>> print parser.items('Some Section')
[('spam', 'ham')] 
```

然后我回去找到了我*应该*阅读的文档部分：

> 部分通常存储在内置字典中。可以将替代字典类型传递给 ConfigParser 构造函数。例如，如果传递了对其键进行排序的字典类型，则这些部分将在回写时进行排序，每个部分中的键也是如此。

为了保留我现有的配置文件方案（我现在真的很喜欢；），我正在考虑传递一个如上所述的类似映射的对象，它会累积值而不是破坏它们。有没有更简单的方法来防止我缺少的键/值崩溃？而不是制作一个疯狂的适配器（如果`ConfigParser`实现更改可能会破坏）我应该只编写`ConfigParser`它本身的变体吗？

我觉得这可能是我只看到困难解决方案的那些“duh”时刻之一。

**[编辑：]**这是一个更精确的示例，说明我想如何多次使用同一个键：

```
[Ignored Paths]
ignore-extension: .swp
ignore-filename: tags
ignore-directory: bin 
```

我不喜欢逗号分隔列表语法，因为当您将其缩放到多个值时，它很难看；例如，五十个扩展名的逗号分隔列表将不是特别可读。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-13T19:24:23.890

ConfigParser 并非旨在处理此类情况。此外，您的配置文件对我没有意义。

ConfigParser 为每个部分提供了一个类似 dict 的结构，因此当您调用 parser.items(section) 时，我期待与 dict.items() 类似的输出，它只是键/值元组的列表。我从没想过会看到类似的东西：

```
[('spam', 'eggs'), ('spam', 'ham')] 
```

更不用说，您希望以下行为如何？：

```
parser.get('Some Section', 'spam') 
```

这是检索值的预期方式。

如果你想为同一个键存储多个值，我会在你的配置文件中建议这样的东西：

```
[Some Section]
spam: eggs, ham 
```

这在你的代码中：

```
spam_values = [v.strip() for v in parser.get('Some Section', 'spam').split(',')] 
```

当然，这仅适用于本身不包含逗号或处理引号的值。为此，您应该采用更先进的技术（参见[this](https://stackoverflow.com/questions/118096/how-can-i-parse-a-comma-delimited-string-into-a-list-caveat)和[this](https://stackoverflow.com/questions/118458/how-can-i-join-a-list-into-a-string-caveat)）。

编辑：如果您不介意额外的依赖，您可以查看[ConfigObj](http://www.voidspace.org.uk/python/configobj.html)，它本机支持列表作为值类型。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-11-12T08:51:04.050

ConfigParser 的这种缺陷是 pyglet 使用[epydoc 的修补版本来用这种](http://code.google.com/p/pyglet/source/diff?spec=svnffc4fe58bc2179a75d3338aa821eb04649609871&old=95d2cfa3167ddd5ca7eb0cd25c277902370fd7f1&r=ffc4fe58bc2179a75d3338aa821eb04649609871&format=unidiff&path=%2Ftools%2Fepydoc%2Fepydoc%2Fcli.py)[简单格式](http://code.google.com/p/pyglet/source/diff?format=unidiff&path=/tools/epydoc.config&r=ffc4fe58bc2179a75d3338aa821eb04649609871&spec=svnffc4fe58bc2179a75d3338aa821eb04649609871)替换 ConfigParser ini的原因：

```
name: pyglet
url: http://www.pyglet.org/

output: html
target: doc/api/
...    
module: pyglet

exclude: pyglet.gl.gl
exclude: pyglet.gl.agl
exclude: pyglet.gl.lib_agl
exclude: pyglet.gl.wgl
... 
```

如果您不需要部分 - 这种方法可能很有用。

# oracle - Oracle 回滚段和 ADO.NET

> ID：287783
> 
> 赞同：0
> 
> 时间：2008-11-13T18:28:10.837
> 
> 标签：oracle, ado.net, rollbacksegments

我正在使用旧版本的 Oracle (8.something)，我的 ADO.NET 应用程序需要执行一些相当大的事务。大到不会在我们的小回滚段中结束。现在我们也有一个大的回滚段，但默认情况下不使用它。

Oracle 有一个命令可以选择要使用的回滚段 ( `SET TRANSACTION USE ROLLBACK SEGMENT MY_ROLLBACK_SEGMENT`)，但它必须是事务中发出的第一个命令。不幸的是，ADO.NET 似乎在事务开始时发出了一些其他命令，因为在 .BeginTransaction() 之后立即发出此命令会引发有关 SET TRANSACTION 不是第一个命令的错误。

我确信我不是唯一一个面临这个问题的人。你如何解决它或者你将如何解决它？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T11:27:26.677

如果这是“一次性”要求，那么一种解决方案是在您运行事务时将其他回滚段置于离线状态，然后在完成后将它们置于在线状态；

```
ALTER ROLLBACK SEGMENT <name> OFFLINE;

ALTER ROLLBACK SEGMENT <name> ONLINE; 
```

否则使所有回滚段的大小相同。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T22:20:08.277

我无法在 Oracle 8 上对此进行测试，但在较新的版本上，您可以通过发出提交然后更改回滚段来显式启动新事务。

我假设这是一个过程/函数。

```
begin
commit;
SET TRANSACTION USE ROLLBACK SEGMENT UNDOTBS1;
--Your code here
end; 
```

问候 K

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T15:21:55.970

我绝对没有办法对此进行测试，但您可以尝试在设置交易语句之前发出一个保存点，例如

> 保存点 use_big_rbs;
> 
> 设置事务使用回滚段 big_rbs;
> 
> 更新 ...
> 
> ...

# delphi - 在 Delphi 中解析一行的最快方法是什么？

> ID：287789
> 
> 赞同：10
> 
> 时间：2008-11-13T18:30:26.167
> 
> 标签：delphi, parsing, token, pascal

我有一个巨大的文件，我必须逐行解析。速度至关重要。

一行示例：

> ```
> Token-1   Here-is-the-Next-Token      Last-Token-on-Line
>       ^                        ^
>    Current                 Position
>    Position              after GetToken 
> ```

调用 GetToken，返回“Here-is-the-Next-Token”并将 CurrentPosition 设置为令牌最后一个字符的位置，以便为下一次调用 GetToken 做好准备。标记由一个或多个空格分隔。

假设文件已经在内存中的 StringList 中。它很容易放入内存中，比如 200 MB。

我只担心解析的执行时间。什么代码将在 Delphi (Pascal) 中产生绝对最快的执行速度？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-11-13T20:36:23.213

*   使用 PChar 递增来提高处理速度
*   如果不需要某些代币，只需按需复制代币数据
*   实际扫描字符时将 PChar 复制到局部变量
*   将源数据保存在单个缓冲区中，除非您必须逐行处理，即便如此，考虑将行处理作为词法分析器识别器中的单独标记处理
*   如果您确实知道编码，请考虑处理直接来自文件的字节数组缓冲区；如果使用 Delphi 2009，请使用 PAnsiChar 而不是 PChar，除非您当然知道编码是 UTF16-LE。
*   如果您知道唯一的空白将是 #32（ASCII 空间）或类似的有限字符集，则可能有一些巧妙的位操作技巧可以让您使用整数扫描一次处理 4 个字节。不过，我不希望在这里大获全胜，并且代码将像泥浆一样清晰。

这是一个应该非常高效的示例词法分析器，但它假定所有源数据都在一个字符串中。由于非常长的令牌，重新处理它以处理缓冲区是相当棘手的。

```
type
  TLexer = class
  private
    FData: string;
    FTokenStart: PChar;
    FCurrPos: PChar;
    function GetCurrentToken: string;
  public
    constructor Create(const AData: string);
    function GetNextToken: Boolean;
    property CurrentToken: string read GetCurrentToken;
  end;

{ TLexer }

constructor TLexer.Create(const AData: string);
begin
  FData := AData;
  FCurrPos := PChar(FData);
end;

function TLexer.GetCurrentToken: string;
begin
  SetString(Result, FTokenStart, FCurrPos - FTokenStart);
end;

function TLexer.GetNextToken: Boolean;
var
  cp: PChar;
begin
  cp := FCurrPos; // copy to local to permit register allocation

  // skip whitespace; this test could be converted to an unsigned int
  // subtraction and compare for only a single branch
  while (cp^ > #0) and (cp^ <= #32) do
    Inc(cp);

  // using null terminater for end of file
  Result := cp^ <> #0;

  if Result then
  begin
    FTokenStart := cp;
    Inc(cp);
    while cp^ > #32 do
      Inc(cp);
  end;

  FCurrPos := cp;
end; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-13T18:59:09.650

这是一个非常简单的词法分析器的蹩脚实现。这可能会给你一个想法。

请注意此示例的限制 - 不涉及缓冲，没有 Unicode（这是 Delphi 7 项目的摘录）。您可能需要那些在认真的实施中。

```
{ Implements a simpe lexer class. } 
unit Simplelexer;

interface

uses Classes, Sysutils, Types, dialogs;

type

  ESimpleLexerFinished = class(Exception) end;

  TProcTableProc = procedure of object;

  // A very simple lexer that can handle numbers, words, symbols - no comment handling  
  TSimpleLexer = class(TObject)
  private
    FLineNo: Integer;
    Run: Integer;
    fOffset: Integer;
    fRunOffset: Integer; // helper for fOffset
    fTokenPos: Integer;
    pSource: PChar;
    fProcTable: array[#0..#255] of TProcTableProc;
    fUseSimpleStrings: Boolean;
    fIgnoreSpaces: Boolean;
    procedure MakeMethodTables;
    procedure IdentProc;
    procedure NewLineProc;
    procedure NullProc;
    procedure NumberProc;
    procedure SpaceProc;
    procedure SymbolProc;
    procedure UnknownProc;
  public
    constructor Create;
    destructor Destroy; override;
    procedure Feed(const S: string);
    procedure Next;
    function GetToken: string;
    function GetLineNo: Integer;
    function GetOffset: Integer;

    property IgnoreSpaces: boolean read fIgnoreSpaces write fIgnoreSpaces;
    property UseSimpleStrings: boolean read fUseSimpleStrings write fUseSimpleStrings;
  end;

implementation

{ TSimpleLexer }

constructor TSimpleLexer.Create;
begin
  makeMethodTables;
  fUseSimpleStrings := false;
  fIgnoreSpaces := false;
end;

destructor TSimpleLexer.Destroy;
begin
  inherited;
end;

procedure TSimpleLexer.Feed(const S: string);
begin
  Run := 0;
  FLineNo := 1;
  FOffset := 1;
  pSource := PChar(S);
end;

procedure TSimpleLexer.Next;
begin
  fTokenPos := Run;
  foffset := Run - frunOffset + 1;
  fProcTable[pSource[Run]];
end;

function TSimpleLexer.GetToken: string;
begin
  SetString(Result, (pSource + fTokenPos), Run - fTokenPos);
end;

function TSimpleLexer.GetLineNo: Integer;
begin
  Result := FLineNo;
end;

function TSimpleLexer.GetOffset: Integer;
begin
  Result := foffset;
end;

procedure TSimpleLexer.MakeMethodTables;
var
  I: Char;
begin
  for I := #0 to #255 do
    case I of
      '@', '&', '}', '{', ':', ',', ']', '[', '*',
        '^', ')', '(', ';', '/', '=', '-', '+', '#', '>', '<', '$',
        '.', '"', #39:
        fProcTable[I] := SymbolProc;
      #13, #10: fProcTable[I] := NewLineProc;
      'A'..'Z', 'a'..'z', '_': fProcTable[I] := IdentProc;
      #0: fProcTable[I] := NullProc;
      '0'..'9': fProcTable[I] := NumberProc;
      #1..#9, #11, #12, #14..#32: fProcTable[I] := SpaceProc;
    else
      fProcTable[I] := UnknownProc;
    end;
end;

procedure TSimpleLexer.UnknownProc;
begin
  inc(run);
end;

procedure TSimpleLexer.SymbolProc;
begin
  if fUseSimpleStrings then
  begin
    if pSource[run] = '"' then
    begin
      Inc(run);
      while pSource[run] <> '"' do
      begin
        Inc(run);
        if pSource[run] = #0 then
        begin
          NullProc;
        end;
      end;
    end;
    Inc(run);
  end
  else
    inc(run);
end;

procedure TSimpleLexer.IdentProc;
begin
  while pSource[Run] in ['_', 'A'..'Z', 'a'..'z', '0'..'9'] do
    Inc(run);
end;

procedure TSimpleLexer.NumberProc;
begin
  while pSource[run] in ['0'..'9'] do
    inc(run);
end;

procedure TSimpleLexer.SpaceProc;
begin
  while pSource[run] in [#1..#9, #11, #12, #14..#32] do
    inc(run);
  if fIgnoreSpaces then Next;
end;

procedure TSimpleLexer.NewLineProc;
begin
  inc(FLineNo);
  inc(run);
  case pSource[run - 1] of
    #13:
      if pSource[run] = #10 then inc(run);
  end;
  foffset := 1;
  fRunOffset := run;
end;

procedure TSimpleLexer.NullProc;
begin
  raise ESimpleLexerFinished.Create('');
end;

end. 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-13T18:37:57.867

我做了一个基于状态引擎（DFA）的词法分析器。它适用于桌子并且速度非常快。但是有可能更快的选择。

这也取决于语言。一个简单的语言可能有一个聪明的算法。

该表是一个记录数组，每个记录包含 2 个字符和 1 个整数。对于每个标记，词法分析器从位置 0 开始遍历表：

```
state := 0;
result := tkNoToken;
while (result = tkNoToken) do begin
  if table[state].c1 > table[state].c2 then
    result := table[state].value
  else if (table[state].c1 <= c) and (c <= table[state].c2) then begin
    c := GetNextChar();
    state := table[state].value;
  end else
    Inc(state);
end; 
```

它很简单，就像一个魅力。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-14T10:59:04.783

如果速度至关重要，那么自定义代码就是答案。查看将文件映射到内存的 Windows API。然后，您可以只使用指向下一个字符的指针来做标记，根据需要前进。

这是我进行映射的代码：

```
procedure TMyReader.InitialiseMapping(szFilename : string);
var
//  nError : DWORD;
    bGood : boolean;
begin
    bGood := False;
    m_hFile := CreateFile(PChar(szFilename), GENERIC_READ, 0, nil, OPEN_EXISTING, 0, 0);
    if m_hFile <> INVALID_HANDLE_VALUE then
    begin
        m_hMap := CreateFileMapping(m_hFile, nil, PAGE_READONLY, 0, 0, nil);
        if m_hMap <> 0 then
        begin
            m_pMemory := MapViewOfFile(m_hMap, FILE_MAP_READ, 0, 0, 0);
            if m_pMemory <> nil then
            begin
                htlArray := Pointer(Integer(m_pMemory) + m_dwDataPosition);
                bGood := True;
            end
            else
            begin
//              nError := GetLastError;
            end;
        end;
    end;
    if not bGood then
        raise Exception.Create('Unable to map token file into memory');
end; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-13T18:43:13.910

我认为最大的瓶颈总是将文件放入内存。一旦你把它放在内存中（显然不是一次全部，但如果我是你，我会使用缓冲区），实际的解析应该是微不足道的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-13T19:45:14.580

这引出了另一个问题——有多大？给我们一个线索，比如 # of lines 或 # 或 Mb (Gb)？然后我们会知道它是否适合内存，是否需要基于磁盘等。

在第一次通过时，我会使用我的 WordList(S: String; AList: TStringlist);

然后您可以将每个令牌作为 Alist[n]... 访问或对它们进行排序或其他。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-13T21:12:11.380

解析后，速度将始终与您正在执行的操作相关。到目前为止，词法解析器是从文本流转换为标记的最快方法，无论大小如何。类单元中的 TParser 是一个很好的起点。

就我个人而言，我需要编写一个解析器已经有一段时间了，但另一种更过时但经过尝试和真正的方法是使用 LEX/YACC 来构建一个语法，然后让它将语法转换成你可以用来执行你的处理的代码。 [DYacc](http://www.geocities.com/robertzierer/Tools.html)是一个 Delphi 版本……不确定它是否仍然可以编译，但如果你想做老派的事情，值得一看。如果你能找到一本，这里的[龙书](http://en.wikipedia.org/wiki/Principles_of_Compiler_Design)会有很大帮助。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-13T18:36:55.640

自己滚动肯定是最快的方法。有关此主题的更多信息，您可以查看[Synedit 的源代码](http://synedit.sourceforge.net/)，其中包含市场上任何语言的词法分析器（在项目上下文中称为荧光笔）。我建议您以其中一个词法分析器为基础并根据自己的用途进行修改。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-13T18:56:09.017

**编写**代码的最快方法可能是创建一个 TStringList 并将文本文件中的每一行分配给 CommaText 属性。默认情况下，空格是分隔符，因此每个标记将获得一个 StringList 项。

```
MyStringList.CommaText := s;
for i := 0 to MyStringList.Count - 1 do
begin
  // process each token here
end; 
```

不过，您可能会通过自己解析每一行来获得更好的性能。

# database-design - 数据库中的多值属性

> ID：287794
> 
> 赞同：9
> 
> 时间：2008-11-13T18:32:06.617
> 
> 标签：database-design

应该如何设计关系数据库来处理多值属性？

**编辑**：详细说明：

我可以想到两种方法来做到这一点 -

1.  尝试将逗号分隔的值放在字段中，这看起来有点笨拙。
2.  为该字段创建另一个表，并让多个值转到该字段。如果我有太多此类字段，这可能会导致大量表。

问题是：

1.  还有其他处理方法吗？
2.  以上两种方法一般用哪一种？

提前致谢

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-13T18:47:18.457

在传统的关系数据库设计中，每一行和每一列只能存储一个值。

不要存储逗号分隔的列表或任何类似的古怪内容。

例如，假设一个运动队有七名成员。你可以这样做：

```
CREATE TABLE team (
  team_id      INT PRIMARY KEY,
  team_name    VARCHAR(50),
  team_members VARCHAR(200)
);
INSERT INTO team VALUES (1,'Dwarfs', 'Sleepy,Dopey,Sneezy,Happy,Grumpy,Doc,Bashful') 
```

但最好这样做：

```
CREATE TABLE team (
  team_id      INT PRIMARY KEY,
  team_name    VARCHAR(50),
);
INSERT INTO team (team_name) VALUES ('Dwarfs');

CREATE TABLE team_members (
  team_id      INT,
  member_name  VARCHAR(20),
  FOREIGN KEY (team_id) REFERENCES team(team_id)
);
INSERT INTO team_members VALUES 
  (LAST_INSERT_ID(), 'Sleepy'),
  (LAST_INSERT_ID(), 'Dopey'),
  (LAST_INSERT_ID(), 'Sneezy'),
  (LAST_INSERT_ID(), 'Happy'),
  (LAST_INSERT_ID(), 'Grumpy'),
  (LAST_INSERT_ID(), 'Doc'),
  (LAST_INSERT_ID(), 'Bashful'); 
```

**注意：** `LAST_INSERT_ID()`是一个 MySQL 函数。其他品牌的数据库中也有类似的解决方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T18:43:43.847

关系是一对多还是多对多？对于一对多的关系，我建议在子表（多个）中使用一个外键来引用父表（一个）。如果是多对多关系，那么您最好的选择很可能是一个单独的表，其中包含对父母和孩子的外键。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T18:48:08.580

在这里阅读[http://dev.mysql.com/tech-resources/articles/intro-to-normalization.html](http://dev.mysql.com/tech-resources/articles/intro-to-normalization.html)关于第一（1NF），第二（2NF）和第三（3NF）数据库设计的正常形式。3NF以上的形式较多，但通常3NF就足够了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-09-09T19:21:41.547

如果您仅限于使用严格的关系数据库，那么您需要将这些值作为行存储在表中。这就是你的问题——如何使用关系数据库来做到这一点。但是，有许多数据库可以在一个字段中提供多个值的本地存储，结果证明这与许多现实世界的数据非常匹配，易于编程，并且更易于理解（没有你得到的表的爆炸式增长）第三范式）。有关详细信息，请参阅[http://en.wikipedia.org/wiki/MultiValue](http://en.wikipedia.org/wiki/MultiValue) [http://en.wikipedia.org/wiki/IBM_U2](http://en.wikipedia.org/wiki/IBM_U2) [http://en.wikipedia.org/wiki/InterSystems](http://en.wikipedia.org/wiki/InterSystems)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2020-04-23T19:25:58.687

有两种可能的方法 -

1.  **关系**：为实体的一个属性存储多个值是通过引用的键-外键关系完成的。有关更多信息，请查看[此](https://lists.mysql.com/mysql/59610)。
2.  **Set**：mysql 中的一种标量数据类型，可以有零个或多个值，每个值都必须从创建表时指定的允许值列表中选择。有关更多信息，请查看[此](https://dev.mysql.com/doc/refman/8.0/en/set.html)链接和[此](https://lists.mysql.com/mysql/59403)链接。

# internet-explorer - 是什么让 IE 6 和 7 报告“操作中止”？

> ID：287797
> 
> 赞同：2
> 
> 时间：2008-11-13T18:32:57.050
> 
> 标签：internet-explorer, http, http-headers, response

最近，我编写的一个应用程序开始无法在 Internet Explorer 上运行。底层（ruby on rails）代码没有变化。

在 IE 6 或 IE 7 中，我可以向应用程序发出一个请求（HTTP Post），但是当我尝试发出第二个请求时，我收到“操作中止”消息。在 Firefox 中一切正常。HTTP 请求和响应标头完全相同。正确和错误结果的响应标头都具有相同的内容长度（大约 104k）。正确的响应有完整的内容，但不正确的响应在大约 40k 之后内容被截断。（所以大约 65k 的响应消失了。）

更棘手的是，如果我使用 IP 地址而不是域名来发出请求，一切都会很好。

这是一个 apache2 网络服务器。

有任何想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-13T18:46:04.263

我找到了这篇 Microsoft 支持文章：

[BUG：在 Internet Explorer 中访问网页或与 Web 应用程序交互时出现错误消息：“操作中止”](http://support.microsoft.com/?scid=kb;en-us;927917&x=9&y=18)

> **症状**
> 
> 当您访问网页或与 Web 应用程序交互时，您会收到一个 Internet Explorer 对话框，其中包含以下错误消息： Internet Explorer 无法打开 Internet 站点`http://<Web site>.com`。行动取消。
> 
> **原因**
> 
> 出现此问题的原因是子容器 HTML 元素包含试图修改子容器的父容器元素的脚本代码。脚本代码尝试通过使用 innerHTML 方法或 appendChild 方法来修改父容器元素。
> 
> **解决方法**
> 
> 要解决此问题，请编写仅修改封闭容器或仅修改脚本的直接容器元素的脚本块。为此，您可以使用占位符关闭目标容器，也可以将脚本块移动到要修改的容器中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T18:37:11.020

您可以尝试使用[Fiddler](http://www.fiddlertool.com/)调试问题。它是 Internet Explorer 的免费 HTTP 代理工具。

它列出了请求和响应的每个细节。也许您可以在检查整个 HTTP 流量时看到该行为的实际原因。

*希望这可以帮助！*

[替代文字 http://i.msdn.microsoft.com/Bb250446.ie_introfiddler_fig04(en-us,VS.85).gif](http://i.msdn.microsoft.com/Bb250446.ie_introfiddler_fig04(en-us,VS.85).gif)

# .net - 仅提交一个实体的更改

> ID：287800
> 
> 赞同：2
> 
> 时间：2008-11-13T18:34:28.407
> 
> 标签：.net, linq-to-sql, .net-3.5

如果我从一个带有 DataContext 实例的表中选择多行。然后我是否对行中的属性进行了一些更改，我可以只为选定的行之一提交对数据库的更改吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T19:34:03.073

是的你可以。

首先，您需要隔离要撤消更改的实体。然后，您可以使用 DataContext 类使用数据库中的值覆盖这些实体。

```
MyEntity e1, e2, e3 // changed entities
...
// keep the changes only for e3
List<MyEntity> undoList = new List<MyEntity>();
undoList.Add(e1);
undoList.Add(e2);
myDataContext.Refresh(RefreshMode.OverwriteCurrentValues, undoList);

myDataContext.SubmitChanges(); 
```

**编辑：**

您可以像这样跟踪 DataContext 中所有更改的对象：

```
MyEntity changedEntityToSubmit; // first you need to know what is the entity you need to submit.
List<object> allChangedEntities = new List<object>(myDataContext.GetChangeSet().Updates);
allChangedEntities.Remove(changedEntityToSubmit);

myDataContext.Refresh(RefreshMode.OverwriteCurrentValues, allChangedEntities);

myDataContext.SubmitChanges(); 
```

此代码仅考虑更新。您可能还需要考虑插入和删除中的更改。这取决于你。

# java - Java <-> 非小程序的 Javascript？

> ID：287811
> 
> 赞同：3
> 
> 时间：2008-11-13T18:39:13.170
> 
> 标签：java, javascript, applet

我正在使用现有的 Java 代码库，虽然可以使用 <APPLET> 标记从 HTML 页面调用它，但它实际上并不子类化 Applet 类。相同的 jars 也用于非浏览器上下文，因此它们没有子类化 Applet。

现在我需要将一些值从 Java 传回调用页面的 Javascript。通常人们会使用 JSObject 来做到这一点，但就我而言，必须使用仅适用于 Applet 子类的 JSObject.getWindow。

是否有：

*   一种从不是 Applet 子类的东西中使用 JSObject 的方法？
*   与调用页面的 Javascript 进行通信的其他机制？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T18:46:17.367

在小程序中调用`JSObject.getWindow(this)`。然后以通常的方式将其传递`JSObject`到需要它的代码中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T22:56:36.940

我认为您实际上需要在 jar 文件中实现一个小程序来处理代码与浏览器本身之间的通信。也许只是将非applet jar 用作类库，并使applet jar 成为一个简单的包装器，代理您在浏览器和Java 代码之间的调用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-14T05:06:43.310

返回值有什么问题？

从 Javascript 您可以使用 getElementById("id-of-embed-tag") 访问 Java 对象。然后，您可以调用该对象上的任何公共方法。该方法返回的 Java 对象将可用于您的 Javascript 代码。

# paypal - 如何为我的网站收取经常性的月度订阅费？

> ID：287813
> 
> 赞同：6
> 
> 时间：2008-11-13T18:40:15.850
> 
> 标签：paypal, google-checkout, recurring-billing

我的公司正在使用 PayPal 和 Google checkout 设置在线结算。我正在寻找为我的网站收取定期每月服务费的最佳方式。我的网站是基于订阅的，我每月收取 X 美元。我想每月向客户的信用卡收取月费。该网站的订阅者在注册时知道这是持续的每月服务费。

我正在寻找最快、最简单、最好、最可靠的方式来收取这笔经常性费用。我希望月费只显示在他们的月度信用卡对帐单上，就像我使用的许多服务（如 Slicehost）一样。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-07-12T12:05:31.887

注意：Google checkout 现在确实支持定期付款——他们刚刚实施了！

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-13T18:52:37.183

Google Checkout 目前不支持定期计费，但它位于他们的[功能建议](http://checkout.google.com/support/sell/bin/request.py?contact_type=suggest)页面上。

PayPal手动或通过其 API支持[定期付款。](https://www.paypal.com/IntegrationCenter/ic_recurringpayments.html)

我强烈推荐使用 PayPal 的 API，因为它简单明了，有据可查，而且您可以使用[PayPal 的开发人员站点](https://developer.paypal.com)轻松地在非生产站点上测试所有内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-09-18T10:58:05.070

Goole Checkout 现在支持 beta 模式下的“经常性费用和订阅”

[谷歌网站上](http://support.google.com/checkout/sell/bin/answer.py?hl=en&answer=63440)有更多信息

# python - 类中的字典和 Lambda？

> ID：287823
> 
> 赞同：3
> 
> 时间：2008-11-13T18:44:08.463
> 
> 标签：python, lambda

我该怎么做这样的事情：

```
class Foo():
 do_stuff = { 
            "A" : lambda x: self.do_A(x),
            "B" : lambda x: self.do_B(x)
        }
def __init__(self):
    print "hi"

def run(self):
    muh = ['A', 'B', 'A']
    for each in muh:
        self.do_stuff[each](each)

def do_A(self, moo):
    print "A"

def do_B(self, boo):
    print "B"

if(__name__ == '__main__'):
aFoo = Foo()
aFoo.run() 
```

这导致它给出一个错误，即 self 没有在 lambda 函数中定义，但是如果我删除它。它说 do_A 或 do_B 没有定义。

*编辑*

我设法弄清楚了。我需要将 lambda 表达式更改为如下所示：

```
lambda x, y: x.do_A(y) 
```

我会这样称呼它：

```
self.do_stuff[each](self, each) 
```

这是一个可怕的想法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-13T18:56:32.683

do_stuff 在您的示例中不是实例变量。它更像是一个静态变量。您需要在引用 self 的方法（例如**init**方法）中定义 do_stuff 以使其成为实例变量。我希望这个例子能为你澄清一些事情：

```
class Foo:

  def __init__(self):
    self.do_stuff = { "A": self.do_A, "B": self.do_B }

  def run(self):
    for x in ["A", "B"]:
      self.do_stuff[x]("hi")

  def do_A(self, x):
    pass

  def do_B(self, x):
    pass 
```

请注意，lambda 函数不是必需的。您可以将对函数本身的引用存储在字典中。符号“self.do_A”将自动将 self 作为第一个参数传递。

编辑：有谁知道如何在非代码示例文本中正确显示下划线？
编辑：WTH？预览显示的下划线与帖子不同。

# c# - c#中如何使用libFLAC读取FLAC标签

> ID：287828
> 
> 赞同：2
> 
> 时间：2008-11-13T18:45:42.487
> 
> 标签：c#, pinvoke

libFLAC 库是否有 .net c# 包装器？如果没有，我如何在 .net 框架 c# 应用程序中使用 libFLAC 读取 FLAC 标签？如果两者都没有，是否有其他开源库可以读取 c# 中的 flac 标签？

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-13T19:00:26.980

有[一篇关于 CodeProject 的文章](http://www.codeproject.com/KB/audio-video/cyber_sinh.aspx)可能对您有用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2016-07-20T16:09:46.367

我知道我迟到了，但如果有人想要这些具体信息，这里是 Wayback 机器的链接：

[http://web.archive.org/web/20140122195044/http://www.codeproject.com/Articles/15332/Assembly-to-Read-and-Write-Ogg-Tags-Vorbis-FLAC-an](http://web.archive.org/web/20140122195044/http://www.codeproject.com/Articles/15332/Assembly-to-Read-and-Write-Ogg-Tags-Vorbis-FLAC-an)

根据 StackOverflow 规则，如果上面的链接丢失，这里是文章的文本和图形，由 MetatOGGer、LyricWiki 和 Xiph 媒体编码器的开发者“Cyber​​ Sinh”提供：

> 对于我的免费软件项目 MetatOGGer，我需要一个托管库来读取和写入 Ogg 和 FLAC 流中包含的标签。由于找不到，我决定自己写一个。
> 
> 该库支持的编解码器包括 Vorbis、FLAC 和 Speex。也可以使用这个库获得有关 Ogg 和 FLAC 文件的技术信息。
> 
> 文本标签将存储在一个中，`SortedList<string, List<string>>`因为您可以有几个相同的标签，例如“艺术家”等。图片标签将存储在一个`ID3PictureFrame`带有`BitmapFrame`属性的集合中（Windows Imaging Component）。
> 
> `OggPageReader`可以使用该类读取 Ogg 流中的任何原始数据。
> 
> `OggTagger`和的使用`FlacTagger`非常简单。源代码有完整的文档（法语）。这是主要类的图表：
> 
> ![类图](https://i.stack.imgur.com/Buu0A.png)

主要代码片段：

```
using Luminescence.Xiph;
OggTagger ogg = new OggTagger(@"C:\Song.ogg");

// Load duration
DateTime time = new DateTime(0);
time = time.AddSeconds(ogg.Duration);

// Tags manipulation
string artist = ogg.Artist;
ogg.Title = "Creep";
SortedList<string, List<string>> tags = ogg.GetAllTags();
BitmapFrame cover = ogg.FlacArts[0].Picture; 
```

# regex - 有没有办法在 ASP/VBScript 中使用 RegEx？

> ID：287830
> 
> 赞同：0
> 
> 时间：2008-11-13T18:46:00.363
> 
> 标签：regex, asp-classic, vbscript

我有一个 ASP 网站，我需要向其中添加 RegEx 匹配项。ASP/VBScript 中是否支持 RegEx？

谢谢，

布雷特

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T18:55:13.713

是的，从 VBScript 5 [http://authors.aspalliance.com/brettb/VBScriptRegularExpressions.asp](http://authors.aspalliance.com/brettb/VBScriptRegularExpressions.asp)

[http://www.regular-expressions.info/vbscript.html](http://www.regular-expressions.info/vbscript.html)

# html - 简单的 HTML 下划线

> ID：287832
> 
> 赞同：5
> 
> 时间：2008-11-13T18:46:09.583
> 
> 标签：html

我正在创建一个将打印的 HTML 表单，其中包含需要由收件人写入的字段。基本上我想要的是从字段标签的末尾延伸到页面侧面的单行。这是我现在的做法：

```
<table width="100%">
    <tr>
        <td width="1%">
            Label:
        </td>
        <td style="border-bottom-style:solid; border-bottom-width:1px;">
            &nbsp;
        </td>
    </tr>
</table> 
```

这可行，但必须有一种更简单的方法来做到这一点，而不需要整个表格元素。有任何想法吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-13T18:49:35.847

这是我的CSS：

```
span.print_underline
{
    display: inline-block;
    height: 1em;
    border-bottom: 1px solid #000;
} 
```

因此，您的 HTML 将如下所示：

```
<span class="print_underline" style="width: 200px">&nbsp;</span> 
```

我留下了宽度，所以我可以尽可能多地重复使用它，但你可以指定宽度。

作为旁注，我使用 div 标签而不是 span 标签测试了相同的概念，但它在某些情况下不起作用。这可能是因为将 div 放在段落标记中在语义上是不正确的（这就是我使用 span 的原因），而且我通常使用段落标记而不是像您使用的那样使用表格行。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-13T18:56:42.230

我认为您的解决方案比迄今为止的响应要好。关于您的解决方案，我唯一要改变的是我将使用 css 类而不是内联。

您的解决方案将比使用跨度更好地对齐。您的代码使用表格元素看起来比使用跨度更干净。

此外，您可能需要考虑在单元格中放置一个文本框，以便您的用户可以在打印之前直接在页面上输入信息。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-13T18:47:35.243

使用 span 标签怎么样？

```
<span style="border-bottom....">Text</span> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-13T18:53:32.423

只需在左侧有一个适当边距的 div。默认情况下，块元素总是扩展为全宽。

意义：

```
标签 {
    向左飘浮;
}

分区 {
    左边距：10em；
    边框底部：1px 纯黑色；
    高度：1em；
}

```

`<label>label:</label>`

`<div></div>`

它不会拉伸标签和右侧之间的整个宽度，但您可以让标签隐藏底部边框（使用背景颜色或其他东西）并让 div 一直向右扩展（没有利润）。

如果您想要正确的语义，您甚至可以使用输入而不是 div，将其显示设置为“块”并修复边框和背景。

# visual-studio - 如何将虚拟机集成到 Visual Studio 中的自动化单元测试中？

> ID：287834
> 
> 赞同：0
> 
> 时间：2008-11-13T18:46:27.150
> 
> 标签：visual-studio, unit-testing, virtualization

我有一些遗留软件，我想参与自动化单元测试（用于测试网络协议兼容性），因为这个软件很旧并且在过时的环境中运行，我想将它封装在虚拟机中。从 Visual Studio 单元测试控制虚拟机的最佳方法是什么？一旦我配置了 vm 并正确保存了状态，我将需要能够启动和停止 vm，并可能在 vm on 命令中启动一些程序。

我确实有一个考虑因素是，如果开发人员不打算运行此测试，我希望他们不必下载 vm 映像。因此，单元测试可能还必须处理从某个位置下载最新的 vm 映像。我们的约定是使用特殊描述标记长时间运行的测试，以便开发人员能够在积极开发期间排除此测试。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T19:02:27.960

虚拟机平台提供了一个脚本 API，让您可以从命令行控制 VM。提供了[VMware 服务器文档](http://www.vmware.com/support/pubs/sdk_pubs.html)和有关[Hyper-V 脚本](http://www.microsoft.com/emea/spotlight/sessionh.aspx?videoid=998)的视频。

您需要在构建脚本中包含一些逻辑来决定是否应该执行 VM 代码，或者只是检查开发人员机器上是否存在 VM。

您可能需要查看一些 NAnt 和 MSBuild 任务存储库以获取与 VM 相关的任务，以简化此操作。

# database-design - 如何在基于标签的组织中定义结构？

> ID：287839
> 
> 赞同：4
> 
> 时间：2008-11-13T18:47:56.520
> 
> 标签：database-design, data-structures, tags, entity-relationship, entity-attribute-value

[原标题：有没有办法在基于标签的组织方法上强制建立关系结构？]

我有一些实体，它们有一系列属性。某些属性会影响实体可以具有的其他属性，许多属性被组织成组，并且有时实体需要具有来自某些组的特定数量的属性，或者可能具有来自某些组的一系列属性。

有没有办法使用数据库对这些标签到标签的关系进行建模，例如需求、分组、排除等，或者这只能通过编程的“业务规则”实现？理想情况下，我希望可能的标签及其关系易于配置，因此非常灵活。

我考虑的一种方法是拥有标签和可能的关系，然后你会得到一个标签-标签应用关系类型的表格，但这似乎是一种相当脆弱的方法。

那么，这是否可能以更严格的方式进行？如果可以，我将如何开始呢？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T19:36:04.787

**编辑**：您对仅根据其他属性中的值适用的变量属性的描述是非关系的、非规范化的设计。RDBMS 可能不是存储此类数据的最佳解决方案。对于需要这种级别的灵活性的数据，RDF 可能是一个很好的解决方案。

我之前关于 RDBMS 解决方案的回答如下：

* * *

有些人使用[Entity-Attribute-Value](http://en.wikipedia.org/wiki/Entity-attribute-value_model)设计对灵活的属性进行建模，但这通常过于非结构化，您最终会遇到数据完整性问题。仅当您需要几乎无限数量的实体子类型时才使用此选项。

其他人使用[Single Table Inheritance](http://en.wikipedia.org/wiki/Single_Table_Inheritance)，您将所有子类型使用的所有属性列放入一个非常宽的表中，并在属性与子类型无关的行上将它们保留为 NULL。但这有限制，因为表可能会变得太宽，并且您无法强制任何属性，因为它们都必须可以为空。

如果您的实体子类型数量相对较少，我建议为每组必需属性创建一个依赖表。将依赖表的主键定义为父表的外键，从而获得一对一的关系。

```
CREATE TABLE Vehicles (
  vehicle_id INT PRIMARY KEY
  ...attributes common to all vehicles...
);

CREATE TABLE Automobiles (
  vehicle_id INT PRIMARY KEY,
  ...attributes specific to autos...
  FOREIGN KEY (vehicle_id) REFERENCES Vehicles(vehicle_id)
); 
```

您还可以通过在父表的主键中编码子类型来提供更多的数据完整性。这是为了确保 row in`Automobiles`不能引用 in 中的摩托车`Vehicles`。

```
CREATE TABLE Vehicles (
  vehicle_id INT,
  vehicle_type VARCHAR(10),
  ...attributes common to all vehicles...
  PRIMARY KEY (vehicle_id, vehicle_type),
  FOREIGN KEY (vehicle_type) REFERENCES VehicleTypes (vehicle_type)
);

CREATE TABLE Automobiles (
  vehicle_id INT,
  vehicle_type VARCHAR(10) CHECK (vehicle_type = 'Automobile'),
  ...attributes specific to autos...
  FOREIGN KEY (vehicle_id, vehicle_type) 
    REFERENCES Vehicles(vehicle_id, vehicle_type)
); 
```

当然，每次定义新的子类型时都需要创建一个新的依赖表，但是这种设计确实为您提供了更多的结构来强制数据完整性、NOT NULL 属性等。

您需要在应用程序逻辑中强制执行的唯一部分是确保为= 'Automobile'中的`Automobiles`每一行创建一行。`Vehicles``vehicle_type`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-21T06:32:05.410

使用数据库来执行您的规则或在其他地方使用源代码之间没有区别。代码就是数据。这就是深奥的 Lisp 答案。

您要问的真正问题是，这在关系数据库中还是在（我假设）Algol 家族语言中更容易。您没有指定 RDBMS，所以我将假设为 ANSI。这使得这很难。

顺便说一句，这在 Prolog 中很容易。但这既不是这里也不是那里。

我会说对所有事情都使用检查约束。这种方法所需的精神转变是意识到您的 UI 将需要一种方法来定义这些标签关系。传统上，您会从 UI 向 DB 发出 CRUD 语句。相反，您需要向 CRUD 检查约束发出 ALTER TABLE 语句。

这种方法有两个问题：

*   这样的语句在大多数 RDBMS 中是不可参数化的。想想 SQL 注入。
*   实现在对完整 ANSI 检查约束的支持方面有所不同。如果不支持子查询，请忘记它。

如果您可以使用特定的 RDBMS 来澄清您的问题，那么我们可以为您提供更好的答案。

# .net - StringBuilder.Replace() 是否比 String.Replace 更有效？

> ID：287842
> 
> 赞同：30
> 
> 时间：2008-11-13T18:48:46.973
> 
> 标签：.net, string, stringbuilder

如果您必须使用 String.Replace() 替换 test 50 次，那么您实际上必须创建一个新字符串 50 次。StringBuilder.Replace() 这样做更有效吗？例如，如果我要替换大量文本，我是否应该使用 StringBuilder，即使我不会向它附加任何数据？

我正在使用 .NET，但我认为这与 Java 和可能的其他语言相同。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-11-13T18:58:13.427

这正是 StringBuilder 的用途——重复修改同一个文本对象——它不仅用于重复连接，尽管这似乎是它最常用的用途。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-13T18:58:42.490

这取决于替换的大小是否[大于替换的字符串。](http://bytes.com/forum/thread354659.html)

StringBuilder**过度分配其缓冲区**，而字符串只保存其中的字符数。

StringBuilder.Capacity 属性是缓冲区将容纳多少个字符，而 StringBuilder.Length 是正在使用的字符数。

通常，您应该将 StringBuilder.Capacity 设置为大于预期结果字符串的值。否则 StringBuilder 将需要重新分配其缓冲区。**当 StringBuilder 重新分配它的缓冲区时，它的 size 会加倍**，这意味着在几次重新分配之后，它可能会比它需要的大得多，默认容量从 16 开始。

通过在启动时设置容量值（例如在构造函数中），您可以保存 StringBuilder 缓冲区的重新分配。您可以使用 StringBuilder.MaxCapacity 来限制 StringBuilder 可以扩展到的最大容量。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-13T18:51:09.010

是的。`String.Replace`总是创建一个新字符串——`StringBuilder.Replace`不会。

# python - 在 Python 中，如何有效地管理脚本文件之间的引用？

> ID：287845
> 
> 赞同：6
> 
> 时间：2008-11-13T18:49:03.133
> 
> 标签：python, scripting, metadata

我有相当多的 Python 脚本，其中包含其他 Python 脚本使用和引用的可重用代码。但是，这些脚本往往分散在不同的目录中，我发现必须在我的顶级脚本中包含（通常是多次）对 sys.path.append 的调用有点乏味。我只想在同一脚本中提供没有附加文件引用的“导入”语句。

目前，我有这个：

```
import sys
sys.path.append('..//shared1//reusable_foo')
import Foo
sys.path.append('..//shared2//reusable_bar')
import Bar 
```

我的偏好如下：

```
import Foo
import Bar 
```

我的背景主要是 .NET 平台，所以我习惯于使用元文件（如 *.csproj、*.vbproj、*.sln 等）来管理和包含源文件之外的实际文件路径引用。这允许我只提供“使用”指令（相当于 Python 的导入）而不暴露所有引用并允许在多个脚本中重用路径引用本身。

Python 是否对此有同等的支持，如果没有，有哪些技术和方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T19:02:41.780

简单的答案是将您的可重用代码放在您的站点包目录中，该目录位于您的 sys.path 中。

您还可以通过在路径中的某处添加 .pth 文件来扩展搜索路径。有关更多详细信息，请参阅[https://docs.python.org/2/install/#modifying-python-s-search-path](https://docs.python.org/2/install/#modifying-python-s-search-path)

哦，python 2.6/3.0 增加了对 PEP370、[Per-user site-packages Directory 的支持](http://docs.python.org/whatsnew/2.6.html#pep-370-per-user-site-packages-directory)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-13T19:02:27.523

如果您的可重用文件被打包（也就是说，它们包含一个`__init__.py`文件）并且该包的路径是您的 PYTHONPATH 或 sys.path 的一部分，那么您应该能够做到

```
import Foo 
```

[这个问题](https://stackoverflow.com/questions/279237/python-import-a-module-from-a-folder#279287)提供了更多细节。

（注意：正如 Jim 所说，您也可以将可重用代码放到您的`site-packages`目录中。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T20:15:37.267

您可以将可重复使用的东西放入`site-packages`. 这是完全透明的，因为它是`sys.path`默认的。

您可以将`someName.pth`文件放入`site-packages`. 这些文件具有实际可重用内容所在的目录。这也是完全透明的。并且不涉及安装更改的额外步骤`site-packages`。

您可以将可重用的东西的目录放在`PYTHONPATH`. 这有点不透明，因为您必须确保它已设置。不是火箭科学，但也不是完全透明的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T20:27:56.273

在一个项目中，我想确保用户可以将 python 脚本（基本上可以用作插件）放在任何地方。我的解决方案是将以下内容放入该项目的配置文件中：

```
[server]
PYPATH_APPEND: /home/jason:/usr/share/some_directory 
```

这样，这将在程序启动时将 /home/jason 和 /usr/share/some_directory 添加到 python 路径。

然后，只需用冒号分割字符串并将这些目录添加到 sys.path 的末尾即可。您可能需要考虑将一个模块放在 site-packages 目录中，该目录包含一个读取该配置文件的函数并将这些目录添加到 sys.path （不幸的是，我目前没有时间编写示例） .

正如其他人所提到的，最好将尽可能多的内容放入站点包并使用 .pth 文件。但是，如果您有一个脚本需要导入一堆不在您不想从其他脚本导入的站点包中的东西，那么这可能是一个好主意。

（也可能有一种方法可以使用 .pth 文件来执行此操作，但我喜欢能够在放置其余配置信息的同一位置操作 python 路径）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-14T00:43:32.980

最简单的方法是设置（或添加到）PYTHONPATH，并将您的模块和包放入（或符号链接）到 PYTHONPATH 中包含的路径中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-14T01:08:06.723

我的解决方案是打包一个可以导入模块的实用程序：my_util 在站点包中

```
import my_util

foo = myutil.import_script('..//shared1//reusable_foo')
if foo == None:
    sys.exit(1)

def import_script(script_path, log_status = True):
    """
    imports a module and returns the handle
    """
    lpath = os.path.split(script_path)

    if lpath[1] == '':
        log('Error in script "%s" in import_script' % (script_path))
        return None

    #check if path is already in sys.path so we don't repeat
    npath = None
    if lpath[0] == '':
        npath = '.'
    else:
        if lpath[0] not in sys.path:
            npath = lpath[0]

    if npath != None:
        try:
            sys.path.append(npath)
        except:
            if log_status == True:
                log('Error adding path "%s" in import_script' % npath)
            return None

    try:   
        mod =  __import__(lpath[1])
    except:
        error_trace,error_reason =  FormatExceptionInfo()
        if log_status == True:
            log('Error importing "%s" module in import_script: %s' % (script_path, error_trace + error_reason))
        sys.path.remove(npath)
        return None

    return mod 
```

# windows - 运行 Windows 批处理脚本来启动多个文件

> ID：287849
> 
> 赞同：5
> 
> 时间：2008-11-13T18:49:55.877
> 
> 标签：windows, batch-file

我正在尝试用批处理脚本替换从我的启动目录运行的程序。批处理脚本只会警告我程序将要运行，我可以继续运行脚本或停止它。

这是我到目前为止写的脚本：

```
@echo off
echo You are about to run startup programs!
pause 

::load outlook
cmd /k "C:\Program Files\Microsoft Office\Office12\OUTLOOK.EXE" /recycle
::load Visual Studio 2008
call "C:\Program Files\Microsoft Visual Studio 9.0\Common7\IDE\devenv.exe" 
```

这两个命令都将加载第一个程序并等到我关闭它以加载第二个程序。我希望脚本同时加载进程。我该如何做到这一点？

编辑：当我使用 start 命令时，它会打开一个新的 shell，其中包含我输入的字符串作为标题。编辑后的脚本如下所示：

```
start  "C:\Program Files\Microsoft Office\Office12\OUTLOOK.EXE"
::load Visual Studio 2008
start "C:\Program Files\Microsoft Visual Studio 9.0\Common7\IDE\devenv.exe" 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-13T19:13:03.680

这有效：

```
@echo 关闭
echo 你即将运行启动程序！
暂停

::加载展望
开始 /b "" "C:\Program Files\Microsoft Office\Office12\OUTLOOK.EXE" /recycle
::加载 Visual Studio 2008
开始 /b "" "C:\Program Files\Microsoft Visual Studio 9.0\Common7\IDE\devenv.exe"

```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-13T19:24:33.360

像这样使用 START：

```
START "" "C:\Program Files\Microsoft Office\Office12\OUTLOOK.EXE" 
```

当您的路径用引号引起来时，START 将其解释为窗口的标题。添加“”使其将您的路径视为要运行的程序。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T18:56:10.810

如果您在资源管理器中单击文件，则该`start`命令的行为将非常相似。

# .net - 有没有办法以编程方式“重新启动”.net 程序集？

> ID：287852
> 
> 赞同：2
> 
> 时间：2008-11-13T18:50:31.167
> 
> 标签：.net, exception, gac

假设情况：假设我在 ASP.Net Web 系统中使用了一个第 3 方 .net 程序集，我正在处理它只是偶尔崩溃。当它这样做时，对它的所有调用都会引发异常，直到系统重新启动。显然，这有点次优。

有没有办法从异常处理程序重新启动该程序集？

（附录：当然，这里的正确答案是让供应商修复他们的错误。但是，有问题的供应商有点......“不愿意”回复我们的电子邮件。所以，这个重新启动组装的想法是今天早上产生的就像一条 MacGyver-eqsue 胶带。然后我们意识到我们都不知道该怎么做。）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-13T21:48:54.830

调用 HttpRuntime.UnloadAppDomain() 将强制应用程序自行终止并在下一个 Web 请求到达时重新启动。这会导致从头开始重新加载所有内容，并且应该消除损坏的程序集数据。

当然，这会杀死任何活动会话，但如果应用程序基本上崩溃了，这可能是可以接受的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-13T19:06:52.800

您可以回收应用程序池，但这将启动所有当前用户并丢失他们的会话信息 - 如果站点已经被坏 dll 冲洗，这可能无关紧要

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-13T19:09:10.097

好的，真正的答案...当 Web.Config 文件更改时，应用程序会重新编译并且应用程序池会重置。

所以，（我不想这么说）以编程方式更改您的 web.config 文件。

顺便说一句，我不建议这样做，这样你就可以把你的反对票留给别人。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-13T19:00:28.650

假设...回到您的第 3 方供应商并让他们修复他们的错误。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T19:09:21.173

可能是当它奇怪地崩溃时，它仍然会留下一个活跃的进程，该进程会阻止任何后续调用 DLL 的尝试。如果是这样，您可能能够以编程方式找到它并杀死它，这可能会解决需要重新启动的问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-13T23:17:31.733

除了修改 web.config 之外，您还可以在 bin 文件夹中创建任意文件。这将重新启动您的应用程序。

# xml - 传递 XML 对象与填充结构

> ID：287857
> 
> 赞同：1
> 
> 时间：2008-11-13T18:52:36.090
> 
> 标签：xml, flash, actionscript-3

Actionscript 3.0 具有不错的原生 XML 支持，因此看到很多人加载外部 XML，然后将对象传递给各种模块/代码段，我并不感到惊讶。

然而，我的直觉是创建一个类（即具有静态命名/类型化的字段），从 XML 填充它并传递它。优点是将结构与消息/数据格式分离，但您确实失去了 XML 提供的可搜索性，如果您有很多嵌套结构，我可以看到它可能需要大量的初始处理时间来转换它。

那么这里的最佳做法是什么？对于非常小的项目/用例，我仍然只使用 XML，但是当它变得更大时，或者我有远见，我倾向于走课堂路线。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T18:52:22.970

我想说，由于 XML 对象没有静态结构，它为错误蔓延到系统提供了很多可能性，并且也使代码的可读性和可理解性大大降低。

所以我会说是的，上课是要走的路，这是额外的努力，但你的系统因此而更有条理。

我过去曾尝试在 XML 对象周围包装类，但这会使这些类中的代码看起来非常混乱。

我目前正在尝试使用我编写的 XMLObjectBinder 类（纯 actionscript 项目而不是 Flex）将 XML 对象绑定到对象，因为我发现这种方法是最干净的，因为 XML 尽快脱离了画面。所以我的类现在更干净了，因为它们内部缺少 XML，并且绑定通常是来自工厂的单行调用。

在事情的可搜索性方面，我同意你会失去这一点，但我会说工厂模式与一些 XML 到对象的绑定相结合将消除很多这些问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T19:50:21.340

我倾向于创建“阅读器”类来加载数据并将其存储在自己的 XML 对象中。然后，我将 XML 所需的任何数据作为本机类型传递给其他对象。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T21:42:32.957

我无法与 ActionScript 交谈，但我认为我在 VB6 和 C# 方面的经验可能是相关的：

XML 消息格式发生变化。当他们这样做时，与消息格式紧密耦合的代码就会中断。如果您可以将与 XML 互操作的所有代码保存在一个地方，您可以控制消息格式更改对您的应用程序造成的损害。从 XML 中构建对象，然后在代码中使用这些对象，您可以将大部分代码与消息格式的更改隔离开来。

有很多应用程序的风险并不大——例如，可以将代码的逻辑结构与 XML 的结构结合起来，因为 XML 反映了应用程序域的逻辑结构。因此，在决定采用哪种方法时，您必须做出一些判断。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-07T01:43:12.853

最后，我首选的解决方案是从数据中填充类，但在需要可搜索性时在某处保留对 XML 的引用。

# c# - 是否有可用于在 .NET 中编程的 Subversion API

> ID：287862
> 
> 赞同：19
> 
> 时间：2008-11-13T18:54:59.347
> 
> 标签：c#, .net, svn

是否有从 C# 访问 Subversion 的 API？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-11-20T15:23:19.130

[SharpSvn](http://sharpsvn.net/)是一个用于 .Net/C# 的新 Subversion 包装库，它为您隐藏所有互操作和内存管理，并包括一个静态编译的 Subversion 库，以便于集成。它可能是唯一设计用于在多线程环境中良好运行的 Subversion 绑定。

SharpSvn 不是独立于平台的，但它使得从您的 .Net 应用程序中使用 Subversion 变得非常容易。去年有几个项目从其他库切换到使用 SharpSvn。（AnkhSVN、Visual Studio 的 Collabnet 桌面、SharpForge 等等）

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-11-13T19:03:16.240

[**Svn.NET**](http://www.pumacode.org/projects/svndotnet/)[是CMS](https://stackoverflow.com/users/5445/cms)的[回答](https://stackoverflow.com/questions/287862/subversion-access-from-net#287869)中提到[的SubversionSharp](http://www.softec.st/en/OpenSource/ClrProjects/SubversionSharp/SubversionSharp.html)的延续（分支）。SubversionSharp 仅限于 .NET 1.1 平台。

Svn.NET 支持以下平台：

*   Windows 平台上的 .NET 2.0
*   Win32 上的 Mono（2.0 框架）
*   Linux 上的 Mono（2.0 框架）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T18:57:15.067

检查[SubversionSharp](http://www.softec.st/en/OpenSource/ClrProjects/SubversionSharp/SubversionSharp.html)，它基本上是一个完全覆盖 Subversion 客户端 API 的 C# 包装库。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-13T19:33:50.533

我曾经尝试过 Svn.NET，并记得它并没有完成我想要的一切。如果 Svn.NET 适合你，我肯定会推荐这条路线，但如果你有像我一样的问题，你可以尝试使用[http://www.ikvm.net/](http://www.ikvm.net/)转换[http://svnkit.com/](http://svnkit.com/)到 .NET 程序集。当我们决定离开 SVN 并且我搁置了整个事情时，我确实得到了这个工作并在我的项目中进行试验。

# python - 如何将彩色文本打印到终端

> ID：287871
> 
> 赞同：2739
> 
> 时间：2008-11-13T18:58:10.947
> 
> 标签：python, terminal, output, ansi-colors

如何在 Python 中将彩色文本输出到终端？

* * *

## 回答 #1

> 赞同：2418
> 
> 时间：2008-11-13T19:25:07.787

这在某种程度上取决于您所在的平台。最常见的方法是打印 ANSI 转义序列。[举个简单的例子，这里有一些来自Blender 构建脚本](https://svn.blender.org/svnroot/bf-blender/trunk/blender/build_files/scons/tools/bcolors.py)的 Python 代码：

```
class bcolors:
    HEADER = '\033[95m'
    OKBLUE = '\033[94m'
    OKCYAN = '\033[96m'
    OKGREEN = '\033[92m'
    WARNING = '\033[93m'
    FAIL = '\033[91m'
    ENDC = '\033[0m'
    BOLD = '\033[1m'
    UNDERLINE = '\033[4m' 
```

要使用这样的代码，您可以执行以下操作：

```
print(bcolors.WARNING + "Warning: No active frommets remain. Continue?" + bcolors.ENDC) 
```

或者，使用 Python 3.6+：

```
print(f"{bcolors.WARNING}Warning: No active frommets remain. Continue?{bcolors.ENDC}") 
```

这将适用于包括 OS X、Linux 和 Windows 在内的 unix（前提是您使用[ANSICON](https://github.com/adoxa/ansicon)，或者在 Windows 10 中启用[VT100 仿真](https://msdn.microsoft.com/en-us/library/mt638032)）。有用于设置颜色、移动光标等的 ANSI 代码。

如果您要对此感到复杂（如果您正在编写游戏，这听起来很复杂），您应该查看“ [curses](https://en.wikipedia.org/wiki/Curses_%28programming_library%29) ”模块，它为您处理了很多复杂的部分。[Python Curses HowTO](http://docs.python.org/howto/curses.html "Python 诅咒方法")是一个很好的介绍。

如果您不使用扩展 ASCII（即，不在 PC 上），您会被 127 以下的 ASCII 字符卡住，而“#”或“@”可能是您最好的选择。如果您可以确保您的终端使用的是 IBM[扩展 ASCII 字符集](http://telecom.tbi.net/asc-ibm.html)，那么您有更多选择。字符 176、177、178 和 219 是“块字符”。

一些现代的基于文本的程序，例如“Dwarf Fortress”，以图形模式模拟文本模式，并使用经典 PC 字体的图像。[您可以在Dwarf Fortress Wiki](http://dwarffortresswiki.org/DF2014:Tilesets)上找到一些可以使用的位图，请参阅（[用户制作的图块集](http://dwarffortresswiki.org/Tileset_repository)）。

[Text Mode Demo Contest](http://en.wikipedia.org/wiki/TMDC "文本模式演示比赛")有更多在文本模式下绘制图形的资源。

* * *

## 回答 #2

> 赞同：1027
> 
> 时间：2008-11-16T07:31:39.037

还有[Python termcolor 模块](http://pypi.python.org/pypi/termcolor)。用法很简单：

```
from termcolor import colored

print colored('hello', 'red'), colored('world', 'green') 
```

或者在 Python 3 中：

```
print(colored('hello', 'red'), colored('world', 'green')) 
```

但是，对于游戏编程和您想要做的“彩色块”来说，它可能不够复杂......

要让 ANSI 代码在 Windows 上运行，首先运行

```
os.system('color') 
```

* * *

## 回答 #3

> 赞同：908
> 
> 时间：2010-07-26T07:07:14.003

答案是用于 Python 中所有跨平台着色的[Colorama 。](https://pypi.python.org/pypi/colorama)

它支持 Python 3.5+ 以及 Python 2.7。

自 2021 年 1 月起，它得到维护。

示例截图： [![示例截图](https://i.stack.imgur.com/q3D4W.png)](https://i.stack.imgur.com/q3D4W.png)

* * *

## 回答 #4

> 赞同：563
> 
> 时间：2014-02-14T17:56:38.347

打印一个以颜色/样式开头的字符串，然后是字符串，然后以 结束颜色/样式更改`'\x1b[0m'`：

```
print('\x1b[6;30;42m' + 'Success!' + '\x1b[0m') 
```

[![成功与绿色背景示例](https://i.stack.imgur.com/RN3MN.png)](https://i.stack.imgur.com/RN3MN.png)

使用以下代码获取 shell 文本的格式选项表：

```
def print_format_table():
    """
    prints table of formatted text format options
    """
    for style in range(8):
        for fg in range(30,38):
            s1 = ''
            for bg in range(40,48):
                format = ';'.join([str(style), str(fg), str(bg)])
                s1 += '\x1b[%sm %s \x1b[0m' % (format, format)
            print(s1)
        print('\n')

print_format_table() 
```

# 明暗示例（完整）

[![在此处输入图像描述](https://i.stack.imgur.com/6otvY.png)](https://i.stack.imgur.com/6otvY.png)

# 明暗示例（部分）

![输出的顶部](https://i.stack.imgur.com/lZr23.png)

* * *

## 回答 #5

> 赞同：273
> 
> 时间：2016-09-12T14:00:32.827

定义一个开始颜色的字符串和结束颜色的字符串。然后打印您的文本，开始字符串在前面，结束字符串在末尾。

```
CRED = '\033[91m'
CEND = '\033[0m'
print(CRED + "Error, does not compute!" + CEND) 
```

这会在 Bash 中`urxvt`使用 Zenburn 风格的配色方案生成以下内容：

[![输出颜色](https://i.stack.imgur.com/Iu3I1.png)](https://i.stack.imgur.com/Iu3I1.png)

通过实验，我们可以得到更多的颜色：

[![颜色矩阵](https://i.stack.imgur.com/j7e4i.gif)](https://i.stack.imgur.com/j7e4i.gif)

注意：`\33[5m`和`\33[6m`正在闪烁。

这样我们就可以创建一个完整的颜色集合：

```
CEND      = '\33[0m'
CBOLD     = '\33[1m'
CITALIC   = '\33[3m'
CURL      = '\33[4m'
CBLINK    = '\33[5m'
CBLINK2   = '\33[6m'
CSELECTED = '\33[7m'

CBLACK  = '\33[30m'
CRED    = '\33[31m'
CGREEN  = '\33[32m'
CYELLOW = '\33[33m'
CBLUE   = '\33[34m'
CVIOLET = '\33[35m'
CBEIGE  = '\33[36m'
CWHITE  = '\33[37m'

CBLACKBG  = '\33[40m'
CREDBG    = '\33[41m'
CGREENBG  = '\33[42m'
CYELLOWBG = '\33[43m'
CBLUEBG   = '\33[44m'
CVIOLETBG = '\33[45m'
CBEIGEBG  = '\33[46m'
CWHITEBG  = '\33[47m'

CGREY    = '\33[90m'
CRED2    = '\33[91m'
CGREEN2  = '\33[92m'
CYELLOW2 = '\33[93m'
CBLUE2   = '\33[94m'
CVIOLET2 = '\33[95m'
CBEIGE2  = '\33[96m'
CWHITE2  = '\33[97m'

CGREYBG    = '\33[100m'
CREDBG2    = '\33[101m'
CGREENBG2  = '\33[102m'
CYELLOWBG2 = '\33[103m'
CBLUEBG2   = '\33[104m'
CVIOLETBG2 = '\33[105m'
CBEIGEBG2  = '\33[106m'
CWHITEBG2  = '\33[107m' 
```

这是生成测试的代码：

```
x = 0
for i in range(24):
  colors = ""
  for j in range(5):
    code = str(x+j)
    colors = colors + "\33[" + code + "m\\33[" + code + "m\033[0m "
  print(colors)
  x = x + 5 
```

* * *

## 回答 #6

> 赞同：150
> 
> 时间：2019-03-02T03:59:27.663

这是一个原生适用于 Windows 10 的解决方案。

使用系统调用，例如`os.system("")`，允许在命令提示符和 Powershell 中本地打印颜色：

```
import os

# System call
os.system("")

# Class of different styles
class style():
    BLACK = '\033[30m'
    RED = '\033[31m'
    GREEN = '\033[32m'
    YELLOW = '\033[33m'
    BLUE = '\033[34m'
    MAGENTA = '\033[35m'
    CYAN = '\033[36m'
    WHITE = '\033[37m'
    UNDERLINE = '\033[4m'
    RESET = '\033[0m'

print(style.YELLOW + "Hello, World!") 
```

注意：Windows 不完全支持 ANSI 代码，无论是通过系统调用还是模块。并非所有文本装饰都受支持，虽然显示的是亮色，但它们与常规颜色相同。

感谢@jl 找到了一个更短的方法。

**tl;博士**：添加`os.system("")`

* * *

## 回答 #7

> 赞同：109
> 
> 时间：2008-11-13T19:22:54.017

您想了解 ANSI 转义序列。这是一个简短的例子：

```
CSI = "\x1B["
print(CSI+"31;40m" + "Colored Text" + CSI + "0m") 
```

有关详细信息，请参阅*[ANSI 转义码](http://en.wikipedia.org/wiki/ANSI_escape_code)*。

对于块字符，请尝试使用 Unicode 字符，如 \u2588：

```
print(u"\u2588") 
```

把它们放在一起：

```
print(CSI+"31;40m" + u"\u2588" + CSI + "0m") 
```

* * *

## 回答 #8

> 赞同：100
> 
> 时间：2018-02-10T17:04:41.130

[sty](https://github.com/feluxe/sty)与 colorama 类似，但不那么冗长，支持[8 位](https://sty.mewo.dev/docs/coloring.html#coloring-with-8-bit-codes)和[24 位](https://sty.mewo.dev/docs/coloring.html#coloring-with-24bit-codes)(RGB) 颜色，支持所有[效果](https://sty.mewo.dev/docs/effects.html)（粗体、下划线等），允许您[注册自己的样式](https://sty.mewo.dev/docs/customizing.html#add-custom-styles-to-a-register-object)，全类型且高性能，支持[静音](https://sty.mewo.dev/docs/muting.html#the-mute-and-unmute-methods)，不会弄乱全局变量，例如`sys.stdout`，非常灵活，有[据可查](https://sty.mewo.dev/)等等......

**例子：**

```
from sty import fg, bg, ef, rs

foo = fg.red + 'This is red text!' + fg.rs
bar = bg.blue + 'This has a blue background!' + bg.rs
baz = ef.italic + 'This is italic text' + rs.italic
qux = fg(201) + 'This is pink text using 8bit colors' + fg.rs
qui = fg(255, 10, 10) + 'This is red text using 24bit colors.' + fg.rs

# Add custom colors:

from sty import Style, RgbFg

fg.orange = Style(RgbFg(255, 150, 50))

buf = fg.orange + 'Yay, Im orange.' + fg.rs

print(foo, bar, baz, qux, qui, buf, sep='\n') 
```

印刷：

[![在此处输入图像描述](https://i.stack.imgur.com/4BIdi.png)](https://i.stack.imgur.com/4BIdi.png)

**演示：**

[![在此处输入图像描述](https://i.stack.imgur.com/S8wtO.png)](https://i.stack.imgur.com/S8wtO.png)

* * *

## 回答 #9

> 赞同：76
> 
> 时间：2020-12-01T10:16:42.453

[Rich](https://github.com/willmcgugan/rich)是一个相对较新的 Python 库，用于在终端中处理颜色。

在 Rich 中有几种处理颜色的方法。最快的入门方法是丰富的打印方法，它将类似[BBCode](https://en.wikipedia.org/wiki/BBCode)的语法呈现到 ANSI 控制代码中：

```
from rich import print
print("[red]Color[/] in the [bold magenta]Terminal[/]!") 
```

还有其他方法可以使用 Rich（正则表达式、语法）和相关的格式功能来应用颜色。

[![丰富的截图](https://i.stack.imgur.com/4jJaD.png)](https://i.stack.imgur.com/4jJaD.png)

* * *

## 回答 #10

> 赞同：68
> 
> 时间：2011-12-18T00:32:49.210

我最喜欢的方式是使用[Blessings](http://pypi.python.org/pypi/blessings/)库（完全公开：我写的）。例如：

```
from blessings import Terminal

t = Terminal()
print t.red('This is red.')
print t.bold_bright_red_on_black('Bright red on black') 
```

要打印彩色砖块，最可靠的方法是使用背景颜色打印空间。我使用这种技术在[nose-progressive](http://pypi.python.org/pypi/nose-progressive/)中绘制进度条：

```
print t.on_green(' ') 
```

您也可以在特定位置打印：

```
with t.location(0, 5):
    print t.on_yellow(' ') 
```

如果您在游戏过程中必须使用其他终端功能，您也可以这样做。你可以使用 Python 的标准字符串格式来保持它的可读性：

```
print '{t.clear_eol}You just cleared a {t.bold}whole{t.normal} line!'.format(t=t) 
```

Blessings 的好处在于它尽最大努力在各种终端上工作，而不仅仅是（非常常见的）ANSI 色终端。它还可以将不可读的转义序列排除在您的代码之外，同时保持简洁易用。玩得开心！

* * *

## 回答 #11

> 赞同：59
> 
> 时间：2014-10-18T23:26:05.113

我生成了一个包含所有颜色的类，使用`for`循环迭代每种颜色组合，最多可达 100，然后用 Python 颜色编写一个类。随意复制和粘贴，我的 GPLv2：

```
class colors:
    '''Colors class:
    Reset all colors with colors.reset
    Two subclasses fg for foreground and bg for background.
    Use as colors.subclass.colorname.
    i.e. colors.fg.red or colors.bg.green
    Also, the generic bold, disable, underline, reverse, strikethrough,
    and invisible work with the main class
    i.e. colors.bold
    '''
    reset='\033[0m'
    bold='\033[01m'
    disable='\033[02m'
    underline='\033[04m'
    reverse='\033[07m'
    strikethrough='\033[09m'
    invisible='\033[08m'
    class fg:
        black='\033[30m'
        red='\033[31m'
        green='\033[32m'
        orange='\033[33m'
        blue='\033[34m'
        purple='\033[35m'
        cyan='\033[36m'
        lightgrey='\033[37m'
        darkgrey='\033[90m'
        lightred='\033[91m'
        lightgreen='\033[92m'
        yellow='\033[93m'
        lightblue='\033[94m'
        pink='\033[95m'
        lightcyan='\033[96m'
    class bg:
        black='\033[40m'
        red='\033[41m'
        green='\033[42m'
        orange='\033[43m'
        blue='\033[44m'
        purple='\033[45m'
        cyan='\033[46m'
        lightgrey='\033[47m' 
```

* * *

## 回答 #12

> 赞同：54
> 
> 时间：2015-12-23T20:20:49.013

试试这个简单的代码

```
def prRed(prt): print("\033[91m {}\033[00m" .format(prt))
def prGreen(prt): print("\033[92m {}\033[00m" .format(prt))
def prYellow(prt): print("\033[93m {}\033[00m" .format(prt))
def prLightPurple(prt): print("\033[94m {}\033[00m" .format(prt))
def prPurple(prt): print("\033[95m {}\033[00m" .format(prt))
def prCyan(prt): print("\033[96m {}\033[00m" .format(prt))
def prLightGray(prt): print("\033[97m {}\033[00m" .format(prt))
def prBlack(prt): print("\033[98m {}\033[00m" .format(prt))

prGreen("Hello, World!") 
```

* * *

## 回答 #13

> 赞同：43
> 
> 时间：2020-01-03T16:43:48.283

我有一个[名为 colorit 的库](https://github.com/SuperMaZingCoder/ColorIt)。超级简单。

这里有些例子：

```
from colorit import *

# Use this to ensure that ColorIt will be usable by certain command line interfaces
# Note: This clears the terminal
init_colorit()

# Foreground
print(color("This text is red", Colors.red))
print(color("This text is orange", Colors.orange))
print(color("This text is yellow", Colors.yellow))
print(color("This text is green", Colors.green))
print(color("This text is blue", Colors.blue))
print(color("This text is purple", Colors.purple))
print(color("This text is white", Colors.white))

# Background
print(background("This text has a background that is red", Colors.red))
print(background("This text has a background that is orange", Colors.orange))
print(background("This text has a background that is yellow", Colors.yellow))
print(background("This text has a background that is green", Colors.green))
print(background("This text has a background that is blue", Colors.blue))
print(background("This text has a background that is purple", Colors.purple))
print(background("This text has a background that is white", Colors.white))

# Custom
print(color("This color has a custom grey text color", (150, 150, 150)))
print(background("This color has a custom grey background", (150, 150, 150)))

# Combination
print(
    background(
        color("This text is blue with a white background", Colors.blue), Colors.white
    )
)

# If you are using Windows Command Line, this is so that it doesn't close immediately
input() 
```

这给了你：

[![ColorIt的图片](https://i.stack.imgur.com/AESCH.png)](https://i.stack.imgur.com/AESCH.png)

还值得注意的是，这是跨平台的，并且已经在 Mac、Linux 和 Windows 上进行了测试。

您可能想尝试一下：[https ://github.com/SuperMaZingCoder/colorit](https://github.com/SuperMaZingCoder/colorit)

`colorit`现在可以与 PyPi 一起安装！`pip install color-it`您可以在 Windows 以及`pip3 install color-it`macOS 和 Linux 上安装它。

* * *

## 回答 #14

> 赞同：40
> 
> 时间：2008-11-13T22:22:30.207

在 Windows 上，您可以使用模块“win32console”（在某些 Python 发行版中可用）或模块“ctypes”（Python 2.5 及更高版本）来访问 Win32 API。

要查看支持这两种方式的完整代码，请参阅[Testoob](https://github.com/testoob/testoob)的[颜色控制台报告代码](https://github.com/testoob/testoob/blob/master/src/testoob/reporting/colored.py)。

ctypes 示例：

```
import ctypes

# Constants from the Windows API
STD_OUTPUT_HANDLE = -11
FOREGROUND_RED    = 0x0004 # text color contains red.

def get_csbi_attributes(handle):
    # Based on IPython's winconsole.py, written by Alexander Belchenko
    import struct
    csbi = ctypes.create_string_buffer(22)
    res = ctypes.windll.kernel32.GetConsoleScreenBufferInfo(handle, csbi)
    assert res

    (bufx, bufy, curx, cury, wattr,
    left, top, right, bottom, maxx, maxy) = struct.unpack("hhhhHhhhhhh", csbi.raw)
    return wattr

handle = ctypes.windll.kernel32.GetStdHandle(STD_OUTPUT_HANDLE)
reset = get_csbi_attributes(handle)

ctypes.windll.kernel32.SetConsoleTextAttribute(handle, FOREGROUND_RED)
print "Cherry on top"
ctypes.windll.kernel32.SetConsoleTextAttribute(handle, reset) 
```

* * *

## 回答 #15

> 赞同：40
> 
> 时间：2018-04-25T14:50:58.273

```
# Pure Python 3.x demo, 256 colors
# Works with bash under Linux and MacOS

fg = lambda text, color: "\33[38;5;" + str(color) + "m" + text + "\33[0m"
bg = lambda text, color: "\33[48;5;" + str(color) + "m" + text + "\33[0m"

def print_six(row, format, end="\n"):
    for col in range(6):
        color = row*6 + col - 2
        if color>=0:
            text = "{:3d}".format(color)
            print (format(text,color), end=" ")
        else:
            print(end="    ")   # four spaces
    print(end=end)

for row in range(0, 43):
    print_six(row, fg, " ")
    print_six(row, bg)

# Simple usage: print(fg("text", 160)) 
```

[![改变前景和背景的文本，颜色 0..141](https://i.stack.imgur.com/qqMmX.png)](https://i.stack.imgur.com/qqMmX.png) [![改变前景和背景的文本，颜色 142..255](https://i.stack.imgur.com/3X16v.png)](https://i.stack.imgur.com/3X16v.png)

[在线尝试](https://code.labstack.com/VfphHQ14)

* * *

## 回答 #16

> 赞同：38
> 
> 时间：2020-05-22T17:46:49.870

在我看来，这是最简单的方法。只要你有你想要的颜色的 RGB 值，这应该可以工作：

```
def colored(r, g, b, text):
    return "\033[38;2;{};{};{}m{} \033[38;2;255;255;255m".format(r, g, b, text) 
```

打印红色文本的示例：

```
text = 'Hello, World!'
colored_text = colored(255, 0, 0, text)
print(colored_text)

#or

print(colored(255, 0, 0, 'Hello, World!')) 
```

多色文本

```
text = colored(255, 0, 0, 'Hello, ') + colored(0, 255, 0, 'World')
print(text) 
```

* * *

## 回答 #17

> 赞同：37
> 
> 时间：2013-06-12T11:38:01.930

我已将[joeld 的答案](https://stackoverflow.com/questions/287871/how-to-print-colored-text-in-python/287944#287944)包装到一个具有全局函数的模块中，我可以在代码中的任何地方使用它。

文件：log.py

```
def enable():
    HEADER = '\033[95m'
    OKBLUE = '\033[94m'
    OKGREEN = '\033[92m'
    WARNING = '\033[93m'
    FAIL = '\033[91m'
    ENDC = '\033[0m'
    BOLD = "\033[1m"

def disable():
    HEADER = ''
    OKBLUE = ''
    OKGREEN = ''
    WARNING = ''
    FAIL = ''
    ENDC = ''

def infog(msg):
    print(OKGREEN + msg + ENDC)

def info(msg):
    print(OKBLUE + msg + ENDC)

def warn(msg):
    print(WARNING + msg + ENDC)

def err(msg):
    print(FAIL + msg + ENDC)

enable() 
```

使用如下：

```
import log
log.info("Hello, World!")
log.err("System Error") 
```

* * *

## 回答 #18

> 赞同：31
> 
> 时间：2019-09-28T18:15:14.160

```
def black(text):
    print('\033[30m', text, '\033[0m', sep='')

def red(text):
    print('\033[31m', text, '\033[0m', sep='')

def green(text):
    print('\033[32m', text, '\033[0m', sep='')

def yellow(text):
    print('\033[33m', text, '\033[0m', sep='')

def blue(text):
    print('\033[34m', text, '\033[0m', sep='')

def magenta(text):
    print('\033[35m', text, '\033[0m', sep='')

def cyan(text):
    print('\033[36m', text, '\033[0m', sep='')

def gray(text):
    print('\033[90m', text, '\033[0m', sep='')

black("BLACK")
red("RED")
green("GREEN")
yellow("YELLOW")
blue("BLACK")
magenta("MAGENTA")
cyan("CYAN")
gray("GRAY") 
```

[**在线尝试**](https://code.labstack.com/EoyDRCvJ)

* * *

## 回答 #19

> 赞同：26
> 
> 时间：2016-08-17T20:01:56.460

我最终这样做了，我觉得它是最干净的：

```
formatters = {
    'RED': '\033[91m',
    'GREEN': '\033[92m',
    'END': '\033[0m',
}

print 'Master is currently {RED}red{END}!'.format(**formatters)
print 'Help make master {GREEN}green{END} again!'.format(**formatters) 
```

* * *

## 回答 #20

> 赞同：25
> 
> 时间：2008-11-13T19:06:23.037

对于 Windows，除非您使用[Win32](https://en.wikipedia.org/wiki/Windows_API) API，否则您无法使用颜色打印到控制台。

对于 Linux，它就像使用 print 一样简单，这里列出了转义序列：

[颜色](http://www.linuxhowtos.org/Tips%20and%20Tricks/ansi_escape_sequences.htm)

对于像框一样打印的字符，这实际上取决于您在控制台窗口中使用的字体。磅符号效果很好，但它取决于字体：

```
# 
```

* * *

## 回答 #21

> 赞同：24
> 
> 时间：2015-04-18T22:18:35.643

非常简单，基于[joeld 的回答](https://stackoverflow.com/questions/287871/how-to-print-colored-text-in-python/287944#287944)：

```
class PrintInColor:
    RED = '\033[91m'
    GREEN = '\033[92m'
    YELLOW = '\033[93m'
    LIGHT_PURPLE = '\033[94m'
    PURPLE = '\033[95m'
    END = '\033[0m'

    @classmethod
    def red(cls, s, **kwargs):
        print(cls.RED + s + cls.END, **kwargs)

    @classmethod
    def green(cls, s, **kwargs):
        print(cls.GREEN + s + cls.END, **kwargs)

    @classmethod
    def yellow(cls, s, **kwargs):
        print(cls.YELLOW + s + cls.END, **kwargs)

    @classmethod
    def lightPurple(cls, s, **kwargs):
        print(cls.LIGHT_PURPLE + s + cls.END, **kwargs)

    @classmethod
    def purple(cls, s, **kwargs):
        print(cls.PURPLE + s + cls.END, **kwargs) 
```

然后就

```
PrintInColor.red('hello', end=' ')
PrintInColor.green('world') 
```

* * *

## 回答 #22

> 赞同：22
> 
> 时间：2012-07-01T00:41:40.033

请注意`with`关键字与需要重置的修饰符的混合程度（使用 Python 3 和 Colorama）：

```
from colorama import Fore, Style
import sys

class Highlight:
  def __init__(self, clazz, color):
    self.color = color
    self.clazz = clazz
  def __enter__(self):
    print(self.color, end="")
  def __exit__(self, type, value, traceback):
    if self.clazz == Fore:
      print(Fore.RESET, end="")
    else:
      assert self.clazz == Style
      print(Style.RESET_ALL, end="")
    sys.stdout.flush()

with Highlight(Fore, Fore.GREEN):
  print("this is highlighted")
print("this is not") 
```

* * *

## 回答 #23

> 赞同：22
> 
> 时间：2017-03-01T10:09:35.610

基于[joeld 的回答](https://stackoverflow.com/questions/287871/how-to-print-colored-text-in-python/287944#287944)，使用[https://pypi.python.org/pypi/lazyme](https://pypi.python.org/pypi/lazyme)
`pip install -U lazyme`：

```
from lazyme.string import color_print
>>> color_print('abc')
abc
>>> color_print('abc', color='pink')
abc
>>> color_print('abc', color='red')
abc
>>> color_print('abc', color='yellow')
abc
>>> color_print('abc', color='green')
abc
>>> color_print('abc', color='blue', underline=True)
abc
>>> color_print('abc', color='blue', underline=True, bold=True)
abc
>>> color_print('abc', color='pink', underline=True, bold=True)
abc 
```

截屏：

[![在此处输入图像描述](https://i.stack.imgur.com/9NgeB.png)](https://i.stack.imgur.com/9NgeB.png)

* * *

`color_print`对新格式化程序的一些更新，例如：

```
>>> from lazyme.string import palette, highlighter, formatter
>>> from lazyme.string import color_print
>>> palette.keys() # Available colors.
['pink', 'yellow', 'cyan', 'magenta', 'blue', 'gray', 'default', 'black', 'green', 'white', 'red']
>>> highlighter.keys() # Available highlights.
['blue', 'pink', 'gray', 'black', 'yellow', 'cyan', 'green', 'magenta', 'white', 'red']
>>> formatter.keys() # Available formatter,
['hide', 'bold', 'italic', 'default', 'fast_blinking', 'faint', 'strikethrough', 'underline', 'blinking', 'reverse'] 
```

注意：`italic`、`fast blinking`、 和`strikethrough`可能不适用于所有终端，并且它们不适用于 Mac 和 Ubuntu。

例如，

```
>>> color_print('foo bar', color='pink', highlight='white')
foo bar
>>> color_print('foo bar', color='pink', highlight='white', reverse=True)
foo bar
>>> color_print('foo bar', color='pink', highlight='white', bold=True)
foo bar
>>> color_print('foo bar', color='pink', highlight='white', faint=True)
foo bar
>>> color_print('foo bar', color='pink', highlight='white', faint=True, reverse=True)
foo bar
>>> color_print('foo bar', color='pink', highlight='white', underline=True, reverse=True)
foo bar 
```

截屏：

[![在此处输入图像描述](https://i.stack.imgur.com/HGNPc.png)](https://i.stack.imgur.com/HGNPc.png)

* * *

## 回答 #24

> 赞同：22
> 
> 时间：2021-07-18T11:18:06.347

这是我的现代（2021）解决方案：[yachalk](https://github.com/bluenote10/yachalk)

它是为数不多的正确支持嵌套样式的库之一：

[![在此处输入图像描述](https://i.stack.imgur.com/piYe5.png)](https://i.stack.imgur.com/piYe5.png)

除此之外，yachalk 是自动完成友好的，支持 256/真彩色，带有终端功能检测，并且是全类型的。

以下是您在选择解决方案时可能会考虑的一些设计决策。

## 高级库与低级库/手动样式处理？

这个问题的许多答案演示了如何直接转义 ANSI 代码，或建议需要手动启用/禁用样式的低级库。

这些方法有一些微妙的问题：手动插入开/关样式是

*   在语法上更详细，因为必须明确指定重置，
*   更容易出错，因为您可能会不小心忘记重置样式，
*   无法正确处理边缘情况：例如，在某些终端中，必须在换行之前重置样式，并在换行后重新激活它们。此外，一些终端在简单地覆盖互斥样式方面存在问题，并且需要插入“不必要的”重置代码。如果开发者的本地终端没有这些怪癖，开发者不会立即发现这些怪癖。该问题只会在稍后由其他人报告或导致问题，例如在 CI 终端上。

因此，如果与许多终端兼容是一个目标，最好使用提供自动处理样式重置的高级库。这允许库通过在需要的地方插入“虚假”ANSI 转义码来处理所有边缘情况。

## 为什么还有一个图书馆？

在 JavaScript 中，该任务的事实上的标准库是[chalk](https://github.com/chalk/chalk)，在 JS 项目中使用了一段时间后，与之相比，Python 世界中可用的解决方案缺乏。chalk API 不仅使用起来更方便（完全兼容自动完成），它还可以正确处理所有边缘情况。

[yachalk](https://github.com/bluenote10/yachalk)的想法是为 Python 生态系统带来同样的便利。如果您对与其他库的比较感兴趣，我已经在项目页面上开始了[功能比较。](https://github.com/bluenote10/yachalk#prior-art-why-yet-another-chalk-clone)此外，这里有一个很长（但仍然不完整）的替代品清单，这些替代品在我的研究过程中出现——有很多可供选择:)

*   [有色](https://pypi.org/project/colored/)
*   [异色](https://pypi.org/project/ansicolors/)
*   [术语颜色](https://pypi.org/project/termcolor/)
*   [颜色](https://pypi.org/project/colorama/)
*   [麦粒肿](https://pypi.org/project/sty/)
*   [祝福](https://pypi.org/project/blessings/)
*   [富有的](https://pypi.org/project/rich/)
*   [颜色](https://pypi.org/project/colorit/)
*   [彩印](https://pypi.org/project/colorprint/)
*   [控制台颜色](https://pypi.org/project/console-color/)
*   [玩偶](https://pypi.org/project/pyfancy/)
*   [颜色](https://pypi.org/project/couleur/)
*   [样式](https://github.com/lmittmann/style)（以前称为 clr）
*   [pychalk](https://github.com/anthonyalmarza/chalk)
*   [简单的粉笔](https://pypi.org/project/simple-chalk/)
*   [chlk](https://pypi.org/project/chlk/)
*   [白垩](https://pypi.org/project/chalky/)

* * *

## 回答 #25

> 赞同：21
> 
> 时间：2012-01-08T01:40:35.110

你可以使用[克林特](https://github.com/kennethreitz/clint)：

```
from clint.textui import colored
print colored.red('some warning message')
print colored.green('nicely done!') 
```

* * *

## 回答 #26

> 赞同：19
> 
> 时间：2008-11-13T19:13:59.683

您可以使用[curses](https://en.wikipedia.org/wiki/Curses_%28programming_library%29)库的 Python 实现： *[curses — 字符单元显示的终端处理](http://docs.python.org/library/curses.html)*

另外，运行这个，你会找到你的盒子：

```
for i in range(255):
    print i, chr(i) 
```

* * *

## 回答 #27

> 赞同：15
> 
> 时间：2008-11-13T19:38:57.433

如果您正在编写游戏，也许您想更改背景颜色并仅使用空格？例如：

```
print " "+ "\033[01;41m" + " " +"\033[01;46m"  + "  " + "\033[01;42m" 
```

* * *

## 回答 #28

> 赞同：15
> 
> 时间：2018-05-21T10:59:50.713

一个更简单的选择是使用包中的`cprint`功能[`termcolor`](https://pypi.org/project/termcolor/)。

[![彩色打印蟒蛇](https://i.stack.imgur.com/v35jK.png)](https://i.stack.imgur.com/v35jK.png)

它还支持`%s, %d`打印格式：

[![在此处输入图像描述](https://i.stack.imgur.com/BvgXH.png)](https://i.stack.imgur.com/BvgXH.png)

结果可能取决于终端，因此请查看包文档的**终端属性**部分。

*   Windows 命令提示符和 Python IDLE 不起作用

[![在此处输入图像描述](https://i.stack.imgur.com/46mp4.png)](https://i.stack.imgur.com/46mp4.png)

[![在此处输入图像描述](https://i.stack.imgur.com/4A7ug.png)](https://i.stack.imgur.com/4A7ug.png)

*   JupyterLab 笔记本确实有效

[![在此处输入图像描述](https://i.stack.imgur.com/kFhyO.png)](https://i.stack.imgur.com/kFhyO.png)

* * *

## 回答 #29

> 赞同：11
> 
> 时间：2012-06-25T16:59:39.363

如果您使用的是 Windows，那么就可以了！

```
# Display text on a Windows console
# Windows XP with Python 2.7 or Python&nbsp;3.2
from ctypes import windll

# Needed for Python2/Python3 diff
try:
    input = raw_input
except:
    pass
STD_OUTPUT_HANDLE = -11
stdout_handle = windll.kernel32.GetStdHandle(STD_OUTPUT_HANDLE)
# Look at the output and select the color you want.
# For instance, hex E is yellow on black.
# Hex 1E is yellow on blue.
# Hex 2E is yellow on green and so on.
for color in range(0, 75):
     windll.kernel32.SetConsoleTextAttribute(stdout_handle, color)
     print("%X --> %s" % (color, "Have a fine day!"))
     input("Press Enter to go on ... ") 
```

* * *

## 回答 #30

> 赞同：11
> 
> 时间：2015-04-22T19:00:32.310

如果您使用的是[Django](https://www.djangoproject.com/)：

```
>>> from django.utils.termcolors import colorize
>>> print colorize("Hello, World!", fg="blue", bg='red',
...                 opts=('bold', 'blink', 'underscore',))
Hello World!
>>> help(colorize) 
```

快照：

![图片](https://i.stack.imgur.com/vq4Rs.png)

（我一般在runserver终端调试时使用彩色输出，所以加了。）

[您可以测试它是否安装在您的机器中： `$ python -c "import django; print django.VERSION"`. 要安装它，请检查：[如何安装 Django](https://docs.djangoproject.com/en/1.8/topics/install/)]

试一试！！*_*

* * *

## 回答 #31

> 赞同：11
> 
> 时间：2015-02-07T22:43:49.450

## 耶！另一个版本

虽然我发现[这个答案](https://stackoverflow.com/a/26445590/3191896)很有用，但我对其进行了一些修改。这个[GitHub Gist](https://gist.github.com/Jossef/0ee20314577925b4027f)是结果

### 用法

```
print colors.draw("i'm yellow", bold=True, fg_yellow=True) 
```

![在此处输入图像描述](https://i.stack.imgur.com/q1mJ3.png)

此外，您可以包装常见的用法：

```
print colors.error('sorry, ') 
```

![阿斯达](https://i.stack.imgur.com/uGgd7.png)

### [https://gist.github.com/Jossef/0ee20314577925b4027f](https://gist.github.com/Jossef/0ee20314577925b4027f)

* * *

## 回答 #32

> 赞同：11
> 
> 时间：2020-09-28T09:58:38.350

# 表情符号

您可以像其他人在他们的答案中提到的那样使用文本颜色来获得带有背景或前景色的彩色文本。

但是您可以改用**表情符号**！例如，您可以`⚠️`用于警告消息和`错误消息。`

 `或者简单地将这些笔记本用作颜色：

```
: error message
: warning message
: ok status message
: action message
: canceled status message
: Or anything you like and want to recognize immediately by color 
```

### 奖金：

**此方法还可以帮助您直接在源代码中**快速扫描和查找日志。

[但是某些操作系统（包括某些版本中带有一些窗口管理器的某些 Linux 发行版）默认表情符号字体默认不是彩色的，您可能希望首先使它们彩色。]

* * *

## 回答 #33

> 赞同：10
> 
> 时间：2009-07-02T11:59:17.670

这是一个[诅咒](https://en.wikipedia.org/wiki/Curses_%28programming_library%29)示例：

```
import curses

def main(stdscr):
    stdscr.clear()
    if curses.has_colors():
        for i in xrange(1, curses.COLORS):
            curses.init_pair(i, i, curses.COLOR_BLACK)
            stdscr.addstr("COLOR %d! " % i, curses.color_pair(i))
            stdscr.addstr("BOLD! ", curses.color_pair(i) | curses.A_BOLD)
            stdscr.addstr("STANDOUT! ", curses.color_pair(i) | curses.A_STANDOUT)
            stdscr.addstr("UNDERLINE! ", curses.color_pair(i) | curses.A_UNDERLINE)
            stdscr.addstr("BLINK! ", curses.color_pair(i) | curses.A_BLINK)
            stdscr.addstr("DIM! ", curses.color_pair(i) | curses.A_DIM)
            stdscr.addstr("REVERSE! ", curses.color_pair(i) | curses.A_REVERSE)
    stdscr.refresh()
    stdscr.getch()

if __name__ == '__main__':
    print "init..."
    curses.wrapper(main) 
```

* * *

## 回答 #34

> 赞同：10
> 
> 时间：2013-03-26T21:15:20.853

[https://raw.github.com/fabric/fabric/master/fabric/colors.py](https://raw.github.com/fabric/fabric/master/fabric/colors.py)

```
"""
.. versionadded:: 0.9.2

Functions for wrapping strings in ANSI color codes.

Each function within this module returns the input string ``text``, wrapped
with ANSI color codes for the appropriate color.

For example, to print some text as green on supporting terminals::

    from fabric.colors import green

    print(green("This text is green!"))

Because these functions simply return modified strings, you can nest them::

    from fabric.colors import red, green

    print(red("This sentence is red, except for " + \
          green("these words, which are green") + "."))

If ``bold`` is set to ``True``, the ANSI flag for bolding will be flipped on
for that particular invocation, which usually shows up as a bold or brighter
version of the original color on most terminals.
"""

def _wrap_with(code):

    def inner(text, bold=False):
        c = code
        if bold:
            c = "1;%s" % c
        return "\033[%sm%s\033[0m" % (c, text)
    return inner

red = _wrap_with('31')
green = _wrap_with('32')
yellow = _wrap_with('33')
blue = _wrap_with('34')
magenta = _wrap_with('35')
cyan = _wrap_with('36')
white = _wrap_with('37') 
```

* * *

## 回答 #35

> 赞同：10
> 
> 时间：2015-07-09T06:58:08.273

另一个包装 Python 3*打印*功能的[PyPI模块：](https://en.wikipedia.org/wiki/Python_Package_Index)

 *[https://pypi.python.org/pypi/colorprint](https://pypi.python.org/pypi/colorprint)

如果您也可以在 Python 2.x 中使用`from __future__ import print`. 这是来自模块 PyPI 页面的 Python 2 示例：

```
from __future__ import print_function
from colorprint import *

print('Hello', 'world', color='blue', end='', sep=', ')
print('!', color='red', format=['bold', 'blink']) 
```

它输出“你好，世界！” 带有蓝色的单词和粗体红色的感叹号并闪烁。

* * *

## 回答 #36

> 赞同：10
> 
> 时间：2016-05-05T13:08:25.847

[asciimatics](http://asciimatics.readthedocs.io/en/stable/intro.html)为构建文本 UI 和动画提供了可移植的支持：

```
#!/usr/bin/env python
from asciimatics.effects import RandomNoise  # $ pip install asciimatics
from asciimatics.renderers import SpeechBubble, Rainbow
from asciimatics.scene import Scene
from asciimatics.screen import Screen
from asciimatics.exceptions import ResizeScreenError

def demo(screen):
    render = Rainbow(screen, SpeechBubble('Rainbow'))
    effects = [RandomNoise(screen, signal=render)]
    screen.play([Scene(effects, -1)], stop_on_resize=True)

while True:
    try:
        Screen.wrapper(demo)
        break
    except ResizeScreenError:
        pass 
```

广播：

[![ascii 噪声中的彩虹色文本](https://asciinema.org/a/06sabwtc1bw5wfiq23a71ccxq.png)](https://asciinema.org/a/06sabwtc1bw5wfiq23a71ccxq?autoplay=1)

* * *

## 回答 #37

> 赞同：10
> 
> 时间：2020-08-23T20:15:20.203

```
import click

click.secho('Hello, World!', fg='green')
click.secho('Some more text', bg='blue', fg='white')
click.secho('ATTENTION', blink=True, bold=True) 
```

[`click`（CLI 库）](https://click.palletsprojects.com/en/7.x/utils/)有一种非常方便的方法，无论如何，如果您正在编写命令行工具，则值得考虑。

* * *

## 回答 #38

> 赞同：10
> 
> 时间：2021-03-24T11:40:06.317

如果您只想使用内置包，请遵循以下结构：

实际上，我增强了[Mohamed Samy](https://stackoverflow.com/a/17064509/3702377)答案，它现在负责多个输入和数字。此外，它还支持其他`print()`参数，例如`end=`. 此外，我还添加了一种`.store()`方法来将日志写入文件。

您可以创建一个实用程序以在代码中的任何位置使用它：

```
# utility.py

from datetime import datetime

class ColoredPrint:
    def __init__(self):
        self.PINK = '\033[95m'
        self.OKBLUE = '\033[94m'
        self.OKGREEN = '\033[92m'
        self.WARNING = '\033[93m'
        self.FAIL = '\033[91m'
        self.ENDC = '\033[0m'

    def disable(self):
        self.PINK = ''
        self.OKBLUE = ''
        self.OKGREEN = ''
        self.WARNING = ''
        self.FAIL = ''
        self.ENDC = ''

    def store(self):
        date = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        with open('logfile.log', mode='a') as file_:
            file_.write(f"{self.msg} -- {date}")
            file_.write("\n")

    def success(self, *args, **kwargs):
        self.msg = ' '.join(map(str, args))
        print(self.OKGREEN + self.msg + self.ENDC, **kwargs)
        return self

    def info(self, *args, **kwargs):
        self.msg = ' '.join(map(str, args))
        print(self.OKBLUE + self.msg + self.ENDC, **kwargs)
        return self

    def warn(self, *args, **kwargs):
        self.msg = ' '.join(map(str, args))
        print(self.WARNING + self.msg + self.ENDC, **kwargs)
        return self

    def err(self, *args, **kwargs):
        self.msg = ' '.join(map(str, args))
        print(self.FAIL + self.msg + self.ENDC, **kwargs)
        return self

    def pink(self, *args, **kwargs):
        self.msg = ' '.join(map(str, args))
        print(self.PINK + self.msg + self.ENDC, **kwargs)
        return self 
```

例如

```
from utility import ColoredPrint

log = ColoredPrint()

log.success("Hello" , 123, "Bye").store()
log.info("Hello" , 123, "Bye")
log.warn("Hello" , 123, "Bye")
log.err("Hello" , 123, "Bye").store()
log.pink("Hello" , 123, "Bye") 
```

出去：

[![在此处输入图像描述](https://i.stack.imgur.com/HMVP6.png)](https://i.stack.imgur.com/HMVP6.png)

* * *

[更新]：

现在，它的 PyPI[包](https://github.com/agn-7/colored-print)可用：

```
pip install python-colored-print 
```

* * *

## 回答 #39

> 赞同：7
> 
> 时间：2008-11-13T19:53:03.270

## 对于人物

您的终端很可能使用 Unicode（通常为 UTF-8 编码）字符，因此只需选择适当的字体即可查看您喜欢的字符。Unicode char U+2588，“完整块”是我建议您使用的那个。

尝试以下操作：

```
import unicodedata
fp= open("character_list", "w")
for index in xrange(65536):
    char= unichr(index)
    try: its_name= unicodedata.name(char)
    except ValueError: its_name= "N/A"
    fp.write("%05d %04x %s %s\n" % (index, index, char.encode("UTF-8"), its_name)
fp.close() 
```

稍后使用您最喜欢的查看器检查文件。

## 对于颜色

[curses](http://www.python.org/doc/2.5.2/lib/module-curses.html)是您要使用的模块。检查本[教程](http://docs.python.org/howto/curses.html)。

* * *

## 回答 #40

> 赞同：7
> 
> 时间：2020-04-15T00:56:32.933

我建议这个新图书馆**Printy**。他们刚刚发布了 1.2.0 版作为跨平台库。

看看： [GitHub 上的 Printy](https://github.com/edraobdu/printy)

它基于标志，因此您可以执行以下操作

```
from printy import printy

# With global flags, this will apply a bold (B) red (r) color and an underline (U) to the whole text
printy("Hello, World!", "rBU")

# With inline formats, this will apply a dim (D)
#blue (b) to the word 'Hello' and a stroken (S)
#yellow (y) to the word 'world', and the rest will remain as the predefined format
printy("this is a [bD]Hello@ [yS]world@ text") 
```

[![在此处输入图像描述](https://i.stack.imgur.com/1YRLS.png)](https://i.stack.imgur.com/1YRLS.png)

* * *

## 回答 #41

> 赞同：6
> 
> 时间：2020-06-23T08:24:55.340

我创建了一个项目 ( `console-color`) 并已将其发布到[PyPI](https://pypi.org/project/console-color/)。

你可以抛出`pip install console-color`来安装它。

我使用 Sphinx-read-the-doc 编写文档，请参见[此处](https://carsonslovoka.github.io/console-color/en/source/introduction.html)。

[您可以从google-colab](https://colab.research.google.com/drive/1cAYcC6DyiMCyD0RDcEo25LDFCh527TUQ?usp=sharing)获得更多示例。

我仍然发布一些例子来吸引用户点击上面的链接：

```
# cprint is something like below
# cprint(text: str, fore: T_RGB = None, bg: T_RGB = None, style: Style = '')
# where T_RGB = Union[Tuple[int, int, int], str] for example. You can input (255, 0, 0) or '#ff0000' or 'ff0000'. They are OK.
# The Style you can input the ``Style.`` (the IDE will help you to choose what you wanted)

# from console_color import RGB, Fore, Style, cprint, create_print
from console_color import *

cprint("Hello, World!", RGB.RED, RGB.YELLOW, Style.BOLD+Style.URL+Style.STRIKE)
cprint("Hello, World!", fore=(255, 0, 0), bg="ffff00", style=Style.BOLD+Style.URL+Style.STRIKE) 
```

[![在此处输入图像描述](https://i.stack.imgur.com/ZzWF9.png)](https://i.stack.imgur.com/ZzWF9.png)

*当然，您不必输入所有参数。你可以添加你想要的属性。*

* * *

老实说，这个项目并不特别。它只使用`f"\033[{target};2;{r};{g};{b}m{text}{style}"` where 目标是 38 或 48，文本是您的输入字符串，样式是 '\33[0m'、'\33[1m' ... '\033[9m'。某种东西。

而且我只是让它易于使用（至少对我而言）。

* * *

## 回答 #42

> 赞同：5
> 
> 时间：2015-01-26T21:50:24.137

使用[pyfancy](https://github.com/ilovecode1/pyfancy)。这是在终端中做颜色的简单方法！

例子：

```
print(pyfancy.RED + "Hello Red" + pyfancy.END) 
```

* * *

## 回答 #43

> 赞同：4
> 
> 时间：2011-10-20T16:34:37.860

I wrote a simple module, available at: [http://pypi.python.org/pypi/colorconsole](http://pypi.python.org/pypi/colorconsole)

It works with Windows, Mac OS X and Linux. It uses ANSI for Linux and Mac, but native calls to console functions on Windows. You have colors, cursor positioning and keyboard input. It is not a replacement for curses, but can be very useful if you need to use in simple scripts or ASCII games.

* * *

## 回答 #44

> 赞同：4
> 
> 时间：2014-11-02T01:44:34.037

我编写了一个在 Linux、OS X 和 Windows 中处理颜色的模块。它支持所有平台上的所有 16 种颜色，您可以在不同时间设置前景色和背景色，并且字符串对象为 len() 和 .capitalize() 之类的东西提供了合理的结果。

[https://github.com/Robpol86/colorclass](https://github.com/Robpol86/colorclass)

![Windows cmd.exe 上的示例](https://i.stack.imgur.com/j7EjM.png)

* * *

## 回答 #45

> 赞同：4
> 
> 时间：2019-12-10T19:29:25.163

我能找到的最简单的方法不是使用 ANSI 转义码，而是使用`Fore`from import module `colorama`。看看下面的代码：

```
from colorama import Fore, Style

print(Fore.MAGENTA + "IZZ MAGENTA BRUH.")

print(Style.RESET_ALL + "IZZ BACK TO NORMALZ.") 
```

与 ANSI 转义码相比：

```
print("\u001b[31m IZZ RED (NO MAGENTA ON ANSI CODES).\u001b[0m")

print("BACK TO NORMALZ.") 
```

* * *

## 回答 #46

> 赞同：4
> 
> 时间：2020-02-16T18:54:33.187

这是一个简单的函数，我用它来打印彩色文本消息，而不必记住 ANSI 代码，而是使用标准 RGB 元组来定义前景色和背景色。

```
def print_in_color(txt_msg, fore_tuple, back_tuple, ):
    # Prints the text_msg in the foreground color specified by fore_tuple with the background specified by back_tuple
    # text_msg is the text, fore_tuple is foreground color tuple (r,g,b), back_tuple is background tuple (r,g,b)
    rf,bf,gf = fore_tuple
    rb,gb,bb = back_tuple
    msg = '{0}' + txt_msg
    mat = '\33[38;2;' + str(rf) + ';' + str(gf) + ';' + str(bf) + ';48;2;' + str(rb) + ';' +str(gb) + ';' + str(bb) + 'm'
    print(msg .format(mat))
    print('\33[0m') # Returns default print color to back to black

# Example of use using a message with variables
fore_color = 'cyan'
back_color = 'dark green'
msg = 'foreground color is {0} and the background color is {1}'.format(fore_color, back_color)
print_in_color(msg, (0,255,255), (0,127,127)) 
```

* * *

## 回答 #47

> 赞同：3
> 
> 时间：2018-08-27T04:35:07.893

我是 Python 的新手，每次发现像这样的主题时，我都会很兴奋。但这一次（突然）我觉得我有话要说。特别是因为几分钟前我在 Python 中发现了一件令人*惊叹*的事情（至少现在对我来说）：

[**上下文管理器**](https://docs.python.org/3/library/contextlib.html#contextlib.contextmanager)

```
from contextlib import contextmanager
# FORECOLOR
BLACKFC,REDFC,GREENFC,YELLOWFC,BLUEFC = '38;30m','38;31m','38;32m','38;33m','38;34m'
# BACKGOUND
BLACKBG,REDBG,GREENBG,YELLOWBG,BLUEBG = '48;40m','48;41m','48;42m','48;43m','48;44m'

@contextmanager
def printESC(prefix, color, text):
  print("{prefix}{color}{text}".format(prefix=prefix, color=color, text=text), end='')
  yield
  print("{prefix}0m".format(prefix=prefix))

with printESC('\x1B[', REDFC, 'Colored Text'):
  pass 
```

[例子](https://repl.it/@VoldemarShalomo/Escape-sequences-for-visual-effects-in-terminal)

或者就像这样：

```
# FORECOLOR
BLACKFC,REDFC,GREENFC,YELLOWFC,BLUEFC = '38;30m','38;31m','38;32m','38;33m','38;34m'
# BACKGOUND
BLACKBG,REDBG,GREENBG,YELLOWBG,BLUEBG = '48;40m','48;41m','48;42m','48;43m','48;44m'

def printESC(prefix, color, text):
  print("{prefix}{color}{text}".format(prefix=prefix, color=color, text=text), end='')
  print("{prefix}0m".format(prefix=prefix))

printESC('\x1B[', REDFC, 'Colored Text') 
```

* * *

## 回答 #48

> 赞同：3
> 
> 时间：2022-01-05T21:14:49.040

In **windows 10** you can try this tiny script, which works as a color mixer with values from 0-255 for Red, Green and blue:

```
import os

os.system('')

def RGB(red=None, green=None, blue=None,bg=False):
    if(bg==False and red!=None and green!=None and blue!=None):
        return f'\u001b[38;2;{red};{green};{blue}m'
    elif(bg==True and red!=None and green!=None and blue!=None):
        return f'\u001b[48;2;{red};{green};{blue}m'
    elif(red==None and green==None and blue==None):
        return '\u001b[0m' 
```

and call the RGB function to make any combination of colors as:

```
g0 = RGB()
g1 = RGB(0,255,0)
g2 = RGB(0,100,0,True)+""+RGB(100,255,100)
g3 = RGB(0,255,0,True)+""+RGB(0,50,0)

print(f"{g1}green1{g0}")
print(f"{g2}green2{g0}")
print(f"{g3}green3{g0}") 
```

`RGB()` with no parameter will cleanup and set the **foreground/background** color to **default**. In case you want **black** you should call it as `RGB(0,0,0)` and for **white** `RGB(255,255,255)`. While `RGB(0,255,0)` creates **absolute green** `RGB(150,255,150)` will produce **light green**.

This supports **background** & **foreground** color, to set the color as **background color** you must pass it with `bg=True` which is `False` by default.

For Example: To set **red** as the **background color** it should be called as `RGB(255,0,0,True)` but to choose **red** as **font color** just call it as `RGB(255,0,0,False)` since `bg` is by default `False` this simplifies to just call it as `RGB(255,0,0)`

* * *

## 回答 #49

> 赞同：3
> 
> 时间：2021-08-11T20:02:44.207

当我在寻找如何为日志着色时，我被谷歌搬到了那里：

# 彩色原木

## 安装

```
pip install coloredlogs 
```

## 用法

##### 最少使用：

```
import logging
import coloredlogs

coloredlogs.install()  # install a handler on the root logger

logging.debug('message with level debug')
logging.info('message with level info')
logging.warning('message with level warning')
logging.error('message with level error')
logging.critical('message with level critical') 
```

结果： [![最少使用](https://i.stack.imgur.com/A1axw.png)](https://i.stack.imgur.com/A1axw.png)

##### 从消息级调试开始：

```
import logging
import coloredlogs

coloredlogs.install(level='DEBUG')  # install a handler on the root logger with level debug

logging.debug('message with level debug')
logging.info('message with level info')
logging.warning('message with level warning')
logging.error('message with level error')
logging.critical('message with level critical') 
```

结果： [![调试级别](https://i.stack.imgur.com/S3AAi.png)](https://i.stack.imgur.com/S3AAi.png)

##### 隐藏库中的消息：

```
import logging
import coloredlogs

logger = logging.getLogger(__name__)  # get a specific logger object
coloredlogs.install(level='DEBUG')  # install a handler on the root logger with level debug
coloredlogs.install(level='DEBUG', logger=logger)  # pass a specific logger object

logging.debug('message with level debug')
logging.info('message with level info')
logging.warning('message with level warning')
logging.error('message with level error')
logging.critical('message with level critical') 
```

结果： [![调试级别](https://i.stack.imgur.com/S3AAi.png)](https://i.stack.imgur.com/S3AAi.png)

##### 格式化日志消息：

```
import logging
import coloredlogs

logger = logging.getLogger(__name__)  # get a specific logger object
coloredlogs.install(level='DEBUG')  # install a handler on the root logger with level debug
coloredlogs.install(level='DEBUG', logger=logger)  # pass a specific logger object
coloredlogs.install(
    level='DEBUG', logger=logger,
    fmt='%(asctime)s.%(msecs)03d %(filename)s:%(lineno)d %(levelname)s %(message)s'
)

logging.debug('message with level debug')
logging.info('message with level info')
logging.warning('message with level warning')
logging.error('message with level error')
logging.critical('message with level critical') 
```

结果： [![格式化日志消息](https://i.stack.imgur.com/0aBWR.png)](https://i.stack.imgur.com/0aBWR.png)

##### 可用的格式属性：

*   `%(asctime)s`- 发出记录调用时作为人类可读字符串的时间
*   `%(created)f`- 发出记录调用时的浮点时间
*   `%(filename)s`- 文件名
*   `%(funcName)s`- 包含日志调用的函数名称
*   `%(hostname)s`- 系统主机名
*   `%(levelname)s`- 文本记录级别
*   `%(levelno)s`- 整数日志记录级别
*   `%(lineno)d`- 发出记录调用的行号
*   `%(message)s`- 传递给记录调用的消息（与 相同`%(msg)s`）
*   `%(module)s`- 发出记录调用的文件名不带扩展名
*   `%(msecs)d`- 发出记录调用时的毫秒部分
*   `%(msg)s`- 传递给记录调用的消息（与 相同`%(message)s`）
*   `%(name)s`- 记录器名称
*   `%(pathname)s`- 包含日志调用的文件的完整路径名
*   `%(process)d`- 进程 ID
*   `%(processName)s`- 进程名称
*   `%(programname)s`- 系统程序名
*   `%(relativeCreated)d`- 发出记录调用时的整数毫秒数，相对于加载记录模块的时间
*   `%(thread)d`- 线程 ID
*   `%(threadName)s`- 线程名称
*   `%(username)s`- 系统用户名

## 资料来源：

[彩色原木包](https://pypi.org/project/coloredlogs/)

[日志库](https://docs.python.org/3/library/logging.html#logrecord-attributes)

* * *

## 回答 #50

> 赞同：3
> 
> 时间：2020-12-28T09:40:16.610

```
print("\033[1;32;40m Bright Green  \n") 
```

![1](https://i.stack.imgur.com/esbQu.png)

* * *

## 回答 #51

> 赞同：2
> 
> 时间：2012-06-24T15:07:49.800

为了解决这个问题，我创建了一个非常简单的包来打印带有插值颜色代码的字符串，称为[icolor](https://github.com/brianmhunt/icolor)。

icolor 包含两个函数：`cformat`和`cprint`

```
from icolor import cformat # there is also cprint

cformat("This is #RED;a red string, partially with a #xBLUE;blue background")
'This is \x1b[31ma red string, partially with a \x1b[44mblue background\x1b[0m' 
```

包括所有 ANSI 颜色（例如`#RED;`、`#BLUE;`等）以及`#RESET;`、`#BOLD;`和其他颜色。

背景颜色有`x`前缀，所以绿色背景是`#xGREEN;`.

一个人可以逃脱`#`。`##`

鉴于其简单性，最好的文档可能[是代码本身](https://github.com/brianmhunt/icolor/blob/master/icolor.py)。

它[在 PYPI 上](http://pypi.python.org/pypi/icolor/1.0)，所以可以`sudo easy_install icolor`。

* * *

## 回答 #52

> 赞同：2
> 
> 时间：2014-12-01T17:35:07.027

您可以使用任何语言都可用的 shell 转义字符。这些转义字符以 ESC 字符开头，后跟多个参数。

例如，要输出一个红色的*“Hello, World!”* 终端中的字符串：

```
echo "\e[31m Hello, World! \e[0m" 
```

或者来自 Python 脚本：

```
print("\e[31m Hello world \e[0m") 
```

另外，我写了一篇关于[Escape 序列](http://shiroyasha.github.io/escape-sequences-a-quick-guide.html)的文章，可能可以帮助您更好地掌握这种机制。

* * *

## 回答 #53

> 赞同：2
> 
> 时间：2021-09-03T20:30:27.510

您可以使用该`pygments`模块来执行此操作。例如：

```
from pygments import console
print(pygments.console.colorize("red", "This text is red.")) 
```

这不允许您为终端提供十六进制颜色，但您可以尝试许多内置颜色，例如“蓝色”、“深绿色”、“黄色”等。

* * *

## 回答 #54

> 赞同：1
> 
> 时间：2013-09-20T18:06:12.110

我的两分钱（[PyColorTerm](https://github.com/dnmellen/pycolorterm)）：

安装：

```
sudo apt-get install python-pip
pip install pycolorterm 
```

Python脚本：

```
from pycolorterm import pycolorterm

with pycolorterm.pretty_output(pycolorterm.FG_GREEN) as out:
    out.write('Works OK!') 
```

“工作正常！” 显示为绿色。

* * *

## 回答 #55

> 赞同：1
> 
> 时间：2020-12-10T16:58:12.770

一些解决方案如：

```
fg = lambda text, color: "\33[38;5;" + str(color) + "m" + text + "\33[0m"
bg = lambda text, color: "\33[48;5;" + str(color) + "m" + text + "\33[0m"

def print_six(row, format, end="\n"):
    for col in range(6):
        color = row*6 + col - 2
        if color>=0:
            text = "{:3d}".format(color)
            print (format(text,color), end=" ")
        else:
            print(end="    ")   # Four spaces
    print(end=end)

for row in range(0, 43):
    print_six(row, fg, " ")
    print_six(row, bg)

print(fg("text", 160)) 
```

**或者**

```
def colored(r, g, b, text):
    return "\033[38;2;{};{};{}m{} \033[38;2;255;255;255m".format(r, g, b, text)

text = 'Hello, World!'
colored_text = colored(255, 0, 0, text)
print(colored_text) 
```

**或者**

```
class Color:
    COLOR = [f"\33[{i}m" for i in range(44)]

for i in range(44):
    print(Color.COLOR[i] + 'text') 
```

**可能无法**在 Windows 10 终端或 PowerShell 窗口上运行，或者它们可能是这些可能无法直接运行的其他情况。

但是在插入时，程序开头的这两行可能会有所帮助：

```
import os
os.system('') 
```

`os.system('')`允许您在终端中打印 ANSI 代码，根据您的选择为您的输出着色（但您可能需要调用其他特定于系统的函数，以便能够在终端中打印彩色文本）。

* * *

## 回答 #56

> 赞同：1
> 
> 时间：2021-06-25T14:46:43.637

*这个答案试图通过使用正则表达式*为文本块中的关键字着色来扩展将彩色文本写入终端的概念。

此答案还使用*Python*库[Rich](https://github.com/willmcgugan/rich)，在此问题的先前答案中简要介绍了该库。在这个答案中，我使用函数*rich.color.ANSI_COLOR_NAMES*来获取一个随机的颜色列表，用于突出显示预定义的搜索词。

```
import random
import re as regex
from rich import color
from rich import print

def create_dynamic_regex(search_words):
    """
    This function is used to create a dynamic regular expression
    string and a list of random colors. Both these elements will
    be used in the function colorize_text()

    :param search_words: list of search terms
    :return: regular expression search string and a list of colors
    :rtype: string, list
    """
    colors_required = create_list_of_colors(len(search_words))
    number_of_search_words = len(search_words)
    combined_string = ''
    for search_word in search_words:
        number_of_search_words -= 1
        if number_of_search_words != 0:
            current_string = ''.join(r'(\b' + search_word + r'\b)|')
            combined_string = (combined_string + current_string)
        elif number_of_search_words == 0:
            current_string = ''.join(r'(\b' + search_word + r'\b)')
            combined_string = (combined_string + current_string)
    return combined_string, colors_required

def random_color():
    """
    This function is used to create a random color using the
    Python package rich.
    :return: color name
    :rtype: string
    """
    selected_color = random.choice(list(color.ANSI_COLOR_NAMES.keys()))
    return selected_color

def create_list_of_colors(number_of_colors):
    """
    This function is used to generate a list of colors,
    which will be used in the function colorize_text()
    :param number_of_colors:
    :return: list of colors
    :rtype: list
    """
    list_of_colors = [random_color() for _ in range(number_of_colors)]
    return list_of_colors

def colorize_text(text, regex_string, array_of_colors):
    """
    This function is used to colorize specific words in a text string.
    :param text: text string potentially containing specific words to colorize.
    :param regex_string: regular expression search string
    :param array_of_colors: list of colors
    :return: colorized text
    :rtype: string
    """
    available_colors = array_of_colors
    word_regex = regex.compile(f"{regex_string}", regex.IGNORECASE)
    i = 0
    output = ""
    for word in word_regex.finditer(text):
        get_color = available_colors[word.lastindex - 1]
        output += "".join([text[i:word.start()],
                           "[%s]" % available_colors[word.lastindex - 1],
                           text[word.start():word.end()], "[/%s]" % available_colors[word.lastindex - 1]])
        i = word.end()
    return ''.join([output, text[word.end():]])

def generate_console_output(text_to_search, words_to_find):
    """
    This function is used generate colorized text that will
    be outputting to the console.

    :param text_to_search: text string potentially containing specific words to colorize.
    :param words_to_find: list of search terms.
    :return: A string containing colorized words.
    :rtype: string
    """
    search_terms, colors = create_dynamic_regex(words_to_find)
    colorize_html = colorize_text(text_to_search, search_terms, colors)
    print(colorize_html)

text = "The dog chased the cat that was looking for the mouse that the dog was playing with."
words = ['dog', 'cat', 'mouse']
generate_console_output(text, words) 
```

这是上面代码的打印输出：

[![在此处输入图像描述](https://i.stack.imgur.com/Z3qX4.png)](https://i.stack.imgur.com/Z3qX4.png)

我为文本着色创建了两个 GIST。

*   [彩色文本终端输出](https://gist.github.com/johnbumgarner/035fd1dda6044a03cefca0ea1d66fbec)
*   [彩色文本 HTML 输出](https://gist.github.com/johnbumgarner/5f7139b00bff22d9faa6a2badcc824fe#file-colorize_keywords_in_text_html_output-py)

# javascript - 在 JavaScript 或 Jquery 中测试对象的祖先/后代关系

> ID：287875
> 
> 赞同：17
> 
> 时间：2008-11-13T18:59:08.823
> 
> 标签：javascript, jquery, dom

我试图想出一个可重用的 JS 或 jQuery 函数，它可以让我测试一个对象是否是另一个对象的 DOM 后代。

我看过一个测试模型

```
$b.parents('nodename').length>0 
```

当您只需要检查一个元素是否是该名称的任何节点的子节点时，这真是太棒了。

但是特定节点呢？你不能测试

```
$b.parents($a).length>0 
```

因为 jQuery parents 将 nodename 表达式作为参数来过滤。

作为一点背景，我正在尝试测试文档单击事件的目标是否是特定对象的子对象。例如，如果 event.target 是 $b 的子级，则返回 true，否则返回 false。但是这个功能以后可能会产生其他影响。

谢谢！

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2012-11-27T15:57:06.740

```
a.contains(b) 
```

[这是一个使用Node.contains](https://developer.mozilla.org/en-US/docs/DOM/Node.contains)的纯 JavaScript 解决方案。该函数是包容性的，`a.contains(a)`计算结果为真。

IE9 中有一个极端情况：如果`b`是文本节点，`contains`则始终返回 false。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-13T19:16:05.187

在[使用 jQuery 对象的 jQuery 祖先中，](https://stackoverflow.com/questions/245241/jquery-ancestors-using-jquery-objects#245266)我建议

```
if ($(obj1).parents().index($(obj2)) >= 0) {
    // obj1 is a descendant of obj2
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T19:03:23.870

试试这个：

```
$('#foo').filter(function(){

   return $(this).parent().is('#foo-parent');

}); 
```

所以在这里我们选择所有的 foo 元素，然后只过滤以 foo-parent 作为其直接父级的元素。

如果您正在寻找当前对象的任何祖先是否符合规则，那么我想它应该是：

```
$('#foo').filter(function(){

   return $(this).parents().is('#foo-parent');

}); 
```

# visual-studio-2008 - Web 服务器找不到请求的资源

> ID：287897
> 
> 赞同：26
> 
> 时间：2008-11-13T19:06:52.303
> 
> 标签：visual-studio-2008, debugging, iis-7, windows-vista

我在 Vista Ultimate 32 SP1 上运行的 VS 2008 SP1 上有一个 .NET 3.5 Web 应用程序。我在默认网站下创建了一个应用程序。所以应用程序的 URL 是“ [http://localhost/mysite](http://localhost/mysite) ”。应用程序文件夹指向解决方案文件夹，它位于 iisroot 文件夹之外。在 IIS7 中为此 Web 应用程序“mysite”启用了匿名和集成身份验证 (Windows)。

我授予“网络服务”用户对应用程序文件夹（在 iisroot 之外）的完全权限。

当我按 F5 启动调试时，我得到“无法在 Web 服务器上开始调试。Web 服务器找不到请求的资源”。错误。

* * *

我启动了 TcpView (Sysinternals) 以查看实际运行的应用程序并在该端口上保持句柄，我发现没有应用程序在该端口上侦听。这真的很奇怪......有什么创意吗？

* * *

我可以毫无问题地点击 URL“ [http://localhost/mysite ”。](http://localhost/mysite)该 Web 应用程序设置为启动项目，Default.aspx 是启动页面。

项目中还有一个 .asmx 服务。Default.aspx 正在使用该 asmx 服务。AutoCompleteExtender（来自 AJAX Control Toolkit）正在使用这个 asmx 服务。

顺便说一句，一切正常。问题是调试...我怀疑是 asmx 服务造成的，但我不知道。这让我发疯...

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2012-12-03T20:25:53.777

对于在**Visual-Studio 2012 或 2013**和/或**Windows 8 或 10**中遇到此问题的用户，请执行以下操作。

您必须将 .Net 3.5（或 4.5）添加到“**打开或关闭 Windows 功能”**窗口。你可以通过：

> 控制面板 -> 程序 -> 打开或关闭 Windows 功能

![在此处输入图像描述](https://i.stack.imgur.com/Sbmdu.png)

单击文件夹中的`Asp.Net 3.5`和 `Asp.Net 4.5`复选框。`IIS > WWW Service > Application Development Features`

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2011-05-07T19:11:39.407

打开 IIS7（运行 > inetmgr）并转到功能视图。打开 ISAPI 和 CGI​​ 限制部分并检查您的 .Net 版本是否具有正确的限制（例如，如果您使用的是 4.0，则应该设置为“允许”）

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2012-04-17T19:13:22.923

另一个常见问题是站点或应用程序路径未启动。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-27T15:21:54.823

我有同样的问题并解决了。您可以尝试以下操作：导航到 Web 应用程序的根文件夹并找到具有“.csproj.user”扩展名的文件并删除它。关闭 Visual Studio 的所有实例并重新开始。然后按F5。否则按 CTRL+ALT+P 并附加到 w3wc.exe 进程。希望能帮助到你。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-11-27T11:07:02.763

刚刚设法在我的开发机器上解决了这个问题：我已经安装了 UrlScan，并且必须将 DEBUG 添加到 AllowVerbs 列表中。希望这可以给你其他的东西吗？

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-26T12:04:48.957

Installing Urlscan and changing the urlscan.ini with these changes solved the problem.

In ALLOWEXTENSIONS Section add .aspx and in ALLOWVERBS Section add DEBUG.

Don't forget to restart IIS.

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-17T14:22:14.967

我在 XP sp3 上遇到了同样的问题，而且我已经苦苦挣扎了好几天。将 .aspx 和 DEBUB 添加到 urlscan.ini 解决了这个问题。

多谢你们。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-09-24T06:37:53.553

就我而言，我必须为 IIS 重新注册 ASP.NET。您可以通过从命令提示符运行以下命令来完成

```
systemroot\Microsoft.NET\Framework\ versionNumber \aspnet_regiis -i 
```

*例如：* `C:\Windows\Microsoft.NET\Framework\v4.0.30319\aspnet_regiis -i`

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-10-23T16:25:42.283

就我而言，我必须修复 Web 服务扩展

管理工具 -> 管理我的服务器 -> IIS -> Web 服务扩展

ASP.NET 2.0 以某种方式被禁止，修复它并开始工作。

干杯!

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2017-01-05T14:13:44.503

对我来说，IIS 中的默认网站已停止，启动后，我设法让它工作

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-06-17T16:48:01.310

我刚刚遇到了同样的问题，但没有任何建议有效。

我的问题是我的项目 URL 设置为`http://localhost/service`. 将其更改为我的 IP 地址有效。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-13T21:40:46.360

这不应该是一个问题 - 你有什么作为你的启动页面？此外，在网络的“启动选项”中（在属性页面下），确保您选择了“启动 URL”并输入您上面提到的 URL。

您遇到的错误不应该是特定于权限的，所以我会在其他地方查看 - 还要检查您是否可以在调试之前成功点击 url（手动将 url 放入浏览器）“ [http://localhost/mysite](http://localhost/mysite) ”。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2012-08-22T05:47:40.247

这个问题的解决方案非常简单。如果网站指向不同的位置并且虚拟目录指向不同的目录，您将收到此错误。

我建议您将网站指向与虚拟目录相同的目录，问题就足够了。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2012-01-25T00:35:12.727

我正在使用带有 VS2005 和 IIS 7.5 的 Windows 7 32 位。我的 web.config 默认有 debug="true" 。我将 IIS 物理路径设置为指向开发文件夹，并按照上述提示进行操作。我没有使用 UrlScan。我以管理员身份运行 VS2005。我仍然无法让它工作。

它的工作原理是添加具有对开发网站根文件夹的完全访问权限的 IIS_IUSRS 帐户，并使用 CTRL+ALT+P（附加到进程）附加到 w3wp.exe。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2015-12-22T09:26:05.020

对我来说，有人更新了请求过滤的 web.config，特别是他们只允许 GET 和 POST 动词。要使用本地 IIS，您也需要允许 DEBUG 动词。

```
<verbs allowUnlisted="false">
     <add verb="GET" allowed="true" />
     <add verb="POST" allowed="true" />
     <add verb="DEBUG" allowed="true"/>
</verbs> 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2015-07-30T08:31:28.340

我也在 IIS 上使用默认网站，但无法通过调试或简单浏览来启动它。

原来默认站点已停止！开始了，一切顺利。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-11-16T08:35:51.327

你有没有尝试过：

*   UAT转向
*   将运行网站的用户（和/或您自己）添加到 Debuggers 或 Administrators 组（临时）
*   打开 IIS 日志记录

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-11-16T08:51:35.693

只是为了确保，您是否在 web.config 中设置了 Debug=true。通常，当您使用 VS 的内置 Web 服务器时，它能够检测到您正在尝试调试但调试标志已关闭并警告您。但是在您的情况下，您已经设置了 IIS，而 VS 可能无法进行此检查。

另一点是您在 Vista 上运行。在 vista 中即使你是系统的管理员，Vista 也不会将你视为管理员。您的安全令牌是作为普通用户创建的。为了调试 IIS 托管网站（注意：使用内置 Web 服务器时，VS 2008 管理调试），以管理员身份运行 VS 2008。那可以解决问题。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-11-27T10:52:27.987

我遇到了同样的问题，但是如果我通过“工具”->“附加到进程”菜单然后选择 aspnet_wp 进程，则可以进行调试。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2014-03-07T16:31:10.993

确保项目属性的 Web 选项卡中的项目 URL 不包含无效字符。就我而言，它有一个“+”字符，导致出现此错误。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2011-05-06T18:17:10.210

转到您的 Web 项目的属性，然后是“Web”选项卡，然后确保您使用的是 Visual Studio 开发服务器，而不是本地 IIS 或自定义 Web 服务器。我在 VS2010 上使用 Win7，而另一位开发人员正在使用自定义 Web 服务器 URL 而不是 VS Dev Server 进行开发

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2015-05-04T09:13:03.147

我的 web.config 中的这一部分导致了错误：

```
<security>
    <requestFiltering>
        <hiddenSegments>
            <add segment="......" />
            <add segment="....." />
            ........
        </hiddenSegments>
    </requestFiltering>
</security> 
```

仔细查看它 - 也许您的调试文件被限制在浏览器中直接查看。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2016-02-10T07:40:29.387

我尝试了一切都无济于事，但是一旦我将 csproj.user 从那里弄出来，低且看哪，该站点已加载。不要担心删除它，一旦站点加载，它将创建一个新站点。

# c# - 控制台应用程序的 IOC？

> ID：287899
> 
> 赞同：12
> 
> 时间：2008-11-13T19:07:09.103
> 
> 标签：c#, dependency-injection, inversion-of-control, console-application

谁能想到将 IOC 放入控制台应用程序的好解决方案？

目前我们只是使用具有以下方法的静态类：

```
public static T Resolve<T>()
{
    return dependencyResolver.Resolve<T>();
} 
```

我希望体验是无缝的，但想不出从控制台应用程序实现这一点的方法。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-11T22:46:49.267

您将不得不在`Resolve<T>()`某处进行服务定位调用 ( )。诀窍是让它尽可能不碍事。对于控制台应用程序，此引导发生在`Main()`方法中。在那里做，并尽量减少其他地方的那些 Resolve 调用，你会很棒的。对于大多数依赖项，使用构造函数注入。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-13T19:13:04.647

控制台应用程序对 IoC 的 Web 或表单应用程序没有任何限制。您可以使用任何您的选择（Spring、Ninject、Unity 等）。它们中的大多数都可以在您的控制台应用程序外部使用 XML 文件进行配置，而像 Ninjector 这样的一些需要在您的应用程序内部进行配置。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T19:08:34.407

我从控制台应用程序中使用了 Spring.NET，没有任何问题。你只需要把它指向你的配置文件，它就会连接所有的依赖项。当然，您*如何*处理这些对象取决于您的控制台应用程序正在尝试做什么。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T19:12:05.880

签出 Microsoft [Unity](http://www.codeplex.com/unity)。

# javascript - 如何保证我的枚举定义在 JavaScript 中不会改变？

> ID：287903
> 
> 赞同：2324
> 
> 时间：2008-11-13T19:09:06.620
> 
> 标签：javascript

以下是否会使对象满足枚举在 JavaScript 中的所有特征？就像是：

```
my.namespace.ColorEnum = {
  RED : 0,
  GREEN : 1,
  BLUE : 2
}

// later on

if(currentColor == my.namespace.ColorEnum.RED) {
  // whatever
} 
```

还是有其他方法可以做到这一点？

* * *

## 回答 #1

> 赞同：1162
> 
> 时间：2011-02-18T11:03:56.883

从 1.8.5 开始可以对[对象进行密封和冻结](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze)，因此将上述定义为：

```
const DaysEnum = Object.freeze({"monday":1, "tuesday":2, "wednesday":3, ...}) 
```

或者

```
const DaysEnum = {"monday":1, "tuesday":2, "wednesday":3, ...}
Object.freeze(DaysEnum) 
```

瞧！JS 枚举。

但是，这并不能阻止您将不需要的值分配给变量，这通常是枚举的主要目标：

```
let day = DaysEnum.tuesday
day = 298832342 // goes through without any errors 
```

确保更高程度的类型安全（使用枚举或其他方式）的一种方法是使用[TypeScript](https://www.typescriptlang.org/)或[Flow](https://flow.org/)之类的工具。

不需要引号，但我保留它们以保持一致性。

* * *

## 回答 #2

> 赞同：625
> 
> 时间：2008-11-13T19:13:40.947

这不是一个很好的答案，但我个人认为这很好用

话虽如此，由于值是什么并不重要（您使用了 0、1、2），我会使用有意义的字符串以防您想要输出当前值。

* * *

## 回答 #3

> 赞同：520
> 
> 时间：2010-03-04T22:31:20.837

## 更新

我认为我下面的答案不再是用 JavaScript 编写枚举的最佳方式。有关更多详细信息，请参阅我的博客文章：[JavaScript 中的枚举](https://stijndewitt.com/2014/01/26/enums-in-javascript/)。

* * *

已经可以提醒名称：

```
if (currentColor == my.namespace.ColorEnum.RED) {
   // alert name of currentColor (RED: 0)
   var col = my.namespace.ColorEnum;
   for (var name in col) {
     if (col[name] == col.RED)
       alert(name);
   }
} 
```

或者，您可以创建 values 对象，这样您就可以吃蛋糕了：

```
var SIZE = {
  SMALL : {value: 0, name: "Small", code: "S"}, 
  MEDIUM: {value: 1, name: "Medium", code: "M"}, 
  LARGE : {value: 2, name: "Large", code: "L"}
};

var currentSize = SIZE.MEDIUM;
if (currentSize == SIZE.MEDIUM) {
  // this alerts: "1: Medium"
  alert(currentSize.value + ": " + currentSize.name);
} 
```

在 JavaScript 中，由于它是一种动态语言，因此甚至可以稍后将枚举值添加到集合中：

```
// Add EXTRALARGE size
SIZE.EXTRALARGE = {value: 3, name: "Extra Large", code: "XL"}; 
```

请记住，枚举的字段（本例中的值、名称和代码）不是身份检查所必需的，只是为了方便起见。另外size属性本身的名字也不需要硬编码，也可以动态设置。因此，假设您只知道新枚举值的名称，您仍然可以毫无问题地添加它：

```
// Add 'Extra Large' size, only knowing it's name
var name = "Extra Large";
SIZE[name] = {value: -1, name: name, code: "?"}; 
```

当然，这意味着不能再做出某些假设（例如，该值代表大小的正确顺序）。

请记住，在 JavaScript 中，对象就像*地图*或*哈希表*。一组名称-值对。您可以循环浏览它们或以其他方式操纵它们，而无需提前了解它们。

## 例子

```
for (var sz in SIZE) {
  // sz will be the names of the objects in SIZE, so
  // 'SMALL', 'MEDIUM', 'LARGE', 'EXTRALARGE'
  var size = SIZE[sz]; // Get the object mapped to the name in sz
  for (var prop in size) {
    // Get all the properties of the size object, iterates over
    // 'value', 'name' and 'code'. You can inspect everything this way.        
  }
} 
```

顺便说一句，如果你对命名空间感兴趣，你可能想看看我的解决方案，它为 JavaScript 提供简单但强大的命名空间和依赖管理：[Packages JS](http://packagesinjavascript.wordpress.com/)

* * *

## 回答 #4

> 赞同：90
> 
> 时间：2009-08-21T20:56:51.510

底线：你不能。

你可以伪造它，但你不会得到类型安全。通常这是通过创建映射到整数值的字符串值的简单字典来完成的。例如：

```
var DaysEnum = {"monday":1, "tuesday":2, "wednesday":3, ...}

Document.Write("Enumerant: " + DaysEnum.tuesday); 
```

这种方法的问题？您可能会意外地重新定义您的枚举数，或者意外地拥有重复的枚举数值。例如：

```
DaysEnum.monday = 4; // whoops, monday is now thursday, too 
```

**编辑**

> Artur Czajka 的 Object.freeze 怎么样？这不会阻止您将星期一设置为星期四吗？- 炒四

绝对[`Object.freeze`](http://msdn.microsoft.com/en-us/library/windows/apps/ff806186%28v=vs.94%29.aspx)可以完全解决我抱怨的问题。我想提醒大家，当我写上面的时候，`Object.freeze`并不存在。

现在......现在它开辟了一些*非常*有趣的可能性。

**编辑 2**
这是一个非常好的创建枚举的库。

[http://www.2ality.com/2011/10/enums.html](http://www.2ality.com/2011/10/enums.html)

虽然它可能不适合枚举的所有有效用途，但它还有很长的路要走。

* * *

## 回答 #5

> 赞同：61
> 
> 时间：2011-07-13T00:28:18.327

这是我们都想要的：

```
function Enum(constantsList) {
    for (var i in constantsList) {
        this[constantsList[i]] = i;
    }
} 
```

现在您可以创建您的枚举：

```
var YesNo = new Enum(['NO', 'YES']);
var Color = new Enum(['RED', 'GREEN', 'BLUE']); 
```

通过这样做，可以以通常的方式访问常量（YesNo.YES，Color.GREEN）并且它们得到一个连续的 int 值（NO = 0，YES = 1；RED = 0，GREEN = 1，BLUE = 2）。

您还可以使用 Enum.prototype 添加方法：

```
Enum.prototype.values = function() {
    return this.allValues;
    /* for the above to work, you'd need to do
            this.allValues = constantsList at the constructor */
}; 
```

编辑 - 小改进 - 现在使用可变参数：（不幸的是，它在 IE 上无法正常工作：S ...应该坚持使用以前的版本）

```
function Enum() {
    for (var i in arguments) {
        this[arguments[i]] = i;
    }
}

var YesNo = new Enum('NO', 'YES');
var Color = new Enum('RED', 'GREEN', 'BLUE'); 
```

* * *

## 回答 #6

> 赞同：59
> 
> 时间：2015-05-05T16:32:11.860

在大多数现代浏览器中，有一种[符号](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol)原始数据类型可用于创建枚举。它将确保枚举的类型安全，因为 JavaScript 保证每个符号值都是唯一的，即`Symbol() != Symbol()`. 例如：

```
const COLOR = Object.freeze({RED: Symbol(), BLUE: Symbol()}); 
```

为了简化调试，您可以为枚举值添加描述：

```
const COLOR = Object.freeze({RED: Symbol("RED"), BLUE: Symbol("BLUE")}); 
```

[Plunker 演示](http://plnkr.co/edit/rGjzZlUF4HPdllaTQ3OW?p=preview)

在[GitHub 上](https://github.com/zhaber/symbol-enum)，您可以找到一个包装器，它简化了初始化枚举所需的代码：

```
const color = new Enum("RED", "BLUE")

color.RED.toString() // Symbol(RED)
color.getName(color.RED) // RED
color.size // 2
color.values() // Symbol(RED), Symbol(BLUE)
color.toString() // RED,BLUE 
```

* * *

## 回答 #7

> 赞同：42
> 
> 时间：2018-05-15T16:53:09.647

# -

让我们直接切入问题：文件大小。此处列出的所有其他答案都会使您的缩小代码膨胀到极致。我向您介绍，为了通过缩小、性能、代码可读性、大规模项目管理和许多代码编辑器中的语法提示来尽可能减少代码大小，这是进行枚举的正确方法：下划线符号变量。

* * *

# ![下划线符号变量](https://i.stack.imgur.com/vUCWq.png)

如上图和下例所示，以下是五个简单的入门步骤：

1.  确定枚举组的名称。想一个可以描述枚举目的的名词，或者至少可以描述枚举中的条目。例如，一组表示用户可选择颜色的枚举可能比 COLORS 更好地命名为 COLORCHOICES。
2.  决定组中的枚举是互斥的还是独立的。如果互斥，则以 . 开头的每个枚举变量名称`ENUM_`。如果独立或并排，请使用`INDEX_`.
3.  对于每个条目，创建一个新的局部变量，其名称以`ENUM_`or开头`INDEX_`，然后是组的名称，然后是下划线，然后是属性的唯一友好名称
4.  在最后添加一个`ENUMLENGTH_`, `ENUMLEN_`, `INDEXLENGTH_`, or `INDEXLEN_`（无论`LEN_`是`LENGTH_`个人喜好）枚举变量。您应该在代码中尽可能使用此变量，以确保向枚举添加额外条目并增加此值不会破坏您的代码。
5.  给每个连续的枚举变量一个比上一个大一的值，从 0 开始。这个页面上有评论说不`0`应该用作枚举值，因为`0 == null`, `0 == false`,`0 == ""`和其他 JS 疯狂。我向您提交，为了避免这个问题并同时提高性能，请始终使用`===`并且永远不要让`==`出现在您的代码中，除非使用`typeof`(ex `typeof X == "string"`)。在我使用 0 的所有岁月中`===`，我从来没有遇到过使用 0 作为枚举值的问题。如果您仍然心烦意乱，那么在许多情况下，可以将其用作枚举（但不是枚举）`1`中的起始值而不会造成性能损失。`ENUM_``INDEX_`

```
const ENUM_COLORENUM_RED   = 0;
const ENUM_COLORENUM_GREEN = 1;
const ENUM_COLORENUM_BLUE  = 2;
const ENUMLEN_COLORENUM    = 3;

// later on

if(currentColor === ENUM_COLORENUM_RED) {
   // whatever
} 
```

以下是我如何记住何时使用`INDEX_`和何时使用`ENUM_`：

```
// Precondition: var arr = []; //
arr[INDEX_] = ENUM_; 
```

但是，`ENUM_`在某些情况下，可以适当地作为索引，例如在计算每个项目的出现时。

```
const ENUM_PET_CAT = 0,
      ENUM_PET_DOG = 1,
      ENUM_PET_RAT = 2,
      ENUMLEN_PET  = 3;

var favoritePets = [ENUM_PET_CAT, ENUM_PET_DOG, ENUM_PET_RAT,
                    ENUM_PET_DOG, ENUM_PET_DOG, ENUM_PET_CAT,
                    ENUM_PET_RAT, ENUM_PET_CAT, ENUM_PET_DOG];

var petsFrequency = [];

for (var i=0; i<ENUMLEN_PET; i=i+1|0)
  petsFrequency[i] = 0;

for (var i=0, len=favoritePets.length|0, petId=0; i<len; i=i+1|0)
  petsFrequency[petId = favoritePets[i]|0] = (petsFrequency[petId]|0) + 1|0;

console.log({
    "cat": petsFrequency[ENUM_PET_CAT],
    "dog": petsFrequency[ENUM_PET_DOG],
    "rat": petsFrequency[ENUM_PET_RAT]
});
```

请注意，在上面的代码中，添加一种新的宠物非常容易：您只需在之后附加一个新条目`ENUM_PET_RAT`并相应地更新`ENUMLEN_PET`。在其他枚举系统中添加新条目可能更加困难和错误。

* * *

此外，这种枚举语法允许清晰简洁的类扩展，如下所示。要扩展一个类，请`LEN_`在父类的条目中添加一个递增的数字。然后，用自己的`LEN_`条目完成子类，以便将来可以进一步扩展子类。

![加法扩展图](https://i.stack.imgur.com/xIHxl.png)

```
(function(window){
    "use strict";
    var parseInt = window.parseInt;

    // use INDEX_ when representing the index in an array instance
    const INDEX_PIXELCOLOR_TYPE = 0, // is a ENUM_PIXELTYPE
          INDEXLEN_PIXELCOLOR   = 1,
          INDEX_SOLIDCOLOR_R    = INDEXLEN_PIXELCOLOR+0,
          INDEX_SOLIDCOLOR_G    = INDEXLEN_PIXELCOLOR+1,
          INDEX_SOLIDCOLOR_B    = INDEXLEN_PIXELCOLOR+2,
          INDEXLEN_SOLIDCOLOR   = INDEXLEN_PIXELCOLOR+3,
          INDEX_ALPHACOLOR_R    = INDEXLEN_PIXELCOLOR+0,
          INDEX_ALPHACOLOR_G    = INDEXLEN_PIXELCOLOR+1,
          INDEX_ALPHACOLOR_B    = INDEXLEN_PIXELCOLOR+2,
          INDEX_ALPHACOLOR_A    = INDEXLEN_PIXELCOLOR+3,
          INDEXLEN_ALPHACOLOR   = INDEXLEN_PIXELCOLOR+4,
    // use ENUM_ when representing a mutually-exclusive species or type
          ENUM_PIXELTYPE_SOLID = 0,
          ENUM_PIXELTYPE_ALPHA = 1,
          ENUM_PIXELTYPE_UNKNOWN = 2,
          ENUMLEN_PIXELTYPE    = 2;

    function parseHexColor(inputString) {
        var rawstr = inputString.trim().substring(1);
        var result = [];
        if (rawstr.length === 8) {
            result[INDEX_PIXELCOLOR_TYPE] = ENUM_PIXELTYPE_ALPHA;
            result[INDEX_ALPHACOLOR_R] = parseInt(rawstr.substring(0,2), 16);
            result[INDEX_ALPHACOLOR_G] = parseInt(rawstr.substring(2,4), 16);
            result[INDEX_ALPHACOLOR_B] = parseInt(rawstr.substring(4,6), 16);
            result[INDEX_ALPHACOLOR_A] = parseInt(rawstr.substring(4,6), 16);
        } else if (rawstr.length === 4) {
            result[INDEX_PIXELCOLOR_TYPE] = ENUM_PIXELTYPE_ALPHA;
            result[INDEX_ALPHACOLOR_R] = parseInt(rawstr[0], 16) * 0x11;
            result[INDEX_ALPHACOLOR_G] = parseInt(rawstr[1], 16) * 0x11;
            result[INDEX_ALPHACOLOR_B] = parseInt(rawstr[2], 16) * 0x11;
            result[INDEX_ALPHACOLOR_A] = parseInt(rawstr[3], 16) * 0x11;
        } else if (rawstr.length === 6) {
            result[INDEX_PIXELCOLOR_TYPE] = ENUM_PIXELTYPE_SOLID;
            result[INDEX_SOLIDCOLOR_R] = parseInt(rawstr.substring(0,2), 16);
            result[INDEX_SOLIDCOLOR_G] = parseInt(rawstr.substring(2,4), 16);
            result[INDEX_SOLIDCOLOR_B] = parseInt(rawstr.substring(4,6), 16);
        } else if (rawstr.length === 3) {
            result[INDEX_PIXELCOLOR_TYPE] = ENUM_PIXELTYPE_SOLID;
            result[INDEX_SOLIDCOLOR_R] = parseInt(rawstr[0], 16) * 0x11;
            result[INDEX_SOLIDCOLOR_G] = parseInt(rawstr[1], 16) * 0x11;
            result[INDEX_SOLIDCOLOR_B] = parseInt(rawstr[2], 16) * 0x11;
        } else {
            result[INDEX_PIXELCOLOR_TYPE] = ENUM_PIXELTYPE_UNKNOWN;
        }
        return result;
    }

    // the red component of green
    console.log(parseHexColor("#0f0")[INDEX_SOLIDCOLOR_R]);
    // the alpha of transparent purple
    console.log(parseHexColor("#f0f7")[INDEX_ALPHACOLOR_A]); 
    // the enumerated array for turquoise
    console.log(parseHexColor("#40E0D0"));
})(self);
```

（长度：2,450 字节）

有人可能会说这不如其他解决方案实用：它浪费大量空间，编写时间很长，而且它没有涂上糖语法。如果他们不缩小代码，这些人是对的。但是，没有一个理性的人会在最终产品中留下未缩小的代码。对于这个缩小，闭包编译器是我还没有找到的最好的。在线访问可以在[这里](https://closure-compiler.appspot.com/)找到。Closure 编译器能够获取所有这些枚举数据并将其内联，从而使您的 Javascript 变得超级小，运行速度超级快。因此，使用闭包编译器进行缩小。观察。

* * *

# [](https://closure-compiler.appspot.com/)

闭包编译器能够通过推理执行一些非常令人难以置信的优化，这些优化远远超出了任何其他 Javascript 压缩器的能力。Closure Compiler 能够内联设置为固定值的原始变量。Closure Compiler 还能够根据这些内联值进行推断，并消除 if 语句和循环中未使用的块。

![通过 Closure Compiler 编写代码](https://i.stack.imgur.com/2cadt.jpg)

```
'use strict';(function(e){function d(a){a=a.trim().substring(1);var b=[];8===a.length?(b[0]=1,b[1]=c(a.substring(0,2),16),b[2]=c(a.substring(2,4),16),b[3]=c(a.substring(4,6),16),b[4]=c(a.substring(4,6),16)):4===a.length?(b[1]=17*c(a[0],16),b[2]=17*c(a[1],16),b[3]=17*c(a[2],16),b[4]=17*c(a[3],16)):6===a.length?(b[0]=0,b[1]=c(a.substring(0,2),16),b[2]=c(a.substring(2,4),16),b[3]=c(a.substring(4,6),16)):3===a.length?(b[0]=0,b[1]=17*c(a[0],16),b[2]=17*c(a[1],16),b[3]=17*c(a[2],16)):b[0]=2;return b}var c=
e.parseInt;console.log(d("#0f0")[1]);console.log(d("#f0f7")[4]);console.log(d("#40E0D0"))})(self);
```

（长度：605 字节）

Closure Compiler 奖励您更聪明地编码和更好地组织代码，因为虽然许多压缩器会使用更大的压缩文件大小来惩罚有组织的代码，但如果您使用技巧，Closure Compiler 能够筛选您所有的清洁度和健全性以输出更小的文件大小像变量名枚举。在这个想法中，这就是编码的圣杯：一个工具既可以帮助你的代码缩小尺寸，又可以通过训练更好的编程习惯来帮助你的大脑。

* * *

现在，让我们看看没有这些枚举的等效文件有多大。

[不使用枚举的源](https://pastebin.com/embed_iframe/fcX5fN2V)（长度：1,973 字节（比枚举代码短 477 字节！））
[在不使用枚举的情况下缩小](https://pastebin.com/embed_iframe/97K6XLdU)（长度：843 字节（**比枚举代码长**238 字节））

![代码大小图表](https://i.stack.imgur.com/DX0nA.png)

正如所见，没有枚举，源代码更短，但代价是更大的缩小代码。我不了解你; 但我确信我不会将源代码合并到最终产品中。因此，这种枚举形式要优越得多，因为它会导致更小的压缩文件大小。

* * *

这种枚举形式的另一个优点是它可以用来轻松管理大型项目，而不会牺牲最小的代码大小。在与许多其他人一起处理大型项目时，明确标记和标记变量名称以及创建代码的人可能会有所帮助，以便可以快速识别代码的原始创建者以进行协作错误修复。

```
// JG = Jack Giffin
const ENUM_JG_COLORENUM_RED   = 0,
      ENUM_JG_COLORENUM_GREEN = 1,
      ENUM_JG_COLORENUM_BLUE  = 2,
      ENUMLEN_JG_COLORENUM    = 3;

// later on

if(currentColor === ENUM_JG_COLORENUM_RED) {
   // whatever
}

// PL = Pepper Loftus
// BK = Bob Knight
const ENUM_PL_ARRAYTYPE_UNSORTED   = 0,
      ENUM_PL_ARRAYTYPE_ISSORTED   = 1,
      ENUM_BK_ARRAYTYPE_CHUNKED    = 2, // added by Bob Knight
      ENUM_JG_ARRAYTYPE_INCOMPLETE = 3, // added by jack giffin
      ENUMLEN_PL_COLORENUM         = 4;

// later on

if(
  randomArray === ENUM_PL_ARRAYTYPE_UNSORTED ||
  randomArray === ENUM_BK_ARRAYTYPE_CHUNKED
) {
   // whatever
} 
```

* * *

# [[[[![](https://i.stack.imgur.com/OoOrv.png)]]]]

此外，这种枚举形式在缩小后也快得多。在普通的命名属性中，浏览器必须使用哈希图来查找属性在对象上的位置。尽管 JIT 编译器会智能地将这个位置缓存在对象上，但由于从对象中删除较低属性等特殊情况，仍然存在巨大的开销。

![](https://v8.dev/_img/elements-kinds/lattice.svg)

但是，对于连续的非稀疏整数索引[PACKED_ELEMENTS](https://v8.dev/blog/elements-kinds#the-elements-kind-lattice)数组，浏览器能够跳过大部分开销，因为已经指定了内部数组中值的索引。是的，根据 ECMAScript 标准，所有属性都应该被视为字符串。然而，ECMAScript 标准的这一方面在性能方面非常误导，因为所有浏览器都对数组中的数字索引进行了特殊优化。

```
/// Hashmaps are slow, even with JIT juice
var ref = {};
ref.count = 10;
ref.value = "foobar"; 
```

将上面的代码与下面的代码进行比较。

```
/// Arrays, however, are always lightning fast
const INDEX_REFERENCE_COUNT = 0;
const INDEX_REFERENCE_VALUE = 1;
const INDEXLENGTH_REFERENCE = 2;

var ref = [];
ref[INDEX_REFERENCE_COUNT] = 10;
ref[INDEX_REFERENCE_VALUE] = "foobar"; 
```

人们可能会反对带有枚举的代码似乎比带有普通对象的代码长得多，但看起来可能具有欺骗性。重要的是要记住，在使用史诗闭包编译器时，源代码大小与输出大小不成比例。观察。

```
/// Hashmaps are slow, even with JIT juice
var a={count:10,value:"foobar"}; 
```

上面是没有枚举的缩小代码，下面是带有枚举的缩小代码。

```
/// Arrays, however, are always lightning fast
var a=[10,"foobar"]; 
```

上面的示例表明，除了具有卓越的性能之外，枚举代码还导致更小的压缩文件大小。

* * *

此外，这个个人*最重要*的是使用这种枚举形式以及 Javascript 模式下的[CodeMirror](https://codemirror.net/)文本编辑器。CodeMirror 的 Javascript 语法高亮模式高亮显示当前范围内的局部变量。这样，当您正确输入变量名时，您会立即知道，因为如果变量名先前已使用`var`关键字声明，则变量名会变为特殊颜色（默认为青色）。即使你不使用 CodeMirror，那么至少浏览器会抛出一个有用的`*[variable name]* is not defined`执行枚举名称错误的代码时出现异常。此外，JSLint 和 Closure Compiler 等 JavaScript 工具会非常大声地告诉您何时输入错误的枚举变量名称。CodeMirror、浏览器和各种 Javascript 工具放在一起使调试这种枚举形式非常简单且非常容易。

![CodeMirror 高亮演示](https://i.stack.imgur.com/sSyEB.png)

```
const ENUM_COLORENUM_RED   = 0,
      ENUM_COLORENUM_GREEN = 1,
      ENUM_COLORENUM_BLUE  = 2,
      ENUMLEN_COLORENUM    = 3;
var currentColor = ENUM_COLORENUM_GREEN;

if(currentColor === ENUM_COLORENUM_RED) {
   // whatever
}

if(currentColor === ENUM_COLORENUM_DNE) {
   // whatever
}
```

在上面的代码段中，您收到错误警报，因为`ENUM_COLORENUM_DNE`不存在。

* * *

# 

我认为可以肯定地说，这种枚举方法确实是最好的方法，不仅可以缩小代码大小，还可以提高性能、调试和协作。

* * *

## 回答 #8

> 赞同：31
> 
> 时间：2018-03-15T21:09:11.080

## 使用 Javascript[代理](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy)

**TLDR：**将此类添加到您的实用程序方法并在整个代码中使用它，它模拟传统编程语言中的 Enum 行为，并且当您尝试访问不存在的枚举器或添加/更新枚举器时实际上会引发错误。无需依赖`Object.freeze()`。

```
class Enum {
  constructor(enumObj) {
    const handler = {
      get(target, name) {
        if (typeof target[name] != 'undefined') {
          return target[name];
        }
        throw new Error(`No such enumerator: ${name}`);
      },
      set() {
        throw new Error('Cannot add/update properties on an Enum instance after it is defined')
      }
    };

    return new Proxy(enumObj, handler);
  }
} 
```

然后通过实例化类来创建枚举：

```
const roles = new Enum({
  ADMIN: 'Admin',
  USER: 'User',
}); 
```

* * *

**完整解释：**

您从传统语言中获得的枚举的一个非常有益的特性是，如果您尝试访问不存在的枚举器，它们会崩溃（抛出编译时错误）。

除了冻结模拟的枚举结构以防止意外/恶意添加附加值之外，其他答案都没有解决枚举的内在特征。

您可能知道，在 JavaScript 中访问不存在的成员只会返回`undefined`并且不会破坏您的代码。由于枚举数是预定义的常量（即星期几），所以永远不应该存在未定义枚举数的情况。

不要误会，JavaScript`undefined`在访问未定义属性时返回的行为实际上是语言的一个非常强大的特性，但是当您尝试模拟传统的 Enum 结构时，它并不是您想要的特性。

这就是代理对象大放异彩的地方。随着 ES6 (ES2015) 的引入，代理在语言中被标准化。这是来自 MDN 的描述：

> Proxy 对象用于定义基本操作的自定义行为（例如属性查找、赋值、枚举、函数调用等）。

与 Web 服务器代理类似，JavaScript 代理能够拦截对对象的操作（使用“陷阱”，如果您愿意，可以称它们为钩子）并允许您在它们完成之前执行各种检查、操作和/或操作（或在某些情况下，当我们尝试引用一个不存在的枚举器时，完全停止操作，这正是我们想要做的）。

这是一个人为的例子，它使用 Proxy 对象来模仿 Enums。本例中的枚举器是标准的 HTTP 方法（即“GET”、“POST”等）：

```
// Class for creating enums (13 lines)
// Feel free to add this to your utility library in 
// your codebase and profit! Note: As Proxies are an ES6 
// feature, some browsers/clients may not support it and 
// you may need to transpile using a service like babel

class Enum {
  // The Enum class instantiates a JavaScript Proxy object.
  // Instantiating a `Proxy` object requires two parameters, 
  // a `target` object and a `handler`. We first define the handler,
  // then use the handler to instantiate a Proxy.

  // A proxy handler is simply an object whose properties
  // are functions which define the behavior of the proxy 
  // when an operation is performed on it. 

  // For enums, we need to define behavior that lets us check what enumerator
  // is being accessed and what enumerator is being set. This can be done by 
  // defining "get" and "set" traps.
  constructor(enumObj) {
    const handler = {
      get(target, name) {
        if (typeof target[name] != 'undefined') {
          return target[name]
        }
        throw new Error(`No such enumerator: ${name}`)
      },
      set() {
        throw new Error('Cannot add/update properties on an Enum instance after it is defined')
      }
    }

    // Freeze the target object to prevent modifications
    return new Proxy(enumObj, handler)
  }
}

// Now that we have a generic way of creating Enums, lets create our first Enum!
const httpMethods = new Enum({
  DELETE: "DELETE",
  GET: "GET",
  OPTIONS: "OPTIONS",
  PATCH: "PATCH",
  POST: "POST",
  PUT: "PUT"
})

// Sanity checks
console.log(httpMethods.DELETE)
// logs "DELETE"

try {
  httpMethods.delete = "delete"
} catch (e) {
console.log("Error: ", e.message)
}
// throws "Cannot add/update properties on an Enum instance after it is defined"

try {
  console.log(httpMethods.delete)
} catch (e) {
  console.log("Error: ", e.message)
}
// throws "No such enumerator: delete"
```

* * *

**旁白：代理到底是什么？**

我记得当我第一次开始到处看到代理这个词时，很长一段时间对我来说绝对没有意义。如果你现在就是这样，我认为概括代理的一种简单方法是将它们视为软件、机构，甚至是充当两台服务器、公司或人员之间的中间人或中间人的人。

* * *

## 回答 #9

> 赞同：23
> 
> 时间：2013-08-21T10:34:33.860

我一直在玩这个，因为我喜欢我的枚举。=)

使用`Object.defineProperty`我想我想出了一个可行的解决方案。

这是一个jsfiddle：http: [//jsfiddle.net/ZV4A6/](http://jsfiddle.net/ZV4A6/)

使用此方法.. 您应该（理论上）能够调用和定义任何对象的枚举值，而不会影响该对象的其他属性。

```
Object.defineProperty(Object.prototype,'Enum', {
    value: function() {
        for(i in arguments) {
            Object.defineProperty(this,arguments[i], {
                value:parseInt(i),
                writable:false,
                enumerable:true,
                configurable:true
            });
        }
        return this;
    },
    writable:false,
    enumerable:false,
    configurable:false
}); 
```

由于该属性，`writable:false`这*应该*使其类型安全。

所以你应该能够创建一个自定义对象，然后调用`Enum()`它。分配的值从 0 开始，每个项目递增。

```
var EnumColors={};
EnumColors.Enum('RED','BLUE','GREEN','YELLOW');
EnumColors.RED;    // == 0
EnumColors.BLUE;   // == 1
EnumColors.GREEN;  // == 2
EnumColors.YELLOW; // == 3 
```

* * *

## 回答 #10

> 赞同：17
> 
> 时间：2013-06-24T16:11:14.677

我知道这是一个旧的，但它通过 TypeScript 接口实现的方式是：

```
var MyEnum;
(function (MyEnum) {
    MyEnum[MyEnum["Foo"] = 0] = "Foo";
    MyEnum[MyEnum["FooBar"] = 2] = "FooBar";
    MyEnum[MyEnum["Bar"] = 1] = "Bar";
})(MyEnum|| (MyEnum= {})); 
```

这使您可以查找`MyEnum.Bar`返回 1 和`MyEnum[1]`返回 "Bar" 的两者，而不管声明的顺序如何。

* * *

## 回答 #11

> 赞同：17
> 
> 时间：2017-01-06T07:07:59.683

在[ES7](https://babeljs.io/docs/plugins/transform-class-properties/)中，你可以做一个优雅的 ENUM 依赖于静态属性：

```
class ColorEnum  {
    static RED = 0 ;
    static GREEN = 1;
    static BLUE = 2;
} 
```

然后

```
if (currentColor === ColorEnum.GREEN ) {/*-- coding --*/} 
```

优点（使用类而不是文字对象）是拥有一个父类`Enum`，然后您的所有枚举都将**扩展**该类。

```
 class ColorEnum  extends Enum {/*....*/} 
```

* * *

## 回答 #12

> 赞同：16
> 
> 时间：2015-07-26T12:03:10.270

创建一个对象字面量：

```
const Modes = {
  DRAGGING: 'drag',
  SCALING:  'scale',
  CLICKED:  'click'
}; 
```

* * *

## 回答 #13

> 赞同：15
> 
> 时间：2012-05-15T09:26:01.197

这是我使用的解决方案。

```
function Enum() {
    this._enums = [];
    this._lookups = {};
}

Enum.prototype.getEnums = function() {
    return _enums;
}

Enum.prototype.forEach = function(callback){
    var length = this._enums.length;
    for (var i = 0; i < length; ++i){
        callback(this._enums[i]);
    }
}

Enum.prototype.addEnum = function(e) {
    this._enums.push(e);
}

Enum.prototype.getByName = function(name) {
    return this[name];
}

Enum.prototype.getByValue = function(field, value) {
    var lookup = this._lookups[field];
    if(lookup) {
        return lookup[value];
    } else {
        this._lookups[field] = ( lookup = {});
        var k = this._enums.length - 1;
        for(; k >= 0; --k) {
            var m = this._enums[k];
            var j = m[field];
            lookup[j] = m;
            if(j == value) {
                return m;
            }
        }
    }
    return null;
}

function defineEnum(definition) {
    var k;
    var e = new Enum();
    for(k in definition) {
        var j = definition[k];
        e[k] = j;
        e.addEnum(j)
    }
    return e;
} 
```

你定义你的枚举是这样的：

```
var COLORS = defineEnum({
    RED : {
        value : 1,
        string : 'red'
    },
    GREEN : {
        value : 2,
        string : 'green'
    },
    BLUE : {
        value : 3,
        string : 'blue'
    }
}); 
```

这就是您访问枚举的方式：

```
COLORS.BLUE.string
COLORS.BLUE.value
COLORS.getByName('BLUE').string
COLORS.getByValue('value', 1).string

COLORS.forEach(function(e){
    // do what you want with e
}); 
```

我通常使用最后两种方法从消息对象映射枚举。

这种方法的一些优点：

*   易于声明枚举
*   轻松访问您的枚举
*   您的枚举可以是复杂类型
*   如果您经常使用 getByValue，则 Enum 类具有一些关联缓存

一些缺点：

*   那里正在进行一些混乱的内存管理，因为我保留了对枚举的引用
*   仍然没有类型安全

* * *

## 回答 #14

> 赞同：11
> 
> 时间：2012-04-24T14:04:46.513

如果您使用[Backbone ，则可以使用](http://documentcloud.github.com/backbone/)[Backbone.Collection](http://documentcloud.github.com/backbone/#Collection)免费获得完整的枚举功能（按 id、名称、自定义成员查找）。

```
// enum instance members, optional
var Color = Backbone.Model.extend({
    print : function() {
        console.log("I am " + this.get("name"))
    }
});

// enum creation
var Colors = new Backbone.Collection([
    { id : 1, name : "Red", rgb : 0xFF0000},
    { id : 2, name : "Green" , rgb : 0x00FF00},
    { id : 3, name : "Blue" , rgb : 0x0000FF}
], {
    model : Color
});

// Expose members through public fields.
Colors.each(function(color) {
    Colors[color.get("name")] = color;
});

// using
Colors.Red.print() 
```

* * *

## 回答 #15

> 赞同：8
> 
> 时间：2014-05-15T04:20:02.693

你的答案太复杂了

```
var buildSet = function(array) {
  var set = {};
  for (var i in array) {
    var item = array[i];
    set[item] = item;
  }
  return set;
}

var myEnum = buildSet(['RED','GREEN','BLUE']);
// myEnum.RED == 'RED' ...etc 
```

* * *

## 回答 #16

> 赞同：7
> 
> 时间：2013-04-11T12:11:18.367

我修改了 Andre 'Fi' 的解决方案：

```
 function Enum() {
    var that = this;
    for (var i in arguments) {
        that[arguments[i]] = i;
    }
    this.name = function(value) {
        for (var key in that) {
            if (that[key] == value) {
                return key;
            }
        }
    };
    this.exist = function(value) {
        return (typeof that.name(value) !== "undefined");
    };
    if (Object.freeze) {
        Object.freeze(that);
    }
  } 
```

测试：

```
var Color = new Enum('RED', 'GREEN', 'BLUE');
undefined
Color.name(Color.REDs)
undefined
Color.name(Color.RED)
"RED"
Color.exist(Color.REDs)
false
Color.exist(Color.RED)
true 
```

* * *

## 回答 #17

> 赞同：7
> 
> 时间：2015-09-18T18:08:54.293

我想出了[这种](https://github.com/vivin/enumjs)方法，它以 Java 中的枚举为模型。这些是类型安全的，因此您也可以执行`instanceof`检查。

您可以像这样定义枚举：

```
var Days = Enum.define("Days", ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"]); 
```

`Days`现在指的是`Days`枚举：

```
Days.Monday instanceof Days; // true

Days.Friday.name(); // "Friday"
Days.Friday.ordinal(); // 4

Days.Sunday === Days.Sunday; // true
Days.Sunday === Days.Friday; // false

Days.Sunday.toString(); // "Sunday"

Days.toString() // "Days { Monday, Tuesday, Wednesday, Thursday, Friday, Saturday, Sunday } "

Days.values().map(function(e) { return e.name(); }); //["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"]
Days.values()[4].name(); //"Friday"

Days.fromName("Thursday") === Days.Thursday // true
Days.fromName("Wednesday").name() // "Wednesday"
Days.Friday.fromName("Saturday").name() // "Saturday" 
```

实施：

```
var Enum = (function () {
    /**
     * Function to define an enum
     * @param typeName - The name of the enum.
     * @param constants - The constants on the enum. Can be an array of strings, or an object where each key is an enum
     * constant, and the values are objects that describe attributes that can be attached to the associated constant.
     */
    function define(typeName, constants) {

        /** Check Arguments **/
        if (typeof typeName === "undefined") {
            throw new TypeError("A name is required.");
        }

        if (!(constants instanceof Array) && (Object.getPrototypeOf(constants) !== Object.prototype)) {

            throw new TypeError("The constants parameter must either be an array or an object.");

        } else if ((constants instanceof Array) && constants.length === 0) {

            throw new TypeError("Need to provide at least one constant.");

        } else if ((constants instanceof Array) && !constants.reduce(function (isString, element) {
                return isString && (typeof element === "string");
            }, true)) {

            throw new TypeError("One or more elements in the constant array is not a string.");

        } else if (Object.getPrototypeOf(constants) === Object.prototype && !Object.keys(constants).reduce(function (isObject, constant) {
                return Object.getPrototypeOf(constants[constant]) === Object.prototype;
            }, true)) {

            throw new TypeError("One or more constants do not have an associated object-value.");

        }

        var isArray = (constants instanceof Array);
        var isObject = !isArray;

        /** Private sentinel-object used to guard enum constructor so that no one else can create enum instances **/
        function __() { };

        /** Dynamically define a function with the same name as the enum we want to define. **/
        var __enum = new Function(["__"],
            "return function " + typeName + "(sentinel, name, ordinal) {" +
                "if(!(sentinel instanceof __)) {" +
                    "throw new TypeError(\"Cannot instantiate an instance of " + typeName + ".\");" +
                "}" +

                "this.__name = name;" +
                "this.__ordinal = ordinal;" +
            "}"
        )(__);

        /** Private objects used to maintain enum instances for values(), and to look up enum instances for fromName() **/
        var __values = [];
        var __dict = {};

        /** Attach values() and fromName() methods to the class itself (kind of like static methods). **/
        Object.defineProperty(__enum, "values", {
            value: function () {
                return __values;
            }
        });

        Object.defineProperty(__enum, "fromName", {
            value: function (name) {
                var __constant = __dict[name]
                if (__constant) {
                    return __constant;
                } else {
                    throw new TypeError(typeName + " does not have a constant with name " + name + ".");
                }
            }
        });

        /**
         * The following methods are available to all instances of the enum. values() and fromName() need to be
         * available to each constant, and so we will attach them on the prototype. But really, they're just
         * aliases to their counterparts on the prototype.
         */
        Object.defineProperty(__enum.prototype, "values", {
            value: __enum.values
        });

        Object.defineProperty(__enum.prototype, "fromName", {
            value: __enum.fromName
        });

        Object.defineProperty(__enum.prototype, "name", {
            value: function () {
                return this.__name;
            }
        });

        Object.defineProperty(__enum.prototype, "ordinal", {
            value: function () {
                return this.__ordinal;
            }
        });

        Object.defineProperty(__enum.prototype, "valueOf", {
            value: function () {
                return this.__name;
            }
        });

        Object.defineProperty(__enum.prototype, "toString", {
            value: function () {
                return this.__name;
            }
        });

        /**
         * If constants was an array, we can the element values directly. Otherwise, we will have to use the keys
         * from the constants object.
         */
        var _constants = constants;
        if (isObject) {
            _constants = Object.keys(constants);
        }

        /** Iterate over all constants, create an instance of our enum for each one, and attach it to the enum type **/
        _constants.forEach(function (name, ordinal) {
            // Create an instance of the enum
            var __constant = new __enum(new __(), name, ordinal);

            // If constants was an object, we want to attach the provided attributes to the instance.
            if (isObject) {
                Object.keys(constants[name]).forEach(function (attr) {
                    Object.defineProperty(__constant, attr, {
                        value: constants[name][attr]
                    });
                });
            }

            // Freeze the instance so that it cannot be modified.
            Object.freeze(__constant);

            // Attach the instance using the provided name to the enum type itself.
            Object.defineProperty(__enum, name, {
                value: __constant
            });

            // Update our private objects
            __values.push(__constant);
            __dict[name] = __constant;
        });

        /** Define a friendly toString method for the enum **/
        var string = typeName + " { " + __enum.values().map(function (c) {
                return c.name();
            }).join(", ") + " } ";

        Object.defineProperty(__enum, "toString", {
            value: function () {
                return string;
            }
        });

        /** Freeze our private objects **/
        Object.freeze(__values);
        Object.freeze(__dict);

        /** Freeze the prototype on the enum and the enum itself **/
        Object.freeze(__enum.prototype);
        Object.freeze(__enum);

        /** Return the enum **/
        return __enum;
    }

    return {
        define: define
    }

})(); 
```

* * *

## 回答 #18

> 赞同：6
> 
> 时间：2015-07-02T13:03:17.260

IE8 不支持 freeze() 方法。
来源： http: [//kangax.github.io/compat-table/es5/](http://kangax.github.io/compat-table/es5/)，点击“显示过时的浏览器？” 在顶部，并检查 IE8 & freeze row col 交叉点。

在我目前的游戏项目中，我使用了以下，因为很少有客户还在使用 IE8：

```
var CONST_WILD_TYPES = {
    REGULAR: 'REGULAR',
    EXPANDING: 'EXPANDING',
    STICKY: 'STICKY',
    SHIFTING: 'SHIFTING'
}; 
```

我们还可以这样做：

```
var CONST_WILD_TYPES = {
    REGULAR: 'RE',
    EXPANDING: 'EX',
    STICKY: 'ST',
    SHIFTING: 'SH'
}; 
```

甚至这个：

```
var CONST_WILD_TYPES = {
    REGULAR: '1',
    EXPANDING: '2',
    STICKY: '3',
    SHIFTING: '4'
}; 
```

最后一个似乎对字符串最有效，如果您有服务器和客户端交换此数据，它会减少您的总带宽。
当然，现在您有责任确保数据中没有冲突（RE、EX 等必须是唯一的，1、2 等也应该是唯一的）。请注意，您需要永久维护这些以实现向后兼容性。

任务：

```
var wildType = CONST_WILD_TYPES.REGULAR; 
```

比较：

```
if (wildType === CONST_WILD_TYPES.REGULAR) {
    // do something here
} 
```

* * *

## 回答 #19

> 赞同：6
> 
> 时间：2020-02-19T21:21:15.963

我对任何答案都不满意，所以我制作了*Yet Another Enum (YEA!)*。

这个实现：

*   使用更多最新的 JS
*   只需声明这一类即可轻松创建枚举
*   具有按名称（`colors.RED`）、字符串（`colors["RED"]`）和索引（`colors[0]`）进行映射，但您只需要将字符串作为数组传入
*   将等效函数`toString()`和`valueOf()`函数绑定到每个枚举对象（如果不希望这样做，可以简单地删除它 - 虽然 JS 的开销很小）
*   具有可选的全局命名/按名称字符串存储
*   一旦创建就冻结枚举对象，使其无法修改

特别感谢[Andre 'Fi''s answer](https://stackoverflow.com/a/6672823/1599699)的一些启发。

* * *

**代码：**

```
class Enums {
  static create({ name = undefined, items = [] }) {
    let newEnum = {};
    newEnum.length = items.length;
    newEnum.items = items;
    for (let itemIndex in items) {
      //Map by name.
      newEnum[items[itemIndex]] = parseInt(itemIndex, 10);
      //Map by index.
      newEnum[parseInt(itemIndex, 10)] = items[itemIndex];
    }
    newEnum.toString = Enums.enumToString.bind(newEnum);
    newEnum.valueOf = newEnum.toString;
    //Optional naming and global registration.
    if (name != undefined) {
      newEnum.name = name;
      Enums[name] = newEnum;
    }
    //Prevent modification of the enum object.
    Object.freeze(newEnum);
    return newEnum;
  }
  static enumToString() {
    return "Enum " +
      (this.name != undefined ? this.name + " " : "") +
      "[" + this.items.toString() + "]";
  }
} 
```

* * *

**用法：**

```
let colors = Enums.create({
  name: "COLORS",
  items: [ "RED", "GREEN", "BLUE", "PORPLE" ]
});

//Global access, if named.
Enums.COLORS;

colors.items; //Array(4) [ "RED", "GREEN", "BLUE", "PORPLE" ]
colors.length; //4

colors.RED; //0
colors.GREEN; //1
colors.BLUE; //2
colors.PORPLE; //3
colors[0]; //"RED"
colors[1]; //"GREEN"
colors[2]; //"BLUE"
colors[3]; //"PORPLE"

colors.toString(); //"Enum COLORS [RED,GREEN,BLUE,PORPLE]"

//Enum frozen, makes it a real enum.
colors.RED = 9001;
colors.RED; //0 
```

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2015-01-29T01:32:23.880

```
var ColorEnum = {
    red: {},
    green: {},
    blue: {}
} 
```

您无需确保不会以这种方式将重复的数字分配给不同的枚举值。一个新对象被实例化并分配给所有枚举值。

* * *

## 回答 #21

> 赞同：5
> 
> 时间：2016-08-17T12:38:45.800

**最简单的解决方案：**

## 创造

```
var Status = Object.freeze({
    "Connecting":0,
    "Ready":1,
    "Loading":2,
    "Processing": 3
}); 
```

## 获得价值

```
console.log(Status.Ready) // 1 
```

## 获取密钥

```
console.log(Object.keys(Status)[Status.Ready]) // Ready 
```

* * *

## 回答 #22

> 赞同：5
> 
> 时间：2018-02-14T23:44:34.383

es7方式，（迭代器，冻结），用法：

```
const ThreeWiseMen = new Enum('Melchior', 'Caspar', 'Balthazar')

for (let name of ThreeWiseMen)
    console.log(name)

// with a given key
let key = ThreeWiseMen.Melchior

console.log(key in ThreeWiseMen) // true (string conversion, also true: 'Melchior' in ThreeWiseMen)

for (let entry from key.enum)
     console.log(entry)

// prevent alteration (throws TypeError in strict mode)
ThreeWiseMen.Me = 'Me too!'
ThreeWiseMen.Melchior.name = 'Foo' 
```

代码：

```
class EnumKey {

    constructor(props) { Object.freeze(Object.assign(this, props)) }

    toString() { return this.name }

}

export class Enum {

    constructor(...keys) {

        for (let [index, key] of keys.entries()) {

            Object.defineProperty(this, key, {

                value: new EnumKey({ name:key, index, enum:this }),
                enumerable: true,

            })

        }

        Object.freeze(this)

    }

    *[Symbol.iterator]() {

        for (let key of Object.keys(this))
            yield this[key]

    }

    toString() { return [...this].join(', ') }

} 
```

* * *

## 回答 #23

> 赞同：5
> 
> 时间：2020-06-13T10:06:52.620

这可能很有用：

```
const [CATS, DOGS, BIRDS] = ENUM(); 
```

实现简单高效：

```
function * ENUM(count=1) { while(true) yield count++ } 
```

生成器可以产生所需的确切整数序列，而无需知道有多少常量。它还可以支持一个可选参数，该参数指定从哪个（可能是负数）数字开始（默认为`1`）。

* * *

## 回答 #24

> 赞同：4
> 
> 时间：2013-10-01T09:02:56.170

一种快速简单的方法是：

```
var Colors = function(){
return {
    'WHITE':0,
    'BLACK':1,
    'RED':2,
    'GREEN':3
    }
}();

console.log(Colors.WHITE)  //this prints out "0" 
```

* * *

## 回答 #25

> 赞同：4
> 
> 时间：2015-03-16T10:42:33.447

这是实现[TypeScript 枚举](http://www.typescriptlang.org/Handbook#basic-types-enum)的几种不同方法。

最简单的方法是迭代一个对象，向对象添加反向键值对。唯一的缺点是您必须手动设置每个成员的值。

```
function _enum(list) {       
  for (var key in list) {
    list[list[key] = list[key]] = key;
  }
  return Object.freeze(list);
}

var Color = _enum({
  Red: 0,
  Green: 5,
  Blue: 2
});

// Color → {0: "Red", 2: "Blue", 5: "Green", "Red": 0, "Green": 5, "Blue": 2}
// Color.Red → 0
// Color.Green → 5
// Color.Blue → 2
// Color[5] → Green
// Color.Blue > Color.Green → false 
```

这是一个使用字符串创建枚举的[lodash mixin 。](https://lodash.com/docs#mixin)虽然这个版本涉及更多一点，但它会自动为您进行编号。本示例中使用的所有 lodash 方法都有一个常规的 JavaScript 等效方法，因此您可以根据需要轻松切换它们。

```
function enum() {
    var key, val = -1, list = {};
    _.reduce(_.toArray(arguments), function(result, kvp) {    
        kvp = kvp.split("=");
        key = _.trim(kvp[0]);
        val = _.parseInt(kvp[1]) || ++val;            
        result[result[val] = key] = val;
        return result;
    }, list);
    return Object.freeze(list);
}    

// Add enum to lodash 
_.mixin({ "enum": enum });

var Color = _.enum(
    "Red",
    "Green",
    "Blue = 5",
    "Yellow",
    "Purple = 20",
    "Gray"
);

// Color.Red → 0
// Color.Green → 1
// Color.Blue → 5
// Color.Yellow → 6
// Color.Purple → 20
// Color.Gray → 21
// Color[5] → Blue 
```

* * *

## 回答 #26

> 赞同：4
> 
> 时间：2015-04-27T11:13:58.847

我刚刚发布了一个 NPM 包[gen_enum](https://www.npmjs.com/package/gen_enum)允许您在 Javascript 中快速创建 Enum 数据结构：

```
var genEnum = require('gen_enum');

var AppMode = genEnum('SIGN_UP, LOG_IN, FORGOT_PASSWORD');
var curMode = AppMode.LOG_IN;
console.log(curMode.isLogIn()); // output true 
console.log(curMode.isSignUp()); // output false 
console.log(curMode.isForgotPassword()); // output false 
```

这个小工具的一个好处是在现代环境（包括 nodejs 和 IE 9+ 浏览器）中，返回的 Enum 对象是不可变的。

有关更多信息，请查看[https://github.com/greenlaw110/enumjs](https://github.com/greenlaw110/enumjs)

**更新**

我废弃`gen_enum`包并将函数合并到[constjs](https://www.npmjs.com/package/constjs)包中，它提供了更多功能，包括不可变对象、JSON 字符串反序列化、字符串常量和位图生成等。查看[https://www.npmjs.com/package/constjs](https://www.npmjs.com/package/constjs)了解更多信息

从升级`gen_enum`到`constjs`仅更改语句

```
var genEnum = require('gen_enum'); 
```

到

```
var genEnum = require('constjs').enum; 
```

* * *

## 回答 #27

> 赞同：4
> 
> 时间：2016-01-06T15:20:37.563

我创建了一个 Enum 类，它可以在 O(1) 处获取值和名称。它还可以生成一个包含所有名称和值的对象数组。

```
function Enum(obj) {
    // Names must be unique, Values do not.
    // Putting same values for different Names is risky for this implementation

    this._reserved = {
        _namesObj: {},
        _objArr: [],
        _namesArr: [],
        _valuesArr: [],
        _selectOptionsHTML: ""
    };

    for (k in obj) {
        if (obj.hasOwnProperty(k)) {
            this[k] = obj[k];
            this._reserved._namesObj[obj[k]] = k;
        }
    }
}
(function () {
    this.GetName = function (val) {
        if (typeof this._reserved._namesObj[val] === "undefined")
            return null;
        return this._reserved._namesObj[val];
    };

    this.GetValue = function (name) {
        if (typeof this[name] === "undefined")
            return null;
        return this[name];
    };

    this.GetObjArr = function () {
        if (this._reserved._objArr.length == 0) {
            var arr = [];
            for (k in this) {
                if (this.hasOwnProperty(k))
                    if (k != "_reserved")
                        arr.push({
                            Name: k,
                            Value: this[k]
                        });
            }
            this._reserved._objArr = arr;
        }
        return this._reserved._objArr;
    };

    this.GetNamesArr = function () {
        if (this._reserved._namesArr.length == 0) {
            var arr = [];
            for (k in this) {
                if (this.hasOwnProperty(k))
                    if (k != "_reserved")
                        arr.push(k);
            }
            this._reserved._namesArr = arr;
        }
        return this._reserved._namesArr;
    };

    this.GetValuesArr = function () {
        if (this._reserved._valuesArr.length == 0) {
            var arr = [];
            for (k in this) {
                if (this.hasOwnProperty(k))
                    if (k != "_reserved")
                        arr.push(this[k]);
            }
            this._reserved._valuesArr = arr;
        }
        return this._reserved._valuesArr;
    };

    this.GetSelectOptionsHTML = function () {
        if (this._reserved._selectOptionsHTML.length == 0) {
            var html = "";
            for (k in this) {
                if (this.hasOwnProperty(k))
                    if (k != "_reserved")
                        html += "<option value='" + this[k] + "'>" + k + "</option>";
            }
            this._reserved._selectOptionsHTML = html;
        }
        return this._reserved._selectOptionsHTML;
    };
}).call(Enum.prototype); 
```

你可以这样初始化它：

```
var enum1 = new Enum({
    item1: 0,
    item2: 1,
    item3: 2
}); 
```

要获取一个值（如 C# 中的枚举）：

```
var val2 = enum1.item2; 
```

获取一个值的名称（在为不同的名称放置相同的值时可能会产生歧义）：

```
var name1 = enum1.GetName(0);  // "item1" 
```

获取对象中每个名称和值的数组：

```
var arr = enum1.GetObjArr(); 
```

会产生：

```
[{ Name: "item1", Value: 0}, { ... }, ... ] 
```

您还可以轻松获取 html 选择选项：

```
var html = enum1.GetSelectOptionsHTML(); 
```

持有：

```
"<option value='0'>item1</option>..." 
```

* * *

## 回答 #28

> 赞同：4
> 
> 时间：2016-05-25T06:32:25.890

你可以做这样的事情

```
 var Enum = (function(foo) {

    var EnumItem = function(item){
        if(typeof item == "string"){
            this.name = item;
        } else {
            this.name = item.name;
        }
    }
    EnumItem.prototype = new String("DEFAULT");
    EnumItem.prototype.toString = function(){
        return this.name;
    }
    EnumItem.prototype.equals = function(item){
        if(typeof item == "string"){
            return this.name == item;
        } else {
            return this == item && this.name == item.name;
        }
    }

    function Enum() {
        this.add.apply(this, arguments);
        Object.freeze(this);
    }
    Enum.prototype.add = function() {
        for (var i in arguments) {
            var enumItem = new EnumItem(arguments[i]);
            this[enumItem.name] = enumItem;
        }
    };
    Enum.prototype.toList = function() {
        return Object.keys(this);
    };
    foo.Enum = Enum;
    return Enum;
})(this);
var STATUS = new Enum("CLOSED","PENDING", { name : "CONFIRMED", ackd : true });
var STATE = new Enum("CLOSED","PENDING","CONFIRMED",{ name : "STARTED"},{ name : "PROCESSING"}); 
```

正如这个库中定义的那样。 [https://github.com/webmodule/foo/blob/master/foo.js#L217](https://github.com/webmodule/foo/blob/master/foo.js#L217)

完整示例 [https://gist.github.com/lnt/bb13a2fd63cdb8bce85fd62965a20026](https://gist.github.com/lnt/bb13a2fd63cdb8bce85fd62965a20026)

* * *

## 回答 #29

> 赞同：4
> 
> 时间：2016-08-30T08:16:50.717

尽管ES2015 仅支持[静态方法](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Classes)（而不是静态属性）（参见[此处](http://exploringjs.com/es6/ch_classes.html#_inside-the-body-of-a-class-definition)，§15.2.2.2），但奇怪的是，您可以将下面的 Babel 与`es2015`预设一起使用：

```
class CellState {
    v: string;
    constructor(v: string) {
        this.v = v;
        Object.freeze(this);
    }
    static EMPTY       = new CellState('e');
    static OCCUPIED    = new CellState('o');
    static HIGHLIGHTED = new CellState('h');
    static values      = function(): Array<CellState> {
        const rv = [];
        rv.push(CellState.EMPTY);
        rv.push(CellState.OCCUPIED);
        rv.push(CellState.HIGHLIGHTED);
        return rv;
    }
}
Object.freeze(CellState); 
```

我发现即使跨模块（例如`CellState`从另一个模块导入枚举）以及当我使用 Webpack 导入模块时，它也能按预期工作。

**与大多数其他答案相比，此方法的优点是您可以将它与静态类型检查器**（例如[Flow](https://flowtype.org/)）一起使用，并且您可以在开发时使用静态类型检查断言您的变量、参数等是特定的`CellState`“ enum”而不是其他一些枚举（如果您使用通用对象或符号，则无法区分）。

# 更新

上面的代码有一个不足之处在于它允许创建其他类型的对象`CellState`（即使`CellState`由于它被冻结而不能将它们分配给静态字段）。尽管如此，以下更精炼的代码仍具有以下优点：

1.  `CellState`不能再创建类型的对象
2.  您可以保证没有两个枚举实例被分配相同的代码
3.  从字符串表示中获取枚举的实用方法
4.  返回枚举所有实例的`values`函数不必以上述手动（且容易出错）的方式创建返回值。

    ```
    'use strict';

    class Status {

    constructor(code, displayName = code) {
        if (Status.INSTANCES.has(code))
            throw new Error(`duplicate code value: [${code}]`);
        if (!Status.canCreateMoreInstances)
            throw new Error(`attempt to call constructor(${code}`+
           `, ${displayName}) after all static instances have been created`);
        this.code        = code;
        this.displayName = displayName;
        Object.freeze(this);
        Status.INSTANCES.set(this.code, this);
    }

    toString() {
        return `[code: ${this.code}, displayName: ${this.displayName}]`;
    }
    static INSTANCES   = new Map();
    static canCreateMoreInstances      = true;

    // the values:
    static ARCHIVED    = new Status('Archived');
    static OBSERVED    = new Status('Observed');
    static SCHEDULED   = new Status('Scheduled');
    static UNOBSERVED  = new Status('Unobserved');
    static UNTRIGGERED = new Status('Untriggered');

    static values      = function() {
        return Array.from(Status.INSTANCES.values());
    }

    static fromCode(code) {
        if (!Status.INSTANCES.has(code))
            throw new Error(`unknown code: ${code}`);
        else
            return Status.INSTANCES.get(code);
    }
    }

    Status.canCreateMoreInstances = false;
    Object.freeze(Status);
    exports.Status = Status; 
    ```

* * *

## 回答 #30

> 赞同：4
> 
> 时间：2018-05-01T11:32:52.327

这就是 Typescript 将其翻译`enum`成 Javascript 的方式：

```
var makeEnum = function(obj) {
    obj[ obj['Active'] = 1 ] = 'Active';
    obj[ obj['Closed'] = 2 ] = 'Closed';
    obj[ obj['Deleted'] = 3 ] = 'Deleted';
} 
```

现在：

```
makeEnum( NewObj = {} )
// => {1: "Active", 2: "Closed", 3: "Deleted", Active: 1, Closed: 2, Deleted: 3} 
```

起初我很困惑为什么`obj[1]`返回`'Active'`，但后来意识到它的死简单 -**赋值运算符**分配值然后返回它：

```
obj['foo'] = 1
// => 1 
```

* * *

## 回答 #31

> 赞同：3
> 
> 时间：2014-05-04T11:14:02.233

截至撰写时， 2014 年**10 月**- 所以这是一个当代解决方案。我将解决方案编写为节点模块，并包含使用 Mocha 和 Chai 以及 underscoreJS 的测试。您可以轻松地忽略这些，如果愿意，只需使用 Enum 代码。

看到很多帖子过于复杂的库等。在 Javascript 中获得枚举支持的解决方案非常简单，实际上不需要。这是代码：

文件：枚举.js

```
_ = require('underscore');

var _Enum = function () {

   var keys = _.map(arguments, function (value) {
      return value;
   });
   var self = {
      keys: keys
   };
   for (var i = 0; i < arguments.length; i++) {
      self[keys[i]] = i;
   }
   return self;
};

var fileFormatEnum = Object.freeze(_Enum('CSV', 'TSV'));
var encodingEnum = Object.freeze(_Enum('UTF8', 'SHIFT_JIS'));

exports.fileFormatEnum = fileFormatEnum;
exports.encodingEnum = encodingEnum; 
```

还有一个测试来说明它给你的东西：

文件：enumsSpec.js

```
var chai = require("chai"),
    assert = chai.assert,
    expect = chai.expect,
    should = chai.should(),
    enums = require('./enums'),
    _ = require('underscore');

describe('enums', function () {

    describe('fileFormatEnum', function () {
        it('should return expected fileFormat enum declarations', function () {
            var fileFormatEnum = enums.fileFormatEnum;
            should.exist(fileFormatEnum);
            assert('{"keys":["CSV","TSV"],"CSV":0,"TSV":1}' === JSON.stringify(fileFormatEnum), 'Unexpected format');
            assert('["CSV","TSV"]' === JSON.stringify(fileFormatEnum.keys), 'Unexpected keys format');
        });
    });

    describe('encodingEnum', function () {
        it('should return expected encoding enum declarations', function () {
            var encodingEnum = enums.encodingEnum;
            should.exist(encodingEnum);
            assert('{"keys":["UTF8","SHIFT_JIS"],"UTF8":0,"SHIFT_JIS":1}' === JSON.stringify(encodingEnum), 'Unexpected format');
            assert('["UTF8","SHIFT_JIS"]' === JSON.stringify(encodingEnum.keys), 'Unexpected keys format');
        });
    });

}); 
```

如您所见，您获得了一个 Enum 工厂，只需调用 enum.keys 即可获取所有键，并且您可以将键本身与整数常量匹配。您可以使用不同的值重用工厂，并使用 Node 的模块化方法导出这些生成的枚举。

再一次，如果您只是普通用户，或者在浏览器等中，只需使用代码的工厂部分，如果您不想在代码中使用下划线库，也可能会删除它。

* * *

## 回答 #32

> 赞同：3
> 
> 时间：2015-08-27T09:44:07.737

我认为它很容易使用。[https://stackoverflow.com/a/32245370/4365315](https://stackoverflow.com/a/32245370/4365315)

```
var A = {a:11, b:22}, 
enumA = new TypeHelper(A);

if(enumA.Value === A.b || enumA.Key === "a"){ 
... 
}

var keys = enumA.getAsList();//[object, object]

//set
enumA.setType(22, false);//setType(val, isKey)

enumA.setType("a", true);

enumA.setTypeByIndex(1); 
```

更新：

有我的助手代码（`TypeHelper`）。

```
var Helper = {
    isEmpty: function (obj) {
        return !obj || obj === null || obj === undefined || Array.isArray(obj) && obj.length === 0;
    },

    isObject: function (obj) {
        return (typeof obj === 'object');
    },

    sortObjectKeys: function (object) {
        return Object.keys(object)
            .sort(function (a, b) {
                c = a - b;
                return c
            });
    },
    containsItem: function (arr, item) {
        if (arr && Array.isArray(arr)) {
            return arr.indexOf(item) > -1;
        } else {
            return arr === item;
        }
    },

    pushArray: function (arr1, arr2) {
        if (arr1 && arr2 && Array.isArray(arr1)) {
            arr1.push.apply(arr1, Array.isArray(arr2) ? arr2 : [arr2]);
        }
    }
};
function TypeHelper() {
    var _types = arguments[0],
        _defTypeIndex = 0,
        _currentType,
        _value,
        _allKeys = Helper.sortObjectKeys(_types);

    if (arguments.length == 2) {
        _defTypeIndex = arguments[1];
    }

    Object.defineProperties(this, {
        Key: {
            get: function () {
                return _currentType;
            },
            set: function (val) {
                _currentType.setType(val, true);
            },
            enumerable: true
        },
        Value: {
            get: function () {
                return _types[_currentType];
            },
            set: function (val) {
                _value.setType(val, false);
            },
            enumerable: true
        }
    });
    this.getAsList = function (keys) {
        var list = [];
        _allKeys.forEach(function (key, idx, array) {
            if (key && _types[key]) {

                if (!Helper.isEmpty(keys) && Helper.containsItem(keys, key) || Helper.isEmpty(keys)) {
                    var json = {};
                    json.Key = key;
                    json.Value = _types[key];
                    Helper.pushArray(list, json);
                }
            }
        });
        return list;
    };

    this.setType = function (value, isKey) {
        if (!Helper.isEmpty(value)) {
            Object.keys(_types).forEach(function (key, idx, array) {
                if (Helper.isObject(value)) {
                    if (value && value.Key == key) {
                        _currentType = key;
                    }
                } else if (isKey) {
                    if (value && value.toString() == key.toString()) {
                        _currentType = key;
                    }
                } else if (value && value.toString() == _types[key]) {
                    _currentType = key;
                }
            });
        } else {
            this.setDefaultType();
        }
        return isKey ? _types[_currentType] : _currentType;
    };

    this.setTypeByIndex = function (index) {
        for (var i = 0; i < _allKeys.length; i++) {
            if (index === i) {
                _currentType = _allKeys[index];
                break;
            }
        }
    };

    this.setDefaultType = function () {
        this.setTypeByIndex(_defTypeIndex);
    };

    this.setDefaultType();
}

var TypeA = {
    "-1": "Any",
    "2": "2L",
    "100": "100L",
    "200": "200L",
    "1000": "1000L"
};

var enumA = new TypeHelper(TypeA, 4);

document.writeln("Key = ", enumA.Key,", Value = ", enumA.Value, "<br>");

enumA.setType("200L", false);
document.writeln("Key = ", enumA.Key,", Value = ", enumA.Value, "<br>");

enumA.setDefaultType();
document.writeln("Key = ", enumA.Key,", Value = ", enumA.Value, "<br>");

enumA.setTypeByIndex(1);
document.writeln("Key = ", enumA.Key,", Value = ", enumA.Value, "<br>");

document.writeln("is equals = ", (enumA.Value == TypeA["2"]));
```

* * *

## 回答 #33

> 赞同：3
> 
> 时间：2015-10-25T04:03:27.653

我写了**enumerationjs**一个[非常小的库来解决](https://github.com/sveinburne/enumerationjs#top)**确保类型安全**的问题，允许枚举常量**从原型继承**，保证枚举常量和枚举类型是不可变的+许多小特性。它允许重构大量代码并在枚举定义中移动一些逻辑。这是一个例子：

```
var CloseEventCodes = new Enumeration("closeEventCodes", {
  CLOSE_NORMAL:          { _id: 1000, info: "Connection closed normally" },
  CLOSE_GOING_AWAY:      { _id: 1001, info: "Connection closed going away" },
  CLOSE_PROTOCOL_ERROR:  { _id: 1002, info: "Connection closed due to protocol error"  },
  CLOSE_UNSUPPORTED:     { _id: 1003, info: "Connection closed due to unsupported operation" },
  CLOSE_NO_STATUS:       { _id: 1005, info: "Connection closed with no status" },
  CLOSE_ABNORMAL:        { _id: 1006, info: "Connection closed abnormally" },
  CLOSE_TOO_LARGE:       { _id: 1009, info: "Connection closed due to too large packet" }
},{ talk: function(){
    console.log(this.info); 
  }
});

CloseEventCodes.CLOSE_TOO_LARGE.talk(); //prints "Connection closed due to too large packet"
CloseEventCodes.CLOSE_TOO_LARGE instanceof CloseEventCodes //evaluates to true 
```

`Enumeration`基本上是工厂。

[完整的文档指南可在此处获得。](https://github.com/sveinburne/enumerationjs/blob/master/JS.GUIDE.MD#top)希望这可以帮助。

* * *

## 回答 #34

> 赞同：3
> 
> 时间：2018-09-19T15:11:08.920

```
class Enum {
  constructor (...vals) {
    vals.forEach( val => {
      const CONSTANT = Symbol(val);
      Object.defineProperty(this, val.toUpperCase(), {
        get () {
          return CONSTANT;
        },
        set (val) {
          const enum_val = "CONSTANT";
          // generate TypeError associated with attempting to change the value of a constant
          enum_val = val;
        }
      });
    });
  }
} 
```

使用示例：

```
const COLORS = new Enum("red", "blue", "green"); 
```

* * *

## 回答 #35

> 赞同：3
> 
> 时间：2020-10-18T17:45:08.317

**2020 年11 月 5 日更新：**
修改为包含静态字段和方法，以更接近地复制“真实”枚举行为。

有没有人尝试过使用包含私有字段和“get”访问器的类来做到这一点？我意识到此时私有类字段仍处于试验阶段，但它似乎可以用于创建具有不可变字段/属性的类。浏览器支持也不错。唯一不支持它的“主要”浏览器是 Firefox（我相信他们很快就会支持）和 IE（谁在乎）。

*免责声明*：
我不是开发人员。我只是在寻找这个问题的答案，并开始思考我有时如何通过创建具有私有字段和受限属性访问器的类来在 C# 中创建“增强”枚举。

***样本类***

```
class Sizes {
    // Private Fields
    static #_SMALL = 0;
    static #_MEDIUM = 1;
    static #_LARGE = 2;

    // Accessors for "get" functions only (no "set" functions)
    static get SMALL() { return this.#_SMALL; }
    static get MEDIUM() { return this.#_MEDIUM; }
    static get LARGE() { return this.#_LARGE; }
} 
```

您现在应该能够直接调用您的枚举。

```
Sizes.SMALL; // 0
Sizes.MEDIUM; // 1
Sizes.LARGE; // 2 
```

使用私有字段和有限访问器的组合意味着枚举值得到了很好的保护。

```
Sizes.SMALL = 10 // Sizes.SMALL is still 0
Sizes._SMALL = 10 // Sizes.SMALL is still 0
Sizes.#_SMALL = 10 // Sizes.SMALL is still 0 
```

* * *

## 回答 #36

> 赞同：2
> 
> 时间：2013-09-26T16:46:37.757

不久前我使用`__defineGetter__`和`__defineSetter__`或`defineProperty`取决于 JS 版本的混合来完成它。

这是我制作的枚举生成函数：[https ://gist.github.com/gfarrell/6716853](https://gist.github.com/gfarrell/6716853)

你会这样使用它：

```
var Colours = Enum('RED', 'GREEN', 'BLUE'); 
```

它会创建一个不可变的 string:int 字典（一个枚举）。

* * *

## 回答 #37

> 赞同：2
> 
> 时间：2016-05-11T10:31:36.307

你可以试试这个：

```
 var Enum = Object.freeze({
            Role: Object.freeze({ Administrator: 1, Manager: 2, Supervisor: 3 }),
            Color:Object.freeze({RED : 0, GREEN : 1, BLUE : 2 })
            });

    alert(Enum.Role.Supervisor);
    alert(Enum.Color.GREEN);
    var currentColor=0;
    if(currentColor == Enum.Color.RED) {
       alert('Its Red');
    } 
```

* * *

## 回答 #38

> 赞同：1
> 
> 时间：2014-09-05T19:09:07.643

真的很喜欢上面@Duncan 所做的，但我不喜欢用 Enum 搞砸全局 Object 函数空间，所以我写了以下内容：

```
function mkenum_1()
{
  var o = new Object();
  var c = -1;
  var f = function(e, v) { Object.defineProperty(o, e, { value:v, writable:false, enumerable:true, configurable:true })};

  for (i in arguments) {
    var e = arguments[i];
    if ((!!e) & (e.constructor == Object))
      for (j in e)
        f(j, (c=e[j]));
    else
      f(e, ++c);
    }

  return Object.freeze ? Object.freeze(o) : o;
}

var Sizes = mkenum_1('SMALL','MEDIUM',{LARGE: 100},'XLARGE');

console.log("MED := " + Sizes.MEDIUM);
console.log("LRG := " + Sizes.LARGE);

// Output is:
// MED := 1
// LRG := 100 
```

@Stijin 也有一个简洁的解决方案（参考他的博客），其中包括这些对象的属性。我也为此编写了一些代码，接下来将包括在内。

```
function mkenum_2(seed)
{
    var p = {};

    console.log("Seed := " + seed);

    for (k in seed) {
        var v = seed[k];

        if (v instanceof Array)
            p[(seed[k]=v[0])] = { value: v[0], name: v[1], code: v[2] };
        else
            p[v] = { value: v, name: k.toLowerCase(), code: k.substring(0,1) };
    }
    seed.properties = p;

    return Object.freeze ? Object.freeze(seed) : seed;
} 
```

这个版本产生了一个额外的属性列表，允许友好的名称转换和短代码。我喜欢这个版本，因为不需要像代码那样在属性中重复数据输入。

```
var SizeEnum2 = mkenum_2({ SMALL: 1, MEDIUM: 2, LARGE: 3});
var SizeEnum3 = mkenum_2({ SMALL: [1, "small", "S"], MEDIUM: [2, "medium", "M"], LARGE: [3, "large", "L"] }); 
```

这两者可以组合成一个单独的处理单元 mkenum，（使用枚举、赋值、创建和添加属性列表）。但是，由于我今天已经在这方面花费了太多时间，所以我将把这个组合作为练习留给亲爱的读者。

* * *

## 回答 #39

> 赞同：1
> 
> 时间：2015-02-15T13:18:27.200

您可以使用[Object.prototype.hasOwnProperty()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/hasOwnProperty)

```
var findInEnum,
    colorEnum = {
    red : 0,
    green : 1,
    blue : 2
};

// later on

findInEnum = function (enumKey) {
  if (colorEnum.hasOwnProperty(enumKey)) {
    return enumKey+' Value: ' + colorEnum[enumKey]
  }
}

alert(findInEnum("blue"))
```

* * *

## 回答 #40

> 赞同：1
> 
> 时间：2015-03-17T08:43:28.710

**我**认为什么是枚举：它是一个始终可访问的不可变对象，您可以将项目相互比较，但项目具有共同的属性/方法，但对象本身或值不能更改，它们只被实例化一次。

枚举用于比较数据类型、设置、采取/回复之类的操作。

因此，为此您需要具有相同实例的对象，以便您可以检查它是否是枚举类型`if(something instanceof enum)` 此外，如果您获得一个枚举对象，您希望能够用它做一些事情，无论枚举类型如何，它都应该始终响应同样的方法。

在我的例子中，它比较数据类型的值，但它可以是任何东西，从在 3d 游戏中修改面向方向的块到将值传递到特定的对象类型注册表。

请记住，它是 javascript 并且不提供固定的枚举类型，因此您最终总是会制作自己的实现，并且正如该线程所显示的那样，存在大量实现而没有一个是绝对正确的。

* * *

这就是我用于枚举的。由于枚举是不可变的（或者至少应该是不可变的），因此我冻结了对象，因此它们不能被轻松操作。

EnumField.STRING 可以使用枚举，并且它们有自己的方法可以使用它们的类型。要测试是否有东西传递给了一个对象，你可以使用`if(somevar instanceof EnumFieldSegment)`

它可能不是最优雅的解决方案，我愿意改进，但这种类型的不可变枚举（除非你解冻它）正是我需要的用例。

我也意识到我可以用 {} 覆盖原型，但我的想法在这种格式下工作得更好;-) 射击我。

```
/**
 * simple parameter object instantiator
 * @param name
 * @param value
 * @returns
 */
function p(name,value) {
    this.name = name;
    this.value = value;
    return Object.freeze(this);
}
/**
 * EnumFieldSegmentBase
 */
function EnumFieldSegmentBase() {
    this.fieldType = "STRING";
}
function dummyregex() {
}
dummyregex.prototype.test = function(str) {
    if(this.fieldType === "STRING") {
        maxlength = arguments[1];
        return str.length <= maxlength;
    }
    return true;
};

dummyregexposer = new dummyregex();
EnumFieldSegmentBase.prototype.getInputRegex = function() { 
    switch(this.fieldType) {
        case "STRING" :     return dummyregexposer;  
        case "INT":         return /^(\d+)?$/;
        case "DECIMAL2":    return /^\d+(\.\d{1,2}|\d+|\.)?$/;
        case "DECIMAL8":    return /^\d+(\.\d{1,8}|\d+|\.)?$/;
        // boolean is tricky dicky. if its a boolean false, if its a string if its empty 0 or false its  false, otherwise lets see what Boolean produces
        case "BOOLEAN":     return dummyregexposer;
    }
};
EnumFieldSegmentBase.prototype.convertToType = function($input) {
    var val = $input;
    switch(this.fieldType) {
        case "STRING" :         val = $input;break;
        case "INT":         val==""? val=0 :val = parseInt($input);break;
        case "DECIMAL2":    if($input === "" || $input === null) {$input = "0"}if($input.substr(-1) === "."){$input = $input+0};val = new Decimal2($input).toDP(2);break;
        case "DECIMAL8":    if($input === "" || $input === null) {$input = "0"}if($input.substr(-1) === "."){$input = $input+0};val = new Decimal8($input).toDP(8);break;
        // boolean is tricky dicky. if its a boolean false, if its a string if its empty 0 or false its  false, otherwise lets see what Boolean produces
        case "BOOLEAN":     val = (typeof $input == 'boolean' ? $input : (typeof $input === 'string' ? (($input === "false" || $input === "" || $input === "0") ? false : true) : new Boolean($input).valueOf()))  ;break;
    }
    return val;
};
EnumFieldSegmentBase.prototype.convertToString = function($input) {
    var val = $input;
    switch(this.fieldType) {
        case "STRING":      val = $input;break;
        case "INT":         val = $input+"";break;
        case "DECIMAL2":    val = $input.toPrecision(($input.toString().indexOf('.') === -1 ? $input.toString().length+2 : $input.toString().indexOf('.')+2)) ;break;
        case "DECIMAL8":    val = $input.toPrecision(($input.toString().indexOf('.') === -1 ? $input.toString().length+8 : $input.toString().indexOf('.')+8)) ;break;
        case "BOOLEAN":     val = $input ? "true" : "false"  ;break;
    }
    return val;
};
EnumFieldSegmentBase.prototype.compareValue = function($val1,$val2) {
    var val = false;
    switch(this.fieldType) {
        case "STRING":      val = ($val1===$val2);break;
        case "INT":         val = ($val1===$val2);break;
        case "DECIMAL2":    val = ($val1.comparedTo($val2)===0);break;
        case "DECIMAL8":    val = ($val1.comparedTo($val2)===0);break;
        case "BOOLEAN":     val = ($val1===$val2);break;
    }
    return val;
};

/**
 * EnumFieldSegment is an individual segment in the 
 * EnumField
 * @param $array An array consisting of object p
 */
function EnumFieldSegment() {
    for(c=0;c<arguments.length;c++) {
        if(arguments[c] instanceof p) {
            this[arguments[c].name] = arguments[c].value;
        }
    }
    return Object.freeze(this); 
}
EnumFieldSegment.prototype = new EnumFieldSegmentBase();
EnumFieldSegment.prototype.constructor = EnumFieldSegment;

/**
 * Simple enum to show what type of variable a Field type is.
 * @param STRING
 * @param INT
 * @param DECIMAL2
 * @param DECIMAL8
 * @param BOOLEAN
 * 
 */
EnumField = Object.freeze({STRING:      new EnumFieldSegment(new p("fieldType","STRING")), 
                            INT:        new EnumFieldSegment(new p("fieldType","INT")), 
                            DECIMAL2:   new EnumFieldSegment(new p("fieldType","DECIMAL2")), 
                            DECIMAL8:   new EnumFieldSegment(new p("fieldType","DECIMAL8")), 
                            BOOLEAN:    new EnumFieldSegment(new p("fieldType","BOOLEAN"))}); 
```

* * *

## 回答 #41

> 赞同：1
> 
> 时间：2016-11-02T22:20:01.893

Alien 的解决方案是让事情尽可能简单：

1.  使用枚举关键字（保留在 javascript 中）
2.  如果 enum 关键字只是保留但未在您的 javascript 中实现，请定义以下内容

    ```
    const enumerate = spec => spec.split(/\s*,\s*/)
      .reduce((e, n) => Object.assign(e,{[n]:n}), {}) 
    ```

现在，您可以轻松使用它

```
const kwords = enumerate("begin,end, procedure,if")
console.log(kwords, kwords.if, kwords.if == "if", kwords.undef) 
```

我认为没有理由将枚举值设为显式变量。无论如何，脚本都是形态的，如果您的代码的一部分是字符串或有效代码，这没有区别。真正重要的是，无论何时使用或定义它们，您都不需要处理大量的引号。

* * *

## 回答 #42

> 赞同：1
> 
> 时间：2019-04-15T19:16:01.030

阅读所有答案，并没有找到任何非冗长和干燥的解决方案。我使用这个单线：

```
const modes = ['DRAW', 'SCALE', 'DRAG'].reduce((o, v) => ({ ...o, [v]: v }), {}); 
```

它生成一个具有人类可读值的对象：

```
{
  DRAW: 'DRAW',
  SCALE: 'SCALE',
  DRAG: 'DRAG'
} 
```

* * *

## 回答 #43

> 赞同：0
> 
> 时间：2015-05-05T06:20:54.660

```
var DaysEnum = Object.freeze ({ monday: {}, tuesday: {}, ... }); 
```

您无需指定*id*，只需使用空对象来比较枚举即可。

```
if (incommingEnum === DaysEnum.monday) //incommingEnum is monday 
```

**编辑：**如果您要序列化对象（例如 JSON），您将再次输入*id*。

*   [（取自 Gabriel Llamas 评论）](https://stackoverflow.com/questions/287903/enums-in-javascript#comment12864576_5040502)
*   [（根据 Stijn de Witt 的评论进行编辑）](https://stackoverflow.com/questions/287903/enums-in-javascript/30045582?noredirect=1#comment71130974_30045582)

* * *

## 回答 #44

> 赞同：0
> 
> 时间：2017-04-12T08:13:24.453

您可以尝试使用[https://bitbucket.org/snippets/frostbane/aAjxM](https://bitbucket.org/snippets/frostbane/aAjxM)。

```
my.namespace.ColorEnum = new Enum(
    "RED = 0",
    "GREEN",
    "BLUE"
) 
```

它应该工作到ie8。

* * *

## 回答 #45

> 赞同：0
> 
> 时间：2017-07-26T11:13:42.763

您可以使用一个简单的函数来反转键和值，它也适用于数组，因为它将数字整数字符串转换为数字。对于这个和其他用例，代码很小、简单且可重用。

```
var objInvert = function (obj) {
    var invert = {}
    for (var i in obj) {
      if (i.match(/^\d+$/)) i = parseInt(i,10)
      invert[obj[i]] = i
    }
    return invert
}

var musicStyles = Object.freeze(objInvert(['ROCK', 'SURF', 'METAL',
'BOSSA-NOVA','POP','INDIE']))

console.log(musicStyles)
```

* * *

## 回答 #46

> 赞同：0
> 
> 时间：2018-08-25T17:27:51.983

这个答案是针对特定情况的替代方法。我需要一组基于属性子值的位掩码常量（属性值是数组或值列表的情况）。它包含等效于几个重叠的枚举。

我创建了一个类来存储和生成位掩码值。然后，我可以通过这种方式使用伪常数位掩码值来测试，例如，RGB 值中是否存在绿色：

```
if (value & Ez.G) {...} 
```

在我的代码中，我只创建了这个类的一个实例。如果不实例化类的至少一个实例，似乎没有一种干净的方法可以做到这一点。这是类声明和位掩码值生成代码：

```
class Ez {
constructor() {
    let rgba = ["R", "G", "B", "A"];
    let rgbm = rgba.slice();
    rgbm.push("M");              // for feColorMatrix values attribute
    this.createValues(rgba);
    this.createValues(["H", "S", "L"]);
    this.createValues([rgba, rgbm]);
    this.createValues([attX, attY, attW, attH]);
}
createValues(a) {                // a for array
    let i, j;
    if (isA(a[0])) {             // max 2 dimensions
        let k = 1;
        for (i of a[0]) {
            for (j of a[1]) {
                this[i + j] = k;
                k *= 2;
            }
        }
    }
    else {                       // 1D array is simple loop
        for (i = 0, j = 1; i < a.length; i++, j *= 2)
            this[a[i]] = j;
   }
} 
```

二维数组用于 SVG feColorMatrix 值属性，它是 RGBA 与 RGBAM 的 4x5 矩阵，其中 M 是乘数。生成的 Ez 属性为 Ez.RR、Ez.RG 等。

* * *

## 回答 #47

> 赞同：0
> 
> 时间：2020-07-16T07:41:49.407

```
export const ButtonType = Object.freeze({ 
   DEFAULT: 'default', 
   BIG: 'big', 
   SMALL: 'small'
}) 
```

来源：[https ://medium.com/@idanlevi2/enum-in-javascript-5f2ff500f149](https://medium.com/@idanlevi2/enum-in-javascript-5f2ff500f149)

* * *

## 回答 #48

> 赞同：0
> 
> 时间：2020-11-01T11:30:59.810

这是我对（标记的）`Enum`工厂的看法。这是一个[工作演示](https://jsfiddle.net/KooiInc/1527adxq/)。

```
/*
 * Notes: 
 * The proxy handler enables case insensitive property queries
 * BigInt is used to enable bitflag strings /w length > 52
*/
function EnumFactory() {
  const proxyfy = {
    construct(target, args) { 
      const caseInsensitiveHandler = { 
          get(target, key) {
          return target[key.toUpperCase()] || target[key];  
        } 
      };
      const proxified = new Proxy(new target(...args), caseInsensitiveHandler ); 
      return Object.freeze(proxified);
    },
  }
  const ProxiedEnumCtor = new Proxy(EnumCtor, proxyfy);
  const throwIf = (
      assertion = false, 
      message = `Unspecified error`, 
      ErrorType = Error ) => 
      assertion && (() => { throw new ErrorType(message); })();
  const hasFlag = (val, sub) => {
    throwIf(!val || !sub, "valueIn: missing parameters", RangeError);
    const andVal = (sub & val);
    return andVal !== BigInt(0) && andVal === val;
  };

  function EnumCtor(values) {
    throwIf(values.constructor !== Array || 
            values.length < 2 || 
        values.filter( v => v.constructor !== String ).length > 0,
      `EnumFactory: expected Array of at least 2 strings`, TypeError);
    const base = BigInt(1);
    this.NONE = BigInt(0);
    values.forEach( (v, i) => this[v.toUpperCase()] = base<<BigInt(i) );
  }

  EnumCtor.prototype = {
    get keys() { return Object.keys(this).slice(1); },
    subset(sub) {
      const arrayValues = this.keys;
      return new ProxiedEnumCtor(
        [...sub.toString(2)].reverse()
          .reduce( (acc, v, i) => ( +v < 1 ? acc : [...acc, arrayValues[i]] ), [] )
      );
    },
    getLabel(enumValue) {
      const tryLabel = Object.entries(this).find( value => value[1] === enumValue );
      return !enumValue || !tryLabel.length ? 
        "getLabel: no value parameter or value not in enum" :
        tryLabel.shift();
    },
    hasFlag(val, sub = this) { return hasFlag(val, sub); },
  };

  return arr => new ProxiedEnumCtor(arr);
} 
```

* * *

## 回答 #49

> 赞同：0
> 
> 时间：2022-02-07T22:20:05.637

我也在寻找这个问题的答案，并发现这个页面有一个我认为接缝与这里的大多数答案不同的答案： [https ://www.sohamkamani.com/javascript/enums/](https://www.sohamkamani.com/javascript/enums/)

我会将文章的答案部分复制到此处，以防万一将来链接无效或其他情况：

> **带符号的枚举：**
> 
> [符号](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol)让我们定义了保证不会相互冲突的值。
> 
> 例如：

```
const Summer1 = Symbol("summer")
const Summer2 = Symbol("summer")

// Even though they have the same apparent value
// Summer1 and Summer2 don't equate
console.log(Summer1 === Summer2)
// false

console.log(Summer1) 
```

> 我们可以使用 Symbols 定义我们的枚举以确保它们不重复：

```
const Summer = Symbol("summer")
const Autumn = Symbol("autumn")
const Winter = Symbol("winter")
const Spring = Symbol("spring")

let season = Spring

switch (season) {
    case Summer:
    console.log('the season is summer')
    break;
    case Winter:
    console.log('the season is winter')
    break;
    case Spring:
    console.log('the season is spring')
    break;
    case Autumn:
    console.log('the season is autumn')
    break;
    default:
    console.log('season not defined')
} 
```

> 使用符号确保我们可以分配枚举值的唯一方法是使用我们最初定义的常量。

> **带类的枚举：**

> 为了使我们的代码在语义上更正确，我们可以创建一个类来保存一组枚举。
> 
> 例如，我们的季节应该有一种方法可以让我们识别它们都属于类似的分类。
> 
> 让我们看看如何使用类和对象来创建不同的枚举组：

```
// Season enums can be grouped as static members of a class
class Season {
  // Create new instances of the same class as static attributes
  static Summer = new Season("summer")
  static Autumn = new Season("autumn")
  static Winter = new Season("winter")
  static Spring = new Season("spring")

  constructor(name) {
    this.name = name
  }
}

// Now we can access enums using namespaced assignments
// this makes it semantically clear that "Summer" is a "Season"
let season = Season.Summer

// We can verify whether a particular variable is a Season enum
console.log(season instanceof Season)
// true
console.log(Symbol('something') instanceof Season)
//false

// We can explicitly check the type based on each enums class
console.log(season.constructor.name)
// 'Season' 
```

*个人注意：我会改用这个构造函数：（注意：将：设置`this.name`为字符串而不是对象，会丢失下面的一些验证。可以选择删除：`.description`。我还想找到一种不必输入的方法`Seasons.summer.name`但只需要：`Seasons.summer`使其返回一个字符串）*

```
 constructor(name) {
    this.name = Symbol(name).description
  } 
```

> **列出所有可能的枚举值：**

> 如果我们使用上面基于类的方法，我们可以循环访问 Season 类的键来获取同一组下的所有枚举值：

```
Object.keys(Season).forEach(season => console.log("season:", season))
// season: Summer
// season: Autumn
// season: Winter
// season: Spring 
```

> **何时在 Javascript 中使用枚举？**

> 一般来说，如果任何一个变量都有一定数量的固定值，枚举是有帮助的_
> 
> 例如，Node.js 的[加密](https://nodejs.org/api/crypto.html#crypto)标准库有一个[支持的算法列表](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/create-hmac/index.d.ts#L15)，可以被认为是一个枚举组。
> 
> 在 Javascript 中正确使用枚举将导致更好的代码更稳定、更易于阅读且不易出错。

# mobile - 在智能手机和网站之间传输数据的最佳方式？

> ID：287907
> 
> 赞同：1
> 
> 时间：2008-11-13T19:09:32.437
> 
> 标签：mobile, communication

我想在智能手机应用程序和网站之间传输数据。有哪些传统和不那么传统的做法？

到目前为止，这是我的想法：

1.  简单的 HTTP GET/POST 数据被表示为 JSON 数组字符串，其变体被加密/压缩字符串作为参数。
2.  Web服务调用（我不确定这是否可能，只是猜测）
3.  两步通信：智能手机往返桌面应用程序往返网站）（开发/使用繁琐）

另外，我需要考虑什么来避免垃圾邮件/窥探？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T19:20:39.950

我认为前两个几乎相同。如果您要发送大量数据，您想要做的是 HTTP Post，或者如果数据量较少，您想要做的是带有查询字符串的 GET。这一切都将是未加密的传输，因此在使用 HTTP 时请记住这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T19:21:12.163

如果您的目标是令人信服、安全和易于开发。我会让客户端（电话）使用 POST 通过 HTTPS 向服务器发出请求。发送的数据应该是您的目标系统可用的任何库。不错的选择是 URL 编码参数、XML 和 JSON。避免使用二进制协议。

这种方法的缺点是使用从设备到 Web 服务的网络连接可能不可用或价格昂贵，这取决于用户的计划。（随着当前的智能手机浪潮（iPhone/gPhone/Blackberry 等），这种情况变得越来越少）这也是一个轮询接口，因此将数据从服务器推送到手机是很棘手的，并且依赖于用户发起一些操作。

根据电话平台的不同，您还可以使用 SMS 进行双向通信。这里的限制是隐私、带宽和成本。根据用户计划，SMS 发送 ip 数据的成本更高。（有时是接收）双向技巧是通过在电话应用程序中注册一个 SMS 挂钩来执行的。因此，当收到某个 SMS 时，应用程序可以自动启动并通知。

请发布其他信息，例如目标平台，我可以讨论更多选项。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T19:23:12.457

如果您使用 .NET Compact Framework 并为 Windows Mobile 进行开发，最简单的方法是使用 Web 服务。但是，.NET Web 服务将所有内容序列化为冗长的 XML，这使得来回发送的数据的大小超出了必须的大小。使用 JSON 是一种减少数据大小的好方法，即使在使用 .NET Web 服务时也是如此（诀窍是将整个 JSON 文档作为单个参数发送）。最小化传输数据的大小对于智能手机应用程序尤其重要，因为您的数据传输可能会通过蜂窝网络完成。

# actionscript-3 - 使用 Actionscript 解码分块的 HTTP

> ID：287920
> 
> 赞同：0
> 
> 时间：2008-11-13T19:14:08.700
> 
> 标签：actionscript-3, http, sockets, chunking

我已通过套接字成功连接到带有 ActionScript 3 的 HTTP 服务器。唯一的问题是，服务器正在发送分块的 HTTP。是否有任何其他语言的通用函数可以清楚地显示如何解码分块？我很确定这方面没有 ActionScript 库。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-14T10:21:16.527

[HTTP 1.1 规范](http://www.greenbytes.de/tech/webdav/rfc2616.htm)（或来自[W3C](http://www.w3.org/Protocols/)）提供了如何[解码分块传输编码](http://www.greenbytes.de/tech/webdav/rfc2616.html#rfc.section.19.4.6)的伪代码示例：

```
length := 0
read chunk-size, chunk-extension (if any) and CRLF
while (chunk-size > 0) {
   read chunk-data and CRLF
   append chunk-data to entity-body
   length := length + chunk-size
   read chunk-size and CRLF
}
read entity-header
while (entity-header not empty) {
   append entity-header to existing header fields
   read entity-header
}
Content-Length := length
Remove "chunked" from Transfer-Encoding 
```

# c# - 如何在 C# 中重载方括号运算符？

> ID：287928
> 
> 赞同：264
> 
> 时间：2008-11-13T19:20:22.633
> 
> 标签：c#, collections, operators, operator-overloading

例如，DataGridView 允许您执行以下操作：

```
DataGridView dgv = ...;
DataGridViewCell cell = dgv[1,5]; 
```

但在我的一生中，我找不到关于索引/方括号运算符的文档。他们怎么称呼它？它在哪里实施？能扔吗？我怎样才能在自己的课堂上做同样的事情？

ETA：感谢所有快速回答。简而言之：相关文档在“Item”属性下；重载的方法是声明一个像`public object this[int x, int y]{ get{...}; set{...} }`; 至少根据文档，DataGridView 的索引器不会抛出。它没有提到如果您提供无效坐标会发生什么。

ETA 再次：好的，即使文档没有提到它（顽皮的微软！），事实证明，如果您提供无效坐标，DataGridView 的索引器实际上会抛出 ArgumentOutOfRangeException。公平警告。

* * *

## 回答 #1

> 赞同：392
> 
> 时间：2008-11-13T19:25:19.957

[你可以在这里](http://msdn.microsoft.com/en-us/library/6x16t2tx.aspx)找到如何做。简而言之就是：

```
public object this[int i]
{
    get { return InnerList[i]; }
    set { InnerList[i] = value; }
} 
```

如果您只需要一个 getter，也可以使用[下面答案中](https://stackoverflow.com/a/34098286/21733)的语法（从 C# 6 开始）。

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2008-11-13T19:26:09.440

那将是项目属性：http: [//msdn.microsoft.com/en-us/library/0ebtbkkc.aspx](http://msdn.microsoft.com/en-us/library/0ebtbkkc.aspx)

也许这样的事情会起作用：

```
public T Item[int index, int y]
{ 
    //Then do whatever you need to return/set here.
    get; set; 
} 
```

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2008-11-13T19:23:43.860

```
Operators                           Overloadability

+, -, *, /, %, &, |, <<, >>         All C# binary operators can be overloaded.

+, -, !,  ~, ++, --, true, false    All C# unary operators can be overloaded.

==, !=, <, >, <= , >=               All relational operators can be overloaded, 
                                    but only as pairs.

&&, ||                              They can't be overloaded

() (Conversion operator)            They can't be overloaded

+=, -=, *=, /=, %=                  These compound assignment operators can be 
                                    overloaded. But in C#, these operators are
                                    automatically overloaded when the respective
                                    binary operator is overloaded.

=, . , ?:, ->, new, is, as, sizeof  These operators can't be overloaded

    [ ]                             Can be overloaded but not always! 
```

[信息来源](http://www.csharphelp.com/2006/03/c-operator-overloading/)

对于支架：

```
public Object this[int index]
{

} 
```

＃＃但

数组索引运算符**不能重载**；但是，类型可以定义索引器，即采用一个或多个参数的属性。索引器参数括在方括号中，就像数组索引一样，但索引器参数可以声明为任何类型（与数组索引不同，数组索引必须是整数）。

来自[MSDN](http://msdn.microsoft.com/en-us/library/a3hd7ste(VS.71).aspx)

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2015-12-04T22:06:58.450

如果您使用的是 C# 6 或更高版本，则可以对 get-only 索引器使用表达式主体语法：

`public object this[int i] => this.InnerList[i];`

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-13T19:25:08.443

```
public class CustomCollection : List<Object>
{
    public Object this[int index]
    {
        // ...
    }
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-21T20:36:57.047

对于 CLI C++（使用 /clr 编译），请参阅[此 MSDN 链接](http://msdn.microsoft.com/en-us/library/ms235303.aspx)。

简而言之，可以为属性命名为“default”：

```
ref class Class
{
 public:
  property System::String^ default[int i]
  {
    System::String^ get(int i) { return "hello world"; }
  }
}; 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-13T19:27:48.720

这是一个从内部 List 对象返回值的示例。应该给你的想法。

```
 public object this[int index]
  {
     get { return ( List[index] ); }
     set { List[index] = value; }
  } 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-13T19:29:14.753

如果你的意思是数组索引器，你只需编写一个索引器属性就可以重载它。只要每个索引器属性都有不同的参数签名，你就可以重载（写多少就写多少）索引器属性

```
public class EmployeeCollection: List<Employee>
{
    public Employee this[int employeeId]
    {   
        get 
        { 
            foreach(var emp in this)
            {
                if (emp.EmployeeId == employeeId)
                    return emp;
            }

            return null;
        }
    }

    public Employee this[string employeeName]
    {   
        get 
        { 
            foreach(var emp in this)
            {
                if (emp.Name == employeeName)
                    return emp;
            }

            return null;
        }
    }
} 
```

# visual-studio - 如何提高 Visual Studio 2008 网站编译性能

> ID：287935
> 
> 赞同：3
> 
> 时间：2008-11-13T19:23:02.800
> 
> 标签：visual-studio

在 Visual Studio 2008（针对 .Net 3.5）中编译一个中等大小的 ASP.Net 网站时，我遇到了严重的性能问题。我知道有一些技巧和注册表技巧可以提高 VS 2005 中的编译性能，VS 2008 有吗？具体来说，似乎每次按下 F5 时 VS 2008 都会编译整个网站，即使自上次编译以来该项目中没有任何文件发生更改，或者可能有某种方法可以跳过验证阶段？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T00:41:32.613

*   **防病毒问题**：确保您的防病毒程序排除了您的项目目录！确保 Windows 目录中的 Microsoft.NET 目录也在排除列表中。

*   **IIS 与“Cassini”**：如果可以，请使用 IIS 而不是 VS 的集成 Web 服务器（又名“Cassini”）。这样做可以防止每次运行时都必须重新启动服务器。

*   **内存**：你有足够的吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T00:46:01.187

.Net 3.5 Service Pack 1 至少在 IDE 和从代码视图切换到设计视图方面取得了一些巨大的性能提升。我不知道它是否会影响一般的编译速度，但如果你还没有的话，它是值得申请的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-12T00:23:42.573

我猜这是一个 ASP.Net 网站项目，而*不是*一个 ASP.Net Web 应用程序项目。您将从 Web 应用程序项目中获得更好的编译性能，因此您可以考虑对其进行转换。

对于网站项目，您可以在 Visual Studio 中打开网站，右键单击解决方案资源管理器中的网站项目节点，然后单击属性。当对话框打开时，单击 Build 项并将标记为“Before Running Startup Page”的项设置为“No Build”或“Build Page”。这将阻止 Visual Studio 编译您站点中的所有页面，并以减少编译为代价改善您的本地开发体验。在您的情况下，这可能是一个值得权衡的选择。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-12T00:34:17.997

如果您在 App_Code 中有很多东西，您可能希望将其（其中一些）移动到单独的程序集中。

尝试重命名您的 .suo 文件

注意[决斗大会](http://weblogs.asp.net/scottgu/archive/2006/07/30/common-gotcha_3a00_-slow-vs-2005-web-site-build-performance-because-of-_1c20_dueling-assembly-references_1d20_.aspx)（当我遇到问题时，这篇文章在哪里=）？），以前有一个糟糕的参考资料害死了我。通过在构建过程中查看输出窗口，我注意到了这个和其他潜在问题。

# sql-server - 如何在 SQL Server 的大表中添加 NOT NULL 列？

> ID：287954
> 
> 赞同：51
> 
> 时间：2008-11-13T19:28:16.923
> 
> 标签：sql-server

要将 NOT NULL 列添加到具有许多记录的表中，需要应用 DEFAULT 约束。如果表非常大，此约束会导致整个 ALTER TABLE 命令需要很长时间才能运行。这是因为：

假设：

1.  DEFAULT 约束修改现有记录。这意味着数据库需要增加每条记录的大小，这会导致它将完整数据页上的记录转移到其他数据页上，这需要时间。
2.  DEFAULT 更新作为原子事务执行。这意味着事务日志将需要增长，以便在必要时可以执行回滚。
3.  事务日志跟踪整个记录。因此，即使只修改了单个字段，日志所需的空间也将基于整条记录的大小乘以现有记录的数量。这意味着即使两个表的总记录数相同，向具有小记录的表添加列也比向具有大记录的表中添加列更快。

可能的解决方案：

1.  把它吸起来，等待过程完成。只需确保将超时时间设置为非常长。这样做的问题是，根据记录的数量，它可能需要数小时或数天才能完成。
2.  添加列但允许 NULL。之后，运行 UPDATE 查询以设置现有行的 DEFAULT 值。不要更新 *。一次更新一批记录，否则您将遇到与解决方案 #1 相同的问题。这种方法的问题在于，当您知道这是一个不必要的选项时，您最终会得到一个允许 NULL 的列。我相信那里有一些最佳实践文档说你不应该有允许 NULL 的列，除非有必要。
3.  创建具有相同架构的新表。将列添加到该架构。从原始表中传输数据。删除原始表并重命名新表。我不确定这比#1 好多少。

问题：

1.  我的假设正确吗？
2.  这些是我唯一的解决方案吗？如果是这样，哪一个是最好的？如果不是，我还能做什么？

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2009-07-19T23:24:14.660

我的工作也遇到了这个问题。我的解决方案是#2。

这是我的步骤（我使用的是 SQL Server 2005）：

1）使用默认值将列添加到表中：

```
ALTER TABLE MyTable ADD MyColumn varchar(40) DEFAULT('') 
```

2）`NOT NULL`使用选项添加约束`NOCHECK`。`NOCHECK`不强制现有值：

```
ALTER TABLE MyTable WITH NOCHECK
ADD CONSTRAINT MyColumn_NOTNULL CHECK (MyColumn IS NOT NULL) 
```

3）增量更新表中的值：

```
GO
UPDATE TOP(3000) MyTable SET MyColumn = '' WHERE MyColumn IS NULL
GO 1000 
```

*   更新语句最多只会更新 3000 条记录。这允许当时保存一大块数据。我必须使用“MyColumn IS NULL”，因为我的表没有序列主键。

*   `GO 1000`将执行前一条语句 1000 次。这将更新 300 万条记录，如果您需要更多记录，请增加此数字。它将继续执行，直到 SQL Server 为 UPDATE 语句返回 0 条记录。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-13T20:08:12.833

这是我会尝试的：

*   对数据库进行完整备份。
*   添加新列，允许空值 - 不要设置默认值。
*   设置 SIMPLE 恢复，它会在每批提交后立即截断 tran 日志。
*   SQL 是：**ALTER DATABASE XXX SET RECOVERY SIMPLE**
*   如上所述，分批运行更新，在每个更新之后提交。
*   重置新列以不再允许空值。
*   回到正常的完全恢复。
*   SQL 是：**ALTER DATABASE XXX SET RECOVERY FULL**
*   再次备份数据库。

使用 SIMPLE 恢复模型不会停止记录，但会显着降低其影响。这是因为服务器在每次提交后都会丢弃恢复信息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-14T00:07:21.963

你可以：

1.  开始交易。
2.  在您的原始表上获取一个写锁，这样没有人会对其进行写操作。
3.  使用新架构创建影子表。
4.  传输原始表中的所有数据。
5.  执行[sp_rename](http://msdn.microsoft.com/en-us/library/ms188351.aspx)以重命名旧表。
6.  执行[sp_rename](http://msdn.microsoft.com/en-us/library/ms188351.aspx)以重命名新表。
7.  最后，您提交事务。

这种方法的优点是您的读者将能够在漫长的过程中访问该表，并且您可以在后台执行任何类型的架构更改。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-01-07T11:10:09.190

只是为了用最新信息更新它。

在 SQL Server 2012 中，现在可以在以下情况下将其作为联机操作执行

1.  仅限企业版
2.  默认值必须是运行时常量

对于第二个要求，示例可能是文字常量或函数，例如`GETDATE()`对所有行计算为相同值的函数。默认的`NEWID()`将**不**符合条件，并且最终仍会在那里更新所有行。

对于符合条件的默认值，SQL Server 会评估它们并将结果作为默认值存储在列元数据中，因此这与创建的默认约束无关（如果不再需要，甚至可以删除）。这在 中可见`sys.system_internals_partition_columns`。直到下次碰巧更新时，该值才会写入行。

更多细节在这里：[在线非空值列添加在 sql server 2012](http://rusanu.com/2011/07/13/online-non-null-with-values-column-add-in-sql-server-11/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-05-25T18:01:46.983

承认这是一个老问题。我的同事最近告诉我，他能够在一个有 1360 万行的表上使用一个 alter table 语句来完成。它在 SQL Server 2012 中在一秒钟内完成。我能够在一个有 8M 行的表上确认这一点。更高版本的 SQL Server 发生了什么变化？

```
Alter table mytable add mycolumn char(1) not null default('N'); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-13T19:33:54.977

我认为这取决于您使用的 SQL 风格，但是如果您选择了选项 2，但最后将表更改为不使用默认值的空值怎么办？

它会很快吗，因为它看到所有值都不为空？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-13T23:22:56.373

如果您希望列在同一个表中，您只需要这样做。现在，选项 3 可能是最好的选择，因为在此操作进行时您仍然可以让数据库“活动”。如果您使用选项 1，则表在操作发生时被锁定，然后您就真的被卡住了。

如果您并不真正关心该列是否在表中，那么我认为分段方法是次佳的。不过，我真的尽量避免这种情况（以至于我不这样做），因为就像 Charles Bretana 所说，您必须确保并找到所有更新/插入该表的位置并修改它们。啊!

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-16T03:13:18.033

我遇到了类似的问题，并选择了您的选项＃2。这种方式需要 20 分钟，而另一种方式需要 32 小时！！！巨大的差异，谢谢你的提示。我写了一篇关于它的完整博客文章，但这里是重要的 sql：

```
Alter table MyTable
Add MyNewColumn char(10) null default '?';
go

update MyTable set MyNewColumn='?' where MyPrimaryKey between 0 and 1000000
go
update MyTable set MyNewColumn='?' where MyPrimaryKey between 1000000 and 2000000
go
update MyTable set MyNewColumn='?' where MyPrimaryKey between 2000000 and 3000000
go
..etc..

Alter table MyTable
Alter column MyNewColumn char(10) not null; 
```

如果您有兴趣，请访问博客条目：http: [//splinter.com.au/adding-a-column-to-a-massive-sql-server-table](http://splinter.com.au/adding-a-column-to-a-massive-sql-server-table)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-10-02T15:59:33.813

我遇到了类似的问题，我采用了修改后的#3 方法。在我的情况下，数据库处于简单恢复模式，并且应该添加列的表没有被任何 FK 约束引用。

我没有使用相同的模式创建新表并复制原始表的内容，而是使用**SELECT...INTO**语法。

根据微软（[http://technet.microsoft.com/en-us/library/ms188029(v=sql.105).aspx](http://technet.microsoft.com/en-us/library/ms188029(v=sql.105).aspx)）

> SELECT...INTO 的日志记录量取决于对数据库有效的恢复模式。在简单恢复模式或批量日志恢复模式下，批量操作的日志记录最少。使用最少的日志记录，使用 SELECT...INTO 语句可能比创建表然后使用 INSERT 语句填充表更有效。有关详细信息，请参阅可以最少记录的操作。

步骤顺序：

1.将数据从旧表移动到新表，同时默认添加新列

```
 SELECT  table.*,   cast (‘default’ as nvarchar(256)) new_column
 INTO    table_copy 
 FROM    table 
```

2.丢弃旧表

```
 DROP TABLE  table 
```

3.重命名新创建的表

```
 EXEC sp_rename 'table_copy',  ‘table’ 
```

4.在新表上创建必要的约束和索引

在我的例子中，该表有超过 1 亿行，这种方法比方法 2 完成得更快，并且日志空间增长很小。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-11-11T17:03:01.573

1）使用默认值将列添加到表中：

```
ALTER TABLE MyTable ADD MyColumn int default 0 
```

2）增量更新表中的值（与接受的答案相同）。调整要更新到您的环境的记录数，以避免阻塞其他用户/进程。

```
declare @rowcount int = 1

while (@rowcount > 0)
begin           

    UPDATE TOP(10000) MyTable SET MyColumn = 0 WHERE MyColumn IS NULL       
    set @rowcount = @@ROWCOUNT

end 
```

3) 将列定义更改为要求不为空。在表未使用时运行以下命令（或安排几分钟的停机时间）。我已经成功地将它用于具有数百万条记录的表。

```
ALTER TABLE MyTable ALTER COLUMN MyColumn int NOT NULL 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-11-13T23:15:33.407

我会使用 CURSOR 而不是 UPDATE。游标将逐条记录批量更新所有匹配的记录——这需要时间但不会锁定表。

如果要避免锁定，请使用 WAIT。

此外，我不确定 DEFAULT 约束会更改现有行。可能 NOT NULL 约束与 DEFAULT 一起使用会导致作者描述的情况。

如果它改变了添加它最后所以伪代码将如下所示：

```
-- without NOT NULL constrain -- we will add it in the end
ALTER TABLE table ADD new_column INT DEFAULT 0

DECLARE fillNullColumn CURSOR LOCAL FAST_FORWARD
    SELECT 
        key
    FROM
        table WITH (NOLOCK)
    WHERE
        new_column IS NULL

OPEN fillNullColumn

DECLARE 
    @key INT

FETCH NEXT FROM fillNullColumn INTO @key

WHILE @@FETCH_STATUS = 0 BEGIN
     UPDATE
         table WITH (ROWLOCK)
     SET
         new_column = 0 -- default value
     WHERE
         key = @key

     WAIT 00:00:05 --wait 5 seconds, keep in mind it causes updating only 12 rows per minute

     FETCH NEXT FROM fillNullColumn INTO @key
END

CLOSE fillNullColumn
DEALLOCATE fillNullColumn

ALTER TABLE table ALTER COLUMN new_column ADD CONSTRAIN xxx 
```

我确信存在一些语法错误，但我希望这有助于解决您的问题。

祝你好运！

* * *

## 回答 #12

> 赞同：-3
> 
> 时间：2008-11-13T19:34:04.400

垂直分割表格。这意味着您将有两个表，具有相同的主键和完全相同的记录数......一个将是您已经拥有的，另一个将只有键，以及新的 Non-Null 列（带有默认值） 。修改所有插入、更新和删除代码，使它们保持两个表同步...如果您愿意，您可以创建一个视图，将两个表“连接”在一起，以创建两者的单个逻辑组合，看起来像一个单一的客户端 Select 语句的表...

# javascript - 如何在不使用 YUI 中的索引的情况下查看 javascript 数组？

> ID：287960
> 
> 赞同：5
> 
> 时间：2008-11-13T19:29:17.047
> 
> 标签：javascript, yui

我知道 jQuery 和原型有一个 $.each() 函数用于迭代数组中的每个元素。YUI 是否提供任何帮助？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-14T00:03:33.233

YAHOO.util.Dom 具有具有以下签名的批处理功能：

> 任意 | 数组**批处理**（el、method、o、override）

其中*el*是 DOM 元素或 DOM 元素数组，*method*是将数组中的每个元素作为其第一个参数传递的函数，*o*是可选的第二个参数，*override*是一个布尔值，用于确定范围应该是 window (false) 或*o* (true)

所以你可以这样称呼它：

```
function setDisplay(el, display) {
    el.style.display = display;
}

YAHOO.util.Dom.batch(document.getElementsByTagName('div'), setDisplay, 'none'); 
```

也许这会满足您的需求。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-13T20:04:14.450

是什么让您无法简单地*迭代*数组？

```
for(var i=0; i<ary.length; i++)
  // assuming that ary[] contains objects with a DoSometing() method
  ary[i].doSomething(); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-12-08T14:58:13.623

在 YUI3 中：

```
Y.Array.each(myArray, function(element) {
    Y.log(element);
}); 
```

甚至：

```
Y.Array.each(myArray, function(element, index, array) {
    ...
}); 
```

# ruby-on-rails - 从 Rails 中的另一个控制器验证模型的数据

> ID：287965
> 
> 赞同：1
> 
> 时间：2008-11-13T19:30:30.740
> 
> 标签：ruby-on-rails, ruby, model-view-controller

我有两个表： Client(id,name,...)
Purchase(id,item,date,client_id,...)

他们有各自的模型和验证。我需要的是创建一个新购买的新客户端，全部放入客户端控制器的创建方法中。像这样的东西：

```
def create  
  @client = Client.new(params[:client])

  respond_to do |format|
    if @client.save
      # Add purchase
      @sell = Purchase.new
      @sell.client_id = @client.id
      @sell.date = params[:date]
      # Fill another fields
      if @sell.save

        # Do another stuff...

      else
        format.html { render :action => "new" }
        format.xml  { render :xml => @client.errors, :status => :unprocessable_entity }
      end

      flash[:notice] = 'You have a new client!'
      format.html { redirect_to(:action => :show, :id => @evento.id) }
      format.xml  { render :xml => @client, :status => :created, :location => @client }
    else
      format.html { render :action => "new" }
      format.xml  { render :xml => @evento.client, :status => :unprocessable_entity }
    end
  end
end 
```

在购买的模型中，我有：

```
belongs_to :client
validates_format_of :date, :with => /^20[0-9]{2}[-][0-9]{2}[-][0-9]{2}$/, :message => 'not valid'
validates_presence_of :date 
```

还有我的问题：如何从客户端控制器通过对模型的验证来验证日期输入？而且，我怎样才能回滚错误时创建的新客户端？

是的，我可以将检查作为方法中的第一条指令，使用正则表达式，但我认为它很难看。我觉得可能存在一种常规方法来进行此验证，甚至以另一种方式完成所有工作（即从客户端控制器调用 create 方法进行购买）。

你能让我以正确的方式回来吗？

先感谢您。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T19:52:06.173

请查看以下有关[使用关联](http://en.wikibooks.org/wiki/Ruby_on_Rails/ActiveRecord/Associations)的页面。

Rails 为您的对象提供了许多方便的方法。

如下所示：

```
Client.purchases.empty?
Client.purchases.size,
Client.purchases
Client.purchases<<(purchase)
Client.purchases.delete(purchase)
Client.purchases.find(purchases_id)
Client.purchases.find_all(conditions)
Client.purchases.build
Client.purchases.create 
```

使用这些方法时，您正在利用每个模型的验证。

跳到 Rails 控制台并创建一个新客户端并尝试上述任何方法。您将很快了解它们的强大功能，并且您很快就会上路。

**编辑：** [这是关于 Rails 关联的更好指南！](http://guides.rubyonrails.org/association_basics.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T20:09:36.030

取决于具体情况，但您可以使用 validates_associated 对关联对象运行验证。然后您可以创建用户（但不保存），创建购买（但不保存）并尝试保存用户。如果你做对了，用户将无法保存相关对象上的验证错误。

# sql - SQL inline if 语句类型问题

> ID：287976
> 
> 赞同：14
> 
> 时间：2008-11-13T19:36:03.490
> 
> 标签：sql, sql-server

我想做一个（MS）SQL查询，返回如下内容：

```
Col1 Col2                  Col3
---- --------------------- ------
AAA  18.92                 18.92
BBB  20.00                 40.00
AAA  30.84                 30.84
BBB  06.00                 12.00
AAA  30.84                 30.84
AAA  46.79                 46.79
AAA  86.40                 86.40 
```

其中当 Col1 = AAA 时 Col3 等于 Col2，当 Col1 = BBB 时 Col3 是 Col2 的两倍。有人可以指出我正确的方向吗？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-11-13T19:37:40.273

您没有提到您使用的是哪种数据库。下面是一些可以在 SQL Server 中使用的东西：

```
SELECT Col1, Col2, 
    CASE WHEN Col1='AAA' THEN Col2 WHEN Col1='BBB' THEN Col2*2 ELSE NULL END AS Col3
FROM ... 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-02-17T21:00:31.300

如果值为 null，您也可以像这样使用`ISNULL`or函数：`COALESCE`

```
SELECT ISNULL(Col1, 'AAA') AS Col1, 
       ISNULL(Col2, 0) AS Col2,
       CASE  WHEN ISNULL(Col1, 'AAA') = 'BBB' THEN ISNULL(Col2, 0) * 2 
             ELSE ISNULL(Col2) 
       END AS Col3
FROM   Tablename 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T19:39:01.300

这取决于您的 SQL 风格。Case/When 适用于 SQL Server（可能还有其他）。

```
Select Col1, Col2, 
       Case When Col1 = 'AAA' Then Col2 Else Col2 * 2 End As Col3
From   YourTable 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T19:38:37.263

```
select *
from yourtable
where (Col3 = col2 AND Col1 = 'AAA') OR
    (Col3 = (2*Col2) AND Col1='BBB') 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-06-13T11:30:48.407

有时值是`null`，因此可以像这样处理它们：

```
select Address1 + (case when Address2='' then '' else ', '+Address2 end) +              
    (case when Address3='' then '' else ', '+ Address3 end) as FullAddress from users 
```

# apache-flex - 使用 HTTPService 指定多个同名参数

> ID：287986
> 
> 赞同：0
> 
> 时间：2008-11-13T19:38:44.110
> 
> 标签：apache-flex, actionscript-3

如果参数具有特定格式，Ruby on Rails 控制器将自动将参数转换为数组，如下所示：

```
http://foo.com?x[]=1&x[]=5&x[]=bar 
```

这将被转换为以下数组：

```
['1','5','bar'] 
```

有什么方法可以通过使用请求参数对 ActionScript 3 HTTPService 对象执行此操作？例如，最好执行以下操作：

```
var s:HTTPService = new HTTPService();
s.request['x[]'] = 1;
s.request['x[]'] = 5;
s.request['x[]'] = 'bar'; 
```

但是，这只会覆盖每个值，从而只发送最后一个值。有人有更好的主意吗？我知道我可以将内容附加到查询字符串，但我想在 POST 正文中进行。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-04T12:59:41.833

我也在解决同样的问题。幸运的是，Flex 开箱即用地支持这一点。

只需使用一个数组作为字段值：

```
var service:HTTPService = new HTTPService();
service.useProxy = true;
service.destination = "myservicet";
service.resultFormat = HTTPService.RESULT_FORMAT_XML;

var fields:Array = ["categories", "organisation"];
var params:Object = new Object();
params.q = "stackoverflow";
params.rows = 0;
params.facet = "true";
params["facet.field"] = fields;
service.send(params); 
```

HTTPService 会将此 t0 转换为 url 参数：

```
facet=true&q=stackoverflow&facet%2Efield=categories&facet%2Efield=organisation&rows=0
```

希望这可以帮助！

为更清晰而添加。当数组中只有 1 个参数时，不要将字段作为数组传递。出于某种原因，flex 不会将其发送到 http 服务

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T19:46:19.743

我通常会做这样的事情......

```
 var s:HTTPService = new HTTPService();
s.url = "http://foo.com";
s.method = "post";
// add listeners...
s.addEventListenser(ResultEvent.RESULT,function(event:ResultEvent){

    mx.controls.Alert.show(event.result.toString());
});

// send the data...
s.send({
    a: 1,
    b: 5,
    c: "bar"
}); 

```

这将导致以下 HTTP Get / POST：

[http://foo.com?a=1&b=5&c=bar](http://foo.com?a=1&b=5&c=bar)

您也可以只创建一个关联数组并将其传递给 HTTPService 发送方法，类似于：

```
 var postdata:Object = {};

postdata["a"] = 1;
postdata["b"] = 5;
postdata["c"] = "bar";

// s is the HTTPService from above...
s.send(postdata); 

```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-08T09:32:23.990

您提到所有 POST 参数必须具有相同的名称。具有相同名称的元素将在关联数组中相互覆盖。但是，我之前处理过日历单元格，所有 31 个单元格都属于日期类别。

我所做的是：

```
var params:Object = new Object;
for (var i:uint=0; i<31; i++){
  params["Date"+(jj.toString())] = date[i];
}

HTTPService....etc.
HTTPService.send(params); 
```

因此，在 POST 接收端，它将被解释为`Date0...Date31`.

不知道这是不是你想要的，而且这个帖子是很久以前的了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-08T09:36:25.827

来考虑一下。为什么不对同一索引名称下的所有元素进行数组推送？但是，这意味着您正在向接收方发送一个数组。

如果您要发布这个，它将如何被 URL 引用？

# php - 使用正则表达式匹配两个标签之间的所有内容？

> ID：287991
> 
> 赞同：4
> 
> 时间：2008-11-13T19:40:22.047
> 
> 标签：php, html, regex, tags

如何匹配（PCRE）两个标签之间的所有内容？

我试过这样的事情：

> <!--\s*LoginStart\s*-->(.*)<!--\s*LoginEnd\s*-->

但是对我来说效果不是很好。。

我对正则表达式有点陌生，所以我希望有人愿意向我解释我将如何实现这一点，如果它甚至可以使用正则表达式。

谢谢

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-13T19:49:37.067

```
$string = '<!-- LoginStart --><div id="stuff">text</div><!-- LoginEnds -->';
$regex = '#<!--\s*LoginStart\s*-->(.*?)<!--\s*LoginEnds\s*-->#s';

preg_match($regex, $string, $matches);

print_r($matches); // $matches[1] = <div id="stuff">text</div> 
```

解释：

```
(.*?) = non greedy match (match the first <!-- LoginEnds --> it finds
    s = modifier in $regex (end of the variable) allows multiline matches
        such as '<!-- LoginStart -->stuff
                 more stuff
                 <!-- LoginEnds -->' 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T19:46:34.657

PHP 和正则表达式？这里有一些建议：

```
'/<!--\s*LoginStart\s*-->(.*)<!--\s*LoginEnd\s*-->/Us' 
```

可能会更好 -`U`大写使正则表达式不贪婪，这意味着它会在第一个`<!--`可能起作用的地方停止。但重要的是`s`，它告诉正则表达式将换行符与`.`字符匹配。

根据您对大写的确定程度，`i`在末尾添加一个将使正则表达式搜索不区分大小写。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-11-18T11:10:58.293

我已经尝试过欧文的答案，但它在以下条件下失败了

`<!-- LoginStart --><div id="stuff">text</div><!-- LoginEnds -->**"DONT MIND THIS"**<!-- LoginStart --><div id="stuff">text</div><!-- LoginEnds -->`

这也包括“不要介意”这一行，即它涵盖了第一个 <!-- LoginStart --> 和最后一个 <!-- LoginEnds --> 标记内的所有内容

# performance - 在“问题”出现之前，Sourcesafe 数据库可以有多大？

> ID：287995
> 
> 赞同：5
> 
> 时间：2008-11-13T19:41:58.893
> 
> 标签：performance, version-control, visual-sourcesafe, limits

我们使用 SourceSafe 6.0d 并且有一个大约 1.6GB 的数据库。我们还没有遇到任何问题，目前也没有更改源代码控制程序的计划，但是 SourceSafe 数据库在成为问题之前能有多大？

谢谢

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-13T19:54:51.630

我的 VSS 问题从低至 1.5-2.0 gigs 开始。

The meta-answer is, don't use it. VSS is far inferior to a half-dozen alternatives that you have at your fingertips. Part of source control is supposed to be ensuring the integrity of your repository. If one of the fundamental assumptions of your source control tool is that you never know when it will start degrading data integrity, then you have a tool that invalidates its own purpose.

I have not seen a professional software house using VSS in almost a decade.

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-13T19:53:21.133

1个字节！

:-)

对不起，伙计，你让我失望了。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-13T20:15:28.450

Do you run the built-in ssarchive utility to make backups? If so, 2GB is the maximum size that can be restored. ([http://social.msdn.microsoft.com/Forums/en-US/vssourcecontrol/thread/6e01e116-06fe-4621-abd9-ceb8e349f884/](http://social.msdn.microsoft.com/Forums/en-US/vssourcecontrol/thread/6e01e116-06fe-4621-abd9-ceb8e349f884/))

NOTE: the ssarchive program won't tell you this; it's just that if you try to restore a DB over 2GB, it will fail. Beware! All these guys who are telling you that they are running fine with larger DB are either using another archive program, or they haven't tested the restore feature.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-13T19:48:41.453

我实际上运行了一个大约 40 gig 的 vss db。我不推荐它，但它是可能的。真的，你放得越大，你就越是在玩火。我听说过数据库损坏的情况，源代码管理中的项目无法恢复。我肯定会每天备份它并开始寻求更改源代码控制系统。处于失败时他们打电话给他们的那个人的位置上，我可以告诉你，当你意识到它可能会失败并且永远不会回来时，它真的会开始变得有压力。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-13T19:53:19.260

考虑到 SourceSafe 可以自行产生的问题数量，我会说大小必须在“磁盘上存在”类别中才能产生问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-13T19:44:22.133

我已经管理过两倍大小的 VSS 数据库。只要您对运行[Analyze](http://msdn.microsoft.com/en-us/library/ysxsfw4x(VS.80).aspx)保持警惕，就可以了。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-13T19:45:27.513

Sourcesafe 建议 3-5G 并带有“永远不要超过 13G”。

然而，在实践中，我们的超过 20G 并且似乎运行良好。

你得到的越大，Analyze 会发现越来越多的问题，包括丢失的文件等。

编辑：这是官方用词： http: [//msdn.microsoft.com/en-us/library/bb509342 (VS.80).aspx](http://msdn.microsoft.com/en-us/library/bb509342(VS.80).aspx)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-13T01:41:03.303

I have found that Analyze/Fix starts getting annoyingly slow at around 2G on a reasonably powerful server. We run Analyze once per month on databases that are used by 20 or so developers. The utility finds occasional fixes to perform, but actual use has been basically problem free for years at my workplace.

The main thing according to Microsoft is make sure you never run out of disk space, whatever the size of the database.

[http://msdn.microsoft.com/en-us/library/bb509342(VS.80).aspx](http://msdn.microsoft.com/en-us/library/bb509342(VS.80).aspx)

quote: Do not allow Visual SourceSafe or the Analyze tool to run out of disk space while running. Running out of disk space in the middle of a complex operation can create serious database corruption*`*