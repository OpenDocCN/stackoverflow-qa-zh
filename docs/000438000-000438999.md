# StackOverflow 问答 000438000-000438999

# wcf - WCF 和嵌入式系统

> ID：438000
> 
> 赞同：1
> 
> 时间：2009-01-13T04:49:18.003
> 
> 标签：wcf, web-services, embedded

我正在从事一个涉及嵌入式系统的项目，该系统运行一个非微软操作系统，该操作系统带有一个用于应用程序的 C 程序，并且正在为其最终用户应用程序开发 .NET 软件。对于使用 .NET 软件（可以跨越防火墙）进行远程配置，我正在考虑使用 WCF。到目前为止，我对 WCF 知之甚少，但我读到它应该可以与 .NET 以外的环境互操作。嵌入式环境有一个 HTTP 堆栈，但没有内置对 Web 服务的支持。有没有人对这种事情有任何经验或知道它是否合适？如果是这样，请提供一些建议或指出正确的方向。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T05:38:53.023

WCF 是可互操作的，因为它是通过 HTTP 访问的。Visual Studio 可以帮助你非常快速地为 WCF 构建客户端库，但客户端访问 WCF 不需要任何东西，除了具有正确负载的 HTTP 调用。如果您正在查看远程服务器调用，并且嵌入式环境中的内置支持是基本 HTTP，请考虑将服务器端构建为 REST 格式的方法。你的调试器会感谢你的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T04:58:18.313

您计划来回传输哪些类型的数据？对于这种低级别和专有的东西，我建议坚持使用良好的老式套接字。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T17:10:39.863

我将来回传递配置数据……基本上是为了使技术支持人员能够远程对设备进行编程。如果我使用套接字，这可能是二进制数据，但要求有防火墙的客户不需要打开任何端口。因此，我正在考虑通过 HTTP 发送 XML。那么，在服务器端使用 WCF 还是 REST 更好呢？还是带有 REST 的 WCF？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-04T14:49:49.627

我很好奇您的“有防火墙的客户”的要求。带有二进制数据或 HTTP 上的 XML 的套接字可以使用任何端口（不仅仅是端口 80），我很好奇您的设备是否会在网络上“侦听”，或者只是进行出站连接。如果您的设备正在侦听，您将需要在防火墙上打开一个端口。在防火墙上进行出站连接（“打电话回家”）要容易得多。

所以我认为你可以使用套接字和二进制数据。但是，我在最后两个项目中遇到了类似的问题，我真的很想在嵌入式设备上使用 REST 实现 WCF，但没有其他人愿意这样做 - 我希望其他人会是第一个，并发布一些结果！

祝你好运！（并发布您的结果！）

# c++ - Linux 链接器/加载器的环境覆盖

> ID：438003
> 
> 赞同：2
> 
> 时间：2009-01-13T04:50:27.550
> 
> 标签：c++, c, linux, linker, loader

今天早些时候我问了一个关于*environ的*[问题](https://stackoverflow.com/questions/437279/c-c-environment-initialization)，其中一个更[有趣](https://stackoverflow.com/questions/437279/c-c-environment-initialization#437295)的回复建议我可以使用 LD_DEBUG 收集信息。

 *现在我已经知道一些链接器/加载器环境变量（例如*LD_PRELOAD*）有一段时间了，但这对我来说是新的。谷歌搜索，我发现了一个 Linux 特定的手册页，讨论了链接器/加载器使用的[环境变量](http://linux.die.net/man/8/ld-linux)，包括 LD_DEBUG。所以理论上，我已经准备好了。但在实践中，我确信我错过了与工具链中这个基本工具相关的一整套技巧。

简而言之，我还缺少什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T05:53:53.507

我最喜欢`LD_PRELOAD`用来解决 GNU libc 中的错误或错误功能；有一段时间`connect`用 IPv6 做了一些奇怪的事情，我只是编写了自己的版本，总是使用 IPv4。

Linux用户可以试试

```
man ld.so 
```

此外，`ldd`告诉如何解析动态库的命令值得更广为人知。

# c++ - 提升源代码

> ID：438005
> 
> 赞同：9
> 
> 时间：2009-01-13T04:54:13.457
> 
> 标签：c++, boost

有什么方法可以获取 boost 库源代码？我浏览了 SVN 存储库，只能看到 HPP 文件。那里没有可用的源文件。我想查看“shared_ptr”的源代码。谁能指导我？

我还可以从哪里下载[BCP](http://www.boost.org/doc/libs/1_37_0/tools/bcp/bcp.html)实用程序？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-01-13T04:59:05.037

绝大多数源代码完全在头文件中——它必须是模板才能工作。您不能将模板代码放在源文件中并单独编译它们。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-28T14:02:54.380

所有源文件 (.cpp) 都在 /boost/libs/<library-name> 下

大多数 boost 库完全由标头组成。例外情况是：

*   测试
*   线
*   海浪
*   序列化
*   信号
*   Python
*   正则表达式
*   数学
*   图形
*   iostream
*   文件系统
*   约会时间

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-13T21:34:10.037

boost 的大部分都在 headers 中，但有些部分也在`cpp`-files 中。[文档索引页面](http://www.boost.org/doc/libs/1_37_0)列出了哪些库只是标题/不是标题。[您可以在此处](http://www.boost.org/users/download/)下载增强源。的来源`bcp`也可以在存档的`tools/bcp`子目录中找到。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-13T05:01:08.263

正如亚当所提到的，它几乎都在标题中。有些，如 boost::regex，确实需要构建源文件，但这些也包含在主下载中。

BCP 实用程序包含在主下载中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-13T15:03:29.997

Boost 库具有以下核心目录结构：

-> boost : 包含头文件。由于 Boost 的大部分内容是在头文件中实现的，因此它也包含很多实现，通常是详细的子目录。

-> lib ：包含预编译的源代码、测试套件、示例，有时还包含库的文档。

-> doc：包含一些文档。

-> 工具：包含 Boost.Jam、Boost.Build、独立 Wave 和 BCP 等工具。

# c++ - STL __merge_without_buffer 算法？

> ID：438012
> 
> 赞同：3
> 
> 时间：2009-01-13T04:58:26.957
> 
> 标签：c++, algorithm, sorting, stl, d

我在哪里可以获得`__merge_without_buffer()`C++ STL 中使用的算法的高级描述？我正在尝试用 D 编程语言重新实现此代码，并进行一些增强。仅仅阅读 STL 源代码，我似乎无法理解它在算法级别上所做的事情，因为有太多的低级细节掩盖了它。此外，我不想只是盲目地翻译代码，因为那样的话，如果它不起作用，我将不知道为什么，并且我将无法添加我的增强功能。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-13T05:36:49.873

`__merge_without_buffer()`正在执行**就地合并**，作为就地合并排序的合并步骤。它将两个数据范围作为输入，`[first, middle)`并且`[middle, last)`假定它们已经排序。和参数分别等于两个输入范围的长度，`len1`即和。`len2``(middle - first)``(last - middle)`

首先，它选择一个*枢轴*元素。然后，它将数据重新排列为 order `A1 B1 A2 B2`，其中`A1`是`[first, middle)`小于枢轴`A2`的元素集， 是`[first, middle)`大于或等于枢轴`B1`的元素集， 是`[middle, last)`小于枢轴的元素集，并且`B2`是`[middle, last)`大于或等于枢轴的元素集合。注意，数据本来就是按顺序排列的`A1 A2 B1 B2`，所以我们要做的就是转`A2 B1`成`B1 A2`. 这是对 的调用`std::rotate()`，它就是这样做的。

现在我们已经将小于枢轴 ( `A1`and `B1`) 的元素与大于或等于枢轴 ( `A2`and `B2`) 的元素分开了，所以现在我们可以递归地合并两个子范围`A1 A2`and `B1 B2`。

我们如何选择支点？在我正在查看的实现中，它从较大的子范围中选择中值元素（即，如果`[first, middle)`元素多于`[middle, last)`，它选择 的中值`[first, middle)`；否则，它选择 的中值`[middle, last)`）。由于子范围已经排序，因此选择中位数是微不足道的。这种枢轴选择确保在递归合并两个子范围时，每个子问题不超过当前问题大小的 3/4，因为在最坏的情况下，至少有 1/4 的元素大于或小于枢轴.

这个的运行时间是多少？`std::rotate()`调用需要 O(N) 时间，我们对自己进行了两次递归调用。这相当于 O(N log N) 的运行时间。但是，请注意这只是归并排序中的一个步骤：请记住，在归并排序中，您首先对两半进行递归排序，然后再合并。因此，归并排序运行时间的递推关系现在为：

`T(N) = 2T(N/2) + O(N log N)`

把它代入主[定理](http://en.wikipedia.org/wiki/Master_theorem)，你会得到现在的归并排序在 O(N log ² N) 时间内运行！

作为有趣的最后一点，请考虑基于比较的排序算法的以下三个特性：

1.  到位
2.  稳定的
3.  在 O(N log N) 时间内运行

您通常一次只能获得其中的 2 个 - 快速排序获得 (1) 和 (3)，合并排序获得 (2) 和 (3)，就地合并排序获得 (1) 和 (2)。非基于比较的排序（例如计数排序）可以实现全部 3 个，但这些排序只能对某些数据类型进行排序。可能存在实现所有 3 个的基于比较的排序，但如果存在，我不知道它的存在，而且它几乎肯定要复杂得多。

# java - jsf中的响应编写器

> ID：438026
> 
> 赞同：5
> 
> 时间：2009-01-13T05:07:52.117
> 
> 标签：java, jsf

```
ResponseWriter writer=context.getResponseWriter(); 
```

我想知道关于`startElement`,`endElement`和`writeAttribute`的方法`ResponseWriter`。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-13T05:40:10.400

JSF 输出是 HTML/XML，并且`ResponseWriter`更容易正确生成它。假设您想在`<span>`标签中呈现一些文本。

```
<span>My random text</span> 
```

代码如下所示：

```
ResponseWriter writer=context.getResponseWriter();
writer.startElement("span", component);
writer.writeText(text, null);
writer.endElement("span"); 
```

`writerAttribute`当您需要向标签添加 ID 或类属性时会出现。

```
ResponseWriter writer=context.getResponseWriter();
writer.startElement("span", component);
writer.writeAttribute("id", id, null);
writer.writeText(text, null);
writer.endElement("span"); 
```

这将呈现：

```
<span id="myId">My text</span> 
```

注意：`writeAttribute`紧随其后`startElement`。一旦你开始另一个元素或写一些文本，你就不能调用`writeAttribute`.

# .net - 如何在 Mono 中获取串行端口的“友好”名称并保持跨平台

> ID：438029
> 
> 赞同：4
> 
> 时间：2009-01-13T05:09:03.020
> 
> 标签：.net, linux, mono, cross-platform, serial-port

我问了这个问题：
[Serial Port (rs232) in Mono for multiple platform](https://stackoverflow.com/questions/434494/serial-port-rs232-in-mono-for-multiple-platforms)

这一个是相关的：
[如何在 Windows 中获取 COM 端口的友好名称？](https://stackoverflow.com/questions/304986/how-do-i-get-the-friendly-name-of-a-com-port-in-windows)

但我希望能够在 Windows 上获得“友好”的名称，如果有这样的事情，也可能在 linux /mac 上。

有没有跨平台的方法可以做到这一点，还是我不走运？

这是我在当前应用程序中所做的 - 它适用于本机 C++ win32。

[http://www.naughter.com/enumser.html](http://www.naughter.com/enumser.html)

无论如何，它看起来不像是跨平台分发的完美解决方案。有没有人有什么建议？

编辑 - 因为人们无法理解我的要求：例如 - COM9 不是一个友好的名称。我想要一些写着“COM9 -​​ USB 连接器”之类的东西。这可以通过上面的 Win32 链接实现。这很讨厌而且很麻烦，但是很多时候最终用户不知道他们需要在我的程序中打开哪个 COM 端口，除非有一个有用的名称——比“COMn”更有用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-28T01:33:30.040

AFAIK linux 中的 COMM 设备没有“友好”的名称。我建议您在 linux 环境中使用 /dev/ttyS# 作为您的设备名称，并在 windows 中将它们列为 COMM#。

linux 用户会理解这些术语，因此不必担心。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-28T17:36:56.773

考虑查看`SerialPort.GetPortNames()`静态方法。它在 .NET 2.0 中可用，而且看起来它也在 Mono 中实现。根据http://www.go-mono.com/docs/>的mono docs页面，GetPortNames存在于Mono串口对象上，所以我试一试。

如果已实现，它应该返回一个 C# 字符串数组，其中包含计算机上可用的端口名称。这些对于您拥有的任何底层操作系统都应该是有意义的。例如，在 Windows 中，它将返回 COM1、COM2、COM4 等。它应该返回属性所需的字符串`PortName`。

更新：

查看[来自 mono-dev 邮件列表的帖子，](http://www.mail-archive.com/mono-devel-list@lists.ximian.com/msg15015.html)它看起来确实在 *nix 环境下工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-03T20:14:30.470

在 WMI 中尝试以下查询：

“Select Name From Win32_PnPEntity”并搜索包含“COM”的对象，例如我的电脑上安装了一个USB-Serial Converter设备：

USB60FPW USB-串口转换器 (COM6)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-11-24T06:08:57.097

我建立了一个用于串口控制的库。它可以从注册表中搜索友好名称。

[https://github.com/kcwongjoe/serial_port](https://github.com/kcwongjoe/serial_port)

```
std::vector<SerialPortInfo> comPorts = SerialPort::getSerialPortList();
std::cout << comPorts[0].friendlyName << std::endl; 
```

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-02-27T17:26:00.343

代码：

```
 public static ArrayList GetComFriendlyNames()
    {
        ArrayList names = new ArrayList();
        try
        {
            ManagementObjectSearcher searcher =
              new ManagementObjectSearcher("root\\WMI",
              "SELECT InstanceName, PortName FROM MSSerial_PortName");

            foreach (ManagementObject port in searcher.Get())
            {
                names.Add(port["PortName"] + " - " + port["InstanceName"]);
            }
        }
        catch (ManagementException)
        {
        }
        return names;
    } 
```

用法：

```
 ArrayList ports = GetComFriendlyNames();
        foreach (string name in ports)
        {
            Console.WriteLine(name);
        } 
```

示例输出：

COM1 - ACPI\PNP0501\1_0

COM2 - ACPI\PNP0501\2_0

COM3 - FTDIBUSVID_0000+PID_0000+0&0000000&0&0?000_0

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2009-01-29T21:14:10.353

你需要考虑做WMI。我自己无法运行它，但是如果您将如何检索 WMI 对象的[这个基本框架](http://www.codeproject.com/KB/system/cstcpipwmi.aspx%0A)与该类的[文档](http://msdn.microsoft.com/en-us/library/aa394413(VS.85).aspx)`Win32_SerialPort`结合起来，我认为您可以解决一些问题。

基本上，您想获取`Win32_SerialPort`系统上所有 s 的集合，然后遍历它们。您可能需要“标题”或“描述”，或者只是“名称”。我最好的建议是设置一个断点并在调试模式下检查对象的属性，这样你就可以准确地找出填充了什么。

# c# - 显示命令行实用程序的帮助

> ID：438034
> 
> 赞同：1
> 
> 时间：2009-01-13T05:11:29.083
> 
> 标签：c#, visual-studio-2008, .net-2.0

我有一个命令行实用程序，可以从我的站点下载相当多的内容。我试图显示用户使用 /? 或 /help 参数。我有一个名为 ShowUsage() 的函数，它在可用参数上有很好的格式化文本。

当我在项目属性中使用命令行参数时，我看到 ShowUsage() 从 Visual Studio 2008 中调用得很好。但是，从命令行运行时，exe 不显示帮助文本。这是 ShowUsage() 的简化版本：

```
private static void ShowUsage()
{
    Console.WriteLine(Environment.NewLine);
    Console.WriteLine("Text File Splitter v1.4.1  released: December 14, 2008");
    Console.WriteLine("Copyright (C) 2007-2008 Hector Sosa, Jr");
    Console.WriteLine("http://www.systemwidgets.com");
    Console.WriteLine("");
} 
```

我在谷歌搜索中尝试了很多不同的东西，但没有一个有效。我知道这必须是简单/容易的事情，但对于我的生活，我无法弄清楚这一点。

**编辑：**

调用 ShowUsage() 的代码：

```
if (!Equals(cmdargs["help"], null) || !Equals(cmdargs["?"], null))
{
    ShowUsage();
} 
```

我有一个将参数解析为 cmdargs 数组的类。我确认参数在数组中。ShowUsage() 中的某些内容阻止了显示文本。

我将尝试调试技巧，看看我发现了什么。

我没有在任何地方使用 Console.Out。

d03boy - 只是个人喜好。它使屏幕上的文本不那么杂乱，至少对我来说是这样。

**编辑#2**

好的，更多信息...我在 Vista Ultimate 64 位中运行 VS2008。我只是检查项目属性并将其设置为“Windows 应用程序”。此实用程序是 32 位的。

正如你们中的一些人所建议的那样，我将尝试在真正的控制台程序的解决方案中创建一个单独的项目。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T05:18:01.427

你能定义“不工作”吗？只是什么都不做？抛出异常？我希望问题出在`Main(...)`方法中 - 即`ShowUsage()`没有被调用。另一个常见问题是没有以正确的配置重建它，因此`bin/release`（或其他）没有更新。

**您是否将应用程序构建为控制台 exe？**即项目属性中的“输出类型”=“控制台应用程序”？它需要为了访问控制台...

对于信息，我发现做控制台帮助屏幕的最简单方法（一旦超出几行）是将 .txt 文件嵌入到 exe 中；然后我只写出文本文件（`string.Format`如果我想替换令牌，可能仍在使用）。

或者，还有另一种字符串格式：

```
 Console.WriteLine(@"
Text File Splitter v1.4.1  released: December 14, 2008
Copyright (C) 2007-2008 Hector Sosa, Jr
http://www.systemwidgets.com

"); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T05:17:25.623

您是否将 Console.Out 重定向到其他地方？

尝试在 ShowUsage 方法中抛出 System.Diagnostics.Debugger.Launch() 以便您可以查看它是否在运行时被命中。

你能用一个简单的 exe 重现这个问题，只接受那些帮助参数吗？

# php - PHP/mysql 数组搜索算法

> ID：438044
> 
> 赞同：2
> 
> 时间：2009-01-13T05:20:27.973
> 
> 标签：php, mysql, match

我希望能够使用 php 搜索特定字符串的数组（或者更好的是，mysql 表的列）。但是，我的目标是让它返回它找到的字符串和匹配字符的数量（以正确的顺序）或其他方式来查看搜索结果的合理性，这样我就可以利用该信息来决定是否我想默认显示排名靠前的结果，或者给用户提供排名靠前的几个选项。我知道我可以做类似的事情

```
$citysearch = mysql_query("  SELECT city FROM $table WHERE city LIKE '$city' "); 
```

但我想不出一种方法来确定它的准确性。

目标是：
a) 如果搜索词是“milwakee”或类似词，则找到“Milwaukee”。
b) 如果搜索词是“west”，则返回“West Bend”和“Westmont”之类的内容。

有人知道这样做的好方法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T05:42:38.227

您应该查看MySQL 中的[全文搜索](http://dev.mysql.com/doc/refman/5.0/en/fulltext-search.html)。还可以查看 Zend 的 Apache Lucene 项目端口[Zend_Search_Lucene](http://framework.zend.com/manual/en/zend.search.lucene.html)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-15T22:41:29.227

更多的搜索让我找到了 Levenshtein 距离，然后找到了similar_text，这被证明是最好的方法。

```
similar_text("input string", "match against this", $pct_accuracy); 
```

比较字符串，然后将准确性保存为变量。Levenshtein 距离决定了从一个字符串到另一个字符串需要对单个字符执行多少删除、插入或替换函数，并允许对每个函数进行不同的加权（例如，您可以使替换成本更高一个字符而不是删除一个字符）。它显然比similar_text 更快但不太准确。我在其他地方读过的其他帖子提到，对于少于 10000 个字符的字符串，速度没有功能差异。

我最终使用了我发现的东西的修改版本来使它工作。这最终保存了前 3 个结果（完全匹配的情况除外）。

```
$input = $_POST["searchcity"];
$accuracy = 0;
$runner1acc = 0;
$runner2acc = 0;
while ($cityarr = mysql_fetch_row($allcities)) {
  $cityname = $cityarr[1];
  $cityid = $cityarr[0];
  $city = strtolower($cityname);
  $diff = similar_text($input, $city, $tempacc);

  // check for an exact match
  if ($tempacc == '100') {

    // closest word is this one (exact match)
    $closest = $cityname;
    $closestid = $cityid;
    $accuracy = 100;

    break;
  }

  if ($tempacc >= $accuracy) { // more accurate than current leader
    $runner2 = $runner1;
    $runner2id = $runner1id;
    $runner2acc = $runner1acc;
    $runner1 = $closest;
    $runner1id = $closestid;
    $runner1acc = $accuracy;
    $closest  = $cityname;
    $closestid = $cityid;
    $accuracy = $tempacc;
  }
  if (($tempacc < $accuracy)&&($tempacc >= $runner1acc)) { // new 2nd place
    $runner2 = $runner1;
    $runner2id = $runner1id;
    $runner2acc = $runner1acc;
    $runner1 = $cityname;
    $runner1id = $cityid;
    $runner1acc = $tempacc;
  }
  if (($tempacc < $runner1acc)&&($tempacc >= $runner2acc)) { // new 3rd place
    $runner2 = $cityname;
    $runner2id = $cityid;
    $runner2acc = $tempacc;
  }
}

echo "Input word: $input\n<BR>";
if ($accuracy == 100) {
  echo "Exact match found: $closestid $closest\n";
} elseif ($accuracy > 70) { // for high accuracies, assumes that it's correct
  echo "We think you meant $closestid $closest ($accuracy)\n";
} else {
  echo "Did you mean:<BR>";
  echo "$closestid $closest? ($accuracy)<BR>\n";
  echo "$runner1id $runner1 ($runner1acc)<BR>\n";
  echo "$runner2id $runner2 ($runner2acc)<BR>\n";
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T05:38:28.560

这可能非常复杂，尽管我确信它们存在，但我个人并不知道有任何好的 3rd 方库。不过，其他人可能会提出一些罐头解决方案。

我过去几次从头开始写过类似的东西。如果您沿着这条路线走，那么您可能不想在 PHP 中单独执行此操作，因为每个查询都涉及获取所有记录并对其执行计算。它几乎肯定会涉及创建一组满足您的规范的索引表。

例如，您必须想出如何想象“密尔沃基”最终拼写为“密尔沃基”的规则。我对此的解决方案是进行元音压缩和重复压缩（不确定这些是否真的是搜索词）。因此，密尔沃基将被索引为：

*   密尔沃基
*   m_lw__k__
*   m_lw_k_

当搜索查询输入“milwaukee”时，我将对文本输入运行相同的过程，然后在索引表上运行搜索：

```
SELECT cityId,
       COUNT(*)
  FROM myCityIndexTable
 WHERE term IN ('milwaukee', 'm_lw__k__', 'm_lw_k_') 
```

当搜索查询进入“milwakee”时，我将对文本输入运行相同的过程，然后在索引表上运行搜索：

```
SELECT cityId,
       COUNT(*)
  FROM myCityIndexTable
 WHERE term IN ('milwaukee', 'm_lw_k__', 'm_lw_k_') 
```

在 Milwaukee（拼写正确）的情况下，它将返回“3”作为计数。

在 Milwakee（拼写错误）的情况下，它将返回“2”作为计数（因为它与`m_lw__k__`模式不匹配，因为它只有一个元音在中间）。

如果您根据计数对结果进行排序，您最终会满足您的一条规则，即“密尔沃基”最终将作为可能的匹配项排序高于“密尔沃基”。

如果您想以通用方式构建此系统（正如您`$table`在查询中使用的暗示的那样），那么您可能需要在其中的某个地方使用另一个映射表来将您的术语映射到适当的表。

我并不是说这是最好的（甚至是好的）方法，只是我过去做过的事情，如果你打算在没有第三方解决方案的情况下尝试这样做，可能会对你有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-23T02:04:18.770

LIKE 最令人抓狂的结果是这个“%man”，这将返回文件中的所有女人！在上市的情况下，也许一个不错的解决方案是继续缩短搜索针。在您的情况下，当您的搜索 $ 与“milwa”一样短时，将出现匹配项。

# ios - iPhone“滑动解锁”动画

> ID：438046
> 
> 赞同：75
> 
> 时间：2009-01-13T05:21:45.320
> 
> 标签：ios, objective-c, cocoa-touch, core-animation

关于Apple如何实现“滑动解锁”（另外，“滑动关闭电源”是另一个相同的例子）动画的任何想法？

我考虑过某种动画蒙版——但出于性能原因，iPhone OS 上不提供蒙版。

是否有一些他们可能使用过的私有 API 效果（如 SuckEffect）？聚光灯类型的效果？一些核心动画的东西？

编辑：这绝对不是一系列剧照。我见过编辑 plist 值或其他内容并在越狱 iphone 上自定义字符串的示例。

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2010-05-06T03:24:51.943

它可以通过使用 Core Animation 轻松完成，在显示文本的图层上为蒙版图层设置动画。

在任何普通的 UIViewController 中尝试此操作（您可以从基于基于*View 的应用程序*项目模板的新 Xcode 项目开始），或[在此处](http://dl.dropbox.com/u/713729/SlideToUnlock.zip)获取我的 Xcode 项目：

*请注意，该`CALayer.mask`属性仅在 iPhone OS 3.0 及更高版本中可用。*

```
- (void)viewDidLoad 
{
  self.view.layer.backgroundColor = [[UIColor blackColor] CGColor];

  UIImage *textImage = [UIImage imageNamed:@"SlideToUnlock.png"];
  CGFloat textWidth = textImage.size.width;
  CGFloat textHeight = textImage.size.height;

  CALayer *textLayer = [CALayer layer];
  textLayer.contents = (id)[textImage CGImage];
  textLayer.frame = CGRectMake(10.0f, 215.0f, textWidth, textHeight);

  CALayer *maskLayer = [CALayer layer];

  // Mask image ends with 0.15 opacity on both sides. Set the background color of the layer
  // to the same value so the layer can extend the mask image.
  maskLayer.backgroundColor = [[UIColor colorWithRed:0.0f green:0.0f blue:0.0f alpha:0.15f] CGColor];
  maskLayer.contents = (id)[[UIImage imageNamed:@"Mask.png"] CGImage];

  // Center the mask image on twice the width of the text layer, so it starts to the left
  // of the text layer and moves to its right when we translate it by width.
  maskLayer.contentsGravity = kCAGravityCenter;
  maskLayer.frame = CGRectMake(-textWidth, 0.0f, textWidth * 2, textHeight);

  // Animate the mask layer's horizontal position
  CABasicAnimation *maskAnim = [CABasicAnimation animationWithKeyPath:@"position.x"];
  maskAnim.byValue = [NSNumber numberWithFloat:textWidth];
  maskAnim.repeatCount = HUGE_VALF;
  maskAnim.duration = 1.0f;
  [maskLayer addAnimation:maskAnim forKey:@"slideAnim"];

  textLayer.mask = maskLayer;
  [self.view.layer addSublayer:textLayer];

  [super viewDidLoad];
} 
```

此代码使用的图像是：

[![遮罩层](https://i.stack.imgur.com/kmq78.png)](https://i.stack.imgur.com/kmq78.png) [![文字层](https://i.stack.imgur.com/RFLIl.png)](https://i.stack.imgur.com/RFLIl.png)

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2013-01-15T02:55:33.747

另一个使用图层蒙版的解决方案，而是手动绘制渐变并且不需要图像。View 是带有动画的视图，透明度是一个从 0 到 1 的浮点数，定义了透明度的量（1 = 没有透明度，这是毫无意义的），而 gradientWidth 是渐变的所需宽度。

```
CAGradientLayer *gradientMask = [CAGradientLayer layer];
 gradientMask.frame = view.bounds;
CGFloat gradientSize = gradientWidth / view.frame.size.width;
UIColor *gradient = [UIColor colorWithWhite:1.0f alpha:transparency];
NSArray *startLocations = @[[NSNumber numberWithFloat:0.0f], [NSNumber numberWithFloat:(gradientSize / 2)], [NSNumber numberWithFloat:gradientSize]];
NSArray *endLocations = @[[NSNumber numberWithFloat:(1.0f - gradientSize)], [NSNumber numberWithFloat:(1.0f -(gradientSize / 2))], [NSNumber numberWithFloat:1.0f]];
CABasicAnimation *animation = [CABasicAnimation animationWithKeyPath:@"locations"];

gradientMask.colors = @[(id)gradient.CGColor, (id)[UIColor whiteColor].CGColor, (id)gradient.CGColor];
gradientMask.locations = startLocations;
gradientMask.startPoint = CGPointMake(0 - (gradientSize * 2), .5);
gradientMask.endPoint = CGPointMake(1 + gradientSize, .5);

view.layer.mask = gradientMask;

animation.fromValue = startLocations;
animation.toValue = endLocations;
animation.repeatCount = HUGE_VALF;
animation.duration  = 3.0f;

[gradientMask addAnimation:animation forKey:@"animateGradient"]; 
```

**快捷版：**

```
let transparency:CGFloat = 0.5
let gradientWidth: CGFloat = 40

let gradientMask = CAGradientLayer()
gradientMask.frame = swipeView.bounds
let gradientSize = gradientWidth/swipeView.frame.size.width
let gradient = UIColor(white: 1, alpha: transparency)
let startLocations = [0, gradientSize/2, gradientSize]
let endLocations = [(1 - gradientSize), (1 - gradientSize/2), 1]
let animation = CABasicAnimation(keyPath: "locations")

gradientMask.colors = [gradient.CGColor, UIColor.whiteColor().CGColor, gradient.CGColor]
gradientMask.locations = startLocations
gradientMask.startPoint = CGPointMake(0 - (gradientSize*2), 0.5)
gradientMask.endPoint = CGPointMake(1 + gradientSize, 0.5)

swipeView.layer.mask = gradientMask

animation.fromValue = startLocations
animation.toValue = endLocations
animation.repeatCount = HUGE
animation.duration = 3

gradientMask.addAnimation(animation, forKey: "animateGradient") 
```

斯威夫特 3

```
fileprivate func addGradientMaskToView(view:UIView, transparency:CGFloat = 0.5, gradientWidth:CGFloat = 40.0) {        
    let gradientMask = CAGradientLayer()
    gradientMask.frame = view.bounds
    let gradientSize = gradientWidth/view.frame.size.width
    let gradientColor = UIColor(white: 1, alpha: transparency)
    let startLocations = [0, gradientSize/2, gradientSize]
    let endLocations = [(1 - gradientSize), (1 - gradientSize/2), 1]
    let animation = CABasicAnimation(keyPath: "locations")

    gradientMask.colors = [gradientColor.cgColor, UIColor.white.cgColor, gradientColor.cgColor]
    gradientMask.locations = startLocations as [NSNumber]?
    gradientMask.startPoint = CGPoint(x:0 - (gradientSize * 2), y: 0.5)
    gradientMask.endPoint = CGPoint(x:1 + gradientSize, y: 0.5)

    view.layer.mask = gradientMask

    animation.fromValue = startLocations
    animation.toValue = endLocations
    animation.repeatCount = HUGE
    animation.duration = 3

    gradientMask.add(animation, forKey: nil)
} 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-01-13T14:49:06.547

您可以使用`kCGTextClip`绘图模式设置剪切路径，然后使用渐变填充。

```
// Get Context
CGContextRef context = UIGraphicsGetCurrentContext();
// Set Font
CGContextSelectFont(context, "Helvetica", 24.0, kCGEncodingMacRoman);
// Set Text Matrix
CGAffineTransform xform = CGAffineTransformMake(1.0,  0.0,
                                                0.0, -1.0,
                                                0.0,  0.0);
CGContextSetTextMatrix(context, xform);
// Set Drawing Mode to set clipping path
CGContextSetTextDrawingMode (context, kCGTextClip);
// Draw Text
CGContextShowTextAtPoint (context, 0, 20, "Gradient", strlen("Gradient")); 
// Calculate Text width
CGPoint textEnd = CGContextGetTextPosition(context);
// Generate Gradient locations & colors
size_t num_locations = 3;
CGFloat locations[3] = { 0.3, 0.5, 0.6 };
CGFloat components[12] = { 
    1.0, 1.0, 1.0, 0.5,
    1.0, 1.0, 1.0, 1.0,
    1.0, 1.0, 1.0, 0.5,
};
// Load Colorspace
CGColorSpaceRef colorspace = CGColorSpaceCreateDeviceRGB();
// Create Gradient
CGGradientRef gradient = CGGradientCreateWithColorComponents (colorspace, components,
                                                              locations, num_locations);
// Draw Gradient (using clipping path
CGContextDrawLinearGradient (context, gradient, rect.origin, textEnd, 0);
// Cleanup (exercise for reader) 
```

设置一个 NSTimer 并改变位置的值，或者使用 CoreAnimation 来做同样的事情。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2011-04-18T23:49:49.207

我将上面 Pascal 提供的代码添加为 UILabel 上的一个类别，因此您可以以这种方式为任何 UILabel 设置动画。这是代码。可能需要为您的背景颜色等更改某些参数。它使用 Pascal 在他的答案中嵌入的相同蒙版图像。

```
//UILabel+FSHighlightAnimationAdditions.m
#import "UILabel+FSHighlightAnimationAdditions.h"
#import <UIKit/UIKit.h>
#import <QuartzCore/QuartzCore.h>

@implementation UILabel (FSHighlightAnimationAdditions)

- (void)setTextWithChangeAnimation:(NSString*)text
{
    NSLog(@"value changing");
    self.text = text;
    CALayer *maskLayer = [CALayer layer];

    // Mask image ends with 0.15 opacity on both sides. Set the background color of the layer
    // to the same value so the layer can extend the mask image.
    maskLayer.backgroundColor = [[UIColor colorWithRed:0.0f green:0.0f blue:0.0f alpha:0.15f] CGColor];
    maskLayer.contents = (id)[[UIImage imageNamed:@"Mask.png"] CGImage];

    // Center the mask image on twice the width of the text layer, so it starts to the left
    // of the text layer and moves to its right when we translate it by width.
    maskLayer.contentsGravity = kCAGravityCenter;
    maskLayer.frame = CGRectMake(self.frame.size.width * -1, 0.0f, self.frame.size.width * 2, self.frame.size.height);

    // Animate the mask layer's horizontal position
    CABasicAnimation *maskAnim = [CABasicAnimation animationWithKeyPath:@"position.x"];
    maskAnim.byValue = [NSNumber numberWithFloat:self.frame.size.width];
    maskAnim.repeatCount = 1e100f;
    maskAnim.duration = 2.0f;
    [maskLayer addAnimation:maskAnim forKey:@"slideAnim"];

    self.layer.mask = maskLayer;
}

@end

//UILabel+FSHighlightAnimationAdditions.h
#import <Foundation/Foundation.h>
@interface UILabel (FSHighlightAnimationAdditions)

- (void)setTextWithChangeAnimation:(NSString*)text;

@end 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-04-14T14:15:49.737

不是很新鲜......但也许它会有用

```
#define MM_TEXT_TO_DISPLAY          @"default"

#define MM_FONT             [UIFont systemFontOfSize:MM_FONT_SIZE]
#define MM_FONT_SIZE            25
#define MM_FONT_COLOR           [[UIColor darkGrayColor] colorWithAlphaComponent:0.75f];

#define MM_SHADOW_ENABLED           NO
#define MM_SHADOW_COLOR         [UIColor grayColor]
#define MM_SHADOW_OFFSET            CGSizeMake(-1,-1)

#define MM_CONTENT_EDGE_INSETS_TOP      0
#define MM_CONTENT_EDGE_INSETS_LEFT     10
#define MM_CONTENT_EDGE_INSETS_BOTTON   0
#define MM_CONTENT_EDGE_INSETS_RIGHT    10
#define MM_CONTENT_EDGE_INSETS          UIEdgeInsetsMake(MM_CONTENT_EDGE_INSETS_TOP, MM_CONTENT_EDGE_INSETS_LEFT, MM_CONTENT_EDGE_INSETS_BOTTON, MM_CONTENT_EDGE_INSETS_RIGHT)

#define MM_TEXT_ALIGNMENT           UITextAlignmentCenter
#define MM_BACKGROUND_COLOR         [UIColor clearColor]

#define MM_TIMER_INTERVAL           0.05f
#define MM_HORIZONTAL_SPAN          5

@interface MMAnimatedGradientLabel : UILabel {  

    NSString *textToDisplay;
    int text_length;

    CGGradientRef gradient;

    int current_position_x;
    NSTimer *timer;

    CGPoint alignment;

    CGGlyph *_glyphs;
}

- (id)initWithString:(NSString *)_string;

- (void)startAnimation;
- (void)toggle;
- (BOOL)isAnimating;

@end

#define RGB_COMPONENTS(r, g, b, a)  (r) / 255.0f, (g) / 255.0f, (b) / 255.0f, (a)

@interface MMAnimatedGradientLabel (Private)
- (CGRect)calculateFrame;
@end

@implementation MMAnimatedGradientLabel

// Missing in standard headers.
extern void CGFontGetGlyphsForUnichars(CGFontRef, const UniChar[], const CGGlyph[], size_t);

- (id)init {
    textToDisplay = MM_TEXT_TO_DISPLAY;
    return [self initWithFrame:[self calculateFrame]];
}

- (id)initWithString:(NSString *)_string {
    textToDisplay = _string;
    return [self initWithFrame:[self calculateFrame]];
}

-(id)initWithFrame:(CGRect)frame {  
    if (self = [super initWithFrame:frame]) {

        // set default values
        //
        self.textAlignment      = MM_TEXT_ALIGNMENT;
        self.backgroundColor    = MM_BACKGROUND_COLOR;
        self.font               = MM_FONT;
        self.text               = textToDisplay;
        self.textColor          = MM_FONT_COLOR;

        if (MM_SHADOW_ENABLED) {
            self.shadowColor        = MM_SHADOW_COLOR;
            self.shadowOffset       = MM_SHADOW_OFFSET;
        }

        text_length = -1;

        CGColorSpaceRef rgb = CGColorSpaceCreateDeviceRGB();
        CGFloat colors[] =
        {       
            RGB_COMPONENTS(255.0, 255.0, 255.0, 0.00),
//          RGB_COMPONENTS(255.0, 255.0, 255.0, 0.15),
            RGB_COMPONENTS(255.0, 255.0, 255.0, 0.95),
//          RGB_COMPONENTS(255.0, 255.0, 255.0, 0.15),
            RGB_COMPONENTS(255.0, 255.0, 255.0, 0.00)
        };

        gradient = CGGradientCreateWithColorComponents(rgb, colors, NULL, sizeof(colors)/(sizeof(colors[0])*4));
        CGColorSpaceRelease(rgb);

        current_position_x = -(frame.size.width/2);// - MM_CONTENT_EDGE_INSETS.left - MM_CONTENT_EDGE_INSETS.right); 
    }

    return self;
}

- (CGRect)calculateFrame {
    CGSize size = [textToDisplay sizeWithFont:MM_FONT];
    NSLog(@"size: %f, %f", size.width, size.height);
    return CGRectMake(0, 0, size.width + MM_CONTENT_EDGE_INSETS.left + MM_CONTENT_EDGE_INSETS.right, size.height + MM_CONTENT_EDGE_INSETS.top + MM_CONTENT_EDGE_INSETS.bottom);
}

- (void)tick:(NSTimer*)theTimer {
    if (current_position_x < self.frame.size.width)
        current_position_x = current_position_x + MM_HORIZONTAL_SPAN;
    else
        current_position_x = -(self.frame.size.width/2); // - MM_CONTENT_EDGE_INSETS.left - MM_CONTENT_EDGE_INSETS.right);

    [self setNeedsDisplay]; 
}

- (void)startAnimation {    
    timer = [[NSTimer alloc] initWithFireDate:[NSDate date] 
                                     interval:MM_TIMER_INTERVAL
                                       target:self 
                                     selector:@selector(tick:)
                                     userInfo:nil
                                      repeats:YES];

    [[NSRunLoop currentRunLoop] addTimer:timer forMode:NSDefaultRunLoopMode];
}

- (void)toggle {

    if (!timer) {
        timer = [[NSTimer alloc] initWithFireDate:[NSDate date] 
                                         interval:MM_TIMER_INTERVAL
                                           target:self 
                                         selector:@selector(tick:)
                                         userInfo:nil
                                          repeats:YES];

        [[NSRunLoop currentRunLoop] addTimer:timer forMode:NSDefaultRunLoopMode];
    } else {
        [timer invalidate];
        [timer release];
        timer = nil;

        current_position_x = -(self.frame.size.width/2);
        [self setNeedsDisplay]; 
    }
}

- (BOOL)isAnimating {

    if (timer) 
        return YES;
    else
        return NO;
}

- (void)drawRect:(CGRect)rect {
    CGContextRef ctx = UIGraphicsGetCurrentContext();

    // Get drawing font.
    CGFontRef font = CGFontCreateWithFontName((CFStringRef)[[self font] fontName]);
    CGContextSetFont(ctx, font);
    CGContextSetFontSize(ctx, [[self font] pointSize]);

    // Calculate text drawing point only first time
    // 
    if (text_length == -1) {    

        // Transform text characters to unicode glyphs.
        text_length = [[self text] length];
        unichar chars[text_length];
        [[self text] getCharacters:chars range:NSMakeRange(0, text_length)];

        _glyphs = malloc(sizeof(CGGlyph) * text_length);
        for (int i=0; i<text_length;i ++)
            _glyphs[i] = chars[i] - 29;

        // Measure text dimensions.
        CGContextSetTextDrawingMode(ctx, kCGTextInvisible); 
        CGContextSetTextPosition(ctx, 0, 0);
        CGContextShowGlyphs(ctx, _glyphs, text_length);
        CGPoint textEnd = CGContextGetTextPosition(ctx);

        // Calculate text drawing point.        
        CGPoint anchor = CGPointMake(textEnd.x * (-0.5), [[self font] pointSize] * (-0.25));  
        CGPoint p = CGPointApplyAffineTransform(anchor, CGAffineTransformMake(1, 0, 0, -1, 0, 1));

        if ([self textAlignment] == UITextAlignmentCenter) 
            alignment.x = [self bounds].size.width * 0.5 + p.x;
        else if ([self textAlignment] == UITextAlignmentLeft) 
            alignment.x = 0;
        else 
            alignment.x = [self bounds].size.width - textEnd.x;

        alignment.y = [self bounds].size.height * 0.5 + p.y;
    }

    // Flip back mirrored text.
    CGContextSetTextMatrix(ctx, CGAffineTransformMakeScale(1, -1));

    // Draw shadow.
    CGContextSaveGState(ctx);
    CGContextSetTextDrawingMode(ctx, kCGTextFill);
    CGContextSetFillColorWithColor(ctx, [[self textColor] CGColor]);
    CGContextSetShadowWithColor(ctx, [self shadowOffset], 0, [[self shadowColor] CGColor]);
    CGContextShowGlyphsAtPoint(ctx, alignment.x, alignment.y, _glyphs, text_length);
    CGContextRestoreGState(ctx);

    // Draw text clipping path.
    CGContextSetTextDrawingMode(ctx, kCGTextClip);
    CGContextShowGlyphsAtPoint(ctx, alignment.x, alignment.y, _glyphs, text_length);

    // Restore text mirroring.
    CGContextSetTextMatrix(ctx, CGAffineTransformIdentity);

    if ([self isAnimating]) {
        // Fill text clipping path with gradient.
        CGPoint start = CGPointMake(rect.origin.x + current_position_x, rect.origin.y);
        CGPoint end = CGPointMake(rect.size.width/3*2 + current_position_x, rect.origin.y);

        CGContextDrawLinearGradient(ctx, gradient, start, end, 0);
    }
}

- (void) dealloc {
    free(_glyphs);
    [timer invalidate];
    [timer release];

    CGGradientRelease(gradient);
    [super dealloc];
} 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-09-16T17:18:57.870

感谢 rpetrich 提供的剪裁渐变配方。我是一个新手 iPhone 和 Cocoa 开发人员，所以我真的很高兴找到它。

我已经使用 rpetrich 的方法实现了一个看起来不错的*Slide to Cancel UIViewController。*[你可以从这里](http://altosdesign.com/iphonesdk/SlideToCancel.zip)下载我的实现的 Xcode 项目。

我的实现使用重复的 NSTimer。我无法弄清楚如何使用 Core（或 Gore）动画让 iPhone 的图形引擎不断移动突出显示。我认为这可以在带有 CALayer 遮罩层的 OS X 上完成，但 iPhone OS 不支持遮罩层。

当我在 iPhone 的主屏幕上使用 Apple 的“滑动解锁”滑块时，我偶尔会看到动画冻结。所以我认为苹果可能也在使用计时器。

如果有人能弄清楚如何使用 CA 或 OpenGL 进行基于非计时器的实现，我很乐意看到它。

谢谢您的帮助！

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2015-01-18T19:01:06.007

我知道，我的答案有点晚了，但是 Facebook 有很棒的库[Shimmer](https://github.com/facebook/Shimmer)可以实现这种效果。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-05-25T14:30:29.187

我从上述解决方案中汲取了精华，并创建了一种可以为您解决所有问题的简洁方法：

```
- (void)createSlideToUnlockViewWithText:(NSString *)text
{
    UILabel *label = [[UILabel alloc] init];
    label.text = text;
    [label sizeToFit];
    label.textColor = [UIColor whiteColor];

    //Create an image from the label
    UIGraphicsBeginImageContextWithOptions(label.bounds.size, NO, 0.0);
    [[label layer] renderInContext:UIGraphicsGetCurrentContext()];
    UIImage *textImage = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();

    CGFloat textWidth = textImage.size.width;
    CGFloat textHeight = textImage.size.height;

    CALayer *textLayer = [CALayer layer];
    textLayer.contents = (id)[textImage CGImage];
    textLayer.frame = CGRectMake(self.view.frame.size.width / 2 - textWidth / 2, self.view.frame.size.height / 2 - textHeight / 2, textWidth, textHeight);

    UIImage *maskImage = [UIImage imageNamed:@"Mask.png"];
    CALayer *maskLayer = [CALayer layer];
    maskLayer.backgroundColor = [[UIColor colorWithRed:0.0 green:0.0 blue:0.0 alpha:0.15] CGColor];
    maskLayer.contents = (id)maskImage.CGImage;
    maskLayer.contentsGravity = kCAGravityCenter;
    maskLayer.frame = CGRectMake(-textWidth - maskImage.size.width, 0.0, (textWidth * 2) + maskImage.size.width, textHeight);

    CABasicAnimation *maskAnimation = [CABasicAnimation animationWithKeyPath:@"position.x"];
    maskAnimation.byValue = [NSNumber numberWithFloat:textWidth + maskImage.size.width];
    maskAnimation.repeatCount = HUGE_VALF;
    maskAnimation.duration = 2.0;
    maskAnimation.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseOut];
    [maskLayer addAnimation:maskAnimation forKey:@"slideAnimation"];

    textLayer.mask = maskLayer;
    self.slideToUnlockLayer = textLayer;
    [self.view.layer addSublayer:self.slideToUnlockLayer];
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-11-18T12:32:17.460

我向 GitHub 上传了一个帮助“滑动解锁”动画的迷你项目。

[https://github.com/GabrielMassana/GM_FSHighlightAnimationAdditions](https://github.com/GabrielMassana/GM_FSHighlightAnimationAdditions)

该项目有 LTR、RTL、Up to Down 和 Down to Up 动画，它基于以下帖子：

帕斯卡布尔克：[https ://stackoverflow.com/a/2778232/1381708](https://stackoverflow.com/a/2778232/1381708)

伯克利：[https ://stackoverflow.com/a/5710097/1381708](https://stackoverflow.com/a/5710097/1381708)

干杯

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-10-28T23:42:03.347

First, a HUGE thank you to marcio for his solution. This worked almost perfectly, saved me hours of effort, and made a huge splash in my app. My boss loved it. I owe you beer. Or several.

One small correction for iPhone 4 only. I mean the hardware itself, not just iOS 4\. They changed the system font on the iPhone 4 from Helvetica (iPhone 3Gs and below) to Helvetic Neue. This caused the translation you're doing from character to glyphs to be off by exactly 4 spots. For example the string "fg" would appear as "bc". I fixed this by explicitly setting the font to "Helvetica" rather than using "systemFontofSize". Now it works like a charm.

Again...THANK YOU!

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2020-10-11T19:33:18.357

这是一个 SwiftUI 版本：

```
public struct Shimmer: AnimatableModifier {

    private let gradient: Gradient

    @State private var position: CGFloat = 0

    public var animatableData: CGFloat {
        get { position }
        set { position = newValue }
    }

    private let animation = Animation
        .linear(duration: 2)
        .delay(1)
        .repeatForever(autoreverses: false)

    init(sideColor: Color = Color(white: 0.25), middleColor: Color = .white) {
        gradient = Gradient(colors: [sideColor, middleColor, sideColor])
    }

    public func body(content: Content) -> some View {
        LinearGradient(
            gradient: gradient,
            startPoint: .init(x: position - 0.2 * (1 - position), y: 0.5),
            endPoint: .init(x: position + 0.2 * position, y: 0.5)
        )
        .mask(content)
        .onAppear {
            withAnimation(animation) {
                    position = 1
                }
        }
    }
} 
```

像这样使用它：

```
Text("slide to unlock")
    .modifier(Shimmer()) 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-13T07:34:36.407

也许它只是一个渲染出来的动画——你知道，一系列的剧照一个接一个地播放。不一定是动态效果。

更新：没关系，DrJokepu 发布的视频证明它是动态生成的。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-04-23T14:21:44.920

*   顶部：具有不透明背景和清晰文本的 UILabel
    *   通过复杂的屏蔽过程在drawRect:func中呈现明文
*   中间：正在执行重复动画的工作视图，将图像移动到顶部标签后面
*   底部：按该顺序添加中间和顶部子视图的 UIView。可以是您希望文本的任何颜色

可以在这里看到一个例子[https://github.com/jhurray/AnimatedLabelExample](https://github.com/jhurray/AnimatedLabelExample)

# c# - 使用 C# 中的 C++ 类

> ID：438059
> 
> 赞同：1
> 
> 时间：2009-01-13T05:38:27.750
> 
> 标签：c#, c++, interop

好的，所以我有这个 C++ 图像捕获类。我想知道是否可以得到一些帮助..我知道基本的 C++（我已经完成了一个 c 介绍和一个 c++ 类的介绍），但我不知道如何做到这一点：

我需要使用这个类（即在我的解决方案中创建一个新的 c++ 项目）并使用 c# 来引用它并使用它来保存屏幕截图。

当我尝试添加一个新项目时，我不知道该选择哪一个（win32、mfc、atl、clr、abc、xyz 等）。

图像捕捉类在这里： http: [//pastebin.com/m72414ab](http://pastebin.com/m72414ab)

我不知道我是否需要创建 .h 文件或者只是一个 .cpp 文件就可以了。老实说，我不知道从哪里开始大声笑。我正在寻找一个解决方案，但我想在这个过程中学习，所以我下次不必问（更不用说我喜欢 c++ 所以我会继续用它编码）

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-13T06:09:44.910

如果不了解有关 C++/CLI 的一些专业信息，就无法轻松地从 C# 中使用 C++ 类 - 要么用 C 重写你的 C++ 类并使用 P/Invoke，要么找到完整的 C# 解决方案。

> 但我想使用这个 c++ 类来提高速度和内存。

我对此提出质疑，除非您每秒捕获数千次图像，否则选择 C++ 没有任何好处，而且它会使您的程序更加复杂。坚持使用 C#，直到你*知道*你需要轻微的性能提升。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-13T06:37:13.433

.NET 2.0 及更高版本在 Graphics 对象上包含[CopyFromScreen方法。](http://msdn.microsoft.com/en-us/library/system.drawing.graphics.copyfromscreen.aspx)您可以创建图像，为其获取绘图表面（图形），然后从屏幕复制到图像中。

快速搜索一下 Google 生成了一个[简单的教程](http://www.geekpedia.com/tutorial181_Capturing-screenshots-using-Csharp.html)，该教程使用 Visual Basic .NET 演示了这一点，尽管移植到 C# 很简单。

此解决方案导致您的 C++ 版本使用相同的 GDI+ 调用，其好处是不必链接外部 C++ 代码（如上所述，这并不简单）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T15:25:45.567

绝对可以使用 C# 中的 C++ 构造，但它确实需要一些肮脏的技巧。如果我没记错的话，上次我尝试这样做时，我在 C++ 和 C# 之间使用了托管 C++ 层，我认为这是最常见的方法。这种方法效果很好，但确实是不必要的复杂。

# php - MySQL选择总和的记录

> ID：438062
> 
> 赞同：0
> 
> 时间：2009-01-13T05:39:08.873
> 
> 标签：php, mysql, sum

我正在使用 MySQL 和 PHP。我有一个包含列 id 和数量的表。我想检索最后一个求和数量的行的 id，因为它总和达到数字 40。更具体。我在数据库中有 3 行。一个数量为 10，一个数量为 30，一个数量为 20。因此，如果我将数量相加得到结果 40，我将总结前两个女巫的意思：10 + 30 = 40。这样，最后一个 Id用于将数字 40 相加为 2。我只想知道用于完成 40 和的最后一行的 id。

如果被问到，我会提供更多细节。谢谢你！！

* * *

这么说吧：我手里真的有6件产品。第一个在 10 日到达我的财产，接下来的 3 个在 11 日到达，最后两个在 12 日到达。

现在，我想从我的库存中出售 3 种产品。并希望按照它们来的顺序出售它们。因此，对于想要 3 种产品的客户，我会向他出售第 10 种产品的产品和第 11 种产品中的 2 种产品。

对于下一个想要 2 种产品的客户，我会从 11 日开始向他出售最后一次订购 3 种产品的产品，以及 12 日剩余的另一种产品。

问题是我怎么知道我出售的每种产品的价格是多少？我想如果我能找出每个请求数量的总和，我就会知道每次我想交付订单时从哪里开始计算总和。所以首先我会看看哪些行总结了 3 个产品并保留条目 ID。对于下一个订单，我将从该 ID 开始计数并求和，直到它总结了 2 个产品的第二个订单，依此类推。我认为通过这种方式，我可以跟踪每种产品的进货价格。所以从 12 日起，我不会以使用最初价格的价格出售产品。

我希望你明白。我只需要知道我的任何产品的价格是多少，这样我就知道第一批产品会有一个价格，但随着产品价格上涨，我也必须提高价格......所以最后一批产品必须卖掉更高的价格。如果我跟踪这一点，我只能做到这一点......

非常感谢你。

* * *

没有人 ？或者，更简单：MySQL 应该为 SUM( ) 选择所需的行`quantity`，例如大于或等于 40。然后让我得到参与求和过程的最后一行的 ID。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T05:47:17.250

有一个运行总计的第三列。然后，您可以简单地返回运行总计 <= 您的目标值的最后一行。

所以你的表应该是这样的：

```
ID 数量 RunningTotal
1 10 10
2 30 40
3 20 60
```

注意：如果您删除表中的一行，请记住更新所有后续行`RunningTotal -= DeletedRow.Quantity`！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T06:03:33.690

依赖表 ID 可能是一个坏主意，但如果确实如此，您可以尝试这样的事情（未经测试）：

```
SELECT yourTableA.id
  FROM yourTable AS yourTableA
  JOIN yourTable AS yourTableB
 WHERE ( yourTableA.value + yourTableB.value ) = 40
   AND yourTableA.id != yourTableB.id
 ORDER BY yourTableA.id 
```

仅当您期望只需要两行来等于目标总和时，这种类型的解决方案才有效。由于这很可能不是这种情况，因此您最好的选择可能是尝试获取所有行并以编程方式对返回的数据执行此操作。

lc 发布的 Running Total 解决方案也是一个不错的选择，尽管我通常会尽量避免存储计算数据，除非我绝对必须这样做。

* * *

根据此请求的更新信息，我有一个替代答案。

这听起来不像你关心库存。您更关心产品何时进来。

```
SELECT *
  FROM product
 ORDER BY product.receivedData 
```

在每条记录进入时对其进行处理，存储该记录的价格，并根据需要继续进行，直到达到所需的项目数量。您应该最终得到一个项目列表、该级别的库存数量和该级别的价格。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T07:03:54.677

我不太明白你的问题。你可以尝试更恰当地改写它吗？根据我的解释，这是您的数据库的结构：

```
ProductID    ArrivalDate
   1          10
   2          11
   3          11
   4          11
   5          12
   6          12 
```

现在您在问，“我怎么知道我出售的每种产品**的价格”？**这让我很困惑，因为数据库中的每个值都没有价格属性。你的数据库不应该是这样的：

```
ProductID    ArrivalDate    Price
   1          10              100
   2          11              200
   3          11              300
   4          11              300
   5          12              400
   6          12              400 
```

就个人而言，我认为你找出售价的想法是有缺陷的。在数据库中添加更多字段会更有意义：

```
ProductID    ArrivalDate    Price     InStock   DateSold
   1          10              100       Yes        17
   2          11              200       Yes        17
   3          11              300       Yes        18
   4          11              300       Yes        18
   5          12              400       no        
   6          12              400       no 
```

在更改数据库时，您可以轻松地跟踪产品的到达时间、销售日期、价格，可能还有数量（我不知道它是否是实际字段）。

此外，您可以通过分离 sql​​ 查询，甚至添加一些代码来为您完成一些工作，从而简化并让您的生活更轻松。

# c# - 开始现代游戏编程和应用程序编程的最佳方式是什么？

> ID：438067
> 
> 赞同：3
> 
> 时间：2009-01-13T05:44:59.030
> 
> 标签：c#, c++, c, .net-3.5

我想开始使用 C/C++ 或带有 DirectX 或 OpenGL 的 C# 进行游戏编程。我不太确定我想开始什么，但是像一个简单的引擎这样的小型项目会很好开始。此外，我想了解如何使用 C#、.NET 3.5 和 WPF 在 Windows 中设计应用程序。利用 C# 和 .NET，我打算创建一个与 windows shell 集成的相当大的项目。但是，我真的不知道从哪里开始。此外，我精通 C/C++、JAVA，并且正在学习高级计算机科学课程，重点是算法复杂性和经典计算机科学问题。任何关于从哪里开始的帮助将不胜感激。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-13T06:10:24.613

现代游戏编程作为一个整体非常复杂，但在分工方面也非常分散，这有助于降低这种复杂性。现代游戏通常过于复杂和庞大，以至于一个人无法详细深入地了解整个过程。游戏编程中有很多专业是您可能想要熟悉的，并决定是否有您真正喜欢做的特定方面：

*   [游戏物理程序员](http://en.wikipedia.org/wiki/Game_programmer#Game_physics_programmer)
*   [人工智能程序员](http://en.wikipedia.org/wiki/Game_programmer#Artificial_intelligence_programmer)
*   [图形程序员 / 3D 建模](http://en.wikipedia.org/wiki/Game_programmer#Graphics_programmer)
*   [声音程序员](http://en.wikipedia.org/wiki/Game_programmer#Sound_programmer)
*   [脚本编写者](http://en.wikipedia.org/wiki/Game_programmer#Scripter)（为几乎所有游戏内事件使用内部脚本）
*   [用户界面程序员](http://en.wikipedia.org/wiki/Game_programmer#UI_programmer)
*   [网络程序员](http://en.wikipedia.org/wiki/Game_programmer#Network_programmer)
*   [工具程序员](http://en.wikipedia.org/wiki/Game_programmer#Game_tools_programmer)
    ......等等。

最近，我在大学的计算机图形学课程中使用了开源[OGRE 3D](http://www.ogre3d.org/)引擎。这不仅是一个非常强大的 3D 引擎，而且是一个爆炸！使用它开发中型游戏，您将很好地体验上述许多游戏编程专业。你会发现自己在做 3D 建模、音效、物理编程、人工智能等工作。

最近的 OGRE 3D 游戏截图： [替代文字 http://www.ogre3d.org/gallery/albums/album76/snapshot20081030015244.jpg](http://www.ogre3d.org/gallery/albums/album76/snapshot20081030015244.jpg)

游戏编程世界有一些注意事项。我经常听到和阅读有关行业的[文章](http://ea-spouse.livejournal.com/274.html)，谈论与其他类型的编程相比，工作时间长、加班时间、无偿加班和相对较低的工资。但老实说，如果这是你想做的事情，那么不要让这些事情让你失望。我喜欢认为大多数有足够动力的人都会获得良好的薪酬和工作条件。

至于学校，你提到你正在学习一些 CS 课程。也参加一些数学课程！游戏编程是数学在多个开发阶段中广泛使用的领域之一。

我读过的大多数涉及该行业的文章都建议，没有专业经验的人希望进入游戏行业，应该将您编写的小游戏组合在一起，以展示您的能力。

[初级游戏程序员从工具程序员](http://en.wikipedia.org/wiki/Game_programmer#Game_tools_programmer)开始为游戏开发团队的其他成员编写内部软件也是相当典型的。诸如地图制作程序、诊断工具、格式转换等之类的东西。然后您可以继续前进。

祝你好运！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T06:05:52.157

你可能想看看

*   [https://stackoverflow.com/questions/174830/learning-game-programming](https://stackoverflow.com/questions/174830/learning-game-programming)
*   [https://stackoverflow.com/questions/332650/open-game-dev-projects](https://stackoverflow.com/questions/332650/open-game-dev-projects)

如果你想学习开发引擎，我推荐[这本书](https://rads.stackoverflow.com/amzn/click/com/1598633422) :)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T05:50:51.767

对于 C/C++，我会说[NeHe](http://nehe.gamedev.net/)教程是入门 (OpenGL) 和[DirectXtutorial.com](http://www.directxtutorial.com/)的好地方。如果您倾向于 C# 类别，那么 XNA 是您的最佳选择。

GameDev是一个很好的网站，可以帮助您进一步了解该主题[。](http://gamedev.net)有很多像你一样有抱负的开发者，还有很多人愿意在游戏编程的任何方面帮助你，祝你好运！

# c# - 创建数据集 ASP.Net 的子集

> ID：438074
> 
> 赞同：0
> 
> 时间：2009-01-13T05:50:40.283
> 
> 标签：c#, asp.net, dataset

我有一个包含大约 28 列的数据集现在我想创建另一个数据集，其中将包含两个数据表，每个表中有 14 列来自前一个数据集。

需要帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T06:35:02.160

我会假设你有一些数据。

使用前 14 列（firstPart）创建数据表，另一个使用最后 14 列加上主键（secondPart）。

```
 DataTable firstPart = new DataTable();
    //Initialize columns here...

    DataTable secondPart = new DataTable();
    //Initialize columns here...

    foreach(DataRow r in original.Rows){
        DataRow f = firstPart.NewRow();
        f[0] = r[0];
        f[1] = r[1];
        f[2] = r[2];
        f[3] = r[3];
        f[4] = r[4];
        f[5] = r[5];
        f[6] = r[6];
        f[7] = r[7];
        f[8] = r[8];
        f[9] = r[9];
        f[10] = r[10];
        f[11] = r[11];
        f[12] = r[12];
        f[13] = r[13];
        firtPart.Rows.Add(f);

        DataRow s = secondPart.NewRow();
        s[0] = r[0];
        s[1] = r[14];
        s[2] = r[15];
        s[3] = r[16];
        s[4] = r[17];
        s[5] = r[18];
        s[6] = r[19];
        s[7] = r[20];
        s[8] = r[21];
        s[9] = r[22];
        s[10] = r[23];
        s[11] = r[24];
        s[12] = r[25];
        s[13] = r[26];
        s[14] = r[27];
        secondPart.Rows.Add(f);
    }
    firtPart.AcceptChanges();
    secondPart.AcceptChanges(); 
```

您可以将约束添加到表集合和/或数据集的 realtionships 集合中的表之间的关系。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-02-03T20:10:42.613

如果您[想](https://msdn.microsoft.com/en-us/library/wec2b2e6(v=vs.110).aspx)在没有`loop`. 它通过定义所需的列名从数据表中创建一个子集

```
 dtLogExport == dsManifestAuditTrailLog.Tables(0).DefaultView.ToTable(false, "RevisionNo", "TabName", "RecordNumber") 
```

# c# - 自动递增文件名

> ID：438087
> 
> 赞同：0
> 
> 时间：2009-01-13T05:56:00.040
> 
> 标签：c#, string

我有一个具有以下格式的文件名：

时间戳-用户名-1

这个文件不断被写入，但在它变得太大之前我想创建一个新文件。

时间戳-用户名-2

如何使用最少的内存（即没有或很少的变量）来实现这一点

这是我的版本：

```
 private void Split() {
            char[] strArr = FlowArgs.Filename.ToCharArray();
            int num;
            //get the last number
            if(Int32.TryParse(strArr[strArr.Length - 1].ToString(), out num)) {
                num += 1;
            }
            //replace the old number with the new number
            char.TryParse(num.ToString(), out strArr[strArr.Length - 1]);
            FlowArgs.Filename = strArr.ToString();

        } 
```

编辑：我在 FlowArgs 类中添加了一个“版本”属性（int）。但是我的新问题是如何在文件名的末尾附加这个

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T06:06:49.517

我认为您应该将计数器存储在 int 中。我知道您想节省内存空间，但老实说，额外的 int 确实属于“可接受”类别。我的意思是，Int32 解析器可能会浪费更多的内存。不要忘记在 x86 上，内存空间被分配到 4096 字节页面，因此浪费的内存比这 4 个字节多得多。

**编辑**：您可能希望在您的类中有一个像 GetNextFileName() 这样的方法来为您生成下一个文件名（能够将代码重构为小位很重要，比节省内存空间更重要）：

```
private int nextFileNumber = 0;

private string GetNextFileName(string userName)
{
    return String.Format("{0}-{1}-{2}", DateTime.Now, userName,
       nextFileNumber++);
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T06:05:54.137

“最少的内存”不等于“没有或很少的变量”

局部变量本身只占用很少的内存。但是在堆中创建对象需要更多的时间，而且它们需要 GC 来进行清理。

在您的示例中，您的 ToCharArray() 和 ToString() 创建了 4 个对象（不包括间接创建的对象）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T06:15:10.593

您的字符串变量已经是字符数组：

```
 int num=0;
    //get the last number
    if (Int32.TryParse(FolwArgs.Filename[FolwArgs.Filename.Length-1].ToString(), out num))
        num++;
    //replace the old number with the new number
    char.TryParse(num.ToString(), out FolwArgs.Filename[FolwArgs.Filename.Length-1]]); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T06:16:49.153

与其使用运行计数器，不如考虑将`datetime of creation`其用作文件名的更改部分。这样，您不必存储和检索以前的值。使用该[`ToBinary()`](http://msdn.microsoft.com/en-us/library/system.datetime.tobinary.aspx)方法，您可以获得时间的数字表示。当然，可以使用文件名中可接受的任何[时间格式- 请参阅](http://msdn.microsoft.com/en-us/library/8kb3ddd4.aspx)[自定义日期和时间格式字符串](http://msdn.microsoft.com/en-us/library/8kb3ddd4.aspx)。

# winapi - 如何打开“nul”文件？

> ID：438092
> 
> 赞同：5
> 
> 时间：2009-01-13T06:04:25.607
> 
> 标签：winapi

我需要创建一个将标准错误流重定向到某个文件的新进程。创建子进程的代码没有可用的控制台，因此在某些情况下 GetStdHandle(any) 将返回 0。子进程将出于某种原因尝试复制其所有标准 IO 句柄（子进程的源代码不可用) 所以它的所有句柄都应该是有效的。

所以我需要以与可以从控制台运行相同的方式运行该过程：

```
someproc <nul >nul 2>err 
```

我看到了一些方法： 1\. 创建两对管道。这可能是一个很好的解决方案，但对我来说太复杂了。2\. 使用 CreateFile("nul", ...) 函数调用打开“nul”文件。此调用未创建任何文件，但这对我来说也很奇怪。3\. 使用 INVALID_HANDLE_VALUE。这也有效，但我认为另一个子进程可能存在不同的问题。

我相信有更好的方法。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-13T06:13:07.227

正如最初所说，您已经回答了自己的问题。要打开“nul”文件，您只需指定`"nul"`何时调用`CreateFile`. 它只是看起来很奇怪，因为几乎没有人使用过该文件名。（我认为它的使用频率几乎没有我看到的那么频繁`/dev/null`。）不过，它是完全有效的。

但是，如果您发现它也`Invalid_Handle_Value`有效，那么请继续使用它。这当然是最简单的。最初，我没想到它会起作用，因为我不希望它是可复制的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T06:16:54.693

是的，“nul”正在做你认为的事情。如果你迁移到 unix，它将是“/dev/null”。这个时髦的名字是 DOS 时代的遗留物，还有“prn”和“com1”等。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T09:02:52.970

与 DuplicateHandle 一起使用`INVALID_HANDLE_VALUE`是不合适的：文档指出您需要`PROCESS_DUP_HANDLE`对句柄的访问权限。你没有那个权利`INVALID_HANDLE_VALUE`。不过，设备`NUL`（指向 的符号链接`/device/null`）可以正常工作。

# asynchronous - 执行异步操作的自定义 Windows 工作流活动 - 使用通用服务重做

> ID：438095
> 
> 赞同：2
> 
> 时间：2009-01-13T06:06:09.003
> 
> 标签：asynchronous, workflow, workflow-foundation, workflow-activity

我正在编写一个自定义 Windows Workflow Foundation 活动，它异步启动一些进程，然后在异步事件到达时唤醒。

我发现的所有示例（例如[Kirk Evans](http://blogs.msdn.com/kaevans/archive/2007/07/02/asynchronous-workflow-activities-implemented-asynchronous-webrequests.aspx)的示例）都涉及自定义工作流服务，该服务完成大部分工作，然后将事件发布到活动创建的队列。主要原因似乎是发布事件的唯一方法[在非 WF 线程中工作]是 WorkflowInstance.EnqueueItem，并且活动无权访问工作流实例，因此它们无法发布事件（来自我接收异步操作结果的非 WF 线程）。

我不喜欢这种设计，因为这会将功能分成两部分，并且需要在添加新活动类型时向主机添加服务。丑陋。

所以我编写了以下通用服务，我从活动的异步事件处理程序中调用它，并且可以被各种异步活动重用（省略错误处理）：

```
class WorkflowEnqueuerService : WorkflowRuntimeService
{
    public void EnqueueItem(Guid workflowInstanceId, IComparable queueId, object item)
    {
        this.Runtime.GetWorkflow(workflowInstanceId).EnqueueItem(queueId, item, null, null);
    }
} 
```

现在在活动代码中，我可以获得并存储对此服务的引用，启动我的异步操作，当它完成时，使用此服务将事件发布到我的队列。这样做的好处 - 我将所有特定于活动的代码保留在活动中，并且我不必为每种活动类型添加新服务。

但是看到官方和互联网示例这样做会专门提供不可重用的服务，我想检查这种方法是否可以，或者我在这里制造了一些问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T14:22:23.713

这里有一个关于工作流持久性的潜在问题。

如果您创建长期运行的工作流，这些工作流在数据库中持久保存到运行时将能够重新启动，这些工作流不会重新加载到内存中，直到有一些外部事件重新加载它们。在那里，他们负责自己触发事件，但在重新加载之前不能。我们有一个陷阱 22 :-(

正确的方法是使用外部服务。虽然这可能感觉像是将代码分成两个地方，但实际上并非如此。原因是工作流负责大局，IE应该做什么。运行时服务负责实际实现或应该如何完成。这样，您就可以在不更改原因和时间部分的情况下更改方式。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-22T00:37:15.400

后续行动——无论出于何种原因，为什么“应该”使用服务来完成，这将由 .NET 4.0 直接支持，它为 Activity 启动异步工作提供了一种干净的方式，同时暂停了活动。

有关详细信息，请参阅 [http://msdn.microsoft.com/en-us/library/system.activities.codeactivitycontext.setupasyncoperationblock(VS.100).aspx](http://msdn.microsoft.com/en-us/library/system.activities.codeactivitycontext.setupasyncoperationblock(VS.100).aspx) 。

# .net - Excel、OleDb 和前导零

> ID：438099
> 
> 赞同：0
> 
> 时间：2009-01-13T06:10:01.477
> 
> 标签：.net, excel, oledb, import

我有一个使用 OleDb 将数据从 excel 文件读取到 DataSet 的过程。一切都运行良好，直到我开始看到其中包含前导 0 的数据。文本的格式为常规或文本。

我在 OleDb 连接中设置了 IMEX=1，但对于每个前导 0 的条目，我仍然在数据集中得到一个空值。

有谁知道解决这个问题的方法？

**编辑**

作为一些附加信息，我必须保留前导 0，并且该列的格式设置为 General。我也试过文本。

具有前导零的第一个条目位于第 11 行，并返回空值。此特定表上的所有其他数据都是此列的数字。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-13T06:16:31.387

我敢打赌，数据以文本形式存储在 Excel 电子表格中；因为它本身不会有前导零（尽管可以对单元格进行格式化以显示它们。）我希望 OleDb 会询问 Excel 什么数据类型，而 Excel 认为它们是字符串。

查看其中一个 Excel 单元格，看看它在顶部的数据输入条中是否有加载零；还是它有一个领先的撇号或类似的撇号？

如果是这种情况（或者即使不是，但您想要未格式化的数据），我想到的一种方法是将工作表复制到另一个工作表并使用 Val(address) 函数转换 Excel 列，并且在没有前导零的情况下重新格式化它；然后从中读取。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T07:38:48.287

我能看到的最好的事情是，您必须创建一个预先格式化的 excel 文件，然后将其用于您需要的数据。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T00:59:58.233

您的前 10 行是纯数字数据吗？

然后驱动程序正在判断整列是否为数字。当它遇到不适合的数据时，它会窒息。您可能将其视为 NULL 或 0。

我会尝试：
1）删除 IMEX - 不使用它进行实验
2）尝试在该列中的所有数据中添加一个单引号作为第一个字符。
这在 Excel 中“强制文本”。作为测试，只需在前 11 行上尝试一下。
这应该强制驱动程序将列视为文本。NULL 应该消失。

有一些方法可以增加行“样本大小”......但我不记得在连接字符串中使用的关键字。

# php - CakePHP 中的 $data findAll 查询检查第二个表中的值

> ID：438105
> 
> 赞同：0
> 
> 时间：2009-01-13T06:14:22.343
> 
> 标签：php, mysql, cakephp, findall

仅当 $data 查询表 [id] 在第二个表中具有匹配的 [sub_id] 时，我一直被 CakePHP 难倒如何在 CakePHP 中查询 DB 并将内容返回给 $data

标准查询：

```
$data = $this->Table1->findAll(array("Table1.deleted" => "0"), null, "Table1.id DESC", 25, null, 1); 
```

但是我只想在 ['table2']['sub_id'] 中找到 $data['Table1']['id'] 时将值放入 $data

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T06:38:35.787

如果您的关系设置正确，它应该会自动执行此操作。您可以粘贴表 1 和表 2 的模型关系设置吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-14T01:53:06.190

在模型中，在关系数组中添加：

```
$hasMany = array(
.....
'required' => true
....
); 
```

这应该使它在 sql 中进行内部联接而不是左联接。希望这可以帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T16:56:28.927

超新星 -

请为我澄清一件事：您写道，当在 table2.sub_id 中找到 table1.id 时，您只想将值放入 $data。你的意思是 table2.sub_id 是一个外键，链接到 table1？

我认为 Beau 是对的——如果您正确链接了模型，使用 HABTM 或 belongsTo 等变量，findAll 应该自动从 table2 中提取相关记录。

最后需要注意的是模型关联受 Model->recursive 值的影响。如果您在代码中更改了递归属性的值，它将改变模型关系在给定查询中允许的深度。

！

# javascript - 在 JavaScript 中设置默认主页

> ID：438108
> 
> 赞同：3
> 
> 时间：2009-01-13T06:16:39.403
> 
> 标签：javascript, browser

如何创建链接以将用户主页设置为我的 URL？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-14T13:23:51.833

正如有些人已经回答的那样，它曾经可以在 Internet Explorer 中（我相信在 IE 7 之前，但可能是错误的）使用类似于

```
document.setHomePage('www.example.com'); 
```

我认为任何浏览器都不再支持它了。但是，我肯定会尝试说服您不这样做。大多数人不喜欢自动更改他们的设置，即使它是由鼠标单击或其他操作触发的。过分热心的“保护”程序也很可能会跳过它并将其标记为恶意攻击。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T06:31:49.530

据我所知，这在 Internet Explorer 中是可能的

```
Make my Page your
<a href="javascript:history.go(0)" onClick="this.style.behavior='url(#default#homepage)';
 this.setHomePage('http://www.test.de');">Startpage</a>. 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T06:30:35.897

我假设您的意思是在您的页面中放置一个链接以使其成为浏览器主页？在 IE 中，您可以执行以下操作：

```
this.setHomePage('http://www.mysite.com'); 
```

我认为这在 Firefox 中不起作用。

# java - 使用进程外数据库访问进行 Rails 测试？

> ID：438112
> 
> 赞同：2
> 
> 时间：2009-01-13T06:19:57.230
> 
> 标签：java, ruby-on-rails, servlets, transactions, rspec

我正在构建一个 Rails 应用程序，它需要一些模型来与一些必要的 Java 库进行交互。为此，我想在 MRI 上使用 Rails，而不是 JRuby 或 RBJ。Java 代码只需要对 Rails 应用程序管理的数据库表的读取权限。

一种方法是设置一个读取 Rails 应用程序数据库表的 Servlet。

问题在于，在测试期间，使用 Rails 事务性固定装置会使测试*期间的所有数据库活动*[对外部进程](https://stackoverflow.com/questions/437760/where-does-rails-store-data-created-by-saving-activerecord-objects-during-tests)（如 Servlet）不可见。

对于部署来说，这不是问题，但是在这些条件下如何进行自动化测试还不是很清楚。

如何使用 RSpec 测试依赖于外部进程的 Rails 模型，这些进程可以访问 Rails 管理的表？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T06:53:55.477

关闭事务装置，数据库写入应该对外部进程可见。在您要使用 put 执行此操作的测试类中：

```
self.use_transactional_fixtures = false 
```

或者`test/test_helper.rb`如果您希望它适用于所有内容，请将其放入。请注意，您的测试可能会运行得更慢，因为所有内容实际上都在访问数据库。

# asp.net - ASP.Net Gridview，如何根据 ID（DataKey）激活编辑模式

> ID：438116
> 
> 赞同：2
> 
> 时间：2009-01-13T06:23:24.040
> 
> 标签：asp.net, gridview

我有一个页面，我们称之为 SourceTypes.aspx，它有一个显示源类型列表的 GridView。GridView 的一部分是一个DataKey，SourceTypeID。如果源 TypeID 通过查询字符串传递到页面，如何根据 SourceTypeID 将 Gridview 置于相应行的编辑模式？

GridView 绑定到 SQlDataSource 对象。

当答案出现时，我有一种感觉我会踢自己！

我已经查看了[以编程方式将 gridview 行置于编辑模式](https://stackoverflow.com/questions/206983/putting-a-gridview-row-in-edit-mode-programmatically)，但它缺乏一些细节

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T06:48:52.663

当您想根据数据将其置于编辑模式时，这有点棘手。你告诉数据网格它显示的哪些行是可编辑的，而不是你想要编辑的数据，所以你需要遍历网格中的每一行，看看它是否与 id 匹配，并将 EditItemIndex 设置为适当的价值和重新绑定。

您可以在绑定之前查看源数据并从中获取行号，但是您可能会遇到分页、排序等问题。

必须重新绑定网格有点混乱，但我想不出更好的方法。

```
public partial class _Default : System.Web.UI.Page
{

    private DataTable GetData()
    {
        DataTable tTable = new DataTable();
        tTable.Columns.Add(new DataColumn("Column1", typeof(int)));
        tTable.Columns.Add(new DataColumn("Column2", typeof(string)));

        DataRow tRow = tTable.NewRow();
        tRow["Column1"] = 1;
        tRow["Column2"] = "Test1";
        tTable.Rows.Add(tRow);

        tRow = tTable.NewRow();
        tRow["Column1"] = 2;
        tRow["Column2"] = "Test2";
        tTable.Rows.Add(tRow);

        tRow = tTable.NewRow();
        tRow["Column1"] = 3;
        tRow["Column2"] = "Test3";
        tTable.Rows.Add(tRow);

        tRow = tTable.NewRow();
        tRow["Column1"] = 4;
        tRow["Column2"] = "Test4";
        tTable.Rows.Add(tRow);

        tRow = tTable.NewRow();
        tRow["Column1"] = 5;
        tRow["Column2"] = "Test5";
        tTable.Rows.Add(tRow);

        return tTable;
    }

    private void BindData()
    {
        DataTable tTable = GetData();

        TestGrid.DataSource = tTable;
        TestGrid.DataBind();

        if (!String.IsNullOrEmpty(Request.QueryString["edit"]))
        {
            foreach (DataGridItem tRow in TestGrid.Items)
            {
                if (tRow.Cells[0].Text == Request.QueryString["edit"])
                    TestGrid.EditItemIndex = tRow.ItemIndex;
            }
            TestGrid.DataBind();
        }
    }

    protected void Page_Load(object sender, EventArgs e)
    {
        if (!Page.IsPostBack)
            BindData();
    }
} 
```

您应该能够启动它（显然将数据网格添加到 ASPX）然后将 ?edit= 放在 URL 的末尾以使其在编辑模式下打开相关条目。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-28T11:12:06.457

首先，非常感谢史蒂夫罗宾斯让我开始走上正轨。我的方法略有不同，部分原因是我没有使用 DataBind 方法。

我使用 DataView 的 OnRowDataBound 和 OnDataBound 事件的组合。OnRowDataBound 事件确定要进入编辑模式的行的索引。OnDataBound 事件设置索引并重新绑定 DataView。

使用一个变量来确保 View 不会持续反弹。

为简洁起见，这里是编辑过的 aspx 页面的症结所在。

```
<asp:GridView ID="GridView1" runat="server" 
              DataSourceID="CreativeTypeDS"
              AutoGenerateColumns="False" 
              DataKeyNames="SourceCreativeTypeID" 
              EmptyDataText="No Cretive Types at this time."
              CellPadding="3" CellSpacing="1"
              OnRowDataBound="GridView1_RowDataBound"
              OnDataBound="GridView1_DataBound" >
        <Columns>
           [Template Columns Here]
        </Columns>
</asp:GridView>

<asp:SqlDataSource ID="CreativeTypeDS" runat="server" 
                   SelectCommand="cmsSourceCreativeTypeSel"
                   SelectCommandType="StoredProcedure" 
           UpdateCommand="cmsSourceCreativeTypeUpd"
                   UpdateCommandType="StoredProcedure">
    <SelectParameters>                
       <asp:Parameter Name="Active" DefaultValue="0" />
    </SelectParameters>
    <UpdateParameters>
       <asp:Parameter Name="SourceCreativeTypeID" Type="Int32" />
       <asp:Parameter Name="SourceCategoryID" Type="Int32"/>
       <asp:Parameter Name="Name" Type="String" />
       <asp:Parameter Name="Active" Type="Boolean" />
     </UpdateParameters>
</asp:SqlDataSource> 
```

现在是后面的代码。

```
 public partial class SourceCreativeTypes : System.Web.UI.Page
 {
    private int? EditIndex = null;
    private bool GridRebound = false;
    protected override void OnPreInit(EventArgs e)        
    {
       CreativeTypeDS.ConnectionString = "[CONNECTION STRING MAGIC HERE]";
    }

    protected void Page_Load(object sender, EventArgs e)
    {
        if (IsPostBack)
        {                
            //Dont Want to set edit row manualy if post back
            GridRebound = true;
        }
    }

    //Use the Row Databound Event to find the row to put into edit mode 
    protected void GridView1_RowDataBound(object sender, GridViewRowEventArgs e)
    {
        if (!String.IsNullOrEmpty(Request.QueryString["ID"]))
        {
            //Get Target ID from Query String
            string sSourceCreativeTypeID = Request.QueryString["ID"];
            //Get data for row being bound
            DataRowView rowView = (DataRowView)e.Row.DataItem;

            // Set index if we are in a "normal row", the row data 
            // has been retrieved
            // and the Supplied ID matches that of this row
            if ((e.Row.RowState == DataControlRowState.Normal || 
                e.Row.RowState == DataControlRowState.Alternate) 
                &&
                (rowView != null && 
                 rowView["SourceCreativeTypeID"].ToString() == sSourceCreativeTypeID)
                )
            {                   
                EditIndex = e.Row.RowIndex;                   
            }
        }
    }

    /* Use the Datbound Event to set the required row to index mode
     * Then Rebind the grid. Rebinding in Row Databound does not work
     * for Reasons unknown */
    protected void GridView1_DataBound(object sender, EventArgs e)
    {
        //Set Gridview edit index if one is supplied and page is not a post back
        if (!GridRebound && EditIndex != null)
        {
            //Setting GridRebound ensures this only happens once
            GridRebound = true;
            GridView1.EditIndex = (int)EditIndex;
            GridView1.DataBind();
        }
     }
   } 
} 
```

希望在史蒂夫和我自己之间，我们可以帮助你们中的一些人

# datagridview - c#.net 中的数据网格

> ID：438119
> 
> 赞同：0
> 
> 时间：2009-01-13T06:26:39.790
> 
> 标签：datagridview

如何从 datagrid 中删除数据、编辑、选择、更新 datagrid 中的数据并请求消息来执行此操作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T06:31:30.310

看到[这个](http://en.csharp-online.net/Working_with_Data%E2%80%94Using_the_DataGridView)和[这个](http://msdn.microsoft.com/en-us/library/system.windows.forms.datagridview.aspx)。

# perl - 如何通过 FTP 下载名称中包含当前日期的所有文件？

> ID：438122
> 
> 赞同：1
> 
> 时间：2009-01-13T06:29:34.573
> 
> 标签：perl, ftp

我有一个类似于“IDY03101.200901110500.axf”的文件格式。我有大约 25 个类似的文件驻留在 ftp 存储库中，并且只想下载当前日期的所有这些类似文件。我使用了以下代码，该代码不起作用，并且认为正则表达式不正确。

```
我的@ymb_date = "IDY.*\.$year$mon$mday????\.axf";

foreach 我的 $file (@ymb_date)
{

 print STDOUT "获取文件：$file\n";

 $ftp->get($file) 或警告 $ftp->message;

}

```

任何帮助表示赞赏。

编辑：

我需要所有当前日期文件。using`ls -lt | grep "Jan 13"`在 UNIX 框中有效，但在脚本中无效 在这种情况下，什么可能是有效的正则表达式？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T06:35:15.203

看起来您没有使用任何正则表达式。您正在尝试使用文字模式作为要下载的文件名。

也许您想使用[Net::FTP](http://search.cpan.org/dist/libnet)`ls`的方法来获取文件列表然后过滤它们。

```
foreach my $file ( $ftp->ls ) {
    next unless $file =~ m/$regex/;
    $ftp->get($file);
    } 
```

您可能还喜欢关于在 Perlmonks 上`mget`实现[“Net::FTP”的答案。](http://www.perlmonks.org/?node_id=32298)

另外，我认为您想要在日期之后找到四位数字的正则表达式。在 Perl 中，您可以将其写为`\d{4}`. The`?`是 Perl 中的量词，因此其中四个连续不起作用。

```
IDY.*\.$year$mon$mday\d{4}\.axf 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T06:34:54.047

我不认为正则表达式那样工作。虽然我已经有一段时间没有做 Perl 了，所以我可能会离开那里。:)

您的`$ftp`对象是否有权访问`mget()`方法？如果是这样，也许试试这个？

```
$ftp->mget("IDY*.$year$mon$mday*.axf") or warn $ftp->message; 
```

# javascript - jQuery偏移不会产生价值

> ID：438136
> 
> 赞同：0
> 
> 时间：2009-01-13T06:36:12.877
> 
> 标签：javascript, jquery, css

在发布整个代码之前，我想确保这里没有遗漏一个简单的问题。

```
var dv = $(myElement);

var pos = dv.offset();
var width = dv.width();
var height = dv.height();

alert(pos);
alert(width);
alert(height); 
```

在这里，宽度警报很好，高度警报很好，但偏移警报 [object Object]（在 Firefox 中）

我在这里错过了什么吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T06:39:07.377

这是正确的：该`offset()`函数返回一个包含两个属性的对象，`left`并且`top`. （请参阅[文档](http://docs.jquery.com/CSS/offset)）。“[object Object]”是大多数对象转换为字符串的方式。

我建议您安装 Firebug 来帮助您调试这样的 Javascript，因为它可以为您提供有关变量的更好信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-07T14:44:41.430

请同时使用 console.log() 而不是 alert() 进行测试

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T06:45:32.950

:SI 确实为消耗本网站的宝贵资源而道歉，提出这样一个需要客户端和服务器端验证、必须访问数据库并消耗互联网带宽的问题！！！！那是我对自己的愤怒！我想我现在应该睡一觉了……谢谢大家……

# c# - 如何递归浏览 IIS 的所有内容？

> ID：438142
> 
> 赞同：1
> 
> 时间：2009-01-13T06:39:51.760
> 
> 标签：c#, security, iis-7, active-directory, iis-6

我有以下程序来浏览所有虚拟目录及其子目录和文件（递归）：

```
static void Main(string[] args)
        {
            string serverName = Environment.MachineName;
            DirectoryEntry dir = new DirectoryEntry("IIS://" + serverName + "/W3SVC/1/ROOT", @"adminusername", @"password");
            dir.AuthenticationType = AuthenticationTypes.Secure;          
            PrintChildren(dir, 0);
        }

        private static void PrintChildren(DirectoryEntry entry,int level)
        {
            foreach (DirectoryEntry child in entry.Children)
            {
                Console.WriteLine("");
                Console.WriteLine("|");
                for (int i = 0; i < level; i++)
                {
                    Console.Write("----");
                }
                Console.Write(child.Name);

                if (child.Children != null)
                {
                    PrintChildren(child,level + 1);
                }
            }
        } 
```

现在这个程序确实列出了所有的虚拟目录，但只有在少数情况下它会列出虚拟目录的子目录（我观察到的这些目录在 IIS 中启用了匿名访问）。

如何确保该程序能够浏览 IIS 的所有内容？是否可以提供/设置任何其他安全设置？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-07T01:49:34.177

我想你需要给调用者正确的`DirectoryServicesPermission`
来自 MSDN：[System.DirectoryServices 的代码访问安全](http://msdn.microsoft.com/en-us/library/ms256748%28VS.80%29.aspx)

# java - Hibernate hbm2ddl.auto 配置的可能值是什么，它们的作用是什么

> ID：438146
> 
> 赞同：1193
> 
> 时间：2009-01-13T06:40:48.950
> 
> 标签：java, hibernate, hbm2ddl

我真的很想知道更多关于更新、导出和可以给我的值`hibernate.hbm2ddl.auto`
我需要知道什么时候使用更新，什么时候不使用？什么是替代方案？

这些是可能在 DB 上发生的变化：

*   新表
*   旧表中的新列
*   已删除的列
*   列的数据类型已更改
*   一种类型的列改变了它的属性
*   表被丢弃
*   列的值已更改

在每种情况下，最好的解决方案是什么？

* * *

## 回答 #1

> 赞同：1172
> 
> 时间：2009-11-06T19:25:02.580

从[社区文档](https://docs.jboss.org/hibernate/orm/5.2/userguide/html_single/Hibernate_User_Guide.html#configurations-hbmddl)：

> hibernate.hbm2ddl.auto 在创建 SessionFactory 时自动验证模式 DDL 或将其导出到数据库。使用 create-drop，当 SessionFactory 显式关闭时，数据库模式将被删除。
> 
> 例如验证 | 更新 | 创建 | 创建删除

所以可能的选项列表是，

*   *validate*：验证架构，不对数据库进行任何更改。
*   *更新*：更新架构。
*   *create*：创建模式，销毁以前的数据。
*   *create-drop*：当 SessionFactory 显式关闭时删除模式，通常是在应用程序停止时。
*   *none*：对模式不做任何事情，不对数据库做任何更改

这些选项似乎旨在成为开发人员工具，而不是促进任何生产级数据库，您可能想看看以下问题；[休眠：hbm2ddl.auto=生产中的更新？](https://stackoverflow.com/questions/221379/hibernate-hbm2ddl-autoupdate-in-production)

* * *

## 回答 #2

> 赞同：203
> 
> 时间：2012-06-08T14:52:14.643

还有“无”的未记录值可以完全禁用它。

* * *

## 回答 #3

> 赞同：168
> 
> 时间：2009-01-13T08:11:45.960

配置属性被称为`hibernate.hbm2ddl.auto`

在我们的开发环境中，我们设置`hibernate.hbm2ddl.auto=create-drop`为在每次部署时删除并创建一个干净的数据库，以便我们的数据库处于已知状态。

理论上，您可以设置`hibernate.hbm2ddl.auto=update`通过更改模型来更新数据库，但我不相信在生产数据库上这样做。文档的早期版本说这是实验性的，至少；我不知道目前的状态。

因此，对于我们的生产数据库，不要设置`hibernate.hbm2ddl.auto`——默认是不做数据库更改。相反，我们手动创建一个 SQL DDL 更新脚本，将更改从一个版本应用到下一个版本。

* * *

## 回答 #4

> 赞同：89
> 
> 时间：2014-05-15T12:46:12.950

`hbm2ddl`首先，配置属性的可能值如下：

*   `none`- 不执行任何操作。不会生成架构。
*   `create-only`- 将生成数据库模式。
*   `drop`- 数据库模式将被删除。
*   `create`- 数据库模式将被删除并在之后创建。
*   `create-drop`- 数据库模式将被删除并在之后创建。关闭 后`SessionFactory`，将删除数据库模式。
*   `validate`- 将使用实体映射验证数据库架构。
*   `update`- 将通过将现有数据库模式与实体映射进行比较来更新数据库模式。

如果您计划添加功能或执行一些自定义脚本，这`hibernate.hbm2ddl.auto="update"`很方便但不太灵活。

因此，*最灵活的方法*是使用[Flyway](https://flywaydb.org/)。

但是，即使您使用 Flyway，您仍然可以使用 hbm2ddl 生成初始迁移脚本。

* * *

## 回答 #5

> 赞同：51
> 
> 时间：2009-03-23T07:40:34.510

我会使用[liquibase](http://www.liquibase.org "液基")来更新您的数据库。hibernate 的模式更新功能实际上只适用于开发新功能的开发人员。在生产情况下，需要更加小心地处理数据库升级。

* * *

## 回答 #6

> 赞同：51
> 
> 时间：2016-08-07T14:11:51.907

虽然这是一篇相当老的帖子，但由于我对该主题进行了一些研究，所以想分享它。

***休眠.hbm2ddl.auto***

根据文档，它可以有四个有效值：

***创建 | 更新 | 验证 | 创建删除***

以下是对这些值显示的行为的解释：

*   *create* :- 创建模式，模式中先前存在的数据（如果存在）将丢失
*   更新：- 使用给定值更新架构。
*   验证：- 验证架构。它在数据库中没有任何变化。
*   create-drop:- 创建模式并销毁先前存在的数据（如果存在）。当 SessionFactory 关闭时，它也会删除数据库模式。

以下是值得注意的要点：

*   在***更新***的情况下，如果数据库中不存在架构，则创建架构。
*   在***validate***的情况下，如果数据库中不存在模式，则不会创建它。相反，它会抛出一个错误：-`Table not found:<table name>`
*   在***create-drop***的情况下，关闭会话时不会删除模式。它仅在关闭 SessionFactory 时下降。
*   如果我给这个属性赋予任何值（比如 abc，而不是上面讨论的上述四个值），或者它只是留空。它显示以下行为：

    - 如果数据库中不存在模式：- 它创建模式

    - 如果数据库中存在架构：-***更新***架构。

* * *

## 回答 #7

> 赞同：27
> 
> 时间：2017-05-11T17:26:30.310

`hibernate.hbm2ddl.auto`创建 sessionFactory 时自动验证 DDL 并将其导出到模式。

默认情况下，它不会在 DB 上自动执行任何创建或修改。如果用户设置了以下值之一，那么它会自动进行 DDL 模式更改。

*   create - 创建模式

    ```
    <entry key="hibernate.hbm2ddl.auto" value="create"> 
    ```

*   update - 更新现有模式

    ```
    <entry key="hibernate.hbm2ddl.auto" value="update"> 
    ```

*   validate - 验证现有模式

    ```
    <entry key="hibernate.hbm2ddl.auto" value="validate"> 
    ```

*   create-drop - 在会话开始和结束时自动创建和删除模式

    ```
    <entry key="hibernate.hbm2ddl.auto" value="create-drop"> 
    ```

* * *

## 回答 #8

> 赞同：18
> 
> 时间：2015-02-10T09:56:35.783

如果您不想在应用程序中使用字符串并且正在寻找预定义的常量，请查看`org.hibernate.cfg.AvailableSettings`Hibernate JAR 中包含的类，您将在其中找到所有可能设置的常量。以您为例：

```
/**
 * Auto export/update schema using hbm2ddl tool. Valid values are <tt>update</tt>,
 * <tt>create</tt>, <tt>create-drop</tt> and <tt>validate</tt>.
 */
String HBM2DDL_AUTO = "hibernate.hbm2ddl.auto"; 
```

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2017-03-03T10:51:38.053

*   `validate`: 验证模式，数据库没有变化。
*   `update`：使用当前执行查询更新架构。
*   `create`：每次都创建新的模式，并销毁以前的数据。
*   `create-drop`: 当应用程序停止或 SessionFactory 显式关闭时删除模式。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2012-06-21T02:12:24.163

我认为你应该专注于

```
SchemaExport Class 
```

该类使您的配置动态化因此它允许您选择最适合的套件...

结帐[[SchemaExport]](http://docs.jboss.org/hibernate/orm/3.5/api/org/hibernate/tool/hbm2ddl/SchemaExport.html)

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2017-10-15T14:44:57.730

`validate`：它验证架构并且不对数据库进行任何更改。
假设您在映射文件中添加了一个新列并执行了插入操作，它将抛出一个异常“缺少 XYZ 列”，因为现有架构与您要插入的对象不同。如果您通过手动添加新列来更改表，然后执行插入操作，那么它肯定会将所有列与新列一起插入到表中。意味着它不会对现有架构/表进行任何更改/更改。

`update`：当您执行操作时，它会更改数据库中的现有表。您可以使用 hbm2ddl 的此选项添加或删除列。但是，如果您要添加一个“NOT NULL”的新列，那么它将忽略将该特定列添加到数据库中。因为如果要向现有表添加“NOT NULL”列，表必须为空。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2016-08-11T10:45:10.257

**从 5.0**开始，您现在可以在专用的`Enum`:中找到这些值（自 5.2 起[`org.hibernate.boot.SchemaAutoTooling`](http://docs.jboss.org/hibernate/orm/5.0/javadocs/org/hibernate/boot/SchemaAutoTooling.html)使用值增强）。`NONE`

或者更好的是，**从 5.1 开始**，您还可以使用结合了 JPA 2 和“旧版”Hibernate DDL 操作的 。[`org.hibernate.tool.schema.Action`](http://docs.jboss.org/hibernate/orm/5.1/javadocs/org/hibernate/tool/schema/Action.html) `Enum`

**但是**，您还不能使用它以`DataSource`编程方式配置。结合使用它会更好，[`org.hibernate.cfg.AvailableSettings#HBM2DDL_AUTO`](http://docs.jboss.org/hibernate/orm/5.0/javadocs/org/hibernate/cfg/AvailableSettings.html#HBM2DDL_AUTO)但当前代码需要一个`String`值（摘自[`SessionFactoryBuilderImpl`](https://github.com/hibernate/hibernate-orm/blob/5.2.2/hibernate-core/src/main/java/org/hibernate/boot/internal/SessionFactoryBuilderImpl.java#L711)）：

```
this.schemaAutoTooling = SchemaAutoTooling.interpret( (String) configurationSettings.get( AvailableSettings.HBM2DDL_AUTO ) ); 
```

......以及`enum`两者的内部价值观[`org.hibernate.boot.SchemaAutoTooling`](https://github.com/hibernate/hibernate-orm/blob/5.2.2/hibernate-core/src/main/java/org/hibernate/boot/SchemaAutoTooling.java)并[`org.hibernate.tool.schema.Action`](https://github.com/hibernate/hibernate-orm/blob/5.2.2/hibernate-core/src/main/java/org/hibernate/tool/schema/Action.java)没有公开。

下面是一个示例编程`DataSource`配置（在我的 Spring Boot 应用程序中使用），它使用了一个策略，`.name().toLowerCase()`但它只适用于没有破折号的值（不是`create-drop`例如）：

```
@Bean(name = ENTITY_MANAGER_NAME)
public LocalContainerEntityManagerFactoryBean internalEntityManagerFactory(
        EntityManagerFactoryBuilder builder,
        @Qualifier(DATA_SOURCE_NAME) DataSource internalDataSource) {

    Map<String, Object> properties = new HashMap<>();
    properties.put(AvailableSettings.HBM2DDL_AUTO, SchemaAutoTooling.CREATE.name().toLowerCase());
    properties.put(AvailableSettings.DIALECT, H2Dialect.class.getName());

    return builder
            .dataSource(internalDataSource)
            .packages(JpaModelsScanEntry.class, Jsr310JpaConverters.class)
            .persistenceUnit(PERSISTENCE_UNIT_NAME)
            .properties(properties)
            .build();
} 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2020-05-22T19:10:25.920

对于搜索默认值的任何人...

它是在 Spring-boot 的 2.0.5 版本和 JpaProperties 的 1.1.0 版本的源代码中编写的：

```
 /**
     * DDL mode. This is actually a shortcut for the "hibernate.hbm2ddl.auto"
     * property. Defaults to "create-drop" when using an embedded database and no
     * schema manager was detected. Otherwise, defaults to "none".
     */
    private String ddlAuto; 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-09-16T06:54:16.680

综上所述......注意这个属性被调用`dll.auto`并且应该只控制dll操作（创建/删除模式/表），我惊讶地发现它也与dml有关：只`update`允许插入数据，这是dml操作.

尝试将数据填充到内存数据库中时被此抓住；只`update`工作。

# python - 需要帮助——Python 脚本中是否需要类？

> ID：438149
> 
> 赞同：0
> 
> 时间：2009-01-13T06:42:52.660
> 
> 标签：python, class, scripting

我正在为 Python 脚本创建一个接口。稍后我将 dong Python 脚本也用于自动化测试。是否有必要在我的代码中使用类。现在我已经创建了包含字典、列表、函数、全局和局部变量的代码。

有必要上课吗？

在这方面帮助我。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-13T06:58:47.213

不，当然上课不是*必须的*。由于 Python 是一种脚本语言，您可以简单地编写脚本，而无需定义自己的类。如果您实现需要结构化方法的更复杂的程序，并且 OOP 的好处（封装、多态性）可以帮助您执行此操作，则类很有用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T12:05:55.317

不，您不需要使用类来编写脚本。

但是，当您开始使用单元测试框架 unittest 时，这将涉及类，因此您至少需要了解如何对 TestCase 类进行子类化，例如：

```
import unittest
import os

class TestLint(unittest.TestCase):

    def testLintCreatesLog(self):
        # stuff that does things to create the file lint.log removed...
        assert os.path.exists('lint.log')  # this should be here after lint        
        assert os.path.getsize('lint.log') == 0 # nothing in the log - assume happy

if __name__ == '__main__':
    # When this module is executed from the command-line, run all its tests
    unittest.main() 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T07:46:57.507

不需要让它工作，但我认为如果你不将某些东西封装在类中，维护起来会变得混乱。类是应该帮助程序员组织他/她的代码的东西，而不仅仅是有毛茸茸的东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-02T18:39:29.683

没有必要，因为 python 不是纯粹的面向对象语言，但某些东西最好用类（封装）编写。使用类构建大型项目变得更容易

# c# - 我想在 C# 代码中找到所有不带括号的 if 语句。通过正则表达式

> ID：438150
> 
> 赞同：2
> 
> 时间：2009-01-13T06:43:01.270
> 
> 标签：c#, regex, code-analysis

我想找到所有不带大括号' '的`if`语句和语句。当您在语句中写一行时，您通常不会将其括在大括号中，所以我想找到所有这些和语句。`for``{``if``if``for`

请帮忙！

就像我想捕捉这个陈述

```
if (childNode.Name == "B")
    return TokenType.Bold; 
```

但不是这些

```
if (childNode.Name == "B")
{
    return TokenType.Bold;
} 
```

我想用正则表达式来做。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-13T06:48:42.180

由于基础数学不允许完美匹配，因此您可以使用一个很好的启发式方法，例如“查找所有 ' `if`' 后跟一个分号，而无需中间的大括号：

```
/\<if\>[^{]*;/ 
```

where`\<`和`\>`是适用于您的正则表达式方言的词首和词尾。还要注意忽略输入中的所有换行符，一些正则表达式处理器需要被告知这样做。

* * *

你可能也想看看[StyleCop](http://code.msdn.microsoft.com/sourceanalysis)。这是一个对您的源代码运行大量各种检查的工具。这张支票已经在那里了。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-13T07:23:43.683

如果您想要一个 100% 有效的解决方案，那么正则表达式将不符合要求。使用真实代码来绊倒正则表达式太容易了。以下面的正则表达式为例

```
"^\s*if\W[^{]*\n\s*[^{]" 
```

这将匹配大部分没有被大括号包围的“if”语句。然而，它很容易被打破。采取以下样本。正则表达式会错误地将这些标记为带有大括号的 if 语句。

**示例 1**

```
if ( SomeFunction(() => { return 42; }) ) 
```

**示例 2**

```
/* Big comment
   if ( true ) {
*/ 
```

名单还在继续。

底线，如果你想要完美，正则表达式将不起作用。如果您对不太完美的解决方案感到满意，那么上面的正则表达式应该可以解决问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-25T10:03:57.910

你可以用谷歌搜索有限状态机来找出为什么不能写出你要求的纯正则表达式。

另一方面，一些 reg-ex 解释器，比如 Perl 语言，可以引用以前匹配的表达式，这使得理论上实现整个 C# 语法成为可能。不过不要遵循这个想法；）大卫施密特的想法很好。

# java - JVM中的socket是如何实现的？

> ID：438154
> 
> 赞同：7
> 
> 时间：2009-01-13T06:47:14.787
> 
> 标签：java, sockets, network-programming, jvm

我想知道，如何在 Java 虚拟机中实现套接字。

*   是否包含本机库？
*   如果，它是一个 C 库吗？

我在哪里可以找到有关此主题的信息？关于网络的[官方 Java 教程对](http://java.sun.com/docs/books/tutorial/networking/TOC.html)我没有帮助。

一些有趣的链接会有所帮助。

更新：Sun 是否提供了任何官方信息？

提前致谢！

**编辑** 我找到了一个证明，我将我的答案标记为正确的。感谢奥斯卡，这对我来说是完美的暗示！！！谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T06:52:48.957

可能是使用了底层平台暴露的system-V socket调用，比如Unix下的system-V，Windows下的WinSock。该规范仅规定了虚拟机必须如何运行，因此实现者可以自由地为所欲为。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-13T06:54:44.850

Java 是开源的，因此您可以获取源代码以自定进度深入检查该类。

作为对您问题的开始和快速回答，这是我在快速扫描中发现的内容：

```
private native void socketConnect(InetAddress address, int port, int timeout) 
```

所以是的，包含了一个本地库，我猜它是一个 C++ 库。

有许多实现（SSLSocket、PlainSocket 等）

JDK7 的在线资源在[这里](http://docjar.com/html/api/java/net/Socket.java.html) :S[不知道它是最新的]

我使用我的 IDE 来浏览每个 JDK 安装附带的源代码。

[显示 Socket 来源的 IDE 截图 http://img83.imageshack.us/img83/5358/socketimpfv3.png](http://img83.imageshack.us/img83/5358/socketimpfv3.png)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-13T17:52:20.310

在[Java 1.4.2 的网络指南中](http://java.sun.com/j2se/1.4.2/docs/guide/net/socketOpt.html)，提供了一条有趣的信息：

> **实施细则...**
> 
> ...你不需要知道，除非你继承了 SocketImpl/DatagramSocketImpl。**每个 *Socket 对象都有一个底层的 SocketImpl/DatagramSocketImpl 来连接本地代码。**Impl 类实现了两种方法来支持选项：
> 
> void setOption(int optID, Object val) 抛出 SocketException；对象 getOption(int optID) 抛出 SocketException；
> 
> 看起来*很像 C*。这些方法充当本机方法的粘合剂，并在调用本机方法之前确保类型安全。

所以我认为它是经过验证的：Java 使用本地库作为套接字。

# database-design - 我应该在应用程序中反映数据库结构吗？

> ID：438166
> 
> 赞同：4
> 
> 时间：2009-01-13T06:56:57.607
> 
> 标签：database-design

我正在设计一个允许将一些数据放入数据库的应用程序。我想以某种方式反映应用程序中的数据库结构，例如，如果我有一个包含部门的表和一个包含员工的表，并且在我的应用程序将有一个类 Department，其属性 Id 设置为 3，并且它将引用两个 Employee 类，其 Id 设置为 44 和 123。

我和我的同事谈过了，他说我不应该在应用程序中反映数据库结构——应用程序应该对数据源一无所知。这听起来很聪明，但如果我的类中没有 Id 属性（它们肯定反映了数据库结构），我不可能知道哪个员工的属性已更改，我将无法将数据放回数据库中。我很困惑 - 我听说过将数据库结构反映为对象的框架（例如休眠），我不确定它是否如此糟糕。

你怎么看？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-13T07:08:52.170

好吧，我认为**ORM 框架**（如 Hibernate）的重点是*解耦*数据库结构和对象模型，而不是促进它们的相同性。

关于如何设计对象模型和数据库模式有不同的理念，这取决于您与谁交谈。许多**应用程序开发人员**将数据库视为一个基本的桶，并让应用程序的需求驱动数据库模式的设计。因此，例如，应用程序开发人员可能会很好地允许给定 ORM 框架的特性强加于 DB 模式设计，在 DB 开发人员不想这样做的情况下，他们可能会很好地对某些东西进行非规范化，等等。

另一方面，**数据库开发人员**通常认为数据库更基础，而且并非没有充分的理由：通常许多应用程序需要针对单个数据库工作，数据库通常比应用程序更耐用，数据比应用程序更有价值，东西像那样。因此，如果您的论点是“好吧，Hibernate 需要某某……”，他们会进行一场相当不错的斗争。

我认为两个阵营都会同意，尽管**没有必要——甚至不希望——争取类和表之间的 1-1 关系**。例如，在应用程序世界中运行良好的类之间的关系可能会变成在数据库世界中表现不佳的连接。例如，将类继承映射到 DB 模式有不同的方法，正确的选择取决于规范化和性能问题，而不是盲目地要求类/表映射为 1-1。您可能拥有没有自己独立生命周期的组件（例如，`Address`仅与某些`User`, 说), 很多时候人们只是将其映射到用户表中的列列表而不是使其本身成为一流的实体, 从而节省连接, 从而强调其非独立性质,等等

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T07:23:50.423

理想情况下，您的应用程序不需要知道对象是如何存储的（如果它们完全存储的话）。但大多数时候，您需要在会话之间持久化对象，并且需要某种对象持久性，可以手动或通过 OPF（Obj Persistence Framework）实现。
通常它将是一个关系数据库，您描述的对象关系可以通过一个简单的 Master Detail 案例来实现，其中 DeptId 是 Employee 表中的外键以将其连接到 Department 表，或者它可以是关系表 EmpDept持有所有相关的 EmpId 和 DeptId。
这个物理实现细节可以隐藏到业务逻辑中，但您仍然需要知道员工属于一个部门。
因此，您的同事并不正确，因为您需要知道某个员工拥有它所属的 Dept_Id。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T07:28:54.017

威利的回答非常好。就个人而言，我更喜欢将数据库用作位桶。我的提示是：如果你真的希望你的数据模型和你的对象模型相同（它们相同绝对没有错！）使用对象数据库。因为，在这种情况下，关系层不会给你买太多东西。

如果您选择 ActiveRecord 样式的对象数据库（如 SandstoneDB），您所做的是：您创建域对象而不考虑数据存储。当您的对象工作正常时，您向它发送“保存”消息，然后它将自己写入数据库。而已。没有配置！它会自动生成自己的 id，这样您就可以从数据库中快速检索它。

如果您采用经典方式并使用 RDBMS，您可以远离数据库设计，但为什么要这样做呢？你设计你的桌子不是为了好玩。一些工具会从表定义中自动生成对象：这很好。它们通常提供一个良好的开端。如果出现问题，您可以仅更改对象，或仅更改数据定义，或两者兼而有之。看看你的代码，看看什么更方便。

尼可

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T07:01:26.960

您正在寻找的是*[Object Relational Mapper](http://en.wikipedia.org/w/index.php?title=Object_relational_mapper)*。这是一个自动处理在数据库和对象之间推送数据的框架。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T07:04:46.967

应用程序应反映用户需求/用户故事。数据库应该是应用程序的逻辑数据存储。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-13T07:18:32.883

我知道我不需要准确地反映数据库结构（特别是如果它对应用程序没有帮助），但在我提供的示例中，我想不出其他方法可以让我确定哪个员工记录是在应用程序内部更改了哪些数据 W 需要在数据库中更改 - 对吗？
我的意思是 - 我的 Employee 类将具有它的 ID 属性并且这个 Id 是数据库中记录的 ID，这是一个坏主意吗？

# asp.net - 将 FreeText 与 SubSonic 一起使用

> ID：438172
> 
> 赞同：1
> 
> 时间：2009-01-13T06:59:04.763
> 
> 标签：asp.net, orm, subsonic

关于如何将 SQL 2005 的全文搜索与 SubSonic 一起使用，是否存在普遍共识？我知道我可以使用 InlineQuery 并获得 IDataReader，但这是唯一的方法吗？另外，我如何将分页合并到其中？我必须自己在 InlineQuery 中编写分页吗？

我真正想做的是这样的：

```
new Select().From<Item>().Where("FreeText(Title, @title)").ExecuteAsCollection<ItemCollection>(); 
```

这样，我可以使用内置的 Subsonic 分页功能，而不必用 SQL 编写整个查询

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T07:47:26.647

这是 SubSonic 的一种情况，我认为创建存储过程并根据结果构建集合更容易。存储过程中的分页并不难实现（捕获 SubSonic 生成的 sql 并重用它）。

您可以通过将 SPs.SPNameHere.GetReader() 传递给 ItemCollection.Load() 方法从存储过程构建类型化集合。确保存储过程返回 SELECT * FROM Item 将返回的内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T06:57:46.607

这不适用于现在的 SubSonic。不久前我做了一个补丁，可以做这样的事情，但它从来没有进入。我想知道它是否应该是他们的，你觉得呢？

# c# - 从中继器导出到 Excel？

> ID：438184
> 
> 赞同：6
> 
> 时间：2009-01-13T07:10:17.893
> 
> 标签：c#, asp.net, excel, repeater

现在我正在使用它来导出一个中继器（具有多个嵌套中继器）到 excel：

```
protected void ExportToExcel(object sender, EventArgs e) 
{     
Response.Clear();
Response.Buffer = true;
Response.AddHeader("content-disposition", "attachment;filename=finance.xls");
Response.Charset = ""; 
Response.ContentType = "application/vnd.ms-excel"; 
System.IO.StringWriter stringWrite = new System.IO.StringWriter(); 
System.Web.UI.HtmlTextWriter htmlWrite = new HtmlTextWriter(stringWrite); 
rptMinistry.RenderControl(htmlWrite); 
Response.Write(stringWrite.ToString()); 
Response.End(); 
} 
```

但这不是我想要的。相反，它在 excel 文件中给了我 html（尽管数据在那里），这就是我得到的（每行都是 excel 表中的一个单元格）：

```
<tr class="alt">
 <td class='hidden'>LOR In Development</td>
 <td>MOD</td>
 <td>Air Force</td>
 <td class="size1"></td>
 <td>Hellfire (AGM-114) Follow On</td>
 <td>10-Mar-08</td>
 <td class="align_right ">$50,000,000.00</td>
 <td class="align_right hidden">$0.00</td>
</tr>

<tr class="alt">
 <td class='hidden'>LOR In Development</td>
 <td>MOD</td>
 <td>Air Force</td>
 <td class="size1"></td>
 <td>Precision Strike Mi-17 (block 20)</td>
 <td>17-May-08</td>
 <td class="align_right ">$20,100,000.00</td>
 <td class="align_right hidden">$0.00</td>
</tr> 
```

等等......现在数据是正确的，但我怎样才能让它在电子表格中正确显示？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-13T07:37:36.747

您需要将所有这些都包含在表格标签中。Excel 可以理解 HTML 表格结构。

尝试：

```
Response.Write("<table>");
Response.Write(stringWrite.ToString()); 
Response.Write("</table>"); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T08:18:09.957

不是直接回答你的问题，而是给你我的意见

对于那种数据，我认为您应该使用 GridView 控件，以您的示例为例，您需要编写如下内容：

```
<asp:Repeater ID="rpt" runat="server" DataSourceID="ods">
    <HeaderTemplate>
        <table>
        <tr>
            <td>Header</td>
            <td>Type</td>
            <td>Name</td>
            <td>Date</td>
            <td>Amount</td>
        </tr>
    </HeaderTemplate>
    <ItemTemplate>
        <tr>
            <td>
                <%#Eval("Header")%>
            </td>
            <td>
                <%#Eval("Type")%>
            </td>
            <td>
                <%#Eval("Name")%>
            </td>
            <td>
                <%#Eval("Date", "{0:d}")%>
            </td>
            <td>
                <%#Eval("Value", "{0:c}")%>
            </td>
        </tr>
    </ItemTemplate>
    <FooterTemplate>
        </table>
    </FooterTemplate>
</asp:Repeater> 
```

使用 GridView 只需在 HTML 部分中编写：

```
<asp:GridView ID="gv" runat="server" DataSourceID="ods" AutoGenerateColumns="false">
    <Columns>
        <asp:BoundField DataField="Header" HeaderText="Header" />
        <asp:BoundField DataField="Type" HeaderText="Type" />
        <asp:BoundField DataField="Name" HeaderText="Name" />
        <asp:BoundField DataField="Date" DataFormatString="{0:d}" HeaderText="Date" />
        <asp:BoundField DataField="Value" DataFormatString="{0:c}" HeaderText="Value" />
    </Columns>
</asp:GridView> 
```

更简单、更容易阅读的东西

使用 GridView 对象而不是 Repeater，您将拥有更多控制权，而且，您永远不会遇到这种问题，因为呈现 gridView 总是伴随着表格标签。

希望能帮助到你

顺便说一句，我测试了你的案例，即使我没有写斯宾塞提到的标签，我也没有遇到任何问题。

查看我的代码：[带有 HTML 和方法](http://rafb.net/p/CzBIX887.html)的文件-[带有 myObject 的文件](http://pastebin.com/m3da6bebd)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T07:40:21.873

您应该使用 html 和 body 标记使输出文件成为正确的 html 文件。那应该会更好。

# python - Python 数据结构：SQL、XML 或 .py 文件

> ID：438185
> 
> 赞同：5
> 
> 时间：2009-01-13T07:10:34.413
> 
> 标签：python, sql, xml, data-structures, graph

给定一个（或两个）用于无向图搜索的 500,000 个项目+字典，在 python 中存储大量数据的最佳方法是什么？

我一直在考虑一些选项，例如将数据存储为 XML：

```
<key name="a">
    <value data="1" />
    <value data="2" />
</key>
<key name="b">
... 
```

或在 python 文件中直接访问：

```
db = {"a": [1, 2], "b": ...} 
```

还是在 SQL 数据库中？我认为这将是最好的解决方案，但是我是否必须更多地依赖 SQL 来进行计算而不是 python 本身？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-13T11:37:45.170

Python 源代码技术绝对规则。

XML 解析很慢，并且相对难以被人们阅读。这就是像 Altova 这样的公司开展业务的原因—— XML 编辑起来并不愉快。

Python源`db = {"a": [1, 2], "b": ...}`是

1.  快速解析。

2.  便于人们阅读。

如果您有读取和写入巨型字典的程序，请使用`pprint`用于写入的程序，以便获得格式良好的输出。更容易阅读的东西。

如果您担心可移植性，请考虑使用 YAML（或 JSON）来序列化对象。它们解析速度也很快，而且比 XML 更容易阅读。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T07:36:51.177

我会考虑使用可用于 python 的众多图形库之一（例如[python-graph](http://code.google.com/p/python-graph/)）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T07:41:14.990

您需要更好地说明您的问题。我会做一些假设：1）你的数据是静态的，你只想搜索它，2）你有足够的内存来存储它。

如果应用程序启动速度不重要，数据格式由你决定，只要你能把它放入 Python 内存即可。如果您想快速访问数据，请使用简单的数据类型（字典、列表、字符串）来存储数据，而不是 XML 图。您可能会考虑编写自己的轻量级类来表达节点并将链接存储到字典或数组中的其他节点。

如果应用程序的启动时间很关键，请考虑将数据加载到 Python 程序中并将其提取到文件中；然后，您可以在生产应用程序中加载腌制数据结构（应该非常快）。

另一方面，如果您的数据太大而无法放入内存，或者您希望能够持久修改它，您可以使用 SQL 进行存储（外部服务器或 SQLite 数据库）或 ZODB（Python 对象数据库）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T07:41:16.457

如果您将数据存储在 XML 文件中，修改将更容易（即使用记事本...），但您必须考虑到从 XML 文件中读取和解析所有数据量是一项繁重的工作。使用 SQL 数据库（可能是 PostGres）将使选择的性能更高一些，DMBS 比直接文件系统读取/解析更优化。如果您将所有数据存储在一个单独的文件中的某个 Python 结构中，那么您可以拥有字节码编译 (.pyc) 的优势，它不会提高计算热量但允许更快的加载（这就是您想要的）。我会选择最后一个。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T07:47:53.213

XML 确实面向树结构，而且非常冗长。您可以查看 RDF 以了解用 XML 描述图形的方法，但它仍有其他缺点，例如读取、解析和实例化 500k+ 对象的时间以及使用的文件空间量。

SQL 真正面向描述表中的行。您当然可以存储图表，但您也会在这里看到性能损失。

我会先尝试 python pickling 看看它是否满足您的需求。它可能是读取和实例化所有对象的最紧凑和最快的。

真正使用其他格式的唯一原因是如果您需要它们提供的东西，例如 SQL 中的事务或 XML 的跨语言处理。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-13T07:48:24.307

如果您有办法维护文件，python 文件方法肯定是最快的。

# c# - 使用 LINQ 将集合拆分为“n”部分？

> ID：438188
> 
> 赞同：123
> 
> 时间：2009-01-13T07:14:34.560
> 
> 标签：c#, .net, linq, data-structures

`n`有没有一种用 LINQ将集合拆分成多个部分的好方法？当然不一定均匀。

也就是说，我想将集合划分为子集合，每个子集合都包含一个元素子集，其中最后一个集合可以是衣衫褴褛的。

* * *

## 回答 #1

> 赞同：130
> 
> 时间：2009-01-13T10:12:36.743

一个纯 linq 和最简单的解决方案如下所示。

```
static class LinqExtensions
{
    public static IEnumerable<IEnumerable<T>> Split<T>(this IEnumerable<T> list, int parts)
    {
        int i = 0;
        var splits = from item in list
                     group item by i++ % parts into part
                     select part.AsEnumerable();
        return splits;
    }
} 
```

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2009-01-13T07:25:16.240

编辑：好的，看起来我误读了这个问题。我把它读作“长度为 n 的片段”而不是“n 片段”。嗬！考虑删除答案...

（原答案）

我不相信有一种内置的分区方式，尽管我打算在我对 LINQ to Objects 的一组添加中编写一个。Marc Gravell 在[这里有一个实现，](https://stackoverflow.com/questions/410717/f-seq-module-implemented-in-c-for-ienumerable#410759)尽管我可能会修改它以返回只读视图：

```
public static IEnumerable<IEnumerable<T>> Partition<T>
    (this IEnumerable<T> source, int size)
{
    T[] array = null;
    int count = 0;
    foreach (T item in source)
    {
        if (array == null)
        {
            array = new T[size];
        }
        array[count] = item;
        count++;
        if (count == size)
        {
            yield return new ReadOnlyCollection<T>(array);
            array = null;
            count = 0;
        }
    }
    if (array != null)
    {             
        Array.Resize(ref array, count);
        yield return new ReadOnlyCollection<T>(array);
    }
} 
```

* * *

## 回答 #3

> 赞同：46
> 
> 时间：2011-03-14T20:23:03.880

```
static class LinqExtensions
{
    public static IEnumerable<IEnumerable<T>> Split<T>(this IEnumerable<T> list, int parts)
    {
            return list.Select((item, index) => new {index, item})
                       .GroupBy(x => x.index % parts)
                       .Select(x => x.Select(y => y.item));
    }
} 
```

* * *

## 回答 #4

> 赞同：28
> 
> 时间：2010-08-01T16:29:11.403

好的，我会把我的帽子扔进擂台。我的算法的优点：

1.  没有昂贵的乘法、除法或模数运算符
2.  所有操作都是 O(1)（见下面的注释）
3.  适用于 IEnumerable<> 源（不需要 Count 属性）
4.  简单的

编码：

```
public static IEnumerable<IEnumerable<T>>
  Section<T>(this IEnumerable<T> source, int length)
{
  if (length <= 0)
    throw new ArgumentOutOfRangeException("length");

  var section = new List<T>(length);

  foreach (var item in source)
  {
    section.Add(item);

    if (section.Count == length)
    {
      yield return section.AsReadOnly();
      section = new List<T>(length);
    }
  }

  if (section.Count > 0)
    yield return section.AsReadOnly();
} 
```

正如下面的评论所指出的，这种方法实际上并没有解决最初的问题，即要求固定数量的大致相等长度的部分。也就是说，您仍然可以使用我的方法通过以下方式调用它来解决原始问题：

```
myEnum.Section(myEnum.Count() / number_of_sections + 1) 
```

当以这种方式使用时，该方法不再是 O(1)，因为 Count() 操作是 O(N)。

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2012-12-06T13:11:22.977

这与公认的答案相同，但表示形式要简单得多：

```
public static IEnumerable<IEnumerable<T>> Split<T>(this IEnumerable<T> items, 
                                                   int numOfParts)
{
    int i = 0;
    return items.GroupBy(x => i++ % numOfParts);
} 
```

上述方法将一个`IEnumerable<T>`分成N个大小相等或接近相等的块。

```
public static IEnumerable<IEnumerable<T>> Partition<T>(this IEnumerable<T> items, 
                                                       int partitionSize)
{
    int i = 0;
    return items.GroupBy(x => i++ / partitionSize).ToArray();
} 
```

上述方法将一个分割`IEnumerable<T>`成所需的固定大小的块，块的总数并不重要——这不是问题所在。

该`Split`方法的问题除了速度较慢之外，还在于它扰乱了输出，因为分组将基于每个位置的 N 的第 i 个倍数来完成，或者换句话说，你没有得到块按照原来的顺序。

几乎这里的每个答案要么不保持顺序，要么是关于分区而不是分裂，或者是明显错误的。试试这个更快，保留顺序但更冗长：

```
public static IEnumerable<IEnumerable<T>> Split<T>(this ICollection<T> items, 
                                                   int numberOfChunks)
{
    if (numberOfChunks <= 0 || numberOfChunks > items.Count)
        throw new ArgumentOutOfRangeException("numberOfChunks");

    int sizePerPacket = items.Count / numberOfChunks;
    int extra = items.Count % numberOfChunks;

    for (int i = 0; i < numberOfChunks - extra; i++)
        yield return items.Skip(i * sizePerPacket).Take(sizePerPacket);

    int alreadyReturnedCount = (numberOfChunks - extra) * sizePerPacket;
    int toReturnCount = extra == 0 ? 0 : (items.Count - numberOfChunks) / extra + 1;
    for (int i = 0; i < extra; i++)
        yield return items.Skip(alreadyReturnedCount + i * toReturnCount).Take(toReturnCount);
} 
```

[此处](https://stackoverflow.com/a/13745058/661933)`Partition`操作的等效方法

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2010-02-17T13:24:36.663

我一直在使用我之前经常发布的分区功能。唯一不好的是它没有完全流式传输。如果您使用序列中的少量元素，这不是问题。当我开始使用序列中的 100.000 多个元素时，我需要一个新的解决方案。

以下解决方案要复杂得多（并且代码更多！），但它非常有效。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Collections;

namespace LuvDaSun.Linq
{
    public static class EnumerableExtensions
    {
        public static IEnumerable<IEnumerable<T>> Partition<T>(this IEnumerable<T> enumerable, int partitionSize)
        {
            /*
            return enumerable
                .Select((item, index) => new { Item = item, Index = index, })
                .GroupBy(item => item.Index / partitionSize)
                .Select(group => group.Select(item => item.Item)                )
                ;
            */

            return new PartitioningEnumerable<T>(enumerable, partitionSize);
        }

    }

    class PartitioningEnumerable<T> : IEnumerable<IEnumerable<T>>
    {
        IEnumerable<T> _enumerable;
        int _partitionSize;
        public PartitioningEnumerable(IEnumerable<T> enumerable, int partitionSize)
        {
            _enumerable = enumerable;
            _partitionSize = partitionSize;
        }

        public IEnumerator<IEnumerable<T>> GetEnumerator()
        {
            return new PartitioningEnumerator<T>(_enumerable.GetEnumerator(), _partitionSize);
        }

        IEnumerator IEnumerable.GetEnumerator()
        {
            return GetEnumerator();
        }
    }

    class PartitioningEnumerator<T> : IEnumerator<IEnumerable<T>>
    {
        IEnumerator<T> _enumerator;
        int _partitionSize;
        public PartitioningEnumerator(IEnumerator<T> enumerator, int partitionSize)
        {
            _enumerator = enumerator;
            _partitionSize = partitionSize;
        }

        public void Dispose()
        {
            _enumerator.Dispose();
        }

        IEnumerable<T> _current;
        public IEnumerable<T> Current
        {
            get { return _current; }
        }
        object IEnumerator.Current
        {
            get { return _current; }
        }

        public void Reset()
        {
            _current = null;
            _enumerator.Reset();
        }

        public bool MoveNext()
        {
            bool result;

            if (_enumerator.MoveNext())
            {
                _current = new PartitionEnumerable<T>(_enumerator, _partitionSize);
                result = true;
            }
            else
            {
                _current = null;
                result = false;
            }

            return result;
        }

    }

    class PartitionEnumerable<T> : IEnumerable<T>
    {
        IEnumerator<T> _enumerator;
        int _partitionSize;
        public PartitionEnumerable(IEnumerator<T> enumerator, int partitionSize)
        {
            _enumerator = enumerator;
            _partitionSize = partitionSize;
        }

        public IEnumerator<T> GetEnumerator()
        {
            return new PartitionEnumerator<T>(_enumerator, _partitionSize);
        }

        IEnumerator IEnumerable.GetEnumerator()
        {
            return GetEnumerator();
        }
    }

    class PartitionEnumerator<T> : IEnumerator<T>
    {
        IEnumerator<T> _enumerator;
        int _partitionSize;
        int _count;
        public PartitionEnumerator(IEnumerator<T> enumerator, int partitionSize)
        {
            _enumerator = enumerator;
            _partitionSize = partitionSize;
        }

        public void Dispose()
        {
        }

        public T Current
        {
            get { return _enumerator.Current; }
        }
        object IEnumerator.Current
        {
            get { return _enumerator.Current; }
        }
        public void Reset()
        {
            if (_count > 0) throw new InvalidOperationException();
        }

        public bool MoveNext()
        {
            bool result;

            if (_count < _partitionSize)
            {
                if (_count > 0)
                {
                    result = _enumerator.MoveNext();
                }
                else
                {
                    result = true;
                }
                _count++;
            }
            else
            {
                result = false;
            }

            return result;
        }

    }
} 
```

享受！

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2011-01-29T06:37:21.593

有趣的线程。要获得拆分/分区的流版本，可以使用枚举器并使用扩展方法从枚举器中产生序列。使用 yield 将命令式代码转换为函数式代码确实是一项非常强大的技术。

首先是一个枚举器扩展，它将元素计数转换为惰性序列：

```
public static IEnumerable<T> TakeFromCurrent<T>(this IEnumerator<T> enumerator, int count)
{
    while (count > 0)
    {
        yield return enumerator.Current;
        if (--count > 0 && !enumerator.MoveNext()) yield break;
    }
} 
```

然后是对序列进行分区的可枚举扩展：

```
public static IEnumerable<IEnumerable<T>> Partition<T>(this IEnumerable<T> seq, int partitionSize)
{
    var enumerator = seq.GetEnumerator();

    while (enumerator.MoveNext())
    {
        yield return enumerator.TakeFromCurrent(partitionSize);
    }
} 
```

最终结果是一个高效、流式和惰性的实现，它依赖于非常简单的代码。

享受！

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-08-03T23:04:04.747

我用这个：

```
public static IEnumerable<IEnumerable<T>> Partition<T>(this IEnumerable<T> instance, int partitionSize)
{
    return instance
        .Select((value, index) => new { Index = index, Value = value })
        .GroupBy(i => i.Index / partitionSize)
        .Select(i => i.Select(i2 => i2.Value));
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-11-16T17:09:07.320

这是内存效率高并尽可能延迟执行（每批）并在线性时间 O(n) 内运行

```
 public static IEnumerable<IEnumerable<T>> InBatchesOf<T>(this IEnumerable<T> items, int batchSize)
    {
        List<T> batch = new List<T>(batchSize);
        foreach (var item in items)
        {
            batch.Add(item);

            if (batch.Count >= batchSize)
            {
                yield return batch;
                batch = new List<T>();
            }
        }

        if (batch.Count != 0)
        {
            //can't be batch size or would've yielded above
            batch.TrimExcess();
            yield return batch;
        }
    } 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2016-07-14T01:36:15.353

这个问题（及其表亲）有很多很好的答案。我自己需要这个，并创建了一个解决方案，该解决方案旨在在源集合可以被视为列表的情况下高效且容错。它不使用任何惰性迭代，因此它可能不适合可能施加内存压力的未知大小的集合。

```
static public IList<T[]> GetChunks<T>(this IEnumerable<T> source, int batchsize)
{
    IList<T[]> result = null;
    if (source != null && batchsize > 0)
    {
        var list = source as List<T> ?? source.ToList();
        if (list.Count > 0)
        {
            result = new List<T[]>();
            for (var index = 0; index < list.Count; index += batchsize)
            {
                var rangesize = Math.Min(batchsize, list.Count - index);
                result.Add(list.GetRange(index, rangesize).ToArray());
            }
        }
    }
    return result ?? Enumerable.Empty<T[]>().ToList();
}

static public void TestGetChunks()
{
    var ids = Enumerable.Range(1, 163).Select(i => i.ToString());
    foreach (var chunk in ids.GetChunks(20))
    {
        Console.WriteLine("[{0}]", String.Join(",", chunk));
    }
} 
```

我已经在使用 GetRange 和 Math.Min 的这一系列问题中看到了一些答案。但我相信总的来说这是一个在错误检查和效率方面更完整的解决方案。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2014-09-19T11:51:50.227

```
 protected List<List<int>> MySplit(int MaxNumber, int Divider)
        {
            List<List<int>> lst = new List<List<int>>();
            int ListCount = 0;
            int d = MaxNumber / Divider;
            lst.Add(new List<int>());
            for (int i = 1; i <= MaxNumber; i++)
            {
                lst[ListCount].Add(i);
                if (i != 0 && i % d == 0)
                {
                    ListCount++;
                    d += MaxNumber / Divider;
                    lst.Add(new List<int>());
                }
            }
            return lst;
        } 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2016-10-03T13:43:25.707

很好的答案，对于我的场景，我测试了接受的答案，似乎它没有保持秩序。Nawfal 也有很好的回答来维持秩序。但是在我的场景中，我想以标准化的方式拆分剩余部分，我看到的所有答案都会分散剩余部分或开头或结尾。

我的回答还以更规范的方式传播其余部分。

```
 static class Program
{          
    static void Main(string[] args)
    {
        var input = new List<String>();
        for (int k = 0; k < 18; ++k)
        {
            input.Add(k.ToString());
        }
        var result = splitListIntoSmallerLists(input, 15);            
        int i = 0;
        foreach(var resul in result){
            Console.WriteLine("------Segment:" + i.ToString() + "--------");
            foreach(var res in resul){
                Console.WriteLine(res);
            }
            i++;
        }
        Console.ReadLine();
    }

    private static List<List<T>> splitListIntoSmallerLists<T>(List<T> i_bigList,int i_numberOfSmallerLists)
    {
        if (i_numberOfSmallerLists <= 0)
            throw new ArgumentOutOfRangeException("Illegal value of numberOfSmallLists");

        int normalizedSpreadRemainderCounter = 0;
        int normalizedSpreadNumber = 0;
        //e.g 7 /5 > 0 ==> output size is 5 , 2 /5 < 0 ==> output is 2          
        int minimumNumberOfPartsInEachSmallerList = i_bigList.Count / i_numberOfSmallerLists;                        
        int remainder = i_bigList.Count % i_numberOfSmallerLists;
        int outputSize = minimumNumberOfPartsInEachSmallerList > 0 ? i_numberOfSmallerLists : remainder;
        //In case remainder > 0 we want to spread the remainder equally between the others         
        if (remainder > 0)
        {
            if (minimumNumberOfPartsInEachSmallerList > 0)
            {
                normalizedSpreadNumber = (int)Math.Floor((double)i_numberOfSmallerLists / remainder);    
            }
            else
            {
                normalizedSpreadNumber = 1;
            }   
        }
        List<List<T>> retVal = new List<List<T>>(outputSize);
        int inputIndex = 0;            
        for (int i = 0; i < outputSize; ++i)
        {
            retVal.Add(new List<T>());
            if (minimumNumberOfPartsInEachSmallerList > 0)
            {
                retVal[i].AddRange(i_bigList.GetRange(inputIndex, minimumNumberOfPartsInEachSmallerList));
                inputIndex += minimumNumberOfPartsInEachSmallerList;
            }
            //If we have remainder take one from it, if our counter is equal to normalizedSpreadNumber.
            if (remainder > 0)
            {
                if (normalizedSpreadRemainderCounter == normalizedSpreadNumber-1)
                {
                    retVal[i].Add(i_bigList[inputIndex]);
                    remainder--;
                    inputIndex++;
                    normalizedSpreadRemainderCounter=0;
                }
                else
                {
                    normalizedSpreadRemainderCounter++;
                }
            }
        }
        return retVal;
    }      

} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2021-08-31T19:16:37.823

从 .NET 6 开始，您可以使用[`Enumerable.Chunk<TSource>(IEnumerable<TSource>, Int32)`](https://docs.microsoft.com/en-us/dotnet/api/system.linq.enumerable.chunk).

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-13T10:07:07.490

如果这些部分的顺序不是很重要，你可以试试这个：

```
int[] array = new int[] { 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 };
int n = 3;

var result =
   array.Select((value, index) => new { Value = value, Index = index }).GroupBy(i => i.Index % n, i => i.Value);

// or
var result2 =
   from i in array.Select((value, index) => new { Value = value, Index = index })
   group i.Value by i.Index % n into g
   select g; 
```

但是，由于某种原因，这些不能转换为 IEnumerable<IEnumerable<int>> ...

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-03-17T18:09:34.703

这是我的代码，又好又短。

```
 <Extension()> Public Function Chunk(Of T)(ByVal this As IList(Of T), ByVal size As Integer) As List(Of List(Of T))
     Dim result As New List(Of List(Of T))
     For i = 0 To CInt(Math.Ceiling(this.Count / size)) - 1
         result.Add(New List(Of T)(this.GetRange(i * size, Math.Min(size, this.Count - (i * size)))))
     Next
     Return result
 End Function 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2014-02-28T07:02:48.203

这是我的方式，列出项目并逐列打破

```
 int repat_count=4;

  arrItems.ForEach((x, i) => {
    if (i % repat_count == 0) 
        row = tbo.NewElement(el_tr, cls_min_height);
    var td = row.NewElement(el_td);
    td.innerHTML = x.Name;
  }); 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2015-10-28T16:37:29.087

我正在寻找一个像字符串那样的拆分，所以整个列表根据一些规则进行拆分，不仅仅是第一部分，这是我的解决方案

```
List<int> sequence = new List<int>();
for (int i = 0; i < 2000; i++)
{
     sequence.Add(i);
}
int splitIndex = 900;
List<List<int>> splitted = new List<List<int>>();
while (sequence.Count != 0)
{
    splitted.Add(sequence.Take(splitIndex).ToList() );
    sequence.RemoveRange(0, Math.Min(splitIndex, sequence.Count));
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2016-06-08T14:44:44.247

这是对项目数量而不是零件数量的一些调整：

```
public static class MiscExctensions
{
    public static IEnumerable<IEnumerable<T>> Split<T>(this IEnumerable<T> list, int nbItems)
    {
        return (
            list
            .Select((o, n) => new { o, n })
            .GroupBy(g => (int)(g.n / nbItems))
            .Select(g => g.Select(x => x.o))
        );
    }
} 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2021-04-22T19:59:03.513

下面的代码既返回给定数量的块也返回排序数据

```
 static IEnumerable<IEnumerable<T>> SplitSequentially<T>(int chunkParts, List<T> inputList)
    {
        List<int> Splits = split(inputList.Count, chunkParts);

        var skipNumber = 0;
        List<List<T>> list = new List<List<T>>();
        foreach (var count in Splits)
        {
            var internalList = inputList.Skip(skipNumber).Take(count).ToList();
            list.Add(internalList);
            skipNumber += count;
        }
        return list;
    }
    static List<int> split(int x, int n)
    {
        List<int> list = new List<int>();

        if (x % n == 0)
        {
            for (int i = 0; i < n; i++)
                list.Add(x / n);
        }
        else
        {

            // upto n-(x % n) the values 
            // will be x / n 
            // after that the values 
            // will be x / n + 1 
            int zp = n - (x % n);
            int pp = x / n;
            for (int i = 0; i < n; i++)
            {

                if (i >= zp)
                    list.Add((pp + 1));
                else
                    list.Add(pp);
            }
        }
        return list;
    } 
```

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2009-03-17T18:04:57.693

```
int[] items = new int[] { 0,1,2,3,4,5,6,7,8,9, 10 };

int itemIndex = 0;
int groupSize = 2;
int nextGroup = groupSize;

var seqItems = from aItem in items
               group aItem by 
                            (itemIndex++ < nextGroup) 
                            ? 
                            nextGroup / groupSize
                            :
                            (nextGroup += groupSize) / groupSize
                            into itemGroup
               select itemGroup.AsEnumerable(); 
```

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2013-07-09T11:50:27.110

刚刚遇到这个线程，这里的大多数解决方案都涉及将项目添加到集合中，在返回之前有效地实现每个页面。这有两个原因 - 首先，如果您的页面很大，则填充页面会产生内存开销，其次，当您前进到下一个时，迭代器会使以前的记录无效（例如，如果您将 DataReader 包装在枚举器方法中） .

此解决方案使用两个嵌套枚举器方法来避免将项目缓存到临时集合中。由于外部迭代器和内部迭代器遍历相同的枚举，它们必然共享相同的枚举器，因此在处理完当前页面之前不要推进外部迭代器是很重要的。也就是说，如果您决定不一直遍历当前页面，当您移动到下一页时，此解决方案将自动向前迭代到页面边界。

```
using System.Collections.Generic;

public static class EnumerableExtensions
{
    /// <summary>
    /// Partitions an enumerable into individual pages of a specified size, still scanning the source enumerable just once
    /// </summary>
    /// <typeparam name="T">The element type</typeparam>
    /// <param name="enumerable">The source enumerable</param>
    /// <param name="pageSize">The number of elements to return in each page</param>
    /// <returns></returns>
    public static IEnumerable<IEnumerable<T>> Partition<T>(this IEnumerable<T> enumerable, int pageSize)
    {
        var enumerator = enumerable.GetEnumerator();

        while (enumerator.MoveNext())
        {
            var indexWithinPage = new IntByRef { Value = 0 };

            yield return SubPartition(enumerator, pageSize, indexWithinPage);

            // Continue iterating through any remaining items in the page, to align with the start of the next page
            for (; indexWithinPage.Value < pageSize; indexWithinPage.Value++)
            {
                if (!enumerator.MoveNext())
                {
                    yield break;
                }
            }
        }
    }

    private static IEnumerable<T> SubPartition<T>(IEnumerator<T> enumerator, int pageSize, IntByRef index)
    {
        for (; index.Value < pageSize; index.Value++)
        {
            yield return enumerator.Current;

            if (!enumerator.MoveNext())
            {
                yield break;
            }
        }
    }

    private class IntByRef
    {
        public int Value { get; set; }
    }
} 
```

# javascript - 如何为 Web 表单创建“检查所有”链接？

> ID：438189
> 
> 赞同：-1
> 
> 时间：2009-01-13T07:14:46.760
> 
> 标签：javascript

我有一个带有一堆复选框的表单，我想提供一个“检查所有”链接/按钮。

我正在使用下面的代码，但是当它运行时，它会选择页面上的一些单选按钮，并选中/取消选中这些单选按钮。我该如何解决？

```
var check = 0;
function doNow()
{
    void(d=document);
    void(el=d.getElementsByTagName('INPUT'));
    for(i=0;i<el.length;i++)
    {
        if(check == 0)
            void(el[i].checked=1)
        else
            void(el[i].checked=0) 
    }
    if(check == 0)
        check = 1;
    else 
       check = 0;
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-13T07:18:32.570

您将需要检查元素的类型，以确保不会意外检查错误类型的输入。

基本示例：

```
function checkAll( toggle ) {
    var inputs = document.getElementsByTagName( 'input' );
    for( var i = 0; i < inputs.length; i++ ) {
        if( inputs[i].type == 'checkbox' ) {
            inputs[i].checked = toggle;
        }
    }
} 
```

例如，您可能想要添加其他检查，例如仅对某个逻辑“组”中的复选框进行操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T07:21:00.227

您可以检查输入的类型：

```
if(el[i].type == 'checkbox') {
   el[i].checked = true;
} 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-01-13T08:28:23.053

您可以将当前状态存储为函数的属性以及检查类型

```
function checkAll() {
    var all = document.getElementsByTagName('input');
    for( var i = 0, l = all.length; i < l; i++ ) {
        if( all[i].type == 'checkbox' ) {
            all[i].checked = checkAll.checked;
        }
    }
    checkAll.checked = !checkAll.checked;
}
checkAll.checked = true; 
```

# c++ - 带有枚举的“使用”声明

> ID：438192
> 
> 赞同：10
> 
> 时间：2009-01-13T07:16:46.303
> 
> 标签：c++, enums, using-declaration

*using*声明似乎不适用于枚举类型：

```
class Sample{
    public:
        enum Colour {RED, BLUE, GREEN};
}

using Sample::Colour; 
```

不工作！

我们是否需要为每个枚举类型的枚举器添加一个*using声明？*如下所示：

```
using sample::Colour::RED; 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-13T07:27:07.327

一个类没有定义命名空间，因此“使用”在这里不适用。

此外，您需要公开枚举。

如果你想在同一个类中使用枚举，这里有一个例子：

```
class Sample {
 public:
  enum Colour { RED, BLUE, GREEN };

  void foo();
}

void Sample::foo() {
  Colour foo = RED;
} 
```

并从课堂外访问它：

```
void bar() {
  Sample::Colour colour = Sample::RED;
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-13T11:43:05.143

添加到[史蒂夫·莱西的回答](https://stackoverflow.com/questions/438192/using-declaration-with-enum#438210)中，原始代码的问题是您引用了一个成员，但*using*声明本身并不是成员声明：

7.3.3/6 有：

> 一个类成员的使用声明应该是一个成员声明。

为了强调这一点，以下示例确实有效：

```
class Sample
{
public:
  enum Colour { RED,BLUE,GREEN};
};

class Derived : public Sample
{
public:
  using Sample::Colour;  // OK
}; 
```

最后，正如[Igor Semenov 所指出的](https://stackoverflow.com/questions/438192/using-declaration-with-enum#438214)，即使将枚举定义移到命名空间中，从而允许*using*声明，*using*声明也只会将枚举类型的名称声明到命名空间中（2003 年标准参考是 7.3.3 /2)。

```
namespace Sample
{
  enum Colour { RED,BLUE,GREEN};
}

using Sample::Colour;
using Sample::BLUE;

void foo ()
{
  int j = BLUE; // OK
  int i = RED;  // ERROR
} 
```

**依赖基类型**

当编译器解析类模板时，允许部分和显式特化。它不会在相关基类中执行任何查找。因此，以下以 Sample 作为模板的变体无法编译：

```
template <typename T>
class Sample
{
public:
  enum Colour { RED,BLUE,GREEN};
};

template <typename T>
class Derived : public Sample<T>
{
public:
  using Sample<T>::Colour;  // What kind of entity is Colour?

  Colour foo ()     // Not OK!
  {
  return this->RED;
  }
}; 
```

问题是`Derived::Colour`编译器（14.6/2）将其视为对象：

> 在模板声明或定义中使用并且依赖于模板参数的名称被假定为不命名类型，除非适用的名称查找找到类型名称或该名称由关键字 typename 限定。

查看名称为类型的两个条件：

1.  查找`Colour`未找到类型，因为`Sample<T>`未搜索依赖基。
2.  名称不符合`typename`

因此，该示例需要`typename`关键字：

```
template <typename T>
class Derived : public Sample<T>
{
public:
  using typename Sample<T>::Colour;  // Colour is treated as a typedef-name

  Colour foo ()  // OK
  {
  return this->RED;
  }
}; 
```

**注意：** 标准的 1998 版本不允许`typename`与 using 声明一起使用，因此无法进行上述修复。请参阅*[从依赖基类](https://stackoverflow.com/q/1071119/11698)*和*[CWG11](http://www.open-std.org/jtc1/sc22/wg21/docs/cwg_defects.html#11)*访问类型。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-13T07:28:42.847

C++ 标准，7.3.3.1：

> 在 using-declaration 中指定的成员名称在 using-declaration 出现的声明区域中声明。[注：只有指定的名称是这样声明的；在 using-declaration 中指定枚举名称不会在 using-declaration 的声明区域中声明其枚举数。——尾注]

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2019-10-04T09:57:16.403

到目前为止，有一个相关的问题：[在 C++20 中使用枚举](https://stackoverflow.com/questions/57913492/use-using-enum-in-c20-in-classes-possible)。

看起来 C++20 可以选择进行`using enum`声明，从而最终允许直接访问枚举类的成员，如下所示（[source](http://eel.is/c++draft/enum.udecl)）：

```
enum class fruit {
    orange,
    apple,
};

struct S {
  using enum fruit;             // OK, introduces orange and apple into S
};
void f() {
  S s;
  s.orange;                     // OK, names fruit​::​orange
  S::orange;                    // OK, names fruit​::​orange
} 
```

当然，这意味着在内部`S`，您也可以简单地使用`orange`and`apple`代替`fruit::orange`and `fruit::apple`。

# c# - 当我拔下网线时，插座会发生什么？

> ID：438196
> 
> 赞同：7
> 
> 时间：2009-01-13T07:19:24.427
> 
> 标签：c#, .net, sockets

我有三个使用套接字相互通信的应用程序。他们都可以生活在自己的机器上，但也可以共享一台机器。现在我有两个在同一台机器上，第三个在自己的机器上。我正在尝试使我的通信防弹，因此我拔下电缆并终止应用程序以确保一切按预期工作。

这是这件事的一个快速草图：

[![替代文字](https://i.stack.imgur.com/4e0M5.png)](https://i.stack.imgur.com/4e0M5.png)

现在，当我拔下 PC2 的网线（红色连接“Con B”）时，内部连接停止通话（蓝色连接“Con A”）。我从永远不会到达“App 2”的套接字上的“App 1”发送东西。

我已经建立了一种机制，可以发现这一点并断开连接，然后重新连接，之后我可以随意拔下电缆，“Con A”继续工作。这只是第一次。

在断开“Con B”之前，我已经确认通过“Con A”进行了通信。
我以完全相同的方式连接和重新连接，它是相同的代码，所以没有区别。

发生了什么？

由答案触发的附加信息：PC 1 和 PC 2 共享地址直至最后一个字节。
我有一个内部保持活动机制，我发送一条消息并期望每 10 秒得到一个响应。
当我杀死 App 3 时，这不会发生，只有在拔掉电缆时才会发生。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T07:24:55.553

你用什么地址来“Con A”？如果您使用的是绑定到外部网络适配器的地址，即使您正在与同一台机器通信，那么您所描述的情况也可能会发生。

您可以做的是使用`localhost`“Con A”的地址（127.0.0.1），它应该完全独立于外部网络上发生的事情。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-13T07:27:48.153

在某些平台（Windows）上，拉动网络电缆会告诉网络堆栈主动使与接口关联的打开套接字连接无效。

在这种情况下，拉网线实际上是一个糟糕的测试，因为它为您的应用程序提供了在现实生活中可能不会收到的积极反馈。

人们在编写客户端/服务器应用程序时常犯的一个错误是没有包含应用程序层保持连接或至少在传输层启用保持连接。否则，应用程序 recv()ing 数据可能永远不会注意到任何失败情况，直到它 write()s 并且由于传输层超时而导致写入失败。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T07:48:08.767

根据您运行的操作系统，拉网线会产生不同的效果。正如另一位海报所说，Windows 会检测到它并使任何现有连接无效。在这种情况下，您的应用程序应该会收到一条连接关闭消息。

另一方面，我的 Linux 服务器可以非常优雅地处理它。在前几天进行了长时间（30-40 秒）的布线后，从我的笔记本电脑到服务器的 SSH 连接仍然可以正常使用并且响应迅速。

只要电缆的拔出时间不超过 TCP 超时时间，堆栈就应该能够缓冲数据包并尽快重新传输它们。TCP 就是为此而设计的。如果您不使用 TCP，则数据包将从以太网孔中掉出并蒸发到大气中。

@einstein：如果您使用的是 select() 或衍生物，那么永远不要选择 NULL 超时。始终有一个合理的超时，并检查套接字状态是否过期。

# c# - web.config 中的 C# 命名空间

> ID：438199
> 
> 赞同：5
> 
> 时间：2009-01-13T07:22:22.673
> 
> 标签：c#, web-config

我来自 VB 背景并被迫学习 C#，我遇到了第一个障碍。

在 VB 中，我可以将我希望在整个应用程序中可用的所有命名空间放在 web.config 文件中，并且它可以在每个代码隐藏文件中使用，而无需添加导入语句。

```
<namespaces>
<clear/>
<add namespace="System"/>
<add namespace="System.Collections"/>
<add namespace="System.Collections.Generic"/> 
```

似乎 Visual Studio 不能用 C# 做到这一点，我必须在所有地方添加 using 语句。

请告诉我我遗漏了一些明显的东西，并且有办法完成这项工作。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-13T07:24:41.967

对于 C#，在 web.config 中输入的命名空间将在 .aspx 文件中被识别，而不是在代码隐藏中。我认为您不会花很长时间来调整（Ctrl-. 将让您在键入没有引用命名空间的类名时快速添加命名空间）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-13T09:45:41.433

此功能仅适用于 VB.NET，C# 项目不支持它：/。但是，您可以为新的源代码文件（[Visual Studio .NET 中的 C# 向导模板，](http://www.codeproject.com/KB/dotnet/VisualStudioTemplates.aspx)操作方法[：编辑 Visual Studio 模板](http://www.thecodinghumanist.com/Content/HowToEditVSTemplates.aspx)）创建一个模板，并根据需要更改默认命名空间。

# postgresql - 分析 PostgreSQL

> ID：438207
> 
> 赞同：7
> 
> 时间：2009-01-13T07:25:05.990
> 
> 标签：postgresql

我正在调查一个 PostgreSQL 支持的应用程序。

在具有 4GB RAM 的现代 Xeon 上，CPU 使用率始终超过 50%。在这 50% 的 CPU 利用率中，67% 是“用户”，33% 是“系统”（这是一台 Linux 机器）。系统根本没有等待 I/O。

我想知道如何才能看到这个 CPU 时间是如何分解的。

据我所知，查询主要是临时 SQL（没有准备好的语句）。

你认为这个用户 CPU 时间可以通过转移到准备好的语句来显着减少吗？即 SQL 解析时间、查询计划时间等是否会占用这么多 CPU？一些查询非常粗略（500-1000 个字符以上。）

谁能确认 PostgreSQL 是否自动规范化临时查询并为它们缓存查询计划，实际上使它们与准备好的语句（加上 SQL 解析时间）一样高效？

我可能会实现一些更高级别的缓存来解决这个问题，但我很想知道是否有人认为值得将此应用程序移动到准备好的语句中。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-13T08:20:35.067

假设您定期对数据库进行[VACUUM](http://www.postgresql.org/docs/8.3/static/maintenance.html)操作（这是 PostgreSQL 性能问题的标准来源），我认为赢得最佳性能的方法是

a）根据您所在的机器[调整您的](http://www.revsys.com/writings/postgresql-performance.html)安装[以提高性能](http://www.varlena.com/GeneralBits/Tidbits/perf.html)，并且

b)[分析每个查询](http://www.postgresql.org/docs/8.3/static/performance-tips.html)并找出是否可以进一步优化。

我真的不认为将查询移动到存储过程中会得到很多。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-01-20T07:11:03.400

您可能还没有看到的一个技巧是使用“top -c”来查看您的系统。使用该参数，您可以看到每个活动的 Postgres 进程实际在做什么。

查询计划不会以任何方式缓存在准备好的语句之外的数据库中。无论如何，如果您没有大量重复使用类似的查询，那么您不太可能使用准备好的语句来缩短查询时间。如果这样做最终会为优化器提供更少的信息来处理，你甚至可能会变得更糟，因为它在知道关于它将要做什么的所有信息之前就已经准备好了。1000 个字符远不是一个庞大的查询，除非您一次有数百个连接，否则查询解析或规划不太可能是您的问题。这可能是锁定问题、糟糕的 VACUUM 程序导致需要搜索以完成任何工作的臃肿数据（在 8.1 上很容易遇到）、缓慢的约束、过多的索引或不具备的设计 t 充分考虑在内存中移动事物的开销。查询开销在嫌疑人列表中非常低。

如果你确实有数百个连接，你应该考虑使用连接池。PostgreSQL 进程的创建非常繁重，在那种环境下它本身并不能很好地发挥作用。

射击，您运行的甚至是 8.1 的旧版本，您可能会看到一个错误；8.1.4 充满了它们。8.1.19 是最新的，甚至 8.3.5 已经是当前落后的几个有用的版本升级）。有关为什么在几乎所有情况下运行旧版本比升级风险更大的详细信息，请参阅[版本控制政策。](http://www.postgresql.org/support/versioning)

# .net - WPF Aero Glass DPI 设置不匹配

> ID：438211
> 
> 赞同：3
> 
> 时间：2009-01-13T07:27:46.860
> 
> 标签：.net, wpf, windows-vista, aero

我有一个使用 Aero Glass 的 WPF 应用程序。在 120dpi 设置下使用应用程序时，我的 UI 中的边距与我传递给 DwmExtendFrameIntoClientArea API 调用的边距不匹配。

如何在 .NET 3.0 中获取系统 DPI 设置，以便更正传递给 DwmExtendFrameIntoClientArea API 调用的边距？

本质上，WPF UI 使用与设备无关的单位，而 DwmExtendFrameIntoClientArea API 调用使用像素。

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T07:43:24.207

好的，类似以下内容将解决此问题：

```
Public Shared Function GetDpiAdjustedMargins(ByVal WindowHandle As IntPtr, ByVal Left As Integer, ByVal Right As Integer, ByVal Top As Integer, ByVal Bottom As Integer) As Margins
    '
    Dim Graphics As System.Drawing.Graphics = System.Drawing.Graphics.FromHwnd(WindowHandle)
    Dim DesktopDPIx As Single = Graphics.DpiX
    Dim DesktopDPIy As Single = Graphics.DpiY

    Dim Margins As Margins = New Margins
    Margins.Left = Left * (DesktopDPIx / 96)
    Margins.Right = Right * (DesktopDPIx / 96)
    Margins.Top = Top * (DesktopDPIx / 96)
    Margins.Bottom = Bottom * (DesktopDPIx / 96)
    Return Margins
    '
End Function 
```

资料来源：[C# 2008 中的 Pro WPF，作者：Matthew MacDonald](http://books.google.com/books?id=oexi5JDZs9cC&pg=PA237&lpg=PA237&dq=GetDpiAdjustedMargins&source=bl&ots=If5o7CWBvg&sig=8BfUR67grKhg8kb3n2tPr00cxZk&hl=en&sa=X&oi=book_result&resnum=2&ct=result)

# java - 如何强制 Java 以 300dpi 打印图形

> ID：438221
> 
> 赞同：2
> 
> 时间：2009-01-13T07:32:23.590
> 
> 标签：java, api, graphics, printing, resolution

当我搜索问题时，不知何故 java 打印 API 受到限制，所有发送到打印机的图片必须以 72dpi 分辨率打印。我们使用jasper report打印文件，无论我们画多大的条形码，条形码阅读器都不会扫描它..有类似的经历吗？如何解决这个问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T08:08:09.303

您需要通过属性[PrinterResolution](http://java.sun.com/j2se/1.5.0/docs/api/javax/print/attribute/standard/PrinterResolution.html)指定打印机分辨率。您还应该知道源分辨率，以便正确转换，例如：

```
PrinterResolution pr = new PrinterResolution(300, 300, PrinterResolution.DPI); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2018-04-11T15:20:18.190

如果图像的元数据中没有预先定义的 DPI，Java 会将图像的 DPI 设置为默认的 java 72dpi，因此添加 MediaSizeName、PrinterResolution、MediaPrintableArea 属性以获得最佳效果是不够的，您还必须在其中添加图像的 dpi元数据，在这个答案的方法示例中就是这样：[https](https://stackoverflow.com/a/4833697/8792371) ://stackoverflow.com/a/4833697/8792371 ：

```
 private void setDPI(IIOMetadata metadata) throws IIOInvalidTreeException {

    // for PMG, it's dots per millimeter
    double dotsPerMilli = 1.0 * DPI / 10 / INCH_2_CM;

    IIOMetadataNode horiz = new IIOMetadataNode("HorizontalPixelSize");
    horiz.setAttribute("value", Double.toString(dotsPerMilli));

    IIOMetadataNode vert = new IIOMetadataNode("VerticalPixelSize");
    vert.setAttribute("value", Double.toString(dotsPerMilli));

    IIOMetadataNode dim = new IIOMetadataNode("Dimension");
    dim.appendChild(horiz);
    dim.appendChild(vert);

    IIOMetadataNode root = new IIOMetadataNode("javax_imageio_1.0");
    root.appendChild(dim);

    metadata.mergeTree("javax_imageio_1.0", root);
 } 
```

，然后确保在所需的可打印区域中打印其余属性，例如：

```
 DocFlavor myFormat = DocFlavor.INPUT_STREAM.PNG;
        // Build a set of attributes
        PrintRequestAttributeSet aset = new HashPrintRequestAttributeSet();    
        aset.add(MediaSizeName.ISO_A10);  
        aset.add(new MediaPrintableArea(0, 0, 35, 24, MediaPrintableArea.MM));
        aset.add(PrintQuality.HIGH);
        aset.add(new PrinterResolution(203, 203, PrinterResolution.DPI));
        // adding other attributes
        aset.add(OrientationRequested.PORTRAIT);
        aset.add(new Copies(7));
        aset.add(Fidelity.FIDELITY_TRUE); 
```

有关更完整的示例：

```
import java.awt.EventQueue;
import java.awt.image.BufferedImage;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.util.Iterator;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.imageio.IIOImage;
import javax.imageio.ImageIO;
import javax.imageio.ImageTypeSpecifier;
import javax.imageio.ImageWriteParam;
import javax.imageio.ImageWriter;
import javax.imageio.metadata.IIOInvalidTreeException;
import javax.imageio.metadata.IIOMetadata;
import javax.imageio.metadata.IIOMetadataNode;
import javax.imageio.stream.ImageOutputStream;
import javax.print.Doc;
import javax.print.DocFlavor;
import javax.print.DocPrintJob;
import javax.print.PrintException;
import javax.print.PrintService;
import javax.print.PrintServiceLookup;
import javax.print.ServiceUI;
import javax.print.SimpleDoc;
import javax.print.attribute.HashPrintRequestAttributeSet;
import javax.print.attribute.PrintRequestAttributeSet;
import static javax.print.attribute.ResolutionSyntax.DPI;
import javax.print.attribute.standard.Copies;
import javax.print.attribute.standard.Fidelity;
import javax.print.attribute.standard.MediaPrintableArea;
import javax.print.attribute.standard.MediaSizeName;
import javax.print.attribute.standard.OrientationRequested;
import javax.print.attribute.standard.PrintQuality;
import javax.print.attribute.standard.PrinterResolution;
import javax.print.event.PrintJobEvent;
import javax.print.event.PrintJobListener;
import javax.print.event.PrintServiceAttributeEvent;

public class PNGPrintingExample {

    /**
     * @param args the command line arguments
     */
    public static void main(String[] args) {

        EventQueue.invokeLater(() -> {

            try {

                FileInputStream imageFile = null;

                imageFile = new FileInputStream("E:\\1-and-2-1.png");

                BufferedImage input = ImageIO.read(imageFile);
                File output = new File("E:\\To-Be-Printed.png");
                saveGridImage(output,input);

                imageFile = new FileInputStream(output);

                // Set the document type
                DocFlavor myFormat = DocFlavor.INPUT_STREAM.PNG;
                // Build a set of attributes
                PrintRequestAttributeSet aset = new HashPrintRequestAttributeSet(); 

                // setting media size and printing media attributes
                aset.add(MediaSizeName.ISO_A10);  
                aset.add(new MediaPrintableArea(0, 0, 35, 24, MediaPrintableArea.MM));
                aset.add(PrintQuality.HIGH);
                aset.add(new PrinterResolution(203, 203, PrinterResolution.DPI));

                // adding some may be needed attibutes
                aset.add(OrientationRequested.PORTRAIT);
                aset.add(new Copies(7));
                aset.add(Fidelity.FIDELITY_TRUE);

                        DocPrintJob job;
                        Doc myDoc = new SimpleDoc(imageFile, myFormat, null);
                        PrintService[] services =
                                PrintServiceLookup.lookupPrintServices(myFormat, null);
                        PrintService defaultPrintService = PrintServiceLookup
                           .lookupDefaultPrintService();     
                        PrintService selectedPrintService =
                           ServiceUI.printDialog(null, 150, 150,
                           services, defaultPrintService, myFormat, aset);
                        if(selectedPrintService!=null)
                        {
                           System.out.println("selected printer:"
                              +selectedPrintService.getName());

                                    try {

                                        job = selectedPrintService.createPrintJob();
                                        // Create a Doc

                                        PrintJobListener pjlForP = new PrintJobListener() {

                                            public void attributeUpdate(PrintServiceAttributeEvent e){
                                                System.out.println("updated");
                                            }

                                            @Override
                                            public void printJobNoMoreEvents(PrintJobEvent e){
                                                System.out.println("may be sent to "+e.getPrintJob().getPrintService());
                                            }

                                            @Override
                                            public void printDataTransferCompleted(PrintJobEvent pje) {
                                                System.out.println("print Data Transfer Completed");
                                            }

                                            @Override
                                            public void printJobCompleted(PrintJobEvent pje) {
                                                System.out.println("The print job was completed");
                                            }

                                            @Override
                                            public void printJobFailed(PrintJobEvent pje) {
                                                System.out.println("The print job has failed");
                                            }

                                            @Override
                                            public void printJobCanceled(PrintJobEvent pje) {
                                                System.out.println("The print job was cancelled");
                                            }

                                            @Override
                                            public void printJobRequiresAttention(PrintJobEvent pje) {
                                                System.out.println("The print job require attention");
                                            }
                                        };                                        

                                        job.addPrintJobListener(pjlForP);
                                        job.print(myDoc, aset);

                                        imageFile.close();

                                    } catch (PrintException ex) {
                                        Logger.getLogger(BarcodePrintingFromJava.class.getName()).log(Level.SEVERE, null, ex);
                                    }                           

                        }
                        else
                           System.out.println("selection cancelled");                        

            } catch (FileNotFoundException ex) {
                Logger.getLogger(BarcodePrintingFromJava.class.getName()).log(Level.SEVERE, null, ex);
            } catch (IOException ex) {
                Logger.getLogger(BarcodePrintingFromJava.class.getName()).log(Level.SEVERE, null, ex);
            }
         });

    }

    public static void saveGridImage(File output,BufferedImage gridImage) throws IOException {
       output.delete();

       final String formatName = "png";

       for (Iterator<ImageWriter> iw = ImageIO.getImageWritersByFormatName(formatName); iw.hasNext();) {
          ImageWriter writer = iw.next();
          ImageWriteParam writeParam = writer.getDefaultWriteParam();
          ImageTypeSpecifier typeSpecifier = ImageTypeSpecifier.createFromBufferedImageType(BufferedImage.TYPE_INT_RGB);
          IIOMetadata metadata = writer.getDefaultImageMetadata(typeSpecifier, writeParam);
          if (metadata.isReadOnly() || !metadata.isStandardMetadataFormatSupported()) {
             continue;
          }

          setDPI(metadata);

          final ImageOutputStream stream = ImageIO.createImageOutputStream(output);
          try {
             writer.setOutput(stream);
             writer.write(metadata, new IIOImage(gridImage, null, metadata), writeParam);
          } finally {
             stream.close();
          }
          break;
       }
    }

    public static void setDPI(IIOMetadata metadata) throws IIOInvalidTreeException {

       // for PNG, it's dots per millimeter
       double dotsPerMilli = 1.0 * DPI / 10 / 2.54;

       IIOMetadataNode horiz = new IIOMetadataNode("HorizontalPixelSize");
       horiz.setAttribute("value", Double.toString(dotsPerMilli));

       IIOMetadataNode vert = new IIOMetadataNode("VerticalPixelSize");
       vert.setAttribute("value", Double.toString(dotsPerMilli));

       IIOMetadataNode dim = new IIOMetadataNode("Dimension");
       dim.appendChild(horiz);
       dim.appendChild(vert);

       IIOMetadataNode root = new IIOMetadataNode("javax_imageio_1.0");
       root.appendChild(dim);

       metadata.mergeTree("javax_imageio_1.0", root);
    }    

} 
```

您可以尝试注释或删除图像的 dpi 设置行，或保存在定义的 dpi 方法的行中，然后通过打印机进行打印作业，以获得差异，并在图像的元数据中定义定义 dpi 的价值，以及 java 如何对图像元数据中的 dpi 定义做出反应。

# c# - 清除 HttpWebRequest UnsafeAuthenticatedConnectionSharing 池

> ID：438225
> 
> 赞同：0
> 
> 时间：2009-01-13T07:35:55.500
> 
> 标签：c#, .net, authentication, httpwebrequest, connection-pooling

是否可以清除当前进程的 UnsafeAuthenticatedConnectionSharing 池，即关闭所有经过身份验证的池连接？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T08:54:52.580

没试过。但是类似（直接输入，因此请注意错误）：

```
MyReq.ServicePoint.CloseConnectionGroup(null) 
```

会成功的。

笔记：

*   没有游泳池。有一个打开连接的重用。
*   这不是我使用或尝试过的东西。根据我对文档的理解。

# c++ - 异常层次结构与错误枚举

> ID：438227
> 
> 赞同：8
> 
> 时间：2009-01-13T07:36:55.203
> 
> 标签：c++, exception

我在某处（现在找不到）读到大型异常层次结构是浪费时间。这个声明的理由在当时似乎是合理的，这个想法一直萦绕在我心头。

在我自己的代码中，当我有一个可能有一系列错误条件的代码库时，我使用带有枚举成员的单个异常来区分它们。

如果出现我需要捕捉其中一个错误的情况，我会捕捉它，检查枚举并重新抛出它是否不是我所期望的。理想情况下，这应该很少见。

我再次与异常一起工作，我有一个反思的时刻，我质疑我的异常习惯。我很好奇其他人都在做什么，为什么？

层次结构或数据成员的一个例外。

顺便说一句，我假设您同意异常与错误代码的想法。我不想打开那罐虫子。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-13T12:31:55.217

简单的经验法则：

*   如果您在检查异常后最终重新抛出异常，那么您需要一个更细粒度的异常层次结构（除了检查需要大量逻辑的罕见情况）。
*   如果您有从未被捕获的异常类（只有它们的超类型是），那么您需要一个不那么细粒度的异常层次结构。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-13T08:06:48.463

我认为只有一种带有嵌入式枚举的异常类型是次优的：

1.  您被迫比必要更频繁地捕获异常（并重新抛出它，一旦您确定您无法处理它）
2.  枚举本身就成为一个变更热点（所有程序员都需要定期修改它）
3.  枚举不是分层的，因此例如，您无法使用一个处理程序轻松处理所有 IO 错误
4.  有时您还想向调用者提供除错误消息文本之外的其他信息，例如尚未找到的文件的路径或从 SQL 服务器收到的错误号。将所有可能的错误场景中的这些附加信息放入同一个异常中会使处理更加麻烦。

为了回答您的问题，我使用了异常层次结构。它比它深得多。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-13T12:33:00.720

你不应该对此持教条主义的态度。使用最适合手头问题的方法。我的经验法则如下：

*   仅当您需要需要不同***行为***的异常时才创建新的异常类。
*   相反，当您只想在异常中包含额外信息时，将内容（枚举、错误代码等）添加到异常类
*   除非你真的需要它们，否则不要创建新类。记住，雅格尼……

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-13T08:50:34.040

我认为你有两个世界中最糟糕的。大型异常层次结构是无用的，因为已知客户端是惰性的，并且最终只会检查顶部节点（可能只检查层次结构根）。你的枚举系统并没有解决这个问题，并且导致了一个更麻烦的异常捕获系统。

如果你真的知道需要很多不同的异常，并且捕手真的想要不同的异常（知道，而不是模糊地认为），那么继续使用大层次结构并忘记枚举。否则，坚持小的异常层次结构，只提供对捕获者真正感兴趣的异常类。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-13T08:09:40.910

根据我的经验，太多的异常类只会让人感到困惑，尤其是它们只用于一种非常特定类型的问题。我见过一个系统，其中每个错误条件都有自己的异常，但在 catch 块中只检查了超类。子类完全是浪费时间。

另一方面，必须检查枚举并重新抛出异常会使代码不那么直观，因为您无法识别在 catch 之后直接抛出的异常。也许只是一个小缺点，但如果经常使用它会对可读性产生影响。在需要非常快的代码中使用时，它也可能造成性能问题。

我不会使用枚举解决方案，而是使用一些具有足够广泛范围的异常类型有用。像 DatabaseException 而不是 TableNotFoundException、ColumnNotFoundexception 等几个异常。根据我的经验，这对大多数开发人员最有效。您始终可以添加一个包含一些错误代码的字段，这些错误代码会显示给用户，以使用户和支持人员之间的沟通更容易。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-13T08:45:27.827

用一种异常类型和枚举子类型替换它们并不能解决异常类过多的问题。事实上，你只会让事情变得更糟！

**示例：**假设您有异常类型 Ex1..Ex99，例如 E14..E18 是 E1 的子级，等等。您现在决定用一个异常 Ex 和子类型 ST1..ST99 替换它们。你解决了什么问题？什么都没有——人们仍然必须处理所有的可能性。你让什么变得更糟了？您不能忽略 ST14-ST18 并将它们视为 ST1 的出现。您现在必须处理所有 99 种可能性，因为您的枚举子类型没有自然、灵活的层次结构。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-13T09:41:06.980

不要将错误与异常混为一谈。
错误发生时，尽可能接近问题地解决它们。
例外情况很少见，如果没有更多的上下文信息，通常是无法解决的。

如果出现问题并且可以在本地更正，那么您可能应该使用错误代码并在那里处理它。

应使用异常将问题沿调用堆栈向上传播到具有足够信息来解决问题的上下文。

这么说：枚举不是要走的路，因为它们绕过了编译器会自动为你生成的整个 try catch 机制。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-13T07:57:45.347

我喜欢为不同的错误分类（例如致命/非致命条件或应用程序的特定层或模块）设置少量异常的想法。然后，异常的抛出者应提供代码以作为异常的有效负载包含在内。应用程序的表示层可以查找与代码对应的本地化人类可读错误消息。

总而言之，异常类型对开发人员有用，与错误代码对应的消息对用户有用。

# c# - 监控进程的网络使用情况？

> ID：438240
> 
> 赞同：14
> 
> 时间：2009-01-13T07:47:19.753
> 
> 标签：c#, winapi, network-monitoring

在 C# 或 C/C++ 和 Win32 中有没有办法监控某个进程的网络使用情况（显然你没有构建该应用程序）？我想只监视一个进程大约一个小时，然后返回仅由该进程使用的字节，例如limewire。

可能吗？我知道 Windows 上的 netstat -e 会告诉您发送/接收的总字节数，但这是针对所有进程的。

编辑：如果我不能只返回一个进程的使用情况，我怎样才能得到整个系统发送/接收的字节数？正如 netstat 显示的那样，除了我只想要整数。

例如：

```
网络状态 -e

                           收到 发送

字节 2111568926 1133174989
单播数据包 3016480 2711006
非单播数据包 3122 1100
丢弃 0 0
错误 0 0
未知协议 0

```

我只想得到 2 个变量，比如 rec = 2111568926 和 sent = 1133174989

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T08:02:20.643

您可以为此使用[WinPcap或编写您自己的设备驱动程序。](http://www.winpcap.org/)我不认为您可以利用任何每个进程的 perfmon 计数器。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-13T08:08:29.570

[ 2021 年编辑：由于网络监视器在 Windows XP 之后停用，因此链接已失效。]

这是可能的，但如果我没记错的话，你必须创建一个网络驱动程序来过滤所有网络流量，然后找出哪个进程创建了流量。

Microsoft 有一个免费的应用程序，称为[Microsoft Network Monitor 3.2](http://blogs.technet.com/netmon/archive/2008/09/17/network-monitor-3-2-has-arrived.aspx)（[下载](http://www.microsoft.com/downloads/details.aspx?FamilyID=f4db40af-1e08-4a21-a26b-ec2f4dc4190d&DisplayLang=en)）。根据发行说明，它还有一个可供使用的 api。

> Network Monitor API：创建您自己的应用程序来捕获、解析和分析网络流量！

[这是一篇关于这些 API 的博客文章](http://blogs.technet.com/netmon/archive/2008/10/29/intro-to-the-network-monitor-api.aspx)。

在我看来，您应该使用此 API（或其他 API，例如 WinPcap）来过滤流量，而不是编写自己的设备驱动程序。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-04-12T11:38:54.847

我在 MSDN 论坛上问了同样的问题并得到了答案。坦白说已经试过了。即尝试但不是那么难））建议使用ETW。我没有意识到如何正确使用 ETW 事件。[http://social.msdn.microsoft.com/Forums/en-US/perfmon/thread/b82da95a-1c18-49ce-9bfa-e3d79ec40907](http://social.msdn.microsoft.com/Forums/en-US/perfmon/thread/b82da95a-1c18-49ce-9bfa-e3d79ec40907)

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-01-13T09:38:55.270

[NetLimiter 2 限制器](http://www.netlimiter.com/download.php)

[网络流量监视器您可以从](http://www.nicocuppen.com/pit/editor/page_detail.php?id=10104)[这里](http://www.aplusfreeware.com/categories/LFWV/NetworkTrafficMonitor.html) 获取最新的免费软件版本

# vb.net - 如何导入 System.Net.Mail

> ID：438252
> 
> 赞同：0
> 
> 时间：2009-01-13T07:53:35.963
> 
> 标签：vb.net, smtp

我正在输入“Imports System.Net.Mail”，但它说“找不到用于导入 'System.Net.mail' 的命名空间或类型 'Mail'”。我已经在引用中添加了“system.web.dll”和“system.dll”。

使用命名空间 System.Net.Mail 还需要什么？非常感谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T08:05:20.217

**更新 2：**

您将需要安装 .net 版本 2（或更好的 3.5 sp1）。您必须升级到 Visual Studio 2005 或 2008。

**更新1：**

[System.Net.Mail](http://msdn.microsoft.com/en-us/library/system.net.mail.aspx)是 .net 框架 2 的新手。如果您必须使用 .net 1.1，那么您必须使用：[System.Web.Mail](http://msdn.microsoft.com/en-us/library/system.web.mail.aspx)

**更新0：**

您的计算机上是否安装了 .net framework 2？您使用的是哪个版本的视觉工作室？

# asp.net - 向 ASP.Net 动态数据列表页添加搜索框

> ID：438257
> 
> 赞同：6
> 
> 时间：2009-01-13T07:57:31.043
> 
> 标签：asp.net, asp.net-dynamic-data

有谁知道如何在 ASP.NET 动态数据列表页上添加一个简单的搜索文本框？我希望能够立即深入到特定行，而不必使用动态数据过滤器来缩小范围。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T21:06:14.407

即使您使用 ASP.NET 3.5 中的动态数据框架，名为[ASP.NET 动态数据过滤](http://www.codeplex.com/DynamicDataFiltering)的 CodePlex 项目也可以轻松搜索站点上的任何信息。按照[这些说明](http://heyse.us/blog/?p=104)获取搜索文本框。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-02T21:42:48.953

新的 Dynamic Data 4 预览版包含一个名为 BusinessLogicDataSource 的数据源，这里有一些示例说明如何使用它来实现搜索。

[http://quickstarts.asp.net/previews/dynamicdata/dd_AddSearchtoDynamicData.htm](http://quickstarts.asp.net/previews/dynamicdata/dd_AddSearchtoDynamicData.htm)

我真的不能说如何在当前的动态数据实现中做到这一点，我也在寻找这个答案，并偶然发现了预览网站和这个问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-08-27T04:47:29.297

如果您使用的是 .NETv4，请查看此示例扩展动态数据中的过滤支持 动态数据[中的文本过滤](http://blogs.msdn.com/b/pranav_rastogi/archive/2010/10/03/text-filtering-with-dynamic-data.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-05-12T06:14:32.820

您还可以考虑在 ASP.NET 动态数据站点中实现的搜索功能之一：在动态数据中将[多列搜索添加到默认列表页面](http://csharpbits.notaclue.net/2011/01/adding-multi-column-search-to-default.html)。

# delphi - Delphi快速文件复制

> ID：438260
> 
> 赞同：16
> 
> 时间：2009-01-13T08:01:17.883
> 
> 标签：delphi, file, copy

我正在编写一个应该将一堆文件从一个地方复制到另一个地方的应用程序。当我使用 TFileStream 进行复制时，它比使用操作系统复制文件慢 3-4 倍。

我也尝试使用缓冲区进行复制，但这也太慢了。

我在Win32下工作，有人对这个问题有所了解吗？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-01-13T08:28:42.023

有几个选项。

1.  您可以调用使用[CopyFileA](http://msdn.microsoft.com/en-us/library/aa363851(VS.85).aspx) windows API 的 CopyFile
    *   您可以调用资源管理器使用的 api（windows api [SHFileOperation](http://msdn.microsoft.com/en-us/library/bb762164(VS.85).aspx)）。可以在 [SCIP.be上找到调用该函数的示例](http://www.scip.be/index.php?Page=ArticlesDelphi08&Lang=EN)
    *   您可以编写自己的使用缓冲区的函数。

如果您知道要复制的文件类型，第三种方法通常会优于其他方法。因为 Windows API 更适合整体最佳情况（小文件、大文件、网络文件、慢速驱动器上的文件）。您可以更多地调整自己的复制功能以满足您的需求。

下面是我自己的缓冲复制函数（我已经去掉了 GUI 回调）：

```
procedure CustomFileCopy(const ASourceFileName, ADestinationFileName: TFileName);
const
  BufferSize = 1024; // 1KB blocks, change this to tune your speed
var
  Buffer : array of Byte;
  ASourceFile, ADestinationFile: THandle;
  FileSize: DWORD;
  BytesRead, BytesWritten, BytesWritten2: DWORD;
begin
  SetLength(Buffer, BufferSize);
  ASourceFile := OpenLongFileName(ASourceFileName, 0);
  if ASourceFile <> 0 then
  try
    FileSize := FileSeek(ASourceFile, 0, FILE_END);
    FileSeek(ASourceFile, 0, FILE_BEGIN);
    ADestinationFile :=  CreateLongFileName(ADestinationFileName, FILE_SHARE_READ);
    if ADestinationFile <> 0 then
    try
      while (FileSize - FileSeek(ASourceFile, 0, FILE_CURRENT)) >= BufferSize do
      begin
        if (not ReadFile(ASourceFile, Buffer[0], BufferSize, BytesRead, nil)) and (BytesRead = 0) then
         Continue;
        WriteFile(ADestinationFile, Buffer[0], BytesRead, BytesWritten, nil);
        if BytesWritten < BytesRead then
        begin
          WriteFile(ADestinationFile, Buffer[BytesWritten], BytesRead - BytesWritten, BytesWritten2, nil);
          if (BytesWritten2 + BytesWritten) < BytesRead then
            RaiseLastOSError;
        end;
      end;
      if FileSeek(ASourceFile, 0, FILE_CURRENT)  < FileSize then
      begin
        if (not ReadFile(ASourceFile, Buffer[0], FileSize - FileSeek(ASourceFile, 0, FILE_CURRENT), BytesRead, nil)) and (BytesRead = 0) then
         ReadFile(ASourceFile, Buffer[0], FileSize - FileSeek(ASourceFile, 0, FILE_CURRENT), BytesRead, nil);
        WriteFile(ADestinationFile, Buffer[0], BytesRead, BytesWritten, nil);
        if BytesWritten < BytesRead then
        begin
          WriteFile(ADestinationFile, Buffer[BytesWritten], BytesRead - BytesWritten, BytesWritten2, nil);
          if (BytesWritten2 + BytesWritten) < BytesRead then
            RaiseLastOSError;
        end;
      end;
    finally
      CloseHandle(ADestinationFile);
    end;
  finally
    CloseHandle(ASourceFile);
  end;
end; 
```

自带功能：

```
function OpenLongFileName(const ALongFileName: String; SharingMode: DWORD): THandle; overload;
begin
  if CompareMem(@(ALongFileName[1]), @('\\'[1]), 2) then
    { Allready an UNC path }
    Result := CreateFileW(PWideChar(WideString(ALongFileName)), GENERIC_READ, SharingMode, nil, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, 0)
  else
    Result := CreateFileW(PWideChar(WideString('\\?\' + ALongFileName)), GENERIC_READ, SharingMode, nil, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, 0);
end;
function OpenLongFileName(const ALongFileName: WideString; SharingMode: DWORD): THandle;  overload;
begin
  if CompareMem(@(WideCharToString(PWideChar(ALongFileName))[1]), @('\\'[1]), 2) then
    { Allready an UNC path }
    Result := CreateFileW(PWideChar(ALongFileName), GENERIC_READ, SharingMode, nil, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, 0)
  else
    Result := CreateFileW(PWideChar('\\?\' + ALongFileName), GENERIC_READ, SharingMode, nil, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, 0);
end;

function CreateLongFileName(const ALongFileName: String; SharingMode: DWORD): THandle; overload;
begin
  if CompareMem(@(ALongFileName[1]), @('\\'[1]), 2) then
    { Allready an UNC path }
    Result := CreateFileW(PWideChar(WideString(ALongFileName)), GENERIC_WRITE, SharingMode, nil, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, 0)
  else
    Result := CreateFileW(PWideChar(WideString('\\?\' + ALongFileName)), GENERIC_WRITE, SharingMode, nil, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, 0);
end;
function CreateLongFileName(const ALongFileName: WideString; SharingMode: DWORD): THandle; overload;
begin
  if CompareMem(@(WideCharToString(PWideChar(ALongFileName))[1]), @('\\'[1]), 2) then
    { Allready an UNC path }
    Result := CreateFileW(PWideChar(ALongFileName), GENERIC_WRITE, SharingMode, nil, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, 0)
  else
    Result := CreateFileW(PWideChar('\\?\' + ALongFileName), GENERIC_WRITE, SharingMode, nil, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, 0);
end; 
```

代码比必要的要长一些，因为我包含了一个重试机制来支持我遇到的 wifi 连接问题。

所以这部分

```
 if BytesWritten < BytesRead then
    begin
      WriteFile(ADestinationFile, Buffer[BytesWritten], BytesRead - BytesWritten, BytesWritten2, nil);
      if (BytesWritten2 + BytesWritten) < BytesRead then
        RaiseLastOSError;
    end; 
```

可以写成

```
 if BytesWritten < BytesRead then
    begin
        RaiseLastOSError;
    end; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-13T08:14:18.107

或许你可以研究一下 Cobian Backup 8（代号为 Black Moon）的源代码。它是开源的，用 Delphi 编写的。

[http://www.edu.umu.se/~cobian/cobianbackup.htm](http://www.educ.umu.se/~cobian/cobianbackup.htm)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-08-20T10:21:48.023

首先，我很抱歉碰到这个旧线程，但我对**戴维兰德曼**为我自己的需要做出的伟大答案做了一些重大改变。这些变化是：

*   添加了使用相对路径的可能性（当然保留了绝对和 UNC 路径支持）
*   添加回调功能，以便在屏幕上显示复制进度（继续阅读）或取消复制过程
*   主要代码被清理了一点。我认为保留了 Unicode 支持，但我真的不知道，因为我使用的是最新的 ANSI 版本的 Delphi 编译器（如果有人可以测试吗？）

要使用此代码，请在您的项目中创建一个**FastCopy.pas**文件，然后复制粘贴内容：

```
{
  FastCopyFile

  By SiZiOUS 2014, based on the work by Davy Landman
  www.sizious.com - @sizious - fb.com/sizious - sizious (at) gmail (dot) com

  This unit was designed to copy a file using the Windows API.
  It's faster than using the (old) BlockRead/Write and TFileStream methods.

  Every destination file will be overwritten (by choice), unless you specify
  the fcfmAppend CopyMode flag. In that case, the source file will be appened to
  the destination file (instead of overwriting it).

  You have the choice to use a normal procedure callback, method object callback
  or no callback at all. The callback is used to cancel the copy process and to
  display the copy progress on-screen.

  Developed and tested under Delphi 2007 (ANSI).
  If you are using a Unicode version of Delphi (greater than Delphi 2007), may
  be you need to do some adapations (beware of the WideString type).

  All credits flying to Davy Landman.
  http://stackoverflow.com/questions/438260/delphi-fast-file-copy   
}
unit FastCopy;

interface

uses
  Windows, SysUtils;

type
  TFastCopyFileMode = (fcfmCreate, fcfmAppend);
  TFastCopyFileNormalCallback = procedure(const FileName: TFileName;
    const CurrentSize, TotalSize: LongWord; var CanContinue: Boolean);
  TFastCopyFileMethodCallback = procedure(const FileName: TFileName;
    const CurrentSize, TotalSize: LongWord; var CanContinue: Boolean) of object;

// Simplest definition
function FastCopyFile(
  const ASourceFileName, ADestinationFileName: TFileName): Boolean; overload;

// Definition with CopyMode and without any callbacks
function FastCopyFile(
  const ASourceFileName, ADestinationFileName: TFileName;
  CopyMode: TFastCopyFileMode): Boolean; overload;

// Definition with normal procedure callback
function FastCopyFile(
  const ASourceFileName, ADestinationFileName: TFileName;
  CopyMode: TFastCopyFileMode;
  Callback: TFastCopyFileNormalCallback): Boolean; overload;

// Definition with object method callback  
function FastCopyFile(
  const ASourceFileName, ADestinationFileName: TFileName;
  CopyMode: TFastCopyFileMode;
  Callback: TFastCopyFileMethodCallback): Boolean; overload;

implementation

{ Dummy Callback: Method Version }
type
  TDummyCallBackClient = class(TObject)
  private
    procedure DummyCallback(const FileName: TFileName;
      const CurrentSize, TotalSize: LongWord; var CanContinue: Boolean);
  end;

procedure TDummyCallBackClient.DummyCallback(const FileName: TFileName;
  const CurrentSize, TotalSize: LongWord; var CanContinue: Boolean);
begin
  // Nothing
  CanContinue := True;
end;

{ Dummy Callback: Classical Procedure Version }
procedure DummyCallback(const FileName: TFileName;
  const CurrentSize, TotalSize: LongWord; var CanContinue: Boolean);
begin
  // Nothing
  CanContinue := True;
end;

{ CreateFileW API abstract layer }
function OpenLongFileName(ALongFileName: string; DesiredAccess, ShareMode,
  CreationDisposition: LongWord): THandle;
var
  IsUNC: Boolean;
  FileName: PWideChar;

begin
  // Translate relative paths to absolute ones
  ALongFileName := ExpandFileName(ALongFileName);

  // Check if already an UNC path
  IsUNC := Copy(ALongFileName, 1, 2) = '\\';
  if not IsUNC then
    ALongFileName := '\\?\' + ALongFileName;

  // Preparing the FileName for the CreateFileW API call
  FileName := PWideChar(WideString(ALongFileName));

  // Calling the API
  Result := CreateFileW(FileName, DesiredAccess, ShareMode, nil,
    CreationDisposition, FILE_ATTRIBUTE_NORMAL, 0);
end;

{ FastCopyFile implementation }
function FastCopyFile(const ASourceFileName, ADestinationFileName: TFileName;
  CopyMode: TFastCopyFileMode;
  Callback: TFastCopyFileNormalCallback;
  Callback2: TFastCopyFileMethodCallback): Boolean; overload;
const
  BUFFER_SIZE = 524288; // 512KB blocks, change this to tune your speed

var
  Buffer: array of Byte;
  ASourceFile, ADestinationFile: THandle;
  FileSize, BytesRead, BytesWritten, BytesWritten2, TotalBytesWritten,
  CreationDisposition: LongWord;
  CanContinue, CanContinueFlag: Boolean;

begin
  FileSize := 0;
  TotalBytesWritten := 0;
  CanContinue := True;
  SetLength(Buffer, BUFFER_SIZE);

  // Manage the Creation Disposition flag
  CreationDisposition := CREATE_ALWAYS;
  if CopyMode = fcfmAppend then
    CreationDisposition := OPEN_ALWAYS;

  // Opening the source file in read mode
  ASourceFile := OpenLongFileName(ASourceFileName, GENERIC_READ, 0, OPEN_EXISTING);
  if ASourceFile <> 0 then
  try
    FileSize := FileSeek(ASourceFile, 0, FILE_END);
    FileSeek(ASourceFile, 0, FILE_BEGIN);

    // Opening the destination file in write mode (in create/append state)
    ADestinationFile := OpenLongFileName(ADestinationFileName, GENERIC_WRITE,
      FILE_SHARE_READ, CreationDisposition);

    if ADestinationFile <> 0 then
    try
      // If append mode, jump to the file end
      if CopyMode = fcfmAppend then
        FileSeek(ADestinationFile, 0, FILE_END);

      // For each blocks in the source file
      while CanContinue and (LongWord(FileSeek(ASourceFile, 0, FILE_CURRENT)) < FileSize) do
      begin

        // Reading from source
        if (ReadFile(ASourceFile, Buffer[0], BUFFER_SIZE, BytesRead, nil)) and (BytesRead <> 0) then
        begin
          // Writing to destination
          WriteFile(ADestinationFile, Buffer[0], BytesRead, BytesWritten, nil);

          // Read/Write secure code block (e.g. for WiFi connections)
          if BytesWritten < BytesRead then
          begin
            WriteFile(ADestinationFile, Buffer[BytesWritten], BytesRead - BytesWritten, BytesWritten2, nil);
            Inc(BytesWritten, BytesWritten2);
            if BytesWritten < BytesRead then
              RaiseLastOSError;
          end;

          // Notifying the caller for the current state
          Inc(TotalBytesWritten, BytesWritten);
          CanContinueFlag := True;
          if Assigned(Callback) then
            Callback(ASourceFileName, TotalBytesWritten, FileSize, CanContinueFlag);
          CanContinue := CanContinue and CanContinueFlag;
          if Assigned(Callback2) then
            Callback2(ASourceFileName, TotalBytesWritten, FileSize, CanContinueFlag);
          CanContinue := CanContinue and CanContinueFlag;
        end;

      end;

    finally
      CloseHandle(ADestinationFile);
    end;

  finally
    CloseHandle(ASourceFile);
  end;

  // Check if cancelled or not
  if not CanContinue then
    if FileExists(ADestinationFileName) then
      DeleteFile(ADestinationFileName);

  // Results (checking CanContinue flag isn't needed)
  Result := (FileSize <> 0) and (FileSize = TotalBytesWritten); 
end;

{ FastCopyFile simple definition }
function FastCopyFile(const ASourceFileName, ADestinationFileName: TFileName): Boolean; overload;
begin
  Result := FastCopyFile(ASourceFileName, ADestinationFileName, fcfmCreate);
end;

{ FastCopyFile definition without any callbacks }
function FastCopyFile(const ASourceFileName, ADestinationFileName: TFileName;
  CopyMode: TFastCopyFileMode): Boolean; overload;
begin
  Result := FastCopyFile(ASourceFileName, ADestinationFileName, CopyMode,
    DummyCallback);
end;

{ FastCopyFile definition with normal procedure callback }
function FastCopyFile(const ASourceFileName, ADestinationFileName: TFileName;
  CopyMode: TFastCopyFileMode;
  Callback: TFastCopyFileNormalCallback): Boolean; overload;
var
  DummyObj: TDummyCallBackClient;

begin
  DummyObj := TDummyCallBackClient.Create;
  try
    Result := FastCopyFile(ASourceFileName, ADestinationFileName, CopyMode,
      Callback, DummyObj.DummyCallback);
  finally
    DummyObj.Free;
  end;
end;

{ FastCopyFile definition with object method callback }
function FastCopyFile(const ASourceFileName, ADestinationFileName: TFileName;
  CopyMode: TFastCopyFileMode;
  Callback: TFastCopyFileMethodCallback): Boolean; overload;
begin
  Result := FastCopyFile(ASourceFileName, ADestinationFileName, CopyMode,
    DummyCallback, Callback);
end;

end. 
```

调用 main 方法`FastCopyFile`，您有 4 个重载函数可以满足各种需求。您将在下面找到两个示例，向您展示如何使用该单元。

第一个是最简单的：只需创建一个`Console Application`，然后复制粘贴以下内容：

```
program Project1;

{$APPTYPE CONSOLE}

uses
  SysUtils,
  fastcopy in 'fastcopy.pas';

begin
  try
    WriteLn('FastCopyFile Result: ', FastCopyFile('test2.bin', 'test.bin'));
    WriteLn('Strike the <ENTER> key to exit...');
    ReadLn;
  except
    on E:Exception do
      Writeln(E.Classname, ': ', E.Message);
  end;
end. 
```

如果您愿意，我制作了一个 VCL 应用程序，以向您展示如何显示复制进度和中止可能性。此应用程序是多线程的，以避免 GUI 冻结。要测试这个更完整的示例，请创建一个新的 VCL 应用程序，然后使用以下代码：

**Unit1.pas**：

```
unit Unit1;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, ComCtrls, StdCtrls, ExtCtrls, FastCopy;

type
  TFastCopyFileThread = class;

  TForm1 = class(TForm)
    Button1: TButton;
    ProgressBar1: TProgressBar;
    Label1: TLabel;
    Button2: TButton;
    RadioGroup1: TRadioGroup;
    GroupBox1: TGroupBox;
    Edit1: TEdit;
    GroupBox2: TGroupBox;
    Edit2: TEdit;
    OpenDialog1: TOpenDialog;
    SaveDialog1: TSaveDialog;
    Button3: TButton;
    Button4: TButton;
    procedure Button1Click(Sender: TObject);
    procedure Button2Click(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure Button3Click(Sender: TObject);
    procedure Button4Click(Sender: TObject);
  private
    { Déclarations privées }
    fFastCopyFileThread: TFastCopyFileThread;
    fFastCopyFileThreadCanceled: Boolean;
    procedure ChangeControlsState(State: Boolean);
    procedure FastCopyFileProgress(Sender: TObject; FileName: TFileName;
      Value: Integer; var CanContinue: Boolean);
    procedure FastCopyFileTerminate(Sender: TObject);
    function GetStatusText: string;
    procedure SetStatusText(const Value: string);
  public
    { Déclarations publiques }
    procedure StartFastCopyThread;
    property StatusText: string read GetStatusText write SetStatusText;
  end;

  TFastCopyFileProgressEvent = procedure(Sender: TObject; FileName: TFileName;
    Value: Integer; var CanContinue: Boolean) of object;

  TFastCopyFileThread = class(TThread)
  private
    fSourceFileName: TFileName;
    fDestinationFileName: TFileName;
    fProgress: TFastCopyFileProgressEvent;
    fCopyMode: TFastCopyFileMode;
    procedure FastCopyFileCallback(const FileName: TFileName;
      const CurrentSize, TotalSize: LongWord; var CanContinue: Boolean);
  protected
    procedure Execute; override;
  public
    constructor Create; overload;
    property SourceFileName: TFileName
      read fSourceFileName write fSourceFileName;
    property DestinationFileName: TFileName
      read fDestinationFileName write fDestinationFileName;
    property CopyMode: TFastCopyFileMode read fCopyMode write fCopyMode;
    property OnProgress: TFastCopyFileProgressEvent
      read fProgress write fProgress;
  end;  

var
  Form1: TForm1;

implementation

{$R *.dfm}

{ TForm1 }

procedure TForm1.Button1Click(Sender: TObject);
begin
  StartFastCopyThread;
end;

procedure TForm1.Button2Click(Sender: TObject);
begin
  fFastCopyFileThread.Terminate;
  fFastCopyFileThreadCanceled := True;
end;

procedure TForm1.Button3Click(Sender: TObject);
begin
  with OpenDialog1 do
    if Execute then
      Edit1.Text := FileName;
end;

procedure TForm1.Button4Click(Sender: TObject);
begin
  with SaveDialog1 do
    if Execute then
      Edit2.Text := FileName;
end;

procedure TForm1.ChangeControlsState(State: Boolean);
begin
  Button1.Enabled := State;
  Button2.Enabled := not State;
  if State then
  begin
    if fFastCopyFileThreadCanceled then
      StatusText := 'Aborted!'
    else
      StatusText := 'Done!';
    fFastCopyFileThreadCanceled := False;
  end;
end;

procedure TForm1.FastCopyFileProgress(Sender: TObject; FileName: TFileName;
  Value: Integer; var CanContinue: Boolean);
begin
  StatusText := ExtractFileName(FileName);
  ProgressBar1.Position := Value;
end;

procedure TForm1.FastCopyFileTerminate(Sender: TObject);
begin
  ChangeControlsState(True);
end;

procedure TForm1.FormCreate(Sender: TObject);
begin
  ChangeControlsState(True);
  StatusText := 'Idle...';
end;

function TForm1.GetStatusText: string;
begin
  Result := Label1.Caption;
end;

procedure TForm1.SetStatusText(const Value: string);
begin
  Label1.Caption := Value;
end;

procedure TForm1.StartFastCopyThread;
begin
  ChangeControlsState(False);
  fFastCopyFileThread := TFastCopyFileThread.Create;
  with fFastCopyFileThread do
  begin
    SourceFileName := Edit1.Text;
    DestinationFileName := Edit2.Text;
    CopyMode := TFastCopyFileMode(RadioGroup1.ItemIndex);
    OnProgress := FastCopyFileProgress;
    OnTerminate := FastCopyFileTerminate;
    Resume;
  end;
end;

{ TFastCopyFileThread }

constructor TFastCopyFileThread.Create;
begin
  inherited Create(True);
  FreeOnTerminate := True;
end;

procedure TFastCopyFileThread.Execute;
begin
  FastCopyFile(SourceFileName, DestinationFileName, CopyMode,
    FastCopyFileCallback);
end;

procedure TFastCopyFileThread.FastCopyFileCallback(const FileName: TFileName;
  const CurrentSize, TotalSize: LongWord; var CanContinue: Boolean);
var
  ProgressValue: Integer;

begin
  CanContinue := not Terminated;
  ProgressValue := Round((CurrentSize / TotalSize) * 100);
  if Assigned(OnProgress) then
    OnProgress(Self, FileName, ProgressValue, CanContinue);
end;

end. 
```

**单元 1.dfm**：

```
object Form1: TForm1
  Left = 0
  Top = 0
  BorderStyle = bsDialog
  Caption = 'FastCopyFile Example (Threaded)'
  ClientHeight = 210
  ClientWidth = 424
  Color = clBtnFace
  Font.Charset = DEFAULT_CHARSET
  Font.Color = clWindowText
  Font.Height = -11
  Font.Name = 'Tahoma'
  Font.Style = []
  OldCreateOrder = False
  Position = poScreenCenter
  OnCreate = FormCreate
  PixelsPerInch = 96
  TextHeight = 13
  object Label1: TLabel
    Left = 8
    Top = 173
    Width = 31
    Height = 13
    Caption = 'Label1'
  end
  object Button1: TButton
    Left = 259
    Top = 177
    Width = 75
    Height = 25
    Caption = 'Start'
    Default = True
    TabOrder = 0
    OnClick = Button1Click
  end
  object ProgressBar1: TProgressBar
    Left = 8
    Top = 188
    Width = 245
    Height = 13
    TabOrder = 1
  end
  object Button2: TButton
    Left = 340
    Top = 177
    Width = 75
    Height = 25
    Caption = 'Stop'
    TabOrder = 2
    OnClick = Button2Click
  end
  object RadioGroup1: TRadioGroup
    Left = 4
    Top = 110
    Width = 410
    Height = 57
    Caption = ' Copy Mode: '
    ItemIndex = 0
    Items.Strings = (
      'Create (Overwrite destination)'
      'Append (Merge destination)')
    TabOrder = 3
  end
  object GroupBox1: TGroupBox
    Left = 4
    Top = 4
    Width = 412
    Height = 49
    Caption = ' Source: '
    TabOrder = 4
    object Edit1: TEdit
      Left = 8
      Top = 20
      Width = 369
      Height = 21
      TabOrder = 0
      Text = 'test.bin'
    end
    object Button3: TButton
      Left = 383
      Top = 20
      Width = 21
      Height = 21
      Caption = '...'
      TabOrder = 1
      OnClick = Button3Click
    end
  end
  object GroupBox2: TGroupBox
    Left = 4
    Top = 59
    Width = 412
    Height = 50
    Caption = ' Destination: '
    TabOrder = 5
    object Edit2: TEdit
      Left = 8
      Top = 21
      Width = 369
      Height = 21
      TabOrder = 0
      Text = 'sizious.bin'
    end
  end
  object Button4: TButton
    Left = 387
    Top = 80
    Width = 21
    Height = 21
    Caption = '...'
    TabOrder = 6
    OnClick = Button4Click
  end
  object OpenDialog1: TOpenDialog
    DefaultExt = 'bin'
    Filter = 'All Files (*.*)|*.*'
    Options = [ofHideReadOnly, ofFileMustExist, ofEnableSizing]
    Left = 344
    Top = 12
  end
  object SaveDialog1: TSaveDialog
    DefaultExt = 'bin'
    Filter = 'All Files (*.*)|*.*'
    Options = [ofOverwritePrompt, ofHideReadOnly, ofEnableSizing]
    Left = 344
    Top = 68
  end
end 
```

当然，不要忘记将**FastCopy.pas**文件引用添加到该项目。

你应该得到这个：

![FastCopyFile GUI 示例界面](https://i.stack.imgur.com/MTvT0.png)

选择一个源文件，一个目标文件，然后点击**Start**。

所有的功劳当然要归功于**戴维兰德曼**。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-13T08:09:06.807

您可以通过 SHFileOperation() [http://msdn.microsoft.com/en-us/library/bb762164(VS.85).aspx](http://msdn.microsoft.com/en-us/library/bb762164(VS.85).aspx)让 Explorer 为您执行此操作（来自 delphi 的示例代码：[http://delphi。 icm.edu.pl/ftp/d20free/fileop11.zip](http://delphi.icm.edu.pl/ftp/d20free/fileop11.zip) )

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-13T08:10:51.407

您可以尝试直接调用[CopyFile](http://msdn.microsoft.com/en-us/library/aa363851(VS.85).aspx) Windows API 函数

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-13T08:14:53.067

或者你可以用“脏”的方式来做......我找到了一些可以完成这项工作的旧代码（不确定它是否很快）：

```
procedure CopyFile(const FileName, DestName: string);
var
   CopyBuffer   : Pointer; { buffer for copying }
   BytesCopied  : Longint;
   Source, Dest : Integer; { handles }
   Destination  : TFileName; { holder for expanded destination name }

const
     ChunkSize  : Longint = 8192; { copy in 8K chunks }

begin
     Destination := DestName;
     GetMem(CopyBuffer, ChunkSize); { allocate the buffer }
     try
       Source := FileOpen(FileName, fmShareDenyWrite); { open source file }
       if Source < 0
          then raise EFOpenError.CreateFmt('Error: Can''t open file!', [FileName]);
       try
         Dest := FileCreate(Destination); { create output file; overwrite existing }
         if Dest < 0
            then raise EFCreateError.CreateFmt('Error: Can''t create file!', [Destination]);
         try
           repeat
             BytesCopied := FileRead(Source, CopyBuffer^, ChunkSize); { read chunk }
             if BytesCopied > 0  {if we read anything... }
                then FileWrite(Dest, CopyBuffer^, BytesCopied); { ...write chunk }
           until BytesCopied < ChunkSize; { until we run out of chunks }

         finally
           FileClose(Dest); { close the destination file }
         end;

       finally
         FileClose(Source); { close the source file }
       end;

     finally
       FreeMem(CopyBuffer, ChunkSize); { free the buffer }
     end;
end; 
```

# oop - 逻辑与物理设计

> ID：438261
> 
> 赞同：2
> 
> 时间：2009-01-13T08:01:41.017
> 
> 标签：oop, architecture

我有一个非常笼统的设计问题，但我会用一个例子来具体描述它。

假设您正在为数字打印机开发嵌入式软件。本机有 4 个打印头（C、M、Y、K 各色）。每个打印头执行相同的任务：取出碳粉并将其放在页面上。

在运行时，我们可以以两种不同的方式组织我们的 API。我们要么遵循逻辑（又称“功能”或“过程”）设计，因此客户端软件可以控制所有打印头的打印过程（例如一次更改所有颜色的亮度）。或者我们遵循物理设计，以便客户端软件可以单独控制每个打印头（例如仅更改洋红色的亮度）。

这是软件设计中的经典困境：我们要么按活动组织，要么按体系结构组织。按功能或形式。我的问题是：是否有任何可靠的标准来选择一个而不是另一个？不同的项目会选择不同的，都可以根据自己的情况选择合适的；所以我不问哪个最好，只问如何选择。例如，我会对您关于松散耦合、可维护性、分层、面向角色的设计、架构设计模式等的想法感兴趣。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T08:10:06.617

编写一个遵循物理设计的接口。最重要的是，您可以对将使用物理接口的逻辑接口进行分层。所以不要选择什么时候可以两者兼得。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T08:12:26.893

我想这取决于您的客户想要什么 - 从客户的角度来看系统的要求。

就个人而言，我倾向于将问题分解为两个较小的部分/问题：

访问和控制物理组件的低级代码 - 物理 API。（这将始终需要在您选择的任何设计方案中完成，以便可以集中精力完成）。

使用上述 API 提供更多功能/流程结构化 API（如有必要）

HTH 莱恩

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-17T14:15:24.653

做符合项目要求的最简单的事情。

如果逻辑设计满足项目的要求，对逻辑设计和物理设计进行编码可能会引入不必要的开发工作（从而导致成本）。

# sql - 使用有点奇怪的where子句的sql查询性能

> ID：438269
> 
> 赞同：0
> 
> 时间：2009-01-13T08:05:51.790
> 
> 标签：sql, where

我有一个有趣的问题要问你，那里的 sql 大师（或者可能在这里？）。

当我需要在运行时构建查询时，我就有了这个习惯。为了避免多次'if'检查，我只是去写'where true'。然后其余部分是形式中的子句的另一部分，当然是 'and true ...' 并继续进行有用的过滤。

我的问题是：那些“真实和真实”会影响查询性能吗？对，最好的答案是进行一些测试，但是根据您的经验，您对这种方法有什么想说的吗？

对了，我特别感兴趣的sql引擎是MySql。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T08:17:08.397

我们有 sql-server，但我们使用这种“不编程 ifs”（如果时间不多的话）1=1 作为表达式，并且我们无法测量性能影响。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T08:20:54.257

我认为 MySQL 查询优化器摆脱了`where true and true`一些东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T08:21:01.820

不应该。我在 SQL Server 中做过很多次，它对执行计划没有影响。但是，我不会将其留在生产代码中。

# mfc - 如何使用 MFC 创建一个完全透明的窗口？

> ID：438270
> 
> 赞同：2
> 
> 时间：2009-01-13T08:06:17.763
> 
> 标签：mfc, window, transparent

我想用 MFC 创建一个完全透明的窗口，但我不知道该怎么做。你能告诉我路吗？

非常感谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-14T22:24:50.057

您可以使用分层窗口来实现透明效果。请参阅[http://msdn.microsoft.com/en-us/library/ms997507.aspx](http://msdn.microsoft.com/en-us/library/ms997507.aspx)。请务必设置 WS_EX_LAYERED 位并使用 UpdateLayeredWindow。即使窗口对用户不可见，这也允许您捕获消息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T17:02:56.027

如果你真的想要不可见，那么你可以简单地清除窗口样式中的 WS_VISIBLE 位。覆盖 PreCreateWindow 并确保清除此标志。

或者，您可以通过在 CreateWindow 调用中将 HWND_MESSAGE 指定为父 hwnd 来创建仅处理消息的窗口。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T16:22:15.923

通过透明我假设你的意思是不可见的，而不是半透明的。您可以将窗口的区域设置为空白区域。看看Win32 API 中的[SetWindowRgn](http://msdn.microsoft.com/en-us/library/ms534845.aspx)和[区域函数](http://msdn.microsoft.com/en-us/library/ms536680(VS.85).aspx)。如果您想避免纯 Win32 调用，可能会有一些等效的 MFC 类和方法（例如[CRgn ）。](http://msdn.microsoft.com/en-us/library/aa312990(VS.60).aspx)

# java - Swing 屏幕键盘

> ID：438276
> 
> 赞同：5
> 
> 时间：2009-01-13T08:08:22.363
> 
> 标签：java, swing

我正在 Windows XP 上使用 Java 开发 KIOSK 系统。并且需要做一个屏幕键盘。我不知道该怎么做。所以你们能帮我做这件事吗？任何人都对此有所了解。谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T08:35:20.390

我为我的公司在 SWT 和 AWT 中实现了 OSK。

我们使用 ini 文件初始化 OSk 布局，您可以定义键盘布局（大小、字体、键盘线的外观、键标签和键操作）

首先，您应该生成读取这些 ini 文件的键盘。这完成得非常快。您应该在创建的按钮和顶部窗口上启用焦点。否则，获得关键操作的组件总是失去焦点。

第二步是实现事件调度管理器。您必须将 OSK 键事件发送到所有侦听事件对象。[您可以使用Robot](http://java.sun.com/j2se/1.4.2/docs/api/java/awt/Robot.html)发送事件或使用[FocusManager](http://java.sun.com/j2se/1.4.2/docs/api/javax/swing/FocusManager.html)获取焦点组件并直接设置它。

对于 SWT，它工作得很好，但在 AWT 中，它们是一些线程和焦点问题。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-02-13T21:44:03.907

这个出现在搜索如何在 java / swing 中进入锁定的信息亭模式...... - 我花了一段时间才知道如何做到这一点，所以这里适用于像我一样在这里结束的任何人：

```
public class FullScreen extends JWindow {

    public FullScreen()
    {

      getContentPane().add(new JLabel("A JFrame Kiosk"), BorderLayout.NORTH);

      JButton closeButton = new JButton("Close");

      closeButton.addActionListener( new ActionListener()
          {
              public void actionPerformed( ActionEvent ae )
              {
                  System.out.println("Close button Pressed");
                  FullScreen.this.setVisible(false);
                  System.exit(0);
              }
          });
      getContentPane().add(closeButton, BorderLayout.CENTER);
    }

    public static void main(String[] args) throws Exception {

        SwingUtilities.invokeLater(new Runnable() {
            public void run() {      
                GraphicsEnvironment.
                    getLocalGraphicsEnvironment().
                        getDefaultScreenDevice().
                            setFullScreenWindow(new FullScreen());
              }
        });
    }
} 
```

# linq-to-sql - 'Entities.Product' 类型的 'IsDeleted' 不支持子查询

> ID：438282
> 
> 赞同：6
> 
> 时间：2009-01-13T08:10:23.683
> 
> 标签：linq-to-sql, exception

我正在使用 Linq to SQL 并尝试使用 DataOptions 和 AssociateWith 过滤数据。我有一个名为 Products 的表，它有一个名为 Id 的主键和一个名为 IsDeleted 的标志，带有 sql-datatype 位。

当我使用以下代码时，在 AssociateWith 方法上**出现“'Entities.Product' 类型的 'IsDeleted' 不支持子查询”**异常。

```
var context = new DataContext();
DataLoadOptions options = new DataLoadOptions();
options.AssociateWith<Product>(p => !p.IsDeleted);
context.LoadOptions = options; 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-12-11T23:37:00.033

我相信您只允许在一个->多关系的子查询上使用两个过滤器，并且只能使用一组特定的表达式，详细说明如下：
Where
OrderBy
ThenBy
OrderByDescending
ThenByDescending
Take

（更多信息在这里 [http://msdn.microsoft.com/en-us/library/bb534221.aspx](http://msdn.microsoft.com/en-us/library/bb534221.aspx)）

# wpf - WPF 中的前 3 个主要概念是什么？

> ID：438285
> 
> 赞同：14
> 
> 时间：2009-01-13T08:11:20.780
> 
> 标签：wpf

为了编写好的 WPF 代码，您需要了解 WPF 中的前 3 个主要概念是什么？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-13T09:19:04.823

我认为 WPF 概念最重要的方面是：

*   模板和样式（定义应用程序行为和外观的方式）
*   数据绑定（您应该将 UI 与业务对象粘合在一起的方式
*   通过 XAML 进行声明性 UI 定义

也许还有其他元素，但在我看来，这些元素是 WPF 思维的基础。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-13T22:35:26.730

我想说最重要的一个概念是 UI 模式 Model-View-ViewModel，或者我喜欢称之为[Model-View-ModelController](http://codingcontext.wordpress.com)。这对于在 WPF 中成功构建应用程序至关重要。除此之外，真正的基石是其他人提到的数据绑定、模板和样式。[这里](https://stackoverflow.com/questions/322612/what-are-the-most-common-mistakes-made-in-wpf-development)有一篇很好的文章，介绍了在 wpf 中开发时要避免的一些常见陷阱。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T09:13:30.950

您必须了解的真正基础知识是：

*   XAML
*   布局
*   内容模型
*   数据绑定

它们的负载更多，但这些是与winforms变化最大的......

另请查看此线程：[面试问题：WPF 开发人员](https://stackoverflow.com/questions/58739/interview-questions-wpf-developer)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T08:36:20.357

我不知道前 3 名，但附加/依赖属性非常重要。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-13T08:53:48.293

我只能想到 WPF 中的两大主要概念

没有特别的顺序：

*   绑定
*   模板和样式

当您学习了这两个概念后，您将能够编写体面的 WPF 代码...

哦，第三个是 XAML .. 但这就是语言... 但是，您可能想尝试在后面的代码中放尽可能少的代码，在 XAML 文件中放尽可能多的...

选择代码背后的方法很容易，但请尝试在 XAML 中进行...

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-04-17T04:32:35.117

WPF 中最重要的概念在于 stype 和 UI 的行为。它有很多功能，其中以下三个是最有用和最重要的方面。

1.  构建业务对象和 UI 的数据绑定。
2.  改变风格和更用户友好，以便在 UI 中轻松实现，以便外观和填充作为用户视角很好。
3.  通过 XAML 重新定义 UI 并更改字体、样式、实现动画等。这是它最强大的概念。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-03-29T10:09:10.290

要更多地了解这项技术，就应该了解一项技术的架构。然而，以下是 WPF 中基本但最重要的概念是 -

1) XAML
2) 丰富的布局、面板和窗口
3) 内容模型
4) 数据绑定

# java - 如何安排 Callable 在特定时间运行？

> ID：438312
> 
> 赞同：2
> 
> 时间：2009-01-13T08:23:37.153
> 
> 标签：java, scheduling, callable

我需要在一天中的特定时间运行一个可调用的。一种方法是计算现在和期望时间之间的时间差异，并使用 executor.scheduleAtFixedRate。

有更好的主意吗？

`executor.scheduleAtFixedRate(command, TIMEDIFF(now,run_time), period, TimeUnit.SECONDS))`

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-13T08:26:10.250

对于这种事情，请继续安装[Quartz](http://www.quartz-scheduler.org/)。EJB 对这种事情有一些支持，但实际上您只希望 Quartz 用于计划任务。

话虽如此，如果您坚持自己做（我不建议这样做），请使用[`ScheduledThreadPoolExecutor`](http://java.sun.com/javase/6/docs/api/java/util/concurrent/ScheduledThreadPoolExecutor.html).

```
ScheduledExecutorService executor = new ScheduledThreadPoolExecutor(4);
ScheduledFuture<?> future =
  executor.scheduleAtFixedRate(runnable, 1, 24, TimeUnit.HOUR); 
```

它将`Runnable`每天运行，初始延迟为一小时。

或者：

```
Timer timer = new Timer();
final Callable c = callable;
TimerTask task = new TimerTask() {
  public void run() {
    c.call();
  }
}
t.scheduleAtFixedRate(task, firstExecuteDate, 86400000); // every day 
```

`Timer`有一个更简单的接口，并在 1.3 中引入（另一个是 1.5），但是一个线程执行所有任务，而第一个线程允许您对其进行配置。Plus`ScheduledExecutorService`有更好的关闭（和其他）方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T09:01:18.137

您可以使用[JDK Timer](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Timer.html)并且不需要计算时间差：

```
Timer timer = new Timer();
Date executionDate = new Date();
long period = 24 * 60 * 60 * 1000;
timer.scheduleAtFixedRate(
    new TimerTask() {
        @Override
        public void run() {
            // the task
        }
    },
    executionDate,
    period); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-13T18:23:38.690

Quartz 是一个好主意，但根据您的需要，可能有点矫枉过正。我认为你真正的问题是试图将你的服务塞进一个 servlet，而你实际上并没有监听传入的 HttpServletRequests。相反，请考虑使用 ServletContextListener 来启动您的服务和 Timer，正如 Maurice 建议的那样：

网页.xml：

```
<listener>
  <listener-class>com.myCompany.MyListener</listener-class>
</listener> 
```

然后你的班级看起来像这样：

```
public class MyListener implements ServletContextListener {

    /** the interval to wait per service call - 1 minute */
    private static final int INTERVAL = 60 * 60 * 1000;

    /** the interval to wait before starting up the service - 10 seconds */
    private static final int STARTUP_WAIT = 10 * 1000;

    private MyService service = new MyService();
    private Timer myTimer;

    public void contextDestroyed(ServletContextEvent sce) {
        service.shutdown();
        if (myTimer != null)
                myTimer.cancel();
    }

    public void contextInitialized(ServletContextEvent sce) {
        myTimer = new Timer();
        myTimer.schedule(new TimerTask() {
                public void run() {
                        myService.provideSomething();
                }
        },STARTUP_WAIT, INTERVAL
      );
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T08:26:52.123

我会推荐使用[Quartz 框架](http://www.quartz-scheduler.org/)。这将允许您以类似 cron 的方式安排作业。

# cocoa - NSNotification 如何用于检查 NSTask 的状态

> ID：438314
> 
> 赞同：3
> 
> 时间：2009-01-13T08:23:41.207
> 
> 标签：cocoa

NSNotification 如何用于检查 NSTask 的状态？我知道 NSTask 中有几个类方法，但并不真正了解如何在 Cocoa 应用程序中实现它们。有人可以帮助我吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T08:30:18.947

这篇博文，[Better way to read from an NSTask](http://macosx.com/forums/software-programming-web-scripting/4522-better-way-read-nstask.html)，描述了如何使用`NSNotification`从`NSTask`.

如果您知道您的任务不是长时间运行的，那么有一个更简单的解决方案。我对另一个 SO 问题[Execute a terminal command from a Cocoa app 的](https://stackoverflow.com/questions/412562/execute-a-terminal-command-from-a-cocoa-app#412573)回答有一个使用示例，`NSTask`其中包括返回任务的状态 w/o`NSNotification`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T08:47:14.653

谢谢 Gordon，我已经尝试了您提供的解决方案，但让我感到困惑的是当我编写代码时：

```
NSPipe *pipe;
pipe = [NSPipe pipe];
[task setStandardOutput: pipe];

NSFileHandle *file;
file = [pipe fileHandleForReading];

[task launch];

NSData *data;
data = [file readDataToEndOfFile]; 
```

可以从任务返回什么输出数据？对于我的情况，控制台窗口只是卡在那里并且没有返回任何内容

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T08:53:31.163

当您不阅读它在 stdout/stderr 上发送的内容时，任务将被卡住。这就是为什么您需要创建管道并使用`setStandardOutput`.

使用`[NSFileHandle readToEndOfFileInBackgroundAndNotify]`并等待`NSFileHandleReadToEndOfFileCompletionNotification`。它将在回调中为您提供所有数据。

# python - 有纯 Python Lucene 吗？

> ID：438315
> 
> 赞同：45
> 
> 时间：2009-01-13T08:24:28.493
> 
> 标签：python, full-text-search, lucene, ferret

红宝石人有[雪貂](https://github.com/dbalmain/ferret)。有人知道 Python 有什么类似的倡议吗？我们目前正在使用 PyLucene，但我想研究转向纯 Python 搜索。

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-02-10T18:43:11.480

[Whoosh](http://pypi.python.org/pypi/Whoosh/)是一个类似于 lucene 的新项目，但是是纯 python。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-13T10:01:09.827

我所知道的唯一一个纯 python（甚至不涉及 C 扩展）搜索解决方案是[Nucular](http://nucular.sourceforge.net/)。它很慢（比 PyLucene 慢得多）并且还不稳定。

我们从基于 PyLucene 的家庭烘焙搜索和索引转移到[Solr](http://lucene.apache.org/solr/)但 YMMV。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-13T15:31:45.027

我最近发现[了 pyndexter](http://swapoff.org/pyndexter)。它为各种不同的后端全文搜索引擎/索引器提供抽象接口。它附带一个默认的纯 python 实现。

尽管在 Python 中，这些事情可能会非常缓慢。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-13T16:46:45.420

对于某些应用程序，纯 Python 被高估了。看看Xapian。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-13T09:07:56.390

[lupy](http://sourceforge.net/project/showfiles.php?group_id=76541&package_id=77267)是纯 python 的 lucene 端口。[lupy 人建议您使用 PyLucene](http://divmod.org/trac/wiki/WhitherLupy)。对不起。也许您可以将 Java 源代码与[Jython](http://www.jython.org/Project/)结合使用。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-07T00:44:56.070

+1 Xapian 和 Pyndexter 的答案。

Ferret 实际上是用 C 语言编写的，顶部有 Ruby 绑定。纯 Ruby 搜索引擎甚至比纯 Python 搜索引擎还要慢。我希望看到“其他人”为 Ferret 的 Python 接口编写 Cython/Pyrex 层，但我自己不会这样做，因为当有用于 Xapian 的 Python 绑定时，为什么还要麻烦。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-09-28T19:56:24.187

对于非纯 Python，使用 Python API 的[Sphinx Search运行速度最快。](http://sphinxsearch.com)从多个博客的基准测试来看，Sphinx Search 比 Lucene 快得多，使用的内存少得多，而且它是 C 语言。

我正在开发一个基于它的多文档搜索引擎，使用 python 和[web2py](http://web2py.com)作为框架。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-06T18:47:09.863

经过数周的搜索，我找到了一个不错的 Python 解决方案：[repoze.catalog](http://static.repoze.org/catalogdocs/)。它不是严格意义上的 Python，因为它使用 ZODB 进行存储，但对我来说，它似乎比 SOLR 更好。

# .net - 大型机到 .NET 的迁移

> ID：438317
> 
> 赞同：2
> 
> 时间：2009-01-13T08:26:06.383
> 
> 标签：.net, migration, mainframe, cics

可用于将大型机应用程序（前端、数据库、业务逻辑）迁移到 .NET（C#.NET 或 VB.NET）和 SQL Server 2005 的各种工具有哪些？

当前的大型机系统具有：

*   CICS - 前端，
*   COBOL - 语言
*   IDEAL 和 DATAComDB - 数据库。

提前致谢。

阿吉什

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T08:44:25.987

对于“较小”平台，有一个 CICS TxSeries 和 COBOL for .NET，甚至还有一个 DB2，但我不确定将 IDEAL 或 DataCom 移植到 SQL 有多么容易——我什至不认为他们是这样的。重新相关。

我会考虑分阶段进行（即前端优先，DB 最后），因为这可能是最安全的迁移路径。您的前端应该能够移植到 .NET 并希望仍能与大型机数据库通信。然后，对其进行修改，使其可以同时使用 DataCom 或 SQL Server。然后放弃对 DataCom 的支持并摆脱您的大型机。

如果我想迁移，这就是我会做的（我不这样做:-)。

我的问题是：为什么？z/OS 提供的可靠性和吞吐量比您从 Windows 设备中获得的要高得多。是维修费吗？您是硬件的事实即将停止服务？

没有更多信息，就没有什么可以做的了。具有这些产品专业知识的人（IBM 和 CA）不会为您提供从它们迁移出去的工具。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-08T14:24:52.980

我建议使用 Micro Focus将 COBOL 系统原样移动到另一个[平台。](http://www.microfocus.com/products/enterprise/ServerEnterpriseEdition.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2019-09-17T07:55:16.333

Raincode 有一个 COBOL 编译器，它可以理解 CICS 语句并且可以与 DB2、IMS 或 SQL Server 对话。Cobol 代码在 .NET 上编译

# c# - c# - 复制文件路径中的文件夹结构的函数

> ID：438321
> 
> 赞同：20
> 
> 时间：2009-01-13T08:27:23.947
> 
> 标签：c#, filesystems, .net, system.io.directory

我需要一个简单的函数，它将 FileInfo 和 destination_directory_name 作为输入，从 fileinfo 获取文件路径并将其复制到作为第二个参数传递的 destination_directory_name 中。

例如。文件路径是“d:\recordings\location1\client1\job1\file1.ext 如果目录不存在，函数应该在destination_directory_name 中创建目录，并在创建目录后复制文件。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-07-18T10:51:32.963

System.IO.Directory.CreateDirectory 可用于创建最终目录，如果路径下所有文件夹不存在，它也会自动创建。

```
//Will create all three directories (if they do not already exist).
System.IO.Directory.CreateDirectory("C:\\First\\Second\\Third") 
```

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-01-13T08:32:51.690

为此，我使用以下方法：

```
public static void CreateDirectory(DirectoryInfo directory)
{
    if (!directory.Parent.Exists)
        CreateDirectory(directory.Parent);
    directory.Create();
} 
```

以这种方式使用它：

```
// path is your file path
string directory = Path.GetDirectoryName(path);
CreateDirectory(new DirectoryInfo(directory)); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-09-06T03:01:47.350

根据@NTDLS 的回答，这是一种将源复制到目标的方法。它处理源是文件或文件夹的情况。函数名称有点臭......如果你想出一个更好的名字，请告诉我。

```
 /// <summary>
    /// Copies the source to the dest.  Creating any neccessary folders in the destination path as neccessary.
    /// 
    /// For example:
    /// Directory Example:
    /// pSource = C:\somedir\conf and pDest=C:\somedir\backups\USER_TIMESTAMP\somedir\conf   
    /// all files\folders under source will be replicated to destination and any paths in between will be created.
    /// </summary>
    /// <param name="pSource">path to file or directory that you want to copy from</param>
    /// <param name="pDest">path to file or directory that you want to copy to</param>
    /// <param name="pOverwriteDest">if true, files/directories in pDest will be overwritten.</param>
    public static void FileCopyWithReplicate(string pSource, string pDest, bool pOverwriteDest)
    {
        string destDirectory = Path.GetDirectoryName(pDest);
        System.IO.Directory.CreateDirectory(destDirectory);

        if (Directory.Exists(pSource))
        {
            DirectoryCopy(pSource, pDest,pOverwriteDest);
        }
        else
        {
            File.Copy(pSource, pDest, pOverwriteDest);
        }
    }

    // From MSDN Aricle "How to: Copy Directories"
    // Link: http://msdn.microsoft.com/en-us/library/bb762914.aspx
    private static void DirectoryCopy(string sourceDirName, string destDirName, bool copySubDirs)
    {
        DirectoryInfo dir = new DirectoryInfo(sourceDirName);
        DirectoryInfo[] dirs = dir.GetDirectories();

        if (!dir.Exists)
        {
            throw new DirectoryNotFoundException(
                "Source directory does not exist or could not be found: "
                + sourceDirName);
        }

        if (!Directory.Exists(destDirName))
        {
            Directory.CreateDirectory(destDirName);
        }

        FileInfo[] files = dir.GetFiles();
        foreach (FileInfo file in files)
        {
            string temppath = Path.Combine(destDirName, file.Name);
            file.CopyTo(temppath, true);
        }

        if (copySubDirs)
        {
            foreach (DirectoryInfo subdir in dirs)
            {
                string temppath = Path.Combine(destDirName, subdir.Name);
                DirectoryCopy(subdir.FullName, temppath, copySubDirs);
            }
        }
    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-02-18T01:29:20.977

与问题类似，我正在从一个目的地复制文件夹结构并将其复制到另一个目的地。很抱歉发布到旧线程，但它可能对最终在这里的人有用。

假设我们有一个独立的应用程序，我们需要将文件夹结构从 Input 文件夹复制到 Output 文件夹。Input 文件夹和 Output 文件夹位于我们应用程序的根目录中。

我们可以为 Input 文件夹（我们要复制的结构）创建一个 DirectoryInfo，如下所示：

```
DirectoryInfo dirInput = new DirectoryInfo(AppDomain.CurrentDomain.BaseDirectory + "\\Input\\"); 
```

我们的输出文件夹位置可以存储在一个字符串中。

```
string dirOutput = AppDomain.CurrentDomain.BaseDirectory + "\\Output\\"; 
```

这个递归方法应该为我们处理剩下的事情。

```
 public static void ProcessDirectories(DirectoryInfo dirInput, string dirOutput)
    {
        string dirOutputfix = String.Empty;

        foreach (DirectoryInfo di in dirInput.GetDirectories())
        {
            dirOutputfix = dirOutput + "\\" + di.Name);

            if (!Directory.Exists(dirOutputfix))
            {
                try
                {
                    Directory.CreateDirectory(dirOutputfix);
                }
                catch(Exception e)
                {
                    throw (e);
                }
            }

            ProcessDirectories(di, dirOutputfix);
        }
    } 
```

这种方法也可以很容易地修改来处理文件，但我在设计它时只考虑了我的项目的文件夹。

现在我们只需使用 dirInput 和 dirOutput 调用该方法。

```
ProcessDirectories(dirInput, dirOutput); 
```

# .net - 对象构造函数可以返回 null 吗？

> ID：438325
> 
> 赞同：39
> 
> 时间：2009-01-13T08:31:20.770
> 
> 标签：.net, multithreading

我们已经接管了一些 .NET 1.1 Windows 服务代码，这些代码生成线程以从队列中读取消息（SeeBeyond eGate JMS 队列，但这并不重要），进而生成线程以在目标应用程序服务中处理消息。我们不断地遇到让我们困惑不已的逻辑和设计决策。这是一个示例，其中消息 (lsMessage) 已从队列中检索并准备好进行处理

```
if(lsMessage != null)
{
    // Initialize a new thread class instance, pass in message
    WorkerThread worker = new WorkerThread(lsMessage);

Process:
    // Start a new thread to process the message
    Thread targetWorker = new Thread(new ThreadStart(worker.ProcessMessage));
    if(targetWorker != null)
    {
        targetWorker.Priority = ThreadPriority.Highest;
        targetWorker.Name = "Worker " + queueKey.ToString();
        targetWorker.Start();

        // wait for worker thread to join back in specified period
        bool isFinished = targetWorker.Join(SYNC_THREAD_TIMEOUT);

        string message = worker.replyMsg;

        if ( !isFinished )  // BF is timeout
        {
            targetWorker.Abort();

            // [obscure developer name] 25/10/2004: calling Join() to wait for thread to terminate.
            // for EAI listener threads problem, ensure no new thread is started 
            // before the old one ends
            targetWorker.Join();

            // prepare reply message
            string errorMsg = string.Format("EAIMsg {0}: BF is timeout. Send sync message back to caller.", worker.messageKey);
            log.Debug(errorMsg);

            message = worker.GenErrorCode(message, errorMsg);
        }

        // Commit message
        MQ.ReceiverCommit(queueKey, worker.messageKey, false);

        // Send back the response to the caller
        MQ.RespondSend(queueKey, message); 
    } 
    else 
    {
        log.Debug(string.Format("Fail to start worker thread to process sync message. Thread returned is null. Sleep for {0} milliseconds.", LIMIT_RESOURCE_SLEEP));
        Thread.Sleep(LIMIT_RESOURCE_SLEEP);
        goto Process;
    }
} 
```

请暂时忽略*label 和 goto 的使用*；这不是问题所在。我们的困惑是**在实例化之后检查 Thread 对象是否为空**。下面的 else 语句似乎暗示了以前的开发人员以前遇到过这样的情况。当然，最初的开发者早已不复存在。所以我们想知道，CLR真的可以在调用构造函数后实例化一个对象并返回null吗？我们不知道这种可能性。

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-01-13T08:39:11.630

在我看来，该`else`声明表明以前的开发人员不了解他们的 C#。构造函数总是返回构造的对象或抛出异常。

在过去，C++ 构造函数可以返回`null`，所以问题可能来自于此。这在 C++ 中也不再适用，至少对于默认`new`运算符而言。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2009-01-13T08:36:36.237

编辑：为了澄清，有一个*疯狂的边缘情况*，你可以`null`从类构造函数中得到，但坦率地说，我认为任何真正的代码都不应该期望处理这种疯狂程度：[你见过的最奇怪的极端情况是](https://stackoverflow.com/questions/194484/whats-the-strangest-corner-case-youve-seen-in-c-sharp-or-net/194671#194671)*什么*[C# 还是 .NET？](https://stackoverflow.com/questions/194484/whats-the-strangest-corner-case-youve-seen-in-c-sharp-or-net/194671#194671). 对于所有*正常*意图：它不会发生。

* * *

不，您不能从**类**构造函数（`Thread`是一个类）中获取 null。我知道构造函数可以（似乎）返回的唯一情况`null`是`Nullable<T>`- 即

```
object foo = new int?(); // this is null 
```

这是泛型的一个稍大的问题：

```
static void Oops<T>() where T : new() {
    T t = new T();
    if (t == null) throw new InvalidOperationException();
}

static void Main() {
    Oops<int?>();
} 
```

（当然，有一些方法可以检查/处理这种情况，例如`: class`）

除此之外，构造函数总是要么返回一个对象（或初始化一个结构），要么抛出一个异常。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T08:41:10.097

不！那个空检查是多余的。许多迁移到 C# 的 C++ 开发人员都有这种 null 检查的习惯，我想这里也是一样。

唯一的事情是您应该检查文档以查看构造函数是否可以抛出任何异常。在您的情况下，请参阅[http://msdn.microsoft.com/en-us/library/xx3ezzs2.aspx](http://msdn.microsoft.com/en-us/library/xx3ezzs2.aspx)，如前所述，构造函数将始终返回一个有效的 obj。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T03:28:19.313

你可以让它看起来像一个对象ctor返回null：

[http://seattlesoftware.wordpress.com/2008/03/05/returning-null-from-a-class-constructor/](http://seattlesoftware.wordpress.com/2008/03/05/returning-null-from-a-class-constructor/)

搜索“另一种我没有见过的模式允许无效对象模拟空引用”并从那里读取。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2018-02-08T16:30:13.937

如前所述`core`，运算符重载可以使构造函数看起来像返回`null`，而实际上并非如此。发现文章的作者`core`说他们没有看到它被使用，但它实际上被用于一个非常流行的产品：Unity。

这将在运行时编译并记录一条消息：

```
using UnityEngine;

public class Test:MonoBehaviour
{
    void Start()
    {
        AudioSource as = new AudioSource();

        if (as == null)
        {
            Debug.Log("Looks null to me.");
        }
    }
} 
```

现在，这里的错是我的，因为不应该*直接*调用`AudioSource`构造函数。但是*应该*知道，`==`对于 Unity 可以引用的对象，运算符在继承树的根部被重载。以下是 Unity 手册中关于`UnityEngine.Object`'`==`运算符的内容：

> 与 null 比较时要小心。
> 
> 例如
> 
> ```
> GameObject go = new GameObject();
> Debug.Log (go == null); // false
> 
> Object obj = new Object();
> Debug.Log (obj == null); // true 
> ```
> 
> 实例化 GameObject 会将其添加到场景中，因此它已完全初始化（！destroyed）。实例化一个简单的 UnityEngine.Object 没有这样的语义，因此（*原文如此*）它保持在“已销毁”状态，该状态将 true 与 null 进行比较。

实例化 a时会对其进行`GameObject`初始化，而实例化`AudioSource`对象则不会，因此与`null`返回的比较`true`。

由于尝试引用未初始化`AudioSource`对象的属性会引发空引用异常，我最初将其误解为对象引用是`null`，而不是属性，因此这种不寻常的习惯用法变得更加隐蔽。

其他人已经回答了 OP 的问题，但我想添加这个答案，因为如果其中的类不是我们期望的类，那么 OP 的代码实际上可能有意义`Thread`，就像`Object`（及其后代）不太一样您可能希望它位于 Unity 脚本中（也就是说，它实际上是`UnityEngine.Object`，而不是，这让您得到了让我很困惑`System.Object`的重载运算符）。`==`

# java - 读取另一个进程正在写入的文件的最佳（影响最小？）方法是什么？

> ID：438327
> 
> 赞同：1
> 
> 时间：2009-01-13T08:32:29.507
> 
> 标签：java, file-io

我正在寻找影响最小的方法来读取几个不同的日志文件。“影响最小”是指读取不会影响日志轮换，不会导致过度的 I/O 活动等。我希望用 Java 来实现这一点......

Google 为我提供了以下一小段代码：

```
FileStream fs = new FileStream("C:\foo.txt",
FileMode.Open,FileAccess.Read, FileShare.ReadWrite); 
```

这应该是微不足道的实现，但是，我不太确定我的 Java“剪切和粘贴”能力，并且想知道是否有更好的方法来做到这一点。这里的大图是拖曳一些 apache 和 tomcat 日志，根据应用程序活动寻找一些关键条目，并根据条目采取一些行动。无论如何，任何提示？谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T08:40:49.020

从[这里选择一个](https://stackoverflow.com/questions/326390/)

:)

我还没有全部尝试过，但是 Jon Skeet 对如何不这样做有一些有用的评论。

我的赌注是[蔚](https://stackoverflow.com/questions/326390/how-to-create-a-java-string-from-the-contents-of-a-file#326440)来的。

```
 FileInputStream stream = new FileInputStream(new File(path));
  try {
    FileChannel fc = stream.getChannel();
    MappedByteBuffer bb = fc.map(FileChannel.MapMode.READ_ONLY, 0, fc.size());
    /* Instead of using default, pass in a decoder. */
    return CharSet.defaultCharset().decode(bb).toString();
  }
  finally {
    stream.close();
  } 
```

请参阅该问题中的详细信息。

# javascript - 如何使用 JavaScript 获取 SharePoint-UserField？

> ID：438332
> 
> 赞同：1
> 
> 时间：2009-01-13T08:35:27.720
> 
> 标签：javascript, sharepoint

你好，

我需要编写一些 javascript 来获取共享点网站中用户字段的内容。[我可以使用 Using Javascript to Manipulate a List Form Field](http://blogs.msdn.com/sharepointdesigner/archive/2007/06/13/using-javascript-to-manipulate-a-list-form-field.aspx)的 javascript-function 'getTagFromIdentifierAndTitle' 获取大多数字段，但不是 UserFields。

那么我怎样才能获得 UserFields 呢？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T20:14:57.823

我跟踪了地址簿如何与用户字段交互。要获取值，它使用函数 getUplevel(ctx) 并设置值可以使用函数 EntityEditorCallback(xml, ctx)。第一个函数将返回带有用户信息的 html/xml 混合字符串。第二个函数输入必须是特殊格式的 xml 字符串。

```
// Get values
var ctx='ctl00_m_g_e5a1501a_..._ctl04_ctl00_ctl00_UserField';
var values=getUplevel(ctx);
alert(values);

// Set values
var xml='<Entities Append="False" Error="" Separator=";" MaxHeight="3">'+
    '<Entity Key="DOMAIN\\loginname" DisplayText="Display Name" IsResolved="True" Description="DOMAIN\\loginname">'+
        '<ExtraData>'+
            '<ArrayOfDictionaryEntry xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">'+
                '<DictionaryEntry><Key xsi:type="xsd:string">DisplayName</Key><Value xsi:type="xsd:string">Display Name</Value></DictionaryEntry>'+
                '<DictionaryEntry><Key xsi:type="xsd:string">Email</Key><Value xsi:type="xsd:string">Display.Name@domain.ee</Value></DictionaryEntry>'+
                '<DictionaryEntry><Key xsi:type="xsd:string">SPUserID</Key><Value xsi:type="xsd:string">1</Value></DictionaryEntry>'+
                '<DictionaryEntry><Key xsi:type="xsd:string">PrincipalType</Key><Value xsi:type="xsd:string">User</Value></DictionaryEntry>'+
            '</ArrayOfDictionaryEntry>'+
        '</ExtraData>'+
        '<MultipleMatches />'+
    '</Entity>'+
'</Entities>';
EntityEditorCallback(xml,ctx); 
```

棘手的部分是 ctx 属性，它必须是目标字段 id。在用户字段html中没有title属性，所以用js通过显示名称找到正确的元素是非常复杂的。我建议将字段 id 从服务器端传递给 javascript。例如，您可以创建自定义 WebPart，您可以在其中从集合 SPContext.Current.FormContext.FieldControlCollection 写入页面字段 id-s。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-24T17:55:51.863

这是我放在一起的自定义代码。它依赖于 SharePoint 用于 PeoplePicker 的确切 HTML。它确实适用于 IE 和 Firefox。对于 columnName 参数，传递列的“公共”名称，而不是内部名称。

```
function getParentElementByTagName(baseNode, tagName)
{
  var currNode;

  if(baseNode !== null)
  {
    currNode = baseNode.parentNode;

    while((currNode !== null) && (currNode.nodeName != tagName))
    {
      currNode = currNode.parentNode;
    }

    return currNode;
  }
  else
  {
    return null;
  }
}

function getPeoplePickerCell(columnName)
{
  var search = 'FieldName="' + columnName + '"';

  var nodes = document.getElementsByTagName("TEXTAREA");

  for(var i=0; i < nodes.length; i++)
  {
    if(nodes[i].title == "People Picker")
    {
      var outerCell = getParentElementByTagName(nodes[i], "SPAN").parentNode.parentNode;

      if(outerCell.innerHTML.indexOf(search) > 0)
      {
        return nodes[i].parentNode;
      } 
    }
  }

  return null;
}

function getSPPeoplePicker(columnName, value)
{
  var cell = getPeoplePickerCell(columnName);

  if(cell !== null)
  {
    return cell.childNodes[0].innerHTML;
  }
  else
  {
    return null;
  }
}

function setSPPeoplePicker(columnName, value)
{
  var cell = getPeoplePickerCell(columnName);

  if(cell !== null)
  {
    cell.childNodes[0].innerHTML = value;
    cell.childNodes[1].value = value;
  }
}

function disableSPPeoplePicker(columnName)
{
  var cell = getPeoplePickerCell(columnName);

  if(cell !== null)
  {
    disableElement(cell.childNodes[0]);
    disableElement(cell.childNodes[1]);
  }
}

function enableSPPeoplePicker(columnName)
{
  var cell = getPeoplePickerCell(columnName);

  if(cell !== null)
  {
    enableElement(cell.childNodes[0]);
    enableElement(cell.childNodes[1]);
  }
} 
```

# c# - 如何在 GDI+ 中对具有真实形状测量（英寸）的旋转形状进行命中测试？

> ID：438335
> 
> 赞同：4
> 
> 时间：2009-01-13T08:36:55.253
> 
> 标签：c#, winforms, math, gdi+, mouse

鉴于我有一个包含许多形状的画布，现在让我们说矩形。

每个形状都有一个位置（英寸）、大小（英寸）和旋转角度（度）。

当鼠标单击事件发生在画布内时，位置 (x,y) 以像素为单位。

考虑到旋转角度和测量单位转换，我想检查单击的鼠标位置是否在特定形状内/内。

你能帮我吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T09:30:42.930

您的问题非常缺乏细节，我只能提供一个通用的答案。用数学方法做是最快的方法。旋转会使这变得困难。

您可以使用命中测试位图缓慢但轻松地解决它。使用您现在用于将形状渲染到屏幕的相同代码将形状渲染到位图。但现在使用编码形状编号的颜色。命中测试现在使用 GetPixel() 变得简单快捷。小心关闭图像增强设置，如抗锯齿。首先将其渲染到屏幕上，然后使用 ZoomIt 仔细查看像素。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-18T10:21:28.933

我找到了答案（我必须将所有测量值转换为像素以确保它能够正确计算）：

```
public static bool HitTest(Rectangle bounds, float angle, Point location)
        {
            if (angle == 0) return bounds.Contains(location);

            using (Matrix matrix = new Matrix())
            {
                matrix.RotateAt(angle, Center(bounds));
                using (GraphicsPath path = new GraphicsPath())
                {
                    path.AddRectangle(bounds);
                    path.Transform(matrix);
                    return path.IsVisible(location.X, location.Y);
                }
            }
        } 
```

# c# - `using` 指令的位置对 C# 有影响吗？

> ID：438336
> 
> 赞同：5
> 
> 时间：2009-01-13T08:37:36.343
> 
> 标签：c#, syntax

我今天在尝试对现有代码进行一些格式化时遇到错误。最初，代码`using`在命名空间之外声明了指令：

```
using System.Collections.Generic;
namespace MyNamespace
{
    using IntPair = KeyValuePair<int, int>;
} 
```

当我尝试`using`在语句中插入指令时（以符合 StyleCop 的规则），我在别名指令中遇到错误，我必须完全限定它：

```
namespace MyNamespace
{
    using System.Collections.Generic;
    //using IntPair = KeyValuePair<int, int>;   // Error!
    using IntPair = System.Collections.Generic.KeyValuePair<int, int>; // works
} 
```

我想知道这两种情况有什么区别？(import-style)`using`指令的位置是否重要？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-13T08:41:08.410

我曾经认为这无关紧要，但我总是完全符合使用命令的条件。

编辑：检查了[C# 规范](http://msdn.microsoft.com/en-us/vcsharp/aa336809.aspx)，第 9.4 节说：

> using-directive 的范围特别不包括其对等 using-directives。因此，peer using-directives 不会相互影响，并且它们的写入顺序无关紧要。

因此，如果 System.Collections.Generic 和 KeyValuePair 被视为对等点，那么 KeyValuePair 将忽略 System.Collections.Generic。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-13T08:41:57.740

是的，它确实 - 在很小的程度上。有一个与范围/本地名称有关的极端情况，请参阅[Eric Lippert 的博客](http://blogs.msdn.com/ericlippert/archive/2007/06/25/inside-or-outside.aspx)。

对于一个具体示例（特定于别名用法）：

```
using System;
using Foo = Bar;
public static class Bar {
    public  static void Test() { Console.WriteLine("outer"); }
}
namespace MyNamespace {
    //using Foo = Bar;

    public static class Bar {
        public static void Test() { Console.WriteLine("inner"); }
    }
    static class Program {
        static void Main() {
            Foo.Test();
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T08:51:39.950

是的，我有一个类似[问题（命名空间冲突）的](https://stackoverflow.com/questions/262469/namespace-collisions)[工作示例](https://stackoverflow.com/questions/262469/namespace-collisions#262813)。

本质上，如果 using 指令是全局的（在命名空间之外）或在命名空间内部（当它具有更高优先级时），则名称查找的规则是不同的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T09:11:56.993

这纯粹是信息性的，是声称它会影响程序集加载时间的回复之一；但实际上，程序集是在第一次使用它们的方法/类型被 JITted（或通过反射等访问）时加载的。

这是一个示例，表明它没有区别；在`using`任一位置，输出都是相同的：`System.Core`被加载为`Bar`获得 JITted：

```
pre-Bar
System.Core, Version=3.5.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089
System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089
pre-Max
Max: 5
post-Max
post-Bar 
```

示例（在命令行中运行，而不是在调试器中；理想情况下在发布配置中）：

```
using System;
//using System.Linq;
namespace Foo {
    using System.Linq;
    class Program {
        static Program() {
            AppDomain.CurrentDomain.AssemblyLoad += (s, a) => {
                Console.WriteLine(a.LoadedAssembly.FullName);
            };
        }
        static void Main() {            
            Console.WriteLine("pre-Bar");
            Bar();
            Console.WriteLine("post-Bar");
            Console.ReadLine();
        }
        static void Bar() {
            Console.WriteLine("pre-Max");
            int[] data = { 1, 2, 3, 4, 5 };
            Console.WriteLine("Max: " + Enumerable.Max(data));
            Console.WriteLine("post-Max");
        }
    }
} 
```

# c# - 在 DirectX 中对 Device.Reset 的第二次调用会引发 InvalidCallException

> ID：438347
> 
> 赞同：3
> 
> 时间：2009-01-13T08:43:11.823
> 
> 标签：c#, .net, directx

我一直在用 C# 编写 DirectX 应用程序，我注意到当我锁定工作站时，DirectX“设备”会丢失。在查找了有关设备丢失时（以及当 a`DeviceLostException`被 抛出时`Device.Present`）如何处理的信息后，我重新编写了代码以重置`Device`. 这仅仅意味着我打电话给`Device.Reset`.

呼叫`Device.Reset`恢复了`Device`. 没问题。但是当我第二次丢失设备时（例如，当计算机被锁定、进入睡眠状态或激活屏幕保护程序时）`Device.Reset`，.

例外是`InvalidCallException`，这（根据文档）意味着调用出现问题。所以我认为这是函数参数的问题。因此，我没有传递用于创建设备的相同副本`PresentParams`，而是创建了一个 PresentParams 的新实例（首先使用复制构造函数，后来在没有它的情况下重新创建）并将其传递给`Device.Reset`.

不工作。`Device.Reset`仍然与`InvalidCallException`. 哦，异常的消息？“申请错误。” 没有帮助。

您能否指出解决方案的方向，或一些有关如何从 DirectX 中获取更多调试信息的文档？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-19T07:42:34.427

好的，我知道回答我自己的问题似乎很愚蠢，但我认为其他人可能需要这个，嗯？

**答案是**：场景中s的`Dispose`方法调用太多了。`VertexBuffer`原因是内部`Device`重置处理程序正在调用该`Dispose`方法。为什么会这样？因为我忽略了阅读有关池枚举的 .NET DirectX SDK 文档，并且`VertexBuffer`使用 s`Pool.Default`而不是`Pool.Managed`.

所以很明显，在几千次糟糕的分配和释放周期之后，出现了问题。

*哦，我是怎么发现这个的？我附加了一个监听器，`VertexBuffer.Dispose`它增加了我在屏幕上显示的计数器。想象一下，当我注意到这个计数器在我调整窗口大小时不断增长时，我会感到惊讶！*

# svn - 从 subversion 推送到 web 服务器

> ID：438348
> 
> 赞同：20
> 
> 时间：2009-01-13T08:43:43.040
> 
> 标签：svn, version-control, ssh

很久以前，我试图在本地、Web 服务器和颠覆之间整理我的系统。我对[这个问题](https://stackoverflow.com/questions/248769/php-ide-want-to-sync-local-storage-with-ftp)有一些很好的解释。

不幸的是，我在从 SVN 到 Web 服务器部分的整个推动过程中遇到了障碍，并且从未重新访问过。我所有的项目都是单独的，所以我是唯一一个开发它们的人，而且通常我是唯一的用户。所以我大部分时间都可以直接写到实时服务器上。

在 2009 年，我想改掉这个坏习惯，真正以正确的方式做事。我可以通过 SSH 访问我的 Web 服务器（我可以登录并浏览文件），但我真的不知道该怎么做才能将最新的文件从 SVN 中获取到服务器中。

我已经用谷歌搜索了我的手指，但我发现的所有东西都需要一些我还没有的知识。

我真的非常感谢逐步指导如何将我的代码的最新版本从 SVN 存储库自动推送到实时 Web 服务器。仅供参考，我目前正在使用 Beanstalk 进行 Subversion 托管，但如果有人有更好的建议，我完全愿意改变它。

谢谢

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-01-13T09:00:32.367

如果你有 SSH 访问权限，你可以这样做：

> svn export [url to repo] [web 目录]

导出意味着您不会得到工作副本附带的 .svn 包袱。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-13T08:49:25.400

简单 - 登录到您的服务器机器并签出存储库内容。这应该只做一次。

```
$ svn checkout [http|svn|whatever_you_got_there]://{your_svn_repo} {checkout_directory} 
```

每次您需要使用最新的工作副本更新工作副本时，请执行`update`：

```
$ cd {checkout_directory}
$ svn update 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T08:58:32.150

发布管理

您可以创建一个将 svn 导出到本地文件夹的作业/批处理。导出后，您可以使用 rsync 上传它。

该作业可以由 svn 挂钩自动执行。

您也可以使用 mtod 方式，但请记住：如果有人可以访问 .svn 文件夹，则在服务器上使用结帐存在安全风险！他们可以访问 php 代码并查看密码或错误。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T09:03:46.323

除非您的托管公司允许您访问其中一个`cron(1)`或一个 shell，否则这将是困难的，因为 svn 是一个集中式 VCS，没有办法将内容推送到工作目录，您应该这样做`svn update`。

根据上述可用资源，有几种方法可以做你想做的事：

1.  定义一个`crontab(5)`条目`cd $WEBSITE && svn update`
2.  使用 ssh 连接到您的网站并执行相同的命令。`ssh`可以通过`crontab`您身边的条目自动执行。
3.  在您的网站上有一个特殊的 cgi，希望受密码保护，可以定期运行（从`cron`您这边）执行相同的命令。

对我来说最好的方法仍然是转向去中心化的 VCS（如 Mercurial 或 git），但这是一个更大的项目。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T22:09:43.507

前段时间我有一个类似的[问题，但是我没有 SSH 访问我的服务器，所以我的选择非常有限。](https://stackoverflow.com/questions/203050/best-way-of-doing-an-svn-checkout-update-on-a-web-hosting-package)

根据项目的大小，您可能会考虑不进行导出。在我的情况下，该项目是在一个数据的演出！不切实际，因为通过导出，您需要一遍又一遍地导出所有文件。如果您只有一手文件，那可能会有所不同。此外，在您的本地机器上进行导出意味着导出需要先下载文件，然后将其上传到您的主机，这就像浪费带宽一样。

另请记住，执行 SVN 导出不会执行任何数据库更新。例如，当您开发站点时，您的数据库可能会多次更改。仅使用 SVN 导出，您仍然需要手动重新导入服务器上的数据库。

我建议您编写一个放置在服务器上的脚本。当然，您可以根据需要将此脚本制作得尽可能详细，但裸露的脚本会在您网站的签出版本上进行“更新”，将您的数据库导出到临时文件夹中（您的数据库当然也放置在在版本控制下）并重新导入数据库（或合并它，无论它需要做什么）。使用一个命令，您就可以部署您的站点。一而再，再而三。

有一些工具可以帮助您实现这种自动化，例如[CruiseControl](http://cruisecontrol.sourceforge.net/)和[Capistrano](http://www.capify.org/)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-22T21:38:24.537

您是否尝试过在 Beanstalk 上使用我们的 FTP 部署？我们还提供了可用的网络挂钩，这意味着您可以在每次提交时 ping 一个 URL 来编写自己的代码。

[http://help.beanstalkapp.com/articles/17-deployment-and-releases](http://help.beanstalkapp.com/articles/17-deployment-and-releases)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-07-11T21:28:44.147

你说'自动推送'。这可以通过提交后挂钩来完成。我一直是一名单人开发团队，并为 PHP 开发人员使用了这样的设置：

VPS LAMP 堆栈与 Apache 的 mod_dav_svn 处理 SVN 职责托管站点的“登台”版本。该站点的“暂存”版本实际上是一个工作副本，只是在本地签出到 Apache 可以从中提供服务的目录

运行 NetBeans 和 LAMP 堆栈的本地 VMware 机器，安装了用于调试 PHP 的 xdebug

我的工作流程是这样的：

检查从我的 VPS 到我的 VMware 虚拟机的工作副本通过 PhpMyAdmin 从 VPS 获取数据库转储并导入到虚拟机上的 MySQL 开发我的屁股关闭，所有在本地结束或一天，导出我的数据库并将其上传到 MySQL VPS 将我的更改提交到 VPS

症结是提交后的钩子——它只是一个 SVN 中的文本文件，在每次提交事件之后都会被解析。您让它调用一个 shell 脚本，并且该 shell 脚本执行“svn update”来更新工作副本，该工作副本是 Apache 正在服务的登台站点。

我想您可以轻松地让 shell 脚本将 SVN 导出到您的暂存目录，但这可能需要一段时间才能运行，而对工作副本的更新只会进行更改。

这些笔记非常夸张，但它们是我在设置此类内容时使用的个人备忘单：

[http://random.siliconrockstar.com/dev_ShellScriptingAndNixAdmin/SVN.txt](http://random.siliconrockstar.com/dev_ShellScriptingAndNixAdmin/SVN.txt)

如果您愿意，我还有一份配置了 NetBeans 的 VM 副本，用于开发，我曾经将它们分发给初级开发人员。如果你想要一份副本，只需 PM 我。

# asp.net - asp.net：从会话变量转移到 cookie

> ID：438360
> 
> 赞同：0
> 
> 时间：2009-01-13T08:48:17.010
> 
> 标签：asp.net

我的表单在共享主机（webhost4life）上很快丢失了会话变量，我想我想用 cookie 替换它们。对于从表单到表单跟踪 ID，以下内容是否合理：

```
if(Request.Cookies["currentForm"] == null)
   return;
projectID = new Guid(Request.Cookies["currentForm"]["selectedProjectID"]);
Response.Cookies["currentForm"]["selectedProjectID"] = Request.Cookies["currentForm"]["selectedProjectID"]; 
```

请注意，在读取请求 cookie 后，我正在以所有形式设置响应 cookie。这是必要的吗？请求 cookie 会自动复制到响应吗？

我没有在 cookie 上设置任何属性并以这种方式创建它们：

```
Response.Cookies["currentForm"]["selectedProjectID"] = someGuid.ToString(); 
```

目的是这些是临时标头 cookie，不会比浏览器会话更长时间地保留在客户端上。我问这个是因为我不经常写网站。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T09:39:12.913

在更改任何代码之前，我会调查会话变量消失的原因。

也许就像更改 web.config 中的超时设置一样简单？

以下是配置文件中的会话状态设置列表：[MSDN 上的会话元素](http://msdn.microsoft.com/en-us/library/h6bb9cz9.aspx)

==================================================== ==

哦，是的，与您的评论有关的另一件事是：

如果我没记错的话，我们过去在部署到同一服务器上的多个网站会“冲突”的网络花园/农场时遇到了一些问题。为了解决这个问题，我们明确地将 cookie 命名为：

```
<authentication mode="Forms" >
    <forms loginUrl="your-login-page.aspx" 
        cookieless="AutoDetect" 
        name=".A-NAME-WHICH-IS-UNIQUE" /> 
</authentication> 
```

名称：可选属性。指定用于身份验证的 HTTP cookie。如果多个应用程序在单个服务器上运行并且每个应用程序都需要一个唯一的 cookie，则必须在每个 Web.config 文件中为每个应用程序配置 cookie 名称。

默认值为“.ASPXAUTH”。从这里[链接文本](http://msdn.microsoft.com/en-us/library/1d3t3c61.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T08:30:39.213

The research I've done into cookies suggests they would not be a desirable alternative to session variables. Browsers enforce arbitrary limits on the number of cookies that can exist at any one time as well as the number per site. They are also prone to being dropped randomly.

You can enable cookieless sessions. There are some [potential issues](http://msdn.microsoft.com/en-us/library/aa479314.aspx) but it might work for your site.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T09:56:25.483

我同意之前的回答，您应该先调查会话超时！

但是关于cookie：请求cookie是从客户端发送到服务器的cookie，响应cookie是从服务器发送的cookie，告诉客户端将它们保存在本地并将它们附加到下一个，直到cookie过期，请求到服务器。

Cookies 有大小限制，因为它们的行为会对服务器和客户端之间发送的请求数据产生开销，当然也可以在客户端禁用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T16:46:30.367

我怀疑您可能丢失会话变量的原因是您的应用程序正在网络花园中运行。这意味着两个或多个进程正在运行您的应用程序。

在您的 web.config 中应该有 sessionState 标签。如果 mode="InProc" 然后尝试设置 mode="StateServer"。这将导致托管您的应用程序的所有进程使用会话状态服务器来存储会话状态元素。还要检查前面提到的超时。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T09:47:31.303

在回答您关于将 cookie 从请求复制到响应的问题时，不，这不是必需的。

创建 cookie 后，它可以根据您的需要持续存在。

如果它只是在会话期间需要，那么不要对 Expires 属性进行任何设置。在这种情况下，cookie 将保存在浏览器内存中，并随着对您网站的每个请求提供，直到浏览器关闭。

如果要在会话之间持续存在，请针对 Expires 属性设置适当的 DateTime 值。在这种情况下，cookie 将作为文件写入客户端计算机上，并随着对您网站的每个请求继续提供服务，直到达到到期日期或将其删除。

当然，请注意客户端可以在其浏览器中禁用 cookie。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-13T09:48:22.923

不，您不必在响应中不断重置 cookie。

一旦设置该 cookie 将继续与每个后续请求一起发送。

但是我同意 Dominic 的观点，您应该首先确定您无法维持会话的原因。

一些原因是：-

*   主机正在使用不支持会话关联的网络花园或负载均衡器
*   主机上有一个激进的会话超时设置
*   主机出现问题，频繁回收应用池
*   您的客户端的 cookie 设置过于严格并且拒绝所有 cookie（但这意味着您的替代解决方案也不起作用）
*   应用程序逻辑可能错误导致 Session.Abandon 或 Session.Clear 不应该。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-03-26T11:21:38.583

您可以考虑使用这个小库：

[http://www.codeproject.com/KB/aspnet/Univar.aspx](http://www.codeproject.com/KB/aspnet/Univar.aspx)

只要cookie不可用，它就可以自动切换到会话。它还具有 cookie 的服务器端实现，其中所有 cookie 都存储在服务器上，并且可以使用 asp.net 身份验证来识别用户。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-03-16T09:52:51.457

直到两个月前，我还是 webhost4life 的客户，我遇到的问题是应用程序池经常被回收——可能是因为主机出现了某种问题。最后，我搬到了一个 VPS 并且再也没有回头（也不是 webhost4life VPS）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-03-16T10:01:29.790

对于**共享托管**，最好的方法是使用[SQL Session State](http://idunno.org/articles/277.aspx)。

它有点慢，但更可靠。

以前我**也遇到过同样的问题，**而且我的内存会话总是被删除，这是因为同一托管环境中的某个人不知道如何完成刺痛，而 IIS 只是重置了应用程序池，或者它甚至可以通过自动完成从 Hosting 的角度刷新 AppPool（所以没有网站会挂起）。

自从我开始使用 SQL 状态......**我必须说哇**！

您可以**完全控制一切**，甚至设置超时（内存会话由机器配置设置，无论您在代码或 Web 配置中设置什么，您都不会覆盖该设置）

并且您**获得了一些新**的东西，如果您更改代码，您的用户将无需离开网站再次重新登录，因为他们将从现有会话继续。

设置它[相当容易](http://support.microsoft.com/kb/317604)，并且您有大量关于如何完成此类行为的示例。

> 无论您做什么，都不要使用 cookie，因为它们不可靠！

# svn - 在不更新整个文件夹的情况下将新文件添加到 subversion

> ID：438377
> 
> 赞同：9
> 
> 时间：2009-01-13T09:00:11.040
> 
> 标签：svn, tortoisesvn, visualsvn

我想要做的是能够将一个文件添加到我的文件夹中，该文件夹在我的本地计算机的 Subversion 源代码控制下，然后提交。到这里没问题。在服务器上，我想使用 Subversion 获取新文件，但不必对整个文件夹进行“更新”（这可能会更新一堆不相关的文件）。

你看，如果我对现有文件进行更改 - 我会转到服务器标记该文件并执行“S​​VN 更新”（使用 TortoiseSVN），但如果我在本地计算机上添加了一个新文件，我无法获得它到服务器而不对整个文件夹执行“SVN 更新”

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-13T09:05:44.180

`svn up`即使文件夹中尚不存在该文件（只要它存在于存储库中），您也可以向命令添加文件名：

```
svn up newFile.txt 
```

编辑：使用 TortoiseSVN 我*想*你去“检查修改”然后单击“检查存储库”，然后右键单击 - >“更新”新文件。

# .net - 什么会导致 .NET 进程/线程意外终止？

> ID：438380
> 
> 赞同：0
> 
> 时间：2009-01-13T09:01:44.000
> 
> 标签：.net, multithreading, process, terminate, abort

我正在尝试收集 .NET 进程或线程终止原因的完整列表，即使 main() 方法由 try...catch 子句保护。

其中一个原因是 Thread.Abort()（除非您调用 Thread.ResetAbort）。你知道更多的原因吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T09:12:11.283

您的代码无法处理 StackOverflowException。

当您有一个无限循环时，通常会发生 StackOverflowException，这让您的调用堆栈增长直到超过通常的堆栈大小 (1MB)。

还有更多您无法恢复的例外情况。[ExecutionEngineException](http://weblogs.asp.net/tgraham/archive/2004/06/07/150225.aspx)似乎就是其中之一。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T09:15:59.450

与 C/C++ 不同，main() 并不是应用程序的全部。因此，即使使用 try/catch 块包围 main() 中的所有代码也不会捕获该代码生成的所有异常。

但是，您可以通过侦听 Application.ThreadException 事件附加一个函数来处理整个应用程序抛出的未处理异常，这将帮助您从应用程序中的任何线程捕获异常，无论它是否由您的代码创建。

例如，您的代码可能会调用外部非托管 DLL 中的代码。该代码可能会执行自己的线程，这可能会异步失败，从而引发异常。该异常属于您的应用程序的进程，但不属于您的任何代码。如果未被捕获，将导致您的程序意外终止。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T09:06:32.137

也许你的线程中发生了一个未处理的异常，最终杀死了线程；在你的主线程中有一个 try catch 子句不会从另一个正在运行的线程中捕获和异常。

编辑：共享字段的读/写中的一些并发访问

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T09:07:26.423

网络连接超时。

停电。

用户正在终止相关进程。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T09:24:43.813

卸载 AppDomain

# ios - 自定义标签栏上的更多菜单

> ID：438381
> 
> 赞同：20
> 
> 时间：2009-01-13T09:02:06.077
> 
> 标签：ios, iphone, uitabbarcontroller

我在我的应用程序上使用标签栏 (UITabBarController)，我希望自定义单击更多按钮时出现的表格的外观。我已经研究出如何通过设置更改更多屏幕上导航栏的外观

```
self.moreNavigationController.navigationBar.barStyle 
```

在 UITabBarController 的子类中，我设法通过修改来更改表格的背景颜色

```
self.moreNavigationController.topViewController.view.backgroundColor 
```

，但我不知道如何更改表格上出现的单元格中的字体颜色。我希望我可以使用

```
self.moreNavigationController.topViewController.view.visibleCells 
```

但这似乎总是空的。我试过在 viewDidLoad、viewWillAppear 和 viewDidAppear 中这样做，但没有成功。对象 self.moreNavigationController.topViewController 的类型是 UIMoreListController，它似乎没有记录，我在界面中看不到任何对我有帮助的明显内容。

有任何想法吗？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-01-13T17:01:21.100

继 Stephan 建议替换 moreNavigationController 的 dataSource 之后，这里是我实现的代码的快速概览。

我创建了一个名为 MoreTableViewDataSource 的新类，它实现了 UITableViewDataSource 协议。更多页面实际用于构建表的控制器称为 UIMoreListControllerModern，它只实现了 UITableViewDataSource 协议的必需部分。我的实现看起来像这样。

```
-(MoreTableViewDataSource *) initWithDataSource:(id<UITableViewDataSource>) dataSource
{
    self = [super init];
    if (self)
    {
            self.originalDataSource = dataSource;
    }

    return self;
}

- (void)dealloc
{
    self.originalDataSource = nil;
    [super dealloc];
}

- (NSInteger)tableView:(UITableView *)table numberOfRowsInSection:(NSInteger)section
{
    return [originalDataSource tableView:table numberOfRowsInSection:section];
}

- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath
{
    UITableViewCell *cell = [originalDataSource tableView:tableView cellForRowAtIndexPath:indexPath];
    cell.textColor = [UIColor whiteColor];
    return cell;
} 
```

然后在我的 CustomTabBarController 类中我覆盖 viewDidLoad 如下：

```
- (void)viewDidLoad {

    [super viewDidLoad];

    UINavigationController *moreController = self.moreNavigationController;
    moreController.navigationBar.barStyle = UIBarStyleBlackOpaque;

    if ([moreController.topViewController.view isKindOfClass:[UITableView class]])
    {

        UITableView *view = (UITableView *)moreController.topViewController.view;
        view.backgroundColor = [UIColor blackColor];
        moreTableViewDataSource = [[MoreTableViewDataSource alloc] initWithDataSource:view.dataSource];
        view.dataSource = moreTableViewDataSource;

    }
} 
```

这里要求的是头文件

```
@interface MoreTableViewDataSource : NSObject <UITableViewDataSource>
{
    id<UITableViewDataSource> originalDataSource;
}

@property (retain) id<UITableViewDataSource> originalDataSource;

-(MoreTableViewDataSource *) initWithDataSource:(id<UITableViewDataSource>) dataSource;

@end 
```

和

```
#import "MoreTableViewDataSource.h"

@interface CustomTabBarController : UITabBarController 
{
    MoreTableViewDataSource *moreTableViewDataSource;
} 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-01-13T10:13:09.847

仅在显示 moreNavigationController 后才会填充 visibleCells。

并且单元格是在运行时创建的，因此即使您更改了单元格的内容，它们也会在显示时被替换。

要尝试的一件事是替换 moreNavigationController tableView 的数据源，调用原始数据源的 cellForRowAtIndexPath 并在返回之前更改其内容。

使用下面的代码，在显示一次 moreNavigationController 对其进行初始化后，您会看到当您返回 moreNavigationController 时，单元格是红色的，但会立即返回白色背景。

```
UITableView *view = (UITableView *)self.tabBarController.moreNavigationController.topViewController.view;
if ([[view subviews] count]) {
  for (UITableViewCell *cell in [view visibleCells]) {
    cell.backgroundColor = [UIColor redColor];
  }
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2016-04-11T10:49:55.597

感谢**未知**。按照他的解决方案，我会将他的代码放在 Swift 中。只有你应该做的更多是创建 MoreTableViewCell 类和它。您不必使用情节提要。如果要修改 tableView，可以在 customizeMoreTableView 方法中进行。

```
class TabBarMenuController: UITabBarController, UITableViewDelegate, UITableViewDataSource{

var tabBarItems: [UIViewController] = []
var areMessagesVisible: Bool = false

var titleForTabBars: [String] = ["resources", "events", "training", "my profile", "news", "contacts"]
var iconNames: [String] = ["film", "calendar", "classroom", "profile", "news", "Phone"]
var controllersStoryboardId: [String] = ["resourcesNavController", "eventsNavController", "enablementNavController", "profileNavController", "newsNavController", "contactsNavController"]

// to manage moreTableView
var moreTableView: UITableView = UITableView()
var currentTableViewDelegate: UITableViewDelegate?

override func viewDidLoad() {
    super.viewDidLoad()

    self.customizeMoreTableView()
    //to REMOVE
    areMessagesVisible = true

    if !areMessagesVisible{
        self.titleForTabBars.removeAtIndex(4)
        self.controllersStoryboardId.removeAtIndex(4)
        self.iconNames.removeAtIndex(4)
    }

    for i in 0 ..< controllersStoryboardId.count{
        tabBarItems.append(UIStoryboard(name: "Main", bundle: NSBundle.mainBundle()).instantiateViewControllerWithIdentifier(controllersStoryboardId[i]) as? UINavigationController ?? UINavigationController())
    }
    self.moreNavigationController.navigationBar.tintColor = UIColor.blackColor()
}

override func viewWillAppear(animated: Bool) {

    for i in 0 ..< tabBarItems.count{
        tabBarItems[i].tabBarItem = UITabBarItem(title: titleForTabBars[i], image: UIImage(named: iconNames[i]), selectedImage: UIImage(named: iconNames[i]))
    }
    self.viewControllers = tabBarItems
}

func customizeMoreTableView(){
    moreTableView = self.moreNavigationController.topViewController!.view as? UITableView ?? UITableView()
    currentTableViewDelegate = moreTableView.delegate;
    moreTableView.delegate = self
    moreTableView.dataSource = self;
    moreTableView.registerClass(MoreTableViewCell.self, forCellReuseIdentifier: "MoreTableViewCell")

}

func tableView(tableView: UITableView, cellForRowAtIndexPath indexPath: NSIndexPath) -> UITableViewCell {

    let moreCell  = tableView.dequeueReusableCellWithIdentifier("MoreTableViewCell", forIndexPath: indexPath) as? MoreTableViewCell ?? MoreTableViewCell()

    moreCell.textLabel?.text = titleForTabBars[indexPath.row + 4]
    moreCell.imageView?.image = UIImage(named: iconNames[indexPath.row + 4])

    /*let testLabel: UILabel = UILabel(frame: CGRect(x: 0, y: 0, width: 100, height: 40))
    testLabel.backgroundColor = UIColor.yellowColor()
    moreCell.addSubview(testLabel)
    */
    return moreCell
}
func tableView(tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
    return titleForTabBars.count - 4
}

func tableView(tableView: UITableView, didSelectRowAtIndexPath indexPath: NSIndexPath) {
    currentTableViewDelegate?.tableView!(tableView, didSelectRowAtIndexPath: indexPath)
}

 } 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-01-26T23:26:44.820

我按照 Ian 的实现来自定义“更多”菜单，但在出现内存警告后保留自定义设置时遇到了问题。didReceiveMemoryWarning 似乎破坏了 UITableView，当它重新生成时，它会恢复它的旧数据源。这是我的解决方案：

我将 CustomTabBarController 上的 viewDidLoad 替换为：

```
- (void)viewDidLoad {
    [super viewDidLoad];
    UINavigationController* moreController = self.moreNavigationController;
    if ([moreController.topViewController.view isKindOfClass:[UITableView class]]) {
        moreController.delegate = self;
        self.moreControllerClass = [moreController.topViewController class];
        UITableView* view = (UITableView*) moreController.topViewController.view;
        self.newDataSource = [[[MoreDataSource alloc] initWithDataSource:view.dataSource] autorelease];
    }
} 
```

正如你所看到的，我添加了一些属性来存储我需要的东西。这些必须添加到标题中并合成。我还在标题中将 CustomTabBarController 设为 UINavigationControllerDelegate。这是我添加的委托函数：

```
- (void)navigationController:(UINavigationController *)navigationController willShowViewController:(UIViewController *)viewController animated:(BOOL)animated {
    if ([viewController isKindOfClass:self.moreControllerClass]) {
        UIView* view = self.moreNavigationController.topViewController.view;
        if ([view isKindOfClass:[UITableView class]]) {
            UITableView* tview = (UITableView*) view;
            tview.dataSource = self.newDataSource;
            tview.rowHeight = 81.0;
        }
    }
} 
```

通过这种方式，我可以确保始终使用我的自定义数据源，因为我在每次显示 UIMoreListController 之前将其设置为这种方式。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-03-01T10:12:50.170

```
@interface TabBarViewController () <UITableViewDelegate,UITableViewDataSource>

@property (nonatomic,strong) UITableView* tabBarTableView;
@property (nonatomic,weak) id <UITableViewDelegate> currentTableViewDelegate;

@end

@implementation TabBarViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    [self costumizeMoreTableView];

}

-(void)costumizeMoreTableView{
    _tabBarTableView = (UITableView *)self.moreNavigationController.topViewController.view;
    _currentTableViewDelegate = _tabBarTableView.delegate;
    _tabBarTableView.delegate = self;
    _tabBarTableView.dataSource = self;
    [_tabBarTableView registerNib:[UINib nibWithNibName:@"MoreTabBarTableViewCell" bundle:nil] forCellReuseIdentifier:@"MoreTabBarTableViewCell"];

}

-(CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath{
    return 120;
}

-(NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section{
    return 2;
}

- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath{
    MoreTabBarTableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@"MoreTabBarTableViewCell" forIndexPath:indexPath];
    [cell setMoreTableValues];
    return cell;
}

-(void)tableView:(UITableView *)tableView didSelectRowAtIndexPath: (NSIndexPath *)indexPath{
      [_currentTableViewDelegate tableView:tableView didSelectRowAtIndexPath:indexPath];
 }

 @end 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-02-12T09:29:51.700

这适用于我在 iOS 13、Swift 5.1 中：

```
extension MyTabBarController: UITabBarControllerDelegate {
    // handle a select of the More tab
    func tabBarController(_ tabBarController: UITabBarController, didSelect viewController: UIViewController) {
        // style all the tab bar windows and the More tab bar tableview
        if viewController == moreNavigationController,
            let moreTableView = moreNavigationController.topViewController?.view as? UITableView {
            view.tintColor = .systemOrange
            moreNavigationController.navigationBar.tintColor = .systemOrange
            moreTableView.tintColor = .systemOrange
            moreTableView.backgroundColor = UIColor(named: "Your Color")
            moreTableView.visibleCells.forEach {
                $0.backgroundColor = UIColor(named: "Your Color")
            }
        }
    }
} 
```

# asp.net - 在 web.config 中注册的 Visual Studio 2008 用户控件未向 intellisense 注册

> ID：438386
> 
> 赞同：7
> 
> 时间：2009-01-13T09:05:21.763
> 
> 标签：asp.net, visual-studio-2008, user-controls, intellisense

我有一个在 Visual Studio 2008 中构建的 C# Web 应用程序，在该应用程序中，我们严重依赖于 ASP.NET 的“预构建”块的用户控件。

我们不是在每个页面上注册一大堆用户控件，而是在本地（到特定文件夹）web.config 文件中注册所有控件。优点是我们可以使用控件，并且页面在源视图中看起来“更干净”。但是，VS2008 设计视图和 Intellisense 都无法识别控件注册在`web.config`. 但是，应用程序本身按预期工作。

* * *

通常在每个页面的顶部，我们会有这样的标签：

```
<%@ Register src="~/CommonControls/Foo.ascx" tagname="Foo" tagprefix="Bar" %> 
```

我们在本地 web.config 中注册控件，如下所示：

```
<?xml version="1.0"?>
<configuration>
    <system.web>
        <pages>
            <controls>
                <add src="~/CommonControls/Foo.ascx" tagName="Foo" tagPrefix="Bar"/>
            </controls>
        </pages>
    </system.web>
</configuration> 
```

有谁知道让 Intellisense 识别这些自定义控件的修复方法？或者，有没有“更好”的方法来做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T12:49:49.213

虽然这在本地 Web.Config 文件中不起作用，但您可以使用根 web.config 文件中的 Location 标记来实现相同的结果。

例如：

```
<?xml version="1.0"?>
<configuration>
    <location path="MyPath">
        <system.web>
            <pages>
                <controls>
                    <add src="~/CommonControls/Foo.ascx" tagName="Foo" tagPrefix="Bar"/>
                </controls>
            </pages>
        </system.web>
    </location>
</configuration> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T22:57:12.317

这可能与它没有在主 web.config 文件中注册这一事实有关。通过在主 web.config 文件中放置一两个引用来测试它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-14T16:49:46.910

我尝试了您的示例代码，Intellisense 在 aspx 页面的代码视图和页面背后的代码中都有效。您可以检查用户控件的类名，Visual Studio 默认在类名中包含文件夹名称。因此，您的控件可能被命名为**CommonControls_Foo**而不是**Foo**如您所料。

无论哪种方式，web.config 文件都与背后代码的 Intellisense 无关。检查类的名称和命名空间。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-14T09:04:48.113

可能是因为您注册了两次控件并且智能感知无法解析引用吗？

我希望控件应该在配置文件或页面指令中注册

# .net - NHibernate 双向收集/密钥同步

> ID：438388
> 
> 赞同：0
> 
> 时间：2009-01-13T09:06:00.937
> 
> 标签：.net, nhibernate

我在 NHibernate 中建立了一对多关联：

```
Parent (1 -> ∞) Child 
```

我现在面临的问题是，当我设置 Child.Parent 时，Parent.Children 集合不会自动包含新的 Child。同样，当我将 Child 添加到 Parent.Children 集合时， Child.Parent 属性仍然为空。我可以在属性设置器中编写一些代码来实现这一点，但是这种事情有标准的方法吗？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T11:02:43.257

你真的想要这种行为吗？真的有必要吗？

我总是使用内部设置器将我的“父”引用设为只读，并且我也不将父的 Children 集合作为常规集合公开。My Parent 有一个 AddChild 方法，该方法将孩子添加到集合中，并设置孩子的 Parent 属性。除此之外，我的 Parent 可以返回“Child”类型的 ReadOnlyCollection。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T09:33:40.660

当您设置 Child.Parent 时，您还必须将 Child 添加到 Parent.Children，NHibernate（.net 就此而言）无法知道您设置了父级。

# asp.net - 何时对计划任务/Web 方法使用线程

> ID：438395
> 
> 赞同：0
> 
> 时间：2009-01-13T09:09:17.560
> 
> 标签：asp.net, multithreading

这两个可能看起来没有关联，但请耐心等待！

在我开发/维护的以前版本的软件中，有一个 Web 应用程序位于 Web 服务之上。有一个每小时运行的计划任务，称为执行某些任务的 Web 方法之一。

在新架构中，我们现在有一个 Web 应用程序项目，其中包含业务层和资源访问层的两个类库。

但是我在这个版本中仍然需要相同的功能，我目前正在尝试设计一个合适的解决方案。

我在想，让每小时任务在 Web 应用程序的单独线程上运行一个想法可能是一个想法，该线程会休眠一个小时，醒来并执行任务，或者以类似的方式公开一些 Web 方法会更容易到旧应用程序。

如果有人也有任何好的 ASP.NET 线程示例，我将不胜感激看看它们

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T09:35:09.893

您可能遇到的问题是线程将在应用程序池进程中运行，该进程可能由于各种原因被关闭。例如，一夜之间没有任何活动，该过程可以合法地关闭。很好，任何新请求都将简单地启动一个新的工作进程。但是，如果您需要每小时运行一次，如果池关闭，则不会发生这种情况。

另外，应用程序池可能是一个有多个进程的网络花园。然后，您需要考虑如何确保您没有此任务的多个版本。

因此，最好继续使用计划任务方法，向 Web 服务器发布请求以启动活动。

# svn - 运行“svn import”的 NAnt 任务失败

> ID：438396
> 
> 赞同：1
> 
> 时间：2009-01-13T09:09:38.073
> 
> 标签：svn, import, nant

我想在 NAnt 构建任务中将构建产品导入 Subversion。但它对我来说失败了。

以下从命令行对我来说很好：

`svn.exe import -m 'Importing build 14' build/project.zip [http://svn/builds/14/project.zip](http://svn/builds/14/project.zip) --username builder --password secret`

在 NAnt 我有以下任务：

`<exec program="svn.exe" commandline="import -m 'Importing build 14' build/project.zip [http://svn/builds/14/project.zip](http://svn/builds/14/project.zip) --username builder --password secret" />`

但是使用此任务执行 NAnt 目标会产生错误消息：“ `Too many arguments to import command`”。

您知道为什么我在 NAnt 中收到此错误消息，而*不是*从命令行运行时收到此错误消息吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T16:32:57.023

似乎它可能无法转义引号。如果属性值包含引号，通常这些应该被转义（处理特殊字符和 xml 解析）。

这应该可以解决问题：

```
<exec program="svn.exe" commandline="import -m &quot;Importing build 14&quot; build/project.zip http://svn/builds/14/project.zip --username builder --password secret"/> 
```

要了解有关 XML 的更多信息以及需要*转义*的内容，您可以参考[本文](http://www.xmlnews.org/docs/xml-basics.html)讨论的内容。如果需要，它还会向您显示其他转义码。

# java - Java Applet 可以使用打印机吗？

> ID：438397
> 
> 赞同：11
> 
> 时间：2009-01-13T09:10:15.637
> 
> 标签：java, swing, applet

Java Applet 能否轻松地将文本/html 打印到标准打印机驱动程序（适用于所有常见平台 Win/Mac/Linux）？

需要签字吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-13T10:11:20.850

要打印，您需要使用已[签名](http://java.sun.com/developer/onlineTraining/Programming/JDCBook/signed.html)的小程序，或者如果未签名的小程序尝试打印，系统将提示用户询问是否允许权限。

下面是一些使用 JEditorPane 打印 HTML 的示例代码：

```
public class HTMLPrinter implements Printable{
    private final JEditorPane printPane;

    public HTMLPrinter(JEditorPane editorPane){
        printPane = editorPane;
    }

    public int print(Graphics graphics, PageFormat pageFormat, int pageIndex){
        if (pageIndex >= 1) return Printable.NO_SUCH_PAGE;

        Graphics2D g2d = (Graphics2D)graphics;
        g2d.setClip(0, 0, (int)pageFormat.getImageableWidth(), (int)pageFormat.getImageableHeight());
        g2d.translate((int)pageFormat.getImageableX(), (int)pageFormat.getImageableY());

        RepaintManager rm = RepaintManager.currentManager(printPane);
        boolean doubleBuffer = rm.isDoubleBufferingEnabled();
        rm.setDoubleBufferingEnabled(false);

        printPane.setSize((int)pageFormat.getImageableWidth(), 1);
        printPane.print(g2d);

        rm.setDoubleBufferingEnabled(doubleBuffer);

        return Printable.PAGE_EXISTS;
    }
} 
```

然后将其发送到打印机：

```
HTMLPrinter target = new HTMLPrinter(editorPane);
PrinterJob printJob = PrinterJob.getPrinterJob();
printJob.setPrintable(target);
try{
    printJob.printDialog();
    printJob.print();
}catch(Exception e){
    e.printStackTrace();
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-13T10:47:06.317

为了打印，安全管理器需要允许它访问打印机。这意味着要么签署小程序，或者至少使用**最新版本**的 Sun 的 Java 插件，**如果未签名的小程序试图打印，用户将被提示**询问是否允许权限。

# svn - Subversion 在每次提交时作为版本增量器？

> ID：438398
> 
> 赞同：2
> 
> 时间：2009-01-13T09:10:20.223
> 
> 标签：svn, versioning

我想在每次提交后将（最高）修订号更新为 subversion 存储库中的文件。

我想到了一个 svn version 关键字，但这不是只有在更改特定文件时才会更新吗？

即我有一个文件*version.php*，其中我有版本/修订号，但只在我的提交中更新*anotherfile.php* - 这不会更改*version.php*的版本/修订信息。

提交挂钩是我唯一的选择吗？如果是，有什么例子吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T09:24:04.207

听起来您想要某种 $GlobalRev$ 将全局修订号放入您的文件中。

您可能想要查看的适当工具是[svnversion](http://svnbook.red-bean.com/en/1.5/svn.ref.svnversion.re.html)

您可以将其用作提交后挂钩或在您的构建/部署过程中创建或修改全局版本文件。

另请参阅“$GlobalRev$ 在哪里？” 在[这个页面](http://svnbook.red-bean.com/en/1.5/svn.advanced.props.special.keywords.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T09:25:25.640

我们不会在提交时执行此操作，而是将其作为部署过程的一部分。部署提取最新代码（或特定修订）以及 SVN 修订号，将版本放在相关位置（AssemblyInfo、PHP 版本文件等），然后将其部署到 test/UAT/live/whatever。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T09:26:54.170

钩子脚本是这里唯一的选择。您有两种选择来完成该任务：按照 [subversion handbook](http://svnbook.red-bean.com/nightly/en/svn.reposadmin.create.html#svn.reposadmin.create.hooks)的建议，在提交前脚本中验证 version.php 是最新的，或者在提交后脚本中启动另一个提交更新您的版本文件. 正如手册中指出的那样，您不应修改挂钩中提交的文件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T09:21:41.323

Subversion 使用存储库范围的修订编号系统（请参阅[此处](http://svnbook.red-bean.com/en/1.0/ch02s03.html)的“全局修订编号”侧栏），因此您的文件已经被碰撞。

# dictionary - FxCop 使用什么内部字典？

> ID：438399
> 
> 赞同：0
> 
> 时间：2009-01-13T09:10:49.863
> 
> 标签：dictionary, fxcop

FxCop 必须基于一些内部字典。

如果安装了 Word 字典，它会使用它们吗？

在我的构建服务器上运行 FxCop 时，它没有发现任何拼写错误，但在我的开发人员机器上却发现了。

我知道自定义词典，但在这种情况下不是问题。在构建服务器上，它接受任何单词。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T09:32:49.150

这取决于版本。FxCop 1.35 使用 Microsoft Office 的拼写检查，但 FxCop 1.36[附带拼写检查库](http://davesbox.com/archive/2008/06/08/fxcop-now-ships-with-the-spell-checker-libraries.aspx)。

如果您使用的是 1.35，我猜 Word 安装在您的开发盒上，而不是构建服务器上。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T09:59:00.767

实际上，两个盒子上都安装了 Word 2007 + 校对工具。但我会接受并从 1.35 -> 1.36 升级。

我能找到的唯一区别是 Word 2003 + 校对工具 - 已安装在开发人员机器上，而不是构建服务器上。

# c# - 平板电脑自动完成

> ID：438400
> 
> 赞同：2
> 
> 时间：2009-01-13T09:11:06.837
> 
> 标签：c#, vb.net, autocomplete, windows-vista, tablet

我一直在尝试实现 [这里](http://msdn.microsoft.com/en-us/library/ms695043%28VS.85%29.aspx)提到的自动完成功能。

问题是我正在 Windows xp 机器上开发，我似乎无法找到用于开发此功能的正确 dll。

使用 vista 进行开发不是一种选择，但生产环境是在 Vista 平板电脑上。我已经下载并安装了 Tablet PC SDK 1.7 版，但无济于事（仍然找不到库）。

该实现似乎使用了 COM 库。这些示例都是用 C++ 编写的，我正在使用 .NET 进行开发。

有没有人成功实现过这个功能？如果是这样，你是怎么做的？

任何帮助将不胜感激

这是一张图片，显示了我想要实现的目标

[替代文字 http://i.msdn.microsoft.com/ms695043.ba59a513-e538-4092-89a6-6d691424dc3d%28en-us,VS.85%29.jpg](http://i.msdn.microsoft.com/ms695043.ba59a513-e538-4092-89a6-6d691424dc3d%28en-us,VS.85%29.jpg)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T11:37:51.273

无需直接调用 DLL。只要您的解决方案基于 .NET Framework 3.0 或更高版本，您只需在特定文本框上启用自动完成模式。将您的解决方案部署到 Vista 应该会启用该功能。

但是，需要注意的是，自动完成集成仅适用于 Vista 及更高版本。因此，您将无法在 XP 机器上调试项目的这方面 - 您必须在 Vista Tablet PC 上进行远程调试。Tablet PC SDK 不包括 XP 上此选项的下级兼容性，因为它已融入 Vista 操作系统。

我希望这有帮助。

# python - Python中函数的异常处理

> ID：438401
> 
> 赞同：0
> 
> 时间：2009-01-13T09:11:11.580
> 
> 标签：python, exception-handling

假设我有一个函数定义：

```
def test():
    print 'hi' 
```

每当我给出一个论点时，我都会得到一个 TypeError 。

现在，我想将 def 语句放在 try 中。我该怎么做呢？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T09:13:25.053

```
try: 
    test()
except TypeError:
    print "error" 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T21:20:28.877

如果你想在调用时抛出错误，听起来你可能想要，你可以试试这个方法：

```
def test(*args):
    if args:
        raise
    print 'hi' 
```

这会将错误从调用位置转移到函数。`*args`它通过列表接受任意数量的参数。并不是说我知道你为什么要这样做。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T21:21:03.620

在 Python 中处理可变数量参数的更好方法如下：

```
def foo(*args, **kwargs):
    # args will hold the positional arguments
    print args

    # kwargs will hold the named arguments
    print kwargs

# Now, all of these work
foo(1)
foo(1,2)
foo(1,2,third=3) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T10:42:30.693

你说

> 现在，我想将 def 语句放在 try 中。这个怎么做。

该`def`声明是正确的，它没有引发任何异常。所以把它放在 a`try`不会做任何事情。

引发异常的是对函数的实际调用。所以应该把它放在`try`：

```
try: 
    test()
except TypeError:
    print "error" 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-13T09:21:27.770

```
In [1]: def test():
     ...:     print 'hi'
     ...:

In [2]: try:
     ...:     test(1)
     ...: except:
     ...:     print 'exception'
     ...:
exception 
```

这是[教程中的相关部分](http://docs.python.org/tutorial/errors.html)

顺便一提。要修复此错误，您不应将函数调用包装在 try-except 中。而是用正确数量的参数调用它！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-13T21:05:39.627

这是有效的：

```
try:
  def test():
    print 'hi'
except:
  print 'error'

test() 
```

# login - 创建登录部分 - 我是新手，需要一些认真的方向！

> ID：438405
> 
> 赞同：0
> 
> 时间：2009-01-13T09:12:07.350
> 
> 标签：login, login-script

好吧。所以我是新人，我非常了解 html 的方式，并且现在这样做已经有一段时间了。但是今天我遇到了一个看似简单的问题。

我的客户需要用户创建自己的登录名/密码的能力，我的客户希望能够手动批准访问者。他希望能够跟踪他们登录的次数。

登录部分将只有大约 4 页的 PDF 文件下载。

我无法想象这是世界上最难的事情，我什至不知道从哪里开始。也许已经编写了代码，因为每天都使用论坛技术完成这样的事情......

请帮忙！

提及我在 MAC 上使用 Dreamweaver cs4 也可能会有所帮助

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T09:52:08.487

如果您只想要真正基本的静态登录功能而无需大量编码，您可以从[使用 htaccess 保护您的页面的密码](http://www.elated.com/articles/password-protecting-your-pages-with-htaccess/)开始。您可以毫不费力地用密码保护这样的目录。这样，您可以确保您的登录程序是安全的。

然后，您可以继续使用帐户管理和登录统计等高级功能。这些将需要一些编程技能。

跟踪用户登录次数也应该很容易。您可以将简单的 PHP 代码放入受保护页面的源代码中，以保存有关登录到数据库的信息。这将要求您学习一些数据库的基础知识。您可以使用不那么干净但更容易的纯文本文件，它可以让您更轻松地为您的客户导出信息。

如果您想专业地做这件事，您应该投资学习网络开发或聘请某人为您做这件事。这些任务可能不是微不足道的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T09:22:33.383

如果我是你，我会检查[Ruby on Rails 。](http://rubyonrails.org/)使用它很容易快速获得一些东西，您可以让用户创建帐户，使用批准/拒绝选项向客户端发送电子邮件，并能够通过[MySQL](http://www.mysql.com/)或其他数据库跟踪下载和用户。

我发现[使用 Rails](http://www.pragprog.com/titles/rails2/agile-web-development-with-rails)进行敏捷开发是有关如何执行此类操作的重要信息来源（他们以在线书店作为本书的示例）并且稍作修改我认为它应该适用于您所说的您想要的做（就编程书籍而言，这本书非常便宜）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T09:58:23.497

查看 ASP.net Membership 提供程序以及为登录提供 UI 的登录控件以及开箱即用的注册屏幕。这是[关于 ASP.NET 的成员资格、角色和配置文件的多部分系列](http://aspnet.4guysfromrolla.com/articles/060706-1.aspx)

如果这太复杂了，您也可以使用 ASP.net 从头开始​​设计您的应用程序。如果您不了解 asp.net，那么最好的起点是[www.asp.net](http://www.asp.net)，它有几个视频和教程可以帮助您尽快上手。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T09:22:35.270

您是否使用过 PHP、ASP.Net 或其他 Web 语言？你想要做的事情在宏伟的计划中并不太难，但如果你之前没有编程和/或没有任何 Web 开发经验，这可能会有些挑战。

（Ps改变你的问题作为回应，并在你完成后评论我的答案。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T09:44:26.880

当您正在研究 Ruby on Rails 时，请查看[bort](http://jimneath.org/2008/09/09/bort-base-rails-application/)，它是一个包含 RESTful 身份验证的 RoR 应用程序骨架，它应该会有所帮助（Chris Bunch 回答了一般的 RoR 问题）。

还有这个[bort fork](http://matthall.wordpress.com/2008/09/09/a-bort-fork-rails-base-application/)。还有[Authlogic](http://www.railsinside.com/plugins/145-authlogic-another-take-on-rails-authentication.html)可能更容易使用。

# http - 搜索引擎是否尊重 HTTP 标头字段“Content-Location”？

> ID：438413
> 
> 赞同：13
> 
> 时间：2009-01-13T09:17:53.843
> 
> 标签：http, http-headers, search-engine

我想知道搜索引擎是否尊重[HTTP 标头字段`Content-Location`](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.14)。

这可能很有用，例如，当您想从 URL 中删除会话 ID 参数时：

```
GET /foo/bar?sid=0123456789 HTTP/1.1
Host: example.com
…

HTTP/1.1 200 OK
Content-Location: http://example.com/foo/bar
… 
```

* * *

**澄清：**
我不想重定向请求，因为删除会话 ID 会导致完全不同的请求，因此也可能导致不同的响应。我只想声明，随附的响应也可以在其“主 URL”下找到。

也许我的例子不能很好地代表我的问题的意图。那么请看一下[HTTP头域“Content-Location”的用途是什么？](https://stackoverflow.com/questions/447679/what-is-the-purpose-of-the-http-header-field-content-location).

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-13T19:04:53.367

我认为谷歌刚刚宣布了我的问题的答案：[声明规范 URL](http://googlewebmastercentral.blogspot.com/2009/02/specify-your-canonical.html)[的`canonical`](http://googlewebmastercentral.blogspot.com/2009/02/specify-your-canonical.html)链接关系。

来自 Google 的[Maile Ohye写道：](http://www.google.com/s2/profiles/112810134285899618775)

> > MickeyC 说...
> > 您应该使用 Content-Location 标头，根据：
> > [http](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html)
> > ://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html “14.14 Content-Location”
> 
> @MikeyC：是的，从理论上讲是有道理的，我们当然考虑过。然而，有几点让我们选择了：
> 
> 1.  我们的数据显示，许多网站上的“Content-Location”标头配置不正确。有时，网站管理员会提供长而丑陋的 URL，甚至不会重复——这可能是无意的。他们可能不知道他们的网络服务器甚至正在发送 Content-Location 标头。
>     
>     
>     
>     联系网站所有者以清理整个网络的内容位置问题将非常耗时。我们意识到，如果我们从头开始，我们可以更快地提供功能。与微软和雅虎！板载支持这种格式，网站管理员只需要学习一种语法。
>     
>     
> 2.  网站管理员通常难以配置其 Web 服务器标头，但可以更轻松地更改其 HTML。rel="canonical" 似乎是一个友好的属性。

[http://googlewebmastercentral.blogspot.com/2009/02/specify-your-canonical.html?showComment=1234714860000#c8376597054104610625](http://googlewebmastercentral.blogspot.com/2009/02/specify-your-canonical.html?showComment=1234714860000#c8376597054104610625)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T09:34:54.340

大多数体面的爬虫确实遵循 Content-Location。所以，是的，搜索引擎尊重 Content-Location 标头，尽管这不能保证具有 sid 参数的 URL 不会出现在结果页面上。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-07-24T03:51:17.707

2009 年，Google 开始研究`rel=canonical`响应正文中的 URI。

看起来自 2011 年以来，按照 RFC5988 格式化的链接[也从 header field 解析`Link:`](http://googlewebmastercentral.blogspot.de/2011/06/supporting-relcanonical-http-headers.html)。[网站管理员工具常见问题解答](https://support.google.com/webmasters/answer/139066?rd=1#6)中也明确提到它是一个有效的选项。

猜猜这是为搜索引擎提供一些额外的超媒体面包屑以遵循的最新方式 - 因此当您实际上不需要将其作为内容提供时，可以让您将它们排除在响应正文之外。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-01-18T18:06:41.017

除了使用“位置”而不是“内容位置”之外，根据您的重定向原因，在您的响应中使用正确的 HTTP 状态代码。搜索引擎倾向于支持永久重定向 (301) 状态与临时 (302) 状态。

* * *

## 回答 #5

> 赞同：-4
> 
> 时间：2009-01-15T19:23:26.960

请尝试使用“位置：”标题。

# delphi - 德尔福文件类型

> ID：438414
> 
> 赞同：19
> 
> 时间：2009-01-13T09:18:49.507
> 
> 标签：delphi, version-control

我正在寻找可以与 Delphi 项目（所有版本的 Delphi）相关联的所有文件类型的列表，更具体地说，所有文件类型应该受源代码控制。

[这个站点](http://delphi.wikia.com/wiki/Delphi_File_Extensions)没有提到 Delphi 2009，所以我不确定是否有新的文件类型。

是否有直接来自 Codegear 的此类列表？

* * *

将所有答案放在一起，这里是一个列表：

文件 -> 源代码管理

*   .bdsgroup - 项目组
*   .bdsproj - 项目
*   .bpg - 项目组
*   .cfg - 项目配置
*   .dfm - 德尔福表格
*   .dof - 项目选项
*   .dpk - 包
*   .dpr - 项目
*   .dproj - 项目
*   .pas - 帕斯卡文件
*   .res - 资源文件
*   .todo - IDE 待办事项

我不确定这些：是否应该包括在内？

*   .dem
*   .dro
*   。当地的

也许还缺少什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-13T10:50:11.473

棱镜之前：

*   .pas 是源代码 - 在所有版本中都是这样
*   .dcu delphi 编译单元（编译后的.pas 文件）
*   .dfm 德尔福形式
*   .dpr 德尔福项目
*   .res 资源文件
*   .dpk 德尔福包
*   .dcp dpk 编译版本
*   .dpl/.bpl Windows DLL，其中包含 Delphi 特性
*   .BPG, .BDSGROUP Borland 项目组
*   .dcr .res 的编译版本
*   解决方案的 .dof 设置
*   特定于解决方案的 IDE 的 .dsk 设置（即打开了哪些窗口）
*   .dro 此文本文件包含有关对象存储库的信息。
*   .dmt 此专有二进制文件包含随附的和用户定义的菜单模板信息
*   .tlb 类型库
*   .dem 此文本文件包含 TMaskEdit 组件的一些标准国家特定格式

从我与 Prism 的有限工作看来

*   .pas 是源代码 - 现在包括表格
*   .dproj 德尔福项目
*   .resx 资源文件
*   .vsproj 德尔福包

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-13T12:15:34.937

只是一些不应该包括的额外的（至少我没有。）：

*   .drc - 在每次编译时生成（绑定资源列表）
*   .map - 地图文件
*   .dproj.local
*   .identcache
*   .groupproj.local

那些应该：

*   .todo - IDE 的项目 todo 文件。
*   .inc - Delphi/Pascal 包含文件。

其他取决于您的存储内容：

*   .groupproj - Delphi 项目组文件

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-13T18:48:47.547

这是使用 Delphi 设置[Subversion](http://sourceitsoftware.blogspot.com/2008/07/starting-out-with-delphi-and-subversion.html)的指南。他使用这个“全局忽略模式”文件过滤器进行颠覆：

我用

```
*.dcu *.~* dcu temp *.exe *.zip *.bkm *.ddp *.cfg *.dof *.dsk *.ini *.hlp *.gid 
*.bmp *.png *.gif ~* *.log bin debug release *.map *.chm *.bkf Thumbs.db *.mdb 
.obj *.elf *.stat *.ddp *.bpl *.map *.GID *.hlp *.opt *.dll *.raw *.BIN *.obj 
*.pdb *.scc Debug Release *.xml obj *.~* *.backup *.INI *.ArmLog *.KeyLog 
*.NanoLog *.Stats *.PreARM *.old *.drc *.*~ *.doc *.pdf *.bmp *.jpg *.MRW *.NEF 
*.ORF *.psd *.X3F __history *.local *.identcache *.bak Thumbs.db *.ldb *.dex 
*.rar DllDcu *.lck CVS cvs *.txt *.TXT *.jdbg *.HLP *.KWF *.xls *.cnt *.dsm 
*.dti *.tmp *.lnk *.cbk *.mes 
```

请注意，这些模式区分大小写。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-10-13T21:05:16.960

从这个链接[.local](http://delphi.wikia.com/wiki/Delphi_File_Extensions)**文件**用于

> Delphi/CB 2005 及以后：用户特定的项目选项。使用 Starteam 项目时，它将包含对 .bdsproj 文件中设置的覆盖。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-05-11T11:00:37.017

“.local”文件可能应该包含在版本控制中——至少在 Rad Studio 2010 中（我没有检查过更新的版本）。

它们是 XML 文件，其中包括（以及其他杂乱无章的）每个文件夹中项目中文件的视觉排序：-

```
<ProjectSortOrder AutoSort="0" SortType="0">
    <File Path="..\PPP\base.optset"/>
    <File Path="..\HPPP\debug.optset"/>
    <VirtualFolder ID="{BC2DCF60-71AB-4F00-AFCB-CC7FA5414FB5}"/>
    <VirtualFolder ID="{DFA8BFE5-37E7-45F6-B964-18198CB18581}"/>
    <File Path="..\PPP\Xyzzy.cpp"/> 
```

如果您删除 .local 文件，项目中的文件将按字母顺序显示，而不是您将它们拖入的顺序。这是一个方便的技巧，可以让您的文件快速恢复字母顺序！

# sharepoint - 是否可以使用拖放将 Sharepoint 中的 Web 部件移出编辑模式？

> ID：438418
> 
> 赞同：2
> 
> 时间：2009-01-13T09:20:31.170
> 
> 标签：sharepoint, drag-and-drop, web-parts

我想知道是否有人在 Sharepoint 2007 Web 部件页面的正常视图模式下实现了 iGoogle/netvibes 拖放界面？如果可能的话，我希望使用编辑模式中已经存在的拖放功能，因为这是 Sharepoint 附带的，但我希望它在页面的正常视图模式下可用，而不仅仅是在编辑模式下。

我已经在网上四处寻找，但找不到这样做的人。我尝试使用 jQuery 进行快速测试，但默认情况下页面的标记使其难以使用基于表格的布局来实现。

我还看到有一个用 YUI 实现的[表格单元格排序](http://normankosmal.com/wordpress/?p=25)，它可能适用于此，但我还没有尝试过。

因此，如果有人对此有任何经验，任何提示将不胜感激！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-27T21:49:38.210

SharePoint 将 Web 部件在其数据库中的页面上的位置的详细信息存储。在编辑模式下移动 Web 部件时，您正在更改它`Zone`在内容数据库中的属性值。因此，如果您能够拖放 Web 部件的 HTML，您还需要一种更新数据库的方法，以便在下次加载页面时让 SharePoint 知道它的新位置。

我想这可以使用 AJAX 调用服务器以更新 Web 部件的区域，但我还没有在任何地方看到这样做。

# graph - 有谁知道一个好的网络/图形可视化软件 - 只需添加数据？

> ID：438419
> 
> 赞同：51
> 
> 时间：2009-01-13T09:20:35.057
> 
> 标签：graph, visualization, social-networking

我想绘制社交网络可视化，但不能做太多编程。有谁知道一种可以进行网络可视化并且不需要编码（或至少很少编码）的软件？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2012-01-04T20:35:34.267

那么[Gephi，开放图形可视化平台](http://gephi.org)呢？

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-13T09:21:27.567

如果您不介意*一些*编程，您可以使用[GraphViz](http://www.graphviz.org/)。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-06-06T15:05:56.623

为此，我强烈推荐[Gephi](http://gephi.org/)。您可以使用简单的 SQL 查询直接从数据库（MySQL、SQLServer、PostgreSQL、SQLite、TeraData）导入数据（节点和边）。或者，您可以从 CSV 文件导入数据。

它也有一套很棒的算法来分析你的图表。[Gephi](http://gephi.org/)以模块化方式构建并且是开源的。他们还发布了一个[Gephi 工具包](https://gephi.org/toolkit/)，这是一个可以在任何 Java 应用程序中使用的库，如果你要开发你的可视化软件的话。

此外，强烈建议使用 Javascript 库[sigma.js](http://sigmajs.org/)来可视化图形。Sigma.js 的灵感来自[Gephi 工具包](https://gephi.org/toolkit/)，并且可以与它一起工作。

可以在[http://selection.datavisualization.ch/找到一组数据可视化工具](http://selection.datavisualization.ch/)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2010-02-05T15:14:11.047

添加到不断增长的列表中：JavaScript InfoViz Toolkit 在浏览器中提供了非常漂亮的图形和网络可视化。可缩放等。链接在[这里](http://thejit.org/home/)。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-15T03:16:48.610

我肯定会尝试 networkx / python。它支持不同的可视化 api，例如 GraphViz、PyDot 等。但如果你使用 Flash试试[Flare 。](http://flare.prefuse.org/)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-17T13:25:16.527

GraphViz 在大图上惨败。试试[aiSee](http://www.aisee.com/ "爱视")或看看[这个列表](http://www.dmoz.org/Science/Math/Combinatorics/Software/Graph_Drawing/ "这份清单")。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-09-06T13:18:10.713

NodeXL，免费且开放的 Excel 插件，支持网络概览、发现和探索。代码和应用程​​序可以在[http://www.codeplex.com/nodexl](http://www.codeplex.com/nodexl)找到。

NodeXL 允许以边缘列表、矩阵、graphML、UCINet 和 Pajek 文件以及 CSV 和其他工作簿的形式导入网络数据。

NodeXL 允许非程序员快速生成有用的网络统计数据和指标，并创建网络图的可视化。过滤和显示属性可用于突出显示网络中的重要结构。

NodeXL 支持通过导入功能从桌面、twitter、flickr 以及 Facebook 上的个人电子邮件索引中提取数据来探索社交媒体。

最近添加到 NodeXL 的功能包括更快的指标计算、更大的数据集、新的布局、比例、轴和图例。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-13T14:19:47.057

我自己没有尝试过，但也许值得一看[Omnigator](http://www.ontopia.net/omnigator/models/index.jsp)；不久前我一直在寻找类似的东西，“主题地图”对谷歌来说是一个很好的短语，因为它听起来很像你正在寻找的东西。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-08-18T19:20:51.313

TouchGraph链接浏览器[可](http://sourceforge.net/projects/touchgraph/)让您创建交互式图形并将其放置在网络上。

您将需要 java 1.4.1 或 1.4.2 来编辑您的图表。要在 Web 上查看您的图表，您可以使用 java 6。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-01-20T16:20:55.837

[这是Network Workbench](http://nwb.slis.indiana.edu/index.html)背后的想法：

他们将许多最先进的图形可视化组合到一个带有用户界面的软件中。除了以工具可以读取的格式之一获取数据之外，您不需要进行任何编程。您应该能够放大和缩小并拥有所需的交互性。它是研究人员进行网络分析的工具。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-05-28T08:09:58.637

Netvizz 是一个 Facebook 应用程序，它创建一个 .gdf 文件来描述您的个人网络或您所属的组，并让您将其导入 GUESS 和 Gephi。在此处查找[教程](http://blog.sociomantic.com/2010/05/using-netvizz-gephi-to-analyze-a-facebook-network/)。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-01-20T15:52:21.613

就我而言，我使用名为“viSANT”的免费软件。 [http://visant.bu.edu/](http://visant.bu.edu/) 这个软件最初专门用于生物学，可以用来表示任何网络。节点和边可以有多种形式和颜色。他们的名字是否显示。可以根据选定的标准将节点分组为复合体或组。此外，这些复合体或组可以折叠，提供更好的图形可见性。这些基团和这些复合物又可以被封装和 Metagroup 元复合物等等。当然，所有这些操作都是可逆的。使用此软件，您会发现许多其他功能。最后，它的使用非常简单直观。

Pour ma part j'utilise le logiciel gratuit nommé 'visant'。Ce logiciel d'abord dédié à la biologie, peut être utilisé pour représenter n'importe quel réseau。Les noeuds et les arêtes peuvent avoir de multiples formes et couleurs。Leur nom représentés ou pas。Les noeuds peuvent être regroupés en complexes ou groupes sur des critères choisis。De plus, ces complexes ou groupes peuvent être contractés, procurant une meilleur visibilité du graphe。Ces groupes et ces complexes peuvent à leur tour être encapsulés en métagroupes et métacomplexes et ainsi des suite.Bien entendu, toutes ces opérations sont réversibles。Il ya de nombreuses autres fonctionalités que vous découvrirez en utilisant ce logiciel。Et enfin, le meilleur, son 利用 est très simple et très 直观。

1 月 20 日 16:49

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2011-07-14T16:41:27.847

Cytoweb 看起来很有希望：[http ://cytoscapeweb.cytoscape.org/](http://cytoscapeweb.cytoscape.org/)

可以与 javascript & ajax 交互，但是是 flash，而不是 html5。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-01-20T16:14:11.527

有一个很好的基于 Flash 的开源图表：[http](http://teethgrinder.co.uk/open-flash-chart-2/) ://teethgrinder.co.uk/open-flash-chart-2/ 。所有图表都在 Flash 文件中处理，您可以选择使用 javascript 或 HTML`<object>`元素上的参数来发送数据。

如果通过javascript更改数据，应该可以实现缩放；虽然我希望你需要编写 javascript 来做到这一点。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2012-04-05T00:17:06.210

我强烈推荐[JUNG 框架](http://jung.sourceforge.net/)。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-01-20T15:58:57.647

如果您希望它具有交互性，并希望将其包含到网页中，您可以考虑使用[flot](http://code.google.com/p/flot/) jquery 插件。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2010-02-05T15:18:15.207

实际上，我以前使用过[NovaMind](http://www.novamind.com/)，尽管它们描述/标记事物的方式不同，但大多数概念都是相同的。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2010-01-20T15:56:28.043

Microsoft 的[GLEE](http://research.microsoft.com/en-us/downloads/f1303e46-965f-401a-87c3-34e1331d32c5/default.aspx)（现在称为 MSAGL - Microsoft Automatic Graph Layout，相信 MS 会取一个时髦的名字并让它变得沉闷）是有效的，如果你是 .NET，它很容易使用。

# macos - 是否可以在 Max OSX Tiger/Leopard 上创建自动运行的混合 CD/DVD？

> ID：438423
> 
> 赞同：0
> 
> 时间：2009-01-13T09:21:56.723
> 
> 标签：macos, dvd, dvd-burning

请原谅我不是一个编程问题，但我需要刻录一张可以在 Windows 和 OSX 上自动播放的光盘。我在某处读到，关于某些安全问题或 wtf，OSX 默认禁用自动播放功能（？）。但是，在这里发布问题是希望 Stackoverflow 知道如何破解/启用它。

是的，我知道：

> 对于 Windows，我们可以设置 Autorun 以自动启动应用程序，对于 Mac，我们可以使用特殊的文件夹格式来明确用户应该做什么。

[来源](https://stackoverflow.com/questions/229456/creating-multi-platform-cds-for-software-distributio)

BTW，要播放的内容是MM Flash。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-13T09:25:12.817

这看起来好像对您有帮助：[创建多平台自动运行 CD](http://research.silmaril.ie/autoruncd/)

更新：阅读后似乎需要一个 Mac OS 9 工具，现在用处不大

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T09:29:33.417

你不能启用它。该功能没有被禁用——它根本不存在。唯一的方法是在计算机上安装一个程序来响应磁盘插入，但这是一个先有鸡还是先有蛋的问题，不是吗？

# wpf - 如何在 WPF UI 代码中等待后台线程/操作完成？

> ID：438431
> 
> 赞同：4
> 
> 时间：2009-01-13T09:24:43.143
> 
> 标签：wpf, multithreading

例如在Winforms中我会写......

```
// on UI Thread
    BackgroundWorker workerThread = new BackgroundWorker();
    workerThread.DoWork += new DoWorkEventHandler(LoadChildren);
    workerThread.RunWorkerCompleted += new RunWorkerCompletedEventHandler(OnLoadChildrenCompleted);
    while (workerThread.IsBusy)
    {
      Application.DoEvents();
    } 
```

在 WPF 中，Winforms 中的 Application.DoEvents 是什么？

我的 ViewModel 类中有一个名为 Children 的属性。HierarchicalDataTemplate 已设置为从 Children 属性中读取 Items。
TreeView 显示节点。当用户展开一个节点时，节点的子节点是根据这个属性的结果生成的

```
public Node Children
{
  get
  {
    // 1\. time-consuming LINQ query to load children from a SQL DB
    // 2\. return results
  } 
} 
```

所以我想在后台线程上运行 1\. 并等待它完成，然后再返回结果......保持 UI 响应。

谷歌搜索将我带到[这个页面，它使用 DispatcherFrames 来模拟上述方法](http://shevaspace.spaces.live.com/blog/cns!FD9A0F1F8DD06954!411.entry)。但这似乎工作量太大……这暗示了“我这样做对吗？”

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T09:52:42.247

据我了解，您有这种流程：

*   做一些准备工作（UI线程）
*   做一些后台工作（其他线程）
*   做一些整理工作（UI线程）

您想等待第二个项目符号完成，然后再运行第三个项目中的代码。

最简单的方法是让第二个项目符号的代码回调到 UI 线程（以正常方式）以触发第三个项目符号执行。如果你真的，真的想使用方法中的局部变量，你总是可以使用匿名方法或 lambda 表达式来创建委托以传递给后台工作人员 - 但通常只有一个“PostBackgroundWork”方法会更干净或类似的东西。

编辑：这对于您在已编辑问题中显示的属性来说并不好，但我会将其重构为在完成时通过回调获取子项的请求。这避免了重入的整个混乱，并使实际发生的事情更清楚。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T09:56:29.040

> 在 WPF 中，Winforms 中的 Application.DoEvents 是什么？

没有内置的，但您可以轻松编写自己的。实际上，WPF 比 Winforms 为您提供了更多的消息处理能力。[在此处](http://kentb.blogspot.com/2008/04/dispatcher-frames.html)查看我关于 Dispatcher Frames 的博文。它包括一个示例，向您展示如何模拟`Application.DoEvents()`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T09:29:30.093

在这样的循环中调用 UI 线程上的 DoEvents 在 WinForms 或 WPF 中是不推荐的做法。

如果您的应用程序在该线程完成其工作之前无法继续，那么为什么它在另一个线程上？

如果您的应用程序的某些部分可以继续，则禁用那些不能并在调用完成回调时重新启用它们。让系统的其余部分继续工作。不需要包含 DoEvents 的循环，这不是一个好习惯。

看看[MSDN 上的社区内容](http://msdn.microsoft.com/en-us/library/system.windows.forms.application.doevents.aspx)。

这是[一篇关于 DoEvents 的好文章](http://blogs.msdn.com/jfoscoding/archive/2005/08/06/448560.aspx)。

# deployment - Sharepoint 2007 维护和分期

> ID：438442
> 
> 赞同：1
> 
> 时间：2009-01-13T09:29:46.177
> 
> 标签：deployment, sharepoint-2007, maintenance

我正在尝试起草一份全面的文档，以协助维护小组建立新的 Sharepoint 2007 Intranet。

我在决定什么是将各种不同元素迁移到客户批准和生产环境的正确工具时遇到的问题。我们预计将来必须处理新列表、新自定义类型/列表模板、修改页面、新页面等。

换句话说，虽然我认为添加整个子站点相对简单，但对现有区域的增量更改对我来说似乎并不容易。特别是因为生产现场有各种由客户更新的列表（公告板等）。

到目前为止，最好的答案似乎是[http://www.codeplex.com/SPDeploymentWizard](http://www.codeplex.com/SPDeploymentWizard)但我有一些遗留问题：

1) 它是测试版，不是微软官方产品。所以我们的客户可能不太有信心 2) 它需要安装在您要交付更改的所有服务器上，并通过 GUI 组件工作。再一次，这将是客户不太满意的事情（他们的东西由第三方管理，想想 EDS 或类似公司）。

有没有人在生产相关场景中有信心使用它？你有不同的选择建议吗？

TIA,

保罗。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T20:17:06.557

内容部署向导的危险实际上并不在于它可能不起作用，而更多的是您可能会尝试迁移作为具有特定功能的共享点解决方案更好地发布的对象。

具体来说，新列表应该作为功能中定义的列表模板发布。新的自定义字段必须与解决方案一起发布。

一个好的经验法则是可以迁移内容（即页面和文档上的文本）。结构（新的列表类型、字段）需要作为解决方案发布。

可以在站点上手动创建修改过的页面和新页面，并在准备好后发布。如果它们绝对必须批量发布，那么向导将提供帮助。

我也使用了 codeplex 的 STSDev 来创建所需的解决方案包。请记住，即使这些工具不是“官方 Microsoft 产品”，它们也经常被 Microsoft 专业人员自己大量使用，并且如果“官方”的发布标准不是这么长的过程，它们将成为官方工具。

检查任何工具的作者，他们中的大多数都会有一个博客，这将使您对作者可能拥有的经验和与 Microsoft 的关系有一个很好的了解。

我没有使用 SPDeploymentWizard，但来自 codeplex 站点

> 使用 Content Migration API (PRIME) 将内容导出为 .cmp 文件（内容迁移包），该文件可以复制到其他服务器以进行导入。与开箱即用的工具不同，向导允许通过树形视图*精细地选择内容。*

这意味着该工具是“微软官方流程”的 gui 包装器，可以更轻松地选择您希望放入迁移包的内容。

您的问题的主题在实践中并非易事，并且执行此操作的工具和技术正在改进和变化，因此请密切关注博客和 codeplex 以获得建议。

**更新**

迁移工具应该只适用于每个版本所需的文档和页面。

对于列表，我创建了包含所有项目的临时模板，但这仍然是一个手动发布过程。因此，请尝试使用内容迁移工具，因为您没有对站点进行结构更改，如果列表没有正确执行，则可能会删除该列表。

真正的问题是确保内容类型 id 和内容字段 id guid 在服务器之间是相同的，但是对于解决方案/功能包的任何自定义版本，应该没有区别。

**更新 2**

对于单个页面，我们创建了一个 powershell 脚本，给定一个 url、一个文件列表和一个操作，将页面从服务器下载到本地驱动器或上传它们。使用对象模型创建页面非常容易，自定义属性有点棘手，但是签入和发布页面并不是什么大问题。

# c++ - 在 C++ 中传递对象所有权

> ID：438444
> 
> 赞同：14
> 
> 时间：2009-01-13T09:30:30.370
> 
> 标签：c++

表明一个对象想要获得另一个对象的所有权的最佳方式是什么？到目前为止，我一直`std::auto_ptr`在公共接口中使用 a，因此客户端知道该接口想要获取传递对象的所有权。

但是，最新的 GCC 告诉我`auto_ptr`已弃用，所以我想知道推荐什么？`boost::interprocess::unique_pointer`看起来是个不错的候选人，但这真的是最好的解决方案吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-13T09:51:54.867

`boost::interprocess`是一个用于进程间通信的库，所以我不会将它用于不同的目的。

正如本论坛所讨论的：

[http://objectmix.com/c/113487-std-auto_ptr-deprecated.html](http://objectmix.com/c/113487-std-auto_ptr-deprecated.html)

`std::auto_ptr`将在标准的下一个版本中声明弃用，建议使用`std::unique_ptr`，这需要实现右值引用和移动语义（这是一个相当复杂的功能）。

在新标准发布之前，我会尽可能地尝试禁用警告，或者忽略它，以获得最大的可移植性。

如果您想已经切换到下一个语言标准，则有可能，因为已经实现了右值引用（参见[http://russ.yanofsky.org/rref/](http://russ.yanofsky.org/rref/)），所以也`std::unique_ptr`应该得到支持。

新语义的优点之一是您可以将临时或任何右值传递给移动构造函数；`std::vector`在其他情况下，这允许在销毁原始对象之前避免复制（例如）包含在（重新分配期间）中的对象。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-13T09:53:52.633

`std::unique_ptr`确实是新的推荐方式。使用 C++0x 容器将变得可移动，这意味着它们可以处理可正确移动的类型（即，`std::vector<std::auto_ptr<x> >`不起作用，但`std::vector<std::unique_ptr<x>>`会）。

对于`boost`，`boost::interprocess`容器已经支持可移动类型，其中`boost::interprocess::unique_ptr`之一在哪里。它们类似于 C++0x 之前的可移动类型，通过使用一些“正常”的 boost-template 魔法，并在支持它们的地方使用 r-value 引用。

不过，我不知道`auto_ptr`专门的弃用，但我没有密切关注新标准的演变。

（**编辑**）的实现`boost::interprocess::unique_ptr`确实不是像`boost::shared_ptr`or这样的“公共”智能指针`boost::scoped_ptr`，但它（参见[boost.interprocess 的站点](http://www.boost.org/doc/libs/1_35_0/boost/interprocess/smart_ptr/unique_ptr.hpp)）不仅用于共享内存，还可以用于通用目的。

但是，我很确定如果 GCC 弃用`auto_ptr`模板，它们已经提供了自己的`unique_ptr`实现（如果您还没有可行的替代方案，那么弃用没有多大用处）。

但是，话虽如此，如果您在 C++0x 平台上工作，`unique_ptr`请使用编译器库中提供的 .，如果没有，请坚持使用`auto_ptr`.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T12:27:30.310

我同意在可能的情况下，您应该使用编译器协助所有权转移的类型。

如果您没有数据类型的选择并且正在传递原始指针，我遵循 Taligent 编程指南，将所有权放弃为**orphanBlah**和参数将所有权放弃为**采用**的命名方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T09:41:40.287

std::auto_ptr 实现了所有权传递复制和赋值，所以你不需要做任何特别的事情：

```
std::auto_ptr< T > p = somePtr; // not p owns object, referenced by somePtr
std::auto_ptr< T > q = myObj.GetAutoPtr(); // not q owns object referenced by auto_ptr in myObj 
```

但是传递对象所有权并不是一个好的设计实践，它会导致泄漏和对象生命周期相关错误。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T09:43:37.163

我不记得 std::auto_ptr 被弃用了。
任何人都有他们讨论这个问题的适当标准会议的链接吗？

一个快速的谷歌发现了这个： http: [//objectmix.com/c/113487-std-auto_ptr-deprecated.html](http://objectmix.com/c/113487-std-auto_ptr-deprecated.html)

```
>> In fact the latest publicly available draft lists auto_ptr in appendix
>> D, meaning that there is clear intent to formally deprecate it in the
>> next revision of C++. A new class named unique_ptr is going to provide
>> a replacement for auto_ptr, the main difference being that unique_ptr
>> uses rvalue-references instead of voodoo magic to properly achieve
>> move semantic.
>
> Is a reference implementation available? Is it too early to start using it?
>

In order to use unique_ptr you need first to have a compiler which
properly supports rvalue references. These can be hard to find nowadays,
as the feature has not yet been standardized, although the situation is
quickly improving. For example GCC has very recently added the feature
in v4.3 (http://gcc.gnu.org/gcc-4.3/cxx0x_status.html). If you are lucky
enough to have one of those compilers, most probably they already ship a
version of unique_ptr (it's a sort of benchmark for the feature, you
know). In any case, you can find reference implementations on the
internet by just googling unique_ptr. 
```

因此，看起来他们正在弃用 auto_ptr 以支持 unique_ptr （具有相同的语义）。但它需要一个支持即将推出的 C++ 版本中提议的新特性的编译器。

但是还有另一次会议，因此需要投票，所以在标准具体化之前情况可能会发生变化。

# java - 最佳批量照片上传小程序

> ID：438455
> 
> 赞同：3
> 
> 时间：2009-01-13T09:38:17.220
> 
> 标签：java, flash

我正在寻找在我正在构建的网站上处理图像上传。所有幕后的东西都很好，但是创建一个直观的前端让我头疼。

在大多数人都有异步互联网连接的世界中处理照片的问题在于照片的大小。我希望每个用户上传（至少）10-20 张事件的图像。在现代相机上，10-20 张图像转换为 50-200 兆。

如果人们有 256kbps 的上传速度，那么传输已经是 ~15 分钟。我的经验是，人们在等待某事发生时并没有*那么*耐心……所以我需要为此做点什么。

我正在寻找一个 Flash/Java（请不要使用 Silverlight）小程序，它可以将**客户端**上的图像调整为指定的宽度并上传小得多的文件。如果我可以将图像缩小到几百 KB，它可能是一个可用的系统。

编辑：这是一个个人项目。到目前为止，一个建议是价格为 184 美元的东西。我希望这些天我有那么多可支配的现金！我的最高预算约为 40 美元，但我自然更喜欢免费和开源的东西 =)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-09-18T12:58:33.613

[http://www.jumploader.com/demo_control.html](http://www.jumploader.com/demo_control.html) - 免费

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T10:07:27.490

我们使用这个：

[http://www.aurigma.com/](http://www.aurigma.com/)

几年以来一直运行良好！（java和activex）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-01T15:21:25.983

尝试以下操作：[http ://www.jfileupload.com/products/jbatchupload/index.html](http://www.jfileupload.com/products/jbatchupload/index.html)

[披露：这是我的网站]

可以上传数千个文件和文件夹。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-03-07T06:21:54.260

我自己正在研究这个。jupload.sourceforge.net 看起来像是一个可能的答案。

[http://jupload.sourceforge.net/advanced_js_demo.html](http://jupload.sourceforge.net/advanced_js_demo.html)

麦克风

# java - 使用串行端口的 CANopen PDO

> ID：438458
> 
> 赞同：3
> 
> 时间：2009-01-13T09:39:24.503
> 
> 标签：java, serial-port, can-bus, canopen

我正在尝试了解 CANopen 协议。

目前，我没有任何 CAN 硬件或 CANopen 堆栈可供试验。

我想知道如何编写一个 Java 程序来简单地解释在 RS-232 端口接收到的 CANopen 消息。

*   是否有作为串行端口安装的 CAN 接口？
*   我可以编写一个程序来处理 CANopen 消息吗？我只想能够接收和解释消息。是否像为输入流创建缓冲区然后根据 SOF 和 EOF 将传输分解为单独的消息一样简单？我怎么知道什么是 SOF/EOF，因为它只有 1 位长？
*   为什么CAN节点的PDO数量有限制？
*   如何处理 PDO 以识别发送它的节点以及数据类型和值？PDO 是标准 CAN 帧吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-13T15:48:18.160

我不知道任何连接到串行端口的 CAN 接口（基于具有 CAN 和串行端口的微控制器创建一个不会太难）。但是，标准串行端口速度太慢，无法支持 CAN 中可用的更高速度。

通常，当使用 CAN 接口的 API 时，您将能够读取由 ID、长度和最多 8 个字节的数据组成的消息。你不需要关心 SOF/EOF。即使直接在底层与 CAN 控制器连接（也就是说，如果您有一个需要自己编写驱动程序/API 的 CAN 接口），您仍然不需要关心这些细节。而且您根本不想尝试在不使用 CAN 控制器的情况下访问 CAN 总线......

如果你想假装你有一个 CAN 接口，你可以创建一个返回这三个项目的存根函数：一个 ID、一个数据长度和一个 64 位数据缓冲区。这基本上是所有 CAN 接口 API 将提供给您的。并且在传输 CAN 报文时，您将使用相同的参数（ID、长度数据）。

PDO 是通过使用 CAN ID 字段来定义的。理论上，一个设备的 PDO 数量并没有那么有限，但预定义的连接集只为每个节点分配了少量（四个）PDO。

PDO 是标准 CAN 帧。如前所述，CAN ID 标识 PDO。在预定义的连接集中（大多数设备都遵循），所有消息的 CAN ID 由功能部分和模块 ID 部分组成（模块 ID 可以为设备硬编码，或通过例如拨码开关进行配置）。CAN ID 的 10-7 位是功能码，6-0 位是模块号。例如，模块 ID 为 0x10 的设备的 TxPDO1 的 CAN ID 为 0x190。11 位 CAN ID 的高四位`((CAN_ID & 0x780) >> 7)`给出功能代码 (TxPDO1 = 3)，其余位`(CAN_ID & 0x7f)`给出模块 ID（在本例中为 0x10）。因此，如果您在 CAN 总线上读取 CAN ID 为 0x190 的消息，您会知道这是来自模块 ID 为 0x10 的设备的 PDO。

（表达这一点的更简单的方法可能是说 TxPDO1 的 CAN ID 设置为 0x180+ `<module ID>`， TxPDO2 的 CAN ID 设置为 0x280+ `<module ID>`，等等）

您应该如何解释 PDO 中的数据取决于您的设备。

我建议你找一个很好的 CANopen 教程。不幸的是，它们中的大多数使一切听起来比实际复杂得多。所以环顾四周，直到找到一个看起来可以理解的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-10-04T03:17:55.787

有许多 CAN 接口可以通过串行端口运行 - VSCOM、Vector 和许多其他接口。还有一些免费程序允许您发送和接收原始 CAN 帧 - CANhacker 等。谷歌中的一些。

我还没有找到可以解释 CANopen 的免费程序——大多数是付费程序。[Linux 的Wireshark](http://en.wikipedia.org/wiki/Wireshark)是个例外——它使用[SocketCAN](https://en.wikipedia.org/wiki/SocketCAN)来拉入数据包并可以解析所有 CANopen 帧。

我以 1 Mbit/s 的速度运行我的 CAN 总线，并使用 VSCOM 接口在串行端口上对其进行监控。

[CANFestival](http://www.canfestival.org/)是一个很好的开源堆栈，可以轻松移植到 Linux 以及裸机。

# versioning - 您如何在 Bugzilla 中跟踪版本？

> ID：438461
> 
> 赞同：4
> 
> 时间：2009-01-13T09:41:38.540
> 
> 标签：versioning, bugzilla

我们正在将我们的错误跟踪从一个非常旧版本的跟踪迁移到 Bugzilla，而我的 Advil 快用完了。

我们有一个已经存在很长时间的遗留应用程序。事实上，我们的版本管理已经经历了几次迭代，它在野外产生了很多不同的版本。更糟糕的是，由于合同限制，并不总是可以将客户端升级到最新和最好的，因此我们必须在他们当前拥有的版本上进行分支、修复、测试和发布，从而产生另一个版本号。

最终结果是版本组合框长得可笑。最后，出于各种原因，我们要跟踪三个不同的版本信息：发现错误的版本（版本）、我们计划修复的版本（里程碑）以及最终修复的版本（接受建议）。这实际上是我的问题......这实际上可以是多个数字，我们为其中一些客户进行了追溯修复（这种情况经常发生）。

这就是我需要你们集体智慧的地方：

**您如何在 Bugzilla 中跟踪这些版本（找到的、计划的和*多个已修复的）？***

**链接版本和错误跟踪的最佳实践是什么？**

* * *

# 答案

似乎为每个版本克隆 bug 是一种很好的跟踪方式，因此目标版本总是在里程碑和修复版本中被跟踪，而有 bug 的版本总是原生版本。

此外，让每个克隆都阻止原始错误，使其成为将历史追溯到原始提交的好方法。

虽然我已经接受了答案，但我仍然欢迎您的意见。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T09:48:52.563

通常，如果我们需要修复多个发布版本（通常是源代码存储库中的分支）中的某些内容，则会为每个分支克隆错误，以便可以单独跟踪所有提交和发布状态。我认为我们唯一不这样做的时候是更改与代码库本身没有直接关系，并且不能简单地通过更新我们的库来修复。

至于一般的版本跟踪，这让我觉得这是一种合理的做事方式，因为我们通常只需要随时支持 2-3 个主要版本（加上主干）。如果您有多个不相交的版本需要支持，例如客户特定的部署，那么事情将更难跟踪。（可以说这通常会引起头痛，最好将事物统一到更中心的版本主题中）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-13T10:22:28.957

我使用 Bugzilla 不仅可以跟踪错误，还可以跟踪新功能、增强功能和模糊的想法。对于每个计划和发布的版本，我都有一个 Tracking Bug（我在最初的 Mozilla bugzilla 上看到的，并且发现它很有用）。

因此，如果您有错误报告，请输入带有报告的版本号的错误。创建额外的错误（您计划修复它的每个版本一个），这些错误都依赖于（阻止）原始错误并阻止特定于版本的跟踪错误。

如果阻止原始错误的所有错误都已关闭/验证（无论您的 QA 实施什么），您也可以关闭原始错误。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-05-29T12:29:23.187

我在 TFS 中寻找类似的功能，在进行一些调查时，我发现在 Bugzilla 中有一个管理“目击”的增强请求：“Bug 55970 - (bz-branch) Bugzilla 需要更好地处理分支（实现目击事件）”： [https ://bugzilla.mozilla.org/show_bug.cgi?id=55970](https://bugzilla.mozilla.org/show_bug.cgi?id=55970)

还有一个提议的设计： [https ://bug55970.bugzilla.mozilla.org/attachment.cgi?id=546912](https://bug55970.bugzilla.mozilla.org/attachment.cgi?id=546912)

有关信息，我们将在 TFS 2010 中实现类似的东西，使用“Bug Parent”或“Bug Master”来保存有关错误本身的信息（重现步骤、严重性、技术信息、受影响的组件......），即可以有类型为“Bug Child”或“Sighting”的子级，它将保存特定于给定分支的信息（目标里程碑、优先级、该分支的特定信息......）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-06T16:48:39.647

我们正在使用jira，但仍然有这个问题。我认为这是一个需求问题以及如何使用版本而不是任何一种工具。

**谁使用版本以及他们如何使用它们？
版本与项目计划中的里程碑有何关联？**

我们使用 4 decet 版本（major.minor.patch.buildNO）。buildNo 是构建时的 SVN 头版本号。每个版本都存储在 JIRA 中，问题有一个影响版本和固定版本字段，这是一个多选。

不久之后，我们有很多版本。Jira 确实允许我们以两种方式控制列表 1\. 存档版本（从选择列表中显示为灰色） 2\. 合并版本（将多个版本一起滚动到新版本中 - 不可撤消）

我们使用了存档，但由于缺少撤消而避免了合并。所以我们仍然有许多版本的列表。

我敢肯定，您可以通过一些脚本和时间在 Bugzilla 中完成合并操作，问题是：什么时候可以将几个旧版本合并在一起？

如果我已经发布，我是否需要知道我在开始和发布之间有 17 个构建？我是否需要了解在 build 1 中发现的 bug，在 2 中修复，在 7 中再次发现，在 9 中再次修复？还是在 1.0.0 版中找到在 1.0.1 版中修复是否足够好？

我将在今天晚些时候就这个话题提出一个大问题，但我已经知道基本答案： -**取决于您的团队想要如何跟踪事情。**

实施很有趣，但这一切都归结为需求、目标和从用户体验到解决方案的工作。当人们不一定知道要如何使用他们想要使用的形式并不完全存在的东西时，这很粗糙。

# java - JOptionPane 不会在其他窗口之上显示其对话框

> ID：438463
> 
> 赞同：13
> 
> 时间：2009-01-13T09:43:19.003
> 
> 标签：java, swing, joptionpane

我的挥杆提醒应用程序目前有问题，它能够在关闭时最小化到托盘。我的问题是，我需要根据我设置的 JOptionPane 对话框按时弹出，但这里的问题是，当我将其最小化时，对话框会弹出，但不会在其他应用程序（如资源管理器、firefox）时弹出窗口顶部正在运行，任何人都知道如何在窗口顶部弹出对话框，无论正在运行什么应用程序？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2013-03-24T22:24:53.270

创建一个分别为空的虚拟 JFrame，将其始终设置在顶部，并将其用作 JOptionPane 的组件，而不是 null。因此，JOptionPane 始终位于应用程序的所有其他窗口之上。您还可以通过虚拟 JFrame 的位置确定 JOptionPane 在屏幕上的显示位置。

```
JFrame frmOpt;  //dummy JFrame

private void question() {
    if (frmOpt == null) {
        frmOpt = new JFrame();
    }
    frmOpt.setVisible(true);
    frmOpt.setLocation(100, 100);
    frmOpt.setAlwaysOnTop(true);
    String[] options = {"delete", "hide", "break"};
    int response = JOptionPane.showOptionDialog(frmOpt, msg, title, JOptionPane.YES_NO_OPTION, JOptionPane.QUESTION_MESSAGE, null, options, "delete");
    if (response == JOptionPane.YES_OPTION) {
        removeRow();
    }
    frmOpt.dispose();
} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2015-04-16T09:34:44.777

旧帖子，但我一直在努力解决这个问题。

我的问题更多是 Javafx 允许 JOptionPane 落后于当前的 Java 窗口。

因此，我使用了以下内容，通过将 JOptionPane 放在所有窗口前面来完成原始海报的要求；甚至是 JAVAFX。

首先是旧的 JOptionPane：

```
JOptionPane.showMessageDialog(null, "Here I am"); 
```

现在是一个留在前面的 JOptionPane：

```
final JDialog dialog = new JDialog();
dialog.setAlwaysOnTop(true);    
JOptionPane.showMessageDialog(dialog, "Here I am"); 
```

为了好玩，这里的所有内容都排在一条长线上：

```
JOptionPane.showMessageDialog(
                 ((Supplier<JDialog>) () -> {final JDialog dialog = new JDialog(); dialog.setAlwaysOnTop(true); return dialog;}).get()
                 , "Here I am"); 
```

您可以在某个地方创建一个静态方法，该方法将为您返回 JDialog，然后在 JOptionPane 中调用它以稍微清理您的代码。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-14T20:02:37.333

您正在使用其中一种罐装 JOptionPanes 吗？（如 JOptionPane.showCONfirmDialog(...)）

您可能想查看扩展 JDialog 并制作自己的对话框面板，然后调用 myDialog.setAlwaysOnTop(true);

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-13T12:43:59.933

自 XP 以来，Windows 已阻止此操作。

之前的场景是这样的：您在编辑器中输入了一些文本，但在您提示文本时没有意识到另一个对话框正在出现。即将到来的对话框获得焦点，您正在新对话框中小费。也许您在准备好后单击回车并在错误的对话框中执行此操作，该对话框询问您是否真的要删除硬盘；）

Java 中的前台调用仅适用于 Java 窗口。

通知用户新窗口的可能性是实现一个框架，它将在窗口任务栏中突出显示/闪烁。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-15T01:57:57.070

更正上面的帖子..

我已经解决了我的问题如下：

```
this.setVisible(true); // show main frame
MyDialog dialog = New MyDialog(this, true); // show my custom dialog
dialog.setVisible(true);
this.setVisible(false); 
```

这对我来说可以 ：）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-14T19:40:10.687

您可能会考虑改用 JFrame。它可能会给你更多的灵活性。

如果您使用的是 JFrame，并且希望它在其他窗口之上弹出，请使用：

```
myFrame.setVisible(true);
myFrame.setState(Frame.NORMAL); 
```

如果之前处于最小化状态，setState 将向用户显示窗口。

# java - 更改日期格式

> ID：438473
> 
> 赞同：0
> 
> 时间：2009-01-13T09:49:31.860
> 
> 标签：java, openoffice.org, calc

在 Calc 中，我将单元格值设置为“2006/10/03 13:33:55.448”，Calc 说它是标准格式。我正在使用 Java 执行此操作，我想将格式设置为“DD.MM.YY HH:MM:SS AM/PM”：

```
XNumberFormatTypes xFormatTypes = (XNumberFormatTypes) UnoRuntime.queryInterface(XNumberFormatTypes.class, xNumberFormats);
int myDateFormat = xNumberFormats.addNew("DD.MM.YY HH:MM:SS AM/PM", defaultLocale);
XPropertySet cellRangePropSet = (XPropertySet) UnoRuntime.queryInterface(XPropertySet.class, cellRange);
cellRangePropSet.setPropertyValue("NumberFormat", new Integer(myDateFormat)); 
```

但细胞看起来还是一样的。我是否必须刷新范围以使单元格显示“03.10.06 01:33:55 PM”？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T14:21:40.893

不，我不会在我的任何项目中这样做。问题是我在 Calc 中导入了一个 csv 文件，并指定日期列的类型为 Standard。然后我将其更改为日期（YY/MM/DD），代码神奇地工作了。:)

# sql-server-ce - Sql Compact 随机产生 AccessViolationException

> ID：438477
> 
> 赞同：6
> 
> 时间：2009-01-13T09:50:47.320
> 
> 标签：sql-server-ce, access-violation

我在多线程应用程序中运行 Sql Server Compact Edition 3.5.1.0 SP1。应用程序在事务中随机运行插入查询。通过短交易，它可以正常工作。但是当事务变得更长并且执行之间的延迟变得更短或者当我在调试模式下运行应用程序时，SqlCE 开始随机抛出以下异常：

> AccessViolationException 试图读取或写入受保护的内存。这通常表明其他内存已损坏。
> 
> 在 System.Data.SqlServerCe.SqlCeCommand.CompileQueryPlan() 在 System.Data.SqlServerCe.SqlCeCommand.ExecuteCommand(CommandBehavior 行为，字符串方法，ResultSetOptions 选项) 在 System.Data.SqlServerCe.SqlCeCommand.ExecuteNonQuery() 在 SqlCompactTest.TransactedCommandGroupExecutionTest.Test () 在 D:\Projects\PlayGround\SqlCompactTest\SqlCompactTest\TransactedCommandGroupExecutionTest.cs: SqlCompactTest.ExecutionTest.RunTest 的第 53 行 D:\Projects\PlayGround\SqlCompactTest\SqlCompactTest\ExecutionTest.cs: SqlCompactTest.ExecutionTest 的第 60 行D:\Projects\PlayGround\SqlCompactTest\SqlCompactTest\ExecutionTest.cs 中的 .TimerElapsed(Object sender, ElapsedEventArgs e)：System.Timers.Timer.MyTimerCallback(Object state) 的第 68 行

我正在运行的代码是：

```
IDbConnection connection = m_connectionProvider.GetConnection(); // Just returns new connection

connection.Open();
IDbTransaction transaction = connection.BeginTransaction();

foreach (IDbCommand command in m_commands)
{
    command.Connection = connection;
    command.ExecuteNonQuery(); // This line throws exception
    Thread.Sleep((int)m_delayBetweenExecutions);
}

transaction.Commit();
connection.Close(); 
```

此代码在两个线程中同时运行。连接字符串是：

```
"Data Source=testDB.sdf;Encrypt Database=True;Password=test;File Mode=Read Write;Persist Security Info=False;Max Database Size=1024" 
```

我在 Internet 上发现了一些荒谬的解决方案，例如恢复到 Framework 1.1、更改方法参数的顺序、启用/禁用优化等，但它们都不适合我。[我还在微软网站上](http://www.google.co.uk/search?hl=en&q=sql+server+compact+accessviolationexception+site:microsoft.com&meta=)迭代了可能的解决方案，但我找不到适合我的解决方案。我的数据库文件版本是 3.5.0.0。

我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-15T16:20:49.217

仅仅因为您设置了与 command.Connection 的连接并不意味着它已设置。

```
command.Connection = connection;
command.Connection.GetHashCode() == connection.GetHashCode(); // may return false. 
```

这就是问题的原因。可以通过使用 connection.CreateCommand(); 来纠正

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-10-31T17:57:08.327

[SQL CE 对象不是线程安全的](https://docs.microsoft.com/en-us/archive/blogs/sqlservercompact/troubleshooting-access-violation-exception-while-using-sql-server-compact-database-with-ado-net-provider)。此外，同一篇文章列出了版本不匹配的情况（在我的案例中发生了）。

# data-storage - enCapsa - 它是什么以及用于什么？

> ID：438479
> 
> 赞同：0
> 
> 时间：2009-01-13T09:50:59.800
> 
> 标签：data-storage

这可能不是一个纯粹的编程问题，但我正在寻找有关 enCapsa 的信息。你知道它是什么吗，你用过吗？我正在阅读一些有关它的论文，但我无法真正了解它是如何工作的以及它可以在 IT 公司中用于什么（这是我应该找出的）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-13T10:16:42.663

基本上 enCapsa 是一个共享数据存储系统，专注于提供一种存储任何类型数据的方法（甚至来自以太数据源，例如不同设计的数据库表），并因此通过一种人类友好的查询来获取它，就像在搜索中一样引擎。它们提供了从任何地方上传数据的可能性（它基于 CSV），然后下载以在您需要的任何地方使用。用途很多，考虑到它是一个可通过网络访问的集中式数据库，他们说它符合高安全标准。使用此服务的一种有用方法是将数据存储在其中，而无需在公司计算机之间保持同步。

# php - PHP图片上传问题

> ID：438486
> 
> 赞同：0
> 
> 时间：2009-01-13T09:53:31.103
> 
> 标签：php

```
<td valign="top">
<input type="hidden" name="MAX_FILE_SIZE" value="12485760" />
Image?</td>
<td><input type="file" name="image">

$path = "uploads/";
$path .= basename($_FILES['image']['name']);

$path = addslashes($path);
$name = $_FILES['image']['name'];

echo $path;

move_uploaded_file($_FILES['image']['tmp_name'], $path); 
```

上面的代码应该可以工作，因为我有一个非常相似的代码可以很好地工作。但是，它似乎没有从表单中获取任何内容（最上面的代码）。如果有人能指出我是如何成为一个傻瓜并打破这一点，我将不胜感激。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-13T09:58:38.287

确保您的标签`enctype="multipart/form-data"`上有该属性。`<form>`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T13:10:07.853

你知道这是完全不安全的，对吧？您可能能够在只有受信任用户的 Intranet 上摆脱它，但否则此代码肯定会遇到麻烦。

不能依赖 file['name'] 包含任何可用作文件名的内容，攻击者可以轻松地将其设置为包含“..”路径部分的内容，以覆盖上传文件夹之外的文件。通过上传扩展名为 .php 的文件，他们很可能会在您的服务器上执行任意代码。

如果您完全使用 file['name'] ，则必须对其进行严格清理（例如，删除所有非字母数字字符并自己添加适当的文件扩展名），并且您将不得不处理根本没有获得文件名的可能性（在这种情况下，您必须从例如随机数中组成一个）。

“echo $path”还为您提供了导致跨站点脚本攻击的 HTML 注入。

addlashes() 不会保护您免受目录遍历或 HTML 注入。它也无法正确转义 SQL 字符串，这是它最初的目的。一个好的经验法则是，任何使用 addlashes() 的应用程序（显式地或通过 magic_quotes 隐式地）都做错了。

# frameworks - 是否期望向客户披露项目中使用的所有框架/开源软件

> ID：438492
> 
> 赞同：2
> 
> 时间：2009-01-13T09:57:43.810
> 
> 标签：frameworks, disclosure

当我遇到使用来自 Csla 框架的验证代码时，这让我大吃一惊。感觉就像我因为没有向客户透露框架的使用而受到谴责。

这与使用 jQuery 等库不同吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T10:14:52.387

你绝对应该承认你正在使用什么，IMO。

一些客户可能有特别严格的法律要求（无论是否出于正当理由——他们是客户，你不能判断他们的工作人员），并且详细说明你用来为他们创建产品的任何第三方软件似乎只是合理的。

你有什么理由*不想*对你的客户敞开心扉？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T10:01:03.960

这取决于您使用的开源代码的许可证。其中许多要求在某些学分部分中确认使用，其他要求您重新分发源代码等。您应该阅读许可证并采取相应的行动。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T10:03:03.190

也是一样，我感觉你也会因为使用 jQuery 而受到谴责。有些企业出于各种原因不赞成使用开源。

他们归结为

*   许可证的类型以及它迫使用户做什么
*   以某种商业形式提供支持
*   需要“共享”结果

您应该知道您的客户/雇主对此的立场。如果他们没有立场，那么您必须逐案讨论。

我通常会告诉人们我使用了很多开源软件，并且通过看到我得到的回复，我知道要遵循的路径。如果他们一提到开源和缺乏支持等等就大喊大叫，我只是倾向于要求预算购买商业组件或提供很好的案例来说明为什么开源版本的 X 比商业替代品更好。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-13T10:04:24.390

这取决于项目、客户类型以及您拥有的任何合同。然而，对于一个典型的向客户交付代码的顾问，我会说不，你会因为没有用诸如使用 CSLA 之类的细节来打扰他们而受到谴责，这很奇怪。这很奇怪。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-13T10:05:14.187

这在很大程度上取决于项目的类型和客户的类型。这里真正的问题是您感到惊讶，这表明期望不一致。客户具体是如何激发其对 Csla 的兴趣的？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-13T10:33:01.430

如果您的客户需要知道或关心您使用哪种技术，那么您应该将所有内容指定为项目文档的一部分。如果清楚地描述了这些选择，那么如果需要，就更容易讨论它们。如果这是您的工作方式，文档还为您提供了一种询问（字面意思）“签字”的方法。

从您的问题来看，尚不清楚问题是框架的选择，还是没有通知客户。

即使在文档最少的项目中，如果客户拥有代码，那么我总是至少提供一个*高级架构*文档，其中包括所使用的每个软件组件的名称和确切版本，以及它的用途和原因的简要说明它被选中了。这也是解决任何许可证问题的正确位置。

# ruby-on-rails - 自定义 Rails URL 参数分隔符？

> ID：438504
> 
> 赞同：1
> 
> 时间：2009-01-13T10:05:44.043
> 
> 标签：ruby-on-rails, url, arguments, params

我们正在使用 Ruby on Rails 构建一个 Facebook 应用程序。出于技术原因，我们目前正在将其从画布切换到 iframe 应用程序。

然而有一个问题，Facebook在 URL ( )`fb_sig_api_key`中以 GET 变量的形式发送给你和其他人。`blah.com/?fb_sig_api_key=12345&whatever=hello`

但是，由于某种原因，Facebook`&amp;`在每个变量之间传递 URL，而不是 plain `&`。这会导致 rails 没有得到`fb_sig_api_key`参数，但是`amp;fb_sig_api_key`.

那么，Rails 中是否有任何设置可以使其使用`&amp;`并`&`用作 GET URL 参数分隔符？

如果是 PHP，那将是一个快速的 php.ini 更改，但我们不是，所以.....帮助？哈哈

（目前我们正在开发一个快速而丑陋的 before_filter 以远离`amp;`所有参数的开头。）

PS 我们正在使用 Facebooker。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T19:21:04.157

I would suggest create another hash in the controller in `before_filter` too

```
before_filter :fetch_params_values

private

def fetch_params_values
  # create another hash to handle querystring
  @params = request.query_string.split(/&amp;/)
end 
```

# java - 如何在受限小程序中安全地触发 Swing-Action？

> ID：438508
> 
> 赞同：0
> 
> 时间：2009-01-13T10:07:53.307
> 
> 标签：java, security, swing, applet, action

我只是想从我自己的弹出菜单中调用一个摆动动作。但由于有一个安全管理器，我需要一个解决方案来调用此操作而不直接调用它。例如，文本组件的粘贴操作将失败，因为如果调用堆栈中有我的任何类，则无法加载 sun.swing.SwingUtilities2。

有没有办法将事件排入事件线程？JComponent.dispatchEvent 不做这项工作，因为它自己处理事件。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-13T12:35:14.397

简短的回答：你不能不签署小程序。

长答案：如果您可以在没有权限的情况下，您可以将所有类型的有趣消息排队。您的示例，粘贴或长格式：有权访问客户之前复制的内容，是客户需要了解和授权的操作。考虑一个监视剪贴板的 rouge 小程序，“粘贴”所有内容并通过网络将其发送到远程服务器。例如，您的 PIN。

解决方案是签署你的小程序，从而告诉客户“这个小程序不是邪恶的，这是你的责任。” 并询问用户他/她是否相信你。如果是，安全管理员将不再阻止您。如果不是 - 好吧，用户不信任你，JVM 为什么要不然呢？

见[http://java.sun.com/developer/onlineTraining/Programming/JDCBook/signed.html](http://java.sun.com/developer/onlineTraining/Programming/JDCBook/signed.html)

# undo - 在事务数据库中撤消

> ID：438510
> 
> 赞同：3
> 
> 时间：2009-01-13T10:10:02.850
> 
> 标签：undo, interface-implementation, transactional-database

我不知道如何使用事务数据库实现用户友好界面的撤消属性。

一方面，建议用户具有多级（无限）撤消的可能性，如[答案](https://stackoverflow.com/questions/125269/how-would-you-handle-users-who-dont-read-dialog-boxes)中所述。可能有助于解决此问题的模式是[Memento](http://en.wikipedia.org/wiki/Memento_pattern) 或[Command](http://en.wikipedia.org/wiki/Command_pattern)。

然而，使用包含触发器、不断增长的序列号和不可逆过程的复杂数据库，很难想象撤消操作如何在事务边界之外的不同点工作。换句话说，撤消到最后一次提交的事务只是一个回滚，但是怎么可能回到不同的时刻呢？

**更新**（基于到目前为止的答案）：我不一定希望在修改已经提交时撤消工作，我会专注于具有开放事务的正在运行的应用程序。每当用户单击保存时，这意味着提交，但在保存之前 - 在同一事务期间 - 撤消应该起作用。我知道使用数据库作为持久层只是一个实现细节，用户不应该为此烦恼。但是，如果我们认为“数据库中的撤消和 GUI 中的撤消概念是根本不同的东西”并且我们不对数据库使用撤消，那么无限撤消只是一个流行词。我知道“回滚是......不是用户撤消”。

那么如何在同一个事务中实现“任何更改导致的级联效果”的客户端级撤消呢？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-13T10:28:45.137

在数据库和 GUI 中撤消的想法是根本不同的东西。GUI 将是一个单用户应用程序，与其他组件的交互水平较低；数据库是一个多用户应用程序，其中的更改可能会因任何更改而产生级联效应。

要做的事情是允许用户尝试将先前的状态应用为新事务，这可能会或可能不会起作用；或者只是在提交后没有撤消（类似于保存后没有撤消，这是许多应用程序中的一个选项）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-13T10:24:18.280

一些（全部？）DBMS 支持保存点，允许部分回滚：

```
savepoint s1;
insert into mytable (id) values (1);
savepoint s2;
insert into mytable (id) values (2);
savepoint s3;
insert into mytable (id) values (3);
rollback to s2;
commit; 
```

在上面的示例中，只保留第一个插入，其他两个将被撤消。

我认为一般来说在提交后尝试撤消是不切实际的，因为你给出的原因*可能还有其他原因。如果在某些情况下是必不可少的，那么您将不得不构建大量代码来执行此操作，并考虑触发器等的影响。

*   不过，我认为不断增加的序列没有任何问题吗？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T11:17:59.763

这与 William 的帖子（我实际上投了赞成票）几乎相同，但我试图更详细地指出，为什么需要实现用户撤消（与使用数据库回滚相比）。

了解有关您的应用程序的更多信息会有所帮助，但我认为对于用户（友好的）撤消/重做数据库不是实现该功能的充分层。

1.  用户想要撤消他所做的操作，与这些操作是否导致没有/一个/多个数据库事务无关
2.  用户想要撤消他所做的操作（不是其他人的）

从我的角度来看，数据库是实现细节，是一种工具，您可以用作存储数据的程序员。回滚是一种可以帮助您执行此操作的撤消，它不是用户撤消。使用回滚意味着让用户参与他不想知道和不理解（也不必）的事情，这绝不是一个好主意。

正如威廉所发布的那样，您需要在客户端或服务器端实现作为会话的一部分，它跟踪您定义为用户事务的步骤并能够撤消这些步骤。如果在这些用户事务期间进行了数据库事务，则需要其他数据库事务来撤销这些事务（如果可能）。如果无法撤消，请确保提供有价值的反馈，这再次意味着，从业务角度而非数据库角度进行解释。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-13T10:35:10.960

我们通过跟踪应用于数据的所有事务（不是所有事务，只是不到 3 个月大的事务）在我们的数据库中开发了这种可能性。基本的想法是能够看到谁在什么时候做了什么。每个由其 GUID 唯一标识的数据库记录可以被视为一个 INSERT、多个 UPDATE 语句和最后一个 DELETE 语句的结果。由于我们跟踪所有这些 SQL 语句，并且由于 INSERT 是全局 INSERTS（所有字段值的跟踪都保存在 INSERT 语句中），因此可以：

*   知道谁修改了哪个字段以及何时修改：Paul 在形式发票中插入了新行，Bill 重新协商了商品的单价，Pat 修改了最终订购数量等）
*   使用以下规则“撤消”所有先前的交易：

    “INSERT”撤消是基于唯一标识符的“DELETE”

    'UPDATE' 撤消等同于之前的'UPDATE'

    'DELETE' 撤消等同于第一个 INSERT，然后是所有更新

*   由于我们不跟踪超过 3 个月的交易，UNDO 并非始终可用。

对这些功能的访问仅限于数据库管理员，因为不允许其他用户在业务规则之外进行任何数据更新（例如：采购订单行上的“撤消”的含义是什么？供应商是否同意？）。说实话，我们很少使用这个选项（一年几次？）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-13T11:23:43.903

要维护任意回滚到以前的语义，您需要在数据库中实现逻辑删除。这工作如下：

每条记录都有一个“已删除”标志、版本号和/或“当前指标”标志，具体取决于您需要重建的聪明程度。此外，您需要跨该实体的所有版本的每个实体键，以便您知道哪些记录实际上引用了哪个特定实体。如果您需要知道某个版本适用的时间，您还可以使用“From”和“To”列。

删除记录时，将其标记为“已删除”。当您更改它时，您会创建一个新行并更新旧行以反映其过时情况。使用版本号，您可以找到要回滚到的先前版本。

如果您需要参照完整性（您可能会这样做，即使您认为不需要）并且可以处理额外的 I/O，您还应该有一个父表，其中键作为所有版本的记录的占位符。

在 Oracle 上，聚簇表对此很有用；父表和版本表都可以放在一起，从而最大限度地减少 I/O 的开销。在 SQL Server 上，包含键的覆盖索引（可能聚集在实体键上）将减少额外的 I/O。

# c++ - 如何在 C++ 中跟踪内存分配（尤其是新建/删除）

> ID：438515
> 
> 赞同：38
> 
> 时间：2009-01-13T10:13:38.647
> 
> 标签：c++, debugging, memory-management

如何跟踪 C++ 中的内存分配，尤其是由`new`/完成的分配`delete`。对于一个对象，我可以轻松地覆盖`operator new`，但我不确定如何全局覆盖所有分配，因此它们会通过我的自定义`new`/ `delete`。这应该不是一个大问题，但我不确定这应该如何完成（`#define new MY_NEW`？）。

一旦这个工作正常，我会假设在某处有一个分配指针/位置的映射就足够了，所以我可以跟踪所有当前“活动”的分配，并且 - 在应用程序结束时 - 检查分配还没有被释放。

好吧，这似乎又像是至少已经做过几次的事情了，那么那里有什么好的库（最好是便携式的）？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-01-13T17:14:05.723

我建议你使用`valgrind`linux。它将捕获未释放的内存，以及写入未分配内存等其他错误。另一个选项是 mudflap，它也告诉你没有释放内存。使用`-fmudflap -lmudflap`gcc 选项，然后使用`MUDFLAP_OPTIONS=-print-leaks ./my_program`.

这是一些非常简单的代码。它不适合复杂的跟踪，但旨在向您展示原则上您将如何做到这一点，如果您要自己实现它。像这样的东西（省略了调用注册的 new_handler 和其他细节的东西）。

```
template<typename T>
struct track_alloc : std::allocator<T> {
    typedef typename std::allocator<T>::pointer pointer;
    typedef typename std::allocator<T>::size_type size_type;

    template<typename U>
    struct rebind {
        typedef track_alloc<U> other;
    };

    track_alloc() {}

    template<typename U>
    track_alloc(track_alloc<U> const& u)
        :std::allocator<T>(u) {}

    pointer allocate(size_type size, 
                     std::allocator<void>::const_pointer = 0) {
        void * p = std::malloc(size * sizeof(T));
        if(p == 0) {
            throw std::bad_alloc();
        }
        return static_cast<pointer>(p);
    }

    void deallocate(pointer p, size_type) {
        std::free(p);
    }
};

typedef std::map< void*, std::size_t, std::less<void*>, 
                  track_alloc< std::pair<void* const, std::size_t> > > track_type;

struct track_printer {
    track_type * track;
    track_printer(track_type * track):track(track) {}
    ~track_printer() {
        track_type::const_iterator it = track->begin();
        while(it != track->end()) {
            std::cerr << "TRACK: leaked at " << it->first << ", "
                      << it->second << " bytes\n";
            ++it;
        }
    }
};

track_type * get_map() {
    // don't use normal new to avoid infinite recursion.
    static track_type * track = new (std::malloc(sizeof *track)) 
        track_type;
    static track_printer printer(track);
    return track;
}

void * operator new(std::size_t size) throw(std::bad_alloc) {
    // we are required to return non-null
    void * mem = std::malloc(size == 0 ? 1 : size);
    if(mem == 0) {
        throw std::bad_alloc();
    }
    (*get_map())[mem] = size;
    return mem;
}

void operator delete(void * mem) throw() {
    if(get_map()->erase(mem) == 0) {
        // this indicates a serious bug
        std::cerr << "bug: memory at " 
                  << mem << " wasn't allocated by us\n";
    }
    std::free(mem);
}

int main() {
    std::string *s = new std::string;
        // will print something like: TRACK: leaked at 0x9564008, 4 bytes
} 
```

我们必须为我们的地图使用我们自己的分配器，因为标准分配器将使用我们覆盖的运算符 new，这将导致无限递归。

确保如果您覆盖 operator new，您使用地图来注册您的分配。删除由 new 的放置形式分配的内存也将使用该 delete 运算符，因此如果您不知道的某些代码重载了 operator new 而不使用您的 map，这可能会变得很棘手，因为 operator delete 会告诉您它没有被分配并且用于`std::free`释放内存。

另请注意，正如*Pax*也为他的解决方案指出的那样，这只会显示由使用我们自己定义的运算符 new/delete 的代码引起的泄漏。因此，如果您想使用它们，请将它们的声明放在头文件中，并将其包含在所有应查看的文件中。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2011-02-25T17:22:26.007

具体来说，使用 valgrind 的 massif 工具。与 memcheck 不同，massif 不关心内存的非法使用，而是跟踪一段时间内的分配。它在“有效”测量程序的堆内存使用方面做得很好。最好的部分是，您不必编写任何代码。尝试：

[http://valgrind.org/docs/manual/ms-manual.html](http://valgrind.org/docs/manual/ms-manual.html)

或者如果你真的不耐烦：

```
valgrind --tool=massif <executable> <args>
ms_print massif.out.<pid> | less 
```

这将为您提供一段时间内的分配图，并追溯大分配发生的位置。这个工具最好在Linux上运行，不知道有没有Windows的变种。它*确实*适用于 OS X。

祝你好运！

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-01-13T10:33:58.840

您可以使用[http://www.flipcode.com/archives/How_To_Find_Memory_Leaks.shtml](http://www.flipcode.com/archives/How_To_Find_Memory_Leaks.shtml)上的代码并进行以下修改：给出的代码仅在您有一个大的 honkin 源文件时才有效。我整理了这个关于 SO（[这里](https://stackoverflow.com/questions/434522/anyone-knows-how-to-fix-compile-error-lnk2005-source-code-inside#434529)）的另一个问题。

首先，*不要*更改 stdafx.h，在您自己的文件中进行修改。

制作一个单独的头文件 mymemory.h 并将您的函数原型放入其中，例如（请注意，这没有*body*）：

```
inline void * __cdecl operator new(unsigned int size,
    const char *file, int line); 
```

同样在该标头中，放置 AddTrack()、DumpUnfreed() 等的其他原型，以及 #defines、typedef 和 extern 语句：

```
extern AllocList *allocList; 
```

然后，在一个新的 mymemory.cpp（也是 #include 的 mymemory.h）中，将 allocList 的实际定义与所有实际函数（不仅仅是原型）一起放入，并将该文件添加到您的项目中。

然后，`#include "mymemory.h"`在您需要跟踪内存的每个源文件中（可能是所有源文件）。因为头文件中没有定义，所以在链接期间您不会得到重复，并且因为声明在那里，您也不会得到未定义的引用。

请记住，这不会跟踪您未编译的代码（例如，第三方库）中的内存泄漏，但它应该让您了解自己的问题。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-01-13T10:24:28.127

好吧，您可以重新实现全局运算符 new 和 delete 以提供您想要的功能，但我建议您不要这样做，除非这是跟踪内存分配的唯一方法，例如由于您的平台的限制。

内存调试器可用于大多数常见的开发平台。查看[PurifyPlus](http://www-01.ibm.com/software/awdtools/purifyplus/)以了解适用于 Windows 和各种 Unix 的商业解决方案，或[valgrind](http://valgrind.org/)了解适用于 Linux（以及可能的其他操作系统，但我只在 Linux 上使用过）的开源解决方案。

如果您打算替换全局运算符，请查看[这篇文章](http://www.informit.com/articles/article.aspx?p=30642&seqNum=3)。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-13T10:50:26.497

对于我们的 Windows 平台 C++ 项目，我使用 VLD，Visual Leak Detector，它几乎太容易实现了，它可以在您的应用程序退出时跟踪和报告内存泄漏 - 最好的是它是免费的并且源代码可用。该系统可以设置为以多种方式进行报告（磁盘记录器、IDE、XML 等），并且对于检测 Windows 服务中的泄漏非常有用，而这些泄漏始终是调试的挑战。因此，当您正在寻找便携式解决方案时，如果您想自己动手，您当然可以查看源代码以获取指导。希望能帮助到你。

引用该网站：

> 这是快速诊断和修复 C/C++ 应用程序中的内存泄漏的一种非常有效的方法。

[http://dmoulding.googlepages.com/vld](http://dmoulding.googlepages.com/vld)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-13T11:07:41.627

在 Linux 上，至少有两种传统方法：

*   malloc() 和 free() （以及其他与内存相关的函数）是弱符号，这意味着您可以简单地重新实现它们并且将使用您的版本。有关实施示例：请参阅电围栏。
*   使用 LD_PRELOAD 环境变量，您可以使用 LD_PRELOAD 环境变量中包含的库中的符号覆盖共享库中的符号（弱符号和强符号）。如果你用 malloc()、free() 和朋友编译一个共享库，你就准备好了。再次，电围栏证明了这一点。

因此，您不仅可以捕获 new 和 delete，还可以捕获 C 风格的内存分配函数。我还没有在 Windows 上做到这一点，但我已经看到了重写 DLL 如何在那里链接的方法（尽管我记得它们有点笨拙）。

但是请注意，除了这些是有趣的技术之外，我建议您使用 valgrind 来做您想做的最重要的事情。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-03-15T10:34:04.670

如果您在 Windows 下开发，免费工具 DebugDiag 将有助于查找内存和处理泄漏。

您无需为 DebugDiag 工作而增强您的程序。

[http://www.microsoft.com/downloads/details.aspx?FamilyID=28BD5941-C458-46F1-B24D-F60151D875A3&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=28BD5941-C458-46F1-B24D-F60151D875A3&displaylang=en)

虽然它不是最简单或最直观的程序！确保您在谷歌上搜索有关如何使用它的教程和说明。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-13T10:21:47.677

不直接回答您的问题，但如果您真的只想在程序结束时获取泄漏的堆对象列表，您可能只需使用[valgrind](http://valgrind.org/)运行程序。

对于 MS VS，您可以使用[Debug CRT Heap](http://msdn.microsoft.com/en-us/library/974tc9t1(VS.80).aspx)。不像valgrind那么简单，这里解释的有点多，但可以做你想做的。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-07-29T07:28:05.293

如果我需要一个工具，我通常从我的编译器/标准库提供的东西开始。

*   如果你使用 glibc，你可以使用[mtrace](http://man7.org/linux/man-pages/man3/mtrace.3.html)。它安装了一个全局钩子，记录每个 glibc 内存分配函数（malloc、realloc、memalign、free，以及在它们之上实现的所有内容，如 new/delete）
*   如果您使用 Microsoft CRT，您可以查看[CRT Debug Heap Details](https://msdn.microsoft.com/en-us/library/974tc9t1.aspx)。有一些示例如何安装调试版本的内存分配功能、获取堆统计信息、查找内存泄漏等。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-13T11:06:42.347

如果您打算将其作为编程练习来做，那么编写自己的智能指针类可能会给您更多的洞察力，并在整个项目（或项目的模块）中始终如一地使用它们。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-13T11:17:31.043

如果你在 linux 下开发，最好的工具之一（例如检测内存泄漏，跟踪在某些代码位置完成的分配）是 valgrind，尤其是它的 massif 工具。唯一的缺点是程序运行速度较慢（或慢得多），因此它仅对调试有用。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-13T11:26:51.993

我注意到很多其他答案都集中在您可以使用哪些工具上。我已经使用了其中的一些，它们帮助很大。

但是作为编程练习，并且看到您使用 c++，您将需要覆盖全局 new 和 delete，以及 malloc、free 和 realloc。您可能认为只覆盖 new 和 delete 就足够了，但 std::string 和其他类可能会使用 malloc，尤其是 realloc。

然后，一旦你有了这个，你就可以开始添加头来检查内存覆盖，记录每个分配的堆栈跟踪等等。

总而言之，我建议您使用此处提到的工具之一，但编写自己的系统可能会很有趣。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2011-02-26T14:06:58.120

它并不便宜，但在我的 C++ 时代，我曾经发现[purify](http://www-01.ibm.com/software/awdtools/purify/)是调试泄漏和其他内存问题的最佳工具（现在它归 IBM 所有，所以支持下降了）。 [Bounds Checker](http://www.microfocus.com/products/micro-focus-developer/devpartner/index.aspx)受到了一些人的喜爱，但对于我正在开发的软件来说效果不佳。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-01-05T04:49:41.283

您可以使用将此**[*链接*](http://www.embeddedsystemonline.com/programming-languages/cplusplus/program-to-track-memory-allocations-in-c-or-c)****[中给出的头文件 ( MemTracker.h](http://www.embeddedsystemonline.com/programming-languages/cplusplus/program-to-track-memory-allocations-in-c-or-c)** )添加到您的解决方案中，以跟踪 C 和 C++ 中的内存分配/释放。它显示您是否有内存泄漏以及哪一行代码对此负责。**[](http://www.embeddedsystemonline.com/programming-languages/cplusplus/program-to-track-memory-allocations-in-c-or-c)**

 ** * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-07-04T13:07:55.430

```
#include<iostream>

void * operator new(size_t size)
{
    std::cout<<"Allocating:"<<size<<std::endl;
  return malloc (size);
}

void operator delete(void *ptr)
{
    std::cout<<"Deleting:"<<ptr<<std::endl;
    free(ptr);
}

int main() {
    std::string ss("1234567890123456");
} 
```

如果你没有看到重载的运算符，（你可能在不同的编译器上，然后是我的 g++）尝试增加字符串的长度。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2018-02-26T16:29:04.540

现在检查这个小巧方便的代码，而不是`new`使用`NEW`和跟踪`NewHelper`构造函数中的所有分配：

```
#include <iostream>

class NewHelper
{
   private :
    void* addr = nullptr;
       public :
       NewHelper(void * addr_)
       {
          addr = addr_;
          std::cout<<addr<<std::endl;
       }
       template <class T>
       operator T ()
       {
           return (T)addr;
       }
};
#define NEW (NewHelper)(void*)new
int main()
{
  int * i = NEW int(0);
 return 0;
} 
```

# php - 如何仅使用 yast 命令行在 SUSE 10.1 上将 PHP 5.1 升级到 5.2？

> ID：438520
> 
> 赞同：3
> 
> 时间：2009-01-13T10:15:21.590
> 
> 标签：php, linux, command-line, opensuse, package-managers

如何从 SUSE 10.1 命令行将 PHP 5.1 升级到 5.2？是否有包管理器命令可以自动执行？

实际上，我需要 JSON 支持才能使用 JavaScript-RTE，并且相信它仅在 PHP 5.2 中提供。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T10:30:56.147

使用[zypper](http://en.opensuse.org/Zypper)怎么样？

我得到了这个，已经有最新的可用了。

```
aansari:~ # zypper in php
Downloading repository 'openSUSE-11.0-Updates' metadata [done]
Building repository 'openSUSE-11.0-Updates' cache [done]
Reading installed packages...
'php5' providing 'php' is already installed.
Nothing to do.
aansari:~ # 
```

# javascript - 在 ASP.NET MVC 中，为什么我的自定义 JavaScript 文件在 /Scripts 中不起作用？

> ID：438525
> 
> 赞同：1
> 
> 时间：2009-01-13T10:16:47.767
> 
> 标签：javascript, asp.net-mvc

我可以成功地在 /Scripts 中包含主要的 jquery 文件，但是如果我的自定义 test.js 文件在 Scripts 中，它将不起作用：

```
<script type="text/javascript" src="<%= this.ResolveClientUrl ("~/Scripts/jquery-1.2.6.js") %>"></script>
<script type="text/javascript" src="<%= this.ResolveClientUrl ("~/Scripts/test.js") %>"></script> 
```

但是，当我将自定义 test.js 文件移动到 /js 时，一切正常：

```
<script type="text/javascript" src="<%= this.ResolveClientUrl ("~/Scripts/jquery-1.2.6.js") %>"></script>
<script type="text/javascript" src="<%= this.ResolveClientUrl ("~/js/test.js") %>"></script> 
```

**这是为什么？**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T10:25:28.950

您可能已经尝试过，但请确保在检查诸如 javascript 包含的内容时清除客户端缓存。客户端可能持有 test.js 的旧副本。

更改 URL 将导致它再次获取最新的。

# svn - 改善工作中的开发环境

> ID：438530
> 
> 赞同：8
> 
> 时间：2009-01-13T10:21:23.933
> 
> 标签：svn, deployment, automation, trac, environment

在不久的将来，我将有大约 2 周的时间来移动和改进我们工作中的开发环境。

我们主要开发一个大型 PHP/MySQL 项目，有 2-10 名开发人员。

目前我们有一个开发服务器，使用 mod_userdir 运行 apache，每个开发人员在他的（samba 可访问）家中都有一个 /public_html 文件夹。对于 VCS 和项目管理/问题跟踪，我们使用 Subversion 和 Trac。测试/部署需要一些手动步骤，那里没有太多自动化。

我对新设置的计划包括对现有内容的以下更改：

*   持续集成
*   将 CI 集成到 Trac，创建/查找一个插件，该插件提供在构建进度成功或失败后启动操作（即部署到 staging/live）
*   创建自动化部署脚本（一键式）
*   将（[doxygen](http://www.doxygen.nl/)）文档集成到构建进度中，并以某种方式集成到 Trac
*   添加[自动版本控制](https://stackoverflow.com/questions/438398/subversion-as-version-incrementor-at-each-commit)
*   添加另一层监控（本地nagios监控我们的生产系统nagios）
*   添加一个夜间运行的 MySQL Replication Slave，然后开发人员可以使用它来测试 up2date 数据上的东西
*   查看备份计划
*   记录我以这种方式设置所有内容的方式和原因

您有什么可以进一步改进的提示/提示吗？我们应该以不同的方式做些什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T11:07:50.410

我会确保您编写自动部署脚本的方式可以让您的持续集成工具使用它们。[Hudson](http://hudson-ci.org/)（和我怀疑的 CruiseControl）基本上包装了这些脚本并提供了一个漂亮的前端。

Hundson is easy to install and comes with a [Trac plugin](http://hudson.gotdns.com/wiki/display/HUDSON/Trac+Plugin), SVN, CVS, Git plugins and a [Doxygen](http://hudson.gotdns.com/wiki/display/HUDSON/Doxygen+Plugin) plugin and others for almost anything you can think of. Caveat: I haven't used all these plugins and they may not do exactly what you want...

If you have a budget for CI software then TeamCity is well worth a look (or are you using [Bitten](http://bitten.edgewall.org/)?).

You've a great opportunity, so good luck!

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T10:33:05.707

我唯一的建议是不要花太多时间在

*   记录我以这种方式设置所有内容的方式和原因

这是我改进开发环境的清单中的最后一项，但我还没有这样做。

每个部分都在不断修改或改进，以便为我们提供更好的功能或更容易使用。我建议尽量将“为什么”作为注释保留在您实际实施它的位置。这是更改系统的人唯一需要它的地方。

也许还有一个显示物理服务器的链接和名称的大图，但除此之外，我发现文档很麻烦。

干杯

# javascript - 迭代使用 jQuery + Multi Select 这并不像人们想象的那么简单。我正在使用一个名为 jQuery MultiSelect 的插件和使用 XSLT 的多个 <select> 选项，如下所示： <xsl:for-each select="RootField"> <select id="{RootField}" multiple="multiple" size="3 "> <option value=""></option&

> ID：438538
> 
> 赞同：0
> 
> 时间：2009-01-13T10:25:42.693
> 
> 标签：javascript, jquery, multi-select

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T10:50:35.093

我以前没有听过“万圣节问题”的标签，但罗伯特可能是对的。
getElementsByTagName 返回的节点列表是动态的，即添加或删除，在这种情况下选择，将在节点列表创建后更改。

尝试

```
//hoping for magic here
$('select').multiSelect(); 
```

或者

```
$('select').each( function() {
    $(this).multiSelect();
}); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T10:37:17.723

听起来像是 multiSelect 中的万圣节问题（[http://blogs.msdn.com/mikechampion/archive/2006/07/20/672208.aspx](http://blogs.msdn.com/mikechampion/archive/2006/07/20/672208.aspx)），但由于我不知道 multiSelect 我不能肯定地说。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-04-13T05:26:41.777

尝试这个：

```
jQuery('select').each(function(){selectAll(this.id)}); 
```

# algorithm - (ProjectEuler) 总和组合

> ID：438540
> 
> 赞同：12
> 
> 时间：2009-01-13T10:26:17.683
> 
> 标签：algorithm

来自[ProjectEuler.net](http://projecteuler.net/)：

**Prob 76：一百个可以写成至少两个正整数的和有多少种不同的方式？**

我不知道如何开始......正确方向或帮助的任何点？我不是在寻找如何去做，而是在寻找一些关于如何去做的**提示。**

例如 5 可以写成：

```
4 + 1
3 + 2
3 + 1 + 1
2 + 2 + 1
2 + 1 + 1 + 1
1 + 1 + 1 + 1 + 1 
```

所以总共有6种可能性。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-01-25T22:37:29.693

[分区号](http://mathworld.wolfram.com/PartitionFunctionP.html)（或分区功能）是这个的关键。

如果您从底部开始并逐步向上看是否可以检测到任何模式，则此类问题通常会更容易。

*   P(1) = 1 = { [1](http://mathworld.wolfram.com/PartitionFunctionP.html) }
*   P(2) = 2 = {[2], [1 + 1]}
*   P(3) = 3 = {[3], [2 + 1], [1 + 1 + 1]}
*   P(4) = 5 = {[4], [3 + 1], [2 + 2], [2 + 1 + 1], [1 + 1 + 1 + 1]}
*   P(5) = 7 ...
*   P(6) = 11 ...
*   P(7) = 15 ...
*   P(8) = 22 ...
*   P(9) = 30 ...

提示：看看你是否可以从 P(N) 之前的一些结果组合中构建 P(N)。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-02-06T11:21:28.093

可以使用斩波算法找到解决方案。

使用例如 6。然后我们有：

```
6
5+1
4+2
3+3 
```

但我们还没有完成。

如果我们取 5+1，并认为 +1 部分已完成，因为所有其他结尾组合都由 4+2 和 3+3 处理。所以我们需要对 5 应用同样的技巧。

```
4+1+1
3+2+1 
```

我们可以继续。但不是无脑。因为例如 4+2 产生 3+1+2 和 2+2+2。但是我们不想要 3+1+2，因为我们会有 3+2+1。所以我们只使用最小数字大于或等于 2 的所有 4 的产生式。

```
6
5+1
  4+1+1
    3+1+1+1
      2+1+1+1+1
        1+1+1+1+1+1
    2+2+1+1
  3+2+1
4+2
  2+2+2
3+3 
```

下一步是将其放入算法中。

好的，我们需要一个带有两个参数的递归函数。被砍的个数和最小值：

```
func CountCombinations(Number, Minimal)
  temp = 1
  if Number<=1 then return 1
  for i = 1 to Floor(Number/2)
    if i>=Minimal then
      temp := temp + CountCombinations(Number-i, i)
  end for
  return temp
end func 
```

检查算法：

```
C(6,1) = 1 + C(5,1) + C(4,2) + C(3,3) = 11, which is correct.
C(5,1) = 1 + C(4,1) + C(3,2) = 7
C(4,1) = 1 + C(3,1) + C(2,2) = 5
C(3,1) = 1 + C(2,1) = 3
C(2,1) = 1 + C(1,1) = 2
C(1,1) = 1
C(2,2) = 1
C(3,2) = 1
C(4,2) = 1 + C(2,2) = 2
C(3,3) = 1 
```

顺便说一下，100的组合数：

```
CC(100) = 190569292
CC(100) = 190569291 (if we don't take into account 100 + 0) 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-13T10:40:03.227

解决这些问题的一个好方法是不要专注于“100”，而是尝试通过寻找当 n 增加 1、2、3 时的模式来考虑总和*n*和*n+1*之间的差异是什么…… .

我现在可以去，但我还有工作要做:)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-13T14:12:13.907

与 Project Euler 中的大多数大数字问题一样，思考它们的最佳方法不是被那个巨大的上限所困扰，而是从较小的角度考虑问题，然后逐渐向上。也许，在您识别模式的过程中，或者学到足够多的知识让您轻松找到答案。

我想我可以在不破坏你顿悟的情况下给你的唯一其他提示是“分区”这个词。

一旦你弄清楚了，你很快就会拥有它:)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-06T07:11:21.517

一种方法是考虑*递归函数*：找到从加起来为 100 的正整数（允许重复）中提取的数字序列的排列

*   零是 1，即对于数字 1，有零解
*   单位是 2，即数字 2 只有一个解

另一种方法是考虑*生成函数*：从零开始，找到直到目标的排列序列，保持映射/散列或中间值和计数

您可以从 1 向上迭代，或从 100 向下递归；无论哪种方式，您都会得到相同的答案。在每一点上，您都可以（对于一个简单的解决方案）生成正整数系列的所有排列，直到目标数减去 1，并且只计算那些加起来等于目标数的数

祝你好运！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-13T10:55:06.003

注意：我的数学有点生疏，但希望这会有所帮助......

你对问题的分解进展顺利。

一般认为：

*   数*n*可以写成 (n-1)+1 或 (n-2)+2
*   您将其概括为 (nm)+m
*   请记住，上述内容也适用于所有数字（包括 m）

所以想法是找到第一组（假设 5 = (5-1)+1），然后将 (5-1) 视为新的 n...5 = 4 +1...5 = ((4 -1)+1)+1。用尽的一次从 5 = 3 + 2.... 重新开始，变成 5 = ((3-1)+1)+2 ....= 2+1+2....随着你的前进。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-11T19:46:46.250

许多数学问题都可以通过[归纳](http://en.wikipedia.org/wiki/Mathematical_induction)法来解决。您知道特定值的答案，并且可以找到每个值的答案，如果您找到*与*链接`n`的内容`n+1`。

例如，在您的情况下，您知道**有多少种不同的方式可以写成至少两个正整数的和？**只是1。

`n`和之间的链接是什么意思`n+1`？好吧，我的意思是，您必须找到一个公式，只要您知道 的答案`n`，您就会找到 的答案`n+1`。然后，递归调用那个公式，你就会知道答案并且你已经完成了（注意：这只是它的数学部分，在现实生活中你可能会发现这种方法会给你带来一些太慢而不实用的东西，所以你还没有完成 - 在这种情况下，我**认为**你会完成）。

现在，假设你知道`n`可以写成*至少两个正整数的和？*以`k`不同的方式，其中之一是：

n=a1+a2+a3+...am（这个和有 m 项）

你能说什么呢`n+1`？由于您只需要提示，因此我不是在这里编写解决方案，而是以下内容。当然，您有相同的`k`不同方式，但在每种方式中都会有`+1`术语，其中之一是：

n+1=a1+a2+a3+...am+1（这个和有 m+1 项）

然后，当然，您将有其他`k`可能性，例如每个总和的最后一项不相同，但会增加一个，例如：

n+1=a1+a2+a3+...(am+1) （这个和有 m 项）

因此，至少有 2k 种写法`n+1` *作为至少两个正整数之和*。嗯，还有其他的。找出来，如果可以的话:-)并享受:-)）

# .net - Visual Studio：查找类的程序集

> ID：438543
> 
> 赞同：7
> 
> 时间：2009-01-13T10:29:39.160
> 
> 标签：.net, visual-studio

我笨。

如果我只知道类的名称，我怎么知道要引用哪个程序集，例如`System.Collections.Specialized.StringCollection`.

（是的，我知道通常可以通过查看名称空间做出有根据的猜测。）

谢谢

亚历克斯

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-13T11:15:29.537

我通常做的是在编辑器中右键单击“StringCollection”，然后单击“Go To Definition”，然后会弹出一个窗口，标题为“StringCollection [from Metadata]”，然后我只需将鼠标指针悬停在标题和工具提示与类来自的程序集的位置一起出现。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-13T10:33:51.867

您可以在[MSDN](http://msdn.microsoft.com/en-us/library/system.collections.specialized.stringcollection.aspx)中查看：包含该类的程序集在顶部提到：

> **StringCollection 类**
> 
> 表示字符串的集合。
> 
> **命名空间：** System.Collections.Specialized
> 
> **程序集：** 系统（在 System.dll 中）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-12-02T02:47:12.973

在 VS 2008 中测试：

*   在类视图中搜索您需要组装的类
*   右键单击并选择“浏览定义”
*   在对象浏览器窗口工具栏中，单击图标“在解决方案资源管理器中添加到选定项目中的引用”

编辑：

*   或者，您可以直接从“视图”菜单打开“对象浏览器”，而不是前两个步骤，然后直接在“对象浏览器”窗口中搜索类。
*   不能一直工作。有时“添加”会因未指定的错误而失败。如果 VS 中的项目名称与程序集名称不匹配，则会发生这种情况。在这种情况下，您将不得不查看该项目并找出其 .dll 文件的位置。

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2009-01-13T10:36:50.957

通常你不能，因为大多数程序集都包含多个命名空间。以 .net 3.5 中添加的 System.Core.dll 为例。它向 System.Collections.Generic 添加了其他类。一些原始类存在于 mscorlib.dll 中一种快速查找方法是在 VisualStudio 中打开“对象浏览器”选项卡，然后单击“设置”工具栏小按钮，并确保“查看容器”为检查。

# sql-server - Foreach Loop Microsoft SSIS - 相当于break语句

> ID：438546
> 
> 赞同：9
> 
> 时间：2009-01-13T10:31:47.377
> 
> 标签：sql-server, foreach, ssis, break

在 SSIS 的 Foreach 循环中，是否有一种方法可以在任务失败时跳出循环进入下一次迭代？

我正在遍历 xml 文件并使用此文件中的值执行查找，如果查找不返回任何我想报告的值，然后不为此文件执行任何其他任务。如果没有等效于 break 语句的其他方法，如何实现？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-15T05:19:54.417

您还可以使用带有布尔条件的“for”循环，例如在变量等于 true 时循环。然后，当您想跳出该循环时，只需将该变量的值更改为 false 即可跳出循环。

回答你的问题......一个 foreach 循环，循环一个集合和其他可枚举的结构，只要它们存在循环。因此，您可以找到一种解决方法，或者只使用“for”循环而不是“foreach”循环。这样，您就可以对循环进行更多的编程类型控制，因为您设置了条件表达式。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2017-05-11T19:02:47.050

另一种方法是将序列容器放入循环中，然后将条件步骤放入序列容器中。任何应该“继续”的决定只需要退出序列容器。使用您可能想要的所有控件（包括错误捕获）实现非常简单。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T14:34:49.663

如果没有返回值，则查找可以重定向，远离成功的流程。

您需要 foreach 循环的其余部分才能知道发生了错误，因此一种方法是在进行日志记录之前将包变量设置为错误。

然后，在查找后的“成功”箭头中，您可以将其更改为条件成功，这样只有在变量的值不是错误值时才会继续。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-12-15T21:24:36.600

所以我刚刚遇到了这个问题并通过以下方式解决了它：a）将失败的任务引导到一个什么都不做并结束的虚拟任务，b）将“FORCEEXECUTIONRESULTS”设置为“SUCCESS”，这正是我想要的方式。

# sql - 根据另一个表的小计更新字段

> ID：438547
> 
> 赞同：0
> 
> 时间：2009-01-13T10:32:33.990
> 
> 标签：sql, oracle, sql-update, subset, subtotal

我正在使用 oracle(10)。

我有两个表如下：

```
Table1 (uniq rows):
ID    AMOUNT     DATE 

Table2:
ID    AMOUNT1 AMOUNT2 ...AMOUNTN DATE 
```

Table2 与通过 ID 连接的 Table1 多对一连接。

我需要的是更新 Table1.DATE：Table2 的最后（最早）日期，其中 Table1.AMOUNT - SUM(Table2.AMOUNT1) <= 0，当通过 Table2.DATE 字段向后读取表 2 时。

有没有简单的方法来做到这一点？

提前致谢！

**更新：**正如我从你的回答中看到的那样，我有点错误地指定了这个问题。所以这里有一个详细的例子：

表 1 有：

```
ID: 1     AMOUNT:100    DATE:NULL 
```

表 2 具有（对于 ID：1，因此此处未列出 ID）：

```
AMOUNT1     DATE
50          20080131
30          20080121
25          20080111
20          20080101 
```

所以在这种情况下，我需要`20080111`将 Table1 中的 DATE 设为 50+30+25 => 100。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T10:49:25.220

根据您修改后的问题，这是使用分析函数的案例。

假设您的意思是 >=100 而不是 <= 100 正如您的示例所暗示的那样，并将列 DATE 重命名为 THEDATE 因为 DATE 是 Oracle 中的保留字：

```
update table1 set thedate=
( select max(thedate) from
  ( select id, thedate,
           sum(amount1) over (partition by id  order by thedate desc) cumsum
    from table2
  ) v
  where v.cumsum >= 100
  and v.id = table1.id
) 
```

如果 100 表示 table1 的当前值，则将该行更改为：

```
 where v.cumsum >= table1.amount 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T10:52:22.420

首先-您的数据库布局感觉严重错误，但我想您不能/不想更改它。`Table1`应该可能是一种观点，并且`Table2`不会给人以适当规范化的印象。类似的东西`(ID, AMOUNT_TYPE, AMOUNT_VALUE, DATE)`对我来说更有意义。

但是要解决您的问题（这是T-SQL“ `UPDATE FROM`”语法，但我认为Oracle知道）：

```
UPDATE 
  Table1
SET
  Date = Table2Aggregate.MinDate
FROM
  Table1 
  INNER JOIN (
    SELECT Id, SUM(Amount1) SumAmount1, MIN(Date) MinDate 
    FROM Table2 
    GROUP BY Id
  ) AS Table2Aggregate ON Table1.Id = Table2Aggregate.ID 
WHERE
  Table1.Amount - Table2Aggregate.SumAmount1 <= 0 
```

# algorithm - ProjectEuler 问题 99 的算法

> ID：438555
> 
> 赞同：6
> 
> 时间：2009-01-13T10:34:37.357
> 
> 标签：algorithm, math

来自[http://projecteuler.net/index.php?section=problems&id=99](http://projecteuler.net/index.php?section=problems&id=99)

> 比较两个以索引形式编写的数字，如 2 ^(11)和 3 ⁷并不困难，因为任何计算器都会确认 2 ^(11) = 2048 3 ⁷ = 2187。
> 
> 但是，确认 632382 ^(518061) > 519432 ^(525806)会困难得多，因为这两个数字都包含超过 300 万位数字。
> 
> 使用[base_exp.txt](http://projecteuler.net/project/base_exp.txt)（右键单击并“将链接/目标另存为...”），一个包含一千行的 22K 文本文件，每行都有一个基数/指数对，确定哪个行号具有最大的数值。

我该如何处理？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-13T11:12:26.093

不是一个完整的解决方案，而是一些想法。您可以使用以下公式：

> log(a ^x ) = x*loga

log10 可以很容易地估计为位数。log2 可以很容易地通过计算右移来估计。

基于以上内容，您可以显着缩小列表范围。对于剩余的数字，您必须进行完整的计算。Euler 项目中是否允许使用数学函数？如果是，最好使用对数。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-13T11:33:13.790

由于对数是单调函数，因此您可以比较 x * log a 来代替^(x来找到最大值。)不过，您可能需要考虑数值精度。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T11:12:58.590

一种可能的方法是使用对数恒等式（即 a ^b与 e ^(b * ln a)相同）。事实上，对于除 0 和 1 之外的所有碱基，a ^b与 base ^(b * log [base] a相同。)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-25T22:33:36.473

比较文件中每一行的 exponent * log(base) 而不是 base^exponent 可以解决这个问题，但不考虑精度。从数学的角度来看，这当然是最好的解决方案，但我只是想指出这并不是真正必要的。

另一种可能的解决方案是将文件中的每个数字除以某个常数（例如 100,000），然后再对现在较小的数字进行取幂。由于您正在将所有值相互比较，因此将它们全部缩小一个常数因子不会影响最终结果。

# asp.net - 如何通过 JavaScript 访问位于用户控件中的 ASP 控件

> ID：438556
> 
> 赞同：1
> 
> 时间：2009-01-13T10:34:59.647
> 
> 标签：asp.net, javascript, user-controls, ascx

**大家好，**

我正在设计一个用户控件，简单地说它包含一个 asp:hiddenfield 控件，我将通过这样的 JavaScript 函数访问它

```
function doAnyThing
{
    var myVar = document.getElementById("myHiddenFiled");
} 
```

但是当我跟踪我的代码时，我发现 myVar 分配给 null，这有关系吗

```
document.getElementById() 
```

方法用于用户控制文件（.ascx）或常规（.aspx）文件，考虑到它在（.aspx）文件中正确工作

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-13T10:39:46.520

您必须通过 ClientID 设置控件的最终 id，这取决于页面的结构。试试这个：

```
function doAnyThing
{
    var myVar = document.getElementById("<%= yourControlServerID.ClientID %>");
} 
```

显然这个函数需要放在.aspx文件中。我建议你改用像 jQuery 这样的框架，它允许你通过更复杂的选择器来检索控件。本案将通过以下方式解决：

```
$("[id$=yourControlServerID]"); 
```

您甚至可以将您的 javascript 代码放在外部 .js 文件中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T10:44:42.280

为了简化你可以使用：

jQuery

```
$("<%= yourControlServerID.ClientID %>"). .... 
```

ASP.NET JavaScript 注释：

```
var myVar = $get("<%= yourControlServerID.ClientID %>"); 
```

ASP.NET JavaScript 注释代码与以下相同：

```
var myVar = document.getElementById("<%= yourControlServerID.ClientID %>") 
```

# cocoa-touch - 如何使用 UINavigationController 在视图之间传递数据

> ID：438558
> 
> 赞同：0
> 
> 时间：2009-01-13T10:35:43.953
> 
> 标签：cocoa-touch

我已尝试使用以下示例中概述的明显方法，但我传递的变量（*rootcategory*）在加载视图中的 viewDidLoad 上仍然**为零**。

这是我的代码：

```
CategoryViewController *viewController = [[CategoryViewController alloc] initWithNibName:@"CategoryViewController" bundle:[NSBundle mainBundle]];
self.categoryViewController.rootCategory = @"433";
self.categoryViewController = viewController;
[viewController release]; 
```

我在标题中合成一个属性，如下所示：

```
@property (nonatomic, readwrite) NSString *rootCategory; 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T10:56:23.023

您正在分配 viewController，并尝试在将 self.categoryViewController 分配给 viewController 之前对其进行更改。

```
CategoryViewController *viewController = [[CategoryViewController alloc] initWithNibName:@"CategoryViewController" bundle:[NSBundle mainBundle]];
viewController.rootCategory = @"433";
self.categoryViewController = viewController;
[viewController release]; 
```

应该管用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T10:51:37.977

CategoryViewController 的头文件是什么样的？您是否将 rootCategory 定义为属性？是合成的还是你自己写的setter和getter？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T12:38:01.960

我相信在返回`viewDidLoad`之前在新实例上调用它`initWithNibName:`，所以你会在调用它之后设置你的属性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-11-15T13:02:45.420

您的代码是正确的，但`viewDidLoad`在您设置属性之前被调用（如 iKenndac 指出的）。

您应该改用该`- (void)viewWillAppear:(BOOL)animated`方法。正如方法名称所暗示的，它在视图出现在屏幕上之前被调用。

# python - 有没有办法自动生成需要索引的列列表？

> ID：438559
> 
> 赞同：5
> 
> 时间：2009-01-13T10:36:01.487
> 
> 标签：python, mysql, database, django, django-models

ORM 的美丽让我睡着了。我有一个缺少数据库索引的现有 Django 应用程序。有没有办法自动生成需要索引的列列表？

我在想也许是一些中间件记录了 WHERE 子句中涉及哪些列？但是有什么内置到 MySQL 中可能会有所帮助吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T10:40:25.893

就在这里。

如果你看一下[慢查询日志](http://dev.mysql.com/doc/refman/5.1/en/slow-query-log.html)，有一个选项`--log-queries-not-using-indexes`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-13T11:32:53.790

不。

对所有“慢”查询随意添加索引也会减慢插入、更新和删除的速度。

索引是快速查询和快速更改之间的平衡行为。没有一般的或“正确”的答案。当然，没有什么可以自动执行此操作。

在添加和更改索引时，您必须衡量整个应用程序的改进。

# jquery - 有没有办法为图像标签的所有 src 属性添加路径？

> ID：438565
> 
> 赞同：0
> 
> 时间：2009-01-13T10:38:39.827
> 
> 标签：jquery, xhtml

我想为我的 html 文件中的所有 img 标签添加路径“images/”。那有可能吗？如果我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T10:41:40.413

从何而来？记事本中的搜索/替换是否足够好？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T10:44:34.183

我确信有一个 jQuery 特定的方法可以做到这一点，但是这个基本的 JS 循环会做到这一点。不过，在从不同的 URL 加载所有图像之后，这是一件奇怪的事情。

```
var a = document.getElementsByTagName('img');

for(var i=0, n=a.length; i<n; i++)
{
  a[i].src = 'images/'+a[i].src; //see note
} 
```

注意：在实践中，我认为您需要一个正则表达式替换以在此处插入“图像/”字符串

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T10:48:46.483

试试这个：

```
$("img").attr("src", function (val) {
          return "images/" + val;
        }) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T10:59:38.663

我认为这会很好地工作：

```
$("img").each( function() {
    $(this).attr("src", "images/" + $(this).attr("src"));
}); 
```

请注意，仅当您已经拥有图像的相对路径时才有意义。

# ssl - 网站发布后 https 停止工作

> ID：438566
> 
> 赞同：2
> 
> 时间：2009-01-13T10:38:43.947
> 
> 标签：ssl, iis-6, https

我正在使用 Windows Server 2003 (IIS6)，它有两个在单独的应用程序池中运行的 asp.net 站点。其中一个站点安装了 ssl 证书，并且在 https 上运行良好。其他站点没有证书，不需要https

我遇到的问题是，当我将我的应用程序从 vs2005 发布到使用 ssl 的站点时，https url 停止工作，我只能使用 http。我得到的错误如下

来自 Google Chrome：错误 104 (net::ERR_CONNECTION_FAILED)：连接到服务器的尝试失败。

从 IE7：Internet Explorer 无法显示网页，可能不可用，dns 无法访问等

奇怪的是第一次发生这种情况，https 最终变得可用，但我不知道是什么触发了可用性，但是当我将更新的程序集发布到不需要 https 的站点的 bin 文件夹时，其他站点变得不可用再次https

非常感谢帮助！

更新：感谢您的建议，但事实证明防火墙未在 ssl 端口上打开

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T11:38:26.120

如果两个 Web 使用相同的 IP 地址，请确保**只有具有证书的 Web 使用 SSL 端口 443**（第一个属性页）。对于不安全站点，输入字段应为空。

如果这不是问题，您可以尝试调试在没有证书的情况下停止 Web 并重新启动 Web 服务器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T18:33:18.433

检查 SSL (443) 的防火墙端口是否没有意外关闭 443。;-)

# perl - 如何在请求跟踪器中使用 Groups.pm？

> ID：438567
> 
> 赞同：1
> 
> 时间：2009-01-13T10:39:18.593
> 
> 标签：perl, ticket-system, rt

在 lib\RT\CustomFieldValues\ 中有 groups.pm 文件，它应该是如何将数据放入自定义字段的示例，但是一旦我编写了它，我该如何实际使用它呢？有没有人有任何文件或样本？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-22T06:09:22.307

我终于想通了，要使用 Groups.pm 模块，您需要转到 /opt/rt3/etc 并编辑 RT_SiteConfig.pm 并添加该行

```
Set(@CustomFieldValuesSources, "RT::CustomFieldValues::Groups"); 
```

重新启动 Apache，它将作为新的字段源提供。

我写了一篇关于这样做的博客文章，其中还包括有关如何构建自己的模块的详细信息，以防有人对此感兴趣：[AD Lookup Control in Request Tracker](http://www.sadev.co.za/node/320)

# powerbuilder - 部署 PowerBuilder 应用程序

> ID：438570
> 
> 赞同：2
> 
> 时间：2009-01-13T10:40:11.527
> 
> 标签：powerbuilder, powerbuilder-build-deploy

我正在尝试将 PowerBuilder 9 IDE 附带的示例项目部署到 .exe 文件。

1.  完整构建 - 成功通过。
2.  部署 - 失败并出现以下错误：

    “当前库列表与此项目中包含的库列表不同。项目库列表已更新。为更新的列表指定构建选项，然后重试。”

我该如何克服呢？

提前致谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-08-30T04:11:44.680

当您看到此消息时，PowerBuilder 已经更新了项目中的库列表（假设您已经在项目绘制器中打开了项目）。只需再次点击 Deploy 即可开始构建。记得在关闭画家之前点击保存，否则下次你会经历同样的舞蹈。

祝你好运，

特里。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2019-03-02T07:21:37.723

只需遵循以下 8 个简单步骤：

1.  打开系统树（工具栏）

2.  右键单击您的项目，然后选择**“新建...”**

3.  在“新建”对话框中，单击“**项目”选项卡**并选择**“应用程序向导”**

4.  在第一步**“指定目标库”**中，点击“下一步”

5.  在其他步骤中，更改您需要的内容，然后单击“下一步”

6.  在最后一步，当然，单击“完成”。你完成了

7.  您现在在系统树中看到 2 个项目（您可以删除旧的一个右键单击/删除

8.  部署新的

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-29T18:49:09.867

删除您的（应用程序）项目文件并创建一个新文件。将使用最新的库列表创建新项目

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-03-11T11:38:18.223

检查库搜索路径中的 pbl 列表。为此，请查看目标对象的属性。

该列表必须与您的对象 Projet 中的 PB 列表匹配。

如果不是手动编辑对象项目的源（右键单击编辑源）。

# c# - SqlBulkCopy 不工作

> ID：438587
> 
> 赞同：20
> 
> 时间：2009-01-13T10:46:19.703
> 
> 标签：c#, asp.net, sqlbulkcopy

我`DataSet`从 Excel 表中填充了一个。我想使用 SQLBulk Copy 在PK`Lead_Hdr`所在的表中插入记录。`LeadId`

执行以下代码时出现以下错误：

> 给定的 ColumnMapping 与源或目标中的任何列都不匹配

```
string ConStr=ConfigurationManager.ConnectionStrings["ConStr"].ToString();

using (SqlBulkCopy s = new SqlBulkCopy(ConStr,SqlBulkCopyOptions.KeepIdentity))
{
    if (MySql.State==ConnectionState.Closed)
    {
        MySql.Open();
    }

    s.DestinationTableName = "PCRM_Lead_Hdr";
    s.NotifyAfter = 10000;

    #region Comment
    s.ColumnMappings.Clear();

    #region ColumnMapping
    s.ColumnMappings.Add("ClientID", "ClientID");
    s.ColumnMappings.Add("LeadID", "LeadID");
    s.ColumnMappings.Add("Company_Name", "Company_Name");
    s.ColumnMappings.Add("Website", "Website");
    s.ColumnMappings.Add("EmployeeCount", "EmployeeCount");
    s.ColumnMappings.Add("Revenue", "Revenue");
    s.ColumnMappings.Add("Address", "Address");
    s.ColumnMappings.Add("City", "City");

    s.ColumnMappings.Add("State", "State");
    s.ColumnMappings.Add("ZipCode", "ZipCode");
    s.ColumnMappings.Add("CountryId", "CountryId");

    s.ColumnMappings.Add("Phone", "Phone");
    s.ColumnMappings.Add("Fax", "Fax");
    s.ColumnMappings.Add("TimeZone", "TimeZone");
    s.ColumnMappings.Add("SicNo", "SicNo");
    s.ColumnMappings.Add("SicDesc", "SicDesc");

    s.ColumnMappings.Add("SourceID", "SourceID");
    s.ColumnMappings.Add("ResearchAnalysis", "ResearchAnalysis");
    s.ColumnMappings.Add("BasketID", "BasketID");
    s.ColumnMappings.Add("PipeLineStatusId", "PipeLineStatusId");

    s.ColumnMappings.Add("SurveyId", "SurveyId");
    s.ColumnMappings.Add("NextCallDate", "NextCallDate");
    s.ColumnMappings.Add("CurrentRecStatus", "CurrentRecStatus");
    s.ColumnMappings.Add("AssignedUserId", "AssignedUserId");
    s.ColumnMappings.Add("AssignedDate", "AssignedDate");
    s.ColumnMappings.Add("ToValueAmt", "ToValueAmt");
    s.ColumnMappings.Add("Remove", "Remove");
    s.ColumnMappings.Add("Release", "Release");

    s.ColumnMappings.Add("Insert_Date", "Insert_Date");
    s.ColumnMappings.Add("Insert_By", "Insert_By");
    s.ColumnMappings.Add("Updated_Date", "Updated_Date");
    s.ColumnMappings.Add("Updated_By", "Updated_By");

    #endregion
    #endregion

    s.WriteToServer(sourceTable);

    s.Close();

    MySql.Close();
} 
```

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2010-04-09T11:27:10.223

我在从访问 SQLSERVER 2005 复制数据时遇到了同样的问题，我发现列映射在两个数据源上都是区分大小写的，无论数据库是否敏感。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-01-13T10:52:22.827

嗯，对吗？列名是否存在于两侧？

老实说，我从不关心映射。我喜欢保持简单——我倾向于有一个看起来像服务器上的输入的临时表，然后我`SqlBulkCopy`进入临时表，最后运行一个存储过程将表从临时表移动到实际表中；好处：

*   如果导入在任何时候失败，则不会出现实时数据损坏问题
*   我可以在 SPROC 周围进行交易
*   我可以在不记录的情况下让 bcp 工作，知道 SPROC 将被记录是安全的
*   这很简单；-p（不要弄乱映射）

作为最后的想法 - 如果您正在处理批量数据，则可以使用`IDataReader`（因为这是一个流式 API，而`DataTable`缓冲 API 也是如此）获得更好的吞吐量。例如，我倾向于使用[CsvReader](http://www.codeproject.com/KB/database/CsvReader.aspx)作为 SqlBulkCopy 的源来连接 CSV 导入。或者，我已经编写了 shims`XmlReader`以将每个第一级元素呈现为一行`IDataReader`- 非常快。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-14T01:56:23.360

Marc 的答案是我的建议（关于使用临时表）。这可以确保如果您的源不更改，那么您将来导入时会遇到更少的问题。

但是，根据我的经验，您可以检查以下问题：

列名在源和表中匹配 列类型匹配

如果你认为你这样做了，但仍然没有成功。您可以尝试以下方法。

1 - 在表中的所有列中允许空值 2 - 注释掉所有列映射 3 - 重新运行一次添加一列，直到找到问题所在

那应该带出错误

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-08-19T11:55:02.660

原因之一是 :SqlBukCOpy 区分大小写。遵循以下步骤：

1.  在这种情况下，首先您必须使用 C# 中的“包含”方法在源表中找到您的列。
2.  一旦您的 Destination 列与源列匹配，则获取该列的索引并在 SqlBukCOpy 中给出其列名。

例如：`

```
//Get Column from Source table 
  string sourceTableQuery = "Select top 1 * from sourceTable";
   DataTable dtSource=SQLHelper.SqlHelper.ExecuteDataset(transaction, CommandType.Text, sourceTableQuery).Tables[0];// i use sql helper for executing query you can use corde sw

 for (int i = 0; i < destinationTable.Columns.Count; i++)
                        {    //check if destination Column Exists in Source table
                            if (dtSource.Columns.Contains(destinationTable.Columns[i].ToString()))//contain method is not case sensitive
                            {
                                int sourceColumnIndex = dtSource.Columns.IndexOf(destinationTable.Columns[i].ToString());//Once column matched get its index
                                bulkCopy.ColumnMappings.Add(dtSource.Columns[sourceColumnIndex].ToString(), dtSource.Columns[sourceColumnIndex].ToString());//give coluns name of source table rather then destination table so that it would avoid case sensitivity
                            }

                        }
                        bulkCopy.WriteToServer(destinationTable);
                        bulkCopy.Close(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-26T17:00:04.567

我发现表中的列和输入中的列至少必须匹配。您可以在表中包含更多列，并且输入仍将加载。如果你有更少，你会收到错误。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-08-25T19:45:58.493

想了很久才回答...即使列名大小写相同，如果数据类型不同，您也会得到相同的错误。因此，请检查列名及其数据类型。

PS：临时表是确定的导入方式。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-10-09T12:41:21.797

我会采用分期的想法，但是这是我处理区分大小写性质的方法。很高兴在我的 linq 上受到批评

```
using (SqlConnection connection = new SqlConnection(conn_str))
{
        connection.Open();
        using (SqlBulkCopy bulkCopy = new SqlBulkCopy(connection))
        {
            bulkCopy.DestinationTableName = string.Format("[{0}].[{1}].[{2}]", targetDatabase, targetSchema, targetTable);
            var targetColumsAvailable = GetSchema(conn_str, targetTable).ToArray();
            foreach (var column in dt.Columns)
            {
                if (targetColumsAvailable.Select(x => x.ToUpper()).Contains(column.ToString().ToUpper()))
                {
                    var tc = targetColumsAvailable.Single(x => String.Equals(x, column.ToString(), StringComparison.CurrentCultureIgnoreCase));
                    bulkCopy.ColumnMappings.Add(column.ToString(), tc);
                }
            }

            // Write from the source to the destination.
            bulkCopy.WriteToServer(dt);
            bulkCopy.Close();
        }
} 
```

和辅助方法

```
private static IEnumerable<string> GetSchema(string connectionString, string tableName)
        {

   using (SqlConnection connection = new SqlConnection(connectionString))
        using (SqlCommand command = connection.CreateCommand())
        {
            command.CommandText = "sp_Columns";
            command.CommandType = CommandType.StoredProcedure;

            command.Parameters.Add("@table_name", SqlDbType.NVarChar, 384).Value = tableName;

            connection.Open();
            using (var reader = command.ExecuteReader())
            {
                while (reader.Read())
                {
                    yield return (string)reader["column_name"];
                }
            }
        }
    } 
```

# java - 如何从 CPython 调用 java 对象和函数？

> ID：438594
> 
> 赞同：11
> 
> 时间：2009-01-13T10:49:01.913
> 
> 标签：java, python, function, language-interoperability

我有一个 python 程序，它在 CPython 实现上运行，在它里面我必须调用一个在 java 程序中定义的函数。我怎样才能做到这一点？

能够使用一些java对象也很好。

Jython 不是一种选择。我必须在 CPython 中运行 python 部分。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2010-09-25T10:55:08.823

为恢复线程道歉，但我认为我有一个更好的答案:-)

您还可以使用[Py4J](http://py4j.sourceforge.net/index.html)，它有两个部分：一个在 CPython（或任何 Python 解释器）中运行的库和一个在您要调用的 Java VM 上运行的库。

头版上有一个示例和大量文档，但本质上，您只需从 Python 代码中调用 Java 方法，就好像它们是 Python 方法一样：

```
>>> from py4j.java_gateway import JavaGateway
>>> gateway = JavaGateway()                        # connect to the JVM
>>> java_object = gateway.jvm.mypackage.MyClass()  # invoke constructor
>>> other_object = java_object.doThat()
>>> other_object.doThis(1,'abc')
>>> gateway.jvm.java.lang.System.out.println('Hello World!') # call a static method 
```

通信是通过套接字而不是 JNI 完成的。

*免责声明：我是 Py4J 的作者*

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-13T11:28:40.320

最简单的做法是

1.  为您的 java“函数”编写一个简单的 CLI。（没有这样的东西，所以我假设您实际上是指 Java 类的方法函数。）

    ```
    public class ExposeAMethod {
        public static void main( String args[] ) {
             TheClassToExpose  x = new TheClassToExpose();
            x.theFunction();
        }
    } 
    ```

2.  以 this 作为入口点编译并构建一个可执行的 JAR 文件。称它为 `ExposeAMethod.jar`

3.  从子进程创建的命令中调用它。

    ```
    import subprocess
    p = subprocess.Popen("java -jar ExposeAMethod.jar", shell=True)
    sts = os.waitpid(p.pid, 0) 
    ```

这是最低限度。而且真的不多。我数了 6 行 java，3 行 Python，你就开始运行了。

如果您想将参数传递给这个 Java 类的构造函数或方法函数，则必须再编写几行代码。你有两个选择。

*   从标准输入读取参数，将结果写入标准输出。这相对容易并且性能非常好。

*   将参数解析为 Java 的命令行选项，将结果写入标准输出。这稍微难一些，但可以很好地概括。好处是您现在拥有一个可以重用的有用的命令行 Java 程序。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-14T20:00:08.073

如果您不想编写自己的 JNI/C 路线。

另一种选择是使用 jpype，对我来说，它始终是我用来访问 Oracle 数据库的工具，因为在 PC 上安装 oracle c 驱动程序是一个皮塔饼。您可以执行以下操作（来自文档）：

```
 from jpype import * 
 startJVM("d:/tools/j2sdk/jre/bin/client/jvm.dll", "-ea") # or path to your jvm
 java.lang.System.out.println("hello world") 
 shutdownJVM() 
```

它已经有一段时间没有更新了，文档的方式也不多，但它确实工作得很好。

*   [主页](https://github.com/originell/jpype)
*   [文档](https://jpype.readthedocs.io/en/latest/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T11:11:40.883

我不知道 Python，但上次我不得不从 C 应用程序（NT 服务）调用 java，我必须加载`jvm.dll`. 查看 JNI 文档。

另外，你打电话总是打电话

```
os.system("java com.myapp.MyClass") 
```

如果您不关心性能。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-13T11:15:46.947

您必须创建一个嵌入 Java 的 python C 扩展 - 基于[http://www.javaworld.com/javaworld/jw-05-2001/jw-0511-legacy.html](http://www.javaworld.com/javaworld/jw-05-2001/jw-0511-legacy.html)之类的东西，否则您将不得不在单独的子进程中启动 java。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-06-16T16:07:00.083

查看我们的项目[python-javabridge](https://pypi.python.org/pypi?name=javabridge&%3aaction=display)。它是一个围绕 JNI 的 Python 包装器，被[CellProfiler](http://cellprofiler.org)大量使用。它提供对 JNI 的低级访问和对 Java 对象的基于反射的高级访问。

# javascript - vs2005 的 JavaScript 调试问题

> ID：438603
> 
> 赞同：0
> 
> 时间：2009-01-13T10:51:23.423
> 
> 标签：javascript, debugging, visual-studio-2005

我今天遇到了一个奇怪的问题。每当我在我的一个 js 文件中放置断点时，断点都不会被命中。

我将 Visual Studio 2005 与 TFS 结合使用。在即禁用脚本选项都被禁用。

唯一改变的是我为一个旧项目安装了 Visual Basic 6，但我看不出这会如何影响通过 Visual Studio 2005 进行的调试。

以前有没有人遇到过这个问题，或者更好的是有人知道解决方案吗？谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-13T11:12:12.210

为了使 Javascript 调试正常工作，Visual Studio 需要作为调试器附加到 IE 进程，并且它需要能够使用在 IE 中加载的相同脚本的 URL 解析 javascript 文件的物理路径。

您是否检查过当您在 VS 中开始调试时它实际上附加到启动的 IE 进程？

定制您的工具栏，在命令选项卡上选择调试类别，然后找到“脚本资源管理器”命令，将其拖到工具栏上。关闭对话框。

使用脚本资源管理器，您应该能够找到应该有断点的脚本。通常 VS 能够将它为开发者 Web 服务器指定的根路径与物理 JS 文件路径结合起来，以确定它的 URL 从浏览器的角度来看会是什么样子，然后它可以将断点从物理文件更新到在浏览器中加载的脚本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T11:16:28.113

你也可以`debugger;`在你的js中使用一个语句。然后 IE 将提示您调试脚本文件，如果您有它们，应该让您选择在 Visual Studio 2005/2008 中进行调试。[在这里](http://www.jonathanboutelle.com/mt/archives/2006/01/howto_debug_jav.html)解释

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T12:25:14.637

一位同事发现了问题：及时调试器仅设置为处理托管代码和本机代码，没有脚本。我只需要在 Visual Studio 选项窗格中重新设置它。

# php - 是否从另一个类调用类

> ID：438607
> 
> 赞同：1
> 
> 时间：2009-01-13T10:52:49.270
> 
> 标签：php, oop

假设我有以下代码：

```
class siteMS
 {
    ...
    function __CONSTRUCT()
     {
        require 'config.php';
        $this->config = new siteMSConfig;
        ...
     }
    ...
 } 
```

从 siteMSConfig 类内部，我可以确定天气是否是从 siteMS 类内部调用的？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T11:07:10.317

是的，但没有“漂亮”的方法可以做到这一点——你最终会通过[回溯](http://www.php.net/debug_backtrace)或类似的东西来查看。

最好将（可选？）参数传递给`siteMSConfig`构造函数，如下所示：

```
class siteMSConfig
{
    public function __construct($inSiteMS = false)
    {
    }
} 
```

或者，子类`siteMSConfig`：

```
class siteMSsiteMSConfig extends siteMSConfig
{
    public function __construct()
    {
        // Possibly call parent::__construct();
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T11:08:29.363

从技术上讲是的，您可以使用[debug_backtrace](http://uk3.php.net/debug_backtrace)来确定您的调用者是谁。

编写一个纯粹根据它调用的位置来改变其行为的类是在以后要求一个痛苦的世界。为什么不参数化不同的行为，或者创建一个子类？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T11:06:53.547

我想你必须用变量传递它，从你叫它的地方

```
$this->config = new siteMSConfig ('siteMS'); 
```

# sql - 如何编写将行号输出为列的查询？

> ID：438610
> 
> 赞同：14
> 
> 时间：2009-01-13T10:53:56.740
> 
> 标签：sql, db2

如何编写将行号输出为列的查询？这是 iSeries 上的 DB2 SQL。

例如，如果我有

表披头士：

```
John
Paul
George
Ringo 
```

我想写一个声明，如果可能的话，不写程序或视图，这给了我

```
1 John
2 Paul
3 George
4 Ringo 
```

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-01-13T11:08:53.213

```
SELECT ROW_NUMBER() OVER (ORDER BY beatle_name ASC) AS ROWID, * FROM beatles 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T10:59:22.843

查看 row_number() 函数；您应该可以通过以下方式在 DB2 中执行此操作：

```
SELECT row_number(), first_name FROM beatles 
```

不过，我几乎可以肯定这不是 SQL 标准的一部分，因此如果这是一个问题，它不太可能是可移植的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-10T07:32:29.843

```
SELECT ROW_NUMBER() OVER(ORDER BY BEATLE_NAME) ROWNUM,BEATLE_NAME FROM BEATLES; 
```

# php - php exec函数中的非法命令错误代码127

> ID：438618
> 
> 赞同：9
> 
> 时间：2009-01-13T10:58:45.340
> 
> 标签：php, exec

我正在使用这个 php 代码：

```
exec("unrar e file.rar",$ret,$code); 
```

并获得非法命令的错误代码，即 127 ...但是当我通过 ssh 使用此命令时，它的工作...因为服务器上安装了 unrar ...所以任何人都可以猜到为什么 exec 没有做正确的事情吗？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-01-13T11:02:23.697

尝试使用应用程序的直接路径（/usr/bin/unrar 之类的），听起来 php 找不到应用程序。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2010-11-17T07:59:57.557

如果您已经 chrooted apache 和 php，您还需要将 /bin/sh 放入 chrooted 环境中。否则，exec() 或 passthru() 将无法正常运行，并会产生错误代码 127，找不到文件。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-05-22T17:22:26.250

由于这是谷歌的最佳答案，我想分享我的修复：

我的简单修复是在 php.ini 文件中禁用 safe_mode

```
; Safe Mode
; http://www.php.net/manual/en/ini.sect.safe-mode.php#ini.safe-mode
safe_mode = Off 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-13T11:25:38.080

谢谢大家的回复！！

我试过这个

```
`//somedir is inside the directory where php file is
chdir("somedir");
exec("/home/username/bin/unrar e /home/path/to/dir/file.rar");` 
```

`现在它没有返回退出代码……其他命令正在执行文件……我尝试了 mkdir 等……：s`

 `* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-03-25T10:00:54.213

以防万一其他人仍然遇到此问题，请查看此处的帖子：

[http://gallery.menalto.com/node/2639#comment-8638](http://gallery.menalto.com/node/2639#comment-8638)

引用：

> 我发现了问题。问题出在我的安全偏执的 OpenBSD 上。从 3.1 升级到 3.2 时，他们添加了：
> 
> *   Apache 默认运行 chroot'd。要禁用此功能，请参阅新的 -u 选项。
> 
> chroot 阻止 Apache 访问目录之外的任何内容，因此我将所有内容都移到了 apache 目录中，包括 netpbm。一切都可以访问和执行，但我猜它仍然处于某种“安全模式”，因为 exec() 总是返回 127。
> 
> 无论如何，使用 -u 选项运行 httpd 会回到不太安全的非 chroot'd apache 启动，这允许 exec() 再次工作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-13T15:29:53.000

ohkiee guyz thanx ...是的，$PATH 可能存在一些错误...但是在给定完整路径的情况下它可以工作:)

```
`exec("/home/user/bin/unrar e /home/user/xxx/yyy/file.rar");` 
```

# `asp.net - 用于用户控制的 Asp.Net 通用本地资源工具`

 `> ID：438624
> 
> 赞同：2
> 
> 时间：2009-01-13T11:02:13.603
> 
> 标签：asp.net, localization

当我使用 Visual Studio 菜单工具 -> 生成本地资源时，它通过向控件添加元属性来更改 aspx 文件。但对于我创建的用户控件，它并没有这样做。

例如，如果我在页面中使用了控件

```
<myControl:SpecialLabelControl ID="myLabel" runat="server" Text="Localize Me!" /> 
```

我想要“本地化我！” 进入资源文件并将元属性添加到 SpecialLabelControl。

我怎样才能做到这一点？

该工具如何自动为内置控件创建资源字符串？它是否读取属性的属性？如何使该工具对我的控件执行相同的操作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-04T20:15:19.503

首先，确保“文本”是您控件上可公开访问的属性。

在声明上方添加[Localizable(true)]，如[本页示例所示](http://msdn.microsoft.com/en-us/library/system.componentmodel.localizableattribute.aspx)

这将告诉 IDE 该属性应该被资源文件拾取，而工具 -> 生成本地资源将完成剩下的工作！编辑 - 经过进一步研究，我发现了[这篇文章](http://web.archive.org/web/20090306193410/http://www.dotnet2themax.com/blogs/mbellinaso/PermaLink,guid,2ca72726-2047-470d-a8af-4e535b061708.aspx)（以及一本书的摘录）。您使用可公开访问的属性创建的 UserControl 似乎无法被 GLR 工具击中:(

我以前工作过的那些是我创建为“.cs”文件的类，而不是用户控件，我想。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T11:07:44.183

手动将其添加到资源文件中：

```
myLabel.Text 
```

然后将控件更改为：

```
<myControl:SpecialLabelControl ID="myLabel" runat="server" meta:resourceKey="LiteralIdentifyBody" /> 
```

# java - 是否有可能打破 Eclipse 调试器中的每个对象引用？

> ID：438628
> 
> 赞同：11
> 
> 时间：2009-01-13T11:03:38.780
> 
> 标签：java, eclipse, debugging

假设我有一堂课

```
public class MyClass {

    private Set<String> set = new HashSet<String>();

    //and many methods here

} 
```

是否有可能使 Eclipse 调试器在使用 set 成员的每一行处停止？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-13T11:05:44.437

我有一段时间没有使用 Eclipse，但据我所知，这至少在 Callisto 版本中是可能的。如果您在包含声明的行上设置断点，然后进入该断点的高级属性，我相信您可以设置*修改*和*访问*该变量的选项。

*编辑*：我刚刚检查了 Eclipse Europa。它确实像我想的那样广泛使用。当您在变量上设置断点时，它被称为*观察点；*并且在“断点属性”页面（通过右键单击页边空白处的断点小玩意可以访问，也可能以其他方式访问），您可以确定调试器是否应该在“字段访问”和“字段修改”上停止。在您的情况下，您希望选择第一个。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T11:15:26.417

是的。您可以在表达式处设置断点

```
private String propString; 
```

断点获得另一个符号并显示工具提示“Watchpoint [Acess and modify]”

当调试器处于步进模式时，您可以使用 Shift+Ctrl+I 查看所选变量名称的值。

当调试器处于单步模式时，您还可以在运行时更改变量值。

eclipse 调试器是一个非常有用和强大的工具。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-14T15:17:55.113

这从一开始就是 eclipse 调试器的一部分。您只需在声明变量的行设置一个断点。要获得更多控制，您可以右键单击断点并选择断点属性，如果您只想在访问或修改上停止，您可以在其中设置。

请记住，修改实际上是值类型的值的变化和引用类型的引用的变化。例如，如果您在 HashMap 上设置修改断点（观察点），那么如果您将项目添加到此哈希图中，调试器将不会停止，因为添加项目不会更改变量的地址/引用。

# php - PHP“类似于小部件”的代码设计

> ID：438631
> 
> 赞同：1
> 
> 时间：2009-01-13T11:06:16.607
> 
> 标签：php, widget

我有一个用 PHP 编写的原型网站。最近我重写了代码以将逻辑与布局和数据库操作分开。所以现在我有了类似 MVC 代码设计的东西。

现在困扰我的是，在 MVC 中我将有很多文件，并且每个文件在与其他文件（模型+视图+控制器）结合时都会显示一些内容。所以我发现创建类似于我的 MVC 部件的小部件会很有用。

例如，当我有产品视图的 MVC 时，我会创建一个 PHP 文件，该文件以这种方式组合 MVC 部分文件，以根据我传递给这个新 PHP 文件的 GET 值显示产品。

我将以这种方式完成的是，任何小部件、网站的子部分都可以单独查看并与其他部分分开使用。所以它可能是小部件或 Firefox 浏览器设计之类的东西。

所以我可以分别测试网站的每个部分，而不是只将这些部分组合到当前实际的网站页面设计中。因此，用户测试也会更容易，并且演示文件会非常简短且易于理解。

我想知道您对此有何看法。我不想陷入设计中的任何漏洞，我认为这是未来保持网站代码轻松维护的重要时刻。

我对么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T11:24:04.340

> MVC 我会有很多文件，当与其他文件结合时，每个文件都会显示一些东西（模型+视图+控制器）

这听起来像你没有得到正确的 MVC 模型。只有视图有内容或“显示某些东西”。

基于此，您可以创建仅创建类似于小部件的内容部分的操作，然后可以将其组合到您的布局中。

我想推荐阅读[Zend_Layout 快速入门](http://framework.zend.com/manual/en/zend.layout.quickstart.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T11:36:05.827

您的问题的答案是**view composition**。

建议你把整个屏幕分割成小块：顶栏、二级导航栏、产品列表、预览区等等。这些可以由单独的视图、视图助手或控制器中的其他方法提供。然后控制器操作将使用简单的 HTML 布局将片段*组合成单个屏幕。*

例如。对于静态的顶栏，这可能是专门的视图。对于动态的产品列表，它可能是`getProductsList($categoryId)`提供复杂视图的控制器方法。产品预览可以通过视图助手交付。请参见以下示例：

```
// inside class ProductsController
public function index($categoryId, $productId = null) {

    // specialised view
    $topBar = new TopBarView();
    $topBar->selected = 'products';

    // helper method
    $list = $this->getProductsList($categoryId);

    // helper object
    $previewHelper = new PreviewHelper($productId);
    $preview = $previewHelper->getView();

    // view composition
    $view = new View('path/to/template.tpl');
    $view->add($topBar);
    $view->add($list);
    $view->add($preview);
    return $view;

} 
```

这只是说明合成如何工作的示例。

拥有交付小部件（即产品列表）的方法的隐藏好处是它可以被重用以支持 Ajax。更改类别需要 Ajax 调用`getProductsList`具有新类别 ID 的方法。

# c# - Visual Studios 2005 - 在设计器/属性窗口中清除自定义属性

> ID：438647
> 
> 赞同：1
> 
> 时间：2009-01-13T11:12:13.847
> 
> 标签：c#, visual-studio-2005, compact-framework, .net-2.0, c#-2.0

大家早，

我创建了一个带有图像属性的自定义控件。该图像属性是对私有图像变量的获取/设置。

谁能告诉我如何启用该 get/set 以清除设计师的属性？

即，如果我将图像添加到标准PictureBox，我可以点击Del 从PictureBox 中清除图像。如何在我自己的自定义控件上复制此行为？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T11:17:48.953

在最简单的层面上，`DefaultValueAttribute`应该做的工作：

```
private Bitmap bmp;
[DefaultValue(null)]
public Bitmap Bar {
    get { return bmp; }
    set { bmp = value; }
} 
```

对于更复杂的场景，你可能想尝试添加一个[Reset](http://msdn.microsoft.com/en-us/library/53b8022e.aspx)方法；例如：

```
using System;
using System.Drawing;
using System.Windows.Forms;
class Foo {
    private Bitmap bmp;
    public Bitmap Bar {
        get { return bmp; }
        set { bmp = value; }
    }
    private void ResetBar() { bmp = null; }
    private bool ShouldSerializeBar() { return bmp != null; }
}
static class Program {
    [STAThread]
    static void Main() {
        Application.EnableVisualStyles();
        Form form = new Form();
        PropertyGrid grid = new PropertyGrid();
        grid.Dock = DockStyle.Fill;
        grid.SelectedObject = new Foo();
        form.Controls.Add(grid);
        Application.Run(form);
    }
} 
```

# asp.net - ImageClickEvenHandler 不调用处理程序

> ID：438649
> 
> 赞同：0
> 
> 时间：2009-01-13T11:12:37.670
> 
> 标签：asp.net

我有一个动态创建的表格，并且在某些单元格中我有一个与 redBall_Click() 处理程序关联的图像按钮

（这是后面的代码）

```
 TableCell cellOK = new TableCell();
    cellOK.Style.Add(HtmlTextWriterStyle.TextAlign, "Center");
    cellOK.Width = new Unit("3%");
    ImageButton redBall = new ImageButton();
    redBall.CausesValidation = false;
    redBall.ID = id;
    redBall.ImageUrl = "~/App_Themes/DotRed.png";

    redBall.Click += new ImageClickEventHandler(redBall_Click);
    cellOK.Controls.Add(redBall); 
```

我的问题是 redBall_Click() 方法从未被调用（在 PostBack 之后）

我该如何解决这个问题？

PS：我不能使用静态链接，因为每个 ImageButton 都与我必须传递给我调用的页面的特定 ID 相关联（例如作为 Session 对象）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-26T20:04:47.460

您必须在 OnInt 中设置事件处理程序，并在每次创建页面时执行此操作，即使在回发期间也是如此。确保您**没有**像这样的块中的代码：

```
if(!this.IsPostback)
{
  ...
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-26T19:53:53.477

您是否尝试在单击图像之前在页面加载方法中设置断点？我怀疑这可能表明回发正在发生，即使图像点击处理程序没有被触发。

回发期间是否也调用了创建图像按钮的代码？如果没有，页面将回发，但图像按钮将不存在来调用点击处理程序。听起来很奇怪，但它让我抓了好几次。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T09:00:20.793

我终于解决了（就在昨天）。

我想我构建按钮为时已晚：在 Page_PreRender 中（在事件被触发之后）也许如果我将创建放在 Page_Load 中（是的，我也在 PostBack 上创建所有内容）它会处理点击，但我想我不会尝试，因为我找到了解决方法。

我将为可能遇到相同问题的任何人解释：

```
private TableCell cellOK(string id)
{
    TableCell cellOK = new TableCell();
    cellOK.Style.Add(HtmlTextWriterStyle.TextAlign, "Center");
    Image redBall = new Image();
    redBall.ID = id; // useless
    redBall.ImageUrl = "redball.gif";
    HyperLink hl = new HyperLink();
    hl.Controls.Add(redBall);
    hl.NavigateUrl = MyPage + "?id=" + id;
    cellOK.Controls.Add(hl);
    return cellOK;
} 
```

并在 Page_Init()

```
string m_QueryStringId = Request.QueryString.Get("id");
if (!string.IsNullOrEmpty(m_QueryStringId))
{
    // Do something
} 
```

# asp.net - 如何在 JavaScript 中打开文件对话框？

> ID：438650
> 
> 赞同：-1
> 
> 时间：2009-01-13T11:12:43.240
> 
> 标签：asp.net, javascript

如何在 JavaScript 中获得“打开文件对话框”框？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T11:18:51.823

Javascript 无法打开文件。（至少不是以任何跨浏览器安全方式）。

可能你会感兴趣（[这里](http://www.cs.tut.fi/~jkorpela/forms/file.html)`<input type="file" />`有一个介绍）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T11:33:56.800

简短的回答是不，你不能通过纯 Javascript 来做到这一点；唯一的方法是通过带有`<input type="file">`元素的 HTML 表单。

# asp.net-mvc - 如何在 jqgrid 上实现搜索？

> ID：438659
> 
> 赞同：29
> 
> 时间：2009-01-13T11:15:53.870
> 
> 标签：asp.net-mvc, jqgrid

所以我有 jqgrid 在 ASP.NET MVC 中工作的基本示例，javascript 看起来像这样：

```
 $(document).ready(function() {

        $("#list").jqGrid({
            url: '../../Home/Example',
            datatype: 'json',
            myType: 'GET',
            colNames: ['Id', 'Action', 'Parameters'],
            colModel: [
                   { name: 'id', index: 'id', width: 55, resizable: true },
                   { name: 'action', index: 'action', width: 90, resizable: true },
                   { name: 'paramters', index: 'parameters', width: 120, resizable: true}],
            pager: $('#pager'),
            rowNum: 10,
            rowList: [10, 20, 30],
            sortname: 'id',
            sortorder: 'desc',
            viewrecords: true,
            multikey: "ctrlKey",
            imgpath: '../../themes/basic/images',
            caption: 'Messages'
        }); 
```

现在我正在尝试实现他们在[jqgrid 示例](http://www.trirand.com/jqgrid/jqgrid.html)中的搜索按钮（单击操作/网格数据）。但我不明白他们是如何实现它的。我期待例如“search：true”和实现它的方法。

有没有人在 jqgrid 上实现了搜索，或者知道明确显示如何做到这一点的示例？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-04-16T23:16:18.037

我最近自己（实际上是昨天）第一次实现了这个。对我来说最大的障碍是弄清楚如何编写控制器功能。函数签名是我花了最长时间才弄清楚的（注意 _search、searchField、searchOper 和 searchString 参数，因为我见过的大多数 asp.net mvc 示例都缺少这些参数）。javascript 发布到控制器以进行初始加载和搜索调用。您将在代码中看到我正在检查 _search 参数是否为真。

下面是控制器和javascript代码。对于任何格式问题，我深表歉意，因为这是我第一次在这里发帖。

```
public ActionResult GetAppGroups(string sidx, string sord, int page, int rows, bool _search, string searchField, string searchOper, string searchString)
{
    List<AppGroup> groups = service.GetAppGroups();
    List<AppGroup> results;
    if (_search)
       results = groups.Where(x => x.Name.Contains(searchString)).ToList();
    else
       results = groups.Skip(page * rows).Take(rows).ToList();

    int i = 1;

    var jsonData = new
    {
        total = groups.Count / 20,
        page = page,
        records = groups.Count,
        rows = (
            from appgroup in results
            select new
            {
                i = i++,
                cell = new string[] {
                         appgroup.Name,
                         appgroup.Description
                     }
            }).ToArray()
    };

    return Json(jsonData);
} 
```

这是我的 HTML/Javascript：

```
$(document).ready(function() {
  $("#listGroups").jqGrid({
    url: '<%= ResolveUrl("~/JSON/GetAppGroups/") %>',
    datatype: 'json',
    mtype: 'GET',
    caption: 'App Groups',
    colNames: ['Name', 'Description'],
    colModel: [
        { name: 'Name', index: 'Name', width: 250, resizable: true, editable: false},
        { name: 'Description', index: 'Description', width: 650, resizable: true, editable: false},
    ],
    loadtext: 'Loading Unix App Groups...',
    multiselect: true,
    pager: $("#pager"),
    rowNum: 10,
    rowList: [5,10,20,50],
    sortname: 'ID',
    sortorder: 'desc',
    viewrecords: true,
    imgpath: '../scripts/jqgrid/themes/basic/images'
//});
}).navGrid('#pager', {search:true, edit: false, add:false, del:false, searchtext:"Search"}); 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2010-02-19T09:29:42.957

请参阅我关于 codeproject 的文章，其中解释了我们如何在 jqgrid 中进行多重搜索：

[在 ASP.NET MVC 中使用带有多个过滤器的 jqGrid 搜索工具栏](http://www.codeproject.com/script/Articles/MemberArticles.aspx?amid=4096974)

我使用 IModelBinder 进行网格的设置绑定，使用表达式树对数据进行排序和过滤。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-12T16:10:31.133

如果您仍然想知道如何处理可选参数，只需通过`?`在类型名称后添加 a 来将它们声明为可为空。

现在您可以将它们与它们进行比较`null`以检查它们是否不存在。

请注意，您不需要对字符串执行此操作，因为它们已经可以为空。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-17T16:42:27.103

@Alan-好的，我使用了您的方法并扩展了我的网络服务以期望这三个额外的参数并检查“_search”是否为真/假。但是，为了完成这项工作，我必须在 JavaScript 中将其添加到我的 ajax 调用中：

```
if (!postdata._search) {    
           jQuery("#mygrid").appendPostData( {searchField:'', searchOper:'', searchString:''});  
} 
```

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-03-17T08:59:10.470

只需点击[此链接](http://trirand.com/jqgrid/jqgrid.html)。它解释了所有实现...

您可以创建一个按钮`searchBtn`，并可以在点击时调用搜索表单

```
$("#searchBtn").click(function(){
   jQuery("#list4").searchGrid(
   {options}
    )}); 
```

# .net - 如何从 WCF 服务返回用户定义的类型？

> ID：438669
> 
> 赞同：7
> 
> 时间：2009-01-13T11:18:11.153
> 
> 标签：.net, wcf, web-services, user-defined-types

我有一个托管在 IIS 中的 WCF 服务。目的是让客户端进行调用并接收在另一个项目/dll 中定义的自定义类。我使用 svcutil.exe 生成了一个服务客户端。问题是这个自动生成的客户端包含我试图从服务返回的类的新部分/代理定义。它现在在我的原始自定义类和编译时新的部分定义之间引发转换错误。那么如何从 WCF 服务返回用户定义的类型呢？建议表示赞赏。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-13T12:22:12.100

如果您要从服务调用返回的类型未标记为 a，`DataContract`那么如果不向客户端应用程序提供相同程序集的副本，您将无法从 WCF 返回它。

```
using System;
using System.ServiceModel;

[ServiceContract]
interface IService
{
    [OperationContract]
    TimeSpan GetTimeSpan();
}

class Service : IService
{
    public TimeSpan GetTimeSpan() { return DateTime.Now.TimeOfDay; }
} 
```

为什么前面的代码可以工作呢？它之所以有效，是因为服务调用的`System.dll`双方都知道`System.TimeSpan`OperationContract 的返回类型`GetTimeSpan()`。

这是一个使用 a 的示例`DataContract`：

```
using System;
using System.ServiceModel;
using System.Runtime.Serialization;

[ServiceContract]
interface IService
{
    [OperationContract]
    Contract GetContract();
}

[DataContract]
class Contract
{
    [DataMember]
    public String MyProperty { get; set; }
}

class Service : IService
{
    public Contract GetContract() { return new Contract(); }
} 
```

现在您已经为您定义的类提供了序列化属性 ( `Contract`) - 这将允许您`svcutil.exe`在客户端应用程序中创建代理类，这些代理类将被序列化并发送到 WCF 服务。

现在，如果您想返回一个不是 a 的类型，`DataContract`您必须向您的客户端应用程序提供包含该类型的程序集的副本。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-13T11:43:41.290

需要发生的一件事是用户必须配置服务引用以使用 DLL 中的类型而不是代理定义的类 - [http://msdn.microsoft.com/en-us/library/ bb628653.aspx](http://msdn.microsoft.com/en-us/library/bb628653.aspx)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-13T12:06:54.440

我们过去曾走过这条路，确实问题在于，当然，这是两个不同的课程，因此您必须按照@Rich Reuter 提供的链接进行操作；

但是，我们已经了解了为什么这是不好的做法，因为它违背了 SOA 的第三条原则——“服务共享模式和契约，而不是类”。

当然，问题不仅仅是没有遵循某人在某个时候设定的“规则”，而是有充分的理由提出这个建议——我们了解到，服务和客户端之间如此紧密耦合的代价意味着它也很难发布——如果服务需要向该类添加另一个字段以服务另一个客户端——第一个客户端可能会受到影响；如果服务需要更改该类定义中的某些内容（以服务另一个客户端） - 第一个客户端将再次受到影响，反之亦然 - 客户端可能会影响服务的生命周期。

在大型项目中，这很快就会成为巨大的维护负担。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-13T12:21:51.990

只是为了[赞同 Yossi](https://stackoverflow.com/questions/438669/how-do-you-return-a-user-defined-type-from-a-wcf-service#438756) / [Rich 的](https://stackoverflow.com/questions/438669/how-do-you-return-a-user-defined-type-from-a-wcf-service#438718)想法：

*   是的，您可以添加对共享 dll 的引用（而不是使用生成的代理类）
*   是的，它破坏了数据合同的许多意图，如果发生任何类型的自定义序列化，您可能会遇到扩展服务的问题

我以前曾走过这条路，在某些方面我希望我没有。重新可扩展性/自定义序列化 - 你必须*非常*小心。如果您使用诸如[protobuf-net](http://code.google.com/p/protobuf-net/)之类的预卷序列化程序（它可以直接集成到 WCF，并且在设计时考虑到可扩展性）会容易一些，但并不容易。

实际上，共享类的一个*优点*是它使测试更容易一些：因为你`IFoo`到处都有相同的，你可以`IFoo`以合理的成功机会模拟它。当涉及代理时（因为您在测试代码和生产代码之间更改了更多移动部分），就更难模拟了。

# jquery - 如何在jQuery中选择链接而不是子链接？

> ID：438675
> 
> 赞同：2
> 
> 时间：2009-01-13T11:20:38.043
> 
> 标签：jquery, css-selectors

如何在 jQuery 中仅选择 div 元素内的链接，而不选择该 div 中包含的子 div 元素？

```
<div>
    <a>Link 1</a>
    <a>Link 2</a>
    <div>
        <a>Not these 1</a>
        <a>Not these 2</a>
    </div>
</div> 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-13T11:24:19.893

使用直接子选择器 >

例如

```
$('div>a') 
```

**更新：** 安抚RoBorg先生

如果您在第一个 div 内的嵌套元素中确实有锚点，那么以下内容将起作用。这使用过滤器来确保父 div 确实是您的目标 div，而不是嵌套 div。

[演示](http://pastebin.me/496c8121962f9)

```
 var firstDivAnchors = $('div a').filter( function(){
        return $(this).closest('div').is('#yourDiv');
  }); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-13T11:52:13.173

如果您要定位特定的 div，您可以尝试：

`$("div#mydiv a :not(div a)");`

编辑：如果您发布更多上下文（HTML）会很棒:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T12:11:50.437

我记不太清楚了，但是 children() 不可以吗？

$(thisDiv).children('a')

在 docs.jquery.com 中它显示： children() 获取一组元素，其中包含每个匹配的元素集的所有唯一直接子元素。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-05-27T17:08:14.983

我认为 Danita 走在了正确的轨道上，但她的样本也对我不起作用。但是，使用 .not() 确实有效：

鉴于：

```
<div id="testdiv">
    <span><a>span a</a></span> <a>a</a>
    <div>
        <a>div a</a><span><a>div span a</a></span>
    </div>
</div> 
```

仅查找未嵌套在嵌套 div 中的标签。

```
var test = $('#testdiv').find('a').not('#testdiv div a');
$(test).each(function(){
    trace( $(this).html());
}); 
```

它不仅会忽略嵌套 div 中的标签，也不会忽略嵌套在 spans 中的 a 标签。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-09-28T16:58:45.137

我也有同样的需要，环顾四周。受这里的一些答案的启发，我写了这个

```
$('div a').not('div div a') 
```

我已经对此进行了测试，并且可以正常工作！:-)

# python - 如何在python中将long列表转换为逗号分隔的字符串

> ID：438684
> 
> 赞同：31
> 
> 时间：2009-01-13T11:24:45.727
> 
> 标签：python

我是 python 新手，并且有一个 long 列表，我想将它们组合成一个逗号分隔的字符串。

在 PHP 中，我会做这样的事情：

```
$output = implode(",", $array) 
```

在 Python 中，我不确定如何执行此操作。我试过使用连接，但这不起作用，因为元素类型错误（即，不是字符串）。我是否需要创建列表的副本并将副本中的每个元素从 long 转换为字符串？或者有更简单的方法吗？

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2009-01-13T11:28:11.867

您必须将整数转换为字符串，然后才能加入它们：

```
','.join([str(i) for i in list_of_ints]) 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-01-13T11:30:50.457

您可以使用 map 来转换列表，然后将它们连接起来。

```
",".join( map( str, list_of_things ) ) 
```

顺便说一句，这适用于任何对象（不仅仅是多头）。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-01-13T11:37:13.547

从 Python 2.5 开始，您可以从 heikogerlach 的答案中省略方括号，我认为：

`','.join(str(i) for i in list_of_ints)`

这非常相似，但不是构建所有字符串的（可能很大）临时列表，而是根据连接函数的需要一次生成一个。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-07-22T07:36:04.550

还有另一个版本（很酷，嗯？）

```
str(list_of_numbers)[1:-1] 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-13T11:46:55.633

只是为了它，您还可以使用字符串格式：

```
",".join("{0}".format(i) for i in list_of_things) 
```

# c# - 具有直接用户输入的动态 LINQ，有什么危险吗？

> ID：438704
> 
> 赞同：10
> 
> 时间：2009-01-13T11:34:09.840
> 
> 标签：c#, linq, sql-injection, dynamic-linq

我在 ASP.NET MVC 应用程序中有一个表，我想使用 AJAX 对其进行排序（服务器端）和过滤。我希望它在其他地方相当容易使用，并且不想将排序和过滤硬编码到查询表达式中，所以我寻找一种动态构建表达式的方法，我发现最好的方法是使用 Dynamic LINQ .

来自如下 URL 的用户输入直接插入到动态 Where 或 OrderBy。

```
/Orders?sortby=OrderID&order=desc&CustomerName=Microsoft 
```

这将导致两个表达式：

```
OrderBy("OrderID descending")
Where(@"CustomerName.Contains(""Microsoft"")") 
```

虽然我知道它不会直接扔到数据库中并且在此处插入直接 SQL 将不起作用，因为它不能反映到属性并且它是类型安全的，我想知道是否有人比我更有创意无论如何都可以找到一种利用它的方法。我能想到的一个利用是可以对表中不可见的属性进行排序/过滤，但这并不是那么有害，因为它们仍然不会显示并且可以通过散列来防止。

我允许直接用户输入的唯一方法是使用 OrderBy 和 Where。

只是确保，谢谢:)

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-13T11:46:08.163

> 因为 LINQ to SQL 使用类型安全的数据模型类，所以默认情况下可以保护您免受 SQL 注入攻击。LINQ to SQL 将根据基础数据类型自动对值进行编码。
> (c) 斯科特古

但是您仍然可以在那里获得“除以零”，因此建议处理所有意外异常并限制有效条目的长度，JIC

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-13T13:08:37.217

嗯...我刚刚发现至少一个 Dynamic Linq 可能存在的问题。只需执行此代码段 1000 次并观察 CPU 和内存消耗是否会上升（为拒绝服务攻击创建一种简单的方法）：

```
var lambda = DynamicExpression
  .ParseLambda<Order, bool>("Customer=string.Format(\"{0,9999999}"+
     "{0,9999999}{0,9999999}{0,9999999}{0,9999999}\",Customer)")
  .Compile();

var arg = new Order
{
  Total = 11
};
Console.WriteLine(lambda(arg)); 
```

我为此写了[一篇博文](http://rabdullin.com/journal/2009/1/13/vulnerability-of-the-dynamic-linq.html)。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-13T11:39:33.760

只是一个想法，但是您看过 ADO.NET 数据服务吗？这提供了一个支持 REST 的 API，与上面非常相似，并且内置了许多标准 LINQ 功能。

我想不出一个有趣的动态 LINQ 漏洞利用，但如果这是我，我*至少*会成为白名单成员（`OrderID`,`CustomerName`等） - 但我可能会`Expression`直接编写逻辑；如果您只支持直接属性，这并不是特别难。

例如，这里是`Where`（使用你的`Contains`逻辑）：

```
static IQueryable<T> Where<T>(this IQueryable<T> source,
    string member, string value)
{
    var param = Expression.Parameter(typeof(T), "x");
    var arg = Expression.Constant(value, typeof(string));
    var prop = Expression.PropertyOrField(param, member);
    MethodInfo method = typeof(string).GetMethod(
        "Contains", new[] { typeof(string) });
    var invoke = Expression.Call(prop, method, arg);
    var lambda = Expression.Lambda<Func<T, bool>>(invoke, param);

    return source.Where(lambda);
} 
```

我之前已经介绍`OrderBy` [过，这里](http://groups.google.com/group/microsoft.public.dotnet.languages.csharp/browse_thread/thread/9ca28e3f0205bb87/7d931ec0e2356d21#7d931ec0e2356d21)。

# asp.net - 在 ASP.NET MVC 中处理 CSS 和图像

> ID：438707
> 
> 赞同：6
> 
> 时间：2009-01-13T11:37:11.893
> 
> 标签：asp.net, asp.net-mvc, css

您好我正在开发一个基于 ASP.NET MVC 的简单应用程序。我已将默认的 master.css 更改为我自己的样式。现在唯一的问题是我将 background-image 属性添加到我的 UL->Li->A 之一以创建菜单。它在 Firefox 中运行良好，但图像在 Internet Explorer (IE7/8) 中根本没有显示。有谁知道出了什么问题？

我的 CSS 如下；

```
 #nav-menu ul
{
    list-style: none;
    padding: 0;
    margin: 0;
    color:White;
}
#nav-menu li
{
    /*float: left;*/
    margin: 0.15em 0.15em;
    display:block;

}

#nav-menu li a
{
    background-image: url('/Images/leftbarlightblue.jpg');
    background-repeat:no-repeat;
    background-position:bottom;

    height: 2em;
    line-height: 2em;   
    width: 12em;
    display: block;
    text-decoration: none;
    text-align: center;
    color: white;
}

#nav-menu li a:hover
{
    background-image: url('./Images/leftbardarkblue.jpg');
    background-repeat:no-repeat;
    background-position:bottom;

    height: 2em;
    line-height: 2em;

    width: 12em;
    display: block;

    color: white;
    text-decoration: none;
    text-align: center;
}
#nav-menu
{
    width:15em
} 
```

而 XHTML 是

```
<div id="menucontainer">
            <div id="nav-menu">
                <ul>
                    <li><%= Html.ActionLink("Home", "Index", "Home")%></li>
                    <li><%= Html.ActionLink("About Us", "About", "Home")%></li>                
                </ul>
            </div>

    </div> 
```

1.  是的，我尝试使用 ./Images/... 但它仍然无法正常工作。

2.  以下是我的文件夹层次结构

    ```
    解决方案 -> 内容
                   网站.css
                   图片
                          标志.jpg
                          leftbarlightblue.jpg
           ->控制器
           -> 模型
           ->视图
                 家
                 共享
                         Site.Master

    ```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T13:27:59.643

您的样式表需要使用如下文字路径：

```
background-image: url('/Content/Images/leftbarlightblue.jpg'); 
```

并不是

```
background-image: url('/Images/leftbarlightblue.jpg'); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-13T11:49:15.537

如果您经常使用 CSS，我真的建议您使用 FireFox 和 FireBug，它可以让您即时查看样式表，并确切了解为什么某些事情无法正常工作。

接下来，您是否仔细检查了图像的 URL 是否正确？一种快速检查的方法是获取绝对 URL（在浏览器中浏览它以确保它应该类似于[http://myapp/content/images/leftbarlightblue.jpg](http://myapp/content/images/leftbarlightblue.jpg)）并将其放在您的代码中而不是您的旧图片网址。如果加载，那么可能是您的相对路径错误（../ 部分），因为我不知道您的文件夹结构，我无法帮助您了解它应该是什么。

在单独的音符背景位置应该有水平位置后跟垂直位置。

背景位置：左下角；

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T11:45:09.053

我猜显示取决于网址。

您的 master.css 位于何处？

你试过`url('Images/leftbarlightblue.jpg')`吗？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-13T12:28:03.227

我遇到了问题，图像是使用 CMYK 创建的。所以 FF 使用近似颜色显示它们，而 Internet Explorer 完全忽略它们。更改格式可以解决问题。谢谢你们的帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T11:44:48.713

添加 XHTMLfor #nav-menu，如果您也有此问题的实时链接，也可以发布

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-13T12:56:44.510

尝试在没有所有额外点和斜杠的情况下启动图像路径。例如：

```
/images/image.jpg 
```

代替

```
../../images/image.jpg 
```

我仍然不确定文件是如何存储在您的实际网络服务器上的，因此您可能需要添加一两个目录，但通常使用点告诉服务器目录树中有多少级是不明智的（加上很多人忘记了您需要指定从 CSS 文件的位置看到的图像的位置，而不一定是 HTML/ASP 文件的位置）

# spring - 您认为 Spring WebFlow 流定义格式是否适合将 Web 流外部化为非 Spring 框架？

> ID：438709
> 
> 赞同：0
> 
> 时间：2009-01-13T11:37:41.020
> 
> 标签：spring, frameworks, spring-webflow, page-flow

我喜欢 Spring WebFlow 的想法——尤其是流定义从 Spring Bean Container 中的组件抽象出更高级别的 Web 流的方式。

流定义格式似乎包含了 Web 流中所需的一切——视图、操作、转换、子流、结果等。

您认为 Spring WebFlow 流定义格式是否适合将 Web 流外部化为非 Spring 框架？一些不使用 Spring 甚至 Java 的底层组件。

请记住，我只考虑页面流，而不是一般工作流或 BPEL 类型的东西

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T13:27:29.440

自从构建第一个 Web 应用程序以来，状态机（如 spring webflow）已被用于描述 Web 应用程序流。所以是的，没关系。为什么不是每个人都这样做？我认为，当使用状态机来描述 Web 流时，形式主义倾向于过度使用。一开始是个好主意，但最终却变得更加痛苦。Ajax 和给定页面上的多个并发活动状态使情况变得更糟。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-19T21:37:32.873

The biggest strength of the SWF in my opinion is that centralizes flow (navigation) in a single place and makes it explicit, easy to read, manipulate etc. It is well suited for more complex navigation flows where you might go back and forth between pages, or for wizard-like or step-by-step UIs. It also has some advanced reuse features like subflows and flow inheritance.

The concept of view state and action state well mimics user - web app interaction where transition to action occurs after user has created an event, then the next view is presented to a user and the machine is in a state waiting for next user event. It is important to note that these flows occur on server side. Everythnig seems to be moving to a client side these days and even so state machine can have its role. Flex for example has a concept of [states](http://www.adobe.com/devnet/flex/quickstart/creating_states/) and transitions. These should help programmer manage complex UIs with lots of controls. States can hide or display controls and much more. So, I’d say this can be a very neat paradigm for modeling flows and user interactions.

# mysql - 从多个 MySQL 表中选择

> ID：438711
> 
> 赞同：1
> 
> 时间：2009-01-13T11:38:05.700
> 
> 标签：mysql, select

我有一些具有相似字段但不完全相同的表。

他们拥有的相同字段是描述（文本字段）和修改（unixtime）

我想根据 unixtime 从这些表中选择最后修改的项目。我不能使用 UNION 因为表不一样并且多表选择超时。

我一直在寻找这个但没有运气，要么人们正在使用 JOINS 要么 SELECT A. *, B.* FROM table A, table B

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T11:46:58.990

它们有多大不同？也许你可以得到公共领域：

```
select t1.name1 as name from table1
union
select t2.name2 as name from table2 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T11:47:09.130

试试这个：

```
SELECT
    IF (A.modified > B.modified, A.modified, B.modified) AS modified,
    IF (A.modified > B.modified, A.description, B.description) AS description,
FROM
    (SELECT description, modified FROM A ORDER BY modified DESC LIMIT 1) AS A,
    (SELECT description, modified FROM B ORDER BY modified DESC LIMIT 1) AS B
LIMIT 1 
```

但是，这与只执行两个查询几乎相同（只是更复杂），所以我不推荐它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T11:53:59.910

如果您选择时间，请尝试在“已修改”上添加 desc 索引，并使用 select 限制仅返回一个（最后）行。

那么你就可以：

```
SELECT 
    A,B,C,D, desc, modified 
FROM 
   TABLEA
UNION ALL 
SELECT 
    CAST(E as <A type>), CAST(F AS <B type>) ..., desc, modified   
FROM 
   TABLE B 
```

# visual-studio - SharePoint WebPart 包和 dll

> ID：438712
> 
> 赞同：1
> 
> 时间：2009-01-13T11:38:14.280
> 
> 标签：visual-studio, sharepoint, dll, web-parts

我在 Visual Studio 中有一个 SharePoint WebPart 项目。作为项目的一部分，我引用了 interop.ActiveDS.dll。

我可以成功编译项目并将解决方案添加/部署到 SharePoint。当我尝试在 SharePoint 中运行 WebPart 时，出现错误：

```
That assembly does not allow partially trusted callers.

[SecurityException: That assembly does not allow partially trusted callers.]
   PeopleAdWebPart.PeopleAdWebPart.OnLoad(EventArgs e) +0
   System.Web.UI.Control.LoadRecursive() +47
   System.Web.UI.Control.LoadRecursive() +131
   System.Web.UI.Control.LoadRecursive() +131
   System.Web.UI.Control.LoadRecursive() +131
   System.Web.UI.Control.LoadRecursive() +131
   System.Web.UI.Control.LoadRecursive() +131
   System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint) +7350
   System.Web.UI.Page.ProcessRequest(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint) +213
   System.Web.UI.Page.ProcessRequest() +86
   System.Web.UI.Page.ProcessRequestWithNoAssert(HttpContext context) +18
   System.Web.UI.Page.ProcessRequest(HttpContext context) +49
   Microsoft.SharePoint.Publishing.TemplateRedirectionPage.ProcessRequest(HttpContext context) +153
   System.Web.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute() +358
   System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean& completedSynchronously) +64 
```

我已将 [assembly: System.Security.AllowPartiallyTrustedCallers] 添加到 assemblyinfo.cs 文件，但这并没有帮助。

将不胜感激任何答案！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T12:15:29.320

将其部署到 GAC 似乎是一种可能的解决方案：

[http://social.msdn.microsoft.com/Forums/en-US/sharepointdevelopment/thread/f9bff1aa-007b-4933-bb5b-56a283aea227/](http://social.msdn.microsoft.com/Forums/en-US/sharepointdevelopment/thread/f9bff1aa-007b-4933-bb5b-56a283aea227/)

祝一切顺利

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T05:01:46.670

问题是 Interop.ActiveDs.dll 不允许部分受信任的调用者。您最好的选择是将签名的互操作程序集部署到 GAC：

```
TlbImp %windir%\system32\ActiveDs.tlb /out:Interop.ActiveDs.dll /keyfile:KeyFile.snk 
```

# .net - 如何在 VB.Net 中对 System.Collections.Generic.List 进行排序？

> ID：438715
> 
> 赞同：30
> 
> 时间：2009-01-13T11:41:08.720
> 
> 标签：.net, vb.net, sorting

我使用一个通用列表（m_equipmentList），它是对象的集合（Schedule_Payitem）。
如何根据子对象的属性对列表进行排序？

```
Dim m_equipmentList As New List(Of Schedule_Payitem) 
```

需要根据 Schedule_Payitem 的 resourceid 属性对 m_equipmentList 进行排序。

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2009-01-13T11:55:33.557

你用的是VB9吗？如果是这样，我会使用[lambda 表达式](http://www.danielmoth.com/Blog/2007/02/lambda-expressions-in-vb9.html)来创建一个`Comparer(Of Schedule_PayItem)`. 否则，编写一个短类来实现`IComparer(Of Schedule_PayItem)`。将您进入 List.Sort 的任何一个传递。

lambda 表达式的示例（未经测试）：

```
m_equipmentList.Sort(Function(p1, p2) p1.ResourceID.CompareTo(p2.ResourceID)) 
```

对于`IComparer(Of Schedule_PayItem)`：

```
Public Class PayItemResourceComparer
    Implements IComparer(Of Schedule_PayItem)
    Public Function Compare(ByVal p1 As Schedule_PayItem, _
                            ByVal p2 As Schedule_PayItem) As Integer
        Return p1.ResourceID.CompareTo(p2.ResourceID)
    End Function
End Class

...

m_equipmentList.Sort(New PayItemResourceComparer) 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-13T11:54:41.577

我不知道 vb.net 所以我用 C#

```
m_equipmentList.Sort(
   (payItem1,payItem2)=>payItem1.ResourceID.CompareTo(payItem2.ResourceID)); 
```

并使用反射器将其翻译到 vb.net 希望对您有所帮助

```
m_equipmentList.Sort(
Function (ByVal payItem1 As Schedule_Payitem, ByVal payItem2 As Schedule_Payitem) 
    Return payItem1.ResourceID.CompareTo(payItem2.ResourceID)
End Function) 
```

或者您可以从 IComparable 继承 Schedule_Payitem 并实现 CompareTo 然后只需调用`m_equipmentList.Sort()`

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-04-11T18:39:16.560

你可以通过改变这个来完成列表的降序排序 -

```
m_equipmentList.Sort(
Function (ByVal payItem1 As Schedule_Payitem, ByVal payItem2 As Schedule_Payitem) 
    Return payItem1.ResourceID.CompareTo(payItem2.ResourceID)
End Function) 
```

对此

```
m_equipmentList.Sort(
Function (ByVal payItem1 As Schedule_Payitem, ByVal payItem2 As Schedule_Payitem) 
    Return payItem2.ResourceID.CompareTo(payItem1.ResourceID)
End Function) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T11:48:57.113

试试这个

```
Dim m_equipmentList As New List(Of Schedule_Payitem)

m_equipmentList.Sort(delegate(Schedule_Payitem p1, Schedule_Payitem p2)
              {
                  return p1.resourceid .CompareTo(p2.resourceid );
              }); 
```

# javascript - 如何在 Internet Explorer 6 中取消注册事件处理程序？

> ID：438720
> 
> 赞同：0
> 
> 时间：2009-01-13T11:43:58.260
> 
> 标签：javascript, events, httphandler

我正在使用 html 表单的 onload 方法注册一个函数，我需要在卸载表单时取消注册此事件处理函数。如何在 Internet Explorer 6 中执行此操作？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-13T11:59:47.637

如果您在 HTML 中或通过 JavaScript 添加了 onload

```
<form onload="blah()"> 
```

或者

```
myForm.onload = blah; 
```

然后

```
myForm.onload = null; 
```

如果您使用了 attachEvent应该这样做

```
myForm.attachEvent( 'onload', blah ); 
```

利用

```
myForm.detachEvent( 'onload', blah ); 
```

**编辑**
我不确定表单是否有加载事件，你确定吗？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-13T11:49:40.997

使用分离事件

[参考](http://msdn.microsoft.com/en-us/library/ms536411(VS.85).aspx)

# singleton - smalltalk 单例模式：如何初始化实例变量？

> ID：438729
> 
> 赞同：10
> 
> 时间：2009-01-13T11:47:53.200
> 
> 标签：singleton, smalltalk, instance-variables

我无法让单例模式在 smalltalk 中初始化实例变量。（这里是[另一个实现的链接以](http://www.eli.sdsu.edu/courses/spring01/cs635/notes/singleton/singleton.html#slide7)进行澄清）

这就是我所拥有的：

```
new

^UniqueInstance ifNil: [UniqueInstance := self basicNew.
                        UniqueInstance: instanceVar := Object new. ]. 
```

最后一行 (UniqueInstance: instanceVar := Object new.) 不起作用，但这基本上就是我需要做的：在将 UniqueInstance 返回给调用者之前将 instanceVar 实例化为对象。

请注意，此“新”方法用作类实例化，并且库是 UniqueIsntance（所需类的实例）的实例变量。

谁能指出我正确的方向？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-13T12:19:06.787

尝试更简单：

```
YourClass class>>singleton

       UniqueInstance ifNil: [UniqueInstance := self basicNew initialize].
       ^UniqueInstance 
```

然后在你的类的实例侧实现一个适当的 #initialize 方法，例如：

```
YourClass>>initialize

          someInstvar := someInitalValue.
         ^self 
```

**更新:** : 访问单例的类方法名称不同，可以是#default、#current 或#singleton。我主要是以后用。

# python - FileNotFoundException -Python 中的帮助

> ID：438733
> 
> 赞同：-2
> 
> 时间：2009-01-13T11:50:25.020
> 
> 标签：python, handler, filenotfoundexception

这是我的代码：

```
try:
    import clr, sys
    from xml.dom.minidom import parse
    import datetime
    sys.path.append("C:\\teest")
    clr.AddReference("TCdll")
    from ClassLibrary1 import Class1
    cl = Class1()
except ( ImportError ) :
    print "Module may not be existing " 
```

我的 TCdll 在 C:\test 中。我只是将它作为 C:\teest 给出以了解错误。

例外是：

```
 Traceback (most recent call last):
      File "C:/Python25/13thjan/PSE.py", line 8, in <module>
        clr.AddReference("TCdll")
    FileNotFoundException: Unable to find assembly 'TCdll'.
       at Python.Runtime.CLRModule.AddReference(String name) 
```

如何处理这个异常？？

立即需要帮助

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T12:17:54.323

您需要了解 clr.AddReference 如何映射到文件名。

编辑：

我想您是在问如何从 AddReference 调用中捕获异常？

代替：

```
clr.AddReference("TCdll") 
```

和：

```
try:
    clr.AddReference("TCdll")
except FileNotFoundException,e:
    print "Failed to find reference",e
    sys.exit(1) 
```

# wpf - WPF MediaElement 视频播放撕裂

> ID：438741
> 
> 赞同：2
> 
> 时间：2009-01-13T11:58:51.570
> 
> 标签：wpf, video, mediaelement

我正在尝试使用 WPF 中的 MediaElement 控件来播放视频。它在 Vista 中运行良好，但是当我在 XP 机器上运行它时，我的显示会撕裂。看起来好像它没有使用垂直同步，只是更新屏幕中间绘制。

有谁知道如何解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T18:41:39.027

与 Vista 相比，这更多地与 WPF 在 XP 下呈现到屏幕的方式有关。在 Vista 下，应用程序呈现到屏幕外缓冲区，然后与已更改的其他窗口合成，并由名为 DWM.exe 的进程以适当的时间间隔呈现到屏幕上。这可以（并且可能确实）将 WPF 的窗口更新呈现给与刷新间隔同步的视频缓冲区。

在 XP WPF 上，使用 DirextX 直接渲染到屏幕上，并随时更新视频缓冲区。可能有一些方法可以让它与刷新间隔同步，但我没有研究它，因为我不再使用 XP。

# c# - 哪本书是学习 Linq 的最佳书籍，包括 Linq to Entities？

> ID：438742
> 
> 赞同：16
> 
> 时间：2009-01-13T11:59:37.153
> 
> 标签：c#, linq, entity-framework, linq-to-entities, .net-3.5

我听到很多关于 Linq in Action 一书的评论，但它不包括 Linq to Entities。
请提供您对您可能阅读过的书籍的反馈。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-13T12:04:17.517

[LINQ in Action](http://www.manning.com/marguerie/)是一本了解 LINQ 原理的好书，尤其是 LINQ-to-SQL。

[C# in Depth](http://manning.com/skeet/)有助于了解 LINQ 在语言级别的工作原理，包括查询语法、扩展方法和表达式树。

EF ...更棘手。一个问题是，由于[“thunderdome”场景](http://codebetter.com/blogs/ian_cooper/archive/2008/11/03/linq-to-sql-ef-and-the-thunderdome-solution.aspx)，它可能会在现在和下一个版本之间发生相当大的变化。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-03T21:17:31.813

检查一下，直到出现一本好书可能会有所帮助：[http ://weblogs.asp.net/zeeshanhirani/archive/2008/12/05/my-christmas-present-to-the-entity-framework-community.aspx](http://weblogs.asp.net/zeeshanhirani/archive/2008/12/05/my-christmas-present-to-the-entity-framework-community.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-11T22:34:02.060

LINQ in Action 这本书非常好。我已经用非常深入的 Programming Entity Framework 书 (978-0596520281) 对其进行了补充。

我发现这些书是互补的。LINQ in Action 一书为您提供了一个很好的基础，并且在您真正需要一些内容（即LINQ to Entities）的地方，其他文本可以完成这项工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T12:23:32.923

我两者都有，但[APress 的 Pro Linq](http://www.apress.com/book/view/1590597893)可能是我日常使用最多的一个。不幸的是，第一版（当前？）没有涵盖 Linq to Entities。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-11T22:51:35.327

我最近一直在阅读[Entity Framework in Action](http://www.manning.com/mostarda/)的早期草稿；它似乎沿着正确的路线，但还没有完成。

在这个时间点，我想知道哪些书籍涵盖了 VS2010/.NET 4.0 版本的实体框架，因为正在进行相当大的更改。我不知道上面的书是否会针对 3.5 SP1 或 4.0 发布，但它比现有的死树更有可能成为最新的。

# debugging - 一个很好的测试平台，可以在没有 LMS 的情况下调试 SCORM 课件（Applet）

> ID：438746
> 
> 赞同：1
> 
> 时间：2009-01-13T12:00:18.243
> 
> 标签：debugging, moodle, scorm

什么是调试基于 JAVA APPLET 的 SCORM 内容包（eclipse）的好测试平台。

使用真正的 LMS（如 Moodle）进行调试通常需要将 zip 文件中的包上传到 LMS（慢..）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T12:19:01.357

ADL 自己提供了一些合规性测试软件（我认为是[这里](http://adlnet.gov/downloads/downloadpage.aspx?ID=344)的链接），这对于大多数需求（对我而言）来说总是足够好的测试，并且还存在许多免费和商业选项。我听说过关于[SCORM Test Track](http://www.scorm.com/products/testtrack.aspx)的好消息，但我自己没有使用过。

# wpf - WPF 独占模式

> ID：438747
> 
> 赞同：3
> 
> 时间：2009-01-13T12:01:08.397
> 
> 标签：wpf, video

是否可以在独占模式下运行 WPF 应用程序 - 它拥有整个屏幕？我想做全屏视频播放。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T12:07:22.457

如果您设置`WindowStyle`为`None`并最大化，那么您将接管全屏 - 包括任务栏。但是你必须实现自己的窗口镶边。

# asp.net - ASP.NET 事件未在包含大型 GridView 控件的页面中触发

> ID：438752
> 
> 赞同：3
> 
> 时间：2009-01-13T12:05:50.247
> 
> 标签：asp.net, gridview

我在 ASP 页面上有一个 GridView 控件，我已将其绑定到一个大（ish）数据源（大约 10k 行，有 24 个 varchar(50) 列）。该页面还有一个单独的（即不在 GridView 中）按钮控件。

问题是; 单击按钮似乎不会触发 PageLoad 或 Button___click 事件，我得到的只是“无法显示页面”错误。

有趣的是，如果我减小 GridView 后面的数据集大小，一切都会正常工作，并且会按预期触发事件。所以我假设它与页面上的数据量有关的某种超时或溢出。

如果我可以摆脱它，我并不特别想使用分页，所以问题是，是否有某种超时或设置可以更改以允许处理大型数据网格？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T12:23:09.353

您是否尝试过关闭页面上的 ViewState（您的 Page 指令中的 EnableViewState=false）？我可以想象，对于一个 1.2MB 的表，ViewState 非常大，它可能会压倒页面上的参数处理。

# nunit - 即使条件失败，NUnit 也会执行 All If 语句

> ID：438766
> 
> 赞同：-1
> 
> 时间：2009-01-13T12:14:25.283
> 
> 标签：nunit

我正在执行基于某些值的 If 语句，但 Nunit 执行所有语句，即使条件为假

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T12:22:16.843

NUnit 完全用 C# 编写，if 语句在 C# 中工作！:)

这一定是您的实施或解释中的错误。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T12:53:17.483

Nunit 实际上并不评估您的语句，它只是实例化您的测试并运行它们。我建议您安装[TestDriven.NET](http://testdriven.net)（如果您还没有安装的话），并在您的测试中使用右键单击测试运行器来使用调试器运行它。在您的代码中设置一些断点并查看将为 if 语句计算的值。我希望@Joe90 错误出在您的代码中，而不是 Nunit 中。

# c# - 缩放、旋转和裁剪图像

> ID：438769
> 
> 赞同：2
> 
> 时间：2009-01-13T12:16:01.270
> 
> 标签：c#, .net, wpf, image, image-manipulation

我希望在我的 GUI 中具有永久缩放、旋转和裁剪图像的功能（将更改保存到文件中）。WPF本身就可以吗？如果不是，是否有任何组件可以与 WPF 更集成地工作？

我还需要为 JPEG 和 TIFF 格式调整图像亮度和对比度，去除边框。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T13:56:35.437

CodeProject 上发布的这篇[文章](http://www.codeproject.com/KB/WPF/ImageCropper.aspx)解释了一个可能对您的需求有用的演示程序。还请查看此[博客](http://dedjo.blogspot.com/2008/05/brightness-and-contrast-manipulation-in.html)，其中包含有关亮度级别和对比度的文章。

# performance - 获取 MSSQL2000 服务器调用次数的最简单方法

> ID：438776
> 
> 赞同：1
> 
> 时间：2009-01-13T12:21:15.597
> 
> 标签：performance, sql-server-2000

有谁知道如何在指定时间（比如 24 小时）内获得对 MSSQL2000 服务器的调用总数？

我们想知道我们的生产机器每天接到多少电话，但我们找不到任何好的工具/策略。

最好的问候弗雷德里克

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T12:24:57.507

你可以使用 SQL Profiler 吗？

[http://technet.microsoft.com/en-us/library/aa173918(SQL.80).aspx](http://technet.microsoft.com/en-us/library/aa173918(SQL.80).aspx)
[http://www.sqlteam.com/article/sql-server-2000-performance-tuning-tools](http://www.sqlteam.com/article/sql-server-2000-performance-tuning-tools)
[http:// /support.microsoft.com/kb/325263](http://support.microsoft.com/kb/325263)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T00:41:45.437

我认为在这种情况下使用 SQL Profiler 有点过头了，特别是因为它会根据您跟踪的内容在服务器上产生大量负载。SQL Server 通过 sysperfinfo 系统表公开用于其性能计数器的原始值；您应该能够每天运行一次此查询并减去这些值以计算出您当天收到了多少 SQL 请求：

```
SELECT cntr_value 
FROM sysperfinfo 
WHERE object_name = 'SQLServer:SQL Statistics' 
AND counter_name = 'Batch Requests/sec' 
```

这显然只有在服务器一整天都运行时才有效；重新启动将重置数字。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-06T08:43:24.433

我以另一种方式解决了这个问题（所有呼叫都通过 IIS 集群“路由”，并且我能够分析他们的日志）。

谢谢！

# cruisecontrol.net - 使用 CruiseControl.net 的程序集版本控制

> ID：438782
> 
> 赞同：10
> 
> 时间：2009-01-13T12:23:11.507
> 
> 标签：cruisecontrol.net, versioning, assemblyinfo

我已经为我的一堆相关项目设置了 CruiseControl.net。因此，CruiseControl 中的单个项目标签具有多个 SVN 签出，然后一堆 msbuild 任务编译所有单独的 sln 文件。

完成此构建后，我需要更新所有解决方案的汇编版本。但是，由于我没有使用 nant 并且没有使用 MSBuild proj 文件，因此我不确定如何获得它。

我想知道我是否遗漏了一些明显的东西。我只需要一个解决方案，可以通过在 ccnet.config 文件中进行适当的更改来实现，而无需我对 csproj 文件进行更改。

谢谢，安杰

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-22T23:40:46.800

在您的项目中使用共享的 AssemblyInfo 怎么样？

这就是我们为我们的产品所做的：

*   每个项目都有自己的 AssemblyInfo.cs - 其中包含 AssemblyTitle、AssemblyDescription、Guid 和该程序集独有的其他属性。

*   每个项目还有另外两个 Assembly Info 文件，注意这些是作为链接而不是直接文件添加的（VS -> 添加 -> 现有文件 -> 添加为链接（添加旁边的小向下箭头））

两个链接文件：

1.  CompanyAssemblyInfo.cs——AssemblyCompany、AssemblyCopyright、AssemblyConfiguration、CLSCompliant、SecurityPermission 等。基本上我们想要的所有程序集都是标准的。

2.  ProductAssemblyInfo.cs - AssemblyProduct、AssemblyVersion、AssemblyFileVersion。这允许我们将相同版本从一个文件推送到所有程序集。

我们的 CI 和发布过程更加复杂，但这是它的核心 - 一个控制产品版本（程序集、安装程序、一切！）的单点（文件）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-29T23:50:53.813

有一项任务要做你所要求的。

您需要安装 MSBuildCommunity 任务，可在[此处](http://msbuildtasks.tigris.org/)找到。

然后，您可以创建如下内容：

```
<PropertyGroup>
<MyAssemblyVersion>$(CCNetLabel)</MyAssemblyVersion>
</PropertyGroup>

<Target Name="GenAssemblyInfo">
    <AssemblyInfo
      ContinueOnError="false"
      CodeLanguage="CS"
      OutputFile="$(MSBuildProjectDirectory)\YourAssembly\AssemblyInfo.cs"
      AssemblyTitle="blah"
      AssemblyDescription="blah blah"
      AssemblyCompany="Anj Software, Inc."
      AssemblyProduct="Anj's Awesome App"
      AssemblyCopyright="blah blah"
      CLSCompliant="false"
      AssemblyVersion="$(MyAssemblyVersion)"
      AssemblyFileVersion="$(MyAssemblyVersion)"
     />
</Target> 
```

请注意，您可以在 ccnet.config 文件中设置内部版本号前缀，以便您的程序集编号为 2.1.0.x，其中 x 是内部版本号。这就是我们在我工作的地方进行版本编号的方式。

您仍然需要保留一个默认的 AssemblyInfo.cs 文件作为构成您的解决方案的每个项目的一部分。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-13T13:07:40.307

我为此使用powershell。lpath 是源代码的路径，而 buildnum 是我附加的内部版本号。这就是我实际上所做的一切。但是，它应该足以让您更改或设置任何或所有其他可用字段。我传入 lpath 并从 CC.NET 中的可用环境变量中获取内部版本号，我可以一遍又一遍地使用此脚本，只需更改我在配置文件的命令行中传入的内容。如果这实际上是您需要修改的，我还有一个可以修改 C++ 代码的资源文件。

```
$files = Get-ChildItem $lpath -recurse -filter *AssemblyInfo.cs -name

Foreach ($file in $files)
{
    $file = $lpath + "\" + $file

    $fileObject=get-item $file

    $fileObject.Set_IsReadOnly($False)

    $sr = new-object System.IO.StreamReader( $file, [System.Text.Encoding]::GetEncoding("utf-8") ) 
    $content = $sr.ReadToEnd()
    $sr.Close()

    $content = [Regex]::Replace( $content, '(?<=\[assembly: AssemblyVersion\("[0-9].[0-9].[0-9].)[0-9]?[0-9]?[0-9]', $buildnum);
    $content = [Regex]::Replace( $content, '(?<=\[assembly: AssemblyFileVersion\("[0-9].[0-9].[0-9].)[0-9]?[0-9]?[0-9]', $buildnum);

    $sw = new-object System.IO.StreamWriter( $file, $false, [System.Text.Encoding]::GetEncoding("utf-8") )
    $sw.Write( $content )
    $sw.Close()

    $fileObject.Set_IsReadOnly($True)
} 
```

# php - 如何从 PHP 创建 MySQL 存储过程？

> ID：438788
> 
> 赞同：6
> 
> 时间：2009-01-13T12:26:22.747
> 
> 标签：php, mysql, stored-procedures

我尝试使用存储过程 (SP) 的 create 语句从 PHP 查询 MySQL 都失败了。这不可能吗？

如果确实可以，请举个例子。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-12-07T00:07:21.450

除了特权之外，很可能会导致您的问题是，实际上 mysql_query($query) 每次调用只能执行一个命令！

所以你要做的就是把命令分成几个 mysql_query($query) -calls。

我的意思是这样的：

```
$query = "DROP FUNCTION IF EXISTS fnElfProef (accountNr INT)";

mysql_query($query);

$query = "CREATE FUNCTION fnElfProef (accountNr INT)
    RETURNS BOOLEAN
       BEGIN
          DECLARE i, totaal INT DEFAULT 0;
          WHILE i < 9 DO
             SET i = i+1;
             SET totaal = totaal+(i*(accountNr%10));
             SET accountNr = FLOOR(accountNr/10);
          END WHILE;
       RETURN (totaal%11) = 0;
    END";
mysql_query($query);

$query = "SELECT * FROM mytable";
mysql_query($query); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T12:31:28.087

只要：

*   您正在使用 MySQL 5.0+
*   您的帐户已被授权创建存储过程
*   您正在使用有效的[CREATE PROCEDURE 语法](http://dev.mysql.com/doc/refman/5.0/en/create-procedure.html)

然后它应该工作。检查这些并与我们联系。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T12:32:14.403

[MySQL 手册对如何创建存储过程（*13.1.15.`CREATE PROCEDURE`和`CREATE FUNCTION`语法*）](http://dev.mysql.com/doc/refman/5.1/en/create-procedure.html)有一个清晰的概述。

下一个问题是：您用于访问 MySQL 数据库的帐户是否具有实际创建过程的适当权限？

可以在此处找到有关此问题的详细信息：[*19.2.2。存储例程和 MySQL 权限*](http://dev.mysql.com/doc/refman/5.1/en/stored-routines-privileges.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-09-08T16:26:50.507

您不能在 PHP 中使用 DELIMITER 语句。所以，

```
1) remove the DELIMITER statements
2)and change all your delimiters to ; 
```

这很烦人，因为现在您必须拥有一个带有 DELIMITERS 的版本，以便在 MySQL 命令行或 MySQL 工具（如 sqlyog 或 MySQL Workbench）中进行开发和测试，以及一个没有 DELIMITERS 的版本才能通过您的 PHP 程序使用。

如果有人知道更好的方法，我想听听 - （但不是通过调用 OS shell 脚本 - 有太多残留问题。）

你需要超级权限。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T12:31:05.357

您对从 PHP 连接的帐户是否有足够的权限？从[手册](http://dev.mysql.com/doc/refman/5.0/en/create-procedure.html)

> 从 MySQL 5.0.3 开始，要执行 CREATE PROCEDURE 或 CREATE FUNCTION 语句，需要具有 CREATE ROUTINE 权限

另请参阅手册中的[存储例程和 MySQL 权限](http://dev.mysql.com/doc/refman/5.0/en/stored-routines-privileges.html)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-05-20T13:35:00.553

替换 mysql_query($query);

到 mysql_unbuffered_query($query,$link_connection);

# c# - 仅使用 XAML 从 WPF 中的父窗口控制 UserControl 的情节提要

> ID：438795
> 
> 赞同：5
> 
> 时间：2009-01-13T12:31:18.900
> 
> 标签：c#, .net, wpf, xaml

我创建了一个非常简单的测试应用程序来尝试解决同事向我描述的这个问题。他能够在 C# 中触发它，但我相信他需要更通用的解决方案，并希望它严格在 XAML 中完成。问题是：如何触发 UserControl 内的 Storyboard 以响应包含窗口中的控件上的事件（父级不必是 Window，它可以是 Page 或另一个 UserControl.. .为了简单起见，我使用一个窗口）。所以，我最好的例子是你有一个带有按钮的窗口和一个用户控件的实例。您希望 Button 的 Click 事件触发 UserControl 内的情节提要开始。

在 UserControl 本身内部，Storyboard 被声明为具有 MyStoryboard 键的 Resource。我创建了一个带有 EventTrigger 的 Button，以表明我可以通过使用 Binding 表达式引用它来触发 Storyboard。这是我的 UserControl 的完整 XAML：

```
<UserControl x:Class="UserControlStoryboard.UserControl1"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
Height="300" Width="300">
<UserControl.Resources>
    <Storyboard x:Key="MyStoryboard">
        <ColorAnimation Storyboard.TargetName="grid" Storyboard.TargetProperty="(Grid.Background).Color" From="CadetBlue" To="White" Duration="0:0:2" />
    </Storyboard>
</UserControl.Resources>
<Grid Background="CadetBlue" x:Name="grid">
    <Button Content="Press Me" Height="50">
        <Button.Triggers>
            <EventTrigger RoutedEvent="Button.Click">
                <BeginStoryboard>
                    <BeginStoryboard.Storyboard>
                        <Binding RelativeSource="{RelativeSource FindAncestor, AncestorType={x:Type UserControl}}" Path="Resources[MyStoryboard]" />
                    </BeginStoryboard.Storyboard>
                </BeginStoryboard>
            </EventTrigger>
        </Button.Triggers>
    </Button>            
</Grid> 
```

我希望，因为我能够通过使用 Binding 表达式引用 Storyboard 来告诉 Storyboard，所以我应该能够从包含此 UserControl 作为子元素的 Window 中执行完全相同的操作。但我似乎无法弄清楚如何在父窗口中获取对故事板的引用。这不可能仅在 XAML 中完成吗？

我的测试项目中的父窗口只有一个按钮和这个 UserControl 的一个实例。如果可能的话，哪个元素可以让我添加一个 EventTrigger，其中事件的源是 Button，并且触发动作告诉 UserControl 的情节提要开始？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-14T19:56:13.223

我认为在 UserControl 中响应外部事件的想法不是很安全。在 UserControl 中，您只想对控件中产生的事件做出反应。

你能扭转局面并执行以下操作： ?

*   将需要动画化的 UC 属性暴露为依赖属性（本例为背景）
*   在父窗口上同时创建 EventTrigger 和 Storyboard

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T17:12:48.847

您可以使用 StaticResource 访问情节提要。您只需将资源分配给 BeginStroyboard 上的 Storyboard。

```
<BeginStoryboard Storyboard="{StaticResource MyStoryboard}">
</BeginStoryboard> 
```

我将代码更改为以下代码，当您按下按钮时，它将为您启动故事板。希望这可以帮助。

```
 <UserControl.Resources>
    <Storyboard x:Key="MyStoryboard">
        <ColorAnimation Storyboard.TargetName="grid" Storyboard.TargetProperty="(Grid.Background).Color" From="CadetBlue" To="White" Duration="0:0:2" />
    </Storyboard>
</UserControl.Resources>
<Grid Background="CadetBlue" x:Name="grid">
    <Button Content="Press Me" Height="50">
        <Button.Triggers>
            <EventTrigger RoutedEvent="Button.Click">
                <BeginStoryboard Storyboard="{StaticResource MyStoryboard}">
                </BeginStoryboard>
            </EventTrigger>
        </Button.Triggers>
    </Button>
</Grid> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-13T21:32:44.017

使用纯 Xaml 可能没有一个好的方法。

你可以：

*   在您的 UserControl 上创建一个带有 Button 的依赖项属性，然后您可以绑定到它。
*   制作某种疯狂的转换器，遍历您的视觉树，寻找特别的东西。

两者都需要一些 C#，所以我不知道以上是否是您正在寻找的。

# wpf - 解释 System.Diagnostics.CodeAnalysis.SuppressMessage

> ID：438803
> 
> 赞同：16
> 
> 时间：2009-01-13T12:34:19.690
> 
> 标签：wpf, tfs, static-analysis

我在某些应用程序中有这种代码（来自微软）

```
[assembly: System.Diagnostics.CodeAnalysis.SuppressMessage(
  "Microsoft.Naming", 
  "CA1702:CompoundWordsShouldBeCasedCorrectly", 
  MessageId = "CounterClockwise", 
  Scope = "member", 
  Target = "ScePhotoViewer.PhotoDisplayControl.#RotatePhotoCounterClockwiseCommand"
)] 
```

*   谁能给我解释一下？
*   有没有博客解释如何使用它，真正的好处......

谢谢乔纳森

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-01-13T12:53:38.277

[Team Foundation Server](http://en.wikipedia.org/wiki/Team_Foundation_Server)的 (TFS) 代码分析功能使用此属性来排除否则会触发警告的代码片段。如果您不使用 TFS 代码分析，则可以安全地删除它们。

属性可以手动添加，或者更常见的是，当在错误列表中选择“抑制消息”选项时，通过 Visual Studio GUI 自动添加属性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-11-16T03:52:07.017

此属性仅在 TFS 进行代码分析期间禁止生成指定的警告消息。不排除任何代码。

# c++ - 用于 C/C++ 的功能/系统测试的测试框架？

> ID：438809
> 
> 赞同：12
> 
> 时间：2009-01-13T12:40:16.120
> 
> 标签：c++, c, testing, system-testing

对于 C++，有很多好的单元测试框架，但是我找不到一个好的[功能测试](http://en.wikipedia.org/wiki/Functional_testing)框架。对于功能测试，我的意思是接触磁盘的东西，需要整个应用程序就位等。

以防万一：什么框架有助于测试您的 I/O 是否有效？我有一个手动系统，它创建临时文件夹，复制一堆数据，所以测试总是在同一个环境中完成，但在我花更多时间在我的自定义框架上之前——有没有好的一个已经在那里了吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T13:33:58.617

我已经从头开始写了 3 次——两次用于测试使用 FIX 协议与交易所通信的 C++ 应用程序，一次用于 GUI 应用程序。

问题是，您需要模拟外界来进行适当的系统测试。我的意思不是“在你的代码之外”——在你的应用程序之外。这涉及模拟最终用户、外部实体、互联网等。

我通常使用 perl 来编写我的系统测试框架和测试，主要是因为它可以很好地访问各种操作系统工具，并且正则表达式是一等公民。

一些提示：确保您的日志易于解析、详细但不太冗长。有一个健全的默认配置。轻松“重置”应用程序 - 您需要在每次测试后执行此操作。

我通常使用的方法是拥有某种“适配器”，将应用程序与外界的通信转换为某些可执行文件的标准输入/标准输出。然后我在此基础上构建了一个 perl 框架，然后测试用例使用该框架。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T13:39:06.593

下面我列出了一些我知道的工具和更大的测试应用程序。如果您提供有关您的平台（操作系统等）的更多信息，我们可能会提供更好的答案。

对于您需要的部分内容，Microsoft 提供了[Application Verifier](http://technet.microsoft.com/en-us/library/bb457063.aspx)：

> 应用程序验证程序 (AppVerifier) 是一种运行时验证工具，用于测试应用程序与 Microsoft Windows XP 的兼容性。此工具可用于在应用程序运行时测试各种已知的兼容性问题。本文详细介绍了使用 AppVerifier 作为应用程序开发和测试周期的有效补充的步骤。

应用程序验证器可用于测试低内存条件、其他低资源和其他 API 使用情况。

难题的另一部分是 Microsoft Detours 包，它可用于用您自己的代码替换 API 调用（例如，为难以设置的测试返回错误代码）。

> Detours 是一个库，用于在 x86、x64 和 IA64 机器上检测任意 Win32 函数。Detours 通过重写目标函数的内存代码来拦截 Win32 函数。Detours 包还包含用于将任意 DLL 和数据段（称为有效负载）附加到任何 Win32 二进制文件的实用程序。

还有其他更大（且更昂贵）的综合软件包可用。Borland 制造[丝绸](http://www.borland.com/us/products/silk/silktest/index.html)。
自动化软件使[TestComplete](http://www.automatedqa.com/products/testcomplete/index.asp)成为可能。选择其中一种工具将取决于您对应用程序的需求。
IBM/Rational 提供了[Rational Functional Tester](http://www-01.ibm.com/software/awdtools/tester/functional/)，它可以跨许多平台使用，并且功能丰富。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-06-25T04:22:32.413

嗨，我不确定我们的框架是否对您的情况有所帮助，但它与 Rational Functional Tester 挂钩，并允许用户创建各种数据集以附加到不同的测试，并在不更改脚本的情况下更改环境，并重用自动化有效的方式。如果您有兴趣，请查看： [http ://www.testpro.com.au/Test-Automation-Framework.html](http://www.testpro.com.au/Test-Automation-Framework.html)

# c# - 这是 string.TrimEnd 中的错误吗？

> ID：438810
> 
> 赞同：3
> 
> 时间：2009-01-13T12:40:23.827
> 
> 标签：c#, string

```
"\u4000\f".TrimEnd(new char[0]) 
```

等于`"\u4000"`。

我正在传递一个空数组，因此根据 MSDN 文档，不应删除任何内容并`"\u4000\f"`应返回。这种行为有原因吗？

编辑：澄清预期行为

编辑：显然，这在 3.5 中发生了变化，我正在查看 2.0 文档页面。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-13T12:50:41.560

文档说“如果 trimChars 为 null（Visual Basic 中为 Nothing）或*空数组*，则会删除空白字符。”
所以不，不是错误。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-13T12:48:24.963

[文档](http://msdn.microsoft.com/en-us/library/system.string.trimend.aspx)很清楚：

> 从当前 String 对象中删除数组中指定的一组字符的所有尾随出现。
> 
> 返回值 类型：System..::.String 从当前 String 对象的末尾删除 trimChars 参数中所有出现的字符后保留的字符串。 **如果 trimChars 为 null（在 Visual Basic 中为 Nothing）或空数组，则会删除空白字符。**

所以你的例子不是错误。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T12:49:34.213

你会期待什么样的行为？

如果要删除尾随 NULL 字符，则应使用

```
"\u4000\f".TrimEnd(new char[1]) 
```

# python - 如何在 Python 中创建类似 PHP 的列表？

> ID：438813
> 
> 赞同：1
> 
> 时间：2009-01-13T12:42:33.620
> 
> 标签：python, list

这是一个非常简单的问题（我是 Python 新手）。

我基本上想要一个像 PHP 数组这样的数据结构——即，我想对其进行初始化，然后将值添加到其中。

据我所知，这在 Python 中是不可能的，所以我得到了我可能想用作索引的最大值，但我不知道如何创建一个指定长度的空列表。

此外，列表是否是正确的数据结构，用于建模感觉它应该只是一个数组？我尝试使用数组，但似乎对存储字符串不满意。

编辑：对不起，我没有很清楚地解释我在找什么。当我将项目添加到列表中时，我不想将它们按顺序放入，而是想将它们插入到列表中的指定插槽中。

即，我希望能够做到这一点：

```
list = []

for row in rows:
  c = list_of_categories.index(row["id"])
  print c
  list[c] = row["name"] 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-13T12:58:42.307

根据您将如何使用该列表，您可能实际上需要一本字典。这将起作用：

```
d = {}

for row in rows:
  c = list_of_categories.index(row["id"])
  print c
  d[c] = row["name"] 
```

...或更紧凑地说：

```
d = dict((list_of_categories.index(row['id']), row['name']) for row in rows)
print d 
```

PHP 数组更像 Python 字典，而不是 Python 列表。例如，它们可以有字符串作为键。

令人困惑的是，Python 有一个数组模块，它被描述为“有效的数值数组”，这绝对不是你想要的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-13T12:50:56.347

如果您想要的项目数量是预先知道的，并且您想使用整数、基于 0 的连续索引来访问它们，您可以尝试以下操作：

```
n = 3
array = n * [None]
print array
array[2] = 11
array[1] = 47
array[0] = 42
print array 
```

这打印：

```
[None, None, None]
[42, 47, 11] 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T12:46:11.413

使用列表构造函数，并附加您的项目，如下所示：

```
l = list ()
l.append ("foo")
l.append (3)
print (l) 
```

给我`['foo', 3]`，这应该是你想要的。请参阅[列表文档](http://docs.python.org/library/functions.html?highlight=list#list)和[序列类型文档](http://docs.python.org/library/stdtypes.html#typesseq)。

**编辑**更新

对于插入，使用`insert`，如下所示：

```
l = list ()
l.append ("foo")
l.append (3)
l.insert (1, "new")
print (l) 
```

哪个打印`['foo', 'new', 3]`

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-13T12:47:45.653

[http://diveintopython3.ep.io/native-datatypes.html#lists](http://diveintopython3.ep.io/native-datatypes.html#lists)

您不需要创建具有指定长度的空列表。您只需添加它们并在需要时查询它们的当前长度。

如果不准备捕获异常，您不能做的是使用不存在的索引。这可能是您在 PHP 中所习惯的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-13T12:47:16.590

您可以使用此语法创建包含`n`元素的列表：

```
lst = [0] * n 
```

不过要小心！该列表将包含`n`该对象的副本。如果这个对象是可变的并且你改变了一个元素，那么所有的副本都会被改变！在这种情况下，您应该使用：

```
lst = [some_object() for i in xrange(n)] 
```

然后您可以访问这些元素：

```
for i in xrange(n):
    lst[i] += 1 
```

Python 列表类似于其他语言中的向量。它是一个可调整大小的数组，而不是一个链表。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-13T13:00:51.990

如果您想插入指定的索引，听起来您需要的可能是**字典而不是数组。**

```
dict = {'a': 1, 'b': 2, 'c': 3}
dict['a'] 
```

> > 1

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-13T13:05:58.347

我同意 ned 的观点，即您可能需要一本字典来说明您正在尝试做的事情。但这是一种获取这些类别列表列表的方法，您可以这样做：

```
lst = [list_of_categories.index(row["id"]) for row in rows] 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-13T13:30:47.500

使用字典，因为您真正需要的是可以通过任意键访问的结构

```
list = {}

for row in rows:
  c = list_of_categories.index(row["id"])
  print c
  list[c] = row["name"] 
```

然后，您可以使用以下命令遍历已知内容：

```
for x in list.values():
  print x 
```

或者检查“列表”中是否存在某些内容：

```
if 3 in list: 
  print "it's there" 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-13T13:46:33.757

我不确定我是否理解您的意思或想要做什么，但似乎您想要一个类似于字典的列表，其中索引是键。即使我认为，使用字典会是一个更好的选择，这就是我的答案：遇到问题 - 制作一个对象：

```
class MyList(UserList.UserList):

NO_ITEM = 'noitem'

def insertAt(self, item, index):

    length = len(self)
    if index < length:
        self[index] = item
    elif index == length:
        self.append(item)
    else:
        for i in range(0, index-length):
            self.append(self.NO_ITEM)
        self.append(item) 
```

也许python语法中有一些错误（没有检查），但原则上它应该可以工作。当然 else 案例也适用于 elif，但我想，这样阅读可能会有点困难。

# css - 什么是'？在 Css 链接中做什么？

> ID：438821
> 
> 赞同：46
> 
> 时间：2009-01-13T12:45:57.840
> 
> 标签：css

我正在浏览我最喜欢的网站的 html ......嗯......我在标记中看到了这个：

```
<link href="/Content/all.min.css?d=20090107" rel="stylesheet" type="text/css" /> 
```

"?d=20090107" 是做什么的？我假设这是某种日期，但我不确定为什么它在文件的路径中。有任何想法吗？

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2009-01-13T12:47:35.403

那是为了给文件名添加一些唯一性，这样当他们更改 CSS 文件时，他们可以更改额外的位以完全确保每个客户端都会重新加载 CSS 而不是使用缓存版本。

网络服务器将忽略该参数并正常服务 /Content/all.min.css

注意：虽然CSS*可能*是动态生成的，但这是确保重新加载的常见习惯用法，并且鉴于参数是日期，这似乎很有可能。

* * *

编辑：[播客 38](https://blog.stackoverflow.com/2009/01/podcast-38/)提到了这个......

> 自推出以来，我们一直在使用 Expires 或 Cache-Control Header。当获取不经常更改的项目（例如图像、javascript 或 css）时，这可以节省浏览器的往返次数。缺点是，当您真正更改这些文件时，您必须记住更改文件名。*我们构建过程的一部分现在用版本号“标记”这些文件，因此我们不再需要记住手动执行此操作。*

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2010-06-12T11:10:50.330

每次更新样式时都要“清除缓存”。我推测，每当有变化时，负责这些样式的人都会增加它。这是因为浏览器在样式字段中看到了不同的 URL，所以它会抓取最新版本，即使它在技术上位于服务器上的同一位置。

正如评论中有用地指出的那样，css 文件的到期时间通常设置在将来，这种方法是缓存相关标头的一个很好的回避措施。

很实用的把戏。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-06-12T11:13:35.313

这是为了让浏览器每次刷新缓存时都认为它是一个新文件。

当您的样式表定期更改时非常有用...

# windows - 如何访问由桌面搜索引擎（如 Windows Search 或 Copernic Desktop Search）生成的文件的关键字

> ID：438823
> 
> 赞同：1
> 
> 时间：2009-01-13T12:46:04.517
> 
> 标签：windows, indexing, tags, search-engine, keyword

我正在尝试在我部门的公共文件共享上订购文件，其中包含数千个各种文件类型的文档。我的想法是按内容相关的关键字对它们进行排序。只有少数文件包含 Windows 提供的关键字文件属性中的有效信息。我的想法是让一些桌面搜索引擎索引文件（及其内容），然后使用索引中生成的关键字。

问题是我不知道如何从搜索索引中读取这些生成的关键字。

Microsoft 和 Copernic 似乎都没有提供有关如何访问其索引文件的任何信息。MSDN 仅提供有关如何直接从您的程序中查询 Windows 搜索引擎的信息，但结果仅包含 Windows 文件属性和文件信息，而不包含那些生成的用于索引的关键字。哥白尼似乎根本没有提供任何信息。

我非常感谢有关如何访问这些生成的关键字的任何想法。先感谢您！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T12:59:44.020

如果可以选择 Google 桌面搜索，您可以使用[Google 桌面搜索 API](http://code.google.com/apis/desktop/docs/searchapi.html)。一个更需要编程的选项是使用[Lucene](http://lucene.apache.org/)。中间的某个地方是[nutch](http://wiki.apache.org/nutch/)。

# .net - 为潜台词文章添加虚荣网址

> ID：438835
> 
> 赞同：0
> 
> 时间：2009-01-13T12:48:41.797
> 
> 标签：.net, url, subtext

所以我在 IIS6 和 .net 2.0 框架上运行 subtext 1.95。我想做的是为在潜文本系统中发布的特定文章创建一个漂亮的虚荣 URL。虚 url 应该是这样的：mydomain.com/blog/toc/，但它指向的潜台词实际上有这样的路径：mydomain.com/blog/archive/2009/01/11/table-of -contents.aspx

我可能可以在 IIS 中设置一个转发来执行此操作，但我正在寻找一种更优雅的解决方案，它不需要任何类似的自定义 IIS 配置。我还想避免更改任何潜台词核心代码，以便为自己留下升级路径。

将 default.aspx 文件放在 /toc/ 文件夹中并将该页面转发到长路径是最好的解决方案吗？

提前致谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-01-15T06:25:43.520

**请注意，这适用于 Subtext 2.1.2 及以下版本**

URL 匹配在 Web.config 中处理。您可以搜索如下所示的行：

```
<HttpHandler pattern="(?:/archive/\d{4}/\d{2}/\d{2}/[-_,+\.\w]+\.aspx)$" controls="viewpost.ascx,Comments.ascx,PostComment.ascx"/> 
```

并在那里更改正则表达式。不幸的是，Subtext 将继续生成旧链接。在即将发布的 Subtext 2.5 中，情况略有改善。

另一个问题是，对于 IIS 6，除非 /toc/ 目录物理存在，否则 IIS 不会将请求移交给 ASP.NET，因此您需要使用通配符映射才能真正实现该工作。

现在，我认为您可能需要通过 IIS 中的某种 URL 重写 isapi 过滤器来实现您想要的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-20T14:04:21.097

感谢菲尔的信息。

我最终只创建了一个 /toc/ 文件夹，并拥有一个重定向到博客文章的 default.aspx 文件。这可能是最简单的解决方案，并且只花了我一分钟的时间来实施。

# eclipse - eclipse发现资源未编译

> ID：438839
> 
> 赞同：2
> 
> 时间：2009-01-13T12:50:13.353
> 
> 标签：eclipse, dialog, find

当我在**Eclipse**中单击`Ctrl`++`Shift`时，会出现一个对话框，允许我查找资源。但是，它会显示所有资源，无论它们是未编译还是未编译。有什么方法可以过滤，所以它只显示未编译的资源？或者我可以以某种方式隐藏已编译的资源吗？`R`

 *** * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T13:09:04.643

在您执行以下操作时隐藏已编译的资源：

*   打开（`Ctrl`++ `Shift`）`R`“打开资源对话框”，
*   点击右上角的黑色三角形，
*   然后在“**显示派生资源**”上：必须**取消选中**。

您将看不到任何`.class`文件。

来自：[eclipse3.3有什么新东西](http://help.eclipse.org/help33/index.jsp?topic=/org.eclipse.platform.doc.user/whatsNew/platform_whatsnew.html)

![替代文字](https://i.stack.imgur.com/zDEQn.png)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T12:52:55.440

如果您只想搜索 Java 类，那么我建议使用 Ctrl-Shift-T。

~~对于其他类型的资源，我不确定您是否可以过滤此弹出窗口的结果...~~ 请参阅 VonC 的回答

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T08:09:49.007

作为对 VonC 解决方案的附加说明，只要类包含在与源文件不同的目录树中，它就可以工作 - 例如，许多项目将类文件构建到目标目录中，该目录反映了 src 树的目录结构。

在大多数情况下，Eclipse 会在这个目标目录上设置派生标志（右键单击目标并查看属性）——尽管一些 Eclipse 插件（Maven/SVN）似乎有时会错误地得到这个派生标志（不确定哪个是罪魁祸首） .

# python - Python中有标签/转到吗？

> ID：438844
> 
> 赞同：240
> 
> 时间：2009-01-13T12:53:23.393
> 
> 标签：python, goto

Python 中是否有一个`goto`或任何等效项能够跳转到特定的代码行？

* * *

## 回答 #1

> 赞同：157
> 
> 时间：2009-01-13T12:55:57.930

不，Python 不支持标签和 goto。它是一种（高度）结构化的编程语言。

* * *

## 回答 #2

> 赞同：100
> 
> 时间：2009-01-13T13:04:56.727

Python 为您提供了使用一流函数执行 goto 可以执行的一些操作的能力。例如：

```
void somefunc(int a)
{
    if (a == 1)
        goto label1;
    if (a == 2)
        goto label2;

    label1:
        ...
    label2:
        ...
} 
```

可以像这样在python中完成：

```
def func1():
    ...

def func2():
    ...

funcmap = {1 : func1, 2 : func2}

def somefunc(a):
    funcmap[a]()  #Ugly!  But it works. 
```

当然，这不是替代 goto 的最佳方式。但是，如果不确切知道你想用 goto 做什么，很难给出具体的建议。

@[阿斯科博尔](https://stackoverflow.com/questions/438844/is-there-a-label-in-python#438866)：

您最好的选择是将其包含在函数中或使用异常。对于功能：

```
def loopfunc():
    while 1:
        while 1:
            if condition:
                return 
```

对于例外：

```
try:
    while 1:
        while 1:
            raise BreakoutException #Not a real exception, invent your own
except BreakoutException:
    pass 
```

如果你来自另一种编程语言，使用异常来做这样的事情可能会有点尴尬。但我会争辩说，如果你不喜欢使用异常，Python 不适合你。:-)

* * *

## 回答 #3

> 赞同：92
> 
> 时间：2015-09-20T20:15:04.517

我最近写了一个在 Python中启用[的函数装饰器](https://github.com/snoack/python-goto)`goto`，就像这样：

```
from goto import with_goto

@with_goto
def range(start, stop):
    i = start
    result = []

    label .begin
    if i == stop:
        goto .end

    result.append(i)
    i += 1
    goto .begin

    label .end
    return result 
```

我不确定为什么有人想做这样的事情。也就是说，我对此并不太认真。但我想指出，这种元编程实际上在 Python 中是可能的，至少在 CPython 和 PyPy 中是可能的，而不仅仅是像[其他人](http://entrian.com/goto/)那样滥用调试器 API。不过，您必须弄乱字节码。

* * *

## 回答 #4

> 赞同：47
> 
> 时间：2017-01-20T16:40:03.950

我在[官方的 python 设计和历史常见问题解答](https://docs.python.org/3/faq/design.html#why-is-there-no-goto)中找到了这个。

> 为什么没有goto？
> 
> 您可以使用异常来提供甚至可以跨函数调用工作的“结构化 goto”。许多人认为异常可以方便地模拟 C、Fortran 和其他语言的“go”或“goto”结构的所有合理使用。例如：

```
class label(Exception): pass  # declare a label

try:
    ...
    if condition: raise label()  # goto label
    ...
except label:  # where to goto
    pass
... 
```

> 这不允许您跳到循环的中间，但这通常被认为是对 goto 的滥用。谨慎使用。

很高兴官方FAQ中甚至提到了这一点，并提供了一个很好的解决方案示例。我真的很喜欢 python，因为它的社区正在`goto`这样对待；）

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2009-01-17T17:42:56.797

要使用评论中的建议回答[`@ascobol`' 的问题：](https://stackoverflow.com/questions/438844/is-there-a-label-in-python#438866)`@bobince`

```
for i in range(5000):
    for j in range(3000):
        if should_terminate_the_loop:
           break
    else: 
        continue # no break encountered
    break 
```

块的缩进`else`是正确的。`else`该代码在循环 Python 语法之后使用了 obscure 。请参阅[为什么 python 在 for 和 while 循环之后使用“else”？](https://stackoverflow.com/q/9979970/4279)

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2015-05-21T11:57:10.013

已经制作了一个工作版本：http: [//entrian.com/goto/](http://entrian.com/goto/)。

注意：它是作为愚人节的玩笑提供的。（虽然工作）

```
# Example 1: Breaking out from a deeply nested loop:
from goto import goto, label

for i in range(1, 10):
    for j in range(1, 20):
        for k in range(1, 30):
            print i, j, k
            if k == 3:
                goto .end
label .end
print "Finished\n" 
```

不用说。是的，它很有趣，但不要使用它。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2015-05-05T10:36:10.190

通过一些工作向 python 添加类似“goto”的语句在技术上是可行的。我们将使用“dis”和“new”模块，它们对于扫描和修改python字节码都非常有用。

实现背后的主要思想是首先将代码块标记为使用“goto”和“label”语句。将使用一个特殊的“@goto”装饰器来标记“goto”函数。之后，我们扫描这两个语句的代码，并对底层字节码进行必要的修改。这一切都发生在源代码编译时。

```
import dis, new

def goto(fn):
    """
    A function decorator to add the goto command for a function.

        Specify labels like so:
        label .foo

        Goto labels like so:
        goto .foo

        Note: you can write a goto statement before the correspnding label statement
    """
    labels = {}
    gotos = {}
    globalName = None
    index = 0
    end = len(fn.func_code.co_code)
    i = 0

    # scan through the byte codes to find the labels and gotos
    while i < end:
        op = ord(fn.func_code.co_code[i])
        i += 1
        name = dis.opname[op]

        if op > dis.HAVE_ARGUMENT:
            b1 = ord(fn.func_code.co_code[i])
            b2 = ord(fn.func_code.co_code[i+1])
            num = b2 * 256 + b1

            if name == 'LOAD_GLOBAL':
                globalName = fn.func_code.co_names[num]
                index = i - 1
                i += 2
                continue

            if name == 'LOAD_ATTR':
                if globalName == 'label':
                    labels[fn.func_code.co_names[num]] = index
                elif globalName == 'goto':
                    gotos[fn.func_code.co_names[num]] = index

            name = None
            i += 2

    # no-op the labels
    ilist = list(fn.func_code.co_code)
    for label,index in labels.items():
        ilist[index:index+7] = [chr(dis.opmap['NOP'])]*7

    # change gotos to jumps
    for label,index in gotos.items():
        if label not in labels:
            raise Exception("Missing label: %s"%label)

        target = labels[label] + 7   # skip NOPs
        ilist[index] = chr(dis.opmap['JUMP_ABSOLUTE'])
        ilist[index + 1] = chr(target & 255)
        ilist[index + 2] = chr(target >> 8)

    # create new function from existing function
    c = fn.func_code
    newcode = new.code(c.co_argcount,
                       c.co_nlocals,
                       c.co_stacksize,
                       c.co_flags,
                       ''.join(ilist),
                       c.co_consts,
                       c.co_names,
                       c.co_varnames,
                       c.co_filename,
                       c.co_name,
                       c.co_firstlineno,
                       c.co_lnotab)
    newfn = new.function(newcode,fn.func_globals)
    return newfn

if __name__ == '__main__':

    @goto
    def test1():
        print 'Hello' 

        goto .the_end
        print 'world'

        label .the_end
        print 'the end'

    test1() 
```

希望这能回答这个问题。

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2019-08-01T17:09:28.890

## 蟒蛇 2 & 3

```
pip3 install goto-statement 
```

> 在 Python 2.6 到 3.6 和 PyPy 上进行了测试。

链接：[goto语句](https://pypi.org/project/goto-statement/)

* * *

foo.py

```
from goto import with_goto

@with_goto
def bar():

    label .bar_begin

    ...

    goto .bar_begin 
```

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2012-03-26T22:03:09.047

[早在 2007 年PEP 3136](http://www.python.org/dev/peps/pep-3136/)中就提出了`break`和的标签，但被拒绝了。提案的[动机](http://www.python.org/dev/peps/pep-3136/#motivation)部分说明了几种常见的（如果不优雅）模仿Python 中标记的方法。`continue``break`

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2015-03-27T16:07:25.853

您可以使用[用户定义的异常](https://docs.python.org/2/tutorial/errors.html#user-defined-exceptions)来模拟`goto`

例子：

```
class goto1(Exception):
    pass   
class goto2(Exception):
    pass   
class goto3(Exception):
    pass   

def loop():
    print 'start'
    num = input()
    try:
        if num<=0:
            raise goto1
        elif num<=2:
            raise goto2
        elif num<=4:
            raise goto3
        elif num<=6:
            raise goto1
        else:
            print 'end'
            return 0
    except goto1 as e:
        print 'goto1'
        loop()
    except goto2 as e:
        print 'goto2'
        loop()
    except goto3 as e:
        print 'goto3'
        loop() 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2019-12-15T18:13:51.070

尽管没有任何与`goto/label`Python 等效的代码，但您仍然可以获得`goto/label`使用循环的这种功能。

让我们以下面显示的代码示例为例，其中`goto/label`可以在除 python 之外的任意语言中使用。

```
String str1 = 'BACK'

label1:
    print('Hello, this program contains goto code\n')
    print('Now type BACK if you want the program to go back to the above line of code. Or press the ENTER key if you want the program to continue with further lines of code')
    str1 = input()

if str1 == 'BACK'
    {
        GoTo label1
    }
print('Program will continue\nBla bla bla...\nBla bla bla...\nBla bla bla...') 
```

现在可以通过使用`while`循环在 python 中实现上述代码示例的相同功能，如下所示。

```
str1 = 'BACK'

while str1 == 'BACK':
        print('Hello, this is a python program containing python equivalent code for goto code\n')
        print('Now type BACK if you want the program to go back to the above line of code. Or press the ENTER key if you want the program to continue with further lines of code')
        str1 = input()
print('Program will continue\nBla bla bla...\nBla bla bla...\nBla bla bla...') 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2016-07-07T06:23:05.480

我一直在寻找类似的东西

```
for a in xrange(1,10):
A_LOOP
    for b in xrange(1,5):
        for c in xrange(1,5):
            for d in xrange(1,5):
                # do some stuff
                if(condition(e)):
                    goto B_LOOP; 
```

所以我的方法是使用布尔值来帮助摆脱嵌套的 for 循环：

```
for a in xrange(1,10):
    get_out = False
    for b in xrange(1,5):
        if(get_out): break
        for c in xrange(1,5):
            if(get_out): break
            for d in xrange(1,5):
                # do some stuff
                if(condition(e)):
                    get_out = True
                    break 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2021-05-27T17:12:49.443

您可以使用 python 中的嵌套方法来实现它

```
def func1():
    print("inside func1")
    def inline():
        print("im inside")

    inline()

func1() 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2015-09-22T06:33:52.677

现在有。[去](https://github.com/snoack/python-goto)

我认为这可能对您正在寻找的内容有用。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2019-01-26T14:17:14.660

In lieu of a python goto equivalent I use the break statement in the following fashion for quick tests of my code. This assumes you have structured code base. The test variable is initialized at the start of your function and I just move the "If test: break" block to the end of the nested if-then block or loop I want to test, modifying the return variable at the end of the code to reflect the block or loop variable I'm testing.

```
def x:
  test = True
  If y:
     # some code
     If test:
            break
  return something 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2015-07-30T14:28:19.640

我想要相同的答案，但我不想使用`goto`. 所以我使用了以下示例（来自 learnpythonthehardway）

```
def sample():
    print "This room is full of gold how much do you want?"
    choice = raw_input("> ")
    how_much = int(choice)
    if "0" in choice or "1" in choice:
        check(how_much)
    else:
        print "Enter a number with 0 or 1"
        sample()

def check(n):
    if n < 150:
        print "You are not greedy, you win"
        exit(0)
    else:
        print "You are nuts!"
        exit(0) 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2018-06-02T18:23:07.820

对于前向 Goto，您只需添加：

```
while True:
  if some condition:
    break
  #... extra code
  break # force code to exit. Needed at end of while loop
#... continues here 
```

不过，这只对简单的场景有帮助（即嵌套这些会让你一团糟）

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2021-10-20T15:11:14.430

在实现“goto”时，首先要问什么是goto。虽然看起来很明显，但大多数人并没有考虑 goto 与函数堆栈的关系。

如果在函数内部执行“goto”，实际上就是放弃了函数调用堆栈。这被认为是不好的做法，因为函数堆栈的设计期望您在委派中间任务后从中断的地方继续。这就是为什么goto用于异常，异常可以用来模拟goto，我会解释。

有限状态机可能是 goto 的最佳用例，大多数情况下它是通过循环和 switch 语句以笨拙的方式实现的，但我相信“顶级” goto 是实现有限状态的最干净、最语义化的方式机器。在这种情况下，您要确保，如果您有更多变量，它们是全局变量，并且不需要封装。确保首先对变量状态空间进行建模（可能与执行状态不同，即有限状态机）。

我相信使用 goto 有合理的设计理由，异常处理是一种特殊情况，将 goto 与函数混合是有意义的。但是，在大多数情况下，您希望将自己限制为“顶级” goto，因此您永远不会在函数内调用 goto，而只能在全局范围内调用。

在现代语言中模拟顶级 goto 的最简单方法是实现顶级 goto，只需要全局变量和空调用堆栈。因此，为了保持调用堆栈为空，每次调用新函数时都会返回。这是打印前 n 个斐波那契数的示例：

```
a = 0
b = 1
n = 100
def A():
    global a, b
    a = a + b
    n -= 1
    print(a)
    return B() if n > 0 else 0
def B():
    global a, b
    b = a + b
    n -= 1
    print(b)
    return A() if n > 0 else 0
A() 
```

虽然这个例子可能比循环实现更冗长，但它也更加强大和灵活，并且不需要特殊情况。它让您拥有一个完整的有限状态机。您也可以使用 goto 运行器对其进行修改。

```
def goto(target):
    while(target) target = target()
def A():
    global a, b
    a = a + b
    print(a)
    return B
def B():
    global a, b
    b = a + b
    print(b)
    return A
goto(A) 
```

要强制执行“返回”部分，您可以编写一个 goto 函数，该函数在完成时简单地引发异常。

```
def goto(target):
    target()
    throw ArgumentError("goto finished.")
def A():
    global a, b
    a = a + b
    print(a)
    goto(B)
def B()
    global a, b
    b = a + b
    print(b)
    goto(A)
goto(A) 
```

所以你看，很多这都是过度思考，而一个调用函数然后抛出错误的辅助函数就是你所需要的。您可以进一步将其包装在“开始”函数中，以便捕获错误，但我认为这不是绝对必要的。虽然其中一些实现可能会用完您的调用堆栈，但第一个运行器示例将其保持为空，并且如果编译器可以进行尾调用优化，那也会有所帮助。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2019-01-31T09:43:31.700

**没有实现 goto 语句的替代方法**

```
class id:
     def data1(self):
        name=[]
        age=[]   
        n=1
        while n>0:
            print("1\. for enter data")
            print("2\. update list")
            print("3\. show data")
            print("choose what you want to do ?")
            ch=int(input("enter your choice"))
            if ch==1:    
                n=int(input("how many elemet you want to enter="))
                for i in range(n):
                    name.append(input("NAME "))
                    age.append(int(input("age "))) 
            elif ch==2:
                name.append(input("NAME "))
                age.append(int(input("age ")))
            elif ch==3:
                try:
                    if name==None:
                        print("empty list")
                    else:
                        print("name \t age")
                        for i in range(n):
                            print(name[i]," \t ",age[i])
                        break
                except:
                    print("list is empty")
            print("do want to continue y or n")
            ch1=input()
            if ch1=="y":
                n=n+1
            else:
                print("name \t age")
                for i in range(n):
                    print(name[i]," \t ",age[i])
                n=-1
p1=id()
p1.data1() 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2018-02-18T00:58:11.423

我有自己的 goto 方式。我使用单独的 python 脚本。

如果我想循环：

**文件1.py**

```
print("test test")
execfile("file2.py")
a = a + 1 
```

**文件2.py**

```
print(a)
if a == 10:
   execfile("file3.py")
else:
   execfile("file1.py") 
```

**文件3.py**

```
print(a + " equals 10") 
```

（**注意：**此技术仅适用于 Python 2.x 版本）

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2020-11-27T21:20:40.390

我认为while循环是“goto_Statement”的替代品。因为在 3.6 之后 goto 循环不再工作了。我还写了一个while循环的例子。

```
str1 = "stop"
while str1 == "back":
    var1 = int(input(" Enter Ist Number: "))
    var2 = int(input(" Enter 2nd Number: "))
    var3 = print("""  What is your next operation
                      For Addition   Press And Enter : 'A'
                      For Muliplt    Press And Enter : 'M'
                      For Division   Press And Enter : 'D'
                      For Subtaction Press And Enter : 'S' """)

    var4 = str(input("For operation press any number : "))
    if(var1 == 45) and (var2 == 3):
        print("555")
    elif(var1 == 56) and (var2 == 9):
        print("77")
    elif(var1 == 56) and (var2 == 6):
        print("4")
    else:
        if(var4 == "A" or "a"):
            print(var1 + var2)
        if(var4 == "M" or "m"):
            print(var1 * var2)
        if(var4 == "D" or "d"):
            print(var1 / var2)
        if(var4 == "S" or "s"):
            print(var1 - var2)

    print("if you want to continue then type  'stop'")

    str1 = input()
print("Strt again") 
```

# eclipse - eclipse中的自定义tld函数验证

> ID：438851
> 
> 赞同：1
> 
> 时间：2009-01-13T12:57:17.163
> 
> 标签：eclipse, validation, jsp, el, tld

我在 eclipse (Ganymede 3.4.1) 中工作并创建了一个 ctl TLD：

```
<?xml version="1.0" encoding="UTF-8"?>
<taglib version="2.0" xmlns="http://java.sun.com/xml/ns/j2ee"
 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-jsptaglibrary_2_0.xsd">
 <tlib-version>2.0</tlib-version>
 <short-name>Name</short-name>
 <function>
  <name>readExtendedField</name>
  <function-class>uk.newsint.advertising.wsconnection.ConnectionManager</function-class>
  <function-signature>
    java.lang.String readExtendedField( uk.newsint.advertising.aws.ExtendedFields , java.lang.String )
    </function-signature>
 </function>
</taglib> 
```

并在我的jsp（摘录）中引用了它：

```
<%@ taglib uri="/WEB-INF/appUtils.tld" prefix="au"%>
<c:forEach items="${myAdsForm.result.resultList}" var="lin">
    <tr>
      <td>${au:readExtendedField(lin,"EXTRDATE")}</td>
    </tr>
</c:forEach> 
```

Eclipse 在 this section${au:readExtendedField(lin,"EXTRDATE")} 上给我一个 EL Sytax 错误，并将其分配给第一个引号和右括号 {" 和 )}。

该表达式在 tomcat 下工作正常，但是当我尝试提交到存储库时 eclipse 会警告我，当然会在问题选项卡中显示错误。

有没有其他人遭受过这种情况，有人有解决办法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-23T21:28:53.020

您现在可能已经找到了答案，但如果您还没有找到答案（并启发其他任何遇到此页面的人，但您的自定义标签应该被视为标签，而不仅仅是另一个标签正文中的元素。它应该是`<au:.../>`

# javascript - 为什么 jQuery $('.classname') 不能在 IE 中工作？

> ID：438853
> 
> 赞同：0
> 
> 时间：2009-01-13T12:58:07.723
> 
> 标签：javascript, jquery

使用有效的 HTML，以下内容会在所有浏览器中按预期找到对象，但在 IE（6 和 7）中会变为 NULL。

```
$(document).ready(function() {
    alert( '$(.rollover):\n' + $('.rollover'));
}); 
```

我尝试将其切换为更简单的东西，例如 $('a') 但我总是在 IE 中得到 NULL。

**更新：** 通过 W3C 验证器运行页面后（并忽略我的 Firefox 验证器插件告诉我的内容），实际上似乎存在很多验证错误（即使定义了 HTML 4 过渡），我无法轻易修复，所以我的猜测是这就是我的问题的原因。尝试在 IE 中按预期工作非常简单的文档。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T15:26:12.167

似乎是 AjaxCFC 的 JavaScript 包含导致了问题，更具体地说，ajaxCFC util.js 似乎定义了它自己的 $。

在 JQuery 库之前移动这些包含修复了我遇到的上述问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T15:36:46.607

如果您遇到 $ 冲突，有很多方法可以避免这种情况，如此[处所述](http://docs.jquery.com/Using_jQuery_with_Other_Libraries)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T13:08:29.823

我认为我们必须查看 HTML。我从来没有遇到过 jQuery/IE 中的类选择问题。您应该`[object Object]`在警报中获取 jQuery 对象。另外，您使用的是旧版本的 jQuery 吗？

# c - 虚拟分配粒度和页面大小

> ID：438863
> 
> 赞同：7
> 
> 时间：2009-01-13T13:03:02.250
> 
> 标签：c, windows, winapi, win64

Win64平台上虚拟分配粒度和页面大小的典型值是多少？那就是 SYSTEM_INFO 的 dwAllocationGranularity 和 dwPageSize。

在 Win32 系统上，这些将是 64k 和 4k。

我需要知道，因为我已经为 Win32 应用程序设计了一个基于 VirtualAlloc 的自定义分配器，并且想知道我的设计选择在 Win64 上是否仍然有效。我无法访问 Win64 系统。

提前致谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-13T13:59:24.150

在 Vista x64 上仍然是 64k 和 4k。不确定这是否有一天会改变，小页面大小给 TLB 缓存带来了严重压力，大大降低了分配数 GB 块的程序的性能。我还看到了一些关于在程序执行期间无法再分配大页面的问题报告。但这只是现在的水晶球。

# asp.net-mvc - ASP.NET MVC 应用程序控制器构造函数问题

> ID：438870
> 
> 赞同：3
> 
> 时间：2009-01-13T13:05:20.623
> 
> 标签：asp.net-mvc

我创建了一个应用程序控制器抽象类，我的控制器从该类派生（如下[文所述](http://www.asp.net/Learn/mvc/tutorial-13-cs.aspx)）

以下是我的代码的示例

```
public abstract class ApplicationController : Controller
{
    private ProjectDataContext datacontext = new ProjectDataContext();

    protected ProjectDataContext DataContext
    {
        get { return datacontext; }
    }

    public ApplicationController()
    {
        ViewData["OpenTasks"] = DataContext.Tasks.Where(t => t.UserId == this.UserId).Count();
    }
} 
```

这会产生以下错误，我确定这是由于“Where” lamda 表达式：

***如果控制器没有控制器工厂，请确保它具有无参数的公共构造函数。***

无论我以何种方式编写 LINQ 查询，都会产生此错误，编译应用程序的唯一方法是删除“Where”子句，如下所示。

```
ViewData["OpenTasks"] = DataContext.Tasks.Count(); 
```

任何想法是什么问题或如何解决这个问题，因为我需要对用户执行查询而不返回所有条目。

提前致谢

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-13T13:22:44.927

试试这个而不是使用构造函数： -

```
public abstract class ApplicationController : Controller
{
    private ProjectDataContext datacontext = new ProjectDataContext();

    protected ProjectDataContext DataContext
    {
        get { return datacontext; }
    }

    protected override void Initialize(System.Web.Routing.RequestContext requestContext)
    {
        base.Initialize(RequestContext);
        ViewData["OpenTasks"] = DataContext.Tasks.Where(t => t.UserId == this.UserId).Count();
    }
} 
```

当前用户 ID 很可能依赖于 RequestContext

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T13:19:55.807

可能是调用在构造函数中崩溃，因为 UserId (this.UserId) 尚未初始化。

# text - 文档、文本格式

> ID：438872
> 
> 赞同：1
> 
> 时间：2009-01-13T13:05:30.220
> 
> 标签：text, format, document

对于我的项目，我需要多种类型文档的文档编辑器（表格数据、发票、信件、一些公式，...），我正在寻找文本格式和编辑器来完成我的任务

*   有一些类似 MS Word 的格式吗？
*   我知道例如 rtf，我需要格式化，不可见的评论会很好
*   开放格式
*   同样的第 3 页。编辑会很好

我找到了一些解决方案，rtf是最常见的

请问您有相同的建议或个人经验吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-13T13:21:02.747

检查 ODF（开放文档格式），了解可以处理文本、电子表格和许多其他内容的免费开放文档格式。

参考[维基百科](http://en.wikipedia.org/wiki/OpenDocument)。

[OpenOffice](http://openoffice.org/)是支持 ODF 的众多产品之一。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T13:21:35.693

您在寻找文本格式还是文本编辑器？我猜这是文本格式...

许多存在（除了您已经提到的 RTF），例如：

*   HTML
*   特克斯/乳胶
*   诺夫/特罗夫
*   后记

许多（或多或少）所见即所得的编辑器可用于前两个。

# java - 在 Java 中序列化对象时出现 StackOverflowError

> ID：438875
> 
> 赞同：10
> 
> 时间：2009-01-13T13:07:30.573
> 
> 标签：java, swing, serialization, stack-overflow

我正在使用 Swing 用 Ja​​va 编写应用程序。我正在尝试实现在我正在运行的模拟中保存和加载模拟状态的功能。整个模拟被保存为一个对象，与 Swing 断开连接。我正在尝试使用以下代码序列化我的 Simulation 类：

```
public void saveSimulationState(String simulationFile) {
    try {
        Serializable object = this.sm;
        ObjectOutputStream objstream = new ObjectOutputStream(new FileOutputStream(simulationFile));
        objstream.writeObject(object);
        objstream.close();
    } catch (IOException e) {
        System.out.println(e.getMessage());
    }
} 
```

但我收到以下错误（它很大）。

```
Exception in thread "AWT-EventQueue-0" java.lang.StackOverflowError
        at java.io.ObjectStreamClass.processQueue(ObjectStreamClass.java:2234)
        at java.io.ObjectStreamClass.lookup(ObjectStreamClass.java:266)
        at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1106)
        at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1509)
        at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1474)
        at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1392)
        at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1150)
        at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:326)
        at java.util.ArrayList.writeObject(ArrayList.java:570)
        at sun.reflect.GeneratedMethodAccessor6.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:945)
        at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1461)
        at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1392)
        at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1150)
        at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1509)
        at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1474)
        at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1392)
        at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1150)
        at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:326)
        at java.util.ArrayList.writeObject(ArrayList.java:570)
        at sun.reflect.GeneratedMethodAccessor6.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:945)
        at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1461)
        at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1392)
        at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1150)
        at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1509)
        at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1474)
        at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1392)
        at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1150)
        at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:326)
        at java.util.ArrayList.writeObject(ArrayList.java:570)
        at sun.reflect.GeneratedMethodAccessor6.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:945)
        at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1461)
        at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1392)
        at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1150)
        at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1509)
        at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1474)
        at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1392)
        at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1150)
        at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:326)
        at java.util.ArrayList.writeObject(ArrayList.java:570)
        at sun.reflect.GeneratedMethodAccessor6.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:945)
        at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1461)
        at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1392)
        at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1150)
        at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1509)
        at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1474)
        at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1392)
        at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1150)
        at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:326)
        at java.util.ArrayList.writeObject(ArrayList.java:570)
        at sun.reflect.GeneratedMethodAccessor6.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:945)
        at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1461)
        at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1392)
        at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1150)
        at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1509)
        at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1474)
        at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1392)
        at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1150)
        at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:326)
        at java.util.ArrayList.writeObject(ArrayList.java:570)
        at sun.reflect.GeneratedMethodAccessor6.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:945)
        at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1461)
        at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1392)
        at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1150)
        at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1509)
        at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1474)
        at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1392)
        at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1150)
        at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:326)
        at java.util.ArrayList.writeObject(ArrayList.java:570)
        at sun.reflect.GeneratedMethodAccessor6.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:945)
        at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1461)
        at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1392)
        at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1150)
        at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1509)
        at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1474)
        at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1392)
        at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1150)
        at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:326)
        at java.util.ArrayList.writeObject(ArrayList.java:570)
        at sun.reflect.GeneratedMethodAccessor6.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:945)
        at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1461) 
```

谁能告诉我是什么导致了这个异常？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-13T13:53:45.037

陈的有趣帖子：

[调试堆栈溢出时，您希望专注于重复递归部分](https://web.archive.org/web/20140424233104/http://blogs.msdn.com/b/oldnewthing/archive/2009/01/07/9286576.aspx)

在你的情况下：

```
 at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1392)
        at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1150)
        at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1509)
        at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1474)
        at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1392)
        at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1150)
        at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:326)
        at java.util.ArrayList.writeObject(ArrayList.java:570)
        at sun.reflect.GeneratedMethodAccessor6.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:945)
        at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1461) 
```

> 如果您通过缺陷跟踪数据库寻找这是否是一个已知问题，则搜索堆栈中的顶级函数不太可能找到任何有趣的东西。这是因为堆栈溢出往往发生在递归中的随机点。每个堆栈溢出看起来都与其他堆栈溢出表面上不同，即使它们是相同的堆栈溢出。

> 一旦你克服了最初的混乱，堆栈跟踪就会变成一个很好的重复模式，由相同的 x 函数一遍又一遍地组成。
> 识别重复模式的开始并不重要，因为每次碰撞的起点都会不同，就像超出你的歌唱范围的精确音符会随着碰撞而变化。

> 一旦您确定了重复部分，请从中选择一个有些不寻常的功能，然后在[您的缺陷数据库](http://www.google.com/search?q=java.lang.StackOverflowError++ObjectOutputStream+defaultWriteFields)中搜索它。

[例如](http://www.coderanch.com/t/277328/IO-Streams/javalangStackOverflowError-during-Serialization)，默认`ArrayList`序列化。

在这里，您[`GrahPanel`](http://code.google.com/p/sensor-protocol-simulation/source/browse/trunk/src/protokolsimulering/view/GraphPanel.java?r=20)指的[`Simulation`](http://code.google.com/p/sensor-protocol-simulation/source/browse/trunk/src/protokolsimulering/model/Simulation.java?r=20)是指的是，传感器和边缘[`Graph`](http://code.google.com/p/sensor-protocol-simulation/source/browse/trunk/src/protokolsimulering/model/Graph.java?r=20)可能很长......`ArrayList`

> Java 序列化记录每个写入流的对象。如果第二次遇到相同的对象，则只会将对其的引用写入流，而不是对象的第二个副本；所以循环引用不是这里的问题。

> 但是对于某些类型的结构，序列化容易受到堆栈溢出的影响；例如，**没有特殊 writeObject() 方法的长链表将通过递归写入每个链接来序列化。如果您有 100,000 个链接，您将尝试使用 100,000 个堆栈帧，并且很可能会因 StackOverflowError 失败**。

> 可以为这样的列表类定义 writeObject() 方法，当第一个链接被序列化时，只需遍历列表并迭代地序列化每个链接；这将阻止使用默认的递归机制。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T13:27:16.650

您应该考虑重新实现 Simulation 类的`writeObject`/`readObject`方法，以便仅序列化相关数据（而不是默认情况下包含的整个对象结构）或标记瞬态您不被序列化的对象。如果需要，您也可以使用该`Externalizable`界面。

顺便说一句，您可能想先阅读这篇[有趣的文章](http://java.sun.com/developer/technicalArticles/Programming/serialization/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T13:14:48.483

您有一些深度嵌套的 ArrayList。

我想也许它只是先进入深度，这意味着它会进入底部传感器，它太深了。

也许您可以使用从底部传感器开始的传感器创建自定义结构？

或者，也许您必须提供自己的序列化来处理它？[http://java.sun.com/developer/technicalArticles/Programming/serialization/](http://java.sun.com/developer/technicalArticles/Programming/serialization/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T13:18:44.967

您应该为要存储的对象创建一个容器类。我不会存储包含所有逻辑的完整这个对象。

逐个字段存储第一个字段以找到以这种方式存储它的元素。然后在方法中放置一个断点并查看字段元素。元素是否包含相互链接的链接？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T13:46:49.183

在您完成所有操作后，如果您只想保存到文件，请使用 XStream。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-01-19T03:44:05.877

这段代码应该作为一个模型，因为它解决了序列化时 stackoverflow 的问题。它使用内存代替递归。虽然不适合被认为是通用的序列化程序，但它会序列化和反序列化它所测试的类。

```
import java.io.*;
import java.util.*;
import java.lang.reflect.*;
import android.util.*;

public class SequentialObjectInputStream extends DataInputStream implements ObjectInput
{
    interface FieldPutAction
    {
        void put(Object obj, Field field) throws IllegalAccessException, IOException;
    }

    interface ArrayPutAction
    {
        void put(Object obj, int index) throws ArrayIndexOutOfBoundsException, IOException;
    }

    public HashMap<Class, FieldPutAction> Primatives;
    public HashMap<Class, ArrayPutAction> ArrayPrimatives;

    public SequentialObjectInputStream(InputStream stream)
    {
        super(stream);

        Primatives = new HashMap<Class, FieldPutAction>();

        try
        {
            Primatives.put(boolean.class,
                new FieldPutAction()
                {
                    public void put(Object obj, Field field) throws IllegalAccessException, IOException 
                    {
                        boolean x = readBoolean(); 
                        field.setBoolean(obj, x);

                    }
                });

            Primatives.put(byte.class,
                new FieldPutAction()
                {
                    public void put(Object obj, Field field) throws IllegalAccessException, IOException 
                    {
                        byte x = readByte(); 
                        field.setByte(obj, x);

                    }
                });

            Primatives.put(short.class,
                new FieldPutAction()
                {
                    public void put(Object obj, Field field) throws IllegalAccessException, IOException 
                    {
                        short x = readShort(); 
                        field.setShort(obj, x);

                    }
                });

            Primatives.put(int.class,
                new FieldPutAction()
                {
                    public void put(Object obj, Field field) throws IllegalAccessException, IOException 
                    {
                        int x = readInt(); 
                        field.setInt(obj, x);

                    }
                });

            Primatives.put(long.class,
                new FieldPutAction()
                {
                    public void put(Object obj, Field field) throws IllegalAccessException, IOException 
                    {
                        long x = readLong(); 
                        field.setLong(obj, x);

                    }
                });

            Primatives.put(char.class,
                new FieldPutAction()
                {
                    public void put(Object obj, Field field) throws IllegalAccessException, IOException 
                    {
                        char x = readChar(); 
                        field.setChar(obj, x);

                    }
                });

            Primatives.put(float.class,
                new FieldPutAction()
                {
                    public void put(Object obj, Field field) throws IllegalAccessException, IOException 
                    {
                        float x = readFloat(); 
                        field.setFloat(obj, x);

                    }
                });

            Primatives.put(double.class,
                new FieldPutAction()
                {
                    public void put(Object obj, Field field) throws IllegalAccessException, IOException 
                    {
                        double x = readDouble(); 
                        field.setDouble(obj, x);

                    }
                });

            Primatives.put(String.class,
                new FieldPutAction()
                {
                    public void put(Object obj, Field field) throws IllegalAccessException, IOException 
                    {
                        String x = readUTF(); 
                        field.set(obj, x);

                    }
                });
        } catch(Exception e)
        {
            Log.e("SOb", Log.getStackTraceString(e));
        }

        ArrayPrimatives = new HashMap<Class, ArrayPutAction>();

        try
        {
            ArrayPrimatives.put(boolean.class,
                new ArrayPutAction()
                {
                    public void put(Object obj, int index) throws ArrayIndexOutOfBoundsException, IOException   
                    {
                        boolean x = readBoolean();
                        Array.setBoolean(obj, index, x);
                    }
                });

            ArrayPrimatives.put(byte.class,
                new ArrayPutAction()
                {
                    public void put(Object obj, int index) throws ArrayIndexOutOfBoundsException, IOException   
                    {
                        byte x = readByte(); 
                        Array.setByte(obj, index, x);

                    }
                });

            ArrayPrimatives.put(short.class,
                new ArrayPutAction()
                {
                    public void put(Object obj, int index) throws ArrayIndexOutOfBoundsException, IOException   
                    {
                        short x = readShort(); 
                        Array.setShort(obj, index, x);

                    }
                });

            ArrayPrimatives.put(int.class,
                new ArrayPutAction()
                {
                    public void put(Object obj, int index) throws ArrayIndexOutOfBoundsException, IOException   
                    {
                        int x = readInt(); 
                        Array.setInt(obj, index, x);

                    }
                });

            ArrayPrimatives.put(long.class,
                new ArrayPutAction()
                {
                    public void put(Object obj, int index) throws ArrayIndexOutOfBoundsException, IOException   
                    {
                        long x = readLong(); 
                        Array.setLong(obj, index, x);

                    }
                });

            ArrayPrimatives.put(char.class,
                new ArrayPutAction()
                {
                    public void put(Object obj, int index) throws ArrayIndexOutOfBoundsException, IOException   
                    {
                        char x = readChar(); 
                        Array.setChar(obj, index, x);

                    }
                });

            ArrayPrimatives.put(float.class,
                new ArrayPutAction()
                {
                    public void put(Object obj, int index) throws ArrayIndexOutOfBoundsException, IOException   
                    {
                        float x = readFloat(); 
                        Array.setFloat(obj, index, x);

                    }
                });

            ArrayPrimatives.put(double.class,
                new ArrayPutAction()
                {
                    public void put(Object obj, int index) throws ArrayIndexOutOfBoundsException, IOException   
                    {
                        double x = readDouble(); 
                        Array.setDouble(obj, index, x);

                    }
                });

            ArrayPrimatives.put(String.class,
                new ArrayPutAction()
                {
                    public void put(Object obj, int index) throws ArrayIndexOutOfBoundsException, IOException   
                    {
                        String x = readUTF(); 
                        Array.set(obj, index, x);

                    }
                });
        } catch(Exception e)
        {
            Log.e("SOb", Log.getStackTraceString(e));
        }
    }

    @Override
    public Object readObject() throws ClassNotFoundException, IOException
    {
        long Total = readLong();

        Log.i("SOb", "readObject : " + Long.toString(Total) + " objects in graph");

        HashMap<Long, Object> References = new HashMap<Long, Object>();

        long currentId = 1;

        HashMap<Object, HashMap<Field, Long>> refCache =
            new HashMap<Object, HashMap<Field, Long>>();
        final HashMap<Object, HashMap<Integer, Long>> arefCache =
            new HashMap<Object, HashMap<Integer,Long>>();

        for (int I=0; I < Total; I++)
        {
            String Name = readUTF();
            Class C = Class.forName(Name);

            Log.i("SOb", "Object of "+C.getCanonicalName() +" on graph");

            int adim = 0;

            Object O = null;

            if (C.isArray())
            {
                Class ComponentType = C.getComponentType();

                int Size = readInt();

                Log.i("SOb", "array of "+ComponentType.getCanonicalName() + ", " + Long.toString(Size) + " elements");          
                O = Array.newInstance(ComponentType, Size);

                References.put(currentId, O);
                currentId++;

                ArrayPutAction action = null;

                if (ArrayPrimatives.keySet().contains(ComponentType))
                {
                    action = ArrayPrimatives.get(ComponentType);
                } else
                {
                    arefCache.put(O, new HashMap<Integer, Long>());

                    action = new ArrayPutAction()
                    {
                        public void put(Object O, int Index) throws ArrayIndexOutOfBoundsException , IOException
                        {
                            long Ref = readLong();

                            arefCache.get(O).put(Index, Ref);
                        }
                    };
                }

                for (int index=0; index< Size; index++)
                {
                    action.put(O,index);
                }

            } else
            {

            try
            {

                O = 
                    C.getConstructor(new Class[0]).newInstance(new Object[0]);
            } catch(InstantiationException e)
            {
                Log.e("SOb", Log.getStackTraceString(e));
            } catch(NoSuchMethodException e)
            {
                Log.e("SOb", Log.getStackTraceString(e));
            } catch(IllegalAccessException e)
            {
                Log.e("SOb", Log.getStackTraceString(e));
            } catch(InvocationTargetException e)
            {
                Log.e("SOb", Log.getStackTraceString(e));
            }

            References.put(currentId, O);
            currentId++;
            refCache.put(O, new HashMap<Field, Long>());

            for (Field F : C.getFields())
            {
                if (F.isAccessible())
                {
                    Class T = F.getType();

                    if (Primatives.containsKey(T))
                    {
                        try
                        {
                            Primatives.get(T).put(O, F);
                        } catch (IllegalAccessException e)
                        {

                        }
                    } else
                    {
                        refCache.get(O).put(F, readLong());
                    }
                }
            }

        }
        }
        for (long I=0; I < Total; I++)
        {

            Object O = References.get(I+1);

            Class C = O.getClass();

            //Log.i("SOb", "get reference "+Long.toString(I)+" "+C.getCanonicalName());

            if (C.isArray())
            {
                HashMap<Integer,Long> aref_table = arefCache.get(O);

                if (ArrayPrimatives.containsKey(C.getComponentType()) == false)
                {

                    int len = Array.getLength(O);

                    for (int index=0; index<len; index++)
                    {
                        long r = aref_table.get(index);
                        Object ref = r == 0 ? null : References.get(r);

                        Array.set(O, index, ref);   
                    }
                }

            } else
            {

            HashMap<Field, Long> ref_table = refCache.get(O);

            for (Field F : C.getFields())
            {
                if (F.isAccessible())
                {
                    Class T = F.getType();

                    if (Primatives.containsKey(T) == false)
                    {
                        try
                        {
                            long r = ref_table.get(F);
                            Object ref = r == 0 ? null : References.get(r);

                            F.set(O, ref);
                        } catch (IllegalAccessException e)
                        {
                            Log.e("SOb", Log.getStackTraceString(e));
                        }

                    }
                }
            }
            }

        }

        return References.get((Long) (long) 1);
    }

}

import java.io.*;
import java.util.*;
import java.lang.reflect.*;
import android.util.*;

public class SequentialObjectOutputStream extends DataOutputStream
implements ObjectOutput
{
    interface FieldGetAction
    {
        void get(Object obj, Field field) throws IllegalAccessException, IOException;
    }

    interface ArrayGetAction
    {
        void get(Object array, int Index) throws ArrayIndexOutOfBoundsException, IOException;       
    }

    public HashMap<Class, FieldGetAction> Primatives;
    public HashMap<Class, ArrayGetAction> ArrayPrimatives;

    public SequentialObjectOutputStream(OutputStream stream)
    {
        super(stream);

        Primatives = new HashMap<Class, FieldGetAction>();

        try
        {
            Primatives.put(boolean.class,
            new FieldGetAction()
            {
                public void get(Object obj, Field field) throws IllegalAccessException, IOException 
                {
                    boolean x = field.getBoolean(obj);
                    writeBoolean(x);

                }
            });

            Primatives.put(byte.class,
                new FieldGetAction()
                {
                    public void get(Object obj, Field field) throws IllegalAccessException, IOException 
                    {
                        byte x = field.getByte(obj);
                        writeByte(x);

                    }
                });

            Primatives.put(short.class,
                new FieldGetAction()
                {
                    public void get(Object obj, Field field) throws IllegalAccessException, IOException 
                    {
                        short x = field.getShort(obj);
                        writeShort(x);

                    }
                });

            Primatives.put(int.class,
                new FieldGetAction()
                {
                    public void get(Object obj, Field field) throws IllegalAccessException, IOException 
                    {
                        int x = field.getInt(obj);
                        writeInt(x);

                    }
                });

            Primatives.put(long.class,
                new FieldGetAction()
                {
                    public void get(Object obj, Field field) throws IllegalAccessException, IOException 
                    {
                        long x = field.getLong(obj);
                        writeLong(x);

                    }
                });

            Primatives.put(char.class,
                new FieldGetAction()
                {
                    public void get(Object obj, Field field) throws IllegalAccessException, IOException 
                    {
                        char x = field.getChar(obj);
                        writeChar(x);

                    }
                });

            Primatives.put(float.class,
                new FieldGetAction()
                {
                    public void get(Object obj, Field field) throws IllegalAccessException, IOException 
                    {
                        float x = field.getFloat(obj);
                        writeFloat(x);

                    }
                });

            Primatives.put(double.class,
                new FieldGetAction()
                {
                    public void get(Object obj, Field field) throws IllegalAccessException, IOException 
                    {
                        double x = field.getDouble(obj);
                        writeDouble(x);
                    }
                });

            Primatives.put(String.class,
                new FieldGetAction()
                {
                    public void get(Object obj, Field field) throws IllegalAccessException, IOException 
                    {
                        String x = (String) field.get(obj);
                        writeUTF(x);

                    }
                });
        } catch(Exception e)
        {
            Log.e("SOb", Log.getStackTraceString(e));
        }

        ArrayPrimatives = new HashMap<Class, ArrayGetAction>();

        try
        {
            ArrayPrimatives.put(boolean.class,
                new ArrayGetAction()
                {
                    public void get(Object obj, int index) throws ArrayIndexOutOfBoundsException, IOException   
                    {
                        boolean x = Array.getBoolean(obj, index);
                        writeBoolean(x);

                    }
                });

            ArrayPrimatives.put(byte.class,
                new ArrayGetAction()
                {
                    public void get(Object obj, int index) throws ArrayIndexOutOfBoundsException, IOException   
                    {
                        byte x = Array.getByte(obj, index);
                        writeByte(x);

                    }
                });

            ArrayPrimatives.put(short.class,
                new ArrayGetAction()
                {
                    public void get(Object obj, int index) throws ArrayIndexOutOfBoundsException, IOException   
                    {
                        short x = Array.getShort(obj, index);
                        writeShort(x);

                    }
                });

            ArrayPrimatives.put(int.class,
                new ArrayGetAction()
                {
                    public void get(Object obj, int index) throws ArrayIndexOutOfBoundsException, IOException   
                    {
                        int x = Array.getInt(obj, index);
                        writeInt(x);

                    }
                });

            ArrayPrimatives.put(long.class,
                new ArrayGetAction()
                {
                    public void get(Object obj, int index) throws ArrayIndexOutOfBoundsException, IOException   
                    {
                        long x = Array.getLong(obj, index);
                        writeLong(x);

                    }
                });

            ArrayPrimatives.put(char.class,
                new ArrayGetAction()
                {
                    public void get(Object obj, int index) throws ArrayIndexOutOfBoundsException, IOException   
                    {
                        char x = Array.getChar(obj, index);
                        writeChar(x);

                    }
                });

            ArrayPrimatives.put(float.class,
                new ArrayGetAction()
                {
                    public void get(Object obj, int index) throws ArrayIndexOutOfBoundsException, IOException   
                    {
                        float x = Array.getFloat(obj, index);
                        writeFloat(x);

                    }
                });

            ArrayPrimatives.put(double.class,
                new ArrayGetAction()
                {
                    public void get(Object obj, int index) throws ArrayIndexOutOfBoundsException, IOException   
                    {
                        double x = Array.getDouble(obj, index);
                        writeDouble(x);
                    }
                });

            ArrayPrimatives.put(String.class,
                new ArrayGetAction()
                {
                    public void get(Object obj, int index) throws ArrayIndexOutOfBoundsException, IOException   
                    {
                        String x = (String) Array.get(obj, index);
                        writeUTF(x);

                    }
                });
        } catch(Exception e)
        {
            Log.e("SOb", Log.getStackTraceString(e));
        }

    }

    class State
    {
        public ArrayList<Object> OStack = new ArrayList<Object>();

        public long currentId = 1;

        public HashMap<Object, Long> References = new HashMap<Object, Long>();

    }

    public void writeObject(Object A) throws IOException, NotSerializableException
    {
        final State state = new State();

        state.OStack.add(0, A);

        LinkedList<Object> ForStack = new LinkedList<Object>();

        while (!(state.OStack.size() == 0))
        {
            Object Current = state.OStack.get(0);
            state.OStack.remove(0);

            if (((Serializable) Current) == null)
            {
                throw new NotSerializableException();
            }

            //Type C = Current.getClass();

            Class C = Current.getClass();

            Log.i("SOb", "placing #"+Long.toString(state.currentId)+" of "+C.getCanonicalName()+" on graph"); 
            state.References.put(Current, state.currentId);
            state.currentId++;

            ForStack.add(Current);

            if (C.isArray())
            {
                //Array array = (Array) Current;
                Class Ctype = C.getComponentType();

                if (ArrayPrimatives.keySet().contains(Ctype) == false)
                {
                    for (int I=0; I<Array.getLength(Current); I++)
                    {
                        Object o = Array.get(Current, I);

                        if ((o != null) && (state.References.keySet().contains(o) == false))
                        {
                            if (state.OStack.contains(o) == false) state.OStack.add(state.OStack.size(), o);
                        }

                    }
                }
            } else
            {
                for (Class Cur = C; Cur != null; Cur = Cur.getSuperclass())
                {

                    Field[] fields = Cur.getDeclaredFields();

                    for (Field f : fields)
                    {
                        if (Modifier.isStatic(f.getModifiers()))
                        {
                            continue;
                        }

                        f.setAccessible(true);

                        if (f.isAccessible() == false)
                        {
                        //  Log.i("SOb", "     isAccessible = false");
                            continue;
                        }

                        Class type = f.getType();
                        //Log.i("SOb", "     field \""+f.getName()+"\" of "+type.getCanonicalName());

                        if (Primatives.keySet().contains(type) == false)
                        {       
                            try
                            {
                                Object o = f.get(Current);

                                if ((o != null) && (state.References.keySet().contains(o) == false))
                                {
                                    if (state.OStack.contains(o) == false) state.OStack.add(state.OStack.size(), o);
                                }

                            } catch (IllegalAccessException e)
                            {
                                Log.e("SOb", Log.getStackTraceString(e));
                            }
                        }
                    }
                }
            }
        }

        writeLong(state.References.size());

        for (Object O : ForStack )
        {
            Serializable s = (Serializable) O;

        //  if (s != null)
            {
                Class cl = O.getClass();

                String name = cl.getName();

                writeUTF(name);

                if (cl.isArray())
                {
                    Class components = cl.getComponentType();

                    ArrayGetAction action;

                    //Array array = (Array) O;

                    if (ArrayPrimatives.keySet().contains(components))
                    {
                        action = ArrayPrimatives.get(components);
                    } else
                    {
                        action = new ArrayGetAction()
                        {
                            public void get(Object array, int index) throws ArrayIndexOutOfBoundsException, IOException     
                            {
                                Object O = Array.get(array, index);
                                if (O==null)  writeLong(0);
                                else writeLong(state.References.get(O));
                            }
                        };
                    }

                    int length = Array.getLength(O);

                    writeInt(length);

                    for (int I=0; I<length; I++)
                    {
                        action.get(O, I);
                    }

                } else
                {
                    for (Class Cur = cl; Cur != null; Cur = Cur.getSuperclass())
                    {
                        Field[] fields = Cur.getDeclaredFields();

                        for (Field F : fields)
                        {
                            Class FieldType = F.getType();

                            F.setAccessible(true);

                            if (F.isAccessible() && (Modifier.isStatic(FieldType.getModifiers())))
                            {
                                FieldGetAction action;

                                //Array array = (Array) O;

                                if (Primatives.keySet().contains(FieldType))
                                {
                                    action = Primatives.get(FieldType);
                                } else
                                {
                                    action = new FieldGetAction()
                                    {
                                        public void get(Object obj, Field index) throws IllegalAccessException, IOException     
                                        {
                                            Object O = index.get(obj);
                                            if (O==null)  writeLong(0);
                                            else writeLong(state.References.get(O));
                                        }
                                    };
                                }

                                try
                                {
                                    action.get(O, F);
                                } catch (IllegalAccessException e)
                                {
                                    Log.e("SOb", Log.getStackTraceString(e));
                                }

                            }
                        }

                    }
                }
            }   
        }
    }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-04-10T15:53:10.147

我有一个类似的问题。经过多次狩猎，我发现了一个 Kryo 的叉子，用于处理深度嵌套的对象。通过[https://github.com/EsotericSoftware/kryo/issues/103](https://github.com/EsotericSoftware/kryo/issues/103)，克隆和`mvn clean install` [https://github.com/romix/kryo/tree/kryo-2.23-continuations](https://github.com/romix/kryo/tree/kryo-2.23-continuations)。目前是`com.esotericsoftware.kryo:kryo:2.23-SNAPSHOT`.

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-01-13T13:46:58.420

使用更大的堆栈运行 java

# vb.net - 如何在不打开的情况下创建 Excel 文件的副本

> ID：438877
> 
> 赞同：1
> 
> 时间：2009-01-13T13:08:12.710
> 
> 标签：vb.net, excel

创建 Excel 文件副本而不使用[VB.NET](http://en.wikipedia.org/wiki/Visual_Basic_.NET)打开它的命令是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T13:09:04.080

文件.复制

[http://msdn.microsoft.com/en-us/library/system.io.file.copy(VS.71).aspx](http://msdn.microsoft.com/en-us/library/system.io.file.copy(VS.71).aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-13T13:17:15.327

让我们保持以 VB 为中心：`My.Computer.FileSystem.CopyFile()`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T22:35:25.843

复制方法中的参数“真”表示覆盖任何现有文件，这样它就不会被炸毁。

```
Imports System.IO
Module Module1
    Sub Main()
        Dim originalFile As String = "c:\work\myExcelFile.xls"
        Dim copyOfOriginalFile As String = "c:\work\myExcelFileCopy.xls"

        If File.Exists(originalFile) Then
            System.IO.File.Copy(originalFile, copyOfOriginalFile, True) 
        Else
            Console.WriteLine("{0} does not exist", originalFile)
        End If
    End Sub
End Module 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-03-15T03:19:06.230

```
If System.IO.File.Exists("Directory1" & "File.xlsx") Then
   My.Computer.File.System.CopyFile("Directory1" & "File.xlsx", 
                                     "Directory2" & "File.xlsx", True)
End If 
```

# javascript - 有没有办法在不使用服务器端语言的情况下对 HTML 页面进行密码保护？

> ID：438886
> 
> 赞同：3
> 
> 时间：2009-01-13T13:11:06.883
> 
> 标签：javascript, html, client, passwords

我有一系列相互关联的网页，我想通过要求用户提供登录名和密码来限制对这些网页的访问。但是，我的托管帐户目前不提供任何服务器端脚本功能 - 有什么方法可以仅使用客户端脚本来实现此目标？

我想知道以下程序是如何工作的 -

[http://www.myzips.com/software/HTML-Password.phtml](http://www.myzips.com/software/HTML-Password.phtml)

澄清：感谢您的投入。但是，如果我正在配置 Web 服务器，那么用户是否有可能输入用户名和密码？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-13T13:12:52.810

无法创建安全的客户端脚本。如果用户可以访问它，那么它是不安全的。

如果您的主机正在运行 apache，您可以使用 .htaccess 保护文件夹，在 IIS 上，您可以通过目录安全性来做同样的事情。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2015-06-23T21:15:12.850

下面是一个使用加密的**工作解决方案**，我自己实现了。

这里的一些用户建议使用基于加密的方法来保护客户端密码。我也需要这个功能，所以我自己实现了。密码使用 PBKDF2 进行哈希处理，然后用于使用 AES256 加密页面。

该工具托管在这里：

[https://www.maxlaumeister.com/pagecrypt/](https://www.maxlaumeister.com/pagecrypt/)

此处提供源代码：

[https://github.com/MaxLaumeister/pagecrypt](https://github.com/MaxLaumeister/pagecrypt)

* * *

项目描述，来自项目页面：

> **PageCrypt - 密码保护 HTML**
> 
> 此工具可让您安全地使用密码保护 HTML 文件。与其他密码保护工具不同，此工具：
> 
> 1.  没有服务器端组件（此工具及其受密码保护的页面完全在 javascript 中运行）。
>     
>     
> 2.  使用强加密，因此无法绕过密码保护。
>     
>     
> 
> 您需要做的就是选择一个 HTML 文件和一个密码，您的页面将受到密码保护。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-13T13:17:16.793

您可以使用以下内容创建文件 .htaccess ：

```
AuthUserFile path/to/password.txt
AuthGroupFile /dev/null
AuthName "Acces Restreint"
AuthType Basic
<Limit GET POST>
require valid-user
</Limit> 
```

然后您必须创建 .htpasswd 文件。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-13T13:59:13.310

可以实现这一点，尽管您可能会发现简单地切换到不同的托管服务提供商会更容易。这是可能的：

首先，使用对称加密算法和随机密钥（主密钥）对整个主体进行加密。将此密文作为文本存储在 javascript 块中。

对于您的所有用户，生成一个 javascript 哈希，将他们的用户名映射到主密钥的加密副本（使用每个用户密钥加密）。

最后，创建一个要求输入用户名和密码的网页。输入后，使用用户名查找加密的主密钥。使用用户输入的密码对其进行解密，并使用生成的主密钥解锁原始正文。使用 javascript 将现有的 html 正文替换为解密的正文。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T13:15:37.313

我不了解客户端脚本，但您可以使用 Web 服务器来限制对您网站的访问。
在 IIS 中可以使用“目录安全”选项卡设置：[配置 IIS 网站身份验证](http://support.microsoft.com/kb/324274)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-13T13:23:02.507

如果每个人只有一个密码，您可以尝试使用公钥类型的方法。您可以提供一个简单的脚本来执行 RSA 解密（您需要在可以访问某种编程软件的地方进行原始加密）。然后，您可以将内容作为加密字符串提供。你会显示一个密码框，用户输入密码，然后字符串将根据密码解密。如果密码正确，字符串将正确解密，并显示页面。否则，页面看起来就像一堆垃圾。不过要小心，因为这种客户端方法很容易受到暴力破解。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-13T13:27:21.220

当然，如果安全不是什么大问题。本质上，您将设置一扇门，上面写着“如果您不知道密码，请不要进来”。任何不使用服务器端技术的东西都可能使用 JavaScript，以及受保护目录中的文件来存储密码。然而，这不是密码保护。可以禁用 JavaScript，这将导致页面加载。毫无疑问，这将通过隐藏内容来解决……但内容仍然可以通过源查看。还有其他几种方法，但如果您有真正值得用密码保护的内容，这不是一个好方法。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-13T13:35:39.470

是的，这是可能的，但它不是很漂亮，甚至不是很好。

*   您的索引页面有一个空的 div，您的受限内容将放在其中。
*   在页面加载或单击链接时，提示 (window.prompt) 会要求您输入密码。
*   您的密码经过哈希处理，并与脚本中正确密码的存储哈希（或哈希数组）进行比较。
*   如果您有匹配项，则通过 AJAX 将内容加载到 div
*   您可以将密码存储在 cookie 中，这样每次都不会提示（不是很安全，但这不是一个非常安全的系统）

*   您仍然不是那么安全，因为您将要加载的页面的文件名将在您的脚本中可见，但它可能会阻止非常随意的冲浪者。
*   您可能会混淆 url，从而需要一些 JavaScript 知识才能查看。例如 rot13

您将需要一个[JavaScript 哈希脚本](http://www.webtoolkit.info/javascript-md5.html)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-13T13:42:41.423

或者您可以使用一个神秘的 html 文件名作为密码，并在 / 浏览到该页面（如果存在）中使用 ajax :-)

与其他建议一样安全（或不安全），但可能更容易实施。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-13T13:45:21.060

为此，您不需要公钥 - 事实上，公钥解密仅限于在实践中加密其他对称密钥和证书，因为它的计算非常昂贵。你只需要一个共享的秘密。

使用从密码短语派生的密钥（通过散列）使用 AES（例如）加密网页。然后，您必须将密码短语安全地传达给用户并编写一些 javascript 来下载加密内容、提示输入密码短语、解密数据并将其合并到 DOM 中。

这一切都相当混乱且非常脆弱 - 所有用户只有一个密码，一旦它被泄露，你必须更换服务器上的东西，并希望谷歌没有缓存它......建议你转向真正的 ISP

至于你提到的 HTML 密码程序，没有办法知道它不是蛇油或坏掉的......“使用强大算法的最佳安全性”这句话并不完全令人鼓舞！

# asp.net - 在我使用 VS 2005 中的“发布网站”功能之前，是否需要在我的 ASP.NET Web 应用程序中设置 debug="false"？

> ID：438889
> 
> 赞同：3
> 
> 时间：2009-01-13T13:12:10.720
> 
> 标签：asp.net

基本上，我想知道是否需要在点击“发布网站”按钮之前设置 debug="false" 或者是否可以在所有文件发布后切换它。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T13:14:52.227

您不必关闭该设置，但是，您需要在将网站作为生产应用程序运行之前设置 debug="false"。它将对您网站的性能产生深远的影响。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T13:26:55.230

至于 Ryan 写的内容 - 请参阅[生产中的调试代码](http://aspnetresources.com/articles/debug_code_in_production.aspx)。
您可能想要使用的另一个选项是[retail="true"](http://msdn.microsoft.com/en-us/library/system.web.configuration.deploymentsection.retail(VS.80).aspx)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T13:42:51.843

您可以在发布/预编译时将其设置为 true，但是一旦处于生产状态，强烈建议您将值设置为 false，[原因由 Scott Guthrie（他管理 ASP.NET 团队）本人在此处概述](http://weblogs.asp.net/scottgu/archive/2006/04/11/442448.aspx).

斯科特帖子的亮点：

这样做会导致一些非最佳的事情发生，包括：

1) ASP.NET 页面的编译耗时较长（因为禁用了一些批量优化）

2) 代码执行速度可能较慢（因为启用了一些额外的调试路径）

3) 运行时在应用程序中使用更多内存

4) 从 WebResources.axd 处理程序下载的脚本和图像不会被缓存

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T13:22:58.793

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T13:34:16.947

很不幸的是，不行。您可以将选项设置为 true 来发布它，尽管您当然不应该（如果页面正在投入生产）。我最初将应用程序发布到测试环境，并将其设置为“true”，在测试环境中将其设置为 false，并且在投入生产时绝对设置为 false。

但是您的站点将在调试设置为 true 的情况下构建并发布到您将其发送到的任何环境。据我了解，有相当多的网站以这种方式在生产中。Dror 发布了一个很好的链接，指向保留此选项所带来的问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-20T06:29:27.707

我希望这会增加一些价值。我一直在学习很多关于 msbuild 的知识，它是一个多么令人难以置信的工具！

如果您要将网站发布到生产环境，则可能有一些您希望自动化的步骤。如果您想使用批处理文件而不是 Visual Studio 界面进行发布，或者将其包含在您的构建脚本中，则在您成功编译后，以下内容将发布您的网站。

```
msbuild <yourProjectFile>.csproj 
    /target:"ResolveReferences;_CopyWebApplication"
    /properties:"debug=false;
                 retail=true;
                 WebProjectOutputDir = <YourCorrectOutputDir>;
                 OutDir = <YourCorrectOutputDir>\bin\" 
```

我们花时间在相当广泛的构建脚本上进行投资，甚至在我们完成构建和发布站点后对站点运行一些基本的 http 获取请求，这已经减少了大量的挫败感。

我坚信尽可能实现自动化，机器似乎不会像我一样经常忘记做事：D

希望它可以帮助干杯Rihan

# python - 在 Python 中引发异常时如何停止程序？

> ID：438894
> 
> 赞同：72
> 
> 时间：2009-01-13T13:13:24.273
> 
> 标签：python, exception-handling

当 Python 中出现异常时，我需要停止我的程序。我该如何实施？

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2009-01-13T13:16:02.897

```
import sys

try:
  print("stuff")
except:
  sys.exit(1) # exiing with a non zero value is better for returning from an error 
```

* * *

## 回答 #2

> 赞同：61
> 
> 时间：2009-01-13T14:33:53.737

您可以停止捕获异常，或者 - 如果您需要捕获它（进行一些自定义处理），您可以重新引发：

```
try:
  doSomeEvilThing()
except Exception, e:
  handleException(e)
  raise 
```

请注意，在`raise`不传递异常对象的情况下键入会导致原始回溯被保留。通常它比`raise e`.

当然——你也可以显式调用

```
import sys 
sys.exit(exitCodeYouFindAppropriate) 
```

这会引发 SystemExit 异常，并且（除非您在某处捕获它）使用指定的退出代码终止您的应用程序。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-01-13T19:52:52.550

如果您不处理异常，它会将调用堆栈向上传播到解释器，然后解释器将显示回溯并退出。IOW：发生异常时，您无需执行*任何操作即可使脚本退出。*

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-11-18T22:36:25.213

```
import sys

try:
    import feedparser
except:
    print "Error: Cannot import feedparser.\n" 
    sys.exit(1) 
```

在这里，我们以状态码 1 退出。输出错误消息、写入日志和清理通常也很有帮助。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-01-13T13:15:53.473

据我所知，如果您的脚本没有捕获到异常，它将被中断。

* * *

## 回答 #6

> 赞同：-9
> 
> 时间：2020-08-10T13:52:29.063

```
import sys

try: 
    # your code here
except Exception as err:
    print("Error: " + str(err))
sys.exit(50) # whatever non zero exit code 
```

# c# - 接口上的自定义属性或实现它们的类？

> ID：438913
> 
> 赞同：1
> 
> 时间：2009-01-13T13:20:13.917
> 
> 标签：c#, interface, custom-attributes

当使用自定义属性存储元数据时，最好装饰接口还是实现接口的类，假设任何实现接口的类都将在属性中具有相同的数据？

**更新：**基本上我正在为一个项目编写自定义数据存储机制，对象代表正在存储的各种表。自定义属性用于指定数据集中的哪个表用于存储该类的对象，并且还用于标识哪些表涉及到：m 关系。

因此，如果我将属性放在界面上，这是一种更清晰的方法，还是会使界面混乱并使访问数据本身更加麻烦？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T13:26:42.157

这取决于场景。例如，WCF 装饰了操作契约的接口。

但是，如果您要谈论*对象*（而不是接口本身），请注意调用代码来获取接口元数据可能会很痛苦，尤其是当类使用显式接口实现时。

装饰班级会更*常见*，但这不是同一个问题；-p

如果属性确实特定于**接口**（而不是实例），那么很好 - 装饰接口并讨论`typeof(IFoo)`等等。但是如果您希望代码能够为属性设置每个类型的值，它必须在班级水平。

场景是什么？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T13:29:24.633

好吧，这取决于接口是否与元数据有关。

```
interface IRunnable
{
    void Run();
}

class Test : IRunnable
{
    public void Run() { }
} 
```

在此示例中，如果属性与接口的意图相关，则将属性放在接口上是有意义的。如果属性适用于所有实现，则将属性放在接口上。

但是，如果属性与类的“可运行性”（与`IRunnable`不属于 CLR 的“可运行性”）无关，则将属性放在类上。

# .net - WinForms 应用程序的本地化和以后的 UI 更改

> ID：438920
> 
> 赞同：2
> 
> 时间：2009-01-13T13:22:52.850
> 
> 标签：.net, localization

我正在使用 VS2008 开发 WinForms 2.0 应用程序。我已经阅读了如何通过在设计器等中将 Localizable 属性设置为 true 来在 Visual Studio 中本地化我的应用程序。

我想问一下您的经验，当我将应用程序翻译成多种语言然后对用户界面进行更改时，它是如何工作的。例如，我添加一些按钮，从表单中删除一些其他控件等。我知道这不是最佳实践，但有时我必须在开发过程中本地化应用程序，然后继续添加新功能。这一切都有效还是我会以一些损坏的资源文件等结束？

我问的原因是我以前使用过 Borland C++ Builder，当我在一个已经本地化的应用程序中更改 UI 时，它遇到了很大的问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T14:13:57.040

当您将控件添加到表单并设置属性时，它们将被添加到表单的文化中性资源中。

当您加载表单时，.NET 将尝试查找用户特定文化的资源（例如挪威 bokmål 的 nb-NO）。如果找不到资源，.NET 将尝试网络文化（在这种情况下为否），如果没有找到资源，它将加载中性资源。

因此，即使您添加了新控件但不为它们添加特定于文化的资源，您的应用程序也可以使用英语 (?) 文本而不是翻译文本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T13:32:32.333

在 MSDN Windows Forms 论坛回答问题 3 年后，我从未听说过编辑本地化表单会导致问题。微软不是 Borland。

# visual-studio-2008 - 尝试加载解决方案文件时 Visual Studio 2008 崩溃

> ID：438923
> 
> 赞同：6
> 
> 时间：2009-01-13T13:24:00.463
> 
> 标签：visual-studio-2008, crash, add-in

当我尝试在 Visual Studio 2008 中加载解决方案时，它会立即关闭。我在事件日志中收到以下错误：

> .NET 运行时版本 2.0.50727.3053 - 致命的执行引擎错误 (6E875E00) (80131506)

我在网上到处搜索，找不到解决这个问题的方法。我发现了类似的问题，但没有一个与 (6E875E00) 部分匹配。这是我的设置：

Vista 64
Visual Studio 2008 SP1
.Net Framework 3.5 SP1
ReSharper 4.1
Gallio 3.05
TestDriven.Net 2.18

我有一种感觉，它是加载项之一，但我不知道是哪一个。

有人经历过吗？这非常令人沮丧！

编辑：这个问题的答案以供将来参考是卸载 Gallio。这是导致崩溃的唯一加载项。感谢大家的帮助！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-13T13:29:02.247

是的，并非不可能。编辑 Visual Studio 的快捷方式并为其提供 /SafeMode 选项。这样可以确保不会加载附加组件。如果这没有帮助，请开始禁用压缩包装的恶意软件，如病毒扫描程序。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-13T13:28:34.883

尝试创建一个新的解决方案并导入您现有的项目。

或者，卸载 ReShaper、Gallio 和 TestDriven 并查看解决方案是否加载。然后一次安装一个插件，直到找到罪魁祸首。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-13T13:52:36.770

如果它只影响单个解决方案，请尝试删除 .suo 文件（它将与解决方案文件位于同一文件夹中）；如果它影响所有解决方案，那么 nobugz 提到的安全模式选项可能值得尝试......

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-13T13:43:29.800

在加载解决方案之前尝试重置窗口布局（菜单 -> 窗口 -> 重置窗口布局）。

这有助于我解决 VS 崩溃问题。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-10T01:05:12.293

我们在 Visual Studio 启动时遇到了类似的问题，罪魁祸首是一个特定的附加组件，即 Visual Studio PowerCommands。

[http://code.msdn.microsoft.com/PowerCommands](http://code.msdn.microsoft.com/PowerCommands)

小心这个插件！禁用它并运行

> devenv /ResetSkipPackages

帮助。[VS 命令行参数](http://msdn.microsoft.com/en-us/library/xee0c8y7(VS.80).aspx)的完整列表也很有指导意义。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T19:11:47.550

试试这个修复：

[http://blogs.msdn.com/webdevtools/archive/2009/03/03/hotfix-available-for-asp-net-mvc-crashes-with-azure-power-commands-resharper.aspx](http://blogs.msdn.com/webdevtools/archive/2009/03/03/hotfix-available-for-asp-net-mvc-crashes-with-azure-power-commands-resharper.aspx)

它对我有用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-05-09T21:15:16.080

这对我有用。

Devenv.exe /重置设置

# graphics - 3d 模型、LOD、图片等

> ID：438937
> 
> 赞同：0
> 
> 时间：2009-01-13T13:30:36.627
> 
> 标签：graphics, 3d

我需要为 3d 模型编写一个实用程序。我需要做的是将 3d 模型传递给 util 并让它提取多个信息。像多边形数、大小/比例（如果适用）和其他我能抓住的东西。然后我需要对模型进行 8 次屏幕截图（从 0 到 360 的 45 度）。也许 16\. 有没有可以用来从模型中提取数据的应用程序，是否有另一个应用程序可以用来创建图像？如果是这样，我可以编写一个 php 脚本来为我完成这一切:) 如果不是，我将发布更多关于细节的问题。

我的操作系统是 debian etch，模型可以是任何格式。我可以只制作 3ds 或将其限制在应用程序支持的范围内。或者我可能有另一个应用程序将一种格式转换为另一种格式并从该格式中提取数据。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T16:31:58.803

我还没有尝试过，但是您可以尝试[3ds2pov](http://www.personal.uni-jena.de/~p6sepa/software.htm)将您的 3DS 文件转换为 POV-Ray 格式，然后使用 POV-Ray 进行渲染。

3ds2pov 程序已经很老了，所以我不知道它与当前的 3DS 文件的兼容性如何。该存档带有源代码，因此在 Debian 上构建应该没有太大的困难。

POV-Ray 本身可以在 Linux 上轻松运行。

注意：可能存在其他 3DS 到 POV 转换器。这个恰好是谷歌搜索“3ds to pov”返回的第一个。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T14:03:15.920

您的要求非常松散和模糊，但大多数 3d 引擎应该具有创建自定义实用程序所需的工具。我将首先查看 Blender 或来自 OGRE、OpensceneGraph 和类似工具的查看器工具。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-10-04T00:42:45.283

您可以试试这个：基于 Linux 的[A3dsViewer](http://www.aptagraphis.com/index.php?option=com_content&view=article&id=54%3aa3dsviewer-14-released&catid=1%3alatest-news) -> 进行 3ds 到 pov 的转换。

# sql - SQL Server：仅 GROUP BY 中的最后一个条目

> ID：438938
> 
> 赞同：7
> 
> 时间：2009-01-13T13:30:39.810
> 
> 标签：sql, sql-server, group-by

我在 MSSQL2005 中有下表

```
id | business_key | result
1 | 1 | 0
2 | 1 | 1
3 | 2 | 1
4 | 3 | 1
5 | 4 | 1
6 | 4 | 0 
```

现在我想根据返回具有最高 id 的完整条目的 business_key 进行分组。所以我的预期结果是：

```
business_key | result
1 | 1
2 | 1
3 | 1
4 | 0 
```

我敢打赌，有一种方法可以实现这一点，我现在看不到它。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-13T13:46:30.573

另一种解决方案，它可以为您提供更好的性能（测试两种​​方式并检查执行计划）：

```
SELECT
     T1.id,
     T1.business_key,
     T1.result
FROM
     dbo.My_Table T1
LEFT OUTER JOIN dbo.My_Table T2 ON
     T2.business_key = T1.business_key AND
     T2.id > T1.id
WHERE
     T2.id IS NULL 
```

此查询假定 ID 是唯一值（至少对于任何给定的 business_key）并且它设置为 NOT NULL。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-13T13:36:47.160

```
select
  drv.business_key,
  mytable.result
from mytable
  inner join
  (
    select 
      business_key, 
      max(id) as max_id
    from mytable
    group by
      business_key
  ) as drv on
    mytable.id = drv.max_id 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-13T13:42:03.157

试试这个

```
select  business_key, 
        result
from    myTable
where   id in 
        (select max(id)
        from    myTable
        group by business_key) 
```

编辑：我创建了表来测试我的代码。我把它包括在下面，以防其他人想要测试它。

```
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[myTable](
    [id] [int] NOT NULL,
    [business_key] [int] NOT NULL,
    [result] [int] NOT NULL
) ON [PRIMARY]
go

insert into myTable values(1,1,0);
insert into myTable values(2,1,1);
insert into myTable values(3,2,1);
insert into myTable values(4,3,1);
insert into myTable values(5,4,1);
insert into myTable values(6,4,0);

select  * from mytable 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-15T00:49:36.897

```
select business_key, 
       result
    from 
    (select id, 
        business_key, 
        result, 
        max(id) over (partition by business_key) as max_id
    from mytable) x
where id = max_id 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-09-27T14:41:35.433

这是一篇较旧的帖子，但与我目前正在做的事情有关（2013 年）。如果您获得更大的数据集（在大多数数据库中很典型），则各种查询的性能（查看执行计划）说明了很多。首先我们创建一个“TALLY 表”来随机生成数字，然后使用任意公式为“MyTable”创建数据：

```
CREATE TABLE #myTable(
    [id] [int] NOT NULL,
    [business_key] [int] NOT NULL,
    [result] [int] NOT NULL,
    PRIMARY KEY (Id)
) ON [PRIMARY];

; WITH
    -- Tally table Gen            Tally Rows:     X2                X3
t1 AS (SELECT 1 N UNION ALL SELECT 1 N),    -- 4            ,    8
t2 AS (SELECT 1 N FROM t1 x, t1 y),            -- 16            ,    64
t3 AS (SELECT 1 N FROM t2 x, t2 y),            -- 256            ,    4096
t4 AS (SELECT 1 N FROM t3 x, t3 y),            -- 65536        ,    16,777,216
t5 AS (SELECT 1 N FROM t4 x, t4 y),            -- 4,294,967,296,    A lot
Tally AS (SELECT ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) N
          FROM t5 x, t5 y)

INSERT INTO #MyTable 
SELECT N, CAST(N/RAND(N/8) AS bigINT)/5 , N%2
FROM Tally
WHERE N < 500000 
```

接下来我们运行三种不同类型的查询来检查性能（如果您使用的是 SQL Server Management Studio，请打开“实际执行计划”）：

```
SET STATISTICS IO ON
SET STATISTICS TIME ON
----- Try #1 
select  'T1' AS Qry, id, business_key, 
        result
from    #myTable
where   id in 
        (select max(id)
        from    #myTable
        group by business_key)

---- Try #2 
select 'T2' AS Qry, id, business_key, 
       result
    from 
    (select id, 
        business_key, 
        result, 
        max(id) over (partition by business_key) as max_id
    from #mytable) x
where id = max_id

---- Try #3 
;with cteRowNumber as (
    select id, 
        business_key, 
        result,
           row_number() over(partition by business_key order by id desc) as RowNum
        from #mytable
)

SELECT 'T3' AS Qry, id, business_key, 
       result
FROM cteRowNumber
WHERE RowNum = 1 
```

清理：

```
IF OBJECT_ID(N'TempDB..#myTable',N'U') IS NOT NULL 
    DROP TABLE #myTable;
    SET STATISTICS IO OFF
SET STATISTICS TIME OFF 
```

你会发现，查看执行计划，“Try 1”具有最好的“查询成本”和最低的 CPU 时间，但“Try 3”的读取次数最少，CPU 时间也不算太差。我建议使用 CTE 方法来减少读取次数

# c# - 有什么方法可以调用重写方法的父版本？（C#.NET）

> ID：438939
> 
> 赞同：45
> 
> 时间：2009-01-13T13:30:43.647
> 
> 标签：c#, .net, inheritance

在下面的代码中，我尝试了两种方法来访问 methodTwo 的父版本，但结果始终为 2。有没有办法在不修改这两个类的情况下从 ChildClass 实例中获取 1 结果？

```
class ParentClass
{
    public int methodOne()
    {
        return methodTwo();
    }

    virtual public int methodTwo()
    {
        return 1;
    }
}

class ChildClass : ParentClass
{
    override public int methodTwo()
    {
        return 2;
    }
}

class Program
{
    static void Main(string[] args)
    {
        var a = new ChildClass();
        Console.WriteLine("a.methodOne(): " + a.methodOne());
        Console.WriteLine("a.methodTwo(): " + a.methodTwo());
        Console.WriteLine("((ParentClass)a).methodTwo(): "
         + ((ParentClass)a).methodTwo());
        Console.ReadLine();
    }
} 
```

**更新**ChrisW 发布了这个：

> 在课外，我不知道任何简单的方法；但是，也许，我不知道如果你尝试反射会发生什么：使用Type.GetMethod方法在ParentClass中找到与该方法关联的MethodInfo，然后调用MethodInfo.Invoke

那个答案被删了。我想知道这个黑客是否可以工作，只是为了好奇。

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2009-01-13T13:34:07.680

里面的`ChildClass.methodTwo()`，可以调用`base.methodTwo()`。

在课堂之外，调用`((ParentClass)a).methodTwo()` **将**调用`ChildClass.methodTwo`。这就是虚方法存在的全部原因。

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2009-01-13T13:34:48.880

在 IL 级别，您可能会发出 a`call`而不是 a`callvirt`并完成工作 - 但如果我们将自己限制在 C# ;-p ( **edit** darn! the runtime stop you: `VerificationException`: "Operation could destabilize the runtime."; remove并且`virtual`它工作正常；太聪明了一半......）

在`ChildClass`类型内部，您可以使用`base.methodTwo()`- 但是，这在外部是不可能的。你也不能下降超过一个级别 - 没有`base.base.Foo()`支持。

但是，如果您使用方法隐藏禁用多态性，您可以获得您想要的**答案，但是出于不好的原因：**

```
class ChildClass : ParentClass
{
    new public int methodTwo() // bad, do not do
    {
        return 2;
    }
} 
```

现在，您可以从同一个对象得到不同的答案，具体取决于变量是定义为 a`ChildClass`还是 a `ParentClass`。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2015-09-02T08:37:56.167

如上所述，如果您需要在 PRODUCTION 代码中调用“base.base”，那么您的类设计就会出现问题。但是，如果您在使用无法编译的外部库时调试或搜索一些解决方法，则使用此技术是非常合法的。令人不快的是 C# 不直接提供此选项。您仍然可以使用带有 IL 生成器和 Emit 的 Kenneth Xu 解决方案。有用。

```
class A { public virtual string foo() { return "A"; } }

class B : A { public override string foo() { return "B"; } }

// now in class C
class C : B {}      
// we can call virtual method "foo" from A using following code
MethodInfo fooA = typeof(A).GetMethod("foo", BindingFlags.Public | BindingFlags.Instance);

DynamicMethod baseBaseFoo = new DynamicMethod(
            "foo_A",
            typeof(string),
            new[] { typeof(A) },
            typeof(A));
        ILGenerator il = baseBaseFoo.GetILGenerator();
        il.Emit(OpCodes.Ldarg, 0);
        il.EmitCall(OpCodes.Call, fooA, null);
        il.Emit(OpCodes.Ret);

// call foo() from class A, it returns "A"
(string)baseBaseFoo.Invoke(null, new object[] { this }); 
```

有关参考和完整示例，请参阅 [http://kennethxu.blogspot.cz/2009/05/cnet-calling-grandparent-virtual-method.html](http://kennethxu.blogspot.cz/2009/05/cnet-calling-grandparent-virtual-method.html)

谢谢肯尼斯许！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-02-19T17:12:27.260

正如 Mark Gravell 所说，不，不是在外部。但这是我用过的另一个技巧。`ChildClass`可自用或外用`methodTwo()`。`ParentClass`在你的情况下：

```
class ChildClass : ParentClass {
    override public int methodTwo() {
        return 2;
    }
    public int ParentClass_methodTwo() {
        return base.methodTwo();
    }
}

// Now instead of
Console.WriteLine("ParentClass methodTwo: " + ((ParentClass)a).methodTwo());
// use
Console.WriteLine("ParentClass methodTwo: " + a.ParentClass_methodTwo()); 
```

在我的例子中，子类引入了 Peer 的概念，我需要重写它`methodTwo()`来调用 peer 上的基本版本。然而，通过覆盖它，它隐藏了它......或者是它？这种技术来拯救。

```
class ChildClass : ParentClass {
    ChildClass peer;
    override public int methodTwo() {
        return peer.ParentClass_methodTwo();
    }
    private int ParentClass_methodTwo() {
        return base.methodTwo();
    }
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-06-17T10:22:48.637

```
public class Parent 
{
    public string Method()
    {
       return "parent";

    }
}

public class Child:Parent
{
    public string Method()
    {
       return "child";

    }
} 
```

上面的代码成功覆盖了父方法，但父方法的值仍然没有改变。

**您可以使用以下代码从父类**和**子类**返回值-

```
Child child = new Child();
string result = (((Parent)child).Method()) + child.Method(); 
```

> 但是 Visual Studio 会在编译时向您显示警告。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-13T13:34:37.010

据我所知，一旦方法被覆盖，就不能调用父方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-13T13:36:18.707

我认为除非您直接创建 ParentClass 的实例，否则这是不可能的。这就是继承，多态性的本质......

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-01-18T04:17:34.100

我偶然发现了这个寻求帮助并最终用我自己的方法来调用方法的祖先版本。这更像是一种变通方法，假设您可以编辑祖先类：

将祖先类中的相关功能放入带有必要参数的静态方法中。该类中的方法可以调用它，因此它不需要复制功能，如果需要，子类可以通过静态方法调用该功能。这样，它甚至可以在一个方法中完成，并且可以引用它想要调用的特定类。此外，它可以访问比单纯的父母更远的祖先，这是使用“基地”的限制。

# asp.net - 神秘进程 - RunSilent - Windows Server 2003 上的错误

> ID：438944
> 
> 赞同：2
> 
> 时间：2009-01-13T13:32:36.653
> 
> 标签：asp.net, windows-server-2003

我们正在为使用 Dundas Maps for ASP.Net 组件的 Web 应用程序设置生产服务器（Windows Server 2003 R2 64 位）。

安装后我们收到以下错误：“RunSilent 遇到问题，需要关闭。”

问题是，RunSilent 到底是什么？谷歌搜索没有得到任何感兴趣的东西。它似乎与邓达斯无关。我的猜测是它与图形驱动程序有关。

干杯 - 克里斯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T13:26:21.377

我发现[这](http://www.indigorose.com/forums/showthread.php?p=99273)导致我[这样做](http://www.warmuskerken.com/)。会不会是某种在后台运行的计时器？

# multithreading - Delphi中的跨线程通信

> ID：438945
> 
> 赞同：6
> 
> 时间：2009-01-13T13:32:43.737
> 
> 标签：multithreading, delphi, c++builder

Delphi 中是否有关于跨线程通信的文档？如何向没有窗口的线程发送消息？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-13T13:54:01.883

您只能将（Windows）消息发送到实现标准消息循环的线程，一旦实现窗口句柄，它将自动创建。

然而，不必使用消息与线程通信。只需让它等待一个事件对象（VCL 中的 TEvent），并在您希望线程执行某个功能时发出此事件信号。

但是，如果您不熟悉多线程 - 不要自己深入所有这些细节，除非您想获得学习效果。只需使用[OmniThreadLibrary](http://otl.17slon.com/)并完成它。一旦你知道如何使用它，就可以通过深入研究它的内部来学习很多东西。

**编辑：**

另请参阅非常相似的[这个问题的答案。](https://stackoverflow.com/questions/273938/how-to-send-a-message-to-a-tthread-from-main-thread-in-delphi#274409)

**编辑2：**

关于询问“[OmniThreadLibrary] 使什么变得更容易，成本是多少？”的评论。我只能建议您自己检查一下 - 也就是说，如果您至少使用 Delphi 2007。有几个示例可以说明这些概念，但是对于一个快速的“现实生活”示例，您可以查看[此博客发布](http://17slon.com/blogs/gabr/2008/11/background-file-scanning-with.html)- 您甚至不需要为此安装库。

我也同意将库用于多线程确实需要某种信念。OTOH 使用 VCL 提供的东西几乎不是替代方案。示例代码仍然使用构思不当的 Synchronize() 调用。不支持线程安全的生产者-消费者队列之类的东西，它们更适合多线程编程。如果你同意你的多线程程序需要比 VCL 提供的更坚实的基础 - 为什么要重新发明那个特定的轮子？

至于使用图书馆的费用：你必须自己计时它是否对你来说足够快。恕我直言，它确实以一种很好的方式抽象了线程之间的通信，但显然，每个抽象都会牺牲性能。

如果您认为它毕竟不适合您 - 自己编写代码。我对 Delphi 4 做了同样的事情，而且我已经使用该代码近 10 年了。从我发现的错误数量和我在那段时间经历的极端情况来看，我绝对会建议任何刚接触多线程的人**不要**为它编写自己的库代码。如果您**真的**想这样做，请牢记[此帖子](http://newsgroups.cryer.info/borland/public.delphi.internet.winsock/200507/0507273541.html)中的规则。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-13T13:57:35.900

[Delphi Multi-Threading Message Loop](https://stackoverflow.com/questions/229630/delphi-multi-threading-message-loop#229808)这个问题也包含了几个线程间通信的例子

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-01-13T16:44:02.850

如果您有对线程对象的引用，您可以直接调用它，并让过程存储信息或相应地更新。显然，您必须小心以线程安全的方式做事。

或者，您可以使用一个中央控制对象，线程不忙时通过该对象进行通信。我有一个应用程序，其中线程具有特定用途，并被分配了一个线程 ID。任何线程都可以将带有消息 ID 和参数字符串的消息“发布”到另一个线程 ID，然后继续其工作。另一个线程在闲暇时将其拾起，并采取相应的行动。

# flash - 您能确定服务器端 Flash/SWF 对象的宽度和高度吗？

> ID：438953
> 
> 赞同：3
> 
> 时间：2009-01-13T13:34:54.323
> 
> 标签：flash

我想允许基于 Web 的 CMS 的用户上传 Flash 文件并将它们包含在内容中。我可能会使用 SWFObject 来渲染 flash，但我需要宽度和高度。上传时是否可以通过 C# 确定这些？

谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-13T14:49:54.267

可能有更简单的方法，但是，

[您可以从http://blogs.msdn.com/mswanson/archive/2006/10/15/example-c-code-for-reading-flash-swf-files.aspx](http://blogs.msdn.com/mswanson/archive/2006/10/15/example-c-code-for-reading-flash-swf-files.aspx)下载“FlashTools.zip”并编译项目. 然后添加对“FlashTools.dll”程序集的引用。然后，您可以使用以下方法获取高度/宽度：

```
SWFFile swf = new SWFFile(fileLocation);
Response.Write("Height:" + swf.FrameHeight/20 + " Width:" + swf.FrameWidth/20); 
```

我已经对此进行了测试，它显示了正确的信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T15:18:38.780

或许您还应该让用户手动输入每个 SWF 的宽度和高度（以及从 SWF 字节码自动检测的选项）。

我提到这一点是因为 SWF 文件大多被设计为嵌入 HTML 中，并且 SWF 的舞台大小（用于维度的 Flash 术语）并不总是旨在成为该内容的嵌入大小 - 一些 SWF 旨在自动调整其大小内容以匹配它们在 HTML 中的嵌入方式，因此这些 SWF 的实际舞台宽度和高度可能无关紧要。

# struts2 - 渲染完整页面而不是“渐进式”（使用 struts 2 / tile）

> ID：438954
> 
> 赞同：1
> 
> 时间：2009-01-13T13:35:35.790
> 
> 标签：struts2, tiles2

有没有办法让 struts 2（使用磁贴）在将整个页面发送到浏览器之前构建整个页面？我不希望页面一次在浏览器中“逐步”构建。

我要解决的主要问题是，即使只有部分内容发生变化，Internet Explorer 7 也会闪烁/闪烁页面（Firefox 会更顺利地做到这一点）。

所以如果我有一个页面：

标题

一些内容

页脚

并且“一些内容”区域仅在页面加载之间发生变化，FOOTER 部分仍然闪烁白色背景，然后用页脚的背景颜色填充它。我坚持认为，也许通过让 struts 发送完整的页面，它的加载速度会足够快以消除“闪烁”。现在 FOOTER 来自服务器的时间比它之前的部分晚一点，所以它会闪烁（在 Internet Explorer 中，Firefox 可以流畅地显示页面）。

注意：这是网站的一项重要要求，使用 ajax 加载中间内容已经过时（框架或其他“黑客”也是如此）。该网站是使用 CSS 而不是表格布局构建的，也许我将不得不使用表格布局来让它工作......

关于使用 tiles flush 参数：我试过了，但它不能按我的需要工作。我需要整个页面的刷新参数。我已经尝试过正常的 jsp 页面指令“autoFlush=false”，但它不起作用。我在我的主模板页面上设置了这个指令（而不是在磁贴中）。

这是主模板中的一个示例，它使用页眉、正文和页脚模板。使用 Thread.sleep() 我添加的问题很容易发现。页脚的呈现时间比页面的其余部分晚 2 秒。

```
 <body>
  <div id="container">
  <t:insertAttribute name="header" flush="false" />

  <div id="content"><t:insertAttribute name="body" flush="false"/></div>

  <div class="clear"></div>
  <% Thread.sleep(2000); %>
  <t:insertAttribute name="footer" flush="false" />
  </div>
  </body> 
```

更新

感谢您的评论。该要求实际上几乎是合理的，因为这不是一个普通的网页，认为是嵌入式的。

但显然没有办法配置 IE 在一些延迟后开始渲染（比如 Firefox 有大约 100 毫秒的可配置延迟）？

我试图拦截 TilesResult 但方法 doExecute 在显然评估整个内容之前运行，因此在评估 jsp 之前该方法已经退出（我的 Thread.sleep() 测试）。我想知道如何将整个响应呈现为字符串，然后一次将其全部输出到浏览器。

我知道这不是万无一失的，网络延迟等可能是其中的一个因素，但是如果我可以一次获得对输出的响应并且可能使用基于表格的布局（IE 可能仅在表格关闭后才呈现表格）这可能合理工作。

或者然后尝试将其切换到Firefox，或者可能忘记这个小故障......

更新 2

这开始困扰我，所以我做了一些调查。如果我有一个普通的 jsp 页面（没有图块），则缓冲工作（使用 buffer 属性），所以如果我有我的 Thread.sleep() 如果页面大小低于缓冲区大小，则在两秒钟后呈现整个页面。但是，如果我在页面中使用图块（如上面的示例），我无法同时渲染页面（我什至在我的所有图块模板/“组件”中都包含了页面指令，没有帮助）。所以瓷砖可能会在某处刷新响应？

此外，“有问题的瓷砖”是我的身体部分，其中包含一个 struts:form 标签。我用普通的表单标签替换了它，它可以按我的意愿工作......

更新 3

好的，似乎没有人知道瓷砖或支柱标签的内部工作原理......没有大问题，因为这是一个非常具体的案例和要求。我通过在应用程序前面使用 apache 作为 proxt 并使用 apache 的代理配置选项来指定一个大缓冲区来解决它。我会将其标记为已回答。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T15:41:28.080

如果您愿意，您可以在服务器端一次性发送所有页面数据（为了方便起见，许多框架无论如何都会这样做），但网络的现实是它不会一次全部到达，浏览器将在数据包到达时呈现它。这对于响应性来说是一件好事，即使您*在美学上希望页面一次显示所有内容。

您可以通过简化标记和使用 deflate 压缩来降​​低有效负载大小来尽可能减少延迟，这通常是值得做的事情。另外，您可以确保您没有遇到无样式内容的 Flash。但是您无法控制浏览器何时选择渲染，除非在 JavaScript 中完成所有操作，但会带来所有不利因素（即使那样，浏览器可能会缓慢重绘）。

（* - 或您的客户/老板，如果他们提出了这个“重要要求”，即您的网站以某种方式与网络上的所有其他页面不同。）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T13:42:25.667

你可以在瓷砖组件上使用“flush”属性吗？

```
<tiles:insertAttribute name="body" flush="false"/> 
```

此外，如果输出缓冲区变得太大，它无论如何都会刷新。尝试增加缓冲区大小？

```
<%@ page language="java" buffer="500kb" autoFlush="false" %> 
```

# xml - 用 VB 6.0 编写 XML

> ID：438959
> 
> 赞同：0
> 
> 时间：2009-01-13T13:37:13.197
> 
> 标签：xml, logging, vb6

我需要使用 Visual Basic 6.0 将错误日志写入 XML 文件。是否有捷径可寻？

错误日志将包含错误号、源、描述和时间戳。

谢谢，杰夫

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T13:44:25.990

可能最好使用 Microsoft 的 MSXML 库来执行此操作。

知识库中有一个示例：http: [//support.microsoft.com/kb/286817](http://support.microsoft.com/kb/286817)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T13:54:51.600

Microsoft MSXML 库是您的第一个调用端口，但在决定使用它之前，您需要考虑一些事项。

使用 MSML 库将错误消息附加到 Xml 将在您每次打开 Xml 文件时对其进行解析和加载。随着 Xml 文件的增长，您会发现您的应用程序变慢了。

如果您可以“仅”将错误附加到文件末尾会很好，但是由于关闭标签，这不是直截了当的，但可以做到。

如果您可以控制如何创建 Xml 文件，则接下来可以通过将 Xml 文件分成两个来解决这个性能瓶颈，一个带有标头，一个带有 xml 的主体。然后，您可以附加到正文文件的末尾（通过使用 Xml 编写器类，或者只是将文本附加到文件中）。

有关详细信息，请参阅[修改大型 XML 文件的有效技术](http://msdn.microsoft.com/en-us/library/aa302289.aspx)

但是，如果您将一个错误写入 xml 文件，而下一个错误进入另一个 Xml 文件，那么所有这些都是不必要的。在这种情况下，请使用 MSXML

希望这可以帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T13:47:06.983

如果您只编写日志文件，我建议您只连接这样的字符串：

```
公共函数 GetXmlEntry(errNumber as Long, description as String) as String
  GetXmlEntry = "<entry><error-number>" & errNumber & "</error-number><description>" & description & "</description></entry>"
结束功能

```

这里没有必要使用 XML 库，甚至会不必要地损害性能（即没有优势）。

（**编辑**）正如评论中指出的那样，编写正确的 XML 至少需要两个额外的步骤，即使是一个条目：首先，需要正确转义一些特殊字符（不应该那么难）；其次，需要对所有 XML 文件使用正确（=相同）的编码，与标头中的声明一致（为此，我的 VB-Fu 还不够——在参考文献中稍加挖掘会有所帮助）。

# javascript - 我可以使用 JavaScript、Flash 或 Silverlight 通过 HTTP 接收流吗？

> ID：438965
> 
> 赞同：1
> 
> 时间：2009-01-13T13:39:42.660
> 
> 标签：javascript, http, streaming

我正在通过端口 80 使用 http 对实时通知机制进行原型设计。该项目的目的是允许 Flash 应用程序快速响应远程服务器上的事件（特别是连接到计算机旁边的电话的呼入电话.) 轮询是一种方法，但太慢了。目前，我使用套接字连接来获取服务器上事件的低延迟通知，这很好用，但对防火墙不友好。我不想在客户端上安装除 Flash 或 Silverlight 之外的任何东西。浏览器的交叉兼容性不是问题——在这个应用程序中，我可以指定客户端使用的浏览器，但首选 IE。

我在 .NET 中创建了一个服务器 HttpHandler，它从不关闭连接并通过将字节写入 http 响应流（ConnectedClientContext.Response.OutputStream.Write 等）将“事件”发送到客户端，并且我有一个 .NET 客户端可以读取这些消息的应用程序没问题。

我的问题：

当字节到达使用 JavaScript、Flash 或 Silverlight 时，我可以通过 HTTP 接收来自服务器的字节吗？到目前为止，我只能找到一种方法来获得“下载进度”的通知，并且在响应关闭之前不获取实际字节 - 我想要它们到达时。

此致，

丹尼尔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T13:49:46.790

我不了解 Flash，但在 Javascript（您的意思是在浏览器中）和 Silverlight 中，您几乎受限于 http 协议。

您可以使用[AJAX Http Streaming 模式](http://ajaxpatterns.org/HTTP_Streaming)。与您尝试的不同的基本想法是，一旦数据可用，未完成的请求就会结束，并且立即异步启动新的请求，这意味着您的客户端处理新到达的数据。

Silverlight 为您提供了更多选择，因为 HTTP 堆栈是纯异步的，但您可以通过`HttpWebRequest.AllowReadStreamBuffering`将`false`. （与始终缓冲的 XmlHttpRequest 不同）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T14:47:33.350

将 Comet 创意用于通知非常容易。您甚至不必使用特定于彗星的框架。只需在回答时执行一个带有回调的 ajax 请求，将其包装在一个循环中，您就有了一个事件循环，就像一个 GUI 应用程序一样。在服务器端，在有事件或超时（这只是一个“空”事件）之前不要费心回答请求。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T14:11:59.070

Flex 和 Flash 有几个支持数据推送的 AMF/XML 远程处理库。我肯定会调查的。

[http://raghuonflex.wordpress.com/2008/04/17/data-push-in-flex-with-backend/](http://raghuonflex.wordpress.com/2008/04/17/data-push-in-flex-with-backend/)

这些库使用类似[Comet](http://en.wikipedia.org/wiki/Comet_(programming) "彗星")的实现来实现这一点。

# c# - 设计时教程

> ID：438968
> 
> 赞同：2
> 
> 时间：2009-01-13T13:40:22.130
> 
> 标签：c#, vb.net, winforms, design-time

我正在寻找一些（最好）关于使用“丰富的设计时支持”制作控件的在线教程

通过丰富的设计时间支持，我的意思是菜单条在表单上的工作方式等。

任何指向网站、好书或代码示例（c# 或 vb.net）的链接都会很棒。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T14:48:56.250

您可以从[剖析 AC# 应用程序](http://www.icsharpcode.net/OpenSource/SD/InsideSharpDevelop.aspx)开始，它涉及创建 SharpDevelop、用 .NET 编写的 C# IDE 的许多方面。这涵盖了设计器架构的许多方面，并且它在 PDF 中是免费的。但是，PDF 很难找到（原始链接不再有效，但我相信[这](http://www.cpe.ku.ac.th/~pattara/csharp/files/textbook.pdf)是一份有效的副本）。

虽然这会让您开始了解设计器的细节，但它可能不会详细介绍一些更有趣的功能，例如动作和任务。对于这一点，[MSDN](http://msdn.microsoft.com/en-us/library/37899azc.aspx)有一些广泛的信息和示例（它不习惯）。

最后，我发现最好的资源是[.NET Reflector](http://www.red-gate.com/products/reflector/)。在设计时支持领域工作时，使用此工具查看[Microsoft](http://www.microsoft.com)如何在框架内的各个地方完成它是一个很好的学习练习。找到一个能做你想做的事的控件，然后去看看它是怎么做的。

所有这些资源都是免费的，但你的时间不是。我发现设计时支持在某些领域可能是轻而易举的事，但在其他领域则是一场彻头彻尾的噩梦。祝你好运。

# iphone - iPhone SDK 缺少什么？

> ID：438979
> 
> 赞同：12
> 
> 时间：2009-01-13T13:43:20.953
> 
> 标签：iphone, cocoa-touch

我从事移动应用程序开发已经有很长时间了（2001 年？），但我们当时使用的系统是专用的*移动*开发环境（Symbian、J2ME、BREW）。iPhone SDK 是 Mac OS X 和 Apple 的移动设备（Cocoa Touch）的奇妙混合体。

但它缺少其他移动系统所拥有的一些东西，IMO。具体来说：

*   应用后台处理
*   SMS/MMS 应用程序路由（在后台向我的应用程序发送 SMS）
*   访问电话功能/通话记录/通话拦截的API

我意识到 Apple 完全有充分的理由以他们的方式发布 SDK。我很好奇 SO 上的人认为 SDK*缺少*什么，如果他们是 Apple 的工程产品经理，他们将如何修复/添加它。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-13T13:51:21.763

我认为最大的缺点是支持将许可与分发分开。

我的意思是应该可以下载应用程序的试用版，然后购买该应用程序的许可证（通过应用程序内部的 API 调用或从应用程序商店）。这将使购买前试用变得更加容易，并摆脱当前许多具有“精简”版本的应用程序的副本。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-13T14:38:32.310

我认为缺乏应用程序的推送通知是我们现在缺少的大事。使用推送，您可以注册您的应用程序以执行任务（例如从 Web 服务获取最新数据），即使它没有运行，在操作系统决定的最佳时间和频率上也是如此。在一个理想的世界中，随着 iPhone 应用程序快速加载并从上次停止的地方恢复的现有概念，这解决了不在后台运行的问题。我知道使用这种策略有些任务会更加困难甚至不可能，但它仍然是第三方应用程序和 iPhone 有限硬件之间的一个很好的折衷方案。

最初推送计划在去年 9 月进行，但它已从 beta SDK 中删除，此后便不再提及。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-13T13:55:07.030

我个人正在寻找的 API：

*   Apple80211 作为公共 API（私有的，当前的 API 如果有文档就可以）
*   访问音量按钮（通过 Celestial 半可访问，私有，需要新的 API）
*   访问日历（私有，API 状态未知）
*   访问蓝牙 + SPP 配置文件（状态未知）
*   访问相机（直接，API 状态未知）
*   访问 JavaScript 运行时（直接，不通过 UIWebView，API 状态未知）
*   比 UIWebView 更低级别的 WebKit 访问（私有，当前 API 很好）
*   访问音乐库（私有，当前 API 很好）

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-14T23:34:41.803

垃圾收集。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-14T23:37:18.850

缺少核心数据。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-13T13:58:26.477

你已经提到了一些重要的——复制和粘贴（或者实际上是应用程序协作的任何方式）是另一个巨大的遗漏。

它似乎也缺少桌面同步框架（至少如果它存在我找不到它）。

语言独立性，尤其是缺乏脚本是另一个令人讨厌的问题——objective-c 一切都很好，但更多的语言可供选择会更好。

无法通过脚本或其他方式动态扩展应用程序是另一个重大遗漏。这部分是 SDK/OS 问题，部分是许可问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-13T18:29:37.100

我的列表按优先级排序：

*   映射抽象（MapKit 看起来很棒），但这需要新的 Google Maps TOS
*   曲库
*   相机（照片+视频）访问更多
*   UIViews，Apple 为他们的应用程序设计了一些非常不错的自定义视图
*   更好的 UIWebKit 抽象

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-18T01:54:23.327

我认为它应该具有的缺少的功能是

*   访问短信
*   直接访问谷歌地图应用程序。您应该可以访问它，以便您可以扩展您的应用程序以使用 Google 地图提供的内置功能。
*   访问手机的蓝牙功能。
*   访问日历。为什么不允许访问简单地为用户发布日历事件。
*   访问主动同步。如果我们可以直接访问它并与 Exchange Server 通信，那就太好了。
*   核心形象。他们提供核心动画，但缺少核心图像。我希望这很快就会添加到 API 中。

这些是我的客户过去可以访问的一些功能，并且在它们不可用时会被更新。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-15T13:28:40.077

我们肯定会错过日历 API 和 SMS 访问。如此多的应用程序可以利用这些 API。iPhone 允许用户将所有东西都放在口袋里，但只要开发人员不能在他们的应用程序中利用这种集成，它就几乎毫无用处。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-06-16T22:34:53.153

具有适当名称空间的语言。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-13T17:31:49.557

困扰我的一个限制是无法访问需要 root 或 setuid 的系统功能。例如：打开特权 IP 端口。

我不确定是否有一个好的解决方案，只要 Apple 的政策是保持设备锁定。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-14T23:08:40.187

允许程序为您的应用程序设置某种本地定时事件，以在用户同意的情况下发出警报并启动您的应用程序（就像任何日历应用程序一样）。你可以通过推送通知来做到这一点，但在很多情况下，我讨厌不得不依赖整个服务器基础设施和网络连接来基本上做一些定时的事情。

了解用户面向的方向。我不敢相信新款 iPhone 使用的 GPS 芯片无法报告方向。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-06-16T22:30:20.557

我个人很想看看

*   访问 CoreTelephony 框架（当前为私有）。它允许访问所有电话功能（特别是发送彩信/短信）。
*   某种在后台运行东西的能力。虽然推送通知在大多数情况下都可以，但利用 CoreLocation 有点困难（即让应用程序在某个位置显示通知）。当然，这可能需要一个开/关按钮或特定的应用程序，如推送。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-07-25T04:18:18.393

动画视图将减少开发者制作一个很酷的应用程序，当然核心业务本地仍然需要考虑更多，但是视图层可以更易于使用....**``**