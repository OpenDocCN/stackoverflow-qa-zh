# StackOverflow 问答 000244000-000244999

# client - Apache Abdera 客户端 - 发布/放置

> ID：244000
> 
> 赞同：4
> 
> 时间：2008-10-28T16:44:25.383
> 
> 标签：client, atom-feed, apache-abdera

寻求使用 Apache Abdera Atom 客户端的帮助。我正在尝试将文件发布并放入提要，但我收到 400 错误，提示内容类型必须是`application/x-www-form-urlencoded`或`multipart/form-data`

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-08-27T08:39:48.047

您还需要检查您发布的位置。Abdera 用于发布 ATOM-XML 格式。看起来您尝试发布到您的网络表单发布到的同一个 URL，这将是一个 HTML 提交，也就是`x-www-form-urlencoded`. 检查博客服务器软件是否以及在何处支持 ATOM 发布协议。

# tsql - T-Sql 游标未进行获取

> ID：244001
> 
> 赞同：2
> 
> 时间：2008-10-28T16:44:26.070
> 
> 标签：tsql, cursors

我知道光标不受欢迎，我尽量避免使用它们，但使用它们可能有一些正当理由。我有一个，我正在尝试使用一对游标：一个用于主表，一个用于辅助表。主表游标在外循环中遍历主表。辅助表游标遍历内部循环中的辅助表。问题是，虽然主表游标显然继续并将主键列值 [Fname] 保存到局部变量 @Fname 中，但它没有获取辅助表中相应外键列的行。对于辅助表，它总是返回外键列值与主表**第一行**的主键列值匹配的行。

以下是我想在实际存储过程中执行的一个非常简化的示例。名称是主表

```
SET NOCOUNT ON
DECLARE 
    @Fname varchar(50) -- to hold the fname column value from outer cursor loop
    ,@FK_Fname varchar(50) -- to hold the fname column value from inner cursor loop
    ,@score int
;

--prepare primary table to be iterated in the  outer loop
DECLARE @Names AS Table (Fname varchar(50))
INSERT @Names
    SELECT 'Jim' UNION
    SELECT 'Bob' UNION
    SELECT 'Sam' UNION
    SELECT 'Jo' 

--prepare secondary/detail table to be iterated in the inner loop
DECLARE @Scores AS Table (Fname varchar(50), Score int)
INSERT @Scores
    SELECT 'Jo',1 UNION
    SELECT 'Jo',5 UNION
    SELECT 'Jim',4 UNION
    SELECT 'Bob',10 UNION
    SELECT 'Bob',15 

--cursor to iterate on the primary table in the outer loop
DECLARE curNames CURSOR
FOR SELECT Fname FROM @Names

OPEN curNames
FETCH NEXT FROM curNames INTO @Fname

--cursor to iterate on the secondary table in the inner loop
DECLARE curScores CURSOR
FOR 
    SELECT FName,Score 
    FROM @Scores 
    WHERE Fname = @Fname 
 --*** NOTE: Using the primary table's column value @Fname from the outer loop

WHILE @@FETCH_STATUS = 0
BEGIN
    PRINT 'Outer loop @Fname = ' + @Fname

    OPEN curScores
    FETCH NEXT FROM curScores INTO @FK_Fname, @Score

    WHILE @@FETCH_STATUS = 0
    BEGIN
        PRINT ' FK_Fname=' + @FK_Fname + '. Score=' + STR(@Score)
        FETCH NEXT FROM curScores INTO @FK_Fname, @Score
    END
    CLOSE curScores
    FETCH NEXT FROM curNames INTO @Fname
END

DEALLOCATE curScores

CLOSE curNames
DEALLOCATE curNames 
```

这是我得到的结果。请注意，对于外部循环，它确实显示了最新的 Fname，但是当该 Fname 用作 @Fname 以从辅助表中获取相关行以进行后续迭代时，它仍然会获得与第一个匹配的行主表的行 (Bob)。

```
Outer loop @Fname = Bob
    FK_Fname=Bob. Score=10
    FK_Fname=Bob. Score=15
Outer loop @Fname = Jim
    FK_Fname=Bob. Score=10
    FK_Fname=Bob. Score=15
Outer loop @Fname = Jo
    FK_Fname=Bob. Score=10
    FK_Fname=Bob. Score=15
Outer loop @Fname = Sam
    FK_Fname=Bob. Score=10
    FK_Fname=Bob. Score=15 
```

请让我知道我做错了什么。提前致谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T16:55:28.073

@fName 的值在 :DECLARE curScores CURSOR 中计算，而不是在主循环中。您必须在主循环中声明并释放第二个游标。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T19:45:02.210

由于一些提示，我能够找到解决方案。

我必须在第一个循环中声明和删除辅助游标。我最初讨厌这样做，因为我认为在循环中分配和释放资源不是一个好主意，但我认为在这种特殊情况下没有其他方法可以避免这种情况。现在工作代码看起来像这样：

```
SET NOCOUNT ON
DECLARE 
    @Fname varchar(50) -- to hold the fname column value from outer cursor loop
    ,@FK_Fname varchar(50) -- to hold the fname column value from inner cursor loop
    ,@score int
;

--prepare primary table to be iterated in the  outer loop
DECLARE @Names AS Table (Fname varchar(50))
INSERT @Names
    SELECT 'Jim' UNION
    SELECT 'Bob' UNION
    SELECT 'Sam' UNION
    SELECT 'Jo' 

--prepare secondary/detail table to be iterated in the inner loop
DECLARE @Scores AS Table (Fname varchar(50), Score int)
INSERT @Scores
    SELECT 'Jo',1 UNION
    SELECT 'Jo',5 UNION
    SELECT 'Jim',4 UNION
    SELECT 'Bob',10 UNION
    SELECT 'Bob',15 

--cursor to iterate on the primary table in the outer loop
DECLARE curNames CURSOR
FOR SELECT Fname FROM @Names

OPEN curNames
FETCH NEXT FROM curNames INTO @Fname

--cursor to iterate on the secondary table in the inner loop
DECLARE curScores CURSOR
FOR 
    SELECT FName,Score 
    FROM @Scores 
    WHERE Fname = @Fname 
 --*** NOTE: Using the primary table's column value @Fname from the outer loop

WHILE @@FETCH_STATUS = 0
BEGIN
    PRINT 'Outer loop @Fname = ' + @Fname

    OPEN curScores
    FETCH NEXT FROM curScores INTO @FK_Fname, @Score

    WHILE @@FETCH_STATUS = 0
    BEGIN
        PRINT ' FK_Fname=' + @FK_Fname + '. Score=' + STR(@Score)
        FETCH NEXT FROM curScores INTO @FK_Fname, @Score
    END
    CLOSE curScores
    FETCH NEXT FROM curNames INTO @Fname
END

DEALLOCATE curScores

CLOSE curNames
DEALLOCATE curNames 
```

我得到了正确的结果：

```
Outer loop @Fname = Bob
    FK_Fname=Bob. Score=        10
    FK_Fname=Bob. Score=        15
Outer loop @Fname = Jim
    FK_Fname=Jim. Score=         4
Outer loop @Fname = Jo
    FK_Fname=Jo. Score=         1
    FK_Fname=Jo. Score=         5
Outer loop @Fname = Sam 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T19:52:13.367

我认为使用具有行号的临时表可以更轻松地做到这一点：

```
create table #temp1
(
 row int identity(1,1)
 , ... 
) 
```

看起来您确实在要求 SQL 表现得像一种喜欢循环的语言。它没有。每当我发现自己在 SQL 中编写循环时，我都会问自己，是否必须这样做？7/10 次的答案是否定的，我可以用套装来代替。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T16:52:01.093

我会尝试放置

```
DECLARE curScores CURSOR
FOR 
    SELECT FName,Score 
    FROM @Scores 
    WHERE Fname = @Fname 
```

在第一时间内，因为您仅为名字值声明游标

# vb.net - VB.net（桌面）上下文菜单分配给多个控件所有者问题

> ID：244002
> 
> 赞同：2
> 
> 时间：2008-10-28T16:44:30.173
> 
> 标签：vb.net, controls, contextmenu

我在同一个表单上有两个不同的网格控件。它们共享相同的上下文菜单。当我选择上下文菜单项时，我无法确定哪个控件是所有者。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-28T17:20:55.667

ContextMenuStrip 类的 SourceControl 属性将显示导致显示该菜单条的最后一个控件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T16:56:20.710

MenuItem 的 Click 事件的事件处理程序将有一个 Sender 参数。该对象应该是显示上下文菜单时具有焦点的控件。

# php - 如何在同一台服务器上跨多个域维护 PHP 会话？

> ID：244008
> 
> 赞同：7
> 
> 时间：2008-10-28T16:46:53.850
> 
> 标签：php, mysql, session

我正在寻找一种在同一服务器上跨多个域维护 PHP 会话的方法。我将把我的网站与一个简单机器论坛集成，所以我需要使用基于 MySQL 的会话。谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-28T17:14:44.260

根据您修改 PHP 变量的首选方法（Apache 的配置，.htaccess），将 session.cookie_domain 值更改为一致的值。

我有多个子域，Apache 配置文件中的每个 VirtualHost 部分都包含以下行：

php_value session.cookie_domain mydomain.com

如果您在 .htaccess 文件中进行更改，语法应该类似。

更新了 bobert5064 的评论：

对于多个域（即domain1.com、domain2.org），我认为只需要选择一个通用域名（即domain1.com）即可。我从未尝试过这个，所以我无法验证它是否有效，但逻辑似乎是准确的。

在[http://us.php.net/manual/en/function.session-set-cookie-params.php](http://us.php.net/manual/en/function.session-set-cookie-params.php)中还描述了一种在 PHP 中设置变量方向的方法。该文档没有提及在不同域上设置 cookie 的能力或不能力。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T18:41:15.100

如果一个站点要转发或链接到第二个站点，它可以在链接的*href*中包含会话 ID 或作为表单中的*输入*。类似于 George 的*img 标签*方法，但会话仅在需要时才会移动。

哪个最好取决于您网站的使用模式。

# ruby-on-rails - 如何使用 RSpec 在对象上添加多个 should_receive 期望？

> ID：244009
> 
> 赞同：33
> 
> 时间：2008-10-28T16:47:16.173
> 
> 标签：ruby-on-rails, rspec

在我的 Rails 控制器中，我正在创建同一个模型类的多个实例。我想添加一些 RSpec 期望，以便我可以测试它是否使用正确的参数创建了正确的数字。所以，这就是我的规范中的内容：

```
Bandmate.should_receive(:create).with(:band_id => @band.id, :user_id => @user.id, :position_id => 1, :is_leader => true)
Bandmate.should_receive(:create).with(:band_id => @band.id, :user_id => "2222", :position_id => 2)
Bandmate.should_receive(:create).with(:band_id => @band.id, :user_id => "3333", :position_id => 3)
Bandmate.should_receive(:create).with(:band_id => @band.id, :user_id => "4444", :position_id => 4)

```

这会引起问题，因为似乎 Bandmate 类只能设置 1 个“should_receive”期望值。因此，当我运行示例时，出现以下错误：

```
Spec::Mocks::MockExpectationError 中的“BandsController 应在创建时创建所有乐队成员”
模拟 'Class' 预期：使用 ({:band_id=>1014, :user_id=>999, :position_id=>1, :is_leader=>true}) 创建但使用 ({:band_id=>1014, :user_id= >"2222", :position_id=>"2"})

```

这些是第二次调用 create 的正确参数，但 RSpec 正在针对错误的参数进行测试。

有谁知道我如何设置我的 should_receive 期望以允许多个不同的调用？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-10-29T23:05:36.393

多重期望根本不是问题。鉴于您对无序期望的特定参数，您遇到的是订购问题。查看[此页面](http://rspec.info/documentation/3.3/rspec-mocks/#Ordering)以了解有关订购预期的详细信息。

简短的故事是，您应该`.ordered`在每个期望的末尾添加。

* * *

## 回答 #2

> 赞同：-3
> 
> 时间：2011-03-03T09:20:02.983

[模拟接收计数](http://rspec.rubyforge.org/rspec/1.1.9/classes/Spec/Mocks.html)

my_mock.should_receive(:sym).once
my_mock.should_receive(:sym).twice
my_mock.should_receive(:sym).exactly(n)
.times my_mock.should_receive(:sym).at_least(:once)
my_mock.should_receive(: sym).at_least(:twice)
my_mock.should_receive(:sym).at_least(n)
.times my_mock.should_receive(:sym).at_most(:once)
my_mock.should_receive(:sym).at_most(:twice)
my_mock。 should_receive(:sym).at_most(n)
.times my_mock.should_receive(:sym).any_number_of_times

也适用于 rspec 2.5。

# flash - ExternalInterface 性能：寻找一些最佳实践/技巧

> ID：244018
> 
> 赞同：3
> 
> 时间：2008-10-28T16:49:57.167
> 
> 标签：flash, actionscript

我在 Windows 应用程序的 UI 中使用 Flex 3（Flash 播放器作为嵌入式 ActiveX 控件），并使用 ExternalInterface 在它们之间传递数据（主要是进入 Flex 应用程序，而不是输出）。但是，我发现性能非常糟糕，尤其是对于较大的（即自定义）对象。我们进行的 EI 调用越多，传入的自定义对象越大，在性能方面似乎就越难下降。

我假设序列化这些对象有很多开销，所以我想知道，是否有任何最佳实践可以以这种特殊方式使用 ExternalInterface？关于这个主题的文档似乎还没有太多。

例如，将一大块 XML 作为字符串传递到播放器控件，并使用 Flex 解析它，而不是按照规则将其作为自定义对象传递是否更好？需要与其宿主应用程序相对紧密集成的 Flex 应用程序应如何在不牺牲性能的情况下最好地使用 ExternalInterface？EI 性能是 Adob​​e 正在解决的问题吗？播放器 9 和 10 之间的实现有何不同？为了充分利用此功能，我们应该避免哪些事情？

提前致谢！

克里斯

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-10T14:03:17.100

只是为了与任何可能感兴趣的人分享答案，Adobe 的非官方答案（在上个月的 MAX 会议上由一些 Adob​​e 工程师确认）是，通过 ExternalInterface 封送超过 30KB 左右的数据将导致性能下降. 少量数据，没问题——但更大的块，无论类型如何，等等，都会大大减慢速度。

显然这是一个已知问题，不幸的是，Flash 10 似乎并没有提供太多改进。因此，与此同时，一个可行的解决方案是使用 ExternalInterface 处理小事，而将繁重的工作留给 URLLoader 和 XML 或 JSON 解析器。希望对您有所帮助——如果有人遇到此问题并需要更详细的指导，请随时直接与我联系。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-02T13:40:53.223

布拉德纽伯格似乎付出了很多努力来解决这个问题。他在

[http://codinginparadise.org/weblog/2006/02/how-to-speed-up-flash-8s.html](http://codinginparadise.org/weblog/2006/02/how-to-speed-up-flash-8s.html)

# c# - 通过 SSL 的 HttpWebRequest？

> ID：244019
> 
> 赞同：3
> 
> 时间：2008-10-28T16:50:59.473
> 
> 标签：c#, .net, httpwebrequest

我以前使用 HttpWebRequests 将数据发布到 HTTPS 网站，而且我从来没有做任何与常规 HTTP Post 不同的事情。

有谁知道我是否错过了任何技巧以确保正确完成？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T17:09:00.700

经过一番搜索，如果证书有效，您似乎无需执行任何操作。

如果您想自己检查证书，可以这样做：

```
System.Net.ServicePointManager.ServerCertificateValidationCallback +=
    delegate(object sender, System.Security.Cryptography.X509Certificates.X509Certificate certificate,
                            System.Security.Cryptography.X509Certificates.X509Chain chain,
                            System.Net.Security.SslPolicyErrors sslPolicyErrors)
        {
            return true; // **** Always accept
        }; 
```

上述代码来自[Rick Stralhs](http://www.west-wind.com/weblog/posts/48909.aspx)博客上的评论，将强制始终接受客户端证书。

您还可以在该委托中验证证书。

很酷的东西！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T17:08:26.300

检查认证错误，这是常见问题 [http://www.west-wind.com/weblog/posts/48909.aspx](http://www.west-wind.com/weblog/posts/48909.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T17:12:31.863

我认为 https 是一个托管问题，您必须使用您的证书（或证书链）配置密钥库，设置您的 ssl/tls，映射您的 dns 设置（也为 http 完成）并继续。我看不出会话/传输层问题会影响应用程序的任何原因。

然而，我有一个实例，我们必须检测到智能卡被移除并关闭会话。为此，我们必须检查每个请求的 SSO 令牌并检查其有效性。这更多地与架构的智能卡方面有关，而不是 https。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T17:00:56.863

HTTPS 请求与 HTTP 相同（仅使用 SSL 证书）。

但是，您应该手动确保证书没有错误（甚至警告），否则请求可能会失败。

# sql-server - SqlDateTime 溢出异常

> ID：244029
> 
> 赞同：1
> 
> 时间：2008-10-28T16:52:31.607
> 
> 标签：sql-server, vb.net

我正在尝试插入仅时间值，但出现以下错误

> *   ex {“SqlDateTime 溢出。必须在 1/1/1753 12:00:00 AM 和 12/31/9999 11:59:59 PM 之间。”} System.Exception

从前端，使用“TimeEdit”控件选择时间，带有向上和向下箭头。SQL Server 中的表具有设置为 smalldatetime 的字段。我只需要存储时间。我使用以下内容将数据返回到应用程序

select id,CONVERT(CHAR(5),timeFrom,8) as timeFrom,CONVERT(CHAR(5),timeTo,8) as timeTo FROM dbo.Availability where id = @id and dayName = @weekday

我如何只在餐桌上打发时间？

编辑〜解决方案根据 Euardo 和 Chris，我的解决方案是传递一个日期时间字符串而不是仅时间字符串。我使用“g”按照[时间格式格式化了我的结果。](http://msdn.microsoft.com/en-us/library/az4se3k1(VS.71).aspx)

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-28T17:01:10.857

您可以将日期设置为 1/1/1753，这是 MSSQL 中 datetime 的日期最小值，然后添加要存储的小时。当然，每次需要获取值时都必须考虑这一点，但你可以用一些助手来包装它。或者您可以使用 MSSQL 2008 并使用新的 TIME 数据类型。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T16:58:52.157

选择一个在范围内的日期（即 1970 年 1 月 1 日）并将其用于您插入的所有内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T17:12:10.287

如果您只跟踪时间，请考虑将其存储在 int 中，作为您需要的任何粒度（秒、分钟、小时……）从午夜开始的偏移量。然后，您可以使用适当的 TimeSpan.From??() 方法将其转换为代码中的 TimeSpan。反过来，你可以使用 TimeSpan.Total?? 并在需要时截断。如果您需要进行手动查询，您可以编写一个 SQL 函数，将小时/分钟/秒转换为等效的偏移量。

我更喜欢使用日期时间并选择任意日期，因为它使字段的目的更清晰，从而减少了混乱。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-28T16:55:54.313

SQL中没有时间之类的东西，只有日期时间。

为了您的目的，我会使用这样的东西来只返回时间部分。

```
SELECT (GETDATE() - (CAST(FLOOR(CAST(GETDATE() as FLOAT)) AS DateTime))) 
```

其中 GETDATE() 是您要过滤的日期时间。

在数据库中设置时间时，您必须在时间中添加“01/01/1901”或“01/01/1753”。

使用 datetime 时不要使用 CAST 和 Convert to varchar，它很慢。坚持浮动数值运算。

# regex - 编写正则表达式

> ID：244034
> 
> 赞同：1
> 
> 时间：2008-10-28T16:53:34.023
> 
> 标签：regex

想写一个正则表达式来验证驾驶执照。

如果它不以 (US, CA, CN) 开头，那么它必须跟在 XX 之后，然后跟任意数量的 Alpha 数字字母。

因此，例如，如果驾驶执照以 GB 开头，那么它必须跟 XX GBXX12345363 但是如果它以 US 开头，那么我们不在乎它后面是什么。USLA039247230

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-28T17:04:12.050

请记住，并非每个人都熟悉该驾驶执照符号，我假设以下是精确的规范（在要求正则表达式时您应该非常精确，否则您会得到您不想要的东西）：

*   必须以两个大写字母开头
*   如果前两个字母是 US、CA 或 CN，则其余字母必须是字母数字且长度未指定
*   如果前两个字母不是 US、CA 或 CN，那么接下来的两个字母必须是 X，之后的其余字母必须是字母数字且长度未指定

    ((US|CA|CN)[A-Za-z0-9]+|(?<!(US|CA|CN))[AZ]{2}XX[A-Za-z0-9]+)

第一部分：

*   匹配 US、CA 或 CN 之一
*   一个或多个字母数字字符

第二部分：

*   负向后看，不以 US CA CN 开头
*   有两个大写字母
*   有两个 X 字符
*   一个或多个字母数字字符

它匹配第一部分或第二部分

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T16:58:26.727

```
/^(?:(?:US|CA|CN)\w+|[[:alpha:]]{2}XX\w+)$/ 
```

我不确定是否可以进行更多验证，但这是我从您写的内容中得到的，而不是您的示例（这似乎意味着四个字母后跟数字）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T17:02:49.947

如果您的正则表达式库允许，您可以使用[Look Behind](http://www.regular-expressions.info/lookaround.html)功能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T17:11:19.773

```
/^((US|CA|CN)[a-zA-Z\d]*|[a-zA-Z]{2}XX[a-zA-Z\d]*)$/ 
```

# javascript - 如何为不可见的 HTML 元素定义访问键

> ID：244063
> 
> 赞同：0
> 
> 时间：2008-10-28T17:04:02.097
> 
> 标签：javascript, html, css, firefox

我有一个`<button>`分配给它的访问密钥。只要按钮可见，accesskey 就可以正常工作，但是当我设置`display: none`or时`visibility: hidden`，accesskey 不再起作用。

也试过没有成功：

*   使用不同的元素类型：a，输入（各种类型，甚至无类型）。
*   将 accesskey 分配给包装不可见控件的标签。

请注意，我不确定这是否是标准行为，但在 Firefox 3 之前，无论可见性如何，accesskey 似乎都有效。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-28T19:34:37.753

您看到的行为是正确的，您无法“访问”未显示的元素。Sal 的建议几乎肯定会奏效，但请问您这样做的目的是什么？可能有更好的方法来完成您想要实现的目标。您是否考虑过使用按键处理程序？

如果您不想要按键处理程序，我认为您可能想要使用其他建议。尝试位置：绝对；左：-9999px；将您的内容拉出页面。或者使用绝对位置，将不透明度更改为零，将 z-index 更改为 -1。通过使用绝对位置元素不会影响页面上其他内容的定位，设置不透明度将使其不可见。即使不透明度设置为零，您仍然可以单击该元素，尽管您看不到它，但它可能会阻止您单击页面的其他元素，因此请使用负 z-index 将其拉到其他内容后面。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T17:50:16.887

您可以应用负边距将元素推到可见页面之外。我认为许多浏览器和文本阅读器会忽略`display:none`带有`visibility:hidden`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-05-23T10:23:57.783

最简单的解决方案：`height: 0px; margin: 0px; padding: 0px;`在您的 CSS 中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T04:52:06.333

将按钮放置在页面之外，而不是可见性或显示属性

```
<button accesskey="a" style="position: absolute; top: -9999px">button</button> 
```

警告：在 ie7 中使用 left 而不是 top 会导致奇怪的显示错误

# asp.net - ASP.NET 会话范围：可以从哪里访问它？

> ID：244084
> 
> 赞同：2
> 
> 时间：2008-10-28T17:08:15.413
> 
> 标签：asp.net, session, iis, iis-6

这似乎微不足道，但我以前从来没有担心过，而且我的谷歌技能让我失望了。**ASP.NET/IIS6的进程内**会话存储桶的影响有多大，从某种意义上说，您可以调用 Session["whatever"] 并返回相同的值？显然它不能跨越不同的服务器或应用程序池（我认为）。同一个应用程序池中的不同网站呢？这两个可以看到对方的用户会话变量吗？两个不同的虚拟目录都有自己的 web.config 呢？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T10:36:37.293

AFAIK**进程**内会话具有 AppDomain 范围，因此不，在同一个池中运行的两个 Web 应用程序不能共享进程内会话。实际上，名称“in-AppDomain”会更合适。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T17:11:32.690

> 显然它不能跨越不同的服务器

你当然可以。 [此 MSDN 文章](http://msdn.microsoft.com/en-us/library/ms178586.aspx)有更多详细信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T17:12:20.863

如果 asp.net 会话存储在数据库中，它可以跨越服务器场中的服务器。

出于安全原因，会话范围严格在一个应用程序域内

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T17:38:17.990

听起来您最好存储数据库值而不是将其存储在 In-Proc session[""] 中。如果您有状态服务器，则可以在使用相同状态服务器的所有机器上访问会话。In-Proc 就是它所说的。它存储在那台计算机的进程中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T19:58:36.847

如果您想在具有 SQL Server 后端的应用程序之间共享 Session，有[一篇文章](http://blogs.msdn.com/toddca/archive/2007/01/25/sharing-asp-net-session-state-across-applications.aspx)介绍了如何做到这一点。

# delphi - 为什么会出现“本地常量太多”错误？

> ID：244085
> 
> 赞同：5
> 
> 时间：2008-10-28T17:08:18.237
> 
> 标签：delphi, delphi-2009, advantage-database-server

Delphi 2009 抱怨 E2283 错误：[DCC Error] outputcode.pas(466): E2283 Too many local constants。使用更短的程序

Delphi 2007 编译得很好。我找不到大量的局部常量，它是一个很短的（500 行）单位。您是否看到我可以处理的大量常量或文字？

```
procedure TOutputCodeForm.FormCreate(Sender: TObject);
var
   poParser : TStringStream;
begin

   if ( IsWindowsVista() )  then
   begin
      SetVistaFonts( self );
   end;

   poParser := TStringStream.Create( gstrSQLParser );

   SQLParser := TSyntaxMemoParser.Create( self );
   SQLParser.RegistryKey := '\Software\Advantage Data Architect\SQLSyntaxMemo';
   SQLParser.UseRegistry := True;
   SQLParser.CompileFromStream( poParser );

   FreeAndNil( poParser );
   poParser := TStringStream.Create( gstrCPPParser );

   cppParser := TSyntaxMemoParser.Create( self );
   cppParser.RegistryKey := '\Software\Advantage Data Architect\SQLSyntaxMemo';
   cppParser.UseRegistry := True;
   cppParser.CompileFromStream( poParser );

   FreeAndNil( poParser );
   poParser := TStringStream.Create( gstrPasParser );

   pasParser := TSyntaxMemoParser.Create( self );
   pasParser.RegistryKey := '\Software\Advantage Data Architect\SQLSyntaxMemo';
   pasParser.Script := ExtractFilePath( Application.ExeName ) + 'pasScript.txt';
   pasParser.CompileFromStream( poParser );

   {* Free the stream since we are finished with it. *}
   FreeAndNil( poParser );

   poCodeOutput := TSyntaxMemo.Create( self );
   poCodeOutput.Parent := Panel1;
   poCodeOutput.Left := 8;
   poCodeOutput.Top := 8;
   poCodeOutput.Width := Panel1.Width - 16;
   poCodeOutput.Height := Panel1.Height - 16;
   poCodeOutput.ClipCopyFormats := [smTEXT, smRTF];
   poCodeOutput.Font.Charset := ANSI_CHARSET;
   poCodeOutput.Font.Color := clWindowText;
   poCodeOutput.Font.Height := -11;
   poCodeOutput.Font.Name := 'Courier New';
   poCodeOutput.Font.Style := [];
   poCodeOutput.GutterFont.Charset := DEFAULT_CHARSET;
   poCodeOutput.GutterFont.Color := clWindowText;
   poCodeOutput.GutterFont.Height := -11;
   poCodeOutput.GutterFont.Name := 'MS Sans Serif';
   poCodeOutput.GutterFont.Style := [];
   poCodeOutput.HyperCursor := crDefault;
   poCodeOutput.IndentStep := 1;
   poCodeOutput.Margin := 2;
   poCodeOutput.Modified := False;
   poCodeOutput.MonoPrint := True;
   poCodeOutput.Options := [smoSyntaxHighlight, smoPrintWrap, smoPrintLineNos, smoPrintFilename, smoPrintDate, smoPrintPageNos, smoAutoIndent, smoTabToColumn, smoWordSelect, smoShowRMargin, smoShowGutter, smoShowWrapColumn, smoTitleAsFilename, smoProcessDroppedFiles, smoBlockOverwriteCursor, smoShowWrapGlyph, smoColumnTrack, smoUseTAB, smoSmartFill, smoOLEDragSource];
   poCodeOutput.ReadOnly := False;
   poCodeOutput.RightMargin := 80;
   poCodeOutput.SaveFormat := sfTEXT;
   poCodeOutput.ScrollBars := ssBoth;
   poCodeOutput.SelLineStyle := lsCRLF;
   poCodeOutput.SelStart := 3;
   poCodeOutput.SelLength := 0;
   poCodeOutput.SelTextColor := clWhite;
   poCodeOutput.SelTextBack := clBlack;
   poCodeOutput.TabDefault := 4;
   poCodeOutput.TabOrder := 0;
   poCodeOutput.VisiblePropEdPages := [ppOPTIONS, ppHIGHLIGHTING, ppKEYS, ppAUTOCORRECT, ppTEMPLATES];
   poCodeOutput.WrapAtColumn := 0;
   poCodeOutput.OnKeyDown := FormKeyDown;
   poCodeOutput.ActiveParser := 3;
   poCodeOutput.Anchors := [akLeft, akTop, akRight, akBottom];
   poCodeOutput.Parser1 := pasParser;
   poCodeOutput.Parser2 := cppParser;
   poCodeOutput.Parser3 := SQLParser;

   SQLParser.AttachEditor( poCodeOutput );
   cppParser.AttachEditor( poCodeOutput );
   pasParser.AttachEditor( poCodeOutput );

   poCodeOutput.Lines.AddStrings( poCode );

   if ( CodeType = ctCPP ) then
      poCodeOutput.ActiveParser := 2
   else if ( CodeType = ctPascal ) then
      poCodeOutput.ActiveParser := 1
   else
      poCodeOutput.ActiveParser := 3;

   MainForm.AdjustFormSize( self, 0.95, 0.75 );
end; 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-28T20:19:07.023

在声称这是一个编译器错误或寻求帮助之前，我会认真地尝试组织和清理我的代码。

我会为 FormCreate 中的每个部分创建专门的例程，而不是你的这个大包。- SQLParseInit
- cppParseInit
- pasParseInit
- CodeOutPutInit <-+++++ 那里有很多常量

并查看 1 是否特别引起问题。

构建一个最小的案例也不错，尽可能少的 3rd 方依赖项，以允许其他人重现它，并查看它是否确实是一个错误或只是糟糕的代码。
并删除那些 $IFDEF... 只需提供导致此行为的实际代码，而不会造成混乱。

补充：由于它在 D2007 中有效，但在 D2009 中无效，我还将仔细检查您在代码中包含的所有库/第 3 方组件是否已正确迁移到 D2009。（向下钻取那个 cppParser）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-28T17:13:59.050

是否定义了 Win32，常量是否来自所有包含的单元。

我会做一个二分搜索：一直撕掉一半的单元，直到它编译，然后重新添加东西。

是的，这很糟糕，但这是尝试调试 BorlandCodeGaembarcadero 的内部编译器错误的功能之一。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-08T04:13:24.033

I'd look at the line of "poCodeOutput.Options := [xx....]" Looks like too many options in the set on one line of code.

Take that one line out and see if you get the error.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T19:20:20.920

我已经找到了问题所在的方法（FormCreate）并且一直在重构，但是无论我制作的块有多小，编译器仍然存在问题，除非我删除了一些代码。

François 谢谢，但我确实重构了代码，但仍然得到错误。如果它是用 D2007 构建的，而不是用 D2009 构建的，那对我来说似乎很可疑。

```
procedure TOutputCodeForm.FormCreate(Sender: TObject);
begin

   if ( IsWindowsVista() )  then
   begin
      SetVistaFonts( self );
   end;

   SetupParser( SQLParser, gstrSQLParser, '' );
   // unresolved jmu - have to comment this out for now or delphi will complain
   // that there are too many literals in this file. Seems like a delphi bug
   // since this builds in older versions, and I've already refactored it.
   //SetupParser( cppParser, gstrCPPParser, '' );
   SetupParser( pasParser, gstrPasParser, ExtractFilePath( Application.ExeName ) + 'pasScript.txt' );
   SetupCodeOutput( poCodeOutput );

   SQLParser.AttachEditor( poCodeOutput );
   cppParser.AttachEditor( poCodeOutput );
   pasParser.AttachEditor( poCodeOutput );

   poCodeOutput.Lines.AddStrings( poCode );

   if ( CodeType = ctCPP ) then
      poCodeOutput.ActiveParser := 2
   else if ( CodeType = ctPascal ) then
      poCodeOutput.ActiveParser := 1
   else
      poCodeOutput.ActiveParser := 3;

   MainForm.AdjustFormSize( self, 0.95, 0.75 );
end; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T09:21:42.250

鉴于问题仅发生在您的一个 Delphi 编译器/设置中，我发现自己想知道它是否与组件安装问题有关。您是否尝试过创建一个基本表单，该表单使用您动态创建的所有组件的静态版本？（TSyntaxMemoParser 等）。

（您是否在不同的机器/VM 的 btw 上运行这些 Delphi 版本？如果您使用许多第三方组件和多个版本的 Delphi，可以节省很多麻烦）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-31T22:35:27.370

从帮助：

> 您的一个或多个过程包含太多字符串常量表达式，以至于超出了编译器的内部存储限制。这可能发生在自动生成的代码中。要解决此问题，您可以缩短过程或声明持续标识符，而不是在代码中使用如此多的文字。

因此，也许可以尝试将其中一些字符串放在 const 或其他变量（非本地）中。

# sql - 在不建立索引的情况下提高 oracle 查询性能

> ID：244087
> 
> 赞同：7
> 
> 时间：2008-10-28T17:08:46.427
> 
> 标签：sql, performance, oracle

在不创建索引的情况下，我可以做些什么来提高 oracle 查询的查询性能？

这是我试图运行得更快的查询：

```
SELECT c.ClaimNumber, a.ItemDate, c.DTN, b.FilePath
FROM items a,
itempages b,
keygroupdata c
WHERE a.ItemType IN (112,115,189,241)
AND a.ItemNum = b.ItemNum
AND b.ItemNum = c.ItemNum
ORDER BY a.DateStored DESC 
```

这些列都没有索引，每个表都包含数百万条记录。不用说，执行查询需要 3 分半钟。这是生产环境中的第三方数据库，我不允许创建任何索引，因此必须对查询本身进行任何性能改进。

谢谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-28T17:46:14.617

要求第三方为其连接列编制索引，因为他们一开始就应该这样做！没有索引，甲骨文除了蛮力之外别无他法。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-28T17:23:22.027

首先，我将查询重写为 ANSI 标准：

```
SELECT c.ClaimNumber, a.ItemDate, c.DTN, b.FilePath
FROM items a
INNER JOIN itempages b ON b.ItemNum = a.ItemNum
INNER JOIN keygroupdata c ON c.ItemNum = b.ItemNum
WHERE a.ItemType IN (112,115,189,241)
ORDER BY a.DateStored DESC 
```

这使得阅读和理解正在发生的事情变得更容易。它还可以帮助您不犯可能导致真正大问题的错误（即交叉连接）。然后我会得到解释计划，看看 DBMS 对那个查询做了什么。它是否试图使用一些索引？是否正确加入表格？

然后我会查看我正在使用的表，看看是否有任何已经存在的索引可以用来加快查询速度。最后，正如其他人所建议的那样，我将删除 Order By 子句并在代码中执行此操作。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-28T17:58:19.290

您可能想尝试在这些表中的任何一个上创建物化视图。然后，您可以在物化视图上创建一个索引，这将有助于加快查询速度（然后查询物化视图而不是原始表）。

当然，如果您的基础表已更新，您的视图和索引也需要刷新。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-28T18:19:42.897

首先，看执行计划。它是否准确反映了查询执行的每个阶段要检索的行数？谓词“a.ItemType IN (112,115,189,241)”的选择性如何？执行计划是否显示任何临时磁盘空间用于连接或排序？

实际上，也许您可​​以修改问题以包含执行计划。

还要确保您没有禁用哈希连接，这在 OLTP 调整的系统中有时会出现这种情况，因为它们是在 Oracle 中等值连接批量数据的最有效方式。他们应该出现在执行计划中。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-28T18:26:11.090

您可以在加入表格之前尝试过滤项目类型，如此处所示。

如果您在 9i 之前的 Oracle 上运行，这有时会带来意想不到的好处。

```
select 
  c.claimnumber,
  a.itemdate, 
  c.dtn,
  b.filepath
from 
  (
  select itemdate
  from items it
  where it.itemtype in(112,115,189,241)
  ) a
  itempages b,
  keygroupdata c
where a.itemnum = b.itemnum
  and b.itemnum = c.itemnum 
```

您也可以尝试添加提示 / *+RULE* / 或 / *+ORDERED* / 以查看会发生什么......再次，特别是对于旧版本，这些有时会产生令人惊讶的结果。

```
SELECT /*+RULE*/
  c.ClaimNumber, a.ItemDate, c.DTN, b.FilePath
FROM
  items a,
  itempages b,
  keygroupdata c
WHERE a.ItemType IN (112,115,189,241)
  AND a.ItemNum = b.ItemNum
  AND b.ItemNum = c.ItemNum
ORDER BY a.DateStored DESC 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-28T18:07:29.037

如果查询输入是恒定的或可预测的（`itemType IN (...)`即

然后，您可以使代价高昂的查询“离线”，并为交互式查询获得更快/更好的结果。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-28T18:49:10.513

这是您经常运行的查询吗？创建加快此查询所需的索引似乎符合数据库所有者的利益。您花在运行查询上的 3.5 分钟肯定会对他们的生产环境产生一些影响！

另外，他们是否一直在对表运行更新统计信息？这可能会提高性能，因为连接顺序是根据表的统计信息计算的。

顺便说一句，你可以做什么？刚读？如果您可以创建临时表并在其上放置索引，我可能会考虑制作表的临时副本，为这些表建立索引，然后使用临时副本进行索引辅助连接。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-11-09T21:20:31.313

我知道这个线程已经很老了，但是对于搜索引擎，我仍然想提供一个可以在 oracle 上运行的替代解决方案，并且取决于数据可能会更快。

```
with a as (
  select 
    * 
  from 
    items 
  where 
    ItemType IN (112,115,189,241)
)
SELECT 
  c.ClaimNumber
  , a.ItemDate
  , c.DTN, b.FilePath
FROM 
  a,
  itempages b,
  keygroupdata c
WHERE 
  a.ItemNum = b.ItemNum
  AND b.ItemNum = c.ItemNum
ORDER BY 
  a.DateStored DESC 
```

您也可以尝试从句`/*+ MATERIALIZE */`中的提示。`WITH`

实际上我发现 oracle 的旧连接语法比 ansi sql 更容易阅读 ^^

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-28T17:13:19.507

如果没有索引，该查询只会随着表大小的增加而变得更糟。话虽如此，请尝试删除 order by 子句并在客户端进行排序。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-28T18:31:10.423

是否在这些表上收集了统计信息？如果不是这样，收集统计数据可能会改变执行计划，尽管它不一定会变得更好。

除此之外，看看执行计划。您可能会看到它以非最佳顺序加入表（例如，它可能在加入具有过滤条件的 a 之前加入 b 和 c）。

您可以使用提示来尝试影响访问路径、连接顺序或连接方法。

**更新**：回复评论让我看到了[这个](http://www.oaktable.net/getFile/117)演示文稿，这可能会有所帮助或至少很有趣。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-28T21:57:56.653

有时，您可以通过在 where 子句中添加看似冗余的元素来添加额外的路径供优化器选择，从而获得好处。

例如，您有 A.ItemNum = B.ItemNum 和 B.ItemNum = C.ItemNum。也尝试添加 A.ItemNum = C.ItemNum。但是，我很确定优化器足够聪明，可以自己解决这个问题——不过值得一试。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-29T13:06:36.150

根据 ItemType 列的数据类型，如果它是 varchar，您可能会体验到更快的执行速度，Oracle 将执行隐式转换。

```
SELECT c.ClaimNumber, a.ItemDate, c.DTN, b.FilePath
FROM items a,
itempages b,
keygroupdata c
WHERE ((a.ItemType IN ('112','115','189','241'))
AND (a.ItemNum = b.ItemNum)
AND (b.ItemNum = c.ItemNum))
ORDER BY a.DateStored DESC 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-08T09:26:40.593

如果您说没有索引，那么这是否也意味着没有定义主键或外键？显然分析表和收集统计数据很重要，但是如果不存在诸如定义表应该如何连接的元数据，那么 Oracle 很可能会选择一个糟糕的执行路径。

在这种情况下，使用诸如 /*+ ORDERED */ 之类的提示很可能是使优化器可靠地选择良好执行路径的唯一选项。也可能值得添加外键和主键，但将它们定义为 DISABLE 和 VALIDATE。

我猜这个评论的有用性取决于对索引的厌恶程度如此之高。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-10-13T08:56:21.500

首先在这个查询上创建一个视图，然后从这个视图生成一个表。还要在日期上创建一个索引，创建一个作业并将其安排在系统空闲的午夜时间。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-11-16T11:42:22.573

好吧，既然你不能创建索引，我会确保统计信息都是最新的，然后我会这样重写查询：

`with a as (select /*+ MATERIALIZE */ ItemType, ItemNum, DateStored, ItemDate from items where ItemType in (112,115,189,241)) SELECT c.ClaimNumber, a.ItemDate, c.DTN, b.FilePath FROM a, itempages b, keygroupdata c WHERE a.ItemNum = b.ItemNum AND b.ItemNum = c.ItemNum ORDER BY a.DateStored DESC`

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2008-10-28T17:13:16.150

删除 ORDER BY

在将行拉回应用程序后执行排序。

# ivr - 录音返回 - 语音消息太短

> ID：244091
> 
> 赞同：1
> 
> 时间：2008-10-28T17:09:54.333
> 
> 标签：ivr

我有一个记录呼叫者讲话的电子劳动力 (EWF) 应用程序。系统需要录制 120 秒，然后播放消息并挂断。我设置的最大长度为 120 秒，最小长度为 1 秒。我不希望任何输入破坏录音，所以我检查了“丢弃早期用户输入”、“音调输入停止录音”（使用停止录音的键 =“”）和“丢弃键”。

我还在 cta.cfg 文件中添加了“VCE.RECORD.beeptime = 0”，以在录制前删除哔声。在 cta 文件中，我还添加了“VCE.RECORD.gain = 2”以增加录音的音量，并添加了“VCE.RECORD.silencetime = 120000”，如果用户没有说任何话，则最多允许 120 秒的静音被记录下来。

这些设置在我的测试中都运行良好，因为我能够获得短于 120 秒的文件的唯一方法是提前挂断。既然我们已经上线了，客户似乎已经找到了一种方法来获取一个持续 5 秒长的文件。我们每天大约有 120 条录音，每天大约 10 条正好是 5 秒长。返回的异常是“Voice Msg Too Short”。

我的问题是这是怎么发生的，我能做些什么（如果有的话）来防止它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T20:33:05.513

Edify/Intervoice/Convergys 客户论坛上的用户 -BMM- 给了我一个很好的答案。有两种设置可能导致录制步骤超时并出现 Voice Msg Too Short 错误，如下所示...

```
VCE.RECORD.novoicetime = 0
VCE.RECORD.silencetime = 0 
```

该值以秒为单位，但零会完全禁用超时，以便声音开始时的静音和结束时的静音不会导致引发异常。

# php - 使用 Spreadsheet_Excel_Writer 创建 Excel 文件时出现奇怪的错误

> ID：244110
> 
> 赞同：3
> 
> 时间：2008-10-28T17:14:08.910
> 
> 标签：php, export-to-excel, pear

这是代码。没什么。

```
<?php
include("Spreadsheet/Excel/Writer.php");

$xls = new Spreadsheet_Excel_Writer();

$sheet = $xls->addWorksheet('At a Glance');

$colNames = array('Foo', 'Bar');
$sheet->writeRow(0, 0, $colNames, $colHeadingFormat);

for($i=1; $i<=10; $i++)
{
    $row = array( "foo $i", "bar $i");

    $sheet->writeRow($rowNumber++, 0, $row);
}

header ("Expires: " . gmdate("D,d M Y H:i:s") . " GMT");
header ("Last-Modified: " . gmdate("D,d M Y H:i:s") . " GMT");
header ("Cache-Control: no-cache, must-revalidate");
header ("Pragma: no-cache");
$xls->send("test.xls");
$xls->close();
?> 
```

问题是当我实际使用 Excel 打开文件时出现以下错误：

```
File error:  data may have been lost. 
```

更奇怪的是，尽管有错误，但文件似乎很好。我碰巧写的任何数据都在那里。

关于如何摆脱这个错误的任何想法？

* * *

### 编辑

我修改了代码示例以更好地说明问题。我不认为第一个样本是合法的测试。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-28T18:54:01.267

问题中的代码有一个导致错误的错误。

这一行将一堆列名写入第 0 行

```
$sheet->writeRow(0, 0, $colNames, $colHeadingFormat); 
```

然后我们有应该写出值行的循环。

```
for($i=1; $i<=10; $i++)
{
    $row = array( "foo $i", "bar $i");

    $sheet->writeRow($rowNumber++, 0, $row);
} 
```

问题是**$rowNumber**没有在任何地方声明，所以它在第一次通过循环时覆盖了第 0 行。

这种覆盖似乎会导致 Excel Writer 出现问题。

奇怪的是，在给出错误的 Excel 文件中，您仍然可以看到带有列名的行，即使它在技术上已被覆盖。

我[在 Google Groups 上](http://groups.google.com/group/spreadsheet-writeexcel/browse_thread/thread/6656856820b6f799/)找到了解决方案。向下滚动到底部。这是**Micah**最后一篇提到这个问题的帖子。

* * *

这是修复

```
<?php
include("Spreadsheet/Excel/Writer.php");

$xls = new Spreadsheet_Excel_Writer();

$rowNumber = 0;
$sheet = $xls->addWorksheet('At a Glance');

$colNames = array('Foo', 'Bar');
$sheet->writeRow($rowNumber, 0, $colNames, $colHeadingFormat);

for($i=1; $i<=10; $i++)
{
    $rowNumber++;
    $row = array( "foo $i", "bar $i");

    $sheet->writeRow($rowNumber, 0, $row);
}

header ("Expires: " . gmdate("D,d M Y H:i:s") . " GMT");
header ("Last-Modified: " . gmdate("D,d M Y H:i:s") . " GMT");
header ("Cache-Control: no-cache, must-revalidate");
header ("Pragma: no-cache");
$xls->send("test.xls");
$xls->close();
?> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-03T10:58:04.590

正如 Mark Biek 指出的那样，主要问题是`$rowNumber`未初始化，因此会覆盖第 0 行。

这意味着生成的 Excel 文件将包含单元格 A1 和 B1 的 2 个数据条目（0, 0 和 0, 1）。

这在 Office Service Pack 3 之前不是问题。但是，一旦安装了 SP3，如果 Excel 遇到单元格的重复条目，它将引发“数据可能已丢失”的警告。

一般的解决方案是不要向一个单元格写入多个数据。:-)

这是对该问题的更[详细说明](http://groups.google.com/group/spreadsheet-writeexcel/browse_thread/thread/3dcea40e6620af3a)。它与 Perl [Spreadsheet::WriteExcel](http://search.cpan.org/~jmcnamara/Spreadsheet-WriteExcel/lib/Spreadsheet/WriteExcel.pm)模块（PHP 模块从中派生）有关，但主旨是相同的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T17:43:42.923

嗯，我刚刚安装它进行测试并没有收到错误 - 它说 Foo 应该是这样。

生成的文件为 3,584 字节；我在 Excel 2002 中打开它

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-02T11:40:43.630

使用 PHPExcel 写入第 0 列 (A0) 时出现此错误。Excel 是 1-indexed (A1)，这就是为什么它说“数据可能已丢失”。

```
$this->m_excel->getActiveSheet()->SetCellValue($chr[$col].$row, $data)); 
```

`$row`被初始化为0

# sql - 建立一个临时表/地图

> ID：244113
> 
> 赞同：2
> 
> 时间：2008-10-28T17:15:21.950
> 
> 标签：sql, sql-server, tsql

我正在使用 SQL Server 2000 中的存储过程，其临时表定义如下：

```
CREATE TABLE #MapTable（类别 varchar(40)，代码 char(5)）
```

创建表后，我想插入一些标准记录（然后将在过程中动态补充）。每个类别（大约 10 个）会有几个代码（通常是 3-5 个），我想在一个语句中表达每个类别的插入操作。

知道怎么做吗？

到目前为止，我最好的想法是在数据库中保留一个真实的表作为模板，但如果可能的话，我真的很想避免这种情况。这将存在的数据库是大型机系统的快照，因此整个数据库每晚都会被吹走并在批处理过程中重新创建 - 存储过程在过程结束时从源代码控制重新加载。

我试图解决的问题与其说是保留一个声明，不如说是试图避免一遍又一遍地重新输入类别名称。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-28T17:56:05.410

DJ 是一个很好的解决方案，但可以简化（见下文）。

为什么它需要是一个单一的声明？

有什么问题：

```
insert into #MapTable (category,code) values ('Foo','AAAAA')
insert into #MapTable (category,code) values ('Foo','BBBBB')
insert into #MapTable (category,code) values ('Foo','CCCCC')
insert into #MapTable (category,code) values ('Bar','AAAAA') 
```

对我来说，这更容易阅读和维护。

* * *

简化的 DJ 解决方案：

```
CREATE TABLE #MapTable (Category varchar(40), Code char(5))

INSERT INTO #MapTable (Category, Code)
SELECT 'Foo', 'AAAAA'
UNION
SELECT 'Foo', 'BBBBB'
UNION
SELECT 'Foo', 'CCCCC' 

SELECT * FROM #MapTable 
```

DJ 并没有什么问题，只是我觉得它过于复杂。

* * *

从OP：

> 我试图解决的问题与其说是保留一个声明，不如说是试图避免一遍又一遍地重新输入类别名称。

我感觉到你的痛苦——我也尝试找到这样的捷径，并意识到当我解决问题时，我可以长手打字。

如果我有很多重复的数据要输入，我有时会使用 Excel 为我生成插入代码。将类别放在一栏中，将代码放在另一栏中；使用所有有用的复制技术来完成艰苦的工作

然后

```
="insert into #MapTable (category,code) values ('"&A1&"','"&B1&"')" 
```

在第三行，我已经生成了我的插入

当然，所有这些都是假设不能从系统表中提取类别和代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T18:56:51.620

```
插入#maptable（类别，代码）
选择'foo1'，b.bar
从  
    （选择'bar11'作为酒吧
        联合选择'bar12'
        联合选择'bar13'
    ) b
联盟
选择'foo2'，b.bar
从  
    （选择'bar21'作为酒吧
        联合选择'bar22'
        联合选择'bar23'
    ) b

```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T17:39:31.667

这可能对您有用：

```
CREATE TABLE #MapTable (Category varchar(40), Code char(5))

INSERT INTO #MapTable 
SELECT X.Category, X.Code FROM
(SELECT 'Foo' as Category, 'AAAAA' as Code
UNION
SELECT 'Foo' as Category, 'BBBBB' as Code
UNION
SELECT 'Foo' as Category, 'CCCCC' as Code) AS X

SELECT * FROM #MapTable 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T20:01:14.330

这是我最终使用的符号。它基于 Arvo 的回答，但更短一些，并使用 cAse 帮助使事情更清晰：

```
SELECT 'foo1', b.code
FROM ( select 'bar11' as code
 union select 'bar12'
 union select 'bar13' ) b

UNION SELECT 'foo2', b.code
FROM ( select 'bar21' as code
 union select 'bar22' 
 union select 'bar32' ) b 
```

这种方式会稍微突出类别名称，垂直排列代码，并使用更少的垂直空间。

# c# - 使用 RegEx 获得扑克手分数

> ID：244114
> 
> 赞同：0
> 
> 时间：2008-10-28T17:15:28.503
> 
> 标签：c#, regex, poker

我正在用 C# 开发一个扑克游戏。目前我正在尝试使用`RegEx`. 我搜索字符串（由卡片花色和数字组成）并寻找花色或数字以匹配`RegEx`. 如果我得到 2 场比赛，那么球员有一对，3 场比赛他有 3 场同类。

我目前有 3 个类，一个 Card 类（带有数字和花色），一个 Deck 类（包含 52 张牌）和一个从洗好的牌堆中获得五张牌的 Hand 类。

甲板类有一个`shuffleDeck()`；Hand 类具有计算分数的功能（在我使用 RegEx 的这些功能中）。

我`RegEx`通过添加手的 5 个花色和数字来生成我使用的字符串。

这是一个好主意还是我应该以另一种方式来做，如果是这样，怎么做？

感谢您的帮助

PS。我是没有经验的程序员之一，想要使用新学的工具来处理所有事情

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-28T17:29:26.757

我不认为正则表达式是处理这个问题的合适方法。您可能应该使用比字符串更复杂的手表示。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-28T17:23:51.060

您没有提供太多细节，但是从我所读到的内容来看，我认为您并没有将 OOP 推得太远......

我会有一个 Card 类，它有一个 Rank 和 Suit 类实例。然后我会有一个处理洗牌/交易的甲板类......

然后，我将有一个 Hand 类，其中包含您的 n 个 Card 对象的扑克手...

通过这种方式，您可以建立规则来评估每个手牌对象，从而在未来更加灵活和更具可扩展性......比如说，如果你想制作另一个纸牌游戏/添加对另一种扑克变体的支持......

使用正则表达式来完成所有这些似乎是一个非常糟糕的选择。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-28T17:40:46.890

我同意其他人的观点，Regex 似乎是一个糟糕的选择。它可能适用于对，3个，4个。然而，一旦你开始研究同花、顺子和 2 对等牌，它可能会变得有点棘手（或不可能）。

我认为最好的解决方案是从最好的牌到最差的牌来评估牌，[如此处所示](http://en.wikipedia.org/wiki/Hand_rankings)，一旦你找到匹配的牌，那就是你的牌。这样可以确保您不会将 4 种误认为 2 对。或同花顺只是顺子，或只是同花。我会使用 mmattax 并为卡片创建一个对象，并为手牌创建一个对象，然后您可以评估每手牌中的牌，看看它们是否符合每手牌所需的标准。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-12-16T09:52:55.293

我认为素数是一个很好的解决方案。考虑 ：

```
//            D H S C    
colors =    [7,5,3,2]

//           A  Q  K  J  T  9  8  7  6  5  4  3  2    
ranks =     [61,59,53,43,41,37,31,29,23,19,17,13,11,61] 
```

唯一的卡片由颜色素数 * 等级素数标识。（例如，截至钻石：素数 = 7 * 61）

因此，整个独特的牌组或组合由素数 * 素数 * 素数 * 素数 * 素数标识

如果有同花钻石，则 5 张牌的素数 ID 必须可被同花钻石 ID 整除（mod = 0）（7 ^ 5，因为钻石的素数是 7）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-28T17:50:45.890

使用字符串来表示手似乎是一个糟糕的决定。我的建议是使用一个 Enum 来表示 Suit，另一个来表示卡片的数值。

# java - 如何使用 Java 的 Scanner 类和正则表达式标记输入？

> ID：244115
> 
> 赞同：5
> 
> 时间：2008-10-28T17:16:16.660
> 
> 标签：java, regex, compiler-construction, tokenize

仅出于我自己的目的，我正在尝试在 Java 中构建一个标记器，我可以在其中定义一个常规语法并让它基于它对输入进行标记。StringTokenizer 类已被弃用，我在 Scanner 中发现了几个函数暗示我想要做什么，但还没有运气。有人知道解决这个问题的好方法吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-29T16:34:45.010

“Scanner”这个名字有点误导，因为这个词经常被用来表示词法分析器，而这不是 Scanner 的用途。它只是`scanf()`您在 C、Perl*等*中找到的函数的替代品。与 StringTokenizer 和 一样`split()`，它旨在向前扫描，直到找到给定模式的匹配项，并且在途中跳过的任何内容都作为令牌返回。

另一方面，词法分析器必须检查和分类每个字符，即使它只是决定是否可以安全地忽略它们。这意味着，在每次匹配之后，它可能会应用多个模式，直到找到*从该点开始*匹配的模式。否则，它可能会找到序列 "//" 并认为它找到了注释的开头，而它实际上是在字符串文字中并且它只是没有注意到左引号。

当然，它实际上比这要复杂得多，但我只是说明了为什么像 StringTokenizer 和 Scanner 这样的内置工具`split()`不适合这种任务。但是，可以使用 Java 的正则表达式类进行有限形式的词法分析。事实上，添加 Scanner 类使其变得更加容易，因为添加了新的 Matcher API 来支持它，即区域和`usePattern()`方法。这是一个建立在 Java 正则表达式类之上的基本扫描器的示例。

```
import java.util.*;
import java.util.regex.*;

public class RETokenizer
{
  static List<Token> tokenize(String source, List<Rule> rules)
  {
    List<Token> tokens = new ArrayList<Token>();
    int pos = 0;
    final int end = source.length();
    Matcher m = Pattern.compile("dummy").matcher(source);
    m.useTransparentBounds(true).useAnchoringBounds(false);
    while (pos < end)
    {
      m.region(pos, end);
      for (Rule r : rules)
      {
        if (m.usePattern(r.pattern).lookingAt())
        {
          tokens.add(new Token(r.name, m.start(), m.end()));
          pos = m.end();
          break;
        }
      }
      pos++;  // bump-along, in case no rule matched
    }
    return tokens;
  }

  static class Rule
  {
    final String name;
    final Pattern pattern;

    Rule(String name, String regex)
    {
      this.name = name;
      pattern = Pattern.compile(regex);
    }
  }

  static class Token
  {
    final String name;
    final int startPos;
    final int endPos;

    Token(String name, int startPos, int endPos)
    {
      this.name = name;
      this.startPos = startPos;
      this.endPos = endPos;
    }

    @Override
    public String toString()
    {
      return String.format("Token [%2d, %2d, %s]", startPos, endPos, name);
    }
  }

  public static void main(String[] args) throws Exception
  {
    List<Rule> rules = new ArrayList<Rule>();
    rules.add(new Rule("WORD", "[A-Za-z]+"));
    rules.add(new Rule("QUOTED", "\"[^\"]*+\""));
    rules.add(new Rule("COMMENT", "//.*"));
    rules.add(new Rule("WHITESPACE", "\\s+"));

    String str = "foo //in \"comment\"\nbar \"no //comment\" end";
    List<Token> result = RETokenizer.tokenize(str, rules);
    for (Token t : result)
    {
      System.out.println(t);
    }
  }
} 
```

顺便说一句，这是我发现该方法唯一的好用处`lookingAt()`。:D

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-28T18:06:24.110

如果我很好地理解了您的问题，那么这里有两种标记字符串的示例方法。您甚至不需要 Scanner 类，只有当您想要预先转换令牌，或者比使用数组更复杂地遍历它们时。如果一个数组就足够了，只需使用 String.split()，如下所示。

请提供更多要求以提供更准确的答案。

```
 import java.util.Scanner;

  public class Main {    

    public static void main(String[] args) {

        String textToTokenize = "This is a text that will be tokenized. I will use 1-2 methods.";
        Scanner scanner = new Scanner(textToTokenize);
        scanner.useDelimiter("i.");
        while (scanner.hasNext()){
            System.out.println(scanner.next());
        }

        System.out.println(" **************** ");
        String[] sSplit = textToTokenize.split("i.");

        for (String token: sSplit){
            System.out.println(token);
        }
    }

} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-12T06:09:29.300

这里的大多数答案已经非常好，但如果我不指出 [ANTLR](http://www.antlr.org/) ，我会失职。我已经围绕这个出色的工具创建了整个编译器。第 3 版具有一些惊人的功能，我建议将它用于任何需要您根据明确定义的语法解析输入的项目。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-28T18:34:11.760

如果这是一个简单的项目（用于了解事物的工作原理），那么就按照巴林特帕托所说的去做。

如果这是一个更大的项目，请考虑使用[JFlex](http://jflex.de/)之类的扫描仪生成器。稍微复杂一些，但速度更快，功能更强大。

# unit-testing - 数据驱动的单元测试

> ID：244118
> 
> 赞同：12
> 
> 时间：2008-10-28T17:16:29.810
> 
> 标签：unit-testing, mocking, mstest, data-driven-tests

测试依赖于数据库数据的 API 的最佳实践是什么？在将单元测试作为构建过程的一部分运行的“持续集成”环境中，我需要注意哪些问题？我的意思是您会将您的数据库部署为构建脚本的一部分（可能会运行您的安装程序）还是应该使用硬编码数据[使用带有 XML 的 MSTest 数据驱动单元测试]？

我知道我可以模拟业务逻辑层的数据层，但是如果我在 DAL 中的 SQL 语句有问题怎么办？我确实需要访问数据库，对吗？

嗯......这是一个问题的洪流:)......想法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-28T19:55:45.793

如前所述，使用模拟来模拟单元测试中的数据库调用，除非你想无休止地摆弄你的测试和数据。测试 sql 语句意味着更多的[集成测试](http://en.wikipedia.org/wiki/Integration_testing)。将其与单元测试分开运行，它们是两种不同的野兽。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-28T17:32:16.800

您应该尽可能地模拟代码以避免完全访问数据库，但在我看来，您需要在某处测试您的 SQL 是正确的。如果您确实编写了针对数据库的测试，避免头痛的一个关键技巧是确保您的设置将数据置于已知状态，而不是依赖于已经有合适的可用数据。

当然，永远不要针对您的实时数据库进行测试！但这不言而喻:)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-28T18:23:27.023

自动擦除测试数据库，然后使用测试工具数据填充它是一个好主意，这些测试工具数据将被假定用于需要连接到数据库的所有测试。每次测试之前都需要重置数据库以进行适当的隔离 - 放入错误数据的失败测试可能会导致随后的测试出现错误的失败，并且如果您必须按特定顺序运行测试以获得一致的结果，它会变得混乱。

[您可以使用工具（ DBUnit](http://www.dbunit.org/)、[DBUnit.NET](http://dbunit-net.sourceforge.net)等）清除和填充数据库，或者只是创建自己的实用程序类来做同样的事情。

正如您所说，其他层应该与实际命中数据库的类充分分离，因此对涉及测试的任何类型的数据库的需求仅限于测试运行代码库的一小部分。您的数据库访问组件可以为依赖它们的所有内容进行模拟/存根。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T17:47:41.183

我做的一件事是创建返回已知状态的测试数据的静态方法。然后我会使用“假”DAL 来返回这些数据，就好像我实际上是在调用数据库一样。至于测试 sql/存储过程，我使用 SQL Management Studio 进行了测试。YMMV！

# java - 颠覆 java 访问控制并让我访问私有成员变量的库？

> ID：244119
> 
> 赞同：1
> 
> 时间：2008-10-28T17:16:59.623
> 
> 标签：java

anoyne 可以推荐一个可以让我轻松读取/写入类的私有成员字段的好库吗？我正在浏览 apache commons，但看不到它。我一定是瞎了眼？

编辑：在合法性边界上提出问题总是会给出“为什么”的问题？我正在为热交换类编写几个 javarebel 插件。访问私有变量只是第一步，我什至可能不得不替换一些方法的实现。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-28T17:39:19.953

在大多数情况下，java[反射](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/reflect/package-summary.html)解决了这个问题：

例子：

```
public class Foo {

    /**
     * Gets the name Field.
     * 
     * @return the name
     */
    public final String getName() {
        return name;
    }

    /**
     * Sets the name Field with the name input value.
     * 
     * @param name the name to set
     */
    public final void setName(String name) {
        this.name = name;
    }

    private String name;

} 
```

现在反射代码：

```
import java.lang.reflect.Field;
....

Foo foo = new Foo();
foo.setName("old Name");
String fieldName = "name";
Class class1 = Foo.class;

try {

    System.out.println(foo.getName());

    Field field = class1.getDeclaredField(fieldName);

    field.setAccessible(true);

    field.set(foo, "My New Name");

    System.out.println(foo.getName());

} catch (NoSuchFieldException e) {
    System.out.println("FieldNotFound: " + e);
} catch (IllegalAccessException e) {
    System.out.println("Ilegal Access: " + e);
} 
```

**更新：**

值得一提的是，这种方法可能会被 SecurityManager 阻止。——丹·戴尔

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-28T17:48:44.490

在不知道您为什么想要该级别的访问权限的情况下，我只能想知道您可能需要该级别的访问权限。私人成员是私人的，这是有原因的。它们不打算从类外部访问，并且可能导致未记录的行为。

也就是说，您可以通过 java.lang.reflect 包访问大多数内容。

在我看来，你应该检查为什么你认为你需要那种级别的访问权限，看看你是否可以做一些不同的事情而不需要它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T17:32:47.750

包`java.lang.reflect`类和方法允许在一定限度内进行这种访问。

见[java.lang.reflect](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/reflect/package-summary.html)

# sql-server-2005 - 使用 XML 列的 SQL Pivot

> ID：244122
> 
> 赞同：1
> 
> 时间：2008-10-28T17:18:48.183
> 
> 标签：sql-server-2005, sqlxml

有没有人有一个使用带有 XML 列的表进行数据透视的示例 - 特别是将 xml 列中的一些元素转换为数据透视表中的列？我正在尝试构建一个，但语法正在杀死我；与 C# 中的 xml 相比，sql 中的 xml 很难使用。我怀疑这是不可能的，但检查一下不会有什么坏处:)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T01:26:10.900

这是一个简单的示例，其中包含存储在 xml 中的产品详细信息的商店。枢轴位于底部，显示商店和 A 类和 B 类的价格总和。

```
declare @test Table
(

    StoreID int,
    ProdXml xml
)

insert into @test
select 1, '<product cat="A" name="foo" price="10" />' union
select 2, '<product cat="A" name="bar" price="12" />' union
select 1, '<product cat="B" name="blah" price="35" />' union    
select 2, '<product cat="B" name="bap" price="67" />' union
select 1, '<product cat="C" name="bip" price="18" />' union
select 2, '<product cat="A" name="bing" price="88" />' union
select 1, '<product cat="B" name="bang" price="34" />' union    
select 2, '<product cat="B" name="boom" price="65" />' 

--Pivot showing sum of price by Cat
select  StoreID, A, B
from
(   
    select  StoreID,
        ProdXml.value('/product[1]/@cat[1]','varchar(20)') as [ProdCat],
        ProdXml.value('/product[1]/@price[1]','int') as [ProdPrice]
    from  
        @test
) up
PIVOT (SUM([ProdPrice]) FOR [ProdCat] IN ( A, B)) as pvt
ORDER BY StoreID 
```

# jsp - 如何在向用户显示之前从 JSP 页面捕获最终的 HTML 输出？

> ID：244124
> 
> 赞同：1
> 
> 时间：2008-10-28T17:20:23.797
> 
> 标签：jsp, jakarta-ee, capture

我需要捕获 HTML 并对 HTML 数据进行一些后期处理，然后才能最终输出给用户。最终的 HTML 文档实际上是由许多 JSP 包含（12 个左右）组成的，因此 JSP 中实际上存在一些逻辑。但我需要生成的 HTML。这必须在服务器端完成。

我只想到了2个选项。

1.  使用 JSP 标记库并通过某种主体捕获或其他方式捕获输出。但是 JSP 有点乱，包含太多代码，理想情况下我试图避免修改任何 JSP 页面。

2.  使用 URL/Net 库并通过 http 请求连接到此页面。但这也有点乱。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-28T17:41:11.850

如果我了解您想要做什么，那么您应该能够通过使用[servlet 过滤器](http://java.sun.com/products/servlet/Filters.html)来做到这一点。查看久经考验的真实[gzip 示例](http://www.onjava.com/pub/a/onjava/2003/11/19/filters.html)，了解如何捕获和修改整个输出流。

# silverlight - Silverlight 代码需要保护吗？

> ID：244130
> 
> 赞同：5
> 
> 时间：2008-10-28T17:23:15.257
> 
> 标签：silverlight, obfuscation

我不太明白 Silverlight 代码在浏览器中的工作原理。程序集是否已下载到客户端计算机？是否有可能使用 Reflector 或类似工具对代码进行反编译？如果是这样，有哪些选择可以保护代码？.net 混淆器可以与 Silverlight 一起使用吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-28T17:46:35.053

每当您在 Web 浏览器中时，所有客户端代码都会下载到机器上，并且可以由用户检查。这适用于 Javascript、Flash 和 Silverlight。

如果您有绝对必须隐藏的专有代码，那么您需要将其放在服务器上并公开一个 API，客户端可以调用该 API 以向用户显示信息。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-30T06:38:41.907

要查看 Silverlight 应用程序，客户端下载包含 dll 和一个配置 xml 和可选资源的 .xap 文件。该 dll 包含已编译的 c# 代码，这些代码在客户端计算机的 Silverlight 运行时中运行。Silverlight 运行时基本上是完整的 .net 运行时的一个子集。所以重点是用户获取 dll 中的代码，然后可以使用工具获取原始源代码。所以你最多可以做的是混淆。仍然适用于不应该选择的非常关键的代码。如果需要，您可以使用其他方式（WCF 或其他 Web 服务来隐藏您的代码的某些部分）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-29T00:25:49.710

如果您想看看在 silverlight 应用程序中查看代码是多么容易，只需运行[FirstFloor](http://silverlightspy.com/silverlightspy/)的SilverlightSpy[链接文本](http://www.silverlightspy.com/downloads/SilverlightSpy2/FirstFloor.SilverlightSpy.application)。只要您安装了[.NET Reflector](http://www.red-gate.com/products/reflector/)，您就可以看到（当您与应用程序交互时）包括 xaml 文件在内的所有源代码。

由于代码确实会下载到客户端（甚至[尝试使用 pragma no-cache 来阻止它](https://stackoverflow.com/questions/244130/does-silverlight-code-need-protection#244230)也行不通，因为它们可以访问 URL），您需要通过在服务器上保留重要逻辑来保护您的代码。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-29T18:53:28.787

如果您害怕有人会窃取您的知识产权并且该法律还不够，那么您将需要混淆您的代码。但我不会说这种保护，而是对临时逆向工程师的威慑。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-28T18:04:18.293

设置 pragma -No Cache- 将阻止 .xap 存储在计算机上，而是由 Silverlight 插件流式传输。如果没有编译指示，.xap 文件将存储在临时 Internet 文件中。

将应用程序放在 https 上的页面上将进一步保护 .xap 的传输

如果可能，需要身份验证才能查看网页/.xap 文件（感谢 Joel）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-05-19T15:05:37.353

恩拉，

是的，SL 应用程序可以进行混淆。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-10-11T11:26:25.593

是的，Silverlight xap 文件只不过是包含您的程序集的 zip 文件，因此它们确实需要通过混淆进行保护。试试[Crypto Obfuscator](http://www.ssware.com/cryptoobfuscator/obfuscator-net.htm) - 它直接混淆 xap 文件，它还可以通过重命名类引用、剥离注释、空格、换行符等来混淆程序集中的 XAML 文件

# c# - 获取 IEnumerable 来自 IEnumerable >

> ID：244135
> 
> 赞同：10
> 
> 时间：2008-10-28T17:24:26.097
> 
> 标签：c#, .net, linq, ienumerable

公共类项目 { ... }

```
public class Order
{
    public List<Item> Items
    ...
}

public class Customer
{
    public List<Order> Orders
    ...
} 
```

现在，使用 LINQ，我需要获取客户购买的所有商品。我怎样才能？

我尝试了类似的东西，`var items = from o in cust.Orders select o.Items;`但结果是`IEnuberable<List<Item>>`，我只想要一个`IEnumerable<Item>`。

我在这里要求尽量避免编码 2 个循环。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-28T17:37:16.977

您需要[`SelectMany`](http://msdn.microsoft.com/en-us/library/system.linq.enumerable.selectmany.aspx)，它在查询表达式中表示为第二个（和后续）`from`子句：

```
var items = from order in customer.Orders
            from item in order.Items
            select item; 
```

或者，忽略查询表达式：

```
var items = customer.Orders.SelectMany(order => order.Items); 
```

# python - 有了 Lua 和 Python 的可嵌入性，Basic 有没有一席之地？

> ID：244138
> 
> 赞同：7
> 
> 时间：2008-10-28T17:27:32.550
> 
> 标签：python, scripting, lua, interpreter, basic

我开始在[ZX81](http://en.wikipedia.org/wiki/ZX81)上使用 Basic 编程，然后是[BASICA](http://en.wikipedia.org/wiki/IBM_BASICA)、[GW-BASIC](http://en.wikipedia.org/wiki/GW-BASIC)和[QBasic](http://en.wikipedia.org/wiki/QBasic)。我转向 C（啊，Turbo C 3.1，我几乎不知道你......）

当我开始使用微控制器时，我使用Parallax的[BASIC Stamp退步了。](http://en.wikipedia.org/wiki/BASIC_Stamp)然而，BASIC 非常棒，因为它很容易理解，而且很难出错。我最终转向汇编和 C 语言，因为我需要额外的能力（速度、容量、资源等），但我知道，如果门槛更高，许多人将永远不会进入微控制器编程。

我一直渴望制作自己的片上 BASIC 解释器，但我想知道现在是否需要 BASIC，因为 Lua 和 Python 易于嵌入，并且与 BASIC 一样平易近人。

*   BASIC 与其他语言相比有哪些优势（如果有的话）？
*   为什么它还在？
*   如果我决定制作带有解释器的通用微控制器板，是否有理由制作 BASIC 版本？

很多其他语言都被认为已经死了，但 BASIC 一直在坚持。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-28T18:24:02.937

[这听起来可能比实际情况更消极。我不是说 Basic 是万恶之源，[其他人都这么说](http://en.wikiquote.org/wiki/Edsger_Dijkstra)。我是说这是我们有能力留下的遗产。]

**“因为它很容易理解，而且很难犯错误”**这当然值得商榷。我在完全不透明的基本方面有过一些不好的经历。专业的东西——商业产品——非常糟糕的代码。不得不放弃并拒绝这项工作。

**“如果有的话，Basic 相对于其他语言有哪些优势？”** 没有，真的。

**“为什么还在？”** 两个原因：（1）微软，（2）所有开始做 VB 的 IT 部门现在拥有数百万行 VB 遗留代码。

**“很多其他语言都被认为已经死了......” 是的** 。Basic 与 COBOL、PL/I 和 RPG 一起作为遗产，有时成本高于价值。但是由于大型 IT 的“如果它没有坏就不要修复它”的政策，他们坐在那里，吸收资源，这些资源可以很容易地用更小、更简单、维护成本更低的东西来代替它。除了它没有“失败”——它只是不成比例地昂贵。

30 岁的 COBOL 是一个可怕的情况来返工。从 2016 年开始，我们将关注 30 岁的 MS Basic，我们只是想不通，不想没有，也无法决定如何更换。

**“但基本款一直在坚持”**似乎有些人喜欢基本款。其他人则将其视为另一种设计不佳的语言。它的优势在于早期上市并得到大型供应商（最初是 IBM）的支持。糟糕的设计、过早的上市只会给我们留下数十年的苦难。

我还有 1965 年版的达特茅斯基础手册。我不渴望过去的美好时光。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-29T11:04:48.017

作为一种架构，BASIC 的主要声名是您可以使 BASIC 解释器非常小——只有几 KB。在 DG Nova 时代，这是一场胜利，因为您可以使用 Business BASIC 之类的系统在具有 64K（甚至更少）内存的机器上构建多用户应用程序。

BASIC（尤其是 VB）是一个遗留系统，并拥有大量的现有代码库。可以说，VB 确实是一种具有类似 BASIC 语法的语言（有人会说是对 COM 的薄包装）。这些天来，我认为没有理由在人们熟悉它的情况下保留该语言并维护现有的代码库。我当然不会提倡对其进行新的开发（请注意，VB.Net 并不是真正的 BASIC，而只是具有类似 VB 的语法。类型系统并没有像 VB 那样被破坏。）

*计算*世界缺少的是一种易于学习和修补的*相关*语言，并且在主流应用程序开发中占有一席之地。我是在 8 位机器时代长大的，在这些系统上编程的入门门槛非常低。这些机器的架构非常简单，你可以很容易地学习在这些机器上编程和编写或多或少相关的应用程序。

现代架构要复杂得多，学习难度也更大。你可以看到人们对孩子们无法像在 BASIC 和 8 位计算机时代那样轻松地学习编程而自以为是，我认为这个论点有一定的道理。留下了一些让编程变得更难进入的漏洞。玩具语言在这里用处不大——要使编程具有吸引力，就必须能够渴望构建与您正在学习的语言相关的东西。

这导致了一种语言的问题，这种语言对孩子们来说很容易学习，但仍然允许他们编写他们可能真正想要的相关程序（甚至游戏）。它还必须被广泛认为是相关的。

我能想到的最接近这一点的是Python。它不是该类型语言的唯一示例，但它是最受关注的语言 - 并且（IMO）在这个利基市场中发挥相关性的感知是必要的。它也是我经历过的最容易学习的语言之一（在我多年来使用的大约 30 种语言中）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-08T23:33:44.317

为什么不试试 Jumentum，看看它对您有什么作用？

[http://jumentum.sourceforge.net/](http://jumentum.sourceforge.net/)

它是用于微控制器的开源 BASIC

elua 项目也是微控制器的 lua

[http://elua.berlios.de/](http://elua.berlios.de/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-25T04:38:06.013

BASIC 仍然存在，特别是在 STAMP 实现中，因为它比大多数其他非常容易学习的编程语言级别更低。对于大多数嵌入式 BASIC 实现，BASIC 指令直接映射到单个或一组机器指令，开销很小。用 Lua 或 Python 等“高级”语言编写的相同程序在这些相同的微控制器上运行速度要慢得多。

PS：尽管命名相似，但像 PBASIC 这样的 BASIC 变体与 Visual BASIC 几乎没有共同之处。他们以非常不同的方式出现分歧。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-28T17:59:19.320

好问题...

基本上（原文如此！），我没有答案。我想说 Lua 非常容易学习，可能和 Basic 一样简单（这也是我的第一门语言之一，我在很多 8 位计算机上使用方言......），但更强大（允许 OO或功能样式，甚至混合它们）并且以某种方式更严格（没有转到...）。

我不太了解 Python，但从我所阅读的内容来看，它与 Lua 一样简单、强大和严格。

此外，两者都是事实上的“标准化”，即。没有方言（除了各种版本），不像 Basic 有许多变体。

两者都精心设计了虚拟机，高效，（大部分）没有错误。如果您制作自己的解释器，您应该使用现有的 VM 并从 Basic 源代码为其生成字节码，或者自己制作。当然有趣的东西，但耗时且容易出现错误......

所以，我只想让Basic过一个愉快的退休生活...... :-P

PS.：为什么它挂了？也许微软对此并不陌生......（VB，VBA，VBScript......）
周围还有很多方言（RealBasic，DarkBasic等），有一些观众。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-28T18:02:35.273

冒着听起来像摇椅上的两个老前辈的风险，让我暴躁地说“今天的孩子们不喜欢 BASIC”，然后自相矛盾地说“他们不知道自己掌握得有多好”。

BASIC 的最大优势*始终*是它的可理解性。这是人们可以*得到*的东西。学术界和语言开发人员长期以来一直忽视这一点。

当您谈论想要实现 BASIC 时，我假设您不是在谈论行号 BASIC，而是在谈论结构化形式。问题在于，一旦你开始转向结构化编程——函数，“为什么我*不能*直接转到那个地方？”等等——真的变得不清楚 BASIC 有什么优势（如果有的话） ，比如说，Python。

此外，BASIC“如此容易正确”的一个原因是，在那些日子里，图书馆并不像今天那么重要。库意味着即使不是面向对象的编程也是结构化的，因此您再次处于一种更现代的动态脚本语言“适合”人们今天做得更好的现实的情况。

如果真正的问题是“好吧，我想实现一个解释器，所以它归结为投资回报率”，那么它就变成了一个实际上很容易实现的语法问题。我建议 BASIC 在这方面也没有那么多优势（除非你真的*回到*行号和非常有限的语法）。

简而言之，我认为您*不*应该将精力投入到 BASIC 解释器上。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-28T21:27:54.797

好吧，这些人似乎认为 Basic 在移动领域仍然占有一席之地，而且他们可以从中赚钱：

[http://www.nsbasic.com/symbian/](http://www.nsbasic.com/symbian/)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-20T22:03:43.830

我也开始使用 ZX81。但正如[Tony Hoare](http://en.wikipedia.org/wiki/C._A._R._Hoare)所说，使用 BASIC 编程就像尝试使用罗马数字进行长除法一样。

> 许多其他语言被认为已经死了，但基本语言仍然存在。

Sadly yes. I blame Bill Gates for this...BASIC was on a stretcher with a priest saying the last rites for it, and then MS brought it back like Smallpox.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-28T17:58:50.833

我曾经在 QBasic 时代用 BASIC 编程。QBASIC 有子例程、函数、结构（它们曾经被称为类型），我想就是这样。现在，与 Python 具有的所有功能相比，这似乎是有限的——OO、lambdas、元类、生成器、列表推导，仅举几例。但我认为，这种简单性是 BASIC 的优势。如果您正在寻找一种简单的可嵌入语言，我敢打赌 QBasic 会更快、更容易理解。对于大多数嵌入/脚本类型的应用程序来说，程序语言可能绰绰有余。

我想说 BASIC 仍然存在的最重要原因是 Visual Basic。在 90 年代的很长一段时间里，VB 是为 Windows 编写 GUI、COM 和 DB 代码而不会陷入 C++ Turing tarpit 的唯一方法。[也许 Delphi 也是一个不错的选择，但不幸的是它从未像 VB 那样流行]。我确实认为正是因为所有这些仍在使用和维护的 VB 和 VBA 代码，BASIC 仍然没有死。

也就是说，我想说今天为 BASIC 编写 BASIC 解释器（甚至可能是使用 LLVM 或类似东西的编译器）有很好的理由。如果您实现类似于 QBasic 的东西，您将获得一种干净、简单易用且快速的语言。您不必解决任何语言设计问题，最好的部分是人们已经知道您的语言。

# c# - 你如何处理转义无效的属性字符？

> ID：244145
> 
> 赞同：0
> 
> 时间：2008-10-28T17:32:16.940
> 
> 标签：c#, xml

我必须启动并运行一个快速而肮脏的配置编辑器。流程是这样的：

配置（服务器上的 POCO）-> Xml（序列化，作为 XElements 传输到网站）-> 文本（在网页中就地编辑）（进行更改）
文本编辑器-> XElement（解析提交的表单值）-> 配置

问题是序列化不会转义任何字符串。但是当我尝试将其解析回 xml 时，我无法弄清楚如何将字符串放入 XElement 而不引发异常。

例如，假设我有一个具有正则表达式的对象。这将是编辑器中的片段：

```
<Validator Expression="[^<]" /> 
```

但是，在回程中，我无法将其恢复为 XElement 形式，因为该属性具有非法字符。

我不知道如何指示序列化程序转义字符，也不知道如何让解析器在返回的路上忽略它们。

我能看到的唯一方法是对 XML 进行一些非常粗略的正则表达式替换，我几乎可以完全保证在某些极端情况下会搞砸。

还有其他方法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T17:47:55.067

好的，替换我的答案 - 我想我知道你现在来自哪里。

您的网页以如下来源结束：

```
<textarea>
    <Validator Expression="[^<;]"/>
</textarea> 
```

甚至

```
<textarea>
    &lt;Validator Expression="[^&lt;]"/&gt;
</textarea> 
```

您需要对属性中的值进行双重编码，以使它们在 textarea 中显示为编码值：

```
<textarea>
    &lt;Validator Expression="[^&amp;lt;]"/&gt;
</textarea> 
```

# javascript - 在网站上显示准确的当地时间？

> ID：244148
> 
> 赞同：6
> 
> 时间：2008-10-28T17:33:25.847
> 
> 标签：javascript, web-services, timezone

我被要求在我们的网站上显示“正确”时间，坦率地说，我觉得这毫无意义，因为“正确”可以用多种方式解释。

我们当前的方法肯定会导致时间不准确，因为它使用服务器控件呈现 JavaScript，该 JavaScript 使用来自服务器的日期时间作为参数运行 onload，以在 JavaScript 中创建一个时钟对象，最终呈现在页面上，然后开始递增时钟。在服务器处理、网络延迟和客户端性能（还有很多其他的负载运行）之间，时钟最终与实际服务器时间相差甚远，与客户端 PC 相比谁知道呢。

因此，为了获得“正确”的时间，我可以；

*   使用本地 PC 时间并将 new Date() 传递给 JavaScript 时钟对象。优点：应尽可能接近 PC 时钟。缺点：不确定 PC 时钟在哪个时区的准确度更不用说。
*   使用网络服务向 NTP 服务器发送 TCP 请求以更新网页上的时钟。优点：如果本地 PC 也同步到 NTP 将是准确和最佳匹配。缺点：必须处理与我们的服务器相关的所有时区调整。如果 PC 时钟不匹配，仍然会出现不匹配。

我是实现自己的网络服务还是使用类似的东西；[地球工具](http://www.earthtools.org/webservices.htm)或世界时间网络服务（**编辑：**链接已删除 - 现在 404）

[这是Jon Galloway 的一篇关于原子钟网络服务](http://weblogs.asp.net/jgalloway/archive/2004/04/08/110029.aspx)的博客文章，它已经很老了，但当我用谷歌搜索时排名很高，他没有得出结论。

希望我能赢得管理层的争论，如果您不在那个时区，为什么同步到我们的服务器时钟 (GMT) 没有意义，以及为什么我们甚至需要匹配本地 PC。

我缺少这方面的任何角度吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T18:17:35.350

我需要在拍卖网络应用程序中向客户显示准确的时间。您可以将当前服务器时间与页面一起发送并立即初始化 javascript，而无需等待页面的其余部分加载。因此，您只需要处理网络延迟，在最坏的情况下可能不会超过几秒钟。

在那之后，你非常接近准确的时间。只要您的 Javascript 计时器代码编写正确，您就不会在下一页加载之前远远不同步。但是我见过很多糟糕的 JS 时钟代码。（提示：Date() 好，setTimeout() 不好。）

如果您有一个用户要长时间使用的应用程序，只需通过重新加载页面或 Ajax 来刷新您的时间同步。

我不会担心时区，只需使用 UTC 时间，这样就不会混淆什么时候会发生。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T17:59:25.107

首先，确保您的客户知道 Windows、Linux 和 OSX 都有内置时钟，这些时钟几乎总是对用户可见（或很容易可见）。此外，请确保您的客户知道物理时钟通常位于任何可能设置为对操作系统隐藏内置时钟的信息亭附近。

如果您知道这一点，并且您的客户仍然希望在您的网站上使用时钟，请让您的客户定义“正确”时间，然后实施与其​​定义相匹配的解决方案（您的两个解决方案似乎都会处理最有可能的两个定义）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T17:57:50.897

您可以使用[地理定位](http://en.wikipedia.org/wiki/Geo_targeting)来了解网站访问者的实际位置，并在您的数据库中存储该区域的 (GMT - XX:XX)，然后根据请求的位置计算时间。这将节省到任何第三方 Web 服务的长途旅行。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T18:03:26.720

您可以实现它的另一种方法是使用[IP Geolocation](http://www.google.com/search?q=ip+geolocation)。有些服务可以根据用户的 ip（通常包括他们的时区）告诉您用户从哪里连接，并将该信息与服务器的实时时钟相结合，您可以向用户显示当地时间。

它远非完美，特别是对于似乎从他们不在的地方连接的企业用户（我住在阿根廷，但我的工作互联网连接是通过我的员工是一家美国公司，所以每个网站都假设我位于美国）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-31T02:06:18.633

处理 UTC 时间。

*   让用户*告诉*您他们想使用哪个区域。
*   如果您的用户具有持久配置文件，请坚持选择。
*   始终并排显示 UTC 和本地时间并清楚标记。

您还可以显示任意数量的用户指定区域时钟。Vista 做到了这一点，我仍然对它的方便程度感到惊讶。

# c# - 如何在本地环境中更改 HttpApplication.User.Identity.Name？

> ID：244152
> 
> 赞同：0
> 
> 时间：2008-10-28T17:37:08.553
> 
> 标签：c#, .net, security, authentication

我有一个需要 Windows 身份验证的站点，一旦用户被 autenticated，应用程序就会从 Security.Prinical 获取凭据，问题是我在本地环境中的凭据与存储在数据库中的凭据不同，并且无法获取用户首选项。我正在做以下解决方法来解决这个问题。

```
 #if DEBUG
      var  myUser = userBL.GetSingle(@"desiredDomain\otherUserName");
    #else 
       var myUser = userBL.GetSingle(HttpApplication.User.Identity.Name);
    #endif
        Session.Add("User",myUser); 
```

除了模拟或上述工作方法之外，有没有其他方法可以更改 HttpApplication.User.Identity.Name 的值，这是因为每次我需要提交到存储库或部署应用程序时，我都必须更改我的代码

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T21:06:27.397

虽然您可以更改 userBL，但您为什么不更改数据库记录以反映它们位于不同的域中。我假设您没有访问生产数据库，因此使数据库可用于开发/测试的“清理”步骤应该没有问题。

例如

```
UPDATE Users 
SET 
    UserName = REPLACE(UserName, '\\ProductionDomain\', '\\DevDomain\') 
```

1.  使用#if DEBUG 对这类事情不利。有人可以/应该在生产环境中合法地加载调试版本的代码，然后突然登录就被破坏了。这些东西在需要时可以在 web.config 中得到更好的控制。
2.  开发人员应该针对数据库的开发副本工作。在制作副本时清理数据库的某些方面是非常典型的。有时这是为了隐私法规（例如，隐藏用户的真实姓名和登录名）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T17:56:05.910

您是否考虑过在 Web.Config 中使用 Impersonation 将 id 设置为您的测试凭据。我假设您有一个“测试”web.config 和一个“生产”web.config。这样您就不必担心在上线时将其删除。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T18:09:09.860

我之前通过将其包装在实用程序方法中来完成此操作。如果 HttpContext.Current 不为空，请从那里获取。否则从 WindowsIdentity.GetCurrent() 获取它。

# php - 在 PHP 中从另一台服务器读取 xml 文件的方法有多少种？

> ID：244157
> 
> 赞同：3
> 
> 时间：2008-10-28T17:39:31.653
> 
> 标签：php, xml, apache

我正在尝试从另一台服务器读取 XML 文件。然而，托管我的公司似乎已经关闭了 file_get_contents 函数，不再从其他服务器检索文件（而且他们的支持不是很亮，而且他们需要很长时间才能回答）。所以我需要以某种方式解决。

这是我当前的代码

```
 $url =  urldecode( $object_list_url );
 $xmlstr = file_get_contents ( $url );
 $obj = new SimpleXMLElement ( $xmlstr, LIBXML_NOCDATA ); 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-28T17:46:20.797

您可以使用[cURL](http://www.php.net/curl)（如果未禁用）。像这样的东西：

```
$c = curl_init($url);
curl_setopt($c, CURLOPT_RETURNTRANSFER, true);
$xmlstr = curl_exec($c); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T17:45:53.557

您所指的 ini var 是`allow_url_fopen`. 要检查，请运行此脚本：

```
var_dump(ini_get('allow_url_fopen')); 
```

要求您的主机打开该 ini 值（如果它被禁用 - 默认情况下它是打开的）。

如果没有该 ini 设置，您应该无法访问任何远程 url。

如果他们不会尝试[`copy`](http://docs.php.net/manual/en/function.copy.php)将文件发送到您的服务器，还有一个想法。我希望该 ini 设置将涵盖所有文件系统功能，但它总是值得一试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T17:47:19.203

您可以执行以下脚本并将信息作为注释提供吗？

```
<?php
phpinfo();
?> 
```

# web-frameworks - 对网络框架的付费支持

> ID：244162
> 
> 赞同：3
> 
> 时间：2008-10-28T17:45:19.707
> 
> 标签：web-frameworks

这可能听起来很奇怪，但有时当您的 ASP.NET Web 应用程序无法正常工作并且您无法说出原因时，您可以致电 Microsoft，向他们支付 300 美元之类的费用，然后让 1-3 个人在 1-3 周内查看您的配置，内存转储，有时是代码……但通常不是数据库，并且它们以相当高的百分比帮助您修复错误，而不必向您推销。

我发现 Novell 愿意[为 Mono 提供该功能](http://www.mono-project.com/Kickstart)。每个人都知道 MySQL 为他们的客户提供了它，因为这是他们在一天之内获得一大笔钱来改变门上的铭牌的部分原因。

我很好奇是否有人找到支持这些的人，以及他们如何评价他们的经历：

*   姜戈
*   导轨
*   圣杯
*   JRuby
*   单声道 [收视率]
*   添加你自己的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T13:26:36.157

我从来没有为这些开源技术寻求过付费支持，但总的来说，我认为在市场渗透率显着之前，不会有“拨入支持”第三方构建的应用程序的商业案例。

一般来说，您会寻找一位利基技术专家顾问，该顾问可能会按小时收费来查看您的问题。

对于 django - 看看 djangogigs.com，或者我想在rentacoder.com 上发帖。

每个人通常都有一个 irc 频道——您也可以在那里提出一般性问题，或尝试找人出租。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T14:38:58.240

我相信，这个利基市场通常由两个群体处理

1.  软件组件开发人员。- 我从 DevExpress 获得了很多我的表示层支持，因为我将他们的小部件用于我的 GUI。事实上，除非我确定了可靠的支持渠道，否则我通常不会以官方身份使用技术。

    您向 Microsoft 提出的问题是通过在报告问题之前抽象您的问题来处理的。这是大多数商业支持渠道的共同法则： **当一个问题涉及 2 个供应商时，他们会互相指责！** 您的工作是在报告之前或期间首先隔离问题。

    这很难，我知道，但这就是你得到大笔报酬的原因:-)

2.  是请一位外部顾问，该顾问应该能够研究您的系统并执行我们在第 1 部分（上文）中描述的操作

# java - 如何使用 Java 调整图像大小？

> ID：244164
> 
> 赞同：131
> 
> 时间：2008-10-28T17:46:12.933
> 
> 标签：java, image, resize

我需要调整 PNG、JPEG 和 GIF 文件的大小。如何使用 Java 做到这一点？

* * *

## 回答 #1

> 赞同：184
> 
> 时间：2010-12-24T20:01:22.830

FWIW 我刚刚发布了（Apache 2，托管在 GitHub 上）一个简单的 Java 图像缩放库，称为[imgscalr](https://github.com/thebuzzmedia/imgscalr)（可在[Maven central](http://mvnrepository.com/artifact/org.imgscalr/imgscalr-lib)上获得）。

该库实现了几种不同的图像缩放方法（包括 Chris Campbell 的增量方法，并进行了一些小的改进），如果您要求，它会为您选择最优化的方法，或者为您提供最快或最好看的方法（如果您要求）。

用法非常简单，只是一堆静态方法。最简单的用例是：

```
BufferedImage scaledImage = Scalr.resize(myImage, 200); 
```

所有操作都保持图像的原始比例，因此在这种情况下，您要求 imgscalr 在 200 像素宽和 200 像素高的范围内调整图像大小，默认情况下，它会自动选择最好看和最快的方法，因为它是'未指定。

我一开始就意识到这看起来像是自我推销（确实如此），但我花了相当多的时间在谷歌上搜索这个完全相同的主题，并不断提出不同的结果/方法/想法/建议，并决定坐下来写一篇简单的实现可以解决 80-85% 的用例，在这些用例中，您有一张图片并且可能想要一个缩略图——要么尽可能快，要么尽可能好看（对于那些尝试过的人，你会注意到即使使用 BICUBIC 插值对足够小的图像进行 Graphics.drawImage，它仍然看起来像垃圾）。

* * *

## 回答 #2

> 赞同：90
> 
> 时间：2008-10-28T17:50:25.030

加载图像后，您可以尝试：

```
BufferedImage createResizedCopy(Image originalImage, 
            int scaledWidth, int scaledHeight, 
            boolean preserveAlpha)
    {
        System.out.println("resizing...");
        int imageType = preserveAlpha ? BufferedImage.TYPE_INT_RGB : BufferedImage.TYPE_INT_ARGB;
        BufferedImage scaledBI = new BufferedImage(scaledWidth, scaledHeight, imageType);
        Graphics2D g = scaledBI.createGraphics();
        if (preserveAlpha) {
            g.setComposite(AlphaComposite.Src);
        }
        g.drawImage(originalImage, 0, 0, scaledWidth, scaledHeight, null); 
        g.dispose();
        return scaledBI;
    } 
```

* * *

## 回答 #3

> 赞同：56
> 
> 时间：2011-02-19T14:46:06.387

[Thumbnailator](https://github.com/coobird/thumbnailator)是一个用于 Java 的开源图像大小调整库，具有流畅的界面，在[MIT 许可下分发。](http://www.opensource.org/licenses/mit-license.php)

我编写这个库是因为在 Java 中制作高质量的缩略图非常困难，而且生成的代码可能非常混乱。借助 Thumbnailator，可以使用简单流畅的 API 表达相当复杂的任务。

**一个简单的例子**

举个简单的例子，拍摄一张图像并将其调整为 100 x 100（保留原始图像的纵横比），然后将其保存到文件中，可以在单个语句中实现：

```
Thumbnails.of("path/to/image")
    .size(100, 100)
    .toFile("path/to/thumbnail"); 
```

**一个高级的例子**

Thumbnailator 的流畅界面简化了复杂的调整大小任务。

假设我们要执行以下操作：

1.  获取目录中的图像，然后，
2.  使用原始图像的纵横比将它们调整为 100 x 100，
3.  将它们全部保存为质量设置为 的 JPEG `0.85`，
4.  文件名取自原始文件名`thumbnail.`并附加到开头

翻译成 Thumbnailator，我们可以通过以下方式执行上述操作：

```
Thumbnails.of(new File("path/to/directory").listFiles())
    .size(100, 100)
    .outputFormat("JPEG")
    .outputQuality(0.85)
    .toFiles(Rename.PREFIX_DOT_THUMBNAIL); 
```

**关于图像质量和速度的说明**

该库还使用Chet Haase 和 Romain Guy 在[Filthy Rich Clients](http://filthyrichclients.org/)中强调的*渐进式双线性缩放*方法，以生成高质量的缩略图，同时确保可接受的运行时性能。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-02-10T18:41:37.507

你不需要图书馆来做到这一点。您可以使用 Java 本身来完成。

Chris Campbell 有一篇关于缩放图像的出色而详细的文章 - 请参阅[这篇文章](https://community.oracle.com/docs/DOC-983611)。

[Chet Haase 和 Romain Guy 在他们的书《 Filthy Rich Clients](http://filthyrichclients.org/)》中也有关于图像缩放的详细且内容丰富的文章。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-10-28T18:24:04.153

[Java Advanced Imaging](http://www.oracle.com/technetwork/java/javase/tech/jai-142803.html)现在是开源的，并提供您需要的操作。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-02-10T18:25:32.320

如果您正在处理大图像或想要一个漂亮的结果，那么在 java 中这不是一项简单的任务。简单地通过 Graphics2D 进行重新缩放操作不会创建高质量的缩略图。你可以使用 JAI 来做，但是它需要比你想象的更多的工作才能得到看起来不错的东西，而且 JAI 有一个讨厌的习惯，就是用 OutOfMemory 错误来炸毁我们的 JVM。

如果您可以摆脱它，我建议使用 ImageMagick 作为外部可执行文件。它使用简单，并且可以正确完成工作，因此您不必这样做。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-07-29T18:51:19.783

如果可以选择在您的机器上安装 imagemagick，我推荐[im4java](http://im4java.sourceforge.net/)。它是命令行界面上的一个非常薄的抽象层，但它的工作做得很好。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2013-04-18T07:04:21.860

Java API 不为图像和降级图像质量提供标准缩放功能。

因此，我尝试使用 JavaCV 中的 cvResize ，但它似乎会导致问题。

我找到了一个很好的图像缩放库：只需在 pom.xml 中添加“java-image-scaling”的依赖项。

```
<dependency>
    <groupId>com.mortennobel</groupId>
    <artifactId>java-image-scaling</artifactId>
    <version>0.8.6</version>
</dependency> 
```

在 Maven 存储库中，您将获得最新版本。

前任。在你的 java 程序中

```
ResampleOp resamOp = new ResampleOp(50, 40);
BufferedImage modifiedImage = resamOp.filter(originalBufferedImage, null); 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-04-11T17:12:35.457

您可以尝试使用带有[im4java的](http://im4java.sourceforge.net/)[GraphicsMagick 图像处理系统](http://www.graphicsmagick.org/)作为 Java 的命令行接口。

GraphicsMagick 有很多优点，但只有一个优点：

*   GM 用于处理世界上最大的照片网站（例如 Flickr 和 Etsy）上的数十亿个文件。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-09-02T17:52:55.760

已经提到了 Image Magick。有一个名为 JMagick 的 JNI 前端项目。这不是一个特别稳定的项目（众所周知，Image Magick 本身会发生很大变化，甚至会破坏兼容性）。也就是说，我们在生产环境中使用 JMagick 和兼容版本的 Image Magick 以高吞吐量、低延迟率执行缩放有很好的经验。与我们之前尝试过的全 Java 图形库相比，速度要好得多。

[http://www.jmagick.org/index.html](http://www.jmagick.org/index.html)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-03-12T01:31:07.070

您可以使用 Marvin（纯 Java 图像处理框架）进行此类操作： http: [//marvinproject.sourceforge.net](http://marvinproject.sourceforge.net)

缩放插件： http: [//marvinproject.sourceforge.net/en/plugins/scale.html](http://marvinproject.sourceforge.net/en/plugins/scale.html)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2016-08-04T18:52:21.397

只需使用 Burkhard 的答案，但在创建图形后添加这一行：

```
 g.setRenderingHint(RenderingHints.KEY_INTERPOLATION, RenderingHints.VALUE_INTERPOLATION_BILINEAR); 
```

您也可以将值设置为 BICUBIC，它会产生质量更好的图像，但操作成本更高。您可以设置其他渲染提示，但我发现插值会产生最显着的效果。请记住，如果您想放大很多，java 代码很可能会很慢。我发现较大的图像开始产生大约 300% 的缩放延迟，即使所有渲染提示都设置为优化速度而不是质量。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2018-01-15T14:55:37.183

事实证明，编写高性能缩放器并非易事。我为一个开源项目做过一次：[ImageScaler](https://bitbucket.org/nuclos/nuclos/src/4744685e632dfdac79e3fd4a11a077a01654e9db/nuclos-client/src/main/java/org/nuclos/client/image/ImageScaler.java?at=master&fileviewer=file-view-default "图像缩放器")。

原则上，'java.awt.Image#getScaledInstance(int, int, int)' 也可以完成这项工作，但有一个讨厌的错误 - 请参阅我的链接了解详细信息。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-02-26T13:58:49.903

我开发了一个解决方案，其中包含可用于处理 GIF 动画的免费类（AnimatedGifEncoder、GifDecoder 和 LWZEncoder）。
您可以下载 jgifcode jar 并运行 GifImageUtil 类。链接： [http ://www.jgifcode.com](http://www.jgifcode.com)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-12-04T08:14:46.390

您可以使用以下流行产品：[thumbnailator](https://code.google.com/p/thumbnailator/)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2016-05-14T15:35:42.540

如果您不想像上面我测试过的@Riyad Kalla 答案那样导入[imgScalr](https://github.com/thebuzzmedia/imgscalr)也可以正常工作，那么您可以从[Peter Walser 的答案](https://stackoverflow.com/questions/19654017/resizing-bufferedimages-and-storing-them-to-file-results-in-black-background-for)@Peter Walser 中获取关于另一个问题的答案：

```
 /**
     * utility method to get an icon from the resources of this class
     * @param name the name of the icon
     * @return the icon, or null if the icon wasn't found.
     */
    public Icon getIcon(String name) {
        Icon icon = null;
        URL url = null;
        ImageIcon imgicon = null;
        BufferedImage scaledImage = null;
        try {
            url = getClass().getResource(name);

            icon = new ImageIcon(url);
            if (icon == null) {
                System.out.println("Couldn't find " + url);
            }

            BufferedImage bi = new BufferedImage(
                    icon.getIconWidth(),
                    icon.getIconHeight(),
                    BufferedImage.TYPE_INT_RGB);
            Graphics g = bi.createGraphics();
            // paint the Icon to the BufferedImage.
            icon.paintIcon(null, g, 0,0);
            g.dispose();

            bi = resizeImage(bi,30,30);
            scaledImage = bi;// or replace with this line Scalr.resize(bi, 30,30);
            imgicon = new ImageIcon(scaledImage);

        } catch (Exception e) {
            System.out.println("Couldn't find " + getClass().getName() + "/" + name);
            e.printStackTrace();
        }
        return imgicon;
    }

 public static BufferedImage resizeImage (BufferedImage image, int areaWidth, int areaHeight) {
        float scaleX = (float) areaWidth / image.getWidth();
        float scaleY = (float) areaHeight / image.getHeight();
        float scale = Math.min(scaleX, scaleY);
        int w = Math.round(image.getWidth() * scale);
        int h = Math.round(image.getHeight() * scale);

        int type = image.getTransparency() == Transparency.OPAQUE ? BufferedImage.TYPE_INT_RGB : BufferedImage.TYPE_INT_ARGB;

        boolean scaleDown = scale < 1;

        if (scaleDown) {
            // multi-pass bilinear div 2
            int currentW = image.getWidth();
            int currentH = image.getHeight();
            BufferedImage resized = image;
            while (currentW > w || currentH > h) {
                currentW = Math.max(w, currentW / 2);
                currentH = Math.max(h, currentH / 2);

                BufferedImage temp = new BufferedImage(currentW, currentH, type);
                Graphics2D g2 = temp.createGraphics();
                g2.setRenderingHint(RenderingHints.KEY_INTERPOLATION, RenderingHints.VALUE_INTERPOLATION_BILINEAR);
                g2.drawImage(resized, 0, 0, currentW, currentH, null);
                g2.dispose();
                resized = temp;
            }
            return resized;
        } else {
            Object hint = scale > 2 ? RenderingHints.VALUE_INTERPOLATION_BICUBIC : RenderingHints.VALUE_INTERPOLATION_BILINEAR;

            BufferedImage resized = new BufferedImage(w, h, BufferedImage.TYPE_INT_ARGB);
            Graphics2D g2 = resized.createGraphics();
            g2.setRenderingHint(RenderingHints.KEY_INTERPOLATION, hint);
            g2.drawImage(image, 0, 0, w, h, null);
            g2.dispose();
            return resized;
        }
    } 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2019-12-15T22:30:20.727

试试下面的方法：

```
ImageIcon icon = new ImageIcon("image.png");
Image img = icon.getImage();
Image newImg = img.getScaledInstance(350, 350, java.evt.Image.SCALE_SMOOTH);
icon = new ImageIcon(img);
JOptionPane.showMessageDialog(null, "image on The frame", "Display Image", JOptionPane.INFORMATION_MESSAGE, icon); 
```

# language-agnostic - 是否有可用的开源 CAPTCHA 解决方案？

> ID：244179
> 
> 赞同：10
> 
> 时间：2008-10-28T17:50:44.280
> 
> 标签：language-agnostic, validation, captcha

我正在向我的一个网站添加 CAPTCHA 验证，并且需要知道存在哪些开源解决方案。请注意优势和劣势以及它们使用的平台。我主要对 ASP.NET 解决方案感兴趣，但可以随意包含 PHP、Java 等。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-28T17:53:31.857

[ReCAPTCHA](http://recaptcha.net/whyrecaptcha.html)与 StackOverflow 使用的相同。它有一个[ASP.NET 实现](http://recaptcha.net/plugins/aspnet/)。

它使用网络服务来提供验证码图像；这是一所试图数字化难于 OCR 文本的大学。我不确定更换这部分有多么容易。有许多[开源客户端实现](http://code.google.com/p/recaptcha/)，因为 API 有[很好的文档记录](http://recaptcha.net/apidocs/captcha/client.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T17:55:08.703

Jeff Atwood 在他的[编码恐怖](http://www.codinghorror.com/blog/archives/000094.html)网站上有一个验证码控制 + 源

[ReCaptcha](http://recaptcha.net/)可能是另一种选择，但我不认为来源是开放的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T11:26:14.730

你见过[JCaptcha](http://jcaptcha.sourceforge.net/)吗？不是 ASP 框架，但可能有用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-14T07:08:49.257

试试这个... [http://www.codeproject.com/aspnet/CaptchaImage.asp](http://www.codeproject.com/aspnet/CaptchaImage.asp)非常好的文章！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-18T12:44:11.207

在 Java 世界中，请查看[JCaptcha](http://jcaptcha.sourceforge.net/)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-03-15T08:44:30.817

我刚刚发现但尚未尝试过的一个是[MyCaptcha](http://mycaptcha.codeplex.com/releases/view/34719)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-03-31T21:09:51.760

ReCaptcha 有很多好处。谷歌拥有它的事实是一大优势。我们曾经在我的项目中使用 ReCaptcha，但是我们生产环境中的防火墙无法处理基于域名的添加条目，只能基于 IP 地址。ReCaptcha 已切换到使用 Google 的基础设施，因此 IP 地址不再公开可用。我们的生产环境被锁定得非常严密，所以没有变通办法——我们必须开始使用新的验证码。如果你在我的船上，ReCaptcha 不会为你工作。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-28T17:54:42.683

你看过[ReCAPTCHA](http://recaptcha.net/)吗？

# msbuild - MSBuild 社区任务中的“找不到文件”——哪个文件？

> ID：244181
> 
> 赞同：3
> 
> 时间：2008-10-28T17:51:31.643
> 
> 标签：msbuild, msbuild-task, msbuildcommunitytasks, vssget

我正在尝试使用 MSBuild 社区任务的 VssGet 任务，并且错误消息“找不到文件或项目”正在用棍子殴打我。我无法弄清楚错误消息具体指的是什么。这是任务：

```
<LocalFilePath Include="C:\Documents and Settings\michaelc\My Documents\Visual Studio 2005\Projects\Astronom\Astronom.sln" />

<VssGet DatabasePath="\\ofmapoly003\Individual\michaelc\VSS\Astronom_VSS\srcsafe.ini" 
     Path="$/Astronom_VSS" 
        LocalPath="@(LocalFilePath)" 
        UserName="build" Password="build" 
     Recursive="True" /> 
```

如果我编写一个 Streamreader 来读取数据库路径或本地路径，它会成功。因此，通往一切的道路似乎是可以访问的。有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T18:10:52.073

两个想法。一，有时类型加载异常表现为 FNF - 希望不是这样。但如果代码实际上是诚实的，您可以使用[Procmon](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)或[Filemon](http://technet.microsoft.com/en-us/sysinternals/bb896642.aspx)跟踪问题。启动其中一个实用程序，然后再次运行您的任务。您应该能够找到无法定位的文件记录。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T21:20:08.167

@着名的hamsandwich这是一个很好的回应——我以前没有听说过procmon或filemon。在问题上尝试了 procmon，但即使在筛选了相关输出之后（我的天哪，机器在屏幕后面做的事情比我意识到的要多得多）我找不到我引用的文件没有被发现.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T15:48:45.433

Procmon 和 Filemon 是很好的建议 - 只要确保您过滤结果以仅显示错误。否则成功消息将掩埋问题条目。此外，您可以过滤掉没有故障的进程（通过过滤器对话框或右键单击条目并选择“排除进程”。）

其他几个想法：

*   在 LocalFilePath 中，您指定的是单个文件而不是文件夹。另一方面，该任务指定以递归方式获取文件。也许您需要从 LocalFilePath 中删除“\Astronom.sln”？
*   构建任务是在您的帐户下运行还是在其他帐户下运行？您可能有权限问题
*   您是否已经在同一位置下载了一份代码副本？也许无法覆盖现有文件/文件夹？

# javascript - 如何在网站内容加载时显示加载屏幕

> ID：244183
> 
> 赞同：28
> 
> 时间：2008-10-28T17:52:25.167
> 
> 标签：javascript, html, css, loading, pageload

我正在一个包含一大堆 mp3 和图像的网站上工作，我想在所有内容加载时显示加载 gif。

我不知道如何实现这一点，但我确实有我想要使用的动画 gif。

有什么建议么？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-10-28T17:55:17.550

通常，通过 ajax 加载内容并监听`readystatechanged`事件以使用加载 GIF 或内容更新 DOM 来执行此操作的站点。

您目前如何加载您的内容？

代码将与此类似：

```
function load(url) {
    // display loading image here...
    document.getElementById('loadingImg').visible = true;
    // request your data...
    var req = new XMLHttpRequest();
    req.open("POST", url, true);

    req.onreadystatechange = function () {
        if (req.readyState == 4 && req.status == 200) {
            // content is loaded...hide the gif and display the content...
            if (req.responseText) {
                document.getElementById('content').innerHTML = req.responseText;
                document.getElementById('loadingImg').visible = false;
            }
        }
    };
    request.send(vars);
} 
```

有很多 3rd 方 javascript 库可以让您的生活更轻松，但以上内容确实是您所需要的。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2010-11-04T19:43:43.530

您说您不想在 AJAX 中执行此操作。虽然 AJAX 对此非常有用，但有一种方法可以在等待整个 DIV`<body>`加载的同时显示一个 DIV。它是这样的：

```
<html>
  <head>
    <style media="screen" type="text/css">
      .layer1_class { position: absolute; z-index: 1; top: 100px; left: 0px; visibility: visible; }
      .layer2_class { position: absolute; z-index: 2; top: 10px; left: 10px; visibility: hidden }
    </style>
    <script>
      function downLoad(){
        if (document.all){
            document.all["layer1"].style.visibility="hidden";
            document.all["layer2"].style.visibility="visible";
        } else if (document.getElementById){
            node = document.getElementById("layer1").style.visibility='hidden';
            node = document.getElementById("layer2").style.visibility='visible';
        }
      }
    </script>
  </head>
  <body onload="downLoad()">
    <div id="layer1" class="layer1_class">
      <table width="100%">
        <tr>
          <td align="center"><strong><em>Please wait while this page is loading...</em></strong></p></td>
        </tr>
      </table>
    </div>
    <div id="layer2" class="layer2_class">
        <script type="text/javascript">
                alert('Just holding things up here.  While you are reading this, the body of the page is not loading and the onload event is being delayed');
        </script>
        Final content.      
    </div>
  </body>
</html> 
```

在所有页面加载完成之前，onload 事件不会触发。`<DIV>`因此，在页面完成加载之前，不会显示layer2 ，之后会触发 onload。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2014-12-07T07:31:36.290

用 jQuery 怎么样？一个简单的...

```
$(window).load(function() {      //Do the code in the {}s when the window has loaded 
  $("#loader").fadeOut("fast");  //Fade out the #loader div
}); 
```

**和HTML...**

```
<div id="loader"></div> 
```

**和CSS...**

```
#loader {
      width: 100%;
      height: 100%;
      background-color: white;
      margin: 0;
} 
```

然后在您的加载器中`div`，您将放置 GIF 以及您想要的任何文本，一旦页面加载，它就会淡出。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-12-31T21:57:58.173

首先，在 div 中设置加载图像。接下来，获取 div 元素。然后，设置一个编辑 css 的函数以使可见性“隐藏”。现在，在 中`<body>`，将 onload 放到函数名中。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-04-21T11:33:07.953

**#纯css方法**

> 将其放在代码的顶部（在标题标签之前）

```
<style> .loader {
  position: fixed;
  background-color: #FFF;
  opacity: 1;
  height: 100%;
  width: 100%;
  top: 0;
  left: 0;
  z-index: 10;
}
</style>
```

```
<div class="loader">
  Your Content For Load Screen
</div>
```

> 这是在所有其他代码之后的底部（/html 标记除外）

```
<style>
.loader {
    -webkit-animation: load-out 1s;
    animation: load-out 1s;
    -webkit-animation-fill-mode: forwards;
    animation-fill-mode: forwards;
}

@-webkit-keyframes load-out {
    from {
        top: 0;
        opacity: 1;
    }

    to {
        top: 100%;
        opacity: 0;
    }
}

@keyframes load-out {
    from {
        top: 0;
        opacity: 1;
    }

    to {
        top: 100%;
        opacity: 0;
    }
}
</style>
```

> > 这对我来说总是 100% 的时间

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-06-29T03:32:11.040

实际上有一个非常简单的方法可以做到这一点。代码应该是这样的：

```
<script type="test/javascript">

    function showcontent(x){

      if(window.XMLHttpRequest) {
        xmlhttp = new XMLHttpRequest();
      } else {
        xmlhttp = new ActiveXObject('Microsoft.XMLHTTP');
      }

      xmlhttp.onreadystatechange = function() {
        if(xmlhttp.readyState == 1) {
            document.getElementById('content').innerHTML = "<img src='loading.gif' />";
        }
        if(xmlhttp.readyState == 4 && xmlhttp.status == 200) {
          document.getElementById('content').innerHTML = xmlhttp.responseText;
        } 
      }

      xmlhttp.open('POST', x+'.html', true);
      xmlhttp.setRequestHeader('Content-type','application/x-www-form-urlencoded');
      xmlhttp.send(null);

    } 
```

在 HTML 中：

```
<body onload="showcontent(main)"> <!-- onload optional -->
<div id="content"><img src="loading.gif"></div> <!-- leave img out if not onload -->
</body> 
```

我在我的页面上做了类似的事情，效果很好。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-01-08T20:33:13.130

您可以`<progress>`在 HTML5 中使用元素。有关源代码和现场演示，请参阅此页面。[http://purpledesign.in/blog/super-cool-loading-bar-html5/](http://purpledesign.in/blog/super-cool-loading-bar-html5/)

这是进度元素...

```
<progress id="progressbar" value="20" max="100"></progress> 
```

这将具有从 20 开始的加载值。当然只有元素是不够的。您需要在脚本加载时移动它。为此，我们需要 JQuery。这是一个简单的 JQuery 脚本，它从 0 到 100 开始进度，并在定义的时间段内执行某些操作。

```
<script>
        $(document).ready(function() {
         if(!Modernizr.meter){
         alert('Sorry your brower does not support HTML5 progress bar');
         } else {
         var progressbar = $('#progressbar'),
         max = progressbar.attr('max'),
         time = (1000/max)*10, 
         value = progressbar.val();
        var loading = function() {
        value += 1;
        addValue = progressbar.val(value);
        $('.progress-value').html(value + '%');
        if (value == max) {
        clearInterval(animate);
        //Do Something
 }
if (value == 16) {
//Do something 
}
if (value == 38) {
//Do something
}
if (value == 55) {
//Do something 
}
if (value == 72) {
//Do something 
}
if (value == 1) {
//Do something 
}
if (value == 86) {
//Do something 
    }

};
var animate = setInterval(function() {
loading();
}, time);
};
});
</script> 
```

将此添加到您的 HTML 文件中。

```
<div class="demo-wrapper html5-progress-bar">
<div class="progress-bar-wrapper">
 <progress id="progressbar" value="0" max="100"></progress>
 <span class="progress-value">0%</span>
</div>
 </div> 
```

希望这会给你一个开始。

# sql-server-2005 - 是什么导致从 SQL Server Reporting Services 导出 Excel 生成异常大的文件？

> ID：244184
> 
> 赞同：4
> 
> 时间：2008-10-28T17:53:00.423
> 
> 标签：sql-server-2005, excel, reporting-services

我们有相对简单的 Reporting Services 报告，我们的用户通常会导出到 Excel。我注意到 Excel 导出生成的文件看起来异常大。如果我打开其中一个文件并单击保存，而不进行任何更改，则文件大小会减小到原来大小的一半左右。有没有其他人遇到过这种情况，是否有已知的解决方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T16:03:18.567

您提到报告相对简单，但检查这一点很重要。导出到 Excel 将竭尽全力尝试和维护您的报告的外观。

如果您有很多不同的边框或颜色（特别是如果报告中的数据决定了不同的格式），这会使文件膨胀。

还要检查是否在导出的工作表中创建了许多具有非常小和异常大小的列。导出这样做是为了尝试将 Excel 中的对齐方式与原始报告匹配。

尝试将您的报告重新创建为没有格式或页眉/页脚的基本表格，看看是否可以重现问题。如果 Excel 的行为是可以接受的，则将每个格式添加回去，直到它出错。请让我们知道您发现了什么。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-06T21:14:56.780

我没有立竿见影的解决方案，但 Excel 中的一个常见问题是文件膨胀，因为一个/部分/所有工作表已保存所有 64K 行而不是正在使用的行。Excel 中的修复方法是选择所有未使用的较低行并将其删除，然后保存电子表格，关闭并重新打开。因此，我会追求在导出中保存额外行的角度，看看是否有办法防止这种情况发生。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T08:55:15.720

导出到 Excel 时使用什么工具？

我还设法通过将 Excel 工作表复制到另一个工作表，然后删除原始工作表来减少我的 Excel 工作表中的行数。

您也可以尝试仅复制工作表中的数据，然后将其粘贴到新的 Excel 工作簿（文件）中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-06-27T19:51:08.687

我遇到的问题是导出的 Excel 文件需要很长时间才能打开，并且每次单击单元格时它们都会停止响应。

此外，额外和合并的列将出现在导出的 Excel 文件中。

解决方法是确保我的标题文本框与其下方数据表中的列的开头和结尾对齐。两者对齐后，导出的 Excel 电子表格中不再有多余的列，性能恢复正常。

这是帮助我理解问题的参考资料：http: [//www.codegur.press/12747988/issue-report-export-to-excel-in-rdlc-report](http://www.codegur.press/12747988/issue-report-export-to-excel-in-rdlc-report)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-28T23:33:27.767

可能是我很晚才回答你的问题。这是导出到 CSV 的解决方案。

您需要为设计器中的字段（而不是列名）提供一个您希望看到的名称作为列标题。

默认情况下，所有文本标题都与表格列一起导出为单独的列，并确保在属性中使用您想要查看的名称命名设计名称。

关于设置为 Auto 的选项的另一重要注意事项，`DataElementOutput`意味着它将被导出。如果您不希望它被导出，您可以更改它。

最后但并非最不重要的一件事......在您导出数据后看起来一团糟。您需要选择整个第一列并转到`Data tab`- > `convert text to column`- >`use the delimiter`逗号并说 Finish。那应该可以解决您的问题。

# sql-server - 如何删除 SSIS 中的 excel 行？

> ID：244185
> 
> 赞同：5
> 
> 时间：2008-10-28T17:53:06.710
> 
> 标签：sql-server, ssis, etl

是否可以从 SSIS 删除 Excel 工作表中的行？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-28T17:58:02.737

来自[论坛](http://www.sqlservercentral.com/Forums/Topic328124-148-1.aspx)

1.  在控制流中创建文件系统任务，删除文件。
2.  创建一个 sql 任务，excel 连接类型，我使用我之前的 excel 连接，然后使用创建表脚本作为我的 sql 语句
3.  让我之前的导出对象保持不变，然后按照描述的顺序链接这些流。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-06T21:51:55.113

微软的一个 arctile 声称您不能删除整行，但是您可以删除单元格中的值。[http://support.microsoft.com/kb/257819](http://support.microsoft.com/kb/257819)

这个线程与有同样问题的人有关： [http ://www.tech-archive.net/Archive/DotNet/microsoft.public.dotnet.framework.adonet/2006-12/msg00245.html](http://www.tech-archive.net/Archive/DotNet/microsoft.public.dotnet.framework.adonet/2006-12/msg00245.html)

简而言之，答案似乎是“不”，您不能通过 SSIS 使用 ado.net 删除整行。您可以在 excel 本身中使用 excel 自动化或 vb.net 来完成此任务。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2017-10-10T21:36:15.567

我也按照 Gulzar 建议的步骤进行了操作，但是，如果有人想要详细信息，这就是我所做的：

我最初的任务是从 SQL Server 读取一些信息并将其导出到 Excel：

[![在此处输入图像描述](https://i.stack.imgur.com/DArTs.png)](https://i.stack.imgur.com/DArTs.png)

然后我添加了建议的任务，一个是删除目标 Excel 文件，另一个是重新创建它：

[![在此处输入图像描述](https://i.stack.imgur.com/N1bok.png)](https://i.stack.imgur.com/N1bok.png)

这是删除文件的任务，它是“文件系统任务”：

[![在此处输入图像描述](https://i.stack.imgur.com/ifi9T.png)](https://i.stack.imgur.com/ifi9T.png)

这是重新创建 Excel 文件的任务，它是“执行 SQL 任务”：

[![在此处输入图像描述](https://i.stack.imgur.com/ah0PS.png)](https://i.stack.imgur.com/ah0PS.png)

需要为此“执行 SQL 任务”设置以下内容：

一个。连接类型是“Excel”

湾。如建议的那样，连接与原始导出任务使用的连接相同

C。SQL 语句是从原始导出任务中复制的

基本上就是这样。运行它，它应该可以工作。我与 SQL Server 的连接如下所示：

[![在此处输入图像描述](https://i.stack.imgur.com/vKqT4.png)](https://i.stack.imgur.com/vKqT4.png)

我的 Excel 连接最初是在创建导出任务时创建的，如下所示：

[![在此处输入图像描述](https://i.stack.imgur.com/YXJP5.png)](https://i.stack.imgur.com/YXJP5.png)

在“数据流”部分，使用Source Assistant，原来的“OLE DB Source”有这样的：

[![在此处输入图像描述](https://i.stack.imgur.com/LvVVN.png)](https://i.stack.imgur.com/LvVVN.png)

并且，使用目标助手，原始 Excel 目标具有以下内容：

[![在此处输入图像描述](https://i.stack.imgur.com/FRQR1.png)](https://i.stack.imgur.com/FRQR1.png)

这是我从原始 Excel 目标复制的 SQL 语句：

[![在此处输入图像描述](https://i.stack.imgur.com/dQyLM.png)](https://i.stack.imgur.com/dQyLM.png)

# java - 你对方法范围的常量有什么看法？

> ID：244191
> 
> 赞同：29
> 
> 时间：2008-10-28T17:55:30.263
> 
> 标签：java, constants

例如：

```
public void doSomething() {

    final double MIN_INTEREST = 0.0;

    // ...  
} 
```

就个人而言，我宁愿看到这些替换常量在类级别静态声明。我想我正在寻找关于此事的“行业观点”。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-10-28T18:00:28.210

我认为如果它们被多种方法使用，你应该只将它们放在类级别。如果仅在该方法中使用它，那对我来说很好。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-10-28T18:26:48.703

我的出发点是每个变量或常量都应该被声明/初始化为尽可能接近它的第一次使用/实用（即不要将逻辑代码块分成两半，只是为了声明更近的几行），并且范围为尽可能紧密。——除非你能给我一个该死的好理由为什么它应该不同。

例如，作用域为 final 的方法在公共 API 中不可见。有时，这些信息可能对您班级的用户没有用处，应该向上移动。

在您在问题中给出的示例中，我会说 MIN_INTEREST 可能是用户希望获得的那些信息之一，并且它的范围应该是类，而不是方法。（虽然，示例代码没有上下文，我的假设可能完全错误。）

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-11-07T02:04:58.720

从技术上讲，Java 中不存在“方法范围的常量”之类的东西。您所指的只是一个最终的局部变量；每次方法调用都会创建一个销毁的。

[http://www.java-tips.org/java-se-tips/java.lang/how-do-i-declare-a-constant-in-java.html](http://www.java-tips.org/java-se-tips/java.lang/how-do-i-declare-a-constant-in-java.html)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-28T18:17:04.947

我自己也使用过这种方法作用域常量，但有时同事会在代码审查期间对其进行修改。同样，这些同事不喜欢阅读/编写开源软件，但他们习惯于企业软件。

我告诉他们，如果在单个方法中使用类级别常量是没有意义的，但我发现不止一位同事坚持将其向上移动。我通常会遵守，因为除非它影响可读性和/或性能，否则我不会那么死板。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-28T18:45:51.567

信息隐藏和模块化是关键原则，缩小范围是更好的信息隐藏。如果只有方法需要该常量，则隐藏是好的。如果常量在其他地方有用，请将其扩展到更广泛的范围，但仅限于需要的范围。

您可能会担心，因为这是一个常数，因此，它可能似乎属于某个全局属性表。也许确实如此。也许不是。您的担忧是有道理的，但没有一个最适合所有常量的地方。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-02-25T19:38:27.433

我对此有不同的看法：恕我直言，最好将它们放在文件/类范围内，特别是如果您出于这个原因在团队中工作：假设您从一小段代码开始......

```
public void doSomething() {

  final double MIN_INTEREST = 0.0;

  // ...  
} 
```

和你团队的其他成员用一大堆方法扩展了这个类，现在这个类是一个很棒`500 lines`/`50 methods`巨大的类。想象一下工程师尝试使用常量添加新方法的经历，他们将不得不`1`扫描整个类以寻找符合他们需要的常量，`2`将常量移动到类范围，希望与现有代码没有冲突，并且`3`也添加他们的方法。

如果您改为在文件/类范围内添加所有常量，工程师可以在`1`一个地方查找现有常量，并`2`从其他有意义的常量中派生一些常量。（例如，如果您有一个常量，`pi`您可能还想定义一个值为 的新常量`pi/2`）。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-10-28T18:01:07.600

您可以在类级别或方法（本地）级别定义最终变量的原因是您可以覆盖（本地）方法内部的全局静态常量。

例子：

```
public class Test {

    final double MIN_INTEREST = 0.0;

    /**
     * @param args
     */
    public static void main(String[] args) {

        Test test = new Test();

        test.doSomethingLocal();
        test.doSomethingGlobal();

    }

    public void doSomethingGlobal() {

        System.out.println("Global-> " + MIN_INTEREST);

    }

    public void doSomethingLocal() {

        final double MIN_INTEREST = 0.1;

        System.out.println("Local-> " + MIN_INTEREST);

    }
} 
```

输出将是：

```
Local-> 0.1
Global-> 0.0 
```

所以你的问题没有任何意义。

# c# - 如何在 C# Regex 中使用“或”、“和”？

> ID：244192
> 
> 赞同：0
> 
> 时间：2008-10-28T17:55:41.073
> 
> 标签：c#, regex

我有一个与字符串匹配的模式：string pattern = @"asc" 我正在检查 SQL SELECT 查询是否有正确的语法、语义......我需要说在查询字符串的末尾我可以有 "asc ”或“描述”。如何用 C# 编写？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T17:58:03.643

那看起来像

```
new Regex("asc$|desc$").IsMatch(yourQuery) 
```

假设您要求 asc/desc 是查询的结尾。您也可以`(?:asc|desc)$`使用 single 更简洁一些`$`，但可读性较差。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T17:57:54.970

您需要“交替”运算符，即管道。

例如，我相信这将表示为：

```
asc|desc 
```

如果你想让它成为一个非捕获组，你可以用正常的方式来做。我不是正则表达式专家，但这是首先要尝试的。

编辑：MSDN 有一个关于[正则表达式语言元素](http://msdn.microsoft.com/en-us/library/az24scfc.aspx)的页面，可以帮助你。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T18:01:27.893

只是为了添加其他答案，您可能还想对正则表达式应用忽略大小写选项。

```
string tempString = "SELECT * FROM MyTable ORDER BY column DESC";

Regex r = new Regex("asc$|desc$", RegexOptions.CultureInvariant | RegexOptions.IgnoreCase);

bool answer = r.IsMatch(tempString); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T18:04:17.623

我认为以下内容可以作为.Net中的正则表达式：

```
asc|desc\z 
```

..它将匹配行尾和字符串尾。如果您只想结束字符串，请尝试：

```
asc|desc$ 
```

# sql - MySQL COUNT(DISTINCT()) 意外结果

> ID：244208
> 
> 赞同：3
> 
> 时间：2008-10-28T17:59:20.693
> 
> 标签：sql, mysql

我在 CentOS 5.1 上使用 MySQL 5.0.45。

`SELECT DISTINCT(email) FROM newsletter`

返回 217259 行

`SELECT COUNT(DISTINCT(email)) FROM newsletter`

返回 180698 作为计数。

`SELECT COUNT(*) FROM (SELECT DISTINCT(email) FROM newsletter) AS foo`

返回 180698 作为计数。

不应该所有 3 个查询都返回相同的值吗？

这是时事通讯表的架构

```
CREATE TABLE `newsletter` (
  `newsID` int(11) NOT NULL auto_increment,
  `email` varchar(128) NOT NULL default '',
  `newsletter` varchar(8) NOT NULL default '',
  主键（`newsID`）
) 引擎=MyISAM;

```

**更新：**我发现如果我在`WHERE`第一个查询中添加一个子句，那么我会得到正确的结果。该`WHERE`条款不会影响结果。

`SELECT DISTINCT(email) FROM newsletter WHERE newsID > 0`

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T18:03:55.207

您能否将不同的结果相交以查看额外的行是什么？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T19:06:11.900

我的猜测是电子邮件列中有一些空值。尝试

```
select count(*) from newsletter where email is null; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T18:13:12.067

在第一种情况下，如果将其更改为“ `select distinct(email) from newsletter order by email;`”会发生什么，我认为它不会产生影响，但它可能会产生影响。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T19:11:13.947

是的，正如 Maglob[所说](https://stackoverflow.com/questions/244208/mysql-countdistinct-unexpected-results#244435)，您的电子邮件列中可能会出现一些 NULL。尝试类似：

```
SELECT COUNT(COALESCE(email, 0)) FROM newsletter 
```

这会给你你期望的结果。等一下。定义说电子邮件不接受 NULL 值。如果真是这样，那就太奇怪了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-28T19:16:24.313

一种可能的解释是在您的两个查询之间从表中删除了行。但我假设你已经以不同的顺序多次运行这些，所以我怀疑就是这样。

你从这个查询中得到多少行数：

```
SELECT email FROM newsletter GROUP BY email; 
```

# c# - 排序列表 降序

> ID：244219
> 
> 赞同：51
> 
> 时间：2008-10-28T18:02:08.847
> 
> 标签：c#, sorting, lambda

在 c#（3.0 或 3.5，所以我们可以使用 lambdas）中，是否有一种优雅的方式可以按降序对日期列表进行排序？我知道我可以做一个直接的排序，然后把整个事情颠倒过来，

```
docs.Sort((x, y) => x.StoredDate.CompareTo(y.StoredDate));
docs.Reverse(); 
```

但是是否有一个 lambda 表达式可以一步完成？

在上面的示例中，StoredDate 是一个类型为 DateTime 的属性。

* * *

## 回答 #1

> 赞同：86
> 
> 时间：2008-10-28T18:04:16.220

虽然未经测试...

```
docs.Sort((x, y) => y.StoredDate.CompareTo(x.StoredDate)); 
```

应该与您最初拥有的相反。

* * *

## 回答 #2

> 赞同：64
> 
> 时间：2011-11-03T22:13:39.433

有什么问题：

```
docs.OrderByDescending(d => d.StoredDate); 
```

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2008-10-28T18:03:08.517

```
docs.Sort((x, y) => y.StoredDate.CompareTo(x.StoredDate)); 
```

应该做你正在寻找的东西。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-28T18:04:15.660

```
docs.Sort((x, y) => -x.StoredDate.CompareTo(y.StoredDate)); 
```

注意减号。

# asp.net - 如何让 ASP.NET AJAX 使用 GZip 压缩发送其 JSON 响应？

> ID：244222
> 
> 赞同：12
> 
> 时间：2008-10-28T18:03:24.740
> 
> 标签：asp.net, ajax, json, gzip

我在 IIS7 中启用了压缩，它在所有响应上都按预期工作，除了那些由 ASP.NET AJAX 构建的响应。我有一个向客户端提供数据的 Web 服务。直接调用 Web 服务时，它被正确压缩。但是，当它通过 ASP.NET AJAX 调用时，JSON 响应不会被压缩。

如何让 ASP.NET AJAX 使用 GZip 压缩发送其 JSON 响应？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-05T21:23:26.233

IIS7 使用 content-encoding 来决定是否压缩响应（当然假设浏览器可以接受 gzip）。它们在 applicationHost.config 中设置，默认情况下列表为

```
<dynamicTypes>
     <add mimeType="text/*" enabled="true" />
     <add mimeType="message/*" enabled="true" />
     <add mimeType="application/x-javascript" enabled="true" />
     <add mimeType="*/*" enabled="false" />
</dynamicTypes> 
```

如果您直接调用 Web 服务，则 XML 响应的内容类型为`text/xml`，它会被压缩。当被 AJAX 调用时，JSON 响应的内容类型为`application/json`，因此它没有被压缩。将以下内容添加到 applicationHost.config 应该可以解决该问题...

```
 <add mimeType="application/json" enabled="true" /> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T00:59:57.380

你使用的是什么浏览器？IE 6 中有一个错误会导致压缩错误。所以 ASP.NET AJAX 关闭了对 IE 6 浏览器的压缩：

[http://weblogs.asp.net/scottgu/archive/2005/06/28/416185.aspx](http://weblogs.asp.net/scottgu/archive/2005/06/28/416185.aspx)

另外，您是否启用了 ASMX 文件的压缩？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T08:50:27.893

一般来说，您不想这样做，除非您不介意将数量级的服务器功率投入您的应用程序......

当你这样做时，不仅服务器CPU而且客户端CPU也会成为问题......

结论是，如果您对所有 Ajax 响应进行 GZip 压缩，您的应用程序会变得更慢......！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-05T04:19:06.847

最后我检查了一下，gzipping 是 IIS 所做的（正确设置时）——当然，当浏览器发送所需的标头时

# sql - 是否可以在 MySQL 中有索引视图？

> ID：244226
> 
> 赞同：32
> 
> 时间：2008-10-28T18:04:03.723
> 
> 标签：sql, mysql, views, materialized-views, indexed-view

我[在 2005 年的 MySQL 论坛上发现了一个帖子](http://forums.mysql.com/read.php?100,22967,22967)，但没有比这更近的了。基于此，这是不可能的。但是很多东西会在 3-4 年内发生变化。

我正在寻找的是一种在视图上建立索引但让被查看的表保持未索引的方法。索引会损害写入过程，并且该表的写入频率很高（索引会减慢所有内容的爬行速度）。但是，缺少索引使我的查询非常缓慢。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-10-28T18:07:57.990

我不认为 MySQL 支持您需要的物化视图，但无论如何它在这种情况下对您没有帮助。无论索引是在视图上还是在底层表上，都需要在底层表更新期间的某个时间点进行写入和更新，因此仍然会导致写入速度问题。

您最好的选择可能是创建定期更新的汇总表。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-28T18:16:19.427

您是否考虑过从分析处理数据中抽象出事务处理数据，以便它们都可以专门化以满足其独特的需求？

基本思想是您拥有一个定期修改的数据版本，这将是事务处理方面，需要大量标准化和轻型索引，以便写入操作快速。数据的第二个版本是为分析处理而构建的，并且趋向于标准化程度较低，并且索引较多以用于快速报告操作。

围绕分析处理构建的数据通常围绕数据仓库的立方体方法构建，由表示立方体侧面的事实表和表示立方体边缘的维度表组成。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-07-17T08:59:38.510

[Flexviews](http://code.google.com/p/flexviews/)通过跟踪对基础表的更改并更新用作物化视图的表来支持 MySQL 中的物化视图。这种方法意味着视图支持的 SQL 有点受限（因为更改日志记录例程必须确定它应该跟踪哪些表的更改），但据我所知，这是您可以在 MySQL 中获得的最接近物化视图的方法.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T19:42:38.753

你只想要一个索引视图吗？写入只有一个索引的表不太可能具有破坏性。没有主键吗？

如果每条记录都很大，您可以通过弄清楚如何缩短它来提高性能。或者缩短您需要的索引长度。

如果这是一个只写表（即您不需要进行更新），那么在 MySQL 中开始归档它可能是致命的，或者以其他方式删除记录（和索引键），需要开始填充索引（重用）来自已删除键的插槽，而不仅仅是附加新的索引值。违反直觉，但在这种情况下，您最好使用更大的表。

# java - 是什么导致使用spring，tomcat和hibernate发生重复请求

> ID：244234
> 
> 赞同：6
> 
> 时间：2008-10-28T18:05:53.517
> 
> 标签：java, hibernate, spring, jsp, tomcat

我正在使用 spring 框架、hibernate 和 tomcat 开发一个 Java 项目。

背景：我有一个表单页面，它获取数据、验证、处理数据，并最终使用 hibernate 持久化数据。在处理数据时，我会在使用休眠之前进行一些特殊的命令（模型）操作。

问题：由于某种原因，我的 onSubmit 方法被调用了两次，第一次通过事情被正确处理。但是第二次不是；并且不正确的信息被保留。

我还注意到，在其他页面上，这些页面只是从数据库中提取信息并显示在屏幕上；那里也发生了双重请求。

有什么配置错误吗，我没有正确使用弹簧..对此有任何帮助都会很棒！

**附加信息：**

该应用程序仍在开发中。在测试应用程序时，我遇到了这个问题。我正在使用该应用程序，因为我希望它会被使用（单击，有效数据等......）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T21:42:46.810

如果您在 IE 中进行测试，请注意在某些版本的 IE 中它有时会提交两个请求。您在哪些浏览器中测试应用程序？

如果单击处理程序与提交按钮相关联并调用 submit() 并且不返回 false 以取消事件气泡，则会出现 javascript 问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T18:27:31.120

可能就像用户单击链接两次、在服务器仍在处理第一个请求时重新提交表单或在 POST ed 页面上点击刷新一样简单。

您是否在服务器端做任何事情来解决来自用户的重复请求，例如这些请求？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2019-07-19T06:11:59.230

这是刚起步的人面临的一个非常普遍的问题。并且对应用生态系统不太确定。为了部署一个 spring 应用程序，我们构建了 war 文件。然后我们把它放在tomcat的'webapps'文件夹中。然后我们使用终端运行tomcat实例（我假设是linux系统）。现在，我们在那个终端中设置了 env。

当我们为 spring 应用程序设置环境时，问题就出现了，其中可以部署多个 war 文件。然后我们必须迎合这样一个事实，即 env 必须是特定的 war 文件所独有的。

为了实现这一点，我们可以做的是为每场战争创建专属的环境文件。（例如war_1.sh、war_2.sh、.....、war_n.sh）等等。

现在我们可以获取我们必须为其部署相应战争的特定 env 文件。通过这种方式，我们可以隔离多个战争（应用程序）及其环境。

# c# - 如何创建 WPF 形状编辑器？

> ID：244235
> 
> 赞同：9
> 
> 时间：2008-10-28T18:06:10.180
> 
> 标签：c#, .net, wpf, editor, geometry

我正在尝试创建一个 WPF 形状（折线）编辑器，这是一个我想用来在画布中编辑形状的控件。

编辑器需要做的是能够显示形状的点和线并移动它们。

任何人都可以向我提供如何实现这一目标或起点的想法吗？到目前为止，我还没有找到任何与我如何做到这一点有关的东西。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-28T18:12:04.097

[在CodeProject](http://www.codeproject.com/)上有很多关于这方面的文章

[WPF 图表设计器 - 第 1 部分](http://www.codeproject.com/KB/WPF/WPFDiagramDesigner_Part1.aspx)

[WPF 图表设计器 - 第 2 部分](http://www.codeproject.com/KB/WPF/WPFDiagramDesigner_Part2.aspx)

[WPF 图表设计器 - 第 3 部分](http://www.codeproject.com/KB/WPF/WPFDiagramDesigner_Part3.aspx)

[WPF 图表设计器 - 第 4 部分](http://www.codeproject.com/KB/WPF/WPFDiagramDesigner_Part4.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-12-14T06:10:20.563

我还喜欢 CodeProject 上的 WPF DrawTools 文章，它有一组格式非常精美的源类。它提供了一个更简单的轮廓形状示例 - 椭圆、矩形、直线、折线和文本。不幸的是，正如有人刚刚向我指出的那样，它在 2015 年被删除。

该文章的[副本可通过 Wayback Machine 获得，](https://web.archive.org/web/20150508131046/https://www.codeproject.com/Articles/22776/WPF-DrawTools)但链接的源代码已与原始文章一起删除。这篇文章包括类图和足够的细节，让您对整体设计有一个很好的了解。

[现在我认为和服设计师](https://blog.xamarin.com/introducing-the-kimono-designer-for-skiasharp/)值得一看，虽然它似乎已经被宣布得非常激动，而且[代码](https://github.com/xamarin/KimonoDesigner?files=1)已经一年没有更新了。请注意，有一个 WPF 端口，如[本文](http://lostindetails.com/blog/post/SkiaSharp-with-Wpf)和[GitHub 上的示例中](https://github.com/8/SkiaSharp-Wpf-Example)所述。

# postgresql - 不同步时如何重置postgres的主键序列？

> ID：244243
> 
> 赞同：633
> 
> 时间：2008-10-28T18:08:21.453
> 
> 标签：postgresql, primary-key, database-sequence

我遇到了我的主键序列与我的表行不同步的问题。

也就是说，当我插入一个新行时，我得到一个重复键错误，因为串行数据类型中隐含的序列返回一个已经存在的数字。

这似乎是由于导入/恢复没有正确维护顺序引起的。

* * *

## 回答 #1

> 赞同：857
> 
> 时间：2008-10-28T18:14:13.750

```
-- Login to psql and run the following

-- What is the result?
SELECT MAX(id) FROM your_table;

-- Then run...
-- This should be higher than the last result.
SELECT nextval('your_table_id_seq');

-- If it's not higher... run this set the sequence last to your highest id. 
-- (wise to run a quick pg_dump first...)

BEGIN;
-- protect against concurrent inserts while you update the counter
LOCK TABLE your_table IN EXCLUSIVE MODE;
-- Update the sequence
SELECT setval('your_table_id_seq', COALESCE((SELECT MAX(id)+1 FROM your_table), 1), false);
COMMIT; 
```

[来源 - Ruby 论坛](http://www.ruby-forum.com/topic/64428#72333)

* * *

## 回答 #2

> 赞同：263
> 
> 时间：2010-09-13T08:19:28.987

[`pg_get_serial_sequence`](http://www.postgresql.org/docs/9.4/static/functions-info.html)可用于避免对序列名称的任何错误假设。这会一次性重置序列：

```
SELECT pg_catalog.setval(pg_get_serial_sequence('table_name', 'id'), (SELECT MAX(id) FROM table_name)+1); 
```

或更简洁地说：

```
SELECT pg_catalog.setval(pg_get_serial_sequence('table_name', 'id'), MAX(id)) FROM table_name; 
```

然而，这种形式不能正确处理空表，因为 max(id) 为空，你也不能设置 0，因为它超出了序列的范围。一种解决方法是使用`ALTER SEQUENCE`语法，即

```
ALTER SEQUENCE table_name_id_seq RESTART WITH 1;
ALTER SEQUENCE table_name_id_seq RESTART; -- 8.4 or higher 
```

但`ALTER SEQUENCE`用途有限，因为序列名称和重启值不能是表达式。

似乎最好的通用解决方案是`setval`使用 false 作为第三个参数调用，允许我们指定“下一个要使用的值”：

```
SELECT setval(pg_get_serial_sequence('t1', 'id'), coalesce(max(id),0) + 1, false) FROM t1; 
```

这勾选了我所有的框：

1.  避免对实际序列名称进行硬编码
2.  正确处理空表
3.  处理具有现有数据的表，并且不会在序列中留下漏洞

最后，请注意，`pg_get_serial_sequence`仅当序列由列拥有时才有效。如果递增列被定义为一种`serial`类型，则会出现这种情况，但是如果手动添加序列，则必须确保`ALTER SEQUENCE .. OWNED BY`也执行。

即，如果`serial`type 用于创建表，这应该都可以工作：

```
CREATE TABLE t1 (
  id serial,
  name varchar(20)
);

SELECT pg_get_serial_sequence('t1', 'id'); -- returns 't1_id_seq'

-- reset the sequence, regardless whether table has rows or not:
SELECT setval(pg_get_serial_sequence('t1', 'id'), coalesce(max(id),0) + 1, false) FROM t1; 
```

但是如果手动添加序列：

```
CREATE TABLE t2 (
  id integer NOT NULL,
  name varchar(20)
);

CREATE SEQUENCE t2_custom_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;

ALTER TABLE t2 ALTER COLUMN id SET DEFAULT nextval('t2_custom_id_seq'::regclass);

ALTER SEQUENCE t2_custom_id_seq OWNED BY t2.id; -- required for pg_get_serial_sequence

SELECT pg_get_serial_sequence('t2', 'id'); -- returns 't2_custom_id_seq'

-- reset the sequence, regardless whether table has rows or not:
SELECT setval(pg_get_serial_sequence('t2', 'id'), coalesce(max(id),0) + 1, false) FROM t1; 
```

* * *

## 回答 #3

> 赞同：160
> 
> 时间：2014-04-30T14:07:28.977

***最短最快***的方法：

```
SELECT setval('tbl_tbl_id_seq', max(tbl_id)) FROM tbl; 
```

`tbl_id`作为[`serial`](https://www.postgresql.org/docs/current/datatype-numeric.html#DATATYPE-SERIAL)table 的列`tbl`，从序列中提取`tbl_tbl_id_seq`（这是默认的自动名称）。

**如果**您不知道附加序列的名称（不必采用默认形式），请使用[**`pg_get_serial_sequence()`**](https://www.postgresql.org/docs/current/functions-info.html#FUNCTIONS-INFO-CATALOG-TABLE)：

```
SELECT setval(pg_get_serial_sequence('tbl', 'tbl_id'), max(tbl_id)) FROM tbl; 
```

这里没有一个错误。[手册：](https://www.postgresql.org/docs/current/functions-sequence.html)

> 双参数形式将序列的`last_value`字段设置为指定值并将其`is_called`字段设置为true，这意味着 **下一个`nextval`**将在返回值之前**将序列推进。**

大胆强调我的。

**如果**表可以为空*并且*在这种情况下实际上从 1 开始：

```
SELECT setval(pg_get_serial_sequence('tbl', 'tbl_id')
            , COALESCE(max(tbl_id) + 1, 1)
            , false)
FROM tbl; 
```

我们不能只使用 2 参数形式并开始，`0`因为序列的下限默认为***1***（除非自定义）。

### 并发

为了防止并发序列活动或在上述查询中写入表，请将***表锁定为***模式`SHARE`。它可以防止并发事务写入更高的数字（或任何东西）。

还要考虑到客户端可能已经提前获取了序列号，而主表上没有任何锁，但是（可能在某些设置中发生），只*增加*序列的当前值，从不减少它。它可能看起来很偏执，但这与序列的性质和防御并发问题是一致的。

```
BEGIN;

LOCK TABLE tbl IN SHARE MODE;

SELECT setval('tbl_tbl_id_seq', max(tbl_id))
FROM   tbl
HAVING max(tbl_id) > (SELECT last_value FROM tbl_tbl_id_seq); -- prevent lower number

COMMIT; 
```

`SHARE`模式足够强大。[手册：](https://www.postgresql.org/docs/13/explicit-locking.html#LOCKING-TABLES)

> 此模式保护表免受并发数据更改的影响。

它与`ROW EXCLUSIVE`模式冲突。

> 命令`UPDATE`,`DELETE`和`INSERT`在目标表上获取此锁定模式

* * *

## 回答 #4

> 赞同：64
> 
> 时间：2010-11-04T21:03:13.957

这将从公共重置所有序列，而不会对表或列名做出任何假设。在 8.4 版本上测试

```
CREATE OR REPLACE FUNCTION "reset_sequence" (tablename text, columnname text, sequence_name text) 
    RETURNS "pg_catalog"."void" AS 

    $body$  
      DECLARE 
      BEGIN 

      EXECUTE 'SELECT setval( ''' || sequence_name  || ''', ' || '(SELECT MAX(' || columnname || 
          ') FROM ' || tablename || ')' || '+1)';

      END;  

    $body$  LANGUAGE 'plpgsql';

SELECT table_name || '_' || column_name || '_seq', 
    reset_sequence(table_name, column_name, table_name || '_' || column_name || '_seq') 
FROM information_schema.columns where column_default like 'nextval%'; 
```

* * *

## 回答 #5

> 赞同：47
> 
> 时间：2008-12-10T08:29:11.830

~~ALTER SEQUENCE sequence_name RESTART WITH (SELECT max(id) FROM table_name);~~ 不工作。

复制自@tardate 答案：

```
SELECT setval(pg_get_serial_sequence('table_name', 'id'), MAX(id)) FROM table_name; 
```

* * *

## 回答 #6

> 赞同：25
> 
> 时间：2014-09-01T10:29:48.710

此命令仅用于更改 postgresql 中自动生成的键序列值

```
ALTER SEQUENCE "your_sequence_name" RESTART WITH 0; 
```

代替零，您可以输入要重新启动序列的任何数字。

默认序列名称将`"TableName_FieldName_seq"`. 例如，如果您的表名称是`"MyTable"`并且您的字段名称是`"MyID"`，那么您的序列名称将是**`"MyTable_MyID_seq"`**。

这是答案与@murugesanponappan 的答案相同，但他的解决方案中有语法错误。您不能`(select max()...)`在`alter`命令中使用子查询。因此，要么您必须使用固定数值，要么您需要使用变量来代替子查询。

* * *

## 回答 #7

> 赞同：21
> 
> 时间：2021-04-07T09:13:02.953

在下面的示例中，**表**名是`users`，**架构**名是`public`（默认架构），根据您的需要替换它。

### 1.检查最大id：

```
SELECT MAX(id) FROM public.users; 
```

### 2\. 检查下一个值：

```
SELECT nextval('public."users_id_seq"'); 
```

### 3\. 如果`next value`低于`max id`，重置它：

```
SELECT setval('public."users_id_seq"',
  (SELECT MAX(id) FROM public.users)
); 
```

### 笔记：

`nextval()`将在返回当前值之前增加序列，而`currval()`只返回当前值，如此[处](https://www.postgresql.org/docs/current/functions-sequence.html)所述。

* * *

## 回答 #8

> 赞同：20
> 
> 时间：2013-01-31T19:00:43.067

重置所有序列，除了每个表的主键是“id”之外，没有关于名称的假设：

```
CREATE OR REPLACE FUNCTION "reset_sequence" (tablename text, columnname text)
RETURNS "pg_catalog"."void" AS
$body$
DECLARE
BEGIN
    EXECUTE 'SELECT setval( pg_get_serial_sequence(''' || tablename || ''', ''' || columnname || '''),
    (SELECT COALESCE(MAX(id)+1,1) FROM ' || tablename || '), false)';
END;
$body$  LANGUAGE 'plpgsql';

select table_name || '_' || column_name || '_seq', reset_sequence(table_name, column_name) from information_schema.columns where column_default like 'nextval%'; 
```

* * *

## 回答 #9

> 赞同：13
> 
> 时间：2011-05-09T22:20:43.500

当序列名、列名、表名或模式名包含有趣的字符（如空格、标点符号等）时，这些函数充满了危险。我写了这个：

```
CREATE OR REPLACE FUNCTION sequence_max_value(oid) RETURNS bigint
VOLATILE STRICT LANGUAGE plpgsql AS  $$
DECLARE
 tabrelid oid;
 colname name;
 r record;
 newmax bigint;
BEGIN
 FOR tabrelid, colname IN SELECT attrelid, attname
               FROM pg_attribute
              WHERE (attrelid, attnum) IN (
                      SELECT adrelid::regclass,adnum
                        FROM pg_attrdef
                       WHERE oid IN (SELECT objid
                                       FROM pg_depend
                                      WHERE refobjid = $1
                                            AND classid = 'pg_attrdef'::regclass
                                    )
          ) LOOP
      FOR r IN EXECUTE 'SELECT max(' || quote_ident(colname) || ') FROM ' || tabrelid::regclass LOOP
          IF newmax IS NULL OR r.max > newmax THEN
              newmax := r.max;
          END IF;
      END LOOP;
  END LOOP;
  RETURN newmax;
END; $$ ; 
```

您可以通过将 OID 传递给单个序列来调用它，它将返回具有默认序列的任何表使用的最大数字；或者您可以使用这样的查询运行它，以重置数据库中的所有序列：

```
 select relname, setval(oid, sequence_max_value(oid))
   from pg_class
  where relkind = 'S'; 
```

使用不同的 qual 您只能重置某个模式中的序列，依此类推。例如，如果您想调整“公共”模式中的序列：

```
select relname, setval(pg_class.oid, sequence_max_value(pg_class.oid))
  from pg_class, pg_namespace
 where pg_class.relnamespace = pg_namespace.oid and
       nspname = 'public' and
       relkind = 'S'; 
```

请注意，由于 setval() 的工作方式，您不需要将 1 添加到结果中。

作为结束语，我必须警告一些数据库似乎有默认链接到序列的方式，不让系统目录具有它们的完整信息。当您在 psql 的 \d 中看到这样的内容时，就会发生这种情况：

```
alvherre=# \d baz
                     Tabla «public.baz»
 Columna |  Tipo   |                 Modificadores                  
---------+---------+------------------------------------------------
 a       | integer | default nextval(('foo_a_seq'::text)::regclass) 
```

请注意，除了 ::regclass 转换之外，该默认子句中的 nextval() 调用还有 ::text 转换。我*认为*这是由于数据库是从旧 PostgreSQL 版本进行 pg_dump 的。将会发生的是上面的函数 sequence_max_value() 将忽略这样的表。要解决此问题，您可以重新定义 DEFAULT 子句以直接引用序列而不进行强制转换：

```
alvherre=# alter table baz alter a set default nextval('foo_a_seq');
ALTER TABLE 
```

然后 psql 正确显示：

```
alvherre=# \d baz
                     Tabla «public.baz»
 Columna |  Tipo   |             Modificadores              
---------+---------+----------------------------------------
 a       | integer | default nextval('foo_a_seq'::regclass) 
```

一旦你解决了这个问题，这个函数就可以正确地用于这个表以及所有其他可能使用相同序列的表。

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2016-07-25T19:29:11.423

我建议在 postgres wiki 上找到这个解决方案。它会更新您的表格的所有序列。

```
SELECT 'SELECT SETVAL(' ||
       quote_literal(quote_ident(PGT.schemaname) || '.' || quote_ident(S.relname)) ||
       ', COALESCE(MAX(' ||quote_ident(C.attname)|| '), 1) ) FROM ' ||
       quote_ident(PGT.schemaname)|| '.'||quote_ident(T.relname)|| ';'
FROM pg_class AS S,
     pg_depend AS D,
     pg_class AS T,
     pg_attribute AS C,
     pg_tables AS PGT
WHERE S.relkind = 'S'
    AND S.oid = D.objid
    AND D.refobjid = T.oid
    AND D.refobjid = C.attrelid
    AND D.refobjsubid = C.attnum
    AND T.relname = PGT.tablename
ORDER BY S.relname; 
```

如何使用（来自 postgres wiki）：

*   将此保存到文件中，例如“reset.sql”
*   运行文件并以不包含通常标题的方式保存其输出，然后运行该输出。例子：

例子：

```
psql -Atq -f reset.sql -o temp
psql -f temp
rm temp 
```

原始文章（也修复了序列所有权）[在这里](https://wiki.postgresql.org/wiki/Fixing_Sequences)

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2017-04-20T12:10:04.230

另一个 plpgsql - 仅在以下情况下重置`max(att) > then lastval`

```
do --check seq not in sync
$$
declare
 _r record;
 _i bigint;
 _m bigint;
begin
  for _r in (
    SELECT relname,nspname,d.refobjid::regclass, a.attname, refobjid
    FROM   pg_depend    d
    JOIN   pg_attribute a ON a.attrelid = d.refobjid AND a.attnum = d.refobjsubid
    JOIN pg_class r on r.oid = objid
    JOIN pg_namespace n on n.oid = relnamespace
    WHERE  d.refobjsubid > 0 and  relkind = 'S'
   ) loop
    execute format('select last_value from %I.%I',_r.nspname,_r.relname) into _i;
    execute format('select max(%I) from %s',_r.attname,_r.refobjid) into _m;
    if coalesce(_m,0) > _i then
      raise info '%',concat('changed: ',_r.nspname,'.',_r.relname,' from:',_i,' to:',_m);
      execute format('alter sequence %I.%I restart with %s',_r.nspname,_r.relname,_m+1);
    end if;
  end loop;

end;
$$
; 
```

还评论该行将`--execute format('alter sequence`给出列表，而不是实际重置值

* * *

## 回答 #12

> 赞同：9
> 
> 时间：2010-09-24T11:40:30.393

从公共重置所有序列

```
CREATE OR REPLACE FUNCTION "reset_sequence" (tablename text) RETURNS "pg_catalog"."void" AS 
$body$  
  DECLARE 
  BEGIN 
  EXECUTE 'SELECT setval( ''' 
  || tablename  
  || '_id_seq'', ' 
  || '(SELECT id + 1 FROM "' 
  || tablename  
  || '" ORDER BY id DESC LIMIT 1), false)';  
  END;  
$body$  LANGUAGE 'plpgsql';

select sequence_name, reset_sequence(split_part(sequence_name, '_id_seq',1)) from information_schema.sequences
        where sequence_schema='public'; 
```

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2018-04-08T15:22:44.327

这个问题发生在我使用实体框架创建数据库然后用初始数据为数据库播种时，这使得序列不匹配。

我通过在为数据库播种后创建要运行的脚本来解决它：

```
DO
$do$
DECLARE tablename text;
BEGIN
    -- change the where statments to include or exclude whatever tables you need
    FOR tablename IN SELECT table_name FROM information_schema.tables WHERE table_schema='public' AND table_type='BASE TABLE' AND table_name != '__EFMigrationsHistory'
        LOOP
            EXECUTE format('SELECT setval(pg_get_serial_sequence(''"%s"'', ''Id''), (SELECT MAX("Id") + 1 from "%s"))', tablename, tablename);
    END LOOP;
END
$do$ 
```

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2014-11-07T12:34:27.443

这里有一些非常核心的答案，我假设在被问到这个问题的时候它曾经非常糟糕，因为这里的很多答案不适用于 9.3 版。自 8.0 版以来的[文档](http://www.postgresql.org/docs/8.0/static/sql-createsequence.html)为这个问题提供了答案：

```
SELECT setval('serial', max(id)) FROM distributors; 
```

此外，如果您需要注意区分大小写的序列名称，您可以这样做：

```
SELECT setval('"Serial"', max(id)) FROM distributors; 
```

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2011-09-13T18:22:39.810

我的版本使用第一个，带有一些错误检查......

```
BEGIN;
CREATE OR REPLACE FUNCTION reset_sequence(_table_schema text, _tablename text, _columnname text, _sequence_name text)
RETURNS pg_catalog.void AS
$BODY$
DECLARE
BEGIN
 PERFORM 1
 FROM information_schema.sequences
 WHERE
  sequence_schema = _table_schema AND
  sequence_name = _sequence_name;
 IF FOUND THEN
  EXECUTE 'SELECT setval( ''' || _table_schema || '.' || _sequence_name  || ''', ' || '(SELECT MAX(' || _columnname || ') FROM ' || _table_schema || '.' || _tablename || ')' || '+1)';
 ELSE
  RAISE WARNING 'SEQUENCE NOT UPDATED ON %.%', _tablename, _columnname;
 END IF;
END; 
$BODY$
 LANGUAGE 'plpgsql';

SELECT reset_sequence(table_schema, table_name, column_name, table_name || '_' || column_name || '_seq')
FROM information_schema.columns
WHERE column_default LIKE 'nextval%';

DROP FUNCTION reset_sequence(_table_schema text, _tablename text, _columnname text, _sequence_name text) ;
COMMIT; 
```

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2012-11-09T12:26:09.877

把它们放在一起

```
CREATE OR REPLACE FUNCTION "reset_sequence" (tablename text) 
RETURNS "pg_catalog"."void" AS
$body$
DECLARE
BEGIN
  EXECUTE 'SELECT setval( pg_get_serial_sequence(''' || tablename || ''', ''id''),
  (SELECT COALESCE(MAX(id)+1,1) FROM ' || tablename || '), false)';
END;
$body$  LANGUAGE 'plpgsql'; 
```

将修复 '`id'`给定表的序列（例如，django 通常需要）。

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2015-06-02T10:15:43.347

重新检查公共模式函数中的所有序列

```
CREATE OR REPLACE FUNCTION public.recheck_sequence (
)
RETURNS void AS
$body$
DECLARE
  _table_name VARCHAR;
  _column_name VARCHAR;  
  _sequence_name VARCHAR;
BEGIN
  FOR _table_name IN SELECT tablename FROM pg_catalog.pg_tables WHERE schemaname = 'public' LOOP
    FOR _column_name IN SELECT column_name FROM information_schema.columns WHERE table_name = _table_name LOOP
        SELECT pg_get_serial_sequence(_table_name, _column_name) INTO _sequence_name;
        IF _sequence_name IS NOT NULL THEN 
            EXECUTE 'SELECT setval('''||_sequence_name||''', COALESCE((SELECT MAX('||quote_ident(_column_name)||')+1 FROM '||quote_ident(_table_name)||'), 1), FALSE);';
        END IF;
    END LOOP;   
  END LOOP;
END;
$body$
LANGUAGE 'plpgsql'
VOLATILE
CALLED ON NULL INPUT
SECURITY INVOKER
COST 100; 
```

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2011-03-09T21:50:40.803

在我还没有尝试过代码之前：在下面我发布了适用于我的电脑 [Postgres 8.3] 的 Klaus 和 user457226 解决方案的 sql 代码版本，只对 Klaus 和我的版本进行了一些小的调整为user457226 之一。

克劳斯解决方案：

```
drop function IF EXISTS rebuilt_sequences() RESTRICT;
CREATE OR REPLACE FUNCTION  rebuilt_sequences() RETURNS integer as
$body$
  DECLARE sequencedefs RECORD; c integer ;
  BEGIN
    FOR sequencedefs IN Select
      constraint_column_usage.table_name as tablename,
      constraint_column_usage.table_name as tablename, 
      constraint_column_usage.column_name as columnname,
      replace(replace(columns.column_default,'''::regclass)',''),'nextval(''','') as sequencename
      from information_schema.constraint_column_usage, information_schema.columns
      where constraint_column_usage.table_schema ='public' AND 
      columns.table_schema = 'public' AND columns.table_name=constraint_column_usage.table_name
      AND constraint_column_usage.column_name = columns.column_name
      AND columns.column_default is not null
   LOOP    
      EXECUTE 'select max('||sequencedefs.columnname||') from ' || sequencedefs.tablename INTO c;
      IF c is null THEN c = 0; END IF;
      IF c is not null THEN c = c+ 1; END IF;
      EXECUTE 'alter sequence ' || sequencedefs.sequencename ||' restart  with ' || c;
   END LOOP;

   RETURN 1; END;
$body$ LANGUAGE plpgsql;

select rebuilt_sequences(); 
```

user457226 解决方案：

```
--drop function IF EXISTS reset_sequence (text,text) RESTRICT;
CREATE OR REPLACE FUNCTION "reset_sequence" (tablename text,columnname text) RETURNS bigint --"pg_catalog"."void"
AS
$body$
  DECLARE seqname character varying;
          c integer;
  BEGIN
    select tablename || '_' || columnname || '_seq' into seqname;
    EXECUTE 'SELECT max("' || columnname || '") FROM "' || tablename || '"' into c;
    if c is null then c = 0; end if;
    c = c+1; --because of substitution of setval with "alter sequence"
    --EXECUTE 'SELECT setval( "' || seqname || '", ' || cast(c as character varying) || ', false)'; DOES NOT WORK!!!
    EXECUTE 'alter sequence ' || seqname ||' restart with ' || cast(c as character varying);
    RETURN nextval(seqname)-1;
  END;
$body$ LANGUAGE 'plpgsql';

select sequence_name, PG_CLASS.relname, PG_ATTRIBUTE.attname,
       reset_sequence(PG_CLASS.relname,PG_ATTRIBUTE.attname)
from PG_CLASS
join PG_ATTRIBUTE on PG_ATTRIBUTE.attrelid = PG_CLASS.oid
join information_schema.sequences
     on information_schema.sequences.sequence_name = PG_CLASS.relname || '_' || PG_ATTRIBUTE.attname || '_seq'
where sequence_schema='public'; 
```

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2016-06-16T19:05:14.787

这个答案是 mauro 的副本。

```
drop function IF EXISTS rebuilt_sequences() RESTRICT;
CREATE OR REPLACE FUNCTION  rebuilt_sequences() RETURNS integer as
$body$
  DECLARE sequencedefs RECORD; c integer ;
  BEGIN
    FOR sequencedefs IN Select
      DISTINCT(constraint_column_usage.table_name) as tablename,
      constraint_column_usage.column_name as columnname,
      replace(replace(columns.column_default,'''::regclass)',''),'nextval(''','') as sequencename
      from information_schema.constraint_column_usage, information_schema.columns
      where constraint_column_usage.table_schema ='public' AND 
      columns.table_schema = 'public' AND columns.table_name=constraint_column_usage.table_name
      AND constraint_column_usage.column_name = columns.column_name
      AND columns.column_default is not null 
      ORDER BY sequencename
   LOOP    
      EXECUTE 'select max('||sequencedefs.columnname||') from ' || sequencedefs.tablename INTO c;
      IF c is null THEN c = 0; END IF;
      IF c is not null THEN c = c+ 1; END IF;
      EXECUTE 'alter sequence ' || sequencedefs.sequencename ||' minvalue '||c ||' start ' || c ||' restart  with ' || c;
   END LOOP;

   RETURN 1; END;
$body$ LANGUAGE plpgsql;

select rebuilt_sequences(); 
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2014-05-23T13:52:00.473

如果在加载自定义 SQL 数据以进行初始化时看到此错误，另一种避免这种情况的方法是：

而不是写：

```
INSERT INTO book (id, name, price) VALUES (1 , 'Alchemist' , 10), 
```

`id`从初始数据中删除（主键）

```
INSERT INTO book (name, price) VALUES ('Alchemist' , 10), 
```

这使 Postgres 序列保持同步！

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2016-09-01T14:53:11.997

要将所有序列重新启动为 1，请使用：

```
-- Create Function
CREATE OR REPLACE FUNCTION "sy_restart_seq_to_1" (
    relname TEXT
)
RETURNS "pg_catalog"."void" AS
$BODY$

DECLARE

BEGIN
    EXECUTE 'ALTER SEQUENCE '||relname||' RESTART WITH 1;';
END;
$BODY$

LANGUAGE 'plpgsql';

-- Use Function
SELECT 
    relname
    ,sy_restart_seq_to_1(relname)
FROM pg_class
WHERE relkind = 'S'; 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2011-03-09T21:05:52.010

Klaus 的答案是最有用的，只是有点想念：你必须在 select 语句中添加 DISTINCT。

但是，如果您确定对于两个不同的表，没有表+列名可以等效，您也可以使用：

```
select sequence_name, --PG_CLASS.relname, PG_ATTRIBUTE.attname
       reset_sequence(split_part(sequence_name, '_id_seq',1))
from PG_CLASS
join PG_ATTRIBUTE on PG_ATTRIBUTE.attrelid = PG_CLASS.oid
join information_schema.sequences
     on information_schema.sequences.sequence_name = PG_CLASS.relname || '_' || PG_ATTRIBUTE.attname
where sequence_schema='public'; 
```

这是 user457226 解决方案的扩展，适用于某些感兴趣的列名不是“ID”的情况。

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2017-07-05T17:00:21.640

我花了一个小时试图让 djsnowsill 使用混合大小写表和列来处理数据库，然后由于 Manuel Darveau 的评论终于偶然发现了解决方案，但我想我可以让每个人都更清楚一点：

```
CREATE OR REPLACE FUNCTION "reset_sequence" (tablename text, columnname text)
RETURNS "pg_catalog"."void" AS
$body$
DECLARE
BEGIN
EXECUTE format('SELECT setval(pg_get_serial_sequence(''%1$I'', %2$L),
        (SELECT COALESCE(MAX(%2$I)+1,1) FROM %1$I), false)',tablename,columnname);
END;
$body$  LANGUAGE 'plpgsql';

SELECT format('%s_%s_seq',table_name,column_name), reset_sequence(table_name,column_name) 
FROM information_schema.columns WHERE column_default like 'nextval%'; 
```

这有以下好处：

*   不假设 ID 列以特定方式拼写。
*   不假设所有表都有一个序列。
*   为混合大小写表/列名工作。
*   使用格式更简洁。

解释一下，问题是`pg_get_serial_sequence`需要字符串来计算出你所指的内容，所以如果你这样做：

```
"TableName" --it thinks it's a table or column
'TableName' --it thinks it's a string, but makes it lower case
'"TableName"' --it works! 
```

这是`''%1$I''`在格式字符串中使用实现`''`的，撇号`1$`表示第一个 arg，并`I`表示在引号中

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2019-03-10T16:53:07.717

```
select 'SELECT SETVAL(' || seq [ 1] || ', COALESCE(MAX('||column_name||')+1, 1) ) FROM '||table_name||';'
from (
       SELECT table_name, column_name, column_default, regexp_match(column_default, '''.*''') as seq
       from information_schema.columns
       where column_default ilike 'nextval%'
     ) as sequense_query 
```

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2019-10-01T13:03:37.023

只需运行以下命令：

```
SELECT setval('my_table_seq', (SELECT max(id) FROM my_table)); 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2008-10-28T18:10:55.397

尝试[重新索引](http://www.postgresql.org/docs/7.3/static/sql-reindex.html)。

更新：正如评论中所指出的，这是对原始问题的答复。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2013-05-27T22:38:33.237

丑陋的黑客使用一些 shell 魔法来修复它，这不是一个很好的解决方案，但可能会激发其他有类似问题的人:)

```
pg_dump -s <DATABASE> | grep 'CREATE TABLE' | awk '{print "SELECT setval(#" $3 "_id_seq#, (SELECT MAX(id) FROM " $3 "));"}' | sed "s/#/'/g" | psql <DATABASE> -f - 
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2019-05-15T18:53:33.867

一种更新架构中用作 ID 的所有序列的方法：

```
DO $$ DECLARE
  r RECORD;
BEGIN
FOR r IN (SELECT tablename, pg_get_serial_sequence(tablename, 'id') as sequencename
          FROM pg_catalog.pg_tables
          WHERE schemaname='YOUR_SCHEMA'
          AND tablename IN (SELECT table_name 
                            FROM information_schema.columns 
                            WHERE table_name=tablename and column_name='id')
          order by tablename)
LOOP
EXECUTE
        'SELECT setval(''' || r.sequencename || ''', COALESCE(MAX(id), 1), MAX(id) IS NOT null)
         FROM ' || r.tablename || ';';
END LOOP;
END $$; 
```

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2020-10-07T19:21:49.063

所以我可以看出这个线程中没有足够的意见或重新发明的轮子，所以我决定增加一些趣味性。

下面是一个过程：

*   专注于（仅影响）与表关联的序列
*   适用于 SERIAL 和 GENERATED AS IDENTITY 列
*   适用于 good_column_names 和 "BAD_column_123" 名称
*   如果表为空，则自动分配相应序列的定义起始值
*   允许仅影响特定序列（在 schema.table.column 表示法中）
*   有预览模式

```
CREATE OR REPLACE PROCEDURE pg_reset_all_table_sequences(
    IN commit_mode BOOLEAN DEFAULT FALSE
,   IN mask_in TEXT DEFAULT NULL
) AS
$$
DECLARE
    sql_reset TEXT;
    each_sec RECORD;
    new_val TEXT;
BEGIN

sql_reset :=
$sql$
SELECT setval(pg_get_serial_sequence('%1$s.%2$s', '%3$s'), coalesce(max("%3$s"), %4$s), false) FROM %1$s.%2$s;
$sql$
;

FOR each_sec IN (

    SELECT
        quote_ident(table_schema) as table_schema
    ,   quote_ident(table_name) as table_name
    ,   column_name
    ,   coalesce(identity_start::INT, seqstart) as min_val
    FROM information_schema.columns
    JOIN pg_sequence ON seqrelid = pg_get_serial_sequence(quote_ident(table_schema)||'.'||quote_ident(table_name) , column_name)::regclass
    WHERE
        (is_identity::boolean OR column_default LIKE 'nextval%') -- catches both SERIAL and IDENTITY sequences

    -- mask on column address (schema.table.column) if supplied
    AND coalesce( table_schema||'.'||table_name||'.'||column_name = mask_in, TRUE )
)
LOOP

IF commit_mode THEN
    EXECUTE format(sql_reset, each_sec.table_schema, each_sec.table_name, each_sec.column_name, each_sec.min_val) INTO new_val;
    RAISE INFO 'Resetting sequence for: %.% (%) to %'
        ,   each_sec.table_schema
        ,   each_sec.table_name
        ,   each_sec.column_name
        ,   new_val
    ;
ELSE
    RAISE INFO 'Sequence found for resetting: %.% (%)'
        ,   each_sec.table_schema
        ,   each_sec.table_name
        ,   each_sec.column_name
    ;
END IF
;

END LOOP;

END
$$
LANGUAGE plpgsql
; 
```

预览：

`call pg_reset_all_table_sequences();`

承诺：

`call pg_reset_all_table_sequences(true);`

仅指定您的目标表：

`call pg_reset_all_table_sequences('schema.table.column');`

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2020-05-16T03:31:35.247

这里有很多很好的答案。重新加载我的 Django 数据库后，我也有同样的需求。

但我需要：

*   多合一功能
*   一次可以修复一个或多个模式
*   一次可以修复所有或只修复一张桌子
*   还想要一个很好的方法来查看到底发生了什么变化，或者没有改变

这似乎与最初的要求非常相似。
感谢 Baldiry 和 Mauro 让我走上了正轨。

```
drop function IF EXISTS reset_sequences(text[], text) RESTRICT;
CREATE OR REPLACE FUNCTION reset_sequences(
    in_schema_name_list text[] = '{"django", "dbaas", "metrics", "monitor", "runner", "db_counts"}',
    in_table_name text = '%') RETURNS text[] as
$body$
  DECLARE changed_seqs text[];
  DECLARE sequence_defs RECORD; c integer ;
  BEGIN
    FOR sequence_defs IN
        select
          DISTINCT(ccu.table_name) as table_name,
          ccu.column_name as column_name,
          replace(replace(c.column_default,'''::regclass)',''),'nextval(''','') as sequence_name
          from information_schema.constraint_column_usage ccu,
               information_schema.columns c
          where ccu.table_schema = ANY(in_schema_name_list)
            and ccu.table_schema = c.table_schema
            AND c.table_name = ccu.table_name
            and c.table_name like in_table_name
            AND ccu.column_name = c.column_name
            AND c.column_default is not null
          ORDER BY sequence_name
   LOOP
      EXECUTE 'select max(' || sequence_defs.column_name || ') from ' || sequence_defs.table_name INTO c;
      IF c is null THEN c = 1; else c = c + 1; END IF;
      EXECUTE 'alter sequence ' || sequence_defs.sequence_name || ' restart  with ' || c;
      changed_seqs = array_append(changed_seqs, 'alter sequence ' || sequence_defs.sequence_name || ' restart with ' || c);
   END LOOP;
   changed_seqs = array_append(changed_seqs, 'Done');

   RETURN changed_seqs;
END
$body$ LANGUAGE plpgsql; 
```

然后执行并查看更改运行：

```
select *
from unnest(reset_sequences('{"django", "dbaas", "metrics", "monitor", "runner", "db_counts"}')); 
```

退货

```
activity_id_seq                          restart at 22
api_connection_info_id_seq               restart at 4
api_user_id_seq                          restart at 1
application_contact_id_seq               restart at 20 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2022-01-29T17:44:54.580

我找不到 Rails 的明确答案。

来自`rails console`

```
ActiveRecord::Base.connection.execute("SELECT setval(pg_get_serial_sequence('table_name', 'id'), MAX(id)) FROM table_name;") 
```

替换`table_name`为`users`例如。

* * *

## 回答 #32

> 赞同：-1
> 
> 时间：2015-05-21T17:01:06.987

`SELECT setval...`使 JDBC 很糟糕，所以这是一种与 Java 兼容的方法：

```
-- work around JDBC 'A result was returned when none was expected.'
-- fix broken nextval due to poorly written 20140320100000_CreateAdminUserRoleTables.sql
DO 'BEGIN PERFORM setval(pg_get_serial_sequence(''admin_user_role_groups'', ''id''), 1 + COALESCE(MAX(id), 0), FALSE) FROM admin_user_role_groups; END;'; 
```

# c# - 如何在 C# 中为类名起别名，而无需向使用该类的每个文件添加一行代码？

> ID：244246
> 
> 赞同：100
> 
> 时间：2008-10-28T18:09:14.307
> 
> 标签：c#, class-design

我想为类名创建一个别名。以下语法将是完美的：

```
public class LongClassNameOrOneThatContainsVersionsOrDomainSpecificName
{
   ...
}

public class MyName = LongClassNameOrOneThatContainsVersionOrDomainSpecificName; 
```

但它不会编译。

* * *

## 例子

**注意**此示例仅为方便起见而提供。不要试图通过建议改变整个系统的设计来解决这个特定的问题。此示例的存在或缺失不会改变原始问题。

一些现有代码取决于静态类的存在：

```
public static class ColorScheme
{
   ...
} 
```

此配色方案是 Outlook 2003 配色方案。我想介绍 Outlook 2007 配色方案，同时保留 Outlook 2003 配色方案：

```
public static class Outlook2003ColorScheme
{
   ...
}

public static class Outlook2007ColorScheme
{
   ...
} 
```

但我仍然面临这样一个事实，即代码取决于一个名为`ColorScheme`. 我的第一个想法是创建一个`ColorScheme`我将从`Outlook2003`or继承的类`Outlook2007`：

```
public static class ColorScheme : Outlook2007ColorScheme
{
} 
```

但是您不能从静态类继承。

我的下一个想法是创建静态`ColorScheme`类，但使`Outlook2003ColorScheme`和`Outlook2007ColorScheme`类非静态。然后静态类中的静态变量`ColorScheme`可以指向任一“真实”配色方案：

```
public static class ColorScheme
{
    private static CustomColorScheme = new Outlook2007ColorScheme();
    ...
}

private class CustomColorScheme 
{ 
   ...
}

private class Outlook2008ColorScheme : CustomColorScheme 
{
    ...
}

private class Outlook2003ColorScheme : CustomColorScheme 
{
   ...
} 
```

但这需要我将一个完全由只读静态颜色组成的类转换为可覆盖的属性，然后我的`ColorScheme`类需要将 30 个不同的属性获取器转换为包含的对象。

就是打字太多了。

所以我的下一个想法是给这个类起别名：

```
public static ColorScheme = Outlook2007ColorScheme; 
```

但这不编译。

如何将静态类别名为另一个名称？

* * *

**更新：**有人可以添加答案*“您不能在 C# 中执行此操作”*，因此我可以将其标记为已接受的答案。任何其他想要相同问题答案的人都会发现这个问题、已接受的答案以及许多可能有用或可能没有用的变通方法。

我只想结束这个问题。

* * *

## 回答 #1

> 赞同：144
> 
> 时间：2008-10-28T18:12:02.990

**你不能**。*您可以*做的下一件最好的事情是`using`在使用该类的文件中声明。

例如，您可以使用导入别名（作为准`typedef`替代）重写依赖代码：

```
using ColorScheme = The.Fully.Qualified.Namespace.Outlook2007ColorScheme; 
```

不幸的是，这需要进入使用该名称的每个范围/文件。

因此，我不知道这在您的情况下是否实用。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-10-28T18:19:52.460

你可以通过添加这行代码为你的类创建一个别名：

```
using Outlook2007ColorScheme = YourNameSpace.ColorScheme; 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-01-12T19:08:57.380

您不能在 C# 中为类名设置别名。

在 C# 中，您可以做一些不为类名起别名的事情。

但是要回答最初的问题：您不能在 C# 中为类名设置别名。

* * *

**更新：**人们很困惑为什么`using`不起作用。例子：

**Form1.cs**

```
private void button1_Click(object sender, EventArgs e)
{
   this.BackColor = ColorScheme.ApplyColorScheme(this.BackColor);
} 
```

**颜色方案.cs**

```
class ColorScheme
{
    public static Color ApplyColorScheme(Color c) { ... }
} 
```

一切正常。现在我想创建一个*新*类，并*为其* `ColorScheme`命名（这样就**不需要修改代码**）：

**颜色方案.cs**

```
using ColorScheme = Outlook2007ColorScheme;

class Outlook2007ColorScheme
{
    public static Color ApplyColorScheme(Color c) { ... }
} 
```

哦，对不起。此代码无法编译：

![在此处输入图像描述](https://i.stack.imgur.com/GybrT.png)

我的问题是如何在 C# 中给类起*别名。*这是不可能的。我可以做的一些事情*不是*在 C# 中为类名起别名：

*   改变依赖的每个人`ColorScheme`（`using` `ColorScheme`代码更改解决方法，因为我不能别名）
*   将依赖`ColorScheme`使用工厂模式的每个人更改为多态类或接口（代码更改解决方法，因为我不能别名）

但是这些变通方法涉及破坏现有代码：不是一种选择。

如果人们依赖于`ColorScheme`课程的存在，我必须实际复制/粘贴`ColorScheme`课程。

换句话说：我不能在 C# 中给类名起别名。

这与其他面向对象的语言形成对比，我可以在其中定义别名：

```
ColorScheme = Outlook2007ColorScheme 
```

我就完了。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-10-28T18:15:34.043

根据您的要求，您想要一个（[Factory](http://en.wikipedia.org/wiki/Factory_method_pattern) | [Singleton ）。](http://en.wikipedia.org/wiki/Singleton_pattern)前提是要做到这一点，这样客户端代码就不必知道它得到的是哪种配色方案。如果配色方案应该适用于广泛的应用程序，那么单例应该没问题。如果您可能在不同的情况下使用不同的方案，那么工厂模式可能是要走的路。无论哪种方式，当需要更改配色方案时，只需在一个地方更改代码即可。

```
public interface ColorScheme {
    Color TitleBar { get; }
    Color Background{ get; }
    ...
}

public static class ColorSchemeFactory {

    private static ColorScheme scheme = new Outlook2007ColorScheme();

    public static ColorScheme GetColorScheme() { //Add applicable arguments
        return scheme;
    }
}

public class Outlook2003ColorScheme: ColorScheme {
   public Color TitleBar {
       get { return Color.LightBlue; }
   }

    public Color Background {
        get { return Color.Gray; }
    }
}

public class Outlook2007ColorScheme: ColorScheme {
   public Color TitleBar {
       get { return Color.Blue; }
   }

    public Color Background {
        get { return Color.White; }
    }
} 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-10-28T18:12:59.917

试试这个：

```
using ColorScheme=[fully qualified].Outlook2007ColorScheme 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2017-11-21T18:23:16.733

我正在为在 OP 接受他们的“答案”很久之后发现这一点的用户添加此评论。C# 中的别名通过使用其完全限定的命名空间指定类名来工作。一经定义，别名可在其范围内使用。例子。

```
using aliasClass = Fully.Qualified.Namespace.Example;
//Example being the class in the Fully.Qualified.Namespace

public class Test{

  public void Test_Function(){

    aliasClass.DoStuff();
    //aliasClass here representing the Example class thus aliasing
    //aliasClass will be in scope for all code in my Test.cs file
  }

} 
```

为快速键入的代码道歉，但希望它解释了如何实现它，以免用户误导认为它不能在 C# 中完成。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2015-02-28T22:08:49.987

在 C# 中，按照您想要的方式进行别名化将不起作用。这是因为别名是通过`using`指令完成的，该指令仅限于相关的文件/命名空间。如果您有 50 个使用旧类名的文件，则意味着要更新 50 个位置。

也就是说，我认为有一个简单的解决方案可以使您的代码更改尽可能少。使`ColorScheme`该类成为您调用具有实现的实际类的外观，并使用该`using`文件中的 来确定`ColorScheme`您使用哪个。

换句话说，这样做：

```
using CurrentColorScheme = Outlook2007ColorScheme;
public static class ColorScheme
{
   public static Color ApplyColorScheme(Color c)
   {
       return CurrentColorScheme.ApplyColorScheme(c);
   }
   public static Something DoSomethingElse(Param a, Param b)
   {
       return CurrentColorScheme.DoSomethingElse(a, b);
   }
} 
```

然后在你的代码后面，什么都不做：

```
private void button1_Click(object sender, EventArgs e)
{
   this.BackColor = ColorScheme.ApplyColorScheme(this.BackColor);
} 
```

`ColorScheme`然后，您可以通过更新一行代码 ( `using CurrentColorScheme = Outlook2008ColorScheme;`)来更新 的值。

这里有几个问题：

*   然后，每个新方法或属性定义都需要在两个地方添加到`ColorScheme`类和`Outlook2007ColorScheme`类中。这是额外的工作，但如果这是真正的遗留代码，它不应该经常出现。作为奖励，其中的代码`ColorScheme`非常简单，任何可能的错误都非常明显。
*   静态类的这种使用对我来说似乎并不自然。我可能会尝试重构遗留代码以不同的方式执行此操作，但我也理解您的情况可能不允许这样做。
*   如果您已经有一个`ColorScheme`要替换的类，那么这种方法和任何其他方法都可能是一个问题。我建议您将该类重命名为类似的名称`ColorSchemeOld`，然后通过`using CurrentColorScheme = ColorSchemeOld;`.

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2015-06-25T23:56:49.477

我想您总是可以从基类继承而无需添加任何内容

```
public class Child : MyReallyReallyLongNamedClass {} 
```

*更新*

但是如果你有重构`class`自身的能力：由于缺少`namespace`s，类名通常不必要地长。

如果您将案例视为`ApiLoginUser`, `DataBaseUser`, `WebPortalLoginUser`, 通常表示`namespace`由于担心名称`User`可能会发生冲突而缺乏。

但是，在这种情况下，您可以使用`namespace`alias **，正如上面的帖子中所指出的那样**

```
using LoginApi = MyCompany.Api.Login;
using AuthDB = MyCompany.DataBase.Auth;
using ViewModels = MyCompany.BananasPortal.Models;

// ...
AuthDB.User dbUser;
using ( var ctxt = new AuthDB.AuthContext() )
{
    dbUser = ctxt.Users.Find(userId);
}

var apiUser = new LoginApi.Models.User {
        Username = dbUser.EmailAddess,
        Password = "*****"
    };

LoginApi.UserSession apiUserSession = await LoginApi.Login(apiUser);
var vm = new ViewModels.User(apiUserSession.User.Details);
return View(vm); 
```

请注意`class`名称是 all `User`，但在不同`namespace`的 s 中。引用[PEP-20：Python 之禅](https://www.python.org/dev/peps/pep-0020/)：

> 命名空间是一个很棒的想法——让我们做更多的事情！

希望这可以帮助

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-28T18:18:27.703

是否可以更改为使用接口？

也许您可以创建一个`IColorScheme`所有类都实现的接口？

这将与 Chris Marasti-Georg 所示的工厂模式很好地配合

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-08-31T15:53:34.560

这是一个非常晚的部分答案 - 但是如果您在相同的命名空间“Outlook”中定义相同的类“ColorScheme”，但在单独的程序集中，一个称为 Outlook2003，另一个称为 Outlook2007，那么您需要做的就是引用适当的程序集.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-05-29T13:09:52.707

我发现在 C# 中模拟别名的最佳方法是继承。

创建一个继承自原始类的新类：

```
public class LongClassNameOrOneThatContainsVersionsOrDomainSpecificName
{
   ...
}

public class MyName 
    : LongClassNameOrOneThatContainsVersionOrDomainSpecificName
{

} 
```

唯一需要注意的是构造函数。您需要为`MyName`类提供一个构造函数。

```
public class MyName 
    : LongClassNameOrOneThatContainsVersionOrDomainSpecificName
{
    public MyName(T1 param1, T2 param2) : base(param1, param2) {}   
} 
```

在此示例中，我使用`T1`and`T2`作为泛型类型，因为我不知道您的`LongClassNameOrOneThatContainsVersionOrDomainSpecificName`类的构造函数。

**但请注意，这不是 alias**。对您的应用程序执行此操作可能会遇到一些问题。您可能需要创建一些额外的代码来检查类型，甚至重载一些运算符。

# c - 具有 C 语言基本排序算法的良好参考卡/备忘单？

> ID：244252
> 
> 赞同：16
> 
> 时间：2008-10-28T18:10:59.203
> 
> 标签：c, algorithm, sorting

我一直在寻找（没有运气）完美的参考卡，其中包含 C 中的所有基本排序算法（或者可能是伪代码）。维基百科是一个极好的信息来源，但这次我正在寻找更便携的东西（如果可能的话，口袋大小）当然是可打印的。任何建议将不胜感激！

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-10-28T19:58:56.020

我为我的一个学习 C 的朋友做的，也许你会发现它有帮助：

```
#include <stdlib.h>
#include <string.h>

static void swap(int *a, int *b) {
    if (a != b) {
        int c = *a;
        *a = *b;
        *b = c;
    }
}

void bubblesort(int *a, int l) {
    int i, j;

    for (i = l - 2; i >= 0; i--)
        for (j = i; j < l - 1 && a[j] > a[j + 1]; j++)
            swap(a + j, a + j + 1);
}

void selectionsort(int *a, int l) {
    int i, j, k;
    for (i = 0; i < l; i++) {
        for (j = (k = i) + 1; j < l; j++)
            if (a[j] < a[k])
                k = j;
        swap(a + i, a + k);
    }
}

static void hsort_helper(int *a, int i, int l) {
    int j;

    for (j = 2 * i + 1; j < l; i = j, j = 2 * j + 1)
        if (a[i] < a[j])
            if (j + 1 < l && a[j] < a[j + 1])
                swap(a + i, a + ++j);
            else
                swap(a + i, a + j);
        else if (j + 1 < l && a[i] < a[j + 1])
            swap(a + i, a + ++j);
        else
            break;
}

void heapsort(int *a, int l) {
    int i;

    for (i = (l - 2) / 2; i >= 0; i--)
        hsort_helper(a, i, l);

    while (l-- > 0) {
        swap(a, a + l);
        hsort_helper(a, 0, l);
    }
}

static void msort_helper(int *a, int *b, int l) {
    int i, j, k, m;

    switch (l) {
        case 1:
            a[0] = b[0];
        case 0:
            return;
    }

    m = l / 2;
    msort_helper(b, a, m);
    msort_helper(b + m, a + m, l - m);
    for (i = 0, j = 0, k = m; i < l; i++)
        a[i] = b[j < m && !(k < l && b[j] > b[k]) ? j++ : k++];
}

void mergesort(int *a, int l) {
    int *b;

    if (l < 0)
        return;

    b = malloc(l * sizeof(int));
    memcpy(b, a, l * sizeof(int));
    msort_helper(a, b, l);
    free(b);
}

static int pivot(int *a, int l) {
    int i, j;

    for (i = j = 1; i < l; i++)
        if (a[i] <= a[0])
            swap(a + i, a + j++);

    swap(a, a + j - 1);

    return j;
}

void quicksort(int *a, int l) {
    int m;

    if (l <= 1)
        return;

    m = pivot(a, l);
    quicksort(a, m - 1);
    quicksort(a + m, l - m);
}

struct node {
    int value;
    struct node *left, *right;
};

void btreesort(int *a, int l) {
    int i;
    struct node *root = NULL, **ptr;

    for (i = 0; i < l; i++) {
        for (ptr = &root; *ptr;)
            ptr = a[i] < (*ptr)->value ? &(*ptr)->left : &(*ptr)->right;
        *ptr = malloc(sizeof(struct node));
        **ptr = (struct node){.value = a[i]};
    }

    for (i = 0; i < l; i++) {
        struct node *node;
        for (ptr = &root; (*ptr)->left; ptr = &(*ptr)->left);
        a[i] = (*ptr)->value;
        node = (*ptr)->right;
        free(*ptr);
        (*ptr) = node;
    }
} 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-28T18:21:47.510

您绝对应该查看[动画排序算法](http://www.sorting-algorithms.com/)页面。它是排序算法的绝佳资源。

**编辑**感谢 Peterino 的新链接！

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-28T18:12:57.777

您需要的是 Robert Sedgewick 所著的《C 语言算法》一书。

[http://www.amazon.com/Algorithms-C-paperback-Robert-Sedgewick/dp/0768682339/](https://rads.stackoverflow.com/amzn/click/com/0768682339)

我可能会找一个用过的。新的有点贵（但是，仍然完全值得。）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-28T18:22:00.833

一般来说，人们不太担心不同的算法，许多人使用标准库`qsort()`函数（可能会或可能不会实际使用 Quicksort）来进行排序。当他们不使用它时，他们通常有更复杂的要求。这可能是因为他们需要进行外部排序（将数据溢出到磁盘），或者出于与性能相关的原因。有时，与使用`qsort()`（或者，实际上，`bsearch()`）相关的函数调用每次比较的感知开销太大。有时，人们不想冒 Quicksort 潜在的 O(N^2) 最坏情况行为的风险，但大多数生产`qsort()`算法会为您避免这种情况。

除了各种关于算法的书籍 - Sedgewick 就是其中之一，但还有很多其他书籍 - 您还可以查看 Jon Bentley 的“Programming Pearls”或“More Programming Pearls”书籍。无论如何，这会很好——它们非常好——但是“更多编程珍珠”还包括一个用 awk 编写的简单算法库，包括插入排序、堆排序和快速排序。它错过了冒泡排序、壳排序和 BogoSort。它也不包括基数排序。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-28T18:13:07.560

试试圣经：

[http://dannyreviews.com/h/Art_Programming.html](http://dannyreviews.com/h/Art_Programming.html)

# parsing - 编写解析器 - 需要指南和研究论文

> ID：244253
> 
> 赞同：3
> 
> 时间：2008-10-28T18:11:25.487
> 
> 标签：parsing

我对实现解析器的了解有点生疏。

我对该领域的研究现状一无所知，可能需要一些关于最新进展及其对性能影响的链接。

也欢迎有关编写解析器的一般资源（教程、指南等），因为我在大学学到的很多东西我已经忘记了:)

我有龙书，但仅此而已。

是否有人对像 ANTLR 这样的解析器生成器及其性能有意见？（即与其他发电机的比较）

**编辑**我的主要目标是 N3 表示法的 RDF/OWL/SKOS。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-28T18:19:25.083

提到龙书和蚂蚁意味着你已经回答了你自己的问题。

如果您正在寻找其他解析器生成器，您还可以查看 boost::spirit ( [http://spirit.sourceforge.net/](http://spirit.sourceforge.net/) )。

根据您要实现的目标，您可能还需要考虑使用 DSL，您可以自己解析或使用脚本语言（如 boo、ruby、python 等）编写...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T18:15:56.273

嗯……你的要求有点不具体。虽然在这个一般领域有许多最近的发展，但它们都非常专业（自然，因为该领域已经成熟）。不过，最初的解析方法并没有真正改变。您可能想了解解析器创建工具（[Antlr](http://www.antlr.org/)、[Gold Parser](http://www.devincook.com/goldparser/)等）的变化。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T18:42:49.077

您可能还想看看[SableCC](http://sablecc.org)，另一个解析器生成器“它为构建编译器生成功能齐全的面向对象框架”。

他们是关于基本用途的一些文档[here](http://www.brainycreatures.org/compiler/sablecc.asp)和[here](http://sablecc.org/wiki/DocumentationPage)。由于您询问了研究论文，[SableCC 的主要开发人员的硕士论文](http://sablecc.sourceforge.net/documentation.html)（1998 年）是可用的，并解释了更多关于 SableCC 优势的信息。

尽管当前的稳定版本是 3.2，但开发分支 v4 是完全重写的，应该实现解析器生成器的新功能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-17T08:32:02.617

如果您想为复杂语言构建自定义分析器，请考虑我们的 DMS 软件再造工具包。请参阅[http://www.semanticdesigns.com/Products/DMS/DMSToolkit.html](http://www.semanticdesigns.com/Products/DMS/DMSToolkit.html)

这提供了非常强大的解析技术，使得定义你的语言变得“容易”（尤其是与大多数解析器生成器相比）。

传统的解析器生成器可能有助于解析，但它们在过程的困难部分提供零帮助，这发生在您可以解析代码之后。DMS 提供了大量的机制来支持在您解析代码后分析和转换代码。

# version-control - 带有私有分支的 Clearcase 配置规范

> ID：244261
> 
> 赞同：2
> 
> 时间：2008-10-28T18:13:11.990
> 
> 标签：version-control, clearcase

我在工作中有一个有点复杂的分支结构（至少对我来说）。它是这样的：

```
主要的
 |
 1
 |
 2
 | \
 3\
     版本 2
      |
      1
      | \
      2\
      | 项目A
      3 |
             1

```

主要有2个分支。“Ver2”包含每个人为下一个版本所做的更改，“ProjectA”是我的作品。

我的问题是：有没有办法创建一个知道已合并内容的配置规范，所以我得到：

1.  ProjectA 中尚未合并的任何内容
2.  如果 ProjectA 的 LATEST 已合并到 Ver2，则从 Ver2 分支获取 LATEST
3.  如果没有 ProjectA 分支，则从 Ver2 获取
4.  如果没有 Ver2，则从 MAIN 获取

例如，在上述情况下，如果我将 ProjectA 中的版本 1 合并到 Ver2 分支中的版本 2，那么我希望在 Ver2 上看到版本 3。但是，如果我还没有合并这些文件，我希望 ProjectA 的版本 1 在我看来。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-28T18:44:46.403

我认为你不能那样做。但是，您可以获得的内容是 ProjectA 的最新内容。在 ProjectA 中未更改的 Ver2 上的任何内容；以及未在 Ver2 或 ProjectA 中更改的 MAIN 上的任何内容。剩下的技巧是确保所有必要的东西都从 Ver2 或 MAIN 中合并。为此，您可以使用带有 Ver2 配置规范的参考视图（除非 Ver2 未保持最新，否则您不需要 MAIN 配置规范），然后在 ProjectA 视图中执行以下操作：

```
cleartool findmerge . -fta view-tag-for-ver2 -merge 
```

意思是“`-fta`来自标签”。当然，还有无数额外的选择。

这可确保 ProjectA 在 Ver2 方面完全是最新的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T20:32:25.703

您必须记住为什么定义**[分支](https://stackoverflow.com/questions/16142#114384)**：
隔离开发工作。

因此，为了更好地管理您的复杂配置规范，您应该准确了解“主”分支、v2 分支和项目 A 分支扮演什么角色。

例如，V2 和项目 A 应该有两个不同的原因。

如果项目 A 用于开发项目的当前版本，则应合并到 V2 分支以允许将当前开发的一些改进到 V2 分支。

通过这种推理，您不应该希望在同一个视图中看到“两者”：它们代表两组不同的文件，V2 可能包含具有非常不同 API 的大型重构。

但是，如果您坚持这样的配置，您可以使用移动“MERGE_FROM_PA”标签的能力：每次将一些文件从项目 A 合并到 V2 分支时，您再次为每个合并的文件/目录设置“MERGE_FROM_PA”标签，将该标签从以前的 V2 版本移至最新版本。

配置规范可以是：

```
element * MERGE_FROM_PA
element * .../ProjectA/LATEST
element * .../V2/LATEST
element * /main/LATEST 
```

但话又说回来，这没有多大意义。

您需要定义要建模的不同开发工作，然后定义一个[连贯的工作流程](https://stackoverflow.com/questions/216212#216228)，让您的配置规范只关注*其中一个*环境。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-28T17:28:40.093

为什么不？如果分支已在某处合并，则不使用分支对我来说是有意义的。

这是配置规范：

```
element * {version(.../ProjectA/LATEST)&&!hltype(Merge,->)}
element * {version(.../Ver2/LATEST)&&!hltype(Merge,->)}
element * /main/LATEST 
```

是什么让这个工作流程不连贯，只要你在构建之前标记它？

# c# - 在哪里练习 Lambda 函数？

> ID：244264
> 
> 赞同：8
> 
> 时间：2008-10-28T18:13:47.963
> 
> 标签：c#, .net-3.5, lambda, c#-3.0

我目前正在尝试学习 C#3.0 的所有新功能。我找到了一个非常好的[示例来练习 LINQ](http://msdn.microsoft.com/en-us/vcsharp/aa336746.aspx)，但我找不到 Lambda 的类似内容。

你有我可以练习 Lambda 函数的地方吗？

## 更新

LINQpad 非常适合学习 Linq（感谢建议的人）并在某些表达式中使用一点 Lambda。但我会对 Lambda 的更具体的练习感兴趣。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-28T18:16:36.600

[LINQPad](http://linqpad.net/)是学习LINQ的好工具

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-28T19:01:38.273

Lambdas 就是这样的东西，一旦你开始思考，你就会“明白”它。如果您当前正在使用委托，则可以将其替换为 lambda。`System.Action<...>`,`System.Func<...>`和添加也是`System.Predicate<...>`不错的快捷方式。不过，一些显示语法的示例会有所帮助（警告：它们是空洞的，但我想说明如何交换函数）：

```
public static void Main()
{
    // ToString is shown below for clarification
    Func<int,string,string> intAndString = (x, y) => x.ToString() + y.ToString();
    Func<bool, float, string> boolAndFloat = (x, y) => x.ToString() + y.ToString();

    // with declared
    Combine(13, "dog", intAndString);
    Combine(true, 37.893f, boolAndFloat);

    // inline
    Combine("a string", " with another", (s1, s2) => s1 + s2);
    // and multiline - note inclusion of return
    Combine(new[] { 1, 2, 3 }, new[] { 6, 7, 8 },
        (arr1, arr2) =>
        {
            var ret = "";
            foreach (var i in arr1)
            {
                ret += i.ToString();
            }
            foreach (var n in arr2)
            {
                ret += n.ToString();
            }

            return ret;
        }
    );

    // addition
    PerformOperation(2, 2, (x, y) => 2 + 2);
    // sum, multi-line
    PerformOperation(new[] { 1, 2, 3 }, new[] { 12, 13, 14 },
        (arr1, arr2) =>
        {
            var ret = 0;
            foreach (var i in arr1)
                ret += i;
            foreach (var i in arr2)
                ret += i;
            return ret;
        }
    );

    Console.ReadLine();

}

public static void Combine<TOne, TTwo>(TOne one, TTwo two, Func<TOne, TTwo, string> vd)
{
    Console.WriteLine("Appended: " + vd(one, two));
}

public static void PerformOperation<T,TResult>(T one, T two, Func<T, T, TResult> func)
{
    Console.WriteLine("{0} operation {1} is {2}.", one, two, func(one,two));
} 
```

最让我困惑的是快捷语法，例如，当使用 System.Action 只执行没有参数的委托时，您可以使用：

```
var a = new Action(() => Console.WriteLine("Yay!")); 
```

或者你可以这样做：

```
Action a = () => Console.WriteLine("Yay"); 
```

当你有一个`Action`, `Func`, or`Predicate`有一个参数时，你可以省略括号：

```
var f = new Func<int, bool>(anInt => anInt > 0); 
```

或者：

```
// note: no var here, explicit declaration
Func<int,bool> f = anInt => anInt > 0; 
```

代替：

```
Func<int,bool> f = (anInt) => anInt > 0; 
```

或走极端：

```
Func<int,bool> f = (anInt) =>
{
    return anInt > 0;
} 
```

如上所示，单行 lambda 不需要 return 语句，但多行`Func`lambda 需要。

我认为您会发现学习如何使用 lambdas 的最佳方法是大量使用集合并将 System.Linq 包含在您的 using 命名空间中 - 您将看到大量的集合扩展方法，其中大多数方法允许您锻炼你的 lambda 知识。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T19:26:34.197

目前我发现的最好的是这个[链接](http://www.albahari.com/nutshell/linqquiz.aspx)。这是一个可以练习的测验，但我想要更多的 Lambda 和更少的 LINQ。

# sharepoint - 如何摆脱“无法确定具有 ID 的功能的定义”

> ID：244271
> 
> 赞同：2
> 
> 时间：2008-10-28T18:15:35.620
> 
> 标签：sharepoint, moss

我的生产前端服务器上的事件日志充满了错误消息：

“无法确定具有 ID 的功能的定义”

现在，我在其中一个开发服务器上发现了有问题的功能——它是一个 InfoPath 表单，后面有一些代码。但是，在生产服务器上找不到它。

我尝试在生产服务器上运行以下命令：stsadm -o uninstallfeature -id (your GUID) -force

没有变化 - 仍在生成错误。

如何摆脱错误？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T13:21:20.410

我不确定，但我认为将该功能定义复制到产品的 12/TEMPLATES/FEATURES 然后卸载它可能会有所帮助。

但是从这条错误消息“无法确定具有 ID 的功能的定义”中并不清楚您的生产系统的哪个部分与该功能相关联，以及执行了哪些操作会导致此错误。增加 Sharepoint 日志的详细程度可以帮助您更准确地确定导致错误的确切原因。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-07-30T17:52:12.977

试试这个：[SharePoint 功能管理和清理工具](http://featureadmin.codeplex.com/)

> 找到有缺陷的 FeatureDefinitions 并彻底卸载它们。在站点、SiteCollections、WebApps 和 Farm 中查找功能剩余部分，例如从场中强制卸载功能而之前未停用它们，从而导致错误。此外，在整个农场范围内取消/激活功能。

# xml - 从 Flash 中的 swf 文件外部加载 xml 文件

> ID：244276
> 
> 赞同：4
> 
> 时间：2008-10-28T18:16:20.813
> 
> 标签：xml, flash, actionscript-2

我正在开发的一个网站（使用 AS2，因为它是老式的）有一个更大的索引 .swf 文件，它使用 .swf 加载子 swfs `loadMovie("foo1.swf", placeToShowSwf)`。一直到 4，这`foo1.swf`很愚蠢，因为它们之间唯一不同的是 xml 文件地址中的一个数字，它告诉它要加载什么内容。因此，我想将其简化为一个文件，并使用索引文件调用以加载 xml 文件的简单函数，如此处所示。

```
function setFooNum(i:Number) {
   fooNum = i;
   //my_xml = new XML();  edit: this line has since been removed and is kept for historical purposes
   my_xml.load("foo"+fooNum+".xml");
}; 
```

但是，由于某种原因，xml 文件不会加载。它在函数之外正确加载，但这对我没有多大好处。它会正确更改 fooNum，但是如果已经加载了错误的 xml 文件，那对我没有任何好处。据我所知，代码表现得好像`my_xml.load("foo"+fooNum+".xml")`根本不存在。

这是某种我不知道的安全措施吗，有什么办法吗？

***编辑*** 正如几个人指出的那样，这`my_xml = new XML()`条线是罪魁祸首。不幸的是，我现在遇到了一个令人兴奋的新错误。当在索引文件中的`setFooNum(i)`之后立即调用内部的打印出 fooNum 设置正确，但内部的a （尽管显然没有加载，但返回成功，顺便说一句）表明 fooNum 未定义！此外，我在索引 swf 中创建了一个按钮，用于调用（用于调试目的），出于某种原因，它可以正常工作。所以等待几秒钟文件加载似乎可以解决问题，但这是一个非常丑陋的解决方案。`loadMove()``trace(fooNum)``setFooNum()``trace(fooNum)``onLoad()``setFooNum(3)`

那么我该如何等到所有内容都完全加载后再调用`setFooNum()`呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-23T19:29:19.577

也许您应该仔细检查您是否在`crossdomain.xml`. 如果您的跨域文件被劫持，您的任何请求都不会通过。

[http://crossdomainxml.org/](http://crossdomainxml.org/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T18:24:46.710

您的函数每次都创建一个新的 XML 实例，因此您每次都需要定义 onLoad 函数，如果您重用相同的 XML 实例，则无需重新定义该函数，例如

```
var iFooNum：数字；
var oXML:XML = new XML();

oXML.onLoad = function (success:Boolean) {
  如果（成功）{
    //用 XML 做一些事情。
  }
}

loadFooNum = function(i:Number) {
  iFooNum = 我;
  oXML.load("foo" + i + ".xml");
}

```

如果您从不同的域加载 XML 文件，则需要另一个域上的 crossdomain.xml 文件以允许 flash 加载 XML 文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T18:56:01.873

假设您在函数外部为 XMLinstance 定义了 onLoad 事件处理程序，您可以从函数体中删除实例的声明：

```
function setFooNum(i:Number) {
    fooNum = i;
    my_xml.load("foo"+fooNum+".xml");
}; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-20T14:16:11.617

kirupa 网站上的本教程可以帮助您。

[http://www.kirupa.com/web/xml/index.htm](http://www.kirupa.com/web/xml/index.htm)

它解释了如何使用 AS 和 XML。希望这可以帮助您得到答案。

# c# - 在单元测试中创建 System.Web.Caching.Cache 对象

> ID：244280
> 
> 赞同：9
> 
> 时间：2008-10-28T18:17:32.997
> 
> 标签：c#, asp.net

我正在尝试为没有单元测试的项目中的函数实现单元测试，并且此函数需要 System.Web.Caching.Cache 对象作为参数。我一直在尝试使用诸如...之类的代码来创建此对象

```
System.Web.Caching.Cache cache = new System.Web.Caching.Cache();
cache.Add(...); 
```

...然后将“缓存”作为参数传递，但 Add() 函数会导致 NullReferenceException。到目前为止，我最好的猜测是，我无法在单元测试中创建此缓存对象，需要从 HttpContext.Current.Cache 中检索它，而我显然无法在单元测试中访问它。

如何对需要 System.Web.Caching.Cache 对象作为参数的函数进行单元测试？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-28T18:31:28.660

当我遇到这类问题（相关类没有实现接口）时，我经常会在相关类周围编写一个带有相关接口的包装器。然后我在我的代码中使用我的包装器。对于单元测试，我手动模拟包装器并将我自己的模拟对象插入其中。

当然，如果一个模拟框架有效，那么就使用它。我的经验是，所有模拟框架都存在各种 .NET 类的问题。

```
public interface ICacheWrapper
{
   ...methods to support
}

public class CacheWrapper : ICacheWrapper
{
    private System.Web.Caching.Cache cache;
    public CacheWrapper( System.Web.Caching.Cache cache )
    {
        this.cache = cache;
    }

    ... implement methods using cache ...
}

public class MockCacheWrapper : ICacheWrapper
{
    private MockCache cache;
    public MockCacheWrapper( MockCache cache )
    {
        this.cache = cache;
    }

    ... implement methods using mock cache...
}

public class MockCache
{
     ... implement ways to set mock values and retrieve them...
}

[Test]
public void CachingTest()
{
    ... set up omitted...

    ICacheWrapper wrapper = new MockCacheWrapper( new MockCache() );

    CacheManager manager = new CacheManager( wrapper );

    manager.Insert(item,value);

    Assert.AreEqual( value, manager[item] );
} 
```

真实代码

```
...

CacheManager manager = new CacheManager( new CacheWrapper( HttpContext.Current.Cache ));

manager.Add(item,value);

... 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T18:21:56.247

我认为您最好的选择是使用模拟对象（查看 Rhino Mocks）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T21:13:44.997

对遗留代码进行单元测试的一个非常有用的工具是[TypeMock Isolator](http://typemock.com/)。它允许您通过告诉它模拟该类和您发现有问题的任何方法调用来完全绕过缓存对象。与其他模拟框架不同，TypeMock 使用反射来拦截那些您告诉它为您模​​拟的方法调用，因此您不必处理繁琐的包装器。

TypeMock**是**一个商业产品，但它有开源项目的免费版本。他们**曾经**有一个单用户许可证的“社区”版本，但我不知道是否仍然提供。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-08-02T14:46:02.633

```
var httpResponse = MockRepository.GenerateMock<HttpResponseBase>();
var cache = MockRepository.GenerateMock<HttpCachePolicyBase>();
   cache.Stub(x => x.SetOmitVaryStar(true));
   httpResponse.Stub(x => x.Cache).Return(cache);
   httpContext.Stub(x => x.Response).Return(httpResponse);
   httpContext.Response.Stub(x => x.Cache).Return(cache); 
```

# java - 罐子安全

> ID：244283
> 
> 赞同：5
> 
> 时间：2008-10-28T18:18:23.773
> 
> 标签：java, security

我有一个独立的 Java 应用程序，其中包含一些我想要保护的许可代码，即防止用户更改我的软件以规避许可。做这个的最好方式是什么？

我看过混淆，但这会带来各种各样的问题：反射、序列化、混乱的堆栈跟踪等。也许 jar 签名可能是一个解决方案？但是如何在运行时验证 jar？以及如何确保用户不更改jar验证码？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-28T19:10:41.907

抱歉，如果您的用户足够聪明地篡改您的类文件，他们将首先删除签名检查功能。我同意混淆，但是一个好的混淆器不应该保留一些字典来为您转换混淆的堆栈跟踪吗？

这个讨论真的很老，而且真的很复杂。看看游戏行业。也许您应该考虑在您的应用程序中提供吉他？

将两者结合起来，你应该有很好的协同作用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T23:19:19.407

这是法律问题，不是软件问题。

您可以让第一个用户更难制作副本，但并非不可能。一旦坚定的攻击者破坏了您的安全，他可以为懒惰的人制作无限数量的副本。

如果您认为这是有利可图的，请起诉未经许可复制您的软件的人。

我相信会故意窃取您的软件（或更一般地说，知识产权）的用户比例因媒体类型而异，对于大多数产品而言，这一比例相对较小。如果您销售 T-Pain MP3，盗窃可能会毁掉您的业务。否则，采取信用卡公司的立场，他们希望容忍由于欺诈而造成的一些损失，但仍然可以获利。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T22:31:34.697

我们目前使用混淆器，它可以提供合理的攻击保护。我们现在使用的那个提供了一个堆栈跟踪工具，当它们从另一端出来时会去混淆它们（基于在混淆时生成的日志文件）。

即使这样，对于坚定的黑客也没有真正的保护。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-28T18:29:15.983

你可以密封罐子。请。有关详细信息，请参阅以下链接

-- [http://java.sun.com/docs/books/tutorial/deployment/jar/sealman.html](http://java.sun.com/docs/books/tutorial/deployment/jar/sealman.html)

java.sun.com/developer/JDCTechTips/2001/tt0130.html

# c# - 你怎么能在网页中编辑有效的 XML？

> ID：244285
> 
> 赞同：4
> 
> 时间：2008-10-28T18:18:42.477
> 
> 标签：c#, xml, serialization, character-encoding

我必须启动并运行一个快速而肮脏的配置编辑器。流程是这样的：

配置（服务器上的 POCO）被序列化为 XML。
在这一点上，XML 格式良好。配置被发送到 XElements 中的 Web 服务器。
在 Web 服务器上，XML（是的，全部）被转储到文本区域中进行编辑。
用户直接在网页中编辑 XML 并单击提交。
在响应中，我检索了 XML 配置的更改文本。此时，所有转义都已通过在网页中显示它们的过程恢复。
我尝试将字符串加载到 XML 对象（XmlElement、XElement 等）中。卡布姆。

问题是序列化会转义属性字符串，但这会在翻译过程中丢失。

例如，假设我有一个具有正则表达式的对象。这是 Web 服务器的配置：

```
<Configuration>
  <Validator Expression="[^&lt;]" />
</Configuration> 
```

所以，我把它放到了一个 textarea 中，对用户来说它看起来像这样：

```
<Configuration>
  <Validator Expression="[^<]" />
</Configuration> 
```

因此，用户进行了轻微的修改并将更改提交回来。在 Web 服务器上，响应字符串如下所示：

```
<Configuration>
  <Validator Expression="[^<]" />
  <Validator Expression="[^&]" />
</Configuration> 
```

因此，用户添加了另一个验证器，现在两者都具有非法字符的属性。如果我尝试将其加载到任何 XML 对象中，它会引发异常，因为 < 和 & 在文本字符串中无效。I CANNOT CANNOT CANNOT CANNOT 不能使用任何类型的编码功能，因为它编码了整个血腥的东西：

var 结果 = Server.HttpEncode(editedConfig);

结果是

```
&lt;Configuration&gt;
  &lt;Validator Expression="[^&lt;]" /&gt;
  &lt;Validator Expression="[^&amp;]" /&gt;
&lt;/Configuration&gt; 
```

这不是有效的 XML。如果我尝试将它加载到任何类型的 XML 元素中，我将被落下的铁砧击中。我不喜欢坠落的铁砧。

所以，问题仍然存在......我可以让这个字符串 XML 准备好解析为 XML 对象的唯一方法是使用正则表达式替换吗？加载时有什么方法可以“关闭约束”吗？你怎么解决这个问题？？？

* * *

最后一个回复，然后对其进行维基化，因为我认为没有有效的答案。

我放在 textarea 中的 XML 是有效的、转义的 XML。1) 将其放入文本区域 2) 将其发送到客户端 3) 将其显示给客户端 4) 提交其所在的表单 5) 将其发送回服务器和 6) 从表单中检索值的过程任何和所有的逃避。

让我再说一遍：我没有逃避任何事情。只需在浏览器中显示它就可以了！

需要考虑的事情：有没有办法从一开始就防止这种无法逃脱的事情发生？有没有办法获取几乎有效的 XML 并以安全的方式“清理”它？

* * *

这个问题现在有一个赏金。为了收集赏金，您演示了如何在浏览器窗口中编辑 VALID XML，而无需使用不需要我使用正则表达式手动转义属性值的第 3 方/开源工具，也不需要用户转义他们的属性，并且在往返时不会失败（&amp;amp;amp;etc;）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-28T18:22:35.263

呃……<em>你是怎么序列化的？通常，XML 序列化程序绝不应该产生无效的 XML。

/EDIT 响应您的更新：不要**向**您的用户显示无效的 XML 进行编辑！相反，在 TextBox 中显示正确转义的 XML。修复损坏的 XML 并不好玩，实际上我认为没有理由不以有效的转义形式显示/编辑 XML。

我可以再次问：*如何*在 TextBox 中显示 XML？您似乎在某些时候故意对 XML 进行转义。

/EDIT 回应您的最新评论：是的，很明显，因为它可以包含 HTML。在将其写入 HTML 页面之前，您需要正确地转义您的 XML。我的意思是*整个*XML。所以这：

```
<foo mean-attribute="&lt;"> 
```

变成这样：

```
&lt;foo mean-attribute="&amp;&lt;"&gt; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-29T12:46:22.117

当然，当您将实体引用放在 textarea 中时，它们不会转义。文本区域不是魔法，你必须 &escape; 您放入其中的所有内容都与其他元素一样。浏览器可能会在 textarea 中*显示*原始的“<”，但这仅仅是因为它们试图清理您的错误。

因此，如果您将可编辑的 XML 放入 textarea 中，则需要对属性值进行一次转义以使其成为有效的 XML，然后您必须再次对整个 XML 进行转义以使其成为有效的 HTML。您希望出现在页面中的最终来源是：

```
<textarea name="somexml">
    &lt;Configuration&gt;
        &lt;Validator Expression="[^&amp;lt;]" /&gt;
        &lt;Validator Expression="[^&amp;amp;]" /&gt;
    &lt;/Configuration&gt;
</textarea> 
```

问题是基于对 textarea 元素的内容模型的误解——验证器会立即发现问题。

ETA 重新评论：嗯，还有什么问题？这就是序列化方面的问题。剩下的就是将其重新解析，为此您必须假设用户可以创建格式良好的 XML。

试图解析格式不正确的 XML，以允许在属性值中未转义 '<' 或 '&' 等错误是一种损失，这完全违背了 XML 的工作方式。如果您不能信任您的用户编写格式良好的 XML，请给他们一个更简单的非 XML 接口，例如一个简单的换行符分隔的正则表达式字符串列表。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T18:42:14.850

正如您所说，普通的序列化程序应该为您转义一切。

那么问题就出在文本块上：您需要自己处理通过文本块传递的任何内容。

您可以尝试使用 HttpUtility.HtmlEncode()，但我认为最简单的方法是将您通过文本块传递的任何内容封装在 CDATA 部分中。

通常，我当然希望所有内容都正确转义，而不是依赖 CDATA“拐杖”，但我也想使用内置工具进行转义。对于用户在“休眠”状态下编辑的内容，我认为 CDATA 可能是要走的路。

另请参阅这个较早的问题：
[Best way to encode text data for XML](https://stackoverflow.com/questions/157646/best-way-to-encode-text-data-for-xml)

* * *

**更新**
基于对另一个回复的评论，我意识到您正在向用户展示标记，而不仅仅是内容。Xml 解析器非常挑剔。我认为在这种情况下你可以做的最好的事情是在接受编辑的 xml *之前*检查格式是否正确。

也许尝试自动更正某些类型的错误（例如我的链接问题中的错误 & 符号），然后从 .Net xml 解析器获取第一个验证错误的行号和列号，并使用它来向用户显示他们的错误在哪里，直到他们给你一些可以接受的东西。如果您还针对模式进行验证，则会获得奖励积分。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-28T02:55:17.490

你可以看看[TinyMCE 之](http://tinymce.moxiecode.com/)类的东西，它允许你在富文本框中编辑 html。如果您无法将其配置为完全符合您的要求，则可以将其用作灵感。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-29T18:46:18.873

注意：Firefox（在我的测试中）不会像您描述的那样在文本区域中转义。具体来说，这段代码：

```
<textarea cols="80" rows="10" id="1"></textarea>

<script>
elem = document.getElementById("1");

elem.value = '\
<Configuration>\n\
  <Validator Expression="[^&lt;]" />\n\
</Configuration>\
'
alert(elem.value);
</script> 
```

*被警告并不变*地显示给用户，如：

```
<Configuration>
  <Validator Expression="[^&lt;]" />
</Configuration> 
```

所以也许一个（不可行的？）解决方案是让您的用户使用 Firefox。

* * *

您的问题的两个部分似乎已被揭示：

1**您显示的 XML 未转义。**

例如，“ `&lt;`”未转义为“<”。但由于“<”也未转义为“<”，因此信息丢失并且无法取回。

一种解决方案是让您转义所有“ `&`”字符，使“ `&lt;`”变为“ `&amp;lt;`”。然后，这将被 textarea 转义为“ `&lt;`”。当你读回来时，它会和最初一样。（我假设 textarea 实际上更改了字符串，但 Firefox 的行为不像您报告的那样，所以我无法检查）

另一个解决方案（我认为已经提到过）是构建/购买/借用自定义文本区域（如果简单的话也不错，但是有所有的编辑键，ctrl-C、ctrl-shift-left 等等）。

2**您希望用户不必费心转义。**

你在逃生地狱：

正则表达式替换将主要工作......但是当用户可能（合法地，在您给出的条款内）输入时，您如何可靠地检测到结束引号（“）：

```
<Configuration>
  <Validator Expression="[^"<]" />
</Configuration> 
```

从正则表达式语法的角度来看，它也无法判断最后的 " 是正则表达式的一部分，还是它的结尾。正则表达式语法通常使用显式终止符来解决这个问题，例如：

```
/[^"<]/ 
```

如果用户使用此语法（带有终止符），并且您为它编写了解析器，那么您可以确定正则表达式何时结束，因此下一个 " 字符不是正则表达式的一部分，而是 XML 的一部分，并且因此需要转义哪些部分。我不是说你应该这样做！我说理论上是可能的。它远非快速和肮脏。

顺便说一句：元素中的文本也会出现同样的问题。在您给出的条款范围内，以下内容是合法的，但存在相同的解析问题：

```
<Configuration>
  <Expression></Expression></Expression>
</Configuration> 
```

允许“任何文本”的语法中的基本规则是分隔符*必须*转义（例如“或 <），以便可以识别结尾。为了方便/不便，大多数语法还转义了许多其他内容。 （*编辑*它需要对转义字符本身进行转义：对于 XML，它是“ `&`”，当文字被转义为“ `&amp;`”对于正则表达式，它是 C/unix 样式的“ `\`”，当文字被转义时作为“ `\\`”）。

嵌套语法，你就在逃生地狱里。

一个简单的解决方案是告诉您的用户：这是一个**快速**而**肮脏**的配置编辑器，因此您不会得到任何花哨的“无需逃避”mamby-pamby：

*   列出文本区域旁边的字符和转义符，例如：“<”为“ `&lt`”。
*   对于不会验证的 XML，请再次向他们显示列表。

* * *

回首往事，我看到[bobince](https://stackoverflow.com/questions/244285/how-the-heck-can-you-edit-valid-xml-in-a-webpage/246652#246652)在我面前给出了相同的基本答案。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-07T02:20:02.180

在所有文本周围插入 CDATA 将为您提供另一种转义机制，该机制将 (1) 使用户免于手动转义，以及 (2) 使 textarea 自动未转义的文本能够正确回读。

```
 <Configuration>
   <Validator Expression="<![CDATA[  [^<]   ]]>" />
 </Configuration> 
```

:-)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-28T18:31:25.603

这个特殊字符 - “<” - 应该替换为其他字符，以便您的 XML 有效。检查此链接以获取 XML 特殊字符：

[http://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references](http://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references)

尝试在将 TextBlock 内容发送到反序列化器之前对其进行编码：

```
HttpServerUtility utility = new HttpServerUtility();
string encodedText = utility.HtmlEncode(text); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-28T19:41:49.690

这真的是我唯一的选择吗？这不是一个足够普遍的问题，它在框架的某个地方有解决方案吗？

```
private string EscapeAttributes(string configuration)
{
    var lt = @"(?<=\w+\s*=\s*""[^""]*)<(?=[^""]*"")";
    configuration = Regex.Replace(configuration, lt, "&lt;");

    return configuration;
} 
```

（编辑：删除＆符号替换，因为它会导致问题往返）

# .net - 亚音速：比较两列而不是输入参数

> ID：244295
> 
> 赞同：3
> 
> 时间：2008-10-28T18:22:06.793
> 
> 标签：.net, subsonic

可以在亚音速下进行以下操作。

从表 1 中选择 *

WHERE Column1 > Column2 或 Column1 < Colum3

我见过的所有示例都假定您现在将一个值传递给 where 子句。我正在尝试在不创建视图的情况下执行此操作。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-04T19:10:35.543

如果它在我们的堆栈中，我找不到它:)。不过，添加将是一件好事:)。现在，您可以使用内联查询来简单地执行您编写的语句（它需要直接的 SQL）。我知道这很丑但是...

瑞克 - 如果你真的让它工作，我会对如何工作感兴趣。“Col2”将尝试解析为一种类型，您的查询将失败。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-01-01T14:06:28.640

如果您使用的是 SubSonic 2.1/2.2 并且您可以访问源代码，则可以应用以下内容：

***SubSonic/SqlQuery/Constraint.cs***
（添加新属性）

```
public bool ParameterIsTableColumn
{
    get { return ParameterValue is TableSchema.TableColumn ;  }
} 
```

***SubSonic/SqlQuery/SqlQuery.cs***
（在 SetConstraintParams 方法内）

```
foreach(Constraint c in qry.Constraints)
{
    if (c.ConstructionFragment == "##" || c.ParameterIsTableColumn)
        continue; 
```

***SubSonic/SqlQuery/SqlGenerators/ANSISqlGenerator.cs***
（内部 BuildConstraintSQL 方法）

```
//add this at the top of the method
int currentConstraintIndex = query.Constraints.IndexOf(c);

///the statement 'c.ParameterName = ' occurs four times in this method
///use this line the first three times, and a slight variation of it on the fourth
c.ParameterName = (c.ParameterIsTableColumn ? ((TableSchema.TableColumn)c.ParameterValue).QualifiedName : String.Concat(col.ParameterName, currentConstraintIndex)); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T04:09:00.570

看来此功能不在当前版本中，但已提交到下一个版本的代码中。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-04T10:49:11.350

是的。

```
Dim TableList As Generic.List(Of Database.Table1) = _
 New SubSonic.Select().From("Table1"). _
 Where("Col1").IsGreaterThan("Col2"). _
 Or("Col1").IsLessThan("Col3").ExecuteTypedList(Of Database.Table1)() 
```

# .net - DataGridViewCheckBoxCell 因 -> 值结果而损坏

> ID：244303
> 
> 赞同：0
> 
> 时间：2008-10-28T18:23:52.937
> 
> 标签：.net, c++, forms, datagridviewcheckboxcell

我正在使用 DataGridViewCheckBoxCell 但我无法弄清楚如何让 ->Value 属性“正确”工作。

```
for (int i = this->dgvConfigs->Rows->Count - 1; i >= 0 ; i --){
  DataGridViewCheckBoxCell^ dgvcbc = (DataGridViewCheckBoxCell^) this->dgvConfigs->Rows[i]->Cells[2];
  // This is truely a weird behavior of the DataGridViewCheckBoxCell

  if (dgvcbc->Value->ToString() == "True"){
    // Do stuff
  }
} 
```

现在我无法弄清楚 ->Value 可能是什么。当我测试

```
dgvcbc->Value == true 
```

它永远不会触发，或者

```
dgvcbc->Value == dgvcbc->TrueValue 
```

当我在调试器中查看这些值时，它们都是“{true}”，但从未将相等性评估为 true

我什至试过

```
dgvcbc->TrueValue = true;
dgvcbc->Value == dgvcbc->TrueValue 
```

同样，两者都显示为“{true}”，但 //Do Stuff 永远不会匹配

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-01T19:41:15.613

使用任何一个

*   编辑CellFormattedValue，或
*   编辑格式化值

而不是 Value，它给出单元格的当前（格式化）值 - 哪一个取决于您要如何访问它（在编辑模式下与否）

# c++ - C++ 中的读/写锁

> ID：244316
> 
> 赞同：73
> 
> 时间：2008-10-28T18:26:51.197
> 
> 标签：c++, multithreading, locking

我正在寻找一个好的 C++ 读/写锁。我们有一个不常写者和许多常读者的用例，并希望对此进行优化。最好我想要一个跨平台的解决方案，但是只有一个 Windows 是可以接受的。

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2011-06-23T07:15:17.423

从 C++ 17 (VS2015) 开始，您可以使用标准：

```
#include <shared_mutex>

typedef std::shared_mutex Lock;
typedef std::unique_lock< Lock >  WriteLock;
typedef std::shared_lock< Lock >  ReadLock;

Lock myLock;

void ReadFunction()
{
     ReadLock r_lock(myLock);
     //Do reader stuff
}

void WriteFunction()
{
     WriteLock w_lock(myLock);
     //Do writer stuff
} 
```

对于较旧的编译器版本和标准，您可以使用**boost**创建读写锁：

```
#include <boost/thread/locks.hpp>
#include <boost/thread/shared_mutex.hpp>

typedef boost::shared_mutex Lock;
typedef boost::unique_lock< Lock >  WriteLock;
typedef boost::shared_lock< Lock >  ReadLock; 
```

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2008-10-28T18:36:58.290

较新版本的[boost::thread](http://www.boost.org/doc/libs/1_50_0/doc/html/thread.html)具有读/写锁（1.35.0 及更高版本，显然以前的版本无法正常工作）。

它们具有名称[`shared_lock`](http://www.boost.org/doc/libs/1_50_0/doc/html/thread/synchronization.html#thread.synchronization.locks.unique_lock),[`unique_lock`](http://www.boost.org/doc/libs/1_50_0/doc/html/thread/synchronization.html#thread.synchronization.locks.shared_lock)和[`upgrade_lock`](http://www.boost.org/doc/libs/1_50_0/doc/html/thread/synchronization.html#thread.synchronization.locks.upgrade_lock), 对 a 进行操作[`shared_mutex`](http://www.boost.org/doc/libs/1_50_0/doc/html/thread/synchronization.html#thread.synchronization.mutex_types.shared_mutex)。

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2008-10-28T18:46:10.487

使用标准的预测试、预构建的东西总是好的（例如，另一个答案建议的 Boost），但这并不是很难自己构建的东西。这是从我的一个项目中提取的一个愚蠢的小实现：

```
#include <pthread.h>

struct rwlock {
    pthread_mutex_t lock;
    pthread_cond_t read, write;
    unsigned readers, writers, read_waiters, write_waiters;
};

void reader_lock(struct rwlock *self) {
    pthread_mutex_lock(&self->lock);
    if (self->writers || self->write_waiters) {
        self->read_waiters++;
        do pthread_cond_wait(&self->read, &self->lock);
        while (self->writers || self->write_waiters);
        self->read_waiters--;
    }
    self->readers++;
    pthread_mutex_unlock(&self->lock);
}

void reader_unlock(struct rwlock *self) {
    pthread_mutex_lock(&self->lock);
    self->readers--;
    if (self->write_waiters)
        pthread_cond_signal(&self->write);
    pthread_mutex_unlock(&self->lock);
}

void writer_lock(struct rwlock *self) {
    pthread_mutex_lock(&self->lock);
    if (self->readers || self->writers) {
        self->write_waiters++;
        do pthread_cond_wait(&self->write, &self->lock);
        while (self->readers || self->writers);
        self->write_waiters--;
    }
    self->writers = 1;
    pthread_mutex_unlock(&self->lock);
}

void writer_unlock(struct rwlock *self) {
    pthread_mutex_lock(&self->lock);
    self->writers = 0;
    if (self->write_waiters)
        pthread_cond_signal(&self->write);
    else if (self->read_waiters)
        pthread_cond_broadcast(&self->read);
    pthread_mutex_unlock(&self->lock);
}

void rwlock_init(struct rwlock *self) {
    self->readers = self->writers = self->read_waiters = self->write_waiters = 0;
    pthread_mutex_init(&self->lock, NULL);
    pthread_cond_init(&self->read, NULL);
    pthread_cond_init(&self->write, NULL);
} 
```

`pthreads`不是真正的 Windows 原生，但总体思路就在这里。这种实现稍微偏向于作家（一大群作家可以无限期地饿死读者）；`writer_unlock`如果您希望平衡相反，只需修改即可。

是的，这是 C 而不是 C++。翻译是留给读者的练习。

## 编辑

Greg Rogers 指出 POSIX 标准确实指定了`pthread_rwlock_*`. 如果您没有，这将无济于事`pthreads`，但它让我想起了：[Pthreads-w32](http://sourceware.org/pthreads-win32/)应该可以工作！无需将此代码移植到非`pthreads`自己使用，只需在 Windows 上使用 Pthreads-w32，并`pthreads`在其他任何地方使用原生代码。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2008-10-28T19:23:32.380

无论您决定使用什么，都将您的工作负载与简单锁进行基准测试，因为当没有争用时，读/写锁往往比简单互斥锁慢 3-40 倍。

这里有[一些参考](http://www.zeroc.com/doc/Ice-3.3.0-IceTouch/manual/Threads.32.10.html)

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-01-29T07:29:06.517

编辑：MSDN 杂志链接不再可用。CodeProject 文章现在可以在[https://www.codeproject.com/Articles/32685/Testing-reader-writer-locks](https://www.codeproject.com/Articles/32685/Testing-reader-writer-locks)上找到，并且总结得很好。[我还发现了一个关于Compound Synchronization Objects](https://msdn.microsoft.com/en-us/library/ms810427.aspx)的新 MSDN 链接。

MSDN 上有[一篇](http://msdn.microsoft.com/en-us/magazine/cc163405.aspx)关于读写锁的文章，介绍了它们的一些实现。它还引入了 Slim 读取器/写入器锁，这是一种随 Vista 引入的内核同步原语。还有一篇关于比较不同实现的[CodeProject 文章](http://www.codeproject.com/KB/threads/testing_rwlocks.aspx)（包括 MSDN 文章的那些）。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2017-05-28T14:54:56.097

C++17 支持[`std::shared_mutex`](http://en.cppreference.com/w/cpp/thread/shared_mutex). 它在[MSVC++ 2015](https://msdn.microsoft.com/en-us/library/mt420524.aspx?f=255&MSPPError=-2147217396)和 2017 中受支持。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-05T19:04:10.117

英特尔线程构建模块还提供了几个 rw_lock 变体：

[http://www.threadingbuildingblocks.org/](http://www.threadingbuildingblocks.org/)

他们有一个 spin_rw_mutex 用于非常短的争用时间和一个 queueing_rw_mutex 用于较长时间的争用。前者可用于对性能特别敏感的代码。后者在性能上与 Boost.Thread 或直接使用 pthreads 提供的性能更具可比性。但是配置文件以确保哪个是您的访问模式的胜利。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-28T19:08:06.763

我可以推荐[ACE 库](http://www.cs.wustl.edu/~schmidt/ACE.html)，它提供了多种锁定机制并被移植到各种平台。

根据问题的边界条件，您可能会发现以下类很有用：

*   `ACE_RW_Process_Mutex`
*   `ACE_Write_Guard`和`ACE_Read_Guard`
*   `ACE_Condition`

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-28T19:10:28.597

[Boost.Thread](http://www.boost.org/doc/libs/1_36_0/doc/html/thread.html)自 1.35.0 版以来已经支持读写锁。这样做的好处是该实现非常跨平台，经过同行评审，实际上[是即将到来的 C++0x 标准的参考实现](http://www.ddj.com/cpp/211600441?pgno=3)。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-03-08T09:58:27.590

[http://www.codeproject.com/KB/threads/ReaderWriterLock.aspx](http://www.codeproject.com/KB/threads/ReaderWriterLock.aspx)

这是一个适用于大多数任务的良好且轻量级的实现。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2011-05-31T19:31:29.783

用于 Win32 的多读取器、单写入器同步锁类，作者 Glenn Slayde

[http://www.glennslayden.com/code/win32/reader-writer-lock](http://www.glennslayden.com/code/win32/reader-writer-lock)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-28T18:31:32.483

您可以复制 Sun 出色的[ReentrantReadWriteLock](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/locks/ReentrantReadWriteLock.html)。它包括可选的公平性、锁定降级，当然还有可重入性等功能。

是的，它是用 Java 编写的，但即使您不了解任何 Java，您也可以轻松阅读并将其转换为 C++。我链接到的文档包含此实现的所有行为属性，因此您可以确保它符合您的要求。

如果没有别的，它是一个指南。

# asp.net - 如何访问 ASP.NET 控件的内容？

> ID：244326
> 
> 赞同：6
> 
> 时间：2008-10-28T18:30:26.603
> 
> 标签：asp.net, controls

我想知道是否可以做这样的事情：

```
 <uc1:TestControl ID="TestControl1" runat="server">
        <div>More random HTML, etc...</div>
    </uc1:TestControl> 
```

我收到“类型'System.Web.UI.UserControl'没有名为'div'的公共属性”的错误。做了一些研究，我发现我可以将以下属性添加到服务器控件：

```
[ParseChildren(false)]
public partial class TestControl : System.Web.UI.UserControl
{
    protected void Page_Load(object sender, EventArgs e)
    {

    }
} 
```

是否可以从 ASP.NET 控件中读取内容？

编辑：更改措辞以反映我很好奇您是否可以使用服务器或用户控件执行此操作

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T18:40:00.220

在服务器控件中，您将创建[一个实现 ITemplate](http://msdn.microsoft.com/en-us/library/system.web.ui.itemplate.aspx)以包含该内容的属性。我不确定这是否可能在用户控件中，但它可能是。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T14:42:03.677

是的，有可能

查看有关创建模板化用户控件的 MSDN 文章，此外，您可以将 [ParseChildren(false)] 添加到用户控件类，以便您可以从保存它们的页面中看到它们。 [http://msdn.microsoft.com/en-us/library/36574bf6.aspx](http://msdn.microsoft.com/en-us/library/36574bf6.aspx)

希望这可以帮助。

# java - Java HashMap 中的线程问题

> ID：244329
> 
> 赞同：3
> 
> 时间：2008-10-28T18:31:19.753
> 
> 标签：java, multithreading, collections, concurrency, hashmap

发生了一些我不确定是否可能发生的事情。显然是的，因为我已经看到了，但是我需要找到根本原因，希望大家能提供帮助。

我们有一个系统可以查找邮政编码的纬度和经度。我们不是每次都访问它，而是将结果缓存在一个廉价的内存中 HashTable 缓存中，因为邮政编码的纬度和经度往往比我们发布的更频繁。

无论如何，散列被一个类包围，该类具有同步的“get”和“add”方法。我们作为单例访问这个类。

我并不是说这是最好的设置，但它就是我们所处的位置。（我计划尽快更改以将 Map 包装在 Collections.synchronizedMap() 调用中。）

我们在多线程环境中使用此缓存，其中线程 2 调用 2 个 zip（因此我们可以计算两者之间的距离）。这些有时几乎同时发生，因此两个调用很可能同时访问地图。

就在最近，我们发生了一个事件，两个不同的邮政编码返回相同的值。假设初始值实际上不同，有没有办法将值写入 Map 会导致为两个不同的键写入相同的值？或者，有什么方法可以让 2 个“获取”跨线并意外返回相同的值？

我唯一的其他解释是初始数据已损坏（错误值），但这似乎不太可能。

任何想法，将不胜感激。谢谢，彼得

（PS：如果您需要更多信息、代码等，请告诉我）

```
public class InMemoryGeocodingCache implements GeocodingCache
{

private Map cache = new HashMap();
private static GeocodingCache instance = new InMemoryGeocodingCache();

public static GeocodingCache getInstance()
{
    return instance;
}

public synchronized LatLongPair get(String zip)
{
    return (LatLongPair) cache.get(zip);
}

public synchronized boolean has(String zip)
{
    return cache.containsKey(zip);
}

public synchronized void add(String zip, double lat, double lon)
{
    cache.put(zip, new LatLongPair(lat, lon));
}
}

public class LatLongPair {
double lat;
double lon;

LatLongPair(double lat, double lon)
{
    this.lat = lat;
    this.lon = lon;
}

public double getLatitude()
{
    return this.lat;
}

public double getLongitude()
{
    return this.lon;
}
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-28T20:48:56.823

代码看起来正确。

唯一需要担心的是 lat 和 lon 是包可见的，因此对于相同的包代码，以下是可能的：

```
LatLongPair llp = InMemoryGeocodingCache.getInstance().get(ZIP1);
llp.lat = x;
llp.lon = y; 
```

这显然会修改缓存中的对象。

因此，也使 lat 和 lon 最终确定。

PS 由于您的密钥（邮政编码）是唯一且小的，因此无需在每个操作上计算哈希。使用 TreeMap（包装在 Collections.synchronizedMap() 中）更容易。

PPS 实用方法：为两个线程编写一个测试，在永无止境的循环中执行 put/get 操作，在每次 get 时验证结果。不过，您需要一台多 C​​PU 机器。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-28T18:39:59.970

为什么会发生这种情况很难说。更多代码可能会有所帮助。

无论如何，您可能应该只使用 ConcurrentHashMap 。一般来说，这将比同步 Map 更有效。您不会同步对它的访问，它会在内部处理它（比您更有效）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-28T18:47:13.137

需要注意的一件事是键或值是否可能发生变化，例如，如果不是为每次插入创建一个新对象，您只是更改现有对象的值并重新插入它。

您还需要确保 key 对象同时定义 hashCode 和 equals 以不违反 HashMap 协定（即，如果 equals 返回 true，则 hashCodes 需要相同，但不一定反之亦然）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-28T20:10:51.863

是否有可能正在修改 LatLonPair？我建议将 lat 和 lon 字段设置为 final，这样它们就不会在代码的其他地方被意外修改。

请注意，您还应该使您的单例“实例”和地图参考“缓存”最终。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-28T20:52:52.200

詹姆斯是正确的。由于您要交回一个对象，因此可以修改其内部结构，并且任何持有对该对象（映射）的引用的东西都将反映该更改。最终是一个很好的答案。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-11-14T16:34:25.727

这是 HashMap 上的 java 文档：

[http://docs.oracle.com/javase/7/docs/api/java/util/HashMap.html](http://docs.oracle.com/javase/7/docs/api/java/util/HashMap.html)

请注意，此实现不同步。如果多个线程同时访问一个哈希映射，并且至少有一个线程在结构上修改了映射，则必须在外部进行同步。（结构修改是添加或删除一个或多个映射的任何操作；仅更改与实例已包含的键关联的值不是结构修改。）这通常通过在自然封装映射的某个对象上同步来完成. 如果不存在这样的对象，则应使用 Collections.synchronizedMap 方法“包装”地图。这最好在创建时完成，以防止对地图的意外不同步访问：

地图 m = Collections.synchronizedMap(new HashMap(...));

**或者更好的是，使用 java.util.concurrent.ConcurrentHashMap**

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-06T11:38:54.837

The presence of the **has(String ZIP)** method implies that you have something like the following in your code:

```
GeocodingCache cache = InMemoryGeocodingCache.getInstance();

if (!cache.has(ZIP)) {
    cache.add(ZIP, x, y);
} 
```

Unfortunately this opens you up to sync problems between the has() returning false and the add() adding which *could* result in the issue you described.

A better solution would be to move the check inside the add method so the check and update are covered by the same lock like:

```
public synchronized void add(String zip, double lat, double lon) {
    if (cache.containsKey(zip)) return;
    cache.put(zip, new LatLongPair(lat, lon));
} 
```

The other thing I should mention is that if you are using **getInstance()** as a singleton you should have a private constructor to stop the possibility of additional caches being created using **new InMemoryGeocodingCache()**.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-29T02:20:59.587

我真的看不出您发布的代码有什么问题会导致您描述的问题。我的猜测是你的地理代码缓存的客户端有问题。

其他需要考虑的事情（其中一些非常明显，但我想我还是会指出它们）：

1.  您遇到了哪两个邮政编码问题？您确定它们在源系统中没有相同的地理编码吗？
2.  你确定你不会不小心比较两个相同的邮政编码吗？

# c# - 可能的线程/COM/UI 问题

> ID：244335
> 
> 赞同：2
> 
> 时间：2008-10-28T18:32:59.407
> 
> 标签：c#, internet-explorer, com, user-interface, toolbar

我正在为 IE(6+) 编写工具栏。我使用了来自

codeproject.com（[http://www.codeproject.com/KB/dotnet/IE_toolbar.aspx](http://www.codeproject.com/KB/dotnet/IE_toolbar.aspx)），并有一个可以工作的工具栏，注册注销等。我想要工具栏做的是将html页面中的div突出显示为用户的鼠标移到该 div 上。到目前为止，突出显示代码有效，但我想在工具栏上的标签中显示 div 的名称（如果存在）（随着鼠标移动等而变化）。

我一辈子都无法做到这一点，尝试调试它是一场噩梦。由于程序集托管在 IE 中，我怀疑我通过尝试从未创建该控件的线程更新标签上的文本而导致异常（在 IE 中），但由于该异常发生在 IE 中，我没看到。

尝试使用 Invoke 以线程安全的方式更新控件的解决方案是什么？如果有怎么办？

这是事件代码：

```
private void Explorer_MouseOverEvent(mshtml.IHTMLEventObj e)
{
      mshtml.IHTMLDocument2 doc = this.Explorer.Document as IHTMLDocument2;
      element = doc.elementFromPoint(e.clientX, e.clientY);
      if (element.tagName.Equals("DIV", StringComparison.InvariantCultureIgnoreCase))
      {
          element.style.border = "thin solid blue;";
          if (element.className != null)
          {
               UpdateToolstrip(element.className);
          }
      } 
      e.returnValue = false;
} 
```

这是对工具栏的线程安全更新的尝试：

```
delegate void UpdateToolstripDelegate(string text);

public void UpdateToolstrip(string text)
{
     if (this.toolStripLabel1.InvokeRequired == false)
     {
         this.toolStripLabel1.Text = text;
     }
     else
     {
         this.Invoke(new UpdateToolstripDelegate(UpdateToolstrip), new object[] { text });
     }
} 
```

任何建议都非常感谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T20:08:19.840

我无法真正重现这个问题（为 IE 工具栏创建一个测试项目有点太多工作了），但你可以试试这个：

将以下例程添加到公共静态（扩展方法）类：

```
public static void Invoke(this Control control, MethodInvoker methodInvoker)
{
    if (control.InvokeRequired)
        control.Invoke(methodInvoker);
    else
        methodInvoker();
} 
```

然后将第一个块中的类似代码部分替换为：

```
if (element.className != null)
{
    this.Invoke(() => toolStripLabel1.Text = element.className);
} 
```

这是避免 UI 应用程序中的线程安全问题的可靠方法。

# backup - 如何使用 Bacula 备份大文件？

> ID：244337
> 
> 赞同：5
> 
> 时间：2008-10-28T18:34:09.873
> 
> 标签：backup, zope, bacula

目前它是 700MB，但可以想象它会超过 1GB。通常我只是将这个文件复制到另一个位置（好奇的是，它是 Zope 实例的数据库，一个 ZODB 文件）。

该文件每天几乎没有变化，但我知道 Bacula 不能对增量备份进行文件内细分。无论如何，没关系。我想做的是每天完整备份并保留其中两个，每周完整备份并保留其中两个。所以在任何给定的时间我都可以得到昨天、前天、一周前和两周前。你认为这是个好主意吗？

我想我应该制定两个时间表，每天和每周。但是我应该在卷和池上拥有哪些数字来实现这一点？两卷1.5GB？欢迎任何提示或指导，我不是系统管理员，我对 Bacula 的经验非常有限。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-24T14:34:34.110

大型数据库文件的在线备份是一项有风险的业务，因为文件可能会在您读取它时发生更改，从而导致备份不一致并且可能无用。我相信您不应该备份 ZODB 文件本身，而应该备份**repozo**工具每天创建的差异。这样，您还外包了处理您说 Bacula 无法处理的文件内部细分的工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T03:27:35.270

根据我使用 bacula 和备份到磁盘的经验，最好为每个备份作业保留一个卷。这样，随着作业过期，文件中就没有死空间。Bacula 可以重用整个卷，并减少磁盘利用率。在池资源中使用“Set Maximum Volume Jobs = 1”指令。

我会设置两个池，每天和每周。将卷保留时间设置为每天两天和每周两周。将每日安排在周一至周六，将每周安排在周日。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-02-08T17:15:00.623

根据您的基础架构，我建议您拍摄您正在备份的卷的快照以“冻结”它并从那里进行备份。

对于我们的一些备份，我们使用 LVM 快照（[http://tldp.org/HOWTO/LVM-HOWTO/snapshots_backup.html](http://tldp.org/HOWTO/LVM-HOWTO/snapshots_backup.html)），以避免锁定我们的任何数据库（我们有 TB 的数据要备份，并且锁定将有对服务的巨大影响）

然后，正如您所说，数据库不会移动太多，我会保留 6 天，每日 6 卷，周刊 2 卷。你的每日任务应该会进入增量备份池，而每周任务应该是完整的。

例如，让每周（完整）在周一运行，然后每天（周二至周日）递增。如果您意识到您的数据已损坏，这将允许您在一周中的任何一天返回，而不会在备份期间占用太多空间或时间。

编辑：而且......我应该在回答之前检查发布日期。哈哈。迟到了 3 年。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-10-27T16:02:31.373

对于开源 bacula (bacula.org)，最好的办法是确实使用“Set Maximum Volume Jobs = 1”指令。

如果您想要“增量备份的文件内部细分”，请考虑 Bacula Systems 的 Delta 插件 - [https://www.baculasystems.com/products/bacula-enterprise-plugins/delta](https://www.baculasystems.com/products/bacula-enterprise-plugins/delta)。

# wxpython - wxPython wxDC 对象来自 win32gui.GetDC

> ID：244340
> 
> 赞同：2
> 
> 时间：2008-10-28T18:35:06.173
> 
> 标签：wxpython, device, win32gui, bitblit

我正在使用返回 int/long 的 win32gui.GetDC 获取另一个程序中对象的窗口句柄的 DC。我需要将这个 DC 插入 python 中的内存 DC。我唯一不知道怎么做的是从 win32gui 返回的 int/long 中获取 wxDC 派生对象。据我所知，没有一个 wxDC 对象允许我将实际的 DC 句柄传递给它们。这当然使我无法做我的小动作。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-30T17:25:33.347

我下载了 wxWidgets 源并四处挖掘，我认为这会起作用。

您需要外部窗口的句柄 (HWND)，而不是 DC。

```
window = wx.Frame(None, -1, '')
window.AssociateHandle(hwnd)
dc = wx.WindowDC(window) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-31T15:22:29.363

据我所知，python 中的 DC 是由于平台变化而抽象的。因此，python 中的设备上下文不会直接映射到 Windows 中的设备上下文，即使许多方法都是直接的 Windows 方法调用。要做到这一点，您似乎需要制作自己的 DelegateDC 类或仅适用于 Windows 的类似内容，以便您可以直接设置 DC 句柄。

可能还有一些方法可以将 wxWindow 附加到窗口句柄，之后您可以从 wxWindow 获取 wxWindowDC ......虽然无法解决这个问题。

# tdd - 如何对单元测试进行单元测试？

> ID：244345
> 
> 赞同：89
> 
> 时间：2008-10-28T18:37:05.547
> 
> 标签：tdd, agile, test-first

我在 MVCStoreFront 应用程序上观看 Rob Connerys 的网络广播，我注意到他正在对最平凡的事情进行单元测试，例如：

```
public Decimal DiscountPrice
{
   get
   {
       return this.Price - this.Discount;
   }
} 
```

会有一个像这样的测试：

```
[TestMethod]
public void Test_DiscountPrice
{
    Product p = new Product();
    p.Price = 100;
    p.Discount = 20;
    Assert.IsEqual(p.DiscountPrice,80);
} 
```

虽然，我完全支持单元测试，但我有时想知道这种形式的测试优先开发是否真的有益，例如，在实际流程中，您的代码上方有 3-4 层（业务请求、需求文档、架构文档） ，其中实际定义的业务规则（折扣价格是价格 - 折扣）可能被错误定义。

如果是这种情况，那么您的单元测试对您来说毫无意义。

此外，您的单元测试是另一个失败点：

```
[TestMethod]
public void Test_DiscountPrice
{
    Product p = new Product();
    p.Price = 100;
    p.Discount = 20;
    Assert.IsEqual(p.DiscountPrice,90);
} 
```

现在测试有缺陷。显然在一个简单的测试中，这没什么大不了的，但是假设我们正在测试一个复杂的业务规则。我们在这里得到什么？

快进两年应用程序的生命，维护开发人员正在维护它。现在业务改变了它的规则，测试又中断了，一些新手开发人员错误地修复了测试……我们现在又遇到了一个故障点。

我看到的只是更多可能的失败点，没有真正的收益回报，如果折扣价格错误，测试团队仍然会发现问题，单元测试如何节省任何工作？

我在这里想念什么？请教我热爱 TDD，因为到目前为止我很难接受它是有用的。我也想，因为我想保持进步，但这对我来说没有意义。

编辑：有几个人一直提到测试有助于执行规范。根据我的经验，规范也经常出错，但也许我注定要在一个规范是由不应该编写规范的人编写的组织中工作。

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2008-10-28T18:38:40.330

首先，测试就像安全——你永远不能 100% 确定你已经得到它，但是每一层都增加了更多的信心和一个框架，可以更容易地解决仍然存在的问题。

其次，您可以将测试分解为子例程，然后可以对其本身进行测试。当您有 20 个类似的测试时，制作一个（经过测试的）子例程意味着您的主要测试是对子例程的 20 次简单调用，这更有可能是正确的。

第三，有些人会争辩说[TDD](http://en.wikipedia.org/wiki/Test-driven_development)解决了这个问题。也就是说，如果你只写了 20 个测试并且它们通过了，你就不能完全确信它们实际上正在测试任何东西。但是，如果您最初编写的每个测试都*失败*了，然后您修复了它，那么您就会更有信心它确实在测试您的代码。恕我直言，这种来回花费的时间比它的价值要多，但这是一个试图解决您的问题的过程。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2008-10-28T18:55:13.480

错误的测试不太可能破坏您的生产代码。至少，不比没有考试更糟糕。所以这不是一个“故障点”：为了让产品实际工作，测试不必是正确的。它们可能必须是正确的，然后才能生效，但修复任何损坏的测试的过程不会危及您的实现代码。

您可以将测试，甚至像这样的微不足道的测试视为代码应该做什么的第二意见。一种意见是测试，另一种是实施。如果他们不同意，那么你知道你有问题，你仔细看看。

如果将来有人想从头开始实现相同的接口，它也很有用。他们不必阅读第一个实现即可了解 Discount 的含义，并且测试充当您可能拥有的任何书面接口描述的明确备份。

也就是说，你正在交易时间。如果您可以使用跳过这些琐碎测试所节省的时间来编写其他测试，那么它们可能会更有价值。这实际上取决于您的测试设置和应用程序的性质。如果折扣对应用程序很重要，那么无论如何您都会在功能测试中发现此方法中的任何错误。所有单元测试所做的就是让您在测试该单元时捕获它们，此时错误的位置将立即显而易见，而不是等到应用程序集成在一起并且错误的位置*可能*不太明显。

顺便说一句，我个人不会在测试用例中使用 100 作为价格（或者更确切地说，如果我这样做了，我会以另一个价格添加另一个测试）。原因是将来有人可能认为折扣应该是百分比。像这样的琐碎测试的目的之一是确保纠正阅读规范时的错误。

[关于编辑：我认为不正确的规范不可避免地会成为故障点。如果您不知道该应用程序应该做什么，那么它很可能不会这样做。但是编写测试来反映规范并没有放大这个问题，它只是无法解决它。所以你没有添加新的故障点，你只是在代码中表示现有的错误，而不是~~华夫饼~~文档。]

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-10-28T22:36:24.207

> > 我看到的只是更多可能的失败点，没有真正的收益回报，如果折扣价格错误，测试团队仍然会发现问题，单元测试如何节省任何工作？

单元测试并不真正应该节省工作，它应该帮助您发现和防止错误。这是*更多*的工作，但这是正确的工作。它在最低粒度级别考虑您的代码，并编写测试用例来证明它在*预期*条件下工作，对于给定的输入集。它隔离变量，因此您可以通过在错误确实出现时查找正确的位置来节省*时间*。它*保存*了那套测试，这样当你必须在路上做出改变时，你可以一次又一次地使用它们。

我个人认为大多数方法论并没有从[货物崇拜软件工程](http://en.wikipedia.org/wiki/Cargo_cult_programming#Cargo_cult_software_engineering)中删除很多步骤，包括 TDD，但是您不必坚持严格的 TDD 来获得单元测试的好处。保留好的部分，丢弃没有收益的部分。

最后，您的名义问题“**您如何对单元测试进行单元测试？** ”的答案是您不必这样做。每个单元测试都应该非常简单。调用具有特定输入的方法并将其与预期输出进行比较。如果方法的规范发生更改，那么您可以预期该方法的某些单元测试也需要更改。这就是您在如此低的粒度级别上进行单元测试的原因之一，因此只需更改*一些单元测试。*如果您发现许多不同方法的测试会因需求中的一个变化而发生变化，那么您可能没有在足够精细的粒度级别上进行测试。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-10-28T18:48:59.873

单元测试的存在是为了让您的单元（方法）达到您的预期。首先编写测试会迫使您在编写代码**之前**考虑您的期望。三思而后行总是一个好主意。

单元测试应该反映业务规则。当然，代码中可能存在错误，但首先编写测试允许您在编写任何代码之前从业务规则的角度编写它。我认为，之后编写测试更有可能导致您描述的错误，因为您**知道**代码是如何实现它的，并且很想确保实现是正确的——而不是意图是正确的。

此外，单元测试只是您应该编写的测试的一种形式——也是最低的一种形式。集成测试和验收测试也应该由客户编写，如果可能的话，以确保系统按照预期的方式运行。如果您在此测试期间发现错误，请返回并编写单元测试（失败）以测试功能更改以使其正常工作，然后更改您的代码以使测试通过。现在你有了回归测试来捕获你的错误修复。

[编辑]

我在做 TDD 时发现的另一件事。默认情况下，它几乎强制进行良好的设计。这是因为高度耦合的设计几乎不可能单独进行单元测试。使用 TDD 很快就会发现使用接口、控制反转和依赖注入（所有可以改进设计和减少耦合的模式）对于可测试代码来说非常重要。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-01-08T15:22:12.980

如何[测试一个测试](http://www.ibm.com/developerworks/java/library/j-jester/)？ [突变测试](http://en.wikipedia.org/wiki/Mutation_testing)是一种有价值的技术，我个人使用它的效果非常好。阅读链接的文章了解更多详细信息，以及更多学术参考的链接，但通常它通过修改源代码（例如将“x += 1”更改为“x -= 1”）“测试你的测试”，然后重新运行测试，确保至少一项测试失败。任何不会导致测试失败的突变都会被标记以供以后调查。

您会惊讶于如何通过一组看起来很全面的测试来获得 100% 的行和分支覆盖率，但是您可以从根本上更改甚至注释掉源代码中的一行，而不会引起任何测试的抱怨。这通常归结为没有使用正确的输入进行测试以涵盖所有边界情况，有时它更微妙，但在所有情况下，我都对它的结果印象深刻。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-10-30T08:33:04.420

应用测试驱动开发 (TDD) 时，首先要**失败**的测试。这一步看似不必要，实际上是为了验证单元测试是否正在测试某些东西。事实上，如果测试永远不会失败，它就没有任何价值，更糟糕的是，会导致错误的信心，因为您将依赖无法证明任何事情的积极结果。

当严格遵循这个过程时，所有“单元”都受到单元测试正在建立的安全网的保护，即使是最普通的。

```
Assert.IsEqual(p.DiscountPrice,90); 
```

测试没有理由朝那个方向发展——或者我在你的推理中遗漏了一些东西。当价格为 100，折扣 20 时，折扣价格为 80。这就像一个不变量。

现在假设您的软件需要支持另一种基于百分比的折扣，可能取决于购买的数量，您的 Product::DiscountPrice() 方法可能会变得更加复杂。引入这些更改可能会破坏我们最初的简单折扣规则。然后你会看到这个测试的值，它会立即检测到回归。

* * *

Red - Green - Refactor - 这是为了记住 TDD 过程的本质。

**红色**是指测试失败时的 JUnit 红色条。

**当所有测试通过时，绿色**是 JUnit 进度条的颜色。

**绿色条件下重构**：删除任何重复，提高可读性。

* * *

现在要解决您关于“代码上方的 3-4 层”的观点，这在传统（类似瀑布）过程中是正确的，而不是在开发过程敏捷时。敏捷是 TDD 的发源地；TDD 是[极限编程](http://www.extremeprogramming.org/rules/testfirst.html)的基石。

敏捷是关于直接沟通，而不是扔在墙上的需求文档。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-06-03T05:15:23.090

> 虽然，我完全赞成单元测试，但我有时想知道这种形式的测试优先开发是否真的有益......

像这样的小型、琐碎的测试可以成为您代码库的“煤矿中的金丝雀”，在为时已晚之前警告危险。琐碎的测试对于保留是有用的，因为它们可以帮助您正确进行交互。

例如，考虑一个简单的测试来探究如何使用您不熟悉的 API。如果该测试与您在“真正”使用 API 的代码中所做的事情有任何相关性，那么保留该测试很有用。当 API 发布新版本并且您需要升级时。现在，您对 API 的行为方式有了自己的假设，以可执行格式记录下来，您可以使用该格式来捕获回归。

> ...[I] 在实际过程中，您的代码上方有 3-4 层（业务请求、需求文档、架构文档），其中实际定义的业务规则（折扣价格是价格 - 折扣）可能被错误定义。如果是这种情况，那么您的单元测试对您来说毫无意义。

如果您多年来一直在编写代码而没有编写测试，那么您可能不会立即意识到有任何价值。但是，如果您认为最好的工作方式是“尽早发布、经常发布”或“敏捷”，因为您希望能够快速/持续地部署，那么您的测试肯定是有意义的。做到这一点的唯一方法是通过测试使您对代码所做的每一次更改都合法化。无论测试多么小，一旦您拥有一个绿色测试套件，理论上您就可以部署。另见“持续生产”和“永久测试版”。

您也不必“先测试”才能拥有这种心态，但这通常是实现目标的最有效方式。当您进行 TDD 时，您会将自己锁定在 2 到 3 分钟的小红绿重构周期中。在任何时候，您都不能停下来离开，手上会弄得一团糟，这需要一个小时才能调试并重新组装起来。

> 此外，您的单元测试是另一个失败点......

成功的测试是证明系统出现故障的测试。失败的测试会提醒您测试逻辑或系统逻辑中的错误。您的测试目标是破坏您的代码或证明一种方案有效。

如果您在代码*之后*编写测试，您将冒着编写“坏”测试的风险，因为为了看到您的测试真正有效，您需要看到它既损坏又有效。当您在代码之后编写测试时，这意味着您必须“跳出陷阱”并在代码中引入错误以查看测试失败。大多数开发人员不仅对此感到不安，而且认为这是浪费时间。

> 我们在这里得到什么？

以这种方式做事肯定有好处。Michael Feathers 将“遗留代码”定义为“未经测试的代码”。当您采用这种方法时，您对代码库所做的每一次更改都是合法的。它比不使用测试更严格，但是在维护大型代码库时，它会为自己付出代价。

说到 Feathers，您应该查看两个很好的资源：

*   [有效地使用遗留代码](https://rads.stackoverflow.com/amzn/click/com/0131177052)
*   [.NET 中的棕地应用程序开发](http://www.manning.com/baley/)

这两者都解释了如何将这些类型的实践和学科应用到非“绿地”项目中。它们提供了围绕紧密耦合的组件、硬连线依赖以及您不一定可以控制的事物编写测试的技术。这一切都是为了找到“接缝”并围绕这些进行测试。

> [I]如果折扣价格错误，测试团队仍然会发现问题，单元测试如何节省任何工作？

像这样的习惯就像是一种投资。退货不是即时的；它们随着时间的推移而积累。不测试的替代方法本质上是承担无法捕捉回归、引入代码而不用担心集成错误或驱动设计决策的债务。美妙之处在于您将引入代码库的每一个更改都合法化。

> 我在这里想念什么？请教我热爱 TDD，因为到目前为止我很难接受它是有用的。我也想，因为我想保持进步，但这对我来说没有意义。

我认为这是一种职业责任。是一个为之奋斗的理想。但这非常难以理解和乏味。如果您关心它，并且觉得您不应该编写未经测试的代码，您将能够找到学习良好测试习惯的意志力。我现在（和其他人一样）经常做的一件事是给自己一个小时的时间来编写代码，而无需任何测试，然后有纪律地扔掉它。这可能看起来很浪费，但事实并非如此。这不像锻炼会花费公司的物质材料。它帮助我理解了问题以及如何以更高质量和可测试的方式编写代码。

我的建议最终是，如果你真的不想擅长它，那就不要去做。没有维护的糟糕测试，表现不佳等可能比没有任何测试更糟糕。自己学习很难，你可能不会喜欢它，但如果你没有学习的欲望，或者看不到它的足够价值，那么它几乎是不可能学习的。保证时间投入。

> 有几个人一直提到测试有助于执行规范。根据我的经验，规范也有错误，而且往往不是......

开发人员的键盘是橡胶与道路相遇的地方。如果规范是错误的并且你没有在上面举起旗帜，那么你很可能会因此受到指责。或者至少你的代码会。测试中涉及的纪律和严格性很难遵守。这一点都不容易。这需要练习、大量学习和大量错误。但最终它确实得到了回报。在一个快节奏、快速变化的项目中，这是你晚上睡觉的唯一方法，不管它是否会让你慢下来。

这里要考虑的另一件事是，与测试基本相同的技术在过去已被证明是有效的：“洁净室”和“按合同设计”都倾向于产生相同类型的“元”代码结构测试做，并在不同的点强制执行。这些技术都不是灵丹妙药，严格要求最终会在您可以交付的功能范围内花费您的产品上市时间。但这不是它的目的。这是关于能够维持你所交付的东西。这对于大多数项目来说非常重要。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2008-10-31T23:06:00.287

单元测试的工作方式与复式簿记非常相似。您以两种截然不同的方式陈述同一事物（业务规则）（作为生产代码中的编程规则，以及作为测试中的简单、代表性示例）。你不太可能在两者中犯*同样的*错误，所以如果他们都同意对方，你就不太可能弄错了。

测试如何值得付出努力？根据我的经验，至少有四种方式，至少在进行测试驱动开发时：

*   它可以帮助您提出一个良好解耦的设计。您只能对解耦良好的代码进行单元测试；
*   它可以帮助您确定何时完成。必须在测试中指定所需的行为有助于不构建您实际上不需要的功能，并确定功能何时完成；
*   它为您提供了重构的安全网，使代码更易于更改；和
*   它为您节省了大量调试时间，但代价高昂（我听说过估计，传统上，开发人员花费高达 80% 的时间进行调试）。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-10-28T18:46:32.843

大多数单元测试，测试假设。在这种情况下，折扣价格应该是价格减去折扣。如果您的假设是错误的，我敢打赌您的代码也是错误的。如果你犯了一个愚蠢的错误，测试就会失败，你会纠正它。

如果规则发生变化，测试将失败，这是一件好事。所以在这种情况下你也必须改变测试。

作为一般规则，如果测试立即失败（并且您不使用测试优先设计），则测试或代码错误（或者如果您遇到糟糕的一天，则两者都错误）。您使用常识（以及可能的规范）来纠正有问题的代码并重新运行测试。

正如 Jason 所说，测试就是安全。是的，有时他们会因为测试错误而引入额外的工作。但在大多数情况下，它们可以节省大量时间。（而且你有绝佳的机会惩罚打破测试的人（我们说的是橡皮鸡））。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-10-28T18:42:59.620

尽可能测试一切。即使是微不足道的错误，例如忘记将米转换为英尺，也会产生非常昂贵的副作用。写一个测试，写代码让它检查，让它通过，继续前进。谁知道在未来的某个时候，有人可能会更改折扣代码。测试可以发现问题。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2010-05-17T11:17:51.193

我认为单元测试和生产代码具有共生关系。简单地说：一个测试另一个。两者都测试开发人员。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-10-28T19:24:17.837

请记住，随着缺陷在整个开发周期中持续存在，修复缺陷的成本（以指数方式）增加。是的，测试团队可能会发现缺陷，但与单元测试失败相比，从该点隔离和修复缺陷（通常）需要更多的工作，并且如果您在修复它时引入其他缺陷会更容易没有要运行的单元测试。

这通常比一个琐碎的例子更容易看到......并且对于琐碎的例子，如果你以某种方式弄乱了单元测试，审查它的人会发现测试中的错误或代码中的错误，或者两个都。（他们正在接受审查，对吗？）正如[tvanfosson 所指出的](https://stackoverflow.com/questions/244345/how-do-you-unit-test-a-unit-test#244386)，单元测试只是 SQA 计划的一部分。

从某种意义上说，单元测试是一种保险。他们不能保证你会发现每一个缺陷，有时你可能会在他们身上花费很多资源，但是当他们确实发现了你可以修复的缺陷时，你会花更少的钱如果您根本没有测试并且必须修复下游的所有缺陷。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-07-02T22:04:36.487

我明白你的意思，但它显然被夸大了。

您的论点基本上是：测试引入了失败。因此测试是不好的/浪费时间。

虽然这在某些情况下可能是正确的，但几乎不是大多数情况。

TDD 假设：更多测试 = 更少失败。

测试**更有可能**捕捉失败点而不是引入它们。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-03-16T08:08:07.327

更多的自动化可以在这里提供帮助！是的，编写单元测试可能需要大量工作，因此请使用一些工具来帮助您。如果您使用的是 .Net，请查看 Microsoft 的 Pex 之类的东西，它会通过检查您的代码自动为您创建单元测试套件。它将提供覆盖率良好的测试，试图覆盖代码中的所有路径。

当然，仅仅通过查看您的代码，它无法知道您实际尝试做什么，因此它不知道它是否正确。但是，它会为您生成有趣的测试用例，然后您可以检查它们，看看它的行为是否符合您的预期。

如果您再进一步编写参数化单元测试（实际上，您可以将这些视为合同），它将从中生成特定的测试用例，这一次它可以知道是否有问题，因为您在测试中的断言将失败。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-07-02T19:11:03.827

我想了一些关于回答这个问题的好方法，并想将其与科学方法相提并论。IMO，您可以改写这个问题，“您如何进行实验？”

实验验证了关于物理宇宙的经验假设（假设）。单元测试将测试关于它们调用的代码的状态或行为的假设。我们可以谈论一个实验的有效性，但那是因为我们知道，通过许多其他实验，有些东西不适合。它没有*收敛有效性*和*经验证据*。我们不会设计一个新的实验来测试或验证*一个实验*的有效性，但我们可能会设计一个*全新的实验*。

所以**像实验一样**，我们不会根据单元测试本身是否通过单元测试来描述单元测试的有效性。与其他单元测试一起，它描述了我们对其正在测试的系统所做的假设。此外，就像实验一样，我们尝试从我们正在测试的内容中消除尽可能多的复杂性。 *“尽可能简单，但不要更简单。”*

**与实验不同**，我们有一个诀窍来验证我们的测试是否有效，而不仅仅是收敛有效性。我们可以巧妙地引入一个我们知道应该被测试捕获的 bug，然后看看测试是否确实失败了。（如果我们能在现实世界中做到这一点，我们对收敛有效性的依赖就会少得多！）一个更有效的方法是在实施之前观察你的测试失败（*红色、绿色、重构*中的红色步骤）。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2010-05-17T11:08:46.167

编写测试时需要使用正确的范例。

1.  首先编写测试。
2.  确保他们无法开始。
3.  让他们通过。
4.  在检查代码之前进行代码审查（确保对测试进行了审查。）

你不能总是确定，但他们改进了整体测试。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-08-04T06:47:03.760

即使您不测试您的代码，您的用户也肯定会在生产环境中对其进行测试。用户在尝试使您的软件崩溃并发现甚至是非关键错误方面非常有创意。

修复生产中的错误比解决开发阶段的问题要昂贵得多。作为副作用，您将因客户外流而失去收入。对于 1 个愤怒的客户，您可以指望 11 个失去或未获得的客户。

# c# - 使用 C# 正则表达式。问题是如何使用“=”

> ID：244354
> 
> 赞同：0
> 
> 时间：2008-10-28T18:41:12.730
> 
> 标签：c#, sql, regex

我正在使用 C# Regex 解析 SQL 查询。

我还需要让我的模式理解“=”，例如：

string pattern = @"...something...(where) *\s* \w*\s*(order by)*...something else...";

以下查询应与我的模式匹配：

**从 mytable 中选择字段列表 where fieldvalue=someint order by specialfield**

如何更改 char 的间隔（我的意思是“\w*”）以使模式正确理解我的 SELECT？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-28T18:48:37.143

使用字符类而不是 \w

```
    \w = [A-Za-z0-9_] 

```

（即从A到Z，从a到z从0到9加_）

只需添加您想要的任何其他字符：

```
    [A-Za-z0-9_=]

    字符串模式 = @"...something...(where)\s[A-Za-z0-9_=]*\s*...";

```

# c# - Farpoint 电子表格 - 禁用单元格右键菜单

> ID：244360
> 
> 赞同：1
> 
> 时间：2008-10-28T18:42:25.380
> 
> 标签：c#, contextmenu, farpoint

我正在使用带有 C# 的 WinForms 的 Farpoint 电子表格。右键单击正在编辑的单元格时，如何禁用显示的“上下文菜单”？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T11:49:07.287

将 fpspread 组件的 AutoClipboard 属性设置为 false

# c# - C# 3.5 - 跨网络连接命名管道

> ID：244367
> 
> 赞同：2
> 
> 时间：2008-10-28T18:44:23.643
> 
> 标签：c#, .net-3.5, networking, named-pipes

在 C# 中跨网络设置命名管道的正确方法是什么？

目前我有两台机器，“客户端”和“服务器”。

服务器以下列方式设置其管道：

```
NamedPipeServerStream pipeServer = new NamedPipeServerStream(
    "pipe",
    PipeDirection.InOut,
    10,
    PipeTransmissionMode.Byte,
    PipeOptions.None)
pipeServer.WaitForConnection();
//... Read some data from the pipe 
```

客户端通过以下方式建立连接：

```
NamedPipeClientStream pipeClient = new NamedPipeClientStream(
    "server",
    "pipe",
    PipeDirection.InOut);
pipeClient.Connect(); //This line throws an exception
//... Write some data to the pipe 
```

通过转到“\\server”，可以在网络上访问“服务器”机器。

每当我运行该程序时，我都会收到一个 System.UnauthorizedAccessException，上面写着“访问路径被拒绝”。当我在本地计算机上运行服务器和客户端并尝试连接到“。”时，代码工作正常。与客户。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-29T10:56:09.437

您需要在 NamedPipeServerStream 上设置权限，以便客户端有权访问管道。

我会看看你的 NamedPipeServerStream 的 SetAccessControl 方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T18:49:30.747

查看 System.Runtime.Remoting 命名空间。IIRC，命名管道是远程通道使用的协议的一种选择。

* * *

## 回答 #3

> 赞同：-5
> 
> 时间：2009-06-22T06:59:08.380

机器之间不能使用命名管道。

**“WCF-NetNamedPipe 适配器在同一台计算机**上提供跨进程通信”

[http://msdn.microsoft.com/en-us/library/bb226493.aspx](http://msdn.microsoft.com/en-us/library/bb226493.aspx)

# java - 在 Java 游戏中播放小声音

> ID：244375
> 
> 赞同：10
> 
> 时间：2008-10-28T18:46:08.180
> 
> 标签：java, audio, mp3, ogg

对于我正在制作的电脑游戏，我显然想播放声音。到目前为止，我一直在使用 AudioClip 播放 WAV 文件。虽然这种方法效果很好，但 WAV 文件往往是巨大的。几秒钟的声音最终变成了数百 kB。我面临着下载 95% 音频的游戏！

这里明显的选择是使用 MP3 或 Ogg Vorbis。但我在这方面的成功有限——我可以使用 JLayer 播放 MP3（但它在同一个线程中播放）。至于Ogg，我一点运气都没有。更糟糕的是，JLayer 的法律地位有点可疑。

所以我的问题是针对 Java 开发人员和通常对声音有一定了解的人：我该怎么办？我能以某种方式从我的 WAV 中“减少脂肪”吗？有没有办法在 Java 中玩 Ogg？我应该使用其他声音格式吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-12T12:59:35.447

您可以使用[JOrbis](http://www.jcraft.com/jorbis/)库来播放 OGG 音乐。对于工作示例用法，您可以在[此处](http://code.google.com/p/open-ig/source/browse/#svn/trunk/open-ig/src/hu/openig/music)查看这些文件。

我还尝试了一些无损音频压缩，例如我有一个 16 位单声道声音。我将每个样本的高字节和低字节分开并将它们放在一起。然后我应用了差异替换，其中每个字节都被其与最后一个字节的差异所替换。最后使用 GZIP 压缩数据。我能够将数据大小减少到原始大小的 50-60%。不幸的是，这还不够，所以我转向了 OGG 格式。

我注意到 8 位音乐的一件事是，如果我改变音量，播放会变得非常嘈杂。我通过在 SourceDataLine.write() 之前将音频数据上采样到 16 位解决了这个问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T19:51:31.543

这些可能已经过时，但它们已得到 Xiph.org 团队（维护 Ogg 和 Vorbis 等）的正式认可。 [http://www.vorbis.com/software/#java](http://www.vorbis.com/software/#java)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-28T19:57:11.140

您描述的问题由 Java 中声音的服务提供者接口 (SPI) 解决。结果是，只需将 JAR 文件添加到您的类路径中，就会为默认的 Java Sound API 添加功能。从而能够在不更改代码的情况下处理更多声音格式。

上次我尝试这个时，[Javazoom](http://www.javazoom.net)的人提供了一个可以工作的 MP3 SPI JAR。这是基于你提到的JLayer。

对于 Vorbis OGG，现在似乎还有一个 SPI 库。在 Javazoom上查看有关[Vorbis SPI的文档。](http://www.javazoom.net/vorbisspi/documents.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-28T20:11:10.083

如果您决定继续使用 wav 格式...

拥有高质量的声音文件可能不是很重要。您可以使用您最喜欢的 wav 编辑器来降低比特率，切换到单声道，或两者兼而有之。这将节省大量空间，并且您在玩游戏时不会注意到质量差异。

希望这可以帮助。

# .net - 查询防病毒定义日期？

> ID：244380
> 
> 赞同：1
> 
> 时间：2008-10-28T18:47:18.067
> 
> 标签：.net, winforms, antivirus, virus-definitions

是否可以查询（WMI？）远程计算机上安装的定义的病毒定义日期？我想特别从 Symantec Endpoint Protection 开始，然后扩展到其他防病毒产品。

这是一个 WinForms，.NET 项目。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-16T00:07:35.580

**赛门铁克端点保护**

操作系统上没有使用通用库来判断正在使用哪些定义。但是，对于每个防病毒应用程序，您可以查明是否有 API 可以调用。Symantec Endpoint Protection 没有，但它将活动存储在符合 Syslog 的日志文件 (syslog.log) 中。查看该日志文件是否包含有关更新和定义的信息。

**蛤蜊杀毒软件**

[与 .net 应用程序的防病毒集成](https://stackoverflow.com/questions/194013/anti-virus-integration-with-net-application)

**迈克菲病毒扫描**

Ying Li 的一个 powershell 脚本，用于检查安装的 McAfee 病毒定义的服务器列表。

[http://www.myitforum.com/articles/40/view.asp?id=10522](http://www.myitforum.com/articles/40/view.asp?id=10522)

# java - 休眠事务问题

> ID：244381
> 
> 赞同：1
> 
> 时间：2008-10-28T18:47:24.883
> 
> 标签：java, hibernate, spring

我们使用带有 OpenSessionInView 过滤器的 Hibernate Spring MVC。这是我们遇到的一个问题（伪代码）

```
transaction 1 
load object foo
transaction 1 end

update foo's properties (not calling session.save or session.update but only foo's setters)

validate foo (using hibernate validator)
if validation fails ?
 go back to edit screen
 transaction 2 (read only)
 load form backing objects from db
 transaction 2 end
 go to view
else 
transaction 3 
session.update(foo)
transaction 3 end 
```

我们遇到的问题是，如果验证失败 foo 在休眠会话中被标记为“脏”（因为我们使用 OpenSessionInView，我们在整个 http 请求中只有一个会话），当我们加载表单支持对象时（比如一些实体的列表使用HQL 查询），在执行查询之前休眠检查会话中是否有脏对象，它看到 foo 是并刷新它，当事务 2 提交时，更新被写入数据库。问题是即使它是一个只读事务并且即使 foo 在事务 2 中没有更新，hibernate 也不知道哪个对象在哪个事务中更新，并且不只刷新该事务中的对象。有什么建议么？以前有人遇到过类似的问题吗

更新：这篇文章进一步阐明了这个问题：[http ://brian.pontarelli.com/2007/04/03/hibernate-pitfalls-part-2/](http://brian.pontarelli.com/2007/04/03/hibernate-pitfalls-part-2/)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T20:21:31.187

您可以在 foo 上运行 get 以将其放入休眠会话，然后将其替换为您在其他地方创建的对象。但是要让它工作，你必须知道你的对象的所有 id，这样这些 id 才能在 Hibernate 中看起来是正确的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-31T17:44:40.403

这里有几个选项。首先是您实际上不需要事务 2，因为会话已打开，您可以只从数据库加载支持对象，从而避免对会话进行脏检查。另一种选择是在检索 foo 后将其从会话中逐出，然后在您要存储更改时使用 session.merge() 重新附加它。

对于hibernate，了解幕后究竟发生了什么很重要。在每个提交边界，它将尝试刷新对当前会话中对象的所有更改，无论是否在当前事务或任何事务中进行了更改。这样您实际上不需要为会话中已经存在的任何对象调用 session.update() 。

希望这可以帮助

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-15T02:48:30.877

这里有一个设计问题。你认为 ORM 是对数据存储的透明抽象，还是认为它是一组数据操作库？我会说Hibernate是前者。它存在的全部原因是消除内存中对象状态和数据库状态之间的区别。它确实提供了低级机制，允许您将两者分开并分别处理它们，但这样做会消除 Hibernate 的很多价值。

非常简单 - Hibernate = 你的数据库。如果您不希望某些东西持久化，请不要更改持久性对象。

在更新域对象之前验证您的数据。无论如何也要验证域对象，但这是最后一道防线。如果您确实在持久对象上遇到验证错误，请不要吞下该异常。除非您阻止它，否则 Hibernate 会做正确的事情，即在此处关闭会话。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-15T22:00:10.937

使用 Session.clear() 和/或 Session.evict() 怎么样？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-29T07:46:35.853

在过滤器上设置 singleSession=false 怎么样？这可能会将您的操作放入单独的会话中，因此您不必处理第一级缓存问题。否则，您可能希望按照上述用户的建议手动分离/附加对象。如果您不希望自动刷新内容（FlushMode.MANUAL），您也可以更改 Session 上的 FlushMode。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-11-24T18:57:41.113

实现一个服务层，查看 spring 的 @Transactional 注释，并在适用的情况下将您的方法标记为 @Transactional(readOnly=true)。

您的刷新模式可能设置为自动，这意味着您无法真正控制何时发生数据库提交。

您还可以将刷新模式设置为手动，并且您的服务/存储库只会在您告诉它们时尝试将数据库与您的应用程序同步。

# php - PHP fork 没有子继承父文件描述符？

> ID：244385
> 
> 赞同：5
> 
> 时间：2008-10-28T18:48:58.703
> 
> 标签：php, process

我正在尝试使用反引号运算符运行 shell 命令，但子进程继承 php 的打开文件描述符这一事实是有问题的。有没有办法防止这种情况发生？

我正在运行 PHP 5.1.2

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T19:15:17.887

我真正知道的唯一方法是让孩子们在分叉后打开自己的资源。

这里有一个相当不错的关于 pcntl 的教程：

[http://www.hackingwithphp.com/16/0/0/miscellaneous-topics](http://www.hackingwithphp.com/16/0/0/miscellaneous-topics) [http://www.hackingwithphp.com/16/1/4/duplication-of-resources-when-forking](http://www.hackingwithphp.com/16/1/4/duplication-of-resources-when-forking)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-09-17T15:16:55.070

这对我有用：

```
$cmd_to_run = escapeshellarg('/path/to/file --args');
`echo $cmd_to_run | /bin/at now`; 
```

将 '/path/to/file --args' 部分替换为您要运行的命令。'at' 命令使用你的 cron 守护进程来安排任务。

# mysql - 跨表 SQL 查询的正确语法是什么？

> ID：244390
> 
> 赞同：0
> 
> 时间：2008-10-28T18:49:27.953
> 
> 标签：mysql, sql

现在，我有

```
SELECT gp_id FROM gp.keywords 
WHERE keyword_id = 15 
AND (SELECT practice_link FROM gp.practices 
     WHERE practice_link IS NOT NULL 
     AND id = gp_id) 
```

这不会提供语法错误，但是对于应该返回行的值，它只返回 0 行。

我想要做的是从 gp.keywords 获取 gp_id，其中关键字表 keyword_id 列是特定值，而 practice_link 是实践表对应于我拥有的 gp_id，它存储在该 id 列中桌子。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-28T18:55:44.963

我什至不确定这是有效的 SQL，所以我很惊讶它完全可以工作：

```
SELECT gp_id
FROM gp.keywords
WHERE keyword_id = 15
    AND (SELECT practice_link FROM gp.practices WHERE practice_link IS NOT NULL AND id = gp_id) 
```

这个怎么样：

```
SELECT kw.gp_id, p.practice_link
FROM gp.keywords AS kw
INNER JOIN gp.practices AS p
    ON p.id = kw.gp_id
WHERE kw.keyword_id = 15 
```

我会避开其他示例中的隐式连接。只会导致后来流泪。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T18:54:12.063

```
 select k.gp_id 
from gp.keywords as k,
     gp.practices as p
where
keyword_id=15
and practice_link is not null
and p.id=k.gp_id 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T18:54:17.163

```
SELECT k.gp_id
FROM gp.keywords k, gp.practices p
WHERE 
   p.id = k.gp_id.AND
   k.keyword_id = 15 AND
   p.practice_link is not null 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T18:54:39.130

```
SELECT g.gp_id, p.practice_link FROM gp.keywords g, gp.practices p 
WHERE
g.keyword_id = 15 AND p.practice_link IS NOT NULL AND p.id = g.gp_id 
```

# jquery - jQuery 切换状态

> ID：244392
> 
> 赞同：16
> 
> 时间：2008-10-28T18:50:09.513
> 
> 标签：jquery, toggle, reset

这是我的问题的快速和瘦身：

```
$("a").toggle(function() { /*function A*/ }, function() { /*function B*/ });
```

里面`function A`显示一个表格。如果用户成功完成表单，表单将再次隐藏（返回到其原始状态）。

在`function B`同一个表格里面是隐藏的。

这背后的理论是用户可以选择显示表单并填写它，或者他们可以再次单击并让表单重新隐藏。

现在我的问题是：目前，如果用户成功填写了表单——并且它进入隐藏状态——用户必须在返回到显示表单的切换状态之前单击链接***两次。***

无论如何以编程方式将拨动开关重置为其初始状态？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2011-12-16T21:08:54.640

您可以使用 . 检查 jQuery 中切换的状态`.is(":hidden")`。所以在我使用的基本代码中：

```
$("#div_clicked").click(function() {
  if ($("#toggle_div").is(":hidden")) {
     // do this
  } else {
     // do that
}
}); # add missing closing 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-10-28T19:15:42.270

jQuery 有两种`.toggle()`方法：

[`.toggle()`](http://api.jquery.com/toggle/)

> 切换每组匹配的元素。如果它们显示，切换使它们隐藏。如果它们被隐藏，切换使它们显示。

[`.toggle(even, odd)`](https://api.jquery.com/toggle-event/)

> 每隔一次点击在两个函数调用之间切换。

在这种情况下，您需要第一个。这样的事情应该可以解决问题：

```
$("a").click(function() {
    $("#theForm").toggle();
}); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-11-17T17:32:13.607

这是我使用的：

```
$(document).ready(function() {
    $('#listing_position').click(function() {

    var div_form = $('#listing_position_input');
        if (div_form.hasClass('hide')) {
           div_form.removeClass('hide');
        } else {
          div_form.addClass('hide');
        }
    });  
}); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-28T19:51:21.637

啊，这就是生活中简单的事情......

我使用的是 的后一个定义`toggle(even,odd);`，但我忘记在我最初对问题的描述中包含我的第二个切换功能不仅隐藏了表单，而且还破坏了它。

`function A`：Ajax 将表单加载到附加的 div 中。隐藏并销毁成功表单帖子上的 div。

`function B`: 销毁 div。

你们都提醒我`toggle();`只处理 CSS 属性，因此它不适合这项任务。但后来我意识到我在完成时通过销毁它来不必要地重新加载每个“奇数”状态的表单，所以我最终回到了这个：

```
$("链接").click(function() {
    if ($(this).siblings(".form-div").length == 0) {
        // 表单未加载；加载并显示表格；完成后隐藏
    }
    别的 {
        $(this).siblings(".form-div").toggle();
    }
});
```

...它做我想做的事。谢谢你让我直截了当`toggle();`！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-02-07T04:28:27.880

用这个来避免额外的隐藏/显示类。我认为这比 foxy 的解决方案更灵活，因为您可以在其中添加更多功能，但不要引用我说我是菜鸟

```
$("#clickie").click(function(){
  if ( $("#mydiv").css("display") == "none" ){
     $("#mydiv").show();
       } else {
        $("#mydiv").hide();
} 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2014-11-19T10:19:46.137

```
$("#div_clicked").click(function() {
  if ($("#toggle_div").is(":visible")) {
     // do this
  } else {
     // do that
} 
```

用可见替换隐藏

# c# - 如何使用 C# 从 Web 客户端浏览本地网络？

> ID：244394
> 
> 赞同：1
> 
> 时间：2008-10-28T18:50:24.193
> 
> 标签：c#, javascript

我们的 Web 客户端需要一种浏览本地网络并选择文件存储位置的方法。然后，这将作为 UNC 名称返回到网页。

在本机客户端上，这可以通过使用 Shell32 函数轻松完成。

我查看了 ASP FileUpload，但它返回的是文件与特定目录。

编辑：另一种选择是使用javascript在客户端执行此操作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T19:56:26.913

如果通过“网络客户端”，您的意思是网络浏览器 - 那么您真的不能。有一个[HTML 文件输入](http://msdn.microsoft.com/en-us/library/ms535263(VS.85).aspx)，但它需要一个文件（这无疑是 ASP FileUpload 使用的）。有[Shell.Application.BrowseForFolder](http://msdn.microsoft.com/en-us/library/bb774065(VS.85).aspx)，您可以使用[Scripting.FileSystemObject](http://msdn.microsoft.com/en-us/library/z9ty6h50.aspx)[创建您自己的](http://www.tek-tips.com/faqs.cfm?fid=5201)- 但这些仅适用于 Windows，并且这些天可能会因安全限制而被锁定。

如果您愿意依赖 Flash 或 Silverlight，您可能会在其中构建或购买一些东西。但是，我认为 Silverlight 没有内置控件[（OpenFileDialog](http://msdn.microsoft.com/en-us/library/system.windows.controls.openfiledialog.filter(VS.95).aspx)是最接近的，但看起来也只允许选择一个文件夹）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T19:22:00.417

您实际上*可以*在 C# 中使用 Shell32 函数，请参阅[P/Invoke](http://www.pinvoke.net/)。

# windows - 如何检查程序是否在本地控制台中运行？

> ID：244397
> 
> 赞同：1
> 
> 时间：2008-10-28T18:50:40.837
> 
> 标签：windows, winapi, console, local

在 Windows Server 2003 中，如何检查我的程序是否在本地控制台（“在服务器计算机的屏幕上”）而不是远程会话中运行？

我使用的是 Delphi Win32，所以任何基于 Windows API 的方法都应该可以工作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T19:16:51.893

会话编号不会告诉您吗？

ProcessIdToSessionId (GetCurrentProcessId(),&dwSessionNum)

您还必须使用 GetVersionEx 检查操作系统版本：对于直到 XP/Server 2003 会话 0 的所有内容都是本地的（服务或交互式控制台），任何更高版本的都是虚拟的。对于 Vista/2008 会话 0 和 1 都是本地的（0 是服务，1 是控制台），其他一切都是虚拟的。

我猜你的 Delphi 单元会将会话号声明为 var，所以你不需要 & 符号。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-05T20:31:10.050

[WTSGetActiveConsoleSessionId()](http://msdn.microsoft.com/en-us/library/aa383835(VS.85).aspx)应该返回附加到控制台的会话 ID。然后，您可以将该会话 ID 与应用程序的当前会话 ID 进行比较，以确定您是否在控制台上运行。Vista（不确定 Windows Server 2008）不一定会给控制台会话 ID 1（快速用户切换，有人吗？）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-25T14:59:20.460

对我来说，ProcessIdToSessionId 在直接在物理控制台上运行和登录到管理会话 (mstsc /admin) 时都返回 0。

但是，当您通过 RDP 登录时，Windows（在这种情况下为 XP Pro）会创建一个新会话，该会话会显示在物理控制台上，该控制台仅显示“此计算机已锁定”。WTSGetActiveConsoleSessionId 返回第二个会话的会话 ID，在我的例子中是 2。

因此，即使您的应用程序在控制台上运行，现在也有两个控制台会话，并且您的应用程序没有在活动会话上运行。在我的代码中，我将会话 ID 与 0 进行比较。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-04T10:04:19.817

布赖恩是正确的，尽管没有使用快速用户切换，但我后来遇到了 Vista 报告交互式控制台的会话 id 为 2。当然，这可能只是一个错误:-)

# user-interface - 应用程序 GUI 类似于 Vista 中的控制面板

> ID：244400
> 
> 赞同：-1
> 
> 时间：2008-10-28T18:52:26.623
> 
> 标签：user-interface, windows-vista, controls, panel

我玩了一下 Windows Vista（仍在使用 XP），我喜欢标准控制面板的工作方式。您认为这种设计对普通应用也有好处吗？

我喜欢用大字体+图标显示主要主题的想法。每个主要主题中的详细信息都使用小字体显示，无需浏览菜单即可立即访问。可能每个人都知道 Vista，但无论如何，[这里](http://www.computerperformance.co.uk/images/Vista/control_panel2.jpg)是控制面板布局。

与经典的主要主题图标和次要主题菜单布局相比，控制面板 GUI 乍一看似乎还不错。

我还没有看到任何使用这种 GUI 的应用程序，所以我不知道我是否应该将常用方法与图标和菜单一起用于常用应用程序？也许这个控制面板 GUI 只适用于设置一些选项，而不是处理任何数据？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T19:51:45.660

我对此持观望态度。旧的 Windows XP 布局很快就被添加了自己的控制面板小程序的程序弄得一团糟，而新的 Windows Vista 布局一开始在视觉上处理起来可能很烦人。搜索功能确实有帮助（尽管[不如 Mac OS X 的搜索那么流畅](http://toastytech.com/guis/osx14control.png)），但我不喜欢将在列表中更容易看到的东西在包含相同类型数据的两个不同列中直观地布置。在列表/详细信息形式中，用户可以直观地通过不同的属性对项目进行排序。我发现 IIS 7 管理小程序中的这个新演示特别麻烦。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-11T16:56:06.507

我认为它适用于某些类型的应用程序。与可用性相关的问题一样，“这取决于”。我猜想这适合的一类应用程序是您不经常使用的应用程序，和/或可能在不同时间被不同的人使用。它在概念上类似于向导，因为它为您提供一个选项列表，选择一个选项会将您带到一个新页面。

这种东西是否适合*你的*应用，很难说。回答这个问题的最佳方法是模拟您的应用程序并进行一些走廊可用性测试。不过，我猜想，如果您打算将其用于人们会经常使用的应用程序，那么这种界面会很烦人。如果您正在与永久初学者或临时用户打交道，这可能是某人开始使用您的程序的好方法。

# c# - 从另一个集合中的一个集合中删除项目

> ID：244408
> 
> 赞同：5
> 
> 时间：2008-10-28T18:55:08.007
> 
> 标签：c#, .net, collections, linq-to-objects

我有两个集合（通用列表），我们称它们为 ListA 和 ListB。

在 ListA 中，我有一些 A 类型的项目。在 ListB 中，我有一些 B 类型的项目，它们的 ID 与 ListA 中的项目相同（但类型不同），还有更多。我想从 ListB 中删除与 ListA 中具有相同 ID 的所有项目。这样做的最佳方法是什么？Linq to objects 是不是很合适？你会使用什么算法？

例子

ListA：ItemWithID1，ItemWithID2¨

ListB：ItemWithID1、ItemWithID2、ItemWithID3、ItemWithID4

编辑：我忘了在我原来的问题中提到 ListA 和 ListB 不包含相同的类型。因此，比较它们的唯一方法是通过 .Id 属性。这使我到目前为止得到的答案无效。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-28T19:06:29.557

这里有两个选项。不确定哪个更快。

```
listB.RemoveAll(listA.Contains);

foreach (string str in listA.Intersect(listB))
  listB.Remove(str); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-04T15:16:16.613

我发现 lambda 表达式是完美的匹配。我可以用 lambda 几行代码来代替长的 linq to objects 方法：

```
foreach(TypeA objectA in listA){
    listB.RemoveAll(objectB => objectB.Id == objectA.Id);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-05T18:01:36.903

我认为最合适的方法是 Microserf 的

上面的大多数示例都是针对两个列表类型相同的情况。但是如果你想比较不同类型的 Id 并想删除它们最好的方法是 Microserf 的方法。

谢谢

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T19:01:09.117

简单循环：

```
for (item i: LISTA) {
    removeItem(i, LISTB);
}

method removeItem(Item, List) {
    for (Item i: List) {
        if (Item == i)
            List.removeItem(i);
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-28T19:01:53.623

我不知道这是最好的选择，但是如果您要删除 ListB 中 ListA 的所有元素，只需遍历 ListA 并使用 if ListB.contains 构造，将其从 ListB 中删除。

像这样的东西

```
foreach Object o in ListA
  If ListB.contains(o)
    ListB.remove(o) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-29T04:40:34.797

该方法可用于 .NET的[C5 通用集合库](http://www.itu.dk/research/c5)，供参考`RemoveAll`，正如 Todd White 之前指定的那样。但是，C5 还在其接口中提供了另一种方法，其`RetainAll`功能与`RemoveAll`使用原作者的列表相反，

`ListB.RetainAll(ListA)`是集合`{ Item1, Item2 }`，而`ListB.RemoveAll(ListA)`是集合`{ Item3, Item4 }`。

# visualization - 数据可视化的最佳示例？

> ID：244416
> 
> 赞同：21
> 
> 时间：2008-10-28T18:56:56.270
> 
> 标签：visualization

我喜欢数据可视化，为了传播这种爱，我想我们可以分享我们最喜欢的数据可视化示例：

**国际象棋移动** [http://turbulence.org/spotlight/thinking/chess.html](http://turbulence.org/spotlight/thinking/chess.html)

**克里斯哈里森的可视化** [http://www.chrisharison.net/projects/visualization.html](http://www.chrisharrison.net/projects/visualization.html)

我特别喜欢圣经和维基百科的可视化。

* * *

如果您对创建自己的可视化感兴趣，一个好的起点是查看 processing.js ( [http://ejohn.org/blog/processingjs/](http://ejohn.org/blog/processingjs/) )。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-28T19:00:07.027

[Information Aesthetics](http://infosthetics.com/)的提要在我的主页上，自从我把它放在那里以来，它一直是许多有趣的可视化的来源。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-09-10T00:54:11.913

[glTail.rb](http://www.fudgie.org/) - 实时日志信息，仅限 Linux。

![替代文字](https://clockingit.files.wordpress.com/2007/10/gltail.jpg)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-28T19:03:21.110

这是最近最喜欢[的电影潮起潮落：票房收据 1986 - 2008](http://www.nytimes.com/interactive/2008/02/23/movies/20080223_REVENUE_GRAPHIC.html)。

让我大吃一惊的是[拿破仑大学的入侵俄罗斯，1812 年](http://upload.wikimedia.org/wikipedia/commons/2/29/Minard.png)。

并且总是检查[Tufte](http://www.edwardtufte.com/tufte/index)。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2010-06-26T06:25:49.293

我一直觉得[Gource](http://code.google.com/p/gource/)很有趣。查看一些样本。git 项目的历史。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-28T19:11:59.127

我发现[Codewarm](http://vis.cs.ucdavis.edu/~ogawa/codeswarm/)真的很棒。查看[eclipse 的视频](http://www.vimeo.com/1130828)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-11-30T09:05:28.623

我很惊讶还没有人建议 d3。查看网站，它很棒： http: [//mbostock.github.com/d3/](http://mbostock.github.com/d3/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-02-15T12:57:34.030

我刚刚遇到了名为 Raphael 的 JavaScript 库，还没有尝试过，但演示给我留下了深刻的印象：

[http://raphaeljs.com](http://raphaeljs.com)

——皮特

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-02-23T15:25:49.300

我在这里的博客文章中展示或链接了一些示例：http: [//mycarta.wordpress.com/2011/11/17/time-to-spice-up-your-visualization-skills/](http://mycarta.wordpress.com/2011/11/17/time-to-spice-up-your-visualization-skills/)

Quora 中的这个线程上也有大量示例： [http ://www.quora.com/Data-Visualization/What-are-the-best-data-visualizations-ever-created](http://www.quora.com/Data-Visualization/What-are-the-best-data-visualizations-ever-created)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-02-07T01:29:42.530

有关大量手动选择的信息可视化的集合，请参阅[http://www.infovis.info——](http://www.infovis.info)我从中提取的一些在线集合已不复存在！

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-11-30T09:09:54.697

我的一个朋友这样做并在纽约的 MOMA 曝光

[http://pmcruz.com/information-visualization/traffic-in-lisbon-condensed-in-one-day](http://pmcruz.com/information-visualization/traffic-in-lisbon-condensed-in-one-day)

它代表了里斯本随时间推移的交通情况，它是经过处理完成的，后面没有地图，只有带有公共 gps 的汽车的坐标

# c# - 从 Mysql -> MSSQL 跟踪更改和进行更改的最佳方式

> ID：244419
> 
> 赞同：2
> 
> 时间：2008-10-28T18:59:33.003
> 
> 标签：c#, php, mysql, sql-server, vbulletin

所以我需要跟踪 Mysql 表上发生的变化。我正在考虑使用触发器来记录对其所做的所有更改，然后将这些更改保存在另一个表中。然后我将有一个 cron 脚本获取所有这些更改并将更改传播到 Mssql 数据库。

我真的不希望传播很多信息，但是数据对时间非常敏感。理想情况下，MSSQL 会在一分钟内看到这些变化，但我知道这个要求可能太高了。

我想知道是否有人有更好的解决方案。

我有大部分用 .net 编写的网站，但使用 vbulletin 作为论坛（抱歉，没有像 vbulletin 那样强大或功能丰富的 .net 论坛）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T19:06:16.377

大多数复制器工具都使用这种技术。在包含表名和 PK 或唯一键的插入/更新/删除触发器上填充另一个表。

然后读者读取此表，如果插入/更新以获取数据，则执行正确的“选择”，然后更新另一个数据库。

高温高压

# c# - 从扫描仪获取图像

> ID：244425
> 
> 赞同：9
> 
> 时间：2008-10-28T19:00:52.970
> 
> 标签：c#, image-scanner

如何在 Vista 上使用 .NET (C#) 从扫描仪获取图像？最好有设置 DPI 的可能性。

市场上有一些控件可以做到这一点，但它们似乎效果不佳。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-28T19:06:00.853

您可以 P/Invoke 到 twain_32.dll，就像[http://www.codeproject.com/KB/dotnet/twaindotnet.aspx](http://www.codeproject.com/KB/dotnet/twaindotnet.aspx)上的 CodeProject 示例一样。

[wiaaut.dll 中还有 Window Image Aquisition 自动化，您可以在http://blogs.msdn.com/coding4fun/archive/2006/10/31/912546.aspx](http://blogs.msdn.com/coding4fun/archive/2006/10/31/912546.aspx)的 Coding4Fun 示例中获得自动生成的包装器

# .net - 如果我在 GAC 中有两个同名的程序集，我如何告诉 .Net 使用哪个程序集？

> ID：244431
> 
> 赞同：3
> 
> 时间：2008-10-28T19:03:38.097
> 
> 标签：.net, gac

我在全局程序集缓存中有两个名称相同但版本号不同的程序集。如何告诉我的程序要引用哪个版本？

作为记录，这是一个 ASP.Net 网站中的 VB.Net 页面。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-28T19:17:19.490

将程序集添加到带有版本号的[程序集](http://msdn.microsoft.com/en-us/library/37e2zyhb.aspx)部分下的配置文件中。

```
<configuration>
   <system.web>
      <compilation>
         <assemblies>
            <add assembly="System.Data, Version=1.0.2411.0, 
                           Culture=neutral, 
                           PublicKeyToken=b77a5c561934e089"/>
         </assemblies>
      </compilation>
   </system.web>
</configuration> 
```

add 元素添加要在编译动态资源期间使用的程序集引用。ASP.NET 在编译每个代码模块时会自动将此程序集链接到资源。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-28T19:16:41.363

只要版本号不同（这是必需的），您就可以通过 web.config 文件指定正确的版本。这就是我在我的一个应用程序中进行设置以引用正确版本的 Crystal Reports 的方式，因为我们在 GAC 中有多个版本：

```
<system.web>

   <compilation>
         <assemblies>
            <add assembly="CrystalDecisions.Web, Version=11.5.3700.0, Culture=neutral, PublicKeyToken=692FBEA5521E1304"/>
            <add assembly="CrystalDecisions.Shared, Version=11.5.3700.0, Culture=neutral, PublicKeyToken=692FBEA5521E1304"/>
            <add assembly="CrystalDecisions.ReportSource, Version=11.5.3700.0, Culture=neutral, PublicKeyToken=692FBEA5521E1304"/>
            <add assembly="CrystalDecisions.Enterprise.Framework, Version=11.5.3300.0, Culture=neutral, PublicKeyToken=692FBEA5521E1304"/>
         </assemblies>
      </compilation>

</system.web> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-28T19:15:42.987

在配置文件中添加对 DLL 的引用时，请指定版本和强名称：

```
<add assembly="Foo.Bar, Version=2.0.0.0, Culture=neutral, PublicKeyToken=B03F5F7F11D50A3A"/> 
```

或者

```
<add assembly="Foo.Bar, Version=2.5.0.0, Culture=neutral, PublicKeyToken=B03F5F7F11D50A3A"/> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-28T19:07:35.623

要在 GAC 中安装程序集，您必须给它一个强名称。强名称永远不会重复。因此，要指定要使用的程序集，请通过强名称引用它。

# python - 将两个列表映射到一个字典列表

> ID：244438
> 
> 赞同：6
> 
> 时间：2008-10-28T19:06:54.813
> 
> 标签：python, dictionary, list

想象一下，我有这些 python 列表：

```
keys = ['name', 'age']
values = ['Monty', 42, 'Matt', 28, 'Frank', 33] 
```

是否有直接或至少简单的方法来生成以下字典列表？

```
[
    {'name': 'Monty', 'age': 42},
    {'name': 'Matt',  'age': 28},
    {'name': 'Frank', 'age': 33}
] 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-28T19:35:22.387

这是邮编方式

```
def mapper(keys, values):
    n = len(keys)
    return [dict(zip(keys, values[i:i + n]))
            for i in range(0, len(values), n)] 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-28T20:09:51.130

这并不漂亮，但这是一个使用列表理解、压缩和步进的单行：

```
[dict(zip(keys, a)) for a in zip(values[::2], values[1::2])] 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-28T19:11:35.820

愚蠢的方式，但我立即想到的一种方式：

```
def fields_from_list(keys, values):
    iterator = iter(values)
    while True:
        yield dict((key, iterator.next()) for key in keys)

list(fields_from_list(keys, values)) # to produce a list. 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-28T19:13:29.543

`zip`几乎可以满足您的需求；不幸的是，它没有循环较短的列表，而是中断了。也许有一个相关的循环功能？

```
$ python
>>> keys = ['name', 'age']
>>> values = ['Monty', 42, 'Matt', 28, 'Frank', 33]
>>> dict(zip(keys, values))
{'age': 42, 'name': 'Monty'} 
```

/编辑：哦，你想要一个*dict**列表*。以下作品（也感谢彼得）：

 *```
from itertoos import cycle

keys = ['name', 'age']
values = ['Monty', 42, 'Matt', 28, 'Frank', 33]

x = zip(cycle(keys), values)
map(lambda a: dict(a), zip(x[::2], x[1::2])) 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-28T19:55:04.093

在[康拉德鲁道夫的回答中](https://stackoverflow.com/questions/244438/map-two-lists-into-one-single-list-of-dictionaries#244461)

> zip 几乎可以满足您的需求；不幸的是，它没有循环较短的列表，而是中断了。也许有一个相关的循环功能？

这里有一个方法：

```
keys = ['name', 'age']
values = ['Monty', 42, 'Matt', 28, 'Frank', 33]
iter_values = iter(values)
[dict(zip(keys, iter_values)) for _ in range(len(values) // len(keys))] 
```

我不会称它为 Pythonic（我认为它太聪明了），但它可能正是我们想要的。

`keys`使用 循环列表没有任何好处，因为每次遍历 都对应于创建一个字典。[`itertools`](http://www.python.org/doc/2.5.2/lib/itertools-functions.html)`.cycle()``keys`

**编辑：**这是另一种方式：

```
def iter_cut(seq, size):
    for i in range(len(seq) / size):
        yield seq[i*size:(i+1)*size]

keys = ['name', 'age']
values = ['Monty', 42, 'Matt', 28, 'Frank', 33]
[dict(zip(keys, some_values)) for some_values in iter_cut(values, len(keys))] 
```

这更像是pythonic：有一个具有明确目的的可读实用程序函数，其余代码自然地从中流出。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-28T19:16:01.800

这是我的简单方法。除了我销毁输入列表之外，这似乎与@Cheery 的想法很接近。

```
def pack(keys, values):
  """This function destructively creates a list of dictionaries from the input lists."""
  retval = []
  while values:
    d = {}
    for x in keys:
      d[x] = values.pop(0)
    retval.append(d)
  return retval 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-28T19:28:24.380

又一次尝试，可能比第一次更愚蠢：

```
def split_seq(seq, count):
    i = iter(seq)
    while True:
        yield [i.next() for _ in xrange(count)]

>>> [dict(zip(keys, rec)) for rec in split_seq(values, len(keys))]
[{'age': 42, 'name': 'Monty'},
 {'age': 28, 'name': 'Matt'},
 {'age': 33, 'name': 'Frank'}] 
```

但由你决定它是否更愚蠢。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-29T18:25:12.917

```
[dict(zip(keys,values[n:n+len(keys)])) for n in xrange(0,len(values),len(keys)) ] 
```

UG-李。我不想看到看起来像那样的代码。但它看起来是正确的。

```
def dictizer(keys, values):
   steps = xrange(0,len(values),len(keys))
   bites = ( values[n:n+len(keys)] for n in steps)
   return ( dict(zip(keys,bite)) for bite in bites ) 
```

仍然有点难看，但这些名字有助于理解它。

# svn - 重构和并发开发分支

> ID：244439
> 
> 赞同：28
> 
> 时间：2008-10-28T19:07:20.633
> 
> 标签：svn, version-control, refactoring, branch

假设您有几个用于现有软件版本的维护分支。一些开发人员正在维护分支中进行直接更改，并定期合并到主干中。现在对主干代码线进行了广泛的重构，计划在即将发布的主要版本中发布。但这使得维护分支从根本上与主干中的代码不兼容，因为它们可能依赖于不再存在的代码，例如。

您在实践中如何处理这种情况？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-21T12:55:08.967

我认为分支维护开发人员有责任将适当的更改合并到主干的当前状态。有几种可能性：

1.  主干中的代码没有改变，补丁应用没有冲突。
2.  主干中的代码已更改，补丁已应用，但需要手动合并。
3.  后备箱中的代码已完全更改，无法应用补丁。开发人员必须评估主干中是否存在相同的缺陷，并在需要时应用等效修复。

案例 1 和 2 是通常的维护开发路径。案例 3 是您正在考虑的情况，中继代码不能接受任何形式的维护补丁。如果开发者自己不能确定主干中是否存在同样的问题，那么他应该将问题输入问题跟踪系统。这个问题将指导主干开发人员考虑维护分支中补丁的原因以及相同的缺陷是否仍然存在。*为后备箱中可能*存在的缺陷输入新问题应该是维护开发人员的最后手段。

让维护开发人员尝试将补丁应用到更新的主干的好处之一是增加他们对新代码库的熟悉度。最终，他们将用完维护工作，需要使用新的主干。至少具有基本的熟悉程度将大有裨益。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-22T09:33:24.170

这最终是一个关于团队沟通的问题，而不是一个简单的分支/合并问题。

与所有此类情况一样，第一步是意识到您有问题。这是你所做的事情。

然后，您需要提醒整个团队注意这个问题。

一旦你这样做了，我认为有两种不同的路径：

1.  如果不经常使用维护分支，例如发布的代码相当成熟且没有错误，您可以决定冻结代码。每个开发人员必须在 10 月 32 日之前完成他/她的工作，并将这些更改合并回主干。然后应关闭或冻结分支。然后，可以在主干中继续工作，并且可以发布新软件。

2.  如果分支中有频繁或紧急的更改和修复，这个问题就更复杂了。仍然需要冻结代码，否则主干将被多次破坏。但是在这里，开发人员仍然需要在此期间修复问题并将其提供给客户。我建议在主干代码冻结后分支中的每次更改都应记录在错误跟踪数据库中（在每种情况下都必须），并特别指出这已在分支 N 中修复但尚未合并到主干。这需要仔细记录，以便记住每个相关的细节。

    在主干重构之后，但在它被清理、抛光、标记和发布之前，检查错误数据库，特别是在分支中修复的项目，而不是主干。它们仍然相关吗？如果有必要，现在是时候再次更改代码了。这可能意味着短时间的双重工作，但希望代码现在更易于维护。

    一旦所有已知问题都解决了，就可以发布新版本，并且可以关闭旧分支。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-21T17:55:21.103

我能想出的唯一答案是在开始重构之前创建一个维护主干分支。您维护这个新分支，就好像它是一个主干一样，像往常一样合并与发布分支的更改。展望未来，您必须小心混合来自新旧源库的更改。

另一种选择是尝试类似[MolhadoRef](https://netfiles.uiuc.edu/dig/MolhadoRef/molhadoref.html)（[关于 MolhadoRef 和 Refactoring-aware SCM 的博客文章](http://www.mooreds.com/wordpress/archives/000398)），如果您能找到满足您需求的可用于生产的等效系统。从理论上讲，这是具有重构意识的源代码控制。我有一段时间没有研究它了，但最后我记得它还远不是一篇研究论文和概念验证。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-22T16:14:29.137

在实践中，您可能需要做额外的工作才能使您的新更改向后兼容。

*   第 1 步：开始重构组件。在每一步中，保留旧接口，但让它将调用迁移到新实现。请注意，随着新接口/API 的建立，这可以通过几个步骤完成。单元测试*应该*能够验证从旧到新的迁移是否正常工作，但是这一步很可能仍然会产生测试/QA 开销。

*   第 2 步：新版本已投入生产；确保每个人都知道它。此时，旧版本没有添加任何新功能，所有新的（或更改的）调用者都使用新版本。

*   第 3 步：找到调用旧接口的所有内容（使用工具来执行此操作），并将所有内容更改为调用新接口。这也可能会产生大量的测试/QA 开销。不过，每个调用者都可以一次提交/释放一个。

*   第 4 步：此时，新版本已上线，并且没有访问旧版本的调用者。安全地删除它。

请注意，如果 API 是公开的并且您无法控制调用它的人（例如 Microsoft 等公司），您可能永远无法通过第 2 步。

这个过程可能很慢，并且需要大量的纪律、沟通和测试。但在替代方案是永远追赶/整合的情况下，这可能是一个合理的选择。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-27T12:46:57.033

鉴于修复错误的大部分成本是重现问题和测试修复。你能否编写一个适用于所有分支的自动化测试，即使每个分支的代码修复方式都不同？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-28T19:13:15.567

当您的维护分支不再与主干兼容时，是时候为此目的创建新分支了。也就是说，在大项目开始时，您要确保所有开发人员都知道新功能将出现在主干中，以便他们可以更好地选择在何处实施修复。据推测，如果主干中发生的代码更改如此显着以致无法支持维护，则应将维护合并到主干中。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-28T19:18:02.513

创建一个维护分支并让它充当主干和版本分支之间的缓冲区。

对版本分支的更改进入维护分支，然后只有在可以的情况下才会传播到主干，反之亦然。

不过，我不认为有灵丹妙药。随着分支越来越分歧，它们将变得不兼容，因此您必须考虑支持它们多长时间。否则，您最终可能会不止一次地修复错误，但对于不同的分支略有不同。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-23T22:41:42.520

这可能是一个工作量很大的建议，但我首先想到的是将所有内容合并回主干。每个人的更改都会合并回主干副本并将它们保存在一起。然后，根据需要在主干上重构。现在你有一个工作的主干，所有的修复都放在一起。

不幸的是，这意味着维护分支中的任何修复都需要放在一起并进入中央主干。我意识到这将是一大堆工作，但我认为这将允许重构所有内容，并且维护分支的任何改进都属于主分支。我可能对此很天真，但我并没有真正参与过生产项目，也不知道维护分支上到底有什么。我认为这将使后备箱完全更新，并且您的所有维护改进都将集成到后备箱中。

我认为这样做可以最大限度地提高所有分支的质量，并使重构扩展到重构后要分支的所有分支。这也是将您的团队聚集在一起进行所有合并的好方法。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-27T06:25:00.417

我看到两种不同的方法来解决这个问题：

1.

不应在主干中对主干进行重大更改（如重大重构）。它们应该在一个分支中完成，并在它们足够稳定时合并回主干。

定期对主干的更改应与其他维护分支合并。仅在主干稳定时才将重构合并到主干的原因是因为这些将被合并到维护分支中。但是，如果没有机会使这些更改稳定，那么选项 2 会更好。

在对维护分支进行更改后，可以将它们合并回主干。

2.

创建维护分支的一个分支（每个分支一个）。这将用于将主干与每个维护分支合并。（请注意，为了限制维护分支的数量，应使用 SVN 外部或等效项）。

在主干中进行所有重构并将其合并到维护分支的分支中。当您发布或认为主干稳定时，将维护版本的这些分支合并回各自的分支。然后这些可以依次合并回主干。

实际上，每个维护分支都变成了“子干线”。

请注意，此方案突出了未来维护和前期维护之间的权衡。代码中的分支和差异越多，需要的前期维护就越多。好的部分是增量维护要容易得多。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-21T13:11:29.473

我只能回应其他人所说的话，同时强调补丁队列可能成为的真正痛苦。

如果你有一个预定义的（和铁定的）合并窗口，你应该只有两个星期的地狱来处理。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-27T12:45:15.930

你必须**有**这么多的分支正在工作吗？

主干上的工作是不是因为项目计划说当前版本已经准备好发货而才开始，所以它已经发货了？

您是否有很多维护分支，因为客户出于某种原因拒绝升级到最新版本？如果是，请说明原因。

你有太多的旧版本是因为下一个主要版本之前的差距太大了吗？

您是否会向不会升级的客户收取更多的维护费用，因为它会花费您更多？

**回复评论：**

> 微软仍然支持 Windows XP，即使 Vista 已经出局

确实如此，但是即使 XP SP3 已经出局，Microsoft 仍然不支持 Window XP SP1。

这不是非黑即白，即使你不能停止支持旧版本，你也可以减少你支持的旧版本的数量。问题是销售/支持喜欢说“是”，但开发会很痛苦，所以你需要让你的销售/支持人员站在一边。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-27T14:38:23.007

我认为您最好的选择是进行**迭代**重构。与其在私有分支上一次性完成所有重构，不如一次一个阶段进行。在分支上进行几组更改，然后当您知道它们稳定时，将它们合并到主干。在其他分支上工作的开发人员将负责不断使他们的分支与主干保持同步。

与合并差异很大的大型分支相比，经常合并一小部分更改要少得多。合并的次数越多，最终要做的工作就越少。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-27T16:24:21.990

在我们的项目中，我们主要不修复版本维护分支中的更改。如果有错误并且

1.  它发生在主干和主分支中，我们在主干中修复它，然后将更改合并到维护分支（这可以干净地发生，或者需要更多工作，在这种情况下，我们决定是否不是更好仅在较新版本中修复了该错误）。
2.  它只是在维护分支中，后备箱中可能有一些修复之王，我们去第一场景。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-27T22:17:07.653

正如[格雷格指出](https://stackoverflow.com/questions/244439/refactoring-and-concurrent-development-branches/572929#572929)的那样，有几种可能的情况。

我会添加一个需要手动合并的案例（2.5），但是由于您已将方法从其原始位置移开然后应用了一些更改，因此很难合并，特别是如果“基础”代码也被修改了在“维护”分支中。这并不像听起来那么罕见，实际上将方法移动到不同的位置并应用小修复是很常见的。

我们开发了一个名为 Xmerge（交叉合并）的工具，这是迈向重构感知合并的第一步。它还不是自动的，但它有助于处理涉及移动代码的艰难合并。[它在此处进行了描述，](http://codicesoftware.blogspot.com/2008/08/xmerge-tool-to-handle-refactors.html)并且已经集成在 Plastic SCM 2.7 中。

我们正在努力：自动移动检测，还能够“交叉合并”到多个目标文件（您将代码移动到另一个文件，这也很常见）。

# refactoring - 可怕的 While (True) 循环的最佳重构

> ID：244445
> 
> 赞同：13
> 
> 时间：2008-10-28T19:08:57.557
> 
> 标签：refactoring, loops, while-loop

如果像我一样，你在 While (True) 循环的位置发抖，那么你也一定已经思考了很长时间并努力考虑重构它的最佳方法。我见过几种不同的实现，没有一个比其他的更好，例如计时器和委托组合。

那么，您想出或看到重构可怕的 While (True) 循环的最佳方法是什么？

**编辑**：正如一些评论所述，我的意图是让这个问题成为“无限循环”重构，例如运行 Windows 风格的服务，其中唯一的停止条件是 OnStop 或致命异常。

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2008-10-28T20:02:23.643

我的偏好是

```
start:

   // code goes here

goto start; 
```

这最清楚地表达了意图。祝你好运，让它超过你的编码标准。（想知道这将花费我多少业力）。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-10-28T20:22:22.633

我们真的需要重构*while(true)*循环吗？有时它是一种编码标准，大多数开发人员已经习惯了这种结构。如果您必须认真考虑如何重构此代码，您确定重构它是一个好主意吗？

*Goto*曾经是编码标准中的害群之马。我遇到了*goto*使代码更具可读性和更短的算法。有时不值得重构（或者更好地使用*goto*）。

另一方面，您可以在大多数情况下避免使用*while(true)*。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-10-28T19:10:38.457

有什么好害怕的？尝试找到一个常见的中断条件并将其重构为循环的头部。如果那不可能——很好。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-10-28T19:18:47.350

当我遇到 while(true) 循环时，这告诉我要么

1.  在循环的顶部（或底部）不容易测试中断条件，
    *   有多个中断条件，
    *   或者之前的程序员懒得正确分解循环。

1 和 2 意味着你不妨坚持使用 while(true)。（我使用`for(;;)`，但在我看来这是一种风格。）我和另一张海报在一起，为什么害怕这个？我害怕扭曲的循环会跳过箍以使循环“正确”滚动。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-10-28T19:13:03.897

将 True 替换为您要用于跳出循环的条件。

在服务或后台线程的情况下，您可以使用：

```
volatile bool m_shutdown = false;
void Run()
{
    while (!m_shutdown)
    { ... }
} 
```

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2008-10-28T19:33:24.853

为什么要重构？这个结构有什么“可怕”的？它被广泛使用，并且很好理解。

如果它没有坏，就不要修理它。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-10-28T19:23:17.793

“永远运行”的情况有时是更大状态机的一部分。许多嵌入式设备（带有永远运行的循环）并没有真正**永远**运行。它们通常有几种操作模式，并且会在这些模式之间排序。

当我们构建热泵控制器时，有一个开机自检 (POST) 模式运行了一段时间。然后有一个初步的环境收集模式，一直运行到我们找出所有的区域和恒温器等等。

一些工程师声称接下来是“永远运行”循环。这并不是那么简单。实际上是几种操作模式在翻转和翻转。有加热、除霜、冷却、怠速和其他东西。

我的偏好是将“永远”循环视为实际上只是一种操作模式——未来某个时候可能会有其他模式。

```
someMode= True
while someMode:
    try:
        ... do stuff ...
    except SomeException, e:
        log.exception( e )
        # will keep running
    except OtherException, e:
        log.info( "stopping now" )
        someMode= False 
```

在某些情况下，到目前为止，我们所看到的任何内容都不会设置`someMode`为`False`. 但我喜欢假装在未来的某个版本中会有模式改变。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2008-10-28T19:51:38.657

```
#define ever 1
for (;ever;) 
```

?

嗯，就让它保持原样吧，而（真的）可能和你想得到的一样清晰......

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-10-28T19:14:58.310

errr，要进行重构.....

*   用无限递归替换无限循环:-)

好吧，如果你有一种支持 Tail 调用的语言......

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-10-28T19:22:02.053

如果您希望它无限期地继续直到程序流完全中止，我认为 while (true) 没有任何问题。我最近在一个 .NET 数据收集服务中遇到了它，该服务结合了 while (true) 和 thread.sleep 以每分钟唤醒一次并轮询第三方数据服务以获取新报告。我考虑用计时器和委托来重构它，但最终决定这是最简单和最容易阅读的方法。10 次中有 9 次是明显的代码气味，但是当没有退出条件时，为什么要让事情变得更加困难？

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-28T19:35:55.940

当无限循环包含在窗口中并随着窗口而死时，我不介意。

想想哈塞尔霍夫递归。

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2016-05-17T22:12:27.923

```
void whiletrue_sim(void)
  {
    //some code
    whiletrue_sim();
  } 
```

警告：您的堆栈可能会溢出。

# algorithm - 什么是找到重叠矩形区域的有效算法

> ID：244452
> 
> 赞同：51
> 
> 时间：2008-10-28T19:10:45.417
> 
> 标签：algorithm, optimization, geometry, performance

# 我的情况

*   输入：一组矩形
*   每个矩形由 4 个这样的双精度组成： (x0,y0,x1,y1)
*   它们不会以任何角度“旋转”，它们都是相对于屏幕“上/下”和“左/右”的“正常”矩形
*   它们是随机放置的——它们可能在边缘接触、重叠或没有任何接触
*   我将有数百个矩形
*   这是在 C# 中实现的

# 我需要找到

*   由它们重叠形成的区域 - 画布中多个矩形“覆盖”的所有区域（例如，两个矩形，它将是交叉点）
*   我不需要重叠的几何形状——只需要面积（例如：4 平方英寸）
*   重叠不应计算多次 - 例如，想象 3 个具有相同大小和位置的矩形 - 它们彼此重叠 - 该区域应计算一次（而不是三次）

# 例子

*   下图包含三个矩形：A、B、C
*   A 和 B 重叠（如虚线所示）
*   B 和 C 重叠（如虚线所示）
*   我正在寻找的是显示破折号的区域

-

```
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAA--------------BBB
AAAAAAAAAAAAAAAA--------------BBB
AAAAAAAAAAAAAAAA--------------BBB
AAAAAAAAAAAAAAAA--------------BBB
                BBBBBBBBBBBBBBBBB
                BBBBBBBBBBBBBBBBB
                BBBBBBBBBBBBBBBBB
                BBBBBB-----------CCCCCCCC
                BBBBBB-----------CCCCCCCC
                BBBBBB-----------CCCCCCCC
                      CCCCCCCCCCCCCCCCCCC
                      CCCCCCCCCCCCCCCCCCC
                      CCCCCCCCCCCCCCCCCCC
                      CCCCCCCCCCCCCCCCCCC 
```

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2008-10-28T23:20:01.027

计算该区域的一种有效方法是使用扫描算法。假设我们通过矩形 U 的并集扫过一条垂直线 L(x)：

*   首先，您需要构建一个事件队列 Q，在这种情况下，它是矩形的所有 x 坐标（左和右）的有序列表。
*   在扫描期间，您应该维护一个一维数据结构，它应该给您 L(x) 和 U 的交集的总长度。重要的是这个长度在 Q 的两个连续事件 q 和 q' 之间是恒定的。所以, 如果 l(q) 表示 L(q+) 的总长度（即 L 恰好在 q 的右侧）与 U 相交，则 L 在事件 q 和 q' 之间扫过的区域正好是 l(q)*(q' -q)。
*   您只需将所有这些扫过的区域加起来即可得到总和。

我们仍然需要解决一维问题。您需要一个 1D 结构，它动态计算（垂直）段的联合。动态地，我的意思是您有时会添加一个新段，有时会删除一个。

我已经在我对这个[折叠范围问题](https://stackoverflow.com/questions/149577/need-an-algorithm-for-collapsing-netblock-ranges-into-lists-of-superset-ranges)的回答中详细说明了如何以静态方式进行操作（实际上是一维扫描）。所以如果你想要一些简单的东西，你可以直接应用它（通过重新计算每个事件的联合）。如果你想要更高效的东西，你只需要稍微调整一下：

*   假设您知道线段 S [1] ...S [n]的并集由不相交的线段 D [1] ...D [k]组成。添加 S [n+1]非常简单，您只需在D [1] ...D [k的两端中找到 S] [n+1]的两端。
*   假设您知道段的并集 S [1] ...S [n]由不相交的段 D [1] ...D [k]组成，删除段 S [i]（假设 S [i]包含在 D [j]中）意味着重新计算 D 的段的并集[j]包括，除了 S [i]（使用静态算法）。

这是您的动态算法。假设您将使用带有对数时间位置查询的排序集来表示 D [1] ...D [k]，这可能是您可以获得的最有效的非专业方法。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-28T19:49:17.287

一种解决方法是将其绘制到画布上！使用半透明颜色绘制每个矩形。.NET 运行时将使用优化的本机代码进行绘图 - 甚至使用硬件加速器。

然后，您必须回读像素。每个像素是背景颜色、矩形颜色还是其他颜色？它可以是另一种颜色的唯一方法是两个或多个矩形重叠......

如果这太过分了，我会像另一个回答者那样推荐四叉树，或者[r-tree](http://en.wikipedia.org/wiki/R-tree "r-树")。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2014-08-18T01:44:07.153

# 最简单的解决方案

```
import numpy as np

A = np.zeros((100, 100))
B = np.zeros((100, 100))

A[rect1.top : rect1.bottom,  rect1.left : rect1.right] = 1
B[rect2.top : rect2.bottom,  rect2.left : rect2.right] = 1

area_of_union     = np.sum((A + B) > 0)
area_of_intersect = np.sum((A + B) > 1) 
```

在这个例子中，我们创建了两个零矩阵，它们是画布的大小。对于每个矩形，用矩形占用空间的矩阵填充其中一个矩阵。然后对矩阵求和。现在`sum(A+B > 0)`是联合`sum(A+B > 1)`的区域，是重叠的区域。这个例子可以很容易地推广到多个矩形。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-10-28T20:14:48.920

这是我在 TopCoder SRM 160 Div 2 中使用的一些快速而肮脏的代码。

t = 上
b = 下
l = 左
r = 右

```
public class Rect
{
    public int t, b, l, r;

    public Rect(int _l, int _b, int _r, int _t)
    {
        t = _t;
        b = _b;
        l = _l;
        r = _r;
    }   

    public bool Intersects(Rect R)
    {
        return !(l > R.r || R.l > r || R.b > t || b > R.t);
    }

    public Rect Intersection(Rect R)
    {
        if(!this.Intersects(R))
            return new Rect(0,0,0,0);
        int [] horiz = {l, r, R.l, R.r};
        Array.Sort(horiz);
        int [] vert = {b, t, R.b, R.t};
        Array.Sort(vert);

        return new Rect(horiz[1], vert[1], horiz[2], vert[2]);
    } 

    public int Area()
    {
        return (t - b)*(r-l);
    }

    public override string ToString()
    {
        return l + " " + b + " " + r + " " + t;
    }
} 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-28T22:14:59.990

这是我头顶上听起来可能有用的东西：

1.  创建一个带有双键的字典和一个矩形+布尔值列表，如下所示：

    Dictionary< Double, List< KeyValuePair< Rectangle, Boolean>>> 矩形；

2.  对于集合中的每个矩形，找到 x0 和 x1 值的对应列表，并将矩形添加到该列表中，布尔值 true 表示 x0，false 表示 x1。这样，您现在拥有每个矩形进入（真）或离开（假）x方向的所有x坐标的完整列表

3.  从该字典中获取所有键（所有不同的 x 坐标），对它们进行排序，并按顺序遍历它们，确保您可以同时获得当前 x 值和下一个 x 值（您都需要它们）。这为您提供了单独的矩形条

4.  维护一组您当前正在查看的矩形，这些矩形开始时是空的。对于您在第 3 点迭代的每个 x 值，如果矩形注册为真值，则将其添加到集合中，否则将其删除。
5.  对于条带，按 y 坐标对矩形进行排序
6.  遍历带中的矩形，计算重叠距离（我还不清楚如何有效地做到这一点）
7.  计算条带的宽度乘以重叠距离的高度以获得面积

示例，5 个矩形，从 a 到 e 相互重叠绘制：

```
aaaaaaaaaaaaaaaa          bbbbbbbbbbbbbbbbb
aaaaaaaaaaaaaaaa          bbbbbbbbbbbbbbbbb
aaaaaaaaaaaaaaaa          bbbbbbbbbbbbbbbbb
aaaaaaaaaaaaaaaa          bbbbbbbbbbbbbbbbb
aaaaaaaadddddddddddddddddddddddddddddbbbbbb
aaaaaaaadddddddddddddddddddddddddddddbbbbbb
        ddddddddddddddddddddddddddddd
        ddddddddddddddddddddddddddddd
        ddddddddddddddeeeeeeeeeeeeeeeeee
        ddddddddddddddeeeeeeeeeeeeeeeeee
        ddddddddddddddeeeeeeeeeeeeeeeeee
ccccccccddddddddddddddeeeeeeeeeeeeeeeeee
ccccccccddddddddddddddeeeeeeeeeeeeeeeeee
cccccccccccc          eeeeeeeeeeeeeeeeee
cccccccccccc          eeeeeeeeeeeeeeeeee
cccccccccccc
cccccccccccc 
```

这是 x 坐标的列表：

```
v       v  v   v      v   v         v  v  v   
|aaaaaaa|aa|aaaa      |   bbbbbbbbbb|bb|bbb
|aaaaaaa|aa|aaaa      |   bbbbbbbbbb|bb|bbb
|aaaaaaa|aa|aaaa      |   bbbbbbbbbb|bb|bbb
|aaaaaaa|aa|aaaa      |   bbbbbbbbbb|bb|bbb
|aaaaaaaddd|dddddddddd|ddddddddddddddbb|bbb
|aaaaaaaddd|dddddddddd|ddddddddddddddbb|bbb
|       ddd|dddddddddd|dddddddddddddd  |
|       ddd|dddddddddd|dddddddddddddd  |
|       ddd|ddddddddddeeeeeeeeeeeeeeeeee
|       ddd|ddddddddddeeeeeeeeeeeeeeeeee
|       ddd|ddddddddddeeeeeeeeeeeeeeeeee
ccccccccddd|ddddddddddeeeeeeeeeeeeeeeeee
ccccccccddd|ddddddddddeeeeeeeeeeeeeeeeee
cccccccccccc          eeeeeeeeeeeeeeeeee
cccccccccccc          eeeeeeeeeeeeeeeeee
cccccccccccc
cccccccccccc 
```

该列表将是（其中每个 v 都被简单地赋予一个从 0 开始并向上的坐标）：

```
0: +a, +c
1: +d
2: -c
3: -a
4: +e
5: +b
6: -d
7: -e
8: -b 
```

因此，每个条带将是（从上到下排序的矩形）：

```
0-1: a, c
1-2: a, d, c
2-3: a, d
3-4: d
4-5: d, e
5-6: b, d, e
6-7: b, e
7-8: b 
```

对于每个条带，重叠将是：

```
0-1: none
1-2: a/d, d/c
2-3: a/d
3-4: none
4-5: d/e
5-6: b/d, d/e
6-7: none
7-8: none 
```

我想对于上下检查的排序+进入/离开算法的变体也是可行的：

1.  对我们当前在条带中分析的矩形进行排序，从上到下，对于具有相同上坐标的矩形，也按下坐标排序
2.  遍历y坐标，当你输入一个矩形时，将它添加到集合中，当你离开一个矩形时，将它从集合中移除
3.  每当集合有多个矩形时，您就有重叠（并且如果您确保添加/删除所有具有相同顶部/底部坐标的矩形，您当前正在查看，多个重叠矩形将不是问题

对于上面的 1-2 条，您将像这样迭代：

```
0\. empty set, zero sum
1\. enter a, add a to set (1 rectangle in set)
2\. enter d, add d to set (>1 rectangles in set = overlap, store this y-coordinate)
3\. leave a, remove a from set (now back from >1 rectangles in set, add to sum: y - stored_y
4\. enter c, add c to set (>1 rectangles in set = overlap, store this y-coordinate)
5\. leave d, remove d from set (now back from >1 rectangles in set, add to sum: y - stored_y)
6\. multiply sum with width of strip to get overlapping areas 
```

您实际上也不必在这里维护一个实际的集合，只需计算您所在的矩形的数量，每当它从 1 变为 2 时，存储 y，每当它从 2 变为 1 时，计算当前 y -存储 y，并将这个差值相加。

希望这是可以理解的，正如我所说，这不是我的想法，没有经过任何测试。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-18T09:41:51.817

使用示例：

```
   1 2 3 4 5 6

1 +---+---+
   | |   
2 + A +---+---+
   | | 乙|
3 + + +---+---+
   | | | | |
4 +---+---+---+---+ +
               | |
5 + C +
               | |
6 +---+---+

```

1）将所有x坐标（左右）收集到一个列表中，然后对其进行排序并删除重复项

```
1 3 4 5 6
```

2）将所有y坐标（顶部和底部）收集到一个列表中，然后对其进行排序并删除重复项

```
1 2 3 4 6
```

3) 通过唯一 x 坐标之间的间隙数 * 唯一 y 坐标之间的间隙数创建一个 2D 数组。

```
4 * 4
```

4）将所有矩形绘制到这个网格中，增加它出现的每个单元格的计数：

```
   1 3 4 5 6

1 +---+
   | 1 | 0 0 0
2 +---+---+---+
   | 1 | 1 | 1 | 0
3 +---+---+---+---+
   | 1 | 1 | 2 | 1 |
4 +---+---+---+---+
     0 0 | 1 | 1 |
6 +---+---+

```

5) 网格中计数大于 1 的单元格的总面积为重叠面积。为了在稀疏用例中提高效率，您实际上可以在绘制矩形时保持该区域的总和，每次将单元格从 1 移动到 2 时。

* * *

在问题中，矩形被描述为四个双打。双精度数通常包含舍入误差，并且误差可能会蔓延到您计算的重叠区域。如果合法坐标位于有限点，请考虑使用整数表示。

* * *

如果分辨率可以接受，PS 在我的其他答案中使用硬件加速器并不是一个破旧的想法。它也很容易用比我上面概述的方法少得多的代码来实现。课程用马。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-04-13T04:44:52.520

这是我为区域扫描算法编写的代码：

```
#include <iostream>
#include <vector>

using namespace std;

class Rectangle {
public:
    int x[2], y[2];

    Rectangle(int x1, int y1, int x2, int y2) {
        x[0] = x1;
        y[0] = y1;
        x[1] = x2;
        y[1] = y2; 
    };
    void print(void) {
        cout << "Rect: " << x[0] << " " << y[0] << " " << x[1] << " " << y[1] << " " <<endl;
    };
};

// return the iterator of rec in list
vector<Rectangle *>::iterator bin_search(vector<Rectangle *> &list, int begin, int end, Rectangle *rec) {
    cout << begin << " " <<end <<endl;
    int mid = (begin+end)/2;
    if (list[mid]->y[0] == rec->y[0]) {
        if (list[mid]->y[1] == rec->y[1])
            return list.begin() + mid;
        else if (list[mid]->y[1] < rec->y[1]) {
            if (mid == end)
                return list.begin() + mid+1;
            return bin_search(list,mid+1,mid,rec);
        }
        else {
            if (mid == begin)
                return list.begin()+mid;
            return bin_search(list,begin,mid-1,rec);
        }
    }
    else if (list[mid]->y[0] < rec->y[0]) {
        if (mid == end) {
            return list.begin() + mid+1;
        }
        return bin_search(list, mid+1, end, rec);
    }
    else {
        if (mid == begin) {
            return list.begin() + mid;
        }
        return bin_search(list, begin, mid-1, rec);
    }
}

// add rect to rects
void add_rec(Rectangle *rect, vector<Rectangle *> &rects) {
    if (rects.size() == 0) {
        rects.push_back(rect);
    }
    else {
        vector<Rectangle *>::iterator it = bin_search(rects, 0, rects.size()-1, rect);
        rects.insert(it, rect);
    }
}

// remove rec from rets
void remove_rec(Rectangle *rect, vector<Rectangle *> &rects) {
    vector<Rectangle *>::iterator it = bin_search(rects, 0, rects.size()-1, rect);
    rects.erase(it);
}

// calculate the total vertical length covered by rectangles in the active set
int vert_dist(vector<Rectangle *> as) {
    int n = as.size();

    int totallength = 0;
    int start, end;

    int i = 0;
    while (i < n) {
        start = as[i]->y[0];
        end = as[i]->y[1];
        while (i < n && as[i]->y[0] <= end) {
            if (as[i]->y[1] > end) {
                end = as[i]->y[1];
            }
            i++;
        }
        totallength += end-start;
    }
    return totallength;
}

bool mycomp1(Rectangle* a, Rectangle* b) {
    return (a->x[0] < b->x[0]);
}

bool mycomp2(Rectangle* a, Rectangle* b) {
    return (a->x[1] < b->x[1]);
}

int findarea(vector<Rectangle *> rects) {
    vector<Rectangle *> start = rects;
    vector<Rectangle *> end = rects;
    sort(start.begin(), start.end(), mycomp1);
    sort(end.begin(), end.end(), mycomp2);

    // active set
    vector<Rectangle *> as;

    int n = rects.size();

    int totalarea = 0;
    int current = start[0]->x[0];
    int next;
    int i = 0, j = 0;
    // big loop
    while (j < n) {
        cout << "loop---------------"<<endl;
        // add all recs that start at current
        while (i < n && start[i]->x[0] == current) {
            cout << "add" <<endl;
            // add start[i] to AS
            add_rec(start[i], as);
            cout << "after" <<endl;
            i++;
        }
        // remove all recs that end at current
        while (j < n && end[j]->x[1] == current) {
            cout << "remove" <<endl;
            // remove end[j] from AS
            remove_rec(end[j], as);
            cout << "after" <<endl;
            j++;
        }

        // find next event x
        if (i < n && j < n) {
            if (start[i]->x[0] <= end[j]->x[1]) {
                next = start[i]->x[0];
            }
            else {
                next = end[j]->x[1];
            }
        }
        else if (j < n) {
            next = end[j]->x[1];
        }

        // distance to next event
        int horiz = next - current;
        cout << "horiz: " << horiz <<endl;

        // figure out vertical dist
        int vert = vert_dist(as);
        cout << "vert: " << vert <<endl;

        totalarea += vert * horiz;

        current = next;
    }
    return totalarea;
}

int main() {
    vector<Rectangle *> rects;
    rects.push_back(new Rectangle(0,0,1,1));

    rects.push_back(new Rectangle(1,0,2,3));

    rects.push_back(new Rectangle(0,0,3,3));

    rects.push_back(new Rectangle(1,0,5,1));

    cout << findarea(rects) <<endl;
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-28T22:15:33.920

如果将每个矩形拆分为较小的矩形，则可以大大简化此问题。收集所有矩形的所有 X 和 Y 坐标，这些将成为您的分割点 - 如果一个矩形穿过线，则将其一分为二。完成后，您有一个重叠 0% 或 100% 的矩形列表，如果您对它们进行排序，应该很容易找到相同的矩形。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-01-06T01:55:50.677

[链接http://codercareer.blogspot.com/2011/12/no-27-area-of-rectangles.html](http://codercareer.blogspot.com/2011/12/no-27-area-of-rectangles.html)中列出了一个解决方案，用于查找多个矩形的总面积，这样重叠区域只计算一次.

上述解决方案可以扩展为仅计算重叠区域（即使重叠区域被多个矩形覆盖，也仅计算一次），每对连续垂直扫描线具有水平扫描线。

如果目标只是找出所有矩形覆盖的总面积，则不需要水平扫描线，只需将两条垂直扫描线之间的所有矩形合并即可给出该区域。

另一方面，如果您只想计算重叠区域，则需要水平扫描线来找出垂直（y1，y2）扫描线之间重叠的矩形数量。

这是我用 Java 实现的解决方案的工作代码。

```
import java.io.*;
import java.util.*;

class Solution {

static class Rectangle{
         int x;
         int y;
         int dx;
         int dy;

         Rectangle(int x, int y, int dx, int dy){
           this.x = x;
           this.y = y;
           this.dx = dx;
           this.dy = dy;
         }

         Range getBottomLeft(){
            return new Range(x, y);
         }

         Range getTopRight(){
            return new Range(x + dx, y + dy);
         }

         @Override
         public int hashCode(){
            return (x+y+dx+dy)/4;
         }

         @Override
         public boolean equals(Object other){
            Rectangle o = (Rectangle) other;
            return o.x == this.x && o.y == this.y && o.dx == this.dx && o.dy == this.dy;
         }

        @Override
        public String toString(){
            return String.format("X = %d, Y = %d, dx : %d, dy : %d", x, y, dx, dy);
        }
     }     

     static class RW{
         Rectangle r;
         boolean start;

         RW (Rectangle r, boolean start){
           this.r = r;
           this.start = start;
         }

         @Override
         public int hashCode(){
             return r.hashCode() + (start ? 1 : 0);
         }

         @Override
         public boolean equals(Object other){
              RW o = (RW)other;
             return o.start == this.start && o.r.equals(this.r);
         }

        @Override
        public String toString(){
            return "Rectangle : " + r.toString() + ", start = " + this.start;
        }
     }

     static class Range{
         int l;
         int u;   

       public Range(int l, int u){
         this.l = l;
         this.u = u;
       }

         @Override
         public int hashCode(){
            return (l+u)/2;
         }

         @Override
         public boolean equals(Object other){
            Range o = (Range) other;
            return o.l == this.l && o.u == this.u;
         }

        @Override
        public String toString(){
            return String.format("L = %d, U = %d", l, u);
        }
     }

     static class XComp implements Comparator<RW>{
             @Override
             public int compare(RW rw1, RW rw2){
                 //TODO : revisit these values.
                 Integer x1 = -1;
                 Integer x2 = -1;

                 if(rw1.start){
                     x1 = rw1.r.x;
                 }else{
                     x1 = rw1.r.x + rw1.r.dx;
                 }   

                 if(rw2.start){
                     x2 = rw2.r.x;
                 }else{
                     x2 = rw2.r.x + rw2.r.dx;
                 }

                 return x1.compareTo(x2);
             }
     }

     static class YComp implements Comparator<RW>{
             @Override
             public int compare(RW rw1, RW rw2){
                 //TODO : revisit these values.
                 Integer y1 = -1;
                 Integer y2 = -1;

                 if(rw1.start){
                     y1 = rw1.r.y;
                 }else{
                     y1 = rw1.r.y + rw1.r.dy;
                 }   

                 if(rw2.start){
                     y2 = rw2.r.y;
                 }else{
                     y2 = rw2.r.y + rw2.r.dy;
                 }

                 return y1.compareTo(y2);
             }
     }

     public static void main(String []args){
         Rectangle [] rects = new Rectangle[4];

         rects[0] = new Rectangle(10, 10, 10, 10);
         rects[1] = new Rectangle(15, 10, 10, 10);
         rects[2] = new Rectangle(20, 10, 10, 10);
         rects[3] = new Rectangle(25, 10, 10, 10);

         int totalArea = getArea(rects, false);
         System.out.println("Total Area : " + totalArea);

         int overlapArea = getArea(rects, true);              
         System.out.println("Overlap Area : " + overlapArea);
     }

     static int getArea(Rectangle []rects, boolean overlapOrTotal){
         printArr(rects);

         // step 1: create two wrappers for every rectangle
         RW []rws = getWrappers(rects);       

         printArr(rws);        

         // steps 2 : sort rectangles by their x-coordinates
         Arrays.sort(rws, new XComp());   

         printArr(rws);        

         // step 3 : group the rectangles in every range.
         Map<Range, List<Rectangle>> rangeGroups = groupRects(rws, true);

         for(Range xrange : rangeGroups.keySet()){
             List<Rectangle> xRangeRects = rangeGroups.get(xrange);
             System.out.println("Range : " + xrange);
             System.out.println("Rectangles : ");
             for(Rectangle rectx : xRangeRects){
                System.out.println("\t" + rectx);               
             }
         }   

         // step 4 : iterate through each of the pairs and their rectangles

         int sum = 0;
         for(Range range : rangeGroups.keySet()){
             List<Rectangle> rangeRects = rangeGroups.get(range);
             sum += getOverlapOrTotalArea(rangeRects, range, overlapOrTotal);
         }
         return sum;         
     }    

     static Map<Range, List<Rectangle>> groupRects(RW []rws, boolean isX){
         //group the rws with either x or y coordinates.

         Map<Range, List<Rectangle>> rangeGroups = new HashMap<Range, List<Rectangle>>();

         List<Rectangle> rangeRects = new ArrayList<Rectangle>();            

         int i=0;
         int prev = Integer.MAX_VALUE;

         while(i < rws.length){
             int curr = isX ? (rws[i].start ? rws[i].r.x : rws[i].r.x + rws[i].r.dx): (rws[i].start ? rws[i].r.y : rws[i].r.y + rws[i].r.dy);

             if(prev < curr){
                Range nRange = new Range(prev, curr);
                rangeGroups.put(nRange, rangeRects);
                rangeRects = new ArrayList<Rectangle>(rangeRects);
             }
             prev = curr;

             if(rws[i].start){
               rangeRects.add(rws[i].r);
             }else{
               rangeRects.remove(rws[i].r);
             }

           i++;
         }
       return rangeGroups;
     }

     static int getOverlapOrTotalArea(List<Rectangle> rangeRects, Range range, boolean isOverlap){
         //create horizontal sweep lines similar to vertical ones created above

         // Step 1 : create wrappers again
         RW []rws = getWrappers(rangeRects);

         // steps 2 : sort rectangles by their y-coordinates
         Arrays.sort(rws, new YComp());

         // step 3 : group the rectangles in every range.
         Map<Range, List<Rectangle>> yRangeGroups = groupRects(rws, false);

         //step 4 : for every range if there are more than one rectangles then computer their area only once.

         int sum = 0;
         for(Range yRange : yRangeGroups.keySet()){
             List<Rectangle> yRangeRects = yRangeGroups.get(yRange);

             if(isOverlap){
                 if(yRangeRects.size() > 1){
                     sum += getArea(range, yRange);
                 }
             }else{
                 if(yRangeRects.size() > 0){
                     sum += getArea(range, yRange);
                 }
             }
         }         
         return sum;
     } 

    static int getArea(Range r1, Range r2){
      return (r2.u-r2.l)*(r1.u-r1.l);      
    }

    static RW[] getWrappers(Rectangle []rects){
         RW[] wrappers = new RW[rects.length * 2];

         for(int i=0,j=0;i<rects.length;i++, j+=2){
             wrappers[j] = new RW(rects[i], true); 
             wrappers[j+1] = new RW(rects[i], false); 
         }
         return wrappers;
     }

    static RW[] getWrappers(List<Rectangle> rects){
         RW[] wrappers = new RW[rects.size() * 2];

         for(int i=0,j=0;i<rects.size();i++, j+=2){
             wrappers[j] = new RW(rects.get(i), true); 
             wrappers[j+1] = new RW(rects.get(i), false); 
         }
         return wrappers;
     }

  static void printArr(Object []a){
    for(int i=0; i < a.length;i++){
      System.out.println(a[i]);
    }
    System.out.println();
  } 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-10-16T14:06:07.193

以下答案应该只给出一次总面积。它来自以前的答案，但现在在 C# 中实现。它也适用于浮点数（或双精度，如果你需要[它不会遍历值）。

学分： [http ://codercareer.blogspot.co.il/2011/12/no-27-area-of-rectangles.html](http://codercareer.blogspot.co.il/2011/12/no-27-area-of-rectangles.html)

编辑： OP 要求重叠区域 - 这显然非常简单：

```
var totArea = rects.Sum(x => x.Width * x.Height); 
```

然后答案是：

```
var overlappingArea =totArea-GetArea(rects) 
```

这是代码：

```
 #region rectangle overlapping
        /// <summary>
        /// see algorithm for detecting overlapping areas here: https://stackoverflow.com/a/245245/3225391
        /// or easier here:
        /// http://codercareer.blogspot.co.il/2011/12/no-27-area-of-rectangles.html
        /// </summary>
        /// <param name="dim"></param>
        /// <returns></returns>
        public static float GetArea(RectangleF[] rects)
        {
            List<float> xs = new List<float>();
            foreach (var item in rects)
            {
                xs.Add(item.X);
                xs.Add(item.Right);
            }
            xs = xs.OrderBy(x => x).Cast<float>().ToList();
            rects = rects.OrderBy(rec => rec.X).Cast<RectangleF>().ToArray();
            float area = 0f;
            for (int i = 0; i < xs.Count - 1; i++)
            {
                if (xs[i] == xs[i + 1])//not duplicate
                    continue;
                int j = 0;
                while (rects[j].Right < xs[i])
                    j++;
                List<Range> rangesOfY = new List<Range>();
                var rangeX = new Range(xs[i], xs[i + 1]);
                GetRangesOfY(rects, j, rangeX, out rangesOfY);
                area += GetRectArea(rangeX, rangesOfY);
            }
            return area;
        }

        private static void GetRangesOfY(RectangleF[] rects, int rectIdx, Range rangeX, out List<Range> rangesOfY)
        {
            rangesOfY = new List<Range>();
            for (int j = rectIdx; j < rects.Length; j++)
            {
                if (rangeX.less < rects[j].Right && rangeX.greater > rects[j].Left)
                {
                    rangesOfY = Range.AddRange(rangesOfY, new Range(rects[j].Top, rects[j].Bottom));
#if DEBUG
                    Range rectXRange = new Range(rects[j].Left, rects[j].Right);
#endif
                }
            }
        }

        static float GetRectArea(Range rangeX, List<Range> rangesOfY)
        {
            float width = rangeX.greater - rangeX.less,
                area = 0;

            foreach (var item in rangesOfY)
            {
                float height = item.greater - item.less;
                area += width * height;
            }
            return area;
        }

        internal class Range
        {
            internal static List<Range> AddRange(List<Range> lst, Range rng2add)
            {
                if (lst.isNullOrEmpty())
                {
                    return new List<Range>() { rng2add };
                }

                for (int i = lst.Count - 1; i >= 0; i--)
                {
                    var item = lst[i];
                    if (item.IsOverlapping(rng2add))
                    {
                        rng2add.Merge(item);
                        lst.Remove(item);
                    }
                }
                lst.Add(rng2add);
                return lst;
            }
            internal float greater, less;
            public override string ToString()
            {
                return $"ln{less} gtn{greater}";
            }

            internal Range(float less, float greater)
            {
                this.less = less;
                this.greater = greater;
            }

            private void Merge(Range rng2add)
            {
                this.less = Math.Min(rng2add.less, this.less);
                this.greater = Math.Max(rng2add.greater, this.greater);
            }
            private bool IsOverlapping(Range rng2add)
            {
                return !(less > rng2add.greater || rng2add.less > greater);
                //return
                //    this.greater < rng2add.greater && this.greater > rng2add.less
                //    || this.less > rng2add.less && this.less < rng2add.greater

                //    || rng2add.greater < this.greater && rng2add.greater > this.less
                //    || rng2add.less > this.less && rng2add.less < this.greater;
            }
        }
        #endregion rectangle overlapping 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-28T19:12:41.620

您可以找到 x 轴和 y 轴上的重叠并将它们相乘。

```
int LineOverlap(int line1a, line1b, line2a, line2b) 
{
  // assume line1a <= line1b and line2a <= line2b
  if (line1a < line2a) 
  {
    if (line1b > line2b)
      return line2b-line2a;
    else if (line1b > line2a)
      return line1b-line2a;
    else 
      return 0;
  }
  else if (line2a < line1b)
    return line2b-line1a;
  else 
    return 0;
}

int RectangleOverlap(Rect rectA, rectB) 
{
  return LineOverlap(rectA.x1, rectA.x2, rectB.x1, rectB.x2) *
    LineOverlap(rectA.y1, rectA.y2, rectB.y1, rectB.y2);
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-28T21:49:44.097

如果您的矩形将是稀疏的（大部分不相交），那么可能值得一看递归维度聚类。否则，四叉树似乎是要走的路（正如其他海报所提到的那样。

这是计算机游戏中碰撞检测中的常见问题，因此不乏建议解决方法的资源。

[这](http://lab.polygonal.de/articles/recursive-dimensional-clustering/)是一篇总结 RCD 的不错的博客文章。

[这](http://www.ddj.com/184409694?pgno=3)是一篇 Dr.Dobbs 文章，总结了各种适合的碰撞检测算法。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-28T22:09:39.313

[这种类型的碰撞检测通常称为 AABB（Axis Aligned Bounding Boxes），这是google 搜索](http://www.google.se/search?q=AABB+collision+detection)的一个很好的起点。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-12-27T12:37:42.077

我找到了与扫描算法不同的解决方案。

由于您的矩形都是矩形放置的，因此矩形的水平和垂直线将形成一个矩形不规则网格。您可以在此网格上“绘制”矩形；这意味着，您可以确定将填写网格的哪些字段。由于网格线是由给定矩形的边界形成的，因此该网格中的字段将始终完全为空或由矩形完全填充。

我必须用 Java 解决这个问题，所以这是我的解决方案：http: [//pastebin.com/03mss8yf](http://pastebin.com/03mss8yf)

该函数计算矩形占据的完整面积。如果您只对“重叠”部分感兴趣，则必须在第 70 行和第 72 行之间扩展代码块。也许您可以使用第二组来存储多次使用的网格字段。第 70 行和第 72 行之间的代码应替换为如下块：

```
GridLocation gl = new GridLocation(curX, curY);
if(usedLocations.contains(gl) && usedLocations2.add(gl)) {
  ret += width*height;
} else {
  usedLocations.add(gl);
} 
```

这里的变量usedLocations2 与usedLocations 的类型相同；它将在同一点建造。

我不太熟悉复杂度计算；所以我不知道这两种解决方案（扫描或我的网格解决方案）中的哪一种会更好地执行/扩展。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-10-03T06:52:42.320

考虑到我们有两个矩形（A 和 B），我们有它们的左下角 (x1,y1) 和右上角 (x2,y2) 坐标。使用以下代码可以计算 C++ 中的重叠区域。

```
 #include <iostream>
using namespace std;

int rectoverlap (int ax1, int ay1, int ax2, int ay2, int bx1, int by1, int bx2, int by2)
{
    int width, heigh, area;

    if (ax2<bx1 || ay2<by1 || ax1>bx2 || ay1>by2) {
        cout << "Rectangles are not overlapped" << endl;
        return 0;
    }
    if (ax2>=bx2 && bx1>=ax1){
        width=bx2-bx1;
        heigh=by2-by1;
    } else if (bx2>=ax2 && ax1>=bx1) {
        width=ax2-ax1;
        heigh=ay2-ay1;
    } else {
        if (ax2>bx2){
            width=bx2-ax1;
        } else {
            width=ax2-bx1;
        }
        if (ay2>by2){
            heigh=by2-ay1;
        } else {
            heigh=ay2-by1;
        }
    }
    area= heigh*width;
    return (area);
}

int main()
{
    int ax1,ay1,ax2,ay2,bx1,by1,bx2,by2;
    cout << "Inter the x value for bottom left for rectangle A" << endl;
    cin >> ax1;
    cout << "Inter the y value for bottom left for rectangle A" << endl;
    cin >> ay1;
    cout << "Inter the x value for top right for rectangle A" << endl;
    cin >> ax2;
    cout << "Inter the y value for top right for rectangle A" << endl;
    cin >> ay2;
    cout << "Inter the x value for bottom left for rectangle B" << endl;
    cin >> bx1;
    cout << "Inter the y value for bottom left for rectangle B" << endl;
    cin >> by1;
    cout << "Inter the x value for top right for rectangle B" << endl;
    cin >> bx2;
    cout << "Inter the y value for top right for rectangle B" << endl;
    cin >> by2;
    cout << "The overlapped area is " <<  rectoverlap (ax1, ay1, ax2, ay2, bx1, by1, bx2, by2) << endl;
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2020-07-21T16:55:52.033

[user3048546](https://stackoverflow.com/a/39825950/2048503)的帖子在第 12-17 行的逻辑中包含错误。这是一个有效的实现：

```
int rectoverlap (int ax1, int ay1, int ax2, int ay2, int bx1, int by1, int bx2, int by2)
{
    int width, height, area;

    if (ax2<bx1 || ay2<by1 || ax1>bx2 || ay1>by2) {
        cout << "Rectangles are not overlapped" << endl;
        return 0;
    }

    if (ax2>=bx2 && bx1>=ax1){
        width=bx2-bx1;
    } else if (bx2>=ax2 && ax1>=bx1) {
        width=ax2-ax1;
    } else if (ax2>bx2) {
        width=bx2-ax1;
    } else {
        width=ax2-bx1;
    }

    if (ay2>=by2 && by1>=ay1){
        height=by2-by1;
    } else if (by2>=ay2 && ay1>=by1) {
        height=ay2-ay1;
    } else if (ay2>by2) {
        height=by2-ay1;
    } else {
        height=ay2-by1;
    }

    area = heigh*width;
    return (area);
} 
```

# c++ - Boost:asio 的最佳文档？

> ID：244453
> 
> 赞同：146
> 
> 时间：2008-10-28T19:11:03.900
> 
> 标签：c++, boost, boost-asio

[boost 网站](http://www.boost.org/doc/libs/1_36_0/doc/html/boost_asio.html)上提供的文档是……有限的。

从我所阅读的内容来看，普遍的共识是很难在 boost::asio 库上找到好的文档。

真的是这样吗？如果是这样，为什么？

笔记：

*   我已经找到了（非 boost）[Asio 网站](http://tenermerx.com/Asio/WebHome)- 文档看起来与 boost 网站上的相同。
*   我知道 Boost::asio 是新的！我正在寻找解决方案而不是借口。

编辑：

*   Boost:asio (Christopher Kohlhoff) 的作者[提出了将网络库添加到 TR2 标准库](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2006/n2054.pdf)的建议。虽然它不是 boost:asio 的文档，但它确实将其用作 TR2 提案的基础。由于作者在此文档中投入了更多精力，因此我发现它有些帮助，如果不是作为参考，那么至少可以作为概述。

* * *

## 回答 #1

> 赞同：67
> 
> 时间：2010-07-12T09:57:44.750

可以在[http://en.highscore.de/cpp/boost/index.html](http://en.highscore.de/cpp/boost/index.html)上的（免费）boost book 中找到一些关于 boost 的不错的文档，包括关于 asio 的一章。关于 asio 的章节提供了一个总体概述，然后就如何开发您自己的自定义 asio 扩展进行了深入探讨。Boris Schäling 的努力真的很棒！

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2008-10-28T19:45:07.263

首先，我使用 Boost.Asio 已经有一段时间了——我和你一样担心。要解决您的问题：

*   除了介绍和教程之外，关于 Boost.Asio 的文档确实非常稀缺。我不是作者，但这主要是因为对于像异步 IO 库这样低级的东西，要记录的东西太多了。
*   这些示例比教程提供的更多。如果您不介意花一点时间查看不同的示例，我认为它们应该足以让您入门。如果您想逃避它，那么参考文档应该对您有很大帮助。
*   在 Boost 用户和 Boost 开发人员邮件列表中询问您是否真的遇到困难或正在寻找具体的指导。我很确定很多人会愿意在邮件列表中解决您的问题。

有一些努力（不是 Boost.Asio 的一部分）来公开许多功能和可能的替代用例。这充其量是散布在网络上的博客和其他形式的非打包文档中。

一件尚不清楚并且真正需要与 Boost.Asio 库的作者和开发人员密切协调的事情是针对特定平台扩展和定制它或添加特定的新功能。虽然这应该得到改进，但好在看起来 Asio 将成为未来标准库技术报告（用于 STL 中的异步 IO 库）的参考实现。

* * *

## 回答 #3

> 赞同：42
> 
> 时间：2009-02-05T09:48:08.690

我写了两篇小文章，可以作为 boost.asio 的介绍。它们可从[我的网站获得](http://alexott.net/en/cpp/)

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2011-05-03T23:00:21.520

*注意：我已联系 gamedev.net 让他们知道格式问题。不幸的是，在撰写此评论时，此资源更难推荐，因为他们的网站进行了一些更改，这些更改隐藏/删除了#include 语句+缺少的 .zip 文件资源。*

可以在此处找到一个相对较新且非常好的 Boost.Asio 初学者教程（还介绍了如何有效地使用它与 bind、shared_ptr 和线程）：

[http://www.gamedev.net/blog/950/entry-2249317-a-guide-to-getting-started-with-boostasio?pg=1](http://www.gamedev.net/blog/950/entry-2249317-a-guide-to-getting-started-with-boostasio?pg=1)

注意：如果您使用 c++0x 功能，则可以将 bind 用于创建函子的许多简单用途替换为 lambda，并且 shared_ptr/bind 也可在最新版本的 Visual Studio（或还包括线程的 gcc .)

当我在搜索文档或教程时，这个问题不断出现在搜索结果的顶部，因此随着新教程的出现，保持更新很重要。

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2012-02-05T08:29:19.680

一旦您通过了官方的 boost asio 概述，我发现 3 个视频很有帮助：

*   [异步思考——用 asio 设计应用](http://www.youtube.com/watch?v=D-lTwGJRx0o)
*   [你准备好使用 ipv6](http://www.youtube.com/watch?v=bsoR5m-036U)
*   [为什么 c-0x 是最棒的网络编程语言](http://www.youtube.com/watch?v=U6HCL2bZHOA)

和

*   [异步思考幻灯片](https://raw.github.com/boostcon/2011_presentations/master/mon/thinking_asynchronously.pdf)
*   [你准备好使用 ipv6 幻灯片了吗](https://raw.github.com/boostcon/2011_presentations/master/wed/IPv6.pdf)
*   [为什么 c-0x 是最棒的网络编程语言](https://github.com/boostcon/2011_presentations/raw/master/thu/Awesomest.pdf)

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2014-11-05T09:16:18.327

asio 文档是 boost 中可用的文档，极简但非常精确，每个单词都很重要。也就是说，我主要从 SO 学习了 asio（并继续学习）。

在我看来，' *Confused when boost::asio::io_service run method blocks/unblocks '的*[答案](https://stackoverflow.com/a/15575732/888576)是第一步，再读一遍，直到你真正理解它，[第二个答案](https://stackoverflow.com/a/15568301/888576)也很有帮助。

 *然后我订阅了[最新的 SO boost-asio 标签问题](https://stackoverflow.com/questions/tagged/?tagnames=boost-asio&sort=newest)和这两个回答者的 RSS：

![](https://i.stack.imgur.com/CsApR.jpg) [上面答案的作者Tanner Sansburry](https://stackoverflow.com/users/1053968/tanner-sansbury)，他的答案总是非常精确、全面，有参考，甚至是[漂亮](https://stackoverflow.com/a/12801042/888576)的模式。[RSS feed](https://stackoverflow.com/feeds/user/1053968)
![](https://i.stack.imgur.com/Ne80A.jpg) [Sehe](https://stackoverflow.com/users/85371/sehe)（对不起，Sehe，只有第二个）。[RSS订阅](https://stackoverflow.com/feeds/user/85371)

有了所有这些材料，您很快就会成为 asio 专家！

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-11-06T19:38:15.063

我对此也很好奇，但这个页面给了我一些先机。它是法语的，但你可以使用非常易读的谷歌翻译（我必须自己沿着这条路走）。

[http://gwenael-dunand.developpez.com/tutoriels/cpp/boost/asio/](http://gwenael-dunand.developpez.com/tutoriels/cpp/boost/asio/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-07-14T12:54:10.683

我偶然发现了以下pdf： [http ://boost.cowic.de/rc/pdf/asio_doc.pdf](http://boost.cowic.de/rc/pdf/asio_doc.pdf)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-02-05T21:37:55.410

聚会有点晚了，但有一本书叫“Boost Asio Network Programming”（Packt 出版）。

我买了一本，周末读了一遍，然后用 C++ 写了一个完整的服务器，没有什么问题。

免责声明：我与这本书无关

# uml - UML 标准指南/最佳实践

> ID：244457
> 
> 赞同：4
> 
> 时间：2008-10-28T19:12:24.163
> 
> 标签：uml, standards

有谁知道体面的 UML 标准指南？

我的公司目前依赖 UML 2.0（正确或错误）来完成大部分（阅读*全部*）设计工作。我被要求提出一份“最佳实践”指南草案，以帮助其他开发人员开发更好的模型。我面临的主要问题是我对UML略有偏见......我觉得：如果一个图表需要超过5分钟来绘制，那么它太复杂了！我主要寻求关于我应该关注什么样的标准的建议。我也在寻找一个外部信息来源，可以用来平衡我对 UML 繁重设计的非理性厌恶，并充当我的建议的“消毒剂”。

最重要的是，我希望编写一份有用的文档，而不是一个会在一些不起眼的网络目录中成型的文档。

有任何想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-28T19:32:30.677

Martin Fowler 提炼的[UML](https://rads.stackoverflow.com/amzn/click/com/0321193687)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-28T20:00:39.167

像[Paul C](https://stackoverflow.com/questions/244457/uml-standards-guide-best-practices#244537)一样，我推荐[UML Distilled](https://rads.stackoverflow.com/amzn/click/com/0321193687)。它主要是关于 UML 的，但它包含了很多关于一般设计的见解（尽管它对 IMO 索引卡的坚持有点过分），它很短，读起来很愉快，而且切中要害。

简而言之，我强烈建议**反对** [UML](http://oreilly.com/catalog/9781565924482/)。这是我拥有的最糟糕的 O'Reilly 书：内容极其密集、难以阅读且曲折。不值得打印它的纸张。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-09T21:34:58.050

我们谈论的不是一本讲述如何使用 UML 的书，而是某种风格或标准指南。输入，UML 配置文件...这可以为您提供您正在寻找的标准化和降低的复杂性。您可以限制可以使用的关系和元素。你也可以要求某些东西。大公司可能会选择专注于资产和数据移动，并将其标准化图表限制在此视图中。但是，为坦克制作实时软件的公司可能会专注于行动或流程。

UML 的全部意义在于它并非对每种情况都特定且有用。Martin Fowler 和 Elements of style 书籍不会减少绘图时间并增加理解力。您需要标准化的配置文件或模式。我已经看到它起作用了，以至于企业可以阅读它们。许多工具允许您创建配置文件，从而简化设计师的学习曲线并减少绘图时间。

如果您想了解这些概念，MDA Distilled (OMG Press) 是一本好书，但它不是必需的。

真的，UML 配置文件。您不需要标准，因为您的公司或您的需求不同。Web 服务的标准不适用于实时或金融服务。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-28T20:08:48.230

给每个人买一本[The Elements of UML 2.0 Style](http://www.ambysoft.com/books/elementsUMLStyle.html)。任务完成。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-12T03:40:09.533

对于如何编写单个 UML 图的快速参考，我衷心推荐[The Elements of UML Style 2.0](http://www.ambysoft.com/books/elementsUMLStyle.html)，我把钱花在了我推荐的地方，购买了第 2 版来代替我的第 1 版。

除了这个建议之外，我认为公司在引入任何风格指南时最重要的是要有一个**本地反馈机制**，人们可以在其中发表评论，说明风格指南的哪些方面适合他们，特别是当你使用*官方*印刷指南。一个 wiki 或类似的临时存储库就足够了。

我还建议突出显示特别好的例子（或者不好的例子，如果团队幽默可以接受的话）。考虑一个框架*图，*例如您在许多商店中看到*的本周员工。*这给了一个温和的提醒，即图表的可读性被认真对待，但希望有足够的乐趣来获得更多对该概念的认可。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-28T19:38:37.217

我知道您可能想要一本易于阅读的书，但根据您的描述，我建议您使用[OMG](http://www.uml.org/)本身的规范。它们读起来有点多，但会像你希望的那样完整。他们还对可能有用的文章和教程有兴趣。

就书籍而言，我发现[使用 UML](https://rads.stackoverflow.com/amzn/click/com/0321269675)非常好，因为它处理软件开发过程以及 UML 工具和方法。

# google-sheets - 将 Google 电子表格用作应用程序的数据库

> ID：244481
> 
> 赞同：1
> 
> 时间：2008-10-28T19:18:28.583
> 
> 标签：google-sheets

我想使用 Google 电子表格在线存储数据，以便多人可以输入和维护数据，然后为他们的应用程序发布或导出（csv、xls、ods）工作表。处理工作表的最简单方法是什么？如果数据可以作为链接访问，则更新可以立即反映在客户端的应用程序中。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-28T19:43:35.147

这篇文章[Data Scraping Wikipedia with Google Spreadsheets](http://ouseful.wordpress.com/2008/10/14/data-scraping-wikipedia-with-google-spreadsheets/)讨论了使用 Google 电子表格作为应用程序平台。

它已经具有允许您与多个编辑器共享电子表格的功能，以及定义表格的功能，您可以邀请人们填写谁的结果将作为一行输入电子表格。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-24T11:05:07.077

以防 5 个月后它仍然模糊不清，谷歌电子表格有一种类似 SQL 的包装语言：

[http://gqlx.twyst.co.za](http://gqlx.twyst.co.za)

它在很大程度上是一个 alpha 版本——但也许它有一些用处，或者代码可能会给你一些想法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-10-09T06:23:16.357

我想如果我清楚您的要求，您想将您的数据在线存储在 Google 电子表格中，以便多人可以访问吗？那么你想让应用程序使用这些数据吗？如果我错了，请纠正我。

可以将 Google 电子表格作为数据库，客户端应用程序可以通过 API（电子表格 API）直接访问该数据。如果你想要一个简单的链接，人们可以去那里更新 - 你也可以使用谷歌应用脚​​本编写一个网络应用程序。使用起来非常简单，也可以解决您的目的，为什么要将您的数据导出到 ods、xls、csv，直接通过 Google 电子表格制作您的应用程序。也将是可维护的。

# java - 如何处理 Java 中的 LinkageErrors？

> ID：244482
> 
> 赞同：63
> 
> 时间：2008-10-28T19:18:36.040
> 
> 标签：java, linux, classloader, linkageerror

在开发一个大量基于 XML 的 Java 应用程序时，我最近在 Ubuntu Linux 上遇到了一个有趣的问题。

我的应用程序使用[Java Plugin Framework](http://jpf.sourceforge.net/)似乎无法将[dom4j](http://www.dom4j.org/)创建的XML 文档转换为[Batik 的](http://xmlgraphics.apache.org/batik/)SVG 规范实现。

在控制台上，我了解到发生了错误：

```
线程“AWT-EventQueue-0”java.lang.LinkageError 中的异常：接口 itable 初始化中的加载程序约束冲突：解析方法“org.apache.batik.dom.svg.SVGOMDocument.createAttribute(Ljava/lang/String;)Lorg 时/w3c/dom/属性；" 当前类 org/apache/batik/dom/svg/SVGOMDocument 的类加载器（org/java/plugin/standard/StandardPluginClassLoader 的实例）和接口 org/w3c/ 的类加载器（<bootloader> 的实例） dom/Document 对于签名中使用的 org/w3c/dom/Attr 类型有不同的 Class 对象
    在 org.apache.batik.dom.svg.SVGDOMImplementation.createDocument(SVGDOMImplementation.java:149)
    在 org.dom4j.io.DOMWriter.createDomDocument(DOMWriter.java:361)
    在 org.dom4j.io.DOMWriter.write(DOMWriter.java:138)

```

我认为问题是由来自 JVM 的原始类加载器和插件框架部署的类加载器之间的冲突引起的。

据我所知，不可能为要使用的框架指定类加载器。破解它可能是可能的，但我更喜欢用不那么激进的方法来解决这个问题，因为（无论出于何种原因）它只发生在 Linux 系统上。

你们当中有人遇到过这样的问题吗？知道如何解决它或至少找到问题的核心吗？

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2008-10-28T22:00:50.907

LinkageError 是您在一个经典案例中会遇到的情况，其中您有一个由多个类加载器加载的类 C，并且这些类在同一代码中一起使用（比较、强制转换等）。如果它是相同的类名，或者即使它是从相同的 jar 加载的，都没有关系 - 如果从另一个类加载器加载，来自一个类加载器的类总是被视为不同的类。

这条信息（这些年来已经有了很大的改进）说：

```
Exception in thread "AWT-EventQueue-0" java.lang.LinkageError: 
loader constraint violation in interface itable initialization: 
when resolving method "org.apache.batik.dom.svg.SVGOMDocument.createAttribute(Ljava/lang/String;)Lorg/w3c/dom/Attr;" 
the class loader (instance of org/java/plugin/standard/StandardPluginClassLoader) 
of the current class, org/apache/batik/dom/svg/SVGOMDocument, 
and the class loader (instance of ) for interface org/w3c/dom/Document 
have different Class objects for the type org/w3c/dom/Attr used in the signature 
```

因此，这里的问题在于解决 SVGOMDocument.createAttribute() 方法，该方法使用 org.w3c.dom.Attr（标准 DOM 库的一部分）。但是，使用 Batik 加载的 Attr 版本是从与您传递给方法的 Attr 实例不同的类加载器加载的。

您会看到 Batik 的版本似乎是从 Java 插件加载的。而你的是从“”加载的，这很可能是内置的 JVM 加载器之一（引导类路径、ESOM 或类路径）。

三个突出的类加载器模型是：

*   委托（JDK 中的默认设置 - 先问父母，然后再问我）
*   委托后（常见于插件、servlet 和您想要隔离的地方 - 询问我，然后询问父母）
*   兄弟（在 OSGi、Eclipse 等依赖模型中很常见）

我不知道 JPF 类加载器使用什么委托策略，但关键是您希望加载一个版本的 dom 库，并且每个人都可以从同一位置获取该类。这可能意味着将其从类路径中删除并作为插件加载，或者阻止 Batik 加载它，或者其他什么。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-10-28T20:22:46.033

听起来像是类加载器层次结构问题。我不知道您的应用程序部署在哪种类型的环境中，但有时这个问题可能发生在 Web 环境中 - 应用程序服务器创建类加载器的层次结构，类似于：

javahome/lib - 作为 root
appserver/lib - 作为 root
webapp/WEB-INF/lib 的子级 - 作为 root
等的子级的子级

通常类加载器将加载委托给它们的父类加载器（这被称为“ `parent-first`”），如果该类加载器找不到该类，则子类加载器会尝试。例如，如果一个在 webapp/WEB-INF/lib 中部署为 JAR 的类尝试加载一个类，它首先请求 appserver/lib 对应的类加载器加载该类（进而请求 javahome/lib 对应的类加载器加载类），如果此查找失败，则搜索 WEB-INF/lib 以查找与此类的匹配项。

在 Web 环境中，您可能会遇到此层次结构的问题。例如，我之前遇到的一个错误/问题是 WEB-INF/lib 中的类依赖于部署在 appserver/lib 中的类，而后者又依赖于部署在 WEB-INF/lib 中的类。这导致了失败，因为虽然类加载器能够委托给父类加载器，但它们不能委托回树下。因此，WEB-INF/lib 类加载器会向 appserver/lib 类加载器请求一个类，appserver/lib 类加载器会加载该类并尝试加载依赖类，但由于在 appserver/lib 或 javahome 中找不到该类而失败/库。

因此，虽然您可能没有在 web/app 服务器环境中部署您的应用程序，但如果您的环境设置了类加载器的层次结构，那么我过长的解释可能适用于您。可以？JPF 是否在使用某种类加载器魔法来实现它的插件功能？

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2014-06-24T20:03:35.527

可能这会对某人有所帮助，因为它对我来说非常好。该问题可以通过集成您自己的依赖项来解决。按照这个简单的步骤

## 首先检查应该是这样的错误：

*   方法执行失败：
*   java.lang.LinkageError：加载程序约束违规：
*   解析方法“org.slf4j.impl.StaticLoggerBinder.getLoggerFactory **(** )Lorg/slf4j/ILoggerFactory;”时
*   当前类 org/slf4j/ **LoggerFactory**的类加载器（org/openmrs/module/ModuleClassLoader 的实例） ，
*   以及用于已解析类 org/slf4j/impl/ **StaticLoggerBinder**的类加载器（org/apache/catalina/loader/WebappClassLoader 的实例） ，
*   taticLoggerBinder.getLoggerFactory()Lorg/slf4j/ILoggerFactory 类型有不同的类对象；在签名中使用

* * *

2.  请参阅两个突出显示的类。谷歌搜索它们，如“StaticLoggerBinder.class jar 下载”和“LoggeraFactory.class jar 下载”。这将向您显示第一个或在某些情况下是第二个链接（站点为[http://www.java2s.com](http://www.java2s.com)），这是您在项目中包含的 jar 版本之一。您可以自己巧妙地识别它，但我们沉迷于谷歌；）

3.  之后你会知道 jar 文件名，在我的例子中它就像 slf4j-log4j12-1.5.6.jar & slf4j-api-1.5.8

4.  现在该文件的最新版本可在此处获得[http://mvnrepository.com/](http://mvnrepository.com/)（实际上是迄今为止的所有版本，这是 maven 获取依赖项的站点）。
5.  现在将两个文件添加为具有最新版本的依赖项（或保持两个文件版本相同，任何一个选择的版本都是旧的）。以下是您必须包含在 pom.xml 中的依赖项

* * *

```
<dependency>
    <groupId>org.slf4j</groupId>
    <artifactId>slf4j-api</artifactId>
    <version>1.7.7</version>
</dependency>
<dependency>
    <groupId>org.slf4j</groupId>
    <artifactId>slf4j-log4j12</artifactId>
    <version>1.7.7</version>
</dependency> 
```

* * *

![如何从 Maven 站点获取依赖定义](https://i.stack.imgur.com/Rb1Iv.png)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-28T20:28:20.360

你能指定一个类加载器吗？如果没有，请尝试像这样指定上下文类加载器：

```
Thread thread = Thread.currentThread();
ClassLoader contextClassLoader = thread.getContextClassLoader();
try {
    thread.setContextClassLoader(yourClassLoader);
    callDom4j();
} finally {
    thread.setContextClassLoader(contextClassLoader);
} 
```

我不熟悉 Java 插件框架，但我为 Eclipse 编写代码，并且我不时遇到类似的问题。我不保证它会修复它，但它可能值得一试。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-11-23T16:56:06.780

Alex 和 Matt 的回答非常有帮助。我也可以从他们的分析中受益。

在 Netbeans RCP 框架中使用 Batik 库时，我遇到了同样的问题，Batik 库作为“库包装模块”包含在内。如果其他一些模块使用 XML api，并且不需要为该模块建立对 Batik 的依赖，则会出现类加载器约束违规问题并出现类似的错误消息。

在 Netbeans 中，各个模块使用专用的类加载器，模块之间的依赖关系意味着合适的类加载器委托路由。

我可以通过简单地从 Batik 库包中省略 xml-apis jar 文件来解决问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2019-02-18T09:19:15.663

正如在[这个问题](https://stackoverflow.com/questions/2548384/java-get-a-list-of-all-classes-loaded-in-the-jvm)中所指定的那样，启用`-verbose:class`JVM 会记录有关正在加载的所有类的信息，这对于了解在更复杂的场景和应用程序中类的来源非常有帮助。

您得到的输出大致如下（从那个问题复制）：

```
[Opened /usr/java/j2sdk1.4.1/jre/lib/rt.jar]
[Opened /usr/java/j2sdk1.4.1/jre/lib/sunrsasign.jar]
[Opened /usr/java/j2sdk1.4.1/jre/lib/jsse.jar]
[Opened /usr/java/j2sdk1.4.1/jre/lib/jce.jar]
[Opened /usr/java/j2sdk1.4.1/jre/lib/charsets.jar]
[Loaded java.lang.Object from /usr/java/j2sdk1.4.1/jre/lib/rt.jar]
[Loaded java.io.Serializable from /usr/java/j2sdk1.4.1/jre/lib/rt.jar]
[Loaded java.lang.Comparable from /usr/java/j2sdk1.4.1/jre/lib/rt.jar]
[Loaded java.lang.CharSequence from /usr/java/j2sdk1.4.1/jre/lib/rt.jar]
[Loaded java.lang.String from /usr/java/j2sdk1.4.1/jre/lib/rt.jar] 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-10-29T12:00:32.897

我发现这个类被加载了两次。找到原因是parallelWebappClassLoader首先自己加载类而不是使用它的父类加载器。

# c++ - 如何对用户定义类型的 CArray 进行排序？

> ID：244487
> 
> 赞同：7
> 
> 时间：2008-10-28T19:19:58.797
> 
> 标签：c++, data-structures, mfc, sorting

有没有内置的方法在 C++ 中对 CArray 进行排序？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-28T19:25:12.797

`std::sort()`应该管用：

```
CArray<int> arrayOfInts;
arrayOfInts.Add(7);
arrayOfInts.Add(114);
arrayOfInts.Add(3);
std::sort(arrayOfInts.GetData(), arrayOfInts.GetData()+arrayOfInts.GetSize()); 
```

这使用指向数组中第一个元素的指针作为开始迭代器，并将指向最后一个元素的指针作为最后一个迭代器（无论如何都不应该取消引用，所以一切都很好）。如果数组包含更多有趣的数据，您还可以传入自定义谓词：

```
struct Foo
{
  int val;
  double priority;
};

bool FooPred(const Foo& first, const Foo& second)
{
   if ( first.val < second.val )
      return true;
   if ( first.val > second.val )
      return false;
   return first.priority < second.priority;
}

//... 

   CArray<Foo> bar;
   std::sort(bar.GetData(), bar.GetData()+bar.GetSize(), FooPred); 
```

哦 - 不要使用`CArray`.

# .net - 如何判断我的托管代码是否由于本机库调用而泄漏内存？

> ID：244489
> 
> 赞同：1
> 
> 时间：2008-10-28T19:20:57.127
> 
> 标签：.net, memory-management, memory-leaks, native

我有一个调用本机库的托管 dll。这个本机库通常返回 IntPtrs。这些可以传递给本机库中的其他方法来执行操作，或者告诉库释放与 IntPtr 关联的实例。但只有一些实例需要以这种方式释放，其他实例由库管理。问题是文档并不总是清楚地说明哪些实例必须被释放，哪些不能。

我想知道的是，是否有一种方法可以判断我的代码是否保留了对任何必须释放的指针的引用，从而导致内存泄漏？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T19:33:20.190

最简单的方法可能是使用内存分析器。一个快速的谷歌找到了一个指向[MemProfiler](http://memprofiler.com/)的链接。我已经使用过一次（作为试用版），并且能够找到我没有正确处理 DirectoryEntries 的地方。我敢肯定还有其他的，包括[RedGate](http://www.red-gate.com/products/ants_profiler/index.htm)的这个。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T21:44:29.753

我使用 WinDbg（在[此处](http://www.microsoft.com/whdc/devtools/debugging/default.mspx)可用）。它的命令行驱动但提供了很多很好的报告，包括堆栈信息、对象数量和占用的大小（这可以帮助指出没有被处理的项目）。

还有调试诊断工具，它具有内存和句柄泄漏的特定报告。它[在这里](http://www.microsoft.com/downloads/details.aspx?FamilyID=28bd5941-c458-46f1-b24d-f60151d875a3&displaylang=en)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T02:05:41.537

您可能希望考虑使用[SafeHandles](http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.safehandle.aspx)来包装从本机代码返回的句柄。它为 IntPtr 提供了一些附加值。

# c++ - MFC面板和窗口把手

> ID：244492
> 
> 赞同：2
> 
> 时间：2008-10-28T19:22:02.427
> 
> 标签：c++, windows, mfc

有没有可以在 MFC 应用程序中使用的面板之类的东西。这是为了覆盖 MFC（对话框应用程序）中的默认窗口。然后将面板涂成黑色并在其顶部涂上一些随机的东西。类似于视口的东西。

有没有比这更好的选择来达到同样的效果？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T19:35:35.100

当然。这叫窗户！创建一个派生自 CWnd 并覆盖 OnPaint() 的类。

在对话框的 OnInitInstance() 中，实例化一个 CMyWnd 对象并将其称为 Create() 成员。当然，请确保您的 CMyWnd 对象的生命周期与对话框的对象生命周期窗口相同。iow，让它成为你 CMyDialog 类的成员。

不是很复杂，但显然 MFC 显示了它为什么不属于 RAD 工具类别的一个领域。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-05-29T19:07:06.083

另一种解决方案是从`CDialog`. 这样您就可以使用资源编辑器直观地编辑面板，而无需自己绘制任何内容。此外，Panel 类相当薄，只需要传播`Create()`和`Show()`调用以支持单个表单中的子面板和多个面板。

# java - 自制 vs. Java 序列化

> ID：244493
> 
> 赞同：15
> 
> 时间：2008-10-28T19:22:08.293
> 
> 标签：java, database, serialization

我有一个需要在数据库中持久化的 POJO，当前设计将其字段指定为单个字符串列，并且向表中添加其他字段不是一种选择。

意思是，对象需要以某种方式序列化。因此，为了基本实现，我设计了自己的序列化形式的对象，这意味着将它的所有字段连接成一个漂亮的字符串，由我选择的分隔符分隔。但这相当难看，并且可能会导致问题，比如其中一个字段是否包含我的分隔符。

所以我尝试了基本的 Java 序列化，但是从我进行的基本测试来看，这不知何故变成了一个非常昂贵的操作（构建一个 ByteArrayOutputStream、一个 ObjectOutputStream 等等，对于反序列化也是如此）。

那么我的选择是什么？序列化对象以进入数据库的首选方式是什么？

**编辑：**这将是我项目中非常常见的操作，因此开销必须保持在最低限度，性能至关重要。此外，第三方解决方案很好，但无关紧要（通常会产生我试图避免的开销）

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-28T19:47:58.553

Elliot Rusty Harold 写了一个[很好的论据](http://xom.nu/designprinciples.xhtml#d0e323)，反对对他的 XOM 库中的对象使用 Java 对象序列化。同样的原则也适用于你。内置的 Java 序列化是 Java 特定的、脆弱且缓慢的，因此最好避免使用。

在使用基于字符串的格式方面，您的想法大致正确。正如您所说，问题在于您遇到了分隔符的格式/语法问题。解决方案是使用已经构建的格式来处理这个问题。如果这是一种标准化格式，那么您也可以使用其他库/语言来操作它。此外，基于字符串的格式意味着您有希望通过观察数据来理解它；二进制格式删除该选项。

XML 和 JSON 是这里的两个不错的选择；它们是标准化的、基于文本的、灵活的、可读的，并且有很多库支持。它们的性能也会出人意料地好（有时甚至比 Java 序列化还要快）*。*

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-28T21:59:14.793

你可以试试[Protocol Buffers](http://code.google.com/p/protobuf/)，它是 Google 的一个开源项目，据说速度很快（生成比 XML 更短的序列化形式，并且运行速度更快）。它还可以轻柔地处理添加新字段（插入默认值）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-28T21:04:40.613

您需要在解决方案中考虑版本控制。数据不兼容是任何涉及使用对象二进制序列化的解决方案都会遇到的问题。如何将较旧的数据行加载到较新版本的对象中？

因此，上述涉及序列化为名称/值对的解决方案是您可能想要使用的方法。

一种解决方案是包含版本号作为字段值之一。随着新字段的添加、修改或删除，可以修改版本。

反序列化数据时，您可以为每个版本使用不同的反序列化处理程序，这些处理程序可用于将数据从一个版本转换为另一个版本。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-28T19:26:50.220

考虑将数据放在一个`Properties`对象中并使用它的`load()/store()`序列化。这是一种基于文本的技术，因此它在数据库中仍然是可读的：

```
public String getFieldsAsString() {
  Properties data = new Properties();
  data.setProperty( "foo", this.getFoo() );
  data.setProperty( "bar", this.getBar() );
  ...
  ByteArrayOutputStream out = new ByteArrayOutputStream();
  data.store( out, "" );
  return new String( out.toByteArray(), "8859-1" );   //store() always uses this encoding
} 
```

要从字符串加载，请使用新`Properties`对象和`load()`数据执行类似操作。

这比 Java 序列化要好，因为它非常易读且紧凑。

如果您需要支持不同的数据类型（即不仅仅是字符串），请使用[BeanUtils](http://commons.apache.org/beanutils/)将每个字段转换为字符串表示和从字符串表示转换。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-28T19:36:36.440

[XStream](http://xstream.codehaus.org/)或[YAML](http://jyaml.sourceforge.net/)或[OGNL](http://www.ognl.org/)被认为是简单的序列化技术。XML 是最常见的，但 OGNL 以最少的元数据提供了最大的灵活性。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-28T19:31:47.883

如果您的 POJO 由字符串和原始类型组成，我会说您的初始方法并不是那么糟糕。您可以强制转义分隔符以防止损坏。此外，如果您使用 Hibernate，您可以将序列化封装在[自定义类型](http://www.hibernate.org/hib_docs/v3/reference/en-US/html/mapping-types.html#mapping-types-custom)中。

如果您不介意另一个依赖项，[Hessian](http://hessian.caucho.com/)应该是一种更有效的序列化 Java 对象的方法。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-28T21:57:52.520

标准的 JavaBeans 持久化机制怎么样：

```
java.beans.XMLEncoder
java.beans.XMLDecoder 
```

它们能够从 XML（已被持久化为 XML）创建 Java POJO。从记忆中，它看起来（有点）像......

```
<object class="java.util.HashMap">
    <void method="put">
        <string>Hello</string>
        <float>1</float>
    </void>
</object> 
```

您必须提供`PersistenceDelegate`类，以便它知道如何持久化用户定义的类。假设您不删除任何公共方法，它对模式更改具有弹性。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-28T19:39:44.937

您可以通过外部化对象来优化序列化。这将使您完全控制它的序列化方式并提高流程的性能。这样做很简单，只要你的 POJO 简单（即没有对其他对象的引用），否则你很容易破坏序列化。

[教程在这里](http://www.codeguru.com/java/tij/tij0116.shtml)

编辑：并不意味着这是首选方法，但如果 ti 对性能至关重要并且您只能使用表中的字符串列，那么您的选择将非常有限。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-13T21:28:46.777

如果您使用分隔符，您可以使用您知道在文本中永远不会出现的字符，例如 \0，或特殊符号[http://unicode.org/charts/symbols.html](http://unicode.org/charts/symbols.html)

然而，将数据发送到数据库并持久化它所花费的时间可能比序列化的成本要大得多。所以我建议从一些简单易读的东西开始（比如 XStream），看看你的应用程序在哪里花费了大部分时间并优化它。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-28T20:37:58.033

> 我有一个需要在数据库中持久化的 POJO，当前设计将其字段指定为单个字符串列，并且向表中添加其他字段不是一种选择。

您可以创建一个新表并将外键放入该列！？！？:) 我怀疑不是，但让我们涵盖所有的基础！

**序列化：** 我们最近进行了这个讨论，以便如果我们的应用程序崩溃，我们可以将它恢复到与以前相同的状态。我们本质上将持久性事件分派到队列中，然后它会抓取对象，锁定它，然后将其序列化。这似乎很快。你要序列化多少数据？你能让任何变量瞬态（即缓存变量）吗？你可以考虑拆分你的序列化吗？当心：如果您的对象更改（锁定）或类更改（不同的序列化 id）会发生什么？您需要将所有已序列化的内容升级到最新的类。也许您只需要将其存储一夜，所以没关系？

**XML：** 您可以使用类似 xstream 的东西来实现这一点。建立一些定制的东西是可行的（一个很好的面试问题！），但我自己可能不会这样做。何苦？请记住，如果您有循环链接，或者您是否多次引用对象。重建对象并不是那么简单。

**数据库存储：** 如果您使用 Oracle 10g 来存储 blob，请升级到最新版本，因为 c/blob 性能大大提高。如果我们正在谈论大量数据，那么也许压缩输出流？

这是一个实时应用程序，还是会有一两秒钟的停顿，您可以安全地保存实际对象？如果你有时间，那么你可以克隆它，然后将克隆保存在另一个线程上。坚持到底是为了什么？在交易中完成是否重要？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-28T20:40:44.190

考虑更改您的架构。即使您找到一种将 POJO 序列化为字符串的快速方法，您如何处理不同的版本？如何从 X->Y 迁移数据库？还是从 A->D 更糟？我看到我们将序列化对象存储到 BLOB 字段中并且必须跨多个版本迁移客户的问题。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-28T22:20:36.827

你看过[JAXB](http://jaxb.java.net/)吗？它是一种机制，您可以通过它定义一套从 XML 模式创建的 java 对象。它允许您从对象层次结构编组到 XML 或将 XML 解组回对象层次结构。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-13T00:00:34.797

我将第二个建议使用 JAXB，或者可能是 XStream（前者更快，后者更关注对象序列化部分）。另外，我将进一步建议一个不错的基于 JSON 的替代方案，Jackson ( [http://jackson.codehaus.org/Tutorial](http://jackson.codehaus.org/Tutorial) )，它可以将 bean 完全序列化/反序列化为 JSON 文本以存储在列中。

哦，我绝对同意在任何情况下都不要使用 Java 二进制序列化来进行长期数据存储。协议缓冲区也是如此；出于此目的，两者都太脆弱（它们更适合紧密耦合系统之间的数据传输）。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-08-12T14:56:15.307

你可以试试[Preon](http://preon.flotsam.nl/)。Preon 的目标是二进制编码数据，就像 Hibernate 对关系数据库和 JAXB 对 XML 一样。

# web-services - 实时 SOA 应用程序的最佳消息传递媒介？

> ID：244494
> 
> 赞同：3
> 
> 时间：2008-10-28T19:22:46.623
> 
> 标签：web-services, architecture, jms

我正在开发一个使用 SOA 风格实现的实时应用程序（读取通过一些消息传递协议 - JMS、MQ 或 HTTP 连接的松散耦合组件）。

设计此系统的架构师选择使用 JMS 来连接组件。该系统是实时的，因此如果一个组件发生故障（事务将简单地超时），则无需将消息排队。此外，不需要保证交付或回滚。

在这种情况下，与 HTTP Web 服务（速度、资源占用等）相比，使用 JMS 有什么好处吗？

我在想的一件事是，由于 JMS 方法要求我们设置线程池大小（侦听 JMS 主题/队列的组件数量），因此 HTTP 服务不是更合适，因为这种额外的配置不是需要（为每个 HTTP 请求创建一个新线程，使应用程序可扩展到“无限”数量的请求，直到服务器耗尽资源）。

我错过了什么吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T22:46:45.510

我完全不同意 S.Lott 提出的观点，但这里有几点需要考虑关于 HTTP Web 服务：

*   您的客户只需要知道如何通过 HTTP 进行通信——几乎所有现代语言都以一种或另一种形式很好地支持这种协议。JMS 虽然很受欢迎，但比 HTTP 更专业，因此限制了您的互连系统可以使用的语言。也许目前对您的系统来说不是问题，但您是否需要稍后插入其他可能难以支持 JMS 连接的系统？

*   许多语言都很好地支持您可以为您的服务使用的 WSDL 和 SOAP 等标准，并且有很多工具可以生成代码来从 WSDL 文件为您实现管道的两端（客户端和服务器），从而减少你必须做的开发量。这些标准还使得定义和发布您将在系统之间传递的数据规范变得相对简单，您可能必须使用 JMS 等排队技术手动完成这些操作。

*   不利的一面是，正如 S.Lott 所指出的，JMS 为您提供了使用（无状态）HTTP 协议丢弃的功能：保证排序和可靠性；监测；可扩展性；等等。你确定你不需要这些，也不需要这些吗？

好问题，顺便说一句。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T17:21:31.203

我认为这真的取决于情况。在我工作的地方，我们支持 Remoting、JMS、MQ、HTTP 和 sFTP。我们正在实现一个使用 Remoting、JMS、MQ 和 HTTP 的中间件设备，以及一个使用 JMS、MQ 和 HTTP 的软件中间件组件。

正如上面提到的 sgreeve，标准帮助我们变得灵活，但专有格式允许更多功能。

简而言之，我会说将 HTTP 用于无状态调用（最终可以满足您几乎所有的需求）以及有状态调用所需的任何专有格式。如果您在大型企业工作，硬件设备通常非常适合作为中间件：闪电般的快速压缩、加密、转换和翻译，总拥有成本非常低。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T19:53:29.010

我不太了解您的要求，但您可能忽略了可管理性、灵活性和性能。

JMS 允许您监视和管理队列。这些是 HTTP 缺乏的功能，您必须构建而不是从供应商处购买。

此外，JMS 中有队列和主题，允许多个订阅者到一个发布者。在 HTTP 中不可能。

虽然在 1.0 版中您可能不需要这些东西，但您将来可能需要它们。

此外，JMS 可能能够使用其他传输机制，如命名套接字，如果没有（几乎）每个请求都进行所有套接字协商，则可以减少开销。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-29T08:26:06.823

如果您使用 HTTP 路由并且想要支持多台机器或某种可靠性 - 您将需要一个能够发现可用 Web 服务器并在它们之间加载请求的负载均衡器 - 然后故障转移到另一台 Web 服务器如果一个特定的盒子/进程死亡。发出 HTTP 请求的客户端也将不得不处理服务器失败并在某些循环中重试操作。

这是消息队列的主要特性之一 - 可靠的负载平衡与故障转移和生产者和消费者之间的松散耦合，而不必包含重试逻辑 - 因此您的客户端或服务器代码不必担心这种事情。这与您是否想要消息持久性或想要使用 ACID 事务来生成/使用消息完全不同（顺便说一句，这可能非常方便）。

如果您只关注使用 Java 的服务器端 - 无论是 Servlet 还是 MessageListener/MDB，它们实际上都有点相似。不同之处在于负载均衡器。

所以也许问题真的应该是 - JMS 代理是否比设置 DNS/NAT/IP/HTTP 负载平衡器基础设施更容易设置和使用？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-11-17T07:10:39.900

我想这取决于你所说的实时是什么意思……在我看来，JMS 和 HTTP 都不能很好地支持“实时”应用程序，这意味着它们不能提供可预测/确定性的性能，也不能在存在争用的情况下正确地优先处理流。

部分原因是这些技术是建立在 TCP 之上的，它将所有流量序列化到一个 FIFO 中，这意味着不同的流量不能轻易区分优先级。此外，TCP 计时器不容易控制，从而导致不可预测的阻塞和超时……因此，许多流应用程序使用 UDP 而不是 TCP 作为底层协议。

JMS 的另一个问题是典型的实现使用集中消息分发的代理。这不是获得确定性性能的最佳架构。

如果您正在寻找可以为您提供 JMS 获得的可靠性保证和发布-订阅语义的中间件，但它是为适应实时应用程序域而开发的，我建议您查看 OMG 数据分发服务(DDS)。请参阅 dds.omg.org 和我写的这篇文章，讨论为什么 DDS 是实现实时 SOA 的最佳中间件。[http://soa.sys-con.com/node/467488](http://soa.sys-con.com/node/467488)

# c++ - 为什么 OS X 定义'nil'

> ID：244499
> 
> 赞同：2
> 
> 时间：2008-10-28T19:23:44.343
> 
> 标签：c++, macos

至少 libsigc++2 项目受到`nil`在预处理器级别、命名空间之外等定义的 OS X 头文件的影响。至少 10.5.5 和 XCode 3.1 有这个。请注意，它不仅在 Objective-C 源代码中有效，而且在 C++ 中也有效。

简短的问题：为什么？

[http://ardour.sourcearchive.com/documentation/2.5/functor__trait_8h-source.html](http://ardour.sourcearchive.com/documentation/2.5/functor__trait_8h-source.html)

ps 我也记得`nil`来自 Objective-C。但是我没有看到对其他语言进行这种生硬（恕我直言）定义的理由，这会影响与 Objective-C 完全无关的代码（纯 C++ 项目）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-05T05:41:34.760

我正在使用 10.5.6 和 XCode 3.1.2。我刚刚尝试`nil`在我的纯 cpp 项目上使用，但没有定义：

```
main.cpp:41：错误：未在此范围内声明“nil”
```

我的猜测是您的项目以某种方式包含 Cocoa 或其他 Objective-C 库。也许您的代码正在编译为 Objective-C++？它可以编译 C++ 和 Objective-C 的任意组合，因此现有的 C++ 代码也可以编译。这是带有`.mm`扩展名的文件的默认设置。

您是否为此库创建了 XCode 项目？如果是这样，可能是使用了框架模板附带的 XCode 前缀头文件，其中包括 Cocoa/Cocoa.h。检查项目和目标信息中的“前缀标题”选项。

我还通过 /usr/include 进行了搜索，但没有找到任何`#define nil`.

[编辑：`.h`您链接到的文件可能`#undef nil`是因为它也可以在 Objective-C++ 中使用。]

# windows-vista - 在 UAC 提升期间保留映射的驱动器号信息

> ID：244503
> 
> 赞同：-1
> 
> 时间：2008-10-28T19:24:23.750
> 
> 标签：windows-vista, uac, unc

我们有一个应用程序需要知道执行它的路径（始终是网络路径）。

我们根据启动应用程序的路径设置了部分配置，我们真的希望该配置使用映射的网络驱动器路径而不是资源的 UNC 路径。

我们发现，当我们在没有 UAC 提升的情况下启动应用程序时，我们能够获取应用程序启动时使用的目录

```
GetModuleFileName(NULL, buf, sizeof(buf)); 
```

但是当我们启动提升（我们实际上需要这样做）时，返回的缓冲区为我们提供了基于 UNC 的路径，而不是基于驱动器号的路径。

请注意，我们总是通过导航到映射驱动器号的文件夹树从 Windows 资源管理器启动。

有没有人对如何从运行提升的进程中获取基于驱动器号的 EXE 路径有任何建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T19:38:32.443

[使用 UAC 映射网络驱动器](http://blogs.msdn.com/cjacks/archive/2007/02/19/mapped-network-drives-with-uac-on-windows-vista.aspx)

# php - 如何使用 PHP 以编程方式检查有效（非死）链接？

> ID：244506
> 
> 赞同：15
> 
> 时间：2008-10-28T19:25:04.887
> 
> 标签：php, url, cron

给定一个 url 列表，我想检查每个 url：

*   返回 200 OK 状态码
*   在 X 时间内返回响应

最终目标是一个能够将 url 标记为可能损坏的系统，以便管理员可以查看它们。

该脚本将用 PHP 编写，并且很可能每天通过 cron 运行。

该脚本一次将处理大约 1000 个 url。

问题有两部分：

*   像这样的操作有什么大问题，你遇到了什么问题？
*   考虑到准确性和性能，在 PHP 中检查 url 状态的最佳方法是什么？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-28T20:11:12.610

使用 PHP cURL 扩展。与 fopen() 不同，它还可以发出足以检查 URL 可用性并为您节省大量带宽的 HTTP HEAD 请求，因为您不必下载整个页面的正文进行检查。

作为起点，您可以使用如下函数：

```
function is_available($url, $timeout = 30) {
    $ch = curl_init(); // get cURL handle

    // set cURL options
    $opts = array(CURLOPT_RETURNTRANSFER => true, // do not output to browser
                  CURLOPT_URL => $url,            // set URL
                  CURLOPT_NOBODY => true,         // do a HEAD request only
                  CURLOPT_TIMEOUT => $timeout);   // set timeout
    curl_setopt_array($ch, $opts); 

    curl_exec($ch); // do it!

    $retval = curl_getinfo($ch, CURLINFO_HTTP_CODE) == 200; // check if HTTP OK

    curl_close($ch); // close handle

    return $retval;
} 
```

但是，有很多可能的优化：您可能想要重用 cURL 实例，如果每个主机检查多个 URL，甚至重用连接。

哦，这段代码确实严格检查 HTTP 响应代码 200。它不遵循重定向 (302)——但也有一个 cURL 选项。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-28T19:28:42.837

查看卷曲。有一个 PHP 库。

还有一个 cURL 的可执行版本，因此您甚至可以用 bash 编写脚本。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-28T19:32:37.757

实际上，我用 PHP 编写了一些东西，通过 5k+ URL 的数据库来执行此操作。我使用了 PEAR 类[HTTP_Request](http://pear.php.net/package/HTTP_Request/docs/1.4.3/li_HTTP_Request.html)，它有一个名为[getResponseCode](http://pear.php.net/package/HTTP_Request/docs/1.4.3/HTTP_Request/HTTP_Request.html#methodgetResponseCode) () 的方法。我只是遍历 URL，将它们传递给 getResponseCode 并评估响应。

但是，它不适用于 FTP 地址、不以 http 或 https 开头的 URL（未经证实，但我相信是这种情况）以及安全证书无效的站点（找不到 0）。此外，返回 0 表示未找到服务器（没有状态码）。

它可能比 cURL 更容易，因为您包含一些文件并使用单个函数来获取整数代码。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-28T19:28:08.360

1.  fopen() 支持 http URI。
2.  如果您需要更大的灵活性（例如超时），请查看 cURL 扩展。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-28T19:33:47.130

似乎这可能是[curl](http://us.php.net/curl)的工作。

如果您不拘泥于 PHP Perl 的 LWP 也可能是一个答案。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-28T20:06:10.717

您还应该注意返回 301 或 302 HTTP 响应的 URL，这些响应重定向到另一个页面。通常这并不意味着链接无效。例如，[http://amazon.com](http://amazon.com)返回 301 并重定向到[http://www.amazon.com/](http://www.amazon.com/)。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-28T20:25:11.333

仅仅返回 200 响应是不够的；许多有效链接在原所有者未能续订时，在变为色情/赌博门户后会继续返回“200”。

域名抢注者通常会确保其域中的每个 URL 返回 200。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-28T19:30:14.067

您无疑会遇到的一个潜在问题是，当运行此脚本的机器失去对 Internet 的访问权限时……您将得到 1000 个误报。

您的脚本保留某种类型的历史记录并仅在失败 5 天后报告失败可能会更好。

此外，在继续进行标准检查之前，脚本应该以某种方式进行自我检查（例如检查已知良好的网站 [google?]）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-07-06T23:24:51.000

您只需要一个 bash 脚本来执行此操作。[请在此处](https://stackoverflow.com/a/11370861/441849)查看我在类似帖子上的回答。它是一种单线器，可重用 HTTP 连接以显着提高速度，针对临时错误重试 n 次并遵循重定向。

# php - 确定主键编号的标准方法是什么？

> ID：244509
> 
> 赞同：4
> 
> 时间：2008-10-28T19:26:34.883
> 
> 标签：php, mysql, database

我打算使用 php 和 mySQL 制作一个非常简单的程序。主页将获取信息并使用该信息在数据库中创建一个新行。但是，我需要输入一个数字作为主键。不幸的是，我不知道确定使用什么数字的正常方法。最好，如果我删除一行，则该行的键将永远不会被重用。

初步搜索在 mySQL 中找到了 AUTOINCREMENT 关键字。但是，我仍然想知道这是否适用于我想要的以及该问题的常见解决方案是什么。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-28T19:28:33.273

在 MySQL 中，这是[标准解决方案。](http://dev.mysql.com/doc/refman/5.0/en/example-auto-increment.html)

```
CREATE TABLE animals (
     id MEDIUMINT NOT NULL AUTO_INCREMENT,
     name CHAR(30) NOT NULL,
     PRIMARY KEY (id)
 ); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-28T19:30:32.647

除非您有一个压倒一切的理由来生成自己的 PK，否则使用自动增量就足够了。这样数据库管理密钥。当您插入一行时，您必须省略主键列。

假设您有一个表 table = (a, b, c) 其中 a 是主键，那么插入语句将是

插入表（b，c）值（'bbb'，'ccc'）

并且主键将由数据库自动插入。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-28T19:28:21.947

AUTOINCREMENT 是你想要的。只要您不更改表的设置，AUTOINCREMENT 就会继续增长。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-28T19:28:48.217

AUTOINCREMENT 是自动创建唯一键的标准方法。它将从 1 开始（或 0，我不记得了，没关系），然后随着添加到表中的每条新记录而递增。如果一条记录被删除，它的键将*不会*被重用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-28T19:29:38.340

自动递增主键是相对标准的，具体取决于您在哪一周与哪个 DBA 交谈。

我相信基本身份整数在空间用完之前会达到大约 20 亿行（这对 mySQL 是否合适？），因此您不必担心达到上限。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-28T19:30:06.750

AUTO_INCREMENT 是常见的选择，它为您插入的每个新行设置一个从 1 开始的数字。确定要使用哪个数字的所有工作都由数据库完成，如果需要，您只需在插入后询问它（在 php 中，您可以通过调用 mysql_last_insertid 来获取它）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-28T22:11:52.693

对于一些简单的自动增量是最好的。对于最终会有很多条目的更复杂的事情，我会生成一个 GUID 并将其作为键插入。

# excel - 查找 Excel 2007 安装位置的可靠注册表项在哪里？

> ID：244517
> 
> 赞同：4
> 
> 时间：2008-10-28T19:28:39.670
> 
> 标签：excel, registry, installation

查找 Excel 2007 安装位置的可靠注册表项在哪里？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-28T19:44:30.510

怎么样：

```
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Office\X.0\Common\InstallRoot] 
```

> 其中包含一个名为“路径”的密钥，其中包含该版本 Office 的安装目录。这对于 Excel 8.0 到 12.0 是一致的。如果要查找特定产品，请使用 Excel、Word、Access 等代替 Common。
> 
> *   Jon ------- Jon Peltier，Microsoft Excel MVP

来自：[http ://www.developersdex.com/vb/message.asp?p=2677&r=6199020](http://www.developersdex.com/vb/message.asp?p=2677&r=6199020)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-14T01:50:20.023

我正在使用以下密钥：

```
[HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\excel.exe] 
```

如果文件夹名称中包含 Office12，则您已获得 2007。我使用此方法在安装过程中决定安装 Office 2000-2003 插件或 Office 2007 插件，以及安装它们的文件夹。

这是非常可靠的，并且也适用于本地化版本的 Windows。到目前为止，我们已经在法语、德语、西班牙语和意大利语上进行了测试，比我们之前使用的其他方法取得了更好的成功。XLSTART 在所有语言中都应该是相同的，但是在开发单词插件时要小心，因为“STARTUP”在某些情况下是本地化的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T19:48:46.197

这是你可以去的另一个方向。我没有测试过这个。

[http://support.microsoft.com/kb/240794](http://support.microsoft.com/kb/240794)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T19:44:13.570

HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Office\12.0\Excel\InstallRoot\

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-28T20:30:11.260

我发现这个密钥在我所有的 Office 2007 安装中都是一致的。

```
[HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Installer\UserData\S-1-5-18\Components\9B905EB838DBFEE4991CF8E66F518BBF] 
```

如果您正在阅读本文，并且您拥有 Excel 2007，如果它对您也可靠，您可以投票（或发表评论）吗？（投反对票，如果有错误，请发表评论？）

**注意：** 这在我的机器上并不一致。

```
[HKLM\SOFTWARE\Microsoft\Office\X.0\Common\InstallRoot] 
```

# javascript - 带有 iframe 的嵌入式浏览器

> ID：244522
> 
> 赞同：3
> 
> 时间：2008-10-28T19:28:51.120
> 
> 标签：javascript, html, iframe

我正在编写一个将在触摸屏上以信息亭模式运行的 Web 应用程序。我目前只针对它在 Firefox 3 上运行。我需要访问外部站点的一些用例。我希望使用嵌入式浏览器来做到这一点，我正在借助`<iframe>`. 我需要嵌入式主页的后退/前进按钮。

我已经设法访问 iframe 的历史对象

```
var w = document.getElementById('embeddedBrowser').contentWindow;
w.history.back(); 
```

嵌入窗口与`history`父窗口相同。因此对于新加载的`<iframe>`，此调用将返回到系统的上一页。

有什么方法可以避免这种情况或更正确的解决方法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T22:16:48.487

因为每个选项卡中只有一个历史对象共享，这似乎是不可能的。解决它的正确方法是测试`window.history.current`或`window.history.previous`在回拨之前进行。不幸的是，`window.history.current`它具有特权，因此不适用于未签名的页面。

这是一个混乱的解决方法的粗略草图：

```
<iframe src="somepage.html" name="myframe"></iframe>
<p><a href="#" id="backBtn">Back</a></p>

<script type="text/javascript">

  document.getElementById('backBtn').onclick = function () {
    if (window.frames['myframe'].location.hash !== '#stopper') {
      window.history.back();
    }
    // ... else hide the button?
    return false; // pop event bubble
  };
  window.frames['myframe'].onload = function () {
    this.location.hash = 'stopper';
  };

</script> 
```

当然，这是假设在父窗口中没有进行任何 (#hash) 浏览，依此类推，但它似乎适用于限制向后移动的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T20:31:02.553

您可能想看看[Adob​​e AIR](http://www.adobe.com/products/air/develop/ajax/)。它允许您使用所有相同的工具/语言（ajax、html 等）编写应用程序，但由于它作为桌面应用程序而不是在 Web 浏览器中运行，因此您可以更好地控制事物，例如嵌入浏览器框架和确切地知道他们在做什么，它要去什么 URL，控制它的历史等等。[在这里](https://stackoverflow.com/questions/149338/adobe-air-book-from-htmljavascript-perspective#149432)寻找一些入门指南。

# c# - 是否有不区分大小写的 string.Replace 替代方法？

> ID：244531
> 
> 赞同：311
> 
> 时间：2008-10-28T19:31:16.933
> 
> 标签：c#, .net, string, .net-2.0, replace

我需要搜索一个字符串并将所有出现的 和 替换为`%FirstName%`从`%PolicyAmount%`数据库中提取的值。问题是 FirstName 的大小写不同。这使我无法使用该`String.Replace()`方法。我看过有关该主题的网页建议

```
Regex.Replace(strInput, strToken, strReplaceWith, RegexOptions.IgnoreCase); 
```

但是由于某种原因，当我尝试用 替换`%PolicyAmount%`时`$0`，替换永远不会发生。我认为这与美元符号是正则表达式中的保留字符有关。

我可以使用另一种不涉及清理输入以处理正则表达式特殊字符的方法吗？

* * *

## 回答 #1

> 赞同：298
> 
> 时间：2008-10-28T21:27:58.307

似乎`string.Replace` *应该*有一个带`StringComparison`参数的重载。既然没有，你可以尝试这样的事情：

```
public static string ReplaceString(string str, string oldValue, string newValue, StringComparison comparison)
{
    StringBuilder sb = new StringBuilder();

    int previousIndex = 0;
    int index = str.IndexOf(oldValue, comparison);
    while (index != -1)
    {
        sb.Append(str.Substring(previousIndex, index - previousIndex));
        sb.Append(newValue);
        index += oldValue.Length;

        previousIndex = index;
        index = str.IndexOf(oldValue, index, comparison);
    }
    sb.Append(str.Substring(previousIndex));

    return sb.ToString();
} 
```

* * *

## 回答 #2

> 赞同：134
> 
> 时间：2008-10-28T19:47:10.943

[从 MSDN](http://msdn.microsoft.com/en-us/library/ewy2t5e0.aspx)
$0 - “替换与组号匹配的最后一个子字符串（十进制）。”

在 .NET 正则表达式中，组 0 始终是整个匹配项。对于文字 $ 你需要

```
string value = Regex.Replace("%PolicyAmount%", "%PolicyAmount%", @"$$0", RegexOptions.IgnoreCase); 
```

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2014-07-04T20:28:03.093

一组令人困惑的答案，部分原因是问题的标题实际上*比*所问的具体问题大得多。通读后，我不确定任何答案是否与吸收这里所有的好东西相距甚远，所以我想我会尝试总结一下。

这是一种扩展方法，我认为它避免了这里提到的陷阱，并提供了最广泛适用的解决方案。

```
public static string ReplaceCaseInsensitiveFind(this string str, string findMe,
    string newValue)
{
    return Regex.Replace(str,
        Regex.Escape(findMe),
        Regex.Replace(newValue, "\\$[0-9]+", @"$$$0"),
        RegexOptions.IgnoreCase);
} 
```

所以...

*   这是[一个扩展方法](https://stackoverflow.com/questions/244531/is-there-an-alternative-to-string-replace-that-is-case-insensitive#comment5549925_244933)@MarkRobinson
*   这[不会尝试跳过 Regex](https://stackoverflow.com/questions/244531/is-there-an-alternative-to-string-replace-that-is-case-insensitive#comment5771414_244933) @Helge（如果您想在 Regex 之外进行这样的字符串嗅探，您真的必须逐字节进行）
*   通过了@MichaelLiu 的[优秀测试用例](https://stackoverflow.com/questions/244531/is-there-an-alternative-to-string-replace-that-is-case-insensitive#comment31063745_244933)，`"œ".ReplaceCaseInsensitiveFind("oe", "")`尽管他的想法可能略有不同。

不幸的是，[@HA 的评论说你必须`Escape`全部三个是不正确的](https://stackoverflow.com/questions/244531/is-there-an-alternative-to-string-replace-that-is-case-insensitive/244933#comment19010354_244585)。初始值并且`newValue`不需要。

**注意：**但是，**如果它们是看似“捕获的值”标记的一部分，则**`$`您必须在插入的新值中转义 s 。因此，Regex.Replace [sic] 中的 Regex.Replace 中的三个美元符号。没有它，这样的事情就会破裂......

 **`"This is HIS fork, hIs spoon, hissssssss knife.".ReplaceCaseInsensitiveFind("his", @"he$0r")`

这是错误：

```
An unhandled exception of type 'System.ArgumentException' occurred in System.dll

Additional information: parsing "The\hisr\ is\ he\HISr\ fork,\ he\hIsr\ spoon,\ he\hisrsssssss\ knife\." - Unrecognized escape sequence \h. 
```

告诉你什么，我知道熟悉 Regex 的人觉得他们的使用可以避免错误，但我通常仍然偏爱字节嗅探字符串（但只有在阅读[Spolsky on encodings](http://www.joelonsoftware.com/articles/Unicode.html)之后）才能绝对确定你得到了什么用于重要的用例。让我想起了 Crockford 关于“[不安全的正则表达式](http://www.htmlgoodies.com/html5/javascript/jslint-errors-and-options-described.html#fbid=49_PApIFUSX)”的一点。我们经常编写允许我们想要的正则表达式（如果我们幸运的话），但无意中允许更多（例如，`$10`在我的 newValue 正则表达式中真的是一个有效的“捕获值”字符串吗？），因为我们不够周到. 这两种方法都有价值，并且都鼓励不同类型的无意错误。通常很容易低估复杂性。

这种奇怪`$`的转义（并且`Regex.Escape`没有像`$0`我在替换值中所期望的那样逃脱捕获的价值模式）让我发疯了一段时间。编程很难（c）1842

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2010-08-23T19:47:25.920

似乎最简单的方法是简单地使用 .Net 附带的 Replace 方法，并且自 .Net 1.0 以来一直存在：

```
string res = Microsoft.VisualBasic.Strings.Replace(res, 
                                   "%PolicyAmount%", 
                                   "$0", 
                                   Compare: Microsoft.VisualBasic.CompareMethod.Text); 
```

为了使用此方法，您必须添加对 Microsoft.VisualBasic 程序集的引用。此程序集是 .Net 运行时的标准部分，它不是额外下载或标记为过时的。

* * *

## 回答 #5

> 赞同：32
> 
> 时间：2011-07-20T00:35:14.680

这是一个扩展方法。不知道我在哪里找到的。

```
public static class StringExtensions
{
    public static string Replace(this string originalString, string oldValue, string newValue, StringComparison comparisonType)
    {
        int startIndex = 0;
        while (true)
        {
            startIndex = originalString.IndexOf(oldValue, startIndex, comparisonType);
            if (startIndex == -1)
                break;

            originalString = originalString.Substring(0, startIndex) + newValue + originalString.Substring(startIndex + oldValue.Length);

            startIndex += newValue.Length;
        }

        return originalString;
    }

} 
```

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2012-08-21T08:39:18.880

```
 /// <summary>
    /// A case insenstive replace function.
    /// </summary>
    /// <param name="originalString">The string to examine.(HayStack)</param>
    /// <param name="oldValue">The value to replace.(Needle)</param>
    /// <param name="newValue">The new value to be inserted</param>
    /// <returns>A string</returns>
    public static string CaseInsenstiveReplace(string originalString, string oldValue, string newValue)
    {
        Regex regEx = new Regex(oldValue,
           RegexOptions.IgnoreCase | RegexOptions.Multiline);
        return regEx.Replace(originalString, newValue);
    } 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2014-08-21T12:48:25.003

受 cfeduke 的回答启发，我制作了这个函数，它使用 IndexOf 来查找字符串中的旧值，然后用新值替换它。我在处理数百万行的 SSIS 脚本中使用了它，而正则表达式方法比这慢得多。

```
public static string ReplaceCaseInsensitive(this string str, string oldValue, string newValue)
{
    int prevPos = 0;
    string retval = str;
    // find the first occurence of oldValue
    int pos = retval.IndexOf(oldValue, StringComparison.InvariantCultureIgnoreCase);

    while (pos > -1)
    {
        // remove oldValue from the string
        retval = retval.Remove(pos, oldValue.Length);

        // insert newValue in it's place
        retval = retval.Insert(pos, newValue);

        // check if oldValue is found further down
        prevPos = pos + newValue.Length;
        pos = retval.IndexOf(oldValue, prevPos, StringComparison.InvariantCultureIgnoreCase);
    }

    return retval;
} 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2016-09-30T13:24:27.587

通过使他的代码成为重载默认方法的扩展来扩展[C. Dragon 76的流行答案。](https://stackoverflow.com/questions/244531/is-there-an-alternative-to-string-replace-that-is-case-insensitive#answer-244933)`Replace`

```
public static class StringExtensions
{
    public static string Replace(this string str, string oldValue, string newValue, StringComparison comparison)
    {
        StringBuilder sb = new StringBuilder();

        int previousIndex = 0;
        int index = str.IndexOf(oldValue, comparison);
        while (index != -1)
        {
            sb.Append(str.Substring(previousIndex, index - previousIndex));
            sb.Append(newValue);
            index += oldValue.Length;

            previousIndex = index;
            index = str.IndexOf(oldValue, index, comparison);
        }
        sb.Append(str.Substring(previousIndex));
        return sb.ToString();
     }
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2016-09-26T07:19:34.247

基于 Jeff Reddy 的回答，并进行了一些优化和验证：

```
public static string Replace(string str, string oldValue, string newValue, StringComparison comparison)
{
    if (oldValue == null)
        throw new ArgumentNullException("oldValue");
    if (oldValue.Length == 0)
        throw new ArgumentException("String cannot be of zero length.", "oldValue");

    StringBuilder sb = null;

    int startIndex = 0;
    int foundIndex = str.IndexOf(oldValue, comparison);
    while (foundIndex != -1)
    {
        if (sb == null)
            sb = new StringBuilder(str.Length + (newValue != null ? Math.Max(0, 5 * (newValue.Length - oldValue.Length)) : 0));
        sb.Append(str, startIndex, foundIndex - startIndex);
        sb.Append(newValue);

        startIndex = foundIndex + oldValue.Length;
        foundIndex = str.IndexOf(oldValue, startIndex, comparison);
    }

    if (startIndex == 0)
        return str;
    sb.Append(str, startIndex, str.Length - startIndex);
    return sb.ToString();
} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-01-07T15:27:49.077

类似于 C. Dragon 的版本，但如果您只需要一个替换：

```
int n = myText.IndexOf(oldValue, System.StringComparison.InvariantCultureIgnoreCase);
if (n >= 0)
{
    myText = myText.Substring(0, n)
        + newValue
        + myText.Substring(n + oldValue.Length);
} 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2020-08-08T12:03:09.260

由于分别从 .NET Core 2.0 或 .NET Standard 2.1 开始，这已被纳入 .NET 运行时 [1]：

```
"hello world".Replace("World", "csharp", StringComparison.CurrentCultureIgnoreCase); // "hello csharp" 
```

[1] [https://docs.microsoft.com/en-us/dotnet/api/system.string.replace#System_String_Replace_System_String_System_String_System_StringComparison](https://docs.microsoft.com/en-us/dotnet/api/system.string.replace#System_String_Replace_System_String_System_String_System_StringComparison) _

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-08-14T23:02:45.263

这是执行正则表达式替换的另一个选项，因为似乎没有多少人注意到匹配包含字符串中的位置：

```
 public static string ReplaceCaseInsensative( this string s, string oldValue, string newValue ) {
        var sb = new StringBuilder(s);
        int offset = oldValue.Length - newValue.Length;
        int matchNo = 0;
        foreach (Match match in Regex.Matches(s, Regex.Escape(oldValue), RegexOptions.IgnoreCase))
        {
            sb.Remove(match.Index - (offset * matchNo), match.Length).Insert(match.Index - (offset * matchNo), newValue);
            matchNo++;
        }
        return sb.ToString();
    } 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-28T19:33:03.640

```
Regex.Replace(strInput, strToken.Replace("$", "[$]"), strReplaceWith, RegexOptions.IgnoreCase); 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-28T19:36:57.500

正则表达式方法应该可以工作。但是，您还可以将数据库中的字符串小写，将您拥有的 %variables% 小写，然后从数据库中找到小写字符串中的位置和长度。请记住，字符串中的位置不会仅仅因为它的小写而改变。

然后使用一个反向循环（它更容易，如果你不这样做，你将不得不保持对以后点移动到的位置的运行计数）从数据库中的非小写字符串中删除 %variables% 通过它们的位置和长度并插入替换值。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-01-19T09:21:58.063

（因为每个人都在尝试这个）。这是我的版本（带有空检查，以及正确的输入和替换转义）** 灵感来自互联网和其他版本：

```
using System;
using System.Text.RegularExpressions;

public static class MyExtensions {
    public static string ReplaceIgnoreCase(this string search, string find, string replace) {
        return Regex.Replace(search ?? "", Regex.Escape(find ?? ""), (replace ?? "").Replace("$", "$$"), RegexOptions.IgnoreCase);          
    }
} 
```

用法：

```
var result = "This is a test".ReplaceIgnoreCase("IS", "was"); 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-07-20T17:29:08.620

让我证明我的情况，然后如果你愿意，你可以把我撕成碎片。

正则表达式不是这个问题的答案 - 相对来说太慢而且内存太小。

StringBuilder 比字符串修饰要好得多。

由于这将是补充的扩展方法`string.Replace`，因此我认为匹配其工作方式很重要 - 因此，对于相同的参数问题抛出异常很重要，如果没有进行替换，则返回原始字符串也是如此。

我相信拥有 StringComparison 参数不是一个好主意。我确实尝试过，但 michael-liu 最初提到的测试用例显示了一个问题：-

```
[TestCase("œ", "oe", "", StringComparison.InvariantCultureIgnoreCase, Result = "")] 
```

虽然 IndexOf 将匹配，但源字符串 (1) 和 oldValue.Length (2) 中的匹配长度不匹配。当 oldValue.Length 添加到当前匹配位置时，这通过在其他一些解决方案中导致 IndexOutOfRange 表现出来，我找不到解决这个问题的方法。无论如何，正则表达式都无法匹配案例，所以我采取了仅`StringComparison.OrdinalIgnoreCase`用于我的解决方案的务实解决方案。

我的代码与其他答案相似，但我的转折是我在麻烦创建`StringBuilder`. 如果没有找到，则避免潜在的大分配。然后代码变成 a`do{...}while`而不是 a`while{...}`

我已经针对其他答案进行了一些广泛的测试，结果速度更快，并且使用的内存略少。

```
 public static string ReplaceCaseInsensitive(this string str, string oldValue, string newValue)
    {
        if (str == null) throw new ArgumentNullException(nameof(str));
        if (oldValue == null) throw new ArgumentNullException(nameof(oldValue));
        if (oldValue.Length == 0) throw new ArgumentException("String cannot be of zero length.", nameof(oldValue));

        var position = str.IndexOf(oldValue, 0, StringComparison.OrdinalIgnoreCase);
        if (position == -1) return str;

        var sb = new StringBuilder(str.Length);

        var lastPosition = 0;

        do
        {
            sb.Append(str, lastPosition, position - lastPosition);

            sb.Append(newValue);

        } while ((position = str.IndexOf(oldValue, lastPosition = position + oldValue.Length, StringComparison.OrdinalIgnoreCase)) != -1);

        sb.Append(str, lastPosition, str.Length - lastPosition);

        return sb.ToString();
    } 
```

# delphi - Delphi 6中绑定到数据库的多选列表框

> ID：244536
> 
> 赞同：4
> 
> 时间：2008-10-28T19:32:25.513
> 
> 标签：delphi, data-binding, listbox

我正在使用 Delphi 6，我想要一个带有多选的数据库绑定列表框。我发现了三种类型的列表框`TListBox`：`TDBListBox`和`TDBLookupListBox`。

据我了解，`TListbox`是不绑定数据库的。`TDBListBox`并且`TDBLookupListBox`不能多选。

有没有办法让多选列表框绑定到数据库？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T19:34:24.400

数据绑定组件的问题在于它们依赖于数据源，而数据源只有一个游标。这大概就是原因。

顺便问一下，您需要更改数据吗？否则，您可以从数据集中填充普通列表框。甚至使用不可见的数据列表框并将内容复制到普通列表框。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-28T19:37:23.910

据我所知不是。
标准是您在列表中提供一堆值，其中 1 代表当前记录。
除非您有一个多值字段（违反最佳实践），否则我看不出您如何进行多选...

或者您可能想要的实际上是一个子表？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T22:12:53.300

DevExpress TcxDBListBox 支持多选。我使用他们绑定到数据库的多选下拉复选框，这很甜蜜。

这些组件具有您可以实现的方法来与您的列表相互转换；EditValueToStates 和 StatesToEditValue。虽然我存储的数据没有标准化（我存储了一个以分号分隔的版本号列表），但我在字段上创建了一个全文搜索索引，以分号作为分隔符，现在我仍然可以执行优化搜索在那个领域。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-31T12:32:00.800

您可以创建自己的自定义列表框组件，该组件源自 TCustomListBox，并为您的列表添加一个 Datasource 属性，以及另一个属性（例如 TStrings）用作保存选定值的容器。然后，您可以使用单击按钮将更改发布到数据库。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-20T17:38:28.687

如果您摆弄 TDBGrid 的某些选项并限制它显示的列，您可以制作看起来很像列表框的东西。尝试将 Options 属性设置为 [dgTitles,dgTabs,dgRowSelect,dgAlwaysShowSelection,dgCancelOnExit,dgMultiSelect] 并从那里开始工作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-28T20:31:49.980

在 TDbLookupListBox 中，您可以选择将两种不同的东西绑定到数据；首先，您可以将列表绑定到数据集（ListSource/ListField/KeyField），其次您可以将所选项目绑定到另一个数据集中的字段（DataSource、DataField）。想要将项目列表绑定到数据集，然后手动管理多个选择在概念上没有任何问题，但是我认为在没有子类化和启用所需控件样式的情况下，当前的实现是不可能的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-28T22:32:14.290

根据您对 François 的评论，我将使用普通的 TListbox 并编写代码将所有不同的值插入到列表中，然后自己处理多选值。Jeremy 的解决方案也有效，[DevExpress Express Quantum Grid](http://www.devexpress.com/Products/VCL/ExQuantumGrid/)有一个很好的过滤系统，它甚至可以为您节省一些其他编程。

# ruby-on-rails - 在 Ruby 中从 XML 字符串创建对象

> ID：244563
> 
> 赞同：3
> 
> 时间：2008-10-28T19:38:35.280
> 
> 标签：ruby-on-rails, xml, ruby, activerecord

我正在尝试从 Ruby 中的 XML 反序列化对象。

像这样简单的东西：

```
u = User.new({:client_key => "Bar"})
v = User.new(u.to_xml) 
```

我收到一个错误：

> NoMethodError：未定义的方法'stringify_keys！' 对于#String:0x20fc7cc>

我不确定我必须做什么才能将字符串从 XML 获取到对象。

**更新：** @avdi 给了我小费。我期待 from_xml 是一种自我方法。您必须先创建对象。

```
v = User.new
v.from_xml(s) 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-28T19:50:58.877

快速搜索出现[http://api.rubyonrails.org/classes/ActiveRecord/Serialization.html#M001420](http://api.rubyonrails.org/classes/ActiveRecord/Serialization.html#M001420)

# ruby-on-rails - 添加到rails中的多个表

> ID：244569
> 
> 赞同：5
> 
> 时间：2008-10-28T19:41:04.387
> 
> 标签：ruby-on-rails, ruby

我确信这是一个相对简单的问题，并且必须有一个很好的明智的 rails 方式来做这件事，但我不确定它是什么。

基本上我正在将书籍添加到数据库中，并且我想将作者存储在一个单独的表中。所以我有一个名为 authors 的表，由表书引用。

我想创建一个 Rails 表单来添加一本书，我希望它只是一个简单的表单，用于作者、标题、出版商等，如果它发现作者已经在作者表中，那么它应该只引用该记录，如果它不在作者表中，那么它应该添加一条新记录并引用它。

我确信在 Rails 中有一种简单的方法可以做到这一点 - 但我似乎找不到它。

干杯，

罗宾

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-28T19:50:05.103

假设您的表单传递了 author_name 和带有 book 属性的 book 哈希，您可以在控制器中执行以下操作：

```
@author = Author.find_or_create_by_name(params[:author_name])
@book = Book.new(params[:book])
@book.author = @author
@book.save 
```

这将找到具有该名称的作者，或创建一个作者，然后将该作者分配给所创建的书。

注意：这也假设作者可以通过他们的名字来唯一标识，但通常情况并非如此。例如，那里可能有多个名叫“史蒂文·金”的人，其中只有一个人写了*《闪灵》*

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-28T20:59:07.507

[我建议您在这里](http://railscasts.com/episodes/73-complex-forms-part-1)观看Railscasts的**Complex Forms 系列**。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T17:23:23.940

robintw 对 Micah 回答的评论：

> 这看起来是一个很好的方法——尽管我在某些方面感到惊讶 Rails 并没有更自动地做到这一点

是四行！Rails 可以自动实现多少？这是一个框架，而不是人类。:)

这里有两个：

```
@author = Author.find_or_create_by_name(params[:author_name])
@book = Book.create params[:book].merge({:author_id => @author.id}) 
```

Honza 的回答有很多优点：

```
class Book < ActiveRecord::Base
  ...
  def author_name=(author_name)
    self.author = Author.find_or_create_by_name author_name
  end
end 
```

在这个例子中，假设你的表单有一个像“book[author_name]”这样的参数，你的代码就是：

```
@book = Book.create params[:book] 
```

哇塞。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-04T07:52:20.707

这最终将是自动的（根据这篇文章，在 Rails 2.2 中）： [http ://ryandaigle.com/articles/2008/7/19/what-s-new-in-edge-rails-nested-models](http://ryandaigle.com/articles/2008/7/19/what-s-new-in-edge-rails-nested-models)

# asp.net-mvc - ASP.NET MVC 应用程序中丰富的 UI 可用的最佳选项是什么？

> ID：244577
> 
> 赞同：6
> 
> 时间：2008-10-28T19:43:52.807
> 
> 标签：asp.net-mvc

到目前为止，我已经找到了以下用于构建 ASP.NET MVC 视图的组件：

*   [雅虎用户界面 (YUI)](http://developer.yahoo.com/yui/)
*   [分机JS](http://extjs.com/products/extjs/)
*   [Flexgrid](http://www.webplicity.net/flexigrid/)（仅网格）

目前还有哪些其他可用的选项，其中包括一个不错的网格组件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T21:59:59.083

Check out [JQGrid](http://bartreyserhove.blogspot.com/2008/08/aspnet-mvc-and-jqgrid.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T04:57:07.603

[MVCContrib](http://www.codeplex.com/MVCContrib)为 ASP.NET MVC 应用程序提供了一个网格助手。[您可以从这里](http://www.codeplex.com/MVCContrib/Wiki/View.aspx?title=Grid&referringTitle=Documentation)阅读文档

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T21:45:25.680

*   [jQuery](http://www.urautoloads.com/ci/index.aspx)
*   [jQuery Pugins](http://plugins.jquery.com/)

有一些网格插件，我没用过：

*   [弹性网格](http://www.webplicity.net/flexigrid/)
*   [jQuery 网格插件](http://digitalbush.com/projects/jquery-grid-plugin/)
*   [另一个 JQuery Grid 插件](http://www.trirand.com/blog/?p=23)

# iphone - parentViewController 总是导航控制器吗？

> ID：244588
> 
> 赞同：7
> 
> 时间：2008-10-28T19:48:25.730
> 
> 标签：iphone, cocoa-touch

一周前我对此有点摸不着头脑，现在有了更多可可经验，我觉得我对可能发生的事情有所了解。

我正在制作一个由 UINavigationController 驱动的应用程序。在 AppDelegate 中，我创建了这个类的一个实例，使用“page 1”作为根视图控制器。

```
UINavigationController *aNavigationController = [[UINavigationController alloc] 
     initWithRootViewController:page1ViewController]; 
```

现在这就是我遇到问题的地方。从“第 1 页”开始，我想使用一个模态视图控制器，它在界面上滑动，然后在用户进行编辑后消失。我在 Page1ViewController 内部使用这样的代码来做到这一点：

```
[self presentModalViewController:myModalViewController animated:YES]; 
```

当模态视图控制器消失时，我希望“第 1 页”上的值根据用户在模态视图控制器中输入的内容进行更改。所以，我写了一些这样的代码，它驻留在模态视图控制器中：

```
[self.parentViewController dismissModalViewControllerAnimated:YES];
[self.parentViewController doSomethingPleaseWithSomeData:someData]; 
```

没有更新到第 1 页，我花了很长时间才意识到“doSomethingPleaseWithSomeData”消息没有发送到 Page1ViewController，而是导航控制器。

使用导航控制器时是否总是可以预料到这一点？我是否可能配置不正确？有没有一种简单的方法可以访问我想要的视图控制器（在本例中为 Page1ViewController）。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-11T15:51:18.490

我建议使用委托模式来解决您的问题。创建属性

```
@property (nonatomic, assign) id <MyModalViewDelegate> delegate; 
```

以及相应的协议

```
@protocol MyModalViewDelegate
@optional
    - (void)myModalViewControllerDidFinish:(MyModalViewController *)aModalViewController;
@end 
```

当用户完成您的视图（例如点击保存按钮）时，发送此消息：

```
if ([self.delegate respondsToSelector:@selector(myModalViewControllerDidFinish:)])
    [self.delegate myModalViewControllerDidFinish:self]; 
```

现在，将委托设置为应该管理整个事情的视图控制器，当视图控制器完成时它会收到通知。请注意，您需要您的视图控制器来关闭模态视图控制器。但是，从逻辑上讲，这是有道理的，因为它是首先呈现模态视图控制器的对象。

这就是 Apple 在 UIImagePickerController 和 UIPersonPickerController 中解决此问题的方法。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-28T20:08:22.053

有几种方法可以处理这个问题。最简单的可能只是将 UIViewController 属性添加到 myModalViewController 并在呈现之前将其设置为 page1Controller：

```
myModalViewController.logicalParent = self; //page1Controller
[self presentModalViewController:myModalViewController animated:YES]; 
```

只需确保将适当的实例变量@property 和用于logicalParent 的@synthesize 添加到myModalViewController，然后您就可以将数据传回触发模态对话框的ViewController。这也用于在将数据推送到堆栈并将其弹出之前在不同导航级别之间来回传递数据。

这样做时要担心的一件重要事情是，如果您不小心，很容易获得保留循环。根据您的结构，您可能需要使用分配属性。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-09-24T15:39:32.107

我刚刚遇到了同样的问题。显然，如果您将 UIViewController 嵌入到 NavigationController 中，那么当您从该 UIViewController 以模态方式呈现另一个 UIViewController 时，演示者认为演示者是 NavigationController。换句话说，parentViewController 是不正确的。

我敢打赌这是一个错误：要么，要么文档似乎不完整。我会查询的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-12-18T13:21:25.470

刚刚遇到了同样的问题。我相信这是一个错误。我的场景如下：按此顺序具有 A、B 和 C 视图控制器的导航层次结构。在 C 上，有一个按钮可以打开一个名为 D 的模式视图控制器。一旦呈现 D，导航控制器就会从其层次结构中删除 C，这是一种可怕的行为。一旦 D 被解除，导航控制器*将实例化*一个新的 C 类型视图控制器并将其推入其层次结构以恢复原始视图控制器。糟糕的。我的解决方案是以这种方式破解导航层次结构（一个非常糟糕的解决方案，但效果很好。使用二维数组，您可以实现堆叠模式）：

```
- (void)presentModalViewController:(UIViewController *)c {
    [self.navigationHierarchy removeAllObjects];
    [self.navigationHierarchy addObjectsFromArray:[navigation viewControllers]];
    [navigation setViewControllers:[NSArray array] animated:YES];
    [navigation presentModalViewController:c animated:YES];
}

- (void)dismissModalViewController {
    [navigation dismissModalViewControllerAnimated:YES];
    [navigation setViewControllers:[NSArray arrayWithArray:self.navigationHierarchy] animated:YES];
} 
```

这两种方法是在我维护主要导航层次结构的地方定义的：应用程序委托。导航和导航层次结构是这样定义的：

```
NSMutableArray *navigationHierarchy;
UINavigationController *navigation; 
```

# c# - 为什么我会收到此错误：“跨线程操作无效：控制 lbFolders 从创建它的线程以外的线程访问。”？

> ID：244591
> 
> 赞同：2
> 
> 时间：2008-10-28T19:49:03.967
> 
> 标签：c#, .net, multithreading

这让我感到莫名其妙，也许有人可以将教育之光照亮我的无知。这是在 C# Windows 应用程序中。我正在从线程访问列表框的内容。当我尝试像这样访问它时

```
prgAll.Maximum = lbFolders.SelectedItems.Count;
```

我得到了错误。但是，这是我没有得到的部分。如果我注释掉那一行，下一行

```
foreach (string dir in lbFolders.SelectedItems)
```

执行得很好。

编辑：像往常一样，我缺乏沟通技巧。让我澄清一下。

我知道从创建它们的线程以外的线程访问 GUI 项目会导致问题。我知道访问它们的正确方法是通过委托。

我的问题主要是这样的：为什么我可以很好地访问和遍历 SelectedItems 对象，但是当我尝试获取（未设置）它的 Count 属性时，它会爆炸。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-28T19:53:43.130

您不能从单独的线程访问 GUI 元素。使用委托进行更改。

例如。

```
lblStatus.Invoke((Action)(() => lblStatus.Text = counter.ToString())); 
```

或更老的学校：

```
lblTest.Invoke((MethodInvoker)(delegate() 
{ 
  lblTest.Text = i.ToString(); 
})); 
```

我有一篇关于如何在所有 .Net 版本中执行此操作的博[文](http://rumandcode.wordpress.com/2008/07/17/doing-invokes-on-winform-controls-examples-from-delegates-to-lambdas/)。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-28T19:52:00.637

```
prgAll.Maximum = lbFolders.SelectedItems.Count; 
```

在该行上，您执行分配（**set/add**），默认情况下它不是线程安全的。

在第二行，它只是一个**get**操作，其中线程安全无关紧要。

编辑：我不是指访问 prgAll 元素。

访问 Count 属性**会更改 ListBox 内部集合的内部状态**，这就是它引发异常的原因。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-28T19:53:08.717

SelectedItems 的 Count 属性不是线程安全的，所以不能跨线程使用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-28T19:53:40.650

您正在尝试从主线程以外的线程写入控件。使用 Invoke 或 BeginInvoke。

```
void SetMax()
{
    if (prgAll.InvokeRequired)
    {
        prgAll.BeginInvoke(new MethodInvoker(SetMax));
        return;
    }

    prgAll.Maximum = lbFolders.SelectedItems.Count;
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-28T19:53:37.747

您不能从不是主 GUI 线程的线程中触摸 GUI 对象。有关更多详细信息和解决方案，请参见[此处](https://stackoverflow.com/questions/142003/cross-thread-operation-not-valid-control-accessed-from-a-thread-other-than-the)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-28T20:07:28.997

因为您在线程中创建了一个控件，并且您正试图从另一个线程中访问它。调用[InvokeRequired](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.invokerequired.aspx)属性，如下所示：

```
private void RunMe()
{
    if (!InvokeRequired)
    {
        myLabel.Text = "You pushed the button!";
    }
    else
    {
        Invoke(new ThreadStart(RunMe));
    }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-12-12T02:05:44.523

试试这个：

```
private delegate void xThreadCallBack();
private void ThreadCallBack()
{
    if (this.InvokeRequired)
    {
        this.BeginInvoke(new xThreadCallBack(ThreadCallBack));
    }
    else
    {
        //do what you want
    }
} 
```

不过，使用 lambda 表达式的答案就足够了。

# javascript - 在 HTML 中将 JSON/YAML 层次结构显示为树？

> ID：244601
> 
> 赞同：10
> 
> 时间：2008-10-28T19:51:34.693
> 
> 标签：javascript, html, json, treeview, yui

我有看起来像这样的 YAML 数据，但其中有大约 150k：

```
---
all:
  foo: 1025
  bar:
    baz: 37628
    quux:
      a: 179
      b: 7 
```

...或 JSON 中的相同内容：

```
{"all":{"bar":{"baz":"37628","quux":{"a":"179","b":"7"}},"foo":"1025"}} 
```

我想在可扩展的 JavaScripty HTML 树视图（示例：[1](http://developer.yahoo.com/yui/examples/treeview/default_tree.html)、[2](http://www.mattkruse.com/javascript/mktree/)）中呈现这些内容，以便于探索。我该怎么做呢？

我想我真正想弄清楚的是如何获取这些 YAML/JSON 数据，并自动将其显示为树（哈希键按字母顺序排序）。到目前为止，我一直在使用[YUI 的树视图](http://developer.yahoo.com/yui/treeview/)，但它不接受直接的 JSON，而且我尝试将数据转化为有用的东西似乎没有奏效。

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-29T16:11:46.180

您可以使用它将您的 JSON 数据转换为嵌套良好的 DIV。我还没有使用大量数据集对其进行测试，但它似乎有效。

```
function renderJSON(obj) {
    'use strict';
    var keys = [],
        retValue = "";
    for (var key in obj) {
        if (typeof obj[key] === 'object') {
            retValue += "<div class='tree'>" + key;
            retValue += renderJSON(obj[key]);
            retValue += "</div>";
        } else {
            retValue += "<div class='tree'>" + key + " = " + obj[key] + "</div>";
        }

        keys.push(key);
    }
    return retValue;
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-29T16:46:11.807

[基于简单的YAML](http://en.wikipedia.org/wiki/YAML)看起来很像[Markdown](http://en.wikipedia.org/wiki/Markdown)的事实，我终于用大约 5 行代码想出了一个超级优雅的方法。

我们从这个开始：

```
---
all:
  foo: 1025
  bar:
    baz: 37628
    quux:
      a: 179
      b: 7 
```

使用正则表达式（在这种情况下，在 Perl 中）删除开始`---`，并在每行的键之前放置连字符：

```
$data =~ s/^---\n//s;
$data =~ s/^(\s*)(\S.*)$/$1- $2/gm; 
```

瞧，降价：

```
- all:
  - foo: 1025
  - bar:
    - baz: 37628
    - quux:
      - a: 179
      - b: 7 
```

现在，只需通过 Markdown 处理器运行它：

```
use Text::Markdown qw( markdown );
print markdown($data); 
```

你会得到一个 HTML 列表——干净、语义化、向后兼容：

```
<ul>
    <li>all:
        <ul>
            <li>foo: 1025</li>
            <li>bar:</li>
            <li>baz: 37628</li>
            <li>quux:
                <ul>
                    <li>a: 179</li>
                    <li>b: 7</li>
                </ul>
            </li>
        </ul>
    </li>
</ul> 
```

[YUI Treeview](http://developer.yahoo.com/yui/treeview/)可以增强现有列表，因此我们将其全部包装起来：

```
<html>
<head>
    <!-- CSS + JS served via YUI hosting: developer.yahoo.com/yui/articles/hosting/ -->
    <link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/combo?2.6.0/build/treeview/assets/skins/sam/treeview.css">
    <script type="text/javascript" src="http://yui.yahooapis.com/combo?2.6.0/build/yahoo-dom-event/yahoo-dom-event.js&2.6.0/build/treeview/treeview-min.js"></script>
</head>
<body>
    <div id="markup" class="yui-skin-sam">
        <!-- start Markdown-generated list -->
        <ul>
            <li>all:
                <ul>
                    <li>foo: 1025</li>
                    <li>bar:</li>
                    <li>baz: 37628</li>
                    <li>quux:
                        <ul>
                            <li>a: 179</li>
                            <li>b: 7</li>
                        </ul>
                    </li>
                </ul>
            </li>
        </ul>
        <!-- end Markdown-generated list -->
    </div>
    <script type="text/javascript">
        var treeInit = function() {
            var tree = new YAHOO.widget.TreeView("markup");
            tree.render();
        };
        YAHOO.util.Event.onDOMReady(treeInit);
    </script>
</body>
</html> 
```

所以这一切都需要大约 5 行代码（将 YAML 转换为 Markdown，将 Markdown 转换为 HTML 列表，并将该 HTML 列表放在模板 HTML 文件中。生成的 HTML 是渐进增强/可降解的，因为它在非-JavaScript 浏览器作为一个普通的旧列表。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T22:27:23.660

YUI 的 TreeView 2.6 版现在确实接受了一个 JavaScript 对象，但不是这种格式，并且不会自动对其进行排序。您必须使用 YUI 的 JSON 实用程序将其转换为您必须遍历的实际 JavaScript。您的样本必须转换为以下内容：

```
{label:"all", children[
    {label:"bar", children:[
        {label:"baz: 37628"},
        {label:"quux", children[
            {label:"a: 179"},
            {label:"b: 7"}
        ]},
        {label:"foo: 1025"}
    ]}
]} 
```

我可能错过了一些逗号或其他东西。您的传入数据可能未排序，因此您必须对每个数组进行排序。然后，您只需将此对象作为第二个参数传递给 TreeView 构造函数，树就会出现。

# ruby-on-rails - 如何检索 ThinkingSphinx 搜索结果的相关值？

> ID：244605
> 
> 赞同：1
> 
> 时间：2008-10-28T19:52:04.677
> 
> 标签：ruby-on-rails, thinking-sphinx

有没有办法用 ThinkingSphinx 返回的数组检索相关值和结果？百分比，点数或其他什么，只是我可以使用的东西？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T13:32:22.180

是的 - 您可以遍历结果集，并检索每个的权重：

```
results = ThinkingSphinx::Search.search(params[:q])
results.each_with_weighting do |result, weight|
  puts "#{result.name} #{weight}"
end 
```

# java - 正在加载重复的弹簧配置？

> ID：244620
> 
> 赞同：1
> 
> 时间：2008-10-28T19:55:09.913
> 
> 标签：java, spring, tomcat

我正在查看由tomcat加载的spring的输出，并且有一些非常奇怪的东西......一切都是重复的。什么会导致这个？不管是什么，它都会导致我的应用程序以奇怪的方式运行。

**附加信息：**

该应用程序是一个网络应用程序。所有 spring 信息都使用 web.xml 文件中定义的上下文加载器（？）加载。我的配置文件分为 6 个（左右）文件。

示例调试输出：

> [DEBUG,DefaultFilterInvocationDefinitionSource,main] 添加 URL 模式：/ `**`；属性：[REQUIRES_SECURE_CHANNEL]
> 
> [DEBUG,DefaultFilterInvocationDefinitionSource,main] 添加 URL 模式：/ `**`；属性：[REQUIRES_SECURE_CHANNEL]
> 
> [DEBUG,DefaultFilterInvocationDefinitionSource,main] 添加 URL 模式：/ `**`；属性：[ROLE_READ，ROLE_UPDATE]
> 
> [DEBUG,DefaultFilterInvocationDefinitionSource,main] 添加 URL 模式：/ `**`；属性：[ROLE_READ，ROLE_UPDATE]
> 
> [DEBUG,AbstractFallbackMethodDefinitionSource,main] 添加安全方法 [CacheKey[com.service.impl.FooServiceImpl; public abstract java.lang.Boolean com.service.IFooService.saveOrUpdateFoo(com.model.Foo2,java.lang.String) throws org.springframework.dao.DataAccessException]] 带有属性 [[ROLE_UPDATE]]
> 
> [DEBUG,AbstractFallbackMethodDefinitionSource,main] 添加安全方法 [CacheKey[com.service.impl.FooServiceImpl; public abstract java.lang.Boolean com.service.IFooService.saveOrUpdateFoo(com.model.Foo2,java.lang.String) throws org.springframework.dao.DataAccessException]] 带有属性 [[ROLE_UPDATE]]
> 
> [INFO,AbstractSecurityInterceptor,main] 验证的配置属性
> 
> [INFO,AbstractSecurityInterceptor,main] 验证的配置属性

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T19:57:26.460

您确定日志配置中的某些内容没有将每个类别/记录器多次添加到附加程序中吗？

这对于 log4j 来说是可能的，不确定 JCL 或最新版本的 Tomcat 在封面下使用的任何内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-04T16:12:44.907

这里的答案和评论很可能是正确的。

将您的 log4j 配置作为更新/编辑发布到您的问题，然后我将修复作为更新/编辑发布到我的答案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-04T18:14:01.107

在 Tomcat 中，如果您的应用程序被配置为默认应用程序，则它必须部署在 /root 目录下。如果没有，那么 Tomcat 将启动您的应用程序的 2 个副本，一个是您放置它的位置，另一个是它期望的默认位置。

假设我正确地记得所有这些，这可以解释这里发生的事情。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-04-19T14:54:00.507

我和你遇到同样的问题，只是log4j配置问题，这是我原来的配置

```
<category name="org.springframework">
    <level value="INFO"></level>
    <appender-ref ref="basicAppender" />
</category> 
```

在此配置中，包 org.springframework 中的所有类都将记录一次，由于我没有将 additivity 属性设置为 false，记录器“org.springframework”将再次记录，结果所有日志都重复了。所以我只是将 additivity 属性设置为 false，它就可以工作了。嗯，这只是我的情况，希望对你有帮助。

# jquery - 为多个开发人员构建大型 Web 应用程序

> ID：244631
> 
> 赞同：3
> 
> 时间：2008-10-28T19:57:26.693
> 
> 标签：jquery, project-management

我有几个开发人员即将开始开发基于 jquery 的 Web 应用程序的前端。我们如何构建应用程序，以便多个开发人员可以同时在 ui 上工作。用户的最终结果将只是一个网页“页面”，但我并不是所有的客户端开发都发生在一个文件中。已经有另一个团队在后端工作。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-28T20:02:50.927

如果您完全从头开始，则可以将其分解为标准的 3 层架构。

让一个人处理数据库结构并为数据创建适当的访问库。

让一个人处理业务/工作流层，设置所有数据交互。

让第三个人使用 jQuery 完成所有前端工作。

我敢肯定，在此之后，冲突将最小化，并且每个都可以使用一些模拟数据/方法，直到官方资料上线。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T20:14:16.050

如果您要让多个人处理相同的文件，您的 SCM 应该能够为您管理。

但是，如果您想让事情变得更简单，您可以随时将您的 javascript 文件分解为多个部分，您可以动态地包含这些文件，或者在构建/部署阶段可以合并然后缩小。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T20:20:16.023

将目标页面标记的片段分解为服务器端包含或其他可组合片段，每个片段都包含在具有唯一 ID 的 DIV（或其他适当标记）中，然后为 CSS 样式和 jQuery 位添加单独的 CSS 和 JS 引用风格和动画每件。

虽然 CSS 规则会级联并且 jQuery 查询可能会发生冲突（因为它们是基于 CSS 选择器的），但仔细使用 ID 和类可以大大有助于在您的最终页面上创建粗略的“沙箱”，每个前端开发人员都可以在其中工作相对独立。

同时（或随着各个部分开始稳定），您可以投入一些精力来开发用于部署的集成策略，包括将单独的 CSS 和 JS 文件连接到单个资源中（尽可能）以及 gzip、压缩等。

由于固有的级联，您需要注意连接 CSS 文件的顺序，但是如果您通过将所有样式选择器限制在每个部分的给定 ID 标记内来很好地隔离它们，您应该美好的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-28T20:25:03.457

尝试为解决问题的面向对象的方法建模，以便一组开发人员可以在对象内部编写必要的功能，而其他开发人员则基于对象提供的功能进行构建。

**JavaScript 非常适合这种方法：基于约定对象接口的开发人员可以开发简单的模型原型，这些原型在编写真实**对象时将被丢弃。

当然，正如 jonnii 所说，您应该依靠一些 SCM 来管理对代码库的并发更改。即使任务是分开的，开发人员也可能需要更改其他人的代码。如果你在 Windows 下，我会推荐 git 或 SVN（因为它有 TortoiseSVN，如果你刚开始使用 SCM，这非常好）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-02T20:31:08.440

听起来您已经知道需要哪些开发人员处理产品的哪个部分，并且已经计划了工作负载以防止重叠。[诸如颠覆](http://subversion.tigris.org/)之类的东西将允许您跟踪谁在何时将哪个项目添加到了哪个文档中，以及撤消不需要的更改或合并以前覆盖的内容等等。它是免费的，并且可以挽救生命。:) HTH

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-02T20:47:18.387

我知道这可能不是一个选择，但这是 MVC 或 MVP 架构的亮点。它去除了您网站开发的“网页”方法，并转向强类型模型代码设计，使用“方法”来调用您想要的逻辑。换句话说，“物理页面”在 MVC 中不存在，只有对象上的方法。

（注意：我不是 Java 开发人员，实际上是 C#，但你可以理解）

网址：

```
 /products/532 
```

通过 Url 重写，它将是一个“网页”及其编译的“代码”，例如：

```
/products/showproduct.jsp?productid=532
/products/showproduct.java (code behind) 
```

但是对于 MVC 中的页面，它将是：

```
/Controllers/ProductController.java <- ProductController.ViewProduct(int id)
/Models/ViewModels/Product.java <- Product() class
/Views/Product/Index.html <- very simple display of html. 
```

ProductController 查找并获取 Product() 的 ViewModel，连接 Index 视图，替换要显示的任何变量，最后 ProductController 将完成的 html 返回给客户端。

这种方法将网页逻辑抽象为可以在源存储库中管理、版本化、合并、分支等的代码。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-08-29T13:48:50.480

我们最终在这个项目中使用了 Dojo (1.3)，因为它有一种用于编写模块化 javascript (dojo.require) 的机制，而我们在 jQuery 中找不到它的等价物。如今，有几个 AMD（异步模块定义）库，例如 RequireJS 或 curl.js，可以与 jQuery 一起使用。如果我现在开始这个项目（而不是 2008 年），我的问题的答案将涉及使用一些 AMD 库，可能还有一个 javascript mvc 框架。Dojo 仍然拥有所有这些，我们仍在使用它。

# git - 每次我做一个小改动时，Git 都认为我正在重写我的一个文件

> ID：244639
> 
> 赞同：9
> 
> 时间：2008-10-28T20:01:18.043
> 
> 标签：git, diff

我有一个中等大小的 Java 文件。每次我对我的一个文件 BuildTable.java 进行更改时，Git 都会将其报告为巨大的更改，即使只有一两行。BuildTable.java 大约有 200 行，而这次提交中的更改仅更改了一行。

git-diff 输出：

```
--- a/src/BuildTable.java
+++ b/src/BuildTable.java
@@ -1 +1 @@
-import java.io.FileNotFoundException;^Mimport java.io.FileReader;^Mimport java.io.InputStreamReader;^Mimport java.io.PushbackReader;^Mimport java.util.ArrayList;^Mimport
\ No newline at end of file
+import java.io.FileNotFoundException;^Mimport java.io.FileReader;^Mimport java.io.InputStreamReader;^Mimport java.io.PushbackReader;^Mimport java.util.ArrayList;^Mimport
\ No newline at end of file 
```

执行 git-commit -a 后

```
Created commit fe43985: better error notifications
 3 files changed, 54 insertions(+), 50 deletions(-)
 rewrite src/BuildTable.java (78%) 
```

Git 是否将此文件视为二进制文件或其他文件？这是一个问题吗？如果是，我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-10-28T20:24:15.283

显然，git 不喜欢你的 mac 风格的行尾（仅限 CR）。它的 diff 算法使用 LF 作为行分隔符。

修复您的文件以具有 windows 样式 (CR LF) 或 unix (仅 LF) 行结尾。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-10-30T19:17:00.143

为了解决这个问题，我不需要更改任何核心 git 设置，因为生成的默认行尾很好，只是这个特定文件被破坏了。为了修复它，我打开了 vim 并执行了以下命令

```
:%s/^M/\r/g 
```

请注意，要输入“^M”，您必须先输入 ctrl-V，然后再输入 ctrl-M。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-28T20:40:28.603

设置`core.autocrlf`和。`core.safecrlf`_ [`git-config`](http://git-scm.com/docs/git-config)这将导致 git 在从/向对象存储传输时自动转换行尾。您可能需要提交以存储“新”结尾。

从您粘贴的示例来看，您可能还患有“旧式 Mac 行尾”（感谢[ddaa](https://stackoverflow.com/users/11549/ddaa)和[Charles Bailey](https://stackoverflow.com/users/19563/charles-bailey)的提示），它们只是`CR`没有任何 s 的裸 s ，这是`LF`git 无法处理的情况。如果这是真的（使用十六进制编辑器检查），请使用类似[`recode`](http://linux.die.net/man/1/recode)将这些垃圾转换为某种 21 世纪格式的工具，例如正确的`LF`-only Unix 行尾。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-29T07:28:52.257

```
git diff -b 
```

向您显示差异时忽略行尾更改。

# c# - C# 从 BindingSource 刷新文本框

> ID：244640
> 
> 赞同：3
> 
> 时间：2008-10-28T20:01:19.183
> 
> 标签：c#, textbox, bindingsource

我在刷新使用 BindingSource 对象的 Windows 窗体控件时遇到了困难。我们有一个 CAB/MVP/SCSF 客户端，我（实际上是“我们”，因为它是一个团队的努力）正在开发它将与远程服务器上运行的 WCF 服务进行交互。（这是我们第一次尝试，所以我们处于学习模式）。对服务的调用之一（来自 Presenter）返回一个包含 3 个 DataTables 的 DataSet，名为“Contract”、“Loan”和“Terms”。每个表只包含一行。当服务返回数据集时，我们将其存储在 SmartPart/View 中的类成员变量中，方法是调用视图中名为 BindData() 的函数并将数据集从演示者类传递给视图；

```
private System.Data.DataSet _ds = null;
public void BindData(System.Data.DataSet ds)
{
    string sErr = "";
    try
    {
        _ds = ds;  // save to private member variable

        // more code goes down here
    }
} 
```

我们正在尝试将三个 DataTable 中的每一个绑定到各种 Windows 窗体 TextBox、MaskedEditBox 和 Infragistics UltraComboEditor Dropdown 组合框 我们使用 VS2008 IDE 创建了三个 BindingSource 对象，每个 DataTable 一个。

```
private System.Windows.Forms.BindingSource bindsrcContract;
private System.Windows.Forms.BindingSource bindsrcLoan;
private System.Windows.Forms.BindingSource bindsrcTerms; 
```

我们正在绑定这样的值

```
if (bindsrcContract.DataSource == null)
{
    bindsrcContract.DataSource = _ds;
    bindsrcContract.DataMember = “contract”;

    txtContract.DataBindings.Add(new Binding("Text", bindsrcContract, "contract_id", true));                       

    txtLateFeeAmt.DataBindings.Add(new Binding("Text", bindsrcContract, "fee_code", true));

    txtPrePayPenalty.DataBindings.Add(new Binding("Text", bindsrcContract, "prepay_penalty", true));

    txtLateFeeDays.DataBindings.Add(new Binding("Text", bindsrcContract, "late_days", true));
}

if (bindsrcLoan.DataSource == null)
{
    bindsrcLoan.DataSource = _ds;
    bindsrcLoan.DataMember = “loan”;

    mskRecvDate.DataBindings.Add(new Binding("Text", bindsrcLoan, "receive_date", true));

    cmboDocsRcvd.DataBindings.Add(new Binding("Value", bindsrcLoan, "docs", true));     
} 
```

当我们第一次从服务中读取数据并取回数据集时，这很有效。信息显示在表单的控件上，我们可以使用表单对其进行更新，然后通过将更改后的值传递回 WCF 服务来“保存”它。

这是我们的问题。如果我们选择一个不同的贷款密钥并对服务进行相同的调用并获得一个新的数据集，同样有 3 个表，每个表有一行，控件（文本框、屏蔽编辑框等）不会使用新信息更新. 请注意，smartPart/View 没有关闭或关闭，而是在调用服务之间保持加载。在第二次调用中，我们没有重新绑定调用，而只是尝试从更新的 DataSet 中刷新数据。

我们已经尝试了我们能想到的一切，但显然我们缺少了一些东西。这是我们第一次尝试使用 BindingSource 控件。我们已经尝试过

```
bindsrcContract.ResetBindings(false); 
```

和

```
bindsrcContract.ResetBindings(true); 
```

和

```
bindsrcContract.RaiseListChangedEvents = true; 
```

和

```
for (int i = 0; i < bindsrcContract.Count; i++)
{
    bindsrcContract.ResetItem(i);
} 
```

以及再次重置 DataMember 属性。

```
bindsrcContract.DataMember = ”Contract”; 
```

我们看过很多例子。许多示例都引用了 BindingNavigator，但由于 DataTables 只有一行，我们认为我们不需要它。有很多关于网格的示例，但我们在这里没有使用一个。任何人都可以指出我们哪里出错了，或者指出我们可以提供更多信息的资源吗？

我们使用 VisualStudio 2008、C# 和 .Net 2.0、XP 客户端、W2K3 服务器。

提前致谢

韦斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-01-19T21:21:37.523

我今天遇到了类似的问题，发现这行得通。

```
private void btnCancel_Click(object sender, EventArgs e)
{
    this.MyTable.RejectChanges();
    this.txtMyBoundTextBox.DataBindings[0].ReadValue();
    this.EditState = EditStates.NotEditting;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-05T15:23:55.053

*第一件事：这篇文章需要一些组织。请记住，答案不是按顺序排列的。顺序由投票决定。*

*因此，如果您还有其他问题，只需修改您的原始问题（用“编辑”标记以避免混淆）。*

*支持您认为有用的答案。*

*哦，顺便说一下，在包含代码示例时，请使用代码示例按钮（在编辑窗口上方）。这将为您提供良好的代码格式，包括语法突出显示。*

现在开始讨论：这两个问题的根本问题是 Binding-Manager 保留了指向原始对象的链接。

当您将 _ds 指定为 DataSource 时，Binding-Manager 会分析 DataSet 并采取相应措施。如果您将一些其他 DataSet 分配给 _ds，则 Binding-Manager 无法知道这一点。它仍然具有对原始数据集对象的引用。所以这就解释了为什么必须将 DataSource 属性重置为新的 DataSet。

它还解释了为什么删除和添加表格不会导致您的预期结果。同样，Binding-Manager 保存对旧表（或该表中的第一行）的引用。新表永远不会被绑定。同样在这种情况下，重新分配 _ds 也无济于事，因为 _ds 指向与以前相同的 DataSet 对象。Binding-Manager 足够聪明，可以注意到它是同一个对象并且不执行重新绑定操作。

您要么必须修改绑定对象的内容（它会触发 Binding-Manager 订阅的 PropertyChanged-Event），要么必须通过将不同的对象分配给 DataSource-property 来触发完整的重新绑定。

这是对实际情况的简化描述，但我希望它足以解释和解决您的问题。不幸的是，我还没有在网络上（或其他地方）找到关于 WinForms 数据绑定的全面解释。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T20:29:06.880

Wes, I'm very glad I could help. I still remember an issue very similar to yours taking me weeks to figure out in the wild...

Regarding your questions, here's all I know:

1.  If you set the DataSource first, then the DataMember, your data source will be scanned twice, since setting the DataMember subsequently changes the existing (valid) binding. If you do it the other way around, setting DataMember first (with DataSource being null or better, typeof(YourData)), binding only takes place once when you set the DataSource.

2.  I think you can apply the same solution here. Instead of just

    ```
    bindsrcContract.DataSource = _ds; 
    ```

    in your last line, you should write

    ```
    bindsrcContract.DataSource = typeof(System.Data.DataSet);
    bindsrcContract.DataSource = _ds; 
    ```

3.  Sorry to disappoint, but I learned all I know about data binding from MSDN as well as trial-and-error. It was quite painful. Hopefully someone else can chime in with a useful link or two.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-05-02T20:13:34.587

尝试组合：

```
bindingsource.EndEdit() // writting data to underlying source 
bindingSource.ResetBindings(false)  // force controls to reread data from bindingSource 
```

每当您向控件写入内容时使用它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-28T21:44:58.693

如果其他一切都失败了，您可以在每次收到新数据集时重新分配 DataSource，执行以下操作：

```
bindsrcContract.DataSource = typeof(System.Data.DataSet);
bindsrcContract.DataSource = _ds; 
```

（另外，先初始化 DataMember 再初始化 DataSource 会给你更好的性能。）

# c++ - 在 Qt 中获取经过的时间

> ID：244646
> 
> 赞同：78
> 
> 时间：2008-10-28T20:02:38.180
> 
> 标签：c++, qt

我正在寻找 Qt 中的等价物`GetTickCount()`

可以让我测量一段代码运行所需的时间，如下所示：

```
uint start = GetTickCount();
// do something..
uint timeItTook = GetTickCount() - start; 
```

有什么建议么？

* * *

## 回答 #1

> 赞同：134
> 
> 时间：2010-12-07T21:23:27.853

我认为使用它可能会更好，[`QElapsedTimer`](http://doc.qt.io/qt-5/qelapsedtimer.html)因为这就是该类首先存在的原因。它是在 Qt 4.7 中引入的。请注意，它也不受系统时钟时间变化的影响。

示例用法：

```
#include <QDebug>
#include <QElapsedTimer>
...
...
QElapsedTimer timer;
timer.start();
slowOperation();  // we want to measure the time of this slowOperation()
qDebug() << timer.elapsed(); 
```

* * *

## 回答 #2

> 赞同：96
> 
> 时间：2008-10-28T20:13:42.013

怎么样[`QTime`](http://doc.qt.io/qt-5/qtime.html)？根据您的平台，它应该具有 1 毫秒的精度。代码看起来像这样：

```
QTime myTimer;
myTimer.start();
// do something..
int nMilliseconds = myTimer.elapsed(); 
```

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2012-10-21T23:31:57.483

即使第一个答案被接受，其他阅读答案的人也应该考虑`sivabudh`的建议。
[`QElapsedTimer`](http://doc.qt.io/qt-5/qelapsedtimer.html)也可以用来计算以纳秒为单位的时间。
代码示例：

```
QElapsedTimer timer;
qint64 nanoSec;
timer.start();
//something happens here
nanoSec = timer.nsecsElapsed();
//printing the result(nanoSec)
//something else happening here
timer.restart();
//some other operation
nanoSec = timer.nsecsElapsed(); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2016-07-29T05:46:23.300

扩展之前的答案，这是一个可以为您完成所有工作的宏。

```
#include <QDebug>
#include <QElapsedTimer>
#define CONCAT_(x,y) x##y
#define CONCAT(x,y) CONCAT_(x,y)

#define CHECKTIME(x)  \
    QElapsedTimer CONCAT(sb_, __LINE__); \
    CONCAT(sb_, __LINE__).start(); \
    x \
    qDebug() << __FUNCTION__ << ":" << __LINE__ << " Elapsed time: " <<  CONCAT(sb_, __LINE__).elapsed() << " ms."; 
```

然后你可以简单地使用：

```
CHECKTIME(
    // any code
    for (int i=0; i<1000; i++)
    {
       timeConsumingFunc();
    }
) 
```

输出：

> onSpeedChanged：102 经过时间：2 毫秒。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-03-31T21:08:06.267

如果你想使用[`QElapsedTimer`](http://doc.qt.io/qt-5/qelapsedtimer.html)，你应该考虑这个类的开销。

例如，以下代码在我的机器上运行：

```
static qint64 time = 0;
static int count = 0;
QElapsedTimer et;
et.start();
time += et.nsecsElapsed();
if (++count % 10000 == 0)
    qDebug() << "timing:" << (time / count) << "ns/call"; 
```

给我这个输出：

```
timing: 90 ns/call 
timing: 89 ns/call 
... 
```

您应该自己衡量这一点，并尊重您的时间开销。

# objective-c - 如何获得objective-c中的“反向”切线？

> ID：244647
> 
> 赞同：6
> 
> 时间：2008-10-28T20:02:40.350
> 
> 标签：objective-c, math

我知道这`tan(angle)`让我切线。但是我该如何做“反切线”，以便在给定直角三角形两边长度的情况下获得角度？

我假设有一种方法可以解决这个问题`math.h`？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-28T20:14:08.843

正如其他人所提到的， atan() 是您正在寻找的。通常，该运算被称为“反正切”或“反正切”，而不是“反正切”。“atan”这个名字来源于“反正切”。还有一个 atan2() 函数，它将 X 和 Y 坐标作为单独的参数，并为您提供相对于 0 标记的角度，而 atan() 将把计算象限作为开发人员的练习。但是请注意，某些较旧的 MS 环境（或者可能是 Visual Studio 库？）上的 atan2() 函数不能正常工作......

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-28T20:05:29.207

应该有一个 atan() 函数。

例如：[http ://www.acm.uiuc.edu/webmonkeys/book/c_guide/2.7.html](http://www.acm.uiuc.edu/webmonkeys/book/c_guide/2.7.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T20:06:13.167

使用 atan()

# tsql - 如何使用 tsql 删除 smallmoney 中的两位数？

> ID：244663
> 
> 赞同：0
> 
> 时间：2008-10-28T20:09:29.960
> 
> 标签：tsql

符号。我的 tsql 功夫很烂。我有一笔小额费用。当我从 MS Access 导出为 SQL 时，代表费用的列存储为文本，例如 $3.28 存储为“00000328”。当我将它导入 MS SQLServer 时，我将数据类型更改为 smallmoney，但它存储为 328。如何使该列上的所有值移动“。” 左边两位数。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T20:13:52.807

除以 100

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T20:31:39.403

如果我理解正确，这应该可以解决问题。不过，只运行一次。将“table”替换为您的表格名称，将“fee”替换为您的列名。

```
update table
set fee = fee / 100.0 
```

# html - 需要设置颜色

> ID：244665
> 
> 赞同：2
> 
> 时间：2008-10-28T20:10:34.203
> 
> 标签：html, css

这是用于设置链接的 h1 文本颜色的 css：

```
.nav-left h1 a,
a:visited {
  color: #055830;
}
```

```
<div class="nav-left">
  <h1><a href="/index.php/housing/">Housing</a></h1>
</div>
```

它看起来工作不正常，任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-28T20:11:35.557

关于什么：

```
.nav-left h1 a:visited{
    color:#055830;
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-28T21:29:06.213

如果您希望未访问链接的颜色相同，则还需要为此添加特定的选择器

```
.nav-left h1 a:link, .nav-left h1 a:visited {
    color:#055830;
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-28T20:16:13.503

如果您希望它们相同，则必须具体：

.nav-left h1 a, a:visited

不一样：

.nav-left h1 a, **.nav-left h1 a** :visited

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-28T20:14:03.773

```
.nav-left h1 a {
    color: #055830;
} 
```

如果它是相同的颜色，则不需要添加：已访问。

# sql - Oracle 中的 UPDATE 语句使用 SQL 或 PL/SQL 仅更新第一个重复行

> ID：244671
> 
> 赞同：11
> 
> 时间：2008-10-28T20:12:14.683
> 
> 标签：sql, oracle, plsql, sql-update

我正在寻找一个 UPDATE 语句，它将仅更新单个重复行并保持其余（重复行）不变，使用 ROWID 或其他东西或其他元素在 Oracle SQL 或 PL/SQL 中使用？

这是一个可以使用的示例 duptest 表：

```
CREATE TABLE duptest (ID VARCHAR2(5), NONID VARCHAR2(5)); 
```

*   运行一个`INSERT INTO duptest VALUES('1','a');`

*   运行四 (4) 次`INSERT INTO duptest VALUES('2','b');`

此外，必须始终更新（而不是删除）第一个重复行，而其他三 (3) 行必须保持原样！

非常感谢，瓦尔。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-28T20:33:09.990

这对你有用吗：

```
update duptest 
set nonid = 'c'
WHERE ROWID IN (SELECT   MIN (ROWID)
                              FROM duptest 
                          GROUP BY id, nonid) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T04:10:43.820

```
UPDATE  duptest 
SET     nonid = 'c' 
WHERE   nonid = 'b' 
    AND rowid = (SELECT min(rowid) 
                 FROM   duptest 
                 WHERE nonid = 'b'); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T20:45:50.060

这对我有用，即使是重复运行。

```
--third, update the one row
UPDATE DUPTEST DT
SET DT.NONID = 'c'
WHERE (DT.ID,DT.ROWID) IN(
                         --second, find the row id of the first dup
                         SELECT 
                           DT.ID
                          ,MIN(DT.ROWID) AS FIRST_ROW_ID
                         FROM DUPTEST DT
                         WHERE ID IN(
                                    --first, find the dups
                                    SELECT ID
                                    FROM DUPTEST
                                    GROUP BY ID
                                    HAVING COUNT(*) > 1
                                    )
                         GROUP BY
                           DT.ID
                         ) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-28T21:01:09.623

我认为这应该有效。

```
UPDATE DUPTEST SET NONID = 'C'
WHERE ROWID in (
    Select ROWID from (
        SELECT ROWID, Row_Number() over (Partition By ID, NONID order by ID) rn
    ) WHERE rn = 1
) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T06:36:08.963

我知道这并不能回答您最初的问题，但是您的桌子上没有钥匙，您解决特定行的问题由此产生。

所以我的建议 - 如果特定应用程序允许的话 - 将在您的表中添加一个键列（例如 REAL_ID 作为 INTEGER）。

然后你可以找出重复项的最低 id

```
select min (real_id) 
from duptest
group by (id, nonid) 
```

并仅更新这些行：

```
update duptest
set nonid = 'C'
where real_id in (<select from above>) 
```

我确信更新语句可以进行一些调整，但我希望它能够说明这个想法。

优点是“更干净”的设计（您的 id 列并不是真正的 id），以及比依赖于 DB 特定版本的 rowid 更便携的解决方案。

# language-agnostic - for循环中的case（或switch）还是case（或switch）中的for循环？

> ID：244677
> 
> 赞同：0
> 
> 时间：2008-10-28T20:13:50.700
> 
> 标签：language-agnostic, coding-style, performance

一般情况下是否可以知道在 for 循环中放置一个案例是否会导致组装不良。我主要对 Delphi 感兴趣，但从风格和性能方面来看，这是一个有趣的编程问题。

这是我的密码！

```
  case ResultList.CompareType of
  文本比较类型：
    开始
      LastGoodIndex := -1;
      对于 I := 1 到 ResultList.Count -1 做
      if (LastGoodIndex = -1) and (not ResultList[I].Indeterminate) then
        LastGoodIndex := 我
      else if not ResultList[I].Indeterminate then
      开始
        if (StrComp(ResultList[LastGoodIndex].ResultAsText,
                     结果列表[I].ResultAsText) > 0)
            和 (Result FalseEval) 然后
          结果：= TrueEval
        别的
          结果 := FalseEval;

        LastGoodIndex := 我;
      结尾;
    结尾;
  结尾;
  数值比较类型：
  开始
    //同上，只是数值比较
  结尾;
  日期比较类型：
  开始
    //同上，日期比较
  结尾;
  布尔比较类型：
  开始
    //同上，布尔比较
  结尾;

```

或者我可以写

```
    开始
      LastGoodIndex := -1;
      对于 I := 1 到 ResultList.Count -1 做
      if (LastGoodIndex = -1) and (not ResultList[I].Indeterminate) then
        LastGoodIndex := 我
      else if not ResultList[I].Indeterminate then
      开始
      case ResultList.CompareType of
      文本比较类型：
      开始
         if (StrComp(ResultList[LastGoodIndex].ResultAsText,
                     结果列表[I].ResultAsText) > 0)
            和 (Result FalseEval) 然后
           结果：= TrueEval
         别的
           结果 := FalseEval;
         LastGoodIndex := 我;
      结尾;
      数值比较类型：
      开始
       //同上，只是数值比较
      结尾;
      日期比较类型：
      开始
       //同上，日期比较
      结尾;
     布尔比较类型：
     开始
       //同上，布尔比较
     结尾;

   结尾;
  结尾;
 结尾;

```

我不喜欢第二种方式，因为我在 for 循环中问一个我知道答案的问题，我不喜欢第一种方式，因为我在重复我用来确定哪些对象包含的代码有效信息。

也许有人可以建议一种设计模式可以一起规避这一切。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T20:33:58.650

一般来说，没有办法知道对于特定的编程语言结构会生成什么样的汇编语言输出。每个编译器都是不同的。即使对于特定的编译器，每个应用程序都会有所不同，并且编译器将有不同的优化策略可供使用。

如果你真的很担心，最简单的做法是编译程序并查看它生成的内容。玩弄代码和优化设置，直到它看起来像你想要的那样。（或者手写汇编。）

常见的建议是尽可能编写最清晰的代码，除非你真的需要，否则不要担心调整性能。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T20:15:48.590

为什么不使用子类？

这节省了case语句的使用。

```
TComparer = class 
protected
  function Compare(const AItem1, AItem2: TItem): Boolean; virtual; abstract;
public
  procedure DoCompare(ResultList: ...);
end;

TTextComparer = class (TComparer)
protected
  function Compare(const AItem1, AItem2: TItem): Boolean; override;
end;

procedure TComparer.DoCompare(ResultList: ...);
var
  LastGoodIndex, I : Integer;
begin 
  LastGoodIndex := -1;
  for I := 1 to ResultList.Count -1 do
  if (LastGoodIndex = -1) and (not ResultList[I].Indeterminate) then
    LastGoodIndex := I
  else if not ResultList[I].Indeterminate then begin
    if Compare(ResultList[LastGoodIndex], ResultList[I]) then
      Result := TrueEval
    else 
      Result := FalseEval;
  end;
end;

function TTextComparer.Compare(const AItem1, AItem2: TItem): Boolean; 
begin
  Result := StrComp(ResultList[LastGoodIndex].ResultAsText,
    ResultList[I].ResultAsText) > 0)    
end; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T20:31:53.927

我怀疑使用 lambda 或闭包甚至只是函数引用会更有效。我的 Pascal 生锈了，所以我的例子是 perl：

```
my %type = (
            TextCompareType => sub { $_[0] lt $_[1] },
            NumericCompareType => sub { $_[0] < $_[1] },
            DateCompareType => sub { ... },
            BooleanCompareType => sub { ... },
           );

for (my $i = 1; $i <= $#list; ++$i)
{
    if ( $type{$ResultList{CompareType}}->($list[$i-1], $list[$i]) )
    {
        $result = 1; # ?
    }
} 
```

我并没有真正遵循您的大部分代码，但我认为我已经抓住了问题的本质，而没有完全捕获代码。

另一种解决方案是创建比较器对象作为基比较器类的子类，然后调用对象的比较函数，但您确实提到尝试保持结构化而不是 OO。

# c - C 变量声明中的括号是什么意思？

> ID：244680
> 
> 赞同：39
> 
> 时间：2008-10-28T20:14:00.593
> 
> 标签：c, syntax

有人可以解释这是什么意思吗？

```
int (*data[2])[2]; 
```

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-10-28T20:17:36.903

**括号是干什么用的？**

在 C 括号中 [] 的优先级高于星号 *

**来自维基百科的很好的解释：**

> 要将变量声明为指向数组的指针，我们必须使用括号。这是因为在 C 括号中 ([]) 的优先级高于星号 (*)。因此，如果我们希望声明一个指向数组的指针，我们需要提供括号来覆盖它：

```
double (*elephant)[20]; 
```

> 这声明了大象是一个指针，它指向的类型是一个包含 20 个双精度值的数组。
> 
> 要声明指向指针数组的指针，只需组合符号即可。

```
int *(*crocodile)[15]; 
```

[来源](http://en.wikipedia.org/wiki/C_variable_types_and_declarations)。

**而你的实际情况：**

```
int (*data[2])[5]; 
```

data 是一个包含 2 个元素的数组。每个元素都包含一个指向 5 个整数数组的指针。

所以你可以在代码中使用你的“数据”类型：

```
int (*data[2])[5];
int x1[5];
data[0] = &x1;
data[1] = &x1;

data[2] = &x1;//<--- out of bounds, crash data has no 3rd element
int y1[10];
data[0] = &y1;//<--- compiling error, each element of data must point to an int[5] not an int[10] 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-10-28T20:22:32.057

有一个非常酷的程序，叫做“cdecl”，你可以下载它用于 Linux/Unix，也可能用于 Windows。您粘贴 C（或 C++，如果您使用 c++decl）变量声明，它会用简单的单词拼写出来。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-29T03:21:28.310

如果您知道如何阅读C 中的*表达式*，那么您离阅读复杂的声明只有一步之遥。

做什么

```
char *p; 
```

真正的意义？这意味着这`*p`是一个字符。做什么

```
int (*data[2])[5]; 
```

意思是？这意味着这`(*data[x])[y]`是一个 int（提供 0 <= x < 2 和 0 <= y < 5）。现在，想想这意味着什么。`data`必须是......一个由 2 个......指针组成的数组......指向 5 个......整数的数组。

你不觉得这很优雅吗？您所做的只是说明表达式的类型。一旦你掌握了这一点，声明就再也不会吓到你了！

“快速规则”是从变量名开始，向右扫描直到你点击a），回到变量名向左扫描直到你点击a（。然后“跳出”这对括号，并重复该过程。

让我们把它应用到一些荒谬的事情上：

```
void **(*(*weird)[6])(char, int); 
```

`weird`是一个指向由 6 个函数组成的数组的指针，每个函数接受一个 char 和一个 int 作为参数，每个函数返回一个指向 void 指针的指针。

既然你知道它是什么以及它是如何完成的......*不*要这样做。使用 typedef 将您的声明分解为更易于管理的块。例如

```
typedef void **(*sillyFunction)(char, int);

sillyFunction (*weird)[6]; 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-28T21:30:22.560

data[2] - 两个整数的数组

*data[2] - 指向两个整数数组的指针

(*数据[2]) - "

(*data[2])[2] - 一个由 2 个指针组成的数组，指向两个整数数组。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2014-03-12T19:31:29.063

如果你有一个数组：

```
int myArray[5];
int * myArrayPtr = myArray; 
```

将是完全合理的。`myArray`没有方括号的是指向`int`. 当您添加括号时，就像您尊重指针一样`myArray`。你可以写...

```
myArrayPtr[1] = 3; 
```

这是完全合理的。使用括号只会使事情更难阅读和理解 IMO。它们表明人们不理解指针、数组和指针算术，这是编译器或链接器从一个到另一个的方式。似乎带括号的你确实得到了边界检查。

# git - 如何将来自两个不同存储库的两个分支合并到一个存储库中？

> ID：244695
> 
> 赞同：48
> 
> 时间：2008-10-28T20:18:36.510
> 
> 标签：git

我的 Git 存储库的结构如下所示：

```
A-B-C-D-E-F   # master branch in separate repo1
A-B-C-D-E-G-H # master branch in separate repo2 
```

AH 是简单的提交。如您所见，存储库是相关的（repo2 是 repo1 的一个分支）。我正在尝试将这两个存储库合二为一。

之后，单个存储库应具有以下结构：

```
A-B-C-D-E-F   # master branch of previous repo1
        \
         \
          G-H # master branch of previous repo2 
```

我已经花了很多时间阅读 Git 用户指南等。但是，这种（特殊）使用案例似乎没有在任何地方记录。

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2008-10-28T23:18:09.283

您可以将同一文件系统上的另一个 git 存储库视为远程存储库。

首先，执行以下操作：

```
git remote add <name> /path/to/other/repo/.git
git fetch <name>
git branch <name> <name>/master #optional 
```

现在它们都是单个存储库中的分支。您可以使用 git checkout 在它们之间进行切换，使用 git merge 进行合并等。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-28T20:23:20.200

您的图片表明您并不想“合并两个存储库”，而是将提交 G 和 H 合并到 repo1。您应该能够做一些简单的事情，例如将 repo2 作为远程添加到 repo1 并获取/提取更改。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-28T20:33:40.973

我认为吉姆是对的。还要记住，如果两个提交对代码执行完全相同的补丁/差异，它们将具有完全相同的 SHA1 哈希。所以 A 到 E 在两个 repos 中应该有相同的 SHA1，所以从一个到另一个合并应该不是问题，并将合并的 repo 作为唯一的 repo 继续前进。

您可以在 repo1 上为 repo2 设置一个跟踪分支，然后以这种方式保持它们的区别，并将合并延迟到您想要的任何时候。

# jquery - YUI 有像 jQuery 那样的选择器吗？

> ID：244699
> 
> 赞同：5
> 
> 时间：2008-10-28T20:19:11.423
> 
> 标签：jquery, ajax, yui

`YUI`有像 jQuery 这样的选择器方法吗？

例如，让我得到所有其中有链接`children`的div `<table>`？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-28T20:47:49.573

[YUI 3](http://developer.yahoo.com/yui/3/)（目前处于预览版）具有明确的类似 JQuery 的选择器：

```
Y.all('.foo').set('title', 'Go!').removeClass('off'); 
```

看一眼：

*   [http://developer.yahoo.com/yui/3/](http://developer.yahoo.com/yui/3/)
*   [http://developer.yahoo.com/yui/3/examples/node/nodelist.html](http://developer.yahoo.com/yui/3/examples/node/nodelist.html)
*   [http://yuiblog.com/blog/2008/08/13/yui3pr1/](http://yuiblog.com/blog/2008/08/13/yui3pr1/)

[在我正在开发的网站OffsetConsumer.org](http://www.offsetconsumer.org/)上使用 YUI 3 Preview Release 1 取得了不错的效果；下一个 YUI 3 预览版计划在 11 月发布。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-28T20:34:31.330

检查[YUI Selector Utility](http://developer.yahoo.com/yui/selector/)，它为您提供[CSS3](http://www.w3.org/TR/css3-selectors/)选择器 sintax，它仍处于测试阶段但运行良好，请查看以下示例：[YAHOO.util.Selector.query](http://developer.yahoo.com/yui/examples/selector/query.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-11-24T09:24:35.353

YUI 从版本 2 (http://developer.yahoo.com/yui/selector/) 开始就有选择器实用程序，但它在 YUI 2 中并不流行，因为大多数模块代码都是在选择器引入 YUI2 之前编写的。

# oop - 学习/实施设计模式（针对新手）

> ID：244706
> 
> 赞同：86
> 
> 时间：2008-10-28T20:22:36.033
> 
> 标签：oop, design-patterns

我是一个困惑的新手和业余程序员，试图掌握这一点，所以如果我的问题有点偏离或没有多大意义，请原谅我。

我看到很多关于 SO 的问题都围绕着设计模式的使用，我想知道是否有人有很好的资源来学习和实现设计模式？我了解总体思路，并且知道如何/何时使用其中的几个（单例、工厂方法），但我知道我错过了。

（以防万一，我的首选语言是 C#，但我可以从其他语言的示例中学习）

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2008-10-28T20:24:10.820

[头部优先设计模式](http://books.google.com/books?id=LjJcCnNf92kC&dq=head+first+design+patterns&pg=PP1&ots=_9_-4Ck6wX&source=bn&sig=7ccZxDrVEEsIq-s9D3hhJTx1I4U&hl=en&sa=X&oi=book_result&resnum=7&ct=result)

![替代文字](https://books.google.com/books?id=LjJcCnNf92kC&printsec=frontcover&img=1&zoom=5&sig=ACfU3U2zTrz6j7A_bNf3bNHL2Ay7mvZstg)

和[设计模式维基百科页面](http://en.wikipedia.org/wiki/Software_design_pattern)是初学者的最佳资源。 [FluffyCat](http://www.fluffycat.com/)是另一个很好的免费在线资源，用于[Java](http://www.fluffycat.com/Java-Design-Patterns/)和[PHP](http://www.fluffycat.com/PHP-Design-Patterns/)的设计模式。

《[四人帮》这本书](https://rads.stackoverflow.com/amzn/click/com/0201633612)是后来的去处，但它相当先进，所以我会等到你从其他资源中牢牢掌握。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-10-28T21:17:15.270

设计模式之所以很棒有多种原因：

1.  为您解决常见问题提供了一个起点。
2.  为开发人员提供了一个词汇来以非常紧凑的方式谈论解决问题的某些方法。
3.  当与了解设计模式的开发人员合作并且您在解决方案中使用设计模式时，他们会更快地理解解决方案。

但是，当您的目标只是学习设计模式时，我认为您缺少基础知识。所有设计模式都基于更常见的原则。高内聚、低耦合开闭原则、DRY、Liskov 替换原则等。对于这些基本原理，我将按此顺序阅读以下书籍：

1.  [Head First 面向对象分析和设计（Head First）[插图]（平装本）](https://rads.stackoverflow.com/amzn/click/com/0596008678)
2.  [应用 UML 和模式（精装本）](https://rads.stackoverflow.com/amzn/click/com/0137488807)
3.  [C# 中的敏捷原则、模式和实践（Robert C. Martin 系列）（精装本）](https://rads.stackoverflow.com/amzn/click/com/0131857258)

之后，您就可以开始使用四种设计模式的基本组合了

4.  [Head First 设计模式（Head First）[插图]（平装本）](https://rads.stackoverflow.com/amzn/click/com/0596007124)
5.  [圣经](https://rads.stackoverflow.com/amzn/click/com/0201633612)
6.  一个不错的网站（什么都不买，不值得）[http://dofactory.com/Patterns/Patterns.aspx](http://dofactory.com/Patterns/Patterns.aspx)（这个网站的一些实现值得讨论

下一步：

7.  [企业应用架构模式（Addison-Wesley 签名系列）（精装）](https://rads.stackoverflow.com/amzn/click/com/0321127420)
8.  [POSA 书籍](http://www.amazon.com/s/ref=nb_ss_b?url=search-alias%3Dstripbooks&field-keywords=POSA&x=0&y=0)

永远记住：模式不是目标！

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-10-28T20:26:22.657

我要补充的是，“四人帮”中的[设计模式书对于任何对设计模式非常感兴趣的人来说都是一本圣经。](https://rads.stackoverflow.com/amzn/click/com/0201633612)

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-10-28T20:30:24.367

我的提示：

阅读大量来自不同来源的模式。

尝试将尽可能多的模式强制到您正在编写的所有代码中，因为这一点不会产生好的结果。相反，让信息在你的大脑中停留一段时间（阅读：几个月）。

突然间，您会发现自己遇到了一个问题或一段代码，并且您会模糊地记得您已经看到了一些可以解决这个特定问题的方法。现在是时候查看您正在考虑的模式的详细信息并尝试应用它了。

无论如何，这对我有用。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-09-01T09:08:29.030

## **[Design Patterns](http://sourcemaking.com/design_patterns)**

This tutorial site contains following sub-sections

*   **Intent** of each design pattern
*   **Real World Structure** for the design pattern
*   A **Problem statement**
*   Detailed discussion on the problem
*   **Checklist** on how to arrive at a pattern
*   **Rules of thumb** while arriving at pattern.
*   **Code snippets** for the design pattern which includes **C#, C++, Delphi, Java and PHP**

This site also contains guide on **Anti Patterns**, **UML** and **Refactoring**.

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-10-28T20:30:35.223

Bruce Eckel 有一[本关于设计模式](http://mindview.net/Books/TIPatterns/)的书，虽然是 Java，但它就像他所有的书一样令人惊叹。最好的是，它们是免费的！

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-10-28T20:34:45.510

[C# 3.0 Design Patterns](http://oreilly.com/catalog/9780596527730/)用于 C# 设计模式的观点。

[![替代文字](https://i.stack.imgur.com/lHz6P.gif)](https://i.stack.imgur.com/lHz6P.gif)
[（来源：[oreilly.com](http://oreilly.com/catalog/covers/9780596527730_cat.gif)）]

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-10-29T00:09:30.930

Alan Shalloway 和 James Trott (Addison Wesley)所著的[《Design Patterns Explained](https://rads.stackoverflow.com/amzn/click/com/0321247140)》是一本我觉得很有用且写得很好的入门书 。

![替代文字](https://i.stack.imgur.com/ICYaY.jpg)

不要从《[四人帮》](https://rads.stackoverflow.com/amzn/click/com/0201633612)这本书开始，因为它无论如何都不是一本入门书*。*

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-10-29T12:51:41.233

我建议看一下 Jean Paul Boodhoo 的关于 DNRtv 上的 Demystifying Design Patterns 的 quintology (?)，网址如下。视频内容涉及 Singleton、Abstract Factory 等 - 不同之处在于您可以在他讨论理论时观看他的代码。很高兴在下雨的工作日观看午餐。

[http://www.dnrtv.com/default.aspx?showNum=63](http://www.dnrtv.com/default.aspx?showNum=63) [http://www.dnrtv.com/default.aspx?showNum=65](http://www.dnrtv.com/default.aspx?showNum=65) [http://www.dnrtv.com/default.aspx?showNum= 68](http://www.dnrtv.com/default.aspx?showNum=68) [http://www.dnrtv.com/default.aspx?showNum=71](http://www.dnrtv.com/default.aspx?showNum=71) [http://www.dnrtv.com/default.aspx?showNum=92](http://www.dnrtv.com/default.aspx?showNum=92)

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-12-15T07:34:51.750

对上述评论的注释。

**GOF 模式快速参考**

[这是您可以开始dofactory.com/patterns/patterns.aspx](http://dofactory.com/Patterns/Patterns.aspx)的好地方- 您可以找到每个模式的链接以及相应的实现。

但是，请记住这些是 GOF 模式。一旦您在 OOAD 方面获得了足够的专业知识，您可能还需要阅读和理解高级模式。Head First Design Patterns 是一个良好的开端，在取得一些进展之后，继续学习 Martin Fowler 的 Enterprise Application Architecture Patterns。

**应用设计模式——思考过程**

另一个主要方面 - 应用设计模式与了解它们一样重要。阅读这些文章也可能对您有所帮助。

[应用设计模式第一部分](http://amazedsaint.blogspot.com/2008/01/design-patterns-part-i-and-ii.html)

[应用设计模式第二部分](http://amazedsaint.blogspot.com/2008/01/practically-applying-design-patterns.html)

希望这可以帮助

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-10-28T20:27:11.393

[![设计模式](https://i.stack.imgur.com/qo9oX.jpg)](https://i.stack.imgur.com/qo9oX.jpg)      
[（来源：[亚马逊](http://ecx.images-amazon.com/images/I/51Rs5KgdLTL._SL500_BO2,204,203,200_AA219_PIsitb-sticker-dp-arrow,TopRight,-24,-23_SH20_OU01_.jpg)）]

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-10-29T09:21:34.417

Head First Design Patterns 是一个很好的设计模式，就像其他已经提到的那样。除此之外，当然还有原著和 C# Design Patterns。还有已经提到的好网站。

除了自学之外，我强烈建议您开始或参加您所在地区的**模式学习小组**。请参阅[设计模式学习指南以](http://www.industriallogic.com/papers/learning.html)获得解释和学习模式的良好顺序。我们这样做了，老实说，我不会像现在这样理解。每周与其他感兴趣的人开会，让你在学习设计模式等抽象的东西时，会出奇的自律。

学习愉快！

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-12-22T14:13:44.270

在花钱买书之前，我会推荐维基百科的优秀[设计模式](http://en.wikipedia.org/wiki/Design_pattern_(computer_science))页面。[也可以通过谷歌搜索“设计模式截屏视频”或在YouTube 上](http://www.youtube.com)搜索“设计模式” 。以不同的方式获得相同的信息通常有助于降低成本。

[四人帮](https://rads.stackoverflow.com/amzn/click/com/0201633612)一书是关于最知名模式的权威文本，但并不那么容易阅读，而且 C++ 示例并不是每个人都喜欢的。

[Head First Design Patterns](https://rads.stackoverflow.com/amzn/click/com/0596007124)文本更易于访问，但仅包含 Gang of Four 模式的一个子集。

最重要的是了解特定模式在何处以及为何有用。然后在网上搜索您选择的语言的实现示例并进行实验，直到您“得到它”。了解一种模式，然后再进行下一种模式。每个人都比其他人更了解某些模式（还有数百种鲜为人知的模式）。

只是继续插电。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-10-28T20:26:03.767

Martin Fowler 的企业应用架构模式（精装本）

Joshua Kerievsky 重构为模式（精装本）

持续集成：提高软件质量和降低风险（平装本），Paul Duval 等人。

超越软件架构：创建和维持成功的解决方案（平装本）作者 Luke Hohmann

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-10-28T20:27:23.967

设计模式就像任何库函数一样，阅读它们，然后当出现问题时，设计模式将在您的“工具箱”中。有许多设计模式书籍都是仿照最初的“四人帮”设计模式设计的。

对于任何程序员来说，我认为这和 Fowler 的重构书是绝对最低要求。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2008-10-28T20:29:06.163

对于网站，一个非常好的网站是[http://ajaxpatterns.org](http://ajaxpatterns.org)，来自 ajaxian 网站的开发者之一

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2008-10-28T20:30:02.183

最初的[设计模式](https://rads.stackoverflow.com/amzn/click/com/0201633612)书是所有程序员的必读之书。

这是一本在各个层面上都很棒的书：布局、清晰度、洞察力、深度。这是您首先从头到尾阅读的那些伟大书籍之一，然后将其用作参考，直到您真正了解它为止。

您可以从[Wikipedia 页面](http://en.wikipedia.org/wiki/Design_Patterns)开始，但也可以用这本好书犒劳自己。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2008-10-28T20:30:46.923

Craig Larman 的[《应用 UML 和模式》 。](https://rads.stackoverflow.com/amzn/click/com/0137488807)从分析的基础开始，设计和使用一个简单的Case场景。以简单的方式介绍了大部分基本模式。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2008-10-28T20:35:33.793

如果您阅读过设计模式，您会注意到 Java 似乎已经实现了其中的一些。

查看任何框架的源代码，您可以收集有关设计模式的信息。就我个人而言，我不认为它们完全适合我的任何代码，有时书籍和教程中的示例似乎有点理想化，尤其是对于孤独的编码者。

设计模式不适合懒惰的程序员。

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2008-11-27T04:14:09.930

我和我的同事在[Pattern Study Group](http://www.industriallogic.com/papers/learning.html)学习设计模式。他们准备了我们应该按顺序学习的每种模式的列表，并且还有一些开放性问题，可以在小组中进行更多讨论。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2008-10-28T20:29:04.383

对于经验很少的人来说，深入研究设计模式对我来说没有多大意义。很高兴知道它们的存在，但此时您应该更多地关注其他事情，而不仅仅是学习设计模式。

它们在问题的上下文中很有用 - 作为新/初学者开发人员的概念，除了知道您应该在何时何地使用它们之外，它们实际上并没有太多实用价值。

编辑澄清 - 许多设计模式是在某些领域发现的问题的结果。很难指望新程序员（IMO）知道用于某些问题的设计模式。就像我们在 CS 研究中了解一些算法一样，我们需要了解我们可以用模式做的事情及其好处，但是当一个人仍在构建 hello world 或发现 stl 时，对设计模式的实际需求并不多。图案很棒。但它们不是灵丹妙药。

（CASE（工具）也不是，UML 也不是，SCRUM 也不是，TDD 也不是 STL，Java 也不是 XML，等等。）这些都只是我们专业的方面，并将这些主题视为第二个来是幼稚的。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2008-10-28T20:30:50.650

我还建议在您阅读 Head First Design Patterns 后，在[Refactoring to Patterns中学习一下。](http://www.industriallogic.com/xp/refactoring/)

注意：代码示例是用 Java 编写的，但应该与 C# 示例非常相似...

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2008-10-28T21:48:23.413

模式包括程序员用来谈论抽象设计的高级词汇。如果您正在重用一个抽象的解决方案，那么通过名称来引用它会很有帮助。如果您发明了一种模式，那么进行一些检查以确保它尚未被命名是很专业的。如果它已被命名，那么描述可能是有用的。

在您编写一点点代码之后，您会注意到自己编写的内容与您之前编写的代码类似。这是一种模式。即使是微小的图案，也值得注意。有更好的模式吗？您是否看到某些微小的模式协同合作以解决更大的问题？那么下一次，当你想解决更大的问题时，整个模式会作为一个整体出现在你的脑海中。充实详细的代码行变得机械化。

您注意到模式的次数越多，编程就会变得越容易，并且您将越欣赏其他程序员制定的一些最大和最好的模式。尝试掌握 MVC 模式。一种或另一种方式，变化无处不在，即使在微小的设计决策中也是如此。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2008-11-27T04:20:30.370

一旦您理解了这个概念，请浏览 Eclipse 源代码或设计，这些模式的许多非常好的示例（毫不奇怪，Gamma 是设计者之一）。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2009-08-23T22:07:32.497

我发现这个网站上的设计模式文章真的很容易理解

[C# 中的设计模式](http://www.dotnetcube.com/?tag=/design-patterns)

# javascript - 将权限传播到 Javascript

> ID：244715
> 
> 赞同：7
> 
> 时间：2008-10-28T20:24:50.897
> 
> 标签：javascript, permissions

我正在讨论将相当复杂的权限从服务器传播到 AJAX 应用程序的最佳方法，但我不确定最佳方法。

本质上，我希望定义我的权限，以便我可以一次请求一整套权限，并适当调整 UI（UI 更改可能与禁用某些上下文菜单项一样低级）。当然，我仍然需要在服务器端强制执行权限。

所以，我想知道是否有人对最好的方法有任何建议

1.  维护权限并在服务器代码中使用它们
2.  可以轻松访问 javascript 中的权限
3.  不必为每个单独的权限向服务器发出往返请求

想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T20:59:50.093

如果您将权限结构作为 JSON 对象（或 XML，如果您愿意）传输到客户端，您可以使用客户端代码操作该对象，并将其发送回服务器，服务器可以执行任何需要验证的操作数据并将其持久化。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T21:31:24.337

如果您有一组明确的权限，例如“用户级别”或“用户类型”，您可以将值传递到隐藏字段中并通过 DOM 访问该值。如果您的权限更细化，您仍然可以这样做，但是您要么有很多隐藏字段，要么必须将信息编码为 XML 或 JSON 或其他格式。

您可以将它们设置为位标志，以便您可以将单个数值与掩码进行或运算，以查看用户是否具有特定活动的权限。这将非常灵活，只要您不拥有超过 32 个左右的特定“权利”，就可以在一个非常小的包（基本上是一个 unsigned int）中对这些权利进行任何排列。

例如：

```
0x00000001 //edit permission
0x00000002 //create new thing permission
0x00000004 //delete things permission
0x00000008 //view hidden things permission
   .
   .
   .
0x80000000 //total control of the server and everyone logged in 
```

然后具有权限的用户`0x000007`可以编辑、创建和删除，但不能做其他事情。

在任何一种情况下，我认为您都在正确的轨道上 - 每个页面调用发出一次请求，将权限存储在全局 JavaScript 数据结构中，然后从那里开始。AJAX 很好，但您不想查询服务器以获取整个页面上的每个特定权限。您将在页面加载时执行一次，设置页面的显示并将值保存在全局变量中，然后在本地引用事件函数的权限。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T21:03:44.627

我不一定将其视为最“正确”的解决方案，但是否可以将所有权限内容保留在服务器端，并仅提供更新的 UI 而不是某种 JSON 权限系统？

您必须根据您的应用程序预期的繁忙和密集程度做出决定，但绝对值得做出任何决定

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-28T20:46:20.323

将它们编码为[JSON](http://json.org)。

# asp.net - 有人可以给我一个登录 ASP.NET 的“hello world”示例吗？

> ID：244719
> 
> 赞同：3
> 
> 时间：2008-10-28T20:25:39.693
> 
> 标签：asp.net, logging

我正在尝试在我的 ASP.NET 应用程序中获取一个简单的日志记录示例。我想使用 My.Log 功能将错误日志消息写入文本日志文件。我已经通过谷歌尝试了几件事，但似乎都没有奏效。通常，当我在代码中使用 My.Log.DefaultFileWriter 的任何属性时，它会显示“未设置对象引用”。

我的基本问题是：我的 web.config 文件（和/或其他任何地方，如有必要）需要什么，以便我可以用

```
My.Log.WriteEntry("blahblahblah") 
```

在我的代码中，到文本文件 D:\log.txt?

谢谢。

* * *

编辑：使用的特定代码：

```
 <system.diagnostics>
    <sources >
      <source name="DefaultSource" switchName="DefaultSwitch">
        <listeners>
          <add name="FileLog"/>
        </listeners>
      </source>
    </sources>
    <sharedListeners>    
      <add name="FileLog" 
           type="Microsoft.VisualBasic.Logging.FileLogTraceListener, Microsoft.VisualBasic, Version=8.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"    
           initializeData="FileLogWriter" />
    </sharedListeners>
    <switches>
      <add name="DefaultSwitch" value="Verbose"/>
    </switches>
    <trace autoflush="true"></trace>
  </system.diagnostics> 
```

然后在代码中：

```
My.Log.DefaultFileLogWriter.CustomLocation = "D:\"
My.Log.DefaultFileLogWriter.BaseFileName = "log"
My.Log.WriteEntry("blahblahblah") 
```

（这将写入 D:\log.log）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T20:30:47.593

[演练：更改 My.Application.Log 写入信息的位置](https://docs.microsoft.com/en-us/dotnet/visual-basic/developing-apps/programming/log-info/walkthrough-changing-where-my-application-log-writes-information)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T20:55:50.133

I know it's not a hello world example, but I suggest also checking out log4net ([http://logging.apache.org/log4net/index.html](http://logging.apache.org/log4net/index.html)). It's pretty awesome.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-12T07:10:35.537

log4net is the bst option for logging in asp.net

# python - opengl用顶点颜色设置纹理颜色

> ID：244720
> 
> 赞同：1
> 
> 时间：2008-10-28T20:25:55.827
> 
> 标签：python, opengl, pyglet

因为我需要显示[大量](http://codeflow.org/ubuntu.png)[独立移动](http://www.youtube.com/watch?v=A_ah-SE-cNY)的标签，所以我需要将[pyglet](http://pyglet.org)中的标签渲染到纹理（否则为每个字形更新顶点列表太慢）。

我有一个解决方案，但我的问题是包含字形的纹理是黑色的，但我希望它是红色的。请参见下面的示例：

```
from pyglet.gl import *

def label2texture(label):
    vertex_list = label._vertex_lists[0].vertices[:]
    xpos = map(int, vertex_list[::8])
    ypos = map(int, vertex_list[1::8])
    glyphs = label._get_glyphs()

    xstart = xpos[0]
    xend = xpos[-1] + glyphs[-1].width
    width = xend - xstart

    ystart = min(ypos)
    yend = max(ystart+glyph.height for glyph in glyphs)
    height = yend - ystart

    texture = pyglet.image.Texture.create(width, height, pyglet.gl.GL_RGBA)

    for glyph, x, y in zip(glyphs, xpos, ypos):
        data = glyph.get_image_data()
        x = x - xstart
        y =  height - glyph.height - y + ystart
        texture.blit_into(data, x, y, 0)

    return texture.get_transform(flip_y=True)

window = pyglet.window.Window()
label = pyglet.text.Label('Hello World!', font_size = 36)
texture = label2texture(label)

@window.event
def on_draw():
    hoff = (window.width / 2) - (texture.width / 2)
    voff = (window.height / 2) - (texture.height / 2)

    glClear(GL_COLOR_BUFFER_BIT)
    glEnable(GL_BLEND)
    glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA)
    glClearColor(0.0, 1.0, 0.0, 1.0)
    window.clear()
    glEnable(GL_TEXTURE_2D);

    glBindTexture(GL_TEXTURE_2D, texture.id)
    glColor4f(1.0, 0.0, 0.0, 1.0) #I'd like the font to be red
    glBegin(GL_QUADS);
    glTexCoord2d(0.0,1.0); glVertex2d(hoff,voff);
    glTexCoord2d(1.0,1.0); glVertex2d(hoff+texture.width,voff);
    glTexCoord2d(1.0,0.0); glVertex2d(hoff+texture.width,voff+texture.height);
    glTexCoord2d(0.0,0.0); glVertex2d(hoff, voff+texture.height);
    glEnd();

pyglet.app.run() 
```

知道我怎么给这个上色吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-02T02:00:08.730

你想设置`glEnable(GL_COLOR_MATERIAL)`. 这使得纹理颜色与当前的 OpenGL 颜色混合。您还可以使用该`glColorMaterial`函数指定是否应影响每个多边形的前/后/两者。文档[在这里](http://www.glprogramming.com/blue/ch05.html#id37922)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T14:16:52.887

当您使用贴花时，不是这样`[glTexEnv()](http://www.opengl.org/documentation/specs/man_pages/hardcopy/GL/html/gl/texenv.html)`吗？

# python - 支持 ANSI/VT100 的 AJAX 控制台窗口？

> ID：244750
> 
> 赞同：8
> 
> 时间：2008-10-28T20:32:24.923
> 
> 标签：python, ajax, vt100

我打算编写网关 Web 应用程序，它需要支持 VT100/ANSI 转义码的“终端窗口”。这种任务是否有任何基于 AJAX 的替代方案？

我在想这样的事情：http: [//tryruby.hobix.com/](http://tryruby.hobix.com/)

我首选的系统后端是 Python/Twisted/Pylons，但由于我只是在计划，我将探索每个选项。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-28T20:49:22.610

尝试

[任何期限](http://wiki.kartbuilding.net/index.php/Anyterm)

[AjaxTerm](http://wiki.kartbuilding.net/index.php/Ajaxterm)

[WebShell](http://www-personal.umich.edu/~mressl/webshell/)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-06-08T06:47:26.570

还有[一个盒子里的壳](http://shellinabox.com)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-28T20:47:37.123

AjaxTerm 有一个终端，主要是终端仿真，在 Python 后端完成（它只是将显示更新推送到客户端 Javascript）。

AjaxTerm网站已经关闭了一段时间，但您仍然可以[在](http://antony.lesuisse.org/qweb/trac/wiki/AjaxTerm)[Debian](http://packages.debian.org/etch/ajaxterm)中找到它。

# php - 使用 PHP 将文件从一台服务器移动到另一台服务器的最佳方法是什么？

> ID：244752
> 
> 赞同：5
> 
> 时间：2008-10-28T20:32:41.583
> 
> 标签：php, file, data-transfer

我想设置一个运行 PHP 脚本的 CRON，该脚本又将 XML 文件（保存非敏感信息）从一台服务器移动到另一台服务器。

我已获得正确的用户名/密码，并希望使用 SFTP 协议。这些作业将每天运行。一台服务器可能是 Linux，另一台服务器是 Windows。两者都在不同的网络上。

移动该文件的最佳方法是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-28T20:41:03.830

如果两台服务器都在 Linux 上，您可以将[rsync](http://samba.anu.edu.au/rsync/)用于任何类型的文件（php、xml、html、二进制文件等）。即使其中之一是 Windows，也有到 Windows 的 rsync 端口。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-28T21:24:37.877

为什么不尝试使用 PHP 的[FTP 功能](http://www.php.net/manual/en/ref.ftp.php)呢？

然后你可以做类似的事情：

```
// open some file for reading
$file = 'somefile.txt';
$fp = fopen($file, 'r');

// set up basic connection
$conn_id = ftp_connect($ftp_server);

// login with username and password
$login_result = ftp_login($conn_id, $ftp_user_name, $ftp_user_pass);

// try to upload $file
if (ftp_fput($conn_id, $file, $fp, FTP_ASCII)) {
    echo "Successfully uploaded $file\n";
} else {
    echo "There was a problem while uploading $file\n";
}

// close the connection and the file handler
ftp_close($conn_id);
fclose($fp); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-28T20:38:15.270

为什么不使用[shell_exec](http://us2.php.net/shell_exec)和[scp](http://kb.iu.edu/data/agye.html)？

```
<?php
    $output = shell_exec('scp file1.txt dvader@deathstar.com:somedir');
    echo "<pre>$output</pre>";
?> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-06-13T18:14:16.937

我有一些类似的情况。经过一些尝试，我做了一些不同的事情

我们有 2 台服务器，a（有原始文件）b（文件应该移到它上面）

并且确保数据不敏感

现在在服务器 a 中，我创建了一个文件以在调用时执行以下操作：1\. 选择要移动的文件 2\. 压缩文件 3\. 打印 .zip 文件位置 4\. 如果删除，则删除 .zip 文件（和原始文件）参数传递

在服务器 b 中，文件应该执行以下操作： 1\. 调用服务器 a 上的文件 2\. 下载 zip 文件 3\. 解压缩并将其复制到正确的位置 4\. 调用服务器 a 上的删除功能

这样我就可以更好地控制我的功能、测试和操作！

# asp.net - 在 SharePoint 中自动发布 .aspx

> ID：244755
> 
> 赞同：0
> 
> 时间：2008-10-28T20:32:53.737
> 
> 标签：asp.net, sharepoint, sharepoint-designer

我目前在 SharePoint 中发布 .aspx 后面的代码。我可以自动将 .dll 发布到虚拟目录的 bin 文件夹，但我不知道如何在不手动使用 SharePoint Designer 的情况下将 .aspx 页面和图像推送到服务器。

文件夹在哪里？

或者我需要为此创建一个 SharePoint 功能吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T22:37:59.303

我完全建议掌握[STSDev](http://www.codeplex.com/stsdev)并使用解决方案和功能来发布任何真正的定制。

弄清楚它是如何工作的需要额外的工作，但是在尝试将事物可靠且可重复地发布到不同的环境时，这是值得的。

允许您自动更改站点的功能接收器的功能非常有用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T13:15:43.073

.aspx 文件位于 C:\Program Files\Common Files\Microsoft Shared\web server extensions\12\templates\layouts 下

部署新功能（服务器上的所有内容都可以访问）的一种快速且非常肮脏的方法是将 aspx 放入此文件夹中。这并不安全，但可以让您在投入时间进行全面的解决方案/功能部署之前进行测试。

我建议阅读 Andrew Connell 的开发方法，我认为他也有一本用于进行共享点开发的书。他的“开发共享点功能”演讲是我听过的进行共享点开发的最佳起点。 [http://www.andrewconnell.com/blog/](http://www.andrewconnell.com/blog/)

# jquery - jQuery 动画 - 平滑大小转换

> ID：244758
> 
> 赞同：34
> 
> 时间：2008-10-28T20:33:14.610
> 
> 标签：jquery, animation, resize

所以这可能真的很简单，但我还没有找到任何可以学习的例子，所以请多多包涵。;)

这基本上是我想做的事情：

```
<div>Lots of content! Lots of content! Lots of content! ...</div>

.... 

$("div").html("Itsy-bitsy bit of content!"); 
```

当注入新内容时，我想在具有大量内容的 div 的尺寸与很少的 div 的尺寸之间平滑地制作动画。

想法？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-10-28T23:56:42.920

试试这个 jQuery 插件：

```
// Animates the dimensional changes resulting from altering element contents
// Usage examples: 
//    $("#myElement").showHtml("new HTML contents");
//    $("div").showHtml("new HTML contents", 400);
//    $(".className").showHtml("new HTML contents", 400, 
//                    function() {/* on completion */});
(function($)
{
   $.fn.showHtml = function(html, speed, callback)
   {
      return this.each(function()
      {
         // The element to be modified
         var el = $(this);

         // Preserve the original values of width and height - they'll need 
         // to be modified during the animation, but can be restored once
         // the animation has completed.
         var finish = {width: this.style.width, height: this.style.height};

         // The original width and height represented as pixel values.
         // These will only be the same as `finish` if this element had its
         // dimensions specified explicitly and in pixels. Of course, if that 
         // was done then this entire routine is pointless, as the dimensions 
         // won't change when the content is changed.
         var cur = {width: el.width()+'px', height: el.height()+'px'};

         // Modify the element's contents. Element will resize.
         el.html(html);

         // Capture the final dimensions of the element 
         // (with initial style settings still in effect)
         var next = {width: el.width()+'px', height: el.height()+'px'};

         el .css(cur) // restore initial dimensions
            .animate(next, speed, function()  // animate to final dimensions
            {
               el.css(finish); // restore initial style settings
               if ( $.isFunction(callback) ) callback();
            });
      });
   };

})(jQuery); 
```

评论者 RonLugge 指出，如果你在同一个元素上调用它两次，这可能会导致问题，其中第一个动画在第二个动画开始之前还没有完成。这是因为第二个动画将当前（中间动画）尺寸作为所需的“结束”值，并继续将它们固定为最终值（有效地停止动画在其轨道上，而不是朝着“自然”尺寸制作动画)...

解决这个问题的最简单方法是在调用[`stop()`](http://api.jquery.com/stop/)之前调用`showHtml()`，并传递`true`第二个（*jumpToEnd*）参数：

```
$(selector).showHtml("new HTML contents")
           .stop(true, true)
           .showHtml("even newer contents"); 
```

这将导致第一个动画在开始新动画之前立即完成（如果它仍在运行）。

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2008-10-28T21:51:39.177

您可以使用[动画方法](http://docs.jquery.com/Effects/animate#paramsoptions)。

```
$("div").animate({width:"200px"},400); 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-28T20:57:37.040

也许是这样的？

```
$(".testLink").click(function(event) {
    event.preventDefault();
    $(".testDiv").hide(400,function(event) {
        $(this).html("Itsy-bitsy bit of content!").show(400);
    });
}); 
```

接近我认为您想要的，也可以尝试 slideIn/slideOut 或查看 UI/Effects 插件。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-24T11:29:49.567

这是我解决此问题的方法，希望对您有用！动画是 100% 流畅的 :)

HTML：

```
<div id="div-1"><div id="div-2">Some content here</div></div> 
```

Javascript：

```
// cache selectors for better performance
var container = $('#div-1'),
    wrapper = $('#div-2');

// temporarily fix the outer div's width
container.css({width: wrapper.width()});
// fade opacity of inner div - use opacity because we cannot get the width or height of an element with display set to none
wrapper.fadeTo('slow', 0, function(){
    // change the div content
    container.html("<div id=\"2\" style=\"display: none;\">new content (with a new width)</div>");
    // give the outer div the same width as the inner div with a smooth animation
    container.animate({width: wrapper.width()}, function(){
        // show the inner div
        wrapper.fadeTo('slow', 1);
    });
}); 
```

我的代码可能有一个较短的版本，但我只是保持这样。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-05-12T01:05:34.290

这对我有用。您还可以向临时 div 添加宽度。

```
$('div#to-transition').wrap( '<div id="tmp"></div>' );
$('div#tmp').css( { height: $('div#to-transition').outerHeight() + 'px' } );
$('div#to-transition').fadeOut('fast', function() {
  $(this).html(new_html);
  $('div#tmp').animate( { height: $(this).outerHeight() + 'px' }, 'fast' );
  $(this).fadeIn('fast', function() {
    $(this).unwrap();
  });
}); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-28T22:08:12.560

你好 meyahoocoma4c5ki0pprxr19sxhajsogo6jgks5dt。

您可以用设置为绝对宽度值的“外部 div”包装“内容 div”。使用“hide()”或“animate({width})”方法注入新内容，如其他答案所示。这样，页面不会在两者之间重排，因为包装器 div 保持稳定的宽度。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-11-26T01:30:20.790

您可以使用`dequeue`. 在开始新动画之前测试类的存在（在悬停时设置并在 mouseOut 动画回调中删除）。当新动画开始时，出列。

[这是一个快速演示。](http://codepen.io/dcdev/pen/XJbRwo)

```
var space = ($(window).width() - 100);
$('.column').width(space/4);

$(".column").click(function(){
    if (!$(this).hasClass('animated')) {
        $('.column').not($(this).parent()).dequeue().stop().animate({width: 'toggle', opacity: '0.75'}, 1750,'linear', function () {});
    }

  $(this).addClass('animated');
    $('.column').not($(this).parent()).dequeue().stop().animate({width: 'toggle', opacity: '0.75'}, 1750,'linear', function () {
          $(this).removeClass('animated').dequeue();

      });
    $(this).dequeue().stop().animate({
        width:(space/4)
    }, 1400,'linear',function(){
      $(this).html('AGAIN');
    });
}); 
```

该演示设置为 5 个全高列，单击第 2 到 5 列中的任何一个将动画显示其他 3 个的切换宽度并将单击的元素移动到最左侧。

![在此处输入图像描述](https://i.stack.imgur.com/bfuXW.jpg)

![在此处输入图像描述](https://i.stack.imgur.com/C7YV8.jpg)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-12-17T20:47:58.647

为了搭载 jquery 插件解决方案（声誉太低，无法将其添加为评论）jQuery.html() 将删除附加 html 上的任何事件处理程序。改变：

```
// Modify the element's contents. Element will resize.
el.html(html); 
```

到

```
// Modify the element's contents. Element will resize.
el.append(html); 
```

将保留“html”元素的事件处理程序

# c# - 具有继承的构建器设计模式：有更好的方法吗？

> ID：244772
> 
> 赞同：19
> 
> 时间：2008-10-28T20:38:28.437
> 
> 标签：c#, generics, builder

我正在创建一系列构建器来清理为我的模拟创建域类的语法，作为改进我们整体单元测试的一部分。我的构建器本质上填充了一个域类（例如 a `Schedule`），其中一些值是通过调用适当的`WithXXX`并将它们链接在一起来确定的。

我在构建者中遇到了一些共性，我想将其抽象为基类以增加代码重用。不幸的是，我最终得到的结果如下：

```
public abstract class BaseBuilder<T,BLDR> where BLDR : BaseBuilder<T,BLDR> 
                                          where T : new()
{
    public abstract T Build();

    protected int Id { get; private set; }
    protected abstract BLDR This { get; }

    public BLDR WithId(int id)
    {
        Id = id;
        return This;
    }
} 
```

特别注意`protected abstract BLDR This { get; }`.

域类构建器的示例实现是：

```
public class ScheduleIntervalBuilder :
    BaseBuilder<ScheduleInterval,ScheduleIntervalBuilder>
{
    private int _scheduleId;
    // ...

    // UG! here's the problem:
    protected override ScheduleIntervalBuilder This
    {
        get { return this; }
    }

    public override ScheduleInterval Build()
    {
        return new ScheduleInterval
        {
            Id = base.Id,
            ScheduleId = _scheduleId
                    // ...
        };
    }

    public ScheduleIntervalBuilder WithScheduleId(int scheduleId)
    {
        _scheduleId = scheduleId;
        return this;
    }

    // ...
} 
```

因为 BLDR 不是 BaseBuilder 类型，所以我不能`return this`在`WithId(int)`.`BaseBuilder`

在这里公开带有属性的子类型是`abstract BLDR This { get; }`我唯一的选择，还是我错过了一些语法技巧？

更新（因为我可以更清楚地说明我为什么要这样做）：

最终结果是让构建器构建分析域类，人们希望以[程序员]可读格式从数据库中检索这些域类。没什么不好的...

```
mock.Expect(m => m.Select(It.IsAny<int>())).Returns(
    new Schedule
    {
        ScheduleId = 1
        // ...
    }
); 
```

因为那已经很可读了。替代的构建器语法是：

```
mock.Expect(m => m.Select(It.IsAny<int>())).Returns(
    new ScheduleBuilder()
        .WithId(1)
        // ...
        .Build()
); 
```

我从使用构建器（并实现所有这些`WithXXX`方法）中寻找的优势是抽象出复杂的属性创建（使用正确的自动扩展我们的数据库查找值而`Lookup.KnownValues`不会明显影响数据库）并让构建器提供通常可重用的测试配置文件对于域类...

```
mock.Expect(m => m.Select(It.IsAny<int>())).Returns(
    new ScheduleBuilder()
        .AsOneDay()
        .Build()
); 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-28T20:44:32.230

我只能说，如果有*办法*做到这一点，我也想知道——我在我的[Protocol Buffers port中使用](http://github.com/jskeet/dotnet-protobufs/tree/master)*了*这个模式。事实上，我很高兴看到其他人使用了它——这意味着我们至少在某种程度上是正确的！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-02-11T23:27:37.190

我知道这是一个老问题，但我认为您可以使用简单的演员表来避免`abstract BLDR This { get; }`

生成的代码将是：

```
public abstract class BaseBuilder<T, BLDR> where BLDR : BaseBuilder<T, BLDR>
                                           where T : new()
{
    public abstract T Build();

    protected int Id { get; private set; }

    public BLDR WithId(int id)
    {
        _id = id;
        return (BLDR)this;
    }
}

public class ScheduleIntervalBuilder :
    BaseBuilder<ScheduleInterval,ScheduleIntervalBuilder>
{
    private int _scheduleId;
    // ...

    public override ScheduleInterval Build()
    {
        return new ScheduleInterval
        {
                Id = base.Id,
                ScheduleId = _scheduleId
                    // ...
        };
    }

    public ScheduleIntervalBuilder WithScheduleId(int scheduleId)
    {
        _scheduleId = scheduleId;
        return this;
    }

    // ...
} 
```

当然，您可以将构建器封装为

```
protected BLDR This
{
    get
    {
        return (BLDR)this;
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-29T03:30:46.920

这是 C# 的一个很好的实现策略。

其他一些语言（想不出我见过的研究语言的名称）具有直接支持协变“self”/“this”的类型系统，或者有其他巧妙的方式来表达这种模式，但使用 C#类型系统，这是一个很好的（唯一的？）解决方案。

# json - 可以在 JSON 中使用注释吗？

> ID：244777
> 
> 赞同：8804
> 
> 时间：2008-10-28T20:39:03.333
> 
> 标签：json, comments

我可以在 JSON 文件中使用注释吗？如果是这样，怎么做？

* * *

## 回答 #1

> 赞同：6560
> 
> 时间：2008-10-28T21:01:42.307

不。

JSON 只是数据，如果您包含评论，那么它也将是数据。

您可能有一个指定的数据元素，称为`"_comment"`（或其他东西），使用 JSON 数据的应用程序应忽略该数据元素。

您可能会更好地在生成/接收 JSON 的过程中添加注释，因为他们应该提前知道 JSON 数据是什么，或者至少知道它的结构。

但是，如果您决定：

```
{
   "_comment": "comment text goes here...",
   "glossary": {
      "title": "example glossary",
      "GlossDiv": {
         "title": "S",
         "GlossList": {
            "GlossEntry": {
               "ID": "SGML",
               "SortAs": "SGML",
               "GlossTerm": "Standard Generalized Markup Language",
               "Acronym": "SGML",
               "Abbrev": "ISO 8879:1986",
               "GlossDef": {
                  "para": "A meta-markup language, used to create markup languages such as DocBook.",
                  "GlossSeeAlso": ["GML", "XML"]
               },
               "GlossSee": "markup"
            }
         }
      }
   }
} 
```

* * *

## 回答 #2

> 赞同：2056
> 
> 时间：2010-11-15T09:32:41.077

* * *

## 回答 #3

> 赞同：940
> 
> 时间：2010-06-23T18:20:53.367

**如果您愿意，请包括评论；在解析或传输之前用压缩器将它们剥离。**

我刚刚发布了**[JSON.minify()](http://github.com/getify/JSON.minify)**，它从 JSON 块中去除注释和空格，使其成为可以解析的有效 JSON。因此，您可以像这样使用它：

```
JSON.parse(JSON.minify(my_str)); 
```

当我发布它时，我遭到了很多人的强烈反对，甚至不同意它的想法，所以我决定写一篇全面的博客文章，解释为什么[评论在 JSON 中有意义](http://web.archive.org/web/20100629021329/http://blog.getify.com/2010/06/json-comments/)。它包括来自 JSON 的创建者的这条值得注意的评论：

> 假设您使用 JSON 来保存您想要注释的配置文件。继续并插入您喜欢的所有评论。然后通过 JSMin 将其通过管道传递给您的 JSON 解析器。-[道格拉斯·克罗克福德，2012](https://web.archive.org/web/20190112173904/https://plus.google.com/118095276221607585885/posts/RK8qyGVaGSr)

希望这对那些不同意**JSON.minify()**有用的人有所帮助。

* * *

## 回答 #4

> 赞同：522
> 
> 时间：2012-06-11T08:52:23.620

Comments were removed from JSON by design.

> I removed comments from JSON because I saw people were using them to hold parsing directives, a practice which would have destroyed interoperability. I know that the lack of comments makes some people sad, but it shouldn't.
> 
> Suppose you are using JSON to keep configuration files, which you would like to annotate. Go ahead and insert all the comments you like. Then pipe it through JSMin before handing it to your JSON parser.

Source: [Public statement by Douglas Crockford on G+](https://web.archive.org/web/20120507093915/https://plus.google.com/118095276221607585885/posts/RK8qyGVaGSr)

* * *

## 回答 #5

> 赞同：341
> 
> 时间：2014-03-20T15:26:51.133

JSON does not support comments. It was also never intended to be used for configuration files where comments would be needed.

Hjson is a configuration file format for humans. Relaxed syntax, fewer mistakes, more comments.

[![Hjson intro](https://i.stack.imgur.com/u2E8q.gif)](https://i.stack.imgur.com/u2E8q.gif)

See [hjson.github.io](https://hjson.github.io/) for JavaScript, Java, Python, PHP, Rust, Go, Ruby, C++ and C# libraries.

* * *

## 回答 #6

> 赞同：236
> 
> 时间：2013-08-02T13:46:09.570

DISCLAIMER: YOUR WARRANTY IS VOID

As has been pointed out, this hack takes advantage of the implementation of the spec. Not all JSON parsers will understand this sort of JSON. Streaming parsers in particular will choke.

It's an interesting curiosity, but you **should really not be using it for anything at all**. Below is the original answer.

* * *

I've found a little hack that allows you to place comments in a JSON file that will not affect the parsing, or alter the data being represented in any way.

It appears that when declaring an object literal you can specify two values with the same key, and the last one takes precedence. Believe it or not, it turns out that JSON parsers work the same way. So we can use this to create comments in the source JSON that will not be present in a parsed object representation.

```
({a: 1, a: 2});
// => Object {a: 2}
Object.keys(JSON.parse('{"a": 1, "a": 2}')).length; 
// => 1 
```

If we apply this technique, your commented JSON file might look like this:

```
{
  "api_host" : "The hostname of your API server. You may also specify the port.",
  "api_host" : "hodorhodor.com",

  "retry_interval" : "The interval in seconds between retrying failed API calls",
  "retry_interval" : 10,

  "auth_token" : "The authentication token. It is available in your developer dashboard under 'Settings'",
  "auth_token" : "5ad0eb93697215bc0d48a7b69aa6fb8b",

  "favorite_numbers": "An array containing my all-time favorite numbers",
  "favorite_numbers": [19, 13, 53]
} 
```

The above code is [valid JSON](http://jsonlint.com/). If you parse it, you'll get an object like this:

```
{
    "api_host": "hodorhodor.com",
    "retry_interval": 10,
    "auth_token": "5ad0eb93697215bc0d48a7b69aa6fb8b",
    "favorite_numbers": [19,13,53]
} 
```

Which means there is no trace of the comments, and they won't have weird side-effects.

Happy hacking!

* * *

## 回答 #7

> 赞同：172
> 
> 时间：2011-08-31T02:24:26.840

Consider using [YAML](https://yaml.org/). It's nearly a superset of JSON (virtually all valid JSON is valid YAML) and it allows comments.

* * *

## 回答 #8

> 赞同：132
> 
> 时间：2008-10-28T20:42:20.253

你不能。至少这是我快速浏览[json.org](http://json.org)的经验。

JSON 的语法在该页面上可视化。没有关于评论的任何注释。

* * *

## 回答 #9

> 赞同：106
> 
> 时间：2011-10-26T09:46:56.300

Comments are not an official standard, although some parsers support C++-style comments. One that I use is [JsonCpp](https://github.com/open-source-parsers/jsoncpp). In the examples there is this one:

```
// Configuration options
{
    // Default encoding for text
    "encoding" : "UTF-8",

    // Plug-ins loaded at start-up
    "plug-ins" : [
        "python",
        "c++",
        "ruby"
        ],

    // Tab indent size
    "indent" : { "length" : 3, "use_space": true }
} 
```

[jsonlint](http://www.jsonlint.com) does not validate this. So comments are a parser specific extension and not standard.

Another parser is [JSON5](https://json5.org/).

An alternative to JSON [TOML](https://github.com/toml-lang/toml).

A further alternative is [jsonc](https://www.npmjs.com/package/jsonc).

The latest version of [nlohmann/json](https://github.com/nlohmann/json#comments-in-json) has optional support for ignoring comments on parsing.

* * *

## 回答 #10

> 赞同：83
> 
> 时间：2010-07-28T18:38:37.877

您应该改为编写[JSON 模式](http://json-schema.org/)。JSON 模式目前是一个提议的 Internet 草案规范。除了文档之外，该模式还可用于验证您的 JSON 数据。

例子：

```
{
    "description":"A person",
    "type":"object",
    "properties":
        {
            "name":
                {
                    "type":"string"
                },
            "age":
                {
                    "type":"integer",
                    "maximum":125
                }
        }
} 
```

您可以使用**描述**架构属性来提供文档。

* * *

## 回答 #11

> 赞同：80
> 
> 时间：2017-06-22T12:58:25.277

Here is what I found in the [Google Firebase documentation](https://firebase.google.com/docs/cloud-messaging/js/client#configure_the_browser_to_receive_messages) that allows you to put comments in JSON:

```
{
  "//": "Some browsers will use this to enable push notifications.",
  "//": "It is the same for all projects, this is not your project's sender ID",
  "gcm_sender_id": "1234567890"
} 
```

* * *

## 回答 #12

> 赞同：79
> 
> 时间：2014-02-06T20:44:24.047

If you are using [Jackson](https://github.com/FasterXML/jackson) as your JSON parser then this is how you enable it to allow comments:

```
ObjectMapper mapper = new ObjectMapper().configure(Feature.ALLOW_COMMENTS, true); 
```

Then you can have comments like this:

```
{
  key: "value" // Comment
} 
```

And you can also have comments starting with `#` by setting:

```
mapper.configure(Feature.ALLOW_YAML_COMMENTS, true); 
```

But in general (as answered before) the specification does not allow comments.

* * *

## 回答 #13

> 赞同：75
> 
> 时间：2015-11-27T19:35:08.907

**NO**. JSON used to support comments but they were abused and removed from the standard.

From the creator of JSON:

> I removed comments from JSON because I saw people were using them to hold parsing directives, a practice which would have destroyed interoperability. I know that the lack of comments makes some people sad, but it shouldn't. - [Douglas Crockford, 2012](https://web.archive.org/web/20120506232618/https://plus.google.com/118095276221607585885/posts/RK8qyGVaGSr)

The official JSON site is at [JSON.org](http://json.org). JSON is defined as a [standard](http://ecma-international.org/publications/standards/Ecma-404.htm) by ECMA International. There is always a petition process to have standards revised. It is unlikely that annotations will be added to the JSON standard for several reasons.

JSON by design is an easily reverse-engineered (human parsed) alternative to XML. It is simplified even to the point that annotations are unnecessary. It is not even a markup language. The goal is stability and interoperablilty.

Anyone who understands the "has-a" relationship of object orientation can understand any JSON structure - that is the whole point. It is just a directed acyclic graph (DAG) with node tags (key/value pairs), which is a near universal data structure.

This only annotation required might be "//These are DAG tags". The key names can be as informative as required, allowing arbitrary semantic arity.

Any platform can parse JSON with just a few lines of code. XML requires complex OO libraries that are not viable on many platforms.

Annotations would just make JSON less interoperable. There is simply nothing else to add unless what you really need is a markup language (XML), and don't care if your persisted data is easily parsed.

**BUT** as the creator of JSON also observed, there has always been JS pipeline support for comments:

> Go ahead and insert all the comments you like. Then pipe it through JSMin before handing it to your JSON parser. - [Douglas Crockford, 2012](https://web.archive.org/web/20120506232618/https://plus.google.com/118095276221607585885/posts/RK8qyGVaGSr)

* * *

## 回答 #14

> 赞同：50
> 
> 时间：2014-07-25T13:43:30.553

If you are using the Newtonsoft.Json library with ASP.NET to read/deserialize you can use comments in the JSON content:

> //"name": "string"
> 
> //"id": int

or

> /* This is a
> 
> comment example */

**PS:** Single-line comments are only supported with 6+ versions of Newtonsoft Json.

**Additional note for people who can't think out of the box:** I use the JSON format for basic settings in an ASP.NET web application I made. I read the file, convert it into the settings object with the Newtonsoft library and use it when necessary.

I prefer writing comments about each individual setting in the JSON file itself, and I really don't care about the integrity of the JSON format as long as the library I use is OK with it.

I think this is an 'easier to use/understand' way than creating a separate 'settings.README' file and explaining the settings in it.

If you have a problem with this kind of usage; sorry, the genie is out of the lamp. People would find other usages for JSON format, and there is nothing you can do about it.

* * *

## 回答 #15

> 赞同：47
> 
> 时间：2010-04-09T22:30:55.647

如果您的文本文件（一个 JSON 字符串）将被某个程序读取，那么在使用它之前去掉 C 或 C++ 样式的注释会有多困难？

**答：**应该是单排。如果你这样做，那么 JSON 文件可以用作配置文件。

* * *

## 回答 #16

> 赞同：39
> 
> 时间：2008-10-28T23:05:52.883

JSON 背后的想法是在应用程序之间提供简单的数据交换。这些通常是基于网络的，语言是 JavaScript。

它实际上不允许这样的注释，但是，将注释作为数据中的名称/值对之一传递肯定会起作用，尽管该数据显然需要被解析代码忽略或专门处理。

综上所述，JSON 文件不应该包含传统意义上的注释。它应该只是数据。

查看[JSON 网站](http://www.json.org/)了解更多详细信息。

* * *

## 回答 #17

> 赞同：38
> 
> 时间：2013-06-25T14:48:56.020

JSON does not support comments natively, but you can make your own decoder or at least preprocessor to strip out comments, that's perfectly fine (as long as you just ignore comments and don't use them to guide how your application should process the JSON data).

> JSON does not have comments. A JSON encoder MUST NOT output comments. A JSON decoder MAY accept and ignore comments.
> 
> Comments should never be used to transmit anything meaningful. That is what JSON is for.

Cf: [Douglas Crockford, author of JSON spec](http://tech.groups.yahoo.com/group/json/message/152).

* * *

## 回答 #18

> 赞同：35
> 
> 时间：2011-06-22T13:09:33.130

I just encountering this for configuration files. I don't want to use **XML** (verbose, graphically, ugly, hard to read), or "ini" format (no hierarchy, no real standard, etc.) or Java "Properties" format (like .ini).

JSON can do all they can do, but it is way less verbose and more human readable - and parsers are easy and ubiquitous in many languages. It's just a tree of data. But out-of-band comments are a necessity often to document "default" configurations and the like. Configurations are never to be "full documents", but trees of saved data that can be human readable when needed.

I guess one could use `"#": "comment"`, for "valid" JSON.

* * *

## 回答 #19

> 赞同：34
> 
> 时间：2012-08-04T00:56:39.137

It depends on your JSON library. [Json.NET](https://github.com/JamesNK/Newtonsoft.Json) supports JavaScript-style comments, `/* commment */`.

See [another Stack Overflow question](https://stackoverflow.com/a/10325432/166286).

* * *

## 回答 #20

> 赞同：33
> 
> 时间：2012-12-11T01:37:17.077

JSON makes a lot of sense for config files and other local usage because it's ubiquitous and because it's much simpler than XML.

If people have strong reasons against having comments in JSON when communicating data (whether valid or not), then possibly JSON could be split into two:

*   JSON-COM: JSON on the wire, or rules that apply when communicating JSON data.
*   JSON-DOC: JSON document, or JSON in files or locally. Rules that define a valid JSON document.

JSON-DOC will allow comments, and other minor differences might exist such as handling whitespace. Parsers can easily convert from one spec to the other.

With regards to the [remark](https://plus.google.com/118095276221607585885/posts/RK8qyGVaGSr) made by Douglas Crockford on this issues (referenced by @Artur Czajka)

> Suppose you are using JSON to keep configuration files, which you would like to annotate. Go ahead and insert all the comments you like. Then pipe it through JSMin before handing it to your JSON parser.

We're talking about a generic config file issue (cross language/platform), and he's answering with a JS specific utility!

Sure a JSON specific minify can be implemented in any language, but standardize this so it becomes ubiquitous across parsers in all languages and platforms so people stop wasting their time lacking the feature because they have good use-cases for it, looking the issue up in online forums, and getting people telling them it's a bad idea or suggesting it's easy to implement stripping comments out of text files.

The other issue is interoperability. Suppose you have a library or API or any kind of subsystem which has some config or data files associated with it. And this subsystem is to be accessed from different languages. Then do you go about telling people: by the way don't forget to strip out the comments from the JSON files before passing them to the parser!

* * *

## 回答 #21

> 赞同：32
> 
> 时间：2015-11-24T04:34:29.037

If you use [JSON5](http://json5.org/) you can include comments.

* * *

**JSON5 is a proposed extension to JSON** that aims to make it easier for humans to write and maintain by hand. It does this by adding some minimal syntax features directly from ECMAScript 5.

* * *

## 回答 #22

> 赞同：27
> 
> 时间：2020-11-19T07:35:20.037

**Yes**, the new standard, [JSON5](https://spec.json5.org/#comments) allows the C++ style comments, among many [other extensions](https://spec.json5.org/#introduction):

```
// A single line comment.

/* A multi-
   line comment. */ 
```

The JSON5 Data Interchange Format (JSON5) is a superset of JSON that aims to alleviate some of the limitations of JSON. It is fully backwards compatible, and using it is probably better than writing the custom non standard parser, turning non standard features on for the existing one or using various hacks like string fields for commenting. Or, if the parser in use supports, simply agree *we are using JSON 5 subset that is JSON and C++ style comments*. It is much better than *we tweak JSON standard the way we see fit*.

There is already [npm package](https://www.npmjs.com/package/json5), [Python package](https://pypi.org/project/json5/), [Java package](https://github.com/falkreon/Jankson) and [C library](https://gist.github.com/inlife/b54a0d9228e428284e1d8eccbed97e35) available. It is backwards compatible. I see no reason to stay with the "official" JSON restrictions.

I think that removing comments from JSON has been driven by the same reasons as removing the operator overloading in Java: can be used the wrong way yet some clearly legitimate use cases were overlooked. For operator overloading, it is matrix algebra and complex numbers. For JSON comments, its is configuration files and other documents that may be written, edited or read by humans and not just by parser.

* * *

## 回答 #23

> 赞同：26
> 
> 时间：2011-01-18T21:57:06.007

The Dojo Toolkit JavaScript toolkit (at least as of version 1.4), allows you to include comments in your JSON. The comments can be of `/* */` format. Dojo Toolkit consumes the JSON via the `dojo.xhrGet()` call.

Other JavaScript toolkits may work similarly.

This can be helpful when experimenting with alternate data structures (or even data lists) before choosing a final option.

* * *

## 回答 #24

> 赞同：24
> 
> 时间：2015-07-20T09:26:25.337

**JSON is not a framed protocol**. It is a *language free format*. So a comment's format is not defined for JSON.

As many people have suggested, there are some tricks, for example, duplicate keys or a specific key `_comment` that you can use. It's up to you.

* * *

## 回答 #25

> 赞同：24
> 
> 时间：2019-06-17T07:18:23.667

***Disclaimer: This is silly***

There is actually a way to add comments, and stay within the specification (no additional parser needed). It will not result into human-readable comments without any sort of parsing though.

You could abuse the following:

> Insignificant whitespace is allowed before or after any token. Whitespace is any sequence of one or more of the following code points: character tabulation (U+0009), line feed (U+000A), carriage return (U+000D), and space (U+0020).

In a hacky way, you can abuse this to add a comment. For instance: start and end your comment with a tab. Encode the comment in base3 and use the other whitespace characters to represent them. For instance.

```
010212 010202 011000 011000 011010 001012 010122 010121 011021 010202 001012 011022 010212 011020 010202 010202 
```

(`hello base three` in ASCII) But instead of 0 use space, for 1 use line feed and for 2 use carriage return.

This will just leave you with a lot of unreadable whitespace (unless you make an IDE plugin to encode/decode it on the fly).

I never even tried this, for obvious reasons and neither should you.

* * *

## 回答 #26

> 赞同：22
> 
> 时间：2013-10-07T20:37:38.397

You *can* have comments in [JSONP](http://en.wikipedia.org/wiki/JSONP), but not in pure JSON. I've just spent an hour trying to make my program work with this example from Highcharts: [http://www.highcharts.com/samples/data/jsonp.php?filename=aapl-c.json&callback=?](http://www.highcharts.com/samples/data/jsonp.php?filename=aapl-c.json&callback=?)

If you follow the link, you will see

```
?(/* AAPL historical OHLC data from the Google Finance API */
[
/* May 2006 */
[1147651200000,67.79],
[1147737600000,64.98],
...
[1368057600000,456.77],
[1368144000000,452.97]
]); 
```

Since I had a similar file in my local folder, there were no issues with the [Same-origin policy](http://en.wikipedia.org/wiki/Same-origin_policy), so I decided to use pure JSON... and, of course, `$.getJSON` was failing silently because of the comments.

Eventually I just sent a manual HTTP request to the address above and realized that the content-type was `text/javascript` since, well, JSONP returns pure JavaScript. In this case comments *are allowed*. But my application returned content-type `application/json`, so I had to remove the comments.

* * *

## 回答 #27

> 赞同：22
> 
> 时间：2014-04-24T17:23:08.623

This is a **"can you"** question. And here is a **"yes"** answer.

No, you shouldn't use duplicative object members to stuff side channel data into a JSON encoding. (See "The names within an object SHOULD be unique" [in the RFC](https://www.rfc-editor.org/rfc/rfc7159)).

And yes, you could [insert comments *around* the JSON](https://plus.google.com/+DouglasCrockfordEsq/posts/RK8qyGVaGSr), which you could parse out.

But if you want a way of inserting and extracting arbitrary side-channel data to a valid JSON, here is an answer. We take advantage of the non-unique representation of data in a JSON encoding. This is allowed^* in section two of the RFC under "whitespace is allowed before or after any of the six structural characters".

*^*The RFC only states "whitespace is allowed before or after any of the six structural characters", not explicitly mentioning strings, numbers, "false", "true", and "null". This omission is ignored in ALL implementations.*

* * *

First, canonicalize your JSON by minifying it:

```
$jsonMin = json_encode(json_decode($json)); 
```

Then encode your comment in binary:

```
$hex = unpack('H*', $comment);
$commentBinary = base_convert($hex[1], 16, 2); 
```

Then steg your binary:

```
$steg = str_replace('0', ' ', $commentBinary);
$steg = str_replace('1', "\t", $steg); 
```

Here is your output:

```
$jsonWithComment = $steg . $jsonMin; 
```

* * *

## 回答 #28

> 赞同：21
> 
> 时间：2016-08-26T17:31:47.383

In my case, I need to use comments for debug purposes just before the output of the JSON. So I put the debug information in the **HTTP header**, to avoid breaking the client:

```
header("My-Json-Comment: Yes, I know it's a workaround ;-) "); 
```

[![Enter image description here](https://i.stack.imgur.com/yMh3J.png)](https://i.stack.imgur.com/yMh3J.png)

* * *

## 回答 #29

> 赞同：21
> 
> 时间：2018-06-19T14:04:40.837

JSON doesn't allow comments, per se. The reasoning is utterly foolish, because you can use JSON *itself* to create comments, which obviates the reasoning entirely, *and* loads the parser data space for no good reason at all for *exactly* the same result and potential issues, such as they are: a JSON file with comments.

> **If you try to put comments in (using `//` or `/* */` or `#` for instance), then some parsers will fail because this is strictly not within the JSON specification. So you should *never* do that.**

Here, for instance, where my [image manipulation system](http://fyngyrz.com/?p=3389) has saved image notations and some basic formatted (comment) information relating to them (at the bottom):

```
{
    "Notations": [
        {
            "anchorX": 333,
            "anchorY": 265,
            "areaMode": "Ellipse",
            "extentX": 356,
            "extentY": 294,
            "opacity": 0.5,
            "text": "Elliptical area on top",
            "textX": 333,
            "textY": 265,
            "title": "Notation 1"
        },
        {
            "anchorX": 87,
            "anchorY": 385,
            "areaMode": "Rectangle",
            "extentX": 109,
            "extentY": 412,
            "opacity": 0.5,
            "text": "Rect area\non bottom",
            "textX": 98,
            "textY": 385,
            "title": "Notation 2"
        },
        {
            "anchorX": 69,
            "anchorY": 104,
            "areaMode": "Polygon",
            "extentX": 102,
            "extentY": 136,
            "opacity": 0.5,
            "pointList": [
                {
                    "i": 0,
                    "x": 83,
                    "y": 104
                },
                {
                    "i": 1,
                    "x": 69,
                    "y": 136
                },
                {
                    "i": 2,
                    "x": 102,
                    "y": 132
                },
                {
                    "i": 3,
                    "x": 83,
                    "y": 104
                }
            ],
            "text": "Simple polygon",
            "textX": 85,
            "textY": 104,
            "title": "Notation 3"
        }
    ],
    "imageXW": 512,
    "imageYW": 512,
    "imageName": "lena_std.ato",
    "tinyDocs": {
        "c01": "JSON image notation data:",
        "c02": "-------------------------",
        "c03": "",
        "c04": "This data contains image notations and related area",
        "c05": "selection information that provides a means for an",
        "c06": "image gallery to display notations with elliptical,",
        "c07": "rectangular, polygonal or freehand area indications",
        "c08": "over an image displayed to a gallery visitor.",
        "c09": "",
        "c10": "X and Y positions are all in image space. The image",
        "c11": "resolution is given as imageXW and imageYW, which",
        "c12": "you use to scale the notation areas to their proper",
        "c13": "locations and sizes for your display of the image,",
        "c14": "regardless of scale.",
        "c15": "",
        "c16": "For Ellipses, anchor is the  center of the ellipse,",
        "c17": "and the extents are the X and Y radii respectively.",
        "c18": "",
        "c19": "For Rectangles, the anchor is the top left and the",
        "c20": "extents are the bottom right.",
        "c21": "",
        "c22": "For Freehand and Polygon area modes, the pointList",
        "c23": "contains a series of numbered XY points. If the area",
        "c24": "is closed, the last point will be the same as the",
        "c25": "first, so all you have to be concerned with is drawing",
        "c26": "lines between the points in the list. Anchor and extent",
        "c27": "are set to the top left and bottom right of the indicated",
        "c28": "region, and can be used as a simplistic rectangular",
        "c29": "detect for the mouse hover position over these types",
        "c30": "of areas.",
        "c31": "",
        "c32": "The textx and texty positions provide basic positioning",
        "c33": "information to help you locate the text information",
        "c34": "in a reasonable location associated with the area",
        "c35": "indication.",
        "c36": "",
        "c37": "Opacity is a value between 0 and 1, where .5 represents",
        "c38": "a 50% opaque backdrop and 1.0 represents a fully opaque",
        "c39": "backdrop. Recommendation is that regions be drawn",
        "c40": "only if the user hovers the pointer over the image,",
        "c41": "and that the text associated with the regions be drawn",
        "c42": "only if the user hovers the pointer over the indicated",
        "c43": "region."
    }
} 
```

* * *

## 回答 #30

> 赞同：16
> 
> 时间：2014-11-27T11:39:27.390

We are using [`strip-json-comments`](https://github.com/sindresorhus/strip-json-comments) for our project. It supports something like:

```
/*
 * Description 
*/
{
    // rainbows
    "unicorn": /* ❤ */ "cake"
} 
```

Simply `npm install --save strip-json-comments` to install and use it like:

```
var strip_json_comments = require('strip-json-comments')
var json = '{/*rainbows*/"unicorn":"cake"}';
JSON.parse(strip_json_comments(json));
//=> {unicorn: 'cake'} 
```

* * *

## 回答 #31

> 赞同：15
> 
> 时间：2013-10-29T10:30:50.083

To cut a JSON item into parts I add "dummy comment" lines:

```
{

"#############################" : "Part1",

"data1"             : "value1",
"data2"             : "value2",

"#############################" : "Part2",

"data4"             : "value3",
"data3"             : "value4"

} 
```

* * *

## 回答 #32

> 赞同：12
> 
> 时间：2013-12-06T21:46:33.480

The author of JSON wants us to include comments in the JSON, but strip them out before parsing them (see [link](https://plus.google.com/118095276221607585885/posts/RK8qyGVaGSr) provided by Michael Burr). If JSON should have comments, why not standardize them, and let the JSON parser do the job? I don't agree with the logic there, but, alas, that's the standard. Using a YAML solution as suggested by others is good, but it requires a library dependency.

If you want to strip out comments, but don't want to have a library dependency, here is a two-line solution, which works for C++-style comments, but can be adapted to others:

```
var comments = new RegExp("//.*", 'mg');
data = JSON.parse(fs.readFileSync(sample_file, 'utf8').replace(comments, '')); 
```

Note that this solution can only be used in cases where you can be sure that the JSON data does not contain the comment initiator, e.g. ('//').

Another way to achieve JSON parsing, stripping of comments, and no extra library, is to evaluate the JSON in a JavaScript interpreter. The caveat with that approach, of course, is that you would only want to evaluate untainted data (no untrusted user-input). Here is an example of this approach in Node.js -- another caveat, the following example will only read the data once and then it will be cached:

```
data = require(fs.realpathSync(doctree_fp)); 
```

* * *

## 回答 #33

> 赞同：12
> 
> 时间：2015-12-29T05:12:25.087

You can use JSON with comments in it, if you load it as a text file, and then remove comments.

For example, you can use [decomment](https://www.npmjs.com/package/decomment) library for that. Below is a complete example.

**Input JSON (file input.js):**

```
/*
* multi-line comments
**/
{
    "value": 123 // one-line comment
} 
```

**Test Application:**

```
var decomment = require('decomment');
var fs = require('fs');

fs.readFile('input.js', 'utf8', function (err, data) {
    if (err) {
        console.log(err);
    } else {
        var text = decomment(data); // removing comments
        var json = JSON.parse(text); // parsing JSON
        console.log(json);
    }
}); 
```

Output:

```
{ value: 123 } 
```

See also: [gulp-decomment](https://github.com/vitaly-t/gulp-decomment), [grunt-decomment](https://github.com/vitaly-t/grunt-decomment)

* * *

## 回答 #34

> 赞同：10
> 
> 时间：2013-11-28T13:48:59.730

Sigh. Why not just add fields, e.g.

```
{
    "note1" : "This demonstrates the provision of annotations within a JSON file",
    "field1" : 12,
    "field2" : "some text",

    "note2" : "Add more annotations as necessary"
} 
```

Just make sure your "notex" names don't conflict with any real fields.

* * *

## 回答 #35

> 赞同：10
> 
> 时间：2019-11-06T13:43:20.737

The [JSON specification](https://www.json.org/) does not support comments, `// or /* */` style.

But some JSON parsing libraries and IDEs support them.

Like:

1.  [JSON5](https://json5.org/)
2.  [Visual Studio Code](https://code.visualstudio.com/docs/languages/json#_json-with-comments)
3.  [Commentjson](https://github.com/vaidik/commentjson)

* * *

## 回答 #36

> 赞同：9
> 
> 时间：2014-07-03T05:06:12.903

I just found "[grunt-strip-json-comments](https://www.npmjs.org/package/grunt-strip-json-comments)".

> “Strip comments from JSON. It lets you use comments in your JSON files!”</p>

```
{
    // Rainbows
    "unicorn": /* ❤ */ "cake"
} 
```

* * *

## 回答 #37

> 赞同：8
> 
> 时间：2014-01-28T15:04:17.083

There is a good solution (hack), which is valid JSON, **but it will not work in all cases** (see comments below). Just make the same key twice (or more). For example:

```
{
  "param" : "This is the comment place",
  "param" : "This is value place",
} 
```

So JSON will understand this as:

```
{
  "param" : "This is value place",
} 
```

* * *

## 回答 #38

> 赞同：8
> 
> 时间：2019-01-23T14:15:41.060

The practical answer for [Visual Studio Code](https://en.wikipedia.org/wiki/Visual_Studio_Code) users in 2019 is to use the 'jsonc' extension.

It is practical, because that is the extension recognized by Visual Studio Code to indicate "JSON with comments". Please let me know about other editors/IDEs in the comments below.

It would be nice if Visual Studio Code and other editors would add native support for JSON5 as well, but for now Visual Studio Code only includes support for 'jsonc'.

(I searched through all the answers before posting this and none mention 'jsonc'.)

* * *

## 回答 #39

> 赞同：8
> 
> 时间：2021-06-25T02:55:11.367

As [the inventor of JSON said](https://web.archive.org/web/20130101004216/http://tech.groups.yahoo.com:80/group/json/message/152):

> JSON does not have comments. A JSON encoder MUST NOT output comments. A JSON decoder MAY accept and ignore comments.

The utility [jq](/questions/tagged/jq "show questions tagged 'jq'") includes a decoder that does allow "#"-style comments and so jq is one of several tools that can be used in conjunction with JSON-with-comments files, so long as such files are treated as "jq programs", rather than as JSON files. For example:

```
$ jq -ncf <(echo $'[1, # one\n2 ] # two') 
[1,2] 
```

More importantly, jq can handle very large JSON-with-comments files as programs; this can be illustrated using a well-known JSON file:

```
$ ls -l JEOPARDY_QUESTIONS1.json
-rw-r--r--  2 xyzzy  staff  55554625 May 12  2016 JEOPARDY_QUESTIONS1.json

$ jq -nf JEOPARDY_QUESTIONS1.json | jq length
216930 
```

* * *

## 回答 #40

> 赞同：7
> 
> 时间：2014-07-19T10:29:43.623

If your context is Node.js configuration, you might consider JavaScript via `module.exports` as an alternative to JSON:

```
module.exports = {
    "key": "value",

    // And with comments!
    "key2": "value2"
}; 
```

The `require` syntax will still be the same. Being JavaScript, the file extension should be `.js`.

* * *

## 回答 #41

> 赞同：6
> 
> 时间：2015-11-07T13:59:20.540

As many answers have already pointed out, JSON does not natively have comments. Of course sometimes you want them anyway. For **Python**, two ways to do that are with [`commentjson`](https://github.com/vaidik/commentjson) (`#` and `//` for Python 2 only) or [`json_tricks`](https://github.com/mverleg/pyjson_tricks) (`#` or `//` for Python 2 and Python 3), which has several other features. Disclaimer: I made `json_tricks`.

* * *

## 回答 #42

> 赞同：6
> 
> 时间：2021-08-14T10:05:53.983

The Pure answer is **No**.

But some editors and platforms use workarounds to add comments to JSON.

**1**. Today most editors have built-in options and extensions to add comments to JSON documents. (eg:- VS Code also has a JSON with Comments `(jsonc) mode` / VS Code also has nice extensions for that)

[Link to activate jsonc mode in VsCode](https://code.visualstudio.com/docs/languages/json#_json-with-comments)

**2**. Some platforms provide built-in ways to add comments (impure json). (eg:- In firebase, I can comment `firebase.json`s for a while without issue.

```
 {
    "hosting": {
        "headers": [
            /*{
              "source": "*.html",
              "headers": [
                {
                  "key": "Content-Security-Policy",
                  "value": "default-src 'self' ..."
                }
              ]
            },*/
        ]
      }
    } 
```

**3**. In your own JSON parsing method, you can set a predefined key name as a comment.

eg:-

```
 {
        "comment" : "This is a comment",
        "//" :  "This also comment",
        "name" : "This is a real value"
     } 
```

* * *

## 回答 #43

> 赞同：5
> 
> 时间：2017-04-16T17:32:31.610

You can use simple preprocessing via regular expressions. For instance, the following function will decode commented JSON in PHP:

```
function json_decode_commented ($data, $objectsAsArrays = false, $maxDepth = 512, $opts = 0) {
  $data = preg_replace('~
    (" (?:[^"\\\\] | \\\\\\\\ | \\\\")*+ ") | \# [^\v]*+ | // [^\v]*+ | /\* .*? \*/
  ~xs', '$1', $data);

  return json_decode($data, $objectsAsArrays, $maxDepth, $opts);
} 
```

It supports all PHP-style comments: /*, #, //. String literals are preserved as is.

* * *

## 回答 #44

> 赞同：4
> 
> 时间：2016-12-08T11:21:37.507

Yes, you can have comments. But I will not recommend whatever reason mentioned above.

I did some investigation, and I found all JSON require methods use the `JSON.parse` method. So I came to a solution: We can override or do monkey patching around JSON.parse.

> Note: tested on Node.js only ;-)

```
var oldParse = JSON.parse;
JSON.parse = parse;
function parse(json){
    json = json.replace(/\/\*.+\*\//, function(comment){
        console.log("comment:", comment);
        return "";
    });
    return oldParse(json)
} 
```

JSON file:

```
{
  "test": 1
  /* Hello, babe */
} 
```

* * *

## 回答 #45

> 赞同：4
> 
> 时间：2018-07-08T13:11:46.130

*.json files are generally used as configuration files or static data, thus the need of comments → some editors like NetBeans accept comments in *.json.

The problem is parsing content to an object. The solution is to always apply a cleaning function (server or client).

###PHP

```
 $rgx_arr = ["/\/\/[^\n]*/sim", "/\/\*.*?\*\//sim", "/[\n\r\t]/sim"];
 $valid_json_str = \preg_replace($rgx_arr, '', file_get_contents(path . 'a_file.json')); 
```

###JavaScript

```
valid_json_str = json_str.replace(/\/\/[^\n]*/gim,'').replace(/\/\*.*?\*\//gim,'') 
```

* * *

## 回答 #46

> 赞同：4
> 
> 时间：2019-03-19T09:52:58.593

Sure you can comment JSON. To read a commented JSON file from JavaScript you can strip comments before parsing it (see the code below). I'm sure this code can be improved, but it is easy to understand for those who use regular expressions.

I use commented JSON files to specify neuron shapes for my synthetic reflex systems. I also use commented JSON to store intermediate states for a running neuron system. It is very convenient to have comments. Don't listen to didacts who tell you they are a bad idea.

```
fetch(filename).then(function(response) {
    return response.text();
}).then(function(commented) {
    return commented.
        replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm, '$1').
        replace(/\r/,"\n").
        replace(/\n[\n]+/,"\n");
}).then(function(clean) {
    return JSON.parse(clean);
}).then(function(json) {
    // Do what you want with the JSON object.
}); 
```

* * *

## 回答 #47

> 赞同：3
> 
> 时间：2016-03-25T02:46:12.850

If you are using PHP, you can use this function to search for and remove // /* type comments from the JSON string before parsing it into an object/array:

```
function json_clean_decode($json, $assoc = true, $depth = 512, $options = 0) {
       // search and remove comments like /* */ and //
       $json = preg_replace("#(/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+/)|([\s\t]//.*)|(^//.*)#", '', $json);

       if(version_compare(phpversion(), '5.4.0', '>=')) {
           $json = json_decode($json, $assoc, $depth, $options);
       }
       elseif(version_compare(phpversion(), '5.3.0', '>=')) {
           $json = json_decode($json, $assoc, $depth);
       }
       else {
           $json = json_decode($json, $assoc);
       }

       return $json;
   } 
```

Hope this helps!

* * *

## 回答 #48

> 赞同：3
> 
> 时间：2021-11-28T01:20:45.160

Well at the time of writing, **appsettings.json** supports comments.

e.g. ([sample](https://docs.microsoft.com/en-us/aspnet/core/fundamentals/logging/?view=aspnetcore-6.0#configure-logging) courtesy of Microsoft)

```
{
  "Logging": {
    "LogLevel": { // All providers, LogLevel applies to all the enabled providers.
      "Default": "Error", // Default logging, Error and higher.
      "Microsoft": "Warning" // All Microsoft* categories, Warning and higher.
    },
    "Debug": { // Debug provider.
      "LogLevel": {
        "Default": "Information", // Overrides preceding LogLevel:Default setting.
        "Microsoft.Hosting": "Trace" // Debug:Microsoft.Hosting category.
      }
    },
    "EventSource": { // EventSource provider
      "LogLevel": {
        "Default": "Warning" // All categories of EventSource provider.
      }
    }
  }
} 
```

* * *

## 回答 #49

> 赞同：2
> 
> 时间：2016-02-11T18:41:26.177

You can use [JSON-LD](https://www.w3.org/TR/json-ld/) and the [schema.org comment](https://schema.org/comment) type to properly write comments:

```
{
    "https://schema.org/comment": "this is a comment"
} 
```

* * *

## 回答 #50

> 赞同：1
> 
> 时间：2015-07-02T19:48:44.633

There are other libraries that are JSON compatible, which support comments.

One notable example is the ["Hashcorp Language" (HCL)"](https://github.com/hashicorp/hcl). It is written by the same people who made Vagrant, packer, consul, and vault.

* * *

## 回答 #51

> 赞同：1
> 
> 时间：2019-04-06T08:38:47.707

I came across this problem in my current project as I have quite a bit of JSON that requires some commenting to keep things easy to remember.

I've used this simple Python function to replace comments & use `json.loads` to convert it into a `dict`:

```
import json, re

def parse_json(data_string):
  result = []
  for line in data_string.split("\n"):
    line = line.strip()
    if len(line) < 1 or line[0:2] == "//":
      continue
    if line[-1] not in "\,\"\'":
      line = re.sub("\/\/.*?$", "", line)
    result.append(line)
  return json.loads("\n".join(result))

print(parse_json("""
{
  // This is a comment
  "name": "value" // so is this
  // "name": "value"
  // the above line gets removed
}
""")) 
```

* * *

## 回答 #52

> 赞同：1
> 
> 时间：2020-06-12T06:43:13.947

Yes. You can put comments in a JSON file.

```
{
    "": "Location to post to",
    "postUrl": "https://example.com/upload/",

    "": "Username for basic auth",
    "username": "joebloggs",

    "": "Password for basic auth (note this is in clear, be sure to use HTTPS!",
    "password": "bloejoggs"
} 
```

A comment is simply a piece of text describing the purpose of a block of code or configuration. And because you can specify keys multiple times in JSON, you can do it like this. It's syntactically correct and the only tradeoff is you'll have an empty key with some garbage value in your dictionary (which you could trim...)

I saw this question years and years ago but I only just saw this done like this in a project I'm working on and I thought this was a really clean way to do it. Enjoy!

* * *

## 回答 #53

> 赞同：0
> 
> 时间：2020-10-05T05:23:44.300

I really like @eli 's approach, there are over 30 answers but no one has mentioned lists (array). So using @eli 's approach we could do something like:

```
"part_of_speech": {
  "__comment": [
    "@param {String} type - the following types can be used: ",
      "NOUN, VERB, ADVERB, ADJECTIVE, PRONOUN, PREPOSITION",
      "CONJUNCTION, INTERJECTION, NUMERAL, PARTICLE, PHRASE",
    "@param {String} type_free_form - is optional, can be empty string",
    "@param {String} description - is optional, can be empty string",
    "@param {String} source - is optional, can be empty string"
  ],
  "type": "NOUN",
  "type_free_form": "noun",
  "description": "",
  "source": "https://google.com",
  "noun_class": {
    "__comment": [
      "@param {String} noun_class - the following types can be used: ",
        "1_class, 2_class, 3_class, 4_class, 5_class, 6_class"
    ],
    "noun_class": "4_class"
  }
} 
```

* * *

## 回答 #54

> 赞同：0
> 
> 时间：2021-12-16T02:53:21.417

Although JSON does not support comments, **JSONC** does.

Name your file with '.jsonc' extension and use a **jsonc** parser.
Sorry if this answer was too late.

```
jsonWithComments.jsonc 
```

Example:

```
{
    // This is a comment!
    "something": "idk"

} 
```

If this is unclear, I think the bot is weird. Please try before voting this question as unhelpful.

* * *

## 回答 #55

> 赞同：0
> 
> 时间：2022-02-17T11:49:54.143

json specs doesn't support comments BUT you can work around the problem by writing your comment as keys, like this

```
{
  "// my own comment goes here":"",
  "key1":"value 1",

  "// another comment goes here":"",
  "key 2": "value 2 here"
} 
```

this way we are using the comment texts as keys ensuring (almost) that they are unique and they will not break any parsers. if some of your comments are not unique just add random numbers at the end.

if you need to parse comments to do any processing like stripping them you can fill the comment values with text indicating that it is a comment , like so:

```
 {
  "// my own comment goes here" : "_comment",
  "key1":"value 1",

  "// another comment goes here" : "_comment",
  "key 2": "value 2 here"
} 
```

this way a parser can find all comments and process them.

* * *

## 回答 #56

> 赞同：-2
> 
> 时间：2021-03-10T18:09:05.643

Comments are needed in JSON and **comments ARE available in at least .NET Core** JSON and Newtonsoft Json. Works perfectly.

```
{
  // this is a comment for those who is ok with being different
  "regular-json": "stuff"...
} 
```

* * *

## 回答 #57

> 赞同：-4
> 
> 时间：2014-07-07T20:08:00.100

Yes, you can, but your parse will probably fail (there is no standard).

To parse it you should remove those comments, or by hand, or using a regular expression:

It replaces any comments, like:

```
/****
 * Hey
 */

/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*\/+/ 
```

It replaces any comments, like:

```
// Hey

/\/\/.*/ 
```

In JavaScript, you could do something like this:

```
jsonString = jsonString.replace(/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*\/+/, "").replace(/\/\/.*/,"")
var object = JSON.parse(jsonString); 
```

# ruby-on-rails - 在 respond_to 块中共享代码

> ID：244779
> 
> 赞同：1
> 
> 时间：2008-10-28T20:39:58.823
> 
> 标签：ruby-on-rails, ruby

我有以下内容`before_filter`：

```
 def find_current_membership
    respond_to do |wants|
      wants.html { @current_membership = @group.memberships.for(@current_user) }
      wants.rss  {}
      wants.js   { @current_membership = @group.memberships.for(@current_user) }
    end
  end 
```

我想分享 HTML 和 JS 块的代码。有没有比仅仅将代码扔到方法中更好的方法？我希望这会奏效：

```
 def find_current_membership
    respond_to do |wants|
      wants.rss  {}
      wants.all  { @current_membership = @group.memberships.for(@current_user) }
    end
  end 
```

但很可惜，它没有。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-28T21:14:20.643

如果我没看错，看起来`find_current_membership`是你的`before_filter`方法，对吗？例如：

```
class SomeController < ApplicationController
  before_filter :find_current_membership
  ... 
```

我认为在 a 中使用有点不标准`respond_to`，`before_filter`它们只是为了做一些事情并在失败时渲染。在我看来你想要更像这样的东西

```
 class SomeController < ApplicationController
      before_filter :find_current_membership

      def some_action
        # stuff, or maybe nothing
      end

   private
      def find_current_membership
         @current_membership = @group.memberships.for(@current_user) unless request.format.rss?
      end
   end 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T20:51:51.250

在这种情况下，您可能可以执行以下操作：

```
before_filter :only => :find_current_membership do |c|
    load_current_membership if not request.format.rss?
end 
```

或者，您可以使用 request.format.rss？在您的控制器方法中有条件地加载成员资格。

无论哪种方式，您的第一步都应该是将其重构为一种方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T12:08:48.480

这个简单的解决方案怎么样！？

```
def find_current_membership
  @current_membership = @group.memberships.for(@current_user)
  respond_to do |wants|
    wants.html
    wants.rss  {}
    wants.js
  end
end 
```

# c++ - C++ 的 YAML 序列化库？

> ID：244784
> 
> 赞同：18
> 
> 时间：2008-10-28T20:40:49.260
> 
> 标签：c++, serialization, boost, persistence, yaml

YAML 似乎是配置文件和数据绑定持久对象的一种很好的格式，以人类可读的形式......

是否有处理 YAML 的 C++ 库？Boost::Serialization 是否有 YAML 选项的计划？

**编辑：我更喜欢 OO 库。**

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-28T23:30:51.757

快速搜索给了我这个：[yaml-cpp](https://github.com/jbeder/yaml-cpp)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-04-08T18:22:27.593

[试试BOOST 库序列化库](https://github.com/boost-vault/serialization)中的 YAML 组件。

**编辑 2014**：最近的发展，[https ://groups.google.com/d/msg/boost-devel-archive/mhT7qIh1nsI/uXAuXFAWrxQJ](https://groups.google.com/d/msg/boost-devel-archive/mhT7qIh1nsI/uXAuXFAWrxQJ)

**编辑 2019**：还没有尝试过，但这似乎是一个严肃的问题：[https ://github.com/rwols/yaml-archive](https://github.com/rwols/yaml-archive)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-20T10:36:18.383

我找到了这个，如果你使用它，请告诉我它是如何为你做的，如果可能的话，发布一些例子，

[https://code.google.com/p/google-summer-of-code-2008-boost/downloads/list](https://code.google.com/p/google-summer-of-code-2008-boost/downloads/list)

更新的链接（如 2014 年），它似乎指向与 BOOST 保险库答案相同的文件。

# python - 将 MATLAB 函数移植到 Scilab。如何使用符号？

> ID：244803
> 
> 赞同：3
> 
> 时间：2008-10-28T20:44:25.320
> 
> 标签：python, matlab, porting, scilab, sympy

我正在将一些[MATLAB](http://en.wikipedia.org/wiki/MATLAB)函数移植到[Scilab](https://en.wikipedia.org/wiki/Scilab)。很酷的是，有一个[转换工具箱](http://ralyx.inria.fr/2004/Raweb/scilab/uid96.html)可以让事情变得非常简单。

问题是我没有找到**syms**功能的对应物，以及一般的符号工具箱。（我也想要*控制系统工具箱*的一个端口，而且我仍在寻找一些我可能需要的功能）。

我发现的关于符号工具箱的唯一一件事就是[这个](http://www.cert.fr/dcsd/idco/perso/Magni/s_sym/doc/index.html)，但它有点棘手而且不太容易（实际上我无法在 30 分钟内正确设置它，我现在放弃了。我要去稍后再试），它需要安装 Maxima。有人知道吗？

Scilab 并不是必须的。该项目旨在为 MATLAB提供更*免费*和*开源的替代方案。*我看到有用于[Python的](http://en.wikipedia.org/wiki/Python_%28programming_language%29)[SymPy](http://code.google.com/p/sympy/)，我可以将它与[SciPy](http://www.scipy.org/)一起使用，但我丢失了[转换工具箱](http://ralyx.inria.fr/2004/Raweb/scilab/uid96.html)的东西：\

也就是说，什么应该更好？让 SciLab 和 Maxima 一起工作还是转移到 Python & co.？这是项目的开始，所以我越早选择这个越好。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-29T11:24:13.593

再见[MATLAB，你好 Python，感谢 Sage提供从](http://vnoel.wordpress.com/2008/05/03/bye-matlab-hello-python-thanks-sage/)[MATLAB](http://en.wikipedia.org/wiki/MATLAB)迁移到 Python的第一手经验。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T23:04:13.667

不要阻止您的项目，但如果您只是想要一个*免费*和*开源的*[MATLAB](http://en.wikipedia.org/wiki/MATLAB)替代品，您是否看过[Octave](http://en.wikipedia.org/wiki/GNU_Octave)项目？在那里做出贡献可能比构建自己的 MATLAB 替代方案更有成效。

如果您的项目需要 MATLAB 的 Symbolic 功能，请查看

*   [http://wiki.octave.org/wiki.pl?CategorySymbolic](http://wiki.octave.org/wiki.pl?CategorySymbolic)

从我的快速谷歌搜索中，我没有找到任何可以与 MATLAB 的 Simulink 相媲美的东西。

此外，Python 和 SciPy 确实具有 MATLAB 的大部分功能，我猜 Scilab 的转换实用程序在将您自己的 M 文件移植到 Scilab 代码时会很有用。

您的问题似乎暗示您想通过 MATLAB Toolboxes 进行移植

> 我发现的关于符号工具箱的唯一内容是......

我希望我只是误解了你。如果您使用 MATLAB 工具箱来分发您的系统，那么您可能会遇到许可问题。只是一个想法。但也许您希望将您的 MATLAB 代码移植到，这样它就没有 MATLAB 依赖项。

### 更新

对于控制系统功能 Octave，我刚刚发现 Octave 确实有一个工具箱，请参阅：

*   [八度控制系统工具箱](http://www.obihiro.ac.jp/~suzukim/masuda/octave/html/octave_125.html)

它具有 Simulink 的一些功能，但似乎没有用于构建框图的图形界面。

# asp.net - 如何在asp.net网站中使用图片资源？

> ID：244807
> 
> 赞同：9
> 
> 时间：2008-10-28T20:44:32.700
> 
> 标签：asp.net, resources, globalization

我有 ac# 网站，它使用了很多嵌入英文文本的图像。

如何使用标准资源文件根据语言交换图像？

我的 App_GlobalResources 目录中有一个 resx 文件，但我似乎无法将它正确插入到 imageurl 的 asp:image 控件中。

想法？

**更新：**

有关更多信息，这里是图像标记代码：

```
<asp:image runat="server" ID="img2" ImageUrl="<%$Resources: Resource, cs_logo %>" /> 
```

客户端的结果是：

```
<img id="img2" src="System.Drawing.Bitmap" style="border-width:0px;" /> 
```

请注意，来源显然不是我所期望的......

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-28T20:51:38.487

您可以将图像的 url 存储在资源文件中，并在控件中使用以下内联代码

```
<asp:Image ImageUrl="<%$resources:Image1 %>" /> 
```

### 更新

此[链接](http://aspalliance.com/726)可能对您要完成的工作有所帮助

或者

您还可以尝试将资源存储为字符串并将值设置为 url 位置，而不是将图像存储在资源文件中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-28T22:36:04.643

您可能会尝试做的一件事是创建一个简单的“图像服务”，它可以从嵌入的资源中以适当的格式提供图像。

您不必自己创建 Web 服务，只需创建一个 aspx 页面并在后面的代码中将 Response.ContentType 更改为“image/png”或您喜欢的任何格式。这也需要页面本身的 URL 中的 get 参数，但可以轻松过滤。因此，图像服务的 Page_Load 方法可能如下所示：

```
Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load

      Dim FinalBitmap As Bitmap
      Dim strRenderSource As String
      Dim msStream As New MemoryStream()

      strRenderSource = Request.Params("ImageName").ToString()

      ' Write your code here that gets the image from the app resources.
      FinalBitmap = New Bitmap(Me.Resources(strRenderSource))
      FinalBitmap.Save(msStream, ImageFormat.Png)

      Response.Clear()
      Response.ContentType = "image/png"

      msStream.WriteTo(Response.OutputStream)

      If Not IsNothing(FinalBitmap) Then FinalBitmap.Dispose()

End Sub 
```

然后回到你的 ASPX 页面，你有......

```
<asp:Image ImageUrl="http://localhost/GetImage.aspx?ImageName=Image1" /> 
```

哦，别忘了在页面中导入 System.Drawing 和 System.Drawing.Imaging。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-04T14:39:11.477

如果您使用的是全局资源文件，则需要像这样添加它

```
<img id="WelocmeICon" runat="server"  alt="welcome icon" 
     src="<%$resources:NmcResource,WelcomeIcon %>"  /> 
```

因为我使用 img 控件，所以我为它添加了 runatserver 和 id

# ruby-on-rails - form_for 内的 text_field_with_auto_complete

> ID：244808
> 
> 赞同：4
> 
> 时间：2008-10-28T20:45:46.067
> 
> 标签：ruby-on-rails, ruby

真的很简单的问题 - 我如何在块`text_field_with_auto_complete`内使用`form_for`？

我尝试过这样做`f.text_field_with_auto_complete`，但这会产生错误，并且单独使用`text_field_with_auto_complete`似乎没有任何作用。

我在这里错过了什么吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-29T21:56:42.570

我个人使用这个：

```
<%= f.text_field :name, :autocomplete => "off" %><div class="auto_complete" id="customer_name_auto_complete"></div> 
```

并手动添加自动生成的 Javascript 和 CSS。这是Javascript：

```
new Ajax.Autocompleter('customer_name', 'customer_name_auto_complete', '/customers/auto_complete_for_customer_name', {
    method:'get',
    paramName:'customer[name]',
    minChars: 3
}); 
```

这是CSS：

```
div.auto_complete {
  width: 350px;
  background: #fff;
}

div.auto_complete ul {
  border:1px solid #888;
  margin:0;
  padding:0;
  width:100%;
  list-style-type:none;
}

div.auto_complete ul li {
  margin:0;
  padding:3px;
}

div.auto_complete ul li.selected {
  background-color: #ffb;
}

div.auto_complete ul strong.highlight {
  color: #800;
  margin:0;
  padding:0;
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-10T13:55:42.537

几个月前，我写了一个插件，允许你`text_field_with_auto_complete`直接在`fields_for`or上调用 "" 方法`form_for`。这个想法是通过生成唯一的 id 来支持在表单中多次出现的文本字段以允许 javascript 工作，但它也可能有助于解决您的问题，或者至少给您一些新的想法。

见：http: [//github.com/pat11639/repeated_auto_complete](http://github.com/pat11639/repeated_auto_complete)

...以及有关其工作原理的详细信息：http: [//patshaughnessy.net/2008/10/31/modifying-the-autocomplete-plugin-to-allow-repeated-fields](http://patshaughnessy.net/2008/10/31/modifying-the-autocomplete-plugin-to-allow-repeated-fields)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T00:33:22.910

如果您的意图是设置一个 id 字段，您必须：

1.  在 LI 项中呈现结果，每个 li 都将其 DOM id 设置为返回记录的 id，如下所示：

    ```
    <UL>
           <LI ID="1">Item 1</LI>
           < LI ID="2">Item 2< /LI>
    </UL> 
    ```

2.  您的文本字段将类似于：

    ```
    <%= text_field_with_auto_complete :model, :method, {}, :after_update_element => ‘getSelectionId’ % > 
    ```

3.  和一个像这样的名为 getSelectionId 的 javascript 方法

    ```
    function getSelectionId(text, li) {

    alert (li.id);

    } 
    ```

请注意，您可以通过 javascript 执行任何操作，因为您有可用的文本和 li 元素。

另一个选择是[这个插件](http://agilewebdevelopment.com/plugins/model_auto_completer)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-05T14:17:34.093

即使在 form_for 块中，您也需要指定完整模型，因为它用于构造 Ajax 回调。同样在列出的空哈希 Ricardo 中，您可以将其他选项传递给自动完成字段，包括“：token”等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-02T01:19:28.640

我也有这个问题，但我使用的解决方案可能不适用于你。

由于我在自动完成中查询的对象属于不同的模型，所以我使用了这样的 fields_for，它解决了自动完成问题。

```
<% fields_for :model, @formobject.model do %>
<p>
<%= text_field_with_auto_complete :object, :field, :skip_style => true %>
</p>
<% end %> 
```

祝你好运！

# c# - 为 Web 服务生成动态 XML 的最佳方式是什么？

> ID：244811
> 
> 赞同：2
> 
> 时间：2008-10-28T20:46:14.037
> 
> 标签：c#, .net, xml

对于我的 Web 服务组件，我需要根据许多因素生成一个相对较大的 XML（约 500 行）。我在这里面临几个不同的选择：1\. StringBuilder 2\. XmlWriter 类 3\. 带有序列化的 C# 对象？？？

我应该使用哪一个。还有其他我不知道的方法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T20:56:16.607

如果使用数据库中的数据填充 XML，则可以使用 SQL 查询生成整个 XML，并创建一个具有包含 XML blob 的属性的类。属性类型可以是 XElement。这是我能想到的最简单的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T20:50:42.763

我使用 LINQ to XML 非常简单地生成了一个 RSS 提要。老实说，这是我所知道的最好的 XML API。

我有几个扩展方法，我用它们来使它更容易 - 它从匿名类型转换为元素或属性：

```
 public static IEnumerable<XElement> AsXElements(this object source)
  {
      foreach (PropertyInfo prop in source.GetType().GetProperties())
      {
          object value = prop.GetValue(source, null);
          yield return new XElement(prop.Name.Replace("_", "-"), value);
      }
  }

  public static IEnumerable<XAttribute> AsXAttributes(this object source)
  {
      foreach (PropertyInfo prop in source.GetType().GetProperties())
      {
          object value = prop.GetValue(source, null);
          yield return new XAttribute(prop.Name.Replace("_", "-"), value ?? "");
      }
  } 
```

这可能根本不适合你，但我觉得它真的很方便。当然，这假设您使用的是 .NET 3.5 ...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T21:25:58.950

需要更多信息，但我不会使用对象序列化。它非常死板并且隐藏了太多的实现。特别是当您自己的应用程序以外的其他人使用时。我也不会使用 StringBuilder ，因为突然之间您正在处理内容的转义并自己完成所有艰苦且容易出错的工作。

对于低级的东西，XmlWriter 是一个不错的选择。如果你是临清，那么 XElement 的东西很不错。

# nhibernate - NHibernate 一对一映射，其中第二个表数据可以为空

> ID：244812
> 
> 赞同：11
> 
> 时间：2008-10-28T20:46:15.143
> 
> 标签：nhibernate, one-to-one

我有一个现有的数据库，其中包含表 Transactions。我添加了一个名为 TransactionSequence 的新表，其中每个事务最终只有一条记录。我们正在使用序列表来计算给定帐户的交易。我已将其映射为一对一映射，其中 TransactionSequence 具有 TransactionId 的主键。

约束是事务表上有一个代替触发器不允许更新已取消或已发布的事务。

因此，当计算序列并保存事务时，NHibernate 会尝试发送事务更新，例如 'UPDATE Transaction SET TransactionId = ? WHERE TransactionId = ?'。但是由于触发器，这失败了。如何配置我的映射，以便 NHibernate 在插入新的 TransactionSequence 表时不会尝试更新 Transaction 表？

事务映射：

```
<class name="Transaction" table="Transaction" dynamic-update="true" select-before-update="true">
    <id name="Id" column="ID">
        <generator class="native" />
    </id>

    <property name="TransactionTypeId" access="field.camelcase-underscore" />
    <property name="TransactionStatusId" column="DebitDebitStatus" access="field.camelcase-underscore" />

    <one-to-one name="Sequence" class="TransactionSequence" fetch="join"
                 lazy="false" constrained="false">      
    </one-to-one>
</class> 
```

和序列映射：

```
<class name="TransactionSequence" table="TransactionSequence" dynamic-update="true">
    <id name="TransactionId" column="TransactionID" type="Int32">
        <generator class="foreign">
            <param name="property">Transaction</param>
        </generator>
    </id>

    <version name="Version" column="Version" unsaved-value="-1" access="field.camelcase-underscore" />

    <property name="SequenceNumber" not-null="true" />

    <one-to-one name="Transaction" 
                class="Transaction" 
                constrained="true" 
                foreign-key="fk_Transaction_Sequence" />

</class> 
```

任何帮助将不胜感激...

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-28T21:05:03.860

nhibernate 中的一对一映射并不像你想象的那样工作。它的设计目的是让您有两个类，当它们持久保存到它们相应的表时，它们具有相同的主键。

但是你可以让它工作，但它并不漂亮。我将向您展示如何提供一些替代方案：

在您的事务 hbml 中：

```
<one-to-one name="Sequence" class="TransactionSequence" property-ref="Transaction"/> 
```

在您的序列 html 中：

```
<many-to-one name="Transaction" class="Transaction" column="fk_Transaction_Sequence" /> 
```

这*应该*做你想做的事。注意属性-ref。

您要发布的下一个问题将询问您如何在一对一关联上进行延迟加载。答案是，你不能……你可以，但它可能行不通。问题是您在序列表上有外键，这意味着 nhibernate 必须访问数据库以查看目标是否存在。然后你可以试着玩一下 constrained="true/false" 看看你能不能说服它懒加载一对一的关联。

总而言之，这将完全浪费您的时间。

我建议：

1.  有两个多对一关联。
2.  与另一端的集合具有多对一关联。

从长远来看，这将为您省去很多麻烦。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T12:58:52.717

事实证明，对于我的情况，`<join table>`映射效果最好。我只需要确保来自第二个表的属性是可为空的类型，否则即使没有任何更改，它也会在保存时插入。由于第二个表不需要延迟加载，因此效果很好。我确信我可以得到配对的多对一映射来工作，但它并不直观，而且看起来比连接表选项更复杂，但`<join table>`仅在 NHibernate 2.0 及更高版本中可用。

# c# - 对对象类型使用“ref”和/或“out”

> ID：244826
> 
> 赞同：2
> 
> 时间：2008-10-28T20:50:28.460
> 
> 标签：c#, .net, casting, ref, out

我坚持使用 .Net 1.1 应用程序（即我现在不能使用 2.0 中的泛型好东西），并且我试图优化代码的某些部分。由于它处理了很多需要释放的运行时可调用包装器，因此我最终创建了一个实用方法，该方法循环直到所有引用都被释放。该方法的签名是：

```
void ReleaseObject(object comObject) 
```

释放所有 comObjects 后，我调用 GC.Collect 和 GC.WaitForPendingFinalizers（不要问 - 任何处理 Office 互操作的人都知道）。

而且......像往常一样，我遇到了一个极端情况 - 如果我没有在 GC.Collect 调用之前将相应的托管引用分配给 null ，它就不会正确清理。

所以，我的代码看起来像：

```
ReleaseObject(myComObject);
myComObject = null;
GC.Collect()
... 
```

因为有一堆xxx=null，所以我决定把它放在util方法中，但是由于引用传递和引用参数传递之间存在差异，显然我不得不将方法更改为：

```
void ReleaseObject(out object comObject)
{
   //do release
   comObject = null;
} 
```

并将调用者编辑为：

```
MyComClass myComObject = xxxx;
ReleaseObject(out myComObject); 
```

这失败并显示一条消息：“无法从 'out MyComClass' 转换为 'out object'”

虽然我能想到为什么它可能是一个问题（即从 object 到 MyComClass 的反向转换不是隐式的，并且不能保证该方法会做什么），但我想知道是否有解决方法，或者我需要留下我的数百个空值分配。

注意：我有一堆不同的 COM 对象类型，这就是为什么我需要一个“对象”参数，而不是一个类型安全的参数。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-28T20:54:29.840

为什么调用方法比将变量设置为 null 更好？它们都是单线调用，后者要简单得多。

不过，您首先需要将它们设置为 null 听起来确实很奇怪。这些静态变量，还是实例变量，其值需要在其包含对象之前释放？如果变量只是一个无论如何都会超出范围的局部变量，那么将其设置为 null 应该没有任何区别（在发布中）。

RCW 不实施 IDisposable 吗？如果是这样，调用 Dispose（最好通过 using 语句）将是最好的选择。

（在评论中讨论之后。）

这些是局部变量，稍后在方法中不会引用它们。这意味着垃圾收集器将意识到它们不需要被视为“根”引用 - 因此将它们设置为 null 应该没有任何区别。

但是，要直接回答原始问题：不，除非方法参数的类型完全相同，否则您不能通过引用传递变量，因此您在这里不走运。（使用泛型是可能的，但您说过您仅限于 .NET 1.1。）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-29T00:18:52.640

Sunny、ref 和 out 是编译器的编组提示 + 合同。Ref 和 out 是 COM 日的遗留物——当通过线路/进程之间发送时对象的编组提示。

`out`合同_

```
void foo( out MyClass x) 
```

1.  foo() 将`x`在返回之前设置为某个值。
2.  `x`输入 foo() 时没有值，如果`x`在设置之前尝试使用，则会出现编译器错误。（使用未分配的输出参数 x）

`ref`合同_

```
void foo( ref MyClass x) 
```

1.  ref 允许更改调用者引用。
2.  x 必须是可分配的
    *   您不能将某些东西转换为中间变量 foo( ref (object) something)
    *   x 不能是属性

最后两点的现实可能会阻止您做您想做的事情，因为实际上当您了解参考的真正含义时，它们毫无意义。如果您想知道这一点，请询问 Jon Skeet（他写了一本书）。

在编组 ref 时，它表示除了返回值之外，还要带回 ref 值。编组时，它说在调用方法时不要费心发送输出值，但请记住除了返回值之外还要带回输出值。

* * *

免责声明 免责声明

正如其他人指出的那样，正在发生一些可疑的事情。您维护的蛮力代码似乎有一些微妙的错误，并且由于巧合而受到编码的影响。最好的解决方案可能是添加另一层间接。即包装器类的包装器，可确保确定性清理，您可以在其中编写一次且仅一次的凌乱代码，而不是将其散布在整个代码库中。

* * *

那说..

备选方案 1

除非您为将调用它的每种类型的 (com) 对象提供重载，否则 Ref 不会起作用。

```
// need a remove method for each type. 
void Remove( ref Com1 x ) { ...; x = null; }
void Remove( ref Con2 x ) { ...; x = null; }
void Remove( ref Com3 x ) { ...; x = null; }

// a generics version using ref.
void RemoveComRef<ComT>(ref ComT t) where ComT : class
{
    System.Runtime.InteropServices.Marshal.ReleaseComObject(t);
    t = null; 
}

Com1 c1 = new Com1();
Com2 c2 = new Com2();
Remove( ref c1 );
RemoveComRef(ref c2); // the generics version again. 
```

备选方案 2

如果您不想这样做，请从 Remove() 方法返回 null 并转换回对象的类型。

```
class Remover
{
    // .net 1.1 must cast if assigning
    public static object Remove(object x)
    {
        System.Runtime.InteropServices.Marshal.ReleaseComObject(x);
        return null;
    }

    // uses generics.
    public static ComT RemoveCom<ComT>(ComT t) where ComT : class
    {
        System.Runtime.InteropServices.Marshal.ReleaseComObject(t);
        return null;
    }   
}

Com1 c1 = new Com1();
Com2 c2 = new Com2();
c1 = (Com1)Remover.Remove(c1); // no reliance on generics
c2 = Remover.RemoveCom(c2); // relies on generics 
```

* 我添加了通用版本进行比较。

上面的代码的效果是，在查看代码时，当您看到对 Remove(x) 的调用而没有赋值时会变得可疑（使错误的代码看起来是错误的）。您甚至可以通过代码库 Grep 查找未进行分配的 Remove 调用。

* * *

免责声明-以上所有内容都基于您需要手动将引用设置为 null ，这（通常）不是必需的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T21:08:12.277

你应该打电话[`Marshal.ReleaseComObject`](http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.marshal.releasecomobject.aspx)，AFAIK 在 1.1 中可用。

您可能的意思是“参考”：

```
static void ReleaseObject(ref object comObject)
{
   if(comObject != null)
   {
     //do release
     comObject = null;
   }
} 
```

[编辑重新评论] 但是，这仅适用于无类型对象，因此没有泛型就没有多大用处！哦，对于 C# 2.0...

重新“参考”；如果变量是真正的变量（意思是：方法变量），那么它们很快就会超出范围并被收集。“ref”仅对释放字段有用。但老实说，将它们设置为 null 会更简单......

典型的 COM 模式是：

```
SomeType obj = new SomeType();
try {
  obj.SomeMethod(); // etc
} finally {
  Marshal.ReleaseComObject(obj);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T21:12:26.730

在我看来，您将无法在另一种方法中将这些对象设置为 null （顺便说一句，您需要使用**ref**参数而不是**out**来使其工作，无论如何您会遇到“无法转换...”的相同问题错误。）我建议创建对象数组，然后遍历该数组，调用 ReleaseObject 方法并将这些对象设置为空。就像是：

```
List garbagedObjects = new List();
garbagedObjects.Add(myComObject1);
garbagedObjects.Add(myComObject2);
...
foreach(object garbagedObject in garbagedObjects)
{
  ReleaseObject(garbagedObject);
  garbagedObject = null;
}
garbagedObjects = null;
GC.Collect();
... 
```

# c++ - 单元测试访问者模式架构

> ID：244845
> 
> 赞同：6
> 
> 时间：2008-10-28T20:56:22.987
> 
> 标签：c++, unit-testing, design-patterns, visitor-pattern

我在我的一个应用程序中将访问者作为核心架构理念之一进行了介绍。我有几个访问者在相同的东西上进行操作。现在，我应该如何测试它？我正在考虑的一些测试比单元测试应该大一些（集成测试？无论如何），但我仍然想做。您将如何测试[访问者模式上维基艺术中的 C++ 示例之类的代码](http://en.wikipedia.org/wiki/Visitor_pattern)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T22:16:17.443

单元测试实际上并不是关于测试模式，而是关于测试方法和功能的正确实现。访问者模式是一个特定的类结构，并且对于所涉及的每个类（具体来说是 ConcreteVisitor 和 ConcreteElement），您都需要进行单元测试。

当您确信您的类方法表现良好时，您也可以使用您的单元测试框架来开发集成测试。不要马上开始集成测试：你会发现你开发了很多实际上是在测试特定类的行为的集成测试，即单元测试。

无论您需要模拟对象还是可以使用“真实”对象，都是另一回事。这在很大程度上取决于对象是否表现得足够好用于单元测试目的（即它们不会引入很多额外的依赖项等），以及对象本身是否经过单元测试（即您需要能够信任这些对象100%）。模拟与真实对象的问题之前已在 stackflow 上解决，因此请搜索 unittest 标签。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T21:02:18.373

制作一个测试访问者对象并让它访问事物....测试它访问了正确的事物。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-28T21:05:07.027

您可以创建[模拟对象](http://en.wikipedia.org/wiki/Mock_Object)并让访问者访问它们，然后创建模拟访问者并测试是否执行了正确的操作。

# sql-server - SQL Server 用于全文索引的排名方法

> ID：244846
> 
> 赞同：7
> 
> 时间：2008-10-28T20:57:15.030
> 
> 标签：sql-server, full-text-search

我在 SQL Server 中全文搜索使用的排名存在一些问题。

假设用户搜索两个词“foo bar”。我们假设用户打算进行 OR 搜索，所以我们将“foo OR bar”传递给我们的 CONTAINSTABLE 调用。我们发现，包含 10 次“foo”但不包含“bar”的行的排名将比同时包含“foo”和“bar”的行高得多。我们希望具有这两个术语的行优先于仅具有一个术语的行多次。关于如何实现这一目标的任何建议？

我找到了与 RANKMETHOD 修饰符相关的文档，但这似乎仅适用于 SQL Enterprise 搜索，并且不适用于常规 SQL Server 2005 安装。我们也可以切换到 Lucene.Net，但我希望验证它有更好的可用排名。我们也可能会进行多次搜索并合并结果，但随着搜索单词数量的增加，这似乎是不可取的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-02T17:46:36.280

RANKMETHOD 不适用于任何版本的 SQL Server。如果您正在构建要传递给 CONTAINSTABLE 搜索的关键字，并且您知道哪些词更“重要”，则可以使用 ISABOUT 和 WEIGHT 对这些词进行排名。

例如，如果 foo 的排名高于 bar，您可以执行以下操作：

SELECT * FROM CONTAINSTABLE (YourFullTextTable, *, 'ISABOUT("foo" WEIGHT (0.5), "bar" WEIGHT(0.3))')

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-12-23T21:16:52.593

尝试重写查询 SELECT * FROM CONTAINSTABLE (YourFullTextTable, *, '"foo bar" or "foo" ~ "bar" or "foo or bar"') 。这个查询本质上必须对任何具有精确的“foo bar”>“foo”靠近“bar”> foo 或 bar 的记录进行排名

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T21:48:54.363

我对倒排索引和余弦排名（全文检索系统的核心算法和数据结构）做了简短的讨论[。](https://stackoverflow.com/questions/237970/full-text-search-relevance-is-measured-in#238072)

在纯余弦排序上，foo (1), bar (1) 应该比 foo (10), bar (0) 更接近 foo, bar 占据的向量。人们可以在事后调整余弦值，这基本上就是[Pagerank](http://en.wikipedia.org/wiki/Pagerank)所做的。如果全文搜索在计算点积而不是加权轴之后摆弄余弦排名，这将解释 foo.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-10T07:31:05.973

只是为了跟进这一点.. 与字符串“A 或 B”匹配时，包含字符串 A 和 B 的行的排名较低的原因是 A 与 B 在不同的列中。如果我在合并的表上创建视图将这些列合并为一列，“A 或 B”的排名更符合我的预期。

# .net - .NET：如何知道序列化何时完成？

> ID：244854
> 
> 赞同：0
> 
> 时间：2008-10-28T20:59:39.673
> 
> 标签：.net, winforms, serialization

当我构建我的控件（继承 DataGrid）时，我添加了特定的行和列。这在设计时效果很好。不幸的是，在运行时我在同一个构造函数中添加了我的行和列，但是随后 DataGrid 被序列化（在构造函数运行之后）添加**更多**的行和列。

序列化完成后，我需要清除所有内容并重新初始化行和列。是否有一个受保护的方法可以重写以知道控件何时完成序列化？

当然，我宁愿不必在构造函数中完成工作，把它扔掉，然后在（潜在的）序列化之后再做一次。是否有一个类似于“立即设置”的首选事件，以便无论我是否被序列化都会调用一次？

* * *

我所说的序列化来自表单的代码隐藏文件中的 InitializeComponent() 方法。

```
#region Windows Form Designer generated code

/// <summary>
/// Required method for Designer support - do not modify
/// the contents of this method with the code editor.
/// </summary>
private void InitializeComponent()
{
   ...
} 
```

如果 InitializeComponent 是 Control 定义的虚拟方法，那将是完美的，然后我可以覆盖它，然后在调用 base 后执行我的处理：

```
protected override void InitializeComponent()
{
    base.InitializeComponent();

    InitializeMe();
} 
```

但它不是祖先方法，它只在代码隐藏文件中声明。

我注意到 InitializeComponent 在各种控件上调用 SuspendLayout 和 ResumeLayout。我认为它可以覆盖 ResumeLayout，然后执行我的初始化：

```
public override void ResumeLayout()
{
   base.ResumeLayout();

   InitializeMe();
} 
```

但是 ResumeLayout 不是虚拟的，所以就不行了。

还有什么想法吗？我不能成为第一个创建自定义控件的人。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T23:19:24.353

似乎正在发生的事情是这样的：

1.  您已经设计了一个自定义 DataGrid，它在构造函数中添加了自己的行和列
2.  您已将自定义 DataGrid 添加到表单
3.  您发现表单设计器在表单的 InitializeComponent 中编写了代码，该代码再次添加了这些行和列

Windows 窗体设计器代码生成器的工作方式是查看对象的所有属性，确定默认值应该是什么，并为未设置为默认值的属性生成代码。不幸的是，DataGrid 的默认状态是没有行也没有列。

不过，您可以使用一组属性来更改此行为。一种直接的方法可能是将 Rows 和 Columns 属性的新副本添加到您的类中，它只返回 base.Rows 和 base.Columns。以这种方式添加重复属性可让您将[DesignerSerializationVisibilty](http://msdn.microsoft.com/en-us/library/system.componentmodel.designerserializationvisibility.aspx)属性应用于它们，您可以使用它来强制表单设计器忽略预填充的行和列。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-06-06T19:40:21.883

“是否有一种受保护的方法，我可以重写以知道控件何时完成序列化？”

不，不是受保护的方法，但有一个接口。如果您的控件实现了[ISupportInitialize](http://msdn.microsoft.com/en-us/library/system.componentmodel.isupportinitialize.aspx)，那么当 Visual Studio 下次保存包含您的自定义控件的 Form/UserControl 的 .designer.cs 时，它将在您的控件被实例化后立即自动添加对您的[BeginInit](http://msdn.microsoft.com/en-us/library/system.componentmodel.isupportinitialize.begininit.aspx)方法的调用（但在任何属性值之前）已分配），并在设置完所有属性后调用[EndInit 。](http://msdn.microsoft.com/en-us/library/system.componentmodel.isupportinitialize.endinit.aspx)

然而，虽然这为您提供了很大的灵活性，但要正确处理您描述的那种事情有点麻烦（我已经将它用于相同的事情，所以我知道）。如果您的后代完全控制行和列，并且用户在设计器中编辑它们永远没有意义，那么 Tim 的建议 (DesignerSerializationVisibility) 会更简单，更容易正确。

# sql-server - SQL Management Studio 上的自动完成功能？

> ID：244860
> 
> 赞同：25
> 
> 时间：2008-10-28T21:02:18.543
> 
> 标签：sql-server, autocomplete, ssms

有谁知道是否有一个插件可以自动完成 SQL Management Studio 上的查询？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2011-01-04T17:41:15.920

您还可以尝试 Devart 的免费 SQL Complete。

[http://www.devart.com/dbforge/sql/sqlcomplete/](http://www.devart.com/dbforge/sql/sqlcomplete/)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-28T21:03:57.073

看看[Red Gate 的 SQL Prompt](http://www.red-gate.com/products/SQL_Prompt/index.htm)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-28T21:39:16.397

SQL Server 2008 内置了自动完成/智能感知。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-02-03T16:53:43.577

[ApexSQL 完成](http://www.apexsql.com/sql_tools_complete.aspx)

有一个新版本，是完全免费的。此外，如果您需要插件来重构您的代码，那么您还可以使用免费的 [ApexSQL Refactor](http://www.apexsql.com/sql_tools_refactor.aspx)，它将在下一个版本中得到改进。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-10-22T13:43:04.300

它不是 Management Studio，但[Toad](http://www.toadworld.com/Products/ToadforSQLServer/tabid/217/Default.aspx)有一个带有自动完成功能的免费软件版本。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-07-01T11:38:07.813

如前所述，如果安装了 Visual Studio 2010 SP1，则[IntelliSense 在 SSMS 2008 R2 中不起作用。](https://support.microsoft.com/en-us/kb/2531482)

我可以确认升级到[SQL Server 2008 R2 SP2](https://www.microsoft.com/en-us/download/details.aspx?id=30437)为我解决了这个问题。IntelliSense 现在可以在 SSMS 2008 R2 中使用。*万岁！*

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-01-05T08:55:12.290

最近[ApexSQL Complete](http://www.apexsql.com/sql_tools_complete.aspx)改进了很多——而且它是免费的。

不是每个人都喜欢它，但我非常喜欢它。

# sharepoint - 更改 SharePoint 中的默认列表 aspx 页面

> ID：244861
> 
> 赞同：1
> 
> 时间：2008-10-28T21:02:19.950
> 
> 标签：sharepoint

有没有办法在不使用 SharePoint 设计器的情况下更改用于编辑/创建/查看 Sharepoint 列表项的默认页面？由于我已经在开发机器上创建了 aspx 文件，因此在客户服务器上安装 SharePoint 设计器只是为了设置一些默认页面似乎有点愚蠢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T22:43:08.810

您可以使用 power shell 脚本或 .NET 控制台应用程序上传文件。您可以使用解决方案和功能上传文件。

我建议使用[STSDev](http://www.codeplex.com/stsdev)为任何定制创建解决方案和功能。在了解 STSDev、功能和解决方案的复杂性方面的额外工作是值得的，因为我对发布时间充满信心。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T13:37:09.573

如果您创建自定义列表定义，您可以定义自己的创建/编辑/列表页面。查看现有列表定义功能（例如 DocumentLibrary）中的 schema.xml。对于每个视图，都有一个指向列表页面的 SetupPage 属性，并且在末尾有一个 Forms 部分，您可以在其中定义 DisplayForm、EditForm 和 NewForm。'pages\form.aspx' 和 'pages\viewpage.aspx' 指的是 12\template\pages 文件夹。

# sharepoint - 在图片库中的自定义 Web 部件中渲染图像

> ID：244875
> 
> 赞同：3
> 
> 时间：2008-10-28T21:06:45.133
> 
> 标签：sharepoint

我有一个显示动态列表数据的自定义 Web 部件，它需要从图片库呈现图像（或者至少向我提供 URL，以便我可以用标签封装它），但是，图片库中没有任何字段似乎包含图片网址？是否有“图像实用程序”（SPImageUtility）或我可以用来将其拉出的东西？还是我只是错过了什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T01:14:09.987

假设您使用的是对象模型，那么您应该使用它（c#）

```
SPListItem["EncodedAbsUrl"] 
```

获取图像的 HTML 编码绝对 URL（其中“ **EncodedAbsUrl** ”是字段/列的名称）。

要获取未编码的站点相对 url，您可以使用**ServerUrl**或**FileRef**（它们似乎返回相同）

您还可以使用**EncodedAbsThumbnailUrl**获取缩略图。

[http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.splistitem.aspx](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.splistitem.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T21:47:04.897

是否从 CAML 查询中获取信息？如果是这样，您需要将必填字段添加到查询中。

否则，来自 spList 的 spListItem 对象具有属性 URL，该属性具有图像的 Web 相对 URL。

# apache - 将大量旧 URL 重定向到新 URL 的最佳方法？

> ID：244879
> 
> 赞同：2
> 
> 时间：2008-10-28T21:08:06.083
> 
> 标签：apache, url, redirect, seo, rewrite

我们正在为客户重新构建平台，他们担心 SEO。他们当前的站点支持 SEO 友好的 URL，新平台也是如此。因此，对于这些，我们将创建相同的 URL 映射。但是，他们有大量其他对 SEO 不友好的 URL，他们希望永久重定向。这些不遵循类似的模式，因此 .htaccess 中的一个正则表达式不会削减它。在 LAMP 堆栈上处理此问题的最佳方法是什么？该应用程序也有一个前端控制器，所以我需要确保它与硬重定向一起工作。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T21:19:44.437

一种方法（[我选择](http://blog.kaeding.name/articles/2008/07/22/migrating-urls-with-apache)的方法）是创建一个包含旧 URL 和新 URL 的简单表，然后使用[mod_rewrite](http://httpd.apache.org/docs/1.3/mod/mod_rewrite.html)读取表并执行重定向。该表可以存在于 Apache 配置外部的文件中。

或者，如果您希望表存在于数据库中，您可以编写一个脚本来查询数据库。

这意味着您要么需要手动创建映射，要么编写一些脚本来输出此映射文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T10:20:15.033

您可以使用 PHP 将旧 URL 重定向到新 URL。

```
header("Location: /new.html",TRUE,301); 
```

您仍然需要将请求重定向到此 PHP 脚本，但您可能会发现这比仅使用 mod_rewrite 更灵活且更易于调试。

# c# - C# 4.0 中的新动态变量

> ID：244881
> 
> 赞同：6
> 
> 时间：2008-10-28T21:08:51.043
> 
> 标签：c#, c#-4.0

C# 4.0 中的动态变量可以是类的成员还是传递到方法或从方法返回？C# 3.0 中的 var 不能，但我没有看到任何关于动态是否可能的提及。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-28T21:52:36.867

是的。`var`和之间有很大区别`dynamic`。

`var`只是意味着“让编译器推断变量的真实类型”。

`dynamic` *是*`dynamic`变量的类型-因此，据我所知，您可以在任何可以指定类型的地方指定类型。（我敢肯定这有一些例外，但这是基本思想。）

编辑：Chris Burrow 的[第一篇博客文章`dynamic`](http://blogs.msdn.com/cburrows/archive/2008/10/27/c-dynamic.aspx)（已经有[第二篇](http://blogs.msdn.com/cburrows/archive/2008/10/28/c-dynamic-part-ii.aspx)了；期待更多）提供了一个`dynamic`在所有地方都使用的示例类。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-28T21:17:13.570

上述所有的。我在 VPC 中试用了它们，并且能够完成所有这些操作。请参阅[此处的“C# 中的新功能”文档](http://code.msdn.microsoft.com/csharpfuture)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-03-24T14:27:11.237

“CLR via C#, 3rd Ed”一书中的这段代码片段显示了动态的作用：

```
using System;
using System.Dynamic;
static class DyanmicDemo
{
    public static void Main() {
  for(Int32 demo =0; demo < 2; demo++) {
   dynamic arg = (demo == 0) ? (dynamic) 5 : (dynamic) "A";
   dynamic result = Plus(arg);
   M(result);
  }
 }
    private static dynamic Plus(dynamic arg) { return arg + arg; }
    private static void M(Int32 n) { Console.WriteLine("M(Int32): " + n); }
    private static void M(String s) { Console.WriteLine("M(String): " + s); }
} 
```

当我执行 Main 时，我得到以下输出：

中号（Int32）：10

M（字符串）：AA

# security - 为网站实施“记住我”的最佳方式是什么？

> ID：244882
> 
> 赞同：536
> 
> 时间：2008-10-28T21:09:15.300
> 
> 标签：security, cookies, remember-me

我希望我的网站有一个用户可以单击的复选框，这样他们每次访问我的网站时都不必登录。我知道我需要在他们的计算机上存储一个 cookie 来实现这一点，但是那个 cookie 中应该包含什么？

此外，是否存在需要注意的常见错误，以防止此 cookie 出现安全漏洞，在仍然提供“记住我”功能的同时可以避免这些错误？

* * *

## 回答 #1

> 赞同：563
> 
> 时间：2008-10-28T21:20:49.473

## 改进的持久登录 Cookie 最佳实践

您可以使用[此处描述的此策略作为最佳实践](https://web.archive.org/web/20180819014446/http://jaspan.com/improved_persistent_login_cookie_best_practice)(2006) 或[此处描述的更新策略](https://paragonie.com/blog/2015/04/secure-authentication-php-with-long-term-persistence#title.2)(2015)：

1.  当用户在选中记住我的情况下成功登录时，除了标准会话管理 cookie 之外，还会**发出一个登录cookie。**
2.  登录 cookie 包含**一个系列标识符和一个令牌**。系列和令牌是来自适当大空间的**不可猜测的随机数。**两者都一起存储在数据库表中，**令牌被散列**（sha256 很好）。
3.  当未登录用户访问该站点并显示登录 cookie 时，将**在数据库中查找**系列标识符。
    1.  如果存在**系列标识符**并且**令牌**的哈希与该系列标识符的哈希匹配，则认为用户已通过**身份验证**。生成一个**新令牌**，该令牌的新哈希存储在旧记录上，并向用户发出一个新的登录 cookie（可以重复使用**系列标识符**）。
    2.  如果该系列存在但令牌不匹配，则假定为**盗窃。**用户会收到措辞强硬的警告，并且用户记住的所有会话都将被删除。
    3.  如果用户名和系列不存在，登录 cookie 将被**忽略**。

这种方法提供纵深防御。如果有人设法泄露数据库表，它不会为攻击者提供冒充用户的机会。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-28T21:14:25.150

存储他们的 UserId 和 RememberMeToken。当他们使用记住我登录时，检查生成一个新的 RememberMeToken（这会使任何其他标记为记住我的机器无效）。

当他们返回时，通过记住我的令牌查找它们并确保 UserId 匹配。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-28T21:17:53.427

我会存储一个用户 ID 和一个令牌。当用户返回站点时，将这两条信息与数据库条目等持久性信息进行比较。

至于安全性，请不要在其中放置任何允许某人修改 cookie 以获得额外好处的东西。例如，不要存储他们的用户组或密码。任何可以修改的会绕过您的安全性的内容都不应存储在 cookie 中。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-21T10:17:58.020

我自己调查持久会话我发现它根本不值得冒安全风险。如果您绝对必须使用它，但您应该考虑这样的会话仅经过弱身份验证，并强制新登录以获取任何可能对攻击者有价值的内容。

原因当然是包含持久会话的 cookie 很容易被盗。

窃取 cookie 的 4 种方法（来自[Jens Roland](http://jaspan.com/improved_persistent_login_cookie_best_practice#comment-4828)在页面上`@splattne`基于他的回答的评论）：

1.  通过不安全的线路拦截它（数据包嗅探/会话劫持）
2.  通过直接访问用户的浏览器（通过恶意软件或对盒子的物理访问）
3.  通过从服务器数据库中读取它（可能是 SQL 注入，但也可以是任何东西）
4.  通过 XSS hack（或类似的客户端漏洞利用）

# jsp - 如何使 JSP 标记文件不忽略所有空格？

> ID：244884
> 
> 赞同：8
> 
> 时间：2008-10-28T21:10:33.583
> 
> 标签：jsp, whitespace, jsp-tags, html-entities

我真的被这个难住了。我想输出一个列表并让标记文件处理逗号、单数与复数等，但是当我显示列表时，它完全忽略了空格，所以一切都像这样一起运行。我尝试使用 HTML 实体“thinsp”、“ensp”和“emsp”（我不能使用“nbsp”，这些都必须破坏），但它们在 IE 上都非常宽，除了 Thinsp 太瘦了关于其他一切。

编辑：不会工作。标签的输出根本没有空格。尽管 JSP 中的任何内容都有正常的间距。显然，我可以将所有内容都放在 JSP 中，但这是在多个 JSP 上运行的代码，因此标记文件会很有意义。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2010-01-25T18:08:24.630

这实际上是 EL 解析器中的一个错误，它导致 EL 表达式之间的空格被吃掉。例如

```
${bean.foo} ${bean.bar} ${bean.waa} 
```

将被打印为（假设它们返回与其属性名称完全相同的 String 值）：

```
foobarwaa 
```

我记得以前在某个地方报告过这个问题，但我现在似乎找不到。到目前为止，您可以使用 JSTL`c:out`标签修​​复它：

```
<c:out value="${bean.foo} ${bean.bar} ${bean.waa}" /> 
```

正确打印为：

```
foo bar waa 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T23:53:44.207

也许将jsp内容放在html`<pre>`标签中？在我看来，这似乎是正确的做法，因为列表是预先格式化的内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-01-25T16:07:11.183

我使用`&#32;`实体而不是空间，但通常我认为这很糟糕，要么所有的空格都被吃掉，要么你必须用实体破解，或者你在生成的 HTML 代码中有很大的空间。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-18T02:26:28.293

所以你是说你的*标签*根本不打印空白？是否有任何空白可以打印出来？

您可以发布代码，以及如何使用它的简短示例吗？

# c# - 如何注入 WebRequest/Response 依赖项？

> ID：244885
> 
> 赞同：0
> 
> 时间：2008-10-28T21:10:44.860
> 
> 标签：c#, tdd, dependency-injection, mocking

我正在努力分离以下代码中的依赖项：

```
 public static SiteConnector ConnectToSite(String Logon, String Password)
    {

        HttpWebRequest webRequest = (HttpWebRequest)WebRequest.Create(_URI);
        ConfigureRequest(Logon, Password, webRequest);
        HttpWebResponse webResponse = (HttpWebResponse)webRequest.GetResponse();
        Cookie ReposonseCookie;
        //this looks for a cookie and spitsout a value based on response
        int value = ProcessResponse(webResponse,out  ReposonseCookie);

        return new SiteConnector(ReposonseCookie, value);

    } 
```

本质上，我想在不依赖外部网站请求的情况下进行单元测试。

解决这个问题的最佳方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T21:14:43.497

不知道这个类在我的脑海中看起来如何，但你总是可以将它们包裹在你自己的、可测试的类中。

```
public class WebRequestWrapper
{
   internal WebRequestWrapper() {..}

   public WebRequestWrapper(WebRequest req)
   {
      _innerRequest = req;
   }

   public virtual string Url
   {
      return _innerReq.Url;
   }

   //repeat, make all necessary members virtual
} 
```

然后你可以使用 RhinoMocks 来创建这个类的 PartialMock。IT 将覆盖任何虚拟属性。

# vb.net - 从子实例调用被覆盖的基类方法

> ID：244886
> 
> 赞同：8
> 
> 时间：2008-10-28T21:12:13.860
> 
> 标签：vb.net, inheritance

考虑以下代码：

```
Public Class Animal

Public Overridable Function Speak() As String
    Return "Hello"
End Function

End Class

Public Class Dog
    Inherits Animal

    Public Overrides Function Speak() As String
        Return "Ruff"
    End Function

End Class

Dim dog As New Dog
Dim animal As Animal
animal = CType(dog, Animal)
// Want "Hello", getting "Ruff"
animal.Speak() 
```

如何将 Dog 的实例转换/ctype 为 Animal 并调用 Animal.Speak？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-28T21:21:48.177

你没有；根据继承的定义，子类的方法会覆盖超类的方法。

如果您希望覆盖的方法可用，请将其公开在子类中，例如

```
Public Class Dog 
    Inherits Animal
    Public Overrides Function Speak() As String
        Return "Ruff"
    End Function
    Public Function SpeakAsAnimal() As String
        Return MyBase.Speak()
    End Function
End Class 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T22:01:10.923

I would ask why you are trying to get this type of behavior. It seems to me that the fact you need to invoke the parent class' implementation of a method is an indication that you have a design flaw somewhere else in the system.

Bottom line though, as others have stated there is no way to invoke the parent class' implementation given the way you've structured your classes. Now within the Dog class you could call

```
MyBase.Speak() 
```

which would invoke the parent class' implementation, but from outside the Dog class there's no way to do it.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T15:33:18.610

我认为如果你放弃“Overridable”并将“Overrides”更改为“New”，你会得到你想要的。

```
Public Class Animal

Public Function Speak() As String
    Return "Hello"
End Function

End Class

Public Class Dog
    Inherits Animal

    Public New Function Speak() As String
        Return "Ruff"
    End Function

End Class

Dim dog As New Dog
Dim animal As Animal
dog.Speak() ' should be "Ruff"
animal = CType(dog, Animal)
animal.Speak() ' should be "Hello" 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T21:23:53.273

我不认为你可以。

问题是对象仍然是一只狗。您所描述的行为（从被投射的对象中获取“ruff”而不是“hello”）是标准的，因为您希望能够使用动物类让一群不同类型的动物说话。

例如，如果您有这样的第三类：

```
Public Class Cat
    Inherits Animal

    Public Overrides Function Speak() As String
        Return "Meow"
    End Function
End Class 
```

然后你就可以像这样访问它们：

```
protected sub Something
    Dim oCat as New Cat
    Dim oDog as New Dog

    MakeSpeak(oCat)
    MakeSpeak(oDog)
End sub

protected sub MakeSpeak(ani as animal)
    Console.WriteLine(ani.Speak())
end sub 
```

你所说的基本上打破了继承链。现在，这可以通过设置**Speak**函数来接受一个参数来完成，该参数告诉它是否返回它的基值或基值的单独 SPEAK 函数，但开箱即用，你不会得到以这种方式表现的事物。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-12-22T08:34:06.797

我知道这是几个月前发布的，但我仍然会尝试回复，也许只是为了完整起见。

有人告诉您，您可以从类中访问被覆盖的方法*，*然后`dog`可以用不同的名称公开它。但是使用条件呢？

你可以这样做：

```
Public Class Animal

Public Overridable Function Speak(Optional ByVal speakNormal as Boolean = False) As String
    Return "Hello"
End Function

End Class

Public Class Dog
    Inherits Animal

    Public Overrides Function Speak(Optional ByVal speakNormal as Boolean = False) As String
        If speakNormal then
            return MyBase.Speak()
        Else
            Return "Ruff"
        End If
    End Function

End Class 
```

然后像这样称呼他们：

```
Dim dog As New Dog
Dim animal As new Animal
animal.Speak() //"Hello"
dog.Speak()//"Ruff"
dog.Speak(true)//"Hello" 
```

或者，您可以`getTheAnimalInTheDog`制作*它* `Speak()`：

你可以这样做：

```
Public Class Animal

Public Overridable Function Speak() As String
    Return "Hello"
End Function

Public MustOverride Function GetTheAnimalInMe() As Animal

End Class

Public Class Dog
    Inherits Animal

    Public Overrides Function Speak() As String
        Return "Ruff"
    End Function

    Public Overrides Function GetTheAnimalInMe() As Animal
        Dim a As New Animal
        //Load a with the necessary custom parameters (if any)
        Return a
    End Function
End Class 
```

然后再一次：

```
Dim dog As New Dog
Dim animal As new Animal
animal.Speak() //"Hello"
dog.Speak()//"Ruff"
dog.GetTheAnimalInMe().Speak()//"Hello" 
```

希望能帮助到你 ;）

# ruby - OS X 10.5 下 Ruby 的常规 GEM PATHS 是什么？

> ID：244889
> 
> 赞同：16
> 
> 时间：2008-10-28T21:13:19.147
> 
> 标签：ruby, macos, path, gem

我的机器上的 ruby​​ 存在性能问题，我认为我已将其隔离为加载库（当调用 #require 时），所以我试图确定 ruby​​ 是否正在为库搜索太多文件夹。

当我跑

```
$ gem environment
RubyGems Environment:
  - RUBYGEMS VERSION: 1.3.0
  - RUBY VERSION: 1.8.6 (2008-03-03 patchlevel 114) [universal-darwin9.0]
  - INSTALLATION DIRECTORY: /Library/Ruby/Gems/1.8
  - RUBY EXECUTABLE: /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/bin/ruby
  - EXECUTABLE DIRECTORY: /usr/bin
  - RUBYGEMS PLATFORMS:
    - ruby
    - universal-darwin-9
  - GEM PATHS:
     - /Library/Ruby/Gems/1.8
     - /Users/matt/.gem/ruby/1.8
     - /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/gems/1.8
  - GEM CONFIGURATION:
     - :update_sources => true
     - :verbose => true
     - :benchmark => false
     - :backtrace => false
     - :bulk_threshold => 1000
     - :sources => ["http://gems.rubyforge.org", "http://gems.github.com/"]
  - REMOTE SOURCES:
     - http://gems.rubyforge.org
     - http://gems.github.com/ 
```

/Users/matt/.gem 上没有什么内容，但 /Library/Ruby 和 /System/Library/Frameworks/Ruby.framework 中都有大量内容。

是什么赋予了？这是正常的吗？

提前谢谢各位。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-29T19:17:23.670

是的。这一切在我看来都很标准。我的运行 MacOS 10.5 的 mac 同样在 ~/.gem/ruby/1.8/gems/ 中没有任何内容，在其他两个位置也没有。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-11-25T03:53:51.933

正如 Gabe 所说，是的，这很正常。

更多信息：

/System/Library/Frameworks/Ruby.framework <-- 在系统范围内用于所有用户，通常由 root 拥有。当您“sudo gem install ...”时，您正在安装的 gem 会出现在这里...

/Users/matt/.gem <-- 用户“matt”有自己的 gem 目录。每个用户都会得到一个。

当您将“gem install”设置为“matt”时，它将回退到您的私有 gem 目录。这会在第一次需要时自动创建。

# java - JasperReports 是否可以很好地替代基于 CGI 的 Web 报告框架

> ID：244891
> 
> 赞同：1
> 
> 时间：2008-10-28T21:14:06.507
> 
> 标签：java, jasper-reports, reporting

我们有一个用 C/C++ 编写的基于 CGI 的 Web 报告框架。*CGI*客户端与专有代码连接，而专有代码又连接到数据库。

由于性能、维护和可能的安全因素，我们正在寻找更好的基于 Java 的*CGI替代品。*

*   *JasperReports*可以连接专有代码吗？或者*servlet*是否足以取代 CGI 客户端？
*   *JasperReports*可以在 Tomcat 上运行吗？

任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-29T01:53:40.267

Jasper 在 Tomcat 中工作得很好。JasperReports 不限于使用 SQL 作为数据源——编写您自己的数据提供程序与您的专有代码交互将非常容易。

如果专有代码是本机的，您将不得不弄清楚如何处理它的那部分，但是......

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-06T00:29:24.267

已经有一段时间了，但我记得在 JasperReports 中创建自己的数据源非常非常容易。

[请参阅API Docs](http://jasperreports.sourceforge.net/api/index.html)下的 JRDataSource

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-03T18:06:47.293

您（或任何其他有类似问题的人）可以查看此[部分自定义数据源示例](http://gilbertadjin.wordpress.com/2009/07/01/inserting-images-from-database-into-jasper-reports/ "部分例子")以开始使用。我发现 Jasper Reports 很容易设置基本系统并与之集成。文档不是很完整，但代码比 BIRT 更容易理解。来自 Java bean、Hibernate 和 POJO 的数据都是可用的……

# excel - 在 Excel 中捕获 Worksheet Unprotect 事件

> ID：244892
> 
> 赞同：3
> 
> 时间：2008-10-28T21:14:12.030
> 
> 标签：excel, event-handling, vba

我有一个受保护的 Excel 工作表，没有密码。我想做的是捕获用户取消保护工作表的事件，以便我可以生成一条消息（并唠叨他们！）。我可以为应用程序设置事件检查，何时打开新工作簿等，但不能为 Unprotect 设置。
有人有想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T22:00:18.460

It is possible to modify the menu using Tools->Customize. Protect/Unprotect can be set to run a macro, for example:

```
Sub UnprotectTrap()
If ActiveSheet.ProtectContents = True Then
    MsgBox "Tut,tut!"
    ActiveSheet.Unprotect
Else
    ActiveSheet.Protect

End If
End Sub 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T22:35:08.637

There is no way to trap the user unprotecting the sheet, but you can warn them if they save the workbook without reprotecting the sheet(s).

In the Workbook module, put this code, or something like it

```
Private Sub Workbook_BeforeSave(ByVal SaveAsUI As Boolean, Cancel As Boolean)
  If Sheets("MyProtectedSheet").ProtectContents = False Then
    MsgBox "The sheet 'MyProtectedSheet' should not be left unprotected. I will protect it before saving", vbInformation
    Sheets("MyProtectedSheet").Protect
  End If
End Sub 
```

# ms-access - 是否可以以编程方式检测损坏的 Access 2007 数据库表？

> ID：244896
> 
> 赞同：2
> 
> 时间：2008-10-28T21:14:38.737
> 
> 标签：ms-access, ms-access-2007

是否可以通过代码以编程方式（从 .NET 例如通过 SQL 查询）询问 Access 数据库是否已损坏或是否有包含损坏行的表？

//安迪

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T22:08:41.953

None of the application/database level objects have such an "isCorrupted" property.

Furthermore, corrupted databases do not have a standard behaviour. Depending on the situation, database might not open at all (file is not recognized as a valid mdb file). If it opens, error might occur immediately or when using/opening a specific object (table, form, or VBA code).

In these conditions, I do not think there is a positive answer to your question.

Note: In addition to the standard compact/repair option of Access, exporting object to other databases (or importing them from the corrupted database) as well as the non-documented .saveAsText command can be of great help.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T13:32:32.163

我们的网络问题导致共享驱动器上的访问数据库损坏，我花了很多时间从几个特定的​​表中清理损坏的行。

尤其是备注字段是损坏的一个很好的指示，因为它们不像其他数据那样内联存储，而是保存在单独的表中。我可以在数据表模式下打开损坏的表，并尝试通过将焦点放在损坏的备注单元格上来确定哪些行已损坏——如果有损坏，我会立即收到错误消息。

损坏的 Int 和 Date 列会有奇数值（3/18/1890、-11100910 等），但当我读取它们的值时实际上不会抛出任何错误。

这就是为什么循环遍历数据库中的所有记录和字段的原因，如先前答案中的 VBA 所示，是有道理的，但只有在备忘录字段损坏时才能最可靠地执行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T21:21:55.277

下面是一些 VBA，可用于检查以前版本的 Access 中的错误。它也可能适合 2007 年。

```
Sub CheckForErr(tablename)
Dim rs As dao.Recordset
Dim db As Database

Set db = CurrentDb

Set rs = db.OpenRecordset(tname)

With rs
   Do While Not .EOF
        For Each fld In rs.Fields
            If IsError(rs(fld.Name)) Then
               Debug.Print "Error"
            End If
        Next
        .MoveNext
    Loop
End With

rs.Close
Set rs = Nothing

End Sub 
```

# passwords - 为什么密码盐称为“盐”？

> ID：244903
> 
> 赞同：64
> 
> 时间：2008-10-28T21:18:41.383
> 
> 标签：passwords, salt

密码盐的“盐”一词是否有意义？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2008-10-28T21:31:54.337

也许是因为 salt 和[hash](http://en.wikipedia.org/wiki/Hash_(food))搭配得很好？

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2008-10-28T21:25:16.937

[http://www.derkeiler.com/Newsgroups/comp.security.misc/2003-05/0154.html](http://www.derkeiler.com/Newsgroups/comp.security.misc/2003-05/0154.html)

> 使用“盐”这个词可能是指古代战争，人们会在井或农田上撒盐以使其不那么好客。罗马人有时应该在公元前 146 年对迦太基这样做。在密码的上下文中，“盐渍”密码更难破解。

[显然，即使迦太基（ http://en.wikipedia.org/wiki/Salting_the_earth](http://en.wikipedia.org/wiki/Salting_the_earth) ）声称的原始“盐渍”也没有强有力的证据，但仍然是一个有趣的假设。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2008-10-28T21:21:33.420

唯一的含义是您在散列密码之前在密码中添加了一些内容，类似于在您的饭菜中添加盐:-)

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-10-28T21:35:54.890

根据书中最早使用这个词的人之一肯·汤普森（Ken Thompson）的说法，它与“盐矿”一词有关，指的是金矿。这是否“正确”谁知道？我怀疑对此是否有真正的正确答案，这只是其中一个术语，只要理解其含义，就不必真正有理由。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-28T21:35:02.440

我猜是因为添加“盐”（NaCl 或固定字符串）很容易。但是一旦你这样做了，输出就会不可撤销地改变（食物、加密密码）。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-28T22:33:21.840

我以为它与动词盐有关...

```
(salt away) informal put by (money) secretly. 
```

-- [http://www.askoxford.com/concise_oed/saltx?view=uk](http://www.askoxford.com/concise_oed/saltx?view=uk)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-28T21:21:42.967

因为在您散列密码之前，您会向其中添加一个随机文本。所以，看起来好像你在原来的“食物”中添加了一些“盐”......密码:)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-28T22:06:36.950

一旦你在食物中加盐，真正的味道就不再可见了。所以基本上这是一个比喻性的说法；加一点盐，它改变了原来的菜。

# c# - 使用正则表达式将字符串拆分为句子

> ID：244913
> 
> 赞同：5
> 
> 时间：2008-10-28T21:22:33.853
> 
> 标签：c#, regex, nlp

我需要将像“一、二、三、四、五、六、七、八、九、十、十一”这样的字符串匹配成四个句子的组。我需要一个正则表达式在每四个句点后将字符串分成一个组。就像是：

```
 string regex = @"(.*.\s){4}";

  System.Text.RegularExpressions.Regex exp = new System.Text.RegularExpressions.Regex(regex);

  string result = exp.Replace(toTest, ".\n"); 
```

不起作用，因为它将替换句点之前的文本，而不仅仅是句点本身。如何仅计算句点并用句点和换行符替换它们？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T21:36:56.027

`.`在正则表达式中表示“任何字符”

所以在你的正则表达式中，你使用`.*.`了 which 将匹配一个单词（这相当于`.+`）

您可能正在寻找`[^.]\*[.]`- 一系列不是“ `.`”s 后跟“”的字符`.`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T21:33:58.340

尝试定义方法

```
private string AppendNewLineToMatch(Match match) {
    return match.Value + Environment.NewLine;
} 
```

并使用

```
string result = exp.Replace(toTest, AppendNewLineToMatch); 
```

这应该为每个匹配调用该方法，并将其替换为该方法的结果。该方法的结果将是匹配的文本和换行符。

* * *

编辑：另外，我同意奥利弗的观点。正确的正则表达式定义应该是：

```
 string regex = @"([^.]*[.]\s*){4}"; 
```

另一个编辑：修复了正则表达式，希望这次我做对了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T21:38:57.473

搜索表达式：`@"(?:([^\.]+?).\s)(?:([^\.]+?).\s)(?:([^\.]+?).\s)(?:([^\.]+?).\s)"` 替换表达式：`"$1 $2 $3 $4.\n"`

我在 RegexBuddy 中运行了这个表达式，并选择了 .NET 正则表达式，输出为：

```
one two three four.
five six seven eight.
nine. ten. eleven 
```

我尝试了一种`@"(?:([^.]+?).\s){4}"`排列方式，但捕获只会捕获最后一次出现（即单词），因此在替换时，您将丢失 4 个单词中的 3 个。如果我错了，请有人纠正我。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T21:39:43.587

您是否被迫通过正则表达式执行此操作？拆分字符串然后处理数组不是更容易吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T02:27:05.067

我不确定配置器的答案是否被编辑器破坏或什么，但它不起作用。正确的模式是

```
string regex = @"([^.]*[.]){4}\s*"; 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-28T21:43:45.950

在这种情况下，正则表达式似乎有点矫枉过正。我建议使用 String.split 然后分解生成的字符串数组。它应该比试图让正则表达式做你想做的事情更简单、更可靠。

像这样的东西可能更容易阅读和调试。

```
String s = "one. two. three. four. five. six. seven. eight. nine. ten. eleven"
String[] splitString = s.split(".")
List li = new ArrayList(splitString.length/2)
for(int i=0;i<splitString.length;i+=4) {
    st = splitString[i]+"."
    st += splitString[i+1]+"."
    st += splitString[i+2]+"."
    st += splitString[i+3]+"."
    li.add(st)
} 
```

# c# - 字典 或列表 使用 C# 3.5？

> ID：244916
> 
> 赞同：8
> 
> 时间：2008-10-28T21:24:27.843
> 
> 标签：c#, .net, collections, c#-3.0

我经常在 C#2.0 中使用 Dictionary，第一个键是包含唯一标识符的字符串。

我正在学习 C#3.0+，似乎我现在可以简单地使用 List 并简单地对该对象执行 LINQ 以获取特定对象（使用 .where()）。

那么，如果我理解得很好， Dictionary 类就失去了它的用途吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-28T21:25:37.703

不，在给定密钥的情况下，字典仍然可以更有效地恢复内容。

一个列表，您仍然需要遍历列表才能找到您想要的。字典进行查找。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-28T21:29:20.783

如果您只有一个列表，那么执行 LINQ 选择将扫描列表中的每个项目，并将其与您要查找的项目进行比较。

但是，字典会计算您要查找的字符串的哈希码（由 GetHashCode 方法返回）。然后使用该值更有效地查找字符串。有关其工作原理的更多信息，请参阅[Wikipedia](http://en.wikipedia.org/wiki/Hash_table)。

如果您有多个字符串，则初始 (List) 方法将开始变得非常缓慢。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-28T21:26:46.157

恕我直言，Dictionary 方法将比 LINQ 快得多，因此如果您有一个包含很多项目的数组，您应该使用 Dictionary。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-28T21:30:32.200

字典被实现为一个哈希表。因此，它应该为查找提供恒定的时间访问。List 实现为动态数组，为您提供线性时间访问。

基于底层数据结构， Dictionary 应该仍然可以为您提供更好的性能。

字典上的 MSDN 文档

[http://msdn.microsoft.com/en-us/library/xfhwa508.aspx](http://msdn.microsoft.com/en-us/library/xfhwa508.aspx)

并列出

[http://msdn.microsoft.com/en-us/library/6sh2ey19.aspx](http://msdn.microsoft.com/en-us/library/6sh2ey19.aspx)

# javascript - Internet Explorer 7 Ajax 链接只加载一次

> ID：244918
> 
> 赞同：13
> 
> 时间：2008-10-28T21:24:42.180
> 
> 标签：javascript, ajax, internet-explorer

我正在编写一个应用程序，并尝试将简单的 AJAX 功能绑定到其中。它在 Mozilla Firefox 中运行良好，但在 Internet Explorer 中有一个有趣的错误：每个链接只能单击一次。浏览器必须完全重新启动，简单地重新加载页面是行不通的。我编写了一个[非常简单的示例应用程序](http://static.stillinbeta.com/page/)来演示这一点。

Javascript 转载如下：

```
var xmlHttp = new XMLHttpRequest();

/*
item: the object clicked on
type: the type of action to perform (one of 'image','text' or 'blurb'
*/
function select(item,type)
{

    //Deselect the previously selected 'selected' object
    if(document.getElementById('selected')!=null)
    {
        document.getElementById('selected').id = '';
    }
    //reselect the new selcted object
    item.id = 'selected';

    //get the appropriate page
    if(type=='image')
        xmlHttp.open("GET","image.php");
    else if (type=='text')
        xmlHttp.open("GET","textbox.php");
    else if(type=='blurb')
        xmlHttp.open("GET","blurb.php");

    xmlHttp.send(null);
    xmlHttp.onreadystatechange = catchResponse;

    return false;

}
function catchResponse()
{
    if(xmlHttp.readyState == 4)
    {
        document.getElementById("page").innerHTML=xmlHttp.responseText;
    }

    return false;
} 
```

任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-28T21:27:41.113

这是因为 Internet Explorer 忽略了 no-cache 指令，并缓存了 ajax 调用的结果。然后，如果下一个请求相同，它将只提供缓存版本。有一个简单的解决方法，那就是在查询末尾附加随机字符串。

```
 xmlHttp.open("GET","blurb.php?"+Math.random(); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-28T21:25:55.517

看起来 IE 正在缓存响应。如果您将调用更改为 POST 方法，或者发送适当的标头告诉 IE 不要缓存响应，它应该可以工作。

我发送以确保它不缓存的标头是：

```
Pragma: no-cache
Cache-Control: no-cache
Expires: Fri, 30 Oct 1998 14:19:41 GMT 
```

请注意，到期日期可以是过去的任何时间。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-29T00:11:15.607

问题是，在`open`调用之前设置响应处理程序时，IE 会做一些古怪的事情。对于第一个 xhr 请求，您没有这样做，但是由于您重用了 xhr 对象，因此在调用第二个 open 时，响应处理程序已经设置。这可能令人困惑，但解决方案很简单。为每个请求创建一个新的 xhr 对象：

移动：

```
var xmlHttp = new XMLHttpRequest(); 
```

在选择功能内。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-11T10:23:51.097

阅读 [链接文本][1] [1] 中的“无问题”部分：[http ://en.wikipedia.org/wiki/XMLHttpRequest](http://en.wikipedia.org/wiki/XMLHttpRequest)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-13T18:40:18.713

在 IE AJAX 案例中最适合我的响应标头是`Expires: -1`，这可能不符合规范，但在 Microsoft 支持文章（[如何防止 Internet Explorer 中的缓存](http://support.microsoft.com/kb/234067)）中提到。这与`Cache-Control: no-cache`和一起使用`Pragma: no-cache`。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-10T15:35:39.813

> xmlHttp.open("GET","blurb.php?"+Math.random();

我同意这个..它完美地解决了这个问题。问题是 IE7 对 url 的缓存很糟糕，忽略了 no-cache 标头并使用它的 url 作为键索引将资源保存到它的缓存中，所以最好的解决方案是在 GET url 中添加一个随机参数。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-03-14T10:00:28.957

在 jQuery.ajax 中，您可以将“缓存”设置为 false：

[http://api.jquery.com/jQuery.ajax/](http://api.jquery.com/jQuery.ajax/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-11-03T22:23:48.030

使用 Dojo，这可以使用 来完成`dojo.date.stamp`，只需将以下内容添加到 url：

```
"...&amp;ts=" + dojo.date.stamp.toISOString(new Date()) 
```

# c# - 用于滚动 TreeView 控件的 WPF ControlTemplate

> ID：244926
> 
> 赞同：5
> 
> 时间：2008-10-28T21:26:38.230
> 
> 标签：c#, wpf

我正在使用 TreeView 控件，当单击其中一个控件时，它会自动滚动到左对齐 TreeViewItem。我已经查看了我的样式和控件模板，但我没有找到任何东西。是否存在导致此问题的默认 ControlTemplate？我想禁用它。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-04T00:09:17.100

项目滚动是因为 ScrollViewer 对它们调用了 BringIntoView()。因此，避免滚动的一种方法是抑制对 RequestBringIntoView 事件的处理。您可以通过继承 TreeView 并实例化此控件来快速尝试：

```
public class NoScrollTreeView : TreeView
{
    public class NoScrollTreeViewItem : TreeViewItem
    {
        public NoScrollTreeViewItem() : base()
        {
            this.RequestBringIntoView += delegate (object sender, RequestBringIntoViewEventArgs e) {
                e.Handled = true;
            };
        }

        protected override DependencyObject GetContainerForItemOverride()
        {
            return new NoScrollTreeViewItem();
        }
    }
    protected override DependencyObject GetContainerForItemOverride()
    {
        return new NoScrollTreeViewItem();
    }
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-06-10T15:26:08.487

在这个问题上花了几个小时后，我找到了一个适合我的解决方案。

第一步是防止 TreeViewItem 上的 RequestBringIntoView 事件冒泡的解决方案。不幸的是，如果您以编程方式更改所选项目，这也会停止显示树视图项目

```
yourtreeview.SelectedItem = yourtreeviewitem 
```

所以，对我来说，解决方案是修改treeview的controltemplate如下：

```
<Style x:Key="{x:Type TreeView}" TargetType="TreeView">
        <Setter Property="OverridesDefaultStyle" Value="True" />
        <Setter Property="SnapsToDevicePixels" Value="True" />
        <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Auto"/>
        <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="TreeView">
                    <Border Name="Border" BorderThickness="0" Padding="0" Margin="1">
                        <ScrollViewer Focusable="False" CanContentScroll="False" Padding="0">
                            <Components:AutoScrollPreventer Margin="0">
                                <ItemsPresenter/>
                            </Components:AutoScrollPreventer>
                        </ScrollViewer>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style> 
```

“autoscrollpreventer”是：

```
using System;
using System.Windows;
using System.Windows.Controls;

namespace LiveContext.Designer.GUI.Components {
    public class AutoScrollPreventer : StackPanel
    {
    public AutoScrollPreventer() {

        this.RequestBringIntoView += delegate(object sender, RequestBringIntoViewEventArgs e)
        {
            // stop this event from bubbling so that a scrollviewer doesn't try to BringIntoView..
            e.Handled = true;
        };

    }
} 
```

}

希望能帮助到你..

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T21:45:44.137

看起来我在[MSDN](http://social.msdn.microsoft.com/forums/en-US/wpf/thread/9abff78f-481d-4db1-a545-c461f7d19200/)上找到了一个很好的线索：

> 听起来这是与滚动查看器和焦点系统的交互。
> 
> 当元素聚焦在 ScrollViewer（它是 TreeView 模板的一部分）中时，将指示 ScrollViewer 使元素可见。它通过滚动到请求的元素来自动响应。
> 
> ScrollViewer 内部处理这些焦点请求的方法都是私有的和/或内部的，因此您真的无法访问它们。我认为在这种情况下您无能为力。这就是焦点的工作原理。

那么，是这样吗？当然有一种方法可以修改 TreeView 模板，以便 ScrollViewer 不会有这种行为......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T12:32:41.757

好的，我终于能够得到这样的默认样式：

```
 using (Stream sw = File.Open(@"C:\TreeViewDefaults.xaml", FileMode.Truncate, FileAccess.Write))
        {
            Style ts = Application.Current.FindResource(typeof(TreeView)) as Style;
            if (ts != null)
                XamlWriter.Save(ts, sw);
        } 
```

其中产生：

```
<Style TargetType="TreeView" 
       xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
       xmlns:s="clr-namespace:System;assembly=mscorlib" 
       xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Style.Triggers>
        <Trigger Property="VirtualizingStackPanel.IsVirtualizing">
            <Setter Property="ItemsControl.ItemsPanel">
                <Setter.Value>
                    <ItemsPanelTemplate><VirtualizingStackPanel IsItemsHost="True" /></ItemsPanelTemplate>
                </Setter.Value>
            </Setter>
            <Trigger.Value>
                <s:Boolean>True</s:Boolean>
            </Trigger.Value>
        </Trigger>
    </Style.Triggers>
    <Style.Resources>
        <ResourceDictionary />
    </Style.Resources>
    <Setter Property="Panel.Background">
        <Setter.Value><DynamicResource ResourceKey="{x:Static SystemColors.WindowBrushKey}" /></Setter.Value>
    </Setter>
    <Setter Property="Border.BorderBrush">
        <Setter.Value><SolidColorBrush>#FF828790</SolidColorBrush></Setter.Value>
    </Setter>
    <Setter Property="Border.BorderThickness">
        <Setter.Value><Thickness>1,1,1,1</Thickness></Setter.Value>
    </Setter>
    <Setter Property="Control.Padding">
        <Setter.Value><Thickness>1,1,1,1</Thickness></Setter.Value>
    </Setter>
    <Setter Property="TextElement.Foreground">
        <Setter.Value><DynamicResource ResourceKey="{x:Static SystemColors.ControlTextBrushKey}" /></Setter.Value>
    </Setter>
    <Setter Property="ScrollViewer.HorizontalScrollBarVisibility">
        <Setter.Value><x:Static Member="ScrollBarVisibility.Auto" /></Setter.Value>
    </Setter>
    <Setter Property="ScrollViewer.VerticalScrollBarVisibility">
        <Setter.Value><x:Static Member="ScrollBarVisibility.Auto" /></Setter.Value>
    </Setter>
    <Setter Property="Control.VerticalContentAlignment">
        <Setter.Value><x:Static Member="VerticalAlignment.Center" /></Setter.Value>
    </Setter>
    <Setter Property="Control.Template">
        <Setter.Value>
            <ControlTemplate TargetType="TreeView">
                <Border BorderThickness="{TemplateBinding Border.BorderThickness}" 
                        BorderBrush="{TemplateBinding Border.BorderBrush}" 
                        Name="Bd" SnapsToDevicePixels="True">
                    <ScrollViewer CanContentScroll="False" 
                                  HorizontalScrollBarVisibility="{TemplateBinding ScrollViewer.HorizontalScrollBarVisibility}" 
                                  VerticalScrollBarVisibility="{TemplateBinding ScrollViewer.VerticalScrollBarVisibility}" 
                                  Background="{TemplateBinding Panel.Background}" 
                                  Padding="{TemplateBinding Control.Padding}" 
                                  Name="_tv_scrollviewer_" 
                                  SnapsToDevicePixels="{TemplateBinding UIElement.SnapsToDevicePixels}" 
                                  Focusable="False">
                        <ItemsPresenter />
                    </ScrollViewer>
                </Border>
                <ControlTemplate.Triggers>
                    <Trigger Property="UIElement.IsEnabled">
                        <Setter Property="Panel.Background" TargetName="Bd">
                            <Setter.Value>
                                <DynamicResource ResourceKey="{x:Static SystemColors.ControlBrushKey}" />
                            </Setter.Value>
                        </Setter>
                        <Trigger.Value>
                            <s:Boolean>False</s:Boolean>
                        </Trigger.Value>
                    </Trigger>
                    <Trigger Property="VirtualizingStackPanel.IsVirtualizing">
                        <Setter Property="ScrollViewer.CanContentScroll" TargetName="_tv_scrollviewer_">
                            <Setter.Value><s:Boolean>True</s:Boolean></Setter.Value>
                        </Setter>
                        <Trigger.Value>
                            <s:Boolean>True</s:Boolean>
                        </Trigger.Value>
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>
        </Setter.Value>
    </Setter>
</Style> 
```

不幸的是，这看起来没有帮助。我没有看到任何用于停止自动滚动焦点的属性。

还在找...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T21:30:59.283

另一个有趣的花絮：有一个名为 HandlesScrolling 的可覆盖布尔值，它总是返回 true。反编译源代码后，看起来这个属性从未使用过（或者它正在 XAML 中的某个深、暗、秘密的地方使用）。我尝试制作自己的 TreeView 控件以将此值设置为 false，但它不起作用。

# sql - 有什么方法可以在 sql 中强制执行数字主键大小限制？

> ID：244934
> 
> 赞同：1
> 
> 时间：2008-10-28T21:28:15.950
> 
> 标签：sql, database, sqlite

我想创建一个整数主键限制在 000 到 999 之间的表。有没有办法在 sql 中强制执行这个 3 位限制？

我正在使用 sqlite3。谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T21:44:43.483

SQLite 支持两种方式：

`CHECK`在主键列上定义一个约束：

```
CREATE TABLE mytable (
  mytable_id INT PRIMARY KEY CHECK (mytable_id BETWEEN 0 and 999)
); 
```

在表上创建一个触发器，以中止任何`INSERT`或`UPDATE`尝试将主键列设置为您不想要的值。

```
CREATE TRIGGER mytable_pk_enforcement
BEFORE INSERT ON mytable
FOR EACH ROW 
  WHEN mytable_id NOT BETWEEN 0 AND 999
BEGIN
  RAISE(ABORT, 'primary key out of range');
END 
```

如果您使用自动分配的主键，如上所示，您可能需要运行触发器`AFTER INSERT`而不是在插入之前运行。`BEFORE`触发器执行时可能尚未生成主键值。

您可能还需要编写一个触发器`UPDATE`以防止人们更改超出范围的值。基本上，`CHECK`如果您使用 SQLite 3.3 或更高版本，则该约束更可取。

**注意：**我没有测试上面的代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T22:01:24.650

jmisso, I would not recommend reusing primary keys that have been deleted. You can create data integrity problems that way if all other tables that might have that key in them were not deleted first (one reason to always enforce setting up foreign key relationships in a database to prevent orphaned data like this). Do not do this unless you are positive that you have no orphaned data that might get attached to the new record.

Why would you even want to limit the primary key to 1000 possible values? What happens when you need 1500 records in the table? This doesn't strike me as a very good thing to even be trying to do.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T21:39:35.317

您可以使用 CHECK 约束来执行此操作。

但，

> 从 3.3.0 版开始支持 CHECK 约束。在 3.3.0 版之前，CHECK 约束已被解析但未强制执行。

（从[这里](http://www.sqlite.org/lang_createtable.html)）

所以除非 SQLite 3 = SQLite 3.3 这可能行不通

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-04T18:06:17.847

如何在开始时使用 1000 行预先填充表。使用某种 1/0 列（如 Is_Available 或类似列）切换可用行。然后不允许插入或删除，只允许更新。在这种情况下，您的应用程序只需针对更新进行编码。

# castle-windsor - 使用 Windsor 注入应用程序设置

> ID：244935
> 
> 赞同：13
> 
> 时间：2008-10-28T21:28:48.537
> 
> 标签：castle-windsor, appsettings

如何使用 Windsor 容器将 appSettings 条目的值（来自 app.config 或 web.config）注入服务？如果我想将 Windsor 属性的值注入到服务中，我会这样做：

```
<properties>
    <importantIntegerProperty>666</importantIntegerProperty>
</properties>
<component
    id="myComponent"
    service="MyApp.IService, MyApp"
    type="MyApp.Service, MyApp"
    >
    <parameters>
        <importantInteger>#{importantIntegerProperty}</importantInteger>
    </parameters>
</component> 
```

但是，我真正想做的是`#{importantIntegerProperty}`从应用程序设置变量中获取表示的值，该变量可能定义如下：

```
<appSettings>
    <add key="importantInteger" value="666"/>
</appSettings> 
```

**编辑：**澄清；我意识到这在 Windsor 中是不可能的，[sliderhouserules](https://stackoverflow.com/users/31385/sliderhouserules)所指的[David Hayden 文章实际上是关于他自己的（David Hayden 的）IoC 容器，而不是 Windsor。](http://davidhayden.com/blog/dave/archive/2007/10/04/DependencyInjectionParametersPropertiesCastleWindsor.aspx)

我肯定不是第一个遇到这个问题的人，所以我想知道其他人是如何解决这个问题的？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-04-17T17:15:23.840

我最终根据网络上各种来源的提示提出了一个解决方案。最终结果虽然涉及从温莎逐字复制三个类并稍微修改它们。最终结果在 codeplex 上供您欣赏。

[http://windsorappcfgprops.codeplex.com/](http://windsorappcfgprops.codeplex.com/)

我很早以前就编写了这段代码，所以它基于 Windsor 1.0.3 - 是的，我花了*很*长时间才发布结果！

该代码允许您在 app.config（或 web.config，显然）中拥有它：

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
  <appSettings>
    <add key="theAnswer" value="42"/>
  </appSettings>
</configuration> 
```

...并从您的 Windsor XML 配置文件中访问它，如下所示：

```
<?xml version="1.0" encoding="utf-8" ?>
<castle>
  <components>
    <component
      id="answerProvider"
      service="Acme.IAnswerProvider, Acme"
      type="Acme.AnswerProvider, Acme"
      >
      <parameters>
        <theAnswer>#{AppSetting.theAnswer}</theAnswer>
      </parameters>
    </component>
  </components>
</castle> 
```

解决方案中有一个工作示例。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-12T13:05:51.057

几个月前，我[写了一篇关于类似案例的帖子。](http://bugsquash.blogspot.com/2008/09/changing-windsor-components.html)它使用 SubDependencyResolver 注入适当的参数。在您的情况下，您只需更改 ConfigurationManager 的 DynamicConfigurationSettings。

# parsing - 谁能帮我把这个 ANTLR 2.0 语法文件转换成 ANTLR 3.0 语法？

> ID：244936
> 
> 赞同：1
> 
> 时间：2008-10-28T21:28:56.837
> 
> 标签：parsing, antlr, rdf

我已经转换了“简单”部分（片段、@header 和@member 声明等），但是由于我是 Antlr 的新手，所以我很难转换 Tree 语句等。

我使用以下[迁移指南](http://www.antlr.org/wiki/display/ANTLR3/Migrating+from+ANTLR+2+to+ANTLR+3#MigratingfromANTLR2toANTLR3-NewinANTLR3)。

[语法文件可以在这里找到。](http://jena.cvs.sourceforge.net/viewvc/*checkout*/jena/jena2/src/com/)...

您可以在下面找到一些我遇到问题的示例：

例如，我有以下问题：

```
n3Directive0!:
                d:AT_PREFIX ns:nsprefix u:uriref
                {directive(#d, #ns, #u);}
                ; 
```

或者

```
propertyList![AST subj]
        : NAME_OP! anonnode[subj] propertyList[subj]
        | propValue[subj] (SEMI propertyList[subj])?
        |               // void : allows for [ :a :b ] and empty list "; .".
        ;

propValue [AST subj]
        :  v1:verb objectList[subj, #v1]
                // Reverse the subject and object
        |  v2:verbReverse subjectList[subj, #v2]
        ;

subjectList![AST oldSub, AST prop]
        : obj:item { emitQuad(#obj, prop, oldSub) ; }
                (COMMA subjectList[oldSub, prop])? ;

objectList! [AST subj, AST prop]
        : obj:item { emitQuad(subj,prop,#obj) ; }
                (COMMA objectList[subj, prop])?
    | // Allows for empty list ", ."
    ; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-16T11:23:06.547

```
n3Directive0!:
                d=AT_PREFIX ns=nsprefix u=uriref
                {directive($d, $ns, $u);}
                ; 
```

*   您必须使用“=”进行分配。
*   然后可以将令牌用作 '$tokenname.getText()', ...
*   然后可以在您的代码中将规则结果用作“rulename.result”
*   如果您有声明结果名称的规则，则必须使用这些名称 iso。
    '结果'。

# .net - 你能在 VS2008 IDE 中修改 CPU 寄存器吗？

> ID：244940
> 
> 赞同：3
> 
> 时间：2008-10-28T21:29:42.327
> 
> 标签：.net, debugging, cpu-registers

只是想知道是否有一种方法可以从 Visual Studio IDE 中编辑 CPU 寄存器（即 EAX、EBX、ECX 等）或标志（OV、UP、erc）。我知道您可以使用“寄存器”窗格 (ctrl-shift-G)**查看**它们，并且可以使用 TAB 或 ENTER 循环浏览它们，但我似乎无法在调试时更改它们中的任何一个（是的，程序执行是停止:))。

我真的没有强烈的需要这样做，只是：我可以看到程序集......我曾经能够做到这一点（VC ++ 6）......为什么我现在不能，善良'一个东西！

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T21:35:43.860

是的你可以....

从帮助（你知道...... f1 键）

更改寄存器的值

*   在“寄存器”窗口中，使用 TAB 键或鼠标将插入点移动到要更改的值。开始键入时，光标必须位于要覆盖的值的前面。
*   键入新值。
*   按 ENTER。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-24T10:54:11.887

不，你不能。那个可怕的东西在托管模式或混合模式下不起作用。

# c++ - 在 Windows 中监视文件夹中的新文件

> ID：244941
> 
> 赞同：12
> 
> 时间：2008-10-28T21:29:55.960
> 
> 标签：c++, visual-c++

监视文件夹以查看何时将图像文件添加到其中的最佳方法是什么？文件大约每分钟添加一次，命名如下... image0001.jpg、image0002.jpg、image0003.jpg 等。我需要知道文件何时写入文件夹，以便我的应用程序可以访问和使用它。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-28T21:31:22.027

查看[目录更改通知](http://msdn.microsoft.com/en-us/library/aa365261(VS.85).aspx)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-28T22:22:26.293

As per previously mentioned, the directory change notifications is what you want.

I have looked into them as well, and the caveat I have seen is that windows will fire off the notification when the file starts to be written to the folder. If the file is large enough then you will receive the notification before the file has finished being written.

Check out [this google search](http://www.google.com/search?client=safari&rls=en-us&q=filesystemwatcher+large+files&ie=UTF-8&oe=UTF-8) for various solutions for waiting until the file is completely written

**Edit**: I just saw that the question was tagged with c++, and I linked to a .Net search. Although what I provided may not be the correct language, I would think that you will still have the same issues on Windows no matter what system you are coding with.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T23:55:08.570

更改通知可能会导致一些开销，如果您有 NTFS，请考虑[NTFS 更改日志](http://msdn.microsoft.com/en-us/library/aa363798(VS.85).aspx)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-28T21:41:33.707

[FileSystemWatcher](http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.aspx)应该能够为您做到这一点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-02-16T22:24:44.400

您可以使用轮询方法来监视文件夹。例如，循环将每 5 秒执行一次。

此方法返回新文件列表：

```
List<string> files = new List<string>();
string path = @"C:\test\"; // whatever the path is

public List<string> GetNewFiles(string path)
    {
        // store all the filenames (only .jpg files) in a list
        List<string> currentFiles = System.IO.Directory.GetFiles(path, "*.jpg");

        if ( currentFiles.Count() > files.Count() )
        {
            count = newFiles.Length - files.Length;
            List<string> newFiles = new List<string>();

            foreach ( string file in currentFiles )
            {
                if ( !files.Contains(file) )
                {
                    newFiles.Add(file);
                }
             }
         }
         files = currentFiles;
         return newFiles;
    } 
```

这是每 5 秒轮询一次并调用前一个方法的方法。

```
public void MonitorFolder()
{
    while (true)
    {
        List<string> newFiles = GetNewFiles(path);
        System.Threading.Thread.Sleep(5000); // 5000 milliseconds
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-12-08T12:09:44.213

1.  Synch.variant [FindFirstChangeNotification](http://msdn.microsoft.com/en-us/library/aa364417%28v=VS.85%29.aspx)
2.  Asynch.variant [ReadDirectoryChangesW](http://msdn.microsoft.com/en-us/library/aa365465%28v=VS.85%29.aspx)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-08-31T16:41:58.783

这是我搜索的最高 google 结果，因此我将其添加为答案。

如果您使用的是 Qt，则有[QFileSystemWatcher](http://doc.qt.io/qt-5/qfilesystemwatcher.html)。我不知道这存在并且我们碰巧在使用 Qt，所以我浪费了几个多小时使用[FindFirstChangeNotification](https://docs.microsoft.com/en-us/windows/desktop/fileio/obtaining-directory-change-notifications)来重写我随时可用的内容，直到一位同事向我展示了光明。

不过学习体验不错。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-10-28T21:38:44.010

[inotify](http://en.wikipedia.org/wiki/Inotify)可能是你的事

# .net - .NET Web 服务的 JIT 加速时间

> ID：244949
> 
> 赞同：1
> 
> 时间：2008-10-28T21:31:51.167
> 
> 标签：.net, web-services, jit

如何克服 .NET 企业解决方案中不常用的 Web 服务方法的 JIT 编译加速时间？我的一些不经常使用的业务流程依赖于 5-6 个 Web 内部 Web 服务调用。每个“JIT”每次调用可以增加 2-3 秒，从而为流程增加大约 10-15 秒。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T21:50:38.963

您可以事先对程序集进行[NGen](http://msdn.microsoft.com/en-us/library/6t9t5wcf.aspx) - 或者（如果它们无害地调用没有其他原因）只是有一个任务来定期进行调用。

# php - 在 PHP 中限制 IFRAME 访问

> ID：244952
> 
> 赞同：3
> 
> 时间：2008-10-28T21:32:29.920
> 
> 标签：php, security, iframe

我正在使用 PHP 创建一个小型网页，该网页将作为 IFRAME 从几个站点访问。我想限制对该站点的访问，使其仅在“已批准”站点内工作，而不是其他站点或直接访问。有没有人有什么建议？这甚至可能吗？PHP 站点将是 Apache，而 iframe 内容的站点可能是 .NET。

澄清一下，任何网站都可以查看该页面，只要它是 iframe'd 在批准的网站内。我想阻止人们直接访问它。我在想 cookie 可能是一个解决方案，但我不确定。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T21:34:23.003

不幸的是，这是不可能的。

使用 Javascript，您可以检查您的页面是否嵌入到另一个框架中，但这并不是万无一失的，因为 Javascript 可以在某些人的浏览器中关闭。

例如，如果这是您的意图，您可以运行以下 javascript 来重新设置页面的父级：

```
if (top.location != location) {
  top.location.href = document.location.href ;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T21:50:57.947

考虑到这一点...我不相信这是完全安全的，但是当我想得更多时，这里有一个镜头-

你可以做到这一点的唯一方法是，如果你控制它将被嵌入的站点。如果你控制它们，你可以通过时间，加密，从框架集到框架：

> ```
>  <iframe src="http://yourdomain/frame.php?key=p21n9u234p8yfb8yfy234m3lunflb8hv" /> 
> ```

frame.php 然后解密消息以在一个小增量（比如 10 秒）内找到时间。因为 frame.php 知道只有可接受的站点才能加密时间，所以它知道可以显示自己。否则，它什么也不输出。

其他任何东西，无论是 javascript 还是 HTTP_REFER，都可以被欺骗、关闭或规避。

事实上，只要用户在 10 秒内加载，攻击者就可以使用该 url 在任何地方显示您的框架。因此，攻击者只会抓取已接受的站点，并获取密钥。如果您无法接受该威胁模型 - 那么您确实无能为力（除了可能更复杂的协议）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T21:53:17.273

我会以与谷歌实现 adsense 相同的方式实现这一点。与其让他们在他们的网站中嵌入 iframe 代码，不如让他们嵌入一些包含帐号的 javascript：

```
<script type="text/javascript"><!--
myiframe_client = "12345";
myiframe_width = 728;
myiframe_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://www.example.com/scripts/show_iframe.js">
</script> 
```

至少通过这种方式，您可以根据每个帐户管理谁显示您的 iframe 内容。如果有人未经授权尝试使用您的 iframe，您可以禁用该帐户。您还可以通过 javascript（在浏览器的安全限制范围内）检查文档的属性，以防止未经授权的访问。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-28T22:06:43.343

屏幕抓取可能是一个可能的解决方案。

在您的站点上设置访问列表以仅接受来自已批准站点 Web 服务器的请求并向它们颁发安全令牌。那是容易的部分。

最终的开发团队将需要设置一个中继 servlet 来获取您的内容，然后将其显示给用户（在重写任何相关的 url 之后）。

这可能涉及很多，但您将能够更好地控制谁访问该站点。此外，您发布的任何安全令牌对 Web 用户都是不可见的，因为它只能在两个 Web 服务器之间传输。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-07-27T15:44:52.140

您可以使用秘密盐 + 日期对客户端 IP 进行 MD5（或加密以获得更好的安全性），并将其作为 iframe src url 中的参数传递。在 iframe 中，您执行相同的操作并检查结果是否与参数相同；如果不是，拒绝访问

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-28T21:50:24.173

你能不检查`$_SERVER['HTTP_REFERER']`以确保它包含某个字符串吗？

```
if (strpos('http://example.com', $_SERVER['HTTP_REFERER']) !== false) {
    // allowed
} 
```

在您的情况下，您可能想先解析出地址，然后检查是否`in_array()`.

这不会是万无一失的，因为人们可以伪造推荐人，**但**也许您可以在 2 个服务器之间进行某种 1 使用密钥和其他一些通信。如果密钥已被使用，则不去。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-10-28T22:14:08.273

感谢所有伟大的想法！我认为我要采用的解决方案是由批准的“iframe”站点设置的会话 cookie。真正确定仍然能够获得内容的人，但我认为我可以通过基于双方共享秘密的某种体面的“秘密”算法来防止大部分滥用，并让批准的网站设置一个我的 PHP 站点将读取的会话 cookie。如果 cookie 有效且符合我的条件，我将显示内容，否则我不会。我保护的信息不是关键任务，我只是想防止它被滥用。

# c# - 序列化一个可为空的 int

> ID：244953
> 
> 赞同：94
> 
> 时间：2008-10-28T21:33:42.973
> 
> 标签：c#, .net, xml, serialization

我有一个可以为空的 int 的类？数据类型设置为序列化为 xml 元素。有什么方法可以设置它，如果值为 null，则 xml 序列化程序不会序列化元素？

我尝试添加 [System.Xml.Serialization.XmlElement(IsNullable=false)] 属性，但我得到一个运行时序列化异常，说存在反映类型的错误，因为“IsNullable 可能未设置为 'false ' 对于 Nullable 类型。考虑使用 'System.Int32' 类型或从 XmlElement 属性中删除 IsNullable 属性。

```
[Serializable]
[System.Xml.Serialization.XmlRoot("Score", Namespace = "http://mycomp.com/test/score/v1")]
public class Score
{
    private int? iID_m;
    ...

    /// <summary>
    /// 
    /// </summary>        
    public int? ID 
    { 
        get 
        { 
            return iID_m; 
        } 
        set 
        { 
            iID_m = value; 
        } 
    }
     ...
} 
```

上面的类将序列化为：

```
<Score xmlns="http://mycomp.com/test/score/v1">
    <ID xsi:nil="true" />
</Score> 
```

但是对于为空的 ID，我根本不需要 ID 元素，主要是因为当我在 MSSQL 中使用 OPENXML 时，对于看起来像这样的元素，它返回 0 而不是 null

* * *

## 回答 #1

> 赞同：153
> 
> 时间：2008-10-29T10:38:54.700

XmlSerializer 支持该`ShouldSerialize{Foo}()`模式，因此您可以添加一个方法：

```
public bool ShouldSerializeID() {return ID.HasValue;} 
```

还有一种`{Foo}Specified`模式 - 不确定 XmlSerializer 是否支持该模式。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2009-03-04T13:50:05.047

我正在使用这个微模式来实现 Nullable 序列化：

```
[XmlIgnore]
public double? SomeValue { get; set; }

[XmlAttribute("SomeValue")] // or [XmlElement("SomeValue")]
[EditorBrowsable(EditorBrowsableState.Never)]
public double XmlSomeValue { get { return SomeValue.Value; } set { SomeValue= value; } }  
[EditorBrowsable(EditorBrowsableState.Never)]
public bool XmlSomeValueSpecified { get { return SomeValue.HasValue; } } 
```

这为用户提供了正确的界面而不会妥协，并且在序列化时仍然可以做正确的事情。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-28T21:57:05.953

我想出了一个利用两个属性的解决方法。一个整数？具有 XmlIgnore 属性和被序列化的对象属性的属性。

```
 /// <summary>
    /// Score db record
    /// </summary>        
    [System.Xml.Serialization.XmlIgnore()]
    public int? ID 
    { 
        get 
        { 
            return iID_m; 
        } 
        set 
        { 
            iID_m = value; 
        } 
    }

    /// <summary>
    /// Score db record
    /// </summary>        
    [System.Xml.Serialization.XmlElement("ID",IsNullable = false)]
    public object IDValue
    {
        get
        {
            return ID;
        }
        set
        {
            if (value == null)
            {
                ID = null;
            }
            else if (value is int || value is int?)
            {
                ID = (int)value;
            }
            else
            {
                ID = int.Parse(value.ToString());
            }
        }
    } 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-10T23:46:29.093

哇，谢谢这个问题/答案真的帮助了我。我喜欢 Stackoverflow。

我使您在上面所做的事情更加通用。我们真正想要的是让 Nullable 具有稍微不同的序列化行为。我使用 Reflector 构建了我自己的 Nullable，并在这里和那里添加了一些东西以使 XML 序列化按照我们想要的方式工作。似乎工作得很好：

```
public class Nullable<T>
{
    public Nullable(T value)
    {
        _value = value;
        _hasValue = true;
    }

    public Nullable()
    {
        _hasValue = false;
    }

    [XmlText]
    public T Value
    {
        get
        {
            if (!HasValue)
                throw new InvalidOperationException();
            return _value;
        }
        set
        {
            _value = value;
            _hasValue = true;
        }
    }

    [XmlIgnore]
    public bool HasValue
        { get { return _hasValue; } }

    public T GetValueOrDefault()
        { return _value; }
    public T GetValueOrDefault(T i_defaultValue)
        { return HasValue ? _value : i_defaultValue; }

    public static explicit operator T(Nullable<T> i_value)
        { return i_value.Value; }
    public static implicit operator Nullable<T>(T i_value)
        { return new Nullable<T>(i_value); }

    public override bool Equals(object i_other)
    {
        if (!HasValue)
            return (i_other == null);
        if (i_other == null)
            return false;
        return _value.Equals(i_other);
    }

    public override int GetHashCode()
    {
        if (!HasValue)
            return 0;
        return _value.GetHashCode();
    }

    public override string ToString()
    {
        if (!HasValue)
            return "";
        return _value.ToString();
    }

    bool _hasValue;
    T    _value;
} 
```

你失去了让你的成员成为 int 的能力？依此类推（必须改用 Nullable<int>），但除此之外，所有行为都保持不变。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-28T21:49:39.853

不幸的是，您描述的行为在 XmlElementAttribute.IsNullable 的文档中被准确记录。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-10-21T15:31:44.800

非常有用的帖子帮助很大。

我选择使用 Scott 对 Nullable(Of T) 数据类型的修订，但是发布的代码仍然会在 Null 为 Null 时序列化 Nullable 元素——尽管没有“xs:nil='true'”属性。

我需要强制序列化程序完全删除标签，所以我只是在结构上实现了 IXmlSerializable（这是在 VB 中，但你得到了图片）：

```
 '----------------------------------------------------------------------------
  ' GetSchema
  '----------------------------------------------------------------------------
  Public Function GetSchema() As System.Xml.Schema.XmlSchema Implements System.Xml.Serialization.IXmlSerializable.GetSchema
    Return Nothing
  End Function

  '----------------------------------------------------------------------------
  ' ReadXml
  '----------------------------------------------------------------------------
  Public Sub ReadXml(ByVal reader As System.Xml.XmlReader) Implements System.Xml.Serialization.IXmlSerializable.ReadXml
    If (Not reader.IsEmptyElement) Then
      If (reader.Read AndAlso reader.NodeType = System.Xml.XmlNodeType.Text) Then
         Me._value = reader.ReadContentAs(GetType(T), Nothing)
      End If
    End If
  End Sub

  '----------------------------------------------------------------------------
  ' WriteXml
  '----------------------------------------------------------------------------
  Public Sub WriteXml(ByVal writer As System.Xml.XmlWriter) Implements System.Xml.Serialization.IXmlSerializable.WriteXml
    If (_hasValue) Then
      writer.WriteValue(Me.Value)
    End If
  End Sub 
```

与使用 (foo)Specified 模式相比，我更喜欢这种方法，因为这需要向我的对象添加大量冗余属性，而使用新的 Nullable 类型只需要重新键入属性。

# php - 在 PHP 中合并正则表达式

> ID：244959
> 
> 赞同：10
> 
> 时间：2008-10-28T21:35:17.840
> 
> 标签：php, regex, abstract-syntax-tree

假设我有以下两个包含正则表达式的字符串。我如何合并它们？更具体地说，我希望将这两个表达式作为替代。

```
$a = '# /[a-z] #i';
$b = '/ Moo /x';
$c = preg_magic_coalesce('|', $a, $b);
// Desired result should be equivalent to:
// '/ \/[a-zA-Z] |Moo/' 
```

当然，将其作为字符串操作执行是不切实际的，因为它会涉及解析表达式、构造语法树、合并树，然后输出另一个与树等效的正则表达式。没有这最后一步，我很高兴。不幸的是，PHP 没有 RegExp 类（或者有吗？）。

有*什么*办法可以做到这一点？顺便说一句，还有其他语言提供方法吗？这不是很正常的情况吗？可能不会。:-(

**或者**，有没有一种方法可以**有效**地检查两个表达式中的任何一个是否匹配，以及哪个更早匹配（如果它们在同一位置匹配，则哪个匹配更长）？这就是我目前正在做的事情。不幸的是，我经常在长字符串上这样做，用于两个以上的模式。结果很*慢*（是的，这绝对是瓶颈）。

## 编辑：

我应该更具体——对不起。`$a`并且`$b`是*变量*，它们的内容不在我的控制范围内！否则，我只会手动合并它们。因此，我无法对使用的分隔符或正则表达式修饰符做出任何假设。请注意，例如，我的第一个表达式使用`i`修饰符（忽略大小写），而第二个表达式使用`x`（扩展语法）。因此，我不能只连接两者，因为第二个表达式不*忽略*大小写，第一个不使用扩展语法（并且其中的任何空格都很重要！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-29T00:02:40.117

1.  从每个中去除分隔符和标志。这个正则表达式应该这样做：

    ```
    /^(.)(.*)\1([imsxeADSUXJu]*)$/ 
    ```

2.  将表达式连接在一起。您需要非捕获括号来注入标志：

    ```
    "(?$flags1:$regexp1)|(?$flags2:$regexp2)" 
    ```

3.  如果有任何反向引用，计算捕获括号并相应地更新反向引用（例如正确连接`/(.)x\1/`和`/(.)y\1/`is `/(.)x\1|(.)y\2/`）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-29T03:06:13.553

我看到porneL 实际上[描述](https://stackoverflow.com/questions/244959/coalescing-regular-expressions-in-php#245326)了很多这样的东西，但这解决了大部分问题。它取消在先前子表达式中设置的修饰符（另一个答案错过了）并设置每个子表达式中指定的修饰符。它还处理非斜杠分隔符（我找不到此处**允许**使用哪些字符的规范，所以我使用了`.`，您可能想进一步缩小范围）。

一个弱点是它不处理表达式中的反向引用。我最担心的是反向引用本身的局限性。我将把它作为练习留给读者/提问者。

```
// Pass as many expressions as you'd like
function preg_magic_coalesce() {
    $active_modifiers = array();

    $expression = '/(?:';
    $sub_expressions = array();
    foreach(func_get_args() as $arg) {
        // Determine modifiers from sub-expression
        if(preg_match('/^(.)(.*)\1([eimsuxADJSUX]+)$/', $arg, $matches)) {
            $modifiers = preg_split('//', $matches[3]);
            if($modifiers[0] == '') {
                array_shift($modifiers);
            }
            if($modifiers[(count($modifiers) - 1)] == '') {
                array_pop($modifiers);
            }

            $cancel_modifiers = $active_modifiers;
            foreach($cancel_modifiers as $key => $modifier) {
                if(in_array($modifier, $modifiers)) {
                    unset($cancel_modifiers[$key]);
                }
            }
            $active_modifiers = $modifiers;
        } elseif(preg_match('/(.)(.*)\1$/', $arg)) {
            $cancel_modifiers = $active_modifiers;
            $active_modifiers = array();
        }

        // If expression has modifiers, include them in sub-expression
        $sub_modifier = '(?';
        $sub_modifier .= implode('', $active_modifiers);

        // Cancel modifiers from preceding sub-expression
        if(count($cancel_modifiers) > 0) {
            $sub_modifier .= '-' . implode('-', $cancel_modifiers);
        }

        $sub_modifier .= ')';

        $sub_expression = preg_replace('/^(.)(.*)\1[eimsuxADJSUX]*$/', $sub_modifier . '$2', $arg);

        // Properly escape slashes
        $sub_expression = preg_replace('/(?<!\\\)\//', '\\\/', $sub_expression);

        $sub_expressions[] = $sub_expression;
    }

    // Join expressions
    $expression .= implode('|', $sub_expressions);

    $expression .= ')/';
    return $expression;
} 
```

编辑：我重写了这个（因为我是强迫症）并最终得到：

```
function preg_magic_coalesce($expressions = array(), $global_modifier = '') {
    if(!preg_match('/^((?:-?[eimsuxADJSUX])+)$/', $global_modifier)) {
        $global_modifier = '';
    }

    $expression = '/(?:';
    $sub_expressions = array();
    foreach($expressions as $sub_expression) {
        $active_modifiers = array();
        // Determine modifiers from sub-expression
        if(preg_match('/^(.)(.*)\1((?:-?[eimsuxADJSUX])+)$/', $sub_expression, $matches)) {
            $active_modifiers = preg_split('/(-?[eimsuxADJSUX])/',
                $matches[3], -1, PREG_SPLIT_NO_EMPTY|PREG_SPLIT_DELIM_CAPTURE);
        }

        // If expression has modifiers, include them in sub-expression
        if(count($active_modifiers) > 0) {
            $replacement = '(?';
            $replacement .= implode('', $active_modifiers);
            $replacement .= ':$2)';
        } else {
            $replacement = '$2';
        }

        $sub_expression = preg_replace('/^(.)(.*)\1(?:(?:-?[eimsuxADJSUX])*)$/',
            $replacement, $sub_expression);

        // Properly escape slashes if another delimiter was used
        $sub_expression = preg_replace('/(?<!\\\)\//', '\\\/', $sub_expression);

        $sub_expressions[] = $sub_expression;
    }

    // Join expressions
    $expression .= implode('|', $sub_expressions);

    $expression .= ')/' . $global_modifier;
    return $expression;
} 
```

它现在使用`(?modifiers:sub-expression)`而不是`(?modifiers)sub-expression|(?cancel-modifiers)sub-expression`，但我注意到两者都有一些奇怪的修饰符副作用。例如，在这两种情况下，如果子表达式有`/u`修饰符，它将无法匹配（但如果您`'u'`作为新函数的第二个参数传递，则匹配得很好）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-29T20:48:46.450

## 编辑

**我重写了代码！**它现在包含如下所列的更改。此外，我已经进行了广泛的测试（我不会在这里发布，因为它们太多了）来查找错误。到目前为止，我还没有找到任何东西。

*   该函数现在分为两部分：有一个单独的函数`preg_split`，它接受一个正则表达式并返回一个包含裸表达式（不带分隔符）的数组和一个修饰符数组。这可能会派上用场（事实上，它已经派上用场了；这就是我进行此更改的原因）。

*   **该代码现在可以正确处理反向引用。**毕竟，这对我的目的来说是必要的。不难添加，用于捕获反向引用的正则表达式看起来很奇怪（实际上可能效率极低，对我来说看起来 NP 很难——但这只是一种直觉，只适用于奇怪的边缘情况） . 顺便说一句，有没有人知道比我的方法更好的检查奇数匹配的方法？否定的lookbehinds在这里不起作用，因为它们只接受固定长度的字符串而不是正则表达式。但是，我需要这里的正则表达式来测试前面的反斜杠是否真的被转义了。

    此外，我不知道 PHP 在缓存匿名`create_function`使用方面有多好。就性能而言，这可能不是最好的解决方案，但似乎已经足够好了。

*   我已经修复了健全性检查中的一个错误。

*   由于我的测试表明没有必要，我已经删除了对过时修饰符的取消。

[顺便说一句，这段代码是我在 PHP 中使用的各种语言的语法高亮器的核心组件之一，因为我对其他地方](https://stackoverflow.com/questions/230270/php-syntax-highlighting)列出的替代方案不满意。

## 谢谢！

**porneL**，**无眼睑**，惊人的工作！非常感谢。我其实已经放弃了。

我已经建立在您的解决方案之上，我想在这里分享它。~~我没有实现重新编号反向引用，因为这与我的情况无关（我认为......）。不过，也许这将在以后变得必要。~~

## 一些问题……</h2>

一件事，*@eyelidlessness*：~~为什么你觉得有必要取消旧的修饰符？据我所知，这不是必需的，因为无论如何修饰符仅在本地应用。啊，是的，另一件事。您对分隔符的转义似乎过于复杂。愿意解释为什么你认为这是必要的吗？我相信我的版本应该也可以，但我可能错了。~~

此外，我已经更改了您的函数的签名以符合我的需要。我还认为我的版本更普遍有用。再说一次，我可能错了。

顺便说一句，您现在应该意识到实名对 SO 的重要性。;-) 我不能在代码中给你真正的功劳。：-/

## 编码

无论如何，我想分享我到目前为止的结果，因为我无法相信没有其他人需要这样的东西。该代码*似乎*运行良好。~~不过，尚未进行广泛的测试。~~ **请给出意见！**

事不宜迟……</p>

```
/**
 * Merges several regular expressions into one, using the indicated 'glue'.
 *
 * This function takes care of individual modifiers so it's safe to use
 * <em>different</em> modifiers on the individual expressions. The order of
 * sub-matches is preserved as well. Numbered back-references are adapted to
 * the new overall sub-match count. This means that it's safe to use numbered
 * back-refences in the individual expressions!
 * If {@link $names} is given, the individual expressions are captured in
 * named sub-matches using the contents of that array as names.
 * Matching pair-delimiters (e.g. <code>"{…}"</code>) are currently
 * <strong>not</strong> supported.
 *
 * The function assumes that all regular expressions are well-formed.
 * Behaviour is undefined if they aren't.
 *
 * This function was created after a {@link https://stackoverflow.com/questions/244959/
 * StackOverflow discussion}. Much of it was written or thought of by
 * “porneL” and “eyelidlessness”. Many thanks to both of them.
 *
 * @param string $glue  A string to insert between the individual expressions.
 *      This should usually be either the empty string, indicating
 *      concatenation, or the pipe (<code>|</code>), indicating alternation.
 *      Notice that this string might have to be escaped since it is treated
 *      like a normal character in a regular expression (i.e. <code>/</code>)
 *      will end the expression and result in an invalid output.
 * @param array $expressions    The expressions to merge. The expressions may
 *      have arbitrary different delimiters and modifiers.
 * @param array $names  Optional. This is either an empty array or an array of
 *      strings of the same length as {@link $expressions}. In that case,
 *      the strings of this array are used to create named sub-matches for the
 *      expressions.
 * @return string An string representing a regular expression equivalent to the
 *      merged expressions. Returns <code>FALSE</code> if an error occurred.
 */
function preg_merge($glue, array $expressions, array $names = array()) {
    // … then, a miracle occurs.

    // Sanity check …

    $use_names = ($names !== null and count($names) !== 0);

    if (
        $use_names and count($names) !== count($expressions) or
        !is_string($glue)
    )
        return false;

    $result = array();
    // For keeping track of the names for sub-matches.
    $names_count = 0;
    // For keeping track of *all* captures to re-adjust backreferences.
    $capture_count = 0;

    foreach ($expressions as $expression) {
        if ($use_names)
            $name = str_replace(' ', '_', $names[$names_count++]);

        // Get delimiters and modifiers:

        $stripped = preg_strip($expression);

        if ($stripped === false)
            return false;

        list($sub_expr, $modifiers) = $stripped;

        // Re-adjust backreferences:

        // We assume that the expression is correct and therefore don't check
        // for matching parentheses.

        $number_of_captures = preg_match_all('/\([^?]|\(\?[^:]/', $sub_expr, $_);

        if ($number_of_captures === false)
            return false;

        if ($number_of_captures > 0) {
            // NB: This looks NP-hard. Consider replacing.
            $backref_expr = '/
                (                # Only match when not escaped:
                    [^\\\\]      # guarantee an even number of backslashes
                    (\\\\*?)\\2  # (twice n, preceded by something else).
                )
                \\\\ (\d)        # Backslash followed by a digit.
            /x';
            $sub_expr = preg_replace_callback(
                $backref_expr,
                create_function(
                    '$m',
                    'return $m[1] . "\\\\" . ((int)$m[3] + ' . $capture_count . ');'
                ),
                $sub_expr
            );
            $capture_count += $number_of_captures;
        }

        // Last, construct the new sub-match:

        $modifiers = implode('', $modifiers);
        $sub_modifiers = "(?$modifiers)";
        if ($sub_modifiers === '(?)')
            $sub_modifiers = '';

        $sub_name = $use_names ? "?<$name>" : '?:';
        $new_expr = "($sub_name$sub_modifiers$sub_expr)";
        $result[] = $new_expr;
    }

    return '/' . implode($glue, $result) . '/';
}

/**
 * Strips a regular expression string off its delimiters and modifiers.
 * Additionally, normalize the delimiters (i.e. reformat the pattern so that
 * it could have used '/' as delimiter).
 *
 * @param string $expression The regular expression string to strip.
 * @return array An array whose first entry is the expression itself, the
 *      second an array of delimiters. If the argument is not a valid regular
 *      expression, returns <code>FALSE</code>.
 *
 */
function preg_strip($expression) {
    if (preg_match('/^(.)(.*)\\1([imsxeADSUXJu]*)$/s', $expression, $matches) !== 1)
        return false;

    $delim = $matches[1];
    $sub_expr = $matches[2];
    if ($delim !== '/') {
        // Replace occurrences by the escaped delimiter by its unescaped
        // version and escape new delimiter.
        $sub_expr = str_replace("\\$delim", $delim, $sub_expr);
        $sub_expr = str_replace('/', '\\/', $sub_expr);
    }
    $modifiers = $matches[3] === '' ? array() : str_split(trim($matches[3]));

    return array($sub_expr, $modifiers);
} 
```

PS：我已将这个发布社区 wiki 设为可编辑。你知道这是什么意思 …！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-28T21:45:33.027

我很确定不可能像这样用任何语言将正则表达式放在一起——它们可能有不兼容的修饰符。

我可能只是将它们放在一个数组中并循环遍历它们，或者手动组合它们。

编辑：如果您按照编辑中的描述一次做一个，您也许可以在子字符串上运行第二个（从开始到最早的匹配）。这可能会有所帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-28T21:47:19.547

```
function preg_magic_coalasce($split, $re1, $re2) {
  $re1 = rtrim($re1, "\/#is");
  $re2 = ltrim($re2, "\/#");
  return $re1.$split.$re2;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-28T22:21:22.753

你可以这样做：

```
$a = '# /[a-z] #i';
$b = '/ Moo /x';

$a_matched = preg_match($a, $text, $a_matches);
$b_matched = preg_match($b, $text, $b_matches);

if ($a_matched && $b_matched) {
    $a_pos = strpos($text, $a_matches[1]);
    $b_pos = strpos($text, $b_matches[1]);

    if ($a_pos == $b_pos) {
        if (strlen($a_matches[1]) == strlen($b_matches[1])) {
            // $a and $b matched the exact same string
        } else if (strlen($a_matches[1]) > strlen($b_matches[1])) {
            // $a and $b started matching at the same spot but $a is longer
        } else {
            // $a and $b started matching at the same spot but $b is longer
        }
    } else if ($a_pos < $b_pos) {
        // $a matched first
    } else {
        // $b matched first
    }
} else if ($a_matched) {
    // $a matched, $b didn't
} else if ($b_matched) {
    // $b matched, $a didn't
} else {
    // neither one matched
} 
```

# .net - 如何物理获取存储在 GAC 中的所有版本的程序集？

> ID：244976
> 
> 赞同：1
> 
> 时间：2008-10-28T21:42:13.800
> 
> 标签：.net, gac

我在 GAC（全局程序集缓存）中有相同程序集的 3 个版本，但是当我进入框架文件夹时，我实际上需要一个特定版本，即

c:\WINDOWS\Microsoft.NET\Framework\v1.1.4322\

位于文件夹中的程序集是最新版本。

我可以实际检索添加到 GAC 中的第一个版本吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T21:47:33.990

您在寻找像[GacView](http://www.nirsoft.net/dot_net_tools/gac_viewer.html)这样的工具吗？

GACView 是 Windows Explorer 上标准 .NET 程序集查看器的替代品。除了标准列之外，GACView 还显示每个程序集的附加信息，例如修改日期、文件大小、程序集文件的完整路径、文件版本等。GACView 还允许您删除无法以常规方式卸载的程序集。

您还可以查看这篇文章[Demystifying the .NET Global Assembly Cache](http://www.codeproject.com/KB/dotnet/demystifygac.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T21:47:31.807

应该能够使用[GAC Api](http://www.codeproject.com/KB/system/gacapi.aspx)做到这一点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T21:50:28.383

gacutil /l <程序集名称>

# iphone - 在设备上安装 iPhone 应用程序时出错

> ID：244992
> 
> 赞同：4
> 
> 时间：2008-10-28T21:47:28.547
> 
> 标签：iphone, xcode, app-id

我今天设置了所有证书和密钥，并试图在我的 iPhone 上运行我的项目。我遇到了这个奇怪的错误：

> 您的移动设备在安装阶段遇到意外错误 (0xE800003A)：正在验证应用程序

在 Apple Developer 论坛上闲逛，我尝试设置新的证书和配置文件以及编辑`Info.plist`，但无论我做什么，我似乎都无法在我的设备上运行该应用程序。

我目前能想到的唯一想法是我在 Xcode 中的项目名称与我的开发配置文件略有不同（它使用问号），但我根据 Apple 的约定命名它：`com.mycompany.myapp`，所以我不确定那是不是问题。

有任何想法吗？

**编辑：我已经硬重启了手机，重启了 Xcode，清理了我的目标，设置了一个新的通配符 App ID 和相应的配置文件，但仍然没有。还有其他想法吗？**

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-10T21:12:32.383

事实证明，我在钥匙串中有 2 个证书同时相互覆盖！我希望这对未来的人们有所帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T22:04:21.587

您应该创建一个通配符应用 ID；com.mycompany.*. 这可能会有所帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-28T22:19:15.893

我在很多场合都遇到过这种情况。我所做的是清理所有目标，关闭 xcode，然后硬重启我的手机。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-29T06:10:52.913

这是一个与更常见的证书错误问题不同的错误......

恢复手机（使用 XCode Organizer 重新加载最新的操作系统），为安全起见，第一次与 iTunes 同步时不要从备份中恢复（即使您不使用同步，它仍会保留您的号码）备份）。我不得不这样做几次，最后一次是在部署过程中，当我从电缆上拔下电话时（必须接听电话）。

首先尝试重新启动（手机），将其与 XCode 关闭。但是，如果这不能解决问题，那么恢复就是方法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-30T02:50:10.057

XCode Organizer 中的控制台选项卡有时会提供有关安装阶段发生的情况的有用提示。在一种情况下，我的问题是我的应用程序已经存在于手机上。我删除了我的应用程序，安装成功。

无论如何，看起来很多错误消息都捆绑在这条神秘消息中，并且要真正诊断正在发生的事情，我发现控制台选项卡非常有用......

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-30T18:16:36.710

要尝试的另一件事是重新安装 iPhone SDK。当我第一次获得开发人员密钥时遇到了这样的错误，这是唯一的解决方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-31T01:16:24.380

只想对大家说，当你去编辑 Targets-> 一定要把左上角的“配置”设置为“所有配置”或者你正在构建的正确配置（调试或发布）。您可能认为您的设置正确，但这将是错误的配置。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-31T03:34:46.973

我已经在正确配置的设备上看到了该错误，该设备之前已成功从 XCode 安装应用程序，并且我很幸运地重新启动了**设备**并再次尝试。也许这会有所帮助。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-31T16:37:46.623

尝试在发布模式而不是调试模式下运行。我有一个解决这个问题的工作项目。不知道问题是什么，但在发布模式下运行它可以工作，但调试模式会产生错误代码。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-11T15:57:29.790

我有针对同一问题的 Apple 开发人员支持的支持票，并且（FWIW）如果他们可以让我的工具链正常工作，我将发布他们的建议。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-21T14:42:45.733

试试这个：（来源：[http](http://ephemera.lifewithalacrity.com/iphone_development/) ://ephemera.lifewithalacrity.com/iphone_development/ ）

尽管据说这仅适用于分发版本，但它帮助我能够在我的 iPhone 上再次安装我的调试版本，因为它昨天神秘地坏了。

“只需三重检查项目属性中的所有代码签名是否清晰或默认”

Note, this is the PROJECT properties as opposed to the TARGET properties. I set my Code Signing Provisioning Profile back to the default and removed the Code Signing Identity string.

# configuration-management - 执行 CMMI 物理配置审计的最佳方法？

> ID：244996
> 
> 赞同：2
> 
> 时间：2008-10-28T21:48:30.400
> 
> 标签：configuration-management, cmmi

我目前工作的组织正在进入整个 CMMI 世界，记录一切。我（与其他人一起）被分配了配置经理的头衔。恭喜我没错。

部分职责是定期（他们仍在定义定期，将按季度或按月）进行物理配置审计。这基本上是检查生产中部署的源代码版本与我们认为生产中的源代码版本。

我们的项目是一个用 Java 编写的相对较小的 Web 应用程序。我们使用的文件类型是 java、jsp、xml、属性文件和 sql 包。

我遇到的问题（并且已经表达但似乎被忽略了）是我应该如何物理登录到生产服务器并验证文件版本，即使我可以这样做也会花费大量时间？

文件版本甚至当前不在文件中（即在评论或其他内容中）。建议我们在每个用户可见的屏幕上放置可见的版本号。我也觉得这很荒谬，因为屏幕本身只代表我们维护的代码的一小部分。

我们目前使用的工具是用于我们的 IDE 的 Netbeans 和作为我们的版本控制工具的 Serena Dimensions。

我正在特别寻找有关如何以希望更自动化的方式执行此审核的想法，这将既准确又不耗时。

我目前的想法是在每个文件的顶部添加一个包含该文件版本号的注释，一个在创建生产构建时运行的脚本以创建 XML 文件或包含每个文件的文件名和版本文件的类似文件构建中的文件。然后，当我需要进行审计时，我会去生产服务器获取带有信息的 xml 文件，并以编程方式将其与我们认为在生产中的内容进行比较，然后输出报告。

任何更好的想法。我知道这必须已经完成，并且对我来说似乎很疯狂，因为我没有找到任何其他资源。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T21:52:18.960

您可以计算生产服务器上源文件的 SHA1 哈希值，并将该哈希值与存储在源代码控制中的版本进行比较。如果您可以在源代码管理中找到相同的哈希，那么您就知道生产中的版本。如果您在源代码控制中*找不到*相同的哈希值，则说明生产中有未跟踪的修改，您的新职位是合理的。:)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-28T22:22:43.640

典型的陷入 CMMI 陷阱的组织试图做任何事情都做得过火。如果我可以提出任何建议，那就是从小处着手，只做你需要的。因此，请考虑您之前在 CM 领域可能遇到的任何问题。

CMMI 描述了组织应该做什么，但如何由您决定。[CMMI 规范](http://www.sei.cmu.edu/publications/documents/06.reports/06tr008.html)，第2 章非常值得一读——它描述了规范的必需、预期和信息性组件——基本上，目标是必需的，实践是预期的，其他一切都是信息性的。这意味着只有一小部分规范是 CMMI 评估员可以直接要求的——目标。在实践层面，既可以采用所描述的实践，也可以采用*可接受的替代方法*。

在配置审计的情况下，目标 SG3 是“建立和维护基线的完整性”。SP3.2 说“执行配置审计以维护配置基线的完整性。” 这里没有说明这些操作的频率或可能需要多长时间。

在我以前的组织中，FCA/PCA 通常只作为产品发布过程的一部分完成，我们使用 ClearCase 作为版本控制工具，并在代码库中应用标签来定义基线。我们在所有源文件中都没有版本号，在所有产品屏幕上也没有版本号 - CM 活动正在做正确的事情并得到审计的支持，这在任何 CMMI 评估中都不是问题. 我们可以使用标签之间的差异来查看哪些文件发生了更改，执行差异来查看实际的代码更改。该过程的一个重要部分是能够将这些更改链接回需求/错误报告/引发更改的任何原因。

我们的审计确实使用脚本来自动化流程，但这些是内部开发的特定于 ClearCase 的脚本 - 基本上它们会列出所有文件、它们在 CM 系统中的版本以及它们所属的基线/配置项。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T21:53:49.407

您不能为此使用源代码管理吗？如果您部署一个版本并使用该部署标记您的源代码控制，那么您可以根据源代码控制系统进行验证****