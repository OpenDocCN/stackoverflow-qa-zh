# StackOverflow 问答 000319000-000319999

# c# - 模拟属性 - C#

> ID：319002
> 
> 赞同：2
> 
> 时间：2008-11-25T21:49:38.660
> 
> 标签：c#, unit-testing, attributes, mocking

我在项目中使用自定义属性，我想将它们集成到我的单元测试中。

现在我使用 Rhino Mocks 来创建我的模拟，但我没有看到将我的属性（和那里的参数）添加到它们的方法。

我错过了什么，还是不可能？其他模拟框架？还是我必须使用我的属性创建虚拟实现？

示例：我在插件架构（IPlugin）中有一个接口，并且有一个属性可以将元信息添加到属性。然后我在插件实现中查找具有此属性的属性以进行额外处理（存储其值，标记为 gui 只读...）

现在，当我创建模拟时，我可以轻松地将属性添加到属性或对象实例本身吗？

编辑：我发现了一个有同样问题的帖子 ->[链接](http://saloon.javaranch.com/cgi-bin/ubb/ultimatebb.cgi?ubb=get_topic&f=68&t=001581)。答案不是 100%，而是 Java ......

编辑2：可以做到...搜索了更多（关于SO）并找到了2个相关问题（+答案）

[这里](https://stackoverflow.com/questions/129285/can-attributes-be-added-dynamically-in-c)和[这里](https://stackoverflow.com/questions/268426/how-do-i-add-attributes-to-a-method-at-runtime)

现在，这是否已经在一个或另一个模拟框架中实现了？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T23:09:21.573

这是我如何测试自定义属性的示例。在这种情况下，我有一个用于方法的自定义属性。在我的测试类中，我创建了一个应用自定义属性的占位符方法。然后我使用反射来获取自定义属性的实例。

```
[TestFixture] public class SomeRandomAttributeTest
{
    [SomeRandom(RestrictionType.Local)]
    public void PlaceholderMethodForAttribute() {throw new ApplicationException(this.ToString());}

    [Test]public void BlahBlahIsBlahTheBlah()
    {
        object[] attributes = this.GetType().GetMethod("PlaceholderMethodForAttribute").GetCustomAttributes(false);
        Assert.AreEqual(1, attributes.Length);
        Assert.IsInstanceOfType(typeof(SomeRandomAttribute), attributes[0]);

        Assert.AreEqual("Yada yada yada", ((SomeRandomAttribute) attributes[0]).Yada);

    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T23:46:45.947

为什么你不能这样做：

```
var sut = new SomeRandomAttribute(RestrictionType.Local);
Assert.AreEqual("Yada yada yada", sut.Yada); 
```

如果您想测试访问所有类型的代码并为`SomeRandomAttribute`它找到的每个 's 做一些事情，我建议您将其拆分为检索用您的自定义属性装饰的 MethodInfo 对象和需要的操作对这些对象执行。给定正确配置的 MethodInfo 对象和属性，后者应该很容易测试。前者可以通过对您的属性使用特定的测试占位符来完成，如 Joseph 所建议的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-05-04T20:04:29.993

这取决于您需要测试的内容：

*   测试属性的某些“功能”，如果您添加的属性对其装饰的类/方法有一些影响，您可以创建一个虚拟类，该类继承*IPlugin*与该属性并测试其行为是否受到属性存在的影响或价值。
*   如果您想测试该属性的某些内部功能，则只需创建该属性并使用断言来验证该最终结果。

我认为你不需要在这里嘲笑。

# asp.net - ASP.NET - 将网站投入生产的基本清单

> ID：319009
> 
> 赞同：16
> 
> 时间：2008-11-25T21:51:23.807
> 
> 标签：asp.net, performance, deployment, production

我正在构建一个静态 ASP.NET 站点（使用 Masterpages 和一些表单），并且即将将它发布到我的生产服务器上。

我知道更改`<compilation debug="true">`为 false，但我想知道我还能做些什么来获得尽可能高的速度。网站没有数据访问，都是静态内容。

有没有人有他们通过的清单或知道在生产环境中设置站点的好资源，重点是性能？

**到目前为止的清单**（随时自行编辑，添加任何有价值的内容）

1.  确保在 Web.Config`<compilation debug="false" />`中实际设置为**false**
2.  确保在 Web.Config`<trace enabled="false" />`中实际设置为**false**
3.  为站点设置必要的读/写/修改文件夹权限
4.  在 IIS 中启用 GZIP（显着减小页面/css/javascript 的大小）
5.  您是否考虑过任何页面/控件的 OutputCaching？
6.  考虑设置 Web 测试（例如 .NET 的 WatiN）以确保您网站上的功能仍然可以正常工作
7.  确保不是周五下午！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-25T22:04:19.287

如果您正在编写任何日志或输出文件，请确保在生产环境中设置了正确的文件夹权限。通常，调试/测试环境在文件读/写权限方面比生产环境宽松得多。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-01T02:59:47.820

不要在周五下午部署！这保证会让你在周末搞砸。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-05T12:51:22.953

实际上，MSDN 上提供了一个关于[如何执行安全部署审查的非常好的清单。](http://msdn.microsoft.com/en-us/library/ms998367.aspx)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-25T21:58:02.623

另外，不要忘记检查 IIS 中的 gzip 设置。压缩输出将使事情通过网络传输得更快。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-25T22:28:19.270

如果您的站点使用数据库并且只*显示*信息，请将数据库设置为只读。**这消除了所有锁定处理并大大**加快了访问速度。

如果您有一个更新数据的后端，请将其设为一个单独的数据库，并安排每天一次更新只读数据库或该应用程序所需的时间。

如果您只是在公司网站上展示新闻和其他不经常更改的小事，那么此解决方案可能适合您。即使它是一个拥有千兆字节数据的网站。关键词是，我们多久更新一次数据？

从我在日常业务中看到的情况来看，没有人真正考虑过这个解决方案，因为一切都必须是“实时的”，但在很多情况下这将是一个完美的解决方案。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-25T21:53:52.070

查看您的 web.config

检查调试（web.config / *.svc），跟踪，...

将调试更新为生产值：

*   电子邮件地址
*   （网络）服务地址
*   位置日志文件

快速搜索：[链接](http://aspnetresources.com/articles/debug_code_in_production.aspx)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-25T22:01:22.040

如果它的所有静态内容，你会想要使用积极的[输出缓存](http://msdn.microsoft.com/en-us/library/06bh14hk(VS.71).aspx)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-26T13:03:03.227

您应该进行某种测试来验证您网站的各种功能和权限。例如，一旦您发布。浏览清单，如果我没有权限，我可以访问 x 吗？x,y,z 是否适用于应用程序？我在每次发布后都会这样做，因为小的更改会产生很大的影响。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-09-07T16:20:43.207

您应该阅读以下内容：
[https ://stackoverflow.com/questions/72394/what-should-a-developer-know-before-building-a-public-web-site](https://stackoverflow.com/questions/72394/what-should-a-developer-know-before-building-a-public-web-site)

它目前是关于 SO 的第 9 高投票问题，也是最受欢迎的前 3 名。需要注意的是，它与平台无关，所以它缺少一些 ASP.Net 特定的项目。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-09-07T16:41:13.303

清除浏览器缓存后，在公司防火墙/代理之外彻底测试站点。这将有助于确保所有资源都可以公开访问（并且不在本地服务器上或缓存）。例如，您可能会发现您使用绝对 URL 来包含 JavaScript 或 CSS 文件。这些在您的开发环境中可以正常工作，但是一旦站点上线，它们就无法访问。或者，您的缓存中有一个 CSS 文件随后被删除，但您没有注意到。

确保您使用的任何具有与域绑定的密钥的产品/应用程序都可以在您的实时站点上运行。这包括诸如 Google Map 键或商业 3rd 方应用程序之类的东西。它还包括通过电子邮件发送的自动生成的超链接。您不希望用户注册具有返回[http://localhost/comfirm.aspx](http://localhost/comfirm.aspx)之类的链接，对吗？

# python - Python中的相对路径问题

> ID：319037
> 
> 赞同：3
> 
> 时间：2008-11-25T21:57:32.000
> 
> 标签：python, windows

我知道这是一个简单的、初学者的 Python 问题，但我无法使用相对路径打开文件。这种行为对我来说似乎很奇怪（来自非 Python 背景）：

```
import os, sys

titles_path = os.path.normpath("../downloads/movie_titles.txt")

print "Current working directory is {0}".format(os.getcwd())
print "Titles path is {0}, exists? {1}".format(movie_titles_path, os.path.exists(movie_titles_path))

titlesFile = open(movie_titles_path, 'r')
print titlesFile 
```

这导致：

```
C:\Users\Matt\Downloads\blah>testscript.py

Current working directory is C:\Users\Matt\Downloads\blah
Titles path is ..\downloads\movie_titles.txt, exists? False

Traceback (most recent call last):
  File "C:\Users\Matt\Downloads\blah\testscript.py", line 27, in <module>
    titlesFile = open(titles_path, 'r')
IOError: [Errno 2] No such file or directory: '..\\downloads\\movie_titles.txt' 
```

但是，dir 命令显示该文件在相对路径存在：

```
C:\Users\Matt\Downloads\blah>dir /b ..\downloads\movie_titles.txt
movie_titles.txt 
```

Python 如何解释 Windows 上的相对路径是怎么回事？用相对路径打开文件的正确方法是什么？

**此外**，如果我将路径包装在 中`os.path.abspath()`，则会得到以下输出：

```
Current working directory is C:\Users\Matt\Downloads\blah
Titles path is C:\Users\Matt\Downloads\downloads\movie_titles.txt, exists? False
Traceback (most recent call last):
  File "C:\Users\Matt\Downloads\blah\testscript.py", line 27, in <module>
    titlesFile = open(titles_path, 'r')
IOError: [Errno 2] No such file or directory: 'C:\\Users\\Matt\\Downloads\\downloads\\movie_titles.txt' 
```

在这种情况下，似乎该`open()`命令会自动转义`\`字符。

**令人尴尬的最终更新：看起来我在 pathanme 中打了一个字符 :) 在 Windows 上执行此操作的正确方法似乎是使用`os.path.normpath()`，就像我最初所做的那样。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-25T22:04:10.567

`normpath`仅返回该特定路径的规范化版本。它实际上并没有为您*解决*路径的工作。你可能想做`os.path.abspath(yourpath)`.

另外，我假设您使用的是 IronPython。否则，表达该字符串格式的标准方法是：

```
"Current working directory is %s" % os.getcwd()
"Titles path is %s, exists? %s" % (movie_titles_path, os.path.exists(movie_titles_path)) 
```

（对不起，这只是对中途发布问题的回答。我对完整的解决方案感到困惑。）

# asp.net - 如何在 ASP.NET 中将图片设置为背景？

> ID：319038
> 
> 赞同：2
> 
> 时间：2008-11-25T21:57:35.370
> 
> 标签：asp.net, background

我已将 jpg 文件添加到 App_localResources 文件夹中，并在文档属性中指定了背景属性中的照片。在设计器中它显示为背景，但是当我运行页面时，我仍然得到白色页面背景。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-25T22:46:26.567

没有明显的 ASP.Net 方法可以做到这一点。

规范的 HTML 方法是包含以下 CSS：

```
body { background-image: url('background.jpg'); } 
```

如果您使用 Attributes 属性定义了 body 标记，`runat="server"`则可以使用 Attributes 属性添加内联样式，但这不是一个好主意。像这样的布局细节应该放在样式表中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-25T22:39:42.633

我会检查内置的 Web 服务器是否仍在运行并停止它，然后重新运行您的应用程序。

* 右键单击​​托盘图标并选择“停止”。

该页面正在被缓存，您现在应该可以看到您的更改。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T22:51:11.113

我使用 fiddler 来跟踪图像上的调用。App_LocalResources\*.jpg 返回 403 错误。App_LocalResources 文件夹真正用于本地化。如果我将图像移动到图像文件夹中，它可以正常工作。另外，不要设置 Background 属性，而是使用 Style 属性和 background 属性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-25T21:59:53.947

猜测也许您有一个样式表可能会覆盖背景？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-09-05T05:48:58.297

有时您需要在更改背景和颜色后清除浏览器的缓存，以便下次运行站点时应用它。看看这里： http: [//www.wikihow.com/Clear-Your-Browser%27s-Cache](http://www.wikihow.com/Clear-Your-Browser%27s-Cache)

# sql-server - 全文搜索排名（SQL Server）

> ID：319044
> 
> 赞同：6
> 
> 时间：2008-11-25T21:58:41.390
> 
> 标签：sql-server, sql-server-2005, full-text-search

在过去的几个小时里，我一直在处理各种不同的 SQL Server 全文搜索变体。但是我仍然无法弄清楚排名是如何运作的。我遇到了几个例子，这些例子真的让我很困惑，他们的排名如何高于其他人。例如

我有一个没有索引的 5 列 + 更多的表。都是`nvarchar`领域。

我正在运行这个查询（好吧几乎......我用不同的名字重新输入了）

```
SET @SearchString = REPLACE(@Name, ' ', '*" OR "') --Splits words with an OR between
SET @SearchString = '"'+@SearchString+'*"'
print @SearchString;

SELECT ms.ID, ms.Lastname, ms.DateOfBirth, ms.Aka, ms.Key_TBL.RANK, ms.MiddleName, ms.Firstname
FROM View_MemberSearch as ms
INNER JOIN CONTAINSTABLE(View_MemberSearch, (ms.LastName, ms.Firstname, ms.MiddleName, ms.Aka, ms.DateOfBirth), @SearchString) AS KEY_TBL
    ON ms.ID = KEY_TBL.[KEY]
WHERE KEY_TBL.RANK > 0
ORDER BY KEY_TBL.RANK DESC; 
```

因此，如果我搜索**11/05/1964 JOHN JACKSON**，我会得到**"11/05/1964" OR "JOHN*" OR "JACKSON*"**和这些结果：

```
ID -- First Name -- Middle Name -- Last Name -- AKA -- Date of Birth -- SQL Server RANK
----------------------------------------------------------------------------------
1  |  DAVE       |  JOHN        |  MATHIS     | NULL | 11/23/1965    |  192
2  |  MARK       |  JACKSON     |  GREEN      | NULL | 05/29/1998    |  192
3  |  JOHN       |  NULL        |  JACKSON    | NULL | 11/05/1964    |  176
4  |  JOE        |  NULL        |  JACKSON    | NULL | 10/04/1994    |  176 
```

所以最后我的问题。我看不到第 1 行和第 2 行如何排在第 3 行之上，以及为什么第 3 行的排名与第 4 行相同。到目前为止，第 2 行应该具有最高排名，因为搜索字符串也与名字和姓氏匹配作为出生日期。

如果我将 OR 更改为 AND，我不会得到任何结果。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-26T23:07:02.607

我发现 AND 和 OR 子句不适用于列。创建一个合并列的索引视图，您将获得更好的结果。看看我过去的问题，你会发现适合你的情况的信息。

我还发现我最好不要附加“*”。我认为它会出现更多匹配，但它往往会返回更差的结果（特别是对于长词）。作为中间立场，您可能只将 * 附加到较长的单词。

你给出的例子肯定很奇怪。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-27T22:33:22.363

这并不*完全*等同，但也许我问[的这个问题（如何：排名搜索结果](https://stackoverflow.com/questions/47762/how-to-ranking-search-results)）可能会有所帮助？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T21:11:46.880

如果删除 DoB 标准会发生什么？

MS 全文搜索真的是一个难以理解和自定义的黑匣子 你几乎照原样接受它，不像 Lucene 非常适合自定义

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-02T16:22:55.327

谢谢你们。

弗兰克，你说得对，AND 和 OR 不跨越列，这是我一开始没有注意到的。

为了获得最佳结果，我必须将所有 5 列合并为视图中的 1 列。然后搜索该单列。这样做给了我我想要的确切结果，没有任何额外的东西。

My actual search string after converting it ended up being **"Word1*" AND "Word2*"**

Using the % sign still did not do what msdn said it should do. Meaning if I searched for the word josh and it got changed into "Josh%" when I searched then "Joshua" would not be found. Pretty dumb however with "Josh*" then joshua would be found.

# css - 如何居中 IE6 中的元素

> ID：319057
> 
> 赞同：2
> 
> 时间：2008-11-25T22:02:47.527
> 
> 标签：css, internet-explorer-6

尝试使用包含所有内容的单独 div 部分来实现对话框样式的行为。

当需要显示“对话框”时，它必须显示在WINDOW的中心，而不是页面的中心，即不考虑滚动位置。此外，如果用户滚动页面，正确的解决方案不会移动“对话框”。

在 Chrome 和 FF 中，这使用 position='fixed' 并以直观的方式使 div 居中。

这在 IE6 中似乎不起作用（显然不支持修复）。

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-25T22:46:55.100

如果我是你，我会用 jQuery 来做，我建议你也试试。这应该非常适合基于 jQuery 的解决方案 [jQuery 版本][1] 或尝试

```
body { 
    font: 80% verdana, arial, helvetica, sans-serif;        
    text-align: center; /* for IE */    
}   

#container {        
    margin: 0 auto;   /* align for good browsers */         
    text-align: left; /* counter the body center */
    border: 2px solid #000;         
    width: 80%;     
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-25T22:06:51.607

[试试这里](http://www.cssplay.co.uk/layouts/fixed.html)列出的方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-01-10T02:09:26.600

使用`overflow-y`和绝对定位来模拟 IE6 中的固定定位，使用以下步骤：

1.  创建一个绝对定位的 div 并在页面上为其指定所需的顶部和左侧坐标

2.  设置`html {overflow-y: }`为隐藏或可见，而不是默认的自动或滚动以消除绝对定位的 div 的滚动条

3.  设置`body{overflow-y: }`为自动或滚动为正文内容插入新的滚动条

4.  设置`body { margin:0; height:100% }`以确保内容滚动条与页面的长度一致

5.  在 body 上设置顶部和左侧边距以将内容与绝对定位的 div 分开

6.  确保将文档类型设置为在 IE 中触发标准模式

7.  将绝对定位的 div 设置为`top:50%; left:50%;`

8.  将所需的不透明度添加`position:relative`到容器 div

如果没有设置 doctype，则将 html 规则移动到 body 标签，并将 body 规则移动到包装器 div

```
<!DOCTYPE html>
<html>
  <head>
  <style>
  body { margin:0; margin-left: 14em; }

  #fixedbox { position: fixed; top: 1em; left: 1em; width: 10em; }

  #fixedbox { padding: 0.5em; border: 1px solid #000; }

  #container { height: 2000px; }

  @media,
    {
    html { _overflow-y: visible; *overflow-y: auto; }
    body { _overflow-y: auto; _height: 100%; }
    #container { _position: relative; }
    #fixedbox { _position: absolute; _top:50%; _left: 50%; }
    }
   </style>
  </head>
  <body>
    <div id="container">
      Fixed box
    </div>

    <div id="fixedbox">
      Homer
    </div>
  </body>
</html> 
```

# flash - 全屏textField动画速度严重问题

> ID：319063
> 
> 赞同：1
> 
> 时间：2008-11-25T22:04:23.500
> 
> 标签：flash, flash-cs3

我找不到任何合适的方法来使长 textField 在全屏模式下在屏幕上流畅地水平移动。我尝试了很多方法，但它总是时不时卡住几毫秒并破坏整个体验。请，如果有人可以帮助我找到一种在全屏上最好地为大型动态字符串设置动画的方法，我将不胜感激。我尝试使用 var myTween:Tween = new Tween(myText, "x", None.easeNone, 0, newX, 80, true); 甚至使用计时器或帧事件手动移动 x；当文本以全屏方式在屏幕上移动时，它总是会经常卡住几毫秒。我也尝试过使用 Bitmap，但它有点太像素化并且性能没有明显改善。

谢谢您的帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T14:30:43.893

我知道这已经很晚了，但这里列出了一些你可以尝试的事情：

*   您可以尝试使用像[Tweener](http://code.google.com/p/tweener/ "吐温")这样的补间引擎，它独立于帧执行动画，因此它有助于使运动看起来更平滑。

*   如果文本在移动时没有变化，您可以将 TextField 的 cacheAsBitmap 属性设置为“true”。

*   确保 AntiAlias 模式是“动画”而不是“可读性”，因为可读性模式在移动的 TextField 上看起来很奇怪，并且会减慢速度，因为 Flash 会不断尝试重新渲染它。

*   手动将整个 TextField 绘制到位图，然后移动位图。听起来您可能已经尝试过了，但如果做得正确，它应该会大大提高性能。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-25T22:20:58.553

听起来您的机器无法跟上同时运行的所有进程。这是几乎所有协作应用程序的现实。

要减少效果，请尝试降低动画帧速率。它会不太流畅，但帧持续时间将是恒定的，并且跳跃不太明显。这可能是您当前问题的必要妥协。

# javascript - 来自 js 文件的跨域 Ajax 请求

> ID：319065
> 
> 赞同：10
> 
> 时间：2008-11-25T22:05:04.467
> 
> 标签：javascript, html, ajax

这是问题所在：

1.）我们在这里有页面...... www.blah.com/mypage.html

2.) 该页面请求一个像这样的 js 文件 www.foo.com...

```
<script type="text/javascript" src="http://www.foo.com/jsfile.js" /> 
```

3.) “jsfile.js”使用 Prototype 向 www.foo.com 发出 Ajax 请求。

4.) ajax 请求调用 www.foo.com/blah.html。回调函数获取 html 响应并将其扔到 div 中。

这似乎不起作用，我猜它是 XSS。那是对的吗？

如果是这样，我该如何解决这个问题？有没有其他方法可以在不使用 iframe 的情况下在客户端上将我的 html 从 www.foo.com 获取到 www.blah.com？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-25T22:14:25.150

这是 XSS 并且是被禁止的。你真的不应该那样做。

如果您真的需要，让您的 AJAX 代码调用 blah.com 上的本地代码（PHP、ASP 等）并使其表现得像客户端，然后从 foo.com 获取您需要的任何内容并将其返回给客户端。如果您使用 PHP，您可以使用 fopen('www.foo.com/blah.html', 'r') 执行此操作，然后像读取常规文件一样读取内容。

当然，需要在您的 php.ini 中启用 allow_remote_url_fopen（或任何它的确切名称）。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-25T23:09:52.493

有一个[w3c 提议](http://www.w3.org/TR/access-control/)允许站点指定允许对其进行跨站点查询的其他站点。（例如，维基百科可能希望允许对文章的所有请求，但谷歌邮件不希望允许请求 - 因为当您登录谷歌邮件阅读您的邮件时，这可能允许任何网站打开）。

这可能在将来的某个时候可用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-11-22T02:44:37.077

如上所述，JSONP 是一种解决方法。但是，您从中请求数据的站点需要支持 JSONP 以便您在客户端上使用。（JSONP 本质上是在页面中注入一个脚本标签，并提供一个回调函数，该回调函数应该与结果一起调用）

如果您向其发出请求的站点不支持 JSONP，您将不得不在您的服务器上代理该请求。如上所述，您可以在自己的服务器上执行此操作，或者我过去所做的是使用[http://www.jsonpit.com](http://www.jsonpit.com)，它将为您代理请求。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-25T22:42:03.657

一种选择是实现一个代理页面，它将所需的 url 作为参数。例如[http://blah.com/proxy?uri=http://foo.com/actualRequest](http://blah.com/proxy?uri=http://foo.com/actualRequest)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-03T09:07:28.110

JSONP 的部分设计是为了解决您遇到的问题

[http://ajaxian.com/archives/jsonp-json-with-padding](http://ajaxian.com/archives/jsonp-json-with-padding)

JQuery 在他们的 $.getJSON 方法中有它

[http://docs.jquery.com/Ajax/jQuery.getJSON](http://docs.jquery.com/Ajax/jQuery.getJSON)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-25T22:48:31.337

上面显示的方法可能会成为一个很大的安全漏洞。建议您根据白名单验证站点名称并在服务器端构建被代理的实际 URI。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-03T08:36:37.060

对于跨域点击，这是一个很好的工作示例，现在被认为是一些“标准” [http://www.xml.com/pub/a/2005/12/21/json-dynamic-script-tag.html](http://www.xml.com/pub/a/2005/12/21/json-dynamic-script-tag.html)。

还有其他方法，例如注入改变 document.domain 的 iframe

[http://fettig.net/weblog/2005/11/28/how-to-make-xmlhttprequest-connections-to-another-server-in-your-domain/](http://fettig.net/weblog/2005/11/28/how-to-make-xmlhttprequest-connections-to-another-server-in-your-domain/)

我仍然同意，简单的方法是在同一域中调用代理，但它并不是真正的客户端 WS 调用。

# date - Powerbuilder 日期数学

> ID：319073
> 
> 赞同：1
> 
> 时间：2008-11-25T22:08:00.277
> 
> 标签：date, report, powerbuilder, date-math

如何从 PowerBuilder 中的日期减去 30 天？

我有以下代码在参数中返回今天的日期，但我需要今天 - 30 天：

> dw_1.setitem(1, "begin_datetime", datetime(today(), Now()))

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-25T23:00:39.267

您可能正在寻找该`RelativeDate`功能。不幸的是，它需要 a`Date`而不是 a`DateTime`作为参数，但我们可以解决这个问题：

```
dw_1.setItem(1, "begin_datetime", DateTime( RelativeDate( today(), -30), Now() ) 
```

# perl - 如何确定字符串的字符集？

> ID：319095
> 
> 赞同：7
> 
> 时间：2008-11-25T22:18:34.360
> 
> 标签：perl, utf-8, character-encoding

我有几个不同语言的文件。我以为它们都是 UTF-8 编码的，但现在我不太确定。有些角色看起来不错，有些则不然。有没有办法可以分解字符串并尝试识别字符集？也许在空白处分割然后识别每个单词？最后，有没有一种简单的方法可以将字符从一组转换为 UTF-8？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-25T22:37:34.523

如果您不确定字符集，则基本上只能猜测。[utf8::valid](http://search.cpan.org/~rgarcia/perl-5.10.0/lib/utf8.pm)可能会帮助你，但你不能确定。如果您知道如果它不是 unicode，则它必须是特定的字符集（如 Latin-1），那么您很幸运。如果你不知道，你就完蛋了。在任何情况下，除非另有说明，否则您应该始终假定整个文件使用相同的字符集。如果你不这样做，你就会失去理智。

至于您的问题如何在字符集之间进行转换：[Encode](http://search.cpan.org/~dankogai/Encode/Encode.pm)可以为您做到这一点

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-25T22:39:12.757

确定一个文件是否可能是 UTF-8 应该很容易。通常，如果不是 UTF-8，则确定编码将非常困难。

如果文件使用 UTF-8 编码，则每个字节的高位应遵循一个模式。如果一个字符是一个字节，它的高位将被清除（零）。否则，`n`字节字符（其中 n 为 2-4）将`n`第一个字节的高位设置为 1，后跟单个零位。以下`n - 1`字节都应设置最高位并清除第二高位。

如果文件中的所有字节都遵循这些规则，则它可能使用 UTF-8 编码。我说可能，因为任何人都可以发明一种新的编码，这种编码恰好遵循相同的规则，有意或无意地，但对代码的解释不同。

请注意，使用 US-ASCII 编码的文件将遵循这些规则，但每个字节的高位为零。可以将此类文件视为 UTF-8，因为它们在此范围内是兼容的。否则，它是某种其他编码，并且没有固有的测试来区分编码。您必须使用一些上下文知识来猜测。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-25T22:27:46.027

看看iconv

[http://www.gnu.org/software/libiconv/](http://www.gnu.org/software/libiconv/)

[文本::Iconv](http://metacpan.org/pod/Text::Iconv)

# .net - 从父/子的平面列表构建层次结构对象

> ID：319108
> 
> 赞同：23
> 
> 时间：2008-11-25T22:24:43.443
> 
> 标签：.net, hierarchy, mptt, nested-sets

我有一个层次结构中的项目列表，我正在尝试将此列表解析为实际的对象层次结构。我正在使用[修改后的预排序树遍历](http://www.sitepoint.com/article/hierarchical-data-database/2/)来存储/遍历这个列表，所以我拥有的是树的一个子集，包括所有子节点，按它们的“左”值排序。

例如，给定树：

*   项目 A
    *   A.1 项
    *   A.2 项
        *   项目 A.2.2
*   B项
    *   B.1 项
*   项目 C

我得到清单：

*   项目 A、项目 A.1、项目 A.2、项目 A.2.2、项目 B、项目 B.1、项目 C

（这是按照修改后的预购树设置中的“左”值的顺序）。

我想要做的是将其解析为包含树的实际结构的对象，例如：

```
Class TreeObject {
    String Name;
    Guid ID; 
    Guid ParentID;
    List<TreeObject> Children;
} 
```

平面列表作为 TreeObject 列表返回 - 每个 TreeObject 都有 ID、ParentID、Left 和 Right 属性。我正在寻找的是一个功能：

```
List<TreeObject> FlatToHeirarchy(List<TreeObject> list); 
```

它接受平面列表，并返回一个嵌套列表。

换句话说：

```
List<TreeObject> flatSet = LoadTreeObjectsFromDatabase(); 
// flatSet.count == 7; flatSet(0).Children == null
List<TreeObject> nestedSet = FlatToHeirarchy(flatSet);
// nestedSet.count == 3; nestedSet(0).Children.count == 2 
```

我不知道如何做到这一点 - 跟踪父母，并能够处理更大的跳跃（例如，项目 A.2.2 -> 项目 B）。

* * *

编辑：我在这里寻找一个非暴力解决方案（例如，不循环多次，将项目移动到子节点，直到只剩下顶级父母）。我猜有一种优雅的方法可以循环一次，然后根据需要放置项目。

请记住，它们总是按层次顺序排列（因为我使用的是 MPTT），因此给定的项目将始终是前一个项目的子项或兄弟姐妹，或者至少与前一个项目共享一个父项。它永远不会出现在树的其他地方。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-01-14T20:35:04.787

这是我最终编写的函数。我正在使用 MPTT 来存储对象，因此列表按“左”值的顺序排列，这基本上意味着父项始终位于列表中的任何给定项目之前。换句话说，item.ParentID 所引用的项目始终已经被添加（除了顶级或根节点的情况）。

```
public class TreeObject
{
    public int Id { get; set; }
    public int ParentId { get; set; }
    public string Name { get; set; }
    public IList<TreeObject> Children { get; set; } = new List<TreeObject>();
}

public IEnumerable<TreeObject> FlatToHierarchy(List<TreeObject> list)
{
    // hashtable lookup that allows us to grab references to containers based on id
    var lookup = new Dictionary<int, TreeObject>();
    // actual nested collection to return
    var nested = new List<TreeObject>();

    foreach (TreeObject item in list)
    {
        if (lookup.ContainsKey(item.ParentId))
        {
            // add to the parent's child list 
            lookup[item.ParentId].Children.Add(item);
        }
        else
        {
            // no parent added yet (or this is the first time)
            nested.Add(item);
        }
        lookup.Add(item.Id, item);
    }

    return nested;
} 
```

和一个简单的测试（在 LinqPad 中有效）：

```
void Main()
{
    var list = new List<TreeObject>() {
        new TreeObject() { Id = 1, ParentId = 0, Name = "A" },
        new TreeObject() { Id = 2, ParentId = 1, Name = "A.1" },
        new TreeObject() { Id = 3, ParentId = 1, Name = "A.2" },
        new TreeObject() { Id = 4, ParentId = 3, Name = "A.2.i" },
        new TreeObject() { Id = 5, ParentId = 3, Name = "A.2.ii" }
    };

    FlatToHierarchy(list).Dump();
} 
```

结果：

![在此处输入图像描述](https://i.stack.imgur.com/yFozd.png)

由于我在 5 年后更新这个，这里是一个递归 LINQ 版本：

```
public IList<TreeObject> FlatToHierarchy(IEnumerable<TreeObject> list, int parentId = 0) {
    return (from i in list 
            where i.ParentId == parentId 
            select new TreeObject {
                Id = i.Id, 
                ParentId = i.ParentId,
                Name = i.Name,
                Children = FlatToHierarchy(list, i.Id)
            }).ToList();
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-25T22:31:06.923

*我假设您已经知道所有项目的父项*。

您需要做的就是遍历列表的所有项目一次并将当前项目添加到其父级的子级列表中。仅将没有父项的项目保留在目标嵌套列表中。

这是一些伪代码：

```
foreach Item item in flatlist
   if item.Parent != null
      Add item to item.Parent.ChildrenList
      Remove item from flatlist
   end if
end for 
```

至于获取父母，从我在您的示例中可以看到，您可能需要在列表中前进时解析名称并构建堆栈。

这个问题**看起来**很难，但实际上并非如此。很多人从错误的角度看待这个问题；您不能尝试填充每个子列表，而是从平面列表中删除子项目，然后它变得容易。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2019-10-22T05:15:31.743

你应该使用像嵌套集这样的数据库存储架构

[ [https://en.wikipedia.org/wiki/Nested_set_model](https://en.wikipedia.org/wiki/Nested_set_model) ]

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-09-05T23:27:59.647

正常编译的替代版本，我不确定上面的代码是否有问题。

```
private List<Page> FlatToHierarchy(List<Page> list) {
      // hashtable lookup that allows us to grab references to the parent containers, based on id
        Dictionary<int, Page> lookup = new Dictionary<int, Page>();
      // actual nested collection to return
      List<Page> nested = new List<Page>();

      foreach(Page item in list) {
        if (lookup.ContainsKey(item.parentId)) {
          // add to the parent's child list 
          lookup[item.parentId].children.Add(item); //add item to parent's childs list
          lookup.Add(item.pageId, item); //add reference to page in lookup table
        } else {
          // no parent added yet (or this is the first time)
          nested.Add(item);     //add item directly to nested list                
          lookup.Add(item.pageId, item); //add reference to page in lookup table
        }
      }
    return nested;
    } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-25T23:19:26.483

这是一个例子，希望这有帮助

```
class Program
{
    static void Main(string[] args)
    {
        TreeObject a  = new TreeObject() { Name = "Item A" };
        a.Children.Add( new TreeObject() { Name = "Item A.1" });
        a.Children.Add( new TreeObject() { Name = "Item A.2" });

        TreeObject b = new TreeObject() { Name = "Item B" };
        b.Children.Add(new TreeObject() { Name = "Item B.1" });
        b.Children.Add(new TreeObject() { Name = "Item B.2" });

        TreeObject c = new TreeObject() { Name = "Item C" };

        List<TreeObject> nodes = new List<TreeObject>(new[] { a, b, c });

        string list = BuildList(nodes);
        Console.WriteLine(list); // Item A,Item A.1,Item A.2,Item B,Item B.1,Item B.2,Item C

        List<TreeObject> newlist = new List<TreeObject>();
        TreeObject temp = null;

        foreach (string s in list.Split(','))
        {
            if (temp == null || !s.Contains(temp.Name) || temp.Name.Length != s.Length)
            {
                temp = new TreeObject() { Name = s };
                newlist.Add(temp);
            }
            else
            {
                temp.Children.Add(new TreeObject() { Name = s });
            }                              
        }

        Console.WriteLine(BuildList(newlist)); // Item A,Item A.1,Item A.2,Item B,Item B.1,Item B.2,Item C
    }

    static string BuildList(List<TreeObject> nodes)
    {
        StringBuilder output = new StringBuilder();
        BuildList(output, nodes);
        return output.Remove(output.Length - 1, 1).ToString();
    }

    static void BuildList(StringBuilder output, List<TreeObject> nodes)
    {
        foreach (var node in nodes)
        {
            output.AppendFormat("{0},", node.Name);
            BuildList(output, node.Children);
        }
    }
}

public class TreeObject
{
    private List<TreeObject> _children = new List<TreeObject>();

    public string Name { get; set; }
    public Guid Id { get; set; }
    public List<TreeObject> Children { get { return _children; } }
} 
```

}

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-02-28T17:44:42.217

*更正gregmac*给出的例子

 *```
IList<TreeObject> FlatToHierarchy(IQueryable<lcc_classe> list, int? parentId)
    {
        var q = (from i in list
                where i.parent_id == parentId
                select new
                {
                    id = i.id,
                    parent_id = i.parent_id,
                    kks = i.kks,
                    nome = i.nome
                }).ToList();
        return q.Select(x => new TreeObject
            {
                children = FlatToHierarchy(list, x.id)
            }).ToList();
    } 
```

# xslt - 如何在不硬编码名称的情况下创建元素

> ID：319110
> 
> 赞同：2
> 
> 时间：2008-11-25T22:24:52.193
> 
> 标签：xslt

我试过了，但它似乎不是有效的语法。

```
<xsl:element name="$myElementName"></xsl:element> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-25T22:31:14.413

您可能需要将其括起来`{}`以确保对值进行评估而不是用作逐字字符串，例如

```
<xsl:element name="{$myElementName}"></xsl:element> 
```

# asp.net - 在 .Net http 处理程序中编码 au umlaut 时遇到问题

> ID：319113
> 
> 赞同：5
> 
> 时间：2008-11-25T22:26:30.803
> 
> 标签：asp.net, javascript, character-encoding, diacritics, encodeuricomponent

我有一个 JavaScript 请求到一个 ASP.Net (2.0) HTTP 处理程序，该处理程序将请求传递给一个 java web 服务。在此系统中，特殊字符（例如带有重音符号的字符）无法正确传递。

例如

*   人工输入：`Düsseldorf`
*   成为一个 JavaScript 异步请求`http://site/serviceproxy.ashx?q=D%FCsseldorf`，据我所知，它在 ISO-8859-1 和 UTF-8 中都有效。（除非它是 UTF-8 中的 %c3%bc ）
*   `HttpContext.Current.Request.QueryString.Get("q")`返回`D�sseldorf`这是麻烦开始的地方。
*   但`HttpUtility.UrlEncode(HttpContext.Current.Request.QueryString.Get("q"), Encoding.GetEncoding("ISO-8859-1"))`返回`D%3fsseldorf`（一个'？'）
*   并 `HttpUtility.UrlEncode(HttpContext.Current.Request.QueryString.Get("q"), Encoding.UTF8)`返回`D%ef%bfsseldorf`

所以它的值没有被正确解码或重新编码以传递给java服务。

*   通知`HttpContext.Current.Request.Url.Query`是`?q=D%FCsseldorf&output=json&from=1&to=10`
*   虽然`HttpContext.Current.Request.QueryString.ToString()`是`q=D%ufffdsseldorf&output=json&from=1&to=10`

为什么会这样，我怎样才能告诉它`HttpContext`尊重请求标头，其中包括：

```
Content-Type=application/x-www-form-urlencoded;+charset=UTF-8 
```

`QueryString`并使用 UTF-8 字符集解码 URL 。

附录：正如答案所指出的，问题不在于解码，而在于编码；using `escape()`in JavaScript 不会根据 UTF-8 转义，而 using`encodeURIComponent()`会。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-26T01:00:12.927

我不知道您的服务器（IIS？）使用的默认字符编码是什么，或者它是否可以更改，但我可以告诉您一些可能有帮助的事情。

0xFC 是 ü 的 ISO-8859-1 编码。虽然 Unicode 代码点是 U+00FC，但使用 UTF-8 编码时，这需要两个字节，变为 0xC3 0xBC。

如果 UTF-8 解码器看到非法字节序列 0xFC，它会将其解码为 Unicode“替换字符”U+FFFD，并在它看到另一个有效字节序列开始的地方拾取，在这种情况下是'。

你得到的原因`%3f`是'？是拉丁字符集的“替换字符”，类似于 Unicode 字符集中的 �。

我相信您看到的是使用 ISO-8859-1 进行客户端编码，但服务器使用 UTF-8 进行解码。一旦它到达服务器，您的数据就会损坏。我建议你修改客户端使用UTF-8编码；它应该要求`http://site/serviceproxy.ashx?q=D%C3%BCsseldorf`

听起来您是从 JavaScript 构建这些 URL，所以您应该使用`encodeURI`and`encodeURIComponent`函数，而不是`escape`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-21T19:59:39.160

当 URL 直接输入 IE8 时，我遇到了与 ASP.NET 通用处理程序相同的问题。字符作为 char 65533 发送，但我确实将 IE8 设置为

```
[x] 发送 UTF-8 URL。
```

在我的场景中，我在 Visual Studio 中调试 HTTP 处理程序，并将处理程序的地址直接输入到浏览器中：

```
http://localhost/myHandler.ashx?term=xxxxxx
```

然后单步执行代码。客户端将传递 UTF-8 编码的 URL，但是当开发机器上运行的 IE8 是客户端时，有没有办法调试代码？

# iphone - 如何访问视图的图层？

> ID：319120
> 
> 赞同：1
> 
> 时间：2008-11-25T22:29:12.373
> 
> 标签：iphone, cocoa-touch, core-animation

我想对 a 应用转换（旋转）`UIImageView`。我可以只设置`transform`视图的属性，但设置图层`transform`不会让它更快吗？如果是这样，我怎样才能做到这一点？

假设我已经`UIImageView`使用图像进行了初始化，有人可以帮忙吗？`UIVIew`里面有a不是更好`UIImageView`吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T22:39:43.287

如果您正在做一个简单的旋转，速度差异可能是微不足道的，但您可以通过执行以下操作来访问视图层：

`view.layer`

所以，你可以使用

`view.layer.affineTransform = newTranform;`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T04:01:39.487

您可以使用自动重复的 CAAnimation 进行持续旋转（我认为；我实际上并没有尝试过做这个确切的事情，但类似的事情）。

如果一个动画不做，肯定有两个（让一个旋转 180°，然后当它结束时，让另一个动画做第二个 180°。这可以在视图或其图层上完成。你会肯定想在设备上测试它的性能。

无需使用 NSTimer；这就是 CoreAnimation 的目的。

# c# - 如何在 C# 中禁用最小化按钮？

> ID：319124
> 
> 赞同：6
> 
> 时间：2008-11-25T22:30:05.273
> 
> 标签：c#, winforms, minimize

在我的应用程序中，我需要暂时灰显主窗体的最小化按钮。有什么想法可以实现吗？我不介意对 Win32 dll 执行 p/invokes。

编辑：将最小化按钮变灰是首选解决方案，但是还有其他方法可以防止表单最小化吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-26T09:28:58.093

我阅读了您对我的回复的评论，并能够为您提供更完整的解决方案。我跑得很快，它似乎有你想要的行为。不要从 Form 派生 winform，而是从此类派生：

```
 using System;
using System.Windows.Forms;
using System.ComponentModel;

namespace NoMinimizeTest
{
    public class MinimizeControlForm : Form
    {
        private const int WM_SYSCOMMAND = 0x0112;
        private const int SC_MINIMIZE = 0xf020;

        protected MinimizeControlForm()
        {
            AllowMinimize = true;
        }

        protected override void WndProc(ref Message m)
        {
            if (!AllowMinimize)
            {
                if (m.Msg == WM_SYSCOMMAND)
                {
                    if (m.WParam.ToInt32() == SC_MINIMIZE)
                    {
                        m.Result = IntPtr.Zero;
                        return;
                    }
                }
            }
            base.WndProc(ref m);
        }

        [Browsable(true)]
        [Category("Behavior")]
        [Description("Specifies whether to allow the window to minimize when the minimize button and command are enabled.")]
        [DefaultValue(true)]
        public bool AllowMinimize
        {
            get;
            set;
        }
    }
} 
```

如果您希望能够决定是否允许在发送点击时最小化，您可以做更多的事情，例如：

```
 using System;
using System.Windows.Forms;
using System.ComponentModel;

namespace NoMinimizeTest
{
    public class MinimizeControlForm : Form
    {
        private const int WM_SYSCOMMAND = 0x0112;
        private const int SC_MINIMIZE = 0xf020;

        protected MinimizeControlForm()
        {

        }

        protected override void WndProc(ref Message m)
        {
            if (m.Msg == WM_SYSCOMMAND)
            {
                if (m.WParam.ToInt32() == SC_MINIMIZE && !CheckMinimizingAllowed())
                {
                    m.Result = IntPtr.Zero;
                    return;
                }
            }
            base.WndProc(ref m);
        }

        private bool CheckMinimizingAllowed()
        {
            CancelEventArgs args = new CancelEventArgs(false);
            OnMinimizing(args);
            return !args.Cancel;
        }

        [Browsable(true)]
        [Category("Behavior")]
        [Description("Allows a listener to prevent a window from being minimized.")]
        public event CancelEventHandler Minimizing;

        protected virtual void OnMinimizing(CancelEventArgs e)
        {
            if (Minimizing != null)
                Minimizing(this, e);
        }
    }
} 
```

有关此窗口通知的详细信息，请参阅[有关它的 MSDN 文章](http://msdn.microsoft.com/en-us/library/ms646360(VS.85).aspx "WM_SYSCOMMAND 通知")。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-25T22:37:48.330

```
form.MinimizeBox = false; 
```

或者如果在表单范围内

```
MinimizeBox = false; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-25T22:38:35.130

只需做 MinimizeBox = false; 在您的表单代码中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-25T22:58:47.087

将此代码放入表单的 Resize 事件中：

```
if (this.WindowState == FormWindowState.Minimized)
{
    this.WindowState = FormWindowState.Normal;
} 
```

这将使您的表单无法最小化（免责声明：我不主张以这种方式改变窗口的标准行为）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-25T22:56:46.513

您还可以实现对 Minimize 事件的句柄以取消命令

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-25T23:02:45.957

不。不要乱弄我的窗户。它们是我的，不是你的。这是我的电脑，如果我想最小化，我应该可以。我想不出，也从未得到过这样做的充分理由。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-25T23:11:19.840

币币的答案是正确的。MinimizeBox 也可用作设计器属性窗口中的属性。

@Kevin：虽然我很欣赏这种情绪，但这并不总是一个有效的答案。如果应用程序通过创建 Form 的新实例然后在其上调用 .ShowDialog() 来显示模式对话框，则您不希望用户最小化该 Form，因为这样主 UI 线程上的所有输入都会被阻塞，直到满足 Form 的模态状态。用户可能会单击主窗体，然后从 Windows 中获得“叮叮叮”无响应的声音，并且不知道该怎么做。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-05-28T11:52:38.223

只需将表单的 MinimizeBox 属性设置为 false。这将禁用最小化按钮，但其他按钮将保持功能。

# python - 在python中可以异步写入文件吗？

> ID：319132
> 
> 赞同：23
> 
> 时间：2008-11-25T22:35:19.850
> 
> 标签：python, asynchronous, aio-write

有没有一种简单的方法在 Python 中异步写入文件？

我知道[Python 自带的文件 io](https://docs.python.org/2/tutorial/inputoutput.html#reading-and-writing-files)被阻塞了；在大多数情况下这很好。对于这种特殊情况，我需要写入根本不阻塞应用程序，或者至少尽可能少地阻塞。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-06-11T21:19:29.403

据我了解，异步 I/O 与非阻塞 I/O 并不完全相同。

在非阻塞 I/O 的情况下，一旦文件描述符设置为“非阻塞”，`read()`系统调用（例如）将返回`EWOULDBLOCK`（或`EAGAIN`）如果读取操作会阻塞调用进程以完成操作。提供了系统调用`select()`、`poll()`、`epoll()`等，以便进程可以要求操作系统在一个或多个文件描述符*可*用于执行某些 I/O 操作时得到通知。

异步 I/O 通过将 I/O 请求排队到文件描述符进行操作，独立于调用进程进行跟踪。对于支持异步 I/O 的文件描述符（通常是原始磁盘设备），进程可以调用`aio_read()`（例如）请求从文件描述符中读取多个字节。无论 I/O 是否完成，系统调用都会立即返回。一段时间后，该进程会轮询操作系统以确认 I/O 是否*完成*（即缓冲区已充满数据）。

仅执行非阻塞 I/O 的进程（单线程）将能够从一个已准备好 I/O 的文件描述符读取或写入，而另一个文件描述符尚未准备好。但是该进程仍必须同步发出系统调用以对所有准备好的文件描述符执行 I/O。而在异步 I/O 的情况下，该进程只是检查 I/O 的完成情况（缓冲区充满数据）。使用异步 I/O，操作系统可以自由地尽可能多地并行操作以服务于 I/O，如果它愿意的话。

有了这个，对于 Python 的 POSIX aio_read/write 等系统调用是否有任何包装器？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-25T22:46:15.037

Twisted[在文件描述符上有非阻塞写入](http://twistedmatrix.com/documents/8.1.0/api/twisted.internet.fdesc.html)。如果您正在编写异步代码，我希望您使用twisted，无论如何。:)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2018-05-24T13:59:37.843

您可以尝试使用`Thread`：

```
from threading import Thread

for file in list_file:
     tr = Thread(target=file.write, args=(data,))
     tr.start() 
```

这或多或少是一个伪代码，但我希望你能明白。请注意这里的线程是打开的。

根据我的经验，它运行良好，虽然解释器在主脚本完成（需要使用）时继续工作一段时间`join()`，所以速度增益比看起来大得多

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-06-16T20:45:00.537

我正在为 python 开发 aio.h bidings：[pyaio](https://github.com/felipecruz/pyaio)

它只在linux上运行..

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-11-06T21:15:45.897

Python 3 似乎有这样的功能。参见[PEP 3116](http://www.python.org/dev/peps/pep-3116/)。

# c++ - boost::any_cast - 仅在隐式转换不可用时抛出？

> ID：319154
> 
> 赞同：4
> 
> 时间：2008-11-25T22:42:32.080
> 
> 标签：c++, boost

我只想`boost::any_cast<T>`在类型`any`没有隐式转换为`T`. 无论隐式转换如何，如果`any`is not的类型，正常行为似乎是抛出异常。`T`

例子：

```
boost::any a = 1;
boost::any_cast<int>(a); // This succeeds, and rightfully so
boost::any_cast<long>(a); // I don't want this to throw
boost::any_cast<Widget>(a); // I want this to throw 
```

谁能告诉我是否有一种简单的方法来获得我想要的功能，或者更好地给我一个很好的理由来解释为什么现有的行为是这样的？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-25T22:59:56.773

好吧，你不能这样做。该`any`机制的工作原理如下：

```
struct base {
    virtual ~base() { }
};

template<typename T>
struct concrete_base : base {
    T t;
    concrete_base(T t):t(t) { }
};

struct my_any {
    base * b;

    template<typename T>
    my_any(T t):b(new concrete_base<T>(t)) { }

    template<typename T>
    T any_cast() { 
        concrete_base<T> * t = dynamic_cast< concrete_base<T>* >(b);
        if(!t) throw bad_any_cast();
        return t->t;
    }
}; 
```

我希望上面的内容很清楚。我认为你不可能做你正在寻找的东西。原因是没有关于保存的类型的信息在这里可以证明是有用的。RTTI 不提供。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2015-06-06T06:00:46.250

any_cast 不能这样做，但如果基本类型和派生类型是完整的（它们通常用于层次结构中的类型），您可以实现自己的系统，该系统通过 throw 和 catch 进行转换，因为抛出指向派生的指针type 可以被捕获为基指针类型。

# javascript - IE中的Script.aculo.us Sortable onUpdate问题

> ID：319155
> 
> 赞同：0
> 
> 时间：2008-11-25T22:42:34.827
> 
> 标签：javascript, ajax, prototypejs, scriptaculous

我正在开发一个使用 script.aculo.us 可排序对象的项目。

它在 Firefox 和 Chrome 中运行良好且快速，但在 IE 中，每当我删除一个元素时，它的速度非常慢。

我做了一些检查，结果发现在 IE 中，“onUpdate”回调函数在每次下降时都会被调用大约 8 次。通常，每个可分类容器（目的地和来源）应该只调用一次。

由于我的回调函数会调整一些元素的大小并在这些元素中绘制图形，因此每次调用所涉及的计算量相当可观。

有谁知道在 IE 中可能导致此问题的原因，或如何解决？

编辑：我注意到问题不在于它在拖动时触发了很多次，问题在于`onUpdate`当可排序的顺序发生变化时该函数被触发，即使拖动还没有结束。似乎它`onUpdate`实际上像`onChange`回调一样工作，但只有 IE。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T23:09:09.063

我不知道 script.aculo.us 但在调整事件大小时，IE 会连续触发事件，而不仅仅是在调整大小之后（就像大多数其他浏览器一样），因此我猜测 onUpdate 是基于其他东西在内部触发的多次触发（如调整大小）。

我用于类似问题的一个技巧是，当事件触发时，将“动作”设置为在超时（例如 1/4 秒）后发生......但是每个触发的新事件都会“清除”超时......所以所有你得到的是“最后一个”事件。

如果有人知道 script.aculo.us 实际触发的是什么，我也许可以提供更明确的细节。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T14:28:07.397

我认为您使用计时器的方式是错误的。您只希望计时器在超时后触发一次。如果在超时期间仍然发生某些事情，您需要重置计时器并重新开始，否则您只是在延迟您最初正在做的事情。

```
var timer1
Sortable.create("fList", {constraint:false,onChange:function(){triggerUpdate()}})

function triggerUpdate() {
    clearTimeout(timer1)
    window.setTimeout(function(){showList()},800)
}
function showList() {
    var now = new Date()
    alert(now)

} 
```

# xml - 使用 XML 和 XSLT 生成 SQL

> ID：319159
> 
> 赞同：2
> 
> 时间：2008-11-25T22:44:46.820
> 
> 标签：xml, xslt

我有一个 XML 定义，其中包含一个带有子元素的元素。例如：

```
<a>
 <b>
  <c>C</c>
  <d>D</d>
 </b>
</a> 
```

我有一个带有文本输出的 XSLT。例如：

```
<xsl...>
  <xsl:output method="text" indent="yes"/>
  <xsl:template match="/">
    <xsl:copy-of select="/a/b" />
  ... 
```

我想将整个 b 元素及其子元素复制到删除了空格的字符串中，以便生成 SQL 查询。例如：

```
select * from some-table where xml = '<b><c>C</c><d>D</d></b>' 
```

目前 copy-of 正在查找 b 元素，但丢弃所有元素和属性信息，只留下每个元素中的文本内容。我认为这可能与输出类型有关。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T22:50:55.887

你的 SQL 语句吓到我了。XML 区分大小写，如果输入 XML 和 XSLT（包括所有元素、属性和值）的大小写与原始数据库插入中使用的不完全相同，那么您的比较可能会失败。

我相信 Oracle（确定）和 SQL Server（认为是这样）都具有以更 XML 友好的方式（例如，使用 XPath）对包含 XML 的列进行查询的机制。

你到底想做什么？您的问题似乎比让这个 XSLT 正确转换更深层次。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T00:54:14.857

对于 XSLT 来说，这项任务可能有点太具有挑战性了。我能得到的最接近的是：

```
 <xsl:template match="b//*|node()">
    <xsl:copy>
      <xsl:text>&lt;</xsl:text>
      <xsl:value-of select="name()"/>
      <xsl:text>&gt;</xsl:text>
      <xsl:value-of select="text()"/>
      <xsl:apply-templates select="*"/>
      <xsl:text>&lt;/</xsl:text>
      <xsl:value-of select="name()"/>
      <xsl:text>&gt;</xsl:text>
    </xsl:copy>
  </xsl:template> 
```

并被调用：

```
 <xsl:apply-templates select="/a/b/self::*"/> 
```

这会产生以下结果：

```
 <b>
  <c>C</c>
  <d>D</d>
 </b> 
```

我的“解决方案”失败的地方是元素具有属性时。如果 b 有一个属性，则该属性值被写出。我找不到在遇到属性时写出属性的方法……

有任何想法吗？

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-26T11:17:47.377

这是如何完成的：

```
<xsl:output method="xml" />

<xsl:template match="/"><xsl:apply-templates select="/a/b" mode="normalize-space" /></xsl:template>

<xsl:template match="text()" mode="normalize-space"><xsl:value-of select="normalize-space(.)" /></xsl:template>
<xsl:template match="@*|node()" mode="normalize-space"><xsl:copy><xsl:apply-templates select="@*|node()" mode="normalize-space" /></xsl:copy></xsl:template> 
```

此方法复制节点、具有命名空间和属性的节点。

方法要求输出为“xml”（而不是原始示例中的“文本”）。它为所有 TEXT 节点使用自定义模板来规范它们内部的空间（删除前导/尾随空格，将多个空格压缩为一个空格）。然后，它使用简单的“身份”模板复制所有节点及其属性。两个模板都使用特殊模式来不干扰 XSL 的其余部分。

不幸的是，XSLT 处理器将 xsl:template 标记内的所有“未知”节点复制到输出文档中，而空格就是这样的节点之一。这就是为什么所有这些模板都需要写在一行中，没有多余的空格。

PS 虽然，我同意在 RDBMS 中搜索规范化的 XML 有点奇怪。

# c++ - ctags 最佳实践

> ID：319168
> 
> 赞同：5
> 
> 时间：2008-11-25T22:47:36.393
> 
> 标签：c++, vim, ctags, cscope

我正在 Solaris 上开发 +1M LOC C/C++ 项目（远程，通过 VNC 或 SSH）。我的本地机器上也有每日更新的源代码副本（Windows，仅用于浏览代码）。

我使用 VIM 和 ctags 组合（在 Solaris 和 Windows 上），但我对结果/速度不满意。您会推荐哪些 ctags 设置？有很多选项应该标记什么以及如何标记。我应该为每个项目、每个目录使用单个标记文件，还是只为所有内容使用一个标记文件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T22:58:43.047

对我来说，对所有事情都使用小于一个的东西并没有什么意义。能够快速浏览您的项目是标签的首要用途。例如，我们的代码分为 3 个主要部分，Include/、Processes/、Libraries/。如果不能在这些之间跳跃，我将非常没有生产力。

我个人使用 cscope（它的 C++ 解析不是很好，但还可以，而且它的 VIM 集成比 ctags 更好），但是当我使用 ctags 时，我通常只添加`--c++-kinds=+p`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T08:49:16.567

我使用etags：

```
find src1 src2 src3 | grep -v "\\.svn" | xargs etags --append 
```

在 emacs 中，将光标放在标识符上，然后按 M-。（[alt] + [period]，或 [esc] 后跟 [period]）。

就速度而言，我不知道它与您的设置相比如何，或者您是否愿意使用 emacs。我只是发布以防您想尝试一些替代方案。

# c++ - 您应该为 Windows API 调用 VerQueryValue 提供哪些参数

> ID：319171
> 
> 赞同：3
> 
> 时间：2008-11-25T22:48:57.950
> 
> 标签：c++, windows, winapi

我知道第一个参数必须是 GetFileVersionInfo() 的结果。

第三个和第四个是目标缓冲区和大小

第二个参数 lpSubBlock 是什么？

提前致谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-28T01:13:28.483

当您通过资源编辑器查看版本信息时，您可能会注意到有一个包含 FILEVERSION、PRODUCTVERISON 等的初始部分，然后是一个或多个包含特定语言设置的块。

```
VS_VERSION_INFO VERSIONINFO
 FILEVERSION 5,0,0,0
 PRODUCTVERSION 5,0,0,0
 FILEFLAGSMASK 0x3fL
#ifdef _DEBUG
 FILEFLAGS 0x1L
#else
 FILEFLAGS 0x0L
#endif
 FILEOS 0x40004L
 FILETYPE 0x2L
 FILESUBTYPE 0x0L
BEGIN
    BLOCK "StringFileInfo"
    BEGIN
        BLOCK "040904b0"
        BEGIN
            VALUE "CompanyName", ""
            VALUE "FileVersion", "5, 0, 0, 0"
            VALUE "ProductName", ""
            VALUE "ProductVersion", "5, 0, 0, 0"
        END
        BLOCK "000004b0"
        BEGIN
            VALUE "CompanyName", ""
            VALUE "FileVersion", "5, 0, 0, 0"
            VALUE "ProductName", ""
            VALUE "ProductVersion", "5, 0, 0, 0"
        END
    END
    BLOCK "VarFileInfo"
    BEGIN
        VALUE "Translation", 0x0, 1200, 0x409, 1200
    END
END 
```

要获得具有非语言特定详细信息的 VS_FIXEDFILEINFO，请使用

```
VS_FIXEDFILEINFO *versionInfo;
PUINT versionInfoSize;
VerQueryValue(buffer.get(), TEXT("\\"), (void**) &versionInfo, &versionInfoSize)) 
```

要找出支持的语言，请使用

```
Var *translationsInfo;
PUINT transaltionInfoSize;
VerQueryValue(buffer.get(), TEXT("\\VarFileInfo\\Translation"), (void**) &translationsInfo, &transaltionInfoSize)) 
```

要获取特定于语言的版本详细信息，请使用

```
StringTable *stringTable;
PUINT stringTableSize;
std::wstring path( L"\\StringFileInfo\\" );
path += L"040904b0";  // get this value from the language support list
path += L"\\FileVersion";
VerQueryValue(buffer.get(), path.c_str(), (void**) &stringTable, &stringTableSize)) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-25T23:16:37.317

它必须是一个字符串，您可以在此处找到其格式：
[http ://www.hep.wisc.edu/~pinghc/books/apirefeng/v/verqueryvalue.html](http://www.hep.wisc.edu/~pinghc/books/apirefeng/v/verqueryvalue.html)

还有另一个用法示例（在VB中，易于阅读）：http:
[//support.microsoft.com/kb/160042](http://support.microsoft.com/kb/160042)

您还可以查看整个 CodeProject 文章以获取 C++ 中的工作示例：http:
[//www.codeproject.com/KB/cpp/GetLocalVersionInfos.aspx](http://www.codeproject.com/KB/cpp/GetLocalVersionInfos.aspx)

另一篇关于检索版本信息主题的文章：http:
[//www.microsoft.com/msj/0498/c0498.aspx](http://www.microsoft.com/msj/0498/c0498.aspx)

# c# - 查找集合的 NHibernate 映射（如果有任何意义）

> ID：319178
> 
> 赞同：5
> 
> 时间：2008-11-25T22:51:16.867
> 
> 标签：c#, nhibernate

我不知道如何问这个问题，因为我不知道我不知道什么，因此我不知道我试图得到答案的正确术语。我将解释我的情况，希望它会有所帮助：

我有三个表，一个 Book 表、一个 Tag 表和一个 BookTag 查找表。

每本书都有一个 ID、一个标题（对于初学者） 每个标签都有一个 ID 和一个标题 每个 BookTag 都有一个 ID、一个 BookID 和一个 TagID。

一本书可以有多个标签，一个标签可以用在多个 BookID 上。

我以这种方式设置了我的对象：

```
Book.cs
int BookID
string Title
List<BookTag> Tags

Tag.cs
int TagID
string Title

BookTag.cs
int ID
int BookID
int TagID 
```

我希望 Books.cs 类有一个标签集合，而不是 BookTags，但我似乎无法在 NHibernate 中获得正确的映射。这就是我为 Book.hbm.xml 文件所拥有的：

```
<?xml version="1.0" encoding="utf-8" ?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2" assembly="DomainModel" namespace="DomainModel.Books">
  <class name="DomainModel.Books.Book" table="Books">
    <id name="BookID" type="Int32" unsaved-value="0">
      <generator class="native"/>
    </id>
    <property name="Title" type="String" not-null="true"/>
    <set lazy="true" name="Tags" table="BookTags" generic="true" inverse="true" cascade="delete">
      <key column="BookID"/>
      <one-to-many class="DomainModel.Books.BookTag, DomainModel"/>
    </set>
  </class>
</hibernate-mapping> 
```

这是我的 BookTag.hbm.xml：

```
<?xml version="1.0" encoding="utf-8" ?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2" assembly="DomainModel" namespace="DomainModel.Books">
  <class name="DomainModel.Books.BookTag" table="BookTags">
    <id column="BookTagID" name="BookTagID" type="Int32" unsaved-value="0">
      <generator class="native"/>
    </id>
    <many-to-one name="Tag">
      <column not-null="true" name="TagID"/>
    </many-to-one>
    <many-to-one name="Book">
      <column not-null="true" name="BookID"/>
    </many-to-one>
  </class>
</hibernate-mapping> 
```

在这个模型下，我可以使用我的对象模型获得我想要的标签：Book.Tags[0].Tag，但这似乎效率低下。我可以使用 NHibernate 将 BookTags.TagID 与数据库中的 Tags.TagID 映射出来，以便我可以让 Book.Tags[0] 返回一个 Tag 对象，而不是 BookTags 对象吗？我不知道将 Books 与标签相关联的更好方法，以便在 Book1 上使用的标签可以在 Book2 上使用，而无需向标签表添加新条目。

我希望这至少有一些意义。如果您需要进一步说明，请告诉我。如果我在有人回答之前弄清楚，我会在这里发布我的解决方案。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-25T23:19:06.780

您根本不需要 BookTag 类。您可以将 Book.Tags 集合映射为多对多。为此，您将在地图中指定 BookTag 以连接关联。请参阅[第](http://www.hibernate.org/hib_docs/nhibernate/html/collections.html#collections-ofvalues)6.8 节双向关联。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T01:45:23.367

谢谢蒂姆，这正是我所需要的。对于那些好奇的人，我“取消映射”了 BookTag 表/对象，现在只有一个 Book 对象和一个 Tag 对象被使用并映射到 NHibernate。

我的 Book.hbm.xml 已更新为：

```
<?xml version="1.0" encoding="utf-8" ?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2" assembly="DomainModel" namespace="DomainModel.Books">
  <class name="DomainModel.Books.Book" table="Books">
    <id name="BookID" type="Int32" unsaved-value="0">
      <generator class="native"/>
    </id>
    <property name="Title" type="String" not-null="true"/>
    <bag name="Tags" table="BookTag" generic="true">
      <key column="BookID" on-delete="noaction"></key>
      <many-to-many class="Tag" column="TagID"></many-to-many>
    </bag>
  </class>
</hibernate-mapping> 
```

# reporting-services - 有没有办法在运行时更改sql报告图表类型和子类型？

> ID：319185
> 
> 赞同：4
> 
> 时间：2008-11-25T22:56:36.890
> 
> 标签：reporting-services, charts

有没有办法在运行时更改 SQL 报告“图表类型”和“子类型”？

我正在使用 .rdlc 报告，但似乎无法找出在运行时更改它的方法。我在这两个领域都没有“表达”能力。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T02:24:15.310

您的 .rdlc 文件是定义报告的所有内容的地方，包括报告类型。因此，如果我想更改报告的某些内容，我只需使用我最喜欢的 xml 编辑方法（XmlDocument、XPath 等）修改 rdlc 文件。您只需即时修改您的 RDLC 文件以更改报告类型，然后显示或保存，等等。

例如，我这样做是为了允许用户设置自己的报告颜色，因为这些颜色也在 rdlc 中定义。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T14:46:20.917

看起来可能要到 2008 年才能实现： [Microsoft Link](https://forums.microsoft.com/msdn/ShowPost.aspx?PostID=2439556&SiteID=1&pageid=0)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T14:43:00.193

我正在尝试做同样的事情。我有一组显示的度量，然后下面的图表一次只显示一个度量，具体取决于用户输入（他们希望以图表形式查看哪些度量）。但是，某些度量作为列而不是行更好，所以我想在渲染时更改图表类型。

我最初的想法是重叠两个图表，并根据用户下拉输入将它们的可见性设置为彼此相反。似乎有一种更简单的方法（如果这个想法一开始就可行？）

谢谢。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-05T07:08:36.117

一种可能的解决方案是生成您想要的两个图表，然后根据您的要求隐藏其中一个。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-27T00:42:26.067

我正在使用 2008，据我所知，它还没有解决。图表类型有很多选项，子类型的选项更多，我不想渲染它们，然后显示或隐藏正确的选项。

我想知道是否有一种方法可以解析 .rdlc 的 XML 并将其反馈给报表查看器，而无需让每个用户都获得自己的实际 .rdlc 文件的新修改版本。

附带说明一下，MS 刚刚发布了一个新的图表包（来自收购 Dundas）。也许我会放弃报告的想法并使用 mschart 服务器控件。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-02-15T21:46:34.437

考虑多重价值和可见性。如果所有其他变量都是恒定的（即类别、系列等），只需为每个所需图表类型添加一个值，并使用一个参数来控制值的可见性。优雅而简单。

# php - 在 PHP 中调整图像大小的一个很好的服务器规范

> ID：319187
> 
> 赞同：0
> 
> 时间：2008-11-25T22:56:47.013
> 
> 标签：php, image-processing, hosting

我有一个网站，用户可以上传图片，然后将这些图片重新调整为 4 种不同的尺寸。

我要搬到一个新的主机上，我想知道什么是处理这个任务的好规范——或者任何服务器规范都应该能够处理这个任务。我应该看更多的 RAM 还是更好的 CPU 等...

图片目前限制为 2mb，但我想增加它。

在这些（对于这个任务）之间有什么可以选择的吗？

选项 1\. * 处理器：Pentium 4 3GHZ 超线程 * 内存：2GB DDR SDRAM * Hd1：120GB 7200RPM SATA / 8MB 缓存 * Hd2：120GB 7200RPM SATA / 8MB 缓存 * 操作系统：Linux - CentOS 5（+32 位）

选项 2。 * 处理器：双核 Intel Core 2 Duo 2.2GHz * 内存：1GB RAM * 硬盘：1x 160GB 7,200rpm * 操作系统：Linux - CentOS 5.2

**编辑：**

*   我在 GD2中使用[http://pear.php.net/package/Image_Transform](http://pear.php.net/package/Image_Transform)
*   音量非常低，但某些 JPG 文件即使小于 2mb 也会失败
*   当前主机是具有 768mb 专用内存的 VPS（了解有关处理器的信息）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-25T23:14:19.193

你没有说每个时间段你做了多少，你正在使用什么（GD？ImageMagick？别的东西）或者你当前服务器的规格和性能。

但是，除非您做很多事情，否则这两个服务器都应该很好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-28T07:52:47.727

绝对坚持使用 VPS（相对于共享主机），因为在 PHP 中处理图像就是调整 php.ini 文件。

PHP 脚本无法处理上传的原因有很多：

1.  上传太大。上传大小由几个指令控制：post_max_size、upload_max_filesize、memory_limit。如果上述*所有*指令均未正确配置，则默认值将限制在 2MB 左右。
2.  使用图像时内存不足。memory_limit 指令会影响这一点。还要确保您的代码尽快释放资源，而不是等待脚本终止。
3.  操作时间过长。max_input_time 和 max_execution_time 控制脚本执行多长时间（max_input_time 控制 HTTP I/O，max_execution_time 控制实际脚本执行）。更大的图像需要更长的时间来处理。

找出哪些条件失败，然后扩展您的服务器以解决这些条件。如果您基于性能问题切换主机，您可能需要先执行此操作。您可能会发现不需要该开关。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T23:56:55.877

如果你只是在做开发/测试，也许只是一个软启动——如果没问题的话。如果您希望上线，您将需要密切关注您的服务器负载和您正在生成的进程数量，以及您实际调整图像大小的时间有多长。

如果您希望在不久的将来处理大量的问题，那么您肯定会想要双核系统。调整图像大小非常密集。再往前走，您可能需要额外的机器来处理图像处理和处理站点。

# jsp - Struts logic:equal 标记的名称属性中是否允许有空格？

> ID：319188
> 
> 赞同：0
> 
> 时间：2008-11-25T22:57:09.523
> 
> 标签：jsp, struts

我在我维护的遗留应用程序的 JSP 文件中遇到了以下标记：

```
<logic:equal name="welcome memberInfoView" property="hasFoo" value="false"> 
```

那个名字属性对我来说看起来很不对劲。根据我在 Struts 文档中阅读的内容，该空间是不允许的。

这合法吗？如果是这样，它会做什么？如果不是，其意图可能是什么？

编辑：经过更多搜索，我发现“welcome memberInfoView”确实被故意用作属性名称（带有空格）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-25T23:33:08.203

实际上，这个名字是合法的，但非常规。虽然在语法上是合法的，但它确实可能是一个错误。

“名称”指定某个范围内的属性名称（由可选的“范围”属性确定，默认为“任何”），而不是脚本变量名称。由于它实际上是映射中的键，因此它可以是任何字符串。

此标记将在页面上下文中开始并查找名为“welcome memberInfoView”的属性。它将继续封闭范围，直到找到命名对象。然后它将查看该对象的“hasFoo”属性。如果为“false”，则将调用封闭的片段。

另一件看起来不对的事情是属性“hasFoo”。通常，该属性只是“foo”，并且对象应该有一个名为`isFoo()`or的访问器`getFoo()`。也许逻辑标签在这方面是宽松的，并且会成功调用该`hasFoo()`方法。

您可以为此用法创建一个简单的测试，并确保它按您的预期工作。

# math - 基于四元数的 3D 相机应该累积四元数还是欧拉角？

> ID：319189
> 
> 赞同：16
> 
> 时间：2008-11-25T22:57:09.710
> 
> 标签：math, 3d, quaternions, euler-angles

所以我编写了一个面向新程序员的基于四元数的 3D 相机，因此他们非常容易集成和开始使用。

在我开发它时，起初我会将用户输入作为欧拉角，然后根据该帧的输入生成一个四元数。然后，我将获取相机的四元数并将其乘以我们为输入生成的四元数，理论上这应该只是将输入旋转添加到相机旋转的当前状态，然后一切都会变得又胖又快乐。让我们称之为：累积四元数，因为我们只存储和添加四元数。

但我注意到这种方法存在问题。我使用它的次数越多，即使我只在一个欧拉角上旋转，比如 Yaw，它也会在一些迭代中开始流血到另一个，比如 Pitch。这是轻微的，但相当不可接受。

所以我做了更多的研究，发现一篇文章说累积欧拉角更好，所以相机将它的当前旋转存储为欧拉角，并且输入只是在每一帧添加到它们。然后我每帧从它们生成一个四元数，然后用来生成我的旋转矩阵。这解决了旋转渗入不当轴的问题。

那么有任何 Stackoverflow 成员对这个问题有任何见解吗？这是一种正确的做事方式吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-25T23:26:57.403

乘以四元数将遭受浮点舍入问题的累积（即使是像 45 度这样的简单角度也不准确）。这是一种复合旋转的好方法，但是每个四元数组件的精度都会随着时间的推移而下降。渗透是一个副作用，视觉上更糟糕的是你的四元数可以开始合并一个比例因子 - 为了恢复它，你必须在任何情况下重新归一化回欧拉角。定点欧拉角不会累积舍入。

每帧重新计算四元数是最少的。我不会费心去优化它。在重新归一化以恢复准确性之前，您可能允许积累一些四元数，但这确实不值得付出努力。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-26T00:11:31.620

积累是一个不精确的过程。无论您使用四元数还是矩阵，累积大量增量旋转都会累积舍入误差。

我想象这样的事情：你的代码启动并运行，但注意到在一定量的导航之后，你的相机令人讨厌地倾斜——违反了你事先没有想到的不变量。实际上，您已经意识到您*不想*累积轮换；相反，您想做其他事情。

您可以将其视为界面设计问题，而不是数值准确性问题。基本上，人们期望相机根据俯仰、偏航和滚动进行导航，因此选择直接控制和表示角度可以避免很多问题。

令人遗憾的是，四元数似乎变得多余（至少对于这种特殊用法）。不过，您仍然需要四元数 - 用原始俯仰/偏航/滚动角度进行插值可能很难看。同样，这是一个界面设计问题：你需要弄清楚你需要四元数的地方，以及如何让它们进出……

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-25T23:19:21.617

我见过两者都在争论。我认为您必须处理的真正问题是相机系统的灵活性。IMO 偏航通常在第三人称视角中更有趣（因为您将围绕角色的垂直轴旋转）。虽然您也可以在第一人称视角中围绕垂直方向“偏航”，但我不确定这是否真的是一回事。

但是，我确实认为重新计算每帧的四元数有点浪费。如果您的框架接收到输入，存储最新的四元数并将它们标记为脏可能会更好？

# javascript - 让虚拟地球信息框出现在点击而不是悬停？

> ID：319197
> 
> 赞同：7
> 
> 时间：2008-11-25T23:00:22.153
> 
> 标签：javascript, virtual-earth

是否可以让虚拟地球图钉信息框显示响应 onclick 而不是鼠标悬停？

目前我正在使用这样的东西：

...

```
 var pin = new VEShape(
                  VEShapeType.Pushpin,
                  [location]
                );
  pin.SetCustomIcon(icon_url);
  pin.SetTitle(title);
  pin.SetDescription(info_window_template);
  map.AddShape(pin);

  document.getElementById(pin.GetPrimitive().iid).onmouseover = EventHandlerOnMouseOver;
}

var EventHandlerOnMouseOver = function(e) {
    // Handle content loading...
} 
```

...

但是，如果我尝试将 onmouseover 更改为 onclick，VE 会选择 onclick 并完全禁用信息框。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T16:30:32.503

您可以通过使用事件来完成描述...请注意，我使用的是 Virtual Earth 6.2。

诀窍是抑制 onmouseover 事件和订阅 onclick 事件。当您确定用户是否单击了某个形状时，您可以调用地图控件上的 ShowInfoBox 方法来强制它显示信息框。

这是codez =)

```
// Begin by supressing the onmouseover event. Returning true 
// from an event handler disables the default Virtual Earth action
map.AttachEvent('onmouseover', function(e) { if(e.elementID) return true; });

// Subscribe to the onclick event and react whenever we get an element id
map.AttachEvent("onclick", function(e) {

    // elementID is null when someone clicks on the map and not on a shape
    if(e.elementID) {

        var shape = map.GetShapeByID(e.elementID); 
        if(shape) map.ShowInfoBox(shape);
    } 
}); 
```

请注意，即使您右键单击形状，信息框也会显示；为避免这种情况，您将查看[事件对象](http://msdn.microsoft.com/en-us/library/bb429584.aspx)的 leftMouseButton 或 rightMouseButton 属性。

参考：

*   [VEMap.onclick 事件](http://msdn.microsoft.com/en-us/library/bb412560.aspx)
*   [VEMap.onmouseover 事件](http://msdn.microsoft.com/en-us/library/bb429627.aspx)

# java - 为什么 Java 能够将 0xff000000 存储为 int？

> ID：319199
> 
> 赞同：11
> 
> 时间：2008-11-25T23:00:46.723
> 
> 标签：java, hex, int

Java 中整数的最大值是 2147483647，因为 Java 整数是有符号的，对吧？

0xff000000 的数值为 4278190080。

然而我看到这样的Java代码：

```
int ALPHA_MASK = 0xff000000; 
```

任何人都可以启发我吗？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-11-25T23:42:21.930

只是对埃里克森的回答的补充：

正如他所说，有符号整数在大多数计算机体系结构上存储为它们各自正值的补码。

也就是说，整个 2^32 个可能的值被分成两组：一组用于以 0 位开头的正值，一组用于以 1 开头的负值。

现在，假设我们仅限于 3 位数字。让我们以一种有趣的方式来排列它们，这将在一秒钟内变得有意义：

```
 000
  111   001 
110       010
  101   011  
     100 
```

您会看到左侧的所有数字都以 1 位开头，而右侧的所有数字都以 0 开头。根据我们之前将前者声明为负数而将后者声明为正数的决定，我们看到 001 , 010 和 011 是唯一可能的正数，而 111、110 和 101 是它们各自的负数。

现在我们如何处理分别位于顶部和底部的两个数字？000 显然应该为零，而 100 将是所有没有正数的负数中最小的负数。总结一下：

```
 000      (0)
  111   001   (-1 / 1)
110       010 (-2 / 2)
  101   011   (-3 / 3)
     100      (-4) 
```

您可能会注意到，您可以通过否定 1 (001) 并向其添加 1 (001) 来获得 -1 (111) 的位模式：001 (= 1) -> 110 + 001 -> 111 (= -1)

回到你的问题：

0xff000000 = 1111 1111 0000 0000 0000 0000 0000 0000

我们不必在它前面添加更多的零，因为我们已经达到了 32 位的最大值。此外，它显然是一个负数（因为它以 1 位开头），所以我们现在要计算它的绝对值/正对应物：

这意味着，我们将取两者的补码

```
1111 1111 0000 0000 0000 0000 0000 0000 
```

这是

```
0000 0000 1111 1111 1111 1111 1111 1111 
```

然后我们添加

```
0000 0000 0000 0000 0000 0000 0000 0001 
```

并获得

```
0000 0001 0000 0000 0000 0000 0000 0000 = 16777216 
```

因此，0xff000000 = -16777216。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2008-11-25T23:03:11.320

高位是符号位。设置它表示一个负数：-16777216。

[与大多数语言一样，Java 以2 的补码](http://en.wikipedia.org/wiki/Two%27s_complement)形式存储带符号的数字。在这种情况下，从 0x7F000000 或 2130706432 中减去 2 ^(31或 2147483648 得到 -16777216。)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-26T00:02:46.193

可能值得指出的一点 - 这段代码不打算用作带有数值的整数；目的是作为位掩码从 32 位颜色值中过滤掉 Alpha 通道。这个变量真的不应该被认为是一个数字，只是一个高 8 位打开的二进制掩码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-25T23:02:01.433

额外的位用于标志

Java 整数是[二进制补码](http://en.wikipedia.org/wiki/Two's_complement)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-25T23:06:10.660

整数是用 Java 签名的。

# sql - 从字符串列表构建查询

> ID：319204
> 
> 赞同：0
> 
> 时间：2008-11-25T23:02:19.013
> 
> 标签：sql, string-building

您将如何获取任意字符串列表（形式为“%[text]%”）和数据库列，并将它们转换为对列表中的每个字符串进行 LIKE 比较的 SQL 查询？

一个例子：我的列表中有三个字符串，“%bc%”、“%def%”和“%ab%”。这将构建查询：

```
([ColumnName] LIKE "%bc" AND [ColumnName] LIKE "%def%") AND [ColumnName] LIKE "%ab%" 
```

AC# 示例非常好，但您可以随意用您选择的语言编写它。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-25T23:30:47.023

直接回答你的问题，

```
string.join(" and ", 
    (new[] { "%bc%", "%def%", "%ab%" })
    .Select(x => string.Format("[{0}] LIKE '{1}'",columnName, x))
    .ToArray()); 
```

要解决您的问题，您应该使用 Sql Server 全文搜索工具。查询将是：

```
select * from table
where FREETEXT("bc def ab") 
```

使用正确的索引，这应该优于 LIKE 列表

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-25T23:20:53.033

这只是地图上的字符串连接：

```
>>> los=['ab', 'cd', 'ef']
>>> ' and '.join(("somecolumn like '%%%s%%'" % s) for s in los)
"somecolumn like '%ab%' and somecolumn like '%cd%' and somecolumn like '%ef%'" 
```

或者

```
>>> ' and '.join(("somecolumn like '%" + s + "%'") for s in los)
"somecolumn like '%ab%' and somecolumn like '%cd%' and somecolumn like '%ef%'" 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T23:23:51.513

我会使用 StringBuilder 和 for 循环。假设您的列表称为“列表”并且是列表：

```
 StringBuilder sql = new StringBuilder();
if (list.Count > 0)
    sql.AppendFormat(CultureInfo.InvariantCulture, "([{0}] LIKE \"{1}\"", columnName, list[0]);

for (int i = 1; i < list.Count; i++)
{
    sql.AppendFormat(CultureInfo.InvariantCulture, " AND [{0}] LIKE \"{1}\"", columnName, list[i]);
}

if (list.Count > 0)
    sql.Append(")"); 
```

# c# - 你如何使用 LINQ 和 Sqlite

> ID：319210
> 
> 赞同：31
> 
> 时间：2008-11-25T23:06:45.730
> 
> 标签：c#, .net, linq, sqlite

有人会解释如何让 LINQ 与 Sqlite 一起工作。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-19T21:36:45.897

[在这里，您有一个用于 SQLite 的 SQL Linq 提供程序，以及其他一些数据库](http://code.google.com/p/dblinq2007/)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2010-01-12T23:36:16.113

Joe Albahari's LINQPad now supports Sqlite: [http://www.linqpad.net/Beta.aspx](http://www.linqpad.net/Beta.aspx). The one LINQ tool to rule them all.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-17T04:03:59.337

CMS 提供的链接不再起作用。我已经使用了这个[，](http://sqlite.phxsoftware.com/)因为它现在似乎已经融入了他们的 SQL lite ADO .NET 提供程序。

不幸的是，他们仍然不支持 VS 的设计器模式来创建类:(

另请注意，SQL Server compact 不支持 LINQ 类的设计模式！但是，如果您想使用实体框架，设计器确实适用于 SQL lite 和 SQL Server compact :)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-26T00:41:54.057

我想补充一点，您可以通过 SqlLite 使用 Linq to Sql，但有几个规定：

1.  您不能使用 Linq to Sql 设计器，这意味着您必须手动滚动您的课程。
2.  您必须小心不要执行某些操作，这将导致 SqlLite 不支持的 Sql 代码。

例如，您不能在任何 Linq 查询中使用 FirstOrDefault()，因为它会导致如下结果：

```
select top 1 * from table where ... 
```

由于 SqlLite 不支持“top 1”语法，您将遇到运行时 Sql 错误。

除此之外，我一直在将 Linq to Sql 与 SqlLite 一起使用，并在基本 CRUD 操作方面取得了巨大成功。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-25T23:12:15.313

是的，CMS 提到了一个[SqlLite Linq 提供程序](http://kkubasik.wordpress.com/2007/10/25/sqllite-linq-provider/)

查看 SQL server compact，它适用于 Linq

[SO上有另一个线程，您应该检查一下](https://stackoverflow.com/questions/250071/linq-with-sqlite-linqtosql)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-06-25T16:25:02.437

你可以使用这个：[http](http://code.google.com/p/dblinq2007) ://code.google.com/p/dblinq2007 。虽然看起来该项目仍处于 Alpha 阶段，但 IMO 现在实际上非常稳定。当然，如果您有一个庞大的项目，最好考虑使用其他东西，例如 MySQL 或 SQL Compact。我不喜欢 SQL Server，因为它太臃肿了，而且没有提供比 SQL Compact 或 MySQL 更多的功能

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-25T23:09:23.727

检查此提供程序：

[SqlLite Linq 提供程序](http://kkubasik.wordpress.com/2007/10/25/sqllite-linq-provider/)

您也可以考虑使用具有非常好的 LINQ-to-SQL 支持的[SQL Compact 。](http://www.microsoft.com/Sqlserver/2005/en/us/compact.aspx)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-11-04T17:52:31.180

在这个时候，**没有好的工具**可以做到这一点！

SQLite 的 LINQ 提供程序都处于 alpha 阶段（例如：[dblinq2007](http://code.google.com/p/dblinq2007/)）。而且将其用于商业目的是非常大的风险！所以也许在未来...

如果你想不使用 ADO.NET，有一个很好的 ove: [phxsoftware](http://sqlite.phxsoftware.com/)。

# seo - 站点地图和 SEO 的良好 URL 策略

> ID：319223
> 
> 赞同：4
> 
> 时间：2008-11-25T23:10:38.747
> 
> 标签：seo, sitemap, friendly-url

我经营一个网站，用户拥有自己的个人资料页面。他们还可以发布待售产品（他们制作的）并撰写/导入博客文章。我将要实施站点地图，我需要对 URL 策略做出最终决定。

这是我目前拥有的产品（其中 1234 是我用来查找该产品的产品 ID）： 注意“产品”是一个固定字符串（尽管它是实际站点中的另一个词） - 所有其他都是动态的，具体取决于项目.

*   example.com/product/1234.product-category.product-name

我应该更改为其中任何一个吗？IE：

*   example.com/maker/users_name/product-category/product-name/1234
*   example.com/product/product-category/product-name/1234
*   example.com/product/1234/product-category/product-name

主要考虑的项目是：

1.  产品 ID 应该放在 URL 的什么位置？无论是在用户的可读性方面，还是在 SEO 方面
2.  我是否应该包含用户的姓名（因为他/她制作了该产品）？
3.  我应该尝试完全删除 ID 吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-25T23:25:14.087

我认为第一个示例（example.com/product/1234.product-category.product-name）是最好的格式，但我会考虑更改“。” 至 ”-”。我只是在想，如果某个产品名称以某种方式结尾，它会触发服务器上的不同处理程序，例如“.php”或“.jsp”，那么您可能会产生一些不良影响。

> 产品 ID 应该放在 URL 的什么位置？无论是在用户的可读性方面，还是在 SEO 方面

我真的认为产品 ID 放在哪里并不重要，但就阅读它的用户而言，我认为他们会注意行尾，所以我会将 ID 放在最前面，留下最具描述性的部分（产品名称）在最后。

> 我是否应该包含用户的姓名（因为他/她制作了该产品）？

不确定您是否允许您的用户更改用户名，但如果您这样做了，我会留下用户名。一个例子是某人结婚并改变了他们的姓氏。这会损害您的 SEO，因为 URL 会发生变化，但搜索引擎会以旧方式对其进行索引。您必须放置一些永久重定向来处理此问题，只需将用户名排除在外即可避免这种情况。

> 我应该尝试完全删除 ID 吗？

如果两个产品具有相同的名称并且生成 URL 的算法会创建重复链接，则应将 ID 保留在 URL 中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2017-11-24T16:54:38.313

我更喜欢这个：example.com/users_name/product-category/product-name/1234

但是，应该知道 URL 有时会变得太长。在博客或论坛中很难代表或推广。为什么不简单地使用 example.com/1234 并使用 Title 来放置其他详细信息，例如类别和产品名称？

现在，我认为搜索引擎变得越来越智能，越来越多地使用短网址。

# ajax - 级联到自动完成文本框

> ID：319230
> 
> 赞同：0
> 
> 时间：2008-11-25T23:13:25.637
> 
> 标签：ajax, ajaxcontroltoolkit

我有一个网页，用户将在其中输入他们的地址。他们将在级联下拉列表中选择他们的国家和地区。我想为他们的城市提供一个自动完成的文本框，但我想对国家和地区的选择保持上下文敏感。我会使用另一个级联下拉列表，但是城市的数量超过了列表项的最大数量。

有什么建议或很酷的代码可以帮助我吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-25T23:34:14.037

我刚刚发现以下[博客](http://blogs.technet.com/kirtid/archive/2007/05/17/cascading-autocomplete.aspx)文章看起来至少接近你想要的。

他们使用以下 javascript 函数对其进行管理：

```
 function initCascadingAutoComplete() {
        var moviesAutoComplete = $find('autoCompleteBehavior1');
        var actorsAutoComplete = $find('autoCompleteBehavior2');
        actorsAutoComplete.set_contextKey(moviesAutoComplete.get_element().value);
        moviesAutoComplete.add_itemSelected(cascade);

        // setup initial state of second flyout
        if (moviesAutoComplete.get_element().value) {
            actorsAutoComplete.get_element().disabled = false;
        } else {
            actorsAutoComplete.get_element().disabled = true;
            actorsAutoComplete.get_element().value = "";
        }
    }

    function cascade(sender, ev) {
        var actorsAutoComplete = $find('autoCompleteBehavior2');
        actorsAutoComplete.set_contextKey(ev.get_text());
        actorsAutoComplete.get_element().value = '';
        if (actorsAutoComplete.get_element().disabled) {
            actorsAutoComplete.get_element().disabled = false;
        }
    }   
    Sys.Application.add_load(initCascadingAutoComplete); 
```

在父控件的 add_itemSelected 方法上调用级联函数以实现级联行为。

他们将一个自动完成扩展器的内容级联到另一个，而不是采用级联下拉列表，但希望您可以重用其中的一些想法。

# python - 如何从 x86asm/x64asm 调用 python2.5 函数？

> ID：319232
> 
> 赞同：2
> 
> 时间：2008-11-25T23:14:51.313
> 
> 标签：python, assembly

我将有几个必须与汇编代码交互的 python 函数。该解决方案不需要是一个完整的解决方案，因为我不会与 python 代码交互太久。无论如何，我咀嚼了一下：

*   python 对象在内存中是什么样的？
*   如何调用python函数？
*   如何将 python 对象作为 ctypes 接口的 python 对象传递？
*   ctypes 界面能否以其他方式让我的工作更轻松？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-25T23:37:39.083

您需要阅读并理解[Python 解释器的扩展和嵌入](http://python.org/doc/2.5/ext/ext.html)以及[Python/C API 参考手册](http://python.org/doc/2.5/api/api.html)。这描述了如何从 C 与 Python 交互。您可以在 C 中执行的所有操作也可以等效地在汇编代码中执行，但是您需要自己做这件事，因为它不是从 Python 的角度直接描述的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-29T13:35:58.333

这当然是可行的，但是您可以更轻松地阅读 C API 文档并用 C 编写中间函数。

想一想，强烈推荐使用 C，因为可能很难判断您调用的哪些例程可能被实现为预处理器宏。

# asp.net - IE7 会话 cookie 丢失

> ID：319241
> 
> 赞同：0
> 
> 时间：2008-11-25T23:21:17.137
> 
> 标签：asp.net, authentication, cookies, asp.net-2.0, fiddler

我有一个 ASP.NET 2.0 应用程序。登录成功后，登录页面重定向两次。这在除一台之外的所有测试环境和生产服务器上都可以正常工作。我们可以通过 Fiddler 看到登录重定向到第二个页面并重定向到第三个页面。到达第三页时，身份验证 cookie 丢失，页面重定向回登录。如前所述，这只发生在一台带有 IE7 的生产服务器上。如果我们从服务器本身尝试 IE7，它工作正常。它只会在其他客户端机器上失败。如果我在 FireFox 上尝试同样的方法，效果会非常好。我可以清楚地看到提琴手，在这种情况下cookie没有丢失。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-14T15:20:50.850

这是一个长镜头，但服务器名称中是否有下划线？不久前，有一个 IE 错误，它无法从其中包含下划线的服务器名称/URL 保存 cookie，所以如果我通过[http://server_name](http://server_name)访问服务器，我无法保存 cookie，但是通过[http://intranetdnsalias](http://intranetdnsalias)访问它就可以了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-25T23:38:38.317

您是否设置了带有域名的cookie？浏览时，您的网址是否包含域名？

“localhost” cookie 并不像域设置的 cookie 那样工作，并且经常会消失。

HttpCookie 包含要设置的域参数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T08:22:50.927

这听起来像是 IIS 配置问题。您是否尝试使用默认值在该服务器上重新创建网站？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T09:01:39.383

日期一致吗？例如，如果语言环境错误，则为 10.09.2008 == 09.10.2008。因此，如果您设置了特定的到期时间，它可能会将其解释为 en-US，但您需要 en-NZ 或其他内容。

或者您可以将其设置为 UTC 日期，但 ie 计算机是 UTC+8，所以它似乎很快就会过期？

# eclipse - eclipse 可视化编辑器死了吗？

> ID：319242
> 
> 赞同：11
> 
> 时间：2008-11-25T23:23:34.480
> 
> 标签：eclipse, visual-editor

Eclipse [Visual Editor](http://www.eclipse.org/projects/project_summary.php?projectid=tools.ve)项目似乎已经死了，没有提交，没有更新。有谁知道发生了什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-25T23:30:12.343

**更新 2：**该项目自 2011 年 6 月以来再次[被归档](http://www.eclipse.org/archived/)（即死亡）。

**更新：**该项目[已经恢复](http://dev.eclipse.org/mhonarc/lists/ve-dev/msg01818.html)，现在再次处于积极开发中。

由于缺乏开发人员的支持，它几乎已经死了。以下是他们邮件列表中[最近的](http://dev.eclipse.org/mhonarc/lists/ve-dev/msg01742.html)[一些](http://dev.eclipse.org/mhonarc/lists/ve-dev/msg01748.html) 帖子，这些帖子谈论了该项目缺乏进展。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-25T23:25:56.767

发生了什么？它被称为[NetBeans](http://netbeans.org)，它已经发生了。

我会因此而被否决，但他们知道这是真的。我喜欢 eclipse 并且自从我开始使用 Java 以来就一直在虔诚地使用它。我并不是说我喜欢 Netbeans，它只是每当提到 Java 可视化编辑器的概念时我所听到的。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-25T23:55:52.073

实际上，NetBeans 已经变得更好了。我已经使用 Eclipse、Netbeans 和 IntelliJ 几年了，现在 NetBeans 至少和其他的一样好（性能、可用​​性和特性）。

它也比其他人进步得更快。

他们有专职人员从事替代语言支持工作，因此您会发现他们拥有业内最好的 Ruby 支持，而且我相信 Python 也将变得如此出色。

当然，Eclipse 仍然有一个非常酷的待办事项列表，它会记住你为每个 bug 处理的文件，并且可以将你带回你处理过的任何 bug 的文件/编辑集，使用起来真的很棒，我不要认为它在其他任何一个平台上都可用。

--- 未来几年的修订 ---

我已经更多地使用 Netbeans 并且真的不得不将奖项授予 Eclipse。不同之处在于垂直编程环境——大多数将针对 Eclipse 而忽略 netbeans。您很少需要这些，但是当您需要它们时，通常无法绕过它们。如果 Netbeans 确实有一个等价物，它通常会出现无法使用的问题，通常最大的问题是模拟器支持。

除非您在特定行业工作，否则您不会遇到这些问题——Android 开发就是其中之一，主要驱动力是支持 Eclipse，NB 似乎落后了。我从事的另一个工作是电视/有线电视行业。

然而，对于原始 Java 开发，我仍然会给 Netbeans 一点优势，因为它是 sun 所针对和支持的环境。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-03T15:35:18.027

Eclipse的[Jigloo](http://www.cloudgarden.com/jigloo/)插件是 Visual Editor 的一个很好的替代品。虽然仍然不如 Netbeans GUI 编辑器那么好，但它相当健壮且功能齐全，尤其是与 Visual Editor 插件中可用的功能相比。绝对应该试一试。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-09-13T22:46:29.663

Visual Editor 将于 9 月 16 日发布新版本 1.4。RC 的安装说明如下：

[http://wiki.eclipse.org/VE/Update](http://wiki.eclipse.org/VE/Update)

FWIW，该项目确实停滞了一段时间。但是有一个新的、相对多样化的群体再次致力于它。最近的大部分工作都涉及使新版本与 Eclipse Galileo 兼容。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-11-07T20:44:44.803

它在 2011 年 5 月正式失效。它[在这里](http://www.eclipse.org/archived/)存档，但下载速度慢且安装棘手。取而代之的是一个新的编辑器[WindowBuilder Pro](http://www.eclipse.org/windowbuilder/download.php)。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-12-16T00:19:40.547

目前谷歌已经开源了[Windows Builder Pro](http://code.google.com/intl/ca/javadevtools/wbpro/index.html)。看起来不错

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-25T23:26:59.183

是的，

[http://www.eclipsezone.com/eclipse/forums/t91368.html](http://www.eclipsezone.com/eclipse/forums/t91368.html)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-09-12T21:07:27.913

是的，可悲的是，它已经死了。看着前面提到的关于它的复兴的电子邮件线程，我感觉即使它确实被捡起，它也会在一些新要求的重压下迅速崩溃（“使其通用，编辑从 SWT 到 HTML 的所有内容”）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-03-18T18:43:21.517

WindowBuilder 可以是一个不错的选择。我在 VE 上遇到了几个问题，最终我得到了 WindowBuilder，它完美地为我工作。

[http://www.eclipse.org/windowbuilder/](http://www.eclipse.org/windowbuilder/)

# .net - .NET Framework 源代码的可下载/可浏览版本？

> ID：319249
> 
> 赞同：19
> 
> 时间：2008-11-25T23:26:09.980
> 
> 标签：.net

既然已经提供了 .NET Framework 的源代码，有没有什么方法可以在不涉及使用 Visual Studio 进入框架类的情况下实际查看它？现在有好几次，我一直很好奇某些东西是如何工作的，并希望我能看到一些代码，但不想在调试器中组装一个应用程序并进行尸检。

我的 google-fu 让我失望了，只为我提供了宣布源可用这一事实的博客文章。（谢谢，博客圈！）我很肯定现在有人会把它全部扔到网上。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2013-05-14T08:41:41.160

查看 .NET 源代码有多种方式： 通过浏览器在线查看：

*   [http://www.dotnetframework.org](http://www.dotnetframework.org)
*   ~~[http://typedescriptor.net/browse](http://typedescriptor.net/browse)~~
*   [https://github.com/Microsoft/referencesource](https://github.com/Microsoft/referencesource)

下载它：

*   [http://referencesource.microsoft.com/netframework.aspx](http://referencesource.microsoft.com/netframework.aspx)
*   [http://referencesource.microsoft.com/](http://referencesource.microsoft.com/)
*   [http://sourceof.net](http://sourceof.net)

微软在这里建立了一个 ASP.NET 的 git 存储库：

[https://aspnet.codeplex.com/SourceControl/latest](https://aspnet.codeplex.com/SourceControl/latest)

额外的：

*   海量下载器：http: [//www.wintellect.com/blogs/jrobbins/download-all-the-net-reference-source-code-at-once-with-net-mass-downloader](http://www.wintellect.com/blogs/jrobbins/download-all-the-net-reference-source-code-at-once-with-net-mass-downloader)
*   CLI 在线源代码查看器：[http ://labs.developerfusion.co.uk/SourceViewer/browse.aspx?assembly=SSCLI](http://labs.developerfusion.co.uk/SourceViewer/browse.aspx?assembly=SSCLI)

玩得开心！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-25T23:44:14.110

[.NET Framework 库可用的源代码组件](http://referencesource.microsoft.com/netframework.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-02-27T09:01:56.950

~~刚发现这个：~~

[http://referencesource-beta.microsoft.com/](http://referencesource-beta.microsoft.com/)

~~尽管它仍处于测试阶段，但它似乎非常有用。~~

**更新：**不再可用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-25T23:28:25.437

好吧，你知道吗，两分钟后我再次调整搜索词并找到了一些东西：[NetMassDownloader](http://www.codeproject.com/KB/dotnet/netmassdownloader.aspx)

不过还是和我想的不太一样……

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-09-18T12:45:31.443

我对源代码的部署方式感到失望。我想像你一样下载和搜索或浏览代码。

我所做的是安装源代码，然后将所有源代码复制到一个单独的文件夹中。在我的例子中，H:\CodeLibrary\dotNetSource。然后我卸载了源代码。

源代码分散在许多文件夹中。因此，搜索、复制或移动需要很长时间。我所做的是遍历文件夹，将所有源移动到一个文件夹中。现在，使用索引服务或 Windows 桌面搜索可以轻松搜索源代码。

例如，我需要查看 TrackBar 的代码。我在搜索实用程序和宾果游戏中输入了“@filename trackbar.cs”。

我无法告诉您点击几下即可获得源代码的价值。在设计的时候，我大概每天至少搜索源代码十几次。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-09-18T12:52:44.580

我总是只使用[Reflector](http://www.red-gate.com/products/reflector/) - 只需加载一个 .Net 程序集，突出显示您感兴趣的类/方法，点击空格就可以了。它将链接放置在任何地方，因此您只需单击一个类型，它就会带您进入该代码。

它与实际的源代码略有不同，因为它基本上是一个反编译器，但仍然足以了解各种框架类是如何工作的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-04-04T06:34:53.263

微软在这里建立了一个 ASP.NET 的 git 存储库：

[https://aspnet.codeplex.com/SourceControl/latest](https://aspnet.codeplex.com/SourceControl/latest)

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2014-02-04T09:56:59.707

一个很棒的资源，不仅适用于 .NET，还有[this](http://dotnetinside.com/en/)。它也有你能想到的一切（例如 EF）

**[编辑]**

这个项目现在似乎已经死了。

此外，微软的源页面已经过测试。可能这就是死项目的原因。

因此，正如其他答案中已经指出的那样， [http://referencesource.microsoft.com](http://referencesource.microsoft.com)是官方网站。

# sql - 您能否推荐一个好的 Teradata 最佳实践来源？

> ID：319251
> 
> 赞同：9
> 
> 时间：2008-11-25T23:26:55.610
> 
> 标签：sql, data-warehouse, teradata

看起来我的数据仓库项目明年将转移到 Teradata（从 SQL Server 2005 开始）。

我正在寻找有关 Teradata 最佳实践的资源——从其 SQL 方言的限制到使查询执行良好的惯用语和约定——尤其是当它们突出显示与 SQL Server 2005 显着不同的事物时。特别提示类似于在[SQL 的艺术](https://rads.stackoverflow.com/amzn/click/com/0596008945)（更侧重于 Oracle）。

我的业务流程目前在 T-SQL 存储过程中，并且相当依赖 SQL Server 2005 的功能，如 PIVOT、UNPIVOT 和通用表表达式，每月从 4TB 数据仓库产生大约 2700 万行输出。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-06-03T04:38:44.337

一个开始的地方是：[http ://www.teradataforum.com/](http://www.teradataforum.com/)

这可能有点晚了，但我可以警告您一些关于我所了解的 Teradata 的事情。

尽可能多地使用最新版本。对于 V12，优化器被重新编写，现在数据库的性能要好得多。尝试意识到 SQL Server 和 Teradata 是非常不同的野兽，大多数概念都不会很好地转换。不要低估主索引的重要性。与其他数据库相比，teradata 使用的锁非常原始。不要使用 TERA 模式。您没有任何遗留代码，ANSI 模式要优越得多，并且受到广泛鼓励。连接索引是非常有用的工具，但它们并不能提供所有答案。并行性，花时间了解 FASTLOAD、MULTILOAD 和 TPUMP 的工作原理，并了解如何将其用于 ETL 策略。如果您尝试运行需要高性能的查询，请不要使用任何强制转换，优化器不会使用统计信息来生成最佳执行计划。处理日期会很痛苦，只是一个警告。Teradata 非常面向 DDL，请在创建表时尝试了解所有相关语法。压缩是一个很棒的工具，如果您有任何在表格中重复的值，请使用它。Teradata 可用的工具并不多，请准备好构建大量工具。现有的工具非常昂贵。准备好建造很多东西。现有的工具非常昂贵。准备好建造很多东西。现有的工具非常昂贵。

不幸的是，我对 SQL Server 了解不多，因此无法说出 SQL Server 中的哪些工具出现在 Teradata 中。

希望这可以帮助

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-06-10T13:00:21.540

我还会查看最近推出的[Teradata Developer Exchange](http://developer.teradata.com)以及 Teradata 主网站上的 TeradataForum 和论坛。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-04T19:43:13.877

I don't know of any good references available online. Teradata has some design manuals that are available for download, but they're more instruction manuals and not "best practices" as such. check them out here: [http://www.info.teradata.com/DataWarehouse/eTeradata-BrowseBy.cfm?page=Teradata%20Database](http://www.info.teradata.com/DataWarehouse/eTeradata-BrowseBy.cfm?page=Teradata%20Database)

Alternatively, you need to find a friendly Teradata expert to bounce ideas off. Try Teradata themselves, or find a local consultant with Teradata experience.

Best Practices on Teradata isn't a topic that gets lots of discussions and most of the best tricks tend to be proprietary knowledge of the person/people who discovered them.

Sorry, David Stewardson Satyam Computer Services

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-26T05:39:53.207

在 Google 搜索“Teradata 最佳实践”列表的顶部给了我[TERADATA ADVISORY GROUP SETS BEST PACTICES FOR BUSINESS OBJECTS 和 TERADATA CUSTOMERS](http://www.businessobjects.com/pdf/partners/teradata_advisory_group.pdf)

*编辑*：正如你所指出的，这只是广告，看看你如何处理这些。请记住，我不知道 Teradata 是什么，也看不到自己在公元 22 世纪这一边的任何时候都在使用它。

*   [Teradata 论坛](http://www.teradata.com/teradataForum/)
*   [Teradata 部署的最佳实践](http://download.oracle.com/docs/cd/E12104_01/books/AnyInstAdm/AnyInstAdmPreInstall12.html)
*   [NCR Teradata 认证的最佳学习指南](http://www.eplanetlabs.com/vendors/Teradata.htm)

中间的看起来很有希望，顶部有漂亮的长链接树

> Oracle® Business Intelligence 应用程序安装和配置指南 > Oracle BI 应用程序的预安装和部署前注意事项 > 适用于 Oracle Business Analytics Warehouse 的 Teradata 特定数据库指南 >

第一个链接，论坛，应该让你接触到合适的人。

# sql - SQL 可以跨多个表计算聚合函数吗？

> ID：319262
> 
> 赞同：10
> 
> 时间：2008-11-25T23:30:53.637
> 
> 标签：sql

假设我有两个现有的表，“狗”和“猫”：

```
 dog_name | owner
 ---------+------
 Sparky   | Bob
 Rover    | Bob
 Snoopy   | Chuck
 Odie     | Jon

 cat_name | owner
 ---------+------
 Garfield | Jon
 Muffy    | Sam
 Stupid   | Bob 
```

如何使用此输出编写查询？

```
 owner | num_dogs | num_cats
 ------+----------+---------
 Bob   |     2    |    1
 Chuck |     1    |    0
 Sam   |     0    |    1
 Jon   |     1    |    1 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-25T23:34:49.200

```
select owner, sum(num_dogs), sum(num_cats) from
  (select owner, 1 as num_dogs, 0 as num_cats from dogs
   union
   select owner, 0 as num_dogs, 1 as num_cats from cats)
group by owner 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-26T00:22:18.120

我更喜欢这个：

```
select owner
     , count(dog_name) dogs
     , count(cat_name) cats
  from cats FULL OUTER JOIN dogs ON (cats.owner = dogs.owner) 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-25T23:43:12.303

在 SQL Server 2005 的 T-SQL 中（如果没有，则将 CTE 替换为内联子查询）：

```
WITH ownership AS (
    SELECT owner, COUNT(dog_name) AS num_dogs, 0 AS num_cats -- counts all non-NULL dog_name
    FROM dogs
    GROUP BY owner

    UNION

    SELECT owner, 0 AS num_dogs, COUNT(cat_name) as num_cats -- counts all non-NULL cat_name
    FROM cats
    GROUP BY owner
)
SELECT ownership.owner
    ,SUM(ownership.num_dogs) AS num_dogs
    ,SUM(ownership.num_cats) as num_cats
FROM ownership
GROUP BY ownership.owner 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-10-08T00:02:41.303

我从 Cade Roux 的出色答案开始，但将 WITH...AS () 更改为使用表变量，因为我最终使用类似查询的结果来获取更多聚合函数。

```
-- Table variable declaration
DECLARE @RainingCatsDogs TABLE
(
    Owner nvarchar(255),
    num_cats int,
    num_dogs int
)

-- Populate the table variable with data from the union of the two SELECT statements
INSERT INTO @RainingCatsDogs

-- Get the count of doggies
SELECT 
    owner, COUNT(dog_name) AS num_dogs, 0 AS num_cats
FROM 
    dogs
GROUP BY 
    owner

-- join the results from the two SELECT statements
UNION

-- Get the count of kittehs
SELECT 
    owner, 0 AS num_dogs, COUNT(cat_name) as num_cats
FROM 
    cats
GROUP BY 
    owner

-- From the table variable, you can calculate the summed results
SELECT
    owner,
    SUM(num_dogs),
    SUM(num_cats)
FROM 
    @RainingCatsDogs 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2020-05-07T18:59:57.887

如果您的数据库可以处理它，我会加倍考虑[FerranB 的解决方案](https://stackoverflow.com/a/319355/521799)并编写一个令人讨厌的[`NATURAL FULL JOIN`](https://blog.jooq.org/2017/03/07/impress-your-coworkers-with-a-sql-natural-full-outer-join/)解决方案。我的意思是，你最后一次有机会这样做是什么时候？

```
SELECT owner, COUNT(dog_name), COUNT(cat_name)
FROM cats 
NATURAL FULL JOIN dogs
GROUP BY owner 
```

# jquery - jQuery 插件：处理事件

> ID：319264
> 
> 赞同：5
> 
> 时间：2008-11-25T23:33:00.310
> 
> 标签：jquery, events, jquery-plugins, event-listener

我目前正在开发一个 jQuery 插件，我想知道是否可以让插件监听事件而不是被事件触发。

所以代替这个：

```
$('#element_id').mouseover(function() {
    $(this).plugin();
});

$('#element_id').mouseout(function() {
    $(this).pluginHide();
}); 
```

我想尝试做这样的事情：

```
$('#element_id').plugin(????, ????); 
```

并将 ? 替换为对应该触发它显示或隐藏的元素和事件的某种引用。我还在用 jQuery 弄湿我的脚，所以如果解决这个问题的方法非常明显，请耐心等待。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-25T23:41:58.310

经过一番试验，看起来我正在寻找内置的“bind()”函数。为了解决我原来的问题：

```
jQuery.fn.plugin = function(show, hide) {
    this.bind(show, function() {
        // Do something to show.
    };

    this.bind(hide, function() {
        // Do something to hide.
    };
}; 
```

# javascript - HTML canvas 的 arc 函数教程

> ID：319267
> 
> 赞同：16
> 
> 时间：2008-11-25T23:34:43.177
> 
> 标签：javascript, html, canvas

我无法弄清楚 arc() 函数的所有参数是什么（通过实验），而且我还没有找到任何似乎可以解释它们的教程。arc() 函数的一个很好的解释在哪里？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-11-26T01:08:16.937

```
arc(x, y, radius, startAngle, endAngle, anticlockwise) 
```

前三个参数，x 和 y 以及半径，描述一个圆，绘制的圆弧将是该圆的一部分。startAngle 和 endAngle 是沿着圆圈开始和停止绘制的位置。0 为东，Math.PI/2 为南，Math.PI 为西，Math.PI*3/2 为北。如果逆时针为 1，则圆弧的方向相反。

[https://developer.mozilla.org/En/Canvas_tutorial/Drawing_shapes#Arcs](https://developer.mozilla.org/En/Canvas_tutorial/Drawing_shapes#Arcs)

![顺时针](https://i.stack.imgur.com/1qF8E.jpg)

![逆时针](https://i.stack.imgur.com/LqtRU.jpg)

在附图中，唯一的区别是逆时针参数。Math.PI/2 在顺时针或逆时针时总是以南结束

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-02-28T21:06:48.100

我遇到了同样的问题，并制作了一个小的交互式页面来帮助理解它：

[http://www.scienceprimer.com/drawing-circles-javascript-html5-canvas-element](http://www.scienceprimer.com/drawing-circles-javascript-html5-canvas-element)

可以调整所有参数，并实时渲染生成的弧线。该页面还演示了 fill()、stroke() 和 closePath() 方法如何与 arc() 方法交互。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-25T23:43:39.867

根据[MDC](https://developer.mozilla.org/En/Canvas_tutorial/Drawing_shapes)：

```
arc(x, y, radius, startAngle, endAngle, anticlockwise) 
```

x、y 和半径显然是圆参数。startAngle 和 endAngle 以弧度表示，从东开始。逆时针是一个布尔值。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-05-29T05:49:11.313

HTML5的canvas和arc函数的简单介绍可以看这个简单的例子：http: [//pastebin.com/kxB7uJLD](http://pastebin.com/kxB7uJLD)

这么久。

# python - 如何在 Python 中验证 IP 地址？

> ID：319279
> 
> 赞同：170
> 
> 时间：2008-11-25T23:40:45.880
> 
> 标签：python, validation, networking, ip-address

验证用户输入的 IP 是否有效的最佳方法是什么？它以字符串的形式出现。

* * *

## 回答 #1

> 赞同：186
> 
> 时间：2008-11-25T23:50:54.453

不要解析它。问一下。

```
import socket

try:
    socket.inet_aton(addr)
    # legal
except socket.error:
    # Not legal 
```

* * *

## 回答 #2

> 赞同：86
> 
> 时间：2012-05-28T09:48:03.647

从 Python 3.4 开始，检查 IPv6 或 IPv4 地址是否正确的最佳方法是使用 Python 标准库模块`ipaddress`- IPv4/IPv6 操作库 sa [https://docs.python.org/3/library/ipaddress。 html](https://docs.python.org/3/library/ipaddress.html)以获得完整的文档。

例子 ：

```
#!/usr/bin/env python

import ipaddress
import sys

try:
    ip = ipaddress.ip_address(sys.argv[1])
    print('%s is a correct IP%s address.' % (ip, ip.version))
except ValueError:
    print('address/netmask is invalid: %s' % sys.argv[1])
except:
    print('Usage : %s  ip' % sys.argv[0]) 
```

对于其他版本：Github、phihag / Philipp Hagemeister，“Python 3.3 旧 Python 版本的 ipaddress”，[https://github.com/phihag/ipaddress](https://github.com/phihag/ipaddress)

来自 phihag 的反向移植可在例如 Anaconda Python 2.7 中使用，并且包含在安装程序中。sa [https://docs.continuum.io/anaconda/pkg-docs](https://docs.continuum.io/anaconda/pkg-docs)

使用 pip 安装：

```
pip install ipaddress 
```

sa: ipaddress 1.0.17, "IPv4/IPv6 操作库", "3.3+ ipaddress 模块的端口", [https://pypi.python.org/pypi/ipaddress/1.0.17](https://pypi.python.org/pypi/ipaddress/1.0.17)

* * *

## 回答 #3

> 赞同：78
> 
> 时间：2010-10-25T17:28:50.263

```
import socket

def is_valid_ipv4_address(address):
    try:
        socket.inet_pton(socket.AF_INET, address)
    except AttributeError:  # no inet_pton here, sorry
        try:
            socket.inet_aton(address)
        except socket.error:
            return False
        return address.count('.') == 3
    except socket.error:  # not a valid address
        return False

    return True

def is_valid_ipv6_address(address):
    try:
        socket.inet_pton(socket.AF_INET6, address)
    except socket.error:  # not a valid address
        return False
    return True 
```

* * *

## 回答 #4

> 赞同：66
> 
> 时间：2008-12-01T05:36:54.040

[IPy 模块](http://pypi.python.org/pypi/IPy/)（设计用于处理 IP 地址的模块）将针对无效地址抛出 ValueError 异常。

```
>>> from IPy import IP
>>> IP('127.0.0.1')
IP('127.0.0.1')
>>> IP('277.0.0.1')
Traceback (most recent call last):
 ...
ValueError: '277.0.0.1': single byte must be 0 <= byte < 256
>>> IP('foobar')
Traceback (most recent call last):
 ...
ValueError: invalid literal for long() with base 10: 'foobar' 
```

但是，就像达斯汀的回答一样，它会接受诸如“4”和“192.168”之类的东西，因为如上所述，它们是 IP 地址的有效表示。

如果您使用的是 Python 3.3 或更高版本，它现在包含[ipaddress 模块](http://docs.python.org/py3k/library/ipaddress.html)：

```
>>> import ipaddress
>>> ipaddress.ip_address('127.0.0.1')
IPv4Address('127.0.0.1')
>>> ipaddress.ip_address('277.0.0.1')
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/usr/lib/python3.3/ipaddress.py", line 54, in ip_address
    address)
ValueError: '277.0.0.1' does not appear to be an IPv4 or IPv6 address
>>> ipaddress.ip_address('foobar')
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/usr/lib/python3.3/ipaddress.py", line 54, in ip_address
    address)
ValueError: 'foobar' does not appear to be an IPv4 or IPv6 address 
```

对于 Python 2，如果安装 python-ipaddress，则可以使用 ipaddress 获得相同的功能：

```
pip install ipaddress 
```

该模块与 Python 2 兼容，并提供与 Python 3.3 以来 Python 标准库中包含的 ipaddress 模块非常相似的 API。更多细节[在这里](https://github.com/HaDiNet/python-ipaddress/blob/master/README.md)。在 Python 2 中，您需要将 IP 地址字符串显式转换为 unicode: `ipaddress.ip_address(u'127.0.0.1')`。

* * *

## 回答 #5

> 赞同：46
> 
> 时间：2008-11-25T23:47:54.773

```
def is_valid_ip(ip):
    """Validates IP addresses.
    """
    return is_valid_ipv4(ip) or is_valid_ipv6(ip) 
```

IPv4：

```
def is_valid_ipv4(ip):
    """Validates IPv4 addresses.
    """
    pattern = re.compile(r"""
        ^
        (?:
          # Dotted variants:
          (?:
            # Decimal 1-255 (no leading 0's)
            [3-9]\d?|2(?:5[0-5]|[0-4]?\d)?|1\d{0,2}
          |
            0x0*[0-9a-f]{1,2}  # Hexadecimal 0x0 - 0xFF (possible leading 0's)
          |
            0+[1-3]?[0-7]{0,2} # Octal 0 - 0377 (possible leading 0's)
          )
          (?:                  # Repeat 0-3 times, separated by a dot
            \.
            (?:
              [3-9]\d?|2(?:5[0-5]|[0-4]?\d)?|1\d{0,2}
            |
              0x0*[0-9a-f]{1,2}
            |
              0+[1-3]?[0-7]{0,2}
            )
          ){0,3}
        |
          0x0*[0-9a-f]{1,8}    # Hexadecimal notation, 0x0 - 0xffffffff
        |
          0+[0-3]?[0-7]{0,10}  # Octal notation, 0 - 037777777777
        |
          # Decimal notation, 1-4294967295:
          429496729[0-5]|42949672[0-8]\d|4294967[01]\d\d|429496[0-6]\d{3}|
          42949[0-5]\d{4}|4294[0-8]\d{5}|429[0-3]\d{6}|42[0-8]\d{7}|
          4[01]\d{8}|[1-3]\d{0,9}|[4-9]\d{0,8}
        )
        $
    """, re.VERBOSE | re.IGNORECASE)
    return pattern.match(ip) is not None 
```

IPv6：

```
def is_valid_ipv6(ip):
    """Validates IPv6 addresses.
    """
    pattern = re.compile(r"""
        ^
        \s*                         # Leading whitespace
        (?!.*::.*::)                # Only a single whildcard allowed
        (?:(?!:)|:(?=:))            # Colon iff it would be part of a wildcard
        (?:                         # Repeat 6 times:
            [0-9a-f]{0,4}           #   A group of at most four hexadecimal digits
            (?:(?<=::)|(?<!::):)    #   Colon unless preceeded by wildcard
        ){6}                        #
        (?:                         # Either
            [0-9a-f]{0,4}           #   Another group
            (?:(?<=::)|(?<!::):)    #   Colon unless preceeded by wildcard
            [0-9a-f]{0,4}           #   Last group
            (?: (?<=::)             #   Colon iff preceeded by exacly one colon
             |  (?<!:)              #
             |  (?<=:) (?<!::) :    #
             )                      # OR
         |                          #   A v4 address with NO leading zeros 
            (?:25[0-4]|2[0-4]\d|1\d\d|[1-9]?\d)
            (?: \.
                (?:25[0-4]|2[0-4]\d|1\d\d|[1-9]?\d)
            ){3}
        )
        \s*                         # Trailing whitespace
        $
    """, re.VERBOSE | re.IGNORECASE | re.DOTALL)
    return pattern.match(ip) is not None 
```

IPv6 版本使用“ `(?:(?<=::)|(?<!::):)`”，它可以在`(?(?<!::):)`支持带有环视的条件的正则表达式引擎上替换为“”。（即PCRE，.NET）

**编辑：**

*   放弃了原生变体。
*   扩展正则表达式以符合 RFC。
*   为 IPv6 地址添加了另一个正则表达式。

**编辑2：**

我发现了一些讨论如何使用正则表达式解析 IPv6 地址的链接：

*   [IPv6 地址的正则表达式](http://forums.dartware.com/viewtopic.php?t=452)- InterMapper Forums
*   [工作 IPv6 正则表达式](http://www.vankouteren.eu/blog/2009/05/working-ipv6-regular-expression/)- Patrick 的游乐场博客
*   [test-ipv6-regex.pl](http://download.dartware.com/thirdparty/test-ipv6-regex.pl) - 包含大量测试用例的 Perl 脚本。似乎我的正则表达式在其中一些测试中失败了。

**编辑3：**

终于设法编写了一个通过所有测试的模式，我也很满意。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2014-09-18T16:41:54.490

我希望它足够简单和pythonic：

```
def is_valid_ip(ip):
    m = re.match(r"^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$", ip)
    return bool(m) and all(map(lambda n: 0 <= int(n) <= 255, m.groups())) 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2008-11-25T23:47:00.127

我想这会做到...

```
def validIP(address):
    parts = address.split(".")
    if len(parts) != 4:
        return False
    for item in parts:
        if not 0 <= int(item) <= 255:
            return False
    return True 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2015-04-20T12:56:30.393

将 IPv4 地址视为“ip”。

```
if re.match(r'^((\d{1,2}|1\d{2}|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d{2}|2[0-4]\d|25[0-5])$', ip):  
    print "Valid IP"  
else:
    print "Invalid IP" 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2013-01-22T06:27:12.487

我必须非常感谢 Markus Jarderot 的帖子——我的大部分帖子都受到了他的启发。

我发现 Markus 的答案仍然无法通过他的答案引用的 Perl 脚本中的一些 IPv6 示例。

这是我的正则表达式，它传递了该 Perl 脚本中的所有示例：

```
r"""^
     \s* # Leading whitespace
     # Zero-width lookaheads to reject too many quartets
     (?:
        # 6 quartets, ending IPv4 address; no wildcards
        (?:[0-9a-f]{1,4}(?::(?!:))){6}
             (?:25[0-4]|2[0-4]\d|1\d\d|[1-9]\d|\d)
        (?:\.(?:25[0-4]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}
      |
        # 0-5 quartets, wildcard, ending IPv4 address
        (?:(?:[0-9a-f]{1,4}(?::(?!:))){0,4}[0-9a-f]{1,4})?
        (?:::(?!:))
             (?:25[0-4]|2[0-4]\d|1\d\d|[1-9]\d|\d)
        (?:\.(?:25[0-4]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}
      |
        # 0-4 quartets, wildcard, 0-1 quartets, ending IPv4 address
        (?:(?:[0-9a-f]{1,4}(?::(?!:))){0,3}[0-9a-f]{1,4})?
        (?:::(?!:))
        (?:[0-9a-f]{1,4}(?::(?!:)))?
             (?:25[0-4]|2[0-4]\d|1\d\d|[1-9]\d|\d)
        (?:\.(?:25[0-4]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}
      |
        # 0-3 quartets, wildcard, 0-2 quartets, ending IPv4 address
        (?:(?:[0-9a-f]{1,4}(?::(?!:))){0,2}[0-9a-f]{1,4})?
        (?:::(?!:))
        (?:[0-9a-f]{1,4}(?::(?!:))){0,2}
             (?:25[0-4]|2[0-4]\d|1\d\d|[1-9]\d|\d)
        (?:\.(?:25[0-4]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}
      |
        # 0-2 quartets, wildcard, 0-3 quartets, ending IPv4 address
        (?:(?:[0-9a-f]{1,4}(?::(?!:))){0,1}[0-9a-f]{1,4})?
        (?:::(?!:))
        (?:[0-9a-f]{1,4}(?::(?!:))){0,3}
             (?:25[0-4]|2[0-4]\d|1\d\d|[1-9]\d|\d)
        (?:\.(?:25[0-4]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}
      |
        # 0-1 quartets, wildcard, 0-4 quartets, ending IPv4 address
        (?:[0-9a-f]{1,4}){0,1}
        (?:::(?!:))
        (?:[0-9a-f]{1,4}(?::(?!:))){0,4}
             (?:25[0-4]|2[0-4]\d|1\d\d|[1-9]\d|\d)
        (?:\.(?:25[0-4]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}
      |
        # wildcard, 0-5 quartets, ending IPv4 address
        (?:::(?!:))
        (?:[0-9a-f]{1,4}(?::(?!:))){0,5}
             (?:25[0-4]|2[0-4]\d|1\d\d|[1-9]\d|\d)
        (?:\.(?:25[0-4]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}
      |
        # 8 quartets; no wildcards
        (?:[0-9a-f]{1,4}(?::(?!:))){7}[0-9a-f]{1,4}
      |
        # 0-7 quartets, wildcard
        (?:(?:[0-9a-f]{1,4}(?::(?!:))){0,6}[0-9a-f]{1,4})?
        (?:::(?!:))
      |
        # 0-6 quartets, wildcard, 0-1 quartets
        (?:(?:[0-9a-f]{1,4}(?::(?!:))){0,5}[0-9a-f]{1,4})?
        (?:::(?!:))
        (?:[0-9a-f]{1,4})?
      |
        # 0-5 quartets, wildcard, 0-2 quartets
        (?:(?:[0-9a-f]{1,4}(?::(?!:))){0,4}[0-9a-f]{1,4})?
        (?:::(?!:))
        (?:(?:[0-9a-f]{1,4}(?::(?!:))){0,1}[0-9a-f]{1,4})?
      |
        # 0-4 quartets, wildcard, 0-3 quartets
        (?:(?:[0-9a-f]{1,4}(?::(?!:))){0,3}[0-9a-f]{1,4})?
        (?:::(?!:))
        (?:(?:[0-9a-f]{1,4}(?::(?!:))){0,2}[0-9a-f]{1,4})?
      |
        # 0-3 quartets, wildcard, 0-4 quartets
        (?:(?:[0-9a-f]{1,4}(?::(?!:))){0,2}[0-9a-f]{1,4})?
        (?:::(?!:))
        (?:(?:[0-9a-f]{1,4}(?::(?!:))){0,3}[0-9a-f]{1,4})?
      |
        # 0-2 quartets, wildcard, 0-5 quartets
        (?:(?:[0-9a-f]{1,4}(?::(?!:))){0,1}[0-9a-f]{1,4})?
        (?:::(?!:))
        (?:(?:[0-9a-f]{1,4}(?::(?!:))){0,4}[0-9a-f]{1,4})?
      |
        # 0-1 quartets, wildcard, 0-6 quartets
        (?:[0-9a-f]{1,4})?
        (?:::(?!:))
        (?:(?:[0-9a-f]{1,4}(?::(?!:))){0,5}[0-9a-f]{1,4})?
      |
        # wildcard, 0-7 quartets
        (?:::(?!:))
        (?:(?:[0-9a-f]{1,4}(?::(?!:))){0,6}[0-9a-f]{1,4})?
     )
     (?:/(?:1(?:2[0-7]|[01]\d)|\d\d?))? # With an optional CIDR routing prefix (0-128)
     \s* # Trailing whitespace
    $""" 
```

我还编写了一个 Python 脚本来测试所有这些 IPv6 示例；它[在 Pastebin 上，](http://pastebin.com/TKLfQUG0)因为它太大而无法在此处发布。

您可以以“[result]=[example]”的形式运行带有测试结果和示例参数的脚本，例如：

```
python script.py Fail=::1.2.3.4: pass=::127.0.0.1 false=::: True=::1 
```

或者您可以通过不指定任何参数来简单地运行所有测试，例如：

```
python script.py 
```

无论如何，我希望这对其他人有帮助！

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2015-03-21T05:50:46.673

我想出了这个简单的版本

```
def ip_checkv4(ip):
        parts=ip.split(".")
        if len(parts)<4 or len(parts)>4:
            return "invalid IP length should be 4 not greater or less than 4"
        else:
            while len(parts)== 4:
                a=int(parts[0])
                b=int(parts[1])
                c=int(parts[2])
                d=int(parts[3])
                if a<= 0 or a == 127 :
                    return "invalid IP address"
                elif d == 0:
                    return "host id  should not be 0 or less than zero " 
                elif a>=255:
                    return "should not be 255 or greater than 255 or less than 0 A"
                elif b>=255 or b<0: 
                    return "should not be 255 or greater than 255 or less than 0 B"
                elif c>=255 or c<0:
                    return "should not be 255 or greater than 255 or less than 0 C"
                elif d>=255 or c<0:
                    return "should not be 255 or greater than 255 or less than 0 D"
                else:
                    return "Valid IP address ", ip

    p=raw_input("Enter IP address")
    print ip_checkv4(p) 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-06-20T13:27:47.800

我只需要解析 IP v4 地址。我基于 Chills 策略的解决方案如下：

```
def getIP(): 

    valid = False 

    while not valid : 

        octets = raw_input("远程机器 IP 地址:").strip().split(".") 

        try: valid=len( filter( lambda(item):0< =int(item)<256, octets) ) == 4

        除外：有效 = False

    返回 ".".join( octets )

```

# sql - Postgresql 并发

> ID：319280
> 
> 赞同：6
> 
> 时间：2008-11-25T23:40:45.910
> 
> 标签：sql, postgresql, concurrency, parallel-processing

在我正在工作的项目中，有一个带有“更新时”触发器的表，用于监视布尔列是否已更改（例如：false -> true = 执行某些操作）。但是这个动作只能连续做一次。

将有多个客户端访问数据库，所以我可以假设最终，多个客户端将尝试并行更新同一行列。

“更新”触发器本身是否处理并发本身，或者我需要在事务中执行并手动锁定表？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-25T23:55:14.150

触发器不处理并发，无论您是否使用显式事务，PostgreSQL 都应该做正确的事情。

PostgreSQL 使用*乐观锁*，这意味着第一个真正更新行的人会获得该行的锁。如果第二个人尝试更新该行，他们的更新语句会等待看第一个人是提交他们的更改还是回滚。

如果第一个人提交，第二个人会得到一个错误，而不是他们的更改经历并消除了他们可能感兴趣的更改。

如果第一个人回滚，第二个人的更新会解除阻塞，并正常进行，因为现在它不会覆盖任何内容。

第二个人也可以使用该`NOWAIT`选项，如果他们的更新与未解决的更改冲突，则该选项会立即发生错误而不是阻塞。

# c++ - 更改 C++ 向量的保留内存

> ID：319292
> 
> 赞同：5
> 
> 时间：2008-11-25T23:47:11.997
> 
> 标签：c++, memory, stl, vector, resize

我有一个包含 1000 个“节点”的向量

```
 if(count + 1 > m_listItems.capacity())
     m_listItems.reserve(count + 100); 
```

问题是当我要重新填充它时，我也将其清除。

```
m_listItems.clear(); 
```

容量不变。我使用了 resize(1); 但这似乎并没有改变容量。那么如何改变储备呢？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-25T23:52:57.213

```
vector<Item>(m_listItems).swap(m_listItems); 
```

将再次缩小`m_listItems`：[http](http://www.gotw.ca/gotw/054.htm) ://www.gotw.ca/gotw/054.htm （Herb Sutter）

如果你想清除它，用一个空向量交换：

```
vector<Item>().swap(m_listItems); 
```

这当然更有效。（请注意，交换向量基本上意味着只交换两个指针。没有什么真正耗时的事情）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T00:13:21.430

您可以按照其他人的建议交换矢量，并且如[http://www.gotw.ca/gotw/054.htm](http://www.gotw.ca/gotw/054.htm)中所述，但请注意它*不是*免费的，您正在执行每个元素的副本，因为vector 必须分配一个新的、更小的内存块，并复制所有旧内容。（交换操作本质上是免费的，但是您正在交换一个临时初始化的原始向量数据的副本，这*不是*免费的）

如果您事先知道向量有多大，则应从一开始就分配正确的大小，因此无需调整大小：

```
std::vector<foo> v(1000); // Create a vector with capacity for 1000 elements 
```

而且，如果您事先不知道容量，那是否浪费一点空间又有什么关系呢？是否值得花时间将每个元素复制到一个新的更小的向量（这就是 std::vector(v).swap(v) 会做的），只是为了节省几千字节的内存？

*同样，当您清除向量时，如果您仍然*打算重新填充它，将其容量设置为零似乎是一种令人印象深刻的时间浪费。

*编辑*：

> baash05：如果你有 1000000 件物品和 10 兆的 ram。你会说减少开销很重要吗？

不可以。调整矢量的大小暂时需要*更多*内存，因此如果您的内存有限，则可能会破坏您的应用程序。（您必须先将原始向量*和*临时向量保存在内存中，然后才能交换它们，因此您最终会使用最多两倍的 RAM）。之后，您可能会节省少量内存（最多几 MB），但这没关系，因为向量中的多余容量永远不会被访问，所以它会被推送到页面文件，所以不会首先计入您的 RAM 限制。

如果您有 1000000 个项目，那么您应该*首先*将向量初始化为正确的大小。

如果你不能做到这一点，那么你通常最好不要管这个容量。特别是由于您声明要重新填充向量，因此您绝对应该重用已经分配的容量，而不是不断地分配、重新分配、复制和释放所有内容。

你有两种可能的情况。您要么知道需要存储多少元素，要么不知道。如果您知道，那么您可以首先创建具有正确大小的向量，因此您永远不需要调整它的大小，或者您不知道，然后您还不如保留多余的容量，所以至少它重新填充矢量时不必向上调整大小。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-25T23:51:50.897

[你可以从这里](http://www.gamedev.net/community/forums/topic.asp?topic_id=397748)尝试这种技术

```
std::vector< int > v;
// ... fill v with stuff...
std::vector< int >().swap( v ); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-25T23:52:23.110

您可以`swap`使用具有所需容量的新向量。

```
vector< int > tmp;
old.swap( tmp ); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-25T23:53:12.233

据我所知，您不能将向量重新分配到比以往更低的容量。你只能分配更大的。这有充分的理由；其中之一是重新分配过程的计算量非常大。如果您真的需要更小的向量，请释放旧向量并创建一个更小的新向量。这实际上在计算上比让向量实际调整更小要简单得多。

# objective-c - 在发送发布消息之前检查是否为 nil 是一种好习惯吗？

> ID：319294
> 
> 赞同：9
> 
> 时间：2008-11-25T23:48:27.610
> 
> 标签：objective-c

当释放一个可能存在或不存在的实例时，我通常会这样写：

if (object != nil) [对象释放];

但是既然向 nil 发送消息不是问题，那是有条件的吗？

我想问题归结为：哪个使用更多开销，将对象与 nil 进行比较，或发送 nil 消息？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-25T23:53:17.023

请参阅[此页面](http://developer.apple.com/documentation/MacOSX/Conceptual/universal_binary/universal_binary_tips/chapter_5_section_22.html)，该页面解释了将消息传递给 nil （以概括您的示例）非常好。

至于什么有更多的开销，任何性能影响对系统的整体性能都可以忽略不计（不要养成过早优化的习惯）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-27T00:04:56.220

当我编写比 Obj-C 更多的 C++ 代码时，我总是会编写代码来检查`nil`- 因为这是对我自己的一个说明，允许这个指针是`nil`. 现在，我让它`objc_msgSend`来处理它，因为我已经习惯于阅读代码并假设任何指针都可以有效地是`nil`.

在“安全编码”级别上，我认为`nil`在每次发布后始终将指针设置为更重要（可能`release`在`dealloc`方法中排除 a ）。这样，您可以确保您的指针永远不会无效（它要么是有效的，要么是`nil`）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-25T23:52:24.263

该检查是不必要的。除非您对此代码进行大量迭代（10,000 秒，也许更多），否则时间差异是微不足道的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-27T00:19:40.637

Obj-C 检查`nil`，所以没有必要做两次。

```
[object release]; object = nil; 
```

如果你想在那里添加一些额外的代码，最好在之后设置指针*，* `nil`这样它就不会受到双重释放的影响。

# c++ - 用于为 Linux 开发 C++ MySQL 应用程序的资源

> ID：319297
> 
> 赞同：1
> 
> 时间：2008-11-25T23:50:02.600
> 
> 标签：c++, mysql, linux

我将开发一个使用 MySQL 数据库的 C++ 应用程序。

我使用 JDBC 以及 Spring 框架在 Java 中编写了类似的应用程序。

是否有 C++ 的等效库？你最成功的事情是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-07T08:05:17.753

我会使用 MySQL C API，它是最简单的解决方案。您可以轻松编写一个类来包装 C api 以供您自己使用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-28T15:15:32.297

我发现[QtSql](http://doc.trolltech.com/4.4/qtsql.html)易于使用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-28T08:11:08.797

我很喜欢使用[SQLAPI++](http://www.sqlapi.com/)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T01:15:01.167

看起来使用[MySQL C API](http://dev.mysql.com/doc/refman/5.0/en/c.html)编写数据访问层将是最好的选择。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-07T08:00:28.577

MySQL Connector/C++ 是 JDBC 4.0 的 C++ 实现

使用 MySQL Connector/C++ 的参考客户有：
- OpenOffice
- MySQL Workbench

[学到更多](http://forums.mysql.com/read.php?167,221298)

# c# - C# - 如何调用添加到项目解决方案中的 exe

> ID：319304
> 
> 赞同：6
> 
> 时间：2008-11-25T23:52:26.323
> 
> 标签：c#, executable

所以我在我的项目解决方案中添加了一个 EXE。EXE 做一些事情并通过标准输出输出数据。我想捕获输出，但更重要的是如何在我的程序中执行该 EXE？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-25T23:55:13.213

```
Process p = new Process();
p.StartInfo.UseShellExecute = false;
p.StartInfo.RedirectStandardOutput = true;
p.StartInfo.FileName = "myExec.exe";
p.Start(); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-25T23:54:16.053

[`Process.Start`](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.start.aspx). 要捕获标准输出，您需要通过重定向它- [MSDN](http://msdn.microsoft.com/en-us/library/system.diagnostics.processstartinfo.redirectstandardoutput.aspx)`ProcessStartInfo`上有一个示例。还要确保将 exe 标记为复制到输出目录（bin/release 等）。

如果您需要从 stdout 和 stderr 读取它会变得很棘手（使用幼稚的实现存在由于缓冲等而导致死锁的风险）......[这是](https://stackoverflow.com/questions/258339/pconsolestartinforedirectstandardoutput-and-pconsoleexited-event-c#258387)一个使用工作线程的示例。

# cmd - 为什么 Windows cmd.exe 限制为 80 个字符宽？

> ID：319305
> 
> 赞同：107
> 
> 时间：2008-11-25T23:52:41.907
> 
> 标签：cmd

我喜欢在 unix 上扩展我的终端。windows lame命令行背后的历史或原因是什么？

* * *

## 回答 #1

> 赞同：148
> 
> 时间：2008-11-25T23:55:43.760

它不是。您可以右键单击标题栏，选择属性，然后在“布局”选项卡中更改屏幕缓冲区大小（线宽和回滚）和窗口大小（视口大小）。如果您从快捷方式启动 cmd，则可以保存这些设置以备将来使用。

* * *

## 回答 #2

> 赞同：110
> 
> 时间：2008-12-17T18:17:11.033

如果你害怕鼠标，你也可以在 cmd 窗口中输入：

```
mode <cols>,<lines>
mode 80,25
mode 120,50
etc. 
```

* * *

## 回答 #3

> 赞同：44
> 
> 时间：2008-11-25T23:57:09.340

它不受限制。

1.  运行 cmd.exe
2.  单击屏幕左上角的图标。
3.  选择属性
4.  选择布局选项卡。
5.  将缓冲区和窗口宽度设置为您喜欢的任何值。
6.  点击确定
7.  选择保存属性以供将来使用...
8.  单击确定。

您可能想查看[Console](http://sourceforge.net/projects/console/)。它是一个开源应用程序，可让您在选项卡式环境中运行多个 shell。您还可以设置外壳的 alpha 透明度。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2009-06-30T18:49:05.357

RE：因为 MS 在很多事情上都重视“向后兼容性”，在这种情况下，我怀疑这是一个错误的信念，即如果人们没有标准的 80 宽窗口，它会以某种方式不安。

不过，向后兼容性非常糟糕。我不认为微软对他们的实施非常彻底，我相信微软是确保新版本不能在旧版本上运行的海报男孩。在 COMMAND.COM 下很多东西都不能正常工作，这大大破坏了它所拥有的实用性，更不用说你必须输入 DOSONLY 才能使某些程序正常运行，而且微软一直在删除有用的命令。老实说，我无法想象微软非常重视“向后兼容性”。

此外，我认为行长以 80 列为标准的真正原因是因为大多数命令行程序等在假设用户被限制在 80 列提示符下运行，这意味着增加宽度会导致格式错误或更糟糕的情况可能会完全破坏程序。

正如 jmucchiello 所提到的，如果您愿意，MODE 可以很好地调整窗口大小。

```
配置系统设备。

串口：MODE COMm[:] [BAUD=b] [PARITY=p] [DATA=d] [STOP=s]
                                [to=on|off] [xon=on|off] [odsr=on|off]
                                [octs=on|off] [dtr=on|off|hs]
                                [rts=on|off|hs|tg] [idsr=on|off]

设备状态：MODE [设备] [/STATUS]

重定向打印：MODE LPTn[:]=COMm[:]

选择代码页：MODE CON[:] CP SELECT=yyy

代码页状态：MODE CON[:] CP [/STATUS]

显示模式：MODE CON[:] [COLS=c] [LINES=n]

打字速度：MODE CON[:] [RATE=r DELAY=d]
```

但是，如果您在 CONFIG.NT 上启用了 DOSONLY，那么当您打开 COMMAND.COM 时，它将从 cmd.exe 继承正确的 DOS 样式的行分辨率，但您不能从 COMMAND.COM 内部调用 MODE。如果您希望在 COMMAND.COM 中调整大小，则必须使用 16 位汇编指令，如下所示：

**80x50 线分辨率**（无帧缓冲区，无 SVGA，几乎普遍支持。）

```
调试
A100
MOV AX,1112
智力 10
智力 20

G
问
```

**132x60 线分辨率**（无帧缓冲，需要 SVGA。不适用于 ATI gfx 卡，通常适用于 nVidia gfx 卡，afaict 始终适用于 Intel 集成 gfx 卡。）

```
调试
A100
MOV AX,4F02
MOV BX,010C
智力 10
智力 20G
问
```

如果您在 COMMAND.COM 上输入此内容，它将为您提供指定的分辨率。（警告：如果您的显示器足够古老，不支持该模式，您可能会毁掉它。旁注：如果您可以运行 Windows，您的显示器应该没问题。免责声明：强调应该，并且您已被警告，所以如果您的显示器出现故障，这不是我的问题。;-) 但是，如果您在未启用 DOSONLY 的情况下使用它，COMMAND.COM 将在应用程序后立即调整回原来的大小（在这种情况下，除非您将其写入文件并执行，DEBUG) 退出。

或者，您可以使用 FreeDOS 的 MODE.COM，它将在 COMMAND.COM 设置为 DOSONLY 下正常运行。您可以从官方网站 (freedos.org) 的磁盘映像中拉取它，也可以在[http://www.ibiblio.org/pub/micro/pc-stuff/freedos/files/dos/mode/2005/](http://www.ibiblio.org/pub/micro/pc-stuff/freedos/files/dos/mode/2005/)。

```
Eric Auer 2003-2005 的新 FreeDOS 模式。许可证：GPL。（2005 年 5 月 12 日版本）
MODE [device] [/STA[TUS]]（显示一个或所有设备的状态）
MODE LPTn[:] cols[,[lines][,retry]] (cols or cpi, 6/8 lpi, retry p or n)
MODE LPTn[:] [COLS=...] [LINES=...] [RETRY=...] （重试：p 无限/n 无）
MODE LPTn[:]=[COMn[:]|NUL]（将打印机数据重定向到串口或NUL）
MODE COMn[:] 波特、奇偶校验、数据、停止、重试（允许为空值）
MODE COMn[:] [BAUD[HARD]=...] [PARITY=...] [DATA=...] [STOP=...] [RETRY=...]
  波特可以缩写为唯一前缀，奇偶校验可以是o/e/n/s/m，
  后 2 平均空间/标记，数据可以是 5..8，停止 1..2。重试被忽略！
  计划：重试 b/e/r -> 忙/错误/如果忙则准备好，p/n 无限/不重试。
MODE CON[:] [CP|CODEPAGE] [/STA[TUS]]（必须加载 FreeDOS DISPLAY）
MODE CON[:] [CP|CODEPAGE] REF[RESH]（需要显示）
MODE CON[:] [CP|CODEPAGE] SEL[ECT]=number（需要显示）
MODE CON[:] [CP|CODEPAGE] PREP[ARE]=((codepage) 文件名) (需要显示)
  使用 PREP=((,cp2,cp3,,cp5) ...) 在其他缓冲区中准备代码页。
MODE [40|80|BW40|BW80|CO40|CO80|MONO][,rows]（行可以是 25、28、43 或 50）
  如果您只想更改字体，请使用 8、14 或 16 作为“行”值。
MODE [CO40|CO80|...],[R|L][,T]（CGA左/右移位，T为交互模式）
模式 CON[:] [NUMLOCK|CAPSLOCK|SCROLLLOCK|SWITCHAR]=值
  值可以是：+ 或 - 用于锁或用于 switchar 的字符。
MODE CON[:] [COLS=...] [LINES=...]（可能的值取决于您的硬件）
MODE CON[:] [RATE=...] [DELAY=...]（默认速率 20，默认延迟 1）
  速率可以是 1..32 表示 2..30 字符/秒，延迟可以是 1..4 表示 1/4..4/4 秒。
```

出于与我提供的 ASM 代码相同的原因，除非您在 COMMAND.COM 中执行它并将 DOSONLY 添加到您的 CONFIG.NT 文件中，否则一旦 MODE.COM 退出，窗口将立即恢复到以前的大小。

最后，正如其他人所说，也可以通过右键单击命令提示符的标题栏并修改属性 -> 布局来修改这些设置。同样，您可以为 CMD.EXE 和批处理文件的任何快捷方式设置分辨率（右键单击快捷方式 -> 属性 -> 布局）。这仅适用于 CMD.EXE，但不适用于 COMMAND.COM。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2016-02-09T21:30:50.133

一个简单的命令来修复我一直使用的窗口大小：

```
wmic 
```

它将打开 Windows Management Instrumentation 命令行并删除大小限制。然后用`Ctrl`+关闭它`C`。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-11-26T00:01:00.347

我不知道它背后的历史，但是 PuTTy 的作者的这个愿望清单项目是一篇有趣的帖子，它解释了任何类型的 cmd.exe 替代品所涉及的技术障碍：

[http://www.chiark.greenend.org.uk/~sgtatham/putty/wishlist/win-command-prompt.html](http://www.chiark.greenend.org.uk/~sgtatham/putty/wishlist/win-command-prompt.html)

您没有提到您正在寻找替代品，但如果是这样，您还可以查看一些 cmd.exe 替代品，例如[Console 2](http://sourceforge.net/projects/console/)或 JP Software 的 Take Command 等。我在 PuTTy 方面也有一些很好的经验- Cyg 可让您将 PuTTy 用作 cygwin shell。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-11-26T00:01:25.730

虽然宽度不受其他答案所示的限制，但我一直觉得很奇怪，可以用鼠标拖动和调整*高度*，但不能调整*宽度*。

我认为默认的 80 个字符宽度与假设终端不会超过 80 个字符宽的旧程序的兼容性有关。不过，我不认为这是十年左右的现实原因。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-11-26T00:10:50.653

正如其他人指出的那样，它不限于 80 个字符宽，但我猜测它为什么默认为 80 个字符是因为它是 DOS 时代遗留下来的，当时 CRT 显示器的宽度是 80 个字符。

[也可以看看](http://en.wikipedia.org/wiki/Text_mode)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-06-30T20:22:14.793

您还可以使用不同的终端应用程序，例如[Console2](http://sourceforge.net/projects/console/)，它允许您根据需要调整窗口大小（除其他事项外，例如透明度，以及使用您喜欢的任何字体的能力）。这是一个很棒的应用程序，我已经切换到它，现在我只`cmd.exe`在绝对需要时使用。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-17T18:07:02.253

它是有限的。一探究竟。（我的意思是窗口大小不是缓冲区）

您会发现您可以设置的最大宽度是有限的，但会根据您的屏幕分辨率而有所不同。如果您的分辨率设置为 1024 x 768，您会发现在命令提示符宽度上只能达到 128。128/1024=.125

你会发现这个比率是一致的。我有一个以 2000x768 运行的 RDP 会话（在我的三台显示器中的两台上），最大宽度为 250。

现在，事实证明它比您的实际显示器尺寸大一点，但我有三台显示器都运行单独的桌面。（所以本质上是 3 个 1024x768 分辨率），如果我想做一些简单的事情，比如在 2 个或更多显示器上拉伸命令提示符，我做不到。（我想用很长的路径做事（diruse.exe/etc.）......

-C

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-26T00:00:54.280

因为它会从左到右以及上下滚动，所以我在系统上做的第一件事就是将我的宽度定义为 180 并保存它。这通常足以使堆栈跟踪不必在大多数情况下进行包装，但也不必太多以至于您要占用大量空间。

当您使用它时，将垂直大小（回滚缓冲区）设置为全 9。你会很高兴有一天你做到了。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-26T00:10:27.973

因为 MS 在很多事情上都重视“向后兼容性”，在这种情况下，我怀疑这是一个错误的信念，即如果人们没有标准的 80 宽窗口，它会以某种方式让他们感到不安。

当然，这可能是它被编程为固定的 80 个字符宽度，而这几乎是通用的，而且附加的属性设置有点小题大做。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2020-01-11T18:01:48.693

这不是关闭的。所以应该注意的是，Windows Terminal 现在正在改变这一切：

[https://github.com/microsoft/terminal](https://github.com/microsoft/terminal) [https://www.theverge.com/2020/1/9/21059316/microsoft-windows-terminal-crt-effects-retro-search-tabs-features](https://www.theverge.com/2020/1/9/21059316/microsoft-windows-terminal-crt-effects-retro-search-tabs-features) [https:// devblogs.microsoft.com/commandline/windows-command-line-backgrounder/](https://devblogs.microsoft.com/commandline/windows-command-line-backgrounder/) [https://github.com/microsoft/terminal/blob/master/doc/terminal-v1-roadmap.md](https://github.com/microsoft/terminal/blob/master/doc/terminal-v1-roadmap.md) [https://www.microsoft.com /en-us/p/windows-terminal-preview/9n0dx20hk701?activetab=pivot:overviewtab](https://www.microsoft.com/en-us/p/windows-terminal-preview/9n0dx20hk701?activetab=pivot:overviewtab)

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2012-07-01T21:41:20.900

因为改进类 Unix/GNU 开发所需的任何东西的可用性和功能将破坏 Windows 作为微软合作伙伴的商业平台。防止这种情况意味着其他大公司的开发人员产品，例如改进的终端，以及其他一般的第三方产品，例如文字处理器、视频播放器等，不会与现有的 Unix/GNU 软件竞争。没有这个，Windows 就不会成为一个有利可图的平台，微软也将失去其桌面垄断地位。

这就是终端很糟糕的原因，没有 POSIX API，MSVC 中没有 C99 支持，而且名单还在继续。澄清一下，故意不支持常见的 Unix/GNU 技术和开发，以便大型商业软件公司不必与它们竞争。

# java - 数组中有多少维没有值

> ID：319320
> 
> 赞同：0
> 
> 时间：2008-11-26T00:01:14.230
> 
> 标签：java, arrays

我有点迷路（仍在使用 Ron Jeffries 的书）。这是一个简单的类：

```
public class Model{
    private String[] lines;

    public void myMethod(){
        String[] newLines = new String[lines.length + 2];
        for (i = 0, i <= lines.length, i++) {
            newLines[i] = lines[i];
        }
    }
} 
```

我有另一个`Model`通过设置初始化的类和一个空数组`myModel = new String[0]`。当我调用 时`myModel.myMethod()`，我得到一个下标超出范围的错误。查看调试器，我看到它的`myModel.lines`维度为零，长度为零。它的尺寸和长度不应该为1吗？授予 is 的值`lines[0]`，`null`但数组本身不应该是，不是吗？

任何想法都非常感谢。

兰迪

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T00:03:34.490

lines 将为空，因此lines.length 将引发异常。

我相信您初始化“模型”的其他类将无济于事，因为 Lines 本身是私有的。事实上，无论你对 Model 做什么，在至少 30 个州都可能是非法的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T00:04:52.740

行被初始化为`null`，检查null或以这种方式初始化它：

```
private String[] lines = new String[0]; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T00:16:53.747

您不能通过将 Model 实例设置为 String 数组来初始化它。我真的很惊讶编译器会让你尝试。

如果您真的希望 Model 可以使用外部数组进行初始化，您应该为 Model 类创建一个**构造函数**，它将数组作为参数。然后在构造函数的主体中，将行的值设置为该值。

例子：

```
public class Model {
    private String []lines;

    public Model(String [] inLines)
       {
       lines = inLines;
       }
} 
```

用法：

```
myStringArray = new String[0];
myModel = new Model(myStringArray); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-26T00:23:50.877

根据您的描述，我认为您的示例可能与您的实际代码不同。我认为问题在于数组是从零开始的，因此数组初始化为：

字符串 [] 行 = 新字符串 [0]；

没有元素。

您需要更改循环，以便检查索引是否严格小于数组的长度。正如其他人所指出的，您还需要确保数组本身不为空，然后再尝试引用它。

我对您的代码的看法：

```
public class Model{
    private String[] lines = new string[0];

    public Model( string[] lines ) {
        this.lines = lines;
    }

    public void myMethod(){
        int len = 2;
        if (lines != null) {
            len = len + lines.length;
        }
        String[] newLines = new String[len];
        for (i = 0, i < lines.length, i++) {
            newLines[i] = lines[i];
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T01:04:06.180

看看我[在这里](https://stackoverflow.com/questions/242079/is-there-an-expandable-list-of-object-references-in-java#242093)的回答——我认为这会让你了解你正在寻找的关于 Java 和 C/C++ 中数组初始化之间差异的背景。

# iphone - 是否有访问 iTunesConnect 销售报告的编程方式？

> ID：319322
> 
> 赞同：4
> 
> 时间：2008-11-26T00:01:42.857
> 
> 标签：iphone, app-store-connect

我在 iTunes 商店有一个应用程序，Apple 提供每日（和每周）销售报告。我想以自动方式下载这些（例如，通过附加到 cron 作业的脚本），但我不确定如何绕过它们的所有 https 表单、Web 对象控件、会话 ID 等。

有没有人为此提供即插即用解决方案？

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-26T00:19:45.067

开发论坛中有一个关于此的主题：https://devforums.apple.com/thread/1253?start=0&tstart=0'>Sales Reports Script

链接：[https ://devforums.apple.com/thread/1253?start=0&tstart=0](https://devforums.apple.com/thread/1253?start=0&tstart=0)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-24T23:02:51.620

我真的很喜欢 AppSales，这是一款开源的 iPhone 应用程序，它会抓取 iTunes Connect 网站，并为您提供每日和每周报告、图表等。它是开源的，因此您可以根据需要对其进行扩展。

[http://github.com/omz/AppSales-Mobile](http://github.com/omz/AppSales-Mobile)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-29T13:01:58.407

没有 API 但你不能“刮”它，网上有各种开源脚本。

相反，尽管您可以使用[www.appfigures.com](http://www.appfigures.com)自动下载报告，将它们转换为交互式销售/下载报告并自动通过电子邮件发送解析报告，并显示您在全球所有 77 个应用商店的评论，并从 6 个主要应用程序中排名趋势应用商店。

出于安全原因，我会在注册时使用子 iTC 帐户。

而且它完全免费（在测试版中）

# c - 如何用 C 预处理器编写一个 while 循环？

> ID：319328
> 
> 赞同：72
> 
> 时间：2008-11-26T00:05:29.620
> 
> 标签：c, while-loop, c-preprocessor

我从教育/黑客的角度问这个问题，（我真的不想这样编码）。

**是否可以仅使用C**预处理器指令实现 while 循环。我知道宏不能递归扩展，那么这将如何实现？

* * *

## 回答 #1

> 赞同：133
> 
> 时间：2012-05-10T22:02:11.393

如果要实现 while 循环，则需要在预处理器中使用递归。进行递归的最简单方法是使用延迟表达式。延迟表达式是需要更多扫描才能完全展开的表达式：

```
#define EMPTY()
#define DEFER(id) id EMPTY()
#define OBSTRUCT(id) id DEFER(EMPTY)()
#define EXPAND(...) __VA_ARGS__

#define A() 123
A() // Expands to 123
DEFER(A)() // Expands to A () because it requires one more scan to fully expand
EXPAND(DEFER(A)()) // Expands to 123, because the EXPAND macro forces another scan 
```

为什么这很重要？那么当一个宏被扫描和扩展时，它会创建一个禁用上下文。此禁用上下文将导致引用当前扩展宏的标记被涂成蓝色。因此，一旦将其涂成蓝色，宏将不再展开。这就是宏不递归扩展的原因。但是，禁用上下文仅在一次扫描期间存在，因此通过推迟扩展，我们可以防止宏被涂成蓝色。我们只需要对表达式应用更多扫描。我们可以使用这个`EVAL`宏来做到这一点：

```
#define EVAL(...)  EVAL1(EVAL1(EVAL1(__VA_ARGS__)))
#define EVAL1(...) EVAL2(EVAL2(EVAL2(__VA_ARGS__)))
#define EVAL2(...) EVAL3(EVAL3(EVAL3(__VA_ARGS__)))
#define EVAL3(...) EVAL4(EVAL4(EVAL4(__VA_ARGS__)))
#define EVAL4(...) EVAL5(EVAL5(EVAL5(__VA_ARGS__)))
#define EVAL5(...) __VA_ARGS__ 
```

接下来，我们定义一些操作符来做一些逻辑（比如 if 等）：

```
#define CAT(a, ...) PRIMITIVE_CAT(a, __VA_ARGS__)
#define PRIMITIVE_CAT(a, ...) a ## __VA_ARGS__

#define CHECK_N(x, n, ...) n
#define CHECK(...) CHECK_N(__VA_ARGS__, 0,)

#define NOT(x) CHECK(PRIMITIVE_CAT(NOT_, x))
#define NOT_0 ~, 1,

#define COMPL(b) PRIMITIVE_CAT(COMPL_, b)
#define COMPL_0 1
#define COMPL_1 0

#define BOOL(x) COMPL(NOT(x))

#define IIF(c) PRIMITIVE_CAT(IIF_, c)
#define IIF_0(t, ...) __VA_ARGS__
#define IIF_1(t, ...) t

#define IF(c) IIF(BOOL(c)) 
```

现在有了所有这些宏，我们可以编写一个递归`WHILE`宏。我们使用`WHILE_INDIRECT`宏递归地引用自身。这可以防止宏被涂成蓝色，因为它会在不同的扫描中展开（并使用不同的禁用上下文）。该`WHILE`宏接受一个谓词宏、一个运算符宏和一个状态（它是可变参数）。它一直将此运算符宏应用于状态，直到谓词宏返回 false（即 0）。

```
#define WHILE(pred, op, ...) \
    IF(pred(__VA_ARGS__)) \
    ( \
        OBSTRUCT(WHILE_INDIRECT) () \
        ( \
            pred, op, op(__VA_ARGS__) \
        ), \
        __VA_ARGS__ \
    )
#define WHILE_INDIRECT() WHILE 
```

出于演示目的，我们将创建一个谓词来检查参数数量何时为 1：

```
#define NARGS_SEQ(_1,_2,_3,_4,_5,_6,_7,_8,N,...) N
#define NARGS(...) NARGS_SEQ(__VA_ARGS__, 8, 7, 6, 5, 4, 3, 2, 1)

#define IS_1(x) CHECK(PRIMITIVE_CAT(IS_1_, x))
#define IS_1_1 ~, 1,

#define PRED(x, ...) COMPL(IS_1(NARGS(__VA_ARGS__))) 
```

接下来我们创建一个运算符，我们将只连接两个标记。我们还创建了一个最终操作符（称为`M`）来处理最终输出：

```
#define OP(x, y, ...) CAT(x, y), __VA_ARGS__ 
#define M(...) CAT(__VA_ARGS__) 
```

然后使用`WHILE`宏：

```
M(EVAL(WHILE(PRED, OP, x, y, z))) //Expands to xyz 
```

当然，任何类型的谓词或运算符都可以传递给它。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-26T00:26:10.267

查看[Boost 预处理器](http://www.boost.org/doc/libs/1_37_0/libs/preprocessor/doc/index.html)库，它允许您在预处理器中编写循环等等。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-11-26T00:06:30.133

您使用递归包含文件。不幸的是，循环的迭代次数不能超过预处理器允许的最大深度。

事实证明，C++ 模板是图灵完备的，并且可以以类似的方式使用。查看[*生成式编程*](http://gsd.uwaterloo.ca/)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-26T01:28:50.810

我为此目的使用元模板编程，一旦你掌握了它就会很有趣。有时在谨慎使用时非常有用。因为如前所述，它的图灵完备，甚至可以导致编译器进入无限循环或堆栈溢出！没有什么比去喝杯咖啡更能发现你的编译正在使用 30+ GB 的内存和所有的 CPU 来编译你的无限循环代码！

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2011-12-29T08:33:16.697

好吧，不是一个while循环，而是一个计数器循环，尽管如此循环在干净的CPP中是可能的（没有模板也没有C++）

```
#ifdef pad_always

#define pad(p,f) p##0

#else

#define pad0(p,not_used) p
#define pad1(p,not_used) p##0

#define pad(p,f) pad##f(p,)

#endif

// f - padding flag
// p - prefix so far
// a,b,c - digits
// x - action to invoke

#define n0(p,x)
#define n1(p,x)         x(p##1)
#define n2(p,x) n1(p,x) x(p##2)
#define n3(p,x) n2(p,x) x(p##3)
#define n4(p,x) n3(p,x) x(p##4)
#define n5(p,x) n4(p,x) x(p##5)
#define n6(p,x) n5(p,x) x(p##6)
#define n7(p,x) n6(p,x) x(p##7)
#define n8(p,x) n7(p,x) x(p##8)
#define n9(p,x) n8(p,x) x(p##9)

#define n00(f,p,a,x)                       n##a(pad(p,f),x)
#define n10(f,p,a,x) n00(f,p,9,x) x(p##10) n##a(p##1,x)
#define n20(f,p,a,x) n10(f,p,9,x) x(p##20) n##a(p##2,x)
#define n30(f,p,a,x) n20(f,p,9,x) x(p##30) n##a(p##3,x)
#define n40(f,p,a,x) n30(f,p,9,x) x(p##40) n##a(p##4,x)
#define n50(f,p,a,x) n40(f,p,9,x) x(p##50) n##a(p##5,x)
#define n60(f,p,a,x) n50(f,p,9,x) x(p##60) n##a(p##6,x)
#define n70(f,p,a,x) n60(f,p,9,x) x(p##70) n##a(p##7,x)
#define n80(f,p,a,x) n70(f,p,9,x) x(p##80) n##a(p##8,x)
#define n90(f,p,a,x) n80(f,p,9,x) x(p##90) n##a(p##9,x)

#define n000(f,p,a,b,x)                           n##a##0(f,pad(p,f),b,x)
#define n100(f,p,a,b,x) n000(f,p,9,9,x) x(p##100) n##a##0(1,p##1,b,x)
#define n200(f,p,a,b,x) n100(f,p,9,9,x) x(p##200) n##a##0(1,p##2,b,x)
#define n300(f,p,a,b,x) n200(f,p,9,9,x) x(p##300) n##a##0(1,p##3,b,x)
#define n400(f,p,a,b,x) n300(f,p,9,9,x) x(p##400) n##a##0(1,p##4,b,x)
#define n500(f,p,a,b,x) n400(f,p,9,9,x) x(p##500) n##a##0(1,p##5,b,x)
#define n600(f,p,a,b,x) n500(f,p,9,9,x) x(p##600) n##a##0(1,p##6,b,x)
#define n700(f,p,a,b,x) n600(f,p,9,9,x) x(p##700) n##a##0(1,p##7,b,x)
#define n800(f,p,a,b,x) n700(f,p,9,9,x) x(p##800) n##a##0(1,p##8,b,x)
#define n900(f,p,a,b,x) n800(f,p,9,9,x) x(p##900) n##a##0(1,p##9,b,x)

#define n0000(f,p,a,b,c,x)                               n##a##00(f,pad(p,f),b,c,x)
#define n1000(f,p,a,b,c,x) n0000(f,p,9,9,9,x) x(p##1000) n##a##00(1,p##1,b,c,x)
#define n2000(f,p,a,b,c,x) n1000(f,p,9,9,9,x) x(p##2000) n##a##00(1,p##2,b,c,x)
#define n3000(f,p,a,b,c,x) n2000(f,p,9,9,9,x) x(p##3000) n##a##00(1,p##3,b,c,x)
#define n4000(f,p,a,b,c,x) n3000(f,p,9,9,9,x) x(p##4000) n##a##00(1,p##4,b,c,x)
#define n5000(f,p,a,b,c,x) n4000(f,p,9,9,9,x) x(p##5000) n##a##00(1,p##5,b,c,x)
#define n6000(f,p,a,b,c,x) n5000(f,p,9,9,9,x) x(p##6000) n##a##00(1,p##6,b,c,x)
#define n7000(f,p,a,b,c,x) n6000(f,p,9,9,9,x) x(p##7000) n##a##00(1,p##7,b,c,x)
#define n8000(f,p,a,b,c,x) n7000(f,p,9,9,9,x) x(p##8000) n##a##00(1,p##8,b,c,x)
#define n9000(f,p,a,b,c,x) n8000(f,p,9,9,9,x) x(p##9000) n##a##00(1,p##9,b,c,x)

#define n00000(f,p,a,b,c,d,x)                                   n##a##000(f,pad(p,f),b,c,d,x)
#define n10000(f,p,a,b,c,d,x) n00000(f,p,9,9,9,9,x) x(p##10000) n##a##000(1,p##1,b,c,d,x)
#define n20000(f,p,a,b,c,d,x) n10000(f,p,9,9,9,9,x) x(p##20000) n##a##000(1,p##2,b,c,d,x)
#define n30000(f,p,a,b,c,d,x) n20000(f,p,9,9,9,9,x) x(p##30000) n##a##000(1,p##3,b,c,d,x)
#define n40000(f,p,a,b,c,d,x) n30000(f,p,9,9,9,9,x) x(p##40000) n##a##000(1,p##4,b,c,d,x)
#define n50000(f,p,a,b,c,d,x) n40000(f,p,9,9,9,9,x) x(p##50000) n##a##000(1,p##5,b,c,d,x)
#define n60000(f,p,a,b,c,d,x) n50000(f,p,9,9,9,9,x) x(p##60000) n##a##000(1,p##6,b,c,d,x)
#define n70000(f,p,a,b,c,d,x) n60000(f,p,9,9,9,9,x) x(p##70000) n##a##000(1,p##7,b,c,d,x)
#define n80000(f,p,a,b,c,d,x) n70000(f,p,9,9,9,9,x) x(p##80000) n##a##000(1,p##8,b,c,d,x)
#define n90000(f,p,a,b,c,d,x) n80000(f,p,9,9,9,9,x) x(p##90000) n##a##000(1,p##9,b,c,d,x)

#define cycle5(c1,c2,c3,c4,c5,x) n##c1##0000(0,,c2,c3,c4,c5,x)
#define cycle4(c1,c2,c3,c4,x) n##c1##000(0,,c2,c3,c4,x)
#define cycle3(c1,c2,c3,x) n##c1##00(0,,c2,c3,x)
#define cycle2(c1,c2,x) n##c1##0(0,,c2,x)
#define cycle1(c1,x) n##c1(,x)

#define concat(a,b,c) a##b##c

#define ck(arg) a[concat(,arg,-1)]++;
#define SIZEOF(x) (sizeof(x) / sizeof((x)[0]))

void check5(void)
{
    int i, a[32769];

    for (i = 0; i < SIZEOF(a); i++) a[i]=0;

    cycle5(3,2,7,6,9,ck);

    for (i = 0; i < SIZEOF(a); i++) if (a[i] != 1) printf("5: [%d] = %d\n", i+1, a[i]);
} 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-11-26T00:17:06.960

这是对可以合法完成的规则​​的滥用。编写自己的 C 预处理器。让它以你想要的方式解释一些#pragma 指令。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-02-01T04:45:39.780

当编译器变得暴躁并且不会为我展开某些循环时，我发现这个方案很有用

> #define REPEAT20(x) { x;x;x;x;x;x;x;x;x;x;x;x;x;x;x;x;x;x;x;x;}
> 
> REPEAT20( val = pleaseconverge(val) );

但是恕我直言，如果您需要比这更复杂的东西，那么您应该编写自己的预处理器。例如，您的预处理器可以为您生成适当的头文件，并且很容易将此步骤包含在 Makefile 中，以便通过单个命令顺利编译所有内容。我已经做到了。

# windows - 保存来自 MS 崩溃报告者的信息？

> ID：319334
> 
> 赞同：0
> 
> 时间：2008-11-26T00:08:55.183
> 
> 标签：windows, windows-xp, windows-error-reporting

在 Windows XP 上，当进程崩溃时，我们会看到一个带有链接的对话框：

“要查看有关错误报告的技术信息，请单击此处。”

“单击此处”链接在窗口中显示了大量信息，但没有明显的方法将其保存到文件中。有办法吗？如果能够将这些数据发送给我们正在合作的几个不同的外部供应商，那就太好了。

我在对话框中看到的唯一其他选项是将其发送给 Microsoft，但这次崩溃可能不是 Microsoft 的错，没有理由将其发送给他们。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T03:24:37.270

如果您是一家公司，您可以向 Microsoft 注册以便能够下载 WER 报告。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-24T15:53:41.797

当您看到此对话框时，您应该仍然能够手动将调试器（例如 Visual Studio）附加到崩溃进程并查看任何可用的异常记录。或者，我相信您应该能够注册 Visual Studio 来处理这些崩溃，而不是使用正常的错误报告机制。本文似乎包含有关该选项的更多信息：

[http://msdn.microsoft.com/en-us/library/5hs4b7a6.aspx](http://msdn.microsoft.com/en-us/library/5hs4b7a6.aspx)

希望这可以帮助...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-04-11T06:05:56.760

'08 的问题可能有点晚了，但无论如何，你可以使用[错误报告抓取](http://www.maxerist.net/main/soft-for-win/err-rep-grabber)软件来完成这个任务

# c# - 你有自己的 'utils' dll 吗？你在那里保留什么？

> ID：319339
> 
> 赞同：3
> 
> 时间：2008-11-26T00:11:27.313
> 
> 标签：c#, .net, dll

我可以从我自己的 .NET dll 开始。我有一个我在所有网络项目（大约 10 个）中使用的 dll，并且我有用于 FTP、zip、imageresizing、extensionmethods 和通用单例类的 util 类。

我认为这是一种常见的做法，我只是觉得听听人们在他们的“Utils”dll中放了什么会很有趣

编辑：你有哪些小代码宝石，用更少的代码让你更有效率？

在放入数据库之前解析可为空的表单输入时，这些扩展方法对我非常有用

```
 public static int? ToInt(this string input) 
        {
            int val;
            if (int.TryParse(input, out val))
                return val;
            return null;
        }

        public static DateTime? ToDate(this string input)
        {
            DateTime val;
            if (DateTime.TryParse(input, out val))
                return val;
            return null;
        }

        public static decimal? ToDecimal(this string input)
        {
            decimal val;
            if (decimal.TryParse(input, out val))
                return val;
            return null;
        } 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-26T00:42:47.440

我认为在当前版本的语言之外携带实用程序集弊大于利。

主要原因是随着语言的发展，内置了新的方法和更好的做事方式。通过携带实用程序程序集，您很快就会遇到很多可能暴露安全问题的自重。

一个典型的例子是提升函数列表。快速浏览一下就会发现 .Net（就像大多数其他语言一样）已经覆盖了至少 75% 的代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T00:24:41.000

多年来我一直在收集。这开始是[一组 VBScript 例程](http://codeaholic.blogspot.com/2008/06/vbscript-standardlibraryzip.html)，我已经转换为 VB6。这是一个 COM DLL，所以我几乎可以在几乎任何语言的任何地方使用它。我已经让你免于所有枚举的无聊。

编辑：我原则上同意 Chris Lively 对本节先前帖子的评论。然而，正如我在评论中所说，如果我正在做的工作与 .NET 相关，我肯定会为了我认为最好的东西而折腾我的东西。然而，就我而言，.NET 太容易被反编译（使其成为一种替代开源），我的雇主希望保护他的知识产权。

```
(Autogenerated by TLViewer, © Mark Pryor 2000-2003) 

Library: Std
    P:\other\StdLib\StdLib.dll 
    Description: Std 

coclass Drives

Function DriveType(ByVal sDrv As String) As String

coclass Arrays

Function AAdd(aToThis ,ByVal xAddThis ) As Integer

Function AAdd_PostIncrement(a , ByVal X ) As Variant

Function AAdd_PreIncrement(a , ByVal X ) As Variant

Function AMax(aVec ) As Variant

Function AMin(aVec ) As Variant

Sub DeleteFirst(anArray )

Sub DeleteLast(anArray )

Sub DeleteNth(anArray , ByVal nElement As Long)

Function GenerateRange(nBot As Double, nTop As Double, [nStep As Double = 1]) As Variant

Function GenerateRangeFromString(sRange ) As Variant

Function InArray(sItem , aList ) As Boolean

Function Reverse1DArray(aInput ) As Variant

Function ShowStructure(vToShow ) As String

Function StrInArray(sItem , aList , [bCaseInsens As Boolean = True]) As String

coclass CmdLine

Property AppExeName([BaseOnly As Boolean = False]) As String [Get/o]

Property AppPath As String [Get/o]

Property Argument(ByVal Which As Long) As String [Get/o]

Property Arguments As Long [Get/o]

Property CaseSensitive As Boolean [Get/Let]

Function FlaggedArg(ByVal Flag As String) As String

Function FlagPresent(ByVal Flag As String) As Long

Function FlagPresentFromList(Flags () As Variant) As Boolean

Sub Refresh()

Function ToString() As String

coclass BigString

Sub ClearStr()

Function GetStr([ByVal vJoiner = ]) As String

Function GetStrArray() As Variant

Sub PutStr(ByVal vString )

coclass Config

Sub Define(sKey , sValue )

Property gsFilename As String [Get/Let]

Function List(sFilter ) As String

Function Load(sFile ) As Boolean

Function LoadW(sFile ) As Boolean

Function Recall(sKey ) As Variant

Function RecallElse(sKey , sDefault ) As Variant

Sub Save([sFile = ], [bAsAnsi = False])

Sub SaveW([sFile = ], [bAsAnsi = False])

coclass Collections

Function Add(vData , [sKey ]) As _Variable 

Property AddOnly As Boolean [Get/Let]

Function Count() As Long

Function Exists(vntIndexKey ) As Boolean

Property Item(vntIndexKey ) As _Variable  [Get/o]

Function Items() As Variant

Function Keys() As Variant

Sub Modify(sValue , sKey )

Property NewEnum As stdole.IUnknown  [Get/o]

Sub Remove(vntIndexKey )

coclass Computers

Function ComputerName() As String

Function ExistsFolder(sComputer As String, sDir As String) As Boolean

Function GetComputers(sDomain As String)() As Variant

Function GetDomainComputers(ByVal strDomain As String)() As Variant

Function GetNBT(sComputer As String) As String

Function GetNBTA(sIPAddr As String) As String

Function GetNetView(sDomain As String) As String

Function GetOnlineComputers(sDomain As String)() As Variant

Function GetRemoteEnvironment(sComputer )() As Variant

Function GetSpecs(sComputer As String) As String

Function GetTheComputerName() As String

Function ResolveIP(sName As String) As String

coclass Logic

Function IIF(bCondition As Boolean, vTrue , vFalse ) As Variant

coclass Decimals

Property Dec As Variant [Get/Let]

coclass Domains

Function GetAvailableNTDomains()() As Variant

coclass Database

Sub CreateDatabase(sFile As String)

Sub CreateIndex(ByVal oDb  As ADODB.Connection, sSpec As String)

Sub CreateStructure(ByVal oDb  As ADODB.Connection, sSpec As String)

Function OpenDatabase(theFile As String) As ADODB._Connection 

Function OpenRecordSet(ByVal oDb  As ADODB.Connection, sQuery As String) As ADODB._Recordset 

coclass DateTime

Function dbDate(vDate ) As String

Function GetGmtTime([StartingDate ]) As Date

Function GetTimeDifference() As Long

Function GetTimeHere(gmtTime As Date) As Date

Function InternetTimeToVbLocalTime(ByVal DateString As String) As Date

coclass Wallpaper

Function ActiveDesktopSetWallpaper(ByVal strFile As String) As Boolean

Sub At(ByVal nX As Integer, ByVal nY As Integer)

Sub AtSay(ByVal nX As Integer, ByVal nY As Integer, ByVal sText As String)

Sub Attributes(ByVal sAttribList As String)

Sub Colour(ByVal iFGColour As Long, ByVal iBGColour As Long)

Sub Dimensions(ByVal nHeight As Integer, ByVal nWidth As Integer)

Sub Font(ByVal sName As String, ByVal iSize As Integer)

Function LoadPic(sFilename As String, [nDestX As Integer = ], [nDestY As Integer = ]) As Variant

Property Picture As Object [Get/Set]

Sub SavePic(sFilename As String, [iType As Integer = 1])

Sub Say(ByVal sText As String)

Sub ScaleMode(ByVal iMode As Integer)

Function TextHeight(ByVal sText As String) As Integer

Function TextWidth(ByVal sText As String) As Integer

coclass Excel

Sub ExcelColumnNames(aHeadings () As Variant, [bBold As Boolean = True])

Sub ExcelNewSheet()

Sub ExcelStart([bHidden As Boolean = False])

coclass StopWatch

Sub Finish()

Function FinishTime() As Date

Function LapTime() As String

Function Seconds() As Integer

Sub Start()

Function StartTime() As Date

coclass Environments

Function GetProcessEnv(strEnvVar As String) As String

Function GetSystemEnv(strEnvVar As String) As String

Function GetUserEnv(strEnvVar As String) As String

Function GetVolatileEnv(strEnvVar As String) As String

coclass Schedule

Function AddTask(strTime , strCommand , [enDaysInWeek As ENUM_WEEKDAYS  = ], [strDaysInMonth = ], [RunInteractive As Boolean = True], [ReOccuring As Boolean = True]) As Long

Function DeleteTask(lngID As Long) As Boolean

Function GetNameOfComputer() As String

coclass SymbolTable

Function Append(sName , sValue ) As String

Sub Clear()

Function Increment(sName ) As Integer

Function IsSym(sName ) As Boolean

Function Keys()() As Variant

Sub Parse(sData , sSep )

Function Recall(sName ) As Variant

Sub Remove(sData )

Sub Store(sName , vValue )

Sub StoreDup(sName , xValue )

Sub StoreDup2(sName , xValue )

Function SymList() As Variant

Function SymListText() As String

coclass Files

Function CollectFiles(sDirectory , sFileType ) As Variant

Sub DeleteFile(ByVal cFilename )

Function Exists(sFile ) As Boolean

Function FileHasBeenModified(sFile As String, dThen As Date) As Boolean

Function FileModificationDate(sFile As String) As Date

Function IsUTF16LE(sFile As String) As Boolean

Function RandomInputFile(sExt As String) As String

Function RandomOutputFile(sRandomInputFile As String, sExt As String) As String

Function ReadFileA(FileName ) As String

Function ReadFileE(FileName ) As String

Function ReadFileU(FileName ) As String

Function ReadFirstLineA(FileName ) As Variant

Function ReadFirstLineE(FileName ) As String

Function ReadFirstLineU(FileName ) As String

Sub WriteFileA(sFilename , sContents , nMode As Long)

Sub WriteFileB(sFilename , nOffset As Long, vData )

Sub WriteFileU(sFilename , sContents , nMode As Long)

coclass System

Function AvailableDesktopDimensions() As Variant

Function CaptureDOS(sCommand , [bSynch As Boolean = True]) As Variant

Function ConsoleWrite(sText As String) As Long

Function ConsoleWriteLine(sText As String) As Long

Function CreateGUID() As String

Function DesktopDimensions() As Variant

Function DoEventsSeconds(nSeconds As Integer) As Integer

Sub DoEventsSeconds2(iSeconds As Integer)

Function GetTheWindowsDirectory() As String

Function GetUUID(sUuid As String) As Boolean

Function KillProcess(ProcessName As String) As Boolean

Sub Navigate(ByVal NavTo As String)

Function SetProcessPriority(sProcess As String, nPriority As EPROCESS_PRIORITY ) As Boolean

Function ShellEx(ByVal sFile As String, [eShowCmd As EShellShowConstants  = essSW_SHOWDEFAULT], [ByVal sParameters As String = ], [ByVal sDefaultDir As String = ], [sOperation As String = "open"], [Owner As Long = ]) As Boolean

Sub Sleep(nMilli As Integer)

Function SystemDefaultUILanguage() As Long

Function ThreadLocale() As Long

coclass Groups

Function GetComputerGroups(ByVal strComputerName As String)() As Variant

Function GetDefaultNamingContext() As String

Function GetGroups()() As Variant

coclass Help

Function HHDisplayHeadTopic(ByVal lHwnd As Long) As Long

Function HHDisplaySearch(ByVal lHwnd As Long, [toSearch As String = ]) As Long

Function HHHelpContents(ByVal lHwnd As Long) As Long

Function HHHelpIndex(ByVal lHwnd As Long, [toSearch As String = ]) As Long

Sub HHInitialize()

Function HHKeywordLookup(ByVal lHwnd As Long, [sKeyword As String = ]) As Long

Sub HHUninitialize()

Property sHelpFile As String [Get/Let]

coclass Number

Function IntegerToUnsigned(Value As Integer) As Long

Function LongToUnsigned(Value As Long) As Double

Function UnsignedToInteger(Value As Long) As Integer

Function UnsignedToLong(Value As Double) As Long

coclass IEDisplay

Sub Display(sMsg As String, nMillisec As Integer)

Sub Init(sPosition )

Property sName As String [Get/Let]

coclass Temp

Function GetTempFileName([sSeed As String = ]) As String

Function LocGetFilePath(ByVal iCFName As String) As String

Function TempDir() As String

Function TempDirWide() As String

Function TempFile(Create As Boolean, [lpPrefixString ], [lpszPath ]) As String

Function UnicodeTempFile(ByVal iFileName As String) As String

coclass INI

Sub Clear()

Function GetValue(sSection As String, sKey As String, strDefault As String) As String

Function HasSection(sSection As String) As Boolean

Function Load(sIniName As String) As Boolean

Function ReadINIA(sSection , sKeyName , sINIFileName ) As String

Function ReadINIU(sSection As String, sKeyName As String, sINIFileName As String) As String

Function WriteINIA(sSection , sKeyName , sNewString , sINIFileName ) As Boolean

Function WriteINIU(sSection As String, sKeyName As String, sNewString As String, sINIFileName As String) As Boolean

coclass Variable

Property Name As Variant [Get/Let/Set]

Property Value As Variant [Get/Let/Set]

coclass Mouse

Function Between(ByVal nNumber As Integer, ByVal nLowerBound As Integer, ByVal nUpperBound As Integer) As Boolean

Function MouseX([ByVal hWnd As Long = ]) As Long

Function MouseY([ByVal hWnd As Long = ]) As Long

coclass Traces

Sub ClearTrace()

Sub Trace([ByVal sTag = "!@#$%^&*()_"])

Property TraceFile As String [Get/Let]

Property Tracing As Boolean [Get/Let]

coclass Registry

Property ClassKey As ERegistryClassConstants  [Get/Let]

Sub CreateAdditionalEXEAssociations(ByVal sClassName As String, vItems () As Variant)

Sub CreateEXEAssociation(ByVal sExePath As String, ByVal sClassName As String, ByVal sClassDescription As String, ByVal sAssociation As String, [ByVal sOpenMenuText As String = "&Open"], [ByVal bSupportPrint As Boolean = False], [ByVal sPrintMenuText As String = "&Print"], [ByVal bSupportNew As Boolean = False], [ByVal sNewMenuText As String = "&New"], [ByVal bSupportInstall As Boolean = False], [ByVal sInstallMenuText As String = ], [ByVal lDefaultIconIndex As Long = -1])

Function CreateKey() As Boolean

Property Default As Variant [Get/Let]

Function DeleteKey() As Boolean

Function DeleteValue() As Boolean

Function EnumerateSections(sSect () As String, iSectCount As Long) As Boolean

Function EnumerateValues(sKeyNames () As String, iKeyCount As Long) As Boolean

Property KeyExists As Boolean [Get/o]

Property Machine As String [Get/Let]

Property SectionKey As String [Get/Let]

Property Value As Variant [Get/Let]

Property ValueEx(ClassKey As ERegistryClassConstants , SectionKey As String, ValueKey As String, ValueType As ERegistryValueTypes , Default ) As Variant [Get/Let]

Property ValueKey As String [Get/Let]

Property ValueType As ERegistryValueTypes  [Get/Let]

coclass Users

Function GetComputerUsers(ByVal strComputerName As String)() As Variant

Function GetComputerUsers2(ByVal strComputerName )() As Variant

Function GetDomainUser(sComputer As String) As String

Function GetLoginProfiles(sComputer )() As Variant

Function GetMac(sDevice ) As String

Function GetNameAndDescription(spDomain As String, sUsername As String) As String

Function GetOUofUser(sDomain As String, sUsername As String) As String

coclass Sort

Sub heapsort(aVec )

Sub quicksort(aVec )

Sub shellsort(a0 , [bAscending As Boolean = True])

Sub shellSortOnField(aVec , ByVal nField As Integer, ByVal sFieldSep , [nComparisonType As SSOF_COMPARISON  = SSOF_NUMERICAL])

Function sorted()() As Variant

coclass Strings

Function AnyOf(sText , nOperator As AO_COMPARATORS , sChar ) As Boolean

Function AnyOfList(sText , nOperator As AO_COMPARATORS , aChar ) As Boolean

Function AsString(X ) As String

Function BeginsWith(sText , sBeginning , [bCaseInsensitive As Boolean = True]) As Boolean

Function Between(sText , sBegin , sEnd ) As String

Function ByteArrayToString(aBytes () As Byte) As String

Function ComprehendCSV(sText ) As Variant

Function Contains(sText , sChunk , [bCaseInsensitive As Boolean = True]) As Boolean

Function CountFields(strText , strDelim ) As Integer

Function DQ(s ) As String

Function EndsWith(sText , sEnding , [bCaseInsensitive As Boolean = True]) As Boolean

Function EndsWithSet(sText , vEnding , [bCaseInsensitive As Boolean = True]) As Boolean

Function FirstLineOf(sData ) As String

Function FirstWord(sText ) As String

Function ForceExtension(sFilename , sExtension ) As String

Function HexDump(sData ) As String

Function HTMLWrap(sTag , sContent ) As String

Function LastLineOf(sData ) As String

Function LeftFill(sText , nLen , sFill ) As String

Function LeftOf(sText , sItem ) As String

Function LeftOfLast(sText , sItem ) As String

Function NthField(sText , sDelimiter , nReqdField ) As String

Function NthLineOf(n As Integer, sData ) As String

Function RemoveSpaces(sText ) As String

Function Reverse(sText ) As String

Function RightFill(sText , nLen , sFill ) As String

Function RightOf(sText , sItem ) As String

Function RightOfLast(sText , sItem ) As String

Function SplitSet(ByVal sString , ByVal sSet ) As Variant

Function StringConversion(s , n As Integer) As String

Function StringMap(sText , aFrom , vTo ) As String

Function StringToByteArray(ByVal sString )() As Byte

Function Subst(sText , paArgList () As Variant) As String

Function Subst2(sText , paArgList () As Variant) As String

Function ZeroFill(nNum , nWidth ) As String

Function Zerofill2(nNum ) As String 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T00:17:33.653

我才刚刚真正开始我的，但目前它主要包含我一直使用的常见扩展方法。像“ThrowIfNull()”这样的东西，所以每次我想检查空值时，我都不必做一堆 if 语句。

我还有一个游乐场项目，里面有我正在玩弄的任何想法，但我不能 100% 确定它们是否会起作用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T08:18:56.847

我按功能对实用程序进行分组。因此，我没有*一个*实用程序 DLL，而是一个包含多个此类程序集的文件夹，每个程序集都封装一个任务（通常不仅包含一个类，实际上它通常包含整个层次结构）。

在极端情况下，这意味着我有一个包含一个声明的 DLL，即以下声明（加上文档）：

```
namespace madrat.Common {
    public interface ICopyable<T> {
        T Copy();
    }
} 
```

请注意，与`System.ICloneable`接口不同的是，该接口具有文档中指定的明确定义的语义（深拷贝）。

那么为什么要为这个微小的声明添加一个额外的 DLL 呢？因为它使其他程序集之间的互操作性变得更加容易。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-01-25T22:45:29.990

这是我个人库中的两个课程。它让事情变得更好:)

```
public class DynamicArray<Type>
{
    private Type[] internalArray;

    public DynamicArray()
    {
        internalArray = new Type[0];
    }

    public int Length
    {
        get
        {
            return internalArray.Length;
        }
        set
        {
            if (value >= 0)
                Array.Resize<Type>(ref internalArray, value);
            else
                throw new ArgumentOutOfRangeException
                ("Length can not be less than zero!");
        }
    }

    public Type[] AsNormalArray
    {
        get
        {
            return internalArray;
        }
        set
        {
            internalArray = value;
        }
    }

    public Type this[int index]
    {
        get
        {
            if (index >= 0 && index < internalArray.Length)
                return internalArray[index];
            else
                throw new IndexOutOfRangeException
                ("Index was outside the bounds of the array!");
        }
        set
        {
            //Get error handling out of the way first
            if (index < 0)
                throw new IndexOutOfRangeException
                ("Index must be greater than or equal to zero!");
            //I decided that being able to grow by any amount can eventually lead
            //to lots of bugs, think about it. Just set the length manually
            //by assigning to .Length :)
            if (index > internalArray.Length)
                throw new IndexOutOfRangeException
                ("Can not dynamically grow more than one element at a time! Set length manually.");
            //We are left with two possibilities. A. we are indexing an existing element or
            //B. we are indexing one element to high (same as length, big array no no)
            //so grow an element
            if (index < internalArray.Length)//Then we dont need to grow an element
            {
                internalArray[index] = value;
            }
            else//Then grow one element, and add the value
            {
                Array.Resize<Type>(ref internalArray, internalArray.Length + 1);
                internalArray[index] = value;
            }
        }
    }

    public void Add(params Type[] values)
    {
        int start = internalArray.Length; //Start adding values at the end
        this.Length += values.Length; //Pre-set length (faster)

        foreach (Type val in values)
        {
            //this[start++] = val; Possibly slower
            internalArray[start++] = val;
        }
    }

    public int IndexOf(Type thisValue)
    {
        int i = 0;
        bool found = false;

        for(; i <= internalArray.Length; i++)
        {
            if(internalArray[i].Equals(thisValue))
            {
                found = true;
                break;
            }
        }

        if(found)
            return i;
        else
            throw new ArgumentException
            (thisValue+" does not exist!");
    }

    public bool Contains(Type thisValue)
    {
        bool found = false;

        foreach (Type val in internalArray)
        {
            if (val.Equals(thisValue))
            {
                found = true;
                break;
            }
        }

        return found;
    }
}

public class AssosiativeArray<ArrayT, KeyT>
{
    //Easy peasy lemon squeezy
    private DynamicArray<ArrayT> values;
    private DynamicArray<KeyT> keys;

    public AssosiativeArray()
    {
        values = new DynamicArray<ArrayT>();
        keys = new DynamicArray<KeyT>();
    }

    public int Length
    {
        get
        {
            return values.Length;
        }
    }

    public ArrayT[] ValuesAsNormalArray
    {
        get
        {
            return values.AsNormalArray;
        }
    }

    public KeyT[] KeysAsNormalArray
    {
        get
        {
            return keys.AsNormalArray;
        }
    }

    public ArrayT this[KeyT index]
    {
        get
        {
            if (keys.Contains(index))
            {
                return values[keys.IndexOf(index)];
            }
            else
            {
                throw new ArgumentException
                ("The key "+index+" does not exist!");
            }
        }
        set
        {
            keys[keys.Length++] = index;
            values[values.Length++] = value;
        }
    }

    public bool ContainsKey(KeyT key)
    {
        bool found = false;

        foreach (KeyT val in keys.AsNormalArray)
        {
            if (val.Equals(key))
            {
                found = true;
                break;
            }
        }

        return found;
    }
} 
```

}

# c# - 你会拥有太多的“受保护的虚拟”方法吗？

> ID：319343
> 
> 赞同：15
> 
> 时间：2008-11-26T00:14:36.093
> 
> 标签：c#, .net, virtual, protected

对于那些在大型项目和 API/框架设计方面有经验的人来说，这是一个问题。

我正在开发一个将来会被许多其他项目使用的框架，所以我想让它变得漂亮和可扩展，但同时它需要简单易懂。

我知道很多人抱怨 .NET 框架包含太多的密封类和私有成员。我是否应该避免这种批评并用大量受保护的虚拟成员打开我的所有课程？

**尽可能多地使我的方法和属性受保护**是一个好主意吗？在什么情况下你会避免**受保护的虚拟**并让成员私有。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-26T00:27:39.933

你的类包括数据成员；对那些功能永远不应该改变的数据成员执行基本内部操作的方法应该始终是私有的。因此，对数据成员进行基本操作（例如初始化和分配）的方法应该是私有的。否则，您将面临“二阶”派生类启用不完整行为集的风险；一阶导数成员可能会重新定义类的行为。

综上所述，我认为您应该非常小心地将方法定义为“受保护的虚拟”。在将方法定义为“受保护的虚拟”时，我会非常谨慎，因为这样做不仅声明了覆盖功能的**可能性**，而且在某些方面定义了对覆盖功能的**期望**。在我看来，这听起来像是一组定义不足的行为。我宁愿有一套明确定义的行为来覆盖。如果您想拥有大量可覆盖的行为，我宁愿研究面向方面的编程，它以非常结构化的方式允许这种事情。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-26T09:53:08.157

当您使用单词 virtual 标记方法时，您允许用户更改该逻辑的执行方式。出于许多目的，这正是您想要的。我相信你已经知道了。

但是，应该为这种扩展设计类型。你必须主动选择方法，让用户改变行为是有意义的。如果你只是在所有地方都贴上 virtual ，你可能会破坏类型的完整性，它并不能真正帮助用户理解类型，并且你可能会引入许多错误，包括与安全相关的问题。

我更喜欢保守的方法。`sealed`除非我特别想启用继承，否则我会标记我的所有类，并且在那些（少数）情况下，我只会将所需的方法设为虚拟。

`sealed`如果将来需要更改类以允许继承，则很容易删除标记。但是，如果您想更改一个已经被用作其他类型的基类的类，则在更改基类时可能会破坏子类。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-26T00:24:57.413

我的观点是：

*   如果您可以 user `events`，则首选`protected`方法。
*   尽量避免`protected`使用方法，如果不可能，那么你必须使用它;-)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-26T10:25:42.380

选择是一个深思熟虑的设计决定`protected`。`private`您是在声明您的类明确支持使用该功能，以及随之而来的所有开销（设计和实现工作）。我只会`protected`在我知道有必要的情况下使用，主要是因为我自己在做。（您还会发现 BCL 开发人员的评论与我所说的内容相同。）

`virtual`/non-`virtual`性能差异与任何强大到足以运行 .NET Framework 的机器无关。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T00:18:14.867

不，你不能有“太多”。然而，我们应该不惜一切代价使每个受保护而不是私有或避免“密封”的想法是愚蠢的。我会将“辅助方法”和内部数据结构保密。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-08-09T18:55:14.713

> 尽可能多地创建我的方法和属性是个好主意`protected virtual`吗？

不是好主意。

受保护的虚拟方法在增加耦合的同时提供了框架中的扩展点。

有更多有前途的技术可以提供可扩展性：[组合](https://en.wikipedia.org/wiki/Composition_over_inheritance)和[委托](https://en.wikipedia.org/wiki/Delegation_pattern)。

# sql - SQL Server 中“描述表”的等价物是什么？

> ID：319354
> 
> 赞同：380
> 
> 时间：2008-11-26T00:22:14.750
> 
> 标签：sql, sql-server, tsql

我有一个 SQL Server 数据库，我想知道它有哪些列和类型。我宁愿通过查询而不是使用像企业管理器这样的 GUI 来做到这一点。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：404
> 
> 时间：2008-11-26T00:30:37.683

您可以使用[sp_columns](http://msdn.microsoft.com/en-us/library/ms176077.aspx)存储过程：

```
exec sp_columns MyTable 
```

* * *

## 回答 #2

> 赞同：147
> 
> 时间：2008-11-26T00:28:06.143

有几种方法可以获取有关表的元数据：

```
EXEC sp_help tablename 
```

将返回几个结果集，描述表、列和约束。

视图将为您提供所需的`INFORMATION_SCHEMA`信息，但不幸的是，您必须查询视图并手动加入它们。

* * *

## 回答 #3

> 赞同：61
> 
> 时间：2008-11-26T01:05:32.527

以防万一您不想使用存储过程，这是一个简单的查询版本

```
select * 
  from information_schema.columns 
 where table_name = 'aspnet_Membership'
 order by ordinal_position 
```

* * *

## 回答 #4

> 赞同：46
> 
> 时间：2014-09-05T08:24:20.403

您可以使用以下内容：`sp_help tablename`

例子：`sp_help Customer`

或使用快捷键

*   `Select`所需的表，然后按`ALT`+ `F1`。

示例：客户按`ALT`+ `F1`。

* * *

## 回答 #5

> 赞同：30
> 
> 时间：2014-01-10T13:17:47.827

使用此查询

```
Select * From INFORMATION_SCHEMA.COLUMNS Where TABLE_NAME = 'TABLENAME' 
```

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2016-11-10T19:43:15.697

除了其他答案中显示的方式外，您还可以使用

```
SELECT TOP 0 * FROM table_name 
```

这将为您提供每列的名称，其中没有结果，并且几乎立即以最小的开销完成。

* * *

## 回答 #7

> 赞同：16
> 
> 时间：2016-06-06T19:44:46.947

请使用以下sql查询；这适用于我的情况。

```
select * FROM   INFORMATION_SCHEMA.Columns where table_name = 'tablename'; 
```

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2016-04-11T11:15:26.153

Just select table and press `Alt`+`F1`,

it will show all the information about table like Column name, datatype, keys etc.

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2013-01-28T15:19:24.740

我在 t-sql 中写了一个 sql*plus DESC(RIBE) 之类的 select（也显示列注释）：

```
USE YourDB
GO

DECLARE @objectName NVARCHAR(128) = 'YourTable';

SELECT
  a.[NAME]
 ,a.[TYPE]
 ,a.[CHARSET]
 ,a.[COLLATION]
 ,a.[NULLABLE]
 ,a.[DEFAULT]
 ,b.[COMMENTS]
-- ,a.[ORDINAL_POSITION]
FROM
  (
    SELECT
      COLUMN_NAME                                     AS [NAME]
     ,CASE DATA_TYPE
        WHEN 'char'       THEN DATA_TYPE  + '(' + CAST(CHARACTER_MAXIMUM_LENGTH AS VARCHAR) + ')'
        WHEN 'numeric'    THEN DATA_TYPE  + '(' + CAST(NUMERIC_PRECISION AS VARCHAR) + ', ' + CAST(NUMERIC_SCALE AS VARCHAR) + ')'
        WHEN 'nvarchar'   THEN DATA_TYPE  + '(' + CAST(CHARACTER_MAXIMUM_LENGTH AS VARCHAR) + ')'
        WHEN 'varbinary'  THEN DATA_TYPE + '(' + CAST(CHARACTER_MAXIMUM_LENGTH AS VARCHAR) + ')'
        WHEN 'varchar'    THEN DATA_TYPE   + '(' + CAST(CHARACTER_MAXIMUM_LENGTH AS VARCHAR) + ')'
        ELSE DATA_TYPE
      END                                             AS [TYPE]
     ,CHARACTER_SET_NAME                              AS [CHARSET]
     ,COLLATION_NAME                                  AS [COLLATION]
     ,IS_NULLABLE                                     AS [NULLABLE]
     ,COLUMN_DEFAULT                                  AS [DEFAULT]
     ,ORDINAL_POSITION
    FROM   
      INFORMATION_SCHEMA.COLUMNS
    WHERE
      TABLE_NAME = @objectName
  ) a
  FULL JOIN
  (
   SELECT
     CAST(value AS NVARCHAR)                        AS [COMMENTS]
    ,CAST(objname AS NVARCHAR)                      AS [NAME]
   FROM
     ::fn_listextendedproperty ('MS_Description', 'user', 'dbo', 'table', @objectName, 'column', default)
  ) b
  ON a.NAME COLLATE YourCollation = b.NAME COLLATE YourCollation
ORDER BY
  a.[ORDINAL_POSITION]; 
```

上面提到的 select 可以在系统标记的存储过程中使用，并且可以通过简单的方式从实例的任何数据库中调用：

```
USE master;
GO

IF OBJECT_ID('sp_desc', 'P') IS NOT NULL
  DROP PROCEDURE sp_desc
GO

CREATE PROCEDURE sp_desc (
  @tableName  nvarchar(128)
) AS
BEGIN
  DECLARE @dbName       sysname;
  DECLARE @schemaName   sysname;
  DECLARE @objectName   sysname;
  DECLARE @objectID     int;
  DECLARE @tmpTableName varchar(100);
  DECLARE @sqlCmd       nvarchar(4000);

  SELECT @dbName = PARSENAME(@tableName, 3);
  IF @dbName IS NULL SELECT @dbName = DB_NAME();

  SELECT @schemaName = PARSENAME(@tableName, 2);
  IF @schemaName IS NULL SELECT @schemaName = SCHEMA_NAME();

  SELECT @objectName = PARSENAME(@tableName, 1);
  IF @objectName IS NULL
    BEGIN
      PRINT 'Object is missing from your function call!';
      RETURN;
    END;

  SELECT @objectID = OBJECT_ID(@dbName + '.' + @schemaName + '.' + @objectName);
  IF @objectID IS NULL
    BEGIN
      PRINT 'Object [' + @dbName + '].[' + @schemaName + '].[' + @objectName + '] does not exist!';
      RETURN;
    END;

  SELECT @tmpTableName = '#tmp_DESC_' + CAST(@@SPID AS VARCHAR) + REPLACE(REPLACE(REPLACE(REPLACE(CAST(CONVERT(CHAR, GETDATE(), 121) AS VARCHAR), '-', ''), ' ', ''), ':', ''), '.', '');
  --PRINT @tmpTableName;
  SET @sqlCmd = '
    USE ' + @dbName + '
    CREATE TABLE ' + @tmpTableName + ' (
      [NAME]              nvarchar(128) NOT NULL
     ,[TYPE]              varchar(50)
     ,[CHARSET]           varchar(50)
     ,[COLLATION]         varchar(50)
     ,[NULLABLE]          varchar(3)
     ,[DEFAULT]           nvarchar(4000)
     ,[COMMENTS]          nvarchar(3750));

    INSERT INTO ' + @tmpTableName + '
    SELECT
      a.[NAME]
     ,a.[TYPE]
     ,a.[CHARSET]
     ,a.[COLLATION]
     ,a.[NULLABLE]
     ,a.[DEFAULT]
     ,b.[COMMENTS]
    FROM
      (
        SELECT
          COLUMN_NAME                                     AS [NAME]
         ,CASE DATA_TYPE
            WHEN ''char''      THEN DATA_TYPE + ''('' + CAST(CHARACTER_MAXIMUM_LENGTH AS VARCHAR) + '')''
            WHEN ''numeric''   THEN DATA_TYPE + ''('' + CAST(NUMERIC_PRECISION AS VARCHAR) + '', '' + CAST(NUMERIC_SCALE AS VARCHAR) + '')''
            WHEN ''nvarchar''  THEN DATA_TYPE + ''('' + CAST(CHARACTER_MAXIMUM_LENGTH AS VARCHAR) + '')''
            WHEN ''varbinary'' THEN DATA_TYPE + ''('' + CAST(CHARACTER_MAXIMUM_LENGTH AS VARCHAR) + '')''
            WHEN ''varchar''   THEN DATA_TYPE + ''('' + CAST(CHARACTER_MAXIMUM_LENGTH AS VARCHAR) + '')''
            ELSE DATA_TYPE
          END                                             AS [TYPE]
         ,CHARACTER_SET_NAME                              AS [CHARSET]
         ,COLLATION_NAME                                  AS [COLLATION]
         ,IS_NULLABLE                                     AS [NULLABLE]
         ,COLUMN_DEFAULT                                  AS [DEFAULT]
         ,ORDINAL_POSITION
        FROM   
          INFORMATION_SCHEMA.COLUMNS
        WHERE   
          TABLE_NAME = ''' + @objectName + '''
      ) a
      FULL JOIN
      (
         SELECT
           CAST(value AS NVARCHAR)                        AS [COMMENTS]
          ,CAST(objname AS NVARCHAR)                      AS [NAME]
         FROM
           ::fn_listextendedproperty (''MS_Description'', ''user'', ''' + @schemaName + ''', ''table'', ''' + @objectName + ''', ''column'', default)
      ) b
      ON a.NAME COLLATE Hungarian_CI_AS = b.NAME COLLATE Hungarian_CI_AS
    ORDER BY
      a.[ORDINAL_POSITION];

    SELECT * FROM ' + @tmpTableName + ';'

    --PRINT @sqlCmd;

    EXEC sp_executesql @sqlCmd;
    RETURN;
END;
GO

EXEC sys.sp_MS_marksystemobject sp_desc
GO 
```

要执行过程类型：

```
EXEC sp_desc 'YourDB.YourSchema.YourTable'; 
```

如果要获取当前数据库（和模式）简单类型的对象的描述：

```
EXEC sp_desc 'YourTable'; 
```

由于 sp_desc 是系统标记的过程，您甚至可以保留 exec 命令（无论如何不推荐）：

```
sp_desc 'YourTable'; 
```

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2019-03-11T17:21:28.470

相当于 Oracle 的`describe`命令的 SQL Server 是存储过程`sp_help`

该`describe`命令为您提供有关列名、类型、长度等的信息。

在 SQL Server 中，假设您想在数据库“mydb”中的模式“myschema”中描述一个表“mytable”，您可以执行以下操作：

```
USE mydb;
exec sp_help 'myschema.mytable'; 
```

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2014-07-09T07:39:07.627

您可以使用 sp_help 'TableName'

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2021-01-07T06:27:33.663

试试看：

```
EXEC [ServerName].[DatabaseName].dbo.sp_columns 'TableName' 
```

并且可以得到一些表结构信息，比如：

TABLE_QUALIFIER、TABLE_OWNER、TABLE_NAME、COLUMN_NAME、DATA_TYPE、TYPE_NAME...

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2020-07-17T15:56:19.817

除了上述问题，如果我们在 DB 中有表`db_name.dbo.table_name`，我们可以使用以下步骤

1.  与数据库连接

    `USE db_name;`

2.  使用`EXEC sp_help`并且不要忘记将表名`'dbo.tablename'`作为`dbo`模式。

    `exec sp_help 'dbo.table_name'`

这应该工作！

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2013-01-24T15:51:22.167

这些答案的问题在于您缺少关键信息。虽然这有点混乱，但这是我想出的一个快速版本，以确保它包含与 MySQL Describe 显示的相同信息。

```
Select SC.name AS 'Field', ISC.DATA_TYPE AS 'Type', ISC.CHARACTER_MAXIMUM_LENGTH AS 'Length', SC.IS_NULLABLE AS 'Null', I.is_primary_key AS 'Key', SC.is_identity AS 'Identity'
From sys.columns AS SC 
LEFT JOIN sys.index_columns AS IC
ON IC.object_id = OBJECT_ID('dbo.Expenses') AND 
IC.column_id = SC.column_id
LEFT JOIN sys.indexes AS I 
ON I.object_id = OBJECT_ID('dbo.Expenses') AND 
IC.index_id = I.index_id
LEFT JOIN information_schema.columns ISC
ON ISC.TABLE_NAME = 'Expenses'
AND ISC.COLUMN_NAME = SC.name
WHERE SC.object_id = OBJECT_ID('dbo.Expenses') 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2020-08-19T09:30:19.833

我试过了，它对我有用

```
exec sp_help TABLE_NAME 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2019-08-21T13:54:51.167

我喜欢这种格式：

```
name     DataType      Collation             Constraints         PK  FK          Comment

id       int                                 NOT NULL IDENTITY   PK              Order Line Id
pid      int                                 NOT NULL                tbl_orders  Order Id
itemCode varchar(10)   Latin1_General_CI_AS  NOT NULL                            Product Code 
```

所以我用了这个：

```
DECLARE @tname varchar(100) = 'yourTableName';

SELECT  col.name,

        CASE typ.name
            WHEN 'nvarchar' THEN 'nvarchar('+CAST((col.max_length / 2) as varchar)+')'
            WHEN 'varchar' THEN 'varchar('+CAST(col.max_length as varchar)+')'
            WHEN 'char' THEN 'char('+CAST(col.max_length as varchar)+')'
            WHEN 'nchar' THEN 'nchar('+CAST((col.max_length / 2) as varchar)+')'
            WHEN 'binary' THEN 'binary('+CAST(col.max_length as varchar)+')'
            WHEN 'varbinary' THEN 'varbinary('+CAST(col.max_length as varchar)+')'
            WHEN 'numeric' THEN 'numeric('+CAST(col.precision as varchar)+(CASE WHEN col.scale = 0 THEN '' ELSE ','+CAST(col.scale as varchar) END) +')'
            WHEN 'decimal' THEN 'decimal('+CAST(col.precision as varchar)+(CASE WHEN col.scale = 0 THEN '' ELSE ','+CAST(col.scale as varchar) END) +')'
            ELSE typ.name
            END DataType,

        ISNULL(col.collation_name,'') Collation,

        CASE WHEN col.is_nullable = 0 THEN 'NOT NULL ' ELSE '' END + CASE WHEN col.is_identity = 1 THEN 'IDENTITY' ELSE '' END Constraints,

        ISNULL((SELECT 'PK'
                FROM    sys.key_constraints kc INNER JOIN
                        sys.tables tb ON tb.object_id = kc.parent_object_id INNER JOIN
                        sys.indexes si ON si.name = kc.name INNER JOIN
                        sys.index_columns sic ON sic.index_id = si.index_id AND sic.object_id = si.object_id
                WHERE kc.type = 'PK'
                  AND tb.name = @tname
                  AND sic.column_id = col.column_id),'') PK,

        ISNULL((SELECT (SELECT name FROM sys.tables st WHERE st.object_id = fkc.referenced_object_id)
                FROM    sys.foreign_key_columns fkc INNER JOIN
                        sys.columns c ON c.column_id = fkc.parent_column_id AND fkc.parent_object_id = c.object_id INNER JOIN
                        sys.tables t ON t.object_id = c.object_id
                WHERE t.name = tab.name
                  AND c.name = col.name),'') FK,

        ISNULL((SELECT value
                FROM sys.extended_properties
                WHERE major_id = tab.object_id
                  AND minor_id = col.column_id),'') Comment

FROM sys.columns col INNER JOIN
     sys.tables tab ON tab.object_id = col.object_id INNER JOIN
     sys.types typ ON typ.system_type_id = col.system_type_id
WHERE tab.name = @tname
  AND typ.name != 'sysname'
ORDER BY col.column_id; 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2015-09-29T08:57:07.447

这是我在`EntityFramework Reverse POCO Generator`（可[在此处](https://visualstudiogallery.msdn.microsoft.com/ee4fcff9-0c4c-4179-afd9-7a2fb90f5838)获得）中使用的代码

表 SQL：

```
SELECT  c.TABLE_SCHEMA AS SchemaName,
        c.TABLE_NAME AS TableName,
        t.TABLE_TYPE AS TableType,
        c.ORDINAL_POSITION AS Ordinal,
        c.COLUMN_NAME AS ColumnName,
        CAST(CASE WHEN IS_NULLABLE = 'YES' THEN 1
                  ELSE 0
             END AS BIT) AS IsNullable,
        DATA_TYPE AS TypeName,
        ISNULL(CHARACTER_MAXIMUM_LENGTH, 0) AS [MaxLength],
        CAST(ISNULL(NUMERIC_PRECISION, 0) AS INT) AS [Precision],
        ISNULL(COLUMN_DEFAULT, '') AS [Default],
        CAST(ISNULL(DATETIME_PRECISION, 0) AS INT) AS DateTimePrecision,
        ISNULL(NUMERIC_SCALE, 0) AS Scale,
        CAST(COLUMNPROPERTY(OBJECT_ID(QUOTENAME(c.TABLE_SCHEMA) + '.' + QUOTENAME(c.TABLE_NAME)), c.COLUMN_NAME, 'IsIdentity') AS BIT) AS IsIdentity,
        CAST(CASE WHEN COLUMNPROPERTY(OBJECT_ID(QUOTENAME(c.TABLE_SCHEMA) + '.' + QUOTENAME(c.TABLE_NAME)), c.COLUMN_NAME, 'IsIdentity') = 1 THEN 1
                  WHEN COLUMNPROPERTY(OBJECT_ID(QUOTENAME(c.TABLE_SCHEMA) + '.' + QUOTENAME(c.TABLE_NAME)), c.COLUMN_NAME, 'IsComputed') = 1 THEN 1
                  WHEN DATA_TYPE = 'TIMESTAMP' THEN 1
                  ELSE 0
             END AS BIT) AS IsStoreGenerated,
        CAST(CASE WHEN pk.ORDINAL_POSITION IS NULL THEN 0
                  ELSE 1
             END AS BIT) AS PrimaryKey,
        ISNULL(pk.ORDINAL_POSITION, 0) PrimaryKeyOrdinal,
        CAST(CASE WHEN fk.COLUMN_NAME IS NULL THEN 0
                  ELSE 1
             END AS BIT) AS IsForeignKey
FROM    INFORMATION_SCHEMA.COLUMNS c
        LEFT OUTER JOIN (SELECT u.TABLE_SCHEMA,
                                u.TABLE_NAME,
                                u.COLUMN_NAME,
                                u.ORDINAL_POSITION
                         FROM   INFORMATION_SCHEMA.KEY_COLUMN_USAGE u
                                INNER JOIN INFORMATION_SCHEMA.TABLE_CONSTRAINTS tc
                                    ON u.TABLE_SCHEMA = tc.CONSTRAINT_SCHEMA
                                       AND u.TABLE_NAME = tc.TABLE_NAME
                                       AND u.CONSTRAINT_NAME = tc.CONSTRAINT_NAME
                         WHERE  CONSTRAINT_TYPE = 'PRIMARY KEY') pk
            ON c.TABLE_SCHEMA = pk.TABLE_SCHEMA
               AND c.TABLE_NAME = pk.TABLE_NAME
               AND c.COLUMN_NAME = pk.COLUMN_NAME
        LEFT OUTER JOIN (SELECT DISTINCT
                                u.TABLE_SCHEMA,
                                u.TABLE_NAME,
                                u.COLUMN_NAME
                         FROM   INFORMATION_SCHEMA.KEY_COLUMN_USAGE u
                                INNER JOIN INFORMATION_SCHEMA.TABLE_CONSTRAINTS tc
                                    ON u.TABLE_SCHEMA = tc.CONSTRAINT_SCHEMA
                                       AND u.TABLE_NAME = tc.TABLE_NAME
                                       AND u.CONSTRAINT_NAME = tc.CONSTRAINT_NAME
                         WHERE  CONSTRAINT_TYPE = 'FOREIGN KEY') fk
            ON c.TABLE_SCHEMA = fk.TABLE_SCHEMA
               AND c.TABLE_NAME = fk.TABLE_NAME
               AND c.COLUMN_NAME = fk.COLUMN_NAME
        INNER JOIN INFORMATION_SCHEMA.TABLES t
            ON c.TABLE_SCHEMA = t.TABLE_SCHEMA
               AND c.TABLE_NAME = t.TABLE_NAME
WHERE c.TABLE_NAME NOT IN ('EdmMetadata', '__MigrationHistory') 
```

外键 SQL：

```
SELECT  FK.name AS FK_Table,
        FkCol.name AS FK_Column,
        PK.name AS PK_Table,
        PkCol.name AS PK_Column,
        OBJECT_NAME(f.object_id) AS Constraint_Name,
        SCHEMA_NAME(FK.schema_id) AS fkSchema,
        SCHEMA_NAME(PK.schema_id) AS pkSchema,
        PkCol.name AS primarykey,
        k.constraint_column_id AS ORDINAL_POSITION
FROM    sys.objects AS PK
        INNER JOIN sys.foreign_keys AS f
            INNER JOIN sys.foreign_key_columns AS k
                ON k.constraint_object_id = f.object_id
            INNER JOIN sys.indexes AS i
                ON f.referenced_object_id = i.object_id
                   AND f.key_index_id = i.index_id
            ON PK.object_id = f.referenced_object_id
        INNER JOIN sys.objects AS FK
            ON f.parent_object_id = FK.object_id
        INNER JOIN sys.columns AS PkCol
            ON f.referenced_object_id = PkCol.object_id
               AND k.referenced_column_id = PkCol.column_id
        INNER JOIN sys.columns AS FkCol
            ON f.parent_object_id = FkCol.object_id
               AND k.parent_column_id = FkCol.column_id
ORDER BY FK_Table, FK_Column 
```

扩展属性：

```
SELECT  s.name AS [schema],
        t.name AS [table],
        c.name AS [column],
        value AS [property]
FROM    sys.extended_properties AS ep
        INNER JOIN sys.tables AS t
            ON ep.major_id = t.object_id
        INNER JOIN sys.schemas AS s
            ON s.schema_id = t.schema_id
        INNER JOIN sys.columns AS c
            ON ep.major_id = c.object_id
               AND ep.minor_id = c.column_id
WHERE   class = 1
ORDER BY t.name 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2019-11-21T05:33:22.693

如果您使用的是 Brent [Ozar](https://www.brentozar.com/first-aid/)团队的 FirstResponderKit，您也可以运行此查询：

```
exec sp_blitzindex @tablename='MyTable' 
```

它将返回有关表的所有信息：

*   索引及其使用统计信息（读取、写入、锁定等）、已用空间和其他
*   缺失索引
*   列
*   外键
*   统计内容 [![sp_BlitzIndex 示例](https://i.stack.imgur.com/8rOL2.png)](https://i.stack.imgur.com/8rOL2.png)

当然，它不是一个系统，也不是像**sp_help**或**sp_columns**这样通用的 stp ，但它会返回有关您的表的所有可能信息，我认为值得在您的环境中创建它并在此处提及它。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2020-02-10T17:02:46.977

只需双击表名并按 Alt+F1

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2019-10-26T04:48:30.897

```
SELECT C.COLUMN_NAME, C.IS_NULLABLE, C.DATA_TYPE, TC.CONSTRAINT_TYPE, C.COLUMN_DEFAULT
    FROM INFORMATION_SCHEMA.COLUMNS AS C
    FULL JOIN INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE AS CC ON C.COLUMN_NAME = CC.COLUMN_NAME 
    FULL JOIN INFORMATION_SCHEMA.TABLE_CONSTRAINTS AS TC ON CC.CONSTRAINT_NAME = TC.CONSTRAINT_NAME
WHERE C.TABLE_NAME = '<Table Name>'; 
```

[样本输出](https://i.stack.imgur.com/wuxC5.png)

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2018-08-31T22:30:48.133

利用

```
SELECT COL_LENGTH('tablename', 'colname') 
```

没有其他解决方案对我有用。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2022-01-11T18:54:46.710

1.  首先连接到您的数据库，

**使用 DB_name**

2.  然后

**exec sp_help 'Production.Et_Issue'**

这里的“生产”是模式名称。如果你没有模式，你可以简单地写**sp_help table_name**

[![在此处输入图像描述](https://i.stack.imgur.com/Hp57F.png)](https://i.stack.imgur.com/Hp57F.png)

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2020-09-15T04:45:19.820

`info()`下面的查询将提供与python、Pandas 库中的函数类似的输出。

```
USE [Database_Name]

IF OBJECT_ID('tempdo.dob.#primary_key', 'U') IS NOT NULL DROP TABLE #primary_key

SELECT 
CONS_T.TABLE_CATALOG,
CONS_T.TABLE_SCHEMA,
CONS_T.TABLE_NAME,
CONS_C.COLUMN_NAME,
CONS_T.CONSTRAINT_TYPE,
CONS_T.CONSTRAINT_NAME
INTO  #primary_key
FROM
INFORMATION_SCHEMA.TABLE_CONSTRAINTS AS CONS_T 
JOIN INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE AS CONS_C ON CONS_C.CONSTRAINT_NAME= CONS_T.CONSTRAINT_NAME

SELECT
SMA.name AS [Schema Name],
ST.name AS [Table Name],
SC.column_id AS [Column Order],
SC.name AS [Column Name],
PKT.CONSTRAINT_TYPE, 
PKT.CONSTRAINT_NAME, 
SC.system_type_id,
STP.name AS [Data Type],
SC.max_length,
SC.precision, 
SC.scale, 
SC.is_nullable, 
SC.is_masked
FROM sys.tables  AS ST
JOIN sys.schemas AS SMA ON SMA.schema_id = ST.schema_id
JOIN sys.columns AS SC ON SC.object_id = ST.object_id 
JOIN sys.types AS STP ON STP.system_type_id = SC.system_type_id
LEFT JOIN #primary_key AS PKT ON PKT.TABLE_SCHEMA = SMA.name
                                 AND PKT.TABLE_NAME = ST.name
                                 AND PKT.COLUMN_NAME = SC.name
ORDER BY ST.name ASC, SMA.name ASC 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2015-12-02T13:29:54.047

```
CREATE PROCEDURE [dbo].[describe] 
( 
@SearchStr nvarchar(max) 
) 
AS 
BEGIN 
SELECT  
    CONCAT([COLUMN_NAME],' ',[DATA_TYPE],' ',[CHARACTER_MAXIMUM_LENGTH],' ', 
    (SELECT CASE [IS_NULLABLE] WHEN 'NO' THEN 'NOT NULL' ELSE 'NULL' END),
    (SELECT CASE WHEN [COLUMN_DEFAULT] IS NULL THEN '' ELSE CONCAT(' DEFAULT ',[COLUMN_DEFAULT]) END)
    ) AS DESCRIPTION
    FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME LIKE @SearchStr
END 
```

* * *

## 回答 #25

> 赞同：-1
> 
> 时间：2020-07-07T23:14:19.697

select * from sysobjects where name='TABLENAME'

# asp.net - 如何将服务器时间转换为本地时间

> ID：319367
> 
> 赞同：9
> 
> 时间：2008-11-26T00:29:38.200
> 
> 标签：asp.net, datetime, c#-3.0

我的时间有问题
我的服务器在美国，我在丹麦（欧罗巴），我想让我的网站显示我当地时间的时间。我怎样才能做到这一点？

我试试这个

```
Datetime localtime = DateTimeOffset.Now.ToOffset(new TimeSpan(1,0,0)).DateTime; 
```

它有效，但它只在我处于 GMT+1 / UTC+1 时有效，而不是在我在 GMT+2 / UTC+2 时有效。有没有另一种方法——一种更简单的方法？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-26T00:52:49.697

您应该这样做的唯一方法如下：

```
string zoneId = "Central European Standard Time";
TimeZoneInfo tzi = TimeZoneInfo.FindSystemTimeZoneById(zoneId);
DateTime result = TimeZoneInfo.ConvertTimeFromUtc(DateTime.UtcNow,tzi);
Console.WriteLine("Time is " + result + " in Denmark"); 
```

使用 TimeZoneInfo 类是 .Net 中唯一可靠的方法来转换到/从不同的时区并获得正确的 DST 转换。

`TimeZoneInfo.ConvertTimeToUtc(dtLocal,tzi)`是从本地时间到UTC时间的反向转换。

* * *

对于 TimeZone Id 字符串，您可以在此处运行代码...

```
foreach( var tz in TimeZoneInfo.GetSystemTimeZones() )
{
    Console.WriteLine(tz.DisplayName + " is Id=','" + tz.Id + "'");
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T00:40:47.507

您可以从服务器中获得时间并执行此操作。

```
DateTime myTimeGMT = ServerTime.ToUniversalTime(); 
```

这样做：

```
DateTime myTimeLocal = myTimeGMT.ToLocalTime(); 
```

这里唯一的限制是您所在的计算机必须设置为您要转换到的时区。

以我的经验，当“从”时间或“到”时间都不是本地时区时，.NET 在时区之间转换时遇到了麻烦。

我希望这有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-04-25T17:46:23.830

我使用模板字段进行了转换以显示在网格视图中。

```
<asp:TemplateField HeaderText="Last Activity">
                <ItemTemplate>
                    <asp:Label ID="LastActivityLBL" runat="server" Text='<%# Convert.ToDateTime(Eval("LastActivityDate")).ToLocalTime() %>'></asp:Label>
                </ItemTemplate>
            </asp:TemplateField>
            <asp:TemplateField HeaderText="Last Login">
                <ItemTemplate>
                    <asp:Label ID="LastLoginLBL" runat="server" Text='<%# Convert.ToDateTime(Eval("LastLoginDate")).ToLocalTime() %>'></asp:Label>
                </ItemTemplate>
            </asp:TemplateField> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-02-25T06:33:29.250

```
Datetime localtime = DateTimeOffset.Now.ToOffset(new TimeSpan(1,0,0)).DateTime; 
```

你可以改变你的时间跨度像 -

```
Datetime localtime = DateTimeOffset.Now.ToOffset(new TimeSpan(3,0,0)).DateTime; 
```

根据时区。

# sharepoint - 在 TFS 中的 SharePoint 网站上找不到页面错误

> ID：319379
> 
> 赞同：1
> 
> 时间：2008-11-26T00:39:30.893
> 
> 标签：sharepoint

我在这里遇到了大麻烦，今天我被要求向TFS添加一个新用户，我做的第一件事就是将它添加到SharePoint，但是现在我每次尝试进入项目门户（团队资源管理器->右键单击项目 - > 显示项目门户）我收到一个页面未找到错误，对于每个项目，以下是有关设置的一些基本信息：

2 层 TFS、TFS 服务器、ReportServices 和 SharePoint 在同一台服务器上。

如果我尝试在此服务器上进入管理门户（cd21vids1 是 tfs 服务器）

[http://cd21vids1:17012/](http://cd21vids1:17012/) - 我得到目录列表被拒绝

[http://cd21vids1:17012/default.aspx](http://cd21vids1:17012/default.aspx) - 我得到默认页面，它工作正常。

如果我进入项目站点，我会得到以下结果（88 是此服务器中 SharePoint 的默认端口）：

[http://cd21vids1:88/Sites/Cnbv.Framework/](http://cd21vids1:88/Sites/Cnbv.Framework/) -- 找不到页面

[http://cd21vids1:88/Sites/Cnbv.Framework/default.aspx](http://cd21vids1:88/Sites/Cnbv.Framework/default.aspx) - 我得到页面但没有样式并且布局错误，我在“剩余工作”报告中也收到错误（目录列表被拒绝） ，有问题的报告是“问题列表”和“退出标准状态”（两种情况下的目录列表都被拒绝）。

其他一切似乎都可以正常工作，（构建，签入），我希望你能帮助我，谢谢。

胡安·扎穆迪奥

更新：我做了更多的测试，我在 url 中得到一个 page not found 错误

[http://cd21vids1:88/Sites/Cnbv.Framework/_styles/core.css](http://cd21vids1:88/Sites/Cnbv.Framework/_styles/core.css)

也许这是我在没有正确布局的情况下获得默认页面的方式。

UPDATE2：当我单击“Windows Sharepoint Services 站点管理”链接时，我收到此错误：“Team Foundation Server 无法在 Windows SharePoint Services 中找到此团队项目门户的在线站点管理应用程序。此错误的最可能原因是团队项目门户上的语言设置与 Visual Studio 客户端的当前语言不匹配。站点管理的位置特定于项目门户的语言。有关站点管理的可用性信息，请联系 Team Foundation Server 管理员此项目门户。有关详细信息，请参阅 Windows SharePoint Services 管理员指南。”

有人将服务器的语言从美国英语更改为西班牙语 MX，我将语言改回英语并重新启动服务器但没有骰子（顺便说一句，我已经在“C:\Program Files\Common Files\Microsoft Shared 中有一个名为 2058 的文件夹\web server extensions\12\TEMPLATE\LAYOUTS\" 就像这篇[文章中解释的那样](http://social.msdn.microsoft.com/forums/en-US/tfsadmin/thread/c224068a-0868-4e99-ad07-cb03f08dec4d/)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-04T06:06:32.480

我的 SharePoint 问题已修复，以下是详细信息。

1.  运行“SharePoint 产品技术配置向导”
    1.1。选择不与此服务器场断开连接，单击下一步
    1.2。选择否，这台机器将继续托管网站，点击下一步。
    1.3 点击下一步
2.  重新启动 IIS

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-23T12:01:29.383

我对 core.css 文件也有同样的问题。我不想使用 Sharepoint 设计器来解决它，因为它会取消我的网站！

所以我尝试了这个（它有效）：在站点管理中，转到“母版页”，然后在页面下方，您可以重新定义用于站点的 css。所以我把网址放在那里：/_layouts/1036/Styles/core.css（1036=法语，所以如果你的网站是英文的，请使用1033！），经过验证它有效。

问题是该页面仍然尝试从[http://MYServeur/_styles/core.css](http://MYServeur/_styles/core.css)获取 core.css ..并返回 404！

但至少我恢复了我的风格。我只是发布它以防万一......我仍然希望有一个更好的解决方案......

阿杰

# sql - 与 SQL 排序依据和空值的数据库一致性

> ID：319384
> 
> 赞同：0
> 
> 时间：2008-11-26T00:45:17.310
> 
> 标签：sql, null, sql-order-by

我的数据库中有一个列（一个标志），类型为 varchar(1)，填充为 Y 或 NULL（这是它的样子，不在我的控制范围内）。

在 SQL Server 中，按查询升序排列，NULL 排在最前面。对于 Oracle 和 DB2，这种行为是否应该保持一致？

相反，如果我在列上有一个 COALESCE 以确保它在查询中不为空，我是否可能会遇到任何性能问题（由于表扫描等）？

**编辑**

查询需要在所有 3 个数据库上保持一致，否则我将不得不在代码中处理它，因此我考虑使用 COALESCE 函数

**编辑**

我选择 Pax 作为答案，因为它处理了问题的两个部分并提供了有用的解决方法，但是，感谢 me.yahoo.com/a/P4tXrx 提供指向[此处的链接](http://en.wikipedia.org/wiki/Order_by_(SQL))

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-26T01:04:03.230

我知道 DB2 Express 和 DB2（至少到 v8）不**支持**该`NULLS FIRST`子句。

如果您想要一个便携式解决方案，您可能必须选择类似的东西：

```
select * from tbl where fld is null
    union all select * from tbl where fld is not null 
```

我认为联合的结果（至少在 DB2 中，您需要检查其他结果）保证正确排序。

由于您正在为返回的每一行运行一个函数，因此合并**将对性能产生影响。**但是，这取决于数据库中的行数。

您可能不得不求助于在代码中对两个不同的记录集进行两次查询，然后按顺序处理它们。

编辑：我刚刚检查了 SQL 标准，不能保证与 a 连接的查询`UNION ALL`是有序的；它们可能是相互混合的。因此，您可能不得不求助于运行上述两个不同查询的代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T01:05:56.910

> 在 SQL Server 中，按查询升序排列，NULL 排在最前面。对于 Oracle 和 DB2，这种行为是否应该保持一致？

[显然，这是该标准的一个相对较新的成员](http://en.wikipedia.org/wiki/Order_by_(SQL))。

> SQL 标准的核心功能没有明确定义 Null 的默认排序顺序。使用 SQL:2003 扩展 T611“基本 OLAP 操作”，可以分别使用 ORDER BY 列表的 NULLS FIRST 或 NULLS LAST 子句将空值排序在所有数据值之前或之后。然而，并非所有 DBMS 供应商都实现了此功能。未实现此功能的供应商可能会为 DBMS 中的 Null 排序指定不同的处理方式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T00:48:33.963

在 oracle 中，您可以这样做：

```
ORDER BY value NULLS FIRST 
```

或者

```
ORDER BY value NULLS LAST 
```

在 SQL Server 中尝试

# asp.net - Windows Server 2003 sp2 杀死 ASP.NET 1.1 Web 应用程序

> ID：319389
> 
> 赞同：0
> 
> 时间：2008-11-26T00:48:19.720
> 
> 标签：asp.net, windows-server-2003

我们最近将我们的 Intranet 开发服务器 (Windows Server 2003) 升级到了最新最好的补丁，包括 2k3 sp2 和每个 .NET 版本的最新补丁。

我们使用了多种技术，包括 COM+、ASP、ASP.NET 1.1、ASP.NET 2.0 和 ColdFusion。所以测试可能会很有趣，因为这些技术并不总是能很好地结合在一起。

我们已经应用了一个热修复来解决 COM+ 问题。当前的问题围绕着这样一个事实，即 ASP.NET 1.1 Web 应用程序根本不再工作。任何 aspx 页面都会简单地抛出一个通用的“页面未找到”错误；静态文件（例如 .html）正常返回。相同的代码在我们未打补丁的测试环境中仍然可以正常工作。

虚拟文件夹设置为在它们自己的应用程序池中运行（独立于 ASP.NET 2.0）。我发现的唯一 google-found 提示是将虚拟文件夹的 .NET 更改为 2.0。它似乎确实有效，但我担心它会占用服务器（因为这是过去有人不小心没有正确配置应用程序的 .NET 池时发生的情况）。

虽然我们的计划是完成将现有应用程序升级到 2.0，但短期内不会发生。有没有让我搜索不到的热修复？或者也许有人已经实施了另一种解决方法？

**附加信息：**

有问题的两台服务器都是 32 位的。这是 IIS 日志中有关 404 错误的片段：

2008-11-25 23:58:41 10.150.1.31 GET /revenue/MailerAdmin.aspx - 80 - 10.1.3.18 Mozilla/4.0+(兼容;+MSIE+7.0;+Windows+NT+5.1;+MPI+INTERNAL; +InfoPath.2;+.NET+CLR+1.1.4322;+.NET+CLR+2.0.50727;+MS-RTC+LM+8;+.NET+CLR+3.0.04506.30;+.NET+CLR+ 3.0.04506.648；+MPI+内部；+.NET+CLR+3.0.4506.2152；+.NET+CLR+3.5.30729；+MPI+内部）404 2 1260

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-28T11:52:49.570

您可以[在此处](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/0f4ac79a-dc2b-4a5f-89c1-d57266aa6ffe.mspx?mfr=true)查找 404 2 1260 错误。查看 IIS 管理器下的“Web 服务扩展”文件夹。验证 ASP.NET v1.1.4322 是否已注册并被允许。如果不。使用 .net 目录中的 aspnet_regiis.exe 工具。

# mfc - 未重绘 WS_EX_TRANSPARENT 样式的静态控件

> ID：319393
> 
> 赞同：0
> 
> 时间：2008-11-26T00:49:09.050
> 
> 标签：mfc, user-controls, gdi, cwnd

我正在尝试创建一个在绘制 32 位位图时实现每像素 alpha 混合的控件。

我扩展了 CWnd 并在资源编辑器中使用静态控件。我设法正确地绘制了 alpha 通道，但静态控件仍然继续绘制灰色背景。

我覆盖了 OnEraseBkgnd 以防止控件绘制背景，但它没有用。我终于设法通过使用 WS_EX_TRANSPARENT 做到了。

我现在的问题是我的控制权置于其他控制权之上。第一次绘制对话框时一切正常……但如果我单击“父”控件（即我控制下的那个），我的控件不会收到 WM_PAINT 消息。所以不再画了。

如果我最小化应用程序并再次最大化它，则再次绘制控件。

拜托，谁能给个提示？我对这个控制感到疯狂！！！

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-27T03:35:48.243

我会认为，如果您同时处理**WM_ERASEBKGND**和**WM_PAINT**消息，那么您应该涵盖所有绘画选项，而不必求助于使用**WS_EX_TRANSPARENT**样式。

您确定您的代码**没有将**这些消息传递给**默认处理**吗？

另一种选择可能是对静态控件进行**子类**化，以确保您的代码是唯一处理这两条消息的代码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-12-15T19:53:52.607

```
BEGIN_MESSAGE_MAP(CTransparentStatic, CStatic)
    ON_WM_ERASEBKGND()
    ON_WM_CTLCOLOR_REFLECT()
END_MESSAGE_MAP()

BOOL CTransparentStatic::OnEraseBkgnd(CDC* /*pDC*/)
{
    // Prevent from default background erasing.
    return FALSE;
}

BOOL CTransparentStatic::PreCreateWindow(CREATESTRUCT& cs)
{
    cs.dwExStyle |= WS_EX_TRANSPARENT;
    return CStatic::PreCreateWindow(cs);
}

HBRUSH CTransparentStatic::CtlColor(CDC* pDC, UINT /*nCtlColor*/)
{
    pDC->SetBkMode(TRANSPARENT);
    return reinterpret_cast<HBRUSH>(GetStockObject(NULL_BRUSH));
}

void CTransparentStatic::PreSubclassWindow()
{
    CStatic::PreSubclassWindow();

    const LONG_PTR exStyle = GetWindowLongPtr(m_hWnd, GWL_EXSTYLE);
    SetWindowLongPtr(m_hWnd, GWL_EXSTYLE, exStyle | WS_EX_TRANSPARENT);
} 
```

# c++ - 指针指针方法 C++

> ID：319395
> 
> 赞同：0
> 
> 时间：2008-11-26T00:50:35.333
> 
> 标签：c++, pointers, methods

我有两个问题：

1）如何创建一个指向整数对象的数组？

```
int* myName[5];  // is this correct? 
```

2）如果我想返回一个指向数组的指针，它指向对象（如（1）），我该如何在方法中做到这一点？即）我想暗示该方法：

```
int **getStuff() {
// what goes here?
return *(myName); // im pretty sure this is not correct
} 
```

谢谢您的帮助！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-26T00:55:05.760

> 如何创建一个指向对象的数组？

```
int * myName[5]; /* correct */ 
```

> 如果我想返回一个指向数组的指针，它指向对象（如（1）），我该如何在方法中做到这一点？

从技术上讲，您编写此函数：

```
int * (* getStuff() )[5] {
    return &myName;
} 
```

这将返回一个指向该数组的指针。但是，您不想这样做。您想返回*指向数组第一个元素的指针*：

```
int ** getStuff() {
    return myName; /* or return &myName[0]; */
} 
```

这样，您现在可以随心所欲地访问项目`getStuff()[0] = &someInteger;`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T02:44:19.097

请注意，您的代码，

```
int* myName[5]; 
```

声明一个包含 5 个值的数组，每个值都是“指向 int 的指针”，这就是您所要求的。

然而，这是 C++，仅此而已。作为一名 Python 脚本编写者，这可能会给您带来一些惊喜。

它没有给这 5 个指针中的任何一个提供合理的值，也没有为它们创建任何整数来指向。

如果你把它放在一个函数体中，那么它会在堆栈上创建数组。这意味着当当前范围结束时数组将不复存在（简单地说，这意味着当你到达封闭的闭卷曲时，例如 return 就可以了）。因此，特别是以下代码是不好的：

```
int **myFunction() {
    int *myArray[5];
    return myArray;
} // <-- end of scope, and return takes us out of it 
```

它可能会编译，但该函数返回一个指针，该指针指向调用者看到它时不再存在的东西。这导致了我们所说的“未定义行为”。

如果您希望数组存在于创建它的函数之外，您可以在每次调用函数时在堆上创建一个，并返回一个指针，如下所示：

```
int **myFunction() {
    int **myArray = new int[5];
    return myArray;
} 
```

每次调用该函数都会返回一个不同的数组。当调用者完成它时，它应该销毁数组，如下所示：

```
delete[] myArray; 
```

否则它将永远不会被释放，并且会永远占用内存（或者当您的程序在大多数操作系统上退出时）。

或者，您可以使用关键字“静态”来创建具有“全局存储持续时间”的数组（这意味着只要程序正在运行，它就存在，但每次只有一个而不是一个新的）。这意味着该函数每次调用时都返回相同的数组。调用者可以在其中存储一些指针，忘记它，再次调用该函数，并看到相同的指针仍然存在：

```
int **myFunction() {
    static int *myArray[5];
    return myArray;
} 
```

请注意，此代码与之前非常糟糕的代码有多么相似。

最后，如果你只想创建一个整数数组，而不是一个指向整数的指针数组，你可以这样做：

```
int myArray[5] = { 1, 2, 3, 4, 5}; 
```

这实际上创建了 5 个整数（意思是，它分配了可以自己存储整数值的空间。这与指针数组不同，指针数组存储用于存储整数值的空间地址）。

它还将指定的值存储在该空间中：myArray[0] 现在是 1，myArray[1] 是 2，等等。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T00:55:27.833

1) 正确 - 这是一个由 5 个指向`int`s的指针组成的数组

2) 您可以`int`通过返回指向该数组第一个元素的指针来返回指向指向 s 的指针数组的指针。这有两个间接级别，因此您需要两个星号。您也可以正常返回数组，因为数组会自动衰减为指向其第一个元素的指针。

```
int **getStuff() {
    return myName;       // 1
    return &myName[0];   // 2
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-26T00:57:47.113

```
int **myName;

int **getStuff() {
  int **array = new int*[5];

  for (int i = 0; i < 5; i++)
  {
    int key = i;
    array[i] = &key;
  }

  return array;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T14:55:36.127

史蒂夫杰索普，我想你的意思是：

```
int **myFunction() {
    int **myArray = new int*[5];
    return myArray;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-08-06T20:28:01.340

这将返回一个可测试和可删除的堆数组指针（不是指向其元素的指针）。没有任何泄漏。

```
template <class T>
T* newarray(int len)
    {
        T *a;
        try
           {
               a = new T[len];
               memset(a,0,len*sizeof(T));
               return a;
           }
        catch (...)         
           {return 0;}
    } 
```

. . .

```
void foo()
    {
        float *f=0;
        f=newarray<float>(1000000);
        if(!f) return;
        //use f
        delete [] f;
    } 
```

# c# - 可以修改 Linq To SQL 生成的 C# 吗？

> ID：319401
> 
> 赞同：2
> 
> 时间：2008-11-26T00:54:11.737
> 
> 标签：c#, linq-to-sql, templates, code-generation

能够以某种方式说生成的实体类中的某些属性应该由（例如）验证属性（以及 Linq To SQL 列属性）修饰，这将非常方便。

它是某个地方的 T4 模板吗？或者还有其他方法可以给猫剥皮吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T11:48:04.180

Damien Guard 编写了可自定义的 T4 模板。看：

[http://damieng.com/blog/2008/09/14/linq-to-sql-template-for-visual-studio-2008](http://damieng.com/blog/2008/09/14/linq-to-sql-template-for-visual-studio-2008)

...和：

[http://visualstudiomagazine.com/listings/list.aspx?id=560](http://visualstudiomagazine.com/listings/list.aspx?id=560)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T00:57:33.947

不，SqlMetal 工具用于处理 C# 的生成，它在其内部定义了 C# 的生成方式（或 VB 的生成方式）。

我不熟悉您想要的模板样式，但您可以尝试扩展生成的类（如果它们没有那么大的变化），因为它们只是部分类。

否则，您将需要编写/查找 SqlMetal 的自定义实现

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T04:52:28.263

不幸的是，对于部分类，您不能将属性添加到部分类的另一部分的成员中 - 即，如果 SqlMetal 定义了 property `Foo`，则不能`Foo`在您自己的一半中添加属性`.cs`。

这消除了自定义此类文件的（通常）更强大的方法之一......您可能不得不抓住机会手动编辑生成的文件（在将其与 dbml 完全分离之后） - 或者编写自己的 dbml解析器 frmo 从头开始​​（可能使用 xslt）。不容易。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T12:43:21.410

动态数据中的解决方法是使用可以修饰的元数据类：

```
[MetadataType(typeof(Product_Meta))]
 public partial class Product
 {        
   public partial class Product_Meta 
   {
     [Range(5, 50, ErrorMessage = "The product's reorder level must be greater than 5 and less than 50")]
     public object ReorderLevel { get; set; }         
   }  
 } 
```

[http://rachelappel.com/asp-net-dynamic-data/custom-validation-in-asp-net-dynamic-data-using-attributes/](http://rachelappel.com/asp-net-dynamic-data/custom-validation-in-asp-net-dynamic-data-using-attributes/)

# image - 无情地为网络压缩大图像

> ID：319403
> 
> 赞同：8
> 
> 时间：2008-11-26T00:55:01.423
> 
> 标签：image, optimization, photoshop

我有一个非常大的背景图像（大约 940x940 像素），我想知道是否有人有压缩比 Photoshop 可以处理的这么大的文件的提示？Photoshop 中没有严重质量损失的最佳压缩格式是 PNG 8 (250 KB)；有谁知道比这更进一步压缩图像的方法（也许在保存PNG后压缩它）？

我通常不处理优化这么大的图像，所以我希望有人能提供一些指导。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-26T01:08:17.777

这首先取决于您要压缩的图像类型。两个基本类别是：

*   图片
*   插图

**对于图片**（例如照片），像[JPEG这样的](http://en.wikipedia.org/wiki/JPEG)[有损压缩](http://en.wikipedia.org/wiki/Lossy_compression)格式是最好的，因为它会删除人类视觉感知不容易注意到的细节。这将允许非常高的质量压缩率。缺点是过度压缩会导致非常明显的[压缩伪影](http://en.wikipedia.org/wiki/Compression_artifact)。

**对于包含大面积相同颜色的插图**，使用[无损压缩](http://en.wikipedia.org/wiki/Lossless_data_compression)格式（如[PNG](http://en.wikipedia.org/wiki/Portable_Network_Graphics)或[GIF](http://en.wikipedia.org/wiki/Graphics_Interchange_Format) ）将是最好的方法。尽管技术上不正确，但您可以认为 PNG 和 GIF 可以很好地压缩相同颜色的重复，类似于[游程编码](http://en.wikipedia.org/wiki/Run-length_encoding)(RLE)。

现在，正如您特别提到的 PNG，我将根据我使用 PNG 的经验进行讨论。

首先，进一步压缩 PNG 不是一个可行的选择，因为**无法压缩已经压缩的数据**。任何数据压缩都是如此；从源数据中去除[熵](http://en.wikipedia.org/wiki/Entropy_(information_theory))（基本上，可以以更紧凑的方式表示的重复模式）导致存储信息所需的空间量减少。PNG 已经采用了以无损方式有效压缩图像的方法。

也就是说，至少有一种可能的方法可以进一步降低 PNG 的大小：**减少存储在图像中的颜色数量**。通过使用“索引颜色”（基本上在图像本身中嵌入自定义调色板），您可以减小文件的大小。但是，如果图像开始时有多种颜色（例如具有颜色渐变或照片图像），那么您可能无法减少图像中使用的颜色数量而不会明显降低质量。

基本上它会归结为一些反复试验，看看图像的更改是否会导致图像质量和文件大小的任何变化。

* * *

Paul Fisher 的评论提醒我，我可能也不建议使用 GIF。Paul 指出，在几乎所有情况下，PNG 都比 GIF 更好地压缩静态线条艺术。

我还要指出，GIF 仅支持 8 位图像，因此如果图像具有超过 256 种颜色，则必须减少使用的颜色。

此外，Kent Fredric 关于减少颜色深度的评论在某些情况下会导致文件大小增加。[尽管这是推测，但抖动](http://en.wikipedia.org/wiki/Dithering#Digital_photography_and_image_processing)可能会导致图像的可压缩性降低（因为抖动会引入具有不同颜色的像素来模拟某种其他颜色，就像混合不同颜色的颜料最终得到另一种颜色）通过在图像中引入更多的熵。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-26T01:03:31.423

看看[http://www.irfanview.com/](http://www.irfanview.com/)，是一个老字号，但一个好东西。

发现这能够很好地进行多通道 png 压缩，并且比 PS 更快地进行批处理。

这里也有PNGOUT [http://advsys.net/ken/utils.htm](http://advsys.net/ken/utils.htm)，这显然非常好。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-26T01:26:35.387

这是其他海报可能没有注意到我通过实验发现的一点：

在某些安装中，默认行为是将图像颜色配置文件的完整副本与图像一起保存。

也就是说，设备校准图，通常是 SRGB 或类似的东西，它告诉使用代理如何最好地将颜色映射到真实世界的颜色，而不是与设备无关的颜色。

然而，这个图像配置文件非常大，并且可以使一些您认为非常小的文件变得非常大，例如，一个 1px x 1px 的图像消耗大量 25kb。即使是纯 BMP 格式（未压缩）也可以代表少 1 个像素。

Web 通常不需要此配置文件，因此，在保存您的 Photoshop 图像时，请确保在**没有**此配置文件的情况下导出它们，您会注意到显着的尺寸改进。

您可以使用 gimp 等其他工具去除这些数据，但如果文件很多，则可能会有点耗时。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-29T00:57:46.943

[pngcrush](http://pmt.sourceforge.net/pngcrush/)可以进一步压缩 PNG 文件而不会丢失任何数据，它应用不同的编码和压缩选项组合来查看哪个效果最好。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-26T01:02:17.417

如果图像本质上是摄影图像，则在质量损失相同的情况下，JPEG 将比 PNG8 压缩得多。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-26T01:04:15.367

[Smush.It](http://www.smushit.com/ "捣蛋")声称“超越了 Photoshop 的限制”。它是免费的和基于网络的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-26T01:02:01.440

这在很大程度上取决于图像的类型。如果它有很多纯色和图案，那么 PNG 或 GIF 可能是你最好的选择。但是，如果它是照片般逼真的图像，那么 JPG 会更好 - 您可以将 JPG 的质量降低到您正在寻找的压缩/质量权衡的程度（Photoshop 非常擅长向您展示调整质量时的最终图像）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-26T01:07:53.817

“保存后压缩PNG”部分对我来说似乎是一个深刻的误解。你不能神奇地压缩超过某个点而不会丢失信息。

首先要考虑的一点是分辨率是否必须这么大。在两个方向上将分辨率降低 10% 会使文件大小减小 19%。

接下来，尝试几种不同的压缩算法，它们具有不同的压缩等级与信息/质量损失。如果图像是粗略的，您可能会使用非常严格的 JPEG 压缩。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-26T01:30:45.360

我会把它平铺，除非你绝对确定你的听众有带宽。

接下来是jpeg2k。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-27T14:17:34.827

要从 JPEG 文件中获得更多信息，您可以使用“另存为 Web”对话框的“修改的质量设置”。

1.  创建一个包含白色的蒙版/选择，您希望在其中保留最详细的信息，例如文本周围的 eq。您可以使用 Quick-Mask 使用画笔绘制蒙版。它有助于羽化选择，这会在下一步中产生漂亮的白到黑过渡。
2.  将此掩码/选择保存为通道并为通道命名
3.  使用文件->另存为网页
4.  选择 JPEG 作为文件格式
5.  在质量框旁边有一个带有圆圈的小按钮。点击那个。在步骤 2 中选择保存的频道，并使用频道内容的白色和黑色部分的质量设置进行播放。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-06-28T20:05:19.627

[http://www.jpegmini.com](http://www.jpegmini.com)是一项新服务，可以创建文件大小非常小的标准 jpg。我已经取得了很好的成功。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-01-04T09:03:47.453

为了获得最佳质量的单张图像，我强烈推荐[RIOT](http://luci.criosweb.ro/riot/)。除了更改后的图像，您还可以看到原始图像。

该工具是免费的，非常值得一试。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-26T01:01:44.703

PNG图像已经在内部进行了压缩，这种压缩方式并不能从更多的压缩中受益（如果您尝试压缩它，实际上可能会扩展）。

你可以：

*   将分辨率从 940x940 降低到更小的分辨率，例如 470x470。
*   减少颜色深度
*   使用 JPEG 等有损压缩工具进行压缩

**编辑：**当然 250KB 对于网络背景来说很大。您可能还想重新考虑需要这样做的图形设计。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-26T01:06:46.393

JPEG2000 对照片质量图像的压缩率明显高于 JPEG（或 PNG）。此外，JPEG2000 具有“有损”和“无损”压缩选项，可以根据您的个人需求进行很好的调整。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-11-26T01:08:55.373

我一直很幸运使用 jpeg。确保将 Photoshop 配置为不自动将缩略图保存在 jpeg 中。根据我的经验，我通过使用 3 次渐进压缩获得了最大的 bang/buck 比，尽管基线优化效果很好。选择非常低的质量级别（例如 2 或 3）并进行试验，直到找到一个好的折衷方案。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-08-01T07:52:43.647

[Cesium](http://caesium.sourceforge.net/)是我见过的最好的工具。

# c# - 使用 Linq 从 XElement 中提取 Byte[] 到 Xml

> ID：319407
> 
> 赞同：0
> 
> 时间：2008-11-26T00:57:14.587
> 
> 标签：c#, xml, linq, linq-to-xml, xelement

我通过以下 XElement 构造将一些小图像作为 Byte[] 保存到 Xml 中。

```
XElement xe = new XElement("Images",
            from c in qry
            select new XElement("Image", new XAttribute("Date", c.Date),
              new XElement("Data", c.Bytes))); 
```

Bytes 属性是一个 Byte[]，查看结果元素，数组的内容似乎保存得很好。

我的问题是我似乎无法简单地读回来。检索此元素的最佳方法是什么？似乎不允许对 Byte[] 进行类型转换，我真的必须将其作为字符串读取吗？弄清楚要使用和转换什么编码？在我看来，鉴于 XElement 了解如何编写数组，它也应该能够读取它。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-26T03:41:50.947

我会考虑对字节数组进行 Base64 编码。从字节数组编码/解码它应该相当容易。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-01-22T16:13:15.470

这很有帮助，谢谢。有关编码示例，请参见：

[http://www.nowan.hu/main.aspx?content=9cff1555-26ca-4e6a-910b-6a73463e22b2](http://www.nowan.hu/main.aspx?content=9cff1555-26ca-4e6a-910b-6a73463e22b2)

# asp.net - 我能怎么做 在 ASP.Net 中的搜索表单？

> ID：319413
> 
> 赞同：14
> 
> 时间：2008-11-26T01:00:18.247
> 
> 标签：asp.net, forms, methods, get

我正在开发的应用程序中有一个搜索表单，我希望它相当于`method="GET"`.

因此，当单击搜索按钮时，用户会转到`search.aspx?q=the+query+he+entered`

我想要这个的原因只是可添加书签的 URL，而且这样做感觉更干净。

我也不希望将 viewstate 隐藏字段值附加到 URL 上。

我能想到的最好的办法是：

1.  捕获按钮和的服务器端点击事件`Response.Redirect`。
2.  将 Javascript`onclick`处理程序附加到触发`window.location.replace`.

两者都感觉古怪和次优......你能想出更好的方法吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-26T01:15:00.167

使用普通的旧 html 表单，而不是服务器端表单 (runat=server)，您确实应该能够使其工作。

但是，如果您有一个开箱即用的 Visual Studio 母版页，它将整个页面包装在服务器端表单中，这可能是一个问题，因为您不能嵌套表单。

Web 表单不一定很糟糕，但默认实现通常会这样做。您不必为所有事情都使用 Web 表单。有时普通的旧 post/get 和处理请求代码就可以了。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-04-12T17:55:17.660

我在一个网站上工作，该网站必须发布到第三方网站才能在客户的网站上进行搜索。我最终做了一个简单的 Response.Redirect 并通过查询字符串传递了搜索参数，如下所示：

```
protected void Button1_Click(object sender, EventArgs e)
{
    string SearchQueryStringParameters = @"?SearchParameters=";
    string SearchURL = "Search.aspx" + SearchQueryStringParameters;

    Response.Redirect(SearchURL);
} 
```

在您的页面加载中的 Search.aspx 页面上...

```
protected void Page_Load(object sender, EventArgs e)
{
    if (!string.IsNullOrEmpty(Request.QueryString["SearchParameters"]))
    {
        // prefill your search textbox
        this.txtSearch.Text = Request.QueryString["SearchParameters"];

        // run your code that does a search and fill your repeater/datagrid/whatever here
    }
    else
    {
        // do nothing but show the search page
    }
} 
```

希望这可以帮助。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-11-04T02:04:26.170

此功能允许使用 GET 方法提交页面。

要使用 get 方法提交页面，您需要：

1.  添加此代码 **Form.Method="get";** 在 Page_Load 方法中
2.  使用此代码**< asp:Button runat="server" ID="btnGenerate" />**作为提交按钮
3.  将 **rel="do-not-submit"**属性添加到您不想包含在查询字符串中的所有表单元素
4.  **使用Request.QueryString**更改页面的代码隐藏逻辑
***   **使用EnableViewState="false"**禁用页面视图状态（除非它用于其他目的）**

 ****代码**

```
$(document).ready(function(){ enableSubmitFormByGet(); });

function enableSubmitFormByGet(){
   if($("form").attr("method") == "get"){
        $("form").submit(function() {
            $("[name^=" + "ctl00" + "]").each(function(i){
            var myName = $(this).attr("name");
            var newName = "p" + (i-1);
            $(this).attr("name", newName);
        });
     var qs =$(this).find("input[rel!='do-not-submit'],textarea[rel!='do-not-submit'],select[rel!='do-not-submit'],hidden[rel!='do-not-submit']").not("#__VIEWSTATE,#__EVENTVALIDATION,#__EVENTTARGET,#__EVENTARGUMENT").serialize();
     window.document.location.href = "?" + qs;
     return false;
}); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T03:12:16.153

我会做（b），因为（a）单个查询需要两次往返。或者，您可以禁用页面上的视图状态，通过 javascript 删除任何其他隐藏字段，还可以使用 javascript 将表单方法从 post 修改为 get。我从来没有真正做到这一点，但我的玩具页面使用包含的样本就像一个魅力。可以说它比编码搜索字符串和通过 javascript 进行获取更容易。

实际上，听起来您会更喜欢使用 ASP.NET MVC，因为这很容易通过在视图中将表单方法设置为 GET 来实现。

使用 jquery 的示例代码

```
 $(document).ready( function() {
     $('input[type=hidden]').remove();
     $('form').attr('method','get');
 }); 
```

**编辑：**似乎您也应该能够在服务器端做同样的事情。也许在 OnPreRenderComplete 中。目前无权访问 Visual Studio 进行检查。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T03:28:21.193

我一直使用 Response.Redirect 因为它“有效”。

我认为没有最佳方法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-01-20T19:21:08.920

只需在表单提交之前的 .click 事件中使用它：

```
 $("#__VIEWSTATE").remove();
    $("#__EVENTVALIDATION").remove(); 
```

# c# - ASP.NET - xslt 转换生成的控件

> ID：319422
> 
> 赞同：1
> 
> 时间：2008-11-26T01:05:14.820
> 
> 标签：c#, asp.net, xml, xslt

我正在通过 xslt 转换从 xml 文件在我的 asp.net 页面上动态生成控件。稍后我将需要从后面的代码中引用这些控件。我想在创建过程中将这些引用添加到列表/哈希表/任何内容（我想在 xslt 文件中），以便我以后可以找到它们，但我不知道该怎么做。我将非常感谢任何建议，agnieszka

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-26T09:40:38.507

使用 XSLT 转换 XML 后，您可以将输出传递给 ASP.Net [ParseControl](http://msdn.microsoft.com/en-us/library/kz3ffe28.aspx)方法，它将返回可供使用的控件。例如，此代码将在页面上放置两个按钮：

```
protected void Page_Load(object sender, EventArgs e)
{
    // Fetch your XML here and transform it.  This string represents
    // the transformed output
    string content = @"
        <asp:Button runat=""server"" Text=""Hello"" />
        <asp:Button runat=""server"" Text=""World"" />";

    var controls = ParseControl(content);

    foreach (var control in controls)
    {
        // Wire up events, change settings etc here
    }

    // placeHolder is simply an ASP.Net PlaceHolder control on the page
    // where I would like the controls to end up
    placeHolder.Controls.Add(controls);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T01:25:35.573

你能更好地了解你正在尝试做什么吗？

XML > XSLT > 生成 aspx 页面

听起来接近于重新发明 Windows 演示框架或 XUL

还是 ASPX 读取 xml > 使用 XSLT 将 DOM 元素添加到页面...听起来像 AJAX

您想使用属性转换写出唯一的 ID [http://www.w3schools.com/XSL/el_attribute.asp](http://www.w3schools.com/XSL/el_attribute.asp)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T02:11:51.473

使用纯 XSL 解决方案可能会很棘手。

您可以调用一个模板，该模板迭代您正在使用的 xml 节点生成控件，并写出 ac#/VB 脚本块，将它们添加到您选择的容器中。

另一种选择可能是将 msxsl:script 添加到您的模板中，并使用 c# 或其他语言生成您想要的输出。这有时比纯 xsl 解决方案更容易，但确实会带来性能成本。

可能值得看一下 umbraco 的源代码，它大量使用 xsl，并且可能已经完成了您正在寻找的工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T12:09:52.887

感谢所有的答案。

这就是我所做的（这不是我的代码，但我正在这样做）：

private void CreateControls() { XPathDocumentsurveyDoc = new XPathDocument(Server.MapPath("ExSurvey.xml"));

```
// Load the xslt to do the transformations
XslTransform transform = new XslTransform();
transform.Load(Server.MapPath("MakeControls.xslt"));

// Get the transformed result
StringWriter sw = new StringWriter();
transform.Transform(surveyDoc, null, sw);
string result = sw.ToString();

// parse the control(s) and add it to the page
Control ctrl = Page.ParseControl(result);
form1.Controls.Add(ctrl); 
```

}

第一个解决方案（来自通用错误）不够好，因为我需要识别控件，例如在 xslt 转换期间，我将创建 3 组控件，它们都有不同的 id。我想将组中的每个控件的引用放在不同的哈希表中，以便稍后我知道每个组中有哪些控件。

最好的解决方案是在创建控件时以某种方式做到这一点（所以在 xslt 代码中..），但我不知道这是否可能。

# php - mysqli->error: 是只针对最后一个查询，还是针对查询组的最后一个错误？

> ID：319423
> 
> 赞同：1
> 
> 时间：2008-11-26T01:05:29.670
> 
> 标签：php, mysql, mysqli, transactions

我是 mysqli 的新手，并试图确认如果我像下面这样，errno 将设置为最后一个错误（如果有），而不是最后一个查询的错误。

这是一种体面的做法，还是我应该检查每个查询之间的错误？

谢谢！

```
$mysqli->autocommit(FALSE);

$mysqli->query("INSERT INTO .....");
$mysqli->query("INSERT INTO .....");
$mysqli->query("INSERT INTO .....");
$mysqli->query("INSERT INTO .....");
$mysqli->query("INSERT INTO .....");

if ( 0==$mysqli->errno ) {
    $mysqli->commit();
} else {
    $mysqli->rollback();
    // Handle error
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-26T01:09:41.893

否 - 它报告最后一次 mysqli 函数调用的错误代码。零表示上次函数调用没有发生错误。所以如果中间的一个失败了，你不会通过只在最后检查来知道它。

换句话说，是的，你需要在每次函数调用后检查错误代码。请注意，错误也由 的返回值指示`$mysqli->query()`。[解释 mysqli_errno](http://php.net/mysqli.errno)文档中的示例：

```
if (!$mysqli->query("INSERT ...")) {
    printf("Errorcode: %d\n", $mysqli->errno);
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T01:10:29.740

mysqli_errno — 返回**最近一次函数调用**的错误代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-02-22T10:47:09.563

不，您必须在每个查询之间进行检查，因为它总是会给您最后一次查询的错误...因此，如果您的第一个查询失败并且最后一次正确执行，那么您将不会收到错误...所以在所有查询之后逐个检查终于没有了……

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-03-19T04:41:27.297

IMO 捕获所有错误的最佳方法和最简单的方法是扩展 mysqli 类：

```
class DBException extends Exception {
}
class DBConnectException extends DBException {
}
class DBQueryException extends DBException {
}

class DB extends MySQLi {
    private static $instance = null;

    private function __construct() {
        parent::__construct('host',
                            'username',
                            'passwd',
                            'dbname');

        if ($this->connect_errno) {
            throw new DBConnectException($this->connect_error, $this->connect_errno);
        }
    }

    private function __destructor() {
        parent::close();
    }

    private function __clone() {
    }

    public static function getInstance() {
        if (self::$instance == null) {
            self::$instance = new self();
        }
        return self::$instance;
    }

    public function query($query, $resultmode = MYSQLI_STORE_RESULT) {
        $result = parent::query($query, $resultmode);
        if (!$result) {
            // or do whatever you wanna do when an error occurs
            throw new DBQueryException($this->error, $this->errno);
        }
        return $result;
    }
} 
```

# python - 如何进行不区分大小写的字符串比较？

> ID：319426
> 
> 赞同：683
> 
> 时间：2008-11-26T01:06:44.613
> 
> 标签：python, comparison, case-insensitive

如何在 Python 中进行不区分大小写的字符串比较？

我想以一种非常简单和 Pythonic 的方式封装常规字符串与存储库字符串的比较。我还希望能够在使用常规 python 字符串的字符串散列的字典中查找值。

* * *

## 回答 #1

> 赞同：703
> 
> 时间：2008-11-26T01:09:22.220

假设 ASCII 字符串：

```
string1 = 'Hello'
string2 = 'hello'

if string1.lower() == string2.lower():
    print("The strings are the same (case insensitive)")
else:
    print("The strings are NOT the same (case insensitive)") 
```

从 Python 3.3 开始，[casefold()](https://docs.python.org/3/library/stdtypes.html#str.casefold)是一个更好的选择：

```
string1 = 'Hello'
string2 = 'hello'

if string1.casefold() == string2.casefold():
    print("The strings are the same (case insensitive)")
else:
    print("The strings are NOT the same (case insensitive)") 
```

如果您想要一个更全面的解决方案来处理更复杂的 unicode 比较，请参阅其他答案。

* * *

## 回答 #2

> 赞同：656
> 
> 时间：2015-03-25T05:01:44.063

以不区分大小写的方式比较字符串似乎微不足道，但事实并非如此。我将使用 Python 3，因为这里的 Python 2 开发不足。

首先要注意的是，Unicode 中的大小写转换并非微不足道。有文本`text.lower() != text.upper().lower()`，例如`"ß"`：

```
"ß".lower()
#>>> 'ß'

"ß".upper().lower()
#>>> 'ss' 
```

但是，假设您想不区分大小写地比较`"BUSSE"`和`"Buße"`。哎呀，您可能还想比较`"BUSSE"`和`"BUẞE"`相等-这是较新的资本形式。推荐的方法是使用[`casefold`](https://docs.python.org/3/library/stdtypes.html#str.casefold)：

> 海峡 **折叠**()
> 
> 返回字符串的大小写副本。大小写字符串可用于无大小写匹配。
> 
> 大小写折叠类似于小写，但更具侵略性，因为它旨在删除字符串中的所有大小写区别。[...]

不要只使用`lower`. 如果`casefold`不可用，做有`.upper().lower()`帮助（但只是有点）。

然后你应该考虑重音。如果您的字体渲染器很好，您可能会认为`"ê" == "ê"`- 但它没有：

```
"ê" == "ê"
#>>> False 
```

这是因为后者的重音是一个组合字符。

```
import unicodedata

[unicodedata.name(char) for char in "ê"]
#>>> ['LATIN SMALL LETTER E WITH CIRCUMFLEX']

[unicodedata.name(char) for char in "ê"]
#>>> ['LATIN SMALL LETTER E', 'COMBINING CIRCUMFLEX ACCENT'] 
```

处理此问题的最简单方法是[`unicodedata.normalize`](https://docs.python.org/library/unicodedata.html#unicodedata.normalize). 您可能想使用[**NFKD** normalization](http://www.unicode.org/reports/tr15/#Normalization_Forms_Table)，但请随时查看文档。然后一个

```
unicodedata.normalize("NFKD", "ê") == unicodedata.normalize("NFKD", "ê")
#>>> True 
```

最后，这里用函数表示：

```
import unicodedata

def normalize_caseless(text):
    return unicodedata.normalize("NFKD", text.casefold())

def caseless_equal(left, right):
    return normalize_caseless(left) == normalize_caseless(right) 
```

* * *

## 回答 #3

> 赞同：64
> 
> 时间：2012-07-20T05:27:24.537

使用 Python 2，调用`.lower()`每个字符串或 Unicode 对象...

```
string1.lower() == string2.lower() 
```

[...大部分时间都可以工作，但在@tchrist 描述](https://stackoverflow.com/questions/319426/how-do-i-do-a-case-insensitive-string-comparison#comment15293350_319435)的情况下确实不起作用。

假设我们有一个名为的文件，`unicode.txt`其中包含两个字符串`Σίσυφος`和`ΣΊΣΥΦΟΣ`. 使用 Python 2：

```
>>> utf8_bytes = open("unicode.txt", 'r').read()
>>> print repr(utf8_bytes)
'\xce\xa3\xce\xaf\xcf\x83\xcf\x85\xcf\x86\xce\xbf\xcf\x82\n\xce\xa3\xce\x8a\xce\xa3\xce\xa5\xce\xa6\xce\x9f\xce\xa3\n'
>>> u = utf8_bytes.decode('utf8')
>>> print u
Σίσυφος
ΣΊΣΥΦΟΣ

>>> first, second = u.splitlines()
>>> print first.lower()
σίσυφος
>>> print second.lower()
σίσυφοσ
>>> first.lower() == second.lower()
False
>>> first.upper() == second.upper()
True 
```

Σ 字符有两种小写形式，ς 和 σ，`.lower()`不区分大小写对比较它们没有帮助。

但是，从 Python 3 开始，所有三种形式都将解析为 ς，并且在两个字符串上调用 lower() 将正常工作：

```
>>> s = open('unicode.txt', encoding='utf8').read()
>>> print(s)
Σίσυφος
ΣΊΣΥΦΟΣ

>>> first, second = s.splitlines()
>>> print(first.lower())
σίσυφος
>>> print(second.lower())
σίσυφος
>>> first.lower() == second.lower()
True
>>> first.upper() == second.upper()
True 
```

因此，如果您关心像希腊语中的三个 sigma 这样的边缘情况，请使用 Python 3。

（作为参考，Python 2.7.3 和 Python 3.3.0b1 显示在上面的解释器打印输出中。）

* * *

## 回答 #4

> 赞同：50
> 
> 时间：2016-11-11T15:45:56.993

[Unicode 标准的第 3.13 节](http://www.unicode.org/versions/Unicode9.0.0/ch03.pdf#G33992)定义了无大小写匹配的算法。

`X.casefold() == Y.casefold()`在 Python 3 中实现了“默认无大小写匹配”（D144）。

大小写折叠不会在所有实例中保留字符串的规范化，因此需要进行规范化（`'å'`vs. `'å'`）。D145 引入了“规范无大小写匹配”：

```
import unicodedata

def NFD(text):
    return unicodedata.normalize('NFD', text)

def canonical_caseless(text):
    return NFD(NFD(text).casefold()) 
```

`NFD()`对于涉及 U+0345 字符的非常罕见的边缘情况，会调用两次。

例子：

```
>>> 'å'.casefold() == 'å'.casefold()
False
>>> canonical_caseless('å') == canonical_caseless('å')
True 
```

`'㎒'`对于（U+3392）和“标识符无大小写匹配”等情况，还有兼容性无大小写匹配（D146），以简化和优化标识符的无[大小写匹配](http://unicode.org/reports/tr31/)。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2016-07-28T05:24:01.290

我在[这里](https://stackoverflow.com/questions/6579876/how-to-match-a-substring-in-a-string-ignoring-case-in-python)使用[regex](https://docs.python.org/2/library/re.html#re.IGNORECASE)看到了这个解决方案。

```
import re
if re.search('mandy', 'Mandy Pande', re.IGNORECASE):
# is True 
```

它适用于口音

```
In [42]: if re.search("ê","ê", re.IGNORECASE):
....:        print(1)
....:
1 
```

但是，它不适用于不区分大小写的 unicode 字符。谢谢@Rhymoid 指出，因为我的理解是它需要确切的符号才能使案例成立。输出如下：

```
In [36]: "ß".lower()
Out[36]: 'ß'
In [37]: "ß".upper()
Out[37]: 'SS'
In [38]: "ß".upper().lower()
Out[38]: 'ss'
In [39]: if re.search("ß","ßß", re.IGNORECASE):
....:        print(1)
....:
1
In [40]: if re.search("SS","ßß", re.IGNORECASE):
....:        print(1)
....:
In [41]: if re.search("ß","SS", re.IGNORECASE):
....:        print(1)
....: 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2021-03-27T18:53:08.193

您可以使用 casefold() 方法。casefold() 方法在比较时会忽略大小写。

```
firstString = "Hi EVERYONE"
secondString = "Hi everyone"

if firstString.casefold() == secondString.casefold():
    print('The strings are equal.')
else:
    print('The strings are not equal.') 
```

输出：

```
The strings are equal. 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-26T01:09:43.110

通常的方法是将字符串大写或小写以进行查找和比较。例如：

```
>>> "hello".upper() == "HELLO".upper()
True
>>> 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-26T01:09:47.773

先转换成小写怎么样？你可以使用`string.lower()`.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-03-27T18:48:26.087

您可以在 str.contains() 中提及**case=False**

```
data['Column_name'].str.contains('abcd', case=False) 
```

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2008-11-26T22:17:51.740

```
def insenStringCompare(s1, s2):
    """ Method that takes two strings and returns True or False, based
        on if they are equal, regardless of case."""
    try:
        return s1.lower() == s2.lower()
    except AttributeError:
        print "Please only pass strings into this method."
        print "You passed a %s and %s" % (s1.__class__, s2.__class__) 
```

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2018-09-02T11:36:35.357

这是我上周学会爱/恨的另一个正则表达式，所以通常导入（在这种情况下是的）反映我感觉的东西！做一个正常的功能....请求输入，然后使用 ....something = re.compile(r'foo*|spam*', yes.I)...... re.I (yes.I下面）与 IGNORECASE 相同，但你不能在编写它时犯尽可能多的错误！

然后，您使用正则表达式搜索您的消息，但老实说，这应该是它自己的几页，但关键是 foo 或垃圾邮件被一起传送并且忽略大小写。然后，如果找到其中任何一个，则 lost_n_found 将显示其中一个。如果两者都没有，那么 lost_n_found 等于 None。如果它不等于 none，则使用“return lost_n_found.lower()”以小写形式返回 user_input

这使您可以更轻松地匹配任何区分大小写的内容。最后（NCS）代表“没有人认真对待......！” 或不区分大小写....无论哪个

如果有人有任何问题，请告诉我这个..

```
 import re as yes

    def bar_or_spam():

        message = raw_input("\nEnter FoO for BaR or SpaM for EgGs (NCS): ") 

        message_in_coconut = yes.compile(r'foo*|spam*',  yes.I)

        lost_n_found = message_in_coconut.search(message).group()

        if lost_n_found != None:
            return lost_n_found.lower()
        else:
            print ("Make tea not love")
            return

    whatz_for_breakfast = bar_or_spam()

    if whatz_for_breakfast == foo:
        print ("BaR")

    elif whatz_for_breakfast == spam:
        print ("EgGs") 
```

# c# - 在 openGL 中跨两个显示上下文同时更新

> ID：319429
> 
> 赞同：1
> 
> 时间：2008-11-26T01:07:28.200
> 
> 标签：c#, opengl

我有一个 C# .NET 应用程序，我用它创建了一个自定义图像显示控件。每个图像显示代表它自己的显示上下文并使用 glDrawPixels 绘制图像（是的，我知道使用纹理会更好，我计划在未来使用，但这个应用程序已经太远了，我的时间有限）。

我现在正试图让两个图像同时平移。也就是说，当一个图像下移十个像素时，第二个图像下移十个像素。像这样：

```
imageOne.YPan -= 10;
imageTwo.YPan -= 10;
imageOne.Invalidate(); //This forces a redraw.
imageTwo.Invalidate(); //This forces a redraw. 
```

好吧，这就是我遇到的问题。只有一个图像显示正在重绘。如果我在两个 Invalidate 调用之间暂停并使暂停持续时间至少为 110 毫秒，则两者都将重绘，但不会同时重绘。所以看起来第二张图片总是试图赶上第一张。另外，110 毫秒的停顿会使动作减慢太多。

我尝试将每个图像的更新和失效放在它自己的线程中，但这没有帮助。

在绘图开始时，我使适当的上下文是当前的，最后我调用 swapbuffers()。我尝试在绘图函数的末尾添加一个 glFinish，但没有任何变化。

会不会是显卡的问题？我被困在使用只有 openGL 1.4 的集成 gpu 上。

希望我已经提供了足够的细节，可以找到我的问题的答案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T02:11:06.823

Its difficult telling what's wrong with what you do since you give so little detail. Here are some pointers which may help.
- before doing something in a context, make sure you make it the current one. If you want to pan two contexts, make the first one current, pan it and then make the second one current and pan it. These is no real reason why this should not work.
- If it looks like there is a timing problem, adding `glFinish()` at strategic places may help weed the problem out
- As should always be done, on occasions call `glError()` and see that everything went well.
- I'm not sure how this is done in the framework you're talking about but you should make sure that both contexts get a `swapBuffers()` call for every frame.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-04-11T23:23:51.073

`Invalidate`不强制立即重绘。它将窗口标记为无效，当消息队列用完其他消息时，将创建并处理一条绘制消息。但这在您完成处理当前消息并返回主消息循环之前不会发生，并且它可能会延迟更多。

一般来说，OpenGL 动画是在内部`Control.OnPaint`（或在`Control.Paint`事件的处理程序中）进行所有绘制的规则的一个例外。

# java - 使用 Apache POI 的基本 Excel 货币格式

> ID：319438
> 
> 赞同：31
> 
> 时间：2008-11-26T01:09:44.217
> 
> 标签：java, apache-poi

我可以让单元格格式化为日期，但我一直无法让单元格格式化为货币......任何人都有一个如何创建样式以使其正常工作的示例？我下面的代码显示了我正在创建的样式... styleDateFormat 像冠军一样工作，而 styleCurrencyFormat 对单元格没有影响。

```
private HSSFWorkbook wb;
private HSSFCellStyle styleDateFormat = null;
private HSSFCellStyle styleCurrencyFormat = null; 
```

……

```
public CouponicsReportBean(){
    wb = new HSSFWorkbook();
    InitializeFonts();

}

public void InitializeFonts()
{
    styleDateFormat = wb.createCellStyle();
    styleDateFormat.setDataFormat(HSSFDataFormat.getBuiltinFormat("m/d/yy"));

    styleCurrencyFormat = wb.createCellStyle();
    styleCurrencyFormat.setDataFormat(HSSFDataFormat.getBuiltinFormat("$#,##0.00"));

} 
```

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-11-26T06:33:11.180

在深入研究文档后，我找到了答案：

[http://poi.apache.org/apidocs/org/apache/poi/hssf/usermodel/HSSFDataFormat.html](http://poi.apache.org/apidocs/org/apache/poi/hssf/usermodel/HSSFDataFormat.html)

只需要找到合适的预设格式并提供代码。

```
 styleCurrencyFormat.setDataFormat((short)8); //8 = "($#,##0.00_);[Red]($#,##0.00)" 
```

这里有更多例子： [http ://www.roseindia.net/java/poi/setDataFormat.shtml](http://www.roseindia.net/java/poi/setDataFormat.shtml)

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2014-12-03T17:26:07.897

至少对于 Excel 2010：进入 Excel。按照你想要的方式格式化一个单元格。

![在此处输入图像描述](https://i.stack.imgur.com/LjLvV.png)

然后回到格式对话框。选择自定义。

![在此处输入图像描述](https://i.stack.imgur.com/GuqV2.png)

复制粘贴它在 Type: 下顶行的文本到

```
createHelper.createDataFormat().getFormat("<here>"); 
```

例子：

```
createHelper.createDataFormat().getFormat("_($* #,##0.00_);_($* (#,##0.00);_($* \"-\"??_);_(@_)"); //is the "Accounting" format. 
```

**确保使用双精度设置填充单元格。** 使用索引可能会导致不同版本的 Excel 出现问题。请注意，您在上面创建的新格式最终会出现在第二步的自定义对话框中。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-03-28T12:33:15.307

只是对上述回复的更新。简短的“8”对我不起作用，但“7”对我有用。

```
cell.setCellValue(416.17);      
cellStyle.setDataFormat((short)7);
cell.setCellStyle(cellStyle); 
```

O/P 为 416.00 美元

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2015-02-09T16:37:02.763

您可以尝试使用此代码以货币模式格式化您的单元格（使用巴西或德国使用的 thowsand 分隔符。例如 12.345,67）：

```
HSSFCellStyle cell = yourWorkBook.createCellStyle();
CreationHelper ch = yourWorkBook.getCreationHelper();
cell.setDataFormat(ch.createDataFormat().getFormat("#,##0.00;\\-#,##0.00")); 
```

# asp.net - VB.NET 中的引用代码

> ID：319443
> 
> 赞同：0
> 
> 时间：2008-11-26T01:10:32.233
> 
> 标签：asp.net, vb.net, web-services

我一点也不熟悉 VB.NET 或 ASP。我需要创建一个简单的页面来调用远程 Web 服务。我使用 DotNet SDK 附带的 wsdl 实用程序生成服务代理并将其写入 VB 文件。不幸的是，我不知道如何在我的 ASPX 文件或 VB 文件后面的代码中引用此代码，以便创建代理实例。

编辑：我应该通过指出我没有使用 Visual Studio 来证明这一点。我刚刚编写了一个 .aspx，后面有一个 .vb，然后将其放入 IIS 位置。有没有办法在VS之外做你建议的事情？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T01:16:09.713

您需要将此代码添加到您的项目中，以便可以使用它。

右键单击您的 App_Code 文件夹并选择“添加现有项目”。这将调出资源管理器。使用它来选择生成的文件，并将其添加到您的项目中。

现在您将能够从您的页面或代码隐藏文件中引用此代码

如果您的项目中没有 App_Code 文件夹，则在解决方案资源管理器中右键单击该项目并选择“添加新的 ASP.Net 文件夹”->App_Code

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T01:20:56.660

或者，代替 wsdl 实用程序：

在解决方案资源管理器窗口中，右键单击项目，然后选择“添加 Web 引用”。在出现的对话框中，输入 Web 服务的 url。在 Web 参考名称框中（该对话框的右下角），输入您想要调用的服务的本地别名。

因此，如果您输入以下网址：

[http://otherserver.com/otherservice.asmx](http://otherserver.com/otherservice.asmx)

并且，网络参考名称：xyz

要使用它，您的代码如下所示：

```
dim x as new xyz
var = x.methodname() 
```

# iphone - 我可以从 iphone 应用程序发出 POST 或 GET 请求吗？

> ID：319463
> 
> 赞同：26
> 
> 时间：2008-11-26T01:19:19.767
> 
> 标签：iphone, objective-c, cocoa-touch

有没有办法使用 iPhone SDK 获得与 HTTP POST 或 GET 方法相同的结果？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-11-26T23:57:12.490

假设你的类有一个`responseData`实例变量，那么：

```
responseData = [[NSMutableData data] retain];

NSURLRequest *request =
    [NSURLRequest requestWithURL:[NSURL URLWithString:@"http://www.domain.com/path"]];
[[NSURLConnection alloc] initWithRequest:request delegate:self]; 
```

然后将以下方法添加到您的类中：

```
- (void)connection:(NSURLConnection *)connection didReceiveResponse:(NSURLResponse *)response
{
    [responseData setLength:0];
}

- (void)connection:(NSURLConnection *)connection didReceiveData:(NSData *)data
{
    [responseData appendData:data];
}

- (void)connection:(NSURLConnection *)connection didFailWithError:(NSError *)error
{
    // Show error
}

- (void)connectionDidFinishLoading:(NSURLConnection *)connection
{
    // Once this method is invoked, "responseData" contains the complete result
} 
```

这将发送一个 GET。在调用最终方法时，`responseData`将包含整个 HTTP 响应（使用 [[NSString alloc] initWithData:encoding:] 转换为字符串。

或者，对于 POST，将第一个代码块替换为：

```
NSMutableURLRequest *request =
        [NSMutableURLRequest requestWithURL:[NSURL URLWithString:@"http://www.domain.com/path"]];
[request setHTTPMethod:@"POST"];

NSString *postString = @"Some post string";
[request setHTTPBody:[postString dataUsingEncoding:NSUTF8StringEncoding]]; 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-26T04:04:00.513

如果您使用的是 Objective C，则需要使用 NSURL、NSURLRequest 和 NURLConnection 类。[苹果的 NSURLRequest 文档](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSURLRequest_Class/NSURLRequest_Class.pdf)。HttpRequest 用于 JavaScript。

# java - 在 Java 中生成格式化的差异输出

> ID：319479
> 
> 赞同：21
> 
> 时间：2008-11-26T01:25:26.837
> 
> 标签：java, diff

是否有任何 Java 库可以接受两个字符串，并根据 *nix diff 命令返回带有格式化输出的字符串？

例如喂

```
test 1,2,3,4
test 5,6,7,8
test 9,10,11,12
test 13,14,15,16 
```

和

```
test 1,2,3,4
test 5,6,7,8
test 9,10,11,12,13
test 13,14,15,16 
```

作为输入，它会给你

```
test 1,2,3,4                                                    test 1,2,3,4
test 5,6,7,8                                                    test 5,6,7,8
test 9,10,11,12                                               | test 9,10,11,12,13
test 13,14,15,16                                                test 13,14,15,16 
```

就像我将文件传递给`diff -y expected actual`

我发现[了这个问题](https://stackoverflow.com/questions/132478/how-to-perform-string-diffs-in-java)，它为通用库提供了一些很好的建议，可以为您提供编程输出，但我想要直接的字符串结果。

我可以`diff`直接作为系统调用调用，但是这个特定的应用程序将在 unix 和 windows 上运行，我不能确定该环境是否真的`diff`可用。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2011-02-24T14:39:49.510

# [java-diff-utils](http://code.google.com/p/java-diff-utils/)

> DiffUtils 库，用于在 Java 中计算差异、应用补丁、生成并排视图
> 
> Diff Utils 库是一个开源库，用于执行文本之间的比较操作：计算差异、应用补丁、生成统一差异或解析它们、生成差异输出以便于将来显示（如并排视图）等等。
> 
> 构建这个库的主要原因是缺乏易于使用的库，其中包含您在处理差异文件时需要的所有常用内容。最初它受到 JRCS 库的启发，它是 diff 模块的不错设计。
> 
> **主要特点**
> 
> *   计算两个文本之间的差异。
> *   能够比普通的ASCII码更多。正确实现 hashCode() 和 equals() 的任何类型的数组或列表都可以使用此库进行差分
> *   使用给定的补丁修补和取消修补文本
> *   解析统一差异格式
> *   产生人类可读的差异

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-26T05:42:50.203

我最终滚动了自己的。不确定它是否是最好的实现，它丑得要命，但它通过了测试输入。

它使用[java-diff](http://www.incava.org/projects/java/java-diff/)进行繁重的 diff 提升（任何 apache commons StrBuilder 和 StringUtils 而不是股票 Java StringBuilder）

```
public static String diffSideBySide(String fromStr, String toStr){
    // this is equivalent of running unix diff -y command
    // not pretty, but it works. Feel free to refactor against unit test.
    String[] fromLines = fromStr.split("\n");
    String[] toLines = toStr.split("\n");
    List<Difference> diffs = (new Diff(fromLines, toLines)).diff();

    int padding = 3;
    int maxStrWidth = Math.max(maxLength(fromLines), maxLength(toLines)) + padding;

    StrBuilder diffOut = new StrBuilder();
    diffOut.setNewLineText("\n");
    int fromLineNum = 0;
    int toLineNum = 0;
    for(Difference diff : diffs) {
        int delStart = diff.getDeletedStart();
        int delEnd = diff.getDeletedEnd();
        int addStart = diff.getAddedStart();
        int addEnd = diff.getAddedEnd();

        boolean isAdd = (delEnd == Difference.NONE && addEnd != Difference.NONE);
        boolean isDel = (addEnd == Difference.NONE && delEnd != Difference.NONE);
        boolean isMod = (delEnd != Difference.NONE && addEnd != Difference.NONE);

        //write out unchanged lines between diffs
        while(true) {
            String left = "";
            String right = "";
            if (fromLineNum < (delStart)){
                left = fromLines[fromLineNum];
                fromLineNum++;
            }
            if (toLineNum < (addStart)) {
                right = toLines[toLineNum];
                toLineNum++;
            }
            diffOut.append(StringUtils.rightPad(left, maxStrWidth));
            diffOut.append("  "); // no operator to display
            diffOut.appendln(right);

            if( (fromLineNum == (delStart)) && (toLineNum == (addStart))) {
                break;
            }
        }

        if (isDel) {
            //write out a deletion
            for(int i=delStart; i <= delEnd; i++) {
                diffOut.append(StringUtils.rightPad(fromLines[i], maxStrWidth));
                diffOut.appendln("<");
            }
            fromLineNum = delEnd + 1;
        } else if (isAdd) {
            //write out an addition
            for(int i=addStart; i <= addEnd; i++) {
                diffOut.append(StringUtils.rightPad("", maxStrWidth));
                diffOut.append("> ");
                diffOut.appendln(toLines[i]);
            }
            toLineNum = addEnd + 1; 
        } else if (isMod) {
            // write out a modification
            while(true){
                String left = "";
                String right = "";
                if (fromLineNum <= (delEnd)){
                    left = fromLines[fromLineNum];
                    fromLineNum++;
                }
                if (toLineNum <= (addEnd)) {
                    right = toLines[toLineNum];
                    toLineNum++;
                }
                diffOut.append(StringUtils.rightPad(left, maxStrWidth));
                diffOut.append("| ");
                diffOut.appendln(right);

                if( (fromLineNum > (delEnd)) && (toLineNum > (addEnd))) {
                    break;
                }
            }
        }

    }

    //we've finished displaying the diffs, now we just need to run out all the remaining unchanged lines
    while(true) {
        String left = "";
        String right = "";
        if (fromLineNum < (fromLines.length)){
            left = fromLines[fromLineNum];
            fromLineNum++;
        }
        if (toLineNum < (toLines.length)) {
            right = toLines[toLineNum];
            toLineNum++;
        }
        diffOut.append(StringUtils.rightPad(left, maxStrWidth));
        diffOut.append("  "); // no operator to display
        diffOut.appendln(right);

        if( (fromLineNum == (fromLines.length)) && (toLineNum == (toLines.length))) {
            break;
        }
    }

    return diffOut.toString();
}

private static int maxLength(String[] fromLines) {
    int maxLength = 0;

    for (int i = 0; i < fromLines.length; i++) {
        if (fromLines[i].length() > maxLength) {
            maxLength = fromLines[i].length();
        }
    }
    return maxLength;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T01:31:34.190

Busybox 有一个非常精简的 diff 实现，应该不难转换为 java，但您必须添加两列功能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T01:59:39.907

[http://c2.com/cgi/wiki?DiffAlgorithm](http://c2.com/cgi/wiki?DiffAlgorithm)我在 Google 上找到了这个，它提供了一些很好的背景和链接。如果你关心的不仅仅是做项目的算法，一本涵盖动态编程的基本算法的书或一本关于它的书。算法知识总是好的:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-06-06T07:32:29.737

您可以使用[Apache Commons Text](https://commons.apache.org/proper/commons-text/index.html)库来实现这一点。该库基于“来自 Eugene W. Myers 的非常有效的算法”提供了“差异”功能。

这使您能够创建自己的访问者，以便您可以以您想要的方式处理差异，并且可以输出到控制台或 HTML 等。这是一篇文章，介绍[了在 HTML 中并排输出差异的简单示例](http://itsallbinary.com/compare-files-side-by-side-and-hightlight-diff-using-java-apache-commons-text-diff-myers-algorithm/)使用 Apache Commons Text 库和简单的 Java 代码[格式化。](http://itsallbinary.com/compare-files-side-by-side-and-hightlight-diff-using-java-apache-commons-text-diff-myers-algorithm/)

# .net - 如何发布 sql express 数据库？

> ID：319482
> 
> 赞同：1
> 
> 时间：2008-11-26T01:26:18.710
> 
> 标签：.net, sql-server, sql-server-express

我有一个使用 SQL Express 2005 数据库的简单应用程序。当用户关闭应用程序时，我想通过在另一个目录中制作副本来提供备份数据库的选项。但是，当我尝试这样做时，我得到“该进程无法访问文件'...\Pricing.MDF'，因为它正在被另一个进程使用。” 我关闭了连接，处理了连接，将其设置为空，然后使用 GC.Collect()，但没有任何区别。我的连接字符串是“Data Source=.\SQLEXPRESS2005;AttachDbFilename=|DataDirectory|\Pricing.mdf;Integrated Security=True; User Instance=True”，我一直使用相同的连接。我没有看到我可以在哪里分离数据库以对抗连接字符串中的附加。

1 - 我如何释放这个东西？2 - 有没有比复制数据库更好的方法？该应用程序仅供我丈夫使用，因此如果他确实需要从备份中恢复，我将能够处理它。

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-26T03:38:44.120

您不想直接复制 mdf，因为 SQL 将大部分更改保留在事务日志中，运行一些查询后查看修改时间，它不会直接写入文件。我在设置 rsync 作业时注意到了这一点。

让 SQL 生成备份更安全，更理想，单用户或多用户。您可以提供一个指向调用 T-SQL 的函数的链接，您可以完全自动化源数据库和目标文件夹：

```
BACKUP DATABASE [mydatabasename]
TO  DISK = N'C:\Program Files\Microsoft SQL Server\MSSQL.1\MSSQL\Backup\Scheduled Task Backups\mydatabasename-backup' WITH NOFORMAT, NOINIT,  NAME = N'mydatabasename-Full Data 
```

SQL 2005 引入了另一种 T-SQL 语法来执行此操作，我终其一生都找不到它。但是有一些方法可以通过 M$$SQL 来完成，而无需完整的数据库服务器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T02:55:34.817

[这篇文章](http://forums.microsoft.com/msdn/showpost.aspx?postid=487021&siteid=1)中有一个示例展示了如何在程序中备份 SQL Express 数据库。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T03:19:04.613

如果这是*单个用户*或应用程序或只读数据库，*请不要使用 SQL Server Express*。这就是 SQL Server Compact 的用途。这将解决您的备份问题并简化部署。

# java - 让一个线程进入休眠状态，直到另一个线程解决了某个条件

> ID：319485
> 
> 赞同：15
> 
> 时间：2008-11-26T01:27:08.833
> 
> 标签：java, concurrency, locking, conditional-statements, countdownlatch

这是完成（我认为是）同一件事的两段代码。

我基本上是在尝试学习如何使用 Java 1.5 的并发来摆脱 Thread.sleep(long)。第一个示例使用 ReentrantLock，第二个示例使用 CountDownLatch。我想要做的主要是让一个线程进入睡眠状态，直到另一个线程解决了一个条件。

ReentrantLock 在我用来决定是否唤醒另一个线程的布尔值上提供了一个锁，然后我使用带有等待/信号的条件来休眠另一个线程。据我所知，我需要使用锁的唯一原因是如果有多个线程需要对布尔值进行写访问。

CountDownLatch 似乎提供与 ReentrantLock 相同的功能，但没有（不必要的？）锁。然而，感觉就像我通过只需要一个倒计时来初始化它来劫持它的预期用途。我认为它应该在多个线程将要处理同一个任务时使用，而不是在多个线程正在等待一个任务时使用。

所以，问题：

1.  我是否在 ReentrantLock 代码中为“正确的事情”使用了锁？如果我只在一个线程中写入布尔值，是否需要锁？只要我在唤醒任何其他线程之前重置布尔值，我就不会引起问题，可以吗？

2.  是否有一个类似于 CountDownLatch 的类可以用来避免更自然地适合此任务的锁（假设我应该在这种情况下避免它们）？

3.  还有其他方法可以改进我应该注意的代码吗？

示例一：

```
import java.util.concurrent.locks.*;

public class ReentrantLockExample extends Thread {

//boolean - Is the service down?
boolean serviceDown;

// I am using this lock to synchronize access to sDown
Lock serviceLock; 
// and this condition to sleep any threads waiting on the service.
Condition serviceCondition;

public static void main(String[] args) {
    Lock l = new ReentrantLock();
    Condition c = l.newCondition(); 
    ReentrantLockExample rle = new ReentrantLockExample(l, c);

    //Imagine this thread figures out the service is down
    l.lock();
    try {
        rle.serviceDown = true;
    } finally {
        l.unlock();
    }

    int waitTime = (int) (Math.random() * 5000);
    System.out.println("From main: wait time is " + waitTime);
    rle.start();
    try {
        //Symbolizes some random time that the service takes to come back up.
        Thread.sleep(waitTime);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }

    //Imagine this thread figures out that the service is back up.
    l.lock();
    try {
        rle.serviceDown = false;
        c.signal();
    } finally {
        l.unlock();
    }

}

//Constructor
public ReentrantLockExample(Lock l, Condition c) {  
    this.serviceLock = l;
    this.serviceCondition = c; 
}

/*
 * Should wait for this imaginary service to come back online.
 */
public void run() {
    System.out.println("Thread: start awaiting");
    serviceLock.lock();
    try {
        while (isServiceDown())
        {           
            serviceCondition.await();
        }
    } catch (InterruptedException e) {
        // TODO Auto-generated catch block
        e.printStackTrace();
    } finally {
        serviceLock.unlock();
    }
    System.out.println("Thread: done awaiting");
}

private boolean isServiceDown() {       
    return serviceDown;
}
} 
```

示例二：

```
import java.util.concurrent.CountDownLatch;
import java.util.concurrent.TimeUnit;
import java.util.concurrent.locks.*;

public class CountDownLatchExample extends Thread {

    //boolean - Is the service down?
    boolean serviceDown;

    // I am using this latch to wait on the service.
    CountDownLatch serviceLatch; 

    public static void main(String[] args) {
        CountDownLatch cdl = new CountDownLatch(1);     
        CountDownLatchExample cdle = new CountDownLatchExample(cdl);

        //Service goes down.
        cdle.serviceDown = true;        

        int waitTime = (int) (Math.random() * 5000);
        System.out.println("From main: wait time is " + waitTime);
        cdle.start();
        try {
            //Symbolizes some random time that the service takes to come back up.
            Thread.sleep(waitTime);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }

        //Service comes back up.
        cdle.serviceDown = false;
        cdl.countDown();    
    }

    //Constructor 
    public CountDownLatchExample(CountDownLatch cdl) {  
        this.serviceLatch = cdl;         
    }

    /*
     * Should wait for this imaginary service to come back online.
     */
    public void run() {
        System.out.println("Thread: start awaiting");
        try {
            while (isServiceDown()) {           
                serviceLatch.await();
            }
        } catch (InterruptedException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        }
        System.out.println("Thread: done awaiting");
    }

    private boolean isServiceDown() {       
        return serviceDown;
    }
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-26T04:18:20.703

这两种方法大致等效，只是[CountDownLatch](http://java.sun.com/javase/6/docs/api/java/util/concurrent/CountDownLatch.html)只能释放一次。之后，所有[await()](http://java.sun.com/javase/6/docs/api/java/util/concurrent/CountDownLatch.html#await())调用都会立即返回。因此，如果您使用的服务可能会上下波动，那么[CyclicBarrier](http://java.sun.com/javase/6/docs/api/java/util/concurrent/CyclicBarrier.html)实际上可能更合适。

如果您的条件确实是一次性交易，那么[FutureTask](http://java.sun.com/javase/6/docs/api/java/util/concurrent/FutureTask.html)会更合适。您可以调用[get()](http://java.sun.com/javase/6/docs/api/java/util/concurrent/FutureTask.html#get())等待服务可用，然后您可以在 get() 返回后立即使用该服务。

您提到 CountDownLatch 允许在不使用锁的情况下等待。但是，CountDownLatch 和[ReentrantLock](http://java.sun.com/javase/6/docs/api/java/util/concurrent/locks/ReentrantLock.html)都是使用[AbstractQueuedSynchronizer](http://java.sun.com/javase/6/docs/api/java/util/concurrent/locks/AbstractQueuedSynchronizer.html)实现的。在幕后，它们提供相同的同步和可见性语义。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T02:51:57.070

在我看来，锁定/条件变量方法更适合这项任务。这里有一个与您类似的示例：http: [//java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/locks/Condition.html](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/locks/Condition.html)

响应保护布尔值。您可以使用 volatile（[http://www.ibm.com/developerworks/java/library/j-jtp06197.html](http://www.ibm.com/developerworks/java/library/j-jtp06197.html)）。然而，不使用锁的问题在于，根据您的服务关闭的时间长短，您将在 while(isServiceDown()) 上旋转。通过使用条件等待，您可以告诉操作系统让您的线程休眠，直到虚假唤醒（在 java 文档中讨论 Condition），或者直到在另一个线程中发出条件信号。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2015-06-28T23:29:04.363

## [完全重入锁定异步任务示例：](https://github.com/c3ph3us/examples/blob/master/locks/ReEntrantLockedAsyncTask.java)

**使用代码流模式：**

![在此处输入图像描述](https://i.stack.imgur.com/GdOtZ.png)

# java - Updating from Java VM 5 to 6 gave a really big increase of memory consumption

> ID：319506
> 
> 赞同：4
> 
> 时间：2008-11-26T01:34:58.333
> 
> 标签：java, memory, memory-management, jvm

I've be working with a Java application run through the command-line. It deals with XML files, specially the dblp.xml database which has more than 400MB.

I was using JVM 5 and my app needed sort of 600-700MB of memory to processe the dblp.xml. After updating to JVM 6, it starting needing more than 1gb of memory (something I don't have), although it runs a bit faster.

I'm pretty sure of the memory consumption difference, because I've already tested both again and again in this same computer. Resulting in the same difference of memory consumption.

I didn't set any special parameters, just -Xmx800M or -Xmx1000M. Running with Ubuntu Hardy Heron on a dual core 1.7ghz, with 1,5gb of memory Using only the top/ps commands to measure

Any one have an idea why this occurs? I really wanted to use JVM 6, because in my production server it is the JVM in use, and I'm not quite able to change easily.

Thanks

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-26T04:56:28.237

我的建议是使用[JProfiler](http://www.ej-technologies.com/products/jprofiler/overview.html)之类的工具来尝试准确掌握内存消耗增加的位置。如果您不能花在 JProfiler 上，请查看这个[开源 java 分析工具](http://java-source.net/open-source/profilers)列表。

猜测性能问题的原因是一个坏主意，因为您的猜测几乎总是错误的，并且您浪费时间优化系统的错误部分。一旦你有了一些客观的数据，你就可以想出一个优化来减少你的内存消耗。

如果较新的 JVM 确实在用内存换取速度（通过缓存），那么很可能有一个 jvm arg 可以用来阻止这种行为。最好的办法是查看 Java 6 的发行说明，看看是否提到了任何此类功能。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T10:14:13.433

也许您使用了 32 位 1.5 JVM 和 64 位 1.6 JVM？你可以发现，是 32 位还是 64 位 JVM

```
java -version 
```

与 32 位 JVM 相比，64 位 JVM 需要大约 30% 的内存，因为每个引用需要 8 个字节而不是 4 个字节。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T20:01:19.020

> 仅使用 top/ps 命令进行测量

您无法使用`top`或来衡量 JVM 的内存消耗`ps`。

JVM 相当贪婪地保留内存。有时即使没有尝试通过 GCing 释放已经保留的内存，它也会这样做。（您可以尝试指定 -Xms 参数来更改此设置。阅读[此](http://java.sun.com/docs/hotspot/gc5.0/gc_tuning_5.html)内容以了解（更多）更多信息。）

`top`并且`ps`仅显示当前保留的内存量，而不是您的 Java 应用程序实际使用的内存！

如果要正确测量已使用的内存，则必须从 Java 本身进行测量。蛮力方法是：

```
System.gc();
Runtime runtime = Runtime.getRuntime();
long memUsedInBytes = runtime.totalMemory() - runtime.freeMemory(); 
```

（请仅用于调试目的，切勿用于生产代码！`System.gc()`是邪恶的。）

但我猜你在使用 -Xmx800M 和 1.6 时会遇到 OutOfMemoryErrors，而 1.5 可以正常工作。如果是这种情况，这个答案只是一个旁注，因为你在内存消耗方面确实存在差异。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-28T15:47:39.923

你可以用 jconsole 检查

x86 是 32 位的。如果您真的想知道内存的使用位置，请获取[Eclipse Memory Analyzer](http://www.eclipse.org/mat)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-28T15:55:13.870

也许您以前的虚拟机正在运行客户端引擎（即“java -client”），而当前的虚拟机使用服务器引擎（“java -server”），它使用更多内存以获得更高的速度。您可以在“java -version”的输出中看到这一点。要使用的默认引擎可以在 jvm.cfg 中设置（有关详细信息，请参阅[http://forums.sun.com/thread.jspa?threadID=5185368&tstart=1314 ）。](http://forums.sun.com/thread.jspa?threadID=5185368&tstart=1314)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-27T17:37:48.967

你用的是什么JDK？我建议您试用 Sun 的 JDK（服务器版本），因为 JRE（客户端版本）的内存效率不高。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-26T15:11:39.230

命令“java -version”中没有任何内容告诉我它是 64 位版本（也不是 32 位），是否有更具体的方法来检查它是否是 64 位版本（尽管我认为不是）。但我都是从“apt-get”中得到的。

我刚刚尝试使用 -d32 参数运行应用程序（强制使用 32 位，数据模型），似乎他使用的内存少了一点，但它仍然比 jvm 5 使用的方式更多

JVM 6：

/usr/lib/jvm/java-6-sun/jre/bin/java -version java version "1.6.0_07" Java(TM) SE Runtime Environment (build 1.6.0_07-b06) Java HotSpot(TM) Client VM ( build 10.0-b23，混合模式，共享）

（在我的服务器机器上）java -version java version "1.6.0" Java(TM) SE Runtime Environment (build 1.6.0-b105) Java HotSpot(TM) Client VM（build 1.6.0-b105，混合模式）

虚拟机 5：

java -version java version "1.5.0_16" Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_16-b02) Java HotSpot(TM) Client VM (build 1.5.0_16-b02, 混合模式, 共享)

感谢您的回答

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-27T16:15:22.313

你用什么来解析xml文件？最初的 Java 6 库中有一个错误，会导致这种行为：

[错误 6536111](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6536111)

评论中有解决方法。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-26T05:31:40.820

听起来像较新的 JVM 正在用内存空间换取速度（即缓存或其他什么）？

# vb.net - To protect software by accessing harddisk serial no

> ID：319508
> 
> 赞同：3
> 
> 时间：2008-11-26T01:36:21.107
> 
> 标签：vb.net, security, licensing, hard-drive

I want to get the VB.NET or VB code to access the hard disk serial no when starting the program. It's to help me to protect my own software from people who try to pirate copies.

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-26T03:20:51.503

在 c# 中，但你明白了。您需要为此使用 System.Management：

```
string driveLetter = Environment.SystemDirectory.Substring(0, 2);
string sn = new System.Management.ManagementObject("Win32_LogicalDisk.DeviceID=\"" + driveLetter + "\"").GetPropertyValue("VolumeSerialNumber").ToString(); 
```

正如其他人指出的那样，这可能不是处理此问题的最佳方法。然而，那是你的事。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T01:41:14.903

I can't offer you the code, sorry, but instead I provide a warning based on my previous experience in the area.

The "Hard Disk Serial No" that was used by a number of licensing systems is actually a soft number that is written on the disk, not hardwired into the hardware.

Enterprises that used "ghosting" software to quickly churn out many desktop machines, or virtualisation software to quickly churn out many servers often had identical Hard Drive identification.

So beware if your goal is to prevent enterprises from buying one copy and using it (perhaps unintentionally) on many machines.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-26T01:39:57.853

People often need to upgrade/replace their hard disk. Better to use the serial number from the DMI.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-03-12T21:34:57.040

事实上，我使用磁盘序列号来保护我的软件。

在 vb 6.0 中，我们可以创建和使用 FileSystemObject。它允许访问硬盘驱动器的序列号，以及其他几个功能：

*   显示每个硬盘的已用和可用空间
*   创建、删除、移动文件夹
*   复制文件和文件夹
*   打印文本文件
*   ... ETC。

请注意，在编写代码和声明对象之前，您必须激活

```
Project--> References --> Microsoft Scripting Runtime 
```

以下代码提取有关驱动器的一些信息，但您也可以提取驱动器的序列号。

```
Sub ShowDriveInfo(path)
    Dim fso, drv, bytesPerGB, freeGB, totalGB, s

    s = ""
    bytesPerGB = 1024 * 1024 * 1024

    Set fso = CreateObject("Scripting.FileSystemObject")
    Set drv = fso.GetDrive(fso.GetDriveName(path))

    s = s & drv.Path & " - "

    if drv.IsReady Then
         freeGB = drv.FreeSpace / bytesPerGB
         totalGB = drv.TotalSize / bytesPerGB

         s = s & FormatNumber(freeGB, 3) + " GB free of "
         s = s & FormatNumber(totalGB, 3) + " GB"
    Else
         s = s & "Not Ready"
    End If
    s = s & "<br />"

    document.write (s)
End Sub 
```

如果您仍然需要它，请通过 iranshahrinst@yahoo.com 或 masoodraji@aol.com 给我留言。我会把源代码发给你。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-03-12T21:37:59.080

请在下面找到您问题的确切答案：

```
Function ShowDriveInfo(drvpath)
   Dim fso, d, s, t
   Set fso = CreateObject("Scripting.FileSystemObject")
   Set d = fso.GetDrive(fso.GetDriveName(fso.GetAbsolutePathName(drvpath)))
   Select Case d.DriveType
      Case 0: t = "Unknown"
      Case 1: t = "Removable"
      Case 2: t = "Fixed"
      Case 3: t = "Network"
      Case 4: t = "CD-ROM"
      Case 5: t = "RAM Disk"
   End Select
   s = "Drive " & d.DriveLetter & ": - " & t
   s = s & "<BR>" & "SN: " & d.SerialNumber
   ShowDriveInfo = s
End Function 
```

# c# - ASP.NET Custom Server Control (GridView), DataBinding, and Control Lifecycle conflict

> ID：319512
> 
> 赞同：1
> 
> 时间：2008-11-26T01:38:28.950
> 
> 标签：c#, asp.net, data-binding, custom-server-controls

I have created a Custom Server Control (Inherited from GridView).

On the page, the GridView is DataBound to a DataSet, so I do not know at design time what columns will be present in my GridView.

Now, what I want to do is, to add a textbox in every Cell for the GridView Header row, and those textboxes will control column filtering. (textboxes are added using the GridView OnRowCreated method).

So far so good, the textboxes appear, and the filtering is working.

Problem is, after every postback, the Text value of the textboxes is lost. From my experimentations, this seems to be because I'm adding the textboxes too late in the Page/Control lifecycle.

How does one deal with this type of problem, where I would need to create and add the textboxes early in the Lifecycle (like, the GridView's OnInit), but adding the textboxes is dependant on information that is obtained later in the lifecycle?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T02:21:18.053

Why not store the values in the ViewState and read them back (refill the text boxes) on the postback?

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T02:51:34.293

您不必担心文本框的值，只需担心它们的 ID 以及创建它们的时间；只要您创建并“提供”具有相同数量的文本框及其各自（唯一（！））ID 的页面，控制状态（...嗯...或者可能是视图状态）将负责。

您可以同时使用 Page_Init 和 Page_Load ... Page_Init 有点推荐，但这取决于您的需要。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T20:05:47.197

有一个有用的页面：http: [//msdn.microsoft.com/en-us/library/ms178472.aspx](http://msdn.microsoft.com/en-us/library/ms178472.aspx) 它特别说您需要使用*Pre_Init*事件来创建您的控件：

> **PreInit**：将此事件用于以下操作：
> 
> *   检查 IsPostBack 属性以确定这是否是第一次处理页面。
> *   **创建或重新创建动态控件**。
> *   动态设置母版页。
> *   动态设置 Theme 属性。
> *   读取或设置配置文件属性值。

# unit-testing - 何时不/在实施之前编写测试？

> ID：319513
> 
> 赞同：3
> 
> 时间：2008-11-26T01:38:49.883
> 
> 标签：unit-testing, testing, automated-tests, methodology

我不确定“先测试”是如何工作的，我想听听关于何时以及为何采用这种方法的争论。

我听说通常建议在编写单行实现之前编写测试和模拟事物。但是，我不禁认为它并不适合所有情况。例如，假设我正在制作一个原型，但我还不确定一切将如何工作。所以我只是开始寻找我认为我需要的每个步骤的示例并将它们放入我的代码中。最后，我证明了我的理论，并没有花那么长时间。这本质上是“我的测试”。这不是单元测试，而是测试（很可能是控制台应用程序）。

这几乎就是我的工作方式。我想我想做什么并尝试去做。如果它有效，那么我最终会回去编写单元测试，以便我可以捕获回归。这与您“应该做的”不同吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-26T02:26:35.187

最重要的规则是：先做最危险的事情。

首先进行测试用例隐含地认为编码中最危险的部分是对正在创建的对象的接口和行为的错误沟通和误解。

对于许多项目来说，这很可能是正确的，TDD 在这些情况下非常合适。

然而，在许多项目中并非如此，在这些情况下应用 TDD 是一个糟糕的选择。

如果您的最高风险是可用性，请停止使用单元测试并进行一些 UI 原型设计。

如果你最大的风险是性能，先做一些性能原型，不要担心接口。

这个清单还在继续。

先做有风险的项目有很多好处：

*   在许多资源被浪费之前，不可避免地注定要失败的项目会提前夭折。

*   遇到麻烦但可以挽救的项目尽早获得项目管理的关注，因为它可以做一些好事。

*   当项目失败的风险较低时，您组织的业务方会更高地重视项目；不必要地提前取消的可能性较小。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T02:40:53.177

“我听说经常建议在编写单行实现之前编写测试和模拟事物......我最终回去编写单元测试......这与你“应该做的”不同吗？”

既然你是从自己的问题的答案开始的，那么你并不是真的在问这个问题，是吗？

> 人们回答自己的问题有很多原因。有时，这是一种争论的方式。
> 它允许人们说“我不是在争论，我只是在问为什么这是错误的”。

* * *

目标是先测试。这是它的工作原理。

假设我正在制作原型，但我不确定一切将如何工作。

然而，我确实知道一件事。它应该做什么。

1.  写下它应该做什么的具体例子。具体的、特定的输入和输出。

2.  这就是测试用例。我先做了。我可以将其正式化为单元测试吗？可能不是。但是，我从一个验收测试用例开始。

现在，我可以将问题分解为多个部分。

1.  所以我只是开始寻找我认为我需要的每个步骤的例子。

2.  对于我认为我需要的每个示例，我都会写下步骤中的内容和结果。

3.  这些是测试用例。我先做了。在许多情况下，我可以将它们形式化为单元测试。

4.  完成测试后，我会回到每个步骤的示例并将其放入我的代码中。

我做了测试，然后编码。在进行任何编码之前，我没有进行所有测试。我首先进行了测试，但不是以一种疯狂的全测试无代码方式。我以增量测试-一点-代码-一点的方式做到了。但一切都是先测试的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-26T01:42:36.913

这很简单，答案是在原型制作期间。在这个阶段，您对您构建的系统还不够了解，无法正确测试，无论如何，良好的实践表明原型代码应该是一次性代码，因此在这个阶段测试不会给您带来任何真正的好处。但是从原型设计中获得的理解将帮助您，这样您就可以在投入生产后进行有效的测试。

所以是的，如果您在原型之后进行测试，您的方法是正确的

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-26T03:52:03.610

我认为您不测试尖峰/原型的方法很好。但是有两个想法：

1.  一旦你完成了你的原型并且你知道你在做什么，要么把它扔掉并重新实现它先测试，或者为你已经编写的代码编写测试。

2.  当您有更多的单元测试实践时，您可能会发现在测试中创建原型比创建控制台应用程序更快。我不是说创建一个测试和一个单独的类，我的意思是在测试方法中探索 w/code。我已经做过很多次了，我对此非常满意。当我学习新的 API 甚至新语言时，测试给了我最快的反馈周期来尝试实验。然后，一旦代码正常工作，我就可以将其提取到一个单独的方法/类中，成为真实系统的一部分。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-26T07:58:43.940

即使你正在编写一个废弃的原型，考虑原型实际上会做什么仍然很有用，并从确认它可以做的测试开始。确保原型可以被测试也将塑造解决方案的方式。

然后，当代码被丢弃时，您仍然有测试。

从原型测试开始我也遇到了麻烦，但是当我设法做到这一点时，我总是很高兴我做到了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-26T02:39:31.260

我发现当我仍在构建代码的“故事”时，首先编写测试并不能很好地工作。当我不确定接口是什么样子时，很难编写测试。我可能会编写存根代码来充实类和接口而不考虑测试。但我试图尽快进行测试。我发现如果我在构建设计时记下要测试的东西会很有帮助，然后当我的设计更加稳固时，我会回到我的笔记并首先进行这些测试。这通常意味着实现和单元测试代码一起增长，两者都不是在另一个之前。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-26T02:57:45.093

没有单一的“正确的方法”。但是，我确实认为测试驱动开发 (TDD) 会对您的情况有所帮助。我发现首先编写测试有助于塑造 API 并使代码更简洁。当您首先编写测试时，您首先会考虑如何调用代码（接口，或“这应该做什么”），然后再考虑实现（“我应该怎么做”）。

例如，想象一下创建一个 CRM 模块。您可能会认为首先要做的是吸引花费最多钱的客户。所以，你会写一个测试：

Assert.AreEqual(Customer1, crm.GetMostValuableCustomer(), "最有价值的客户不符合预期");

然后，您可能会遵循以下内容：

Assert.AreEqual(new Customer[] {Customer1, Customer2, Customer3}, crm.GetCustomerByValue(), "GetCustomersByValue() 不符合预期");

所以，关键是你从不同的角度考虑代码（作为消费者，而不是作为生产者）。我相信可以帮助我编写更简洁的代码，并且我不必稍后再返回并创建回归测试。我希望我有一个更好的例子，但希望你能看到在这种方法中工作实际上如何在原型设计阶段帮助你。

# networking - Difference between winsock and linux sockets

> ID：319516
> 
> 赞同：7
> 
> 时间：2008-11-26T01:40:59.647
> 
> 标签：networking, sockets, winsock, xbox360, playstation

I'm developing an FTP-like program to download a large number of small files onto an Xbox 360 devkit (which uses Winsock), and porting it to Playstation3 (also a devkit, and uses linux AFAIK). The program uses BSD-style sockets (TCP). Both of the programs communicate with the same server, downloading the same data. The program iterates through all the files in a loop like this:

```
for each file
    send(retrieve command)
    send(filename)
    receive(response)
    test response
    receive(size)
    receive(data)

```

On the Xbox 360 implementation, the whole download takes 1:27, and the time between the last send and first receive takes about 14 seconds. This seems quite reasonable to me.

The Playstation3 implementation takes 4:01 for the same data. The bottleneck seems to be between the last send and first receive, which takes up 3:43 of that time. The network and disk times are both significantly less than the Xbox 360.

Both these devkits are on the same switch as my PC, which does the file serving, and there is no other traffic on said switch.

I've tried setting the `TCP_NODELAY` flag, which didn't change things significantly. I've also tried setting the `SO_SNDBUF`/`SO_RCVBUF` to 625KB, which also didn't significantly affect the time.

I'm assuming that the difference lies between the TCP/IP stack implementations between Winsock and linux; is there some socket option that I could set to make the linux implementation behave more like Winsock? Is there something else I'm not accounting for?

The only solution looks to be to rewrite it so that it sends all the file requests together, then receives them all.

Unfortunately, Sony's implementation does not have the TCP_CORK option, so I cannot say if that is the difference.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-26T01:59:52.043

You want `TCP_CORK`. It'll prevent partial frames from being sent increasing throughput (at the expense of latency) - just like winsock.

```
int v,vlen;
v=1; vlen=sizeof(v);
setsockopt(fd, IPPROTO_TCP, TCP_CORK, &v, &vlen); 
```

Set `v=0` to flush the frames before receive:

```
int v,vlen;
v=0; vlen=sizeof(v);
setsockopt(fd, IPPROTO_TCP, TCP_CORK, &v, &vlen); 
```

On most unixes you can improve your throughput further by using `writev()` or `sendfile()`...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T03:49:22.883

Wireshark 是你的朋友，嗅探电线——查看数据包，看看每个数据包是如何排序的，看看你是否无法发现差异/问题。

在高延迟链接上，您确实希望确保尽可能多地缓冲每个 TCP 数据包。

发送合并通常是一个好主意。它仅在发送端有多个未确认帧排队时触发。通常，如果您知道自己在做什么并且您的系统提供全面的缓冲，您应该*只*禁用此功能，否则禁用它肯定会对高延迟网络上的系统性能产生负面影响。

对于最高吞吐量，缓冲区分界应该是路径 MTU 的确切因素。

# sql - 如何确定存储过程是否每次都重新编译？

> ID：319518
> 
> 赞同：1
> 
> 时间：2008-11-26T01:41:19.973
> 
> 标签：sql, sql-server, tsql

我有一个 SQL Server 存储过程，其中包含以下 T-SQL 代码：

```
insert into #results ([ID], [Action], [Success], [StartTime], [EndTime], [Process])
select
    'ID' = aa.[ActionID],
    'Action' = cast(aa.[Action] as int),
    'Success' = aa.[Success],
    'StartTime' = aa.[StartTime],
    'EndTime' = aa.[EndTime],
    'Process' = cast(aa.[Process] as int)
from
    [ApplicationActions] aa with(nolock)
where
    0 = case
            when (@loggingLevel = 0) then 0
            when (@loggingLevel = 1 and aa.[LoggingLevel] = 1) then 0
        end
    and
    1 = case
            when (@applicationID is null) then 1
            when (@applicationID is not null and aa.[ApplicationID] = @applicationID) then 1
        end
    and
    2 = case
            when (@startDate is null) then 2
            when (@startDate is not null and aa.[StartTime] >= @startDate) then 2
        end
    and
    3 = case
            when (@endDate is null) then 3
            when (@endDate is not null and aa.[StartTime] <= @endDate) then 3
        end
    and
    4 = case
            when (@success is null) then 4
            when (@success is not null and aa.[Success] = @success) then 4
        end
    and
    5 = case
            when (@process is null) then 5
            when (@process is not null and aa.[Process] = @process) then 5
        end 
```

困扰我的是那个“动态”的 WHERE 子句。用户不必将每个参数都传递给此存储过程。只是他们有兴趣用作输出过滤器的那些。

我将如何使用 SQL Server Studio 或 Profiler 来测试此存储过程是否每次都重新编译？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-26T02:08:38.297

顺便说一句，您可以简化这些：

```
 2 = case
                    when (@startDate is null) then 2
                    when (@startDate is not null and aa.[StartTime] >= @startDate) then 2
            end 
```

对此：

```
 (@startDate is null OR aa.[StartTime] >= @startDate) 
```

至于重新编译 - 它是否已声明`WITH RECOMPILE`？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T02:16:29.560

以下文章解释了如何确定您的存储过程是否正在重新编译：http: [//it.toolbox.com/blogs/programming-life/sql-performance-abnormal-stored-procedure-recompiles-8105](http://it.toolbox.com/blogs/programming-life/sql-performance-abnormal-stored-procedure-recompiles-8105)

以下是相应部分的引述：

> 启动 SQL Profiler 并开始一个新的跟踪，连接到我们的服务器并提供适当的跟踪名称，选择事件选项卡并删除“选定事件类”列表框中已经存在的事件。现在选择“可用事件类”中的“存储过程”节点并添加 SPComplete、SPRecompile、SPStarting、SP:StmtStarting 和 SP:StmtCompleted。现在选择“数据列”选项卡，然后选择您需要的大约适量的事件和数据列。添加过滤器以减少您收集的事件数量。

我会按您的存储过程的名称进行过滤。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-28T18:56:12.070

您在示例中插入临时表会导致每次都重新编译 SP，因为它无法预编译。

这是使用临时表和表变量之间的差异之一 - 关于差异的好文章可以在[这里找到](http://www.codeproject.com/KB/database/SQP_performance.aspx)

相关提取...

> 第二个主要区别是任何带有临时表的过程都不能预编译，而带有表变量的过程的执行计划可以预先静态编译。预编译脚本对其执行速度有很大的好处。对于重新编译成本太高的长过程来说，这种优势可能非常显着。

# php - 生成随机数的算法

> ID：319524
> 
> 赞同：8
> 
> 时间：2008-11-26T01:44:13.227
> 
> 标签：php, mysql, algorithm, random, pseudocode

我正在寻找生成一个随机数并将其发布到数据库中特定 user_id 的表中。问题是，同一个号码不能使用两次。有一百万种方法可以做到这一点，但我希望非常热衷于算法的人有一种巧妙的方法来解决问题，因为它满足以下标准：

1) 对数据库的查询量最少。2) 对内存中的数据结构进行最少的爬取。

本质上，这个想法是执行以下操作

1）创建一个从 0 到 9999999 的随机数
2）检查数据库以查看该数字是否存在
或
2）查询数据库中的所有数字
3）查看返回的结果是否与来自 d​​b 的任何
内容匹配 4）如果匹配，请重复第1步，如果没有，问题就解决了。

谢谢。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-26T01:51:56.003

不，您的算法不可扩展。我之前所做的是连续发出数字（每次+1），然后通过异或运算将它们传递给混杂位，从而给我一个看似随机的数字。当然，它们并不是真正随机的，但在用户眼中它们看起来是随机的。

* * *

**[编辑]**附加信息

这个算法的逻辑是这样的，你使用一个已知的序列来生成唯一的数字，然后你确定地操作它们，所以它们看起来不再是连续的。一般的解决方案是使用某种形式的加密，在我的例子中是一个 XOR 触发器，因为它尽可能快，并且它实现了数字永远不会发生冲突的保证。

但是，您可以使用其他形式的加密，如果您想要更随机的数字，而不是速度（假设您不需要一次生成多个 id）。现在选择加密算法的重点是“保证数字永远不会发生冲突”。证明加密算法是否可以满足此保证的一种方法是检查原始数字和加密结果是否具有相同的位数，并且该算法是可逆的（双射）。

[感谢**Adam Liss**和**CesarB**扩展解决方案]

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-11-26T02:19:10.037

为什么不直接使用 GUID？大多数语言应该有一个内置的方法来做到这一点。它保证是唯一的（具有非常合理的界限）。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-26T02:16:51.883

想要一个顶级的解决方案？

我认为随机性并不是为了加密质量，而是足以阻止通过 user_id 猜测用户的寿命。

在开发过程中，以字符串形式生成所有 1000 万个数字的列表。

或者，执行一些简单的转换，例如在中间添加一个常量字符串。（这是为了以防结果过于可预测。）

将它们传递到生成[Perfect Hash 函数](http://en.wikipedia.org/wiki/Perfect_hash_function)的工具中，例如[gperf](http://www.gnu.org/software/gperf/)。

生成的代码可用于在运行时将用户的 id 快速编码为唯一的哈希值，该哈希值保证不会与任何其他哈希值发生冲突。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-26T07:51:45.093

尝试 mysql SELECT CAST(RAND() * 1000000 AS INT) 中的语句

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-26T02:00:34.317

假设：

*   唯一性需要随机性，而不是安全性
*   您的 user_id 是 32 位
*   您的 9999999 限制只是一个例子

您可以做一些简单的事情，例如将随机数作为 64 位整数，高 32 位包含时间戳（在行插入时），低 32 位包含 user_id。即使对于同一用户的多行，这也是唯一的，前提是您根据为同一用户添加新行的频率对时间戳使用适当的分辨率。结合对随机列的唯一约束并在逻辑中捕获任何此类错误，然后重试。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-26T01:51:16.740

我想你会发现你真的不想这样做。随着数据库中数字的增加，您可能会在“确保不占用此数字”循环中花费太多时间。

就个人而言，我很幸运可以使用哈希作为替代方案，但要提出更好的解决方案，我真的需要知道你为什么要这样做。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-26T01:51:41.810

我的经验只是在 PHP 中使用 RNG。我发现使用一定大小的数字（我使用的是 int，所以我最大为 4G）。我进行了一些测试，发现平均而言，在 500,000 次迭代中，我得到了 120 个单一副本。在多次运行循环后，我从来没有得到一式三份。我的“解决方案”是然后插入并检查它是否失败，然后生成一个新 ID 并重新开始。

我的建议是做同样的事情，看看你的碰撞率是多少，看看你的情况是否可以接受。

这不是最佳的，所以如果有人有建议我也在寻找:)

编辑：我被限制为 5 位 ID（[a-zA-z0-9]{5,5}），ID 越长（组合越多，冲突越少）。例如，电子邮件的 md5 几乎不会发生冲突。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-26T01:55:06.497

问题是，如果您正在生成随机数，很可能会无限地产生重复。

然而：

```
<?php
//Lets assume we already have a connection to the db
$sql = "SELECT randField FROM tableName";
$result = mysql_query($sql);
$array = array();
while($row = mysql_fetch_assoc($result))
 {
   $array[] = $row['randField'];
 }
while(True)
 {
   $rand = rand(0, 999999);
   if(!in_array($rand))
     {
       //This number is not in the db so use it!
       break;
     }
 }
?> 
```

虽然这也可以满足您的需求，但这是一个坏主意，因为它不会长时间扩展，最终您的数组会变大，并且需要很长时间才能生成一个尚未在您的数据库中的随机数.

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-26T02:02:54.983

设计一个长周期不重复的伪随机数发生器很容易；例如[这个](http://www.usenix.org/event/usenix99/full_papers/deraadt/deraadt_html/node17.html)，它被用于你想要的同样的事情。

顺便说一句，为什么不按顺序发出用户ID？

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-26T02:41:37.073

我喜欢 Oddthinking 的想法，但与其选择世界上最强的散列函数，你可以简单地：

*   生成前 1000 万个数字的 MD5（表示为字符串，+一些盐）
*   *离线*检查重复项，即在投入生产之前（我想不会有）
*   将重复项存储在某个数组中
*   当您的应用程序启动时，加载数组
*   当你要插入一个 ID 时，选择下一个数字，计算它的 MD5，检查它是否在数组中，如果它没有作为数据库中的 ID。否则，选择下一个数字

MD5 速度很快，检查字符串是否属于数组可以避免 SELECT。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-26T10:13:25.713

其实我之前写过[一篇关于这个的文章](http://blog.notdot.net/2007/9/Damn-Cool-Algorithms-Part-2-Secure-permutations-with-block-ciphers)。它采用与 Robert Gould 的回答相同的方法，但还展示了如何使用 xor 折叠将分组密码缩短到合适的长度，然后如何在不是 2 的幂的范围内生成排列，同时仍然保留唯一性属性。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-27T22:41:22.237

如果你真的想得到从 0 到 9 999 999 的“随机”数字，那么解决方案是进行一次“随机化”，然后将结果存储到磁盘中。

得到你想要的结果并不难，但我认为它更像是“用数字制作一个长长的列表”，而不是“得到一个随机数”。

```
$array = range(0, 9999999);
$numbers = shuffle($array); 
```

您还需要一个指向 $numbers 中当前位置的指针（将其存储在数据库中）；从 0 开始，每次需要新数字时递增。（或者如果你不喜欢使用指针，你可以使用 array_shift() 或 array_pop()。）

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-11-27T22:59:11.843

适当的 PRNG（伪随机数生成器）算法将有一个循环时间，在此期间它永远不会处于相同状态。如果您在从中检索到的数字中公开 PRNG 的整个状态，您将获得一个保证在生成器期间唯一的数字。

执行此操作的简单 PRNG 称为“[线性同余](http://en.wikipedia.org/wiki/Linear_congruential_generator)” PRNG，它迭代一个公式：

```
X(i) = AX(i-1)|M 
```

使用正确的因子对，您可以从带有 32 位累加器的简单 PRNG 中获得 2^30（约 10 亿）的周期。请注意，您将需要一个 64 位长的临时变量来保存计算的中间“AX”部分。大多数（如果不是全部）C 编译器都支持这种数据类型。您还应该能够在大多数 SQL 方言中使用数字数据类型来执行此操作。

使用正确的 A 和 M 值，我们可以获得具有良好统计和几何特性的随机数生成器。有一篇由 Fishman 和 Moore 撰写的著名论文。

对于 M = 2^31 - 1，我们可以使用下面的 A 的值来获得一个具有很长周期（2^30 IIRC）的 PRNG。

A的良好价值：

```
742,938,285  
950,706,376  
1,226,874,159  
62,089,911  
1,343,714,438 
```

请注意，这种类型的生成器（根据定义）在密码学上是不安全的。如果你知道它生成的最后一个数字，你就可以预测它接下来会做什么。不幸的是，我认为您不能同时获得加密安全性和保证不可重复性。对于要加密安全的 PRNG（例如[Blum Blum Shub](http://en.wikipedia.org/wiki/Blum_blum_shub)），它不能在生成的数字中暴露足够的状态以允许预测序列中的下一个数字。因此内部状态比生成的数量更宽，并且（为了具有良好的安全性）周期将比可以生成的可能值的数量长。这意味着暴露的数字在该期间内不会是唯一的。

出于类似的原因，长周期发电机如[Mersenne Twister 也是如此。](http://en.wikipedia.org/wiki/Mersenne_twister)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2012-01-27T13:05:27.543

有几种方法可以解决这个问题，一种方法是构造一个包含数字 0000000 到 9999999 的数组，然后在该数组中随机选择这些数字，并将选择的数字值与最大值 Max 交换，然后将 max 减少1 并选择该数组的另一个随机成员，直到新的最大值

每次将 Max 减一

例如（基本）：（右侧是应在实际程序中删除的注释） Rndfunc 是对您正在使用的任何随机数生成器函数的调用

```
dim array(0 to 9999999) as integer
for x% = 1 to 9999999
array(x%)=x%
next x%
maxPlus = 10000000
max =9999999
pickedrandom =int(Rndfunc*maxPlus)  picks a random indext of the array based on    
                                   how many numbers are left
maxplus = maxplus-1
swap array(pickedrandom) , array(max) swap this array value to the current end of the
                                     array 
max = max -1                   decrement the pointer of the max array value so it 
                              points to the next lowest place.. 
```

然后继续为您希望选择的每个数字执行此操作，但您需要选择使用非常大的数组

另一种方法如下：生成一个数字并将其存储到一个可以动态增长的数组中，然后选择一个新数字并将其与数组中从第一个元素到最后一个元素中间的值进行比较在这种情况下如果它匹配，它将是第一个选择的数字选择另一个随机数，根据大小对数组进行排序，如果没有匹配，则根据天气，它大于或小于与您比较的数字上升或下降列表一半的距离，每次它不匹配并且大于或小于您要与之比较的距离。

每次将其减半，直到达到 1 的间隙大小，然后检查一次并停止，因为没有匹配项，然后将数字添加到列表中，列表按升序重新排列，依此类推，直到你完成选择随机数...希望这会有所帮助..

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-11-26T02:06:39.750

PHP 已经为此提供了一个函数[uniqid](http://us.php.net/uniqid)。如果您必须从其他地方访问数据，它会生成一个标准的 uuid。不要重新发明轮子。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2015-10-04T22:49:06.910

如果要确保随机数不重复，则需要一个不重复的随机数生成器（如此[处](http://preshing.com/20121224/how-to-generate-a-sequence-of-unique-random-integers/)所述）。

基本思想是，以下公式`seed * seed & p`将为任何输入生成非重复随机数，`x such that 2x < p`并`p - x * x % p`生成所有其他随机数以及非重复，但前提是`p = 3 mod 4`. 所以基本上你只需要一个尽可能接近的primnumber `9999999`。这样可以将工作量减少到单个读取字段，但缺点是生成的 ID 太大或生成的 ID 太少。

该算法的置换效果不是很好，因此我建议将其与 XOR 或加法或其他一些方法结合使用来更改确切值，而不会破坏种子与其生成值之间的一对一关系。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2021-11-05T18:11:26.520

# **对于随机生成：（**在 PHP 中）

# 代码：

它完美地创建了随机数。

```
<?PHP
 /*set the bigger range if there is huge demand*/
$n=range(111111,999999);

shuffle($n); //shuffle those

for ($x=0; $x< 1; $x++) //selects unique random number.
{
echo $n[$x].' ';
}
echo "\n"

?>
```

# 结果：

**第一次：**

[![一](https://i.stack.imgur.com/0074v.png)](https://i.stack.imgur.com/0074v.png)

**第二次：**

[![二](https://i.stack.imgur.com/HUiDe.png)](https://i.stack.imgur.com/HUiDe.png)

**第三次：**

[![三](https://i.stack.imgur.com/Jj4as.png)](https://i.stack.imgur.com/Jj4as.png)

# ruby-on-rails - Ruby on Rails：为什么当我将时间写入数据库时 ，时区会被修改，然后再读回？

> ID：319527
> 
> 赞同：1
> 
> 时间：2008-11-26T01:45:10.980
> 
> 标签：ruby-on-rails, activerecord, time, timezone

我将 environment.rb 中的 config.time_zone 设置为“UTC”，当我发出“select now();”时，我的 mySQL 服务器返回本地时区的当前时间 当我要求“选择 utc_timestamp;”时，在 utc 中

我正在运行 rails 2.1.2、mysql gem 2.7.3、activerecord gem 2.1.2，并且 mysql --version 返回“Ver 14.12 Distrib 5.0.27 for Win32 (ia32)”。

编辑：我的 environment.rb 设置为 UTC，并且自从我开始项目以来一直如此。服务器重新启动不会产生任何变化。

```
record = Record.find(:first)
puts Time.now
# Tue Nov 25 17:40:48 -0800 2008
record.time_column = Time.now
record.save

mysql> select * from records;
---------------------
 2008-11-26 01:40:48

#note that this is the same time, in UTC.

record = Record.find(:first)
puts record.time_column
Wed Nov 26 01:40:48 -0800 2008

#NOTE that this is eight hours in advance!  
#All I've done is store a date in the database and retrieve it again! 
```

任何想法是什么原因造成的？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-26T10:40:04.427

我们在日期、时区和 MySQL 方面遇到了同样的问题。后者假定您在其配置的时区中为其提供日期/时间值。

但是，由于您将 Rails 配置为处理 UTC 时间，ActiveRecord 在使用该值之前会转换 UTC 中的任何日期/时间值（因此 Tue Nov 25 17:40:48 -0800 2008 变为 Wed Nov 26 01:40:48 0000 2008）在它生成并发送到 MySQL 的 SQL 更新/创建查询中。

在伪代码中

```
("time = %t", Tue Nov 25 17:40:48 -0800 2008) => "time = '2008-11-26 01:40:48' 
```

MySQL将其视为 2008-11-26 01:40:48 **-0800**。

查看您的调试日志文件，您就会明白我的意思。它可以正常工作的唯一方法（意味着没有坏的惊喜）是在 Rails 和 MySQL 中设置相同的时区，这个时区是 UTC。这是我们使用的配置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-27T08:41:47.330

这不是您可能想要的答案，但我发现获得一致时间的关键是在 Rails 土地上处理所有基于时区的逻辑并保持数据库愚蠢。

这要追溯到 rails 2.0，其中 timezones/utc 实现令人难以置信的错误/损坏，所以现在可能会更好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T06:54:32.680

编辑 environment.rb 文件后，您是否在向数据库创建新记录之前重新启动了服务器？

# rest - RESTful 身份验证

> ID：319530
> 
> 赞同：779
> 
> 时间：2008-11-26T01:47:29.850
> 
> 标签：rest, authentication, restful-authentication, rest-security

RESTful 身份验证是什么意思，它是如何工作的？我在 Google 上找不到很好的概述。我唯一的理解是您在 URL 中传递了会话密钥（remeberal），但这可能是非常错误的。

* * *

## 回答 #1

> 赞同：619
> 
> 时间：2011-08-23T09:29:08.410

如何在 RESTful 客户端-服务器架构中处理身份验证是一个有争议的问题。

通常，它可以在 SOA over HTTP 世界中通过以下方式实现：

*   基于 HTTPS 的 HTTP 基本身份验证；
*   Cookie 和会话管理；
*   HTTP 标头中的令牌（例如*OAuth* 2.0 + JWT）；
*   使用附加签名参数查询身份验证。

您必须适应，甚至更好地混合这些技术，以最好地匹配您的软件架构。

每个身份验证方案都有自己的优点和缺点，具体取决于您的安全策略和软件架构的目的。

**基于 HTTPS 的 HTTP 基本身份验证**

大多数 Web 服务都使用基于标准 HTTPS 协议的第一个解决方案。

```
GET /spec.html HTTP/1.1
Host: www.example.org
Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ== 
```

它很容易实现，默认在所有浏览器上都可用，但有一些已知的缺点，比如浏览器上显示的可怕的身份验证窗口会持续存在（这里没有类似 LogOut 的功能），一些服务器端额外的 CPU 消耗，以及用户名和密码（通过 HTTPS）传输到服务器的事实（在键盘输入期间让密码仅保留在客户端应该更安全，并作为安全哈希存储在服务器上） .

我们可以使用[Digest Authentication](https://www.rfc-editor.org/rfc/rfc2617)，但它也需要 HTTPS，因为它容易受到[MiM](http://en.wikipedia.org/wiki/Man-in-the-middle_attack)或[Replay](http://en.wikipedia.org/wiki/Replay_attack)攻击，并且特定于 HTTP。

**通过 Cookie 进行会话**

老实说，在服务器上管理的会话并不是真正的无状态。

一种可能性是在 cookie 内容中维护所有数据。而且，按照设计，cookie 是在服务器端处理的（事实上，客户端甚至不会尝试解释这个 cookie 数据：它只是在每次连续请求时将其交给服务器）。但是这个 cookie 数据是应用程序状态数据，所以在一个纯粹的无状态世界中，应该由客户端而不是服务器来管理它。

```
GET /spec.html HTTP/1.1
Host: www.example.org
Cookie: theme=light; sessionToken=abc123 
```

cookie 技术本身是 HTTP 链接的，所以它不是真正的 RESTful，它应该是独立于协议的，恕我直言。它容易受到[MiM](http://en.wikipedia.org/wiki/Man-in-the-middle_attack)或[Replay](http://en.wikipedia.org/wiki/Replay_attack)攻击。

**通过令牌 (OAuth2) 授予**

另一种方法是在 HTTP 标头中放置一个令牌，以便对请求进行身份验证。例如，这就是*OAuth* 2.0 所做的。请参阅[RFC 6749](https://www.rfc-editor.org/rfc/rfc6749#section-7)：

```
 GET /resource/1 HTTP/1.1
 Host: example.com
 Authorization: Bearer mF_9.B5f-4.1JqM 
```

简而言之，这与 cookie 非常相似，并且存在相同的问题：不是无状态的，依赖于 HTTP 传输细节，并且[存在许多安全漏洞](https://www.rfc-editor.org/rfc/rfc6819)——包括 MiM 和 Replay——因此只能通过 HTTPS 使用。通常，[JWT](https://jwt.io)用作令牌。

**查询认证**

查询身份验证包括通过 URI 上的一些附加参数对每个 RESTful 请求进行签名。请参阅[此参考文章](http://broadcast.oreilly.com/2009/12/principles-for-standardized-rest-authentication.html)。

在这篇文章中是这样定义的：

> 所有 REST 查询都必须通过使用私有凭证作为签名令牌以小写字母顺序对查询参数进行签名来进行身份验证。签名应该发生在 URL 编码查询字符串之前。

这种技术可能与无状态架构更兼容，也可以通过轻量会话管理（使用内存会话而不是数据库持久性）来实现。

例如，下面是来自上述链接的通用 URI 示例：

```
GET /object?apiKey=Qwerty2010 
```

应该这样传送：

```
GET /object?timestamp=1261496500&apiKey=Qwerty2010&signature=abcdef0123456789 
```

被签名的字符串是`/object?apikey=Qwerty2010&timestamp=1261496500`并且签名是使用 API 密钥的私有组件的该字符串的 SHA256 哈希。

服务器端数据缓存始终可用。例如，在我们的框架中，我们在 SQL 级别缓存响应，而不是在 URI 级别。所以添加这个额外的参数不会破坏缓存机制。

有关基于 JSON 和 REST 的客户端-服务器 ORM/SOA/MVC 框架中的 RESTful 身份验证的一些详细信息，请参阅[本文。](http://synopse.info/files/html/Synopse%20mORMot%20Framework%20SAD%201.18.html#TITL_98)由于我们不仅允许通过 HTTP/1.1 进行通信，还允许通过命名管道或 GDI 消息（本地）进行通信，因此我们尝试实现真正的 RESTful 身份验证模式，而不依赖于 HTTP 特定性（如标头或 cookie）。

*稍后注意*：在 URI 中添加签名可能被视为不好的做法（例如，它将出现在 http 服务器日志中），因此必须减轻它，例如通过适当的 TTL 以避免重播。但是如果你的http日志被泄露，你肯定会遇到更大的安全问题。

在实践中，即将推出[的 OAuth 2.0 的 MAC 令牌身份验证](https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-http-mac-05)可能是对“由令牌授予”当前方案的巨大改进。但这仍然是一项正在进行的工作，并且与 HTTP 传输相关联。

**结论**

值得得出的结论是 REST 不仅基于 HTTP，即使在实践中，它也主要通过 HTTP 实现。REST 可以使用其他通信层。因此，无论 Google 回答什么，RESTful 身份验证都不仅仅是 HTTP 身份验证的同义词。它甚至根本不应该使用 HTTP 机制，而是应该从通信层抽象出来。如果您使用 HTTP 通信，由于[Let's Encrypt 倡议](https://letsencrypt.org/)，没有理由不使用正确的 HTTPS，这是任何身份验证方案之外的必要条件。

* * *

## 回答 #2

> 赞同：424
> 
> 时间：2009-07-16T07:39:07.587

我怀疑那些热情地大喊“HTTP 身份验证”的人是否曾经尝试过使用 REST 制作基于浏览器的应用程序（而不是机器对机器的 Web 服务）（无意冒犯 - 我只是认为他们从未遇到过复杂情况） .

我发现在生成要在浏览器中查看的 HTML 页面的 RESTful 服务上使用 HTTP 身份验证的问题是：

*   用户通常会得到一个丑陋的浏览器制作的登录框，这对用户非常不友好。您不能添加密码检索、帮助框等。
*   注销或以不同的名称登录是一个问题 - 浏览器将不断向站点发送身份验证信息，直到您关闭窗口
*   超时很困难

一篇非常有见地的文章逐点解决了这些问题[，](http://www.berenddeboer.net/rest/authentication.html)但这导致了*许多*特定于浏览器的 javascript 黑客攻击、变通方法的变通方法等。因此，它也不向前兼容，因此随着新浏览器的发布需要不断维护。我不认为这种简洁明了的设计，加上我觉得这是很多额外的工作和头痛，只是为了让我可以热情地向我的朋友展示我的 REST-badge。

我相信cookies是解决方案。但是等等，饼干是邪恶的，不是吗？不，他们不是，cookie 的经常使用方式是邪恶的。cookie 本身只是一段客户端信息，就像浏览器在您浏览时跟踪的 HTTP 身份验证信息一样。并且这条客户端信息在每次请求时都会发送到服务器，就像 HTTP 身份验证信息一样。从概念上讲，唯一的区别是这块客户端状态的*内容可以由**服务器*作为其响应的一部分来确定。

通过仅使用以下规则使会话成为 RESTful 资源：

*   *会话*将键映射到用户 ID（可能还有超时的最后操作时间戳）
*   如果*会话*存在，那么这意味着密钥是有效的。
*   登录意味着 POST 到 /sessions，一个新的密钥被设置为一个 cookie
*   注销意味着删除 /sessions/{key} （使用重载的 POST，请记住，我们是浏览器，HTML 5 还有很长的路要走）
*   通过在每次请求时将密钥作为 cookie 发送并检查会话是否存在且有效来完成身份验证

现在，与 HTTP 身份验证的唯一区别在于，身份验证密钥由服务器生成并发送给不断将其发回的客户端，而不是客户端根据输入的凭据计算它。

converter42 补充说，当使用 https（我们应该这样做）时，重要的是 cookie 将设置其安全标志，以便永远不会通过非安全连接发送身份验证信息。好点，我自己没见过。

我觉得这是一个足够好的解决方案，但我必须承认，我还不足以成为安全专家来识别该方案中的潜在漏洞——我所知道的是数百个非 RESTful Web 应用程序基本上使用相同的登录协议（PHP 中的 $_SESSION、Java EE 中的 HttpSession 等）。cookie 标头内容仅用于寻址服务器端资源，就像接受语言可能用于访问翻译资源等一样。我觉得它是一样的，但也许其他人没有？你们觉得怎么样？

* * *

## 回答 #3

> 赞同：152
> 
> 时间：2013-11-23T22:19:58.887

这里的好人已经对这个话题说得够多了。但这是我的 2 美分。

有2种交互方式：

1.  人机交互 (HTM)
2.  机器对机器 (MTM)

机器是共同点，表示为 REST API，参与者/客户要么是人，要么是机器。

现在，在真正的 RESTful 架构中，无状态的概念意味着必须为每个请求提供所有相关的应用程序状态（即客户端状态）。相关是指 REST API 处理请求和提供适当响应所需的任何内容。

当我们在人机应用程序的上下文中考虑这一点时，正如 Skrebbel 指出的那样，“基于浏览器”，这意味着在浏览器中运行的（Web）应用程序将需要在每个请求中发送其状态和相关信息它适用于后端 REST API。

考虑一下：您有一个数据/信息平台公开的 REST API 资产。也许您有一个处理所有数据立方体的自助式 BI 平台。但是您希望您的（人类）客户通过 (1) Web 应用程序、(2) 移动应用程序和 (3) 一些第 3 方应用程序来访问它。最后，即使是 MTM 链也会导致 HTM - 对。所以人类用户仍然处于信息链的顶端。

在前两种情况下，您有一个人机交互的案例，信息实际上是由人类用户使用的。在最后一种情况下，您有一个使用 REST API 的机器程序。

身份验证的概念全面适用。您将如何设计它以便以统一、安全的方式访问您的 REST API？在我看来，有两种方法：

**方式一：**

1.  没有登录，开始。每个请求都执行登录
2.  客户端随每个请求发送其识别参数 + 请求特定参数
3.  REST API 接受它们，转身，ping 用户存储（无论是什么）并确认身份验证
4.  如果建立了身份验证，则为请求提供服务；否则，使用适当的 HTTP 状态代码拒绝
5.  对目录中所有 REST API 的每个请求重复上述操作

**方式2：**

1.  客户端以身份验证请求开始
2.  登录 REST API 将处理所有此类请求
3.  它接受身份验证参数（API 密钥、uid/pwd 或您选择的任何内容）并根据用户存储（LDAP、AD 或 MySQL DB 等）验证身份验证。
4.  如果经过验证，则创建一个身份验证令牌并将其交还给客户端/调用者
5.  然后，调用者将此身份验证令牌 + 请求特定参数与每个后续请求一起发送到其他业务 REST API，直到注销或租约到期

显然，在 Way-2 中，REST API 需要一种方法来识别和信任令牌是有效的。登录 API 执行了身份验证，因此您的目录中的其他 REST API 需要信任“代客密钥”。

当然，这意味着需要在 REST API 之间存储和共享身份验证密钥/令牌。这个共享的、受信任的令牌存储库可以是本地的/联合的，允许来自其他组织的 REST API 相互信任。

但我离题了。

关键是，需要维护和共享一个“状态”（关于客户端的身份验证状态），以便所有 REST API 可以创建一个信任圈。如果我们不这样做（即 Way-1），我们必须接受必须为任何/所有进入的请求执行身份验证行为。

执行身份验证是一个资源密集型过程。想象一下，针对您的用户存储对每个传入请求执行 SQL 查询以检查 uid/pwd 匹配。或者，加密和执行哈希匹配（AWS 风格）。在架构上，我怀疑每个 REST API 都需要使用通用的后端登录服务来执行此操作。因为，如果你不这样做，那么你就会到处乱扔身份验证代码。一个大乱子。

所以更多的层，更多的延迟。

现在，走 Way-1 并申请 HTM。您的（人类）用户是否真的关心您是否必须在每个请求中发送 uid/pwd/hash 或其他任何内容？不，只要您不通过每秒抛出身份验证/登录页面来打扰她。如果你这样做，祝你有客户好运。因此，您要做的是将登录信息存储在客户端的某处，在浏览器中，就在开始时，并在每次发出请求时发送。对于（人类）用户，她已经登录，并且“会话”可用。但实际上，她在每次请求时都经过身份验证。

与方式 2 相同。您的（人类）用户永远不会注意到。所以没有造成任何伤害。

如果我们将 Way-1 应用于 MTM 会怎样？在这种情况下，由于它是一台机器，我们可以通过要求它在每个请求中提交身份验证信息来让这个家伙感到厌烦。没人在乎！在 MTM 上执行 Way-2 不会引起任何特殊反应；它是一台该死的机器。它可以不在乎！

所以真的，问题是什么适合你的需要。无国籍是要付出代价的。付出代价并继续前进。如果你想成为一个纯粹主义者，那么也要为此付出代价，然后继续前进。

最后，哲学并不重要。真正重要的是信息发现、呈现和消费体验。如果人们喜欢你的 API，那么你就完成了你的工作。

* * *

## 回答 #4

> 赞同：55
> 
> 时间：2013-10-14T21:29:27.273

这是一个真正完整的 RESTful 身份验证解决方案：

1.  在身份验证服务器上创建公钥/私钥对。
2.  将公钥分发给所有服务器。
3.  当客户端进行身份验证时：

    3.1。发出一个令牌，其中包含以下内容：

    *   到期时间
    *   用户名（可选）
    *   用户 IP（可选）
    *   密码哈希（可选）

    3.2\. 使用私钥加密令牌。

    3.3\. 将加密的令牌发回给用户。

4.  当用户访问任何 API 时，他们还必须传入他们的身份验证令牌。

5.  服务器可以通过使用身份验证服务器的公钥对其进行解密来验证令牌是否有效。

这是无状态/RESTful 身份验证。

请注意，如果包含密码哈希，用户还将发送未加密的密码以及身份验证令牌。服务器可以通过比较哈希值来验证密码是否与用于创建身份验证令牌的密码匹配。需要使用 HTTPS 之类的安全连接。客户端的 Javascript 可以处理获取用户的密码并将其存储在客户端，无论是在内存中还是在 cookie 中，可能使用服务器的**公钥**加密。

* * *

## 回答 #5

> 赞同：41
> 
> 时间：2013-08-13T20:09:03.473

老实说，我在这里看到了很好的答案，但让我有点困扰的是，当有人将整个无状态概念推向极端时，它会变得教条主义。它让我想起了那些只想拥抱纯 OO 的 Smalltalk 老粉丝，如果某些东西不是对象，那么你做错了。让我休息一下。

RESTful 方法应该让您的生活更轻松并减少会话的开销和成本，尝试遵循它，因为这是明智的做法，但是一旦您遵循纪律（任何学科/指南）到它的极端不再提供预期的好处，那么你做错了。当今一些最好的语言同时具有函数式编程和面向对象。

如果您解决问题的最简单方法是将身份验证密钥存储在 cookie 中并将其发送到 HTTP 标头，那么就这样做，只是不要滥用它。请记住，当会话变得又重又大时，它们是不好的，如果您的所有会话都包含一个包含密钥的短字符串，那么有什么大不了的？

我愿意接受评论中的更正，但我只是不明白（到目前为止）让我们的生活变得悲惨只是避免在我们的服务器中保留一个大的哈希字典的意义。

* * *

## 回答 #6

> 赞同：35
> 
> 时间：2013-03-26T23:13:29.420

首先，一个 RESTful Web 服务是*无*状态的（或者换句话说，*无状态的）*）。因此，RESTful 服务没有也不应该包含会话或 cookie 的概念。在 RESTful 服务中进行身份验证或授权的方法是使用 RFC 2616 HTTP 规范中定义的 HTTP 授权标头。每个请求都应包含 HTTP Authorization 标头，并且应通过 HTTPs (SSL) 连接发送请求。这是在 HTTP RESTful Web 服务中进行身份验证和验证请求授权的正确方法。我在 Cisco Systems 为 Cisco PRIME Performance Manager 应用程序实施了 RESTful Web 服务。作为该 Web 服务的一部分，我还实现了身份验证/授权。

* * *

## 回答 #7

> 赞同：24
> 
> 时间：2008-11-26T03:06:21.503

它当然不是关于“会话密钥”，因为它通常用于指代在 REST 的所有约束内执行的无会话身份验证。每个请求都是自描述的，携带足够的信息来自行授权请求，而无需任何服务器端应用程序状态。

[解决此问题的最简单方法是从RFC 2617](http://www.ietf.org/rfc/rfc2617.txt)中 HTTP 的内置身份验证机制开始。

* * *

## 回答 #8

> 赞同：16
> 
> 时间：2017-01-14T13:30:16.190

## 2019 年 2 月 16 日更新

下面前面提到的方法本质上是[OAuth2.0](https://www.rfc-editor.org/rfc/rfc6749)的“资源所有者密码凭据”授权类型。这是启动和运行的简单方法。但是，通过这种方法，组织中的每个应用程序最终都将拥有自己的身份验证和授权机制。推荐的方法是“授权码”授权类型。此外，在我之前的回答中，我推荐使用浏览器 localStorage 来存储身份验证令牌。但是，我开始相信 cookie 是实现此目的的正确选择。我在[这个 StackOverflow 答案](https://stackoverflow.com/a/54011649/1235935)中详细说明了我的原因、授权码授予类型的实现方法、安全注意事项等。

* * *

我认为以下方法可用于 REST 服务身份验证：

1.  创建一个登录 RESTful API 以接受用户名和密码进行身份验证。在传输过程中使用 HTTP POST 方法来防止缓存和 SSL 以确保安全在成功验证后，API 返回两个 JWT - 一个访问令牌（较短的有效期，例如 30 分钟）和一个刷新令牌（较长的有效期，例如 24 小时）
2.  客户端（基于 Web 的 UI）将 JWT 存储在本地存储中，并且在每个后续 API 调用中都会在“Authorization: Bearer #access token”标头中传递访问令牌
3.  API 通过验证签名和到期日期来检查令牌的有效性。如果令牌有效，请检查用户（它将 JWT 中的“子”声明解释为用户名）是否可以通过缓存查找访问 API。如果用户被授权访问API，执行业务逻辑
4.  如果令牌过期，API 返回 HTTP 响应码 400
5.  客户端在收到 400/401 时，使用“Authorization: Bearer #refresh token”标头中的刷新令牌调用另一个 REST API 以获取新的访问令牌。
6.  在收到带有刷新令牌的调用时，通过检查签名和到期日期来检查刷新令牌是否有效。如果刷新令牌有效，则从数据库中刷新用户的访问权限缓存，并返回新的访问令牌和刷新令牌。如果刷新令牌无效，返回 HTTP 响应码 400
7.  如果返回新的访问令牌和刷新令牌，则执行步骤 2。如果返回 HTTP 响应码 400，则客户端假定刷新令牌已过期，并要求用户输入用户名和密码
8.  对于注销，清除本地存储

使用这种方法，我们每 30 分钟执行一次使用特定于用户的访问权限详细信息加载缓存的昂贵操作。因此，如果撤销访问权限或授予新访问权限，则需要 30 分钟才能反映或注销后再登录。

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2012-10-15T19:35:58.230

@skrebel ( [http://www.berenddeboer.net/rest/authentication.html](http://www.berenddeboer.net/rest/authentication.html) ) 提到的“非常有见地”的文章讨论了一种复杂但非常糟糕的身份验证方法。

您可以尝试在没有任何登录凭据的情况下访问该页面（应该只对经过身份验证的用户可见）[http://www.berenddeboer.net/rest/site/authenticated.html 。](http://www.berenddeboer.net/rest/site/authenticated.html)

（对不起，我无法评论答案。）

我会说 REST 和身份验证根本不混合。REST 表示无状态，但“经过身份验证”是一种状态。您不能将它们都放在同一层。如果您是 RESTful 倡导者并且对状态不满意，那么您必须使用 HTTPS（即将安全问题留给另一层）。

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2009-01-19T06:45:34.217

我认为 RESTful 身份验证涉及将身份验证令牌作为请求中的参数传递。示例是 api 对 apikeys 的使用。我不相信使用 cookie 或 http auth 符合条件。

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2011-12-08T22:44:15.620

这样做的方法是：[使用 OAuth 2.0 for Login](http://code.google.com/apis/accounts/docs/OAuth2Login.html "使用 OAuth 2.0 登录")。

您可以使用除 Google 之外的其他身份验证方法，只要它支持 OAuth。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2013-11-02T04:08:40.923

使用公钥基础设施，其中密钥的注册涉及正确绑定，可确保公钥以确保不可否认性的方式绑定到分配给它的个人

请参阅[http://en.wikipedia.org/wiki/Public_key_infrastructure](http://en.wikipedia.org/wiki/Public_key_infrastructure)。如果您遵循正确的 PKI 标准，则可以识别并锁定不当使用被盗密钥的个人或代理。如果代理需要使用证书，则绑定会变得非常紧密。一个聪明敏捷的小偷可以逃走，但他们会留下更多的面包屑。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2018-10-15T18:16:19.840

**适用于保护任何 Web 应用程序的提示**

如果您想保护您的应用程序，***那么您绝对应该从使用 HTTPS 而不是 HTTP 开始***，这可以确保在您和用户之间创建安全通道，这将防止嗅探来回发送给用户的数据并有助于保留数据交换机密。

**您可以使用 JWTs (JSON Web Tokens) 来保护 RESTful API**，与服务器端会话相比，这有很多好处，好处主要是：

1- 更具可扩展性，因为您的 API 服务器不必为每个用户维护会话（当您有很多会话时，这可能是一个很大的负担）

2- JWT 是自包含的，并且具有定义用户角色的声明，例如，他可以访问和在日期和到期日发布的内容（在此之后 JWT 将无效）

3-更容易跨负载均衡器处理，如果您有多个 API 服务器，因为您不必共享会话数据，也不必配置服务器以将会话路由到同一服务器，只要带有 JWT 的请求命中任何服务器，就可以对其进行身份验证&授权

4-减少对数据库的压力，并且您不必为每个请求不断存储和检索会话 ID 和数据

5-如果您使用强密钥签署 JWT，则 JWT 不会被篡改，因此您可以信任随请求发送的 JWT 中的声明，而无需检查用户会话以及他是否被授权，您只需检查 JWT 就可以知道该用户可以做什么和做什么。

许多库提供了在大多数编程语言中创建和验证 JWT 的简单方法，例如：在 node.js 中，最流行的一种是[jsonwebtoken](https://www.npmjs.com/package/jsonwebtoken)

**由于 REST API 通常旨在保持服务器无状态，因此 JWT 与该概念更兼容，**因为每个请求都使用自包含的授权令牌**(JWT)**发送，与使服务器是有状态的，因此它可以记住用户及其角色，但是，会话也被广泛使用并具有其优点，您可以根据需要进行搜索。

需要注意的一件重要事情是，您必须使用 HTTPS 将 JWT 安全地交付给客户端并将其保存在安全的地方（例如本地存储中）。

[您可以从此链接](https://jwt.io/)了解有关 JWT的更多信息

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-01-19T06:14:49.177

根据我的理解来回答这个问题...

使用 REST 的身份验证系统，因此您无需实际跟踪或管理系统中的用户。这是通过使用 HTTP 方法 POST、GET、PUT、DELETE 完成的。我们采用这 4 种方法，并在数据库交互方面将它们视为 CREATE、READ、UPDATE、DELETE（但在 Web 上我们使用 POST 和 GET，因为这是锚标签目前支持的）。因此，将 POST 和 GET 视为我们的 CREATE/READ/UPDATE/DELETE (CRUD)，然后我们可以在我们的 Web 应用程序中设计路由，从而能够推断出我们正在实现的 CRUD 操作。

例如，在 Ruby on Rails 应用程序中，我们可以构建我们的 Web 应用程序，这样，如果登录的用户访问[http://store.com/account/logout](http://store.com/account/logout)，那么该页面的 GET 可以被视为尝试注销的用户. 在我们的 Rails 控制器中，我们将构建一个操作，将用户注销并将其发送回主页。

登录页面上的 GET 将产生一个表单。登录页面上的 POST 将被视为登录尝试，并获取 POST 数据并使用它进行登录。

对我来说，这是一种使用映射到其数据库含义的 HTTP 方法然后构建身份验证系统的做法，并牢记您不需要传递任何会话 ID 或跟踪会话。

我还在学习——如果您发现我所说的任何错误，请纠正我，如果您了解更多，请在此处发布。谢谢。

# php - 是否可以轻松地在 PHP 中“符号链接”函数 - 或将名称别名为其他名称？

> ID：319531
> 
> 赞同：3
> 
> 时间：2008-11-26T01:47:44.377
> 
> 标签：php

例如，我讨厌输入以下内容：

```
$x = mysql_escape_string(stripslashes($_GET['x'])); 
```

有没有办法在 init.php 或其他东西中给这两个函数起别名，而无需编写一个单独的函数，该函数接受一个参数并返回应用了这些函数的参数？

我的 C/C++ 不是很好，但我认为这有点像 #typedef 但对于函数？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-26T02:19:53.467

我希望你的例子不能代表你的项目。

1.  `stripslashes()``magic_quotes_gpc`不应该 - 如果你发现它是必要的，请在你的 php.ini 中关闭。
2.  您应该使用`mysql_real_escape_string()`（或`prepare`/`execute`对）而不是它，`mysql_escape_string()`并且它应该是您的 SQL 被组装的地方，而不是您从 URL 中检索值的地方。

修复这两个问题，您的代码将退化为

```
$x = $_GET['x']; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-26T01:50:39.313

```
function myget($string)
{
  return mysql_real_escape_string(stripslashes($_GET[$string]));
} 
```

这是PHP中的解决方案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-26T02:06:23.823

这应该可以解决问题：

```
// Macros
$mes = "mysql_escape_string";
$ss = "stripslashes";

// Using your macros
$x = $mes($ss($_GET['x'])); 
```

虽然我根本不推荐这样的编码。

我只是在回答这个问题，因为您说您不想创建任何新功能并获得类似“#define”的功能。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-26T02:19:54.293

我同意 Bill Karwin 的建议，但我想补充一个我认为很重要的观点。

如果您想用 c(...) 替换对 a(b(...)) 的重复调用，则 c 本身可能具有某些含义-超出了简单的组合。考虑一下上下文，以及如何命名这样的函数。通常它会有一些自己的语义，这些语义并不特别依赖于 a,b - 这只是一种实现。如果是这种情况，那么很容易将其视为一个（简单）函数，它恰好通过调用 b 然后 a 来实现。这种情况下的简单性可能会诱使您想要为函数“别名”，但在一般情况下，这可能并没有太大帮助。

现在在这种特殊情况下，我会认为：

*   这个复合函数的合理名称是什么？
*   为什么还没有人来做呢？
*   为什么我不使用查询参数？

严重地。这正是您应该使用查询参数来降低 SQL 注入攻击风险的原因。比您在这里尝试做的要可靠得多。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-26T02:07:11.247

[您可以使用create_function](http://www.php.net/create_function)执行匿名函数：

```
$newFunc = create_function('', 'return mysql_escape_string(stripslashes($_GET[\'x\']));');
$newFunc(); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-26T01:55:07.637

如果你想要一个 1:1 的函数映射，这是可行的，它使回溯有点讨厌，但是可行

```
class DB
{ 
    public static function escape()
    { 
       $args = func_get_args();  
       return call_user_func_array('mysql_real_escape_string', $args ); 
    }
}

DB::escape( $foo ); 
```

现在我在这里使用 func_get_args / call 技巧仅出于一个原因：

这种表示法适用于**任何**功能。

然而，直接链接它会更好

```
class DB
{ 
   public static function escape($string)
   { 
      return mysql_real_escape_string( $string ); 
   }
} 
```

并且没有充分的理由剥离斜杠，除非您在 php 中启用了自动斜杠输入的那个可怕的“功能”。

```
class DB
{ 
   public static function un_gpc($string)
   {
      if( get_magic_quotes_gpc() === 1 )
      {
         return stripslashes( $string ); 
      }
      return $string;
   }
   public static function escape($string, $quote=false)
   {
      if( !$quote )
      { 
            return mysql_real_escape_string( $string ); 
      }
      return '"' . self::escape( $string ) . '"'; 
   }
   public static function escape_gpc( $string , $quote = false )
   {
      return self::escape( self::un_gpc( $string ), $quote); 
   }
   public static function get( $string , $quote = true )
   { 
      return self::escape_gpc( $_GET[$string] , $quote ); 
   }

}

# Handy Dandy.
$q = 'SELECT * FROM FOO WHERE BAR = ' . DB::get( 'bar' ) ; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-26T03:13:25.077

我假设您想要像 C 宏这样的东西，它像函数一样易于使用，但与调用真实函数的开销不同。PHP 没有任何这样的功能。您是否正在尝试使您的代码更快或更高效？

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-11-26T01:53:18.170

“容易”，确定吗？“优雅”，不。

# html - 用图像替换标题文本

> ID：319552
> 
> 赞同：1
> 
> 时间：2008-11-26T02:01:47.000
> 
> 标签：html, css

我正在建立一个基于 Drupal 的网站，并希望用图像文件替换标题中的网站标题。我遇到了这篇文章：[“Revised Image Replacement”](http://www.mezzoblue.com/tests/revised-image-replacement/)，它总结了几种实现这一点的技术。

我想知道在 SEO 和浏览器兼容性方面，目前的最佳做法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T02:26:25.577

我曾经认为 Leahy/Langridge 方法是最好的，但是随着我越来越多地使用它，我发现 Phark 方法更容易实现，同样有效且更有用，因为您可以在标题中添加链接以及（我以前从未工作过的东西）。

这两个都不需要额外的标记，我不认为（[如果相信谷歌的马特卡茨的](http://groups.google.com/group/Google_Webmaster_Help-Indexing/msg/07ff235c6aeae4ef)话）对搜索引擎优化有很多（如果有的话）不良影响（即谷歌不会因为隐藏文本而惩罚你，只要它没有不会出现垃圾邮件）。

在 IE5 中，两者都不工作，或者需要额外的工作才能工作，但我不知道有谁支持它了。

所以我会推荐 Phark（或 Phark Revisited，效果最好）方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T02:29:37.317

使用 CSS 并覆盖任何包含“文本”的元素，如下所示：（Phark 方法）

html:

`<h1>Header</h1>`

CSS：

`h1 {`
`text-indent: -9999px;`
`background: url('image.png') no-repeat top left;`
`}`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T03:45:23.810

这些技术都没有真正解决的唯一问题是，如果有人关闭了图像，尽管现在这是一个边缘情况。

我通常发现 Phark 方法很容易实现，并且几乎总是有效，但您也可以查看 javascript 方法 - 很容易编写自己的方法。

# php - PHP Shipping Calculator

> ID：319560
> 
> 赞同：4
> 
> 时间：2008-11-26T02:09:30.947
> 
> 标签：php, codeigniter, shipping

Does anyone know of a freeware shipping calculator for PHP? I do not want anything too fancy, and it can be compatible with any of the major US domestic shipping services.

If anyone knows of one that is a plugin for CodeIgniter that would be nice.

Travis

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-26T02:20:07.663

Usually services like this are based on web services offered from the various couriers. You would send the weight and dimensions of the box you want to ship to their web service, and they would return a corresponding shipping price. Each couriers API would be different. I'm not sure if there are any libraries that aggregate all these services together, but I've never seen one. Since prices can change at any time, you pretty much have to use some kind of web service to access this information. That is, unless you are Amazon sized and have preexisting arrangements for pricing rates on shipping with the various couriers. Just from a quick lookup, here is some of the services that [FedEx](http://www.fedex.com/us/developer/product/basics.html) offers.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-08-07T01:32:28.400

If you sign up for a free account at eship.purolator.com and they have sample code that can be implemented into any website for anything you could think of.

[https://eship.purolator.com/SITE/resourcecentre/samplecode.aspx](https://eship.purolator.com/SITE/resourcecentre/samplecode.aspx)

-James

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-05T23:11:31.930

如果您想节省一些时间，我编写了一个支持 UPS、美国邮件和联邦快递的 PHP 运费计算器。可在此处获得：http: [//www.soniccode.com/php_shipping_rates_calculator.php](http://www.sonicode.com/php_shipping_rates_calculator.php)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-09-16T17:30:54.307

UPS 的简单计算器，不需要 UPS 帐户即可获得费率： [http ://www.geekpedia.com/tutorial213_Creating-a-UPS-Shipping-Calculator.html](http://www.geekpedia.com/tutorial213_Creating-a-UPS-Shipping-Calculator.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-09-02T19:55:21.513

有一项服务允许您访问他们的 API，该 API 与 Fedex、USPS、UPS 和 DHL 的 API 集成。允许提出请求的费用为每月 25 美元，但它是一个完整的解决方案。OP 声明“免费软件”，但我认为即使您必须付费，其他人也会遇到此问题并欣赏解决方案。

[http://www.auctioninc.com/info/page/shipping_api](http://www.auctioninc.com/info/page/shipping_api)

他们有一个 php sdk，所以它在 php 上更容易。根据他们的解释，他们不确定您是否可以使用 AJAX，因此我们只是将其构建为通过 AJAX 发布到 php.ini。效果很好！

老帖子，我知道。但是新的选项变得可用，旧的线程仍然会出现在搜索结果中。

# c - 通过 TCP 客户端套接字接收数据的问题

> ID：319576
> 
> 赞同：3
> 
> 时间：2008-11-26T02:24:09.123
> 
> 标签：c, sockets, tcp

我正在尝试在 C 中创建一个 TCP 客户端程序，客户端将在其中启动，连接到服务器。然后它会发送一些信息，然后只听它接收到的内容并做出相应的反应。

我遇到问题的部分是持续聆听。这是我所拥有的

```
...

while (1) {
   numbytes = recv(sockfd, buf, MAXDATASIZE-1, 0);
   buf[numbytes] = '\0';
   printf("Received: %s\n", buf);
   // more code to react goes here
}

... 
```

连接到服务器后，发送两行数据后，服务器应该会收到很多信息，但是当我运行它时，它会打印：

> 已收到：

然后继续坐在那里，直到我强迫它关闭。

** 编辑 ** 当我按照乔纳森告诉我的操作时，我得到以下信息：

> 计数：-1，错误：111，接收：

所以这意味着它的错误，但我该怎么办呢？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-26T02:26:47.493

打印出接收到的字节数 - 它可能为零，但请确认。

值得检查您没有收到错误 - 因此导致缓冲区下溢。

[*注意：从这里开始是 Pax 的工作-**谢谢**，我已将其转换为 Community Wiki，因此我不会获得不应有的代表点数。*]

以下代码将执行此操作。请尝试并报告结果。

```
while (1) {
    numbytes = recv(sockfd, buf, MAXDATASIZE-1, 0);
    buf[numbytes] = '\0';
    printf("Count: %d, Error: %d, Received: %s\n", numbytes, errno, buf);
    // more code to react goes here
} 
```

问题编辑后：

错误号 111 是 ECONNREFUSED - 这不是 recv() 的常见错误代码，但更适合开放式调用（open()、connect() 等）。

无论如何，ECONNREFUSED 是服务器端的问题，而不是客户端的问题 - 服务器故意拒绝接受您的传入连接，因此您需要调查链接的那一端。

为了对此进行测试，请更改您的代码，使其在端口 80 上连接到 www.microsoft.com，然后发送几行任何旧垃圾。您应该从他们的 Web 服务器返回一个错误，指示格式错误的 HTTP 请求。这将证明您的客户端没有问题。

这是我在输入后返回的内容，然后`telnet www.microsoft.com 80`输入两次：`hello``ENTER`

```
HTTP/1.1 400 Bad Request
Content-Type: text/html; charset=us-ascii
Server: Microsoft-HTTPAPI/2.0
Date: Thu, 27 Nov 2008 01:45:09 GMT
Connection: close
Content-Length: 326

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">
<HTML><HEAD><TITLE>Bad Request</TITLE>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=us-ascii"></HEAD>
<BODY><h2>Bad Request - Invalid Verb</h2>
<hr><p>HTTP Error 400\. The request verb is invalid.</p>
</BODY></HTML> 
```

你应该看到类似的东西。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T02:43:55.340

我强烈推荐[Beej 的网络编程指南](http://www.beej.us/guide/bgnet/)。

[本节](http://www.beej.us/guide/bgnet/output/html/singlepage/bgnet.html#simpleclient)特别提供了完全按照您的要求执行的客户端代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T14:27:11.753

编辑：下面的答案是基于对问题的误解 - OP 的代码实际上是在尝试在它打开（）到远程服务器的套接字上进行 recv（）。左下方的东西供后代使用。

* * *

请显示更多您的代码。

不过有一些观察：

*   是插座`listen()ing`吗？
*   你`accept()ed`有传入的连接吗
*   `recv()`在 TCP 套接字上使用有点不寻常。改为使用`read()`。
*   用于`strerror()`将 111 错误代码转换为本地错误字符串 - 每个 UNIX O/S 都可以有自己的从数字到 Exxx 错误代码的映射，因此我们无法判断这个错误在您的系统上是什么。

正常的代码循环（对于单线程非分叉应用程序）如下所示：

```
s = socket();
err = listen(s, n); // n = backlog number
while (1) {
    int fd = accept(s, &addr, sizeof(addr));
    while (1) {
        int numrecv = read(fd, ...);
        // break if eof
    }
    close(fd);
}
close(s); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-27T05:43:04.633

无限循环是怎么回事？为什么不使用 select() 以便只在需要读取实际数据时调用 recv() ？

在以前的生活中，我为 MUD 编写了网络代码，但我仍然可以在脑海中编写轮询循环。ROM 2.3 中的循环是这样的（从内存中，如果宏参数的顺序错误，请见谅）：

```
#define MAX_CONNECTIONS 256
int main(int argc, char *argv[])
{
  int i = 0;
  int running = 1;
  int connections[MAX_CONNECTIONS];
  while( running )
  {
    fd_set in_fd, out_fd, exc_fd;
    FD_ZERO(in_fd);
    FD_ZERO(out_fd);
    FD_ZERO(exc_fd);
    for( i = 0; i < MAX_CONNECTIONS; i++ )
    {
      if( connections[i] > 0 )
      {
        FD_SET(&in_fd, connections[i]);
        FD_SET(&out_fd, connections[i]);
        FD_SET(&exc_fd, connections[i]);
      }
    }
    select(&in_fd, &out_fd, &exc_fd, NULL); // this will block until there's an I/O to handle.
    for( i = 0; i < MAX_CONNECTIONS; i++ )
    {
      if( FD_ISSET(&exc_fd, connections[i]) )
      { /* error occurred on this connection; clean up and set connection[i] to 0 */ }
      else
      {
        if( FD_ISSET(&in_fd, connections[i]) )
        { /* handle input */ }
        if( FD_ISSET(&out_fd, connections[i]) )
        { /* handle output */ }
      }
    }
  }
} 
```

# ui-automation - 如何以编程方式在 Windows 中选择弹出菜单项？

> ID：319578
> 
> 赞同：2
> 
> 时间：2008-11-26T02:25:04.597
> 
> 标签：ui-automation, postmessage, popupmenu, trackpopupmenu, wm-command

我有一个应用程序，我正在为其编写一个小向导。它通过将鼠标移动到适当的按钮、菜单并单击它们来自动化应用程序的一小部分，以便用户可以观看。

到目前为止，它将鼠标移动到树项目并发送右键单击。通过 TrackPopupMenu 弹出一个菜单。接下来，我将鼠标移动到弹出菜单上的相应项目。我不知道如何选择菜单项。

我尝试将左键单击发送到菜单的所有者窗口，尝试将 WM_COMMAND 发送到菜单的所有者等。没有任何效果。

我想菜单本身就是一个窗口，但我不知道如何从我拥有的 HMENU 中获取它的 HWND。

关于如何 PostMessage 单击弹出菜单有什么想法吗？

PS 我使用单独的线程来驱动鼠标和发布消息，所以 TrackPopupMenu 同步没有问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-28T20:31:55.903

我没有找到一个完美的方法来做到这一点，但以下工作非常好：

```
//in my case, the menu is a popup from a tree control created with:
CMenu menu;
menu.CreatePopupMenu();
//add stuff to the menu...
pTreeCtrl->SetMenu(&menu);
m_hMenu = menu.GetSafeHmenu();
CPoint  pt;
GetCursorPos(&pt);
menu.TrackPopupMenu(TPM_LEFTALIGN | TPM_LEFTBUTTON, pt.x, pt.y, _pTreeCtrl);
menu.Detach();
m_hMenu = NULL; 
```

上面的函数是在树项的右键单击时调用的。下面的代码在单独的线程中运行以进行点击

```
CRect rc;
GetMenuItemRect(pTreeCtrl->GetSafeHwnd(), m_hMenu, targetMenuItemIndex, &rc);
if(FALSE == rc.IsRectEmpty())
{
   CPoint target = rc.CenterPoint();
   //this closes the menu
  ::PostMessage(pTreeCtrl->GetSafeHwnd(), WM_CANCELMODE, 0, 0);
  DestroyMenu(m_hMenu);
  m_hMenu = NULL;
  //now simulate the menu click
  ::PostMessage(pTreeCtrl->GetSafeHwnd(), WM_COMMAND, targetMenuItemID, 0);
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T03:10:15.677

我希望您可以通过调用来生成必要的点击消息[`SendInput`](http://msdn.microsoft.com/en-us/library/ms646310.aspx)。将鼠标移到菜单所在的位置，然后单击。

您可能想看看[WH_JOURNALPLAYBACK](http://msdn.microsoft.com/en-us/library/ms644959.aspx)挂钩。我认为它旨在完全执行您似乎想要手动执行的操作。

# sql - 使用 SUM() 或缓存

> ID：319579
> 
> 赞同：4
> 
> 时间：2008-11-26T02:25:07.577
> 
> 标签：sql, performance

我对数据库没有太多经验，所以我不知道哪个更适合长期性能，更好的实践等。

这是我的（假设的）案例：假设您有一个包含客户信息和每个采购订单历史记录的数据库。您想跟踪每个客户的购买量。我可以想到两种计算方法：

1) 每次需要时只做一个 SUM() 。这是一个简单的解决方案，但令人担忧的是，这个数据库可能已有 20 年的历史，每个客户都有数万行。随着越来越多的客户购买被添加到数据库中，SUM() 操作将花费更长的时间来计算。

2）将总和缓存在客户信息表中，每次进行新购买（更新、删除等）时，更新此缓存。这样无论有多少采购订单，计算时间都不会增加。缺点是，这是一个不太灵活的解决方案（只有所有行的总和，每月总和呢？其他间隔？等等）；这个缓存值可能会以某种方式与实际总数不同步（技术上不应该发生，但它可能会发生）

那么我应该为此做些什么呢？我知道我不应该存储任何我可以从数据库中已有的东西计算出来的东西，但我不喜欢这种类型的计算会随着时间的推移变得更糟的事实，并且有某种优雅的选择2.

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-26T02:32:57.123

在数据库方面，选项 2 没有优雅之处——如果你的数据库变得非常庞大，它会被认为是你可能会使用的最后手段——对于第一次设置它的新手来说不太可能发生（但可能）。

维护总数需要做很多工作；你会永远处理这样一个问题：“为什么细节加起来不等于总数？”

选择选项 1，直到你证明你做不到。在大多数情况下，这将是很长时间。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-26T02:33:34.983

您在选项 #2 中描述的是过早优化的情况。使用所有购买的 SUM() 将持续很长时间（几年）。当（如果）您开始看到此功能降级时，您可以向数据库添加索引或总计表以加快速度。当存在简单的解决方案时，不要使事情复杂化。

当然，*真正的*解决方案是用 20 年的虚构数据尝试这两种解决方案，看看是否有任何真正的区别。我怀疑没有。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-26T02:33:20.570

几乎总是1。

您将多久查询一次 20 年历史的总价值？如果答案是经常，而且性能很差，那么可以考虑优化或者OLAP。

我怀疑你担心优化太早了。这就是数据库的设计目的——让他们担心缓存。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-26T03:41:50.637

我只是补充一点，另一种可能性是创建汇总表。例如，在跟踪页面点击时，不一定要知道 IP 某某在 2008 年 11 月 19 日 14:42:04 访问了 page1.php；但您可能想要跟踪 page1.php 的每日统计信息。在这种情况下，每天结束时，您可能会运行一个过程来汇总每个页面的点击量，并在汇总表中创建一条记录，该汇总表又可以被大量索引。然后，您的报告可以针对该表运行。除了加快上报速度外，还可以加快原始记录的写入速度，无需担心表锁定或建立索引。

也就是说，好的索引可以在报告方面大有帮助。就像这里的其他人所告诫的那样，最好采用更简单，即使不是最优的解决方案，直到（如果有的话）它成为一个问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T02:37:47.567

感谢您的超前思考，但问题是，您的销售数据会在交易数据库中保留 20 年吗？

有一点是，将这些数据移动到数据仓库中会容易得多，并且只需保持您的前线数据库是最新的。

如果这是一个新项目，请更关注让它发挥作用，并让人们使用它。当您跨越这些桥梁时，请担心可扩展性。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-26T02:40:40.570

使用选项 1。稍后，如果性能变差，您可以识别特定的瓶颈并使用 #2 等选项或物化视图或其他几种可能性来解决它们。

# .net - .NET 'Any CPU' 项目是否应该绑定到 Framework 或 Framework64 DLL？

> ID：319585
> 
> 赞同：1
> 
> 时间：2008-11-26T02:28:53.467
> 
> 标签：.net, tfs, msbuild, 64-bit, 32-bit

我有一个 C# Visual Studio 项目 (.csproj)，它引用了 Framework64 版本的`System.Data`. 当我尝试在另一台机器上使用[MSBuild](http://en.wikipedia.org/wiki/MSBuild) / [Team Foundation Server](http://en.wikipedia.org/wiki/Team_Foundation_Server) (TFS) 进行构建时，由于 64 位 DLL 不存在而失败。

我应该绑定到框架版本，还是在 64 位机器上运行时会限制我？.NET 是否尽可能重定向绑定以使用 64 位？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T02:45:13.730

我认为您的意思是您的问题中的*任何 CPU*，对吗？假设是这种情况，几乎在所有情况下都可以使用不考虑位数的绑定。

回想一下，[.NET](http://en.wikipedia.org/wiki/.NET_Framework)代码是[JITed](http://en.wikipedia.org/wiki/Just-in-time_compilation) （即时编译）——这意味着无论您计划在什么架构上运行，来自C# 或[VB.NET](http://en.wikipedia.org/wiki/Visual_Basic_.NET)编译器的32 位和 64 位代码都是相同的。当代码在运行时 JITed 时，它变成 32 位或 64 位。

在某些情况下，您必须注意目标架构。一种特定情况是对[COM](http://en.wikipedia.org/wiki/Component_Object_Model)包装 DLL、提供的 .NET Framework 或其他方式的任何引用/依赖项。这是因为如果这些 DLL 文件未标记为 32 位，则这些 DLL 文件将被标记为（在 COM 的情况下）仅 32 位（因为 COM 是仅 32 位架构），与 COM 的互操作将不起作用。因此，由于它们是明确标记的，因此您的项目输出也应该如此。

# asp.net-mvc - Html.ActionLink doesn't render # properly

> ID：319587
> 
> 赞同：1
> 
> 时间：2008-11-26T02:32:42.303
> 
> 标签：asp.net-mvc

When using Html.ActionLink passing a string containing the # char renders it like it is but if you UrlEncode it renders as %2523.

I believe it's a bug. MVC Beta Release.

Is it really a bug?

[http://example.com/test#](http://example.com/test#) is rendered as

[http://example.com/test%2523](http://example.com/test%2523) instead of

[http://example.com/test%2523](http://example.com/test%2523)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-06T20:13:54.370

不是错误 :) 您不想对实际 url 进行 UrlEncode - UrlEncode 可帮助您对可能与 URI 控制字符冲突的 url 中的*文本进行编码。*同样，除非您想向用户展示 HTML 本身，否则您不会将实际的 HTML 传递给 HtmlEncode。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T02:47:34.317

是的，运行以下控制台应用程序并查看它的输出：

```
using System;
using System.Collections.Generic;
using System.Text;
using System.Web;

namespace ConsoleApplication1
{
    class Program
    {
        static void Main(string[] args)
        {
            string hash = "#";
            Console.WriteLine(HttpUtility.UrlEncode(hash));
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T02:56:43.003

好的，找到问题了……我正在使用 MVC，如果我不使用 UrlEncode，Html.ActionLink 输出 #，但如果我这样做，它会输出 %2523，它是 %23 编码的……

也许这是一个错误？

谢谢！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T02:41:47.683

Is HttpUtility.UrlEncode the same as Server.UrlEncode? (HttpContext.Current.Server.UrlEncode)

I cannot do a check right now, not near a .NET machine.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-30T00:23:32.390

您是否将 # 作为 ActionLink 参数的一部分传递？如果是这样，您应该像这样附加它： Html.ActionLink("test") + "#"

# c# - 使用 SyndicationFeed 读取 SyndicationItem 中的非标准元素

> ID：319591
> 
> 赞同：39
> 
> 时间：2008-11-26T02:34:38.290
> 
> 标签：c#, rss, syndication-feed, syndication-item

在 .net 3.5 中，有一个 SyndicationFeed 将加载到 RSS 提要中并允许您在其上运行 LINQ。

这是我正在加载的 RSS 示例：

```
<rss version="2.0" xmlns:media="http://search.yahoo.com/mrss/"> 
<channel> 
    <title>Title of RSS feed</title> 
    <link>http://www.google.com</link> 
    <description>Details about the feed</description> 
    <pubDate>Mon, 24 Nov 08 21:44:21 -0500</pubDate> 
    <language>en</language> 
    <item> 
        <title>Article 1</title> 
        <description><![CDATA[How to use StackOverflow.com]]></description> 
        <link>http://youtube.com/?v=y6_-cLWwEU0</link> 
        <media:player url="http://youtube.com/?v=y6_-cLWwEU0" /> 
        <media:thumbnail url="http://img.youtube.com/vi/y6_-cLWwEU0/default.jpg" width="120" height="90" /> 
        <media:title>Jared on StackOverflow</media:title> 
        <media:category label="Tags">tag1, tag2</media:category> 
        <media:credit>Jared</media:credit> 
        <enclosure url="http://youtube.com/v/y6_-cLWwEU0.swf" length="233" type="application/x-shockwave-flash"/> 
    </item> 
</channel> 
```

当我遍历项目时，我可以通过 SyndicationItem 的公共属性取回标题和链接。

我似乎无法弄清楚如何获取附件标签的属性或媒体标签的值。我尝试使用

```
SyndicationItem.ElementExtensions.ReadElementExtensions<string>("player", "http://search.yahoo.com/mrss/") 
```

对其中任何一个有帮助吗？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-11-20T04:34:27.190

这应该让您了解如何做到这一点：

```
using System.Linq;
using System.ServiceModel.Syndication;
using System.Xml;
using System.Xml.Linq; 
```

* * *

```
SyndicationFeed feed = reader.Read();

foreach (var item in feed.Items)
{
    foreach (SyndicationElementExtension extension in item.ElementExtensions)
    {
        XElement ele = extension.GetObject<XElement>();
        Console.WriteLine(ele.Value);
    }
} 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2010-06-02T19:29:53.503

无论您是检索扩展元素或 XElement 项的非 XML 内容，您都可能需要考虑使用通用辅助函数，例如：

```
private static T GetExtensionElementValue<T>(SyndicationItem item, string extensionElementName)
{
       return item.ElementExtensions.First(ee => ee.OuterName == extensionElementName).GetObject<T>();
} 
```

根据是否保证元素存在或是否将其放入可重用库中，您可能需要添加额外的防御性编程。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-04-26T12:56:38.743

以下是我如何使用 SyndicationFeed 从提要中检索附件链接的方法。

```
static void Main(string[] args)
{
    var feedUrl = "https://blog.stackoverflow.com/index.php?feed=podcast";

    using (var feedReader = XmlReader.Create(feedUrl))
    {
        var feedContent = SyndicationFeed.Load(feedReader);

        if (null == feedContent) return;

        foreach (var item in feedContent.Items)
        {
            Debug.WriteLine("Item Title: " + item.Title.Text);

            Debug.WriteLine("Item Links");
            foreach (var link in item.Links)
            {
                Debug.WriteLine("Link Title: " + link.Title);
                Debug.WriteLine("URI: " + link.Uri);
                Debug.WriteLine("RelationshipType: " + link.RelationshipType);
                Debug.WriteLine("MediaType: " + link.MediaType);
                Debug.WriteLine("Length: " + link.Length);
            }
        }
    }
} 
```

输出如下：

> 项目标题：Podcast #50
> 项目链接
> 链接标题：
> URI：[https](https://blog.stackoverflow.com/2009/04/podcast-50/)
> ://blog.stackoverflow.com/2009/04/podcast-50/ 关系类型：备用
> 媒体类型：
> 长度：0
> 链接标题：
> **URI：[http://itc。 conversationsnetwork.org/audio/download/ITC.SO-Episode50-2009.04.21.mp3](http://itc.conversationsnetwork.org/audio/download/ITC.SO-Episode50-2009.04.21.mp3)**
> **关系类型：附件**
> 媒体类型 ：音频/mpeg
> 长度：36580016

您可以从其关系类型中识别机箱链接。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-11-26T18:00:44.660

您可以结合使用 LINQ 和 XPathNavigator 来提取提要项的联合扩展（基于扩展的命名空间 URI）。对于项目附件，您将需要检查项目链接集合中是否存在关系类型为*附件*的链接。

例子：

```
HttpWebRequest webRequest   = WebRequest.Create("http://www.pwop.com/feed.aspx?show=dotnetrocks&filetype=master") as HttpWebRequest;

using (Stream stream = webRequest.GetResponse().GetResponseStream())
{
    XmlReaderSettings settings  = new XmlReaderSettings();
    settings.IgnoreComments     = true;
    settings.IgnoreWhitespace   = true;

    using(XmlReader reader = XmlReader.Create(stream, settings))
    {
        SyndicationFeed feed    = SyndicationFeed.Load(reader);

        foreach(SyndicationItem item in feed.Items)
        {
            // Get values of syndication extension elements for a given namespace
            string extensionNamespaceUri            = "http://www.itunes.com/dtds/podcast-1.0.dtd";
            SyndicationElementExtension extension   = item.ElementExtensions.Where<SyndicationElementExtension>(x => x.OuterNamespace == extensionNamespaceUri).FirstOrDefault();
            XPathNavigator dataNavigator            = new XPathDocument(extension.GetReader()).CreateNavigator();

            XmlNamespaceManager resolver    = new XmlNamespaceManager(dataNavigator.NameTable);
            resolver.AddNamespace("itunes", extensionNamespaceUri);

            XPathNavigator authorNavigator      = dataNavigator.SelectSingleNode("itunes:author", resolver);
            XPathNavigator subtitleNavigator    = dataNavigator.SelectSingleNode("itunes:subtitle", resolver);
            XPathNavigator summaryNavigator     = dataNavigator.SelectSingleNode("itunes:summary", resolver);
            XPathNavigator durationNavigator    = dataNavigator.SelectSingleNode("itunes:duration", resolver);

            string author   = authorNavigator != null ? authorNavigator.Value : String.Empty;
            string subtitle = subtitleNavigator != null ? subtitleNavigator.Value : String.Empty;
            string summary  = summaryNavigator != null ? summaryNavigator.Value : String.Empty;
            string duration = durationNavigator != null ? durationNavigator.Value : String.Empty;

            // Get attributes of <enclosure> element
            foreach (SyndicationLink enclosure in item.Links.Where<SyndicationLink>(x => x.RelationshipType == "enclosure"))
            {
                Uri url             = enclosure.Uri;
                long length         = enclosure.Length;
                string mediaType    = enclosure.MediaType;
            }
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-11-26T17:44:40.513

您缺少名称空间。使用[LINQPad](http://www.linqpad.net/ "LINQPad")和您的示例提要：

```
string xml = @"
    <rss version='2.0' xmlns:media='http://search.yahoo.com/mrss/'> 
    <channel> 
        <title>Title of RSS feed</title> 
        <link>http://www.google.com</link> 
        <description>Details about the feed</description> 
        <pubDate>Mon, 24 Nov 08 21:44:21 -0500</pubDate> 
        <language>en</language> 
        <item> 
            <title>Article 1</title> 
            <description><![CDATA[How to use StackOverflow.com]]></description> 
            <link>http://youtube.com/?v=y6_-cLWwEU0</link> 
            <media:player url='http://youtube.com/?v=y6_-cLWwEU0' /> 
            <media:thumbnail url='http://img.youtube.com/vi/y6_-cLWwEU0/default.jpg' width='120' height='90' /> 
            <media:title>Jared on StackOverflow</media:title> 
            <media:category label='Tags'>tag1, tag2</media:category> 
            <media:credit>Jared</media:credit> 
            <enclosure url='http://youtube.com/v/y6_-cLWwEU0.swf' length='233' type='application/x-shockwave-flash'/> 
        </item> 
    </channel>
    </rss>
    ";

XElement rss = XElement.Parse( xml );
XNamespace media = "http://search.yahoo.com/mrss/";

var player = rss.Element( "channel" ).Element( "item" ).Element(media + "player").Attribute( "url" );
player.Dump(); 
```

结果： url="http://youtube.com/?v=y6_-cLWwEU0"

要查看的构造是：Element(media + "player")，它告诉 Linq 使用由 'media' 表示的命名空间以及元素名称 'player'。

**脑损伤一定是我造成的，我以为你在使用 Linq。无论如何，您需要考虑命名空间。**

# colors - 计算颜色渐变

> ID：319594
> 
> 赞同：12
> 
> 时间：2008-11-26T02:38:59.577
> 
> 标签：colors, fade

给定两种颜色和*n*步，如何计算 n 种颜色，包括产生渐变效果的两种给定颜色？

如果可能的话，最好使用伪代码，但这可能会在 Java 中实现。

谢谢！

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-11-26T02:42:58.337

将每种颜色划分为其 RGB 分量，然后计算所需的各个步骤。

```
oldRed = 120;
newRed = 200;
steps = 10;
redStepAmount = (newRed - oldRed) / steps;

currentRed = oldRed;
for (i = 0; i < steps; i++) {
   currentRed += redStepAmount;
} 
```

显然将其扩展到绿色和蓝色。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-26T03:08:08.533

您还应该查看两个很好的相关问题：

*   [以编程方式生成渐变？](https://stackoverflow.com/questions/27532/generating-gradients-programatically)
*   [条件格式——颜色转换的百分比](https://stackoverflow.com/questions/25007/conditional-formatting-percentage-to-color-conversion)

请注意，您通常最好在 HSV 颜色空间而不是 RGB 中执行此操作 - 它会产生更令人愉悦的颜色（冲突或负面光学特性的可能性更低）。

祝你好运！

-亚当

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-26T03:32:52.947

如果你想要一个看起来像大多数颜色选择器 GUI 小部件的混合，你真的想翻译成 HSL 或 HSV。从那里开始，您可能对每个维度的线性插值都很好。

尝试直接在 RGB 颜色空间中进行*任何插值是一个坏主意。*这太非线性了（不，伽马校正在这种情况下无济于事）。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2014-04-01T20:48:15.547

对于那些寻找可以复制和粘贴的东西的人。为 RGB 颜色做了一个快速功能。返回一个单一的颜色，它是`ratio`更接近的数量`rgbColor2`。

```
function fadeToColor(rgbColor1, rgbColor2, ratio) {
    var color1 = rgbColor1.substring(4, rgbColor1.length - 1).split(','),
        color2 = rgbColor2.substring(4, rgbColor2.length - 1).split(','),
        difference,
        newColor = [];

    for (var i = 0; i < color1.length; i++) {
        difference = color2[i] - color1[i];
        newColor.push(Math.floor(parseInt(color1[i], 10) + difference * ratio));
    }

    return 'rgb(' + newColor + ')';
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-26T02:44:34.353

问题是你想要发生什么样的转变？如果您转置到 HSV 色彩空间并给出

FF0000 和 00FF00

它将从红色过渡到黄色到绿色。

但是，如果您将“黑色”或其他阴影定义为混合的中点，则必须先将颜色着色为 ff0000->000000->00ff00 或通过白色：ff0000 -> ffffff -> 00ff00。

然而，通过 HSV 进行转换可能会很有趣，因为您必须使用一些三角函数将圆形映射映射到矢量分量。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-26T02:51:20.660

最简单的做法是颜色分量之间的线性插值（参见 nickf 的响应）。请注意，眼睛是高度非线性的，所以它不一定看起来你正在均匀地走。一些色彩空间试图解决这个问题（也许是 CIE？），因此您可能希望先转换为另一个颜色空间，进行插值，然后再转换回 RGB 或您正在使用的任何颜色空间。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-07-13T05:38:56.260

[这个答案](https://stackoverflow.com/q/15757872/2012219)怎么样

```
- (UIColor *)colorFromColor:(UIColor *)fromColor toColor:(UIColor *)toColor percent:(float)percent
{
    float dec = percent / 100.f;
    CGFloat fRed, fBlue, fGreen, fAlpha;
    CGFloat tRed, tBlue, tGreen, tAlpha;
    CGFloat red, green, blue, alpha;

    if(CGColorGetNumberOfComponents(fromColor.CGColor) == 2) {
        [fromColor getWhite:&fRed alpha:&fAlpha];
        fGreen = fRed;
        fBlue = fRed;
    }
    else {
        [fromColor getRed:&fRed green:&fGreen blue:&fBlue alpha:&fAlpha];
    }
    if(CGColorGetNumberOfComponents(toColor.CGColor) == 2) {
        [toColor getWhite:&tRed alpha:&tAlpha];
        tGreen = tRed;
        tBlue = tRed;
    }
    else {
        [toColor getRed:&tRed green:&tGreen blue:&tBlue alpha:&tAlpha];
    }

    red = (dec * (tRed - fRed)) + fRed;
    green = (dec * (tGreen - fGreen)) + fGreen;
    blue = (dec * (tBlue - fBlue)) + fBlue;
    alpha = (dec * (tAlpha - fAlpha)) + fAlpha;

    return [UIColor colorWithRed:red green:green blue:blue alpha:alpha];
} 
```

# c++ - Declaring Dynamic Memory Statements C++

> ID：319595
> 
> 赞同：2
> 
> 时间：2008-11-26T02:39:26.377
> 
> 标签：c++, memory, dynamic

Hi if I am creating something on the stack using new I declare it like:

```
object *myObject = new object(contr, params); 
```

Is there a way to declare this such as:

```
object *myObject;
myObject = new object(constr, params); 
```

Is this correct?

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-26T02:42:46.200

Yes, that is correct. But new does not create things on the stack, it creates them on the heap.

To create object on the stack you would do:

```
object myObject(constr, params); 
```

There is no other way to create an object on the stack and once it is created on the stack you can't "recreate" it with the same name later in the same function.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T02:57:25.250

正如其他人所说， new 将在堆上创建 *myObject 。为了完整起见，我将指出指向对象的指针，称为 myObject（注意没有 *）确实以您声明它的方式驻留在堆栈中。由于堆栈变量在您离开函数时超出范围，因此您必须在返回之前删除对象，或者将指针转移到另一个生命周期更长的变量。在从函数返回之前忽略删除指针位于堆栈变量中的堆对象是一种典型的内存泄漏场景（尽管远非唯一）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-26T02:42:48.867

Yes that is correct but it won't allocate on the stack. Instead it will allocate on the heap. If you want to allocate on the stack, declare it this way

```
object myObject(contr,params); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-26T02:43:23.747

If you want the object to be on the stack, you need to say

```
object myObject(contr, params); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T05:03:05.307

这段代码：

```
object *myObject;
myObject = new object(constr, params); 
```

...合法且正确。但是请**在**分配时将 myObject 初始化为某个值。请记住，“myObject”本身不是“对象”的实例，而是指向“对象”的*指针*的实例。所以当你像这样声明这个指针时：

```
object *myObject; 
```

...你让它未初始化。相反，请执行以下操作：

```
object *myObject = 0;
myObject = new object(constr, params); 
```

...当你删除它时：

```
delete myObject;
myObject = 0; 
```

人们可能会争论你应该将它设置为 NULL 而不是 0，但就语言而言，两者都很好，这主要是风格问题和你的同事习惯的问题。

# svn - 颠覆升级问题 - 1.5.3 到 1.5.4

> ID：319615
> 
> 赞同：0
> 
> 时间：2008-11-26T02:48:12.943
> 
> 标签：svn, upgrade

我有一个 Windows 客户端，我想将 subversion 从 1.5.3 升级到 1.5.4。有没有安装步骤。. 我只是复制 zip 并提取并覆盖现有的目录吗？我找不到任何明确的升级说明。.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T03:55:55.583

你用的是哪个windows客户端？

到目前为止，TortoiseSVN 的升级路径对我来说非常完美。您只需下载最新的安装程序，运行它，然后重新开始工作。

我唯一遇到的问题是从 1.4x 升级到 1.5x，您*必须*在安装后重新启动计算机，否则您将开始收到各种奇怪的错误，因为内存缓存中的 Tortoise SVN 将过期并且不兼容。

重启后一切正常。存储库始终会自动升级，除非更改日志中另有说明，否则您可以无忧升级。

无论如何，升级客户端应该是一个低问题，只需备份您的工作副本，执行升级，如果您确实遇到问题，请将项目签入新文件夹，将任何更改的文件移入，然后您的所有放。

升级存储库可能会产生更多影响，但同样，我在系统的那一侧还没有遇到问题。

有备份是一个很好的故障保险。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T13:35:56.083

我假设您正在尝试升级 Windows 命令行客户端。据我所知，这些二进制文件有 5 个主要版本

*   [Collabnet Subversion 下载](http://www.collab.net/downloads/subversion/)[需要注册]
*   [底格里斯 zip 文件](http://subversion.tigris.org/servlets/ProjectDocumentList?folderID=91&expandFolder=91&folderID=74)
*   [Tigris 设置](http://subversion.tigris.org/servlets/ProjectDocumentList?folderID=91&expandFolder=91&folderID=74)[通常延迟]
*   [Slik Subversion win32/x64 MSI](http://sliksvn.com/en/download) [仅限客户端；没有 Apache 模块]
*   [VisualSVN 服务器](http://www.visualsvn.com/server/)[服务器，但包含客户端工具。

通常您应该只选择一个来源并使用相同的来源来获取您的更新，因为它们不会相互更新。

如果您只需要客户端（并且没有本地服务器支持），我建议您使用 collabnet 或 Slik 设置，因为它们具有干净的升级路径。

# c++ - C++ 参数参考

> ID：319623
> 
> 赞同：1
> 
> 时间：2008-11-26T02:54:34.677
> 
> 标签：c++, parameters, reference

无效 (int a[]) { a[5] = 3; // 这是错的吗？}

我可以这样做以便修改传入的数组吗？

不好意思删了，有点新意。。。

我还有另一个问题可以回答我的问题：

如果我有

```
void Test(int a) {
}

void Best(int &a) {
} 
```

这两个陈述是等价的吗？

```
Test(a);
Best(&a); 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-26T03:26:13.897

```
void Test(int a[]) 
{
    a[5] = 3;
} 
```

只是替代语法：

```
void Test(int* a) 
{
    *(a+5) = 3;
} 
```

没有传递数组，只是一个指针。原始数组被修改。

至于你的第二次修订，给定：

```
void Test(int a) 
{
}

void Best(int &a) 
{
} 
```

然后

```
Test(aa);      // Passes aa by value.  Changes to a in Test() do not effect aa
Best(aa);      // Passes aa by reference; Changes to a DO effect aa
Best(&aa);     // Is a syntax error: Passing a pointer instead of an int. 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T02:57:09.790

如果您不是通过引用而不是通过指针获取变量，则意味着该函数本质上是孤立的，获得了 a 的临时副本。无论您做什么（不尝试破解堆栈或类似的事情），您都无法在调用上下文中访问该值。

如果您对调用上下文有所了解，则可以根据对堆栈内容的一些预期来做事，但这通常是个坏主意。

如果您的方法采用本质上是 a* 的 a[]，那么是的，您可以更改 a 指向的单元格的内容，但您将无法更改 a（指针）本身以指向其他内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T03:00:06.243

没有。

从函数外部更改值的选项是通过引用调用 f(int& a)、通过指针调用 f(int* a) 以及使用全局（颤抖...）变量。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T08:33:16.927

阅读此处给出的关于参数列表中`int[]`和的区别的答案：[和之间的](https://stackoverflow.com/questions/308279/c-vs#308724)[区别](https://stackoverflow.com/questions/308279/c-vs#308724)。我真的在这个答案中投入了太多的爱！:)`int*`[`char*``char[]`](https://stackoverflow.com/questions/308279/c-vs#308724)

关于您关于您的`Test`功能`Best`的问题，**James Curran**提供了一个很好的答案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T18:36:08.303

您的原始功能应该可以工作。
**如果你给它一个名字：**

```
#include <iostream>

// Arrays always de-generate to pointers.
void plop(int a[])  // Make sure this function has a name.
{
    a[5]    = 3;
}

int main()
{
    int test[]  = { 1,1,1,1,1,1,1,1};

    plop(test);

    std::cout << test[5] << std::endl;
} 
```

这是因为数组在作为参数传递给函数时总是退化为指针。所以这应该总是按预期工作。假设您没有超出数组末尾的索引。在 plop 内部，无法确定传递的数组的大小。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-11-26T04:08:57.180

通过引用传递数组的主要动机是防止堆栈溢出和大对象的不必要复制。例如，想象一下如果我有这样的函数：

```
void foo(int x[500000000000]); 
```

如果所有数组都是按值传递的，那么第一次调用该函数时，堆栈可能会溢出（但这当然是明显的夸张）。

这将在使用面向对象的方法时变得有用。假设你有这个而不是一个数组：

```
void foo(SomeClass x); 
```

其中 SomeClass 是具有 500000000000 个数据成员的类。如果你调用这样的方法，编译器会一点一点地复制 x，这至少可以说是一个很长的过程。您在数组中使用的相同概念仍然适用，但您必须指定这是手动引用使用：

```
void foo(SomeClass &x); 
```

（除非您有 64 位机器和大量 RAM，否则不要尝试创建一个 500000000000 元素数组开始）

# linq - LINQ 分组/子查询以填充层次结构数据结构

> ID：319626
> 
> 赞同：2
> 
> 时间：2008-11-26T02:56:44.547
> 
> 标签：linq, data-structures, grouping, hierarchy, subquery

我有一个 DataTable 查询如下内容

```
usergroupid...userid......username
1.............1...........John
1.............2...........Lisa
2.............3...........Nathan
3.............4...........Tim 
```

我要做的是编写一个 LINQ 语句，该语句将返回一组 UserGroup 实例。UserGroup 类具有 UserGroupId 和 Users 的属性。Users 是一组 User 实例。然后，用户类具有 UserId 和 UserName 的属性。

可以使用单个 LINQ 语句来填充这样的层次结构吗？它会是什么样子？

太感谢了

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-26T03:42:33.427

看看这个，希望对你有帮助

```
var users = new[] 
{
    new {UserGroupId = 1, UserId = 1, UserName = "John"},
    new {UserGroupId = 1, UserId = 2, UserName = "Lisa"},
    new {UserGroupId = 2, UserId = 3, UserName = "Nathan"},
    new {UserGroupId = 3, UserId = 4, UserName = "Tim"}
};

var userGroups = from user in users 
                 group user by user.UserGroupId into userGroup 
                 select new {
                                UserGroupId = userGroup.Key, 
                                Users = userGroup.ToList()
                            };

foreach (var group in userGroups)
{
    Console.WriteLine("{0} - {1}",group.UserGroupId, group.Users.Count);
} 
```

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2008-11-26T03:21:01.207

有 - 查看 GroupBy 和 Select 方法。

# c# - DocProject vs Sandcastle 帮助文件生成器 GUI

> ID：319632
> 
> 赞同：22
> 
> 时间：2008-11-26T03:00:02.967
> 
> 标签：c#, sandcastle

我有几个 C# 项目以及一些我试图一起记录的内部库组件。Sandcastle 似乎是从 C# 生成文档的地方。我想知道 DocProject 或 Sandcastle Help File Builder GUI 两者中的哪一个更好并且支持我需要的功能。

我想只编译每个项目自己的文档部分，然后最后将它们全部集成在一起。（即一个文档项目中的库组件和它自己的文档项目中的每个项目，然后使用 Help 2 查看器将上述所有内容放在一个根目录中）

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-03T01:42:11.080

我可以担保 Sandcastle Help File Builder。它工作得非常好，您可以在 Sandcastle Help File Builder 项目中记录任意数量的程序集。理论上，您可以拥有一个 Builder 项目并为每个 C# 项目生成一个文档，然后拥有一个主 Builder 项目来记录所有内容。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-29T16:35:27.137

以下是基于 Sandcastle 的 .NET 文档的一些有用链接：

[沙堡教程](http://blogs.msdn.com/sandcastle/archive/2006/07/29/682398.aspx)

[关于 SHFB 的Sandcastle 帮助文件生成器](http://www.codeplex.com/SHFB)(SHFB)
[教程](http://www.codeproject.com/KB/cs/SandcastleBuilder.aspx)

[关于如何记录 Web 项目的](http://www.codeproject.com/KB/vb/SandcastleXmlFileBuilder.aspx)[Web 项目文档](http://www.codeplex.com/Release/ProjectReleases.aspx?ProjectName=SandcastleStyles&ReleaseId=13517)教程（更多手册，我相信之前的链接已经过时）

[XML 文档的 MSDN 参考](http://msdn.microsoft.com/en-us/library/ms172652.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-09-14T23:06:03.147

我没有使用过 DocProject，但它似乎是一款功能可与 Sandcastle 相媲美的产品。

我使用过[Sandcastle](http://sandcastle.codeplex.com/)，我发现它是一个有效的工具。您还需要[Sandcastle Help File Builder](http://shfb.codeplex.com/) (SHFB) 来为您提供良好的前端，正如其他人在这里提到的那样。此外，您需要[Sandcastle Styles](http://sandcastlestyles.codeplex.com/)来为 Sandcastle 引擎提供表示层补丁。[虽然所有这三个组件都在 2010 年中期发布了新版本，但由于 Firefox 3.6 中的呈现缺陷（记录在此缺陷报告](http://sandcastlestyles.codeplex.com/workitem/11465)的 2010.09.06 条目中），我推迟了从 2008 版本的升级。

我已经彻底记录了我在描述该问题的平台上的经验，以及您可能需要或想要考虑的各种其他问题，以便生成一个整洁、专业的文档集。我的文章《[驯服沙堡：编写代码的 .NET 程序员指南](http://www.simple-talk.com/dotnet/.net-tools/taming-sandcastle-a-.net-programmers-guide-to-documenting-your-code/)》刚刚于 2010 年 9 月在[Simple-Talk.com](http://www.simple-talk.com/)上发表；**它可能会为您**节省一些时间、精力和痛苦:-)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-19T15:01:20.287

Doc Project 生成更精美的文档 - 当它工作时 - 并非一直如此。这是一个更加脆弱的产品。

Sandcastle 帮助文件生成器很可靠，可以完成工作。

# java - 你能弄清楚为什么这个程序会触发 IllegalStateException 吗？

> ID：319634
> 
> 赞同：2
> 
> 时间：2008-11-26T03:03:22.430
> 
> 标签：java, exception, encryption, cryptography

~/Cipher/nsdl/crypto 中的所有文件都可以在[这里](http://nsdeleon.wikispaces.com/file/detail/crypto.zip)找到 用 gcj 编译的 java 文件，请参阅 compile.sh

```
nmint@nqmk-mint ~/Cipher/nsdl/crypto $ echo test | ./cryptTest encrypt deadbeefdeadbeefdeadbeefdeadbeef deadbeef Blowfish CBC > test
null
Exception in thread "main" java.lang.IllegalStateException: cipher is not for encrypting or decrypting
   at javax.crypto.Cipher.update(libgcj.so.81)
   at javax.crypto.CipherOutputStream.write(libgcj.so.81)
   at nsdl.crypto.BlockCrypt.encrypt(cryptTest)
   at nsdl.crypto.cryptTest.main(cryptTest) 
```

BlockCrypt.java：

```
package nsdl.crypto;

import java.io.*;
import java.security.spec.*;
import javax.crypto.*;
import javax.crypto.spec.*;

public class BlockCrypt {
Cipher ecipher;
Cipher dcipher;
byte[] keyBytes;
byte[] ivBytes;
SecretKey key;
AlgorithmParameterSpec iv;
byte[] buf = new byte[1024];

BlockCrypt(String keyStr, String ivStr, String algorithm, String mode) {
    try {
        ecipher = Cipher.getInstance(algorithm + "/" + mode + "/PKCS5Padding");
        dcipher = Cipher.getInstance(algorithm + "/" + mode + "/PKCS5Padding");

        keyBytes = hexStringToByteArray(keyStr);
        ivBytes = hexStringToByteArray(ivStr);

        key = new SecretKeySpec(keyBytes, algorithm);
        iv = new IvParameterSpec(ivBytes);

        ecipher.init(Cipher.ENCRYPT_MODE, key, iv);
        dcipher.init(Cipher.DECRYPT_MODE, key, iv);
    } catch (Exception e) {
        System.err.println(e.getMessage());
    }
}

public void encrypt(InputStream in, OutputStream out) {
    try {
        // out: where the plaintext goes to become encrypted
        out = new CipherOutputStream(out, ecipher);

        // in: where the plaintext comes from
        int numRead = 0;
        while ((numRead = in.read(buf)) >= 0) {
            out.write(buf, 0, numRead);
        }
        out.close();
    } catch (IOException e) {
        System.err.println(e.getMessage());
    }
}

public void decrypt(InputStream in, OutputStream out) {
    try {
        // in: where the plaintext come from, decrypted on-the-fly
        in = new CipherInputStream(in, dcipher);

        // out: where the plaintext goes
        int numRead = 0;
        while ((numRead = in.read(buf)) >= 0) {
            out.write(buf, 0, numRead);
        }
        out.flush();
        out.close();
    } catch (IOException e) {
        System.err.println(e.getMessage());
    }
}
public static byte[] hexStringToByteArray(String s) {
    int len = s.length();
    byte[] data = new byte[len / 2];
    for (int i = 0; i < len; i += 2) {
        data[i / 2] = (byte) ((Character.digit(s.charAt(i), 16) << 4)
        + Character.digit(s.charAt(i+1), 16));
    }
    return data;
}
} 
```

cryptTest.java：

```
package nsdl.crypto;

import nsdl.crypto.BlockCrypt;

public class cryptTest {

public static void main (String args[]) {
    if (args.length != 5) {
        System.err.println("Usage: cryptTest (encrypt|decrypt) key iv algorithm mode");
        System.err.println("Takes input from STDIN. Output goes to STDOUT.");
    } else {
        String operation = args[0];
        String key = args[1];
        String iv = args[2];
        String algorithm = args[3];
        String mode = args[4];
        BlockCrypt blockCrypt = new BlockCrypt(key, iv, algorithm, mode);
        if (operation.equalsIgnoreCase("encrypt")) {
            blockCrypt.encrypt(System.in, System.out);
        } else if (operation.equalsIgnoreCase("decrypt")) {
            blockCrypt.decrypt(System.in, System.out);
        } else {
            System.err.println("Invalid operation. Use (encrypt|decrypt).");
        }
    }
}
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-26T08:09:22.577

密码 ,`ecipher`未初始化，`IllegalStateException`当您尝试使用它时，它会抛出一个，就好像它是在 中初始化的一样`ENCRYPT_MODE`。

请注意您`catch`在`BlockCrypt`. 它正在捕获没有消息的异常，并将“null”打印到`System.err`. 而不是中止执行——也许是通过从构造函数中抛出一个异常——你继续航行。

替换`System.err.println(e.getMessage())`为`e.printStackTrace()`或至少`System.err.println(e)`应该为您提供更多详细信息。我的猜测是`ecipher.init()`抛出异常，因为您提供的是 32 位 IV 而不是 64 位。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T05:09:09.430

也许查看[javax.crypto.Cipher 的源代码](http://fuseyism.com/classpath/doc/javax/crypto/Cipher-source.html)有助于理解这一点？即使在源代码中找到错误消息，我也无法弄清楚。祝你好运！

# database-design - 两个数据库表与一个数据库表

> ID：319636
> 
> 赞同：0
> 
> 时间：2008-11-26T03:06:26.790
> 
> 标签：database-design

我有一张音乐专辑表。我有第二张专辑封面表。不幸的是，并非每张专辑都有一些专辑封面数据。因此，我需要在音乐和专辑封面之间进行 OUTER JOIN。

假设：两个表都只包含 int 和 varchars .. 没有 blob 等。

*问题*

*   将两个表合并为一个以减少外部连接要求会更好吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-26T03:10:42.180

我可以看到将它们放在单独的表格中的唯一原因是一张专辑是否可以包含多件艺术品。如果每张桌子只包含并且永远只包含一件艺术品，那么将它们放在同一张桌子上应该没问题。如果您在很多不同的实例中连接这两个表，您可能需要创建一个视图以简化您的 SQL 语句。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T03:10:36.783

只需使用一张表，对于没有艺术的专辑使用空值。我认为拥有第二张桌子没有任何优势……除非您有很多共享相同艺术作品的专辑。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T03:11:05.003

在这种情况下，两张表通常意味着一个->多的关系，这可能不是您想要的，尽管我猜有些专辑带有多个艺术品。

所以理论上你应该将表合并为一个，除非你有很好的理由将它们分成两个。为什么要将它们作为两个表？

# aop - 什么是面向方面的编程？

> ID：319639
> 
> 赞同：15
> 
> 时间：2008-11-26T03:08:25.633
> 
> 标签：aop

### 复制：

> [什么是面向方面编程？](https://stackoverflow.com/questions/242177/what-is-aspect-oriented-programming)

每次我在这里播客或阅读有关它的博客文章时，即使是在这里，他们也让它听起来像弦理论或其他东西。用类固醇上的依赖注入来描述它的最佳方式是 OOP 吗？

每次有人试图解释它时，就像，Aspects，[来自花生卡通声音的成人声音]，正交，[更多噪音]，横切关注点等。说真的，任何人都可以用外行的话来描述它。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-11-26T03:15:17.863

外行术语，所以让我举个例子。假设您有一个 Web 应用程序，并且您需要添加错误日志记录/审计。一种实现是进入每个公共方法并添加您的 try catch 块等......

面向方面的说废话，让我在你的方法周围注入我的方法，例如，系统可能会调用，而不是调用 YourClass.UpdateModel()，

LoggingHandler.CallMethod() 然后，此方法可能会将调用重定向到 UpdateModel，但会将其包装在 try catch 块中以处理日志记录错误。

现在的诀窍是，这种重定向会自动发生，通过配置或将属性应用于方法。

正如您所说，这适用于横切事物，这些事物是每个域中都存在的非常常见的编程元素，例如：日志记录、审计、事务管理、授权。

它背后的想法是从您的业务/应用程序层中删除所有这些常见的管道代码，这样您就可以专注于解决问题，而不必担心记录这个方法调用或那个方法调用。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-26T03:28:22.067

.NET 中的类和方法属性是一种面向方面的编程形式。你用属性装饰你的类/方法。在幕后，这会将代码添加到执行属性的特定功能的类/方法中。例如，将类标记为可序列化允许它自动序列化以存储或传输到另一个系统。其他属性可能会将某些属性标记为不可序列化，并且这些属性将自动从序列化对象中省略。序列化是一个方面，由系统中的其他代码实现，并通过应用“配置”属性（装饰）应用于您的类。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-26T03:32:32.883

AOP 是关于管理应用程序内的通用功能（跨越应用程序，因此是交叉的），使其不嵌入业务逻辑中。

此类横切关注点的示例是日志记录、管理安全性、事务管理等。

框架允许在一些配置文件的帮助下自动管理它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-26T03:20:15.467

我目前使用[Post Sharp](http://www.postsharp.org/)，我会从他们的网站上阅读信息。我用它来提供方法调用的安全性。

> “PostSharp 是一个用于分析和转换 .NET 程序集的开放平台。它带有 PostSharp Laos，这是一个强大而简单的插件，可让您开发自定义属性，实际添加代码行为。PostSharp Laos 是领先的方面 - .NET Framework 的面向编程 (AOP) 解决方案。”

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-26T03:32:22.963

经典的例子是安全和日志记录。不是在应用程序中编写代码来记录 x 的出现或检查对象 z 以进行安全访问控制，而是有一个普通代码的“带外”语言装置，它可以系统地注入安全性或登录到天然没有它们的例程中这样即使您的代码不提供它 - 它也会得到照顾。

一个更具体的例子是操作系统提供对文件的访问控制。软件程序不需要检查访问限制，因为底层系统会为它工作。

如果您认为根据我的经验需要 AOP，那么您实际上确实需要投入更多的时间和精力在系统内进行适当的元数据管理，并重点关注经过深思熟虑的结构/系统设计。

# sql - 电影分级数据库的新手 SQL 查询问题

> ID：319649
> 
> 赞同：1
> 
> 时间：2008-11-26T03:18:07.687
> 
> 标签：sql, database, sql-server-2005

我有一个带有一张表的数据库，如下所示：

```
UserID (int), MovieID (int), Rating (real) 
```

userIDs 和 movieIDs 是很大的数字，但我的数据库只有许多可能值的样本（4000 个唯一用户和 3000 个唯一电影）

我将对其进行矩阵 SVD（奇异值分解），因此我想将此数据库作为有序数组返回。基本上，我想按顺序返回每个用户，对于每个用户，按顺序返回每部电影，然后返回该用户、电影对的评分，如果该用户没有评价该特定电影，则返回 null。例子：

```
USERID | MOVIEID | RATING
-------------------------
99835   8847874    4
99835   8994385    3
99835   9001934    null
99835   3235524    2
           .
           .
           .
109834  8847874    null
109834  8994385    1
109834  9001934    null

etc 
```

这样，我可以简单地将这些结果读入一个二维数组，适合我的 SVD 算法。（将不胜感激将信息数据库放入简单的二维浮点数组的任何其他建议）

按顺序返回这一点很重要，这样当我取回二维数组时，我将能够将值重新映射到相应的用户和电影以进行分析。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-26T03:28:37.493

```
SELECT m.UserID, m.MovieID, r.Rating
    FROM (SELECT a.userid, b.movieid
              FROM (SELECT DISTINCT UserID FROM Ratings) AS a,
                   (SELECT DISTINCT MovieID FROM Ratings) AS b
         ) AS m LEFT OUTER JOIN Ratings AS r
         ON (m.MovieID = r.MovieID AND m.UserID = r.UserID)
    ORDER BY m.UserID, m.MovieID; 
```

*现在测试，它似乎工作！*

这个概念是创建 Ratings 表中 UserID 值列表与 Ratings 表中 MovieID 值列表的笛卡尔积（哎呀！），然后将该完整矩阵与 Ratings 表进行外部连接（再次）收集评级值。

这**不是**有效的。

它可能是有效的。

您可能会做得更好，只运行简单的数据选择，并安排在数据到达时填充数组。如果您有成千上万的用户和电影，您将返回数百万行，但其中大多数将有空值。您应该将传入的数据视为稀疏矩阵的描述，并首先将程序中的矩阵设置为全零（或其他默认值），然后从数据库中读取流并仅设置实际存在的行。

该查询基本上是微不足道的：

```
SELECT UserID, MovieID, Rating
    FROM Ratings
    ORDER BY UserID, MovieID; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T04:52:17.967

有时最好的办法是重构表/规范化您的数据（如果这是一个选项）。

规范化数据结构：

用户表：（所有不同的用户）
UserId、FirstName、LastName

电影表：（所有不同的电影）
MovieId，名称

UserMovieRatings：（用户对电影的评分）
UserId、MovieId、Rating

如果您想要用户和电影的每个组合，则可以进行笛卡尔连接，然后根据需要使用 UserMovieRatings 表。

最好在系统变得更复杂之前立即进行重构。提前花点时间，我很肯定你需要提出的任何问题都会自然而然地出现......希望有帮助......

示例查询：

```
 select UserId, FirstName, LastName, MoveId, Name, cast(null as int) as Rating
into #FinalResults
from Users
cross join Movies 

```

```
 update #FinalResults
set Rating = UMR.Rating
from #FinalResults FR
inner join UserMovieRatings UMR
on FR.UserId = UMR.UserId and FR.MovieId = UMR.MovieId 

```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T04:01:30.953

如果我正确理解了您的问题，那么您的表中就有所有数据，并且您只想以正确的顺序提取它。那是对的吗？如果是这样，它应该只是一个问题：

```
select userid, movieid, rating
from ratings
order by userid, movieid 
```

# c++ - C++ 异常处理程序的一个奇怪问题

> ID：319651
> 
> 赞同：0
> 
> 时间：2008-11-26T03:18:49.120
> 
> 标签：c++, exception

我在 C++ 中使用了标准的异常处理方法。这是 try{} 和 catch{} 块。在我的代码中，func1() 会抛出异常，而 func2 是这样的：

```
bool func2()
{
    try{
       func1();
    }

    catch(myException& e)
    {
       cerr << "error!" << endl;
       return false;
    }
    return true;
} 
```

但是当我运行我的代码时，发生了一件奇怪的事情。我从来没有达到抛出异常的代码，但我总是在 catch 块中达到 return false 的行（但`cerr <<`也从未达到该行）。然后函数继续返回true。我不知道是什么原因。谁能帮我解决问题？非常感谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-26T03:23:34.103

如果您在编译器中使用任何优化标志（即不是调试模式），您就不能相信调试器会向您显示正确的执行行。您发表了自相矛盾的陈述——“return false”语句正在执行，但函数正在返回 true。这是我能想到的唯一解释。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T10:48:10.447

正如@Mark Ransom 所说，您可能启用了优化。为了帮助您了解发生了什么，这是编译器可能生成的代码的 C++ 等价物：

```
bool func2()
{
    bool ret;

    try{
       func1();
       ret = true;
    }

    catch(myException& e)
    {
       cerr << "error!" << endl;
       ret = false;
    }

    return ret;
} 
```

但是，当您位于`return ret;`生成代码的“行”时，原始代码中有*两*行您实际上可能位于：`return false;`和`return true;`. 调试器不知道哪个是正确的，因此它显示第一个（实际上，是编译器在生成调试器将使用的表时做出选择）。

如果您告诉编译器生成一个汇编文件并查看它，这将更加明显。假设这是 x86，返回值为 on `%eax`，两个分支都将设置`%eax`为 1 或 0，然后跳转或下降到公共函数结尾代码（它实际上将从函数返回的位置）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T18:24:54.720

如果没有产生输出并且函数返回真。

那么转义 func1() 也不例外。
结果，该函数返回 true。

但是您可能遇到的是调试器无法在代码优化后将机器指令映射回 C++ 源代码（因为优化器可能会重新排列代码）。

我建议您尝试以下类似的方法，以确保您报告所有异常。

尝试这个：

```
bool func2()
{
    try
    {
         func1();
    }
    catch(MyException const& e)
    {
         std::cerr << "Error!: Cought My Exception\n";
         return false;
    }
    catch(...)  // Catch any other exceptions
    {
        std::cerr << "Error!: Unknown Exception detected\n";
        /*
         * To keep the same functionality of your original code
         * Rethrow the unknown exception.
         */
        throw;
    }
    return true;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T15:47:18.377

如果您正在点击 return true 语句，是否会引发另一种类型的异常？尝试添加一个 catch(...)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T15:51:50.910

我注意到有时 cerr 会表现得很奇怪，你试过用 cout 替换 cerr 吗？也只需尝试将两个 cout 放在异常块中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-26T03:23:17.613

在 WinDbg（或 gdb）中打开您的应用程序，并启用第一次机会异常（在 WinDbg 中通过 sxe eh）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-26T03:29:07.417

你怎么知道它达到了return false？如果 func2 没有执行 cerr 并返回 true，听起来好像没有捕获到异常并且没有执行 return false。

如果您使用的是调试器，有时它会显示您在 catch 块的右大括号上，而没有抛出异常，这可能会造成混淆。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-11-26T03:27:40.740

使用调试模式，而不是优化模式。另外，请确保您没有写入任何悬空指针。

# c# - C# 中的 GetWindowLong 与 GetWindowLongPtr

> ID：319672
> 
> 赞同：4
> 
> 时间：2008-11-26T03:30:50.143
> 
> 标签：c#, getwindowlong

我像这样使用GetWindowLong：

```
[DllImport("user32.dll")]
private static extern IntPtr GetWindowLong(IntPtr hWnd, int nIndex); 
```

但根据 MSDN 文档，我应该使用 GetWindowLongPtr 来兼容 64 位。 [http://msdn.microsoft.com/en-us/library/ms633584(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms633584(VS.85).aspx)

GetWindowLongPtr 的 MSDN 文档说我应该这样定义它（在 C++ 中）：

```
LONG_PTR GetWindowLongPtr(HWND hWnd, int nIndex); 
```

我曾经使用 IntPtr 作为返回类型，但是对于 LONG_PTR 的等价物，我到底要使用什么？我还看到在 C# 中这样定义 GetWindowLong：

```
[DllImport("user32.dll")]
private static extern long GetWindowLong(IntPtr hWnd, int nIndex); 
```

什么是正确的，如何确保正确的 64 位兼容性？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-26T03:43:03.550

您应该使用 IntPtr 定义 GetWindowLongPtr。在 C/C++ 中，LONG_PTR 在 32 位系统上是 32 位，在 64 位系统上是 64 位（参见[此处](http://msdn.microsoft.com/en-us/library/aa383751(VS.85).aspx)）。C# 中的 IntPtr 旨在以相同的方式工作（请参阅[此处](http://msdn.microsoft.com/en-us/library/system.intptr(VS.71).aspx)）。

所以你想要的是：

```
[DllImport("user32.dll")]
private static extern IntPtr GetWindowLongPtr(IntPtr hWnd, int nIndex); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-26T08:22:02.677

不幸的是，这并不容易，因为 GetWindowLongPtr 在 32 位 Windows 中不存在。在 32 位系统上，GetWindowLongPtr 只是一个指向 GetWindowLong 的 C 宏。如果您确实需要在 32 位和 64 位系统上使用 GetWindowLongPtr，则必须确定在运行时调用的正确的。请参阅[pinvoke.net上的说明](http://www.pinvoke.net/default.aspx/user32/GetWindowLongPtr.html)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-26T04:19:07.190

肥皂盒是正确的。

此外，如果您需要查看 Win32 中的类型或函数应如何编组，请尝试使用[PInvoke Interop Assistant](http://www.codeplex.com/clrinterop/Release/ProjectReleases.aspx?ReleaseId=14120)。它将为大多数 Win32 API 内置生成，并且可以根据代码片段进行自定义生成。

# algorithm - 按变化最小的顺序对结构进行排序

> ID：319679
> 
> 赞同：0
> 
> 时间：2008-11-26T03:33:30.807
> 
> 标签：algorithm, language-agnostic, sorting

**这结果令人费解。我会改写**

是否有一种算法或方法可以对数组进行排序，以使连续元素之间的差异最小化？

```
struct element
{
uint32 positions[8];
} 
```

这些记录不区分顺序。
输出文件格式定义为：

```
byte  present;  // each bit indicating whether position[i] is present
uint32 position0;
-- (only bits set in Present are actually written in the file).  
uint32 positionN;  // N is the bitcount of "present"
byte  nextpresent; 
```

所有记录都保证是唯一的，因此 0 的“当前”字节表示 EOF。通过使用当前字段更新“当前”结构来解析文件，并将结果添加到列表中。

例如：{ 1, 2, 3}, { 2, 3, 2}, { 4, 2, 3}
将是： 111b 1 2 3 001b 4 111b 2 3 2 从未
排序的方法中保存 2 个数字。

我的目标是最小化输出文件的大小。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-01T16:37:42.147

## 你的问题

我认为这个问题真的应该用“压缩”来标记。

据我了解，您有由八个 4 字节整数组成的无序记录：总共 32 个字节。您希望以最小文件大小存储这些记录，并决定使用某种形式的基于[汉明距离的](http://en.wikipedia.org/wiki/Hamming_distance)[增量编码](http://en.wikipedia.org/wiki/Delta_encoding)。您正在询问如何为您构建的压缩方案最好地对数据进行排序。

## 你的假设

从您告诉我们的内容来看，我认为您没有任何真正的理由以您描述的方式拆分 32 个字节（除了字边界很方便）！如果你得到相同的数据，你真的关心它是被编码为 8 个 4 字节，还是 16 个 2 字节，还是一个巨大的 32 字节整数？

此外，除非问题领域的某些内容使您的方法成为最受欢迎的方法，否则您最好的选择可能是使用[久经考验的压缩方案](http://en.wikipedia.org/wiki/Data_compression#Lossless_data_compression)。您应该能够找到已经编写好的代码，并且您将在典型数据上获得良好的性能。

## 你的问题

回到你原来的问题，如果你真的想走这条路。很容易想象选择一个起始记录（我认为这不会有太大区别，但选择“最小”或“最大”可能是有意义的），并计算与所有其他记录的汉明距离。然后，您可以选择距离最短的那个来存储下一个，然后重复。显然这是记录数的 O(n^2) 。不幸的是，[这篇论文](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.7.3940)（我还没有详细阅读或理解）使它看起来像计算从一个字符串到一组其他字符串的最小汉明距离本质上是困难的，并且没有很好的近似值。

[通过基于汉明权重](http://en.wikipedia.org/wiki/Hamming_weight)（归结为该 32 字节整数的人口计数）对记录进行排序，您显然可以获得更好的复杂性，即记录数中的 O(n log(n))。然后对结果使用一些差异编码。但我认为这不会是一个非常好的压缩方案：从 0 到 7 的整数可能最终会像这样：

000, 100, 010, 001, 101, 011, 110, 111

0, 4, 2, 1, 5, 3, 6, 7

这让我们回到了我之前问过的问题：你确定你的压缩方案比对你的特定数据更标准的压缩方案更好吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T04:04:38.000

您正在查看一对子问题，定义结构之间的差异，然后是排序。

我不太清楚您对结构的描述，也不清楚差异的优先级，但我假设您可以解决这个问题并计算两个实例之间的差异分数。对于文件，有用于讨论这些事情的已知算法，例如[diff](http://en.wikipedia.org/wiki/Diff)中使用的算法。

对于您的订购，您正在研究一个经典的[旅行推销员问题](http://en.wikipedia.org/wiki/Travelling_salesman_problem)。如果您要对其中一些东西进行分类，那很容易。如果要对其中的很多进行排序，则必须满足于“足够好”的排序，除非您已准备好将领域知识和 TSP 中的许多小技巧应用到工作中。

# integer - 整数布尔运算

> ID：319696
> 
> 赞同：4
> 
> 时间：2008-11-26T03:45:36.087
> 
> 标签：integer, boolean, algebra, operations

这可能是非常基本的......但我似乎不明白：

如何

```
(2 & 1) = 0
(3 & 1) = 1
(4 & 1) = 0 
```

ETC..

上面的这种模式似乎有助于找到偶数

或者

```
(0 | 1) = 1
(1 | 1) = 1
(2 | 1) = 3
(3 | 1) = 4
(4 | 1) = 5
(5 | 1) = 5 
```

我知道布尔代数在位之间是如何工作的。但我不明白布尔代数如何处理整数（至少在 C# 中）。

提前致谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-26T03:47:49.827

它在 C# 中的工作方式与在二进制文件中的工作方式相同。

`2 | 1 = 3`和`4 | 1 = 5`。

要理解这一点，您需要考虑 1、2、3、4 和 5 的二进制表示：

`010 | 001 = 011`和`100 | 001 = 101`。

相似地：

`010 & 001 = 000`和`011 & 001 = 001`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T03:54:05.570

您得到第一个结果是因为您`and`在两个数字的位串之间执行布尔运算：

```
2 & 1 => 010 & 001 = 000 = 0
3 & 1 => 011 & 001 = 001 = 1
4 & 1 => 100 & 001 = 000 = 0
5 & 1 => 101 & 001 = 001 = 1 
```

实际上，您正在测试是否设置了“1”位，这仅适用于奇数。

执行`or`操作时：

```
0 | 1 => 000 | 001 = 001 = 1
1 | 1 => 001 | 001 = 001 = 1
2 | 1 => 010 | 001 = 011 = 3
3 | 1 => 011 | 001 = 011 = 3
4 | 1 => 100 | 001 = 101 = 5
5 | 1 => 101 | 001 = 101 = 5 
```

因为在这种情况下，效果`or`总是设置`1`位，偶数将加一到最接近的更大奇数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T03:53:53.933

关键是 CPU 并行执行 32 次布尔运算，输入整数的每个位位置一个（当然，假设是 32 位整数）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T03:52:39.957

它正在对整数进行按位运算。它正在对第一个整数中的每个位与另一个整数中的相应位进行逻辑或/和。然后它返回所有这些操作的结果。例如，4 = 0100 和 1 = 0001，其中的一个逻辑与将按顺序对位进行位并得到 0000（因为 0&0 = 0、1&0 = 0、0&0 = 0 和 0&1 = 0）。对于 or，您将得到 0101（因为 0|0 = 0、1|0 = 1、0|0 = 0 和 0|1 = 1）。诀窍是这些是按位运算，而不是仅对 C# 中的布尔值进行运算的逻辑运算。

# php - PHP邮资计算器

> ID：319700
> 
> 赞同：1
> 
> 时间：2008-11-26T03:48:17.113
> 
> 标签：php, shipping, cart, shopping

任何人都可以为我指出正确的运输计算器方向吗？我想要一些简单的东西，我不想注册太多东西。

编辑：我不想处理 API 需要的所有注册和东西......我想我可能只是尝试使用 USPS 提供的区域图表制作一个。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-26T03:54:43.433

USPS 有适用于国内和国际的费率计算器 API。您可以在以下站点了解有关它们的更多信息。希望有帮助。

[https://www.usps.com/webtools/htm/Rate-Calculators-v1-3.htm](https://www.usps.com/webtools/htm/Rate-Calculators-v1-3.htm)

# java - 在 Java 中扩展枚举

> ID：319702
> 
> 赞同：3
> 
> 时间：2008-11-26T03:50:23.363
> 
> 标签：java, inheritance, enums

```
public enum myEnum {    
VAL1(10), VAL2(20), VAL3("hai") {
        public Object getValue() {
            return this.strVal;
        }
        public String showMsg() {
            return "This is your msg!";
        }
    };
    String strVal;
    Integer intVal;
    public Object getValue() {
        return this.intVal;
    }
    private myEnum(int i) {
        this.intVal = new Integer(i);
    }
    private myEnum(String str) {
        this.strVal = str;
    }
} 
```

在上面的枚举中，当我为 VAL3 添加一个常量特定类主体时，究竟会发生什么？

VAL3 的类型定义为 myEnum 的子类型，因为它具有重载和附加方法。（类类型为 'myEnum$1' ）

但是编译器如何创建一个扩展 myEnum 的子类型枚举，因为所有枚举都已经在扩展 java.lang.enum ？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-26T04:08:16.417

您的 myEnum 类继承自 java.lang.Enum。VAL3 是一个匿名内部类，它继承自名为 myEnum$1 的 myEnum。将 enum 关键字视为语法糖。它为您设置具有正常继承树的类，但不允许您直接扩展 java.lang.Enum 或 myEnum。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T09:34:48.817

从反编译器

```
 package com.sun.tools.xjc.outline;

public final class Aspect extends Enum
{
    public static final Aspect EXPOSED;
    public static final Aspect IMPLEMENTATION;
    private static final Aspect $VALUES[];

    static 
    {
        EXPOSED = new Aspect("EXPOSED", 0);
        IMPLEMENTATION = new Aspect("IMPLEMENTATION", 1);
        $VALUES = (new Aspect[] {
            EXPOSED, IMPLEMENTATION
        });
    }

    public static final Aspect[] values()
    {
        return (Aspect[])$VALUES.clone();
    }

    public static Aspect valueOf(String name)
    {
        Aspect arr$[] = $VALUES;
        int len$ = arr$.length;
        for(int i$ = 0; i$ < len$; i$++)
        {
            Aspect aspect = arr$[i$];
            if(aspect.name().equals(name))
                return aspect;
        }

        throw new IllegalArgumentException(name);
    }

    private Aspect(String s, int i)
    {
        super(s, i);
    }

} 
```

# ruby-on-rails - Ruby on Rails 和 Active Record 独立脚本在 :timestamps 的数据库值上存在分歧

> ID：319711
> 
> 赞同：2
> 
> 时间：2008-11-26T03:55:03.463
> 
> 标签：ruby-on-rails, ruby, database, datetime, timezone

我今天早些时候发布了一个问题，当时我还没有完全解决这个问题。我可以在这里更简洁。

我在 Windows 上使用 MySQL 运行 RoR 2.1.2。SQL 服务器的本地时区是 UTC。我的本地时区是太平洋 (-0800)

我有一个带有 :timestamp 类型列的模型，我可以这样做：

```
record = Record.find(:first)
record.the_time = Time.now() 
```

当我在数据库中执行“从记录中选择 *”时，显示的时间比我的本地时间提前 8 小时，这是正确的，因为数据库在 UTC 上。（我已经通过简单的“select now()”和“select utc_timestamp()”验证了它是“thinking in utc”）

这就是麻烦的开始。如果我在视图中显示时间：

```
<%= h record.the_time %> 
```

...然后我得到正确的时间，以 UTC 格式显示。如果我在当地时间 16:40:00 写入数据库，则数据库显示 00:40:00。

但是，如果我正在运行独立脚本：

```
record = Record.find(:first)
puts record.the_time 
```

...然后我取回我存储在数据库中的 UTC 时间 (00:40:00,) 但使用本地时区：

```
Wed Nov 26 00:40:00 (-0800) 2008 
```

……八小时的时间扭曲。为什么存储时间可以正确转换它，但检索它却不能？如果我比较数据库中最近存储的时间并将其与当前时间进行比较，则当前时间会更少 - 告诉我这不仅仅是字符串转换问题。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-29T23:15:42.733

config/environment.rb 中有一个设置 time_zone 的设置。可能这在您的脚本中设置不一样：

```
# Make Time.zone default to the specified zone, and make Active Record store time values
# in the database in UTC, and return them converted to the specified local zone.
# Run "rake -D time" for a list of tasks for finding time zone names. Uncomment to use default local time.
config.time_zone = 'UTC' 
```

您还可以尝试明确指定 TZ 和格式：

```
require 'active_support/core_ext/date/conversions'
record.the_time.utc.to_s(:db) 
```

（或者，如果您没有在独立脚本中使用 active_support，则作弊并从那里获取代码片段）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-02T08:03:14.273

尝试要求`active_support`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T18:12:35.057

好吧，您没有评论我上次重新启动服务器或控制台的建议。

我有一个类似的问题，当我这样做时它得到了解决。

您还提到了一个独立的脚本，但是为了获得 Rails 的时区功能，代码需要在 Rails 中运行。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-23T23:34:29.600

最后，通过将时间存储为整数 (Time.now().to_i()) 并将它们转换回我需要显示它们的时间 (Time.at(the_time_the_database_returned_to_me) 来做到这一点要容易得多。)这几乎不是最好的解决方案，但它是唯一有效的解决方案。

# c# - 使用 Lucene.net 进行分页

> ID：319716
> 
> 赞同：10
> 
> 时间：2008-11-26T04:00:44.683
> 
> 标签：c#, .net, lucene.net

我正在开发一个使用 Asp.net 3.5 和 Lucene.Net 的 .Net 应用程序我在 asp.net 数据网格中显示 Lucene.Net 给出的搜索结果。我需要为此 aspx 页面实现分页（每页 10 条记录）。

如何使用 Lucene.Net 完成这项工作？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-26T04:51:59.230

这是一种使用 Lucene.Net 构建与特定页面匹配的简单列表的方法。这不是 ASP.Net 特定的。

```
int first = 0, last = 9; // TODO: Set first and last to correct values according to page number and size
Searcher searcher = new IndexSearcher(YourIndexFolder);
Query query = BuildQuery(); // TODO: Implement BuildQuery
Hits hits = searcher.Search(query);
List<Document> results = new List<Document>();
for (int i = first; i <= last && i < hits.Length(); i++)
    results.Add(hits.Doc(i));

// results now contains a page of documents matching the query 
```

基本上 Hits 集合非常轻量级。获取此列表的成本是最低的。您只需通过调用 hits.Doc(i) 来实例化所需的文档来构建您的页面。

* * *

## 回答 #2

> 赞同：-10
> 
> 时间：2008-11-26T14:01:43.397

我所做的是遍历命中并将它们插入到数据库中的临时表中。然后我可以运行一个常规的 SQL 查询 - 将该临时表也与其他表连接 - 并为网格提供它想要的 DataSet/DataView。

请注意，我在 ONE TRIP 中对数据库进行了插入和查询，因为我只使用了一个 SQL 批处理。

```
void Page_Load(Object sender, EventArgs e)
{

    dbutil = new DbUtil();
    security = new Security();
    security.check_security(dbutil, HttpContext.Current, Security.ANY_USER_OK);

    Lucene.Net.Search.Query query = null;

    try
    {
        if (string.IsNullOrEmpty(Request["query"]))
        {
            throw new Exception("You forgot to enter something to search for...");
        }

        query = MyLucene.parser.Parse(Request["query"]);

    }
    catch (Exception e3)
    {
        display_exception(e3);
    }

    Lucene.Net.Highlight.QueryScorer scorer = new Lucene.Net.Highlight.QueryScorer(query);
    Lucene.Net.Highlight.Highlighter highlighter = new Lucene.Net.Highlight.Highlighter(MyLucene.formatter, scorer);
    highlighter.SetTextFragmenter(MyLucene.fragmenter); // new Lucene.Net.Highlight.SimpleFragmenter(400));

    StringBuilder sb = new StringBuilder();
    string guid = Guid.NewGuid().ToString().Replace("-", "");
    Dictionary<string, int> dict_already_seen_ids = new Dictionary<string, int>();

    sb.Append(@"
create table #$GUID
(
temp_bg_id int,
temp_bp_id int,
temp_score float,
temp_text nvarchar(3000)
)
    ");

    lock (MyLucene.my_lock)
    {

        Lucene.Net.Search.Hits hits = null;
        try
        {
            hits = MyLucene.search(query);
        }
        catch (Exception e2)
        {
            display_exception(e2);
        }

        // insert the search results into a temp table which we will join with what's in the database
        for (int i = 0; i < hits.Length(); i++)
        {
            if (dict_already_seen_ids.Count < 100)
            {
                Lucene.Net.Documents.Document doc = hits.Doc(i);
                string bg_id = doc.Get("bg_id");
                if (!dict_already_seen_ids.ContainsKey(bg_id))
                {
                    dict_already_seen_ids[bg_id] = 1;
                    sb.Append("insert into #");
                    sb.Append(guid);
                    sb.Append(" values(");
                    sb.Append(bg_id);
                    sb.Append(",");
                    sb.Append(doc.Get("bp_id"));
                    sb.Append(",");
                    //sb.Append(Convert.ToString((hits.Score(i))));
                    sb.Append(Convert.ToString((hits.Score(i))).Replace(",", "."));  // Somebody said this fixes a bug. Localization issue?
                    sb.Append(",N'");

                    string raw_text = Server.HtmlEncode(doc.Get("raw_text"));
                    Lucene.Net.Analysis.TokenStream stream = MyLucene.anal.TokenStream("", new System.IO.StringReader(raw_text));
                    string highlighted_text = highlighter.GetBestFragments(stream, raw_text, 1, "...").Replace("'", "''");
                    if (highlighted_text == "") // someties the highlighter fails to emit text...
                    {
                        highlighted_text = raw_text.Replace("'","''");
                    }
                    if (highlighted_text.Length > 3000)
                    {
                        highlighted_text = highlighted_text.Substring(0,3000);
                    }
                    sb.Append(highlighted_text);
                    sb.Append("'");
                    sb.Append(")\n");
                }
            }
            else
            {
                break;
            }
        }
        //searcher.Close();
    } 
```

# javascript - 非 Web Javascript 框架

> ID：319727
> 
> 赞同：2
> 
> 时间：2008-11-26T04:12:36.657
> 
> 标签：javascript, frameworks, desktop

有没有主要受众不是 Web 编程的优秀 JavaScript 框架？特别是改善面向对象的框架/库？该框架应该可以在嵌入了 JavaScript 引擎（例如 Spidermonkey 或 JavaScriptCore）的桌面应用程序中使用，因此不允许有外部依赖。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-26T04:45:08.543

就“改进面向对象”而言，Javascript 已经很棒了。你只需要习惯于思考原型而不是类。

在阅读了 Douglas Crawford 的[关于原型继承的精彩页面](http://javascript.crockford.com/prototypal.html)后，我真的开始喜欢使用 javascript。（如果你必须使用类，他还有[一个关于类继承的页面。）](http://javascript.crockford.com/inheritance.html)

**编辑：** 如果通过要求一个*框架*，您还意味着*不使用 DOM 的有用库*，您可能对[Functional Javascript](http://osteele.com/sources/javascript/functional/)感兴趣。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T16:42:59.887

[Dojo](http://dojotoolkit.org/)可以在非浏览器环境（例如，Rhino、Jaxer、SpiderMonkey）中使用（并且被使用）。它也可以很容易地适应其他环境——所有与 DOM 相关的函数都与处理全局语言特性的函数分开。

[dojo.declare()](http://api.dojotoolkit.org/jsdoc/dojo/1.2/dojo.declare) ([更多文档](http://docs.dojocampus.org/dojo/declare)) 出现在 Dojo Base 中（只要您加载 dojo.js），并通过单继承和多继承、自动构造函数链接和超级调用实现成熟的 OOP。事实上，它是许多道场设施的基石。

当然还有更多的低级工具，比如[dojo.mixin()](http://api.dojotoolkit.org/jsdoc/dojo/1.2/dojo.mixin)可以将对象混合在一起，[dojo.extend()](http://api.dojotoolkit.org/jsdoc/dojo/1.2/dojo.extend)可以动态扩展原型。

更多与语言相关的功能可以在[dojox.lang](http://archive.dojotoolkit.org/nightly/dojotoolkit/dojox/lang/)中找到。它的以下部分被彻底解释和记录：[功能](http://lazutkin.com/blog/2008/jan/12/functional-fun-javascript-dojo/)，[AOP](http://lazutkin.com/blog/2008/may/18/aop-aspect-javascript-dojo/)，[递归组合](http://lazutkin.com/blog/2008/jun/30/using-recursion-combinators-javascript/)器。

Dojo 附带了从字符串相关算法到日期处理的其他电池。如果您对这些感兴趣，[您可以自己发现它们](http://docs.dojocampus.org/)，或联系[Dojo 社区](http://dojotoolkit.org/community/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T04:31:37.837

[Objective-J](http://cappuccino.org/learn/tutorials/objective-j-tutorial.php) (avascript) 就是其中之一。那是你要找的东西吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T04:32:41.937

最广为人知的是来自 Mozilla 的 XULRunner。这是构建 FireFox 和 Thunderbird 的框架。

[https://developer.mozilla.org/en/XULRunner](https://developer.mozilla.org/en/XULRunner)

虽然不只是严格意义上的 javascript，但它结合了许多与 Web 密切相关的技术，用于构建桌面应用程序。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T04:38:15.590

你看过 Adob​​e Air 吗？它允许您使用 JavaScript/AJAX 编写桌面应用程序。

[http://www.adobe.com/products/air/](http://www.adobe.com/products/air/)

# design-patterns - 什么时候使用桥接模式？它与适配器模式有何不同？

> ID：319728
> 
> 赞同：164
> 
> 时间：2008-11-26T04:12:44.347
> 
> 标签：design-patterns, adapter, bridge

有没有人在现实世界的应用程序中使用过[桥接模式？](http://www.dofactory.com/Patterns/PatternBridge.aspx)如果是这样，你是如何使用它的？是我，还是只是适配器模式加上一点依赖注入？它真的值得拥有自己的模式吗？

* * *

## 回答 #1

> 赞同：268
> 
> 时间：2012-05-21T16:31:55.067

[Federico](https://stackoverflow.com/a/319757/593415)和[John 的](https://stackoverflow.com/a/9406293/593415)答案是混合的。

什么时候：

```
 ----Shape---
                  /            \
         Rectangle              Circle
        /         \            /      \
BlueRectangle  RedRectangle BlueCircle RedCircle 
```

重构为：

```
 ----Shape---                        Color
         /            \                       /   \
Rectangle(Color)   Circle(Color)           Blue   Red 
```

* * *

## 回答 #2

> 赞同：239
> 
> 时间：2008-11-26T04:44:37.263

桥接模式是旧建议的应用，“更喜欢组合而不是继承”。当您必须以相互正交的方式对不同时间进行子类化时，它会变得很方便。假设您必须实现彩色形状的层次结构。你不会用 Rectangle 和 Circle 子类 Shape，然后用 RedRectangle、BlueRectangle 和 GreenRectangle 子类 Rectangle，Circle 也是如此，对吗？您更愿意说每个 Shape*都有*一个 Color 并实现颜色的层次结构，这就是 Bridge Pattern。好吧，我不会实现“颜色层次结构”，但你明白了......

* * *

## 回答 #3

> 赞同：224
> 
> 时间：2012-02-23T02:27:56.680

什么时候：

```
 A
     /     \
    Aa      Ab
   / \     /  \
 Aa1 Aa2  Ab1 Ab2 
```

重构为：

```
 A         N
  /     \     / \
Aa(N) Ab(N)  1   2 
```

* * *

## 回答 #4

> 赞同：80
> 
> 时间：2008-11-26T04:40:17.240

在 UI 环境中定义形状时使用了 Bridge 模式的一个经典示例（请参阅[Bridge 模式 Wikipedia 条目](http://en.wikipedia.org/wiki/Bridge_pattern)）。桥接模式是模板[和](http://en.wikipedia.org/wiki/Template_method_pattern)策略[模式的](http://en.wikipedia.org/wiki/Strategy_pattern)[组合](http://today.java.net/pub/a/today/2004/10/29/patterns.html)。

它是桥接模式中适配器模式某些方面的常见观点。但是，引用[这篇文章](http://www.informit.com/articles/article.aspx?p=30297)：

> 乍一看，桥接模式看起来很像适配器模式，因为一个类用于将一种接口转换为另一种接口。但是，适配器模式的目的是使一个或多个类的接口看起来与特定类的接口相同。桥接模式旨在将类的接口与其实现分开，因此您可以在不更改客户端代码的情况下更改或替换实现。

* * *

## 回答 #5

> 赞同：31
> 
> 时间：2010-05-25T09:20:53.333

根据我的经验，Bridge 是一种经常出现的模式，因为只要**域中有两个正交维度，**它就是解决方案。例如形状和绘图方法、行为和平台、文件格式和序列化程序等等。

还有一个建议：始终*从概念的角度*考虑设计模式，而不是从实现的角度。从正确的角度来看，Bridge 不能与 Adapter 混淆，因为它们解决了不同的问题，组合优于继承不是因为它本身，而是因为它允许单独处理正交关注点。

* * *

## 回答 #6

> 赞同：30
> 
> 时间：2008-11-26T04:44:47.433

Adapter 和 Bridge 肯定是相关的，而且区别很微妙。很可能有些人认为他们正在使用其中一种模式，实际上他们正在使用另一种模式。

我看到的解释是，当你试图统一一些*已经存在*的不兼容类的接口时，使用了 Adapter 。适配器充当一种翻译器，可以被认为是*遗留*的实现。

而桥接模式用于更可能是未开发的代码。您正在设计 Bridge 为需要变化的实现提供抽象接口，但您还定义了这些实现类的接口。

设备驱动程序是 Bridge 的一个经常被引用的示例，但如果您正在为设备供应商定义接口规范，我会说它是一个 Bridge，但如果您使用现有的设备驱动程序并制作一个包装类来提供统一的接口。

所以在代码方面，这两种模式非常相似。在商业方面，它们是不同的。

另请参阅[http://c2.com/cgi/wiki?BridgePattern](http://c2.com/cgi/wiki?BridgePattern)

* * *

## 回答 #7

> 赞同：24
> 
> 时间：2016-05-29T20:42:23.437

**Bridge**和**Adapter**的意图是不同的，我们分别需要这两种模式。

***桥梁模式：***

1.  它是一种结构模式
2.  抽象和实现在编译时不受约束
3.  抽象和实现——两者都可以变化而不会对客户端产生影响
4.  使用组合而不是继承。

在以下情况下使用桥接模式：

1.  您想要实现的运行时绑定，
2.  由于耦合接口和众多实现，您会产生大量的类，
3.  您想在多个对象之间共享一个实现，
4.  您需要映射正交类层次结构。

@John Sonmez 的回答清楚地表明了桥接模式在减少类层次结构方面的有效性。

您可以参考以下文档链接，通过代码示例更好地了解桥接模式

***适配器模式***：

1.  它*允许两个不相关的接口通过不同的对象一起工作*，可能扮演相同的角色。
2.  它修改了原来的界面。

**主要区别：**

1.  *适配器*在设计完成后就可以工作；*Bridge*让它们先于它们工作。
2.  *Bridge*是预先设计的，让*抽象和实现独立变化*。*改装适配器*以使不相关的类一起工作。
3.  意图：*适配器*允许两个不相关的接口一起工作。*Bridge*允许抽象和实现独立变化。

与 UML 图和工作代码相关的 SE 问题：

[桥接模式和适配器模式之间的区别](https://stackoverflow.com/questions/1425171/difference-between-bridge-pattern-and-adapter-pattern/35320081#35320081)

有用的文章：

[sourcemaking桥](https://sourcemaking.com/design_patterns/bridge)模式文章

[sourcemaking 适配器](https://sourcemaking.com/design_patterns/adapter)模式文章

[journaldev 桥](http://www.journaldev.com/1491/bridge-pattern-in-java-example-tutorial)模式文章

**编辑：**

桥接模式真实世界示例（根据 meta.stackoverflow.com 的建议，在这篇文章中合并了文档站点示例，因为文档即将结束）

桥接模式将抽象与实现分离，因此两者都可以独立变化。它是通过组合而不是继承来实现的。

**来自维基百科的桥接模式 UML：**

[![来自维基百科的桥接模式 UML](https://i.stack.imgur.com/5TWBr.png)](https://i.stack.imgur.com/5TWBr.png)

在这个模式中有四个组件。

`Abstraction`: 它定义了一个接口

`RefinedAbstraction`：它实现了抽象：

`Implementor`: 它定义了一个实现的接口

`ConcreteImplementor`：它实现了Implementor接口。

***`The crux of Bridge pattern :`***使用组合（并且没有继承）的两个正交类层次结构。抽象层次结构和实现层次结构可以独立变化。实现从不指抽象。抽象包含实现接口作为成员（通过组合）。这种组合减少了一层继承层次。

实字用例：

*使不同的车辆具有手动和自动两个版本的齿轮系统。*

示例代码：

```
/* Implementor interface*/
interface Gear{
    void handleGear();
}

/* Concrete Implementor - 1 */
class ManualGear implements Gear{
    public void handleGear(){
        System.out.println("Manual gear");
    }
}
/* Concrete Implementor - 2 */
class AutoGear implements Gear{
    public void handleGear(){
        System.out.println("Auto gear");
    }
}
/* Abstraction (abstract class) */
abstract class Vehicle {
    Gear gear;
    public Vehicle(Gear gear){
        this.gear = gear;
    }
    abstract void addGear();
}
/* RefinedAbstraction - 1*/
class Car extends Vehicle{
    public Car(Gear gear){
        super(gear);
        // initialize various other Car components to make the car
    }
    public void addGear(){
        System.out.print("Car handles ");
        gear.handleGear();
    }
}
/* RefinedAbstraction - 2 */
class Truck extends Vehicle{
    public Truck(Gear gear){
        super(gear);
        // initialize various other Truck components to make the car
    }
    public void addGear(){
        System.out.print("Truck handles " );
        gear.handleGear();
    }
}
/* Client program */
public class BridgeDemo {    
    public static void main(String args[]){
        Gear gear = new ManualGear();
        Vehicle vehicle = new Car(gear);
        vehicle.addGear();

        gear = new AutoGear();
        vehicle = new Car(gear);
        vehicle.addGear();

        gear = new ManualGear();
        vehicle = new Truck(gear);
        vehicle.addGear();

        gear = new AutoGear();
        vehicle = new Truck(gear);
        vehicle.addGear();
    }
} 
```

输出：

```
Car handles Manual gear
Car handles Auto gear
Truck handles Manual gear
Truck handles Auto gear 
```

解释：

1.  `Vehicle`是一个抽象。
2.  `Car`并且`Truck`是 的两个具体实现`Vehicle`。
3.  `Vehicle`定义了一个抽象方法：`addGear()`.
4.  `Gear`是实现接口
5.  `ManualGear`并且`AutoGear`是两个实现 `Gear`
6.  `Vehicle`包含`implementor`接口而不是实现接口。`Compositon`实现者接口是这种模式的关键：*它允许抽象和实现独立变化。*
7.  `Car`并`Truck`为抽象定义实现（重新定义抽象）: `addGear()`: 它包含 `Gear`- 要么`Manual`或`Auto`

**桥接模式的用例**：

1.  **抽象**和**实现**可以相互独立改变，并且它们在编译时不受约束
2.  映射正交层次结构 - 一个用于*抽象*，一个用于*实现*。

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2008-11-26T05:01:31.503

我在工作中使用了桥接模式。我用 C++ 编程，它通常被称为 PIMPL 习惯用法（指向实现的指针）。它看起来像这样：

```
class A
{
public: 
  void foo()
  {
    pImpl->foo();
  }
private:
  Aimpl *pImpl;
};

class Aimpl
{
public:
  void foo();
  void bar();
}; 
```

在这个例子`class A`中包含了接口，并且`class Aimpl`包含了实现。

这种模式的一个用途是只公开实现类的一些公共成员，而不公开其他成员。示例中只能`Aimpl::foo()`通过 的公共接口调用`A`，不能`Aimpl::bar()`

另一个优点是您可以`Aimpl`在单独的头文件中定义`A`. 您所要做的就是使用`Aimpl`before `A`is defined 的前向声明，并将所有引用的成员函数的定义移动`pImpl`到 .cpp 文件中。这使您能够保持`Aimpl`标头私有，并减少编译时间。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2013-09-14T22:52:24.487

将形状示例放入代码中：

```
#include<iostream>
#include<string>
#include<cstdlib>

using namespace std;

class IColor
{
public:
    virtual string Color() = 0;
};

class RedColor: public IColor
{
public:
    string Color()
    {
        return "of Red Color";
    }
};

class BlueColor: public IColor
{
public:
    string Color()
    {
        return "of Blue Color";
    }
};

class IShape
{
public:
virtual string Draw() = 0;
};

class Circle: public IShape
{
        IColor* impl;
    public:
        Circle(IColor *obj):impl(obj){}
        string Draw()
        {
            return "Drawn a Circle "+ impl->Color();
        }
};

class Square: public IShape
{
        IColor* impl;
    public:
        Square(IColor *obj):impl(obj){}
        string Draw()
        {
        return "Drawn a Square "+ impl->Color();;
        }
};

int main()
{
IColor* red = new RedColor();
IColor* blue = new BlueColor();

IShape* sq = new Square(red);
IShape* cr = new Circle(blue);

cout<<"\n"<<sq->Draw();
cout<<"\n"<<cr->Draw();

delete red;
delete blue;
return 1;
} 
```

输出是：

```
Drawn a Square of Red Color
Drawn a Circle of Blue Color 
```

请注意，可以轻松地将新颜色和形状添加到系统中，而不会由于排列而导致子类爆炸。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2020-06-02T02:18:09.397

您在一家保险公司工作，您在该公司开发了一个工作流应用程序来管理不同类型的任务：会计、合同、索赔。这就是抽象。在实施方面，您必须能够从不同来源创建任务：电子邮件、传真、电子消息。

你从这些类开始你的设计：

```
public class Task {...}
public class AccountingTask : Task {...}
public class ContractTask : Task {...}
public class ClaimTask : Task {...} 
```

现在，由于必须以特定方式处理每个源，因此您决定专门化每个任务类型：

```
public class EmailAccountingTask : AccountingTask {...}
public class FaxAccountingTask : AccountingTask {...}
public class EmessagingAccountingTask : AccountingTask {...}

public class EmailContractTask : ContractTask {...}
public class FaxContractTask : ContractTask {...}
public class EmessagingContractTask : ContractTask {...}

public class EmailClaimTask : ClaimTask {...}
public class FaxClaimTask : ClaimTask {...}
public class EmessagingClaimTask : ClaimTask {...} 
```

你最终有 13 节课。添加任务类型或源类型变得具有挑战性。使用桥接模式通过将任务（抽象）与源（这是一个实现问题）解耦来产生更容易维护的东西：

```
// Source
public class Source {
   public string GetSender();
   public string GetMessage();
   public string GetContractReference();
   (...)
}

public class EmailSource : Source {...}
public class FaxSource : Source {...}
public class EmessagingSource : Source {...}

// Task
public class Task {
   public Task(Source source);
   (...)
}
public class AccountingTask : Task {...}
public class ContractTask : Task {...}
public class ClaimTask : Task {...} 
```

添加任务类型或源现在更加容易。

注意：大多数开发人员不会预先创建 13 个类层次结构来处理此问题。但是，在现实生活中，您可能事先不知道源和任务类型的数量；如果您只有一个源和两种任务类型，您可能不会将任务与源分离。然后，随着新源和任务类型的添加，整体复杂性会增加。在某些时候，您将进行重构，并且大多数情况下，最终会得到一个类似桥的解决方案。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-12-29T16:32:04.463

对我来说，我认为它是一种可以交换接口的机制。在现实世界中，您可能有一个可以使用多个接口的类，Bridge 允许您交换。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2022-01-29T19:33:16.173

如果您获得相同旧形状和颜色示例的板，我将为您提供一个新的桥模式示例。

假设您有不同的支付方式，如信用卡支付和网上银行。并且有不同的支付网关，如花旗银行和汇丰银行。

然后，您只需将支付网关成员添加到支付模式即可。并在运行时将此信息传递给支付模式对象。并付款。

因此，例如它将在 CITI 银行支付网关上进行卡支付。

* * *

## 回答 #13

> 赞同：-6
> 
> 时间：2017-12-25T05:54:13.317

```
Bridge design pattern we can easily understand helping of service and dao layer.

Dao layer -> create common interface for dao layer ->
public interface Dao<T>{
void save(T t);
}
public class AccountDao<Account> implement Dao<Account>{
public void save(Account){
}
}
public LoginDao<Login> implement Dao<Login>{
public void save(Login){
}
}
Service Layer ->
1) interface
public interface BasicService<T>{
    void save(T t);
}
concrete  implementation of service -
Account service -
public class AccountService<Account> implement BasicService<Account>{
 private Dao<Account> accountDao;
 public AccountService(AccountDao dao){
   this.accountDao=dao;
   }
public void save(Account){
   accountDao.save(Account);
 }
}
login service- 
public class LoginService<Login> implement BasicService<Login>{
 private Dao<Login> loginDao;
 public AccountService(LoginDao dao){
   this.loginDao=dao;
   }
public void save(Login){
   loginDao.save(login);
 }
}

public class BridgePattenDemo{
public static void main(String[] str){
BasicService<Account> aService=new AccountService(new AccountDao<Account>());
Account ac=new Account();
aService.save(ac);
}
}
} 
```

# sql-server - 转义括号 [ 在 CONTAINS() 子句中？

> ID：319730
> 
> 赞同：11
> 
> 时间：2008-11-26T04:15:42.220
> 
> 标签：sql-server, tsql

如何在全文 SQL Server`contains()`查询中转义括号？我已经尝试了以下所有方法，*但都*不起作用：

```
CONTAINS(crev.RawText, 'arg[0]')
CONTAINS(crev.RawText, 'arg[[0]]')
CONTAINS(crev.RawText, 'arg\[0\]') 
```

使用双引号确实有效，但它会**强制整个搜索成为一个短语**，这对于多个单词查询来说是一个阻碍。

```
CONTAINS(crev.RawText, '"arg[0]"') 
```

我真正想做的就是逃避括号，但我似乎做不到..

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-26T05:04:48.207

您不必转义 [ 因为它在全文搜索中没有特殊含义。如果您确实需要搜索完全匹配，您可以使用“”标记。

此外，您可以在单引号内使用多个 ""：

```
CONTAINS('"word1" or "word2" or "word3"') 
```

这也有效：

```
CONTAINS('"word1" and "word2" and "word3"') 
```

放在双引号内的任何内容都被视为精确文本。因此，如果我要在 AdventureWorks 中搜索 Production.ProductDescription 表的 Description 字段，我可以使用

```
CONTAINS('shifting and "on or off-road"') 
```

并且它会找到与“on or off-road”这个词组相匹配的单词 shift。

唯一的特殊符号是 ~，它可以用来代替 NEAR 命令。

```
CONTAINS('shifting ~ smooth') 
```

是相同的

```
CONTAINS('shifting NEAR smooth') 
```

并且会找到单词 shift 和 smooth 彼此靠近的匹配项。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T04:21:46.437

显然不是全文索引的精神。

> 单词
> 
> 是一串没有空格或标点符号的字符。
> 
> 短语
> 
> 是一个或多个单词，每个单词之间有空格。

和

> 标点符号被忽略。因此，CONTAINS(testing, "computer failure") 匹配具有值“我的计算机在哪里？找不到它会很昂贵”的行。

我不确定你的选择是什么。

显然`LIKE`工作正常：

```
SELECT *
FROM dbo.stackoverflow_319730
WHERE txtcol LIKE 'arg[ [ ]0]' 
```

但

```
SELECT *
FROM dbo.stackoverflow_319730
WHERE CONTAINS(txtcol, '"arg[0]"') 
```

甚至匹配其中的列`'arg[1]'`，例如：

```
CREATE TABLE [dbo].[stackoverflow_319730](
    [id] [int] IDENTITY(1,1) NOT NULL,
    [txtcol] [text] NOT NULL,
 CONSTRAINT [PK_stackoverflow_319730] PRIMARY KEY CLUSTERED 
(
    [id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

INSERT INTO [dbo].[stackoverflow_319730] (txtcol) VALUES ('arg[0]')
INSERT INTO [dbo].[stackoverflow_319730] (txtcol) VALUES ('arg[1]')
INSERT INTO [dbo].[stackoverflow_319730] (txtcol) VALUES ('some other text')
INSERT INTO [dbo].[stackoverflow_319730] (txtcol) VALUES ('arg[0], arg[1]')

EXEC sp_fulltext_catalog   'FTCatalog','create'
EXEC sp_fulltext_table     'stackoverflow_319730', 'create', 'FTCatalog', 'pk_stackoverflow_319730' 
EXEC sp_fulltext_column    'stackoverflow_319730', 'txtcol', 'add' 
EXEC sp_fulltext_table     'stackoverflow_319730','activate' 
EXEC sp_fulltext_catalog   'FTCatalog', 'start_full' 

SELECT *
FROM dbo.stackoverflow_319730
WHERE txtcol LIKE 'arg[ [ ]0]'

SELECT *
FROM dbo.stackoverflow_319730
WHERE CONTAINS(txtcol, '"arg[0]"') 
```

结果暗示了标点符号的问题：

```
id          txtcol
----------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
1           arg[0]

(1 row(s) affected)

id          txtcol
----------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
1           arg[0]
2           arg[1]
4           arg[0], arg[1]
Informational: The full-text search condition contained noise word(s). 
```

# c# - 高性能 C# 服务器套接字的提示/技术

> ID：319732
> 
> 赞同：33
> 
> 时间：2008-11-26T04:17:02.093
> 
> 标签：c#, .net, performance, sockets

我有一个似乎遇到扩展问题的 .NET 2.0 服务器，这可能是由于套接字处理代码的设计不佳，我正在寻找有关如何重新设计它以提高性能的指导。

**使用场景：** 50 - 150 个客户端，高速率（高达 100 秒 / 秒）小消息（每个 10 字节）往返每个客户端。客户端连接是长期存在的——通常是几个小时。（服务器是交易系统的一部分。客户端消息被聚合成组，通过较少数量的“出站”套接字连接发送到交易所，并在每个组由交易所处理时将确认消息发送回客户端.) 操作系统是 Windows Server 2003，硬件是 2 x 4 核 X5355。

**当前客户端套接字设计：** A`TcpListener`生成一个线程以在客户端连接时读取每个客户端套接字。线程阻塞`Socket.Receive`，解析传入消息并将它们插入一组队列以供核心服务器逻辑处理。确认消息通过客户端套接字使用`Socket.BeginSend`来自与交换端对话的线程的异步调用发送回。

**观察到的问题：**随着客户端数量的增长（现在为 60-70），我们开始看到在向客户端发送数据和从客户端接收数据时出现高达 100 毫秒的间歇性延迟。（我们记录每条确认消息的时间戳，我们可以在时间戳序列中看到来自同一组的通常在几毫秒内发出的一串 ack 的偶尔长间隙。）

整体系统 CPU 使用率低（< 10%），有大量可用 RAM，核心逻辑和出站（面向交换）端执行良好，因此问题似乎与面向客户端的套接字代码隔离. 服务器和客户端之间有足够的网络带宽（千兆局域网），我们已经排除了网络或硬件层的问题。

任何有用资源的建议或指针将不胜感激。如果有人有任何诊断或调试技巧来确定到底出了什么问题，那也很棒。

*注意：我有 MSDN 杂志的文章[Winsock：Get Closer to the Wire with High-Performance Sockets in .NET](http://msdn2.microsoft.com/en-us/magazine/cc300760.aspx)，我看过 Kodart 的“XF.Server”组件——它看起来很粗略。*

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-12-23T04:33:50.033

.NET 3.5 环境中的套接字 I/O 性能得到了改进。您可以使用 ReceiveAsync/SendAsync 而不是 BeginReceive/BeginSend 以获得更好的性能。检查一下：

[http://msdn.microsoft.com/en-us/library/bb968780.aspx](http://msdn.microsoft.com/en-us/library/bb968780.aspx)

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-11-26T04:52:54.127

这在很大程度上与您系统上运行的许多线程以及内核为每个线程提供时间片有关。设计很简单，但不能很好地扩展。

您可能应该考虑使用 Socket.BeginReceive 它将在 .net 线程池上执行（您可以以某种方式指定它使用的线程数），然后从异步回调（可以在任何.NET 线程）。这应该会给你更高的性能。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-26T04:56:05.663

每个客户端一个线程似乎非常过分，特别是考虑到这里的整体 CPU 使用率较低。通常，您需要一个小线程池来为所有客户端提供服务，使用 BeginReceive 等待异步工作 - 然后只需将处理发送给其中一个工作人员（也许只需将工作添加到所有工作人员都在等待的同步队列中）。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-26T05:15:04.143

无论如何我都不是 C# 人，但对于高性能套接字服务器，最具可扩展性的解决方案是使用[I/O 完成端口](http://msdn.microsoft.com/en-us/library/aa365198(VS.85).aspx)和许多活动线程，这些线程适用于运行进程的 CPU，而不是使用每个连接一个线程的模型。

在您的情况下，使用 8 核机器，您需要 16 个线程，其中 8 个线程同时运行。（其余8个基本上都是备用的。）

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-26T05:09:36.183

和[`Socket.BeginConnect`](http://msdn.microsoft.com/en-us/library/6aeby4wt.aspx)绝对[`Socket.BeginAccept`](http://msdn.microsoft.com/en-us/library/6y709t3b.aspx)有用。我相信他们在实现中使用[`ConnectEx`](http://msdn.microsoft.com/en-us/library/ms737606(VS.85).aspx)and[`AcceptEx`](http://msdn.microsoft.com/en-us/library/ms737524.aspx)调用。这些调用将初始连接协商和数据传输包装到一个用户/内核转换中。由于初始发送/接收缓冲区已经准备好，内核可以将其发送到远程主机或用户空间。

他们还准备了一个侦听器/连接器队列，这可能会通过避免用户空间接受/接收连接并将其移交（以及所有用户/内核切换）所涉及的延迟来提供一些提升。

要`BeginConnect`与缓冲区一起使用，您似乎必须在连接之前将初始数据写入套接字。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-11-29T16:02:04.240

正如其他人所建议的那样，实现这一点的最佳方法是使面向客户端的代码全部异步。在 TcpServer() 上使用 BeginAccept()，这样您就不必手动生成线程。然后在从接受的 TcpClient 获得的底层网络流上使用 BeginRead()/BeginWrite()。

但是，这里有一件事我不明白。你说这些是长期存在的连接，以及大量的客户。假设系统已达到稳定状态，您的最大客户端（例如 70 个）已连接。您有 70 个线程在侦听客户端数据包。然后，系统应该仍然响应。除非您的应用程序存在内存/句柄泄漏并且您的资源不足，以至于您的服务器正在分页。我会在对 Accept() 的调用周围放置一个计时器，您可以在其中启动客户端线程并查看需要多少时间。另外，我会启动 taskmanager 和 PerfMon，并监控应用程序的“非分页池”、“虚拟内存”、“句柄计数”，看看应用程序是否处于资源紧缩状态。

虽然采用 Async 确实是正确的方法，但我不相信它是否真的能解决根本问题。我会按照我的建议监控应用程序，并确保不存在内存和句柄泄漏的内在问题。在这方面，上面的“BigBlackMan”是正确的——你需要更多的仪器才能继续。不知道他为什么被否决。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-01-18T18:04:21.393

随机间歇性约 250 毫秒延迟可能是由于 TCP 使用的 Nagle 算法。尝试禁用它，看看会发生什么。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-02-03T10:43:11.350

我想消除的一件事是它不像垃圾收集器运行那么简单。如果您的所有消息都在堆上，那么您每秒会生成 10000 个对象。

每 100 秒读取[一次垃圾收集](https://stackoverflow.com/questions/590623/garbage-collection-every-100-seconds)

唯一的解决方案是让您的消息远离堆。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-11-03T10:54:31.090

我在 7 或 8 年前遇到了同样的问题，暂停时间为 100 毫秒到 1 秒，问题是垃圾收集。从 4 gig 中使用了大约 400 Meg，但有很多对象。

我最终将消息存储在 C++ 中，但您可以使用 ASP.NET 缓存（它曾经使用 COM 并将它们移出堆）

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-11-26T04:53:50.787

我没有答案，但为了获得更多信息，我建议在您的代码中添加计时器并记录可疑操作（例如添加到队列或打开套接字）所花费的平均时间和最大时间。

至少这样你就会知道要看什么以及从哪里开始。

# gwt - GWT 和 IE7——让浏览器记住密码

> ID：319736
> 
> 赞同：1
> 
> 时间：2008-11-26T04:19:55.737
> 
> 标签：gwt, internet-explorer-7

我使用 GWT 并创建了一个登录表单。我尝试了各种方法让 IE7 提示记住登录信息，但没有成功。我想也许这会奏效（但它没有）：

```
 TextBox submit = new TextBox();
    submit.getElement().setAttribute("type", "submit"); 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-28T13:26:31.393

您可以简单地分配值：

```
private TextBox mName = new TextBox();
private PasswordTextBox mPassword = new PasswordTextBox();

mName.setText("username");
mPassword.setText("password"); 
```

在您的情况下，我会将值存储在 cookie 中，并在启动时将它们读出。

```
public static String getLastLoginName()
{   
    return Cookies.getCookie(LAST_LOGIN_COOKIE);
}

public static void setLastLoginName(String userName)
{
    Cookies.setCookie(LAST_LOGIN_COOKIE, userName);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-01T20:22:11.083

sarego 和 Drejc 都暗示了可能的解决方案：

我不确定，但您可能需要 PasswordTextBox 来触发 IE 的“记住此密码”功能。此外，IE 可能会混淆这些元素是裸露的，而不是在 FORM 元素中。

我使用 GWT 进行了广泛的开发，我们已经使用 cookie 实现了我们自己的“记住我”功能，这对我来说更可靠和可预测。然后您的应用程序可以控制删除记住的密码（即相应的“忘记我”功能）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T05:50:38.643

我能够做到的一件事是包装静态元素（实际 HTML 页面中的元素，而不是通过 Java 创建的元素）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T04:24:04.810

我不知道 GWT，但您可能需要以某种方式在表单标签上设置一个属性 -
autocomplete="on"，这在某些情况下对我有用。

更多信息在这里：http: [//msdn.microsoft.com/en-us/library/ms533486.aspx](http://msdn.microsoft.com/en-us/library/ms533486.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T04:45:03.223

如果密码文本框是密码类型*，*则 Bowser 应提示保存密码...确保在工具 > 互联网选项 > 内容 > 自动完成（设置）中*提示我保存密码。*

# math - 为什么这会产生拉伸分形？

> ID：319741
> 
> 赞同：4
> 
> 时间：2008-11-26T04:27:22.633
> 
> 标签：math, fractals

这是我如何设置表示 MandelBrot 集的数组的伪代码，但是当纵横比为 1:1 时，它会变得非常拉伸。

```
xStep = (maxX - minX) / width;
yStep = (maxY - minY) / height;

for(i = 0; i < width; i++)
 for(j = 0; j < height; j++)
  {
   constantReal = minReal + xStep * i;
   constantImag = minImag + yStep * j;
   image[i][j] = inSet(constantReal, constantImag);
  } 
```

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-26T05:19:25.883

> 这是我如何设置表示 MandelBrot 集的数组的伪代码，但是当纵横比为 1:1 时，它会变得非常拉伸。

```
xStep = (maxX - minX) / width;
yStep = (maxY - minY) / height; 
```

啊哈！这是因为对于要绘制的图像和要绘制*的**复*平面区域，您必须保持相同的纵横比。换句话说，它必须持有

```
 width     maxX - minX
---------- = ---------------------
 height    maxY - minY 
```

（随之而来的是 xStep == yStep。）您的代码可能不会强制执行此要求。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T04:38:46.543

它可能与您显示`image`数组的方式有关。您使用宽度变量 i 作为第一个索引，但通常第一个索引应该是变化最慢的，即高度。

尝试将最后一行更改为`image[j][i] =`...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T04:45:57.433

确保你的演员表都是正确的。xStep 和 yStep 可能是整数除法的乘积，而不是预期的浮点除法（如果您的示例中使用的是 C#，则需要一些显式强制转换才能正常工作）。

# asp.net-mvc - ASP.NET MVC 中的脚本和 CSS 注册助手？

> ID：319748
> 
> 赞同：10
> 
> 时间：2008-11-26T04:37:42.690
> 
> 标签：asp.net-mvc

我尝试使用 ASP.NET MVC 有一段时间了，然后我遇到了一个问题，我不想在母版页中包含我的所有 js 和 css。但是如何从我的特定视图将其注册到母版页的头部？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-26T23:23:06.023

默认母版页模板包括一个用于头部的内容占位符。如果没有，您可以轻松添加一个：

```
<head runat="server">
    <title></title>
    <asp:ContentPlaceHolder ID="head" runat="server" />
</head> 
```

然后，您的视图可以将任何他们想要的东西放在头上：

```
<asp:Content ID="Content1" ContentPlaceHolderID="head" runat="server">
    <script src="Scripts/myScripts.js" type="text/javascript"></script>
    <link href="Styles/myStyles.css" rel="stylesheet" type="text/css" />
</asp:Content> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-09T15:51:29.743

看起来还没有一个简单的选项“内置”到 ASP.NET MVC 框架中。如果您正在使用用户控件 (.ascx)，如果您正在创建自包含控件，并且还想管理自己的 JavaScript 需求，那么您甚至无法使用占位符来帮助您。

最后我创建了一个辅助类，其中有几个方法：

```
private static SortedList<int, string> GetRegisteredScriptIncludes()
{
    var registeredScriptIncludes = System.Web.HttpContext.Current.Items["RegisteredScriptIncludes"] as SortedList<int, string>;

    if (registeredScriptIncludes == null)
    {
        registeredScriptIncludes = new SortedList<int, string>();
        System.Web.HttpContext.Current.Items["RegisteredScriptIncludes"] = registeredScriptIncludes;
    }

    return registeredScriptIncludes;
}

public static void RegisterScriptInclude(this HtmlHelper htmlhelper, string script)
{
    var registeredScriptIncludes = GetRegisteredScriptIncludes();
    if (!registeredScriptIncludes.ContainsValue(script))
    {
        registeredScriptIncludes.Add(registeredScriptIncludes.Count, script);
    }
}

public static string RenderScripts(this HtmlHelper htmlhelper)
{
    var registeredScriptIncludes = GetRegisteredScriptIncludes();
    var scripts = new StringBuilder();
    foreach (string script in registeredScriptIncludes.Values)
    {
        scripts.AppendLine("<script src='" + script + "' type='text/javascript'></script>");
    }
    return scripts.ToString();
} 
```

无论如何，这是它的一种基本形式，试图展示它的工作方式。它可以通过多种方式进行增强，但目前它只是为您过滤掉重复的脚本插入请求。每当你想在 ascx （或 aspx ）中添加一个新脚本时，你可以这样做：

```
<%
    Html.RegisterScriptInclude(Url.Content("~/Scripts/MapLayers/MapLayer.js"));
    Html.RegisterScriptInclude(Url.Content("~/Scripts/MapLayers/Vehicles.js"));
%> 
```

然后，您需要记住在完成后输出它们。这是通过在页面中要输出脚本标签的位置进行以下调用来实现的：

```
<%=Html.RenderScripts() %> 
```

到目前为止似乎对我有用。我确实有一半预计会出现渲染问题，具体取决于调用 RenderScripts 的时间，尤其是在尚未调用所有 RegisterScriptIncludes 的情况下，但到目前为止它似乎完成了这项工作。如果您最后渲染脚本，那么您应该没有问题。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-19T23:05:27.077

@Jason：警告，您不应该使用这样的静态变量......在网络上下文中，静态变量在所有用户和所有页面请求之间共享。我很惊讶您的代码没有遇到问题。原理没问题，但代码错了，会给你带来麻烦。在这种情况下，您应该使用 System.Web.HttpContext.Current.Items。有关更多信息，请参阅[http://www.hanselman.com/blog/ATaleOfTwoTechniquesTheThreadStaticAttributeAndSystemWebHttpContextCurrentItems.aspx](http://www.hanselman.com/blog/ATaleOfTwoTechniquesTheThreadStaticAttributeAndSystemWebHttpContextCurrentItems.aspx)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-07-14T20:37:55.637

这是一个类似于 Jason 给出的解决方案，但考虑了 vdh_ant 的评论：

[http://frugalcoder.us/post/2009/06/29/Handling-Scripts-in-ASPNet-MVC.aspx](http://frugalcoder.us/post/2009/06/29/Handling-Scripts-in-ASPNet-MVC.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T04:45:03.457

从技术上讲，您应该将所有 js 放在页面底部以获得最佳性能。

我认为您可以做到这一点的唯一方法是将 javascript 包含在 VIewData 中并将 ViewData 显示在母版页上（不是一个很好的解决方案）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-11-19T23:22:44.543

MVC Futures 现在为此内置了帮助程序...

```
1.<head>
2\.    <title><asp:ContentPlaceHolder ID="TitleContent" runat="server" /></title>
3\.    <%= Html.Css("BlueTheme/site.css") %>
4\.    <%= Html.Script("jquery-1.3.2.js") %>
5.</head> 
```

更多信息在这里：[http ://blog.osbornm.com/archive/2009/10/12/mvc-script-css-helpers.aspx](http://blog.osbornm.com/archive/2009/10/12/mvc-script-css-helpers.aspx)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-12-11T13:25:29.687

马修，

我看了你关于 Html.Css 和 Html.Script 助手的博客。我并不是要批评，但我在博客中没有看到任何关于 Css 和脚本助手如何解决这里讨论的问题的内容。这里的问题是在渲染过程中的任何时候都需要“注册”脚本引用，并且可能多次（在模板或部分视图被多次使用并注册自己的脚本的情况下），然后输出聚合结果，没有重复，在一个位置。

如果您的解决方案解决了这个问题，请通过一些澄清纠正我。

——问候，肯

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-04-04T14:08:22.920

我为 MVC 写了一个这样的管理器，并在我的博客上写到：

[“JavascriptHelper——管理 ASP.NET MVC 的 JS 文件”](http://honestillusion.com/blogs/blog_0/archive/2012/03/29/javascripthelper-managing-js-files-for-asp-net-mvc.aspx)

更新：我添加了捆绑： [“JavascriptHelper：管理 ASP.NET MVC 的 JS 文件（使用捆绑）”](http://www.codeproject.com/Articles/395143/JavascriptHelper-Managing-JS-files-for-ASP-NET-MVC)

# c# - 使用 Windows 凭据进行 FTP 登录

> ID：319752
> 
> 赞同：1
> 
> 时间：2008-11-26T04:41:44.507
> 
> 标签：c#, windows, ftp, credentials

我们有一个 C# windows 应用程序，它需要能够连接到网络上的服务器，下载文件并将其保存到指定位置。我们不能使用 Web 服务，因为我们不能假设我们的客户将在他们的服务器上安装 IIS。

我正在考虑这样做的方式是 FTP 到服务器并下载文件。我可以编写代码以连接到服务器并找到文件，但我有 2 个问题。

1.  有没有办法使用 Windows 凭据通过 FTP 连接到远程服务器？（我知道我无法直接获取用户的密码）。

2.  除了 ftp-ing 之外，还有更好的方法从服务器获取文件吗？

感谢您的建议。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T04:59:05.410

我假设网络共享不是一个选项（可能是外部站点等）。

请注意，IIS 并不是托管 Web 服务的唯一方式。使用 WCF，您可以使用控制台 exe 或 Windows 服务来托管 WCF 服务，这将允许您在服务器上运行 WCF 而无需提及 IIS。见[这里](http://msdn.microsoft.com/en-us/library/ms733069.aspx)。然后，您所需要的只是服务器的视线，以及一些返回文件（或文件块或文件流）的代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T05:20:53.320

根据文件的大小（例如，如果它小于 4MB） - 您可能会考虑利用公共 MSMQ 机制。

# wpf - WPF listview 数据绑定 - 如何强制更新基础对象而不使用选项卡？

> ID：319753
> 
> 赞同：5
> 
> 时间：2008-11-26T04:41:53.963
> 
> 标签：wpf

我有一个绑定到 BindingList<T> 的 WPF ListView。绑定就像一个魅力，但我必须跳出单元格以更新绑定属性....这是一个问题，因为大多数用户在单击保存按钮之前不会跳出最后一列。

如何强制列表视图“保留”对绑定 DataContext 的更改而不做一些骇人听闻的事情。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-26T04:53:16.497

WPF 中的绑定有一个名为“ [UpdateSourceTrigger](http://msdn.microsoft.com/en-us/library/system.windows.data.binding.updatesourcetrigger.aspx) ”的属性，它告诉绑定何时更新 UI 绑定的对象。默认情况下，您最有可能使用的 Text 属性设置为“LostFocus”。

在绑定中将触发器更改为“PropertyChanged”，如下所示：

```
Text="{Binding Foo,UpdateSourceTrigger=PropertyChanged}" 
```

...现在源“Foo”属性将随着 UI 中的文本更改而更新。

UpdateSourceTrigger 还有一个“显式”设置，如果您需要推迟对源进行*任何更改，直到用户单击“确定”按钮之前，这很方便。*

# asp.net - 回发后如何运行客户端脚本？

> ID：319754
> 
> 赞同：0
> 
> 时间：2008-11-26T04:42:28.407
> 
> 标签：asp.net, ajax

我正在寻找类似 OnClientClick 的按钮，但我希​​望它在回发之后（而不是之前）发生。我目前正在使用以下内容，它有效，但它一遍又一遍地添加脚本块，这不是我想要的。我只是想执行现有的客户端脚本功能。

```
ScriptManager.RegisterClientScriptBlock( 
  this, 
  typeof( MyList ), 
  "blah", 
  "DraggifyLists();", 
  true ); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T12:25:38.457

如果您使用的是 ASP.NET AJAX，您可以尝试以下方法：

`addRequestHandler()`页面加载时必须调用

```
function addRequestHandler()
{
    Sys.WebForms.PageRequestManager.getInstance().add_endRequest(endRequestHandler);
}

function endRequestHandler(sender, args)
{
    // This function will be called after the postback has completed

    // add your JavaScript function call here
} 
```

这是基于来自[Disturbed Budda的代码](http://disturbedbuddha.wordpress.com/2007/12/10/disabling-a-trigger-control-during-asynchronous-postback/)

# php - PHP - 使用 set_error_handler() 在对象中调用函数

> ID：319762
> 
> 赞同：8
> 
> 时间：2008-11-26T04:45:31.973
> 
> 标签：php

我正在尝试在我的页面类中使用它。我才刚刚开始在 PHP 中使用对象，所以我仍然有点无知（但尽可能多地学习）。这是在我的`page()`函数中（当有新的页面实例时调用）

```
set_error_handler('$this->appendError'); 
```

这导致错误

> 警告：set_error_handler() 期望参数 (appendError) 是一个有效的回调

现在如何在将函数作为字符串传递的同时设置类内部函数。这不可能吗？我应该使用一个普通函数，然后调用类函数并发送所有参数吗？这对我来说听起来有点麻烦。

还是我错过了问题？我试过让我的 appendError 返回一个字符串，然后 echo.. 但它仍然不能很好地播放。

任何帮助将不胜感激。

谢谢！！

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-11-26T04:54:40.097

几乎没有问题。

第一的：

```
'$this->appendError'
```

是一个nogo。它不会将 $this 解释为当前类，php 将其解释为字符串 '$this'。

二：试试

```
set_error_handler(array($this, 'appendError'));
```

如果这不起作用，请将 $this 替换为类名并静态使用它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T04:57:42.527

阅读[php.net 回调文档](http://ca3.php.net/manual/en/language.pseudo-types.php#language.types.callback)。我认为示例 3 最接近您想要的：

```
// Type 3: Object method call
$obj = new MyClass();
call_user_func(array($obj, 'myCallbackMethod')); 
```

# recursion - 递归Make - 朋友还是敌人？

> ID：319764
> 
> 赞同：23
> 
> 时间：2008-11-26T04:47:05.043
> 
> 标签：recursion, makefile

我在我的项目中使用（GNU）Make。我目前正在为每个目录放置一个 makefile，并使用 SUBDIRS 指定子目录。有人向我建议，这不是使用 make 的理想方式，而是使用一个顶级 make 文件（或多个，使用 include 拆分）。我过去曾尝试过迁移/使用此布局，但在我看来，它没有必要复杂。

使用递归 makefile 有哪些优点/缺点？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-11-26T12:26:03.930

您应该记住的第一件事（只是为了消除任何误解）是我们不是在谈论单个与多个 makefile。在任何情况下，将您的 makefile 拆分为每个子目录可能是一个好主意。

递归生成文件不好主要是因为您将依赖关系树划分为几棵树。这会阻止正确表达 make 实例之间的依赖关系。这也导致（部分）依赖树被重新计算多次，这最终是一个性能问题（尽管通常不是一个大问题。）

为了正确使用单一制作方法，您需要使用一些技巧，尤其是当您拥有大型代码库时：

首先，使用 GNU make（你已经这样做了，我明白了）。GNU make 有许多简化事情的特性，您不必担心兼容性问题。

其次，使用特定于目标的变量值。例如，这将允许您为不同的目标拥有不同的 CFLAGS 值，而不是强制您在整个 make 中使用单个 CFLAGS：

```
 main: CFLAGS=-O2
 lib: CFLAGS=-O2 -g 
```

第三，确保在 GNU make 支持的范围内使用 VPATH/vpath。

您还需要确保没有多个同名的源文件。VPATH 的一个限制是它不允许您拥有特定于目标的 VPATH 定义，因此源文件的名称必须共存于单个“VPATH 命名空间”中。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-11-26T06:06:43.977

一篇题为“Recursive Make Considered Harmful”的文章可以在这里找到： http://miller.emu.id.au/pmiller/books/rmch/?ref= [DDiyet.Com](http://miller.emu.id.au/pmiller/books/rmch/?ref=DDiyet.Com)。（或者在SourceForge的[Aegis项目中。）](http://aegis.sourceforge.net/auug97.pdf)

它探讨了递归 makefile 的问题，并推荐了一种单一的 makefile 方法。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2011-05-05T06:12:48.263

我广泛使用递归。每个叶节点都有自己的makefile，考虑：

```
$LIBS = libfoo libbar
$(LIBS):
    cd $@ && $(MAKE) 
```

在大型系统上，没有这种结构将是一个相当大的挑战。人们所说的“递归使认为有害”是一种准确的评估。我认为每种情况都有些不同，我们会做出一些妥协。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-26T12:46:43.373

[跑到cmake.org](http://cmake.org/)，不要走路，并获得 Cmake，这是可用的最佳构建工具之一。

您仍将使用 GNU make，但在这种情况下，CMake 将为您生成 makefile。

我不能保证 100%，但我还没有遇到过它没有正确处理子目录之间的依赖关系的情况（即困扰递归 make 的问题）。至少，维护 Cmakefile 比维护 makefile 容易得多。强烈推荐。

不要使用 GNU 自动工具——那是疯狂的所在！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T05:46:10.760

我过去从中获得的好处是在单个子目录中构建文件更容易。您可以使用依赖项来执行此操作，但要保持所有目标正确，需要做更多的工作。基本上，这使得更改和测试一个库变得更容易，而无需处理更大项目的全部复杂性。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-26T06:13:24.353

要加入第三个选项，您可以使用 GNU Autotools。主要用于其他原因，但也可能有助于组织多目录构建。

[http://www.lrde.epita.fr/~adl/autotools.html](http://www.lrde.epita.fr/~adl/autotools.html)

但是，必须注意，结果是递归版本。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-04-14T17:09:13.533

Makepp 是你的朋友。

[http://makepp.sourceforge.net/](http://makepp.sourceforge.net/)

*   向后兼容 make
*   自动扫描标头依赖项
*   优雅地处理目录树

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-11-26T05:53:55.330

递归 make 的问题是评估所有不同的 make 文件与评估一个大型 make 文件的时间开销。其中一部分只是产生过程，而且（IIRC）你往往被迫假设其他make文件做了一些事情并在你真的不需要时重建。

我的看法是每个“单元”有一个制作文件，这或多或少相当于为您期望可以单独使用的每个代码块拥有一个制作文件（例如，作为一个独立的库）

OTOH，我当前的项目在构建过程中生成 make 文件时，整个地方都打破了这一点。:b

# java - 访问内部匿名类成员

> ID：319765
> 
> 赞同：6
> 
> 时间：2008-11-26T04:47:23.310
> 
> 标签：java, anonymous-class

除了使用反射来访问匿名内部类的成员之外，还有其他方法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-26T07:08:23.353

您可以使用本地类而不是匿名类。看：

```
public class Test {
    public static void main(String... args) {
        class MyInner {
            private int value = 10;
        }

        MyInner inner = new MyInner();
        System.out.println(inner.value);
    }
} 
```

`MyInner`不过，您只能在方法体中引用类型。因此，在方法之外，您将无法使用未在其超类（`java.lang.Object`在本例中）或接口中声明的字段/方法。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-26T11:44:28.850

匿名内部类有类型但没有名称。

您可以访问未由命名超类型定义的字段。但是，一旦分配给命名类型变量，接口就会丢失。

显然，您可以从内部类本身访问字段。添加代码的一种方法是通过实例初始化程序：

```
final AtomicInteger y = new AtomicInteger();
new Runnable() {
    int x;
    {
        x = 5;
        doRun(this);
        y.set(x);
    }
    public void run() {
        ... blah ...
    }
}; 
```

匿名内部类表达式返回的值具有匿名类型，因此您有一次机会在类本身之外使用它：

```
final int y = new Runnable() {
    int x;
    {
        x = 5;
        doRun(this);
    }
    public void run() {
        ... blah ...
    }
}.x; 
```

您还可以通过声明类似于以下内容的方法传递它：

```
<T extends Runnable> T doRun(T runnable); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T09:04:14.073

```
 public class AccessAnonymous {
    private Runnable runnable; // to have instance of the class

    public static void main(String[] args) throws Exception {
        AccessAnonymous a = new AccessAnonymous();
        a.a(); // init field

        Class clazz = a.runnable.getClass();
        Field field = clazz.getDeclaredField("i");
        field.setAccessible(true);

        int int1 = field.getInt(a.runnable);
        System.out.println("int1=" + int1);
    }

    public void a() {
        runnable = new Runnable() {
            private int i = 1;

            public void run() {
                i = 90;
            }

        };
        runnable.run();// change value
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-27T03:51:57.633

在匿名类的情况下，在类造成的混乱和匿名的便利性之间也存在权衡。复杂的类很少属于匿名类，而是命名为私有内部类。

在大多数匿名课程中，我们只需要“喂养”知识，并且可以在构建时完成。在一些匿名类（例如，返回值车辆）中，我们也关心一个返回值。

正如我们所知，不应直接访问数据成员，而应使用 getter setter。这一点，如果您发现自己添加了许多 getter 和 setter，那么您可能无论如何都做错了，不应该使用匿名类。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T06:08:52.913

如果它实现了接口或扩展了现有类，则可以访问接口或基类中定义的成员。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-26T06:12:47.913

Fooz 先生是对的，只是接口只能定义常量成员。最好的方法是将 getter/setter 方法添加到您的界面，然后使用它们来获得您的价值。但是对于每个匿名类，您都必须定义这些方法（有点痛苦）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-27T01:00:41.193

如果您想要可读、可维护的代码，请不要使用匿名类。如果您使用匿名类并且想要可读、可维护的代码，那么当您需要访问该内部类中的元素时不要使用匿名类。有这样做的方法，但我求你不要使用任何这些黑客。可读性胜过所有其他优点。

# php - 如何检测该事务已经开始？

> ID：319788
> 
> 赞同：30
> 
> 时间：2008-11-26T04:59:19.760
> 
> 标签：php, mysql, zend-framework, transactions, pdo

我正在使用 Zend_Db 在事务中插入一些数据。我的函数启动一个事务，然后调用另一个方法，该方法也尝试启动一个事务，当然失败了（我使用的是 MySQL5）。所以，问题是 - 我如何检测交易已经开始？这是一个示例代码：

```
 try {
                    Zend_Registry::get('database')->beginTransaction();

                    $totals = self::calculateTotals($Cart);
                    $PaymentInstrument = new PaymentInstrument;
                    $PaymentInstrument->create();
                    $PaymentInstrument->validate();
                    $PaymentInstrument->save();

                    Zend_Registry::get('database')->commit();
                    return true;

            } catch(Zend_Exception $e) {
                    Bootstrap::$Log->err($e->getMessage());
                    Zend_Registry::get('database')->rollBack();
                    return false;
            } 
```

在 PaymentInstrument::create 内部还有另一个 beginTransaction 语句，它产生表示事务已经开始的异常。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-11-26T06:53:03.043

框架无法知道您是否启动了事务。您甚至可以使用`$db->query('START TRANSACTION')`框架不知道的内容，因为它不会解析您执行的 SQL 语句。

关键是跟踪您是否已启动事务是应用程序的责任。这不是框架可以做的事情。

我知道有些框架会尝试这样做，并且会做一些 cockamamie 的事情，比如计算你开始事务的次数，只有在你完成提交或回滚匹配的次数时才会解决它。但这完全是假的，因为您的任何函数都不知道提交或回滚是否真的会这样做，或者它们是否位于另一层嵌套中。

（你能说我已经讨论过几次了吗？:-)

*更新 1：* [Propel](http://propel.phpdb.org/)是一个 PHP 数据库访问库，它支持“内部事务”的概念，当你告诉它时它不会提交。开始一个事务只会增加一个计数器，而提交/回滚会减少一个计数器。下面是一个邮件列表线程的摘录，我在其中描述了一些失败的场景。

*更新 2：* [Doctrine DBAL](https://www.doctrine-project.org/projects/doctrine-dbal/en/2.10/reference/transactions.html#transaction-nesting)也有这个特性。他们称之为事务嵌套。

* * *

不管你喜不喜欢，事务是“全局的”，它们不遵循面向对象的封装。

**问题场景#1**

我打电话`commit()`，我的更改是否已提交？如果我在“内部事务”中运行，则它们不是。管理外部事务的代码可以选择回滚，而我的更改将在我不知情或无法控制的情况下被丢弃。

例如：

1.  模型 A：开始交易
2.  模型 A：执行一些更改
3.  模型 B：开始事务（静默无操作）
4.  模型 B：执行一些更改
5.  模型 B：提交（静默无操作）
6.  模型 A：回滚（丢弃模型 A 更改和模型 B 更改）
7.  B型：WTF！？我的变化发生了什么？

**问题场景#2**

内部事务回滚，它可以丢弃外部事务所做的合法更改。当控制权返回给外部代码时，它认为其事务仍然处于活动状态并且可以提交。使用您的补丁，他们可以调用`commit()`，并且由于 transDepth 现在为 0，它会静默设置`$transDepth`为 -1 并在不提交任何内容后返回 true。

**问题场景#3**

如果我打电话`commit()`或`rollback()`没有交易活动，它将设置`$transDepth`为-1。接下来`beginTransaction()`将级别增加到 0，这意味着事务既不能回滚也不能提交。随后的调用`commit()`只会将事务减少到 -1 或更多，并且您将永远无法提交，直到您再次执行多余`beginTransaction()`的操作以再次增加级别。

基本上，试图在应用程序逻辑中管理事务而不允许数据库进行簿记是一个注定要失败的想法。如果您需要两个模型在一个应用程序请求中使用显式事务控制，那么您必须打开两个 DB 连接，每个模型一个。然后每个模型都可以有自己的活动事务，可以相互独立地提交或回滚。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-26T06:24:57.717

做一个尝试/捕获：如果异常是事务已经开始（基于错误代码或字符串的消息，无论如何），继续。否则，再次抛出异常。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-26T05:25:52.127

将 beginTransaction() 的返回值存储在 Zend_Registry 中，稍后检查。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-26T05:33:31.970

查看 Zend_Db 以及适配器（mysqli 和 PDO 版本），我真的没有看到任何检查事务状态的好方法。似乎有一个[ZF 问题](http://framework.zend.com/issues/browse/ZF-870)与此有关 - 幸运的是，即将发布一个补丁。

目前，如果您不想运行非官方的 ZF 代码，[mysqli 文档](http://www.php.net/manual/en/mysqli.autocommit.php)说您可以确定`SELECT @@autocommit`您当前是否处于事务中（错误...不是处于自动提交模式）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-03-14T13:09:20.210

您还可以按照以下方式编写代码：

```
try {
    Zend_Registry::get('database')->beginTransaction();
} 
catch (Exception $e) { }

try {
    $totals = self::calculateTotals($Cart);

    $PaymentInstrument = new PaymentInstrument;
    $PaymentInstrument->create();
    $PaymentInstrument->validate();
    $PaymentInstrument->save();

    Zend_Registry::get('database')->commit();
    return true;
} 
catch (Zend_Exception $e) {
    Bootstrap::$Log->err($e->getMessage());
    Zend_Registry::get('database')->rollBack();
    return false;
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-07-05T13:47:54.683

对于 innoDB，您应该能够使用

```
SELECT * FROM INFORMATION_SCHEMA.INNODB_TRX WHERE TRX_MYSQL_THREAD_ID = CONNECTION_ID(); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-06-08T10:07:20.320

这个讨论相当老了。正如一些人指出的那样，您可以在您的应用程序中执行此操作。PHP 从版本 5 >= 5.3.3 开始有一个方法可以知道您是否处于事务中。PDP::inTransaction() 返回真或假。链接[http://php.net/manual/en/pdo.intransaction.php](http://php.net/manual/en/pdo.intransaction.php)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-05-15T07:28:54.090

使用 zend profiler 将 begin 作为查询文本，将 Zend_Db_Prfiler::TRANSACTION 作为查询类型，之后不提交或回滚作为查询文本。（假设您的应用程序中没有启用 ->query("START TRANSACTION") 和 zend profiler）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-07-15T01:50:05.717

在面向 Web 的 PHP 中，几乎总是在单个 Web 请求期间调用脚本。在这种情况下，您真正​​想做的是开始一个事务并在脚本结束之前提交它。如果出现任何问题，请抛出异常并回滚整个事情。像这样：

```
wrapper.php:

try {
   // start transaction
   include("your_script.php");
   // commit transaction
} catch (RollbackException $e) {
   // roll back transaction
} 
```

分片会使情况变得更加复杂，您可能会打开多个连接。您必须将它们添加到应在脚本末尾提交或回滚事务的连接列表中。但是，请意识到在分片的情况下，除非您对事务有全局互斥锁，否则您将无法轻松实现并发事务的真正隔离或原子性，因为在您提交时，另一个脚本可能会将其事务提交到分片你的。但是，您可能想查看 MySQL 的[分布式事务](http://dev.mysql.com/doc/refman/5.5/en/xa.html)。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-03-14T14:20:00.387

也许您可以尝试 PDO::inTransaction...如果事务当前处于活动状态，则返回 TRUE，否则返回 FALSE。我没有测试过自己，但它似乎还不错！

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-04-01T04:33:51.703

我不同意 Bill Karwin 的评估，即跟踪开始的交易是 cockamamie，尽管我确实喜欢这个词。

我有一种情况，我有可能被不是我编写的模块调用的事件处理函数。我的事件处理程序在数据库中创建了很多记录。如果某些东西没有正确传递或丢失或发生了什么，我肯定需要回滚，好吧，cockamamie。我不知道触发事件处理程序的外部模块代码是否正在处理数据库事务，因为代码是由其他人编写的。我还没有找到查询数据库以查看事务是否正在进行的方法。

所以我一直数。我正在使用 CodeIgniter，如果我要求它开始使用嵌套的数据库事务（例如多次调用它的 trans_start() 方法），它似乎会做一些奇怪的事情。换句话说，我不能只在我的事件处理程序中包含 trans_start()，因为如果外部函数也使用 trans_start()，则回滚和提交不会正确发生。总是有可能我还没有想出正确管理这些功能，但我已经运行了很多测试。

我所有的事件处理程序需要知道的是，一个数据库事务是否已经被另一个调用的模块启动了？如果是这样，它不会启动另一个新事务，也不接受任何回滚或提交。它确实相信，如果某个外部函数启动了一个数据库事务，那么它也会处理回滚/提交。

我有 CodeIgniter 的事务方法的包装函数，这些函数递增/递减计数器。

```
function transBegin(){
    //increment our number of levels
    $this->_transBegin += 1;
    //if we are only one level deep, we can create transaction
    if($this->_transBegin ==1) {
        $this->db->trans_begin();
    }
}

function transCommit(){
    if($this->_transBegin == 1) {
        //if we are only one level deep, we can commit transaction
        $this->db->trans_commit();
    }
    //decrement our number of levels
    $this->_transBegin -= 1;

}

function transRollback(){
    if($this->_transBegin == 1) {
        //if we are only one level deep, we can roll back transaction
        $this->db->trans_rollback();
    }
    //decrement our number of levels
    $this->_transBegin -= 1;
} 
```

在我的情况下，这是检查现有数据库事务的唯一方法。它有效。我不会说“应用程序正在管理数据库事务”。在这种情况下，这真的是不真实的。它只是检查应用程序的其他部分是否启动了任何数据库事务，这样就可以避免创建嵌套的数据库事务。

# delegates - Func<> 委托有什么了不起的？

> ID：319789
> 
> 赞同：25
> 
> 时间：2008-11-26T04:59:22.477
> 
> 标签：delegates, lambda, expression, func

对不起，如果这是基本的，但我试图在 .Net 3.5 上学习。

问题： Func<> 有 5 个重载吗？从外观上看，我仍然可以自己创建一个类似的委托，MyFunc<> 具有确切的 5 个重载甚至更多。

例如：`public delegate TResult MyFunc<TResult>()`以及各种重载的组合......

当我试图理解 Func<> 代表并遇到以下情况时，这个想法出现了：

```
Func<int,int> myDelegate = (y) => IsComposite(10); 
```

这意味着委托具有一个 int 类型的参数和一个 int 类型的返回类型。有五种变体（如果您通过智能感知查看重载）。所以我猜我们可以有一个没有返回类型的委托？

那么我是否有理由说 Func<> 没什么了不起，只是 .Net 框架中的一个示例，我们可以使用它，如果需要，创建自定义“func<>”代表以满足我们自己的需要？

谢谢，

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2008-11-26T06:44:39.220

伟大之处在于建立**共享语言以更好地沟通**。

不要为同一事物定义自己的委托类型（委托爆炸），而是使用框架提供的委托类型。任何阅读您的代码的人都会立即掌握您要完成的工作。. 最大限度地减少“这段代码实际上在做什么？”的时间。所以当我看到一个

*   **Action** = 一些只做某事但不返回输出的方法
*   **比较**= 比较两个相同类型的对象并返回一个 int 表示顺序的方法
*   **Converter** = 将 Obj A 转换为等效的 Obj B
*   **EventHandler** = 对某个对象引发的事件的响应/处理程序，以事件参数的形式给出一些输入
*   **Func** = 一些方法，它接受一些参数，计算一些东西并返回一个结果
*   **谓词**= 根据某些标准评估输入对象并将通过/失败状态返回为 bool

除非这是我直接关注的领域，否则我不必深入挖掘。因此，如果您觉得您需要的代表符合其中一项需求，请在推出自己的委托之前使用它们。

*免责声明：我个人喜欢语言设计者的这一举动。*

**反论点**：有时定义您的委托可能有助于更好地传达意图。例如`System.Threading.ThreadStart`结束`System.Action`。所以这最终是一个判断电话。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-26T05:09:03.797

`Func`委托家族（及其无返回类型的表亲）`Action`并不比您在 .NET 框架中找到的任何其他东西都要大。它们只是为了重复使用，因此您不必重新定义它们。它们具有类型参数以保持通用性。例如， Func<T0,bool> 与 System.Predicate<T> 委托相同。它们最初是为 LINQ 设计的。

您应该能够将内置`Func`委托用于任何接受最多 4 个参数的值返回方法，而不是为此目的定义您自己的委托，除非您希望名称反映您的意图，这很酷。

您绝对需要定义委托类型的情况包括接受超过 4 个参数的方法、带有*out*、*ref*或*params*参数的方法，或递归方法签名（例如，`delegate Foo Foo(Foo f)`）。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-11-26T06:34:47.260

除了马克思达的正确答案：

*   值得一提的是 Func 的相关家族，即`Action`代表。同样，这些类型被类型参数的数量重载，但声明为返回 void。
*   如果您想在 .NET 2.0 项目中使用 Func/Action，但以后有一个简单的升级途径，您可以从我的[版本比较页面](http://csharpindepth.com/Articles/Chapter1/Versions.aspx)剪切和粘贴声明。如果您在命名空间中声明它们，那么您稍后只需删除声明即可升级 - 但是如果*不*`System`删除声明，您将无法（轻松）在 .NET 3.5 中构建相同的代码。

 ** * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-06-24T23:39:24.343

**解耦依赖和邪恶的捆绑**是让它变得伟大的一件独特的事情。其他所有可以辩论并声称以某种本土方式可行的事情。

我一直在用一个旧的和沉重的库重构稍微复杂的系统，并且因为无法打破编译时间依赖性而被阻止 - 因为潜伏在“另一边”的命名委托。所有程序集加载和反射都没有帮助 - 编译器会拒绝将委托（） {...} 转换为对象，而您为安抚它所做的任何事情都会在另一边失败。

**编译时结构性的委托类型比较在此之后变成名义上的**（加载、调用）。当您考虑“我亲爱的库将被所有人永远使用”时，这似乎还可以，但它不能扩展到稍微复杂一点的系统。Fun<> 模板将一定程度的结构等价带回了名义类型的世界。这是您通过推出自己的方式无法实现的方面。

示例 - 转换：

```
class Session ( 
    public delegate string CleanBody();    // tying you up and you don't see it :-)
    public static void Execute(string name, string q, CleanBody body) ... 
```

至：

```
 public static void Execute(string name, string q, Func<string> body) 
```

允许完全独立的代码进行反射调用，例如：

```
Type type = Type.GetType("Bla.Session, FooSessionDll", true); 
MethodInfo methodInfo = type.GetMethod("Execute"); 

Func<string> d = delegate() { .....}  // see Ma - no tie-ups :-)
Object [] params = { "foo", "bar", d};
methodInfo.Invoke("Trial Execution :-)", params); 
```

现有代码没有注意到差异，新代码没有得到依赖 - 地球上的和平:-)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-01-02T01:01:02.603

我喜欢委托的一件事是他们让我在这样的方法中声明方法，当您想重用一段代码但只需要在该方法中时，这很方便。由于这里的目的是尽可能地限制范围，所以 Func<> 派上用场了。

例如：

```
string FormatName(string pFirstName, string pLastName) {
    Func<string, string> MakeFirstUpper = (pText) => {
        return pText.Substring(0,1).ToUpper() + pText.Substring(1);
    };

    return MakeFirstUpper(pFirstName) + " " + MakeFirstUpper(pLastName);
} 
```

当您可以使用推理时，它会更容易和更方便，如果您创建一个这样的辅助函数，您就可以做到：

```
Func<T, TReturn> Lambda<T, TReturn>(Func<T, TReturn> pFunc) {
    return pFunc;
} 
```

现在我可以在没有 Func<> 的情况下重写我的函数：

```
string FormatName(string pFirstName, string pLastName) {
    var MakeFirstUpper = Lambda((string pText) => {
        return pText.Substring(0,1).ToUpper() + pText.Substring(1);
    });

    return MakeFirstUpper(pFirstName) + " " + MakeFirstUpper(pLastName);
} 
```

这是测试该方法的代码：

```
Console.WriteLine(FormatName("luis", "perez")); 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2010-12-05T00:03:59.283

虽然这是一个旧线程，但我不得不添加 func<> 和 action<> 也帮助我们使用协方差和反方差。

[http://msdn.microsoft.com/en-us/library/dd465122.aspx](http://msdn.microsoft.com/en-us/library/dd465122.aspx)

# c++ - SQLite C/C++ API 无符号字符 *

> ID：319790
> 
> 赞同：4
> 
> 时间：2008-11-26T04:59:25.953
> 
> 标签：c++, c, api, sqlite, char

为什么 SQLite C/C++ API`unsigned char *`为文本值返回 s 而不是更实际的`char *`类型？

[这与unsigned char](https://stackoverflow.com/questions/75191/unsigned-char)问题有些相关，除了 SQLite API 的决定似乎与为`char *`类似字符串的值给出的传统建议相反。

例如：

```
const unsigned char *sqlite3_column_text(sqlite3_stmt*, int iCol); 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-26T06:45:03.260

从[SQLite 文档](http://www.sqlite.org/capi3ref.html#sqlite3_column_blob)：

> (H13821) sqlite3_column_text(S,N) 接口将准备好的语句 S 的结果集的当前行中的第 N 列转换为以零结尾的 UTF-8 字符串并返回指向该字符串的指针。

UTF-8 需要从 0x00 到 0xFF 的字节值。char 的范围可以从 -0x80 到 0x7F（有符号）或 0x00 到 0xFF（无符号）。强制无符号允许正确编码 UTF-8 字符串。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-26T05:51:50.980

在一个疯狂的猜测中，我会说它与支持 UTF-8 编码有关。有符号字符值仅在 7 位 ASCII 环境中才有意义，其中 0x7f 以上的所有内容都可以解释。在 UTF-8 中，0x00 和 0xFF 之间的所有内容都可以平等使用。

# sql - 如何将 SQL 代码“有”条件转换为 LinqToSQL 或 LinqToEntites？

> ID：319800
> 
> 赞同：0
> 
> 时间：2008-11-26T05:06:50.510
> 
> 标签：sql, linq-to-sql, linq-to-entities, having

你能告诉我如何将下面的 SQL 代码翻译成 Linq To SQL 或 Linq To Entites 吗？

正确的 SQL 代码是：

> select CollectId,url,userid,pubtime from Collect group by url,collectid,userid,pubtime 具有 pubtime >= (select max(pubtime) from collect d where d.url = collect.url ) 按 Collect.pubtime desc 排序

数据库表脚本是：

> 如果存在 (select * from sysobjects where id = OBJECT_ID('[Collect]') and OBJECTPROPERTY(id, 'IsUserTable') = 1) DROP TABLE [Collect]
> 
> CREATE TABLE [Collect] ( [CollectId] [int] IDENTITY (1, 1) NOT NULL, [Url] [nvarchar] (200) NULL, [UserId] [nvarchar] (50) NULL, [PubTime] [datetime] NULL )
> 
> ALTER TABLE [Collect] WITH NOCHECK ADD CONSTRAINT [PK_Collect] PRIMARY KEY NONCLUSTERED ([CollectId] ) SET IDENTITY_INSERT [Collect] ON
> 
> 插入 [Collect] ([CollectId],[Url],[UserId],[PubTime]) 值 (1,'www.sohu.com','Mike','2008-10-10 0:00:00')插入 [Collect] ([CollectId],[Url],[UserId],[PubTime]) 值 (2,'www.echina365.com','Lily','2008-10-15 0:00:00')插入 [Collect] ([CollectId],[Url],[UserId],[PubTime]) 值 (3,'www.php.com','Tom','2008-10-20 0:00:00') INSERT [Collect] ([CollectId],[Url],[UserId],[PubTime]) VALUES (4,'www.echina365.com','姚明','2008-10-23 0:00:00')插入 [Collect] ([CollectId],[Url],[UserId],[PubTime]) 值 (5,'www.echina365.com','Mike','2008-10-25 0:00:00') INSERT [Collect] ([CollectId],[Url],[UserId],[PubTime]) VALUES (6,'www.sohu.com','Jack','2008-10-26 0:00:00') 插入 [Collect] ([CollectId],[Url],[UserId],[PubTime]) 值 (7,'www.echina365.com','Tracy',' 2008-11-2 0:00:00') INSERT [Collect] ([CollectId],[Url],[UserId],[PubTime]) VALUES (8,'www.php.com','YaoMing',' 2008-11-5 0:00:00')
> 
> SET IDENTITY_INSERT [收集] 关闭

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-26T05:21:08.657

由于您的“拥有”条件实际上不在聚合列上，所以您不能只使用“where”子句吗？

```
select distinct CollectId, url, userid, pubtime
from Collect
where pubtime >= (select max(pubtime) from collect d where d.url = collect.url)
order by Collect.pubtime desc 
```

给定您提供的数据集，这将得到相同的结果。然后 LINQ 语句变得相当简单：

```
var rows = (from c in Collect
where c.PubTime >= (
    from d in Collect
    where d.Url == c.Url
    select d.PubTime).Max()
orderby c.PubTime descending
select c).Distinct(); 
```

不过，我可能会误解您的意图。也许我的查询版本并不能完全满足您的要求。如果是这样，请给我留言，我将删除答案，以免混淆问题。

# html - 在评论标签中转义 html

> ID：319809
> 
> 赞同：6
> 
> 时间：2008-11-26T05:11:31.000
> 
> 标签：html, escaping

转义 html 很好 - 它会删除`<`'s 和`>`'s 等。

我遇到了一个问题，我在注释标签中输出文件名，例如。`<!-- ${filename} -->`

当然，如果你不逃跑，事情可能会很糟糕，所以它变成： `<!-- <c:out value="${filename}"/> -->`

问题是，如果文件的名称中有“--”，所有的 html 都会被搞砸，因为你不允许有`<!-- -- -->`.

标准的 html 转义不会转义这些破折号，我想知道是否有人熟悉一种简单/标准的转义方式。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-26T05:24:53.673

[HTML 注释的定义](http://www.htmlhelp.com/reference/wilbur/misc/comment.html)：

> 注释声明以 <! 开头，后跟零个或多个注释，然后是 >。注释以“--”开头和结尾，并且不包含任何“--”。

当然，评论的解析取决于浏览器。

这里没有什么让我印象深刻的解决方案，所以我建议你 str_replace 那些双破折号。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T05:26:16.993

没有好的方法可以解决这个问题。您不能只是逃避它们，因为评论是以明文形式阅读的。您将不得不做一些事情，例如在连字符之间放置一个空格，或者对连字符使用某种代码（如`[HYPHEN]`）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T05:36:49.733

没有通用的工作方法可以在 html 中转义这些字符，除非 - 字符是四的倍数，所以如果你这样做 - 它不会在 Firefox 中工作，但 ---- 会工作。所以这一切都取决于浏览器。例如，查看 Internet Explorer 8，这不是问题，那些字符被正确转义。Google 的 Chrome 也是如此……然而，即使是最新的浏览器（3.0.4），Firefox 也不能很好地处理这些字符的转义。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T05:40:48.680

由于您不能直接显示 '--' 是很明显的，因此您可以对它们进行编码或使用 fn:escapeXml 或 fn:replace 标签进行适当的替换。 [JSTL 文档](http://java.sun.com/products/jsp/jstl/1.1/docs/tlddocs/index.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T13:52:28.140

您不应该尝试 HTML 转义，注释的内容是不可转义的，可以使用裸露的 '>' 或 '&' 里面。

‘--’ is its own, unrelated problem and is not really fixable. If you don't need to recover the exact string, just do a replacement to get rid of them (eg. replace with ‘__’).

If you do need to get a string through completely unmolested to a JavaScript that will be reading the contents of the comment, use a string literal:

```
<!-- 'my-string' --> 
```

which the script can then read using eval(commentnode.data). (Yes, a valid use for eval() at last!)

Then your escaping problem becomes how to put things in JS string literals, which is fairly easily solvable by escaping the ‘'’ and ‘-’ characters:

```
<!-- 'Bob\x27s\x2D\x2Dstring' --> 
```

(You should probably also escape ‘&lt;’, ‘&amp;’ and ‘"’, in case you ever want to use the same escaping scheme to put a JS string literal inside a <​script> block or inline handler.)

# windows - 自动运行 CD 上的 MSI 文件

> ID：319811
> 
> 赞同：6
> 
> 时间：2008-11-26T05:13:29.717
> 
> 标签：windows, windows-installer

有没有人有一个示例 AUTORUN.INF，它可以在用户插入 CD 时自动启动 MSI 安装程序。

我确信这是可以做到的，但我已经在谷歌上搜索了很长时间，但还没有找到任何可行的解决方案。

**更新：**我有一个与此类似的 AUTORUN.INF，但它不会启动安装程序：

```
[autorun]
open=MyInstaller-1.0.0.msi
label=My CD Label
icon=MyIcon.ico 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-26T05:14:25.317

尝试 shellexecute= 而不是 open=

```
[自动运行]
shellexecute=MyInstaller-1.0.0.msi
label=我的 CD 标签
图标=MyIcon.ico
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T05:30:01.057

我可以回答我自己的问题。阅读 Ray 链接的文章后，我创建了以下有效的 AUTORUN.INF：

```
[autorun]
shellexecute=MyInstaller-1.0.0.msi
label=My CD Label
icon=MyIcon.ico 
```

AUTORUN.INF 文件与所引用的图标文件和 msi 文件一起放置在 CD 的根目录中。

# c# - 在 C# 2.0 中生成随机枚举

> ID：319814
> 
> 赞同：24
> 
> 时间：2008-11-26T05:15:23.847
> 
> 标签：c#, enums

有人可以向我指出一种更清洁的方法来生成随机枚举成员。这有效，但看起来很难看。

谢谢！

```
public T RandomEnum<T>()
{
  string[] items = Enum.GetNames(typeof( T ));
  Random r = new Random();
  string e = items[r.Next(0, items.Length - 1)];
  return (T)Enum.Parse(typeof (T), e, true);
} 
```

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-11-26T05:22:42.147

```
public T RandomEnum<T>()
{ 
  T[] values = (T[]) Enum.GetValues(typeof(T));
  return values[new Random().Next(0,values.Length)];
} 
```

[感谢@[Marc Gravell] 指出 Random.Next(min,max) 中的最大值是独占的。]

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-11-26T05:32:59.227

Marxidad 的回答很好（注意你只需要`Next(0,values.Length)`，因为上限是唯一的） - 但要注意时机。如果你在一个紧密的循环中这样做，你会得到很多重复。为了使其更随机，请考虑将 Random 对象保留在字段中 - 即

```
private Random rand = new Random();
public T RandomEnum<T>()
{ 
  T[] values = (T[]) Enum.GetValues(typeof(T));
  return values[rand.Next(0,values.Length)];
} 
```

如果是静态字段，则需要同步访问。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-12-15T21:16:41.590

Silverlight 没有 GetValues()，但您可以使用反射来获取随机枚举。

```
private Random rnd = new Random();

public T RndEnum<T>()
{
    FieldInfo[] fields = typeof(T).GetFields(BindingFlags.Static | BindingFlags.Public);

    int index = rnd.Next(fields.Length);

    return (T) Enum.Parse(typeof(T), fields[index].Name, false);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T06:00:52.180

我不确定 c# 但其他语言允许枚举值中的空白。为了解决这个问题：

```
enum A {b=0,c=2,d=3,e=42};

switch(rand.Next(0,4))
{
   case 0: return A.b;
   case 1: return A.c;
   case 2: return A.d;
   case 3: return A.e;
} 
```

主要的缺点是保持最新！

在那个角落里，没有那么整洁，但更正确。

* * *

正如所指出的，上面的示例索引到一个有效值的数组中，这就是正确的。OTOH 某些语言（*咳嗽*D*咳嗽*）不提供该数组，因此上述内容非常有用，无论如何我都会留下它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-01-05T03:06:51.360

```
Enum.Parse(typeof(SomeEnum), mRandom.Next(min, max).ToString()).ToString() 
```

# .net - 新的 asp.net 图表控件——它们会与 MVC（最终）一起使用吗？

> ID：319835
> 
> 赞同：74
> 
> 时间：2008-11-26T05:28:39.843
> 
> 标签：.net, asp.net, asp.net-mvc, charts

Scott Gu 刚刚发布了关于 .NET 团队正在分发的一组新图表控件。他们看起来不可思议：[http://weblogs.asp.net/scottgu/archive/2008/11/24/new-asp-net-charting-control-lt-asp-chart-runat-quot-server-quot-gt。 aspx](http://weblogs.asp.net/scottgu/archive/2008/11/24/new-asp-net-charting-control-lt-asp-chart-runat-quot-server-quot-gt.aspx)

百万美元的问题是……他们会与 MVC 合作吗？如果是，什么时候？

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2008-11-26T14:33:03.457

您可以通过两种方式使用图表控件：

**从控制器生成图像**

通过生成图表并将其作为动作的图像返回（我认为 Chatuman 指的是）：

```
Chart chart = new Chart();
chart.BackColor = Color.Transparent;
chart.Width = Unit.Pixel(250);
chart.Height = Unit.Pixel(100);

Series series1 = new Series("Series1");
series1.ChartArea = "ca1";
series1.ChartType = SeriesChartType.Pie;
series1.Font = new Font("Verdana", 8.25f, FontStyle.Regular);
series1.Points.Add(new DataPoint { 
                AxisLabel = "Value1", YValues = new double[] { value1 } });
series1.Points.Add(new DataPoint {
                AxisLabel = "Value2", YValues = new double[] { value2 } });
chart.Series.Add(series1);

ChartArea ca1 = new ChartArea("ca1");
ca1.BackColor = Color.Transparent;
chart.ChartAreas.Add(ca1);

using (var ms = new MemoryStream())
{
    chart.SaveImage(ms, ChartImageFormat.Png);
    ms.Seek(0, SeekOrigin.Begin);

    return File(ms.ToArray(), "image/png", "mychart.png");
} 
```

**WebForms 样式**

这样，您只需将图表包含在您的 .aspx 视图中（就像使用传统的 Web 表单一样）。为此，您必须在 web.config 中连接相关位

```
<controls>
    ...
    <add tagPrefix="asp"
         namespace="System.Web.UI.DataVisualization.Charting"
         assembly="System.Web.DataVisualization, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>
</controls>

<httpHandlers>
    ...
    <add path="ChartImg.axd"
         verb="GET,HEAD"
         validate="false"
         type="System.Web.UI.DataVisualization.Charting.ChartHttpHandler, System.Web.DataVisualization, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" />
</httpHandlers>

<handlers>
    ...
    <add name="ChartImageHandler"
         preCondition="integratedMode" 
         verb="GET,HEAD"
         path="ChartImg.axd"
         type="System.Web.UI.DataVisualization.Charting.ChartHttpHandler, System.Web.DataVisualization, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>
</handlers> 
```

构建图表时，您无法在 DataPoint 元素内运行代码，因此要连接数据，您需要 View 类中的方法。这对我来说没问题。以这种方式工作会使控件将 URL 呈现到由图表控件 http 处理程序生成的图像。在您的部署中，您需要为其提供一个可写文件夹来缓存图像。

*** VS 2010 / .NET 4 支持 ***

要使其在 .NET 4 中工作，您需要使用适当的公钥令牌将图表引用更改为版本 4.0.0.0。

此外，图表控件现在似乎生成了指向当前请求路径而不是请求路由的 url。对我来说，这意味着所有图表请求都会导致 404 错误，因为`/{Controller}/ChartImg.axd`等价物被路线阻止了。为了解决这个问题，我添加了额外的 IgnoreRoute 调用来涵盖我的用法 - 更通用的解决方案会更好：

```
public static void RegisterRoutes(RouteCollection routes)
{
    routes.IgnoreRoute("ChartImg.axd/{*pathInfo}");
    routes.IgnoreRoute("{controller}/ChartImg.axd/{*pathInfo}");
    routes.IgnoreRoute("{controller}/{action}/ChartImg.axd/{*pathInfo}");
... 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2011-02-25T16:09:44.163

对于想要使用 Razor 引擎将图表控制与 MVC 3 一起使用的人，请参阅以下链接

[如何将 MS Charts 与 MVC3 与 Razor 一起使用](http://www.asp.net/webmatrix/tutorials/7-displaying-data-in-a-chart)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-26T05:33:27.307

您已经可以将它们与 MVC 一起使用，您所要做的就是将它们渲染为图像

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-04-25T11:40:02.073

改为创建一个 Usercontrol 并为其提供完整的 Chart 对象并让它自己呈现：

```
<%@ Control Language="C#" Inherits="System.Web.Mvc.ViewUserControl<System.Web.UI.DataVisualization.Charting.Chart>" %>
<%
    Model.Page = this.Page;
    var writer = new HtmlTextWriter(Page.Response.Output);
    Model.RenderControl(writer);
%> 
```

将其命名为 Chart.ascx 并将其放在您的共享视图文件夹中。

现在您将免费获得所有额外的 html，如图像地图等。以及缓存。

在您的控制器中：

```
public ActionResult Chart(){
 var c = new Chart();
 //...
 return View(c);
} 
```

在你看来：

```
<% Html.RenderPartial("Chart", Model); %> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-09-03T16:29:00.913

这篇文章最适合我：

[http://www.codecapers.com/post/Build-a-Dashboard-With-Microsoft-Chart-Controls.aspx](http://www.codecapers.com/post/Build-a-Dashboard-With-Microsoft-Chart-Controls.aspx)

不会给出有关“对象未设置为对象的实例”或“会话 ID 可用但响应流已被刷新”的错误（不是错误的确切措辞）。

我不愿意只将它们呈现为图像，因为如果您在图表上进行向下钻取或工具提示或其他单击操作，则呈现为图像不会保留任何内容。

我需要的关键是将图表放入模型中，将模型传递给视图（或部分视图）并在视图中放置一个 asp:panel 并将图表添加到视图中的面板标记。

顺便说一句，这是 2010 年 9 月 3 日的 VS.net 2008 和 MVC 2（由于 MVC 不断发生变化，我在寻找答案时发现日期很重要）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-31T19:10:29.683

我一直在使用 MVC 进行测试，到目前为止，它看起来像是在使用 MVC。

# c - 帮助在 C 中处理字符串

> ID：319847
> 
> 赞同：1
> 
> 时间：2008-11-26T05:37:19.607
> 
> 标签：c, string, math

在一个查找给定数字是否为[Armstrong](http://en.wikipedia.org/wiki/Narcissistic_number)数字的程序中，我将输入 no（3 位）存储为字符串，如下所示。

```
char input[10];
scanf("%s",&input); 
```

现在我必须使用 math.h 的 pow 方法计算每个数字的立方体，如下所示。

```
int a;
a = pow(input[0],3); 
```

通过这样的编码，我无法得到正确的结果。如果我打印“a”的值，它会显示一些不相关的答案。我的疑问是，如何将字符串值转换为整数值？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-26T05:42:40.033

您正在对数字的 ASCII 值执行计算。您需要将其转换为数值，如下所示：

```
int digit = input[0] - '0';

int a; a = pow(digit, 3); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T06:08:00.840

有两个问题，都已经很详细了。首先是您的 scanf 需要一个 char*，而不是 char**。用杰里米所说的解决这个问题：

```
scanf("%s", input); 
```

接下来，正确计算功率，就像 Adam 说的：

```
a = pow(input[0]-'0',3); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T14:23:43.430

armstrong 数是在任何给定基数中表现出 armstrong 属性的数字，而不仅仅是基数 10。

```
int isArmstrong(int n, int b)
{
    int sum = 0;
    int n2 = n;
    int nDigits = 0;
    while(n2 != 0)
    {
        nDigits++;
        n2 /= b;
    }
    n2 = n;
    for(int i = 0; i < nDigits; i+++)
    {
        sum += pow(n2 % b, nDigits);
        n2 /= b;
    }

     return sum == n;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-26T05:41:51.050

您不需要使用 获取`input`数组的地址`&input`。简单地传递`input`会将指向您的字符串的指针传递给scanf()。您对 scanf() 的调用应如下所示：

```
scanf("%s", input); 
```

另一种方法是使用操作员的地址：

```
scanf("%s", &input[0]); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T06:13:56.523

另一方面，您可能需要将 power 替换为更通用的 power = strlen(input)

所以代码应该是这样的。

```
char input[10];
int power, sum = 0;

scanf("%s", input);
power = strlen(input);
sum += pow(input[0] - '0', power);

/* you need to compare in here */ 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-26T07:06:39.287

Doh，我可能在 C 方面花了太多时间，因为我认为这里的大多数答案都没有达到最终目标……当然，放弃 & 的建议很好，但是 scanf 还有其他几个问题。
首先，扔掉代码/作业应该没问题，但它很危险：输入 11 个字符并导致缓冲区溢出。
其次，IIRC，因为你需要一个数字，你应该使用一个 int 变量并得到它。来自生疏头脑的未经测试的代码：

```
int inputNumber;
scanf("%d", &inputNumber); 
```

在这里你需要 & 因为你不再有一个指针。
C 应该为你做转换，你有一个更安全的输入。

其他有问题的代码：

```
int a = pow(input[0], 3); 
```

你不是用第一个数字做数学，而是用第一个数字的 Ascii 值！IE。1 为 49，2 为 50...
既然您从我之前的更正中得到了一个数字，请将其除以 10 的正确幂得到数字。

如果您更喜欢使用字符串路线，请`input[0] - '0'`至少使用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-26T08:00:38.490

手绘编码，基于@PhiLho 使用实际整数输入的想法：

```
#include <stdio.h>
#include <stdlib.h>

int main(void)
{
  int a, sum, i;

  printf("Enter an Armstrong number, an integer in the range 100..999:\n");
  if(scanf("%d", &a) != 1)
    return EXIT_FAILURE;
  if(a < 100 || a > 999)
    return EXIT_FAILURE;

  /* Now extract digits, and compute sum of cubes. */
  for(sum = i = 0; i < 3; i++)
  {
    sum += pow(a % 10, 3);
    a /= 10;
  }
  printf("sum is: %d\n", sum);
  return EXIT_SUCCESS;
} 
```

# mysql - 如何有效地在 MySQL 中找到重复的 blob 行？

> ID：319860
> 
> 赞同：5
> 
> 时间：2008-11-26T05:46:43.770
> 
> 标签：mysql, optimization, join, blob

我有一张表格

```
CREATE TABLE data
{
   pk INT PRIMARY KEY AUTO_INCREMENT,
   dt BLOB
}; 
```

它在 blob 列中有大约 160,000 行和大约 2GB 的数据（平均每个 blob 14kb）。另一个表具有该表的外键。

大约有 3000 个斑点是相同的。所以我想要的是一个查询，它会给我一个重新映射表，允许我删除重复项。

天真的方法在 30-40k 行上花费了大约一个小时：

```
SELECT a.pk, MIN(b.pk) 
    FROM data AS a 
    JOIN data AS b
  ON a.dt=b.dt
  WHERE b.pk < a.pk
  GROUP BY a.pk; 
```

由于其他原因，我碰巧有一个具有 blob 大小的表：

```
CREATE TABLE sizes
(
   fk INT,  // note: non-unique
   sz INT
   // other cols
); 
```

通过为 fk 和另一个为 sz 建立索引，直接查询大约需要 24 秒，有 50k 行：

```
SELECT da.pk,MIN(db.pk) 
  FROM data AS da
  JOIN data AS db
  JOIN sizes AS sa
  JOIN sizes AS sb
  ON
        sa.size=sb.size
    AND da.pk=sa.fk
    AND db.pk=sb.fk
  WHERE
        sb.fk<sa.fk
    AND da.dt=db.dt 
  GROUP BY da.pk; 
```

但是，这是对 da（数据表）进行全表扫描。鉴于命中率应该相当低，我认为索引扫描会更好。考虑到这一点，添加了第 3 个数据副本作为第 5 次连接以获得该数据，并丢失了大约 3 秒。

好的，问题是：*我会比第二个选择好得多吗？*如果是这样，怎么做？

一个推论是：如果我有一个表，其中键列的使用非常频繁，但其余的应该很少使用，那么我最好添加该表的另一个连接以鼓励索引扫描而不是完整的表扫描？

* * *

#mysql@irc.freenode.net 上的 Xgc 指出，添加一个实用程序表（如大小但具有唯一约束）`fk`可能会有很大帮助。触发器带来一些乐趣，而不会让它保持最新状态甚至还不错。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-26T06:24:39.107

您始终可以对数据使用散列函数（[MD5](https://en.wikipedia.org/wiki/MD5)或[SHA1](https://en.wikipedia.org/wiki/SHA-1)），然后比较散列值。

问题是您是否可以将哈希值保存在数据库中？

# c# - 比较发布版本的产品

> ID：319864
> 
> 赞同：4
> 
> 时间：2008-11-26T05:49:34.713
> 
> 标签：c#, visual-studio-2005, build-process

我需要比较 VS2005 的构建输出，以确保我可以复制完全相同的产品。

当我在发布中一个接一个地进行两个构建并比较生成的文件时，我得到不同的文件，进行文本比较似乎不仅仅是日期时间不同

我如何构建才能每次都复制完全相同的产品？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-26T06:29:37.333

每当您构建时，编译器都会嵌入：

*   日期和时间
*   一个 GUID（我相信用于调试等）
*   可能是程序集版本（可能有“1.2.3.*”并自动填充）
*   潜在的强哈希

几个选项：

*   找出文件“已知无实质性差异”的位置，擦除这些字节，然后进行比较
*   使用 ildasm 将程序集转换为文本，然后比较这些结果。（我还没有检查这是否也揭示了差异 - 它可能会这样做，在这种情况下，您必须再次明确忽略某些部分）

这个问题确实经常出现，所以我会看看我是否可以想出一个工具来进行比较 - 尽管它不太可能处理签名的程序集，因为签名的位置可能会有很大差异。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T06:25:07.263

一个问题：您对二进制构建输出进行了***文本比较？***据我所知，大多数编译器从不会为同一个项目生成二进制相同的构建输出。编译器将编译时间、特殊序数等编码成二进制。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T08:25:47.253

You can actually use DumpBin to do binary comparisons of different builds that ignore the per-build variations. See [How to compare binary images of the same project builds](http://support.microsoft.com/kb/164151). The article says it applies only up to Visual Studio 6, so I am not sure it will work for 2005 or beyond..

# mobile - 是否可以以编程方式向 Symbian 中的应用程序添加软键快捷方式

> ID：319870
> 
> 赞同：2
> 
> 时间：2008-11-26T05:53:16.830
> 
> 标签：mobile, symbian, shortcuts, s60

Symbian S60 应用程序是否可以自动将自身添加到其中一个软键中。最好的情况是它可以在安装时完成，但如果有一些 API 可用于在应用程序第一次运行时添加快捷方式，在我们的情况下也可以。

Symbian 是否在这方面有一些最佳实践。我可以猜想，如果某些用户已配置软键快捷方式以引用其他应用程序，则某些用户可能会感到不安，如果某些应用程序覆盖了他/她的设置，

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-26T06:34:16.480

我相信[这](http://wiki.forum.nokia.com/index.php/ScShortcuts_Engine_Wrapper_API)就是您正在寻找的。我不会评论 Symbian 的最佳实践，但我想说这是一个覆盖我定义的快捷方式之一的应用程序，我会很生气。如果绝对有必要，我会在安装过程中显示一个提示，并询问知道应用程序安装后将覆盖一个快捷方式软键的用户是否希望继续安装。事实上，当您选择让您的应用程序 Symbian 签名时，您可能需要也可能不需要在安装过程中放置​​这样的确认框。

# sql - SQL：如何将 ID 附加到具有重复值的行

> ID：319873
> 
> 赞同：3
> 
> 时间：2008-11-26T05:54:26.950
> 
> 标签：sql, duplicates

我有一个包含一些重复行的表。我只想修改重复的行，如下所示。

前：

```
id     col1
------------
1      vvvv
2      vvvv
3      vvvv 
```

后：

```
id     col1
------------
1      vvvv
2      vvvv-2
3      vvvv-3 
```

Col1 附加一个连字符和`id`列的值。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-26T10:46:53.430

此 SQL 只会更新重复项，但不会更新 id 最低的那个：

```
update tbl
  set col1 = col1 + '-' + convert(varchar, id)
  where exists(select * from tbl t where t.col1 = tbl.col1 and t.id < tbl.id) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T06:44:03.763

查看[`IN`](http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/conditions013.htm)Oracle 语法。查询未测试

```
update table1 set
col1 = col1 || id
where
id not in (
select min(id) from table1
groupby col1
) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T06:04:48.990

您可以使用 sproc 和游标来做到这一点。我认为在任何合理的选择查询中都不可能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T06:10:05.343

您可以通过 2 步过程来完成此操作，尽管 SQL 向导可能会对其进行修改，以便一步为您提供解决方案。

首先，您需要获取所有重复值。这是一个可以执行此操作的 SQL 查询：

```
SELECT COUNT(*) AS NumberOfDuplicates, col1
从表 1
按 col1 分组
有（计数（*）> 1）

```

这将为您提供一个列出重复次数和重复值的结果集。

在第 2 步中，您将遍历此结果集，获取 col1 值，返回包含该值的所有记录，并（可能使用循环计数器变量）根据您的示例更改值。

注意：您实际上并不需要返回重复的数量来实现您的目标，但它会帮助您测试查询并对其工作感到满意。

# ldap - 了解具有 ldap、radius、openid 等的 SSO 交钥匙设备吗？

> ID：319874
> 
> 赞同：3
> 
> 时间：2008-11-26T05:58:22.543
> 
> 标签：ldap, single-sign-on, appliance

我正在帮助一家典型的小公司，该公司从几个外包系统（谷歌应用程序、svn/trac）开始。添加了一个内部 jabber 服务器（ejabber 主要用于 iChat 客户端）。订阅了几个网络服务（例如 highrisehq）。并具有由 pfsense freebsd 防火墙提供的 vpn 服务。

所有这一切的最终结果是他们淹没在密码和帐户中。

似乎如果他们有一个统一的登录/单点登录服务，他们可以在很长的时间内将这些结合起来。例如：ldap 作为主存储库，radius 链接到它以用于 vpn、ejabber 甚至 WPA2 无线访问，用于登录谷歌应用程序的插件，以及可能用于外部网站（如 highrisehq）的 openid 服务器。

似乎所有这些工具都是单独存在的，但有谁知道将它们与漂亮的 GUI 和自动更新相结合的单个盒子？（例如，pfsense/m0n0wall 用于防火墙，freeNAS 用于存储）。它不一定是 FOSS。付费的盒子也可以。

我认为这一定存在。Microsoft 的 Active Directory 可能是一种解决方案，但如果可能，他们宁愿避免使用 Windows。ISP 使用或用于企业防火墙/路由器管理的似乎有各种“AAA”服务器，但这似乎不太正确。

我缺少任何明显的解决方案吗？谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-07-23T00:09:35.657

自从你最初提出这个问题以来已经一年多了，所以我猜你现在已经解决了你的问题。但是，如果其他人对可能的解决方案感兴趣，我建议如下：

首先，我不知道您的问题有任何“一体化”解决方案。但是，将三种产品组合起来非常容易，它们将解决您的所有需求并为用户管理和密码存储提供单一来源。

首先要做的是安装一个 LDAP 目录来管理用户和组（以及可能超出您的问题范围的其他对象）。这可以是[OpenLDAP](http://www.openldap.org/)、[Apache DS](http://directory.apache.org/)、 Microsoft Active Directory 等。基本上任何 LDAP 服务器都可以。

其次，我建议安装[FreeRADIUS](http://freeradius.org/)，并将[LDAP 目录配置](http://www.ibm.com/developerworks/library/l-radius/)为后端服务。

第三获得[Atlassian Crowd](http://www.atlassian.com/software/crowd/)的许可证。它提供 OpenID 和 Google Apps 身份验证。最多 50 位用户的起价为 10 美元，无限用户许可证最高可达 8000 美元。

三者的安装和配置都比较容易。您可能会将大部分工作用于创建用户和组。您可以在单个服务器上安装所有三个组件，并最终得到一个允许您验证几乎所有内容的盒子，从桌面登录、Google Apps 和其他 Web 应用程序，到 VPN，甚至交换机、WiFi 和路由器登录。

只需确保明智地配置角色和组！否则，您最终可能会有一些销售人员能够对您的防火墙和路由器进行管理:-)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2013-12-03T16:14:51.737

我鼓励任何搜索此类解决方案的人查看 Gluu 服务器 ( [http://gluu.org](http://gluu.org) )。

每个 Gluu 服务器都包括一个用于 SAML SSO 的 SAML IDP、一个用于 OpenID Connect SSO 的 OpenID Connect 提供程序 (OP)、一个用于 Web 访问管理的 UMA 策略决策点 (PDP) 以及一个 RADIUS 和 LDAP 服务器。

Gluu Server 的所有组件都是开源的（即 Shibboleth、OX、FreeRADIUS、OpenDJ 等），包括用于管理服务器每个组件的 oxTrust Web 用户界面。

对于商业实施，Gluu 将在客户端 VM 上构建、支持和监控此软件堆栈。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-14T23:30:11.327

您可能不想在这么多应用程序（尤其是外部应用程序）中标准化密码，但对于使用 LDAP 等身份验证服务的内部应用程序来说是有意义的。

[您可以使用像Novell SecureLogin](http://www.novell.com/products/securelogin/media.html)这样的 eSSO 解决记住密码的问题

您也可能对 [Novell Access Manager](http://www.novell.com/products/accessmanager/)和[Novell Identity Manager感兴趣](http://www.novell.com/products/identitymanager/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-09-14T03:49:20.333

我也可以使用这样的设备，但我唯一能找到的是来自 Infoblox 的（可能已经过时的）数据表。他们似乎从那以后专注于自动化网络管理，而我在他们当前的网站上找不到 LDAP 设备。我想用上面提到的 FOSS 东西构建一个 linux 盒子是每个人都会做的，但是没有电源、磁盘、风扇等会很棒。我想你可以使用 EEE PC 之类的东西并将配置放在闪存上卡片。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-11-19T15:13:13.853

这也是我一直在寻找的东西，[http:](http://www.turnkeylinux.org/openldap) //www.turnkeylinux.org/openldap 看起来像解决方案：“设备”安装，它包括加密的在线备份，可以轻松恢复到新机器或替换机器。

# .net - HTML最后一个标签条件匹配

> ID：319879
> 
> 赞同：0
> 
> 时间：2008-11-26T06:05:37.803
> 
> 标签：.net, regex

我有两个字符串

```
<EM>is <i>love</i></EM>,<PARTITION /> 
```

和

```
<EM>is <i>love</i>,<PARTITION /> 
```

我想要一个正则表达式完全匹配第二个字符串，但不应该匹配第一个。请帮忙。

注意：除了 EM 和 PARTITION 标签外，一切都可以改变。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T10:22:37.067

如果要完全匹配不包含某个子字符串的字符串，请使用正则表达式匹配子字符串，如果正则表达式不匹配，则返回整个字符串。你没有说你使用的是哪种语言，但是你用 .NET 标记了你的问题，所以这里是 C#：

```
if (Regex.IsMatch(subjectString, "</EM>")) {
    return null;
} else {
    return subjectString;
} 
```

由于只是一些文字文本，因此您甚至不需要使用正则表达式：

```
if (subjectString.Contains("</EM>")) {
    return null;
} else {
    return subjectString;
} 
```

在您只能使用正则表达式的情况下，请尝试以下操作：

```
\A((?!</EM>).)*\Z 
```

仅正则表达式的解决方案的效率将远低于上述代码示例。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T06:15:38.093

我不认为你在问正确的问题。此正则表达式完全匹配第二个字符串，而不是第一个：

```
/^<EM>是<i>爱</i>,<PARTITION \/>$/
```

但显然，你想匹配一类字符串，而不仅仅是第二个字符串......对吗？定义您要匹配的字符串类别，您可以更接近获得所需的正则表达式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T07:28:42.720

```
^<EM>(?:(?<!</EM>).)*<PARTITION />$ 
```

作品。但这取决于目标语言，例如，JavaScript 不支持环视断言......

一个更简单的解决方案是使用`^<EM>.*<PARTITION />$`并在`</EM>`之后检查字符串中没有：我相信 RE 功能强大且必须具备，但我不会尝试仅在一个表达式中完成所有操作... :-)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-28T07:31:28.987

幸运的是，经历了这一切并对此进行了大量研究，我找到了正确的正则表达式............这里适合你们......感谢所有帮助过的人

```
<EM>\w*\s*\W*\S*[^\(</EM>)]<PARTITION[ ]/> 
```

捕获第二个字符串但留下第一个字符串......我遇到的唯一问题是否定`</EM>`我在组之前用反斜杠所做的组合，这否定了完整的字符串而不是单独获取字符......

# c++ - C++ 中带负数的整数除法舍入

> ID：319880
> 
> 赞同：37
> 
> 时间：2008-11-26T06:06:28.487
> 
> 标签：c++, rounding

假设`a`和`b`都是 类型`int`， 并且`b`非零。考虑`a/b`在以下情况下执行的结果：

1.  `a`并且`b`都是非负的。
2.  `a`并且`b`都是负面的。
3.  恰好其中一个是阴性的。

在案例 1 中，结果向下舍入到最接近的整数。但是标准对案例 2 和案例 3 有什么规定？我在 Internet 上发现的一份旧草案表明它依赖于实现（是的，甚至是案例 2），但委员会倾向于使其始终“向零舍入”。有谁知道（最新）标准说什么？请仅根据标准回答，而不是根据什么是有意义的，或者特定的编译器做什么。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-11-26T06:24:00.417

根据 2008 年 5 月的修订，

你是对的：

> 二元 / 运算符产生商，二元 % 运算符产生第一个表达式除以第二个表达式的余数。如果 / 或 % 的第二个操作数为零，则行为未定义；否则 (a/b)*b + a%b 等于 a。如果两个操作数都是非负数，则余数是非负数；如果不是，则余数的符号是​​实现定义的75)。

注释 75 说：

> 根据正在进行的 ISO C 修订工作，整数除法的首选算法遵循 ISO Fortran 标准 ISO/IEC 1539:1991 中定义的规则，其中商始终向零舍入。

C++ 在这方面很有可能落后于 C。就目前而言，它是未定义的，但他们着眼于改变它。

我与 Stroustrup 在同一部门工作，并与委员会的一名成员一起工作。事情需要 AGES 才能完成，而且它无休止的政治化。如果这看起来很愚蠢，那可能是。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2011-11-15T14:08:41.597

作为其他答案的更新：

C++11 的最后一个草案[n3242](http://www.open-std.org/Jtc1/sc22/wg21/docs/papers/2011/n3242.pdf)与实际的 C++11 标准相同，在 5.6 第 4 点（第 118 页）中说明了这一点：

> 对于整数操作数， / 运算符产生代数商，并丢弃任何小数部分；（见注 80）

注释 80 状态（请注意，注释是非规范性的）：

> 80) 这通常被称为向零截断。

第 4 点继续指出：

> 如果商 a/b 在结果类型中是可表示的，则 (a/b)*b + a%b 等于 a。

可以证明要求 的符号与`a%b`的符号相同`a`（当不为零时）。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-11-26T06:35:18.040

只是一个评论。C++ 标准的当前工作草案确实纠正了“实现定义的”问题，并要求截断为零。[这](http://www.open-std.org/jtc1/sc22/wg21/)是委员会的网页，[这](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2008/n2798.pdf)是草案。问题在第 112 页。

* * *

## 回答 #4

> 赞同：-6
> 
> 时间：2017-11-23T20:28:30.090

有时我们需要退后一步，看看它的数学：

给定 int x, int y

如果 int i1 = x/y 并且 int i2 = x%y

那么 y * i1 + i2 必须是 x

因此，这与标准无关，但可能只有一种方式。如果任何标准允许它以任何其他方式出现，那么标准是错误的，这意味着语言被破坏了。

# javascript - XPCOM中的popen等效项？

> ID：319882
> 
> 赞同：4
> 
> 时间：2008-11-26T06:07:49.950
> 
> 标签：javascript, xul, xpcom, xulrunner

我正在尝试`XULRunner`将 GUI 添加到基于命令行的程序中。

一种解决方案是使用 XUL 应用程序中的诸如 popen 之类的东西与命令行程序进行交互。

我的问题：

*   XPCOM有popen吗？
*   XPCOM 是否有足够的原语来创建 popen？
*   是否有另一种方法可以访问过程中的标准输入/输出？

PyXPCOM 似乎具有此功能，但如果可能，我宁愿不添加依赖项。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-15T02:45:47.800

[编辑] 可以使用[js-ctypes](https://developer.mozilla.org/en-US/docs/Mozilla/js-ctypes)来实现，事实上有人已经这样做了。

该模块称为**subprocess.jsm**，这是文档：[http ://hg.mozilla.org/ipccode/file/tip/readme.txt](http://hg.mozilla.org/ipccode/file/tip/readme.txt)

（答案的 2009 版本：不是纯 JS，不是。可以创建二进制 XPCOM 组件，实际上有人这样做了 - 请参阅[https://bugzilla.mozilla.org/show_bug.cgi?id=68702](https://bugzilla.mozilla.org/show_bug.cgi?id=68702)。）

# jquery - 如何使用 gravatar 和 jquery 加载页面？

> ID：319893
> 
> 赞同：1
> 
> 时间：2008-11-26T06:19:15.840
> 
> 标签：jquery, asp.net-mvc, gravatar

我正在使用 gravatar 为在页面上发布故事的每个用户加载头像。我还使用 jquery 来圆化页面上某些 span 元素的角。不幸的是，看起来从 gravatar 抓取头像发生在应用 jquery 效果之前（没有 gravatar 代码，元素会立即四舍五入），因此元素在网站上可见后会立即改变外观。有没有办法解决这个问题？（我正在使用 asp.net mvc）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-29T18:32:34.723

我想您正在使用 urls 加载 gravatar，而不是 ajax 等。 document.ready() 将在加载 DOM 时执行，而不一定在加载所有（gravatar）图像时执行。您可以尝试在您的情况下使用 window.onload 事件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-29T18:11:40.630

听起来您的 gravatar 加载脚本在外观修改 jQuery 调用之前正在执行。有什么方法可以手动调用 gravatar 加载？如果是这样，您可以使用 jQuery 的 document.ready 先调用您的外观更改，然后调用 gravatar 加载。这样，您就不会在“更重要”的 UI 更改运行之前等待 gravatar 完成。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-03-06T01:18:18.603

这是一个[有效的 JsFiddle 演示](http://jsfiddle.net/rMypw/)，如何使用 JSONP 调用 API 来获取用户的头像配置文件

```
 $("form").on("submit", function(e) {
        e.preventDefault();

        $.ajax("http://en.gravatar.com/" + md5($("#email").val()) + ".json", { dataType: "jsonp" })
        .done(function(result) { 
            for(var idx in result.entry)
            {
                var profile = result.entry[idx];
                console.log(profile);
                $("#displayName").text(profile.displayName);
                $("#avatar").attr("src", profile.thumbnailUrl);
            }
        }).fail(function(result) { console.log("fail", arguments); });

    }); 
```

# windows-installer - 替换 MSI 中的小文件的最简单解决方案？

> ID：319894
> 
> 赞同：11
> 
> 时间：2008-11-26T06:19:19.023
> 
> 标签：windows-installer, installation, orca, msitransform

我们的许多客户都可以使用 InstallShield、WISE 或 AdminStudio。这些都不是问题。我希望有某种方法可以为我们的小型客户提供**无需使用商业重新打包工具**的免费工具集和步骤来自己进行文件替换。

只需要替换压缩 MSI 中的单个配置文件，可以假设目标用户已经安装了 Orca，知道如何使用它来自定义属性表（为 GPO 部署嵌入许可证详细信息）并生成了 MST 文件.

**免责声明**：这与*[另一个问题](https://stackoverflow.com/questions/126562/how-to-replace-a-file-in-a-msi-installer)**非常相似，但该线程中的问题和答案都不清楚。*

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-06T04:21:15.713

好的，用我自己的答案重新审视这个问题，提供很好的小 VB 脚本，可以完成所有繁重的工作。如原始问题所述，目的是为系统管理员用户提供一个简单的解决方案，让他们自己进行更新/更改。

以下是我目前提供给客户的代码的简化版本

```
Option Explicit

Const MY_CONFIG = "MyConfigApp.xml"
Const CAB_FILE = "config.cab"
Const MSI = "MyApp.msi"

Dim filesys : Set filesys=CreateObject("Scripting.FileSystemObject")

If filesys.FileExists("temp.tmp") Then filesys.DeleteFile("temp.tmp")
filesys.CopyFile MSI, "temp.tmp"

Dim installer, database, database2, view
Set installer = CreateObject("WindowsInstaller.Installer")
Set database = installer.OpenDatabase ("temp.tmp", 1)
Set database2 = installer.OpenDatabase (MSI, 1)

If Not filesys.FileExists(MY_CONFIG) Then WScript.Quit 2 ' No config file, abort!

Dim objFile, size, result, seq, objCab

' MakeCab object has been depreciated so we fallback to makecab.exe for with Windows 7
On Error Resume Next ' Disable error handling, for a moment
Set objCab = CreateObject("MakeCab.MakeCab.1") 
On Error Goto 0  ' Turn error handling back on

If IsObject(objCab) Then ' Object creation successful - use XP method   
    objCab.CreateCab CAB_FILE, False, False, False
    objCab.AddFile MY_CONFIG, filesys.GetFileName(MY_CONFIG)
    objCab.CloseCab
    Set objCab = Nothing
Else ' object creation failed - try Windows 7 method
    Dim WshShell, oExec
    Set WshShell = CreateObject("WScript.Shell")
    Set oExec = WshShell.Exec("makecab " & filesys.GetFileName(MY_CONFIG) & " " & CAB_FILE)
End If

Set objFile = filesys.GetFile(MY_CONFIG)
size = objFile.Size

Set view = database.OpenView ("SELECT LastSequence FROM Media WHERE DiskId = 1")
view.Execute
Set result = view.Fetch
seq = result.StringData(1) + 1 ' Sequence for new configuration file

Set view = database.OpenView ("INSERT INTO Media (DiskId, LastSequence, Cabinet) VALUES ('2', '" & seq & "', '" & CAB_FILE & "')")
view.Execute

Set view = database.OpenView ("UPDATE File SET FileSize = " & size & ", Sequence = " & seq & ", FileName = 'MYC~2.CNF|MyConfigApp.xml' WHERE File = '" & MY_CONFIG & "'")
view.Execute

database.GenerateTransform database2, "CustomConfig.mst"
database.CreateTransformSummaryInfo database2, "CustomConfig.mst", 0, 0
filesys.DeleteFile("temp.tmp")

Set view = nothing
Set installer = nothing
Set database = nothing
Set database2 = nothing
Set filesys = Nothing
WScript.Quit 0 
```

**更新：** MakeCab.MakeCab.1*对象*已弃用，代码已更新为现在可与 Windows 7 一起使用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-28T22:11:52.380

恕我直言，这种情况表明正在安装的应用程序中缺少功能，并且在应用程序中修复比使用 MSI 更容易修复。

* * *

## 管理员图片

首先让我说一个为您的用户“解决”这个问题的简单方法是告诉他们运行您的 MSI 的管理员安装。这实际上将从内部 CAB 中提取所有文件并将所有文件放在指定的文件夹中：

***msiexec.exe /a myinstaller.msi TARGETDIR=C:\AdminImage***

然后，您的用户可以直接进入提取的文件夹结构并更新相关文件，然后将目录映射到其他 PC 并安装 MSI。与在 MSI 中具有哈希值的文件有关（以避免欺骗），这可能会产生副作用，但在大多数情况下它可以正常工作。

* * *

## 运行 XML XPath 查询

新版本的部署工具（例如 Installshield 和 Wix）内置了对在安装期间运行 XPath 查询的支持，因此可以动态编写部分。

* * *

## 应用程序更新

在 PC 上设置应用程序涉及几个步骤。首先是将内容部署到机器上——这应该使用 MSI 来完成，毫无疑问。但是，在大多数高级应用程序中，需要几个类似于此“配置文件更新”的“安装后配置任务”。

将这些配置任务推迟到**应用程序启动**几乎总是更好，而不是在 MSI 中实现功能。这有很多原因，但最重要的是只有应用程序 EXE 才能保证在正确的用户上下文中运行。MSI 文件可以使用系统权限、不同的用户帐户或通过某种其他机制运行。

我们通常推荐的是使用 MSI 将**所有需要的内容下载到 PC 上**。然后标记注册表以向应用程序指示它是第一次启动（对于更新，您可以增加一个计数器或将新版本号写入 HKLM）。然后应用程序可以在其启动例程中执行最后的配置步骤。它可以从 %ProgramFiles% 中的某个位置复制默认的 config.xml 文件并将其复制到用户配置文件中。然后它可以从 MSI 写入的 HKLM 中读取所需的值，然后用这些值更新 config.xml 文件。

一般来说：避免由 MSI 或任何其他设置机制执行的配置步骤。专注于将所需的文件和注册表项写入机器，然后让应用程序自己设置合适的运行时环境。这将允许更好的部署控制。如果你愿意，最好是“封装”。MSI 通过注册表向应用程序发送“消息”，应用程序根据该消息知道“如何正确设置自己”。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-26T10:12:33.170

我假设您自己创建了 msi 文件（？）

当您使用[Wix](http://wix.sourceforge.net/)生成您的 msi 时，客户可以在替换文件后简单地重新生成整个 msi（wix 是免费的）。否则应该可以使用未嵌入在 msi 中的未压缩文件。在 wix 中，您必须添加一个没有 cabinet 属性的[媒体元素。](http://wix.sourceforge.net/manual-wix2/wix_xsd_media.htm)缺点是您必须分发两个文件，而不是单个 msi。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-26T07:30:09.520

您需要在[Media](http://msdn.microsoft.com/en-us/library/aa369801.aspx)表中添加一个条目，添加另一个没有 CAB 文件的媒体，以及一个比 CAB 文件的最后一个序列多一个的 LastSequence。然后，您需要在[文件](http://msdn.microsoft.com/en-us/library/aa368596(VS.85).aspx)表中用新文件替换文件的序列，并更新所有其他可能已更改的文件属性。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-06-18T17:27:51.407

检查以下帖子： [如何替换 msi 安装程序中的文件？](https://stackoverflow.com/questions/126562/how-to-replace-a-file-in-a-msi-installer)

哪里提到：

此命令提取 MSI 文件： msi2xml -c OutputDir TestMSI.MSI

打开 OutputDir 并修改文件。

要重建 MSI，请运行：xml2msi.exe -m TestMSI.xml

您需要 -m 来忽略修改 MSI 文件时失败的“MD5 校验和测试”。

下载： [https ://msi2xml.sourceforge.io/](https://msi2xml.sourceforge.io/)

# python - 如何跳过处理作为不同电子邮件附件的电子邮件附件

> ID：319896
> 
> 赞同：3
> 
> 时间：2008-11-26T06:20:40.703
> 
> 标签：python, email, jython, attachment

使用 jython

我有一种情况，电子邮件带有不同的附件。某些文件类型我处理其他我忽略并且不写入文件的文件。我陷入了一个相当糟糕的境地，因为有时人们将电子邮件作为附件发送，而附加的电子邮件具有合法附件。

我想要做的是跳过附加的电子邮件及其所有附件。

使用 python/jythons 标准电子邮件库我该怎么做？

* * *

让它更清楚

我需要解析一封电子邮件（名为 ROOT 电子邮件），我想使用 jython 从这封电子邮件中获取附件。接下来支持某些附件，即.pdf .doc等像。

我需要的是：摆脱附加到根电子邮件和儿童电子邮件附件的任何儿童电子邮件。发生的事情是我浏览了整个电子邮件，它只是解析每个附件，包括根附件和儿童附件，就好像它们是根附件一样。

我不能拥有这个。我只对合法的 ROOT 附件感兴趣，即 .pdf .doc。xls .rtf .tif .tiff

现在应该这样做，我必须跑去赶公共汽车！谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T15:38:34.353

现有建议的问题是 walk 方法。这递归地，深度优先，遍历整个树，包括孩子。

查看 walk 方法的来源，并对其进行调整以跳过递归部分。粗略阅读表明：

```
if msg.is_multipart():
    for part in msg.get_payload():
          """ Process message, but do not recurse """
          filename = part.get_filename() 
```

阅读 pydocs，get_payload 应该返回一个顶级消息列表，而不是递归。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T08:58:31.557

那个名为“ [Here's an example of how to unpack a MIME message like the above, into a directory of files](http://docs.python.org/library/email-examples.html) ”的例子怎么样？它看起来离你想要的很近。

```
import email
...
msg = email.message_from_file(fp)
...
for part in msg.walk():
    # multipart/* are just containers
    if part.get_content_maintype() == 'multipart':
        continue
    # Applications should really sanitize the given filename so that an
    # email message can't be used to overwrite important files
    filename = part.get_filename()
    if not filename:
        ext = mimetypes.guess_extension(part.get_content_type())
    ... 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T10:52:21.827

您是否尝试过 get_payload( [i[, decode]]) 方法？与 walk 不同，它没有记录递归打开附件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T10:59:27.193

我将您的问题理解为“我必须检查电子邮件的所有附件，但如果附件也是电子邮件，我想忽略它。” 无论哪种方式，这个答案都应该引导你走上正确的道路。

我想你想要的是`mimetypes.guess_type()`. 使用此方法也比仅检查扩展列表要好得多。

```
def check(self, msg):
    import mimetypes

    for part in msg.walk():
        if part.get_filename() is not None:
            filenames = [n for n in part.getaltnames() if n]
            for filename in filenames:
                type, enc = mimetypes.guess_type(filename)
                if type.startswith('message'):
                    print "This is an email and I want to ignore it."
                else:
                    print "I want to keep looking at this file." 
```

请注意，如果这仍然查看附加的电子邮件，请将其更改为：

```
def check(self, msg):
    import mimetypes

    for part in msg.walk():
        filename = part.get_filename()
        if filename is not None:
            type, enc = mimetypes.guess_type(filename)
            if type.startswith('message'):
                print "This is an email and I want to ignore it."
            else:
                part_filenames = [n for n in part.getaltnames() if n]
                for part_filename in part_filenames:
                    print "I want to keep looking at this file." 
```

[MIME 类型文档](http://docs.python.org/dev/library/mimetypes.html)

# jquery - 在 VS 2005 中集成 jQuery Intellisense

> ID：319897
> 
> 赞同：4
> 
> 时间：2008-11-26T06:20:54.590
> 
> 标签：jquery, visual-studio-2005

如何在 VS 2005 中集成 JQuery Intellisense 支持

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-26T06:27:43.093

似乎不可能。[请参阅此处](http://blogs.msdn.com/webdevtools/archive/2008/11/18/jscript-intellisense-faq.aspx)的答案 10 。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T16:39:52.373

我刚刚向 DevExpress - Refactor Pro 和 CodeRush 提交了一个请求，为 VS 2005 创建一个附加组件。如果你和你的同事去 DevExpress 并提出请求，他们可能会注意并产生一些东西。试试看。

# unix - 如何使用 argv 使用 AWK 打印文本文件的第 N 列

> ID：319899
> 
> 赞同：32
> 
> 时间：2008-11-26T06:22:18.003
> 
> 标签：unix, awk

假设我有一个文本文件，其中的数据由空格分隔成列。我想编写一个 shell 脚本，它将文件名和数字 N 作为输入，并仅打印出该列。使用 awk 我可以执行以下操作：

```
awk < /tmp/in '{print $2}' > /tmp/out 
```

此代码打印出第二列。

但是如何将其包装在 shell 脚本中，以便可以在 argv 中传递任意列？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-11-26T06:30:34.290

```
awk -vx=2 '{打印 $x}'
```

或在 shell 脚本中：

```
#!/bin/sh
数量=$1
awk < /tmp/in -vx=$num '{print $x}' > /tmp/out

```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-26T06:31:55.347

```
awk '{print $'$myvar'}' < /tmp/in > /tmp/out 
```

其中 $myvar 是您的变量列（整数）。注意脚本注入！

# perl - 我应该教初学者 Perl 程序员什么？

> ID：319900
> 
> 赞同：16
> 
> 时间：2008-11-26T06:23:50.543
> 
> 标签：perl, cpan

我将花 30 分钟向有经验的程序员教授 Perl。学习 Perl 的最好方法是编写代码。除了 CPAN，你会向程序员展示什么，以便他们了解 Perl 的表达能力、CPAN 提供的大量功能，同时保持一切干净整洁，以便他们对语言感到满意？我会把棘手的东西留到另一天。

```
使用警告；
使用严格；
# 使用 A_CPAN_LIB;

子示例_func1 {
  # 使用 CPAN 库或演示 Perl 的一些基本特性
}
example_func1();
# ...
__结尾__

```

* * *

这就是我想出的...

## 从哪儿开始

信不信由你，手册页。好的，我们将只使用 perldoc 来对 Windows 友好。

perldoc 页面（或 Unix/Mac 上的手册页）非常适合 Perl。您可以键入 man perl 或 perldoc perl

**perldoc perl** ; # 展示一个概览和几十个教程；man perl 也是一样。

**perldoc perlintro** ; # 给初学者的 Perl 介绍；man perlintro
**perldoc perlrequick** ; # Perl 正则表达式教程示例

**perldoc perlfunc** ; # 显示 Perl 内置函数
**perldoc perlre** ; # 更多 Perl 正则表达式。

## CPAN

Perl 库站点 CPAN 上有数千个库。
**perl -MCPAN -e '安装日期时间'**

perldoc 也适用于已安装的模块：perldoc module

**perldoc DateTime**
**perldoc DBI** ; # 数据库 API。如果这不起作用，请安装它：
         **perl -MCPAN -e 'install DBI'**

## 推荐模块

**perl -MCPAN -e '安装 Moose'** ; # Perl 做 OOP
**perldoc Moose** ; # 告诉我更多关于 Moose
**perl -MCPAN -e 'install CGI'** ; # 快速而肮脏的网页
**perl -MCPAN -e 'install Catalyst'** ; # 大型网络框架。有时安装有问题。谷歌是你的朋友
**perl -MCPAN -e 'install CGI::Application'** ; # 另一个 web 框架
**perldoc CGI::Application** ; # 快速查看文档

A little Q&A。

问：为什么我应该使用 Perl 而不是 Ruby 或 Python？
A：越来越多的人使用 Perl。Perl 有更多的库（方式更多）。Perl 是一种非常棒的 GTD 语言。

问：为什么人们讨厌 Perl？
A：你可以用它做一些丑陋的事情。记住使用警告；使用严格；在您的所有代码中。您可以在运行之前检查您的代码。 **perl -c** hello.pl

## Perl 主题

### 将 Perl 与数据库一起使用

[http://www.perl.com/pub/a/1999/10/DBI.html](http://www.perl.com/pub/a/1999/10/DBI.html)

### 使用 Perl 进行 Web 开发

[http://www.catalystframework.org](http://www.catalystframework.org)

### 面向对象的 Perl

[http://www.iinteractive.com/moose](http://www.iinteractive.com/moose)

### Perl 1-Liners

[http://www.perlmonks.org/?node_id=470397](http://www.perlmonks.org/?node_id=470397)
[http://sial.org/howto/perl/one-liner](http://sial.org/howto/perl/one-liner)

### 其他教程

[http://perlmonks.org/index.pl?node=Tutorials](http://perlmonks.org/index.pl?node=Tutorials)

## 图书

有几十个。
[http://www.amazon.com/s/ref=nb_ss_gw?url=search-alias%3Dstripbooks&field-keywords=perl&x=0&y=0](http://www.amazon.com/s/ref=nb_ss_gw?url=search-alias%3Dstripbooks&field-keywords=perl&x=0&y=0)

## 网站

[Perlmonks](http://perlmonks.com)
[Perl.org](http://www.perl.org)
[Pleac](http://pleac.sourceforge.net)
[StackOverFlow's Hidden Features of Perl](https://stackoverflow.com/questions/161872/hidden-features-of-perl)
[CPAN FAQ](http://www.cpan.org/misc/cpan-faq.html)
[Randall Schwartz 的文章](http://www.stonehenge.com/merlyn/LinuxMag)

## 获得帮助

[Perl Nabble 论坛](http://www.nabble.com/Perl-f13578.html)
IRC 频道：freenode、irc.perl.org。有几个：

irc://irc.perl.org/perl
irc://irc.perl.org/catalyst
irc://irc.freenode.net/modperl
irc://irc.perl.org/perl6

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-11-26T12:33:19.877

我们为此写了一整本书，名为《[Learning Perl](http://shop.oreilly.com/product/0636920018452.do) 》 。查看目录。

这本书是自 1995 年以来教人们 Perl 的产品。它不适合任何特定的应用程序，而是向人们展示了他们将用于 80% 的 Perl 编程的 Perl 部分。我们为 Perl 5.10 更新了它，并包含了关于使用 CPAN 的部分。

祝你好运， ：）

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-27T05:44:57.343

Perl 有两件事即使对有经验的程序员来说也可能是陌生的，所以也许应该尽早提到这些东西，以免他们尖叫着跑掉。

上下文：Perl 中几乎每个函数都有两种行为。当在“标量上下文”中调用时，它会做一件事，当在“列表上下文”中调用时，它会做其他事情。这可能看起来很奇怪和奇怪（在机器语言中确实如此），但这只是应用于编程语言的“单数”和“复数”的自然语言概念。

变量：Perl 有 2 个完全不同且独立的变量系统。词法变量（my）和包变量（our）。如果您使用过大多数编程语言，那么词法变量是“正常的”。包变量（即动态变量）很奇怪，除非你使用过类似 Lisp 的东西。“总是喜欢词法变量而不是包变量，除非你不能。”

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-26T06:31:27.330

绝对向他们展示在 Perl 中使用正则表达式是多么容易。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-26T06:56:12.693

这基本上是一个面向任务的问题。

如果他们要使用它进行解析，请向他们展示操作 STDIN 和文件 i/o 是多么容易。

如果他们打算将它用于数据库，向他们展示如何从查询结果中获取 hashrefs，这会让他们惊叹不已。

Perl 通常有一些方法可以让几乎任何任务都变得超级快速。选择他们需要做的任务。

但绝对教他们使用我的和本地的。强调我的重要性，这将使他们的经历更快乐。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-26T07:48:22.040

不管是不是有经验的程序员，30 分钟你都不能假装教任何东西，更不用说 Perl。最多你可以尝试用一些很酷的单行代码来启发他（提供他们完全臃肿的 Java 对应物，以供比较）。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-26T13:43:47.863

我会先介绍列表和哈希。（请记住，病态的折衷垃圾列表。）向他展示 foreach 比 C 风格的 for 更漂亮。

如果他来自 C/C++，最好将他推荐给[http://perldoc.perl.org/perltrap.html](http://perldoc.perl.org/perltrap.html)或“perldoc perltrap”。它包含需要注意的最明显的差异。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-11-28T03:55:09.810

只是我的 2c，但关于 CPAN，您如何向他们提出将英文文本分成句子的问题？

起初，这似乎很简单：一个句子是一个以句号结尾的字符串。

但是经过片刻的思考，程序员会发现出现了各种各样的复杂性。如果有小数或缩写，句点可以在中间；句子可以以其他东西结尾，例如“？”，“！” 或者 ”...”; “句号后跟一个空格”也无济于事，因为 EOF 呢？

长话短说，当谈到 Perl 时，其他人已经想到了该列表中的所有内容，甚至更多。所以你使用[Lingua::EN::Sentence](http://search.cpan.org/perldoc?Lingua::EN::Sentence)。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-26T07:11:45.953

如果他是一位经验丰富的程序员，他可能会喜欢[Smart Comments](http://search.cpan.org/~dconway/Smart-Comments-v1.0.3/lib/Smart/Comments.pm)、[POD](http://perldoc.perl.org/perlpod.html)、[闭包](http://www.perl.com/pub/a/2002/05/29/closure.html)、`-d:DProf`switch 和`dprofpp`、one-liners、Perl [Critic](http://search.cpan.org/dist/Perl-Critic/lib/Perl/Critic.pm)、[Moose](http://search.cpan.org/~drolsky/Moose-0.61/lib/Moose.pm)`__DATA__`或[map](http://perldoc.perl.org/functions/map.html)。（这确实是一种疯狂的组合。）我会从一开始就向他解释 Perl 是一种具有很多魔力的语言，但他可以自由选择何时坚持使用简单的代码以及何时使用魔杖。有经验的程序员不怕选择:-)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-11-26T18:13:47.943

我突然想到的想法是让他们将信息从一种格式传输到另一种格式。例如，获取`xml`数据并将其传输到`JSON`，以便在网页上使用。

```
cpan JSON XML::简单

```

```
use strict;
use warnings;

use JSON;
use XML::Simple;

my $data;
{
  open( my $file, '<', 'filename.xml' ) or die;
  $data = XMLin($file);
  close $file;
}
{
  open( my $file, '>', 'filename.json' ) or die;
  print $file to_json( $data );
  close $file;
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-26T16:02:32.310

我同意其他一些评论者的观点，即这确实取决于 Perl 所用于的任务类型。此人是 Windows 系统管理员吗？然后我将介绍使用 Perl 的 WMI（scriptomatic 将是一个很好的资源）。

我会拿一份 Oreilley 的“Perl Cookbook”，并从中找到一些有趣的话题。这是本书的链接：[link text](http://books.google.com/books?id=IzdJIax6J5oC&dq=perl+cookbook&pg=PP1&ots=z6ykdpc8fS&source=bn&sig=wEIaAkHmJttmQUVce18SHcXhYLs&hl=en&sa=X&oi=book_result&resnum=6&ct=result)

在 Perl 中我最喜欢的事情之一是比较列表、查找唯一列表中的联合、交集或差异是多么容易（Perl Cookbook 中的食谱 4.9）。帮助您了解 Perl 的强大功能。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-26T16:19:42.960

这取决于这个“经验丰富的程序员”所经历的编程类型。

如果他们做过很多 shell 编程，他们可能会对 Perl 的超级 awk 个性印象深刻——通过使用正则表达式和模板进行一些实际的提取和报告。

如果他们更像是喜欢使用复杂数据结构的 C 程序员，请向他们展示您可以多么轻松地生成散列哈希，以及生成的代码执行速度有多快。

... 等等。

# asp.net - 为什么 url 重写不起作用？

> ID：319915
> 
> 赞同：2
> 
> 时间：2008-11-26T06:32:31.163
> 
> 标签：asp.net, iis, url, module, rewrite

在 asp.net 3.5 中，我正在重写 url

[http://www.abc.com/archive/1108/harpersdecember](http://www.abc.com/archive/1108/harpersdecember)

到以下

[http://www.abc.com/article.aspx?docId=78](http://www.abc.com/article.aspx?docId=78)

我正在使用这段代码来做到这一点：

```
 Context.RewritePath("/article.aspx?docId=78"); 
```

它在本地运行良好，但是当我上传到远程 Web 服务器时，我在尝试引用上述页面时得到 404。有什么建议为什么它可以在本地工作但不能在远程工作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-26T10:25:27.200

您可能需要在远程服务器上的 IIS 中创建通配符映射，以便所有请求都由 ASP.Net 处理。如果您不这样做，任何最后没有 .ASPX 的 URL 都不会通过您的 URL 重写代码运行。

[在Scott Guthrie 的博客](http://weblogs.asp.net/scottgu/archive/2007/03/04/tip-trick-integrating-asp-net-security-with-classic-asp-and-non-asp-net-urls.aspx)上有一个很好的解释（以及您可能使用它的其他原因）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T10:40:39.230

不是“可能”——你肯定需要创建一个通配符映射。Visual Studio 使用 cassini Web 服务器，它基本上通过 .net 传递所有请求。IIS 仅将特定的映射请求（默认为 .aspx、.asmx 等）转发到 .net - 在 asp.net 中重写 URL 需要添加新映射以首先将请求发送到 asp.net

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-04T18:20:38.677

在我看来，生产服务器没有默认的 aspx 页面，即：default.aspx。如果是这样，它会将请求重新路由到您的处理程序。

验证这一点的简单方法是创建一个目录并在其中放置一个 default.aspx 文件，并尝试仅使用目录名称请求它，即：server.com/newdir/ 如果这给你一个 404，那么你知道肯定的。

# python - 如何使用 django (python) 和 s3 上传文件？

> ID：319923
> 
> 赞同：12
> 
> 时间：2008-11-26T06:39:33.380
> 
> 标签：python, django, file-upload, amazon-s3

我正在寻找一种将文件上传到 s3 的方法。我正在使用 django。我目前正在使用亚马逊的 python 库与以下代码一起上传：

看法：

```
def submitpicture(request):
    fuser = request.session["login"]

    copied_data = request.POST.copy()
    copied_data.update(request.FILES)
    content_type = copied_data['file'].get('content-type')
    ffile = copied_data['file']['content']
    key = '%s-%s' % (fuser, ''.join(copied_data['file']['filename'].split(' ')))
    site_s3.save_s3_data(key, ffile, content_type) 
```

模板：

```
<form action="/submitpicture/" method="POST">
    <input type="file" id="file" name="file" />
    <input type="submit" value="submit" />
</form> 
```

但是，当我实际尝试运行它时，出现以下错误：

```
"Key 'file' not found in <QueryDict: {}>"
#MultiValueDictKeyError 
```

我真的不明白我做错了什么。有人可以指出我正确的方向吗？

编辑：以防万一有人想知道，我计划在实际上传工作后添加一些验证。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-26T06:57:11.210

您必须为 FORM 元素提供 enctype 属性（我以前被这个咬过）。例如，您的 FORM 标记应如下所示：

```
<form action="/submitpicture/" method="POST" enctype="multipart/form-data" > 
```

如果没有 enctype，你会发现自己有一个空的 request.FILES。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-26T07:01:06.817

我不会手动执行此操作，而是看一下 David Larlet 为 Django 编写的存储后端[django- storages](https://django-storages.readthedocs.io/en/latest/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-23T21:34:01.480

添加 enctype="multipart/form-data" 似乎在 django 文档的“文件上传”部分中值得一提（[http://docs.djangoproject.com/en/dev/topics/http/file-uploads/](http://docs.djangoproject.com/en/dev/topics/http/file-uploads/)）。想法？

# word-wrap - 硬包装和软包装的区别？

> ID：319925
> 
> 赞同：116
> 
> 时间：2008-11-26T06:40:24.317
> 
> 标签：word-wrap

我正在编写一个文本编辑器。在查看了其他文本编辑器后，我注意到其中一些是指“软”与“硬”换行。有什么不同？我似乎无法通过搜索找到答案。

* * *

## 回答 #1

> 赞同：159
> 
> 时间：2008-11-26T06:46:38.780

硬换行在文本中的换行点处插入实际换行符，而软换行实际文本仍在同一行上，但看起来它被分成几行。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-11-26T07:41:44.893

文本编辑器通常会将文本自动换行到带有硬换行符的段落中，但如果您稍后返回并稍后编辑/添加/删除单词，则文本重新排列成一个不错的段落的情况不太常见。（您可以使用 Mq 在 emacs 中手动执行此操作。）

这很烦人，因为像我这样的强迫症患者然后回去必须在适当的点手动重新插入硬中断。

另一方面，软包装很烦人，因为大多数命令行工具都使用基于行的差异（版本控制是我最注意到的地方）。如果您有一个 1/3 页的软包装段落并修复了错字，则基本上不可能在常规`diff`输出或类似输出中看到更改的位置。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2015-06-20T05:53:11.213

**soft** : textarea 中的文本在表单中提交时不换行。这是默认的

**hard** : textarea 中的文本在表单中提交时被换行（包含换行符）。使用“hard”时，必须指定 cols 属性

[参考：W3Schools](http://www.w3schools.com/tags/att_textarea_wrap.asp)

# java - 使用jsf连接数据库

> ID：319936
> 
> 赞同：2
> 
> 时间：2008-11-26T06:49:37.370
> 
> 标签：java, mysql, database, maven-2

如何使用 JSF 连接到连接 bean 中的数据库（MYSQL）以检索其内容。另外请让我知道如何配置 web.xml 文件？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-10T09:33:46.567

要连接到 mysql：

```
public void open() {
        try {
            String databaseName = "custom";
            String userName = "root";
            String password = "welcome";

            // 
            String url = "jdbc:mysql://localhost/" + databaseName;

            Class.forName("com.mysql.jdbc.Driver").newInstance();
            connection = DriverManager.getConnection(url, userName, password);
        } catch (Exception e) {
            System.out.println("Not able to connect");
        }
    } 
```

在这种情况下，web.xml 中没有任何更改。但是您可以在 pom.xml 中添加它

```
 <dependency>
            <groupId>groupId = mysql</groupId>

            <artifactId>mysql-connector-java</artifactId>
            <version>5.1.6</version>
</dependency> 
```

这是成功的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T09:00:12.880

这是一个关于如何以最佳方式将 DAO 与 JSF 一起使用的非常好的教程：

[http://balusc.blogspot.com/2008/07/dao-tutorial-use-in-jsf.html](http://balusc.blogspot.com/2008/07/dao-tutorial-use-in-jsf.html)

如果您使用的是 JSF，那么该网站可能是寻找常见问题解决方案的好地方。有伟大而完整的例子。

无论如何，JSF 是一个管理视图和控制器层的框架。对于模型层和对数据库的访问，如果您使用 JSF 或管理应用程序的视图/控制器部分的任何其他 Java Web 框架，则没有太大区别。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T07:29:32.453

这是一个[使用 Hibernate 和 HSQL 的示例](http://blog.exadel.com/?p=8)- 但是将 db 内容分离出来的基本思想应该是有效的，并且它包括一个配置的 web.xml。

# vb6 - VB6中ssOption控件的问题：文本背景颜色从Win 98变为Win XP

> ID：319946
> 
> 赞同：1
> 
> 时间：2008-11-26T07:00:16.163
> 
> 标签：vb6

我在 VB6 中使用 ssOption 控件（Sheridan 3d Option 控件）。

在 Windows 98 中，文本区域的背景颜色与选项圈周围的背景颜色相同，并且该颜色是默认的表单颜色。所以选项按钮看起来是透明的。

没有背景颜色属性，并且在 Windows XP 上，文本区域的背景颜色与选项圈周围的背景颜色不同。

关于为什么会发生这种情况的任何想法？该控件的包装器位于 Threed32.ocx 中，我在 Win98 和 WinXP 系统的 Windows\system32 目录中都有相同的版本。

1.  为什么它在 98 和 XP 上的表现可能不同？
2.  关于修复的任何想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-26T13:14:27.890

SSOption 将其背景设置为 Windows XP 上的 Windows 按钮面。这与您制作新表单时获得的背景相同。如果您想在多色表格上使用它，您将需要使用具有按钮面背景的框架或其他类型的外壳。否则使用 VB6 的选项按钮。

SSOption 的优点是能够以 3D 凸起或嵌入格式显示其文本。这实际上只有使用默认按钮面颜色才能很好地工作，这就是为什么它被硬编码到控件中。It also has better formatting of the text when the option button is to the right of the text.

如果您不能使用封闭框架或面板，那么您有一个乏味的选择。您可以制作一个没有文本的 VB6 选项。如果您使用的是 3D 字体。然后你可以使用两个标签来达到同样的效果。将底部设为白色（或顶部取决于凸起与插入）并偏移 1 个像素或 15 个缇。

如果您将 VB6 作为 Visual Studio 6 包的一部分安装，则可以使用 ZoomIn 工具来确保它是正确的。

如果您将其用于对齐。然后，您可以调整 VB6 本机选项控件的宽度，直到它看起来正确，或者使选项不带文本并使用标签。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T10:27:08.023

Threed32.ocx 是古老的——它是为 VB4 设计的。我会用内置的 VB6 选项控件替换它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-04T16:26:56.983

亚历克斯是对的。Threed32.ocx 很旧并且有很多问题。它[在 Vista 上不受支持](http://msdn.microsoft.com/en-us/vbrun/ms788708.aspx)，[当它可见时它会抓住焦点](http://support.microsoft.com/kb/172673)，很难升级到 VB.NET - 还有更多。对于我的公司来说，这些功能强大到足以胜过它提供的额外功能——我们正在从我们所有的程序中删除它。

# arm - OMAP SPI 控制器

> ID：319948
> 
> 赞同：1
> 
> 时间：2008-11-26T07:04:16.843
> 
> 标签：arm, spi, omap

有没有人开发过一些应用程序来控制 OMAP3 上的 spi 设备？我可以加载 spi 驱动程序“mcspi”，但我不知道如何使用它。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-07-26T01:10:25.703

至少从**PSP 3.00.00.04 开始**，mcspi 驱动程序与 Linux spi 堆栈集成。

打开

> CONFIG_SPI 和 CONFIG_SPI_OMAP24XX

在你的内核中。

[以下是一般如何使用 spi 设备的方法。](http://www.mjmwired.net/kernel/Documentation/spi/spi-summary)

还有 spidev 驱动程序，它向用户空间提供一个 char 设备，但它是实验性的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-31T01:01:16.963

好的，所以首先我需要为我之前从时髦的回答中拍摄的照片道歉。

我现在也开始考虑尝试让 McSPI 正常工作，这有点痛苦。TI 没有很多文档，而且我还没有成功地让任何 McSPI 实际工作。但我想我会发布一个链接到 beagle board google 关于这个主题的讨论，因为看起来他们已经成功地让至少 McSPI3 在 OMAP3530 上工作。

[http://groups.google.com/group/beagleboard/browse_thread/thread/15d9488c1ec314ef/5ca06c67ff438106?q=mcspi3#5ca06c67ff438106](http://groups.google.com/group/beagleboard/browse_thread/thread/15d9488c1ec314ef/5ca06c67ff438106?q=mcspi3#5ca06c67ff438106)

# ms-access - 在 ms-access 中创建数据库，然后删除特定数据库。使用任何 vb 查询或 vb 代码

> ID：319950
> 
> 赞同：0
> 
> 时间：2008-11-26T07:07:27.367
> 
> 标签：ms-access, vba

我想使用代码或 ms-access 的任何选项在 ms-access 中创建多个数据库，但我也想删除数据库。请帮我

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-26T11:17:58.983

您可以有一个名为“db1.mdb”的空数据库，然后将此代码添加**到另一个**Access 数据库的模块中：

```
 Set fso = CreateObject("scripting.filesystemobject")
  fso.CopyFile "c:\db.mdb", "c:\db_copy1.mdb", True
  fso.CopyFile "c:\db.mdb", "c:\db_copy2.mdb", True
  fso.CopyFile "c:\db.mdb", "c:\db_copy3.mdb", True
  fso.DeleteFile "c:\db.mdb" 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T20:06:36.247

从 Access 界面创建**Access数据库：**

```
createDatabase "myNewMDB.mdb", dbLangGeneral 
```

要删除数据库：

```
kill "myNewMDB.mdb" 
```

它无需初始 mdb 文件或额外的 dll 即可工作

对于多个数据库

```
public Function createDeleteDatabase(howManyDatabases as integer) as boolean

''output is by default False
createDeleteDatabase = False

on error goto createDeleteDatabase_Error

Dim i as integer
For i = 1 to howManyDatabases
    createDatabase "myMDBNumber_" & str(i,0) & ".mdb", dbLangGeneral
Next i
For i = 1 to howManyDatabases
    kill "myMDBNumber_" & str(i,0) & ".mdb"
Next i

''if no errors in the fonction, set the output to True
createDeleteDatabase = True

Exit function
createDeleteDatabase_Error:
'' your error treatment
End function 
```

# entity-framework - 从 objectcontext.Connection.ConnectionString 获取连接字符串的问题

> ID：319954
> 
> 赞同：0
> 
> 时间：2008-11-26T07:09:32.480
> 
> 标签：entity-framework, .net-3.5

如果你能问我的问题，我真的很感激。在我的实体框架上下文中调用 myObjectContext.myEntitySet.ToList() 方法后，myObjectContext.Connection.ConnectionString 中连接字符串的密码部分消失了。这是一个错误吗？非常感谢您的帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-26T07:44:24.827

这是设计使然。密码被删除以保护您。如果您真的想保留密码，您可以在连接字符串中添加以下内容：`Persist Security Info=True;`

那么你的连接字符串应该是这样的：

```
Data Source=server;Initial Catalog=database;User ID=user;Password=password;Persist Security Info=True; 
```

请注意，这是一个安全风险。如果您的数据库服务器支持 Windows 身份验证，您应该使用它。那么您的连接字符串将如下所示：

```
Data Source=server;Initial Catalog=database;Integrated Security=True 
```

如您所见，此连接字符串不包含用户名或密码。而是使用您的 Windows 用户名和密码。如果可以的话，你应该使用它而不是前者。

# c# - 如何解决 .NET CF 异常“找不到 PInvoke DLL”？

> ID：319958
> 
> 赞同：6
> 
> 时间：2008-11-26T07:14:59.333
> 
> 标签：c#, .net, windows-mobile, pinvoke

这是给所有 C# 大师的。我已经为此苦苦挣扎了一段时间，在网上尝试了各种建议，但无济于事。该操作发生在 Windows Mobile 5.0 中。

我有一个名为 MyDll.dll 的 DLL。在 MyDll.h 我有：

```
extern "C" __declspec(dllexport) int MyDllFunction(int one, int two); 
```

MyDll.cpp中MyDllFunction的定义是：

```
int MyDllFunction(int one, int two)
{
    return one + two;
} 
```

C# 类包含以下声明：

```
[DllImport("MyDll.dll")]
extern public static int MyDllFunction(int one, int two); 
```

在同一个类中，我通过以下方式调用 MyDllFunction：

```
int res = MyDllFunction(10, 10); 
```

这就是该死的东西不断给我“找不到 PInvoke DLL 'MyDll.dll'”的地方。我已经验证我实际上可以在系统调用上执行 PInvoke，例如“GetAsyncKeyState(1)”，声明为：

```
 [DllImport("coredll.dll")]
    protected static extern short GetAsyncKeyState(int vKey); 
```

MyDll.dll 与可执行文件位于同一文件夹中，我也尝试将其放入 /Windows 文件夹中，没有任何更改也没有成功。非常感谢任何建议或解决方案。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-06T11:14:39.597

我有同样的问题，但是这次涉及的平台没有明显的区别。为什么它应该是“正常”的东西被记录得如此糟糕，如此困难，最糟糕的是如此“片状”。是否有任何工具可以让我进入我的 PPC 模拟器，并逐步检查 (a) dll 是否在 CLR 期望的位置（我已将它放在同一个目录和模拟器上的 windows 目录中 - 我可以看到它在那里使用模拟器文件资源管理器），（b）CLR可以加载它（有足够的内存等），（c）CLR可以找到存在的功能（如果我能超越愚蠢的'can '找不到 dll' 错误）

我很想强迫盖茨或任何“windows mobile”团队使用他们创造的废话。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T08:27:32.663

也许这似乎是一件显而易见的事情，但您是否正在为正确的 CPU 架构编译本机 DLL？IIRC，Windows Mobile 在多个 CPU 架构上运行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T07:55:38.267

您列出的异常和您在问题中输入的 pinvoke 签名具有不同的名称：分别为 MyDll.dll 和 ThreadBenchLib.dll。那是错字还是问题？

如果不是问题，请尝试在[依赖](http://www.dependencywalker.com/)中打开 DLL 。由于未满足的依赖关系，DLL 加载可能会失败。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-04-25T21:44:53.680

我有同样的问题。我使用 Depends.exe 来查找 WinCE dll 依赖项，它取决于调试 dll。(MSVCR90D.dll) 为了解决这个问题，我编译了一个发布版本，并确认了依赖关系，之后它就可以正常工作了。

我希望能有所帮助

# .net - 疑难解答：通过 Word 代码隐藏调用自定义代码时找不到引用的非托管 dll

> ID：319964
> 
> 赞同：0
> 
> 时间：2008-11-26T07:20:22.940
> 
> 标签：.net, ms-word, vsto, office-2007, assembly-resolution

语境：

1.  我有一个 WPF 应用程序，它使用 D:\WordAutomation\MyApp_Source\Executables\MyApp 文件夹中的某些非托管 DLL。我可以双击 exe 并运行一切。
2.  接下来我有一个 Word 2007 代码隐藏项目，它引用上述文件夹中的相关托管 DLL 并尝试做同样的事情.. 调出 App UI。经过充分的'macheting'后，我的用户界面就会显示出来。但是现在有一个用户操作强制加载一个非托管 dll，该 dll 与 FileNotFoundException 一致地爆炸（没有帮助/指示哪个文件丢失）

我在问题行放置了一个断点，清除了输出窗口，按 F10，在我运行该行时比较了输出（将对象添加到 ObservableCollection，其 CollectionChanged 处理程序具有加载非托管片段的代码）

*案例1：双击EXE..完美运行（略剪）*

```
'MyApp.DesktopApp.exe': Loaded 'D:\WordAutomation\MyApp_Source\Executables\MyApp\ManagedFrameworkWrapper.dll', Symbols loaded.
'MyApp.DesktopApp.exe': Loaded 'D:\WordAutomation\MyApp_Source\Executables\MyApp\Unmanaged.Framework.dll'
'MyApp.DesktopApp.exe': Loaded 'C:\WINDOWS\WinSxS\x86_Microsoft.VC90.DebugCRT_1fc8b3b9a1e18e3b_9.0.21022.8_x-ww_597c3456\msvcr90d.dll', Symbols loaded.
'MyApp.DesktopApp.exe': Loaded 'C:\WINDOWS\WinSxS\x86_Microsoft.VC90.DebugCRT_1fc8b3b9a1e18e3b_9.0.21022.8_x-ww_597c3456\msvcp90d.dll', Symbols loaded.
'MyApp.DesktopApp.exe': Loaded 'C:\WINDOWS\WinSxS\x86_Microsoft.VC90.DebugMFC_1fc8b3b9a1e18e3b_9.0.21022.8_x-ww_2a62a75b\mfc90ud.dll', Symbols loaded.
'MyApp.DesktopApp.exe': Loaded 'C:\WINDOWS\system32\msimg32.dll'
'MyApp.DesktopApp.exe': Loaded 'D:\WordAutomation\MyApp_Source\Executables\MyApp\HelperFunctions.dll'
'MyApp.DesktopApp.exe': Loaded 'C:\WINDOWS\system32\dbghelp.dll'
'MyApp.DesktopApp.exe': Loaded 'C:\WINDOWS\WinSxS\x86_Microsoft.VC90.DebugCRT_1fc8b3b9a1e18e3b_9.0.21022.8_x-ww_597c3456\msvcm90d.dll', Symbols loaded.
'MyApp.DesktopApp.exe': Loaded 'C:\WINDOWS\WinSxS\x86_Microsoft.VC90.MFCLOC_1fc8b3b9a1e18e3b_9.0.21022.8_x-ww_11f3ea3a\mfc90enu.dll', Binary was not built with debug information.
CCollectionDataType ConstCCollectionDataType ConstCCollectionDataType ConstCCollectionDataType ConstCCollectionDataType ConstCCollectionDataType Const'MyApp.DesktopApp.exe' (Managed): Loaded 'D:\WordAutomation\MyApp_Source\Executables\MyApp\ManagedFrameworkWrapper.dll', Symbols loaded.
'MyApp.DesktopApp.exe' (Managed): Loaded 'C:\WINDOWS\WinSxS\x86_Microsoft.VC90.DebugCRT_1fc8b3b9a1e18e3b_9.0.21022.8_x-ww_597c3456\msvcm90d.dll', Symbols loaded.
The thread 'Win32 Thread' (0x12ec) has exited with code 0 (0x0). 
```

案例 2：运行同一行，但从 Word 代码隐藏 .cs 文件中启动

```
A first chance exception of type 'System.IO.FileNotFoundException' occurred in WindowsBase.dll
The program '[5320] WINWORD.EXE: Managed' has exited with code 0 (0x0). 
```

我试过了

*   将非托管 DLL 添加到与（word doc+VSTO dll）**相同的文件夹中**
*   将文件夹添加到**PATH 环境变量**。还是一样。
*   任何我能想到的......在过去的几天里

我注意到 Word 似乎正在将托管 ref 程序集复制到如下片段所示的位置。这可能是一个调查线。但是为什么 word 这样做以及它如何解决非托管 DLL .. 我不知道。同样在第一个片段中，有一些从 WinSXS 路径加载的 DLL，这也可能是另一个线索。

```
'WINWORD.EXE' (Managed): Loaded 'C:\Documents and Settings\pillaigi\Local Settings\Application Data\assembly\dl3\6HQYB5GK.LY0\KC4WN109.HT4\4d81c901\70abeb86_124ec901\MyWPFPlotPopup.DLL', Symbols loaded. 
```

终于优雅地关闭了……救命！！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T10:06:12.310

要找出导致问题的 dll 以及正在查找 dll 的位置，请使用 ProcessMon（来自 sysinternals）。

在这里查看我的答案： [参考答案](https://stackoverflow.com/questions/230715/mixed-mode-library-and-crt-dependencies-help#260349)

# vim - Vim 作为 Visual Studio IDE

> ID：319965
> 
> 赞同：15
> 
> 时间：2008-11-26T07:20:50.083
> 
> 标签：vim

我花了很多时间研究 VIM。自从过去 6 年以来，我一直是 Windows 人，并且一直在使用 VS。现在开始在 Linux 上工作。我想让 VIM 尽可能接近 VS。我想要在项目自动完成中搜索不同选项卡中的项目导航文件等功能

我找到了满足上述要求的插件 Project Pligin MiniExplore Taglist OmniComplete

我无法正确设置 vimrc 脚本。当我尝试从 Project 打开文件时，它会在不同的选项卡中打开。我想让它在不同的缓冲区中打开。此外，当我想关闭缓冲区中的文件时，完整的窗口会关闭。打开 taglist 和项目窗口让一切变得一团糟。

有没有人用这些插件做过设置.. 你们可以发布你的 vimrc 文件吗？这将为像我这样的新手节省很多时间。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-11-26T07:53:52.170

Vim 是一个与 Visual Studio 非常不同的工具。插件可能会帮助您获得您想要的某些功能，但不要期望它们完全像 VS 一样工作，可以很好地协同工作，甚至根本无法工作。

如果您正在寻找更像 Visual Studio 的编程环境，您可以使用许多优秀的图形 IDE，例如 NetBeans、Eclipse、Code::Blocks、KDevelop、Anjuta 等。恕我直言，其中一些工具是更好的重量级 IDE比 Visual Studio，而且都可以在 Linux 上免费使用。

您应该学习使用 Vim 的构建方式，或者找到更适合您的不同工具。将 Vim 硬塞到 Visual Studio 的替代品中可能会给您带来更多的痛苦，而不是它的价值。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-11-26T09:15:19.870

是的，它与 VS 不同，但这并不意味着它不能以相同的方式使用。做到这一点并不容易:)

就我个人而言，我采取了另一种方式，使用[ViEmu](http://www.viemu.com/)让 VS 表现得像 VIM。但我和这个问题的作者的情况不同。

为什么不在[dotfiles.org 上浏览一些上传的 vimrc 文件](http://dotfiles.org/search?q=vimrc)呢？

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-05-15T08:41:32.833

您可以使用以下脚本 Trinity。
[http://www.vim.org/scripts/script.php?script_id=2347](http://www.vim.org/scripts/script.php?script_id=2347)
这将需要 3 个以上的脚本，而 Vim 看起来就像一个 IDE。左侧是 TagList，右侧是文件导出器 (NERDTree)，底部是 Source Explorer。

[此外，您可以在http://kevin-berridge.blogspot.com/search/label/vim](http://kevin-berridge.blogspot.com/search/label/vim)找到一些非常有用的博客条目
。作者 Kevin 解释了如何在 Vim 中编译解决方案。他还展示了它们之间的接口和跳转，这也非常有用。

此外，还有脚本 vim-visual-studio 可以在
[http://code.google.com/p/vim-visual-studio/](http://code.google.com/p/vim-visual-studio/)找到 该脚本使用 Python 扩展。我在 Windows 中安装了 Python 2.5。我正在使用用 Python 2.4 编译的 Gvim 7.2。所以，我已经替换了 Gvim 的可执行文件，如下所述：
[http](http://www.gooli.org/blog/gvim-72-with-python-2526-support-windows-binaries/)
://www.gooli.org/blog/gvim-72-with-python-2526-support-windows-binaries/ 所以，Gvim 与 Python 2.5 和没有提出任何问题。此外，菜单项“Visual Studio”已按预期出现。它连接到 Visual Studio 本身，并且运行良好。它不仅编译文件，还可以编译包含多个项目的解决方案，就像在 Visual Studio 中一样。你甚至可以使用 Vim 的 'quickfix' 特性。希望这可以帮助。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-26T09:13:33.320

如果您真的想将 vim 作为前端，请尝试[Eclim](http://eclim.sourceforge.net)。它使用 Eclipse 作为代码完成和项目管理的后端守护程序，并使用 vim 作为接口。

如果您只是因为 vi 键绑定而喜欢 vim，但希望它更像 IDE，您可以尝试内置它的最新[MonoDevelop 。](http://mjhutchinson.com/journal/2008/10/14/vi_modes_monodevelop)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-26T10:59:56.477

这些插件早在 vim 有选项卡之前就已经存在了。我会很惊讶没有办法调整这些插件来拆分窗口而不是打开标签。现在我帮不了你太多，因为我不使用这些特定的插件，而是使用其他插件。您应该查看他们的帮助（:h project、:h taglist 等）

PS：在vim术语中（它会帮助你浏览帮助文件），你所说的“缓冲区”实际上称为“窗口”，而“缓冲区”只是你正在处理的文本，它可能与文件相关联， 或不。对于给定的缓冲区，可能没有或有几个窗口显示缓冲区的一部分。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-06-27T13:16:58.120

你可以试试 eXvim [http://code.google.com/p/exvim/](http://code.google.com/p/exvim/)

# c# - 如何在 C# 中获取列表的前 N 个元素？

> ID：319973
> 
> 赞同：476
> 
> 时间：2008-11-26T07:26:46.733
> 
> 标签：c#

我想在我的项目中使用 Linq 查询公交时刻表，以便随时可以获取接下来的 5 趟公交车到达时间。如何将查询限制为前 5 个结果？

更一般地说，如何在 C# 中获取列表的一部分？（在 Python 中，我会使用它`mylist[:5]`来获取前 5 个元素。）

* * *

## 回答 #1

> 赞同：867
> 
> 时间：2008-11-26T07:28:02.690

```
var firstFiveItems = myList.Take(5); 
```

或切片：

```
var secondFiveItems = myList.Skip(5).Take(5); 
```

当然，根据某种顺序获取前五个项目通常很方便：

```
var firstFiveArrivals = myList.OrderBy(i => i.ArrivalTime).Take(5); 
```

* * *

## 回答 #2

> 赞同：75
> 
> 时间：2008-11-26T08:27:45.893

如果有人感兴趣（即使问题没有要求这个版本），在 C# 2 中将是：（我已经编辑了答案，遵循了一些建议）

```
myList.Sort(CLASS_FOR_COMPARER);
List<string> fiveElements = myList.GetRange(0, 5); 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2018-06-18T13:21:58.100

就像`pagination`您可以使用以下公式一样`slice of list or elements`：

```
var slice = myList.Skip((pageNumber - 1) * pageSize)
                  .Take(pageSize); 
```

示例 1：前五项

```
var pageNumber = 1;
var pageSize = 5; 
```

例二：后五项

```
var pageNumber = 2;
var pageSize = 5; 
```

例3：第三五项

```
var pageNumber = 3;
var pageSize = 5; 
```

> 如果注意到公式参数正在变化`pageSize = 5`，`pageNumber`如果要更改切片中的项目数，请更改`pageSize`。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-26T08:42:34.787

要获取前 5 个元素，最好使用如下表达式：

`var firstFiveArrivals = myList.Where([EXPRESSION]).Take(5);`

或者

`var firstFiveArrivals = myList.Where([EXPRESSION]).Take(5).OrderBy([ORDER EXPR]);`

它会比 orderBy 变体更快，因为 LINQ 引擎由于执行延迟而不会扫描所有列表，并且不会对所有数组进行排序。

```
class MyList : IEnumerable<int>
{

    int maxCount = 0;

    public int RequestCount
    {
        get;
        private set;
    }
    public MyList(int maxCount)
    {
        this.maxCount = maxCount;
    }
    public void Reset()
    {
        RequestCount = 0;
    }
    #region IEnumerable<int> Members

    public IEnumerator<int> GetEnumerator()
    {
        int i = 0;
        while (i < maxCount)
        {
            RequestCount++;
            yield return i++;
        }
    }

    #endregion

    #region IEnumerable Members

    System.Collections.IEnumerator System.Collections.IEnumerable.GetEnumerator()
    {
        throw new NotImplementedException();
    }

    #endregion
}
class Program
{
    static void Main(string[] args)
    {
        var list = new MyList(15);
        list.Take(5).ToArray();
        Console.WriteLine(list.RequestCount); // 5;

        list.Reset();
        list.OrderBy(q => q).Take(5).ToArray();
        Console.WriteLine(list.RequestCount); // 15;

        list.Reset();
        list.Where(q => (q & 1) == 0).Take(5).ToArray();
        Console.WriteLine(list.RequestCount); // 9; (first 5 odd)

        list.Reset();
        list.Where(q => (q & 1) == 0).Take(5).OrderBy(q => q).ToArray();
        Console.WriteLine(list.RequestCount); // 9; (first 5 odd)
    }
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2021-02-19T23:32:11.110

```
 dataGridView1.DataSource = (from S in EE.Stagaire
                                    join F in EE.Filiere on
                                    S.IdFiliere equals F.IdFiliere
                                    where S.Nom.StartsWith("A")
                                    select new
                                    {
                                        ID=S.Id,
                                        Name = S.Nom,
                                        Prénon= S.Prenon,
                                        Email=S.Email,
                                        MoteDePass=S.MoteDePass,
                                        Filiere = F.Filiere1
                                    }).Take(1).ToList(); 
```

# sql-server - 与外部程序通信的数据库触发器

> ID：319987
> 
> 赞同：2
> 
> 时间：2008-11-26T07:33:13.350
> 
> 标签：sql-server, visual-c++, odbc

我有一个 SQLServer 数据库和一个在该数据库上配置数据的应用程序 (.NET)。另一方面，我有一个应用程序 (VC++) 从数据库中读取数据，并且必须尽快“通知”数据库中保存的数据的任何更改。

当第一个应用程序更改了某些数据时，我想从数据库引擎接收信号。当然，我可以编写某种消息来传达这两个应用程序，但我的问题是 SQLServer 或任何用于访问 SQLServer 的 API（本机、OLE DB、甚至是 ODBC）

PS：为我的英语道歉

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-26T07:56:24.927

如果您的要求包括保证交付（例如没有丢失事件） - 您可能需要考虑基于 MSMQ 的策略。

从 Microsoft SQL Server 访问 MSMQ

[http://www.codeproject.com/KB/database/SqlMSMQ.aspx](http://www.codeproject.com/KB/database/SqlMSMQ.aspx)

Microsoft 支持知识库文章：555070 从 SQL Server 向 MSMQ 发布消息

[http://support.microsoft.com/kb/555070](http://support.microsoft.com/kb/555070)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T07:45:11.627

您可以使用 SQL 代理作业，该作业将通知使用 sp_start_job 启动它的其他应用程序。看看[这个](http://www.windows-tech.info/15/830e5ff5a0c026bf.php)。

# c# - 十六进制表示法和有符号整数

> ID：319993
> 
> 赞同：11
> 
> 时间：2008-11-26T07:40:01.183
> 
> 标签：c#, types, hex

这是一个[后续问题](https://stackoverflow.com/questions/319199/why-is-java-able-to-store-0xff000000-as-an-int)。因此，Java 将整数存储在[二进制补码中](http://en.wikipedia.org/wiki/Two%27s_complement)，您可以执行以下操作：

```
int ALPHA_MASK = 0xff000000; 
```

在 C# 中，这需要使用无符号整数`uint`，因为它将其解释为`4278190080`而不是`-16777216`.

我的问题是，如何在 c# 中以十六进制表示法声明负值，以及整数在内部究竟是如何表示的？这里与 Java 有什么区别？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-11-26T07:47:36.973

C#（更确切地说，.NET）也使用二进制补码，但它同时支持有符号和无符号类型（Java 不支持）。位掩码更自然地是无符号的东西 - 为什么一个位应该与所有其他位不同？

在这种特定情况下，使用未经检查的强制转换是安全的：

```
int ALPHA_MASK = unchecked((int)0xFF000000); 
```

要“直接”将此数字表示为有符号值，请编写

```
int ALPHA_MASK = -0x1000000; // == -16777216 
```

十六进制与十进制没有（或不应该）有任何不同：要表示负数，您需要写一个负号，后跟代表绝对值的数字。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-26T07:52:15.137

好吧，您可以使用未经检查的块和强制转换：

```
unchecked
{
    int ALPHA_MASK = (int)0xff000000;
} 
```

或者

```
int ALPHA_MASK = unchecked((int)0xff000000); 
```

虽然不是很方便......也许只是使用文字整数？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-19T21:04:59.063

只是为了增加对伤害的侮辱，这也将起作用：

```
-0x7F000000 
```****