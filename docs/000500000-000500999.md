# StackOverflow 问答 000500000-000500999

# c# - C 风格语言中匿名 { } 块的目的是什么？

> ID：500006
> 
> 赞同：44
> 
> 时间：2009-02-01T01:48:27.147
> 
> 标签：c#, c++, c

C 风格语言（C、C++、C#）中匿名 { } 块的用途是什么

例子 -

```
 void function()
{

  {
    int i = 0;
    i = i + 1;
  }

  {
    int k = 0;
    k = k + 1;
  }

} 
```

**编辑**- 感谢所有优秀的答案！

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2009-02-01T01:50:43.727

它将变量的范围限制在 { } 内的块中。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-02-01T01:53:25.343

括号指定一个范围区域——括号内声明的任何内容在括号外都是不可见的。

此外，在 C++ 中，分配在堆栈上的对象（例如，不使用“new”）将在超出范围时被破坏。

在某些情况下，它也可以是一种突出显示作者认为值得查看源代码的人关注的特定功能部分的方法。这是否是一个好的用途是有争议的，但我已经看到它完成了。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-02-01T01:57:33.103

它们通常用于[RAII](http://en.wikipedia.org/wiki/Resource_acquisition_is_initialization)目的，这意味着当对象超出范围时，将释放给定的资源。例如：

```
void function()
{
    {
        std::ofstream out( "file.txt" );
        out << "some data\n";
    }
    // You can be sure that "out" is closed here
} 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-01T01:54:52.080

> *`{ ... }`开辟了一个新的范围*

在 C++ 中，您可以像这样使用它们：

```
void function() {
    // ...
    {
        // lock some mutex.
        mutex_locker lock(m_mutex);
        // ...
    }
    // ...
} 
```

一旦控制离开块，互斥锁就被破坏了。在它的析构函数中，它会自动解锁它所连接的互斥锁。这通常被称为 RAII（资源获取是初始化）和 SBRM（范围绑定资源管理）。另一个常见的应用是分配内存，然后在析构函数中再次释放该内存。

另一个目的是做几件类似的事情：

```
void function() {
    // set up timer A
    {
        int config = get_config(TIMER_A);
        // ... 
    } 

    // set up timer B
    {
        int config = get_config(TIMER_B);
        // ...
    } 
} 
```

它将把事情分开，这样人们就可以很容易地找出不同的构建块。您可以使用具有相同名称的变量，就像上面的代码一样，因为它们在其范围之外是不可见的，因此它们不会相互冲突。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-02-01T03:00:36.863

通过创建一个新范围，它们可用于在 switch 语句中定义局部变量。

例如

```
switch (i)
{
    case 0 :
        int j = 0;   // error!
        break; 
```

对比

```
switch (i)
{
    case 0 :
    {
        int j = 0;   // ok!
    }
    break; 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-02-01T04:10:52.460

另一个常见用途是使用 OpenGL`glPushMatrix()`和`glPopMatrix()`函数来创建与矩阵堆栈相关的逻辑块：

```
glPushMatrix();
{
    glTranslate(...);
    glPushMatrix();
    {
        glRotate(...);
        // draw some stuff
    }
    glPopMatrix();
    // maybe draw some more stuff
}
glPopMatrix(); 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-02-01T02:02:27.760

```
class ExpensiveObject {
public:
    ExpensiveObject() {
        // acquire a resource
    }
    ~ExpensiveObject() {
        // release the resource
    }
}

int main() {
    // some initial processing
    {
        ExpensiveObject obj;
        // do some expensive stuff with the obj
    } // don't worry, the variable's scope ended, so the destructor was called, and the resources were released
    // some final processing
} 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-02-01T08:20:50.163

当然范围。（那匹马被打死了吗？）

但是，如果您查看语言定义，您会看到如下模式：

*   **if** **(** *表达式* **)**   *语句*
*   **if** **(** *表达式* **)**   *语句*   **else**   *语句*
*   **switch** **(** *表达式* **)**   *语句*
*   **while** **(** *表达式* **)**   *语句*
*   **do**   *语句*   **while** **(** *表达式* **)** **;**

它简化了*复合语句*只是几种可能*语句*之一的语言语法。

* * *

*复合语句*：   **{** *语句列表[选择]* **}**

*声明列表*：

*   *陈述*
*   *语句列表*   *语句*

*声明*：

*   *标记语句*
*   *表达式语句*
*   ***复合语句***
*   *选择陈述*
*   *迭代语句*
*   *跳转语句*
*   *声明-声明*
*   *尝试块*

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-02-01T01:51:20.497

它们经常用于范围变量，因此变量对于由大括号定义的任意块是局部的。在您的示例中，变量 i 和 k 在它们的大括号之外无法访问，因此它们不能以任何偷偷摸摸的方式进行修改，并且这些变量名称可以在代码的其他地方重用。像这样使用大括号创建局部范围的另一个好处是，在具有垃圾收集的语言中，垃圾收集器知道清理范围外的变量是安全的。这在 C/C++ 中不可用，但我相信它应该在 C# 中。

一种简单的思考方式是，大括号定义了一段原子代码，有点像命名空间、函数或方法，但不必实际创建命名空间、函数或方法。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-02-01T01:56:09.783

你正在做两件事。

1.  您正在对该块中的变量施加范围限制。
2.  您正在启用同级代码块以使用相同的变量名称。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-02-01T01:51:05.817

据我了解，它们只是用于范围界定。它们允许您在父/兄弟范围内重用变量名，这有时会很有用。

编辑：这个问题实际上已经在[另一个 Stack Overflow question](https://stackoverflow.com/questions/85282/what-is-the-value-of-an-anonymous-unattached-block-in-c)上得到了回答。希望有帮助。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-02-01T01:58:04.040

正如之前的海报所提到的，它将变量的使用限制在声明它的范围内。

在 C# 和 Java 等垃圾收集语言中，它还允许垃圾收集器回收范围内使用的任何变量使用的内存（尽管将变量设置为 null 会产生相同的效果）。

```
{
    int[] myArray = new int[1000];
    ... // Do some work
}
// The garbage collector can now reclaim the memory used by myArray 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-02-01T01:57:26.833

它是关于范围的，它是指程序的一个部分中的变量和方法对该程序的另一部分的可见性，考虑这个例子：

```
int a=25;
int b=30;
{ //at this point, a=25, b=30
     a*=2; //a=50, b=30
     b /= 2; //a=50,b=15
     int a = b*b; //a=225,b=15  <--- this new a it's
                  //                 declared on the inner scope
}
//a = 50, b = 15 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-02-01T02:07:03.053

如果您仅限于 ANSI C，那么它们可用于声明更接近您使用它们的位置的变量：

```
int main() {
    /* Blah blah blah. */
    {
        int i;
        for (i = 0; i < 10; ++i) {
        }
    }
} 
```

但是，对于现代 C 编译器来说不是必需的。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2010-11-09T13:01:59.503

一个有用的用例 ihmo 是**在 C++ 中定义临界区**。例如：

```
int MyClass::foo()
{    
   // stuff uncritical for multithreading
   ...
   {
      someKindOfScopeLock lock(&mutexForThisCriticalResource);
      // stuff critical for multithreading!
   }
   // stuff uncritical for multithreading
   ...    
} 
```

使用匿名范围不需要显式调用互斥锁或信号量的锁定/解锁。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-02-01T13:12:53.850

我将它用于需要临时变量的代码块。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-04-11T13:34:49.497

值得一提的是，范围是编译器控制的现象。即使变量超出范围（编译器将调用任何析构函数；POD 类型会立即优化到代码中），它们仍留在堆栈中，并且在父范围中定义的任何新变量都不会在 gcc 或 clang 上覆盖它们（即使使用 -Ofast 编译）。除了通过地址访问它们是未定义的行为，因为变量在概念上已经超出了编译器级别的范围 - 编译器将阻止您通过它们的标识符访问它们。

```
#include <stdio.h>
int main(void) {
  int* c;
  {
    int b = 5; 
    c=&b;
  }
  printf("%d", *c); //undefined behaviour but prints 5 for reasons stated above
  printf("%d", b); //compiler error, out of scope
  return 0;
} 
```

此外，for、if 和 else 都在匿名块之前。复合语句，根据条件执行一个块或另一个块。

# c# - MEF：无法在其他类中导入？

> ID：500023
> 
> 赞同：3
> 
> 时间：2009-02-01T02:05:04.087
> 
> 标签：c#, wpf, null, mef

编辑：马特，这确实解决了我的一些（大部分）问题，谢谢。现在唯一挥之不去的问题是如何在 WPF 中执行此操作？我有一个基于 a 的自定义部分，`UserControl`但 WPF 中没有办法：

```
[Import]<my:SomeCustomControl> 
```

所以级联在这种情况下不起作用。

/编辑

* * *

我在我的项目中 [导入] 各种 MEF 组件时遇到问题。我必须在我使用的每个类中都使用 CompositionContainer 吗？在下面的代码中，Helper.TimesTwo() 方法中引发了空引用异常，但是当我在 Program 类中调用 logger.Log() 时，一切正常。任何帮助将不胜感激。

（这将作为控制台应用程序编译和运行）。

```
using System;
using System.ComponentModel.Composition;
using System.ComponentModel.Composition.Hosting;

namespace ConsoleApplication2
{
    class Program
    {
        static void Main(string[] args)
        {
            var p = new Program();
            p.Run();
        }

        [Import]
        private ILog logger { get; set; }

        public void Run()
        {
            var catalog = new DirectoryCatalog(".");
            var container = new CompositionContainer(catalog);
            var batch = new CompositionBatch();
            batch.AddPart(this);
            container.Compose(batch);

            logger.Log("hello");
            var h = new Helper();
            logger.Log(h.TimesTwo(15).ToString());
            Console.ReadKey();
        }
    }

    class Helper
    {
        [Import]
        private IDouble doubler { get; set; }

        private Helper()
        {
            // do I have to do all the work with CompositionContainer here again?
        }

        public double TimesTwo(double d)
        {
            return doubler.DoubleIt(d);
        }
    }

    interface ILog
    {
        void Log(string message);
    }

    [Export(typeof(ILog))]
    class MyLog : ILog
    {
        public void Log(string message)
        {
            Console.WriteLine("mylog: " + message);
        }
    }

    interface IDouble
    {
        double DoubleIt(double d);
    }

    [Export(typeof(IDouble))]
    class MyDoubler : IDouble
    {
        public double DoubleIt(double d)
        {
            return d * 2.0;
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-01T02:34:13.140

我认为诀窍是利用 MEF 将级联其导入的事实。因此，如果您导入 Helper 实例而不是将其声明为局部变量，则 Helper 所需的任何导入都将得到满足。

```
 [Import]
    public Helper MyHelper { get; set; }

    public void Run()
    {
        var catalog = new DirectoryCatalog(".");
        var container = new CompositionContainer(catalog);
        var batch = new CompositionBatch();
        batch.AddPart(this);
        container.Compose(batch);
        logger.Log("hello");
        logger.Log(MyHelper.TimesTwo(15).ToString());
        Console.ReadKey();
    } 
```

我确信有一种方法可以让它满足局部变量中的任何导入，但我喜欢使用这样的“级联导入”功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T08:40:05.257

不，你不能那样做。不过，您可以考虑使用附加属性。使用附加属性，您可以让容器组成添加附加属性的元素。另一种选择是标记扩展。

格伦

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-06-15T10:00:32.803

尝试改变

```
[Import]        
private ILog logger { get; set; } 
```

到

```
[Import]        
public ILog logger { get; set; } 
```

它可能会起作用。

# math - 对于 Lisp 初学者来说，一本好的数学书籍是什么？

> ID：500026
> 
> 赞同：2
> 
> 时间：2009-02-01T02:09:45.373
> 
> 标签：math, lisp

我正在寻找一本关于 Lisp 的数学书。一些想法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-01T08:48:37.783

计算机程序的结构和解释使用数学示例。这不是一本真正用于学习特定 Lisp 版本的书，但你会学习这些概念。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-01T02:44:41.653

[编程语言基础](https://rads.stackoverflow.com/amzn/click/com/0262062178)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-01T16:34:38.437

*   [](http://www.cs.umaine.edu/~chaitin/lisp.html)*GJ Chaitin 的[*优雅 LISP 程序*](http://www.cs.umaine.edu/~chaitin/lisp.html)*
**   [](http://www.csulb.edu/~woollett/)*埃德温·L·伍利特 (Edwin L. Woollett) 网页[*示例的 Maxima*](http://www.csulb.edu/~woollett/)**

 **但是请注意，Chaitin 的 `LISP' 版本并不是现在程序员用来做更多实际事情的常用 Lisp。有关 Lisp 编程更实用的方面，请参阅Peter Seibel 的[*Practical Common Lisp*](http://www.gigamonkeys.com/book/)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-01T08:35:41.303

约翰艾伦[的 Lisp 剖析](https://rads.stackoverflow.com/amzn/click/com/007001115X)。

# cocoa-touch - 用户捏屏幕时如何放大/缩小 UIImage 对象？

> ID：500027
> 
> 赞同：84
> 
> 时间：2009-02-01T02:10:06.653
> 
> 标签：cocoa-touch, uiimage, uiimagejpegrepresentation

当用户在我的应用程序上执行标准捏合操作时，我想放大/缩小 UIImage 对象。我目前正在使用 UIImageView 来显示我的图像，如果该细节有任何帮助的话。

我试图弄清楚如何做到这一点，但到目前为止还没有这样的运气。

有什么线索吗？

* * *

## 回答 #1

> 赞同：94
> 
> 时间：2014-08-23T01:14:37.853

正如其他人所描述的，最简单的解决方案是将您的 UIImageView 放入 UIScrollView。我在 Interface Builder .xib 文件中做了这个。

在 viewDidLoad 中，设置以下变量。将您的控制器设置为 UIScrollViewDelegate。

```
- (void)viewDidLoad {
    [super viewDidLoad];
    self.scrollView.minimumZoomScale = 0.5;
    self.scrollView.maximumZoomScale = 6.0;
    self.scrollView.contentSize = self.imageView.frame.size;
    self.scrollView.delegate = self;
} 
```

您需要实现以下方法以返回要缩放的 imageView。

```
- (UIView *)viewForZoomingInScrollView:(UIScrollView *)scrollView
{
    return self.imageView;
} 
```

在 iOS9 之前的版本中，您可能还需要添加这个空委托方法：

```
- (void)scrollViewDidEndZooming:(UIScrollView *)scrollView withView:(UIView *)view atScale:(CGFloat)scale
{
} 
```

[Apple 文档](https://developer.apple.com/library/ios/documentation/windowsviews/conceptual/UIScrollView_pg/ZoomZoom/ZoomZoom.html)很好地描述了如何执行此操作：

* * *

## 回答 #2

> 赞同：85
> 
> 时间：2009-02-01T19:22:56.503

另一种简单的方法是把你`UIImageView`放在一个`UIScrollView`. [正如我在这里所描述的](https://stackoverflow.com/questions/419710/how-do-i-pan-the-image-inside-a-uiimageview/421646#421646)，您需要将滚动视图的 contentSize 设置为与您的`UIImageView's`大小相同。将您的控制器实例设置为滚动视图的委托，并实现`viewForZoomingInScrollView:`和`scrollViewDidEndZooming:withView:atScale:`方法以允许缩放和图像平移。这实际上是 Ben 的解决方案所做的，只是以更轻量级的方式，因为您没有完整 Web 视图的开销。

您可能会遇到的一个问题是滚动视图中的缩放以应用于图像的变换的形式出现。这可能导致在高缩放因子下的模糊。对于可以重绘的内容，您可以[在此处](https://stackoverflow.com/questions/448285/how-do-i-reset-after-a-uiscrollview-zoom/451629#451629)按照我的建议在捏合手势完成后提供更清晰的显示。那时可以使用 hniels 的解决方案来重新缩放您的图像。

* * *

## 回答 #3

> 赞同：47
> 
> 时间：2012-04-19T12:55:47.700

Shefali 的 UIImageView 解决方案效果很好，但需要稍作修改：

```
- (void)pinch:(UIPinchGestureRecognizer *)gesture {
    if (gesture.state == UIGestureRecognizerStateEnded
        || gesture.state == UIGestureRecognizerStateChanged) {
        NSLog(@"gesture.scale = %f", gesture.scale);

        CGFloat currentScale = self.frame.size.width / self.bounds.size.width;
        CGFloat newScale = currentScale * gesture.scale;

        if (newScale < MINIMUM_SCALE) {
            newScale = MINIMUM_SCALE;
        }
        if (newScale > MAXIMUM_SCALE) {
            newScale = MAXIMUM_SCALE;
        }

        CGAffineTransform transform = CGAffineTransformMakeScale(newScale, newScale);
        self.transform = transform;
        gesture.scale = 1;
    }
} 
```

（Shefali 的解决方案的缺点是在捏合时不会连续缩放。此外，当开始新的捏合时，当前的图像比例会被重置。）

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2011-09-27T11:06:14.280

下面的代码有助于在不使用 UIScrollView 的情况下缩放 UIImageView ：

```
-(void)HandlePinch:(UIPinchGestureRecognizer*)recognizer{
    if ([recognizer state] == UIGestureRecognizerStateEnded) {
        NSLog(@"======== Scale Applied ===========");
        if ([recognizer scale]<1.0f) {
            [recognizer setScale:1.0f];
        }
        CGAffineTransform transform = CGAffineTransformMakeScale([recognizer scale],  [recognizer scale]);
        imgView.transform = transform;
    }
} 
```

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2009-02-01T05:13:17.157

请记住，您永远不会放大`UIImage`. 曾经。

相反，您正在放大和缩小`view`显示`UIImage`.

在这种特殊情况下，您可以选择`UIView`使用自定义绘图创建一个自定义来显示图像，一个`UIImageView`为您显示图像，或者一个`UIWebView`需要一些额外的 HTML 来备份它。

在所有情况下，您都需要实现`touchesBegan`、`touchesMoved`等来确定用户正在尝试做什么（缩放、平移等）。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-02-01T16:54:08.800

这是我之前使用过的解决方案，不需要您使用 UIWebView。

```
- (UIImage *)scaleAndRotateImage(UIImage *)image
{
    int kMaxResolution = 320; // Or whatever

    CGImageRef imgRef = image.CGImage;

    CGFloat width = CGImageGetWidth(imgRef);
    CGFloat height = CGImageGetHeight(imgRef);

    CGAffineTransform transform = CGAffineTransformIdentity;
    CGRect bounds = CGRectMake(0, 0, width, height);
    if (width > kMaxResolution || height > kMaxResolution) {
        CGFloat ratio = width/height;
        if (ratio > 1) {
            bounds.size.width = kMaxResolution;
            bounds.size.height = bounds.size.width / ratio;
        }
        else {
            bounds.size.height = kMaxResolution;
            bounds.size.width = bounds.size.height * ratio;
        }
    }

    CGFloat scaleRatio = bounds.size.width / width;
    CGSize imageSize = CGSizeMake(CGImageGetWidth(imgRef), CGImageGetHeight(imgRef));
    CGFloat boundHeight;
    UIImageOrientation orient = image.imageOrientation;
    switch(orient) {

        case UIImageOrientationUp: //EXIF = 1
            transform = CGAffineTransformIdentity;
            break;

        case UIImageOrientationUpMirrored: //EXIF = 2
            transform = CGAffineTransformMakeTranslation(imageSize.width, 0.0);
            transform = CGAffineTransformScale(transform, -1.0, 1.0);
            break;

        case UIImageOrientationDown: //EXIF = 3
            transform = CGAffineTransformMakeTranslation(imageSize.width, imageSize.height);
            transform = CGAffineTransformRotate(transform, M_PI);
            break;

        case UIImageOrientationDownMirrored: //EXIF = 4
            transform = CGAffineTransformMakeTranslation(0.0, imageSize.height);
            transform = CGAffineTransformScale(transform, 1.0, -1.0);
            break;

        case UIImageOrientationLeftMirrored: //EXIF = 5
            boundHeight = bounds.size.height;
            bounds.size.height = bounds.size.width;
            bounds.size.width = boundHeight;
            transform = CGAffineTransformMakeTranslation(imageSize.height, imageSize.width);
            transform = CGAffineTransformScale(transform, -1.0, 1.0);
            transform = CGAffineTransformRotate(transform, 3.0 * M_PI / 2.0);
            break;

        case UIImageOrientationLeft: //EXIF = 6
            boundHeight = bounds.size.height;
            bounds.size.height = bounds.size.width;
            bounds.size.width = boundHeight;
            transform = CGAffineTransformMakeTranslation(0.0, imageSize.width);
            transform = CGAffineTransformRotate(transform, 3.0 * M_PI / 2.0);
            break;

        case UIImageOrientationRightMirrored: //EXIF = 7
            boundHeight = bounds.size.height;
            bounds.size.height = bounds.size.width;
            bounds.size.width = boundHeight;
            transform = CGAffineTransformMakeScale(-1.0, 1.0);
            transform = CGAffineTransformRotate(transform, M_PI / 2.0);
            break;

        case UIImageOrientationRight: //EXIF = 8
            boundHeight = bounds.size.height;
            bounds.size.height = bounds.size.width;
            bounds.size.width = boundHeight;
            transform = CGAffineTransformMakeTranslation(imageSize.height, 0.0);
            transform = CGAffineTransformRotate(transform, M_PI / 2.0);
            break;

        default:
            [NSException raise:NSInternalInconsistencyException format:@"Invalid image orientation"];

    }

    UIGraphicsBeginImageContext(bounds.size);

    CGContextRef context = UIGraphicsGetCurrentContext();

    if (orient == UIImageOrientationRight || orient == UIImageOrientationLeft) {
        CGContextScaleCTM(context, -scaleRatio, scaleRatio);
        CGContextTranslateCTM(context, -height, 0);
    }
    else {
        CGContextScaleCTM(context, scaleRatio, -scaleRatio);
        CGContextTranslateCTM(context, 0, -height);
    }

    CGContextConcatCTM(context, transform);

    CGContextDrawImage(UIGraphicsGetCurrentContext(), CGRectMake(0, 0, width, height), imgRef);
    UIImage *imageCopy = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();

    return imageCopy;
} 
```

这篇文章可以在 Apple 支持上找到： [http ://discussions.apple.com/message.jspa?messageID=7276709#7276709](http://discussions.apple.com/message.jspa?messageID=7276709#7276709)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2015-07-22T00:30:21.540

Shafali 和 JRV 的答案扩展到包括平移和捏缩放：

```
#define MINIMUM_SCALE 0.5
#define MAXIMUM_SCALE 6.0
@property CGPoint translation;

- (void)pan:(UIPanGestureRecognizer *)gesture {
    static CGPoint currentTranslation;
    static CGFloat currentScale = 0;
    if (gesture.state == UIGestureRecognizerStateBegan) {
        currentTranslation = _translation;
        currentScale = self.view.frame.size.width / self.view.bounds.size.width;
    }
    if (gesture.state == UIGestureRecognizerStateEnded || gesture.state == UIGestureRecognizerStateChanged) {

        CGPoint translation = [gesture translationInView:self.view];

        _translation.x = translation.x + currentTranslation.x;
        _translation.y = translation.y + currentTranslation.y;
        CGAffineTransform transform1 = CGAffineTransformMakeTranslation(_translation.x , _translation.y);
        CGAffineTransform transform2 = CGAffineTransformMakeScale(currentScale, currentScale);
        CGAffineTransform transform = CGAffineTransformConcat(transform1, transform2);
        self.view.transform = transform;
    }
}

- (void)pinch:(UIPinchGestureRecognizer *)gesture {
    if (gesture.state == UIGestureRecognizerStateEnded || gesture.state == UIGestureRecognizerStateChanged) {
//        NSLog(@"gesture.scale = %f", gesture.scale);

        CGFloat currentScale = self.view.frame.size.width / self.view.bounds.size.width;
        CGFloat newScale = currentScale * gesture.scale;

        if (newScale < MINIMUM_SCALE) {
            newScale = MINIMUM_SCALE;
        }
        if (newScale > MAXIMUM_SCALE) {
            newScale = MAXIMUM_SCALE;
        }

        CGAffineTransform transform1 = CGAffineTransformMakeTranslation(_translation.x, _translation.y);
        CGAffineTransform transform2 = CGAffineTransformMakeScale(newScale, newScale);
        CGAffineTransform transform = CGAffineTransformConcat(transform1, transform2);
        self.view.transform = transform;
        gesture.scale = 1;
    }
} 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-02-01T03:56:47.637

最简单的方法，如果你想要的只是捏缩放，就是把你的图像放在一个`UIWebView`（编写少量的 html 包装器代码，引用你的图像，你基本上就完成了）。更复杂的方法是使用`touchesBegan`、`touchesMoved`和`touchesEnded`来跟踪用户的手指，并适当地调整视图的变换属性。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-08-17T13:08:27.857

请记住，您不想放大/缩小 UIImage。而是尝试放大/缩小包含 UIImage 视图控制器的视图。

我已经为这个问题制定了解决方案。看看我的代码：

```
@IBAction func scaleImage(sender: UIPinchGestureRecognizer) {
        self.view.transform = CGAffineTransformScale(self.view.transform, sender.scale, sender.scale)
        sender.scale = 1
    }
    override func viewDidLoad() {
        super.viewDidLoad()
        // Do any additional setup after loading the view, typically from a nib.
        view.backgroundColor = UIColor.blackColor()
    } 
```

注意：不要忘记连接 PinchGestureRecognizer。

# objective-c - 以“k”开头的常数有什么意义？

> ID：500030
> 
> 赞同：22
> 
> 时间：2009-02-01T02:12:17.757
> 
> 标签：objective-c, constants

我正在自学Objective-C，我在很多书籍和示例中注意到在常量定义中使用'k'和camel-casing，例如

```
#define kMyConstant 0 
```

“k”的含义是什么？这是 Objective-C 风格所独有的，还是一般 C 语言所共有的？为什么偏离（我一直认为的最佳实践）K_MY_CONSTANT 风格？

谢谢。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-02-01T02:21:52.290

之前在 SO 问题中提到过一次，[Cocoa 中的小写“k”](https://stackoverflow.com/questions/472103/lower-case-k-in-cocoa)。

> 它是一种通用的编程符号，并非特定于 Objective-C（即匈牙利符号），“k”代表“常量”。

如果您查看 Google 的 Objective-C 指南的[Google 缓存](http://74.125.95.132/search?q=cache:h1-gASSvV78J:google-styleguide.googlecode.com/svn/trunk/objcguide.xml+constants+with+k+objective-c&hl=en&ct=clnk&cd=6&gl=us&client=firefox-a)，您会发现他们曾经将其包含在他们的样式指南中：

> 常量名称（#defines、enums、const 局部变量等）应以小写 k 开头，然后使用大小写混合来分隔单词，即 kInvalidHandle、kWritePerm。
> 
> 虽然写起来很痛苦，但它们对于保持我们的代码可读性绝对重要。以下规则描述了您应该评论的内容和位置。但请记住：虽然注释非常重要，但最好的代码是自记录的。为类型和变量赋予合理的名称比使用晦涩的名称然后尝试通过注释来解释它们要好得多。

但它已在文档的[实时版本中被删除。](http://google-styleguide.googlecode.com/svn/trunk/objcguide.xml)应该注意的是，它违反了Apple[的 Cocoa 官方编码指南。](http://developer.apple.com/documentation/Cocoa/Conceptual/CodingGuidelines/CodingGuidelines.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-01T02:18:19.897

所有大写字母（如`K_MY_CONSTANT`）通常表示一个宏 - 不一定是常数。宏脱颖而出通常很重要，因为它们会破坏所有命名空间。

' `k`' 约定用于（但不是普遍地）用于 C/C++ 和可能其他语言中的非宏常量。我怀疑`k`使用 ' ' 是因为 ' `c`' 已经经常使用 - 要么表示类名（如`CString`），要么表示变量是计数器。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-01T02:35:18.240

kMyConstant 可以追溯到非常古老的 Mac 编程时代（80 年代/90 年代“非常古老”）。这是 Apple 使用的标准，许多 Mac 程序员也使用过；这取代了 MY_CONSTANT 类型的定义。

我想你正在阅读的作者在成为 NeXT/Cocoa 程序员之前是旧 Mac Toolbox 的 Mac Pascal/C 程序员。Mac 库曾经被称为“工具箱”——这是一组 API 和库，随着时间的推移变成了 Carbon。

我有时仍然使用 kMyConstant；让我的老派 Unix 程序员同事发疯。:-)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-01T03:36:42.827

我认为使用前导“k”是因为所有语言都将其发音为硬辅音，因此它让人们想起“constant”的英语发音:-)

没有保留字以 k 开头，因此作为搜索目标更容易。

或者，从图形方面来看，作为一个引导字符，它在名称的其余部分前面提供了一个非常清晰的标志。前导“c”不太明显，可用于指示角色（例如匈牙利符号）或类（如果使用不区分大小写的语言）。

MY_CONSTANT 非常适合用于基于宏的常量。有时重要的是要知道常量是由宏定义的，例如，这意味着它基于文字，因此来自有限范围的数据类型，以及在全局范围内定义，因此（正如 Michael Burr 指出的那样out) 覆盖任何本地命名空间常量。

# regex - 如何使用正则表达式使用前缀字符进行拆分？

> ID：500031
> 
> 赞同：5
> 
> 时间：2009-02-01T02:13:49.500
> 
> 标签：regex, split, character, prefix

我想拆分示例字符串：

> ~Peter~Lois~Chris~Meg~Stewie

在角色上`~`，结果是

> 彼得·
> 洛伊丝
> 克里斯·
> 梅格·
> 斯图维

在 javascript 或 C# 中使用标准字符串拆分函数，第一个结果当然是一个空字符串。我想避免忽略第一个结果，因为第一个结果实际上可能是一个空字符串。

我一直在摆弄使用正则表达式，我很困惑。我敢肯定有人已经遇到过这个问题的优雅解决方案。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-01T04:21:13.940

对于您的要求，我看到两个选项：

(1) 删除初始前缀字符（如果存在）。

(2) 使用完整的正则表达式来分隔字符串。

两者都在此代码中进行了说明：

```
using System;
using System.Linq;
using System.Text.RegularExpressions;

class APP { static void Main() {

string s = "~Peter~Lois~Chris~Meg~Stewie";

// #1 - Trim+Split
Console.WriteLine ("[#1 - Trim+Split]");
string[] result = s.TrimStart('~').Split('~');
foreach (string t in result) { Console.WriteLine("'"+t+"'"); }

// #2 - Regex
Console.WriteLine ("[#2 - Regex]");
Regex RE = new Regex("~([^~]*)");
MatchCollection theMatches = RE.Matches(s);
foreach (Match match in theMatches) { Console.WriteLine("'"+match.Groups[1].Value+"'"); }

// #3 - Regex with LINQ [ modified from @ccook's code ]
Console.WriteLine ("[#3 - Regex with LINQ]");
Regex.Matches(s, "~([^~]*)")
    .OfType<Match>()
    .ToList()
    .ForEach(m => Console.WriteLine("'"+m.Groups[1].Value+"'"))
    ;
}} 
```

#2 中的正则表达式匹配分隔符，后跟包含零个或多个非分隔符的匹配组。结果匹配是分隔字符串（包括任何空字符串）。对于每个匹配，“match.Value”是包含前导分隔符的整个字符串，“match.Groups [1](http://oreilly.com/catalog/9780596528126/index.html) .Value”是第一个包含无分隔符字符串的匹配组。

为了完整起见，第三个编码 (#3) 包含在 #2 中显示相同的正则表达式方法，但采用 LINQ 编码样式。

如果您正在为正则表达式苦苦挣扎，我强烈推荐[Jeffrey EF Friedl 的 Mastering Regular Expressions, Third Edition](http://oreilly.com/catalog/9780596528126/index.html)。到目前为止，它是理解正则表达式的最佳帮助，以后可以根据需要作为很好的参考或复习。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T02:25:20.677

在 C# 中，这似乎得到了你想要的：

```
"~Peter~Lois~Chris~Meg~Stewie".Split("~".ToCharArray(), StringSplitOptions.RemoveEmptyEntries); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-01T04:44:01.427

这是一种LINQ方法...

请注意，RegexOptions.ExplicitCapture 不包括匹配项。没有它，'~' 也将被包括在内。

```
using System;
using System.Linq;
using System.Text.RegularExpressions;

namespace ConsoleApplication2
{
    class Program
    {
        static void Main(string[] args)
        {
            string s = "~Peter~Lois~Chris~Meg~Stewie";
            Regex.Split(s, "(~)", RegexOptions.ExplicitCapture)
                .Where(i=>!String.IsNullOrEmpty(i))
                .ToList().ForEach(i => Console.WriteLine(i));
            Console.ReadLine();
        }
    }
} 
```

# asp.net - 如何让 Page.ClientScript.RegisterClientScriptInclude 包含在头部？

> ID：500036
> 
> 赞同：17
> 
> 时间：2009-02-01T02:18:47.913
> 
> 标签：asp.net

包含的脚本引用，特别是 jQuery，在视图状态之后呈现。有没有办法在 <head> 中得到这个？

```
Page.ClientScript.RegisterClientScriptInclude("jQuery", "/scripts/jquery.js"); 
```

我正在尝试在用户控件的页面加载中注册 jquery.js。

提前致谢！

PS 如果无法完成（使用 ClientScript），任何人都知道他们为什么不构建它？

**更新**

我需要的 ClientScript 管理器的主要功能是能够只包含一次脚本。该控件可以在页面上出现多次，但我只想要一个 jQuery 脚本包括

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-02-01T02:32:56.980

直接将其包含在 HEAD 中：

```
HtmlGenericControl Include = new HtmlGenericControl("script"); 
Include.Attributes.Add("type", "text/javascript"); 
Include.Attributes.Add("src", sInclude); 
this.Page.Header.Controls.Add(Include); 
```

在添加之前，您需要检查以确保它不存在。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-01T02:28:36.677

前段时间我遇到了这个问题，最后我没有使用 RegisterClientScriptInclude。

我在页面标题中放置了一个占位符，并通过 HtmlGenericControl 将脚本标记添加到占位符。

我会看看我是否能找到我的代码，然后我会用它来编辑我的答案。

**编辑**

我找不到我的代码，所以我重新创建了它：

```
<%@ Page Language="C#" AutoEventWireup="true" CodeBehind="Default.aspx.cs" Inherits="WebApplication1._Default" %>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" >
<head runat="server">
    <asp:PlaceHolder runat="server" ID="HeadPlaceHolder"></asp:PlaceHolder>
</head>    
<body>
    ...
</body>
</html> 
```

以及背后的代码：

```
protected void Page_Load(object sender, EventArgs e)
{
    HeadPlaceHolder.Controls.Add(/* Your control here */);
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-04-06T04:22:07.100

嘿，老问题，但也许这仍然有人感兴趣。

我正在使用 .net 3.5sp1 创建自己的 UserControl，遇到了同样的问题。以下解决方案对我有用。

此代码来自`UserControl`该类：

```
protected void Page_Init( object sender, EventArgs e )
{
    const string scriptKey = "UserControlScript";

    if( !Page.ClientScript.IsClientScriptIncludeRegistered( Page.GetType(), scriptKey ) )
    {
        Page.ClientScript.RegisterClientScriptInclude( Page.GetType(), scriptKey, ResolveClientUrl("~/js/UserControl.js" ) );
    }
} 
```

我之所以使用它是因为我需要在调用嵌套页面`Page_Init`之前进行更多的初始化。`Page_Load`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-01T02:47:18.760

似乎无法使用 Page.ClientScript 将脚本添加到页面标题。

# algorithm - 查找二叉堆的最后一个元素

> ID：500057
> 
> 赞同：18
> 
> 时间：2009-02-01T02:42:38.787
> 
> 标签：algorithm, data-structures, binary-tree, binary-heap

*引用[维基百科](http://en.wikipedia.org/wiki/Binary_heap#Heap_implementation)：*

> 使用传统的二叉树数据结构来实现二叉堆是完全可以接受的。添加可以通过*算法**解决* 的元素时，在二进制堆的最后一级找到相邻元素存在问题......

 *关于这种算法如何工作的任何想法？

我无法找到有关此问题的任何信息，因为大多数二进制堆都是使用数组实现的。

任何帮助表示赞赏。

* * *

最近，我注册了一个 OpenID 帐户，无法编辑我的初始帖子，也无法评论答案。这就是为什么我通过这个答案做出回应。非常遗憾。

* * *

*引用米奇小麦：*

> @Yse：您的问题是“如何找到二进制堆的最后一个元素”？

是的。或者更准确地说，我的问题是：“如何找到*非基于数组的*二进制堆的最后一个元素？”。

*引用抑制火：*

> 你在问这个问题时有什么背景吗？（即，您是否正在尝试解决一些具体问题？）

如上所述，我想知道一种“找到基于非数组的二进制堆的最后一个元素”的好方法，这是插入和删除节点所必需的。

*引用罗伊的话：*

> 对我来说，使用普通的二叉树结构（使用定义为 [data, pLeftChild, pRightChild] 的 pRoot 和 Node）并添加两个额外的指针（pInsertionNode 和 pLastNode）似乎是最容易理解的。pInsertionNode 和 pLastNode 都将在插入和删除子例程期间更新，以在结构中的数据更改时保持它们的最新状态。这使 O(1) 可以访问结构的插入点和最后一个节点。

是的，这应该有效。如果我没记错的话，当它们的位置由于删除/插入而更改为另一个子树时，找到插入节点和最后一个节点可能会有点棘手。但我会试一试。

*引用 Zach Scrivena 的话：*

> 如何执行深度优先搜索...

是的，这将是一个很好的方法。我也会试试看。

我仍然想知道，是否有办法“计算”最后一个节点和插入点的位置。具有 N 个节点的二叉堆的高度可以通过取大于 N 的 2 的最小幂的对数（以 2 为底）来计算。也许也可以计算最深层次的节点数。然后有可能确定必须如何遍历堆才能到达插入点或删除节点。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-02-01T07:58:26.823

基本上，引用的语句是指解决在堆中插入和删除数据元素的位置问题。为了保持二叉堆的“形状属性”，堆的最低层必须始终从左到右填充，不留空节点。为了保持二进制堆的平均 O(1) 插入和删除时间，您必须能够确定下一次插入的位置以及用于删除根节点的最低级别上的最后一个节点的位置，两者在恒定时间内。

对于存储在数组中的二进制堆（其隐式压缩数据结构，如 Wikipedia 条目中所述），这很容易。只需在数组末尾插入最新的数据成员，然后将其“冒泡”到位（遵循堆规则）。或者用数组“冒泡”中的最后一个元素替换根以进行删除。对于数组存储中的堆，堆中元素的数量是一个隐式指针，指向要插入下一个数据元素的位置以及在哪里找到要用于删除的最后一个元素。

对于存储在树结构中的二叉堆来说，这个信息并不那么明显，但是因为它是一棵完整的二叉树，所以可以计算出来。例如，在具有 4 个元素的完全二叉树中，插入点将始终是根节点左孩子的右孩子。用于删除的节点将始终是根节点的左子节点的左子节点。对于任何给定的任意树大小，树将始终具有特定的形状，并具有明确定义的插入和删除点。因为这棵树是一个“完全二叉树”，对于任何给定的大小都具有特定的结构，所以很有可能在 O(1) 时间内计算出插入/删除的位置。然而，问题是即使你知道它在结构上的位置，你也不知道节点在内存中的位置。所以，您必须遍历树才能到达给定的节点，这是一个 O(log n) 过程，使所有插入和删除的最小时间为 O(log n)，从而破坏了通常需要的 O(1) 行为。任何搜索（“深度优先”，或其他一些）也将至少为 O(log n)，因为已注意到遍历问题，并且由于半排序堆的随机性质，通常为 O(n)。

诀窍是能够通过扩充数据结构（“线程化”树，如 Wikipedia 文章中所述）或使用其他指针，在恒定时间内*计算*和*引用这些插入/删除点。*

在我看来是最容易理解的实现，具有低内存和额外的编码开销，只是使用普通的简单二叉树结构（使用定义为 [data, pParent, pLeftChild, pRightChild] 的 pRoot 和节点）和添加两个额外的指针（pInsert 和 pLastNode）。pInsert 和 pLastNode 都将在插入和删除子例程期间更新，以在结构中的数据更改时保持它们的最新状态。此实现为结构的插入点和最后一个节点提供了 O(1) 访问权限，并且应该允许在插入和删除中保留整体 O(1) 行为。实现的成本是插入/删除子例程中的两个额外指针和一些额外的小代码（又名，最小）。

**编辑**：为 O(1) insert() 添加伪代码

这是平均为 O(1) 的插入子例程的伪代码：

```
define Node = [T data, *pParent, *pLeft, *pRight]

void insert(T data)
{
    do_insertion( data );   // do insertion, update count of data items in tree

    # assume: pInsert points node location of the tree that where insertion just took place
    #   (aka, either shuffle only data during the insertion or keep pInsert updated during the bubble process)

    int N = this->CountOfDataItems + 1;     # note: CountOfDataItems will always be > 0 (and pRoot != null) after an insertion

    p = new Node( <null>, null, null, null);        // new empty node for the next insertion

    # update pInsert (three cases to handle)
    if ( int(log2(N)) == log2(N) )
        {# #1 - N is an exact power of two
        # O(log2(N))
        # tree is currently a full complete binary tree ("perfect")
        # ... must start a new lower level
        # traverse from pRoot down tree thru each pLeft until empty pLeft is found for insertion
        pInsert = pRoot;
        while (pInsert->pLeft != null) { pInsert = pInsert->pLeft; }    # log2(N) iterations
        p->pParent = pInsert;
        pInsert->pLeft = p;
        }
    else if ( isEven(N) )
        {# #2 - N is even (and NOT a power of 2)
        # O(1)
        p->pParent = pInsert->pParent;
        pInsert->pParent->pRight = p;
        }
    else 
        {# #3 - N is odd
        # O(1)
        p->pParent = pInsert->pParent->pParent->pRight;
        pInsert->pParent->pParent->pRight->pLeft = p;
        }
    pInsert = p;

    // update pLastNode
    // ... [similar process]
} 
```

因此，insert(T) 平均为 O(1)：在所有情况下都恰好为 O(1)，除非当树为 O(log N) 时必须将树增加一级，这种情况发生在每 log N 次插入（假设没有删除）。添加另一个指针 (pLeftmostLeaf) 可以使 insert() 在所有情况下都为 O(1) 并避免在完整的完全二叉树中交替插入和删除的可能病理情况。（添加 pLeftmost 留作练习 [这相当容易]。）

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2016-02-04T04:13:50.013

我第一次参加堆栈溢出。

是的，Zach Scrivena 的上述回答（天哪，我不知道如何正确称呼其他人，抱歉）是正确的。如果给定节点数，我想添加的是一种简化的方法。

基本思想是：

给定这棵完整二叉树中的节点数 N，进行“N % 2”计算并将结果压入堆栈。继续计算直到 N == 1。然后将结果弹出。结果是 1 表示右，0 表示左。该序列是从根到目标位置的路线。

例子：

树现在有 10 个节点，我想在位置 11 插入另一个节点。如何路由它？

```
11 % 2 = 1  --> right    (the quotient is 5, and push right into stack)
 5 % 2 = 1  --> right    (the quotient is 2, and push right into stack)
 2 % 2 = 0  --> left     (the quotient is 1, and push left into stack. End) 
```

然后弹出堆栈：左 -> 右 -> 右。这是从根开始的路径。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2015-02-08T11:31:42.340

您可以使用二进制堆大小的二进制表示来查找 O(log N) 中最后一个节点的位置。可以存储和增加大小，这将花费 O(1) 时间。这背后的基本概念是二叉树的结构。

假设我们的堆大小是 7。7 的二进制表示是“111”。现在，请记住始终省略第一位。所以，现在我们只剩下“11”了。从左到右阅读。该位为“1”，因此，转到根节点的右子节点。那么左边的字符串是“1”，第一位是“1”。因此，再次转到您所在的当前节点的右子节点。由于您不再有要处理的位，这表明您已到达最后一个节点。因此，该过程的原始工作是将堆的大小转换为位。省略第一位。根据最左边的位，如果为'1'则转到当前节点的右孩子，如果为'0'则转到当前节点的左孩子。

正如你一直到二叉树的最后一样，这个操作总是需要 O(log N) 时间。这是找到最后一个节点的简单而准确的过程。

初读时你可能不明白。尝试在纸上针对二进制堆的不同值使用这种方法，我相信你会得到它背后的直觉。我相信这些知识足以解决你的问题，如果你想用数字解释更多，你可以参考我的[博客](http://theoryofprogramming.com/2015/02/01/more-binary-heaps/)。

希望我的回答对您有所帮助，如果有，请告诉我...！☺

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-01T05:01:32.343

如何执行[深度优先搜索](http://en.wikipedia.org/wiki/Depth_first_search)，在右孩子之前访问左孩子，以确定树的高度。此后，您遇到的第一个具有较短深度的叶子，或者缺少孩子的父节点会在“冒泡”之前指示您应该将新节点放置在哪里。

* * *

上面的深度优先搜索 (DFS) 方法并不假设您知道树中的节点总数。如果这些信息可用，那么我们可以利用*完全二叉树*的特性快速“放大”到所需的位置：

令**N**为树中的节点总数，**H**为树的高度。

**( N** , **H** ) 的一些值是 (1,0), (2,1), (3,1), (4,2), ..., (7,2), (8, 3)。两者相关的一般公式是**H** = ceil[log2( **N** +1)] - 1。现在，仅给定**N**，我们希望以最少的步数从根遍历到新节点的位置，即没有任何“回溯”。我们首先计算高度为**H** = ceil[log2( **N** +1)] - 1的*完美二叉树*中的节点总数**M**，即**M** = 2^( **H** +1) - 1。

 *******如果**N** == **M**，那么我们的树是*完美*的，新节点应该添加到新的级别。这意味着我们可以简单地执行 DFS（从左到右），直到我们碰到第*一个*叶子；新节点成为这片叶子的左孩子。故事结局。

但是，如果**N** < **M**，那么我们树的最后一层仍有空位，新节点应该添加到最左边的空位。已经在我们树的最后一层的节点数只是 ( **N** - 2^ **H** + 1)。这意味着新节点在最后一级从左侧取点**X** = ( **N** - 2^ **H + 2)。**

现在，要从根部到达那里，您需要在每个级别进行正确的转弯（L vs R），以便您最终到达最后一个级别的**X**点。在实践中，您将在每个级别通过少量计算来确定转弯。但是，我认为下表显示了总体情况和相关模式，而不会陷入算术的困境（您可能会将其视为均匀分布的[算术编码形式）：](http://en.wikipedia.org/wiki/Arithmetic_coding)

```
0 0 0 0 0 X 0 0 <--- represents the last level in our tree, X marks the spot!
          ^
L L L L R R R R <--- at level 0, proceed to the R child
L L R R L L R R <--- at level 1, proceed to the L child
L R L R L R L R <--- at level 2, proceed to the R child 
          ^                      (which is the position of the new node)
          this column tells us
          if we should proceed to the L or R child at each level 
```

编辑：假设我们知道树中的节点总数，添加了关于如何以最短的步骤到达新节点的描述。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-07-31T01:20:58.473

如果您没有参考父母的解决方案！要为下一个节点找到合适的位置，您需要处理 3 个案例

*   案例（1）树级完整 Log2(N)
*   案例（2）树节点数为偶数
*   案例（3）树节点数为奇数

插入：

```
void Insert(Node root,Node n)
{
Node parent = findRequiredParentToInsertNewNode (root);
if(parent.left == null)
parent.left = n;
else
parent.right = n;
} 
```

找到节点的父节点以插入它

```
void findRequiredParentToInsertNewNode(Node root){

Node last = findLastNode(root);

 //Case 1 
 if(2*Math.Pow(levelNumber) == NodeCount){
     while(root.left != null)
      root=root.left;
  return root;
 }
 //Case 2
 else if(Even(N)){
   Node n =findParentOfLastNode(root ,findParentOfLastNode(root ,last));
 return n.right;
 }
//Case 3
 else if(Odd(N)){
  Node n =findParentOfLastNode(root ,last);
 return n;
 }

} 
```

要找到最后一个节点，您需要执行 BFS（广度优先搜索）并获取队列中的最后一个元素

```
 Node findLastNode(Node root)
 {
     if (root.left == nil)
         return root

     Queue q = new Queue();

     q.enqueue(root);
     Node n = null;

     while(!q.isEmpty()){
      n = q.dequeue();
     if ( n.left != null )
         q.enqueue(n.left);
     if ( n.right != null )
         q.enqueue(n.right);
        }
   return n;
} 
```

查找最后一个节点的父节点，以便将节点设置为空，以防在删除情况下替换为根节点

```
 Node findParentOfLastNode(Node root ,Node lastNode)
{
    if(root == null)
        return root;

    if( root.left == lastNode || root.right == lastNode )
        return root;

    Node n1= findParentOfLastNode(root.left,lastNode);
    Node n2= findParentOfLastNode(root.left,lastNode);

    return n1 != null ? n1 : n2;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-11-07T18:18:28.123

我知道这是一个旧线程，但我正在寻找同一个问题的答案。但是我不能做一个 o(log n) 解决方案，因为我必须在几秒钟内找到最后一个节点数千次。我确实有一个 O(log n) 算法，但我的程序正在爬行，因为它执行此操作的次数。所以经过深思熟虑，我终于找到了解决这个问题的方法。不确定是否有人觉得这很有趣。

这个解决方案是 O(1) 的搜索。对于插入，它肯定小于 O(log n)，尽管我不能说它是 O(1)。

只是想补充一点，如果有兴趣，我也可以提供我的解决方案。解决方案是将二进制堆中的节点添加到队列中。每个队列节点都有前后指针。我们不断地从左到右将节点添加到此队列的末尾，直到到达二进制堆中的最后一个节点。此时，二进制堆中的最后一个节点将位于队列的末尾。每次需要找到最后一个节点时，我们从后面出列，现在倒数第二个成为树中的最后一个节点。当我们想要插入时，我们从后面向后搜索我们可以插入的第一个节点并将其放在那里。它不完全是 O(1)，但大大减少了运行时间。

# blackberry - 编写黑莓应用程序

> ID：500058
> 
> 赞同：7
> 
> 时间：2009-02-01T02:43:04.620
> 
> 标签：blackberry

如何编写黑莓应用程序？

我在带有 VMWare 的 OS X Leopard 上。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-02T01:43:42.010

多年来，我一直在开发 BlackBerry 应用程序——几乎只要设备一直存在——实际上我目前正在使用带有 VMWare 的 Macbook pro，它运行良好——如果你有 RAM（3 gigs 很好）和 CPU马力。

黑莓开发者专区 ( [http://na.blackberry.com/eng/developers/](http://na.blackberry.com/eng/developers/) ) 绝对是您应该去的第一个地方 - 您需要下载 BlackBerry JDE（Java 开发环境 - 他们的独立 IDE）或 JDE Eclipse 插件。它们带有 API Javadocs，而独立的 JDE 带有示例应用程序。还有支持论坛、知识库等。在这两种情况下，模拟器都是 Windows 应用程序 - 因此需要使用 Windows 进行开发。

我写了一篇名为[Thinking Blackberry](http://www.thinkingblackberry.com)的关于 BlackBerry 开发的博客。它非常新，到目前为止，我一直在探索特定的稍微更高级的主题，但是我有一个[用于 Eclipse 的 JDE 插件的入门教程，该教程](http://www.thinkingblackberry.com/archives/21)有一些很好的反馈（我是 BB 走 Eclipse 路线的支持者发展）。它还提供了 BlackBerry 开发选项的概述，每个选项都有优点和缺点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-01T02:48:22.130

我没有任何个人经验，但看起来 Blackberry 有一个相当广泛的[开发者资源区](http://na.blackberry.com/eng/developers/resources/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-01T03:23:47.173

他们也有自己的 SDK。在 blackberry.com 上搜索它。语言是Java。我对此了解不多。我有一台黑莓，所以作为一名 C# 开发人员，我不为 CrackBerry 开发应用程序很遗憾。不过，应该非常直截了当。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T01:50:45.810

Blackberry does offer pretty extensive documentation. They're Developer Zone ([http://na.blackberry.com/eng/developers/](http://na.blackberry.com/eng/developers/)) is my prime resource. Unfortunately the Developer Zone is pretty hard to navigate, so here are some of my favorite links:

*   Java apps ([http://na.blackberry.com/eng/developers/javaappdev/](http://na.blackberry.com/eng/developers/javaappdev/))
*   Javadoc ([http://na.blackberry.com/eng/deliverables/5999/index.html?name=BlackBerry+Java+Development+Environment+-+API+Reference4.7.0&language=English&userType=21&category=BlackBerry+Java+Application+Development&subCategory=BlackBerry+Java+Development+Environment](http://na.blackberry.com/eng/deliverables/5999/index.html?name=BlackBerry+Java+Development+Environment+-+API+Reference4.7.0&language=English&userType=21&category=BlackBerry+Java+Application+Development&subCategory=BlackBerry+Java+Development+Environment))

# ruby-on-rails - 你如何验证 attachment_fu 的图像宽度和高度？

> ID：500059
> 
> 赞同：1
> 
> 时间：2009-02-01T02:43:33.230
> 
> 标签：ruby-on-rails, ruby, image, attachment-fu

我希望能够验证图像是否完全具有一定的高度或一定的高度，或者它是否是正方形的。

在模型的验证块中`has_attachment`，当我尝试访问`image_size`、`width`或`height`时，它总是显示为空。

如果您想了解更多详细信息，我还在[这里](http://oss.techno-weenie.net/discussions/attachment_fu/5-attachment_fu-validate-widthheight)问了这个问题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-08-12T14:01:29.930

是的，你需要破解一下才能让它工作，但不是那么多。改编自 attachment_fu 自带的图像处理器：

```
 validate :validate_image_size

  private

  def validate_image_size
    w, h = width, height

    unless w or h
      with_image do |img|
        w, h = img.columns, img.rows
      end
    end

    errors.add(:width, "must less than 250px")  if w > 250
    errors.add(:height, "must less than 250px")  if h > 250
  end
end 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-01T03:03:22.503

您尚未指定您正在使用的语言和系统。

尽管如此，对于大多数 Web 框架，我认为这是使用[图像魔术](http://www.imagemagick.org/script/index.php)的标准方法。尝试[识别功能。](http://www.imagemagick.org/script/identify.php).

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T04:49:43.257

你看过迷你魔术吗？

你可以从这里 git clone 它：

[http://github.com/probablycorey/mini_magick/tree/master](http://github.com/probablycorey/mini_magick/tree/master)

如果您需要了解 git，请查看以下链接：

[http://git.or.cz/course/svn.html](http://git.or.cz/course/svn.html)（与 git 的速成课程，与颠覆相比）

[http://github.com/guides/git-screencasts（github](http://github.com/guides/git-screencasts)截屏）

它是 imagemagick 函数的红宝石包装器（不确定 attachment_fu 是否在内部使用它），但它绝对比 RMagick 更好（RMagick 非常臃肿，有很多内存问题）。Anywho, mini-magick 会让你做你需要做的所有事情，然后做一些事情。查看上面 github 链接中列出的 README，它将为您提供如何使用它的概要。

这是一个片段：

```
#For resizing an image
image = MiniMagick::Image.from_file("input.jpg")
image.resize "100x100"
image.write("output.jpg")

#For determining properties of an image...
image = MiniMagick::Image.from_file("input.jpg")
image[:width] # will get the width (you can also use :height and :format) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-13T08:39:26.693

我认为您缺少应该安装的必备 gem，以便使用 attachment_fu 调整图像大小。我使用了依赖于以下 gems 的 attachment_fu 插件

1.  rmagick-2.11.0

2.  image_science-1.2.0

确保您已经安装了 gems 并更改了 has_attachment 中的宽度和高度，然后您可以看到更改。

祝你好运 ！

# c# - 使用 asp.net 会员提供程序如何检查用户是否已注册？

> ID：500061
> 
> 赞同：16
> 
> 时间：2009-02-01T02:44:28.470
> 
> 标签：c#, .net, asp.net, membership, provider

使用 asp.net 和 c# 会员提供程序如何检查用户是否已注册？我想在代码中处理这个而不是使用“登录状态”？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-02-01T02:54:53.440

不确定您是否想知道他们是“注册”用户还是已登录（如登录状态所示）

这是要知道他们是否已登录（登录状态使用什么）：

```
System.Web.HttpContext.Current.User.Identity.IsAuthenticated; 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-01T02:55:14.237

```
MembershipProvider.GetUser(string username, bool updateLastActivityDateTime) 
```

这将获取您的用户，或者返回null的用户不存在（尚未注册）

# c# - c# GDI 边缘空白检测算法

> ID：500069
> 
> 赞同：7
> 
> 时间：2009-02-01T02:52:04.243
> 
> 标签：c#, algorithm, graphics, bitmap

我正在寻找一种从 c# 托管 GDI+ 库中**检测 c# 位图边缘空白的解决方案。**

图片要么是**透明**的，要么是**白色**的，大多数 400 倍的图片是 8000x8000 像素，边缘有大约 2000 像素的空白。

找出边缘、**x、y、高度和宽度坐标**的最有效方法是什么？我尝试逐个像素地运行，但发现它非常慢。

**解决方案更新——** 添加了左/右/上/下边界

图像细节中心图像的问题，现在裁剪任何透明 (0%) 或白色 (#FFFFFF) 像素。

```
var top = bitmap.Height;
var left = bitmap.Width;
var right = 0;
var bottom = 0; 
```

...

```
var pData = pData0 + (y * data.Stride) + (x * 4);
var xyAlpha = pData[3];
var xyBlue = pData[0];
var xyGreen = pData[1];
var xyRed = pData[2];
if ((xyAlpha > 0) || (xyRed != 255 && xyGreen != 255 && xyBlue != 255)) {
    if (y < top)
        top = y;
    if (y > bottom)
        bottom = y;
    if (x < left)
        left = x;
    if (x > right)
        right = x;
} 
```

...

```
var cropWidth = right - left;
var cropHeight = bottom - top;
var cropX = top;
var cropY = left;

var cacheBitmap = new Bitmap(cropWidth, cropHeight, PixelFormat.Format32bppArgb);
using (var cacheGraphics = Graphics.FromImage(cacheBitmap)) {
    cacheGraphics.DrawImage(context.Image, new Rectangle(0, 0, cropWidth, cropHeight), cropX, cropY, cropWidth, cropHeight, GraphicsUnit.Pixel);
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-01T03:11:13.190

[Bob Powell 的 GDI+ 常见问题解答](https://web.archive.org/web/20141230145656/http://bobpowell.net/faqmain.aspx)是一个很棒的 GDI+ 资源！

你没有说你是如何访问图像中的像素的，所以我假设你使用了慢速 GetPixel 方法。您可以使用指针和 LockBits 以更快的方式访问像素：[请参阅 Bob Powells 对 LockBits 的解释](https://web.archive.org/web/20141229164101/http://bobpowell.net/lockingbits.aspx)

*   这将需要一个不安全的代码块 - 如果您不想要这个或者您没有 FullTrust，您可以使用此处解释的技巧：[J. Dunlap 的 .NET 中的无指针图像处理](http://www.codeproject.com/KB/GDI-plus/pointerlessimageproc.aspx)

下面的代码使用 LockBits 方法（对于 PixelFormat.Format32bppArgb），并将使用发现图像中第一个和最后一个像素的值填充起点和终点，这些像素没有参数颜色中描述的颜色。该方法还会忽略完全透明的像素，如果您想检测可见“内容”开始的图像区域，这很有用。

```
 Point start = Point.Empty;
    Point end = Point.Empty;

    int bitmapWidth = bmp.Width;
    int bitmapHeight = bmp.Height;

    #region find start and end point
    BitmapData data = bmp.LockBits(new Rectangle(0, 0, bitmapWidth, bitmapHeight), ImageLockMode.ReadOnly, PixelFormat.Format32bppArgb);
    try
    {
        unsafe
        {
            byte* pData0 = (byte*)data.Scan0;
            for (int y = 0; y < bitmapHeight; y++)
            {
                for (int x = 0; x < bitmapWidth; x++)
                {
                    byte* pData = pData0 + (y * data.Stride) + (x * 4);

                    byte xyBlue = pData[0];
                    byte xyGreen = pData[1];
                    byte xyRed = pData[2];
                    byte xyAlpha = pData[3];

                    if (color.A != xyAlpha
                            || color.B != xyBlue
                            || color.R != xyRed
                            || color.G != xyGreen)
                    {
                        //ignore transparent pixels
                        if (xyAlpha == 0)
                            continue;
                        if (start.IsEmpty)
                        {
                            start = new Point(x, y);
                        }
                        else if (start.Y > y)
                        {
                            start.Y = y;
                        }
                        if (end.IsEmpty)
                        {
                            end = new Point(x, y);
                        }
                        else if (end.X < x)
                        {
                            end.X = x;
                        }
                        else if (end.Y < y)
                        {
                            end.Y = y;
                        }
                    }
                }
            }
        }
    }
    finally
    {
        bmp.UnlockBits(data);
    }
    #endregion 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-01T03:26:55.030

我首先要确保使用 Patrick 描述的 LockBits 方法。其次，我会检查中间线上的像素以快速确定边缘。中间线我的意思是，如果您说例如 2000x1000 图像，您首先会沿着水平线编号 500（1000 中）查找左右界限，然后沿着垂直线编号 1000（2000 中）找到上限和下限。这种方式应该非常快。

# asp.net - 您的灾难恢复计划是什么？

> ID：500090
> 
> 赞同：2
> 
> 时间：2009-02-01T03:06:05.040
> 
> 标签：asp.net, sql-server, web-applications, recovery, failover

对于具有不太大的 SQL 服务器数据库（大约 10Gb）的 ASP Net Web 应用程序，您会推荐什么？

我只是想知道，配置 Amazon EC2 实例以在紧急情况下托管您的应用程序是个好主意吗？

在这种情况下，保持数据库更新的最佳方法是什么（日志传送？手动备份恢复？）以及更改 dns 设置的最简单和最快的方法是什么？

编辑：可接受的停机时间在 4 到 6 小时之间，这就是为什么我考虑使用 Amazon ec2 选项，因为与租用辅助服务器相比，它的成本更低。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-01T03:44:45.353

**更新**- 刚刚看到你的评论。带有日志传送功能的 Amazon EC2 绝对是必经之路。不要使用镜像，因为这通常假定另一个备用数据库可用。如果您将 TTL 设置为该值，则更改 DNS 的时间不应超过 1/2 小时。这将使您有时间集成任何待处理的日志。可能一周左右打开一次服务器，只是为了集成待处理的日志（或者更少，以避免增加每小时的成本。）

* * *

您的主要托管位置应在所有级别都有冗余：

*   多个互联网连接，
*   多个防火墙设置为故障转移，
*   多个集群网络服务器，
*   多个集群数据库服务器，
*   如果您存储文件，请使用 SAN 或 Amazon S3，
*   每台服务器都应该有某种形式的 RAID，具体取决于服务器的用途，
*   每台服务器都可以有多个 PSU 连接到单独的电源/断路器，
*   外部和内部服务器监控软件，
*   停电时自动启动的发电机，以及备用发电机。

在大多数故障情况下，这将使您在主要位置运行。

然后在远程位置设置一个服务器，该服务器使用日志传送保持更新，并将其包含在您的部署脚本中（在更新您的正常生产服务器之后......）该国另一端的托管服务器非常适合这些目的。为了最大限度地减少不得不切换到辅助位置的停机时间，请将 DNS 记录上的 TTL 保持在您认为合适的水平。

当然，如此多的硬件会变得很陡峭，因此您需要确定什么值得停机 1 秒、1 分钟、10 分钟等，并相应地进行调整。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-01T03:24:56.250

这完全取决于您的停机时间要求。如果为了不失去数十亿美元的业务，你必须在几秒钟内*得到*支持，那么你做的事情就会有很大不同，如果你有一个每月可以赚到 1000 美元的网站，而且它的收入停一天也不会受到太大影响。

我知道这不是一个特别有用的答案，但这是一个很大的领域，有很多变量，如果没有更多信息，几乎不可能推荐一些真正适合你情况的东西（因为我们真的不知道你的情况是）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-01T13:49:58.283

坚如磐石的灾难恢复策略的起点是首先计算出服务器/平台停机对业务的真正成本。

以下文章将帮助您开始正确的路线。

[https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-10878_11-1038783.html](https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-10878_11-1038783.html)

如果您需要进一步的指导，好的旧谷歌可以提供更多的阅读。

这种性质的项目需要您与关键业务决策者合作，并且您需要与他们沟通停机时间的相关成本以及业务影响。您可能需要与多个业务部门协作才能收集所需的信息。然后，您需要共同决定什么是您的业务可接受的停机时间。只有这样，您才能设计出满足这些要求的 DR 策略。

您还会发现，进行此练习可能会突出您的平台当前配置在高可用性方面的缺点，这可能还需要作为一个备用项目进行审查。

从所有这些中删除的关键点是，关于什么是可接受的停机时间的决定不是由 DBA 单独决定，而是提供必要的信息和专家知识，以便做出现实的决定。您的任务是实施可以满足业务需求的策略。

不要忘记通过执行测试场景来测试您的 DR 策略，以验证您的恢复时间并练习该过程。如果到了需要实施 DR 策略的时候，您可能会面临压力，您的手机会频繁响起，人们会像蚊子一样在您周围徘徊。已经磨练并练习了您的 DR 响应，您可以有信心控制情况，实施恢复将是一个顺利的过程。

祝你的项目好运。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-04-27T19:16:15.803

我没有使用不同的第三方工具，但我体验过 cloudendure，至于你得到的副本，我可以说它是一个非常高端的产品。复制是在非常小的时间间隔内完成的，这使得您的副本非常可靠，但我可以看到您不需要在几秒钟内备份您的网站，因此也许要求报价或与不同的供应商脱身可能会有所帮助。

# c# - C# 中的后备访问器？

> ID：500096
> 
> 赞同：3
> 
> 时间：2009-02-01T03:12:08.383
> 
> 标签：c#, accessor

C# 有类似 Python 的东西`__getattr__`吗？

我有一个具有许多属性的类，它们都共享相同的访问器代码。我希望能够完全删除单个访问器，就像在 Python 中一样。

这是我的代码现在的样子：

```
class Foo
{
    protected bool Get(string name, bool def)
    {
        try {
            return client.Get(name);
        } catch {
            return def;
        }
    }

    public bool Bar
    {
        get { return Get("bar", true); }
        set { client.Set("bar", value); }
    }

    public bool Baz
    {
        get { return Get("baz", false); }
        set { client.Set("baz", value); }
    }
} 
```

这就是我想要的：

```
class Foo
{
    public bool Get(string name)
    {
        try {
            return client.Get(name);
        } catch {
            // Look-up default value in hash table and return it
        }
    }

    public void Set(string name, object value)
    {
        client.Set(name, value)
    }
} 
```

有没有办法在 C# 中实现这一点而无需`Get`直接调用？

谢谢，

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-01T03:34:21.333

不。虽然 C# 支持反射，但它是只读的（对于加载的程序集）。这意味着您不能更改任何方法、属性或任何其他元数据。虽然你可以[创建一个动态属性](http://msdn.microsoft.com/en-us/library/h1zby21a.aspx)，但调用它不是很方便——它甚至比使用你的`Get`方法更糟糕。除了`Dictionary<string, object>`为您的班级使用 a 和索引器之外，您无能为力。无论如何，如果你有这么多属性，做字典不是更好吗？

Python 不会在“编译时”（或至少在加载时）检查属性是否存在。C# 可以。这是两种语言之间的根本区别。在 Python 中，您可以执行以下操作：

```
class my_class:
    pass

my_instance = my_class()
my_instance.my_attr = 1
print(my_instance.my_attr) 
```

在 C# 中，您将无法这样做，因为 C# 实际上会`my_attr`在编译时检查名称是否存在。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T05:12:14.163

我不确定，但也许 4.0 版的动态特性会帮助你。不过，您将不得不等待...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-01T08:53:06.590

我可以问：你*为什么*不想要个别属性？这是表达与对象关联的数据的惯用 .NET 方式。

就个人而言，假设数据不是稀疏的，我会保留属性并让整体方法使用反射 - 这将使您的编译代码尽可能快：

```
 protected T Get<T>(string name, T @default)
    {
        var prop = GetType().GetProperty(name);
        if(prop == null) return @default;
        return (T) prop.GetValue(this, null);
    } 
```

当然，如果您不关心定义的属性本身，那么索引器和查找（例如字典）就可以了。您还可以使用 postsharp 做一些事情，将一组属性变成一个属性包——不过，这可能不值得。

If you want the properties available for data-binding and runtime discovery, but can't define them at compile-time, then you would need to look at dynamic type descriptors; either `ICustomTypeDescriptor` or `TypeDescriptionProvider` - a fair bit of work, but very versatile (let me know if you want more info).

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-01T03:33:47.387

这与您在 Python 中使用动态属性名称获得的不同，但您可能会发现它很有用：

```
using System;
using System.Collections.Generic;

namespace Program
{
    class Program
    {
        static void Main(string[] args)
        {
            MyList<int> list = new MyList<int>();
            // Add a property with setter.
            list["One"] = 1;
            // Add a property with getter which takes default value.
            int two = list["Two", 2];
            Console.WriteLine("One={0}", list["One"]);
            Console.WriteLine("Two={0} / {1}", two, list["Two"]);
            try
            {
                Console.WriteLine("Three={0}", list["Three"]);
            }
            catch
            {
                Console.WriteLine("Three does not exist.");
            }
        }
        class MyList<T>
        {
            Dictionary<string, T> dictionary = new Dictionary<string,T>();

            internal T this[string property, T def]
            {
                get
                {
                    T value;
                    if (!dictionary.TryGetValue(property, out value))
                        dictionary.Add(property, value = def);
                    return value;
                }
            }
            internal T this[string property]
            {
                get
                {
                    return dictionary[property];
                }
                set
                {
                    dictionary[property] = value;
                }
            }
        }
    }
} 
```

# uiwebview - iPhone 应用程序中的 Web 图像显示

> ID：500104
> 
> 赞同：0
> 
> 时间：2009-02-01T03:19:01.460
> 
> 标签：uiwebview, iphone

我是在 iPhone 上开发的新手，所以如果这是一个简单的问题，我很抱歉，但这让我有一段时间感到困惑。

基本上，该应用程序显示从 XML 提要中检索到的数据。在该提要中是一个包含图像路径的元素。例如[http://www.myserver.com/myimage.jpeg](http://www.myserver.com/myimage.jpeg)。

**我希望能够在我的 iPhone 应用程序的列表视图中显示该图像。**

最重要的是，我不想停止每个图像的列表绘制，其余数据应立即显示，然后每个图像下载并以数据速度等使其可用的速度显示。

**下载该图像并显示它的最佳方式是什么？**

理想情况下，有人可以指出一些工作示例代码。

谢谢斯蒂芬

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-01T05:26:30.873

显示图像：您可以创建一个 UIWebView 并将其指向路径 - 然后它也可以完全缩放。

在列表视图中显示：

```
//Somehow download your image...
cell.image = Your Image 
```

# wordpress - Wordpress 博客 :: 500 内部服务器错误

> ID：500105
> 
> 赞同：0
> 
> 时间：2009-02-01T03:19:08.727
> 
> 标签：wordpress, internal-server-error

我在尝试访问安装在目录中的 wordpress 博客时收到此错误消息。这是由于 .htaccess 还是什么？任何帮助表示赞赏。

> 服务器遇到内部错误或配置错误，无法完成您的请求。
> 
> 请联系服务器管理员 webmaster@xxxxx.com 并告知他们错误发生的时间，以及您所做的任何可能导致错误的事情。
> 
> 服务器错误日志中可能提供有关此错误的更多信息。

此外，在尝试使用 ErrorDocument 处理请求时遇到 404 Not Found 错误。

xxxx.com 端口 80' 的 Apache 服务器

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-01T03:31:51.277

这几乎总是您的 Apache 配置的问题。源自 PHP 的错误不会触发 Apache 5xx 处理程序，这就是您所看到的。

不幸的是，如果没有更多信息，您的问题就无法诊断。我建议你：

1.  **检查日志。**第一件事！它应该让您更好地了解问题出在哪里。
2.  停止并重新启动 Apache。如果 Apache 需要写入权限（日志）的权限存在问题，它可能会**完全无法启动**。这应该给您解决问题的适当动力，特别是如果该 Apache 上有其他虚拟主机。
3.  将您的`.htaccess`文件移动到其他地方。如果 Apache 工作正常，您就知道该文件有问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-01T03:23:29.467

听起来您遇到了某种 PHP 错误，但 PHP 未设置为显示错误。您需要检查 Apache 日志以获取详细的错误信息。

最可能的罪魁祸首是您缺少运行 WordPress 的一些先决条件，尽管您真正需要的只是 Apache、MySQL 和 mod_rewrite。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-03-08T13:18:05.077

我能够通过将以下行添加到我的 .htaccess 文件来修复它：

> php_value memory_limit 128M

拉斯

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-01T03:26:06.483

不幸的是，它可能是任何东西。网站上的静态页面是否正常工作。

你检查过服务器日志吗？

我认为这可能与php有关。如果存在静态页面，那么您的 wordpress 配置可能配置不正确或文件丢失。

php工作了吗？博客工作然后停止了吗？您是否通过了安装过程？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-03-21T22:52:11.237

Look at [http://zemalf.com/1470/wordpress-htaccess-the-definite-guide/](http://zemalf.com/1470/wordpress-htaccess-the-definite-guide/), and look for the paragraph which says something like "Good and default .htaccess looks like this...."

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-11-02T22:45:44.697

我的问题有点不同。我`.htaccess`在目录中有一个文件`wp-admin`。我删除了`.htaccess`内部`wp-admin`并解决了我的问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-01-26T05:08:55.833

这正在发生在我身上。

据我所知，我的托管服务提供商进行了 DNS 更改，所以我正在等待 DNS 传播，已经过了三个小时，但仍然为零。

博客显示正常，apache 启动并正常工作，我只是无法访问 WP 管理区域。

如果明天解决了，我会在这里回复，以便对其他人有所帮助。

编辑：我刚刚解决了我的问题。

就我而言，已确定是快速联系表单插件造成了问题。我将文件夹名称从 si-contact-form 修改为 si-contact-form-hold 然后我重新获得了 WP 管理员访问权限。

之后，我在 'memory=64MB' 中创建了一个包含此字符串的 php.ini 文件，并将其保存到 wp-admin 文件夹中。

手动删除 si-contact-form-hold（以避免可能的文件损坏）并重新安装快速联系表。

我所有的设置都已经在那里了，一切都恢复正常了！

希望这可以帮助。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-07-12T10:26:04.690

检查用户的 wordpress 文件所有权是否正确。

在 linux`ls -laZ`命令中会显示所有权。

要设置文件夹的所有权，请使用此命令

```
chown -R username:username /user/username/public_html/ 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-01T03:23:52.010

HTTP 500 错误可能由很多原因引起。您最近是否更改了 .htaccess 文件？如果您尝试使用在您的主机上禁用的 .htaccess 功能，这是可能的原因之一。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-01T04:03:11.243

还有几点

*   博客已成功运行。从昨天开始就观察到这个问题。
*   博客位于一个目录中，因此它的工作方式类似于 www.xyz.com/blog。显然 www.xyz.com 运行良好。

更新日志

在日志中获取这两个错误：

1.  文件不存在：/home/directory/public_html/500.shtml
2.  /home/sub-directory/public_html/sub-directory/.htaccess: RewriteCond: 错误的参数行 '%{REQUEST_FILENAME}!-f'
3.  /home/directory/public_html/sub-directory/.htaccess: # 不匹配 # section

如何在 cpanel 上重新启动 apache？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-10-12T17:50:42.373

```
 memory = 64MB; 
```

上传到 wp-admin 文件夹的 php.ini 文件中的上述行解决了我的问题。我无法通过 /wp-admin 或 /wp-login.php 登录仪表板，并且收到 HTTP 服务器错误 500。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-05-24T00:31:02.157

这可能有多种原因，我刚刚解决了我的问题，经过 2-3 个小时的疯狂。**我在主 WP 实例**（在根文件夹中）的子目录中有另一个 WP 实例。

*   已检查/删除 .htaccess
*   删除插件文件夹

最后，这与运行第二个实例的子文件夹的权限有关。它最初是**775**（组的写入权限），我不得不将其更改为**755**（组的写入权限），这最终修复了它，就像魔术一样。

这当然只是您问题的可能答案之一，我想把它写下来，因为我没有发现它在任何地方明确写，所以它可能会节省其他人一些时间。

# html - 如何创建两个相同高度的桌子？

> ID：500130
> 
> 赞同：3
> 
> 时间：2009-02-01T03:36:37.117
> 
> 标签：html, html-table

我希望两张桌子具有相同的高度。如果左表包含比右表更长的文本，我希望它与左表一样长。

这是它现在的样子：

![在此处输入图像描述](https://i.stack.imgur.com/aCoOR.png)

我不能设置高度，因为这会限制你可以写多少文字......

这就是我想要的：

![在此处输入图像描述](https://i.stack.imgur.com/Ah1iS.png)

代码：

```
<table cellspacing="0" width="30%" align="left" class="rowA">
<tr>
    <td>
    Sed ut perspiciatis unde omnis iste natus error sit voluptatem 
    accusantium doloremque laudantium, totam rem aperiam, eaque ipsa 
    quae ab illo inventore veritatis et quasi architecto beatae vitae dicta 
    sunt explicabo. "Sed ut perspiciatis unde omnis iste natus error sit 
    voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque 
    ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae 
    dicta sunt explicabo. 
    </td>
</tr>
</table>

<table cellspacing="0" width="70%" align="right" class="rowB">
<tr>
    <td>
    Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do 
    eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut 
    enim ad minim veniam, quis nostrud exercitation ullamco laboris 
    nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor 
    in reprehenderit in voluptate velit esse cillum dolore eu fugiat
    nulla pariatur. Excepteur sint occaecat cupidatat non proident, 
    sunt in culpa qui officia deserunt mollit anim id est laborum.
    </td>
</tr>
</table> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-01T03:47:35.817

您可以使用两个并排的单元格来代替吗？

```
<table>
  <tr>
    <td style="width: 30%">Left Column</td>
    <td style="width: 70%">Right Column</td>
  </tr>
</table> 
```

**编辑**- 只是为了完整性......如果出于技术原因有人必须使用两个单独的容器，例如 div 或表格，但您需要它们具有相同的高度，那么有一个[小的 jQuery 脚本](http://www.filamentgroup.com/lab/setting_equal_heights_with_jquery/)可以很好地降低性能。它确定最高的容器，然后设置另一个容器的 min-height 属性以匹配。

# python - 我可以使用用户 Windows 登录自动登录到 Web 应用程序吗？

> ID：500134
> 
> 赞同：3
> 
> 时间：2009-02-01T03:37:44.480
> 
> 标签：python, authentication, web-applications, windows-authentication

在我的兼职工作（与 IT 无关）的 Intranet 上，我们使用了各种不需要显式登录的 Web 应用程序。显然，我们需要登录到 Windows，然后以某种方式对我们进行身份验证。

我想知道这是怎么做到的？无需过多担心安全性，我将如何使用 Windows 登录信息对 Web 应用程序的用户进行身份验证？我会使用 Python（和 Django）。

对如何实现这一点有限制吗？例如，是否需要特定的浏览器？应用程序和 Intranet 后端是否必须托管在同一位置或至少必须进行通信？还是只是简单地获取用户的 Windows 凭据，并将其传递给 Web 应用程序的身份验证软件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-01T03:50:06.123

曾几何时，Internet Explorer 支持 NTLM 身份验证（类似于基本身份验证，但它将缓存的凭据发送到服务器，可以通过域控制器进行验证）。它用于在希望每个人都登录到域的 Intranet 中启用单点登录。我不记得它的细节，而且我已经很久没有使用它了。如果它符合您的需求，它可能仍然是一种选择。

也许更熟悉它的人可能有更多细节。

请参阅：[HTTP 的 NTLM 身份验证方案](http://www.innovation.ch/personal/ronald/ntlm.html)

使用非微软服务器框架的棘手部分是与必要的服务进行对话以验证凭据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T04:20:08.450

从[这里](http://www.djangosnippets.org/snippets/501/)：

```
-- Added to settings.py --

### ACTIVE DIRECTORY SETTINGS

# AD_DNS_NAME should set to the AD DNS name of the domain (ie; example.com)  
# If you are not using the AD server as your DNS, it can also be set to 
# FQDN or IP of the AD server.

AD_DNS_NAME = 'example.com'
AD_LDAP_PORT = 389

AD_SEARCH_DN = 'CN=Users,dc=example,dc=com'

# This is the NT4/Samba domain name
AD_NT4_DOMAIN = 'EXAMPLE'

AD_SEARCH_FIELDS = ['mail','givenName','sn','sAMAccountName']

AD_LDAP_URL = 'ldap://%s:%s' % (AD_DNS_NAME,AD_LDAP_PORT)

-- In the auth.py file --

from django.contrib.auth.models import User
from django.conf import settings
import ldap

class ActiveDirectoryBackend:

  def authenticate(self,username=None,password=None):
    if not self.is_valid(username,password):
      return None
    try:
      user = User.objects.get(username=username)
    except User.DoesNotExist:
      l = ldap.initialize(settings.AD_LDAP_URL)
      l.simple_bind_s(username,password)
      result = l.search_ext_s(settings.AD_SEARCH_DN,ldap.SCOPE_SUBTREE, 
               "sAMAccountName=%s" % username,settings.AD_SEARCH_FIELDS)[0][1]
      l.unbind_s()

      # givenName == First Name
      if result.has_key('givenName'):
        first_name = result['givenName'][0]
      else:
        first_name = None

      # sn == Last Name (Surname)
      if result.has_key('sn'):
        last_name = result['sn'][0]
      else:
        last_name = None

      # mail == Email Address
      if result.has_key('mail'):
        email = result['mail'][0]
      else:
        email = None

      user = User(username=username,first_name=first_name,last_name=last_name,email=email)
      user.is_staff = False
      user.is_superuser = False
      user.set_password(password)
      user.save()
    return user

  def get_user(self,user_id):
    try:
      return User.objects.get(pk=user_id)
    except User.DoesNotExist:
      return None

  def is_valid (self,username=None,password=None):
    ## Disallowing null or blank string as password
    ## as per comment: http://www.djangosnippets.org/snippets/501/#c868
    if password == None or password == '':
      return False
    binddn = "%s@%s" % (username,settings.AD_NT4_DOMAIN)
    try:
      l = ldap.initialize(settings.AD_LDAP_URL)
      l.simple_bind_s(binddn,password)
      l.unbind_s()
      return True
    except ldap.LDAPError:
      return False 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T05:15:19.010

据我所知，唯一能自动传递您的登录凭据的浏览器是 Internet Explorer。要启用此功能，请在安全部分下的高级 Internet 选项对话框中选择“启用集成 Windows 身份验证”。这通常默认启用。

Web 服务器必须从 Web 应用程序中删除匿名用户权限并选中启用 Windows 身份验证选项。只需将您想要访问 Web 应用程序的用户添加到文件/文件夹权限即可。

我只在 IIS 上尝试过，所以我不确定它是否可以在其他 Web 服务器上运行。

# ruby-on-rails - Ruby on Rails 的“WebControls”

> ID：500141
> 
> 赞同：1
> 
> 时间：2009-02-01T03:42:39.867
> 
> 标签：ruby-on-rails, controls, components

我最近开始为一些项目使用 RoR，我非常喜欢这个框架 - 但是来自 ASP.NET 背景，我非常喜欢能够购买和放入可重用组件/控件的想法，例如来自Telerik，无需“重新发明”。

我想也许可以使用部分或插件或类似的东西来创建我自己的，但我想知道是否已经有任何东西，或者可能是可以按摩到位的替代品，比如 javascript 小部件等？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-01T03:47:25.770

我不知道任何商业组件或“控件”，但是有成千上万的插件（可能我没有计算过）免费提供，可以为您做很多事情，其中​​一些可能算作“控制”。不幸的是，没有地方可以找到它们，而且质量变化无常，但是有许多插件索引，例如[http://agilewebdevelopment.com/plugins/](http://agilewebdevelopment.com/plugins/)可能有助于在清除浮渣。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-01T03:44:54.353

[Ext JS](http://extjs.com/)是一个很棒的 GUI 工具包。我不能说它完全符合 RoR 的做事方式，但如果你编写控制器来返回 JSON，那也不错。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T07:38:29.283

[Dojo](http://dojotoolkit.org/)有[一个小部件库](http://dojotoolkit.org/book/dojo-book-0-9/part-2-dijit-0)，可以满足您的需求。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-01T11:03:07.823

Ruby/Rails 和 .Net 世界之间的一大区别是大多数可用插件都是开源的并且在代码级别集成。Rails 有一系列令人难以置信的插件，编写自己的插件非常简单。由于 Ruby 的特性，您可以连接到语言和框架的任何部分，从而为您提供令人印象深刻的可扩展性。

我不确定 Web 控件是如何工作的，但听起来它们像是一个“黑盒”，为 UI 和数据级操作提供了端到端的解决方案……？

许多 Rails 插件确实提供了 UI 和数据方面。一个例子是“restful_authentication”，它为您提供了一些用于登录和用户注册的基本表单以及一个身份验证模块和一个 Active-Record 模型。同样，这在代码级别运行，因此当您安装和“生成”身份验证模块时，实际上会将相关代码推送到您的代码库中。

至于“widgets”，Rails 本身没有等价物，但有许多 JavaScript 库提供了类似的功能。我自己使用并推荐 jQuery UI。

# php - 对于使用 php 进行 CRUD，而不使用任何框架、cakePHP、Smarty，将 php 代码组织成文件的最佳方法是什么？

> ID：500161
> 
> 赞同：2
> 
> 时间：2009-02-01T03:53:07.147
> 
> 标签：php

假设我有一个数据库表“小部件”

是否应该有一个带有针对不同操作的大 switch 语句的 index.php，例如“list_widgets”、“edit_widget”、“new_widget”、“delete_widget”……然后将这些操作中的每一个放在一个单独的文件中？

或者，应该有list_widgets.php、edit_widget.php、delete_widget.php……

还是其他方式？

编辑（阅读第一个答案后）。我真的在问，我硬盘上的文件的名称是什么。如果我要创建一个只编辑单个小部件表的网站，那么我的硬盘驱动器上该项目的文件名称是什么？

（我现在避免使用框架的动机是这个项目是 php 和 mysql 的学习练习，所以我不希望任何事情自动发生）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-01T03:55:31.103

我将创建一个 Widget 类并为其提供 edit()、new() 和 delete() 方法。然后你可以在某个地方有一个 list() 函数来构建一个 Widget 实例数组。我可能会继续创建一个 WidgetList 类 ( **WidgetList.php** )，即使它最初只是一个数组的包装器。

最初，我只需要一个用于该类的**Widget.php**文件和一个用于处理各种请求的 index.php。

我总是确保包含我的类的文件与类本身具有相同的名称（通常每个文件一个）。这使得找出东西在哪里变得更容易，并且更容易使用**__autoload**函数。

然后我会有一个**.htaccess**文件来创建友好的 url，这些 url 将不同类型的请求发送到**index.php**。大致是这样的：

```
Options ExecCGI FollowSymLinks Includes MultiViews

RewriteEngine On
RewriteRule /new index.php?action=new
RewriteRule /edit/([0-9]+) index.php?action=edit&widget_id=$1 
```

你如何处理 url 取决于你的小部件实际上是如何工作的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T04:17:13.930

如果这是一个 PHP 学习练习，那么您的目标到底是什么？你想实现一个完整的 MVC 架构（只是为了练习）？您想使用将请求路由到特定控制器的前端控制器吗？或者您想构建一个简单的脚本站点，该站点只能编辑您的小部件表？

如果是前者，那么我建议您阅读其中一个框架（我特别喜欢 Zend 框架）的文档和源代码，然后实现您自己的 MVC 和/或前端控制器版本。此外，您可以阅读[Rasmus Lerdorf 的这篇文章，](http://toys.lerdorf.com/archives/38-The-no-framework-PHP-MVC-framework.html)其中 Rasmus 讨论了如何在不使用现有框架的情况下构建简单的 MVC 应用程序。

如果您只是想完成后者（编辑小部件表），我建议您保持简单。所以我会：

*   创建一个文件 (WidgetsTable.php)，其中包含直接与表交互的函数。例如 insert()、update()、delete()、fetchAll()、createNew()
*   创建一个您将直接与之交互的文件（index.php 或 widgets.php）（在某些范例中，这将是页面控制器）。该文件将包含 createAction()、listAction()、findAction()、showFormAction() 等函数。这将是调用的页面，并且此页面中的函数将与您在第一个文件中创建的函数（或类方法）交互。
*   创建一个名为views 或templates 的文件夹，并为widgets.php 中的每个操作创建一个相应的视图或模板文件。例如，您将创建 list.php、showForm.php、create.php。

这将确保您有适当的关注点分离，并且如果您发现需要，它将更容易调整整体项目结构。

祝你的学习项目好运！:-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T04:10:50.900

如果它是 /widget/edit.php 或 /widget/new.php 可能会更容易查看文件结构

这样，您只需知道模块名称和他们想要执行的操作，就可以将人们重定向到其他模块。

这也将允许您更轻松地实现 url 重写，因此一旦您获得 index.php 和一些重写规则，它就会看起来像 widget/edit/2。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-01T09:12:34.037

我敢肯定这可能是个人喜好问题，但我发现为 1 个表创建 3 个文件（列表、添加、编辑）足够灵活，同时又易于理解，尤其是对于 php 新手。

这样，每当您需要在另一个表上执行 CRUD 时，只需为其创建另外 3 个文件。

```
...
includes/
views/
add_member.php
edit_member.php
list_member.php
add_widget.php
edit_widget.php
list_widget.php
... 
```

带有`includes/`存放配置和函数文件的`views/`文件夹以及包含要包含的各种片段文件的文件夹，例如页眉、导航、页脚等。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-02-01T04:28:57.480

你有没有看过[http://www.phpobjectgenerator.com/](http://www.phpobjectgenerator.com/)

它为数据库表生成非常好的 CRUD 格式对象。

# asp.net-profiles - 成功构建后，web.config 中的 ASP.NET 配置文件部分消失

> ID：500165
> 
> 赞同：0
> 
> 时间：2009-02-01T03:55:48.920
> 
> 标签：asp.net-profiles

我正在尝试向 ASP.NET web.config 文件添加一个部分，以使用默认配置文件提供程序。这是我在 system.web 节点中添加到 web.config 的内容：

```
<profile defaultProvider="AspNetSqlProfileProvider">
        <providers>
            <clear/>
            <add name="AspNetSqlProfileProvider"
                 type="System.Web.Profile.SqlProfileProvider, System.Web, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"
                 connectionStringName="ApplicationServices"
                 applicationName="/"
            />
        </providers>
        <properties>
            <group name="UserDetails">
                <add name="FirstName" />
                <add name="LastName" />
                <add name="BirthDate"
                     type="System.DateTime" />
            </group>
        </properties>
    </profile> 
```

我可以成功构建网站，但是一旦完成，我就会收到提示，提示 web.config 已在编辑器之外进行了修改，我是否要重新加载它。我单击是，配置文件部分消失。web.config 文件中的所有其他内容都保持不变并正常运行。

关于在哪里寻找解决此问题的任何想法？谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-01T08:18:55.597

听起来您正在编辑网站根目录中的输出配置文件，并且构建正在覆盖 ASP.NET 项目中保存的未编辑配置。

# python - Python的timedelta：我不能在我想要的任何时间单位中获得整个差异的值吗？

> ID：500168
> 
> 赞同：14
> 
> 时间：2009-02-01T03:59:27.117
> 
> 标签：python, datetime, timedelta

自从在我的网站上发布了一篇帖子以来，我正在尝试一些聪明的日期（“几秒钟后，几小时后，几周后，等等。”）并且我正在使用存储在 utcnow 和 utc 日期之间的 datetime.timedelta 差异一个帖子的数据库。

看起来，根据文档，我必须使用 days 属性和 seconds 属性来获得我想要的花哨的日期字符串。

我不能在任何时间单位中获得我想要的整个差异的价值吗？我错过了什么吗？

如果我能在几秒钟内获得全部差异，那将是完美的。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2010-08-12T20:22:47.197

似乎 Python 2.7 引入了一个[total_seconds()](http://docs.python.org/library/datetime.html#datetime.timedelta.total_seconds)方法，我相信这正是您所寻找的！

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-02-01T04:17:58.530

您可以以秒为单位计算差异。

```
total_seconds = delta.days * 86400 + delta.seconds 
```

不，你没有“遗漏什么”。它不会在几秒钟内提供增量。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-01T04:24:45.210

> 如果我能在几秒钟内获得全部差异，那将是完美的。

那么“time”模块提供的plain-old-unix-timestamp 可能更符合您的口味。

我个人还没有被“日期时间”中的很多内容说服。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-01T08:34:09.497

就像 bobince 说的，你可以使用时间戳，像这样：

```
# assuming ts1 and ts2 are the two datetime objects
from time import mktime
mktime(ts1.timetuple()) - mktime(ts2.timetuple()) 
```

尽管我认为这比仅计算`timedelta`对象的秒数还要丑陋...

# erlang - 名为 timer_server 的 gen_server 导致定时器模块函数不返回

> ID：500169
> 
> 赞同：2
> 
> 时间：2009-02-01T04:02:30.153
> 
> 标签：erlang, erlang-otp

我创建了一个主管，它产生了一个`gen_server`我称为`timer_server`. 这个`timer_serve`r 的任务之一是管理注册和调用`timer:send_interval`以在某个时间间隔向 pid 发送消息。

但是，在`gen_server`我调用的 init 中，`timer:send_interval`我被锁定了。文档说计时器：函数立即返回，所以这很麻烦。

当我重命名我`gen_server`的`record_timer_server`这个问题时，这个问题就解决了。我的问题是两个方面：

1.  如果我的应用程序启动`timer_server`时已经有一个注册进程，为什么我可以创建一个注册进程？`timer:start()`
2.  一旦启动，为什么这个函数不会导致错误匹配找到名称，如果它正在调用我`timer_server`使用该`send_interval`函数？

我认为代码不是必需的，但如果需要，我可以更新以添加一些代码。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-01T09:05:34.380

这可以通过执行以下挂起对计时器的调用来重新创建：send_interval。

```
1> register(timer_server, self()).
true
2> timer:send_interval(5000, self(), hello). 
```

虽然这失败了......

```
1> timer:send_interval(5000, self(), hello).
{ok,{interval,#Ref<0.0.0.32>}}
2> register(timer_server, self()).
** exited: {badarg,[{erlang,register,[timer_server,<0.30.0>]}, 
```

因此，似乎第一次调用 timer 会尝试启动一个名为 timer_server 的进程，如果您先使用此名称，则会挂起。

至于为什么它挂起 timer.erl 确实：

```
ensure_started() ->
    case whereis(timer_server) of
        undefined -> 
            C = {timer_server, {?MODULE, start_link, []}, permanent, 1000, 
                worker, [?MODULE]}
            supervisor:start_child(kernel_safe_sup, C),  % kernel_safe_sup
            ok;
        _ -> ok
    end. 
```

返回正常，然后是对 timer_server 的 gen_server:call。然后，您的进程会卡住等待自己响应。

# end-user - 您如何鼓励最终用户填写故障单？

> ID：500170
> 
> 赞同：7
> 
> 时间：2009-02-01T04:02:32.727
> 
> 标签：end-user, bug-reporting, trouble-tickets

所以，我在一个相当小的 IT 部门工作。我们有大约一半的最终用户使用的故障票务系统。我的一些同事并没有真正鼓励我们的最终用户使用我们现有的系统。最终结果？经常中断，因为最终用户会通过 IM 联系我们或直接来我们的办公室处理琐碎的事情。这显然会使编写代码变得困难。

现在，我想我可以说“嘿，下次你介意填写一张故障单吗？”，但我会以坏人的身份出现，因为其他人不会这样做。我也不希望最终用户觉得我难以接近。我只是想让他们明白，有一种寻求帮助的适当方法。

那么在这种情况下对我来说最好的事情是什么？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-01T04:45:46.900

**让它有吸引力。**

向用户提及，整个开发团队都会查看故障单问题，并且发现可以更快地得到解决。假设任何没有票的东西都有可能在洗牌中迷失方向。为他们提供面向外部的链接，以便他们可以查看进度和开发人员/支持人员对他们的票证的评论。提供电子邮件提醒，让他们感觉自己是流程的一部分，并获得有关他们问题的即时信息。

**使其尽可能无摩擦。**

使系统的用户输入部分尽可能易于使用和直观。没有人喜欢填票，我*当然*不会跳过任何箍来这样做。无需登录，无需登录，只需输入我的问题和联系信息即可。

**与您的团队交谈。**

最终，除非您的团队和您在同一个页面上，否则在上述系统上的任何努力都将无关紧要。召集团队会议并与他们讨论这个问题。在你的老板在场的情况下，试着用他能理解的方式来表达。提及浪费的宝贵时间、跟踪系统中不存在的客户问题等问题。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-01T04:08:12.140

听起来你的经理让你失望了，因为他们没有强迫用户在获得帮助之前提交工单。问题从那里开始，并且只会持续到您的同事允许这种行为。我们在工作中使用 redmine 来提供应用程序支持，并且在告诉用户“提交工单，我们会调查”方面取得了良好进展，但它必须是所有相关人员的一致声音。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-01T04:16:50.687

对他们使用一点心理学。对于不发送故障票的人，提醒他们，他们部门中 80% 的人都使用票务系统。即使是谎言，也会因为跟风效应而鼓励良好的行为。请记住，这个人与人口统计数据越相似，就越有可能影响他们的行为。所以“你的直接同事”会比“整个公司的人”工作得更好。

使用票务系统的人应该得到一个金星，不，认真的。

二月份的哈佛商业评论有一篇非常简短的文章，关于利用社会压力影响行为。它讨论了一些新的研究，但文章没有包括参考资料。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-01T04:33:18.767

你没有。用户甚至我都讨厌那些东西。相反，您的政策应该是“不要让我思考”。你必须自己收集所有你需要的东西，并以对你的用户不可见的方式自动处理。在他们选择安装后。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-01T04:08:56.943

除非您说服您的同事首先使用该系统，否则您可能不会取得太大进展。在你们都同意所需的流程之后，您就可以与您的用户交谈了。如果您团队中的每个人都遵循相同的规则，您可能会强制您的用户使用系统，方法是为未进入系统的问题设置缓慢的周转时间，或者甚至完全忘记它们。

但是，即使您可以说服您的同事和您的用户输入票证，您可能仍然会发现票证不完整/信息不完整。我们都看过很多票，比如“功能 X 坏了，请修复它”，但没有提供其他信息。根据您每天获得的门票数量，我可能会硬着头皮走过用户，看看他们的第一手问题是什么。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-01T04:54:12.407

在这种情况下，我们经常代表用户记录一张票。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-01T05:19:50.530

在我以前的工作场所，有人告诉我，如果没有故障单，什么都做不了。当我问为什么时，我被告知支持团队的生产力是通过使用故障单来衡量的。这迫使我使用故障单（因为它们是必需的），并给了我这样做的动力（我不希望我的同事看起来很糟糕）。

在我的新工作场所，所有技术支持都外包出去了。我真的必须打电话给技术支持，他们代表我创建了一张票。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-01T20:10:35.723

另外 - 停止鼓励这种行为。使用您的 IM 过滤选项仅在线显示给开发团队。不要检查您的电子邮件 - 或设置过滤器将高优先级的内容（您的老板、您的开发团队）过滤到您的收件箱，并将其他所有内容过滤到您每天或每隔一天检查一次的文件夹中。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-01T20:47:00.407

Simucal 的建议很好。在某些时候，您 - 将 - 必须告诉他们“提交票证”。如果你事后问他们，他们不会在意，因为他们得到了他们需要的东西。

处理这个问题的一个好方法是有一个专门的人来支持。我的团队这样做了，它极大地提高了我们的生产力，并消除了至少 90% 的中断。

除非（或替代），您可以每天轮换谁来处理用户请求。这样做的结果是或多或少需要一张故障单。当其他人开始处理请求时，它需要跟踪请求中发生的事情。随着时间的推移，这也为您的流程带来了更多的凝聚力：人们创建小脚本来执行常见任务，完成的工作被转移到修订控制中，等等。

# c++ - c ++：头函数没有从库正确链接到exe

> ID：500182
> 
> 赞同：0
> 
> 时间：2009-02-01T04:09:19.297
> 
> 标签：c++, linker, inline-functions

我在库（alibrary.lib）中有一个头文件。该库是一个静态库 (.lib)，它正确链接到 exe。

现在，我有一个类：Vector3d。

```
class Vector3d 
{
    void amethod()
    {
       blah
    }

};

Vector3d cross(const Vector3d &v0, const Vector3d &v1) 
{
      float x,y,z;

      x = v0.y*v1.z-v0.z*v1.y;
      y = v0.z*v1.x-v0.x*v1.z;
      z = v0.x*v1.y-v0.y*v1.x;

     return Vector3d(x,y,z); 
```

}

Vector3d 在头文件 (Vector3d .h) 中声明和定义。在类声明之后，我使用了交叉函数。

lib compile 是文件，但是当它链接到单元测试 exe 时，我收到此错误：

```
 flywindow.obj :error LNK2005: "class Vector3d __cdecl cross(class Vector3d const &,class Vector3d const &)" (?cross@@YA?AVVector3d@@ABV1@0@Z) already defined in fly.obj 
```

有任何想法吗？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-01T04:14:32.330

如果您定义一个自由（不是类的成员）函数，它必须在单独编译的 .cpp 文件中定义，或者在标头中定义并标记为内联。因此，在您的情况下，您可以通过以下方式对其进行编译：

```
inline Vector3d cross(const Vector3d &v0, const Vector3d &v1) {
      float x,y,z;

      x = v0.y*v1.z-v0.z*v1.y;
      y = v0.z*v1.x-v0.x*v1.z;
      z = v0.x*v1.y-v0.y*v1.x;

     return Vector3d(x,y,z);

} 
```

该错误是因为您在标题中定义了函数，但没有将其标记为内联。如果您现在将该头文件包含在两个分别编译的文件中，则链接器在尝试链接已编译的目标文件时将抛出错误，因为它会看到一个交叉函数被定义了两次。

它无需显式地为类的成员函数内联即可工作，因为在类定义中定义的成员函数是隐式内联的。

然而，在头文件中定义函数通常不是一个好主意。如果您的函数将依赖于其他类型而不仅仅是向量（在您的情况下，恕我直言，这很好，但它当然值得商榷 - 有些人不喜欢它），那么您将需要包含这些类型的标题。这将不必要地膨胀标题中间接包含的代码。相反，在这些情况下，您只需将函数声明放在标题中：

```
Vector3d cross(const Vector3d &v0, const Vector3d &v1); 
```

但是在单独编译的 .cpp 文件中定义它。当然，应该删除内联。

* * *

让我添加一个定义和声明的小列表，只是为了帮助清楚地了解声明和定义对函数和类的含义。请注意，每个定义也是一个声明，但不是相反：

```
// class _declaration_ of boo
class boo;

// class _definition_ of foo.
class foo {
    // member function _declaration_ of bar
    void bar();

    // member function _definition_ of baz
    void baz() { }
};

// function _definition_ of fuzz
inline void fuzz() { }

// function _declaration_ of fezz
void fezz(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T04:12:09.823

最可能的解释是您的包含文件中有代码（特别是交叉的定义），并且您的包含文件被两个源文件包含，因此是双重定义。

头文件中应该有声明，而不是定义。声明（表示存在某种东西）是诸如 typedef、类声明、枚举等之类的东西。

定义（对存在的事物赋予意义）是诸如函数、变量定义等之类的事物。

您的交叉函数应在头文件中声明：

```
Vector3d cross(const Vector3d &v0, const Vector3d &v1); 
```

但在单独的源文件中定义。

# maintenance - 维护评论

> ID：500184
> 
> 赞同：5
> 
> 时间：2009-02-01T04:10:47.533
> 
> 标签：maintenance, comments

修改现有代码时使用了哪些特殊技术？

例如：假设您在方法中修改了业务规则。您是否用特殊注释标记修改的部分？

您在修改代码时使用的任何编码/注释标准？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-01T04:16:07.630

你的意思是这样的：

```
foo();  // changed by SecretWiz, 20090131 
```

我不会推荐这个。它使代码文件混乱，版本控制系统应该为您处理。它会跟踪谁更改了什么。采用

```
svn blame 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-01T07:27:53.047

如果我做一些诸如修复一个相对晦涩的错误之类的事情，基本上是任何不太明显为什么我以我的方式编写代码的事情，我通常会添加注释来解释它，以便我（或其他人，如果其他人曾经修改过我的代码 ;-) 以后不会意外删除它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-01T07:34:55.763

我总是尝试做的一件事是在我为该更改所做的代码签入注释中的错误跟踪系统中输入错误 ID（或功能请求 ID）。我添加了类似“有关更多详细信息，请参阅 bugzilla 中此错误/功能的评论”之类的内容。在那里，我可以并且通常可以解释该代码更改的基本原理。这意味着所有更改或至少所有重要更改都需要通过功能请求/错误 ID 进行跟踪。我多次创建错误只是为了详细解释所涉及的业务原因。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-01T04:16:23.370

不，这真是个坏主意。您的源代码管理会保留所有编辑的历史记录。如果您想要其他东西，请在您的错误跟踪工具中输入。无需注释掉旧代码部分或在其中乱扔以下内容：

```
// modified by A.B. on 11/23/99 to fix issue #123456 
```

我在我们的代码库中看到过这样的评论，而且这些评论多年后毫无意义。AB到底是谁，问题#123456是什么？如果代码仍然存在，这是否意味着有人计划在未来回滚这些更改？

这些注释没有任何价值，只会使您的代码混乱。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-01T04:18:35.113

我建议创建一个方法并从正在修改的代码中调用它。
此外，命名方法以暗示方法的目的/意图。

例如 `GiveRebateIfValidCoupon();`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-01T04:21:48.260

“您在修改代码时使用的任何编码/注释标准？”

是的。创建新的子类。保留旧代码，除非在极少数情况下您没有正确测试它并且实际上是错误的。

对需求的更改意味着添加子类和新测试来处理新的业务规则。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-01T04:35:21.867

我添加特殊注释的唯一一次是修改是否是临时的。在那种情况下，我用一个标准关键字（例如，TEMPFIX）标记它，以便我以后可以找到它。当然，您必须记住返回并删除代码或进行永久性更改，但在某些项目中，我们已经强制使用允许我们指定代码停止编译的到期日期的宏。

除此之外，我们依赖源代码控制。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-01T04:48:43.603

代码应符合您或您的组织拥有的任何编码标准。

所以，不，不应该有任何特殊的注释说明代码已被修改——所有或至少大部分代码迟早会被修改。

如果您继承的代码不符合注释标准，那么一定要在[重构](http://en.wikipedia.org/wiki/Code_refactoring)代码时添加注释。如果代码真的很旧并且没有文档，那自然意味着添加文档。

在修改代码之前理解代码是件好事（顺便说一句）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-01T05:04:00.670

通常我只会更改代码并在我的源代码管理检查中发表评论。在选择的任务跟踪工具中，您可以参考实现任务的修订版。

有时我知道某些功能会来回更改、移动、更改名称等，具体取决于用户需求的辩论方式。在这种特殊情况下，我会将旧版本保留在那里，然后将其注释掉。然后，稍后取消注释就变得微不足道了，而不是通过源代码控制寻找旧版本。如果他们以后必须维护您的代码，这也可以节省某人的屁股，因为当用户再次改变主意时，该要求已经在代码中，等待取消注释。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-01T07:10:21.490

我必须同意这里的许多其他人的观点。“如果您的代码中不需要某些内容，请将其删除”。尤其是在生产代码中，您最不想要的就是很多混乱。与阅读您的维护评论并可能会感到困惑相比，有人可能更容易弄清楚您的更改是如何工作的。

我曾经在我的项目中保留旧的弃用代码，但随着时间的推移，一个应该只有几千行的项目最终超过了 10,000 行并且难以管理。

# jquery - JQuery 将变量从 href 传递到 load()

> ID：500187
> 
> 赞同：2
> 
> 时间：2009-02-01T04:11:18.450
> 
> 标签：jquery

我正在尝试在 JQuery 中将 href id 传递给 load()，我可以从警报中看到返回的 id#960，所以我知道 id 值正在过去我只是不知道如何附加加载 url，好吧$("#refreshme_"+add_id) 是重要的部分，我用它来刷新由数据库提取分配的页面中的唯一 div id，所以它会寻找 id="refreshme_960"。我的简单示例显然不起作用。我想刷新显示新汽车列表的页面的分贝选择部分。有任何想法吗？

```
$(document).ready(function() 
{
    $(".add_to_favorites").livequery("click", function(event) 
    {
        var add_id = this.id.replace("add_", ""); //taken from a.href tag
        alert (id);
        $.get(this.href, function(data) 
        {
            $("#refreshme_"+add_id).load("http://www.example.com/car_list/"+add_id); 
```

* * *

```
<a class="add_to_cars" href="/car-add/960/add'}" id="add_960">Add Car</a> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-01T23:10:50.803

You are using append() in this line

```
$('#favorite-listings').append(response); 
```

Which is why you get new results added after the old ones. Change that line to

```
$('#favorite-listings').html(response); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-01T06:10:01.567

这有点令人困惑，您是否将“add_to_favorites”作为触发器，然后在 html 元素中添加_to_cars。

也保持你的替换 ID 全部 jqueryish，我想你会使用

```
$(this).attr('id', 'add_');

```

我认为您要做的是，当用户单击“add_to_cars”链接时，它会将 ajax 响应中的内容添加到收藏夹中？虽然我可能是错的。

我会质疑为什么使用 add_960 作为您的 id 而不是仅使用 960（我知道您不应该使用数字作为 id，因为我一直这样做并且还没有遇到问题）。

所以你可以做

```
$('.add_to_cars')livequery('click', function(event){
     var request=$(this).attr('id');
  $.ajax({
           类型：获取，
           网址：“http://www.example.com/car_list/”+request,
           成功：函数（响应）{
                $('.add_to_favorites').append(response)

      }
});
});

```

或类似的东西。再次，不完全确定您要做什么。

# macos - AppleScript 从另一个包启动 pkg 文件

> ID：500206
> 
> 赞同：2
> 
> 时间：2009-02-01T04:27:39.340
> 
> 标签：macos, scripting, applescript

我想根据某些条件运行一个作为组件添加到我的包中的 pkg 文件。如何从 AppleScript 运行 pkg 文件？

谢谢？

**编辑：** 我现在可以使用*打开的 pkgFile.pkg*运行 pkg 文件我想将此 AppleScript 作为包的一部分与其他一些包一起作为此包的组件嵌入。我在哪里提到这个脚本，所以它在主应用程序安装开始之前执行。

我尝试将脚本添加为主应用程序包的预安装脚本，但它给出了异常**以下安装步骤失败：运行预升级脚本**

有小费吗？谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-01T04:38:47.537

我不是 AppleScript 程序员，所以这可能不是最好的方法，但这应该可行：

```
do shell script "open file.pkg" 
```

# django - 在 Apache mod_python 上部署 django 应用程序

> ID：500214
> 
> 赞同：1
> 
> 时间：2009-02-01T04:35:41.397
> 
> 标签：django, apache, mod-python

我已经在 django 中创建了一个名为“kazbah”的站点，并且正在尝试部署。

kazbah 站点的所有代码都在 /home/git/DjangoProjects/kazbah 中，我的 httpd.conf 如下所示：

```
<Location "/">
    SetHandler python-program
    PythonHandler django.core.handlers.modpython
    SetEnv DJANGO_SETTINGS_MODULE kazbah.settings
    PythonDebug On
    PythonPath "['/home/git/DjangoProjects'] + sys.path"
</Location> 
```

我收到以下错误：

ImportError：无法导入设置“kazbah.settings”（它在 sys.path 上吗？是否有语法错误？）：没有名为 kazbah.settings 的模块

知道为什么这个菜鸟会失败吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-01T06:16:44.877

对于位于`/var/www/bbb`（称为“bbb”）下的项目，我在配置文件中设置了以下内容：

```
<Location "/">
        SetHandler python-program
        PythonHandler django.core.handlers.modpython
        SetEnv DJANGO_SETTINGS_MODULE bbb.settings
        PythonPath "['/var/www/', '/var/www/bbb/'] + sys.path"
        PythonDebug On
</Location> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-01T06:54:46.657

我已经看过几次了。每次都是因为我错误地设置了这一行：

```
SetEnv DJANGO_SETTINGS_MODULE kazbah.settings 
```

尽管看起来不错，但 Django（实际上是 python）正在寻找一个与我想要的文件夹不同的文件夹。尝试调整它，将其更改为：

```
SetEnv DJANGO_SETTINGS_MODULE settings 
```

此外，您可以在此处进行调整：

```
PythonPath "['/home/git/DjangoProjects'] + sys.path" 
```

您可能需要将其设置为：

```
PythonPath "['/home/git/DjangoProjects/kazbah'] + sys.path" 
```

或类似的东西。如果没有看到您的实际文件夹设置，很难确切知道。:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-01T06:23:55.017

路易斯，你的配置看起来和我切换到 mod_wsgi 之前的配置一模一样，所以肯定有其他问题。也许您在 /home/git/DjangoProjects/kazbah 中缺少一个 __init__.py 文件？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-01T05:58:14.040

我很确定你可以做 sys.path 的事情——它在 django 文档中。

当我尝试另一个教程（我认为这有点过时）时，我可能会查看 django 文档[http://docs.djangoproject.com/en/dev/howto/deployment/modpython/ -](http://docs.djangoproject.com/en/dev/howto/deployment/modpython/) [http://www.jeffbaier .com/2007/07/26/installing-django-on-an-ubuntu-linux-server/](http://www.jeffbaier.com/2007/07/26/installing-django-on-an-ubuntu-linux-server/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-01T19:49:33.377

好的，也许您的设置文件中有语法错误。

尝试这个：

```
$ cd /home/git/DjangoProjects/kazbah
$ python
>>> import settings 
```

如果有任何错误，这样做会给你一个更好的错误消息。

# data-structures - 您将如何在代码中表示魔方？

> ID：500221
> 
> 赞同：64
> 
> 时间：2009-02-01T04:44:28.650
> 
> 标签：data-structures, rubiks-cube

如果您正在开发解决魔方的软件，您将如何表示魔方？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-02-01T05:33:08.427

这篇[ACM 论文](http://portal.acm.org/citation.cfm?id=801107&coll=portal&dl=ACM)描述了它用来表示魔方的几种替代方法，并将它们相互比较。可悲的是，我没有获得全文的帐户，但描述指出：

> 展示并比较了七种魔方的替代表示形式： 3×3×3 的 3 位整数数组；一个 6×3×3 的文字数组；一个 5×12 的文字矩阵；一个 ll-by-ll 稀疏文字矩阵；一个 54 元素的向量；一个4维数组；和一个 3×3×3 嵌套数组。为定向移动和四分之一转提供了 APL 函数，以及一些用于求解立方体的有用工具。

此外，这个[RubiksCube.java](http://symbolaris.com/orbital/Orbital-doc/examples/Algorithms/RubiksCube.java)文件包含一个非常干净的表示以及用于旋转部分的相关代码（如果您正在寻找实际代码）。它使用单元格和面数组。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-02-01T05:11:24.273

一种方法是专注于视觉外观。

一个立方体有六个面，每个面都是一个 3×3 的正方形阵列。所以

```
Color[][][] rubik = new Color[6][3][3]; 
```

然后每一步都是一种排列一组特定彩色方块的方法。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2010-08-26T15:00:55.017

避开优化；使其面向对象。我使用的伪代码类大纲是：

```
class Square
    + name : string
    + accronym : string

class Row
    + left_square : square
    + center_square : square
    + right_square : square

class Face
    + top_row : list of 3 square
    + center_row : list of 3 square
    + bottom_row : list of 3 square

    + rotate(counter_clockwise : boolean) : nothing

class Cube
    + back_face : face
    + left_face : face
    + top_face : face
    + right_face : face
    + front_face : face
    + bottom_face : face

    - rotate_face(cube_face : face, counter_clockwise : boolean) : nothing 
```

使用的内存量如此之小，处理量如此之小，以至于完全没有必要进行优化，尤其是当您牺牲代码可用性时。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2019-04-03T23:35:56.690

简短的回答是，这取决于您将如何解决多维数据集。如果您的求解器要使用人工方法，例如逐层方法或 Fridrich 方法，那么底层数据结构不会有太大的不同。即使在最慢的编程语言中，计算机也可以使用人类方法在可忽略不计的时间内（远低于一秒）求解立方体。但是，如果您要使用计算量更大的方法来求解立方体，例如 Thistlethwaite 的 52 步算法、Reid 的 29 步算法或 Korf 的 20 步算法，那么数据结构和编程语言至关重要。

我实现了一个使用 OpenGL 渲染立方体的魔方程序，它内置了两种不同类型的求解器（Thistlethwaite 和 Korf）。求解器必须生成数十亿次移动并对每个立方体状态进行数十亿次比较，因此底层结构必须快速。我尝试了以下结构：

1.  一个 3 维字符数组，6x3x3。面的颜色被索引为立方体[SIDE][ROW][COL]。这很直观，但很慢。
2.  54 个字符的单个数组。这比（1）快，并且行和步幅是手动计算的（微不足道的）。
3.  6 个 64 位整数。这种方法本质上是一个位板，并且比方法（1）和（2）快得多。扭曲可以使用按位操作完成，面部比较可以使用掩码和 64 位整数比较完成。
4.  一组角块和一组单独的边缘块。每个数组的元素都包含一个立方体索引（边缘为 0-11；角为 0-7）和方向（边缘为 0 或 1；角为 0、1 或 2）。当您的求解器涉及模式数据库时，这是理想的选择。

扩展上面的方法（3），立方体的每个面由 9 个贴纸组成，但中心是固定的，因此只需要存储 8 个。并且有 6 种颜色，因此每种颜色适合一个字节。鉴于这些颜色定义：

```
enum class COLOR : uchar {WHITE, GREEN, RED, BLUE, ORANGE, YELLOW}; 
```

一张脸可能看起来像这样，存储在一个 64 位整数中：

```
00000000 00000001 00000010 00000011 00000100 00000101 00000000 00000001 
```

解码为：

```
WGR
G B
WYO 
```

使用这种结构的一个优点是可以使用`rolq`和`rorq`位运算符来移动人脸。滚动 16 位会产生 90 度旋转；滚动 32 位会产生 180 度转弯。相邻的部分需要手动保持——即旋转顶面后，前、左、后、右面的顶层也需要移动。以这种方式转脸真的很快。例如，滚动

```
00000000 00000001 00000010 00000011 00000100 00000101 00000000 00000001 
```

由 16 位产生

```
00000000 00000001 00000000 00000001 00000010 00000011 00000100 00000101 
```

解码，看起来像这样：

```
WGW
Y G
OBR 
```

另一个优点是，在某些情况下，可以使用一些巧妙的位掩码和标准整数比较来比较多维数据集状态。对于求解器来说，这可能是一个很大的加速。

无论如何，我的实现在 github 上：[https](https://github.com/benbotto/rubiks-cube-cracker/tree/2.2.0) ://github.com/benbotto/rubiks-cube-cracker/tree/2.2.0 见`Model/RubiksCubeModel.{h,cpp}`。

扩展上面的方法 (4)，一些用于以编程方式求解魔方的算法使用 A* 的迭代加深深度优先搜索，使用模式数据库作为启发式算法。例如，Korf 算法使用三个模式数据库：一个存储 8 个角块的索引和方向；另一个存储 8 个角块的索引和方向。一个存储12个边片中6个的索引和方向；最后一个存储其他 6 条边的索引和方向。使用模式数据库时，一种快速的方法是将立方体存储为一组索引和方向。

任意定义一个约定，边缘立方体可以如下索引。

```
0  1  2  3  4  5  6  7  8  9  10 11 // Index.
UB UR UF UL FR FL BL BR DF DL DB DR // Position (up-back, ..., down-right).
RY RG RW RB WG WB YB YG OW OB OY OG // Colors (red-yellow, ..., orange-green). 
```

所以红黄边方块的索引为 0，白绿边方块的索引为 4。同样，角方块的索引可能如下所示：

```
0   1   2   3   4   5   6   7
ULB URB URF ULF DLF DLB DRB DRF
RBY RGY RGW RBW OBW OBY OGY OGW 
```

所以红-蓝-黄角方块在索引0，橙-绿-黄角方块在索引6。

每个立方体的方向也需要保持。边缘件可以处于两个方向之一（定向或翻转），而角件可以处于三个不同方向（定向、旋转一次或旋转两次）。有关碎片方向的更多详细信息，请参见：[http ://cube.crider.co.uk/zz.php?p=eoline#eo_detection](http://cube.crider.co.uk/zz.php?p=eoline#eo_detection) 使用此模型，旋转面部意味着更新索引和方向。这种表示是最困难的，因为人类（至少对我而言）很难查看一大堆索引和方向数字并验证它们的正确性。话虽如此，该模型比使用上述其他模型之一动态计算索引和方向要快得多，因此它是使用模式数据库时的最佳选择。您可以在此处看到此模型的实现：[https](https://github.com/benbotto/rubiks-cube-cracker/tree/2.2.0/Model) ://github.com/benbotto/rubiks-cube-cracker/tree/2.2.0/Model （参见 参考资料`RubiksCubeIndexModel.{h,cpp}`）。

如前所述，该程序还呈现立方体。我为那部分使用了不同的结构。我定义了一个“cubie”类，它是一个六个正方形，分别有 1、2 或 3 个彩色面，分别用于中心、边缘和角块。魔方由 26 个魔方组成。使用四元数旋转面。立方体和立方体的代码在这里：[https ://github.com/benbotto/rubiks-cube-cracker/tree/2.2.0/Model/WorldObject](https://github.com/benbotto/rubiks-cube-cracker/tree/2.2.0/Model/WorldObject)

如果您对我的魔方求解程序感兴趣，YouTube 上有一个高级概述视频：[https](https://www.youtube.com/watch?v=ZtlMkzix7Bw&feature=youtu.be) ://www.youtube.com/watch?v=ZtlMkzix7Bw&feature=youtu.be我也有更广泛的文章在[Medium](https://medium.com/@benjamin.botto/implementing-an-optimal-rubiks-cube-solver-using-korf-s-algorithm-bf750b332cf9)上以编程方式求解魔方。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-02-09T06:26:50.393

“Cube Explorer”软件使用了一种有趣的方法来表示立方体。使用许多巧妙的数学方法，该方法可以仅使用 5 个整数来表示立方体。作者在他的[网站](http://kociemba.org/cube.htm)上解释了他的程序背后的数学。根据作者的说法，该表示适合实现快速求解器。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-02-01T05:04:18.610

有很多方法可以做到这一点。有些方法比其他方法更有效地利用内存。

我见过人们使用 3 x 3 x 3 的长方体对象数组，长方体对象需要存储颜色信息（是的，从不使用该中心对象）。我见过人们使用 6 个数组，每个数组都是 3 x 3 的长方体数组。我见过一个 3 x 18 的长方体阵列。有很多可能性。

可能更大的问题是如何表示各种变换。旋转物理立方体的单个面（所有立方体移动本质上都是单个面的旋转）必须通过交换许多立方体对象来表示。

您的选择应该对您正在编写的任何应用程序都有意义。可能您只是在渲染立方体。可能是没有UI。你可能正在解魔方。

我会选择 3 x 18 阵列。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-02-01T05:24:19.647

有 20 个立方体很重要。因此，一种方法是作为 20 个字符串的数组。字符串将包含 2 或 3 个指示颜色的字符。任何一个动作都会影响 7 个小方块。因此，您只需要为六个面中的每一个面重新映射。

注意：此解决方案无法记住位于白色中心的徽标贴纸的方向。

顺便说一句，我曾经帮助某人做过一次软件魔方，也许是 15 年前，但我不记得我们是如何表示它的。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-02-01T05:24:16.977

你可以把立方体想象成三个垂直的循环链表，它们与三个水平链表相交。

每当旋转立方体的某一行时，您只需旋转相应的指针。

它看起来像这样：

```
struct cubeLinkedListNode {
    cubedLinkedListNode* nextVertical;
    cubedLinkedListNode* lastVertical;
    cubedLinkedListNode* nextHorizontal;
    cubedLinkedListNode* lastHorizontal;
    enum color;
} 
```

您实际上可能不需要 2 个“最后一个”指针。

[我用 C 做这个，但它可以在 Java 或 C# 中完成，只需为 cubeLinkedListNode 使用一个简单的类，每个类都包含对其他节点的引用。]

请记住，有六个互锁的循环链表。3 垂直 3 水平。

对于每次旋转，您只需遍历相应的循环链表，依次移动旋转圆的链接以及连接圆。

至少是这样的……

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2020-06-24T15:24:26.063

最短的表示是这样的：[codepen.io/Omelyan/pen/BKmedK](https://codepen.io/Omelyan/pen/BKmedK)

立方体以一维数组（54 个元素的向量）展开。几行旋转功能交换贴纸并基于立方体的对称性。这是 C 语言中的完整工作模型，我在 2007 年还是学生时制作的：

```
const byte // symmetry
  M[] = {2,4,3,5},
  I[] = {2,0,4,6};

byte cube[55]; // 0,0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,1, ... need to be filled first

#define m9(f, m) (m6(f, m)*9)

byte m6(byte f, byte m) {return ((f&~1)+M[m+(f&1)*(3-2*m)])%6;}

void swap(byte a, byte b, byte n) {
  while (n--) {byte t=cube[a+n]; cube[a+n]=cube[b+n]; cube[b+n]=t;}
}

void rotate(byte f, byte a) { // where f is face, and a is number of 90 degree turns
  int c=m9(f, 3), i;
  swap(c, c+8, 1);
  while (a--%4) for (i=2; i>=0; --i)
    swap(m9(f, i) + I[i], m9(f, i+1) + I[i+1], 3),
    swap(f*9+i*2, f*9+i*2+2, 2);
  swap(c, c+8, 1);
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-01T05:52:43.817

其他人很好地描述了物理立方体，但关于立方体的状态......我会尝试使用一组矢量变换来描述立方体的变化。这样，您可以在进行更改时保留魔方的历史记录。我想知道您是否可以将向量乘以变换矩阵以找到最简单的解决方案？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-01T06:38:08.903

作为可以移动的48个面的排列。基本的旋转也是排列，排列可以组合，它们形成一个群。

在程序中，这样的排列将由包含数字 0 到 47 的 48 个元素的数组表示。与数字对应的颜色是固定的，因此可以从排列中计算出视觉表示，反之亦然。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2022-01-08T21:54:40.837

*我发现将状态存储为从面外*立方体中心坐标到颜色的映射非常有用。因此，例如，前右上方立方体的上表面是`state[1, -1, 2]`。因此，只需对索引应用旋转即可完成移动。

您可以在这里看到我使用它编写的一个简单模拟器：[https ://github.com/noamraph/cube](https://github.com/noamraph/cube)

# .net - .net 框架的良好串行端口类？

> ID：500228
> 
> 赞同：2
> 
> 时间：2009-02-01T04:46:55.463
> 
> 标签：.net, serial-port

有没有人知道一个好的（希望是免费的）类来代替 .net SerialPort 类？它给我带来了问题，我需要一个稍微灵活一点的。

[请参阅有关我的问题的其他线程](https://stackoverflow.com/questions/496415/error-opening-serial-port)，但基本上我需要在打开端口时禁止发出 IOCTL_SERIAL_SET_DTR 和 IOCTL_SERIAL_CLR_DTR 命令，因此我需要比 .net 框架提供的类更灵活的东西。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-01T05:10:21.547

几年前，在将串行支持添加到 .net之前，我使用了[OpenNETCF.IO.Serial 。](http://www.opennetcf.com/downloads/agreement.aspx?s=OpenNETCF.IO.Serial)它适用于紧凑型框架，但我将它用于紧凑型设备和常规 Windows 应用程序。你得到源代码，这样你就可以自己修改它，这就是我所做的。

它基本上围绕从 kernel32.dll 导入的串行函数创建 ac# 包装器。

您可能还想看看[如何捕获由于 USB 电缆被拔出而消失的串行端口](https://stackoverflow.com/questions/286184)

这是我用来调用它的代码

```
 using OpenNETCF.IO.Serial;

     public static Port port;
     private DetailedPortSettings portSettings;
     private Mutex UpdateBusy = new Mutex();

     // create the port
     try
     {
        // create the port settings
        portSettings = new HandshakeNone();
        portSettings.BasicSettings.BaudRate=BaudRates.CBR_9600;

        // create a default port on COM3 with no handshaking
        port = new Port("COM3:", portSettings);

        // define an event handler
        port.DataReceived +=new Port.CommEvent(port_DataReceived);

        port.RThreshold = 1;    
        port.InputLen = 0;      
        port.SThreshold = 1;    
        try
        {
           port.Open();
        }
        catch
        {
           port.Close();
        }
     }
     catch
     {
        port.Close();
     }

     private void port_DataReceived()
     {

        // since RThreshold = 1, we get an event for every character
        byte[] inputData = port.Input;

        // do something with the data
        // note that this is called from a read thread so you should 
        // protect any data pass from here to the main thread using mutex
        // don't forget the use the mutex in the main thread as well
        UpdateBusy.WaitOne();
        // copy data to another data structure
        UpdateBusy.ReleaseMutex();

     }

     private void port_SendBuff()
     {
        byte[] outputData = new byte[esize];
        crc=0xffff;
        j=0;
        outputData[j++]=FS;
        //  .. more code to fill up buff
        outputData[j++]=FS;
        // number of chars sent is determined by size of outputData
        port.Output = outputData;
     }

     // code to close port
     if (port.IsOpen)
     {
        port.Close();
     }
     port.Dispose(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T05:22:28.307

我没有尝试过，但也许你可以：

*   `System.IO.Ports.SerialPort`使用[Reflector](http://www.red-gate.com/products/reflector/)或类似工具获取源代码
*   根据需要更改该源代码
*   在不同的命名空间中重建修改后的副本，并使用它

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T09:29:45.423

标准的 .NET SerialPort 不是一个密封的类——你有没有机会从一个子类中获得你需要的行为？

# .net - ASP.NET MVC 项目和 App_Code 文件夹

> ID：500237
> 
> 赞同：13
> 
> 时间：2009-02-01T05:01:28.537
> 
> 标签：.net, asp.net, asp.net-mvc

为什么在 VS 解决方案资源管理器的添加 ASP.NET 文件夹子菜单中没有选择 App_Code？我意识到您可以通过重命名一个新文件夹来手动创建一个，但是这里的理性是什么？这不是您应该放置“实用程序”或“服务层”类型类的地方吗？

在 MVC 项目旁注上。我确实喜欢这样一个事实，即与默认的 ASP.NET Web 窗体项目不同，它有一个开箱即用的 System.Configuration 引用。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-02-01T05:07:17.107

这可能是因为 ASP.NET MVC 项目是 Web 应用程序而不是网站。在网站中，类文件在运行时动态编译，并且必须位于 App_Code 文件夹中。在 Web 应用程序中，所有内容都是静态编译的，类文件可以存在于 Web 应用程序的任何位置。

正如 David Brown 指出的那样，通常建议将额外的类定义放在单独的类库中，然后从您的 Web 应用程序中引用它。如果您编写单元测试或从配置文件中引用您的类，如果这些类仅在您的 Web 应用程序中定义，那么访问这些类可能会很困难或不可能。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-01T05:04:17.127

通常，我将“服务层”和“实用程序”类放在一个单独的项目中，并将其添加为对我的 Web 应用程序的引用。使用 MVC 框架，我真的认为不需要在运行时编译类。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2011-11-17T17:32:09.883

真正的答案是因为微软希望你相信你需要 VS 来做 MVC。但是，要将项目转换为更易于使用的纯 JIT...

你可以很直接地做到这一点。

（1）将所有包含类文件的文件夹移动到`App_Code`（将 Views 文件夹保留在原处）
（2）`Global.asax`通过删除这些属性然后放置不需要后面的代码或继承引用

```
[script runat="server"] 
... place contents of code behind's class inner code 
[/script] 
```

并永久删除后面的代码

(3) 在`Bin`删除项目 DLL 引用中，确保保留其他必要的 DLL，以运行 MVC
(4) 删除解决方案文件和属性文件夹和 obj 文件夹

我经常为 nop MVC 执行此操作，因为它在 JIT 上使用 Web 层要简单得多。不了解这一点的开发人员不会每天在许多需要各种自定义快速修复的网站上工作。我们工作的网站每天都会获得数十万次点击，因此使用 JIT 在初始碰撞后不会降低性能。
当涉及到较小的网站开发时，似乎少即是多。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-11-24T17:18:55.260

对于那些不想要第二个项目/类库而只想要一个简单文件夹来存放几个 c# 类的人，我建议使用“App_Classes”。

# c++ - 在 C++ 中模仿 Java 的 try/finally 是否有一个受欢迎的习语？

> ID：500244
> 
> 赞同：13
> 
> 时间：2009-02-01T05:04:29.560
> 
> 标签：c++, exception, try-catch, finally, throwable

多年来一直在做 Java，所以一直没有跟踪 C++。语言定义中的 C++ 异常处理中是否添加了***finally子句？***

是否有模仿 Java 的 try/finally 的流行习语？

我还担心 C++ 没有针对所有可能抛出的异常的终极超类型——比如 Java 的 Throwable 类。

我可以写：

```
try {
  // do something
} catch(...) {
  // alas, can't examine the exception
  // can only do cleanup code and perhaps rethrow, ala:
  throw;
} 
```

**附录编辑：**

> 我最终接受了投票最多的答案，即使用析构函数进行清理。当然，从我自己的评论来看，很明显我并不完全同意这一点。然而，C++ 就是这样，所以在我想到的应用程序努力中，我将或多或少地努力坚持共同的社区实践。我将使用模板类来包装还没有类析构函数的资源（即 C 库资源），从而赋予它们析构函数语义。

**新附录编辑：**

> 嗯，而不是***finally***然后是一个关闭功能？结合 ScopeGuard 方法的闭包（请参阅下面的答案之一）将是一种通过任意操作完成清理并访问清理代码的外部范围上下文的方法。清理可以以 Ruby 编程中的惯用方式完成，在打开资源时它们提供清理块。是否没有考虑 C++ 的闭包功能？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-02-01T05:10:28.440

通过有效地使用析构函数。当 try 块中抛出异常时，在其中创建的任何对象都将立即被销毁（并因此调用其析构函数）。

这与 Java 不同，在 Java 中您不知道何时调用对象的终结器。

**更新**：直接从马的嘴里： [为什么 C++ 不提供“最终”构造？](http://www.research.att.com/~bs/bs_faq2.html#finally)

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-02-01T07:40:00.620

我的 .02 美元。多年来，我一直在使用 C# 和 Java 等托管语言进行编程，但为了提高速度，我不得不切换到 C++。起初我不敢相信我必须在头文件和 cpp 文件中写出两次方法签名，我不喜欢没有 finally 块，没有垃圾收集意味着到处跟踪内存泄漏 -天哪，我一点也不喜欢！

但是，正如我所说，我被迫使用 C++。所以我被迫认真学习它，现在我终于理解了所有的编程习惯，比如 RAII，我了解了语言的所有微妙之处等等。我花了一段时间，但现在我看到它与 C# 或 Java 相比有多么不同。

这些天来，我认为 C++ 是最好的语言！是的，我可以理解有时我称之为“谷壳”的东西会更多一些（似乎是不必要的东西），但在真正认真使用该语言之后，我已经完全改变了主意。

我曾经一直有内存泄漏。我以前把我所有的代码都写到 .h 文件中，因为我讨厌代码的分离，我不明白他们为什么要这样做！而且我过去总是以愚蠢的循环包含依赖项而告终，并且堆积更多。我真的沉迷于 C# 或 Java，对我来说 C++ 是一个巨大的进步。这些天我明白了。我几乎从来没有内存泄漏，我喜欢接口和实现的分离，我不再有循环依赖的问题。

我也不会错过 finally 块。老实说，我的观点是，你所说的这些 C++ 程序员在 catch 块中编写重复的清理操作，在我看来，他们只是糟糕的 C++ 程序员。我的意思是，看起来这个线程中的任何其他 C++ 程序员都没有遇到你提到的任何问题。RAII 确实使 finally 变得多余，如果有的话，它的工作量就更少了。您编写了一个析构函数，然后您永远不必最终编写另一个析构函数！至少对于那种类型。

恕我直言，我认为你现在只是习惯了 Java，就像我以前一样。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-02-01T05:10:58.877

C++ 的答案是 RAII：对象的析构函数将在超出范围时执行。无论是通过返回，通过异常还是其他方式。如果您在其他地方处理异常，您可以确保从被调用函数到您的处理程序的所有对象都将通过调用其析构函数来正确销毁。他们会为你清理。

阅读[http://en.wikipedia.org/wiki/Resource_acquisition_is_initialization](http://en.wikipedia.org/wiki/Resource_acquisition_is_initialization)

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-02-01T05:11:54.397

No finally 没有被添加到 C++ 中，也不太可能被添加。

C++ 使用构造函数/析构函数的方式使得 finally 没有必要。
如果您使用 catch(...) 进行清理，那么您没有正确使用 C++。清理代码应该都在析构函数中。

尽管不需要使用它，但 C++ 确实有一个 std::exception。
强制开发人员从特定类派生以使用异常与 C++ 保持简单的理念背道而驰。这也是为什么我们不需要所有类都派生自 Object 的原因。

阅读：[C++ 是否支持“终于”块？（我一直听到的这个“RAII”是什么？）](https://stackoverflow.com/questions/161177/does-c-support-finally-blocks-and-whats-this-raii-i-keep-hearing-about/161247#161247)

finally 的使用比析构函数更容易出错。
这是因为您强制对象的用户进行清理，而不是类的设计者/实现者。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-02-01T11:58:10.630

好的，我必须在单独的答案帖子中添加对您提出的观点的答案：（如果您将其编辑到原始问题中会更方便，因此它不会出现在*下面*的底部答案。

> 如果所有清理总是在析构函数中完成，那么在 catch 块中就不需要任何清理代码 - 但是 C++ 有可以在其中完成清理操作的 catch 块。事实上，它有一个用于 catch(...) 的块，它只能执行清理操作（当然，不能获取任何异常信息来执行任何日志记录）。

catch 有一个完全不同的目的，作为一名 Java 程序员，您应该意识到这一点。finally 子句用于“无条件”清理操作。无论块如何退出，都必须这样做。Catch 用于条件清理。如果抛出这种类型的异常，我们需要执行一些额外的操作。

> 无论是否抛出异常，finally 块中的清理都将完成——这是当清理代码确实存在时人们总是希望发生的事情。

真的吗？如果我们希望这种类型*总是*发生这种情况（例如，我们总是想在完成后关闭数据库连接），那么我们为什么不定义*一次*呢？在类型本身？使数据库连接自行关闭，而不是在每次使用它时都尝试/最终？

这就是析构函数的重点。他们保证每种类型都能够在每次使用时自行进行清理，而无需调用者考虑。

> 从第一天开始，C++ 开发人员就不得不重复出现在代码流中的 catch 块中的清理操作，这些操作在成功退出 try 块时发生。Java 和 C# 程序员只需在 finally 块中执行一次。

不会。C++ 程序员从来没有被这个困扰过。C程序员有。C 程序员意识到 c++ 有类，然后称自己为 C++ 程序员。

我每天都用 C++ 和 C# 编程，我觉得我被 C# 荒谬的坚持所困扰，我`using`每次使用数据库连接或其他必须清理的东西时都必须提供 finally 子句（或块）。

C++ 让我一劳永逸地指定“只要我们完成了这种类型，它就应该执行这些操作”。我不会冒险忘记释放内存。我不会冒险忘记关闭文件句柄、套接字或数据库连接。因为我的记忆、我的句柄、套接字和数据库连接都是自己做的。

每次使用类型时都必须编写重复的清理代码，这怎么能更好*呢*？如果您需要包装类型，因为它本身没有析构函数，您有两个简单的选择：

*   寻找提供此析构函数的适当 C++ 库（提示：Boost）
*   使用 boost::shared_ptr 来包装它，并在运行时为它提供一个自定义函子，指定要完成的清理工作。

> 当您编写 Java EE 应用服务器 Glassfish、JBoss 等应用服务器软件时，您希望能够捕获并记录异常信息——而不是让它掉在地上。或者更糟糕的是陷入运行时并导致应用程序服务器突然退出。这就是为什么对于任何可能的异常都有一个总体基类是非常可取的。而 C++ 就是这样一个类。标准：：异常。
> 
> 自 CFront 时代以来，我一直在做 C++，在这十年的大部分时间里都在做 Java/C#。很明显，在处理基本相似的事情方面存在巨大的文化差距。

不，你从来没有做过 C++。你已经完成了 CFront 或 C 类。不是 C++。有很大的不同。不要说答案是蹩脚的，你可能会学到一些你认为你知道的语言。;)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-02-02T17:44:22.040

清理函数本身是完全蹩脚的。他们的凝聚力很低，因为他们被期望执行一系列仅与它们发生时相关的活动。它们具有高耦合性，因为当实际执行某些操作的功能发生更改时，它们需要修改其内部结构。因此，它们很容易出错。

try...finally 构造是清理函数的框架。这是一种语言鼓励的方式来编写糟糕的代码。此外，由于它鼓励一遍又一遍地编写相同的清理代码，它破坏了 DRY 原则。

对于这些目的，C++ 方式要好得多。资源的清理代码在析构函数中只写一次。它与该资源的其余代码位于同一位置，因此具有良好的凝聚力。清理代码不必放入不相关的模块中，因此这减少了耦合。如果设计得当，它只写一次。

此外，C++ 方式更加统一。C++，加上智能指针，以同样的方式处理各种资源，而Java很好地处理内存，并提供了不充分的构造来释放其他资源。

C++ 有很多问题，但这不是其中之一。Java 在某些方面优于 C++，但这不是其中之一。

用一种方法来实现 RAII 而不是 try...finally，Java 会好得多。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-02-02T14:29:03.023

为了避免必须为每个可释放资源定义一个包装类，您可能对 ScopeGuard ( [http://www.ddj.com/cpp/184403758](http://www.ddj.com/cpp/184403758) ) 感兴趣，它允许您即时创建“清理程序”。

例如：

```
FILE* fp = SomeExternalFunction();
// Will automatically call fclose(fp) when going out of scope
ScopeGuard file_guard = MakeGuard(fclose, fp); 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-02-02T16:51:25.687

正确使用 finally 是多么困难的一个例子。

打开和关闭两个文件。
您要保证文件正确关闭的地方。
等待 GC 不是一个选项，因为这些文件可能会被重复使用。

在 C++ 中

```
void foo()
{
    std::ifstream    data("plop");
    std::ofstream    output("plep");

    // DO STUFF
    // Files closed auto-magically
} 
```

在没有析构函数但有 finally 子句的语言中。

```
void foo()
{
    File            data("plop");
    File            output("plep");

    try
    {
        // DO STUFF
    }
    finally
    {
        // Must guarantee that both files are closed.
        try {data.close();}  catch(Throwable e){/*Ignore*/}
        try {output.close();}catch(Throwable e){/*Ignore*/}
    }
} 
```

这是一个简单的例子，代码已经变得复杂了。在这里，我们只尝试编组 2 个简单的资源。但是随着需要管理的资源数量的增加和/或其复杂性的增加，finally 块的使用变得越来越难以在存在异常的情况下正确使用。

finally 的使用将正确使用的责任转移到对象的用户身上。通过使用 C++ 提供的构造函数/析构函数机制，您将正确使用的责任转移到类的设计者/实现者身上。这在继承上更安全，因为设计者只需要在类级别正确执行一次（而不是让不同的用户尝试以不同的方式正确执行）。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-03-05T13:21:36.277

使用 C++11 及其[lambda 表达式](http://en.cppreference.com/w/cpp/language/lambda)，我最近开始使用以下代码来模仿`finally`：

```
class FinallyGuard {
private:
  std::function<void()> f_;
public:
  FinallyGuard(std::function<void()> f) : f_(f) { }
  ~FinallyGuard() { f_(); }
};

void foo() {
  // Code before the try/finally goes here
  { // Open a new scope for the try/finally
    FinallyGuard signalEndGuard([&]{
      // Code for the finally block goes here
    });
    // Code for the try block goes here
  } // End scope, will call destructor of FinallyGuard
  // Code after the try/finally goes here
} 
```

The`FinallyGuard`是一个使用可调用函数式参数构造的对象，最好是 lambda 表达式。它只会记住该函数，直到调用它的析构函数，当对象超出范围时，无论是由于正常的控制流还是由于异常处理期间的堆栈展开。在这两种情况下，析构函数都会调用函数，从而执行相关代码。

有点奇怪，你必须在代码块的代码`finally` *之前*`try`编写代码，但除此之外，它实际上感觉很像真正的`try`/`finally`来自 Java。我想人们不应该在具有自己适当的析构函数的对象更合适的情况下滥用这一点，但在某些情况下，我认为上面的这种方法更合适。[我在这个问题](https://stackoverflow.com/q/15222502/1468366)中讨论了一个这样的场景。

据我了解，`std::function<void()>`将使用一些指针间接和至少一个虚函数调用来执行其[类型擦除](https://stackoverflow.com/a/7956726/1468366)，因此会有[性能开销](https://stackoverflow.com/q/5057382/1468366)。不要在性能至关重要的紧密循环中使用此技术。在这些情况下，析构函数只做一件事的专用对象会更合适。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-01T06:49:22.610

C++ 析构函数变得`finally`多余。您可以通过将清理代码从 finally 移动到相应的析构函数来获得相同的效果。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-01T11:13:25.480

我认为您错过了`catch (...)`可以做什么的重点。

您在示例中说“唉，无法检查异常”。好吧，您没有关于异常类型的信息。你甚至不知道它是否是多态类型，所以即使你有某种无类型的引用，你甚至不能安全地尝试一个`dynamic_cast`.

如果你知道某些异常或异常层次结构，你可以用它来做一些事情，那么这里就是具有明确命名类型的 catch 块的地方。

`catch (...)`在 C++ 中并不常用。它可以用于必须保证不抛出或只抛出某些约定异常的地方。如果您正在使用`catch (...)`清理，那么很有可能您的代码在任何情况下都不是非常安全的异常安全。

正如其他答案中所提到的，如果您使用本地对象来管理资源（RAII），那么它通常会令人惊讶和启发您需要多少 catch 块 - 如果您不需要在本地执行任何异常操作 - 甚至try 块可能是多余的，因为您让异常流出到可以响应它们的客户端代码，同时仍然保证没有资源问题。

要回答您最初的问题，如果您需要在块的末尾运行一些代码，异常或无异常，那么配方就是。

```
class LocalFinallyReplacement {
    ~LocalFinallyReplacement() { /* Finally code goes here */ }
};
// ...
{ // some function...
    LocalFinallyReplacement lfr; // must be a named object

    // do something
} 
```

请注意我们如何可以完全取消`try`,`catch`和`throw`。

如果您的函数中有最初声明在 try 块之外的数据，您需要在“finally”块中访问这些数据，那么您可能需要将其添加到帮助程序类的构造函数中并将其存储到析构函数。然而，在这一点上，我会认真地重新考虑是否可以通过改变本地资源处理对象的设计来解决这个问题，因为这意味着设计中出现了一些错误。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-02T18:57:24.030

不完全离题。

[Java 中的锅炉电镀数据库资源清理](http://www.marauder-consulting.co.uk/Boiler_Plating_Database_Resource_Cleanup_-_Part_I.pdf)

讽刺模式：Java 的成语是不是很精彩？

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-01T17:01:21.783

在这 15 年里，我在 C++ 中完成了大量的类设计和模板包装器设计，并在析构函数清理方面以 C++ 的方式完成了这些工作。但是，每个项目也总是涉及到 C 库的使用，这些库提供了打开、使用、关闭使用模型的资源。try/finally 意味着这样的资源可以在它需要的地方使用——以一种完全健壮的方式——并用它来完成。对这种情况进行编程的最不乏味的方法。可以处理在清理逻辑期间发生的所有其他状态，而不必在某些包装析构函数中限定范围。

我在 Windows 上完成了大部分 C++ 编码，因此在这种情况下总是可以求助于微软的 __try/__finally。（它们的结构化异常处理具有一些与异常交互的强大能力。）唉，看起来 C 语言从来没有批准过任何可移植的异常处理结构。

不过，这不是理想的解决方案，因为在 try 块中混合 C 和 C++ 代码并不简单，其中任何一种类型的异常都可能被抛出。添加到 C++ 的 finally 块对这些情况很有帮助，并且可以实现可移植性。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-02T19:41:42.910

关于您的附录编辑，是的，正在考虑 C++0x 的闭包。它们可以与 RAII 范围的警卫一起使用，以提供易于使用的解决方案，请查看[Pizer 的博客](http://pizer.wordpress.com/2008/11/22/scope-guards-revisited-c0x-style/)。它们也可以用来模仿try-finally，见[这个答案](https://stackoverflow.com/questions/385039/are-there-cases-where-a-finally-construct-would-be-useful-in-c/385081#385081)；但这[真的是个好主意吗？](https://stackoverflow.com/questions/500244/is-there-a-favored-idiom-for-mimicing-javas-try-finally-in-c/504420#504420).

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-03-13T09:42:19.643

以为我会为此添加自己的解决方案-一种智能指针包装器，用于当您必须处理非 RAII 类型时。

像这样使用：

```
Finaliser< IMAPITable, Releaser > contentsTable;
// now contentsTable can be used as if it were of type IMAPITable*,
// but will be automatically released when it goes out of scope. 
```

所以这里是 Finaliser 的实现：

```
/*  Finaliser
    Wrap an object and run some action on it when it runs out of scope.
    (A kind of 'finally.')
    * T: type of wrapped object.
    * R: type of a 'releaser' (class providing static void release( T* object )). */
template< class T, class R >
class Finaliser
{
private:
    T* object_;

public:
    explicit Finaliser( T* object = NULL )
    {
        object_ = object;
    }

    ~Finaliser() throw()
    {
        release();
    }

    Finaliser< T, R >& operator=( T* object )
    {
        if (object_ != object && object_ != NULL)
        {
            release();
        }
        object_ = object;

        return *this;
    }

    T* operator->() const
    {
        return object_;
    }

    T** operator&()
    {
        return &object_;
    }

    operator T*()
    {
        return object_;
    }

private:
    void release() throw()
    {
        R::release< T >( object_ );
    }
}; 
```

...这是发布者：

```
/*  Releaser
    Calls Release() on the object (for use with Finaliser). */
class Releaser
{
public:
    template< class T > static void release( T* object )
    {
        if (object != NULL)
        {
            object->Release();
        }
    }
}; 
```

我有几种像这样的释放器，包括一种用于 free() 和一种用于 CloseHandle()。

# jquery - 如何将 jQuery 选择器的表达式作为文本获取？

> ID：500246
> 
> 赞同：33
> 
> 时间：2009-02-01T05:06:16.093
> 
> 标签：jquery, jquery-selectors

我有一个 jQuery 选择器，它有一个链式函数。

在函数内部，我想访问表示选择器表达式的 TEXT。

```
$("cat dog").function() {

    // how do I get access to the "cat dog" string from inside THIS function ?
}; 
```

我在这个代码示例中过度简化了我真正想做的事情。我正在编写一个插件，我需要访问已为其创建包装集的选择器。显然，在这个特定的例子中，我可以使用“猫狗”，因为我写了它。所以想象一下这是在一个插件中。

谷歌这个有点棘手。

**编辑：**不幸的是，现在不推荐使用“选择器”属性。[http://jquery.com/upgrade-guide/1.9/#selector-property-on-jquery-objects](http://jquery.com/upgrade-guide/1.9/#selector-property-on-jquery-objects)

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-01T05:18:52.107

jQuery 对象中有一个“选择器”属性，但我不确定它是否始终可用。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-01T18:26:29.270

这远非最佳，但在某些情况下有效。您可以执行以下操作：

```
jQuery.fn._init = jQuery.fn.init
jQuery.fn.init = function( selector, context ) {
    return (typeof selector === 'string') ? jQuery.fn._init(selector, context).data('selector', selector) : jQuery.fn._init( selector, context );
};

jQuery.fn.getSelector = function() {
    return jQuery(this).data('selector');
}; 
```

这将返回用于元素的最后一个选择器。但它不适用于不存在的元素。

```
<div id='foo'>Select me!</div>
<script type='text/javascript'>
 $('#foo').getSelector(); //'#foo'
 $('div[id="foo"]').getSelector(); //'div[id="foo"]'
 $('#iDoNotExist').getSelector(); // undefined
</script> 
```

这适用于 jQuery 1.2.6 和 1.3.1 以及可能的其他版本。

还：

```
<div id='foo'>Select me!</div>
<script type='text/javascript'>
 $foo = $('div#foo');
 $('#foo').getSelector(); //'#foo'
 $foo.getSelector(); //'#foo' instead of 'div#foo'
</script> 
```

**编辑**
如果您在使用选择器后立即检查，您可以在插件中使用以下内容：

```
jQuery.getLastSelector = function() {
    return jQuery.getLastSelector.lastSelector;
};
jQuery.fn._init = jQuery.fn.init
jQuery.fn.init = function( selector, context ) {
    if(typeof selector === 'string') {
        jQuery.getLastSelector.lastSelector = selector;
    }
    return jQuery.fn._init( selector, context );
}; 
```

然后以下将起作用：

```
<div id='foo'>Select me!</div>
<script type='text/javascript'>
 $('div#foo');
 $.getLastSelector(); //'#foo'
 $('#iDoNotExist');
 $.getLastSelector(); // #iDoNotExist'
</script> 
```

在您的插件中，您可以执行以下操作：

```
jQuery.fn.myPlugin = function(){
 selector = $.getLastSelector;
 alert(selector);
 this.each( function() {
  //do plugins stuff
 }
}

$('div').myPlugin(); //alerts 'div'
$('#iDoNotExist').myPlugin(); //alerts '#iDoNotExist' 
```

但仍然：

```
$div = $('div');
$('foo');
$div.myPlugin(); //alerts 'foo' 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-01T05:09:55.463

如果您使用的是 firebug，您可以`console.log(this)`在函数内部查看选择器字符串是否可以在对象中的某处访问。抱歉，我不熟悉 jQuery API。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-10-12T05:38:47.760

如果您想在函数中访问选择器字符串，这将起作用：

```
$(this).html(); 
```

如果使用多个选择器，这也将起作用，

例如，

```
$('#id1,#id2').click(function(){
   alert($(this).html());
}); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-07-10T07:53:39.480

也许这可以解决您的问题：

```
var $jqueryItems = $( ".my-selector" );
console.log( $jqueryItems.selector ); // display ".my-selector" 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-08-11T14:15:27.820

对于那些想要了解他们提供给 jQuery 的插件选择器字符串的人，我很高兴改进了@Pim Jager 给出的出色答案：

1.  截至目前（最新版本 3.2.1），`jQuery.fn.init` 函数中有 3 个参数`selector, context, root`——不是两个；
2.  `new`关键字应该添加到 ; 的返回语句 `jQuery.fn.init`中
3.  在您的插件中，选择器通过调用以字符串形式返回 `$(this).getSelector();`

最后，这就是我必须像魅力一样为我工作的东西：

```
(function($, window, document, undefined) { 
    $.fn._init = $.fn.init
    $.fn.init = function( selector, context, root ) {
        return (typeof selector === 'string') ? new $.fn._init(selector, context, root).data('selector', selector) : new $.fn._init( selector, context, root );
    };
    $.fn.getSelector = function() {
        return $(this).data('selector');
    };
    $.fn.YOUR-PLUGIN = function() {
        var selector = $(this).getSelector(); // selectors string given to jQuery 
        // other code
    }
})(jQuery, window, document); 
```

就我而言，它适用于 jQuery 版本（从 1.7.0 到 3.2.1）。

**附言**。即使使用 stackoverflow 上的 jQuery 1.2.3 也可以正常工作。所以，我想，如果你想在插件中获取一个 jQuery 选择器的表达式作为文本，那么下面的所有 jQuery 版本都可以：

```
// our plugin
(function($, window, document, undefined) { 
    $.fn._init = $.fn.init
    $.fn.init = function( selector, context, root ) {
        return (typeof selector === 'string') ? new $.fn._init(selector, context, root).data('selector', selector) : new $.fn._init( selector, context, root );
    };
    $.fn.getSelector = function() {
        return $(this).data('selector');
    };
    $.fn.coolPlugin = function() {
        var selector = $(this).getSelector(); 
        if(selector) console.log(selector); // outputs p #boldText
    }
})(jQuery, window, document);

// calling plugin
$(document).ready(function() {
    $("p #boldText").coolPlugin();
});
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.2.3/jquery.min.js"></script>
<p>some <b id="boldText">bold text</b></p>
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2020-06-20T14:00:14.437

请参考我对重复问题的回答： [在初始化时拦截选择器](https://stackoverflow.com/a/62486749/2617201)

详细信息： **即使在弃用和删除“*选择器*”属性之后，也可以完全使用任何 jQuery 版本**

我的解决方案是在 jQuery 对象初始化时拦截选择器，同时使用继承透明地维护所有其他 jQuery 功能，如下所示：

```
$ = (function (originalJQuery) 
{
    return (function () 
    {
        var newJQuery = originalJQuery.apply(this, arguments);
        newJQuery.selector = arguments.length > 0 ? arguments[0] : null;
        return newJQuery;
    });
})($);

$.fn = $.prototype = jQuery.fn; 
```

用法：

```
var myAnchors = $('p > a');
var selector = myAnchors.selector; 
```

应该产生：`"p > a"`

**使用 jQuery 3.4.1 成功尝试**

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-01T19:51:47.740

当绑定到函数时，我无法弄清楚如何获取对 $('value_i_want_here') 内部提供的选择器的字符串值的引用；似乎是一个棘手的问题。但是，如果您更喜欢在 IE[x] 中进行测试，总有[Firebug Lite](http://getfirebug.com/lite.html "萤火虫精简版")可以很好地利用 console.log(var|val)。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2009-02-01T05:43:14.023

好吧，我仍在试图弄清楚您是否正在尝试获取元素名称？或 id 和/或 class 或全部。

你可以用这个获得元素

```
var 元素 =$(this).get(0);
var id = $(this).attr('id');
var class=$(this).attr('class');

```

不知道如果你有不止一门课会发生什么。可能会进入一个数组或其他东西，你可以通过索引得到它。

# php - 延迟 PHP 脚本的执行

> ID：500263
> 
> 赞同：7
> 
> 时间：2009-02-01T05:17:13.607
> 
> 标签：php, delayed-execution

阻止机器人、恶意用户等执行 php 脚本过快的最佳方法是什么？如果我使用`usleep()`or`sleep()`函数只是在一段时间内“什么都不做”（就在所需的代码执行之前），是否可以，或者这很愚蠢并且有更好的方法？

例子：

```
function login() {
 //enter login code here
}

function logout() {
 //enter logout code here
} 
```

如果我只是把，比如说，`usleep(3000000)`在登录和注销代码之前，那可以吗，还是有更好、更明智的方法来实现我想要实现的目标？

**编辑：**根据下面的建议，然后`usleep`或`sleep`仅导致处理器脱离当前用户正在执行的当前脚本，还是导致它脱离整个服务？即如果一个用户+脚本调用`sleep`/ `usleep`，所有并发用户+脚本也会被延迟吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-01T06:47:30.897

大多数 Web 服务器（例如 Apache）的工作方式是维护一组工作线程。当执行 PHP 脚本时，一个线程运行 PHP 脚本。

当您的脚本执行`sleep(100)`时，该脚本需要 100 秒才能执行。这意味着您的工作线程被占用了 100 秒。

问题是，您的工作线程数量非常有限 - 假设您有 10 个线程，并且有 10 人登录 - 现在您的网络服务器无法提供任何进一步的响应..

限制登录（或其他操作）的最佳方式是使用某种快速的内存存储设备（[memcached](http://www.danga.com/memcached/)非常适合此），但这需要运行单独的进程并且非常复杂（如果您可能会这样做）运行 Facebook 之类的东西..)。

更简单的是，您可以拥有一个存储`user_id`或`ip_address`、`first_failed`和的数据库表`failure_counter`。

每次登录失败时，您（在伪代码中）都会这样做：

```
if (first_failed in last hour) and (failure_counter > threshold):
    return error_403("Too many authentication failures, please wait")
elseif first_failed in last hour:
    increment failure_counter
else:
    reset first_failed to current time
    increment failure_counter 
```

也许不是最有效的，并且有更好的方法，但它应该很好地停止暴力破解。使用memcached基本一样，只是用memcached替换了数据库（这样更快）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-01T06:27:00.940

> 阻止机器人、恶意用户等过快地执行 php 脚本？

我首先要问你真正想防止什么？如果是拒绝服务攻击，那么我不得不说，如果您受限于可以添加到 PHP 脚本中的内容，那么您将无能为力。最先进的技术远远超出了我们作为程序员可以保护的范围。开始查看为此目的设计的系统管理工具。

或者您是否试图限制您的服务，以便真实的人可以访问它但机器人不能？如果是这样，我会看一些“验证码”技术。

或者您是否试图阻止用户每秒轮询您的网站以寻找新内容？如果是这样，我会调查提供 RSS 提要或其他通知他们的方式，这样他们就不会占用您的带宽。

或者是别的什么？

一般来说，我会说 sleep() 和 usleep() 都不是一个好方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-01T05:42:39.063

您建议的方法将强制所有用户在登录前进行不必要的等待。

大多数 LAMP 服务器（实际上是大多数路由器/交换机）已经配置为防止拒绝服务攻击。他们通过拒绝来自同一 IP 地址的多个连续请求来做到这一点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-01T05:52:15.783

你不想在你的 php.ini 中睡觉。这样做将大大减少您的服务可以处理的并发请求数量，因为您将有连接保持打开等待。

大多数 HTTP 服务器都具有您可以启用以避免 DoS 攻击的功能，但如果您无法做到这一点，您应该只跟踪您最近看到太多次的 IP 地址，并向他们发送 403 Forbidden 并要求他们等待一秒钟的消息。

如果由于某种原因您不能指望 REMOTE_ADDR 是特定于用户的（每个人都在同一防火墙后面，等等），您可以在登录表单中证明一个挑战并让远程浏览器对其进行扩展计算（例如，考虑一个数字），您可以在服务器端快速检查（通过快速乘法）。

# android - Android：列表视图上的多个操作 - 焦点问题

> ID：500264
> 
> 赞同：9
> 
> 时间：2009-02-01T05:17:24.247
> 
> 标签：android, listview, button, focus

我想实现一个 ListView，我可以用我的光标来做这件事。现在，根据您单击的哪一行，它会根据该行上按下的信息将您带到一个新活动（就像它应该和预期的那样）。我想要一个按钮来删除该行，因此用户可以按该行的任何部分来启动新活动，但是如果他们按下该行上的按钮，它会删除该行（或启动删除活动/功能）。

如果您可以查看@ DroidRecord，它们的布局与我希望实现的相似。

谢谢！

克里斯。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2010-05-04T12:28:36.277

正如 Mariano Kamp 所说，将按钮添加到一行将使其“不可触碰”，但根据我的经验，如果您在按钮上设置这些属性，这个问题就会消失：

```
 android:focusable="false"
    android:focusableInTouchMode="false" 
```

另请参阅[如何使用列表中的按钮在 Listactivity 中触发 onListItemClick？](https://stackoverflow.com/questions/1821871/android-how-to-fire-onlistitemclick-in-listactivity-with-buttons-in-list)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-06-22T11:45:59.227

另一种可能的解决方法 - 您可以使用 ImageView 而不是按钮，并设置 ImageView 的 onClickListener（例如，当您膨胀单元格视图时）。

ImageView is not focusable so it doesn't prevent OnListItemClick() from being dispatched, and when you click on the image only the image's listener fires.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-01T09:33:23.277

你的问题是什么？如何将按钮添加到列表行？

非常简单，正如您所期望的那样，它将被添加到行的布局中。

不幸的是，尽管这也会使整行“不可触碰”。我问过的谷歌开发者说这是设计使然（据我记忆），你应该使用 TouchDelegate 来解决这个问题。因为没有样本，甚至在 android 源代码中也没有，只有非常薄的[文档](http://code.google.com/android/reference/android/view/TouchDelegate.html)对我不起作用

无论如何，似乎没有多少应用程序使用列表行中的按钮。我只知道我的（[newsrob](http://newsrob.com)，见文章列表）和闹钟。也许您可以使用上下文菜单？

否则，丑陋的解决方案是在 getView 方法中的行视图上添加调用 setOnClickListener() 。

干杯

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-01T21:05:46.483

这不是您问题的答案，但长按/选项卡通常是弹出上下文菜单并进行额外操作（如删除）的地方。您可以在此处阅读如何操作：[如何在 Android 上的 ListActivity 中实现上下文菜单？](https://stackoverflow.com/questions/433761/how-do-you-implement-context-menu-in-a-listactivity-on-android)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-12-12T13:21:20.180

I would like to thank **BoD** for its [hint](https://stackoverflow.com/a/2765202/972656) on removing the `focusable` state to the button(s), it saved my day.

But for information, since the button is no more `focusable` - `state_focused` on < selector > xml - , its design won't display anymore to the user.

Those buttons will still get the state `pressed` though, but also when clicking anywhere else on the parent view (anywhere BUT another button) !

Keep that in mind, it could not be a good solution for your own case, but it does work well.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-04-23T00:13:20.490

I tried this to be able to click on the buttons but it didn't work for me android:focusable="false" android:focusableInTouchMode="false"

so what I did was to change the activity layout to scrollview and then add a linerLayout inside of it. after that you can add buttons to the layout and each button will be clickable.

# javascript - 将“事件”作为参数传递给函数

> ID：500278
> 
> 赞同：1
> 
> 时间：2009-02-01T05:26:57.660
> 
> 标签：javascript, jquery

我对 JS 和 jQuery 都是新手，对于哪些情况需要您将`event`参数作为参数传递给函数，以及哪些情况**不需要**。

例如：

```
 $(document).ready(function() {

        $('#foo').click(function() {
         // Do something
});

      }); 
```

相对

```
 $(document).ready(function() {

        $('#foo').click(function(event) {
         // Do something
});

      }); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-01T05:51:44.863

这个`event`论点有几个用途。如果你真的要使用它，你只需要将它指定为你的处理程序的参数——JavaScript 可以毫无怨言地处理可变数量的参数。

您将看到的最常见用途是阻止触发事件的操作的默认行为。所以：

```
$('a.fake').click(function(e) {
    e.preventDefault();
    alert("This is a fake link!");
}); 
```

...会阻止与班级`fake`的任何链接在单击时实际转到他们的链接`href`。同样，您可以使用它取消表单提交，例如在验证方法中。这*就像* `return false`，但更可靠。

jQuery 的对象实际上是除 IE 之外的所有东西中提供`event`的标准参数的跨浏览器版本。`event`它本质上是一种快捷方式，让您只使用一个代码路径，而不必检查您在每个事件处理程序中使用的浏览器。

（如果您阅读非 jQuery 代码，您会看到很多以下内容，这是为了解决 IE 的缺陷。

```
function(e) {
    e = e || window.event; // For IE 
```

这很痛苦，而库使它更容易处理。）

[在 jQuery 文档中有对其属性的完整说明。](http://docs.jquery.com/Events/jQuery.Event) 本质上，如果您在那里看到任何您需要的东西，请包括它，否则不要担心。我喜欢总是包含它，所以如果我决定需要它，我以后永远不必记得添加它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-01T05:29:54.457

如果您要在处理程序的主体中使用它，则只需要该事件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-01T05:54:52.360

由于您使用的是 jQuery，因此仅`event`当您需要在处理程序中使用事件时才将其作为参数，例如如果您需要在`keypress`事件上按下的键。

在 JS 中，如果没有 jQuery 或 Prototype 等，您需要将`event`作为参数传递给 Firefox 等符合标准的浏览器，但在 IE 中事件不会作为参数传递。IE 实际上维护了一个全局变量`window.event`。因此，在您的处理程序（无库）中，您需要检查参数是否为`undefined`; 如果是这样，请获取全局变量。

```
function eventHandler(evt) {
  var theEvent = evt || window.event;
  //use the event
} 
```

但是像 jQuery 这样的库会为您解决这个问题。

老实说，在您学习该语言之前，我不建议您使用库。但是如果这是为了工作，那一定要使用库，但是你自己学习JS的细节，这样你就可以更好地欣赏它。

# algorithm - 为什么回溯会使算法不确定？

> ID：500280
> 
> 赞同：18
> 
> 时间：2009-02-01T05:28:43.863
> 
> 标签：algorithm, performance, language-agnostic, non-deterministic

所以我至少有两位教授提到回溯使算法具有不确定性，但没有给出太多解释为什么会这样。我*想*我明白这是怎么发生的，但我很难用语言表达。有人能给我一个简明的解释吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-01T06:03:50.300

回溯使算法不确定的情况并非如此。

相反，您通常需要回溯来处理非确定性算法，因为（根据非确定性的定义）您不知道在处理过程中的特定时间采用哪条路径，而是必须尝试几个。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-01T05:54:16.497

我只是引用维基百科：

> 非确定性编程语言是一种可以在程序中的某些点（称为“选择点”）指定程序流程的各种替代方案的语言。与 if-then 语句不同，这些备选方案之间的选择方法不是由程序员直接指定的；程序必须在运行时通过应用于所有选择点的一些通用方法来决定备选方案。程序员指定有限数量的备选方案，但程序必须稍后在它们之间进行选择。（实际上，“选择”是非确定性算子的典型名称。）可以形成选择点的层次结构，较高级别的选择导致分支中包含较低级别的选择。
> 
> 一种选择方法体现在回溯系统中，其中一些替代方案可能“失败”，导致程序回溯并尝试其他替代方案。如果所有备选方案在特定选择点都失败，则整个分支都失败，程序将进一步回溯到较旧的选择点。一个复杂的问题是，因为任何选择都是试探性的并且可能被重新做出，系统必须能够通过撤销由部分执行最终失败的分支引起的副作用来恢复旧的程序状态。

出[非确定性编程](http://en.wikipedia.org/wiki/Nondeterministic_programming)文章。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-01T06:05:16.023

考虑一种为世界地图着色的算法。相邻国家不能使用颜色。该算法任意从一个国家开始，并将其着色为任意颜色。所以它继续前进，给国家上色，每一步改变颜色，直到“呃哦”，两个相邻的国家颜色相同。好吧，现在我们必须回溯，并做出新的颜色选择。现在我们没有像非确定性算法那样做出选择，这对于我们的确定性计算机来说是不可能的。相反，我们正在模拟带有回溯的非确定性算法。一个非确定性算法会为每个国家做出正确的选择。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-02T19:53:46.067

在确定性计算机上回溯的运行时间是阶乘的，即它在 O(n!) 中。

在非确定性计算机可以在每一步中立即正确猜测的情况下，确定性计算机必须尝试所有可能的选择组合。

由于不可能构建非确定性计算机，因此您的教授的意思可能如下：

复杂性类 NP 中的一个已被证明的[难题](http://en.wikipedia.org/wiki/NP-complete)（非确定性计算机可以通过始终正确猜测来有效解决的所有问题）在真实计算机上的解决比通过回溯更有效。

如果复杂性类别 P（确定性计算机可以有效解决的所有问题）和 NP 不一样，则上述陈述是正确的。这就是著名的 P 与 NP 问题。克莱数学研究所为其解决方案提供了 100 万美元的奖金，但该问题多年来一直无法证明。然而，大多数研究人员认为 P 不等于 NP。

一个简单的总结方法是：非确定性计算机可以通过始终正确猜测来有效解决最有趣的问题，这些问题非常困难，以至于确定性计算机可能不得不尝试所有可能的选择组合，即使用回溯。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-01T06:53:40.807

思想实验：

1）从视野中隐藏了一些电荷分布，您可以从中感受到力并测量它们产生的势场。告诉我所有指控的确切位置。

2）收取一些费用并安排它们。准确地告诉我他们创造的潜在领域。

只有第二个问题有一个独特的答案。[这就是向量场](http://en.wikipedia.org/wiki/Vector_potential)的非唯一性。这种情况可能类似于您正在考虑的一些非确定性算法。进一步考虑不存在的[数学极限，因为它们有不同的答案，具体取决于您从哪个方向接近不连续性。](http://en.wikipedia.org/wiki/Limit_of_a_function)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-13T15:23:23.697

我写了一个使用回溯（当然）的迷宫跑步者，我将使用它作为示例。

你穿过迷宫。当你到达一个路口时，你掷硬币来决定走哪条路。如果您选择了死胡同，请回溯到路口并采取另一条路线。如果您都尝试过，请返回上一个路口。这个算法是非确定性的，不是因为回溯，而是因为抛硬币。

现在改变算法：当你到达一个路口时，总是先尝试你还没有尝试过的最左边的路线。如果这导致死胡同，请返回交叉路口并再次尝试您尚未尝试过的最左边的路线。该算法是确定性的。没有任何机会，这是可以预见的：您将始终在同一个迷宫中遵循相同的路线。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-01T07:44:49.627

如果您允许回溯，则您允许程序中的无限循环，这使得它具有不确定性，因为所采用的实际路径可能总是包含另一个循环。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-01T10:04:07.553

非确定性图灵机 (NDTM) 可以在一个步骤中采用多个分支。另一方面，DTM 遵循试错过程。

您可以将 DTM 视为普通计算机。相比之下，量子计算机与 NDTM 相似，可以更轻松地解决非确定性问题（例如，参见它们在破解密码学中的应用）。所以回溯对他们来说实际上是一个线性过程。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-10-31T18:59:37.473

我喜欢迷宫的比喻。为简单起见，让我们将迷宫想象成一棵二叉树，其中只有一条路径。

现在您想尝试深度优先搜索以找到走出迷宫的正确方法。

非确定性计算机将在每个分支点复制/克隆自身并并行运行每个进一步的计算。就好像迷宫中的人会在每个分支点复制/克隆自己（就像电影 Prestige 中一样），并将自己的一个副本发送到树的左子分支，将自己的另一个副本发送到树的右子分支那个树。

最终陷入死胡同的计算机/人会死去（没有回答就终止）。

只有一台计算机能够存活（以答案结束），即走出迷宫的计算机。

回溯和非确定性之间的区别如下。

在回溯的情况下，在任何给定时刻只有一台计算机活着，他使用传统的迷宫解决技巧，简单地用粉笔标记他的路径，当他到达死胡同时，他只是简单地回溯到一个分支点，其子分支他还没有完全探索，就像在深度先搜索一样。

相比之下 ：

非确定性计算机可以在每个分支点克隆自己，并通过在子分支中运行并行搜索来检查出路。

所以回溯算法模拟/模拟了非确定性计算机在顺序/非并行/确定性计算机上的克隆能力。

# asp.net - 在 asp.net mvc 应用程序中处理未处理异常的一些策略是什么？

> ID：500283
> 
> 赞同：3
> 
> 时间：2009-02-01T05:32:42.843
> 
> 标签：asp.net, asp.net-mvc, exception-handling

我想知道您处理 ASP.NET MVC 中未处理的异常的一些策略/实践。

简而言之，我想在发生任何错误时避免黄屏，并向访问者显示错误一致的错误消息。

我的意思是您是否为此编写了一个控制器来显示适当的错误页面，或者您采用其他方式，例如编写 httpmodule 并在全局级别捕获错误。

对此方向的任何输入表示赞赏。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-12T18:38:37.340

使用 HandleError 属性是可行的方法。这是我用来处理来自 JQuery、ExtJs 和其他的 Ajax 调用的一个小示例。

在您的控制器上

```
public class DataController : Controller
{    
    [HandleError(ExceptionType = typeof(ArgumentException), View = "ErrorAjax")]
    public void Foo(string x, string y)
    {    
        if (String.IsNullorEmpty(x))
            throw new ArgumentException("String cannot be empty!");

            // Call your layers or whatever here
            AnotherCall();
    }
} 
```

然后在你看来（ErrorAjax）。注意它是强类型的（HandleErrorInfo）

```
<%@ Page Language="C#" Inherits="System.Web.Mvc.ViewPage<HandleErrorInfo>" %>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" >
<head runat="server">
    <title>Sorry Dude!</title>
</head>
<body>
    <div>
        <!-- be creative here-->
        Sorry, an error occurred while processing your request.
        Action = <%= ViewData.Model.ActionName %>
        Controller = <%= ViewData.Model.ControllerName %>
        Message = <%= ViewData.Model.Exception.Message %>

    </div>
</body>
</html> 
```

几个陷阱

1.  检查您的 web.config 并确保 customErrors mode="On"
2.  对于初学者，在 Shared 文件夹下创建 View

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-01T06:21:51.387

试试[HandleError 属性](http://www.pnpguidance.net/post/ASPNETMVCFrameworkPreview4HandleErrorAuthorizeOutputCacheActionFilterAttributes.aspx)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-01T06:56:41.690

不要使用您链接到的异常处理文章。这是一篇旧文章，他们没有在框架中添加 HandleError 属性。使用[HandleError 属性](http://weblogs.asp.net/scottgu/archive/2008/07/14/asp-net-mvc-preview-4-release-part-1.aspx)。它是在预览版 4 中添加的。

# javascript - Javascript：将 Math.sqrt 转换为 int？

> ID：500288
> 
> 赞同：12
> 
> 时间：2009-02-01T05:38:58.150
> 
> 标签：javascript, math, type-conversion, int, casting

我已经通过谷歌搜索（也许我看起来不够努力）但我找不到如何将 Math.sqrt 变成 int。

我想将 Math.sqrt 用于*for*循环，我想我需要它作为 int 但我似乎无法弄清楚如何将结果转换为 int。那么我该怎么做呢？

我尝试了类似于 Java 的东西：

```
(int) Math.sqrt(num); 
```

但它没有用。

提前致谢 ：）

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-02-01T05:40:06.820

使用`Math.round`、`Math.ceil`或 ，`Math.floor`具体取决于您的特定舍入需要。

*“对于将数字舍入为整数，Math.round、Math.ceil 和 Math.floor 之一是可取的，对于可以表示为 32 位有符号整数的所需结果，下面描述的按位运算也可能适用。”*

- [http://www.jibbering.com/faq/faq_notes/type_convert.html#tcNumber](http://www.jibbering.com/faq/faq_notes/type_convert.html#tcNumber)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-01T05:53:18.120

有人建议使用 parseInt。这从一个字符串到一个 int，但很容易将一个浮点数变成一个字符串。

```
parseInt(Math.sqrt(num)+"") 
```

请记住，无论您做什么，JavaScript 总是使用浮点数。没有整数类型。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-01T05:44:48.670

Math.floor 会做到这一点。不过，怀疑你甚至需要去一个整数。

```
Math.floor(Math.sqrt(num)); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-04-28T03:11:10.683

using`parseInt(Math.sqrt(num)+"")`比 using 慢`Math.round(Math.sqrt(num))`。我认为这是因为在第一个示例中，您正在创建字符串、解析整数值`num`并对其进行舍入。在第二个示例中，您只需采用 int 并对其进行舍入。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-01-16T10:02:08.920

我知道这是一个老问题，但我想为以后发现这个问题的人提供帮助......

我不会重申其他答案所说的内容，但是您可以做的一个有趣的小技巧是：

```
Math.sqrt(2); //1.41......
~~Math.sqrt(2); //1 
```

双位负数会去掉小数点后的任何内容。有人告诉我它稍微快一点，但我并不完全相信。

编辑：作为注释，这将向 0 舍入。

# linq - 在 LINQ to SQL 中搜索

> ID：500299
> 
> 赞同：0
> 
> 时间：2009-02-01T05:52:54.300
> 
> 标签：linq, linq-to-sql, search, where-clause

我有一些这样的代码：

```
Function GetTypeFromTableName(ByVal _TableName As String, ByVal _DataContext As DataContext)

    Dim Mytype As Type = (From t In _DataContext.Mapping.GetTables Where t.TableName = "dbo." + _TableName Select t.RowType.Type).SingleOrDefault
    Return Mytype

End Function

Dim DBA As New LINQDataContext
_TBLName="City"
TableType = GetTypeFromTableName(_TBLName, DBA)

Dim GridQuery = From T In DBA.GetTable(TableType) Select T

If Chk.Checked Then
    CallByName(obj, "CName", CallType.Set, Txt_Name.Text)
    GridQuery = From T In DBA.GetTable(TableType) Where T Like obj
End If 
```

此搜索不起作用，我收到此错误：

> {“方法 'System.Object LikeObject(System.Object, System.Object, Microsoft.VisualBasic.CompareMethod)' 没有支持的 SQL 转换。”} System.Exception

我应该为这个过滤器做什么？vb.net linq

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-01T06:50:02.343

其中 T.Contains(obj)

# iis-6 - 在 IIS 6.0 中每个 apppool 默认使用多少内存？

> ID：500307
> 
> 赞同：1
> 
> 时间：2009-02-01T06:02:43.593
> 
> 标签：iis-6

当每个网站在自己的 AppPool 中运行时，Windows 或 IIS 6.0 默认为每个网站分配多少内存？当网站共享相同的 AppPool 而不是每个网站都在一个单独的 AppPool 中时，效果记忆明智。我说的是网站何时启动，而不是网站在运行应用程序时开始使用内存。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-01T06:10:59.177

Vanilla Windows server 2003 IIS 6.0 进程消耗大约 5mb 的内存。

# database - sql server 中的时区注意事项

> ID：500310
> 
> 赞同：1
> 
> 时间：2009-02-01T06:04:39.987
> 
> 标签：database, sql-server-2005, timezone

我正在使用托管在美国的 sql server 2005。很快我们将把数据库搬到欧洲。我想更新数据库中的日期以考虑时区差异。有没有好的方法来做到这一点？还是只是循环日期并添加时区偏移量的情况？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-01T06:07:35.970

它真的需要改变，因为它是物理移动的吗？如果您支持全球应用程序，我会将我的所有日​​期/时间信息存储在 GMT 中并在客户端转换为本地。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-01T06:17:17.277

我认为您应该将数据库中的日期/时间保存在一个恒定的时区中，它可以是 GMT（因为将其转换为其他时区非常简单）或服务器的当前时区（如果不是 GMT）。

后一个选项有意义的唯一原因是您使用 CURDATE 函数从数据库中插入/过滤记录，否则 GMT 是最佳选择。

您可以尝试将 DATEDIFF 与 DATEADD 一起使用，但由于 DST，这并不总是给出准确的时间（在某些情况下会延迟 1 小时）。

SQL Server 2005 中存在关于时区转换的已知限制，请参阅以下链接了解更多信息： [http ://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=308563](http://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=308563)

# c - 为什么这两个程序在 ANSI C 中表现不同？

> ID：500312
> 
> 赞同：2
> 
> 时间：2009-02-01T06:05:53.650
> 
> 标签：c

> **可能重复：**
> [一个谜语（C 语言）](https://stackoverflow.com/questions/5611724/a-riddle-in-c)

1.

```
main()
{

 if(-1<(unsigned char)1)
     printf("-1 is less than (unsigned char)1:ANSI semantics");
 else
     printf("-1 NOT less than (unsigned char)1:K&R semantics");
} 
```

2.

```
int array[] = {23,41,12,24,52,11};
#define TOTAL_ELEMENTS (sizeof(array)/sizeof(array[0]))
main()
{
    int d = -1,x;
    if(d<=TOTAL_ELEMENTS -2)
        x = array[d+1];
} 
```

第一个将 unsigned char 1 转换为 ANSI C 中的有符号变量，而第二个程序将 d 转换为 unsigned int，这使得条件表达式在 ANSI C 中返回 false。为什么它们的行为不同？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-01T06:21:37.143

对于第一个，右侧是一个无符号字符，所有无符号字符值都适合一个有符号整数，因此它被转换为有符号整数。

对于第二个，右侧是无符号整数，因此左侧从有符号整数转换为无符号整数。

另请参阅[有关整数转换的 CERT 文档](https://www.securecoding.cert.org/confluence/display/seccode/INT02-C.+Understand+integer+conversion+rules)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T06:59:28.097

starblue 解释了你问题的第一部分。我会讲第二部分。因为`TOTAL_ELEMENTS`是 a `size_t`，它是无符号的，所以 int 被转换为那个无符号的类型。您的 size_t 使得 int 不能代表它的所有值，因此发生`int`to的转换`size_t`，而不是`size_t`to `int`。

负数到无符号的转换是完美定义的：值*环绕*. 如果您转换`-1`为`unsigned int`，它最终会在`UINT_MAX`. 无论您是否使用二进制补码来表示负数，这都是正确的。

C 文档的[基本原理](http://www.lysator.liu.se/c/rat/c2.html#3-2)有更多关于*保值*转换的信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T09:21:17.373

这是我记得如何应用自动转换的方式：

*   如果操作数大小不同，则将转换应用于较小的操作数以使其与较大的操作数具有相同的类型（如果较小的操作数有符号，则使用符号扩展）

*   如果操作数的大小相同，但一个是有符号的，另一个是无符号的，则将有符号的操作数转换为无符号的

虽然上述可能不适用于所有实现，但我相信它对于所有二进制补码实现都是正确的。

# java - 用于布局和布线的模拟退火

> ID：500319
> 
> 赞同：0
> 
> 时间：2009-02-01T06:11:32.420
> 
> 标签：java, c++, routing, simulated-annealing

我需要一个有据可查的用于放置和布线的模拟退火源代码（在 c++ 或 java 中）。谁能帮我？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-01T06:22:14.677

这个问题涵盖了 C# 中的实现：
[寻找 VB 中的模拟退火实现](https://stackoverflow.com/questions/127474/looking-for-simulated-annealing-implementation-in-vb/127755#127755)

本课程涵盖布局和布线的模拟退火：

[http://www.ecs.umass.edu/ece/tessier/courses/697ff/](http://www.ecs.umass.edu/ece/tessier/courses/697ff/)

并且是这个作业的特定主题：

[http://www.ecs.umass.edu/ece/tessier/courses/697ff/pset2/hw2.pdf](http://www.ecs.umass.edu/ece/tessier/courses/697ff/pset2/hw2.pdf)

如果您无法自己完成编写过程，您可以联系开设课程的部门/教授：

[http://www.ecs.umass.edu/ece/tessier/rcg/](http://www.ecs.umass.edu/ece/tessier/rcg/)

很有可能他们有一些接近你需要的东西。

-亚当

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-01-20T12:01:59.620

看一下[Drools Planner](http://www.jboss.org/drools/drools-planner)的源代码（开源，java），更具体地说是`SimulatedAnnealingAccepter`. 它用于护士排班示例中的放置。

# python - 在 numpy 中识别数字和数组类型

> ID：500328
> 
> 赞同：21
> 
> 时间：2009-02-01T06:17:38.633
> 
> 标签：python, numpy

numpy 中是否有一个现有函数可以告诉我一个值是数字类型还是 numpy 数组？我正在编写一些需要处理几种不同表示形式的数字的数据处理代码（“数字”是指可以使用标准算术运算符 +、-、*、/、* 操作的数字量的任何表示形式） *)。

我正在寻找的一些行为示例

```
>>> is_numeric(5)
True
>>> is_numeric(123.345)
True
>>> is_numeric('123.345')
False
>>> is_numeric(decimal.Decimal('123.345'))
True
>>> is_numeric(True)
False
>>> is_numeric([1, 2, 3])
False
>>> is_numeric([1, '2', 3])
False
>>> a = numpy.array([1, 2.3, 4.5, 6.7, 8.9])
>>> is_numeric(a)
True
>>> is_numeric(a[0])
True
>>> is_numeric(a[1])
True
>>> is_numeric(numpy.array([numpy.array([1]), numpy.array([2])])
True
>>> is_numeric(numpy.array(['1'])
False 
```

如果不存在这样的功能，我知道写一个应该不难，比如

```
isinstance(n, (int, float, decimal.Decimal, numpy.number, numpy.ndarray)) 
```

但是我应该在列表中包括其他数字类型吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-01T14:22:55.923

正如其他人所回答的那样，除了您提到的数字类型之外，可能还有其他数字类型。一种方法是明确检查您想要的功能，例如

```
# Python 2
def is_numeric(obj):
    attrs = ['__add__', '__sub__', '__mul__', '__div__', '__pow__']
    return all(hasattr(obj, attr) for attr in attrs)

# Python 3
def is_numeric(obj):
    attrs = ['__add__', '__sub__', '__mul__', '__truediv__', '__pow__']
    return all(hasattr(obj, attr) for attr in attrs) 
```

这适用于除最后一个示例之外的所有示例，`numpy.array(['1'])`. 这是因为`numpy.ndarray`具有数值运算的特殊方法，但如果您尝试将它们不适当地用于字符串或对象数组，则会引发 TypeError。您可以为此添加显式检查

```
 ... and not (isinstance(obj, ndarray) and obj.dtype.kind in 'OSU') 
```

这可能已经足够好了。

但是......你永远不能*100%*确定某人不会定义具有相同行为的另一种类型，所以更万无一失的方法是实际尝试进行计算并捕获异常，例如

```
def is_numeric_paranoid(obj):
    try:
        obj+obj, obj-obj, obj*obj, obj**obj, obj/obj
    except ZeroDivisionError:
        return True
    except Exception:
        return False
    else:
        return True 
```

但取决于您计划调用使用它的频率以及使用哪些参数，这可能不实用（它可能会很慢，例如使用大型数组）。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-01-21T01:00:35.943

此外，numpy 具有`numpy.isreal`和其他类似功能（`numpy.is`+ Tab 应该列出它们）。

他们都有自己有趣的角落案例，但其中一个可能很有用。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-01T07:34:44.610

一般来说，处理未知类型的灵活、快速和 Pythonic 方法是对它们执行一些操作并捕获无效类型的异常。

```
try:
    a = 5+'5'
except TypeError:
    print "Oops" 
```

在我看来，这种方法比特殊封装一些函数来确定绝对类型确定性更容易。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-01T07:31:03.383

你`is_numeric`的定义不明确。请参阅我对您的问题的评论。

其他数字类型可以是：`long`, `complex`, `fractions.Fraction`, `numpy.bool_`, `numpy.ubyte`, ...

`operator.isNumberType()`返回`True`Python 数字和`numpy.array`.

从 Python 2.6 开始，您可以使用`isinstance(d, numbers.Number)`而不是 deprecated `operator.isNumberType()`。

通常最好检查对象的功能（例如，是否可以向其添加整数）而不是其类型。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-01-20T08:54:13.053

`isinstance(numpy.int32(4), numbers.Number)`Returns `False`，所以这不太有效。`operator.isNumberType()`但是，它确实适用于 numpy 数字的所有变体，包括`numpy.array([1])`.

# javascript - 如何滚动到jQuery中的元素？

> ID：500336
> 
> 赞同：74
> 
> 时间：2009-02-01T06:24:03.893
> 
> 标签：javascript, jquery, html, focus

我在 JavaScript 中完成了以下代码以将重点放在特定元素上（branch1 是一个元素），

```
document.location.href="#branch1"; 
```

但由于我也在我的网络应用程序中使用 jQuery，所以我想在 jQuery 中执行上述代码。我试过了，但不知道为什么它不起作用，

```
$("#branch1").focus(); 
```

上面的 jquery (focus()) 代码不适用于 div，而如果我尝试使用文本框使用相同的代码，那么它的工作，

请告诉我，如何使用 jQuery 将注意力集中在 div 元素上？

谢谢！

* * *

## 回答 #1

> 赞同：117
> 
> 时间：2010-03-13T21:47:41.693

对于我的问题，这段代码有效，我必须在页面加载时导航到锚标记：

```
$(window).scrollTop($('a#captchaAnchor').position().top); 
```

就此而言，您可以在任何元素上使用它，而不仅仅是锚标记。

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2010-07-04T00:52:11.033

就像@user293153 我只是发现了这个问题，似乎没有得到正确的回答。

他的回答是最好的。但是您也可以为元素设置动画。

```
$('html, body').animate({ scrollTop: $("#some_element").offset().top }, 500); 
```

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2011-09-23T15:26:07.160

您可以像这样扩展 jQuery 功能：

```
jQuery.fn.extend({
scrollToMe: function () {
    var x = jQuery(this).offset().top - 100;
    jQuery('html,body').animate({scrollTop: x}, 500);
}}); 
```

进而：

```
$('...').scrollToMe(); 
```

简单的 ;-）

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2009-02-01T06:50:12.327

检查[jQuery.ScrollTo](https://github.com/flesler/jquery.scrollTo)，我认为这是你想要的行为，检查[demo](http://demos.flesler.com/jquery/scrollTo/)。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-01-21T17:07:53.670

**查看[jquery-scrollintoview](https://github.com/litera/jquery-scrollintoview)。**

ScrollTo 很好，但通常您只是想确保 UI 元素可见，不一定在顶部。ScrollTo 对此没有帮助。从 scrollintoview 的自述文件：

> ### 这个插件如何解决用户体验问题
> 
> 此插件将特定元素滚动到类似于浏览器内置功能（DOM 的 scrollIntoView() 函数）的视图中，但工作方式不同（并且可以说对用户更友好）：
> 
> *   它仅在元素实际上不在视野中时滚动到元素；如果元素在视图中（可见文档区域中的任何位置），则不会执行滚动；
> *   它使用动画效果滚动；当执行滚动时，用户确切地知道他们没有被重定向到任何地方，但实际上看到他们只是在同一页面内的其他地方移动（以及他们移动的方向）；
> *   总是有最小量的滚动被应用；当元素在可见文档区域上方时，它将滚动到可见区域的顶部；当元素低于可见元素时，它将滚动到可见区域的底部；这是最一致的滚动方式 - 当滚动总是在顶部时，当元素接近可滚动容器的底部时，有时无法将元素滚动到顶部（因此滚动将是不可预测的）；
> *   当元素的大小超过可见文档区域的大小时，它的左上角是滚动到的那个；

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-11-26T08:02:27.843

采用

> $(窗口).scrollTop()

它会将窗口滚动到该项目。

```
 var scrollPos =  $("#branch1").offset().top;
 $(window).scrollTop(scrollPos); 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2020-09-08T05:04:05.860

如果你只是想滚动到指定的元素，你可以使用 Element 的[scrollIntoView](https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollIntoView)方法。这是一个例子：

```
$target.get(0).scrollIntoView(); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-01T06:31:26.360

鉴于您的示例，我认为您可能正在寻找“锚”。

```
<a href="#jump">This link will jump to the anchor named jump</a>
<a name="jump">This is where the link will jump to</a> 
```

focus jQuery 方法的作用与您想要实现的不同。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-08-15T12:31:38.747

为了让 focus() 函数作用于元素，div 需要有一个 tabindex 属性。默认情况下，这种类型的元素可能不会这样做，因为它不是输入字段。例如，您可以在 -1 添加一个 tabindex，以防止使用 tab 的用户专注于它。如果您使用正向 tabindex 用户将能够使用 tab 来关注 div 元素。

这里是一个例子：http: [//jsfiddle.net/klodder/gFPQL/](http://jsfiddle.net/klodder/gFPQL/)

但是 Safari 不支持 tabindex。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2022-02-17T18:30:49.460

也许你想试试这个简单的

```
$(document).ready(function() {
   $(".to-branch1").click(function() {
     $('html, body').animate({
         scrollTop: $("#branch1").offset().top
     }, 1500);
   });
}); 
```

# c++ - 替代关键字表示

> ID：500362
> 
> 赞同：0
> 
> 时间：2009-02-01T06:58:25.807
> 
> 标签：c++

C++ 标准 (ISO/IEC 14882:03) 声明如下 ( **2.11** / **2** )：

> 此外，表 4 中显示的某些运算符和标点符号 (2.5) 的替代表示是保留的，不得以其他方式使用：
> 
> **and, and_eq, bitand, bitor, compl,** **not, not_eq, or, or_eq, xor, xor_eq**

我已经尝试将这些与多个编译器一起使用而没有问题。

据我了解，我只被禁止使用这些作为标识符名称。英语不是我的第一语言，所以如果有人能验证我确实可以在表达式中使用这些按位助记符（即“int i = not 0;”），那就太好了。

**编辑：**我可能应该指出，我*不会*通过使用这些来掩盖代码（如果它们有效的话）。这只是为了一般知识。=)

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-01T07:05:38.053

是的，您可以将它们用作名称令牌的替代品。例如：

```
struct foo {
    // defines a destructor
    compl foo() { }
}; 
```

你的例子也可以。然而，它会将一个 1 存储到 i 中。如果要按位不使用，请使用 compl (~)：

```
int i = compl 0; 
```

# css - Flex 中的 CSS 寻址：仅 RichTextEditor 中的按钮？

> ID：500366
> 
> 赞同：1
> 
> 时间：2009-02-01T07:02:57.263
> 
> 标签：css, apache-flex, addressing

我想更改 RichTextEditor 工具栏中按钮的字体特征，但我希望它们与我的应用程序中的其他按钮不同。**有没有办法只用 CSS 来做到这一点？**我知道我可以在必要时使用 setStyle 来做到这一点......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-01T20:58:10.307

由于 RichTextEditor 的子组件在 MXML 中声明并因此可以公开访问，因此一种方法是`styleName`在运行时单独分配它们的属性（在容器的`creationComplete`事件触发后，确保编辑器及其所有子组件都已创建） ，像这样：

```
<mx:Style>

    .myRTECombo
    {
        color: #FF0000;
    }

</mx:Style>

<mx:Script>
    <![CDATA[

        private function creationCompleteHandler(event:Event):void
        {
            rte.fontFamilyCombo.styleName = "myRTECombo";
            rte.fontSizeCombo.styleName = "myRTECombo";
        }

    ]]>
</mx:Script>

<mx:RichTextEditor id="rte" /> 
```

Flex 文档不会按 ID 调用子组件（“boldButton”、“fontSizeCombo”等），但组件的源代码可供查看，因此您应该能够从源代码中获取所需的所有信息本身。由于我使用FlexBuilder，所以我通常使用Eclipse Ctrl+click快捷方式，在标签/类名上，跳转到关联的类定义文件，但你也可以直接在[installDir]/sdks/[version]打开源文件]/frameworks/src/mx/RichTextEditor.mxml 自己看看。

我敢肯定还有其他方法（`setStyle`作为一种方法，尽管出于性能原因通常不鼓励明确使用它），但这应该适合您。但是，当您深入研究组件的源代码时，需要注意的一点是，默认按钮集中的许多按钮实际上使用的是 PNG（例如，`icon_style_bold.png`），而不是文本，这就是我的示例包含参考的原因改为 ComboBox，这样您就可以看到颜色更改是如何应用的；如果您想更改按钮的外观，请注意它们使用的是 styleable`icon`属性，而不是 font-style 设置，用于他们的外观和感觉。

希望能帮助到你！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-01T21:54:26.607

谢谢@Christian Nunciato！这是我的最终代码，在我的 RichTextEditor 组件中（扩展它）。在creationComplete中，我称之为

```
private function setUpStyleNames():void {
    setUpStyleNamesInner(toolbar.getChildren());
    setUpStyleNamesInner(toolBar2.getChildren());
}

private function setUpStyleNamesInner(children:Array):void {
    for each (var child:DisplayObject in children) {
        if (child is UIComponent) {
            UIComponent(child).styleName = "rteInnards";
        }
    }
} 
```

然后在我的样式表中，我有这个

```
.rteInnards {
    color: #FF0000;
    fontSize: 25px;
} 
```

惊人的。再次感谢！

# cocoa - 使用 Mac OS X Cocoa 绘制文本时如何重现插入文本样式？

> ID：500374
> 
> 赞同：5
> 
> 时间：2009-02-01T07:17:58.123
> 
> 标签：cocoa, user-interface, text, drawing

例如，我说的是焦点标题栏或 safari 的书签栏上文本的凹槽样式。使用时是否有一种简单的方法来重现这种风格：

```
[string drawAtPoint:... withAttributes:...]; 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-01T10:43:02.687

如果你想让它看起来很完美，你需要绘制两次文本。

正如您在任何应用程序中放大工具栏项目下方的标签时所看到的那样，或者例如 Safari 中的书签栏（Control+scroll up，control+option+\ 以切换放大图像的平滑度），文本呈现为 sub - 像素抗锯齿，至少在“外观”系统首选项中的“字体平滑样式：”设置为中等时，在具有内置或外部 Apple 平板显示器的 Mac 上默认设置为中等。

NSShadow 不能与子像素抗锯齿一起使用，因此如果您只是在属性字典中设置一个 NSShadowAttributeName 来绘制字符串，当您放大渲染时，您会注意到子像素抗锯齿是 MIA文本。由于 NSShadow 的设计方式，无论您将 NSShadow 实例设置为哪种颜色（即使它是不透明的），它都将始终使用 Alpha 通道进行绘制，从而无法实现亚像素抗锯齿。

解决方案真的很简单：

1.  用具有一定透明度的白色绘制一次文本，
2.  然后在上面再画一次，在你喜欢的灰色阴影中高一个像素，没有透明度。

您的“阴影”将在没有亚像素抗锯齿的情况下绘制，但它顶部的实际文本将使用它绘制，为您提供与标准 Cocoa 工具栏按钮项目标签或 Safari 书签栏中的项目完全相同的效果。

编辑：似乎 Safari 的书签栏项目也以亚像素精度绘制它们的“阴影”，所以他们这样做的方式可能是为白色“阴影”文本选择不透明的灰色阴影；该方法的缺点：您将绘图代码绑定为仅适用于特定背景颜色，例如，如果您的元素将用于蓝色背景，您需要将该颜色设置为浅蓝色，以显示就像它是半透明的白色。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-01T07:48:14.583

在它下面画一个非阴影。使用白色阴影，不透明度 50% 左右，模糊 0，向下偏移 1 磅。

一个简单的方法是简单地绘制文本两次。第一次，您将其绘制为低 1 pt，白色，不透明度为 50%。第二次，您将其绘制在所需的位置，以所需的颜色，以所需的（可能是 100%）不透明度。

# c# - 使用 lambda 选择子对象集合

> ID：500376
> 
> 赞同：2
> 
> 时间：2009-02-01T07:19:27.340
> 
> 标签：c#, object, lambda, extension-methods, linq-to-objects

我有以下类对象：

```
 public class VacancyCategory
{
    public int ID { get; set; }
    public string Text { get; set; }
    public IList<VacancySubCategory> SubCategories { get; set; }
}

    public class VacancySubCategory
{
    public int ID { get; set; }
    public string Text { get; set; }
    public VacancyCategory Category { get; set; }
    public IList<Vacancy> Vacancies { get; set; }
}

    public class Vacancy : IBusinessObject
{
    public int ID { get; set; }
    public string Title { get; set; }
    public VacancySubCategory SubCategory { get; set; }
    public string Body { get; set; }
    public VacancyWorkType WorkType { get; set; }
    public string Salary { get; set; }
    public DateTime? AppsClosingDate { get; set; }
    public bool Active { get; set; }
} 
```

...所以在测试存储库中，我正在创建测试数据，如下所示：

```
 private IList<VacancyCategory> GetVacancyCategoriesWithAllChildCollections()
    {
        IList<VacancyCategory> vacancyCategories = new List<VacancyCategory>();

        int cCounter = 0;
        int scCounter = 0;
        int vCounter = 0;
        for (int i = 1; i <= 3; i++)
        {
            VacancyCategory vc = new VacancyCategory();
            vc.ID = ++cCounter;
            vc.Text = "VacancyCategory" + i.ToString();

            for (int j = 1; j <= 3; j++)
            {
                VacancySubCategory vsc = new VacancySubCategory();
                vsc.ID = ++scCounter;
                vsc.Text = "VacancySubCategory" + scCounter.ToString();
                vsc.Category = vc;

                for (int k = 1; k <= 2; k++)
                {
                    Vacancy v = new Vacancy();
                    v.ID = ++vCounter;
                    v.Title = "Vacancy" + vCounter.ToString();
                    v.Body = "VacancyBody" + vCounter.ToString();
                    v.Active = vCounter >= 16 ? false : true;
                    v.WorkType = this._workTypes.Single(wt => wt.ID == k);
                    v.Salary = vCounter <= 7 ? "SR " + (vCounter * 1000).ToString() : "";
                    v.AppsClosingDate = (vCounter >= 3 & vCounter <= 13) ? (new DateTime(2009, 3, vCounter)) : (DateTime?)null;
                    v.SubCategory = vsc;

                    if (vsc.Vacancies == null)
                        vsc.Vacancies = new List<Vacancy>();
                    vsc.Vacancies.Add(v);
                }

                if (vc.SubCategories == null)
                    vc.SubCategories = new List<VacancySubCategory>();
                vc.SubCategories.Add(vsc);
            }

            vacancyCategories.Add(vc);
        }

        return vacancyCategories;
    } 
```

..所以现在我有一些很好的测试数据。对象树/链接对象对我很重要。

所以我想在需要时从这棵树中返回单个对象集合。例如，如果我想要整棵树，我可以只返回包含所有子对象的 VacancyCategory 列表——太好了。但现在我只想返回 VacancySubCaregory 项目（全部 9 个）。这将是我对测试存储库的公共方法：

```
 public IQueryable<VacancySubCategory> GetVacancySubCategories()
    {

         throw new NotImplementedException("write gen code");
    } 
```

..显然无一例外。我有一个名为 _categories 的成员字段，其中包含 GetVacancyCategoriesWithAllChildCollections 方法的结果。所以我一直在尝试像

```
this._categories.Select( ...... 
```

..但我似乎无法返回 VacancySubCategory 对象的列表。我似乎总是选择根集合（即 VacancyCategory 对象的结果集）。我究竟做错了什么？我确定它很简单……但它让我发疯！

**编辑**

谢谢马特。

您的建议使我想到了这一点：

```
 public IQueryable<VacancySubCategory> GetVacancySubCategories()
    {
        return this._categories.SelectMany(c => c.SubCategories).AsQueryable<VacancySubCategory>();
    } 
```

..效果很好。你是冠军

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-01T07:24:12.087

尝试：

```
return this._categories.SelectMany(c => c.SubCategories); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T07:25:03.490

这应该有效。

```
var query = from vc in GetVacancyCategoriesWithAllChildCollections()
from vcs in vc.SubCategories
select vcs 
```

# iphone - iPhone (Xcode) 界面构建器资源

> ID：500378
> 
> 赞同：3
> 
> 时间：2009-02-01T07:19:55.997
> 
> 标签：iphone, xcode, xcodebuild

我正在寻找资源（尤其是视频）来展示如何正确使用 Xcode 的界面构建器进行 iPhone 开发。出于某种原因，它只是没有点击所有内容如何组合在一起以及如何正确使用它。

谢谢斯蒂芬

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-01T07:23:43.617

除了 Apple [iPhone Dev Center](http://developer.apple.com/iphone/)上的示例应用程序和视频外，Pragmatic Programmers 还有一[本好书](http://www.pragprog.com/titles/amiphd/iphone-sdk-development)和一些[不错的视频](http://www.pragprog.com/screencasts/v-bdiphone/writing-your-first-iphone-application)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T04:45:39.770

另一个网站是~~[iPhone Programming Tutorial](http://icodeblog.com/)~~。它是免费的，但我正在考虑购买 Abie 提到的视频和书籍。

编辑：决定浏览我的历史并找到这个死链接。

# php - 根据编码类型（utf-8）显示乱码的嵌入式脚本

> ID：500384
> 
> 赞同：2
> 
> 时间：2009-02-01T07:24:04.053
> 
> 标签：php, encoding, utf-8, widget

我有一个小部件，人们可以将其放入他们的网站。

该小部件是通过 php 脚本生成的，该脚本使用以下命令回显填充的字符串：document.write('$widget_output')。

托管站点使用 javascript 标签调用小部件：

```
<script type="text/javascript" src="http://www.link.com/page.php?param=1"></script> 
```

问题是我的小部件是 utf-8，有时它与托管它的网站不同，导致小部件显示乱码。

有没有人有办法修复它，使其在任何情况下都能正常工作？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-01T07:48:38.543

添加内容编码 http 标头（在我的 iPhone 上快速编写）

让我进一步解释一下（写在我的笔记本电脑上；-）。浏览器向服务器请求不同的资源。每个浏览器内部都使用 Unicode 来表示要显示的数据。来自 Web 服务器的每个资源（html 页面、javascript 文件、css 文件等）都可以选择在 http 标头中附加编码信息。如果它具有内容编码标头，则浏览器使用响应标头中的编码将资源转换为内部 unicode 表示。如果没有 content-encoding 标头，浏览器会假定文件编码与请求资源的页面相同。

结论：如果您有一个从 Web 服务器提供并在具有不同编码的页面上使用的脚本，请确保向该脚本添加内容编码 http 标头。

# c++ - 跟踪对象局部坐标空间

> ID：500387
> 
> 赞同：1
> 
> 时间：2009-02-01T07:25:41.117
> 
> 标签：c++, math, 3d, vector, directx

[好的，所以 - 这与我之前的问题在两个坐标空间之间转换一个对象](https://stackoverflow.com/questions/499713/transforming-an-object-between-two-coordinate-spaces)密切相关，但更直接，它应该有一个明显的答案。

一个对象的局部坐标空间，我如何“掌握它”？假设我将一个兽人加载到我的游戏中，我如何以编程方式知道它的头部、左臂、右臂和原点（肚脐？）在哪里？当我知道它在哪里时，我需要手动保存它还是它神奇地存在于 DirectX API 中？在我的另一个问题中，有人说过要为 X、Y、Z 方向和原点存储顶点？我如何找到这些顶点？我是否随意选择它们，在将它们加载到我的游戏中之前将它们分配到模型中？等等

这不是关于坐标空间之间的转换

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-01T09:42:07.050

实际上，它是关于***坐标空间之间的转换***。

好的，您了解您可以拥有一个进行平移或旋转的矩阵。（或缩放。或倾斜。等）您可以将这样的矩阵乘以一个点（V）以获得新的（平移/旋转/等）点。例如：

```
Mtranlate = [ 1 0 0 Tx ]   *  V = [ Vx ]   =   [ Vx + Tx ]
            [ 0 1 0 Ty ]          [ Vy ]       [ Vy + Ty ]
            [ 0 0 1 Tz ]          [ Vz ]       [ Vz + Tz ]
            [ 0 0 0 1  ]          [  1 ]       [  1      ] 
```

或绕 X/Y/Z 轴旋转：

```
Mrotate_x = [ 1  0     0    0 ]  * V =  [ Vx ]   =   [ Vx              ]
            [ 0 cos  -sin   0 ]         [ Vy ]       [ Vy*cos - Vz*sin ]
            [ 0 sin   cos   0 ]         [ Vz ]       [ Vy*sin + Vz*cos ]
            [ 0  0     0    1 ]         [  1 ]       [  1              ] 
```

您可以通过将矩阵相乘来组合多个操作。
例如：Mnew = Mtranslate * Mrotate_x。
（是的，顺序很重要！）

因此，给定一个真实世界的基础原点，您可以转换为您的（已知/提供的）兽人的 xy 位置，从该点的地形推断出您的兽人脚的 z 位置并转换为该位置。现在你的兽人的“脚”在全局坐标中。从那里，你可能想要旋转你的兽人，让他面向一个特定的方向。

然后向上平移（根据你的兽人模型）找到它的脖子。从颈部，我们可以向上平移（也可能旋转）以找到它的头部或向上平移以找到它的肩膀。从肩部，我们可以旋转和平移来找到肘部。从肘部我们可以旋转和平移来找到手。

你的兽人模型的每个组件都有一个本地参考框架。每个都与通过一个或多个变换（矩阵）附加的参考帧相关。通过乘以所有局部矩阵（变换），我们最终可以看到如何从兽人的脚到他的手。

（请注意，我会为兽人设置动画，然后只使用他的脚 x、y、z 位置。否则工作量太大。）

你会在机器人技术中看到很多这样的东西，它们可以为正向运动学提供一个很好的基本介绍。在机器人技术中，至少对于更简单的机器人来说，你有一个旋转的电机和一个可以平移的肢体长度。然后还有另一个马达。（相比之下，人的肩关节可以同时围绕所有三个轴旋转。）

您可以[查看CMU 机器人操作课程 (15-384)**的课程讲义。**](http://www.cs.cmu.edu/afs/cs.cmu.edu/academic/class/15384/web/Fall2007/)

也许像他们的[Forward Kinematics Intro](http://www.cs.cmu.edu/afs/cs.cmu.edu/academic/class/15384/web/Fall2007/lectures/lecture09_17sep07.pdf)一样。

# roguelike - 哪种编程语言最适合创建类 Rogue 游戏？

> ID：500404
> 
> 赞同：16
> 
> 时间：2009-02-01T07:51:28.290
> 
> 标签：roguelike

出于对创建 Roguelike RPG（例如 Nethack、Rogue 和 ADOM）的兴趣，哪种编程语言最适合？为什么？

使用您选择的语言，请务必列出使其特别适合的语言的任何库或方面。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-01T08:13:01.910

早在那天我尝试使用[QuickBASIC](http://en.wikipedia.org/wiki/QuickBASIC)编写 Roguelike 游戏时（那是 1988 年）。不是推荐的方法......

那里仍然有一些开发圈。这是一个[关于 Roguelike 开发的常见问题解答](http://roguebasin.roguelikedevelopment.org/index.php?title=Roguelike_Dev_FAQ#GENERAL_DEVELOPMENT_QUESTIONS)，还有一个[专门讨论这个问题的博客](http://community.livejournal.com/roguelikes/)。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-05T11:03:58.503

我使用的语言（我也在尝试创建 roguelike）是 Python，因为：

*   它是高级编程语言，我不需要一直考虑内存分配等问题，而是将注意力放在算法上。
*   几乎所有东西都有大量有用的库。最近我发现[TDL](http://4b796c65.googlepages.com/tdl) / [libtcod](http://jice.nospam.googlepages.com/thedoryenlibrary)对 roguelike 开发很有用。
*   通过绑定，您可以轻松使用 C/C++ 库，甚至可以在 C/C++ 中编写一些关键函数并使用它们。
*   这是我见过的最易读的编程语言。
*   在使用 Python 编程时，我学会了使用内部文档。这是非常有用的事情，几个月后我才阅读我的代码，我仍然知道它在做什么。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-11-18T19:14:46.860

一如既往，这是一个非常个人的选择:-)

我用 Java 编写了我的 Roguelike 游戏（暴君），原因如下：

*   非常便携（即使有图形）
*   垃圾收集/内存管理
*   许多好的免费/开源库可用（有助于算法、数据结构和操作保存游戏文件等）
*   它是一种静态类型的语言——它具有性能和鲁棒性的好处，我认为值得额外的编码复杂性
*   我想更广泛地磨练我的 Java 技能，以便在其他项目中使用

编辑：对于那些感兴趣的人来说，它是开源的，所有代码都可以在[SourceForge获得](https://sourceforge.net/projects/tyrant/)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-01T21:33:36.320

好吧，我在 C 语言中制作了几个 roguelike，在[roguebasin](http://roguebasin.roguelikedevelopment.org)上花费了相当多的时间，这是一个与 roguelike 开发相关的任何东西的好网站。

至于你应该使用什么语言，我真的不认为它有很大的不同。我选择 C ​​是因为它的可移植性，而且很多库都可以很好地使用它。但是面向对象的语言可以清理一些你可能不想跟踪的东西。

对于roguelikes，我认为没有任何语言比其他语言更出色。如果您要使其图形化，您可能更喜欢内置的东西，例如闪光灯/silverlight。但即便如此，也有任何其他语言的库在这方面给它们带来了大致相同的难度。

所以我会说选择一门你知道和喜欢的语言，或者你不知道但想学的语言..

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-01-29T18:52:01.110

这些答案中的大多数都很棒，但是对于可以在 C++ 中滥用的面向对象的东西和低级命令的综合力量，还有一些话要说。如果您正在寻找一些灵感，NetHack 的 C 源代码是广泛可用的，并且记录得很好，您当然可以四处寻找以了解一些东西。也就是说，这是一个几十年来一直在增长的巨大项目，并不是所有的东西都像你想要的那样干净，因为你会为自己的项目想要一些东西——不要根据你在 NetHack 中找到的东西来做出糟糕的设计选择.

不过，老实说，就您使用的内容而言，它可能根本不重要——尽管我强烈建议您使用 OO 语言。在 Roguelike 游戏中（真见鬼，真的是任何 CRPG）都有很多垃圾需要处理，以至于 OOP 是保持理智的最简单方法。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-01T08:07:40.253

最初的 nethack 是用 C 语言编写的，如果您想了解它的编写方式以及您可能发现的挑战，这可能是开始决定一种语言的好方法，可以使用该[源代码。](http://www.nethack.org)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-06T19:16:07.607

我的第一个问题是该游戏是否将具有基于 Web 的 UI 或者是某种控制台/窗口事件，如最初的 Rogue-like 游戏？如果是前者，我会说您喜欢的任何语言都是不错的选择。Ruby on Rails、Python/Django、PHP/CakePHP 等都会很棒。

但如果答案是后者，这是一款你希望人们能够在本地下载和安装的游戏，我将使用 Java。这是一门很棒的语言，无需您处理任何内存管理。由于实时编译和优化，它实现了非常高的性能，它有一个非常丰富的库来帮助你处理数据结构，Swing 制作了一些非常漂亮的 UI，2D 库允许最丰富的跨平台在 PostScript 之外渲染。它还具有跨 Windows、Mac OS X 和 Linux 的可用性，这是您无法从其他一些选择中获得的。

最后，通过 Java Web Start 也可以轻松分发您的应用程序，因此人们在拥有 Java 后只需单击几下即可下载和安装游戏，并将其保留在他们的机器上，只要他们喜欢就可以运行。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-06-13T00:01:57.307

对于制作任何游戏，任何语言都是正确的，如果：

1.  你可以使用它（你可以使用它，通过知识或者如果它现在对你或你的团队来说很容易学习）
2.  它生成在您客户的计算机上运行的应用程序
3.  它可以轻松生成运行速度足以满足您游戏需求的应用程序。

我认为对于 Rogue-Like 来说，只要它在你的目标上运行，你知道的任何语言都是正确的。在这种游戏中，性能并不是真正的问题。如果您的世界生成确实很复杂，那么世界生成可能需要高性能......

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-06-13T00:05:48.627

只需使用可以为您处理低级细节的东西。无论您知道什么都应该有效。

嘿，他们可以用javascript写一个。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-02-01T08:02:28.250

我推荐`Actionscript`那些游戏。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2009-02-01T21:17:01.250

你可以考虑 Silverlight。

它位于 C# 和 .Net 之上，因此无需担心内存管理。使用 SL，您将获得对场景图类型渲染的内置支持 - 剔除不在屏幕上的事物、键盘、鼠标事件、对象点击等。

有一个初步的学习曲线，但我发现这是一个很好的工作环境。

# python - 如何使用 Reportlab 垂直对齐表格中的段落？

> ID：500406
> 
> 赞同：4
> 
> 时间：2009-02-01T07:55:43.443
> 
> 标签：python, pdf, alignment, reportlab

我正在使用 Reportlab 生成报告卡。成绩单基本上是一个大表对象。表格单元格中的一些内容需要换行，特别是标题和评论，我还需要将某些元素加粗。

为了同时完成换行和加粗功能，我在表格中使用了段落对象。我的表格需要其中几个元素垂直对齐到“中间”，但段落对齐并将我的文本对齐到单元格的底部。

如何在表格单元格中垂直对齐段落？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-05T16:01:15.520

我不得不问：您是否尝试过表格样式VALIGN：MIDDLE？

就像是：

```
t=Table(data) 
t.setStyle(TableStyle([('VALIGN',(-1,-1),(-1,-1),'MIDDLE')])) 
```

（ReportLab 用户指南第 7.2 节中的更多详细信息）

如果这样做不行，那么您的段落对象必须是单元格的完整高度，并且在内部与底部对齐。

您能否发布一个重现该问题的小样本？

# php - 我应该注意 Derek Sivers 关于从 PHP 迁移到 Rails 的警告吗？

> ID：500424
> 
> 赞同：9
> 
> 时间：2009-02-01T08:14:33.827
> 
> 标签：php, ruby-on-rails, comparison

您可能知道，Derek Sivers 是创造 CD Baby 并最终以高价出售的人。他最初是用 PHP 编写的，然后开始着手在 Rails 中重写它。他的烦恼是传说中的东西：

[**在使用 Rails 2 年后我切换回 PHP 的 7 个原因**](http://www.oreillynet.com/ruby/blog/2007/09/7_reasons_i_switched_back_to_p_1.html)

那篇文章发表于 2007 年，但我最近迷上了 Rails，我想知道是否有什么改变让 Rails 在此期间更明智，还是我应该坚持我的好老丑 PHP 女朋友？

**是否有人同意 Rails 与 PHP 相比没有任何显着优势？**

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-01T08:27:07.653

Austin Ziegler 对那篇文章写了一个有趣的回应：

[关于 Derek Siver 回归 PHP……](http://www.halostatue.ca/2007/09/23/on-derek-sivers-return-to-php%E2%80%A6/)

它的要点是：

> 1.  Derek 出于错误的原因选择了这项技术。他选择它的部分原因是因为 Rails 的炒作，但他认为它是一颗灵丹妙药，可以神奇地使他的应用程序变得更好，因为它在 Rails 中。
>     
>     
> 2.  Rails 不适合 Derek 的 CD Baby 应用模型，而且 Derek 的应用模型比使用的技术更重要，因为它代表了他非常了解的业务。
>     
>     
> 3.  他忽视了他现有的新技术专家。除了玩弄它之外，他和他的员工都不认识 Ruby。从经验来看，这不是一项被认为合适的技术。这是管理层认为合适的技术（对不起，Derek，您可能仍然在处理代码，但您仍然是管理人员）。
>     
>     
> 4.  Derek 将该项目作为一个使用 One Big Day 部署的整个环境从头开始重写，而没有考虑随着时间的推移逐步分阶段进行的方法。几乎总是可以找到接口点，您可以一次更换一个损坏的部件。最终，这就是 Rails 人员应该告诉你的：一次替换一个区域，每个区域使用不同的代码库。将它们连接为 REST-ful 服务。不要让它们依赖于单个数据库模式。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-02-01T10:31:11.057

重写现有网站几乎总是一个坏主意。翻新旧轮子很难全心全意。我致力于将一个站点从 CGI 重写为 Java 应用程序服务器，并看到一些程序员因此而退出。一方面，他们更喜欢旧的做事方式，不想学习 Java。其次，我相信他们没有热情重写大量他们一直不情愿地维护的遗留代码。最好在新任务上试用 Rails，看看效果如何。至少在心理动机抽奖活动中，你将它与 PHP 放在了一个平等的基础上。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-02-01T09:14:08.903

我有使用 PHP 和 Ruby + Ruby on Rails 的经验（使用两者都赚了钱，但不是很多）。

Ruby 库要好得多。PHP 的库是一个全局命名空间中的函数集合，它们的名称和参数顺序不一致。`strpos`与`str_repeat`。`strpos`的第一个参数是大字符串，第二个参数是要查找的字符串。`explode`的第一个参数是要分割的字符串，第二个参数是大字符串。这对我来说是个大问题。使用 PHP 时我必须查找很多东西，但使用 Ruby 时则不需要。我能记住事情，因为它们是一致的。方法的名称使参数顺序清晰。另一个：PHP`strlen($str)`与`count($arr)`Ruby 相比，它只是`anything.length`.

Ruby 语言优于 PHP。它具有闭包、良好的 OO、良好的语法（这是主观的，但在 Ruby 中您需要的标点符号要少得多，这就是我最常犯的错误）。

这就是我的经验。尝试两者，看看什么对你有用。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2010-08-03T09:14:06.537

最好的答案将是作者本人。他似乎再次回归 RoR！：

> 前言
> 
> 我以前的公司 (CD Baby) 是第一批大声切换到 Ruby on Rails 的公司之一，然后更大声地切换回 PHP（谷歌我了解这出戏）。Michael Hartl 的这本书受到强烈推荐，我不得不尝试一下，而 Ruby on Rails 教程是我用来***再次切换回 Rails 的***。

[http://railstutorial.org/book](http://railstutorial.org/book)

浏览他自己的网站，确实证明了他回归 RoR：

> 所有项目都将在 Rails 3 上标准化，而不是试图教给每个人我独特的 PHP 框架。

[http://thoughts.pro/](http://thoughts.pro/)

那些只是按照他的著名文章从 Rails 转到 PHP 的人，现在是时候再次回到 Rails 了！

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-07-01T20:25:40.297

我从 Derek Silvers 那里读到了那篇文章。这有点奇怪。他讲述了一个项目失控、拖了几个月，最终不得不放弃的故事。他将此归咎于 Rails 框架。然而，他从未说过 Rails 是什么导致了项目失败。如果他提供了一些可靠的信息，这篇文章会更加可信，但他甚至没有提到 Rails 让他失望的一个具体地方。他最接近的是说他们的“需求”（？）与 Rails 的偏好（哪些？如何？）

与此同时，全世界的人们（包括我自己）都在使用 Ruby on Rails 在合理的时间内实现复杂的 Web 应用程序。

鉴于在 Derek 的文章中缺乏细节，或者根本没有任何具体的技术信息，**很可能该项目由于与 Rails 无关的多种原因而失败。**

最初的问题是“我应该注意 Derek Silvers 关于从 PHP 迁移到 Rails 的警告吗？” 我的回答是否定的，他的“警告”相当于零支持证据的模糊轶事。忽略它们是完全安全的。

是否应该在 Rails 中重新实现 PHP 应用程序？那是另一个问题。对此没有一概而论的答案。这完全取决于情况。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-01T08:27:21.587

Luke Crawford[最近关于 Muxtape 的帖子](http://tlvx.net/post/74143734/the-technical-story-of-muxtape)提供了另一个视角。

> 作为一名 Web 开发人员，我在最初的 4 年中使用 PHP，这在当时很有趣，但是当我开始意识到它的效率有多么严重时，我开始寻找其他地方。我放弃了我传统的计算机科学背景，转向网络及其更大的设计可能性，但正因为如此，我知道有更好的方法。PHP 开发人员不应该像他们经常那样被嘲笑，因为坦率地说，它使没有更严格背景的人能够完成令人惊叹的技术性事情。这应该满足书呆子，但通常会变成某种弱的“大男子主义”的东西。无论如何，这种不满始于 2004 年底，而 Ruby on Rails 是全新的、稳定的，并且解决了我在使用旧的本土 PHP MVC 框架时遇到的所有限制。从那以后，我一直专门从事 Rails 工作。

无论如何，很难为“Rails 与 PHP 相比没有任何显着优势”的明确声明辩护。

PHP 是解决某些问题的好工具。Rails 是解决某些问题的好工具。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-01T11:14:31.670

作为一名活跃的 Rails 和 PHP 开发人员（经验可以追溯到 2000 年），我强烈不同意这种说法。

我认为 Ruby 比 PHP 提供了显着的优势，而且 Rails 是一个比 PHP 世界中任何东西都更好的框架。这在很大程度上与语言本身有关——Ruby 可以做 PHP 无法做到的事情。一旦你领略了元编程的优雅，一个全新的表现力水平就会向你敞开。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-02-01T11:33:00.540

**免责声明：**我绝不是 Ruby 或 Rails 专家。

作为一个从事该行业近 15 年的人，我看到了一些警告信号，特别是让我对 Ruby on Rails 感到紧张。我将在这里忽略语言，因为语言就是语言。Ruby 是一种具有闭包、异常、OO 等的现代语言。一些人批评它的性能。这些问题在很大程度上无关紧要，因为它们不会影响现实世界的性能（如果下载和显示网页需要 300 毫秒，谁在乎服务器端代码需要 10、20 甚至 30 毫秒来运行？）并且是暂时的，因为它们在以后的版本中已修复（Ruby 1.9 似乎就是这种情况）。

**Ruby on Rails 是一个封闭的重量级堆栈。** 我的意思是这是一种观察而不是指责。它与 Java 世界中的 JBoss Seam 紧密集成（包括与 Prototype 紧密集成）（与 JBoss/Hibernate 紧密集成，是的，我知道最近的版本和文章已经解决了与 Glassfish 和另一个 JPA 提供商一起使用它的问题）

这既可以是好事，也可以是坏事。例如，J2EE 作为一个相当开放的堆栈是过去十年软件行业大量创新的原因，因为它的几乎每一部分（尤其是 EJB）都被可以组合在一起的不同项目所取代。当然，如果不是 Spring 的诞生地，它肯定是孵化器。

另一方面，你有更多的封闭堆栈，如 .Net，它们的封闭性质允许快速创新，这是微软（通常）擅长的模型。在短短几年内，DirextX 从一个笑话变成了完全击败 OpenGL 作为游戏开发平台，因为任何封闭系统都可以比开放标准系统发展得快得多。这就是它的工作原理。

我要提到的另一个相关点是，近年来，Java、.Net 和其他地方已经朝着 ORM（“对象-关系映射”）的方向发展，这也是 Rails 背后推动力的一部分。我之前对此发表过评论，例如[“使用 ORM 还是纯 SQL？”](https://stackoverflow.com/questions/494816/using-an-orm-or-plain-sql/494853#494853) 我不会全部重申这些观点。

你们中的大多数人都知道，ORM 试图弥合的对象和关系世界之间存在不匹配。在过去的一两年里，我主要通过 Java（特别是 JPA）处理这个问题。

现在，当您在两个不匹配的事物之间架起桥梁时，您最终会遇到[“泄漏的抽象”](http://www.joelonsoftware.com/articles/LeakyAbstractions.html)（正如乔尔所说）：

> 在某种程度上，所有重要的抽象都是泄漏的。

现在我要补充的是：抽象的复杂性与抽象的泄漏程度之间存在反比关系。举个例子：[ibatis](http://ibatis.apache.org/)。Ibatis 是一个非常轻量级但功能强大的 Java 持久性框架，我非常喜欢它。它将 SQL 包装在外部文件中，并在此之上放置了许多现代 ORM 行为，例如：

*   关系的延迟加载；
*   结果映射；
*   将结果分组到多个级别（**JPA 不能做**的事情）；和
*   可区分类型（即类型被确定的数据）。

我估计 ibatis 具有 Hibernate 90-95% 的功能，唯一的复杂性开销是通过 cglib 进行延迟加载的运行时字节码增强（JPA 也是这样做的），唯一的缺点是您必须编写自己的查询（我不认为这是一个严重的缺点，但意见会有所不同）。

将其与依赖检测、加载时编织和非标准类加载器来实现额外 5-10% 功能的 JPA 提供程序进行比较（并且抽象仍然存在漏洞）。

因此，在减少泄漏方面存在收益递减规律。 **在某些时候，你最好投资一个舱底泵而不是修理船上的每一个泄漏点。**

把它带回 Rails：泄漏的抽象论点是我对 Rails 哲学的最大问题。

对我来说也敲响了警钟的是你在诸如[On Derek Siver's Return to PHP... 之](http://www.halostatue.ca/2007/09/23/on-derek-sivers-return-to-php%E2%80%A6/)类的帖子中得到的评论是：

*   “Derek 选择这项技术的原因是错误的。”：等等……RoR 不就是一个通用的 Web 应用程序框架，还是一个非常接近的复制品？既然如此，为什么不能在里面做一个像CDbaby这样的网站呢？
*   “Rails 不适合 Derek 的 CD Baby 应用模型”：怎么会这样？
*   “他忽略了他现有的新技术专家。”：等等……他不是请了专家吗？
*   “抱歉，Derek，你可能还在用代码弄脏你的手，但你仍然是管理人员”：我同意这句话“愚蠢”的评论，并补充说它具有误导性、无关紧要并且可以说是一个稻草人；
*   “Derek 通过 One Big Day 部署将项目作为一个整体环境从头重写”：可以说是不可取的，但如果你愿意花时间和金钱在上面，我不认为这是为什么你不能在 RoR 中做这个网站。

现在 5 到 7 年前，当 EJB 被炒作时，你会因为很多事情而受到批评，你会得到坚定的捍卫者的争论：

*   “应用程序 X 不适合 EJB 模型”；
*   “他们不了解 EJB 是如何工作的”；
*   “EJB 并不适用于所有应用程序”（他们宁愿在这一点上认输，也不愿面对更明显的问题，即它并不适合，更不用说一个好主意了，嗯，几乎任何事情）；
*   等等

所以那些反对 Ruby 的帖子（尤其是他们的反驳）对我来说听起来都很熟悉。

值得一提的是 Zed Shaw 一年前的咆哮[“Rails is a Ghetto”](http://www.zedshaw.com/rants/rails_is_a_ghetto.html)，这是针对 Rails 的 6000 多个单词的咆哮（“conflagration”可能是一个更好的词）。一些值得注意的引语：

> 这正是使 Rails 成为贫民区的原因。一群受过半训练的前 PHP 白痴，他们从不费心坐下来真正学习他们在大学里学得太好的计算机科学。

和

> 请注意我花了几秒钟才回复。这一句话基本上意味着我们都被骗了。DHH 创建的主要 Rails 应用程序需要每天重新启动 _400 次。那是一个生产应用程序，平均不能超过 4 分钟。

和（关于内存泄漏）：

> 这也是 Rails 成为贫民窟的另一个原因。像上面这样的重要补丁在很大程度上被日本开发者忽略了，虽然他们是非常好的人，但上面只是业余时间的味道。

和

> 整个事情最好的部分是可能有 10 个新的 Web 框架可以采用 Rails。见鬼，Mongrel 产生或帮助了其中的 5 个。这些框架中我最喜欢的是 Merb，它的字面意思是“Mongrel plus Erb”，但现在它主要使用 Erubis。我喜欢 Merb 的地方在于，它证明了您可以使用与 Rails 相同的想法并同时使用大多数 Rails 设备来制作一个快速线程安全的 Ruby Web 框架。然而，笑话是，在 Merb 之前，Rails Core 的白痴会大喊大叫，你不能让 Rails 线程安全。然而，Ezra 通过编写比 Rails 更好的 Rails 证明了他们都错了，这要归功于 Mongrel 如此容易破解和使用。

和：

> Ruby on Rails 已经充满了像 Koz 这样的人，而 Koz 是最资深的想要成为聪明人的人。Koz 充其量是幸运的，他将他糟糕的编码注入了一个好的项目，把它搞砸了，然后锁定安全性作为获得更多控制权的方式。当然，他实际上对安全编码一无所知，这就是为什么他的代码似乎有很多错误（去看看日期解析狗屎。线索：月份并不总是有 30 天）。

而且，它还在继续。

所以我想我可以这样总结：Rails[闻起来很糟糕](http://en.wikipedia.org/wiki/Code_smell)。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-02T05:16:08.850

Rails 是一个很好的框架，但有时迁移是个坏主意。我更喜欢从头开始，你不能将 PHP 代码“翻译”到 Rails 上下文中。它只是无法完成，主要是因为 Ruby 语言本身和 MVC 模式。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-02-02T13:03:37.003

我会在 Rails 中重写它，但如果你喜欢 PHP，那就选择 PHP。不要在意别人说什么，做适合自己的事。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-07-01T19:07:32.933

在商业中，时间就是金钱——有时你必须走阻力最小的道路。没有环境、语言、框架等是完美的。学习和使用你想要的东西，并让它继续前进！！！！

# javascript - JavaScript 中变量的作用域是什么？

> ID：500431
> 
> 赞同：2138
> 
> 时间：2009-02-01T08:27:19.853
> 
> 标签：javascript, function, variables, scope, var

javascript中变量的范围是什么？它们在函数内部和外部具有相同的范围吗？或者它甚至重要吗？另外，如果变量是全局定义的，它们存储在哪里？

* * *

## 回答 #1

> 赞同：2642
> 
> 时间：2009-02-01T08:58:50.697

## TLDR

JavaScript 具有词法（也称为静态）作用域和闭包。这意味着您可以通过查看源代码来判断标识符的范围。

四个范围是：

1.  全球 - 一切可见
2.  功能 - 在功能（及其子功能和块）中可见
3.  块 - 在块（及其子块）中可见
4.  模块 - 在模块内可见

`var`在全局和模块范围的特殊情况之外，使用（函数范围）、`let`（块范围）和（块范围）声明变量`const`。大多数其他形式的标识符声明在严格模式下具有块范围。

## 概述

范围是标识符有效的代码库区域。

词法环境是标识符名称和与之关联的值之间的映射。

作用域由词汇环境的链接嵌套构成，嵌套中的每一级对应于祖先执行上下文的词汇环境。

这些链接的词法环境形成了一个作用域“链”。标识符解析是沿着该链搜索匹配标识符的过程。

标识符解析只发生在一个方向：向外。这样，外部词汇环境就无法“看到”内部词汇环境。

决定JavaScript中[标识符](https://www.ecma-international.org/ecma-262/10.0/index.html#sec-names-and-keywords)[范围](https://en.wikipedia.org/wiki/Scope_(computer_science))的三个相关因素：

1.  如何声明标识符
2.  声明标识符的位置
3.  无论您是处于[严格模式](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode)还是[非严格模式](https://developer.mozilla.org/en-US/docs/Glossary/Sloppy_mode)

可以声明标识符的一些方法：

1.  `var`,`let`和`const`
2.  功能参数
3.  捕获块参数
4.  函数声明
5.  命名函数表达式
6.  `var`全局对象上隐式定义的属性（即，在非严格模式下丢失）
7.  `import`陈述
8.  `eval`

可以声明一些位置标识符：

1.  全球背景
2.  函数体
3.  普通块
4.  控制结构的顶部（例如，循环、if、while 等）
5.  控制结构体
6.  模块

## 声明样式

### 变量

使用声明的标识符`var` **具有函数范围**，除了它们直接在全局上下文中声明时，在这种情况下，它们作为属性添加到全局对象上并具有全局范围。`eval`它们在函数中的使用有单独的规则。

### 让和常量

`let`使用和声明的标识符`const` **具有块作用域**，除非它们直接在全局上下文中声明，在这种情况下它们具有全局作用域。

注：`let`,`const`和`var` [都是吊装的](https://stackoverflow.com/a/31222689/38522)。这意味着它们的逻辑定义位置是它们封闭范围（块或函数）的顶部。但是，在控制通过源代码中的声明点之前`let`，`const`无法读取或分配使用声明的变量。过渡时期被称为时间死区。

```
function f() {
    function g() {
        console.log(x)
    }
    let x = 1
    g()
}
f() // 1 because x is hoisted even though declared with `let`!
```

### 函数参数名称

函数参数名称的范围是函数体。请注意，这有点复杂。声明为默认参数的函数靠近[参数列表](https://stackoverflow.com/questions/61208843/where-are-arguments-positioned-in-the-lexical-environment/)，而不是函数体。

### 函数声明

函数声明在严格模式下具有块作用域，在非严格模式下具有函数作用域。注意：非严格模式是基于不同浏览器古怪的历史实现的一组复杂的紧急规则。

### 命名函数表达式

命名函数表达式的范围仅限于自身（例如，出于递归的目的）。

### 全局对象上隐式定义的属性

在非严格模式下，全局对象上隐式定义的属性具有全局范围，因为全局对象位于范围链的顶部。在严格模式下，这些是不允许的。

### 评估

在`eval`字符串中，使用声明的变量`var`将被放置在当前范围内，或者，如果`eval`间接使用，则作为全局对象的属性。

## 例子

以下将引发 ReferenceError，因为名称`x`、、`y`和`z`在函数之外没有任何意义`f`。

```
function f() {
    var x = 1
    let y = 1
    const z = 1
}
console.log(typeof x) // undefined (because var has function scope!)
console.log(typeof y) // undefined (because the body of the function is a block)
console.log(typeof z) // undefined (because the body of the function is a block)
```

以下将为`y`and引发 ReferenceError `z`，但不会为`x`，因为 的可见性`x`不受块的约束。定义控制结构体（如`if`、`for`和）的块的`while`行为类似。

```
{
    var x = 1
    let y = 1
    const z = 1
}
console.log(x) // 1
console.log(typeof y) // undefined because `y` has block scope
console.log(typeof z) // undefined because `z` has block scope
```

在下面，由于具有函数范围`x`，因此在循环外部可见：`var`

```
for(var x = 0; x < 5; ++x) {}
console.log(x) // 5 (note this is outside the loop!)
```

...由于这种行为，您需要小心关闭`var`在循环中使用声明的变量。这里只`x`声明了一个变量实例，它在逻辑上位于循环之外。

以下打印`5`五次，然后为循环外打印`5`第六次：`console.log`

```
for(var x = 0; x < 5; ++x) {
    setTimeout(() => console.log(x)) // closes over the `x` which is logically positioned at the top of the enclosing scope, above the loop
}
console.log(x) // note: visible outside the loop
```

以下打印`undefined`因为`x`是块范围的。回调是异步运行的。变量的新行为`let`意味着每个匿名函数都关闭了一个名为的不同变量`x`（不像它会用 完成`var`），因此整数`0`通过`4`被打印。：

```
for(let x = 0; x < 5; ++x) {
    setTimeout(() => console.log(x)) // `let` declarations are re-declared on a per-iteration basis, so the closures capture different variables
}
console.log(typeof x) // undefined
```

以下不会抛出 a`ReferenceError`因为可见性`x`不受块的限制；但是，它会打印，`undefined`因为变量尚未初始化（因为`if`语句）。

```
if(false) {
    var x = 1
}
console.log(x) // here, `x` has been declared, but not initialised
```

在循环顶部声明的变量`for`using`let`的作用域为循环体：

```
for(let x = 0; x < 10; ++x) {} 
console.log(typeof x) // undefined, because `x` is block-scoped
```

以下将抛出 a`ReferenceError`因为 的可见性`x`受到块的限制：

```
if(false) {
    let x = 1
}
console.log(typeof x) // undefined, because `x` is block-scoped
```

`var`使用或声明`let`的变量`const`都作用于模块：

```
// module1.js

var x = 0
export function f() {}

//module2.js

import f from 'module1.js'

console.log(x) // throws ReferenceError 
```

以下将在全局对象上声明一个属性，因为`var`在全局上下文中使用声明的变量将作为属性添加到全局对象：

```
var x = 1
console.log(window.hasOwnProperty('x')) // true
```

`let`并且`const`在全局上下文中不要向全局对象添加属性，但仍然具有全局范围：

```
let x = 1
console.log(window.hasOwnProperty('x')) // false
```

函数参数可以认为是在函数体中声明的：

```
function f(x) {}
console.log(typeof x) // undefined, because `x` is scoped to the function
```

捕获块参数的范围为捕获块主体：

```
try {} catch(e) {}
console.log(typeof e) // undefined, because `e` is scoped to the catch block
```

命名函数表达式的范围仅限于表达式本身：

```
(function foo() { console.log(foo) })()
console.log(typeof foo) // undefined, because `foo` is scoped to its own expression
```

在非严格模式下，全局对象上隐式定义的属性是全局范围的。在严格模式下，您会收到错误消息。

```
x = 1 // implicitly defined property on the global object (no "var"!)

console.log(x) // 1
console.log(window.hasOwnProperty('x')) // true
```

在非严格模式下，函数声明具有函数范围。在严格模式下，它们具有块范围。

```
'use strict'
{
    function foo() {}
}
console.log(typeof foo) // undefined, because `foo` is block-scoped
```

## 它是如何在引擎盖下工作的

范围定义为标识符有效的代码[词汇区域。](https://stackoverflow.com/a/1047479/38522)

在 JavaScript 中，每个函数对象都有一个隐藏`[[Environment]]`的引用，它是对创建它的[执行上下文](https://www.ecma-international.org/ecma-262/10.0/index.html#sec-execution-contexts)（堆栈帧）的[词法环境的引用。](https://www.ecma-international.org/ecma-262/10.0/index.html#sec-lexical-environments)

当你调用一个函数时，隐藏的`[[Call]]`方法会被调用。该方法创建一个新的执行上下文，并在新的执行上下文和函数对象的词法环境之间建立链接。它通过将`[[Environment]]`函数对象上的值复制到新执行上下文的词法环境的[外部引用字段中来做到这一点。](https://www.ecma-international.org/ecma-262/10.0/index.html#sec-lexical-environments)

请注意，新的执行上下文和函数对象的词法环境之间的这种链接称为[闭包](https://stackoverflow.com/a/111114/38522)。

因此，在 JavaScript 中，作用域是通过外部引用以“链”链接在一起的词法环境来实现的。这个词法环境链称为作用域链，标识符解析是通过[在链上搜索](https://www.ecma-international.org/ecma-262/10.0/index.html#sec-getidentifierreference)匹配标识符来实现的。

了解[更多](https://github.com/getify/You-Dont-Know-JS/tree/2nd-ed/scope-closures)。

* * *

## 回答 #2

> 赞同：239
> 
> 时间：2009-02-01T08:35:34.377

Javascript 使用范围链来建立给定函数的范围。通常有一个全局范围，并且定义的每个函数都有自己的嵌套范围。在另一个函数中定义的任何函数都具有链接到外部函数的局部范围。定义范围的始终是源中的位置。

作用域链中的元素基本上是一个带有指向其父作用域的指针的 Map。

解析变量时，javascript 从最里面的范围开始向外搜索。

* * *

## 回答 #3

> 赞同：113
> 
> 时间：2009-02-01T08:31:34.043

全局声明的变量具有全局范围。在函数中声明的变量的作用域是该函数，并隐藏同名的全局变量。

（我敢肯定，真正的 JavaScript 程序员可以在其他答案中指出许多微妙之处。特别是我在任何时候都看到了[这个页面](http://www.digital-web.com/articles/scope_in_javascript/)，了解它的确切`this`含义。希望[这个更具介绍性的链接](http://bowles.byethost3.com/javascript/section6/lesson6.htm#part4)足以让你开始.)

* * *

## 回答 #4

> 赞同：78
> 
> 时间：2016-02-23T18:51:35.430

# 老派 JavaScript

传统上，JavaScript 实际上只有两种类型的作用域：

1.  **全局范围**：变量在整个应用程序中都是已知的，从应用程序开始*(*)*
2.  **功能范围：变量在声明它们**[**的函数**](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Statements/function)中是已知的，从函数的开头*（*）*

我不会详细说明这一点，因为已经有许多其他答案可以解释差异。

* * *

# 现代 JavaScript

[**最新**](https://www.smashingmagazine.com/2015/10/es6-whats-new-next-version-javascript/)的JavaScript 规范现在也允许第三个作用域：

3.  **块作用域：标识符**[在声明它们的作用域的顶部](https://stackoverflow.com/a/31222689/38522)是“已知的” ，但在声明行之后才能分配或取消引用（读取）。这个过渡时期被称为“时间死区”。

* * *

### 如何创建块范围变量？

传统上，您可以像这样创建变量：

```
var myVariable = "Some text"; 
```

块范围变量是这样创建的：

```
let myVariable = "Some text"; 
```

* * *

### 那么函数作用域和块作用域有什么区别呢？

要了解功能范围和块范围之间的区别，请考虑以下代码：

```
// i IS NOT known here
// j IS NOT known here
// k IS known here, but undefined
// l IS NOT known here

function loop(arr) {
    // i IS known here, but undefined
    // j IS NOT known here
    // k IS known here, but has a value only the second time loop is called
    // l IS NOT known here

    for( var i = 0; i < arr.length; i++ ) {
        // i IS known here, and has a value
        // j IS NOT known here
        // k IS known here, but has a value only the second time loop is called
        // l IS NOT known here
    };

    // i IS known here, and has a value
    // j IS NOT known here
    // k IS known here, but has a value only the second time loop is called
    // l IS NOT known here

    for( let j = 0; j < arr.length; j++ ) {
        // i IS known here, and has a value
        // j IS known here, and has a value
        // k IS known here, but has a value only the second time loop is called
        // l IS NOT known here
    };

    // i IS known here, and has a value
    // j IS NOT known here
    // k IS known here, but has a value only the second time loop is called
    // l IS NOT known here
}

loop([1,2,3,4]);

for( var k = 0; k < arr.length; k++ ) {
    // i IS NOT known here
    // j IS NOT known here
    // k IS known here, and has a value
    // l IS NOT known here
};

for( let l = 0; l < arr.length; l++ ) {
    // i IS NOT known here
    // j IS NOT known here
    // k IS known here, and has a value
    // l IS known here, and has a value
};

loop([1,2,3,4]);

// i IS NOT known here
// j IS NOT known here
// k IS known here, and has a value
// l IS NOT known here 
```

在这里，我们可以看到我们的变量`j`只在第一个 for 循环中是已知的，而不是在之前和之后。然而，我们的变量`i`在整个函数中都是已知的。

另外，考虑到块范围的变量在声明之前是未知的，因为它们没有被提升。您也不允许在同一个块内重新声明同一个块范围的变量。这使得块范围的变量比全局或功能范围的变量更不容易出错，全局或功能范围的变量被提升并且在多个声明的情况下不会产生任何错误。

* * *

### 今天使用块范围变量是否安全？

今天使用是否安全，取决于您的环境：

*   如果您正在编写服务器端 JavaScript 代码 ( [**Node.js**](https://nodejs.org/en/) )，则可以安全地使用该`let`语句。

*   如果您正在编写客户端 JavaScript 代码并使用基于浏览器的转译器（如[**Traceur**](https://github.com/google/traceur-compiler)或[**babel-standalone**](https://github.com/babel/babel-standalone)），您可以安全地使用该`let`语句，但是您的代码可能在性能方面并非最佳。

*   如果您正在编写客户端 JavaScript 代码并使用基于节点的转译器（如[**traceur shell 脚本**](https://github.com/google/traceur-compiler/wiki/Compiling-Offline)或[**Babel**](https://babeljs.io/)），则可以安全地使用该`let`语句。而且因为您的浏览器只会知道转译的代码，所以性能缺陷应该是有限的。

*   如果您正在编写客户端 JavaScript 代码并且不使用转译器，则需要考虑浏览器支持。

    这些是一些根本不支持`let`的浏览器：

    *   **Internet Explorer 10**及以下版本
    *   **火狐 43**及以下
    *   **Safari 9**及以下
    *   **安卓浏览器4**及以下
    *   **Opera 27**及以下
    *   **丁目40**以下
    *   任何版本的**Opera Mini**和**黑莓浏览器**

[![在此处输入图像描述](https://i.stack.imgur.com/J9kEC.png)](https://i.stack.imgur.com/J9kEC.png)

* * *

### 如何跟踪浏览器支持

`let`有关在您阅读此答案时哪些浏览器支持该声明的最新概述，请参阅[**此`Can I Use`页面**](http://caniuse.com/#search=let)。

* * *

*(*) 全局和功能范围的变量可以在声明之前初始化和使用，因为 JavaScript 变量是被[**提升**](https://developer.mozilla.org/en-US/docs/Glossary/Hoisting)的。*这意味着声明总是在范围的顶部。

* * *

## 回答 #5

> 赞同：41
> 
> 时间：2009-02-01T08:48:09.000

这是一个例子：

```
<script>

var globalVariable = 7; //==window.globalVariable

function aGlobal( param ) { //==window.aGlobal(); 
                            //param is only accessible in this function
  var scopedToFunction = {
    //can't be accessed outside of this function

    nested : 3 //accessible by: scopedToFunction.nested
  };

  anotherGlobal = {
    //global because there's no `var`
  }; 

}

</script> 
```

您需要研究闭包，以及如何使用它们来创建[私有成员](http://www.crockford.com/javascript/private.html)。

* * *

## 回答 #6

> 赞同：32
> 
> 时间：2012-05-15T17:38:30.993

据我了解，关键是 Javascript 具有函数级别的范围，而不是更常见的 C 块范围。

[这是一篇关于这个主题的好文章。](http://www.adequatelygood.com/2010/2/JavaScript-Scoping-and-Hoisting)

* * *

## 回答 #7

> 赞同：27
> 
> 时间：2010-04-06T11:19:39.933

[`let`在“Javascript 1.7”（Mozilla 对 Javascript 的扩展）中，还可以使用语句](https://developer.mozilla.org/en/New_in_JavaScript_1.7#section_11)声明块范围变量：

```
 var a = 4;
 let (a = 3) {
   alert(a); // 3
 }
 alert(a);   // 4 
```

* * *

## 回答 #8

> 赞同：26
> 
> 时间：2015-09-14T20:29:53.340

最初由[Brendan Eich](https://en.wikipedia.org/wiki/Brendan_Eich)设计的 JavaScript 范围的想法来自[HyperCard](https://en.wikipedia.org/wiki/HyperCard)脚本语言[HyperTalk](https://en.wikipedia.org/wiki/HyperTalk)。

在这种语言中，显示的方式类似于一叠索引卡。有一张被称为背景的主卡。它是透明的，可以看作是底牌。此基础卡上的任何内容都与放置在其上的卡共享。放在最上面的每张卡片都有自己的内容，优先于前一张卡片，但如果需要，仍然可以访问之前的卡片。

这正是 JavaScript 范围系统的设计方式。它只是有不同的名称。JavaScript 中的卡片称为**[Execution Contexts ^(ECMA)](http://www.ecma-international.org/ecma-262/5.1/#sec-10.3)**。这些上下文中的每一个都包含三个主要部分。一个变量环境、一个词法环境和一个 this 绑定。回到卡片参考，词法环境包含堆栈中较低的先前卡片的所有内容。当前上下文位于堆栈的顶部，在那里声明的任何内容都将存储在变量环境中。在命名冲突的情况下，变量环境将优先。

this 绑定将指向包含对象。有时，作用域或执行上下文会发生变化，而包含对象不会发生变化，例如在包含对象可能是的声明函数`window`或构造函数中。

这些执行上下文是在控制权转移的任何时候创建的。当代码开始执行时，控制权就会转移，这主要是通过函数执行来完成的。

这就是技术解释。在实践中，重要的是要记住在 JavaScript 中

*   范围在技术上是“执行上下文”
*   上下文形成了存储变量的环境堆栈
*   堆栈顶部优先（底部是全局上下文）
*   每个函数都会创建一个执行上下文（但并不总是一个新的 this 绑定）

将此应用于此页面上的先前示例之一（5.“闭包”），可以跟踪执行上下文的堆栈。在此示例中，堆栈中有三个上下文。它们由外部上下文、由 var 6 调用的立即调用函数中的上下文以及 var 6 立即调用的函数内部的返回函数中的上下文定义。

*i* ) 外部环境。它有一个 a = 1 的变量环境
*ii* ) IIFE 上下文，它有一个 a = 1 的词法环境，但是在堆栈中优先的 a = 6 的变量环境
*iii* ) 返回的函数上下文，它有一个词法环境a = 6 的环境，这是调用时警报中引用的值。

[![在此处输入图像描述](https://i.stack.imgur.com/v45hL.png)](https://i.stack.imgur.com/v45hL.png)

* * *

## 回答 #9

> 赞同：18
> 
> 时间：2013-10-25T00:41:17.347

1) 有一个全局作用域、一个函数作用域以及 with 和 catch 作用域。变量通常没有“块”级别的范围——with 和 catch 语句将名称添加到它们的块中。

2) 范围由函数一直嵌套到全局范围。

3) 通过原型链解析属性。with 语句将对象属性名称带入 with 块定义的词法范围。

编辑：ECMAAScript 6 (Harmony) 被指定支持 let，我知道 chrome 允许使用“harmony”标志，所以也许它确实支持它..

Let 将支持块级范围，但您必须使用关键字才能实现。

编辑：根据本杰明在评论中指出 with 和 catch 语句，我编辑了帖子，并添加了更多内容。with 和 catch 语句都将变量引入各自的块中，这*就是*块作用域。这些变量是传递给它们的对象的属性的别名。

```
 //chrome (v8)

 var a = { 'test1':'test1val' }
 test1   // error not defined
 with (a) { var test1 = 'replaced' }
 test1   // undefined
 a       // a.test1 = 'replaced' 
```

编辑：澄清示例：

test1 的作用域是 with 块，但别名为 a.test1。'Var test1' 在上层词汇上下文（函数或全局）中创建一个新变量 test1，除非它是 a 的属性 -- 它是。

哎呀！小心使用 'with' - 就像 var 是一个 noop 如果变量已经在函数中定义，它也是一个 noop 相对于从对象导入的名称！对已经定义的名称稍加注意会使这更安全。因此，我个人永远不会使用 with。

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2013-03-21T17:31:11.980

我发现许多 JavaScript 新手很难理解在语言中默认情况下继承是可用的，并且到目前为止，函数作用域是唯一的作用域。我为去年年底编写的美化器 JSPretty 提供了一个扩展。代码中的功能颜色函数作用域并始终将颜色与该作用域中声明的所有变量相关联。当具有来自一个范围的颜色的变量在不同的范围中使用时，可以直观地演示闭包。

在以下位置尝试该功能：

*   [http://prettydiff.com/jspretty.xhtml?c=white&jsscope](http://prettydiff.com/jspretty.xhtml?c=white&jsscope)

在以下位置查看演示：

*   [http://prettydiff.com/jspretty.xhtml?c=white&jsscope&s=http://prettydiff.com/lib/markup_beauty.js](http://prettydiff.com/jspretty.xhtml?c=white&jsscope&s=http://prettydiff.com/lib/markup_beauty.js)

查看代码：

*   [http://prettydiff.com/lib/jspretty.js](http://prettydiff.com/lib/jspretty.js)
*   [https://github.com/austincheney/Pretty-Diff/blob/master/lib/jspretty.js](https://github.com/austincheney/Pretty-Diff/blob/master/lib/jspretty.js)

目前该功能支持深度为 16 个嵌套函数，但目前不为全局变量着色。

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2014-06-24T14:12:58.903

## 全球范围：

全局变量就像全局明星（成龙，纳尔逊曼德拉）。您可以从应用程序的任何部分访问它们（获取或设置值）。全局函数就像全局事件（新年、圣诞节）。您可以从应用程序的任何部分执行（调用）它们。

```
//global variable
var a = 2;

//global function
function b(){
   console.log(a);  //access global variable
} 
```

## 本地范围：

如果你在美国，你可能认识臭名昭著的名人金·卡戴珊（她以某种方式设法制作了小报）。但是美国以外的人不会认出她。她是当地的明星，与她的地盘息息​​相关。

局部变量就像局部星星。您只能在范围内访问它们（获取或设置值）。本地函数就像本地事件 - 您只能在该范围内执行（庆祝）。如果你想从范围之外访问它们，你会得到一个参考错误

```
function b(){
   var d = 21; //local variable
   console.log(d);

   function dog(){  console.log(a); }
     dog(); //execute local function
}

 console.log(d); //ReferenceError: dddddd is not defined 
```

* * *

[查看本文以深入了解范围](http://www.thatjsdude.com/jsConcepts/concepts/scope.html)

* * *

## 回答 #12

> 赞同：9
> 
> 时间：2014-09-21T20:44:10.110

JavaScript 只有两种类型的范围：

1.  **全局范围**：全局只是一个窗口级别的范围。在这里，变量存在于整个应用程序中。
2.  **功能范围**：在带有`var`关键字的函数中声明的变量具有功能范围。

*每当调用函数时，都会创建一个变量范围对象（并包含在范围链中），然后是 JavaScript 中的变量。*

```
 a = "global";
         function outer(){ 
              b = "local";
              console.log(a+b); //"globallocal"
         }
outer(); 
```

范围链 -->

1.  窗口级别 -`a`和`outer`功能位于范围链的顶层。
2.  当外部函数调用一个新的`variable scope object`（并包含在范围链中）时，`b`在其中添加了变量。

现在，当一个变量`a`需要时，它首先搜索最近的变量范围，如果变量不存在，那么它会移动到变量范围链的下一个对象。在这种情况下是窗口级别。

* * *

## 回答 #13

> 赞同：9
> 
> 时间：2014-10-18T09:54:56.430

运行代码。希望这将提供有关范围界定的想法

```
Name = 'global data';
document.Name = 'current document data';
(function(window,document){
var Name = 'local data';
var myObj = {
    Name: 'object data',
    f: function(){
        alert(this.Name);
    }
};

myObj.newFun = function(){
    alert(this.Name);
}

function testFun(){
    alert("Window Scope : " + window.Name + 
          "\nLocal Scope : " + Name + 
          "\nObject Scope : " + this.Name + 
          "\nCurrent document Scope : " + document.Name
         );
}

testFun.call(myObj);
})(window,document); 
```

* * *

## 回答 #14

> 赞同：9
> 
> 时间：2016-03-30T13:33:04.090

只是为了添加其他答案，范围是所有声明的标识符（变量）的查找列表，并强制执行一组严格的规则来说明当前执行的代码如何访问这些。这种查找可能是为了分配给变量，这是一个 LHS（左侧）引用，或者它可能是为了检索它的值，这是一个 RHS（右侧）引用。这些查找是 JavaScript 引擎在编译和执行代码时在内部执行的操作。

所以从这个角度来看，我认为我在 Kyle Simpson 的 Scopes and Closures 电子书中找到的一张图片会有所帮助：

[![图片](https://i.stack.imgur.com/0kqpZ.png)](https://i.stack.imgur.com/0kqpZ.png)

引用他的电子书：

> 该建筑物代表我们程序的嵌套范围规则集。大楼的一楼代表您当前执行的范围，无论您身在何处。建筑物的顶层是全局范围。您通过查看当前楼层来解析 LHS 和 RHS 引用，如果没有找到，乘电梯到下一层，查看那里，然后查看下一层，依此类推。一旦你到达顶层（全局范围），你要么找到你要找的东西，要么找不到。但无论如何你都必须停下来。

值得一提的是，“范围查找一旦找到第一个匹配项就会停止”。

这个“范围级别”的想法解释了为什么“this”可以用一个新创建的范围来改变，如果它在一个嵌套函数中被查找。这是一个包含所有这些细节的链接，[你想知道的关于 javascript 范围的一切](https://toddmotto.com/everything-you-wanted-to-know-about-javascript-scope/)

* * *

## 回答 #15

> 赞同：8
> 
> 时间：2019-12-31T02:50:45.017

## 内联处理程序

前端编码人员经常遇到的一个尚未描述的非常常见的问题是 HTML 中的内联事件处理程序可见的范围 - 例如，使用

```
<button onclick="foo()"></button> 
```

`on*`属性可以引用的变量范围*必须*是：

*   全局（工作内联处理程序几乎总是引用全局变量）
*   文档的属性（例如，`querySelector`作为独立变量将指向`document.querySelector`; 罕见）
*   处理程序附加到的元素的属性（如上；罕见）

否则，您将在调用处理程序时收到 ReferenceError。因此，例如，如果内联处理程序引用了定义*在* `window.onload`or内部的函数，`$(function() {`则引用将失败，因为内联处理程序可能只引用全局范围内的变量，而该函数不是全局的：

```
window.addEventListener('DOMContentLoaded', () => {
  function foo() {
    console.log('foo running');
  }
});
```

```
<button onclick="foo()">click</button>
```

处理程序附加到的元素的属性`document`和属性也可以作为内联处理程序内的独立变量引用，因为内联处理程序是在两个块内调用[*的*，`with`一个](https://i.stack.imgur.com/dTDB0.png)用于`document`，一个用于元素。这些处理程序内的变量范围链[非常不直观](https://stackoverflow.com/a/57048067)，并且工作的事件处理程序*可能*需要一个全局函数（并且[可能应该避免](https://softwareengineering.stackexchange.com/q/148108)不必要的全局污染）。

由于内联处理程序内部的作用域链*非常奇怪*，而且内联处理程序需要全局污染才能工作，而且内联处理程序有时需要在传递参数时进行丑陋的字符串转义，因此避免它们可能更容易。`addEventListener`相反，使用 Javascript（如 with ）而不是 HTML 标记来附加事件处理程序。

```
function foo() {
  console.log('foo running');
}
document.querySelector('.my-button').addEventListener('click', foo);
```

```
<button class="my-button">click</button>
```

## 模块 ( `<script type="module">`)

`<script>`另一方面，与在顶层运行的普通标签不同，ES6 模块内的代码在其自己的私有范围内运行。在普通标签顶部定义的`<script>`变量是全局的，因此您可以在其他`<script>`标签中引用它，如下所示：

```
<script>
const foo = 'foo';
</script>
<script>
console.log(foo);
</script>
```

但是 ES6 模块的顶层*不是*全局的。在 ES6 模块顶部声明的变量将仅在该模块内可见，除非该变量被显式`export`编辑，或者除非它被分配给全局对象的属性。

```
<script type="module">
const foo = 'foo';
</script>
<script>
// Can't access foo here, because the other script is a module
console.log(typeof foo);
</script>
```

ES6 模块的顶层类似于普通`<script>`. 模块可以引用任何全局变量，并且除非模块是为它明确设计的，否则没有任何东西可以引用模块内部的任何东西。

* * *

## 回答 #16

> 赞同：7
> 
> 时间：2015-10-29T16:12:19.993

JavaScript 作用域几乎只有两种类型：

*   每个 var 声明的范围都与最直接的封闭函数相关联
*   如果 var 声明没有封闭函数，则它是全局范围

因此，除函数之外的任何块都不会创建新范围。这就解释了为什么 for 循环会覆盖外部作用域变量：

```
var i = 10, v = 10;
for (var i = 0; i < 5; i++) { var v = 5; }
console.log(i, v);
// output 5 5 
```

改用函数：

```
var i = 10, v = 10;
$.each([0, 1, 2, 3, 4], function(i) { var v = 5; });
console.log(i,v);
// output 10 10 
```

在第一个示例中，没有块作用域，因此最初声明的变量被覆盖。在第二个示例中，由于该函数存在一个新范围，因此最初声明的变量是 SHADOWED 的，而不是被覆盖。

就 JavaScript 作用域而言，这几乎是您需要了解的全部内容，除了：

*   try/catch 只为异常变量本身引入新作用域，其他变量没有新作用域
*   with-clause 显然是另一个例外，但非常不鼓励使用 with-clause ( [https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/with](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/with) )

所以你可以看到 JavaScript 作用域实际上非常简单，尽管并不总是直观的。需要注意的几点：

*   var 声明被提升到范围的顶部。这意味着无论 var 声明发生在哪里，对于编译器来说，就好像 var 本身发生在顶部
*   合并同一范围内的多个 var 声明

所以这段代码：

```
var i = 1;
function abc() {
  i = 2;
  var i = 3;
}
console.log(i);     // outputs 1 
```

相当于：

```
var i = 1;
function abc() {
  var i;     // var declaration moved to the top of the scope
  i = 2;
  i = 3;     // the assignment stays where it is
}
console.log(i); 
```

这似乎违反直觉，但从命令式语言设计者的角度来看是有道理的。

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2017-09-26T20:23:11.060

# 现代 Js, ES6+, ' `const`' 和 ' `let`'

您应该对创建的每个变量使用块范围，就像大多数其他主要语言一样。`var`已*过时*。这使您的代码更安全、更易于维护。

`const`应该用于**95% 的情况**。它使变量*引用*不能改变。数组、对象和 DOM 节点属性可以更改并且应该是`const`.

`let`应该用于期望被重新分配的任何变量。这包括在 for 循环中。如果您在初始化之外更改值，请使用`let`.

块作用域意味着该变量仅在声明它的括号内可用。这扩展到内部范围，包括在您的范围内创建的匿名函数。

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2013-08-10T17:37:14.180

试试这个奇怪的例子。在下面的示例中，如果 a 是一个初始化为 0 的数字，您会看到 0，然后是 1。除了 a 是一个对象，javascript 将传递 f1 一个 a 的指针而不是它的副本。结果是您两次都收到相同的警报。

```
var a = new Date();
function f1(b)
{
    b.setDate(b.getDate()+1);
    alert(b.getDate());
}
f1(a);
alert(a.getDate()); 
```

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2015-07-11T18:03:27.287

JS 中只有函数作用域。不阻止范围！你也可以看到什么在提升。

```
var global_variable = "global_variable";
var hoisting_variable = "global_hoist";

// Global variables printed
console.log("global_scope: - global_variable: " + global_variable);
console.log("global_scope: - hoisting_variable: " + hoisting_variable);

if (true) {
    // The variable block will be global, on true condition.
    var block = "block";
}
console.log("global_scope: - block: " + block);

function local_function() {
    var local_variable = "local_variable";
    console.log("local_scope: - local_variable: " + local_variable);
    console.log("local_scope: - global_variable: " + global_variable);
    console.log("local_scope: - block: " + block);
    // The hoisting_variable is undefined at the moment.
    console.log("local_scope: - hoisting_variable: " + hoisting_variable);

    var hoisting_variable = "local_hoist";
    // The hoisting_variable is now set as a local one.
    console.log("local_scope: - hoisting_variable: " + hoisting_variable);
}

local_function();

// No variable in a separate function is visible into the global scope.
console.log("global_scope: - local_variable: " + local_variable); 
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2017-09-16T22:35:07.850

我的理解是有3个作用域：全局作用域，全局可用；本地范围，可用于整个函数，而不管块；和块作用域，仅对使用它的块、语句或表达式可用。全局和局部范围用关键字“var”表示，无论是在函数内部还是外部，块范围用关键字“let”表示。

对于那些认为只有全局作用域和局部作用域的人，请解释为什么 Mozilla 会有一个完整的页面来描述 JS 中块作用域的细微差别。

[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/let](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/let)

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2017-11-01T09:16:18.733

在 JavaScript 中有两种类型的作用域：

*   本地范围
*   全球范围

下面的函数有一个局部范围变量`carName`。并且这个变量不能从函数外部访问。

```
function myFunction() {
    var carName = "Volvo";
    alert(carName);
    // code here can use carName
} 
```

下面的类有一个全局范围变量`carName`。这个变量可以从类中的任何地方访问。

```
class {

    var carName = " Volvo";

    // code here can use carName

    function myFunction() {
        alert(carName);
        // code here can use carName 
    }
} 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2018-09-30T09:23:31.143

## `ES5`和更早：

Javascript 中的变量最初（pre `ES6`）是词法函数范围的。词法范围一词意味着您可以通过“查看”代码来查看变量的范围。

`var`用关键字声明的每个变量都作用于函数。但是，如果在该函数中声明了其他函数，则这些函数将可以访问外部函数的变量。这称为**作用域链**。它以下列方式工作：

1.  当一个函数想要解析一个变量值时，它首先查看它自己的范围。这是函数体，即大括号 {} 之间的所有内容（此范围内的**其他** **函数内的变量除外）。**
2.  如果它在函数体内找不到变量，**它将爬上链**并查看**函数中定义**函数的变量范围。这就是词法作用域的含义，我们可以在代码中看到该函数被定义的位置，因此只需查看代码就可以确定作用域链。

## 例子：

```
// global scope
var foo = 'global';
var bar = 'global';
var foobar = 'global';

function outerFunc () {
 // outerFunc scope
 var foo = 'outerFunc';
 var foobar = 'outerFunc';
 innerFunc();

 function innerFunc(){
 // innerFunc scope
  var foo = 'innerFunc';
  console.log(foo);
  console.log(bar);
  console.log(foobar);
  }
}

outerFunc();
```

当我们尝试将变量`foo`、`bar`和记录`foobar`到控制台时会发生以下情况：

1.  我们尝试将 foo 记录到控制台，可以在函数`innerFunc`本身内部找到 foo。因此， foo 的值被解析为 string `innerFunc`。
2.  `innerFunc`我们尝试将 bar 记录到控制台，在函数本身内部找不到 bar 。因此，我们需要**爬上作用域链**。我们首先查看定义函数的外部函数`innerFunc`。这就是功能`outerFunc`。在范围内，`outerFunc`我们可以找到变量 bar，其中包含字符串“outerFunc”。
3.  在 innerFunc 中找不到 foobar。. 因此，我们需要**将作用域链爬升**到 innerFunc 作用域。在这里也找不到，我们再爬一层到**全局作用域**（即最外层作用域）。我们在这里找到了变量 foobar，它保存了字符串 'global'。如果在爬升作用域链后它没有找到变量，JS 引擎将抛出一个**referenceError**。

## `ES6`（ES 2015）及更早版本：

词法作用域和作用域链的相同概念仍然适用于`ES6`. 然而，引入了一种声明变量的新方法。有以下几种：

*   `let`: 创建一个块范围的变量
*   `const`: 创建一个必须初始化且不能重新分配的块范围变量

`var`和`let`/之间的最大区别`const`是`var`函数作用域，而`let`/`const`是块作用域。下面是一个例子来说明这一点：

```
let letVar = 'global';
var varVar = 'global';

function foo () {

  if (true) {
    // this variable declared with let is scoped to the if block, block scoped
    let letVar = 5;
    // this variable declared with let is scoped to the function block, function scoped
    var varVar = 10;
  }

  console.log(letVar);
  console.log(varVar);
}

foo();
```

在上面的示例中，letVar 记录了全局值，因为用声明的变量`let`是块范围的。它们不再存在于各自的块之外，因此无法在 if 块之外访问该变量。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2020-05-25T16:11:42.093

我真的很喜欢接受的答案，但我想补充一下：

**Scope 收集并维护所有已声明标识符（变量）的查找列表，并针对当前执行的代码如何访问这些标识符执行一组严格的规则。**

范围是一组通过标识符名称查找变量的规则。

*   如果在直接作用域中找不到变量，引擎会查询下一个外部包含作用域，继续直到找到或到达最外层（也称为全局）作用域。
*   是一组规则，用于确定在何处以及如何查找变量（标识符）。此查找可能是为了分配给变量，这是一个 LHS（左侧）引用，或者它可能是为了检索它的值，这是一个 RHS（右侧）引用.
*   LHS 引用来自赋值操作。与范围相关的赋值可以使用 = 运算符或通过将参数传递给（赋值给）函数参数来进行。
*   JavaScript 引擎在执行之前首先编译代码，在此过程中，它会拆分语句，例如 var a = 2; 分为两个单独的步骤： 1。首先， var a 在该范围内声明它。这是在代码执行之前的开始执行的。第二。稍后，a = 2 查找变量（LHS 引用）并在找到时分配给它。
*   LHS 和 RHS 引用查找都从当前执行的范围开始，如果需要（也就是说，它们在那里找不到他们要查找的内容），它们会沿着嵌套范围向上工作，一个范围（地板) 一次，寻找标识符，直到他们到达全局（顶层）并停下来，要么找到它，要么不找到它。未完成的 RHS 引用会导致 ReferenceError 被抛出。未实现的 LHS 引用会导致自动、隐式创建该名称的全局（如果不在严格模式下）或 ReferenceError（如果在严格模式下）。
*   范围由一系列“气泡”组成，每个气泡都充当容器或桶，其中声明了标识符（变量、函数）。这些气泡彼此整齐地嵌套在一起，并且这种嵌套是在作者时定义的。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2021-06-28T11:13:30.387

```
(function foo() { console.log(foo) })();
console.log(typeof foo); // undefined, because `foo` is scoped to its own expression

//but, like this
(function foo() {
    console.log('1:', foo) // function foo
    foo = 100
    console.log('2:', foo) // function foo, is not 100, why?
})()
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2017-12-15T05:31:29.310

在 EcmaScript5 中，主要有两个作用域，**局部作用域**和**全局作用域**，但在 EcmaScript6 中，我们主要有三个作用域，局部作用域、全局作用域和一个称为**块作用域的新作用域**。

块范围的示例是：-

```
for ( let i = 0; i < 10; i++)
{
 statement1...
statement2...// inside this scope we can access the value of i, if we want to access the value of i outside for loop it will give undefined.
} 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2018-02-09T15:37:12.187

ECMAScript 6 引入了 let 和 const 关键字。这些关键字可以用来代替 var 关键字。与 var 关键字相反，let 和 const 关键字支持在块语句中声明局部范围。

```
var x = 10
let y = 10
const z = 10
{
  x = 20
  let y = 20
  const z = 20
  {
    x = 30
    // x is in the global scope because of the 'var' keyword
    let y = 30
    // y is in the local scope because of the 'let' keyword
    const z = 30
    // z is in the local scope because of the 'const' keyword
    console.log(x) // 30
    console.log(y) // 30
    console.log(z) // 30
  }
  console.log(x) // 30
  console.log(y) // 20
  console.log(z) // 20
}

console.log(x) // 30
console.log(y) // 10
console.log(z) // 10 
```

* * *

## 回答 #27

> 赞同：-3
> 
> 时间：2015-09-30T20:46:45.250

JavaScript 中有两种类型的作用域。

1.  **全局作用域**：在全局作用域内声明的变量可以非常流畅地在程序的任何地方使用。例如：

    ```
    var carName = " BMW";

    // code here can use carName

    function myFunction() {
         // code here can use carName 
    } 
    ```

2.  **功能范围或本地范围**：在此范围内声明的变量只能在其自己的函数中使用。例如：

    ```
    // code here can not use carName
    function myFunction() {
       var carName = "BMW";
       // code here can use carName
    } 
    ```

# python - 将 django-rest-interface 与 http put 一起使用

> ID：500434
> 
> 赞同：10
> 
> 时间：2009-02-01T08:29:44.950
> 
> 标签：python, django

我试图弄清楚如何使用 Django 和 django-rest-interface 实现我的第一个 RESTful 接口。我遇到了 HTTP PUT 请求问题。

如何访问 PUT 请求的参数？我认为它们会在 request.POST 数组中，因为 PUT 在我的理解中与 POST 有点相似，但该数组始终为空。

我究竟做错了什么？

谢谢您的帮助

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-01T18:41:22.080

request.POST 将表单编码的数据处理成字典，这仅对 Web 浏览器表单提交有意义。PUT 没有等价物，因为 Web 浏览器不 PUT 表单；提交的数据可以具有任何内容类型。您需要从 request.raw_post_data 中获取原始数据，可能检查内容类型，然后处理它，但对您的应用程序有意义。

[此线程](http://groups.google.com/group/django-developers/browse_thread/thread/771238a95ceb058e)中的更多信息。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-02T15:32:49.980

如果你在 ResourceBase 的调度中有这样一行：

```
elif request_method == 'PUT':
    load_put_and_files(request)
    return target.update(request, *args, **kwargs) 
```

load_put_and_files 让你准备 request.PUT 和数据 y request.method 是 PUT，所以你不必担心......

# design-patterns - 保持对象图一致

> ID：500436
> 
> 赞同：2
> 
> 时间：2009-02-01T08:32:50.780
> 
> 标签：design-patterns, oop

我有一种情况，对象 A 引用对象 B。B 也引用回 A。为简单起见，假设 A 和 B 属于同一类型。如何确保当我更新 A 上的引用时，更新也将反映在 B 上（反之亦然）？

此类接口的示例：

```
interface IGraphNode
{
    IGraphNode From { get; set; }
    IGraphNode To { get; set; } 
} 
```

执行下面的代码后，我希望`B.From`返回 A。

```
IGraphNode A = new GraphNode();
IGraphNode B = new GraphNode();
A.To = B; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-01T08:49:44.490

```
IGraphNode From
{ 
    get { return from; }
    set 
    {
        from = value;
        if (value.To != this) {
            value.To = this;
        }
    }
}

IGraphNode To
{
    get { return to; }
    set
    {
        to = value;
        if (value.From != this) {
            value.From = this;
        }
    }
} 
```

您可能希望通过检查 if (value == this) 来扩展它...

但是，如果您强制执行循环引用，则永远不能将 IGraphNode 用于非循环事物......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-01T08:48:31.590

您必须明确设置：

```
A.To = B;
B.From = A; 
```

只要这是可能的，它就是。大多数面向对象的语言都透明地处理诸如此类的循环引用。

如果您希望使这种双向引用自动进行，您始终可以扩展您的 IGraphNode 接口并创建一个抽象基类，该基类在您的 From 和 To 属性中有一些代码，在修改时设置另一个值。所有需要此自动功能的 GraphNode 都应扩展基本抽象类。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T08:55:28.470

您需要让 A 通知 B 链接，可能只需设置 B.From 属性即可。

但是，您需要考虑如果多个对象获得指向 B 的链接会怎样：

```
IGraphNode A = new GraphNode();
IGraphNode B = new GraphNode();
IGraphNode C = new GraphNode();

A.To = B;
C.To = B;

// what should B.From return? 
```

另外，想想如果被引用的对象之一未被引用会发生什么？例如：

```
IGraphNode A = new GraphNode();
IGraphNode B = new GraphNode();

A.To = B;
A = null;  // should the reference from B keep the object 
           // that A used to reference alive? 
```

WeakReference 对象而不是直接引用可能有助于解决这个特定问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T23:26:10.647

虽然公认的答案很聪明，但我不喜欢它。特别是关于在属性中修改“值”的部分。 **方法/属性不应该有隐藏的副作用**。像这样的做法通常会导致难以追踪的意外行为。期望调用 A 上的属性会修改我的 B 对象是不自然的。如果我明确检查代码，我只会知道这一点？很多时候源代码甚至不可用。

更好的解决方案是创建一个显式方法，使操作和任何副作用更加明显，例如：

```
void ConnectNodes(IGraphNode a, IGraphNode b)
{
    a.to = b;
    b.from = a;
} 
```

或者

```
void ConnectNodes(IGraphNode b)
{
    this.to = b;
    b.from = this;
} 
```

# batch-file - 创建bat或脚本文件来删除文件

> ID：500442
> 
> 赞同：0
> 
> 时间：2009-02-01T08:40:27.673
> 
> 标签：batch-file

我想知道如何创建一个 bat 文件，它在第一次运行时将存储系统日期，并在随后的运行中删除 30 天后的特定文件。我想如果可以创建一个 bat 文件来存储系统日期在它的第一个运行和第二个bat文件读取日期的第一个文件会更好。但是如何？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-01T08:52:12.643

正如@devio 评论的那样，PowerShell 的功能肯定更加全面：[PowerShell 快速参考](http://www.microsoft.com/downloadS/details.aspx?FamilyID=df8ed469-9007-401c-85e7-46649a32d0e0&displaylang=en)

如果它必须是批处理文件，此[参考](http://www.allenware.com/icsw/icswref.htm)解释了大多数命令。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T09:13:41.743

我喜欢 powershell，它肯定比批处理文件更强大，但为此，你使用什么并不重要，所以如果你对批处理文件感到满意，你应该能够坚持使用它们。

您以后能够恢复该日期的唯一方法是将其存储在某个地方（或者让您的任务一直运行这是不切实际的 - 考虑重新启动等）

您可以将删除日期写入注册表或文本文件或其他“已知”的地方，但随后您需要运行其他东西来检查“是否该采取行动”。

我倾向于在原始脚本期间为删除创建一个计划任务，这样我就不必检查它了。您甚至可以让您安排的删除脚本在任务完成后对其进行清理。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T09:25:15.773

您可以使用诸如 windowscripting 主机 vb 脚本或 js 脚本文件之类的东西。此外，诸如 php、python 或 perl 之类的脚本语言将允许您轻松地执行此类操作，并且可能比 shell 脚本提供更大的灵活性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-01T14:24:34.283

回答这个问题需要一段时间，但这是首先要建议的。

当您想要一个 .BAT（或 .CMD）做某事并在以后根据第一个事情做某事时，可以使用“标志参数”技术。例如，在一个接受通配符文件列表以进行操作的脚本中，可以执行以下操作：

```
::foo.cmd
@echo off
if %1@==@ goto fail
set f=%1
if %1==! goto inner
for %%x in (%f%) do cmd /c %0 ! %%x
goto done
:inner
set f=%2
echo do something with %f%
goto done
:fail
echo %0 {wildcard}
:done 
```

该脚本实际上是这样编写的，它可以被称为任何东西，并且它会调用自己（使用 %0）。

现在如何进行日期算术将需要一些时间来弄清楚。我希望这至少能让你朝着正确的方向开始。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T07:50:46.183

HI MARK BRACKETT，当我运行batch1时，日期是MM\DD\YYYY。但是当我运行batch2时，startdate是DD，startmonth也是DD。最后的等式是如果rundate==nowdate执行命令，它应该是rundate= >nowdate，因为如果电脑没有打开运行日期。第二个月有 31 天，运行日期将是下个月 31 日

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-01T15:38:57.020

安装完成后我的设置将运行一个 bat 文件（一次），该文件应该获取系统日期（安装日期）并存储在一个文本文件中。主程序将由另一个批处理文件调用，该文件每次都会读取文本文件在参考文本文件中的安装日期的“N”天后，帮助它删除特定文件的日期。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-01T16:02:12.150

VBScript、PowerShell 或 C#（我使用 CS-Script 来运行我的 C# 脚本）会*更*干净 - 但有时我喜欢一些批处理文件挑战。

所以 - 这是从当前日期和时间开始的 1 个月，但它给了你这个想法。要实际计算 30 天，我怀疑您需要大约 50 行 IF 语句。或者，一个外部 EXE 为您计算它。

我认为有一种更简洁的方法可以使用 SET 本身来拆分日期部分，这会将其减少大约 3 行 - 但我不记得语法 ATM 了。

```
Batch1
   ECHO %DATE% > start.txt

Batch2
   : Get start date
   FOR /F "tokens=1* delims= " %%i IN (start.txt) DO set startDate=%%j
   FOR /F "tokens=1,2 eol=/ delims=/ " %%i IN ('echo %startDate%') DO set startMonth=%%i
   FOR /F "tokens=1,2 delims=/ eol=/" %%i IN ('echo %startDate%') DO set startDay=%%j
   FOR /F "tokens=2,3 delims=/ " %%i IN ('echo %startDate%') DO set startYear=%%j

   : Get run month and day as YYYY-MM-DD
   SET /A runMonth=%startMonth% + 1
   IF %runMonth% LEQ 10 SET runMonth=0%runMonth%
   SET runDay=%startDay%
   SET runYear=%startYear%
   SET runDate=%runYear%-%runMonth%-%runDay%

   : Get current month and day as YYYY-MM-DD
   FOR /F "tokens=1* delims= " %%i IN ('echo %DATE%') DO set nowDate=%%j
   FOR /F "tokens=1,2 eol=/ delims=/ " %%i IN ('echo %nowDate%') DO set nowMonth=%%i
   FOR /F "tokens=1,2 delims=/ eol=/" %%i IN ('echo %nowDate%') DO set nowDay=%%j
   FOR /F "tokens=2,3 delims=/ " %%i IN ('echo %nowDate%') DO set nowYear=%%j
   SET nowDate=%nowYear%-%nowMonth%-%nowDay%

   : Compare
   IF %nowDate% GEQ %runDate% ECHO Delete! 
```

请注意，这不能适当地处理年份更改（它将在年份更改时删除）。

# cocoa - 使用 setTarget: 单元格的消息来设置目标文件的所有者

> ID：500443
> 
> 赞同：0
> 
> 时间：2009-02-01T08:40:36.303
> 
> 标签：cocoa

我有一个自定义的 NSActionCell 子类，我想使用 setTarget: 消息将它的目标设置为文件的所有者。有没有办法获得指向文件所有者的指针，或者做一些事情？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-01T08:53:41.440

文件的所有者应该是您自己的类之一的实例。将 FO 的出口连接到单元实例，并`setTarget:`从 FO 发送消息（可能在 中`awakeFromNib`）。

不过，我不清楚您为什么要使用`setTarget:`代码发送消息。为什么不在 IB 中设置单元格的目标？

# c++ - 纯虚方法 VS。函数指针

> ID：500456
> 
> 赞同：2
> 
> 时间：2009-02-01T08:54:53.073
> 
> 标签：c++, design-patterns, abstract-class, function-pointers

最近我一直在设计一个 Thread 类库，我做了一个 Thread 抽象类，如下所示：

```
class Thread {
public:
    run() { /*start the thread*/ }
    kill() { /*stop the thread*/ }
protected:
    virtual int doOperation(unsigned int, void *) = 0;
}; 
```

真正的线程类会继承这个抽象类并`doOperation`以自己的逻辑实现方法，类似于[Strategy Pattern](http://en.wikipedia.org/wiki/Strategy_pattern)。

问题是我依赖于一个 C 后端库，它定义了在以下函数中运行线程：

```
int startThread(char* name, (int)(*)(unsigned int, void*), int, int, int, void*); 
```

如你看到的; 第二个参数是一个指向线程循环（主函数）的函数指针，这就是问题所在；由于我使用这个 C 函数在`run`方法中启动线程，所以我将地址传递`doOperation`给第二个参数，但由于类型不匹配，这无法完成。

我尝试使用`reinterpret_cast`返回指针，但我 ISO-C++ 禁止返回未初始化函数成员的指针。我不知道如何克服这个冲突，我猜使用静态方法是唯一的解决方案，但这会破坏我的设计模式！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-01T09:35:26.940

首先，请务必阅读 Michael Burr 提供的链接，因为它包含很好的信息。然后，这里是它的 C++ish 伪代码：

```
int wrapperDoOperation(int v, void *ctx)
{
    Thread *thread = (Thread *)ctx;
    return thread->doOperation(v);
}

class Thread {
public:
    run() {
         startThread("bla", wrapperDoOperation, bla, bla, bla, (void *)this);
    }
    kill() { /*stop the thread*/ }
protected:
    virtual int doOperation(unsigned int) = 0;

friend wrapperDoOperation ......;
}; 
```

这个想法是，作为 Thread 的成员函数的 doOperation 不需要 void *context，您可以将要传递的任何内容作为上下文保留在对象本身中。因此，您可以使用 void 指针将实际的 this 指针传递给 doOperation。注意 void * 细节对你的类的用户是隐藏的，这很好。

# winapi - 如何找到打开特定文件的进程？

> ID：500462
> 
> 赞同：2
> 
> 时间：2009-02-01T09:00:48.180
> 
> 标签：winapi, file

如何找到打开了特定文件的进程，以及它们的打开、访问和共享模式？此外，是否可以更改流程的这些值？或者，如果文件已经被另一个进程以独占方式打开，是否可以打开文件进行读取？

请注意，我不想使打开文件的进程句柄无效。我只想能够访问该文件（如果可能的话）。

（我主要询问的是 Windows，但欢迎其他平台的解决方案，因为它们有助于社区的知识。）

[编辑：我在这里](https://stackoverflow.com/questions/183925/what-win32-api-can-be-used-to-find-the-process-that-has-a-given-file-open)和[那里](https://stackoverflow.com/questions/231547/tracing-which-process-that-has-opened-a-particular-file)找到了我的第一个问题的一些答案。

编辑2：感谢大家提到的工具，但我主要是在寻找编程技术（例如使用Win32 API）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-01T09:05:31.947

[进程监视器](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)

[进程浏览器](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-01T09:06:25.500

对于 Windows，我知道来自 Sysinternal (www.sysinternals.com) 的工具：handle.exe。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-01T09:05:56.140

有一个名为[Unlocker](http://www.emptyloop.com/unlocker/)的实用程序可以告诉您哪个进程获得了资源的锁定。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-01T09:14:36.060

对于 unix，您可以使用`fuser`：

```
lnx0:i386_linux26> fuser -v a.cpp

                     USER        PID ACCESS COMMAND
a.cpp                nabcdefg    3952 f....  less 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-01T09:14:46.467

就是Linux系统下的**lsof命令。**

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-01T09:30:57.667

我不确定是否有办法完全按照您的要求做，但我知道使用 System.Diagnostics.Process 类（至少在 .Net 中）您可以打开进程并查看某些属性：

```
System.Diagnostics.Process[] procArray = System.Diagnostics.Process.GetProcessesByName("notepad");
foreach (System.Diagnostics.Process proc in procArray) {
    //do something with the process...
} 
```

环顾 Process 类，也许有一个属性或集合可以获取您要查找的数据。

# python - 在 Python 中 - 如何在没有输出的情况下执行系统命令

> ID：500477
> 
> 赞同：12
> 
> 时间：2009-02-01T09:20:45.690
> 
> 标签：python

Python中是否有内置方法可以执行系统命令而不显示输出？我只想获取返回值。

跨平台很重要，因此仅将输出重定向到 /dev/null 在 Windows 上不起作用，反之亦然。我知道我可以检查 os.platform 并自己构建重定向，但我希望有一个内置的解决方案。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-02-01T09:50:37.283

```
import os
import subprocess
subprocess.call(["ls", "-l"], stdout=open(os.devnull, "w"), stderr=subprocess.STDOUT) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-01T09:23:58.867

您可以将输出重定向到临时文件并在之后将其删除。但是还有一种名为 popen 的方法，可以将输出直接重定向到您的程序，这样它就不会出现在屏幕上。

# java - BufferedImage 的 getSubimage 性能

> ID：500484
> 
> 赞同：3
> 
> 时间：2009-02-01T09:24:11.940
> 
> 标签：java, swing, 2d

我正在开发一个 Java 2D 渲染程序（在 1.6.0_11 上运行），它使用外部图像进行 UI 渲染。这些大图像同时包含几个 UI 图形部分，我现在使用 BufferedImage.getSubimage() 提取它们。假设一个普通的桌面系统（我们没有启用 DirectX/OpenGL 加速），我的问题是：

*   getSubimage() 是一个内存高效调用，因为它共享底层图像数据，但这会影响这些子图像与 Graphics2D.drawImage() 的渲染速度吗？
*   如果图像使用每像素 8 位的调色板模式，那么使用 RGBA 模式（例如 4x 内存）或依赖调色板颜色模型（例如转换时间）的增益/损失是多少？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T18:50:24.990

据我所知，`getSubimage(...)`应该不会对渲染产生任何重大影响。

转换图像数据很慢，通常最好尽量避免在运行中进行。

* * *

用图像的慢速可以分为两类：

*   磁盘 I/O
*   数据处理

磁盘 I/O 很容易成为最慢的部分。

如果您打算只使用图像的一部分，最好能够从磁盘仅加载图像的一部分。

我的经验是，与标准库的东西相比，[JAI](http://java.sun.com/javase/technologies/desktop/media/jai/)更擅长只做真正需要的事情。

# java - C++ 等价于 java 的 instanceof

> ID：500493
> 
> 赞同：219
> 
> 时间：2009-02-01T09:32:48.990
> 
> 标签：java, c++, oop, instanceof

实现 C++ 等效于 java 的首选方法是`instanceof`什么？

* * *

## 回答 #1

> 赞同：211
> 
> 时间：2009-02-01T09:34:33.930

尝试使用：

```
if(NewType* v = dynamic_cast<NewType*>(old)) {
   // old was safely casted to NewType
   v->doSomething();
} 
```

这需要您的编译器启用 rtti 支持。

编辑：我对这个答案有一些很好的评论！

每次您需要使用 dynamic_cast（或 instanceof）时，您最好问问自己这是否是必要的。这通常是设计不佳的标志。

典型的解决方法是将您正在检查的类的特殊行为放入基类的虚函数中，或者可能引入类似[访问者](http://en.wikipedia.org/wiki/Visitor_pattern)的东西，您可以在不更改接口的情况下为子类引入特定行为（除了添加访问者接受接口课程）。

正如所指出的，dynamic_cast 不是免费的。处理大多数（但不是所有情况）的简单且始终如一的 hack 基本上是添加一个枚举，代表您的类可以拥有的所有可能类型，并检查您是否得到了正确的类型。

```
if(old->getType() == BOX) {
   Box* box = static_cast<Box*>(old);
   // Do something box specific
} 
```

这不是好的 oo 设计，但它可以作为一种解决方法，其成本或多或少只是一个虚函数调用。无论 RTTI 是否启用，它都可以正常工作。

请注意，这种方法不支持多级继承，因此如果您不小心，您可能会得到如下所示的代码：

```
// Here we have a SpecialBox class that inherits Box, since it has its own type
// we must check for both BOX or SPECIAL_BOX
if(old->getType() == BOX || old->getType() == SPECIAL_BOX) {
   Box* box = static_cast<Box*>(old);
   // Do something box specific
} 
```

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2014-08-10T17:46:46.423

根据你想要做什么，你可以这样做：

```
template<typename Base, typename T>
inline bool instanceof(const T*) {
    return std::is_base_of<Base, T>::value;
} 
```

采用：

```
if (instanceof<BaseClass>(ptr)) { ... } 
```

但是，这纯粹是对编译器已知的类型进行操作。

**编辑：**

此代码应适用于多态指针：

```
template<typename Base, typename T>
inline bool instanceof(const T *ptr) {
    return dynamic_cast<const Base*>(ptr) != nullptr;
} 
```

示例：[http ://cpp.sh/6qir](http://cpp.sh/6qir)

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2018-03-15T10:00:40.150

# 没有dynamic_cast的Instanceof实现

我认为这个问题在今天仍然很重要。使用 C++11 标准，您现在可以实现一个`instanceof`函数，而无需`dynamic_cast`像这样使用：

```
if (dynamic_cast<B*>(aPtr) != nullptr) {
  // aPtr is instance of B
} else {
  // aPtr is NOT instance of B
} 
```

但你仍然依赖`RTTI`支持。所以这是我根据一些宏和元编程魔术解决这个问题的方法。恕我直言，唯一的缺点是这种方法不适**用于**多重*继承*。

**InstanceOfMacros.h**

```
#include <set>
#include <tuple>
#include <typeindex>

#define _EMPTY_BASE_TYPE_DECL() using BaseTypes = std::tuple<>;
#define _BASE_TYPE_DECL(Class, BaseClass) \
  using BaseTypes = decltype(std::tuple_cat(std::tuple<BaseClass>(), Class::BaseTypes()));
#define _INSTANCE_OF_DECL_BODY(Class)                                 \
  static const std::set<std::type_index> baseTypeContainer;           \
  virtual bool instanceOfHelper(const std::type_index &_tidx) {       \
    if (std::type_index(typeid(ThisType)) == _tidx) return true;      \
    if (std::tuple_size<BaseTypes>::value == 0) return false;         \
    return baseTypeContainer.find(_tidx) != baseTypeContainer.end();  \
  }                                                                   \
  template <typename... T>                                            \
  static std::set<std::type_index> getTypeIndexes(std::tuple<T...>) { \
    return std::set<std::type_index>{std::type_index(typeid(T))...};  \
  }

#define INSTANCE_OF_SUB_DECL(Class, BaseClass) \
 protected:                                    \
  using ThisType = Class;                      \
  _BASE_TYPE_DECL(Class, BaseClass)            \
  _INSTANCE_OF_DECL_BODY(Class)

#define INSTANCE_OF_BASE_DECL(Class)                                                    \
 protected:                                                                             \
  using ThisType = Class;                                                               \
  _EMPTY_BASE_TYPE_DECL()                                                               \
  _INSTANCE_OF_DECL_BODY(Class)                                                         \
 public:                                                                                \
  template <typename Of>                                                                \
  typename std::enable_if<std::is_base_of<Class, Of>::value, bool>::type instanceOf() { \
    return instanceOfHelper(std::type_index(typeid(Of)));                               \
  }

#define INSTANCE_OF_IMPL(Class) \
  const std::set<std::type_index> Class::baseTypeContainer = Class::getTypeIndexes(Class::BaseTypes()); 
```

# 演示

然后，您可以按如下方式使用这些东西（**谨慎**）：

**DemoClassHierarchy.hpp***

```
#include "InstanceOfMacros.h"

struct A {
  virtual ~A() {}
  INSTANCE_OF_BASE_DECL(A)
};
INSTANCE_OF_IMPL(A)

struct B : public A {
  virtual ~B() {}
  INSTANCE_OF_SUB_DECL(B, A)
};
INSTANCE_OF_IMPL(B)

struct C : public A {
  virtual ~C() {}
  INSTANCE_OF_SUB_DECL(C, A)
};
INSTANCE_OF_IMPL(C)

struct D : public C {
  virtual ~D() {}
  INSTANCE_OF_SUB_DECL(D, C)
};
INSTANCE_OF_IMPL(D) 
```

以下代码提供了一个小演示，以验证基本的正确行为。

**InstanceOfDemo.cpp**

```
#include <iostream>
#include <memory>
#include "DemoClassHierarchy.hpp"

int main() {
  A *a2aPtr = new A;
  A *a2bPtr = new B;
  std::shared_ptr<A> a2cPtr(new C);
  C *c2dPtr = new D;
  std::unique_ptr<A> a2dPtr(new D);

  std::cout << "a2aPtr->instanceOf<A>(): expected=1, value=" << a2aPtr->instanceOf<A>() << std::endl;
  std::cout << "a2aPtr->instanceOf<B>(): expected=0, value=" << a2aPtr->instanceOf<B>() << std::endl;
  std::cout << "a2aPtr->instanceOf<C>(): expected=0, value=" << a2aPtr->instanceOf<C>() << std::endl;
  std::cout << "a2aPtr->instanceOf<D>(): expected=0, value=" << a2aPtr->instanceOf<D>() << std::endl;
  std::cout << std::endl;
  std::cout << "a2bPtr->instanceOf<A>(): expected=1, value=" << a2bPtr->instanceOf<A>() << std::endl;
  std::cout << "a2bPtr->instanceOf<B>(): expected=1, value=" << a2bPtr->instanceOf<B>() << std::endl;
  std::cout << "a2bPtr->instanceOf<C>(): expected=0, value=" << a2bPtr->instanceOf<C>() << std::endl;
  std::cout << "a2bPtr->instanceOf<D>(): expected=0, value=" << a2bPtr->instanceOf<D>() << std::endl;
  std::cout << std::endl;
  std::cout << "a2cPtr->instanceOf<A>(): expected=1, value=" << a2cPtr->instanceOf<A>() << std::endl;
  std::cout << "a2cPtr->instanceOf<B>(): expected=0, value=" << a2cPtr->instanceOf<B>() << std::endl;
  std::cout << "a2cPtr->instanceOf<C>(): expected=1, value=" << a2cPtr->instanceOf<C>() << std::endl;
  std::cout << "a2cPtr->instanceOf<D>(): expected=0, value=" << a2cPtr->instanceOf<D>() << std::endl;
  std::cout << std::endl;
  std::cout << "c2dPtr->instanceOf<A>(): expected=1, value=" << c2dPtr->instanceOf<A>() << std::endl;
  std::cout << "c2dPtr->instanceOf<B>(): expected=0, value=" << c2dPtr->instanceOf<B>() << std::endl;
  std::cout << "c2dPtr->instanceOf<C>(): expected=1, value=" << c2dPtr->instanceOf<C>() << std::endl;
  std::cout << "c2dPtr->instanceOf<D>(): expected=1, value=" << c2dPtr->instanceOf<D>() << std::endl;
  std::cout << std::endl;
  std::cout << "a2dPtr->instanceOf<A>(): expected=1, value=" << a2dPtr->instanceOf<A>() << std::endl;
  std::cout << "a2dPtr->instanceOf<B>(): expected=0, value=" << a2dPtr->instanceOf<B>() << std::endl;
  std::cout << "a2dPtr->instanceOf<C>(): expected=1, value=" << a2dPtr->instanceOf<C>() << std::endl;
  std::cout << "a2dPtr->instanceOf<D>(): expected=1, value=" << a2dPtr->instanceOf<D>() << std::endl;

  delete a2aPtr;
  delete a2bPtr;
  delete c2dPtr;

  return 0;
} 
```

**输出：**

```
a2aPtr->instanceOf<A>(): expected=1, value=1
a2aPtr->instanceOf<B>(): expected=0, value=0
a2aPtr->instanceOf<C>(): expected=0, value=0
a2aPtr->instanceOf<D>(): expected=0, value=0

a2bPtr->instanceOf<A>(): expected=1, value=1
a2bPtr->instanceOf<B>(): expected=1, value=1
a2bPtr->instanceOf<C>(): expected=0, value=0
a2bPtr->instanceOf<D>(): expected=0, value=0

a2cPtr->instanceOf<A>(): expected=1, value=1
a2cPtr->instanceOf<B>(): expected=0, value=0
a2cPtr->instanceOf<C>(): expected=1, value=1
a2cPtr->instanceOf<D>(): expected=0, value=0

c2dPtr->instanceOf<A>(): expected=1, value=1
c2dPtr->instanceOf<B>(): expected=0, value=0
c2dPtr->instanceOf<C>(): expected=1, value=1
c2dPtr->instanceOf<D>(): expected=1, value=1

a2dPtr->instanceOf<A>(): expected=1, value=1
a2dPtr->instanceOf<B>(): expected=0, value=0
a2dPtr->instanceOf<C>(): expected=1, value=1
a2dPtr->instanceOf<D>(): expected=1, value=1 
```

# 表现

现在出现的最有趣的问题是，这种邪恶的东西是否比使用`dynamic_cast`. 因此，我编写了一个非常基本的性能测量应用程序。

**InstanceOfPerformance.cpp**

```
#include <chrono>
#include <iostream>
#include <string>
#include "DemoClassHierarchy.hpp"

template <typename Base, typename Derived, typename Duration>
Duration instanceOfMeasurement(unsigned _loopCycles) {
  auto start = std::chrono::high_resolution_clock::now();
  volatile bool isInstanceOf = false;
  for (unsigned i = 0; i < _loopCycles; ++i) {
    Base *ptr = new Derived;
    isInstanceOf = ptr->template instanceOf<Derived>();
    delete ptr;
  }
  auto end = std::chrono::high_resolution_clock::now();
  return std::chrono::duration_cast<Duration>(end - start);
}

template <typename Base, typename Derived, typename Duration>
Duration dynamicCastMeasurement(unsigned _loopCycles) {
  auto start = std::chrono::high_resolution_clock::now();
  volatile bool isInstanceOf = false;
  for (unsigned i = 0; i < _loopCycles; ++i) {
    Base *ptr = new Derived;
    isInstanceOf = dynamic_cast<Derived *>(ptr) != nullptr;
    delete ptr;
  }
  auto end = std::chrono::high_resolution_clock::now();
  return std::chrono::duration_cast<Duration>(end - start);
}

int main() {
  unsigned testCycles = 10000000;
  std::string unit = " us";
  using DType = std::chrono::microseconds;

  std::cout << "InstanceOf performance(A->D)  : " << instanceOfMeasurement<A, D, DType>(testCycles).count() << unit
            << std::endl;
  std::cout << "InstanceOf performance(A->C)  : " << instanceOfMeasurement<A, C, DType>(testCycles).count() << unit
            << std::endl;
  std::cout << "InstanceOf performance(A->B)  : " << instanceOfMeasurement<A, B, DType>(testCycles).count() << unit
            << std::endl;
  std::cout << "InstanceOf performance(A->A)  : " << instanceOfMeasurement<A, A, DType>(testCycles).count() << unit
            << "\n"
            << std::endl;
  std::cout << "DynamicCast performance(A->D) : " << dynamicCastMeasurement<A, D, DType>(testCycles).count() << unit
            << std::endl;
  std::cout << "DynamicCast performance(A->C) : " << dynamicCastMeasurement<A, C, DType>(testCycles).count() << unit
            << std::endl;
  std::cout << "DynamicCast performance(A->B) : " << dynamicCastMeasurement<A, B, DType>(testCycles).count() << unit
            << std::endl;
  std::cout << "DynamicCast performance(A->A) : " << dynamicCastMeasurement<A, A, DType>(testCycles).count() << unit
            << "\n"
            << std::endl;
  return 0;
} 
```

结果各不相同，基本上取决于编译器优化的程度。`g++ -std=c++11 -O0 -o instanceof-performance InstanceOfPerformance.cpp`使用我本地机器上的输出编译性能测量程序是：

```
InstanceOf performance(A->D)  : 699638 us
InstanceOf performance(A->C)  : 642157 us
InstanceOf performance(A->B)  : 671399 us
InstanceOf performance(A->A)  : 626193 us

DynamicCast performance(A->D) : 754937 us
DynamicCast performance(A->C) : 706766 us
DynamicCast performance(A->B) : 751353 us
DynamicCast performance(A->A) : 676853 us 
```

嗯，这个结果非常发人深省，因为时间表明新方法与`dynamic_cast`方法相比并没有快多少。对于测试 的指针`A`是否为`A`. **但是**通过使用编译器 otpimization 调整我们的二进制文件，潮流发生了逆转。相应的编译器命令是`g++ -std=c++11 -O3 -o instanceof-performance InstanceOfPerformance.cpp`. 在我的本地机器上的结果是惊人的：

```
InstanceOf performance(A->D)  : 3035 us
InstanceOf performance(A->C)  : 5030 us
InstanceOf performance(A->B)  : 5250 us
InstanceOf performance(A->A)  : 3021 us

DynamicCast performance(A->D) : 666903 us
DynamicCast performance(A->C) : 698567 us
DynamicCast performance(A->B) : 727368 us
DynamicCast performance(A->A) : 3098 us 
```

如果您不依赖多重继承，不反对好的旧 C 宏、RTTI 和模板元编程，并且不太懒于向类层次结构的类添加一些小指令，那么这种方法可以稍微提升您的应用程序关于它的性能，如果您经常检查指针的实例。**但请谨慎使用**。不保证此方法的正确性。

*注意：所有演示都是`clang (Apple LLVM version 9.0.0 (clang-900.0.39.2))`在 2012 年中的 MacBook Pro 上使用 macOS Sierra 编译的。*

**编辑：** 我还使用`gcc (Ubuntu 5.4.0-6ubuntu1~16.04.9) 5.4.0 20160609`. 在这个平台上，性能优势并不像在带有 clang 的 macO 上那么显着。

**输出（没有编译器优化）：**

```
InstanceOf performance(A->D)  : 390768 us
InstanceOf performance(A->C)  : 333994 us
InstanceOf performance(A->B)  : 334596 us
InstanceOf performance(A->A)  : 300959 us

DynamicCast performance(A->D) : 331942 us
DynamicCast performance(A->C) : 303715 us
DynamicCast performance(A->B) : 400262 us
DynamicCast performance(A->A) : 324942 us 
```

**输出（带有编译器优化）：**

```
InstanceOf performance(A->D)  : 209501 us
InstanceOf performance(A->C)  : 208727 us
InstanceOf performance(A->B)  : 207815 us
InstanceOf performance(A->A)  : 197953 us

DynamicCast performance(A->D) : 259417 us
DynamicCast performance(A->C) : 256203 us
DynamicCast performance(A->B) : 261202 us
DynamicCast performance(A->A) : 193535 us 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-12-11T12:24:48.533

`dynamic_cast`众所周知是低效的。它向上遍历继承层次结构，如果您有多个继承级别，并且需要检查对象是否是其类型层次结构中任何一种类型的实例，*它是唯一的解决方案。*

但是，如果一个更有限的形式`instanceof`只检查一个对象是否正是您指定的类型，就足以满足您的需求，那么下面的函数会更有效率：

```
template<typename T, typename K>
inline bool isType(const K &k) {
    return typeid(T).hash_code() == typeid(k).hash_code();
} 
```

这是您如何调用上述函数的示例：

```
DerivedA k;
Base *p = &k;

cout << boolalpha << isType<DerivedA>(*p) << endl;  // true
cout << boolalpha << isType<DerivedB>(*p) << endl;  // false 
```

您将指定模板类型`A`（作为您要检查的类型），并传入您要测试的对象作为参数（从中`K`推断出模板类型）。

* * *

## 回答 #5

> 赞同：-4
> 
> 时间：2013-09-25T06:58:05.410

```
#include <iostream.h>
#include<typeinfo.h>

template<class T>
void fun(T a)
{
  if(typeid(T) == typeid(int))
  {
     //Do something
     cout<<"int";
  }
  else if(typeid(T) == typeid(float))
  {
     //Do Something else
     cout<<"float";
  }
}

void main()
 {
      fun(23);
      fun(90.67f);
 } 
```

# c - 学习 GObject 和 Glib 的材料

> ID：500501
> 
> 赞同：50
> 
> 时间：2009-02-01T09:43:17.377
> 
> 标签：c, gstreamer, gnome, glib, gobject

我对 C. 很满意，但需要学习`GObject`和`Glib`为`gstreamer`. 我在网上找到的只是 Gobject 参考手册。它很好，但正在寻找 Gobject/Glib 的教程，因为主要关注的是 gstreamer。

所以请分享任何其他资源来学习 glib 和 gobject。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-02-01T22:55:05.720

从 Glib 开始，它非常简单并且在这里得到了很好的描述：[Glib 参考手册](http://library.gnome.org/devel/glib/stable/)

GObject 大多是大量的样板代码来实现面向对象。试用[GObject 参考手册中的“maman bar”示例](http://library.gnome.org/devel/gobject/unstable/index.html)

对我来说，GStreamer 花了最多时间去理解。文档很好，但有很多要阅读的内容（[GStreamer 文档](http://gstreamer.freedesktop.org/documentation/)）。阅读基础知识后，尝试使用 gst-launch 从 cmdline 启动管道。然后阅读有关应用程序开发的完整手册并做一些示例。在尝试构建自己的插件之前，请查看一些简单的插件并尝试了解不同的部分，一个简单的起点是[身份插件](http://gstreamer.freedesktop.org/data/doc/gstreamer/0.10.3/gstreamer-plugins/html/gstreamer-plugins-identity.html)

祝你好运！

/乔尔·拉尔森

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2010-02-20T00:26:56.400

在阅读了 Gnome 开发人员指南中的章节并阅读了 gobject 手册之后，您可能会对我上传到 github的[这些](http://github.com/zorgnax/gobject-examples)示例程序感兴趣。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-01T12:56:11.403

还有“官方 Gnome 2 开发人员指南”。见第 59 页。在提到的书上......检查gtk的来源真的是个好主意。过去几周我一直在研究它，发现这本书很有帮助。相当乏味的是让构造函数正确并且初始化的顺序是“相当”令人费解的。您还应该检查 GObject 文档中的第 4 章。它并没有涵盖所有内容，但与本书一起使用还不错。我建议从一个非常简单的衍生玻璃形式 GObject 开始......，以更好地理解基本原理

一个总是有两个结构。一个类结构，其中存储所有函数指针和一个代表一个对象的实例结构。这是获得的最重要的东西。

另一个更难理解的点是内存管理的引用计数。如果您之前接触过 Objective-C 和/或 libapr 和/或 COM，这会有所帮助。

问候弗里德里希

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-01T10:27:17.960

[这](http://www.gtkbook.com/)是我找到的最好的 GTK+ 书，它有一章关于 GLib，但参考手册是最好的学习场所，也是你会发现的最新的“书”。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-06-15T19:48:21.313

[使用 GLib 集合管理 C 数据](http://www.ibm.com/developerworks/linux/tutorials/l-glib/)是对 glib 集合（链接、哈希表、数组、树、队列、关系）的介绍。包括很多例子。适合初学者。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-11-21T01:02:01.610

也许太容易了，但是有[GNOME 平台演示](http://developer.gnome.org/gnome-devel-demos/)，您可以习惯 GNOME 及其库的惯用语。

# javascript - 为什么使用“for...in”进行数组迭代是个坏主意？

> ID：500504
> 
> 赞同：1981
> 
> 时间：2009-02-01T09:46:38.510
> 
> 标签：javascript, arrays, loops, for-loop, iteration

我被告知不要`for...in`在 JavaScript 中使用数组。为什么不？

* * *

## 回答 #1

> 赞同：1669
> 
> 时间：2009-02-01T10:08:34.517

原因是一个构造：

```
var a = []; // Create a new empty array.
a[5] = 5;   // Perfectly legal JavaScript that resizes the array.

for (var i = 0; i < a.length; i++) {
    // Iterate over numeric indexes from 0 to 5, as everyone expects.
    console.log(a[i]);
}

/* Will display:
   undefined
   undefined
   undefined
   undefined
   undefined
   5
*/
```

有时可能完全不同：

```
var a = [];
a[5] = 5;
for (var x in a) {
    // Shows only the explicitly set index of "5", and ignores 0-4
    console.log(x);
}

/* Will display:
   5
*/
```

还要考虑[JavaScript](http://en.wikipedia.org/wiki/JavaScript)库可能会做这样的事情，这将影响您创建的任何数组：

```
// Somewhere deep in your JavaScript library...
Array.prototype.foo = 1;

// Now you have no idea what the below code will do.
var a = [1, 2, 3, 4, 5];
for (var x in a){
    // Now foo is a part of EVERY array and 
    // will show up here as a value of 'x'.
    console.log(x);
}

/* Will display:
   0
   1
   2
   3
   4
   foo
*/
```

* * *

## 回答 #2

> 赞同：411
> 
> 时间：2010-11-23T21:22:54.893

该`for-in`语句本身并不是一个“坏习惯”，但是它可能会被*误用*，例如，*迭代*数组或类似数组的对象。

该`for-in`语句的目的是*枚举*对象属性。该语句将在原型链中上升，还会枚举*继承*的属性，这*有时*是不希望的。

此外，规范不保证迭代的顺序，这意味着如果你想“迭代”一个数组对象，使用这个语句你不能确定属性（数组索引）将按数字顺序访问。

例如，在 JScript (IE <= 8) 中，即使在 Array 对象上的枚举顺序也被定义为属性被创建：

```
var array = [];
array[2] = 'c';
array[1] = 'b';
array[0] = 'a';

for (var p in array) {
  //... p will be "2", "1" and "0" on IE
} 
```

此外，谈到继承的属性，例如，如果您扩展`Array.prototype`对象（就像 MooTools 那样的某些库），也会枚举该属性：

```
Array.prototype.last = function () { return this[this.length-1]; };

for (var p in []) { // an empty array
  // last will be enumerated
} 
```

正如我之前所说的*迭代*数组或类似数组的对象，最好的办法是使用*顺序循环*，例如普通的`for`/`while`循环。

当您只想枚举对象的*自身属性*（未继承的属性）时，可以使用以下`hasOwnProperty`方法：

```
for (var prop in obj) {
  if (obj.hasOwnProperty(prop)) {
    // prop is not inherited
  }
} 
```

有些人甚至建议直接调用该方法`Object.prototype`以避免在有人`hasOwnProperty`向我们的对象添加一个名为的属性时出现问题：

```
for (var prop in obj) {
  if (Object.prototype.hasOwnProperty.call(obj, prop)) {
    // prop is not inherited
  }
} 
```

* * *

## 回答 #3

> 赞同：124
> 
> 时间：2009-02-01T14:04:57.177

`for..in`不应该使用迭代数组元素的三个原因：

*   `for..in`将遍历数组对象的所有自己和继承的属性，这些属性不是`DontEnum`; 这意味着如果有人将属性添加到特定的数组对象（这是有正当理由的 - 我自己已经这样做了）或更改`Array.prototype`（这在代码中被认为是不好的做法，应该与其他脚本一起工作），这些属性将也被迭代；可以通过检查来排除继承的属性`hasOwnProperty()`，但这对您在数组对象本身中设置的属性没有帮助

*   `for..in`不能保证保留元素顺序

*   它很慢，因为您必须遍历数组对象的所有属性及其整个原型链，并且仍然只会获取属性的名称，即要获取值，需要进行额外的查找

* * *

## 回答 #4

> 赞同：59
> 
> 时间：2009-02-01T10:08:37.763

因为 for...in 枚举的是保存数组的对象，而不是数组本身。如果我在数组原型链中添加一个函数，那也将包括在内。IE

```
Array.prototype.myOwnFunction = function() { alert(this); }
a = new Array();
a[0] = 'foo';
a[1] = 'bar';
for(x in a){
 document.write(x + ' = ' + a[x]);
} 
```

这将写：

```
0 = 富
1 = 酒吧
myOwnFunction = function() { alert(this); }

```

而且由于您永远无法确定不会将任何内容添加到原型链中，因此只需使用 for 循环来枚举数组：

```
for(i=0,x=a.length;i<x;i++){
 document.write(i + ' = ' + a[i]);
} 
```

这将写：

```
0 = 富
1 = 酒吧

```

* * *

## 回答 #5

> 赞同：49
> 
> 时间：2016-03-10T04:29:37.267

`for…of`正如John Slegers 已经注意到的那样，从 2016 (ES6) 开始，我们可能会使用数组迭代。

我只想添加这个简单的演示代码，以使事情更清楚：

```
Array.prototype.foo = 1;
var arr = [];
arr[5] = "xyz";

console.log("for...of:");
var count = 0;
for (var item of arr) {
    console.log(count + ":", item);
    count++;
    }

console.log("for...in:");
count = 0;
for (var item in arr) {
    console.log(count + ":", item);
    count++;
    } 
```

控制台显示：

```
for...of:

0: undefined
1: undefined
2: undefined
3: undefined
4: undefined
5: xyz

for...in:

0: 5
1: foo 
```

换句话说：

*   `for...of`从 0 到 5 计数，也忽略`Array.prototype.foo`. 它显示数组**值**。

*   `for...in`仅列出`5`，忽略未定义的数组索引，但添加`foo`. 它显示数组**属性名称**。

* * *

## 回答 #6

> 赞同：44
> 
> 时间：2013-03-14T07:12:23.437

简短的回答：这不值得。

* * *

更长的答案：即使不需要顺序元素顺序和最佳性能，这也不值得。

* * *

长答案：这不值得......

*   使用`for (var property in array)`将导致`array`作为*对象*进行迭代，遍历对象原型链并最终执行比基于索引的`for`循环慢。
*   `for (... in ...)`正如人们所期望的那样，不能保证按顺序返回对象属性。
*   使用`hasOwnProperty()`和`!isNaN()`检查来过滤对象属性是一个额外的开销，导致它执行得更慢，并且否定了首先使用它的关键原因，即因为更简洁的格式。

由于这些原因，甚至不存在性能和便利性之间可接受的权衡。除非打算将数组作为*对象*处理并对数组的对象属性执行操作，否则实际上没有任何好处。

* * *

## 回答 #7

> 赞同：41
> 
> 时间：2009-02-01T10:34:57.227

单独来看，在数组上使用 for-in 并没有错。For-in 迭代对象的属性名称，在“开箱即用”数组的情况下，属性对应于数组索引。（迭代中不包含 ,`length`等内置属性。）`toString`

但是，如果您的代码（或您正在使用的框架）将自定义属性添加到数组或数组原型，那么这些属性将包含在迭代中，这可能不是您想要的。

一些 JS 框架，例如 Prototype 修改了 Array 原型。JQuery 等其他框架没有，因此使用 JQuery，您可以安全地使用 for-in。

如果你有疑问，你可能不应该使用 for-in。

遍历数组的另一种方法是使用 for 循环：

```
for (var ix=0;ix<arr.length;ix++) alert(ix); 
```

但是，这有一个不同的问题。问题是 JavaScript 数组可能有“洞”。如果你定义`arr`为：

```
var arr = ["hello"];
arr[100] = "goodbye"; 
```

然后数组有两个项目，但长度为 101。使用 for-in 将产生两个索引，而 for 循环将产生 101 个索引，其中 99 的值为`undefined`。

* * *

## 回答 #8

> 赞同：35
> 
> 时间：2009-09-02T02:29:46.083

除了其他答案中给出的原因之外，如果您需要对计数器变量进行数学运算，您可能不想使用“for...in”结构，因为循环遍历对象属性的名称，因此变量是一个字符串。

例如，

```
for (var i=0; i<a.length; i++) {
    document.write(i + ', ' + typeof i + ', ' + i+1);
} 
```

将会写

```
0, number, 1
1, number, 2
... 
```

然而，

```
for (var ii in a) {
    document.write(i + ', ' + typeof i + ', ' + i+1);
} 
```

将会写

```
0, string, 01
1, string, 11
... 
```

当然，这可以很容易地通过包括

```
ii = parseInt(ii); 
```

在循环中，但第一个结构更直接。

* * *

## 回答 #9

> 赞同：23
> 
> 时间：2012-05-14T16:26:20.663

除了`for`...`in`循环所有可枚举属性（这*与*“所有数组元素”不同！），请参阅[http://www.ecma-international.org/publications/files/ECMA-ST/Ecma -262.pdf](http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-262.pdf)，第 12.6.4 节（第 5 版）或 13.7.5.15（第 7 版）：

> 枚举属性的机制和**顺序......****未指定**......

（强调我的。）

这意味着如果浏览器愿意，它可以按照插入的顺序遍历属性。或按数字顺序。或者按词法顺序（其中“30”在“4”之前！记住所有对象键——因此，所有数组索引——实际上都是字符串，所以这很有意义）。如果它将对象实现为哈希表，它可以按桶遍历它们。或者采取任何一个并添加“向后”。浏览器甚至可以*随机*迭代并符合 ECMA-262 标准，只要它只访问每个属性一次。

实际上，目前大多数浏览器都喜欢以大致相同的顺序进行迭代。但没有什么说他们必须这样做。这是特定于实现的，如果发现另一种方法更有效，则可能随时更改。

无论哪种方式，`for`……`in`都没有秩序的内涵。如果您关心顺序，请明确说明并使用`for`带有索引的常规循环。

* * *

## 回答 #10

> 赞同：19
> 
> 时间：2014-02-04T16:54:16.170

主要有两个原因：

**一**

就像其他人所说的那样，您可能会得到不在数组中或从原型继承的键。因此，假设一个库向 Array 或 Object 原型添加了一个属性：

```
Array.prototype.someProperty = true 
```

你会得到它作为每个数组的一部分：

```
for(var item in [1,2,3]){
  console.log(item) // will log 1,2,3 but also "someProperty"
} 
```

你可以用 hasOwnProperty 方法解决这个问题：

```
var ary = [1,2,3];
for(var item in ary){
   if(ary.hasOwnProperty(item)){
      console.log(item) // will log only 1,2,3
   }
} 
```

但这适用于使用 for-in 循环迭代任何对象。

**二**

通常数组中项的顺序很重要，但是for-in循环不一定会以正确的顺序迭代，那是因为它将数组视为对象，这是它在JS中实现的方式，而不是作为一个数组。这似乎是一件小事，但它确实会搞砸应用程序并且难以调试。

* * *

## 回答 #11

> 赞同：17
> 
> 时间：2016-02-21T20:48:39.173

我认为我没有太多要添加的内容。[Triptych 的答案](https://stackoverflow.com/questions/500504/why-is-using-for-in-with-array-iteration-such-a-bad-idea/500531#500531)或[CMS](https://stackoverflow.com/questions/500504/why-is-using-for-in-with-array-iteration-such-a-bad-idea/4261096#4261096)关于为什么`for...in`在某些情况下应避免使用的答案。

但是，我确实想补充一点，**在现代浏览器**`for...in`中，可以在无法使用的情况下使用替代`for...in`方法。该替代方案是[`for...of`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for...of)：

```
for (var item of items) {
    console.log(item);
} 
```

* * *

### 笔记 ：

不幸的是，没有任何版本的 Internet Explorer 支持`for...of`（[Edge 12+](https://www.microsoft.com/en-us/windows/microsoft-edge)支持），因此您必须等待更长的时间才能在客户端生产代码中使用它。但是，在您的服务器端 JS 代码中使用它应该是安全的（如果您使用[Node.js](https://nodejs.org/en/)）。

* * *

## 回答 #12

> 赞同：16
> 
> 时间：2009-02-01T09:50:03.183

因为它通过对象字段而不是索引进行枚举。你可以用索引“长度”获得价值，我怀疑你想要这个。

* * *

## 回答 #13

> 赞同：15
> 
> 时间：2010-11-23T21:23:50.470

问题`for ... in ...`- 只有当程序员并不真正理解该语言时，这才会成为问题；它不是真正的错误或任何东西——它迭代了一个对象的*所有*成员（嗯，所有*可枚举*的成员，但现在这是一个细节）。*当您只想*迭代数组的索引属性时，保持语义一致的唯一保证方法是使用整数索引（即`for (var i = 0; i < array.length; ++i)`样式循环）。

任何对象都可以具有与之关联的任意属性。特别是，将附加属性加载到数组实例上并没有什么可怕的。因此，想要*仅*查看索引的类数组属性的代码*必须*坚持使用整数索引。完全了解什么`for ... in`以及真正*需要*查看所有属性的代码，那也没关系。

* * *

## 回答 #14

> 赞同：10
> 
> 时间：2017-01-28T08:16:02.473

**TL&DR：**在数组中使用`for in`循环并不是坏事，事实上恰恰相反。

如果在数组中*正确*使用，我认为`for in`循环是 JS 的瑰宝。您应该完全控制您的软件并知道自己在做什么。让我们看看提到的缺点并一一反驳它们。

 *1.  **它还遍历继承的属性：**首先，对 的任何扩展都`Array.prototype`应该通过 using 完成，[`Object.defineProperty()`](https://developer.mozilla.org/tr/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty)并且它们的`enumerable`描述符应该设置为`false`. 根本不应该使用任何不这样做的库。
2.  **稍后添加到继承链中的属性会被计算在内：**`Object.setPrototypeOf`当按或按 Class进行数组子类化时`extend`。您应该再次使用`Object.defineProperty()`which 默认将`writable`,`enumerable`和`configurable`属性描述符设置为`false`。让我们在这里看一个数组子类化示例......

```
function Stack(...a){
  var stack = new Array(...a);
  Object.setPrototypeOf(stack, Stack.prototype);
  return stack;
}
Stack.prototype = Object.create(Array.prototype);                                 // now stack has full access to array methods.
Object.defineProperty(Stack.prototype,"constructor",{value:Stack});               // now Stack is a proper constructor
Object.defineProperty(Stack.prototype,"peak",{value: function(){                  // add Stack "only" methods to the Stack.prototype.
                                                       return this[this.length-1];
                                                     }
                                             });
var s = new Stack(1,2,3,4,1);
console.log(s.peak());
s[s.length] = 7;
console.log("length:",s.length);
s.push(42);
console.log(JSON.stringify(s));
console.log("length:",s.length);

for(var i in s) console.log(s[i]);
```

所以你看..`for in`循环现在是安全的，因为你关心你的代码。

3.  **`for in`循环很慢：**见鬼**。**如果您正在循环遍历不时需要的稀疏数组，这是迄今为止最快的迭代方法。这是人们应该知道的最重要的性能技巧之一。让我们看一个例子。我们将遍历一个稀疏数组。

```
var a = [];
a[0] = "zero";
a[10000000] = "ten million";
console.time("for loop on array a:");
for(var i=0; i < a.length; i++) a[i] && console.log(a[i]);
console.timeEnd("for loop on array a:");
console.time("for in loop on array a:");
for(var i in a) a[i] && console.log(a[i]);
console.timeEnd("for in loop on array a:");
```

* * *

## 回答 #15

> 赞同：9
> 
> 时间：2013-10-25T16:43:32.547

此外，由于语义，`for, in`处理数组的方式（即与任何其他 JavaScript 对象相同）与其他流行语言不一致。

```
// C#
char[] a = new char[] {'A', 'B', 'C'};
foreach (char x in a) System.Console.Write(x); //Output: "ABC"

// Java
char[] a = {'A', 'B', 'C'};
for (char x : a) System.out.print(x);          //Output: "ABC"

// PHP
$a = array('A', 'B', 'C');
foreach ($a as $x) echo $x;                    //Output: "ABC"

// JavaScript
var a = ['A', 'B', 'C'];
for (var x in a) document.write(x);            //Output: "012" 
```

* * *

## 回答 #16

> 赞同：8
> 
> 时间：2010-11-23T21:44:27.863

`for`/适用于两种类型的`in`变量：哈希表（关联数组）和数组（非关联）。

JavaScript 将自动确定其通过项目的方式。因此，如果您知道您的数组确实是非关联的，您可以使用`for (var i=0; i<=arrayLen; i++)`，并跳过自动检测迭代。

但在我看来，最好使用`for`/ `in`，自动检测所需的过程非常小。

对此的真正答案将取决于浏览器解析器/解释 JavaScript 代码的方式。它可以在浏览器之间更改。

我想不出不使用`for`/的其他目的`in`；

```
//Non-associative
var arr = ['a', 'b', 'c'];
for (var i in arr)
   alert(arr[i]);

//Associative
var arr = {
   item1 : 'a',
   item2 : 'b',
   item3 : 'c'
};

for (var i in arr)
   alert(arr[i]); 
```

* * *

## 回答 #17

> 赞同：8
> 
> 时间：2012-06-05T22:52:52.260

除了其他问题之外，“for..in”语法可能更慢，因为索引是字符串，而不是整数。

```
var a = ["a"]
for (var i in a)
    alert(typeof i)  // 'string'
for (var i = 0; i < a.length; i++)
    alert(typeof i)  // 'number' 
```

* * *

## 回答 #18

> 赞同：8
> 
> 时间：2013-05-10T18:20:26.337

一个重要的方面是`for...in`只迭代对象中包含的属性，这些属性的**可枚举** *属性属性*设置为 true。因此，如果尝试使用任何属性迭代对象，`for...in`则如果它们的可枚举属性属性为假，则可能会错过任意属性。很可能更改普通 Array 对象的可枚举属性属性，以便不枚举某些元素。尽管通常属性属性倾向于应用于对象内的函数属性。

可以通过以下方式检查属性的可枚举属性的值：

```
myobject.propertyIsEnumerable('myproperty') 
```

或者获取所有四个属性属性：

```
Object.getOwnPropertyDescriptor(myobject,'myproperty') 
```

这是 ECMAScript 5 中可用的功能 - 在早期版本中，无法更改可枚举属性的值（它始终设置为 true）。

* * *

## 回答 #19

> 赞同：7
> 
> 时间：2010-11-23T21:20:54.437

因为如果您不小心，它将遍历原型链上属于对象的属性。

您可以使用`for.. in`，只需确保使用[hasOwnProperty](https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object/hasOwnProperty)检查每个属性。

* * *

## 回答 #20

> 赞同：6
> 
> 时间：2010-11-23T21:25:07.287

这*不一定是*坏事（基于你在做什么），但在数组的情况下，如果添加了一些东西`Array.prototype`，那么你会得到奇怪的结果。您希望此循环运行 3 次的地方：

```
var arr = ['a','b','c'];
for (var key in arr) { ... } 
```

如果调用的函数`helpfulUtilityMethod`已添加到`Array`'s `prototype`，那么您的循环将最终运行四次：`key`分别是`0`、`1`、`2`和`helpfulUtilityMethod`。如果你只期待整数，哎呀。

* * *

## 回答 #21

> 赞同：6
> 
> 时间：2010-11-23T21:25:10.800

您应该使用`for(var x in y)`only on 属性列表，而不是对象（如上所述）。

* * *

## 回答 #22

> 赞同：6
> 
> 时间：2019-06-18T07:53:04.067

以下是为什么这是（通常）不好的做法的原因：

1.  `for...in`循环遍历它们自己的所有可枚举属性**及其**原型的可枚举属性。通常在数组迭代中，我们只想迭代数组本身。即使您自己可能不会向数组中添加任何内容，您的库或框架也可能会添加一些内容。

**示例**：

```
Array.prototype.hithere = 'hithere';

var array = [1, 2, 3];
for (let el in array){
    // the hithere property will also be iterated over
    console.log(el);
}
```

2.  `for...in`循环**不保证特定的迭代顺序**。尽管如今在大多数现代浏览器中通常可以看到顺序，但仍然没有 100% 的保证。
3.  `for...in`循环忽略`undefined`数组元素，即尚未分配的数组元素。

**示例**：：

```
const arr = []; 
arr[3] = 'foo';   // resize the array to 4
arr[4] = undefined; // add another element with value undefined to it

// iterate over the array, a for loop does show the undefined elements
for (let i = 0; i < arr.length; i++) {
    console.log(arr[i]);
}

console.log('\n');

// for in does ignore the undefined elements
for (let el in arr) {
    console.log(arr[el]);
}
```

* * *

## 回答 #23

> 赞同：5
> 
> 时间：2017-09-16T23:19:57.647

`for...in`对数组使用循环并没有错，尽管我可以猜到为什么有人告诉你：

1.) 已经有一个更高阶的函数或方法，它具有数组的目的，但具有更多的功能和更精简的语法，称为“forEach”：`Array.prototype.forEach(function(element, index, array) {} );`

2.) 数组总是有一个长度，但`for...in`不会`forEach`对任何值执行函数，即`'undefined'`仅对定义了值的索引执行函数。因此，如果您只分配一个值，这些循环只会执行一次函数，但由于枚举了一个数组，它的长度总是会达到具有定义值的最高索引，但是在使用这些时该长度可能会被忽视循环。

3.) 标准 for 循环将按照您在参数中定义的次数执行函数，并且由于数组是编号的，因此定义要执行函数的次数更有意义。与其他循环不同，for 循环可以为数组中的每个索引执行一个函数，无论该值是否已定义。

本质上，您可以使用任何循环，但您应该准确记住它们的工作方式。了解不同循环重复的条件、它们各自的功能，并意识到它们或多或少适用于不同的场景。

此外，通常认为使用该`forEach`方法比使用`for...in`循环更好，因为它更容易编写并且具有更多功能，因此您可能希望养成仅使用此方法和标准的习惯，但是您的称呼。

见下文，前两个循环只执行一次 console.log 语句，而标准 for 循环按指定的次数执行该函数，在这种情况下，array.length = 6。

```
var arr = [];
arr[5] = 'F';

for (var index in arr) {
console.log(index);
console.log(arr[index]);
console.log(arr)
}
// 5
// 'F'
// => (6) [undefined x 5, 6]

arr.forEach(function(element, index, arr) {
console.log(index);
console.log(element);
console.log(arr);
});
// 5
// 'F'
// => Array (6) [undefined x 5, 6]

for (var index = 0; index < arr.length; index++) {
console.log(index);
console.log(arr[index]);
console.log(arr);
};
// 0
// undefined
// => Array (6) [undefined x 5, 6]

// 1
// undefined
// => Array (6) [undefined x 5, 6]

// 2
// undefined
// => Array (6) [undefined x 5, 6]

// 3
// undefined
// => Array (6) [undefined x 5, 6]

// 4
// undefined
// => Array (6) [undefined x 5, 6]

// 5
// 'F'
// => Array (6) [undefined x 5, 6] 
```

* * *

## 回答 #24

> 赞同：4
> 
> 时间：2018-05-04T16:10:34.653

A for...in loop always enumerates the keys. Objects properties keys are always String, even the indexed properties of an array :

```
var myArray = ['a', 'b', 'c', 'd'];
var total = 0
for (elem in myArray) {
  total += elem
}
console.log(total); // 00123 
```

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2017-12-25T13:38:50.803

**for...in**在 JavaScript 中处理对象时很有用，但不适用于数组，但我们仍然不能说这是错误的方式，但不推荐使用**for...in**循环查看下面的示例：

```
let txt = "";
const person = {fname:"Alireza", lname:"Dezfoolian", age:35}; 
for (const x in person) {
    txt += person[x] + " ";
}
console.log(txt); //Alireza Dezfoolian 35 
```

好的，现在让我们用**Array**来做：

```
let txt = "";
const person = ["Alireza", "Dezfoolian", 35]; 
for (const x in person) {
   txt += person[x] + " ";
}
console.log(txt); //Alireza Dezfoolian 35 
```

如您所见，结果相同...

But let's try something, let's prototype something to **Array**...

```
Array.prototype.someoneelse = "someoneelse"; 
```

Now we create a new Array();

```
let txt = "";
const arr = new Array();
arr[0] = 'Alireza';
arr[1] = 'Dezfoolian';
arr[2] = 35;
for(x in arr) {
 txt += arr[x] + " ";
}
console.log(txt); //Alireza Dezfoolian 35 someoneelse 
```

You see the **someoneelse**!!!... We actually looping through new Array object in this case!

So that's one of the reasons why we need to use **for..in** carefully, but it's not always the case...

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2018-01-14T01:23:48.150

> Since JavaScript elements are saved as standard object properties, it is not advisable to iterate through JavaScript arrays using for...in loops because normal elements and all enumerable properties will be listed.

From [https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Indexed_collections](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Indexed_collections)

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2018-12-24T16:16:36.103

虽然这个问题没有具体解决，但我要补充一点，有一个很好的理由永远不要使用 for...in `NodeList`（因为它可以从`querySelectorAll`调用中获得，因为它根本看不到返回的元素，而是仅迭代 NodeList 属性。

在单一结果的情况下，我得到：

```
var nodes = document.querySelectorAll(selector);
nodes
▶ NodeList [a._19eb]
for (node in nodes) {console.log(node)};
VM505:1 0
VM505:1 length
VM505:1 item
VM505:1 entries
VM505:1 forEach
VM505:1 keys
VM505:1 values 
```

这解释了为什么我`for (node in nodes) node.href = newLink;`的失败。

# c# - .NET 框架中是否有针对不同 Web 方法类型（GET、PUT、POST、DELETE、HEAD）的常量？

> ID：500507
> 
> 赞同：15
> 
> 时间：2009-02-01T09:47:46.493
> 
> 标签：c#, .net, wcf, constants

我刚刚在创建 RESTful WCF 服务时注意到，`WebInvoke`属性上的 Method 参数区分大小写（需要大写字母）。

所以，

```
[WebInvoke(Method = "Delete")] 
```

不等于

```
[WebInvoke(Method = "DELETE")] 
```

这个错误导致`ProtocolException`：

> System.ServiceModel.ProtocolException：远程服务器返回意外响应：（405）方法不允许。

我想知道 .NET 框架中是否有一组常量，我应该在上面的示例中使用它们来代替“DELETE”。我当然可以定义自己的一组常量，但如果感觉就像框架中可能存在的东西，我只是想念它。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-01T09:54:09.103

有点间接，但有`System.Net.WebRequestMethods.Http`常数：

```
public const string Connect = "CONNECT";
public const string Get = "GET";
public const string Head = "HEAD";
public const string MkCol = "MKCOL";
public const string Post = "POST";
public const string Put = "PUT"; 
```

但没有“删除”-建议您自己制作...

令人讨厌的是，有一个`System.Web.HttpVerb`，但它是`internal`，所以不可用 - 而且它是一个枚举，所以要在属性中使用名称，你需要一些hackery。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2017-02-14T13:45:18.017

System.Web.Mvc 命名空间具有 HttpVerbs。 [https://msdn.microsoft.com/en-us/library/system.web.mvc.httpverbs(v=vs.118).aspx](https://msdn.microsoft.com/en-us/library/system.web.mvc.httpverbs(v=vs.118).aspx) 参考可以在Assemblies, Extensions下选择

# java - 为什么要在 Java 中的方法参数上使用关键字“final”？

> ID：500508
> 
> 赞同：427
> 
> 时间：2009-02-01T09:49:42.810
> 
> 标签：java, pass-by-reference, final, pass-by-value

我不明白在方法参数上使用`final`关键字时*真正*方便的地方。

如果我们排除匿名类的使用、可读性和意图声明，那么对我来说几乎毫无价值。

强制某些数据保持不变并不像看起来那么强大。

*   如果参数是原始参数，那么它将不起作用，因为参数作为值传递给方法并且更改它不会在范围之外产生任何影响。

*   如果我们通过引用传递参数，那么引用本身就是一个局部变量，如果引用是从方法内部更改的，那么从方法范围之外不会有任何影响。

考虑下面的简单测试示例。尽管该方法更改了给它的引用的值，但该测试通过了，但没有任何效果。

```
public void testNullify() {
    Collection<Integer> c  = new ArrayList<Integer>();      
    nullify(c);
    assertNotNull(c);       
    final Collection<Integer> c1 = c;
    assertTrue(c1.equals(c));
    change(c);
    assertTrue(c1.equals(c));
}

private void change(Collection<Integer> c) {
    c = new ArrayList<Integer>();
}

public void nullify(Collection<?> t) {
    t = null;
} 
```

* * *

## 回答 #1

> 赞同：302
> 
> 时间：2012-04-30T08:20:56.447

# 停止变量的重新分配

虽然这些答案在智力上很有趣，但我还没有阅读简短的简单答案：

> 当您希望编译器防止将变量重新分配给不同的对象时，请使用关键字*final 。*

无论变量是静态变量、成员变量、局部变量还是自变量/参数变量，效果都是完全一样的。

## 例子

让我们看看实际效果。

考虑这个简单的方法，其中两个变量（*arg*和*x*）都可以重新分配不同的对象。

```
// Example use of this method: 
//   this.doSomething( "tiger" );
void doSomething( String arg ) {
  String x = arg;   // Both variables now point to the same String object.
  x = "elephant";   // This variable now points to a different String object.
  arg = "giraffe";  // Ditto. Now neither variable points to the original passed String.
} 
```

将局部变量标记为*final*。这会导致编译器错误。

```
void doSomething( String arg ) {
  final String x = arg;  // Mark variable as 'final'.
  x = "elephant";  // Compiler error: The final local variable x cannot be assigned. 
  arg = "giraffe";  
} 
```

相反，让我们将参数变量标记为*final*。这也会导致编译器错误。

```
void doSomething( final String arg ) {  // Mark argument as 'final'.
  String x = arg;   
  x = "elephant"; 
  arg = "giraffe";  // Compiler error: The passed argument variable arg cannot be re-assigned to another object.
} 
```

故事的道德启示：

> 如果要确保变量始终指向同一个对象，请将变量标记为*final*。

## 从不重新分配参数

作为良好的编程习惯（在任何语言中），您不应该*将*参数/参数变量重新分配给调用方法传递的对象以外的对象。在上面的例子中，永远不要写这一行`arg =` 。既然人类会犯错，而程序员也是人，那就请编译器来帮助我们吧。将每个参数/参数变量标记为“最终”，以便编译器可以找到并标记任何此类重新分配。

## 回想起来

正如其他答案中所指出的......鉴于Java的最初设计目标是帮助程序员避免愚蠢的错误，例如读取数组末尾的内容，Java应该被设计为自动将所有参数/参数变量强制执行为“最终”。换句话说，*Arguments 不应该是 variables*。但事后看来是 20/20 的愿景，当时 Java 设计人员忙得不可开交。

# 所以，总是添加`final`到所有的论点？

我们应该添加`final`到每个声明的方法参数吗？

*   理论上，是的。
*   在实践中，没有。
    ➥`final`仅当方法的代码很长或很复杂时才添加，其中参数可能被误认为是局部变量或成员变量并可能重新分配。

如果您接受从不重新分配参数的做法，您将倾向于为`final`每个参数添加一个。但这很乏味，并且使声明更难阅读。

对于参数显然是参数，而不是局部变量或成员变量的简短简单代码，我不费心添加`final`. 如果代码非常明显，我或任何其他程序员都没有机会进行维护或重构意外地将参数变量误认为是参数以外的东西，那么不要打扰。在我自己的工作中，我`final`只添加了更长或更复杂的代码，其中参数可能被误认为是局部变量或成员变量。

#为了完整性添加了另一个案例

```
public class MyClass {
    private int x;
    //getters and setters
}

void doSomething( final MyClass arg ) {  // Mark argument as 'final'.

   arg =  new MyClass();  // Compiler error: The passed argument variable arg  cannot be re-assigned to another object.

   arg.setX(20); // allowed
  // We can re-assign properties of argument which is marked as final
 } 
```

# `record`

Java 16 带来了新的[记录](https://openjdk.java.net/jeps/395)功能。记录是定义一个类的一种非常简短的方法，该类的中心目的只是以不可变和透明的方式携带数据。

您只需声明类名及其成员字段的名称和类型。编译器隐式提供构造函数、getter、`equals`&`hashCode`和`toString`.

这些字段是只读的，没有设置器。所以 a`record`是一种不需要标记参数的情况`final`。它们实际上已经是最终的了。实际上，编译器`final`在声明记录的字段时禁止使用。

```
public record Employee( String name , LocalDate whenHired )  //  Marking `final` here is *not* allowed.
{
} 
```

如果你提供一个可选的构造函数，你*可以*在那里标记`final`.

```
public record Employee(String name , LocalDate whenHired)  //  Marking `final` here is *not* allowed.
{
    public Employee ( final String name , final LocalDate whenHired )  //  Marking `final` here *is* allowed.
    {
        this.name = name;
        whenHired = LocalDate.MIN;  //  Compiler error, because of `final`. 
        this.whenHired = whenHired;
    }
} 
```

* * *

## 回答 #2

> 赞同：237
> 
> 时间：2009-02-02T05:18:28.847

有时最好明确（为了可读性）变量不会改变。这是一个简单的示例，其中 using`final`可以节省一些可能的麻烦：

```
public void setTest(String test) {
    test = test;
} 
```

如果你忘记了 setter 上的 'this' 关键字，那么你想要设置的变量就不会被设置。但是，如果您在参数上使用`final`关键字，则错误将在编译时被捕获。

* * *

## 回答 #3

> 赞同：129
> 
> 时间：2009-02-01T09:54:45.683

是的，不包括匿名类、可读性和意图声明，它几乎毫无价值。这三样东西不值钱吗？

就个人而言，我倾向于不使用`final`局部变量和参数，除非我在匿名内部类中使用变量，但我当然可以看到那些想要明确参数值本身不会改变的人的观点（甚至如果它引用的对象改变了它的内容）。对于那些发现这增加了可读性的人，我认为这是一件完全合理的事情。

如果有人实际上声称它*确实*以某种方式保持数据不变，那么你的观点会更重要——但我不记得看到过任何这样的说法。您是在暗示有大量开发人员建议其`final`效果比实际效果更大吗？

编辑：我真的应该用 Monty Python 参考来总结所有这些；这个问题似乎有点类似于问“罗马人为我们做过什么？”

* * *

## 回答 #4

> 赞同：77
> 
> 时间：2009-02-01T11:23:51.980

让我解释一下你*必须*使用 final 的一种情况，Jon 已经提到过：

如果您在方法中创建匿名内部类并在该类中使用局部变量（例如方法参数），则编译器会强制您将参数设为 final：

```
public Iterator<Integer> createIntegerIterator(final int from, final int to)
{
    return new Iterator<Integer>(){
        int index = from;
        public Integer next()
        {
            return index++;
        }
        public boolean hasNext()
        {
            return index <= to;
        }
        // remove method omitted
    };
} 
```

这里的`from`and`to`参数需要是 final 的，所以它们可以在匿名类中使用。

该要求的原因是：局部变量存在于堆栈中，因此它们仅在方法执行时存在。但是，匿名类实例是从方法中返回的，因此它的寿命可能会更长。您不能保留堆栈，因为后续方法调用需要它。

因此，Java 所做的是将这些局部变量的*副本*作为隐藏的实例变量放入匿名类中（如果您检查字节码，您可以看到它们）。但如果它们不是最终的，人们可能会期望匿名类和方法看到另一个对变量所做的更改。为了保持只有一个变量而不是两个副本的错觉，它必须是最终的。

* * *

## 回答 #5

> 赞同：27
> 
> 时间：2009-02-01T15:20:09.693

我一直在参数上使用final。

加了那么多吗？并不真地。

我会把它关掉吗？不。

原因：我发现了 3 个错误，其中人们编写了草率的代码并且未能在访问器中设置成员变量。事实证明，所有错误都很难找到。

我希望看到这在未来的 Java 版本中成为默认值。通过值/引用传递的事情让很多初级程序员感到不安。

还有一件事.. 我的方法的参数数量往往很少，因此方法声明上的额外文本不是问题。

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2009-02-01T10:13:55.303

在方法参数中使用 final 与调用方参数发生的情况无关。它只是为了将它标记为在该方法内部没有改变。当我尝试采用更函数式的编程风格时，我看到了其中的价值。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-02-01T11:01:50.137

就我个人而言，我不会在方法参数上使用 final，因为它给参数列表增加了太多的混乱。我更喜欢强制方法参数不会通过 Checkstyle 之类的方法更改。

对于局部变量，我尽可能使用 final，我什至让 Eclipse 在我的个人项目设置中自动执行此操作。

我当然想要像 C/C++ const 这样更强大的东西。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2013-10-29T13:18:22.197

由于 Java 传递参数的副本，我觉得它的相关性`final`相当有限。我猜这个习惯来自 C++ 时代，您可以通过执行`const char const *`. 我觉得这种东西让你相信开发者天生就傻到他妈的，需要保护他真正输入的每一个字符。我可以谦虚地说，即使我省略了，我也写了很少的错误`final`（除非我不希望有人覆盖我的方法和类）。也许我只是一个老派的开发者。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-06-20T21:04:21.910

简短的回答：`final`有一点帮助，但是......在客户端使用防御性编程。

事实上，问题`final`在于它只强制**引用**不变，兴高采烈地允许被引用的对象成员发生变异，调用者不知道。因此，这方面的最佳实践是在调用方进行防御性编程，创建深度不可变的实例或对象的深层副本，这些对象有被不道德的 API 劫持的危险。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-01-07T16:08:33.677

我从不在参数列表中使用 final，它只是像以前的受访者所说的那样增加了混乱。同样在 Eclipse 中，您可以设置参数分配以生成错误，因此在参数列表中使用 final 对我来说似乎是多余的。有趣的是，当我为参数分配启用 Eclipse 设置时，它会生成一个错误，它捕获了这个代码（这就是我记忆流程的方式，而不是实际的代码。）：-

```
private String getString(String A, int i, String B, String C)
{
    if (i > 0)
        A += B;

    if (i > 100)
        A += C;

    return A;
} 
```

扮演魔鬼的拥护者，这样做到底有什么问题？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-02T05:42:40.373

将 final 添加到参数声明的另一个原因是，它有助于识别需要重命名为“提取方法”重构的一部分的变量。我发现在开始大型方法重构之前向每个参数添加 final 可以快速告诉我在继续之前是否需要解决任何问题。

但是，我通常在重构结束时将它们删除为多余的。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2016-03-17T18:33:39.823

跟进 Michel 的帖子。我给自己做了另一个例子来解释它。我希望它可以帮助。

```
public static void main(String[] args){
    MyParam myParam = thisIsWhy(new MyObj());
    myParam.setArgNewName();

    System.out.println(myParam.showObjName());
}

public static MyParam thisIsWhy(final MyObj obj){
    MyParam myParam = new MyParam() {
        @Override
        public void setArgNewName() {
            obj.name = "afterSet";
        }

        @Override
        public String showObjName(){
            return obj.name;
        }
    };

    return myParam;
}

public static class MyObj{
    String name = "beforeSet";
    public MyObj() {
    }
}

public abstract static class MyParam{
    public abstract void setArgNewName();
    public abstract String showObjName();
} 
```

从上面的代码中，在**thisIsWhy()**方法中，我们实际上**没有将**[ **argument MyObj obj]**分配给 MyParam中的**真实引用**。相反，我们只是在 MyParam 中的方法中使用**[argument MyObj obj]**。

但是在我们完成方法**thisIsWhy()**之后，***参数（对象） MyObj 是否还存在？***

似乎应该这样做，因为我们可以在 main 中看到我们仍然调用方法 **showObjName()**并且它需要到达**obj**。即使方法已经返回，MyParam 仍将使用/到达方法参数！

Java 真正实现这一点的方式是生成一个副本，也是MyParam 对象内部**参数 MyObj obj**的隐藏引用（但它不是 MyParam 中的正式字段，因此我们看不到它）

当我们调用“showObjName”时，它将使用该引用来获取相应的值。

但是，如果我们没有将参数放在 final 中，这会导致我们可以将新的内存（对象）重新分配给**参数 MyObj obj**。

**从技术上讲，根本没有冲突！**如果我们被允许这样做，情况如下：

1.  我们现在有一个隐藏的 [MyObj obj] 指向一个 [Memory A in heap] 现在存在于 MyParam 对象中。
2.  我们还有另一个 [MyObj obj]，它是指向 [Memory B in heap] 现在存在于 thisIsWhy 方法中的参数。

没有冲突，但**“令人困惑！”** 因为它们都使用**相同的“参考名称”，即“obj”**。

为避免这种情况，请将其设置为“最终”以避免程序员执行“容易出错”的代码。

# autotools - 如何为 GNU Autotools 重新配置大型程序

> ID：500534
> 
> 赞同：5
> 
> 时间：2009-02-01T10:09:00.523
> 
> 标签：autotools, autoconf, automake

我有一个用 C 编写的相当大的程序。它跨越多个文件，并进行了一些重组以试图弥补平台问题。具体来说，我有不同操作系统、体系结构和编译器的头文件，这些文件定义了它用来处理事情的宏。例如，`-v`标志打印版本信息，包括构建它的编译器的名称，以及构建它的操作系统和体系结构。举一个为什么它很重要的例子，程序可以创建一个 C 代码文件，如果你愿意，可以编译它 - 一个任务，它只是*对它*构建的任何编译器进行系统调用。

如果在您的系统上找到它，它还支持 GNU Readline 库（或 BSD Editline 库——同样的东西），如果您没有它，它还支持没有所有纯 ANSI 的 Readline 功能的等价物。

最重要的是，我不能去掉任何依赖于平台的位，因为几个函数在很大程度上取决于你拥有的操作系​​统/架构/编译器。我还想为拥有它的人提供良好的功能。我希望人们下载并安装它具有标准`./configure`和界面。`make``make install`

目前，我正在使用一个抱歉的手工 shell 脚本`configure`从头开始创建 Makefile，并根据您的操作系统/架构/编译器确定要包含哪些头文件。我想要一个更有效的方法，并且我想使用一个使用 GNU Autotools 的更标准的构建系统。这样我就知道我所做的事情可以在其他人的计算机上运行，​​而无需在他们的计算机上进行测试。

我的问题是，对于那些努力完成所有这些的人（谢谢！），我的问题是：1）我如何从自制构建系统切换到 GNU Autotools？2) 有哪些很好的 GNU Autotools 入门教程？3）我怎样才能使这个过程相对轻松？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-01T10:16:52.440

首先，您可以在项目的根目录中运行*自动扫描。*它将扫描项目树并生成*configure.scan*，同时尝试检测不可移植的功能。然后将其重命名为*configure.ac*，相应地对其进行编辑并编写*Makefile.am*文件。

我建议您在 GNU autotools 手册中查找此过程（尤其是*autoscan ）以获取详细信息。*它会减少您的工作量，但至少您不会从头开始创建这些文件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-03T19:52:51.737

这个链接是我在阅读这篇文章后用谷歌搜索的。它回答了我关于如何创建 ./configure 文件的问题。

[GNU 构建系统](http://www.adp-gmbh.ch/blog/2004/december/1.html)

# flash - 保存影片剪辑和动作脚本 - Flash 共享对象 LSO

> ID：500539
> 
> 赞同：1
> 
> 时间：2009-02-01T10:14:04.663
> 
> 标签：flash, actionscript, persistence, local-shared-object

我知道它可以将**对象**（以及所有子类、数组、字符串）保存到**[Flash LSO](http://en.wikipedia.org/wiki/Local_Shared_Object)**中，本地到用户的计算机。

是否可以保存**MovieClip**或**Function**？

我用 MovieClips 尝试过一次，但它只是将 MovieClip 的**引用**（指针）存储到 LSO 中，因此它无法再次检索整个 MovieClip 二进制数据。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T16:31:06.960

不能“复制”，也不能保存从 displayObject 继承的对象。

最好的解决方案是提取位图数据并将其保存并编写您自己的解析器来保存塑造影片剪辑的数据。除此之外我没有找到任何解决方案

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-27T22:32:04.377

您需要编写自己的 deepCopy 函数版本。这个函数应该内省你的 MovieClip 并记住它的所有属性和当前状态，以及使用 getQualifiedClassName() 记录类名。然后，您可以将所有这些信息保存到 LSO，以便稍后重建或复制该对象。

当你需要重组它时，你会做相反的事情。获取 LSO，创建一个相同类型的新对象并将其所有属性设置为您之前记录的已保存状态。

您可以研究的另一件事是将对象保存到字节数组中，但这不会保存对象的类型，并且可能会给您带来其他问题。

# object - 对象实例的动态属性？

> ID：500540
> 
> 赞同：1
> 
> 时间：2009-02-01T10:15:03.787
> 
> 标签：object, dynamic, model, properties

在上一个问题“对象模型设计中的重要规则是什么”之后，现在我想问这个：

**有没有办法让类实例具有动态属性？**

假设我们有这个示意图对象模型：

![对象模型](https://i.stack.imgur.com/EAwrg.gif)

因此，每个对象都可能由于实现的接口集而具有许多属性，然后成为相对较重的对象。创建所有可能的——当然也是合理的——对象可以是解决这个问题的一种方法*（即 Pipe_Designed vs Pipe_Designed_NeedInspection）*，但我现在有大量的接口，这使得它变得困难。我想知道是否有办法拥有动态属性，类似于以下对话框，以允许最终用户为他/她的新对象选择可用功能。

![对话](https://i.stack.imgur.com/9L9nz.gif)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-01T10:18:13.407

你想要的是`Properties pattern`. 查看[Steve Yegge 的冗长而无聊但聪明的文章](http://steve-yegge.blogspot.com/2008/10/universal-design-pattern.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T10:19:18.520

如果您指的是公共属性的数量，请使用显式接口实现。

如果您指的是字段（以及稀疏对象的对象空间）：您始终可以使用属性包来实现属性。

对于 C# 示例：

```
string IDesigned.ApprovedBy {
    get {return GetValue<string>("ApprovedBy");}
    set {SetValue("ApprovedBy", value);}
} 
```

带有值的字典：

```
readonly Dictionary<string, object> propValues =
    new Dictionary<string, object>();
protected T GetValue<T>(string name)
{
    object val;
    if(!propValues.TryGetValue(name, out val)) return default(T);
    return (T)val;
}
protected void SetValue<T>(string name, T value)
{
    propValues[name] = value;
} 
```

请注意，`SetValue`这也是任何通知的好地方——例如，`INotifyPropertyChanged`在 .NET 中实现观察者模式。许多其他架构也有类似的东西。您可以对对象键执行相同的操作（例如如何`EventHandlerList`工作），但字符串键更易于理解；-p

这只会占用与正在使用的属性一样多的空间。

最后一个选择是封装各个方面；

```
class Foo {
    public bool IsDesigned {get {return Design != null;}}
    public IDesigned Design {get;set;}
    // etc
} 
```

这里`Foo`没有实现任何接口，但提供了对它们作为属性的访问。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-01T10:21:05.257

我认为您可能在“Road”和“Pipe”类中添加了太多角色，因为您对动态属性的需求似乎源自模型中工件的各种状态/阶段。我会考虑使用与不同类的关联来创建一个显式模型，而不是使用接口将所有内容放在“Road”或“Pipe”类中。

# c# - C# 网络编程和资源使用

> ID：500551
> 
> 赞同：7
> 
> 时间：2009-02-01T10:23:39.777
> 
> 标签：c#, .net, network-programming, using-statement

我一直在研究如何最好地用 C# 编写“正确”的网络代码。

我已经看到了许多使用 C# 的“using”语句的示例，我认为这是一个很好的方法，但是我看到它在各种表达式中的使用不一致。

例如，假设我有一些这样的代码：

```
TcpClient tcpClient = new TcpClient("url.com", 80);
NetworkStream tcpStream = tcpClient.GetStream();
StreamReader tcpReader = new StreamReader(tcpStream);
StreamWriter tcpWriter = new StreamWriter(tcpStream); 
```

显然，这段代码将非常不稳定。所以，我看到了一些将 using 放在 tcpClient 上的代码，这看起来不错。但是，NetworkStream 不是也有需要清理的资源吗？StreamReader/Writer 呢？

我是否需要将所有 4 个语句包装在嵌套的 using 语句中？

如果是这样，到了处置的时候会发生什么？StreamWriter 不会关闭流并因此关闭套接字吗？那么当 StreamReader、NetworkStream 和 TcpClient 分别处理它们时会发生什么？

这就引出了另一个问题。StreamReader 和 StreamWriter 都由同一个流组成，谁拥有它？难道他们不都认为自己拥有它，因此都试图摧毁它吗？或者框架是否知道流已经被销毁并且只是默默地忽略它？

似乎 using 语句仅对链中的最后一条语句是必需的，但是如果在 GetStream() 中抛出异常会发生什么？我认为它不会正确清理套接字，因此似乎有必要使用多余的使用来确保不会发生这种情况。

有没有人知道任何关于使用 .net 进行网络编程的好书，最好是 c#，其中包括关于异常处理和资源管理的章节？或者网上有什么好文章？我能找到的所有书籍都来自 .NET 1.1 时代（Microsoft .NET Framework 的网络编程、.NET 中的网络编程等），所以这似乎是一个需要一些好的资源的主题。

编辑：

请不要让马克的非常好的评论阻止其他人对此发表评论:)

我想听听其他人关于资源管理的书籍推荐或意见，尤其是在异步使用方面。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-01T10:32:50.570

一般来说，对象应该在内部处理多次`Dispose()`调用，并且只做一次主代码；`Dispose()`所以多次获得 d 的流通常不是问题。就个人而言，我会在`using`那里使用很多；请注意，您不需要缩进/嵌套，但（除非不同级别有不同的生命周期）：

```
using(TcpClient tcpClient = new TcpClient("url.com", 80))
using(NetworkStream tcpStream = tcpClient.GetStream())
using(StreamReader tcpReader = new StreamReader(tcpStream))
using(StreamWriter tcpWriter = new StreamWriter(tcpStream))
{
   ...
} 
```

正如您所说，这可以确保如果在初始化期间发生错误，仍然可以正确清理所有内容。这也确保每个级别都有机会（以正确的顺序）正确处理任何缓冲数据等。

重新所有权；`NetworkStream`实际上首先是一个奇怪的东西......大多数流都是**输入**异**或**输出。`NetworkStream`弯曲一些规则并将两个方向填充到一个 API 中；所以这是一个例外......通常所有权会更清楚。此外，许多包装器都有一个标志来确定它们是否应该关闭包装的流。`StreamReader`没有，但有些有（例如`GZipStream`，它有一个`leaveOpen`ctor 选项）。如果您不想流动所有权，这是一个选项 - 或使用非关闭流中介 -[这里](http://www.pobox.com/~skeet/csharp/miscutil/#)有一个（`NonClosingStream`或类似的）。

重新书籍；我拿起了一份“C# 中的 TCP/IP 套接字：程序员实用指南”（[这里](http://www.amazon.co.uk/exec/obidos/ASIN/0124660517)）——足够了，但不是很好。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-02T14:25:04.130

如果一个对象支持 IDisposable，最好将它放在 using {} 块中，因为 dispose 方法会自动为您调用。这也可以减少您的代码。重要的是要注意使用“使用”不处理任何异常。如果您想处理任何错误，您仍然必须这样做。一旦 using 块超出范围，您的对象也是如此。

```
Old Style Code

object obj;

try
{
   obj= new object();
   //Do something with the object
}
catch
{
   //Handle Exception
}
finally
{

  if (obj != null)
  {  
     obj.Dispose();
  }
}  

Newer Style Code

try
{   
  using (object obj = new object())
  {
     //Do something with the object
  }
catch
{
   //Handle Exception
} 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-04-06T07:34:08.650

插座呢？可以这样做吗：

```
serverSocket = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
serverSocket.Connect(serverEndPoint, m_NegotiationPort);
.
.
.
serverSocket.Close(); 
```

或更好

```
using (Socket serverSocket = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp)
{
.
.
.
} 
```

# javascript - Internet Explorer 7 的 CSS 翻转问题

> ID：500569
> 
> 赞同：1
> 
> 时间：2009-02-01T10:39:53.410
> 
> 标签：javascript, css, internet-explorer

我在我的 HTML 代码中编写了一些 CSS 来创建翻转按钮。然后我尝试用 IE 7 运行它，结果大吃一惊！它不运行。事实上，它同时显示了按钮和底层翻转。如何解决 IE 无法缓存背景图片的问题？最好使用 CSS，但会尝试使用 javascript。

示例 CSS：

```
 #Menu 
 { 
    width: 100%; 
    height: 32px; 
    margin-top: 93px;
    padding-left: 13px;
}

 #Menu a 
{ 
    height: 32px; 
    line-height: 32px; 
    width: 123px; 
    background: url("img/menu.png") top left no-repeat; 
    background-position: -123px 0; 
    float: left; 
    margin-left: 3px; 
    text-decoration: none; 
    color: #1e1e1d; 
    font-size: 12px; 
    text-align: center; 
}

 #Top #Menu a:hover, #Top #Menu a.active 
{ 
    background-position: 0px 0; 
    text-decoration: underline;
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-01T15:54:10.747

那么首先你给出的指令相互矛盾......

```
background: url("img/menu.png") top left no-repeat;
background-position: -123px 0; 
```

...背景已经使用速记定位。

我假设您的常规状态和悬停状态都共享相同的图像，那么为什么不同时使用速记呢？消除...

> 背景位置：-123px 0；

...对于您的悬停和活动状态，请使用 ...

```
background-position: bottom left; 
```

然后将您的两种状态都放在一张图片中，一张在另一张图片下方（我认为这是您一直在尝试的）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-12-05T17:59:35.817

图像翻转问题主要是因为每次悬停链接或选项卡时都会下载图像。此闪烁是由删除主图像和加载翻转图像时的延迟引起的（即使它们在技术上是相同的图像，Internet Explorer 更愿意将它们分开处理）。

查看翻转问题的完整修复：http: [//faqspoint.blogspot.com/2011/12/ie-rollover-problem.html](http://faqspoint.blogspot.com/2011/12/ie-rollover-problem.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T11:25:41.523

如果你使用 :hover 伪选择器，那么它在 IE 中不起作用，除非它是一个锚标记。尝试将按钮更改为锚点。您仍然可以使用 css 使它看起来像一个按钮。

如果你想使用 javascript，那么看看[jQuery](http://docs.jquery.com/)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-01T13:55:42.423

尝试确保您的 CSS`background`语法正确。某些浏览器允许您以任何顺序指定属性，但 IE 会阻塞。您应该以 XY 形式指定附件（水平然后垂直）。您目前拥有`top left`. 让它`left top`。你也有`no-repeat`在行尾，它应该在 url 声明之后和位置声明之前。

CSS 背景速记值的顺序应该是：

*   背景颜色
*   背景图片
*   背景重复
*   背景位置
*   背景附件

例如。`background: #fff url(example.jpg) no-repeat left top fixed;`

# c# - 手动实现 UpdatePanel

> ID：500576
> 
> 赞同：2
> 
> 时间：2009-02-01T10:48:08.853
> 
> 标签：c#, asp.net, javascript, ajax, updatepanel

我正在阅读一篇文章，其中展示[了 CodePlex 使用 UpdatePanels 的糟糕](http://encosia.com/2008/12/03/have-you-ever-wondered-why-codeplex-is-so-slow/)程度以及 StackOverflow 在这方面的表现如何，例如，当用户对答案/问题进行投票时。

我想知道是否有人可以指出如何执行此类操作的教程。

我知道几点：

1.  创建一个获取操作值并输出 JSON 字符串的 Web 服务
2.  构建 javascript 内部`<ajax:ScripManager>`控件以用新值替换页面上的正确值

但是，即使在第一次遇到困难时，我也可以发送一个 JSON 字符串，但它总是会被 XML 信息包围！

任何人（或者杰夫）都可以从头开始指出一个很好的“操作方法”吗？谢谢你。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-01T10:54:58.573

好吧，我怀疑`StackOverflow`使用`UpdatePanel`- 更有可能它使用[jQuery / load](http://docs.jquery.com/Ajax/load)来简单地更新 div，使用 ASP.NET MVC 作为源（而不是 ASP.NET vanilla，它具有更复杂的页面周期）。

使用这种方法，它是微不足道的...... jQuery 示例选项卡在很大程度上说明了一切。

重新返回 Json——这只是`return Json(obj);`来自 ASP.NET MVC 中的控制器——但我个人会返回 html（更简单）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-01T10:58:49.767

在您关闭 UpdatePanel 之前，我建议您阅读我所做的这篇文章 - [http://www.aaron-powell.com/blog/august-2008/optimising-updatepanels.aspx](http://www.aaron-powell.com/blog/august-2008/optimising-updatepanels.aspx)。它着眼于如何优化 UpdatePanels，如果做得好，它可以带来一些性能提升。

我还发表了一篇文章 - [http://www.aaron-powell.com/blog/august-2008/paging-data-client-side.aspx](http://www.aaron-powell.com/blog/august-2008/paging-data-client-side.aspx)，它着眼于使用 jQuery 和 MS AJAX 进行客户端模板。我将了解如何使用 JavaScript 读取 Web 服务，如果您下载示例，您将了解如何将数据客户端发送到 Web 服务。

但是 ASP.NET 网站上的这个视频也可能有用 - [http://www.asp.net/learn/ajax-videos/video-82.aspx](http://www.asp.net/learn/ajax-videos/video-82.aspx)。它是关于如何为脚本服务功能扩展 Web 服务的。

# python - 在 python 生成器上调用 next 是否有另一种方法？

> ID：500578
> 
> 赞同：4
> 
> 时间：2009-02-01T10:48:46.543
> 
> 标签：python, language-features

我有一个生成器，我想知道是否可以使用它而不必担心 StopIteration ，我想在没有**`for item in generator`**. 例如，我想将它与 while 语句（或其他构造）一起使用。我怎么能那样做？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-01T11:12:53.937

内置函数

> next(iterator[, default])
> 通过调用迭代器的方法从迭代器中检索下一项`__next__()` 。如果给出默认值，则在迭代器耗尽时返回，否则引发 StopIteration。

在 Python 2.5 及更早版本中：

```
raiseStopIteration = object()
def next(iterator, default=raiseStopIteration):
    if not hasattr(iterator, 'next'):
       raise TypeError("not an iterator")
    try:
       return iterator.next()
    except StopIteration:
        if default is raiseStopIteration:
           raise
        else:
           return default 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-01T12:16:35.897

另一种选择是一次读取所有生成器值：

```
>>> alist = list(agenerator) 
```

例子：

```
>>> def f():
...   yield 'a'
...
>>> a = list(f())
>>> a[0]
'a'
>>> len(a)
1 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-01T11:13:09.177

使用它来包装你的生成器：

```
class GeneratorWrap(object):

      def __init__(self, generator):
          self.generator = generator

      def __iter__(self):
          return self

      def next(self):
          for o in self.generator:
              return o
          raise StopIteration # If you don't care about the iterator protocol, remove this line and the __iter__ method. 
```

像这样使用它：

```
def example_generator():
    for i in [1,2,3,4,5]:
        yield i

gen = GeneratorWrap(example_generator())
print gen.next()  # prints 1
print gen.next()  # prints 2 
```

**更新：**请使用下面的答案，因为它比这个要好得多。

# visual-c++ - 在 C++/CLI 中，帽子字符 ^ 有什么作用？

> ID：500580
> 
> 赞同：45
> 
> 时间：2009-02-01T10:50:59.533
> 
> 标签：visual-c++, c++-cli, clr

我正在阅读 Ivor Horton 的《Beginning Visual C++ 2008》，它的许多 CLR 示例都对 main 有以下定义：

```
int main(array<System::String ^> ^args) 
```

我一页一页地回到书的开头，找到了第一个这样的例子，并解释了它的真正含义，但找不到。

显然它的含义与 standard 相同`int main(int argc, char *argv[])`，但我想知道何时以及为什么`^`真正使用它，以及它为什么存在（它是否做了指针`*`和引用`&`无法表示的事情）？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-02-01T10:56:29.397

它是一个托管指针 - 而 * 标记指向非托管对象的指针， ^ 指向垃圾收集对象（由框架处理）。阅读[本文](http://msdn.microsoft.com/en-us/library/cxx6f46y.aspx)以获取有关 .NET 中处理指针的方式的更多信息。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-02-01T11:26:06.467

除此之外，在 C++/CLI 中，托管指针与普通指针分开处理，因此您甚至可以使用不同的关键字分配它们：

```
NativeObject* n = new NativeObject();
ManagedObject^ m = gcnew ManagedObject(); 
```

托管对象和本机对象是两个完全不同的东西，您不能混合使用它们（嗯，不容易）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T10:56:07.480

完整讨论请参见： http: [//msdn.microsoft.com/de-de/library/yk97tc08.aspx](http://msdn.microsoft.com/de-de/library/yk97tc08.aspx)：

> 托管堆上对象的句柄指向“整个”对象，而不是对象的成员。

# flash - 使用 ActionScript 2 模拟 ByteArrays？

> ID：500581
> 
> 赞同：1
> 
> 时间：2009-02-01T10:51:34.930
> 
> 标签：flash, actionscript-3, actionscript-2, bytearray

可以通过任何介质读取**原始二进制数据的 AS3** [ByteArray](http://livedocs.adobe.com/flex/2/langref/flash/utils/ByteArray.html)的替代品吗？

 **也许加载一个 TXT 文件并逐字节访问**字符？**有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-02T08:36:51.783

搜索**base64** - 就是这样做的。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-02-01T11:02:47.140

“Socket 类使 ActionScript 代码能够建立套接字连接并读取和写入原始二进制数据。它类似于 XMLSocket，但不规定接收或传输数据的格式。”

# asp.net - 如何在 .NET 中实现 PodPress（就像 StackOverflow 博客一样）

> ID：500582
> 
> 赞同：5
> 
> 时间：2009-02-01T10:52:35.380
> 
> 标签：asp.net, podcast

我想知道是否有人知道如何将[PodPress](http://www.mightyseek.com/podpress/)（一个 Wordpress 插件）的漂亮和干净的 UI 实现到 .NET 中，就像您在PodCast可用时在[StackOverflow 博客中找到的那样。](http://blog.stackoverflow.com)

[![替代文字](https://i.stack.imgur.com/EYBG6.png)](https://i.stack.imgur.com/EYBG6.png)

并且有很好的统计数据和 iTunes 集成:)

**补充**：我现在意识到（愚蠢的我没有先检查 - 使用元键甚至去管理页面.../wp-admin）SO博客在Wordpress上，但我的愿望仍然是一样的，怎么样.NET 版本？我想我会直接联系作者并为他/她推荐一个 .NET 版本的 WP 插件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T03:40:40.790

> 我想知道是否有人知道如何将 PodPress（一个 Wordpress 插件）的漂亮和干净的 UI 实现到 .NET 中，就像您在 PodCast 可用时在 StackOverflow 博客中找到的那样。
> 我正在寻找整瓶魔法、iTunes 集成、统计信息等... Jeff 不应该给出答案吗，他必须为此做点什么？

Jeff 没有将 PodPress 转换为 .NET。

blog.Stackoverflow.com 是一个 Wordpress 博客。

他只需为 Wordpress 加载 PodPress 插件，在他的插件选项卡中单击激活并导航到他新创建的 PodPress 选项卡。他在那里配置了他的 iTunes 集成和统计信息。

如果您查看博客的来源，您会看到：

> ```
> <meta name="generator" content="WordPress 2.7" /> 
> ```

* * *

编辑：回复您的评论。

> 是的，我意识到之后，但仍然......我想要一个 .NET 版本:)（没什么好问的，是吗？） eheh ;) – balexandre

PodPress-WordPress 插件与 WordPress 插件接口紧密耦合。PodPress 是 flash、javascript 和 php 的混合体，所有这些都调用 WordPress 函数。

PHP 和 Javascript 很容易编辑，但破解 PodPress 以在没有 WordPress 的情况下工作所需的工作可能比简单地从头开始重写 PodPress 更困难一些。

此外，我在许多论坛上读到有关人们从项目的唯一开发人员那里得到缓慢的响应以及如何发布需要很长时间才能发布的信息。所以我认为你不能轻易让他将他的项目重写到不同的平台上。

您的选择是：

*   使用 WordPress
*   从头开始重写 PodPress，无需任何 WordPress 依赖。
*   寻找替代方案

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-04T15:57:48.663

我认为这个问题没有简单的答案。podPress 是一个相当大的插件，将其移植到新的语言和博客引擎是很困难的；它不仅仅是一个技巧。我想包含的 Flash 和 Java 播放器以及支持的 JavaScript 已获得许可，因此您可以在项目中使用它们。（podPress 是 GPL）

现在，StackOverflow 博客使用 WordPress 和 podPress，而不是用 .NET 编写的东西，所以我敢打赌，实际上没有人做过这项工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-04T14:15:36.983

魔法发生在 Flash 播放器内部，因此您需要做的就是将 Flash 播放器放在一个 aspx 页面（或 ascx 控件）中，并提供适当的变量，如文件名和音频位置。

这能回答问题还是我错过了什么？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-04T15:42:15.670

好吧，对于播放器部分，您可以使用 Yahoo! 音乐播放器：http: [//mediaplayer.yahoo.com/](http://mediaplayer.yahoo.com/)

我知道这并不是您想要的，因为您想要 PodPress 的所有功能，但是，我想这可能是一个小的踏脚石/起点。它真的很容易使用，而且它是一个体面的界面。

# javascript - JavaScript Object Literals & Array Literals

> ID：500583
> 
> 赞同：12
> 
> 时间：2009-02-01T10:52:39.607
> 
> 标签：javascript

What is the difference between Object Literals and Array Literals in JavaScript? I know it has something to do with the length method but i don't fully understand it.

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-01T10:57:36.667

[Mozilla.org](https://developer.mozilla.org/en/Core_JavaScript_1.5_Guide/Core_Language_Features#Literals) has very good explanation of the different literals with examples.

> **Array Literals**
> 
> An array literal is a list of zero or more expressions, each of which represents an array element, enclosed in square brackets ([]). When you create an array using an array literal, it is initialized with the specified values as its elements, and its length is set to the number of arguments specified.
> 
> **Object Literals**
> 
> An object literal is a list of zero or more pairs of property names and associated values of an object, enclosed in curly braces ({}). You should not use an object literal at the beginning of a statement. This will lead to an error or not behave as you expect, because the { will be interpreted as the beginning of a block.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-01T11:00:48.780

The difference is the way they're indexed.
Objects have name, value pairs which are not ordered. In some browsers the order you added values will be the order you get when you traverse the object but not in all. The name is usually a string.
Arrays are numerically indexed and the order is totally reliable

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-03-23T16:20:20.520

Object literal

```
var a = {}; 
```

Array Literal

```
var a = []; 
```

That's it!

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-10-08T10:48:20.343

PHP's numeric array becomes an array literal or object literal in JavaScript

```
$ar = array('apple', 'orange', 'banana', 'strawberry');

echo json_encode($ar); // ["apple","orange","banana","strawberry"] - Array literal

echo json_encode($ar, **JSON_FORCE_OBJECT**); // {"0":"apple","1":"orange","2":"banana","3":"strawberry"} - Object Literal 
```

PHP's associative array becomes an object literal in JavaScript

```
$book = array(
         "title" => "JavaScript: The Definitive Guide",
         "author" => "David Flanagan",
         "edition" => 6
        );

echo json_encode($book); // {title: "JavaScript: The Definitive Guide", author: "David Flanagan", edition: 6} - Object Literal 
```

# web-services - 向服务器注册新应用程序实例的安全方法

> ID：500586
> 
> 赞同：1
> 
> 时间：2009-02-01T10:56:10.210
> 
> 标签：web-services, security

我有一个客户端/服务器应用程序，我想知道在服务器上实现新客户端注册的安全方法是什么。

到目前为止，我有以下内容：

用户从他们的网站下载客户端并安装它。在安装期间，客户端向服务器注册并接收密钥（证书）。然后使用该密钥对每个后续客户端请求进行加密/签名。

我的问题是如何保护初始交易？如何确保我没有黑客欺骗注册请求、欺骗我的服务器和耗尽我的服务器资源？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-01T20:18:47.267

一个简单的验证码可能足以防止黑客创建虚假注册。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T06:16:47.247

您是否考虑过使用 https？Https（[http over SSL](http://www.modssl.org/docs/2.8/ssl_intro.html)）可以帮助防止黑客欺骗请求，让您在客户端和服务器之间安全地交换消息。这将消除您拥有加密/解密消息的密钥的需要。

认证必须单独处理。虽然 https 可以防止窃听，但如果您希望将访问服务器的权限限制为已识别的用户，则需要使用例如用户名和密码来实现身份验证机制。也许作为您网站初始注册的一部分，用户需要创建一个用户帐户。要使用您网站上的服务，用户将需要提交有效的凭据（用户名/密码），您可以对照数据库进行检查。

如果您愿意花一些时间阅读这个主题，这里是另一个有用的[链接。](http://www.cgisecurity.com/owasp/html/)

# php - 域重定向和暂停

> ID：500601
> 
> 赞同：0
> 
> 时间：2009-02-01T11:07:56.660
> 
> 标签：php, dns, subdomain, redirect

我有一个用 ASP.NET 开发的网站，并使用 godaddy 的共享 Windows 托管帐户托管在 Windows 服务器上。

我用 php 开发了我的网站的副本，并将我的 php 网站托管在免费托管服务（php、linux、mysql）上，并且运行良好。这是在共享子域上。示例（mysite.freehostprovider.com）

现在我想继续使用免费托管服务。所以我希望我的网站从 www.mysite.com 重定向到 mysite.freehostprovider.com

因为我还没有为 Windows 主机付费。他们已停止托管我的网站。但是我的域名有效期到 2010 年。我需要做什么才能看到我的网站上线@www.mysite.com

我的免费托管服务提供商支持重定向。我试过但没有成功。

任何帮助将不胜感激。

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-01T11:14:57.193

理想情况下，您会将 www.mysite.com 命名为 mysite.freehostprovider.com，但免费的托管服务提供商可能不允许您这样做（他们将使用虚拟主机，因此您不能继续这样做）。

您可能应该再次进行重定向。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T03:50:09.710

您需要从您的域注册商启用转发或重定向。如果您使用的是 GoDaddy，请查看此支持文章（第 4 页）的“转发域”部分：http: [//help.godaddy.com/article/2227](http://help.godaddy.com/article/2227)

# macos - OS X 终端：同时使用元键 + alt 功能

> ID：500602
> 
> 赞同：38
> 
> 时间：2009-02-01T11:08:55.240
> 
> 标签：macos, emacs, keyboard, terminal

有没有办法使用`alt`/`option`键作为元键但仍然可以使用它来制作一些需要它的字符？

例如，在我的本地键盘布局中：

*   `@`是`alt`+`2`
*   `\`是`alt`+ `shift`+`7`
*   `|`是`alt`+`7`
*   等等

所以，如果我设置`alt`为元键，我就不能再制作这些字符了。另一方面，使用“按esc，释放esc，按一个键”来制作元键序列让我的手受伤。

任何使用国际键盘的 Emacs 用户已经解决了这个问题，请提供您可能有的任何提示！:)

**编辑：**

看来我可以设置`alt`为元键，然后在 inputrc 中添加这些类型的设置：`"\e2": "@"`这在 bash shell 中有效，但它仍然不适用于 Emacs，所以不好。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2010-08-03T17:55:46.127

我在 Mac OS X 中使用瑞典语键盘，并为 Emacs.app 使用以下设置：

首先，我安装了[KeyRemap4MacBook](http://pqrs.org/macosx/keyremap4macbook/index.html)，并将其设置为将左 Option 键更改为 Command。

然后我的 .emacs 中有以下内容：

```
(setq mac-option-modifier 'none)
(setq mac-command-modifier 'meta) 
```

这使得 Emacs 将 command 视为 Meta 而忽略 Option。由于左 Alt/Option 键被重新映射到命令，这使得它可以在 lite meta 中工作，而右 Alt/Option 键仍然可以用于输入特殊字符，如 @ [] 和 {}。

Cmd+C 和 Cmd+V 等应用程序特定的 Mac 快捷方式不再有效，但用于 Spotlight 的 Cmd+space 和用于应用程序切换的 Cmd+Tab 等全局快捷方式可以。

**更新：** 如果你使用[iTerm2](http://sites.google.com/site/iterm2home/)作为终端，它只支持将左 Alt/Option 键映射到 meta，这意味着你仍然可以使用右 AltGr/Option 键来输入特殊字符。这也意味着您可以在 iTerm2 终端中运行的 Emacs 中正常使用 meta。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2011-02-20T12:00:04.660

我的 Mac 上有瑞典语键盘，我正在使用 Aquamacs。添加这两行（归属于 Joakim Hårsman）

```
(setq mac-option-modifier 'none)
(setq mac-command-modifier 'meta) 
```

in `.emacs`（并重新启动 Aquamacs）对我有用。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2011-09-09T19:51:22.850

使用[iTerm2](http://www.iterm2.com/)，您可以将左选项键映射到 ESC/meta，并将右选项键的映射保留为“正常”。这样您就可以使用正确的选项键来键入重音等。

![iTerm2 首选项](https://i.stack.imgur.com/diFm7.png)

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-02-13T09:35:30.490

考虑为 Mac OS X 使用功能齐全的 Emacs。我使用的是 Carbon Emacs，但我相信其他人（比如 Aqua Emacs 或 X11 Emacs）会做到这一点。

如果您坚持在终端中使用 Emacs，您可以使用`C-x 8`前缀作为组合键。尝试`C-x 8 C-h`获取可能性列表。

请参阅[http://www.emacswiki.org/emacs/EmacsForMacOS](http://www.emacswiki.org/emacs/EmacsForMacOS)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-02-01T13:34:56.113

我使用的两种解决方法：

*   我使用在 X11.app 下运行的 xterm。X11.app 使用命令键作为元。
*   在 Terminal.app 中运行 emacs 时，我只使用 rfc1345 输入法，它允许我输入各种疯狂的非 ascii 字符，而无需选项键。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2010-04-08T11:28:34.427

查看 cmd-key-happy。这个小应用程序为我创造了奇迹。它允许您将命令用作元，您可以配置例外。

作者信息如下：

该程序允许您在任何应用程序中交换命令和 alt（或选项）键，尤其是 Terminal.app。

[http://github.com/aim-stuff/cmd-key-happy](http://github.com/aim-stuff/cmd-key-happy)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2011-09-02T13:30:59.500

这是一篇旧帖子，但添加了可供机器人查找的替代品。我从 Aquamacs 借了几个文件（emulate *-mac-keyboard-mode.el, aquamacs-tools.el*）来解决这个问题（我有一个意大利专业键盘）：

```
(defun aq-binding (any)
 nil)
(load  "~/.emacs.d/emulate-mac-keyboard-mode.el") ;;  'noerror 
```

这提供了：

*   少数次要模式（***emulate-mac-italian-keyboard-mode、emulate-mac-french-keyboard-mode、mulate-mac-swiss-german-keyboard-mode***等）
*   使用 Aquamacs 提供的所有选项的菜单

用 Emacs-23.3-universal-10.6.6 测试，似乎对我来说没问题。

感谢 Aquamacs，如果还没有完成，那么将它推向上游怎么样。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2011-02-14T16:28:20.217

## 带有选项死键的特殊键盘布局

我对这个问题的解决方案是我编写的特殊键盘布局，[US custom](http://uscustom.sf.net/)。它提供了一个选项[死键](http://en.wikipedia.org/wiki/Dead_key)，无需使用物理`⌥ Option`修饰键即可生成选项组合。例如，字符 ⟨ç⟩ 在正常的美式键盘布局中产生如下：

*   点击`⌥ Option`+ `c`。

美国*自定义*键盘布局添加了第二种生成 ⟨ç⟩ 的方式：

*   点击`⇧ Shift`+ `§`（选项死键），然后释放它，然后点击`c`.

当已选中*Meta键*时，即使在使用选项时也可以在终端中使用。

请注意，美国自定义键盘布局还有两件事：

1.  它将plain`§`转换为`⎄ Compose`键（因此您也可以通过点击`§`, then `,`, then来产生 ⟨ç⟩ `c`）。
2.  *它用（显着扩展的）美国扩展*键盘布局替换了 CapsLock 映射。

## 将选项死键重新映射到右选项修饰键

如果你有一个物理 ANSI 键盘，那么你就没有这个`§`键。在这种情况下，我建议将`§`键分配给其他键，例如右`⌥ Option`修饰键。安装[KeyRemap4MacBook](http://pqrs.org/macosx/keyremap4macbook/)，打开`~/Library/Application\ Support/KeyRemap4MacBook/private.xml`并粘贴以下代码：

```
<?xml version="1.0"?>
<root>
<item>
  <name>Send ISO Section for right Option</name>
  <identifier>private.send_iso_section_for_right_option</identifier>
  <autogen>--KeyToKey-- KeyCode::OPTION_R, KeyCode::UK_SECTION</autogen>
</item>
<item>
  <name>Send Shift+ISO Section for Shift+right Option (keep normal right Option without Shift)</name>
  <identifier>private.send_shift_iso_section_for_shift_right_option</identifier>
  <autogen>--KeyToKey-- KeyCode::OPTION_R, ModifierFlag::SHIFT_R, KeyCode::UK_SECTION, ModifierFlag::SHIFT_L</autogen>
  <autogen>--KeyToKey-- KeyCode::OPTION_R, ModifierFlag::SHIFT_L, KeyCode::UK_SECTION, ModifierFlag::SHIFT_L</autogen>
</item>
</root> 
```

然后，打开 KeyRemap4MacBook 首选项窗格，点击*ReloadXML*，然后选择“Send ISO Section for right option”。现在，您的`⌥ Right Option`键被重新映射为`§`，因此当*美国自定义*键盘布局处于活动状态时，点击`⇧ Shift`+`⌥ Right Option`将为您提供选项死键状态（在`⌥ Right Option`没有其他修饰符的情况下点击将为您提供与选项修饰符等效的死键状态。

如果要在未按下`⌥ Right Option`时保留`⇧ Shift`（而不是`⎄ Compose`键），则在 KeyRemap4MacBook 首选项窗格中选择“Send Shift+ISO Section for Shift+right Option (keep normal right Option without Shift)”（而不是“Send ISO Section for Shift+right Option (keep normal right Option without Shift)”（而不是“Send ISO Section for正确的选择”）。像这样，只有`⇧ Shift`+`⌥ Right Option`会产生选项死键，而 plain`⌥ Right Option`将继续作为选项修饰符工作。只要您不先击中，您甚至可以继续使用`⌥ Right Option`+`⇧ Shift`修饰符组合（例如`⌥ Right Option`+ `⇧ Shift`+ →⟨Ç⟩） 。`c``⇧ Shift`

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2012-06-01T21:25:29.807

值得思考问题背后的假设。我的意思是说，真正的问题是使当前似乎需要选项键的字符。无需同时实现“元键 + alt 功能”即可解决此问题。

让我解释一下：我有一个类似的问题。在我的英国键盘上，shift-3 映射到英镑符号 £，这意味着我通常需要点击 option-3 才能获得非常有用的 # - 终端中的一个真正问题，我将选项用作元。但是，我发现上述大多数解决方案都有些过头了。我不想更改为另一个版本的 Emacs（例如 Aquamacs），切换到不同的终端应用程序（例如 iTerm 或 xterm），或者为了安装一个键重新映射应用程序（例如 KeyRemap4MacBook）一个符号！也许这适合某些人，但我认为值得指出的是，如果问题只是一个字符，则可以使用九个字符的文本文件来解决。

关于我个人版本的这个问题，我发现最简单的解决方案是`.inputrc`在我的主目录中创建一个名为的文件，由以下单行组成：

```
"§": "#" 
```

这将当前 Mac 键盘上 1 左侧的（对我来说，完全没用的）§ 重新映射到（几乎不可缺少的）#。这比默认设置更适合我，因为我现在可以通过一个按键获得#。如果我需要重新映射任何其他字符，只需为每个字符添加额外的一行即可。

无论如何，这涉及如何在 shell 中获取丢失的字符，但是如果您也希望在 Emacs 中使用它（您没有说但可能是这种情况），那么您可以将类似的内容添加到您的`.emacs`文件中（其中 35 是我碰巧想要的字符的ASCII，即#)：

```
(global-set-key (kbd "§") 'insert-hash)
(defun insert-hash ()
  (interactive)
  (insert 35)) 
```

如果我经常想通过选项键访问几十个字符，那么它可能不是一个很好的解决方案，但没有。

我希望这对某人有所帮助。作为一个周末黑客，我通常不敢在 Stack Overflow 上发布问题的答案......

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-05-28T10:48:28.543

上面的答案提到了输入非ASCII输入的方法，但这并不是真正的问题。Cx 8方法让你输入一堆非ascii，但问题是你需要mac上的option键才能输入（ascii）字符`|' （竖条）！

那么你如何输入像 M-| 这样的东西？（区域到 shell 命令）在 Terminal.app 下的 ssh 中运行 emacs 时？没办法，只能使用转义键，因为 | 是 option-7 和 Terminal.app 出于某种愚蠢的原因不会让你使用 Cmc 作为元 :-(

（如果有人知道实际上确实让 Terminal.app 使用 Cmd 作为元数据的 hack（也许是 SIMBL？），我将不胜感激......）

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2014-08-07T13:02:43.580

以下解决方案有效，不**引人注目**，您**不需要 iTerm2**或**Aquamacs**或其他任何东西。

# 第1步

在 Terminal.app 设置中保持“使用选项作为元键”打开**。**

# 第2步

编辑`~/.inputrc`（*如果它不存在则创建它*），添加以下行：

`"\e3": '#'`

这将重新映射`⌥ alt`+`3`以便您**在终端中按预期**`#`生成一个字符，而不是它烦人地随着提示返回。**`(arg: 3)`**

 **# 第 3 步

编辑`~/.emacs`，添加以下行：

`(global-set-key (kbd "M-3") "#")`

这将重新映射`⌥ alt`+`3`以便您**在 emacs 中按预期**`#`生成一个字符，而不是烦人地什么都不做。

 *** * *

**警告 1**，这只是**1 个**重新映射。所以`⌥ alt`+ `**?**`（*其他键*）不会被重新映射，例如您可能希望重新映射`⌥ alt`+`n`以生成波浪号键`~`。只需按照上面列出的相同步骤，显然`3`可以使用您需要的任何键进行切换。

**警告 2，**当您`ssh`进入另一个盒子时，您将面临同样的困难，但您所要做的就是编辑该盒子上的`~/.inputrc`和`~/.emacs`文件。

**警告 3，**我是英国人，在英国 MacBook 上。所以我不能保证外国的MacBook。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2010-08-28T18:10:52.133

[Aquamacs](http://aquamacs.org/)支持这一点，至少对于我的（法语）键盘而言。一旦安装了 Aquamacs（通过拖放），您可以转到选项 -> 选项、命令、元键并为您的键盘选择适当的设置（在我的情况下，...元和法语）。我不精通 Emacs，但我尝试过的所有有用组合似乎都有效（[、{、| 等等）。

根据 2.1 版的菜单项，支持的键盘是：

*   英国
*   我们
*   瑞士法语
*   瑞士-德国
*   芬兰
*   意大利专业
*   意大利语
*   西班牙语
*   法语
*   德语

不过，如果您的键盘没有出现在列表中，我猜 Aquamacs 团队会感谢您的任何贡献。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-12-05T21:09:16.093

我咬了草，然后开始按逃生键。你习惯了...

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-01-14T18:37:27.100

我想修改这个问题或其他什么，因为我也使用瑞典语键盘，我必须按 alt+7 或 alt+shift+7 才能制作 | 和 \ 分别。

我还在 Terminal.app 中使用 Irssi，但这些都不能很好地混合。

我是 vim 的老用户，所以 emacs 对我来说不是问题。

没有办法将 CMD 重新映射为 Terminal.app 中的 Meta 吗？

到目前为止，我一直通过在 Irssi 中简单地输入 /wg N 来生存，因为在我的终端中拥有这些字符比 IRC 重要得多。

不过，一个解决方案对我来说很有价值！:)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-04-05T13:17:32.420

这已经晚了好几年，但是对于在寻找解决方案时遇到此页面的人来说，就像我一样，我决定自己构建一个，不需要放弃 Terminal.app 以支持 iTerm 2。

它是一个简单的状态栏应用程序，在后台运行并将所有左Alt + $KEY键事件快速连续重写为两个键事件，Esc，然后是$KEY；但是，只有在 Terminal.app 是重点应用程序时才会这样做。

您可以在[https://github.com/habibalamin/Metalt](https://github.com/habibalamin/Metalt)找到它。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2019-04-09T08:44:07.280

我将转义分配给大写锁定键，它工作得很好。您可以在 mac 系统首选项 > 键盘 > 修饰键中轻松配置它。

[https://apple.stackexchange.com/a/282092/236382](https://apple.stackexchange.com/a/282092/236382)

# javascript - 在 JavaScript 中删除数组元素 - 删除与拼接

> ID：500606
> 
> 赞同：1412
> 
> 时间：2009-02-01T11:11:16.420
> 
> 标签：javascript, arrays, element, delete-operator, array-splice

在数组元素上使用[运算符与](https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Operators/delete)[使用](https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/splice)[方法](https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/splice)[有`delete`](https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Operators/delete)什么区别？[`Array.splice`](https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/splice)

例如：

```
myArray = ['a', 'b', 'c', 'd'];

delete myArray[1];
//  or
myArray.splice (1, 1); 
```

如果我可以像使用对象一样删除数组元素，为什么还要使用 splice 方法？

* * *

## 回答 #1

> 赞同：1785
> 
> 时间：2009-02-01T11:16:23.257

`delete`将删除对象属性，但不会重新索引数组或更新其长度。这使它看起来好像是未定义的：

```
> myArray = ['a', 'b', 'c', 'd']
  ["a", "b", "c", "d"]
> delete myArray[0]
  true
> myArray[0]
  undefined 
```

请注意，它实际上并未设置为 value `undefined`，而是从数组中删除了该属性，使其*看起来*未定义。`empty`Chrome 开发工具通过在记录数组时打印来明确区分。

```
> myArray[0]
  undefined
> myArray
  [empty, "b", "c", "d"] 
```

[`myArray.splice(start, deleteCount)`](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Array/splice)实际上删除元素，重新索引数组并更改其长度。

```
> myArray = ['a', 'b', 'c', 'd']
  ["a", "b", "c", "d"]
> myArray.splice(0, 2)
  ["a", "b"]
> myArray
  ["c", "d"] 
```

* * *

## 回答 #2

> 赞同：350
> 
> 时间：2012-03-22T00:51:20.123

# Array.remove() 方法

**jQuery 的创建者John Resig**创建了一个非常方便的`Array.remove`方法，我总是在我的项目中使用它。

```
// Array Remove - By John Resig (MIT Licensed)
Array.prototype.remove = function(from, to) {
  var rest = this.slice((to || from) + 1 || this.length);
  this.length = from < 0 ? this.length + from : from;
  return this.push.apply(this, rest);
}; 
```

以下是一些如何使用它的示例：

```
// Remove the second item from the array
array.remove(1);
// Remove the second-to-last item from the array
array.remove(-2);
// Remove the second and third items from the array
array.remove(1,2);
// Remove the last and second-to-last items from the array
array.remove(-2,-1); 
```

[约翰的网站](http://ejohn.org/blog/javascript-array-remove/)

* * *

## 回答 #3

> 赞同：105
> 
> 时间：2009-02-01T11:13:42.607

因为 delete 只是从数组中的元素中删除对象，所以数组的长度不会改变。Splice 删除对象并缩短数组。

以下代码将显示“a”、“b”、“undefined”、“d”

```
myArray = ['a', 'b', 'c', 'd']; delete myArray[2];

for (var count = 0; count < myArray.length; count++) {
    alert(myArray[count]);
} 
```

而这将显示“a”、“b”、“d”

```
myArray = ['a', 'b', 'c', 'd']; myArray.splice(2,1);

for (var count = 0; count < myArray.length; count++) {
    alert(myArray[count]);
} 
```

* * *

## 回答 #4

> 赞同：75
> 
> 时间：2012-05-09T13:25:29.710

我在尝试了解如何从数组中删除每个出现的元素时偶然发现了这个问题。这是从数组中删除每个[的比较](http://jsfiddle.net/y5NbD/5/)和。`splice``delete``'c'``items`

```
var items = ['a', 'b', 'c', 'd', 'a', 'b', 'c', 'd'];

while (items.indexOf('c') !== -1) {
  items.splice(items.indexOf('c'), 1);
}

console.log(items); // ["a", "b", "d", "a", "b", "d"]

items = ['a', 'b', 'c', 'd', 'a', 'b', 'c', 'd'];

while (items.indexOf('c') !== -1) {
  delete items[items.indexOf('c')];
}

console.log(items); // ["a", "b", undefined, "d", "a", "b", undefined, "d"]
​ 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2009-02-01T11:16:55.083

来自[Core JavaScript 1.5 Reference > Operators > Special Operators > delete Operator](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Operators/Special_Operators/delete_Operator)：

> 删除数组元素时，数组长度不受影响。例如，如果删除 a[3]，a[4] 仍然是 a[4]，而 a[3] 是未定义的。即使您删除数组的最后一个元素（删除 a[a.length-1]），这仍然成立。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2016-01-08T10:43:54.587

如上所述，使用`splice()`似乎是一个完美的选择。[Mozilla 的文档：](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/splice)

> 该**`splice()`**方法通过删除现有元素和/或添加新元素来更改数组的内容。
> 
> ```
> var myFish = ['angel', 'clown', 'mandarin', 'sturgeon'];
> 
> myFish.splice(2, 0, 'drum'); 
> // myFish is ["angel", "clown", "drum", "mandarin", "sturgeon"]
> 
> myFish.splice(2, 1); 
> // myFish is ["angel", "clown", "mandarin", "sturgeon"] 
> ```
> 
> # 句法
> 
> > ```
> > array.splice(start)
> > array.splice(start, deleteCount)
> > array.splice(start, deleteCount, item1, item2, ...) 
> > ```
> 
> ## 参数
> 
> ### 开始
> 
> 开始更改数组的索引。如果大于数组的长度，实际起始索引将设置为数组的长度。如果为负，将从末尾开始那么多元素。
> 
> ### 删除计数
> 
> 一个整数，指示要删除的旧数组元素的数量。如果 deleteCount 为 0，则不删除任何元素。在这种情况下，您应该至少指定一个新元素。如果 deleteCount 大于从 start 开始数组中剩余的元素数，则将删除数组末尾的所有元素。
> 
> 如果省略 deleteCount，则 deleteCount 将等于`(arr.length - start).`
> 
> ### 第 1 项，第 2 项，...
> 
> 要添加到数组的元素，从起始索引开始。如果不指定任何元素，`splice()`只会从数组中删除元素。
> 
> ## 返回值
> 
> 包含已删除元素的数组。如果仅删除一个元素，则返回一个包含一个元素的数组。如果没有元素被删除，则返回一个空数组。
> 
> [...]

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2010-01-11T07:52:08.013

`splice`将使用数字索引。

而`delete`可以用于其他类型的索引..

例子：

```
delete myArray['text1']; 
```

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2012-08-01T20:11:15.760

可能还值得一提的是 splice 仅适用于数组。（不能依赖对象属性来遵循一致的顺序。）

要从对象中删除键值对，delete 实际上是您想要的：

```
delete myObj.propName;     // , or:
delete myObj["propName"];  // Equivalent. 
```

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2016-08-06T10:42:15.577

**删除与拼接**

当您从数组中删除一个项目时

```
var arr = [1,2,3,4]; delete arr[2]; //result [1, 2, 3:, 4]
console.log(arr)
```

当你拼接时

```
var arr = [1,2,3,4]; arr.splice(1,1); //result [1, 3, 4]
console.log(arr);
```

在**删除**的情况下，**元素被删除**但**索引保持为空**

而在**拼接**元素被删除的情况下**，其余元素的索引相应减少**

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2012-05-24T19:59:06.513

如果您想迭代一个大数组并有选择地删除元素，那么每次删除都调用 splice() 会很昂贵，因为 splice() 每次都必须重新索引后续元素。因为数组在 Javascript 中是关联的，所以删除单个元素然后重新索引数组会更有效。

您可以通过构建一个新数组来做到这一点。例如

```
function reindexArray( array )
{
       var result = [];
        for( var key in array )
                result.push( array[key] );
        return result;
}; 
```

但我认为您不能修改原始数组中的键值，这样会更有效率 - 看起来您可能必须创建一个新数组。

请注意，您不需要检查“未定义”条目，因为它们实际上并不存在，并且 for 循环不会返回它们。这是数组打印的产物，将它们显示为未定义。它们似乎不存在于内存中。

如果您可以使用类似 slice() 的东西会更好，它会更快，但它不会重新索引。有人知道更好的方法吗？

* * *

实际上，您可以按以下方式进行操作，这可能更有效，性能更佳：

```
reindexArray : function( array )
{
    var index = 0;                          // The index where the element should be
    for( var key in array )                 // Iterate the array
    {
        if( parseInt( key ) !== index )     // If the element is out of sequence
        {
            array[index] = array[key];      // Move it to the correct, earlier position in the array
            ++index;                        // Update the index
        }
    }

    array.splice( index );  // Remove any remaining elements (These will be duplicates of earlier items)
}, 
```

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2013-11-26T12:34:14.453

你可以使用这样的东西

```
var my_array = [1,2,3,4,5,6];
delete my_array[4];
console.log(my_array.filter(function(a){return typeof a !== 'undefined';})); // [1,2,3,4,6]
```

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2014-07-20T02:20:52.950

**delete**就像一个非现实世界的情况，它只是*删除*项目，但数组长度保持不变：

来自节点终端的示例：

```
> var arr = ["a","b","c","d"];
> delete arr[2]
true
> arr
[ 'a', 'b', , 'd', 'e' ] 
```

这是一个通过索引删除数组项的函数，使用**slice()**，它将 arr 作为第一个参数，将要删除的成员的索引作为第二个参数。如您所见，它实际上删除了数组的成员，并将数组长度减少1

```
function(arr,arrIndex){
    return arr.slice(0,arrIndex).concat(arr.slice(arrIndex + 1));
} 
```

上面的函数所做的是将所有成员到索引，以及索引之后的所有成员，并将它们连接在一起，并返回结果。

这是一个使用上面的函数作为节点模块的例子，看到终端会很有用：

```
> var arr = ["a","b","c","d"]
> arr
[ 'a', 'b', 'c', 'd' ]
> arr.length
4 
> var arrayRemoveIndex = require("./lib/array_remove_index");
> var newArray = arrayRemoveIndex(arr,arr.indexOf('c'))
> newArray
[ 'a', 'b', 'd' ] // c ya later
> newArray.length
3 
```

请注意，这不适用于其中包含欺骗的数组，因为 indexOf("c") 只会获得第一次出现，并且只会拼接并删除它找到的第一个“c”。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2019-01-31T15:22:43.180

`delete`应用运算符和`splice()`方法后，通过记录每个数组的长度可以看出差异。例如：

## 删除运算符

```
var trees = ['redwood', 'bay', 'cedar', 'oak', 'maple'];
delete trees[3];

console.log(trees); // ["redwood", "bay", "cedar", empty, "maple"]
console.log(trees.length); // 5 
```

运算符从数组中`delete`删除元素，但元素的“占位符”仍然存在。`oak`已被删除，但它仍然占用数组中的空间。因此，数组的长度保持为 5。

## 拼接（）方法

```
var trees = ['redwood', 'bay', 'cedar', 'oak', 'maple'];
trees.splice(3,1);

console.log(trees); // ["redwood", "bay", "cedar", "maple"]
console.log(trees.length); // 4 
```

该`splice()`方法也完全删除了目标值**和**“占位符”。`oak`以及它在数组中占用的空间已被删除。数组的长度现在是 4。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2016-03-17T09:45:44.233

为什么不直接过滤？我认为这是在 js 中考虑数组的最清晰的方法。

```
myArray = myArray.filter(function(item){
    return item.anProperty != whoShouldBeDeleted
}); 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2019-09-03T21:52:46.297

其他人已经适当地比较`delete`了`splice`。

另一个有趣的比较是`delete`vs `undefined`：删除的数组项使用的内存比刚刚设置的要少`undefined`；

例如，此代码不会完成：

```
let y = 1;
let ary = [];
console.log("Fatal Error Coming Soon");
while (y < 4294967295)
{
    ary.push(y);
    ary[y] = undefined;
    y += 1;
}
console(ary.length); 
```

它会产生此错误：

```
FATAL ERROR: CALL_AND_RETRY_LAST Allocation failed - JavaScript heap out of memory. 
```

因此，正如您所看到的，`undefined`实际上占用了堆内存。

但是，如果您还`delete`使用了 ary-item（而不仅仅是将其设置为`undefined`），代码将慢慢完成：

```
let x = 1;
let ary = [];
console.log("This will take a while, but it will eventually finish successfully.");
while (x < 4294967295)
{
    ary.push(x);
    ary[x] = undefined;
    delete ary[x];
    x += 1;
}
console.log(`Success, array-length: ${ary.length}.`); 
```

这些是极端的例子，但它们`delete`说明了我在任何地方都没有看到任何人提到的一点。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2020-06-25T12:03:30.520

# 表现

关于功能差异已经有很多很好的答案 - 所以在这里我想专注于性能。今天（2020 年 6 月 25 日）我对 Chrome 83.0、Safari 13.1 和 Firefox 77.0 进行测试，以获取有问题的解决方案以及选择的答案

## 结论

*   ( `splice`B) 解决方案对于小型和大型阵列来说都很快
*   ( `delete`A) 解决方案对于小型阵列来说是最快的，对于中型来说是快速的
*   (E) 解决方案在 Chrome 和 Firefox 上对于小型阵列是最快的`filter`（但在 Safari 上最慢，对于大型阵列来说很慢）
*   解决方案 D 很慢
*   解决方案 C 不适用于 Chrome 和 Safari 中的大数组

    ```
    function C(arr, idx) {
      var rest = arr.slice(idx + 1 || arr.length);
      arr.length = idx < 0 ? arr.length + idx : idx;
      arr.push.apply(arr, rest);
      return arr;
    }

    // Crash test

    let arr = [...'abcdefghij'.repeat(100000)]; // 1M elements

    try {
     C(arr,1)
    } catch(e) {console.error(e.message)}
    ```

[![在此处输入图像描述](https://i.stack.imgur.com/aIBJT.png)](https://i.stack.imgur.com/aIBJT.png)

## 细节

[我对解决方案A](https://stackoverflow.com/q/500606/860099) [B](https://stackoverflow.com/q/500606/860099) [C](https://stackoverflow.com/a/9815010/860099) [D](https://stackoverflow.com/a/24846748/860099) E（我的）执行以下测试

*   对于小数组（4 个元素） - 您可以在[此处运行测试](https://jsbench.me/6ykbr1kku8)
*   对于大数组（1M 个元素） - 您可以在[此处运行测试](https://jsbench.me/ngkbtudod2/1)

```
function A(arr, idx) {
  delete arr[idx];
  return arr;
}

function B(arr, idx) {
  arr.splice(idx,1);
  return arr;
}

function C(arr, idx) {
  var rest = arr.slice(idx + 1 || arr.length);
  arr.length = idx < 0 ? arr.length + idx : idx;
  arr.push.apply(arr, rest);
  return arr;
}

function D(arr,idx){
    return arr.slice(0,idx).concat(arr.slice(idx + 1));
}

function E(arr,idx) {
  return arr.filter((a,i) => i !== idx);
}

myArray = ['a', 'b', 'c', 'd'];

[A,B,C,D,E].map(f => console.log(`${f.name} ${JSON.stringify(f([...myArray],1))}`));
```

```
This snippet only presents used solutions
```

Chrome 的示例结果

[![在此处输入图像描述](https://i.stack.imgur.com/9VaUg.png)](https://i.stack.imgur.com/9VaUg.png)

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2016-07-21T06:03:58.437

```
function remove_array_value(array, value) {
    var index = array.indexOf(value);
    if (index >= 0) {
        array.splice(index, 1);
        reindex_array(array);
    }
}
function reindex_array(array) {
   var result = [];
    for (var key in array) {
        result.push(array[key]);
    }
    return result;
} 
```

例子：

```
var example_arr = ['apple', 'banana', 'lemon'];   // length = 3
remove_array_value(example_arr, 'banana'); 
```

香蕉被删除并且数组长度= 2

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2017-02-19T10:45:38.540

它们是具有不同目的的不同事物。

`splice`是特定于数组的，当用于删除时，从数组中删除条目*并将*所有先前的条目向上移动以填补空白。（它也可用于插入条目，或同时插入两者。）`splice`将更改`length`数组的 （假设它不是无操作调用：）`theArray.splice(x, 0)`。

`delete`不是特定于数组的；它设计用于对象：它从您使用它的对象中删除一个属性（键/值对）。它仅适用于数组，因为 JavaScript 中的标准（例如，非类型化）数组[根本不是真正的数组](http://blog.niftysnippets.org/2011/01/myth-of-arrays.html)*，它们是对某些属性进行特殊处理的对象，例如名称为“数组索引”（即[定义](http://www.ecma-international.org/ecma-262/7.0/index.html#sec-object-type)为字符串名称“...其数值`i`在范围内`+0 ≤ i < 2^32-1`”) 和`length`. 当您使用`delete`删除数组条目时，它所做的只是删除该条目；它不会移动后面的其他条目来填补空白，因此数组变得“稀疏”（有些条目完全丢失）。它对 没有影响`length`。

该问题的一些当前答案错误地指出使用`delete`“将条目设置为`undefined`”。这是不正确的。它完全*删除*条目（属性），留下一个空白。

让我们使用一些代码来说明差异：

```
console.log("Using `splice`:");
var a = ["a", "b", "c", "d", "e"];
console.log(a.length);            // 5
a.splice(0, 1);
console.log(a.length);            // 4
console.log(a[0]);                // "b"
```

```
console.log("Using `delete`");
var a = ["a", "b", "c", "d", "e"];
console.log(a.length);            // 5
delete a[0];
console.log(a.length);            // still 5
console.log(a[0]);                // undefined
console.log("0" in a);            // false
console.log(a.hasOwnProperty(0)); // false
```

```
console.log("Setting to `undefined`");
var a = ["a", "b", "c", "d", "e"];
console.log(a.length);            // 5
a[0] = undefined;
console.log(a.length);            // still 5
console.log(a[0]);                // undefined
console.log("0" in a);            // true
console.log(a.hasOwnProperty(0)); // true
```

* * *

* *（这是我贫血的小博客上的帖子）*

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2017-04-20T16:28:51.643

目前有两种方法可以做到这一点

1.  使用拼接（）

    `arrayObject.splice(index, 1);`

2.  使用删除

    `delete arrayObject[index];`

但我总是建议对数组对象使用拼接，对对象属性使用删除，因为删除不会更新数组长度。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2017-12-25T13:18:25.717

好的，假设我们在下面有这个数组：

```
const arr = [1, 2, 3, 4, 5]; 
```

让我们先删除：

```
delete arr[1]; 
```

这是结果：

```
[1, empty, 3, 4, 5]; 
```

**空的！**让我们得到它：

```
arr[1]; //undefined 
```

所以意味着只是删除的值，现在它是**未定义**的，所以长度是一样的，它也会返回**true** ...

让我们重置我们的数组，这次用 splice 来做：

```
arr.splice(1, 1); 
```

这就是这次的结果：

```
[1, 3, 4, 5]; 
```

如您所见，数组长度已更改，现在`arr[1]`为**3** ...

这也将返回数组中的已删除项目，`[3]`在这种情况下......

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2019-10-23T10:03:47.300

如果你有小数组，你可以使用`filter`：

```
myArray = ['a', 'b', 'c', 'd'];
myArray = myArray.filter(x => x !== 'b'); 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2015-01-11T12:21:58.903

`IndexOf`也接受引用类型。假设以下场景：

```
var arr = [{item: 1}, {item: 2}, {item: 3}];
var found = find(2, 3); //pseudo code: will return [{item: 2}, {item:3}]
var l = found.length;

while(l--) {
   var index = arr.indexOf(found[l])
      arr.splice(index, 1);
   }

console.log(arr.length); //1
```

不同的是：

```
var item2 = findUnique(2); //will return {item: 2}
var l = arr.length;
var found = false;
  while(!found && l--) {
  found = arr[l] === item2;
}

console.log(l, arr[l]);// l is index, arr[l] is the item you look for 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2015-07-20T18:46:24.847

最简单的方法可能是

```
var myArray = ['a', 'b', 'c', 'd'];
delete myArray[1]; // ['a', undefined, 'c', 'd']. Then use lodash compact method to remove false, null, 0, "", undefined and NaN
myArray = _.compact(myArray); ['a', 'c', 'd']; 
```

希望这可以帮助。参考：[https ://lodash.com/docs#compact](https://lodash.com/docs#compact)

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2015-12-13T08:35:49.297

如果想要删除的元素在中间（比如我们要删除 'c'，它的索引是 1），你可以使用：

```
var arr = ['a','b','c'];
var indexToDelete = 1;
var newArray = arr.slice(0,indexToDelete).combine(arr.slice(indexToDelete+1, arr.length)) 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2017-08-20T21:03:50.757

对于那些想要使用[Lodash](https://lodash.com/docs/4.17.4#without)的人可以使用： `myArray = _.without(myArray, itemToRemove)`

或者就像我在 Angular2 中使用的那样

```
import { without } from 'lodash';
...
myArray = without(myArray, itemToRemove);
... 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2018-06-28T19:26:43.373

> **delete** : delete 将删除对象属性，但不会重新索引数组或更新其长度。这使它看起来好像是未定义的：
> 
> **splice**：实际上删除元素，重新索引数组并更改其长度。

从最后一个删除元素

```
arrName.pop(); 
```

从第一个删除元素

```
arrName.shift(); 
```

从中间删除

```
arrName.splice(starting index,number of element you wnt to delete);

Ex: arrName.splice(1,1); 
```

删除最后一个元素

```
arrName.splice(-1); 
```

使用数组索引号删除

```
 delete arrName[1]; 
```

* * *

## 回答 #27

> 赞同：-1
> 
> 时间：2014-03-17T11:34:28.533

```
function deleteFromArray(array, indexToDelete){
  var remain = new Array();
  for(var i in array){
    if(array[i] == indexToDelete){
      continue;
    }
    remain.push(array[i]);
  }
  return remain;
}

myArray = ['a', 'b', 'c', 'd'];
deleteFromArray(myArray , 0); 
```

// 结果：myArray = ['b', 'c', 'd'];

# language-agnostic - 什么是鲜为人知但有用的数据结构？

> ID：500607
> 
> 赞同：794
> 
> 时间：2009-02-01T11:12:25.403
> 
> 标签：language-agnostic, data-structures, computer-science

周围有一些数据结构非常有用，但大多数程序员都不知道。他们是哪些？

每个人都知道链表、二叉树和散列，但是例如[跳过列表](http://en.wikipedia.org/wiki/Skip_list)和[布隆过滤器呢？](http://en.wikipedia.org/wiki/Bloom_filter)我想知道更多不那么常见但值得了解的数据结构，因为它们依赖于伟大的想法并丰富了程序员的工具箱。

PS：我也对像[跳舞链接](http://en.wikipedia.org/wiki/Dancing_Links)这样巧妙地利用通用数据结构的属性的技术感兴趣。

**编辑**：请尝试*包含*指向更详细描述数据结构的页面的链接。另外，尝试添加一些关于*为什么*数据结构很酷的词（正如[Jonas Kölker](https://stackoverflow.com/questions/500607/what-are-the-lesser-known-but-cool-data-structures)已经指出的那样）。此外，尝试为***每个 answer 提供一个数据结构***。这将允许更好的数据结构仅根据他们的投票浮动到顶部。

* * *

## 回答 #1

> 赞同：270
> 
> 时间：2009-02-01T11:24:12.337

[尝试](http://en.wikipedia.org/wiki/Trie)，也称为前缀树或[暴击位树](http://cr.yp.to/critbit.html)，已经存在了 40 多年，但仍然相对不为人知。[“ TRASH - A dynamic LC-trie and hash data structure](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.96.2143) ”中描述了一个非常酷的 Trie 用法，它结合了 trie 和哈希函数。

* * *

## 回答 #2

> 赞同：231
> 
> 时间：2009-02-01T19:11:07.590

[布隆过滤器](http://en.wikipedia.org/wiki/Bloom_filter)：*m*位的位数组，最初全部设置为 0。

要添加一个项目，您可以通过*k*个哈希函数运行它，这些函数将为您提供数组中的*k*个索引，然后您将其设置为 1。

要检查一个项目是否在集合中，请计算*k*个索引并检查它们是否都设置为 1。

当然，这给出了一些误报的可能性（根据维基百科，它大约是 0.61^(m/n)，其中 n 是插入项目的数量）。假阴性是不可能的。

删除一个项目是不可能的，但您可以实现*计数布隆过滤器*，由整数数组和增量/减量表示。

* * *

## 回答 #3

> 赞同：139
> 
> 时间：2009-02-18T20:01:37.797

[Rope](http://en.wikipedia.org/wiki/Rope_%28data_structure%29)：这是一个允许廉价前置、子串、中间插入和附加的字符串。我真的只用过一次，但没有其他结构就足够了。常规的字符串和数组前置对于我们需要做的事情来说太昂贵了，而且扭转一切都是不可能的。

* * *

## 回答 #4

> 赞同：127
> 
> 时间：2009-02-18T19:53:04.243

[跳过列表](http://en.wikipedia.org/wiki/Skip_list)非常整洁。

> [Wikipedia](http://en.wikipedia.org/wiki/Skip_list)
> 跳过列表是一种概率数据结构，基于多个并行的排序链表，其效率可与二叉搜索树媲美（大多数操作的平均时间为 log n）。

它们可以用作平衡树的替代品（使用概率平衡而不是严格执行平衡）。它们比红黑树更容易实现且速度更快。我认为它们应该是每个优秀程序员的工具箱。

如果您想深入了解跳过列表，请点击此处[链接到](http://video.google.com/videoplay?docid=-6710586843601387849)麻省理工学院关于它们的算法简介讲座的视频。

此外，[这里](http://iamwww.unibe.ch/~wenger/DA/SkipList/)是一个 Java 小程序，直观地演示了跳过列表。

* * *

## 回答 #5

> 赞同：91
> 
> 时间：2009-02-01T12:23:44.340

[空间索引](http://en.wikipedia.org/wiki/Spatial_index)，特别是[R-trees](http://en.wikipedia.org/wiki/R-tree)和[KD-trees](http://en.wikipedia.org/wiki/Kd-tree)，有效地存储空间数据。它们适用于地理地图坐标数据和 VLSI 布局和路由算法，有时也适用于最近邻搜索。

[位阵列](http://en.wikipedia.org/wiki/Bit_array)紧凑地存储单个位并允许快速位操作。

* * *

## 回答 #6

> 赞同：86
> 
> 时间：2010-05-22T23:02:18.040

**[拉链](http://www.haskell.org/haskellwiki/Zipper)**- 修改结构以具有“光标”的自然概念的数据结构的衍生物 - 当前位置。这些非常有用，因为它们保证索引不会越界——例如在[xmonad 窗口管理器](http://donsbot.wordpress.com/2007/05/17/roll-your-own-window-manager-tracking-focus-with-a-zipper/)中用于跟踪哪个窗口已聚焦。

[令人惊讶的是，您可以通过将微积分技术应用于](http://en.wikibooks.org/wiki/Haskell/Zippers#Mechanical_Differentiation)原始数据结构的类型来推导出它们！

* * *

## 回答 #7

> 赞同：69
> 
> 时间：2009-02-01T12:12:30.023

这里有几个：

*   后缀尝试。适用于几乎所有类型的字符串搜索（[http://en.wikipedia.org/wiki/Suffix_trie#Functionality](http://en.wikipedia.org/wiki/Suffix_trie#Functionality)）。另见后缀数组；它们不如后缀树快，但要小得多。

*   张开树（如上所述）。他们很酷的原因有三个：

    *   它们很小：您只需要像在任何二叉树中一样的左右指针（不需要存储节点颜色或大小信息）
    *   它们（相对）很容易实现
    *   它们为一大堆“测量标准”（每个人都知道的 log n 查找时间）提供了最佳的摊销复杂性。看[http://en.wikipedia.org/wiki/Splay_tree#Performance_theorems](http://en.wikipedia.org/wiki/Splay_tree#Performance_theorems)
*   堆排序的搜索树：您将一堆（键，优先级）对存储在树中，这样它是关于键的搜索树，并且相对于优先级是堆排序的。可以证明这样一棵树有一个独特的形状（而且它并不总是完全挤在左边）。使用随机优先级，它可以为您提供预期的 O(log n) 搜索时间 IIRC。

*   一个利基是具有 O(1) 邻居查询的无向平面图的邻接表。这与其说是一种数据结构，不如说是一种组织现有数据结构的特定方式。这样做的方法如下：每个平面图都有一个度数最多为 6 的节点。选择这样一个节点，将其邻居放入其邻居列表中，将其从图中删除，然后递归直到图为空。当给定一对 (u, v) 时，在 v 的邻居列表中查找 u，并在 u 的邻居列表中查找 v。两者的大小最多为 6，所以这是 O(1)。

通过上面的算法，如果 u 和 v 是邻居，你不会在 v 的列表中同时拥有 u 和在 u 的列表中的 v。如果您需要这个，只需将每个节点的缺失邻居添加到该节点的邻居列表中，但存储您需要查看多少邻居列表以进行快速查找。

* * *

## 回答 #8

> 赞同：65
> 
> 时间：2009-12-14T23:16:09.890

我认为标准数据结构（即无锁队列、堆栈和列表）的无锁替代方案被忽视了。
它们变得越来越重要，因为并发性变得更高优先级，并且比使用互斥锁或锁来处理并发读/写更令人钦佩。

这里有一些链接
[http://www.cl.cam.ac.uk/research/srg/netos/lock-free/](http://www.cl.cam.ac.uk/research/srg/netos/lock-free/)
[http://www.research.ibm.com/people/m/michael/podc-1996.pdf](http://www.research.ibm.com/people/m/michael/podc-1996.pdf) [PDF链接]
[http://www.boyet.com/Articles/LockfreeStack.html](http://www.boyet.com/Articles/LockfreeStack.html)

[Mike Acton 的](http://cellperformance.beyond3d.com/articles/index.html)（通常是挑衅性的）博客有一些关于无锁设计和方法的优秀文章

* * *

## 回答 #9

> 赞同：55
> 
> 时间：2009-02-18T20:17:50.940

我认为[Disjoint Set](http://en.wikipedia.org/wiki/Disjoint-set_data_structure)非常适合需要将一堆项目划分为不同的集合和查询成员资格的情况。Union 和 Find 操作的良好实现导致摊销成本实际上是恒定的（如果我正确回忆我的数据结构类，则与 Ackermnan 的函数相反）。

* * *

## 回答 #10

> 赞同：52
> 
> 时间：2009-06-17T21:38:51.243

[斐波那契堆](http://en.wikipedia.org/wiki/Fibonacci_heap)

它们被用于一些已知最快的算法（渐近），用于解决许多与图相关的问题，例如最短路径问题。Dijkstra 算法使用标准二进制堆在 O(E log V) 时间内运行；使用斐波那契堆将其提高到 O(E + V log V)，这对于密集图来说是一个巨大的加速。但不幸的是，它们具有很高的常数因子，在实践中常常使它们不切实际。

* * *

## 回答 #11

> 赞同：44
> 
> 时间：2009-02-18T20:26:32.930

任何有 3D 渲染经验的人都应该熟悉[BSP 树](http://en.wikipedia.org/wiki/Binary_space_partitioning)。通常，这是通过构建 3D 场景以便在知道相机坐标和方位的情况下进行渲染的方法。

> 二元空间分割（BSP）是一种通过超平面递归地将空间细分为凸集的方法。这种细分通过称为 BSP 树的树数据结构产生场景的表示。
> 
> 换句话说，它是将复杂形状的多边形分解为凸集或完全由非反射角（小于 180° 的角度）组成的较小多边形的方法。有关空间分区的更一般描述，请参阅空间分区。
> 
> 最初，这种方法是在 3D 计算机图形学中提出的，以提高渲染效率。其他一些应用包括在 CAD 中使用形状（构造立体几何）执行几何操作、机器人和 3D 计算机游戏中的碰撞检测，以及涉及处理复杂空间场景的其他计算机应用。

* * *

## 回答 #12

> 赞同：43
> 
> 时间：2009-02-22T04:47:47.383

[霍夫曼树](http://en.wikipedia.org/wiki/Huffman_coding)- 用于压缩。

* * *

## 回答 #13

> 赞同：38
> 
> 时间：2010-01-29T11:54:18.427

看看[Finger Trees](http://en.wikipedia.org/wiki/Finger_trees)，特别是如果您是[前面提到](https://stackoverflow.com/questions/500607/what-are-the-lesser-known-but-cool-data-structures/500633#500633)的纯函数数据结构的粉丝。它们是持久序列的功能表示，支持在摊销的常数时间内访问末端，以及在较小部分的大小上按时间对数连接和拆分。

根据[原始文章](http://www.soi.city.ac.uk/~ross/papers/FingerTree.html)：

> 我们的功能 2-3 指树是 Okasaki (1998) 引入的通用设计技术的一个实例，称为*隐式递归减速*。我们已经注意到，这些树是他的隐式双端队列结构的扩展，用 2-3 个节点替换对，以提供有效连接和拆分所需的灵活性。

手指树可以用[monoid](http://en.wikipedia.org/wiki/Monoid)参数化，使用不同的 monoid 会导致树的不同行为。这让手指树可以模拟其他数据结构。

* * *

## 回答 #14

> 赞同：34
> 
> 时间：2009-03-17T18:30:42.547

[圆形或环形缓冲区](http://en.wikipedia.org/wiki/Circular_buffer)- 用于流式传输等。

* * *

## 回答 #15

> 赞同：33
> 
> 时间：2010-01-28T20:03:29.923

我很惊讶没有人提到默克尔树（即[哈希树](http://en.wikipedia.org/wiki/Hash_tree)）。

在许多情况下使用（P2P 程序、数字签名），当您只有部分文件可供您使用时，您想要验证整个文件的哈希值。

* * *

## 回答 #16

> 赞同：32
> 
> 时间：2009-02-01T13:27:26.473

> <zvrba> Van Emde-Boas 树

我认为了解它们为什么很酷*会*很有用。一般来说，“为什么”这个问题是最重要的；）

我的回答是，他们给你 O(log log n) 个带有 {1..n} 键的字典，与正在使用的键的数量无关。就像重复减半给你 O(log n) 一样，重复 sqrting 给你 O(log log n)，这就是 vEB 树中发生的情况。

* * *

## 回答 #17

> 赞同：31
> 
> 时间：2009-02-01T11:27:36.340

[散开树](http://en.wikipedia.org/wiki/Splay_tree)怎么样？

此外，我想到了Chris Okasaki 的[纯函数式数据结构。](http://okasaki.blogspot.com/2008/02/ten-years-of-purely-functional-data.html)

* * *

## 回答 #18

> 赞同：29
> 
> 时间：2009-05-10T21:56:05.177

哈希表的一个有趣变体称为[Cuckoo Hashing](http://en.wikipedia.org/wiki/Cuckoo_hashing)。它使用多个散列函数而不是仅使用 1 个来处理散列冲突。通过从主散列指定的位置删除旧对象并将其移动到备用散列函数指定的位置来解决冲突。Cuckoo Hashing 允许更有效地使用内存空间，因为您可以仅使用 3 个哈希函数将负载因子提高到 91%，并且仍然具有良好的访问时间。

* * *

## 回答 #19

> 赞同：27
> 
> 时间：2011-01-15T12:18:07.633

[最小-最大堆](http://cg.scs.carleton.ca/~morin/teaching/5408/refs/minmax.pdf)是实现双端优先级队列的[堆](http://en.wikipedia.org/wiki/Heap_%28data_structure%29)的变体。它通过对堆属性的简单更改来实现这一点：如果偶数（奇数）级别上的每个元素都小于（大于）所有子节点和孙子节点，则称树是最小最大排序的。级别从 1 开始编号。

[http://internet512.chonbuk.ac.kr/datastructure/heap/img/heap8.jpg](http://internet512.chonbuk.ac.kr/datastructure/heap/img/heap8.jpg)

* * *

## 回答 #20

> 赞同：26
> 
> 时间：2011-03-24T22:20:26.243

我喜欢[Cache Oblivious 数据结构](http://blogs.msdn.com/b/devdev/archive/2007/06/12/cache-oblivious-data-structures.aspx)。基本思想是在递归较小的块中布置树，以便许多不同大小的缓存将利用方便放入它们的块。这导致在从 RAM 中的 L1 缓存到从磁盘读取的大块数据的所有内容中有效地使用缓存，而无需知道任何这些缓存层大小的细节。

* * *

## 回答 #21

> 赞同：23
> 
> 时间：2010-05-23T17:21:19.120

[左倾红黑树](http://www.cs.princeton.edu/~rs/talks/LLRB/LLRB.pdf)。Robert Sedgewick 于 2008 年发布的一个显着简化的红黑树实现（大约需要实现的代码行数的一半）。如果您在思考红黑树的实现时遇到过麻烦，请阅读此变体。

与安德森树非常相似（如果不相同）。

* * *

## 回答 #22

> 赞同：22
> 
> 时间：2010-09-19T17:54:55.883

工作窃取队列

用于在多个线程之间平均分配工作的无锁数据结构 [在 C/C++ 中实现工作窃取队列？](https://stackoverflow.com/questions/2101789/implementation-of-a-work-stealing-queue-in-c-c)

* * *

## 回答 #23

> 赞同：19
> 
> 时间：2010-07-23T06:15:19.053

[Gerth Stølting Brodal 和 Chris Okasaki 的自举倾斜二项式堆](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.48.973)：

尽管它们的名字很长，但它们提供了渐近优化的堆操作，即使在函数设置中也是如此。

*   `O(1)`大小，**联合**，插入，最小
*   `O(log n)`删除最小值

请注意，与数据结构教科书中通常介绍的更知名的堆（例如[左派堆](http://hackage.haskell.org/packages/archive/heap/0.5.0/doc/html/Data-Heap.html)`O(1)`）不同，联合需要而不是时间。与[Fibonacci heaps](http://en.wikipedia.org/wiki/Fibonacci_heap)不同，这些渐近线是最坏的情况，而不是摊销，即使持续使用！`O(log n)`

Haskell中有[多种](http://hackage.haskell.org/packages/archive/heaps/0.2/doc/html/Data-Heap.html) [实现](http://hackage.haskell.org/package/meldable-heap)。

它们是 Brodal 和 Okasaki 在 Brodal 提出具有相同渐近线的[命令堆之后共同推导出的。](http://www.brics.dk/~gerth/pub/wads95.html)

* * *

## 回答 #24

> 赞同：18
> 
> 时间：2009-02-01T13:29:08.293

*   [Kd-Trees](http://en.wikipedia.org/wiki/Kd-tree)是实时光线追踪中使用的空间数据结构（除其他外），它的缺点是需要裁剪与不同空间相交的三角形。通常 BVH 更快，因为它们更轻量级。
*   [MX-CIF Quadtrees](http://donar.umiacs.umd.edu/quadtree/rectangles/cifquad.html)，通过将常规四叉树与四边形边缘上的二叉树组合来存储边界框而不是任意点集。
*   [HAMT](http://en.wikipedia.org/wiki/Hash_array_mapped_trie)，分层哈希映射，由于涉及的常量，访问时间通常超过 O(1) 哈希映射。
*   [倒排索引](http://en.wikipedia.org/wiki/Inverted_index)，在搜索引擎圈子里非常有名，因为它用于快速检索与不同搜索词相关的文档。

大多数（如果不是全部）都记录在 NIST[算法和数据结构词典中](http://www.nist.gov/dads/)

* * *

## 回答 #25

> 赞同：18
> 
> 时间：2010-07-23T00:04:15.530

球树。只是因为他们让人们咯咯笑。

球树是一种对度量空间中的点进行索引的数据结构。 [这是一篇关于构建它们的文章。](http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.91.8209&rep=rep1&type=pdf) 它们通常用于寻找一个点的最近邻居或加速 k-means。

* * *

## 回答 #26

> 赞同：17
> 
> 时间：2010-05-23T21:52:47.873

不是真正的数据结构；更多的是一种优化动态分配数组的方法，但是 Emacs 中使用的[间隙缓冲区](http://en.wikipedia.org/wiki/Gap_buffer)有点酷。

* * *

## 回答 #27

> 赞同：16
> 
> 时间：2010-07-23T03:45:43.407

芬威克树。它是一种数据结构，用于在两个给定的子索引 i 和 j 之间对向量中所有元素的总和进行计数。简单的解决方案，从一开始就预先计算总和，不允许更新项目（您必须做 O(n) 工作才能跟上）。

Fenwick Trees 允许您在 O(log n) 中更新和查询，它的工作原理非常酷且简单。Fenwick 的原始论文中对此进行了很好的解释，可在此处免费获得：

[http://www.cs.ubc.ca/local/reading/proceedings/spe91-95/spe/vol24/issue3/spe884.pdf](http://www.cs.ubc.ca/local/reading/proceedings/spe91-95/spe/vol24/issue3/spe884.pdf)

它的父亲，RQM 树也很酷：它允许你保存向量的两个索引之间的最小元素的信息，它也适用于 O(log n) 更新和查询。我喜欢先教授 RQM，然后再教授 Fenwick Tree。

* * *

## 回答 #28

> 赞同：14
> 
> 时间：2009-02-01T13:06:37.653

[Van Emde-Boas 树](http://en.wikipedia.org/wiki/Van_Emde_Boas_tree)。我什至有它的 C++[实现](http://zvrba.net/software/algorithm_toolbox.html)，最多 2^20 个整数。

* * *

## 回答 #29

> 赞同：13
> 
> 时间：2010-05-22T23:56:40.513

[嵌套集](http://en.wikipedia.org/wiki/Nested_set_model)非常适合表示关系数据库中的树并在它们上运行查询。例如，ActiveRecord（Ruby on Rails 的默认 ORM）带有一个非常简单的[嵌套集插件](http://api.rubyonrails.org/classes/ActiveRecord/Acts/NestedSet/ClassMethods.html)，这使得使用树变得微不足道。

* * *

## 回答 #30

> 赞同：12
> 
> 时间：2010-05-23T07:31:25.773

它是特定领域的，但[半边数据结构](http://www.flipcode.com/archives/The_Half-Edge_Data_Structure.shtml)非常整洁。它提供了一种迭代多边形网格（面*和*边）的方法，这在计算机图形学和计算几何中非常有用。

* * *

## 回答 #31

> 赞同：12
> 
> 时间：2010-05-24T14:07:11.710

**替罪羊树。** 普通二叉树的一个典型问题是它们变得不平衡（例如，当键以升序插入时。）

平衡二叉树（AKA AVL 树）在每次插入后都会浪费大量时间进行平衡。

红黑树保持平衡，但每个节点都需要额外的存储空间。

替罪羊树像红黑树一样保持平衡，但不需要任何额外的存储空间。他们通过在每次插入后分析树并进行细微调整来做到这一点。请参阅[http://en.wikipedia.org/wiki/Scapegoat_tree](http://en.wikipedia.org/wiki/Scapegoat_tree)。

* * *

## 回答 #32

> 赞同：12
> 
> 时间：2011-01-15T12:12:08.020

展开的[链表](http://en.wikipedia.org/wiki/Unrolled_linked_list)是链表的一种变体，它在每个节点中存储多个元素。它可以显着提高缓存性能，同时减少与存储列表元数据（如引用）相关的内存开销。它与B树有关。

```
record node {
    node next       // reference to next node in list
    int numElements // number of elements in this node, up to maxElements
    array elements  // an array of numElements elements, with space allocated for maxElements elements
} 
```

* * *

## 回答 #33

> 赞同：11
> 
> 时间：2010-07-23T05:57:29.070

[Hinze 和 Paterson的](http://www.soi.city.ac.uk/~ross/papers/FingerTree.html)[2-3 Finger Trees](http://en.wikipedia.org/wiki/Finger_tree)是一种出色的函数式数据结构瑞士军刀，具有出色的渐近性，适用于各种操作。虽然很复杂，但它们比 Persistent 列表的命令式结构要简单得多，通过在它们之前的 Kaplan 和 Tarjan 的[递归减速进行连接。](http://portal.acm.org/citation.cfm?id=225058.225090)

它们作为可连接双端队列工作，可以`O(1)`访问任一端、`O(log min(n,m))`追加，并提供`O(log min(n,length - n))`索引，可以直接访问序列任何部分的单端前缀和。

[Haskell](http://hackage.haskell.org/package/fingertree-0.0.1.0)、[Coq](http://coq.inria.fr/distrib/v8.2/contribs-20090619/FingerTrees.toc.html)、[F#](http://v2matveev.blogspot.com/2010/03/data-structures-finger-tree-part-1.html)、[Scala](http://scala.sygneca.com/code/finger-trees)、[Java](http://functionaljava.googlecode.com/svn/artifacts/3.0/javadoc/fj/data/fingertrees/MakeTree.html)、[C](http://swt.informatik.uni-freiburg.de/data/ls_swt/theses/developing-and-verifying-of-fingertrees)、[Clojure](http://github.com/Chouser/finger-tree/blob/master/finger_tree.clj)、[C#](http://blogs.msdn.com/b/ericlippert/archive/2008/02/12/immutability-in-c-part-eleven-a-working-double-ended-queue.aspx)和其他语言都有实现。

您可以使用它们来实现[优先级搜索队列](http://hackage.haskell.org/package/fingertree-psqueue)、[区间映射](http://hackage.haskell.org/packages/archive/fingertree/0.0.1.0/doc/html/Data-IntervalMap-FingerTree.html)、[具有快速头部访问的绳索](http://hackage.haskell.org/packages/archive/rope/0.6.1/doc/html/Data-Rope.html)、映射、集合、[可连接序列](http://hackage.haskell.org/packages/archive/containers/0.2.0.1/doc/html/Data-Sequence.html)或几乎任何您可以将其表述为在快速可连接/可索引序列上收集单曲面结果的结构[。](http://haskell.org/ghc/docs/6.12.2/html/libraries/base-4.2.0.1/Data-Monoid.html)

我还有一些[幻灯片](http://comonad.com/reader/wp-content/uploads/2010/04/Finger-Trees.pdf)描述了它们的派生和使用。

* * *

## 回答 #34

> 赞同：10
> 
> 时间：2011-03-24T16:20:20.987

[XOR Linked List](http://en.wikipedia.org/wiki/XOR_linked_list)使用两个 XOR'd 指针来减少双向链表的存储要求。有点晦涩但很整洁！

* * *

## 回答 #35

> 赞同：10
> 
> 时间：2009-02-01T14:03:28.817

[配对堆](http://en.wikipedia.org/wiki/Pairing_heap)是一种堆数据结构，实现比较简单，实际摊销性能优良。

* * *

## 回答 #36

> 赞同：10
> 
> 时间：2010-01-28T20:21:54.373

一种鲜为人知但非常漂亮的数据结构是[Fenwick 树](http://en.wikipedia.org/wiki/Fenwick_tree)（有时也称为[二进制索引树](http://www.topcoder.com/tc?module=Static&d1=tutorials&d2=binaryIndexedTrees)或 BIT）。它存储累积和并支持 O(log(n)) 操作。虽然累积和听起来可能不是很令人兴奋，但它可以适应许多需要排序/log(n) 数据结构的问题。

IMO，它的主要卖点是易于[实施](http://www.algorithmist.com/index.php/Fenwick_tree)。在解决涉及编码红黑/avl树的算法问题时非常有用。

* * *

## 回答 #37

> 赞同：10
> 
> 时间：2011-03-24T16:02:54.060

我真的很喜欢[间隔树](http://en.wikipedia.org/wiki/Interval_tree)。它们允许您获取一堆间隔（即开始/结束时间或其他时间）并查询哪些间隔包含给定时间，或者在给定时间段内哪些间隔是“活动的”。查询可以在 O(log n) 中完成，预处理是 O(n log n)。

* * *

## 回答 #38

> 赞同：9
> 
> 时间：2010-07-22T17:21:54.277

[飞溅表](http://crpit.com/confpapers/CRPITV91Askitis.pdf)很棒。它们就像一个普通的哈希表，除了它们保证恒定时间查找并且可以处理 90% 的利用率而不会损失性能。它们是[Cuckoo Hash](http://en.wikipedia.org/wiki/Cuckoo_hashing)的概括（也是一个很好的数据结构）。它们看起来确实是[专利](http://www.faqs.org/patents/app/20080235488)，但与大多数纯软件专利一样，我不会太担心。

* * *

## 回答 #39

> 赞同：8
> 
> 时间：2009-02-19T01:13:10.090

[二元决策图](http://en.wikipedia.org/wiki/Binary_decision_diagram)是我最喜欢的数据结构之一，或者实际上是归约二元决策图（ROBDD）。

例如，这类结构可用于：

*   表示项目集并在这些集上执行非常快速的逻辑操作。
*   任何布尔表达式，旨在找到表达式的所有解决方案

请注意，许多问题可以表示为布尔表达式。例如，数独的解决方案可以表示为布尔表达式。并且为该布尔表达式构建 BDD 将立即产生解决方案。

* * *

## 回答 #40

> 赞同：8
> 
> 时间：2009-02-18T20:29:37.103

增强的散列算法非常有趣。[线性散列](http://en.wikipedia.org/wiki/Linear_hash)很简洁，因为它允许一次在散列表中拆分一个“桶”，而不是重新散列整个表。这对于分布式缓存特别有用。但是，对于大多数简单的拆分策略，您最终会快速连续拆分所有存储桶，并且表的负载因子会非常糟糕地波动。

我认为[螺旋散列](http://portal.acm.org/citation.cfm?id=901315&dl=GUIDE&coll=GUIDE&CFID=3731301&CFTOKEN=99586792)也很整洁。像线性散列一样，每次拆分一个桶，将桶中不到一半的记录放入同一个新桶中。它非常干净和快速。但是，如果每个“桶”都由具有相似规格的机器托管，则效率可能会很低。要充分利用硬件，您需要混合功能更弱和更强大的机器。

* * *

## 回答 #41

> 赞同：8
> 
> 时间：2010-11-23T03:20:16.337

**区域四叉树**

（引自[维基百科](http://en.wikipedia.org/wiki/Quadtree#The_region_quadtree)）

> 区域四叉树通过将区域分解为四个相等的象限、子象限等来表示二维空间的划分，每个叶节点包含对应于特定子区域的数据。树中的每个节点要么恰好有四个孩子，要么没有孩子（叶节点）。

像这样的四叉树非常适合存储空间数据，例如纬度和经度或其他类型的坐标。

这是迄今为止我在大学时最喜欢的数据结构。给这个人编码并看到它工作非常酷。如果您正在寻找一个需要深思熟虑并且有点偏僻的项目，我强烈推荐它。无论如何，它比您通常在数据结构类中分配的标准 BST 衍生物有趣得多！

事实上，作为奖励，我在这里找到了课堂项目（来自弗吉尼亚理工大学）的讲座笔记[（pdf 警告）](http://courses.cs.vt.edu/~cs3114/Spring10/Notes/T06.PRQuadTrees.pdf)。

* * *

## 回答 #42

> 赞同：7
> 
> 时间：2009-02-02T21:34:11.123

我喜欢 treaps - 因为简单而有效的想法是在二叉搜索树上叠加具有随机优先级的堆结构以平衡它。

* * *

## 回答 #43

> 赞同：6
> 
> 时间：2011-03-24T16:19:07.317

[DAWG](http://en.wikipedia.org/wiki/Directed_acyclic_word_graph)是一种特殊的 Trie，其中相似的子树被压缩为单亲。我扩展了修改后的 DAWG，并提出了一个漂亮的数据结构，称为 ASSDAWG（Anagram Search Sorted DAWG）。其工作方式是每当将字符串插入 DAWG 时，首先对其进行桶排序，然后再插入，并且叶节点保存一个[额外的数字](http://en.wikipedia.org/wiki/Factorial_number_system)，指示如果我们从根到达该叶节点，哪些排列是有效的。这有两个很好的优点：

1.  由于我在插入之前对字符串进行了排序，并且由于 DAWG 自然地折叠了类似的子树，因此我得到了高水平的压缩（例如，“eat”、“ate”、“tea”都变成了 1 条路径 aet，叶节点处的数字列表表示aet 的哪些排列是有效的）。
2.  现在，搜索给定字符串的字谜非常快速且简单，因为从根到叶的路径使用排列数在叶节点处保存该路径的所有有效字谜。

* * *

## 回答 #44

> 赞同：6
> 
> 时间：2009-06-13T10:56:39.413

Fast Compact tries:

*   [Judy arrays](http://judy.sourceforge.net): Very fast and memory efficient ordered sparse dynamic arrays for bits, integers and strings. Judy arrays are faster and more memory efficient than any binary-search-tree.

*   [HAT-trie: A Cache-conscious Trie-based Data Structure for Strings](http://members.optusnet.com.au/~askitisn/)

*   [B-tries for Disk-based String Management](http://members.optusnet.com.au/~askitisn/)

* * *

## 回答 #45

> 赞同：6
> 
> 时间：2009-03-24T21:34:13.907

计数未排序的平衡 btree。

非常适合文本编辑器缓冲区。

[http://www.chiark.greenend.org.uk/~sgtatham/algorithms/cbtree.html](http://www.chiark.greenend.org.uk/~sgtatham/algorithms/cbtree.html)

* * *

## 回答 #46

> 赞同：6
> 
> 时间：2010-07-23T08:03:25.300

我有时使用**反转列表**来存储范围，它们通常用于在正则表达式中存储字符类。参见例如[http://www.ibm.com/developerworks/linux/library/l-cpinv.html](http://www.ibm.com/developerworks/linux/library/l-cpinv.html)

另一个不错的用例是加权随机决策。假设您有一个符号列表和相关概率，并且您想根据这些概率随机选择它们

```
   a => 0.1
   b => 0.5
   c => 0.4

```

然后你对所有概率进行运行总和：

```
  (0.1, 0.6, 1.0)

```

这是你的反转列表。您生成一个介于 0 和 1 之间的随机数，并在列表中找到下一个更高条目的索引。你可以通过二分搜索来做到这一点，因为它是排序的。获得索引后，您可以在原始列表中查找符号。

如果您有`n`符号，则每个随机选择的符号都有 O(n) 准备时间，然后是 O(log(n)) 访问时间 - 与权重分布无关。

倒排列表的一种变体使用负数来表示范围的端点，这样可以很容易地计算在某个点有多少范围重叠。有关示例，请参见[http://www.perlmonks.org/index.pl?node_id=841368 。](http://www.perlmonks.org/index.pl?node_id=841368)

* * *

## 回答 #47

> 赞同：6
> 
> 时间：2011-01-15T11:39:40.110

[Arne Andersson 树](http://en.wikipedia.org/wiki/Aa_tree)是红黑树的一种更简单的替代方案，其中只有正确的链接可以是红色的。这极大地简化了维护，同时保持了与红黑树相当的性能。原始论文为插入和删除提供了一个[漂亮而简短的实现。](http://user.it.uu.se/~arnea/abs/simp.html)

* * *

## 回答 #48

> 赞同：5
> 
> 时间：2009-04-02T09:38:26.753

我喜欢用于字符串处理的[后缀树](http://en.wikipedia.org/wiki/Suffix_tree)和[数组](http://en.wikipedia.org/wiki/Suffix_array)、用于平衡列表的[跳过列表](http://codingplayground.blogspot.com/2009/01/generic-skip-list-skiplist.html)和用于自动平衡树的[展开树](http://en.wikipedia.org/wiki/Splay_trees)

* * *

## 回答 #49

> 赞同：5
> 
> 时间：2009-04-02T09:58:24.147

看看 Donald Knuth 提出的横向堆。

[http://stanford-online.stanford.edu/seminars/knuth/071203-knuth-300.asx](http://stanford-online.stanford.edu/seminars/knuth/071203-knuth-300.asx)

* * *

## 回答 #50

> 赞同：5
> 
> 时间：2010-05-25T07:07:47.217

[BK-Trees 或 Burkhard-Keller Trees](http://blog.notdot.net/2007/4/Damn-Cool-Algorithms-Part-1-BK-Trees)是一种基于树的数据结构，可用于快速查找字符串的近似匹配项。

* * *

## 回答 #51

> 赞同：5
> 
> 时间：2011-03-24T12:23:18.933

[Fenwick 树](http://en.wikipedia.org/wiki/Fenwick_tree)（或二叉索引树）是工具包的一个有价值的补充。如果您有一个计数器数组，并且需要在查询累积计数时不断更新它们（如在 PPM 压缩中），则 Fenwick 树将在 O(log n) 时间内完成所有操作，并且不需要额外的空间。另请参阅此[topcoder 教程](http://www.topcoder.com/tc?module=Static&d1=tutorials&d2=binaryIndexedTrees)以获得很好的介绍。

* * *

## 回答 #52

> 赞同：5
> 
> 时间：2011-04-17T02:06:38.123

[Zobrist Hashing](http://en.wikipedia.org/wiki/Zobrist_hashing)是一种散列函数，通常用于表示棋盘位置（如在国际象棋中），但肯定还有其他用途。关于它的一件好事是可以随着董事会的更新而逐步更新。

* * *

## 回答 #53

> 赞同：4
> 
> 时间：2009-02-02T08:59:29.040

伸展树很酷。它们以一种将最常查询的元素移近根的方式重新排序。

* * *

## 回答 #54

> 赞同：4
> 
> 时间：2010-01-17T10:49:13.143

您可以使用最小堆在恒定时间内找到最小元素，或者使用最大堆来找到最大元素。但是如果你想同时做这两个操作呢？您可以使用[Min-Max](http://www.cs.otago.ac.nz/staffpriv/mike/Papers/MinMaxHeaps/MinMaxHeaps.pdf)在恒定时间内完成这两项操作。它通过使用最小最大排序来工作：在连续树级别之间的最小和最大堆比较之间交替。

* * *

## 回答 #55

> 赞同：4
> 
> 时间：2009-05-13T14:36:49.840

远离所有这些图形结构，我只喜欢简单的**Ring-Buffer**。

如果实施得当，您可以大大减少内存占用，同时保持性能，有时甚至提高性能。

* * *

## 回答 #56

> 赞同：4
> 
> 时间：2011-03-24T14:33:37.883

根据 Bloom Filter 的提及，可删除的 Bloom Filters (DlBF) 在某些方面优于基本的计数变体。见[http://arxiv.org/abs/1005.0352](http://arxiv.org/abs/1005.0352)

* * *

## 回答 #57

> 赞同：4
> 
> 时间：2010-07-17T17:17:21.180

[持久数据结构](http://en.wikipedia.org/wiki/Persistent_data_structure)

* * *

## 回答 #58

> 赞同：4
> 
> 时间：2010-09-22T18:31:20.833

[B* 树](http://en.wikipedia.org/wiki/B*)

它是一种以更昂贵的插入为代价的高效搜索 B 树。

* * *

## 回答 #59

> 赞同：3
> 
> 时间：2010-05-23T08:43:09.927

优先级双端队列比必须维护 2 个具有不同排序的独立优先级队列便宜。 [http://www.alexandria.ucsb.edu/middleware/javadoc/edu/ucsb/adl/middleware/PriorityDeque.html](http://www.alexandria.ucsb.edu/middleware/javadoc/edu/ucsb/adl/middleware/PriorityDeque.html) [http://cphstl.dk/Report/Priority-deque/cphstl-report-2001-14.pdf](http://cphstl.dk/Report/Priority-deque/cphstl-report-2001-14.pdf)

* * *

## 回答 #60

> 赞同：3
> 
> 时间：2009-05-10T22:03:00.687

跳过列表实际上非常棒： [http ://en.wikipedia.org/wiki/Skip_list](http://en.wikipedia.org/wiki/Skip_list)

* * *

## 回答 #61

> 赞同：3
> 
> 时间：2011-03-25T05:17:33.997

[三元搜索树](http://en.wikipedia.org/wiki/Ternary_search_tree)

*   快速前缀搜索（用于增量自动完成等）
*   部分匹配（当您想查找字符串 X 汉明距离内的所有单词时）
*   通配符搜索

很容易实现。

* * *

## 回答 #62

> 赞同：3
> 
> 时间：2011-03-27T05:35:59.980

使用 2 个堆栈实现的队列非常节省空间（与使用至少有 1 个额外指针/引用开销的链表相反）。

[如何使用两个堆栈实现一个队列？](https://stackoverflow.com/questions/69192/using-stack-as-queue)

当队列很大时，这对我来说效果很好。如果我在一个指针上保存 8 个字节，这意味着有一百万个条目的队列可以节省大约 8MB 的 RAM。

* * *

## 回答 #63

> 赞同：3
> 
> 时间：2011-03-24T22:34:45.837

我认为 Paolo Ferragina 和 Giovanni Manzini 的[FM-index](http://en.wikipedia.org/wiki/FM-index)真的很酷。尤其是在生物信息学方面。它本质上是一个压缩的全文索引，它结合了后缀数组和参考文本的 burrows-wheeler 变换。可以在不解压整个索引的情况下搜索索引。

* * *

## 回答 #64

> 赞同：2
> 
> 时间：2010-05-23T02:23:35.670

[PQ-树](http://knol.google.com/k/pq-trees-and-the-consecutive-ones-property)

* * *

## 回答 #65

> 赞同：2
> 
> 时间：2010-05-23T08:44:38.673

增量列表/增量队列在 cron 或事件模拟器等程序中用于计算下一个事件应该何时触发。 [http://everything2.com/title/delta+list](http://everything2.com/title/delta+list) [http://www.cs.iastate.edu/~cs554/lec_notes/delta_clock.pdf](http://www.cs.iastate.edu/~cs554/lec_notes/delta_clock.pdf)

* * *

## 回答 #66

> 赞同：2
> 
> 时间：2010-02-17T19:03:09.643

正确的字符串数据结构。几乎每个程序员都满足于一种语言对结构的任何原生支持，这通常是低效的（特别是对于构建字符串，你需要一个单独的类或其他东西）。

最糟糕的情况是将字符串视为 C 中的字符数组，并依赖 NULL 字节来保证安全。

* * *

## 回答 #67

> 赞同：2
> 
> 时间：2011-03-24T14:59:05.920

[Burrows–Wheeler 变换](http://en.wikipedia.org/wiki/Burrows%E2%80%93Wheeler_transform)（块排序压缩）

其压缩的基本算法。假设您要压缩文本文件上的行。你会说，如果你对这些行进行排序，你就会丢失信息。但 BWT 的工作原理是这样的——它通过对输入进行排序来大量减少熵，保持整数索引以恢复原始顺序。

* * *

## 回答 #68

> 赞同：2
> 
> 时间：2011-03-24T17:09:35.250

我不确定这个数据结构是否有名字，但建议[`tokenmap`](http://svn.boost.org/svn/boost/sandbox/tokenmap/libs/tokenmap/doc/html/index.html)包含在 Boost 中的数据结构有点有趣。它是一个可动态调整大小的映射，其中查找不仅是 O(1)，而且是简单的数组访问。我写了关于这个数据结构的大部分[背景材料](http://svn.boost.org/svn/boost/sandbox/tokenmap/libs/tokenmap/doc/html/tokenmap/background.html)，描述了它如何工作的基本原理。

操作系统使用令牌映射之类的东西将文件或资源句柄映射到表示文件或资源的数据结构。

* * *

## 回答 #69

> 赞同：2
> 
> 时间：2011-03-24T15:05:42.257

PATRICIA - 检索以字母数字编码的信息的实用算法，DRMorrison (1968)。

PATRICIA 树与 Trie 相关。Tries 的问题在于，当键集稀疏时，即当实际键形成潜在键集的一小部分时，通常情况下，Trie 中的许多（大多数）内部节点只有一位子孙。这导致 Trie 具有很高的空间复杂度。

[http://www.csse.monash.edu.au/~lloyd/tildeAlgDS/Tree/PATRICIA/](http://www.csse.monash.edu.au/~lloyd/tildeAlgDS/Tree/PATRICIA/)

* * *

## 回答 #70

> 赞同：2
> 
> 时间：2011-03-24T14:38:56.783

一个[角缝的数据结构](http://www.eecs.berkeley.edu/Pubs/TechRpts/1983/6352.html)。从总结：

> 角拼接是一种表示矩形二维对象的技术。它似乎特别适合用于 VLSI 布局的交互式编辑系统。该数据结构有两个重要特点：一是显式表示空白空间；其次，矩形区域的角落像拼布被子一样缝合在一起。这种组织导致搜索、创建、删除、拉伸和压缩的快速算法（线性时间或更好）。该算法是在一个简化的VLSI电路模型下提出的，并讨论了该结构的存储要求。测量表明，角拼接需要的存储空间大约是最简单的表示的三倍。

* * *

## 回答 #71

> 赞同：2
> 
> 时间：2011-05-19T01:00:52.050

[不相交集森林](http://en.wikipedia.org/wiki/Disjoint-set_data_structure)允许快速的成员查询和联合操作，并且最著名[的是在 Kruskal 算法](http://en.wikipedia.org/wiki/Kruskal%27s_algorithm)中用于最小生成树。

真正酷的是，这两个操作都摊销了与[Ackermann Function的](http://en.wikipedia.org/wiki/Ackermann_function)*倒数*成正比的运行时间，使其成为“最快的”非常量时间数据结构。

* * *

## 回答 #72

> 赞同：2
> 
> 时间：2010-07-22T18:16:52.970

斗式旅

它们在 Apache 中被广泛使用。基本上它们是一个链表，在一个环中循环。我不确定它们是否在 Apache 和 Apache 模块之外使用，但它们作为一种很酷但鲜为人知的数据结构符合要求。桶是一些任意数据的容器，桶旅是桶的集合。这个想法是您希望能够在结构中的任何位置修改和插入数据。

假设您有一个存储桶旅，其中包含一个 html 文档，每个存储桶一个字符。您想要将所有`<`and`>`符号转换为`&lt;`and`&gt;`实体。桶旅允许您在遇到`<`或`>`符号时在旅中插入一些额外的桶，以适应实体所需的额外字符。因为铲斗大队是一个环形，你可以向后或向前插入。这比使用简单的缓冲区更容易（在 C 中）。

下面是一些关于斗式旅的参考：

[Apache Bucket Brigade 参考](http://apr.apache.org/docs/apr/trunk/group___a_p_r___util___bucket___brigades.html)

[桶和旅的介绍](http://www.apachetutor.org/dev/brigades)

* * *

## 回答 #73

> 赞同：2
> 
> 时间：2010-05-23T03:02:56.323

我个人觉得稀疏矩阵数据结构非常有趣。 [http://www.netlib.org/linalg/html_templates/node90.html](http://www.netlib.org/linalg/html_templates/node90.html)

著名的 BLAS 库使用这些。当您处理包含 100,000 行和列的线性系统时，使用它们变得至关重要。其中一些也类似于计算机图形学中常见的紧凑网格（基本上就像一个桶排序的网格）。 [http://www.cs.kuleuven.be/~ares/publications/LD08CFRGRT/LD08CFRGRT.pdf](http://www.cs.kuleuven.be/~ares/publications/LD08CFRGRT/LD08CFRGRT.pdf)

同样就计算机图形学而言，MAC 网格有些有趣，但这只是因为它们很聪明。 [http://www.seas.upenn.edu/~cis665/projects/Liquation_665_Report.pdf](http://www.seas.upenn.edu/~cis665/projects/Liquation_665_Report.pdf)

* * *

## 回答 #74

> 赞同：1
> 
> 时间：2009-06-17T21:32:43.240

[二项式堆](http://en.wikipedia.org/wiki/Binomial_heap)有很多有趣的属性，其中最有用的是合并。

* * *

## 回答 #75

> 赞同：1
> 
> 时间：2011-04-01T05:37:57.840

我认为[循环排序](http://corte.si/posts/code/cyclesort/index.html)是一种非常简洁的排序算法。

这是一种用于最小化写入总数的排序算法。当您处理闪存的寿命与写入量成正比的闪存时，这特别有用。这是[Wikipedia 文章](http://en.wikipedia.org/wiki/Cycle_sort)，但我建议转到第一个链接。（漂亮的视觉效果！）

* * *

## 回答 #76

> 赞同：1
> 
> 时间：2010-05-25T16:44:15.587

环境跟踪递归结构。

编译器使用递归但不像树的结构。内部范围有一个指向封闭范围的指针，因此嵌套是由内向外的。验证变量是否在范围内是从内部范围到封闭范围的递归调用。

```
public class Env
{    
    HashMap<String, Object> map;
    Env                     outer;

    Env()
    {
        outer = null;
        map = new HashMap();
    }

    Env(Env o)
    {
        outer = o;
        map = new HashMap();
    }

    void put(String key, Object value)
    {
        map.put(key, value);
    }

    Object get(String key)
    {
        if (map.containsKey(key))
        {
            return map.get(key);
        }
        if (outer != null)
        {
            return outer.get(key);
        }
        return null;
    }

    Env push()
    {
        return new Env(this);
    }

    Env pop()
    {
        return outer;
    }
} 
```

我不确定这个结构是否有名字。我称之为由内而外的清单。

* * *

## 回答 #77

> 赞同：1
> 
> 时间：2010-07-22T19:17:28.013

[我以前在WPL Trees](http://comjnl.oxfordjournals.org/cgi/content/short/34/5/444)上运气不错。最小化分支的加权路径长度的树变体。权重由节点访问决定，使经常访问的节点迁移到更靠近根的位置。不知道它们与伸展树相比如何，因为我从未使用过它们。

* * *

## 回答 #78

> 赞同：1
> 
> 时间：2010-07-17T17:33:06.797

其他人已经提出了 Burkhard-Keller-Trees，但我想我可能会再次提及它们以插入我自己的实现。:)

[http://well-adjusted.de/mspace.py/index.html](http://well-adjusted.de/mspace.py/index.html)

周围有更快的实现（请参阅 ActiveState 的 Python 配方或其他语言的实现），但我认为/希望我的代码有助于理解这些数据结构。

顺便说一句，BK 和 VP 树的用途远不止搜索相似的字符串。只要您有一个满足几个条件（正性、对称性、三角不等式）的距离函数，您就可以对任意对象进行相似性搜索。

* * *

## 回答 #79

> 赞同：1
> 
> 时间：2011-03-24T16:52:19.497

[多边形网格的半边数据结构](http://www.cgafaq.info/wiki/Half_edge_general)和[翼边](http://en.wikipedia.org/wiki/Winged_edge)。

对计算几何算法很有用。

* * *

## 回答 #80

> 赞同：1
> 
> 时间：2010-07-13T23:05:05.717

那里有一个聪明的数据结构，它使用数组来保存元素的数据，但是数组在链接列表/数组中链接在一起。

这样做的好处是元素的迭代非常快（比纯链表方法快），并且在内存中移动带有元素的数组和/或（取消）分配的成本最低。（因为这个数据结构对于模拟的东西很有用）。

我从这里知道：

[http://software.intel.com/en-us/blogs/2010/03/26/linked-list-verses-array/](http://software.intel.com/en-us/blogs/2010/03/26/linked-list-verses-array/)

“......并且一个额外的数组被分配并链接到粒子数组的单元列表中。这在某些方面类似于 TBB 如何实现其并发容器。”（它是关于链接列表与数组的性能)

* * *

## 回答 #81

> 赞同：0
> 
> 时间：2011-03-24T22:58:44.897

[直角三角形网络 (RTIN)](http://geoinformatics.fsv.cvut.cz/gwiki/Modern_Algorithms_for_Real-Time_Terrain_Visualization_on_Commodity_Hardware#RTIN)

自适应细分网格的精美简单方法。拆分和合并操作只是几行代码。

* * *

## 回答 #82

> 赞同：0
> 
> 时间：2011-09-06T10:11:31.547

当我读到一些与 RMQ 和 LCA 相关的算法时，我偶然发现了另一种数据结构[笛卡尔树。](http://en.wikipedia.org/wiki/Cartesian_tree)在笛卡尔树中，两个节点之间的最低共同祖先是它们之间的最小节点。将 RMQ 问题转换为 LCA 很有用。

* * *

## 回答 #83

> 赞同：0
> 
> 时间：2009-02-18T19:47:57.297

*   二元决策图（我最喜欢的数据结构，非常适合表示布尔方程并解决它们。对很多事情都有效）
*   堆（节点的父节点始终与节点的子节点保持某种关系的树，例如，节点的父节点总是大于它的每个子节点（max-heap））
*   优先级队列（实际上只是最小堆和最大堆，有利于维持许多元素的顺序，例如应该首先删除具有最高值的项目）
*   哈希表，（具有各种查找策略，以及桶溢出处理）
*   平衡二叉搜索树（每种都有自己的优势）
    *   RB-trees（总体不错，插入、查找、删除和迭代时有序）
    *   Avl-trees（查找速度比 RB 快，但在其他方面与 RB 非常相似）
    *   展开树（当最近使用的节点可能被重用时，查找速度更快）
    *   融合树（利用快速乘法以获得更好的查找时间）
    *   B+Trees（用于数据库和文件系统中的索引，当从/向索引读取/写入的延迟很长时非常有效）。
*   空间索引（非常适合查询点/圆/矩形/线/立方体是否彼此靠近或包含在彼此内）
    *   BSP树
    *   四叉树
    *   八叉树
    *   范围树
    *   许多相似但略有不同的树，以及不同的尺寸
*   区间树（很好的发现重叠区间，线性）
*   图表
    *   邻接列表（基本上是边列表）
    *   邻接矩阵（表示图的有向边的表格，每条边有一位。图遍历非常快）

这些是我能想到的。维基百科上还有更多关于[数据结构的内容](http://en.wikipedia.org/wiki/Category:Data_structures)

# java - 嵌入式 OSGi 或应用程序包

> ID：500623
> 
> 赞同：10
> 
> 时间：2009-02-01T11:20:28.087
> 
> 标签：java, osgi

在过去的两天里，我刚刚阅读了所有我能拿到的 OSGi 东西，我终于认为我已经掌握了它。

我现在正尝试将它与现有应用程序集成，原因有很多，例如 3rd 方插件、自动更新，更不用说 SOA 只是让我高兴。

我现在有一个我正在努力做出的决定，那就是天气

1.  我的整个应用程序应该成为默认安装在容器中的 OSGi 包；或者
2.  我的应用程序应该启动一个嵌入式 OSGi 容器，并为所有插入的服务与其交互。

我更喜欢 1，因为这让我可以轻松更新应用程序并且架构会保持一致。当然，我希望必须将应用程序重构为许多较小的包。然而2在短期内使事情变得容易得多，但将来会变得很尴尬。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-01T22:35:00.627

for option 1) you really don't want your whole application in one bundle - you would loose all the benefit from OSGi - but really that depend on the size of your application.

It really depends where you want to run application and which task you want it to perform. Also you probably want to have some kind of remoting to access the exposed services.

in option 1) you need to enable some kind of http/servlet bundle (there is a bridge that exists) in option 2) you application can run inside an application server so you don't have to worry about that.

The first question you want to ask yourself is about the operational environment. Who is going to run the application? Do they need/want to be trained on OSGi? Are they more comfortable with the J2EE stack?

I think the best option for you is to keep your options open, there is no real differences between 1) and 2) but what is staring the OSGi framework, either your code or the framework code. Your application itself, ie the bundles constituting your application will be exactly the same.

My advice would be not to worry too much about OSGi runtime to start with - but start on OSGi development - nothing stop you from developing "OSGi-style" and running in a standard JRE environment.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-10T00:24:58.913

我认为您想使用选项 1，并让您的应用程序由一组（大部分是开箱即用的）OSGi 容器内的捆绑包组成。

1.  它将提高您自己代码的模块化。您甚至可能会发现它的某些部分可以提供原始应用程序之外的使用服务。
2.  从 OSGi 内部使用其他包比使用主机应用程序要容易得多。因为主机应用程序看不到包的类（并且包只能看到您从主机显式公开的内容），所以您必须设置一个非常复杂的类路径或诉诸反射以从容器外部调用包。

所以我想说，即使在短期内，选项 1 也可能更容易。

此外，我同意 Patrick 的断言，即您的大部分代码不需要关心它是在 OSGi 中运行还是在普通 JVM 中运行。特别是在使用声明式服务时，大大减少了从代码中使用 OSGi 接口和机制的需要：您只需将一些描述符文件添加到 jar 的 META-INF 中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-10-31T06:17:01.793

我宁愿选择选项 2，本质上您的应用程序不是一个捆绑包，而是一个应用程序。如果您想要增加 OSGi 价值，请从您的应用程序中生成 OSGi 容器。这样，如果您决定在未来某个日期离开 OSGi，您可以通过一种简单的方式进行操作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-01T15:14:52.153

你看过 Spring 应用服务器吗？这不能让你管理这些东西吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-06-01T09:27:13.470

我肯定会推荐 1 - 该应用程序应该成为一个 OSGi 捆绑包，而不仅仅是因为易于更新。如果你的代码一半在 OSGi 框架中，一半在外部，你将不得不为两半之间的通信搭建一座桥梁；您还可能遇到类可见性问题。

1的好处也很多，实现起来也不是那么难。我会推荐以下内容：

*   在您认为合乎逻辑的情况下，将应用程序分成尽可能多的模块。

您不必拥有许多模块 - OSGi 可以轻松处理两个 10 MB 的包以及 100 个较小的包。分离应该是功能本身的结果 - 一个好的起点是您可能在开始实现这些东西之前所做的 UML 体系结构图。不同功能部分相互通信的地方正是你应该考虑定义接口而不是类的地方——然后这些接口将成为你的 OSGi 服务，实现将成为捆绑包——下一次你将拥有要更新某些部分，您会发现预测对应用程序其他部分的影响要容易得多，因为您清楚地将其分开并在捆绑包的清单中声明了它。

*   将您在单独的包中使用的任何外部/开源库分开。它们很可能是必须更频繁地更新的部分，并且在与您自己的代码不同的时间线上。在这里定义清晰的包依赖关系、包版本以及避免依赖于实现部分而不是仅仅依赖于接口也更重要！

*   考虑一下您希望将应用程序的哪些部分公开给插件。然后从这些部分中制作 OSGi 服务 - 即在 OSGi 注册表中发布接口。您不需要实现任何特定的东西——您可以发布任何 Java 对象。然后插件将使用注册表进行查找。

*   插件也是如此——想想你想从插件中得到什么，定义插件可以实现和发布的相应接口，你的应用程序可以在注册表中查找。

*   最后一个提示 - 查看您选择的 OSGi 框架中已经提供了哪些捆绑包。OSGi 规范定义了许多标准的 OSGi 接口——用于配置、日志记录、持久存储、远程连接、用户管理、事件等等。由于它们是标准的，您可以使用它们而不依赖于任何特定的 OSGi 实现。并卸载你不需要的东西。

# java - 了解对 DI 框架的需求

> ID：500637
> 
> 赞同：40
> 
> 时间：2009-02-01T11:30:49.827
> 
> 标签：java, spring, dependency-injection

这可能是一个幼稚的问题。我目前正在学习 Spring 框架和*依赖注入*。虽然 DI 的基本原理很容易掌握，但为什么需要一个复杂的框架来实现它并不是很明显。

考虑以下：

```
public abstract class Saw
{
    public abstract void cut(String wood);
}

public class HandSaw extends Saw
{
    public void cut(String wood)
    {
        // chop it up
    }
}

public class ChainSaw extends Saw
{
    public void cut(String wood)
    {
        // chop it a lot faster
    }
}

public class SawMill
{
    private Saw saw;

    public void setSaw(Saw saw)
    {
        this.saw = saw;
    }

    public void run(String wood)
    {
        saw.cut("some wood");
    }
} 
```

然后你可以简单地做：

```
Saw saw = new HandSaw();
SawMill sawMill = new SawMill();
sawMill.setSaw(saw);
sawMill.run(); 
```

这相当于：

```
<bean id="saw" class="HandSaw"/>

<bean id="sawMill" class="SawMill">
   <property name="saw" ref="saw"/>
</bean> 
```

加：

```
ApplicationContext context = new ClassPathXmlApplicationContext("sawmill.xml");
SawMill springSawMill = (SawMill)context.getBean("sawMill");
springSawMill.run(); 
```

诚然，这是一个人为的例子，对于更复杂的对象关系，隐藏 XML 文件可能比以编程方式编写它更有效，但肯定还有更多的东西吗？

（我知道 Spring 框架不止于此，但我正在考虑需要一个 DI 容器。）

在第一个示例中，在中途更改依赖项也很简单：

```
// gotta chop it faster
saw = new ChainSaw();
sawMill.setSaw(saw);
sawMill.run(); 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-01T12:24:16.083

我也有同样的问题，答案是这样的：
当然，你可以做你在“然后你可以简单地做：......”中描述的事情（让我们称之为“A级”）。但是，这会将 A 类耦合到 HandSaw，或与 SawMill 类所需的所有依赖项耦合。为什么 A 应该与 HandSaw 耦合 - 或者，如果您采用更现实的场景，为什么我的业务逻辑应该耦合到 DAO 层所需的 JDBC 连接实现？
我当时提出的解决方案是“然后将依赖关系进一步移动” - 好的，所以现在我已经将我的视图与 JDBC 连接耦合，我应该只处理 HTML（或 Swing，选择你的风格）。

由 XML（或 JavaConfig）配置的 DI 框架通过让您“获得所需的服务”来解决这个问题。你不关心它是如何初始化的，它需要什么工作——你只需要获取服务对象并激活它。

此外，您对“加号：”（您在哪里做`SawMill springSawMill = (SawMill)context.getBean("sawMill"); springSawMill.run();`）有一个误解-您不需要从上下文中获取 sawMill bean-sawMill bean 应该已经被注入到您的对象（A 类）中DI 框架。因此，您只需使用“sawMill.run()”而不是 ...getBean(...)，而不关心它来自何处、谁初始化它以及如何初始化它。对于所有你关心的，它可以直接进入 /dev/null，或者测试输出，或者真正的 CnC 引擎......关键是 - 你不在乎。你所关心的只是你那小小的 A 级，它应该按照合同约定去做——启动锯木厂。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-02-01T18:34:48.707

依赖注入是[隐式参数传递](http://www.scala-lang.org/node/114)的一种退化形式，目的基本相同，都是为了解决所谓[的配置问题](http://portal.acm.org/citation.cfm?doid=1017472.1017481)：

> 配置问题是在整个程序中传播运行时偏好，允许多个并发配置集在静态保证分离下安全共存。

依赖注入框架弥补了语言中[单子的](http://learnyouahaskell.com/for-a-few-monads-more)[隐式参数](http://www.scala-lang.org/node/114)、[库里函数](http://www.youtube.com/watch?v=ZasXwtTRkio)和便利设施的不足。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-02-01T17:20:19.747

Spring 具有三个同样重要的特性：

1.  依赖注入
2.  面向方面编程
3.  框架类库，可帮助处理持久性、远程处理、Web mvc 等。

我同意，当您将依赖注入与对 new 的单个调用进行比较时，很难看出依赖注入的优势。在这种情况下，后者肯定会看起来更简单，因为它是一行代码。Spring 的配置总是会增加代码行数，所以这不是一个成功的论点。

当您可以从类中取出诸如事务之类的横切关注点并使用方面以声明性方式设置它们时，它开始看起来好多了。与单个“新”调用的比较并不是创建 Spring 的目的。

也许使用 Spring 的最佳结果是它推荐的惯用语使用接口、分层和像 DRY 这样的良好原则的方式。这实际上只是 Rod Johnson 在他的咨询工作中使用的面向对象最佳实践的提炼。他发现，随着时间的推移，他积累的代码帮助他为客户提供更好的软件赚钱。他总结了他在“专家 1:1 J2EE”中的经验，并最终将代码开源为 Spring。

我会说，只要你认为他的经验也可以帮助你编写更好的代码，就可以购买这个框架。

我认为在你结合所有这三个特性之前，你无法获得 Spring 的全部价值。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-01T17:08:50.630

> 诚然，这是一个人为的例子，对于更复杂的对象关系，存储一个 XML 文件可能比以编程方式编写它更有效，但肯定还有更多的东西吗？

我认为将“接线”放在配置文件中而不是在代码中手动执行更有意义，原因如下：

1.  配置在您的代码之外。
2.  可以简单地对外部 (XML) 文件进行布线更改（告诉您`sawmill`使用不同的实例`Saw`），而无需更改代码、重新编译、重新部署等。
3.  当你有几十个类和几层注入时（例如：你有一个 web`Controller`类，它获取一个`Service`包含你的业务逻辑的类，它使用 a从数据库`DAO`中获取s，然后将 a注入其中，等等。 )，手动连接协作者很乏味，需要几十行代码，除了连接之外什么都不做。`Saw``DataSource`
4.  这不是一个明确的“好处”，但是通过将所有“连接”都放在代码之外，我认为它有助于向开发人员强化依赖注入的核心思想，特别是编码到接口，而不是实现。通过手动接线，很容易回到旧的方式。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-02-01T13:06:23.567

我通常不关心基于 XML 或反射的 DI，因为在我的用例中，它增加了不必要的复杂性。相反，我通常会选择某种形式的手动 DI，在我看来，这似乎更自然并且具有大部分好处。

```
public class SawDI{
    public Saw CreateSaw(){
        return new HandSaw();
    }

    public SawMill CreateSawMill(){
        SawMill mill = new SawMill();
        mill.SetSaw(CreateSaw());
        return mill;
    }
}

// later on

SawDI di = new SawDI();
SawMill mill = di.CreateSawMill(); 
```

这意味着我仍然集中了耦合并拥有它的所有优点，而不依赖于更复杂的 DI 框架或 XML 配置文件。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-07-29T17:36:21.720

不要忘记依赖注入的一个主要缺点：您失去了使用功能强大的 Java IDE 的 Find Usages 轻松查找初始化位置的能力。如果您进行大量重构并希望避免测试代码比应用程序代码大 10 倍，这可能是一个非常严重的问题。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-01T13:38:22.347

大多数（如果不是全部）DI 容器/库还为您带来的一件事是可以拦截通过 DI 创建的所有实例的方法。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-01T11:34:34.360

如果对插入的类进行硬编码，则需要该类在编译时可用。使用配置文件，您可以在运行时更改使用的锯（在您的情况下）而无需重新编译，甚至可以使用从您刚刚放置在类路径中的新 jar 中获取的锯。如果值得，额外的复杂性取决于您必须解决的任务。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-03-13T18:59:23.313

最近，人们非常重视 DI*框架*，甚至以至于 DI*模式*正在被遗忘。[JB Rainsberger 总结的](http://groups.google.com/group/growing-object-oriented-software/browse_thread/thread/54edea558e82fe7c)DI 原则：

> 这很简单：通过要求合作者作为构造函数中的参数来明确依赖关系。重复，直到您将有关创建哪些对象的所有决定都推送到入口点。当然，这只适用于服务（在 DDD 意义上）。完毕。

正如您所注意到的，手动配置依赖项与使用框架没有太大区别。使用构造函数注入，如下所示，您的代码示例将具有更少的样板文件，并且编译器将强制您提供所有必需的依赖项（并且您的 IDE 可能会为您键入它们）。

```
SawMill sawMill = new SawMill(new HandSaw());
sawMill.run(); 
```

DI 框架可以减少创建工厂和将对象连接在一起的样板，但同时它也可以使找出每个依赖项的来源变得更加困难 - DI 框架的配置是一个要挖掘的抽象层通过，您的 IDE 可能无法告诉您从何处调用特定构造函数。

DI 框架的一个间接缺点是它们可以使连接依赖关系*过于容易*。当您不再因拥有大量依赖而[感到痛苦](http://blog.orfjackal.net/2010/04/direct-and-indirect-effects-of-tdd.html)时，您可能只是继续添加更多依赖，而不是重新考虑应用程序的设计以减少类之间的耦合。手动连接依赖项——尤其是在测试代码中——当你有太多依赖项时更容易注意到，因为测试设置变得更长并且编写单元测试变得更加困难。

DI 框架的一些优势来自于它们对高级特性的支持，例如 AOP（例如 Spring 的 @Transactional）、作用域（尽管多次[使用纯代码](http://groups.google.com/group/growing-object-oriented-software/browse_thread/thread/54edea558e82fe7c)就足够了）和可插入性（如果确实需要插件框架）。

最近我做了一个手动 DI 与基于框架的 DI 的实验。进度和结果显示为[Let's Code Dimdwarf 第 42 至 47 集的](http://www.orfjackal.net/lets-code)截屏视频。有问题的项目有一个基于[Guice](http://code.google.com/p/google-guice/)的插件系统，用于创建[actor](http://en.wikipedia.org/wiki/Actor_model)，然后我使用手动 DI 重写了它，没有 Guice。结果是一个更简单和更清晰的实现，而且只是更多的样板。

**概要：**首先尝试仅使用手动 DI（最好是构造函数注入）。如果有很多样板，请尝试重新考虑设计以减少依赖关系。如果它的某些功能为您提供价值，请使用 DI 框架。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-08T02:47:59.097

使用依赖注入的最大好处之一是，在为该类创建单元测试时，它可以更轻松地提供类依赖项的模拟或存根。这允许您在不依赖其协作者的情况下单独测试该类。

在您的示例中，无法在实例化它们的类中模拟或存根 Saw 或 SawMill。如果 Saw 和 SawMill 是通过 setter 或构造函数设置的，那么您可以在运行单元测试时传入自己的模拟 Saw 和模拟 SawMill。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-01T11:36:19.643

重要的是要了解 Spring 从根本上讲是两件事，一件建立在另一件之上：

1.  轻量级 DI/IoC 框架和实现该框架的类（例如 XML 应用程序上下文等）；和
2.  它是一个**轻量级的容器**。

(2) 是大部分的Spring代码。基本上选择一种 Java 技术，你可能会发现 Spring 有它的辅助类。这样您就可以使用 ActiveMQ、Sun One MQ 或其他任何东西，并将它们抽象为 Spring JmsTemplate，数据访问技术、Web 服务等也是如此。

所有这些助手都使用 (1) 将它们连接在一起。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-01T13:48:43.527

Spring 帮助你理解甚至鼓励 DI 模型。但是，我不相信你必须有春天。

您可以在 Java 中拥有可以调试、重构和执行代码分析的配置文件。

我建议您将这些 java 配置文件放在另一个包中，但它们在其他方面等同于 XML 配置文件。如果这很重要，您甚至可以动态加载这些文件。

# ruby - 异步报警信号

> ID：500649
> 
> 赞同：1
> 
> 时间：2009-02-01T11:42:18.010
> 
> 标签：ruby, jruby

我正在寻找`alarm(2)`Ruby 中 POSIX（或类似）的可移植接口。也就是说，我希望能够设置一个后台计时器，在*n*秒后向当前进程发送信号。

我从 2006 年的 ruby​​-talk 列表中找到了一些[很好的讨论](http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/216201)，该列表提供了一个使用`dl/import`.

我已经查看了这个备受诟病的`Timeout`模块，尽管它在传统解释器中运行良好，但它不会在 JRuby 下削减它。我的程序是一个使用 Readline 库的小型命令行 shell：

```
TIMEOUT = 5 # seconds
loop do
  input = nil
  begin
    Timeout.timeout(TIMEOUT) do
      input = Readline::readline('> ', nil)
    end
  rescue Timeout::Error
    puts "Timeout"
    next
  end
  # do something with input
end 
```

在 JRuby 下，似乎进程阻塞在`readline`调用中，并且`Timeout::Error`仅在 (a) 计时器到期和 (b) 用户输入新行之后才被抛出。并且异常没有得到拯救。唔。

所以我想出了这个解决方法：

```
require 'readline'
class TimeoutException < Exception ; end
TIMEOUT = 5 # seconds

loop do
  input = nil
  start_time = Time.now
  thread = Thread.new { input = Readline::readline('> ', nil) }
  begin
    while thread.alive? do
      sleep(1) # prevent CPU from melting
      raise TimeoutException if(Time.now - start_time > TIMEOUT)
    end
  rescue TimeoutException
    thread.exit
    puts "Timeout"
  end
  # do something with input
end 
```

这是...笨重（让我们有礼貌）。我只是想要`alarm(2)`！我真的不想为此拖入非核心库（例如终结者）。有没有更好的办法？

编辑：我无法获得另一种选择——创建一个睡眠然后向进程发送信号的线程——在 JRuby 下工作。JRuby 吃信号吗？例子：

```
SIG = 'USR2'
Signal.trap(SIG) { raise }
Process.kill(SIG, Process.pid) 
```

JRuby 简单地返回，Ruby 返回预期的“未处理异常”错误。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-02T00:05:50.630

很抱歉，对于您在 X 秒后向进程发送信号的更大问题，我没有答案，但似乎您想要做的只是在等待输入 X 秒后超时，如果这是案例然后我会说你正在寻找 Kernel.select ：D

我个人从来没有使用过这个，但是在为“非阻塞获取”做了一个谷歌之后，然后探索了链接，我发现这两个是非常宝贵的讨论：

[http://www.ruby-forum.com/topic/126795](http://www.ruby-forum.com/topic/126795)（讨论多线程gets）

[http://www.ruby-forum.com/topic/121404](http://www.ruby-forum.com/topic/121404)（第二篇文章中对 Kernel.select 的解释）

这是如何使用它的示例。这将打印出您的提示并等待输入...如果五秒钟后没有输入，则程序将结束。如果有输入，只要有输入，它就会将其吐出并结束……显然，您可以出于自己的目的对其进行修改。

```
def prompt
  STDOUT.write "> "
  STDOUT.flush
end

def amusing_messages
  [ "You must enter something!", 
    "Why did you even start me if you just wanted to stare at me?", 
    "Isn't there anything better you could be doing?", 
    "Just terminate me already... this is getting old",
    "I'm waiting..."]
end

prompt

loop do
  read_array, write_array, error_array = Kernel.select [STDIN], nil, nil, 5

  if read_array.nil?
    puts amusing_messages[rand(amusing_messages.length)]
  else
    puts "Result is: #{read_array[0].read_nonblock(30)}" 
  end

  prompt 

end 
```

它可能不像你想的那么优雅，但它绝对可以完成工作，而无需处理线程。不幸的是，如果您想要更健壮的东西（定时器/向进程发送信号），这对您没有帮助，遗憾的是，我不知道这是否适用于 JRuby。很想知道它是否确实如此:)

# python - Django 模型字段如何工作？

> ID：500650
> 
> 赞同：12
> 
> 时间：2009-02-01T11:43:27.120
> 
> 标签：python, django, django-models

首先，我不喜欢网络编程。我碰到了 django 并阅读了一些关于模型的信息。我对以下代码（来自 djangoproject.com）很感兴趣：

```
 class Person(models.Model):
    first_name = models.CharField(max_length=50)
    last_name = models.CharField(max_length=50)

    def __str__(self):
        # Note use of django.utils.encoding.smart_str() here because
        # first_name and last_name will be unicode strings.
        return smart_str('%s %s' % (self.first_name, self.last_name)) 
```

根据我对 python 的理解，first_name 和 last_name 是类变量，对吧？这在代码中是如何使用的（因为我猜想设置 Person.first_name 或 Person.last_name 会影响所有 Person 实例）？为什么要这样使用？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-01T18:56:40.893

您的问题的本质是“这些类变量（我将 Field 对象分配给）如何突然变成 Django 的 ORM 中的实例变量（我分配给它）”？答案就是 Python[元类](http://docs.python.org/reference/datamodel.html)的魔力。

元类允许您挂钩和修改创建 Python 类的过程（不是创建该类的实例，而是创建类本身）。

Django 的 Model 对象（以及您的模型，它们是子类）有一个[ModelBase 元类](http://code.djangoproject.com/browser/django/trunk/django/db/models/base.py)。它查看模型的所有类属性，以及任何作为 Field 子类实例的实例，它会移动到字段列表中。该列表被分配为`_meta`对象的属性，这是模型的类属性。因此，您始终可以通过`MyModel._meta.fields`或访问实际的 Field 对象`MyModel._meta.get_field('field_name')`。

然后，该`Model.__init__`方法能够使用该`_meta.fields`列表来确定在创建模型实例时应该初始化哪些实例属性。

不要害怕深入研究 Django 源代码；这是一个很好的教育来源！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-01T11:57:17.077

是的，first_name 和 last_name 是类变量。它们定义将在数据库表中创建的字段。有一个包含 first_name 和 last_name 列的 Person 表，因此此时它们处于 Class 级别是有意义的。

有关模型的更多信息，请参阅： [http ://docs.djangoproject.com/en/dev/topics/db/models/](http://docs.djangoproject.com/en/dev/topics/db/models/)

在代码中访问 Person 的实例时，通常是通过 Django 的 ORM 进行的，此时它们基本上表现为实例变量。

有关模型实例的更多信息，请参阅： [http ://docs.djangoproject.com/en/dev/ref/models/instances/?from=olddocs](http://docs.djangoproject.com/en/dev/ref/models/instances/?from=olddocs)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-03-08T14:45:43.390

不是一个真正的答案，而是为了丰富：

```
Person.first_name 
```

行不通

```
p = Person.objects.get(pk=x)
p.first_name 
```

将工作。所以 person 的对象实例有名字和姓氏，但静态上下文 Person 没有。

另请注意：Django 有模型管理器，允许“人”执行静态查询集操作。（https://docs.djangoproject.com/en/dev/topics/db/managers/#managers）。

所以例如

```
peoples = Person.objects.all() 
```

# c++ - C++ 使用 scoped_ptr 作为成员变量

> ID：500656
> 
> 赞同：34
> 
> 时间：2009-02-01T11:45:59.220
> 
> 标签：c++, oop, smart-pointers

只是想对一个设计问题发表意见。如果你有一个 C++ 类而不是其他对象，你会使用智能指针来实现这一点吗？

```
class Example {
public: 
  // ...

private:
  boost::scoped_ptr<Owned> data;
}; 
```

“拥有”对象不能按值存储，因为它可能会在对象的整个生命周期中发生变化。

我的观点是，一方面，您明确该对象是拥有的并确保将其删除，但另一方面，您可以轻松地拥有一个常规指针并在析构函数中将其删除。这是矫枉过正吗？

**跟进：**只是想对您的所有回答表示感谢。感谢您对 auto_ptr 在复制整个对象时为另一个对象留下一个 NULL 指针的提醒，我已经广泛使用了 auto_ptr 但还没有想到这一点。除非我有充分的理由，否则我基本上将所有课程都设为 boost::noncopyable，因此无需担心。还要感谢有关异常中内存泄漏的信息，这也很高兴知道。我尽量不在构造函数中写可能导致异常的东西——有更好的方法——所以这不应该是一个问题。

不过，我还有另一个问题。当我问这个问题时，我想知道是否有人真的这样做了，你们似乎都提到理论上这是一个好主意，但没有人说他们真的这样做了。这让我感到惊讶！当然，一个对象拥有指向另一个对象的指针并不是一个新想法，我原以为你们都曾在某个时候做过。这是怎么回事？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-02-01T19:09:58.327

scoped_ptr 非常适合这个目的。但是必须了解它的语义。您可以使用两个主要属性对智能指针进行分组：

*   可复制：可以复制智能指针：副本和原始共享所有权。
*   可移动：可以移动智能指针：移动结果将拥有所有权，原来的将不再拥有。

这是相当常见的术语。对于智能指针，有一个特定的术语可以更好地标记这些属性：

*   所有权转移：智能指针是可移动的
*   所有权份额：智能指针是可复制的。如果智能指针已经是可复制的，则很容易支持所有权转移语义：那只是一个原子*复制和重置原始*操作，将其限制为某些类型的智能指针（例如，仅临时智能指针）。

`(C)opyable`让我们使用, 和`(M)ovable`,对可用的智能指针进行分组`(N)either`：

1.  `boost::scoped_ptr`: N
2.  `std::auto_ptr`: 米
3.  `boost::shared_ptr`： C

`auto_ptr`有一个大问题，它使用复制构造函数来实现 Movable 的概念。这是因为当 auto_ptr 被 C++ 接受时，与新的 C++ 标准相反，还没有一种方法可以使用移动构造函数本地支持移动语义。也就是说，您可以使用 auto_ptr 执行以下操作，并且它可以工作：

```
auto_ptr<int> a(new int), b;
// oops, after this, a is reset. But a copy was desired!
// it does the copy&reset-of-original, but it's not restricted to only temporary
// auto_ptrs (so, not to ones that are returned from functions, for example).
b = a; 
```

无论如何，正如我们所看到的，在您的情况下，您将无法将所有权转移给另一个对象：您的对象实际上是不可复制的。在下一个 C++ 标准中，如果您使用 scoped_ptr，它将是不可移动的。

要使用 scoped_ptr 实现您的类，请注意您是否满足以下两点之一：

*   在类的 .cpp 文件中写一个析构函数（即使它是空的），或者
*   制作`Owned`一个完全定义的类。

否则，当你创建一个 Example 的对象时，编译器会为你隐式定义一个析构函数，它会调用 scoped_ptr 的析构函数：

```
~Example() { ptr.~scoped_ptr<Owned>(); } 
```

然后，如果您没有完成上述两点中的任何一项，这将使 scoped_ptr call`boost::checked_delete`抱怨不完整。`Owned`如果您在 .cpp 文件中定义了自己的 dtor，则对 scoped_ptr 的析构函数的隐式调用将从 .cpp 文件中进行，您可以在其中放置`Owned`类的定义。

您对 auto_ptr 有同样的问题，但还有一个问题：为 auto_ptr 提供不完整的类型目前是未定义的行为（可能会在下一个 C++ 版本中修复）。因此，当您使用 auto_ptr 时，您*必须*在头文件中使 Owned 成为一个完整的类型。

shared_ptr 没有这个问题，因为它使用了一个多态删除器，它间接调用了删除。所以deleting函数不是在析构函数被实例化的时候被实例化，而是在shared_ptr的构造函数中创建deleter的时候。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-02-01T12:59:36.763

是个好主意。它有助于简化您的代码，并确保当您在对象的生命周期内更改 Owned 对象时，前一个对象会被正确销毁。

但是，您必须记住 scoped_ptr 是不可复制的，这使得您的类默认情况下不可复制，直到/除非您添加自己的复制构造函数等。（当然，在原始指针的情况下使用默认复制构造函数是不行的 -也没有！）

如果您的类有多个指针字段，那么在一种情况下使用 scoped_ptr 实际上可以提高异常安全性：

```
class C
{
  Owned * o1;
  Owned * o2;

public:
  C() : o1(new Owned), o2(new Owned) {}
  ~C() { delete o1; delete o2;}
}; 
```

现在，想象一下在构造 C 的过程中，第二个“new Owned”抛出异常（例如内存不足）。o1 将被泄露，因为 C::~C() （析构函数）不会被调用，因为对象尚未完全构造。但是，任何完全构造的成员字段的析构函数*都会*被调用。因此，使用 scoped_ptr 而不是普通指针将允许 o1 被正确销毁。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-01T11:52:47.803

这根本不是矫枉过正，这是一个好主意。

不过，它确实需要您的班级客户了解 boost。这可能是也可能不是问题。对于可移植性，您可以考虑 std::auto_ptr （在这种情况下）执行相同的工作。由于它是私有的，因此您不必担心其他人试图复制它。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-01T17:25:38.677

使用 scoped_ptr 是个好主意。

保持和手动销毁指针并不像你想象的那么简单。特别是如果您的代码中有多个 RAW 指针。如果异常安全和不泄漏内存是优先事项，那么您需要大量额外的代码才能使其正确。

首先，您必须确保正确定义所有四种默认方法。这是因为这些方法的编译器生成的版本对于普通对象（包括智能指针）来说很好，但在正常情况下会导致指针处理问题（寻找浅拷贝问题）。

*   默认构造函数
*   复制构造函数
*   赋值运算符
*   析构函数

如果您使用 scoped_ptr，那么您无需担心任何这些。

现在，如果您的类中有多个 RAW 指针（或构造函数的其他部分可以抛出）。您必须在构造和销毁过程中明确处理异常。

```
class MyClass
{
    public:
        MyClass();
        MyClass(MyClass const& copy);
        MyClass& operator=(MyClass const& copy);
        ~MyClass();

    private
        Data*    d1;
        Data*    d2;
};

MyClass::MyClass()
    :d1(NULL),d2(NULL)
{
    // This is the most trivial case I can think off
    // But even it looks ugly. Remember the destructor is NOT called
    // unless the constructor completes (without exceptions) but if an
    // exception is thrown then all fully constructed object will be
    // destroyed via there destructor. But pointers don't have destructors.
    try
    {
        d1 = new Data;
        d2 = new Data;
    }
    catch(...)
    {
        delete d1;
        delete d2;
        throw;
    }
} 
```

看看 scopted_ptr 是多么容易。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-01T11:53:06.617

作用域指针正好适合这一点，因为它们确保对象被删除，而您作为程序员不必担心它。我认为这是对作用域 ptr 的一个很好的使用。

我发现一个好的设计策略通常是尽可能避免手动释放内存，让你的工具（在这种情况下是智能指针）为你做。正如我所看到的，手动删除是不好的一个主要原因，那就是代码变得难以快速维护。内存分配和释放的逻辑在代码中通常是分开的，这导致互补的行没有一起维护。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-01T11:53:06.973

我认为这并不过分，这比使用原始指针更好地记录了成员的语义，并且不易出错。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-01T18:07:37.420

何为矫枉过正？boost::scoped_ptr 很容易优化，我敢打赌，生成的机器代码与手动删除析构函数中的指针一样。

scoped_ptr 很好 - 只需使用它:)

# c - 为 C 应用程序建模

> ID：500662
> 
> 赞同：3
> 
> 时间：2009-02-01T11:47:57.297
> 
> 标签：c, modeling

我想知道是否有任何工具可以帮助我为 C 应用程序建模，即函数式编程。例如，我目前正在构建一个共享库。但是为了直观地传达我的设计，我需要像 UML 这样的东西。我想这样做，这样审查我的设计的人就不需要阅读 100 页的函数、变量等。

我已经阅读了关于 C 的 UML，我正在考虑。如果那里有更好的东西，请告诉我。底线是可视化 C 应用程序和模块的设计，而无需阅读 100 页的文本，因为这需要时间并且对审阅者来说很困难。

这里的专家在这方面的任何帮助将不胜感激。

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-01T12:05:17.853

一个写得很好的文本文档会让你走得更远。远远超过任何 UML 图所能达到的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T10:15:49.667

你应该把它分成两部分：

*   你想说什么？
*   最好的表达方式是什么？

无论你用什么形式来回答第二部分，你都应该确保它不是模棱两可的。

UML 的好处是语言已经定义了很多语义，因此您不必在协作图中包含这些框、线和箭头的含义的定义。

但最重要的是，记录某些内容意味着为他人理解您正在记录的主题创建一条路径。一个非常精确的描述，不提供如何阅读它的线索，就像没有一样好。因此，使用 UML、有限状态机、ER 图、简单的英语，无论你想要什么，但一定要包含一个逻辑路径，你的“读者”可以遵循以了解正在发生的事情。

我有一个朋友是“不惜一切代价精确”的粉丝，它会要求我们在某种意义出现之前了解所有细节。

我曾经让他做这个实验：下次去一个不知名的城市时，他必须携带他能得到的最精确的地图。更好的是，他必须携带一张 1:1 的城市地图，每一个细节都按比例精确报告。这样他就不会迷路了！

他拒绝了，但我很想看到他尝试使用那张地图。甚至折叠它！:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T13:14:02.757

随你喜欢。这不是一个标准，但许多开发人员使用它并理解它。如果它确实可以帮助您与其他人交流并记录您的工作 -> 它适合您。如果它只需要太多时间并且你认为它没有效果，那就放弃它。另外，不要在意所有细节，只要它类似于 UML 并且您的团队可以使用它，就可以了。

它旨在帮助您，而不是浪费您的时间。

# c++ - 如何确定进程外 COM 服务器支持的线程模型？

> ID：500663
> 
> 赞同：2
> 
> 时间：2009-02-01T11:48:04.833
> 
> 标签：c++, visual-studio-2008, com, out-of-process

**问题**：

*   如何找到预定义**的进程外（基于 EXE）服务器**支持的**线程模型**：

***   使用[**oleview**](http://www.microsoft.com/downloads/details.aspx?familyid=5233b70d-d9b2-4cb5-aeb6-45664be858b6)吗？

    *   或者任何其他有效的方法？** 

 ****笔记：**

*   尝试连接到上述服务器以接收事件通知

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-10T05:35:48.107

恐怕问题是错误的。

线程模型（STA、MTA 等）是只适用于进程内 COM 对象的必要之恶，其中对象和客户端需要在同一个进程中共存，并且它们必须以某种方式防止相互踩踏（一个有趣且冗长的话题）。

进程外 (EXE) COM 服务器存在于它们自己的进程中，并在它们认为合适的时候管理它们自己的线程。COM 不知道——也不在乎。

所以没有任何与 EXE 相关的“线程模型”（在 COM 意义上）。

听起来您有一个特定的问题：如果您发布更多详细信息，我/某人/我们可能会提供帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-01T12:24:04.650

一个类的注册表项的绝对**最小**数量是：

*   [**LocalServer32\**](http://msdn.microsoft.com/en-us/library/ms683844(VS.85).aspx)（可执行文件的路径）- 本地进程外 EXE 服务器的位置
*   **InprocServer32\**（DLL 的路径）- 本地进程内 DLL 服务器的位置

**笔记：**

```
HKEY_LOCAL_MACHINE\SOFTWARE\Classes\CLSID\
{CLSID}\LocalServer32 = <full path>ServerExecutable 
```

# .net - 将控件拖放到表单上时，设计器页面未刷新

> ID：500666
> 
> 赞同：1
> 
> 时间：2009-02-01T11:48:51.647
> 
> 标签：.net, asp.net, webforms, code-behind

（是：ASP.Net 代码隐藏在网页上找不到控件）

我正在使用 VS 2008。

我不知道我需要翻转哪个秘密开关，或者我不小心绊倒了哪个绊线，但我在项目中创建的最后一个表单行为异常非常严重：代码隐藏显然无法找到我拥有的任何控件在表格上设置。代码隐藏文件存在，但它会在对表单上声明的控件的任何引用上生成编译错误。

最明显的线索是，在表单的标记中，第一行是：

```
<%@ Page Language="vb" AutoEventWireup="false" CodeBehind="UserSignature.aspx.vb"
  Inherits="EEI_App.UserSignature" %> 
```

并且 Intellisense 已在整个第一行下划线，给了我一些愚蠢的“无法加载文件或程序集”消息，它无法在我的应用程序文件夹中找到一个完全不相关的 DLL，并且引用正确设置.

起初，Intellisense 只是在“CodeBehind”设置下划线，说“找不到文件 UserSignature.aspx.vb”。- 然后由于某种原因，它也以关于 DLL 的其他消息开始。

我项目中的所有其他表单都可以正常编译和工作，并且此表单与任何其他表单之间没有明显区别。

我试过打开和关闭 Visual Studio；我已经尝试重新启动 - 没有任何区别。我添加到我的项目中的每个新表单都无法与其自己的代码隐藏通信 - 从创建新文件的那一刻起，标记给我“找不到文件'NewFile.aspx.vb'”错误！

有任何想法吗？

谢谢

* * *

我想我正在解决这个问题。@MatthewMartin，到目前为止，您绝对是最温暖的。

当我将控件放到表单上时，由于某种原因，form.aspx.designer.vb 似乎没有被刷新。我仍然不知道为什么会这样，但至少我们变暖了！

* * *

好的，这绝对是现在的问题，我已经重命名了这个问题以反映这一点：根本问题是当我将控件放到表单上时，我的 form.aspx.designer.vb 表单没有被刷新。至少对于解决方法的任何想法 - 如何**迫使**设计师刷新？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-01T14:05:02.620

您可以通过删除控件的文本并立即将其重新粘贴回原位来强制重新生成 aspx.vb.designer 页面。

还要检查页面背后的代码是否有一个 UserSignature 类和一个 EDI_App 命名空间。此外，根据您是否使用 Web 应用程序/Web 项目，默认命名空间可能会有所不同。您可以通过创建一个新文件并查看页面指令和后面代码中的类名声明之间的默认模式来验证。

最后，如果这是一个转换后的 1.1 应用程序，或者后面的代码没有说明的 2.0 应用程序

> 部分类

，那么您将负责声明所有控件引用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T11:58:53.517

你改名了吗？更改了基础/项目命名空间？特别看一下`EEI_App.UserSignature`——那是正确的名字吗？

为简单起见，请考虑重新创建页面、复制标记等。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-01T11:59:33.700

试试这个 ：

```
<%@ Page Language="vb" AutoEventWireup="false" CodeFile="UserSignature.aspx.vb" Inherits="EEI_App.UserSignature" %> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-01T13:59:01.510

您是否可能丢失了对 System.Web 的引用（或另一个重要的 dll，也许是您提到的那个 dll）？
当我尝试将页面或用户控件加载到 dll 解决方案时，我通常会遇到类似的问题。事实上，两次我们不得不将我们收到的文件加载到一个新项目中，这解决了它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-01T18:21:38.080

好的，我找到了自己的答案：

将所有工作代码提交到源代码控制，删除开发树，获取最新版本。

突然间一切又恢复了。它也解决[了我今天的另一个问题](https://stackoverflow.com/questions/500957/unable-to-launch-the-asp-net-development-server-because-port-1900-is-in-use)。

我将把答案归功于任何可以通过吹走我的开发树并重新开始干净来找出我翻转的秘密开关的人...... :)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-01T19:09:01.430

星期五我遇到了同样的问题。事实证明，在某些情况下，VS2008 不够智能（使用 VSS 作为源代码控制——我知道，但这是客户端所拥有的）无法同时检查 aspx、aspx.vb 和 Designer.vb。就我而言，我遇到了各种奇怪的行为，当然，Visual Studio 在试图“提供帮助”时无法查看 Designer.vb。

解决方案是重新签入页面，然后将控件放在页面上并保存（或删除控件 - 任何会导致 Designer.vb 更新的操作。）

# php - 在多维数组中放置多个相似的字段 - php mysql

> ID：500668
> 
> 赞同：1
> 
> 时间：2009-02-01T11:50:36.090
> 
> 标签：php, mysql

我想执行如下 SQL 查询：

```
从 'tb1','tb2' 中选择 'tb1'.'f1','tb1'.'f2','tb2'.'f1';

```

现在的问题是我想将它放入 PHP 中的数组中，例如：

```
$result['tb1']['f1'], $result['tb1']['f2'], $result['tb2']['f1']... 

```

知道如何实现上述目标吗？Afaik 没有执行上述操作的功能。我想知道最好的简单方法。除非必要，否则我不想使用像“select .. as ..”这样的查询。

我事先不知道这些字段是什么，所以我不能按照benlumley 的回答建议手动分配它们。

谢谢你，亚历克

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-01T12:10:39.950

您需要像已经在做的那样选择数据，然后循环遍历它，使其成为所需的格式，并且由于字段具有相同的名称，因此最容易使用别名，否则它们只会在返回的数据（但您可以改用 mysql_fetch_row，它返回一个数字索引数组）。

例如：

```
$sql = "select tb1.f1 as tb1f1,tb1.f2 as tb1f2,tb2.f1 as tb2f1 from tb1,tb2";
$result = mysql_query($sql);
while ($row = mysql_fetch_assoc($result)) {
    $result['t1']['f1']=$row['tb1f1'];
    $result['t1']['f2']=$row['tb1f2'];
    $result['t2']['f1']=$row['tb2f1'];
} 
```

（你的 sql 中的引用也是错误的）

那也不会处理多行，但是您的问题有点暗示您只期望一行？

没有别名：

```
$sql = "select tb1.f1,tb1.f2,tb2.f1 from tb1,tb2";
$result = mysql_query($sql);
while ($row = mysql_fetch_row($result)) {
    $result['t1']['f1']=$row[0];
    $result['t1']['f2']=$row[1];
    $result['t2']['f1']=$row[2];
} 
```

我更喜欢第一个版本，除非您有充分的理由使用第二个版本，因为如果您更改 sql 或添加字段等，它不太可能导致错误。

编辑：

从下面的响应中获取元数据的想法......

```
<?php
mysql_connect('localhost', 'username', 'password');
mysql_select_db('dbname');
$result = mysql_query('select tb1.f1, tb1.f2, tb2.f1 from tb1, tb2');
$meta = array();
for ($i = 0; $i < mysql_num_fields($result); ++$i) {
  $meta[$i] = mysql_fetch_field($result, $i);
}
while ($row = mysql_fetch_row($result)) {
   foreach($row as $key=>$value) {
     $out[$meta[$key]->table][$meta[$key]->name]=$value;
   }
} 
```

似乎完全符合您的要求-尽管您一次仍然只能获得一排。

轻松更新以在数组上存储具有另一个维度的多行：

改变：

```
$out[$meta[$key]->table][$meta[$key]->name]=$value; 
```

到：

```
$out[][$meta[$key]->table][$meta[$key]->name]=$value; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-06T03:58:51.873

既然你说你不能指定列别名，而且你不能事先知道查询的字段，我建议使用一个解决方案[`mysql_fetch_field()`](http://php.net/manual/en/function.mysql-fetch-field.php)来获取元数据信息：

```
<?php
mysql_connect('localhost', 'username', 'password');
mysql_select_db('dbname');
$result = mysql_query('select tb1.f1, tb1.f2, tb2.f1 from tb1, tb2');
for ($i = 0; $i < mysql_num_fields($result); ++$i) {
  $meta = mysql_fetch_field($result, $i);
  print_r($meta);
} 
```

您可以从此元数据信息中提取表名和列名，即使查询中有多个同名的列。

PHP的ext/mysqli也支持类似的功能[`mysqli_stmt::result_metadata()`](http://php.net/manual/en/mysqli-stmt.result-metadata.php)，但是你说不能事先知道查询的字段个数，使用起来很别扭[`mysqli_stmt::bind_result()`](http://php.net/manual/en/mysqli-stmt.bind-result.php)。

PDO_mysql 目前似乎不支持结果集元数据。

* * *

上述脚本的输出如下。

```
stdClass Object
(
    [name] => f1
    [table] => tb1
    [def] => 
    [max_length] => 1
    [not_null] => 0
    [primary_key] => 0
    [multiple_key] => 0
    [unique_key] => 0
    [numeric] => 1
    [blob] => 0
    [type] => int
    [unsigned] => 0
    [zerofill] => 0
)
stdClass Object
(
    [name] => f2
    [table] => tb1
    [def] => 
    [max_length] => 1
    [not_null] => 0
    [primary_key] => 0
    [multiple_key] => 0
    [unique_key] => 0
    [numeric] => 1
    [blob] => 0
    [type] => int
    [unsigned] => 0
    [zerofill] => 0
)
stdClass Object
(
    [name] => f1
    [table] => tb2
    [def] => 
    [max_length] => 1
    [not_null] => 0
    [primary_key] => 0
    [multiple_key] => 0
    [unique_key] => 0
    [numeric] => 1
    [blob] => 0
    [type] => int
    [unsigned] => 0
    [zerofill] => 0
) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T12:19:33.817

用简短的表名前缀字段名是实现它的好方法，而无需在 select 中创建别名。当然，您不会得到您描述的确切结构，但每个字段在结果数组中都有其唯一的命名索引。例如，假设您有表用户，并且用户有一个名称，则将此字段称为 usr_name。

# linq-to-sql - 如何在 linq to sql 查询中调用 UDF？

> ID：500676
> 
> 赞同：7
> 
> 时间：2009-02-01T11:56:28.590
> 
> 标签：linq-to-sql

以下 sql 语句如何转换为 linq 查询？

```
select ID, 
       Price, 
       dbo.fGetText(DescriptionID, defaultLanguage, currentUserLanguage) 
from Products 
```

UDF fGetText 相当丰富并在整个代码库中使用，因此需要对其进行封装（作为 UDF 或其他方式，可能是 Linq 表达式）。

额外往返数据库服务器不是一种选择。应该只有一个查询，检索 3 个字段。

非常感谢您的帮助。非常感谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-01T12:02:42.727

这是 MSDN 文章：

[如何：内联调用用户定义的函数 (LINQ to SQL)](http://msdn.microsoft.com/en-us/library/bb399416.aspx)

来自同一页面的注释：

> 尽管您可以内联调用用户定义的函数，但包含在执行被延迟的查询中的函数在执行查询之前不会执行。有关详细信息，请参阅 LINQ 查询简介。
> 
> 当您在查询之外调用相同的函数时，LINQ to SQL 从方法调用表达式创建一个简单查询

~~另外，看看这个[13 分钟的截屏视频。](http://www.microsoft.com/uk/msdn/screencasts/screencast/208/User-Defined-Functions-in-LINQ-to-SQL.aspx)~~

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-01T12:02:57.627

您可以将 UDF 添加到 LINQ to SQL DBML 文件中，就像添加表和存储过程一样。

然后它们成为 DataContext 上的可执行方法。

谷歌有很多文章，像~~[这样](http://dotnet.org.za/hiltong/archive/2008/05/21/using-user-defined-functions-udfs-with-linq-to-sql-and-in-linq-to-sql-where-clauses.aspx)~~。

# asp.net-mvc - 为什么 Visual Studio 在使用 MVC RC1 打开 ASPX 时会崩溃

> ID：500696
> 
> 赞同：24
> 
> 时间：2009-02-01T12:10:57.827
> 
> 标签：asp.net-mvc, visual-studio-2008

*   从 MVC Beta 升级到 MVC RC1。
*   重新指向项目中的所有引用以指向新程序集
*   重新启动
*   一切都编译（并运行！）
*   但...

在 VS 中打开视图（.aspx），她就消失了！事件查看器提供：

```
NET Runtime version 2.0.50727.3053 - Fatal Execution Engine Error (6E075E00) (80131506) 
```

**更新 1：**
并非所有 .aspx 页面！
另外 - 似乎在 StackOverflow 上写问题是解决办法！gr

**更新 2：**
自发布问题以来没有问题，但是：我拥有的唯一插件是 VisualSVN 和 Resharper。我似乎确实在 GAC 中为 System.Web.Mvc 提供了一些东西 - 但它看起来像是错误的版本，我无法摆脱它。

我相信它在.aspx页面的代码呈现过程中一定与一些智能色彩或类似的东西有关——但现在它已经停止了，很难确认......

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-02-19T15:32:43.617

尝试删除所有 bin/obj 目录，并清除 Temporary ASP.NET Files 和 %TEMP% 目录。然后从 VS2008 命令提示符发出以下命令：

```
ngen /delete System.Web.Mvc
ngen /delete System.Web.Abstractions
ngen update 
```

还要确保您的所有引用（MvcContrib，任何其他针对 MVC 构建的）都指向与所有其他引用相同的 MVC 版本。

这似乎对我有用（到目前为止）

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-04T11:23:47.267

如果它们引用 System.Core v3.5，则有一些框架错误会影响所有 VS 加载项等。首先清除 NGen 缓存。“ngen update”、“ngen /delete [assemblyname]”或一个全面的“ngen /delete *”通常可以解决问题

此处（和/或类似）问题的更多详细信息+解决方法：

[http://forum.huagati.com/topic5-addin-causes-ide-to-close.aspx](http://forum.huagati.com/topic5-addin-causes-ide-to-close.aspx)

[http://code.msdn.microsoft.com/PowerCommands/WorkItem/View.aspx?WorkItemId=8](http://code.msdn.microsoft.com/PowerCommands/WorkItem/View.aspx?WorkItemId=8)

[http://www.jetbrains.net/devnet/thread/274657](http://www.jetbrains.net/devnet/thread/274657)

**更新：**终于有人来自 MSFT 承认存在问题：http: [//blogs.msdn.com/jnak/archive/2009/02/15/potential-crash-in-vs-when-using-the-mvc-rc -on-windows-azure.aspx](http://blogs.msdn.com/jnak/archive/2009/02/15/potential-crash-in-vs-when-using-the-mvc-rc-on-windows-azure.aspx)

**更新 2：**尝试解决方法（VS2008 插件）：[http ://www.huagati.com/ProjectLoader/](http://www.huagati.com/ProjectLoader/)

**更新 3：** Microsoft 有一个修复此问题的 CLR 补丁 (KB963676)。它不能从 microsoft.com 下载，但可以通过 MSFT 支持/PSS 请求。

**更新 4：** CLR 补丁现在可以从 Microsoft Connect 下载：

[https://connect.microsoft.com/VisualStudio/Downloads/DownloadDetails.aspx?DownloadID=16827&wa=wsignin1.0](https://connect.microsoft.com/VisualStudio/Downloads/DownloadDetails.aspx?DownloadID=16827&wa=wsignin1.0)

[http://blogs.msdn.com/jnak/archive/2009/02/26/fix-available-asp-net-mvc-rc-crash-in-a-windows-azure-cloud-service-project.aspx](http://blogs.msdn.com/jnak/archive/2009/02/26/fix-available-asp-net-mvc-rc-crash-in-a-windows-azure-cloud-service-project.aspx)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-01T16:18:05.550

我必须删除 PowerCommands 加载项才能让 VS 再次工作。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-01T12:47:26.380

我以前也遇到过这样的问题。它是网络表单编辑器。如果您右键单击 aspx 文件并选择“打开方式...”并选择 Html-editor，则 ide 很可能不会在您身上崩溃。

尝试一一禁用插件。

对我来说，我认为这是 Gallio 和 testdriven.net 之间的冲突。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-03T07:13:15.947

Microsoft 现已发布修补程序来解决此问题。

请参阅[https://connect.microsoft.com/VisualStudio/Downloads/DownloadDetails.aspx?DownloadID=16827&wa=wsignin1.0](https://connect.microsoft.com/VisualStudio/Downloads/DownloadDetails.aspx?DownloadID=16827&wa=wsignin1.0)

Phil Haack 在这里进一步阐述 - [http://haacked.com/archive/2009/03/06/hotfix-for-installing-aspnetmvc.aspx](http://haacked.com/archive/2009/03/06/hotfix-for-installing-aspnetmvc.aspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-01T16:27:37.170

我遇到了同样的问题，并在[http://forums.asp.net/t/1378448.aspx的官方 ASP.NET MVC 论坛上发布了回复](http://forums.asp.net/t/1378448.aspx)

我不确定，但是您是否还看到对未出现在视图中的 Html 助手的引用（当它们不崩溃时）？

我没有安装 Gallio，但我有 Resharper。我会看看禁用它是否有帮助（尽管这会给我带来很多痛苦）。

更新：Resharper 不是问题，而是插件“Huagati DBML/EDMX Tools”。似乎有些插件可能会发生冲突，我鼓励人们禁用所有插件作为调试崩溃的初步步骤。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-08-16T16:43:21.723

我发现母版页或页面本身的任何编译问题——甚至是警告——都可能导致这种情况发生。所以关闭项目，删除bin和obj目录，然后重新打开项目。接下来打开您的母版页和任何其他最近更改的 aspx/ascx 文件。在编译之前打开所有文件很重要。

现在，一次查看每一页，编译项目并解决警告。解决所有警告后，关闭页面并尝试重新打开它们。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-01T15:18:23.830

我得到了完全相同的错误。起初我以为是 Spark View Engine 插件（因为它在打开视图时崩溃了），但在 Christian 对 Gallio 和 TestDriven.NET（我都有）发表评论之后，我卸载了 Gallio，现在它可以工作了。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-04T17:20:48.543

问题确实是 VS 2008 的 powercommands。如果没有它们，请卸载它们，并且 aspx 页面/设计器将正常打开。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-10T08:01:51.123

实际上，我认为我的问题是一些 Beta MVC DLL 的流氓副本。

我将它们全部删除，卸载了 RC1，并确保它们都离开了 GAC，然后重新安装了 RC1。到目前为止，一切似乎都很好。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-12-16T23:45:37.513

`System.Web.Mvc`在将引用设置为to后，这发生在我身上`Copy Local = True`。这将 System.Web.Mvc.dll 文件放在我的 bin 文件夹中。

下次我打开任何 aspx 页面时，Visual Studio 崩溃了。将 bin 中的 dll 更改为 System.Web.Mvc.dll.bak 解决了该问题。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-08-30T06:46:30.500

我终于（在尝试了几天之后）通过卸载 Spark View Engine 插件解决了这个问题，该插件在打开`.aspx`和`.js`文件时崩溃了！

# c# - 关于 Global.asax 和 SQL 输出缓存的 UrlRewriting

> ID：500697
> 
> 赞同：3
> 
> 时间：2009-02-01T12:11:38.933
> 
> 标签：c#, asp.net, sql, caching, url-rewriting

我正在为我的主要类别页面执行 UrlRewrite。转换：

```
www.mysite.com/Category.aspx?id=2 
```

到

```
www.mysite.com/Dogs 
```

为此，我使用 `Global.asax`'s`Application_BeginRequest`执行以下代码（伪代码）：

```
protected void Application_BeginRequest(Object sender, EventArgs e)
{
    if (IsCategoryUrl())
    {
        string CategoryName = ParseCategoryNameFromUrl(Request.Url);
        string CategoryId = GetCategoryIdByNameFromDB( CategoryName );
        Context.RewritePath("/Category.aspx?id=" + CategoryId);
    }
} 
```

我的问题是：

1.  这是执行 URL 重写的正确方法吗？（这是我第一次这样做）。
2.  此代码导致几乎每个请求都从数据库读取，有没有办法缓存它？我为 SQL 缓存找到的唯一技术需要一个`<%@ Page %>`指令，这在`global.asax`. 还有其他解决方案吗？

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-01T12:17:50.013

缓存数据库查询没有任何问题。对于每个类别名称，您可以将 ID 存储在字典中，作为在特定时间段后过期的示例。在这种情况下，这将删除数据库调用。举个例子：

```
Dictionary<string, int> categoryIdLookup; 
```

这可以存储在 HTTP 缓存中并进行检索，如果它为空（即从未添加过或已超出缓存）构建字典，查找正确的 Id，然后进行重写。

# windows - qt在windows上的配置

> ID：500701
> 
> 赞同：0
> 
> 时间：2009-02-01T12:13:48.510
> 
> 标签：windows, qt, configuration, development-environment

我在我的 vista 笔记本电脑上安装和配置 qt 时遇到了一些问题。

我正在尝试在我的笔记本电脑上设置一个开发环境，我从命令行编译，因为这就是我大学的 linux 机器上设置环境的方式，所以我不想将自己绑定到某个 IDE ..（另外，*真正的*程序员使用命令行！）

我以前没有使用命令行进行 C++ 开发，都是 MSVC，所以现在我遇到了一些麻烦。

我仍在使用 MSVC，但从命令行。我几乎不知道发生了什么，我只知道我必须运行：

```
qmake
nmake 
```

编译我的代码！

我下载了 qt 的开源版本，并进行了配置，并尝试了一个简单的 qt 应用程序（来自教程），它工作正常，编译和执行几乎与预期一致。

现在，当我决定运行另一个使用 opengl 的项目时，我收到以下错误：

```
fatal error C1083: Cannot open include file: 'qgl.h': No such file 
or directory 
```

我不确定编译器在哪里查找头文件，并且我没有在任何地方复制任何头文件，我认为`configure.exe`它以某种方式发挥了它的魔力并将包含目录添加到一个或多个环境变量或某个注册位置或其他MSVC 编译器搜索以查找包含目录的其他特殊位置。

但是，我所做的是搜索我的`C:\qt\include\`文件夹以确保它`qgl.h`存在，并且确实存在。那为什么`nmake`找不到呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T14:15:12.740

我认为对此的实际解决方案在您的专业文件中：

QT += opengl

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T15:08:08.173

如果你想继续使用命令行（再加上稍后/并行在 linux 机器上使用它），我建议至少尝试一下 Qt 的 MinGW 版本。我经常使用它，除了不存在 GUI 之外，它工作得很好。使用 MinGW 的另一个优点是您可以简单地下载和安装 Qt 的 MinGW 版本，而无需重新配置或重新编译任何东西。

此外，尝试[QtCreator](http://www.qtsoftware.com/developer/qt-creator/qt-creator)可能会很有趣。它仍然是测试版，需要测试版 Qt 4.5，但它是一个不错的小型 IDE，可以很好地与 gcc 集成。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-01T15:22:35.740

两个潜在的解决方案（他们解决了我工作场所的问题）

PATH 变量中有 qt include 和 bin 文件夹吗？我认为文档说只需要其中一个，但其中一名学生拥有 Vista，而将另一个学生放在 PATH 变量中解决了“无法打开包含文件”的问题。

如果您使用的是 MSVC，您是否从 Visual Studio 命令提示符运行了 configure 和 nmake？我们在使用裸 Windows 命令提示符时遇到了问题，因为 VS 在配置过程中添加了很多临时环境变量。

祝你好运

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-01-06T11:21:15.980

安装[完整的 Qt SDK for Windows](http://get.qt.nokia.com/)，其中包括 Qt 4.6 SDK、Qt Creator 1.3 和 MinGW。

它还将安装“Qt 命令提示符”启动器，您可以使用它从命令行构建 Qt 应用程序。

我相信你对 MSVC 比对 MinGW 更熟悉，我也一样（我一直在使用 MSVC 6.0 到 MSVC# 2008 来开发 .NET 应用程序）。

但是尝试使用 Qt 的 MinGW，我认为从长远来看它会更好。我也在 Linux 上进行了一些 C++ 开发，因此熟悉 MinGW 将有助于您进行跨平台 C++/Qt 开发。

有关详细信息，请参阅[为 Windows 安装 Qt 4.6 SDK](http://qt-mobility.blogspot.com/2009/12/installing-qt-46-sdk-in-windows-7.html)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-01T14:58:08.270

Qmake 从当前目录中的 *.pro 文件生成 Makefile。它已经编译了qt路径。输入“qmake -v”来查看它。编译后不能移动qt的目录。如果您还没有移动它，请首先尝试按照 INSTALL 文件中的说明安装 Qt。祝你好运。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-01T16:09:59.373

Qt 的开源版本不提供配置文件（qt 术语中的 mkspecs），因此 qmake 可以生成与 nmake (msvc) 兼容的 makefile。

你必须使用 mingw/gcc。

# wix - 如何让 Wix 更新以前安装的程序版本

> ID：500703
> 
> 赞同：74
> 
> 时间：2009-02-01T12:14:22.720
> 
> 标签：wix, installation

我用 Wix 编写了一个安装程序，它可以很好地安装我的程序。现在我需要更新它，所以我提高了版本号，但是当我在旧程序上安装新程序时，它抱怨已经安装了旧版本并告诉我先卸载它。

如何在重新安装之前更新或自动卸载它？

* * *

## 回答 #1

> 赞同：107
> 
> 时间：2014-10-13T16:33:25.783

我觉得所提供的答案都不是完整的或独立的，所以在我通过这个沼泽挖掘我的方式之后，以下是我认为获得更新的（完全不言而喻的）要求所必需的步骤：

1.  确保每次构建时您的产品 ID 都会更改。如果不这样做，您将始终收到 OP 提到的“已安装”消息。

    ```
    <Product Id="*" ...> 
    ```

2.  每次产品本身更改时更改产品版本。我想最好的选择是将它绑定到一个程序集版本（它也应该是自动递增的），但当然你也可以手动更改它。如果您在第 4 点中使用 AllowSameVersionUpgrades 属性，则此步骤不是严格要求的，但我敢说，在任何情况下保持产品版本不变都是不好的做法。

    ```
    <Product Version="!(bind.FileVersion.MyAssemblyDll)" ...>
    <File Id="MyAssemblyDll" Name="$(var.001_Application.MyAssembly.TargetFileName)" Source="$(var.001_Application.MyAssembly.TargetPath)" /> 
    ```

3.  保持您的 UpgradeCode 不变（例如）：

    ```
    <Product UpgradeCode="f4d7f199-28f6-45d5-ad99-7c62938274be" ...> 
    ```

4.  添加 MajorUpgrade 元素（来自 Wix 3.5.1315.0）。要绕过 MajorUpgrade 将忽略产品版本的修订号更改的问题，请添加 AllowSameVersionUpgrades（或者如果您更喜欢 AllowDowngrades）属性。这样，您将能够从 eg 升级`1.0.0.7`到`1.0.0.8`. 而不仅仅是从`1.0.7.0`到`1.0.8.0`。如果您不这样做，您可能会在程序和功能中看到多个安装。

    ```
    <MajorUpgrade AllowSameVersionUpgrades="yes" DowngradeErrorMessage="A newer version of [ProductName] is already installed." /> 
    ```

这是我的整个 .wix 文件（相关部分，导致用于产品绑定的程序集的两个片段大多是可选的，为了说明，任何可以获取程序集的方法都可以）：

```
<?xml version="1.0" encoding="UTF-8"?>
<?define ProductVersion="!(bind.FileVersion.MyAssemblyDll)"?>
<?define UpgradeCode="f4d7f199-28f6-45d5-ad99-7c62938274be"?>

<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi" xmlns:netfx="http://schemas.microsoft.com/wix/NetFxExtension">
  <Product
    Id="*"
    Name="My Product's name"
    Language="1033"
    Version="$(var.ProductVersion)"
    Manufacturer="My company"
    UpgradeCode="$(var.UpgradeCode)"
    Codepage="1252">

    <Package
      InstallerVersion="200"
      Compressed="yes"
      InstallScope="perUser"
      Description="My product description"
      Manufacturer="My company"
      Languages="1033"
      SummaryCodepage="1252"
      InstallPrivileges="limited" />

    <MajorUpgrade AllowSameVersionUpgrades="yes" 
                  DowngradeErrorMessage="A newer version of [ProductName] is already installed. If you are sure you want to downgrade, remove the existing installation via Programs and Features." />

  </Product>

  <Fragment>
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="LocalAppDataFolder">
        <Directory Id="INSTALLFOLDER" Name="My Install Dir" >
          <Component Id="INSTALLFOLDER" Guid="f6ba8a12-6493-4911-8edd-dce90e1d8e8b" >
            <RemoveFolder On="both" Id="INSTALLFOLDER"/>
            <RegistryValue Root="HKCU" Key="Software\[Manufacturer]\[ProductName]" Type="string" Value="My Registry value" />
          </Component>
        </Directory>
      </Directory>
    </Directory>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="ProductComponents" >
      <Component Id="ProductComponent" Guid="1939f0f5-19f6-498b-bf95-8f1c81501294" DiskId="1" Directory="INSTALLFOLDER" >
        <File Id="MyAssemblyDll" Name="$(var.001_MyApplication.MyAssembly.TargetFileName)" Source="$(var.001_MyApplication.MyAssembly.TargetPath)" />
      </Component>
    </ComponentGroup>
  </Fragment>
</Wix> 
```

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2010-01-05T13:12:06.380

我检查了上面提到的所有帖子，*仍然*花了很长时间试图让它发挥作用。

第3 步中关于升级的[官方 HOWTO](http://wix.sourceforge.net/manual-wix3/major_upgrade.htm)**提示**很有帮助：您需要一个新的来禁用消息“已安装此产品的另一个版本”。`Product/@Id`

我使用了这个升级部分（产品的孩子）：

```
<Upgrade Id="$(var.UpgradeCode)">
  <UpgradeVersion Minimum="1.0.0"
                  IncludeMinimum="yes"
                  OnlyDetect="no"
                  Maximum="$(var.Version)"
                  IncludeMaximum="no"
                  Property="PREVIOUSFOUND" />
</Upgrade> 
```

请注意，`OnlyDetect`设置为“否”。如果您有以下部分（产品的子项），则会触发旧版本的删除：

```
<InstallExecuteSequence>
  <RemoveExistingProducts After="InstallInitialize"/>
</InstallExecuteSequence> 
```

另请注意，显然，只有版本号的前三个组件用于检查升级......

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-01T15:31:03.383

您需要使用升级表：

```
<Upgrade Id='15E2DAFB-35C5-4043-974B-0E342C25D76A'>
    <UpgradeVersion Property='OLDVERSIONFOUND' IncludeMinimum='no' Minimum='0.0.0.0' />
</Upgrade> 
```

您还需要添加一个操作：

```
<InstallExecuteSequence>
    <LaunchConditions After='AppSearch' />
    <RemoveExistingProducts After='InstallValidate' />
</InstallExecuteSequence> 
```

[这是一个教程](https://www.firegiant.com/wix/tutorial/upgrades-and-modularization/replacing-ourselves/)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2017-04-20T07:03:24.187

我试过这个，它对我有用。

1.  像这样放置您的产品标签：

    > 产品 ID="*" Name="Something" Language="1033" Version="1.0.0.0" Manufacturer="Someone" UpgradeCode="43ab28d7-6681-4a05-a6b5-f980733aeeed"

产品 ID 应设置为 *，以便每次构建项目时，都需要不同的 ID。

2.  在您的 Package 元素中嵌套一个 MajorUpgrade 标记，如下所示：

    > " MajorUpgrade AllowDowngrades="no" DowngradeErrorMessage="已安装较新版本的 [ProductName]。" AllowSameVersionUpgrades="yes" /

因此，每次您更新您的版本（或您的版本相同，不低于当前版本）时，它都会通过删除以前的文件并安装产品文件来重新安装您的产品。它**不会降级**您的产品。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2014-03-21T11:29:32.900

只需将此元素放在元素下`Product`：

```
<MajorUpgrade AllowDowngrades="yes" /> 
```

[此 HowTo](http://wixtoolset.org/documentation/manual/v3/howtos/updates/major_upgrade.html)中的更多信息

# visual-studio - 检查私有程序集

> ID：500705
> 
> 赞同：0
> 
> 时间：2009-02-01T12:16:33.370
> 
> 标签：visual-studio

私有程序集只能由该应用程序使用。如何检查它对其他应用程序不可用？是需要内网还是单机检查？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-01T12:29:03.080

简短的回答：你不能。

长答案：改为将您的公共成员声明为 internal 并使用[InternalsVisibleToAttribute](http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.internalsvisibletoattribute.aspx)使它们对您要授予访问权限的程序集可见。请记住，这不是 100% 的“保护”，其他程序集仍然可以通过反射消耗您的程序集。

# c# - 如何使用 ThreadPool 类

> ID：500711
> 
> 赞同：5
> 
> 时间：2009-02-01T12:21:52.033
> 
> 标签：c#

```
namespace ThPool
{
    class Program
    {
        private static long val = 0;
        private static string obj = string.Empty;

        static void Main(string[] args)
        {
            Thread objThread1 = new Thread(new ThreadStart(IncrementValue));
            objThread1.Start();
            Thread objThread2 = new Thread(new ThreadStart(IncrementValue));
            objThread2.Start();
            objThread1.Join();
            objThread2.Join();

            Console.WriteLine("val=" + val + " however it should be " + (10000000 + 10000000));

            Console.ReadLine();
        }

        private static void IncrementValue()
        {
            for (int i = 0; i < 10000000; i++)
            {
                Monitor.Enter(obj);
                val++;
                Monitor.Exit(obj);
            }
        }
    }
} 
```

如何使用`ThreadPool`类来替换线程和监视器？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-01T13:02:30.330

有几种方法可以使用线程池。对于您的任务，您应该查看以下内容。

*   如果你只需要一个任务来运行，最简单的方法是使用`QueueUserWorkItem`，它只需要一个委托来运行。缺点是您对工作几乎没有控制权。委托无法返回值，您也不知道运行何时完成。
*   如果你想要更多的控制，你可以使用委托的`BeginInvoke`/`EndInvoke`接口。这会安排代码在线程池线程上运行。`IAsyncResult`您可以通过返回的句柄查询状态`BeginInvoke`，您可以通过 获取结果（以及工作线程上的任何异常）`EndInvoke`。

要正确使用`Enter`/ `Exit`on `Monitor`，您必须确保`Exit`始终调用它。因此，您应该将`Exit`呼叫放在 finally 块中。

但是，如果您不需要为 提供超时值`Enter`，则最好只使用`lock`关键字，该关键字会编译成适当的`Enter`and`Exit`调用集。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-01T12:48:11.840

```
EventWaitHandle[] waitHandles = new EventWaitHandle[2];

for(int i = 0; i < 2; i++)
{
    waitHandles[i] = new AutoResetEvent(false);
    ThreadPool.QueueUserWorkItem(state =>
    {
        EventWaitHandle handle = state as EventWaitHandle;
        for(int j = 0; j < 10000000; j++)
        {
            Interlocked.Increment(ref val); //instead of Monitor
        }
        handle.Set();
    }, waitHandles[i]);
}

WaitHandle.WaitAll(waitHandles);
Console.WriteLine("val=" + val + " however it should be " + (10000000 + 10000000)); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-01T12:41:32.463

你应该调查一下[`ThreadPool.QueueUserWorkItem()`](http://msdn.microsoft.com/en-us/library/system.threading.threadpool.queueuserworkitem.aspx)。它需要一个在线程池线程上运行的委托，并传入一个状态对象。

IE

```
string fullname = "Neil Barnwell";
ThreadPool.QueueUserWorkItem(state =>
{
    Console.WriteLine("Hello, " + (string)state);
}, fullname); 
```

不要被`Control.BeginInvoke()`. 这将封送对创建控件的线程的调用，以防止跨线程调用更新控件的问题。如果您想在 Windows 窗体上进行简单的多线程处理，请查看[BackgroundWorker](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-01T12:41:27.237

您可以使用`BeginInvoke`, `EndInvoke`。它在幕后使用线程池，但更容易编程。看这里：

[http://msdn.microsoft.com/en-us/library/2e08f6yc.aspx](http://msdn.microsoft.com/en-us/library/2e08f6yc.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-01T14:13:53.040

除了最简单的事情之外，不要将线程池用于任何事情。事实上，获取线程池线程上的锁是极其危险的。但是，您可以安全地使用 Interlocked API。

# c# - 是否所有局部变量都进入堆栈

> ID：500712
> 
> 赞同：2
> 
> 时间：2009-02-01T12:23:32.123
> 
> 标签：c#, memory

A 与 B 的堆栈和堆上的内存开销是多少

A：

```
private string TestA()
{
     string a = _builder.Build();
     return a;       
} 
```

乙：

```
private string TestB()
{
     return _builder.Build();
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-01T12:42:23.943

重新效率问题；两者是相同的，并且在发布模式下会简化为相同的东西。无论哪种方式，`string`都是引用类型，所以它`string`本身总是在堆上。堆栈上唯一的东西是对`string`- 几个字节的引用（无论字符串长度如何）。

“是否所有局部变量都进入堆栈”：否；有两个例外：

*   捕获的变量（匿名方法/ lambdas）
*   迭代器块（`yield return`等）

在这两种情况下，幕后都有一个编译器生成的类：

```
int i = 1;
Action action = delegate {i++;};
action();
Console.WriteLine(i); 
```

类似于：

```
class Foo {
    public int i; // yes, a public field
    public void SomeMethod() {i++;}
}
...
Foo foo = new Foo();
foo.i = 1;
Action action = foo.SomeMethod;
action();
Console.WriteLine(foo.i); 
```

因此`i`在对象上，因此在堆上。

迭代器块以类似的方式工作，但使用状态机。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T12:28:00.850

它们都针对同一事物进行了优化。

在回答标题中的问题“所有局部变量都进入堆栈”时，简单的答案并不完全正确。无论如何，所有对象都存储在“堆”上（不记得在.NET中是否这样称呼它）。C# 有一个基于分代的垃圾收集器，它知道某些对象只存在很短的时间，因此旨在有效地管理这一点。

# asp.net - asp.net webforms 和 jquery：如何在回发之间保存/恢复 jquery 状态？

> ID：500728
> 
> 赞同：4
> 
> 时间：2009-02-01T12:44:29.867
> 
> 标签：asp.net, jquery, user-interface, webforms, postback

我正在构建一个 asp.net webforms (3.5 sp1) 应用程序，使用 jquery 来为 UI 设置动画，更改其状态。在我开始进行回发之前，它一直运行良好，UI 显然会将自身重置为其初始状态。

所以我的问题是，在回发之间保存和恢复 jquery/UI 状态的最佳实践是什么？

谢谢，埃吉尔。

**更新：**非常感谢大家，很好的输入，糟糕的是我不能将多个答案标记为“答案”。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-01T13:44:25.940

我通常通过 AJAX 在会话中存储诸如菜单状态或过滤器（div 中的一组输入）可见性等内容。当菜单展开或过滤器显示时，单击处理程序将向 Web 服务触发 AJAX 事件，该 Web 服务将记录菜单状态或过滤器在用户会话中的可见性。在回发时，我使用与每个菜单/过滤器对应的会话变量通过 CSS 设置它的初始状态。我发现这是更好的用户体验，因为如果您在客户端进行更改，则在加载后由 javascript 更新页面时页面不会*闪烁。*

示例——因为我在路上，这不是来自项目的实际代码，可能不完整。使用 jQuery。Web 服务的 URL 将取决于您如何实现 Web 服务。我正在使用 ASP.NET MVC（主要是）所以我的将是一个控制器动作。

```
<script type='text/javascript'>
    $(document).ready( function() {
       $('#searchFilter').click( function()  {
           var filter = $(this);
           var filterName = filter.attr('id');
           var nowVisible = filter.css('display') === 'none';
           if (nowVisible) {
              filter.show();
           }
           else {
              filter.hide();
           }
           $.post('/controller/SetFilterVisibility',
                  { name: filterName, visibility: nowVisible } );
       });
    });
</script>

<div id='searchFilter' <%= ViewData["searchFilterVisibility"] %> >
    ...
</div> 
```

服务器端代码

```
[AcceptVerbs( HttpVerbs.POST )]
[Authorization]
public ActionResult SetFilterVisibility( string name, bool visible )
{
    Session[name] = visible;
    return Content( string.Empty );  // not used... 
}

[AcceptVerbs( HttpVerbs.GET )]
[Authorization]
public ActionResult SomeAction( int id )
{
    ...
    ViewData["searchFilterVisibility"] = Session["searchFilter"];
    ...
    return View();
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-01T14:49:19.413

我认为您指的是在回发之间保存 ui 小部件的状态（而不是保存用户首选项）。

在特定系列的交互之后（例如，展开此树节点、单击该网格行等），许多该状态仅适用于特定小部件、特定用户。这些东西不必进入数据库，甚至不必进入会话，除非跨页面加载恢复状态对您很重要。

我倾向于将所有这些东西放入一个或两个对象中，例如：

```
treeState.expandedNodeId = 'foo';
gridState.selectedRowIndex = 3; 
```

然后我定期将其保存在隐藏字段中：

```
$('.treeState').val(Sys.Serialization.JavaScriptSerializer.serialize(treeState)); 
```

等等

该值与回发结果一起发回，我只是`deserialize`使用它并从保存的值中恢复我的小部件。烦人，但效果很好。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-01T13:00:19.193

你有两个选择：

*   客户端cookie
*   通过 postback 或 webmethod 调用在服务器端存储 UI 设置

第二个选项将需要更多的努力，但允许您提供可以应用于用户的“便携式”UI 设置，而不管客户端机器如何。如果设置是“丢弃”，我会选择客户端 cookie。

如何使用 javascript 和 cookie：

[http://techpatterns.com/downloads/javascript_cookies.php](http://techpatterns.com/downloads/javascript_cookies.php)

我通常通过回发将 UI 设置服务器端存储在数据库中，但是如果用户通过 jQuery 更改他们的 UI 并且您希望保留这些更改，我可能会这样做：

*   将脚本管理器添加到您的 aspx 页面
*   设置 EnablePageMethods="true"
*   在您的代码隐藏中创建一个 WebMethod
*   在更新 UI 的 jQuery 方法中，添加对 WebMethod 的调用并传回 UI 设置
*   将传递给 WebMethod 的任何设置存储在数据库中
*   然后当用户下次访问该页面时，要么获取设置并填充尽可能多的控件服务器端，要么使用 jQuery 就绪方法调用另一个从数据库中获取 UI 设置的 web 方法，传递它们回到 jQuery 允许您填充控件。

这是一篇关于 jQuery 和 WebMethod 调用的不错的文章：

[http://encosia.com/2008/05/29/using-jquery-to-directly-call-aspnet-ajax-page-methods/](http://encosia.com/2008/05/29/using-jquery-to-directly-call-aspnet-ajax-page-methods/)

您需要注意的问题是 EventValidation；如果您在页面生命周期范围之外获取控制值，然后期望在回发时使用这些设置，您将遇到麻烦。例如，通过 web 方法向下拉列表添加值将在回发时引发错误，除非在构建页面时这些值也添加到下拉列表中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-08-24T16:28:54.963

我正在使用 HTML5 存储，您可以选择如何持久化（本地存储或每个浏览器会话）。如果您担心非 HTML5，您可以使用 Amplify.Storage。缺点是您必须编写代码来调用保存/读取。我正在寻找一种自动化的方法，如果有人有任何想法，请说。谢谢。

# c# - Mvc 发布候选“文件”ActionResult

> ID：500730
> 
> 赞同：0
> 
> 时间：2009-02-01T12:46:52.357
> 
> 标签：c#, asp.net-mvc

K...我在做一些明显错误的事情。我有一个简单的页面，上面有一个文件输入控件和一个提交按钮。我正在尝试使用 Mvc RC 发布的新“文件”ActionResult ...

所有，我想要发生的是当单击提交按钮时，选定的文件被上传到数据库。这一切都很好......

然后，在页面刷新后，我想要一个图像来显示上传的结果图像。问题是图像没有渲染...我得到了损坏的图像...

这是获取文件并将其发送回视图的部分......

```
 var a = Helper.Service.GetAttachmentById(id, MembershipProvider.SecurityTicket);

        if (a == null)
        {
            return View(new ImagePlaceHolderViewData(new { Id = id }));
        }
        return View(new ImagePlaceHolderViewData(new { Id = a.Id, Image = a, FileContent = File(a.Data, a.ContentType) })); 
```

然后在视图中我有一个像这样的图像标签......

```
<img src="<%=Model.FileContent.FileContents %>" /> 
```

我也试过...

```
<img src="<%=Model.FileContent%>" /> 
```

想法..??

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-01T13:09:32.203

FileResult 返回文件的 ASCII 或二进制内容。当您说执行以下操作时：

```
<img src="<%=Model.FileContent.FileContents %>" /> 
```

您正在尝试将二进制图像数据推送到`src`属性中。这永远不会起作用，因为`src`必须是 URL 或图像的路径。

有几种方法可以做你想做的事，在这种情况下最正确的解决方案是创建一个新的控制器，它像你尝试的那样返回二进制数据，然后你将`src`属性设置为正确操作的路径你的新控制器。例如：

```
<img src="/image/result/12345" /> 
```

这指向以下（非常简单且不完整）示例控制器：

```
public class ImageController : Controller
{
    public ActionResult Result(int resultID)
    {
        // Do stuff here...

        return File(..);
    }
} 
```

请注意，我为该操作选择的名称很可能不是什么好东西，但它可以作为示例的目的。希望这会有所帮助。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-01T13:05:20.433

我认为这很简单：img 标签的 src 属性需要一个 URL。您在这里所做的只是将 FileStream 对象放在那里（隐式调用该对象的 ToString 方法）。您生成的 html 可能是这样的：

```
<img src="FileStream#1" /> 
```

你检查你的html源了吗？

您可能应该做的是提供一个返回数据的方法，并将路由传递给您的视图。您生成的 html“应该”看起来像这样：

```
<img src="/Images/View/1" /> 
```

因此，您必须执行的步骤是：

*   在控制器上创建一个返回 FileContentResult 的方法
*   将您的图像 ID 传递给您的视图
*   使用 Url.RouteUrl 生成一个 url，您可以将其放入您的 img 标签中，它指向返回图像数据的方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T08:56:39.717

还有另一种解决方案：

 `````
<img src="data:image/gif;base64,<%=Convert.ToBase64(Model.FileContent)%>"/> 
```` 

`它适用于某些浏览器，但不适用于某些浏览器（IE！当然）。但稳定的解决方案是 Thomas J 提到的。`

 `# html - 图片背后的框架？

> ID：500731
> 
> 赞同：2
> 
> 时间：2009-02-01T12:47:18.567
> 
> 标签：html, graphics, iframe, embed

我的问题与 HTML 和 PURE html 有关。我正在为一个名为 kwick 的社交网络的首页进行新设计，我想为我目前最喜欢的视频创建一种空间。

现在我的问题是，我如何实现这样的事情：

我像这样给我的 ipod 拍照（只是一个例子，它不是我的 ipod）~~[http://www.clein-online.de/schmuck_projekte/files/ipod_nano_schutzhuelle.jpg](http://www.clein-online.de/schmuck_projekte/files/ipod_nano_schutzhuelle.jpg)~~

现在我想将这张图片创建为 gif 并切出显示，现在在那个切出的区域后面，应该显示一个 youtube 视频，在某种程度上嵌入播放器没有完全显示，我的意思是，播放器在那里完全，但图片是一个奠定了它。

这该怎么做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-01T13:31:46.933

您根本不需要剪切图像。制作一个有足够空间容纳 ipod 整个图片的 div，并使用 CSS 将其作为背景图片（如果您无法添加自己的 CSS 文件，可以是内联样式）。

```
<div style="background:url(ipod.jpg); width:300px; height:400px;">
    <iframe src="..." style="margin: 25px auto 0;" width: 250px; height: 200px;></iframe>
</div> 
```

将边距、宽度和高度应用于您的`iframe`或`embed`或`object`将其放置在具有 ipod 背景图像的 div 中。

您可以将 iframe 设置为您需要的大小，并在必要时使其隐藏任何溢出，但如果您无法控制嵌入代码，我认为您将无法隐藏部分 flash。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-01T12:54:57.660

您最大的障碍将是确保您的**WMODE = transparent**。将 WMODE 设置为透明将使您的 Flash 废话始终出现在其他内容之上。然后，只需将具有透明度的图像放置在视频上的正确位置即可。

由于您没有包含有关您包含闪存文件的精确程度的任何信息，因此我无法真正告诉您需要使用什么方法来设置 WMODE。只需进行一些谷歌搜索，一切都会清楚。

# c# - 带有数组返回的泛型列表但是如何？

> ID：500736
> 
> 赞同：1
> 
> 时间：2009-02-01T12:51:49.070
> 
> 标签：c#, .net, arrays, generics, dictionary

这些代码真的很无聊。和 Tostring() 给我错误！你能重新排列这些代码吗？

```
 class Program
    {
        static void Main(string[] args)
        {
            string[] arraystr = { "yusuf", "mehmet" };
            Ilist myitems = new Ilist(arraystr);

            SelectedItemsList slist = new SelectedItemsList();
            slist.Items.Add(myitems);
            Console.Write(slist.Items[0].ToString());
            Console.ReadKey();
        }
    }
    public class Ilist
    {
        private string[] Ad;

        public Ilist(string[] ad)
        {
            Ad = ad;
        }
        public override string[] ToString()
        {
            return this.Ad;
        }
    }

    public class SelectedItemsList
    {
        public List<Ilist> Items;

        public SelectedItemsList()
        {
            Items = new List<Ilist>();

        }
    } 
```

错误 ：

> Generics_List_with_Class.Ilist.ToString()'：返回类型必须是 'string' 以匹配被覆盖的成员 'object.ToString()'

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-01T12:55:50.857

重命名`Ilist.ToString()`为`ToStringArray()`. 所有对象都有一个`ToString()`方法，但是您使用具有不同返回类型的函数覆盖它，从而导致您的错误。

IList 不是类的好名称，因为约定表明以“I”开头的名称应该是接口。我建议 Ilist 应该看起来更像这样：

```
public class StringList
{
    private string[] Ad;

    public StringList(string[] ad)
    {
        Ad = ad;
    }

    public string[] ToStringArray()
    {
        return this.Ad;
    }

    public override ToString()
    {
        return string.Join(",", Ad);
    }
} 
```

不过老实说，我建议您放弃整个方法并改用[List](http://msdn.microsoft.com/en-us/library/6sh2ey19.aspx)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-01T14:02:49.287

您要覆盖的方法的返回类型为字符串。如果你重写一个方法，它的方法签名（它的返回类型、名称和参数）应该保持不变（嗯，在某些情况下它可以不同，但​​现在假设它们应该是相同的）。因此，您的 ToString() 方法必须如下所示：

```
public override string ToString()
{
    ...
} 
```

由您决定最好的字符串表示形式是什么，但如果您想使用 ToString() 它必须返回一个字符串。

正如[Neil Barnwell 建议](https://stackoverflow.com/questions/500736/generics-list-with-array-return-but-how/500739#500739)的那样，如果您实际上只是想返回一个数组，您可以将当前方法重命名为：

```
public string[] GetItems()
{
    return Ad;
} 
```

或者如果你确实想要一个字符串，你可以让你的 ToString 方法像这样：

```
public override string ToString()
{
    StringBuilder stringBuilder = new StringBuilder();
    stringBuilder.Append("{ ");
    stringBuilder.Append(string.Join(", ", Ad));
    stringBuilder.Append(" }");
    return stringBuilder.ToString();
} 
```

根据您这样做是为了学习 C# 还是实际代码，我会看看：

```
List<string> list = new List<string>()
{
    "yusef",
    "mehmet",
}; 
```

如果您使用的是 C# 3.0，或者如果不是：

```
List<string> myitems = new List<string>();
myitems.AddRange(arraystr); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T13:16:05.793

如果您使用的是 C# 3.0，则可以使用 System.Linq 命名空间中的扩展方法来简化操作：

```
IList<string> list = new List<string>();
list.Add("item1");
list.Add("item2");
string[] array = list.ToArray(); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-01T13:41:49.203

您的 ToString 函数返回一个字符串数组，而它从 object 覆盖的方法应该返回一个字符串。

此外，命名您的类 IList 不遵循使用“正确”名称（如 StringList）命名类的传统设计模式，并使用 I 作为接口前缀。

使用列表而不是字符串数组作为广告也可能值得。

# dependency-management - 一个简单但单一的代码库与许多明确记录的依赖项

> ID：500746
> 
> 赞同：1
> 
> 时间：2009-02-01T13:00:23.127
> 
> 标签：dependency-management

通常在开始一个新项目时，我会从我认为在如何构建代码库方面最好的意图开始。我喜欢许多小模块的想法，这些模块可以很好地完成一件事，与代码库的其他部分解耦，并且我自己可能会在其他（类似）项目中重用或开源以供其他人利用。

然而，当我真正尝试将某些东西投入生产时，在紧要关头的那一周，管理所有这些不同模块的复杂性已被证明是一种过多的开销（尽管有良好的文档和部署方法）。在那些时候，我只是简单地改变了策略并将所有模块捆绑到一个存储库中，并将它们作为一个代码库进行管理，这意味着我可以通过不同的分支一起跟踪所有内容，部署到登台和测试环境等......

这些不同方法的优点和缺点是什么，您如何管理以一种或另一种方式工作？

一个单一代码库的优点：

*   易于部署
*   易于回滚
*   易于分支/管理所有更改
*   没有（或更少）需要记录和管理的潜在复杂依赖项

模块化依赖的优点：

*   可重用性
*   干净的架构（一个模块做好一件事）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-01T13:14:11.600

我没有像你那样看到对立面。以 .NET 体验为例，我可以确保我的部分代码面向明确定义的职责，我可以将我的代码库构建为命名空间，确保命名空间的接触点定义明确，并且同一命名空间中的类真的是在一起的。

但是，所有这些都可能发生在单个部署单元、单个项目、分支中，你有什么。如果你坚持这一点，那么在你所做的项目的上下文中可能变得可重用的代码单元将会具体化，这将是你决定引入一个新的代码单元的点，它有自己的部署工件，源代码控制分支， ETC。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-09-28T13:00:46.337

这是来自[Google 的演讲，解释了（一点点）他们如何处理庞大的单体代码存储库](https://news.ycombinator.com/item?id=10256355)。以及为什么他们有一个。

顺便说一句，我认为它不必与定义明确的依赖关系集相对。我什至会说，要处理一个单一的代码库，你必须非常小心依赖图和职责。因为有了这种组织，很容易添加很多或多或少有用的部门……</p>

# c++ - 什么是 C++ 中的 static_case 运算符？

> ID：500748
> 
> 赞同：1
> 
> 时间：2009-02-01T13:00:48.007
> 
> 标签：c++

我听说过[**static_cast 运算符**](http://msdn.microsoft.com/en-us/library/c36yw7x9(VS.80).aspx)

最近我遇到了**static_case**，例如：

```
*ppv = static_case<IUnknown> 
```

这是什么意思？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-01T13:10:02.530

这是一个错字：**没有 static_case**，[只有 static_cast、dynamic_cast、const_cast 和 reinterpret_cast](http://www.cplusplus.com/doc/tutorial/typecasting.html)。

您可以[在 google](http://www.google.fr/search?rlz=1C1GGLS_frFR299FR303&sourceid=chrome&ie=UTF-8&q=c%2B%2B+static_case)上看到您找到“static_case”的文档有拼写错误，并使用 static_cast 和 static_case 就像它是同一个词一样。

可以肯定的是，只需尝试在可用的编译器中使用 static_case 。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-01T13:12:50.870

C++中没有任何东西叫做**static_case**。只有**static_cast**

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T13:03:52.153

它具有良好的旧 C 转换，具有类似于 dynamic_cast 等其他 C++ 转换的新 C++ 语法。我知道的唯一优势就是保持一致，而且很容易理解它。

CPP 参考：[http ://www.cppreference.com/wiki/keywords/static_cast](http://www.cppreference.com/wiki/keywords/static_cast)

Stroustrup on static_cast：[http ://www.research.att.com/~bs/bs_faq2.html#static-cast](http://www.research.att.com/~bs/bs_faq2.html#static-cast)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-01T14:14:00.857

用于转换对象的静态运算符。它是向上转换对象和向下转换对象的概念。如果您阅读继承对象主题，它可以帮助您。用 C++ 铸造：[http ://www.acm.org/crossroads/xrds3-1/ovp3-1.html](http://www.acm.org/crossroads/xrds3-1/ovp3-1.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-02T13:28:57.593

当我看到这个问题时我想到的第一件事 - 这是一个简单的印刷错误

# driver - 驱动程序编程帮助

> ID：500752
> 
> 赞同：1
> 
> 时间：2009-02-01T13:05:30.387
> 
> 标签：driver, wdk

我想编写一个驱动程序（在 c 中），它可以“捕获”用于在硬盘上读写的事件。我的问题是我不知道如何监听系统总线来处理这些事件。我使用微软 DDK。

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-01T16:42:33.163

我认为您正在寻找的是 IoAttachDevice()，您可以在[此处](http://msdn.microsoft.com/en-us/library/ms801168.aspx)找到有关该例程的更多信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T14:11:45.573

监视应用程序的读取和写入比实际发生在物理介质上的读取和写入要容易得多。换句话说，编写位于文件系统驱动程序之上的上层过滤器驱动程序比使用处理对硬盘物理访问的实际驱动程序要容易得多。

我建议您浏览您的 DDK（或 WDK 等）版本附带的示例，看看是否有与您需要的类似的内容。如果有的话，从这些修改而不是从头开始要容易得多。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T14:06:16.987

这比你想象的要复杂。这可以通过[SCSI 端口驱动程序](http://msdn.microsoft.com/en-us/library/ms803193.aspx)来完成。你想做什么？在物理磁盘上获取逻辑 IO 或 IO？

# ios - 阻止 UIWebView 垂直“弹跳”？

> ID：500761
> 
> 赞同：229
> 
> 时间：2009-02-01T13:08:30.940
> 
> 标签：ios, objective-c, iphone, uiscrollview, uiwebview

有谁知道如何阻止 UIWebView 垂直弹跳？我的意思是当用户触摸他们的 iphone 屏幕，向下拖动手指时，webview 会在我加载的网页上方显示一个空白点？

我查看了以下可能的解决方案，但没有一个对我有用：

[http://www.iphonedevsdk.com/forum/iphone-sdk-development/996-turn-off-scrolling-bounces-uiwebview.html](http://www.iphonedevsdk.com/forum/iphone-sdk-development/996-turn-off-scrolling-bounces-uiwebview.html)

[http://forums.macrumors.com/showthread.php?t=619534](http://forums.macrumors.com/showthread.php?t=619534)

[如何阻止 UIScrollView 水平弹跳？](https://stackoverflow.com/questions/173786/how-do-i-stop-a-uiscrollview-from-bouncing-horizontally)

* * *

## 回答 #1

> 赞同：429
> 
> 时间：2010-07-24T11:22:43.423

```
for (id subview in webView.subviews)
  if ([[subview class] isSubclassOfClass: [UIScrollView class]])
    ((UIScrollView *)subview).bounces = NO; 
```

...似乎工作正常。

它也将被 App Store 接受。

**更新**：在 iOS 5.x+ 中有一种更简单的方法 -`UIWebView`拥有`scrollView`属性，因此您的代码可以如下所示：

```
webView.scrollView.bounces = NO; 
```

也一样`WKWebView`。

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2009-02-09T02:11:44.080

我正在研究一个项目，该项目可以轻松地将 Web 应用程序创建为 iPhone 上的完整可安装应用程序[QuickConnect](http://sourceforge.net/projects/quickconnect/)，并找到了一个可行的解决方案，如果您根本不希望屏幕可滚动，在我的情况下我没有。

在上面提到的项目/博客文章中，他们提到了一个 javascript 函数，您可以添加它来关闭弹跳，这基本上归结为：

```
 document.ontouchmove = function(event){
        event.preventDefault();
    } 
```

如果您想了解更多关于他们如何实现它的信息，只需下载 QuickConnect 并查看它......但基本上它所做的只是在页面加载时调用那个 javascript......我试着把它放在我的文档的头部，它似乎工作正常。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2010-08-22T15:39:23.220

好吧，我所做的就是：

```
UIView *firstView = [webView.subviews firstObject];

if ([firstView isKindOfClass:[UIScrollView class]]) {

    UIScrollView *scroll = (UIScrollView*)firstView;
   [scroll setScrollEnabled:NO];  //to stop scrolling completely
   [scroll setBounces:NO]; //to stop bouncing 

} 
```

对我来说效果很好...此外，如果您在 iphone 应用程序中使用它，Apple 会拒绝这个问题的答案。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2011-12-29T00:28:01.813

在 iOS 5 SDK 中，您可以直接访问与 Web 视图关联的滚动视图，而不是遍历其子视图。

因此，要在滚动视图中禁用“弹跳”，您可以使用：

```
myWebView.scrollView.bounces = NO; 
```

请参阅[UIWebView 类参考](http://developer.apple.com/library/ios/#documentation/uikit/reference/UIWebView_Class/Reference/Reference.html#//apple_ref/doc/uid/TP40006950-CH3-SW35)。

（但是如果您需要支持 5.0 之前的 SDK 版本，您应该遵循[Mirek Rusin 的建议](https://stackoverflow.com/a/3324886/387310)。）

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2016-11-16T06:58:36.037

斯威夫特 3

```
webView.scrollView.bounces = false 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-11-16T17:29:31.570

警告。我在我的应用程序中使用了 setAllowsRubberBanding:，Apple 拒绝了它，指出不允许使用非公共 API 函数（引用：3.3.1）

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2016-09-01T10:13:13.990

在 Swift 中禁用反弹

```
webViewObj.scrollView.bounces = false 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-07-18T15:21:32.130

布拉德的方法对我有用。如果你使用它，你可能想让它更安全一点。

```
id scrollView = [yourWebView.subviews objectAtIndex:0];
if( [scrollView respondsToSelector:@selector(setAllowsRubberBanding:)] )
{
    [scrollView performSelector:@selector(setAllowsRubberBanding:) withObject:NO];
}

```

如果苹果改变了某些东西，那么反弹会回来 - 但至少你的应用程序不会崩溃。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-10-12T08:05:09.010

在 iOS5 上，仅当您计划让用户缩放 web 视图内容（ei：双击）时，反弹设置是不够的。您还需要将 alwaysBounceHorizo​​ntal 和 alwaysBounceVertical 属性设置为 NO，否则当它们缩小（另一个双击...）默认设置时，它会再次反弹。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2010-03-02T09:51:13.977

我遍历了UIWebView的子视图集合，将它们的背景设置为[UIColor blackColor]，与网页背景颜色相同。视图仍会反弹，但不会显示丑陋的深灰色背景。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2010-06-03T08:05:36.947

在我看来，UIWebView 有一个 UIScrollView。您可以为此使用记录在案的 API，但弹跳是为两个方向设置的，而不是单独设置的。这是在 API 文档中。UIScrollView 有一个反弹属性，所以这样的东西可以工作（不知道是否有多个滚动视图）：

```
NSArray *subviews = myWebView.subviews;
NSObject *obj = nil;
int i = 0;
for (; i < subviews.count ; i++)
{
    obj = [subviews objectAtIndex:i];

    if([[obj class] isSubclassOfClass:[UIScrollView class]] == YES)
    {
        ((UIScrollView*)obj).bounces = NO;
    }
} 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2010-06-08T20:55:54.357

我很生气地发现 UIWebView 不是滚动视图，所以我创建了一个自定义子类来获取 Web 视图的滚动视图。该子类包含一个滚动视图，因此您可以自定义 Web 视图的行为。这堂课的妙语是：

```
@class CustomWebView : UIWebview
...

- (id) initWithFrame:(CGRect)frame{
self = [super initWithFrame:frame];
// WebViews are subclass of NSObject and not UIScrollView and therefore don't allow customization.
// However, a UIWebView is a UIScrollViewDelegate, so it must CONTAIN a ScrollView somewhere.
// To use a web view like a scroll view, let's traverse the view hierarchy to find the scroll view inside the web view.
for (UIView* v in self.subviews){
    if ([v isKindOfClass:[UIScrollView class]]){
        _scrollView = (UIScrollView*)v; 
        break;
    }
}
return self; 
```

}

然后，当您创建自定义 Web 视图时，您可以禁用弹跳：

```
customWebView.scrollView.bounces = NO; //(or customWebView.scrollView.alwaysBounceVertically = NO) 
```

这是制作具有可自定义滚动行为的 Web 视图的一种很好的通用方法。有几点需要注意：

*   与任何视图一样，您还需要覆盖 -(id)initWithCoder: 如果您在 Interface Builder 中使用它
*   当您最初创建 Web 视图时，其内容大小始终与视图框架的大小相同。滚动网页后，内容大小表示视图内实际网页内容的大小。为了解决这个问题，我做了一些 hacky - 调用 -setContentOffset:CGPointMake(0,1)animated:YES 来强制进行不明显的更改，以设置 Web 视图的正确内容大小。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2012-01-20T13:57:30.290

遇到了这个寻找答案的问题，我最终只是通过搞砸自己的答案而幸运。我做了

```
[[webview scrollView] setBounces:NO]; 
```

它奏效了。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2013-08-21T19:02:14.987

这对我有用，而且也很漂亮（我正在使用带有 webView 的 phonegap）

```
[[webView.webView scrollView] setScrollEnabled:NO]; 
```

或者

```
[[webView scrollView] setScrollEnabled:NO]; 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-12-16T14:17:00.817

这是两个较新的潜在解决方案。显然，您可以使用 jqtouch 或 Pastrykit 来禁用滚动。但是，我还没有让这些工作。你可能更有能力。

[关闭垂直滚动](http://blog.jqtouch.com/post/285889760/turning-off-vertical-scrolling)

[挖掘糕点包](http://waynepan.com/2009/12/16/digging-into-pastrykit)

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2010-01-22T14:01:51.327

[移动 Safari 上的固定定位](http://doctyper.com/archives/200808/fixed-positioning-on-mobile-safari/)

这个链接帮助了我很多.....它很容易..有一个演示..

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2011-03-10T09:00:46.920

我尝试了一种稍微不同的方法来防止**UIWebView**对象滚动和弹跳：添加手势识别器来覆盖其他手势。

看来，**UIWebView**或其滚动子视图使用自己的平移手势识别器来检测用户滚动。但是根据 Apple 的文档，有一种合法的方法可以用另一个手势识别器覆盖一个手势识别器。**UIGestureRecognizerDelegate**协议有一个方法**gestureRecognizer:shouldRecognizeSimultaneouslyWithGestureRecognizer:** - 它允许控制任何碰撞手势识别器的行为。

所以，我所做的是

在视图控制器的 viewDidLoad 方法中：

```
// Install a pan gesture recognizer                                                                                        // We ignore all the touches except the first and try to prevent other pan gestures                                                     
// by registering this object as the recognizer's delegate                                                                                        
UIPanGestureRecognizer *recognizer;                                                                                                               
recognizer = [[UIPanGestureRecognizer alloc] initWithTarget:self action:@selector(handlePanFrom:)];                                                   
recognizer.delegate = self;                                                                                                                       
recognizer.maximumNumberOfTouches = 1;                                                                                                            
[self.view addGestureRecognizer:recognizer];                                                                                                          
self.panGestureFixer = recognizer;                                                                                                                  
[recognizer release]; 
```

然后，手势覆盖方法：

```
// Control gestures precedence                                                                                                                            
- (BOOL)gestureRecognizer:(UIGestureRecognizer *)gestureRecognizer                                                                                        
        shouldRecognizeSimultaneouslyWithGestureRecognizer:(UIGestureRecognizer *)otherGestureRecognizer                                                  
{                                                                                                                                                         
        // Prevent all panning gestures (which do nothing but scroll webViews, something we want to disable in                                          
        // the most painless way)                                                                                                                         
        if ([otherGestureRecognizer isKindOfClass:[UIPanGestureRecognizer class]])                                                                        
        {
            // Just disable every other pan gesture recognizer right away                                                                             
            otherGestureRecognizer.enabled = FALSE;
        }                                                                                                                                                  
        return NO;                                                                                                                                        
} 
```

当然，这个委托方法可以让我在实际应用程序中变得更复杂——我们可以选择性地禁用其他识别器，分析**otherGestureRecognizer.view**并根据它是什么视图做出决定。

最后，为了完整起见，我们注册为 pan 处理程序的方法：

```
- (void)handlePanFrom:(UIPanGestureRecognizer *)recognizer 
{ 
    // do nothing as of yet
} 
```

如果我们只想取消 web 视图的滚动和弹跳，它可以是空的，或者它可以包含我们自己的代码来实现我们真正想要的那种平移运动和动画......

到目前为止，我只是在试验所有这些东西，它似乎或多或少地按照我的意愿工作。不过，我还没有尝试向 iStore 提交任何应用程序。但我相信到目前为止我还没有使用过任何无证的东西......如果有人发现它，请通知我。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2014-01-21T04:20:28.263

（Xcode 5 iOS 7 SDK 示例）这是一个使用滚动视图 setBounces 函数的通用应用示例。这是一个开源项目/示例，位于此处：[链接到 SimpleWebView（项目 Zip 和源代码示例）](https://github.com/matthewferguson/SimpleWebView.git)

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-02-02T13:16:11.173

的子视图之一`UIWebView`应该是`UIScrollView`. 将其`scrollEnabled`属性设置为`NO`，Web 视图将完全禁用滚动。

注意：这在技术上使用私有 API，因此您的应用程序可能会在未来的操作系统版本中被拒绝或崩溃。使用`@try`和`respondsToSelector`

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-02-06T16:47:16.313

查看 的`bounces`属性`UIScrollView`。引用 Apple 文档：

> 如果该属性的值为`YES`（默认值），则滚动视图在遇到内容边界时会弹跳。在视觉上弹跳表示滚动已到达内容的边缘。如果值为`NO`，则滚动立即在内容边界处停止而不弹跳。

确保您使用的是正确的`UIScrollView`. 我不确定 a 的层次结构是什么样的`UIWebView`，但滚动视图可能是`UIWebView`.

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2011-08-20T06:43:36.493

要禁用`UIWebView`滚动，您可以使用以下代码行：

```
[ObjWebview setUserInteractionEnabled:FALSE]; 
```

在本例中，`ObjWebview`是 类型`UIWebView`。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2012-09-10T10:00:43.253

webView.scrollView.scrollEnabled=否；webView.scrollView.bounces=否；

# c# - 如何将字符串中的值从 0,00 更改为 0.00

> ID：500762
> 
> 赞同：4
> 
> 时间：2009-02-01T13:09:23.497
> 
> 标签：c#, .net

如何将字符串中的值从 0,00 更改为 0.00？- 只有数值，不是所有字符“，”到“。”

从

```
string myInputString = "<?xml version=\"1.0\"?>\n<List xmlns:Table=\"urn:www.navision.com/Formats/Table\"><Row><HostelMST>12,0000</HostelMST><PublicMST>0,0000</PublicMST><TaxiMST>0,0000</TaxiMST><ParkMST>0,0000</ParkMST><RoadMST>0,0000</RoadMST><FoodMST>0,0000</FoodMST><ErrorCode>0</ErrorCode><ErrorDescription></ErrorDescription></Row></List>\n"; 
```

到

```
string myInputString = "<?xml version=\"1.0\"?>\n<List xmlns:Table=\"urn:www.navision.com/Formats/Table\"><Row><HostelMST>12.0000</HostelMST><PublicMST>0.0000</PublicMST><TaxiMST>0.0000</TaxiMST><ParkMST>0.0000</ParkMST><RoadMST>0.0000</RoadMST><FoodMST>0.0000</FoodMST><ErrorCode>0</ErrorCode><ErrorDescription></ErrorDescription></Row></List>\n"; 
```

* * *

感谢您的回答，但我的意思是仅更改数值，而不是将所有字符“，”更改为“。” 我不想改变字符串

```
string = "<Attrib>txt txt, txt</Attrib><Attrib1>12,1223</Attrib1>"; 
```

到

```
string = "<Attrib>txt txt. txt</Attrib><Attrib1>12.1223</Attrib1>"; 
```

但是这个没问题

```
string = "<Attrib>txt txt, txt</Attrib><Attrib1>12.1223</Attrib1>"; 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-01T13:24:55.557

试试这个 ：

```
Regex.Replace("attrib1='12,34' attrib2='43,22'", "(\\d),(\\d)", "$1.$2") 
```

**输出：** attrib1='12.34' attrib2='43.22'

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-01T13:47:52.063

最好的方法取决于上下文。你在解析 XML 吗？你在写 XML。无论哪种方式，这都与文化有关。

如果您正在编写它，那么我假设您的文化设置为使用逗号作为小数分隔符的东西，而您不知道这一事实。首先，将您在 Windows 设置中的文化更改为更适合您的文化和做事方式的东西。其次，如果您将这些数字写出来供人类展示，那么我会将其保留为具有文化敏感性，因此它适合阅读它的任何人。如果它要被另一台机器解析，那么你可以像这样使用 Invariant Culture：

```
12.1223.ToString(CultureInfo.InvariantCulture); 
```

如果您正在阅读（我认为这是您正在做的事情），那么您可以再次使用文化信息。如果它来自人类来源（例如，他们在一个框中键入它），那么再次使用他们的默认文化信息（默认在 float.Parse 中）。如果它来自计算机，则再次使用 InvariantCulture：

```
float f = float.Parse("12.1223", CultureInfo.InvariantCulture); 
```

当然，这是假设文本是用不变的文化编写的。但是当你问这个问题时，它不是（除非你可以控制它的编写，在这种情况下使用 InvariantCulture 来编写它是上面建议的）。然后，您可以使用理解逗号的特定文化来解析它：

```
NumberFormatInfo commaNumberFormatInfo = new NumberFormatInfo();
commaNumberFormatInfo.NumberDecimalSeperator = ",";
float f = float.Parse("12,1223", commaNumberFormatInfo); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-01T13:51:06.457

我强烈推荐 joel.neely 的正则表达式方法或以下方法：

1.  使用 XmlReader 读取所有节点
2.  使用带有格式化程序的 double.TryParse = 使用逗号作为小数分隔符的 NumberFormatInfo 来识别数字
3.  使用 XmlWriter 编写新的 XML
4.  使用 CultureInfo.InvariantCulture 在该 XML 上写入数字

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-01T13:16:43.263

```
string newStr = myInputString.Replace("0,00", "0.00"); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-01T13:43:58.403

ScarletGarden 的答案是一个开始，但您需要了解数据中“数值”的完整上下文和语法。

简短回答的问题是，这样的情况会被修改：

```
<elem1>quantity<elem2>12,6 of which were broken</elem2></elem1> 
```

是的，可能有一个错字（逗号后缺少空格），但人工输入的数据经常有这样的错误。

如果您包含更多上下文，则可能会减少误报。像这样的图案

```
([\s>]-?$?\d+),(\d+[\s<]) 
```

（您可以转义以适应您选择的编程语言）仅在“digits-comma-digits”部分（带有可选符号和货币符号）以空格或元素结尾为界时匹配。如果您的所有数值都在 XML 元素中被隔离，那么您将有一个更轻松的时间。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-01T13:20:05.597

如果 , 没有在其他任何地方使用，而是在字符串中使用 number ，则可以使用以下内容：

```
string newStr = myInputString.Replace(",", "."); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-01T15:31:06.503

虽然理论上您可以使用正则表达式来执行此操作，但该模式会很复杂且难以测试。ICR 走在正确的轨道上，你需要根据文化来做这件事。

你知道你的数字总是使用逗号而不是句点作为小数分隔符吗？看起来你可以，因为 Navision 是一家丹麦公司。

如果是这样，您将需要遍历字符串中的 XML 文档，并重写数值。看来您可以在节点名称上确定这一点，因此这不是问题。

转换数字时，请使用类似于以下内容的内容：

这是你想要做的：

```
 internal double ConvertNavisionNumber(string rawValue)
    {
        double result = 0;

        if (double.TryParse(rawValue, NumberStyles.Number, new CultureInfo("da-DK").NumberFormat, out result))
            return result;
        else
            return 0;
    } 
```

这告诉 TryParse() 方法您正在转换来自丹麦语 (da-DK) 的数字。调用该函数后，您可以使用 ToString() 以本地格式（我假设是美国或加拿大）写出数字，以获得小数分隔符的句点。这还将考虑具有不同千位分隔符的数字（加拿大的 1,234.56 在丹麦写为 1 234,56）。

```
ConvertNavisionNumber("4,43").ToString() 
```

将导致“4.43”。

```
ConvertNavisionNumber("1 234").ToString() 
```

将产生“1,234”。

# php - MySQL NOT LIKE 查询不起作用

> ID：500790
> 
> 赞同：2
> 
> 时间：2009-02-01T13:26:36.897
> 
> 标签：php, mysql, database, database-design

我有 2 张桌子：

*   帖子
*   标签

标签表的结构如下：

*   post_id
*   标签

因此，对于为帖子提供的每个标签，我都会在标签表中创建一条记录。如果一篇文章有​​ 10 个标签，那么标签表中将有 10 条记录具有该 post_id。

我现在正在尝试构建一个搜索页面，用户可以在其中搜索标签不包含给定关键字的帖子。但是，这会产生一个问题。像这样的查询：

```
SELECT DISTINCT posts.id, posts.title, posts.content
   FROM jobs, tags
   WHERE tags.tag NOT LIKE '%$keywords%' AND posts.id=tags.post_id 
```

不起作用，因为如果一个帖子有 6 个标签，其中一个有关键字，它仍然会被返回，因为标签表中的其他 5 条记录没有那个关键字。

解决这个问题的最佳方法是什么？除了在帖子表中创建一个新列之外，还有什么方法可以存储所有仅用于搜索的逗号分隔标签？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-01T13:33:58.783

确保您有索引，否则这将非常糟糕：

```
SELECT posts.id, posts.title, posts.content
FROM posts 
WHERE NOT EXISTS (
  SELECT post_id from tags
  WHERE tags.tag LIKE '%$keywords%' 
    AND posts.id=tags.post_id
) 
```

这将获取所有帖子的列表，不包括那些与您指定的标签匹配的标签。（您的原始查询引用了“工作”表。我认为这是“帖子”的拼写错误。）

[表别名](http://www.brainbell.com/tutors/php/php_mysql/Table_aliases_in_SQL_queries.html)使这更简洁：

```
SELECT p.id, p.title, p.content
FROM posts p
WHERE NOT EXISTS (
  SELECT t.post_id from tags t
  WHERE t.tag LIKE '%$keywords%' 
    AND p.id=t.post_id
) 
```

然后，我将创建这些索引：

```
Posts: id, tag_id
Tags: post_id, tag 
```

[然后，使用“解释](http://dev.mysql.com/doc/refman/5.1/en/explain.html)”运行您的查询，看看它是否表现良好。用结果更新您的问题，有人会提供进一步的建议。索引调优比其他任何事情都需要反复试验，因此测试确实是必要的。

# .net - 在客户端机器上部署 .NET 软件需要什么？

> ID：500807
> 
> 赞同：1
> 
> 时间：2009-02-01T13:32:26.323
> 
> 标签：.net, deployment

我正在将 .Net windows 应用程序部署到客户端系统。客户在他的系统中需要.Net 软件吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-01T13:34:44.180

是的，但是如果您在 Visual Studio 中使用 Setup/Deployment 项目，您可以创建一个 Setup.exe，它将为您引导和安装 .NET 框架。但是，如果您不这样做，那么是的，在运行您的应用程序之前需要安装一个与您的应用程序兼容的 .NET 框架。

虽然，如果您绝对需要，可以避免这种情况。这种情况很少见，但您可以使用 Salamander 或 Xenocode 等工具将框架捆绑到您的应用程序中。但是，不建议这样做，只有在这是核心要求时才这样做。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T13:34:28.377

是的，客户需要您的应用程序版本或更高版本的 .net 框架。

例如，如果您在 .NET 2.0 中编写应用程序，则客户端需要 .NET Framework 2.0 或更高版本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-01T13:34:51.060

是的，客户端应该安装 .NET 框架才能使应用程序正常工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-01T13:34:51.950

您需要目标计算机上的 CLR 才能运行 .net 应用程序。

# c++ - 更自然的 boost::bind 替代方案？

> ID：500819
> 
> 赞同：3
> 
> 时间：2009-02-01T13:36:17.953
> 
> 标签：c++, syntax, boost, signals, boost-bind

不要误会我的意思：Boost`bind()`很棒。

但是我确实讨厌用它来编写和阅读代码，而且我已经放弃了希望我的同事们会摸索/使用它的希望。

我最终得到这样的代码：

```
btn.clicked.connect(bind(&BetBar::placeBet, this, bet_id));
animator.eachFrame.connect(bind(&Widget::move, buttons[bet_id])); 
```

这虽然合乎逻辑，但与我所说的好代码相去甚远。

为了演示......在 C++1x 中，我们将拥有：

```
btn.clicked.connect([&](int bet_id){ placeBet(bet_id); })
animator.eachFrame.connect([&](Point newPos) { buttons[bet_id].move(newPos) }) 
```

一个好的 DSL 可能看起来像这样：

```
on(btn.clicked) placeBet(bet_id);
on(animator.eachFrame) buttons[bet_id].move(eachFrame::newPos); 
```

**你如何处理 C++ 中的绑定？你只是生活在什么提升给你？**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-02T09:40:39.893

看来您想要以下内容：

*   隐式绑定到`this`
*   与存储绑定的函数调用关联的括号的替代方案。
*   自动识别 lambda 表达式中的哪些参数被绑定。

第一个在今天的 C++ 中非常困难，因为`this`在很少的上下文中是隐式的，你当然不能将它隐式传递给函数。也就是说，你不能用库函数来实现这一点，但你可以用宏来实现。不过，还是会很丑。

第二部分要容易得多：

```
button.clicked.handler = bind(BetBar::placeBet, this, bet_id); 
```

这只需要`handler.operator=(boost::function<void(*)()> const&)`

第三个又是困难的，因为您刚刚设计了另一种两阶段名称查找的情况。这对模板来说已经够难了。boost 的 _1 技巧通过明确哪些参数应该稍后绑定来起作用。但是， _1 作为名称并不神奇。它基本上是一个返回 boost::arg<1> 的免费函数。因此，通过 animator.eachFrame.newPos 的适当定义，可以使以下内容等效：

```
animator.eachFrame.handler = bind(&Widget::move, buttons[bet_id], _1)
animator.eachFrame.handler = bind(&Widget::move, buttons[bet_id], animator.eachFrame.newPos) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-01T18:35:43.260

我怀疑你能在 pre-0x C++ 上做得更好。Boost.Lambda 或 Phoenix 提供了它们自己的绑定机制，但对于这种情况，它真的不会变得更具可读性。

如果您能想到如何使用 boost::proto 在当前 C++ 中编写这样的 DSL（还有其他替代方案吗？），那么您可能会从 boost 邮件列表中仅有的其他 proto-guy 获得更好的帮助，因为这超出了我的想象。

对于同事：当他们专业地进行 C++ 编程时（阅读：他们为此获得报酬），他们要么了解它，要么他们应该做另一份工作。如果他们无法阅读如此简单的结构，他们可能会产生更大的维护负担，然后他们可以通过帮助实现新功能来弥补。

在这种情况下，提供与 Lua（或您喜欢的任何脚本语言）的良好绑定，并让它们以该语言执行业务逻辑。无论如何，这实际上是一个不错的解决方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T11:38:56.287

附带说明一下，实际上一个好的 DSL 可能看起来像这样：

```
btn.clicked { |bet_id| placeBet bet_id }
animator.eachFrame { |newPos| buttons[bet_id].move newPos } 
```

回答您的问题：对于您提供的简单示例，简单的`bind`作品就可以了。

# python - How to deploy Django with Spawning

> ID：500822
> 
> 赞同：6
> 
> 时间：2009-02-01T13:39:48.960
> 
> 标签：python, django, deployment, spawning

There's no much documentation on how to deploy a Django project with [Spawning](http://pypi.python.org/pypi/Spawning/) and yet people are recommending it over apache/mod_wsgi.

[In another similar question](https://stackoverflow.com/questions/487224/reducing-django-memory-usage-low-hanging-fruit/487261#487261), other SO user suggested me to open a new question specific to Spawning, so hopefully others can share their experiences too.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-01T14:33:02.347

I'd be interested in seeing whose seriously recommending Spawning over Apache and mod_python or mod_wsgi.

Judging by the fact that this question is now the #4 result in Google for 'django spawning' I'd say it's very much early days. :) If you're putting anything serious into production stick to Apache/mod_wsgi for now.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-02T21:53:51.737

cd to your django's settings.py directory.

Here is the command line to serve your django application

```
spawn --factory=spawning.django_factory.config_factory settings --port 80 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-01T20:48:59.390

Eric Florenzo did some [basic testing of spawning](http://www.eflorenzano.com/blog/post/spawning-django/). Make sure and read all the comments as well as the main post.

Personally I always like investigating these kinds of solutions, but in this case I just can't even get to a benchmarking stage. There are too many important features I need in Apache (ssl client certs, run mongrel servers under fastcgi, django under wsgi, php *gasp*, static files served directly, ssl for each ip address, dozens of virtual hosts on multiple ip addresses, etc.).

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-06-23T18:30:09.030

Yes, I could recommend you to use spawning over apache/wsgi setup.

Two reasons basically: 1) Memory usage (you'll save some MBs on spawning) 2) Dynamic code reloading (at no point of time, your user's will see a 404 or 500 page)

This comes from experience, I am running [http://tunesdiary.com](http://tunesdiary.com) on spawning+nginx in this setup:

nginx handles all the incoming load which further proxy connection to spawning which is listening on a unprivileged port (means spawning is running as a different user than the web-server) Spawning spawns 4 processes with 2 threads per process. (works for the current load).

As I push any code to the server, the previous requests are handled, and then the new code starts serving the new requests.

This has been working very good till now (I am running this from about 6 months)

What I've observed, django with mod wsgi + apache (which I used for some days earlier) was taking about 70MB of RAM after getting started (single process), and this setup uses 45MB per process or so. Also, I've also had this with lighttpd + modfcgi which also consumes almost same amount of memory than spwaning.

(I might have miscalculated because in apache, the webserver's memory usage is also included)

You can rely on spawning, as far as I can say, but if if you don't really push often, it won't be of much use.

# mysql - 如何在 MySql 中进行口音敏感搜索

> ID：500826
> 
> 赞同：75
> 
> 时间：2009-02-01T13:42:48.610
> 
> 标签：mysql, utf-8

我有一个带有 utf8 通用 ci 排序规则的 MySQL 表。在表中，我可以看到两个条目：

阿巴德阿
巴德

我正在使用如下所示的查询：

```
SELECT *  FROM `words` WHERE `word` = 'abád' 
```

查询结果给出了两个词：

阿巴德阿
巴德

有没有办法表明我只想让 MySQL 找到重音词？我希望查询只返回

阿巴德

我也试过这个查询：

```
SELECT *  FROM `words` WHERE BINARY `word` = 'abád' 
```

它没有给我任何结果。感谢您的帮助。

* * *

## 回答 #1

> 赞同：97
> 
> 时间：2009-02-01T17:01:11.533

如果您对该字段的搜索总是对重音敏感，则将该字段的排序规则声明为 utf8_bin （这将比较 utf8 编码的字节是否相等）或使用特定于语言的排序规则来区分重音和非重音-重音字符。

```
col_name varchar(10) collate utf8_bin 
```

如果搜索通常不区分重音，但您想为此搜索设置例外，请尝试；

```
WHERE col_name = 'abád' collate utf8_bin 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2010-08-23T16:54:23.487

在我的版本（MySql 5.0）中，没有任何 utf8 字符集可用于不区分大小写、区分重音的搜索。utf8 唯一区分重音的排序规则是 utf8_bin。但是它也区分大小写。

我的工作是使用这样的东西：

```
SELECT * FROM `words` WHERE LOWER(column) = LOWER('aBád') COLLATE utf8_bin 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-02-24T20:57:37.447

MySQL 错误，供将来参考，是[http://bugs.mysql.com/bug.php?id=19567](http://bugs.mysql.com/bug.php?id=19567)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2017-12-05T02:39:21.743

接受的答案很好，但请注意，您可能必须改用 COLLATE utf8mb4_bin ！

```
WHERE col_name = 'abád' collate utf8mb4_bin 
```

以上修复了以下错误：

> MySQL 说：文档 1253 - COLLATION 'utf8_bin' 对 CHARACTER SET 'utf8mb4' 无效

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-09-17T03:50:49.193

检查数据库表排序规则类型是否以“_ci”结尾，这代表不区分大小写...

将其更改为不带“_ci”的相同或最接近名称的排序规则...

例如...将“utf8_general_ci”更改为“utf8_bin” Mke

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-05-01T17:40:17.667

我遇到了同样的错误。

我已将表的排序规则更改为 utf8_bin（通过 phpMyAdmin），问题已解决。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-01T13:48:28.990

```
SELECT *  FROM `words` WHERE column = 'abád' collate latin1_General_CS 
```

（或您的排序规则，包括 cs）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-01T14:08:50.960

您可以尝试在 mysql 中搜索字符的十六进制变量 HEX() 并在您的编程语言中使用类似的函数并匹配它们。当我在做一个人可以选择一个人的第一个字母的列表时，这对我来说效果很好。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-08-26T09:56:58.170

好吧，您刚刚描述了 utf8_general_ci 排序规则的全部内容（a, á, à, â, ä, å 在比较中都等于 a）。

MySQL 服务器 5.1 在 utf8_general_ci 和 utf8_unicode_ci 方面也发生了变化，因此它也取决于服务器版本。最好检查文档。

因此，如果是 MySQL 服务器 5.0，我会选择 utf8_unicode_ci 而不是 utf8_general_ci，这对于您的用例来说显然是错误的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-04-16T09:30:02.193

这适用于我在 utf8_general_ci 的数据库中的 MySql server 5.1 中的不区分重音和不区分大小写的搜索，其中列是 LONGBLOB。

```
select * from words where '%word%' LIKE column collate utf8_unicode_ci 
```

和

```
select * from words where'%word%' LIKE column collate utf8_general_ci 
```

结果区分大小写，但不区分重音。

# c# - 如何以编程方式触发（密封）Windows 窗体组件的事件？

> ID：500832
> 
> 赞同：1
> 
> 时间：2009-02-01T13:44:52.740
> 
> 标签：c#, events, triggers

更具体地说：我想要一个单元测试来触发 SaveFileDialog 的*FileOk*事件，以测试我自己的代码（包装 SFD 并在 ShowDialog 之前和之后做一些额外的事情）是否按预期工作。

提前感谢您对此的任何帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-01T17:43:56.673

问题是，事件不会公开“引发”操作* - 它们公开“订阅”和“取消订阅”。他们如何实现订阅/取消订阅取决于实现。

但是，在`SaveFileDialog`（或任何`FileDialog`）的情况下，有一个[`OnFileOk`](http://msdn.microsoft.com/en-us/library/system.windows.forms.filedialog.onfileok.aspx)受保护的方法会引发事件。您可以派生`SafeFileDialog`并公开一个将调用`OnFileOk`或仅`OnFileOk`使用反射调用的公共方法。然后它将调用事件处理程序`FileOk`。我不确定我是否特别喜欢这些攻击计划中的任何一个，但如果没有更多关于你想要做什么的信息，我想我会回答这个问题而不是问太多:)

* * *

`*`事实上，.NET 本身确实有事件“引发”部分的想法，因此`EventInfo.GetRaiseMethod`. 但是，这违背了事件 IMO 的一般概念，并且 C# 编译器从不生成 raise 部分。我不相信标准库通常也不会公开它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-01T20:14:57.337

我相信可以使用[PrivateObject](http://msdn.microsoft.com/en-us/library/microsoft.visualstudio.testtools.unittesting.privateobject.aspx)在您的类上调用私有/受保护的方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T14:14:26.067

如果您将 SaveFileDialog 隐藏在接口后面，则可以使用存根或模拟实现来测试您的代码。我不建议在单元测试中使用真实的表单或控件，因为它们中的大多数都严重依赖于活动的消息循环。

```
public interface ISaveFileDialog
{
    event CancelEventHandler FileOk;
}

public class SaveFileDialogStub : ISaveFileDialog
{
    public event CancelEventHandler FileOk;

    public void RaiseFileOk(CancelEventArgs e)
    {
        FileOk(this, e);
    }
}

public class ClassUnderTest
{
    public ClassUnderTest(ISaveFileDialog dialog)
    {
        dialog.FileOk += OnFileOk;
    }

    void OnFileOk(object sender, CancelEventArgs e)
    {
        //...
    }
} 
```

# regex - 正则表达式编译器

> ID：500839
> 
> 赞同：12
> 
> 时间：2009-02-01T13:48:04.653
> 
> 标签：regex

在我所做的工作中，我只需要使用几次正则表达式。然而，在那几次中，我发现了一种非常强大的表达方式，可以让我做一些非常有用的事情。

问题是用于正则表达式的语言是错误的——句号。

从心理学的角度来看，这是错误的——使用脱离实体的符号只能为那些具有清晰记忆的人提供有用的参考。虽然语法规则已经很清楚了，但根据我的经验和从其他人那里学到的东西，进化一个成功运行的正则表达式可能证明是一件困难的事情，除了最微不足道的情况外。这是可以理解的，因为它是集合论的符号类比，这是一个相当复杂的事情。

可以证明困难的事情之一是将您正在处理的表达式分解为其离散的部分。由于语言的性质，如果您不了解其主要目标，则可以以多种方式阅读一个正则表达式，因此解释其他人的正则表达式很复杂。在自然语言研究中，我相信这被称为语用学。

那么我想问的问题是——有没有像正则表达式编译器这样的东西？或者甚至可以建造一个？

从隐喻的角度来看，可以将正则表达式视为汇编语言 - 有一些相似之处。是否可以设计一个编译器来将一种更自然的语言——一种更高级的语言——转化为正则表达式？然后在我的代码中，我可以在头文件中使用高级语言定义我的正则表达式，并在必要时使用符号引用来引用它们。我和其他人可以从我的代码中引用头文件，并且更容易理解我试图用我的正则表达式实现的目标。

我知道这可以从逻辑的角度来完成，否则计算机将无法实现，但如果你已经读到这里，那么你会考虑花时间来实现它吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-01T14:53:21.587

**1)** Perl 允许`/x`打开正则表达式以使注释和空格可以包含在正则表达式本身中。这使得可以将复杂的正则表达式分布在多行中，使用缩进来指示块结构。

**2）**如果您不喜欢类似于线噪声的符号本身，那么编写自己的构建正则表达式的函数并不难。例如在 Perl 中：

```
sub at_start { '^'; }
sub at_end { '$'; }
sub any { "."; }
sub zero_or_more { "(?:$_[0])*"; }
sub one_or_more { "(?:$_[0])+"; }
sub optional { "(?:$_[0])?"; }
sub remember { "($_[0])"; }
sub one_of { "(?:" . join("|", @_) . ")"; }
sub in_charset { "[$_[0]]"; }       # I know it's broken for ']'...
sub not_in_charset { "[^$_[0]]"; }   # I know it's broken for ']'... 
```

然后，例如匹配带引号的字符串 ( `/^"(?:[^\\"]|\\.)*"/`) 的正则表达式变为：

```
at_start .
'"' .
zero_or_more(
    one_of(
        not_in_charset('\\\\"'),    # Yuck, 2 levels of escaping required
        '\\\\' . any
    )
) .
'"' 
```

使用这种“字符串构建函数”策略有助于将有用的构建块表达为函数（例如，上面的正则表达式可以存储在一个名为 的函数中`quoted_string()`，您可能还有其他函数可以可靠地匹配任何数值、电子邮件地址等） .

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-01T13:57:26.037

我从来没有偶然发现过这样的事情。而且我不认为这样的东西会有用。

这种高级语言会非常冗长，我的猜测是您需要相当长的语句才能提出平均复杂度的正则表达式。

也许您只是没有经常使用正则表达式。相信我，我的记忆力远非完美（甚至不是很好），但我在制作正则表达式或理解我同事的正则表达式时很少遇到问题。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-01T14:09:10.413

[用Regex Buddy](http://www.regexbuddy.com/)编写它们并将它生成的描述粘贴为您的代码的注释怎么样？

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-01T15:10:51.910

正则表达式（嗯，“真正的”正则表达式，不是现代的东西；）是有限状态机。因此，您创建了一个语法，它根据状态、边、输入和可能的输出标签来描述正则表达式。AT&T的[fsmtools](http://www.research.att.com/%7Efsmtools/fsm/) [[[webarchive]](http://web.archive.org/web/20140321151352/http://www.research.att.com/%7Efsmtools/fsm/)]支持类似的东西，但它们远非日常使用的工具。

[XFST](http://www.cis.upenn.edu/%7Ecis639/docs/xfst.html) [[[webarchive]](http://web.archive.org/web/20161130154831/http://www.cis.upenn.edu/%7Ecis639/docs/xfst.html)]中的语言，Xerox 有限状态工具包，也更加冗长。

除此之外，我想说，如果你的正则表达式变得太复杂，你应该转向更有表现力的东西。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-01T15:06:59.533

有一些方法可以使通常形式的 RE 更具可读性（例如 perl`/x`语法），并且可以使用几种更冗长的语言来表达它们。看：

*   [https://stackoverflow.com/questions/263072/why-are-regular-expressions-such-a-complicated-cryptic-mess](https://stackoverflow.com/questions/263072/why-are-regular-expressions-such-a-complicated-cryptic-mess)
*   [人们为什么要捍卫正则表达式语法？](https://stackoverflow.com/questions/264309/why-do-people-defend-the-regex-syntax)

然而，我注意到很多老手似乎并不喜欢它们。

没有根本原因您不能为针对紧凑型语言的冗长的 RE 语言编写编译器，但我看不出它有什么很大的优势。如果您喜欢冗长的形式，请使用它。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-01T16:52:54.670

XML Schema 的“内容模型”就是您想要的一个示例。

```
c(a|d)+r 
```

可以将 XML Schema 中的内容模型表示为：

```
<sequence>
 <element name="c" type="xs:string"/>
 <choice minOccurs="1" maxOccurs="unbounded">
  <element name="a" type="xs:string"/>
  <element name="d" type="xs:string"/>     
 </choice>
 <element name="r" type="xs:string"/>
<sequence> 
```

Relax NG 有另一种表达相同想法的方式。它本身不必是 XML 格式（Relax NG 也有等效的非 XML 语法）。

所有必要的转义都降低了正则表达式的可读性，而像上面这样的格式减少了对它的需求。当正则表达式变得复杂时，正则表达式的可读性也会降低，因为没有系统的方法可以将较小的正则表达式组合成较大的正则表达式（尽管您可以连接字符串）。模块化通常会有所帮助。但对我来说，较短的语法非常容易阅读（我经常将 XML Schema 内容模型转换为正则表达式以帮助我使用它们）。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-01T14:02:01.613

解决此问题的一种方法是使用 QuickREx 之类的程序，它显示了正则表达式如何处理多个测试数据（带有突出显示）。您可以将文本数据保存在您的正则表达式附近的文件中，当您想要更改它、理解它或修复它时，它会更容易。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-01-22T08:47:59.450

也许一些 JavaScript 工具可以提供帮助：

*   [可视化](http://www.regexper.com/)正则表达式，非常棒，它也在[GitHub 上](https://github.com/javallone/regexper)
*   [评估 RegEx 的几种方式](http://osteele.com/tools/rework/)
*   [带有一些语法高亮的正则表达式评估器](http://regexpal.com/)
*   带有一些有用正则表达式的[快速正则表达式评估器](http://www.techeden.com/regex)

遗憾的是，我还没有找到任何准备好使用“指向和单击”JS 工具来轻松构建和操作 RegEx。RegEx（PCRE、Posix、Python）的强大之处在于，它们

*   非常紧凑（可以说太紧凑了）
*   [几乎可以在任何地方使用](http://httpd.apache.org/docs/current/mod/mod_rewrite.html)
*   总是看起来一样（一个尴尬的尺寸适合所有人），因此很容易在代码中发现

所以重新发明轮子可能不是最好的选择，并且[正则表达式](http://docs.python.org/library/re.html#re.compile)已经在内部编译以加快速度。如果您要寻找更详尽的东西，则可以使用[LEX](http://en.wikipedia.org/wiki/Lex_%28software%29)和[YACC](http://en.wikipedia.org/wiki/Yacc)（以及它们的继任者），但是与 RegEx 可以应用的简单方式相比，大多数时候两者都夸大了事情。

以下可能对其他人有用，但不是 Linux，所以我无法对其进行测试：

*   [.NET 和 VS 正则表达式工具](http://osherove.com/tools)

如果您发现其他好的链接，也许添加为评论。我知道请求这个有点滥用，但它非常有用。谢谢。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-02-27T17:59:36.980

我看到很多试图解决问题的答案，但我想我有一个答案给你。

我相信整个正则表达式语法来自 70 年代后期。（我希望我能找到关于这个主题的某种历史）我拿起一本 1979 年关于字母自动机的书，整本书充满了在文本中寻找模式的数学证明。我回家后会得到标题并在这里更新。

问题是这本书有一些与微积分有关的非常复杂的符号，如果我没有上过这样的课程，我将无法理解它。但是，我敢打赌，经常使用这种语法的数学家能够像阅读小说一样阅读它。

我花了一个月的时间来掌握如何阅读正则表达式，以至于我只需要看一眼。对于外行来说，它看起来像复杂的汇编，其中包含所有这些奇怪的符号。我不认为正则表达式是汇编，它是在文本中查找模式的数学公式。考虑到语法和它最初来自数学家，我认为它并不遥远。

所以对于编译器，我怀疑永远不会有这样的编译器。正如 dmckee 所说，“我注意到，很多老手似乎并不喜欢它们。” 你有在白板上描绘复杂数学方程式的卡通和情景喜剧。显示某个主题有多难是一个笑话，但实际上任何有经验的人只要得到潜台词和一些训练，就可以理解它。正则表达式并不难。一旦你掌握了基础知识，它就归结为你使用的特定解析器。就像一些孩子告诉我他们不想学习 C/C++，因为它比 Javascript 难，即使它具有相同的语法。它的感知而不是困难。

一旦你学会了正则表达式，它就是给你带来问题的引擎。Visual Studio 使用括号而不是括号进行分组。我使用的简单正则表达式库[SLRE](http://code.google.com/p/slre/)有一个简单的子集 vs [PCRE](http://code.google.com/p/slre/)更完整的语法。在这一点上，我们开始谈论更多的新语言，而不是文本匹配工具。

此外，大多数程序员使用一条短线进行正则表达式匹配，而不是构建正则表达式完全匹配，因为他们只想解析一些随机数据。正则表达式匹配是像 Bison、yacc 或 ANTLR 这样的工具。手工构建的解析器总是会更好，所以本质上您可以编译自己的正则表达式，那么当简单的 ansi c while 循环更快时，为什么要花时间用 2 页代码进行正则表达式匹配呢？

如果您希望正则表达式更具动态性和可读性，最好以您用于程序的本地语言构建解析器。正则表达式是一种工具，而不是一种成熟的语言。

附带说明一下Lua 3.0 和 3.2.2 之间的一些[Lua源代码。](http://www.lua.org/)它们从 Bison 解析器变为手工构建的解析器。您会意识到，与使用工具进行文本解析相比，他们拥有更多的自由，尤其是在后期的功能版本中。当然，它也使保持更新的代码更加复杂。这是在 *.y 文件的清晰性与手工构建的稳健性之间做出的选择。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-11-04T10:08:24.667

正则表达式编译器：

[ftp://reports.stanford.edu/pub/cstr/reports/cs/tr/83/972/CS-TR-83-972.pdf](ftp://reports.stanford.edu/pub/cstr/reports/cs/tr/83/972/CS-TR-83-972.pdf)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-04T02:23:14.700

我同意正则表达式的行噪声语法是一个大问题，坦率地说，我不明白为什么这么多人接受或捍卫它，它不是人类可读的。

您在帖子中没有提到但几乎同样糟糕的是，几乎每种语言、编辑器或工具在正则表达式语法上都有自己的变体。其中一些支持多年前定义的 POSIX 语法，一些支持今天的 Perl 语法。但是很多人都有自己独立的表达方式，或者说哪些字符是“特殊的”（特殊字符是另一个话题），哪些不是。什么是逃逸的，什么不是。等等。不仅很难阅读为一种语言或工具编写的正则表达式，而且即使你完全记住了你最喜欢的变体的语法规则，它们也会让你陷入另一种语言，其中 {2,3} 不再意味着你所期望的。这真是一团糟。

此外，我认为有许多非程序员（如果他们知道它存在的话）会喜欢有一种模式匹配语言，他们可以在 Google 或 Microsoft Word 等日常工具中使用。但是需要一个更简单的语法。

因此，为了回答您的问题，我经常考虑制作某种跨平台、跨语言、跨所有内容的库，让您可以从任何正则表达式语法（无论是 Perl、POSIX 还是 Emacs）“翻译”等）转换为任何其他正则表达式语法。这样您就不必担心 Python 正则表达式是否可以进行负面回溯，或者是否应该在 Emacs 正则表达式中转义字符类括号。您可以只记住一种语法，然后进行函数调用以获取与您碰巧使用的等效语法。

从那里，它可以用一种新的模式匹配语言进行扩展，这会更冗长或至少更容易记忆。对于那些不想花半小时研究正则表达式来弄清楚它的作用的人来说。（并且认为正则表达式很好的人显然从来不需要维护他们自己没有写的任何东西，或者他们会理解其他人需要能够解析他们所写的内容。）

我会尝试这样的野兽吗？我不知道，它在我的待办事项清单上已经很久了，而且上面还有很多更简单、更有趣的项目。但是，如果您正在考虑类似的事情，请告诉我。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-01T14:03:22.937

您是否考虑过使用解析器生成器（又名编译器编译器），例如[ANTLR](http://www.antlr.org/)？

ANTLR 也有某种 IDE（[ANTLR Works](http://www.antlr.org/works/index.html)），您可以在其中可视化/调试解析器。

另一方面，解析器生成器不会像正则表达式那样在几秒钟内投入到您的应用程序中——而且对于检查电子邮件地址格式之类的东西来说，它也完全是矫枉过正。

同样对于简单的情况，这完全是矫枉过正，也许更好的方法是为您的正则表达式写注释来解释它的作用。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-07-23T23:15:07.020

如果您阅读编译器的 Dragon Book，它会告诉您使用正则表达式来分析和解析您的高级语言。所以，正则表达式似乎是更底层的东西。我经常在前端/后端开发的日常工作任务中使用它们，是的，我发现其中一些有点神秘。但是，这不会使正则表达式出错，如果您不喜欢它们，您总是可以编写一种新语言，因为 1）您有时间 2）您愿意付出适当的努力 3）内部力量强大你 ：）

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2019-12-31T23:37:12.147

这是一个旧线程，但我觉得有必要发表评论。正则表达式对于许多任务来说肯定是有问题的，例如提取跨越多行文本的感兴趣模式，从嵌入常规子模式的无上下文模式中提取内容等。自 70 年代以来，该领域的事实并没有太大变化awk、grep 等

我一直在努力寻找一个简单的正则表达式编译器，它使正则模式能够根据正则集封闭的完整操作来表示。我的目标是使用它来构建将常规序列（例如文本流）映射到目标效应器（接收单个输入符号（例如 UNICODE 序数）的简单函数并使用它对绑定到的目标对象执行某些操作的转换器）使用少量简单的选择/剪切/复制/粘贴/清除效应器可以完成广泛的简单数据提取任务。

甜蜜的是，这使得语法（源模式的解释）和语义（目标/效应器实现）之间的关注点能够清晰分离。转导运行时提供转导堆栈，使复杂或无上下文的模式能够表示为更简单的转换器树，以及一个输入堆栈，使被调用的转换器能够将有意义的信号返回给调用者。并且目标/效应器复合体具有对主机运行时和 RAM 的完全应用程序访问权限，比直接的文本到文本转换器可以完成的工作要多得多。

我只能找到一个这样的编译器，我说服作者将它发布在一个开源论坛上。你可以在这里找到它：[https](https://github.com/ntozubod/ginr) ://github.com/ntozubod/ginr 。它最初是在 1980 年代后期编写的，此后没有太大变化，但我已经广泛使用它而没有任何问题。它曾经被用来构建一个转换超过 1M 的转换器，该转换器应用于牛津英语词典到 SGML 的印前语料库（带有专有标记）。正如我所说，我使用它来定义传感器，我在此处打包和部署以供运行时使用：[https](https://github.com/jrte/ribose) ://github.com/jrte/ribose （一个 WIP）。

几个例子。

```
HelloWorld = (nil, out[`hello world`]); 
```

```
Fibonacci = (
   # ~r, ~q, ~p are sequences of 0s preset to empty string ^
   (
      # fib(0): ~q <- 0
      ('0', select[`~q`] paste)
      # fib(n>1): cycle (~r) <- (~q) <- (~p) <- (~p)(~r), (~r) <- ^
      ('0', select[`~r`] cut[`~p`] select[`~p`] copy[`~q`] select[`~q`] cut[`~r`])*
   )?
   # (~q) is empty or selected and holds the result, so append nl and print result
   (nl, paste out stop)
);

(Fibonacci$(0,1 2)):prsseq;

(START)  0  [ select ~q paste ]                                     1
(START)  nl [ paste out stop ]                                      (FINAL)
1        0  [ select ~r cut ~p select ~p copy ~q select ~q cut ~r ] 1
1        nl [ paste out stop ]                                      (FINAL)

$ for n in '' 0 00 000 0000 00000 000000 0000000 00000000 000000000; do echo $n | jrte Fibonacci; done

0
0
00
000
00000
00000000
0000000000000
000000000000000000000
0000000000000000000000000000000000 
```

# c# - 如何使用文件系统驱动程序隐藏 C# 中的目录？

> ID：500845
> 
> 赞同：0
> 
> 时间：2009-02-01T13:49:57.677
> 
> 标签：c#, .net, filesystems

我想开发一个可以隐藏文件夹的程序。不是隐藏的属性，而是真正的隐藏，因此没有应用程序可以找到它。我认为为此我需要创建一个文件系统驱动程序。

我怎样才能在 C# 中做到这一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-01T13:50:54.647

你不能在 C# 中做到这一点。

您可能会发现这些视频很有趣。内部文件系统过滤器[Part1](http://channel9.msdn.com/shows/Going+Deep/Neal-Christiansen-Inside-File-System-Filter-part-I/) & [Part2](http://channel9.msdn.com/shows/Going+Deep/Neal-Christiansen-Inside-File-System-Filter-part-II/)。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-01T15:23:09.063

这将需要大量的工作，并且您很可能最终会损坏您的文件系统。也许您可以通过隐藏这些文件夹告诉我们您想要完成的 50,000 英尺视图。

比如有什么需要隐藏这些文件夹？它们只是对计算机用户隐藏，但是任何读取磁盘驱动器进行恢复的软件仍然可以读取它们，这可以接受吗？为什么使用隐藏标志的加密不一样好？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-01T13:52:30.697

如果你想要隐私，你可能最好编写一个可以加密文件夹的应用程序，这样其他程序就无法读取它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-10T04:53:37.100

我可以建议只下载一个 rootkit 而不是从头开始构建一个吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-01T14:04:10.453

在文件夹上使用系统属性怎么样？

当您想使用自己的文件系统时，您还需要一个单独的分区。例如，预装 Windows 系统上的恢复工具安装在单独的隐藏分区中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-10T04:45:30.863

我想我必须为我真正想要的东西创建一个文件系统过滤器驱动程序。它不仅仅是改变属性

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-02-09T08:16:20.753

```
// Get Application start up path
string path = Application.StartupPath;
// Create Batch File Path
string filePath = path + "\\Hide.bat";
// Write syntex to write in BAtch File
string strToWrite = "attrib +h +s " + '"' + path + '"';
// Create Batch File
FileStream fs = new FileStream(filePath, FileMode.Create);
StreamWriter sw = new StreamWriter(fs);
sw.WriteLine(strToWrite);
sw.Close();
fs.Close(); 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-11-23T18:33:28.067

看看 Dokan (dokan-dev.net)，看看它是否适合你。

# java - 是否有用于使用体素引擎进行渲染的 java 库？

> ID：500857
> 
> 赞同：6
> 
> 时间：2009-02-01T13:53:02.800
> 
> 标签：java, rendering, voxel

我感兴趣的是java中是否有库可以渲染基于[体素](http://en.wikipedia.org/wiki/Voxel)的风景？一如既往地首选开源。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-01T17:05:17.327

有一些尝试使用现在已晚的 J3D 来支持体素。 [这里有些例子](http://java3d.j3d.org/tutorials/quick_fix/volume.html)

几年前爱荷华大学也有一个项目，叫做 VolumeJ，但这个[项目](http://webscreen.ophth.uiowa.edu/bij/vr.htm)相当老了。

最后，最近有一个关于这些框架的[学术调查](http://spiedl.aip.org/getabs/servlet/GetabsServlet?prog=normal&id=PSISDG006918000001691804000001&idtype=cvips&gifs=yes)，我确信某处有免费的 PDF。

# silverlight - 如何在 Silverlight 中更改文本块的背景颜色？

> ID：500863
> 
> 赞同：28
> 
> 时间：2009-02-01T13:56:02.390
> 
> 标签：silverlight

我想要一个在黄色背景上有蓝色文本的文本块。我可以使用“前景”属性设置蓝色文本。但是“背景”不起作用（我猜这太容易了）。

那么最好的方法是什么，将它包装在具有背景颜色的 Rectangle 或 Canvas 中？

而且，我们是否应该了解有关 Silverlight 的任何信息，以了解为什么它们没有为您经常想要设置背景颜色的许多元素包含 Background 属性？

例如，这会给出错误“在 Textblock 类型中找不到属性背景”：

```
<TextBlock 
    Foreground="Blue" 
    Background="Yellow"
        Height="20" 
    HorizontalAlignment="Stretch" 
    Margin="0"
    Test="this is a test"/> 
```

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-02-03T12:40:16.783

[TextBlock](http://msdn.microsoft.com/en-us/library/system.windows.controls.textblock(VS.95).aspx)派生自[FrameworkElement](http://msdn.microsoft.com/en-us/library/system.windows.frameworkelement(VS.95).aspx)。[TextBox](http://msdn.microsoft.com/en-us/library/system.windows.controls.textbox(VS.95).aspx)是从[Control](http://msdn.microsoft.com/en-us/library/system.windows.controls.control(VS.95).aspx)派生的，而 Control 又是从 FrameworkElement 派生的。[背景颜色属性](http://msdn.microsoft.com/en-us/library/system.windows.controls.control.background(VS.95).aspx)放置在控件中。

在 WPF 中，[TextBlock](http://msdn.microsoft.com/en-us/library/system.windows.controls.textblock.aspx)具有它自己的[背景属性](http://msdn.microsoft.com/en-us/library/system.windows.controls.textblock.background.aspx)。

在文本后面添加颜色的最佳方法是将文本放置在边框或网格之类的容器中。就像是：

```
<Grid  Background="Yellow" >  
    <TextBlock Foreground="Blue"
               Height="20"
               HorizontalAlignment="Stretch"
               Margin="0" 
               Text="this is a test"/> 
</Grid> 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2012-07-20T10:40:15.483

```
<Border Background="GreenYellow">
    <TextBlock Text="sdfs" Height="60" Width="200"  />
</Border> 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-01T14:27:29.270

出于某种原因，它不在 Silverlight 中，尽管它在 WPF 中。只需在它周围包裹一个边框（它会自动调整到内容的大小）。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-03-23T09:04:44.803

只是如果有人发现这个线程谷歌搜索或 binging ......

如果您需要背景，请使用标签控件，它从版本 3 开始就在工具包中，我猜在版本 4 中它已经包含在核心中。

在 Silverlight 中引用[标签控件](http://www.c-sharpcorner.com/UploadFile/mahesh/SilverlightLabel12132008105302AM/SilverlightLabel.aspx)

# python - 不重新编译的不区分大小写的正则表达式？

> ID：500864
> 
> 赞同：455
> 
> 时间：2009-02-01T13:56:14.340
> 
> 标签：python, regex, case-sensitive, case-insensitive

在 Python 中，我可以使用以下命令编译一个不区分大小写的正则表达式`re.compile`：

```
>>> s = 'TeSt'
>>> casesensitive = re.compile('test')
>>> ignorecase = re.compile('test', re.IGNORECASE)
>>> 
>>> print casesensitive.match(s)
None
>>> print ignorecase.match(s)
<_sre.SRE_Match object at 0x02F0B608> 
```

有没有办法做同样的事情，但不使用`re.compile`. 我在文档中找不到类似 Perl 的`i`后缀（例如`m/test/i`）的东西。

* * *

## 回答 #1

> 赞同：728
> 
> 时间：2009-02-01T14:01:10.040

传递`re.IGNORECASE`给、或的`flags`参数：[`search`](https://docs.python.org/library/re.html#re.search)[`match`](https://docs.python.org/library/re.html#re.match)[`sub`](https://docs.python.org/library/re.html#re.sub)

```
re.search('test', 'TeSt', re.IGNORECASE)
re.match('test', 'TeSt', re.IGNORECASE)
re.sub('test', 'xxxx', 'Testing', flags=re.IGNORECASE) 
```

* * *

## 回答 #2

> 赞同：128
> 
> 时间：2012-05-04T07:05:38.797

您还可以使用不带 IGNORECASE 标志的搜索/匹配来执行不区分大小写的搜索（在 Python 2.7.3 中测试）：

```
re.search(r'(?i)test', 'TeSt').group()    ## returns 'TeSt'
re.match(r'(?i)test', 'TeSt').group()     ## returns 'TeSt' 
```

* * *

## 回答 #3

> 赞同：75
> 
> 时间：2017-02-23T03:43:41.960

不区分大小写的标记，`(?i)`可以直接合并到正则表达式模式中：

```
>>> import re
>>> s = 'This is one Test, another TEST, and another test.'
>>> re.findall('(?i)test', s)
['Test', 'TEST', 'test'] 
```

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2014-05-12T15:26:30.893

您还可以在模式编译期间定义不区分大小写：

```
pattern = re.compile('FIle:/+(.*)', re.IGNORECASE) 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2017-06-01T03:34:40.797

在进口

```
import re 
```

在运行时处理：

```
RE_TEST = r'test'
if re.match(RE_TEST, 'TeSt', re.IGNORECASE): 
```

需要指出的是，不使用`re.compile`是浪费。每次调用上述 match 方法时，都会编译正则表达式。这也是其他编程语言的错误做法。下面是更好的做法。

在应用程序初始化中：

```
self.RE_TEST = re.compile('test', re.IGNORECASE) 
```

在运行时处理：

```
if self.RE_TEST.match('TeSt'): 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2019-06-21T04:15:43.707

要执行不区分大小写的操作，请提供 re.IGNORECASE

```
>>> import re
>>> test = 'UPPER TEXT, lower text, Mixed Text'
>>> re.findall('text', test, flags=re.IGNORECASE)
['TEXT', 'text', 'Text'] 
```

如果我们想替换匹配大小写的文本......

```
>>> def matchcase(word):
        def replace(m):
            text = m.group()
            if text.isupper():
                return word.upper()
            elif text.islower():
                return word.lower()
            elif text[0].isupper():
                return word.capitalize()
            else:
                return word
        return replace

>>> re.sub('text', matchcase('word'), test, flags=re.IGNORECASE)
'UPPER WORD, lower word, Mixed Word' 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2020-05-04T20:40:42.980

对于不区分大小写的正则表达式（Regex）：在代码中添加有两种方法：

1.  `flags=re.IGNORECASE`

    ```
    Regx3GList = re.search("(WCDMA:)((\d*)(,?))*", txt, **re.IGNORECASE**) 
    ```

2.  不区分大小写的标记`(?i)`

    ```
    Regx3GList = re.search("**(?i)**(WCDMA:)((\d*)(,?))*", txt) 
    ```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2016-10-12T22:48:14.963

```
#'re.IGNORECASE' for case insensitive results short form re.I
#'re.match' returns the first match located from the start of the string. 
#'re.search' returns location of the where the match is found 
#'re.compile' creates a regex object that can be used for multiple matches

 >>> s = r'TeSt'   
 >>> print (re.match(s, r'test123', re.I))
 <_sre.SRE_Match object; span=(0, 4), match='test'>
 # OR
 >>> pattern = re.compile(s, re.I)
 >>> print(pattern.match(r'test123'))
 <_sre.SRE_Match object; span=(0, 4), match='test'> 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2019-11-04T05:19:44.640

如果您想替换但仍保留以前 str 的样式。有可能的。

例如：突出显示字符串“test asdasd TEST asd tEst asdasd”。

```
sentence = "test asdasd TEST asd tEst asdasd"
result = re.sub(
  '(test)', 
  r'<b>\1</b>',  # \1 here indicates first matching group.
  sentence, 
  flags=re.IGNORECASE) 
```

**测试**asdasd**测试**asd测试**asdasd**

# cocoa - NSXMLParser 和错误常量

> ID：500869
> 
> 赞同：0
> 
> 时间：2009-02-01T14:00:26.140
> 
> 标签：cocoa

是否有 NSXMLParser 可以返回的各种错误的描述？我知道这些代码的[苹果文档](http://developer.apple.com/DOCUMENTATION/Cocoa/Reference/Foundation/Classes/NSXMLParser_Class/Reference/Reference.html#//apple_ref/doc/uid/20001984-SW1)，但是这个页面除了错误的标题之外没有给出任何东西。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-01T16:45:50.800

这`enum`定义了所有的`NSXMLParserError`s。如果您想要（稍微）更多详细信息，可以单击列表中的特定常量。

# c - 如何在 C 中处理指针？

> ID：500886
> 
> 赞同：7
> 
> 时间：2009-02-01T14:10:24.483
> 
> 标签：c, pointers

我对 C 非常陌生，并且在学习指针方面遇到了一些问题。我尝试了交换，这就是我能用它们做的所有事情:) 我知道每个变量在内存单元中都有自己的地址（这是我的讲师告诉我们的），每个变量的值都可以通过转到其关联地址然后获取存储在其中的值。我见过一些函数头，例如：

```
int doSomething(char **hihi); 
```

我的头很混乱。我知道指针也是一个变量，它只将地址信息存储在它的内存单元中。我读到它们与数组密切相关

```
arr = &arr[0]; 
```

这就是我对指针的全部了解，我想知道如何加深对指针的看法。我在网上搜索，我找不到任何有用的备忘单涵盖指针。而且我还想知道为什么它们如此重要，有没有办法在不使用`printf()`打印它们的地址（`p`）和值（`\*p`）的情况下了解实际发生了什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-01T14:31:13.240

打印地址和值是查看它们的合理方式。但是，如果您可以启动并运行调试器，那就更好了，因为您可以更快地跟踪指针，观察它们在您执行时的变化，等等。

如果您熟悉 Windows 中的“快捷方式”或 linux 文件系统中的软链接，那么在您刚开始时，将指针视为指向另一个对象（无论该对象是否是一个结构、一个内置类型、另一个指针等）。

快捷方式仍然是一个文件。它在磁盘驱动器上占用自己的空间，它引用另一个文件，并且可以修改它以引用与以前不同的文件文件。类似地，C 中的指针是一个占用内存的对象，包含另一个内存位置的地址，并且只需分配给它就可以更改为包含不同的地址。

一个区别是，如果您双击一个快捷方式，它的行为就像您双击了它所指向的东西一样。指针不是这种情况——你总是必须用“*”或“->”显式地取消引用指针才能访问它指向的东西。另一个不同之处在于，在 C 语言中有指向指向某物的指针的指针是很常见的。

至于行话，不幸的是你只需要学习它。“int doSomething(char **hihi)”的意思是“一个名为 doSomething 的函数，它返回一个整数，并将一个指向 char 指针的指针作为参数”。关键是“ `char ** hihi`”的意思是“指向字符的指针。我们称指针指向字符的指针hihi”。你说hihi的“类型”是char**，而*hihi的“类型”（当你取消引用指针时得到的）是char*，而**hihi的类型是char。

通常在 C 中，指向 char 的指针表示字符串（换句话说，它是指向 NUL 终止数组中的第一个 char 的指针）。所以“char *”经常意味着“字符串”，但它不是必须的。它可能只意味着指向一个字符的指针。有点像 Windows 中 1 字节文件的快捷方式（好吧，无论如何都是 FAT32），指向 C 中 char 的指针实际上比它指向的东西大:-)

同样，一个 char** 通常不仅意味着指向一个字符串指针的指针，还意味着指向一个字符串指针数组。可能不会，但如果确实如此，那么下面的小图可能会有所帮助：

```
嗨嗨
 ____ ____ ________ _________ _______
|____| -----> |____| *嗨 ---> |___A____| |___B_____| |___C___|
                |____| *(hihi+1) ------------------^ ^
                |____| *(hihi+2) ---------------------------------|
                | ...| 等等

```

hihi 指向塔式工作，这是我表示指针数组的方式。正如您已经注意到的，我可以用 hihi[0] 代替 *hihi，用 hihi[1] 代替 *(hihi+1)，等等。

这是一个连续的内存块，它的每个指针大小的块都包含（即，它“指向”）另一个内存块的地址，在天知道的地方，包含一个或多个字符。所以，hihi[0] 是字符串 A 的第一个字符的地址，hihi[1] 是字符串 B 的第一个字符的地址。

如果 hihi 不指向数组，只是一个指针，那么塔楼就是平房。同样，如果 *hihi 不指向字符串，仅指向一个字符，则长而细的块是正方形。您可能会问，“我怎么知道塔楼有多少层？”。这在 C 编程中很重要——通常函数文档会告诉你（它可能会说“1”或“12”，或者“足够你告诉我做的事情”，否则你会通过楼层数作为额外参数，否则文档会告诉您数组是“NULL终止”，这意味着它将继续读取直到它看到地址/值NULL，然后停止。主函数实际上同时执行第二和第三件事 - argc 包含参数的数量，*为了安全起见，argv 是 NULL 终止的。*

 *因此，每当您看到指针参数时，您都必须查看函数的文档以查看它是否需要指向数组的指针，如果需要，数组必须有多大。如果您对此不小心，您将创建一种称为“缓冲区溢出”的错误，其中一个函数期望一个指向大数组的指针，你给它一个指向小数组的指针，它在结尾处乱写你给它的东西并开始破坏记忆。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-01T14:15:37.343

我认为这是古典书籍比大多数在线资源更有用的地方。如果你能得到一份副本，请非常仔细地阅读*The C Programming Language (aka K&R)。*如果您想了解更多信息，请前往*Expert C Programming: Deep Secrets*（只需 google 即可）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-01T14:16:15.547

指针是一个地方。

数组是一组连续的地方。

一个地方总是有价值的。（它可能是剩余的垃圾）。

每个变量*都有*一个位置。

对于指针变量，它所在位置的值*是一个 place*。

就像寻宝一样。“在 13 号邮箱中查找一张便条，告诉您哪个邮箱包含您的生日贺卡。”

如果邮箱 13 包含一个写着“13”的便条，那么您的生日贺卡将是很久以后的事了！（这是由循环指针引用引起的错误。;-)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-01T14:34:23.357

虽然在这里阅读 K&R 可能是最好的选择，但我会尽量让它更清楚一点：

指针本身就是一个变量。但是它不存储一个值，而是只存储一个地址。把它想象成一个索引：就像在你的地址簿中你正在搜索的东西的索引（比如，某个名字的电话号码）它指向信息的存储位置。在您的通讯录中，可能会显示“查看第 23 页以查找 Joe 的电话号码”。如果是指针，它只是说“查看内存地址 1234 以检索我指向的信息”。由于指针值本身只是一个内存地址，您可以用它进行算术运算——比如添加值（这与访问数组元素相同：如果指针指向数组，则指针后面的地址指向将访问数组中的下一个元素）。您的示例功能`int doSomething(char *hihi)`将 hihi 指向您在调用它时传递的内存地址。如果您想传递大量数据，这很有用——`void blah(int a)`您只需复制其位置，而不是复制数据（这发生在具有 a 值的函数中）。

我在上面遗漏了一些细节，但我希望它至少能给你一些基本的理解。我强烈建议阅读 K&R 或有关该主题的类似书籍。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-01T15:02:47.670

听起来你已经掌握了基础知识。在您进一步阅读一些文献之前，我不会跳到备忘单上。使用指针时要小心的原因是它们允许您直接访问特定的内存地址，如果您的代码这样做，错误的事情将会中断。数组将指向第一个位置，根据数组类型，您可以通过使用相同数组存储值类型的指针来访问数组中的更多位置。

我首先要了解变量、左值、右值和赋值，然后是作为变量类型的指针，然后是指针解引用和进一步的指针操作。详细说明这一点需要相当多的时间，并且已经有很多很好的参考资料可供使用。

[你可以在这里](http://pweb.netcom.com/~tjensen/ptr/cpoint.htm)找到一个介绍教程（非常详细的解释）。 [PDF 直接链接](http://home.earthlink.net/~momotuk/pointers.pdf)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-01T15:09:36.080

```
/* Given a string of characters like this one: */
char *string = "Hello!\n";

/* Memory will contain something like:
0x00100 'H'
0x00101 'e'
0x00102 'l'
0x00103 'l'
0x00104 'o'
0x00105 '!'
0x00106 '\n'
0x00107 '\0'
*/

/* And the program code will say: */
string=0x00100;

/* C doesn't really have arrays */
char c=string[3];
/* is just syntactic sugar for: */

char c=*((char*)((void*)string + 3 * sizeof(char)));
/* ie. 0x00100 + 3 * 1 */
/* ie. 0x00103 */
/* and * dereferences 0x00103, this means char_in(0x00103) */

/* When you pass a pointer you are actually passing the value
   of the memory position */

int a;          /* allocates space for a random four byte value in
                   0x00108 */
scanf("%d",&a); /* &a = 0x00108 scanf now knows that it has to store
                  the value in 0x0108 */

/* Even if you declare: */
int b[23];
/* b will be just a pointer to the beginning of 23 allocated ints.
   ie. 0x0010C */

/* pointer arithmetic is different from normal types in that: */
b++;
/* is actually: */
b+=4; /* b+=1*sizeof(int); */
/* So pointers in C work more like arrays */ 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-01T15:18:23.410

达沃斯，你上大学了吗？你是计算机科学专业的吗？您可能会考虑的一件事是学习汇编语言课程（MIPS、x86）。我是电气工程专业的，我被要求参加那些低水平的课程。我观察到的一件事是，当我开始学习 C++ 时，对汇编语言有清晰的理解确实对我很有帮助。特别是，它让我对指针有了更清晰的理解。

指针和取消引用是汇编语言级别的基本概念。如果您是第一次学习指针，我发现在某些方面“C”隐藏了太多，实际上它在汇编语言级别变得更加清晰。然后，您可以获取较低级别的知识，并了解“C”语言如何在其之上添加一些语法。

只是一个想法。除此之外，正如一些人所提到的，K&R 是一本很棒的书，而且实现一些抽象数据类型（如链表）可能很有用，特别是如果您绘制显示内存布局的图表，它可以帮助澄清这个想法。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-01T15:33:39.650

恕我直言，“获取”指针的最佳方法是进行一些汇编语言编程。一旦您习惯于考虑原始寄存器内容（数据和地址之间除了您如何使用它们之外没有真正的区别）和加载存储指令，C 的指针类型将更有意义（以及您对C 为您所做的将大大改善）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-01T19:12:21.800

如果你真的想理解指针，你需要一个好的大学讲座。

我见过的最好的就是[这个](http://www.youtube.com/watch?v=Rxvv9krECNw)。

没有什么比得上。

另请查看有关图灵的讲座。它做得很好。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-01T20:04:17.700

上面给出了很多很好的答案。其他一些见解是指针始终是无符号整数类型。它在内存中指向的对象或变量可以是任何类型。

在 32 位操作系统中，整数是一个 4 字节的数字，并且必须在范围内

0 < 指针值 < (2^^32) -1

在 64 位操作系统中，整数是一个 8 字节的数字，并且必须在范围内

0 < 指针值 < (2^^64) -1

指针值 = 0 被解释为称为 NULL 的特殊标志值，表示该指针未指向可用变量。

指针用于间接寻址。CPU 中的一些寄存器充当指针，例如程序计数器 (PC) 和地址寄存器。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2009-02-01T14:16:57.013

你读过[K&R](http://en.wikipedia.org/wiki/The_C_Programming_Language_(book))吗？如果你还没有，我会说这是你应该开始的地方。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2009-02-01T14:23:03.990

一个有点不合常规的建议：[http ://www.youtube.com/watch?v=Rxvv9krECNw](http://www.youtube.com/watch?v=Rxvv9krECNw)

这是我去年在我大学的高级计算 1 的讲座。前几分钟会有点无用（主题管理员类型的东西），但除此之外，这是一个非常好的解释

# java - 使用 Java 生成带有数据字段的图像

> ID：500891
> 
> 赞同：2
> 
> 时间：2009-02-01T14:14:05.160
> 
> 标签：java, image, image-generation

您将如何生成包含在数据库表中存储和更新的数据字段的 JPG 图像文件？然后每隔一小时左右重新生成一次图像，以反映数据库表中的最新值。

您将从一个基本的背景图像开始，然后生成的图像应该包含覆盖在背景图像顶部的数据字段（例如平均温度、cpu 负载、自上次重启以来的时间等）。数据将通过漂亮的图表、图标和字体进行可视化。

谢谢！

编辑：好东西。有很多关于图表的好建议，尤其是像 JFreechart。我仍然有点不确定如何最好地在背景图像上叠加图像（即图标）。基本的 Java API 是否最适合这种情况？

蒂亚！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-01T14:19:24.543

你可以使用 jfreechart

这是一些不错的教程 [http://www.oracle.com/technology/pub/articles/marx-jchart.html](http://www.oracle.com/technology/pub/articles/marx-jchart.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-01T14:18:56.323

查看[**关于 2D 图形的 Java 教程**](http://java.sun.com/docs/books/tutorial/2d/index.html)。您可以将背景图像加载为[`BufferedImage`](http://java.sun.com/javase/6/docs/api/java/awt/image/BufferedImage.html)using [`ImageIO.read()`](http://java.sun.com/javase/6/docs/api/javax/imageio/ImageIO.html#read(java.io.File))，然后在其上使用[`Graphics.drawString()`](http://java.sun.com/javase/6/docs/api/java/awt/Graphics.html#drawString(java.lang.String,%20int,%20int)). 然后，您可以使用[`ImageIO.write()`](http://java.sun.com/javase/6/docs/api/javax/imageio/ImageIO.html#write(java.awt.image.RenderedImage,%20java.lang.String,%20java.io.File)).

* * *

OP 增加了更复杂的要求（漂亮的图表、图标和字体）。在这种情况下，许多图表或报告包中的一个（例如[JFreeChart](http://www.jfree.org/jfreechart/)、[JasperForge](http://jasperforge.org/)）会更合适。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-01T14:20:16.663

创建你的 BufferedImage

从此图像创建 Graphics2D

在 Graphics2D 上绘制图片

使用 ImageIO 类保存您的图像

在此处查看示例：[http ://www.java2s.com/Code/Java/2D-Graphics-GUI/DrawanImageandsavetopng.htm](http://www.java2s.com/Code/Java/2D-Graphics-GUI/DrawanImageandsavetopng.htm)

在您的情况下，我宁愿使用**SVG**图像，或者为什么不使用简单的 HTML 表格？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-01T14:28:28.207

[RRDtool](http://oss.oetiker.ch/rrdtool/) (Round Robin Database) 是专门处理此类数据的数据库。

RDDtool有很多java实现。恕我直言，您应该先尝试[Jrobin](http://www.jrobin.org/index.php/Main_Page)。

律师事务所，安德里亚

# iphone - 如何在 iPhone 上启用 NSDebugEnabled/NSEnableAutoreleasePool

> ID：500913
> 
> 赞同：1
> 
> 时间：2009-02-01T14:26:32.470
> 
> 标签：iphone, debugging, memory

您可以设置环境变量来帮助调试 Mac 上的内存问题，但是如何设置环境变量或启用 NSDebug.h 中描述的这些标志以进行 iPhone 开发？

```
NAME OF ENV. VARIABLE               DEFAULT    SET TO...
NSDebugEnabled                        NO       "YES"
NSZombieEnabled                       NO       "YES"
NSDeallocateZombies                   NO       "YES"
NSHangOnUncaughtException             NO       "YES"

NSEnableAutoreleasePool              YES       "NO"
NSAutoreleaseFreedObjectCheckEnabled  NO       "YES"
NSAutoreleaseHighWaterMark             0       non-negative integer
NSAutoreleaseHighWaterResolution       0       non-negative integer 
```

这是一篇有关如何为一般 Mac 开发做我猜想的相关文章。也许对 iPhone 来说也是如此，但由于我是 Mac 新手，模拟器如何获取这些环境变量？

[http://www.cocoabuilder.com/archive/message/cocoa/2003/7/15/90466](http://www.cocoabuilder.com/archive/message/cocoa/2003/7/15/90466)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-01T18:05:09.563

您必须进入可执行文件的“获取信息”上下文菜单（在 XCode 左侧面板的“可执行文件”组内）。然后进入参数选项卡。您可以在底部的框中​​添加上面指定的环境变量（“要在 env 中设置的变量。”。只需输入 YES 或 NO，您不需要使用引号，它已经是一个字符串标记。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-30T15:33:53.530

另外，我可以推荐调用 [NSAutoreleasePool showPools] 来获取当前池级别和内容的日志。

# c# - 通过 XSLT 在 XML 中格式化日期

> ID：500915
> 
> 赞同：37
> 
> 时间：2009-02-01T14:28:24.710
> 
> 标签：c#, .net, xml, datetime, xslt

当我使用 XML 序列化器对 a 进行序列化时`DateTime`，它是按以下格式编写的：

```
<Date>2007-11-14T12:01:00</Date> 
```

当通过 XSLT 样式表传递它以输出 HTML 时，我该如何格式化它？在大多数情况下，我只需要日期，而当我需要时间时，我当然不希望出现“有趣的 T”。

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2009-02-01T15:01:35.223

以下是您可以使用的几个 1.0 模板：-

```
<xsl:template name="formatDate">
    <xsl:param name="dateTime" />
    <xsl:variable name="date" select="substring-before($dateTime, 'T')" />
    <xsl:variable name="year" select="substring-before($date, '-')" />
    <xsl:variable name="month" select="substring-before(substring-after($date, '-'), '-')" />
    <xsl:variable name="day" select="substring-after(substring-after($date, '-'), '-')" />
    <xsl:value-of select="concat($day, ' ', $month, ' ', $year)" />
</xsl:template>

<xsl:template name="formatTime">
    <xsl:param name="dateTime" />
    <xsl:value-of select="substring-after($dateTime, 'T')" />
</xsl:template> 
```

打电话给他们： -

```
 <xsl:call-template name="formatDate">
        <xsl:with-param name="dateTime" select="xpath" />
    </xsl:call-template> 
```

和

```
 <xsl:call-template name="formatTime">
        <xsl:with-param name="dateTime" select="xpath" />
    </xsl:call-template> 
```

其中 xpath 是具有标准日期时间格式的元素或属性的路径。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-02-01T14:50:54.667

在 XSLT 1.0 中日期格式化并不容易。可能最优雅的方法是用 C# 编写一个简短的 XSLT 扩展函数来格式化日期。这是一个例子：

```
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0"
                xmlns:msxsl="urn:schemas-microsoft-com:xslt"
                xmlns:myExtension="urn:myExtension"
                exclude-result-prefixes="msxsl myExtension">
  <xsl:output method="xml" indent="yes"/>

  <msxsl:script implements-prefix="myExtension" language="C#">
    <![CDATA[
      public string FormatDateTime(string xsdDateTime, string format)
      {
          DateTime date = DateTime.Parse(xsdDateTime);
          return date.ToString(format); 
      }

    ]]>
  </msxsl:script>

  <xsl:template match="date">
    <formattedDate>
      <xsl:value-of select="myExtension:FormatDateTime(self::node(), 'd')"/>
    </formattedDate>
  </xsl:template>
</xsl:stylesheet> 
```

有了这个输入文件

```
<?xml version="1.0" encoding="utf-8"?>
<date>2007-11-14T12:01:00</date> 
```

你会得到

```
<?xml version="1.0" encoding="utf-8"?>
<formattedDate>14.11.2007</formattedDate> 
```

格式化日期的函数将日期值作为字符串和[DateTime.ToString 方法](http://msdn.microsoft.com/en-us/library/zdtaw1bw.aspx)中描述的格式。使用 .NET 的 DateTime 结构，您可以免费解析任意 XSD 日期时间值（包括时区说明符）、时区计算和本地化输出。

但是，请注意，对于 msxml 脚本扩展有一个[警告 (http://support.microsoft.com/kb/316775)](http://support.microsoft.com/kb/316775)：每次加载 XSLT 时，都会动态生成包含脚本代码的程序集并将其加载到内存中。由于 .NET 运行时的设计，无法卸载此程序集。这就是为什么您必须确保您的 XSLT 只加载一次（然后缓存起来以供进一步重用）。这在 IIS 中运行时尤其重要。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-01T15:12:19.710

John Workman 详细讨论了这个问题，并在他的博客上的[讨论](http://geekswithblogs.net/workdog/archive/2007/02/08/105858.aspx)^([1]中给出了几个解决方案。)基本上，解析各个日期组件并按照您希望的任何顺序重新组合。对于您的情况，纯 XSLT 1.0+ 版本将是：

```
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="date">
<!-- converts FROM <date>2001-12-31T12:00:00</date> TO some new format (DEFINED below) -->
<xsl:template name="FormatDate">
<xsl:param name="DateTime" />

<xsl:variable name="year" select="substring($DateTime,1,4)" />
<xsl:variable name="month-temp" select="substring-after($DateTime,'-')" />
<xsl:variable name="month" select="substring-before($month-temp,'-')" />
<xsl:variable name="day-temp" select="substring-after($month-temp,'-')" />
<xsl:variable name="day" select="substring($day-temp,1,2)" />
<xsl:variable name="time" select="substring-after($DateTime,'T')" />
<xsl:variable name="hh" select="substring($time,1,2)" />
<xsl:variable name="mm" select="substring($time,4,2)" />
<xsl:variable name="ss" select="substring($time,7,2)" />

<!-- EUROPEAN FORMAT -->
<xsl:value-of select="$day"/>
<xsl:value-of select="'.'"/> <!--18.-->
<xsl:value-of select="$month"/>
<xsl:value-of select="'.'"/> <!--18.03.-->
<xsl:value-of select="$year"/>
<xsl:value-of select="' '"/> <!--18.03.1976 -->
<xsl:value-of select="$hh"/>
<xsl:value-of select="':'"/> <!--18.03.1976 13: -->
<xsl:value-of select="$mm"/>
<xsl:value-of select="':'"/> <!--18.03.1976 13:24 -->
<xsl:value-of select="$ss"/> <!--18.03.1976 13:24:55 -->
<!-- END: EUROPEAN FORMAT -->

</xsl:template> 
```

另一种格式（替换欧洲格式部分）：

```
<!-- Long DATE FORMAT -->
<xsl:choose>
<xsl:when test="$month = '1' or $month= '01'">January</xsl:when>
<xsl:when test="$month = '2' or $month= '02'">February</xsl:when>
<xsl:when test="$month= '3' or $month= '03'">March</xsl:when>
<xsl:when test="$month= '4' or $month= '04'">April</xsl:when>
<xsl:when test="$month= '5' or $month= '05'">May</xsl:when>
<xsl:when test="$month= '6' or $month= '06'">June</xsl:when>
<xsl:when test="$month= '7' or $month= '07'">July</xsl:when>
<xsl:when test="$month= '8' or $month= '08'">August</xsl:when>
<xsl:when test="$month= '9' or $month= '09'">September</xsl:when>
<xsl:when test="$month= '10'">October</xsl:when>
<xsl:when test="$month= '11'">November</xsl:when>
<xsl:when test="$month= '12'">December</xsl:when>
</xsl:choose> 
<xsl:value-of select="' '"/> <!--January -->
<xsl:value-of select="$day"/> <!--January 12 -->
<xsl:value-of select="','"/> <!--January 12,-->
<xsl:value-of select="' '"/> <!--January 12, -->
<xsl:value-of select="$year"/> <!--January 12, 2001-->
<!-- END: Long DATE FORMAT --> 
```

您可以以您选择的任何方式重新组合元素。

[1] [http://geekswithblogs.net/workdog/archive/2007/02/08/105858.aspx](http://geekswithblogs.net/workdog/archive/2007/02/08/105858.aspx) @@ [http://archive.is/4Hjep](http://archive.is/4Hjep)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-03-09T06:28:50.410

很抱歉评论这个旧线程，但对于像我一样发现它的其他人，如果您使用的是 MS 转换器，您也可以使用 javascript：

声明“msxsl”命名空间：

```
xmlns:msxsl="urn:schemas-microsoft-com:xslt" 
```

为您的脚本声明一个命名空间：

```
xmlns:js="urn:custom-javascript" 
```

（可选）省略输出中的前缀：

```
exclude-result-prefixes="msxsl js" 
```

所以你最终会得到一个像这样的 xsl 声明：

```
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0"
  xmlns:msxsl="urn:schemas-microsoft-com:xslt"
  xmlns:js="urn:custom-javascript"
  exclude-result-prefixes="msxsl js"> 
```

在 msxsl:script 元素中编写 JavaScript：

```
<msxsl:script language="JavaScript" implements-prefix="js"> 
<![CDATA[ 
function javascriptFunction(dateValue){
  var date = new Date(dateValue);
  if(!isNaN(date)) return date.toLocaleString();
  return dateValue;
}
]]>
</msxsl:script> 
```

调用您的 JavaScript 函数（使用 XPath 语法“。”表示“此节点”）：

```
<xsl:value-of select="js:javascriptFunction(string(.))"/> 
```

注意：在撰写本文时，似乎没有（xsl）方法来包含外部 js 文件（例如 jquery 库）。这可以通过在转换之前解析 xsl 文件服务器端并将 js 文件内容作为字符串添加到 CDATA 部分来完成。我自己开始走这条路，但得出的结论是，如果您需要这种级别的功能，最好将其放置在管道的不同部分。

来源：[http](http://dev.ektron.com/kb_article.aspx?id=482)
://dev.ektron.com/kb_article.aspx?id=482 参考： http: [//www.ibm.com/developerworks/xml/library/x-tipxsltjs/index.html](http://www.ibm.com/developerworks/xml/library/x-tipxsltjs/index.html)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-11-24T17:31:28.920

更正 roy 的帖子：函数中的日期将始终获得月份值。使用以下内容：

```
<xsl:variable name="year" select="substring($dateTime,1,4)" />
<xsl:variable name="month-temp" select="substring-after($dateTime,'-')" />
<xsl:variable name="month" select="substring-before($month-temp,'-')" />
<xsl:variable name="day-temp" select="substring-after($month-temp,'-')" />
<xsl:variable name="day" select="substring($day-temp,1,2)" />
<xsl:variable name="time" select="substring-after($dateTime,'T')" />
<xsl:variable name="hh" select="substring($time,1,2)" />
<xsl:variable name="mm" select="substring($time,4,2)" />
<xsl:variable name="ss" select="substring($time,7,2)" />

<xsl:value-of select="concat($month,'/',$day,'/',$year,' ',$hh,':',$mm,':',$ss)" /> 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-04-05T22:25:20.963

谢谢，这篇文章帮助很大。

我正在转换使用以下日期格式的 RSS 提要：**Mon, 04 Apr 2011 23:18:00 -0700**。这是我用来解析它的命名模板。

```
<!--Parse date format: Mon, 04 Apr 2011 23:18:00 -0700-->
<xsl:template name="formatDate">

    <xsl:param name="dateIn" />

    <xsl:variable name="day" select="substring($dateIn, 0, 3)" />
    <xsl:variable name="date" select="substring($dateIn, 6, 2)" />
    <xsl:variable name="month" select="substring($dateIn, 9, 3)" />
    <xsl:variable name="year" select="substring($dateIn, 13, 4)" />

    <xsl:variable name="hour" select="substring($dateIn, 18, 2)" />
    <xsl:variable name="min" select="substring($dateIn, 21, 2)" />
    <xsl:variable name="sec" select="substring($dateIn, 24, 2)" />

    <xsl:value-of select="concat($date, ' ', $month, ' ', $year, ' ', $hour, ':', $min, ':', $sec)" />

</xsl:template> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-04-01T10:12:12.113

```
<xsl:template match="date">
     <xsl:copy>
         <xsl:call-template name="formatdate">
             <xsl:with-param name="DateTimeStr" select="."/>
        </xsl:call-template>
     </xsl:copy>
  </xsl:template>

  <xsl:template name="formatdate">
     <xsl:param name="DateTimeStr" />

     <!-- input format xslt datetime string -->
     <!-- output format mm/dd/yyyy -->

     <xsl:variable name="datestr">
         <xsl:value-of select="substring-before($DateTimeStr,'T')" />
     </xsl:variable>

     <xsl:variable name="mm">
         <xsl:value-of select="substring($datestr,6,2)" />
     </xsl:variable>

     <xsl:variable name="dd">
        <xsl:value-of select="substring($datestr,9,2)" />
     </xsl:variable>

     <xsl:variable name="yyyy">
        <xsl:value-of select="substring($datestr,1,4)" />
     </xsl:variable>

     <xsl:value-of select="concat($mm,'/', $dd, '/', $yyyy)" />
  </xsl:template> 
```

这对我有用。您可以在以下位置查看其他选项：

[https://blog.fpmurphy.com/2008/05/xslt-datetime-formatting.html](https://blog.fpmurphy.com/2008/05/xslt-datetime-formatting.html)

# c# - 检查字符串是否包含（字符串）列表中的元素

> ID：500925
> 
> 赞同：184
> 
> 时间：2009-02-01T14:37:50.417
> 
> 标签：c#, vb.net, list, coding-style, performance

对于以下代码块：

```
For I = 0 To listOfStrings.Count - 1
    If myString.Contains(lstOfStrings.Item(I)) Then
        Return True
    End If
Next
Return False 
```

输出是：

**情况1：**

```
myString: C:\Files\myfile.doc
listOfString: C:\Files\, C:\Files2\
Result: True 
```

**案例二：**

```
myString: C:\Files3\myfile.doc
listOfString: C:\Files\, C:\Files2\
Result: False 
```

列表 (listOfStrings) 可能包含多个项目（最少 20 个），并且必须针对数千个字符串（如 myString）进行检查。

有没有更好（更有效）的方法来编写这段代码？

* * *

## 回答 #1

> 赞同：427
> 
> 时间：2009-02-01T14:44:43.027

使用 LINQ，并使用 C#（这些天我不太了解 VB）：

```
bool b = listOfStrings.Any(s=>myString.Contains(s)); 
```

或（更短、更高效，但可以说不太清楚）：

```
bool b = listOfStrings.Any(myString.Contains); 
```

如果您正在测试相等性，则值得一看`HashSet`等，但这对部分匹配没有帮助，除非您将其拆分为片段并添加复杂性顺序。

* * *

更新：如果您的意思是“StartsWith”，那么您可以对列表进行排序并将其放入数组中；然后用于`Array.BinarySearch`查找每个项目 - 通过查找检查它是完全匹配还是部分匹配。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2014-12-19T08:47:19.303

当你构造你的字符串时，它应该是这样的

```
bool inact = new string[] { "SUSPENDARE", "DIZOLVARE" }.Any(s=>stare.Contains(s)); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-01T14:44:46.957

较早的类似问题“[针对大量可比对象测试现有字符串的最佳方法](https://stackoverflow.com/questions/498224/best-way-to-test-for-existing-string-against-a-large-list-of-comparables)”提供了许多建议。

正则表达式可能足以满足您的要求。该表达式将是所有候​​选子字符串的串联，`|`它们之间有一个 OR " " 运算符。当然，您必须在构建表达式时注意未转义的字符，或者由于复杂性或大小限制而无法编译它。

另一种方法是构建一个[trie 数据结构](http://en.wikipedia.org/wiki/Trie)来表示所有候选子字符串（这可能与正则表达式匹配器正在做的有些重复）。当您逐步遍历测试字符串中的每个字符时，您将创建一个指向树根的新指针，并将现有指针推进到适当的子节点（如果有）。当任何指针到达叶子时，您会得到匹配。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-05-01T16:40:52.070

我喜欢 Marc 的回答，但需要包含匹配为 CaSe InSensiTiVe。

这是解决方案：

```
bool b = listOfStrings.Any(s => myString.IndexOf(s, StringComparison.OrdinalIgnoreCase) >= 0)) 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2019-07-11T17:44:18.383

老问题。但既然`VB.NET`是最初的要求。使用已接受答案的相同值：

```
listOfStrings.Any(Function(s) myString.Contains(s)) 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-01T14:46:48.123

根据您的模式，一项改进是更改为使用 StartsWith 而不是包含。StartsWith 只需要遍历每个字符串，直到找到第一个不匹配项，而不必在找到一个字符时在每个字符位置重新开始搜索。

此外，根据您的模式，您似乎可以提取 myString 路径的第一部分，然后反转比较 - 在​​字符串列表中查找 myString 的起始路径，而不是相反。

```
string[] pathComponents = myString.Split( Path.DirectorySeparatorChar );
string startPath = pathComponents[0] + Path.DirectorySeparatorChar;

return listOfStrings.Contains( startPath ); 
```

**编辑**：使用@Marc Gravell提到的HashSet想法会更快，因为您可以更改`Contains`为`ContainsKey`并且查找将是O（1）而不是O（N）。您必须确保路径完全匹配。请注意，这不是@Marc Gravell 的通用解决方案，而是针对您的示例量身定制的。

对不起 C# 示例。我没有足够的咖啡来翻译成 VB。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-01T20:50:28.433

你测试过速度吗？

即您是否创建了一组样本数据并对其进行了分析？它可能没有你想象的那么糟糕。

这也可能是您可以在单独的线程中生成的东西，并给人一种速度的错觉！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-04-25T08:15:38.140

```
myList.Any(myString.Contains); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2018-11-05T15:16:59.603

方法的缺点`Contains`是它不允许指定比较类型，这在比较字符串时通常很重要。它始终区分文化和区分大小写。所以我认为 WhoIsRich 的答案很有价值，我只想展示一个更简单的替代方案：

```
listOfStrings.Any(s => s.Equals(myString, StringComparison.OrdinalIgnoreCase)) 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2020-10-15T12:26:29.267

因为我需要检查（长）字符串中是否有列表中的项目，所以我最终得到了这个：

```
listOfStrings.Any(x => myString.ToUpper().Contains(x.ToUpper())); 
```

或在 vb.net 中：

```
listOfStrings.Any(Function(x) myString.ToUpper().Contains(x.ToUpper())) 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-01T14:58:31.030

如果速度很关键，您可能需要寻找模式集的[Aho-Corasick 算法](http://en.wikipedia.org/wiki/Aho-Corasick_algorithm)。

这是一个带有失败链接的[trie](http://en.wikipedia.org/wiki/Trie)，即复杂度为 O(n+m+k)，其中 n 是输入文本的长度，m 是模式的累积长度，k 是匹配的数量。您只需修改算法以在找到第一个匹配项后终止。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-05-18T20:43:44.930

略有不同，我需要找出字符串中是否有整个单词和不区分大小写。

```
myString.Split(' ', StringSplitOptions.RemoveEmptyEntries).Intersect(listOfStrings).Any()) 
```

不区分大小写`myString`并`listOfStrings`已转换为大写。

# iphone - UINavigationController 仅在第一个 XIB 中。苹果的 EditbleDetailView

> ID：500926
> 
> 赞同：0
> 
> 时间：2009-02-01T14:38:39.323
> 
> 标签：iphone, cocoa-touch

因此，在我们的 appDelegate 中，我们都习惯于创建一个 uinavigationcontroller 出口并将其链接到 XIB 中的一个 uinavigationcontroller。

但是在随后的视图控制器中，我只能通过访问 uinavigationcontroller 以编程方式添加 uibarbuttonitems。有没有办法在其他 uiviewcontroller 的 XIBS 中向应用程序 uinavigationcontroller 添加按钮？

苹果似乎在这个例子中做到了：http: ~~[//developer.apple.com/iphone/library/samplecode/EditableDetailView/index.html](http://developer.apple.com/iphone/library/samplecode/EditableDetailView/index.html)~~

之前在苹果的论坛中也提出过同样的问题，但仍未得到解答。：~~[http ://discussions.apple.com/thread.jspa?messageID=8917480#8917480](http://discussions.apple.com/thread.jspa?messageID=8917480#8917480)~~

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-02T18:25:17.620

您是否尝试过将导航栏拖到视图控制器的 NIB 中的视图？这将创建一个带有导航项的导航栏。然后，您可以在文件所有者（其类应设置为您的视图控制器类）中的 navigationItem 出口与位于导航栏“下方”的导航项之间创建连接。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-01T08:23:53.767

如果你调用 [self.navigationController presentModalViewController:YourViewControllerObject animated:YES];

那么你只会得到一个，但如果你推送 viewController，你会得到两个。所以要么隐藏根导航控制器的 NavigationBar，要么使用 presentModalViewController。

# python - 使用 web.py 作为非阻塞 http-server

> ID：500935
> 
> 赞同：17
> 
> 时间：2009-02-01T14:47:24.017
> 
> 标签：python, multithreading, web-services, web.py

在使用 python 学习一些基本编程时，我发现了 web.py。我遇到了一个愚蠢的问题：

我写了一个简单的控制台应用程序，它有一个主循环，它在单独的线程中处理队列中的项目。我的目标是使用 web.py 将项目添加到我的队列并通过 Web 请求报告队列的状态。我把它作为一个模块运行，但不能将它集成到我的主应用程序中。我的问题是当我使用 app.run() 启动 http 服务器时，它会阻塞我的主循环。还尝试使用 thread.start_new_thread 启动它，但它仍然阻塞。有没有一种简单的方法可以在我的应用程序的后台运行 web.py 的集成 http 服务器。

万一我是一个基本误解的受害者，任何试图澄清我的推理错误都会有所帮助;.)（请耐心等待，我是一个初学者:-)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2010-10-16T16:42:00.990

我找到了一个可行的解决方案。在一个单独的模块中，我创建了我的网络服务器：

```
import web
import threading
class MyWebserver(threading.Thread):

    def run (self):
        urls = ('/', 'MyWebserver')
        app = web.application(urls, globals())
        app.run()

    def POST ... 
```

在主程序中我只是调用

```
MyWebserver().start() 
```

而不是在让网络服务器在后台工作时继续我想要的任何东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T21:01:21.173

将您的主循环代码重写为您一遍又一遍地调用的函数，然后从您传递给的函数中调用它不是更简单`runsimple`...

保证不能完全满足您的要求，但如果您赶时间，这可能是最简单的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-12-09T07:39:09.927

或者只是使用 Tornado，一个用于 Python 的非阻塞网络服务器，其 API 类似于 webpy - [http://www.tornadoweb.org/](http://www.tornadoweb.org/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-12-07T23:39:22.653

我最近还使用[Beanstalkd](http://kr.github.com/beanstalkd/)对将在单独线程中运行的任务进行排队。您的 web.py 处理程序只是将一个作业放入管道中，然后由一个完全独立的脚本执行它。您可以拥有任意数量的这些，并且您可以获得高级队列控制等的好处。

# .net - 从 .net 中的现有基础对象创建派生对象

> ID：500936
> 
> 赞同：4
> 
> 时间：2009-02-01T14:47:39.663
> 
> 标签：.net

愚蠢的问题。

假设我有一堆 person 对象，他们的字段都填充了数据，我有一个派生自 person 类的员工类型，并且有与成为员工相关的额外字段。如何获取特定现有人员对象的员工对象？即我如何将人员对象传递给员工？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-01T14:57:43.467

如果此人是作为员工创建的，则只需转换：

```
Person person = new Employee(); // for some reason
...
Employee emp = (Employee)person; 
```

如果这个人只是一个人：你不能；您可以让员工*封装*Person - 或者您可以*复制*字段：

```
class Employee { // encapsulation
  private readonly Person person;
  public Person {get {return person;}}
  public Employee(Person person) {this.person = person;}
  public Employee() : this(new Person()) {}
} 
```

或者

```
class Employee : Person { // inheritance
  public Employee(Person person) : base(person) {}
  public Employee() {}
}
class Person {
    public Person(Person template) {
        this.Name = template.Name; // etc
    }
    public Person() {}
} 
```

# html - 表在 IE 中显示与 Opera 不同

> ID：500939
> 
> 赞同：0
> 
> 时间：2009-02-01T14:48:57.073
> 
> 标签：html, internet-explorer, html-table, opera

我有一张表，上面有这样的代码：

```
<table cellpadding="6" rules="groups"  frame="no">
<thead>
<tr><th>Date</th><th>Length</th><th>Time</th></tr>
</thead>

<tbody>
<tr><td>31\. January1</td><td>28 km</td><td>3 hours</tr> 
</tbody></table> 
```

问题是在 IE 中表格有框架和表格边框 = 1。怎么办？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-01T15:11:24.983

我希望它看起来像这样：

[![替代文字](https://i.stack.imgur.com/GCGSh.jpg)](https://i.stack.imgur.com/GCGSh.jpg)

当我使用`border="0"`IE 时，不要显示黑线。如果我写`<th style="1p solid black>Text</th>`，我会在表头周围看到一个黑盒子。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T15:20:33.623

试试这个：

```
<!DOCTYPE html>
<html>
<head>
    <title>Example:Table with Header Underline Border</title>
    <style type="text/css">
        table.groups
        {
            border-collapse: collapse;
        }

        table.groups thead th
        {
            border-bottom: solid 1px black;
        }

        table.groups th,
        table.groups td
        {
            padding: 6px;
        }
    </style>
</head>
<body>
    <table class="groups">
        <thead>
            <tr><th>Date</th><th>Length</th><th>Time</th></tr>
        </thead>
        <tbody>
            <tr><td>31\. January1</td><td>28 km</td><td>3 hours</td></tr>
        </tbody>
    </table>
</body>
</html> 
```

需要注意的几个具体事项：

*   使用 DOCTYPE 来防止怪癖模式。
    （这是 HTML5 DOCTYPE - 有些人更喜欢罗嗦的 XHTML 或 HTML4 Strict - 这些也可以）
*   标签上没有不必要的属性 - 全部由标签名称和类控制。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T14:50:58.457

```
border="0" 
```

但是，您应该使用样式表来代替这样的事情......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-01T14:55:43.487

采用

style="border:1px 纯黑色"

然后在表格标签中。

哦，最后一个单元格缺少一个结尾。

# svn - 使用颠覆构建提交

> ID：500944
> 
> 赞同：4
> 
> 时间：2009-02-01T14:51:47.643
> 
> 标签：svn, msbuild, build, commit

简单的问题。我使用 Visual Studio 并且我刚刚安装了颠覆，我如何强制使用 msbuild 构建项目，如果成功构建提交它会警告用户。我会使用 TortoiseSVN 或 VisualSVN 或 AnkhSVN（不管它叫什么），如果他们有能力强制构建提交内置（我知道这不是他们的用法，我知道它们只是用作提交 SVN 的 GUI）我想知道是否可以使用这些工具中的任何一个来做这些额外的事情。

总结一下，我只是在寻找一种在提交颠覆之前构建的无痛方式。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-01T16:08:30.000

看看 TeamCity 的[“预测试提交”又名“延迟提交”又名“私有构建”功能](http://www.jetbrains.com/teamcity/delayed_commit.html)。

简而言之，您“提交”到 TeamCity，TeamCity 验证您的构建并仅在构建通过时提交到真实存储库。如果没有，你会被告知。这里的好处是你的后备箱**永远不会**被打破。你可以去这里阅读更多关于它的信息[https://confluence.jetbrains.com/display/TCDL/Pre-Tested+(Delayed)+Commit](https://confluence.jetbrains.com/display/TCDL/Pre-Tested+(Delayed)+Commit)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-01T14:58:40.593

TortoiseSVN 有你可以使用[的客户端钩子脚本。](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-settings.html#tsvn-dug-settings-hooks)例如，您可以编写一个执行构建的脚本，并且仅在构建成功时才返回 true。然后将该脚本添加为预提交挂钩。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-01T15:06:18.613

您还可以使用 CruiseControl、Hudson 或其他持续集成工具。

这些可以在后台运行，观察变化然后构建。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-01T15:07:04.727

Stefan 建议的方法似乎最适合您。

但是，根据您尝试获得的结果，另一种选择可能是使用某种自动持续集成运行，因此每次提交时都会运行构建/测试，然后如果出现问题，它可能会引发警报或其他什么。由于您使用 Visual Studio 猜测您使用 .NET，因此[CruiseControl](http://en.wikipedia.org/wiki/CruiseControl.NET)可能值得一看。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-15T19:18:35.297

好吧，如果您不愿意为特殊工具付费，您也可以[教育您的同事......](http://blogs.msdn.com/larryosterman/archive/2005/12/08/501613.aspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-15T17:18:13.603

我认为[这](http://sin.tigris.org/)可能对您有用，因为您使用的是 SVN。

总而言之，您所要求的就像 mausch 建议的那样，一个 CI 服务器。在这种情况下，TeamCity 符合要求。

但也许您不需要 CI 服务器附带的所有花里胡哨。那么 SIN 可能对你有用。[有时间就去](http://sin.tigris.org/Sin%20-%20Continuous%20Integration%20Rethought.html)看看吧！

# asp.net - 无法启动 ASP.NET 开发服务器，因为端口“1900”正在使用中

> ID：500957
> 
> 赞同：29
> 
> 时间：2009-02-01T15:02:34.347
> 
> 标签：asp.net, visual-studio, configuration, asp.net-development-serv, web-development-server

我在 VS 2008 中开发得很好，并在我的开发服务器上测试了我的 ASP.NET 网站，但突然我无法再运行我的网站了。我一按 F5，就会出现以下消息：

> 无法启动 ASP.NET 开发服务器，因为端口“1900”正在使用中。

我更改为哪个端口都没有关系，它始终在使用中。我努力了：

*   更改端口号
*   重新启动 Visual Studio
*   重新启动我的机器
*   安装 IIS

线索：我的 IIS 拒绝启动。但是当我早先愉快地工作时，我没有安装 IIS，所以这可能不是问题；它可能只是在强调其他东西。

* * *

更新：重新启动后，IIS 确实启动了，但这里的问题仍然存在。

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2012-09-11T12:30:58.530

**只需结束所有 Webdev.WebServer.exe 进程**- 对我有用。当 Visual Studio 进程之一 (webdev.webserver.exe) 仍在运行并锁定时，有时会发生此“由于端口正在使用而无法启动”错误。当您关闭浏览器或应用程序时，webdev.webserver 进程应该结束，但如果它们没有（例如我的 Visual Studio 崩溃但如果网络服务器仍在运行），那么这可能会锁定端口，这将阻止 Visual Studio 启动你的项目。当您尝试 F5 您的应用程序（从 Visual Studio 启动您的应用程序）时，它会与当前使用的端口冲突，并且会显示上面的“*因为端口 XYZ 正在使用*”错误。

所以要修复它：在状态栏中（在您的 Windows 时钟旁边）右键单击并“停止”所有 ASP.net 开发服务器图标。您还可以打开任务管理器并杀死所有 webdev.webserver.exe 进程。

![在此处输入图像描述](https://i.stack.imgur.com/KdvBg.png)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-01T15:15:08.253

`netstat -o`您可以通过从命令提示符运行来检查给定端口上正在运行的软件。它将给出进程的进程 ID (PID)。我在安装 Skype 后发生了这种情况，在 IIS 之前绑定到端口 80。

您还可以检查*事件日志*以获取 IIS 无法启动的消息。它可能会提供足够的信息来解决问题或在谷歌上搜索它。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-07-05T12:27:08.700

问题已解决，我将 NOD32 防火墙配置为不再像浏览器一样看到 VS。

设置>防病毒和反间谍>Internet 保护>HTTP

只需取消选中vs，问题就会解决。

我希望这最终会有所帮助。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-01T15:13:52.920

右键单击任务栏中运行的小“服务器页面”，然后单击关闭。这通常发生在 DEBUG 进程意外终止或 Visual Studio 崩溃时。尝试一个非常高的端口，例如 50000，看看它是否有效。不应该有任何进程使用该端口。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2020-03-07T19:01:46.557

在VS 2019中，右键单击项目属性选择Debug，向下滚动到Web服务器设置，在AppURL中更改端口号 [![在此处输入图像描述](https://i.stack.imgur.com/Sm0fO.png)](https://i.stack.imgur.com/Sm0fO.png)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-10-07T16:33:33.880

很长一段时间我都有同样的问题。我检查了这里写的所有想法。最终，唯一对我有用的是：

1.  通过右键单击项目来卸载它。
2.  通过右键单击卸载的项目打开 .csproj 文件
3.  重新加载项目（不做任何更改）

有时它可以解决问题...

但是，我也有一个解决方法：

1.  打开您的 Visual Studio 2008 命令提示符（开始 -> Microsoft Visual Studio 2008 -> Visual Studio 工具 -> 命令提示符）。
2.  类型：`webdev.webserver.exe /port:[your_port] /path:"[your_path]"`
    *your_port*是服务器所需的端口，*your_path*是 VS 存储源文件的路径。请注意，您只需粘贴*.asmx*文件所在的目录。
3.  这应该手动运行服务器并监听指定的端口。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-05-20T00:21:34.430

我找到了一个不需要重新启动的解决方案（适用于 Windows 7）。

在时钟旁边，有一个图标托盘，如果您单击旗帜旁边的三角形图标，则可以访问该托盘。寻找带有工具提示“ASP.net development server - port ###”的图标。右键单击并选择“停止”！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-01T15:57:05.687

当发生这种类型的事情时，我过去尝试过的一件事是远程登录到端口并执行 GET 或 HEAD：

```
telnet localhost 1900 
```

然后输入 HEAD 并按回车键。有时返回的数据会显示服务器名称或应用程序名称之类的内容。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-07-03T19:38:33.640

对于网络表单站点：

1.  从解决方案中删除项目。
2.  编辑 %userprofile%\Documents\IISExpress\config\applicationhost.config 并删除问题端口的部分。
3.  将项目添加回解决方案。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-11-09T11:57:03.900

只需检查侧边栏中运行的两个 vs2008 实例.. :)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-01T15:20:41.487

设置 Cassini（Visual Studio 的轻量级内置 Web 服务器）使用不同的端口。您可以在项目的配置对话框中执行此操作

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-02-02T21:11:34.000

我遇到过同样的问题。问题是我还配置了 IIS 以使用这些端口。停止 IIS 或更改解决方案中使用的端口是可能的解决方案。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-06-18T19:02:03.740

请注意——我在端口 8000 上遇到了这个错误，事实证明我仍然在运行 Aptana Studio——它显然在端口 8000 上运行了一个 java 服务器。退出 Aptana 并且一切正常。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-02-02T10:43:14.140

我只是停止了服务 MsDepSvc - Web 部署代理服务。然后我就可以运行该站点了。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2010-03-24T00:58:06.963

我今天遇到了同样的问题并找到了解决方案，所以我想我会加两分钱：

我的特殊问题是，即使开发服务器显然正在运行并且我能够在其上使用应用程序，我也会收到“正在使用的端口”错误消息。据了解，当时我正在开发一个 Web 服务，并且碰巧打开了设计视图 - 没有意识到。正是这个 Web 服务的设计视图试图启动开发服务器——这就是为什么我不能输入单个字符的代码而不得到错误。

**关闭您的 Web 服务的设计视图...问题已解决。**

我真诚地希望有一天这也对其他人有所帮助。

干杯

伊恩

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-07-22T12:07:59.717

我有同样的问题，“无法启动 asp.net 开发服务器” 原因是病毒程序...我禁用了它，它可以正常工作...

我希望这有帮助...

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2015-06-14T07:15:49.290

更改 IIS express 部分的 Visual Studio (Web) 项目属性中的端口为我解决了同样的问题

![Visual Studio Project Properties for IIS express port in use 问题](https://i.stack.imgur.com/GKWQ6.png)

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2019-08-14T10:20:21.247

只需重新启动系统，问题就会得到解决。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2017-07-03T17:53:50.107

在项目的网站部分，右键单击并执行“属性窗口”而*不是*“属性页面”将“使用动态端口”更改为 TRUE。如果它是列出的端口，您可以将 80 保留在那里——关键是使用动态端口。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2021-12-16T09:22:24.690

我面临同样的问题。但是当我删除所有窗口临时文件时，这对我有用。键盘输入：1 - 窗口键 + r（打开运行窗口）然后在运行窗口中输入“temp”，然后删除所有文件。
2 - 在窗口运行中键入“%temp%”并删除所有文件。

上述步骤按问题解决。

# gdb - GDB 断点

> ID：500967
> 
> 赞同：37
> 
> 时间：2009-02-01T15:10:23.487
> 
> 标签：gdb, breakpoints

我有一个断点列表，每次调试特定程序时都想添加这些断点。

有没有办法可以将所有断点信息放在一个文件中并在每个调试会话开始时使用它？换句话说，我**可以在给出“运行”命令之前向 GDB 提供一个带有断点信息的脚本文件吗？**

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-02-01T15:16:01.760

从**man gdb(1)**：

```
 -x file
           Execute GDB commands from file file. 
```

然后，您可以将断点放在一个文件中：

```
break [file:]function
break [file:]function
... 
```

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-02-01T15:15:00.343

您可以将所需的所有命令放入`.gdbinit`与您正在调试的可执行文件位于同一目录中的文件中。

就像是：

```
b somefile.c:128
b otherfile.c:33 
```

应该工作得很好。

是的，`-x`命令行参数将允许您在 GDB 启动时执行任意文件，但是`.gdbinit`为每个项目维护一个文件意味着该文件是自动执行的（无需指定文件名）。此外，您可以轻松地将项目特定`.gdbinit`文件添加到源代码管理中，这意味着您的所有团队成员都可以使用相同的调试工具。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-02-01T15:20:19.850

除了使用外部文件，您还可以保持 GDB 处于打开状态：如果 GDB 下的二进制文件发生更改，它将在下次运行时重新加载二进制文件和库而不会丢失断点。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2010-10-21T03:57:16.183

自GDB 7.2 (2011-08-23) 起，*[保存断点](https://sourceware.org/gdb/onlinedocs/gdb/Save-Breakpoints.html)*命令是新的。将断点保存到文件后，您可以使用*[source](https://sourceware.org/gdb/onlinedocs/gdb/Command-Files.html)*命令将它们读入稍后的 GDB 会话，然后在下次运行 GDB 时使用该`-x <filename>`选项。

```
save breakpoints <filename>
  Save all current breakpoint definitions to a file suitable for use
  in a later debugging session.  To read the saved breakpoint
  definitions, use the `source' command. 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-01T15:22:25.350

或使用：

```
gdb --command=commands.gdb ./a.out 
```

`commands.gdb`带有断点的文本文件在哪里。

`--command`可能与`-x`

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-08-22T10:32:01.157

GDB 的文档声称可以使用命令“[保存断点](http://sourceware.org/gdb/current/onlinedocs/gdb/Save-Breakpoints.html#Save-Breakpoints)”和“[源](https://sourceware.org/gdb/onlinedocs/gdb/Command-Files.html)”。

但是，这不适用于我的 GDB（[Ubuntu 7.10](https://en.wikipedia.org/wiki/Ubuntu_version_history#Ubuntu_7.10_(Gutsy_Gibbon)) (Gutsy Gibbon)）。

# xml - 跳转到 Vim 中匹配的 XML 标签

> ID：500989
> 
> 赞同：143
> 
> 时间：2009-02-01T15:22:31.357
> 
> 标签：xml, vim

Vim`%`运算符跳转到匹配的括号、注释结尾和其他一些内容。但是，它不匹配 XML 标记（或任何其他标记，据我所知）。

使用 Vim 跳转到匹配的 XML 标签的最佳方式是什么？

**注意：** 我*真正*想做的是在 XML 文件中复制一个部分，而无需手动查找匹配的标签。

* * *

## 回答 #1

> 赞同：250
> 
> 时间：2012-06-04T12:41:17.307

您可以在没有其他插件的情况下执行此操作：

*   将光标放在标签上
*   `v``a``t`- 将选择（外部）标签并将光标放在末尾
*   一旦你有了你的选择，你可以在顶部和底部之间切换`o`（*更新基于迈克尔格鲁伯的笔记*）
*   `c`- 更改或，`y`- 复制或，退出视觉模式...

另一个有用的操作是：`v``i``t`- 将选择标签的内容（内部）。

**更新（感谢@elrado）**示例：`v``i``t``o`将使您能够选择标签的内部内容并将光标定位在所选文本的开头。

参考：[https ://superuser.com/questions/182355/how-can-i-select-an-html-tags-content-in-vim](https://superuser.com/questions/182355/how-can-i-select-an-html-tags-content-in-vim)

Vim 参考资料（感谢@Geek 指出这一点）：

```
:help visual-operators 
```

你会得到：

```
4\. Operating on the Visual area             *visual-operators*

The objects that can be used are:
    ...
    at  a <tag> </tag> block (with tags)        |v_at|
    it  inner <tag> </tag> block            |v_it|
    ... 
```

* * *

## 回答 #2

> 赞同：75
> 
> 时间：2009-02-01T15:31:34.367

有一个名为 matchit.vim 的 vim 插件。你可以在这里找到它：http: [//www.vim.org/scripts/script.php](http://www.vim.org/scripts/script.php?script_id=39) ?script_id=39 。它的创建几乎与您描述的确切目的相同。

安装它，将光标放在标签的主体上（不是 <>，否则它会匹配那些），然后按 % 跳转到另一个标签。查看脚本的页面以了解它匹配的其他内容。

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2011-10-31T07:12:37.457

OP 表示他真正想做的是复制一段 XML，而不必找到匹配的标签。这很容易在正常模式下使用 来完成`yat<motion>p`，它会拉出里面的文本并包括匹配的标签，然后粘贴它。 `yit<motion>p`几乎相同，但不包括外部标签。

字符串中的“y”当然是正常模式的“yank”命令。( `:help y`)

`a`或`i`可用于在操作符之后`y`或在视觉选择内部进行对象选择。`a`或之后的符号`i`指定应选择的内容。这里使用的对象类型`t`表示一个 SGML 标签。( `:help object-select`)。

当然`<motion>`只是意味着通过您选择的方式移动到某个地方`p`并将被拉出的文本放在那个位置。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2015-05-14T07:47:46.433

只是我使用“yank”、“object-select”（标签选择）和“跳转到最后一个被拉出的文本”的技巧。

```
yit`] 
```

在结束标签之前跳到右边

和

```
yit 
```

打开标签后跳到右边

注意：这会改变默认寄存器的内容

# c - strpbrk 代表什么？

> ID：500994
> 
> 赞同：30
> 
> 时间：2009-02-01T15:27:05.543
> 
> 标签：c

我[`strpbrk()`](http://linux.die.net/man/3/strpbrk)在 C 中做低级字符串工作时偶尔使用过，但我一直无法弄清楚它代表什么。我一直在脑海中将它发音为“stir p bark”，但这从来都不是正确的。

它没有任何其他字符串函数那样明显的词源，例如( `strchr`string **ch** **a** r **acter** )或`strspn`( **string** **sp** a **n** )。

我隐约记得在某处读过所有原始标准库函数都限制为 7 个字符的名称，或者是为了与 Fortran 保持兼容，或者因为在原始 C 标准中，超过 7 个字符的标识符被认为等同于它们的 7 个字符前缀或某物。任何人都可以确认/否认/澄清这一点吗？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-02-01T15:34:43.347

以下对话建议“字符串指针中断”： [http ://www.cpptalk.net/what-strspn-and-strpbrk-stands-for--vt1253.html](http://www.cpptalk.net/what-strspn-and-strpbrk-stands-for--vt1253.html)

确实，Microsoft 文档案例是 StrPBrk，并且倾向于确认这种拆分：http: [//msdn.microsoft.com/en-us/library/bb760010 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/bb760010(VS.85).aspx)

最后这证实了这一点： [http ://www.gnu.org/software/libtool/manual/libc/Search-Functions.html](http://www.gnu.org/software/libtool/manual/libc/Search-Functions.html)

> strpbrk（“字符串指针中断”）函数与 strcspn 相关，不同之处在于它返回指向字符串中第一个字符的指针，该字符是集合停止集的成员，而不是初始子字符串的长度。如果未找到 stopset 中的此类字符，则返回空指针。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-02-01T15:35:37.617

[来自 GNU C 库文档](http://www.gnu.org/software/libtool/manual/libc/Search-Functions.html#Search-Functions)：

> 函数：char * strpbrk (const char *string, const char *stopset)
> 
> strpbrk ("string pointer break") 函数与 strcspn 相关，不同之处在于它返回指向 string 中第一个字符的指针，该字符是 set stopset 的成员，而不是初始子字符串的长度。如果未找到 stopset 中的此类字符，则返回空指针。
> 
> 例如，
> 
> strpbrk ("hello, world", " \t\n,.;!?") => ", world"

该函数返回指向 STOPSET（又名 BREAKSET）中第一个字符的指针。我在心里把它读作“对于**STR** ing，将指针返回**到**BR **ea** K **”**。

 ***** * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-01T20:37:37.150

至于你的另一个问题：

> 我隐约记得在某处读过所有原始标准库函数都限制为 7 个字符的名称，或者是为了与 Fortran 保持兼容，或者因为在原始 C 标准中，超过 7 个字符的标识符被认为等同于它们的 7 个字符前缀或某物。任何人都可以确认/否认/澄清这一点吗？

最初的 ANSI C 标准说它是实现定义了外部符号的多少个字符是重要的，但它必须至少是 6 个字符（并且允许实现对它们的大小写不敏感）。这样做是因为早在很久以前，系统经常有这种类型的限制（无论是来自 FORTRAN 库、链接器限制还是其他）。

因此，虽然您会看到比标准库中更长的外部名称，但这些名称中没有两个以相同的 6 个字符序列开头。

FWIW，C99 将最小值增加到 31 个字符。C++ 标准（1998 年）表示，实现必须记录外部名称的重要性，并建议它至少为 1024 个字符。我知道 Borland C++ 5.5 有 250 个字符的限制，这会导致问题，特别是在使用模板时。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-01T15:29:42.513

我依稀记得 strpbrk 代表*String Pointer Break*，我不记得我在哪里看到的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-05-31T14:11:54.357

1972 年，贝尔实验室也出现了一种名为 Snobol 的编程语言，用于字符串操作。它有函数 break() 和 span()，它们的作用基本相同。大多数字符串函数都是根据 Snobol 中出现的东西建模的。查看 James F. Gimpel 博士撰写的简历和书籍

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-11-11T07:01:51.677

虽然每个人都只是引用他们没有解释为什么它是“STRing Pointer BreaK”的东西。当您从底层算法的角度考虑它时，您将能够轻松地记住它并理解为什么 strpbrk：

**如果找到指针处的任何字符，则在扫描 STRING BREAK 时。**

# random - 如何创建随机模拟？

> ID：500995
> 
> 赞同：3
> 
> 时间：2009-02-01T15:28:40.363
> 
> 标签：random, simulation, particles

我一直在玩[这个 Flash 游戏](http://www.kongregate.com/games/asagoPAN/chain-of-fire)，在我克服了最初的（“哈哈，开火”）反应后，我开始想知道如何在编程中复制这种接触变异行为。我想这有点像[蜜罐 xkcd](http://xkcd.com/350/)。

我正在考虑从粒子相互偏转和包含壁的场景开始。该序列将从一定数量的“突变体”粒子开始，当这些突变体与常规粒子碰撞时，它们本身就会变成突变体。我以后可以做一些更有趣的事情。

我的问题是如何开始。我计划使用 .NET 的绘图元素在 C# 中执行此操作（尽管我对 C# 相当陌生 - 如果 .NET 有不同的部分，我应该使用让我知道）但是如果有任何关于它的一般论文我有兴趣阅读它们（当然，如果它们可以在线获得）。

谢谢，罗斯

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-01T15:47:35.487

我认为你的想法是正确的，一个盒子里的一些[粒子](http://en.wikipedia.org/wiki/Particle_system)在这里会很好。我无法想象你会找到关于这样一个具体而简单的案例的论文，但也许是一些所需的技术，但与渲染器相比，后端的实现应该相对简单。

移动粒子的一个简单方法是[欧拉迭代](http://en.wikipedia.org/wiki/Euler%27s_method)，您可以在其中存储位置和速度。位置=位置+速度*dt；其中 dt 是自上一帧以来的时间变化。如果可以的话，最好保持 dt 固定，并在渲染器的点之间进行插值......这将减少稳定性问题并使碰撞检测更容易。

要将粒子反射出墙壁，请检查其位置的 x 分量或 y 分量是否会超出边界，然后翻转速度的其他分量的符号，例如

```
if(Math.Abs(position.x_component + velocity.x_component * dt) > x_bound) 
    velocity.y_component = -velocity.y_component;

if(Math.Abs(position.y_component + velocity.y_component * dt) > y_bound)
    velocity.x_component = -velocity.x_component; 
```

如果你有恒定的 dt，这很有效，但如果它变化，你将需要做一些更复杂的事情。找到与盒子的碰撞点，并将向量在盒子外面的部分[反射到被碰撞的面上。](http://www.gamedev.net/community/forums/topic.asp?topic_id=165537)

为了使粒子相互碰撞，最好进行距离检查，一旦距离太小就会触发反射。即，如果它们靠得太近，它们就会发生碰撞。像粒子是球体一样反射速度分量，因此反射的法线是它们的位置差。

您可能会发现[这篇](http://www.gamedev.net/reference/articles/article1234.asp)关于 gamedev 的文章也很有用...

希望这可以帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T15:56:24.893

为什么不以经典的 Asteroids 游戏为起点呢？这是一个不使用 DirectX 并且在 c# 中的链接

[http://www.codeproject.com/KB/GDI-plus/asteroids.aspx](http://www.codeproject.com/KB/GDI-plus/asteroids.aspx)*****``*******************