# StackOverflow 问答 000517000-000517999

# arrays - 如何在 PL/SQL 中打印 ARRAY 的每个元素？

> ID：517000
> 
> 赞同：4
> 
> 时间：2009-02-05T17:45:59.503
> 
> 标签：arrays, plsql

这是一个非常基本的问题，但这里有：

我在 PL/SQL 中有一个 VARCHAR2 字符串数组。

如何打印该数组中的每个元素？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-08T09:46:15.617

```
for i in my_array.first..my_array.last loop
  --print me
end loop; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2017-10-23T06:38:13.790

```
for i in my_array.first..my_array.last loop

  dbms_output.put_line(my_array(i).col1Name||'  ' ||  my_array(i).col2Name|| '  '  ||my_array(i).col3Name);

end loop; 
```

# c# - 如何在 WPF 组合框中隐藏所选项目？

> ID：517002
> 
> 赞同：2
> 
> 时间：2009-02-05T17:46:09.987
> 
> 标签：c#, wpf, combobox, selecteditem

我想从打开的 WPF 组合框中隐藏选定的项目，基本上是为了显示而不是这个：

```
item2
 item1
 item2
 item3 
```

这：

```
item2
 item1
 item3 
```

如何才能做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-06T11:32:49.663

为什么不更改所选项目的可见性呢？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-07T16:36:03.950

由于组合框的项目视图是从它包含的项目集合中自动生成的，因此
您需要做的是从组合框的项目中删除选定的项目并设置 IsEditable="True" 以便选择有效。
您可以在包含选择的组合框上方放置一个标签，以防止用户在组合框中键入。

另一种解决方案是使用 2 个组合框，一个包含所有项目，一个包含所有项目，但在第一个组合框中选择的项目。
然后阻止第一个组合框展开并将其放在第二个组合框上方。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T19:39:16.717

为此找到了一个技巧，在组合框顶部放置了一个标签：

Window1.xaml：

```
<Window x:Class="WpfApplication2.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="300" Width="300">
    <Grid>
        <ComboBox Height="23" Margin="53,42,105,0" Name="comboBox1" VerticalAlignment="Top"
                  SelectionChanged="comboBox1_SelectionChanged" DropDownOpened="comboBox1_DropDownOpened"
                  DropDownClosed="comboBox1_DropDownClosed" GotFocus="comboBox1_GotFocus"
                  LostFocus="comboBox1_LostFocus"/>
        <Label Height="23" Margin="53,42,105,0" Name="label1" VerticalAlignment="Top" IsHitTestVisible="False">
            almafa
        </Label>
        <Button Height="23" Margin="89,0,114,108" Name="button1" VerticalAlignment="Bottom">Button</Button>
    </Grid>
</Window> 
```

Window1.xaml.cs：

```
using System;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Media;

namespace WpfApplication2
{
    public partial class Window1 : Window
    {
        public Window1()
        {
            InitializeComponent();
            comboBox1.Items.Add("alma");
            comboBox1.Items.Add("korte");
            comboBox1.Items.Add("szilva");
        }

        private void comboBox1_SelectionChanged(object sender, SelectionChangedEventArgs e)
        {
            if (comboBox1.SelectedItem != null)
                comboBox1.SelectedItem = null;
        }

        private void comboBox1_DropDownOpened(object sender, EventArgs e)
        {
            label1.Foreground = Brushes.Black;
        }

        private void comboBox1_DropDownClosed(object sender, EventArgs e)
        {
            label1.Foreground = Brushes.White;
        }

        private void comboBox1_GotFocus(object sender, RoutedEventArgs e)
        {
            if (!comboBox1.IsDropDownOpen)
                label1.Foreground = Brushes.White;
        }

        private void comboBox1_LostFocus(object sender, RoutedEventArgs e)
        {
            label1.Foreground = Brushes.Black;
        }
    }
} 
```

# c++ - 矩阵实现基准，我应该鞭打自己吗？

> ID：517003
> 
> 赞同：1
> 
> 时间：2009-02-05T17:46:36.523
> 
> 标签：c++, matrix, benchmarking, multiplication, inversion

我正在尝试在线查找一些矩阵乘法/求逆基准。我的 C++ 实现目前可以在 38 秒内反转一个 100 x 100 矩阵，但与我发现的[这个](http://www.google.com/url?sa=t&source=web&ct=res&cd=3&url=http%3A%2F%2Fwww.bluebit.gr%2Fmatrix%2Fbenchmarks.htm&ei=QyWLSdHaNoz40QWsl4ihBw&usg=AFQjCNES3btcbbWo9HSXChrywHTMvZwuNA&sig2=fXBRffm_thJZidEUBXrbSQ)基准相比，我的实现的性能真的很糟糕。我不知道它是否是一个超级优化的东西，或者你是否真的可以在大约 0.11 秒内轻松地反转一个 200 x 200 矩阵，所以我正在寻找更多的基准来比较结果。大神有没有好的链接？

**更新** 我在我的乘法代码中发现了一个错误，它不会影响结果，但会导致无用的循环浪费。现在我的反转在 20 秒内执行。时间还很长，欢迎提出任何想法。

谢谢各位

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-05T18:16:46.290

这种操作对缓存非常敏感。您希望在 L1 和 L2 缓存中的变量上完成大部分工作。查看此文档的第 6 节：

[http://people.redhat.com/drepper/cpumemory.pdf](http://people.redhat.com/drepper/cpumemory.pdf)

他将引导您以缓存优化的方式优化矩阵乘法，并获得一些重大的性能改进。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-05T18:11:48.093

检查您是否按值传递巨大的矩阵对象（因为如果复制整个矩阵，这可能会很昂贵）。
如果可能通过引用传递。

关于矩阵和 C++ 的事情是您希望尽可能避免复制。
因此，您的主要对象可能不应该包含“矩阵数据”，而是包含有关矩阵的元数据和指向数据部分的指针（由 somthing smart 包装）。因此，当复制一个对象时，您只复制一小块数据而不是整个数据（参见字符串实现示例）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-05T18:16:24.497

为什么首先需要实现自己的矩阵库？正如您已经发现的那样，已经有非常高效的库可以做同样的事情。尽管人们喜欢将 C++ 视为一种性能语言，但只有当你*真的很*擅长这种语言时，这才是正确的。用 C++ 编写非常慢的代码非常容易。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T18:04:15.600

> 我不知道它是否是一个超级优化的东西，或者你是否真的可以在大约 0.11 秒内轻松地反转一个 200 x 200 矩阵

MATLAB 也毫不费力地做到了这一点。您是否正在执行矩阵求逆的[LAPACK](http://www.netlib.org/lapack/)例程（例如 LU 分解）？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-06T05:18:54.737

您是否尝试过对其进行分析？

根据[本文](http://numericalmethods.eng.usf.edu/simulations/nbm/04sle/nbm_sle_sim_inversecomptime.pdf)(pdf)，使用 LU 分解计算 100x100 矩阵将需要 1348250（浮点运算）。核心 2 可以执行大约 20 Gflops（[处理器指标](http://www.intel.com/support/processors/sb/cs-023143.htm)）。所以从理论上讲，你可以在 1 毫秒内进行反转。

如果没有代码，很难断言造成巨大差距的原因是什么。根据我尝试循环展开、缓存值、SEE、线程等微优化的经验，你只会得到加速，这充其量只是你当前的一个恒定因素（这对你来说可能已经足够了）。

但是如果你想要一个数量级的速度增加你应该看看你的算法，也许你的 LU 分解的实现有一个错误。另一个要看的地方是数据的组织，尝试不同的组织，将行/列元素放在一起。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-05T17:51:24.033

[LINPACK](http://en.wikipedia.org/wiki/LINPACK)基准测试基于解决线性代数问题。它们可用于不同的机器和[语言](http://www.jeckle.de/freeStuff/jLinpack/index.html)。也许他们也可以帮助你。

LINPACK C++ 库[在这里](http://people.sc.fsu.edu/~burkardt/cpp_src/linpack/linpack.html)也可用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-05T18:02:02.513

`double`实际上，我使用 ** **s 而不是 ** **s获得了大约 7 秒的时间`long double`，但这并不是很多，因为我失去了一半的精度。

# parsing - ANTLR 是序列化/反序列化二进制数据格式的合适工具吗？

> ID：517004
> 
> 赞同：10
> 
> 时间：2009-02-05T17:47:07.427
> 
> 标签：parsing, antlr, generator, ebnf, ragel

我需要读取和写入八位字节流以通过各种网络发送以与智能电表通信。有一个 ANSI 标准 ANSI C12.19 描述了二进制数据格式。虽然数据格式并不太复杂，但该标准非常庞大（500 多页），因为它描述了许多不同的类型。该标准完全由 EBNF 语法描述。我正在考虑使用 ANTLR 来读取 EBNF 语法或其修改版本，并创建可以读取和写入八位字节流的 C# 类。

这是对ANTLR的好用吗？

如果是这样，我需要做什么才能使用 ANTLR 3.1？通过搜索新闻组档案，我似乎需要实现一个可以读取字节而不是字符的新流。这就是全部还是我还必须实现 Lexer 衍生产品？

如果 ANTLR 可以帮助我读取/解析流，它也可以帮助我编写流吗？

谢谢。

丹芬卡内

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-11T15:44:47.810

你可以看看[Ragel](http://www.complang.org/ragel/)。它是一个状态机编译器/词法分析器，可用于实现在线协议。我读过报告说它生成非常快的代码。如果您不需要解析器和模板引擎，那么 ragel 的开销比 ANTLR 少。如果您需要成熟的解析器、AST 和良好的模板引擎支持，ANTLR 可能是更好的选择。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-05T18:03:22.853

这个主题不时出现在 ANTLR 邮件列表中。答案通常是否定的，因为二进制文件格式非常规则，不值得开销。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-05T17:54:17.380

在我看来，掌握语法会让你大有帮助。

ANTLR 3.1 具有与解析/词法分析分开的 StringTemplate 和代码生成功能，因此您可以通过这种方式分解问题。

对我来说似乎是一个赢家，值得一试。

# vba - 是否需要将 Objects 设置为 Nothing

> ID：517006
> 
> 赞同：75
> 
> 时间：2009-02-05T17:47:44.697
> 
> 标签：vba, vbscript, vb6

我总是读到，一旦我完成它们，建议将对象设置为空。但我通常只在表单内的函数中使用它们。

离开函数作用域时，无论将对象设置为Nothing，引用是否都会丢失并释放内存？

即真的有必要这样做：

```
Set db = Nothing
Set record_set = Nothing 
```

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2009-02-05T18:22:31.023

VB 使用所谓的“引用计数”垃圾收集器。

基本上，一旦变量超出范围，被引用对象上的引用计数器就会递减。当您将对象引用分配给另一个变量时，引用计数器会增加。

当计数器达到零时，对象已准备好进行垃圾回收。一旦发生这种情况，对象资源将被释放。函数局部变量很可能会引用一个引用计数从不高于 1 的对象，因此函数结束时将释放对象资源。

将变量设置为`Nothing`显式减少引用计数器的方法。

例如，您读入一个文件，并`Nothing`在调用后立即将文件对象变量设置为`ReadAll()`。文件句柄将立即释放，您可以慢慢处理其内容。

如果您未设置为`Nothing`，则文件句柄的打开时间可能会超过绝对必要的时间。

如果您不是处于“必须解除对有价值资源的阻塞”的情况，只需让变量超出范围即可。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-02-05T18:16:42.920

垃圾收集很少是完美的。即使在 .NET 中，有时也强烈建议您提示系统尽早进行垃圾收集。

出于这个原因，当我完成它们时，我明确地**关闭**并设置为**Nothing记录集。**

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-02-05T23:39:35.813

Microsoft DAO 帮助和 Access 开发人员参考中的“ [Recordset.Close](http://msdn.microsoft.com/en-us/library/bb243098.aspx) ”帮助主题的最后一行是这样的：

> “Close 方法的替代方法是将对象变量的值设置为 Nothing（Set dbsTemp = Nothing）。”

[http://msdn.microsoft.com/en-us/library/bb243098.aspx](http://msdn.microsoft.com/en-us/library/bb243098.aspx)

考虑到这一点，Microsoft 知识库中的这篇题为“如何在使用数据访问对象 (DAO) 后防止数据库膨胀”的文章告诉您，如果您不希望数据库膨胀，您应该明确关闭[。](http://support.microsoft.com/kb/289562)你会注意到这篇文章对细节有点含糊；“原因”部分不清楚，几乎到了胡言乱语的地步。

[http://support.microsoft.com/kb/289562](http://support.microsoft.com/kb/289562)

> 症状：在您实施数据访问对象 (DAO) 以打开记录集后，Microsoft Access 数据库开始膨胀（或大小迅速增长）。
> 
> 原因：如果每次循环记录集代码时不释放记录集的内存，DAO 可能会重新编译，使用更多内存并增加数据库的大小。
> 
> 更多信息： 当您在代码中创建 Recordset（或 QueryDef）对象时，完成后显式关闭该对象。Microsoft Access 在大多数情况下会自动关闭 Recordset 和 QueryDef 对象。但是，如果您在代码中显式关闭对象，则可以避免对象保持打开状态的偶发情况。

最后，让我补充一点，我使用 Access 数据库已经 15 年了，而且我几乎总是让本地声明的记录集变量超出范围，而没有显式使用 Close 方法。我没有对其进行任何测试，但这似乎并不重要。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2016-08-09T12:36:36.757

当您使用 ASP 经典（服务器端脚本）时，将所有对象设置为空是很重要的，因为它们在 [虚拟] 服务器关闭之前不会超出范围。

出于这个原因，所有 MS VB 脚本示例总是显示对象被关闭并设置为空。这样脚本摘录就可以在对象没有超出范围的 ASP 经典环境中使用。

在极少数情况下，您希望编写长时间运行的进程，其中对象不会超出范围，并且如果您不显式释放对象，您会发现自己的物理内存不足。

如果您发现自己在编写 ASP 经典代码，或者出于其他原因在全局范围内运行进程，那么是的，您应该显式释放对象。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-05T17:57:14.927

当变量超出范围时，应该清理引用。据推测，该软件的更高版本已对此进行了改进，但有时它并不可靠。我相信将变量显式设置为“无”仍然是一种好习惯。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-05-26T15:15:50.380

我通常总是把它放在我的程序的末尾，或者如果我使用模块级的，则调用一个“CloseRecordSet”子：

```
Private Sub Rawr()
On Error GoTo ErrorHandler

    'Procedural Code Here.

    ExitPoint:
        'Closes and Destroys RecordSet Objects.
        If Not Recset Is Nothing Then
            If Recset.State = 1 Then
                Recset.Close
                Conn.Close
            End If
            Set Recset = Nothing
            Set Conn = Nothing
        End If
        Exit Sub

    ErrorHandler:
        'Error Handling / Reporting Here.
        Resume ExitPoint
End Sub 
```

然而，这样程序结束，（无论是正常还是由于错误）对象被清理并且资源是空闲的。

这样做是非常安全的，因为你可以把它拍进去，它只会在关闭或销毁记录集/连接对象方面做必要的事情，以防它已经被关闭（由于运行时错误或只是尽早关闭它，这只是确保）。

它真的没有太多麻烦，并且最好在完成对象后清理它们以立即释放资源，无论程序中发生什么。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2013-01-24T07:51:17.743

试试这个

```
If Not IsEmpty(vMyVariant) Then
    Erase vMyVariant
    vMyVariant = Empty
End If 
```

# php - 如何关闭共享主机上的魔术引号？

> ID：517008
> 
> 赞同：41
> 
> 时间：2009-02-05T17:47:55.990
> 
> 标签：php, magic-quotes-gpc

我想关闭 PHP 的魔术引号。我无权访问 php.ini。

当我尝试添加`php_flag magic_quotes_gpc off`到我的 .htaccess 文件时，我收到 500 内部服务器错误。这是我的 .htaccess 文件的样子：

```
AddType x-mapp-php5 .php
php_flag magic_quotes_gpc off 
```

然后我尝试使用`ini_set('magic_quotes_gpc', 'O')`，但没有效果。

如何关闭魔术引号？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-02-05T17:54:04.667

根据[手册](http://php.net/manual/security.magicquotes.disabling.php#82777)，您通常可以在共享主机上安装自定义 php.ini，其中不使用 mod_php，因此该`php_value`指令会导致错误。`php.ini`对于 suexec/FastCGI 设置，在任何情况下都有一个每个 webspace 是很常见的。

--

我不认为 O（大写字母 o）是设置 ini 标志的有效值。您需要使用真/假、1/0 或“开”/“关”值。

```
ini_set( 'magic_quotes_gpc', 0 );   // doesn't work 
```

**编辑**

检查[ini设置列表后](http://php.net/manual/ini.list.php)，我看到magic_quotes_gpc是一个`PHP_INI_PERDIR`设置（4.2.3之后），这意味着你不能改变它`ini_set()`（只有`PHP_INI_ALL`设置可以改变`ini_set()`）

这意味着您必须使用 .htaccess 文件来执行此操作 - 或者 - 实现一个脚本来反转魔术引号的效果。像这样的东西

```
if ( in_array( strtolower( ini_get( 'magic_quotes_gpc' ) ), array( '1', 'on' ) ) )
{
    $_POST = array_map( 'stripslashes', $_POST );
    $_GET = array_map( 'stripslashes', $_GET );
    $_COOKIE = array_map( 'stripslashes', $_COOKIE );
} 
```

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-02-06T13:34:21.477

虽然我不能说为什么 php_flag 给你`500 Internal Server Error`s，但我会指出[PHP 手册](http://us.php.net/manual/en/security.magicquotes.disabling.php)有一个例子，检测魔术引号是否打开，并在运行时从超全局变量中剥离它。与发布的其他人不同，这个是递归的，并且会正确地从数组中删除引号：

更新：我今天注意到 PHP 手册中有以下代码的新版本，它使用对超级全局变量的引用。

旧版：

```
<?php
if (get_magic_quotes_gpc()) {
    function stripslashes_deep($value)
    {
        $value = is_array($value) ?
                    array_map('stripslashes_deep', $value) :
                    stripslashes($value);

        return $value;
    }

    $_POST = array_map('stripslashes_deep', $_POST);
    $_GET = array_map('stripslashes_deep', $_GET);
    $_COOKIE = array_map('stripslashes_deep', $_COOKIE);
    $_REQUEST = array_map('stripslashes_deep', $_REQUEST);
}
?> 
```

新版本：

```
<?php
if (get_magic_quotes_gpc()) {
    $process = array(&$_GET, &$_POST, &$_COOKIE, &$_REQUEST);
    while (list($key, $val) = each($process)) {
        foreach ($val as $k => $v) {
            unset($process[$key][$k]);
            if (is_array($v)) {
                $process[$key][stripslashes($k)] = $v;
                $process[] = &$process[$key][stripslashes($k)];
            } else {
                $process[$key][stripslashes($k)] = stripslashes($v);
            }
        }
    }
    unset($process);
}
?> 
```

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2012-05-10T12:27:04.303

这将解决创建本地 php.ini 文件时出现“找不到类 'PDO'”的问题。

如果您不能使用 htaccess 文件关闭魔术引号（由于 Pete Bailey 已经给出的原因），只需：

1.  创建一个文本文件
2.  将其重命名为“php.ini”
3.  添加行

    magic_quotes_gpc = 关闭
    magic_quotes_runtime = 关闭
    magic_quotes_sybase = 关闭
    extension=pdo.so
    extension=pdo_mysql.so

4.  将其保存到执行脚本的目录中。

更新：如果您只想拥有新 php.ini 文件的一份副本，则将此行添加到您的根 .htaccess 文件中：

```
SetEnv PHPRC /path/to/site/root/public_html/php.ini 
```

显然，您需要将 ini 文件移动到它不存在的这个位置。

希望这可以节省我刚刚花费的 2 个小时！

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-02-07T01:24:40.437

.htaccess 文件中的 php_flag 和 php_value 在技术上是正确的 - 但仅适用于作为 Apache 模块安装的 PHP。在共享主机上，您几乎找不到这样的设置；PHP 是作为 CGI 运行的，原因与安全性有关（使您的服务器邻居远离您的文件）以及 phpsuexec 以“您”而不是 apache 用户身份运行脚本的方式。

因此，Apache 是正确的，给您一个服务器错误：除非加载了 PHP 模块，否则它不知道 php_flag 的含义。CGI 二进制文件对 Apache 来说是一个外部程序，您不能从 Apache 内部对其进行配置。

现在有个好消息：您可以设置每个目录的配置，在其中放置一个名为“ *php.ini* ”的文件，并使用与系统主 php.ini 中相同的语法设置您的指令。[PHP 手册](http://www.php.net/manual/en/ini.list.php)列出了所有可设置的指令：您可以设置那些标有 PHP_INI_PERDIR 或 PHP_INI_ALL 的指令，而只有系统管理员可以在服务器范围的 php.ini 中设置那些标有 PHP_INI_SYSTEM 的指令。

请注意，此类 php.ini 指令不会被子目录继承，您必须为它们提供自己的 php.ini。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2013-09-16T18:23:30.680

======================================== 我的解决方案========= ===================（将您的 php.ini 重命名为 php5.ini）

并在顶部（！），添加这些：

```
magic_quotes_gpc = Off
magic_quotes_runtime = Off
magic_quotes_sybase = Off
extension=pdo.so
extension=pdo_mysql.so 
```

然后在 .htaccess 中，添加这个（在顶部）：

```
SetEnv PHPRC /home/your_path/to/public_html/php5.ini 
```

ps 正确更改（您可以通过从典型的 .php 文件`/home/your_path/to/`执行命令来查看该路径。）`<?php phpinfo(); ?>`

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-01-17T02:50:24.130

如果您运行的是 PHP 5.3+，这可以解决问题，请将其放在页面的最顶部：

```
if (get_magic_quotes_gpc() === 1)
{
    $_GET = json_decode(stripslashes(json_encode($_GET, JSON_HEX_APOS)), true);
    $_POST = json_decode(stripslashes(json_encode($_POST, JSON_HEX_APOS)), true);
    $_COOKIE = json_decode(stripslashes(json_encode($_COOKIE, JSON_HEX_APOS)), true);
    $_REQUEST = json_decode(stripslashes(json_encode($_REQUEST, JSON_HEX_APOS)), true);
} 
```

处理键、值和多维数组。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-07-25T12:07:26.740

如果您的托管服务提供商使用 cpanel，您可以尝试将 php.ini 复制到您的 Web 目录并使用 magic_quotes_gpc = off 进行编辑

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-11-19T04:57:21.970

我知道我回答这个问题迟了，但我阅读了大部分答案，虽然很多都很棒，但只有[djn 真正解释了你*为什么*](https://stackoverflow.com/a/522888/486233)得到这个`500 Internal Server Error`。

虽然他的解释是 100% 正确的，但这是一个完美的例子，说明了为什么你应该总是将它们包装在`<IfModule>`. 虽然这不会解决无法在您的 中设置这些标志的实际问题`.htaccess`，**但它至少可以防止`500`错误**。

```
<IfModule mod_php5.c>
    # put all of your php_flags here, for example:
    php_flag magic_quotes_gpc off
</IfModule> 
```

或者对于旧版本，它会是`<IfModule mod_php.c>`等等。

我试图养成始终这样做的习惯，以避免任何此类 500 错误。之后，只需应用[Peter Bailey 所说](https://stackoverflow.com/a/517027/486233)的话。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-05T17:52:58.960

不同的托管服务提供商对此有不同的程序，所以我会在他们的论坛上询问或提交支持请求。

如果你不能关闭它们，你总是可以使用这样的东西，无论魔术引号是打开还是关闭，它都会转义输入：

```
//using mysqli

public function escapeString($stringToBeEscaped) {

    return $this->getConnection()->real_escape_string(stripslashes($stringToBeEscaped));
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-05T17:54:01.797

1.  如果您删除 AddType 行，它会起作用吗？我不太清楚为什么这与关闭魔术引号有关。

2.  如果 PHP 没有在 mod_php 下运行，htaccess 将无法工作。它可以作为 CGI 工作吗？

这确实适合您的托管公司。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-06T13:06:23.170

BaileyP 的回答已经很不错了，但我会改用这个条件：

```
if(function_exists('get_magic_quotes_gpc') && get_magic_quotes_gpc() === 1){
  $_POST = array_map( 'stripslashes', $_POST );
  $_GET = array_map( 'stripslashes', $_GET );
  $_COOKIE = array_map( 'stripslashes', $_COOKIE );
} 
```

它更具防御性。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-04-05T12:57:43.650

怎么样`$_SERVER`？

```
if (get_magic_quotes_gpc() === 1) {

    $_GET = json_decode(stripslashes(json_encode($_GET, JSON_HEX_APOS)), true);
    $_POST = json_decode(stripslashes(json_encode($_POST, JSON_HEX_APOS)), true);
    $_COOKIE = json_decode(stripslashes(json_encode($_COOKIE, JSON_HEX_APOS)), true);
    $_REQUEST = json_decode(stripslashes(json_encode($_REQUEST, JSON_HEX_APOS)), true); 
    $_SERVER = json_decode( stripslashes(json_encode($_SERVER,JSON_HEX_APOS)), true); 
} 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2009-02-05T18:28:40.057

如果你不能关闭它，我通常会这样做：

```
get_magic_quotes_gpc() ? $_POST['username'] : mysql_real_escape_string($_POST['username']); 
```

它将以其适当的格式放入数据库中。

# database-design - 何时使用数据库表之间的一对一关系？

> ID：517011
> 
> 赞同：22
> 
> 时间：2009-02-05T17:48:36.300
> 
> 标签：database-design, database-relations

一个数据库设计问题：您何时决定使用 1 对 1 关系表？

我看到的其中一个地方是，例如，当您有一个 User 和 UserProfile 表时，人们将它们拆分，而不是将所有列都放在 User 表中。

从技术上讲，您可以将所有列放在一个表中，因为它们的关系是一对一的。

我知道有人说对于 UserProfile 表，随着时间的推移，您需要更改表以添加更多列，但我真的不认为这是拆分表的充分理由。

那么，如果我要设计一个 User 表和 UserProfile 表，对我来说只在一个表中做会更好吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-05T17:52:39.693

我唯一一次使用 1 对 1 关系是当我希望它多态地属于多个对象时。

比如地址。用户有一个地址，企业有一个地址，特色餐厅有一个地址。所有实例都在同一个表中处理，并且具有管理它的相同代码。把它想象成重构你的数据模型，这样你就可以在其他地方重用它。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-05T17:53:04.013

考虑如何设计业务对象。您是要拥有一个带有 50 个属性的用户对象，还是要拥有一个带有一些详细属性的用户对象，然后是一个包含配置文件其他数据的配置文件对象？

当表中的数据相关但不是出于相同目的时，您应该使用 1 对 1。（可能措辞更好）

它也可以使事情更容易找到。没有什么比浏览一个有 75 列的表格更让我讨厌的事情了。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-05T18:05:13.880

经典的原因是避免可为空的列。

列中有 NULL 值会使编写清晰（可维护）的 SQL 变得更加困难。@Ovid在[这里](http://use.perl.org/~Ovid/journal/27927)写了这篇文章[，](https://stackoverflow.com/users/8003/ovid)借鉴了[Chris Date](http://en.wikipedia.org/wiki/Christopher_J._Date)的作品。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-05T17:52:53.000

仅当 UserProfile 表中的字段不需要用户表中的所有记录数时。例如，如果您有 3,000,000 个用户，但其中只有 3,000 个具有 UserProfile，则拆分它们可能是有意义的（以避免一大堆空列。）

尽管现在随着数据库速度的提高和存储成本的降低，但出于这个原因将它们拆分并没有太大的区别......

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-05T17:53:45.930

我最近看到一个表，其中包含大部分数据，然后是另一个包含大量可选数据的表。

第二个表有三分之一的行，但列的数量是原来的三倍。

这是几年前完成的，避免了列中的大量空值 - 即空白空间。

但是，如果您现在这样做，我很想不打扰。与空旷的空间一起生活。它给应用程序开发带来的麻烦根本不值得，而且空间比开发时间便宜。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-05T19:32:32.957

这是今天在这个线程中弹出的另一个问题的直接复制和粘贴，但在这里感觉也很有用。 [是否曾经有过使用数据库 1:1 关系有意义的时候？](https://stackoverflow.com/questions/517417/is-there-ever-a-time-where-using-a-database-11-relationship-makes-sense/517509#517509)

我使用它们主要有几个原因。一是数据变化率的显着变化。我的一些表可能有审计跟踪，我可以在其中跟踪以前版本的记录，如果我只关心跟踪 10 列中的 5 列的以前版本，将这 5 列拆分到一个单独的表中，上面有审计跟踪机制会更有效。另外，我可能有只写的记录（比如会计应用程序）。您不能更改美元金额或它们所用于的帐户，如果您犯了错误，则需要进行相应的记录以注销不正确的记录，然后创建更正条目。我对表有限制，强制执行它们无法更新或删除的事实，但我可能对该对象有几个可延展的属性，这些都保存在一个单独的表中，没有修改的限制。我这样做的另一次是在医疗记录应用程序中。有与访问相关的数据一旦签署就无法更改，而与访问相关的其他数据可以在签署后更改。在这种情况下，我将拆分数据并在锁定表上放置一个触发器，在注销时拒绝对锁定表的更新，但允许对医生未签署的数据进行更新。

另一位发帖人评论说 1:1 没有被规范化，在某些情况下，我不同意这一点，尤其是子类型化。假设我有一个员工表，主键是他们的 SSN（这是一个例子，让我们把关于这是否是另一个线程的好键的争论）。员工可以是不同的类型，比如临时的或永久的，如果他们是永久的，他们有更多的字段需要填写，比如办公室电话号码，只有在 type = 'Permanent' 时才应该不为空。在第 3 范式数据库中，列应该仅取决于键，即员工，但它实际上取决于员工和类型，因此 1:1 关系是完全正常的，并且在这种情况下是可取的。它还可以防止过于稀疏的表，如果我有 10 个通常填充的列，

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-05-03T08:18:09.277

这已经很好地解决了，但我只是添加一个快速说明来澄清一些对我来说并不明显并且没有明确说明的事情。1 对 1 的关系并不意味着表 A 中的每条记录在表 B 中都有 1 条对应的记录，而是意味着对于表 A 中的每条记录在表 B 中都会有 0 或 1 条对应的记录。

Shane D. 和其他人描述了利用这一事实的场景。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-09T07:43:10.660

我认为 Shane D 有一个非常合理的理由。甚至我也遇到了大约 40 列的表的相同情况，这些列的数据通过 csvs 上传，仅用于报告目的和一组列来处理这些文件，这些文件经常更新。

因此，如果我们维护一张表作为解决方案。我们对该表执行频繁更新，并且将只更新 50 列中的 5 列。我觉得每次更新都会干扰行分配，并且很有可能发生行链接，所以为了避免行链接，我采用了基于数据分离的方法关于 DML 活动。

让我知道是否有更好的解决方案

# java - 查找 UI 控件的类名

> ID：517020
> 
> 赞同：2
> 
> 时间：2009-02-05T17:52:44.983
> 
> 标签：java, swing

我需要一个工具来告诉我的鼠标指针所在的 UI 控件的类名。我的 GUI 在 Swing 中。这样的工具存在吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T18:09:54.590

您可以通过执行以下操作获取鼠标指针的当前位置：

```
Point location = MousePointer.getPointerInfo().getLocation(); 
```

获得位置后，您可以通过执行以下操作将其转换为父容器坐标系：

```
Point relativeLocation = SwingUtilities.convertPointFromScreen(location, parentComponent); 
```

最后，您可以通过执行以下操作在某个位置查找组件：

```
Component myComponent = parentComponent.getComponentAt(relativeLocation); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-05T20:27:23.860

查看[Swing Explorer](https://swingexplorer.dev.java.net/)。它允许您探索 Swing 应用程序的内部结构。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T18:06:18.450

如果您需要在程序本身中发现这一点，您可以使用 MouseListener 和序列：

```
Event.getSource()
Object.getClass()
Class.getName() 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T17:57:51.337

应该可以编写一个鼠标监听器来做这样的事情。

# sql - 动态 SQL 逗号分隔值查询

> ID：517028
> 
> 赞同：4
> 
> 时间：2009-02-05T17:54:16.400
> 
> 标签：sql, dynamic-sql, delimiter, delimited

[更新：使用 SQL Server 2005]

嗨，我想做的是使用逗号分隔的值 (id) 列表查询我的存储过程，以检索数据行。

我收到的问题是转换错误：

```
Conversion failed when converting the varchar value ' +
@PassedInIDs + ' to data type int. 
```

我的 where 子句和错误中的语句是：

```
...
AND (database.ID IN (' + @PassedInIDs + ')) 
```

注意：database.ID 是 int 类型。

我在以下位置关注文章：

[http://www.sql-server-helper.com/functions/comma-delimited-to-table.aspx](http://www.sql-server-helper.com/functions/comma-delimited-to-table.aspx)

但由于错误未完成。

在我的执行脚本中，我有：

```
...
@PassedInIDs= '1,5' 
```

我在这里做错了吗？谢谢您的帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T18:45:20.320

我强烈建议您使用该链接中的第二种方法。创建一个用户定义的函数，将逗号分隔的字符串转换为表格，然后您可以轻松地从中进行选择。

如果你在 Erland 和“Dynamic SQL”上做一个谷歌，他对它所包含的陷阱有很好的描述。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T18:45:24.097

一方面，您将一个字符串传递给 SQL 中的 IN 函数。如果您回顾原始文章，您会发现它不是直接发出 SQL 语句，而是构建一个`string`要执行的 SQL 语句。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T18:47:38.990

SQL 中没有字符串求值。这个：

```
database.ID IN (' + @PassedInIDs + ') 
```

不会转向：

```
database.ID IN (1,2,3) 
```

只是因为`@PassedInIDs`参数恰好包含`'1,2,3'`. 甚至没有查看该参数，因为您所拥有的只是一个*包含*`" + @PassedInIDs + "`. 从语法上讲，这相当于：

```
database.ID IN ('Bob') 
```

简而言之，您无法在 SQL 中执行您在此处尝试的操作。但还有其他四种可能性：

1.  您用调用语言构造 SQL 字符串并完全放弃存储过程
2.  您在 IN 子句中使用动态准备语句，其参数与平移使用的参数一样多
3.  您使用带有 10 个参数的固定准备好的语句：`IN (?,?,?,?,?,?,?,?,?,?)`，只填充您需要的数量，将其他设置为 NULL
4.  您创建一个存储过程，例如，10 个参数并传入任意数量的参数，将其他参数设置为 NULL: `IN (@p1, @p2, ..., @p10)`。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T18:50:37.720

我将创建一个 CLR 表值函数：

[http://msdn.microsoft.com/en-us/library/ms131103.aspx](http://msdn.microsoft.com/en-us/library/ms131103.aspx)

在其中，您将解析字符串并执行转换为一组行。然后，您可以加入该表的结果，或使用 IN 查看列表中是否有 id。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-05T18:09:35.243

您需要将 ufn_CSVToTable 视为一张表格。所以你可以加入这个功能：

```
JOIN ufn_CSVToTable(@PassedInIDs) uf ON database.ID = uf.[String] 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-05T18:36:52.850

我建议在 SQL 2005 中为此使用 XML。有点笨重，但它可以更容易。它允许您将 XML 选择到一个表中，然后可以加入或插入等。

如果您还没有，请查看 Sql Server 的 OPENXML()。

例如，你可以传入类似：'12...'

然后使用：

```
exec sp_xml_preparedocument @doc OUTPUT, @xmlParam

SELECT element 
FROM OPENXML (@doc, 'Array/Value', 2) WITH (element varchar(max) 'text()') 
```

那应该是一个开始

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-05T19:20:28.067

这可以通过 Narayana 的文章[将列表/数组传递给 SQL Server 存储过程中提到的 6 种方法来解决](http://vyaskn.tripod.com/passing_arrays_to_stored_procedures.htm)

我最严格的实施是

> **声明**@statement **nvarchar** (256)
> **set** @statement = 'select * from Persons where Persons.id in ('+ @PassedInIDs +')'
> **exec** sp_executesql @statement

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-06-10T11:15:12.700

这是我发现和测试的：

```
SET QUOTED_IDENTIFIER ON
SET ANSI_NULLS ON
GO
CREATE  FUNCTION [dbo].[SplitStrings] ( @IDsList VARCHAR(MAX) )
RETURNS @IDsTable TABLE ( [ID] VARCHAR(MAX) )
AS 
BEGIN
    DECLARE @ID VARCHAR(MAX)
    DECLARE @Pos VARCHAR(MAX)

    SET @IDsList = LTRIM(RTRIM(@IDsList)) + ','
    SET @Pos = CHARINDEX(',', @IDsList, 1)

    IF REPLACE(@IDsList, ',', '') <> '' 
        BEGIN
            WHILE @Pos > 0 
                BEGIN
                    SET @ID = LTRIM(RTRIM(LEFT(@IDsList, @Pos - 1)))
                    IF @ID <> '' 
                        BEGIN
                            INSERT  INTO @IDsTable
                                    ( [ID] )
                            VALUES  ( CAST(@ID AS VARCHAR) )
                        END
                    SET @IDsList = RIGHT(@IDsList, LEN(@IDsList) - @Pos)
                    SET @Pos = CHARINDEX(',', @IDsList, 1)
                END
        END 
    RETURN
END

GO 
```

这是函数调用的方式：

```
SELECT * FROM dbo.SplitStrings('123,548,198,547,965') 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-07-09T02:39:22.713

```
Try this:

    DECLARE @Ids varchar(50);
    SET @Ids = '1,2,3,5,4,6,7,98,234';

    SELECT * 
    FROM sometable 
    WHERE ','+@Ids+',' LIKE '%,'+CONVERT(VARCHAR(50),tableid)+',%'; 
```

# excel - 使用 C# 从 Excel 文件中读取特定列

> ID：517036
> 
> 赞同：0
> 
> 时间：2009-02-05T17:55:26.880
> 
> 标签：excel, excel-2007

我想阅读一些 Excel 文件并转换为我自己的 Excel 模板。我想每行读取 B 列（B1、B2、B3 ......就像这样）。

如果此栏有数字；在 B3 中有像“1,2,3,4,5,6,7,8,9”这样的数字，然后我会得到整行并将其放入数组 [i]。如果 B4 中有“5”数字，那么它将获取这一整行并将其带到数组 [i]。如果相关行中没有数字，它将继续下一行。

它将继续读取 Excel 文件的末尾。我想把这个数组写入一个新的 Excel 文件。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-06T07:39:56.357

1.  [在您的计算机上下载](http://www.microsoft.com/downloads/details.aspx?FamilyID=c41bd61e-3060-4f71-a6b4-01feba508e52&displaylang=en)并安装 Office 2003 主要互操作程序集
2.  创建一个 Visual Studio 项目并从 GAC 添加对“Microsoft.Office.Interop.Excel.dll”的引用。
3.  现在您可以编写此代码来从任何 Excel 文件中读取数据

例子：

```
using Excel = Microsoft.Office.Interop.Excel;

string pathOfExcelFile = "C:\\MyDataFile.xls";
Excel.Application excelApp = new Excel.Application();

excelApp.DisplayAlerts = false; //Don't want Excel to display error messageboxes  
Excel.Workbook workbook = excelApp.Workbooks.Open(pathOfExcelFile, Type.Missing, Type.Missing, Type.Missing, Type.Missing,                                            Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing,                      Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing); //This opens the file
Excel.Worksheet sheet = workbook.get_Item(1); //Get the first sheet in the file
Excel.Range bColumn = sheet.get_Range("B", null);

List<string> dataItems = new List<string>();

foreach (object o in bColumn) 
{
     Excel.Range row = o as Excel.Range;
     string s = row.get_Value(null);
     dataItems.Add(s);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T07:11:08.473

请看

[http://support.microsoft.com/kb/306572](http://support.microsoft.com/kb/306572)

和

[http://support.microsoft.com/kb/306023/EN-US/](http://support.microsoft.com/kb/306023/EN-US/)

你可以实现你的想法..

# database - 在页面上显示 # 个视图而不会一直访问数据库

> ID：517037
> 
> 赞同：3
> 
> 时间：2009-02-05T17:55:29.673
> 
> 标签：database, views, click

越来越多的网站正在显示某些页面收到的查看次数（以及在 dzone.com 上的点击次数）。跟踪视图#而不在每次加载时访问数据库的最佳实践是什么？

我脑子里有很多关于如何做到这一点的潜在想法，但似乎没有一个可行。

谢谢，第一次使用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-06T01:27:09.573

我会首先尝试数据库方法——返回自动增量计数器的值应该是一个相当便宜的操作，所以你可能会感到惊讶。即使保留一个包含许多项目的表来记录命中计数也应该是相当高效的。

但问题是如何避免每次调用都击中数据库。我建议将表加载到 webapp 中并在那里增加它，只在定期或 webapp 关闭时将其备份到数据库。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-06T07:47:11.693

一个便宜的技巧是简单地将值缓存几分钟。

无论如何，确切的查看次数并不重要，因为在繁忙的网站上，当访问者浏览页面时，已经有一批新的查看。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-28T14:43:28.273

一种方法是使用[memcached](http://www.danga.com/memcached/)作为计数器。您可以修改[此速率限制实现](http://simonwillison.net/2009/Jan/7/ratelimitcache/)以充当通用计数器。密钥可以是 yyyymmddhhmm 格式，有效期为 15 或 30 分钟（取决于您认为是并发访问者的情况），然后`get`在显示页面时只需使用这些密钥。

用于与 memcache 服务器通信的不错的库有[多种语言版本](http://code.google.com/p/memcached/wiki/Clients)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T18:02:52.667

您可以设置一个包含点击数的平面文件。这会有扩展问题，但它可以工作。

如果您不关心显示页面浏览量，您可以使用[google analytics](http://google.com/analytics)或[piwik 之](http://piwik.org/)类的东西。两者都在页面加载后发出请求，因此不会影响加载时间。可能有一种方法可以向分析服务器发出 ajax 请求，但我不确定。Piwik 是开源的，所以你可以一起破解一些东西。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-02-06T07:03:39.473

如果您使用服务器端脚本，请在变量中增加它。如果您重新启动服务，它可能会被重置，因此如果需要准确性，这不是一个好主意。

# asp.net-mvc - 部署 ASP.net 应用程序

> ID：517038
> 
> 赞同：2
> 
> 时间：2009-02-05T17:55:52.790
> 
> 标签：asp.net-mvc, sql-server-2005, iis

部署 ASP.net MVC 应用程序时的正确步骤是什么？我正在使用内置的基于表单的身份验证并使用 VS2008 中的发布功能进行部署，但是在部署时它似乎没有将 ASPNETDB 部署到服务器，我最终会遇到类似的错误

```
An error occurred during the execution of the SQL file 'InstallCommon.sql'. The SQL error number is 1802 and the SqlException message is: CREATE DATABASE failed. Some file names listed could not be created. Check related errors.
CREATE FILE encountered operating system error 5(Access is denied.) while attempting to open or create the physical file 'C:\INETPUB\WWWROOT\HOURS3\APP_DATA\ASPNETDB_TMP.MDF'. 
```

我查看了这个并尝试根据 [http://forums.asp.net/t/984436.aspx将 sql server 更改为在本地系统帐户下运行](http://forums.asp.net/t/984436.aspx)

但这似乎没有帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-18T00:47:24.817

当您尝试以这种方式发布时，我相信您将用您当前正在开发的数据库覆盖您的数据库。这意味着如果您的 Web 环境有任何更改，例如新用户，当您在发布中覆盖它们时，您将丢失它们。此外，您可能获得权限被拒绝的原因是该文件已被网站使用，如果您尝试删除正在使用的文件，Windows 不喜欢它。

通常，我将我的数据库设置为以与 ASP.net 文件不同的方法发布。我经常使用 RedGate SQL Compare 等工具生成升级脚本。这使我可以升级服务器上的实时文件，而不是复制新文件。

# wpf - 如何将 TargetNullValue 设置为日期？

> ID：517039
> 
> 赞同：6
> 
> 时间：2009-02-05T17:56:02.323
> 
> 标签：wpf, xaml, calendar, wpftoolkit, targetnullvalue

我正在使用 WPF 工具包的日历控件来允许用户选择日期。如果尚未选择日期，则 SelectedDate 绑定的属性为 Null。这使日历默认为公元 0 年 1 月 1 日。我想做类似的事情

```
SelectedDate="{Binding UserPickedDate, TargetNullValue=Today, Mode=TwoWay}" 
```

但是“今天”和“现在”都会引发绑定错误。我可以使用 TargetNullValue 将默认日期设置为今天或现在吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-06T13:37:40.800

试试这个：

```
xmlns:sys="clr-namespace:System;assembly=mscorlib"
...

TargetNullValue={x:Static sys:DateTime.Now} 
```

# c# - 如何修改 Web 服务代理以获取原始 XML

> ID：517045
> 
> 赞同：3
> 
> 时间：2009-02-05T17:57:00.153
> 
> 标签：c#, .net, xml, web-services

这是为我要访问的 Web 服务创建的代理方法。我将如何修改它以从 Web 服务调用中获取原始 XML？

```
 /// <remarks/>
    [System.Web.Services.Protocols.SoapHeaderAttribute("CallOptionsValue")]
    [System.Web.Services.Protocols.SoapHeaderAttribute("MruHeaderValue")]
    [System.Web.Services.Protocols.SoapHeaderAttribute("SessionHeaderValue")]
    [System.Web.Services.Protocols.SoapHeaderAttribute("QueryOptionsValue")]
    [System.Web.Services.Protocols.SoapDocumentMethodAttribute("", RequestNamespace = "urn:partner.soap.sforce.com", ResponseNamespace = "urn:partner.soap.sforce.com", Use = System.Web.Services.Description.SoapBindingUse.Literal, ParameterStyle = System.Web.Services.Protocols.SoapParameterStyle.Wrapped)]
    [return: System.Xml.Serialization.XmlElementAttribute("result")]
    public QueryResult query(string queryString)
    {
        object[] results = this.Invoke("query", new object[] {
                    queryString});
        return ((QueryResult)(results[0]));
    } 
```

谢谢你的帮助！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-19T15:11:03.163

幸运的是，有一个很好的方法可以做到这一点，只需修改生成的代理类，使其继承自不同的基类。替代实现来自 Web Services Enhancements 3.0 包：

[Microsoft.Web.Services3.WebServicesClientProtocol](http://www.microsoft.com/downloads/details.aspx?familyid=018a09fd-3a74-43c5-8ec1-8d789091255d&displaylang=en)

在课程中，您将在范围内拥有 RequestSoapContext.Envelope.InnerXml 和 ResponseSoapContext.Envelope.InnerXml - 这正是您所需要的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-06T03:52:46.050

如果您只想使用[Fiddler Web 调试工具](http://www.fiddlertool.com/fiddler/)进行转储。

如果您想真正检索/处理原始 XML，那么代理方法将无济于事。为 Web 服务创建 System.Net.HttpWebRequest，调用它，然后检索纯 XML 响应。格式/结构可在 .ASPX 页面或 Web 服务文档中找到。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T21:28:32.847

好吧，据我所知，我的一个朋友曾经使用常规的 ASMX 网络服务，这真是一个 hack....

将返回的结果序列化为 XML 怎么样？这可能会奏效...

类似于（完全未经测试和记忆）的东西：

```
MemoryStream stm = new MemoryStream();
XmlSerializer xmlSer = new XmlSerializer(typeof(QueryResult));
xmlSer.Serialize(stm, queryResult); 
```

那行得通吗？

马克

# vb.net - 限制 Setter 范围然后应用接口后，范围被忽略！

> ID：517049
> 
> 赞同：0
> 
> 时间：2009-02-05T17:57:24.193
> 
> 标签：vb.net, scope, interface, setter

如果我在 setter 上设置 Friend 级别的范围，像这样......

```
Public Class MyClass
    Public Property IsDirty() As Boolean
        Get
            Return _isDirty
        End Get
        Friend Set(ByVal trueFalse As Boolean)
            _isDirty = trueFalse
        End Set
    End  Property
End Class 
```

...然后从另一个项目中调用它，它可以正常工作。我不能做类似 MyClass.IsDirty = True 的事情。

伟大的！这正是我想要的。

但是现在如果我定义一个接口，我确实必须这样做：

```
Public Interface IMyClass
    Property IsDirty() As Boolean
End Interface 
```

我可以做类似的事情：

```
Dim MyInstance as IMyClass= GetSomeInstanceOfMyClass()
MyInstance.IsDirty=True 
```

...而且，奇怪的是，*它运行了！*不抛出异常，内部变量设置为 True。它完全忽略了朋友范围！

这太可怕了。我错过了什么？？

**注意：**我需要这个，因为我正在设计一个 API，并且我希望内部 API 能够设置 IsDirty，但最终开发人员不应该能够参与其中。目前我将整个类包装在一个外观中以获得此功能，但外观应该是不必要的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T19:52:25.520

您缺少的是隐式和显式接口实现的概念。有关详细信息，请参阅[此问题的答案](https://stackoverflow.com/questions/143405/c-interfaces-implicit-and-explicit-implementation)。

如果您认为使用 Friend setter 很可怕，请尝试将其设置为 Private 并观察它仍然可以通过界面访问！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T20:14:32.497

接口方法始终具有公共可访问性。您无法通过显式接口实现来解决这个问题，这只会隐藏类方法。只需将对象转换为接口类型即可再次提供不受限制的访问。

编辑：实际上，这个问题很容易解决。只需在接口声明中声明属性 ReadOnly :)

例如：

```
Public Interface IMyClass
    ReadOnly Property IsDirty() As Boolean
End Interface

Public Class Test
    Implements IMyClass
    Private mIsDirty As Boolean
    Private ReadOnly Property IsDirtyImpl() As Boolean Implements IMyClass.IsDirty
        Get
            Return mIsDirty
        End Get
    End Property
    Public Property IsDirty() As Boolean
        Get
            Return mIsDirty
        End Get
        Friend Set(ByVal value As Boolean)
            mIsDirty = value
        End Set
    End Property
End Class 
```

# visual-studio - 当私有成员变量更改值时，如何在 Visual Studio 调试器中停止执行？

> ID：517057
> 
> 赞同：5
> 
> 时间：2009-02-05T17:59:17.340
> 
> 标签：visual-studio, debugging, breakpoints, watch

假设我的班级有一个名为 count 的私有整数变量。

我已经在我的代码中遇到了断点。现在，在我按下继续之前，我想让调试器在 count 获得分配给它的新值时停止。

除了将 count 提升到字段并在字段的 set 方法上设置断点之外，还有其他方法可以做到这一点吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-06T05:43:50.803

您正在寻找的内容在托管代码中是不可能的。在 C++ 中，这称为数据断点。它允许您在正在运行的程序更改内存块时中断。但这仅在纯本机 C++ 代码中可用。

为什么没有实现它的简短版本是它在托管代码中要困难得多。本机代码很好且可预测。您创建内存并且它不会移动，除非您创建一个新对象（或显式复制内存）。

托管代码要复杂得多，因为它是一种垃圾收集语言。CLR 通常在内存中移动对象。因此，仅仅看一点记忆是不够的。它需要GC交互。

这只是实施托管断点的问题之一。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T18:03:53.680

我假设您正在尝试这样做，因为您想查看价值变化的来源。您已经说明了我一直这样做的方式：创建一个属性，然后在 set 访问器上中断（除非您必须始终使用该 set 访问器才能使其工作）。

基本上，我会说，由于私有字段只是存储，因此您不能对其进行破坏，因为私有字段不是可破坏的指令。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T18:12:20.357

我能想到的唯一方法是右键单击变量，然后选择“查找所有引用”。找到所有引用后，您可以在代码中为变量赋值的每个点创建一个新断点。这可能会很好地工作，除非您通过引用另一个函数来传递变量并更改其中的值。在这种情况下，您需要某种方式来观察内存中的特定点，以了解它何时发生变化。我不确定VS中是否存在这样的工具。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T18:24:45.090

就像 ChrisW 评论的那样。您可以设置“数据断点”，但仅适用于本机（非托管）代码。当垃圾收集器运行时，垃圾收集器将移动分配的内存块。因此，托管代码无法设置数据断点。

否则，没有。您必须封装对您想要“修改时中断”的项目的访问。由于它已经是私有成员，我建议遵循 Kibbee 的建议，在使用的任何地方设置断点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-06T02:13:09.887

> 除了将 count 提升到字段并在字段的 set 方法上设置断点之外，还有其他方法可以做到这一点吗？

使其成为不同类的属性，创建该类的实例，并在该属性上设置断点。

代替 ...

```
test()
{
   int i = 3;
   ...etc...
   i = 4;
} 
```

... 有 ...

```
class Int
{
  int m;
  internal Int(int i) { m = i; }
  internal val { set { m = value; } get { return m; } }
}

test()
{
  Int i = new Int(3);
   ...etc...
   i.val = 4;
} 
```

问题是，使用 C#，所有内容的实际内存位置都在不断移动：因此调试器不能轻易使用 CPU 的“内存访问中断”调试寄存器，而调试器更容易实现代码位置断点。

# c# - 如何从特定程序集中引用命名空间？

> ID：517058
> 
> 赞同：32
> 
> 时间：2009-02-05T17:59:24.827
> 
> 标签：c#, .net, assemblies

所以这是我的问题。

*   我的（测试）项目引用了 Castle Windsor 和 Rhino Mocks。
*   我正在创建一个从 Castle.Core.dll 程序集中实现 Castle.Core.Interceptor.IInterceptor 的类
*   在构建 Rhino Mocks 时，Ayende 使用了 Castle.Core.Interceptor 并将整个该死的命名空间包含在 Rhino.Mocks.dll 中

所以当我尝试构建时，我得到了错误

> “Castle.Core.Interceptor.IInterceptor”类型存在于“c:...\Libraries\Rhino.Mocks.dll”和“c:...\Libraries\Castle.Core.dll”中

那么我如何指定我想使用 Castle.Core.dll 中的 IInterceptor 实例，而不是 Rhino Mocks 中包含的实例？

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-02-05T18:17:36.070

让我们在这里抛出具体的答案，以防有人稍后出现。从[这里](http://blogs.msdn.com/ansonh/archive/2006/09/27/774692.aspx)的文章。

*   选择项目引用下的两个程序集之一（在我的例子中，我选择了 Castle.Core）。按 F4 调出属性并输入别名 CastleCore
*   在有问题的cs文件的顶部放置`extern alias CastleCore;`
*   用 . 引用您的课程`CastleCore::Castle.Core.Interceptors.IInterceptor`。或者就我而言，我只是做了：

使用 cci = CastleCore::Castle.Core.Interceptors;

现在可以参考

```
cci.IInterceptor 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-05T18:02:30.470

您可以使用 an[`extern alias`](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/extern-alias)为其中一个程序集设置别名以防止歧义。

# python - 返回吃异常

> ID：517060
> 
> 赞同：27
> 
> 时间：2009-02-05T17:59:35.810
> 
> 标签：python, exception, return, finally

我发现以下行为至少*很奇怪*：

```
def errors():
    try:
        ErrorErrorError
    finally:
        return 10

print errors()
# prints: 10
# It should raise: NameError: name 'ErrorErrorError' is not defined 
```

当您`return`在`finally`子句中使用时，异常会消失。那是一个错误吗？这在任何地方都有记录吗？

但真正的问题（以及我将标记为正确的答案）是：
python 开发人员允许这种奇怪行为的原因是什么？

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2009-02-05T18:03:39.233

> 当您`return`在`finally`子句中使用时，异常会消失。..这在任何地方都有记录吗？

[这是：](http://docs.python.org/reference/compound_stmts.html#the-try-statement)

> 如果 finally 存在，它指定一个“清理”处理程序。执行 try 子句，包括任何 except 和 else 子句。如果任一子句发生异常且未处理，则暂时保存该异常。finally 子句被执行。如果有一个保存的异常，它会在 finally 子句的末尾重新引发。**如果 finally 子句引发另一个异常或执行 return 或 break 语句，则保存的异常将丢失。**

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2009-02-08T16:15:35.020

您询问了 Python 开发人员的推理。我不能代表他们说话，但没有其他行为是有意义的。函数可以返回一个值，也可以引发异常；它不能两者兼得。“finally”子句的目的是提供“保证”运行的清理代码，而不考虑异常情况。通过在 finally 子句中放置一个 return 语句，你已经声明你想要返回一个值，不管发生什么，不管有什么异常。如果 Python 按照您的要求行事并引发异常，它将违反“finally”条款的合同（因为它无法返回您告诉它返回的值）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-05T22:52:30.307

这是一个关于 finally 块中返回的有趣比较，其中 - Java/C#/Python/JavaScript：（[存档链接](https://web.archive.org/web/20120426091446/http://www.gettingclever.com/2008/07/return-from-finally.html)）

> # 从最后归来
> 
> 就在今天，我正在帮助解决 Java 中的一些错误并遇到了一个有趣的问题——如果在 try/catch 语句中使用 return 会发生什么？finally 部分是否应该启动？我将问题简化为以下代码片段：
> 
> 下面的代码打印出什么？
> 
> ```
> class ReturnFromFinally {  
>  public static int a() {  
>   try {  
>    return 1;  
>   }  
>   catch (Exception e) {}  
>   finally{  
>    return 2;  
>   }  
>  }  
> 
>         public static void main(String[] args) {  
>   System.out.println(a());  
>         }  
> } 
> ```
> 
> 我最初的猜测是，它应该打印出来`1`，我正在打电话 `return`，所以我假设会返回一个。但是，事实并非如此：
> 
> [![第二次返回被执行](https://i.stack.imgur.com/oIBUm.png)](https://i.stack.imgur.com/oIBUm.png)
> 
> 我理解逻辑，最后必须执行部分，但不知何故我对此感到不安。让我们看看 C# 在这种情况下做了什么：
> 
> ```
> class ReturnFromFinally  
> {  
>  public static int a()  
>  {  
>   try {  
>           return 1;  
>   }  
>   catch (System.Exception e) {}  
>   finally   
>   {   
>    return 2;  
>   }  
>  }  
> 
>  public static void Main(string[] args)  
>  {  
>   System.Console.WriteLine(a());  
>  }  
> } 
> ```
> 
> [![错误 CS0157 控制不能离开 finally 子句的主体](https://i.stack.imgur.com/265tA.png)](https://i.stack.imgur.com/265tA.png)
> 
> 我更喜欢这种行为，控制流不能在 finally 子句中被弄乱，所以它可以防止我们在脚下开枪。为了完整起见，让我们检查一下其他语言的功能。
> 
> Python：
> 
> ```
> def a():  
>  try:  
>   return 1  
>  finally:  
>   return 2  
> print a() 
> ```
> 
> [![Python 也返回 2](https://i.stack.imgur.com/XFF54.png)](https://i.stack.imgur.com/XFF54.png)
> 
> JavaScript：
> 
> ```
> <script>  
> function ReturnFromFinally()  
> {  
>  try  
>  {  
>   return 1;  
>  }  
>  catch (e)  
>  {  
>  }  
>  finally  
>  {  
>   return 2;  
>  }  
> }  
> </script>  
> <a onclick="alert(ReturnFromFinally());">Click here</a> 
> ```
> 
> [![JavaScript 也返回 2](https://i.stack.imgur.com/H1bcB.png)](https://i.stack.imgur.com/H1bcB.png)
> 
> C++ 和 PHP 中没有 finally 子句，所以我不能尝试我有编译器/解释器的最后两种语言。
> 
> 我们的小实验很好地表明，C# 对这个问题有最好的方法，但我很惊讶地发现，所有其他语言都以同样的方式处理这个问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-05T18:03:11.060

从 finally 返回**不是**一个好主意。我知道 C# 明确禁止这样做。

# c# - Forms Auth-pwd recovery-我宁愿用户在网上重置它而不是发送电子邮件

> ID：517062
> 
> 赞同：2
> 
> 时间：2009-02-05T17:59:52.877
> 
> 标签：c#, asp.net, forms-authentication

问题 1 - 我想让用户能够在没有电子邮件和生成密码的情况下重置密码。用户通过写入的自定义表单根据我们的内部数据库验证自己。然后，我想提示他们输入用户名和安全问答。我不知道如何进行安全 QA，所以我决定自定义密码恢复控制。我不希望它发送带有新密码的电子邮件。相反，如果他们得到正确的用户名和问题，我想将他们发送到密码重置页面。

有没有办法向他们询问安全问题并通过编写自定义代码或使用预构建组件进行比较。另外，他们重置密码后如何设置密码？

问题 2- 我正在处理“忘记用户名”。它将首先验证我们的数据库。根据他们输入的内容，我将能够在表单身份验证数据库中匹配并找到用户名和用户 ID。我想问他们安全问题，但不知道如何根据他们输入的内容创建哈希，以比较用户在 aspnet 数据库中的内容。有没有办法做到这一点？

谢谢！！！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-06T22:49:16.117

如果您使用的是 asp.net forms 身份验证，它已经为用户提供了使用安全问题重置密码的机制。这可以在 Web.config 中进行配置，并与密码恢复控件一起使用，该控件是 ASP.net 登录控件的一部分。

在您的会员提供者部分下的 web.config 中设置：

**requiresQuestionAndAnswer** - 当设置为 true 时，将需要 Question 视图来检索或重置用户的密码。当设置为 false 时，问题视图不会显示给用户。

此处使用密码恢复控件是示例代码：

```
 <asp:PasswordRecovery ID="PasswordRecovery1" runat="server">
  <QuestionTemplate>
                <h2>Forgot Password</h2>
                Hello <asp:Literal ID="UserName" runat="server"></asp:Literal><br />
                Please answer your password question : <br />
                <asp:Literal ID="Question" runat="server"></asp:Literal>
                <asp:TextBox ID="Answer" runat="server"></asp:TextBox><br />
                 <asp:Button ID="SubmitButton" runat="server" Text="Send Answer By Mail" 
CommandName="Submit"/><br />
                  <asp:Literal ID="FailureText" runat="server"></asp:Literal>
    </QuestionTemplate>
    </asp:PasswordRecovery> 
```

有关使用 ASP.net 登录控件的更多信息，请访问[http://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/default.aspx](http://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/default.aspx)

至于不发送电子邮件，您可以通过在密码恢复控件中添加 OnSendingMail="CancelEmail" 来取消电子邮件，然后在后面添加如下代码，然后在屏幕上显示新的重置密码。

```
Sub CancelEmail(ByVal sender As Object, ByVal e As MailMessageEventArgs)
        e.Cancel = True
End Sub 
```

希望有帮助！

# asp.net - 您如何正确处理 ASP.NET 项目中的错误处理（尤其是 SQL）

> ID：517063
> 
> 赞同：3
> 
> 时间：2009-02-05T18:00:16.980
> 
> 标签：asp.net, error-handling

我有另一个正在工作的 ASP.Net Web 项目，并且我从不同的角度处理了错误。我只是想知道是否有经验丰富的开发人员有任何建议。

讨论一个好的 ASP.net 日志框架的奖励点:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T18:55:34.200

我使用了 ELMAH，（错误日志记录模块和处理程序）是一个应用程序范围的错误日志记录工具，它是完全可插拔的，在多个项目中运行良好： **[http ://code.google.com/p/elmah/](http://code.google.com/p/elmah/)**

我还使用了 ASP.NET 2.0 中的内置健康监控：http: **[//msdn.microsoft.com/en-us/library/ms998306.aspx](http://msdn.microsoft.com/en-us/library/ms998306.aspx)**

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T18:05:59.590

这取决于您的应用程序所针对的环境。但是我所做的是在 web.config 的 customErrors 部分中重定向到一个通用的 ErrorHandler.aspx 页面，然后我不处理和隐藏的任何异常都会导致页面重定向到允许错误处理程序的错误处理程序用户知道发生了什么，并让他们选择报告它。

我建议从 System.Exception 派生，以使您可以为 ErrorHandler.aspx 页面指定更多细节，例如 FriendlyMessage 属性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T18:15:35.077

我使用 Application_Error() 事件来获取未处理的异常。我使用 Application.Log() 方法将它们写入日志，然后将它们重定向到用户友好的错误页面。

Application.Log() 可以使用 web.config 文件进行配置，以将输出定向到文件、服务器上的事件日志等。

在某些情况下，我还使用通用 TraceSource 和将消息记录到数据库表的自定义侦听器实现了自己的日志记录。

# c# - 反序列化通用列表返回 null

> ID：517064
> 
> 赞同：5
> 
> 时间：2009-02-05T18:00:20.037
> 
> 标签：c#, serialization, binary-serialization

我正在反序列化一个对象，如下所示：

```
public class myClass : ISerializable
{
  public List<OType> value;

  public myClass(SerializationInfo info, StreamingContext context)
  {
    this.value = (List<OType>)info.GetValue("value", typeof(List<OType>));
  }

  void ISerializable.GetObjectData(SerializationInfo info, StreamingContext context)
  {
    info.AddValue("value", value, typeof(List<OType>));
  }
} 
```

列表中的对象*确实*具有 Serializable 属性。序列化时，不会抛出任何错误并且列表*永远不会*为空，但是在反序列化时我的所有列表都是空的，我不知道为什么。

我将此标记为 CQ 已回答。我能够生成一个小型的一次性测试应用程序，它可以正确序列化/反序列化我正在尝试使用的对象，但我似乎仍然无法让它在我的生产代码中工作，但我怀疑这是我的小事我失踪了。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-08-10T08:41:48.643

当你说你的列表为空时，你的意思是列表本身是空的，还是它填充了空条目？如果是后者，那么这是一个已知的 .Net 问题：请参阅[我](https://stackoverflow.com/questions/2400805/deserializing-a-class-containing-a-listt-why-is-list-initially-filled-with-nul)关于同一问题的问题。

基本上，`List<T>`s只有在反序列化时才被初始化；它们包含的对象仅在对象图被反序列化后才被反序列化。解决这个问题的一种方法是将任何需要它们的代码放在一个`OnDeserialized`方法中，或者一个带有`[OnDeserializedAttribute]`. 请参阅[MSDN](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.ondeserializedattribute%28v=VS.90%29.aspx)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-05T18:06:47.747

那么列表一开始总是空的，你是通过设置它`myClass.value = new List<...>();`吗？您是否还以二进制和 xml 格式保存了序列化数据，以便验证数据是否实际被保存？

也请注意，如果您使用的是 2.0+，如果您不需要控制绝对序列化，则不必实现 ISerializable，您可以将值更改为公共属性，它将自行序列化。

编辑：以下案例似乎对我来说可以序列化和反序列化，我发布这个以防我误解了整个问题。

忽略讨厌的测试代码，希望这会有所帮助。

```
 [Serializable]
    public class OType
    {
        public int SomeIdentifier { get; set; }
        public string SomeData { get; set; }

        public override string ToString()
        {
            return string.Format("{0}: {1}", SomeIdentifier, SomeData);
        }
    }

    [Serializable]
    public class MyClass : ISerializable
    {
        public List<OType> Value;

        public MyClass() {  }

        public MyClass(SerializationInfo info, StreamingContext context)
        {
            this.Value = (List<OType>)info.GetValue("value", typeof(List<OType>));
        }

        void ISerializable.GetObjectData(SerializationInfo info, StreamingContext context)
        {
            info.AddValue("value", Value, typeof(List<OType>));
        }
    }

...

        var x = new MyClass();

        x.Value = new OType[] { new OType { SomeIdentifier = 1, SomeData = "Hello" }, new OType { SomeIdentifier = 2, SomeData = "World" } }.ToList();

        var xSerialized = serialize(x);

        Console.WriteLine("Serialized object is {0}bytes", xSerialized.Length);

        var xDeserialized = deserialize<MyClass>(xSerialized);

        Console.WriteLine("{0} {1}", xDeserialized.Value[0], xDeserialized.Value[1]); 
```

忘记输出了。。

> 序列化对象为 754 字节
> 
> 1：你好 2：世界

# c# - 为什么 volatile 还不够？

> ID：517070
> 
> 赞同：9
> 
> 时间：2009-02-05T18:01:20.597
> 
> 标签：c#, synchronization

我很困惑。[我之前](https://stackoverflow.com/questions/516940/can-multiple-cpus-simultaneously-write-to-the-same-ram-location)的问题的答案似乎证实了我的假设。但正如[此处](https://stackoverflow.com/questions/154551/volatile-vs-interlocked-vs-lock)所述， volatile 不足以确保 .Net 中的原子性。MSIL 中的增量和赋值等操作不会直接转换为单个本地 OPCODE，或者多个 CPU 可以同时读取和写入相同的 RAM 位置。

澄清：

1.  我想知道写入和读取是否在多个 CPU 上是原子的？
2.  我明白 volatile 是什么意思。但够了吗？如果我想获取其他 CPU 写入的最新值，是否需要使用联锁操作？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-05T18:33:58.813

Herb Sutter 最近写了一篇关于`volatile`原生 C++ 及其真正含义（它如何影响内存访问顺序和原子性）的文章。.NET 和 Java 环境。这是一个很好的阅读：

*   [易变与易变](https://web.archive.org/web/20090421134427/http://www.ddj.com/hpc-high-performance-computing/212701484)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-05T18:08:47.650

.NET 中的 volatile 确实可以访问变量 atomic。

问题是，这通常是不够的。如果你需要读取变量怎么办，如果它为0（表示资源空闲），你将它设置为1（表示它被锁定，其他线程应该远离它）。

读取 0 是原子的。写 1 是原子的。但是在这两个操作之间，任何事情都可能发生。您可能会读取 0，然后在您可以写入 1 之前，另一个线程跳入，读取 0，然后写入 1。

但是，.NET 中的 volatile*确实*保证了访问变量的原子性。它只是不能保证依赖于多次访问的操作的线程安全。（免责声明：C/C++ 中的 volatile 甚至不能保证这一点。正如你所知。它要弱得多，并且有时是错误的来源，因为人们认为它保证原子性 :)）

因此，您还需要使用锁，将多个操作组合为一个线程安全块。（或者，对于简单的操作`Interlocked`，.NET 中的操作可以解决问题）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-05T18:12:27.330

我可能会在这里跳枪，但在我看来，您似乎在这里混淆了两个问题。

一个是原子性，在我看来，这意味着单个操作（可能需要多个步骤）不应该与另一个这样的单个操作发生冲突。

另一个是波动性，这个值预计何时会发生变化，以及为什么会发生变化。

拿第一个。如果你的两步操作需要你读取当前值，修改它，然后写回，你肯定会想要一个锁，除非整个操作可以被转换成一个可以在一个 CPU 上运行的指令。单个缓存行数据。

但是，第二个问题是，即使您正在执行锁定操作，其他线程也会看到什么。

.NET 中的`volatile`字段是编译器知道可以随时更改的字段。在单线程世界中，变量的更改是在顺序指令流中的某个时间点发生的，因此编译器知道它何时添加了更改它的代码，或者至少当它调用外部世界时可能会也可能不会更改它，因此一旦代码返回，它可能与调用之前的值不同。

这种知识允许编译器在循环或类似代码块之前将字段中的值一次提升到寄存器中，并且永远不会从该特定代码的字段中重新读取值。

但是，使用多线程可能会给您带来一些问题。一个线程可能已经调整了这个值，而另一个线程由于优化，在一段时间内不会读取这个值，因为它*知道*它没有改变。

因此，当您标记一个字段时，`volatile`您基本上是在告诉编译器它不应该假定它在任何时候都具有 this 的当前值，除非在每次需要该值时抓取快照。

锁解决了多步操作，易失性处理了编译器如何将字段值缓存在寄存器中，它们一起将解决更多问题。

另请注意，如果一个字段包含无法在单个 cpu 指令中读取的内容，您很可能也希望锁定对它的读取访问权限。

例如，如果您在 32 位 cpu 上并写入 64 位值，则该写入操作将需要两个步骤才能完成，并且如果另一个 cpu 上的另一个线程在步骤 2 之前设法读取 64 位值完成后，它会得到一半以前的价值和一半新的，很好地混合在一起，这比得到一个过时的更糟糕。

* * *

**编辑**：回答评论，`volatile`保证读/写操作的原子性，这在某种程度上是正确的，因为`volatile`关键字不能应用于大于 32 位的字段，实际上使字段单cpu 指令可在 32 位和 64 位 cpu 上读/写。是的，它会尽可能地防止将值保存在寄存器中。

所以部分注释是错误的，`volatile`不能应用于 64 位值。

还要注意，它`volatile`有一些关于读/写重新排序的语义。

有关相关信息，请参阅[MSDN 文档](http://msdn.microsoft.com/en-us/library/x13ttww7.aspx)或[C# 规范](http://download.microsoft.com/download/3/8/8/388e7205-bc10-4226-b2a8-75351c669b09/CSharp%20Language%20Specification.doc)，可在[此处](http://msdn.microsoft.com/en-us/vcsharp/aa336809.aspx)找到，第 10.5.3 节。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T18:42:11.700

在硬件级别上，多个 CPU 永远不能同时写入同一个原子 RAM 位置。原子读/写操作的大小取决于 CPU 架构，但在 32 位架构上通常为 1、2 或 4 个字节。但是，如果您尝试回读结果，则总是有可能另一个 CPU 已写入其间的同一 RAM 位置。在低级别上，自旋锁通常用于同步对共享内存的访问。在高级语言中，这种机制可以称为例如临界区。

volatile 类型只是确保变量在更改时立即写回内存（即使该值要在同一个函数中使用）。如果稍后要在同一函数中重用该值，编译器通常会将值尽可能长时间地保存在内部寄存器中，并在所有修改完成或函数返回时将其存储回 RAM。易失性类型在写入硬件寄存器时非常有用，或者当您想确保将值存储回 RAM 中时，例如多线程系统。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-05T18:08:56.463

您的问题并不完全有意义，因为[volatile 指定了读取的发生方式](http://www.bluebytesoftware.com/blog/2008/06/13/VolatileReadsAndWritesAndTimeliness.aspx "易失性读写，时效性")，而不是多步过程的原子性。我的车也不会修剪我的草坪，但我尽量不让它靠着它。:)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-05T18:12:13.303

问题来自于变量值的基于寄存器的兑现副本。

读取值时，cpu 将首先查看它是否在寄存器中（快），然后再检查主内存（慢）。

Volatile 告诉编译器尽快将值推送到主存储器，而不是信任缓存的寄存器值。它仅在某些情况下有用。

如果您正在寻找单个操作代码写入，则需要使用 Interlocked.Increment 相关方法。但是它们在单个安全指令中可以做的事情相当有限。

最安全和最可靠的赌注是 lock() （如果你不能做一个 Interlocked.*）

编辑：如果写入和读取处于锁定或互锁。* 语句中，则它们是原子的。根据您的问题，仅挥发性是不够的

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-02-05T18:08:17.180

Volatile 是一个编译器关键字，它告诉编译器要做什么。它不一定转化为（本质上）原子性所需的总线操作。这通常由操作系统决定。

编辑：澄清一下，如果你想保证原子性， volatile 是远远不够的。或者更确切地说，由编译器决定是否足够。

# asp.net - 将动态图像输出到asp.net控件的源中

> ID：517078
> 
> 赞同：1
> 
> 时间：2009-02-05T18:02:42.637
> 
> 标签：asp.net, image-processing

我发现了如何根据来自网络表单的一些输入在代码隐藏中生成图像，太好了。现在我想在回发后将该图像放回表单中。我发现的所有示例都使用响应将图像通过流发送回浏览器。

无论如何要指定在后面的代码中生成的图像是图像控件（或占位符或其他）的来源？

如果有办法做到这一点，有没有办法在不将图像保存到磁盘的情况下做到这一点？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T18:09:57.083

Web 浏览器必须能够以某种方式检索图像。如果您不想保存它，则需要将其与响应流一起发送。

您可以创建 HTTP 处理程序 (ashx) 并根据查询字符串参数生成并返回图像。这将允许您将图像对象“ImageUrl”属性指定为“~/MyImageHandler.ashx?param1=value1”

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-07-17T08:24:23.417

[http://imageresizing.net](http://imageresizing.net)库可以动态处理和生成图像。你能提供更多关于你想要做什么的细节吗？

# http-headers - 即使我添加了它们，yslow 仍然没有在 apache httpd 中为过期标头给我一个 A

> ID：517083
> 
> 赞同：0
> 
> 时间：2009-02-05T18:03:46.737
> 
> 标签：http-headers, apache, yslow, mod-expires

尝试将 ExpiresDefault ExpiresByType 添加到我网站上的内容中，以便对其进行缓存。我在 Javascript、CSS 和图像的 URL（路径中的修订号）中使用 cachebusting，这样我就可以将这些 mimetype 设置为永远。我在 apache httpd 中设置了以下规则：

```
 ExpiresActive On
  ExpiresDefault "access plus 1 minutes"
  ExpiresByType image/gif "access plus 10 years"
  ExpiresByType image/png "access plus 10 years"
  ExpiresByType image/jpeg "access plus 10 years"
  ExpiresByType image/jpg "access plus 10 years"
  ExpiresByType text/javascript "access plus 10 years"
  ExpiresByType text/css "access plus 10 years" 
```

然后，当我访问我的网站[http://karmerd.com](http://karmerd.com)并使用 httplive 标头查看标头时，我得到了我认为正确的 css 过期时间：过期时间：星期日，2019 年 2 月 3 日 17:52:48 GMT

但我使用雅虎的 Yslow 萤火虫扩展，它仍然给我一个 F 不使用过期！难道我做错了什么？我也在我的网站上使用 gravatar，但他们设置了 Expires。好像所有东西都有过期时间。是Yslow还是我？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-05T18:08:38.727

您的 javascript 文件被发送为`application/x-javascript`，所以没有得到一个遥远的 Expires 标头。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-05T18:09:26.850

不要依赖该工具来判断您的网站是否运行得很快。我已经让它做了很多古怪的事情（就像 yui）——如果它给你一个误报，你的网站运行良好，而且你没有人抱怨速度——你很可能没有速度问题。查看事物是否正在缓存的最佳方法是在它们发出时在 firebug 或其他工具中观察请求，如果您没有请求它并检索它，那么它还没有过期。

# asp.net-mvc - ASP.NET MVC 和两个 Web.config 文件

> ID：517086
> 
> 赞同：38
> 
> 时间：2009-02-05T18:04:16.737
> 
> 标签：asp.net-mvc, web-config

Web.config 应该放在 ASP.NET MVC 项目中的什么位置？

我只是在尝试这样做时遇到了一个错误：

```
_cnstr = System.Configuration.ConfigurationManager.
    ConnectionStrings["production"].ConnectionString; 
```

默认的 MVC 模板将 Web.config 放在项目的根目录。

如果您进入项目的属性（带有垂直选项卡的屏幕）。转到设置并尝试创建应用程序设置，它会提示您没有配置文件。当它创建文件时，它会在 Views 文件夹的基础上进行。所以现在我有**两个**Web.config 文件。这是应该的吗？

而且我想我应该将连接字符串放在“views”web.config 中以避免错误。想法？这是 ASP.NET MVC 位的最新版本中的错误吗？

**更新：** 见大卫的回答

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2009-02-05T18:22:59.740

设置应进入应用程序根目录的 web.config。视图文件夹中的 web.config 用于阻止对仅应通过控制器提供服务的视图 aspx 页面的直接访问。

（并且：我尝试在我的机器上创建应用程序设置，安装 ASP.NET MVC RC 1，使用新创建的 mvc Web 应用程序。它们被添加到应用程序根目录的 web.config 中。）

# asp.net-mvc - ASP.NET MVC 命名空间重命名

> ID：517094
> 
> 赞同：16
> 
> 时间：2009-02-05T18:05:29.700
> 
> 标签：asp.net-mvc, namespaces

我将我的项目从 MyProjectName 重命名为 MyNewProjectName。我对解决方案进行了完整的查找/替换，并更改了测试项目。在 Default.aspx.cs 我得到一个 InvalidOpterationException

“控制器名称‘Home’在以下类型之间不明确：MyNewProjectName.Controllers.HomeController MyProjectName.Controllers.HomeController。”

我该如何解决？谢谢

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-02-05T18:15:02.847

您是否尝试过重建（右键单击项目，然后选择“重建”）？还要检查 bin 以确保只有具有新名称的程序集存在。此外，请仔细检查项目属性以验证是否输出了程序集的名称。如果您不确定输出程序集的名称是什么，请从 bin 中删除所有 dll 并重建。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-07-06T13:17:01.040

您需要检查 MVC Web 项目中的 /bin 文件夹，然后删除其中的所有内容并进行新构建，或者删除旧的 DLL (MyProjectName.dll)。

ASP.Net MVC 运行时使用反射来根据路由信息确定必须将请求传递给哪个控制器，它会找到两个符合条件的控制器（具有相同的名称），并且每个控制器都在不同的程序集中。这就是为什么你会得到例外。

进行**清理**似乎并没有清除 bin 文件夹。所以你必须手动删除文件。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-11-02T20:53:25.723

至于我自己，我在 View 文件夹的 web.config 中有参考，一旦更改，一切正常！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-07-06T16:49:57.027

双击或右键单击 MyProject 并打开。在应用程序设置中更改程序集名称和根命名空间以匹配您重命名的项目名称。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-09-14T13:13:00.747

右键单击项目，选择“在 Windows 资源管理器中打开文件夹。

删除 /bin 和 /obj 中的“OLDPROJECTNAME”对象

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-03-01T18:19:32.500

在我的项目中，我遇到了同样的症状。要解决这个问题，我必须：

*   转到您的 App_Start 并检查您的新命名空间在类中是否正确。

*   右键单击 Global.asax 并转到“显示标记”并检查“继承”属性是否具有您的新命名空间。

像：

```
<%@ Application Codebehind="Global.asax.cs" Inherits="MyNewNamespace.MvcApplication" Language="C#" %> 
```

重建应用程序。

# reporting-services - 字段为 NULL 时代码未运行 - SSRS 2005

> ID：517095
> 
> 赞同：2
> 
> 时间：2009-02-05T18:05:33.600
> 
> 标签：reporting-services

我的 SSRS 2005 报告中有一个文本框。此文本框的表达式为：

```
=IIF(IsDBNull(Fields!fOrgID), Code.SetMyVar("null"), Code.SetMyVar(Fields!fOrgID.Value)) 
```

我也尝试过`IsNothing(Fields!fOrgID)`检查`nulls`.

我已经修改了`SetMyVar`测试功能，现在看起来像这样：

```
Public Function SetMyVar (var as String)

   MsgBox(var, VbOKCancel, "Test1")

   If var Is Nothing Then
        Return "NOTHING"
    Else
         MyVar = var
         Return var
    End If

End Function 
```

我也有公共变量`MyVar`：

```
Public Shared Dim MyVar as String 
```

当我的数据库查询返回数据时，这会正确评估，会显示一个带有值的消息框，文本框会设置该值，世界通常是一个更快乐的地方。

当我的数据库查询没有返回值时，我收到错误：

> 查询没有返回数据集的行。因此，表达式的计算结果为 null。

并且该`SetMyVar`函数似乎从未运行过（您永远不会得到消息框弹出窗口）。不出所料，我的情绪从愤怒、悲伤到对 SSRS 的强烈仇恨不等。

我读到了一些关于 SSRS 评估声明双方的内容`IF`，所以也许这就是我得到错误的原因（可能是这样`Code.SetMyVar(Fields!fOrgID.Value)`）......但我不确定我是如何解决这个问题的。

想法？建议？安慰的话？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T22:54:00.273

从事情的声音来看，问题似乎是 SSRS 在显示零记录时出现问题。我推荐以下之一：

1）使用适当处理零记录的控件（表可以。我认为列表也可以）。

2）修改您的查询以返回具有空白值的单个记录，否则它将返回零记录。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-10-27T01:52:04.370

对原始问题的回答：

```
=IIF(IsNothing(Fields!fOrgID),
     Code.SetMyVar("null"),
     Code.SetMyVar(IIF(IsNothing(Fields!fOrgID),"Foo",Fields!fOrgID.Value))) 
```

错误来自被评估的 IIF 双方。上面语句中的额外 IIF 将避免 Code.SetMyVar 被调用为空值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T18:18:55.053

我相信你对 Iif 总是评估它的两个值参数是正确的（至少，它在 Visual Basic 中是这样）。我不确定你为什么会得到这个精确的错误（除非字符串不能被分配一个 DBNull 的值？），但你几乎肯定想用不同的方法来解决这个问题。

原因是您当前的代码可能总是调用这两个 set 方法，而不管条件值如何。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T18:35:16.893

我也试过这个（也试过 IsNothing 的版本）......

=Code.SetField(IsDBNull(Fields!fOrgID))

并将函数更改为接受布尔值的函数。我认为上述函数将始终返回真或假，但如果为 NULL，我再次得到“查询未返回数据集的行。因此表达式的计算结果为 null。”。

如果该字段是否为空，我需要传回我的代码（因为这会让我知道数据源是否为空）。

如果你能想到更好的方法，请告诉我，因为我不能。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-10-27T01:43:27.207

适用于我的 SSRS 2008 报告的公式。

=IIf(String.IsNullOrEmpty(Fields!NullableFieldwithPossibleBlankStrings.Value),"是","否")

# jms - JMS 回滚

> ID：517100
> 
> 赞同：8
> 
> 时间：2009-02-05T18:06:41.180
> 
> 标签：jms, rollback

我有一个涉及发送 JMS 消息的过程。该过程是交易的一部分。如果事务的后一部分失败，即发送消息的前一部分之后的部分，我需要取消该消息。我的一个想法是以某种方式设置消息在一定时间内不会被拾取，如果我需要回滚，那么我可以去取消消息。不知道消息传递，我不知道这个想法是否可能。或者，有更好的主意吗？谢谢

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-06T18:13:35.297

您可以同时使用 JMS 和 JTA（Java 事务 API）。这样做时，JMS 消息的发送或接收到的消息的消费实际上是作为事务提交的一部分自动发生的。

这是什么意思？如果事务失败或回滚，则“已发送”消息不会发出，任何“已接收”消息都不会真正被消费。所有这些都由您的 JMS 和 JTA 提供商为您处理。

您需要使用支持 JTA 的 JMS 实现。听起来您已经在使用事务，因此可能需要进行一些配置以使其发生（大力挥手......）。

我有使用这个的经验（BEA WebLogic 7 w/BEA WebLogic Integration）。像宣传的那样工作——“外部世界”没有看到我尝试过的 JMS 东西的影响，除非事务成功提交。

早期版本链接到一般描述 JMS/JTA 集成的 Java 页面。该页面已过时，我没有看到等效的替代品。此[javadoc](https://docs.oracle.com/javaee/7/api/javax/jms/XAConnectionFactory.html)用于与此功能相关的 JMS 接口。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-16T20:35:21.447

您所描述的是 XA 事务。这允许事务跨越多个层，即 JMS 提供程序、DB 或任何其他 EIS。大多数容器可以配置为使用非 XA 和非 XA 事务，因此请检查您的容器设置！

例如，如果您将 JMS 与 XA 事务一起使用，则可以执行以下操作。

```
Start Transaction
      |
   DB Insert
      |
   Send JMS Msg
      |
   More DB Inserts
      | 
   Commit Transaction  <- Only at this point will the database records be inserted and the JMS message sent. 
```

XA 事务仅在完整的 Java EE 容器中可用，因此 XA 事务在 Tomcat 中不可用。

祝你好运！

卡尔

# sql - 您将如何在 SQL 中建立临时多对多关系？

> ID：517102
> 
> 赞同：6
> 
> 时间：2009-02-05T18:06:47.997
> 
> 标签：sql, database-design, sql-server-2008, temporal, temporal-database

您将如何表示 SQL 中的[时间](http://en.wikipedia.org/wiki/Temporal_database)多对多关系？在非临时情况下，可以使用[连接表](http://en.wikipedia.org/wiki/Junction_table)（又名链接/桥梁/地图）来连接两侧。

添加时间跟踪是否像在联结表上包含 ValidStart 和 ValidEnd 列一样简单？如果你这样做了，你遇到了什么问题（如果有的话）？有没有更好的方法来跟踪这种关系随时间的变化？

如果它有帮助，在我的情况下，我专门使用 SQL 2008 并且时间数据不是[双时间](http://en.wikipedia.org/wiki/Bitemporal)的，因为我只跟踪有效时间。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-05T18:27:52.073

我正在做一个项目（几年来），它同时使用时间数据和时间多对多关系。每个表都有 ValidFrom 和 ValidUntil 列（仅存储日期）。

首先，您必须定义 Valid* 列的语义，即 ValidUntil 是包含在有效范围内还是排除在有效范围之外。您还需要指定 NULL 日期是否有效以及它们的含义。

接下来，您需要几个函数，例如 dbo.Overlaps2() 和 dbo.Overlaps3() 分别接收 2 个和 3 个日期范围，如果日期范围重叠则返回 1，否则返回 0。

最重要的是，我使用 dbo.Overlap3(...)=1 定义了多对多关系的视图。

还有一点是有一组函数，可以根据 2 或 3 个相关表中的日期计算有效有效范围。

最近我不得不添加功能以允许用户显示所有可用数据，或仅显示当前有效的数据。我将此设置保存在用户表中，在打开连接时将 SPID 与用户关联，并在另一组视图中过滤记录。

# batch-file - 如何将文件名附加到批处理文件中的当前目录？

> ID：517106
> 
> 赞同：1
> 
> 时间：2009-02-05T18:07:55.653
> 
> 标签：batch-file, directory, append

我想在当前运行批处理的目录中搜索一个文件，将文件名附加到目录中，并将整个目录作为命令的一部分包含在内。

所以.....

目录：
C:\tempfiles\batch

C:\tempfiles\batch 中的文件 tmp1.txt tmp2.txt tmp3.txt anyname.exe

我希望从目录运行的批处理文件找到任何 .exe 文件并将其附加到目录名称，然后使用该新字符串作为命令的一部分将 .exe 文件复制到另一个目录。该命令最终将如下所示（FILETRANSFESW.exe 是也在该目录中的文件传输软件）：

C:\tempfiled\batch> FILETRANSFESW.exe "%CD%\tmp4.exe" X:\dest

.exe 文件名将发生变化，因此我每次运行批处理文件时都需要将新文件名动态添加到上述命令中。有任何想法吗？？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T18:14:11.617

如果我正确阅读了您的问题，使用“for”关键字就足够了吗？

`for %a in (*.exe) do FILETRANSFERSW.exe %a X:\dest`

你可以用一些无害的东西来测试输出，比如：

`for %a in (*.exe) do echo [[%a]]`

%a 最终遍历当前目录中的 *.exe，返回每个文件的完整文件名。

# sql - 为什么 sql 查询会有“where 1 = 1”

> ID：517107
> 
> 赞同：10
> 
> 时间：2009-02-05T18:08:06.603
> 
> 标签：sql, where-clause

我正在处理一些我正在维护的查询，并且一个程序员向我输入了“1 = 1”的查询，这似乎总是评估为真。

这有好处吗？

**重复：** [为什么有人会在 SQL 子句中使用 WHERE 1=1 AND？](https://stackoverflow.com/questions/242822/why-would-someone-use-where-11-and-conditions-in-a-sql-clause)

这个问题不是这个问题的答案。

Where-子句：

```
select * from table where 1=1 and sStatus not in ('status1','status2','status3') 
```

无需编程或 if 语句将 and 推入其中。直接查询。

如果您可以取消关闭它，我想知道是否有目的，以便我可以重写并删除 1=1 如果没有必要。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-05T18:09:17.273

是动态查询吗？有时这在基于可选参数构建动态查询时很有帮助。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-02-05T18:15:14.360

If you automatically want to add restrictions to your query, it makes your life easier:

```
string sql = "SELECT * FROM table WHERE 1=1";

if (someflag) {
  sql += " AND valid = 1";
}

if (someotherflag) {
  sql += " AND special = 1";
}

execute(sql); 
```

Without `WHERE 1 = 1` you would in each case have to check if it's the first restriction you add (and then use `WHERE ...`) or if you already added some other restriction before (and then add `AND ...`).

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-02-05T18:13:45.313

如果您正在动态构建 where 子句，您可能会有点懒惰并假设您添加的每个子句都可以以“AND”为前缀，例如

```
$str="select foo from bar where 1=1";

if ($filter1)
{
    $str.=" and col1='frobozz'";
} 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-05T18:12:45.270

当我在做一些惰性编程时，我将它用于动态 where 子句，并且不想总是检查子句是否为空以确定我现在是否需要在动态子句之间使用“AND”。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-05T18:13:08.450

这仅在动态查询中才有意义。如果您在循环中添加参数，而不必检查是否已经存在 WHERE，您可以每次都附加 AND Column = Value。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-05T18:10:42.760

我已经看到了两个原因，当你总是想要一个真实的结果，或者当语句中附加任意数量的“and condition = value”时

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-05T18:13:47.793

That is very interesting... The WHERE clause contains nothing but 1=1? I have seen this frequently in SQL injection attempts in which the WHERE clause is set to `xyz="something" OR 1=1;` as a means to always return a list of results.

Can you tell us more about what is going on with this query so we might be able to answer the question better?

*   Nicholas

# lisp - yacc 中的 Lisp 语法

> ID：517113
> 
> 赞同：21
> 
> 时间：2009-02-05T18:08:58.133
> 
> 标签：lisp, grammar, yacc

我正在尝试构建 Lisp 语法。容易，对吧？显然不是。

我提出这些输入并收到错误...

```
( 1 1)
23 23 23 
ui ui 
```

这是语法...

```
%%
sexpr: atom                 {printf("matched sexpr\n");}
    | list
    ;
list: '(' members ')'       {printf("matched list\n");}
    | '('')'                {printf("matched empty list\n");}
    ;
members: sexpr              {printf("members 1\n");}
    | sexpr members         {printf("members 2\n");}
    ;
atom: ID                    {printf("ID\n");}
    | NUM                   {printf("NUM\n");}
    | STR                   {printf("STR\n");}
    ;
%% 
```

据我所知，我需要一个定义为程序的非终端，整个解析树都可以挂在上面。但我试过了，它似乎没有用。

编辑 - 这是我的“顶级终端”方法：

```
program: slist;

slist: slist sexpr | sexpr; 
```

但它允许出现以下问题：

```
( 1 1 
```

Edit2: FLEX 代码是...

```
%{
    #include <stdio.h>
    #include "a.yacc.tab.h"
    int linenumber;
    extern int yylval;
%}
%%
\n                         { linenumber++; }
[0-9]+                     { yylval = atoi(yytext); return NUM; }
\"[^\"\n]*\"               { return STR; }
[a-zA-Z][a-zA-Z0-9]*       { return ID; }
.
%% 
```

过度匹配的一个例子......

```
(1 1 1)
NUM
matched sexpr
NUM
matched sexpr
NUM
matched sexpr
(1 1
NUM
matched sexpr
NUM
matched sexpr 
```

这里有什么错误？

编辑：错误在词法分析器中。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-05T18:46:04.873

Lisp 语法不能表示为上下文无关语法，yacc 也无法解析所有的 lisp 代码。这是因为 lisp 功能，例如读取评估和可编程阅读器。因此，为了读取任意 lisp 代码，您需要运行完整的 lisp。这不是一些晦涩的、未使用的功能，而是实际使用的。例如，CL-INTERPOL、CL-SQL。

如果目标是解析 lisp 的一个子集，那么程序文本就是一个 sexprs 序列。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-06T13:22:40.330

错误确实在词法分析器中。你的括号最终是最后一个“。” 在词法分析器中，并且不会在解析器中显示为括号。

添加规则如

```
\)     { return RPAREN; }
\(     { return LPAREN; } 
```

到词法分析器，并在解析器中将所有出现的 '(', ')' 分别更改为 LPAREN 和 RPAREN。（此外，您需要在定义令牌列表的位置#define LPAREN 和 RPAREN）

注意：我不确定语法，可能是反斜杠错误。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-05T18:29:02.897

您是正确的，因为您需要定义一个非终端。那将被定义为一组 sexpr。我不确定 YACC 的语法。对于解析器生成器，我偏爱[ANTLR](http://www.antlr.org/)，语法为：

```
program: sexpr* 
```

表示 0 个或多个 sexpr。

使用 YACC 语法更新：

```
program :  /* empty */
        | program sexpr
        ; 
```

不在 YACC 中，但无论如何可能会有所帮助，这是 ANTLR v3 中的完整语法，适用于您描述的情况（不包括词法分析器中的字符串，因为它对本示例并不重要，也使用 C# 控制台输出，因为这是我测试过的):

```
program: (sexpr)*;

sexpr: list
    |  atom            {Console.WriteLine("matched sexpr");}
    ;

list:     
   '('')'              {Console.WriteLine("matched empty list");}
   | '(' members ')'   {Console.WriteLine("matched list");}

    ;

members: (sexpr)+      {Console.WriteLine("members 1");};

atom: Id               {Console.WriteLine("ID");}
    | Num              {Console.WriteLine("NUM");}
    ;

Num: ( '0' .. '9')+;
Id: ('a' .. 'z' | 'A' .. 'Z')+;
Whitespace : ( ' ' | '\r' '\n' | '\n' | '\t' ) {Skip();}; 
```

这不会像在 YACC 中那样工作，因为 YACC 生成和 LALR 解析器，而 ANTLR 是修改后的递归下降。如果您想这样做，ANTLR 有一个 C/C++ 输出目标。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-06T13:48:10.873

您是否需要一个 yacc/bison 解析器？“读取 lisp 语法的子集”阅读器在 C 中并不难实现（从 read_sexpr 函数开始，当你看到一个 '(' 时分派到一个 read_list，然后构建一个包含的 sexprs 的列表，直到一个 ' )' ；否则，调用一个 read_atom 来收集一个原子并在它不能再读取原子组成字符时返回它）。

但是，如果您希望能够阅读任意 Common Lisp，则需要（最坏的情况）实现 Common Lisp，因为 CL 可以修改阅读器运行时（甚至在不同的读取表运行时之间切换在程序控制下；当您想要加载用另一种语言或 lisp 方言编写的代码时非常方便）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-05T18:32:33.653

自从我与 YACC 合作以来已经很长时间了，但是您确实需要一个顶级的非终端。您能否更具体地说明“尝试过”和“它似乎没有用”？或者，就此而言，错误是什么？

我还怀疑 YACC 对于这种语法轻量级的语言来说可能是矫枉过正。更简单的东西（如递归下降）可能会更好。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-05T18:49:07.037

你可以在这里试试[这个语法](http://ragnermagalhaes.blogspot.com/2007/08/bison-lisp-grammar.html)。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-02-24T19:04:40.677

我刚试过，我的“yacc lisp 语法”工作正常：

```
%start exprs

exprs:
    | exprs expr
    /// if you prefer right recursion :
    /// | expr exprs
    ;

list:
    '(' exprs ')'
    ;

expr:
    atom
    | list
    ;

atom:
    IDENTIFIER
    | CONSTANT
    | NIL
    | '+'
    | '-'
    | '*'
    | '^'
    | '/'
    ; 
```

# asp.net-mvc - 为什么 ASP.NET MVC 中有设计器文件 (*.designer.cs)？

> ID：517114
> 
> 赞同：0
> 
> 时间：2009-02-05T18:09:07.663
> 
> 标签：asp.net-mvc, web-applications

ASP.NET MVC Web 应用程序中自动生成的“设计器”文件有什么意义？

我正在尝试 ASP.NET MVC（来自 ASP.NET Webforms 项目），所以我习惯于每个 ASP.NET 标记文件（.aspx、.ascx 等）只有一个代码文件。我可以将模型旁边的代码与 MVC 应用程序一起使用，因为更少的文件看起来更简单吗？

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-05T18:12:15.893

Designer.cs 文件是[Web 应用程序项目](http://webproject.scottgu.com/CSharp/UnderstandingCodeBehind/UnderstandingCodeBehind.aspx)（MVC 是其衍生项目）的保留。除了文件背后的常规代码，[最新的 MVC RC 不再需要它们](http://weblogs.asp.net/scottgu/archive/2008/12/19/asp-net-mvc-design-gallery-and-upcoming-view-improvements-with-the-asp-net-mvc-release-candidate.aspx)。

# xml - 动态 xsd 和 Biztalk 2006

> ID：517125
> 
> 赞同：1
> 
> 时间：2009-02-05T18:10:49.563
> 
> 标签：xml, dynamic, xsd, biztalk

我是一个 biztalk 新手，我们在这里运行 2006，并计划在未来迁移到 2006 R2。我有一个需要使用的架构，称为 Siri，它在以下位置公开：

~~[根 xsd 文档的链接文本](http://www.kizoom.com/standards/siri/schema/1.0/siri-1.0.zip)~~或~~[链接文本](http://www.kizoom.com/standards/siri/schema/1.0/siri.xsd)~~。

我已经成功地将这个模式导入到我的 biztalk 项目中，但是，我发现很难理解如何使用它，因为这个 xsd 模式都是 xsd:choice 和 xsd:group 节点。根元素也只有一个目标命名空间。

我的项目是消耗估计的公交车时间表，然后将这些数据插入数据库表中。在使用 Biztalk 中的模式后，我发现很难提升元素以过滤和创建/使用映射（还没有真正做到这一点）。

任何人都可以在某些文档/网站中指出我正确的方向，或者基本上我应该如何处理这个问题？有没有人在 biztalk 2006 中使用过这样的模式？如果有，你是如何处理消息映射、从 xml 检索数据并插入数据库的？如果有人想看看，我可以发布一个示例 xml 有效负载。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-20T12:00:47.750

像这样的架构绝对适用于 BizTalk，但毫无疑问，它可能需要更多的努力和对 XSD 的一些很好的理解。

我认为，除了阅读一两本关于 BizTalk 的好书，这总是有帮助的（而且有几本很好的书）之外，你可以在 Biztalk 特定论坛和新闻组以及这里获得很多帮助，如果你发布具体问题，因为很难描述物业促销或映射的整体解决方案。

还有一件事要考虑，尽管非常小心，那就是不要直接使用他们的模式。

[试图]定义标准的模式必须非常通用；这通常会通过扩展点导致复杂性和多样性，从而使开发和维护变得困难。

如果您能够从该架构派生出一个仅描述您期望获得的有效结构的架构（这可能是标准可以支持的一小部分），您最终可能会得到一个更小更简单的架构。

优点是更容易开发和维护，缺点是如果您需要支持更多原始模式，则必须更改模式并重新部署。此外 - 如果您想迁移到新版本的标准，您可能会让您的生活变得更加艰难，尽管无论如何都可能是这种情况

希望hekos

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T10:24:56.850

有多少方正在向您提供输入文件？是否可以关联传入方，然后为每个方提供更多预定义的映射？

当然，您也可以在 Choice/Group 元素上执行 If/Else 并相应地映射。

*   或上述两种策略的混合。

你可以给我一个样本输入文件吗？

祝你好运！

# python - 如何在控制台上的同一位置写入输出？

> ID：517127
> 
> 赞同：186
> 
> 时间：2009-02-05T18:11:47.907
> 
> 标签：python, console-output

我是 python 新手，正在编写一些脚本来自动从 FTP 服务器等下载文件。我想显示下载的进度，但我希望它保持在相同的位置，例如：

输出：

> 下载文件 FooFile.txt [47%]

我试图避免这样的事情：

```
 Downloading File FooFile.txt [47%]
     Downloading File FooFile.txt [48%]
     Downloading File FooFile.txt [49%] 
```

我该怎么做呢？

* * *

**重复**： [如何在命令行应用程序中打印当前行？](https://stackoverflow.com/questions/465348/how-can-i-print-over-the-current-line-in-a-command-line-application/465360#465360)

* * *

## 回答 #1

> 赞同：276
> 
> 时间：2009-02-05T18:22:47.683

您还可以使用回车符：

```
sys.stdout.write("Download progress: %d%%   \r" % (progress) )
sys.stdout.flush() 
```

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2009-02-05T19:29:23.197

# 蟒蛇2

我喜欢以下内容：

```
print 'Downloading File FooFile.txt [%d%%]\r'%i, 
```

演示：

```
import time

for i in range(100):
    time.sleep(0.1)
    print 'Downloading File FooFile.txt [%d%%]\r'%i, 
```

# 蟒蛇 3

```
print('Downloading File FooFile.txt [%d%%]\r'%i, end="") 
```

演示：

```
import time

for i in range(100):
    time.sleep(0.1)
    print('Downloading File FooFile.txt [%d%%]\r'%i, end="") 
```

# 带有 Python 3 的 PyCharm 调试器控制台

```
# On PyCharm Debugger console, \r needs to come before the text.
# Otherwise, the text may not appear at all, or appear inconsistently.
# tested on PyCharm 2019.3, Python 3.6

import time

print('Start.')
for i in range(100):
    time.sleep(0.02)
    print('\rDownloading File FooFile.txt [%d%%]'%i, end="")
print('\nDone.') 
```

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2009-02-05T18:19:09.313

使用像[curses 模块](http://docs.python.org/library/curses.html)这样的终端处理库：

> curses 模块提供了curses 库的接口，curses 库是便携式高级终端处理的事实标准。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2009-02-05T18:14:06.297

`\b`多次打印退格字符，然后用新号码覆盖旧号码。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2017-08-24T23:28:23.337

对于 Python 3xx：

```
import time
for i in range(10):
    time.sleep(0.2) 
    print ("\r Loading... {}".format(i)+str(i), end="") 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2011-11-02T04:14:27.630

```
#kinda like the one above but better :P

from __future__ import print_function
from time import sleep

for i in range(101):
  str1="Downloading File FooFile.txt [{}%]".format(i)
  back="\b"*len(str1)
  print(str1, end="")
  sleep(0.1)
  print(back, end="") 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2017-05-10T06:32:56.117

一个对我有用的巧妙解决方案是：

```
from __future__ import print_function
import sys
for i in range(10**6):
    perc = float(i) / 10**6 * 100
    print(">>> Download is {}% complete      ".format(perc), end='\r')
    sys.stdout.flush()
print("") 
```

这`sys.stdout.flush`很重要，否则它会变得非常笨重，并且`print("")`for 循环退出也很重要。

**更新**：正如评论中提到的，`print`也有一个`flush`论点。因此，以下内容也将起作用：

```
from __future__ import print_function
for i in range(10**6):
    perc = float(i) / 10**6 * 100
    print(">>> Download is {}% complete      ".format(perc), end='\r', flush=True)
print("") 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-03-03T17:21:14.523

```
x="A Sting {}"
   for i in range(0,1000000):
y=list(x.format(i))
print(x.format(i),end="")

for j in range(0,len(y)):
    print("\b",end="") 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-05-02T09:59:33.610

在 python 3 中，函数[print](https://docs.python.org/3/library/functions.html#print)可以获取许多参数。函数 print 的完整签名是： `print(args*, sep=' ', end='\n', file=sys.stdout, flush=False)`

when`sep`是参数的分隔符`args*`，`end`是如何结束打印行（'\n\ 表示新行）文件是打印输出的位置（stdout 是领事），flush 是是否清理缓冲区。

### 使用示例

```
import sys

a = 'A'
b = 0
c = [1, 2, 3]

print(a, b, c, 4, sep=' * ', end='\n' + ('-' * 21), file=sys.stdout, flush=True) 
```

### 输出

```
A * 0 * [1, 2, 3] * 4
--------------------- 
```

在 python 中，有很多方法可以格式化字符串，甚至是内置的格式化字符串类型。

# 如何格式化字符串

1.  [`format()`](https://docs.python.org/3/library/stdtypes.html?highlight=str%20format#str.format)功能。（[一些例子](https://docs.python.org/3/library/string.html?highlight=f%20string#format-examples)）
2.  格式化字符串文字或通用名称[f-strings](https://docs.python.org/3/tutorial/inputoutput.html#formatted-string-literals)。
3.  使用 % 格式化（[更多关于这个](https://docs.python.org/3/library/stdtypes.html#printf-style-string-formatting)）

### 例子

```
name = 'my_name'

>>> print('my name is: {}'.format(name))
my name is: my_name

# or
>>> print('my name is: {user_name}'.format(user_name=name))
my name is: my_name

# or
>>> print('my name is: {0}'.format(name))
my name is: my_name

# or using f-strings
>>> print(f'my name is: {name}')
my name is: my_name

# or formatting with %
>>> print('my name is: %s' % name)
my name is: my_name 
```

# javascript - 使用 jquery 可拖放/可拖放设置放置变量

> ID：517137
> 
> 赞同：0
> 
> 时间：2009-02-05T18:12:47.687
> 
> 标签：javascript, jquery, jquery-ui

我正在研究使用 jquery ui 可拖放/可拖放的概念证明。

我正在寻找一种方法来设置一个变量，该变量等于放入可放置区域的 div 的索引。（假设我有名为“div0”、“div1”、“div2”等的 div……）

所以想象一下代码看起来像这样：

```
<div id="div0" class="draggableDiv">some cotent</div>
<div id="div1" class="draggableDiv">more content</div>
<div id="div2" class="draggableDiv">yet more content</div>

<div class="droppableDiv">drop it here</div>

$(document).ready(function() {
    $('.draggableDiv').draggable({helper: 'clone'});
    $('.droppableDiv').droppable({
        accept: '.draggableRecipe',
        drop: function(ev, ui) { 
            ui.draggable.clone().fadeOut("fast", 
            function() { 
                $(this).fadeIn("fast") 
            }).appendTo($(this).empty());
                        // function to set someVar = div[index];
        }
    });
}); 
```

我不确定如何最好地做到这一点，所以如果有人有任何建议，我会很感激一些指导。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-06T06:45:31.927

```
<div id="div0" class="draggableDiv">some cotent</div>
<div id="div1" class="draggableDiv">more content</div>
<div id="div2" class="draggableDiv">yet more content</div>

<div id='dropplace' class="droppableDiv">drop it here</div>

<script language='javascript'>

$(document).ready(function() {
    $('.draggableDiv').draggable({helper: 'clone'});
    $('.droppableDiv').droppable({
        accept: '.draggableDiv', //changed this, it was originally 'draggableRecipe'
        drop: function(ev, ui) { 

                //get the index of dropped draggable div
                var divIndex = $('div').index(ui.draggable)
                alert(divIndex) //alert the divIndex to see the result

                ui.draggable.clone().fadeOut("fast", 
                function() { 
                        $(this).fadeIn("fast") 
                }).appendTo($(this).empty());
        }
    });
});
</script> 
```

测试了这个，它对我有用，希望对你也有用。祝你好运

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-04-08T04:46:13.567

在行后 `drop: function(ev, ui) {` 添加：

```
var droppedId = ui.draggable.attr("id"); 
```

之后`droppedId`将是您的`div0`,`div1`或`div2`- 之一，具体取决于哪个被丢弃。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T18:18:19.593

您应该能够使用解析 div 的 id

```
$.droppedItems = {};

var droppedId = $(this).attr('id').replace('droppable', '');
$.droppedItems[droppedId] = ui.draggable.attr('id').replace('div', ''); 
```

# arrays - 对多个布尔值使用数组或位访问是否更快？

> ID：517138
> 
> 赞同：1
> 
> 时间：2009-02-05T18:12:54.037
> 
> 标签：arrays, boolean

1) 在 32 位 CPU 上，访问 32 个布尔值的数组还是访问一个字中的 32 位更快？（假设我们要检查第 N 个元素的值，并且可以使用位掩码（设置第 N 位）或整数 N 作为数组索引。）

在我看来，数组会更快，因为所有常见的计算机体系结构本身都在字级别（32 位、64 位等，并行处理）工作，并且访问子字位需要额外的工作。

我知道不同的编译器会以不同的方式表示事物，但似乎底层硬件架构会决定答案。还是答案取决于语言和编译器？

并且，2）如果这个数组代表我在客户端和服务器之间传递的状态，速度答案是否会反转？[阅读问题“如何使用位/位运算符控制对象状态？](https://stackoverflow.com/questions/516646/how-use-bit-bit-operator-to-control-object-state) ”时想到了这个问题

PS 是的，我可以自己编写代码来测试它，但是 SO 社区将无法参与其中！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-05T18:35:21.947

请记住，不适合缓存行的理论上更快的解决方案可能比理论上更慢的解决方案要慢，这取决于很多事情。如果这实际上是需要快速的东西，由分析确定，测试两种方式并查看。如果没有，请执行任何看起来更简洁的代码，这可能是数组。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-05T18:54:07.447

这取决于编译器、访问模式和平台。Raymond Chen 有出色的成本效益分析：http: [//blogs.msdn.com/oldnewthing/archive/2008/11/26/9143050.aspx](http://blogs.msdn.com/oldnewthing/archive/2008/11/26/9143050.aspx)。

即使在非 x86 平台上，位的使用也可能令人望而却步，因为至少有一个 PPC 平台使用微编码指令来执行可变移位，这可能会与其他硬件线程一起做讨厌的事情。

所以这可能是一场胜利，但你需要了解它的好与坏的背景。（无论如何，这是普遍的事情。）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-05T18:19:55.550

对于问题 #1：是的，在大多数 32 位平台上，布尔值数组应该更快，因为您只需加载数组中的每个 32 位对齐值并针对 0 进行测试。如果您使用单个一句话，您将拥有所有这些工作以及摆弄位的开销。

对于问题 #2：同样，是的，因为通过网络发送数据比在 CPU 和主内存中操作数据要慢得多，发送一个字的开销将大大超过通过对齐字或对齐获得的任何性能增益或损失有点摆弄。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T18:51:11.103

这是由 0 != (value & (1 << index)) 生成的代码来测试一下：

```
00401000  mov         eax,1 
00401005  shl         eax,cl 
00401007  and         eax,1 
```

这通过 values[index] 来测试一个 bool[]：

```
00401000  movzx       eax,byte ptr [ecx+eax] 
```

无法弄清楚如何在它周围放置一个没有得到优化的循环，我会投票 bool[]。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-05T18:18:54.587

如果您要一次检查多个值，并行执行显然会更快。如果您只检查一个值，它可能是相同的。

如果您需要比这更好的答案，请编写一些测试并回复我们。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-11-16T13:22:56.103

我认为对于简单的随机访问，字节数组可能比全字数组更好。

与使用完整字长相比，它会提供更好的缓存局部性，而且我*认为*字节访问在大多数/所有常见架构上都不会变慢。

# delphi - Delphi7中的XPath？

> ID：517145
> 
> 赞同：5
> 
> 时间：2009-02-05T18:14:02.833
> 
> 标签：delphi, delphi-7

在 Delphi7 中使用 XPath 搜索 XML 文档的最佳方法是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-05T18:40:53.263

这取决于 xml 文档的大小。但我对 MSXML 及其撒克逊对应物都有很好的经验。

如果 xml 很大（>50 MB）或查询很重（使用一些 // 使您的系统爬网）预计会有一些延迟时间。但否则它是完全可行的。

在更高版本中，msxml 可作为一个单元使用。在版本 7 中，您需要安装类型库：

*   转到项目\导入类型库
*   选择 Microsoft XML，（你能找到的最高版本）
*   选择创建单元以创建 MSXML_TLB

您可以使用 MSXML_TLB 读取 xml 文档，使用 xslt 并执行 xpath 查询：

```
var
  doc  : IXMLDomDocument2;
  list : IXMLDomNodeList;
  node : IXMLDomNode;
  i    : Integer;

begin
  doc := CoDOMDocument.Create;
  doc.load(xmlfilename); 

  list := doc.selectNodes(xpath);
  for i := 0 to list.length-1 do begin
    node := list.item[i];
    if node<>nil then
      Memo1.Lines.Add(node.nodeName);
  end;
end; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-17T21:01:48.347

当我必须在 Delphi 中处理 XML 文件时，我总是使用[OmniXML](http://www.omnixml.com/)，这是我多年来一直在使用的组件。我对它非常满意，主要是因为它轻巧、易于使用且**免费**。

它也可以轻松地与 XPath 一起使用。值得一试，希望对你也有帮助。

# sql - 用户授予对存储过程的访问权限但无法运行查询

> ID：517152
> 
> 赞同：1
> 
> 时间：2009-02-05T18:14:57.807
> 
> 标签：sql, sql-server, stored-procedures, database-permissions, grant

我正在开发一种运行 SQL 服务器的产品，该服务器允许一些应用程序登录，并且他们的登录被授予运行存储过程的权限——而不是其他任何东西。存储过程归管理员所有；存储过程接受一个查询并执行它，然后将结果返回给应用程序。

不幸的是，我无法弄清楚为什么应用程序可以调用它被授予访问权限的存储过程，但是存储过程不能执行传递给它的 SQL 语句。

当我以管理员身份登录时，存储过程会执行传入的查询，但是当我以受限用户身份登录时，它会在执行语句中引发异常。

例如：

```
EXEC [Admin].[STORED_PROC] @SQL_STATEMENT = 'SELECT * FROM table_x' 
```

STORED_PROC 看起来像这样：

```
BEGIN TRY
   EXEC (@SQL_STATEMENT)
END TRY
BEGIN CATCH
   -- some logging when an exception is caught, and the exception is caught here!!!
END CATCH 
```

try catch 语句中没有任何内容，除了 EXEC... 和 SQL_STATEMENT 在我以管理员身份登录时有效，但在我以用户身份登录时无效。

谁能帮我弄清楚我需要设置哪些权限才能允许用户仅通过存储过程运行查询？

* * *

所以有一些关于允许通过存储过程执行原始 SQL 语句的评论违背了使用存储过程的目的......但实际上我们实际上正在做的是将加密的 SQL 语句传递到存储过程中并且存储的过程将语句解密，然后执行它。

所以是的，实际上原始 SQL 语句并不安全，它们破坏了存储过程的目的，但我不知道如何加密通过 ODBC 传递并针对 2005 年之前的 SQL Server 运行的 SQL 查询。

无论如何，我尝试设置一些最低限度的保护措施，以至少具有一些基本的安全性。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-05T18:19:55.910

由于您使用的是动态 sql，SQL Server 无法判断您使用的是哪些表，因此您还必须授予所有表的 SELECT 权限

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-05T18:17:55.023

用户还需要对表进行 SELECT 授权

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-05T18:22:40.303

允许将原始 SQL 传递到存储过程然后执行是数据不安全的本质。

SQL Server 安全性是结构化的，以便 SQL 的任意位在它们自己的安全上下文中执行。如果您没有运行临时查询的权限，那么您也没有通过存储过程运行它的权限。在这方面，SQL Server 将您从自己手中拯救出来。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T19:03:05.793

由于您的系统允许访问存储的过程而没有其他任何内容（这对安全性有好处并且不应更改），那么您在任何情况下都不能使用动态 SQL，因为权限不在表级别并且您的 dbas 不太可能更改那。这不仅是为了防止 SQL 注入攻击，而且是为了防止可能的内部欺诈，因此任何认为这很重要的工作场所都不会为了让您的生活更轻松而做出妥协。您只需要重新设计就不会动态地做任何事情。你别无选择。如果您首先编写 proc 来执行您希望它执行的操作，则无需发送加密的 sql。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-05T19:06:28.187

当通过SP`EXEC`或`sp_executesql`在 SP 内使用动态 SQL 时，SP`EXEC`上的权限不允许您在动态 sql 中运行任意代码。您要么需要授予`SELECT`(yuck)，要么您可以使用`EXECUTE AS`或冒充另一个用户`SETUSER`。

使用普通 SQL 时，`EXEC`权限工作正常，覆盖未授予的`SELECT`权限。不过，如果你有`DENY`，我相信它胜过它。

话虽如此，我仍然不确定`EXECUTE AS`当 SQL 的源在 SP 之外（或数据库之外）**时应该使用。**对于不受外界影响的代码生成或动态 sql，`EXECUTE AS`可能是一个有用的工具

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-05T20:47:15.037

这很可能是因为不同的模式，即登录的用户不是管理员模式的一部分，或者至少我希望不是。

允许您希望实现的访问类型的安全技术，即允许访问由相同模式拥有的对象，称为所有权链接。

这个原则在帖子中没有得到最好的解释。

这是来自 Microsoft 的链接，它解释了这个概念。

[http://msdn.microsoft.com/en-us/library/ms188676(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms188676(SQL.90).aspx)

这是一篇关于安全性的优秀文章，它提供了所有权链接以及其他技术的示例和演练。

[http://www.sommarskog.se/grantperm.html](http://www.sommarskog.se/grantperm.html)

我希望这很清楚并对您有所帮助，但请随时提出进一步的问题。

干杯，约翰

# c# - 在 VB.NET 应用程序中使用服务的最佳方式是什么？

> ID：517157
> 
> 赞同：0
> 
> 时间：2009-02-05T18:16:02.500
> 
> 标签：c#, vb.net, windows-services, service

我正在使用 VB 9 (VS2008)。

我想知道如何通过 Windows 窗体应用程序来控制 Windows 服务。

我想知道：

1.  如何确定服务的状态？
2.  如何更改服务的启动类型？
3.  如何启动、停止、暂停和恢复服务？

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-05T18:27:17.580

框架类[ServiceController](http://msdn.microsoft.com/en-us/library/system.serviceprocess.servicecontroller.aspx)允许您做所有这些事情。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T18:20:11.510

~~我很确定（除非他们最近改变了东西）你必须通过 p/invoke 或通过 WMI 来做到这一点。~~

哇，我怎么忘了那堂课。

# terminology - 只能出现一次的事物的规范术语？可以多次发生的事情？

> ID：517163
> 
> 赞同：1
> 
> 时间：2009-02-05T18:16:42.780
> 
> 标签：terminology

我真的很讨厌我给我的课程起什么名字，我需要一个形容词来形容只允许发生一次的事情，以及允许发生多次的事情。

例子：

*   *意思是它只能发生一次的*词
*   *意味着它可以发生多次*触发的词

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-05T18:27:19.077

OneShotTrigger 和 RecurringTrigger

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-05T18:27:47.440

一次：[nonce](http://en.wikipedia.org/wiki/Nonce)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T18:27:15.193

OneShotTrigger 可
重复触发器

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T18:27:26.207

怎么样

*   单触发
*   复数触发器

另外，我不认为这正是你所得到的，但这可能与[Idempotence](http://en.wikipedia.org/wiki/Idempotent)有关。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-05T18:46:38.493

舌头在脸颊上如此轻微，怎么样：

*   BirthTrigger - 你只出生一次。
*   生日触发 - 但你可以有很多生日

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-05T19:08:48.150

单触发器多
触发器

-亚当

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-05T18:19:37.080

我通常将“OneTime”用于单次拍摄，而对于多次拍摄则没有什么特别的。虽然它不是真正的规范...

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-05T18:22:06.840

一次触发，多次触发

一个触发器，许多触发器

此外，有时我只是不命名一个（一次或多次）并命名另一个（一次或多次）以使其脱颖而出。也许你可以在一个的末尾加上一个“s”而不是另一个。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-05T18:25:55.587

我只使用“OneTime”。也许这是一个扑克的事情。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-05T18:36:10.247

您可以称它们为[WyclefJeanTrigger](http://www.youtube.com/watch?v=Vl8DEwRZUK0)和[TimMcGrawTrigger](http://www.youtube.com/watch?v=temaoKXSVxw)。;-)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-05T18:54:48.350

单数或一次

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-05T19:01:44.953

SingleShot 和Repeating 是常用的。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-05T19:09:18.183

单
时触发器多时触发器

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-01-03T14:55:18.703

我知道这是一篇旧帖子，但我有一个尚未提及的建议。

作为一对

```
UnrepeatableTrigger
RepeatableTrigger 
```

运作良好。

不过，就像微软一样，当使用注册表来确保事情在启动时只发生一次时，他们使用术语 RunOnce。

所以瞬间，我会认出

```
RunOnceTrigger 
```

作为更易于维护和清晰的东西

```
OnceTrigger 
```

`OneShotTrigger`几乎听起来很绝望“我们只有一次机会，如果失败了，我们就会在没有桨的情况下上岸”。

`Monochronic and Polychronic`正如这里提到的，似乎不相关。

> 单时和多时系统是用于指代时间及其对社会的影响的两个术语。
> 
> 单时时间系统意味着一次做一件事情，时间被分割成精确的小单位。

这是其他一些形容词。我特别喜欢`Unrepeatable`只是因为听起来你在谈论家庭禁忌或伏地魔。

[http://www.macmillandictionary.com/thesaurus-category/american/Happening-only-once](http://www.macmillandictionary.com/thesaurus-category/american/Happening-only-once)

# c# - 在 C# 中启动外部应用程序时要线程还是不线程

> ID：517166
> 
> 赞同：2
> 
> 时间：2009-02-05T18:16:48.537
> 
> 标签：c#, multithreading, external-process

我正在创建一个监视 ftp 日志的 win 服务，当文件上传后，我想启动一个外部应用程序，如 powershell 脚本，对文件进行处理。我的问题是我想在执行此操作时将其转入另一个线程，还是应该等到它完成后再继续。

这个过程已经在一个线程中（该服务将监视多个服务器），线程启动线程的想法让我担心。这是要担心的事情，还是我帽子里的锡纸太多了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T18:19:44.350

好吧，以模块化方式对其进行编码，而不必担心线程。如果在未来，您发现您的应用程序将受益于多线程方法，那么请解决它。如果您已正交构建组件，则螺纹部分将更自然地适合。

在应用程序的一开始就解决线程问题对我来说总是过早的优化。先构建组件，然后再考虑如何线程化它们。

[编辑] 我绝不建议你不要考虑线程。每个组件都需要构建有可能被多个线程使用 - 这是所有应用程序中的一种防御性和智能实践。我的意思是不要太担心应用程序将如何处理线程以及如何首先设置应用程序的线程管理。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T18:19:49.887

我认为更重要的问题是你从产生另一个线程中得到什么？如果您不需要让代码并行执行，请不要这样做。如果你这样做，应该没有问题。如果您关心子线程创建自己的线程，则将线程创建委托给`ThreadPool`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T18:21:37.873

首要问题：你需要知道这个过程的结果吗？如果你能开枪就忘记，那就这样做——这更容易。如果你需要结果，那就等着吧。

另外，您是否考虑过使用 FileSystemWatcher？它可以远程工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T18:58:30.887

虽然有点离题，但由于您提到您将启动一个 powershell 脚本，我想指出通过 powershell“运行空间”在进程内运行脚本的选项。这是一个**最小的**例子：

```
using System.Management.Automation;
static class PoshExec
{
    static void Exec(string scriptFilePath)
    {
        (new RunspaceInvoke()).Invoke("& " + scriptFilePath);
    }
} 
```

添加对 c:\Program Files\Reference Assemblies\Microsoft\WindowsPowerShell\v1.0\System.Management.Automation.dll 的引用

# php - PHP-MySQL中SELECT的参数值编码

> ID：517201
> 
> 赞同：1
> 
> 时间：2009-02-05T18:22:22.893
> 
> 标签：php, mysql, quotes

下面的替代 A 是来自 php-mysql 教程的语句。它可以正常工作。
我发现 id-value 相当模糊并测试了 alt B。这也有效！
alt A 的 id 值有什么意义？

MySQL 5.0.51、PHP 5.2.6

```
// Alt A :  
$sql = "SELECT * FROM example WHERE id = '".$q."'";  
// Alt B :  
$sql = "SELECT * FROM example WHERE id = $q"; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T18:27:21.497

这只是从静态和可变数据构建字符串的两种不同方法。

备选方案 A 使用串联，或使用串联运算符连接字符串和变量标记。

备选方案 B 使用变量扩展，其中双引号分隔的字符串内的变量在评估时扩展为它们的值。

两者都不一定更好或首选，但如果您必须使用单引号分隔的字符串，例如，那么您将需要使用替代 A。

当然，这些*都不*比使用绑定参数构建 SQL 查询更可取，因为不这样做会使您容易受到 SQL 注入攻击。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T18:27:37.470

使用“Alt A”中的示例有两个原因。首先是如果字符串用单引号 '' 括起来，则在字符串中将使用变量的名称而不是它的值。

```
$id = 7;
'SELECT * FROM table WHERE id = $id' //works out to: WHERE id = $id
"SELECT * FROM table WHERE id = $id" //works out to: WHERE id = 7 
```

其次，将字符串与函数调用的结果结合起来很有用。

```
"SELECT * FROM table WHERE id = '".getPrimaryId()."'" 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T22:21:08.950

当 PHP 与 MySQL 通信时，它实际上（本质上）是两种语言相互通信。这意味着字符串将在发送到另一种语言之前由第一种语言处理。这也意味着*根据接收语言进行思考很重要*

在这种情况下：

```
$q = 'some_name';<br/>
$query = "SELECT * FROM exempel WHERE id = $q";<br/> 
```

你告诉 MySQL
“SELECT * FROM example1 WHERE id = some_name.

在这种情况下：

```
$q = 'some_name';<br/>
$query = "SELECT * FROM exempel WHERE id = '$q'";<br/> 
```

这种情况：

```
$q = 'some_name';<br/>
$query = "SELECT * FROM exempel WHERE id = '".$q."'";<br/> 
```

您告诉 MySQL
“SELECT * FROM example1 WHERE id = 'some_name'。

第一个示例应该会导致错误，因为 some_name 不是 MySQL 查询的有效部分（在该上下文中）。另一方面，接下来的两个将工作正常，因为 MySQL 将寻找字符串“some_name”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T22:26:14.167

你也可以这样做：

```
$sql="SELECT * FROM exempel WHERE id = {$q}"; 
```

这对于触发以下内容很有用：

```
$sql="SELECT * FROM exempel WHERE id = {$row[id]}"; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-05T18:40:34.917

除了已经说过的内容之外，我发现最好的做法是，如果我正在编写查询，请按如下方式编写：

$sql = "SELECT * FROM table WHERE uid=" 。$uid 。“限制 1”；

像这样编写 SQL 的原因是 1\. MySQL 查询不必解析 Query 中的 PHP 变量 2 您现在可以轻松读取和管理查询。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-05T18:25:15.150

在 'alt B' 中，$q 必须是 int 或 float 或其他数字

在 'alt A' 中，$q 可以是任何字符串、int 等。

单引号使这成为可能。如果您是第一次看，有时很难看到。

# vb.net - 数据绑定到引用类型

> ID：517203
> 
> 赞同：0
> 
> 时间：2009-02-05T18:22:34.483
> 
> 标签：vb.net, data-binding, orm

我有一些具有这样的属性的类，它们工作得很好，因为它们非常正常：

```
 Public Overridable Property CustomerLastName() As String
        Get
            Return m_CustomerLastName.Value
        End Get
        Set(ByVal Value As String)
            m_CustomerLastName.Value = Value
        End Set
    End Property 
```

我想将它们更改为像这样工作（不用担心 IField 是什么，只要说它代表表中的一个字段就足够了）：

```
 Public Overridable Readonly Property CustomerLastName() As IField
        Get
            Return m_CustomerLastName
        End Get
    End Property 
```

这样，您可以执行 Customer.CustomerLastName.PreviousValue 或 Customer.CustomerLastName.IsDirty 等。

但这不能正确绑定。可以理解，因为数据绑定应该是双向的，并且涉及反射等。

当然它仍然可以是一条双向街道，我只需要能够说，“Hey DataBinding！看这里！”

所以。我在这里做什么？

**注意：**现在，我要做的只是将 DataBind 绑定到 GridView 以进行显示。但我希望这是灵活的。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-05T18:32:42.780

（更新重新编辑）如果只是出于显示目的，您可能只需在实现的类上设置 ToString() 即可`IField`。

* * *

（原来的）

No - 2-way 数据绑定想要一个`INotifyPropertyChanged`，或者一个`CustomerLastNameChanged`事件。`ICustomTypeDescriptor`您可以通过实现or将其填充到自定义模型中`TypeDescriptionProvider`，但是您需要编写自己的`PropertyDescriptor`实现。

重新`IsDirty`- 这是`ShouldSerializeValue`条款`PropertyDescriptor`。

# embedded - 用于嵌入式设备的 USB - 设计设备驱动程序/协议栈

> ID：517206
> 
> 赞同：9
> 
> 时间：2009-02-05T18:22:45.170
> 
> 标签：embedded, usb, device-driver

我的任务是为嵌入式设备编写一个设备驱动程序，它将通过 SPI 接口与微控制器通信。最终，USB 接口将用于从外部下载更新的代码并在验证阶段使用。

我的问题是，有没有人知道一个好的参考设计或文档或在线教程，其中涵盖了嵌入式系统中 USB 协议栈/设备驱动程序的实现/设计？我刚刚开始阅读 650 页的 USB v2.0 规范目前有点令人生畏。

仅供参考，我使用的微控制器是飞思卡尔 9S12。

标记

根据 Goldenmean 的 (-AD) 评论，我想添加以下信息：

1) 嵌入式设备使用自定义执行程序，不使用 COTS 或 RTOS。

2) 设备将使用中断来指示数据已准备好从设备中检索。

3) 我已经阅读了一些关于 Linux 的文档，但是由于我对 Linux 一点也不熟悉，所以目前它不是很有帮助（尽管我希望它会很快）。

4) 设计方法，至少现在，它为 USB 设备编写设备驱动程序，然后 USB 协议层 (I/O) 将驻留在设备驱动程序的顶部以解释数据。我认为这将是最好的方法，尽管我可能是错的。

编辑 - 一年后

我只是想在它们从我脑海中消失之前分享一些东西，以防我再也不会在 USB 设备上工作。在开发代码并首次启动和运行时，我遇到了一些障碍。

我遇到的第一个问题是，当 USB 设备连接到主机（在我的情况下为 Windows）时，主机发出了重置请求。USB 设备将复位并清除中断使能标志。我没有阅读足够多的文献来知道这种情况正在发生，因此我从未收到设置请求中断。我花了很长时间才弄清楚这一点。

我遇到的第二个问题是没有正确处理 Set_Configuration 的设置请求。我正在处理它，但我没有正确处理请求，因为当这个设置请求进来时 USB 设备没有发送 ACK。我最终通过使用硬件 USB 协议分析器发现了这一点。

我还遇到了其他问题，但这是我花了很长时间才弄清楚的两个最大的问题。我不得不担心的另一个问题是大端和小端，分别是飞思卡尔 9S12 与 USB 数据格式（英特尔）。

我最终构建了类似于我过去所做的 UART 设备驱动程序的 USB 设备驱动程序。我已在以下 URL 上发布了代码。

[http://lordhog.wordpress.com/2010/12/13/usb-drive](http://lordhog.wordpress.com/2010/12/13/usb-drive)

我经常使用结构，因此人们可能不喜欢它们，因为它们不像使用#defines 那样具有门户（例如，MAX3420_SETUP_DATA_AVAIL_INT_REQR 0x20），但我喜欢它们，因为它使代码对我来说更具可读性。如果有人对此有任何疑问，请随时发送电子邮件，我可以尝试提供一些见解。只要您知道要专注于哪些领域，“USB Complete：开发人员指南”一书就会很有帮助。这是一个简单的应用程序，只使用了低速 USB。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-05T19:07:54.580

在为任何接口（USB、并行端口等）编写设备驱动程序时，需要开发的代码将取决于是否有任何操作系统（OS）、RTOS 在该处理器/微控制器上运行。例如，如果要运行 WinCE - 它将有自己的驱动程序开发工具包，以及在设备驱动程序开发中要遵循的步骤。对于任何其他操作系统（如 Linux、symbian）也是如此。

如果它将是控制处理器/微控制器的普通固件代码（无操作系统），那么情况就完全不同了。因此，根据您所处的上述任何一种情况，您需要阅读和理解：-

1.) 处理器/微控制器开发板的硬件规格——寄存器文件、端口、内存布局等。

2.) USB 规格

3.）我很快找到了几个指针。谷歌应该是你的朋友！ [http://www.lrr.in.tum.de/Par/arch/usb/usbdoc/](http://www.lrr.in.tum.de/Par/arch/usb/usbdoc/) - Linux USB 设备驱动程序

[http://www.microsoft.com/technet/archive/wce/support/usbce.mspx](http://www.microsoft.com/technet/archive/wce/support/usbce.mspx)

-广告

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-09T14:40:25.370

我使用了[Jan Axelson 的早期版本的 USB Complete](https://rads.stackoverflow.com/amzn/click/com/1931448086)。确实很齐全。

从编辑评论：

> 该通用串行总线 (USB) 接口开发人员指南现已发布到第四版，涵盖了项目开发的所有方面，例如硬件设计、设备固件和主机应用软件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-13T20:59:17.363

我很好奇，你为什么选择9S12？我在以前的工作中使用过它，但并不满意。

*   它有糟糕的 gcc 支持，所以我们使用 Metrowerks
    *   这对 C 来说可能没问题，但经常会生成错误的 C++
    *   有一个带有二进制项目文件的糟糕 IDE！
*   9s12 也很慢，很多指令在 5 个周期内执行。
*   也不是很省电。
*   没有桶形移位器，使嵌入式代码中常见的操作变慢
*   没那么便宜。

关于我唯一不喜欢的是 8051。我在目前的工作中使用的是 ARM CortexM3，它在各方面都比 9S12 好（更快的时钟，每个时钟完成的工作更多，功耗更低，更便宜，良好的 gcc 支持, 32 位与 16 位）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-09T14:26:41.100

我不知道您打算使用哪种硬件，但假设它很灵活，STMicro 提供了一系列支持 USB/SPI 的微控制器和一个可与其部件一起使用的 C 代码库。-- 我多年来一直使用他们的 ARM7 系列微机并取得了巨大的成功。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T05:58:48.073

这是德克萨斯大学教授乔纳森·瓦尔瓦诺（Jonathan Valvano）维护的一个极好的网站。他在那里教四门课程（三门本科，一门研究生），都是关于使用 9S12 微控制器的。他的网站包含他在所有课程中使用的所有讲义、实验室手册，更重要的是，入门文件。

该网站看起来像是 90 年代的，但只要稍微挖掘一下，您应该会找到所需的一切。

[users.ece.utexas.edu/~valvano/](http://users.ece.utexas.edu/~valvano/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-12-16T11:42:59.603

考虑将 AVR 用于您的下一个 MCU 项目，因为它具有出色的[LUFA](http://www.fourwalledcubicle.com/LUFA.php)和[V-USB](http://www.obdev.at/products/vusb/index.html)库。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-12-09T19:19:42.687

我正在使用 Atmel V71 进行项目。该处理器非常强大，在芯片上提供的许多高端连接中，有一个 USB 引擎，它将执行 480 Mhz 或 48Mhz（不是 USB 3.0）的设备或主机模式。这些工具是免费的，并附带许多主机和设备 USB 示例项目，其中包含所有 USB 堆栈代码。它支持 10 个端点，所有传输都通过 DMA 完成，因此您可以将大部分处理器马力用于其他任务。Atmel USB 堆栈无需 RTOS 即可工作

# c# - 我想编写接收 MS CLUSTER 事件的 ac# 服务

> ID：517215
> 
> 赞同：0
> 
> 时间：2009-02-05T18:24:06.823
> 
> 标签：c#, cluster-computing

尝试使用本地系统用户，但它没有访问网络的权限。网络服务帐户可以解决问题吗？，如果不是，推荐使用什么用户？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-05T23:56:21.270

此[链接](http://msdn.microsoft.com/en-us/library/system.serviceprocess.serviceaccount.aspx)描述了差异。

LocalSystem 帐户应该有足够的权限来访问网络。如果您无法使用此帐户访问网络，我会与您的系统管理员联系以了解可能阻止此操作的其他问题。

是的，NetworkService 帐户也应该允许网络访问，但它的权限集不如 LocalSystem 帐户广泛。

如果您可以在两者之间进行选择，请倾向于 NetworkService 帐户。将服务暴露给具有系统权限的网络可能是一件危险的事情，尤其是当您允许外部用户与您的服务交互时。无论您选择什么帐户，请确保您验证您的服务收到的数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-07T20:27:38.857

如果您在域中（我想您必须运行集群），请查看是否可以为域用户配置所需的权限。这是最安全的方法，因为您可以为用户提供完成工作所需的最低权限。使用 LocalSystem 或 NetworkService，您可能会给用户过多的访问权限，正如 Matt 提到的，与您的服务交互的恶意用户可能会造成麻烦。

您可以清理您的输入以防止出现问题，但如果您错过了一个潜在的攻击，您将处于危险之中。如果您可以配置一个专用的代理域帐户来执行此操作，那就很理想了。

# ruby - Ruby - 查看端口是否打开

> ID：517219
> 
> 赞同：47
> 
> 时间：2009-02-05T18:24:58.350
> 
> 标签：ruby, bash, network-programming, port

我需要一种快速的方法来确定给定端口是否已使用 Ruby 打开。我目前正在摆弄这个：

```
require 'socket'

def is_port_open?(ip, port)
  begin
    TCPSocket.new(ip, port)
  rescue Errno::ECONNREFUSED
    return false
  end
  return true
end 
```

如果端口是打开的，它会很好用，但它的缺点是偶尔它会坐下来等待 10-20 秒，然后最终超时，抛出`ETIMEOUT`异常（如果端口关闭）。我的问题是：

可以将此代码修改为仅等待一秒钟（`false`如果到那时我们什么都没有返回，则返回）还是有更好的方法来检查给定端口是否在给定主机上打开？

**编辑：**调用 bash 代码也是可以接受的，只要它可以跨平台工作（例如，Mac OS X、*nix 和 Cygwin），尽管我更喜欢 Ruby 代码。

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2009-02-05T19:55:42.330

像下面这样的东西可能会起作用：

```
require 'socket'
require 'timeout'

def is_port_open?(ip, port)
  begin
    Timeout::timeout(1) do
      begin
        s = TCPSocket.new(ip, port)
        s.close
        return true
      rescue Errno::ECONNREFUSED, Errno::EHOSTUNREACH
        return false
      end
    end
  rescue Timeout::Error
  end

  return false
end 
```

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2012-01-26T12:08:23.997

更多 Ruby 惯用语法：

```
require 'socket'
require 'timeout'

def port_open?(ip, port, seconds=1)
  Timeout::timeout(seconds) do
    begin
      TCPSocket.new(ip, port).close
      true
    rescue Errno::ECONNREFUSED, Errno::EHOSTUNREACH
      false
    end
  end
rescue Timeout::Error
  false
end 
```

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2016-07-08T12:02:02.217

所有其他现有答案都是不可取的。`Timeout`不[鼓励](http://blog.headius.com/2008/02/rubys-threadraise-threadkill-timeoutrb.html)使用。也许事情取决于红宝石版本。至少从 2.0 开始，人们可以简单地使用：

```
Socket.tcp("www.ruby-lang.org", 10567, connect_timeout: 5) {} 
```

对于较旧的 ruby​​，我能找到的最佳方法是使用非阻塞模式，然后`select`. 此处描述：

*   [https://spin.atomicobject.com/2013/09/30/socket-connection-timeout-ruby/](https://spin.atomicobject.com/2013/09/30/socket-connection-timeout-ruby/)

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2014-03-31T01:11:43.917

我最近提出了这个解决方案，使用了 unix`lsof`命令：

```
def port_open?(port)
  !system("lsof -i:#{port}", out: '/dev/null')
end 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-02-05T23:20:05.163

为了完整起见，Bash 应该是这样的：

```
$ netcat $HOST $PORT -w 1 -q 0 </dev/null && do_something 
```

`-w 1`指定 1 秒的超时时间，并`-q 0`表示在连接时，一旦`stdin`给出就关闭连接`EOF`（这`/dev/null`将立即完成）。

Bash 也有自己的内置 TCP/UDP 服务，但它们是编译时选项，我没有用它们编译的 Bash：P

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-02-20T23:25:38.403

我对克里斯·赖斯的回答略有不同。仍然处理一次尝试超时，但也允许多次重试，直到你放弃。

```
 def is_port_open?(host, port, timeout, sleep_period)
      begin
        Timeout::timeout(timeout) do
          begin
            s = TCPSocket.new(host, port)
            s.close
            return true
          rescue Errno::ECONNREFUSED, Errno::EHOSTUNREACH
            sleep(sleep_period)
            retry
          end
        end
      rescue Timeout::Error
        return false
      end
    end 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-09-05T08:25:16.180

所有 *nix 平台：

尝试如下 nc / netcat 命令。

```
`nc -z -w #{timeout_in_seconds} -G #{timeout_in_seconds} #{host} #{port}`
if $?.exitstatus == 0
  #port is open
else
  #refused, port is closed
end 
```

-z 标志可用于告诉 nc 报告打开的端口，而不是启动连接。

-w 标志表示连接和最终网络读取超时

-G 标志是以秒为单位的连接超时

使用 -n 标志来处理 IP 地址而不是主机名。

例子：

```
# `nc -z -w 1 -G 1 google.com 80`
# `nc -z -w 1 -G 1 -n 123.234.1.18 80` 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-12-14T19:29:57.773

我的解决方案来自发布的解决方案。

```
require 'socket'
def is_port_open?(ip, port)
  begin
    s = Socket.tcp(ip, port, connect_timeout: 5)
    s.close
    return true
  rescue => e
    # possible exceptions:
    # - Errno::ECONNREFUSED
    # - Errno::EHOSTUNREACH
    # - Errno::ETIMEDOUT
    puts "#{e.class}: #{e.message}"
    return false
  end
end 
```

# python - HOWTO：编写 Python API 包装器？

> ID：517237
> 
> 赞同：21
> 
> 时间：2009-02-05T18:29:07.233
> 
> 标签：python, web-services, api, rest

我想编写一个 python 库来包装特定 Web 服务提供的 REST 样式 API。有没有人知道这样的工作有什么好的学习资源，最好是针对中级 Python 程序员？

我想要一篇关于这个主题的好文章，但我会选择漂亮、清晰的代码示例。

**澄清：**我要做的是编写一个 Python 客户端来与 Web 服务交互——构建 HTTP 请求和解析 XML/JSON 响应的东西，所有这些都包含在 Python 对象中。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T19:14:52.663

我无法向您指出任何关于如何做到这一点的文章，但我认为有一些库可以成为如何设计自己的好模型。

[以 PyAws](http://pyaws.sourceforge.net/)为例。我没有看到源代码，所以我不能告诉你它作为代码示例有多好，但是他们网站中的功能和使用示例应该是一个有用的设计模型

[Universal Feed Parser](https://universal-feedparser.readthedocs.io/en/latest/#basic-features)不是 web 服务的包装器（它是一个 RSS 解析器库），但它是优先考虑使用灵活性和隐藏实现细节的设计的一个很好的例子。我认为您可以在那里为您的包装器获得非常好的使用想法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-05T22:01:01.797

我最喜欢的组合是 httplib2（或性能方面的 pycurl）和 simplejson。由于 REST 更像是“一种设计方式”，而不是真正的“协议”，因此并没有真正可重用的东西（据我所知）。在 Ruby 上，你有类似 ActiveResource 的东西。老实说，即使这样也只是将一些表作为 Web 服务公开，而 xml/json 的强大之处在于它们更像是“视图”，可以包含为您的应用程序优化的多个对象。我希望这是有道理的 ：-）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-07T07:19:31.297

[本教程页面](http://learn-rest.blogspot.com/2008/02/using-rest-in-python.html)可能是一个很好的起点（但它不包含您需要的所有内容）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-11T14:34:57.690

你应该看看 PyFacebook。这是 Facebook API 的 python 包装器，它是我用过的做得最好的 API 之一。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-07-30T17:37:50.733

您可以签[出 pythenic jobs](http://github.com/ryanmcgrath/pythentic_jobs)，这是一个很好、简单但格式良好的“围绕 Authentic Jobs ... API 的 Python 包装器”作为一个很好的例子。这就是我现在正在做的:)

# apache-flex - flex 3 webservice结果问题

> ID：517238
> 
> 赞同：1
> 
> 时间：2009-02-05T18:29:10.260
> 
> 标签：apache-flex, web-services

我对 Web 服务调用的结果有疑问。当结果进来并启动 resultHandler 函数时，我设置了一个断点，以便我可以检查结果。我可以看到数组集合中有 0 条记录但是我可以看到内容所以我假设零只是指数组的第一个索引

当我尝试将值分配给数组集合时，会出现问题，如下所示；

```
public function resultHandler(event:ResultEvent):void{
    var result:ArrayCollection = event.result as ArrayCollection; 
```

此操作的结果是一个值为 null 的结果 var。谁能解释这里可能发生的事情？多谢

我刚刚注意到的另一件事是结果类型是 mx.utils.ObjectProxy，我期待一个数组

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T18:43:40.620

如果 web 服务只返回一个元素，它将被反序列化为 ObjectProxy。您必须手动将其转换为数组。

我通常会在 WS 调用之后执行此操作：

```
if (event.result is ArrayCollection) {
    result = event.result;
}
else {
    result = new ArrayCollection([event.result]);
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T18:56:41.810

Chetan 是对的——对 ArrayCollection 的强制转换操作失败，因为源对象不是 ArrayCollection。试试这个：

```
public function resultHandler(event:ResultEvent):void
{
    var ac:ArrayCollection = new ArrayCollection([event.result])
    // ...
} 
```

“as”运算符将`null`在运行时发生异常的情况下返回 - 在您的情况下，从 ObjectProxy 转换为 ArrayCollection。相反，如果您`event.result`作为数组的唯一成员传递（通过用 包围它`[]`），您的 ArrayCollection 将正确构造，并且您将能够正常检索对象：

```
var o:Object = ac.getItemAt(0) as Object;
trace(o.yourObjectProperty.toString()); 
```

希望能帮助到你！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T20:19:17.930

数组中的 0 条记录是数组的长度，这实际上意味着 0。如果数组的索引 0 中有某些内容，则该数组的长度至少为 1。看起来你没有得到任何数据，偶数和空数组集合。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-09-22T13:46:40.963

The problem in my opinion is that you cannot cast event.result as an array collection, but you have to cast it as an array.

The best practice in this is having a getter and a setter:

```
private var _acLocation:ArrayCollection=new ArrayCollection;

public function set acLocation(acLocation:ArrayCollection):void{

_acLocation=acLocation;

//do this if you want for exaple to assign the arraycollection to a datagrid dataprovider

dgMyDataGrid.dataProvider=_acLocation;

}

public function get acLocation():ArrayCollection{

return _acLocation;
} 
```

Then in the result handler function of a service call, code

```
acLocation=new ArrayCollection(event.result as Array); 
```

Hope it helps

# unix - Unix 与 Windows 的字符渲染

> ID：517241
> 
> 赞同：0
> 
> 时间：2009-02-05T18:29:43.487
> 
> 标签：unix, unicode, character-encoding

我有一个在 FreeBSD 和 Windows 中打开时显示不同的文本文件。

在 FreeBSD 上：AnÂ·lisis e InvestigaciÃ›n

在 Windows 上：分析和调查

windows 的表示显然是正确的。关于如何在 bsd 中获得该结果的任何想法？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-05T18:43:25.067

[每个软件开发人员绝对、绝对必须了解 Unicode 和字符集的绝对最低要求（没有借口！）](http://www.joelonsoftware.com/articles/Unicode.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-05T18:43:04.960

问题是它不是 ASCII，而是 UTF-8。您必须使用另一个可以正确检测编码的编辑器，或者将其转换为您在 freebsb 上的编辑器可以理解的内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T18:35:14.227

这不是纯 ASCII。它是 utf-8。尝试支持 utf-8 的 freebsd 编辑器或更改语言环境。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T18:46:44.170

从字符的显示方式来看，我会说该文件是 UTF-8 编码的 unicode。Windows 正在识别这一点，并正确显示 'á' 和 'ó' 字符，而 FreeBSD 假设它是 ISO-8859-1，这导致这些字符显示为 2 个单独的字符（由于 UTF-8 编码使用 2字节）。您必须以某种方式告诉 FreeBSD 它是一个 UTF-8 文件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-05T19:50:16.337

因此，在进行了更多挖掘之后，如果 1）在 mac 上的 excel 中打开 csv 文件并将其导出为 csv 文件，并且 2）然后在 textmate 中打开它，复制文本并再次保存它就可以了。

结果：文件 file.csv 是

UTF-8 Unicode 英文文本，行很长

原文是：

on-ISO 扩展 ASCII 英文文本，行很长

这种解决方法并不适合，因为这个过程应该是自动化的，感谢到目前为止的帮助。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-06T02:15:29.727

打开文件时使用的*操作系统*无关紧要。重要的是您用来打开它的应用程序。在 Windows 上，您可能正在使用记事本，它会自动将编码识别为 UTF-8。

您在 FreeBSD 上使用的应用程序显然没有这样做。也许它只是无法读取 UTF-8，您需要使用不同的应用程序。或者也许你只需要告诉它使用哪种编码。字符编码的自动检测远非普遍（也远非完美）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-05T18:33:36.413

文件是如何编码的？我会尝试将文件重新编码为 UTF-16。

# language-agnostic - 我正在经历的奇怪的编码阶段

> ID：517243
> 
> 赞同：7
> 
> 时间：2009-02-05T18:30:51.957
> 
> 标签：language-agnostic

最近，我经历了一个非常奇怪的阶段。我觉得有必要编写/重写我使用的所有工具（文本编辑器、IDE、库/模块），但我不知道为什么。
尽管这可以看作是一件好事（因为我在这个过程中学到了很多东西，而且我的软件设计能力也在不断提高），但最奇怪的是我写完之后就把所有的代码都扔掉了，所以我有点徒劳。我对自己编写的代码从不满意。你也有这个实验吗？你是怎么克服的？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-05T20:02:56.077

听起来您被几种不同的可能“综合症”之一（或者可能不止一种）驱动。

1.  这里不是发明综合症（NIHS）。这是没有人的代码足够好的地方，或者没有人按照你想要的方式做事。所以你认为你可以做得更好。
2.  它是如何工作的？综合征（HDIWS）。这是您对程序着迷并想了解其工作原理的地方，因此您基本上可以自己编写程序。
3.  咬得比你能咀嚼的多（BOMTYCCS）。这就是您认为“这不会太难做，所以我自己写它然后我知道它在做什么”的地方。然后，你完成了它的一半，足以让它工作，你意识到你的代码很糟糕，你做了太多的妥协来快速完成它，所以你把它扔掉了。
4.  买太便宜了，所以你认为你可以建造更便宜的综合症（TCTBISYFYCBICS）。名字足以说明问题。问题是你完成了一半，然后你意识到你已经陷入了上面的＃3，并认为你的时间比任何时间都更有价值。

我遭受了所有这些，甚至更多......（就像经典的“需要为一切综合症（NTCAAFES）创建一个缩略词”；）

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-05T18:41:01.000

我一直这样做（好吧，除了扔掉的部分）。就个人而言，我在编程学习的早期就开始这样做了（当我还是学生的时候）；它让我检查Java核心源代码，如果我不喜欢它，我会自己制作/扩展它。它到了运行类笑话的地步，即我要重新发明 Java。

就个人而言，我从来没有克服过它......相反，我找到了新的方法来利用它来为我谋福利。例如，我不是简单地重新发明东西，而是发现我想要的东西在其他地方是/不可用的，所以我会为自己制作。我的第一个这样的项目是一个聊天程序。当然有很多，但这是我老师唯一不知道的（呵呵）。当然通过它学到了很多关于网络协议的知识，但是一旦“完成”，我的第一个动作就是把它发给我所有的朋友，我们会在老师讲课的时候聊天......很快他就发现了，并且已经从那以后，他强迫他所有的学生在他说话的时候关掉他们的显示器，但它持续的时间很有趣。

从那时起，我一直在继续提出对我有用的自己的项目，至少有一个方面我需要在此过程中学习，以及没有一个或多个方面的当前程序可以解决免费为我解决问题。

所以总而言之，我建议不要尝试重新发明 IDE，然后扔掉你的代码，而是尝试找到一些你想自己解决并再次使用的项目或问题。我相信[dogfooding](http://www.codinghorror.com/blog/archives/001217.html)（使用你自己的程序）是任何程序员都希望达到的最好的。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-05T18:44:03.193

将您编写的任何代码放入网站并使其开源。

让其他人讨论代码并使其变得更好。

这有助于您在回馈社区的同时提高编码技能。

稍后你会惊奇地发现你的代码比你离开时更好。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-05T18:50:03.353

我认为我们作为编程物种的本性是想要控制一切。我们完全是控制狂。每个人都有很多理由不相信别人的工作。办公室的任何一天都可以证明这一点。

然而，一般来说，你会错的。很可能该工具/库/IDE/由一个团队开发的任何东西都投入了比你能做的更多的时间。当然，它有它的外部缺陷，但是当你完成你的版本时，你可能会发现你的版本也有它自己的一些缺陷。

这只是你必须接受的事情。

事后看来，这并不是一个完全坏习惯。它让你脱离了正常的编程领域，让你接触到其他问题。最终你会变得更加多才多艺。如果你继续从这个角度去做，并将它与真正的生产力结合起来，我认为它是非常健康的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-05T23:38:46.157

这点我给你点赞。如果您不沉迷于工具的完美性，并且不知道它们是如何制作的，那么您就不会成为一名优秀的编码员，因此：

*   不要浪费太多时间，
*   确保你发布任何你可以开源的东西，

但我认为它就像一个学徒建造他/她自己的光剑。它必须完成。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-05T18:40:01.157

如果您只是复制现有工具，那么价值不大。但是，如果对如何让它变得更好有一个想法，即使只是一种方式，它也是值得的。

这样，在它结束时，您将拥有一个稍微好一点的工具，而且您不会把它扔掉。

我在工具方面经历了类似的阶段，但后来我对图形和游戏等其他主题更感兴趣。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-05T18:51:22.103

我只在可以节省时间（或者，当然，同时实现更多目标）的情况下编写工具。

无需编写工具即可编写足够多的应用程序代码。

如果你是在业余时间做的，那么每个人都有自己的想法，但我发现从我编写的代码中赚钱的需要让我的注意力集中在重要的事情上。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-05T19:30:31.367

你选择了*红色药丸*，不是吗？应该有人告诉你**不要**那样做。

问题是，如果你真的很喜欢计算机，并且你花了太多*时间*思考它们，那么你就会发现软件开发的整个随机/非理性状态——那种任意复杂的工作混乱——似乎显然比*必要*的要复杂得多，即使你还不知道什么是必要的。

在这一切之下，有一个*非常神奇*的工具正等待被释放。它不时取笑你，隐藏在各种程序中，与各种数据一起嵌入。诱人的功能，如果您能找到一种真正的方法将它们组合在一起以构成一个超酷的大型系统，您就可以...

正是这种纯粹的数学意义上的计算机实际上可以是*很棒*的东西，只要它们不**那么**糟糕。

现在吃*蓝色药丸*，回去工作吧……

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-22T14:34:31.700

我们程序员是流量迷。我们享受与解决问题和解决问题相关的心理状态。有时，当工作中的项目陷入困境时——由于各种原因——很容易转向辅助项目作为获得流程修复的一种方式。

这不一定是坏事，只要你在磨练你的工具或学习一些东西，并且它不会占用其他职责（工作或关系）的时间。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-05T19:08:48.090

听起来你可能对你正在做的其他工作真的不满意。我发现，当我不喜欢我的工作时，我往往会找其他事情做，并且会特别专注于那些我可以借口不浪费时间的事情，因为从表面上看，它们是富有成效的。诸如返回并清理实际上只是一次性临时的代码、重写已经有效的代码以及对工具进行自己的“改进”之类的事情。如果我是对的，那么您将其扔掉/走开/寻找其他东西是有道理的，因为如果您这样做只是为了避免做其他工作。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-05T19:14:01.090

我有时经历过。例如，在准备要发布的 HTML 文档时，我觉得有必要编写[自己的工具](http://code.google.com/p/typografix)来按照自己的方式进行操作。想要让世界变得更美好是很自然的。如果你有这种冲动——我建议你去做。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-22T14:16:55.127

我认为这可能是一件好事，如果它不妨碍完成工作的话。

但是不要扔掉它，即使它是垃圾，把它放在网上的某个地方，当其他人试图做同样的事情时，他们可以看到你的，至少避免犯同样的错误。

# email - 电子邮件收据保证

> ID：517244
> 
> 赞同：1
> 
> 时间：2009-02-05T18:30:55.047
> 
> 标签：email

我们的客户有时收不到我们发送的电子邮件。这是一个很大的损失。我如何确保他们收到电子邮件，以便如果在另一端没有收到，程序可以重新发送它或做一些事情。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-05T18:43:34.677

上述任何建议都不会 100% 有效。许多电子邮件客户端将（正确地）拒绝加载外国图像，否定“网络错误”的有用性。他们还将拒绝（或无法）退回 Outlook 样式的“收据”。许多邮件服务器故意（以遏制垃圾邮件）或错误地（由于配置错误）不会返回退回邮件。或者可能是一个过于激进的垃圾邮件过滤器吃掉了你的邮件，所以它到达了，但最终用户从未看到过。此外，邮件需要数小时或数天才能到达最终用户或退回，这也是小问题，您如何将这些迟到的通知或退回的邮件与您 4 天前发送的邮件关联起来？

所以基本上，无论你做什么，你都可以捕捉到一些但不是全部。我想说，任何依赖于能够确定地知道最终用户是否收到您的邮件的设计都是致命的缺陷。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-05T18:36:49.230

您可以做的一件事是设置一个退回地址，以接收任何无法投递的邮件。使用退回地址作为发件人地址——您可能需要一个不同的回复地址，以便正确定向回复。

每天检查退回邮箱并联系客户以获取更新的电子邮件地址以获取失败的电子邮件地址。您可以在求助于手动联系之前自动重试失败的地址，以防故障只是间歇性的。

这将在您的应用程序之外使用一些代码来扫描邮箱并保留有关联系人数量等的一些状态信息，并尝试重新发送。

根据您生成邮件的方式，您或许可以简化此过程：为您发送的每封电子邮件生成一个唯一的退回地址。例如，您可以使用bounces+1234@example.com。

许多 SMTP 服务器将允许您使用 + 之后的部分作为外部脚本的参数等。

问题是许多（损坏的）SMTP 服务器没有返回足够的信息并通过退回来识别原始邮件——有时，当涉及到转发时，您甚至无法取回原始收件人......

使用上述技巧，您可以可靠地将传出消息与传入反弹相关联。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-05T18:36:31.243

没有标准方法可以知道电子邮件是否到达目的地。但是，许多电子邮件客户端支持不同类型的收据。如果你愿意，你可以使用其中的任何一个。

有一些方法可以知道用户何时真正阅读了电子邮件。

有许多技术，例如将图像添加到要从 Web 服务器获取的电子邮件中。当用户阅读电子邮件时，对图像的请求会到达您的服务器，您可以捕获该事件。

问题是没有办法知道邮件*没有到达*目的地。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-05T18:57:57.347

我在前世从事批量电子邮件系统的工作。可交付性是我们的主要问题之一。未送达电子邮件的最常见原因是垃圾邮件过滤器。

以下是我们为确保最高交付率而采取的步骤：

*   我们使用[Return Path](http://www.returnpath.net/)来测试电子邮件中的垃圾邮件气味。
*   如果您发送大量电子邮件，则需要确保您的 SMTP 服务器未列入黑名单。
*   提醒您的用户将您的 FROM 地址添加到他们的“安全发件人”列表中。
*   使用收集退回邮件的系统并使用它们来清理您的邮件列表。这也将帮助您远离黑名单。
*   如果电子邮件很重要，请考虑将其发送回执请求。这并不能真正保证任何事情，但它可能会为您提供一些有关实际可交付性的指标。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-05T18:32:56.430

确定电子邮件是否真的到达他们的收件箱并没有真正的好方法，您只能确认您发送了它。附上一张收据，让您知道他们何时打开它？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-05T18:35:54.147

Microsoft Outlook 提供了类似的功能，但它基于电子邮件客户端。我不确定其他客户端（例如 Thunderbird）是否支持此功能。

但是，协议中没有指定收据的任何内容。

一个可行的选项：发送指向生成网页的链接并监控该页面的点击量。然而，这提供了自己的问题：机密性等。

# flash - 无需向量即可获取 flash.geom.Matrix3D rawData。 分配

> ID：517246
> 
> 赞同：0
> 
> 时间：2009-02-05T18:31:22.173
> 
> 标签：flash, actionscript, 3d, matrix

从 flash.geom.Matrix3D（Flash 10 中用于高级 3D 矩阵数学的新类）的实例获取“rawData”属性会导致 Vector。（也特定于 Flash 10）对象分配发生。有什么方法可以访问原始数据而不会产生这种对象分配开销？

由于我必须每帧多次访问此数据，因此它对性能配置文件有很大影响。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-07T15:44:30.667

I'm pretty sure there isn't. Apart from making sure that you're assigning into an existing reference, instead of creating a new vector every time, the only obvious option I see is to avoid accesses. So, make sure not to reaccess the data until it has changed, and for example if you merely do a translation, then instead of reaccessing the vector you could just perform the translation on the vector data from the last access.

# ms-access - 数据库中的顺序编号 (MSACCESS)

> ID：517248
> 
> 赞同：2
> 
> 时间：2009-02-05T18:32:11.423
> 
> 标签：ms-access, key, database-relations

### 概括：

我有一个表，它有一个唯一的主键来标识每条记录。我还有另外三个可以识别记录的字段：

*   类别
*   类别编号
*   重复号码

当我添加新记录并选择类别时，如何让 CategoryNumber 根据它是否重复正确递增。

请注意，这是一张大桌子。这仅仅是从 excel 到 access 的升级。

### tldr：

昨天我问了如何处理Access中的多个键。可能是我没有问对问题，因为我的问题今天更加令人费解。

这是我正在尝试做的事情以及我陷入困境的地方。

我正在创建一个数据库来跟踪我用不同相机拍摄的各种不同胶片和格式的胶片照片（每张照片总共有 18 条不同的独立信息），这些照片可以追溯到近 15 年。几年前，我将数据保存在 MS Excel 中，并对输入表单进行了编程，以完成我将要解释的事情。

我想以两种方式跟踪照片。第一个是主照片编号，它可以让我知道我的文件中有多少张照片。这是一个序列号，我从未打算删除该序列中的某些内容。这将是一个唯一标识每张照片的数字。我将其视为整个数据库的主键。

但我也想根据一般的组或类别来归档幻灯片、底片和透明胶片，以便在需要提交照片或寻找特定内容时可以快速提取它们。所以我还添加了一个类别标识符（例如，风景也附加了一个“LS”名称或日落为“SS”等）。我还想为每个类别中的每张幻灯片保留一个连续的序列号。因此，例如，我的数据库中的第一张照片有 PhotoID = 3、Category = LS 和 CategoryID = 1。再往下我有 PhotoID = 14、Category = LS 和 CategoryID = 2。

现在除了这些，我还有另一个需要跟踪的数字，那就是如果我对同一场景进行了重复曝光。为此，我只是为每张照片添加了一个 DuplicateNumber。如果它没有重复，则 DuplicatNumber 为 0，如果它有一个重复，则 DuplicateNumber 为 1、2 个重复、DuplicateNumber 为 2，依此类推。

所以我有两种方法可以在我的文件中找到任何照片。通过在数据库中连续但不在我的物理文件中的 PhotoID，或者通过 Category、CategoryID 和 DuplicateNumber 的组合，这是我物理归档照片的方式。

现在在 Excel 中，当我打开表单时，我首先必须通过表单上的单选按钮选择将照片放入的类别。然后我会填写照片的所有相关数据。当我执行表单时，它会在主表中找到最后一个数字，将其递增并将所有数据添加到新记录中。然后它将激活我选择的类别的类别表，确定该表中的最后一个数字，增加它并在那里添加新数据。

一个重要的注意事项是，除非我将其设为 1、2 等，否则默认情况下 DuplicateNumber 始终为 0。它从未被计算过，但我输入了它。

当我创建幻灯片标签（“报告”）时，我会以这种格式（1LS1.0、14LS45.0、15LS45.1）包含主要的 PhotoID、CategoryName、CategoryID 和 DuplicateNumber，以及拍摄的位置和日期。

但现在我不想再使用 Excel 并尝试将数据库迁移到 MS Access。所以我有一个名为 PhotoDetails 的主表。

PhotoID 是此表中的主键。它有一个 PhotoCategory 字段，该字段是一个与另一个名为 Category 的表相关的数字。它的主键是 PhotoCategoryID，也是 PhotoDetails 中的外键。PhotoCategoryID 是一个标识每个类别的数字。在我所有类别的列表中，LS 排在第 11 位。但这就是我卡住的地方。

我在 PhotoDetal 表中有 CategoryNumber，它是标识每个类别中照片的编号，以及 DuplicateNumber，标识重复的数量。我想不通的是，当我添加新照片时，如何增加 CategoryNumber？我现在拥有的表格允许我输入所有数据，当我单击输入下一个时，它会自动调整 PhotoID 键，但是 CategoryNumber 呢？我不记得每个类别的最后一个数字是什么，以便我自己输入那个数字。除非我通过将所有数据存储两次来模仿我在 Excel 中所做的事情，一次是在 PhotoDetails（又名 Excel 中的 Master Sheet）中，另一次是在多个类别表中。我希望 Access 可以为我提供一种解决方法。

目前，我拥有的关系是与 PhotoDetails 以 1-M 关系链接的类别表。我还有几个其他表都以 1-M 关系链接（例如，表 Film 存储我使用过的不同电影，而 1-M 关系让我可以将什么电影链接到每张幻灯片，并且大多数其他数据都存储在其中方法）。

我有 31 个不同的类别。每张照片都有一个类别和一个类别 ID 编号，以及一个重复编号。我将选择数据输入中的类别和 DuplicateNumber，但我希望 CategoryID 编号和 PhotoID 自动递增。进行此操作的正确方法是什么，我只需要保留一个 PhotoDetail 表，该表不会像我在 Excel 中那样为每个类别重复。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T19:05:04.697

好的，所以基本上你要做的是“规范化”你的数据

通常你会有两张桌子

**照片**
PhotoID（数据类型：自动编号 - 用户通常看不到 - 主键）
PhotoRefID（DT：可能是数字或文本 - 引用物理编号）
CategoryID（DT：数字 - 长整数 - 类别表的键）
重复（DT：数字 - 也可能很长 - 如果这只是一个计数）
- 或 - DuplicateOf （DT：数字 - 长整数 - 引用它的副本）

**类别**
CategoryID（DT：自动编号 - 主键）
说明（DT：文本）

您将使用关系（工具->关系）将两个类别 ID 放在一起。

然后，您可以使用这些表来构建您正在寻找的表单和查询。

注意：如果您的照片可以属于多个类别，那么您将需要第三个中间表来连接它们。就像是：

**PhotoCategories**
PhotoCategoryID (DT: Autonumber, Primary Key)
PhotoID (DT: Number Long Integer)
CategoryID (DT: Number Long Integer)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T19:03:02.483

我会考虑通过添加代码来廉价地做到这一点，这样当您尝试添加新记录时，它会在数据库中搜索具有类别/重复/等的最高数字，然后您可以在添加之前在代码中增加它新纪录。

没有简单的方法可以在 Access 中自动获取此功能，除非您将表拆分为更多表。

-亚当

# user-interface - 如何使我的应用程序“可换肤”？

> ID：517251
> 
> 赞同：10
> 
> 时间：2009-02-05T18:32:41.283
> 
> 标签：user-interface, skinning, skin

是否有一些标准方法可以使我的应用程序可换肤？

“可换肤”是指应用程序支持多种皮肤的能力。

我在这里没有针对任何特定平台。只是想知道是否有任何使应用程序可换肤的一般准则。

看起来为 Web 应用程序换肤相对容易。桌面应用程序呢？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-05T18:44:16.937

皮肤只是另一个抽象级别（YALOA！）。

如果您阅读了[MVC 设计模式](http://en.wikipedia.org/wiki/Model-view-controller)，那么您将了解许多所需的原则。

表示层（或皮肤）只需要做一些事情：

*   显示界面
*   当执行某些操作（单击、在框中输入文本等）时，它会触发操作
*   当需要更改时，它必须收到模型和控制器的通知

在普通程序中，这种抽象是通过将文本框连接到与之相关的方法和对象的代码以及根据程序命令更改显示的代码来完成的。

如果要添加蒙皮，则需要采用该功能并使其可以在不重新编译代码的情况下完成。

例如，查看 XUL，看看它是如何完成的。你会发现很多皮肤项目使用 XML 来描述皮肤的各种“面孔”（它播放音乐，或组织 MP3 播放器皮肤的库），然后每个控件的位置以及它的数据和方法应附在程序中。

在你做之前它看起来很难，然后你意识到它就像你以前处理过的任何其他抽象级别一样（从带有 goto 的程序，到控制结构，到函数，到结构，到类和对象，再到 JIT编译器等）。

最初的学习曲线并不简单，但是做一些项目，你会发现它并不难。

-亚当

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-05T18:34:11.153

将所有样式保存在单独的 CSS 文件中

远离任何内联样式

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-05T18:40:51.267

这实际上取决于您希望您的应用程序有多“可换肤”。让用户配置颜色和图像比让他们隐藏/删除组件甚至编写自己的组件要容易得多。

在大多数情况下，您可能无需编写某种资源提供程序来提供颜色和图像，而不是在源文件中硬编码它们。所以这：

```
Color backgroundColor = Color.BLUE; 
```

会变成这样：

```
Color backgroundColor = ResourceManager.getColor("form.background"); 
```

然后，您所要做的就是更改 ResourceManager 类中的映射，所有客户端都将保持一致。如果您想实时执行此操作，更改任何 ResourceManager 的映射可能会向其客户端发送一个事件并通知他们发生了某些变化。然后客户可以根据需要重新绘制他们的组件。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-05T18:49:37.003

实现因平台而异，但这里有一些通用的跨平台注意事项：

*   最好有一个既定的整体布局，可以“插入”视觉元素。通过蒙皮支持完全不同的一般布局更加困难（但仍然可能）。
*   为构成皮肤的资产（图像、HTML 片段等）制定一个有据可查的命名约定。
*   设计一种简洁的方式来“发现”现有皮肤并添加新皮肤。例如：Winamp 使用 ZIP 文件格式存储其皮肤的所有图像。所有皮肤文件都位于应用程序文件夹之外的一个众所周知的文件夹中。
*   注意缩放问题。不是每个人都使用相同的屏幕分辨率。
*   你会允许第三方皮肤开发吗？这会影响你的设计。
*   从架构上讲，模型-视图-控制器模式适用于蒙皮。

这些只是需要注意的几件事。您的实现会因 Web 客户端和胖客户端以及您的功能要求而异。HTH。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-05T18:38:39.803

基本原理是 CSS 在网页中使用的原理。

无需指定内容的格式（颜色/字体/布局[在某种程度上]），您只需描述它是什么类型的内容。

举一个网络示例，在博客页面的内容中，您可以将不同的部分标记为：

1.  标题
2.  博客条目
3.  存档窗格

等等

条目可能由多个小节组成，例如“标题”、“正文”和“时间戳”。

然后，在其他地方，您有一个样式表，它指定每种元素的所有属性、大小、对齐方式、颜色、背景、字体等。在渲染页面或在 UI 中绘制/初始化组件时，您总是参考当前样式表来查看提升这些属性。

然后，蒙皮，实际上编辑你的设计，变得容易得多。您只需创建一个不同的样式表并根据您的热量内容调整值。

编辑：

要记住的一个关键点是一般样式（如 CSS 中的类）和特定样式（如 CSS 中的 ID）之间的区别。您希望能够将布局中的某些项目（例如标题）唯一标识为可以应用唯一样式的单个可识别项目，而其他项目（例如博客中的条目或数据库视图）都希望具有相同的样式。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-05T18:39:51.283

每个平台/技术都不同。

对于 WPF，看看 Josh Smith 所说的结构蒙皮： http: [//www.codeproject.com/KB/WPF/podder2.aspx](http://www.codeproject.com/KB/WPF/podder2.aspx)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-05T19:56:11.987

这应该相对容易，请按照下列步骤操作：

1.  去除整个 Web 应用程序或网站的所有样式
2.  使用 css 更改您的应用程序的外观。

有关更多信息，请访问[css zen garden](http://www.csszengarden.com/)以获取想法。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-05T20:28:19.007

你不应该。或者至少你应该问问自己这是否真的是正确的决定。

蒙皮打破了 UI 设计准则。它会“吸引”用户，因为您的皮肤应用程序运行起来看起来与他们使用的所有其他应用程序完全不同。命令快捷键之类的东西将不一致，它们会失去生产力。由于屏幕阅读器将更难理解它，因此它的无障碍访问会减少。

有很多理由不去皮肤。如果您只是想让您的应用程序在视觉上与众不同，我认为这是一个糟糕的理由。您将使您的应用程序更难使用，并且人们不太可能超过试用期。

说了这么多，有一些类别的应用程序基本上需要换肤，例如媒体播放器和身临其境的全屏游戏。但是，如果您的应用程序不是在很大程度上强制要求换肤的类别，我会认真考虑寻找其他方法来使您的应用程序比您的竞争对手更好。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-05T18:43:36.127

根据您希望挖掘的深度，您可以选择使用“格式化”框架（例如 Java 的 PLAF、Web 的 CSS）或完全解耦的多层架构。

如果你想定义一个可插拔的皮肤，你需要从一开始就考虑到这一点。表示层对业务逻辑*一无所知*，但它是 API，反之亦然。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-05T20:17:36.063

似乎这里的大多数人都提到 CSS，好像它是唯一的皮肤选项。Windows Media Player（和 Winamp、AFAIR）使用 XML 以及图像（如果需要）来定义皮肤。

XML 引用挂钩、事件等并处理事物的外观和反应。我不确定他们如何处理后端，但加载给定的皮肤实际上就像定位适当的 XML 文件、加载图像然后将它们放置在需要去的地方一样简单。

XML 还使您可以更好地控制您可以做什么（即创建新组件、更改组件大小等）。

XML 与 CSS 相结合可以为桌面或 Web 应用程序的皮肤引擎提供出色的结果。

# windows - 如何在 Windows 上应用差异补丁？

> ID：517257
> 
> 赞同：146
> 
> 时间：2009-02-05T18:33:45.460
> 
> 标签：windows, diff, gnu, patch

有很多程序可以创建差异补丁，但我正在尝试应用一个。我正在尝试分发补丁，但我收到了用户关于如何应用它的问题。所以我自己想办法搞清楚，发现自己一点头绪都没有，能找到的工具大多都是命令行的。（我可以处理命令行，但是如果没有漂亮、友好的 GUI，很多人会迷失方向。所以这些对这个目的没有好处。）

我尝试使用 TortoiseSVN。我有我想应用的补丁。我右键单击补丁，在 TortoiseSVN 子菜单下有一个选项，上面写着“应用补丁”。它所做的只是打开一个空窗口。

所以我试着点击打开。它有两个选项：合并和应用统一差异。（幸运的是，补丁是统一的差异格式。）但是 apply 选项不起作用：它要求提供补丁和文件夹。不知何故，它忘记询问*要应用补丁的文件！*所以 TortoiseSVN 只是普通的不起作用。是否有基于 Windows GUI 的实用程序可以获取补丁和文件并正确应用它？

编辑：查看到目前为止的回复，似乎 Tortoise 只有在它是一个已经版本化的文件时才会正确。这不是这里的情况。我需要能够将补丁应用于不是来自 SVN 存储库的文件。我刚刚尝试使用 Tortoise，因为我碰巧知道 SVN 使用差异并且必须知道如何创建和应用它们。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2011-03-24T07:16:39.517

**应用补丁**

# 使用 TortoiseMerge：

1.  查找并打开现有的 SVN 存储库目录
2.  创建一个名为“merges”的新目录，如果它不存在的话
3.  复制要应用 .patch 文件的文件
4.  **在继续下一步之前添加并提交到 svn 存储库**
5.  右键单击合并并选择**应用补丁...**
6.  双击列表中的文件
7.  带有差异的修补文件显示在右侧窗格中
8.  单击该窗格并点击**保存**或导出**文件->另存为...**

如果您从 TortoiseMerge 打开，则另一种筛选方式。在下面的屏幕中，目录是指上面步骤 2 中提到的“合并”目录： ![筛网](https://i.stack.imgur.com/LsShb.png)

WinMerge GUI 截图： ![筛网](https://i.stack.imgur.com/nvzBk.png)

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2012-02-28T15:48:08.313

我为此制作了[纯 Python 工具](https://github.com/techtonik/python-patch/blob/master/patch.py)。它具有可预测的跨平台行为。尽管它不创建新文件（在撰写本文时）并且缺少 GUI，但它可以用作创建图形工具的库。

**更新**：如果您安装了 Python，使用它应该会更方便。

```
pip install patch
python -m patch 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2010-09-28T17:17:11.587

[TortoiseMerge](http://tortoisesvn.tigris.org/TortoiseMerge.html)是一个单独的实用程序，它与 TortoiseSVN 捆绑在一起。

它也可以在[TortoiseDiff.zip](http://sourceforge.net/projects/tortoisesvn/files/Tools/)存档中单独下载。这将允许您将统一差异应用于非版本化文件。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2010-04-19T11:33:12.693

我知道您说过您更喜欢 GUI，但命令行工具可以很好地完成工作。请参阅[GnuWin](http://gnuwin32.sourceforge.net/)以将 unix 工具移植到 Windows。显然，您需要 patch 命令；-)

不过，您可能会遇到线路终止问题。GnuWin 端口将假定补丁文件具有 DOS 样式的行终止 (CR/LF)。尝试在相当智能的编辑器中打开补丁文件，它会为您转换它。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2016-12-01T20:10:23.420

Git 安装中的 patch.exe 实用程序适用于 Windows 10。

安装[适用于 Windows 的 Git，](https://git-scm.com/download/win)然后使用该`"C:\Program Files\Git\usr\bin\patch.exe"`命令应用补丁。

如果在应用补丁期间在输出中出现任何错误消息`Hunk #1 FAILED at 1 (different line endings).`，请尝试将`-l`（这是 的快捷方式`--ignore-whitespace`）或`--binary`开关添加到命令行。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-02-05T18:42:43.913

在 TortoiseSVN 中，补丁应用确实有效。*您需要将补丁应用到与创建*它相同的目录。牢记这一点始终很重要。下面是您在 TortoiseSVN 中的操作方式：

右键单击要应用补丁的文件夹。它将显示一个对话框，询问补丁文件的位置。选择文件，这应该会打开一个小文件列表窗口，其中列出了更改的文件，单击每个项目应该会打开一个差异窗口，显示补丁将对该文件执行的操作。

祝你好运。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2013-01-08T14:23:05.827

您可以使用补丁实用程序的[这个](http://unxutils.sourceforge.net/)Win32 本机端口。

它带有更多的其他实用程序选择，与 Cygwin 和类似的相比，它不需要任何 DLL 或类似的。只需选择您选择的小型可执行文件并将其存储在您想要的任何位置。

简单用法：

```
patch.exe -i <patchfile> 
```

获得更多帮助：

```
patch.exe --help 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2017-06-26T23:13:35.690

[我使用来自http://www.msys2.org/](http://www.msys2.org/)的 MSYS2

它提供了许多实用程序，例如`patch`、`which`、`git`、`tree`等等。

安装 MSYS2 后，只需运行包管理器即可安装`patch`：

```
pacman -S patch 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-05-10T06:26:12.090

TortoiseSVN (TortoiseMerge) 似乎[需要`Index: foobar.py`](http://groups.google.com/group/tortoisesvn/msg/54686dcdd3126af0)diff/patch 文件中的行。这是我需要做的，以使非 TortoiseSVN 补丁文件与 TortoiseSVN 的右键单击*应用补丁*命令一起工作。

前：

```
--- foobar.py.org   Sat May 08 16:00:56 2010
+++ foobar.py   Sat May 08 15:47:48 2010 
```

后：

```
Index: foobar.py
===================================================================
--- foobar.py
+++ foobar.py   (working copy) 
```

或者，如果您知道您的贡献者正在使用的特定版本：

```
Index: foobar.py
===================================================================
--- foobar.py   (revision 1157)
+++ foobar.py   (working copy) 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-02-05T21:05:05.453

> 编辑：查看到目前为止的回复，似乎 Tortoise 只有在它是一个已经版本化的文件时才会正确。这不是这里的情况。我需要能够将补丁应用于不是来自 SVN 存储库的文件。我刚刚尝试使用 Tortoise，因为我碰巧知道 SVN 使用差异并且必须知道如何创建和应用它们。

您可以安装[Cygwin](http://cygwin.com/)，然后使用命令行*补丁*工具来应用补丁。另请参见适用于*patch的*[Unix 手册页](http://linux.die.net/man/1/patch)。

 ** * *

## 回答 #11

> 赞同：2
> 
> 时间：2016-07-26T12:19:45.997

我已经在使用 BeyondCompare（商业）进行差异和合并，而且这个工具还[具有](http://www.scootersoftware.com/support.php?zz=kb_patch)创建、查看和应用补丁的能力。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-05-08T09:07:07.730

如果您使用[Mercurial](http://en.wikipedia.org/wiki/Mercurial)，这是通过“导入”完成的。因此，在命令行中，`hg import`命令或（您可能会发现该`--no-commit`选项很有用）或 Hg Workbench 中的“存储库”=>“导入...”。

请注意，这些将默认提交更改；`hg import --no-commit`如果使用命令行，或者使用 Hg Workbench，则可以避免使用此 选项，您可能会发现`hg rollback`在合并后发出它很有用。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-06-12T10:01:50.133

Eclipse应该可以做到，进入TeamSynchronize透视图，然后进入Project->Apply patch

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-02-05T18:46:43.937

补丁告诉它要应用到哪个文件。标题应该类似于（在记事本或您喜欢的文本编辑器中查看）：

```
--- Folder/old_file
+++ Folder/new_file 
```

在 Subversion 补丁的情况下，您也会有修订号（因为文件名相同）。

[GNU 补丁](http://savannah.gnu.org/projects/patch/)将允许您*覆盖*这些名称，但我不知道有任何 GUI 工具可以做到这一点。我会检查各种差异程序 - 不过，WinMerge 似乎不支持应用补丁。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2014-09-12T15:19:21.110

对于 Java 项目，我使用[NetBeans](http://en.wikipedia.org/wiki/NetBeans)来应用补丁文件。如果要修补的 Java 代码还不是 NetBeans 项目，请为其创建一个项目。要创建一个新项目：

*   选择菜单*文件*->*新建项目*
*   在出现的对话框中，将其*设为 Java Application project*。在对话框中为其命名，然后单击`Finish`。
*   右键单击项目名称，然后从上下文菜单中选择属性
*   在出现的对话框中，选择*Sources*，然后添加*Source Folder*。浏览到您的 Java 源代码。

现在你有了一个项目，应用补丁：

*   突出显示您的项目以选择它
*   从主菜单中，选择菜单*工具*->*应用差异补丁*
*   在出现的对话框中，浏览到您的补丁文件，选择它，然后按补丁按钮。

而已。应该应用您的补丁，并且您应该看到一个显示更改的差异窗口。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2020-11-17T00:06:13.973

# 使用 git Diff 或 linux patch 在 windows 上使用 git diff 应用补丁

使用 GNU patch 命令或 git diff 在 linux、MacOS 或其他任何地方创建的补丁都可以使用 git apply 在 windows 上应用。

## 创建补丁

例如，从 2 个目录创建补丁，其中 1 个或多个文件已更改：

`diff -Naru original_dir modified_dir > 0001-path-file.patch`

*   "-N" 将缺少的文件视为空文件，仅考虑修改的内容是必要的
*   “-a”将所有文件视为文本，不是强制性的，如果处理二进制补丁则需要删除。
*   “-r”递归用于目录遍历
*   "-u" 默认情况下围绕所有差异添加 3 行上下文

或使用 git diff

`git diff original_dir modified_dir > 0001-path-file.patch`

然后复制windows环境下的.patch文件以及包含原始未更改文件的original_dir目录。

## 使用 git diff 应用：

*   先决条件：安装 git，即从[https://git-scm.com/downloads](https://git-scm.com/downloads)

1 复制父目录下的补丁文件

2 cd 进入原目录

3 使用 git apply 应用补丁

```
copy 0001-path-file.patch ..\original_dir\
cd original_dir
git apply < 0001-path-file.patch 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2011-07-18T21:16:41.820

你有两个显示器吗？我在使用 TortoiseMerge 时遇到了同样的问题，我意识到当我禁用其中一个监视器时，会出现带有文件列表的小窗口。希望这对您有所帮助。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-02-05T18:43:26.080

使用 TortoiseSVN 应用补丁时，我通常将路径保存在签出存储库的根目录中。然后您应该能够右键单击补丁，进入 TortoiseSVN 菜单，然后单击 ApplyPatch。ApplyPatch 应该自动确定在目录层次结构中创建补丁的哪个级别。

但是，我过去在应用包含新文件或涉及重命名文件的补丁时遇到过问题。无论 Tortoise 使用什么算法，似乎都不能很好地处理这些场景。Unicode 可以给你类似的问题。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2013-08-24T12:51:29.693

如果您收到“不是工作副本”错误消息，请尝试从 TortoiseMerge 对话框中选择一个目录，该目录是 SVN 的工作目录。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2017-12-13T10:26:15.047

只需使用：

```
patch -p0 < path-file.patch 
```

请记住仅从您创建补丁的文件夹位置执行此命令。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2015-07-25T18:37:43.607

A [BusyBox](ftp://ftp.tigress.co.uk/public/gpl/6.0.0/busybox/) port for Windows has both a diff and patch command, but they only support unified format.

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2021-04-27T16:52:42.433

在响应之前关于补丁和 Python 3 的查询时，我收到错误 TypeError: can only concatenate str (not "bytes") to str

我的解决方案是在 _normalize_filenames 函数中更改源：

```
-        debug("    target = " + p.target)
-        debug("    source = " + p.source)
+        debug("    target = ", p.target)
+        debug("    source = ", p.source) 
```

然后补丁对我来说很好（Python 3，Windows 10）

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2021-03-18T11:47:44.197

如果您**在 Windows 上安装了 git**并且想要**为 git 存储库应用补丁**，您可以简单地**从 Windows Power Shell**执行：

```
git apply ..\0001-your-patch.patch 
```

# driver - 禁用/抑制 SD(HC) 写保护

> ID：517261
> 
> 赞同：4
> 
> 时间：2009-02-05T18:34:39.250
> 
> 标签：driver, sdhc

我知道 SD 卡中的写保护选项卡不是真正的硬件保护，而是向读卡器发出卡被写保护的简单信号。例如，佳能相机的 CHDK 项目特别忽略了它，并且曾经有一个廉价的闪存阅读器（香港邮寄 2 美元）无法识别它。

Windows 上是否有任何方法（注册表黑客、自定义驱动程序等）来防止设置此标志？我希望我的 SDHC 阅读器也忽略写保护选项卡；有没有人听说过/见过这样的事情？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-24T22:58:47.837

我不确定任何注册表，但从驱动程序的角度来看，控制器*必须支持此类功能（或缺少功能 ^_^），我怀疑这是标准化的。*

祝你好运

# c# - WPF C# - 更改菜单背景的画笔

> ID：517279
> 
> 赞同：11
> 
> 时间：2009-02-05T18:38:40.070
> 
> 标签：c#, wpf, menu, styles, menuitem

有谁知道如何更改菜单背景的画笔？这听起来很简单，但我没有看到任何明显的方法来做到这一点。你会认为 Background 属性会改变它，但事实并非如此。

这是我的菜单的样子（注意默认的白色背景）：

**示例代码：**

```
<Window x:Class="WpfApplication1.Window1"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
Title="Window1" Height="300" Width="300">

<Window.Resources>
    <SolidColorBrush x:Key="menuItemBrush"
                     Color="#FF505050" />
</Window.Resources>

<Grid x:Name="mainGrid"
      Background="#FF252525">

    <Menu x:Name="mainMenu"
          Background="{DynamicResource menuItemBrush}"
          Grid.ColumnSpan="2"
          VerticalAlignment="Top">

        <MenuItem x:Name="fileMenu"
                  Background="{DynamicResource menuItemBrush}"
                  Foreground="White"
                  Header="File">

            <MenuItem x:Name="fileOpenMenuItem"
                      Background="{DynamicResource menuItemBrush}"
                      Foreground="White"
                      Header="Open..." />

            <MenuItem x:Name="fileSaveMenuItem"
                      Background="{DynamicResource menuItemBrush}"
                      Foreground="White"
                      Header="Save" />

            <MenuItem x:Name="fileSaveAsMenuItem"
                      Background="{DynamicResource menuItemBrush}"
                      Foreground="White"
                      Header="Save As..." />

            <Separator Style="{DynamicResource menuItemSeperator}" />

            <MenuItem x:Name="fileExitMenuItem"
                      Background="{DynamicResource menuItemBrush}"
                      Foreground="White"
                      Header="Exit" />
        </MenuItem>
    </Menu>
</Grid> 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-06T03:47:53.550

我建议使用名为 kaxaml 的工具来编写样式。它包括几个代码片段、一个颜色选择器和一种即时查看 xaml 代码所做更改的好方法。这是您尝试执行的完整菜单样式。只需更改顶部的画笔颜色以满足您的需要。

```
<Page
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
  <Page.Resources>

  <!--**************************
    * STYLE: MenuItem
    ************************** -->
  <SolidColorBrush x:Key="HighlightedBackgroundBrush" Color="#FF797878" />
  <SolidColorBrush x:Key="MenuBackgroundBrush" Color="#FF505050" />
  <SolidColorBrush x:Key="NormalBorderBrush" Color="#FFFFFFFF" />
  <SolidColorBrush x:Key="SolidMenuFontBrush" Color="#FFFFFFFF" />
  <SolidColorBrush x:Key="HighlightedText" Color="#FFFFFFFF" />
  <Style x:Key="{x:Type Menu}" TargetType="{x:Type Menu}">
    <Setter Property="OverridesDefaultStyle" Value="True"/>
    <Setter Property="SnapsToDevicePixels" Value="True"/>
    <Setter Property="Height" Value="25"/>
    <Setter Property="Foreground" Value="{StaticResource SolidMenuFontBrush}"/>
    <Setter Property="Template">
      <Setter.Value>
        <ControlTemplate TargetType="{x:Type Menu}">
          <Border
            Background="{StaticResource MenuBackgroundBrush}"
            BorderBrush="{StaticResource MenuBackgroundBrush}"
            BorderThickness="1">
            <StackPanel ClipToBounds="True" Orientation="Horizontal" IsItemsHost="True"/>
          </Border>
        </ControlTemplate>
      </Setter.Value>
    </Setter>
  </Style>
  <Style x:Key="{x:Type MenuItem}" TargetType="{x:Type MenuItem}">
    <Setter Property="Template">
      <Setter.Value>
        <ControlTemplate TargetType="{x:Type MenuItem}">
          <Border x:Name="Border"
                  Background="{TemplateBinding Background}"
                  BorderBrush="{TemplateBinding BorderBrush}"
                  BorderThickness="1">
            <Grid>
              <Grid.ColumnDefinitions>
                <ColumnDefinition x:Name="Col0" MinWidth="17" Width="Auto" SharedSizeGroup="MenuItemIconColumnGroup"/>
                <ColumnDefinition Width="Auto" SharedSizeGroup="MenuTextColumnGroup"/>
                <ColumnDefinition Width="Auto" SharedSizeGroup="MenuItemIGTColumnGroup"/>
                <ColumnDefinition x:Name="Col3" Width="14"/>
              </Grid.ColumnDefinitions>

              <!-- ContentPresenter to show an Icon if needed -->
              <ContentPresenter Grid.Column="0" Margin="4,0,6,0" x:Name="Icon" VerticalAlignment="Center" ContentSource="Icon"/>

              <!-- Glyph is a checkmark if needed for a checkable menu -->
              <Grid Grid.Column="0" Visibility="Hidden" Margin="4,0,6,0" x:Name="GlyphPanel" VerticalAlignment="Center">
                <Path x:Name="GlyphPanelpath" VerticalAlignment="Center" Fill="{TemplateBinding Foreground}" Data="M0,2 L0,4.8 L2.5,7.4 L7.1,2.8 L7.1,0 L2.5,4.6 z" FlowDirection="LeftToRight"/>
              </Grid>

              <!-- Content for the menu text etc -->
              <ContentPresenter Grid.Column="1"
                                Margin="{TemplateBinding Padding}"
                                x:Name="HeaderHost"
                                RecognizesAccessKey="True"
                                ContentSource="Header"/>

              <!-- Content for the menu IGT -->
              <ContentPresenter Grid.Column="2"
                                Margin="8,1,8,1"
                                x:Name="IGTHost"
                                ContentSource="InputGestureText"
                                VerticalAlignment="Center"/>

              <!-- Arrow drawn path which points to the next level of the menu -->
              <Grid Grid.Column="3" Margin="4,0,6,0" x:Name="ArrowPanel" VerticalAlignment="Center">
                <Path x:Name="ArrowPanelPath" HorizontalAlignment="Right" VerticalAlignment="Center" Fill="{TemplateBinding Foreground}" Data="M0,0 L0,8 L4,4 z"/>
              </Grid>

              <!-- The Popup is the body of the menu which expands down or across depending on the level of the item -->
              <Popup IsOpen="{Binding Path=IsSubmenuOpen, RelativeSource={RelativeSource TemplatedParent}}" Placement="Right" x:Name="SubMenuPopup" Focusable="false" PopupAnimation="{DynamicResource {x:Static SystemParameters.MenuPopupAnimationKey}}">
                <Border x:Name="SubMenuBorder" BorderBrush="{Binding Path=Foreground, RelativeSource={RelativeSource AncestorType={x:Type Menu}}}" BorderThickness="1" Padding="2,2,2,2">
                  <Grid x:Name="SubMenu" Grid.IsSharedSizeScope="True">
                    <!-- StackPanel holds children of the menu. This is set by IsItemsHost=True -->
                    <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Cycle"/>
                  </Grid>
                </Border>
              </Popup>
            </Grid>
          </Border>

          <!-- These triggers re-configure the four arrangements of MenuItem to show different levels of menu via Role -->
          <ControlTemplate.Triggers>
            <!-- Role = TopLevelHeader : this is the root menu item in a menu; the Popup expands down -->
            <Trigger Property="Role" Value="TopLevelHeader">
              <Setter Property="Padding" Value="6,1,6,1"/>
              <Setter Property="Placement" Value="Bottom" TargetName="SubMenuPopup"/>
              <Setter Property="MinWidth" Value="0" TargetName="Col0"/>
              <Setter Property="Width" Value="Auto" TargetName="Col3"/>
              <Setter Property="Visibility" Value="Collapsed" TargetName="Icon"/>
              <Setter Property="Visibility" Value="Collapsed" TargetName="GlyphPanel"/>
              <Setter Property="Visibility" Value="Collapsed" TargetName="IGTHost"/>
              <Setter Property="Visibility" Value="Collapsed" TargetName="ArrowPanel"/>
            </Trigger>

            <!-- Role = TopLevelItem :  this is a child menu item from the top level without any child items-->
            <Trigger Property="Role" Value="TopLevelItem">
              <Setter Property="Padding" Value="6,1,6,1"/>
              <Setter Property="Visibility" Value="Collapsed" TargetName="ArrowPanel"/>
            </Trigger>

            <!-- Role = SubMenuHeader : this is a child menu item which does not have children -->
            <Trigger Property="Role" Value="SubmenuHeader">
              <Setter Property="DockPanel.Dock" Value="Top"/>
              <Setter Property="Padding" Value="0,2,0,2"/>
            </Trigger>

            <!-- Role = SubMenuItem : this is a child menu item which has children-->
            <Trigger Property="Role" Value="SubmenuItem">
              <Setter Property="DockPanel.Dock" Value="Top"/>
              <Setter Property="Padding" Value="0,2,0,2"/>
              <Setter Property="Visibility" Value="Collapsed" TargetName="ArrowPanel"/>
            </Trigger>
            <Trigger Property="IsSuspendingPopupAnimation" Value="true">
              <Setter Property="PopupAnimation" Value="None" TargetName="SubMenuPopup"/>
            </Trigger>

            <!-- If no Icon is present the we collapse the Icon Content -->
            <Trigger Property="Icon" Value="{x:Null}">
              <Setter Property="Visibility" Value="Collapsed" TargetName="Icon"/>
            </Trigger>

            <!-- The GlyphPanel contains the CheckMark -->
            <Trigger Property="IsChecked" Value="true">
              <Setter Property="Visibility" Value="Visible" TargetName="GlyphPanel"/>
              <Setter Property="Visibility" Value="Collapsed" TargetName="Icon"/>
            </Trigger>

            <!-- Using the system colors for the Menu Highlight and IsEnabled-->
            <Trigger Property="IsHighlighted" Value="true">
              <Setter Property="Background" Value="{StaticResource HighlightedBackgroundBrush}" TargetName="Border"/>
              <Setter Property="Foreground" Value="{StaticResource HighlightedText}"/>
              <Setter Property="BorderBrush" Value="{StaticResource NormalBorderBrush}" TargetName="Border"/>
            </Trigger>
            <Trigger Property="IsHighlighted" Value="false">
              <Setter Property="Background" Value="{StaticResource MenuBackgroundBrush}" TargetName="Border"/>
              <Setter Property="Foreground" Value="{StaticResource SolidMenuFontBrush}"/>
              <Setter Property="BorderBrush" Value="{StaticResource MenuBackgroundBrush}" TargetName="Border"/>
            </Trigger>
            <Trigger Property="IsEnabled" Value="false">
              <Setter Property="Foreground" Value="LightGray"/>
            </Trigger>
          </ControlTemplate.Triggers>
        </ControlTemplate>
      </Setter.Value>
    </Setter>
  </Style>
  </Page.Resources>
<Grid x:Name="mainGrid"
      Background="#FF252525">

    <Menu x:Name="mainMenu"
          Grid.ColumnSpan="2"
          VerticalAlignment="Top">

        <MenuItem x:Name="fileMenu"
                  Header="File">

            <MenuItem x:Name="fileOpenMenuItem"
                      Header="Open..." />

            <MenuItem x:Name="fileSaveMenuItem"
                      Header="Save" />

            <MenuItem x:Name="fileSaveAsMenuItem"
                      Background="{DynamicResource menuItemBrush}"
                      Header="Save As..." />
        </MenuItem>
    </Menu>
  </Grid>
</Page> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T18:48:01.000

如果不覆盖菜单项的模板，您将无法做到这一点。模板深处是一个名为“Part_Popup”的控件。你需要改变它的背景颜色。

# browser - 您觉得哪些 Web 开发浏览器插件有用？

> ID：517283
> 
> 赞同：5
> 
> 时间：2009-02-05T18:40:15.120
> 
> 标签：browser, plugins

我发现当我进行 Web 开发时，有一些浏览器插件对我非常有用。

对于我正在使用的 Firefox：

[Firebug](http://getfirebug.com/) - 非常适合检查 HTML 元素和使用 CSS。

[YSlow for Firebug](http://developer.yahoo.com/yslow/) - 由 Yahoo! 开发 并给出有关页面资源的时间安排和提示。

[实时 HTTP 标头](http://livehttpheaders.mozdev.org/)- 允许您检查发送到浏览器的标头。

对于 IE，我正在使用：

[Fiddler](http://www.fiddler2.com/fiddler2/) - “一个 Web 调试代理，它记录您的计算机和 Internet 之间的所有 HTTP(S) 流量”

我一直在寻找其他很棒的工具来使用。那么其他人都在使用什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-05T18:45:42.067

除了你所拥有的：

[Web Developer 工具栏](https://addons.mozilla.org/en-US/firefox/addon/60)添加了许多额外的功能（cookie、表单、图像检查、查看生成的 DOM 等）。

[HTML Validator](https://addons.mozilla.org/en-US/firefox/addon/249) - 非常适合快速检查以确保您的页面有效。当出现显示错误时也很好，您可以快速查看它是否来自不正确生成的 HTML。

[ColorZilla](https://addons.mozilla.org/en-US/firefox/addon/271) - 我经常使用它来将页面中的精确颜色提取到剪贴板。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-05T18:47:31.313

[Fireshot](https://addons.mozilla.org/en-US/firefox/addon/5648) - 截取屏幕截图并方便地对其进行注释，很有帮助。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-05T18:57:07.957

[扩展状态栏](https://addons.mozilla.org/en-US/firefox/addon/1433)修改状态栏以显示速度、百分比、时间和加载大小（用于查看正在加载的图像数量、页面重量等）

[ShowIP](https://addons.mozilla.org/en-US/firefox/addon/590)在状态栏中显示当前页面的 IP 地址

[外部 IP](https://addons.mozilla.org/en-US/firefox/addon/3372)在状态栏中显示您的外部 IP 地址

附带说明一下，我还发现在[FirefoxPortable](http://portableapps.com/apps/internet/firefox_portable)中运行这些扩展很有用，这样我就有了一个浏​​览器设置，专门用于安装相关扩展的开发工作，并避免减慢或破坏我的主浏览器（例如 Firebug曾经在访问 Gmail 时一直使我的浏览器崩溃）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T18:57:39.953

[URL 参数](https://addons.mozilla.org/en-US/firefox/addon/1290 "URL参数")（Firefox 扩展）用于查看网页的 POST 和 GET 参数。用于检查您的表格。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-05T19:05:24.383

[HttpFox](https://addons.mozilla.org/en-US/firefox/addon/6647)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-05T19:24:52.877

阻止您访问 StackOverflow 的功能非常有用。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-05T19:27:54.383

所有这些都是 Firefox 插件。

*   用于 Javascript 和 CSS 调试的[Firebug 。](http://getfirebug.com/)例如，Firebug 允许在 javascript 修改它时检查 DOM 树。Firebug 是我的主要工具。

*   [实时 HTTP 标头](http://livehttpheaders.mozdev.org/)，用于查看请求和响应中实际包含哪些数据。

*   [Web Developer 工具栏](https://addons.mozilla.org/en-US/firefox/addon/60)包含较小的实用程序。例如，它可以验证 html 和 CSS。

*   [Dust Me Selectors](http://www.sitepoint.com/dustmeselectors/)会发现哪些 CSS 片段未被使用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-05T18:51:46.547

[twitterfox](https://addons.mozilla.org/en-US/firefox/addon/5081)如何帮助 twitter 与开发人员的同事和朋友。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-05T19:03:26.883

[测量它](https://addons.mozilla.org/en-US/firefox/addon/539)

用于获取 FF 页面上呈现的项目的确切大小。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-05T19:09:54.560

Firebug - 另外让我看看 JS 请求从一个页面发送到另一个页面，以及正在发送哪些数据。
- 我可以看到 JS 变量中的数据
- 替换错误控制台。如果发现错误，它也会在雕像中输出，所以我可以检查它。
- 适合在开发 AJAX 应用程序时查看 html 的结构。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-05T18:44:09.277

[用于 Firefox 的IE 开发者工具栏](http://www.microsoft.com/en-us/download/details.aspx?id=18359)
[Venkman 调试器](http://www.mozilla.org/projects/venkman/)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-05T18:50:08.347

[Firecookie](https://addons.mozilla.org/en-US/firefox/addon/6683) 和[控制台 2](https://addons.mozilla.org/en-US/firefox/addon/1815)

# c# - 在 Windows mobile 5+ 中设置文件关联

> ID：517289
> 
> 赞同：2
> 
> 时间：2009-02-05T18:41:31.607
> 
> 标签：c#, windows-mobile

它与 Windows 中的基本相同，但是当您尝试将文件关联设置到位于包含空格的文件夹中的程序时，您需要获取该文件夹的“短”名称。在常规窗口中，我使用这个：

> [System.Runtime.InteropServices.DllImport("Kernel32.dll")] private static extern uint GetShortPathName(string lpszLongPath, [Out] StringBuilder lpszShortPath, uint cchBuffer);

所以我的问题变成了，有没有人知道我可以用来替换上述函数的内置函数，或者知道这个函数究竟做了什么，所以我可以在 C# 中重新创建它。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-06T00:55:42.367

Windows CE 是 WinMo 的基础，它不使用 8.3 文件命名任何东西，所以我确信您不需要使用它们来定义文件关联。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T19:52:02.293

谁说您需要在常规 Windows 中设置文件关联的短路径？我只是自己快速尝试了一下，将密钥添加到带有空格的注册表中没有问题。然后我仔细检查了注册表，果然，那里有空格。我与该程序关联的文件类型启动得很好，并且该程序位于一个到处都有多个空格的目录中。

# asp.net-mvc - ASP.NET MVC 在 IIS 5 下工作吗？

> ID：517316
> 
> 赞同：0
> 
> 时间：2009-02-05T18:46:23.860
> 
> 标签：asp.net-mvc

到目前为止，我必须使用 XP 作为我的开发机器。但是VS 2008的开发服务器好像不行，很奇怪！（VS 2005 运行良好）。我可以使用 IIS 5.1 来运行 ASP.NET MVC 吗？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T18:50:16.893

你可以。查看这篇文章以了解有关如何的详细信息：http: [//blogs.microsoft.co.il/blogs/dorony/archive/2007/12/15/using-asp-net-mvc-on-iis-5.aspx](http://blogs.microsoft.co.il/blogs/dorony/archive/2007/12/15/using-asp-net-mvc-on-iis-5.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T18:49:13.120

是的，您可以在 XP 上使用 IIS 来运行 MVC。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T18:50:24.727

是的，我让我的工作。在路由中将 url 扩展名更改为 .aspx。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-24T06:20:48.127

网址重写可以帮助您解决问题。我已经实现了允许在任何 IIS 版本上部署 MVC 应用程序的解决方案，即使使用虚拟主机也是如此。 [http://www.codeproject.com/KB/aspnet/iis-aspnet-url-rewriting.aspx](http://www.codeproject.com/KB/aspnet/iis-aspnet-url-rewriting.aspx)

# prototyping - 面向非程序员的原型设计工具 - 表达式？

> ID：517324
> 
> 赞同：2
> 
> 时间：2009-02-05T18:47:52.907
> 
> 标签：prototyping, expression-web

我们正在寻找一种原型制作工具，以允许我们的业务分析师（和我自己）模拟网站。有人建议为此使用 MS Expression 工具套件。我担心这对于非程序员来说可能有点过于技术化。

有没有人有使用 Expressions Web（或 Blend）作为原型工具的经验？有没有其他人会推荐的。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-05T18:57:42.510

看看[Balsamiq 模型](http://www.balsamiq.com/products/mockups)。

非常易于使用，生成的模型实际上看起来像模型。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-05T18:52:58.980

我不建议这样做。您应该使用不适合实际应用程序设计的东西。模型不应该看起来很真实，并且您的模型工具应该不难使用。当模型看起来真实时，当实际产品看起来不同时，用户会感到困惑。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T19:58:53.853

Visio 可以很好地解决这个问题。通常对于模型，您应该查看页面上的信息片段、总体布局、顶部的菜单、中间的内容。

如果你用 HTML 构建你的模型，你可能会花很多时间摆弄在项目早期无关紧要的事情，颜色，精确间距等。因为它是一个“真实”的形式，你也会得到很多关于这些的反馈项目。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-10T22:15:27.057

您甚至不需要计算机，只需获取[GUI Mags](http://www.guimags.com/index.php?p=concept&nav=nav_concept)即可。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-10T23:18:36.983

如果您熟悉 Eclipse，请查看[WireframeSketcher](http://wireframesketcher.com)。这是我正在开发的用于快速绘制屏幕模型的插件。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-06-30T07:48:48.057

[此处](http://c2.com/cgi/wiki?GuiPrototypingTools)提供了此类工具的完整列表。

其中一些是针对非程序员的（就像我自己的[MockupScreens 一样](http://mockupscreens.com)，它也在上面的列表中），但大多数可以由业务分析师、UX 设计师等使用。

真正的区别在于该工具是针对沟通（例如与用户一起阐明需求）还是针对应用程序设计（即模型尽可能精确和完整）

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-02-10T23:25:42.143

[Axure RP](http://www.axure.com/)是我见过的最好的工具。

它很贵（提供免费试用），但绝对很棒。超越静态线框，允许您模拟交互、导航、行为等。生成的原型可以从任何 Web 浏览器查看/使用，它可以让您对它们进行注释并直接从原型生成静态文档（Word 文档等）。

# asp.net - sql 身份验证或 Windows 身份验证

> ID：517327
> 
> 赞同：0
> 
> 时间：2009-02-05T18:48:10.487
> 
> 标签：asp.net, sql-server, permissions

对于我的带有表单身份验证的 asp.net 网站，我将使用 Windows 集成安全性来访问 sql 数据库。我将授予 ASPNET 或 NETWORK SERVICE 的 DB 权限。在什么情况下我会改用 SQL 身份验证？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-05T18:52:07.903

当您的站点由外部 ISP 托管时，通常也需要 SQL 身份验证。它们通常不支持 Windows 身份验证或不允许您向 Windows 帐户授予权限。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-05T18:50:54.007

当您需要非 Windows 机器建立数据库连接时，请使用 SQL Auth。

请记住，它添加了另一个攻击向量（另一组用于危害机器的凭据），因此请确保在使用它之前确实需要它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-05T19:06:54.847

当您不能使用 Windows 身份验证时，您确实使用 SQL 身份验证。在我看来，这是唯一一次。Windows 身份验证更安全，可以在使用 Active Directory 的地方集中管理。如果您有真正知道如何管理 Active Directory 的人并且您处于 Windows 环境中，那么没有充分的理由使用 sql 身份验证。

使用 Sql 身份验证，您必须管理连接字符串中的密码等，这意味着为了更改访问数据库的帐户，必须有人知道应用程序的功能或至少知道信息的存储位置。使用 Windows 身份验证，网络管理员所要做的就是在 IIS 应用程序设置中输入正确的用户名和密码，然后您就可以开始摇滚了。无需开发人员交互。

您有额外的步骤来保护连接字符串信息，因为密码等在存储在配置文件中时应该被加密。与 Windows 身份验证相比，使用 Sql Server 身份验证有效且安全地涉及更多步骤。如果使用相同的 sql server 凭据跨多个服务器访问多个数据库，则尤其如此。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-05T18:54:23.640

如果要完全管理用户帐户，则应使用 SQL 身份验证。这样，您就可以完全控制用户帐户。例如，您可以强制他们输入私人信息。

此外，就像 Corbin 提到的，如果客户端没有运行 Windows 操作系统，则不能使用 Windows 身份验证（显然）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-05T19:07:36.127

请注意，Windows 身份验证是推荐的身份验证模式，原因很简单，它继承了操作系统身份验证。如上所述，您可能不使用 Windows 身份验证的因素有很多。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-05T19:41:54.700

那要看。如果您正在开发内部 Web 应用程序并且网络 IT 人员在大厅里，那么请使用 Windows 身份验证。如果您将应用程序部署给客户并且无法控制他们的网络基础设施，那么我将使用 SQL 身份验证

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-06T04:18:43.207

如果您无法控制 Active Directory（例如在托管情况下）或有用户使用 Windows 以外的操作系统，则您别无选择。

是否需要使用一些脚本即时创建用户帐户？对于 sql 用户来说，它必须比 Active Directory 更容易（可能并非不可能）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-06T04:29:11.953

除了以上所有，考虑这样的情况：

您需要使用的帐户来自域 A。数据库在域 B 上。域 A 和域 B 没有信任关系。

您将需要 SQL 身份验证才能克服这种情况。希望这可以帮助。

（为了更清楚）：数据库未在活动目录中注册。那么不可能使用windows身份验证。

# apache - 使用 SSL 的 Apache 名称虚拟主机

> ID：517336
> 
> 赞同：40
> 
> 时间：2009-02-05T18:50:21.980
> 
> 标签：apache, ssl, ssl-certificate

我正在尝试设置我们的服务器以允许通过 SSL 进行流量。我知道 SSL 不适用于 Name Virtual Host，但我们所有的 apache 服务器都位于具有专用私有 IP 的虚拟机上。我们有一个主虚拟机，它设置了 mod_proxy 来将流量路由到适当的虚拟机。

但是，为了路由 https 流量，我们需要在代理和 vms 上安装证书。我们有一个通配符证书，可以在我们所有的主机上使用。一切似乎都正常工作，但我在代理的 apache 日志中收到以下内容：

[警告] 初始化：SSL 服务器 IP/端口冲突：host1.domain.com:443 (/etc/apache2/sites-enabled/host1:1) 与 host2.domain.com:443 (/etc/apache2/sites-启用/host2:1)

我们在代理上设置的每个主机都有这些错误消息之一。我们的代理虚拟主机设置如下：

```
<VirtualHost ipaddress:443>
    ServerName host1.domain.com
    ProxyPreserveHost On
    ProxyRequests Off
    ProxyPass / https://privateip:443/
    ProxyPassReverse / https://privateip:443/

    SSLProxyEngine on
    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/server.crt
    SSLCertificateKeyFile /etc/ssl/private/server.key
</VirtualHost> 
```

有什么办法可以让它工作吗？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-02-05T20:42:27.730

听起来 Apache 警告你有多个`<VirtualHost>`部分具有相同的 IP 地址和端口......至于让它在没有警告的情况下工作，我认为你需要使用类似服务器名称指示 (SNI) 的东西，一种方式识别作为 SSL 握手的一部分请求的主机名。基本上，它允许您通过 SSL 进行基于名称的虚拟主机，但我不确定浏览器对它的支持程度。除了 SNI 之类的东西之外，对于公开给公共互联网的每个 IP 地址，您基本上只能使用一个启用 SSL 的域名。

当然，如果您能够正确访问这些网站，您可能会很好地忽略这些警告。这些特殊的不是很严重-它们主要是指示您遇到问题时应该查看的内容

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-02-15T09:16:41.283

据我所知，Apache 从 2.2.12 版开始支持 SNI 遗憾的是，文档还没有反映这种变化。

去[http://wiki.apache.org/httpd/NameBasedSSLVHostsWithSNI](http://wiki.apache.org/httpd/NameBasedSSLVHostsWithSNI)直到完成

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-05T22:29:30.227

您也许可以更换：

```
VirtualHost ipaddress:443 
```

和

```
VirtualHost *:443 
```

您可能需要在所有 virt 主机上执行此操作。

它可能会清除该消息。让 ServerName 指令担心路由消息请求。

同样，如果您对同一台机器有多个 ip 的别名，您可能无法执行此操作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-12-21T10:30:38.653

VirtualHost 看起来像这样：

```
NameVirtualHost IP_Address:443

<VirtualHost IP_Address:443>
    SSLEngine on
    SSLCertificateFile /etc/pki/tls/certs/ca.crt    # Where "ca" is the name of the Certificate
    SSLCertificateKeyFile /etc/pki/tls/private/ca.key
    ServerAdmin webmaster@domain_name.com
    DocumentRoot /var/www/html
    ServerName www.domain_name.com
    ErrorLog logs/www.domain_name.com-error_log
    CustomLog logs/www.domain_name.com-access_log common
</VirtualHost> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-12T17:31:43.817

Apache 不支持基于名称的虚拟主机上的 SSL，仅支持基于 IP 的虚拟主机。

来源：Apache 2.2 SSL FAQ question[为什么不能使用基于名称的虚拟主机来识别不同的 SSL 虚拟主机？](http://httpd.apache.org/docs/2.2/ssl/ssl_faq.html#vhosts2)

与 SSL 不同，TLS 规范允许基于名称的主机（其他人提到的 SNI），但 Apache 尚不支持此功能。当针对 openssl 0.9.8 编译时，它应该会在未来的版本中。

此外，[mod_gnutls](http://www.outoforder.cc/projects/apache/mod_gnutls/)声称支持 SNI，但我从未真正尝试过。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-10-01T19:14:24.953

首先你需要 NameVirtualHost ip:443 在你的配置文件中！最后你可能有一个 80 的，但你也需要一个 443 的。

其次，您需要一个 *.domain 证书（通配符）（可以制作一个）

第三，您只能在一个 ip 中创建 something.domain 网站（因为证书）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2018-07-26T06:26:55.587

您必须添加以下部分以启用`NameVirtualHost`具有给定 IP 的功能。

```
NameVirtualHost IP_Address:443 
```

# python - 在 Django 模型字段中存储二进制哈希值

> ID：517349
> 
> 赞同：9
> 
> 时间：2009-02-05T18:51:49.857
> 
> 标签：python, django, encoding, django-models, binary-data

我有一个 20 字节的十六进制哈希，我想将它存储在 django 模型中。如果我使用文本字段，它会被解释为 unicode 并且返回乱码。

目前我正在对其进行编码和解码，这确实使代码混乱，因为我必须能够通过它进行过滤。

```
def get_changeset(self):
    return bin(self._changeset)

def set_changeset(self, value):
    self._changeset = hex(value)

changeset = property(get_changeset, set_changeset) 
```

这是过滤的示例

```
Change.objects.get(_changeset=hex(ctx.node())) 
```

这是 django 开发人员推荐的方法，但我真的很难接受仅存储 20 个字节就这么丑陋的事实。

也许我太纯粹了，但理想情况下我可以写

```
Change.objects.get(changeset=ctx.node()) 
```

这些属性允许我写：

```
change.changeset = ctx.node() 
```

所以这就是我可以要求的。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2017-08-09T12:24:38.850

从 1.6 开始，Django[`BinaryField`](https://docs.djangoproject.com/en/1.11/ref/models/fields/#binaryfield)允许存储原始二进制数据。[`UUIDField`](https://docs.djangoproject.com/en/1.11/ref/models/fields/#uuidfield)但是，对于高达 128 位的哈希值和其他值，在 Django 1.8+中使用它更有效（至少对于 PostgreSQL 后端） 。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-05T19:23:07.467

我假设如果您正在编写原始 SQL，您将使用 Postgres bytea 或 MySQL VARBINARY。有[一张带有补丁](http://code.djangoproject.com/ticket/2417)（标记为“需要测试”）的票，据称它制作了这样的字段（票 2417：支持二进制类型字段（又名：postgres 中的 bytea 和 mysql 中的 VARBINARY））。

否则，您可能会尝试编写[自定义字段类型](http://docs.djangoproject.com/en/dev/howto/custom-model-fields/)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-06T00:59:44.013

“我有一个 20 字节的十六进制哈希，我想将它存储在 django 模型中。”

Django 这样做。他们使用十六进制摘要，从技术上讲，它们是字符串。不是字节。

不要使用`someHash.digest()`-- 你得到的字节是你不能轻易存储的。

使用`someHash.hexdigest()`-- 你得到一个字符串，你可以很容易地存储它。

**编辑**——代码几乎相同。

见[http://docs.python.org/library/hashlib.html](http://docs.python.org/library/hashlib.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-05T19:52:58.390

您还可以编写自己的自定义[模型管理器](http://docs.djangoproject.com/en/dev/topics/db/managers/#topics-db-managers)，为您进行转义和取消转义。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-09-19T14:22:44.573

如果这个问题仍然令人感兴趣，Disqus`django-bitfield`符合要求：

[https://github.com/disqus/django-bitfield](https://github.com/disqus/django-bitfield)

... GitHub 上的示例代码起初有点令人困惑，因为模块的实际功能，因为 asinine 变量名称 - 通常我几乎不是那种有资金或高地的人拿别人的愚蠢标识符来完成任务……但是`flaggy_foo`？？Srsly，你们。

如果该项目不符合您的口味，并且您正在使用 Postgres，那么您有很多出色的选择，因为许多人已经为利用 Postgres 的本机类型的各种 Django 字段编写和发布了代码。这是一个`hstore`模型字段：

[https://github.com/jordanm/django-hstore——](https://github.com/jordanm/django-hstore)我用过这个，效果很好。

这是一个使用 Postgres 的 termvector 类型的全文搜索实现：

[https://github.com/aino/django-pgindex](https://github.com/aino/django-pgindex)

虽然我不能保证这个特定项目，但也有 Django`bytea`字段：

[https://github.com/aino/django-arrayfields](https://github.com/aino/django-arrayfields)

# java - 数据源动态变化时如何设计DAO

> ID：517353
> 
> 赞同：4
> 
> 时间：2009-02-05T18:53:02.940
> 
> 标签：java, spring, dao

通常在定义 DAO 时，您将有一个用于 DAO 对象上的数据源的设置器。我的问题是我们的数据源会根据对服务器的请求而动态变化。即每个请求都可以访问不同的数据库实例。

该请求包含逻辑属性，稍后可用于检索与请求数据库的连接。

因此，当依赖注入 DAO 到业务逻辑对象时，我需要一种在运行时（而不是配置时）设置 DAO 属性的方法。

一种解决方案是将数据源存储在本地线程上，但我不太喜欢弄乱线程本地变量。

另一种选择是在业务逻辑对象上有一个初始化方法，该方法使用请求属性在 DAO 上调用初始化。

我想这是一个常见的问题，你能提出一个常见的解决方案吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-05T19:07:58.857

你的问题有点混乱。让一个 DAO 访问多个不同的数据源似乎是一场维护噩梦。因此，您应该定义一个包含您想要调用的所有方法的 DAO 接口。对于您要连接的每个数据库，我将构建一个实现您的 DAO 接口的新类。这允许您有多个实现。然后，我会将这些实现（每个都有自己的数据源）存储在 Map (java.util.Map) 中，使用您的“逻辑属性”作为映射的键。由于您的所有 DAO 实现都实现了您的接口，您将能够将它们转换为接口并互换使用它们。在您的业务对象上，您将注入 DAO 实现的 Map。我希望这对您的设计有所帮助。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-05T20:25:35.580

我在客户端/服务器项目中遇到了这样的问题。Client 和 Server 项目共享 Dao 接口。而当我以前做数据库操作时，我必须选择合适的 Dao 实现。我的解决方案是这样的：

```
IVehicleDao vehicleDao =daoFactory.Get<IVehicleDao>(parameters);
vehicleDao.doSomething(); 
```

通过传递参数从工厂获取 dao。在 Dao 工厂内部决定返回哪个 Dao 实现。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-08T18:24:53.900

你可能想看看这个类：

[http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/jdbc/datasource/lookup/AbstractRoutingDataSource.html](http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/jdbc/datasource/lookup/AbstractRoutingDataSource.html)

这将使您的服务对象和数据访问对象更容易忽略存在任何动态数据源的概念。

通常，您需要实现 servlet 过滤器并使用 ThreadLocal，以便 AbstractRoutingDataSource 使用的 DataSourceLookup 实现可以轻松访问指示返回哪个 DataSource 的请求参数。如果您真的想避免这种情况，您可以实现一个 servlet 过滤器，该过滤器在请求范围的 bean 上设置属性，并将该 bean 注入您编写的 DataSourceLookup 实现中。请求范围的 bean 在它们的实现中仍然使用 ThreadLocal，但至少这样它是 Spring 的 impl，而不是你的，你不需要担心它。:)

Spring 团队的这篇博客文章详细介绍了类似的方法：

[http://blog.springsource.com/2007/01/23/dynamic-datasource-routing/](http://blog.springsource.com/2007/01/23/dynamic-datasource-routing/)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-05T20:23:22.493

听起来您的问题是您正在为应用程序创建单个 DAO 实例。您要么需要为每个数据源创建一个单独的实例（也许制作某种 dao 控制器来为您管理这一切），或者可能允许您的 dao 中的方法是静态的，并传递有关如何连接到数据源的所有信息以及您在每种方法中持久保存的数据。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-08-20T20:09:51.600

I already did this. You need to create one DAO each class, and in the scope of your DAO you need to pass the DATASOURCE and finally one class CONTROLLER where you do dynamic calling to DAO.

# python - Python中的字符串格式化

> ID：517355
> 
> 赞同：40
> 
> 时间：2009-02-05T18:53:29.103
> 
> 标签：python, string, formatting

我想做类似`String.Format("[{0}, {1}, {2}]", 1, 2, 3)`返回的事情：

```
[1, 2, 3] 
```

我如何在 Python 中做到这一点？

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2009-02-05T19:16:29.243

之前的答案使用了 % 格式，在 Python 3.0+ 中将逐步淘汰。假设您使用的是 Python 2.6+，这里描述了一个更面向未来的格式化系统：

[http://docs.python.org/library/string.html#formatstrings](http://docs.python.org/library/string.html#formatstrings)

尽管还有更高级的功能，但最简单的形式最终看起来非常接近您编写的内容：

```
>>> "[{0}, {1}, {2}]".format(1, 2, 3)
[1, 2, 3] 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-03-10T04:54:35.753

你可以通过三种方式做到这一点：

* * *

使用 Python 的自动漂亮打印：

```
print [1, 2, 3]   # Prints [1, 2, 3] 
```

使用变量显示相同的内容：

```
numberList = [1, 2]
numberList.append(3)
print numberList   # Prints [1, 2, 3] 
```

* * *

使用“经典”字符串替换（ala C 的 printf）。请注意此处 % 作为字符串格式说明符的不同含义，以及将列表（实际上是元组）应用于格式化字符串的 %。（注意 % 用作算术表达式的模（余数）运算符。）

```
print "[%i, %i, %i]" % (1, 2, 3) 
```

请注意，如果我们使用预定义的变量，我们需要将其转换为元组来执行此操作：

```
print "[%i, %i, %i]" % tuple(numberList) 
```

* * *

使用 Python 3 字符串格式。这在早期版本（从 2.6 开始）中仍然可用，但在 Py 3 中是“新”的方式。请注意，您可以使用位置（序数）参数，或命名参数（我已经放了它们以相反的顺序。

```
print "[{0}, {1}, {2}]".format(1, 2, 3) 
```

请注意名称“一”、“二”和“三”可以是任何有意义的名称。）

```
print "[{one}, {two}, {three}]".format(three=3, two=2, one=1) 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-02-05T18:59:07.563

您正在寻找字符串格式，它在 python 中基于 C 中的 sprintf 函数。

```
print "[%s, %s, %s]" % (1, 2, 3) 
```

完整的参考请看这里： [http ://docs.python.org/library/stdtypes.html#string-formatting](http://docs.python.org/library/stdtypes.html#string-formatting)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-07-10T00:05:15.810

要按顺序打印元素，请使用 {} 而不指定索引

```
print('[{},{},{}]'.format(1,2,3)) 
```

（从 python 2.7 和 python 3.1 开始工作）

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2018-02-03T15:32:01.897

PEP 498`python 3.6`加入了文字字符串插值，基本上是`format`.

您现在可以执行以下操作：

```
f"[{1}, {2}, {3}]" 
```

我发现有用的其他常见用途是：

```
pi = 3.141592653589793
today = datetime(year=2018, month=2, day=3)

num_2 = 2     # Drop assigned values in
num_3 = "3"   # Call repr(), or it's shortened form !r
padding = 5   # Control prefix padding
precision = 3 #   and precision for printing

f"""[{1},
     {num_2},
     {num_3!r},
     {pi:{padding}.{precision}},
     {today:%B %d, %Y}]""" 
```

这将产生：

```
"[1,\n     2,\n     '3',\n      3.14,\n     February 03, 2018]" 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-05T18:56:15.713

你没有很好地表达自己，但我敢猜测这就是你要找的：

```
foo = "Hello"
bar = "world"
baz = 2
print "%s, %s number %d" % (foo, bar, baz) 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-02-26T16:18:20.477

我认为缺少这种组合：P

```
"[{0}, {1}, {2}]".format(*[1, 2, 3]) 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-04-12T11:49:34.300

你有很多解决方案:)

**简单的方式（C风格）**：

```
print("[%i, %i, %i]" %(1, 2, 3)) 
```

**使用[str.format()](https://docs.python.org/2/library/string.html#format-string-syntax)**

```
print("[{0}, {1}, {2}]", 1, 2, 3) 
```

**使用[str.Template()](https://docs.python.org/3/library/string.html#string.Template.template)**

```
s = Template('[$a, $b, $c]')
print(s.substitute(a = 1, b = 2, c = 3)) 
```

您可以阅读[PEP 3101 -- 高级字符串格式](https://www.python.org/dev/peps/pep-3101/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-10-10T13:03:32.457

如果您不知道列表中有多少项，这种方法是最通用的

```
>>> '[{0}]'.format(', '.join([str(i) for i in [1,2,3]]))

'[1, 2, 3]' 
```

字符串列表更简单

```
>>> '[{0}]'.format(', '.join(['a','b','c']))
'[a, b, c]' 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-11-27T13:13:35.333

非常简短的回答。

示例： print("{:05.2f}".format(2.5163)) 返回 02.51

*   {} 在这里设置变量
*   : 开始造型
*   0 以零开头，" " 以空格开头
*   5**完整字符串的长度**（点数，00.00 是 len 5 而不是 4）
*   .2 点后两位数，四舍五入。
*   f 用于花车

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-08-27T15:42:13.913

**在回答这个问题之前，请先阅读以下几篇文章：**

Python 官方文档[在这里](https://docs.python.org/3.4/library/string.html#string.Formatter)

**有用的文章**：

*   Python字符串格式（） -[这里](https://www.programiz.com/python-programming/methods/string/format)

现在让我们来回答这个问题

**问题**：我想做类似的事情：

`String.Format("[{0}, {1}, {2}]", 1, 2, 3)`返回：

`[1, 2, 3]`

我如何在 Python 中做到这一点？

**答案**：

好吧，这当然是一个单行代码答案，即

`print("[{0},{1},{2}]".format(1, 2, 3))`

当您执行这一行代码时，`[1, 2, 3]`将打印一个包含三个值的列表。我希望这非常简单且不言自明。

**谢谢**

塔努

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-09-02T01:17:27.420

从[python-3.6 开始](/questions/tagged/python-3.6 "显示标记为“python-3.6”的问题")，Python 支持[*文字字符串插值*[pep-498]](https://www.python.org/dev/peps/pep-0498/)。`f`因此，您可以使用字符串的前缀进行格式化。例如：

```
x = 1
y = 2
z = 3
**f'**[{x}, {y}, {z}]**'**
```

这会产生：

```
>>> f'[{x}, {y}, {z}]'
'[1, 2, 3]' 
```

在问题中的 C#（ 的语言`String.Format(…)`）中，由于[c#-6.0](/questions/tagged/c%23-6.0 "显示标记为“c#-6.0”的问题")，还支持[*字符串插值*[microsof-tdoc]](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/tokens/interpolated)，例如：

```
int x = 1;
int y = 2;
int z = 3;
string result = **$"**[{x}, {y}, {z}]**"**;
```

例如：

```
csharp> int x = 1;
csharp> int y = 2;
csharp> int z = 3;
csharp> $"[{x}, {y}, {z}]";
"[1, 2, 3]" 
```

# cocoa-touch - 循环交换 UIImageView 图像

> ID：517357
> 
> 赞同：0
> 
> 时间：2009-02-05T18:54:02.347
> 
> 标签：cocoa-touch

我有一个 UIImageViews 的 NSArray，我想循环并快速换出“开”和“关”状态。我在 for 循环中编写了执行此操作的代码，而不是在用户点击 UIButton（按钮的操作）时调用的方法。

这是那个循环：

```
for(int i = 0; i < [Images count]; i++) {
    if( i > 0 ){
        [self toggleImageViewOff:[Images objectAtIndex:i - 1]];
    }

    [self toggleImageViewOn:[Images objectAtIndex:i]];

    [NSThread sleepForTimeInterval:0.5f];
} 
```

UI 没有像我预期的那样更新，因为我只看到最后一个 UIImageView 处于“开启”状态。我认为视图的绘图更新必须发生在该代码也在执行的主线程中。所以我了解了 performSelectorInBackground:withObject: 。使用它执行 toggleImageViewOn/Off 方法使循环工作。问题是，如果我将睡眠间隔设置得太短，我可以在“关闭”之后进行“开启”更新，而线程运行无序。

所以我有一个好主意，将整个循环与 sleep 一起移动到它自己的方法中，并使用 performSelectorInBackground:withObject: 从 action 方法中调用它。我试过了，在循环结束之前我不会得到更新的视图。

这是一个冗长的方式来解决我的问题：

对此进行动画处理以保证开/关代码以正确的顺序触发并仍然获得视图更新的最佳方法是什么，即使在高速下也是如此？（即循环非常快）

我试图考虑如何使用 CoreAnimation 来做，但我似乎无法理解如何在那里做。

作为奖励，这里是切换方法：

```
- (void)toggleImageViewOn:(UIImageView *)theImageView {
    [theImageView setImage:[UIImage imageNamed:@"on.png"]];
}

- (void)toggleImageViewOff:(UIImageView *)theImageView {
    [theImageView setImage:[UIImage imageNamed:@"off.png"]];
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T19:31:24.923

您是否围绕这个 for 循环设置了动画上下文（UIView 类方法会这样做）？没有它，变化是立即的，而不是动画的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-06T15:58:24.480

问题是您没有给任何 UIImages 时间来绘制。绘制代码被优化为只绘制需要的东西——渲染所有这些中间阶段都被优化了。

休眠主线程实际上并没有给它运行的机会。

Bill 是对的，因为您需要围绕循环设置动画上下文。这将捕获您所做的所有 UIView 更改，然后将它们播放出来。最简单的方法是使用核心动画。核心动画“记录” UIElemenets 中的变化并回放它们。您的代码（没有睡眠）将在核心动画块中正常工作。

[Apple在他们的网站上](http://developer.apple.com/documentation/graphicsimaging/Conceptual/CoreAnimation_Cookbook/Introduction/Introduction.html)有一本合理的 Core Animation 食谱

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T18:59:30.930

嘿帕特里克。看看 UIImageView 的 animationImages 属性，以及 animationRepeatCount 和 animationDuration 属性。如果您将开/关图像放入一个数组并将其分配为 animationImages 属性，您应该能够控制重复和持续时间以获得所需的效果。

希望有帮助！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T19:11:49.707

感谢那。我已经查看了 UIIMageView 的 animationImages 属性。这不正是我想要做的。我在几个彼此靠近的 UIImageView 之间循环，给人的印象是灯光在它们之间移动并在它们上方循环。因此，单个 UIImageView 的动画彼此分开，因为我需要在代码中根据需要交换图像。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-05T23:37:25.537

您在将循环移动到后台线程方面走在了正确的轨道上，但您还需要确保让主运行循环有机会更新 UI。您应该能够用类似的东西替换对 toggleImageViewOn: 和 toggleImageViewOff: 的直接调用

```
[self performSelectorOnMainThread:@selector(toggleImageViewOn:) withObject:[Images objectAtIndex:i] waitUntilDone:NO]; 
```

这将在主线程上进行 UI 更新，并且通过不等到更新完成，您可以让主运行循环有机会到达其结束。您在进度条之类的问题上遇到了同样的问题，除非您使用上述 UI 更新调用从后台线程进行更新，否则它们在循环结束之前不会改变。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-06T03:53:43.413

从后台线程的循环中调用 peformSelectorOnMainThread:withObject:waitUntilDone: 确实会以我认为我需要的速度尽快更新视图。我很好奇为什么我需要在主线程上进行 UIImageView 交换？为什么不在后台线程上更改它，然后使用 NSThread 的 sleepForTimeInterval 允许主线程无论如何更新绘图？

我想我需要阅读运行循环以及绘图更新发生的位置。

非常感谢帮忙。（我还将尝试 Bill Dudney 的一些其他建议，我认为这些建议将基于 CoreAnimation 起作用）

# c# - 没有依赖项的 C# 队列或 ServiceBus？

> ID：517376
> 
> 赞同：19
> 
> 时间：2009-02-05T18:59:56.640
> 
> 标签：c#, queue, servicebus

是否有可以实现零依赖部署的产品（理想情况下是开源的，但不是必需的）？我能够找到的每个服务总线或队列库都依赖于其中一个队列应用程序（如 msmq）或数据库。我想要一个非常轻量级的解决方案，我可以添加对我的应用程序的引用，构建它，并使用尽可能少的配置进行部署。

在理想情况下，队列/服务总线将在 IIS 上运行，并允许 Web 和富客户端与其通信。

这样的工具将非常适合在本地开发机器上对大型分布式系统进行快速原型设计。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-17T14:55:12.660

Ayende 的 Rhino Queues 正是您正在寻找的，这是介绍它的博客文章：

[http://ayende.com/Blog/archive/2008/08/01/Rhino-Queues.aspx](http://ayende.com/Blog/archive/2008/08/01/Rhino-Queues.aspx)

我认为从那时起，这篇文章中提到的所有限制都已修复。

从博客文章中，犀牛队列是：

*   XCopyable、零管理、嵌入式、异步排队服务
*   面对网络中断时保持稳健
*   System.Transactions 支持
*   快速地
*   通过 HTTP 工作

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-16T09:13:22.693

与 ShuggyCoUk 的[建议](https://stackoverflow.com/a/546328/3195477)类似，您可以使用 Windows 内置的 ESENT 数据库（已随 Windows 安装）建立一个（或多个队列）。有一个托管代码访问库（开源）： http: [//www.codeplex.com/ManagedEsent](http://www.codeplex.com/ManagedEsent)。如果您坚持写/读 CLOB 或 BLOB，它应该可以正常工作。如果你想真正聪明，你可以使用[NServiceBus](http://www.nservicebus.com)并编写（贡献？）ESENT 风格的订阅存储和传输。[在Ayende 的博客](http://www.ayende.com)上也有一些使用 ESENT的尝试（你必须在他的 SVN 存储库中寻找有趣的部分）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-13T15:19:43.907

如果你很高兴成为：

1.  特定于 Windows
2.  仅限本地域
3.  严重限制支持的消息大小
4.  在 P/Invoke 中包装底层的 win32 调用
5.  自己处理投票
6.  处理允许来回通信所需的黑客攻击
7.  处理保持名称同步所需的共享配置

然后一个快速包装 Windows [MailSlot API](http://msdn.microsoft.com/en-us/library/aa365576(VS.85).aspx)可能就足够了。

这个[简单的例子](http://code.msdn.microsoft.com/dparys/Release/ProjectReleases.aspx?ReleaseId=137)是一个合理的开始。

[本文](http://www.codeproject.com/KB/miscctrl/CSharp_MailSlots.aspx)有一些进一步的信息，但假设用例是通过控件（而不是应有的组件）以及一些较差的 WinForms 集成，因此应考虑作为偶然阅读而不是任何库的基础。

[这篇文章](http://www.codeproject.com/KB/cpp/mailslots.aspx)是 C++，但标准更高（评论者已对其进行了扩展，以支持将较大的消息批处理成几个较小的消息）。

你得到 424 个字节（因此使用 .Net 212 个字符），如果你正在谈论文本，你可能想要下降到 ASCII 以使有用的消息长度加倍。

请注意，尽管它很简单、有局限性并且缺乏功能，但它确实提供了多播传递，而您自己在点对点协议上分层通常很复杂。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-13T17:56:25.577

这篇[ayende 帖子](http://ayende.com/Blog/archive/2008/12/18/subscriptions-mass-transit-vs.-nservicebus-vs.-rhino-servicebus.aspx)提供了三种服务总线的有趣比较。我们使用[NServiceBus](http://www.nservicebus.com/)并考虑是否不清楚[Udi Dahan](http://www.udidahan.com/)会响应您如何插入非依赖队列。

我们愉快地使用 MSMQ，但还有其他选择，理论上它应该对几乎任何东西开放，因为您可能会根据您的选择失去一些可靠性和耐用性。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-15T18:31:28.320

为什么不是[亚马逊的](http://aws.amazon.com/sqs/)消息服务 Simple Queue Service？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-06T00:03:28.477

我们将项目从 MSMQ 移至[ActiveMQ](http://activemq.apache.org/)。它真的更好:)
ActiveMQ 是基于 Apache Web 服务器的**开源队列。**
我们将他用于高频率数据工作流的生产中，其中 msmq 有很多问题（我们使用 msmq 一年）
csharp 实现是[nms](http://activemq.apache.org/nms/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-08-01T05:07:50.640

我目前正在开发基于开源 WCF 的服务总线。你可以在这里找到它：[http](http://rockbus.codeplex.com/) ://rockbus.codeplex.com/ 。它支持动态（@run-time）订阅、订阅存储库（数据库）、可插入传输、基于 XPath 的基于内容的路由、基于 wcf 协议的事务交付、循环交付、可插入订阅评估等。看一看！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-03-02T21:02:05.783

您是否考虑过通过 http://Iron.io 使用 IronMQ 之类的[服务](http://Iron.io)？

您不会有任何依赖关系，无需设置任何队列基础设施即可快速原型应用程序，而且它具有高可用性和快速性。

目前没有本地可安装的版本，但它基于即将推出的 OpenStack 协议，所以会有。

顺便说一句，我为 Iron 工作。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-04-12T10:52:08.890

试试[https://github.com/mcintyre321/PieQ](https://github.com/mcintyre321/PieQ) - 这是我编写线程安全、持久、零配置、嵌入式工作队列的尝试。它可能需要一点爱，但我认为它可能是您正在寻找的那种工具。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-11-28T11:04:12.277

我开发了一个 InMemory JMS 库，可用于测试 JMS 应用程序，而无需真正连接到 JMS 提供程序/服务器（想想 hsqldb）。您不必处理连接或协议或任何事情，您需要做的就是发送和接收消息。

[https://github.com/Dhana-Krishnasamy/InMemoryJMS](https://github.com/Dhana-Krishnasamy/InMemoryJMS)

# javascript - 如何从 JavaScript 调用 ASHX？

> ID：517379
> 
> 赞同：3
> 
> 时间：2009-02-05T19:00:22.460
> 
> 标签：javascript, string, return, ashx

我想调用一个 ASHX 文件并从 JavaScript 传递一些查询字符串变量，并将返回字符串转换为 JavaScript 中的字符串。我该怎么做？

ASHX 文件已经编码为 response.write 基于查询字符串的字符串。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-05T19:11:34.183

像这样的东西？：

```
function createXMLHttpRequest() {
   try { return new XMLHttpRequest(); } catch(e) {}
   try { return new ActiveXObject("Msxml2.XMLHTTP"); } catch (e) {}
   try { return new ActiveXObject("Microsoft.XMLHTTP"); } catch (e) {}
   alert("XMLHttpRequest not supported");
   return null;
 }

var xmlHttpReq= createXMLHttpRequest();
xmlHttpReq.open("GET", "your.ashx?v1=1&v2=2&etc", false);
xmlHttpReq.send(null);
var yourJSString = xmlHttpReq.responseText; 
```

# c++ - 从 SDL_GetCursor() 返回的 SDL_cursor 不能与 SDL_GetMouseState() 一起使用？

> ID：517386
> 
> 赞同：0
> 
> 时间：2009-02-05T19:02:26.107
> 
> 标签：c++, mouse, sdl

我试图在 SDL 中获取鼠标的 x、y 和状态。我尝试使用线条

```
int mstate, mx, my = 0;
mstate, mx, my = SDL_GetCursor().SDL_GetMouseState(); 
```

但它给了我错误

> C:[path]\particletest2\main.cpp|107|错误：请求成员`SDL_GetMouseState' in`SDL_GetCursor()'，属于非类类型`SDL_Cursor*'|

有什么办法可以让它工作吗？当 SDL_GetCursor() 应该创建一个对象来为您返回时，创建一个 SDL_cursor 对象似乎是一种浪费。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-05T19:03:52.997

[http://www.libsdl.org/docs/html/sdlgetcursor.html](http://www.libsdl.org/docs/html/sdlgetcursor.html)

`SDL_GetCursor()`返回一个指针，因此您需要使用`->`运算符来访问其成员。

回复您的回复：

我认为

```
mstate, mx, my = SDL_GetCursor()->SDL_GetMouseState(); 
```

如果没有正确粘贴，就会出现问题。我不认为这是在做你认为它应该做的事情，我不确定你认为它应该做什么。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-06-26T04:38:40.047

你必须把指针指向你的变量，然后这会有坐标

```
int x,y;
SDL_GetMouseState(&x,&y); 
```

现在 x 和 y 有了光标的坐标

# cygwin - 哪些cygwin镜像站点是完整的？

> ID：517389
> 
> 赞同：64
> 
> 时间：2009-02-05T19:03:17.103
> 
> 标签：cygwin

我注意到 cygwin 镜像站点存在严重的不一致。您默认安装的软件包取决于您选择的镜像。更糟糕的是，一些站点缺少重要的软件包，因此您无法改进默认安装。

我从 sourceware.mirrors.tds.net 安装的 cygwin 默认安装不包括 diff 或 svn 命令。当我回到他们的镜像站点（使用带有 Internet 选项的 setup.exe）时，该站点甚至没有 diffutils 包和 subversion 包。cygwin.mirrors.hoobly.com 镜像包含这两个包，根据完整列表，它似乎有更多在 sourceware.mirrors.tds.net 上不可用的包。

是否有权威的 cygwin 镜像站点，或者它在 cygwin 镜像站点上屡试不爽？

获得默认和完整的 cygwin 版本版本将大大有助于解决这个问题，但 cygwin 没有版本默认或完整版本。

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2009-02-06T06:57:54.100

mirrors.kernel.org

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2012-12-21T00:23:36.740

这应该不是什么大问题（不再）。[在此页面](http://cygwin.com/mirrors.html)上的镜像列表下方，它表示会定期自动检查每个镜像，并且将丢失软件包的服务器暂时从列表中删除。它还说所有镜像都应该每天同步两次。刚才手动查了好几个镜像，最近都同步过，好像内容一样。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-06T07:19:36.227

您可能想从今天发布的邮件列表中查看[此公告。](http://cygwin.com/ml/cygwin-announce/2009-02/msg00009.html)它可能解释了您所看到的问题。

如果您使用 cygwin，我建议订阅 cygwin-announce 邮件列表。[您可以在本页](http://cygwin.com/lists.html)底部订阅。

也就是说，我发现 kernel.org 通常也不错。

# sharepoint - SharePoint 工作流 - 如何与特定内容类型（特别是文件夹）关联？

> ID：517390
> 
> 赞同：0
> 
> 时间：2009-02-05T19:03:25.197
> 
> 标签：sharepoint

在使用 SharePoint Designer 时，我注意到每个工作流都有一个带有标签的配置 xml。有谁知道如何：1）将工作流与特定的内容类型相关联？2) 知道是否可以将工作流与文件夹相关联？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-12T23:46:44.230

可以将工作流与文件夹相关联。显然，Visual Studio 创建的 Windows Workflow Foundation (WWF) 开发是创建可与不同内容类型相关联的自定义工作流的唯一可靠方法。有一些企业工具可以帮助创建自定义工作流程，例如[K2 的 Blackpoint](http://www.k2.com/en/displaycontent.aspx?id=901)（尽管我还没有机会尝试该软件）。

我确实找到了一些其他的工作流程教程来让我开始：

*   [文件夹内容类型的 SharePoint 工作流 - codeproject.com](http://www.codeproject.com/KB/sharepoint/MOSS_FolderContentTypeWF.aspx?display=Print)
*   [Microsoft SharePoint 团队博客](http://blogs.msdn.com/sharepoint/archive/tags/Workflow/default.aspx)

我还没有找到关于 config xml 标签的任何信息。

# c# - ASP.NET GridView Response.BinaryWrite() 行更改

> ID：517397
> 
> 赞同：1
> 
> 时间：2009-02-05T19:05:07.440
> 
> 标签：c#, asp.net, ajax, gridview, updatepanel

我在更新面板中有一个gridview，并希望允许用户选择一行，该行将生成对将流输出回客户端的类的调用。看起来我不能这样做，因为网格位于更新面板内。有任何想法吗？

C＃

```
 protected void gvResults_SelectedIndexChanged(object sender, EventArgs e)
    {
        RMATagsReport rpt = new RMATagsReport();
        rpt.GenerateReport();
    } 
```

ASP.NET

```
<asp:UpdatePanel ID="upResults" runat="server" ChildrenAsTriggers="false" UpdateMode="Conditional">
<ContentTemplate>
    <asp:GridView ID="gvResults" runat="server" AutoGenerateColumns="False" CellPadding="4"
        ForeColor="#333333" OnSelectedIndexChanged="gvResults_SelectedIndexChanged" Width="100%">
        <RowStyle BackColor="#F7F6F3" ForeColor="#333333" />
        <Columns>
            <asp:BoundField DataField="CSTNO" HeaderText="DEALER" />
            <asp:BoundField DataField="ORDNO" HeaderText="RMA NUMBER" />
            <asp:BoundField DataField="CSTORD" HeaderText="DEALER PO NUMBER" />
            <asp:BoundField DataField="ORDDTE" HeaderText="ORDER DATE" />
            <asp:BoundField DataField="INVDTE" HeaderText="INVOICE DATE" HtmlEncode="false" />
            <asp:CommandField SelectText="Print RMA" ShowSelectButton="True" />
        </Columns>
        <FooterStyle BackColor="#5D7B9D" Font-Bold="True" ForeColor="White" />
        <PagerStyle BackColor="#284775" ForeColor="White" HorizontalAlign="Center" />
        <SelectedRowStyle BackColor="#E2DED6" Font-Bold="True" ForeColor="#333333" />
        <HeaderStyle BackColor="#3494CC" Font-Bold="True" ForeColor="White" HorizontalAlign="Left" />
        <EditRowStyle BackColor="#999999" />
        <AlternatingRowStyle BackColor="White" ForeColor="#284775" />
        <EmptyDataTemplate>
            <span style="color: Red;">No RMA Tags Found With Specified Criteria. </span>
        </EmptyDataTemplate>
    </asp:GridView>
    <div id="LoadingDiv" style="display: none; text-align: center;">
        <img src="Graphics/Icons/loading_lg.gif" />
    </div>
    <div id="ResultsDiv">
    </div>
</ContentTemplate>
<Triggers>
    <asp:AsyncPostBackTrigger ControlID="btnSearch" EventName="Click" />
</Triggers> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T02:55:41.063

我现在正在对索引更改进行 response.redirect，新页面处理报告生成......这似乎工作正常。

**编辑**
虽然这似乎可行，但我仍然对其他可能性持开放态度，因为我不想拥有一个唯一目的是输出此文档的页面。

# java - 在同一个项目中有两个框架可以吗？

> ID：517402
> 
> 赞同：4
> 
> 时间：2009-02-05T19:06:04.193
> 
> 标签：java, jsp, frameworks

所以我[接手了一个 Java Web 项目](https://stackoverflow.com/questions/436212/taking-over-a-project-what-should-i-ask-the-previous-programmer)。该应用程序是由现在为另一家公司工作的另一位开发人员编写的。一般来说，该应用程序简单明了，设计良好，并且代码有足够的文档记录。唯一的问题是之前的开发人员决定构建自己的数据库访问库，而不是使用流行的框架。在他多年的编程生涯中，他构建了一个令人印象深刻的框架来访问任何数据库（类似于轻量级 Hiberbate）。

现在，我没有理由丢弃他的代码并用更传统的 JPA 层替换数据层，因为当前代码工作得很好（尽管它很诱人！）。但我想知道是否应该使用具有新功能的更传统的框架。应用程序堆栈很简单，我可以轻松插入 Hibernate 或 JPA。所以旧页面（带有新的错误修正）将使用旧框架，而新页面将使用新框架。

然而，这种方法的缺点之一是它可能会让新开发人员感到困惑。但是，我也可以继续使用旧框架，并根据需要对其进行扩展/修复。就像我说的，它有效！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-05T19:15:10.463

您当然不想随心所欲地添加框架，但相反也很糟糕，当存在可接受的替代方案时编写自己的伪框架。在我的工作中，我们必须使用 Spring 将 JPA 转换为更多的 JDBC 样式。在转换过程中，我没有删除或修改任何 JPA 代码，我只是在 JDBC 中重新编写了它。一旦我对特定方法的工作感到满意，我就会换掉实现。这让我可以零碎地完成转换，而不用从服务层下面拉出地毯，可以这么说。因此，要完全回答您的问题，只要计划迁移到其中一个框架，就可以拥有 2 个框架。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-05T21:52:34.640

埃尔迪莫，

您应该根据此类更改的投资回报来平衡纳入新框架的决定。当前项目的寿命是看待它的一种方式。

如果项目稳定并且处于维护阶段，那么您不应该进行剧烈的更改。

但是，如果项目将继续包含新功能并继续增长，那么如果它增加了投资回报，那么您应该考虑采用支持的框架。如果您预见到当前的家庭种植框架会发生变化以支持新的需求，并且如果这些其他现有框架支持需求，那么您有充分的理由采用它们。

但是，采用新的持久性框架会在短时间内破坏当前项目的稳定性，由于缺乏框架的团队经验而增加了错误的数量，并且还会影响开发团队的速度。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T19:21:15.740

“它有效” - 不要触摸！

建立一个案例来做这项工作可能是值得的——性能测试、可伸缩性调查等。如果你找不到好的理由，那就把它留给当前正在使用它的项目。如果引发了足够多的 bug 归结为 DB，那么就有可能迁移到支持良好的后端。如果两者的性能都很低，那么也许原始 JDBC 是要走的路，而不是切换抽象框架。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T19:34:46.413

**在这种情况下，****我**认为答案是“是” ....存在。

通过合并 Hibernate 或 JPA，您不仅可以减轻这些开发团队的一些维护责任，而且听起来您在前进方面会更快乐。

只需记录您的所有更改及其背后的原因，以供关注*您*的开发人员使用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-05T19:45:53.943

如果它有效并且令人印象深刻，为什么要屈服于无缘无故切换到另一个框架的诱惑？除非当前框架有一些负面影响（难以维护、难以理解、无法调试等），否则我建议不要管它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-05T19:09:59.100

这样做的真正缺点是一个框架会对数据库进行更改而另一个框架不会立即接受的风险。我在使用 NHibernate + ADO.NET 的组合之前遇到过这个问题：如果 NHibernate 缓存了某些内容，它可能会忽略 ADO.NET 的更改。

如果您可以减轻这种情况，那么这样做在技术上没有任何问题。

# javascript - javascript元素的高度

> ID：517407
> 
> 赞同：1
> 
> 时间：2009-02-05T19:07:01.290
> 
> 标签：javascript

我想在相反的方向调整元素的大小，所以下面的代码确实调整了它，但是它将它从当前位置放大到底部，我希望当前位置到顶部。这样做的有效方法是什么？谢谢

```
var ele=document.getElementById('mydiv');
ele.style.height = 500+'px'; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T19:11:52.497

做你正在做的事情，然后将元素向上移动其原始高度：

```
var ele=document.getElementById('mydiv');
ele.style.height = 500+'px';
ele.style.top -= 100+'px'; //or whatever the height originally was. 
```

# javascript - 从 JavaScript 函数中提取嵌套函数名称

> ID：517411
> 
> 赞同：8
> 
> 时间：2009-02-05T19:07:58.840
> 
> 标签：javascript, regex, parsing, function

给定一个函数，我试图找出其中嵌套函数的名称（只有一层深）。

在我开始使用带有注释的函数之前，一个简单的正则表达式`toString()`一直有效。事实证明，一些浏览器存储部分原始源代码，而另一些浏览器则根据编译后的内容重建源代码；的输出`toString()`可能包含某些浏览器中的原始代码注释。顺便说一句，这是我的发现：

## 考试科目

```
function/*post-keyword*/fn/*post-name*/()/*post-parens*/{
    /*inside*/
}

document.write(fn.toString()); 
```

## 结果

```
浏览器 post-keyword post-name post-parens 里面
----------- ------------ --------- ----------- -------- -
 火狐 不 不 不 不
 野生动物园 不 不 不 不
 Chrome 否 否 是 是
 IE 是 是 是 是
 歌剧 是 是 是 是

```

我正在寻找一种从给定函数中提取嵌套函数名称的跨浏览器方法。该解决方案应该能够从以下函数中提取“fn1”和“fn2”：

```
function someFn() {
    /**
     * Some comment
     */
     function fn1() {
         alert("/*This is not a comment, it's a string literal*/");
     }

     function // keyword
     fn2 // name
     (x, y) // arguments
     {
         /*
         body
         */
     }

     var f = function () { // anonymous, ignore
     };
} 
```

解决方案不必是纯正则表达式。

**更新：**你可以假设我们总是在处理有效的、正确嵌套的代码，所有的字符串文字、注释和块都正确终止。这是因为我正在解析一个已经编译为有效函数的函数。

**Update2：**如果您想知道这背后的动机：我正在开发一个名为[jsUnity](http://jsunity.com)的新 JavaScript 单元测试框架。您可以使用几种不同的格式编写测试和测试套件。其中之一是一个函数：

```
function myTests() {
    function setUp() {
    }

    function tearDown() {
    }

    function testSomething() {
    }

    function testSomethingElse() {
    }
} 
```

由于函数隐藏在闭包内，我无法从函数外部调用它们。因此，我将外部函数转换为字符串，提取函数名称，在底部附加“现在运行给定的内部函数”语句，然后将其重新编译为带有 new 的函数`Function()`。如果测试函数中有注释，那么提取函数名称并避免误报会变得很棘手。因此，我正在寻求 SO 社区的帮助......

**Update3：**我想出了[一个新的解决方案](https://stackoverflow.com/questions/517411/extracting-nested-function-names-from-a-javascript-function/546984#546984)，它不需要大量的语义摆弄代码。我使用原始源本身来探测一级函数。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T22:14:23.143

**外观改动和错误修复**

正则表达式**必须**阅读`\bfunction\b`以避免误报！

`nested`如果不计算为，则块中定义的函数（例如循环体中）将被忽略`true`。

```
function tokenize(code) {
    var code = code.split(/\\./).join(''),
        regex = /\bfunction\b|\(|\)|\{|\}|\/\*|\*\/|\/\/|"|'|\n|\s+/mg,
        tokens = [],
        pos = 0;

    for(var matches; matches = regex.exec(code); pos = regex.lastIndex) {
        var match = matches[0],
            matchStart = regex.lastIndex - match.length;

        if(pos < matchStart)
            tokens.push(code.substring(pos, matchStart));

        tokens.push(match);
    }

    if(pos < code.length)
        tokens.push(code.substring(pos));

    return tokens;
}

var separators = {
    '/*' : '*/',
    '//' : '\n',
    '"' : '"',
    '\'' : '\''
};

function extractInnerFunctionNames(func, nested) {
    var names = [],
        tokens = tokenize(func.toString()),
        level = 0;

    for(var i = 0; i < tokens.length; ++i) {
        var token = tokens[i];

        switch(token) {
            case '{':
            ++level;
            break;

            case '}':
            --level;
            break;

            case '/*':
            case '//':
            case '"':
            case '\'':
            var sep = separators[token];
            while(++i < tokens.length && tokens[i] !== sep);
            break;

            case 'function':
            if(level === 1 || (nested && level)) {
                while(++i < tokens.length) {
                    token = tokens[i];

                    if(token === '(')
                        break;

                    if(/^\s+$/.test(token))
                        continue;

                    if(token === '/*' || token === '//') {
                        var sep = separators[token];
                        while(++i < tokens.length && tokens[i] !== sep);
                        continue;
                    }

                    names.push(token);
                    break;
                }
            }
            break;
        }
    }

    return names;
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-09T19:07:08.303

处理此问题的学术正确方法是为由正式语法生成的 Javascript 子集（函数定义）创建词法分析器和解析器（例如，请参阅有关该主题的[链接](http://en.wikipedia.org/wiki/Parsing_expression_grammar)）。

查看[JS/CC](http://jscc.jmksf.com/)，了解 Javascript 解析器生成器。

其他解决方案只是正则表达式黑客，这会导致无法维护/不可读的代码，并且在特定情况下可能会导致隐藏的解析错误。

作为旁注，我不确定您为什么不以不同的方式指定产品中的单元测试函数列表（函数数组？）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-10T12:30:35.027

如果您将测试定义为：

```
var tests = {
    test1: function (){
        console.log( "test 1 ran" );
    },

    test2: function (){
        console.log( "test 2 ran" );
    },

    test3: function (){
        console.log( "test 3 ran" );
    }
}; 
```

然后你可以像这样轻松地运行它们：

```
for( var test in tests ){ 
    tests[test]();
} 
```

这看起来更容易。您甚至可以通过这种方式在 JSON 中进行测试。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-10T14:25:53.067

我喜欢你用[jsUnity](http://jsunity.com/)做的事情。当我看到我喜欢的东西（并且有足够的空闲时间；））时，我会尝试以更适合我的需求的方式重新实现它（也称为“此处未发明”综合症）。

[本文](http://mercurial.intuxication.org/hg/js-hacks-docs/raw-file/tip/debug-en.html)介绍了我努力的结果，代码可以在[这里](http://mercurial.intuxication.org/hg/js-hacks/raw-file/tip/debug.js)找到。

随意撕掉你喜欢的任何部分——你可以假设代码[在公共领域](http://mercurial.intuxication.org/hg/js-hacks/raw-file/tip/license.txt)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-13T17:58:48.767

诀窍是基本上生成一个探测函数，该函数将检查给定名称是否是嵌套（第一级）函数的名称。探测函数使用原始函数的函数体，以代码为前缀，在探测函数范围内检查给定名称。好的，这可以用实际代码更好地解释：

```
function splitFunction(fn) {
    var tokens =
        /^[\s\r\n]*function[\s\r\n]*([^\(\s\r\n]*?)[\s\r\n]*\([^\)\s\r\n]*\)[\s\r\n]*\{((?:[^}]*\}?)+)\}\s*$/
        .exec(fn);

    if (!tokens) {
        throw "Invalid function.";
    }

    return {
        name: tokens[1],
        body: tokens[2]
    };
}

var probeOutside = function () {
    return eval(
        "typeof $fn$ === \"function\""
        .split("$fn$")
        .join(arguments[0]));
};

function extractFunctions(fn) {
    var fnParts = splitFunction(fn);

    var probeInside = new Function(
        splitFunction(probeOutside).body + fnParts.body);

    var tokens;
    var fns = [];
    var tokenRe = /(\w+)/g;

    while ((tokens = tokenRe.exec(fnParts.body))) {
        var token = tokens[1];

        try {
            if (probeInside(token) && !probeOutside(token)) {
                fns.push(token);
            }
        } catch (e) {
            // ignore token
        }
    }

    return fns;
} 
```

在 Firefox、IE、Safari、Opera 和 Chrome 上运行良好：

```
function testGlobalFn() {}

function testSuite() {
    function testA() {
        function testNested() {
        }
    }

    // function testComment() {}
    // function testGlobalFn() {}

    function // comments
    testB /* don't matter */
    () // neither does whitespace
    {
        var s = "function testString() {}";
    }
}

document.write(extractFunctions(testSuite));
// writes "testA,testB" 
```

* * *

**由 Christoph 编辑，由 Ates 提供内联答案：**

一些意见、问题和建议：

1.  有检查的理由吗

    ```
    typeof $fn$ !== "undefined" && $fn$ instanceof Function 
    ```

    而不是使用

    ```
    typeof $fn$ === "function" 
    ```

    `instanceof`不如使用安全，`typeof`因为在帧边界之间传递对象时会失败。我知道 IE会`typeof`为某些内置函数返回错误信息，但 afaik`instanceof`在这些情况下也会失败，那么为什么更复杂但更不安全的测试呢？

* * *

[AG] 绝对没有正当理由。我已按照您的建议将其更改为更简单的“typeof === 函数”。

* * *

2.  您将如何防止错误排除在外部范围内存在同名函数的函数，例如

    ```
    function foo() {}

    function TestSuite() {
        function foo() {}
    } 
    ```

* * *

[AG] 我不知道。你能想到什么吗。你觉得哪一个更好？(a) 错误排除内部函数。(b) 错误地包含外部功能。

我开始认为理想的解决方案将是您的解决方案和这种探测方法的结合；找出闭包内的真实函数名称，然后使用探测收集对实际函数的引用（以便可以直接从外部调用它们）。

* * *

3.  可能可以修改您的实现，以便函数的主体只需`eval()`'ed 一次，而不是每个令牌一次，这是相当低效的。当我今天有更多空闲时间时，我*可能会*尝试看看我能想出什么......

* * *

[AG] 请注意，整个函数体未进行评估。它只是插入身体顶部的那部分。

[CG] 你的权利 - 函数的主体在创建过程中只被解析一次`probeInside`- 你做了一些很好的黑客攻击，那里;)。我今天有一些空闲时间，所以让我们看看我能想出什么......

使用您的解析方法来提取真实函数名称的解决方案可以只使用一个 eval 来返回对实际函数的引用数组：

```
return eval("[" + fnList + "]"); 
```

* * *

[CG] 这是我想出的。一个额外的好处是外部函数保持不变，因此仍然可以作为内部函数的闭包。只需将代码复制到空白页中，看看它是否有效 - 不保证无错误；）

```
<pre><script>
var extractFunctions = (function() {
    var level, names;

    function tokenize(code) {
        var code = code.split(/\\./).join(''),
            regex = /\bfunction\b|\(|\)|\{|\}|\/\*|\*\/|\/\/|"|'|\n|\s+|\\/mg,
            tokens = [],
            pos = 0;

        for(var matches; matches = regex.exec(code); pos = regex.lastIndex) {
            var match = matches[0],
                matchStart = regex.lastIndex - match.length;

            if(pos < matchStart)
                tokens.push(code.substring(pos, matchStart));

            tokens.push(match);
        }

        if(pos < code.length)
            tokens.push(code.substring(pos));

        return tokens;
    }

    function parse(tokens, callback) {
        for(var i = 0; i < tokens.length; ++i) {
            var j = callback(tokens[i], tokens, i);
            if(j === false) break;
            else if(typeof j === 'number') i = j;
        }
    }

    function skip(tokens, idx, limiter, escapes) {
        while(++idx < tokens.length && tokens[idx] !== limiter)
            if(escapes && tokens[idx] === '\\') ++idx;

        return idx;
    }

    function removeDeclaration(token, tokens, idx) {
        switch(token) {
            case '/*':
            return skip(tokens, idx, '*/');

            case '//':
            return skip(tokens, idx, '\n');

            case ')':
            tokens.splice(0, idx + 1);
            return false;
        }
    }

    function extractTopLevelFunctionNames(token, tokens, idx) {
        switch(token) {
            case '{':
            ++level;
            return;

            case '}':
            --level;
            return;

            case '/*':
            return skip(tokens, idx, '*/');

            case '//':
            return skip(tokens, idx, '\n');

            case '"':
            case '\'':
            return skip(tokens, idx, token, true);

            case 'function':
            if(level === 1) {
                while(++idx < tokens.length) {
                    token = tokens[idx];

                    if(token === '(')
                        return idx;

                    if(/^\s+$/.test(token))
                        continue;

                    if(token === '/*') {
                        idx = skip(tokens, idx, '*/');
                        continue;
                    }

                    if(token === '//') {
                        idx = skip(tokens, idx, '\n');
                        continue;
                    }

                    names.push(token);
                    return idx;
                }
            }
            return;
        }
    }

    function getTopLevelFunctionRefs(func) {
        var tokens = tokenize(func.toString());
        parse(tokens, removeDeclaration);

        names = [], level = 0;
        parse(tokens, extractTopLevelFunctionNames);

        var code = tokens.join('') + '\nthis._refs = [' +
            names.join(',') + '];';

        return (new (new Function(code)))._refs;
    }

    return getTopLevelFunctionRefs;
})();

function testSuite() {
    function testA() {
        function testNested() {
        }
    }

    // function testComment() {}
    // function testGlobalFn() {}

    function // comments
    testB /* don't matter */
    () // neither does whitespace
    {
        var s = "function testString() {}";
    }
}

document.writeln(extractFunctions(testSuite).join('\n---\n'));
</script></pre> 
```

不像 LISP 宏那么优雅，但 JAvaScript 的能力仍然不错；）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-05T21:23:44.167

```
<pre>
<script type="text/javascript">
function someFn() {
    /**
     * Some comment
     */
     function fn1() {
         alert("/*This is not a comment, it's a string literal*/");
     }

     function // keyword
     fn2 // name
     (x, y) // arguments
     {
         /*
         body
         */
     }

     function fn3() {
        alert("this is the word function in a string literal");
     }

     var f = function () { // anonymous, ignore
     };
}

var s = someFn.toString();
// remove inline comments
s = s.replace(/\/\/.*/g, "");
// compact all whitespace to a single space
s = s.replace(/\s{2,}/g, " ");
// remove all block comments, including those in string literals
s = s.replace(/\/\*.*?\*\//g, "");
document.writeln(s);
// remove string literals to avoid false matches with the keyword 'function'
s = s.replace(/'.*?'/g, "");
s = s.replace(/".*?"/g, "");
document.writeln(s);
// find all the function definitions
var matches = s.match(/function(.*?)\(/g);
for (var ii = 1; ii < matches.length; ++ii) {
    // extract the function name
    var funcName = matches[ii].replace(/function(.+)\(/, "$1");
    // remove any remaining leading or trailing whitespace
    funcName = funcName.replace(/\s+$|^\s+/g, "");
    if (funcName === '') {
        // anonymous function, discard
        continue;
    }
    // output the results
    document.writeln('[' + funcName + ']');
}
</script>
</pre> 
```

我确定我错过了一些东西，但是根据您在原始问题中的要求，我认为我已经实现了目标，包括摆脱`function`在字符串文字中找到关键字的可能性。

最后一点，我认为在函数块中修改字符串文字没有任何问题。您的要求是找到函数名称，所以我没有费心尝试保留函数内容。

# sql - 是否曾经有过使用数据库 1:1 关系有意义的时候？

> ID：517417
> 
> 赞同：173
> 
> 时间：2009-02-05T19:08:42.630
> 
> 标签：sql, database-design, one-to-one, database-normalization

前几天我在想规范化，我突然想到，我想不出数据库中应该存在 1:1 关系的时间。

*   `Name:SSN`? 我会把它们放在同一张桌子上。
*   `PersonID:AddressID`? 再次，同一张桌子。

我可以想出无数个 1:many 或 many:many 的例子（带有适当的中间表），但绝不是 1:1。

我错过了一些明显的东西吗？

* * *

## 回答 #1

> 赞同：176
> 
> 时间：2009-02-05T19:14:22.010

1:1 关系通常表明您出于某种原因对较大的实体进行了分区。通常是因为物理模式中的性能原因，但如果预计大量数据同时“未知”（在这种情况下您有 1:0或 1:1，但仅此而已）。

作为逻辑分区的示例：您有关于员工的数据，但需要收集更大的数据集，当且仅当他们选择拥有健康保险时。我会将有关健康保险的人口统计数据保存在不同的表中，以便更轻松地进行安全分区，并避免在与保险无关的查询中拖拽这些数据。

物理分区的一个示例是托管在多个服务器上的相同数据。我可以将健康保险人口统计数据保存在另一个州（例如，人力资源办公室所在的州），并且主数据库可能只能通过链接服务器链接到它......避免将敏感数据复制到其他位置，但使其可用于（假设这里很少）需要它的查询。

**每当**您的查询需要较大实体的一致子集时，物理分区就很有用。

* * *

## 回答 #2

> 赞同：132
> 
> 时间：2009-02-05T19:11:38.833

原因之一是数据库效率。拥有 1:1 的关系允许您拆分在行/表锁定期间将受到影响的字段。如果表 A 有大量更新，而表 b 有大量读取（或有来自另一个应用程序的大量更新），那么表 A 的锁定不会影响表 B 中发生的事情。

其他人提出了一个很好的观点。取决于应用程序等如何影响系统，安全性也可能是一个很好的理由。我倾向于采用不同的方法，但这可能是一种限制对某些数据的访问的简单方法。在紧要关头拒绝访问某个表真的很容易。

[我关于它的博客条目。](http://structuredsight.com/2015/01/12/its-o-k-that-its-just-the-two-of-us-when-a-1x1-table-relationship-makes-sense/)

* * *

## 回答 #3

> 赞同：52
> 
> 时间：2009-02-05T19:16:10.680

稀疏性。数据关系在技术上可能是 1:1，但不必为每一行都存在相应的行。因此，如果您有 2000 万行并且某些值仅存在于其中的 0.5%，那么如果将这些列推送到可以稀疏填充的表中，则空间节省是巨大的。

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2015-02-04T03:46:04.800

大多数排名靠前的答案都为 1:1 关系提供了非常有用的数据库调整和优化原因，但我只想关注自然发生 1:1 关系的“野外”示例。

请注意大多数这些示例的数据库实现的一个重要特征：没有保留有关 1:1 关系的历史信息。也就是说，这些关系在任何给定时间点都是 1:1。如果数据库设计者想要记录关系参与者随时间的变化，那么关系就变成 1:M 或 M:M；他们失去了 1:1 的本性。了解了这一点，这里是：

*   **“Is-A”或超类型/子类型或继承/分类关系**：此类别是当一个实体是另一个实体的特定类型时。例如，可以有一个 Employee 实体，其属性适用于所有员工，然后是不同的实体来指示特定类型的员工，这些员工具有该员工类型独有的属性，例如 Doctor、Accountant、Pilot 等。这种设计避免了多个空值，因为许多员工不具备特定子类型的特殊属性。此类别中的其他示例可能是 Product 作为超类型，ManufacturingProduct 和 MaintenanceSupply 作为子类型；Animal 作为超类型，Dog 和 Cat 作为子类型；请注意，每当您尝试将面向对象的继承层次结构映射到关系数据库（例如在对象关系模型中）时，这种关系就代表了这种情况。

*   **“老板”关系**，如经理、董事长、总裁等，一个组织单位只能有一个老板，一个人只能是一个组织单位的老板。如果这些规则适用，那么您将拥有一对一的关系，例如一个部门的一位经理，一家公司的一位 CEO，等等。“老板”关系不仅适用于人。例如，如果只有一家商店作为公司的总部，或者只有一个城市是国家的首都，就会出现同样的关系。

*   **某些稀缺资源分配**，例如，一名员工一次只能分配一辆公司汽车（例如，每个卡车司机一辆卡车，每个出租车司机一辆出租车等）。最近一位同事给我举了这个例子。

*   **婚姻**（至少在一夫多妻制是非法的法律管辖区）：一个人一次只能与另一个人结婚。我从一本教科书中得到这个例子，当一家公司记录其员工之间的婚姻时，该教科书将其用作 1:1 一元关系的例子。

*   **Matching reservations**：当一个唯一的预订被做出，然后作为两个独立的实体完成时。例如，汽车租赁系统可能会在一个实体中记录预订，然后在单独的实体中记录实际租赁。尽管这种情况也可以设计为一个实体，但将实体分开可能是有意义的，因为并非所有预订都得到满足，也不是所有租金都需要预订，而且这两种情况都很常见。

我重复我之前提出的警告，只有在没有记录历史信息的情况下，其中大多数都是 1:1 关系。因此，如果员工改变了他们在组织中的角色，或者经理负责不同的部门，或者员工被重新分配了车辆，或者某人丧偶并再婚，那么关系参与者可能会发生变化。如果数据库没有存储有关这些 1:1 关系的任何先前历史记录，那么它们仍然是合法的 1:1 关系。但是如果数据库记录了历史信息（例如为每个关系添加开始和结束日期），那么它们几乎都会变成 M​​:M 关系。

历史记录有两个值得注意的例外：首先，一些关系很少发生变化，以至于历史信息通常不会被存储。例如，大多数 IS-A 关系（例如产品类型）是不可变的；也就是说，它们永远不会改变。因此，历史记录点是没有实际意义的；这些将始终作为自然的 1:1 关系实施。其次，预订-出租关系分别存储日期，因为预订和出租是独立的事件，每个都有自己的日期。由于实体有自己的日期，而不是 1:1 关系本身具有开始日期，因此即使存储了历史信息，这些也会保持 1:1 关系。

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2009-02-06T10:21:41.867

由于您的措辞方式，您的问题可以以多种方式解释。回应表明了这一点。

现实世界中的数据项之间肯定存在 1:1 的关系。毫无疑问。“是”的关系通常是一对一的。汽车是交通工具。一辆车就是一辆车。一辆车可能是一辆车。有些车辆是卡车，在这种情况下，一辆车不是汽车。几个答案解决了这种解释。

但我认为你真正要问的是......当存在 1:1 关系时，是否应该拆分表？换句话说，您是否应该拥有两个包含完全相同键的表？在实践中，我们大多数人只分析主键，而不分析其他候选键，但这个问题略有不同。

1NF、2NF 和 3NF 的规范化规则从不要求将表分解（拆分）为具有相同主键的两个表。我还没有弄清楚在 BCNF、4NF 或 5NF 中放置模式是否会导致两个表具有相同的键。在我的脑海中，我猜答案是否定的。

有一个标准化级别称为 6NF。6NF 的规范化规则肯定会导致两个表具有相同的主键。6NF 与 5NF 相比具有可以完全避免 NULLS 的优势。这对某些（但不是全部）数据库设计人员很重要。我从来没有费心将模式放入 6NF。

在 6NF 中，缺失的数据可以用省略的行来表示，而不是在某些列中带有 NULL 的行。

除了规范化之外，拆分表还有其他原因。有时拆分表会带来更好的性能。使用某些数据库引擎，您可以通过对表进行分区而不是实际拆分它来获得相同的性能优势。这可以使逻辑设计易于理解，同时为数据库引擎提供加速处理所需的工具。

* * *

## 回答 #6

> 赞同：19
> 
> 时间：2009-02-05T19:26:42.453

我使用它们主要有几个原因。一是数据变化率的显着差异。我的一些表可能有审计跟踪，我可以在其中跟踪以前版本的记录，如果我只关心跟踪 10 列中的 5 列的以前版本，将这 5 列拆分到一个单独的表中，上面有审计跟踪机制会更有效。另外，我可能有只写的记录（比如会计应用程序）。您不能更改美元金额或它们所用于的帐户，如果您犯了错误，则需要进行相应的记录以注销不正确的记录，然后创建更正条目。我对表有限制，强制执行它们无法更新或删除的事实，但我可能对该对象有几个可延展的属性，这些都保存在一个单独的表中，没有修改的限制。我这样做的另一次是在医疗记录应用程序中。有与访问相关的数据一旦签署就无法更改，而与访问相关的其他数据可以在签署后更改。在这种情况下，我将拆分数据并在锁定表上放置一个触发器，在注销时拒绝对锁定表的更新，但允许对医生未签署的数据进行更新。

另一位发帖人评论说 1:1 没有被规范化，在某些情况下，我不同意这一点，尤其是子类型化。假设我有一个员工表，主键是他们的 SSN（这是一个例子，让我们把关于这是否是另一个线程的好键的争论）。员工可以是不同的类型，比如临时的或永久的，如果他们是永久的，他们有更多的字段需要填写，比如办公室电话号码，只有在 type = 'Permanent' 时才应该不为空。在第 3 范式数据库中，列应该仅取决于键，即员工，但它实际上取决于员工和类型，因此 1:1 关系是完全正常的，并且在这种情况下是可取的。它还可以防止过于稀疏的表，如果我有 10 个通常填充的列，

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2009-02-05T19:27:43.200

我能想到的最常见的情况是当你有 BLOB 时。假设您想将大图像存储在数据库中（通常，不是存储它们的最佳方式，但有时约束使其更方便）。您通常希望 blob 位于单独的表中，以改进对非 blob 数据的查找。

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2009-02-05T19:12:51.077

就纯科学而言，是的，它们毫无用处。

在实际数据库中，有时将很少使用的字段保留在单独的表中很有用：使用此字段且仅使用此字段来加快查询速度；避免锁等。

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2009-02-05T19:14:00.247

与其使用视图来限制对字段的访问，有时将受限制的字段保存在只有特定用户可以访问的单独表中是有意义的。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2009-02-05T19:16:19.337

我还可以想到您有一个使用继承的 OO 模型的情况，并且必须将继承树持久化到数据库中。

例如，您有一个类 Bird 和 Fish，它们都继承自 Animal。在您的数据库中，您可以有一个“Animal”表，其中包含 Animal 类的公共字段，Animal 表与 Bird 表具有一对一的关系，与 Fish 具有一对一的关系桌子。

在这种情况下，您不必拥有一个包含许多可空列来保存 Bird 和 Fish-properties 的 Animal 表，当记录表示一只鸟时，其中包含 Fish-data 的所有列都设置为 NULL。

相反，您在 Birds 表中有一条记录，它与 Animal 表中的记录具有一对一的关系。

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2009-02-05T20:04:51.877

如果您有太多信息，1-1 关系也是必要的。表中的每条记录都有记录大小限制。有时表被一分为二（在主表中最常查询的信息）只是为了记录大小不会太大。如果表很窄，数据库在查询方面也更有效。

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2009-02-05T19:16:46.967

这也是一种扩展已经在生产中的表的方法，其风险比“真正的”数据库更改要小。在遗留系统中看到 1:1 关系通常是一个很好的指标，表明字段是在初始设计之后添加的。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2009-02-05T19:16:44.953

大多数时候，设计被认为是 1:1，直到有人问“好吧，为什么不能是 1:many”？在预料到这种常见情况时，会过早地将概念彼此分离。Person 和 Address 没有绑定得那么紧密。很多人有多个地址。等等...

通常两个独立的对象空间意味着一个或两个可以相乘（x:many）。如果两个对象是真正的、真正的 1:1，甚至在哲学上，那么它更像是一种关系。这两个“对象”实际上是一个完整对象的一部分。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2009-10-30T22:39:47.070

在 SQL 中，不可能在两个表之间强制执行 1:1 关系，这对双方都是强制性的（除非表是只读的）。对于大多数实际目的，SQL 中的“1:1”关系实际上意味着 1:0|1。

无法在引用约束中支持强制基数是 SQL 的严重限制之一。“可延迟”约束并不算数，因为它们只是一种说约束有时不强制执行的方式。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2009-02-05T19:13:16.660

如果您将数据与流行的 ORM 之一一起使用，您可能希望将一个表分解为多个表以匹配您的对象层次结构。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2009-02-05T19:15:01.557

我发现，当我建立 1:1 的关系时，完全是出于系统原因，而不是关系原因。

例如，我发现将用户的保留方面放在 1 个表中，并将用户的用户可编辑字段放在不同的表中，可以更容易地在逻辑上编写关于这些字段的权限的规则。

但你是对的，理论上，1:1 的关系完全是人为的，几乎是一种现象。然而，从逻辑上讲，它允许程序和优化更容易抽象数据库。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2009-02-05T19:14:42.430

仅在某些情况下需要的扩展信息。在遗留应用程序和编程语言（例如 RPG）中，程序是在表上编译的（因此，如果表发生更改，您必须重新编译程序）。在您必须担心表大小的情况下，标记文件也很有用。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2009-02-05T19:14:28.560

大多数情况下，它更像是一种物理结构而不是逻辑结构。它通常用于对表进行垂直分区，以利用跨物理设备拆分 I/O 或与隔离不经常访问的数据或需要比同一对象上的其他属性更安全的数据相关的其他查询优化（SSN、工资等）。

规定 1-1 关系的唯一合乎逻辑的考虑是某些属性仅适用于某些实体。然而，在大多数情况下，有一种更好/更规范化的方式来通过实体提取对数据进行建模。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2009-10-31T01:07:09.683

我能看到 1:1 关系的最佳原因是数据库设计的 SuperType SubType。我基于这个模型创建了一个房地产 MLS 数据结构。有五种不同的数据馈送；住宅、商业、多户家庭、酒店和土地。

我创建了一个名为属性的 SuperType，其中包含五个单独数据馈送中的每一个都共有的数据。这允许对所有数据类型进行非常快速的“简单”搜索。

我创建了五个单独的子类型，它们为五个数据馈送中的每一个存储唯一的数据元素。每个 SuperType 记录与相应的 SubType 记录具有 1:1 的关系。

如果客户想要进行详细搜索，他们必须选择 Super-Sub 类型，例如 PropertyResidential。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2009-08-12T13:36:10.320

在我看来，1:1 的关系映射了 RDBMS 上的类继承。有一个包含公共属性的表A，即子类状态每个继承的类状态都映射到RDBMS 上，表B 与A 表具有1:1 的关系，包含专门的属性。表 namend A 还包含一个表示“转换”功能的“类型”字段

再见马里奥

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2015-09-17T02:29:31.863

如果有任何显着的性能优势，您可以创建一个一对一的关系表。您可以将很少使用的字段放入单独的表中。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2009-02-05T19:16:21.537

如果您要进行标准化，那么 1:1 的关系就没有任何意义，因为任何 1:1 的关系都将保存在同一张表中。

但在现实世界中，它通常是不同的。您可能希望分解数据以匹配您的应用程序界面。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2013-08-23T01:24:14.157

可能如果您的数据库中有某种类型的对象。

假设在表 T1 中，您有 C1、C2、C3 列……具有一对一的关系。没关系，它是标准化的形式。现在说在表 T2 中，您有列 C1、C2、C3、……（名称可能不同，但说类型和角色相同）也具有一对一的关系。T2 可以，原因与 T1 相同。

然而，在这种情况下，我认为适合单独的表 T3，包含 C1、C2、C3……以及从 T1 到 T3 以及从 T2 到 T3 的一对一关系。如果存在另一个表，我什至更认为合适，其中已经存在一个对多个 C1、C2、C3 ......比如说从表 A 到表 B 中的多行。然后，你使用 B 而不是 T3，并且有从 T1 到 B 的一对一关系，从 T2 到 B 相同，从 A 到 B 仍然是相同的一对多关系。

我相信规范化不同意这一点，这可能是一个想法：识别对象类型并将相同类型的对象移动到自己的存储池，使用某些表中的一对一关系，以及一对多的关系来自其他一些表的关系。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2016-08-05T23:37:32.757

出于安全目的，这没有必要很好，但有更好的方法来执行安全检查。想象一下，你创造了一把只能打开一扇门的钥匙。如果钥匙可以打开任何其他门，您应该响铃。本质上，您可以拥有“CitizenTable”和“VotingTable”。公民一号投票给存储在投票表中的候选人一号。如果公民一再次出现在投票表中，那么他们应该是一个警报。请注意，这是一对一的关系，因为我们不是指候选人字段，而是指投票表和公民表。

例子：

```
 Citizen Table
 id = 1, citizen_name = "EvryBod"
 id = 2, citizen_name = "Lesly"
 id = 3, citizen_name = "Wasserman"

 Candidate Table
 id = 1, citizen_id = 1, candidate_name = "Bern Nie"
 id = 2, citizen_id = 2, candidate_name = "Bern Nie"
 id = 3, citizen_id = 3, candidate_name = "Hill Arry" 
```

那么，如果我们看到投票表是这样的：

```
 Voting Table
 id = 1, citizen_id = 1, candidate_name = "Bern Nie"
 id = 2, citizen_id = 2, candidate_name = "Bern Nie"
 id = 3, citizen_id = 3, candidate_name = "Hill Arry"
 id = 4, citizen_id = 3, candidate_name = "Hill Arry"
 id = 5, citizen_id = 3, candidate_name = "Hill Arry" 
```

可以说，3号公民是个骗子，着火了，骗了聂伯尔尼。只是一个例子。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2019-09-19T07:34:54.087

当您处理来自第三方产品的数据库时，您可能不想更改他们的数据库以防止紧密耦合。但您的数据可能与他们的数据 1:1 对应

* * *

## 回答 #26

> 赞同：-4
> 
> 时间：2009-02-05T21:08:11.093

任何地方都有两个完全独立的实体共享一对一的关系。应该有很多例子：

人 <-> 牙医*（它的 1:N，所以它错了！）*

人<->医生*（它的1：N，所以它也是错误的！）*

人 <-> 配偶*（它的 1:0|1，所以它大多是错误的！）*

**编辑：**是的，这些都是非常糟糕的例子，特别是如果我一直在寻找 1:1，而不是两边的 0 或 1。我想我的大脑发错了:-)

所以，我会再试一次。事实证明，经过一番思考，你可以拥有两个必须（就软件而言）一直在一起的独立实体的唯一方法是让它们在更高的分类中一起存在。然后，当且仅当您陷入较低的分解时，事物是并且应该是分开的，但在较高的层次上，它们不能没有彼此。上下文，然后是关键。

对于医学数据库，您可能希望存储有关身体特定区域的不同信息，将它们作为一个单独的实体保存。在那种情况下，一个病人只有一个头，他们需要它，否则他们就不是病人。（他们也有一颗心脏，以及许多其他必要的单一器官）。例如，如果您对跟踪手术感兴趣，那么每个区域都应该是一个独特的独立实体。

在生产/库存系统中，如果您正在跟踪车辆的组装，那么您当然希望以不同于车身的方式观察发动机的进展，但存在一对一的关系。护理必须有一个引擎，而且只有一个（否则它就不再是“汽车”了）。一个引擎只属于一辆车。

在每种情况下，您都可以将单独的实体生成为一个大记录，但考虑到分解的程度，那将是错误的。在这些特定的上下文中，它们是真正独立的实体，尽管它们在更高的层次上可能不会如此。

保罗。

# windows - 在 Windows Mobile 5.0 上使用 MSMQ 进行进程间（应用程序间）通信

> ID：517420
> 
> 赞同：2
> 
> 时间：2009-02-05T19:08:56.607
> 
> 标签：windows, windows-mobile

我们有一个在 Windows Mobile 5 设备上运行的 Native Embedded VC (EVC4.0) 应用程序。现在需要让该应用程序与使用 EVC4.0 或 .Net CF 开发的新移动应用程序进行通信。我们正在考虑在 Windows Mobile 设备上使用 MSMQ 在这两个应用程序之间进行进程间通信。

以前有没有人因为这种原因使用过 MSMQ？

谢谢，-席德

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-12-07T21:21:00.990

WM_COPYDATA、套接字、内存映射文件和点对点消息队列都是 CE 的 IPC 机制（也可以使用命名良好的事件）。我倾向于倾向于点对点队列或内存映射文件。哪一个取决于我要共享的数据的性质。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T19:13:18.937

我有（尽管在普通 Windows 上，而不是移动设备上）。我发现它不可靠（IIRC，MSMQ 文档不保证消息的传递）。

当我需要进行进程间通信时，我使用 WM_COPYDATA（如果通信器是两个窗口）或命名管道：

[http://www.codeproject.com/KB/threads/dotnetnamedpipespart1.aspx](http://www.codeproject.com/KB/threads/dotnetnamedpipespart1.aspx)
（那里有一个很好的即用型示例库）

# c# - 使用 C#(.Net) 在 Visual Studio 中更新系统时间

> ID：517434
> 
> 赞同：-2
> 
> 时间：2009-02-05T19:10:37.803
> 
> 标签：c#, .net

我有一个正在运行的 Web 服务正在返回一个时间。我想用我的服务返回的时间来更新我的系统时间。如何在 Visual Studio 中使用 C# 执行此操作？

**编辑：**完全重复：[使用 C# 以编程方式设置时间](https://stackoverflow.com/questions/204936/set-time-programmatically-using-c)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T19:24:23.487

你为什么要费心重新发明轮子？

Windows 已经有一个内置的 NTP/[时间服务](http://technet.microsoft.com/en-us/library/cc773013.aspx)，它将与[您创建的任何](http://technet.microsoft.com/en-us/library/cc773061.aspx)[公共时间服务器](http://support.ntp.org/bin/view/Servers/WebHome)或私人时间服务器同步时间。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T19:15:37.827

我会为 Windows API SetSystemTime 编写一个包装器。像这样的东西：

```
[StructLayout(LayoutKind.Sequential)]

public struct SYSTEMTIME

{
public short wYear;

public short wMonth;

public short wDayOfWeek;

public short wDay;

public short wHour;

public short wMinute;

public short wSecond;

public short wMilliseconds;

}

[DllImport("kernel32.dll", SetLastError=true)]

public static extern bool SetSystemTime( [In] ref SYSTEMTIME st ); 
```

（请注意，我尚未对此进行测试，但它应该可以帮助您入门）

# c# - 在自定义 GridView 中创建带有按钮的标题行

> ID：517461
> 
> 赞同：1
> 
> 时间：2009-02-05T19:15:26.470
> 
> 标签：c#, asp.net, gridview

发布后：[GridView 中的自定义标题](https://stackoverflow.com/questions/509029/custom-header-in-gridview)

...我有一个相关的问题。我在 OnDataBound 期间添加了表格行，它显示出来，链接是可点击的。在这里添加有两个问题：第一，如果没有DataBind的回发发生，则该行消失；其次，单击 LinkBut​​tons 时不会发生任何事件。这是 OnDataBound 代码：

```
 protected override void OnDataBound(EventArgs e)
{
    base.OnDataBound(e);

    // Hook up the handler to create the Selection header/footer

    // TODO: Wrap this in a function sometime
    Table table = (Table)Controls[0];
    GridViewRow row = new GridViewRow(-1, -1, DataControlRowType.EmptyDataRow, DataControlRowState.Normal);

    // TODO: should add css classes
    TableHeaderCell cell = new TableHeaderCell();
    cell.ColumnSpan = Columns.Count + 1; // plus 1 for the checkbox column
    cell.HorizontalAlign = HorizontalAlign.Left; // do this or css?

    HtmlGenericControl label = new HtmlGenericControl("label");
    label.InnerText = "Select:";

    selectNoneLK = new LinkButton();
    selectNoneLK.ID = "SelectNoneLK";
    selectNoneLK.Text = "None";
    selectNoneLK.Click += SelectNoneLK_Click;
    //selectNoneLK.CommandName = "SelectNone";
    //selectNoneLK.Command += SelectNoneLK_Click;

    selectAllLK = new LinkButton();
    selectAllLK.ID = "SelectAllLK";
    selectAllLK.Text = "All on this page";
    //selectAllLK.CommandName = "SelectAll";
    //selectAllLK.Command += SelectAllLK_Click;
    selectAllLK.Click += SelectAllLK_Click;

    cell.Controls.Add(label);
    cell.Controls.Add(selectNoneLK);
    cell.Controls.Add(selectAllLK);

    row.Controls.Add(cell);

    // Find out where to put this row

    int rowIndex = 0;
    if(SelectionMode == SelectionMode.AboveHeader)
    {
        rowIndex = 0;
    }
    else if(SelectionMode == SelectionMode.BelowHeader)
    {
        rowIndex = 1;
    }
    else if(SelectionMode == SelectionMode.AboveFooter)
    {
        rowIndex = table.Rows.Count;
    }
    else if(SelectionMode == SelectionMode.BelowFooter)
    {
        rowIndex = table.Rows.Count + 1;
    }

    table.Rows.AddAt(rowIndex, row);
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-11T05:09:52.800

您可以尝试在创建标头时将其放入 RowCreated 事件中。这也可能解决您的 LinkBut​​tons 无法正常工作的问题。

```
void GridView1_RowCreated(Object sender, GridViewRowEventArgs e)
  {

    if(e.Row.RowType == DataControlRowType.Header)
      {
         ...your code here

      } 
```

# iphone - 如何将 .ipa 文件安装到我的 iPhone 模拟器

> ID：517463
> 
> 赞同：180
> 
> 时间：2009-02-05T19:15:54.300
> 
> 标签：iphone, macos, ios-simulator

我有一个在我的 Mac 上运行的 iphone 模拟器。

我有一个 .ipa 文件，你能告诉我如何在模拟器上安装它吗？

* * *

## 回答 #1

> 赞同：146
> 
> 时间：2009-02-05T19:32:41.567

你不能。如果它是通过 iTunes 商店下载的，它是为不同的处理器构建的，并且无法在模拟器中运行。

* * *

## 回答 #2

> 赞同：109
> 
> 时间：2012-02-21T21:33:53.697

我找到了一个我想要使用 iTunes 的 .ipa 文件并将其复制到我的桌面上。

之后，我将扩展名更改为`.zip`并提取它。

接下来，我找到了 Payload 文件夹，并将应用程序移到了我的桌面上。

最后，我将该应用程序移至我的 iPhone 模拟器应用程序文件夹，该文件夹位于：

*   高清
*   > 应用
*   > Xcode.app（右键单击 - 显示包内容）
*   > 目录
*   > 开发商
*   > 平台
*   > iPhoneSimulator.platform
*   > SDK
*   > iPhoneSimulator6.0.sdk
*   > 应用

希望这可以帮助！（注意：某些应用程序比其他应用程序更频繁地崩溃。）

* * *

## 回答 #3

> 赞同：72
> 
> 时间：2015-03-24T14:02:36.193

在 Xcode 6+ 和 iOS8+ 中，您可以执行以下简单步骤

1.  将 .app 文件粘贴到桌面上。
2.  打开终端并粘贴以下命令：

    `cd desktop`

    `xcrun simctl install booted xyz.app`

3.  打开 iPhone 模拟器并点击应用程序并使用

对于 iOS 8 以下的版本，请执行以下简单步骤。

注意：您需要确保为所有架构构建您的应用程序，模拟器`x386`位于构建设置中并`Build Active Architecture Only`设置为`No`.

1.  路径：Library->Application Support->iPhone Simulator->7.1（或其他版本，如果需要）->Applications
2.  使用应用程序的名称创建一个新文件夹
3.  进入文件夹并将 .app 文件放在这里。

* * *

## 回答 #4

> 赞同：52
> 
> 时间：2018-08-23T02:16:22.513

### Xcode 9.4.1+ 的更新

希望我的答案在这里被看到，因为这花了我一段时间才弄清楚，但我刚刚开始工作。

首先，您需要在模拟器上构建和运行应用程序。然后你打开**活动监视器**。双击您的应用程序的名称以查找其内容。

[![在此处输入图像描述](https://i.stack.imgur.com/O7YRv.png)](https://i.stack.imgur.com/O7YRv.png)

在下一个屏幕中，打开**Open Files and Ports**选项卡并找到带有 MyAppName.app/MyAppName 的行。

[![在此处输入图像描述](https://i.stack.imgur.com/kkz1j.png)](https://i.stack.imgur.com/kkz1j.png)

复制链接**，但确保停在 MyAppName.app 处**。不要复制它后面的路径。

控制点击 finder 图标并选择**Go to folder**。

[![在此处输入图像描述](https://i.stack.imgur.com/lGWhw.png)](https://i.stack.imgur.com/lGWhw.png)]

粘贴路径并点击回车。您将看到您的 MyAppName.app 文件。将其复制到桌面并压缩。将其移动到您想要的第二台计算机并解压缩文件。构建一个随机项目以打开一个模拟器。

最后：将应用程序从桌面拖放到模拟器中。您将看到安装并且应用程序打开并且**不会**崩溃。

[![在此处输入图像描述](https://i.stack.imgur.com/drc66.gif)](https://i.stack.imgur.com/drc66.gif)

* * *

## 回答 #5

> 赞同：35
> 
> 时间：2013-10-30T15:38:11.573

您无法在模拟器中运行 ipa 文件，因为 ipa 文件是针对手机的 ARM 架构而不是模拟器的 x86 架构编译的。

但是，您可以提取安装在本地模拟器中的应用程序，将其发送给其他人，然后让他们将其复制到他们机器上的模拟器中。

在终端中，键入：

```
open ~/Library/Application\ Support/iPhone\ Simulator/*/Applications 
```

这将打开您已安装的所有模拟器的所有应用程序文件夹。每个应用程序都将位于具有随机十六进制名称的文件夹中。您可以通过查看每个应用程序来确定哪个是您的应用程序。找到所需的文件后，右键单击它并选择“压缩...”，它将生成一个 zip 文件，您可以轻松地将其复制到另一台计算机并解压缩到类似的位置。

* * *

## 回答 #6

> 赞同：35
> 
> 时间：2017-02-18T14:26:57.650

## 更新：对于 Xcode 8.0+，您需要按照以下步骤操作：

1.  从 iTunes 下载应用程序
2.  选择下载的应用，右键在finder中显示
3.  将`.ipa`文件复制到桌面，将其重命名为`.zip`文件
4.  提取该`.zip`文件，您将获得具有应用程序名称的目录
5.  检查您将在**Payload**`app`文件夹中找到文件的目录，复制此文件**`app`**

***   去`~/Library/Developer/CoreSimulator/Devices`** 

 ***仅供参考：`Library`默认情况下，文件夹在 mac 中是隐藏的，您可以使用以下命令查看隐藏文件。*

```
defaults write com.apple.finder AppleShowAllFiles YES;
killall Finder /System/Library/CoreServices/Finder.app 
```

现在在这里您将看到许多具有长十六进制名称的目录，这些都是模拟器。

要找到您想要的模拟器，请使用“Arranged By > Date Modified”对这些目录进行排序。

选择该模拟器文件并转到以下位置。

1.  `<HEXADECIMAL-SIMULATOR-STRING>/data/Containers/Bundle/Application/`
2.  使用该文件夹创建新文件夹名称并将文件`<download-app-name>`粘贴`app`到该文件夹​​中
3.  打开**终端**并运行以下命令以安装此应用程序

    ```
    xcrun simctl install booted <APP_FILE_PATH> 
    ```

示例`<APP_FILE_PATH>`如下所示：

```
~/Library/Developer/CoreSimulator/Devices/<HEXADECIMAL-SIMULATOR-STRING>/data/Containers/Bundle/Application/<APP_NAME> 
```

* * *

## 回答 #7

> 赞同：22
> 
> 时间：2017-05-17T20:42:30.353

首先，IPA 通常只有 ARM 切片，因为 App Store 目前不接受上传中的模拟器切片。

其次，从 Xcode 8.3 开始，您可以将包拖放`.app`到模拟器窗口中，它将被安装。`~/Library/Developer/Xcode/DerivedData/projectname-xyzzyabcdefg/Build/Products/Debug-iphonesimulator`如果您想保存它或将其分发给其他人，您可以在您的构建产品目录中找到该应用程序。

要从命令行安装，请使用`xcrun simctl install <device> <path>`.

`device`可以是设备 UUID、它的名称，或者`booted`表示当前启动的设备。

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2020-05-08T06:04:32.143

对于 Xcode 10，这是一种对我来说适用于调试 IPA（开发配置文件）的简单方法

1.  解压缩 IPA 以获取 Payload 文件夹。
2.  在 Payload 文件夹中是应用程序可执行文件。
3.  将应用拖放到打开的模拟器中。（当您将它拖到模拟器上时，您可能会看到一个绿色的添加按钮）

它应该在该模拟器上安装该应用程序。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2011-09-17T09:54:47.693

您可以在模拟器中运行项目的应用程序文件 - 而不是 .ipa 文件。

**你可以从：**

`Libraries-->Applicationsupport-->iphone simulator-->4.3(its ur simulator version)-->applications-->`然后你可以看到很多文件，比如`0CD04F....`通过打开它找到你的应用程序文件。

您可以将文件复制到您的系统（您需要运行哪个系统模拟器）位置`Libraries-->Applicationsupport-->iphone simulator-->4.3(its your simulator version)-->applications-->`

然后打开模拟器 4.3（它是您粘贴的模拟器版本）。您可以看到那里安装的应用程序。

* * *

**从别人那里得到：**

请告诉他们找出来，`Libraries-->Applicationsupport-->iphone simulator-->4.3(its ur simulator version)-->applications-->`然后您可以`0CD04F....`从他们的系统中看到许多文件，并从他们那里接收该文件。

他们得到文件后，请将文件复制并粘贴到您的系统中 `Libraries-->Applicationsupport-->iphone Simulator-->4.3(它的模拟器版本)-->applications-->(将文件粘贴到这里）。

然后您可以看到该应用程序已安装在您的系统模拟器中，您可以在单击文件后运行它。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2014-09-15T11:32:34.370

**从这里复制：**
- 在 Xcode 中运行应用程序。- 选择 Finder 转到 Go 并单击选择 Library Library/Application Support/iPhone Simulator/7.0.3-64/Applications - 选择 32 位文件夹复制您的应用程序。

**粘贴到此处：**
- /Applications/Xcode-Beta.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhone Simulator。SDK/应用程序
- 粘贴到这里并运行模拟器。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2015-02-03T20:15:31.530

使用 Xcode 6：

在模拟器上构建和安装是非常有可能的。

我通过在项目设置中复制调试构建配置（我在下面的示例中将其称为 SimRelease）来做到这一点。我将架构更改为 i386 和 x86_64（不确定这是多么必要），但在复制的构建配置之间进行更改的关键区别是为活动架构设置为 NO。之后，几个简单的命令行工具将完成剩下的工作！

```
xcodebuild -scheme YOUR_SCHEME -configuration SimRelease -sdk iphonesimulator8.1 
```

根据您设置 DerivedData 的位置，您需要找到输出的 .app 文件夹。找到它后，您可以简单地将其安装在任何模拟器设备上。要找到设备 UUID 的打开 Xcode 并转到 Window->Devices，您将看到设备实例列表，您可以获取 UUID。对于一个简单的脚本，您可以从以下位置获取所有脚本：~/Library/Developer/CoreSimulator/Devices/ 并安装在每个设备上。

从那里安装在设备上的简单命令是：

xcrun simctl install DEVICE_ID APP_FOLDER_LOCATION

这是一个简单的 shell 脚本，用于获取应用程序并将其安装在每台设备上：

```
app_dir=$1
current_dir=$(pwd)
cd ~/Library/Developer/CoreSimulator/Devices/
devices=$(ls -d */)
cd "$current_dir"
for device in $devices
do
    device_id=${device%/}
    xcrun simctl install "$device_id" "$app_dir"
done 
```

希望这可以帮助！我花了一段时间才找出最好的方法。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2020-04-03T10:43:26.480

在没有任何代码仓库的情况下在不同的模拟器中运行的步骤：-

首先通过构建您的项目（在 Xcode 中的项目文件夹下）创建一个 .app 并将其粘贴到适当的位置（参见图片以获得更清晰）

[![在此处输入图像描述](https://i.stack.imgur.com/40q1C.png)](https://i.stack.imgur.com/40q1C.png)

1.  下载 Xcode
2.  创建一个演示项目并启动要在其中运行应用程序的模拟器。
3.  将 .app 文件复制到特定位置（例如：- 桌面）。
4.  cd 桌面并运行命令（xcrun simctl install booted appName.app），
5.  应用程序将安装在特定的启动模拟器中。

# asp.net - 代码可重用性 - App_Code 或 BIN 或 UserControls？

> ID：517480
> 
> 赞同：2
> 
> 时间：2009-02-05T19:18:59.253
> 
> 标签：asp.net, session-state, reusability

我最近在另一个论坛上与另一个开发人员进行了讨论，主题是 ASP.NET 中的代码重用。所述场景是他需要在服务器正常运行期间频繁更新生产服务器上的代码，这会导致所有用户的 Session 被重置。他避免将共享代码或类放入 App_Code 文件夹或将预编译的 DLL 放入 Bin 文件夹，因为任何更新也会刷新会话。

他提出的解决方案是将他的共享代码放入 UserControls 并在需要的地方引用它们。这使他能够仅更新将在下一次请求时动态重新编译的 UserControl 文件，而无需强制重新启动会话。请注意，用户控件不打算有任何 UI，它们可能只包含一些业务逻辑。

我试图说服他不要这样做，因为这对我来说本质上是错误的——但我无法提供任何确凿的事实来支持我的说法，即这是一种非常糟糕的做事方式。我唯一能想到的是它违反了业务逻辑与UI分离的原则。我是大错特错还是有具体的理由不应该这样做？链接或示例会有所帮助。

注意：*目前不能选择使用进程外会话状态，他们也无法决定计划的停机时间。此外，由于这是一个正在积极开发的站点，他们似乎还没有使用任何专业的部署模型。*

提前致谢。

编辑：此外，如果有人能准确地阐明会话在上述情况下重新启动的原因，那将会很有帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T19:24:09.617

听起来主要问题是他过于频繁地更新生产代码。除此之外，UserControls 似乎是一个放置业务逻辑的完全合理的地方，特别是如果您对它们有良好的命名约定或者可以将它们放在一个公共文件夹中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-05T19:24:23.363

请问，为什么进程外会话状态不是一个选项，真的吗？既然这家伙似乎为了解决这个“问题”付出了很多努力，他不应该寻找更好的解决方案吗？进程外会话状态是唯一好的解决方案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-05T19:27:48.020

这似乎是一种不寻常的方法，持久会话是显而易见的答案。假设不使用持久会话的理由是合法的，有时您只需要使用任何可行的方法。我会在源文件中明确记录用户控件的不寻常使用并接受它。

回答为什么会话会重置编辑。在进程会话中，所有会话数据都作为应用程序的一部分在内存中。对网站的各种更改（例如 web.config 和其他我不记得的）会导致应用程序重新启动，清除应用程序中的所有当前状态。坚持 SQL 或进程外会话状态服务器将允许应用程序重置并丢失任何状态，而不会影响会话数据。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T19:28:21.873

我同意 Dennis 的观点，从 inproc 转移到状态服务器确实没有问题。不确定您的开发/部署平台是什么，但它们应该包含会话状态服务 - 启动它，更改您的 web.config，问题就解决了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-05T19:35:39.143

这是一个常见问题的聪明（和丑陋）解决方案

The main problem is the architecture of such system; the code that needs to be updated can be put on a different service outside his web app, his code behind can then call these services, and the services can be updated when needed without affecting the web app

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-05T20:08:00.170

Every base has been covered already, but I really hate bad practices like this. If the guy can't simply change to a state server to fix the problem that he has, then he doesn't really deserve the help. What would happen if he put his class in the root folder of the project and compiled it independently? Either way, I would think this guy is a bad developer for not thinking about scalability, and not planning for downtime. What I'm guessing is he doesn't have a development environment available. Tsk tsk tsk.

正如其他人所说，作为对您问题的回答，将代码放在用户控件中，并做好记录。

# datetime - 时间/日期范围语法

> ID：517489
> 
> 赞同：2
> 
> 时间：2009-02-05T19:22:20.340
> 
> 标签：datetime, parsing, grammar, timespan

我需要解析包含时间跨度的字符串，例如：

*   星期四 6:30-7:30 AM
*   2009 年 12 月 30 日 - 2010 年 1 月 1 日
*   2009 年 1 月 15 日，晚上 7:30 至 8:30
*   星期四，早上 6:30 到 7:30
*   和别的...

*添加*

*   6:30 至 7:30

和日期/时间，例如 Word 的 insert->date 可以生成的大多数情况

如果有任何东西涵盖了我需要涵盖的所有案例，我会感到非常惊讶，因此我正在寻找语法开始。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-05T19:45:14.163

好的，以下语法会解析示例中的任何内容：

```
DTExp        = Day, ['-', Day]
Day          = DayExp, [[','], ['from'], TimeRange]
DayExp       = WeekDay
             | [Weekday], Month, DayNumber, [[','], YearNumber]
             | [Weekday], MonthNumber, '/', DayNumber, ['/', YearNumber]
TimeRange    = Time, [['-'|'to'] Time]
Time         = HourNumber, ':', MinuteNumber, ['AM'|'PM']
WeekDay      = 'monday' | 'tuesday' | ...
Month        = MonthNumber | MonthName
MonthName    = 'january' | 'february' | ...
DayNumber    = Number
MonthNumber  = Number
YearNumber   = Number, ['AD'|'BC']
HourNumber   = Number
MinuteNumber = Number 
```

语法有一点小问题。如果读取一个 DayExp，后跟一个 Time 和一个“-”，那么您可能会期待另一个 DayExp 或另一个时间。但这可以通过前瞻来解决，因为如果是时间，数字后跟一个'：'。

让我们尝试构建一个解析树：

```
Thursday  6    :  30     -   7    :   30    AM
    |     |        |         |         |     |
WeekDay Number : Number  - Number : Number   |
    |     -----|----         -----|----------- 
    |         Time       -       Time
    |           ---------|---------
 DayExp              TimeRange
    ----------|-----------
             Day
              |
            DTExp 
```

# python - 在python中将字符串作为命令执行

> ID：517491
> 
> 赞同：1
> 
> 时间：2009-02-05T19:23:05.003
> 
> 标签：python, django, path

我正在用python开发我的东西。在这个过程中，我遇到了一个名为“import django”的字符串的情况。我想验证这个字符串。这意味着，我想检查提到的模块（在这种情况下为“django”）是否在 python-path 中。我该怎么做？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-05T19:44:22.447

我之前的回答是错误的——我没想过要测试我的代码。不过，这实际上是可行的：查看[imp](http://docs.python.org/library/imp.html)模块。

在当前 sys.path 中检查模块的可导入性：

```
try:
    imp.find_module('django', sys.path)
except ImportError:
    print "Boo! no django for you!" 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T19:30:45.393

我怀疑它是安全的，但它是最天真的解决方案：

```
try:
     exec('import django')
except ImportError:
    print('no django') 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-06T20:55:26.407

如果模块名称以字符串形式提供，则可以使用内置`__import__`函数导入它。

```
module = __import__("module name", {}, {}, [], -1) 
```

例如，

```
os = __import__("os", {}, {}, [], -1) 
```

# java - jvm设计决策

> ID：517502
> 
> 赞同：16
> 
> 时间：2009-02-05T19:25:06.933
> 
> 标签：java, .net, clr, jvm

为什么 jvm 需要大约 10 MB 的内存来实现一个简单的 hello world 而 clr 不需要。这里的权衡是什么，即 jvm 通过这样做可以获得什么？

让我澄清一下，因为我没有传达我脑海中的问题。jvm 和 clr 运行时之间显然存在架构差异。jvm 的内存占用明显高于 clr。我假设这种开销有一些好处，否则为什么会存在。我在问这两种设计的权衡是什么。jvm 从它的内存开销中获得了什么好处？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-16T04:52:32.330

我想一个原因是Java必须自己做所有事情（平台独立性的另一个方面）。例如，Swing 从头开始​​绘制它自己的组件，它不依赖操作系统来绘制它们。这一切都必须发生在记忆中。windows 可以做的很多事情，但 linux 没有（或做不同的事情）必须完全包含在 Java 中，以便它在两者上的工作方式相同。

Java 还始终坚持认为它的整个库都是“链接的”并且可用。因为它不使用 DLL（它们不会在每个平台上都可用），所以一切都必须由 java 加载和跟踪。

Java 甚至做了很多它自己的浮点，因为 FPU 经常给出不同的结果，这被认为是不可接受的。

因此，如果您考虑 C# 可以委托给它所关联的操作系统的所有东西与 Java 必须为操作系统做的所有东西以补偿其他东西，那么应该可以预料到差异。

我现在已经在 2 个嵌入式平台上运行 java 应用程序。一个是实际绘制轨迹的频谱分析仪，另一个是机顶盒。

在这两种情况下，最小的内存占用都不是问题——存在 Java 特定的问题，只是没有。在这些情况下，实例化对象的数量和 Swing 绘制速度是更大的问题。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-12T22:13:19.200

似乎java只是使用更多的*虚拟*内存。

```
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
amwise   20598  0.0  0.5  22052  5624 pts/3    Sl+  14:59   0:00 mono Test.exe
amwise   20601  0.0  0.7 214312  7284 pts/2    Sl+  15:00   0:00 java Program 
```

我用 C# 和 Java 编写了一个测试程序，打印字符串“test”并等待输入。我相信驻留集大小 (RSS) 值更准确地显示了内存使用情况。虚拟内存使用 (VSZ) 意义不大。

据我了解，应用程序可以保留大量虚拟内存，而无需实际使用任何真实内存。例如，您可以要求 Windows 上的[VirtualAlloc](http://msdn.microsoft.com/en-us/library/aa366887.aspx)函数保留或提交虚拟内存。

编辑：

这是我的 Windows 框中的一张漂亮图片： [alt text http://awise.us/images/mem.png](http://awise.us/images/mem.png)

每个应用程序都是一个简单的 printf，后跟一个 getchar。Java 和 CLR 使用大量虚拟内存。C 版本几乎不依赖任何东西，因此它的内存使用量相对较小。

我怀疑这是否真的很重要。只需选择您更熟悉的平台，然后不要编写糟糕的、浪费内存的代码。我相信它会成功的。

编辑：

这个来自 Microsoft 的[VMMap 工具](http://technet.microsoft.com/en-us/sysinternals/dd535533.aspx)可能有助于确定内存的去向。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-15T03:43:42.973

我不知道初始内存占用或 Hello World 应用程序的占用是否重要。差异可能是由于 JVM / CLR 加载的库的数量和大小。还可以有为垃圾收集池预先分配的内存量。

我知道的每个应用程序都使用了比 Hello World 更多的功能。这将在整个应用程序的执行过程中加载和释放内存数千次。如果您对 JVM 与 CLR 的内存利用率差异感兴趣，这里有几个链接很好的信息

[http://benpryor.com/blog/2006/05/04/jvm-vs-clr-memory-allocation/](http://benpryor.com/blog/2006/05/04/jvm-vs-clr-memory-allocation/)

[内存管理案例研究（JVM 和 CLR）](http://www.google.com/url?sa=t&source=web&ct=res&cd=9&url=http%3A%2F%2Fwww.cse.iitk.ac.in%2Fusers%2Fvkirankr%2FMemory%2520Architecture.ppt&ei=CuQMSomvKaCc8QSllbjSDw&usg=AFQjCNHbEG20tTrW9vaq67ufoLdfOoir3w&sig2=kvYwfLyWEMhtIMY6iqiYLg)

内存管理案例研究在 Power Point 中。一个非常有趣的演示。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-05T22:54:02.160

JVM 计算其所有共享库，无论它们是否使用内存。

在报告程序的内存消耗时，任务管理器相当不可靠。你应该把它当作指南。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-18T08:04:48.863

JVM 在每次运行时从 rt.jar 加载大量不必要的核心类。不幸的是，java 包的内部交叉依赖（java.lang <-> java.io）使得部分运行时初始化变得困难。更何况 rt.jar 本身超过 40MB，查找和解压缩需要大量时间。

Post Java 6u10 似乎加载的东西更智能了（它有一个 jqs.exe = java 快速启动服务来将必要的数据保存在内存中并进行更快的启动），但 Java 7 仍然被告知要更好。

Windows 中的进程资源管理器正确报告私有字节（私有字节是那些不被任何 dll 共享的内存区域）。

稍大一点的烦恼是，10 年后，JVM 仍然默认使用 64MB 内存。几乎每次都使用 -Xmx 真的很烦人，并且无法通过简单的双击在 jar 中运行要求苛刻的程序（除非我更改文件扩展名分配的命令）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-05T19:51:22.387

CLR 被视为操作系统的一部分，因此任务管理器不会在应用程序进程下报告它的内存消耗。

# .net - 选择主键

> ID：517505
> 
> 赞同：0
> 
> 时间：2009-02-05T19:25:48.773
> 
> 标签：.net, sql, datarow

[更新：MS SQL Server 2005]

嗨，是否可以选择一堆值，然后在 select 语句中指定一列作为主键？

```
SELECT ID FROM HQ AS PRIMARYKEY -- this is wrong
SELECT Names FROM Stores
SELECT PRODUCTNAME FROM PRODUCTS 
```

我问这个是因为我想利用 .net 中的 DataRow 查找方法，谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T19:32:19.633

填充数据集后，您必须使用 DataTable 对象指定主键，而不是在 sql 查询中。

```
myTable.PrimaryKey = new DataColumn[] {
    myTable.Columns["SomeColumn"]
}; 
```

然后你可以使用 Find() 方法

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T19:32:20.973

不，我认为您不能这样做，那就是让 SQL 服务器将准备好的索引传递给 .NET 应用程序。您可以向将保存数据的 DataTable 添加一个索引，它将在客户端构建。

# javascript - 正确的 element.getElementsByTagName() 实现

> ID：517506
> 
> 赞同：0
> 
> 时间：2009-02-05T19:25:51.253
> 
> 标签：javascript, html, dom

//编辑我的问题与其他问题有关，我认为实现不正确，但它确实有效，感谢您的确认。

查看 jQuery 和prototypejs，似乎找不到他们在元素上实现*getElementsByTagName*的方式（不是document.getElementsByTagName）。

这是我的测试html：

```
<div id="something" style="margin: 10px 10px 10px 15px; overflow: auto; position: relative; height: 200px;">
    <div style="float: left; width: 180px; font-size: 10px; margin-bottom: 4px;">
        <label for="label_50">
            <img style="vertical-align: middle; margin-right: 3px;" src="http://web1.wow.com/i/i_ask_sm.gif"/>
            <a style="color: rgb(0, 0, 0); text-decoration: underline;" href="http://myjeeves.ask.com/mysearch/BookmarkIt?v=1.2&t=webpages&url=[URL]&title=[TITLE]" post_link="http://myjeeves.ask.com/mysearch/BookmarkIt?v=1.2&t=webpages&url=[URL]&title=[TITLE]" rel="external" target="_blank">Ask</a>
        </label>
    </div>
</div> 
```

还有我现在的js：

```
document.getElementById("something").getElementsByTagName("a"); 
```

我正在寻找这个的正确实现，因为当然 IE 似乎无法正常使用它，而且我**不能使用 framework**。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T19:39:20.337

```
<div id="something" style="margin: 10px 10px 10px 15px; overflow: auto; position: relative; height: 200px;">
    <div style="float: left; width: 180px; font-size: 10px; margin-bottom: 4px;">
        <label for="label_50">
            <img style="vertical-align: middle; margin-right: 3px;" src="http://web1.wow.com/i/i_ask_sm.gif"/>
            <a style="color: rgb(0, 0, 0); text-decoration: underline;" href="http://myjeeves.ask.com/mysearch/BookmarkIt?v=1.2&t=webpages&url=[URL]&title=[TITLE]" post_link="http://myjeeves.ask.com/mysearch/BookmarkIt?v=1.2&t=webpages&url=[URL]&title=[TITLE]" rel="external" target="_blank">Ask</a>
        </label>
    </div>
</div>
<pre>
<script type="text/javascript">
var lnks = document.getElementById("something").getElementsByTagName("a");
for (var ii = 0; ii < lnks.length; ++ii) {
    document.writeln(lnks[ii].href);
}
</script>
</pre> 
```

在 IE6、IE7 和 IE8RC1 中输出：

```
http://myjeeves.ask.com/mysearch/BookmarkIt?v=1.2&t=webpages&url=[URL]&title=[TITLE] 
```

您的示例是否实际上没有说明问题？

# javascript - 如何在jquery中从json中获取不同的值

> ID：517519
> 
> 赞同：9
> 
> 时间：2009-02-05T19:28:04.853
> 
> 标签：javascript, jquery, json

我有一个 jquery json 请求，并且在那个 json 数据中我希望能够按唯一值排序。所以我有

```
{
  "people": [{
        "pbid": "626",
        "birthDate": "1976-02-06",
        "name": 'name'
      }, {
        "pbid": "648",
        "birthDate": "1987-05-22",
        "name": 'name'
      }, ..... 
```

所以，到目前为止，我有这个

```
function(data) {
  $.each(data.people, function(i, person) {
    alert(person.birthDate);
  })
} 
```

但是，我完全不知道如何有效地仅获取唯一的出生日期，并按年份对它们进行排序（或按任何其他个人数据排序）。

我正在努力做到这一点，并对此保持高效（我希望这是可能的）。

谢谢

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-05T19:46:27.857

我不确定它的性能如何，但基本上我使用一个对象作为键/值字典。我没有测试过这个，但这应该在循环中排序。

```
function(data) {
    var birthDates = {};
    var param = "birthDate"
    $.each(data.people, function() {
        if (!birthDates[this[param]])
            birthDates[this[param]] = [];   
        birthDates[this[param]].push(this);
    });

    for(var d in birthDates) {
        // add d to array here
        // or do something with d
        // birthDates[d] is the array of people
    }
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-05T20:05:51.390

```
function(data){
    var arr = new Array();
    $.each(data.people, function(i, person){
        if (jQuery.inArray(person.birthDate, arr) === -1) {
            alert(person.birthDate);
            arr.push(person.birthDate);
        }
    });
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-05T23:28:38.440

这是我的看法：

```
function getUniqueBirthdays(data){
    var birthdays = [];
    $.each(data.people, function(){
        if ($.inArray(this.birthDate,birthdays) === -1) {
            birthdays.push(this.birthDate);
        }
    });
    return birthdays.sort();
} 
```

# linux - 如何使用 bash 确定声卡类型？

> ID：517522
> 
> 赞同：4
> 
> 时间：2009-02-05T19:29:01.730
> 
> 标签：linux, bash

在 bash 中，如何确定安装的是什么声卡？我正在尝试为 Rhythmbox 创建一个插件，我想在配置脚本中对此进行测试。

**编辑：** 在我的机器上，我需要使用`sudo`才能使用`lspci`和`lsmod`. @ [Quassnoi](https://stackoverflow.com/questions/517522/how-do-i-determine-sound-card-type-with-bash/517549#517549)的回答使用`cat`工作没有额外的特权。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-05T19:33:38.727

```
lspci | grep -i audio 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-05T19:34:26.710

```
cat /proc/asound/cards 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-05T19:37:06.270

我想你有一个已知声音的列表，你将在你的配置脚本中检查。因此，您可以使用 grep 和 lsmod 来检查加载了哪一个。

`# lsmod | grep -q snd_hda_intel`

`# echo $?`

`0`

`# lsmod | grep -q snd_foo`

`# echo $?`

`1`

# java - spring 不强制执行方法安全注释

> ID：517527
> 
> 赞同：15
> 
> 时间：2009-02-05T19:30:20.683
> 
> 标签：java, annotations, spring-security

对于为什么 spring 没有在我的服务接口上强制执行 @Secured("ROLE_USER") ，我有些迷茫。我的控制器是使用注释建立的。

我的服务接口示例

```
public interface MyServiceManager {

    @Secured("ROLE_USER")
    public void delete(int cid);

    @RolesAllowed({"ROLE_USER"})
    public Contact getContact(int contactId);
} 
```

我的安全上下文：

```
<global-method-security   secured-annotations="enabled" jsr250-annotations="enabled">
</global-method-security>

<http auto-config="true" >
    <intercept-url pattern="/secure/**" access="ROLE_SUPERVISOR" />
    <intercept-url pattern="/addcontact**" access="IS_AUTHENTICATED_REMEMBERED" />
    <intercept-url pattern="/**" access="IS_AUTHENTICATED_ANONYMOUSLY" />

    <concurrent-session-control max-sessions="1"
        exception-if-maximum-exceeded="true"/>
    <form-login login-page="/login.jsp" authentication-failure-url="/login.jsp?login_error=1"/>
    <logout logout-success-url="/welcome.do" logout-url="/logout"/>
</http>
    <authentication-provider>
    <password-encoder hash="md5"/>
    <user-service>
        <user name="rod" password="a564de63c2d0da68cf47586ee05984d7" authorities="ROLE_SUPERVISOR, ROLE_USER, ROLE_TELLER" />
    </user-service>
</authentication-provider> 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-06T01:47:54.897

你有声明吗

```
<global-method-security   secured-annotations="enabled" jsr250-annotations="enabled" /> 
```

在与您定义 MyServiceManager bean 相同的配置文件中？在我打开 org.springframework 的调试之前，我遇到了同样的问题，并注意到 spring security 仅应用于与定义 global-method-security 的文件相同的文件。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-03-30T10:03:48.650

就我而言，此语句的确切位置：

```
<global-method-security secured-annotations="enabled" > 
```

事实证明非常重要。确保在声明应扫描哪些类并将其用作控制器**之后放置它。**

```
<context:component-scan base-package="com.test.controller" /> 
```

这是确保@Secured 注释也将进入游戏的方法

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-11T20:20:59.083

在对这个问题进行了更多研究之后，我得出了以下结论/解决方案。我不确定它是否 100% 正确..但它有效。

我将所有配置都放在了 dispatcher-servlet.xml 文件中。因此，不要使用 disptacher-servlet.xml 和 application-context.xml。dispatcher-servlet.xml 由应用程序加载（contextConfigLocation）。在 dispatcher-servlet.xml 中，我导入了我的 security-context.xml 和 datasource-context.xml。之后，一切正常。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-19T21:06:08.323

我有同样的问题。使用 Kent Lai 在这里回复的信息，我能够修复它。

我将`<global-method-security>`元素放在 my`app-servlet.xml`中，但将安全定义单独保存在 中`security.xml`，其中`web.xml`有`contextConfigLocation`for`app-servlet.xml`和`security.xml`.

现在就像一个魅力！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-07T03:05:30.247

尝试将注释放在实现类而不是接口上，看看是否有效。我最终在最近的一个项目中这样做了，因为我也在我的服务层上使用了 @Transactional 属性，并且 Spring 文档建议将它们放在类上而不是接口上。我不知道同样的问题是否适用于@Secured，但我想将注释保留在同一个地方。查看[Spring 文档](http://static.springframework.org/spring/docs/2.5.x/reference/transaction.html#transaction-declarative-annotations)

关于 Kent Lai 的回答……这是个好主意……确保您的安全配置文件实际上包含在 Spring 中。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-12-23T10:58:08.653

你在 web.xml 中使用过类似的东西吗

```
<servlet>
    <servlet-name>name</servlet-name>
    <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
    <init-param>
        <param-name>contextConfigLocation</param-name>
        <param-value>/WEB-INF/spring/webmvc-config.xml</param-value>
    </init-param>
    <load-on-startup>1</load-on-startup>
</servlet> 
```

我不知道为什么，但如果我使用 DispatcherServlet 我无法强制执行安全注释

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-04-22T12:59:14.537

我有同样的问题。我添加后：

```
<context:annotation-config /> 
```

在我的 spring-security.xml 文件中它消失了。

希望这会对某人有所帮助:)

# java - 在 Java 中写 long 和 double 不是原子的？

> ID：517532
> 
> 赞同：33
> 
> 时间：2009-02-05T19:31:24.610
> 
> 标签：java, concurrency

> 单个变量的读写是原子的（语言保证！），除非变量是 long 或 double 类型。

我正在阅读课程的幻灯片，我发现那是写的。这门课是关于并发的。

谁能向我解释为什么写一个 long 或 double 不是原子操作？真的让我大吃一惊。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-02-05T19:32:39.617

它不是原子的，因为它是机器代码级别的多步操作。也就是说，long 和 double 比处理器的字长长。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-07-28T00:47:19.520

只是为了澄清 Java 的情况，除非声明它们，否则不会以原子方式读取或写入双精度和长整型`volatile`

[JLS - 双和长的非原子处理](http://docs.oracle.com/javase/specs/jls/se7/html/jls-17.html#jls-17.7)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2016-11-28T07:07:36.003

Java long 和 double 在 32 位机器中不是原子的，但在带有一些 64 位 JVM 的 64 位机器中是原子的。为什么它取决于机器位长度？因为 32 位机器需要两次长时间写入（只要是 64 位）。阅读[此](http://docs.oracle.com/javase/specs/jls/se7/html/jls-17.html#jls-17.7)内容以获取详细信息。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2017-10-12T08:05:10.443

很多程序员在实践java并发中的“3.1.2.非原子64位操作”中一定读过这句话。我已经提到了最新的 JLS [17.7。double 和 long 的非原子处理](https://docs.oracle.com/javase/specs/jls/se9/html/jls-17.html#jls-17.7)。他们仍然无处声称 64 位 JVM 现在是常态。因此，64 位操作被分解为 32 位操作，这些操作破坏了原子性并且在多线程环境中使用很危险，直到声明为 volatile 。Java 中的 long 和 double 是 64 位长。所以写和读操作在java中不是原子的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-05-17T08:37:32.913

Java 编程语言内存模型，对非易失性 long 或 double 值的单次写入被视为两次单独的写入：一次写入每个 32 位一半。这可能导致线程从一次写入中看到 64 位值的前 32 位，而从另一次写入中看到后 32 位。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-03-28T05:19:03.783

阅读 maaartinus 的回答@Java[中的哪些操作被认为是原子的？](https://stackoverflow.com/questions/4756536/what-operations-in-java-are-considered-atomic)
阅读 Jon Skeet @When[原始数据类型在 Java 中不是线程安全的答案？](https://stackoverflow.com/questions/9278764/are-primitive-datatypes-thread-safe-in-java)

根据[JLS](http://docs.oracle.com/javase/specs/jls/se7/html/jls-17.html#jls-17.7)，您可以通过将 double 和 long 声明为 volatile 来对 double 和 long 进行读写操作。但这并不能确保 ++ 是原子的。这需要 concurrent.atomic 包。
阅读Louis Wasserman 的[回答](https://stackoverflow.com/questions/19744508/volatile-vs-atomic)。

还有这个[博客](http://jeremymanson.blogspot.in/2007/08/volatile-does-not-mean-atomic.html)和评论。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-12-20T16:22:38.030

原子变量操作意味着任何线程都可以读取/写入它而不会产生任何垃圾

由于硬件限制，非`long`/`double`读/写适用`atomic`于 x32 和**某些x64。**如果`volatile`使用它，它会生成/添加到它`atomic`

[[原子性]](https://stackoverflow.com/a/59491099/4770877)

# ruby - JRuby 与 YARV 性能 --- 显着差异？

> ID：517545
> 
> 赞同：6
> 
> 时间：2009-02-05T19:33:21.673
> 
> 标签：ruby, jruby

我读过最新版本的 Ruby 解释器 (YARV) 将由于字节码编译而有显着的性能改进。我的问题是有没有人尝试过针对 JRuby 运行它？在 Windows 上执行有什么显着差异吗？

这个链接有一些很好的指标，但大多数都是在 Linux 上运行的...... [http://antoniocangiano.com/2007/02/19/ruby-implementations-shootout-ruby-vs-yarv-vs-jruby-vs-gardens-point -ruby-net-vs-rubinius-vs-cardinal/](http://antoniocangiano.com/2007/02/19/ruby-implementations-shootout-ruby-vs-yarv-vs-jruby-vs-gardens-point-ruby-net-vs-rubinius-vs-cardinal/)

提前致谢！

托德

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-06T14:25:02.217

那个fib条目已经快2岁了。JRuby 比现在快得多。Fib 几乎不是运行时性能的良好基准，但以下是我机器上的一些数字（运行 SoyLatte (Java 6) 的 32 位 MBP）：

```
jruby --server bench/bench_fib_recursive.rb
  0.661000   0.000000   0.661000 (  0.661139)
  0.346000   0.000000   0.346000 (  0.345864)
  0.343000   0.000000   0.343000 (  0.342955)
  0.348000   0.000000   0.348000 (  0.348176)
  0.343000   0.000000   0.343000 (  0.342783)

jr --fast --server bench/bench_fib_recursive.rb
  0.833000   0.000000   0.833000 (  0.832847)
  0.265000   0.000000   0.265000 (  0.264644)
  0.249000   0.000000   0.249000 (  0.248780)
  0.254000   0.000000   0.254000 (  0.253551)
  0.254000   0.000000   0.254000 (  0.254364)

ruby1.9 bench/bench_fib_recursive.rb
  0.380000   0.010000   0.390000 (  0.381058)
  0.370000   0.000000   0.370000 (  0.400535)
  0.370000   0.000000   0.370000 (  0.388423)
  0.370000   0.000000   0.370000 (  0.400368)
  0.370000   0.010000   0.380000 (  0.398530) 
```

所以我们的默认模式比 Yarv 快一点，而我们更新的仍然有些实验性的 --fast 模式要快得多。我们在 JRuby 性能方面的工作从不停滞不前，我们将不断提高速度。

对于发布古代图表的评论者，请检查这些事情的日期。如果它只有一周或一两个月大......那么也许......但大多数项目在一年内发生重大变化，更不用说两年了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-07T02:14:10.867

[Great Ruby Shootout](http://antoniocangiano.com/2008/12/09/the-great-ruby-shootout-december-2008/)或多或少是这种无上下文比较的权威来源。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T22:08:50.757

[红宝石 1.9.1p0 / jruby 1.2.0](http://shootout.alioth.debian.org/u32q/benchmark.php?test=all&lang=yarv&lang2=jruby&box=1) Ubuntu Linux

# .net - 是否值得为小型（ish）应用程序使用 3 层架构

> ID：517548
> 
> 赞同：6
> 
> 时间：2009-02-05T19:34:26.010
> 
> 标签：.net, asp.net, design-patterns, architecture, n-tier-architecture

我正在开发一个相对较小的 asp.net Web 应用程序，我想知道是否真的需要采用完整的 n 层架构。对于大小的想法；大约有20个数据库表。

过去，我使用了一种 2 层方法，其中业务逻辑和数据访问被组合到一个类库中，其中一个 asp.net Web 应用程序形成 UI 层，这似乎工作正常。

是否有阈值大小或一些经验法则，您应该在哪里使用 n 层？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-05T19:37:24.037

它现在可能相对较小，但您认为它将来可能会增长吗？当然，您必须务实，但是如果您已经在单个程序集中自然地分离了关注点，那么将其拆分为两个或多个程序集是相当容易的。如果这些类本身结合了业务逻辑和数据访问，那么您将有更多的工作要做。但是，我认为在一个程序集中编写数据访问逻辑并在另一个程序集中编写业务逻辑（如果需要的话并行编写）比一开始就将它们全部编写在一个地方几乎没有更多的工作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-05T19:38:39.667

如果您预计会有任何形式的增长或变化，那么现在加强明确的层级将有所帮助。但是，如果这是您自己的项目，并且您不介意支付更改或紧密集成代码的成本，那么只需像一层一样破解它。

一切都与未来的成本有关。目前，随用随编程是迄今为止最便宜的，但不能很好地响应变化。使用层规划，会有前期成本，但它可以比第一种方法更好地处理更改和剥离整个层的实现。

因此，您的经验法则取决于谁将支付变更费用以及何时支付。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-05T20:06:52.637

是的，这是值得的。您提出的是一起破解解决方案。我无法告诉你这给我带来了多少次痛苦和折磨。硬币的另一面是过度构建他们的解决方案的天文学开发人员。你也想避免这种情况。

简单点，构建你的三层，我建议你尝试 LINQ to SQL，它使构建 DAL 变得轻而易举，然后你可以专注于构建一个纤薄的 UI，以及一个可以处理繁重工作的 BLL。这样做不会花费您太多时间，并且以后可以进行单元测试。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T19:46:57.123

> 是否有阈值大小或一些经验法则，您应该在哪里使用 n 层？

不是我知道的，但我会抛出这个：如果这个网络应用程序有可能增长（或更改后端）和/或其他人可能最终维护它，我会考虑使用 n层方法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-05T20:10:26.420

只要保持它可能。现在可能有点矫枉过正，但不要把自己写进不可能的情况。与从头开始重建相比，大规模重构将花费您更长的时间（可能就是这样，从头开始重建）。

我从事的最后一个项目（来晚了）是以打破层级的方式编写的，实际上是不可能的。数据逻辑与业务逻辑交织，与表示逻辑交织。在短期内，它和以往一样好，因为修复它需要几个月的时间。

把所有东西分开并不难，就像我之前说的，保持它可能。

# wpf - 如何处理 WPF 中的鼠标滚轮单击事件？

> ID：517556
> 
> 赞同：13
> 
> 时间：2009-02-05T19:36:04.540
> 
> 标签：wpf, click, mousewheel

单击鼠标滚轮时，我想关闭选项卡控件中的选项卡。如何在 WPF 中捕获此事件？

编辑：这是代码：

```
private void tabMain_MouseDown(object sender, MouseButtonEventArgs e)
    {
        if(e.ChangedButton == MouseButton.Middle && e.ButtonState == MouseButtonState.Pressed)
        {
            MessageBox.Show("Middle button clicked");
        }
    } 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-05T19:42:48.940

Mousewheel 其实就是 MiddleButton，所以 Wheel 点击 MouseDown 事件的条件是***ChangedButton == Middle && ButtonState == Pressed***

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2015-10-06T02:23:22.177

更简单的解决方案

> if (e.MiddleButton) { MessageBox.Show("Middle button clicked"); }

# sql - SQL 查询中 (+) 的含义

> ID：517557
> 
> 赞同：31
> 
> 时间：2009-02-05T19:36:09.860
> 
> 标签：sql, oracle

我在 Oracle 中遇到了一些包含“(+)”的 SQL 查询，但我不知道这意味着什么。有人可以解释其用途或提供一些使用示例吗？谢谢

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-02-05T19:38:08.980

它是 Oracle 的同义词`OUTER JOIN`。

```
SELECT *
FROM a, b
WHERE b.id(+) = a.id 
```

给出相同的结果

```
SELECT *
FROM a
     LEFT OUTER JOIN b
     ON b.id = a.id 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-05T19:38:33.443

+ 是 OUTER JOIN 的捷径，取决于你把它放在哪一边，它表示 LEFT 或 RIGHT OUTER JOIN

[检查此论坛帖子](http://www.orafaq.com/forum/t/79187/2/)中的第二个条目以获取一些示例

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-05T19:43:17.083

您可以使用它来确保您要加入的表不会减少返回的记录数量。因此，当您加入的表可能没有您加入的每个键的记录时，它会很方便。

例如，如果您要加入 Customer 和 Purchase 表：

要列出*所有*客户及其所有购买，请在“购买”表上执行外部联接 (+)，以便尚未购买任何东西的客户仍会显示在您的报告中。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-05T19:40:13.563

IIRC，在旧版本的 Oracle 中使用 + 表示 pre-ANSI SQL 连接语法中的外连接。换句话说：

```
select foo,bar
from a, b
where a.id = b.id+ 
```

相当于

```
select foo,bar
from a left outer join b
on a.id = b.id 
```

注意：这可能是向后/稍微不正确的，因为我从未使用过 pre-ANSI SQL 语法。

# tfs - 如何让 Team Build 显示 xUnit.net 测试套件的测试结果和覆盖率？

> ID：517560
> 
> 赞同：6
> 
> 时间：2009-02-05T19:36:52.853
> 
> 标签：tfs, msbuild, xunit.net

有没有人成功让 Team Build 在构建报告中显示 xUnit.net 测试结果和代码覆盖率？MSBuild 运行程序运行良好，结果在日志文件中，但构建报告的测试结果和代码覆盖结果区域分别显示“无测试结果”和“无覆盖结果”。Team Build 是否正在为 xUnit.net 运行程序导出的测试结果寻找特定位置/格式？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-09T02:54:27.847

TFS/TeamBuild 肯定需要特定格式的测试结果，它们也需要专门发布到 TFS。

我目前正在为 Gallio 测试运行程序研究这个问题，并且可以提供两种可能的选择：

1.  尝试将 xUnit 测试包装在 VSTS 提供的“通用测试”项目类型中 - 这是 MSTest 执行 xUnit 测试运行器的地方。
2.  提出可以将 xUnit 结果映射到 MSTest 模式的 XSLT 转换（或类似转换）（ 有关 NUnit 测试的这种方法的示例，请参见[http://www.codeplex.com/nunit4teambuild ）。](http://www.codeplex.com/nunit4teambuild)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-23T11:21:28.730

另请参阅[http://jonnekats.wordpress.com/2009/05/07/integrate-xunit-tests-into-your-daily-team-build/](http://jonnekats.wordpress.com/2009/05/07/integrate-xunit-tests-into-your-daily-team-build/)

# powershell - 在 PowerShell 1.0 版中解析以模拟“grep -C 2”

> ID：517562
> 
> 赞同：5
> 
> 时间：2009-02-05T19:37:02.277
> 
> 标签：powershell, scripting

我正在尝试挖掘一些日志并需要在我可以匹配的行之前和之后的信息。我将如何在 PowerShell ala“grep -C 2”中执行此操作？

在版本 1 中，我等不及 r2​​，然后我可以将它放在生产机器上 :)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-05T19:50:10.923

grep 的 PowerShell 等效项是**select-string**。您可以使用以下内容。

```
cat file | select-string "pattern" -context 2 
```

注意：这仅适用于 PowerShell v2.0。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-13T05:50:25.197

而不是再次使用 (gc $bigfile) ，这将导致 PowerShell 将 $bigfile 读入 ForEach-Object cmdlet 传递给它的每个对象的内存中，您可能应该将文件读入一个变量，然后从中读取数组索引，像这样：

```
$bigfile = gc 'c:\scripts\bigfile.txt'
$bigfile | Select-String "melissao" | % {$bigfile[($_.LineNumber -3)..($_.LineNumber +1)]} 
```

此外，由于行编号从 1 开始，数组索引从 0 开始，您必须向后退 3，而不是 2，才能在“melissao”上方获得两个空格，然后向前前进 1，而不是 2，才能得到“melissao”下面的两个空格。这样做会让你得到你想要的 5 条线，“melissao”两侧是它上面和下面的两条线。

我对 grep -C 2 不是很熟悉，所以我不知道这是否完全复制了该功能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T19:48:06.433

唉，看起来你必须自己构建它或等待下一个版本的 powershell，因为[它似乎已经在那里实现了](http://blogs.msdn.com/powershell/archive/2008/03/23/select-string-and-grep.aspx)。[您可以从此处](http://www.microsoft.com/downloads/details.aspx?FamilyID=c913aeab-d7b4-4bb1-a958-ee6d7fe307bc&displaylang=en)下载 Powershell 2.0 的预发布版本。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T20:07:28.453

在这里越来越近 - 因为 Select-String 返回 MatchInfo 对象，我可以从（39017）中拉出行号，现在我只需要拉出周围的线......所以：

```
gc $bigfile | Select-String melissao | 
%{(gc $bigfile)[($_.LineNumber -2)..($_.LineNumber +2)]} 
```

如果有人可以稍微清理一下以使其不那么慢，那么您可能会有答案。否则，此解决方案有效，但显然不会很快。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-02-05T21:08:51.187

下载适用于 Windows 的 grep，然后从 PowerShell 调用 grep？

# c++ - C/C++ 链接器 CALL16 在 xxxxx 重定位不针对全局符号

> ID：517563
> 
> 赞同：3
> 
> 时间：2009-02-05T19:37:04.710
> 
> 标签：c++, c, embedded, linker, mips

我在链接时遇到这些错误，两条消息都与同一个目标文件有关。

```
CALL16 reloc at 0x5f8 not against global symbol 
```

和

```
could not read symbols: Bad value 
```

第二条消息似乎是我收到 CALL16 错误的原因，但文件编译得很好。

有关解决此问题的任何提示？

仅供参考，我正在交叉编译 MIPS 目标并使用 gcc 4.1.2

**编辑：**到目前为止没有运气：
这是我使用的标志：-fPIC，-Wl，-rpath，-Wl，-O1

我还尝试了以下方法但没有成功：
-mno-explicit-relocs
-mexplicit-relocs
-mlong-calls
-mno-long-calls
-mxgot
-mno-xgot

同时，我将在这一点上回到源头并进行更多调查。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-07T15:47:14.907

啊哈！感谢我的一位同事，我们发现了这个问题。

这是问题所在：

有一个函数的前向声明/原型。

```
void FooBarIsBest(void); 
```

稍后在文件中定义了函数。

```
static void FooBarIsBest(void)
{
    // do the best
} 
```

这里的问题是在原型中关键字 static 被遗漏了。所以这就像是定义了一个全新的功能。

CALL16 引用被 gcc 用于可重定位代码。该文件的汇编代码显示 CALL16 正在此函数上使用...这是错误的，因为此函数是本地的。

有趣的是，这段代码用于编译和链接旧版本的 gcc (3.2.2) 很好。又一个教训了。:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T20:29:58.673

尝试向编译器添加 -mlong-calls 标志。

另请参阅[手册](http://linux.die.net/man/1/gcc)了解更具体的 MIPS 选项。

# single-sign-on - Atlassian Crowd 体验？

> ID：517575
> 
> 赞同：29
> 
> 时间：2009-02-05T19:39:33.050
> 
> 标签：single-sign-on, jira, alm, atlassian-crowd

我们（大约 150 人的团队）正在考虑将 ALM 解决方案从 Bugzilla/CVS 迁移到 Jira/svn/Confluence/Bamboo/Fisheye。SO 有很多关于这些的好信息，但我有兴趣了解 Atlassian 的另一个工具 - 单点登录 (SSO) [Crowd](http://www.atlassian.com/software/crowd/)，我正在考虑将其添加到组合中，以便与我们的 Novell id 进行 LDAP 集成。

*   有人有过 Crowd 的经验吗？
*   它如何处理 100/200/500（即经济衰退之后）用户？
*   任何提示/技巧？
*   您会选择不同的开源 SSO 解决方案吗？

谢谢

* * *

编辑：一年过去了...

我们得到了 Crowd，并与 ActiveDirectory 集成以及内部 Crowd 目录（用于短期承包商等）一起使用。到目前为止，该解决方案效果很好。

* * *

EDIT2：又一年：仍然强劲（我们现在有 1K 用户）。嵌套组是一个杀手级功能，谢天谢地，它在最后一点发布后运行良好。

* * *

EDIT3：2012 年年中 - 7.5K 用户 - 增长强劲。加入一点自动化（带有 Ajaxified 表单的 Confluence 页面 + 一个小的 Crowd 插件）

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-12T00:49:32.200

*重大披露：*我是人群产品经理。因此，尽可能多地使用 NaCl。

如果您对 500 个用户有任何问题，我会感到非常惊讶。特别是因为 Novell 在性能方面似乎是更好的目录服务器之一。我唯一希望看到问题的是您的 Crowd 服务器和 Novell 目录服务器是否位于世界的另一端。除非你必须这样做，否则不要这样做:-)

我们有大量的用户将成千上万的用户连接到 JIRA、Confluence 和带有 Crowd 的开发工具。

任何问题 - 给我们留言（sales@atlassian.com 或[http://support.atlassian.com](http://support.atlassian.com)），我们会提供帮助。

干杯，戴夫。

ps：我希望这不是一种推销，或者“我们制造的神奇产品在各方面都很完美，现在给我们你的钱！”

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-11T05:02:52.507

我们正在使用拥有大约 80 个用户的 Crowd，并且预计当我们推出它以供客户访问时，这个数字会攀升至 100 个。Crowd 对我们很重要，因为它允许我们将 Jira 和 Confluence（Atlassian wiki）与 SSO 集成，这很关键。

Crowd 对我们很有效，但它确实有一些怪癖。我们使用它从 Active Directory 中提取身份验证。有些东西有点不雅。我们需要做更多的挖掘来解决这些问题。

但除此之外，Crowd 对我们来说是一个巨大的胜利，原因有两个：

1.  跨 Atlassian 应用的 SSO
2.  能够让我们的内部用户从 Active Directory 中提取，并将客户端直接添加到 Crowd 而不会陷入 AD

我们对所有 Atlassian 工具都非常满意。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-05T22:51:34.723

我没有像您这样在如此庞大的用户群上使用 Crowd 的经验，但我确实发现使用 Crowd 设置和管理我们的 JIRA、Confluence 和 SVN 实例非常容易（我们只有 25 个用户）。它还将处理 Apache 身份验证，因此我计划将我们的各种经过身份验证的网站也切换到 Crowd。

根据[Atlassian 的网站](http://www.atlassian.com/software/crowd/)，Crowd 应该可以轻松处理 500 个用户；网站上有一些有用的案例研究和网络研讨会录音，可以告诉您更多信息。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-11-11T10:12:12.003

我确实很少安装超过 16000 个用户的 Crowd，大多数来自 LDAP/Active Directory，我会说性能不会成为问题，但 Atlassian 多年来确实考虑解决了其他问题：

*   人群中没有自动帐户创建/注册
*   Atlassian 产品都不允许人们通过电子邮件验证注册帐户
*   没有办法阻止人们使用相同的电子邮件地址创建多个帐户。
*   SSO 仅在您只有一个域时才有效。

如果您没有很多用户，您可以将 Confluence 配置为直接连接到 Jira，而不是使用 Crowd。Atlassian 产品中确实已经有一个内部人群实例，但它的性能仅限于大约 200 个用户左右（更多的是关于进行身份验证的数量，而不是用户总数）。

考虑到上述限制，我想总结一下，Crowd 的价格远高于它所提供的服务，除非你在符合条件的情况下获得免费许可证。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-01-23T14:24:47.917

我们还在 Atlassian 产品系列中安装并连接了 Crowd。它由企业 LDAP (M$ AD) 提供支持。到目前为止，它很棒并且效果很好。

**但**目前我们正在努力整合所谓的自定义应用程序。我们有例如 Prometheus 用于监控没有内置任何身份验证的数据。所以我们前面有一个 Apache 2.4 作为 SSL 端点。为了添加身份验证，我们考虑将其与 Crowd 集成。有一个不再支持的 Apache Crowd 连接器（这对我来说很好）。只有可用的源代码，但基于 Apache 2.2。我们必须使用 Apache 2.4（企业政策），其中一些必需的 API 已被删除。

因此，要么我们投入大量时间将连接器迁移到当前的 Apache API，要么我们做其他事情（比如使用通用 LDAP 连接器连接到 AD）。这使得整个 Crowd 的想法对我们来说有点像一把双面剑。（我们希望将项目中的用户管理集中到一个像 Crowd 这样的单一工具中，以摆脱中央 LDAP 上的公司流程和法规）。

**更新：**我们现在为 Apache 2.4 使用[https://github.com/fgimian/cwdapache](https://github.com/fgimian/cwdapache)连接器（稍作修改，它可以为 Ubuntu 16.04 构建）。这增加了对具有人群组/用户的 Apache Basic Auth 的支持。

**UDAPTE2：** Bitbucket、Jira、Confluence、Crucible 开箱即用。不过，用户迁移有点麻烦（重命名旧用户，然后与 Crowd 集成或使用不受支持的 SQL）。

Jenkins 2 和 Nexus 3 似乎工作正常。

**更进一步：** 现在我正在考虑将 Crowd 作为 Atlassian 产品身份和访问管理的集中式工具。在那里它工作正常并且做它应该做的事情。集成许多其他应用程序很糟糕，因为不支持/更新可用的集成。示例：如果您想使用 nginx 进行 Crowd 身份验证，则没有可用的东西。有一个可用的 OpenId Connect 模块，但 Crowd 缺乏对此的支持（他们只支持过时的 OpenId v2.0）。甚至不谈论 OAuth。有一个[Atlassian OAuth](https://bitbucket.org/atlassian/atlassian-oauth)库，但 Crowd 还没有（或永远没有）。甚至 Google Apps 支持也会消失，因为 Google 放弃了支持：[https ://developers.google.com/identity/protocols/OpenID2Migration](https://developers.google.com/identity/protocols/OpenID2Migration)

# sql - 字符串作为 SQL 数据库中的主键

> ID：517579
> 
> 赞同：205
> 
> 时间：2009-02-05T19:40:22.970
> 
> 标签：sql, database, database-design, string, primary-key

我对数据库及其工作原理不是很熟悉。从性能的角度来看（插入/更新/查询）使用字符串作为主键是否比整数慢？

* * *

## 回答 #1

> 赞同：222
> 
> 时间：2009-02-05T19:44:16.927

从技术上讲是的，但是如果一个字符串作为主键是有意义的，那么你可能应该使用它。这一切都取决于您要为其制作的表的大小以及将成为主键的字符串的长度（更长的字符串 == 更难比较）。对于具有数百万行的表，我不一定会使用字符串，但是通过在较小的表上使用字符串所导致的性能下降量对于使用不具有整数的整数可能是微不足道的与数据无关。

* * *

## 回答 #2

> 赞同：87
> 
> 时间：2009-02-05T19:46:42.973

使用字符串作为主键的另一个问题是，由于索引不断地按顺序排列，当创建一个位于顺序中间的新键时，索引必须重新排序......如果你使用自动number 整数，新键只是添加到索引的末尾。

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2012-03-20T23:05:09.647

插入到具有聚集索引的表中，其中插入发生在序列的中间，不会导致索引被重写。它不会导致包含数据的页面被重写。如果该行所在的页面上有空间，则将其放置在该页面中。单个页面将被重新格式化以将行放置在页面中的正确位置。当页面已满时，将发生页面拆分，页面上的一半行转到一页，另一半转到另一页。然后将页面重新链接到包含具有聚集索引的表数据的页面链接列表中。最多，您将最终编写 2 页的数据库。

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2009-02-05T19:54:57.420

字符串在连接中速度较慢，在现实生活中它们很少是真正唯一的（即使它们应该是）。唯一的好处是，如果您连接到主表只是为了获取名称，它们可以减少连接的数量。然而，字符串也经常会发生变化，从而产生了在公司名称更改或某人结婚时必须修复所有相关记录的问题。这可能会对性能造成巨大影响，并且如果所有应该以某种方式相关的表都不相关（这种情况比您想象的更频繁），那么您也可能存在数据不匹配。从数据完整性的角度和性能的角度来看，在记录的整个生命周期中永远不会改变的整数是一个更安全的选择。自然键通常不利于数据的维护。

我还想指出，两全其美的方法通常是使用自动递增键（或在某些特殊情况下为 GUID）作为 PK，然后在自然键上放置唯一索引。您可以获得更快的连接，不会获得重复的记录，并且您不必因为公司名称更改而更新一百万个子记录。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-02-05T19:45:36.877

变数太多。这取决于表的大小、索引、字符串键域的性质......

*通常*，整数会更快。但是差异会大到足以在乎吗？很难说。

另外，你选择琴弦的动机是什么？数字自动增量键通常也*容易*得多。是语义吗？方便？复制/断开连接的问题？您在此处的回答可能会限制您的选择。这也让您想起了您忘记的第三个“混合”选项：Guids。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-02-05T19:52:09.857

只要它是唯一的，您使用什么作为主键都没有关系。如果您关心速度或良好的数据库设计，除非您计划复制数据，否则请使用 int，然后使用 GUID。

如果这是一个访问数据库或一些小型应用程序，那么谁真正在乎。我认为我们大多数开发人员将旧的 int 或 guid 放在前面的原因是因为项目有一种在我们身上成长的方式，而你想给自己留下成长的选择。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-02-06T19:33:40.940

在您获得与数据描述的主题一致并且与数据的预期用途完全吻合的简单而合理的设计之前，不要担心性能。然后，如果出现性能问题，您可以通过调整系统来处理它们。

在这种情况下，使用字符串作为自然主键几乎总是更好，前提是您可以信任它。如果它是一个字符串，请不要担心，只要字符串相当短，比如最多 25 个字符。就性能而言，您不会付出高昂的代价。

数据输入人员或自动数据源是否总是为假定的自然键提供值，或者有时会被省略？输入数据是否偶尔出错？如果是这样，如何检测和纠正错误？

指定查询的程序员和交互式用户是否能够使用自然键来获得他们想要的东西？

如果您不能信任自然密钥，请发明一个代理。如果你发明了一个代理，你还不如发明一个整数。然后您必须担心是否向用户社区隐藏代理。一些没有隐藏代理键的开发者开始后悔了。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-02-05T19:44:32.870

指数意味着很多比较。

通常，字符串比整数长，并且可以应用排序规则进行比较，因此比较字符串通常比比较整数的计算量更大。

但是，有时使用字符串作为主键比与`string to numerical id`表进行额外连接要快。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2014-08-21T12:17:17.710

PK 列使用整数的两个原因：

1.  我们可以为自动递增的整数字段设置标识。

2.  当我们创建 PK 时，数据库会创建一个索引（集群或非集群），在将数据存储到表中之前对其进行排序。通过在 PK 上使用标识，优化器无需在保存记录之前检查排序顺序。这提高了大表的性能。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-02-05T19:47:28.137

是的，但除非您希望有数百万行，否则不使用基于字符串的键，因为它较慢，通常是“过早的优化”。毕竟，字符串存储为大数字，而数字键通常存储为较小的数字。

但是，需要注意的一件事是，如果您在任何键上都有聚集索引，并且正在执行大量在索引中不连续的插入。写入的每一行都会导致索引重新写入。如果你正在做批量插入，这真的会减慢这个过程。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-02-05T19:50:42.780

您将字符串作为主键的原因是什么？

我只需将主键设置为自动递增的整数字段，并在字符串字段上放置一个索引。

**这样，如果您在表上进行搜索，它们应该相对较快，并且您的所有连接和正常查找的速度都不会受到影响。**

您还可以控制被索引的字符串字段的数量。换句话说，如果您认为这样就足够了，您可以说“仅索引前 5 个字符”。或者，如果您的数据可以比较相似，您可以索引整个字段。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-02-06T15:18:32.110

从性能的角度来看 - 是的，与使用整数 (PK) 实现的性能相比，字符串 (PK) 会降低性能，其中 PK ---> 主键。

从需求的角度来看-尽管这不是您问题的一部分，但我还是想提一下。当我们处理跨不同表的大量数据时，我们通常会寻找可以为特定表设置的可能的键集。这主要是因为有许多表，并且大多数情况下每个表或某些表将通过某种关系（外键的概念）相互关联。因此，我们真的不能总是选择一个整数作为主键，而是选择 3、4 或 5 个属性的组合作为该表的主键。当我们将记录与其他表关联时，这些键可以用作外键。这使得在需要时将不同表之间的记录关联起来很有用。

因此，为了优化使用 - 我们总是将 1 或 2 个整数与 1 或 2 个字符串属性组合在一起，但仅在需要时才再次使用。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2020-09-09T21:06:13.730

我可能会使用一个整数作为您的主键，然后将您的字符串（我假设它是某种 ID）作为单独的列。

```
create table sample (
  sample_pk             INT NOT NULL AUTO_INCREMENT,
  sample_id             VARCHAR(100) NOT NULL,
  ...
  PRIMARY KEY(sample_pk)
); 
```

您始终可以对字符串 (ID) 列（其中 sample_id = ...）进行有条件的查询和连接。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-02-05T20:13:16.367

数据库中的字符串可能存在很大的误解。几乎每个人都认为数字的数据库表示比字符串更紧凑。他们认为 db-s 中的数字在内存中表示。但事实并非如此。在大多数情况下，数字表示更接近于类似字符串的表示。

使用数字或字符串的速度更多地取决于索引而不是类型本身。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2017-02-21T00:01:34.377

默认情况下，ASPNetUserIds 是 128 个字符的字符串，性能很好。

如果键在*表*中必须是唯一的，则它应该是键。这就是为什么；

**主字符串键 = 正确的数据库关系、1 个字符串键（主）和 1 个字符串索引（主）。**

另一个选项是典型的 int 键，但如果字符串*必须*是唯一的，您可能仍然需要添加索引，因为不间断查询以验证或检查其唯一性。

因此，使用**int 标识键 = 不正确的数据库关系，1 个 int 键（主），1 个 int 索引（主），可能是唯一的字符串索引，并且不存在手动验证相同的字符串（可能类似于 sql 检查）。**

为了在主键的字符串上使用 int 获得更好的性能，当字符串*必须*是唯一的时，它必须是一个非常奇怪的情况。我一直更喜欢使用字符串键。作为一个好的经验法则，在您需要之前不要对数据库进行非*规范化*。

# autoconf - 使用 autoconf 进行库解析？

> ID：517580
> 
> 赞同：22
> 
> 时间：2009-02-05T19:40:32.813
> 
> 标签：autoconf

我正在构建我的第一个 autoconf 托管包。

但是，我在任何地方都找不到任何简单的示例来说明如何指定所需的库，并在不同的地方找到该库。

我目前有：

```
AC_CHECK_LIB(['event'], ['event_init']) 
```

但：

1.  它没有找到安装的版本`/opt/local/lib`
2.  如果实际上没有找到库，它不会抱怨
3.  `/opt/local/include`我也需要将包含路径设置为

非常感谢任何帮助或指向体面教程的链接...

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2010-06-10T08:48:57.850

autoconf 脚本无法猜测“可选”库位置，这些位置可能因平台而异。所以你可以说

```
CPPFLAGS="-I/opt/local/include" LDFLAGS="-L/opt/local/lib" ./configure 
```

因为`AC_CHECK_LIB()`您需要在“action-if-false”参数中明确指定失败条件：

```
dnl This is simply print "no" and continue:
AC_CHECK_LIB([m], [sqrt123])
dnl This will stop:
AC_CHECK_LIB([m], [sqrt123], [], [AC_MSG_ERROR([sqrt123 was not found in libm])]) 
```

输出：

```
checking for sqrt123 in -lm... no
checking for sqrt123 in -lm... no
configure: error: sqrt123 was not found in libm 
```

`AC_CHECK_LIB()`默认情况下不会因为明显的原因而失败：可以检查几个提供类似功能的不同库并选择其中一个:)

还可以查看[这篇文章](https://stackoverflow.com/questions/1596536/what-is-the-best-way-to-auto-detect-library-dependencies-in-a-c-c-project)以了解类似的主题。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-05T20:59:53.497

您需要手动设置`CFLAGS`，如果您希望 gcc `CXXFLAGS`/ `LDFLAGS`g++ 在非标准位置查找。

因此，在调用之前`AC_CHECK_LIB()`，请执行以下操作

```
CFLAGS="$CFLAGS -I/opt/local/include"
CXXFLAGS="$CXXFLAGS -I/opt/local/include"
LDFLAGS="$LDFLAGS -L/opt/local/lib" 
```

如果您只在整个配置脚本中使用 gcc，则不需要 CXXFLAGS。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-02-05T21:28:36.683

如果库附带一个 .pc 文件，请考虑使用 PKG_CHECK_MODULES() 宏来执行您想要的操作。如果它是您自己的库，只需将 .pc 文件发送到 /usr/lib/pkgconfig，它将使其他开发人员更容易依赖/使用它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-01-03T16:29:36.550

我知道这是一个旧线程，但我想这可能会帮助一些人。这就是我找到一些东西的方式。

```
hdff="no"
hdffprefix="ERROR"
AC_ARG_WITH(hdf,[  --with-hdf              Compile with hdf library, for output.],[hdffprefix=$withval hdff="yes"],[])
# if there is no value given, it appears tha hdffprefix is set to "yes"
if test $hdffprefix = "yes" -a $hdff = "yes"
then
    echo "HDF: Attempting to find HDF"
    hdffprefix="ERROR"

    # check if hdffprefix is set, if it is not, it sets it to "ERROR" and the 
    # 'if' comparison evaluates to true
    if [[ "$hdffprefix" == "ERROR" ]]
    then
        echo "HDF: hdffprefix not set, searching PATH"
        for i in `echo $PATH | tr ':' '\n'`
        do
            if [[ $i == *hdf* ]]
            then
                if [[ $i == *bin/* ]]
                then
                    hdffprefix=${i%bin/}
                    # if it doesn't exist, re-set to ERROR
                    if [[ ! -f ${hdffprefix}include/hdf.h ]]
                    then
                    hdffprefix="ERROR"
                    fi
                elif [[ $i == *bin* ]]
                then
                    hdffprefix=${i%bin}
                    # if it doesn't exist, re-set to ERROR
                    if [[ ! -f ${hdffprefix}include/hdf.h ]]
                    then
                    hdffprefix="ERROR"
                    fi
                fi
            fi
        done
        if [[ "$hdffprefix" == "ERROR" ]]
        then
            echo "HDF: hdffprefix not found in PATH, trying 'which'"
            WHICH_TEST_HDF=`which hdf2gif`
            if [[ WHICH_TEST_HDF != "" ]]
            then
                hdffprefix=${WHICH_TEST_HDF%bin/hdf2gif}
            else
                echo "HDF: Warning - hdf not found"
            fi
        fi
    fi
    if [[ "$hdffprefix" != "ERROR" ]]
    then
        hdff="yes"
        echo "HDF found: $hdffprefix"
    fi
fi
if test $hdff = 'yes'; then
        hdfincs=" -DUSE_HDF -I"${hdffprefix}"include"
        scriptotherlibsinc=${scriptotherlibsinc}" -L"${hdffprefix}"/lib"
        scriptotherlibs=${scriptotherlibs}" -lmfhdf -ldf -ljpeg -lz"
    AC_CHECK_HEADERS([${hdffprefix}/include/hdf.h],,[AC_MSG_ERROR([Cannot find hdf.h])])
    AC_CHECK_HEADERS([${hdffprefix}/include/mfhdf.h],,[AC_MSG_ERROR([Cannot find mfhdf.h])])
fi 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-10-24T14:28:24.090

这是如何做到的：

```
# We need the math library for some tests.
AC_CHECK_LIB([m], [floor], [],
                  [AC_MSG_ERROR([Can't find or link to the math library.])]) 
```

请注意，当找不到库时它不会自动出错，您必须像上面的代码一样调用 AC_MSG_ERROR()。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2014-05-18T11:58:41.857

所以你想设置 autoconf 来自动找到这些目录，codelogic 给出了答案；但假设您不想在所有系统上搜索，只在 Mac 上搜索。您可以添加以下内容

```
AC_CANONICAL_HOST
case $host_os in
    darwin* )
        CFLAGS="$CFLAGS -I/opt/local/include"
        CXXFLAGS="$CXXFLAGS -I/opt/local/include"
        LDFLAGS="$LDFLAGS -L/opt/local/lib"
        ;;

esac 
```

请注意，我将其添加为案例树，以便您以后可以为各种操作系统添加内容（例如 linux* 和*BSD*）。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2015-04-14T08:57:48.343

如果您碰巧使用`GCC`or ，则标准方法是使用具有非官方*包含*文件和库路径`CLANG`的环境变量。提醒您不必更改 configure.ac 中的任何内容。所以你可以这样调用配置：`CPLUS_INCLUDE_PATH`*`LIBRARY_PATH`*

 *```
$ export CPLUS_INCLUDE_PATH=/opt/local/include
$ export LIBRARY_PATH=/opt/local/lib
$ ./configure 
```

# 事实标准变量

```
Variable           | lang | Usage
-------------------|------|---------
C_INCLUDE_PATH     | C    | colon separated list of include directory paths
CPLUS_INCLUDE_PATH | C++  | colon separated list of include directory paths
LIBRARY_PATH       | C/C++| colon separated compiling time static linking dirs
LD_RUN_PATH        | C/C++| colon separated compiling time dynamic linking dirs
LD_LIBRARY_PATH    | C/C++| colon separated run-time dynamic linking dirs
CPPFLAGS           | C/C++| prepocessor flags
CFLAGS             | C    | Compiling flags
CXXFLAGS           | C++  | Compiling flags
LDFLAGS            | C++  | Linking flags 
```

**注意**您可以使用`CPPFLAGS`或`LDFLAGS`，但是`CPLUS_INCLUDE_PATH`/`LIBRARY_PATH`完全符合您的要求。`CPPFLAGS/LDFLAGS`适用于可以是很多东西但`*_PATH`适用于的标志`PATHs`

**可移植性注意：**虽然这适用于许多现代编译器，但并非所有编译器都会尊重这些变量。一些交叉编译器会完全忽略或覆盖它们，这会迫使人们求助于其他答案中提到的修改`CFLAGS`。`LDFLAGS`

**消息来源**：这里的反对意见可能是因为我的回答中缺乏来源。这是`CPLUS_INCLUDE_PATH`在**GCC**中的：[https ://gcc.gnu.org/onlinedocs/cpp/Environment-Variables.html](https://gcc.gnu.org/onlinedocs/cpp/Environment-Variables.html)

# c - 获取代码的图形化函数调用图的工具

> ID：517589
> 
> 赞同：113
> 
> 时间：2009-02-05T19:44:07.923
> 
> 标签：c, function, call-graph

我有一个很大的工作空间，里面有很多 C 代码的源文件。虽然我可以使用对象浏览器在 MS VS2005 中以及在 MSVC 6.0 中看到从函数调用的函数，但这仅在非图形类型的显示中显示从特定函数调用的函数。此外，它没有显示从 say 开始调用`main()`的函数，然后是从它调用的函数，等等，更深入到叶级函数。

我需要一个工具，它会给我一个带有函数的函数调用图，`callee`并`caller`用箭头或类似的东西连接，从`main()`函数的最后一层开始，或者至少以图形方式显示一个 C 源文件中所有函数的调用图。如果我能打印这张图就好了。

有什么好的工具可以做到这一点（不一定是免费工具）？

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2009-02-05T20:34:26.233

*   [埃及](http://www.gson.org/egypt/)（免费软件）

*   [ncc](http://students.ceid.upatras.gr/~sxanth/ncc/)

*   [KcacheGrind](https://kcachegrind.github.io/html/Home.html) (GPL)

*   [Graphviz](http://www.graphviz.org/) (CPL)

*   [代码可视化](http://www.csn.ul.ie/~mel/projects/codeviz/)(GPL)

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2015-07-02T16:39:39.757

**动态分析方法**

这里我介绍几种动态分析方法。

动态方法实际运行程序以确定调用图。

与动态方法相反的是静态方法，它试图在不运行程序的情况下仅从源代码中确定它。

动态方法的优点：

*   捕获函数指针和虚拟 C++ 调用。这些在任何重要的软件中都大量存在。

动态方法的缺点：

*   您必须运行程序，这可能很慢，或者需要您没有的设置，例如交叉编译
*   只有实际调用的函数才会显示。例如，可以根据命令行参数调用或不调用某些函数。

**KcacheGrind**

[https://kcachegrind.github.io/html/Home.html](https://kcachegrind.github.io/html/Home.html)

测试程序：

```
int f2(int i) { return i + 2; }
int f1(int i) { return f2(2) + i + 1; }
int f0(int i) { return f1(1) + f2(2); }
int pointed(int i) { return i; }
int not_called(int i) { return 0; }

int main(int argc, char **argv) {
    int (*f)(int);
    f0(1);
    f1(1);
    f = pointed;
    if (argc == 1)
        f(1);
    if (argc == 2)
        not_called(1);
    return 0;
} 
```

用法：

```
sudo apt-get install -y kcachegrind valgrind

# Compile the program as usual, no special flags.
gcc -ggdb3 -O0 -o main -std=c99 main.c

# Generate a callgrind.out.<PID> file.
valgrind --tool=callgrind ./main

# Open a GUI tool to visualize callgrind data.
kcachegrind callgrind.out.1234 
```

您现在被留在了一个很棒的 GUI 程序中，其中包含许多有趣的性能数据。

在右下角，选择“调用图”选项卡。这显示了一个交互式调用图，当您单击函数时，该图与其他窗口中的性能指标相关。

要导出图表，请右键单击它并选择“导出图表”。导出的 PNG 如下所示：

[![](https://i.stack.imgur.com/s7dYK.png)](https://i.stack.imgur.com/s7dYK.png)

从中我们可以看出：

*   根节点是`_start`，它是实际的 ELF 入口点，包含 glibc 初始化样板
*   `f0`,`f1`并按`f2`预期相互调用
*   `pointed`也显示了，即使我们用函数指针调用它。如果我们传递了命令行参数，它可能不会被调用。
*   `not_called`没有显示，因为它没有在运行中被调用，因为我们没有传递额外的命令行参数。

很酷的`valgrind`是它不需要任何特殊的编译选项。

因此，即使您没有源代码，只有可执行文件，您也可以使用它。

`valgrind`设法通过轻量级“虚拟机”运行您的代码来做到这一点。与本机执行相比，这也使得执行速度极慢。

从图中可以看出，还获得了每个函数调用的时序信息，这可以用来分析程序，这很可能是这个设置的原始用例，而不仅仅是查看调用图：[How can I profile在 Linux 上运行的 C++ 代码？](https://stackoverflow.com/questions/375913/how-can-i-profile-c-code-running-on-linux/60265409#60265409)

在 Ubuntu 18.04 上测试。

**`gcc -finstrument-functions`+ 跟踪**

[https://github.com/elcritch/etrace](https://github.com/elcritch/etrace)

`-finstrument-functions` [添加回调](https://stackoverflow.com/questions/6176284/why-doesnt-finstrument-functions-work-for-me)，etrace 解析 ELF 文件并实现所有回调。

但不幸的是，我无法让它工作：[为什么 `-finstrument-functions` 对我不起作用？](https://stackoverflow.com/questions/6176284/why-doesnt-finstrument-functions-work-for-me)

声称的输出格式为：

```
\-- main
|   \-- Crumble_make_apple_crumble
|   |   \-- Crumble_buy_stuff
|   |   |   \-- Crumble_buy
|   |   |   \-- Crumble_buy
|   |   |   \-- Crumble_buy
|   |   |   \-- Crumble_buy
|   |   |   \-- Crumble_buy
|   |   \-- Crumble_prepare_apples
|   |   |   \-- Crumble_skin_and_dice
|   |   \-- Crumble_mix
|   |   \-- Crumble_finalize
|   |   |   \-- Crumble_put
|   |   |   \-- Crumble_put
|   |   \-- Crumble_cook
|   |   |   \-- Crumble_put
|   |   |   \-- Crumble_bake 
```

除了特定的硬件跟踪支持之外，这可能是最有效的方法，但缺点是您必须重新编译代码。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-02-05T19:49:49.427

[理解](http://www.scitools.com/products/understand/)在创建调用图方面做得很好。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2010-12-04T20:00:51.050

我们的[DMS Software Reengineering Toolkit](http://www.semanticdesigns.com/Products/DMS/DMSToolkit.html)具有[静态控制/数据流/指向/调用图分析](http://www.semdesigns.com/Products/DMS/FlowAnalysis.html)，已应用于庞大的 C 代码系统（~2500 万行），并生成了此类调用图，*包括通过函数指针调用的函数*。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2014-08-21T21:26:35.503

您可以尝试 CScope + [tceetree](http://sourceforge.net/projects/tceetree/) + [Graphviz](http://www.graphviz.org/)。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2015-07-03T03:42:16.020

[您可以在此处](http://toolchainguru.blogspot.com/2011/03/c-calltrees-in-bash-revisited.html)查看我的基于 bash 的 C 调用树生成器。它允许您指定一个或多个 C 函数，您需要调用者和/或被调用信息，或者您可以指定一组函数并确定连接它们的函数调用的可达性图......即告诉我所有方式 main( )、foo() 和 bar() 已连接。它使用 graphviz/dot 作为图形引擎。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-02-17T13:32:46.740

[Astrée](http://www.absint.com/astree/ "阿斯特雷")是目前最强大和最复杂的工具，恕我直言。

# nhibernate - 相关实体属性上的 NHibernate AddOrder

> ID：517595
> 
> 赞同：1
> 
> 时间：2009-02-05T19:44:38.283
> 
> 标签：nhibernate

我有一个搜索表单和结果列表。该表单允许用户搜索实体属性和相关的实体属性。

NameContains EmailContains CompanyNameContains

结果列表显示联系人属性和相关的相关属性，在本例中为公司名称

姓名 | 电话 | 电子邮件 | 公司

公司是一个关系，对于这种情况，关系是急切加载的。搜索端、过滤结果、分页等一切正常。

我正在使用 DetachedCriteria，我只能对联系人属性进行排序。（实际上不需要对电子邮件和电话号码进行排序）。我无法对相关属性的公司名称进行排序。我想知道是否有人能指出我正确的方向。提前感谢您的帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T19:58:29.487

嗯，我认为这样的事情应该可以解决问题（下面的代码没有经过语法验证，因为我正要关闭我的电脑，我不想重新启动 VS.NET（懒惰）

```
DetachedCriteria crit = DetachedCriteria.For<Contact>();
...
crit.CreateAlias ("Company", "c");
crit.AddOrder (Order.Asc("c.CompanyName")); 
```

类似的东西？至少，这是我会尝试的......

# c# - 何时不使用实体框架

> ID：517600
> 
> 赞同：41
> 
> 时间：2009-02-05T19:46:09.963
> 
> 标签：c#, .net, entity-framework, architecture

我一直在玩 EF，看看它可以处理什么。还有许多文章和帖子解释了可以使用 EF 的各种场景，但是如果以某种方式错过了“con”方面。现在我的问题是，**在什么样的情况下我应该远离实体框架**？

如果您在该领域有一些经验，请告诉我哪些场景不能很好地与 EF 配合使用。告诉我您在希望选择不同技术时遇到的一些不利因素。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-02-05T21:20:12.270

[不信任投票](http://efvote.wufoo.com/forms/ado-net-entity-framework-vote-of-no-confidence/)列出了在那些认为他们知道哪些特性及其实现适合 ORM/Datamapper 框架的人眼中的几个失误和/或功能缺失位。

如果这些问题对您来说都不是大问题，那么我不明白您为什么不应该使用它。我还没有听说这是一个左右爆炸的马车混乱。所有反对它的警告都是哲学的。我碰巧同意不信任投票，但这并不意味着你应该。如果你碰巧喜欢 EF 的工作方式，那就去吧。同时，我建议您至少阅读不信任投票，并尝试对每个问题有一个基本的了解，以便做出明智的决定。

在这个问题之外和您问题的核心 - 您需要密切关注正在生成的 Sql，以便您可以在性能问题进入生产之前进行调整。即使您在后端使用 procs，我仍然会寻找您可能多次访问数据库的场景，然后相应地重新处理映射或获取场景。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-05T19:54:25.237

一个潜在的大问题：Entity Framework 1.0 不支持持久性无知。这意味着您的业务层依赖于您的数据访问层。

如果您的整个应用程序将托管在同一进程中（如 IIS 上的网站），那么这没问题。

但是，如果您需要远程实体（例如到 Silverlight 或 Windows Mobile 客户端），那么您的实体将不会轻易地通过网络进行序列化。您必须创建单独的数据传输类以通过网络发送您的实体，以及在实体类和 DTO 之间编组数据的附加逻辑。

**编辑：**拼写。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-05T20:02:24.300

我也只是在“玩弄”阶段，虽然我担心缺乏内置的持久性不可知论，但我确信会有一个“解决方法”。

事实上，在 n 层架构中甚至没有变通办法。

**WCF + EF**

如果我正确地阅读了[这篇文章](http://msdn.microsoft.com/en-us/magazine/cc700340.aspx)，那么我看不到通过网络（使用 WCF）序列化实体有任何问题，而且持久性无知也不是问题。

这是因为我主要将 PI 用于单元测试。

**单元测试*是*可能的！（我想）**

在这个系统中，我们可以简单地使用一个模拟服务（例如，通过在另一个可以从工厂生产的基于接口的类中包装对服务的调用）。这将测试我们的演示者代码（无需对 EF/DAL 进行单元测试——这是微软的工作！）当然，仍然需要集成测试来获得完全的信心。

如果你想写入一个单独的数据库，这将在 DAL 层中完成，通过配置文件很容易实现。

**我的价值**

我的意见 - 对 EF 做出自己的决定，不要被所有关于它的厄运和忧郁所推迟。我猜它会存在一段时间，MS 将在明年左右消除故障。根据 Dan Simmons 的说法，PI 肯定会进来。

**编辑**：我刚刚意识到我过激了，就像一个优秀的政治家并没有真正回答被问到的问题。哎呀。但我会留下这个，以防其他人发现它有用。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-05T20:03:15.407

并非所有数据模型都能很好地映射到应用程序实体。如果映射不是相对简单，我会跳过实体框架。你会发现自己在做倒立来使其工作没有任何明显的好处。

[Anders Hejlsberg 在这里](http://www.artima.com/intv/abstract3.html)有一些关于对象/关系映射的有趣评论。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-05T19:58:06.790

由于 EF 不支持 POCO，因此很难编写好的单元测试。[这是不信任投票中](http://efvote.wufoo.com/forms/ado-net-entity-framework-vote-of-no-confidence/)反对它的因素之一。

如果你想编写好的测试，EF 会设置障碍。您可以[解决它们](http://blogs.msdn.com/diego/archive/2008/03/03/unit-testing-your-entity-framework-domain-classes.aspx)，但这并非易事。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-22T14:26:28.423

尽管 SQL CE 3.5 SP1 和 Entity Framework 4.0 Beta 1 都支持标识列，但将这两个产品一起使用（至少在列出的版本之前），不支持标识列。您将需要自行设置主键。

除此之外，我一直在享受 EF 和 SQL CE。

# ruby-on-rails - Rails 应用程序有批量电子邮件插件吗？

> ID：517601
> 
> 赞同：11
> 
> 时间：2009-02-05T19:46:10.230
> 
> 标签：ruby-on-rails, email, plugins, smtp, bulk

有谁知道一个插件或可以用来为 Rails 应用程序发送批量电子邮件的东西？

具体来说，我希望能够将 HTML 电子邮件文件传递给 rake 任务或其他东西，并将其通过电子邮件发送给所有注册到我的网站并选中“请向我发送有关 XXX 的信息”框的人。

我为自己写了一个混合版本，但我想要一些能巧妙地自我节流的东西，如果被打断可以从中断的地方继续。

**更新**：我最终崩溃了，拿出我的信用卡并注册了一个*真正的*批量电子邮件服务，该死的选择是正确的。由此产生的电子邮件非常专业，它们具有内置的分析功能，还与 Google Analytics 集成，并且出于许多其他原因，它非常棒。

如果您希望使用 Rails 发送大量电子邮件，我建议您使用[Mailchimp](http://mailchimp.com)服务（这是我的[会员链接](http://mailchimp.com/?aid=43f492c80ae71fa07dfae4d64&afl=1)，注册时有奖励）以及[hominid gem](http://github.com/bgetting/hominid)。这将允许您将所有用户电子邮件从数据库同步到 Mailchimp，然后使用真正的批量服务，而不是一些糟糕的修补在一起的服务。

**另一个更新**：我今天听说了[Maktoub](http://sandglaz.com/blog_posts/25-Maktoub-a-simple-newsletter-engine-%20for-Rails)，这几乎就是我所描述的。免责声明：我从未使用过它，并且可能仍然会避开并使用付费服务，但它仍然可能比你自己拥有更好。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-22T14:05:05.063

我找不到，所以我自己写的。它并不漂亮（在这个阶段），但对于任何有类似需求的人来说，它应该是一个很好的起点。

如果您做出任何有益的更改，请向我发送拉取请求，我会确保给予您信任。

[Mailcar - Ruby on Rails 批量/批量电子邮件插件](http://github.com/MicahWedemeyer/mailcar/tree/master)

**更新**- 我强烈建议使用服务。滚动你自己是一个真正的痛苦，一旦你的列表变得相当大，就很难管理。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-19T06:52:21.740

我不知道这是插件可以覆盖的那种东西，因为有整个网站/应用程序专门用于这种东西。如果您想使用其中之一，那么可以使用 www.campaignmonitor.com，它非常好，并且它有一个您可以从您的应用程序中连接的 api。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-01-21T21:07:30.343

您可能想看看 postageapp.com

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T20:13:03.513

不知道有任何插件，我不知道如何使用 rake 来做到这一点，如果有的话。

由于您使用的是 Rails，我假设您使用 MySQL 作为数据库，因此这可能对您没有用处，但SQL Server 的[SQL Answers Mail](http://www.sqlanswers.com/Software/SAM/SqlAnswersMailOverview.aspx)直接从 SQL Server 发送批量电子邮件。您可以尝试搜索对您正在使用的数据库执行类似操作的工具。

[这里](http://www.jonathansng.com/ruby-on-rails/rails-send-email-tutorial/)和[这里](http://email.about.com/od/emailprogrammingtips/qt/et_mail_rails.htm)还有一个关于创建自己的邮件程序的教程。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-06T23:22:51.553

使用[ActionMailer(tutorial)](http://wiki.rubyonrails.org/rails/pages/HowToSendEmailsWithActionMailer) ( [docs](http://api.rubyonrails.org/classes/ActionMailer/Base.html) )，它随 Rails 一起提供，您应该能够将它装配为从 rake 任务中运行。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-12-15T20:27:14.967

[有一个名为Maktoub](https://github.com/Sandglaz/maktoub)的相对较新的项目，它声称是[用于电子邮件时事通讯的 Rails 引擎](https://github.com/Sandglaz/maktoub)。我还没有尝试过，但它看起来很有希望。

# asp.net - asp.net 2.0 全局主题在新的 Windows Server 2008 上不起作用

> ID：517604
> 
> 赞同：3
> 
> 时间：2009-02-05T19:46:34.207
> 
> 标签：asp.net, iis-7, windows-server-2008, asp.net-2.0, app-themes

我们正在将 .net 2.0 网站从带有 IIS6 的 Windows 2003 服务器（32 位）迁移到带有 IIS7 的 Windows Server 2008（64 位）机器。我似乎无法让全球主题发挥作用。与我们的旧服务器相同的内容/目录结构；本地 App_Themes 工作正常。

全局主题路径：D:\Inetpub\wwwroot\aspnet_client\system_web\2_0_50727\Themes

谢谢，亚伦

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-14T11:10:10.113

在 MSDN 中，您的目录路径应为：%windows%\Microsoft.NET\Framework\version\ASP.NETClientFiles\Themes。

[MSDN 上的主题](http://msdn.microsoft.com/en-us/library/ms247256.aspx)。当然，这有一些警告，如果某些情况属实，您的目录似乎可以工作。

如果这不是问题，我还将验证您的主题目录的权限。ASP.NET 工作进程和 IUSER 或运行您网站的任何帐户也需要对主题的所有文件夹和子文件夹的读取权限。您的设置是否遇到任何运行时错误？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-28T21:19:28.313

正在使用表单身份验证。在任何情况下 ？由于身份验证问题，我已经看到这种情况发生。

# vb6 - VB6 的高级证书

> ID：517607
> 
> 赞同：1
> 
> 时间：2009-02-05T19:46:53.160
> 
> 标签：vb6, windows-vista, elevated-privileges

我需要在 VB6 应用程序中获取提升的凭据（启动服务），但前提是用户需要重新启动服务（即我不想在应用程序启动时获取提升的凭据，只有当用户选择重新启动时）。我怎样才能在 VB6 中做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T22:05:53.817

相当容易，但首选方法涉及一个新的提升过程。此示例使用自己与开关一起运行以知道执行服务启动而不是正常操作：

```
VERSION 5.00
Begin VB.Form Form1 
   BorderStyle     =   1  'Fixed Single
   Caption         =   "Form1"
   ClientHeight    =   3060
   ClientLeft      =   45
   ClientTop       =   345
   ClientWidth     =   4560
   LinkTopic       =   "Form1"
   MaxButton       =   0   'False
   MinButton       =   0   'False
   ScaleHeight     =   3060
   ScaleWidth      =   4560
   StartUpPosition =   3  'Windows Default
   Begin VB.CommandButton Command1 
      Caption         =   "Start Service"
      Height          =   495
      Left            =   1448
      TabIndex        =   0
      Top             =   1283
      Width           =   1665
   End
End
Attribute VB_Name = "Form1"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit

Private Const BCM_SETSHIELD As Long = &H160C&

Private Declare Function SendMessage Lib "user32" _
    Alias "SendMessageA" ( _
    ByVal hWnd As Long, _
    ByVal wMsg As Long, _
    ByVal wParam As Long, _
    lParam As Any) As Long

Private Declare Function ShellExecute Lib "shell32.dll" _
    Alias "ShellExecuteA" ( _
    ByVal hWnd As Long, _
    ByVal lpOperation As String, _
    ByVal lpFile As String, _
    ByVal lpParameters As String, _
    ByVal lpDirectory As String, _
    ByVal nShowCmd As Long) As Long

Private Sub Command1_Click()
    ShellExecute hWnd, "runas", App.EXEName & ".exe", "-start", CurDir$(), vbNormalFocus
End Sub

Private Sub Form_Load()
    If UCase$(Trim$(Command$())) = "-START" Then
        Caption = "Starting Service"
        Command1.Visible = False
        'Service starting functionality goes here.
    Else
        Caption = "Service Starter"
        'For Shield to work you must have a Common Controls v. 6
        'manifest and call InitCommonControls before loading
        'this form (i.e. preferably from Sub Main).
        SendMessage Command1.hWnd, BCM_SETSHIELD, 0&, 1&
        Command1.Visible = True
    End If
End Sub 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T21:59:05.920

一种解决方案是使用 COM 提升名字对象[http://msdn.microsoft.com/en-us/library/ms679687(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms679687(VS.85).aspx)。

[如果您的目标是 VB6 http://www.vbforums.com/showthread.php?t=459643](http://www.vbforums.com/showthread.php?t=459643) ，这个链接应该很有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T22:03:59.750

您需要调用 WinAPI - CoImpersonateClient 或 LogonUser。
请记住在之后降低您的权限，并在提升时小心您所做的事情（例如，不要对用户输入做任何事情）。

另一个我认为更可取的选项（如果可用）是使用 COM+ 配置对象。您可以让 COM+ 子系统管理凭据，并根据需要限制调用对象的访问权限。这具有在低特权代码和高特权代码之间创建和实际信任边界的好处。

# django - 使用 Django，设置管理内容和静态内容路径的正确方法是什么？

> ID：517614
> 
> 赞同：2
> 
> 时间：2009-02-05T19:49:32.953
> 
> 标签：django, apache, .htaccess, mod-rewrite

我有一个 Django 站点设置，它使用 Django 管理面板，前缀为`/media/`，以及名为`/static/`. 当然，管理媒体的内容位于 Django 包中，并且站点的静态内容与站点的 Python 代码一起存储。

目前，我`public_html`只包含到实际保存静态内容的目录的适当命名的符号链接，如下所示：

```
~/public_html/
    .htaccess
    media -> $HOME/usr/lib/python2.4/site-packages/django/contrib/admin/media/
    site.fcgi
    site -> $HOME/mysite/public/static/ 
```

这些是我在`.htaccess`文件中使用的重写规则：

```
RewriteEngine On
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^(.*)$ site.fcgi/$1 [QSA,L] 
```

但是，以这种方式使用符号链接感觉就像......黑客，似乎我可以在中使用重写规则`.htaccess`来避免使用符号链接。（我还想最终添加一个`robots.txt`文件和一个 favicon 文件，而不必添加 - 并维护 - 一堆符号链接。）这是一个好主意，如果是，我该怎么做？

* * *

为了将来参考，我最终做了一些类似于 Rails 项目一般设置的事情。我的 Django 项目包含一个`public`目录，其中包括静态站点内容、FastCGI 脚本和`.htaccess`文件等，所以它看起来有点像这样：

```
~/
    django/
        public/
            .htaccess
            content/
            favicon.ico
            media@ -> /symlink/to/django/admin/media/
            site.fcgi
            static/ 
```

然后，`~/public_html`只是符号链接到`~/django/public`. 一切正常，所以我很高兴。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T16:08:43.510

符号链接不是“黑客”——它们是文件系统中合法且有用的实体。它们没有或比任何类型的文件更脆弱，它们减少了冗余，并减少了您需要做的 apache 配置量。我不太明白你为什么要避免它们。符号链接解决方案比编写 apache 规则要优雅得多，IMO。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-09T19:06:23.330

我只是用

```
Alias /media /home/akaihola/usr/lib/python2.4/site-packages/django/contrib/admin/media/
Alias /static /home/akaihola/mysite/public/static/ 
```

但我在真正的 Apache 配置文件中执行此操作，而不是`.htaccess`使用 mod_wsgi，尽管我不知道它是否有所作为。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T19:55:42.550

我也没有符号链接...

我使用网络服务器的重写`/media/(.*)`直接指向我的媒体目录和`/admin\-media/(.*)`我的管理媒体。我应该强调，这些重写发生在 django fastcgi 重写之前。我会给你我的代码，但我使用的是 Cherokee 而不是 Apache。

我不明白为什么您需要在站点根目录中具有“物理”表示...

# c# - P/Invoking CryptImportKey 和封送结构

> ID：517628
> 
> 赞同：0
> 
> 时间：2009-02-05T19:52:39.623
> 
> 标签：c#, pinvoke, cryptoapi

我正在尝试从 C# P/Invoke 到 CryptImportKey 以设置一个已知密钥，然后再加密将在某个时候在 C++ Win32 服务中解密的数据。我有 P/Invoke 的方法签名，一切正常，但我无法让它接受我的密钥 blob。C++ 结构在下面的注释中，我的用于编组的 C# 结构在下面。

```
 // typedef struct _PUBLICKEYSTRUC 
    // {
    //    BYTE bType;  
    //    BYTE bVersion;  
    //    WORD reserved;  
    //    ALG_ID aiKeyAlg;
    // } BLOBHEADER, PUBLICKEYSTRUC;
    [StructLayout(LayoutKind.Sequential)]
    public struct PUBLICKEYSTRUC
    {
        public Byte bType;
        public Byte bVersion;
        public Int16 reserved;
        public Int32 aiKeyAlg;
    }

    //typedef struct __KEYBLOB 
    //{
    //    BLOBHEADER hdr;
    //    DWORD cbKeySize;
    //    BYTE* rgbKeyData;
    //} KEYBLOB;

    [StructLayout(LayoutKind.Sequential)]
    public struct KEYBLOB
    {
        public PUBLICKEYSTRUC hdr;
        public Int16 cbKeySize;
        public Byte[] rgbKeyData;
    } 
```

然后我使用：

```
 int len = (Marshal.SizeOf(typeof(PUBLICKEYSTRUC) + Marshal.SizeOf(typeof(KEYBLOB)) + KeySize;
        byte[] arr = new byte[len];
        IntPtr ptr = Marshal.AllocHGlobal(len);
    Marshal.StructureToPtr(keyBlob, ptr, true);
    Marshal.Copy(ptr, arr, 0,len);
        Marshal.FreeHGlobal(ptr); 
```

要进入一个字节数组以传递给 CryptImportKey 但它似乎从来没有带走密钥，当我用它加密时，我得到不同的密文时间，表明它没有使用我的密钥。

编辑：

关键 blob 内容来自我拥有的可以成功加密和解密数据的 C++ 代码。我认为您可能对包含两次的标头有所了解，但我遇到的主要问题是 Byte[] rgbKeyData 的值没有被放入字节数组 arr 中。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-05T20:09:09.107

[这](http://blogs.msdn.com/alejacma/archive/2007/11/23/p-invoking-cryptoapi-in-net-c-version.aspx)是一个结构/导入列表，看起来很有希望。不过还没有自己测试过。

**编辑：**
当您计算 blob 的大小时：您实际上是在计算标题两次吗？此外，您是如何得出 KEYBLOB 结构的声明的？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T21:58:32.117

另一方面，你为什么还要在这里烦恼所有这些 P/Invoke 的东西？.NET Framework 具有内置类来为您完成所有这些工作。

假设您使用的是 RSA 加密，则 RSACryptoServiceProvider 类提供了一个 ImportParameters 方法，该方法接受一个 RSAParameters 对象。
干净，简单，正确的方法。

你有什么理由不能使用它吗？

# dependency-injection - 依赖注入框架会导致糟糕/懒惰的设计吗？

> ID：517631
> 
> 赞同：3
> 
> 时间：2009-02-05T19:52:57.157
> 
> 标签：dependency-injection

我对 DI 概念还很陌生，但我在设计中一直在某种程度上使用它——主要是通过将接口“注入”到构造函数中并让工厂创建我的具体类。好的，它不是基于配置的——但它从来不需要。

我开始研究 DI 框架，例如 Spring.NET 和 Castle Windsor，并偶然发现了 Ayende 的这篇[博客](http://ayende.com/Blog/archive/2007/10/20/Dependency-Injection-doesnt-cut-it-anymore.aspx)。

我从中得到的是

A) DI 框架很棒，但是 B) 这意味着我们不必担心我们的系统是如何根据依赖关系设计的。

对我来说，我习惯于认真思考如何松散耦合我的系统，但同时对依赖项有某种控制。

我有点害怕失去这种控制，而这只是一场混战。ClassA 需要 ClassB = 没问题，问就收！嗯。

或者这只是重点，这就是未来，我应该接受它？

想法？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-05T20:56:14.473

一个基本的 OO 原则是您希望您的代码依赖于接口而不是实现，DI 就是我们这样做的方式。从历史上看，它是如何演变的：

1.  人们最初通过“新”创建他们所依赖的类：

    IMyClass myClass = new MyClass();

2.  然后我们想删除实例化，所以有静态方法来创建它们：

    IMyClass myClass = MyClass.Create();

3.  然后我们不再依赖类的生命周期，但仍然依赖它进行实例化，所以我们使用了工厂：

    IMyClass myClass = MyClassFactory.Create();

4.  这将直接依赖从消费代码转移到工厂，但我们仍然间接依赖 MyClass，所以我们使用了这样的服务定位器模式：

    IMyClass myClass = (IMyClass)Context.Find("MyClass");

5.  这样，我们只依赖于代码中的接口和类的名称。但它可以做得更好，为什么不简单地依赖我们代码中的一个接口呢？我们可以使用依赖注入。如果您使用属性注入，您只需在代码中为您想要的接口放置一个属性设置器。然后，您配置代码之外的实际依赖项，容器管理该类和您的类的生命周期。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-05T20:00:42.570

我不会说您不必考虑依赖关系，但是使用 IoC 框架可以让您轻松更改满足依赖关系的类型，因为所有连接都在一个中心位置完成。

您仍然需要考虑需要哪些接口，并且正确使用它们并不总是一件小事。

我不明白松散耦合的系统如何被认为是惰性设计的。如果您经历了所有了解 IoC 框架的麻烦，那么您肯定不会走捷径。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-05T20:05:53.450

我认为理想情况下，如果您已经有一个松散耦合的系统..，使用容器只会移动您从代码中取出依赖项的地方，使它们更软，并让您的系统依赖于构建您的对象图的容器。

实际上，尝试使用容器可能会告诉您，您的系统并不像您想象的那样松散耦合。因此，通过这种方式，它可能会帮助您创建更好的设计。

好吧，我是这个 subjet 的新手.. 所以也许我不太对。

干杯。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T19:57:33.543

我一定很高兴，因为我认为依赖注入的全部意义在于执行某些操作的代码只是声明其依赖项，以便创建它的人知道用它创建什么才能正确运行。

依赖注入是如何让你变得懒惰的，它可能会迫使其他人处理依赖关系？**这就是重点！**别人不需要真的是别人；它只是意味着您编写的代码不需要关心依赖关系，因为它预先声明了它们。它们可以被管理，因为它们是明确的。

编辑：添加了上面的最后一句话。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-05T20:31:35.973

依赖注入可能有点难以习惯——而不是直接通过代码的路径，您最终会查看看似未连接的对象，并且给定的操作会通过一系列这些对象跟踪它的路径，这些对象的耦合似乎很友好， 抽象的。

这是一种类似于习惯 OO 的范式转变。目的是编写的对象确实具有重点和单一的职责，使用接口声明并由框架处理的依赖对象。

这不仅使松散耦合更容易，而且几乎不可避免，或者至少几乎是不可避免的，这使得在模拟环境中运行对象等事情变得更加简单——IOC 容器正在取代运行环境。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-05T21:49:31.057

我不同意并说它们在许多情况下会带来更好的设计。开发人员经常会创建功能太多且依赖项太多的组件。我发现 IOC 开发人员倾向于迁移到更好的思维方式并生产更小更简单的组件，这些组件可以组装到一个应用程序中。

如果他们遵循精神并进行测试，他们将进一步完善您的组件。这两个练习都迫使您编写更好的*可测试*组件，这些组件非常适合 IOC 容器的工作方式。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-05T21:31:24.930

你还是要担心。我的团队在我们当前的项目中使用 Castle Windsor。令我恼火的是，它延迟了从编译时到运行时的依赖查找。

如果没有 Castle Windsor，您将编写代码并且如果您还没有整理出您的依赖关系。砰，编译器会抱怨。使用 Castle Windsor，您可以在 xml 文件中配置依赖项。它们仍然存在，只是从您的大部分代码中分离出来。问题是，如果你把依赖关系定义得一团糟，你的代码可以编译得很好。但是，在运行时，Castle Windsor 使用反射查找具体的类来服务接口请求。如果找不到依赖项，则会在运行时出现错误。

我认为 Castle Windsor 在初始化时确实会检查依赖项是否存在，以便它可以很快抛出错误。但是，在使用强类型语言时，运行时无法解决这个问题仍然很烦人。

所以无论如何。依赖关系仍然很重要。使用 DI 时，您肯定会比以前更加关注它们。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-19T10:21:15.140

我们编写了自定义 DI 框架，认为它需要一些时间才能正确，但这一切都是值得的。我们将 who 系统划分为多个层，每一层的依赖注入都受到规则的约束。例如，在日志层，不能注入 CUD 和 BO 接口。

我们仍在考虑规则，其中一些每周都会更改，而其他则保持不变。

# vmware - Vista 64 上的 VMWare 6.x 作为 *32 任务运行

> ID：517634
> 
> 赞同：1
> 
> 时间：2009-02-05T19:53:18.373
> 
> 标签：vmware, vista64, taskmanager

我正在尝试在 Vista 64 上运行 VMWare Workstation 6.5.1。它运行，但始终作为 *32 任务。它应该作为本机 64 位任务运行。我已经卸载并重新安装，没有任何变化。有任何想法吗？

机器是 ASUS P5K，Intel Q6600 cpu，8 GB RAM。

感谢您的任何见解。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T20:12:47.023

VMWare 作为 32 位任务运行，但如果您在支持 VT 扩展的硬件上运行，仍然可以运行 64 位应用程序。它还可以访问超过 4GB 的内存，因为它在后台玩了很多花样。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-11T03:05:31.850

我有一个配置非常相似的同事，vista 64，vmware 工作站 6.5。他的 VMS 在 taskman 中作为本地 64 位任务运行。我还看到网上的其他帖子抱怨同样的问题。看来 vmware 工作站确实可以作为本机 64 位任务运行，并且存在显着的性能差异，但似乎没有人知道它如何或为什么有时会以 *32 运行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T20:04:28.693

不确定它“应该”做什么，但我的运行方式和你的一样。它也没有任何问题 - 事实上，我对它只使用了 2 周就印象深刻。惊人的产品。

# c# - 使用 BouncyCastle C# 进行 PGP 加密会导致签名验证时出现无效密钥警告

> ID：517635
> 
> 赞同：4
> 
> 时间：2009-02-05T19:54:08.980
> 
> 标签：c#, bouncycastle, pgp

我们需要对文件进行 PGP 加密并通过 FTP 将它们发送给第三方。这些文件使用第三方的 DH/DSS 公钥加密，并使用我们的私钥签名。

第三方拥有我们的公钥和他们自己的私钥。加密/解密有效，但第三方在尝试验证我们的签名时会收到警告。

当我们尝试使用 PGP Desktop 解密和验证类似加密的文件时，文件会在没有警告的情况下进行验证。

第三方正在使用“McAfee E-Business Server”

确切的警告是：警告：签名错误，与文件内容不匹配！来自用户“用户名”的错误签名

代码有点复杂，但[我把它贴在了我的博客上](http://blogs.microsoft.co.il/blogs/kim/archive/2009/01/23/pgp-zip-encrypted-files-with-c.aspx)。如果更合适的话，我可以在这里发布它而不是链接。

任何有关如何解决此问题的见解都值得赞赏。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-09T07:25:57.287

虽然我无法对问题的细节给出彻底的解释，但这里有一个可行的解决方案。首先，不同的 PGP 实现似乎对使用哪个程序来生成正在使用的密钥非常敏感。

失败的场景：

1.  在 PGP Desktop 中创建密钥（RSA v4、2048/2048）
2.  在 BouncyCastle 中加密（DH/DSS、Elgamal）
3.  登录 BouncyCastle（使用 RSA 密钥）
4.  在 PGP Desktop 中解密和签名验证成功。
5.  在 McAfee Business Server 中解密成功但签名验证失败。

为了使 McAfee Business Server 成功验证密钥，请使用 BouncyCastle 源代码中的代码在 BouncyCastle 中创建密钥。(Org.BouncyCastle.Bcp​​g.OpenPgp.Examples.RsaKeyRingGenerator) 如果您需要特定密钥，可以更改此代码特性。

另一种选择是使用 McAfee Business Server 生成密钥。为此，您需要访问该软件。我使用试用版进行了测试。（顺便说一句，起床和跑步时脖子很痛）

更新：我在 E-Business Server 8.5.3（试用版）上进行了所有测试。我达到了可以加密和登录 Bounty 并在 E-Business Server 中解密和验证的地步。结果第三方正在使用拒绝验证签名的 E-Business Server 7.0。为了让一切正常工作，我们需要创建 V3 签名。

我们从：

```
PgpSignatureGenerator pgpSignatureGenerator = new PgpSignatureGenerator(m_encryptionKeys.SecretKey.PublicKey.Algorithm, HashAlgorithmTag.Sha1); 
```

到

```
PgpV3SignatureGenerator pgpV3SignatureGenerator = new PgpV3SignatureGenerator(m_encryptionKeys.SecretKey.PublicKey.Algorithm, HashAlgorithmTag.Sha1); 
```

# .net - 查询 ManagementScope 对象以找出 ASP.NET 中的缓存大小

> ID：517642
> 
> 赞同：1
> 
> 时间：2009-02-05T19:56:54.340
> 
> 标签：.net, asp.net, caching

我想以编程方式监视某个 ASP.NET 站点上的缓存大小。这基本上是针对产品的管理部分，我们允许用户部分控制他们的站点是否使用缓存。

有没有办法做到这一点。我应该使用 ManagementScope 对象来执行此查询吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-05T20:03:28.963

Cache.EffectivePrivateBytesLimit是您所追求的吗[？](http://msdn.microsoft.com/en-us/library/system.web.caching.cache.effectiveprivatebyteslimit%28VS.80%29.aspx)

# algorithm - 伪随机目录树生成？

> ID：517647
> 
> 赞同：6
> 
> 时间：2009-02-05T19:58:51.467
> 
> 标签：algorithm, random, tree, fractals

我正在尝试编写一个程序，它将伪随机地自动生成（基于种子值，因此我可以多次重新运行相同的测试）由文件组成的不断增长的目录结构。（这是为了对源代码控制数据库安装进行压力测试）

我想知道你们中是否有人知道类似于可能在这里工作的准随机“空间填充”序列（例如[van der Corput 序列](http://mathworld.wolfram.com/vanderCorputSequence.html)或[Halton 序列](http://orion.math.iastate.edu/reu/2001/voronoi/halton_sequence.html)）。

编辑：或分形算法。这听起来有点像分形算法。

* * *

编辑2：没关系，我想我找到了明显的解决方案，从一棵空树开始，然后只使用伪随机生成器的顺序输出来确定性地（基于生成的数字和到目前为止生成的树的状态）做一个N 个动作，例如创建新子目录、添加新文件、重命名文件、删除文件等。

我想这样做，而不是仅仅将文件顺序转储到文件夹结构中，因为我们遇到了这样一种情况，即我们在处理大量 #s 文件时遇到了一些问题，并且不确定到底是什么原因。（树深度、重命名次数、删除次数等）

我需要生成的不仅仅是1棵固定的树，使用策略是：把树结构长一点，评估一些性能统计，再把树结构增长一点，评估一些性能统计等。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T20:12:22.687

如果这只是为了测试，那么一些简单、幼稚的生成算法有什么问题？就像，生成随机 (1-10) 数量的子目录，为它们生成名称，然后为每个目录递归地生成子目录和一些文件。

这很容易定制，您可以控制`rand`. 对于更时髦的需求，文件/目录数量的分布可以是非线性的，但更适合您的需求。

听起来可以在半小时内完成并完成。我看不到需要数学或复杂的东西。除非这只是为了好玩，当然:-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T20:28:52.077

这是一组不同的问题，这使它成为一个有趣的难题。

首先我们有伪随机数生成器。有很多东西可用。我只希望有一个函数可以在 0..n-1 范围内创建一个数字。

然后我们有一个算法来确定单个节点上的子节点数量。使用线性函数很诱人，但这不是对现实的公平表示。因此，您可以创建以下函数：

```
randomsize() {
  int n = Random(0,10);
  if (n<10) return n;

  return Random(0,9) + 10 * random;
} 
```

这个函数产生小数字。大多数将在 0..9 范围内，但顶部实际上是无穷无尽的。如果你想要更大的数字，你也可以使用更大的阈值

```
randomsize() {
  int n = Random(0,100);
  if (n<10) return n;

  return Random(0,9) + 10 * random;
} 
```

最后一个问题是如何创建树。这是相当简单的。但是您应该记住，算法必须结束。因此，您需要执行以下操作之一：

*   使用最大深度
*   根据嵌套级别减少生成的数字
*   确定叶子的数量占总子节点的百分比。这个百分比应该在更高的水平上增加（第一级 10-50，第二级 20-60.. 第五级 50-100，第六级 60-100，直到第九级和更高级别的 90-100。

当然，您可以调整参数以创建所需的树。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T20:39:44.257

正如您在第二次编辑中提到的那样，我可能会将整个事情实现为文件树遍历，PRNG 决定“更改到目录”、“创建目录”、“上移一级”、“创建文件”、“删除file" 并有另一个值来确定要删除的文件、要更改的目录以及为文件和目录生成名称。

我使用类似的方法对我编写的工作流服务器进行压力测试（尽管我不需要跟踪工作项的位置，只需要随机选择一个进行操作）。

# flash - URLLoader 烦人的问题

> ID：517650
> 
> 赞同：1
> 
> 时间：2009-02-05T19:59:27.597
> 
> 标签：flash, cs3

我正在尝试通过 php 从 sql 数据库加载变量，但我什么也没得到

这是代码

```
var Idfield;
var loader:URLLoader = new URLLoader();
// data will come as URL encoded variables
loader.dataFormat = URLLoaderDataFormat.VARIABLES;
loader.load(new URLRequest("pull.php"));
loader.addEventListener(Event.COMPLETE,dataload);                                     
function dataload(e:Event){
    Idfield =e.target.data["id"];
    trace(Idfield);
} 
```

这是php代码

```
 $query = "SELECT max(id) from $tablename";
    $result = mysql_query($query) 
        or die("no rows selected");
    $row = mysql_fetch_row($result); // extracts one row
    echo  "id=$row[0]"; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T20:07:12.683

我相信变量格式需要 name=value 格式的变量，因此请尝试以下操作：

```
echo 'id=' . $row[0]; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T20:05:49.190

一方面，您需要在实际调用 load() 之前添加事件侦听器。

当你说你一无所获时，你是什么意思？

您还可以侦听错误事件并从那里转储任何错误消息。

高温高压

# c# - 为什么布尔变量总是重置为假；

> ID：517652
> 
> 赞同：3
> 
> 时间：2009-02-05T20:00:55.643
> 
> 标签：c#, asp.net

我在类的顶部声明了一个布尔变量，当在页面上选择单选按钮时，该变量被设置为 true，但是当重新加载页面时，该变量被重置为 false。我处理此问题的一种方法是使用 static 关键字，但我不确定这是否是处理此问题的最佳方法。这是我尝试在 Page_Load 事件中执行操作的类，但它仍然将变量重置为 false。

```
public class SendEmail
{
    bool AllSelected;

protected void Page_Load(object sender, EventArgs e)
{
    if(!Page.IsPostBack)
    {
        AllSelected = false;
    }
}

protected void rbAll_SelectedIndexChanged(object sender, EventArgs e)
{
    if(rbAll.SelectedValue == "All")
       AllSelected = true;
}

public Send()
{
   if(AllSelected)
   {
       //Send Email. Never runs because AllSelected is always false;
   }
}

} 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-05T20:04:33.563

当页面重新加载时，会创建页面类的新实例，因此上次服务器交互的所有值都将丢失。如果您希望它在回发中持续存在，请将值放入视图状态：

```
bool AllSelected
{
    get
    {
        object o = ViewState["AllSelected"];
        if(o == null) return false;
        return (bool)o;
    }
    set
    {
        ViewState["AllSelected"] = value;
    }
} 
```

ViewState 集合以隐藏元素的形​​式写入客户端浏览器的表单中，并在下次单击按钮或执行任何其他“回发”类型的操作时回发并恢复。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-05T20:04:46.167

每次 asp.net 提供一个页面时，它都会创建一个新的页面类实例。这意味着 AllSelected 将始终自动初始化为 false。

我的建议是，除非我在这里看不到某些东西，否则只需从您的 SelectedIndexChanged 方法调用 Send() 。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-05T20:08:00.700

您需要存储变量。我建议将其存储在 ViewState 中，或者如果您想远离 ViewState，请将其隐藏在页面上的表单元素中。

另外，我没有看到 Send 被调用的位置。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T20:04:43.733

您的布尔值是一个实例变量，因此每次您创建类的新实例时，它都会获得默认值（对于布尔值是 false）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-05T20:05:40.190

请记住，对您页面的每个请求都使用您的页面类的全新实例。这包括回发。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-05T20:08:36.690

不要跳到你或任何东西上......但为什么不检查一下

```
rbAll.SelectedValue == "All" 
```

在你的发送功能？

没有存储...没有用不需要的数据填充 ViewState 或 Session...

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-09-17T11:55:48.830

我真的不知道这在 asp.net 中是否会派上用场，但我在 property.settings 中创建了一个新的布尔值，以便在我关闭或重新启动应用程序时记住布尔值。但我认为这更适用于winforms。

# asp.net-mvc - 如何仅在 C# 中按时间和时间排序？

> ID：517661
> 
> 赞同：2
> 
> 时间：2009-02-05T20:04:19.583
> 
> 标签：asp.net-mvc, linq, c#-3.0

我在 SQL Server 中记录了这个：

**1- startTime（日期时间）：5/2/2009 08:30（巴西时间格式：d/m/y）**

**2- startTime（日期时间）：4/2/2009 14:30（巴西时间格式：d/m/y）**

我的应用程序只记录时间……它自己生成的 SQL 的日期是今天的日期。

当我要求 VS 2008 订购此日期时间字段时，它返回代码 #2 在 #1 之前，因为 2009 年 4 月 2 日在 2009 年 5 月 2 日之前。

但是，实际上我希望它只按时间排序而忽略日期。

是否可以？？

谢谢！！安德烈

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-05T20:09:29.480

```
from d in dates
     orderby d.TimeOfDay
     select d; 
```

或者

```
dates.OrderBy(d => d.TimeOfDay); 
```

* * *

**注意：**只要这是纯 LINQ 而不是 LINQ-to-SQL，这将起作用。如果您使用 LINQ-to-SQL 来查询您的数据库，您将需要一些可以转换为 SQL 的东西。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-05T20:16:23.680

您也可以尝试修复您的应用程序，使其始终与时间保存相同的基准日期（例如“01/01/1900”或其他），然后您不必每次都执行所有这些缓慢且低效的日期剥离操作需要做一个查询。

或者正如乔尔所说，在插入或更新之前截断或剥离日期部分。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T21:15:13.700

好吧，您不能真正存储没有日期的日期时间，但您*可以*将总秒数存储为双精度数（使用@florian 的方法）。

如果您仍然需要日期，则必须添加第二种方法将其转换回对象中的日期，例如：

```
public class BusinessObjectWithDate
{
    private string _someOtherDbField = "";
    private double _timeInMS = 0; // save this to the database

    // sort by this? in sql or in code.  You don't really need this 
    // property, since TimeWithDate actually saves the _timeInMS field
    public double TimeInMS {      
        get { return _timeInMS; }
    }
    public DateTime TimeWithDate { // sort by this too, if you want
        get { return (new DateTime(1900,1,1).AddMilliseconds(_timeInMS)); }
        set { _timeInMS = value.TimeOfDay.TotalMilliseconds; }
    }
}

var f = new BusinessObjectWithDate();
MessageBox.Show( f.TimeWithDate.ToString() );  // 1/1/1900 12:00:00 AM
f.TimeWithDate = DateTime.Now;
MessageBox.Show( f.TimeWithDate.ToString() );  // 1/1/1900 1:14:57 PM 
```

您也可以只存储实际日期时间，但在设置值时始终用 1/1/1900 覆盖。这也适用于 sql

```
public class BusinessObjectWithDate
{
    private DateTime _msStoredInDate;
    public DateTime TimeWithDate
    {
        get { return _msStoredInDate; }
        set {
            var ms = value.TimeOfDay.TotalMilliseconds;
            _msStoredInDate = (new DateTime(1900, 1, 1).AddMilliseconds(ms));
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T20:11:52.440

在你的 sql 中试试这个：

```
ORDER BY startTime - CAST(FLOOR(CAST(startTime AS Float)) AS DateTime) 
```

# css - 为 body 设置 * 通用选择器或设置 padding 和 margin 为 0 的目的是什么？

> ID：517662
> 
> 赞同：2
> 
> 时间：2009-02-05T20:04:26.103
> 
> 标签：css

我不是设计师，但我注意到 Firefox 和 Internet Explorer 之间的许多变化。有人告诉我，将通用选择器的 (*) 填充和边距设置为 0 并将主体的边距和填充设置为 0 是个好主意。这是必要的吗？是否需要同时设置 * 和 body 的填充和/或边距？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-05T20:06:57.753

每个浏览器对每种元素类型都有自己的“默认”CSS 值。使用通用选择器`*`将边距和内边距重置为 0 可消除可能由不同的默认 CSS 值导致的任何跨浏览器不一致。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-05T23:56:14.250

查看 Yahoo 的重置 CSS：

[http://developer.yahoo.com/yui/reset/](http://developer.yahoo.com/yui/reset/)

使处理不同的浏览器变得容易得多。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T20:09:33.067

设置正文的边距和填充是为了避免窗口边缘和 HTML 正文之间的默认空间。您的特定网站设计可能需要或不需要；例如，stackoverflow 需要它用于底部的灰色框。不需要为 * 设置它来完成此操作，因为显然主体设置将覆盖标签的 * 设置。

像这样以粗暴的方式更改 * 设置只会删除以前为所有不同标签存在的合理默认值。您最好只更改直接困扰您的 CSS，例如去除特定元素之间不必要的空间。这有点像人们为整个页面提供绝对默认字体大小 10，这让有特殊需求的用户非常恼火。

# c# - UI 自动化“选定文本”

> ID：517694
> 
> 赞同：9
> 
> 时间：2009-02-05T20:11:19.210
> 
> 标签：c#, winapi, user-interface, automation

任何人都知道如何使用 UI 自动化和 .Net 从其他应用程序中获取选定的文本？

[http://msdn.microsoft.com/en-us/library/ms745158.aspx](http://msdn.microsoft.com/en-us/library/ms745158.aspx)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-03-05T00:56:04.320

```
private void button1_Click(object sender, EventArgs e) {
        Process[] plist = Process.GetProcesses();

        foreach (Process p in plist) {
            if (p.ProcessName == "notepad") {

                AutomationElement ae = AutomationElement.FromHandle(p.MainWindowHandle);

                AutomationElement npEdit = ae.FindFirst(TreeScope.Descendants, new PropertyCondition(AutomationElement.ClassNameProperty, "Edit"));

                TextPattern tp = npEdit.GetCurrentPattern(TextPattern.Pattern) as TextPattern;

                TextPatternRange[] trs;

                if (tp.SupportedTextSelection == SupportedTextSelection.None) {
                    return;
                }
                else {
                    trs = tp.GetSelection();
                    lblSelectedText.Text = trs[0].GetText(-1);
                }
            }
        }
    } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2019-08-28T13:52:19.127

这是另一个仅使用 UI 自动化的解决方案。它从记事本和写字板中获取选定的文本。

```
// Get only top level windows
PropertyCondition condition = new PropertyCondition(AutomationElement.ControlTypeProperty, ControlType.Window);
AutomationElementCollection windows = AutomationElement.RootElement.FindAll(TreeScope.Children, condition);
List<AutomationElement> allDocuments = new List<AutomationElement>();

foreach (AutomationElement window in windows)
{
    string className = window.Current.ClassName;
    if (className == "Notepad" || className == "WordPadClass")
    {
        condition = new PropertyCondition(AutomationElement.ControlTypeProperty, ControlType.Document);
        AutomationElementCollection documents = window.FindAll(TreeScope.Children, condition);

        if (documents.Count > 0)
        {
            allDocuments.Add(documents[0]);
        }
    }
}

// store all pieces of selected text here
List<string> selectedText = new List<string>();

// iterate through all documents found
foreach (AutomationElement document in allDocuments)
{
    object patternObj = null;
    if (document.TryGetCurrentPattern(TextPattern.Pattern, out patternObj) == true)
    {
        TextPattern textPattern = patternObj as TextPattern;
        TextPatternRange[] ranges = textPattern.GetSelection();

        foreach (TextPatternRange range in ranges)
        {
            string text = range.GetText(-1);
            if (text.Length > 0)
            {
                selectedText.Add(text);
            }
        }
    }
} 
```

# c# - 字符串和整数，隐式和显式

> ID：517695
> 
> 赞同：9
> 
> 时间：2009-02-05T20:11:41.177
> 
> 标签：c#, string, int, implicit, explicit

有一个同事问我这个问题，在我头脑混乱的状态下，我没有答案：

为什么你可以这样做：

```
string ham = "ham " + 4; 
```

但不是：

```
string ham = 4; 
```

如果在*concatenating*时存在字符串转换的隐式转换/操作，为什么在将其*分配*为字符串时不一样？（当然，不做一些运算符重载）

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-05T20:17:14.160

连接编译器时，编译器会将语句`"ham" + 4`转换为对 的调用`String.Concat`，该调用带有两个`object`参数，因此该值`4`被装箱，然后`ToString`在其上调用。

对于赋值，没有从`int`to的隐式转换`string`，因此您不能在不显式转换的情况下分配`4`给 a `string`。

换句话说，编译器对这两个赋值的处理方式非常不同，尽管它们在 C# 中看起来非常相似。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-05T20:25:22.413

> 二进制 + 运算符是为数字和字符串类型预定义的。对于数字类型，+ 计算其两个操作数的和。当一个或两个操作数是字符串类型时，+ 连接操作数的字符串表示形式。

[参考](http://msdn.microsoft.com/en-us/library/k1a63xkz.aspx)

> 赋值运算符 (=) 将其右侧操作数的值存储在由其左侧操作数表示的存储位置、属性或索引器中，并将该值作为结果返回。操作数必须是相同的类型（或者右侧操作数必须隐式转换为左侧操作数的类型）。

[参考](http://msdn.microsoft.com/en-us/library/sbkb459w.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-05T20:17:29.917

进行连接时没有隐式转换。字符串连接解析为 String.Concat 调用，该调用具有接受对象的重载。正是这种重载执行了（显式）到字符串的转换。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T20:16:22.557

第一个表达式右边的值是一个字符串，而第二个表达式右边的值不是。连接在第一个场景中提供了魔力，其中任务没有做任何特别的事情。在第二种情况下，作业继续装傻。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-05T20:20:53.950

表达方式

```
"ham " + 4 
```

根据字符串类型和加法运算符的组合，强制将 4 隐式转换为字符串。具体来说，它是“+”运算符的一种特性，在进行运算符重载时，您可以手动实现相同类型的东西。

一个类似但不太明显的例子是：

long myNumber = Int64.MaxValue - 1;

在这种情况下，“1”应该被评估为一个 32 位整数，但它是隐式转换的。您可以查看 C# 语言规范第 6.1 节以获取编译器支持的隐式转换的详尽列表。

编辑：要清楚，我提到的语言规范部分列出了编译器支持的隐式转换，而像“+”这样的运算符可以有自己支持的转换。

# delphi - 在对象存储库中注册表单（自动，通过代码或任何其他方式）

> ID：517699
> 
> 赞同：-1
> 
> 时间：2009-02-05T20:12:44.870
> 
> 标签：delphi, delphi-2006, tform

我正在对我的表单进行一些自定义，因为我希望它们带有一些已发布的属性出现在 Object Inspector 上。我已经完成了简单的方法：创建表单，将其放在对象存储库中，创建一个包以将其注册到 RegisterCustomModule。

我想知道是否有人有办法以自动化的方式将它放在对象存储库中（我想简化它在其他机器上的安装）。

我用谷歌搜索，但要么没有人写过关于它的东西，要么我没有找到正确的关键字......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T23:46:03.460

由于没有其他人给出答案，让我告诉你我会尝试。

在将表单注册到存储库之前，我会去注册表并导出 Delphi 分支的副本，然后注册并保存另一个副本，并在差异查看器中比较它们。如果幸运的话，信息会存储在那里，您可以推断出需要添加哪些注册表项才能注册……您可以只发送一个 .reg 文件。

顺便说一句，这就是我们在我工作的公司配置 Delphi 安装的方式。让一切都一样...

如果它不起作用，则配置可能存储在文件系统中的某个位置。您可以使用类似的取证方法来尝试对注册的编码方式进行逆向工程......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-06T09:24:50.640

如果它在本地网络上，您可以让每个开发人员使用相同的共享存储库（环境选项）并在他们的 IDE 中安装设计包。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-06T17:41:12.510

你必须首先做两件事：

1.  在存储库文件夹中添加所需的文件（对于 Delphi 2007，它是 $PROGRAMFILES$\CodeGear\RAD Studio\BDS\5.0\ObjRepos）。
2.  更新同一文件夹中的 BorlandStudioRepository.xml 文件。您可以查看它的当前内容以了解需要添加的内容。

然后在 HKCU\Software\CodeGear\BDE\5.0\Known IDE Packages\Delphi 下创建注册表项，将您的 .BPL 注册到 IDE。

# java - Java JTree的右键单击上下文菜单？

> ID：517704
> 
> 赞同：29
> 
> 时间：2009-02-05T20:13:51.547
> 
> 标签：java, contextmenu, jtree

我正在尝试在 Java JTree 中实现弹出菜单。我将 DefaultTreeCellRenderer （以更改节点外观）和 DefaultTreeCellEditor （以创建组件以将事件侦听器附加到，因为显然 DefaultTreeCellRenderer.getTreeCellRendererComponent() 返回的组件不能做到这一点？）。我真的不想“编辑”节点，只是能够在节点被右键单击时弹出一个菜单，但这是我现在能想到的唯一方法......

下面是我到目前为止的代码——我只是想弄清楚如何捕获 MouseEvents。它有点工作，但很糟糕。有什么更好的方法来完成我在这里尝试做的事情？

```
private class My_TreeCellRenderer extends DefaultTreeCellRenderer { 
    My_TreeCellRenderer() {
        super ();
    }   

    public Component getTreeCellRendererComponent(JTree tree, Object value, boolean selected, boolean expanded, boolean leaf, int row, boolean hasFocus) {
        super.getTreeCellRendererComponent(tree, value, selected, expanded, leaf, row, hasFocus);

        // set label text and tool tips
        setText(((My_Object)value).getTreeLabel());
        setToolTipText(((My_Object)value).getTreeToolTip());

        return this;
    }
}

private class My_TreeCellEditor extends DefaultTreeCellEditor { 
    private MouseAdapter ma;

    My_TreeCellEditor(JTree tree, DefaultTreeCellRenderer renderer) {
        super (tree, renderer);
        ma = new MouseAdapter() {
            public void mousePressed(MouseEvent e) {
                if (e.isPopupTrigger()) {
                    System.out.println("My Popup");
                }
            }
            public void mouseReleased(MouseEvent e) {
                if (e.isPopupTrigger()) {
                    System.out.println("My Popup");
                }
            }
        };
    }

    public Component getTreeCellEditorComponent(JTree tree, Object value, boolean selected, boolean expanded, boolean leaf, int row) {
        String src_filename = null;

        // return non-editing component
        Component c = renderer.getTreeCellRendererComponent(tree, value, selected, expanded, leaf, row, true);

        // add mouse listener if it's not listening already
        MouseListener mouseListeners[] = c.getMouseListeners();
        int i;
        for (i=0; i < mouseListeners.length && mouseListeners[i] != ma; i++);
        if (i >= mouseListeners.length)
            c.addMouseListener(ma);

        return c;
    }

    protected boolean canEditImmediately(EventObject event) {
        if (event instanceof MouseEvent && ((MouseEvent)event).getClickCount() == 1)
            return true;
        else
            return false;
    }
} 
```

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2012-06-02T03:35:40.340

此任务很容易完成，您只需要以下内容：

```
//create a class which implements the MouseListener interface and
//implement the following in your overridden mouseClicked method

@Override
public void mouseClicked(MouseEvent e) {

    if (SwingUtilities.isRightMouseButton(e)) {

        int row = tree.getClosestRowForLocation(e.getX(), e.getY());
        tree.setSelectionRow(row);
        popupMenu.show(e.getComponent(), e.getX(), e.getY());
    }
} 
```

然后，您可以将此自定义侦听器添加到所需的树中。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-02-05T23:45:23.460

直接[取自 JTree API](http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/JTree.html)

```
 // If you are interested in detecting either double-click events or when a user clicks on a node, regardless of whether or not it was selected, we recommend you do the following:

 final JTree tree = ...;

 MouseListener ml = new MouseAdapter() {
     public void mousePressed(MouseEvent e) {
         int selRow = tree.getRowForLocation(e.getX(), e.getY());
         TreePath selPath = tree.getPathForLocation(e.getX(), e.getY());
         if(selRow != -1) {
             if(e.getClickCount() == 1) {
                 mySingleClick(selRow, selPath);
             }
             else if(e.getClickCount() == 2) {
                 myDoubleClick(selRow, selPath);
             }
         }
     }
 };
 tree.addMouseListener(ml); 
```

当然，您需要对其进行一些修改以右键单击而不是左键单击

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-02-06T02:20:38.187

感谢大家。当我花了这么多精力来实现一个简单的弹出窗口时，我知道出了点问题。

起初我驳回了这种想法，因为使用 x 和 y 坐标来查找我正在寻找的节点感觉很奇怪，但我想这就是这样做的方法。

```
 // add MouseListener to tree
    MouseAdapter ma = new MouseAdapter() {
        private void myPopupEvent(MouseEvent e) {
            int x = e.getX();
            int y = e.getY();
            JTree tree = (JTree)e.getSource();
            TreePath path = tree.getPathForLocation(x, y);
            if (path == null)
                return; 

            tree.setSelectionPath(path);

            My_Obj obj = (My_Obj)path.getLastPathComponent();

            String label = "popup: " + obj.getTreeLabel();
            JPopupMenu popup = new JPopupMenu();
            popup.add(new JMenuItem(label));
            popup.show(tree, x, y);
        }
        public void mousePressed(MouseEvent e) {
            if (e.isPopupTrigger()) myPopupEvent(e);
        }
        public void mouseReleased(MouseEvent e) {
            if (e.isPopupTrigger()) myPopupEvent(e);
        }
    };

    (...)

    JTree tree = new JTree();
    tree.addMouseListener(ma); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-05T23:56:16.793

我认为你让事情变得比他们需要的更难。
JTree 上有几个“add_foo_Listener”方法。实现其中之一（TreeSelectionListener 看起来很正确），然后您就获得了当前选定的节点。
实现一个 MouseListener 以便您可以检测到右键单击事件（并将其添加到 JTree，因为 JTree 是一个组件），然后您应该拥有发布上下文相关菜单所需的一切。
查看本[教程](http://java.sun.com/docs/books/tutorial/uiswing/components/tree.html)了解更多详情。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-05T20:20:50.160

渲染器只是一个短暂的“橡皮图章”，因此在其上添加输入侦听器不会特别有用。正如您所指出的，编辑器只有在您做出编辑手势时才会出现。因此，您想向 JTree 添加一个侦听器（假设它没有作为复合组件实现）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-03-30T19:05:38.810

调用`addRightClickListener()`以将右键单击上下文菜单侦听器添加到您的`JTree`. 这两个覆盖都是为了正确的跨平台功能（在这里`Windows`有所`Linux`不同）。

```
private void addRightClickListener()
{
    MouseListener mouseListener = new MouseAdapter()
    {
        @Override
        public void mousePressed(MouseEvent mouseEvent)
        {
            handleContextMenu(mouseEvent);
        }

        @Override
        public void mouseReleased(MouseEvent mouseEvent)
        {
            handleContextMenu(mouseEvent);
        }
    };

    tree.addMouseListener(mouseListener);
}

private void handleContextMenu(MouseEvent mouseEvent)
{
    if (mouseEvent.isPopupTrigger())
    {
        MyContextMenu contextMenu = new MyContextMenu();

        contextMenu.show(mouseEvent.getComponent(),
                mouseEvent.getX(),
                mouseEvent.getY());
    }
} 
```

# couchdb - CouchApps 和用户身份验证

> ID：517708
> 
> 赞同：37
> 
> 时间：2009-02-05T20:14:50.420
> 
> 标签：couchdb

我在 CouchDB 用户列表中发布了这个问题的变体，但尚未收到回复。

我很想知道是否还有其他人构建了所谓的“CouchApp”；直接托管在 CouchDB 中的纯 HTML/JavaScript 应用程序。如果是这样，您是如何处理用户身份验证的？我希望能够创建一个典型的登录表单（用户名，密码），然后在将用户传递给应用程序之前将这些凭据用于视图或其他一些机制（同时将他们的（加密的）用户 ID 存储在饼干，大概）。

我习惯于简单地通过诸如 couchdb-python 和普通 Web 服务器之类的东西进行代理，但想知道有关在此类 CouchApps 中验证用户的任何最佳实践。

**编辑：**一年后，现在已内置到 CouchDB 中。 [这个视频](http://tubricator.com/couchdbsecurityintro)是一个很好的演示。（谢谢丹尼尔！）

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-08T02:36:35.860

CouchDB 已经发布了一个简单的身份验证 API，但目前还没有内置的身份验证机制。最简单和最简单的方法是使用 http 代理进行身份验证。但是，这对您可以在每个文档的基础上限制访问的程度有限制。当 CouchDB 获得对内置身份验证模块的更多支持时，它应该会更容易。

如果您想尝试编写身份验证模块，则可以在此文件中查看 javascript security_validation 测试的源代码：http: [//svn.apache.org/repos/asf/couchdb/trunk/share/www/脚本/couch_tests.js](http://svn.apache.org/repos/asf/couchdb/trunk/share/www/script/couch_tests.js)

和这里文件中的 default_authentication_handler：http: [//svn.apache.org/repos/asf/couchdb/trunk/src/couchdb/couch_httpd.erl](http://svn.apache.org/repos/asf/couchdb/trunk/src/couchdb/couch_httpd.erl)

无论如何，这会让你开始。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2011-10-19T19:04:06.057

这个问题已经存在了一段时间（1.5 年！），自从它被回答以来，事情已经成熟了很多。观看上面的视频，但它没有解释如何将其构建到您的应用程序中。看起来大多数答案现在都可以在此处找到：[安全功能概述](http://wiki.apache.org/couchdb/Security_Features_Overview)和本文档末尾的：[CouchDB 安全](http://guide.couchdb.org/draft/security.html)性。

# wpf - 在 DataTemplate 中不受尊重

> ID：517719
> 
> 赞同：3
> 
> 时间：2009-02-05T20:17:46.203
> 
> 标签：wpf, .net-3.5, datatemplate

我有一个定义了 DataTemplate 的 WPF ListBox。在那个模板中，我有一个网格，第一列的宽度应该占据网格中所有剩余的空间。

这似乎在 ListBox 之外有效，但在内部无效。为什么会这样，我怎样才能让它表现得一样？

这是我的代码。见第 36 行和第 70 行

```
 <UserControl x:Class="Russound.Windows.UI.UserControls.MAX.Reports.UniversalReportsWpf"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Height="250" Width="900"  >
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>           
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>              

                <TextBlock Grid.Row="0" Height="35" Padding="0,3,5,0" Text="Standard Reports" HorizontalAlignment="Right" FontWeight="Bold" FontSize="20" Foreground="DarkBlue"/>
                <Border Grid.Row="1">
                    <Grid>
                        <Grid.Resources>
                            <Style TargetType="{x:Type TextBlock}">
                                <Setter Property="HorizontalAlignment" Value="Left"/>
                                <Setter Property="VerticalAlignment" Value="Top"/>
                                <Setter Property="Height" Value="20"/>
                                <Setter Property="Padding" Value="0,3,5,0"/>
                                <Setter Property="Cursor" Value="Hand"/>
                                <Setter Property="Foreground" Value="WhiteSmoke" />
                            </Style>
                        </Grid.Resources>
                        <Grid.Background>
                            <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                                <GradientStop Color="#FF808080" Offset="0"/>
                                <GradientStop Color="#FF000000" Offset="1"/>
                            </LinearGradientBrush>
                        </Grid.Background>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="300*" />
                            <ColumnDefinition Width="150" />
                            <ColumnDefinition Width="100" />
                            <ColumnDefinition Width="50" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="Report Name" FontWeight="Bold"/>
                        <TextBlock Grid.Column="1" Text="Last Run Date" FontWeight="Bold"/>
                        <TextBlock Grid.Column="2" Text="Last Ran By" FontWeight="Bold"/>
                        <TextBlock Grid.Column="3" Text="Secure" FontWeight="Bold"/>
                    </Grid>
                </Border>
            </Grid>
            <ListBox Grid.Row="1"  ItemsSource="{Binding}" 
                     ItemTemplate="{DynamicResource reportLayout}" 
                     VirtualizingStackPanel.VirtualizationMode="Recycling"
                     MouseDoubleClick="DisplaySelectedReport" Grid.RowSpan="2">
                <ListBox.SelectedItem>
                    <MouseBinding MouseAction="LeftDoubleClick"
                  Command="ApplicationCommands.Open" />
                </ListBox.SelectedItem>
                <ListBox.Resources>
                    <DataTemplate x:Key="reportLayout" DataType="AdHockReport">
                        <Grid>
                            <Grid.Resources>
                                <Style TargetType="{x:Type TextBlock}">
                                    <Setter Property="HorizontalAlignment" Value="Left"/>
                                    <Setter Property="VerticalAlignment" Value="Top"/>
                                    <Setter Property="Height" Value="25"/>
                                    <Setter Property="Padding" Value="0,3,5,0"/>
                                    <Setter Property="Cursor" Value="Hand"/>
                                </Style>                            
                            </Grid.Resources>    

                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="150" />
                                <ColumnDefinition Width="100" />
                                <ColumnDefinition Width="50" />
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" ToolTip="Report Name" Text="{Binding Path=DisplayName}" FontWeight="Bold"/>
                            <TextBlock Grid.Column="1" ToolTip="Last Run Date" Text="{Binding Path=LastRunDate, StringFormat=MMM dd\, yyyy h:mm tt}" />
                            <TextBlock Grid.Column="2" ToolTip="Last Run By" Text="{Binding Path=LastRunBy}" />
                            <TextBlock Grid.Column="3" ToolTip="Secure" Text="{Binding Path=IsSecure}" />
                        </Grid>                    
                    </DataTemplate>
                </ListBox.Resources>
                <ListBox.Background>
                    <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                        <GradientStop Color="#FFE5E5E5" Offset="0"/>
                        <GradientStop Color="#FF888888" Offset="1"/>
                    </LinearGradientBrush>
                </ListBox.Background>           
            </ListBox>

        </Grid>
    </UserControl> 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-05T20:29:35.960

这是因为包含网格的 ListBoxItem 根据内容调整大小。因此，要填充的星型列的“剩余空间”仅与列需要的一样多。

要解决此问题，请使用 ListBox.ItemContainerStyle 将 ListBoxItem.Horizo​​ntalContentAlignment 设置为 Stretch。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T20:27:36.823

尝试编辑 ListBox 的 ControlTemplate 并删除其中的滚动查看器，让它只是 Border 内的 ItemsPresenter。

# asp.net - 在 ASP.Net 中，<%= 和 <%# 有什么区别

> ID：517721
> 
> 赞同：29
> 
> 时间：2009-02-05T20:18:41.460
> 
> 标签：asp.net

`<%= x %>`在 ASP.Net 中，和 和有什么区别`<%# x %>`？

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2009-02-05T20:22:46.177

看到这个问题：
[我什么时候应该在 ASP.NET 控件中使用 # 和 =？](https://stackoverflow.com/questions/115159/when-should-i-use-and-in-asp-net-controls)

* * *

这些答案的摘要：

有几种不同的“蜜蜂叮咬”：

*   `<%@` - 页面/控制/导入/注册[指令](http://msdn.microsoft.com/en-us/library/t8syafc7%28v=vs.100%29.aspx)
*   `<%$` -[资源](http://msdn.microsoft.com/en-us/library/ms227427.aspx)访问和[表达](http://msdn.microsoft.com/en-us/library/d5bd1tad.aspx)构建
*   `<%=` - 显式输出到页面，相当于`<% Response.Write( ) %>`
*   `<%#` -[数据绑定。](http://msdn.microsoft.com/en-us/library/ms178366.aspx) 它只能在支持数据绑定的情况下使用，或者如果您`Page.DataBind()`在代码隐藏中调用，则可以在页面级别使用。
*   `<%--`-[服务器端注释](http://msdn.microsoft.com/en-us/library/4acf8afk%28v=vs.100%29.aspx)块
*   `<%:` - 等效于`<%=`，但它[也对输出进行 html 编码](http://weblogs.asp.net/scottgu/archive/2010/04/06/new-lt-gt-syntax-for-html-encoding-output-in-asp-net-4-and-asp-net-mvc-2.aspx)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-05T20:21:20.783

`<%#`是[数据绑定表达式语法](http://msdn.microsoft.com/en-us/library/ms178366.aspx)。

`<%=`解析表达式将其值返回到块（[嵌入式代码块参考](http://msdn.microsoft.com/en-us/library/ms178135.aspx)） - 有效的简写`<% Response.Write(...); %>`

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-05T20:21:56.320

<%# 是数据绑定指令，<%= 是“Response.Write”的快捷方式

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-05T20:23:33.633

<%= x %> 是 Response.Write() 的简写

<%# x %> 表示数据绑定。

<% %> 表示服务器可执行代码。

# reporting - 真正的企业报告

> ID：517726
> 
> 赞同：0
> 
> 时间：2009-02-05T20:19:27.370
> 
> 标签：reporting

有没有人做过真正的企业报告——如果有，是自产的还是购买的？我所说的是创建一个报告门户，它允许任何报告引擎结果的单一入口点。我想要一个基于浏览器的地方让我的全球用户去获取报告。

每个区域可能都有为商业智能构建的不同基础架构——但我希望他们以与其他人相同的方式去中心位置查看和执行报告——无论双基础架构如何。区域设置会将他们的数据（他们的 BI 解决方案）映射到报告门户，并且能够使用报告门户来查看、执行和导出报告结果，其外观和感觉与组织中的其他人相同。

我认为报告供应商/行业认为大型全球组织将标准化单个BI解决方案是不现实的——这更有可能是我们的场景。许多双向工具 - 适合工作的正确工具 - 以及拥有一个报告门户的愿景，该门户汇集了所有内容并控制外观/感觉/指标/流程。那么，有没有人做过真正的企业报告——如果有，是自产的还是购买的？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-05T20:23:59.827

我们推出了自己的 Web 报告门户，它连接到 Business Objects、Crystal 等。它管理报告参数、调度等并提供一致的 UI。当然它有它的问题，但我们找不到任何接近的现成解决方案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T20:59:49.580

我已经看过有关此主题的 SharePoint 2007 演示文稿。您可能想要更深入地了解 SharePoint。

# hibernate - 使用 GWT、Struts 和 Hibernate 在 Web 应用程序中处理数据

> ID：517729
> 
> 赞同：1
> 
> 时间：2009-02-05T20:20:31.110
> 
> 标签：hibernate, gwt, struts, jndi, google-visualization

我正在使用 Struts 和 Hibernate 编写一个 Web 应用程序。最近，我发现了[GWT](http://code.google.com/webtoolkit/)和[Visualization API](http://code.google.com/docreader/#p=gwt-google-apis&s=gwt-google-apis&t=Visualization)。这一切看起来都非常有趣，并提供了我的应用程序需要的 AJAX 功能。我是新手，很迷茫。。。。

## 在哪里放置数据访问级别检查？

在 Web 应用程序中，用户对数据具有不同级别的访问权限。例如，不同数据的读/写权限的不同组合。当访问或修改任何数据时，应用程序会检查某种用户配置文件。用户将根据结果获得数据访问权限——拒绝查看访问权限或可以查看数据但无法更改数据等。我不确定在哪里进行此特定检查。我想我可以将它编码在**DAO 中**，每次处理数据操作时，根据配置文件手动检查查询的数据。或者，放在**业务逻辑/显示层**，如果用户没有数据访问权限，就拿离用户的按钮。还是**两者兼而有之**？**或者hibernate**中有没有配置文件**我可以在某个地方为所有映射的表指定数据访问权限？** 

 **## 传递信息的最佳实践

模型/视图/控制器之间非常需要通信，对 GWT 进行 RPC 调用，并将数据传递给可视化代码以呈现图表和其他内容。我猜它肯定需要某种将 Java 对象转换为 JSON 对象的**转换**器，以便进行 gwt-rpc 调用并使用 Visualization API 绘制图表。我对么？此外，就在 Struts 和 Hiberante 中传递信息而言——编写**数据传输对象**是个好主意吗？然后就一直传**豆子**？或者（我今天刚刚遇到这个......甚至不确定我是否理解正确）可能将对象绑定到**JNDI**上，并从程序的其他部分访问它们？

***任何输入/澄清将不胜感激。非常感谢你！***

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-07T02:23:12.063

**访问级别检查：**

我会将访问级别检查分离到它自己的类中，并让您的“控制器”在调用 DAO 之前先调用访问管理器。即，每个操作在执行DAO 调用以获取/插入数据之前执行检查。

但是，如果您使用 gwt，更好的方法是进行 RPC 调用而不是使用 struts 操作。rpc 调用成为我上面提到的“控制器”，并且可以使用我上面提到的管理器进行访问检查 - 即消除操作。

至于访问管理器，我建议枚举所有细粒度的访问权限，并将这些权限组合成一个可以与每个用户/配置文件/任何内容相关联的集合。

**在 gwt 上传递信息** 对于使用 hibernate 来说是一件痛苦的事情——你可以尝试使用[Gilead](http://gilead.sourceforge.net/)，但我没有取得太大的成功，它对我来说太麻烦了。您对 json 转换的想法是进入 gwt imho 的正确方法。gwt 1.5 支持所谓的 javascript 对象覆盖，它允许您返回 json，并直接将其“叠加”到 gwt java 对象中，而您只需要很少的代码。[查看这篇文章](http://googlewebtoolkit.blogspot.com/2008/08/getting-to-really-know-gwt-part-2.html)了解更多信息。

另一种方法是推出自己的 DTO 生成设施（这是 Gilead 的意思，但我认为它不会自动生成？不确定）。将其作为构建的一部分实施。如果它不是一个大项目，它的一些额外工作是不值得的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-06T03:01:08.743

关于您的第一个问题，我不能说太多，因为我真的不喜欢将 Struts 用于与 GWT 相关的任何事情。

至于你的第二个问题，不，你不应该使用任何 JSON。听起来您的后端是 Java，这意味着 GWT RPC 机制只能与 POJO 一起使用。因此，您只需创建绘图所需的对象并在客户端和服务器之间来回传递它们。GWT 将开箱即用地为您完成所有 RPC 工作。

编写数据传输对象可能是必要的，但前提是您的休眠模型文件包含 GWT 编译器无法理解的内容。我通常使用 EJB3 和 Stripes（而不是 Hibernate 和 Struts），在我的情况下，我不需要编写任何数据传输对象，我只需使用 EJB3 POJO 并在我的客户端和服务器之间传递它们。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-30T19:52:59.703

服务器端的数据访问级别检查是最安全的方法。但是 GWT 仍然会生成一个打包的 JS。您可以在客户端执行此操作。但在这种情况下，每次都应该从服务器端检查/获取用户配置文件。

传递信息：我在向量中使用分隔字符串。而且运行良好...

# java - Java：原始数据类型数组不自动装箱

> ID：517751
> 
> 赞同：31
> 
> 时间：2009-02-05T20:24:19.700
> 
> 标签：java, generics, autoboxing

我有这样的方法：

```
public static <T> boolean isMemberOf(T item, T[] set)
{
    for (T t : set) {
        if (t.equals(item)) {
            return true;
        }
    }
    return false;
} 
```

现在我尝试使用`char`for调用此方法`T`：

```
char ch = 'a';
char[] chars = new char[] { 'a', 'b', 'c' };
boolean member = isMemberOf(ch, chars); 
```

这行不通。我希望`char`and`char[]`自动装箱到`Character`and `Character[]`，但这似乎没有发生。

有什么见解吗？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-02-05T20:28:18.913

数组没有自动装箱，只有基元。我相信这是你的问题。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-05T20:30:07.503

为什么会`char[]`被装箱到`Character[]`？数组*始终*是引用类型，因此不需要装箱。

此外，这将是非常昂贵的——它将涉及创建一个新数组，然后依次装箱每个字符。哎呀！

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-02T22:57:19.420

您可以使用反射来获得适用于所有类型数组的方法，但是您会失去类型安全性，因此这可能不是您想要的。

```
import java.lang.reflect.Array
public static boolean isMemberOfArray(Object item, Object array)
{
    int n = Array.getLength(array)
    for (int i = 0; i < n; i++) {
        if (Array.get(array, i).equals(item)) {
            return true;
        }
    }
    return false;
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-13T08:19:01.453

正确，数组没有自动装箱（这会导致奇怪的情况`int[] ints; ...; Arrays.asList(ints)`- asList 返回一个包含单个对象的列表，即数组！）

这是一个装箱数组的简单实用程序。

```
public static Integer[] boxedArray(int[] array) {
    Integer[] result = new Integer[array.length];
    for (int i = 0; i < array.length; i++)
        result[i] = array[i];
    return result;
} 
```

当然，每种原始类型都需要不同的版本。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-05T20:33:52.957

这似乎是设计使然，既是为了避免如此昂贵的自动装箱操作，又是因为泛型必须向后兼容现有的 Java 字节码。

例如，请参阅[这篇文章](http://www.tomergabel.com/JavaLanguageCaveatAutoboxingAndGenerics.aspx)和[这个错误](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4487555)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-05T20:34:42.830

数组是一种低级实现类型的东西。`char[]`将是具有两字节字符的连续内存区域。`Character[]`将是具有四个或八字节引用的连续内存区域。你不能用 a`Character[]`来包装一个 char[]。但是 a`List<Character>`可以包装 a `char[]`。

除非您正在编写低级代码，否则引用数组通常不是一个好主意。如果您愿意，您可以编写或获得等效的`java.util.Arrays.asList`.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-08-02T07:54:40.823

正如其他人所提到的，基元数组没有自动装箱。如果要将方法与原始数组一起使用，则需要为每个原始类型提供重载。这似乎是类库中做事的标准方式。例如，参见[java.util.Arrays 中](http://java.sun.com/javase/6/docs/api/java/util/Arrays.html)的重载。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-11-14T10:21:12.217

首先，我会尽量避免使用数组，而是使用列表。

数组没有自动装箱，但可变参数有自动装箱。因此，如果您将方法声明为（具有相同的主体）：

```
public static <T> boolean isMemberOf(T item, T ... set) 
```

然后你可以写

```
isMemberOf('a', 'a', 'b', 'c'); 
```

就个人而言，我更喜欢使用 google 的 guava，你可以在其中编写类似的东西

```
char ch = 'a';
char[] chars = new char[] { 'a', 'b', 'c' };
boolean member = isMemberOf(ch, Chars.asList(chars).toArray(new Character[0])); 
```

您的代码可能只是一个示例，但如果您真的想测试成员资格，您可以这样做：

```
Chars.contains(chars, ch);

or

ImmutableSet.of('a', 'b', 'c').contains('a') 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-04-01T17:50:52.627

输入 Java 8 并让`primArray`成为 type 的标识符`PrimType[]`，然后您*可以*执行以下操作：
`BoxedType[] boxedArray = IntStream.range(0, primArray.length).mapToObj(i -> primArray[i]).toArray(BoxedType[] :: new);`

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-05T22:56:59.313

一个更简单的方法是

```
char ch = 'a';
String chars = "abc";
boolean member = chars.indexOf(ch) >= 0; 
```

# eclipse - 如何使用 Eclipse 重构工具并通过 Subclipse 与 SVN 保持同步？

> ID：517752
> 
> 赞同：12
> 
> 时间：2009-02-05T20:24:32.243
> 
> 标签：eclipse, svn, refactoring, subclipse

我发现当我需要重命名 Java 类（以及源文件）或需要更改包名称（因此移动源文件）时，我可以：

1.  使用漂亮而有用的 Eclipse 重构工具，这非常棒，因为所有级联任务都为我完成了。然而，我随后与 Subversion 进行了一场艰苦的斗争，以将更改复制回 repo。
2.  我可以先在 Subversion 中发出重命名/移动，更新我的本地，然后 Eclipse 中的重构工具不起作用。

任何人都可以建议一个更好的程序吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-06T00:49:08.027

从 1.4.x 版本开始，Subclipse 处理得很好。如果您有错误，请报告它们。在以前的版本中，它处理了一些情况，但没有处理其他情况。这是由于在 SVN 1.5 中修复的 Subversion 限制。例如，在 SVN 1.5 之前，如果重命名文件夹，则不能同时重命名文件夹中的文件（直到文件夹被提交）。这类事情都是非常常见的重构，SVN 会阻碍。

不过现在一切都很好。

标记

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-05T20:56:41.600

我讨厌走进来说“你做的很好”，但是由于您的主题行提到 Subclipse - Subclipse 与 Eclipse 的重构工具集成。颠覆性也是如此。当你重命名一个类时，它会在下面为你执行“svn mv”。您永远不需要尝试手动复制这些动作。

我想知道 Subclipse 是否由于某种原因没有附加到您的项目 - 如果它不知道您的项目是 Subversion 项目。那么显然它不会做任何事情。

如果你没有使用 Subclipse/Subversive... 开始。:)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-05T20:31:33.443

你试过[颠覆](http://www.eclipse.org/subversive/)吗？重构似乎对我来说很好用。

实际上，我也尝试过 subclipse，它似乎可以很好地处理它，至少在 1.4.7 版本中是这样。我只是尝试重命名一个包和一个类。Eclipse 将旧的标记为已删除并添加一个新的，计划添加到存储库中。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-05T20:33:30.320

[当您在 Eclipse 中重构时， Subclipse](http://subclipse.tigris.org/)将处理 svn 移动/重命名。

# asp.net-ajax - 我可以将数组传递给 .Net Ajax PageMethod 吗？

> ID：517754
> 
> 赞同：1
> 
> 时间：2009-02-05T20:25:10.493
> 
> 标签：asp.net-ajax, pagemethods

我正在使用.Net Ajax PageMethods。我希望我可以将一个 javascript 数组传递给我的方法，但我收到错误消息：“类型'System.Array'不支持数组的反序列化”。这是我正在做的简化版本：

客户端代码：

```
function AddItemsToBatch()
{
var stuff = new Array();
stuff[0] = "one thing";
stuff[1] = "some other thing";
PageMethods.AddToBatch(stuff,OnSuccess,OnFail);
} 
```

服务器端代码：

```
<Web.Services.WebMethod()> Public Shared Function AddToBatch(ByVal stuff as Array) as Boolean
  Return True
End Function 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T20:27:52.610

尝试使用像字符串或对象数组这样的集合。IIRC，System.Array 是抽象的。

# javascript - 在JavaScript中替换字符串中的一系列字符的最佳方法是什么

> ID：517765
> 
> 赞同：5
> 
> 时间：2009-02-05T20:27:33.233
> 
> 标签：javascript, regex

我正在努力提高一个函数的性能，该函数采用 XML 字符串并在返回字符串之前替换某些字符（编码）。该功能受到冲击，因此尽快运行非常重要。通常的情况是没有任何字符存在 - 所以我想特别优化它。正如您将在示例代码中看到的，要替换的字符串很短，而且相对较少。源字符串通常很短（例如 10-20 个字符），但可能更长（例如 200 个字符左右）。

到目前为止，我已经确保正则表达式是预编译的，并且我已经消除了降低操作速度的嵌套函数（此时部分毫秒很重要。）

```
var objXMLToString = new XMLToStringClass();
function XMLToStringClass(){
    this.tester= /\\34|\\39|\\62|\\60|\\13\\10|\\09|\\92|&amp/;
    this.replacements=[];
    var self=this;
    function init(){        
        var re = new regexReplacePair(/\\34/g,'"');
        self.replacements.push(re);
        re = new regexReplacePair(/\\39/g,"'");
        self.replacements.push(re);
        re = new regexReplacePair(/\\62/g,">");
        self.replacements.push(re);
        re = new regexReplacePair(/\\60/g,"<");
        self.replacements.push(re);
        re = new regexReplacePair(/\\13\\10/g,"\n");
        self.replacements.push(re);
        re = new regexReplacePair(/\\09/g,"\t");
        self.replacements.push(re);
        re = new regexReplacePair(/\\92/g,"\\");
        self.replacements.push(re);
        re = new regexReplacePair(/\&amp;/g,"&");       
        self.replacements.push(re);     
    }
    init();
}

function regexReplacePair(regex,replacementString){
    this.regex = regex;
    this.replacement = replacementString;
}

String.prototype.XMLToString = function() {
        newString=this;
        if(objXMLToString.tester.test(this)){
            for (var x = 0;x<objXMLToString.replacements.length;x++){
                newString=newString.replace(objXMLToString.replacements[x].regex,objXMLToString.replacements[x].replacement);
            }
            return newString;
        }
        return this;
} 
```

*   在这种情况下， `String.replace`功能是否可能会更好？
*   目前，如果单个字符匹配，我将替换所有字符 - 测试然后有条件地替换是否可能会更好？如果是这样，可能`indexOf`比这个数据集的正则表达式更快？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-05T20:53:05.617

您可以使用哈希查找：

```
str.replace(
    /(\\34|\\39|\\62|\\60|\\13\\10|\\09|\\92|&amp)/g,
    function () {
        return {
            "\\34": "\"",
            "\\39": "'",
            //...
            "&amp": "&"
        }[arguments(1)];
    }
); 
```

或者你坚持扩展原型：

```
var hash = {
    "\\34": "\"",
    "\\39": "'",
    //...
    "&amp": "&"
};

String.prototype.XMLToString = function () {
    return this.replace(
        /(\\34|\\39|\\62|\\60|\\13\\10|\\09|\\92|&amp)/g,
        function () { return hash[arguments(1)]; }
    }
); 
```

这可能会更快（需要基准测试）：

```
String.prototype.XMLToString = function () {
    var s = this;

    for (var r in hash) {
        s = s.split(r).join(hash[r]);
    }

    return s;
); 
```

* * *

## 更新

您可以从哈希生成您的正则表达式：

```
var arr = [];

for (var r in hash) {
    arr.push(r);
}

var re = new RegExp("(" + arr.join("|") + ")", "g"); 
```

然后将其用作：

```
s = s.replace(re, function () { ... }); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-06T05:01:47.813

我已经对您的原始版本、Ates Gorals 哈希、我改进的哈希、使用 switch 的版本和简单的解决方案进行了基准测试。赢家？简单的解决方案！

具有匹配数据（85 个字符的字符串）

```
 original  simple  hash  switch  ag-hash
FF3          194     188   250     240     424
IE7          188     172   641     906    2203
Chrome1      161     156   165     165     225
Opera9       640     625   531     515     734 
```

使用不匹配的数据（85 个字符的字符串）：

```
 original  simple  hash  switch  ag-hash
FF3           39       4    34      34      39
IE7          125      15   125     125     156
Chrome1       45       2    54      54      57
Opera9       156      15   156     156     156 
```

（在我的 windows xp 笔记本电脑上测试，1.7GHz，ymmv）

简单的解决方案：

```
function XMLToString(str) {
    return (str.indexOf("\\")<0 && str.indexOf("&")<0) ? str :
    str
    .replace(/\\34/g,'"')
    .replace(/\\39/g,"'")
    .replace(/\\62/g,">")
    .replace(/\\60/g,"<")
    .replace(/\\13\\10/g,"\n")
    .replace(/\\09/g,"\t")
    .replace(/\\92/g,"\\")
    .replace(/\&amp;/g,"&");               
} 
```

解释：

首先检查是否有反斜杠或 & 符号（在所有浏览器中使用 indexOf 而不是正则表达式更快）。如果没有字符串，则原样返回，否则执行所有替换。在这种情况下，缓存正则表达式并没有什么区别。我尝试了两个数组，一个使用正则表达式，一个使用替换，但这并没有太大的区别。

在您的原始版本中，您对所有组合进行了测试，只是为了检测您是否应该进行替换。这很昂贵，因为正则表达式引擎必须将每个位置与每个组合进行比较。我简化了它。

我改进了 Ates Gorals，将哈希对象移到了外部（因此它不会在每次调用内部函数时创建和丢弃），将内部函数移到外部以便可以重用而不是丢弃它。

*更新 1*修正：在 & 号测试中移动了一个括号。

**更新 2**

您的一条评论让我相信您自己对字符串进行了编码，如果是这种情况，我建议您将编码切换为标准编码，这样您就可以使用内置函数。

不要使用“\dd”，其中 dd 是十进制数，而是使用“%xx”，其中 xx 是十六进制数。然后您可以使用更快的内置 decodeURIComponent 并且可以解码任何字符，包括 unicode。

```
 matching    non match
FF3          44           3
IE7          93          16
Chrome1     132           1
Opera9      109          16 
```

.

```
function XMLToString_S1(str) {
    return (str.indexOf("%")<0) ? str : decodeURIComponent(str).replace(/\x0D\x0A/g,"\n")
} 
```

因此，不是有一个像“\09test \60\34string\34\62\13\10\”这样的字符串，而是一个像“%09test %3c%22string%22%3e%0d%0a”这样的字符串。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-05T20:53:36.177

这是我重构代码的尝试

*   使 objXMLToString 成为静态对象 - 不需要是可实例化的
*   摆脱了内部 init() 函数 - 改为使用数组文字
*   使用数组文字转换的 regexReplacePair 对象
*   将 for 循环转换为 while 循环（通常更快）
*   单返回点
*   作用域**newString**变量（现在它不再是全局的）

这是代码

```
var objXMLToString = {
     tester: /\\34|\\39|\\62|\\60|\\13\\10|\\09|\\92|&amp/
    ,replacements: [
         [/\\34/g,'"']
        ,[/\\39/g,"'"]
        ,[/\\62/g,">"]
        ,[/\\60/g,"<"]
        ,[/\\13\\10/g,"\n"]
        ,[/\\09/g,"\t"]
        ,[/\\92/g,"\\"]
        ,[/\&amp;/g,"&"]
    ]
}

String.prototype.XMLToString = function()
{
        var newString = this;
        if ( objXMLToString.tester.test( this ) )
        {
                var x = 0, replacer;
                while ( replacer = objXMLToString.replacements[x++] )
                {
                        newString = newString.replace( replacer[0], replacer[1] );
                }
        }
        return newString;
} 
```

# visual-studio - 另一种语言的 Visual Studio 2008 代码片段

> ID：517771
> 
> 赞同：6
> 
> 时间：2009-02-05T20:28:31.547
> 
> 标签：visual-studio, visual-studio-2008, fortran

有没有办法为另一种语言定义代码片段，而不是 VS 2008 中的默认语言（C#、VB ...）？我在 Visual Studio 中使用 Intel 的 fortran 编译器，除了代码片段部分之外，它的集成非常完整。我以为我在 msdn 上的某个地方读到你不能为其他语言定义新的。

所以如果有人能证明我不是这样，我会很高兴。

任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T21:19:27.640

查看这篇关于 VS 和代码片段的文章。它是为 VS2005 编写的，但与 VS2008 相同。

[代码片段](http://aspnet.4guysfromrolla.com/articles/122105-1.aspx)

您应该能够将其与 fortran 一起使用，因为您在用于片段的 xml 文件中指定了代码语言。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-09T02:06:45.247

语言的代码片段支持由语言服务确定。英特尔 Fortran 包不支持代码片段，并且不能由其他任何人添加（通过插件或第 3 方包）。

管理代码片段支持的注册表项是 HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VisualStudio\9.0\Languages\CodeExpansions。您会注意到此键下方有 Basic、CSharp 和 XML 的子键（如果您有其他支持代码片段的语言服务，可能会更多），但没有 Fortran 的子键。

您唯一能做的就是向英特尔提出功能请求，也许他们会在几年内添加代码片段支持。

# c# - 在整个代码库中重构“使用”指令？

> ID：517780
> 
> 赞同：3
> 
> 时间：2009-02-05T20:30:28.690
> 
> 标签：c#, visual-studio-2008, refactoring, using-directives

我喜欢 Visual Studio 2008 的一件事是能够重构和重新组织源代码文件中的“使用”指令（这可能也是在 2005 年，我不记得了）。

具体来说，我说的是如何让它既将指令重新组织为按字母顺序排列（尽管核心 FCL 库浮动到顶部）并删除任何不需要的指令（从未使用过或不再用过的）。

有没有办法在整个旧代码库中自动进行这种重构（排序和修剪）？通过解决方案中的所有文件或跨多个解决方案文件。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-05T20:32:43.787

我相信您可以使用[Power Commands在解决方案范围内完成它](http://code.msdn.microsoft.com/PowerCommands)

来自 PowerCommands 文档：

> 删除和排序 Usings 此命令删除和排序给定项目的所有类的 using 语句。例如，在删除或组织向导生成的 using 语句时，它很有用。可以从解决方案节点或单个项目节点执行此命令。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-05T20:39:24.240

[ReSharper](http://www.jetbrains.com/resharper)是一个（商业）Visual Studio 插件，具有“代码清理”实用程序，可以在解决方案范围内运行。该实用程序检测并删除未引用的 using 语句，并执行其他有用的维护。但是，我不确定它是否提供对它们进行排序的功能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T20:42:20.960

使用 Visual Studio '08 的 PowerCommands 插件。您可以在解决方案资源管理器中右键单击解决方案，然后选择“删除和排序”使用。此外，Tools-->Options 对话框（向下滚动到 Power Commands 项）中有一些选项可用于在保存时删除并在保存时重新格式化代码（使用 vs 设置）。

# cocoa - 如何使用 NSMutableArray 作为队列？

> ID：517781
> 
> 赞同：2
> 
> 时间：2009-02-05T20:31:13.383
> 
> 标签：cocoa

我有 NSMutableArray 并像队列一样使用它来等待操作。

数组中的示例：

0：“做某事”
1：“做其他事”
2：“做某事 2”

当我使用`[myarray removeObjectAtIndex:0]`数组时没有重新排序，下次我使用`[myarray objectAtIndex:o]`结果是`nil`.

当我删除“做某事”时，如何将“做其他事情”放在第一个索引中，将“做某事 2”放在第二个索引中？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-05T20:47:12.463

```
/* gcc -framework Cocoa myprogram.m -o myprogram */

#import <Cocoa/Cocoa.h>

int main( int argc, char **argv )
{
  NSMutableArray *array = [ [ NSMutableArray alloc ] 
                           initWithObjects: @"1", @"2", @"3",
                                            nil ]; /* don't forget nil */

  /* "pop" the first object */
  [ array removeObjectAtIndex:0 ];

  /* prints "2" as expected */
  NSLog( @"%@", [ array objectAtIndex: 0 ] );
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-06T11:57:36.633

我通常以相反的顺序处理队列，但效果是一样的：

```
// somewhere in your code you insert into the queue (always at index 0)
[myArray insertObject:anObject atIndex:0]; 
```

然后，在其他地方，您从队列中读取：

```
// Process elements in the queue in a FIFO manner
while ([myArray count])
{
    id object = [myArray lastObject];

    // do something with object

    [myArray removeObjectAtIndex:[myArray count] - 1];
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-05T20:39:31.417

NSArray 已经按照你想要的方式运行，实际上不能包含 nil。听起来您的数组可能会以某种方式设置为零。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T20:43:40.923

我假设您在迭代时没有删除...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-09T02:30:27.300

> 当我使用 [myarray removeObjectAtIndex:0] 时，数组没有重新排序，下次我使用 [myarray objectAtIndex:o] 时，结果为零。

你的问题似乎是你有一个小写 O 而不是数字 0

# css - CSS Div，需要它在 Firefox 和 Safari 中工作

> ID：517794
> 
> 赞同：0
> 
> 时间：2009-02-05T20:34:11.630
> 
> 标签：css

我有一个网页和文件在最新版本的 IE 中显示良好。需要它在最新版本的 Firefox 和 Safari 中显示相同。

网页和支持文件已存档以供审查。我将粘贴下面的页面，然后是 CSS。用图像更容易看到。

### HTML

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Untitled Document</title>
<link href="styles.css" rel="stylesheet" type="text/css" />
</head>

<body>
<div id="top"><img src="top.jpg" width="800" height="115" /></div>
<div id="wrap">
  <div id="left">
    <div id="left_top">
      <div id="left_grey">
        <h1 class="lb_blk_hdr">Water. Pure and Simple</h1>
        <p class="text">United Distributors, Inc. is the region’s top   provider of Water Treatment Solutions and Supplies. For over 30 years, you have   trusted us to provide the latest in <a href="brandpg.html" target="_self" class="text">water treatment</a> technology and related products. We have met   your needs through a broad range of products that provide you the purest of   water for use in your <a href="home_solutions.html" target="_self" class="text">Home</a>, <a href="office.html" target="_self" class="text">Office</a>, <a href="food_service.html" target="_self" class="text">Restaurant /Food Service</a> and <a href="medical.html" target="_self" class="text">Medical Facilities</a> and <a href="commercial_ind.html" target="_self" class="text">Commercial/Industrial   facilities</a>. </p>
        <p class="text">Call us today. With over 80 years combined   experience, our Certified Staff can be called upon to share their experience and   expertise with you. At United Distributors we not only provide you with water   solutions, our Certified Staff accurately installs your treatment equipment and   ensures your system is maintained for the highest level of quality   water.</p>
        <p class="text">Let us help you enjoy the healthy benefits of   safe, pure water.</p>
        <h1 class="lb_blk_hdr">Our Promise to You...</h1>
        <p class="text">We are committed to market   innovative and creative <a href="brandpg.html" target="_self" class="text">water   treatment</a> and water related products to meet and fulfill your needs. We’ll   provide you with experienced and educated service professionals who proudly   represent our company, products, business associates and community. </p>
      </div>
    </div>
    <div id="left_bot">
      <p><span class="lg_blue_hdr">Our Guarantee</span></p>
      <p class="text"> United Distributors, Inc. guarantees your   customer satisfaction. Our water treatment solutions are manufactured by some of   the most trusted companies in the water treatment industry.</p>
    </div>
  </div>
  <div id="right">
    <div id="fla"><img src="fla.gif" width="430" height="380" /></div>
    <div id="right_bot"><img src="bbb_logos.gif" width="430" height="160" vspace="50" /></div>
  </div>
  <div id="bottom">Content for  id "bottom" Goes HereHereContent for  id "left_bot" Goes HereContent for  id "left_bot" Goes HereContent for  id "left_bot" Goes Here </div>
</div>
</body>
</html> 
```

### CSS

```
@charset "utf-8";
body {
    background: #EEEEE4;
}
.lg_blue_hdr {
    font-family: Verdana, Arial, Helvetica, sans-serif;
    font-size: 15px;
    font-weight: bold;
    color: #000066;
    line-height: 10px;
}
.lb_blk_hdr {
    font-family: Verdana, Arial, Helvetica, sans-serif;
    font-size: 15px;
    font-weight: bold;
    color: #000000;
    line-height: 10px;
}
.text {
    font-family: Verdana, Arial, Helvetica, sans-serif;
    font-size: 12px;
    line-height: 17px;
    color: #000000;
}
a.text:link {
    font-family: Verdana, Arial, Helvetica, sans-serif;
    font-size: 12px;
    font-weight: bold;
    color: #003366;
    text-decoration: underline;
}
a.text:hover {
    font-family: Verdana, Arial, Helvetica, sans-serif;
    font-size: 12px;
    font-weight: bold;
    color: #009900;
    text-decoration: underline;
}

#wrap {
    background: url(blue_white_bkgd.gif) repeat-y 50% 0%;
    margin: 0px auto auto;
    padding: 0px;
    width: 800px;
}
#top {
    margin: 0px auto;
    padding: 0px;
    width: 800px;
}
#left {
    margin: 0px;
    padding: 0px;
    float: left;
    width: 370px;
    background: url(none);
}
#left_top {
    background: D9DAD5 repeat-y 50% 0%;
    margin: 0px;
    padding: 0px;
    width: 370px;
}
#left_grey {
    background: #D9DAD5;
    margin: 0px;
    padding: 15px;
    width: 340px;
}
#left_bot {
    margin: 0px;
    padding: 15px;
    width: 340px;
}

#right {
    margin: 0px;
    padding: 0px;
    float: right;
    width: 430px;
}
#bottom {
    background: #000000;
    float: left;
    width: 770px;
    margin: 0px;
    padding: 15px;
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-05T20:40:50.713

如果您可以将我们指向该页面的实时版本，那将有很大帮助。有很多因素会影响页面在浏览器中的显示（标准或怪癖渲染模式、文档类型、有效/无效的 HTML 和 CSS 等）

就目前而言，您的问题中没有足够的信息来让人们准确地查明您的问题的根源。

此外，请记住 Firefox 和 Safari 最有可能“正确”呈现您的页面。但是因为您一直在为 IE 编写代码，所以您可能已经编写了 CSS 以使其在 IE 中看起来不错，而牺牲了符合标准的浏览器。

编辑：使用上面格式正确的代码，我对您的代码进行了一些重构。在编写 HTML 时，它被认为是一种最佳实践，使用描述它的内容`class`的`id`属性，而不是它的外观。所以“标题”而不是“顶部”和“内容”而不是左边。

这个更简单的代码也应该更容易调试。

HTML：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Untitled Document</title>
<link href="styles.css" rel="stylesheet" type="text/css" />
</head>

<body>
<div id="header"><img src="top.jpg" width="800" height="115" /></div>
<div id="wrap">
  <div id="content">
    <div id="left_top">
      <h2>Water. Pure and Simple</h2>
      <p>United Distributors, Inc. is the region’s top   provider of Water Treatment Solutions and Supplies. For over 30 years, you have   trusted us to provide the latest in <a href="brandpg.html" target="_self">water treatment</a> technology and related products. We have met   your needs through a broad range of products that provide you the purest of   water for use in your <a href="home_solutions.html" target="_self">Home</a>, <a href="office.html" target="_self">Office</a>, <a href="food_service.html" target="_self">Restaurant /Food Service</a> and <a href="medical.html" target="_self">Medical Facilities</a> and <a href="commercial_ind.html" target="_self">Commercial/Industrial   facilities</a>. </p>
      <p>Call us today. With over 80 years combined experience, our Certified Staff can be called upon to share their experience and expertise with you. At United Distributors we not only provide you with water solutions, our Certified Staff accurately installs your treatment equipment and ensures your system is maintained for the highest level of quality water.</p>
      <p>Let us help you enjoy the healthy benefits of safe, pure water.</p>

      <h2>Our Promise to You...</h2>
      <p>We are committed to market innovative and creative <a href="brandpg.html" target="_self">water treatment</a> and water related products to meet and fulfill your needs. We’ll provide you with experienced and educated service professionals who proudly represent our company, products, business associates and community. </p>
    </div>
    <div id="left_bot">
      <h2 class="blue">Our Guarantee</h2>
      <p> United Distributors, Inc. guarantees your customer satisfaction. Our water treatment solutions are manufactured by some of the most trusted companies in the water treatment industry.</p>
    </div>
  </div>
  <div id="images">
    <img src="fla.gif" width="430" height="380" />
    <img src="bbb_logos.gif" width="430" height="160" vspace="50" />
  </div>
  <div id="footer">Content for  id "bottom" Goes HereHereContent for  id "left_bot" Goes HereContent for  id "left_bot" Goes HereContent for  id "left_bot" Goes Here </div>
</div>
</body>
</html> 
```

CSS：

```
@charset "utf-8";

body {
    background-color: #EEEEE4;
    font-family: Verdana, Arial, Helvetica, sans-serif;
    font-size: 12px;
    line-height: 17px;
    color: #000000;
}
h2 {
    font-size: 15px;
    line-height: 10px;
}
h2.blue {
    color: #000066;
}
a:link {
    font-size: 12px;
    font-weight: bold;
    color: #003366;
    text-decoration: underline;
}
a:hover {
    font-size: 12px;
    font-weight: bold;
    color: #009900;
    text-decoration: underline;
}

#wrap {
    background: url(blue_white_bkgd.gif) repeat-y 50% 0%;
    margin: 0px auto;
    padding: 0px;
    width: 800px;
}
#header {
    margin: 0px auto;
    padding: 0px;
    width: 800px;
}
#content {
    margin: 0px;
    padding: 0px;
    float: left;
    width: 370px;
    background: url(none);
}
#left_top {
    background: #D9DAD5;
    margin: 0px;
    padding: 15px;
    width: 340px;
}
#left_bot {
    margin: 0px;
    padding: 15px;
    width: 340px;
}

#right {
    margin: 0px;
    padding: 0px;
    float: right;
    width: 430px;
}
#footer {
    clear: both;
    background: #000000;
    width: 770px;
    margin: 0px;
    padding: 15px;
    color: white;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-06T01:54:16.087

我创建了一个 HTML 文件，添加了 CSS，并创建了虚拟图像来替换应该存在的图像。这是覆盖在 IE 7 上的 Mac Firefox 3.0.6 的屏幕截图：

[http://s622.photobucket.com/albums/tt302/ellen898945/?action=view¤t=Firefox_IE.png](http://s622.photobucket.com/albums/tt302/ellen898945/?action=view&current=Firefox_IE.png)

该文件在我看来几乎完全相同，使用您发送的代码，减去一些文本呈现差异。您能否更好地描述您遇到的问题，或提供视觉示例？您没有使用任何特别棘手的 CSS，或者在任何主要浏览器上都支持不佳的 CSS；我很难理解你的担忧是什么。

通常，您必须接受您无法完全控制您发送的页面。您可能有一个用户将其文本大小设置为大于或小于默认值，或者始终将页面背景设置为白色并忽略您的颜色。如果在不同操作系统上的不同浏览器中渲染偏离了几个像素，这没什么大不了的。实际上，没有用户会 (a) 在两个不同的 Web 浏览器中并排打开同一个页面 (b) 注意到它们有一点点不同和 (c) 关心。

# php - 这个ajax（带有原型）有什么问题？

> ID：517799
> 
> 赞同：1
> 
> 时间：2009-02-05T20:35:18.617
> 
> 标签：php, javascript, ajax, prototypejs

您好，我有下一个代码： php 方面：

```
<?php
print_r($_POST);
print_r($_GET);
die();
?> 
```

在 JavaScript 中：

```
voteAjax = function(typez, actionz, idz){
    new Ajax.Request(
        'http://localhost/reporeade/Vote/Ajax/?rand='+Math.random()*500000, 
        {asynchronous:true, 
         evalScripts:true,
         method:'post',
         parameters:'contentType='+typez+'&action='+actionz+'&id='+idz 
        });
    return false; 
} 
```

在我的 html 的某些部分：

```
<a class="button" onclick="voteAjax('content','up','89');"> 
```

你可以看到我在本地主机上运行......我遇到的问题是 POST 有时会以某种方式混淆，我有 90% 的时间得到下一个答案：

```
Array
(
    [contentType] => content
    [action] => up
    [id] => 89
)

Array
(
    [rand] => 449701.9597706424
) 
```

而另外 10% 的时间我得到：

```
Array
(
)

Array
(
    [rand] => 468905.44804602925
) 
```

现在，我已经尝试了一切，更换了计算机，在具有完整 url 的服务器上尝试（认为 localhost 可能是问题所在），在某处使用[http://localhost/reporeade/Vote/Ajax/?rand=](http://localhost/reporeade/Vote/Ajax/?rand=) instade 阅读[http： //localhost/reporeade/Vote/Ajax?rand=](http://localhost/reporeade/Vote/Ajax?rand=)解决了这个问题，但都尝试了，但真的无法理解是什么让帖子丢失了......有什么想法吗？

**编辑：** 在玩完这一切之后，我让它在我们的生产服务器中工作（就像它一样），但在我们所有的 wamp 安装中它都不会工作（很可能会失败 50% 的时间）。解决这个问题对我来说真的很重要，这样我们就可以继续开发产品的所有 ajax 功能，所以......

*   我试过 xampp 但它与我们的框架不兼容
*   我尝试在 wamp 中使用 apache 2.0 而不是 2.2
*   我尝试了 httpd.conf 和 php.ini 的不同配置

关于为什么 wamp 会像这样失败的任何想法？

**更新：** 我确定问题是有时没有正确发送 POST 的 wamp 安装，任何有助于解决这个问题的帮助都会得到正确的答案和赏金！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T20:42:15.263

我建议安装 WireShark 并监控您的 HTTP 流量，看看您是否可以通过这种方式隔离问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-11T14:24:54.700

您是否尝试过另一个版本的原型？在我看来，在构建发布请求正文时存在一个奇怪的错误，有效地创建了服务器无法正确解析的无效（部分）请求。使用 Fiddler（易于掌握的 http 嗅探器）并查看发送到服务器的确切内容。

如果不是这种情况（我承认如果 Prototype 被破坏会很奇怪），尝试通过 PHP 读取原始帖子数据（应该在 php.ini 中启用）。如果可以并且它们没有填充到`$_POST`集合中，请尝试`$_REQUEST`。

另外，请尝试咨询以下线程，也许这是您的情况：[http](http://bugs.php.net/bug.php?id=41349) ://bugs.php.net/bug.php?id=41349 。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-15T18:51:49.440

这是一个很长的镜头，但是没有更多信息并且没有看到更多您的代码，我不得不问这个问题，以便您可以排除它：它是否与用户双击链接并创建两个快速请求有关？*（曾几何时，我被 <input type="image" onclick="submit();"> 都运行了 onclick 并提交了表单）*

```
function test() {
    voteAjax('content','up','89');
    voteAjax('content','up','89');
} 
```

（让你的链接调用上面的测试函数）

通常，您希望使用异步连接，因为这不会锁定 UI，但是在这种情况下，您可以尝试同步以确保您当时只执行一个请求。（非阻塞解决方案是在处理请求时设置标志或禁用链接/按钮）

顺便说一句，我也建议您发送一个对象而不是字符串作为参数，因为原型将对其进行 URIEncode 并将所有 & 放在正确的位置。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T20:46:22.963

如果它是一个 POST 请求，您不需要设置 rand 参数，则 POST 不会被缓存，也许这会有所帮助。

**编辑**如果不详细查看更多代码，就无法真正理解造成这种情况的原因。我会做的是：

1）尝试将对象传递给`parameters`属性，如下所示：

```
parameters: {
    contentType, typez,
    action: actionz,
    id: idz
} 
```

而不是字符串：

```
parameters:'contentType='+typez+'&action='+actionz+'&id='+idz 
```

2）你为什么需要`evalScripts`？出于测试目的将其删除。

3）调试这个地狱，似乎问题在于使用Javascript发送的参数，所以使用Firebug`console.log()`更深入地调试它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-05T20:46:37.410

试试 new Date()，而不是随机的：

```
voteAjax = function(typez, actionz, idz){
    new Ajax.Request(
        'http://localhost/reporeade/Vote/Ajax/', 
        {asynchronous:true, 
         evalScripts:true,
         method:'post',
         parameters:'contentType='+typez+'&action='+actionz+'&id='+idz+'&now='+new Date() 
        });

    //alert("params" + typez.toString() + actionz.toString() + idz.toString());
    return false; 
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-11T14:15:49.683

试试这个：

```
voteAjax = function(typez, actionz, idz){
    new Ajax.Request(
        'http://localhost/reporeade/Vote/Ajax/', 
        {
           parameters: {
             contentType: typez,
             action: actionz,
             id: idz,
             rand: new Date()
           }
        });
    return false; 
} 
```

请注意，我已经删除了其他选项，因为它们不是必需的，因为它们是默认值:)

```
asynchronous:true, 
evalScripts:true,      -----> this one is "evalJS" not "evalScripts" :)
method:'post', 
```

你可以在这里看到它[http://www.prototypejs.org/api/ajax/options](http://www.prototypejs.org/api/ajax/options)

希望它有帮助！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-11T15:12:44.553

我也在运行 wampserver，所以我只是尝试了你的代码，但我无法重现这个问题——我总是得到 POST 值。我的安装是 Apache 2.2.8 和 PHP 5.2.6，我刚刚获取了最新的prototype.js。我的 wampserver 配置几乎是默认配置。

+1 提琴手和/或萤火虫。查看正在发送的原始标头可能会很有启发性！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-11T15:55:26.337

你使用的是什么浏览器？使用 FF 和 IE 时会失败？或者只有一个浏览器。

前段时间我读到了 IE 和 Apache gzip 模块问题。它仅发生在服务器响应非常快的本地安装上。但是你的情况是不同的。

正如其他人已经建议的那样，绝对值得尝试 WireShark。这并不难。至少你会知道哪一边有错误。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-13T06:29:43.090

也许请求通过的某些组件（Php、网络服务器、防火墙等）会因为您使用带有 GET 参数的 POST 请求而感到困惑。如果你省略了这个`?rand=...`部分，它会改变什么吗？

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-15T19:47:50.727

我还建议您应该通过 Wireshark 监控您的网络流量：

1.  在服务器或客户端上启动它。
2.  开始捕获您的网络接口。
3.  使用 AJAX 和
4.  当它失败时停止捕获并
5.  在 Wireshark 中输入 http 以帮助您找到请求。
6.  右键单击并选择“跟随 TCP 流”。

如果请求中的 POST 数据未显示，则与浏览器有关。您可以检查 HTTP 标头是否存在可能的错误（例如之前提到的与 IE 结合使用的 GZip）。

也许您的 WAMP 设置使用 Fast-CGI 或类似方法来调用 PHP，所以它没有使用 Apache 的实际 PHP 模块？有时，如果设置不正确，可能会导致此类错误。如果您不一定需要它，我建议切换到 PHP 模块或寻找可能的配置错误。

无论如何，它是什么 WAMP？预配置还是定制？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-11T14:00:33.277

如果您改用 GET 会发生什么。我的意思是，如果你也连接 URL 中的其他参数？像这样

```
voteAjax = function(typez, actionz, idz){
    new Ajax.Request(
        'http://localhost/reporeade/Vote/Ajax?'+'contentType='+typez+'&action='+actionz+'&id='+idz+'&now='+new Date(), 
        {asynchronous:true, 
         evalScripts:true,
         method:'post',
         parameters:'' 
        });
    return false; 
} 
```

我认为您可以使用GET。
希望这有帮助。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-15T21:29:17.393

我会像这样进行 Ajax 调用：

```
voteAjax = function(typez, actionz, idz){
    var rndVal = Math.random()*500000;

    new Ajax.Request( 'http://localhost/reporeade/Vote/Ajax/', {
         method:  'post',
         parameters: {contentType: typez, action: actionz, id: idz, rand: rndVal}, 
         onSuccess:  function(response) {
               //do stuff
         },
         onFailure:  function() {
               alert('Something went wrong.');
         }
        });
     return false;
  } 
```

# c# - 如何用属性替换样板代码？

> ID：517801
> 
> 赞同：0
> 
> 时间：2009-02-05T20:35:43.780
> 
> 标签：c#, attributes

我们的代码中到处都有这种模式：

```
using (ServiceAccess ws = new ServiceAccess())
{
//...
//code here to talk to webservice ws
//...
} 
```

如何将这个样板代码替换为需要与 Web 服务通信的函数的属性？（我回想起很久以前我在 Java 中使用 Hibernate 做一些事情的时候，并且有一些“Transation”注释你可以使用它会自动插入一些 try...catch 样板代码到函数中.) using {} 已经很不错了，但完全没有它会很好......拥有一个属性还有助于将函数记录为一个与 Web 服务对话的功能，而不是与之对话的功能。

编辑：AOP 能解决问题吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T20:42:13.547

看看spring.net 中的[方面](http://www.springframework.net/docs/1.2.0/reference/html/aop.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T20:44:12.717

您还可以查看[PostSharp](http://www.postsharp.org/)。我不会让你使用属性来实现方面，你可以用它来实现你想要的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T22:07:50.833

“方面”类型的东西......这是一种用您选择的代码装饰给定方法的方法。如果您想在调用您的方法之后进行处理，则方面以及代码必须能够访问服务。这也意味着您几乎无法控制服务类的生命周期。

在最近的一些代码中，我为我的类提供了一个上下文，通过它可以获得服务实例。它们提供给您可能通过的代表。任何处置都可以在您关闭后进行...

```
DateTime serverTime;
context.UseService<IInfoService>(s=>serverTime = s.GetTime()); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T20:39:14.443

我认为您能做的最好的事情就是创建一个快捷方式，将该代码作为片段插入。您不能通过属性将变量声明硬塞到方法中。或者换一种说法，属性只能告诉你关于代码的事情。他们不能更改代码本身。

# unit-testing - 如何确保开发人员对他们的代码进行单元测试

> ID：517813
> 
> 赞同：4
> 
> 时间：2009-02-05T20:39:48.780
> 
> 标签：unit-testing, tdd

您如何确保团队中的所有开发人员都在对他们的代码进行单元测试？代码覆盖率指标是我能想到的客观衡量这一点的唯一方法。还有其他方法吗？

（当然，如果您真的在遵循 TDD，那么这应该不是问题。但是我们假设您有一些开发人员还没有完全“获得” TDD。）

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-05T20:48:20.790

这可能是一个社会问题，而不是技术问题。首先，您是否想要导致 100% 代码覆盖率的单元测试，或者您可以接受更少，并相信您的开发人员将单元测试放在他们真正重要且有意义的地方。您可能会得到某种系统来进行代码覆盖测试，以确保单元测试覆盖一定比例的代码。但是，仍然会有办法玩弄这个系统。而且它仍然不会产生没有错误的代码。由于诸如停止问题之类的问题，不可能覆盖代码中的任何路径。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-05T20:42:13.627

在构建过程中自动运行测试覆盖率报告。我们使用 CruiseControl 执行此操作。否则，您必须实际检查测试结果报告中测试的内容。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-05T20:50:23.173

几乎可以肯定，代码覆盖工具优于任何你能想到的临时方法。这就是它们存在的原因。

即使是获得 TDD 的开发人员也远不能免受覆盖差距的影响。通常，修复错误的代码会破坏横向测试或创建原始开发人员没有预料到并且维护开发人员没有意识到是新的分支。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-05T20:55:04.037

编写测试的一个好方法是增加责任感。如果开发人员必须向其他人解释他们不编写单元测试的确切*原因*，他们更有可能这样做。我工作过的大多数公司都要求在提交之前对主干的任何提议提交都由另一个开发人员进行审查，并且审查者的姓名必须包含在提交评论中。在这种环境下，您可以告诉您的团队，除非进行了单元测试，否则他们不应允许代码“通过”同行代码审查。

现在你有一个责任链。如果开发人员在提交代码时没有指定审阅者，您可以询问他们是谁审阅了代码（而且，正如我在艰难中学到的那样，当被问到这个问题时，不得不对您的老板说“nobody”并不好玩！）。如果您确实意识到在没有单元测试的情况下提交代码，您可以询问开发人员*和*代码审阅者为什么不包括单元测试。被问到这个问题的可能性鼓励代码审查者坚持单元测试。

您可以采取的另一个步骤是在您的版本控制系统中安装一个提交挂钩，该挂钩会在提交时向整个团队发送电子邮件，以及构成提交的文件甚至代码。这提供了高度的透明度，并进一步鼓励开发人员“遵守规则”。当然，这只有在扩展到您的团队每天所做的提交数量时才有效。

这更像是一种心理解决方案，而不是技术解决方案，但它在管理软件团队时对我来说效果很好。它也比另一个答案中建议的橡胶软管温和一些。:-)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-05T20:43:55.933

在这里，我们只有一个测试文件夹，其包结构反映了实际代码。要签入一个类，策略规定它必须有一个随附的测试类，并附有关于每个方法需要测试哪些/如何测试的特定准则。（示例：我们不需要测试纯 getter 和 setter）

快速浏览测试文件夹会显示课程何时丢失，并且可以用橡胶软管（或任何取决于您的政策）殴打违规者。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-05T20:44:06.570

进入并更改一个随机变量或在某处传递一个空值，您应该会看到一堆红色。=D

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-05T20:59:33.763

一种方法是编写一个脚本，搜索所有签入的术语“test”或“testfixture”（显然取决于您的环境）。如果有一个提交日志或一封电子邮件发送给经理，详细说明所做的更改，那么使用您最喜欢的文本处理语言来扫描代码文件以查找单元测试的迹象将是微不足道的（`Assert`关键字可能是最好的赌注）。

如果没有单元测试，那么在下一次代码审查期间，以最近签入的示例为例，并花十分钟讨论它可能“出错”的可能方式，以及单元测试如何发现错误快点。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-05T20:42:43.173

让他们定期提交一份报告或某种形式的单元测试结果的屏幕截图。他们可以伪造它（更有可能比实际进行测试花费更多时间）或实际进行。

最后，您将知道那些没有进行测试的人，他们将是那些有可能很容易被单元测试发现的错误的人。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-05T20:47:27.577

这个问题既是技术问题，也是社会问题。如果您的开发人员“还没有完全‘得到’ TDD”，那么帮助他们了解 TDD 的好处可能是一个更好的长期解决方案，而不是因为需要而“让”他们编写测试的技术措施。不情愿的开发人员可以轻松编写满足代码覆盖标准但不是有价值的测试的测试。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-05T21:00:57.007

这里应该提到的一件事是，您需要一个系统来定期运行单元测试。它们应该是您的 checkin guantlet 或夜间构建系统的一部分。仅仅确保编写单元测试并不能确保您从中获得价值。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-06T07:55:36.777

和他们坐下来观察他们的所作所为。如果他们不进行单元测试，请轻轻提醒他们。

# javascript - 跨浏览器判断一个 DOM 事件是否被取消的方法

> ID：517825
> 
> 赞同：1
> 
> 时间：2009-02-05T20:43:11.860
> 
> 标签：javascript, dom, dom-events, dhtml

是否有来自 Javascript 事件处理程序的跨浏览器方式来确定事件是否已被先前的处理程序取消？IE 和其他浏览器（如 Chrome 等）具有`event.returnValue` 可以测试的属性，但 FireFox 似乎没有任何此类属性。

这是我正在谈论的场景的示例。你有一个像这样的表格：

```
<form id="test" name="test" onsubmit="return false;" /> 
```

`addEventListener`然后你在 Javascript 中用/将一个事件连接到它`attachEvent`（为简洁起见，省略了连接）。该事件需要知道链中之前的任何内容是否返回 false 或以其他方式取消它。IE版本是这样的：

```
function onSubmitHandler(e) {
    alert("event was cancelled prior to this handler: " + e.returnValue);
} 
```

这适用于 IE、Chrome 等，但当然不适用于 FireFox，因为它没有`event.returnValue`. 我已经在互联网上寻找任何其他方法来在 FireFox 中确定这一点，但一无所获。这个问题有没有不`onsubmit`直接设置表单属性的解决方案？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-05T21:09:37.283

我的理解是 event.returnValue 的主要用途是防止该事件的默认操作（即取消它）。例如，在像你上面这样的处理程序中：

```
function onSubmitHandler(e) {
    e.returnValue = false;
} 
```

IE 中的上述代码将阻止默认操作，阻止提交表单。根据[Gecko DOM Reference](https://developer.mozilla.org/en/DOM/event.preventDefault "Gecko DOM 参考")，Firefox 中的等效代码是：

```
e.preventDefault(); 
```

如果您想检查一个事件是否已被取消，并以跨浏览器的方式进行，是否可以选择使用[jQuery](http://jquery.com/ "jQuery")之类的库？使用 jQuery 将函数绑定到表单的 onsubmit 事件并让该处理程序调用 .preventDefault() 将在所有受支持的浏览器中完成相同的事情。此外，您可以使用 jQuery 事件对象的 .isDefaultPrevented() 方法来确定该事件是否已被取消，大概是通过 lhs = e.returnValue 完成您尝试的操作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T16:28:18.527

这是解决这个问题的方法。我希望有一种符合标准的干净方法，但似乎没有。

```
function onSubmitHandler()
{
    // only called if the other onsubmit handlers succeed
}

// hook in submit
var originalOnSubmit = form.onsubmit;

form.onsubmit = function(e)
{
    var ret;

    if (originalOnSubmit)
        ret = originalOnSubmit();

    if (ret != false)
    {
        return onSubmitHandler(e);
    }
}; 
```

# asp.net - 在 asp.net 中禁用复选框

> ID：517826
> 
> 赞同：0
> 
> 时间：2009-02-05T20:43:25.683
> 
> 标签：asp.net, javascript

我正在动态创建一个 CheckBox 并像这样设置 disabled 属性：

```
chk.Disabled = false. 
```

这将呈现以下 HTML：

```
<input type="checkbox" disabled="disabled" .../> 
```

单击复选框时，我有一个 JS 函数，它尝试通过执行以下操作来启用它：

```
//get reference to the checkbox
chk.disabled = false; 
```

这不起作用。有什么帮助吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T20:48:51.570

如果您的复选框被禁用，则不会调用您的 onclick

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T20:51:40.830

你想做的有点奇怪。您正在尝试通过单击复选框来启用复选框，该复选框从一开始就被禁用。因此，在实际启用复选框之前，不会注册 onclick。

试试下面看看我的意思。

```
<html>
<body>
    <input id="cb" type="checkbox" disabled="disabled" onclick="this.disabled=!this.disabled;" />
    <label for="cb">Click me</label>

    <input type="button" value="Click me instead!" onclick="cb.disabled=!cb.disabled;" />
</body>
</html> 
```

希望对您有所帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T20:50:18.120

您如何动态创建复选框？

请记住，ASP.NET 会更改您给它的复选框的名称，特别是如果您将它添加到后面的代码中。

您需要做的是向您的 JS 函数发送 clientId，这是 HTML 项目在渲染时将获得的 id。

# c# - Silverlight 中如何设置 FrameworkElement 的 Parent 属性？

> ID：517836
> 
> 赞同：4
> 
> 时间：2009-02-05T20:45:59.173
> 
> 标签：c#, .net, silverlight, silverlight-2.0

我已经编写了一个基于 Control 的自定义 Silverlight 控件。我有两个名为 Top 和 Bottom 的 DependencyProperties，它们都包含用于特定布局显示的子控件。然后我使用 ControlTemplate 将这两个控件排列到一个网格中，将一个放在第 0 行，另一个放在第 1 行。我遇到的问题是我似乎无法弄清楚如何让每个子控件的 Parent 属性指向我的自定义控件。当我在运行时检查每个控件时，每个控件的 Parent 属性为空。

这是一个简单的示例，但我认为您可以看到一般问题。我有许多更复杂的控件，它们都有这个问题。我知道我缺少一些魔法。如果 ContentControl 的 Content 属性设置为某个子项，它会以某种方式将该子项的父项设置为自身。

**编辑：**更多信息

在 WPF 中，可能会使用 AddVisualChild()、RemoveVisualChild()、AddLogicalChild()、RemoveLogicChild() 等函数来管理父/子关系，但这些函数在 Silverlight 中不可用。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-10T18:22:42.590

经过相当多的研究，我认为这是不可能的。我能够使用[VisualTreeHelper](http://msdn.microsoft.com/en-us/library/system.windows.media.visualtreehelper(VS.95).aspx)通过 Visual Tree 而不是 Logic Tree 进行递归来实现我的最终目标。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T20:52:42.373

Parent 属性不能是任意的，它反映了渲染时使用的控件的真正父级。

来自 MSDN：在元素已实例化但未附加到最终连接到页面级根元素或应用程序对象的任何逻辑树的情况下，Parent 可能是空引用（Visual Basic 中为 Nothing）。

...

更改元素的父级通常只能通过操作集合、使用专用的添加或删除方法或通过设置元素的内容属性来完成。

# javascript - javascript/jquery 泄漏和崩溃的浏览器

> ID：517839
> 
> 赞同：1
> 
> 时间：2009-02-05T20:46:38.390
> 
> 标签：javascript, jquery, debugging, memory-leaks

让我先说一下实际上是我的糟糕代码泄漏并导致浏览器崩溃，我只是想我最好从一开始就尽可能清楚地使用所使用的语言。

我在这里有一个测试页面，可以在[这里](http://www.hallofbrightcarvings.com/game/js/map.js)[找到](http://www.hallofbrightcarvings.com/game/grid)javascript 。我的问题是，当我尝试多次拖放任何一个红色块时，它会占用所有浏览器资源并使浏览器崩溃。我相当确定罪魁祸首是 Tracker() 对象中的以下函数，但我完全不知道如何调试它。

我目前最可能的罪魁祸首：

```
 function register_draggable(ob) {
      ob.config.jqId.draggable({cursor: 'move',
                              grid:[ob.config.size, ob.config.size],
                              containment: '#chessboard',
                              revert: 'invalid',
                              start: function() {
                                check_allowable_moves(ob.config.jqLocation,
                                                      ob.config.jqId,
                                                      ob);
                              },
                              stop: function() {
                                remove_allowable_moves();
                              }
                            });
  } 
```

如果有人可以快速浏览一下并就我应该寻找什么给我任何建议，那将不胜感激。

**解决方案** 原来`register_draggable()`是罪魁祸首。每次更新一块的位置并且同一对象上的所有这些可拖动对象都在做讨厌的事情时，我都会注册一个新的可拖动对象。目前，我现在明确地在创建新的可拖动对象之前销毁旧的可拖动对象。当前代码是

```
 function register_draggable(ob) {
    ob.config.jqId.draggable('destroy');
    ob.config.jqId.draggable({cursor: 'move',
                              grid:[ob.config.size, ob.config.size],
                              containment: '#chessboard',
                              revert: 'invalid',
                              start: function() {
                                check_allowable_moves(ob.config.jqLocation, 
                                                      ob.config.jqId, 
                                                      ob);
                              },
                              stop: function() {
                                remove_allowable_moves();
                              }
                            });
  } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T21:02:12.680

我认为这实际上不是您的问题，但您似乎对 register 和 check_allowable_moves 进行了额外的方法调用

```
return {
        register_map: function(ob) { map = ob; },
        register_piece: function(ob) {
          ob.config.tracker = this;
          register_draggable(ob);
        },
        register_draggable: function(ob) { register_draggable(ob); },
        check_allowable_moves: function(location, jqPiece, ob) { check_allowable_moves(location, jqPiece, ob); }
      } 
```

可以缩短为

```
return {
        register_map: function(ob) { map = ob; },
        register_piece: function(ob) {
          ob.config.tracker = this;
          register_draggable(ob);
        },
        register_draggable: register_draggable,
        check_allowable_moves: check_allowable_moves
      } 
```

## 还

您在这里进行双重查找：

```
function remove_allowable_moves() {
        $('.allowable').droppable('destroy');
        $('.allowable').removeClass('allowable');
      } 
```

应该

```
function remove_allowable_moves() {
        $('.allowable').droppable('destroy')
          .removeClass('allowable');
      } 
```

## 还

将 int 解析为浮点数的目的是什么？取下 parseFloat。

```
var x = parseInt(locs[1]);
var y = parseInt(locs[2]);
var x_min = parseFloat(x)-2;
var y_min = parseFloat(y)-2; 
```

## 最后

为什么要重新注册为可拖放的？如果您多次注册可拖动对象并且只将其销毁一次，这可能是罪魁祸首。

```
jqCell.droppable({ accept: '#'+jqPiece.attr('id'),
                  drop: function(ev, ui) {
                    ob.config.jqLocation = $(this);
                    register_draggable(ob);  // why this?
                  }
                }); 
```

## 其他想法

另一件事我不知道它是否会帮助您提高性能，但它可以清理您的代码。jquery 选择器允许使用逗号而不是

```
$('#coord-1-1').doStuff();
$('#coord-1-2').doStuff();
$('#coord-1-3').doStuff(); 
```

你可以做

```
$('#coord-1-1, #coord-1-2, #coord-1-3').doStuff(); 
```

所以你的循环只关心生成选择器字符串，然后你可以在整个集合上运行你的操作。

## IMO 更清洁的初始化

代替

```
var map = new Map('content');
var piece1 = new Piece(map);
var piece2 = new Piece(map);
var tracker = new Tracker;
tracker.register_map(map);
map.render();
piece1.render('coord-4-4', '1');
piece2.render('coord-1-1', '2');
tracker.register_piece(piece1);
tracker.register_piece(piece2); 
```

我倒要看看

```
$(document).ready(function() {
    $('#content').MapGame({
        pieces : { '1' : 'coord-4-4', '2' : 'coord-1-1' }
    });
}); 
```

现在实现它是您现在所拥有的一个延伸，但是在为 jQuery 构建组件时，我喜欢从一个简单的 init 开始并从它们开始工作。jQuery 的一大目标就是向用户隐藏所有垃圾，让他们轻松启动并实例化您的插件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T21:01:44.290

感觉就像一些事件处理程序被多次注册，但我不确定。（原因如下。）

* * *

这并不能回答问题，但是您绝对应该将尽可能多的代码放在外面，决`$(document).ready(…)`不能像现在这样将所有代码都放在那里。

我担心您的代码是如此不合格，以至于理解它的工作量太大。你能重组它吗（所有这些函数中的函数真的很难读。）并添加一些评论。

也许只有我一个人，但我觉得阅读和理解太难了。维护它肯定会是一场灾难。

# asp.net - ASP.NET 中的模拟和委托

> ID：517846
> 
> 赞同：4
> 
> 时间：2009-02-05T20:48:50.150
> 
> 标签：asp.net, impersonation

我在使用 ASP.NET 访问远程服务器上的文本文件时遇到问题。ASP.NET 1.1 应用程序在 Server 2003 上运行，使用模拟和请求者的 Windows 凭据。客户端、网络服务器和远程服务器都在同一个域中，用户有权访问文本文件。用户可以通过 UNC 共享从他们的机器上打开文本文件。当用户运行直接在服务器上登录的站点时，它工作正常。但是，当用户在他们的机器上尝试时，它不起作用。应如何设置模拟以使其正常工作？

编辑：该应用程序的其他功能工作正常，它只是访问不起作用的远程文件。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-05T21:10:14.413

听起来您遇到了多跳问题。使用集成身份验证时，您可以从浏览器向 IIS 进行身份验证。但是，您不能对域中的任何其他计算机进行身份验证。原因是使用标准凭据，他们无法验证您的身份。

* * *

我熟悉两种主要的解决方法：

1.  实施 Kerberos，这些证书允许您进行更高级的身份验证，并允许多个网络跃点。
2.  使用 LogonUser win32 api 重新模拟您的用户（需要密码）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T20:52:49.067

在 IIS 中，至少需要在应用程序文件夹上取消选中匿名和基本身份验证。您可能想要检查应用程序文件夹本身，而不仅仅是根文件夹。可能还有其他配置选项，但这是“唾手可得”的选项。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T21:03:46.640

作为测试，请在模拟标记中指定用户名和密码，以强制应用程序始终模拟为您知道有权访问该文件的用户。

如果应用程序现在可以访问文本文件，您就会知道这是将用户的凭据传输到服务器。

如果应用程序仍然无法访问文本文件，则凭据不是问题，而是存在服务器配置问题。

# c# - ContextMenuStrip 行为问题

> ID：517851
> 
> 赞同：1
> 
> 时间：2009-02-05T20:50:44.263
> 
> 标签：c#, contextmenustrip

我正在向表单动态添加标签，然后动态添加 ContextMenuStrip 控件。无论我是使用 label.ContextMenuStrip 属性来连接它们，还是手动将事件处理程序添加到标签以使其响应右键单击并显示上下文菜单，我都会得到奇怪的行为：

1) 菜单没有出现在鼠标指针旁边，它向下和向右偏移。它似乎与标签在其父控件（图片控件）中的位置有关，而不是与表单有关。

2）当我点击菜单以外的东西时，菜单不会消失。

有什么想法我在这里想念的吗？

谢谢，安迪

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-10T14:42:26.880

我解决了。首先，我将控件添加到标签控件集合中，将其更改为表单集合更正了定位问题。我从来没有弄清楚为什么菜单不会关闭。

最终，我通过将菜单的静态实例添加到表单来重组事物，然后将 label.ContextMenuStrip 属性连接到该静态实例。这种方法一切都很好。

我使用标签控件的标记将其标识为单击事件处理程序。

# java - 如何使用休眠注释将映射从实体映射到值？

> ID：517861
> 
> 赞同：1
> 
> 时间：2009-02-05T20:53:34.897
> 
> 标签：java, hibernate, annotations

我有 Shipment 和 Product 实体。每批货物包含任意数量的任意数量的产品。例如，一个货件有一个名为 products 的字段，它是一个 java.util.Map，其中键是要运输的产品，值是要运输的产品的实例数。

如何将其映射到带有休眠注释的数据库？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-10T15:06:26.353

这是你必须做的。该字段`map`属于`Shipment`该类，并将每个映射`Product`到发货的产品数量。

**除非您在类 Product 中正确定义不依赖于休眠生成的 id 的 equals 和 hashCode 方法，否则这将不起作用。[（或在这里](http://www.hibernate.org/109.html)阅读全文）。**

```
@CollectionOfElements(targetElement=Integer.class)
@MapKeyManyToMany(targetEntity=Product.class)
private Map<Product, Integer> map = new HashMap<Product, Integer>(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T23:15:21.430

这对我来说似乎有点奇怪，但如果我理解正确，您将需要一个具有以下特性的数据库模式：

*   一个有 id 的装运表
*   具有引用此 id 的外键的产品表

这是一种基本的关系，因为从发货方来看，这种关系是基本的一对多关系，当然反面是多对一关系。我可以给你一些例子，但实际上[休眠文档](http://www.hibernate.org/hib_docs/v3/reference/en-US/html/collections-mapping.html)（向下滚动到底部以获取地图示例）似乎已经涵盖了这一点。关于 xml 如何映射到注释的一些非常艰难的思考应该会让您度过难关。如果您尝试在纯 JPA 中执行此操作，则可能会遇到一些麻烦，因为链接的示例似乎使用了公式。

# .net - 允许/禁止 XHTML 标记/属性的成熟且强大的 .NET 类

> ID：517868
> 
> 赞同：3
> 
> 时间：2009-02-05T20:55:36.783
> 
> 标签：.net, string, xhtml

我需要一个可扩展的类来解析字符串并允许某些 XHTML 标记和属性。如果给定的字符串包含无效的标签，它们将被简单地编码以在输入时显示在页面上。我需要确保不会丢失任何用户输入。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T21:49:06.907

[HtmlAgilityPack](http://www.codeplex.com/htmlagilitypack)工作得很好，也可以处理格式不正确的 HTML 。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T20:58:20.317

由于 XHTML 是有效的 XML，您可以轻松地使用任何 XML 工具来处理它。您可以使用 XmlReader 实例来读取 XML 节点，然后当您遇到不想包含在输出中的标记时，只需将其包含在输出的 CDATA 部分中。

您也可以在这里使用 XSLT 转换，但我不知道它是否允许在 CDATA 部分中插入节点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-09T14:55:08.097

SGMLReader项目[对于](http://code.msdn.microsoft.com/SgmlReader)处理用户生成的标记也是非常有用的库。（所有模式不仅仅是 XHTML）

例如，将其用作第一阶段的“清理程序”来解析某人在文本框中输入的标记并将其转换为有效的 XML。

# ruby-on-rails - 迁移中没有自动增量选项的 id 字段

> ID：517869
> 
> 赞同：8
> 
> 时间：2009-02-05T20:55:41.273
> 
> 标签：ruby-on-rails

我有一个像这样的数据库迁移：

```
 class CreateParticipations < ActiveRecord::Migration
      def self.up
        create_table(:participations, :primary_key => 'Seat')  do |t|      
          t.integer :Seat
          t.string :Nickname
          t.string :Clan
          t.string :FirstName
          t.string :LastName
          t.string :Email
          t.boolean  :Payed

          t.timestamps
        end
      end

      def self.down
        drop_table :participations
      end
    end 
```

现在，使用自动增量创建座位。但是，我不希望那样。我想要它没有自动增量。我将在我的 Logic 中自己定义 Seat。

我一直在环顾四周，但找不到如何禁用 auto_increment。

我该怎么做呢？除了在 MySQL 中手动进行。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-06-08T20:51:57.877

作为记录，如果您绝对需要这样做（它不应该经常发生），这里是使用 Rails 迁移 DSL 执行非自动递增主键的方法：

```
create_table(:table_name, :id => false) do |t|
  t.integer :id, :options => 'PRIMARY KEY'
end 
```

无论如何，这对 MySQL 都有效，如果您的数据库使用不同的语法来指定主键，请将其替换为`:options => 'PRIMARY KEY'`任何内容。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-07-09T16:23:43.837

This question is 3 years old, but incase anyone is wondering 3 years later, like I was, all you do is "change_column" in the event the table is already created:

```
change_column(:table_name, :id, :integer, :null => false) 
```

This should work in Rails 2.x and 3.x.

O

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T21:16:33.340

您是否有理由不能使用 rails 的 id 键并手动添加名为 Seat 的索引？

我已经看到了一些 hack，只是为了让 rails 在非增量 pk 数据库上工作。我不认为这是一个选择。如果我记得，这就是 rails 访问其所有每行功能的方式。

老实说，您如何 - 绝对 - 您需要忽略轨道结构的效率略微提升？

我认为真正的答案是“你不能”。Activerecord 有一些它不会屈服的东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-04-16T06:23:31.243

并不是说这是一个好主意，但这是我为 SQLite3 所做的 - 只需用你的数据库适配器替换那个 SQLiteAdapter - 你可以通过调用 define_method 来做这个更简洁/简短

```
class AbstractAdapter
end

module ActiveRecord
  module ConnectionAdapters
    class SQLiteAdapter < AbstractAdapter
      def supports_autoincrement?
        false
      end
    end
  end
end

<then you migration> 
```

或者

```
class SomeMigration < ActiveRecord::Migration
  def change
    create_table :table do |t|
      ActiveRecord::ConnectionAdapters::SQLiteAdapter.send :define_method, :supports_autoincrement? do false end
      t.integer etc
    end
  end
end 
```

当然只需更改其他数据库的适配器

# testing - 测试：单元 vs. 集成 vs. 其他，分离的需要是什么？

> ID：517882
> 
> 赞同：10
> 
> 时间：2009-02-05T20:59:41.110
> 
> 标签：testing

对于这个问题[我是单元测试还是集成测试？](https://stackoverflow.com/questions/516572)我已经回答了，有点挑衅：[做你的测试，让其他人花时间研究分类学](https://stackoverflow.com/questions/516572/am-i-unit-testing-or-integration-testing/516588#516588)。

对我来说，不同级别的测试之间的区别在技术上毫无意义：经常使用相同的工具，需要相同的技能，要达到相同的目标：*消除软件故障*。同时，我可以理解大多数开发人员使用的传统工作流需要这种区别。我只是对传统的工作流程感到不自在。

因此，我的问题旨在更好地理解对我来说似乎存在争议的问题，并收集关于不同级别测试之间的这种分离是否相关的各种观点。

我的观点有错吗？是否存在其他不强调这种分离的工作流程（可能是敏捷方法）？你在这个问题上的经验是什么？

*精度*：我完全了解定义（对于那些不了解的人，请参阅[这个问题](https://stackoverflow.com/questions/437897)）。我想我不需要关于软件测试的课程。但是，如果您的答案需要，请随时提供一些背景信息。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-05T21:01:41.653

性能通常是我将“单元”测试与“功能”测试分开的原因。

单元测试组应该尽可能快地执行，并且能够在每次编译后运行。

功能测试组可能需要几分钟才能执行并在签入之前执行，可能每天或每隔一天执行，具体取决于正在实现的功能。

如果将所有测试组合在一起，我将在 checkin 之前运行任何测试，这会减慢我的整体开发速度。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-05T21:11:24.067

我必须同意@Alex B，因为在编写测试时需要区分单元测试和集成测试，以使单元测试尽可能快地运行，并且没有比测试被测代码所需的更多依赖项. 您希望单元测试运行得非常频繁，并且“集成”越多，运行的次数就越少。

为了使这更容易，单元测试通常（或应该）涉及模拟或伪造外部依赖项。集成测试故意留下这些依赖关系，因为这是集成测试的重点。您是否需要模拟/伪造每个外部依赖项？如果模拟/伪造的成本很高并且返回的值很低，我会说不一定，即使用依赖项不会显着增加测试的时间或复杂性。

不过，总的来说，我会说最好是务实而不是教条，但如果您的集成测试使频繁运行测试变得过于昂贵，请认识到差异并避免混合。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T21:04:51.897

我的世界的定义：

单元测试 - 测试代码的明显路径并提供预期的结果。

功能测试 - 彻底检查软件的定义，并在所有允许的范围内测试定义的每条路径。编写回归测试的好时机。

系统测试 - 在其系统环境中测试软件，相对于它自身。尽可能生成所有流程，探索每个内部组合，一夜之间运行一百万次，看看会发生什么。

集成测试——在典型的系统设置上运行它，看看其他软件是否与测试的软件发生冲突。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-01-29T11:29:09.787

当然，您的观点是错误的，至少在复杂产品方面是这样。

自动化测试的重点不是发现错误，而是指出问题所在的功能或模块。

如果工程师必须经常花费脑力资源来排除测试失败的问题——那么就有问题了。当然，集成测试中的失败可能很难处理，但如果所有模块都具有良好的单元测试覆盖率，那么这种情况就不会经常发生。

如果您遇到集成测试失败 - 在理想情况下，应该立即为相关模块（或系统的一部分）添加相应的（缺失的）单元测试，这将确认问题的确切位置。

但这就是原子弹的来源——并非所有系统都可以用单元测试正确覆盖。如果架构受到过度耦合或复杂依赖的影响——几乎不可能用单元测试正确覆盖功能，而且事实上——集成测试是唯一的方法（除了深度重构）。在这样的系统中，单元测试和集成测试之间确实没有太大区别。

# jboss - 关于 OSGI 问题的 ATG 标签库

> ID：517896
> 
> 赞同：0
> 
> 时间：2009-02-05T21:02:48.640
> 
> 标签：jboss, osgi, jsp-tags, jackrabbit, atg

我们目前正在创建一个需要在 SLING/OSGI 上使用 ATG 标签库的应用程序，我们已经创建了一个包含这些标签库的包并上传了它，当然这些标签库调用 ATG 类，所以我们使用 sling.properties 文件将它们包含在 bootdelegation 中.

sling.bootdelegation.simple=atg.nucleus sling.bootdelegation.class.atg.nucleus.Nucleus=atg.appassembly,\atg.appassembly.ant,\atg.appassembly.progress,\atg.appassembly.util,\ ... ETC...

首先我们得到这个错误：

org.apache.sling.api.scripting.ScriptEvaluationException: atg/taglib/dspjsp/ImportBeanTag at org.apache.sling.scripting.core.impl.DefaultSlingScript.call(DefaultSlingScript.java:163) at org.apache.sling.scripting .core.impl.DefaultSlingScript.eval(DefaultSlingScript.java:107) 在 org.apache.sling.scripting.core.impl.DefaultSlingScript.service(DefaultSlingScript.java:226) 在 org.apache.sling.engine.impl.request .RequestData.service(RequestData.java:465)

……

.... 引起：java.lang.NoClassDefFoundError: atg/taglib/dspjsp/ImportBeanTag 在 org.apache.jsp.apps.mygeometrixx.components.contenpage.center_jsp._jspx_meth_dsp_005fimportbean_005f0(center_jsp.java:177) 在 org.apache。 jsp.apps.mygeometrixx.components.contenpage.center_jsp._jspService(center_jsp.java:154) 在 org.apache.sling.scripting.jsp.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70) 在 javax.servlet。 http.HttpServlet.service(HttpServlet.java:810) 在

因此，我们将 atg.taglib.dspjsp 添加到要添加到 bootdelegation sling.properties 文件中的包中。

然后我们得到了这个错误：

org.apache.sling.api.scripting.ScriptEvaluationException: atg.taglib.dspjsp.ImportBeanTag at org.apache.sling.scripting.core.impl.DefaultSlingScript.call(DefaultSlingScript.java:163) at org.apache.sling.scripting .core.impl.DefaultSlingScript.eval(DefaultSlingScript.java:107) 在 org.apache.sling.scripting.core.impl.DefaultSlingScript.service(DefaultSlingScript.java:226) 在 org.apache.sling.engine.impl.request .RequestData.service(RequestData.java:465) ...

引起：java.lang.ClassCastException: atg.taglib.dspjsp.ImportBeanTag atg.apache.sling.scripting.jsp.jasper.runtime.TagHandlerPool.get(TagHandlerPool.java:125) at org.apache.jsp.apps。 mygeometrixx.components.contenpage.center_jsp._jspx_meth_dsp_005fimportbean_005f0(center_jsp.java:177) 在 org.apache.jsp.apps.mygeometrixx.components.contenpage.center_jsp._jspService(center_jsp.java:154) 在 org.apache.sling.scripting。 jsp.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70)

所有这些都在 JBOSS 上运行。

有没有办法避免导致强制转换异常的此类冲突？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-08-08T10:26:47.077

类转换异常通常表明该类在两个不同的地方可用（在您的情况下，可能是通过引导委托，也可能是通过导出此类的包）。这就是我首先要调查的。

此外，为了使事情更明确，我通常建议您不要使用引导委托，而是通过系统捆绑包明确导出这些包。这样，至少您可以更好地调试类的来源以及 OSGi 解析器如何“连接”事物。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-09T14:19:50.130

从 OSGi 框架外部加载 ATG 标记库时，您还必须确保从框架外部提供 JSP API。默认情况下，Sling 嵌入 JSP API（在 JSP 脚本包中）。

有多种方法可以将 JSP API 公开到框架中。一种是将它们添加到 sling.properties 文件中的系统包中：

```
sling.system.packages.atg_jsp = javax.servlet.jsp;javax.servlet.jsp.el; \
 javax.servlet.jsp.resources;javax.servlet.jsp.tagext;version=2.1.0 
```

# sql-server - 我可以在 USB 驱动器上安装 SQL Server 吗？

> ID：517901
> 
> 赞同：5
> 
> 时间：2009-02-05T21:05:30.397
> 
> 标签：sql-server, usb, portable-database

我是一名开发人员，我经常在可能的时候远程工作，而不是通勤上班。我希望能够随身携带开发数据库环境。我知道我可以远程访问数据库，但是速度很慢。我有时会在没有无线连接的地方工作。有任何想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-05T21:07:47.210

您可以将*数据文件*存储在外部驱动器上。但是，服务器软件本身，我会天真地安装在您使用的每台机器上。

此方法假定您的数据库很小，或者您不太关心性能。

对于 SQLServer，如果将其设置为“自动关闭”，您可能会很幸运。当数据库一段时间不使用时，这将解锁数据文件。否则，建议您在拉动驱动器时手动分离数据库或停止 SQL Server。

这几乎可以肯定是一个不受支持的用例，所以我会确保定期备份以防万一出现问题。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-05T21:08:29.703

是的，这是可能的。请参阅MSDN 上的[此](http://social.msdn.microsoft.com/Forums/en-US/sqlce/thread/d119c3c5-bbf5-4422-b046-7bba4f705df1/)线程。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T21:08:40.437

您最好的选择是将数据库备份到文件（在 USB 驱动器上）并将其还原到本地计算机。

您也可以将文件复制到 USB 并运行附加文件命令。我不知道 USB 是否会比网络连接好得多。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T22:06:27.153

虽然我确信可以做到这一点，但取决于数据库的 IO 量，您可能不想这样做。闪存设备在失败之前具有[有限的读取/写入次数。](http://en.wikipedia.org/wiki/USB_flash_drive#Disadvantages)更具体地说，当涉及从闪存设备运行系统时，此限制在可能的范围内（因为从技术上讲，所有设备的故障数量都是有限的）。

如果您的解决方案是在更改站点时简单地移植数据并导出/导入，我相信这会很好。此外，很多软件都发布了“便携设备”版本，大量使用系统RAM，大大降低了对设备IO的需求。也许 SQL Server 有这样的版本？

# sql-server - 如何判断 SQL Server 2000 中是否启用了触发器

> ID：517903
> 
> 赞同：4
> 
> 时间：2009-02-05T21:05:58.557
> 
> 标签：sql-server, triggers, status

这应该不难做到。我希望企业管理器显示一个触发器文件夹、一个列表和一个图标......但我在任何地方都看不到它。我的谷歌结果让我得到了我必须编写代码的答案。你在跟我开玩笑吗？唯一的方法是编写代码？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-05T21:18:58.187

```
SELECT
CASE OBJECTPROPERTY(OBJECT_ID('trigger name goes here'), 'ExecIsTriggerDisabled')
WHEN 0 THEN 'ENABLED'
ELSE 'DISABLED'
END 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-05-26T17:37:51.263

此查询将返回所有触发器及其状态以及触发器用于哪个表。

```
SELECT
 so1.name as TriggerName, 
 CASE 
  OBJECTPROPERTY(OBJECT_ID(so1.name), 'ExecIsTriggerDisabled')
  WHEN 0 THEN 'ENABLED'
  ELSE 'DISABLED'
 END AS Status,
 so2.Name as TableName
FROM 
 SysObjects so1
 JOIN SysObjects so2
  ON so2.Id = so1.Parent_obj
WHERE 
 so1.type = 'TR' 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-06T06:52:04.877

在 Enterprise Manager 中向下钻取数据库 -> 并选择表

在详细信息窗格中，右键单击有问题的表并选择“管理触发器”，瞧！你应该能够在那里找到你要找的东西。

# windows-mobile - Windows Mobile 上的 Java (ME)

> ID：517906
> 
> 赞同：0
> 
> 时间：2009-02-05T21:06:41.830
> 
> 标签：windows-mobile, java-me

有人有将 Java ME 应用程序部署到 Windows Mobile 的经验吗？入门的高级步骤是什么，是否有任何主要缺点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T08:46:30.790

首先你需要在你的设备上安装一个JVM（如果还没有安装的话）。目前有两个玩家：

*   [NSI 奶油](http://www.nsicom.com/Default.aspx?tabid=138)。这是一款功能强大的产品，但它仅支持 CDC 配置文件（无 MIDlet），您需要为至少 1000 台左右的设备购买许可证。
*   IBM J9。这具有 CLCD 支持并且可以运行 MIDlet。有一个演示版，但我找不到下载链接。可能是 IBM 已经停止支持它了。

有些设备预装了 JVM，但很难依赖某些配置文件。除非您针对的是单个设备，否则我会说最好避免使用 J2ME for Windows Mobile。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T12:22:51.917

刚刚从三星 i900 开始。FileConnection 似乎很糟糕，没有明显访问内部硬盘驱动器或存储卡。担心 Applix jBlend 基础端口。

我*希望*其他人在 windows mobile 上有更好的 java 体验。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T15:21:53.790

kgiannakakis 适用于需要安装在 Windows Mobile 设备上的 JavaVM，但这仅适用于旧设备。Windows Mobile 5 和 6 预装了可以运行的 Microsoft Java VM。基本上。

实际上，您可以将您的 J2ME 应用程序编译成一个 jar 文件，将它复制到您的 Windows Mobile 设备上并启动它。差不多就是这样。

与所有通用 JavaME VM 一样，您将无法访问在您使用的 JavaVM 支持的标准 CLDC/MIDP 库中无法访问的内部 API/硬件。

# sql - 3 个表，左外连接，SUM

> ID：517909
> 
> 赞同：0
> 
> 时间：2009-02-05T21:07:05.433
> 
> 标签：sql

我在 3 个表上的 LEFT OUTER JOIN 有问题，带有 SUM 子句。这是我的代码：

```
SELECT r.ret_desc, vmp.vlt_id,  
SUM((vmp.cash_in + vmp.per_cash_in_sec)
  + (CASE WHEN vmp.acc_id = t.db_id AND t.txn_type_id = 1 THEN t.amount ELSE 0 END)
  - (CASE WHEN vmp.acc_id = t.cr_id AND t.txn_type_id = 1 THEN t.amount ELSE 0 END)) AS in_adj, 

FROM ret AS r
LEFT OUTER JOIN vmp ON r.acc_id = vmp.acc_id
LEFT OUTER JOIN txn AS t ON (r.acc_id = t.credit_acc_id OR r.acc_id = t.debit_acc_id) 

WHERE t.txn_type_id IN (1,2,4,5)
GROUP BY r.ret_desc, vmp.vlt_id
; 
```

问题是有多个 VMP 记录，并且 SUM 字段乘以 VMP 记录的 COUNT。例如：如果 SUM 字段应该等于 100 美元并且有 50 条 VMP 记录，那么 SUM 变为 5000 美元，而它应该只是 100 美元。有谁知道这个声明有什么问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T21:28:24.627

您应该知道 JOIN 会生成一组与连接子句匹配的所有组合。

因此，如果单个 ret 记录有多个 txn 和 vmp 记录，则每个 ret 获得 count(txn) * count(vmp) 记录，从而创建 count(vmp) * txn.amount 和 count(txn) * 的总和vmp.数量。

我认为最好的解决方案是使用 2 个子选择进行外连接，或者在该组的 vmp 和 txn 上创建视图并按 ret 求和，然后将它们外连接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T22:56:05.853

由于您用于创建 sunm 的所有字段都来自可能包含多条记录的表，因此它们当然都将它们添加进去。

你正在做的事情有几个问题，但首先，如果我是你，我会先把总和拿出来看看计算是什么，然后再总结。事实上，我会做类似的事情：

```
SELECT r.ret_desc, vmp.vlt_id,  
(vmp.cash_in + vmp.per_cash_in_sec)  
 + (CASE WHEN vmp.acc_id = t.db_id AND t.txn_type_id = 1 THEN t.amount ELSE 0 END) 
 - (CASE WHEN vmp.acc_id = t.cr_id AND t.txn_type_id = 1 THEN t.amount ELSE 0 END),
vmp.cash_in,vmp.per_cash_in_sec, vmp.per_cash_in_sec,  t.db_id,t.cr_id,         t.txn_type_id ,t.amount
FROM ret AS r
LEFT OUTER JOIN vmp ON r.acc_id = vmp.acc_id
LEFT OUTER JOIN txn AS t ON (r.acc_id = t.credit_acc_id OR r.acc_id = t.debit_acc_id) 
WHERE t.txn_type_id IN (1,2,4,5) 
```

按 r.ret_desc、vmp.vlt_id 分组

其次，您为什么要进行左连接？txn 绝对不是左连接，因为您在 wher 子句中使用了它，该子句有效地将其转换为内部连接，因此如果您需要将其作为左连接，则需要将 where 子句移至 on 子句。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T21:20:50.443

我将对您的数据设计进行一些猜测。如果这些不准确，请更详细地更新问题。

(1) RET 表的主键为 ACC_ID
(2) VMP 表的主键为 (ACC_ID, VLT_ID) - 所以当您说“有 50 条 VMP 记录”时，您的意思是 50 条具有相同 ACC_ID 但不同 VLT_ID 的记录.

基于这些假设，我猜您的问题是您没有将单个事务绑定到特定的 VLT_ID。

表格布局和一些示例数据的描述会有所帮助。

# java - 什么时候应该在 java 中使用“strictfp”关键字？

> ID：517915
> 
> 赞同：275
> 
> 时间：2009-02-05T21:08:34.197
> 
> 标签：java, floating-point, strictfp

我已经查过了它的作用，但实际上有没有人有一个例子说明你什么时候`strictfp`在 Java 中使用关键字？有没有人真的发现了这个的用途？

将它放在我所有的浮点运算上会有任何副作用吗？

* * *

## 回答 #1

> 赞同：286
> 
> 时间：2009-02-05T21:23:27.957

Strictfp 确保您从每个平台上的浮点计算中获得完全相同的结果。如果您不使用 strictfp，JVM 实现可以在可用的情况下免费使用额外的精度。

[从 JLS](http://java.sun.com/docs/books/jls/third_edition/html/expressions.html#249198)：

> 在 FP-strict 表达式中，所有中间值必须是 float 值集或 double 值集的元素，这意味着所有 FP-strict 表达式的结果必须是 IEEE 754 算术对使用单双格式表示的操作数预测的结果. 在非 FP 严格的表达式中，允许实现使用扩展的指数范围来表示中间结果；粗略地说，最终效果是，在独占使用浮点值集或双精度值集可能导致上溢或下溢的情况下，计算可能会产生“正确答案”。

换句话说，这是为了确保*Write-Once-Run-Anywhere*实际上意味着*Write-Once-Get-Equally-Wrong-Results-Everywhere*。

使用 strictfp，您的结果是可移植的，没有它，它们更有可能是准确的。

* * *

## 回答 #2

> 赞同：67
> 
> 时间：2009-02-05T21:16:06.740

实际上，有[一篇关于 strictfp 的很好的 Wikipedia 文章](http://en.wikipedia.org/wiki/Strictfp)，其中包含指向[Java 规范中关于*浮点类型、格式和值*](https://docs.oracle.com/javase/specs/jls/se9/html/jls-4.html#jls-4.2.3)的部分的链接。

字里行间的意思是，如果您不指定`strictfp`，则 JVM 和 JIT 编译器有权根据需要计算您的浮点计算。为了速度，他们很可能会将计算委托给您的处理器。启用后，计算必须符合 IEEE 754 算术标准，这在`strictfp`实践中可能意味着 JVM 将执行计算。

那你为什么要使用`strictfp`？我可以看到的一种情况是在分布式应用程序（或多人游戏）中，无论底层硬件或 CPU 是什么，所有浮点计算都需要是确定性的。有什么取舍？最有可能的执行时间。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2015-07-13T21:44:41.083

一切从一个故事开始，

当 James Gosling、Herbert 和他的团队的其他成员开发 java 时。他们想到了一个叫做***平台独立性***的疯狂的东西。他们想做*橡木（Java）*好得多，它可以在任何具有不同指令集的机器上运行完全相同，甚至运行不同的操作系统。但是，小数点数字在编程语言中也称为浮点数和双精度数存在问题。一些机器的目标是效率，而其他机器的目标是准确性。因此，后来的（更准确）机器的浮点大小为 80 位，而前者（更高效/更快）的机器具有 64 位双精度。但是，这与构建平台独立语言的核心理念背道而驰。此外，当代码在某些机器上构建（具有双倍 64 位大小）并在另一种机器上运行（具有双倍 80 位大小）时，这可能会导致精度/数据丢失。

可以容忍加大尺寸，但不能容忍缩小尺寸。因此，他们遇到了 strictfp 的概念，即**严格浮点**。如果将此关键字与类/函数一起使用，那么它的浮点数和双精度数在任何机器上都具有一致的大小。即分别为 32/64 位。

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2009-02-05T21:24:33.603

#### Java 17 更新

`strictfp`具有如此狭窄的用例集，以至于从 Java 17 开始，[它的功能已被删除](https://openjdk.java.net/jeps/306)。它仍然是一个有效的修饰符，但现在**`strictfp`什么都不做**（[JLS 源](https://docs.oracle.com/javase/specs/jls/se17/html/jls-3.html#jls-ReservedKeyword)）。

取而代之的是，所有浮点运算现在都是严格的，就像之前`strictfp`在 Java 1.2 中引入的情况一样。在现代处理器上，不再有任何额外的性能成本。

* * *

#### 原始答案

这里有几个参考：

*   [使用 strictfp](http://java.sun.com/developer/JDCTechTips/2001/tt0410.html#using)（JDC 技术提示）

*   jGuru：[strictfp 修饰符有什么用？我什么时候会考虑使用它？](http://www.jguru.com/faq/view.jsp?EID=17544)

    > 基本上，这一切都归结为您是否关心代码中浮点表达式的结果是否快速或可预测。例如，如果您需要代码提供的答案使用浮点值在多个平台上保持一致，则使用`strictfp`.

*   [strictfp - Java 术语表](http://mindprod.com/jgloss/strictfp.html)

    > 浮点硬件计算的精度更高，值的范围比 Java 规范要求的更大。如果某些平台比其他平台提供更高的精度，那将是令人困惑的。当您`strictfp`在方法或类上使用修饰符时，编译器会生成严格遵守 Java 规范的代码，以便在所有平台上获得相同的结果。没有`strictfp`, 是不是有点松懈，但没有松懈到使用 Pentium 中的保护位来提供 80 位的精度。

*   最后是实际的 Java 语言规范，[§15.4 FP-strict Expressions](http://java.sun.com/docs/books/jls/third_edition/html/expressions.html#249198)：

    > 在 FP-strict 表达式中，所有中间值必须是 float 值集或 double 值集的元素，这意味着所有 FP-strict 表达式的结果必须是 IEEE 754 算术对使用单双格式表示的操作数预测的结果. 在非 FP 严格的表达式中，允许实现使用扩展的指数范围来表示中间结果；粗略地说，最终效果是，在独占使用浮点值集或双精度值集可能导致上溢或下溢的情况下，计算可能会产生“正确答案”。

不过，我个人从来没有用过它。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2009-02-05T21:45:58.257

正如其他答案提到的那样，它会导致中间浮点结果符合 IEEE 规范。特别是 x86 处理器可以存储与 IEEE 规范不同精度的中间结果。当 JIT 优化特定计算时，情况会变得更加复杂；每次指令的顺序可能不同，导致舍入略有不同。

strictfp 产生的开销可能非常依赖于处理器和 JIT。这篇关于[SSE2](http://en.wikipedia.org/wiki/SSE2)的维基百科文章似乎对这个问题有所了解。因此，如果 JIT 可以生成 SSE 指令来执行计算，那么 strictfp 似乎不会有任何开销。

在我当前的项目中，有几个地方使用了 strictfp。有一点需要从像素值中去除潜在的宇宙射线。如果一些外部研究人员在他们面前有相同的像素值和宇宙射线，他们应该得到与我们的软件相同的结果值。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2012-09-19T19:09:14.547

*   strictfp 是根据 IEEE 754 限制浮点计算的修饰符。

*   这可以用于整个类，如“public strictfp class StrictFpModifierExample{}”或方法“public strictfp void example()”。如果在类上使用，则所有方法都将遵循 IEEE 754，如果在方法上使用，则特定方法将遵循 IEEE 754。

*   为什么使用它？::: 因为不同的平台具有不同的浮点硬件，其计算精度和值范围比 Java 规范要求的更高，这可能会在不同的平台上产生不同的输出。因此它确认相同的输出而不管不同平台

*   strictfp 还确保利用扩展精度浮点运算的速度和精度。

*   我们在进行浮点计算时可以使用这个关键字没有任何缺点

*   我的最后一点是——简而言之 IEEE754 是什么 IEEE 754 定义了浮点计算和浮点值存储的标准方法，无论是单精度（32 位，用于 Java 浮点数）还是双精度（64 位，用于 Java） doubles) 精度。它还定义了中间计算和扩展精度格式的规范。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-07-08T11:17:28.947

`strictfp`是一个关键字，可以用作类或方法的非访问修饰符（但不能用作变量）。将类标记为`strictfp`意味着该类中的任何方法代码都将符合 IEEE 754 浮点标准规则。

如果没有该修饰符，方法中使用的浮点可能会以平台相关的方式运行。有了它，您可以预测浮点的行为方式，而不管 JVM 运行在什么底层平台上。不利的一面是，如果底层平台能够支持更高的精度，`strictfp`则方法将无法利用它。

如果您不将类声明为`strictfp`，您仍然可以`strictfp`通过将方法声明为 来逐个方法获取行为`strictfp`。

~ SCJP Sun®Certified Programmer for Java™ 6 - Kathy Sierra & Bert Bates ~

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2021-12-31T23:39:10.420

从 Java 17+ 开始，strictfp 修饰符已经过时并且什么都不做。您不应再使用此修饰符。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-08-18T07:54:35.710

下面的示例可能有助于更清楚地理解这一点：在 java 中，每当我们使用查找任何操作的精确信息时，例如，如果我们执行 double num1 = 10e+102; 双 num2 = 8e+10 ; 结果 = 数字 1 + 数字 2；

```
 The output will be so long and not precise, becasue it is precissed by the hardware e.g JVM and JIT has the license 
        as long as we dont have specify it Strictfp

Marking it Strictfp will make the result Uniform on every hardware and platform, because its precised value will be same
One scenario I can see is in a distributed application (or multiplayer game) where all floating-point calculations need to 
be deterministic no matter what the underlying hardware or CPU is. 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-12-23T13:00:10.600

'strictfp' 关键字用于强制 Java 中浮点计算（float 或 double）的精度明确符合 IEEE 的 754 标准。如果不使用 strictfp 关键字，浮点精度取决于目标平台的硬件。

如果一个接口或类是用 strictfp 声明的，那么该接口或类中的所有方法和嵌套类型都是隐式的 strictfp。

参考[链接](https://self-learning-java-tutorial.blogspot.com/2014/06/strictfp.html)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2022-02-18T23:55:36.887

**我需要**的一次（也是唯一一次）是与 IBM ZSeries 协调。会计和**大型机**之外；不。已经有一段时间了，但我相当肯定大型机没有改变。

# mapping - 领域驱动设计、SOC 和实体识别

> ID：517918
> 
> 赞同：6
> 
> 时间：2009-02-05T21:08:55.337
> 
> 标签：mapping, domain-driven-design, separation-of-concerns

我一直试图围绕 DDD 以及它如何与 MVC 关联起来，但我在实体识别方面遇到了麻烦。

特别是，我试图保持我的表示、域和数据模型之间的严格分离。我的问题在于我如何跨这些边界保存实体标识。澄清一下，我使用不同的类来表示不同上下文中的同一实体 - 例如，我有一个“ShipmentRequest”域类、几个“ShipmentRequestView”表示类（取决于特定视图所需的属性）和一个'shipment_request' 数据库表（我的数据模型）。

我觉得使用“ID”属性（如 ShipmentRequestId）会违反我试图实现的分离，因为此 ID 属性是数据库问题，而不是域问题；而且我不想在层之间传递相同的对象，因为这意味着将不需要的数据传递到我的表示层。

我如何保持这种分离，同时跟踪这些层之间的身份？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T22:37:11.523

如果您的实体中没有 Id 字段，您将无法将其映射到数据库行。因此，即使这个 id 字段与您的实体无关，它也必须泄漏到您的域模型中。

我觉得使用演示模型通常是矫枉过正的，特别是如果你想要实现的是隐藏一些属性。

我认为关注点分离主要是由有界上下文驱动的。例如，您的 Person、PersonView 和 Person 表似乎都与事务处理上下文有关。在这种情况下，我什至没有 PersonView 并且人员表将被抽象掉。

另一方面，如果您处于报告上下文中，则 PersonView 会更有用。

我认为上下文比任何分层方案都重要得多。

至于您的 person 实体中缺少自然键，这可能意味着 Person 不是真正的实体。例如，在任何现实生活中的应用程序中，总是有一个与人相关联的数字：员工有员工号码，客户作为帐号等。这个业务 id 肯定是域的一部分。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T21:47:59.860

我认为在实体上有一个“ID”字段是很多（大多数？）人们最终做出的让步，我不会为此感到内疚。

正如您所说，即使您不处理数据库，您仍然需要一些身份概念。您可以尝试为每个实体（名称等字段或多个字段的组合）提出某种“自然”身份，但这并不总是可行的。即使是这样，拥有一个 ID 字段通常也可以作为一种方便的简写形式来表示“名称为 X、出生日期为 Y、SSN 为 Z 的实体”。

最后，虽然可以说不那么“纯粹”，但拥有一个 ID 字段可能会大大简化事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-06T00:12:42.733

Shipment Request 绝对是一个更好的例子！

用户如何找到发货请求？根据答案，您可能需要用户可能记得的 id，例如 20091012-A。

装运请求 ID 可以更改吗？如果不是，请使用 db 密钥作为标识。

您是否需要将装运请求从一个系统转移到另一个系统？如果是，请不要使用 db 密钥作为标识。

无论您使用什么键，都需要使其在演示模型中可用，以便您可以建立指向特定装运请求操作的链接。

# c# - 根据 .NET Framework 设计指南命名命名空间中的类型

> ID：517919
> 
> 赞同：4
> 
> 时间：2009-02-05T21:09:32.853
> 
> 标签：c#, naming-conventions, namespaces, naming

我在为我们的新应用程序线提出一个合理的类型命名方案时遇到了一些问题。我想遵循[.NET Framework Developer's Guide - Design Guidelines for Developing Class Libraries](http://msdn.microsoft.com/en-us/library/ms229042.aspx)，但我开始怀疑这是否是个好主意。

我想使用`Company.Product.Feature`命名空间方案作为基础。

**问题 1：**我们有自己的控件和表单基类，我希望这些进入`Company.Product.Forms`命名空间。但是，根据指南，我们不应该让我们的类型名称是`Control`or `Form`，即使它们在我们自己的`Company.Product.Forms`命名空间中，因为它们会与系统类型发生冲突。

**问题 2：**我们在应用程序中有一些不同的功能区域，我希望这些区域进入它们自己的`Company.Product.Feature`命名空间。许多这些特性都有类似的设计，有一个控制器和一些视图，所以在每个`Company.Product.Feature`命名空间下我希望有名为`Controller`、`SomeView`、`AnotherView`等的类型。但是，根据指南，我们不应该在不同的地方有相同的类型名称命名空间。

我认为克服这些问题的唯一解决方案是在类型前面加上一些在某种程度上使命名空间变得多余的东西。或不？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-05T21:31:28.380

微软显然赞成一些冗余。一个常见的例子是：

```
System.Xml.XmlDocument 
```

通用类名，即使绑定在一个正确命名的命名空间中，也会让许多喜欢避免完全限定其类实例化的程序员感到头疼。“文档”可以是 Xml、Html 或 word 文档。如果您碰巧导入了多个具有“文档”类的命名空间，这种歧义将导致无穷无尽的混乱。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-05T21:25:48.717

出于某种原因，我更喜欢 Company.Product.UI。我也会为网络使用该命名。

关于问题 1，如果这些是基本类型，您可能会在类名中包含 Base 。然后，您通常拥有一组特定于域的控件，它们不会与内置类型发生冲突。如果您还保留常用 UI 控件（TextBox、DropDownList 等）的包装器，那么我实际上建议为它们使用前缀，也许这个前缀是产品的缩写名称。然后，如果您这样做，那么您可能希望保持一致，并且对所有类型都这样做，无论它们是否是模棱两可的名称。

我以我自己的经验告诉你。您最终会不断地将鼠标悬停在变量上以查看它们的完整类型名称等，您将使用别名等。代码将更难阅读。

问题 2：在 GUI 层，我倾向于打破这些规则，因为您需要命名一致性（常用动词；显示、编辑、列表）。如果指南另有说明，我相信这是因为它不够具体。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-11-26T16:36:06.793

*第一篇在 StackOverFlow 上发帖，关于一个老问题。请对我好一点:)*

> 通用类名，即使绑定在一个正确命名的命名空间中，也会让许多喜欢避免完全限定其类实例化的程序员感到头疼。“文档”可以是 Xml、Html 或 word 文档。如果您碰巧导入了多个具有“文档”类的命名空间，这种歧义将导致无穷无尽的混乱。

Microsoft 可能有时会支持一些冗余，但并非总是如此。至于 Document vs XMLDocument 的问题，当您知道可能存在不止一种类型的文档时，为什么不在声明中包含命名空间的限定部分呢？

例如： `Xml.XmlDocument` vs `Html.HtmlDocument`

与其导入 XML 和 HTML 命名空间，不如只包含包含的命名空间？它会变成这样：

`Xml.Document` 对比 `Html.Document`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T21:13:29.147

如果合乎逻辑，那就去做吧。它们只是指导方针，而不是法律。（并不是说你也不能打破它。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-05T21:22:21.797

在不同的命名空间中具有相同名称的类只是违反准则的原因，它使阅读代码有点困难，因为当您看到“Controller”时，您必须在心理上将其映射到“Feature1.Controller”或“Feature2.Controller”。

我更愿意将 Company.Product.Features.Feature1.Feature1Conroller 与冗余信息一起使用，或者如果它困扰您（我个人不喜欢有太多命名空间），可能会使用 Company.Product.Features.Feature1Controller。

但是请随意违反准则，规则可以让您在违反规则之前思考 :-)

# python - 在 Python unicode 字符串中删除重音（规范化）的最佳方法是什么？

> ID：517923
> 
> 赞同：650
> 
> 时间：2009-02-05T21:10:40.760
> 
> 标签：python, python-3.x, unicode, python-2.x, diacritics

我在 Python 中有一个 Unicode 字符串，我想删除所有的重音符号（变音符号）。

我在网上找到了一种优雅的方法（在 Java 中）：

1.  将 Unicode 字符串转换为其***长规范化形式***（字母和变音符号使用单独的字符）
2.  删除所有 Unicode 类型为“变音符号”的字符。

我是否需要安装诸如 pyICU 之类的库，或者仅使用 Python 标准库就可以做到这一点？那么python 3呢？

重要提示：我想避免使用从重音字符到非重音字符的显式映射的代码。

* * *

## 回答 #1

> 赞同：638
> 
> 时间：2010-04-13T21:21:14.497

[Unidecode](https://pypi.python.org/pypi/Unidecode)是这个问题的正确答案。它将任何 unicode 字符串转译为 ascii 文本中最接近的可能表示形式。

例子：

```
accented_string = u'Málaga'
# accented_string is of type 'unicode'
import unidecode
unaccented_string = unidecode.unidecode(accented_string)
# unaccented_string contains 'Malaga'and is of type 'str' 
```

* * *

## 回答 #2

> 赞同：344
> 
> 时间：2009-02-05T22:17:22.780

这个怎么样：

```
import unicodedata
def strip_accents(s):
   return ''.join(c for c in unicodedata.normalize('NFD', s)
                  if unicodedata.category(c) != 'Mn') 
```

这也适用于希腊字母：

```
>>> strip_accents(u"A \u00c0 \u0394 \u038E")
u'A A \u0394 \u03a5'
>>> 
```

[字符类别](http://www.unicode.org/reports/tr44/#GC_Values_Table)“ Mn”代表`Nonspacing_Mark`，类似于 MiniQuark 的答案中的 unicodedata.combining（我没有想到 unicodedata.combining，但它可能是更好的解决方案，因为它更明确）。

请记住，这些操作可能会显着改变文本的含义。口音、变音符号等不是“装饰”。

* * *

## 回答 #3

> 赞同：182
> 
> 时间：2009-02-05T21:19:34.470

我刚刚在网上找到了这个答案：

```
import unicodedata

def remove_accents(input_str):
    nfkd_form = unicodedata.normalize('NFKD', input_str)
    only_ascii = nfkd_form.encode('ASCII', 'ignore')
    return only_ascii 
```

它工作得很好（例如法语），但我认为第二步（删除重音符号）比删除非 ASCII 字符处理得更好，因为这对于某些语言（例如希腊语）会失败。最好的解决方案可能是明确删除标记为变音符号的 unicode 字符。

**编辑**：这可以解决问题：

```
import unicodedata

def remove_accents(input_str):
    nfkd_form = unicodedata.normalize('NFKD', input_str)
    return u"".join([c for c in nfkd_form if not unicodedata.combining(c)]) 
```

`unicodedata.combining(c)``c`如果字符可以与前面的字符组合，则返回 true ，主要是如果它是一个变音符号。

**编辑 2**：`remove_accents`需要一个*unicode*字符串，而不是字节字符串。如果您有一个字节字符串，那么您必须将其解码为一个 unicode 字符串，如下所示：

```
encoding = "utf-8" # or iso-8859-15, or cp1252, or whatever encoding you use
byte_string = b"café"  # or simply "café" before python 3.
unicode_string = byte_string.decode(encoding) 
```

* * *

## 回答 #4

> 赞同：55
> 
> 时间：2015-07-24T10:08:14.263

实际上，我在项目兼容的 python 2.6、2.7 和 3.4 上工作，我必须从免费用户条目中创建 ID。

多亏了你，我创造了这个奇迹般的功能。

```
import re
import unicodedata

def strip_accents(text):
    """
    Strip accents from input String.

    :param text: The input string.
    :type text: String.

    :returns: The processed String.
    :rtype: String.
    """
    try:
        text = unicode(text, 'utf-8')
    except (TypeError, NameError): # unicode is a default on python 3 
        pass
    text = unicodedata.normalize('NFD', text)
    text = text.encode('ascii', 'ignore')
    text = text.decode("utf-8")
    return str(text)

def text_to_id(text):
    """
    Convert input text to id.

    :param text: The input string.
    :type text: String.

    :returns: The processed String.
    :rtype: String.
    """
    text = strip_accents(text.lower())
    text = re.sub('[ ]+', '_', text)
    text = re.sub('[^0-9a-zA-Z_-]', '', text)
    return text 
```

结果：

```
text_to_id("Montréal, über, 12.89, Mère, Françoise, noël, 889")
>>> 'montreal_uber_1289_mere_francoise_noel_889' 
```

* * *

## 回答 #5

> 赞同：29
> 
> 时间：2013-03-21T12:39:18.177

这不仅可以处理重音，还可以处理“笔画”（如 ø 等）：

```
import unicodedata as ud

def rmdiacritics(char):
    '''
    Return the base character of char, by "removing" any
    diacritics like accents or curls and strokes and the like.
    '''
    desc = ud.name(char)
    cutoff = desc.find(' WITH ')
    if cutoff != -1:
        desc = desc[:cutoff]
        try:
            char = ud.lookup(desc)
        except KeyError:
            pass  # removing "WITH ..." produced an invalid name
    return char 
```

这是我能想到的最优雅的方式（亚历克西斯在本页的评论中已经提到过），尽管我认为它确实不是很优雅。事实上，正如评论中所指出的，这更像是一种 hack，因为 Unicode 名称 - 实际上只是名称，它们不能保证是一致的或任何东西。

还有一些特殊的字母没有被这个处理，例如翻转和倒置的字母，因为它们的 unicode 名称不包含“WITH”。这取决于你想做什么。我有时需要去除重音来实现字典排序顺序。

### 编辑注：

合并了评论中的建议（处理查找错误、Python-3 代码）。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2013-06-12T15:48:48.087

回应@MiniQuark 的回答：

我试图读取一个半法语（包含重音）的csv文件以及一些最终会变成整数和浮点数的字符串。作为测试，我创建了一个`test.txt`如下所示的文件：

> 蒙特利尔, über, 12.89, Mère, Françoise, noël, 889

我必须包含行`2`并`3`让它工作（我在 python 票证中找到），以及合并@Jabba 的评论：

```
import sys 
reload(sys) 
sys.setdefaultencoding("utf-8")
import csv
import unicodedata

def remove_accents(input_str):
    nkfd_form = unicodedata.normalize('NFKD', unicode(input_str))
    return u"".join([c for c in nkfd_form if not unicodedata.combining(c)])

with open('test.txt') as f:
    read = csv.reader(f)
    for row in read:
        for element in row:
            print remove_accents(element) 
```

结果：

```
Montreal
uber
12.89
Mere
Francoise
noel
889 
```

（注意：我在 Mac OS X 10.8.4 上使用 Python 2.7.3）

* * *

## 回答 #7

> 赞同：16
> 
> 时间：2018-01-30T00:27:58.897

来自Gensim 的[gensim.utils.deaccent(text)](https://radimrehurek.com/gensim/utils.html#gensim.utils.deaccent) [- 人类主题建模](https://radimrehurek.com/gensim/)：

```
'Sef chomutovskych komunistu dostal postou bily prasek' 
```

另一种解决方案是[unidecode](https://pypi.python.org/pypi/Unidecode)。

请注意，建议的**unicodedata**解决方案通常仅删除某些字符中的重音符号（例如，它变成`'ł'`，`''`而不是变成`'l'`）。

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2021-02-03T02:59:45.073

[![性能图](https://i.stack.imgur.com/LiUKk.png)](https://i.stack.imgur.com/LiUKk.png)

```
import unicodedata
from random import choice

import perfplot
import regex
import text_unidecode

def remove_accent_chars_regex(x: str):
    return regex.sub(r'\p{Mn}', '', unicodedata.normalize('NFKD', x))

def remove_accent_chars_join(x: str):
    # answer by MiniQuark
    # https://stackoverflow.com/a/517974/7966259
    return u"".join([c for c in unicodedata.normalize('NFKD', x) if not unicodedata.combining(c)])

perfplot.show(
    setup=lambda n: ''.join([choice('Málaga François Phút Hơn 中文') for i in range(n)]),
    kernels=[
        remove_accent_chars_regex,
        remove_accent_chars_join,
        text_unidecode.unidecode,
    ],
    labels=['regex', 'join', 'unidecode'],
    n_range=[2 ** k for k in range(22)],
    equality_check=None, relative_to=0, xlabel='str len'
) 
```

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2021-09-08T08:43:40.543

在我看来，建议的解决方案不应被接受。最初的问题是要求**去除口音**，所以正确的答案应该只这样做，而不是加上其他未指定的更改。

只需观察此代码的结果，即可接受的答案。我将“Málaga”更改为“Málagueña”：

```
accented_string = u'Málagueña'
# accented_string is of type 'unicode'
import unidecode
unaccented_string = unidecode.unidecode(accented_string)
# unaccented_string contains 'Malaguena'and is of type 'str' 
```

还有一个额外的更改 (ñ -> n)，在 OQ 中没有要求。

执行请求任务的简单函数，格式如下：

```
def f_remove_accents(old):
    """
    Removes common accent characters, lower form.
    Uses: regex.
    """
    new = old.lower()
    new = re.sub(r'[àáâãäå]', 'a', new)
    new = re.sub(r'[èéêë]', 'e', new)
    new = re.sub(r'[ìíîï]', 'i', new)
    new = re.sub(r'[òóôõö]', 'o', new)
    new = re.sub(r'[ùúûü]', 'u', new)
    return new 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2015-07-24T11:34:02.997

一些语言结合了变音符号作为语言字母和重音变音符号来指定重音。

我认为明确指定要删除的变音符号更安全：

```
def strip_accents(string, accents=('COMBINING ACUTE ACCENT', 'COMBINING GRAVE ACCENT', 'COMBINING TILDE')):
    accents = set(map(unicodedata.lookup, accents))
    chars = [c for c in unicodedata.normalize('NFD', string) if c not in accents]
    return unicodedata.normalize('NFC', ''.join(chars)) 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2021-05-02T10:09:02.220

如果您希望获得类似于 Elasticsearch`asciifolding`过滤器的功能，您可能需要考虑[fold-to-ascii](https://pypi.org/project/fold-to-ascii/)，它是 [本身]...

> Apache Lucene ASCII 折叠过滤器的 Python 端口，它将不在前 127 个 ASCII 字符（“基本拉丁语”Unicode 块）中的字母、数字和符号 Unicode 字符（如果存在）转换为 ASCII 等效字符。

这是上述页面中的一个示例：

```
from fold_to_ascii import fold
s = u'Astroturf® paté'
fold(s)
> u'Astroturf pate'
fold(s, u'?')
> u'Astroturf? pate' 
```

**编辑**：该`fold_to_ascii`模块似乎适用于标准化拉丁字母；但是无法映射的字符被删除了，这意味着该模块将减少中文文本，例如，为空字符串。如果您想保留中文、日文和其他 Unicode 字母，请考虑使用`remove_accent_chars_regex`上面的 @mo-han 实现。

# c# - 从列表集合中删除重复项

> ID：517935
> 
> 赞同：3
> 
> 时间：2009-02-05T21:12:35.390
> 
> 标签：c#

希望可以有人帮帮我。我正在使用 c#，我对它有点陌生。我正在将一个文本文件加载到我的应用程序中并将数据拆分为“，”我正在将部分字符串读入一个`<list>`当读取数据时有很多重复项，这些重复项根据我加载的 txt 文件而有所不同。有人可以告诉我如何检查并删除出现的任何和所有重复项。没有办法知道会出现什么重复，因为它可能是无限的可能性。

我在这里先向您的帮助表示感谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-05T21:18:03.023

如果您的目标是 .NET 3.5，请使用 Distinct 扩展方法：

```
var deduplicated = list.Distinct(); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-05T21:16:14.133

如果将字符串加载到 a`Set`而不是 a中，`List`则会自动丢弃重复项。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-05T21:18:17.873

一个简单/肮脏的例子如下：

```
public List<string> RemoveDuplicates(List<string> listWithDups)
{
   cleanList = new List<string>();
   foreach (string s in listWithDups)
   {
      if (!cleanList.Contains(s))
         cleanList.Add(s);
   }
   return cleanList;
} 
```

作为警告：String.Split 在非常大的字符串上可能会导致消耗大量内存并导致异常。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T21:15:59.300

[这是](http://www.kirupa.com/net/removingDuplicates.htm)一篇文章，其中包含 C# 中的一些示例和解释。基本上，您只需跟踪唯一性，并检查每个元素。

亚历克斯

# macos - 在 OSX 中打开带有对话的点文件

> ID：517936
> 
> 赞同：8
> 
> 时间：2009-02-05T21:12:38.400
> 
> 标签：macos, .htaccess

由于 OSX 的 GUI 端将所有点文件（例如`.htaccess`）视为隐藏的，因此它不会在任何图形 UI 中显示它们，例如 Finder 或 Open-dialogues。

如何`.htaccess`在图形编辑器中打开一个点文件（在这种情况下），而[不是](http://lifehacker.com/software/command-line/show-hidden-files-in-finder-188892.php)对所有隐藏文件执行该操作，通用且不通过 Terminal.app？

*编辑：*我在 Leopard 上，如果这有什么不同的话。

*Edit2：* TextWrangler 和 TextMate 似乎具有允许您打开隐藏文件的功能，这*部分*回答了我的问题。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2010-06-02T19:09:10.080

在“打开文件”对话框中，您可以使用 Command-Shift-。查看点文件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-06T16:18:28.337

您也可以告诉 Finder 显示隐藏文件（在终端中输入）：

```
defaults write com.apple.finder AppleShowAllFiles TRUE 
```

但这并不是很好，因为有更多的隐藏文件。所以我建议使用一个编辑器，它允许您在打开的对话框中查看那些，就像 Chuck 提到的那样。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-05T21:16:57.003

如果您只想对一个特定文件执行此操作，则可以创建指向该点文件的符号链接。打开 Terminal.app，cd 到包含点文件的目录，然后运行

```
ln -s .htaccess dot_htaccess 
```

然后，您应该能够将该文件作为常规文件双击`dot_htaccess`，并且您所做的任何编辑都将真正进入 .htaccess。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T21:23:00.597

TextMate（一个非常好的 OS X 文本编辑器）打开对话框有一个“显示隐藏文件”选项，而 TextWrangler（和它的老大哥 BBEdit）有一个菜单项。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-24T20:27:00.637

在命令行中，对于名为 FILE 的文件，键入：

```
open -e FILE 
```

open 命令将在 TextEdit（-e 标志）中打开文件。查看“man open”以获取更多标志（例如，使用 -a 指定要打开的应用程序）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-07-14T21:37:17.793

Smultron（上面评论中提到的另一个不错的 OS X 编辑器，与 TextMate 类似，但免费）有一个“打开隐藏...”文件菜单项，非常适合此目的。

悲伤的消息：根据其作者在其主页上的一篇帖子，Smultron 显然不再在 v3.5.1（需要 Leopard）之后进一步开发：http: [//tuppis.com/smultron/](http://tuppis.com/smultron/)

jEdit 是另一个具有隐藏文件支持的免费选项：www.jedit.org/users-guide/vfs-browser.html（抱歉链接中缺少“http”——作为新用户，我的帖子仅限于只有一个链接。唉......）

# wordpress - 如何在 WordPress 中排序类别？

> ID：517940
> 
> 赞同：15
> 
> 时间：2009-02-05T21:13:27.743
> 
> 标签：wordpress, wordpress-theming

我`wp_list_categories()`用来获取所有类别的列表并生成导航栏。除了字母顺序之外，有没有办法以特定顺序对这些类别进行排序。

例如：Connect、News & Views、Q&A、Hello Startup、Startup 101...

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2017-02-09T01:56:56.137

大多数主题不使用任何类别的描述。我所做的简单解决方法是在描述中使用数字。这里的顶部帖子目前有一些来自这里的 jQuery hack，它是不需要的。

我想您也可以添加自定义订单字段。

只是

```
$categories = get_categories( array(
    'orderby' => 'description',
    'order'   => 'ASC'
) ); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2016-11-03T18:42:29.780

# 技术方法

wordpress核心的问题是表格`wp_terms`没有`term_order`列。这意味着，标准 wordpress 不支持自定义术语顺序。如果您查看此[WP 数据库结构](https://codex.wordpress.org/images/2/25/WP4.4.2-ERD.png)，您可以找到该表`wp_term_relationships`。该表负责帖子和分类（您的类别）之间的关系，并且该表有一`term_order`列。

现在，使用简单的 SQL 语句`ALTER TABLE wp_terms ADD term_order INT(11) NOT NULL DEFAULT 0`（不要忘记`$wpdb->wp_terms`变量），您可以向表中添加一列，该列负责您的自定义类别顺序。`wp_term_relationships`然后您可以将您的自定义类别顺序放在和的这两列中`wp_terms`。一切都完成后，您可以连接到过滤器`get_terms_args`并将其更改`orderby`为`term_order`.

这里列出了技术方法的所有相关链接：

*   wp数据库结构的[https://codex.wordpress.org/Database_Description](https://codex.wordpress.org/Database_Description)
*   [https://codex.wordpress.org/Class_Reference/wpdb](https://codex.wordpress.org/Class_Reference/wpdb)用于`$wpdb->wp_terms`
*   [https://developer.wordpress.org/reference/hooks/get_terms_args/](https://developer.wordpress.org/reference/hooks/get_terms_args/)用于 WP 过滤器

# 插件可以为您完成工作

检查我的插件来解决这个问题：[WordPress Real Categories Management](https://codecanyon.net/item/wp-real-categories-library-category-organisation-tree-view/13580393)。**WP RCM**在 wp 术语表上创建一个额外的字段 term_order。它还带来了许多其他有用的功能，您可以在下面的屏幕截图中看到。它允许您以一种很好的方式组织您的 wordpress 类别。它易于使用，只需**拖放**您的类别并将其移动到特定顺序即可。该插件适用于所有**自定义帖子类型**。

[![拖放类别顺序](https://i.stack.imgur.com/cuWaq.gif)](https://i.stack.imgur.com/cuWaq.gif)

从产品描述中我可以引用。**[如果您想尝试插件，插件页面上](https://codecanyon.net/item/wp-real-categories-library-category-organisation-tree-view/13580393)**还有一个演示。

# 有很多免费插件

这可以通过 wordpress.org 插件存储库中提供的许多免费插件来解决。只需在您的 Wordpress 仪表板 > 插件 > 安装中搜索“类别顺序”。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-04-26T05:38:00.097

这是内置的`wordpress_wp_list_categories`

```
wp_list_categories('orderby=name'); 
```

我认为这会帮助你

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-01-08T21:48:12.030

使用类别顺序和分类术语订购免费插件

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-01-29T13:36:23.437

我没有找到任何东西，所以我构建了自己的方法。我在插件的抽象类中将其抽象出来，因此有额外的代码，但您可以提取方法。

主要看方法是`format_hierarchy()`

```
// The parent class
abstract class Taxonomy {
    protected bool $_terms_loaded;

    protected array $terms;
    protected array $formatted_terms;

    public function __get( $property ) {
        if ( $property === 'formatted_terms' ) {
            if ( !isset( $this->formatted_terms ) ) $this->format_hierarchy();
            return $this->formatted_terms;
        }

        if ( substr( $property, 0, 1 ) === '_' ) die( 'Cannot get private properties' );

        if ( property_exists( $this, $property ) )
            return $this->$property;
    }

    /**
     * Formats the taxonomy's terms into a hierarchy of term_blocks and saves the value as a property to the class
     * 
     * @return              array       an array of `[term_taxonomy_id:number] => term_block` like:
     *                                      array(
     *                                          array( // parent $term_block
     *                                              'term' => WP_Term,
     *                                              'children' => array( $term_blocks… )
     *                                          ),
     *                                          …$term_blocks…
     *                                      )
     */
    public function format_hierarchy():array {
        if ( !$this->_load_terms() ) return [];

        // Holds a reference to every category, parents and children
        $term_blocks = [];

        // Holds a reference to every top most level category
        $parents = [];

        foreach ( $this->terms as $term ) {
            // Add itself to the list of all categories
            $term_block = [
                'children' => [],
                'term' => $term
            ];

            // Add itself to the array of all categories
            if ( !isset( $term_blocks[ $term->term_taxonomy_id ] ) )
                $term_blocks[ $term->term_taxonomy_id ] =& $term_block;

            // If it's a child category…
            if ( $term->parent !== 0 ) {
                // If the parent hasn't been created yet, create it
                if ( !isset( $term_blocks[ $term->parent ] ) )
                    $term_blocks[ $term->parent ] = [
                        'children' => [],
                        'term' => null
                    ];

                $term_blocks[ $term->parent ][ 'children' ][] =& $term_block;
            } else
                // Otherwise it's a parent
                $parents[ $term->term_taxonomy_id ] =& $term_blocks[ $term->term_taxonomy_id ];

            // set the term block's WP_Term property
            $term_blocks[ $term->term_taxonomy_id ][ 'term' ] =& $term;
            // This is needed so that the loop doesn't readd the same reference over and over again
            unset( $term ); unset( $term_block );
        }

        return $this->formatted_terms = $parents;
    }

    /**
     * Given a WP_Term property value, and a property key, recursively searches through all of the terms for it
     * 
     * @property    $term_val       mixed       The property value to find
     * @property    $prop           string      The property key for the value
     * @property    $with_parent    ?boolean    Whether to return the top level parent as well
     * @property    $term_blocks    ?array      Array of term blocks
     * @return                      array       If $with_parent is true, returns an [ $found_term_block, $top_level_parent ]
     *                                          Otherwise returns only the found term block
     */
    public function find_term_by(
        $term_val,
        string $prop,
        bool $with_parent = false,
        $term_blocks = null
    ):?array {
        if ( is_null( $term_blocks ) ) $term_blocks = $this->formatted_terms;
        foreach ( $term_blocks as $term_block ) {
            if ( $term_block[ 'term' ]->{$prop} === $term_val ) return $term_block;
            if ( count( $term_block[ 'children' ] ) &&
                ( $found = $this->find_term_by( $term_val, $prop, false, $term_block[ 'children' ] ) )
            ) return $with_parent ? [ $found, $term_block ] : $found;
        }
        return null;
    }

    /**
     * Loads the taxonomy terms once from the DB
     */
    protected function _load_terms():bool {
        if ( isset( $this->_terms_loaded ) ) return $this->_terms_loaded;

        $this->terms = get_terms(
            array(static::$taxonomy),
            array(
                    'hide_empty'    => false,
                )
        );

        if ( !$this->terms ) {
            ClassErrorHandler::handle_exception(
                new \WP_Error( 500, 'Failed to load category terms: \'' . static::$taxonomy . '\'' )
            );
        }

        return $this->_terms_loaded = !!$this->terms;
    }
}

// The Implementation
class TaxonomyProductService extends Taxonomy {
    public static string $taxonomy;
    public static string $slug;

    /**
     * To be called upon taxonomy registration long before any instance is required
     */
    public static function define_taxonomy( string $slug, string $taxonomy ) {
        static::$slug = $slug;
        static::$taxonomy = $taxonomy;
    }
} 
```

注册自定义分类后，我立即调用 TaxonomyProductService::define_taxonomy( 'url-slug', 'product-service' );

最后是如何使用的

```
$tax = new TaxonomyProductService();
$terms = $tax->formatted_terms;
// search for a term whose slug === `my-term`, and return the parent category
list( $current_term, $parent_term ) = $tax->find_term_by( 'my-term', 'slug', true ); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-08-24T12:49:31.570

我这样做生成了几个术语列表。我以后按我自己的命令叫它。我是 PHP 初学者。

首先，我将每个类别术语的 ID 存储在不同的变量中：

```
$terms = get_terms('my_taxonomy', 'hide_empty=0');
        foreach ( $terms as $term ) {
           ${$term->slug} = get_term_by('slug', $term->slug, 'product_cat');
           ${$term->slug.'_array'} = (array)${$term->slug};
           ${$term->slug.'_array_id'} =${$term->slug.'_array'}['term_id'];
      }; 
```

然后，我为每个`wp_list_categories()`排除创建几个 args，使用这个变量我想要的术语：

```
 $args = array(
        'taxonomy'     => 'my_taxonomy',
        'orderby'      => 'name',
        'show_count'   => true,
        'pad_counts'   => false,
        'hierarchical' => true,
        'title_li'     => '',
        'hide_empty'   => 0,
        'show_option_all' => 'Show all',
        'exclude'    => array( $term1_array_id, $term2_array_id )
      );

      $args_1 = array(
        'taxonomy'     => 'my_taxonomy',
        'orderby'      => 'name',
        'show_count'   => true,
        'pad_counts'   => false,
        'hierarchical' => true,
        'title_li'     => '',
        'hide_empty'   => 0,
        'exclude'    => array( $term3_array_id, $term4_array_id, $term1_array_id )
      );

      $args_2 = array(
        'taxonomy'     => 'my_taxonomy',
        'orderby'      => 'name',
        'show_count'   => true,
        'pad_counts'   => false,
        'hierarchical' => true,
        'title_li'     => '',
        'hide_empty'   => 0,
        'exclude'    => array( $term1_array_id, $term4_array_id, $term5_array_id )
      ); 
```

最后，我可以分别调用每个术语列表：

```
<ul>
    <?php wp_list_categories( $args ); ?>
    <?php wp_list_categories( $args_1 ); ?>
    <?php wp_list_categories( $args_2 ); ?>
</ul> 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2015-03-11T15:56:13.600

为了将来的访问者的利益，这是解决此问题的简单方法：

现在有许多插件允许您在 WordPress 中订购类别或其他自定义分类法。[您可以在 WordPress 插件目录的“类别顺序”标签页](https://wordpress.org/plugins/tags/category-order)中看到其中的一些。我可以亲自确认[Custom Taxonomy Order NE](https://wordpress.org/plugins/custom-taxonomy-order-ne/)插件可以完成这项工作。

# java - 比较 Java 和 .NET 上的可扩展 Web 应用架构

> ID：517942
> 
> 赞同：1
> 
> 时间：2009-02-05T21:13:30.507
> 
> 标签：java, .net, architecture, scalability

在 Java 和 .NET 中创建可扩展的 Web/企业应用程序的推荐步骤是什么？我对从低容量应用程序到高容量应用程序需要什么更感兴趣（假设原始架构中没有重大故障）。例如，每个平台的集群、负载平衡、会话管理、缓存等选项有哪些。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-01-17T11:04:29.657

不幸的是，您的问题有很多方面将取决于上下文。根据您的要求和应用程序，可扩展性可能意味着不同的事情。在您提出架构时需要回答的问题（无论您使用何种技术）包括：

*   例如，您是想支持处理大量数据的用户，还是只需要支持大量用户，每个用户处理相对少量的数据？
*   您的应用程序是否做更多的读取而不是写入，因为读取便宜且写入昂贵，读取繁重的应用程序可能比写入繁重的应用程序更易于扩展。
*   您的应用程序中的数据是否始终保持一致或最终的一致性就足够了？想想在社交网站上发布消息而不是从银行账户中取款）。
*   您的应用程序需要有多可用？严格的高可用性要求可能会要求您在一台服务器崩溃时顺利故障转移到其他服务器。

There are many other questions like this that need to be answered about your specific application before a proper discussion on your application architecture can take place.

However so I don't just leave you questions and not a single answer here is what I think is the single most important thing to take into account when designing a web application for scalability: **Reduce (down to zero if possible) the amount of shared session state in your application (global application counters, cached primary key blocks and the like). Replicating shared state across a cluster has a very high cost, when you are trying to scale up**

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-17T09:54:02.147

也许有这么多的选择，我不确定有人会全面考虑所有的选择。通常，首先选择语言，然后再决定如何实现您想要的结果。

我的猜测是，您几乎可以在任何主要的通用语言中都有不错的选择。这在 10 年前会是一个问题，但恕我直言，今天不是。

Java 中可用的开源技术的一个很好的比较是[http://java-sources.org/](http://java-sources.org/) 当您深入到每个类别时，您会发现这是相当广泛的，它甚至考虑了商业产品或 C#

对于任何可扩展系统，您还需要考虑硬件解决方案，例如网络组件。

我对将低容量应用程序转变为高容量应用程序的建议是，首先从容量相当大的应用程序开始，并期望在进行时对其进行重新设计。

你在说什么类型的卷？每个人对高音量和低音量都有不同的期望。例如，当谷歌的数据量低于平均水平时，他们会切换整个数据中心以节省电力。;)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T21:21:50.957

刚刚看到关于 MySpace 如何扩大规模[的](http://highscalability.com/myspace-architecture)解释，非常有趣，正是我正在寻找的信息。但是，没有讨论用于创建分区或缓存等的技术......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-17T09:57:44.900

简短的回答 - 这取决于。涉及哪些（如果有）业务目标？项目预算和时间表是多少？哪个行业（受监管）？

# c# - 从 C# 调用 Delphi DLL 会产生意想不到的结果

> ID：517944
> 
> 赞同：8
> 
> 时间：2009-02-05T21:14:27.617
> 
> 标签：c#, delphi, dll

我有一个我没有编写的 Delphi DLL，但需要从 C# ASP.NET 3.5 应用程序调用。这是我从开发人员那里得到的函数定义：

```
function CreateCode(SerialID : String; 
    StartDateOfYear, YearOfStartDate, YearOfEndDate, DatePeriod : Word; 
    CodeType,RecordNumber,StartHour,EndHour : Byte) : PChar;
    external 'CreateCodeDLL.dll'; 
```

这是我的 C# 代码：

```
[DllImport( "CreateCodeDLL.dll", 
    CallingConvention = CallingConvention.StdCall, 
    CharSet=CharSet.Ansi)]
public static extern IntPtr CreateCode( string SerialID,
                                        UInt16 StartDateOfYear,
                                        UInt16 YearOfStartDate,
                                        UInt16 YearOfEndDate,
                                        UInt16 DatePeriod,
                                        Byte CodeType,
                                        Byte RecordNumber,
                                        Byte StartHour,
                                        Byte EndHour); 
```

最后，我对这个方法的调用：

```
//The Inputs 
String serialID = "92F00000B4FBE";
UInt16 StartDateOfYear = 20;
UInt16 YearOfStartDate = 2009;
UInt16 YearOfEndDate = 2009;
UInt16 DatePeriod = 7;
Byte CodeType = 1;
Byte RecordNumber = 0;
Byte StartHour = 15;
Byte EndHour = 14;            

// The DLL call
IntPtr codePtr = CodeGenerator.CreateCode(serialID, StartDateOfYear, 
                YearOfStartDate, YearOfEndDate, DatePeriod, CodeType, 
                RecordNumber, StartHour, EndHour);

// Take the pointer and extract the code in a string
String code = Marshal.PtrToStringAnsi(codePtr); 
```

每次我重新编译这个确切的代码并运行它时，它都会返回一个不同的值。预期值是由数字组成的 10 位代码。返回值实际上是 12 位。

最后一条重要信息是我有一个测试 .EXE，它有一个允许我测试 DLL 的 GUI。使用 .EXE 的每个测试都返回相同的 10 位数字（预期结果）。

所以，我不得不相信我错误地声明了我对 DLL 的调用。想法？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-05T21:36:45.590

Delphi 默认使用所谓的***fastcall***调用约定。这意味着编译器尝试将参数传递给 CPU 寄存器中的函数，并且仅在参数多于空闲寄存器时才使用堆栈。例如，Delphi 使用 (EAX, EDX, ECX) 作为函数的前三个参数。
在您的 C# 代码中，您实际上使用的是***stdcall***调用约定，它指示编译器通过堆栈传递参数（以相反的顺序，即首先推送最后一个参数）并让被调用者清理堆栈。
相反，C/C++ 编译器使用的***cdecl***调用强制调用者清理堆栈。
只要确保您在双方都使用相同的调用约定。主要使用 Stdcall，因为它几乎可以在任何地方使用，并且每个编译器都支持（Win32 API 也使用此约定）。
请注意，.NET 无论如何都不支持***fastcall 。***

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-02-05T21:44:34.233

jn 是对的。给定的函数原型不能轻易地从 C# 中直接调用，只要它符合 Delphi 的`register`调用约定。您要么需要`stdcall`为它编写一个包装函数 - 如果你没有源代码，可能在另一个 DLL 中 - 或者你需要让维护函数的人将其调用约定更改为`stdcall`.

**更新：**我还看到第一个参数是一个 Delphi 字符串。这也不是 C# 可以提供的。它应该是一个 PChar。此外，明确函数是 Ansi 还是 Unicode 也很重要；如果 DLL 是用 Delphi 2009（或更高版本）编写的，则为 Unicode，否则为 Ansi。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-06T17:10:22.273

返回值可能是另一个问题。它可能是内存泄漏（他们在堆上分配一个缓冲区并且从不释放它）或访问已经释放的内存（他们返回一个本地字符串变量强制转换为 PChar）。

从函数返回字符串（或一般可变大小的数据）到另一个模块通常是有问题的。

一种解决方案（由 winapi 使用）是要求调用者传入缓冲区及其大小。这样做的缺点是，如果缓冲区太小，函数就会失败，调用者必须用更大的缓冲区再次调用它。

另一种可能的解决方案是在函数中从堆中分配缓冲区并返回它。然后您需要导出另一个函数，调用者必须使用该函数再次释放分配的内存。这可确保内存由分配它的同一运行时释放。

在不同（不是 borland）语言之间传递（Delphi）字符串参数可能是不可能的。甚至在 Delphi 模块之间，您也要确保两个模块使用相同的内存管理器实例。通常这意味着将“使用 ShareMem”作为所有模块的第一个用途。另一个区别是调用约定“注册”，它是一种快速调用约定，但与 MS 编译器使用的快速调用不同。

一个完全不同的解决方案可能是使用 Delphi.net 编译器之一重新编译 Delphi dll。多少工作取决于他们的代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T21:19:19.497

我从未这样做过，但尝试将您的代码更改为：

```
function CreateCode(SerialID : String;
    StartDateOfYear, YearOfStartDate, YearOfEndDate, DatePeriod : Word;
    CodeType,RecordNumber,StartHour,EndHour : Byte) : PChar; stdcall;
    external 'CreateCodeDLL.dll'; 
```

注意额外的标准调用。

Edit2：正如您从其他回复中看到的那样，您要么必须进行上述更改，要么编写一个执行相同操作的包装 dll。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-06T17:18:00.090

在 Delphi 中创建一个 COM 包装器，并通过互操作在 C# 代码中调用它。瞧.. 易于从 C# 或任何其他未来平台使用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-01-26T00:00:38.067

前几天我在搞乱，试图学习调用约定，我写了一些方法来在各种方法之间进行转换。这是 StdCall->FastCall 的一个。

```
typedef struct
{
    USHORT ParameterOneOffset;  // The offset of the first parameter in dwords starting at one
    USHORT ParameterTwoOffset;  // The offset of the second parmaeter in dwords starting at one
} FastCallParameterInfo;

    __declspec( naked,dllexport ) void __stdcall InvokeFast()
{
    FastCallParameterInfo paramInfo;
    int functionAddress;
    int retAddress;
    int paramOne, paramTwo;
    __asm
    {
        // Pop the return address and parameter info.  Store in memory.
        pop retAddress;
        pop paramInfo;
        pop functionAddress;

        // Check if any parameters should be stored in edx                          
        movzx ecx, paramInfo.ParameterOneOffset;     
        cmp ecx,0;
        je NoRegister;  

        // Calculate the offset for parameter one.
        movzx ecx, paramInfo.ParameterOneOffset;    // Move the parameter one offset to ecx
        dec ecx;                                    // Decrement by 1
        mov eax, 4;                                 // Put 4 in eax
        mul ecx;                                    // Multiple offset by 4

        // Copy the value from the stack on to the register.
        mov ecx, esp;                               // Move the stack pointer to ecx
        add ecx, eax;                               // Subtract the offset.
        mov eax, ecx;                               // Store in eax for later.
        mov ecx, [ecx];                             // Derefernce the value
        mov paramOne, ecx;                          // Store the value in memory.

        // Fix up stack
        add esp,4;                                  // Decrement the stack pointer
        movzx edx, paramInfo.ParameterOneOffset;    // Move the parameter one offset to edx
        dec edx;                                    // Decrement by 1
        cmp edx,0;                                  // Compare offset with zero
        je ParamOneNoShift;                         // If first parameter then no shift.

    ParamOneShiftLoop:
        mov ecx, eax;
        sub ecx, 4;
        mov ecx, [ecx]
        mov [eax], ecx;                             // Copy value over
        sub eax, 4;                                 // Go to next 
        dec edx;                                    // decrement edx
        jnz ParamOneShiftLoop;                      // Loop
    ParamOneNoShift:
        // Check if any parameters should be stored in edx                          
        movzx ecx, paramInfo.ParameterTwoOffset;     
        cmp ecx,0;
        je NoRegister;  

        movzx ecx, paramInfo.ParameterTwoOffset;    // Move the parameter two offset to ecx
        sub ecx, 2;                                 // Increment the offset by two.  One extra for since we already shifted for ecx
        mov eax, 4;                                 // Put 4 in eax
        mul ecx;                                    // Multiple by 4

        // Copy the value from the stack on to the register.
        mov ecx, esp;                               // Move the stack pointer to ecx
        add ecx, eax;                               // Subtract the offset.
        mov eax, ecx;                               // Store in eax for later.
        mov ecx, [ecx];                             // Derefernce the value
        mov paramTwo, ecx;                          // Store the value in memory.           

        // Fix up stack
        add esp,4;                                  // Decrement the stack pointer
        movzx edx, paramInfo.ParameterTwoOffset;    // Move the parameter two offset to ecx
        dec edx;                                    // Decrement by 1
        cmp edx,0;                                  // Compare offset with zero
        je NoRegister;                              // If first parameter then no shift.
    ParamTwoShiftLoop:
        mov ecx, eax;
        sub ecx, 4;
        mov ecx, [ecx]
        mov [eax], ecx;                             // Copy value over
        sub eax, 4;                                 // Go to next 
        dec edx;                                    // decrement edx
        jnz ParamTwoShiftLoop;                      // Loop

    NoRegister:
        mov ecx, paramOne;                          // Copy value from memory to ecx register
        mov edx, paramTwo;                          // 
        push retAddress;
        jmp functionAddress;
    }
} 
```

}

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-06T12:10:59.273

当您要求他们更改调用约定时，您还应该要求他们更改第一个参数，使其不是“字符串”。让他们使用指向（以空结尾的）char 或widechar 数组的指针。即使不增加尝试实现跨语言兼容性的复杂性，使用 Delphi 字符串作为 DLL 参数也是一个坏主意。此外，字符串变量将包含 ASCII 或 Unicode 内容，具体取决于他们使用的 Delphi 版本。

# c# - COM C# 内存泄漏跟踪

> ID：517950
> 
> 赞同：2
> 
> 时间：2009-02-05T21:15:15.697
> 
> 标签：c#, com, memory-leaks

有没有办法使用 com dll 找出 ac# 应用程序中每个 dll 的内存使用情况？或者您会说什么是找出为什么在使用 com 对象时内存呈指数增长的最佳方法（IE。COM 对象是否存在内存泄漏，或者是否必须对传递给托管代码的对象进行一些特殊的释放（以及/或如何做到这一点））。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T21:42:20.823

您是否在使用（`Marshal.ReleaseComObject`）之后释放 COM 对象？

您传入/传出调用的参数类型是什么？

如果您没有 COM 对象源代码并且想确定其“泄漏”的原因，请运行 COM 对象 outa proc，将 WinDBG 附加到进程并在内存分配 API（HeapAlloc 等）上设置断点。查看调用堆栈和分配模式。当然，您可以在托管端使用分析器，但如果您想知道发生了什么，您将不得不亲自动手......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T21:25:51.480

一位 Microsoft 支持工程师有一个很棒的博客，其中介绍了很多这样的[案例](http://blogs.msdn.com/tess/archive/2006/01/23/net-memory-leak-case-study-the-event-handlers-that-made-the-memory-baloon.aspx)。她检查了她使用的所有工具。几年前我调试这类东西时，我发现阅读她所有的帖子非常有帮助。

编辑：显然，她添加了一系列实验室来解释如何设置环境和诊断不同的问题。您可能想从[这里](http://blogs.msdn.com/tess/pages/net-debugging-demos-information-and-setup-instructions.aspx)开始。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T21:25:11.667

dotTrace 岩石： http: [//www.jetbrains.com/profiler/](http://www.jetbrains.com/profiler/)

请记住，.NET 中的所有 COM 对象基本上都是 MarshalByRefObject 派生类，因此您应该能够将这些对象的内存消耗作为一种潜在的过滤器来查找。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T21:26:21.540

我想做的第一件事是绝对确定我不会在任何地方泄漏参考，然后进入将重现这些步骤的最小步骤（一个好的分析器是必不可少的，我碰巧使用并推荐了 RedGate 的[ANTS Profiler](http://www.red-gate.com/products/ants_memory_profiler/index.htm)） - - 可以做到，值得将重现问题的示例代码发送给 COM 对象的供应商，以便他们解决它（实际上有一个针对 Crystal Reports 的修补程序，因为我发现其中存在内存泄漏:)

# html - 强制html中的canvas元素占据整个窗口？

> ID：517951
> 
> 赞同：1
> 
> 时间：2009-02-05T21:15:21.437
> 
> 标签：html, canvas

代替

```
<pre>
    <canvas id="theCanvas" width="500" height="500"></canvas>
</pre> 
```

我在哪里指定画布的大小有没有办法让画布占据整个浏览器窗口？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-10-03T20:30:49.283

当您创建跨越整个屏幕的画布元素时，您可能想要监视窗口大小调整事件。您可以继续使用基于百分比的样式，但您必须记住在调整窗口大小时重新绘制画布；当画布元素的尺寸发生变化（宽度或高度）时，画布本身会被清除并有效地重置（原点策略除外）。

我建议你使用这样的东西：

```
window.addEventListener(
  'resize', 
  function() { 
    canvas.width = window.innerWidth; 
    canvas.height = window.innerHeight; 
    MyRepaintCallback(); 
  }, 
  false); 
```

在此问题的范围之外，您的重绘功能有几个注意事项。至少，请放心，知道双缓冲可能会防止您的画布在重新绘制调用之间闪烁。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-05T21:19:26.717

```
<html>
  <body style="height: 100%; margin: 0;">
    <canvas style="width: 100%; height: 100%;"></canvas>
  </body>
</html> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T21:19:26.860

在 CSS 中，将 html、body（和 asp.net 中的表单）标签的宽度和高度设置为 100%。

但是，在较旧的 IE 中不起作用。

# sql - 是否可以将输出参数与 ExecuteQuery 一起使用 ?

> ID：517956
> 
> 赞同：2
> 
> 时间：2009-02-05T21:16:08.503
> 
> 标签：sql, linq-to-sql, stored-procedures

通常，当你想直接通过 Linq to Sql 调用存储过程时，可以使用 ExecuteQuery 方法：

```
result = dc.ExecuteQuery<MyTable>("Exec myStoredProcedure"); 
```

如果需要带参数调用，可以通过字符串替换来添加：

```
string query = "Exec myStoredProcedure ";
for (int i = 0; i < parameters.Count - 1; i++) {
  query += " {" + i + "},";
}
query = query.TrimEnd(',');
result = dc.ExecuteQuery<MyTable>(query, parameters); 
```

但是，如果其中一个参数是输出变量怎么办？程序运行后是否可以取回该值？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-12-10T17:43:55.910

Alper Ozcetin 是对的，您可以在 *.dbml 中映射 StoredProcedures，并且可以使用 StoredProcedures 作为方法。

下面是使用 AdventureWorks DB 执行此操作的演示，适用于 vs2008 和 vs2010

使用 AdventureWorks，我创建了以下 Proc

```
CREATE PROC sp_test (@City  Nvarchar(60) , @AddressID int out  )
AS
SELECT TOP 10 * FROM Person.Address where City = @City
select  top 1  @AddressID  = AddressID FROM Person.Address where City = @City 
```

然后我将 sp_test 添加到 dbml 并编写了以下程序

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Data.Linq;

namespace Test
{
    class Program
    {
        static void Main(string[] args)
        {

            DataClasses1DataContext dc = new DataClasses1DataContext("SomeSQLConnection);

            int? AddressID = null;
            ISingleResult<sp_testResult> result = dc.sp_test("Seattle", ref AddressID);

            foreach (sp_testResult addr in result)
            {
                Console.WriteLine("{0} : {1}", addr.AddressID, addr.AddressLine1);
            }
            Console.WriteLine(AddressID);

        }
    }
} 
```

这导致以下输出

```
23 : 6657 Sand Pointe Lane
91 : 7166 Brock Lane
92 : 7126 Ending Ct.
93 : 4598 Manila Avenue
94 : 5666 Hazelnut Lane
95 : 1220 Bradford Way
96 : 5375 Clearland Circle
97 : 2639 Anchor Court
98 : 502 Alexander Pl.
99 : 5802 Ampersand Drive
13079 
```

您会注意到 sp_test 方法的输入是`ref`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T11:23:25.717

我不确定，但您可以尝试在查询中声明变量，将其作为输出参数传递，然后选择它：

```
//assuming you out parameter is integer
string query = "DECLARE @OUT INT ";
query += " Exec myStoredProcedure ";
for (int i = 0; i < parameters.Count - 1; i++) {
  query += " {" + i + "},";
}
//assuming the output parameter is the last in the list
query += " @OUT OUT ";
//select value from out param after sp execution
query += " SELECT @OUT" 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-23T10:52:32.447

您不需要为 ExecuteQuery 中的 StoredProcedures 编写原始 SQL。您可以在 *.dbml 中映射 StoredProcedures，并且可以将 StoredProcedures 用作方法。

# vba - 在 PowerPoint 2007 中捕获 DoubleClick

> ID：517962
> 
> 赞同：4
> 
> 时间：2009-02-05T21:17:40.060
> 
> 标签：vba, powerpoint

PowerPoint 2007的[`Application.WindowBeforeDoubleClick`](http://msdn.microsoft.com/en-us/library/bb231081.aspx)事件似乎不起作用（请参阅[此处](http://www.eggheadcafe.com/software/aspnet/29622159/windowbeforedoubleclick-e.aspx)以验证我的声明）。它适用于 PowerPoint 2003，但不适用于 2007（与文档相反）。

我正在寻找任何会在 PowerPoint 中捕获双击事件的内容，例如：

*   C++ 代码（理想情况下）
*   宏，VBA，类似的东西
*   为双击事件捕获 Windows 消息

最后一个可能是我的工作，但我不知道该怎么做。

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-02-24T02:44:08.973

你是对的，这似乎是一个错误。您可以改用该`WindowSelectionChange`事件。

# xml - 使用分隔符时的 XML 格式编号问题

> ID：517966
> 
> 赞同：2
> 
> 时间：2009-02-05T21:18:49.713
> 
> 标签：xml, xslt, xslt-1.0

我们正在开发一个能够显示价格的网页，其中空格是分组分隔符，逗号是小数分隔符。例如，该值`1234567.89`应显示为`1 234 567,89`。（我们实际上正在使用`&#160;`，所以我们得到了一个不间断的空间。）

这似乎是正确的 XSL，它几乎可以工作，但我得到一个“。” 其余部分之后的字符。所以我最终得到了 `"1 234 567,89."` 而不是 `"1 234 567,89"`.

```
<?xml version='1.0' encoding='iso-8859-1'?>

<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
xmlns:fo="http://www.w3.org/1999/XSL/Format"
xmlns:msxsl="urn:schemas-microsoft-com:xslt" 
xmlns:hsi="http://www.myfakecompany.com/fakey" 
extension-element-prefixes="msxsl hsi">

    <xsl:decimal-format name="euro" 
        decimal-separator="," 
        grouping-separator="&#160;"/>

    <xsl:template match="/">

    <xsl:value-of select="format-number(1234567.89, '#&#160;###.##;(#&#160;###.##)', 'euro')"/>

    </xsl:template>
</xsl:stylesheet> 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T21:26:30.370

设置小数分隔符后应用格式字符串，因此您需要将其更改为：

```
'#&#160;###,##;(#&#160;###,##)' 
```

即用逗号代替句点。

# python - 如何清除解释器控制台？

> ID：517970
> 
> 赞同：425
> 
> 时间：2009-02-05T21:19:20.087
> 
> 标签：python, windows, console

像大多数 Python 开发人员一样，我通常会打开一个控制台窗口，并运行 Python 解释器来测试命令、`dir()`东西`help() stuff`等。

像任何控制台一样，一段时间后，过去命令和打印的可见积压会变得杂乱无章，有时在多次重新运行同一命令时会感到困惑。我想知道是否以及如何清除 Python 解释器控制台。

我听说过进行系统调用并`cls`在 Windows 或`clear`Linux 上调用，但我希望有一些我可以命令解释器本身去做的事情。

**注意：**我在 Windows 上运行，所以`Ctrl+L`不起作用。

* * *

## 回答 #1

> 赞同：569
> 
> 时间：2009-02-05T21:25:08.377

正如您所提到的，您可以进行系统调用：

对于 Windows：

```
>>> import os
>>> clear = lambda: os.system('cls')
>>> clear() 
```

对于 Linux，它将是：

```
>>> import os
>>> clear = lambda: os.system('clear')
>>> clear() 
```

* * *

## 回答 #2

> 赞同：241
> 
> 时间：2009-03-26T02:42:42.737

这里有一些更方便的跨平台的东西

```
import os

def cls():
    os.system('cls' if os.name=='nt' else 'clear')

# now, to clear the screen
cls() 
```

* * *

## 回答 #3

> 赞同：94
> 
> 时间：2009-02-05T21:22:43.297

好吧，这里有一个快速破解：

```
>>> clear = "\n" * 100
>>> print clear
>>> ...do some other stuff...
>>> print clear 
```

或者为了节省一些输入，把这个文件放在你的 python 搜索路径中：

```
# wiper.py
class Wipe(object):
    def __repr__(self):
        return '\n'*1000

wipe = Wipe() 
```

然后，您可以随心所欲地从解释器中执行此操作:)

```
>>> from wiper import wipe
>>> wipe
>>> wipe
>>> wipe 
```

* * *

## 回答 #4

> 赞同：47
> 
> 时间：2018-05-28T06:54:38.723

这是您可以做的最简单的事情，它不需要任何额外的库。它清除屏幕并返回`>>>`到左上角。

```
print("\033[H\033[J", end="") 
```

**更新 1：**

由于这个答案得到了一些关注，您可能想知道它是如何工作的。上面的命令打印[ANSI 转义码](https://en.wikipedia.org/wiki/ANSI_escape_code)：

*   `\033`代表`ESC`（ANSI 值 27）。

*   `\033[`是一个特殊的[转义序列](https://en.wikipedia.org/wiki/ANSI_escape_code#Fe_Escape_sequences)，称为[控制序列引入器](https://en.wikipedia.org/wiki/ANSI_escape_code#CSIsection)(CSI)。

*   `\033[H`命令将光标移动到屏幕的左上角。

*   `\033[J`清除从光标到屏幕末尾的屏幕。

可选参数`end=""`避免在执行这些命令后打印换行符，因此`>>>`保留在最顶行。

**更新 2：**

您可能希望使用一个附加参数来扩展上述命令 - `x`(before `J`)：

```
print("\033[H\033[xJ", end="") 
```

*   如果`x`为 1，则从光标处清除到屏幕开头。
*   如果`x`为 2，将清除整个屏幕并将光标移动到左上角。
*   如果`x`为 3，它将清除整个屏幕并**删除保存在回滚缓冲区中的所有行**。

因此，此命令将清除所有内容，包括缓冲区：

```
print("\033[H\033[3J", end="") 
```

**命令行：**

要在 shell（控制台/终端）中清除屏幕，您可以使用相同的命令。要清除整个屏幕并删除保存在回滚缓冲区中的所有行，请将 3 放在前面`J`：

```
printf "\033[H\033[3J" 
```

或创建别名：

```
alias cls='printf "\033[H\033[3J"' 
```

* * *

## 回答 #5

> 赞同：43
> 
> 时间：2016-06-20T14:46:29.450

在 Windows 上有多种方法：

# 1.使用键盘快捷键：

```
Press CTRL + L 
```

# 2.使用系统调用方法：

```
import os
cls = lambda: os.system('cls')
cls() 
```

# 3.使用换行打印100次：

```
cls = lambda: print('\n'*100)
cls() 
```

* * *

## 回答 #6

> 赞同：31
> 
> 时间：2010-10-12T18:36:11.757

虽然这是一个较老的问题，但我想我会贡献一些东西来总结我认为最好的其他答案，并通过建议您将这些命令放入文件并设置您的 PYTHONSTARTUP 来添加我自己的皱纹指向它的环境变量。由于我目前在 Windows 上，因此这种方式略有偏差，但很容易偏向其他方向。

这是我发现的一些文章，描述了如何在 Windows 上设置环境变量：
    [何时使用 sys.path.append 以及何时修改 %PYTHONPATH% 就足够了](https://stackoverflow.com/a/4209102/355230)
    [如何在 Windows XP 中管理环境变量](http://support.microsoft.com/kb/310519)
    [配置系统和用户环境变量](http://technet.microsoft.com/en-us/library/bb726962.aspx)
    [如何使用全局系统Windows 中的环境变量](http://www.howtogeek.com/51807/how-to-create-and-use-global-system-environment-variables/)

顺便说一句，即使文件中有空格，也不要在文件路径周围加上引号。

无论如何，这是我对放入（或添加到您现有的）Python 启动脚本的代码的看法：

```
# ==== pythonstartup.py ====

# add something to clear the screen
class cls(object):
    def __repr__(self):
        import os
        os.system('cls' if os.name == 'nt' else 'clear')
        return ''

cls = cls()

# ==== end pythonstartup.py ==== 
```

顺便说一句，您还可以使用[@Triptych 的](https://stackoverflow.com/questions/517970/how-to-clear-python-interpreter-console/517992#517992) `__repr__`技巧将其更改`exit()`为 just `exit`（及其别名同上`quit`）：

```
class exit(object):
    exit = exit # original object
    def __repr__(self):
        self.exit() # call original
        return ''

quit = exit = exit() 
```

最后，还有一些其他的东西可以将主解释器提示从*cwd* +更改`>>>`为：*`>>>`*

 *```
class Prompt:
    def __str__(self):
        import os
        return '%s >>> ' % os.getcwd()

import sys
sys.ps1 = Prompt()
del sys
del Prompt 
```

* * *

## 回答 #7

> 赞同：25
> 
> 时间：2015-08-28T21:32:00.337

毫无疑问，最快和最简单的方法是`Ctrl`+ `L`。

这与终端上的 OS X 相同。

* * *

## 回答 #8

> 赞同：18
> 
> 时间：2015-06-03T11:44:59.280

我这样做的方法是编写一个像这样的函数：

```
import os
import subprocess

def clear():
    if os.name in ('nt','dos'):
        subprocess.call("cls")
    elif os.name in ('linux','osx','posix'):
        subprocess.call("clear")
    else:
        print("\n") * 120 
```

然后调用`clear()`清除屏幕。这适用于 windows、osx、linux、bsd ......所有操作系统。

* * *

## 回答 #9

> 赞同：12
> 
> 时间：2020-12-17T15:29:57.253

完美的 cls，也兼容 Python2（在 .pythonrc 文件中）：

```
from __future__ import print_function
cls = lambda: print("\033c", end='') 
```

并且可以通过这种方式从终端调用：

```
cls() 
```

或直接：

```
print("\033c", end='') 
```

`\033[H\033[J``clear`仅清除可见屏幕，与 Ubuntu 18.10 之前的命令完全相同。它不会清除回滚缓冲区。向上滚动将显示历史记录。

要模拟这种行为，请插入一些终端线，然后按下`Ctrl+L`并插入更多。执行后`print("\033[H\033[J", end="")`，只会删除按“Ctrl + L”后插入的屏幕行。

`\033c`清除一切。

`\x1bc`可能不会给出相同的结果，`\033c`因为十六进制转义没有明确的长度限制。

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2018-06-26T12:51:40.170

这是一个跨平台（Windows / Linux / Mac / 可能是您可以在 if 检查中添加的其他平台）版本片段，我结合了在这个问题中找到的信息：

```
import os
clear = lambda: os.system('cls' if os.name=='nt' else 'clear')
clear() 
```

同样的想法，但用了一勺语法糖：

```
import subprocess   
clear = lambda: subprocess.call('cls||clear', shell=True)
clear() 
```

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2018-11-19T11:17:31.877

对于 python 控制台类型中的 mac 用户

```
import os
os.system('clear') 
```

用于窗户

```
os.system('cls') 
```

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2009-04-17T04:58:19.230

Wiper 很酷，它的好处是我不必在它周围输入“()”。这是它的细微变化

```
# wiper.py
import os
class Cls(object):
    def __repr__(self):
        os.system('cls')
        return '' 
```

用法很简单：

```
>>> cls = Cls()
>>> cls # this will clear console. 
```

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2015-06-28T20:31:32.127

我不确定 Windows 的“shell”是否支持这一点，但在 Linux 上：

`print "\033[2J"`

[https://en.wikipedia.org/wiki/ANSI_escape_code#CSI_codes](https://en.wikipedia.org/wiki/ANSI_escape_code#CSI_codes)

在我看来，打电话通常是个坏主意`cls`。`os`想象一下，如果我设法更改您系统上的 cls 或 clear 命令，并且您以管理员或 root 身份运行脚本。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2012-07-17T16:38:19.210

这是合并**所有其他答案**[的最终解决方案](https://gist.github.com/3130325)。特征：

 **1.  您可以将代码**复制粘贴**到您的 shell 或脚本中。
2.  您可以随意**使用**它：

    ```
    >>> clear()
    >>> -clear
    >>> clear  # <- but this will only work on a shell 
    ```

3.  您可以**将**其作为模块导入：

    ```
    >>> from clear import clear
    >>> -clear 
    ```

4.  您可以**将**其称为脚本：

    ```
    $ python clear.py 
    ```

5.  它是**真正的多平台**；如果它无法识别您的系统
    （`ce`、或） `nt`，它将退回到打印空白行。`dos``posix`

* * *

您可以在此处下载 [完整] 文件：[https](https://gist.github.com/3130325)
://gist.github.com/3130325 或者如果您只是在寻找代码：

```
class clear:
 def __call__(self):
  import os
  if os.name==('ce','nt','dos'): os.system('cls')
  elif os.name=='posix': os.system('clear')
  else: print('\n'*120)
 def __neg__(self): self()
 def __repr__(self):
  self();return ''

clear=clear() 
```

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2016-05-09T01:19:38.010

我使用[iTerm](https://www.iterm2.com/)和 Mac OS 的本机终端应用程序。

我只需按 ⌘ + k

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2009-02-05T23:03:55.337

使用空闲。它有许多方便的功能。 `Ctrl+F6`，例如，重置控制台。关闭和打开控制台是清除它的好方法。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2018-07-19T06:17:04.460

最简单的方法是使用 os 模块

```
>>> import os
>>> clear = lambda: os.system('clear')
>>> clear() 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2019-07-02T20:45:58.773

如果您不需要通过代码来完成，只需按 CTRL+L

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2011-09-01T02:13:46.800

**这里有两种很好的方法：**

**1.**

```
import os

# Clear Windows command prompt.
if (os.name in ('ce', 'nt', 'dos')):
    os.system('cls')

# Clear the Linux terminal.
elif ('posix' in os.name):
    os.system('clear') 
```

**2.**

```
import os

def clear():
    if os.name == 'posix':
        os.system('clear')

    elif os.name in ('ce', 'nt', 'dos'):
        os.system('cls')

clear() 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2011-11-08T18:56:43.727

我在 Windows XP、SP3 上使用 MINGW/BASH。

（把它放在 .pythonstartup 中） # 我的 ctrl
-l 已经有点用了，但这可能对其他人有所帮助

# 这在 BASH 中有效，因为我在 .inputrc 中也有它，但是由于某些
原因，当我进入 Python 时它会被丢弃
readline.parse_and_bind('\Cy: kill-whole-line')

* * *

我再也无法忍受输入 'exit()' 并且对 martineau/Triptych 的技巧感到高兴：

我稍微修改了一下（卡在 .pythonstartup 中）

```
class exxxit():
    """Shortcut for exit() function, use 'x' now"""
    quit_now = exit # original object
    def __repr__(self):
        self.quit_now() # call original
x = exxxit() 
```

* * *

```
Py2.7.1>help(x)
Help on instance of exxxit in module __main__:

class exxxit
 |  Shortcut for exit() function, use 'x' now
 |
 |  Methods defined here:
 |
 |  __repr__(self)
 |
 |  ----------------------------------------------------------------------
 |  Data and other attributes defined here:
 |
 |  quit_now = Use exit() or Ctrl-Z plus Return to exit 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2011-12-11T11:19:25.313

`clear`Linux 和 Windows 中的 OS 命令会`cls`输出一个“魔术字符串”，您可以直接打印它。要获取字符串，请使用 popen 执行命令并将其保存在变量中以供以后使用：

```
from os import popen
with popen('clear') as f:
    clear = f.read()

print clear 
```

在我的机器上，字符串是`'\x1b[H\x1b[2J'`.

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2013-03-25T19:41:24.763

我是 python 的新手（真的很新），并且在我正在阅读的一本书中熟悉他们教如何创建这个小函数来清除控制台中可见的积压和过去的命令和打印的语言：

打开shell/新建文档/创建函数如下：

```
def clear():
    print('\n' * 50) 
```

将它保存在 python 目录中的 lib 文件夹中（我的是 C:\Python33\Lib） 下次你需要清除控制台时，只需调用该函数：

```
clear() 
```

就是这样。PS：您可以随意命名您的功能。我看到人们使用“wiper”“wipe”和变体。

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2015-07-26T18:37:17.893

如果它在mac上，那么一个简单`cmd + k`的就可以了。

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2018-04-10T22:00:09.973

只需输入

```
import os
os.system('cls') # Windows
os.system('clear') # Linux, Unix, Mac OS X 
```

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2019-12-20T04:42:34.957

Arch Linux（`xfce4-terminal`使用 Python 3 测试）：

```
# Clear or wipe console (terminal):
# Use: clear() or wipe()

import os

def clear():
    os.system('clear')

def wipe():
    os.system("clear && printf '\e[3J'") 
```

... 添加到`~/.pythonrc`

*   `clear()`清屏
*   `wipe()`擦除整个终端缓冲区

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2009-02-05T23:51:51.620

编辑：我刚刚读过“windows”，这是为linux用户准备的，对不起。

* * *

在 bash 中：

```
#!/bin/bash

while [ "0" == "0" ]; do
    clear
    $@
    while [ "$input" == "" ]; do
        read -p "Do you want to quit? (y/n): " -n 1 -e input
        if [ "$input" == "y" ]; then
            exit 1
        elif [ "$input" == "n" ]; then
            echo "Ok, keep working ;)"
        fi
    done
    input=""
done 
```

将其保存为“whatyouwant.sh”，chmod +x 然后运行：

```
./whatyouwant.sh python 
```

或python以外的东西（空闲，随便）。这将询问您是否真的要退出，如果不是，它会重新运行 python（或您作为参数提供的命令）。

这将清除所有屏幕和所有变量/对象/您在 python 中创建/导入的任何内容。

在 python 中，当您想退出时，只需键入 exit()。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2011-03-20T14:51:23.217

这应该是跨平台的，并且还使用首选[而](http://docs.python.org/library/os.html#os.system)`subprocess.call`不是`os.system`按照[文档](http://docs.python.org/library/os.html#os.system)。应该在 Python >= 2.4 中工作。[`os.system`](http://docs.python.org/library/os.html#os.system)

```
import subprocess
import os

if os.name == 'nt':
    def clearscreen():
        subprocess.call("cls", shell=True)
        return
else:
    def clearscreen():
        subprocess.call("clear", shell=True)
        return 
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2011-11-02T21:48:09.873

这个怎么样

```
- os.system('cls') 
```

这是尽可能短的！

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2012-03-17T17:08:50.343

```
>>> ' '*80*25 
```

**更新**：80x25 不太可能是控制台窗口的大小，因此要获得真正的控制台尺寸，请使用[寻呼机](https://pypi.python.org/pypi/pager)模块中的功能。Python 没有提供与核心发行版类似的任何东西。

```
>>> from pager import getheight
>>> '\n' * getheight() 
```

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2013-07-08T21:24:28.197

好的，所以这是一个技术含量较低的答案，但我使用的是 Notepad++ 的 Python 插件，结果你可以通过右键单击控制台并单击“清除”来手动清除控制台。希望这可以帮助那里的人！

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2013-09-17T10:00:57.090

我发现最简单的方法就是关闭窗口并运行模块/脚本来重新打开 shell。

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2014-01-18T21:54:03.930

上面提到了魔术字符串 - 我相信它们来自 terminfo 数据库：

[http://www.google.com/?q=x#q=terminfo](http://www.google.com/?q=x#q=terminfo)

[http://www.google.com/?q=x#q=tput+command+in+unix](http://www.google.com/?q=x#q=tput+command+in+unix)

```
$ tput clear| od -t x1z
0000000 1b 5b 48 1b 5b 32 4a                             >.[H.[2J<
0000007 
```

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2014-05-19T06:15:17.903

就用这个..

`print '\n'*1000`

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2015-04-08T16:35:45.917

我正在使用 Spyder (Python 2.7) 并清理我使用的解释器控制台

％清除

这会强制命令行转到顶部，我不会看到以前的旧命令。

或者我在控制台环境中单击“选项”并选择“重新启动内核”以删除所有内容。

* * *

## 回答 #35

> 赞同：1
> 
> 时间：2016-08-17T00:05:00.730

我可能迟到了，但这是一个非常简单的方法

类型：

```
def cls():
    os.system("cls") 
```

因此，您想清除屏幕的内容只需输入您的代码

```
cls() 
```

最好的办法！（信用：[https](https://www.youtube.com/watch?annotation_id=annotation_3770292585&feature=iv&src_vid=bguKhMnvmb8&v=LtGEp9c6Z-U) ://www.youtube.com/watch?annotation_id=annotation_3770292585&feature=iv&src_vid=bguKhMnvmb8&v=LtGEp9c6Z-U ）

* * *

## 回答 #36

> 赞同：1
> 
> 时间：2019-11-13T02:35:22.480

这是一个使用名为[OS](https://docs.python.org/library/os.html)的包的非常简单的技巧（如果你想明确作为一个函数）：

> 键盘快捷键

**cmd/ctrl + k**

* * *

> Python 代码编辑器

```
#from the package OS, import: system, and name.

from os import system, name

#create a function called clear(). You can name this anything you want.
def clear():

#the method is different depending on what computer you are using.
    if name == "nt":

        #if windows, linux
        _ = system("cls")

    else:
        #mac, etc.
        _ = system("clear")

# we use " _ = system("clear") " as the function system returns a number in this case, 0. 
```

* * *

* * *

## 回答 #37

> 赞同：1
> 
> 时间：2021-09-19T22:17:02.077

有很多方法可以做到这一点，这里有两种我会做的方法。

#1：没那么先进：

```
print("\n"*150) 
```

这会在控制台上打印一个新行 150 次，这足以让它看起来像所有其他行都消失了。

#2 不是那么高级，但你需要对 Python 有一些了解：

```
from os import system, name, quit
class clearNotSupported(Exception):
  quit()
def clear():
  try:
      if name == 'nt':
          _ = system('cls')
      elif name == 'posix':
          _ = system('clear')
  except:
    raise clearNotSupported() 
```

这些代码行基本上是伪代码，试着看看操作系统的名字是什么，如果是 NT 它将运行 Windows 的 clear 命令，如果是 POSIX 它将运行 Mac OS 和 Linux 的 clear 命令，并且如果出现错误，它将引发异常 clearNotSupported() 并且该异常告诉计算机关闭程序。

如果这可行，请单击绿色复选标记，这样我就知道了。

# mysql - 如何修复 libmysqlclient.15.dylib 未加载导致的错误？

> ID：517976
> 
> 赞同：9
> 
> 时间：2009-02-05T21:19:46.017
> 
> 标签：mysql, ruby-on-rails, rubygems

我已升级到 Rails 2.2.2 并安装了 MySQL 2.7 gem，当我尝试运行迁移或启动服务器时看到此错误：

```
dlopen(/Library/Ruby/Gems/1.8/gems/mysql-2.7/lib/mysql.bundle, 9): Library not loaded: /usr/local/mysql/lib/mysql/libmysqlclient.15.dylib
Referenced from: /Library/Ruby/Gems/1.8/gems/mysql-2.7/lib/mysql.bundle
Reason: image not found - /Library/Ruby/Gems/1.8/gems/mysql-2.7/lib/mysql.bundle 
```

解决方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-05T21:21:35.280

为了他人的利益回答我自己的问题。

[我在这里](http://installingcats.com/2007/12/13/mysql-ruby-gem-install-problem-on-mac-os-x-leopard/)找到了修复。

跑：

```
sudo install_name_tool -change /usr/local/mysql/lib/mysql/libmysqlclient.15.dylib /usr/local/mysql/lib/libmysqlclient.15.dylib /Library/Ruby/Gems/1.8/gems/mysql-2.7/lib/mysql.bundle
sudo install_name_tool -change /usr/local/mysql/lib/mysql/libmysqlclient.15.dylib /usr/local/mysql/lib/libmysqlclient.15.dylib /Library/Ruby/Gems/1.8/gems/mysql-2.7/mysql.bundle 
```

为我工作。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-06-13T13:26:02.030

我不得不从旧参考中删除目录：

```
sudo install_name_tool -change libmysqlclient.18.dylib
    /usr/local/mysql/lib/libmysqlclient.18.dylib
    /Library/Ruby/Gems/1.8/gems/mysql-2.7/lib/mysql.bundle

sudo install_name_tool -change libmysqlclient.18.dylib 
    /usr/local/mysql/lib/libmysqlclient.18.dylib
    /Library/Ruby/Gems/1.8/gems/mysql-2.7/mysql.bundle 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-10-27T19:06:16.513

使用 sudo 通常会导致意外问题。对我有用的是卸载 mysql2 gem 并重新安装它。

`gem uninstall mysql2` `bundle`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-05-16T12:05:38.890

如果 Gabe Hollombe 解决方案不起作用，那么试试这个

```
sudo install_name_tool -change libmysqlclient.15.dylib /usr/local/mysql/lib/libmysqlclient.15.dylib /Library/Ruby/Gems/1.8/gems/mysql-2.7/lib/mysql.bundle

sudo install_name_tool -change libmysqlclient.15.dylib /usr/local/mysql/lib/libmysqlclient.15.dylib /Library/Ruby/Gems/1.8/gems/mysql-2.7/mysql.bundle 
```

# .net - 你用你的单元测试测试什么？

> ID：517977
> 
> 赞同：29
> 
> 时间：2009-02-05T21:19:47.623
> 
> 标签：.net, asp.net-mvc, unit-testing, tdd

如今，TDD 似乎是每个人都在谈论的东西，我自己也尝试过一些，但我认为我没有得到这个想法。我正在掌握如何编写单元测试，但我不明白我的单元测试应该测试什么。

1.  如果我有一个返回数据列表的操作方法，我应该验证什么？只有视图名称是正确的，还是我也应该验证数据？
2.  如果我也应该测试数据，我不会写两次相同的代码吗？如果我使用相同的方法来检索要比较的数据，那么测试数据有什么用？
3.  我也应该测试添加/编辑数据的方法吗？如何以正确的方式验证已添加/编辑/删除记录？

我知道这是相当多的大问题，但我并没有通过阅读互联网上的文章变得更聪明，因为他们似乎都关心*如何*测试，而不是关心*什么*。

举个例子——我有（或者，我要写）一个GuestbookController，带有查看、添加、编辑和删除帖子的方法。我需要测试什么？我该怎么做？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-02-05T22:01:26.120

# 单元测试（UT）！= 测试驱动设计（TDD）

这种混淆似乎相当普遍。UT 是关于代码覆盖率的。TDD 关注*特性*。它们*不是*一回事[对不起乔尔！]

使用 UT，您可以编写任何您想要的代码，然后返回并测试每个函数（甚至是一些微不足道的函数）。

使用 TDD，您可以选择下一个功能并*首先为该功能编写测试*。只写那个特性的测试，测试覆盖率是*无关紧要*的。您首先编写测试以强制预先做出接口决策。然后你编写代码以通过测试（记住“最简单的可能工作”）。然后根据所学的内容重构代码。然后你继续下一个功能（大概在签入并重新运行*所有*单元测试之后）。

如果需要，使用 TDD 进行开发，然后返回并使用 UT 工具完成覆盖。如果您正在创建类库或其他 API 供开发人员使用，测试覆盖率越高越好；-)

如果您只是编写一个应用程序来做五件特定的事情，那么仅 TDD 就足够了。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-06T19:00:06.000

我认为这里有一点[Shu-Ha-Ri](http://alistair.cockburn.us/Shu+Ha+Ri)。你在问一个很难解释的问题。只有在练习并努力应用 TDD 之后，您才能获得 What。在那之前，我们会给你一些没有意义的答案，告诉你[Monads Are Burritos](http://byorgey.wordpress.com/2009/01/12/abstraction-intuition-and-the-monad-tutorial-fallacy/)的精神。这对你没有帮助，我们听起来像白痴（monads 显然是柠檬雪纺馅饼）。

我建议获取 Kent Beck 的[TDD 书籍](https://rads.stackoverflow.com/amzn/click/com/0321146530)并完成它，然后只是练习。“没有通往里的王道。”

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-05T22:34:14.943

测试你正在测试的模块接口的**契约：**

*   如果客户在使用您的课程时期望特定行为，请对其进行测试。
*   如果您的类应该阻止客户端的某些行为，如其合同中定义的那样，请对其进行测试。

*客户端我的意思是使用你的类的代码。
我所说的预期行为是指方法对返回值和对象状态的预期结果。*

并将您的测试重点放在**逻辑**上（if、for、while 等），因为像属性这样的扁平事物在不被应用程序的正常使用捕获的情况下失败的可能性较小。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-06T11:35:46.803

这些是我认为对单元测试有用的通用指南：

1) 识别边界对象（Win/WebForms、CustomControls 等）。

2）识别控制对象（业务层对象）

3) 确保至少为边界对象调用的控制对象公共方法编写单元测试。

这样您就可以确保您涵盖了应用程序的主要功能方面（特性），并且不会冒微测试的风险（除非您愿意）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-06T11:50:24.213

在 TDD 中，您编写系统行为规范并使用它们来驱动系统设计。你为一个微小的行为编写一个测试，然后观察测试失败，然后编写代码以通过测试。通过定期重构，您始终保持尽可能高的代码质量，以便更轻松地进行更多更改。

如何进行 TDD 的示例：http: [//butunclebob.com/ArticleS.UncleBob.TheThreeRulesOfTdd](http://butunclebob.com/ArticleS.UncleBob.TheThreeRulesOfTdd) [http://butunclebob.com/ArticleS.UncleBob.TheBowlingGameKata](http://butunclebob.com/ArticleS.UncleBob.TheBowlingGameKata)

[另请参阅编写单元测试标准的](https://stackoverflow.com/questions/507000/writing-standards-for-unit-testing/510996#510996)答案- 它包含示例和链接以获取更多信息。这里也有很好的链接：[http ://code.google.com/p/instinct/wiki/UsersGuide](http://code.google.com/p/instinct/wiki/UsersGuide)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-05T21:31:05.370

1.  对于给定的输入或状态，您应该测试方法的返回值是否符合您的预期。如果您的方法返回许多类型的数据，您应该验证它们都是正确的。
2.  在您的测试用例中使用一小组样本数据。不要从磁盘或数据库加载任何内容。在您的测试中传入一个字符串或在那里构造测试对象。鉴于您希望从您的方法中获得非常具体的结果的那一小部分数据，您可以将其与实际结果进行比较。您希望避免在测试中为您计算值的代码过多，因为这样您就必须为您的测试编写测试以确保它们正常工作！
3.  测试您编写的每一段代码。要添加记录（如果您的测试连接到测试数据库），您可以简单地查询最后插入的记录，或者比较之前和之后的记录总数，并确保它增加了 1。如果您有一个模拟/存根框架，您可以跳过数据库并断言调用了将内容保存到数据库的方法。要测试编辑，只需再次从数据库中检索已编辑的记录并断言该值已从其旧值更改。或者如果模拟/存根，则正确调用了更改属性值的方法。

但实际上，为*即将编写*的代码编写一个测试。看着它失败。然后编写足够的代码使其通过。现在编写另一个测试并重复。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-05T21:31:41.123

我认为您可以通过测试驱动开发/测试优先开发从单元测试中获得最大收益。您应该首先编写测试，然后编写通过测试的代码。你应该首先测试什么？

我发现从用户故事编写测试非常有用。大多数时候我从用户故事开始编写自上而下的风格测试。例如我们的用户故事包含这样一个任务：

1.  当用户保存订单视图时应显示信息消息。

我通常从表示/控制器层为这个故事编写测试

```
 [Test]
    public void When_User_Save_Order_View_Should_Display_Information_Message()
    {
        using (mockRepository.Record())
        {
            repository.Save(order);
            view.Message= "Order saved successfully";
        }

        using (mockRepository.Playback())
        {
            presenter = new OrderSavePresenter(view, orderRepository);
            presenter.Save();
        }
    } 
```

然后我继续为我模拟或需要的每个类编写测试。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-02-05T21:31:58.020

我不会费心测试简单的东西，比如 getter 或 setter。您不需要测试编译器本身，因此在调用 setter 时检查是否分配了值是没有用的。

一般来说，我尝试为具有实际代码的类的每个方法编写一个单元测试。这样，如果有人后来破坏了一个方法，它就会被抓住。

例如，有人更改了“addElements(String[] elements)”之类的方法。他们试图使用“for(int i=0;i<=elements.length;i++)”。签入后运行单元测试时引发了越界异常，并且已修复。

对于GuestBookController 之类的东西，可能有一些方法可以离线测试，但您可能需要实际建立与测试数据库服务器的连接。从那里开始，进行添加帖子、编辑帖子和删除帖子的测试，并使用检索帖子的方法在每个地方验证发生的更改。

单元测试应该让你对你的代码工作更有信心，并且当你做出改变时它仍然有效。添加单元测试代码，直到您确信它已经过充分测试。在上面的示例中，您不必担心意外破坏留言簿。当您对代码进行更改时，单元测试会确认您仍然可以添加、删除、编辑和检索帖子。

# asp.net-mvc - 在 MVC 中处理重复表单的最佳方法是什么？

> ID：517984
> 
> 赞同：5
> 
> 时间：2009-02-05T21:21:21.783
> 
> 标签：asp.net-mvc

我能想到的最好的公开例子就是亚马逊购物车。您有一个页面显示多个不同的记录，这些记录可以更新多个不同的字段。

我不能将每一个都放在一个表单标签中，因为用户可能会修改多个记录然后提交。

我不能只更新我返回的所有记录，因为：
1\. 性能
2\. 审计
3\. 如果有人更改了用户在查看页面时“没有更改”的记录，然后用户提交了这些更改将被覆盖。

那么如何最好地处理取回数据，然后获取哪些记录发生了变化呢？

明白了吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-06T15:33:50.083

使用绑定！不要在您的操作中迭代表单集合。

史蒂夫桑德森写了[一篇](http://blog.codeville.net/2008/12/22/editing-a-variable-length-list-of-items-in-aspnet-mvc/)关于如何做到这一点的博客文章。我写了[一篇](http://lunaverse.wordpress.com/2009/01/13/editing-a-variable-length-list-of-items-with-mvccontribfluenthtml-take-2/)关于如何使用[MvcContrib](http://www.codeplex.com/MVCContrib)的博客文章。[流利](http://lunaverse.wordpress.com/2008/11/24/mvcfluenthtml-fluent-html-interface-for-ms-mvc/)的HTML 。两篇文章都非常详细，并包含可下载的代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T21:25:58.407

在转发器中生成表单，并将 ID 附加到随每个新表单递增的表单元素。将重复表单元素的数量保存在隐藏字段中。然后在您的控制器中，读取此隐藏字段的值 - 这将是要读取的表单数。然后，在一个循环中，通过指定字段的名称以及附加到名称的循环索引作为键来检索每个表单的字段。

您可以使用一些 javascript 逻辑来检测表单的值何时发生变化，并在发生这种情况时更新该表单部分中的隐藏字段；或者您可以将原始值隐藏在每个表单部分的隐藏字段中（尽管我不建议这样做，因为太多的字段/表单会使您的页面膨胀）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T21:29:26.993

一种（但不一定是最好的）方法是将更改的项目存储在 js 变量中，或者在客户端*更改时存储它们*，然后仅发送与用户收到的实际不同的数据。

正如 Erik 所说，您可以使用隐藏的表单元素来确保它在没有 js 的情况下也能正常工作。

# sql - 在 Microsoft Access 中从 ... 中选择顶部（除 10 之外）

> ID：517989
> 
> 赞同：12
> 
> 时间：2009-02-05T21:22:15.557
> 
> 标签：sql, ms-access, jet

说我有一个查询

```
SELECT TOP 10 ... FROM ... ORDER BY ... 
```

在 Access 中（嗯，真的是 Jet）。问题是：我怎样才能得到所有其他行......*除了*前 10 名之外的所有内容？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-02-05T21:25:09.437

你不能做类似的事情吗

```
SELECT ... FROM ...
WHERE PK NOT IN (SELECT TOP 10 PK FROM ...)
ORDER BY ... 
```

它可能效率不高，但这是我能想到的唯一方法。AFAIK SQL 中没有“BOTTOM”子句 :)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-05T21:27:31.023

```
SELECT ... FROM ....
WHERE myID NOT IN 
    (SELECT TOP 10 myID FROM ... ORDER BY rankfield)
ORDER BY sortfield 
```

请注意，您的排序顺序可能（如果您愿意）与您的排序顺序不同。

**编辑**：另一个想法：如果你已经知道有多少 TOTAL 行，你可以这样做（假设 1000 行）：

```
SELECT TOP 990 ... FROM .... ORDER BY sortfield DESC 
```

只需翻转排序，然后取出剩余部分。

当然，如果你仍然想要原始顺序的结果，你必须做一些愚蠢的事情，比如：

```
SELECT ... 
FROM (SELECT TOP 990 ... FROM .... ORDER BY sortfield DESC)
ORDER BY sortfield ASC 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-09T17:17:08.613

您可以创建一个排名字段（[创建排名列的方法](http://support.microsoft.com/kb/208946)）并从中过滤掉：其中排名>10

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-12T14:50:01.880

这通常在“客户端”端完成，而不是在 DBMS 上完成，即将所有表的行提取到 ADO Classic 记录集中，然后使用 Filter 属性根据条件删除 10 行，或者排序然后设置然后跳过第一/最后 10 行，或根据需要设置页面长度，然后跳过第一页/最后一页等。它不仅取决于行数，还取决于目标应用程序，例如我知道这是否是一个 MS Access 报告然后过滤掉不需要的行可能会很麻烦。

# php - PHP RecursiveIteratorIterator 和嵌套集

> ID：517998
> 
> 赞同：5
> 
> 时间：2009-02-05T21:23:31.547
> 
> 标签：php, recursion, iterator, nested-sets

我在层次结构中有一组对象。有一个顶部的“根”节点，它具有子节点，子节点又具有子节点等。我正在尝试使用嵌套集模型将此结构保存到数据库中，其中每个节点的每个“边”都被编号以定义层次结构，如[在 MySQL 中管理分层数据](http://mikehillyer.com/articles/managing-hierarchical-data-in-mysql/)：

[![替代文字](https://i.stack.imgur.com/4qfe6.png)](https://i.stack.imgur.com/4qfe6.png)
[（来源：[mysql.com](http://dev.mysql.com/tech-resources/articles/hierarchical-data-4.png)）]

我的问题是计算左右值。我通常使用 RecursiveIteratorIterator 来遍历层次结构，但是如果不求助于通过引用解析索引变量的递归函数，我无法弄清楚如何计算数字。

有任何想法吗？

这可能没用，但这是我目前拥有的（不正确的）代码：

```
$iterator = new RecursiveIteratorIterator(
    new Node_List(array($root)),
    RecursiveIteratorIterator::SELF_FIRST);

$i = 0;     
foreach ($iterator as $node) {
    $node->left = ++$i;
    $node->right = ++$i;
} 
```

如您所见，这将给出如下结果：

```
Node 
    Node 
    Node 
```

左右值：

```
Node (1, 2)
    Node (3, 4)
    Node (5, 6) 
```

当他们应该是：

```
Node (1, 6)
    Node (2, 3)
    Node (4, 5) 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-05T23:08:19.900

我想通了，这是解决方案（简化）：

```
$iterator = new RecursiveIteratorIterator(
    new Site_Node_List(array($root)),
    RecursiveIteratorIterator::SELF_FIRST);

$sides = array();
$s = 0;
$i = 0;
$parents = array();
foreach ($iterator as $item) {
    $js = array_splice($parents, $depth, count($parents), array($i));
    foreach (array_reverse($js) as $j) {
        $sides[$j]['right'] = ++$s;
    }
    $sides[$i]['left'] = ++$s;
    $i++;
}
foreach (array_reverse($parents) as $j) {
    $sides[$j]['right'] = ++$s;
} 
```

这是我实际代码的简化版本，因为它只是将“边”值存储在一个单独的数组中，但它演示了原理。

基本思想是将所有父节点（由深度值跟踪）存储在一个数组中，并且只在循环中写入“左”值。然后，当深度减小时，这意味着您已经回到了层次结构，因此父数组被拼接以删除不再相关的数组，并且它们被循环（反向）设置“正确”值。最后，您必须在最后循环剩余的父母。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T21:43:10.353

没有递归是不可能解决这个问题的。您需要以下内容：

```
function tag_recursive($node, &$number) {
    $node->left = $number++;
    foreach ($node->children as &$child) {
        tag_recursive($child, $number);
    }
    $node->right = $number++;
}

function tag($node) {
    $number = 1;
    tag_recursive($node, $number);
    // $number is now highest id + 1
} 
```*********