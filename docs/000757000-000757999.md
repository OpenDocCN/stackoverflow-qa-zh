# StackOverflow 问答 000757000-000757999

# c# - 使用 crypt32.dll 创建签名证书

> ID：757001
> 
> 赞同：3
> 
> 时间：2009-04-16T16:43:59.730
> 
> 标签：c#, ssl, certificate

我想在 C#.net 中以编程方式创建由 CA 签名的证书。我能够使用 CertCreateSelfSignCertificate 创建一个自签名证书，如下所述：http: [//msdn.microsoft.com/en-us/library/aa376039 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa376039(VS.85).aspx) [在没有 makecert 的情况下在 Windows 中创建自签名证书？](https://stackoverflow.com/questions/187588/self-signed-certificate-in-windows-without-makecert)

我正在查看 MSDN 文档，但似乎找不到生成证书并从请求中对其进行签名的功能。大多数功能似乎是用于操作证书存储。我在这里吠叫错误的dll吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-11-19T09:59:01.130

我也尝试了非托管方法，但没有成功。与此相反，使用[BouncyCastle](http://www.bouncycastle.org)创建证书轻而易举：

```
var keygen = new RsaKeyPairGenerator();
keygen.Init(new KeyGenerationParameters(new SecureRandom(), 2048));

var keys = keygen.GenerateKeyPair();

var certGen = new X509V3CertificateGenerator();
var dnName = new X509Name("CN=Test CA");

certGen.SetSerialNumber(BigInteger.ValueOf(1));
certGen.SetIssuerDN(dnName);
certGen.SetNotBefore(DateTime.Today);
certGen.SetNotAfter(DateTime.Today.AddYears(10));
certGen.SetSubjectDN(dnName);
certGen.SetPublicKey(keys.Public);
certGen.SetSignatureAlgorithm("SHA1WITHRSA");

var cert = certGen.Generate(keys.Private); 
```

这是一个自签名的 CA 证书，但创建签名证书是一样的。只需更改发行者和签名私钥即可。您还可以将证书导出到 DER (.cer) 和 PKCS12 (.p12)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T18:36:33.967

我的倾向是首先尝试使用[capicom.dll](http://msdn.microsoft.com/en-us/library/aa375732(VS.85).aspx)。它基本上是cryptoapi的包装器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-17T14:09:28.983

我找到了答案。我在调试器中加载了 makecert.exe，发现它正在使用此调用来创建签名证书：CryptSignAndEncodeCertificate [http://msdn.microsoft.com/en-us/library/aa380277(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa380277(VS.85).aspx)

# c# - XamlWriter 无法序列化 WinForms 应用程序中的对象

> ID：757003
> 
> 赞同：0
> 
> 时间：2009-04-16T16:44:07.437
> 
> 标签：c#, winforms, xaml, serialization

显然 XamlWriter 在 WinForms 应用程序中无法正常工作。

XamlWriter 使用 MarkupWriter.GetMarkupObjectFor(object obj)。我想确定要序列化的完整属性列表存在问题。

var ar = new AssemblyReference(AppDomain.CurrentDomain.GetAssemblies().First()); var str = XamlWriter.Save(ar);

运行 ASP.NET 或 WPF 应用程序，我得到了以下结果：

```
<AssemblyReference AssemblyName="mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" 
HintPath="file:///c:/WINDOWS/Microsoft.NET/Framework/v2.0.50727/mscorlib.dll" 
SpecificVersion="False" xmlns="clr-namespace:Ivolutia.TypeModel;assembly=ivoTypeModel" /> 
```

但是在 WinForms 应用程序中运行相同的代码我得到了这个：

```
<AssemblyReference xmlns="clr-namespace:Ivolutia.TypeModel;assembly=ivoTypeModel" /> 
```

这是类定义：

```
public class AssemblyReference : DependencyObject
{
    public string AssemblyName { get; set; }
    public string HintPath { get; set; }
    public bool SpecificVersion { get; set; }

    public AssemblyReference() { }

    public AssemblyReference(Assembly assembly)
        {
            AssemblyName = assembly.FullName;
            HintPath = assembly.CodeBase;
        }

        public override string ToString()
        {
            return AssemblyName;
        }
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-20T20:01:26.960

你确定吗？我刚刚创建了一个临时 WinForms 项目，它正在输出：

<AssemblyReference AssemblyName="mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" HintPath="file:///C:/WINDOWS/Microsoft.NET/Framework/v2.0.50727/mscorlib.dll" SpecificVersion= "假" xmlns="clr-命名空间:XamlWriterTester;assembly=XamlWriterTester" />

编辑：顺便说一句，普通的 XML 序列化对您不起作用是有原因的吗？

# java - .PRN 文件生成

> ID：757004
> 
> 赞同：0
> 
> 时间：2009-04-16T16:44:15.360
> 
> 标签：java, report

我想使用 Java 生成一个 .prn 文件。

1.  是否有任何 java api 已经可用？
2.  现在生成一个 .PRN 文件有什么价值吗（我的是一个基于 Web 的应用程序，试图模仿现有的客户端/服务器应用程序功能。当前的胖客户端应用程序已经很老了）。
3.  如果没有可用的 API，生成 .PRN 文件的策略是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T17:23:58.667

PRN 是发送到打印机以生成输出的字节流，由打印机驱动程序生成。Postscript 打印机获得 PostScript，HP 打印机通常获得 PCL 等。

为了复制行为，您需要 Java 打印服务中的兼容驱动程序

[http://java.sun.com/javase/technologies/desktop/printing/](http://java.sun.com/javase/technologies/desktop/printing/)

有关一些简短的示例程序，请参阅[http://www.exampledepot.com/egs/javax.print/pkg.html ，并调查系统上可用的打印机。](http://www.exampledepot.com/egs/javax.print/pkg.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T17:00:45.773

prn 文件是特定于打印机的；这只是 Windows 截取发送到 print 以供稍后打印的输出的方式。可以将常规 Java 打印定向到文件。

# php - PHP-GD imagejpeg 无法打开

> ID：757008
> 
> 赞同：2
> 
> 时间：2009-04-16T16:45:16.497
> 
> 标签：php, gd

尝试保存使用 GD 制作的缩略图时

```
imagejpeg($tnImage, "../../img/thumbs/".$maxWidth."x".$maxHeight."_".$filename); 
```

我收到以下错误：

**警告**：imagejpeg() [function.imagejpeg]：无法打开“../../img/thumbs/80x80_55865-drops.jpg”进行写入：**/home/user/workspace/stewart/server中没有这样的文件或目录-side/libImg.php**

/home/user/workspace/img/thumbs 的权限设置为 0x777。

这里有什么问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T16:52:46.697

你从哪里运行文件？如果它来自`server-side`目录，那么我认为您缺少“../”

试试这个：

```
var_dump(realpath("../../img/thumbs/".$maxWidth."x".$maxHeight."_".$filename)); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T16:54:45.523

在

```
/home/user/workspace/stewart/server-side/ 
```

目录

```
../../img/thumbs/ 
```

相当于

```
 /home/user/workspace/img/thumbs/ 
```

所以你需要

```
../../../img/thumbs/ 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-02-20T16:39:15.353

解决方法是提供`imagejpeg`文件的完整路径。

所以你可以有类似的`config.php`东西

```
define('APPLICATION_PATH',  dirname(__FILE__)); 
```

然后在你的functions.php中像这样调用imagejpeg：

```
@imagejpeg($image, APPLICATION_PATH . '/uploads/myfile.jpg', $quality); 
```

# qt - QTreeView 样式表自定义问题与滚动条

> ID：757009
> 
> 赞同：1
> 
> 时间：2009-04-16T16:45:36.980
> 
> 标签：qt

下面的屏幕截图中有两个 QTreeView。对于右边的那个，我添加了一个 CSS 自定义：

```
setStyleSheet(
    "background-color: #EAF5FF;"
    "alternate-background-color: #D5EAFF;"
); 
```

但是请注意，滚动条的外观已经改变。它采用“windows”风格，而不是“windowsxp”风格（这是默认的，因为我是在Xp下开发的）。

**如何在不更改滚动条外观的情况下使用上述样式设置？**

我正在使用 QT 4.5 和 Windows XP。

![截屏](https://farm4.static.flickr.com/3354/3448020876_614237a58e_o.jpg)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T19:21:15.733

您是否需要 css 自定义为您提供的能力之一，而不是您可以直接做的？要更改颜色，您可以直接使用小部件的调色板执行此操作，这应该保留您的样式。

另外，请记住样式更改是继承的，因此如果包含右侧树的任何小部件的样式与包含左侧树的任何小部件的样式不同，这也可能导致更改。

除此之外，我认为这似乎是一个 Qt 错误，如果确实唯一的区别是 css 样式表。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T21:25:10.880

走 QPalette 路线的建议得到了解决。这是解决方案：

```
#if 0  // this causes the problem
    setStyleSheet(
        "background-color: #EAF5FF;"
        "alternate-background-color: #D5EAFF;"
    );
#else // this works correctly
    QPalette p = palette();
    p.setColor(QPalette::Base, QColor(qRgb(0xEA, 0xF5, 0xFF)));
    p.setColor(QPalette::AlternateBase, QColor(qRgb(0xD5, 0xEA, 0xFF)));
    setPalette(p);
#endif 
```

这两种方法都应该根据文档工作，所以我会说它是一个 Qt 错误。

编辑：在过去几天使用这种新方法后，我注意到性能也可能有所提高。

# visual-studio - 输出类型为类库的项目无法直接启动——用启动exe

> ID：757010
> 
> 赞同：18
> 
> 时间：2009-04-16T16:45:39.333
> 
> 标签：visual-studio, visual-studio-2010, visual-studio-2005

首先，我完全了解此消息以及它为什么会正常发生。这并不是说我只是想运行一个 dll（比如[这个问题](https://stackoverflow.com/questions/618622/framework-give-me-error-about-cannot-started-directly)）。

我有一个编译为 dll 的项目，但在项目属性中指定了一个启动程序。大多数情况下，我可以右键单击项目并选择调试 > 启动新实例，它将运行程序并让我调试我的 dll。但是，有时我会收到此消息（无法直接启动具有类库输出类型的项目），就好像我没有启动程序一样。最初的几次我以为只是我不小心点击了错误的项目，但我确信情况并非如此，因为它发生了很多次而且我一直很小心地观看它。

当此消息出现时，我可以再试一次，它总是在第二次或第三次尝试时有效。

使用相同解决方案的同事从来没有这个问题：-/

其他人有这个问题或知道如何解决它？

我正在使用 Visual Studio 2005 Pro 版本 8.0.50727.762 (SP.050727-7600) **编辑**：Visual Studio 2010 也会发生

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2010-10-21T11:07:37.320

另一位同事建议这是因为在单击“调试”>“启动新实例”后，在等待它启动时，我单击了另一个项目。我不会出于任何原因这样做，只是在等待项目启动时随机选择一些东西。也许 Visual Studio 在我单击菜单后的某个时间查看所选项目，感到困惑并显示错误消息？

任何人都能够确认这符合他们的经验？

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-16T16:50:03.880

VS 中的问题通常由以下原因引起：

*   加载项：在没有的情况下运行 VS 并查看问题是否已解决
*   解决方案中损坏的文件：删除/重命名由 Visual Studio 创建的不属于您的项目的所有文件，即所有 .suo、.ncb 文件等。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-16T17:18:14.780

我在创建为“Windows 控件库”的项目中遇到了这个问题，这些项目以某种方式忘记了它们的状态。卸载和重新加载项目通常可以解决问题。

如果它是作为“类库”创建的，那么为了使其成为“Windows 控件库”，我手动将以下内容添加到 .csproj 文件中。这是我可以看到的类库和 Windows 控件库项目之间的唯一区别。

顺便说一句 - 启动 Windows 控件库会启动用户控件测试容器 - 允许您测试库中的任何用户控件。很酷。

```
<Service Include="{94E38DFF-614B-4cbd-B67C-F211BB35CE8B}" /> 
```

将其添加到`<itemgroup>`元素内部。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-07-24T10:35:37.407

如果您打算使用/创建/添加额外的 dll 或在您的解决方案中只有一个以上的项目，您可能会遇到这种问题，特别是如果您忘记了一个简单的规则： 1\. 在您的“解决方案资源管理器”窗口中。右键单击并选择“设置启动项目...” 2\. 在“启动项目”下选择“单个启动项目”并将其更改为您的工作实体。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-07T14:25:38.437

不只是做一个启动项目

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-03-09T14:12:04.487

要复活这个线程，我刚刚遇到类似的问题，右键单击一个项目并启动新实例时..

因此，我没有右键单击项目并选择启动新实例，而是右键单击并单击设置为启动项目。

低，一个类库项目被设置为粗体，当然不是我右键单击的那个。

我尝试选择一个不同的可执行项目并将其设置为启动项目。与启动项目相同的类库被突出显示。

意识到当前打开的文件来自那个项目，可能所有打开的文件都来自那个项目......

关闭所有打开的文件并再次尝试....问题已解决，设置为启动项目和启动新实例选项的行为均符合预期...

绝对是一个错误，希望这对其他人有帮助..

*   Microsoft Visual Studio 2010 版本 10.0.40219.1 SP1Rel
*   Microsoft .NET 框架版本 4.0.30319 SP1Rel

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-10-12T00:59:49.540

我发现我已将解决方案上的启动项目设置为当前选择，然后在某些时候，我卸载了一个项目，并且解决方案已恢复为恰好是一个类的项目上的单个启动项目图书馆。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-16T16:49:41.900

这听起来像是一个暂时的 Visual Studio 问题。重新安装或升级可能会解决您的问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-02-23T19:31:47.767

我也见过这个，这似乎是VS中的一个错误。它发生在您右键单击/构建类库（需要重建），然后右键单击/调试>启动新实例之后。

编辑-它仍然很断断续续，我似乎无法可靠地重现它

# python - 如何从分叉进程发送大量数据？

> ID：757020
> 
> 赞同：3
> 
> 时间：2009-04-16T16:47:21.437
> 
> 标签：python, fork, pipe

我有一个库的 ctypes 包装器。不幸的是，这个库不是 100% 可靠的（偶尔的段错误等）。由于它的使用方式，我希望包装器对库崩溃具有合理的弹性。

做到这一点的最好方法似乎是分叉一个过程并将结果从孩子那里发回。我想按照以下方式做一些事情：

```
r, w = os.pipe()
pid = os.fork()

if pid == 0:
    # child
    result = ctypes_fn()
    os.write(w, pickle.dumps(result))
    os.close(w)
else:
    # parent
    os.waitpid(pid, 0)
    result = os.read(r, 524288) # can be this big
    os.close(r)

    return pickle.loads(result) 
```

不过，这并不完全奏效。分叉的进程在写入时挂起。我想一次发送太多吗？这个问题有更简单的解决方案吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T17:45:01.283

可能您正在尝试写入比管道无法容纳的更多数据，因此它会阻塞，直到有人出现并从那里读取一些信息。这永远不会发生，因为唯一的读取器是父进程，您似乎已经编写了它以等待子进程终止，然后再读取任何内容。这就是我们所说的*死锁*。

您可以考虑取消 os.waitpid 调用，看看会发生什么。另一种选择是查看 os.pipe 是否有任何方法可以为其提供更大的缓冲区（我不知道你的环境足以说明）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T19:15:57.040

基本问题是管道上有 64kB 的限制。一些可能的解决方案，从简单到复杂：

1.  发送更少的数据。zlib.compress 可以帮助降低限制。
2.  将实际数据存储在其他地方（文件、mmap、memcache），仅使用管道发送控制信息。
3.  继续使用管道，但将输出分块。使用两组管道，以便进程可以相互通信并同步它们的通信。代码更复杂，但在其他方面非常有效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T19:15:38.583

ted.dennison 提到的死锁的一种解决方案是以下伪代码：

```
#parent
while waitpid(pid, WNOHANG) == (0, 0):
    result = os.read(r, 1024)
    #sleep for a short time
#at this point the child process has ended 
#and you need the last bit of data from the pipe
result = os.read(r, 1024)
os.close(r) 
```

带有 WNOHANG 选项的 Waitpid 导致 waitpid 在子进程尚未退出时立即返回。在这种情况下，它返回 (0,0)。您需要确保不要像上面的代码那样每次通过循环覆盖结果变量。

# django - 如何在 Django 中序列化模型实例？

> ID：757022
> 
> 赞同：198
> 
> 时间：2009-04-16T16:47:31.717
> 
> 标签：django, django-models

有很多关于如何序列化模型查询集的文档，但是如何将模型实例的字段序列化为 JSON？

* * *

## 回答 #1

> 赞同：284
> 
> 时间：2010-07-20T10:31:13.537

您可以轻松地使用列表来包装所需的对象，这就是 django 序列化程序正确序列化它所需的全部内容，例如：

```
from django.core import serializers

# assuming obj is a model instance
serialized_obj = serializers.serialize('json', [ obj, ]) 
```

* * *

## 回答 #2

> 赞同：103
> 
> 时间：2016-02-24T20:57:09.927

如果您正在处理模型实例列表，那么您可以做的最好的事情就是 using `serializers.serialize()`，它会完全满足您的需求。

但是，您将面临尝试序列化*单个*对象而不是`list`对象的问题。这样，为了摆脱不同的黑客，只需使用 Django 的`model_to_dict`（如果我没记错`serializers.serialize()`的话，也依赖它）：

```
from django.forms.models import model_to_dict

# assuming obj is your model instance
dict_obj = model_to_dict( obj ) 
```

您现在只需直接`json.dumps`调用即可将其序列化为 json：

```
import json
serialized = json.dumps(dict_obj) 
```

就是这样！:)

* * *

## 回答 #3

> 赞同：46
> 
> 时间：2012-12-14T19:05:17.710

为避免使用数组包装器，请在返回响应之前将其移除：

```
import json
from django.core import serializers

def getObject(request, id):
    obj = MyModel.objects.get(pk=id)
    data = serializers.serialize('json', [obj,])
    struct = json.loads(data)
    data = json.dumps(struct[0])
    return HttpResponse(data, mimetype='application/json') 
```

我也发现了这个有趣的帖子：

[http://timsaylor.com/convert-django-model-instances-to-dictionaries](http://timsaylor.com/convert-django-model-instances-to-dictionaries)

它使用 django.forms.models.model_to_dict，这看起来是完成这项工作的完美工具。

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2018-07-15T03:36:41.353

对此有一个很好的答案，我很惊讶它没有被提及。只需几行代码，您就可以处理日期、模型和其他所有内容。

制作一个可以处理模型的自定义编码器：

```
from django.forms import model_to_dict
from django.core.serializers.json import DjangoJSONEncoder
from django.db.models import Model

class ExtendedEncoder(DjangoJSONEncoder):

    def default(self, o):

        if isinstance(o, Model):
            return model_to_dict(o)

        return super().default(o) 
```

现在在使用 json.dumps 时使用它

```
json.dumps(data, cls=ExtendedEncoder) 
```

现在模型、日期和所有内容都可以序列化，而不必在数组中或序列化和非序列化。您拥有的任何自定义内容都可以添加到该`default`方法中。

你甚至可以通过这种方式使用 Django 的原生 JsonResponse：

```
from django.http import JsonResponse

JsonResponse(data, encoder=ExtendedEncoder) 
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2009-04-16T17:36:47.293

听起来您要问的内容涉及序列化 Django 模型实例的数据结构以实现互操作性。其他海报是正确的：如果您希望将序列化表单与可以通过 Django 的 api 查询数据库的 python 应用程序一起使用，那么您将希望使用一个对象序列化查询集。另一方面，如果您需要一种在不接触数据库或不使用 Django 的情况下在其他地方重新膨胀模型实例的方法，那么您还有一些工作要做。

这就是我所做的：

首先，我[`demjson`](http://deron.meranda.us/python/demjson/)用于转换。它恰好是我首先发现的，但它可能不是最好的。我的实现取决于其功能之一，但其他转换器应该有类似的方法。

其次，`json_equivalent`在您可能需要序列化的所有模型上实现一个方法。这是一种神奇的方法`demjson`，但无论您选择哪种实现，它都可能是您需要考虑的事情。这个想法是您返回一个可直接转换为的对象`json`（即数组或字典）。如果您真的想自动执行此操作：

```
def json_equivalent(self):
    dictionary = {}
    for field in self._meta.get_all_field_names()
        dictionary[field] = self.__getattribute__(field)
    return dictionary 
```

`ForeignKeys`除非您拥有完全扁平的数据结构（不，数据库中只有数字和字符串等），否则这对您没有帮助。否则，您应该认真考虑实施此方法的正确方法。

第三，打电话`demjson.JSON.encode(instance)`，你有你想要的。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2013-07-01T10:24:46.563

如果您要询问如何从模型中序列化单个对象，并且您**知道**您只会在查询集中获取一个对象（例如，使用 objects.get），那么请使用以下内容：

```
import django.core.serializers
import django.http
import models

def jsonExample(request,poll_id):
    s = django.core.serializers.serialize('json',[models.Poll.objects.get(id=poll_id)])
    # s is a string with [] around it, so strip them off
    o=s.strip("[]")
    return django.http.HttpResponse(o, mimetype="application/json") 
```

这会给你一些形式：

```
{"pk": 1, "model": "polls.poll", "fields": {"pub_date": "2013-06-27T02:29:38.284Z", "question": "What's up?"}} 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2019-05-26T21:22:20.680

如果您想将**单个模型对象**作为**json 响应**返回给客户端，您可以执行以下简单的解决方案：

```
from django.forms.models import model_to_dict
from django.http import JsonResponse

movie = Movie.objects.get(pk=1)
return JsonResponse(model_to_dict(movie)) 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2020-01-23T20:45:00.360

`.values()`是将模型实例转换为 JSON 所需的。

.values() 文档：[https ://docs.djangoproject.com/en/3.0/ref/models/querysets/#values](https://docs.djangoproject.com/en/3.0/ref/models/querysets/#values)

使用名为*Project*的模型的示例用法。

**注意：我正在使用 Django Rest 框架**

```
@csrf_exempt
@api_view(["GET"])
def get_project(request):
    id = request.query_params['id']
    data = Project.objects.filter(id=id).values()
    if len(data) == 0:
        return JsonResponse(status=404, data={'message': 'Project with id {} not found.'.format(id)})
    return JsonResponse(data[0]) 
```

来自有效 id 的结果：

```
{
    "id": 47,
    "title": "Project Name",
    "description": "",
    "created_at": "2020-01-21T18:13:49.693Z",
} 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2010-04-11T15:18:57.773

我通过向我的模型添加序列化方法解决了这个问题：

```
def toJSON(self):
    import simplejson
    return simplejson.dumps(dict([(attr, getattr(self, attr)) for attr in [f.name for f in self._meta.fields]])) 
```

对于那些厌恶单行的人来说，这是冗长的等价物：

```
def toJSON(self):
    fields = []
    for field in self._meta.fields:
        fields.append(field.name)

    d = {}
    for attr in fields:
        d[attr] = getattr(self, attr)

    import simplejson
    return simplejson.dumps(d) 
```

`_meta.fields`是可以从实例和模型本身访问的模型字段的有序列表。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2013-04-01T08:53:55.657

这是我的解决方案，它允许您轻松自定义 JSON 以及组织相关记录

首先在模型上实现一个方法。我叫 is`json`但你可以随便叫它，例如：

```
class Car(Model):
    ...
    def json(self):
        return {
            'manufacturer': self.manufacturer.name,
            'model': self.model,
            'colors': [color.json for color in self.colors.all()],
        } 
```

然后在视图中我这样做：

```
data = [car.json for car in Car.objects.all()]
return HttpResponse(json.dumps(data), content_type='application/json; charset=UTF-8', status=status) 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2015-04-09T22:15:29.247

要序列化和反序列化，请使用以下命令：

```
from django.core import serializers

serial = serializers.serialize("json", [obj])
...
# .next() pulls the first object out of the generator
# .object retrieves django object the object from the DeserializedObject
obj = next(serializers.deserialize("json", serial)).object 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2016-10-09T12:56:54.853

使用列表，它会解决问题

第1步：

```
 result=YOUR_MODELE_NAME.objects.values('PROP1','PROP2').all(); 
```

第2步：

```
 result=list(result)  #after getting data from model convert result to list 
```

第三步：

```
 return HttpResponse(json.dumps(result), content_type = "application/json") 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2019-05-07T14:52:06.047

## 使用带有格式的[**Django 序列化程序，**](https://docs.djangoproject.com/en/dev/topics/serialization/)**`python`**

```
from django.core import serializers

qs = SomeModel.objects.all()
serialized_obj = serializers.serialize(**'python'**, qs)
```

* * *

# ***`json`***和***`python`***格式有什么区别？

**`json`**格式将返回结果，而将***`str`***返回***`python`***结果***`list`******`OrderedDict`***

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-04-16T16:51:02.537

您似乎无法序列化实例，您必须序列化一个对象的 QuerySet。

```
from django.core import serializers
from models import *

def getUser(request):
    return HttpResponse(json(Users.objects.filter(id=88))) 
```

我用完了`svn`django 的发行版，所以这可能不在早期版本中。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-05-24T08:54:13.723

```
ville = UneVille.objects.get(nom='lihlihlihlih')
....
blablablab
.......

return HttpResponse(simplejson.dumps(ville.__dict__)) 
```

我返回我的实例的字典

所以它返回类似 {'field1':value,"field2":value,....}

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2011-06-22T05:11:07.050

这种方式怎么样：

```
def ins2dic(obj):
    SubDic = obj.__dict__
    del SubDic['id']
    del SubDic['_state']
return SubDic 
```

或排除任何你不想要的东西。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2020-04-04T21:29:00.230

与我对框架的期望相比，所有这些答案都有些笨拙，这是迄今为止我认为最简单的方法，如果您使用的是其余框架：

```
rep = YourSerializerClass().to_representation(your_instance)
json.dumps(rep) 
```

这直接使用序列化器，尊重您在其上定义的字段，以及任何关联等。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2020-08-08T15:49:11.563

这是一个项目，它可以序列化（现在基于 JSON）模型中的所有数据并自动将它们放入特定目录，然后它可以随时反序列化它......我已经用这个脚本亲自序列化了数千条记录，然后将它们全部加载回另一个数据库，而不会丢失任何数据。

任何对开源项目感兴趣的人都可以贡献这个项目并为其添加更多功能。

[serializer_deserializer_model](https://github.com/rainyman2012/model_serializer_deserializer/blob/master/serializer_deserializer.py)

# c# - 在 C# 用户控件中嵌入 Excel 工作表

> ID：757023
> 
> 赞同：5
> 
> 时间：2009-04-16T16:47:33.307
> 
> 标签：c#, excel

我需要在 C# 语言的用户控件中嵌入一个 excel 工作表部分（而不是整个工作表）。我想操纵它上面的数据并将其保存在一个集合中。

最好的方法是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T17:46:06.320

我会用 Excel COM 库打开电子表格。如果添加对 Microsoft Excel 对象库的引用，则可以访问 Com 界面。

添加这些 using 语句：

```
using Microsoft.Office.Interop;
using Microsoft.Office.Interop.Excel; 
```

然后您可以通过执行以下操作从电子表格中读取：

```
 private void GetData(string fileName, string tabName)
    {
        Workbook theWorkbook;

        Application ExcelObj = null;
        ExcelObj = new Application();

        theWorkbook = ExcelObj.Workbooks.Open(fileName,
            Type.Missing, Type.Missing, Type.Missing, Type.Missing,
            Type.Missing, Type.Missing, Type.Missing, Type.Missing,
            Type.Missing, Type.Missing, Type.Missing, Type.Missing,
            Type.Missing, Type.Missing);

        Sheets sheets = theWorkbook.Worksheets;
        Worksheet worksheet = (Worksheet)sheets[tabName];

        Range range = worksheet.get_Range("A1:A1", Type.Missing);

        string data = range.Text as string;

        //
        // TODO : store the data
        //

        theWorkbook.Close(false, fileName, null);
    } 
```

此代码会将 A1 单元格的内容读入字符串。

使用 Excel COM 接口的一个怪癖是您必须访问 Range 中的数据，即使您只需要一个单元格。您可以将范围设置为一组单元格，然后您可以遍历它返回的集合以获取每个单元格的内容。

您还希望在文件名和选项卡名称上添加一些错误检查/处理。

还有一种方法可以使用 ODBC 从 Excel 中读取，但电子表格必须以某种方式格式化。第 1 行必须有一个标题数据。我发现使用 COM 接口更容易。

一旦你获得了你需要的数据，你就可以把它放到一个类型化的数据集中。然后，如果您在 WPF 中使用 WinForms 或 ListBox，则可以将该数据集绑定到 DataGridView。如果您只想以 XML 格式保存数据，可以使用 DataSet WriteXml 函数将数据存储到文件中。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-16T17:10:27.090

为什么不使用填充了您要更改的数据的[DataGridView ？](http://msdn.microsoft.com/en-us/library/system.windows.forms.datagridview.aspx)

完成任何更改后，将 DataGridView 中的数据保存在您从中提取数据的 Excel 文件部分中。

您可能还会发现[这些](http://social.msdn.microsoft.com/Forums/en-US/vbgeneral/thread/27a9002e-9d53-440d-9750-e6c64406fdd6) [链接](http://social.msdn.microsoft.com/forums/en-US/winformsdatacontrols/thread/22d01539-2a0b-4a67-bf2e-abed631ea5b5/) [很有用](http://www.google.com/search?q=datagridview+excel&rls=com.microsoft:en-us&ie=UTF-8&oe=UTF-8&startIndex=&startPage=1)！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T17:10:43.190

查看 Microsoft.Office.Interop.Excel 库。里面有很多 excel 控件可以处理 excel 文件和操作。

# c# - LINQ to XML 新手问题

> ID：757034
> 
> 赞同：0
> 
> 时间：2009-04-16T16:49:44.317
> 
> 标签：c#, xml, linq

有没有更好的方法来做这种事情：

```
var filter = new CashFilters();
var element = XElement.Parse(request.OuterXml);

var productId = element.Elements("ProductId").Select(el => el);

if (productId.Count() == 1)
    filter.ProductId = Convert.ToInt32(productId.Single().Value); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T16:54:26.413

好吧，这对`Select(el => el)`你没有任何好处。

我建议你使用[`SingleOrDefault`](http://msdn.microsoft.com/en-us/library/system.linq.enumerable.singleordefault.aspx)：

```
var productId = element.Elements("ProductId").SingleOrDefault();
if (productId != null)
    filter.ProductId = Convert.ToInt32(productId.Value); 
```

请注意，它处理*没有ProductId 元素的情况，但如果有**多个*，则会引发异常。如果这实际上是一个有效的案例，那么您当前的代码（没有多余的`Select`调用）是合理的。

编辑：您*可以*通过以下方式摆脱这种情况：

```
var productId = element.Elements("ProductId")
                       .Select(elt => elt.Value)
                       .SingleOrDefault();
filter.ProductId = Convert.ToInt32(productId ?? filter.ProductId.ToString()); 
```

但这太可怕了；）

基本上你有一个条件——你只想设置`ProductId`它是否被指定。“if”语句是有条件地执行代码的普遍接受的方式:)

有替代方案：

```
filter.ProductId = productId == null 
                   ? filter.ProductId 
                   : int.Parse(productId); 
```

如果您不介意`filter.ProductId`在没有指定 ID 的情况下设置为 0，那么您可以使用：

```
filter.ProductId = Convert.ToInt32(element.Elements("ProductId")
                                          .Select(elt => elt.Value)
                                          .SingleOrDefault()); 
```

（由于`Convert.ToInt32`传递空参数时返回 0 的方式。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T17:01:16.443

您真的需要在 Linq to Xml 中执行此操作吗？Xml DOM 方法对我来说似乎更合理。

您是否考虑过纯 XML 方法？

```
 XmlDocument doc = new XmlDocument();
    doc.LoadXml(request.OuterXml);

    var node = doc.SelectSingleNode("//ProductId[1]");
    if (node != null)
        filter.ProductId = Convert.ToInt32(node.InnerText); 
```

# c# - 以编程方式分离 SQL Server 数据库以复制 mdf 文件

> ID：757036
> 
> 赞同：6
> 
> 时间：2009-04-16T16:49:52.477
> 
> 标签：c#, .net, asp.net, sql-server, sql-server-2005

我有一个小型 SQL Server 数据库，我需要在命令中复制它——我需要能够在任何给定时刻获取 mfd 和 ldf 文件，复制它们，压缩它们，并将它们提供给最终用户。

现在这可以通过手动实现：

1) 通过远程桌面登录 SQL 服务器

2) 通过 SQL Management Studio 分离数据库。我必须摆弄将数据库设置为 single_user 和/或重新启动服务的组合，以便我可以让它分离，因为应用程序服务器通常已登录到它。

3) 分离时，我浏览文件系统并复制 mdf 和 ldf 文件。

4) 我通过 SQL Management Studio 重新附加数据库

5) 我压缩复制的文件，然后将它们移动到 FTP 服务器，以便需要它们的人可以得到它们。

这是一个可怕的、低效的过程。这不仅仅是需要模式的问题，而是需要人们在他们自己的本地机器上处理真实的生产数据的快照，以进行破坏性实验。幸运的是，压缩后的数据库非常小——日志可能只有 30 兆。

所以理想情况下，我想在 ASP .NET Web 应用程序中创建一个页面，该页面有一个按钮，用户可以按下该按钮来启动将当前数据库打包到一个 zip 文件中，然后我只需提供指向文件下载。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-16T16:53:00.550

为什么不做一个普通的备份（用 sqlcommand 很容易做到）并为用户添加一个功能，以便通过单击按钮轻松恢复该备份文件？

*   您可以使用 sql-commands 备份数据库
*   您可以使用 sql-commands 打包并压缩备份文件
*   如果需要，您还可以自动将备份文件导出并 ftp 到网络服务器。

最终用户使用什么来使用您的数据库？一个winform程序？然后，用户只需单击按钮即可轻松完成所有操作。

以下是一些示例代码：

```
Declare @CustomerID int
declare @FileName nvarchar(40)
declare @ZipFileName nvarchar(40)
declare @ZipComand nvarchar(255)

set @CustomerID=20 --Get from database instead in real life application
SET @FileName='c:\backups\myback'+ cast(@customerID as nvarchar(10))+'.bak'
SET @ZipFileName='c:\backups\myback'+ cast(@customerID as nvarchar(10))+'.zip'

--Backup database northwind
backup database northwind to DISK=@FileName

--Zip the file, I got a commanddriven zip.exe from the net somewhere.
set @ZipComand= 'zip.exe -r '+@ZipFileName+' '+@FileName
EXEC xp_cmdshell @zipcomand,NO_output

--Execute the batfile that ftp:s the file to the server
exec xp_cmdshell 'c:\movetoftp.bat',no_output

--Done! 
```

你必须有一个 movetoftp.bat 包含这个（将 ftp-server 更改为你的）：
ftp -s:ftpcommands.txt ftp.myftp.net

而且您必须有一个包含此文件的 ftpcommands.txt（您也可以使用 sqlcommands 的正确 zip 文件动态创建此文件，但我让您自己做）：

ftpusername
ftppassword
二进制
提示 n
mput c:\backups\*.zip
退出

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-16T16:53:25.603

查看您在 SQL Management Studio 中使用的对话框，每个对话框的顶部附近都有一个按钮，它将生成执行操作的脚本。这是发现如何在 SQL 中执行此操作的快速方法，可以从数据库连接执行。

例如分离数据库 db1：

```
EXEC master.dbo.sp_detach_db @dbname = N'db1' 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T16:52:52.140

简单——检查 SQL Server 附带的“SQL 管理对象”SMO——很好的 C#/VB.NET 类和方法来完成所有这些工作。

请参阅： [SMO - 管理您的 SQL Server！](http://www.codeproject.com/KB/database/SMODemo.aspx)

或者：

[使用 C# 和 .NET 2.0 的 SQL Server 2005 数据库备份和还原](http://www.codeproject.com/KB/database/SQL_Server_2005_Database.aspx)

马克

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T16:56:14.753

就个人而言，我会生成数据库的备份并将它们压缩并将它们发送给用户。也许你可以写一个小脚本来恢复。

分离数据库的原因使其对其他人不可用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-17T10:30:29.930

我会使用[SQL Dumper](http://www.ruizata.com/)控制台版本并压缩 sql 转储。

恕我直言，拥有纯文本副本而不是二进制文件总是更好。如果出现问题，至少您可以手动重写数据，因为您可以读取它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-01-03T14:45:09.853

首先连接到 SQL Server，不附加任何数据库文件，也不使用数据库名称。

```
ConnectionString = @"Data Source=XXX;Integrated Security=True;Connect Timeout=30"; 
```

注：XXX = 。OR .\SQLEXPRESS OR .\MSSQLSERVER OR (local)\SQLEXPRESS OR (localdb)\v11.0 &...

然后通过查询分离您的数据库文件。

```
"ALTER DATABASE [your DB] SET OFFLINE WITH ROLLBACK IMMEDIATE \n\r exec sp_detach_db @dbname = [your DB]"; 
```

# 行。

我的示例代码：

```
sql_connect1.ConnectionString = @"Data Source=.\sqlexpress;Integrated Security=True;Connect Timeout=30";
sql_command.CommandText = "ALTER DATABASE [IRAN] SET OFFLINE WITH ROLLBACK IMMEDIATE \n\r exec sp_detach_db @dbname = [IRAN]";
                  sql_command.Connection = sql_connect1;
                  sql_connect1.Open();
                  sql_command.ExecuteNonQuery();
                  sql_connect1.Close(); 
```

# database-design - 面向对象数据库与对象关系数据库

> ID：757037
> 
> 赞同：18
> 
> 时间：2009-04-16T16:50:01.507
> 
> 标签：database-design, rdbms, datamodel, object-oriented-database

我想知道面向对象的数据建模与对象关系数据建模有何不同？

是不是像把面向对象和关系数据建模的优点结合起来来实现对象关系数据建模？

干杯

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-16T17:01:17.737

对象关系数据建模支持一些面向对象的概念，同时仍然支持一些关系概念：

*   继承——一个表可以与另一个表有*IS-A*关系。同样，自定义数据类型支持继承。
*   类和对象（类的实例）之间的区别不仅仅是表和行之间的区别。
*   自定义或复杂数据类型。
*   关系查询语言。
*   参照完整性。

面向对象的数据建模只是对象的持久性：

*   对复杂对象的更大支持。
*   没有查询语言——您只需检索单个对象，例如一些巨大的键/值存储。
*   没有关系参照完整性——尽管您可能有一个对象包含对另一个对象的引用。

# asp.net - 如何使用 VS 测试框架测试 asp.net 成员资格、配置文件、角色？

> ID：757040
> 
> 赞同：2
> 
> 时间：2009-04-16T16:50:55.203
> 
> 标签：asp.net, unit-testing, asp.net-membership

如果我们尝试使用 asp.net 成员资格框架测试某些内容，我们会遇到一些错误。它似乎无法实例化 asp.net 会员环境，因此无法访问所有配置文件、用户等。

有没有人见过类似的问题？或者它是否为某人工作？

干杯，史蒂夫

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T18:53:51.227

如果您依赖于外部资源，例如数据库和配置文件（在使用 ASP.NET 成员资格时使用），那么您就没有编写非常有效的单元测试。您必须保持一切同步，包括数据库中的数据。这是维护的噩梦。

如果您想以这种方式进行测试，我建议您将配置设置为拥有会员资格（您可以从您的应用程序中获取）。然后，您还需要设置一个要连接的测试数据库。它需要填充虚假数据，因此您需要脚本来确保数据一致。

但是，我建议您采用进行更适当的单元测试的方法。当我们提到“单元测试”时，我们的意思是一次测试一小段代码。此代码不应依赖于任何其他内容，因此您需要做的是使用接口并使用假冒、存根或模拟，以便您的测试范围包含在单个代码单元中。

如果您想走这条路，我强烈建议您阅读*[有效地使用旧代码](https://rads.stackoverflow.com/amzn/click/com/0131177052)*。还有很多其他书籍和资源讨论了如何找到接缝和解耦代码，以便您能够对其进行测试。一旦你掌握了单元测试的窍门，你会很高兴你研究了这一点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T19:26:27.903

从[Benrick](https://stackoverflow.com/questions/757040/how-to-test-asp-net-membership-profile-roles-with-vs-test-framework/757547#757547)的回答继续 - 我建议您看一下[ASP.NET MVC](http://www.asp.net/MVC/)项目 - 这有接口和包装器的示例，您需要正确地对代码进行*单元*测试。

正如 AccountController.cs 文件状态中的注释：

> FormsAuthentication 类型是密封的并且包含静态成员，因此很难对调用其成员的代码进行单元测试。下面的接口和帮助类演示了如何围绕这种类型创建一个抽象包装器，以使 AccountController 代码可单元测试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T16:54:41.357

测试框架正在查看`web.config`可能没有正确配置的测试项目文件。您真的应该围绕身份验证/成员资格提供程序编写接口，并编写一些虚拟实现来进行测试。

# database-design - 数据库设计问题：区分列与外键

> ID：757055
> 
> 赞同：1
> 
> 时间：2009-04-16T16:54:06.477
> 
> 标签：database-design

假设我有一个用于管理客户的数据库。客户具有人们可能期望的所有基本属性——但是，有一些特殊的客户称为分销商。分销商本身没有任何特殊属性，只是它可以将产品分销到存储在市场表中的某些市场。

我可以想到两种方法来区分分销商和“普通”客户：

1.  在客户表中创建一个名为“customer_type”的区分列。此列将包含一个可以区分“常规”和“分销商”客户的值。

    *   这种方法的好处是它非常简单，并且可以在需要时轻松添加新的客户类型。

    *   这种方法的缺点是，在这种情况下，我将市场和“分销商”联系起来的市场表实际上只是将市场与“客户”联系起来。没有办法强制市场与分销商类型的客户相关联。

2.  不理会customers 表，并创建一个distributor 表，该表基本上只有一个id 列和一个customer 表的外键列。

    *   这种方法的好处是我的市场表现在可以链接到仅包含分销商的分销商表。没有机会链接到不是分销商的客户（如果客户“类型”从分销商更改为普通客户，可能会发生这种情况）。

    *   这种方法的缺点是要复杂得多，并且添加新的客户类型非常困难。

我还可能遗漏什么，您对此事有何看法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T16:56:34.113

我会为具有自己的密钥/ID的分销商提供一个单独的表。如果所有分销商都是客户，那么它可以将外键放入客户表中。

最终，您可能希望向分销商添加属性。然后我会有一个单独的表格将市场与分销商联系起来（它本身可能会随着时间而改变）。

通常，一开始只拥有少量财产的实体（例如，分销商）最终拥有更多财产。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T16:56:59.433

经销商有多少附加属性？只有一两个？--> 使用鉴别器

如果您有很多新物业：您的客户中有多少是经销商？只是几个 --> 使用附加属性创建一个单独的分发器表。

但是，如果您的一半客户将是分销商，那么将所有这些都放在一张桌子上并且只有一个“客户类型”鉴别器可能更容易。

马克

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T16:57:07.980

我赞成你的选择（1）。正如您所说，如果经销商没有其他特殊领域，并且您将来可能会添加更多客户类型，那么这绝对是正确的方法。（如果情况发生变化，那么情况可能并非如此）

在参照：

> 没有办法强制市场与分销商类型的客户相关联。

...您可以编写一个约束来确保这一点。

或者甚至更好，让分销商[了解](http://en.wikipedia.org/wiki/View_(database))客户并将您的市场表与此联系起来。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-16T17:16:26.390

在您的解决方案 1 中，您可以强制市场以这种方式仅引用分销商：

```
CREATE TABLE Customers (
  customer_id SERIAL PRIMARY KEY,
  customer_type CHAR(1) CHECK (customer_type IN ('C', 'D')),
  UNIQUE KEY (customer_id, customer_type)
);

CREATE TABLE Markets (
  market_id SERIAL PRIMARY KEY,
  customer_id INT NOT NULL,
  customer_type CHAR(1) CHECK (customer_type = 'D'),
  FOREIGN KEY (customer_id, customer_type) 
    REFERENCES Customers (customer_id, customer_type)
); 
```

外键可以引用被引用表*中*的主键或唯一键。

但是，请注意，如果您具有与非分销商无关的特定于分销商的属性，则将它们放在`Customers`表中将违反[第三范式](http://en.wikipedia.org/wiki/Third_normal_form)。也就是说，这些分发者属性的相关性将取决于 `customer_type`不是主键一部分的值。在第三范式中，每个属性都必须依赖于主键。

出于这个原因，我会选择第二种解决方案，制作`Distributors`一个子表，引用`Customers`. 将特定于分销商的属性放入`Distributors`表中。然后`Markets`表格可以`Distributors`更简单地引用。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-16T17:44:40.567

我建议您选择选项 1，这是最简单的选项。（实际上）不可能在数据库级别强制执行每个业务规则。

考虑如果市场与公司而不是分销商相关联会发生什么后果，并根据会造成的可怕情况做出决定。这是我使用的“如果……会有多糟糕”的决策矩阵：

1.  我会被解雇吗？
2.  晚上我会在家里打电话吗？
3.  我必须在第二天早上修复它吗？
4.  我必须为下一个预定版本修复它吗？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-16T17:03:55.687

为什么不通过在 中使用鉴别器列`customer`，然后编写视图来获得这两个优点：

```
 create view distributor as 
  select * from customer where is_distributor = 1; 
```

实际上，您应该将客户 FK 到 customer_type 表，并对此进行区分：

```
create table customer_type (id int, name, bit is_distributor);

insert into customer_type values (1, 'Customer', 0);
insert into customer_type values (2, 'Distributor', 1);

alter table customer 
 add column customer_type_id int
 references customer_type(id)
;

create view distributor as 
  select a.* from customer a 
  join customer_type b 
  on (a.customer_type_id = b.id and b.is_distributor = 1)
; 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-16T17:19:17.647

假设您要使用一些 OR 映射器，此数据库详细信息将从代码中隐藏。我会决定每个子类映射一个表，因为......

1.  它很好地重新采样了继承层次结构。
2.  不需要人工鉴别器列。
3.  添加新的子类只需要添加一个新表，而使用每个类层次结构映射的表需要修改正在使用的表。
4.  任何行都没有无用的空字段，如果您将新的子类引入每个类层次结构映射的表中，将会有越来越多的无用值 - 这是表的低规范化的结果。
5.  您的外键约束很容易实现。
6.  使用 OR 映射器和往返工​​程，即使是复杂的继承层次结构的创建也不难。

如果您考虑使用 Hibernate，请查看[N]Hibernate 参考手册中的[继承映射](http://www.hibernate.org/hib_docs/nhibernate/html/inheritance.html)。

# c++ - 设置的最低有效位的位置

> ID：757059
> 
> 赞同：134
> 
> 时间：2009-04-16T16:54:48.300
> 
> 标签：c++, c, optimization, bit-manipulation

我正在寻找一种有效的方法来确定以整数设置的最低有效位的位置，例如对于 0x0FF0，它将是 4。

一个简单的实现是这样的：

```
unsigned GetLowestBitPos(unsigned value)
{
   assert(value != 0); // handled separately

   unsigned pos = 0;
   while (!(value & 1))
   {
      value >>= 1;
      ++pos;
   }
   return pos;
} 
```

任何想法如何挤出一些周期？

（注意：这个问题是给喜欢这些东西的人准备的，而不是让人们告诉我 xyzoptimization 是邪恶的。）

**[编辑]** 感谢大家的想法！我也学到了一些其他的东西。凉爽的！

* * *

## 回答 #1

> 赞同：188
> 
> 时间：2009-04-16T17:44:48.023

[Bit Twiddling Hacks](http://graphics.stanford.edu/%7Eseander/bithacks.html)提供了一个很好的，呃，bit twiddling hacks 的集合，并附有性能/优化讨论。对于您的问题，我最喜欢的解决方案（来自该站点）是«乘法和查找»：

```
unsigned int v;  // find the number of trailing zeros in 32-bit v 
int r;           // result goes here
static const int MultiplyDeBruijnBitPosition[32] = 
{
  0, 1, 28, 2, 29, 14, 24, 3, 30, 22, 20, 15, 25, 17, 4, 8, 
  31, 27, 13, 23, 21, 19, 16, 7, 26, 12, 18, 6, 11, 5, 10, 9
};
r = MultiplyDeBruijnBitPosition[((uint32_t)((v & -v) * 0x077CB531U)) >> 27]; 
```

有用的参考资料：

*   “ [Using de Bruijn Sequences to Index a 1 in a Computer Word](http://supertech.csail.mit.edu/papers/debruijn.pdf) ” - 解释上述代码为何有效。
*   “ [Board Representation > Bitboards > BitScan](https://www.chessprogramming.org/BitScan) ” - 详细分析这个问题，特别关注国际象棋编程

* * *

## 回答 #2

> 赞同：83
> 
> 时间：2009-04-16T21:07:33.090

为什么不使用内置的[ffs](http://linux.die.net/man/3/ffs)？（我从 Linux 中获取了一个手册页，但它比这更广泛。）

> ## ffs(3) - Linux 手册页
> 
> ### 姓名
> 
> ffs - 查找单词中设置的第一位
> 
> ### 概要
> 
> ```
> #include <strings.h>
> int ffs(int i);
> #define _GNU_SOURCE
> #include <string.h>
> int ffsl(long int i);
> int ffsll(long long int i); 
> ```
> 
> ### 描述
> 
> ffs() 函数返回在字 i 中设置的第一个（最低有效）位的位置。最低有效位是位置 1 和最高有效位置，例如 32 或 64。函数 ffsll() 和 ffsl() 执行相同的操作，但采用可能不同大小的参数。
> 
> ### 返回值
> 
> 这些函数返回第一个位设置的位置，如果 i 中没有设置位，则返回 0。
> 
> ### 符合
> 
> 4.3BSD，POSIX.1-2001。
> 
> ### 笔记
> 
> BSD 系统有一个原型在`<string.h>`.

* * *

## 回答 #3

> 赞同：48
> 
> 时间：2009-04-16T16:57:31.553

有一个 x86 汇编指令 ( `bsf`) 可以做到这一点。:)

更优化？！

## 边注：

此级别的优化本质上是依赖于架构的。今天的处理器*太复杂*（在分支预测、缓存未命中、流水线方面），很难预测哪些代码在哪种架构上执行得更快。将操作数从 32 减少到 9 或类似的操作甚至可能会降低某些架构的性能。单一架构上的优化代码可能会导致另一个架构上的代码更差。我认为你要么针对特定的 CPU 优化它，要么保持原样，让编译器选择它认为更好的东西。

* * *

## 回答 #4

> 赞同：47
> 
> 时间：2009-04-16T17:33:29.657

大多数现代架构都会有一些指令来查找最低设置位或最高设置位的位置，或计算前导零的数量等。

如果你有这门课的任何一个指令，你可以廉价地模仿其他的。

花点时间在纸上完成它，并意识到这`x & (x-1)`将清除 x 中的最低设置位，并且`( x & ~(x-1) )`将只返回最低设置位，而与架构、字长等无关。知道了这一点，使用硬件计数领先是微不足道的-zeroes /最高设置位如果没有明确的指令来查找最低设置位。

[如果根本没有相关的](http://groups.google.co.uk/group/comp.lang.c/browse_thread/thread/27bec95613efeed6/6a5983535088d349?q=0x7dcd629#6a5983535088d349)硬件支持，则可以使用上述标识[和](http://graphics.stanford.edu/~seander/bithacks.html)具有无分支的优点。

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2014-02-08T09:42:08.277

这是比较几种解决方案的基准：

我的机器是 Intel i530 (2.9 GHz)，运行 Windows 7 64 位。我用 32 位版本的 MinGW 编译。

```
$ gcc --version
gcc.exe (GCC) 4.7.2

$ gcc bench.c -o bench.exe -std=c99 -Wall -O2
$ bench
Naive loop.         Time = 2.91  (Original questioner)
De Bruijn multiply. Time = 1.16  (Tykhyy)
Lookup table.       Time = 0.36  (Andrew Grant)
FFS instruction.    Time = 0.90  (ephemient)
Branch free mask.   Time = 3.48  (Dan / Jim Balter)
Double hack.        Time = 3.41  (DocMax)

$ gcc bench.c -o bench.exe -std=c99 -Wall -O2 -march=native
$ bench
Naive loop.         Time = 2.92
De Bruijn multiply. Time = 0.47
Lookup table.       Time = 0.35
FFS instruction.    Time = 0.68
Branch free mask.   Time = 3.49
Double hack.        Time = 0.92 
```

我的代码：

```
#include <stdio.h>
#include <stdlib.h>
#include <time.h>

#define ARRAY_SIZE 65536
#define NUM_ITERS 5000  // Number of times to process array

int find_first_bits_naive_loop(unsigned nums[ARRAY_SIZE])
{
    int total = 0; // Prevent compiler from optimizing out the code
    for (int j = 0; j < NUM_ITERS; j++) {
        for (int i = 0; i < ARRAY_SIZE; i++) {
            unsigned value = nums[i];
            if (value == 0)
                continue;
            unsigned pos = 0;
            while (!(value & 1))
            {
                value >>= 1;
                ++pos;
            }
            total += pos + 1;
        }
    }

    return total;
}

int find_first_bits_de_bruijn(unsigned nums[ARRAY_SIZE])
{
    static const int MultiplyDeBruijnBitPosition[32] = 
    {
       1, 2, 29, 3, 30, 15, 25, 4, 31, 23, 21, 16, 26, 18, 5, 9, 
       32, 28, 14, 24, 22, 20, 17, 8, 27, 13, 19, 7, 12, 6, 11, 10
    };

    int total = 0; // Prevent compiler from optimizing out the code
    for (int j = 0; j < NUM_ITERS; j++) {
        for (int i = 0; i < ARRAY_SIZE; i++) {
            unsigned int c = nums[i];
            total += MultiplyDeBruijnBitPosition[((unsigned)((c & -c) * 0x077CB531U)) >> 27];
        }
    }

    return total;
}

unsigned char lowestBitTable[256];
int get_lowest_set_bit(unsigned num) {
    unsigned mask = 1;
    for (int cnt = 1; cnt <= 32; cnt++, mask <<= 1) {
        if (num & mask) {
            return cnt;
        }
    }

    return 0;
}
int find_first_bits_lookup_table(unsigned nums[ARRAY_SIZE])
{
    int total = 0; // Prevent compiler from optimizing out the code
    for (int j = 0; j < NUM_ITERS; j++) {
        for (int i = 0; i < ARRAY_SIZE; i++) {
            unsigned int value = nums[i];
            // note that order to check indices will depend whether you are on a big 
            // or little endian machine. This is for little-endian
            unsigned char *bytes = (unsigned char *)&value;
            if (bytes[0])
                total += lowestBitTable[bytes[0]];
            else if (bytes[1])
              total += lowestBitTable[bytes[1]] + 8;
            else if (bytes[2])
              total += lowestBitTable[bytes[2]] + 16;
            else
              total += lowestBitTable[bytes[3]] + 24;
        }
    }

    return total;
}

int find_first_bits_ffs_instruction(unsigned nums[ARRAY_SIZE])
{
    int total = 0; // Prevent compiler from optimizing out the code
    for (int j = 0; j < NUM_ITERS; j++) {
        for (int i = 0; i < ARRAY_SIZE; i++) {
            total +=  __builtin_ffs(nums[i]);
        }
    }

    return total;
}

int find_first_bits_branch_free_mask(unsigned nums[ARRAY_SIZE])
{
    int total = 0; // Prevent compiler from optimizing out the code
    for (int j = 0; j < NUM_ITERS; j++) {
        for (int i = 0; i < ARRAY_SIZE; i++) {
            unsigned value = nums[i];
            int i16 = !(value & 0xffff) << 4;
            value >>= i16;

            int i8 = !(value & 0xff) << 3;
            value >>= i8;

            int i4 = !(value & 0xf) << 2;
            value >>= i4;

            int i2 = !(value & 0x3) << 1;
            value >>= i2;

            int i1 = !(value & 0x1);

            int i0 = (value >> i1) & 1? 0 : -32;

            total += i16 + i8 + i4 + i2 + i1 + i0 + 1;
        }
    }

    return total;
}

int find_first_bits_double_hack(unsigned nums[ARRAY_SIZE])
{
    int total = 0; // Prevent compiler from optimizing out the code
    for (int j = 0; j < NUM_ITERS; j++) {
        for (int i = 0; i < ARRAY_SIZE; i++) {
            unsigned value = nums[i];
            double d = value ^ (value - !!value); 
            total += (((int*)&d)[1]>>20)-1022; 
        }
    }

    return total;
}

int main() {
    unsigned nums[ARRAY_SIZE];
    for (int i = 0; i < ARRAY_SIZE; i++) {
        nums[i] = rand() + (rand() << 15);
    }

    for (int i = 0; i < 256; i++) {
        lowestBitTable[i] = get_lowest_set_bit(i);
    }

    clock_t start_time, end_time;
    int result;

    start_time = clock();
    result = find_first_bits_naive_loop(nums);
    end_time = clock();
    printf("Naive loop.         Time = %.2f, result = %d\n", 
        (end_time - start_time) / (double)(CLOCKS_PER_SEC), result);

    start_time = clock();
    result = find_first_bits_de_bruijn(nums);
    end_time = clock();
    printf("De Bruijn multiply. Time = %.2f, result = %d\n", 
        (end_time - start_time) / (double)(CLOCKS_PER_SEC), result);

    start_time = clock();
    result = find_first_bits_lookup_table(nums);
    end_time = clock();
    printf("Lookup table.       Time = %.2f, result = %d\n", 
        (end_time - start_time) / (double)(CLOCKS_PER_SEC), result);

    start_time = clock();
    result = find_first_bits_ffs_instruction(nums);
    end_time = clock();
    printf("FFS instruction.    Time = %.2f, result = %d\n", 
        (end_time - start_time) / (double)(CLOCKS_PER_SEC), result);

    start_time = clock();
    result = find_first_bits_branch_free_mask(nums);
    end_time = clock();
    printf("Branch free mask.   Time = %.2f, result = %d\n", 
        (end_time - start_time) / (double)(CLOCKS_PER_SEC), result);

    start_time = clock();
    result = find_first_bits_double_hack(nums);
    end_time = clock();
    printf("Double hack.        Time = %.2f, result = %d\n", 
        (end_time - start_time) / (double)(CLOCKS_PER_SEC), result);
} 
```

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2009-04-16T17:31:50.440

最快的（非内在/非汇编程序）解决方案是找到最低字节，然后在 256 条目查找表中使用该字节。这为您提供了四个条件指令的最坏情况和 1 的最佳情况。这不仅是指令数量最少，而且分支数量最少，这在现代硬件上非常重要。

您的表（256 个 8 位条目）应包含 0-255 范围内每个数字的 LSB 索引。您检查值的每个字节并找到最低的非零字节，然后使用该值查找实际索引。

这确实需要 256 字节的内存，但如果这个函数的速度如此重要，那么 256 字节就值得了，

例如

```
byte lowestBitTable[256] = {
.... // left as an exercise for the reader to generate
};

unsigned GetLowestBitPos(unsigned value)
{
  // note that order to check indices will depend whether you are on a big 
  // or little endian machine. This is for little-endian
  byte* bytes = (byte*)value;
  if (bytes[0])
    return lowestBitTable[bytes[0]];
  else if (bytes[1])
      return lowestBitTable[bytes[1]] + 8;
  else if (bytes[2])
      return lowestBitTable[bytes[2]] + 16;
  else
      return lowestBitTable[bytes[3]] + 24;  
} 
```

* * *

## 回答 #7

> 赞同：16
> 
> 时间：2012-06-02T23:50:32.390

每当你有一个分支时，CPU 必须猜测将采用哪个分支。指令管道加载了引导猜测路径的指令。如果 CPU 猜错了，则指令管道被刷新，并且必须加载另一个分支。

考虑顶部的简单 while 循环。猜测将留在循环内。当它离开循环时，它至少会出错一次。这将刷新指令管道。这种行为比猜测它会离开循环要好一些，在这种情况下，它会在每次迭代时刷新指令管道。

丢失的 CPU 周期数量因处理器类型而异。但是您可以预期会丢失 20 到 150 个 CPU 周期。

下一个更糟糕的组是您认为您将通过将值拆分为更小的部分并添加更多分支来节省一些迭代。这些分支中的每一个都增加了一个额外的机会来刷新指令管道并花费另外 20 到 150 个时钟周期。

让我们考虑一下在表中查找值时会发生什么。有可能该值当前不在缓存中，至少不是第一次调用您的函数时。这意味着在从缓存加载值时 CPU 会停止。同样，这因一台机器而异。新的英特尔芯片实际上将此作为交换线程的机会，而当前线程正在等待缓存加载完成。这很容易比指令管道刷新更昂贵，但是如果您多次执行此操作，它可能只发生一次。

显然，最快的恒定时间解决方案是涉及确定性数学的解决方案。一个纯粹而优雅的解决方案。

如果这已经被覆盖，我很抱歉。

我使用的每个编译器，除了 XCODE AFAIK，都具有用于正向位扫描和反向位扫描的编译器内在函数。这些将在大多数硬件上编译为单个汇编指令，没有缓存未命中，没有分支未命中预测，也没有其他程序员生成的绊脚石。

对于 Microsoft 编译器，请使用 _BitScanForward 和 _BitScanReverse。
对于 GCC，使用 __builtin_ffs、__builtin_clz、__builtin_ctz。

此外，如果您对所讨论的主题没有足够的了解，请不要发布答案并可能误导新人。

抱歉，我完全忘了提供解决方案。这是我在 IPAD 上使用的代码，它没有针对该任务的汇编级指令：

```
unsigned BitScanLow_BranchFree(unsigned value)
{
    bool bwl = (value & 0x0000ffff) == 0;
    unsigned I1 = (bwl * 15);
    value = (value >> I1) & 0x0000ffff;

    bool bbl = (value & 0x00ff00ff) == 0;
    unsigned I2 = (bbl * 7);
    value = (value >> I2) & 0x00ff00ff;

    bool bnl = (value & 0x0f0f0f0f) == 0;
    unsigned I3 = (bnl * 3);
    value = (value >> I3) & 0x0f0f0f0f;

    bool bsl = (value & 0x33333333) == 0;
    unsigned I4 = (bsl * 1);
    value = (value >> I4) & 0x33333333;

    unsigned result = value + I1 + I2 + I3 + I4 - 1;

    return result;
} 
```

这里要理解的是，昂贵的不是比较，而是比较之后发生的分支。在这种情况下，比较被强制为 0 或 1 与 .. == 0 的值，并且结果用于组合可能发生在分支任一侧的数学运算。

编辑：

上面的代码完全被破坏了。此代码有效并且仍然是无分支的（如果优化）：

```
int BitScanLow_BranchFree(ui value)
{
    int i16 = !(value & 0xffff) << 4;
    value >>= i16;

    int i8 = !(value & 0xff) << 3;
    value >>= i8;

    int i4 = !(value & 0xf) << 2;
    value >>= i4;

    int i2 = !(value & 0x3) << 1;
    value >>= i2;

    int i1 = !(value & 0x1);

    int i0 = (value >> i1) & 1? 0 : -32;

    return i16 + i8 + i4 + i2 + i1 + i0;
} 
```

如果给定 0，则返回 -1。如果您不关心 0 或乐于为 0 获得 31，请删除 i0 计算，从而节省大量时间。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2009-04-18T00:04:56.947

受这篇涉及搜索集合位的[类似帖子的启发，我提供以下内容：](https://stackoverflow.com/questions/364985#462756)

```
unsigned GetLowestBitPos(unsigned value)
{
   double d = value ^ (value - !!value); 
   return (((int*)&d)[1]>>20)-1023; 
} 
```

优点：

*   没有循环
*   没有分支
*   在恒定时间内运行
*   通过返回一个超出范围的结果来处理 value=0
*   只有两行代码

缺点：

*   假设编码为小字节序（可以通过更改常量来修复）
*   假设 double 是一个实数 *8 IEEE 浮点数 (IEEE 754)

**更新：** 正如评论中所指出的，联合是一种更简洁的实现（至少对于 C 而言），并且看起来像：

```
unsigned GetLowestBitPos(unsigned value)
{
    union {
        int i[2];
        double d;
    } temp = { .d = value ^ (value - !!value) };
    return (temp.i[1] >> 20) - 1023;
} 
```

这假设所有东西都是 32 位整数和小端存储（想想 x86 处理器）。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-04-16T17:04:01.927

**可以通过少于 32 次操作的最坏情况来完成：**

**原理：**检查 2 位或更多位与检查 1 位一样有效。

因此，例如，没有什么可以阻止您首先检查哪个分组，然后检查该组中从最小到最大的每一位。

所以...
如果您一次检查 2 位，那么在最坏的情况下，您有 (Nbits/2) + 1 次检查。
如果您一次检查 3 位，则在最坏的情况下 (Nbits/3) + 2 次检查。
...

最好是检查 4 组。在最坏的情况下，这需要 11 次操作而不是 32 次。

如果您使用此分组想法，最好的情况是从您的算法的 1 次检查到 2 次检查。但是，在最坏的情况下节省额外的 1 次检查是值得的。

**注意：我将其完整地写出来而不是使用循环，因为这样更有效。**

```
int getLowestBitPos(unsigned int value)
{
    //Group 1: Bits 0-3
    if(value&0xf)
    {
        if(value&0x1)
            return 0;
        else if(value&0x2)
            return 1;
        else if(value&0x4)
            return 2;
        else
            return 3;
    }

    //Group 2: Bits 4-7
    if(value&0xf0)
    {
        if(value&0x10)
            return 4;
        else if(value&0x20)
            return 5;
        else if(value&0x40)
            return 6;
        else
            return 7;
    }

    //Group 3: Bits 8-11
    if(value&0xf00)
    {
        if(value&0x100)
            return 8;
        else if(value&0x200)
            return 9;
        else if(value&0x400)
            return 10;
        else
            return 11;
    }

    //Group 4: Bits 12-15
    if(value&0xf000)
    {
        if(value&0x1000)
            return 12;
        else if(value&0x2000)
            return 13;
        else if(value&0x4000)
            return 14;
        else
            return 15;
    }

    //Group 5: Bits 16-19
    if(value&0xf0000)
    {
        if(value&0x10000)
            return 16;
        else if(value&0x20000)
            return 17;
        else if(value&0x40000)
            return 18;
        else
            return 19;
    }

    //Group 6: Bits 20-23
    if(value&0xf00000)
    {
        if(value&0x100000)
            return 20;
        else if(value&0x200000)
            return 21;
        else if(value&0x400000)
            return 22;
        else
            return 23;
    }

    //Group 7: Bits 24-27
    if(value&0xf000000)
    {
        if(value&0x1000000)
            return 24;
        else if(value&0x2000000)
            return 25;
        else if(value&0x4000000)
            return 26;
        else
            return 27;
    }

    //Group 8: Bits 28-31
    if(value&0xf0000000)
    {
        if(value&0x10000000)
            return 28;
        else if(value&0x20000000)
            return 29;
        else if(value&0x40000000)
            return 30;
        else
            return 31;
    }

    return -1;
} 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2020-11-14T21:34:27.130

11 年后，我们终于有了：[count_zero](https://en.cppreference.com/w/cpp/numeric/countr_zero)

干得好 C++20

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2009-04-16T17:15:21.480

为什么不使用[二分查找](http://en.wikipedia.org/wiki/Binary_search)？这将始终在 5 次操作后完成（假设 int 大小为 4 个字节）：

```
if (0x0000FFFF & value) {
    if (0x000000FF & value) {
        if (0x0000000F & value) {
            if (0x00000003 & value) {
                if (0x00000001 & value) {
                    return 1;
                } else {
                    return 2;
                }
            } else {
                if (0x0000004 & value) {
                    return 3;
                } else {
                    return 4;
                }
            }
        } else { ...
    } else { ...
} else { ... 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2015-03-16T18:42:22.270

在“编程艺术，第 4 部分”中使用“魔术面具”发现了这个巧妙的技巧，它在 O(log(n)) 时间内完成了 n 位数。[带有 log(n) 额外空间]。检查设置位的典型解决方案是 O(n) 或需要 O(n) 额外空间来查找表，因此这是一个很好的折衷方案。

魔法面具：

```
m0 = (...............01010101)  
m1 = (...............00110011)
m2 = (...............00001111)  
m3 = (.......0000000011111111)
.... 
```

**关键思想：** x = 1 * [(x & m0) = 0] + 2 * [(x & m1) = 0] + 4 * [(x & m2) = 0] + ...

```
int lastSetBitPos(const uint64_t x) {
    if (x == 0)  return -1;

    //For 64 bit number, log2(64)-1, ie; 5 masks needed
    int steps = log2(sizeof(x) * 8); assert(steps == 6);
    //magic masks
    uint64_t m[] = { 0x5555555555555555, //     .... 010101
                     0x3333333333333333, //     .....110011
                     0x0f0f0f0f0f0f0f0f, //     ...00001111
                     0x00ff00ff00ff00ff, //0000000011111111 
                     0x0000ffff0000ffff, 
                     0x00000000ffffffff };

    //Firstly extract only the last set bit
    uint64_t y = x & -x;

    int trailZeros = 0, i = 0 , factor = 0;
    while (i < steps) {
        factor = ((y & m[i]) == 0 ) ? 1 : 0;
        trailZeros += factor * pow(2,i);
        ++i;
    }
    return (trailZeros+1);
} 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-04-16T17:07:14.617

```
unsigned GetLowestBitPos(unsigned value)
{
    if (value & 1) return 1;
    if (value & 2) return 2;
    if (value & 4) return 3;
    if (value & 8) return 4;
    if (value & 16) return 5;
    if (value & 32) return 6;
    if (value & 64) return 7;
    if (value & 128) return 8;
    if (value & 256) return 9;
    if (value & 512) return 10;
    if (value & 1024) return 11;
    if (value & 2048) return 12;
    if (value & 4096) return 13;
    if (value & 8192) return 14;
    if (value & 16384) return 15;
    if (value & 32768) return 16;
    if (value & 65536) return 17;
    if (value & 131072) return 18;
    if (value & 262144) return 19;
    if (value & 524288) return 20;
    if (value & 1048576) return 21;
    if (value & 2097152) return 22;
    if (value & 4194304) return 23;
    if (value & 8388608) return 24;
    if (value & 16777216) return 25;
    if (value & 33554432) return 26;
    if (value & 67108864) return 27;
    if (value & 134217728) return 28;
    if (value & 268435456) return 29;
    if (value & 536870912) return 30;
    return 31;
} 
```

50% 的数字将在第一行代码中返回。

75% 的数字将在前 2 行代码中返回。

87% 的数字将在前 3 行代码中返回。

94% 的数字将在前 4 行代码中返回。

97% 的数字将在前 5 行代码中返回。

等等

我认为那些抱怨这段代码的最坏情况是多么低效的人不明白这种情况会发生多么罕见。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2011-05-20T14:33:18.837

另一种方法（模除法和查找）在@anton-tykhyy 提供的同一[链接](http://graphics.stanford.edu/~seander/bithacks.html)中值得特别提及。这种方法在性能上与 DeBruijn 乘法和查找方法非常相似，但有细微但重要的区别。

**模除法和查找**

```
 unsigned int v;  // find the number of trailing zeros in v
    int r;           // put the result in r
    static const int Mod37BitPosition[] = // map a bit value mod 37 to its position
    {
      32, 0, 1, 26, 2, 23, 27, 0, 3, 16, 24, 30, 28, 11, 0, 13, 4,
      7, 17, 0, 25, 22, 31, 15, 29, 10, 12, 6, 0, 21, 14, 9, 5,
      20, 8, 19, 18
    };
    r = Mod37BitPosition[(-v & v) % 37]; 
```

模除法和查找方法为 v=0x00000000 和 v=FFFFFFFF 返回不同的值，而 DeBruijn 乘法和查找方法在两个输入上都返回零。

测试：-

```
unsigned int n1=0x00000000, n2=0xFFFFFFFF;

MultiplyDeBruijnBitPosition[((unsigned int )((n1 & -n1) * 0x077CB531U)) >> 27]); /* returns 0 */
MultiplyDeBruijnBitPosition[((unsigned int )((n2 & -n2) * 0x077CB531U)) >> 27]); /* returns 0 */
Mod37BitPosition[(((-(n1) & (n1))) % 37)]); /* returns 32 */
Mod37BitPosition[(((-(n2) & (n2))) % 37)]); /* returns 0 */ 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2014-06-10T16:25:30.120

根据[国际象棋编程 BitScan 页面](http://chessprogramming.wikispaces.com/BitScan#KimWalisch)和我自己的测量，减法和异或比取反和掩码更快。

（请注意，如果您要计算 中的尾随零`0`，则我拥有的方法返回`63`，而否定和掩码返回`0`。）

这是一个 64 位减法和异或：

```
unsigned long v;  // find the number of trailing zeros in 64-bit v 
int r;            // result goes here
static const int MultiplyDeBruijnBitPosition[64] = 
{
  0, 47, 1, 56, 48, 27, 2, 60, 57, 49, 41, 37, 28, 16, 3, 61,
  54, 58, 35, 52, 50, 42, 21, 44, 38, 32, 29, 23, 17, 11, 4, 62,
  46, 55, 26, 59, 40, 36, 15, 53, 34, 51, 20, 43, 31, 22, 10, 45,
  25, 39, 14, 33, 19, 30, 9, 24, 13, 18, 8, 12, 7, 6, 5, 63
};
r = MultiplyDeBruijnBitPosition[((uint32_t)((v ^ (v-1)) * 0x03F79D71B4CB0A89U)) >> 58]; 
```

作为参考，这里是一个 64 位版本的 negate 和 mask 方法：

```
unsigned long v;  // find the number of trailing zeros in 64-bit v 
int r;            // result goes here
static const int MultiplyDeBruijnBitPosition[64] = 
{
  0, 1, 48, 2, 57, 49, 28, 3, 61, 58, 50, 42, 38, 29, 17, 4,
  62, 55, 59, 36, 53, 51, 43, 22, 45, 39, 33, 30, 24, 18, 12, 5,
  63, 47, 56, 27, 60, 41, 37, 16, 54, 35, 52, 21, 44, 32, 23, 11,
  46, 26, 40, 15, 34, 20, 31, 10, 25, 14, 19, 9, 13, 8, 7, 6
};
r = MultiplyDeBruijnBitPosition[((uint32_t)((v & -v) * 0x03F79D71B4CB0A89U)) >> 58]; 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-04-16T17:01:26.973

您可以检查是否设置了任何低位。如果是这样，请查看剩余位的低位。例如，：

32bit int - 检查是否设置了前 16 个中的任何一个。如果是这样，请检查是否设置了前 8 个中的任何一个。如果是这样的话， ....

如果没有，请检查是否设置了任何上 16 位..

本质上它是二进制搜索。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-04-16T21:18:08.913

请参阅我的答案[，](https://stackoverflow.com/questions/671815/what-is-the-fastest-most-efficient-way-to-find-the-last-set-bit-msb-in-an-integ/671842#671842)了解如何使用单个 x86 指令执行此操作，除了要找到*最低*有效设置位，您需要`BSF`（“位扫描向前”）指令而不是在`BSR`那里描述。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2014-06-10T21:09:07.747

另一个解决方案，可能不是最快的，但似乎相当不错。
至少它没有分支。;)

```
uint32 x = ...;  // 0x00000001  0x0405a0c0  0x00602000
x |= x <<  1;    // 0x00000003  0x0c0fe1c0  0x00e06000
x |= x <<  2;    // 0x0000000f  0x3c3fe7c0  0x03e1e000
x |= x <<  4;    // 0x000000ff  0xffffffc0  0x3fffe000
x |= x <<  8;    // 0x0000ffff  0xffffffc0  0xffffe000
x |= x << 16;    // 0xffffffff  0xffffffc0  0xffffe000

// now x is filled with '1' from the least significant '1' to bit 31

x = ~x;          // 0x00000000  0x0000003f  0x00001fff

// now we have 1's below the original least significant 1
// let's count them

x = x & 0x55555555 + (x >>  1) & 0x55555555;
                 // 0x00000000  0x0000002a  0x00001aaa

x = x & 0x33333333 + (x >>  2) & 0x33333333;
                 // 0x00000000  0x00000024  0x00001444

x = x & 0x0f0f0f0f + (x >>  4) & 0x0f0f0f0f;
                 // 0x00000000  0x00000006  0x00000508

x = x & 0x00ff00ff + (x >>  8) & 0x00ff00ff;
                 // 0x00000000  0x00000006  0x0000000d

x = x & 0x0000ffff + (x >> 16) & 0x0000ffff;
                 // 0x00000000  0x00000006  0x0000000d
// least sign.bit pos. was:  0           6          13 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2016-07-05T19:30:12.070

如果 C++11 可供您使用，编译器有时可以为您完成任务 :)

```
constexpr std::uint64_t lssb(const std::uint64_t value)
{
    return !value ? 0 : (value % 2 ? 1 : lssb(value >> 1) + 1);
} 
```

结果是基于 1 的索引。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2017-03-30T18:24:06.087

这是关于@Anton Tykhyy 的回答

这是我的 C++11 constexpr 实现，通过将 64 位结果截断为 32 位来消除强制转换并删除 VC++17 上的警告：

```
constexpr uint32_t DeBruijnSequence[32] =
{
    0, 1, 28, 2, 29, 14, 24, 3, 30, 22, 20, 15, 25, 17, 4, 8,
    31, 27, 13, 23, 21, 19, 16, 7, 26, 12, 18, 6, 11, 5, 10, 9
};
constexpr uint32_t ffs ( uint32_t value )
{
    return  DeBruijnSequence[ 
        (( ( value & ( -static_cast<int32_t>(value) ) ) * 0x077CB531ULL ) & 0xFFFFFFFF)
            >> 27];
} 
```

要解决 0x1 和 0x0 都返回 0 的问题，您可以执行以下操作：

```
constexpr uint32_t ffs ( uint32_t value )
{
    return (!value) ? 32 : DeBruijnSequence[ 
        (( ( value & ( -static_cast<int32_t>(value) ) ) * 0x077CB531ULL ) & 0xFFFFFFFF)
            >> 27];
} 
```

但如果编译器不能或不会预处理调用，它将为计算添加几个周期。

最后，如果有兴趣，这里有一个静态断言列表，用于检查代码是否符合预期：

```
static_assert (ffs(0x1) == 0, "Find First Bit Set Failure.");
static_assert (ffs(0x2) == 1, "Find First Bit Set Failure.");
static_assert (ffs(0x4) == 2, "Find First Bit Set Failure.");
static_assert (ffs(0x8) == 3, "Find First Bit Set Failure.");
static_assert (ffs(0x10) == 4, "Find First Bit Set Failure.");
static_assert (ffs(0x20) == 5, "Find First Bit Set Failure.");
static_assert (ffs(0x40) == 6, "Find First Bit Set Failure.");
static_assert (ffs(0x80) == 7, "Find First Bit Set Failure.");
static_assert (ffs(0x100) == 8, "Find First Bit Set Failure.");
static_assert (ffs(0x200) == 9, "Find First Bit Set Failure.");
static_assert (ffs(0x400) == 10, "Find First Bit Set Failure.");
static_assert (ffs(0x800) == 11, "Find First Bit Set Failure.");
static_assert (ffs(0x1000) == 12, "Find First Bit Set Failure.");
static_assert (ffs(0x2000) == 13, "Find First Bit Set Failure.");
static_assert (ffs(0x4000) == 14, "Find First Bit Set Failure.");
static_assert (ffs(0x8000) == 15, "Find First Bit Set Failure.");
static_assert (ffs(0x10000) == 16, "Find First Bit Set Failure.");
static_assert (ffs(0x20000) == 17, "Find First Bit Set Failure.");
static_assert (ffs(0x40000) == 18, "Find First Bit Set Failure.");
static_assert (ffs(0x80000) == 19, "Find First Bit Set Failure.");
static_assert (ffs(0x100000) == 20, "Find First Bit Set Failure.");
static_assert (ffs(0x200000) == 21, "Find First Bit Set Failure.");
static_assert (ffs(0x400000) == 22, "Find First Bit Set Failure.");
static_assert (ffs(0x800000) == 23, "Find First Bit Set Failure.");
static_assert (ffs(0x1000000) == 24, "Find First Bit Set Failure.");
static_assert (ffs(0x2000000) == 25, "Find First Bit Set Failure.");
static_assert (ffs(0x4000000) == 26, "Find First Bit Set Failure.");
static_assert (ffs(0x8000000) == 27, "Find First Bit Set Failure.");
static_assert (ffs(0x10000000) == 28, "Find First Bit Set Failure.");
static_assert (ffs(0x20000000) == 29, "Find First Bit Set Failure.");
static_assert (ffs(0x40000000) == 30, "Find First Bit Set Failure.");
static_assert (ffs(0x80000000) == 31, "Find First Bit Set Failure."); 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2018-06-30T20:43:58.370

这是一个简单的替代方案，尽管查找日志的成本有点高。

```
if(n == 0)
  return 0;
return log2(n & -n)+1;   //Assuming the bit index starts from 1 
```

* * *

## 回答 #22

> 赞同：-3
> 
> 时间：2015-05-29T08:02:42.470

最近看到新加坡总理在facebook上贴了他写的一个程序，有一句话要提。。

逻辑很简单，就是“value & -value”，假设你有 0x0FF0，那么，0FF0 & (F00F+1) 等于 0x0010，这意味着最低的 1 在第 4 位.. :)

* * *

## 回答 #23

> 赞同：-8
> 
> 时间：2009-04-16T17:08:19.827

***如果***你有资源，你可以牺牲内存来提高速度：

```
static const unsigned bitPositions[MAX_INT] = { 0, 0, 1, 0, 2, /* ... */ };

unsigned GetLowestBitPos(unsigned value)
{
    assert(value != 0); // handled separately
    return bitPositions[value];
} 
```

**注意：**此表将消耗至少 4 GB（如果我们将返回类型保留为 16 GB `unsigned`）。这是将一种有限资源 (RAM) 换成另一种（执行速度）的示例。

如果您的函数需要不惜一切代价保持可移植性并尽可能快地运行，那么这将是可行的方法。在大多数实际应用程序中，4GB 表是不现实的。

# amazon-ec2 - 为什么你不想使用云计算

> ID：757063
> 
> 赞同：43
> 
> 时间：2009-04-16T16:55:03.477
> 
> 标签：amazon-ec2, cloud

我们公司正在考虑从托管我们自己的服务器迁移到 EC2，我想知道这是否是个好主意。

我已经看到很多关于云计算（特别是 EC2）可以做 x 还是可以做 y 的东西，但我真正的问题是你为什么不想使用它？

如果您正在创办一家企业，您会选择费心管理自己的服务器的原因（除了成本）是什么？

我知道您可以进行很多关于带宽、磁盘使用等方面的成本计算，但当然还有与维护您自己的服务器有关的其他成本。为了便于讨论，我愿意考虑成本大致相等。

我似乎记得乔尔·斯波尔斯基（Joel Spolsky）有一次在这上面写了一点模糊，但我找不到。

有人有什么理由吗？

谢谢！

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-04-16T17:21:15.847

我可以想到几个不使用 EC2 的原因（我说的是 EC2，而不是一般的网格计算）：

*   **可靠性**：亚马逊不保证 EC2 的可用性/停机时间/安全性
*   **安全性**：亚马逊不对谁将披露您的数据做出任何保证
*   **持久性**：确保数据的持久性（包括设置系统的工作）比 EC2 复杂
*   **管理**：部署在 EC2 上的云集成管理工具很少
*   **网络**：允许 EC2 实例通信的虚拟网络有一些非常痛苦的限制（延迟、无组播、任意拓扑位置）

并完成：

*   ***成本***：从长远来看，如果您不使用 EC2 来吸收峰值流量，这将比投资自己的服务器成本高得多（像 Supermicro 这样的廉价服务器只需几百美元......）

另一方面，如果您的架构允许，我仍然认为 EC2 是一种吸收非敏感峰值流量的好方法。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-28T21:27:09.250

一些问题要问：

预计正常运行时间是多少，停机时间如何影响您的业务？您可以获得什么样的服务水平协议，错过它的处罚是什么，以及您对实现 SLA 正​​常运行时间目标的信心如何？（他们在保持系统正常运行方面可能比您更好或更差。）

您建议放入云中的数据有多敏感？再次，我们探讨了供应商承诺的安全性、合同处罚和赔偿是多少以及您对供应商履行协议的信心如何等问题。此外，可能还有外部要求。如果您在美国处理与健康相关的数据，您将受到非常严格的要求。如果您处理信用卡数据，您也有责任（合同，而非法律）。

如果服务不是预期的，或者如果您在其他地方找到更好的交易，退出安排有多容易？这不仅包括取回您的数据，还包括您一直在使用的某些版本的应用程序。考虑一下您的提供商破产的可能性（亚马逊不会很快破产，但他们可能会拆分云提供商，然后可能会破产），或者进行内部重组。请记住，陷入严重困境的公司可能无法满足您对服务的期望。

你会有多大的独立性？你要运行他们的软件还是你选择的软件？重新配置有多容易？

定价方案是什么？账单是否有可能在没有足够警告的情况下达到不可接受的水平？

什么是灾难计划？理想情况下，它在与灾难发生的不同位置的服务器上运行您的软件。

您的法律部门（或聘请的公司律师）如何看待合同？是否有争议解决机制，如果有，对您公平吗？

最后，您希望从迁移到云中得到什么？你愿意付出什么？你可以妥协什么，你需要什么？

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-04-16T17:08:09.983

高度敏感的数据可能更好地控制自己。还有立法；例如，某些隐私敏感信息可能不会离开该国。

此外，除了与 SDS 结合使用的 Microsoft Azure 之外，数据存储往往不是关系型的，这在某些情况下很麻烦。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-04-16T17:17:57.993

也许担心政府的史密斯探员更有可能与一家大公司接触，以监视某个地方的小供应商的每个人。

大公司——更多的客户——更多的数据来聚合和识别模式——更多的资源来组织一个复杂的手表系统。

也许这更像是一种幻想，但谁知道呢？

如果你没有妄想症，并不意味着你还没有被监视。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-04-16T16:57:52.550

最重要的是：如果亚马逊倒闭，您将无能为力。

我不是在谈论公司消失的世界末日场景。我的意思是，您只能任由他们的停机时间摆布，而您自己几乎没有追索权。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-04-16T17:03:07.110

*   安全性——您不知道对您的数据做了什么
*   依赖性——您的业务现在直接与提供者交织在一起

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-04-16T17:27:56.143

有许多不同的供应商提供不同种类的云计算。将我的应用程序编码为与单个云供应商合作会让我感到紧张。你特别需要为..amazon 和 Microsoft 编写代码，我相信你需要特别为那个平台编写代码——也许谷歌也是如此。

也就是说，我最近抛弃了我自己的专用服务器并转移到 Rackspaces Mosso Cloud 平台（不需要专有编码），到目前为止我真的非常非常满意。将我的成本降低了一半，性能也比以前好得多。我的 sql server 数据库现在运行在具有 32G ram 的 64 位企业 SQL server 版本上——这将使我在以前的提供商基础设施上花费一大笔钱。

至于在云关闭时运气不好，如果我的专用服务器出现故障，这是真的 - 它从来没有发生过，但如果我的专用服务器出现硬件崩溃，我不确定它是否会重新上线任何比 rackspace 更快的速度都可以恢复他们的云。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-04-16T16:59:45.417

缺乏控制。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-04-16T17:15:39.667

将您的软件放在其他人的云上意味着交出一些控制权。他们可能会制定文件上传大小限制或内存限制，这可能会破坏您的应用程序。他们控制面板中的安全漏洞可能会导致您的网站被黑客入侵。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-04-16T17:24:21.927

如果您的应用程序自己进行加密，则安全问题无关紧要。然后，亚马逊存储了他们无法解密的加密数据。

但除了正常运行时间问题之外，亚马逊还可以决定将价格提高到他们想要的任何价格。如果你依赖他们，你只需要付钱。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-08-04T20:22:22.080

与第三方云服务相比，取决于您对自己的基础架构的信任程度。在我看来，大多数企业（至少与 IT 无关）应该选择后者。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-08-04T20:43:11.853

您在云中失去的另一件事是能够准确选择您想要运行的操作系统。例如，EC2 上可用的最新 Fedora Linux 内核是 FC8，最新的 Windows 版本是 Server 2003。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-08-04T21:06:24.067

除了关于可靠性、可靠性和成本的问题之外，还有数据所有权问题。当您在其他人的服务器上定位数据时，您不再控制查看、访问、修改或使用该数据的人。虽然云运营商可以限制您的访问权限，但您无法限制他们的访问权限或限制他们授予访问权限的对象。是的，您可以加密服务器上的所有数据，但是您无法知道谁拥有对服务器本身的 root 访问权限，也无法阻止其他人下载您的加密数据并将其破解。您失去对数据的控制；根据您运行的应用程序类型和所涉及数据的专有性质，这可能会带来公司安全和/或责任风险。

另一个需要考虑的因素是，如果亚马逊和/或 EC2 一夜之间突然消失，你的公司会发生什么。虽然这是一个看似荒谬的立场，但它可能会发生。您是否能够快速填补漏洞并恢复服务，或者您的潜在创收应用程序是否会在 IT 人员争相获取服务器和带宽以使其重新上线时陷入困境？另外，您的数据会怎样？保存您所有信息的云硬盘驱动器仍然存在于某个地方，并且可能会根据您存储的信息（例如个人信息、业务交易记录等）构成潜在的责任风险。

如果我现在开始自己的业务，我会经历购买和维护自己的服务器的麻烦，因此我保留了数据所有权。我可以控制对硬件的 root 访问，以及控制谁可以访问和修改数据。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-04-16T17:01:15.553

未回答的安全问题。

真的，你想要你的 IP 在那里，你不是控制它的人吗？

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-04-16T17:20:37.520

大多数云计算环境至少部分是特定于供应商的。没有很好的方法可以将内容从一个云移动到另一个云，而无需进行大量重写。当涉及到停机、价格上涨等问题时，这种锁定会让您受制于一家供应商。如果您租用或拥有自己的服务器，托管服务提供商和托管服务商几乎可以互换。您总是可以选择搬到其他地方。

随着这些事情变得标准化，这可能会在未来发生变化，但现在将自己绑定到云意味着将自己绑定到特定的供应商。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-04-16T17:20:50.887

云计算使并行编程更接近大众，但您仍然必须了解如何最好地使用它 - 否则您将浪费计算周期和带宽。

重新构建您的应用程序以最有效地使用云计算服务并非易事。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-04-16T17:36:01.990

这有点像多年前我从管理层收到的“你为什么要使用 Linux”的评论。我得到的回应是，这是一个寻找问题的解决方案。

那么，您迁移到 EC2 的目标和目的是什么？

我很想知道您是否仍想迁移到云端，如果它是您自己的。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-08-04T21:20:35.037

除了这里已经说过的，我们还必须考虑整个业务的统一性。你们所有的应用程序都将托管在云中，还是只有大部分？当您仍然需要有人员来处理一些特殊的服务器时，是否足以触发使用云？

特别是，您可能需要与此类调制解调器通信以接受传入数据的特殊硬件，或进行自动电话呼叫的语音卡。我不知道如何在云环境中处理这些事情。

# javascript - 什么是好的 Javascript RDFa 解析器实现？

> ID：757066
> 
> 赞同：6
> 
> 时间：2009-04-16T16:55:49.873
> 
> 标签：javascript, parsing, rdfa, fresnel

我希望为 Web 应用程序实现基于客户端 RDFa 的格式化。这类似于[Mark Birbeck 的](http://webbackplane.com/mark-birbeck) [ubiquity-rdfa](http://code.google.com/p/ubiquity-rdfa/)项目。

Mark 的项目看起来很棒，但它至少有两个缺点：

1.  它很慢。[向简单页面](http://ubiquity-rdfa.googlecode.com/svn/branches/0.7/test/tutorial-step-2.html)添加 RDFa 格式会导致页面加载出现明显延迟。
2.  它很复杂。ubiquity-rdfa 项目利用[w3c 菲涅耳规范](http://www.w3.org/2005/04/fresnel-info/)，这是一种向客户端标记添加简单注释的复杂方法。

我正在寻找一种通过客户端代码添加注释的更轻量级的方法，我不介意做一些工作来获得它。

我想要的是一个快速可靠的 Javascript RDFa 解析器。

我发现的一些实现包括：

*   [W3C RDFa 小书签解析器](http://www.w3.org/2006/07/SWD/RDFa/impl/js/)
*   [Elias Torres RDFa 提取器](http://torrez.us/rdfa/)

我很想知道您是否会推荐其中一种或另一种 RDFa Javascript 实现。

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-06-05T12:45:44.780

[我对 rdfQuery 中的RDfa](http://code.google.com/p/rdfquery/)解析器有很好的经验。源代码在[这里](http://code.google.com/p/rdfquery/source/browse/trunk/jquery.rdfa.js)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-03-07T19:23:08.770

[VIE](http://viejs.org)包含一个相当简单的 RDFa 解析器和编写器。页面上的 RDFa 实体可以作为[Backbone.js](http://documentcloud.github.com/backbone/)模型和集合访问。编写 RDFa 是通过更新 Backbone 模型内容发生的，这会触发`render`View 上的操作。

在这种情况下，RDFa 解析发生在 jQuery 中。

VIE 源代码在 github.com/bergie/VIE

# entity-framework - 如何在不加载所有数据的情况下删除实体框架中的多对多关系

> ID：757067
> 
> 赞同：19
> 
> 时间：2009-04-16T16:55:55.113
> 
> 标签：entity-framework, ado.net, many-to-many

有谁知道如何在 ADO.NET Entity Framework 中删除多对多关系而无需加载所有数据？在我的情况下，我有一个具有属性**订阅的实体****主题**，我需要删除一个订阅。代码**myTopic.Subscriptions.Remove(...)**有效，但我需要先加载所有订阅（例如**myTopic.Subscriptions.Load()**），我不想这样做，因为有很多（我的意思是很多）的订阅。

 ******* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-04-16T22:02:02.990

您可以 Attach() 订阅，然后 Remove() 它 - 请注意，我们在这里没有使用 Add()，只是 Attach，因此我们有效地告诉 EF 我们知道该对象已附加在商店中，并要求它表现得好像那是真的。

```
var db = new TopicDBEntities();
var topic = db.Topics.FirstOrDefault(x => x.TopicId == 1);

// Get the subscription you want to delete
var subscription = db.Subscriptions.FirstOrDefault(x => x.SubscriptionId == 2);
topic.Subscriptions.Attach(subscription); // Attach it (the ObjectContext now 'thinks' it belongs to the topic)
topic.Subscriptions.Remove(subscription); // Remove it
db.SaveChanges(); // Flush changes 
```

整个交换，包括从数据库中获取原始主题，将这 3 个查询发送到数据库：

```
SELECT TOP (1) 
[Extent1].[TopicId] AS [TopicId], 
[Extent1].[Description] AS [Description]
FROM [dbo].[Topic] AS [Extent1]
WHERE 1 = [Extent1].[TopicId]

SELECT TOP (1) 
[Extent1].[SubscriptionId] AS [SubscriptionId], 
[Extent1].[Description] AS [Description]
FROM [dbo].[Subscription] AS [Extent1]
WHERE 2 = [Extent1].[SubscriptionId]

exec sp_executesql N'delete [dbo].[TopicSubscriptions]
where (([TopicId] = @0) and ([SubscriptionId] = @1))',N'@0 int,@1 int',@0=1,@1=2 
```

所以它不会在任何时候取消所有订阅。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-03-08T12:48:44.590

这是在不首先加载任何数据的情况下删除的方法。这适用于 EF5。不确定早期版本。

```
var db = new TopicDBEntities();

var topic = new Topic { TopicId = 1 };
var subscription = new Subscription { SubscriptionId = 2};
topic.Subscriptions.Add(subscription);

// Attach the topic and subscription as unchanged 
// so that they will not be added to the db   
// but start tracking changes to the entities
db.Topics.Attach(topic);

// Remove the subscription
// EF will know that the subscription should be removed from the topic
topic.subscriptions.Remove(subscription);

// commit the changes
db.SaveChanges(); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T17:02:17.470

一种方法是拥有一个存储过程，它将直接在数据库中删除您的子记录并将其包含在您的 EF 模型中；然后只需从您的 DataContext 调用它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-08-21T09:14:55.790

这是我的示例...我知道外键并且我不想进行数据库往返。
我希望这可以帮助别人...

给定：
[客户端]<---多对多--->[药物]

```
Client objClient = new Client() { pkClientID = pkClientID };
EntityKey entityKey = _commonContext.CreateEntityKey("Client", objClient);
objClient.EntityKey = entityKey;
_commonContext.Attach(objClient); //just load entity key ...no db round trip

Medication objMed = new Medication() { pkMedicationID = pkMedicationID };
EntityKey entityKeyMed = _commonContext.CreateEntityKey("Medication", objMed);
objMed.EntityKey = entityKeyMed;
_commonContext.Attach(objMed);

objClient.Medication.Attach(objMed);
objClient.Medication.Remove(objMed); //this deletes
_commonContext.SaveChanges(); 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2016-04-07T16:07:49.383

如果设置了外键，则在删除父实体时，**参照完整性**应通过 DBMS 本身自动完成。

如果您首先使用代码，据我在 MVA 教程中了解到，**ON DELETE CASCADE**是 EF6 设置的默认行为。如果首先运行 DB，您应该更改您的子表...

这是链接：[https](https://mva.microsoft.com/en-US/training-courses/implementing-entity-framework-with-mvc-8931?l=pjxcgEC3_7104984382) ://mva.microsoft.com/en-US/training-courses/implementing-entity-framework-with-mvc-8931?l=pjxcgEC3_7104984382 在**视频**中提到它在**20:00**向上和**第 14 页**上所说的**幻灯片演示**。

 **干杯

# ruby-on-rails - Rails/Passenger/未知内容类型

> ID：757072
> 
> 赞同：1
> 
> 时间：2009-04-16T16:56:59.447
> 
> 标签：ruby-on-rails, ruby, passenger

我们有以下情况：

1.  我们调用一个在控制器中运行动作的 url。该操作运行时间相当长 - 它构建一个大的 XML 字符串，生成一个 PDF，并且应该在完成后重定向。

2.  大约 60 秒后，浏览器得到 200，但内容类型为“application/x-unknown-content-type”，没有正文，也没有响应标头（使用 Tamper 查看标头）

3.  控制器操作实际上继续运行到完成，生成 PDF

这发生在我们的 prod 环境中，在将控制器操作分阶段运行到完成时，按预期重定向。

有什么建议去哪里看吗？

我们在 Apache/Phusion Passenger 上运行 Rails 2.2.2。

谢谢，

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T18:15:49.087

我不是 100% 确定，但可能您的 Apache 超时了对 Rails 应用程序的请求。您可以尝试将 Apache 的 Timeout 指令设置得更高吗？就像是：

```
Timeout 120 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T23:33:26.730

我会考虑将此任务放到作业队列中并立即返回，而不是让用户坐下来等待。否则，当很多人尝试使用它并且您用完了可用的 Rails 应用程序实例来处理任何新连接时，您将面临一个问题的世界。

轻松做到这一点的一种方法可能是使用 Ajax 发布来触发创建文档，将其放入[延迟作业](http://github.com/tobi/delayed_job/tree/master)中，然后通过 ajax 运行 10 秒的定期检查，通知等待用户的作业状态。一旦delayed_job 在后台完成了您的任务并更新了数据库中的某些内容以表明它已完成，那么您可以通过ajax 将用户重定向到新创建的文档。

# java - Java中的窗口拖动事件

> ID：757078
> 
> 赞同：5
> 
> 时间：2009-04-16T16:58:05.640
> 
> 标签：java, macos, listener

我正在尝试在 Java 中实现类似 OS X 抽屉的功能，因此我将一个窗口隐藏在另一个窗口下。但是，当我拖动主窗口（JFrame）时，我需要在它移动到下面的辅助窗口（JWindow）时发送更新。

所以它会是这样的......</p>

```
---------------
|             |----------
|   JFrame    |          |
|             |  JWidow  |
|             |          |
|             |          |
|             |          |
|             |-----------
--------------- 
```

也就是说，OS X 中的 ComponentListener 不会为 componentMoved 发送持续更新，只有当您暂停一秒钟或松开鼠标时。这似乎与 Win/Linux 不同，所以我想知道是否有人有不同的解决方案。

在没有完全理解所有内容的情况下，我希望得到并处理绘制窗口标题栏的任何内容（似乎是关于根窗格的内容）。我什至不确定这是否可行，但这是我能想到的确定何时拖动整个窗口的唯一其他解决方案。

任何帮助表示赞赏！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T17:09:28.840

假设您有受信任的代码，您可以使用它`MouseInfo.getPointerInfo()`来获取指针的位置。可以轮询此信息，以便您可以确定窗口应该在哪里。无论如何，您可能只能轮询窗口的位置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-27T05:14:42.543

您能否使用 mouseMotionListener 来查看鼠标是否在移动，如果是，则使用 getLocation() 更新第二个窗口的位置。您还可以检查当前位置是否等于先前位置，以防止浪费资源。我不确定 getLocation() 是否能正常工作，它确实取决于操作系统如何处理它。

# tfs - 有没有更好的查看团队构建日志的方法？

> ID：757079
> 
> 赞同：2
> 
> 时间：2009-04-16T16:58:29.477
> 
> 标签：tfs, msbuild, build-process, build-automation

目前，用于团队构建的 msbuild 日志令人震惊，因为它们只是纯文本并且非常难以阅读。此外，我的构建创建的大约 30Mb 并且需要很长时间才能下载（我们的 TFS 服务器在我们的数据中心中）。

有谁知道能够更轻松地查看这些日志的任何方式，最好与 TFS 本身或 TFS WebAccess 集成？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T07:57:57.400

看看我不久前写的以下博客文章：

[http://www.woodwardweb.com/team/000415.html](http://www.woodwardweb.com/teamprise/000415.html)

这描述了如何创建一个简单的 ASP.NET 页面，该页面将通过 HTTP 将日志文件的内容流式传输给您。这样做的好处是，在 Visual Studio 中开始为您呈现日志之前，您不必等待整个页面加载完毕。

此外 - 您可以在流式传输时向文件添加一些简单的格式。在我博客上的示例中，我只是将每个目标的开头以粗体显示，以使它们更加突出，但是如果您愿意，您可以看到如何疯狂地使用这种方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-19T22:08:23.777

如果增加带宽不是一种选择，那么我建议您编写自己的 html 记录器并将其附加到构建过程中。将 html 构建日志拆分为次要部分（由目标和/或项目定义），并有一个索引文件指向所有次要部分，其中包含给定部分是否成功或失败的适当信息。然后你只需要解析索引文件和链接上的任何请求部分。

第三种可能性是在构建完成后压缩日志文件。

# .net - 您如何使用 grails 连接到带有用户名身份验证的 wcf HTTPS 端点？

> ID：757082
> 
> 赞同：0
> 
> 时间：2009-04-16T16:59:59.660
> 
> 标签：.net, wcf, web-services, grails

我在 IIS7 中使用用户名身份验证和消息安全性运行 WCF 服务。

客户想要但使用 GRAILS 进行开发。他们如何连接和验证服务？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-17T20:24:32.297

Grails 不将 Web 服务作为核心框架的一部分来处理。Grails 是用 Groovy 编写的，它允许您使用任何 Java 库。我建议使用 Java 的 Web 服务的 JAX-WS 实现之一。CXF 或 Metro 都应该满足您的需求。

本质上，您只想构建一个客户端，然后从 grails 应用程序中调用它。

*   CXF - [http://cxf.apache.org/](http://cxf.apache.org/)
*   地铁 - [https://jax-ws.dev.java.net/guide/](https://jax-ws.dev.java.net/guide/)

# jquery - Jquery 菜单：mouseover/mouseout moseenter/mouseleave 疯狂

> ID：757088
> 
> 赞同：1
> 
> 时间：2009-04-16T17:00:46.273
> 
> 标签：jquery, onmouseover

我正在尝试制作一个简单的菜单，其中第一级菜单条目是 li 元素，第二级是具有自己的 li 元素的 ul 块。没有什么特别亮的。CSS 包含`display: none`对于所有子菜单，我的（乐观）想法只是在第一级条目上触发 mouseover 时显示正确的 ul 元素，而不是在 SUBmenu（ul 元素）上触发 mouseout 时隐藏它们。我有一些问题要理解发生了什么。在 Firefox 上一切都很好，动作顺序：进入一级菜单 - 进入子菜单 - 退出子菜单表明触发了正确的事件序列：menuOn subMenuOn subMenuOff menuOff。我不明白为什么在同一事件序列中的 IE 中 subMenuOff 在 subMenuOn 之后突然触发：结果是子菜单立即消失。这就像这对夫妇（subMenuOn subMenuOff）被触发同时禁用子菜单。使用 mouseover 或 mouseenter 没有任何变化。使用悬停不会改变这种情况。对发生的事情有一些想法吗？

```
$(document).ready(
    function () {
        enableMenu();
    }
);

var flagOnSubMenu = false;

function enableMenu() {
    $('li.menu').bind('mouseenter', menuOn);
    $('li.menu').bind('mouseleave', menuOff);
    $('ul.sottomenu').bind('mouseenter', subMenuOn);
    $('ul.sottomenu').bind('mouseleave', subMenuOff);
}

function menuOn() {
    scrivi('menuOn');
    if (flagOnSubMenu) {
        scrivi('noAction');
        return;
    }

    var subMenuId;

    $('ul.sottomenu').hide();
    subMenuId = $(this).find("ul").attr('id');
    $('#' + subMenuId).show();
}

function menuOff() {
    scrivi('menuOff<br>');
    return;
}

function subMenuOn() {
    scrivi('subMenuOn');
    flagOnSubMenu = true;
}

function subMenuOff() {
    scrivi('subMenuOff');
    flagOnSubMenu = false;
    $(this).hide();
}

function scrivi(arg) {
    $('#debug').html($('#debug').html() + ' ' + arg);
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T17:43:47.870

我在 mouseover 和 mouseout 事件中遇到了一些疯狂的问题。

```
$("#menu>li").hover(
    function(){
        $("#menu *:animated").stop(true,true).hide(); //stop the madness
        $('ul',this).slideDown();
    },
    function(){
        $('ul',this).slideUp("fast");
    }
); 
```

停止动画对我来说是关键。没有它，在我完成鼠标悬停在菜单上之后，动画会持续触发很长时间。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T17:18:01.723

有些浏览器/框架会冒泡事件，有些则不会。

即（我不确定 AFA 浏览器采用哪种方式）当鼠标从一个元素移动到子元素时，一个浏览器将触发 mouseout。另一个不会但会触发也可以被父元素捕获的鼠标悬停。

# winforms - Winforms登录应用示例？

> ID：757089
> 
> 赞同：3
> 
> 时间：2009-04-16T17:01:05.397
> 
> 标签：winforms

我将很快使用 Winforms 和 Access 开发一个时间管理应用程序，并且正在寻找一些关于如何创建一个简单的密码保护应用程序的好资源。我来自asp.net，但对Winforms 的经验很少。是否有类似这样的端到端教程？

谢谢大家。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T17:19:22.110

好。在 VB.net 中，您有一个登录表单模板。只需添加/新建项目，选择“登录表单”。但这只会创建一个包含两个文本框、用户名和密码的对话框。每个人都可以这样做。

然后由您决定如何验证输入的用户名和密码是否是有效用户，针对数据库、加密文本文件、注册表中的加密字符串或 xml 文件或任何您想要的。

在生成的表格中还有一些信息：

> ```
> ' TODO: Insert code to perform custom authentication using the 
> ```
> 
> 提供的用户名和密码 '（请参阅[http://go.microsoft.com/fwlink/?LinkId=35339](http://go.microsoft.com/fwlink/?LinkId=35339)）。
> 
> ```
> ' The custom principal can then be attached to the current thread's 
> ```
> 
> 主体如下： ' My.User.CurrentPrincipal = CustomPrincipal ' 其中 CustomPrincipal 是用于执行身份验证的 IPrincipal 实现。' 随后，My.User 将返回封装在 CustomPrincipal 对象中的身份信息，例如用户名、显示名等。

如果您点击该链接，您将在这里结束：http: [//msdn.microsoft.com/en-us/library/aa302401.aspx](http://msdn.microsoft.com/en-us/library/aa302401.aspx)

Wich 可能不是您认为的最佳位置，因为它专注于 ASP.Net 但请查看那里的相关章节，因为它告诉您很多关于加密和该领域其他有用的东西。

如果您只有一个以单用户模式运行的应用程序，那么它足以存储在注册表或本地 xml 文件或类似文件中加密的用户和密码。

# sql - Sql Server 活动监视器中的这个过程是什么？

> ID：757094
> 
> 赞同：4
> 
> 时间：2009-04-16T17:01:46.160
> 
> 标签：sql, sql-server, sql-server-2005, process, ssms

SQL Server 2005 活动监视器中有一个似乎一直在运行的进程。双击它会产生以下查询：

`CREATE TABLE #tmpDBCCinputbuffer ([EVENT TYPE] NVARCHAR(512), [PARAMETERS] INT, [EVENT Info] NVARCHAR(512)) INSERT INTO #tmpDBCCinputbuffer EXEC ('DBCC INPUTBUFFER(58)') SELECT [EVENT Info] FROM #tmpDBCCinputbuffer`

知道它是什么吗？危险吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T17:08:00.000

具有讽刺意味的是，它是您用来查看在连接上运行的最后一个查询的查询，这就是您要查看所有连接的最后一个查询是什么的操作。包括您用来查看所有这些连接的连接。

需要的时候头晕的表情包在哪里？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T17:06:01.580

[http://msdn.microsoft.com/en-us/library/ms187730.aspx](http://msdn.microsoft.com/en-us/library/ms187730.aspx)

来自 SQL Server 开发人员中心的报价

> “DBCC INPUTBUFFER 权限默认仅授予 sysadmin 固定服务器角色的成员，他们可以看到任何 SPID。其他用户可以看到他们拥有的任何 SPID。权限不可转让。” ( [http://msdn.microsoft.com/en-us/library/aa258826(SQL.80).aspx](http://msdn.microsoft.com/en-us/library/aa258826(SQL.80).aspx) )

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-01-20T03:02:41.290

我只想分享另一个答案，进一步解释尼尔 N 的答案。

> DBCC INPUTBUFFER(spid) 命令将返回针对指定 SPID 执行的最新批处理的文本。当您双击活动监视器中的一行（或右键单击并选择“详细信息”）时，SQL Server 在幕后运行您在上面的帖子中引用的命令（替换所选行的 SPID - 61 in您的示例）返回针对连接发出的最新批次。在您的示例中，批次实际上恰好是 CREATE TABLE 等...由活动监视器发出以返回最新批次的批次！

克里斯·豪沃斯[https://social.msdn.microsoft.com/Forums/sqlserver/en-US/6bbe405b-b7d8-4f97-9150-cf03c59d4fe3/process-wont-die?forum=sqldatabaseengine](https://social.msdn.microsoft.com/Forums/sqlserver/en-US/6bbe405b-b7d8-4f97-9150-cf03c59d4fe3/process-wont-die?forum=sqldatabaseengine)

数字 58 是它始终返回的值，因为它是它的进程 ID，它是您运行的最后一个进程！

# asp.net - 如何通过电子邮件发送网络表单

> ID：757095
> 
> 赞同：1
> 
> 时间：2009-04-16T17:02:06.050
> 
> 标签：asp.net

我手头有一项任务，要求我在提交表格后立即通过电子邮件将表格发送给客户。

我的问题是：拥有一个 aspx（为了重用我的表单）如何获取生成的 html 以通过邮件发送它？

提前致谢

**编辑：** 我知道如何发送电子邮件，我正在寻找的是如何获取在我的网络表单中生成的 html，以便我可以将其放入电子邮件中。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T17:05:01.723

您应该能够在其上调用 Render 并对其进行流式传输。

```
StringWriter stringWriter = new StringWriter();
HtmlTextWriter htmlWriter = new HtmlTextWriter(stringWriter);
Page.RenderControl(htmlWriter);
string output = stringWriter.ToString(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T17:03:27.653

在 System.Web 中使用 SmtpMail 类？

# vb.net - 以可变频率执行按钮动作

> ID：757102
> 
> 赞同：0
> 
> 时间：2009-04-16T17:03:31.477
> 
> 标签：vb.net, button, action, frequency

我想制作一个按钮，该按钮以 Visual Basic .NET 中的数字输入的频率运行动作。我该怎么做？有人可以指出这种动作的语法吗？

@Jon，我认为那是 C++，我说的是 VB.Net。

@Adam Davis，VB.Net 3.5，我想做的就是使用“NumericUpDown”中的一个数字来为按钮提供按钮必须执行多少次操作。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T17:04:29.133

```
 Dim i as integer

    For (i = 1 To InputNumber)
       'Code here
    Next 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T10:26:22.203

这应该可以解决问题。

```
 For i As Integer = 0 To CInt(NumericUpDown1.Value)
        'Code to execute 
    Next 
```

# perl - 有没有办法为 Class::DBI 缓存机制？

> ID：757110
> 
> 赞同：3
> 
> 时间：2009-04-16T17:06:21.267
> 
> 标签：perl, caching, memoization, class-dbi

我有一组从[Class::DBI](http://search.cpan.org/dist/Class-DBI)继承的相当复杂的 ORM 模块。由于数据很少更改，我正在考虑在此之上使用缓存/记忆层来加快速度。我找到了一个模块：[Class::DBI::Cacheable](http://search.cpan.org/dist/Class-DBI-Cacheable)但没有评级或对 RT 的任何评论。我希望收到使用过这个或任何其他 Class::DBI 缓存方案的人的来信。

万分感谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-10-05T06:24:20.097

我也滚动了很多次我不想说的 ORM！如果您的所有提取都通过单个 api（或其子类）发生，那么缓存/记忆化非常容易。

对于基于唯一键的任何获取，您可以仅基于键的串联进行缓存。一种天真的方法可能是：

```
my %_cache;

sub get_object_from_db {
    my ($self, $table, %table_lookup_key) = @_;

    # concatenate a unique key for this object
    my $cache_key = join('|', map { "$_|$table_lookup_key{$_}" }
                       sort keys %table_lookup_key

    return $_cache{$cache_key}
        if exists $_cache{$cache_key};

    # otherwise get the object from the db and cache it in the hash
    # before returning
} 
```

您可以使用 CPAN 上的 Cache:: 模块套件代替散列，在缓存中实现时间和内存限制。

如果您要缓存一段时间，您可能需要考虑一种使缓存中的对象过期的方法。例如，如果您的所有更新也通过 ORM，您可以在 update() ORM 方法中清除（或更新）缓存条目。

最后一点要仔细考虑 - 您每次都返回相同的对象，这会产生影响。例如，如果一段代码检索了一个对象并更新了一个值，但没有将该更改提交到数据库，则检索该对象的所有其他代码都将看到该更改。如果您将一系列操作串在一起，这将非常有用——它们都可以更新对象，然后你可以在最后提交它——但这可能不是你想要的。我通常在对象从数据库中更新时在对象上设置一个标志，然后在您的 setter 方法中，如果对象已更新，则使该标志无效 - 这样，如果您真的想要一个新对象，您始终可以检查该标志。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-10-01T12:29:55.290

有几次我们推出了自己的，但我们将其限制在分析表明我们需要提升的特殊情况（例如大型连接）。由于我们的应用程序通常在数据库访问之上使用自定义抽象层（类似于本土 ORM），这就是我们实现缓存的地方。我们取得了令我们满意的好成绩，而且没有付出太多努力。当然，由于我们没有使用 CPAN ORM，我们也没有任何选择使用 CPAN 缓存模块。

这是严格逐案和选择加入的。无论您最终是使用 CPAN 解决方案还是自己使用 CPAN 解决方案，最好将其限制在分析表明您需要帮助的情况下，并确保它是可选的，这样您的缓存就不会以微妙的方式破坏您的应用程序在你没想到的时候积极主动。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T17:35:24.380

我之前使用过[memcached](http://www.danga.com/memcached/)来[缓存对象](http://search.cpan.org/dist/Cache-Memcached-Fast/lib/Cache/Memcached/Fast.pm)，但没有使用 Class::DBI（ORM 让我觉得很脏）。

# php - 使用 PHP 的大文件上传错误

> ID：757111
> 
> 赞同：2
> 
> 时间：2009-04-16T17:06:40.610
> 
> 标签：php, apache, file-upload

我有一张幻灯片的图片上传，用户不断上传超过 2MB 的文件。低于此大小的文件可以正常工作，但超过此大小的文件会导致浏览器超时。

这是我的 php ini 设置：

*   最大内存分配：12M
*   最大文件上传大小：10M
*   最大 HTTP 帖子大小：10M
*   最大执行时间：60
*   最大输入解析时间：120

这些设置在配置文件本身，我可以直接更改。使用 phpinfo() 时会显示更改。

我在 apache 服务器和 php 4.3.9（客户的选择，不是我的）上运行。apache 服务器的请求限制设置为默认值，我相信它在 2GB 左右？

当我使用 firebug 网络监视器时，看起来我没有收到来自服务器的完整响应，尽管我在使用这个工具方面没有太多经验。事情似乎在 43 秒左右超时。

我在网上找到的所有帮助都将上述设置作为罪魁祸首，但所有这些设置都远高于这个 2MB 文件和 43 秒超时。

有什么建议可以从这里解决这个问题吗？

以下是来自 phpinfo() 的相关 php ini 设置。让我知道是否需要再发帖。

*   file_uploads 开 开
*   最大执行时间 60 60
*   最大输入嵌套级别 64 64
*   最大输入时间 120 120
*   memory_limit 12M 12M
*   post_max_size 10M 10M
*   安全模式 关 关
*   upload_max_filesize 10M 10M
*   upload_tmp_dir 无值 无值

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T18:03:21.957

确保您在 php.ini 中激活了错误报告：**display_errors = On** ; 这可能会给你一个关于发生了什么的线索。生产服务器通常（应该）禁用错误报告。

我最近遇到了类似的问题，增加 memory_limit 设置对我有用。如果将文件***内容***读入变量，每个变量将占用与文件大小一样多的内存，从而增加脚本的内存需求。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T17:10:08.107

这些设置在哪里？如果您正在使用，`.htaccess`那么您的 Apache 配置可能不允许您覆盖这些设置。

如果确实应用了这些设置，我建议使用 phpinfo() 调用进行检查：

```
<?php
  phpinfo();
?> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T17:13:08.940

如果它是共享主机，您的主机可能设置了覆盖您的限制。

否则，请尝试使 POST 限制高于文件上传大小。AFAIK，上传已发布。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T17:41:50.963

如果问题是由于主机覆盖了您的超时，您可以寻找仍然使用 Apache 1 的主机：在 Apache 1 中，即使超时，本地 .htaccess 也会覆盖全局设置。

否则，有几十个 Java 小程序上传器只需几美元（谷歌它）。他们拆分文件，上传各个部分，然后透明地将这些部分重新组合在一起。

这是对超时的有保证的修复，并且具有让用户暂停和恢复上传、查看进度等的额外优势。

（基于 Flash 的上传者没有这个优势。）

# sql - 您在哪里存储代码中使用的长/完整查询？

> ID：757114
> 
> 赞同：1
> 
> 时间：2009-04-16T17:07:51.950
> 
> 标签：sql

这是我的情况。我注意到，当您在每个将使用它们的函数中嵌入查询时，代码变得更难维护。一些查询往往增长得非常快，并且在连接每一行后往往会失去可读性。所有连接附带的另一个问题是您必须测试特定查询并粘贴它。您被迫删除所有将查询字符串放在一起的 "。

所以我的问题是，使用什么方法将查询与代码分开？我尝试过搜索，但它看起来不是正确的，因为我没有找到任何相关的东西。

我想指出，视图和存储过程是不可能的，因为我的查询从生产数据库中获取数据。

谢谢你。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T17:13:23.777

如果您遵循[MVC 模式](http://en.wikipedia.org/wiki/Model-view-controller)，那么您的查询应该全部在模型中 - 即代表实际数据的对象。

如果没有，那么您可以将所有重复查询放入脚本文件中，仅包括每个请求中需要的那些。

但是，连接和那种东西很难摆脱；这就是程序员存在的原因:)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T17:13:25.790

这两个词将是你最好的朋友：存储过程

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-16T17:11:41.143

我通过将查询包装在表示存储在表中的实体的类中来避免这个问题。所以accounts表有一个Account对象。它将有一个插入/更新/删除查询。

我见过将查询存储在文件中的地方，并且模板用于替换部分查询。

Java 有一个叫做 SQLJ 的东西——不知道它是否曾经流行起来。

LINQ 也可能会提供一些解决此问题的方法。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-16T17:13:08.550

冒着被指责不回答问题的风险，我对你的建议就是不要。使用您选择的 O/RM，您会发现这个问题很快就会消失。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-16T17:15:47.420

我通常创建一个数据类来表示数据库中表示的对象的数据需求。因此，如果我有一个客户类，那么我也会创建一个 customerData 类，其中包含所有数据访问逻辑。这将数据逻辑排除在实体类之外。您将在此处添加所有 CRUD 方法以及自定义数据方法。

您还可以使用存储过程或 ORM 工具，具体取决于您的语言。

主要的关键是让你的数据逻辑远离你的业务和实体逻辑。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T17:19:59.097

我在生产环境中使用存储过程，我们也处理行......

# wpf - WPF Listbox 图像绑定问题（再次）！

> ID：757123
> 
> 赞同：1
> 
> 时间：2009-04-16T17:08:54.427
> 
> 标签：wpf, image, binding, listbox

这让我很生气，我无法将图像显示为列表框项：这是我的代码：

WPF：

```
 // listbox called lstWidgets
<ListBox.ItemTemplate>
 <DataTemplate>
    <StackPanel>
      <TextBlock Name="txtTitle" Margin="2,5,5,2" Text="{Binding name}" />
      <Image Name="imgDisp"  Source="{Binding img}" Width="50" Height="50"/>
   ..... 
```

C＃：

```
Class widget / props: string name, Image img (get,set)...
ObservableCollection<cls_Widget> widgets....
Image newImage = new Image();
newImage.Source = new ImageSourceConverter().ConvertFromString("")as ImageSource;
cls_Widget wdg = new cls_Widget();  
wdg.img = newImage
wdg.name = "My Widget";
widgets.Add(wdg);                  
lstWidgets.ItemsSource = widgets;
.... 
```

显示文本块文本，但不显示图像（图像区域为空白）。感谢您的帮助！我已经获得了要在不同的代码场景中显示的图像，但不是这个......

提前致谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T17:35:41.837

我认为您需要公开 imageSource，而不是 Image。您已经在模板中有一个图像。

顺便说一下，查看 Visual Studio 中的调试输出可能表明绑定失败的原因。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T18:21:34.503

如果要将图像的 Source 绑定到支持属性，则支持属性应该是图像源，而不是图像。

或者，您可以使用 ContentControl 在对象中显示图像。试试这个：

```
...
<TextBlock Name="txtTitle" Margin="2,5,5,2" Text="{Binding name}" />
<ContentControl Name="imgDisp" Width="50" Height="50" Padding="0"
                Content="{Binding img}"/>
... 
```

# java - java中的流

> ID：757126
> 
> 赞同：0
> 
> 时间：2009-04-16T17:09:53.053
> 
> 标签：java, client, io, stream

好吧，我正在用java开发一个单服务器多客户端程序。我的问题是我可以为所有客户端使用单个流还是必须为每个客户端创建一个单独的流？

请帮忙谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T17:25:23.670

通常，您需要每个客户端一个流。在*某些*情况下，您可以摆脱 UDP 和多播，但对于聊天服务器来说，这听起来不是一个好主意。

通常，无需额外工作即可轻松获得每个客户端的流，因为无论如何每个客户端都会连接到服务器，并且可以通过该连接轻松设置流。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T17:29:24.847

是的，你可以，但我认为这会更难。

如果您使用的是**[java.net.ServerSocket](http://java.sun.com/javase/6/docs/api/java/net/ServerSocket.html)**，那么每个客户端都通过以下方式接受：

```
Socket client = server.accept(); 
```

会有它自己的流，所以你不必做任何其他事情。

是否真的需要为所有客户提供单一流，或者只是您认为它会有所帮助。

对于后者，它可能会导致比解决的问题更多的问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T17:38:27.257

**你能做到吗？** 是的，正如 Jon Skeet 所说，您可以使用多播。

**你应该这样做吗？** 这取决于您使用流的目的。

对于大多数客户端服务器应用程序，每个客户端都需要一个流来维护独立通信。当然，在某些应用中使用多播是正确的方法，例如实时视频流。在这种情况下，您不希望在将相同数据流式传输到多个客户端时使您的网络不堪重负。当然，即使在这种情况下，每个客户端和服务器之间通常也会有某种单一的控制通道。

# sql - NHibernate - 将相同的实体映射到许多表

> ID：757127
> 
> 赞同：0
> 
> 时间：2009-04-16T17:09:53.787
> 
> 标签：sql, nhibernate

我正在开发一个具有我设计和实现的数据发布机制的应用程序。它允许应用程序的一个主实例向多个订阅者实例提供数据。这是通过将主服务器的数据加载到一组临时导入表中来实现的，这些表在订阅服务器上具有*完全相同的模式。*合并过程使用这些导入表来完成它的工作。

整个出版物工作正常。它在 NHibernate 之外执行，使用 ADO.NET 进行批量加载、用于区分和合并的存储过程集（它们由自定义工具自动生成）。此外，我们在主/订阅者之间只有一个 HTTP 链接可用于下载数据；我们无法直接连接到主 SQL 服务器。

我面临的问题是在用户实际合并新数据之前直观地向用户显示差异。在应用程序中，我想让 NHibernate 直接从这些临时导入表中加载我们的业务对象。我们可以这样做吗？无需维护两组几乎相同的映射文件？

在我们的上一个版本中，我们使用将从这些导入表加载的自定义代码来构建业务对象。它只会加载简单的属性，而不是处理关系。从编码/维护的角度来看，这很浪费时间。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T22:51:08.723

您是否尝试在需要动态更改表名的情况下执行[此类操作？](http://slagd.com/?p=62)

您可能还想查看[Fluent NHibernate](http://fluentnhibernate.org/)以获得解决方案。

另一种可能性是将临时表放在单独的数据库中，只需更改连接字符串。

# .net - 我的自定义“Horizo ntalRule”控件做错了什么？

> ID：757131
> 
> 赞同：0
> 
> 时间：2009-04-16T17:10:35.530
> 
> 标签：.net, winforms, custom-controls, paint

我编写了以下（非常简单的）控件以在应用程序中使用（为简洁起见，删除了注释）：

```
public partial class HorizontalRule : Control
{
    public HorizontalRule()
    {
        InitializeComponent();
    }

    protected override void OnPaint(PaintEventArgs e)
    {
        base.OnPaint(e);

        var g = e.Graphics;

        var rect = new Rectangle(
            this.ClientRectangle.Left,
            this.ClientRectangle.Height / 2 + 1, 
            this.ClientRectangle.Width,
            1);

        ControlPaint.DrawBorder3D(g, rect, Border3DStyle.Etched);

        return;
    }
} 
```

免责声明：我是绘制自己的控件的新手。

[我选择根据Vista UX 指南](http://msdn.microsoft.com/en-us/library/aa511459.aspx)中的建议以这种方式画线，该指南建议使用高度为 1 的蚀刻矩形作为分隔符。

当静态时，这看起来不错，但我注意到如果我将此控件放在窗口中并调整它的大小（例如通过锚点），我会得到重绘工件。我在整个客户矩形的宽度上重新绘制了我的边框，但这就像它实际上并没有被绘制一样。在 Horizo​​ntalRule 的构造函数中或以嵌入的形式启用 DoubleBuffered 似乎也没有什么区别。

我究竟做错了什么？

**更新：**

根据建议，我尝试最后调用 base.OnPaint 而不是第一个。我不知道那会改变什么，而且它似乎也没有改变任何东西。

不绘制背景没有任何用处。我仍然得到伪影，但我也没有得到背景颜色，所以我看到了水平线下方的任何图像。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T17:27:44.367

不要打电话`base.OnPaint`，或者最后打电话（我现在不记得了）。

另外，尝试覆盖背景绘制方法，这样它就不会调用基础。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T17:56:22.783

我可以通过覆盖 OnResize() 使整个控件无效来破解不会导致伪影的解决方案：

```
protected override void OnResize(EventArgs e)
{
    base.OnResize(e);

    this.Invalidate();
} 
```

但是，我不确定这是“正确”的解决方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T17:14:09.453

我会在位图上绘制它，然后绘制位图，而不用担心每次都绘制它。

# web-services - BizTalk 部署，包括 Web 参考

> ID：757134
> 
> 赞同：1
> 
> 时间：2009-04-16T17:11:58.757
> 
> 标签：web-services, biztalk, biztalk-deployment

通过 Web 服务调用尝试 BizTalk

请求/响应在我自己的开发机器上运行良好，但不是在测试中......

将 MSI 导出到我的部署测试服务器（一个单独的虚拟服务器），使用 Application/Import 创建应用程序，然后对其进行测试以发现它不起作用...

*   检查事件日志并显示“无法加载文件或程序集”的 XLANG 错误

*   检查 GAC 并且 BizTalk 程序集不存在...

*   所以手动添加它，这似乎可以解决问题

添加的 Web 服务引用是否意味着程序集必须作为部署的一部分进行 GAC？

只是让我感到困惑，尝试部署到真正的测试服务器，导入 MSI，将 DLL 手动复制到 GAC ......它失败并在 eventlog 中出现 XLANG 错误:-(

*   知道这里发生了什么吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T18:35:43.423

你用的是什么适配器？我假设 SOAP 适配器。如果是这样，您可以查看绑定。看这里靠近图 6：

[http://msdn.microsoft.com/en-us/magazine/cc163464.aspx](http://msdn.microsoft.com/en-us/magazine/cc163464.aspx)

-布莱恩

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T20:38:41.487

默认情况下，仅导入 MSI 将不包含 dll。您还需要运行它（例如从 Windows 资源管理器或安装后给出的选项）。这将物理移动文件。这种行为在向外扩展时非常有用。我认为这与网络参考没有任何关系。

# java - ICEFaces 推送技术的使用

> ID：757135
> 
> 赞同：0
> 
> 时间：2009-04-16T17:12:01.363
> 
> 标签：java, ajax, jsf

我们正在研究/调查 ICEFaces AJAX 推送技术的可能用途。想知道有没有人用过这个？他们面临哪些问题？以及对它的总体印象。

我们正在使用 Websphere 6.1 应用程序服务器 - 任何实现此功能的人都在 Websphere 上实现了它。

我们正在尝试解决我们网站上的一个问题，我们希望用户能够对产品进行投标并实时获得投标价格。

我们目前正在使用 MyFaces + Tomahawk + ​​Richfaces + 我们自己的一些组件，但如果需要，我们可以远离 Richfaces。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T22:25:59.683

像宣传的那样工作，在家和办公室经常使用它。

如果您使用 springsecurity 而不是不使用带有请求范围 bean 的 ondemandrender，则会丢失渲染之间的安全上下文。

Sessionrender 似乎没有这个问题。

最近我在 book seam in action 中看到了一个很好的例子（虽然我的一些更好:-)），他们有一个关于冰面的小部分。

sessionrenderer 比 ondemandrenderer 或 intervalrenderer 更容易使用，但没有那么多功能。

这是一个非常基本的例子。还使用了其他一些技术，我们的小项目以集成不同的技术而闻名。 [http://web.me.com/cannonwc/Site/Blog/Entries/2008/11/7_An_example_of_ajax_Push.html](http://web.me.com/cannonwc/Site/Blog/Entries/2008/11/7_An_example_of_ajax_Push.html)

主站点上实际上还有更多内容

www.mooncatventures.com 和博客网站 www.mooncatventures.com/blogs

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T19:22:37.180

首先让我说 Icefaces 是一个非常可靠的产品，它为我们节省了大量的开发时间，让我们在团队中没有大量 JavaScript 知识的情况下获得一个好的、现代感的 web 应用程序。

也就是说，Icefaces 确实有它的缺点。许多很酷的功能，如部分提交，会导致客户端和服务器之间来回交流。状态保存在服务器上并反映在客户端中，这会在客户端和服务器之间产生大量来回流量。为了获得最佳性能，您将不得不深入挖掘并使用一些 JavaScript，这正是您一开始就试图避免的事情。甚至验证也需要在服务器端完成，但是我相信这是一个 JSF 限制，而不是 Icefaces 限制。

我也不理解 Icefaces 如何在看似次要的版本之间更改组件 API。整个树组件在 1.7.2 和 1.8 之间发生了变化。树组件丑陋且有限，因此这是一个可喜的变化，但仍然如此。我们觉得 1.8 是强加给我们的，这让我想到了下一点。

Icefaces 将其非支持合同付费用户视为二等公民。在 Icefaces 1.7.2 和 1.7.2 SP1 之间，推送机制发生了重大回归，导致它在我们的应用程序中完全失败。唯一可用的修复是迁移到 1.8（其中有 API 更改）或使用 1.7.2-SP2，该版本仅适用于支持合同的客户。不要忘记 IceFaces 的目的是向您推销支持。1.7.1 的唯一修复是手动修补版本的源代码，这并不可怕，但我希望会更好。

也就是说，我发现 IceFaces 是一个有用的产品，并且比 RichFaces 好得多，尤其是在文档质量方面。但是，如果我现在开始，如果你想要一个真正的开源产品，我也会看看 GWT，如果你想要非常丰富和厚客户端式的东西，我也会看看 Flex。有所有问题的事件我仍然推荐 Icefaces 但它肯定会更好

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T18:34:33.393

我已经简要地完成了一个原型。它像宣传的那样工作。将 AJAX 推送与此框架或任何其他框架一起使用时要考虑的重要事项是对 Web 服务器的影响。要完成 AJAX 推送，客户端要么保持与服务器的持久连接，要么使用轮询，这两者都对高需求的 Web 应用程序有影响。我没有使用 Websphere 的经验，但您会想要研究根据您的应用程序容器 (Websphere) 和您将使用 Ajax 推送的页面上的负载特别推荐的内容。

我认为值得注意的是，还有其他框架在 AJAX 推送方面做得非常好和灵活——因为我总是倾向于开源解决方案（我们运行一个非常有效的 Apache/Tomcat/Spring/DWR 堆栈）我会建议检查 DWR

[http://directwebremoting.org/](http://directwebremoting.org/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-02T17:55:57.777

We're using it on a conversion project right now (porting a JSF application away from IBM's Portlet JSF implementation to IceFaces on Tomcat) and as everyone else states, it works as advertised. We've made very few modifications to accommodate for the implementation change. So far, I'm impressed.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-22T07:52:20.300

据我所知，DWR 使用的是 JavaScript 编程模型。使用 ICEfaces，您根本不需要 JavaScript。从维护的角度来看，它远比 AJAX 推送本身有趣。尽管在 1.8 版中使用 AJAX 推送变得如此容易，以至于每个人都应该评估它。

我将在即将出版的 ICEfaces 书中讨论一些细节；-)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-03-06T13:59:06.473

您可以在没有 IceFaces 组件的情况下使用 Icefaces Push。我们将 Icefaces Push 与 Primefaces 组件一起使用。它可以一起工作，但并非所有组件都兼容，其中一些组件在执行推送时会引发 Javascript 错误。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-27T14:04:57.870

我认为将 ICEfaces 与 RichFaces 混合使用是没有意义的。AJAX 部分不兼容。MyFaces 上的 ICEfaces 没问题。

瓷砖？你想保留瓷砖吗？这在使用与 ICEfaces 紧密集成的 Facelets 时没有任何意义。随着 Facelets 成为 JSF 2.0 的标准，无论如何考虑从 Tiles 更改为 Facelets 是一个好主意。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-07-13T16:11:32.247

我们正在使用 ICEFaces 并且很容易开发一个丰富的应用程序。主要特性是可扩展的 Ajax Push 服务器。

ICEFaces 使用来自客户端的持久客户端连接，如果您的服务器不使用异步套接字，那么它将需要为每个连接创建一个线程。随着用户数量的增加，线程上下文切换会对性能产生不利影响。好消息是，ICEFaces 已经支持来自（Glassfich、Jetty、Tomcat、JBoss）的 ARP（异步请求处理）。除此之外，该实现还附带了一个异步 HTTP 服务器，您可以在当前环境（例如 Websphere）中使用它。

“有了ICEFaces，你根本不需要java 脚本”。这在许多情况下都很棒，但有时您不想进行 ajax 调用来仅选中复选框或激活文本字段。添加 javascript 来做到这一点不是火箭科学，但它会让你的代码有点难看。

确实，ICEFaces 将其合同付费用户视为一等公民（这是我在支付支持后所期望的：D），但您始终可以访问代码。很容易下载一个标签版本并用 ant 编译它。

# multithreading - 关于 IOCP 的问题

> ID：757138
> 
> 赞同：0
> 
> 时间：2009-04-16T17:13:13.857
> 
> 标签：multithreading, operating-system, iocp

如果我想使用完成端口从不同的线程获取信息，

我该如何设计程序的结构？下面的那个怎么样？

如果我想使用全局函数，如何设置互斥锁？

```
Main(){
  for i in range NumOfThreads{
    CreateIoCompletionPort() 
    CreatThread(ThreadFun)
  }
}

ThreadFun(){

    While(1){
      GetQueuedCompletionStatus(); // wait for completion of an IO
      Process What ever has completed ();
      Start another file operation();
    }

} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-21T12:27:39.230

试试这个解决方案：

```
Main(){
  for i in range NumOfThreads{
    CreateIoCompletionPort() 
    CreateThread(ThreadFun)
  }

  for i in range NumOfCallerThreads
    CreateThread(ThreadCaller)
}

ThreadCaller(){
  While(1){
    Start another file operation();
  }
}

ThreadFun(){
    While(1){
      GetQueuedCompletionStatus(); // wait for completion of an IO
      Process What ever has completed ();
    }
} 
```

您可以在没有任何关键部分的情况下做到这一点！您所需要的只是保证“开始另一个文件操作（）；” 关闭相应的 IOCP 后不会被调用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-07-20T10:10:57.197

Push Framework，[http://www.pushframework.com](http://www.pushframework.com)也使用了这种设计，只是它增加了另一个线程来接受传入的连接。

# animated - Wavefront .obj 文件是否支持动画？

> ID：757145
> 
> 赞同：23
> 
> 时间：2009-04-16T17:14:15.413
> 
> 标签：animated, wavefront, .obj, 3ds

如何将 3D Studio 动画模型导出为 OBJ 格式（如果可能）？生成的文件会是什么样子？我怎么读？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-16T17:27:08.440

不，`.obj`文件不支持动画。

您可以查看[`.obj`规范](http://paulbourke.net/dataformats/obj/)以了解其支持的详细信息。

您可以`.obj`每帧导出一个，但这会很麻烦。根据工具的不同，可以为`.obj`每个关键帧导出一个。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2013-01-14T18:06:40.587

Blender 2.63 可以导出 .obj 格式的动画，每个关键帧（如上面假设的）都是它自己的完整 .obj。Blender 可以相对快速有效地处理这个导出函数。因此，1，Blender 是一个出色的概念工作证明，2，Blender 实际上可以帮助您编写代码（它是开源的，您可以重新分发任何已编辑的代码源），让您完全绕过编写自己的高效、快速支持这个操作。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2012-02-14T17:36:42.270

尽管 .obj 规范本身不支持动画，但通过简单地使用单独的 .anm 文件对其进行扩充，您可以获得出色的动画，尽管是无骨动画。

看看：- [http://public.sanguinelabs.co.uk/expose/product.php?id=wastudio](http://public.sanguinelabs.co.uk/expose/product.php?id=wastudio)

这提供了一个非常易于使用的“动画制作器”以及开源模型库（用于 OpenGL）。

注意：我是 Wavefront Animation Studio 的开发人员，但在我自己的项目中也大量使用它。如果您有任何改进或错误要报告，请随时给我发电子邮件:)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2012-10-28T18:30:56.163

事实上，您可以为波前格式对象设置动画，您必须在模型中使用组并在代码中单独转换它们。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2021-12-15T12:51:01.683

.obj 文件默认不支持存储动画。但是，您可以使用 Blender 3D 将动画网格导出为 .obj 文件序列。（.obj 导出器包含一个相关选项...）如果您想以 .obj 文件查看动画序列，您可以使用以下由 OpenGL 和 python 编写的程序：

[https://github.com/csmailis/ObjSequenceViewer](https://github.com/csmailis/ObjSequenceViewer)

如果您使用它，请确保您指定的目录包含所有按顺序文件名存储的 .obj 文件。

# sql-server - 在 MSSQL 中混合 XML 父项和子项

> ID：757146
> 
> 赞同：1
> 
> 时间：2009-04-16T17:15:14.100
> 
> 标签：sql-server, xml, xpath, cookies

我认为我需要的是 CROSS APPLY，但我似乎无法弄清楚语法。我在 MSSQL 2008 数据库中有一组 XML，如下所示：

```
<Cookie>
   <id>Chocolate Chip</id>
   <ChocolateChipPeanutButter>
      ...
   </ChocolateChipPeanutButter>

   <ChocolateChipPecan>
      ...
   </ChocolateChipPecan>
</Cookie>

<Cookie>
   <id>Raisin</id>
</Cookie>

<Cookie>
   <id>Coconut</id>
</Cookie>

<Cookie>
   <id>Sugar</id>
</Cookie> 
```

我正在尝试将 XML 切碎，以便获得如下所示的结果集：

```
Cookie Name                   Cookie SubName
___________                   ______________
Chocolate Chip                <null>
Chocolate Chip                ChocolateChipPeanutButter
Chocolate Chip                ChocolateChipPecan
Raisin                        <null>
Coconut                       <null>
Sugar                         <null> 
```

我想我需要写这样的东西（假设 XML 数据存储在**DECLARE @XMLData XML**中：

```
SELECT
     TheXML.TheCookie.query('data(./id)')     AS CookieName
   , TheXML.TheCookie.query('.')              AS CookieData
   , Sub.SubCookieName                        AS SubCookieName
FROM
   @XMLData.nodes('//Cookie') AS TheXML(TheCookie)
CROSS APPLY
   (
       SELECT
          TheCookieXML.SubCookieName.query('local-name(.)')
       FROM
          CookieData.nodes('./*') AS TheCookieXML(SubCookieName)
   ) 
```

我知道，我知道，这个 XML 模式对于我试图用它做的事情来说是很糟糕的，但是让我们假设我们以这种方式处理数据并从那里开始工作。我在正确的轨道上吗？CROSS APPLY 会这样工作吗？现在蝙蝠侠还能救我吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T17:26:19.877

尝试这样的事情：

```
SELECT
     TheXML.TheCookie.value('(id[1])', 'varchar(20)') AS CookieName
   , TheXML.TheCookie.query('.') AS CookieData
   , Sub.SubCookie.value('local-name(.)', 'varchar(20)') AS SubCookieName
FROM
   @xmlcon.nodes('//Cookie') AS TheXML(TheCookie)
CROSS APPLY
    TheXML.TheCookie.nodes('./*') as Sub(SubCookie) 
```

麻烦的是 - 这也选择了“id”节点:-(

马克

# hardware - Spartan-3E 上的随机数生成

> ID：757151
> 
> 赞同：11
> 
> 时间：2009-04-16T17:15:40.963
> 
> 标签：hardware, random, verilog, fpga

我需要在 Spartan-3E FPGA 上为我的遗传算法生成伪随机数，我想在 verilog 中实现它：你能给我任何指示吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-17T01:01:10.710

当然，亚当的随机发生器是不可合成的！您必须显式创建一个[LFSR](http://en.wikipedia.org/wiki/LFSR)。

以下示例可能会有所帮助。它是一个最大 8 位的 LFSR

```
module lfsr(input clk, reset, en, output reg [7:0] q);
  always @(posedge clk or posedge reset) begin
    if (reset)
      q <= 8'd1; // can be anything except zero
    else if (en)
      q <= {q[6:0], q[7] ^ q[5] ^ q[4] ^ q[3]}; // polynomial for maximal LFSR
  end
endmodule; 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-10-29T15:57:01.877

您已经得到了一些很好的答案，但我只想指出 FPGA 中 LFSR 的规范指南在这里：

[http://www.xilinx.com/support/documentation/application_notes/xapp052.pdf](http://www.xilinx.com/support/documentation/application_notes/xapp052.pdf)

它在某些地方有点 Xilinx 特定（这对您的 FPGA 来说没问题：），但这些原则可以转移到其他人身上。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-16T17:30:35.263

通常你会使用[IEEE.math_real](http://www.csee.umbc.edu/help/VHDL/stdpkg.html)统一函数

```
use IEEE.math_real.all;
procedure UNIFORM (variable Seed1,Seed2:inout integer; variable X:out real); 
```

但是稍微研究一下伪随机数生成器 (PRNG)，您会发现许多变体都是简单的[LFSR](http://en.wikipedia.org/wiki/Linear_feedback_shift_register) ——它们看起来与 CRC 生成器非常相似。

如果您想从现有的、工作的 PRNG 开始自己开发，这里有几个资源：

[http://www.opencores.org/?do=project&who=systemc_rng](http://www.opencores.org/?do=project&who=systemc_rng)

[http://verificationguild.com/modules.php?name=Downloads&d_op=viewdownload&cid=3](http://verificationguild.com/modules.php?name=Downloads&d_op=viewdownload&cid=3)

这是一个 CRC VHDL 代码生成器：

[http://www.easics.be/webtools/crctool](http://www.easics.be/webtools/crctool)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-06-24T06:43:05.947

有一个在线工具可以为伪随机数生成器生成 Verilog 或 VHDL 代码。它在[OutputLogic.com上](http://OutputLogic.com)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-26T14:48:18.043

上面指向 OpenCores 的指针在 verilog 文件夹中有一个文件，名为：[rng.v](http://opencores.org/project,systemc_rng)

我在 Spartan-3AN 中使用过它，效果很好。在我对部件进行编程后，我的代码使用随机数生成器来选择一个随机 PWM，它涵盖了所有可选的 PWM。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-04T07:03:08.213

我同意 LFSR。我之前做过一个，它是用来加密的。

# c++ - 在构造时将 C++ 迭代器范围连接到 const 向量成员变量中

> ID：757153
> 
> 赞同：7
> 
> 时间：2009-04-16T17:15:51.680
> 
> 标签：c++, stl, constructor, iterator, concatenation

我有一个 X 类，我在这里提供了一个片段：

```
class X {
  public:
    template <typename Iter>
    X(Iter begin, Iter end) : mVec(begin, end) {}

  private:
    vector<Y> const mVec;
}; 
```

我现在想为这个类添加一个新的连接构造函数，比如：

```
template <typename Iter1, typename Iter2>
X(Iter1 begin1, Iter1 end1, Iter2 begin2, Iter2 end2) : mVec(???) { ??? } 
```

这样的构造函数会将两个范围 [begin1, end1) 和 [begin2, end2) 连接到 mVec 中。挑战是

1）我想保留 mVec 上的 const，以便它在 X 的其他方法中被认为是恒定的。

2）如果可能的话，我想避免不必要的副本。也就是说，一种解决方案是有一个静态方法，该方法构造一个非常量临时到范围 1，插入范围 2 并返回它，然后定义连接构造函数以

```
template <typename Iter1, typename Iter2>
X(Iter1 begin1, Iter1 end1, Iter2 begin2, Iter2 end2) 
  : mVec(concatenate(begin1, end1, begin2, end2)) { } 
```

但我相信，这至少会额外复制一次所有值。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-16T18:02:09.777

好问题。我会尝试实现一个特定的迭代器包装类型，将两个范围变成一个范围。类似的东西：

```
// compacted syntax for brevity...
template <typename T1, typename T2>
struct concat_iterator
{
public:
   typedef std::forward_iterator_tag iterator_category;
   typedef typename iterator_traits<T1>::value_type value_type;
   typedef *value_type pointer; 
   typedef &value_type reference;

   concat_iterator( T1 b1, T1 e1, T2 b2, T2 e2 ) 
      : seq1( b1 ), seq1end( e1 ), seq2( b2 ), seq2end( e2 );
   iterator& operator++() {
      if ( seq1 != seq1end ) ++seq1;
      else ++seq2;
      return this;
   }
   reference operator*() {
      if ( seq1 != seq1end ) return *seq1;
      else return *seq2;
   }
   pointer operator->() {
      if ( seq1 != seq1end ) return &(*seq1);
      else return &(*seq2);
   }
   bool operator==( concat_iterator const & rhs ) {
      return seq1==rhs.seq1 && seq1end==rhs.seq2 
          && seq2==rhs.seq2 && seq2end==rhs.seq2end;
   }
   bool operator!=( contact_iterator const & rhs ) {
      return !(*this == rhs);
   }
private:
   T1 seq1;
   T1 seq1end;
   T2 seq2;
   T2 seq2end;
};

template <typename T1, typename T2>
concat_iterator<T1,T2> concat_begin( T1 b1, T1 e1, T2 b2, T2 e2 )
{
   return concat_iterator<T1,T2>(b1,e1,b2,e2);
}
template <typename T1, typename T2>
concat_iterator<T1,T2> concat_end( T1 b1, T1 e1, T2 b2, T2 e2 )
{
   return concat_iterator<T1,T2>(e1,e1,e2,e2);
} 
```

现在你可以使用：

```
 class X {
 public:
    template <typename Iter, typename Iter2>
    X(Iter b1, Iter e1, Iter2 b2, Iter2 e2 ) 
      : mVec( concat_begin(b1,e1,b2,e2), concat_end(b1,e1,b2,e2) ) 
    {}

  private:
    vector<Y> const mVec;
}; 
```

或者（我刚刚想到）你不需要重新声明你的构造函数。让你的调用者使用辅助函数：

```
X x( concat_begin(b1,e1,b2,e2), concat_end(b1,e1,b2,e2) ); 
```

我没有检查代码，只是在这里输入了我的头顶。它可以编译也可以不编译，它可以工作也可以不工作……但你可以以此为起点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T17:29:35.517

最好放弃`const`（你为什么要坚持呢？）。

否则，您必须构建一个连接迭代器。这是相当多的代码，请参阅[此线程](http://groups.google.com/group/boost-list/browse_thread/thread/f9027afd9e97d815)了解更多信息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T17:49:33.923

根据您的观点，C++ 最好或最差的特性之一是您可以在必要时滥用它来完成工作。在这种情况下， const_cast 是受害者：

```
template <typename Iter1, typename Iter2>
X(Iter1 begin1, Iter1 end1, Iter2 begin2, Iter2 end2) : mVec(begin1, end1) {
    const_cast<vector<Y>&>(mVec).insert(mVec.end(), begin2, end2);
} 
```

我可能有一些细节错误，我没有尝试编译它。但它应该给你的想法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T19:21:06.420

> 1）我想保留 mVec 上的 const，以便它在 X 的其他方法中被认为是恒定的。

*   这是`const`对成员变量的一种奇怪用法。它违背了良好的设计。根据定义，构造是一个需要对象发生变化的过程。

*   至于您保持对象不可修改的要求 - 使用适当的封装。您应该使用-member 函数来为您的类的客户`const`公开任何基于您的功能。`mVec`

2）如果可能的话，我想避免不必要的副本。也就是说，一种解决方案是有一个静态方法，该方法构造一个非常量临时到范围 1，插入范围 2 并返回它，然后定义连接构造函数以

您应该总体上查看移动构造函数和 r 值引用（C++0x 的承诺目标）。阅读这篇[文章](http://www.artima.com/cppsource/rvalue.html)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-16T18:03:19.413

您的静态方法可能没有您想象的那么糟糕，具体取决于您的编译器所做的优化。在 C++0x 中，移动构造函数将删除当前正在发生的任何复制。

同时使用包装迭代器。代码不会像 avakar 链接到的线程那么糟糕，因为您只需要实现一个[输入迭代器](http://www.sgi.com/tech/stl/InputIterator.html)。

# asp.net - Jquery 树和 asp.net 2.0

> ID：757161
> 
> 赞同：2
> 
> 时间：2009-04-16T17:18:51.017
> 
> 标签：asp.net, jquery, tree

关于如何使这两个工作，我几乎没有具体的问题。我需要可以在客户端操作的树（添加/删除节点，展开/折叠），并且可以在用户专门按下 SAVE 按钮时保存在数据库中。

从我所做的研究中，我了解到我需要做的是在按下保存按钮时使用回调（asp.net 回调）来使用 jquery 树并将其发送到服务器。我很想知道是否有人有处理这种情况的经验。

我是否以 Javascript 数组、JSON 或 XML 将其发送回服务器？我有一个使用回调解决的简单示例，其中我的页面在我的 aspx.cs 文件中定义如下：

```
public partial class Default2 : System.Web.UI.Page, ICallbackEventHandler 
```

（我会发布代码，但由于某种原因，当我尝试发布一大块时，格式被搞砸了）

现在，我想知道这里的技术细节是什么，CallBack 和 asp.net ajax 库有什么区别。从我读到的，它本质上是一样的。

那么我是否应该能够使用 Javascript 树并将其打包，然后将其发送到服务器以保存到 DB 中？

我正在使用 asp.net 网络表单

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T19:56:03.067

有一个更简单的解决方案。创建您的 Jquery 树视图，然后连接一个 HTML 提交按钮以触发来自 JQuery ($.Ajax(function(){}.....) 的 AJAX 调用并将其发送到将处理的 Web 服务 (*.asmx)回调。这是一个解释它的示例：

[这里的例子](http://encosia.com/2008/03/27/using-jquery-to-consume-aspnet-json-web-services/)

# logging - 按相似性对 log4net 错误进行分组

> ID：757170
> 
> 赞同：1
> 
> 时间：2009-04-16T17:21:18.080
> 
> 标签：logging, log4net, error-logging

我们使用 log4net 来记录各种 Web 应用程序的应用程序异常。目前我们使用`RollingLogFileAppender`阈值为 的`Info`和`SmtpAppender`的阈值为`Warn`。

问题是我们没有简单的方法来按内容对错误日志条目进行分组。我们经常看到某些错误，而其他错误则不时出现。我们希望能够自动跟踪相同错误的发生。

从概念上讲，这很简单——对日志条目的最后一个（例如 50 个字符）进行模式匹配应该允许我们这样做。

有没有人实施过这样的解决方案，或者任何人都可以推荐更好的方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T17:30:49.367

只需将您的行记录为 XML（当然，其他格式也可以使用）。

这是我们的做法：

```
<USERID>GUID</USERID><ERRORCODE>INVALID_XML</ERRORCODE><DESCRIPTION>File x is not in correct xml format</DESCRIPTION> 
```

然后我们解析日志文件并将它们显示在 datagridview 中，其中包含错误代码、描述、日志级别的列。然后我们可以快速排序或过滤，例如 ERRORCODE。

在数据集中查找那些 INVALID_XML 条目将很快告诉我们这些错误是否存在于日志文件中。

通过 userIds，我们还可以看到客户端在登录期间所做的所有调用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T17:31:07.150

您可以尝试使用不同的 Appender（例如 DBAppender）（当然，带有错误阈值），然后对结果表进行排序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T17:30:20.337

我不认为这样的解决方案是开箱即用的。但是，您可以定义自定义日志级别（或选择未使用的级别之一）以输出到其自己的**ILog**以查找更常见的错误，并在“主要”错误日志中将它们过滤掉，而不会带来太多麻烦。

# c - 内核模块中的进程描述符

> ID：757177
> 
> 赞同：1
> 
> 时间：2009-04-16T17:24:15.810
> 
> 标签：c, module, linux-kernel

是否可以获得指向内核模块中进程的进程描述符的指针？如果可能，请发布如何？我需要找到进程打开的所有文件及其每个文件描述符的偏移值....

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T17:32:00.143

好吧，我不知道如何从内核模块中获取它，但是有很多方法可以从常规代码中获取它……不是特别有效的方法。从 lsof 和其他类似实用程序的方式开始，然后查看 /proc/$pid/fd

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T17:34:45.863

扫描 proc 文件系统以查找具有打开文件描述符的进程。但是，您无法检测到打开文件句柄的偏移量。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T18:02:46.577

我发现它我得到了指向进程描述符的指针......该函数在 linux/sched.h 中声明

`struct task_struct find_task_by_pid(pid_t pid)`..我想我可以使用这个进程描述符来跟踪文件描述符及其偏移量......谢谢大家的支持

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-18T09:36:30.160

我不确定您要实现什么，通常所有内容都仅在给定进程 ID 的上下文中执行。您始终可以通过“当前”全局获得它。如果您想查找任意进程描述符，那么 find_task_by_pid 可能就是您想要的。所有进程信息都来自 task_struct。

# mysql - MySQL中外键的基础知识？

> ID：757181
> 
> 赞同：94
> 
> 时间：2009-04-16T17:26:04.823
> 
> 标签：mysql, foreign-keys

关于如何使用 MySQL 的外键构造有什么好的解释吗？

我不能从 MySQL 文档本身中得到它。到目前为止，我一直在处理诸如外键连接和编程代码之类的事情。

问题的第二部分，使用 MySQL 的内置外键是否有任何改进？

* * *

## 回答 #1

> 赞同：122
> 
> 时间：2009-04-16T17:30:56.823

`FOREIGN KEYS`只需确保您的数据是一致的。

它们并没有提高查询的效率，它们只是使一些错误的查询失败。

如果你有这样的关系：

```
CREATE TABLE department (id INT NOT NULL)
CREATE TABLE employee (id INT NOT NULL, dept_id INT NOT NULL, FOREIGN KEY (dept_id) REFERENCES department(id)) 
```

, 那么你不能删除 a`department`如果它有一些`employee`'s。

如果您提供`ON DELETE CASCADE`定义`FOREIGN KEY`，引用行将与被引用行一起自动删除。

作为一个约束，`FOREIGN KEY`实际上会减慢查询速度。

从引用表中删除或插入引用表时，需要执行额外的检查。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-04-16T17:33:52.073

使用真实外键的主要好处是确保数据完整性，并能够在修改或删除某些内容时对相关项目设置级联操作。

例如，假设您正在编写一个论坛。您有一个带有主键的“主题”表`topics.topic_id`，并且您有一个“帖子”表，其中帖子附加到带有列的主题，该列`posts.topic_id`是主题表的外键。

这种外键关系确保每个帖子都附加到一个有效的主题。如果您拥有的唯一主题具有 ID #1，则不可能在附加到主题 #2 的数据库中存在帖子。数据库确保了这一点。

对于级联的好处，您可以设置它，以便如果从主题表中删除主题，数据库会自动删除帖子表中附加到该主题的所有帖子。这很好，因为它删除了您必须记住手动执行的步骤，当您将许多表链接在一起时，这可能会变得非常复杂。使用外键可以自动清理所有关系。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2015-09-10T07:22:52.687

1.外键只是确保您的数据是一致的。

2.如果我们对外键定义应用删除级联，当父行被删除时，引用行将自动删除。

3.如果我们对外键定义应用更新级联，当父行更新时，子行将自动更新。

查询：ALTER TABLE child ADD FOREIGN KEY(parent_id) REFERENCES parent(id) ON UPDATE CASCADE ON DELETE CASCADE ;

4.  您不能直接删除父表，首先从子表中删除外键而不是删除父表。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-04-16T17:31:25.217

主要优点是您可以限制可以在表格中输入的值；如果您尝试输入引用表中不存在的值，您将无法执行此操作。

此外，如果您更新或删除引用表中的值，您可以将其设置为自动更新值或级联删除包含该值的任何行。

这确实是利用您的代码的一个很棒的功能。

# c# - 如何在 WPF 中继承基于类型的样式？

> ID：757185
> 
> 赞同：0
> 
> 时间：2009-04-16T17:26:59.517
> 
> 标签：c#, .net, wpf

我想对所有`Image`s 和`AutoGreyableImage`s 使用相同的样式（我的自定义控件继承自`Image`）。我在应用程序范围内声明了以下样式：

```
<Style TargetType="{x:Type Image}"
    x:Key="ImageType">
    <Setter Property="Stretch"
            Value="Uniform" />
    <Setter Property="Height"
            Value="16" />
    <Setter Property="Width"
            Value="16" />
    <Setter Property="SnapsToDevicePixels"
            Value="True" />
</Style> 
```

但是`AutoGreyableImage`s不接受这种风格。这也不起作用：

```
<Style TargetType="{x:Type my:AutoGreyableImage}"
       BasedOn="{DynamicResource ImageType}" /> 
```

这样做的正确方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T18:11:48.333

您必须在依赖样式中使用 StaticResource 引用。

尝试这个：

```
<Style TargetType="{x:Type my:AutoGreyableImage}" 
       BasedOn="{StaticResource ImageType}" /> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T18:02:15.983

这对我来说可以。

*AutoGreyableImage.cs*：

```
public class AutoGreyableImage : Image
{
    public static readonly DependencyProperty CustomProperty = DependencyProperty.Register("Custom",
        typeof(string),
        typeof(AutoGreyableImage));

    public string Custom
    {
        get { return GetValue(CustomProperty) as string; }
        set { SetValue(CustomProperty, value); }
    }
} 
```

*窗口.xaml*：

```
<Window.Resources>
    <Style TargetType="Image" x:Key="ImageStyle">
        <Setter Property="Stretch" Value="Uniform"/>
    </Style>

    <Style TargetType="{x:Type local:AutoGreyableImage}" BasedOn="{StaticResource ImageStyle}">
        <Setter Property="Custom" Value="Hello"/>
        <Setter Property="Width" Value="30"/>
    </Style>
</Window.Resources>
<Grid>
    <local:AutoGreyableImage Source="C:\Documents and Settings\All Users\Documents\My Pictures\Sample Pictures\Winter.jpg"/>
</Grid> 
```

# pdf-generation - PDF 文件中的元数据

> ID：757192
> 
> 赞同：3
> 
> 时间：2009-04-16T17:28:55.393
> 
> 标签：pdf-generation, tagged-pdf

我希望能够在 PDF 中存储一些特定于插件的数据，以便在重新加载 PDF 时可以将其读回，而用户不会看到此元数据。

如何将此元数据放入 PDF 文件中？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T19:11:02.043

PDF 支持 XMP 元数据。您应该将插件特定信息作为有效负载附加到 XMP 部分。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T18:24:04.433

根据您生成和阅读 PDF 的方式，您可以使用[pdftk](http://www.accesspdf.com/pdftk/)来编辑元数据。您可以通过使用 pdftk dump_data 将所有元数据写入文本文件，将新的键和值附加到文本文件，然后使用 pdftk update_info 将其添加为具有键和值的元数据属性，从而将不可见标签添加到 PDF放回所有元数据，包括新的键值对。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T17:57:54.870

最简单的方法是将信息作为文本附加到 pdf 文件的末尾。

# testing - Q/A、发布版本与调试版本和断言

> ID：757217
> 
> 赞同：3
> 
> 时间：2009-04-16T17:34:44.317
> 
> 标签：testing, qa

只是好奇：

当您向 Q/A 发布软件构建时，您更喜欢始终使用“RELEASE”版本，还是有时使用 DEBUG 版本？

这是我的难题：我们喜欢使用断言来捕获不应该发生的情况。

一方面，Q/A 在启用断言的情况下测试我们的软件可能很有用，这样如果他们可以创建一个触发断言的场景，他们就可以向我们报告。

另一方面，开发人员编写断言的方式总是存在改变代码行为的风险。在这种情况下，Q/A 应该在禁用断言的情况下测试构建。

迄今为止，我们一直在我们的 Relesae 版本上运行 Q/A，因为这是将要发布的代码。但是，我正在考虑尝试一种模式，让我们真正早期的 Q/A 版本在启用断言的情况下退出。然后，随着我们接近发货，我们将通知他们他们的构建已禁用断言。

你们有什么感想？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T17:39:57.333

我们将两者都发布给 Q/A，并且两者都完成了测试。如果您对自动化测试很感兴趣，那么这只是一个需要额外硬件来运行测试的问题。

发布版本必须经过测试，因为它们是实际客户使用的版本。调试版本包含额外的断言/验证/跟踪/等，它们在发现非显而易见的错误方面非常有用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T17:40:58.233

在早期开发阶段使用调试版本进行 QA 并在稍后切换到发布版本正是我们也在做的事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T17:45:19.050

我肯定会提倡让 QA 不仅审查发给客户的版本，而且还审查一些中间版本，可能每两周或每月一次。

这符合在开发过程中尽早检查您的产品的原则。如果你只是在发布版本时才这样做，那你就太晚了。

我会给他们调试版本，为这些早期测试启用断言。如果您在代码中有一个失败的断言，那么您就有一个错误。要么代码错误，要么断言错误。无论哪种方式，您都希望 QA 对此进行测试。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-17T19:22:02.010

我也是 Debug early/Release late; 我以前雇主的官方政策（有时违反，但不是我）是在 Beta 之前测试 Debug 版本，然后再测试 Release 版本。显然，在您发布之前偶尔运行 Debug 构建是值得的，但不幸的政治现实是，如果针对 Debug 构建报告了错误，许多程序管理人员将无法修复该错误。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T17:38:36.947

我们发布带有调试符号的发布版本，因此性能是正确的（广泛使用调试输出和断言可能会使事情变慢一点），但如果发生异常，它们仍然会报告有意义的堆栈跟踪。

对于异常，我们的一般规则是只捕获我们知道如何处理的异常，以便在没有想到的情况下它们会在 QA 中弹出。我们公司一般禁止包罗万象。

# c# - 带有 ASP.NET 按钮回发的 jQuery UI 对话框

> ID：757232
> 
> 赞同：298
> 
> 时间：2009-04-16T17:36:41.677
> 
> 标签：c#, asp.net, jquery, jquery-ui, postback

我有一个 jQuery UI 对话框在我的 ASP.NET 页面上运行良好：

```
jQuery(function() {
    jQuery("#dialog").dialog({
        draggable: true,
        resizable: true,
        show: 'Transfer',
        hide: 'Transfer',
        width: 320,
        autoOpen: false,
        minHeight: 10,
        minwidth: 10
    });
});

jQuery(document).ready(function() {
    jQuery("#button_id").click(function(e) {
        jQuery('#dialog').dialog('option', 'position', [e.pageX + 10, e.pageY + 10]);
        jQuery('#dialog').dialog('open');
    });
}); 
```

我的分区：

```
<div id="dialog" style="text-align: left;display: none;">
    <asp:Button ID="btnButton" runat="server" Text="Button" onclick="btnButton_Click" />
</div> 
```

但是 btnButton_Click 永远不会被调用......我该如何解决这个问题？

更多信息：我添加了此代码以将 div 移动到表单：

```
jQuery("#dialog").parent().appendTo(jQuery("form:first")); 
```

但是还是没有成功...

* * *

## 回答 #1

> 赞同：315
> 
> 时间：2009-04-20T13:05:11.750

您接近解决方案，只是得到了错误的对象。它应该是这样的：

```
jQuery(function() {
    var dlg = jQuery("#dialog").dialog({
                         draggable: true,
                         resizable: true,
                         show: 'Transfer',
                         hide: 'Transfer',
                         width: 320,
                         autoOpen: false,
                         minHeight: 10,
                         minwidth: 10
                     });
    dlg.parent().appendTo(jQuery("form:first"));
}); 
```

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2009-05-13T09:06:45.510

```
$('#divname').parent().appendTo($("form:first")); 
```

使用此代码解决了我的问题，它适用于所有浏览器、Internet Explorer 7、Firefox 3 和 Google Chrome。我开始喜欢 jQuery... 这是一个很酷的框架。

我也用部分渲染进行了测试，这正是我想要的。***伟大的！***

```
<script type="text/javascript">
    function openModalDiv(divname) {
        $('#' + divname).dialog({ autoOpen: false, bgiframe: true, modal: true });
        $('#' + divname).dialog('open');
        $('#' + divname).parent().appendTo($("form:first"));
    }

    function closeModalDiv(divname) {
        $('#' + divname).dialog('close');
    }
</script>
...
...
<input id="Button1" type="button" value="Open 1" onclick="javascript:openModalDiv('Div1');" />
...
...
<div id="Div1" title="Basic dialog" >
    <asp:UpdatePanel ID="UpdatePanel1" runat="server">
       <ContentTemplate>
          postback test<br />
          <asp:Button ID="but_OK" runat="server" Text="Send request" /><br />
          <asp:TextBox ID="tb_send" runat="server"></asp:TextBox><br />
          <asp:Label ID="lbl_result" runat="server" Text="prova" BackColor="#ff0000></asp:Label>
        </ContentTemplate>
    <asp:UpdatePanel>
    <input id="Button2" type="button" value="cancel" onclick="javascript:closeModalDiv('Div1');" />
</div> 
```

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2009-11-11T23:16:58.013

FWIW，形式：第一种技术对我不起作用。

但是，该博客文章中的技术确实：

[http://blog.roonga.com.au/2009/07/using-jquery-ui-dialog-with-aspnet-and.html](http://blog.roonga.com.au/2009/07/using-jquery-ui-dialog-with-aspnet-and.html)

具体来说，将其添加到对话框声明中：

```
 open: function(type,data) {
    $(this).parent().appendTo("form");
  } 
```

* * *

## 回答 #4

> 赞同：28
> 
> 时间：2013-05-11T11:01:23.433

请注意，jQuery UI v1.10 中有一个附加设置。添加了一个**[appendTo](http://api.jqueryui.com/dialog/#option-appendTo)**设置，以解决您用于将元素重新添加到表单的[ASP.NET解决方法。](http://en.wikipedia.org/wiki/ASP.NET)

尝试：

```
$("#dialog").dialog({
     autoOpen: false,
     height: 280,
     width: 440,
     modal: true,
     **appendTo**:"form"
}); 
```

* * *

## 回答 #5

> 赞同：25
> 
> 时间：2010-01-28T21:25:00.903

**[ken](https://stackoverflow.com/questions/757232/jquery-ui-dialog-with-asp-net-button-postback/1718775#1718775)**上面的回答对我有用。已接受答案的问题在于，它仅在页面上有单个模式时才有效。如果您有多个模式，则需要在初始化对话框时在“打开”参数中内联，而不是事后。

```
open: function(type,data) { $(this).parent().appendTo("form"); } 
```

如果您使用多个模式按照第一个接受的答案告诉您的操作，您只会得到页面上的最后一个模式，可以正常触发回发，而不是全部。

* * *

## 回答 #6

> 赞同：21
> 
> 时间：2009-04-16T17:49:29.587

主要是因为 jQuery 使用[DOM](http://en.wikipedia.org/wiki/Document_Object_Model)将对话框移动到表单标签之外。将其移回表单标签内，它应该可以正常工作。您可以通过检查 Firefox 中的元素来看到这一点。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2010-11-10T16:18:42.440

我不想为我的项目中的每个对话框都解决这个问题，所以我创建了一个简单的 jQuery 插件。此插件仅用于打开新对话框并将它们放置在[ASP.NET](http://en.wikipedia.org/wiki/ASP.NET)表单中：

```
(function($) {
    /**
     * This is a simple jQuery plugin that works with the jQuery UI
     * dialog. This plugin makes the jQuery UI dialog append to the
     * first form on the page (i.e. the asp.net form) so that
     * forms in the dialog will post back to the server.
     *
     * This plugin is merely used to open dialogs. Use the normal
     * $.fn.dialog() function to close dialogs programatically.
     */
    $.fn.aspdialog = function() {
        if (typeof $.fn.dialog !== "function")
            return;

        var dlg = {};

        if ( (arguments.length == 0)
                || (arguments[0] instanceof String) ) {
            // If we just want to open it without any options
            // we do it this way.
            dlg = this.dialog({ "autoOpen": false });
            dlg.parent().appendTo('form:first');
            dlg.dialog('open');
        }
        else {
            var options = arguments[0];
            options.autoOpen = false;
            options.bgiframe = true;

            dlg = this.dialog(options);
            dlg.parent().appendTo('form:first');
            dlg.dialog('open');
        }
    };
})(jQuery);</code></pre> 
```

因此，要使用该插件，您首先加载 jQuery UI，然后再加载该插件。然后您可以执行以下操作：

```
$('#myDialog1').aspdialog(); // Simple
$('#myDialog2').aspdialog('open'); // The same thing
$('#myDialog3').aspdialog({title: "My Dialog", width: 320, height: 240}); // With options! 
```

需要明确的是，此插件假定您已准备好在调用它时显示对话框。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2013-12-14T22:56:42.873

我知道这是一个老问题，但是对于任何有同样问题的人来说，有一个更新和更简单的解决方案：jQuery UI 1.10.0 中引入了一个“appendTo”选项

[http://api.jqueryui.com/dialog/#option-appendTo](http://api.jqueryui.com/dialog/#option-appendTo)

```
$("#dialog").dialog({
    appendTo: "form"
    ....
}); 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2010-05-18T13:12:57.427

极好的！这解决了我的 ASP:Button 事件没有在 jQuery 模态中触发的问题。请注意，使用带有以下内容的 jQuery UI 模式可以触发按钮事件：

```
// Dialog Link
$('#dialog_link').click(function () {
    $('#dialog').dialog('open');
    $('#dialog').parent().appendTo($("form:first"))
    return false;
}); 
```

以下行是使其正常工作的关键！

```
$('#dialog').parent().appendTo($("form:first")) 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2012-01-10T07:01:20.227

创建对话框后，我刚刚添加了以下行：

```
$(".ui-dialog").prependTo("form"); 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2013-01-15T18:07:02.910

这对我来说是最清晰的解决方案

```
var dlg2 = $('#dialog2').dialog({
        position: "center",
        autoOpen: false,
        width: 600,
        buttons: {
            "Ok": function() {
                $(this).dialog("close");
            },
            "Cancel": function() {
                $(this).dialog("close");
            }
        }
    });

dlg2.parent().appendTo('form:first');
$('#dialog_link2').click(function(){
    dlg2.dialog('open'); 
```

里面的所有内容`dlg2`都可以插入到您的数据库中。不要忘记更改`dialog`变量以匹配您的变量。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2013-05-08T20:29:24.923

使用 ASP.NET 只需`UseSubmitBehavior="false"`在 ASP.NET 按钮中使用：

```
<asp:Button ID="btnButton" runat="server"  Text="Button" onclick="btnButton_Click" UseSubmitBehavior="false" /> 
```

参考：*[Button.UseSubmitBehavior 属性](http://msdn.microsoft.com/library/system.web.ui.webcontrols.button.usesubmitbehavior%28v=vs.100%29.aspx)*

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-04-23T10:55:40.147

以正确的方式移动对话框，但您应该只在打开对话框的按钮中执行此操作。这是 jQuery UI 示例中的一些附加代码：

```
$('#create-user').click(function() {
    $("#dialog").parent().appendTo($("form:first"))
    $('#dialog').dialog('open');
}) 
```

`asp:button`在对话框中添加您的内容，它运行良好。

注意：您应该在单击“创建用户”按钮后将 <button> 更改为 <input type=button> 以防止回发。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-07-21T14:05:52.203

Robert MacLean 获得最高票数的解决方案是 99% 正确的。但是像我一样，有人可能需要的唯一补充是，每当您需要打开这个 jQuery 对话框时，不要忘记将其附加到父级。如下所示：

`var dlg = $('#questionPopup').dialog( 'open'); dlg.parent().appendTo($("form:first"));`

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2013-04-05T18:00:40.857

在使用 modal:true 选项时，使用此行来完成这项工作。

```
open: function (type, data) { 
    $('.ui-widget-overlay').appendTo("form"); $(this).parent().appendTo("form"); 
  }, 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2013-04-17T10:20:29.970

该`$('#dialog').parent().appendTo($("form:first"))`解决方案在 IE 9 中运行良好。但在 IE 8 中，它使对话框直接出现和消失。除非您发出一些警报，否则您看不到这一点，因此该对话框似乎永远不会出现。我花了一个上午的时间寻找一个适用于两个版本的解决方案，唯一适用于版本 8 和 9 的解决方案是：

```
$(".ui-dialog").prependTo("form"); 
```

希望这可以帮助其他遇到同样问题的人

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2013-04-17T10:28:04.940

确切的解决方案是；

```
$("#dialogDiv").dialog({ other options...,
    open: function (type, data) {
        $(this).parent().appendTo("form");
    }
}); 
```

# c++ - 我担心由于使用对象的方式，这段代码没有做我想做的事情

> ID：757234
> 
> 赞同：1
> 
> 时间：2009-04-16T17:36:56.043
> 
> 标签：c++, multithreading, shared-memory

我有以下代码，我想知道是否有人可以帮我看一下。

我有一个多线程应用程序，它们都共享一个对象并对其进行操作。我创建了一个指向它的某个元素的指针，这样我就不必每次都输入长路径，但我担心它可能只是修改共享对象的副本，而不是共享对象对象本身。

这是代码：

```
RPCThread* thr = &(args->s->_shared-_>rpcThread[args->threadIndex]);
...
thr->_in_use = true;
...
sema_post(&(thr->_sem_result)); 
```

这是有效的还是只是在修改副本？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T17:51:11.127

取决于成员_rpcThread 的类型。如果它只是 RPCThread[] 或 *RPCThread 那么我认为你没有问题。如果它是一个类类型，那么你需要知道它的 operator[] 的返回类型。如果相关定义返回的是值而不是引用，那么您可能有一个副本。

当然，除非 RPCThread 是一个使用信封字母习语或实现虚拟代理的类。

如果 _rpcThread 只是一个数组，那么您不应该在这里遇到您要询问的那种别名问题。

无需阅读更多代码即可进行检查，这是一件好事。你能改变这个：

```
 RPCThread* thr = &(args->s->_shared->_rpcThread[args->threadIndex]); 
```

对此：

```
 RPCThread* thr = args->s->_shared->_rpcThread + args->threadIndex; 
```

不会导致编译时错误？

# c# - 如何获得 DataGridViewCheckBoxColumn 来显示 DataRelation 状态？

> ID：757235
> 
> 赞同：0
> 
> 时间：2009-04-16T17:37:07.433
> 
> 标签：c#, winforms, datagridview, datarelation, datagridviewcheckboxcell

假设我有一个`DataGridView`（名为*dataGridView*）显示强类型`DataTable`（名为*ChildDataTable*）。

*dataGridView*有一个`DataGridViewCheckBoxColumn`（名为*parentIDColumn*）绑定到*ChildDataTable*中每个*ChildDataRow*上的字段属性*ParentID*。

 ***ParentID*是将*ChildDataTable*`DataTable`与`DataSet`（创造性地命名为*ParentDataTable*）中的另一个相关联的外键。在这种情况下，一个孩子可能只有一个父母。*ParentID*（和相关的*ParentDataTable.ID*）字段的类型为`Guid`。

*ChildDataTable.ParentID*允许空值。空值表示子级与任何父级“断开连接”，并且我希望它在*dataGridView*中显示为未选中`CheckBox`的列*parentIDColumn*（为澄清目的而标记为“有父级”）。

我尝试通过创建实现相等和比较操作的自定义类型来操作*parentIDColumn*`TrueValue`上的and`FalseValue`属性：

 *```
 public class NotDBNull : IComparable
    {
        public override bool Equals(object obj)
        {
            return !obj.Equals(DBNull.Value);
        }

        public override int GetHashCode()
        {
            return Guid.Empty.GetHashCode();
        }

        public int CompareTo(object obj)
        {
            return Equals(obj) ? 0 : 1;
        }
    }

    public class IsDBNull : IComparable
    {
        public override bool Equals(object obj)
        {
            return obj.Equals(DBNull.Value);
        }

        public override int GetHashCode()
        {
            return DBNull.Value.GetHashCode();
        }

        public int CompareTo(object obj)
        {
            return Equals(obj) ? 0 : 1;
        }
    } 
```

...然后将它们设置为*parentIDColumn*上的 True/False 值：

```
 parentIDColumn.TrueValue = new NotDBNull();
        parentIDColumn.FalseValue = new IsDBNull(); 
```

但是调试器从来没有命中我的断点，这表明我错过了这条船。*显示dataGridView*时出现以下错误：

```
---------------------------
DataGridView Default Error Dialog
---------------------------
The following exception occurred in the DataGridView:

System.FormatException: Value '39df7d96-941a-4be9-a883-03182363bbab' cannot be converted to type 'Boolean'.
   at System.Windows.Forms.Formatter.FormatObjectInternal(Object value, Type targetType, TypeConverter sourceConverter, TypeConverter targetConverter, String formatString, IFormatProvider formatInfo, Object formattedNullValue)
   at System.Windows.Forms.Formatter.FormatObject(Object value, Type targetType, TypeConverter sourceConverter, TypeConverter targetConverter, String formatString, IFormatProvider formatInfo, Object formattedNullValue, Object dataSourceNullValue)
   at System.Windows.Forms.DataGridViewCell.GetFormattedValue(Object value, Int32 rowIndex, DataGridViewCellStyle& cellStyle, TypeConverter valueTypeConverter, TypeConverter formattedValueTypeConverter, DataGridViewDataErrorContexts context)

To replace this default dialog please handle the DataError event.
---------------------------
OK   
--------------------------- 
```

所以我知道我的定制没有达到。格式调用似乎发生在单元格级别（而不是列），所以我不确定是否有更好/不同的方式我错过了。

**我如何为复选框列注入我的 True/False 逻辑，以便选中表示外键不为空，未选中表示它是？**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T20:39:19.337

花了一点时间，但我现在有一个可行的解决方案。

*我向ChildDataTable*添加了一个新的计算列（名为*HasParent*），它使用表达式“ParentID IS NOT NULL”并且是布尔类型。一旦绑定到*parentIDColumn*，它就完美地工作了。

 **# browser - 即使在首页重新加载时如何保持 iframe 位置

> ID：757240
> 
> 赞同：1
> 
> 时间：2009-04-16T17:38:47.163
> 
> 标签：browser, iframe

我正在使用 iframe 来集成我们客户的两个应用程序。即使刷新顶级窗口，我也希望 iframe 的位置保持不变。

例子：

*   用户在他的浏览器中加载[http://myserver/main.page?target=](http://myserver/main.page?target=) "sub.page"
*   我的 Javascript 代码将 iframe 的来源设置为“sub.page”
*   用户单击 iframe 中的链接**，** iframe 的源变为“othersub.page”
*   用户单击 iframe 之外的顶级窗口中的链接，该链接链接到[http://myserver/main.page](http://myserver/main.page)
*   Javascript 以某种方式自动将 iframe 的源更新回“othersub.page”

我可以锻炼执行 iframe 更新操作和传递变量所需的所有逻辑。我的问题是如何跟踪 iframe 的 src 值。

我需要一种方法来检测 iframe 的 src 是否已更改。我唯一能想到的就是“轮询”价值。我很想知道是否有人有更好的主意。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T17:46:09.750

您还可以向此框架添加“加载”事件处理程序。每次发生此事件时，您都会将框架文档的位置存储在 cookie 中。

IIRC，当 iframe 的内容发生变化时，SRC 属性不会改变。IMO，您必须阅读文件的位置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-01T19:53:29.767

load 事件将告诉您何时在 iframe 中加载了新页面，但正如您所说，您将无权读取 src 属性。

如果 iframe 的内容可以加载另一个 iframe，该 iframe 从与根页面相同的域加载页面，则此内部页面可以在根页面上调用 javascript（因为它们位于同一域上），并传递类似你想要的 src 字符串。[例子](http://mcknut.googlepages.com/iframetest.html)

# c++ - 在 C++ 中应该按什么顺序声明类？

> ID：757241
> 
> 赞同：4
> 
> 时间：2009-04-16T17:39:32.823
> 
> 标签：c++, class

假设我得到了这个 C++ 代码：

```
class class1{
    class2 *x;
}

class class2{
    class1 *x;
} 
```

编译器会在第 2 行给出错误，因为它找不到 class2，如果我切换了类的顺序，也是一样。我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-16T17:42:36.313

两件事 - 一，你需要在类声明后使用分号：

```
class class1{
    class2 *x;
};

class class2{
    class1 *x;
}; 
```

二，你可以在类的定义前面创建一个声明。这告诉编译器这个类存在，你还没有定义它。在这种情况下，`class2`在 的定义前放置一个声明`class1`：

```
class class2 ;

class class1{
    class2 *x;
};

class class2{
    class1 *x;
}; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T17:44:53.107

参考[转发声明](http://www.learncpp.com/cpp-tutorial/17-forward-declarations/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T17:40:35.600

先声明class2：

```
class class2;
class class1{
    class2 *x;
};

class class2{
    class1 *x;
}; 
```

# python - 将树列表转换为层次结构字典

> ID：757244
> 
> 赞同：8
> 
> 时间：2009-04-16T17:40:18.750
> 
> 标签：python, tree, hierarchical-trees

我有一个带有属性的元素列表：父级、级别、is_leaf_node、is_root_node、is_child_node。

我想将此列表转换为层次结构字典。输出字典示例：

```
{
        'Technology':
            {
             'Gadgets':{},
             'Gaming':{},
             'Programming':
                {
                    'Python':{},
                    'PHP':{},
                    'Ruby':{},
                    'C++':{}
                },
             'Enterprise':{},
             'Mac':{},
             'Mobile':{},
             'Seo':{},
             'Ui':{},
             'Virtual Worlds':{},
             'Windows':{},
            },
        'News':{
            'Blogging':{},
            'Economics':{},
            'Journalism':{},
            'Politics':{},
            'News':{}
            },} 
```

我不懂算法。怎么做？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-16T19:02:37.057

这是一个不太复杂的递归版本，如所描述的 chmod 700。当然完全未经测试：

```
def build_tree(nodes):
    # create empty tree to fill
    tree = {}

    # fill in tree starting with roots (those with no parent)
    build_tree_recursive(tree, None, nodes)

    return tree

def build_tree_recursive(tree, parent, nodes):
    # find children
    children  = [n for n in nodes if n.parent == parent]

    # build a subtree for each child
    for child in children:
        # start new subtree
        tree[child.name] = {}

        # call recursively to build a subtree for current node
        build_tree_recursive(tree[child.name], child, nodes) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T18:13:53.040

没有父母的一切都是你的最高水平，所以首先制作这些听写。然后通过您的数组进行第二次遍历，以查找在该顶层具有父级的所有内容，等等......它可以写成循环或递归函数。除了“父母”之外，您真的不需要任何提供的信息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T18:42:00.333

听起来您基本上想要做的是[拓扑排序](http://en.wikipedia.org/wiki/Topological_sorting)的变体。最常见的算法是源去除算法。伪代码看起来像这样：

```
import copy
def TopSort(elems): #elems is an unsorted list of elements.
    unsorted = set(elems)
    output_dict = {}
    for item in elems:
        if item.is_root():
            output_dict[item.name] = {}
            unsorted.remove(item)
            FindChildren(unsorted, item.name, output_dict[item.name])
    return output_dict

def FindChildren(unsorted, name, curr_dict):
    for item in unsorted:
        if item.parent == name:
            curr_dict[item.name] = {}
            #NOTE:  the next line won't work in Python.  You
            #can't modify a set while iterating over it.
            unsorted.remove(item)
            FindChildren(unsorted, item.name, curr_dict[item.name]) 
```

这显然在几个地方被破坏了（至少作为实际的 Python 代码）。但是，*希望*这能让您了解算法的工作原理。请注意，如果您拥有的项目中有一个循环，这将非常失败（比如项目 a 将项目 b 作为父项，而项目 b 将项目 a 作为父项）。但是，无论如何，这可能无法以您想要的格式表示。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T01:05:37.637

像这样简单的事情可能会起作用：

```
def build_tree(category_data):
  top_level_map = {}
  cat_map = {}
  for cat_name, parent, depth in cat_data:
    cat_map.setdefault(parent, {})
    cat_map.setdefault(cat_name, {})
    cat_map[parent][cat_name] = cat_map[cat_name]
    if depth == 0:
      top_level_map[cat_name] = cat_map[cat_name]

  return top_level_map 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-05-04T12:33:11.193

一个很好的递归方式：

```
def build_tree(elems):
  elem_with_children = {}

  def _build_children_sub_tree(parent):
      cur_dict = {
          'id': parent,
          # put whatever attributes here
      }  
      if parent in elem_with_children.keys():
          cur_dict["children"] = [_build_children_sub_tree(cid) for cid in elem_with_children[parent]]
      return cur_dict

  for item in elems:
      cid = item['id']
      pid = item['parent']
      elem_with_children.setdefault(pid, []).append(cid)

  res = _build_children_sub_tree(-1) # -1 is your root
  return res 
```

# c# - 在 ASP.NET 中从数据库中获取一行数据的最有效方法

> ID：757246
> 
> 赞同：5
> 
> 时间：2009-04-16T17:40:57.237
> 
> 标签：c#, asp.net, optimization, data-access

我正在编写一种从数据库返回“资产”行的方法。它包含字符串、整数和字节数组（这可能是图像/电影/文档）。

现在对于大多数行访问，我使用以下方法，它返回一个 NameValueCollection，因为它是一个轻量级对象，易于使用并转换为 int 和字符串。

```
 public static NameValueCollection ReturnNameValueCollection(Database db, DbCommand dbCommand)
    {

        var nvc = new NameValueCollection();

        using (IDataReader dr = db.ExecuteReader(dbCommand))
        {
            if (dr != null)
            {
                 while (dr.Read())
                 {
                     for (int count = 0; count < dr.FieldCount; count++)
                     {
                         nvc[dr.GetName(count)] = dr.GetValue(count).ToString();
                     }
                 }
            }
        }

        dbCommand.Dispose();
        return nvc.Count != 0 ? nvc : null;
    } 
```

现在我对这种数据访问的方法通常是获取返回数据行的方法。

```
 public static DataRow ReturnDataRow(Database db, DbCommand dbCommand)
    {
        var dt = new DataTable();

        using (IDataReader dr = db.ExecuteReader(dbCommand))
            if (dr != null) dt.Load(dr);

        dbCommand.Dispose();
        return dt.Rows.Count != 0 ? dt.Rows[0] : null;
    } 
```

创建一个 DataTable 然后返回它的第一个数据行似乎有点浪费。

有没有更好的方法来做到这一点？

我在想可能是一个对象字典，然后我手动转换每个成员。

看看其他人如何解决这个问题会很有趣。我知道这有点属于微优化领域，只要我不为每个行查询返回数据集（希望我每次在一行代码中看到它都有一磅）它应该没问题。

也就是说，可能会调用此方法来分配一个盒子上的站点上的数据访问查询。

干杯

史蒂夫

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-16T18:16:58.490

怎么样了？

您没有代表数据库中一行的对象容器是否有原因？在解决方案的其他层中创建自定义对象要容易得多。因此，采用这种方法，您的问题有两种非常可行的解决方案。

假设您有一个代表数据库中产品的自定义对象。您将像这样定义对象：

```
public class Product {
    public int ProductID { get; set; }
    public string Name { get; set; }
    public byte[] Image { get; set; }
} 
```

你会像这样填写一组产品（集合）：

```
var collection = new Collection<Product>();

using (var reader = command.ExecuteReader()) {
    while (reader.Read()) {
        var product = new Product();

        int ordinal = reader.GetOrdinal("ProductID");
        if (!reader.IsDBNull(ordinal) {
            product.ProductID = reader.GetInt32(ordinal);
        }

        ordinal = reader.GetOrdinal("Name");
        if (!reader.IsDBNull(ordinal)) {
            product.Name = reader.GetString(ordinal);
        }

        ordinal = reader.GetOrdinal("Image");
        if (!reader.IsDBNull(ordinal)) {
            var sqlBytes = reader.GetSqlBytes(ordinal);
            product.Image = sqlBytes.Value;
        }

        collection.Add(product);
    }
} 
```

请注意，我正在通过读者的 Get *x*检索一个值，其中*x*是我要从列中检索的类型。这是 Microsoft 推荐的按[http://msdn.microsoft.com/en-us/library/haa3afyz.aspx](http://msdn.microsoft.com/en-us/library/haa3afyz.aspx)（第二段）检索列数据的方法，因为检索到的值不必装箱到 System.Object并拆箱成原始类型。

由于您提到此方法将在 ASP.NET 应用程序中被调用很多次，您可能需要重新考虑这样的通用方法。您用来返回*NameValueCollection*的方法在这种情况下（并且可以说在许多其他情况下）表现不佳。更不用说在不考虑当前用户的文化的情况下将每个数据库列转换为字符串，而文化是 ASP.NET 应用程序中的一个重要考虑因素。我认为这个*NameValueCollection*也不应该用于您的其他开发工作。我可以继续说下去，但我会为你省去我的咆哮。

当然，如果您要创建直接映射到表的对象，您不妨研究一下[LINQ to SQL](http://msdn.microsoft.com/en-us/library/bb386976.aspx)或[ADO.NET Entity Framework](http://msdn.microsoft.com/en-us/data/aa937723.aspx)。你会很高兴你做到了。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T17:56:58.850

就代码效率而言，您可能用最少的按键完成了它，虽然这看起来很浪费，但可能是最容易维护的。但是，如果您只关心只做严格必要的事情的效率，您可以创建一个轻量级的结构/类来填充数据并使用类似于：

```
public class MyAsset
{
    public int ID;
    public string Name;
    public string Description;
}

public MyAsset GetAsset(IDBConnection con, Int AssetId)
{
    using (var cmd = con.CreateCommand("sp_GetAsset"))
    {
        cmd.CommandType = CommandType.StoredProcedure;
        cmd.Parameters.Add(cmd.CreateParameter("AssetID"));
        using(IDataReader dr = cmd.ExecuteReader())
        {
            if (!dr.Read()) return null;

            return new MyAsset() { 
                ID = dr.GetInt32(0), 
                Name = dr.GetString(1), 
                Description = dr.GetString(2)
            };
        }
    }
} 
```

同样，您可以以类似的方式将数据转储到您的 KVP 集合中......

它不像您的原始代码那样干净，但它不会创建整个表只是为了获得单行......

正如在另一篇关于代码气味的帖子中提到的那样，我可能不会将命令作为参数传递，我认为我更有可能将命令封装在此方法中，仅传递数据库连接和 id我想要的资产——假设我当然没有使用缓存，并传回 MyAsset 实例。这使得该方法足够通用，可以在任何数据库类型上使用 - 当然假设存储过程存在。这样，我的其余代码就不需要知道数据库的任何类型，除了它是什么类型的数据库......在我的应用程序的其余部分，我可以使用 MyAssetInstance.ID、MyAssetInstance.Name、 MyAssetInstance.Description 等...

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T17:55:57.730

您要演示的是一种称为[Primitive Obsession](http://jamesshore.com/Blog/PrimitiveObsession.html)的代码气味。创建一个自定义类型并从您的存储库方法中返回它。不要试图过于通用......您最终只会将这种复杂性推入您的业务代码，因为您将使用纯程序代码与您的实体进行交互。更好地创建对您的业务建模的对象。

如果您担心数据访问代码过多，请考虑使用 ORM 框架来为您生成此代码。您不应该让这种担忧决定应用程序层中的不良设计。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T23:00:00.403

感谢所有输入的家伙。我知道 ORM 可能是要走的路，而 MVC 框架在我的列表中是下一个。

更详细地说，我展示的代码来自数据访问层中的帮助程序部分，然后将行或名称值集合传递给业务层以转换为对象。

我认为 mnero0429 和 balabaster 代码示例给了我正确的方向。使用数据读取器并像这样手动获取数据，而不会弄乱中间对象。感谢您提供详细的 MS 链接 mnero0429。对原始的痴迷很公平-尽管我确实在业务层中从中做出了适当的资产类别；）

我也将研究 ADO 实体框架。

再次感谢您的建议-我知道即使我使用 DataSet.Tables[0].Rows[0]["bob"] 或类似的东西，世界也会继续转动，但是当您感到痒时-最好的方法是什么做吧，它很高兴有它的划痕！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T18:01:36.627

与尝试优化返回单行相比，您将从缓存数据中获得更多好处。如果您通过主键进行选择，那么您不太可能会看到返回 DataTable 或 DataRow 或自定义对象之间的任何区别。这让我觉得过早的优化。我会更确定，但我不确定混合中的字节数组是否会改变事情。

# msdn - 状态和通知代理 API 在 Windows CE 6.0 中是否可用

> ID：757250
> 
> 赞同：0
> 
> 时间：2009-04-16T17:41:10.560
> 
> 标签：msdn, windows-ce

MSDN[文档](http://msdn.microsoft.com/en-us/library/bb154480.aspx)表明此 API 不限于 Windows Mobile，而是在 CE 6.0 中可用。文档说我应该链接到aygshell.lib，但是这个lib 文件不包含正确的方法。

搜索 WINCE600 树会找到对 k.coredll.dll 的引用，但这应该可以从用户模式应用程序访问。是否有一些组件（除了 AYGShell API 本身）必须包含在操作系统中才能访问此 API？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-27T12:51:13.333

这需要设置 SYSGEN_STATE_NOTIFICATIONS=1。

# vba - 使用 MS Word 宏搜索文本文件

> ID：757255
> 
> 赞同：1
> 
> 时间：2009-04-16T17:42:43.067
> 
> 标签：vba, ms-word

感谢您对我[上一个问题](https://stackoverflow.com/questions/756990/using-vba-to-parse-text-in-an-ms-word-document)的帮助。有了这个建议，我能够从 Word 文档中读取文本行。然后我能够继续解析该行以提取文件名。

我现在正在尝试使用该文件名启动文件搜索。有人对如何使用 MS Word 宏启动文本文件搜索有任何建议吗？我需要找到该文件，打开它，然后在文本文件中搜索。

任何帮助将不胜感激。谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T17:58:13.920

要搜索，请使用 Application.FileSearch：

[文件搜索对象](http://msdn.microsoft.com/en-us/library/aa190819(office.10).aspx)

阅读，使用[FileSystemObject](http://msdn.microsoft.com/en-us/library/d6dw7aeh(v=VS.84).aspx)

从那里搜索应该是简单的 InStr 问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T17:56:27.650

如果您从 Word 中执行此操作，最简单的方法是在 Word 中打开文本文件并使用 Word 的搜索功能。这样您就不需要实现自己的搜索功能。

只需记录此操作的宏：在 Word 中打开一个文本文件并搜索特定字符串 (Ctrl-F)。结果如下所示：

```
Sub Macro1()

    Documents.Open FileName:="YourFile.txt", ConfirmConversions:=False, _
        ReadOnly:=False, AddToRecentFiles:=False, PasswordDocument:="", _
        PasswordTemplate:="", Revert:=False, WritePasswordDocument:="", _
        WritePasswordTemplate:="", Format:=wdOpenFormatAuto, XMLTransform:="", _
        Encoding:=1252

    Selection.Find.ClearFormatting

    With Selection.Find
        .Text = "YourSearchText"
        .Replacement.Text = ""
        .Forward = True
        .Wrap = wdFindContinue
        .Format = False
        .MatchCase = False
        .MatchWholeWord = False
        .MatchWildcards = False
        .MatchSoundsLike = False
        .MatchAllWordForms = False
    End With

    Selection.Find.Execute

    If Not Find Is Nothing Then
        ' your action here '
    End If
End Sub 
```

然后，您可以编辑录制的宏以满足您的需要。

**编辑：**我看到我部分误解了你的问题。我的回答只涉及如何在文本文件中搜索特定字符串，而不是如何在文件系统中搜索文件列表。

# pdf - PDF 的 BitsPerComponent 如何转换为图像的每像素位数？

> ID：757265
> 
> 赞同：2
> 
> 时间：2009-04-16T17:44:41.347
> 
> 标签：pdf, image-conversion, bits-per-pixel

我的目标是将 PDF 转换为图像（特别是在 TIFF 中）。

有一个名为[BitsPerComponent的 PDF 属性](http://www.abcupload.com/helppdf7net/source/6-abcpdf6.objects/pixmap/2-properties/bitspercomponent.htm)

并且根据页面上的描述，

> 此属性可以取值 1、2、4、8 或 16。PDF 规范不支持其他值

这是否意味着**1、2、4、8 或 16**转换为图像中每像素的位数？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T17:48:57.793

听起来更像是每个颜色分量的位数，其中颜色分量是 (Alpha)/Red/Green/Blue 或 Grey 之一。因此，取每个分量的位数并乘以每个像素的分量，得到每个像素的位数。例如，如果您正在谈论一个 RGB 图像，那么您有 3 个组件。每个组件 8 位的 RGB 将是 8 * 3 = 24 位/像素图像。如果它是灰度的，例如一个组件，则每个组件 8 位将是每个像素 8 位。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T17:49:04.190

BitsPerPixel = 3 * 如果颜色存储为 RGB，则为 BitsPerComponent

BitsPerPixel = 4 * BitsPerComponent 如果颜色存储为带有 Alpha 通道 (ARGB) 的 RGB

RGB 是一个随机假设……这适用于使用 3 个分量的每个颜色模型，并且可能是 alpha 通道。如果它是灰度图像，它将是 BitsPerPixel = BitsPerComponent。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T17:49:11.273

不，它转换为每个颜色通道的位数。当您有灰度图像时，这基本上也是每像素位数。

当你有一个每通道 16 位的 RGB 图像时，每个像素总共有 48 位（如果你也有 alpha 通道，甚至是 64 位）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T07:22:29.023

已经有很多工具可以将 PDF 转换为图像。如果你想自己写，你将不得不学习一个巨大的规范并构建一个光栅化器。为什么需要构建自定义解决方案？

# c++ - 使功能模板专业化虚拟合法吗？

> ID：757270
> 
> 赞同：15
> 
> 时间：2009-04-16T17:45:13.810
> 
> 标签：c++, templates, virtual, specialization, c1001

在 C++ 中，函数模板特化应该与普通函数完全一样。这是否意味着我可以制作一个虚拟的？

例如：

```
struct A
{
    template <class T> void f();
    template <> virtual void f<int>() {}
};

struct B : A
{
    template <class T> void f();
    template <> virtual void f<int>() {}
};

int main(int argc, char* argv[])
{
    B b;
    A& a = b;
    a.f<int>();
} 
```

[Visual Studio 2005](http://en.wikipedia.org/wiki/Microsoft_Visual_Studio#Visual_Studio_2005)给我以下错误：

> 致命错误 C1001：编译器发生内部错误。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-04-16T18:13:37.110

不错的编译器错误。对于这种类型的检查，我总是在回到标准和检查之前回退到[Comeau编译器。](http://www.comeaucomputing.com/tryitout)

> 用于 ONLINE_EVALUATION_BETA2 的 Comeau C/C++ 4.3.10.1（2008 年 10 月 6 日 11:28:09） 版权所有 1988-2008 Comeau Computing。版权所有。模式：严格错误 C++ C++0x_extensions
> 
> “ComeauTest.c”，第 3 行：错误：在函数模板声明模板中不允许使用“virtual” virtual void f(); ^
> 
> “ComeauTest.c”，第 10 行：错误：函数模板声明模板中不允许使用“virtual” virtual void f(); ^

现在，正如另一个用户发布的那样，事实是该标准不允许您定义虚拟模板化方法。基本原理是对于所有虚拟方法，必须在 vtable 中保留一个条目。问题是模板方法只有在它们被实例化（使用）时才会被定义。这意味着 vtable 最终将在每个编译单元中具有不同数量的元素，具体取决于对*f()*的不同类型的不同调用的次数。然后地狱就会升起...

如果您想要的是其参数之一上的模板化函数并且一个特定版本是虚拟的（请注意参数的一部分），您可以这样做：

```
class Base
{
public:
   template <typename T> void f( T a ) {}
   virtual void f( int a ) { std::cout << "base" << std::endl; }
};
class Derived : public Base
{
public:
   virtual void f( int a ) { std::cout << "derived" << std::endl; }
};
int main()
{
   Derived d;
   Base& b = d;
   b.f( 5 ); // The compiler will prefer the non-templated method and print "derived"
} 
```

如果您希望将其概括为任何类型，那么您就不走运了。考虑另一种类型的委托而不是多态（聚合+委托可能是一种解决方案）。有关手头问题的更多信息将有助于确定解决方案。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T18:08:47.653

根据[http://www.kuzbass.ru:8086/docs/isocpp/template.html](http://www.kuzbass.ru:8086/docs/isocpp/template.html) ISO/IEC 14882:1998：

> -3- 成员函数模板不应是虚拟的。

例子：

```
template <class T> struct AA {
    template <class C> virtual void g(C);   //  Error
    virtual void f();                       //  OK
}; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-11-27T11:01:13.347

正如其他人所指出的，这不是合法代码，因为不能声明成员函数模板`virtual`。

然而，即使是 Visual Studio 2012 也对此感到窒息： ![Visual Studio 2012 上的 C++ 内部编译器错误](https://i.stack.imgur.com/WeWg2.png) [*单击此处查看完整尺寸*](https://i.stack.imgur.com/WeWg2.png)

事件日志表明编译器在`0xC0000005`或上崩溃`STATUS_ACCESS_VIOLATION`。有趣的是，某个（非法）代码构造如何使编译器出现段错误......

# internet-explorer - 获取特定版本的 IE

> ID：757274
> 
> 赞同：4
> 
> 时间：2009-04-16T17:46:27.783
> 
> 标签：internet-explorer, testing, cross-browser

任何人都知道获得特定版本 IE 的方法吗？

具体来说，我正在做浏览器兼容性，最初是为 IE 6.0.3790.3959（我们的大多数用户都有）开发的。我们的一些拥有 IE 6.0.2900.xpsp_sp3_gdr.080814-1236 的员工在使用我们的一些自定义 Javascript 动画效果时遇到问题。我可以找到比较 IE 6、7、8 等的工具，但无处获得特定的构建......有什么想法吗？

编辑：是的，主页上用于图像幻灯片的 JS 代码，这是我们新设计的核心。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T17:55:33.690

[Internet Explorer 集合](http://finalbuilds.edskes.net/iecollection.htm)具有IE 6.0.2800 和 6.0.2900。除此之外，你的运气不好。

此外，multipleIE 和 Internet Explorer 集合不会在 Vista 上运行 IE 5.5 或 6。（IE < 5.5 可以正常工作）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T17:56:46.527

不幸的是，我不相信浏览器在传输 userAgent 标头时会提供它们的构建版本。你能得到的最多是 MSIE/FF/Opera xx

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T17:53:33.103

在[浏览器存档](http://browsers.evolt.org/)中询问可能是您最好的线索。他们没有特定的 IE 版本可供下载，但确实有 IE 和服务包的所有主要版本，因此可能是指导您获得特定版本的最佳人选。

那里还有很多其他有趣的浏览器:-)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T17:59:02.683

根据[这篇 kb 文章](http://support.microsoft.com/kb/969393/)，IE 6.0.3790.3959 是适用于 Windows Server 2003 SP1 和 Windows XP x64 的 Internet Explorer 6 SP2，而 IE 6.0.2900 是适用于 Windows XP 32 位（SP2 或 SP3，我猜你的用户有 SP3）的 IE6从字符串的其余部分）所以它不仅仅是构建，它是它运行的操作系统。如果您在 XP 32 位机器上安装 IE6 并更新到 SP3，您应该有合理的机会以 IE 6.0.2900 版本结束（当然，除了痛苦的世界之外，IE 没有什么是确定的......）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-26T01:41:22.740

如果您已经想要这个，这里是最好的站点，在这里您可以找到 Internet Explorer 自第一个版本以来的所有版本：[http ://www.oldversion.com/Internet-Explorer.html](http://www.oldversion.com/Internet-Explorer.html)

我希望我能帮助你。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T17:52:53.573

这是我能找到的最好的。

[http://www.microsoft.com/windows/ie/ie6/downloads/default.mspx](http://www.microsoft.com/windows/ie/ie6/downloads/default.mspx)

# c# - LINQ to SQL 列有关键字作为列名，如何引用/转义

> ID：757279
> 
> 赞同：6
> 
> 时间：2009-04-16T17:48:06.750
> 
> 标签：c#, linq, syntax, escaping

在 LINQ to SQL 语句中，我在数据库中有一个列名，它也是一个 C# 关键字 (void)。如何让编译器将其视为对象属性而不是关键字？

当然，我可以用方法符号重新编写它，但必须有一种方法可以在这里给编译器一个提示......

```
var p = from c in mytable
        where c.id = rowNumber
        select ( new { voidedState = c.void } );  // <--- Problem is here 
```

错误是：

```
Identifier expected; 'void' is a keyword 
```

我无法反驳，我只是在寻找解决方法。

谢谢。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-16T17:51:36.103

在标识符前加上“@”：

```
@void 
```

是标识符“void”的名称，而不是关键字（这适用于需要标识符的任何地方）。

# delphi - 如何创建一个类的新实例？

> ID：757280
> 
> 赞同：1
> 
> 时间：2009-04-16T17:48:07.313
> 
> 标签：delphi, delphi-2009, rtti

我有各种类实例的列表。我需要能够在不知道要创建什么的情况下创建一个类的新实例。所有涉及的对象都具有相同的祖先。对象成员变量的实际复制很容易......这是我遇到问题的新对象的创建。

诚然，我可以做这样的事情：

```
case MyObjectTypeInstance.MyTypeEnum of
  obj1:
    Result:=TObjectType1.Create;

  obj2:
    Result:=TObjectType2.Create;

  obj3:
    Result:=TObjectType3.Create;
end; 
```

这不符合“开放/封闭原则”。

最初我以为我可以做类似“Result:=MyObjectTypeInstance.Create;”的事情 但是由于析构函数的困难，这并没有像希望的那样工作。

这是我应该怎么做的最新猜测......

```
var
  fooA, fooB:TFoo;
begin
  fooA:=TFoo2.Create;    // it could be any of many types

  fooB:=?  // how to create fooB of same class type as fooA????

  // do something

  fooA.Free;
  fooB.Free;
end; 
```

我会认为这会更容易！

感谢您的帮助！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-16T17:57:27.977

如果所有类都有一个共同的祖先，你可以这样做：

```
type
  TAncestor = class;
  TAncestorClass = class of TAncestor;
  TAncestor = class 
  public
    constructor Create; virtual;

    class function CreateClass(const AId: string): TAncestor;
    class procedure RegisterClass(const AId: string; const AType: TAncestorClass);
  end;

class function TAncestor.CreateClass(const AId: string): TAncestor;
var
  atype : TAncestorClass;
begin
  atype := GetAncestorClass(AId);
  if atype<>nil then
    Result := atype.Create
  else
    Result := nil;
end;

class procedure TAncestor.RegisterClass(const AId: string; 
  const AType: TAncestorClass);
begin
  SetAncestorClass(AId, AType); // Link id to class type
end; 
```

您可以使用任何类型的标识进行类型注册。只要它们是独一无二的。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-16T17:56:55.140

选项 1 - 创建名称/类映射列表：[有没有办法在 delphi 中通过其名称实例化一个类？](https://stackoverflow.com/questions/701049/is-there-a-way-to-instantiate-a-class-by-its-name-in-delphi)

选项 2 - 使用“类”变量。

```
type
  TBaseObj = class
  end;

  TObjA = class(TBaseObj)
  end;

  TBaseObjClass = class of TBaseObj;

var
  objCls: TBaseObjClass;
  obj: TBaseObj;

objCls := TObjA;
obj := objCls.Create;
//obj is of type TObjA 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-16T19:29:58.677

您可能想要创建一个抽象工厂或工厂方法类。这些是经过测试的、经过验证的开发范例的常见[设计模式。](http://en.wikipedia.org/wiki/Design_pattern_(computer_science))

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-16T19:57:43.647

谢谢大家的答案！

dar7yl 的解决方案非常适合我的需求。

```
type
  TFoo = class
  private
    { private declarations }
  public
    { public declarations }
    class function MakeAnother:TFoo;
  end;

  TFoo1 = class(TFoo)
  private
    { private declarations }
  public
    { public declarations }
  end;

  TFoo2 = class(TFoo)
  private
    { private declarations }
  public
    { public declarations }
  end;

var
  fooA, fooB:TFoo;
begin
  fooA:=TFoo2.Create;
  foob:=fooA.MakeAnother;

  // do something here

  fooA.Free;
  fooB.Free;
end;

{ TFoo }

class function TFoo.MakeAnother: TFoo;
begin
  Result:=Create;
end; 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-17T01:53:06.057

另一个更混乱的版本是使用“类型类”和 TObject.ClassType

```
type
 TFoo = class
  private
    { private declarations }
  public
    { public declarations }
    constructor Create(WhatEver : Integer);virtual;// just to show need for params
  end;

  TFooClass = class of TFoo;

  TFoo1 = class(TFoo)
  private
    { private declarations }
  public
    { public declarations }
    constructor Create(WhatEver : Integer);override;// just to show need for params
  end;

  TFoo2 = class(TFoo)
  private
    { private declarations }
  public
    { public declarations }
  end;

{$R *.dfm}

procedure TForm10.Button1Click(Sender: TObject);
var
  fooA, fooB:TFoo;

begin
  fooA:=TFoo2.Create(0);
  fooB:= TFooClass(FooA.ClassType).Create(1);

  // do something here

  fooA.Free;
  fooB.Free;

end;

{ TFoo }

constructor TFoo.Create(WhatEver: Integer);
begin
  ShowMessageFmt('%s %d', [Self.ClassName, WhatEver]);
end;

{ TFoo1 }

constructor TFoo1.Create(WhatEver: Integer);
begin
  inherited;

end; 
```

# visual-studio-2008 - Visual Studio 中的 DataSetVisualizer 和远程调试

> ID：757287
> 
> 赞同：4
> 
> 时间：2009-04-16T17:50:02.800
> 
> 标签：visual-studio-2008, visual-studio-2005, debuggervisualizer

我们使用 Lab Manager 在多个平台上进行测试，并通过在 Lab Manager 中的本地 dev box 和 VM 上创建具有相同名称和密码的 Windows 帐户来进行远程调试（导致 VS 调试器认为正在使用相同的帐户）在两个盒子上，因此它允许在开发盒子上看到调试服务器）。然后我们在debug账号下运行VS，就可以远程调试了。

除了尝试运行 DataSetVisualizer 会导致以下异常之外，这一切都很好：

> Microsoft.VisualStudio.DebuggerVisualizers.DebugViewerShim.RemoteObjectSourceException：无法加载文件或程序集'file:///D:\apps\Microsoft Visual Studio 8\Common7\Packages\Debugger\Visualizers\Microsoft.VisualStudio.Debugger.DataSetVisualizer.dll'或其依赖项之一。

dll位于指定文件夹中，并且该文件夹允许管理员完全控制（调试帐户是其中的成员）。该文件夹中没有其他 dll。

我还尝试将可视化器 dll 复制到`Document and Settings\<debug_account>\My Documents\Visual Studio 2005\Visualizers`（自定义可视化器的推荐路径）。例外是相同的，但引用 MyDocs 路径而不是 VS 安装路径。

还有人看到这个吗？有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-19T17:31:41.640

我的一位同事找到了答案：将可视化程序 dll 复制到远程计算机上的某个位置，该位置反映了您的开发盒上的目录结构。

# apache-flex - 重新测量列表上的自定义项目渲染器

> ID：757288
> 
> 赞同：2
> 
> 时间：2009-04-16T17:50:38.320
> 
> 标签：apache-flex, air

我正在为类似于 Twitter 的服务编写一个 Adob​​e Air 客户端。

在时间轴（列表组件）上，我有一个自定义项目渲染器，它基本上是一个带有固定宽度图像和文本控件的画布，它是多行的。

如果文本足够长以更改画布高度，则只有在我手动更改窗口宽度时才会调整其大小，从而强制重绘所有渲染器。如果我只是滚动列表，所有“新”渲染器都将具有可能的最小高度（即图像高度）。

关于在设置数据时如何强制重新测量渲染器的任何想法？

提前致谢！:)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-17T04:34:53.403

尝试在 itemrender 上调用 invalidateSize()，和/或在列表上调用 invalidateDisplayList()

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-09T11:29:10.443

您是否尝试设置`variableRowHeight=true`列表？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-24T23:13:25.717

如果您处理 updateComplete 事件，则可以在那里重新计算大小。这可能是过度杀戮，因为每次绘制 itemrenderer 时都会发生 updateComplete 但它可以工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-09T10:57:24.473

我正在努力解决类似的失效/调整大小问题。该视频为我提供了一些关于构建自定义组件的信息。希望能帮助到你。

这是一个 adobe 工程师关于在 Action 脚本中为 flex 创建组件的精彩视频的链接。

[http://tv.adobe.com/watch/max-2008-develop/creating-new-components-in-flex-3-by-deepa-subramaniam/](http://tv.adobe.com/watch/max-2008-develop/creating-new-components-in-flex-3-by-deepa-subramaniam/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-04-11T10:25:34.197

首先你必须设置`variableRowHeight`为true；
在你的`itemRenderer`你应该关闭`verticalScrollPolicy`（我假设你已经这样做了），并对文本控件执行相同的操作。还将文本的高度设置为 100%。
我没有在 Flex4 中尝试过，但在以前的版本中，我必须有一个 VBox 作为根，`itemRenderer`以便根据其文本内容调整大小，因此您应该考虑使用`VBox / VGroup`实例而不是`Canvas`.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-11-18T14:14:25.947

我遇到了一个非常类似的问题，即使用需要根据文本调整自身大小的标签在数据网格中调整项目渲染器的大小。问题是多行文本组件需要两次通过才能正确更新自身。这适用于大多数控件，因为它们会不断更新和定位。它在列表或网格中失败，因为发生更改时的第一次更新会强制列表测量项目渲染器，然后根据返回的结果设置其行的高度。项目渲染器然后第二次更新自己（这次正确测量自己），但列表不会寻找那些更新更改。我采取强制验证测量通道中的标签（文本控件）以正确调整文本组件的大小，以便渲染器在任何更改后的第一次更新通道中报告正确的测量高度。我的任务（以及我随后发现的分析器和一些讨论）在这里：[ItemRenderer 高度（和高度变化）未反映在 AdvancedDataGrid 行中](https://stackoverflow.com/questions/7421926/itemrenderer-hieght-and-height-changes-not-reflected-in-advanceddatagrid-row)

# c# - ReadOnlyAttribute 与 PropertyDescriptor.IsReadOnly()

> ID：757289
> 
> 赞同：5
> 
> 时间：2009-04-16T17:50:55.340
> 
> 标签：c#, attributes, readonly, propertydescriptor

`PropertyDescriptor`使用为方法返回值的 a`IsReadOnly()`和与 a 关联的有什么区别`ReadOnlyAttribute`？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T19:48:47.913

主要区别在于，如果您提供自己的`PropertyDescriptor`实现（通过或） `ICustomTypeDescriptor`，这可以让您获得更多控制权。然后，您可以选择*自己的*可写逻辑 - 例如，基于访问权限。`TypeDescriptionProvider``TypeConverter`

 *但是，是的; 在默认实现下，它将为没有设置器的属性和标记为的属性报告只读`ReadOnlyAttribute`。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T18:09:10.133

当我使用反射器查看它时没有区别。

派生类 SimplePropertyDescriptor 之一具有以下代码。

```
 public override bool IsReadOnly
    {
        get
        {
            return this.Attributes.Contains(ReadOnlyAttribute.Yes);
        }
    } 

```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-02-04T23:55:32.900

只是一个注释。

我花了一天时间为我的应用程序中的实体对象实现 ICustomTypeDescriptor，以便单独控制每个实体的只读状态。

因此，每个 PropertyDescriptor 实现都保留了对它来自的实体对象的引用，因此 IsReadOnly 属性是这样的：

```
public override bool IsReadOnly
{
    get { return _owner.IsReadOnly;}
} 
```

但是，当我运行代码时，BindingSource 组件从 ICustomTypeDescriptor 的 GetProperties() 方法中为集合中的每条记录读取一组 PropertyDescriptor，但是，当它检查 IsReadOnly 的值时，它只测试了从第一个获取的 PropertyDescriptor记录。

完全浪费时间！！！！

# linux - 如何在 Linux 中识别 USB 设备的芯片组？

> ID：757295
> 
> 赞同：14
> 
> 时间：2009-04-16T17:52:26.927
> 
> 标签：linux, usb

我希望能够识别特定 USB 设备正在使用的芯片组。我知道 lsusb（现在是 /proc/bus/usb/devices），但它们提供的信息不如 lspci。

这是我如何使用 lsusb 的示例：

> ```
> （笔记本电脑：/proc/bus/usb）# lsusb -v -d 050d:805c
> 
> 总线 001 设备 008：ID 050d:805c 贝尔金组件
> 设备描述符：
> ：
>   idVendor 0x050d 贝尔金组件
>   idProduct 0x805c
>   bcdDevice 0.01
>   iManufacturer 1 雷凌
>   iProduct 2 802.11 n WLAN
> ：
> 
> ```

...和 ​​/proc/bus/usb/devices （感谢对此线程的评论）：

> ```
> T: Bus=01 Lev=02 Prnt=03 Port=02 Cnt=01 Dev#= 8 Spd=480 MxCh= 0
> D: Ver= 2.00 Cls=00(>ifc ) Sub=00 Prot=00 MxPS=64 #Cfgs= 1
> P：供应商=050d ProdID=805c Rev= 0.01
> S：制造商=Ralink
> S：产品=802.11 n WLAN
> C:* #Ifs= 1 Cfg#= 1 Atr=80 MxPwr= 4mA
> 
> ```

虽然我可以看到我正在寻找正确的 USB 设备（Belkin USB 801.11n 和 Ralink 芯片组），但我仍然无法确定确切的芯片组版本。“0x805c”与我期望的芯片组编号不匹配（ 2500 - 2900 ）。

我在想也许甚至不可能通过 USB 总线查询这些信息？

提前感谢您的帮助。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-17T09:38:02.770

除非制造商为每个不同的芯片组更改 ProductID 或更新修订号，否则没有通用的方法来确定芯片组。即使这样，您也需要知道 ProductID 如何映射到芯片组。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T18:11:07.490

你试过了吗

```
lsusb -v 
```

当使用详细开关时， lsusb 会打印*很多*信息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T17:55:34.987

/proc/bus/usb/devices 提供比 lsusb 更多的信息和基本选项，并且更容易从程序中使用......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-22T01:43:59.687

在不打开外壳的情况下，您最接近了解产品的是 VID（供应商 ID）和（产品 ID），

但是据我所知，许多供应商使用相同的 VID 和 PID（为了驱动程序兼容性）并更改芯片组。

您可以打开机箱，并希望制造商没有删除零件编号。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-02-21T20:27:32.860

尝试

```
lspci -v 
```

您将获得更多信息

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-22T02:06:55.013

使用 lsusb 获取 ID 并搜索。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-11-29T09:18:36.073

我想视情况而定，使用相同的工厂，wifi usb dongle，我明白了

```
lsusb -v
Bus 001 Device 008: ID 148f:3070 Ralink Technology, Corp. RT2870/RT3070 Wireless Adapter
idVendor           0x148f Ralink Technology, Corp.
idProduct          0x3070 RT2870/RT3070 Wireless Adapter 
```

将 3070 作为芯片组赠送。

虽然，更多搜索会泄露您在 debian wiki 中列为 2870 的芯片编号，

```
USB: 050D:805C Belkin Components F5D8053 N Wireless Adapter v3000 [Ralink RT2870] 
```

[关联](http://wiki.debian.org/rt2870sta)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-05-15T08:26:34.003

您也可以使用`dmesg`.

我有一个 USB BLE 加密狗并将其连接到我的 PC 会产生以下结果：

```
[31254.130216] usb 1-4: USB disconnect, device number 5
[31305.979397] usb 1-4: new full-speed USB device number 6 using xhci_hcd
[31306.338254] usb 1-4: New USB device found, idVendor=0a12, idProduct=0001
[31306.338259] usb 1-4: New USB device strings: Mfr=0, Product=2, SerialNumber=0
[31306.338263] usb 1-4: Product: CSR8510 A10 
```

我从中得到了“CSR8510 A10”（这让我想到了高通 CSR8510 芯片组）。

# c++ - 通过 LoadLibrary 从普通 C++ 程序加载托管 C++ DLL

> ID：757298
> 
> 赞同：3
> 
> 时间：2009-04-16T17:54:19.450
> 
> 标签：c++, dll, loadlibrary

我试图在托管 C++ 和普通 C++ 工作之间得到一个简单的混合。我正在使用 Visual Studio 2005，但一直遇到问题。这是我的设置。

首先，我有一个从代码构建的简单 DLL

```
#using "mscorlib.dll"

#include "windows.h"

__declspec(dllexport)
void sayHello()
{
    OutputDebugStringA( "Hello from managed code!" );
} 
```

我在命令行上将其编译为 DLL，使用

```
cl /CLR /LD dllcode.cpp 
```

接下来，我有一个简单的程序，仅包含以下内容

```
#include <windows.h>
int main()
{
    HINSTANCE lib = LoadLibrary( "dllcode.dll" );
    if ( !lib ) {
        return 1;
    }
    return 0;
} 
```

我使用它构建了一个应用程序

```
cl loader.cpp 
```

所以我最终在`dllcode.dll`同`loader.exe`一个目录中。尝试运行时`loader.exe`，我总是得到返回码“1”。查找产生的错误代码`GetLastError()`显示加载`dllcode.dll`失败是由于`The specified module could not be found.`

有人知道为什么会这样吗？它是否与需要嵌入的清单有关`dllcode.dll`？我在 dllcode.dll 上运行了依赖程序，但据我所知，它没有产生任何问题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T18:25:04.167

我刚刚发现为什么从我的 vanilla C++ 程序加载托管 C++ DLL 不起作用。再次感谢 jdigital 为我提供了一个有用的工具：

错误的根源是没有找到 MSVC8 运行时库。我认为通过构建时生成的清单

```
cl /CLR /LD dllcode.cpp 
```

已经嵌入到 DLL 中。显然，它不是 - 所以加载程序未能找到适当的 MSVCR80.dll 副本。

我通过向 DLL 构建例程添加第二步来解决此问题：

```
cl /CLR /LD dllcode.cpp
mt -manifest dllcode.dll.manifest -outputresource:dllcode.dll;2 
```

希望这可以帮助。相当初学者的问题，我怀疑......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T18:01:34.770

您可以尝试使用[filemon](http://technet.microsoft.com/en-us/sysinternals/bb896642.aspx)来查看 LoadLibrary 尝试加载的内容。

# jpa - 如何在 JPA 中映射实体的复合键？

> ID：757299
> 
> 赞同：5
> 
> 时间：2009-04-16T17:54:28.357
> 
> 标签：jpa

我有 REGION 表：

```
REG {
    id number,
    dateCreation Date
  } 
```

我有一个 LOCALE 表：

```
LOCALE {
     locale String
  } 
```

我有一个 REGION_DESCRIPTION 表：

```
REGION_DESCRIPTION {
     locale String,
     regId number,
     description
  } 
```

REGION_DESCRIPTION 有一个复合键：locale 是指向 LOCALE 表的外键。并且 regId 指向 REGION 表。

我想将此映射到我的 Region java 类：

```
private List<RegionDescription> descriptions; 
```

我在 JPA 中尝试了不同的方法。但我无法让映射工作。有什么建议么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-17T13:05:56.140

您有一个连接表（REGION_DESCRIPTION）通过携带自己的属性成为实体的情况。我建议如下：

1.  将*RegionDescription*定义为具有复合主键类的完整实体，请参见[示例](http://download-uk.oracle.com/docs/cd/B32110_01/web.1013/b28221/cmp30cfg001.htm#BCGGGDDC)；

2.  *在RegionDescription*中定义 2 个多对一关系： *RegionDescription*到*Region*和 *RegionDescription*到*Locale*。

3.  *或者或另外在Region*中定义一对多关系以按照您上面指定的方式 映射*RegionDescription*。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-06-07T08:34:54.890

这应该满足您的需求：

```
@Entity
public class Region
{
    @Id
    private Long id;
    @Temporal(TemporalType.DATE)
    private Date dateCreation;
    @OneToMany(mappedBy = "region")
    @JoinColumn(name = "id", referencedColumnName = "region_id")
    private List<RegionDescription> descriptions;
}

@Entity
public class Locale
{
    @Id
    private String name;
}

@Entity
public class RegionDescription
{
    @EmbeddedId
    private RegionDescriptionPK key;

    @MapsId(value = "regionId")
    @ManyToOne
    @JoinColumns({
        @JoinColumn(name = "region_id", referencedColumnName = "id")
    })
    private Region region;

    @MapsId(value = "localeName")
    @ManyToOne
    @JoinColumns({
        @JoinColumn(name = "locale", referencedColumnName = "name")
    })
    private Locale locale;
}

@Embeddable
public class RegionDescriptionPK
{
    @Column(name = "id")
    private Long regionId;

    @Column(name = "locale")
    private String localeName;
} 
```

作为旁注，我已经看到这个问题很老了。但它并没有以某种方式关闭。:-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-11-18T08:47:28.847

这应该有效：

```
@Entity
public class Region
{
    @Id
    private Long id;
    @Temporal(TemporalType.DATE)
    private Date dateCreation;

    @OneToMany(mappedBy = "regionDescriptionPK.region")
    private List<RegionDescription> descriptions;
}

@Entity
public class RegionDescription
{
    @EmbeddedId
    private RegionDescriptionPK regionDescriptionPK;    
}

@Embeddable
public class RegionDescriptionPK
{
    @ManyToOne
    @JoinColumn(name = "Region_ID")
    private Region region;

    @ManyToOne
    @JoinColumn(name = "locale")
    private Locale locale;
}

@Entity
public class Locale
{
    @Id
    private String name;
} 
```

# java - 以编程方式计算 Java 对象占用的内存，包括它引用的对象

> ID：757300
> 
> 赞同：18
> 
> 时间：2009-04-16T17:54:48.497
> 
> 标签：java, memory-management

我需要以编程方式准确找出给定 Java 对象占用的内存量，包括它所引用的对象占用的内存量。

我可以生成内存堆转储并使用工具分析结果。但是，生成堆转储以及此类工具读取转储以生成报告需要相当长的时间。鉴于我可能需要多次执行此操作，如果我可以在我的项目中添加一些代码来赋予我“运行时”这个价值，我的工作将会更加灵活。

我怎样才能最好地做到这一点？

ps：具体来说，我有一个 javax.xml.transform.Templates 类型的对象集合

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-16T18:02:55.983

您将需要为此使用**反射**。生成的代码太复杂了，我无法在此处发布（尽管它很快将作为我正在构建的 GPL 工具包的一部分提供），但主要思想是：

*   一个对象头使用 8 个字节（用于类指针和引用计数）
*   每个原始字段使用 1、2、4 或 8 个字节，具体取决于实际类型
*   每个对象引用（即非原始）字段使用 4 个字节（引用，加上被引用对象使用的任何内容）

您需要分别处理数组（8 字节的标头、4 字节的长度字段、4*length 字节的表，以及内部使用的任何对象）。您需要使用反射处理遍历字段（及其父字段）的其他类型的对象。

您还需要在递归过程中保留一组“已看到”的对象，以免计算在多个地方引用的多次对象。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-16T18:24:53.090

看起来已经有一个名为[Classmexer](http://www.javamex.com/classmexer/)的实用程序来执行此操作。

我自己没有尝试过，但我会在自己推出之前走那条路。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-16T18:17:35.323

一个好的通用解决方案是使用堆大小增量。这涉及最少的工作，并且可以在任何类型的对象/对象图之间重用。通过多次实例化和销毁您的对象并在其间进行垃圾收集，然后取平均值，您可以避免编译器和 JVM 优化会改变结果并获得相当准确的结果。如果您需要精确到字节的答案，那么这可能不是您的解决方案，但对于我所知道的所有实际应用程序（分析、内存需求计算）来说，它工作得非常好。下面的代码将做到这一点。

```
 public class Sizeof {
      public static void main(String[] args)
          throws Exception {
        // "warm up" all classes/methods that we are going to use:
        runGC();
        usedMemory();

        // array to keep strong references to allocated objects:
        final int count = 10000; // 10000 or so is enough for small ojects
        Object[] objects = new Object[count];

        long heap1 = 0;

        // allocate count+1 objects, discard the first one:
        for (int i = -1; i < count; ++i) {
          Object object;

    //// INSTANTIATE YOUR DATA HERE AND ASSIGN IT TO 'object':

          object=YOUR OBJECT;
    ////end your code here
          if (i >= 0) {
            objects[i] = object;
          }
          else {
            object = null; // discard the "warmup" object
            runGC();
            heap1 = usedMemory(); // take a "before" heap snapshot
          }
        }

        runGC();
        long heap2 = usedMemory(); // take an "after" heap snapshot:

        final int size = Math.round(((float)(heap2 - heap1)) / count);
        System.out.println("'before' heap: " + heap1 +
                           ", 'after' heap: " + heap2);
        System.out.println("heap delta: " + (heap2 - heap1) +
                           ", {" + objects[0].getClass() + "} size = " + size + " bytes");
      }

      // a helper method for creating Strings of desired length
      // and avoiding getting tricked by String interning:
      public static String createString(final int length) {
        final char[] result = new char[length];
        for (int i = 0; i < length; ++i) {
          result[i] = (char)i;
        }

        return new String(result);
      }

      // this is our way of requesting garbage collection to be run:
      // [how aggressive it is depends on the JVM to a large degree, but
      // it is almost always better than a single Runtime.gc() call]
      private static void runGC()
          throws Exception {
        // for whatever reason it helps to call Runtime.gc()
        // using several method calls:
        for (int r = 0; r < 4; ++r) {
          _runGC();
        }
      }

      private static void _runGC()
          throws Exception {
        long usedMem1 = usedMemory(), usedMem2 = Long.MAX_VALUE;

        for (int i = 0; (usedMem1 < usedMem2) && (i < 1000); ++i) {
          s_runtime.runFinalization();
          s_runtime.gc();
          Thread.currentThread().yield();

          usedMem2 = usedMem1;
          usedMem1 = usedMemory();
        }
      }

      private static long usedMemory() {
        return s_runtime.totalMemory() - s_runtime.freeMemory();
      }

      private static final Runtime s_runtime = Runtime.getRuntime();

    } // end of class 
```

# cocoa-touch - 如何在可可中不同控制器内的主线程和辅助线程之间切换

> ID：757311
> 
> 赞同：0
> 
> 时间：2009-04-16T17:57:01.113
> 
> 标签：cocoa-touch, multithreading, controller

我知道我可以使用以下代码在 cocoa touch 中创建一个单独的线程：

```
 [NSThread detachNewThreadSelector:@selector(getEarthquakeData) toTarget:self withObject:nil]; 
```

如何回到我的主线程的进程？我知道我可以使用以下代码从代表处执行此操作：

```
 [(id)[[UIApplication sharedApplication] delegate] performSelectorOnMainThread:@selector(addToEarthquakeList:) withObject:self.currentEarthquakeObject waitUntilDone:YES]; 
```

如果主线程在控制器中运行而不是在上面的委托中运行，我将如何执行上述操作。

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-16T19:02:02.347

你有正确的电话。当你调用`performSelectorOnMainThread:...`你的请求时，你的请求会在主线程的运行循环中排队，所以如果主线程在其他地方执行，那么处理将首先完成。一旦您的主线程代码返回到运行循环，就可以查看和调用来自后台线程的请求。

如果还有其他事件排队等待运行循环处理，我不知道是什么决定了优先级 - 但总的来说，我认为即使是下一个执行的事情，你也不能依赖它。这是您应该尝试将主线程顺序处理保持在最低限度的另一个原因（即，尽量不要在主线程上长时间运行序列 - 但这可能是您首先使用后台线程的原因）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T19:21:24.780

你不能这样做：

```
[controller performSelectorOnMainThread:@selector(addToEarthquakeList:) withObject:self.currentEarthquakeObject waitUntilDone:YES]; 
```

...还是我误解了你的问题？（我以为你在问如何在主线程上运行控制器方法。）

# ruby-on-rails - 是否有任何用于 Rails 的安全测试插件？

> ID：757318
> 
> 赞同：13
> 
> 时间：2009-04-16T17:58:59.657
> 
> 标签：ruby-on-rails, security, plugins

是否有任何工具可以测试您的 Rails 应用程序的安全性？

能自动测试sql注入、跨站脚本等的东西……

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-22T06:55:19.343

我不确定是否有任何插件可以测试代码的安全性，但这里有一些关于 Rails 应用程序的潜在缺陷和修复的阅读：

1.  [Quark Ruby：Ruby on Rails 安全指南](http://www.quarkruby.com/2007/9/20/ruby-on-rails-security-guide)
2.  [官方 Ruby on Rails 安全指南](http://guides.rubyonrails.org/security.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T07:28:08.220

[Safe ERB](http://github.com/pelargir/safe_erb/tree/master)是一个插件，它会为视图模板中的任何未转义字符串引发异常，即未使用“h”方法转义的动态数据。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T14:24:57.480

查看[http://www.ouncelabs.com/](http://www.ouncelabs.com/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T18:37:03.917

它不是 Rails 插件，但[http://www.owasp.org/](http://www.owasp.org/)是一个不错的起点。

# sql - 如何在 SQL Server 08 中优化这个极其低效的用户定义函数

> ID：757322
> 
> 赞同：1
> 
> 时间：2009-04-16T17:59:37.737
> 
> 标签：sql, sql-server-2008, user-defined-functions

无论如何，在 SQL Server 08 中优化这个可怕的低效 UDF。我对 UDF 相当陌生，特别是在寻找它们进行优化。

更新：如果我想在查询中的每一行和每一列上执行它，我应该将一列发送到这样的函数吗？有没有更好的方法来解决这个问题？

谢谢你

** @value(float) 和 @fieldname(varchar(40)) 是输入参数 **

```
BEGIN
  DECLARE @UT integer, @FRM integer, @TO integer, @FACTOR float

  select @UT =  [UF_UT_ID] FROM dbo.UNIT_FIELDS where [UF_FIELD]=@fieldName
  select @FRM = [UT_UN_ID_INTERNAL_UNITS] from dbo.UNIT_TYPES where [UT_ID]=@UT
  select @TO = [UT_UN_ID_DISPLAY_UNITS] from dbo.UNIT_TYPES where [UT_ID]=@UT
  select @FACTOR = [UC_SLOPE] from dbo.UNIT_CONVERSIONS where [UC_UN_ID_UNIT_FROM]=@FRM and [UC_UN_ID_UNIT_TO]=@TO

  -- Return the result of the function dbo.
  RETURN @FACTOR*@value
END 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T18:05:07.007

如果您可以基于 PK/FK 关系连接三个表，则可以将查询简化为单个选择。如果没有，唯一立即明显的优化是在单个 select 语句中分配 @FRM 和 @TO：

```
select @FRM = [UT_UN_ID_INTERNAL_UNITS], @TO = [UT_UN_ID_DISPLAY_UNITS] from dbo.UNIT_TYPES where [UT_ID]=@UT 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T18:05:48.127

内联表函数的经典候选...

就像是：

```
ALTER FUNCTION fnName(@value float, @fieldName VARCHAR(100))
RETURNS TABLE 
AS
RETURN 
(
    SELECT @value * 
        (SELECT conv.[UC_SLOPE] from dbo.UNIT_CONVERSIONS conv
        JOIN dbo.UNIT_TYPES UT_UN_ID_INTERNAL_UNITS ON where [UC_UN_ID_UNIT_FROM]=UT_UN_ID_INTERNAL_UNITS.[UT_ID]
        JOIN dbo.UNIT_TYPES UT_UN_ID_DISPLAY_UNITS ON where [UC_UN_ID_UNIT_TO]=UT_UN_ID_DISPLAY_UNITS.[UT_ID]
        JOIN dbo.UNIT_FIELDS fields ON (UT_UN_ID_INTERNAL_UNITS.[UT_ID] = fields.[UF_UT_ID]) AND (UT_UN_ID_DISPLAY_UNITS.[UT_ID] = fields.[UF_UT_ID])
        WHERE ([UF_FIELD]=@fieldName)
        )
) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T18:04:29.160

第 1 步是单独运行每个选择并查看瓶颈在哪里。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T18:11:34.870

```
BEGIN
  DECLARE @FACTOR float

    select @factor = UC.UC_SLOPE
      from dbo.UNIT_CONVERSIONS UC,
           dbo.UNIT_TYPES       UT,
           dbo.UNIT_FIELDS      UF
      where UF.UF_FIELD=@fieldName
        and UT.UT_ID = UF.UF_UT_ID
        and UC.UC_UN_ID_UNIT_FROM = UT.UT_UN_ID_INTERNAL_UNITS
        and UC.UC_UN_ID_UNIT_TO = UT.UT_UN_ID_DISPLAY_UNITS

  -- Return the result of the function dbo.
  RETURN @FACTOR*@value
END 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T18:14:27.593

您可以将其作为所有一个查询来尝试：

```
--Decalre Factor var
DECLARE @FACTOR float

SELECT @FACTOR = [UC_SLOPE] 
FROM dbo.UNIT_CONVERSIONS uc
--Join the Unit Types table to Unit Conversions on the old From & To types
INNER JOIN dbo.UNIT_TYPES ut ON
    ut.[UT_UN_ID_DISPLAY_UNITS] = uc.[UC_UN_ID_UNIT_TO]
    AND ut.[UT_UN_ID_INTERNAL_UNITS] = uc.[UC_UN_ID_UNIT_FROM]
--Join the Unit Files on the Unit Types
INNER JOIN dbo.UNIT_FIELDS uf ON
    uf.[UF_UT_ID] = ut.[UT_ID]
WHERE uf.[UF_FIELD]=@fieldName

-- Return the result of the function dbo.
RETURN @FACTOR*@value 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T18:07:41.040

你可以做的一件小事：

```
 select @FRM = [UT_UN_ID_INTERNAL_UNITS] from dbo.UNIT_TYPES where [UT_ID]=@UT  
 select @TO = [UT_UN_ID_DISPLAY_UNITS] from dbo.UNIT_TYPES where [UT_ID]=@UT 
```

如果我阅读正确，这将与以下内容相同：

```
 select @TO = [UT_UN_ID_DISPLAY_UNITS],
        @FRM = [UT_UN_ID_INTERNAL_UNITS] 

 from dbo.UNIT_TYPES where [UT_ID]=@UT 
```

为什么要在同一条记录上运行两次选择？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-16T18:08:19.637

这需要使用`JOIN`'s 重写：

```
SELECT  c.UC_SLOPE * @value
FROM    unit_fields f
JOIN    unit_types t
ON      t.UT_ID = f.UF_UT_ID
JOIN    unit_conversions c
ON      c.UC_UN_ID_UNIT_FROM = t.UT_UN_ID_INTERNAL_UNITS
        AND c.UC_UN_ID_UNIT_TO = t.UT_UN_ID_DISPLAY_UNITS
WHERE   f.UF_FIELD = @field_name 
```

# networking - 最容易记住的可公开 ping 的 IP 地址是什么？

> ID：757324
> 
> 赞同：18
> 
> 时间：2009-04-16T18:00:34.070
> 
> 标签：networking, ip, ping

出于频繁的网络故障排除目的，您是否知道具有易于记忆的 IP 地址（例如 1.2.3.4）的可公开 ping 的主机？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-04-16T18:04:20.720

```
C:\Documents and Settings\Administrator>ping -a 4.2.2.2

Pinging vnsc-bak.sys.gtei.net [4.2.2.2] with 32 bytes of data:

Reply from 4.2.2.2: bytes=32 time=10ms TTL=246
Reply from 4.2.2.2: bytes=32 time=10ms TTL=246
Reply from 4.2.2.2: bytes=32 time=14ms TTL=246
Reply from 4.2.2.2: bytes=32 time=10ms TTL=246

Ping statistics for 4.2.2.2:
    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),
Approximate round trip times in milli-seconds:
    Minimum = 10ms, Maximum = 14ms, Average = 11ms 
```

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2010-04-06T11:43:44.130

8.8.8.8 是谷歌新的公共 dns 服务器，它很容易记住并且很可能会启动 ;-)

```
$ ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
64 bytes from 8.8.8.8: icmp_seq=1 ttl=242 time=18.4 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=242 time=18.5 ms
64 bytes from 8.8.8.8: icmp_seq=3 ttl=242 time=18.0 ms
^C
--- 8.8.8.8 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2003ms
rtt min/avg/max/mdev = 18.024/18.366/18.599/0.292 ms

$ host 8.8.8.8
8.8.8.8.in-addr.arpa domain name pointer google-public-dns-a.google.com. 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T18:07:28.390

```
4.2.2.2
4.2.2.6

208.67.222.222
208.67.220.220 
```

将这些添加到 /etc/hosts 以便于 ping :)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T18:03:06.730

127.0.0.1 每次都有效，而且很容易记住。

实际上，我建议使用主机名：c:[windows directory]\system32\drivers\etc\hosts

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-16T18:03:17.043

使用任何主机并使用[热字串](http://www.autohotkey.com/docs/Hotstrings.htm)！

ip1:: 122.123.232.98

之后，当我键入 ip1 时，它会将其替换为 122.123.232.98 这样您就可以使用任何主机而无需记住任何内容。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-16T18:05:10.517

我使用 4.2.2.2

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-09-25T05:45:27.213

如果您需要 HTTP 响应，则`190.9.9.190`可以使用

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-01-23T12:51:29.147

使用脚本，我得到了以下 IP 列表 - 很容易记住 - 并且在端口 80 上运行了一个网络服务器：

这是列表（2018 年 1 月 23 日）

```
http://23.23.23.23
http://41.41.41.41
http://80.80.80.80
http://127.127.127.127 
```

但所有这些主机的工作似乎都不可靠......这个想法是让最终用户轻松检查 DNS 是否有问题。

这是脚本：

```
#!/bin/sh
L=

for I in $(seq 1 254); do
  IP=$I.$I.$I.$I
  nc -z -v -w3 $IP 80 && wget -O - http://$IP && L="$L $IP"
  I=$(( I + 1 ))
done

echo $L 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2018-04-02T12:47:51.733

一个带有 http 响应的新版本：1.1.1.1 (http 302)

# .net - 为什么我的 GridView 给我一个 `allowDefinition='MachineToApplication'` 错误？

> ID：757327
> 
> 赞同：0
> 
> 时间：2009-04-16T18:02:07.293
> 
> 标签：.net, asp.net

这个错误在 GridView 的上下文中意味着什么？

> 在应用程序级别之外使用注册为 allowDefinition='MachineToApplication' 的部分是错误的。此错误可能是由未在 IIS 中配置为应用程序的虚拟目录引起的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T18:08:25.157

转到 IIS 并使用“创建应用程序”按钮将虚拟目录转换为应用程序

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T18:08:42.613

此错误不太可能与您的 Gridview 控件有关。正如消息所暗示的那样，您更有可能没有将网站的虚拟目录配置为 IIS 中的应用程序。右键单击 IIS 中的网站并检查其属性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-05-31T06:02:57.400

这确实是第一个要检查的场景。但是，发生此错误的最令人沮丧的情况是在不同的构建配置下构建/发布之后（即在 Release 下构建，然后尝试在 Debug 下构建并收到此错误）。您应该在 Release 模式下执行 Clean 操作。

请参阅指向更多详细信息的此答案：[错误：allowDefinition='MachineToApplication'超出应用程序级别](https://stackoverflow.com/questions/2355947/error-allowdefinition-machinetoapplication-beyond-application-level/2897171#2897171)

# vim - 在vim中反转逗号分隔列表的最快方法是什么？

> ID：757338
> 
> 赞同：13
> 
> 时间：2009-04-16T18:03:25.577
> 
> 标签：vim

我经常必须更正以下 rails 代码：

```
assert_equal value, expected 
```

assert_equal 的两个参数是乱序的，应该是：

```
assert_equal expected, value 
```

在 vim 中，从第一行到第二行的最有效方法是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-16T18:10:55.510

通过正则表达式：

```
:s/\v([^, ]+)(\s*,\s*)([^, ]+)/\3\2\1/ 
```

如果你经常这样做，你可以用它制作地图，例如：

```
:nmap <F5> :s/\v([^, ]+)(\s*,\s*)([^, ]+)/\3\2\1/<CR> 
```

将光标放在要翻转的行上并点击`F5`。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-16T18:11:46.897

这一个将光标所在的单词与下一个交换 - 只需在命令模式下按 F9：

```
:map <F9> "qdiwdwep"qp 
```

*   "qdiw: 将光标所在的单词放入缓冲区 'q'
*   dw：删除下一个单词开头的所有字符（可能是逗号+空格）
*   e: 到词尾
*   p：粘贴（逗号+空格）
*   "qp：粘贴缓冲区'q'（第一个单词）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T18:15:49.570

我一直喜欢正则表达式搜索和替换这些类型的任务：

```
:s/\(\w*\), \(\w*\)/\2, \1/ 
```

将用逗号分隔列表中的第二个单词交换第一个单词。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T18:10:44.700

映射一个组合键来执行命令：

```
:s/^assert_equal \(.*\), \(.*\)$/assert_equal \2, \1 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-17T08:27:15.687

对于这么简单的事情，我会做一个小宏

```
qadf ea, ^[pxxq 
```

然后@a 离开

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T18:08:59.383

嗯...我会说“tdwxx$i, ^[”tp 但这不是很有效或容易，只是足够快输入...

# visual-studio-2008 - 复制到输出目录似乎没有将 XLS 文件复制到我的 Web 垃圾箱

> ID：757340
> 
> 赞同：0
> 
> 时间：2009-04-16T18:03:57.663
> 
> 标签：visual-studio-2008

我有一个网站设置，它在我的解决方案中引用了另一个 DLL 项目。在那个项目中，我有两个额外的文件——一个 .LIC 文件和一个 .XLS 文件。它们都设置为“始终复制到输出目录”。

当我构建 DLL 项目时，项目的 bin/debug 文件夹获取 .LIC 文件和复制到其中的 .XLS 文件。但是，当我构建网站时，只有 .LIC 文件夹被复制到网站的 bin 文件夹中。

.XLS 是否也不会复制到其中？

谢谢

PS。视觉工作室 2008 SP1

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-08-10T17:38:07.943

我在 VS 2010 中的控制台应用程序中遇到了同样的问题。我会按 F5，它不会将 xslt 文件复制到输出目录，但是，如果我只是编译（没有调试）它会复制文件。

# msbuild - 如果文件存在，如何在 MSBuild 中导致错误？

> ID：757344
> 
> 赞同：36
> 
> 时间：2009-04-16T18:04:28.427
> 
> 标签：msbuild

我们有一个在每晚构建之前运行的流程。如果该过程失败，它会生成一个文本文件。我需要做的就是检查文件是否存在，如果存在，则导致 MSBuild 失败。

我目前尝试了以下方法：

```
<CreateProperty Condition="Exists('C:\Process\Fail.txt')"
      Value="false">
  <Output TaskParameter="Value" PropertyName="ProcessTestPassed"/>
</CreateProperty>
<Message Text="Process did not pass" Condition="Exists('C:\Process\Fail.txt')" ContinueOnError="false" />

<ReadLinesFromFile File="C:\Process\Fail.txt"                  Condition="'$(ProcessTestPassed)'=='false'" ContinueOnError="false" >
  <Output TaskParameter="Lines" ItemName="FileContents" />
</ReadLinesFromFile>
<Message Text="FileContents: $(FileContents)"  Condition="'$(ProcessTestPassed)'=='false'" ContinueOnError="false" /> 
```

这给出了一个带有此输出的传递构建：

```
Task "CreateProperty"
Done executing task "CreateProperty".
Task "Message"
  QAWizardProTestPassed did not pass
Done executing task "Message".
Task "ReadLinesFromFile"
Done executing task "ReadLinesFromFile".
Task "Message"
  FileContents: 
Done executing task "Message". 
```

我知道上面的内容可能有点矫枉过正，但我​​只需要一些工作！我在这里想念什么？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-04-22T09:34:23.207

正如@dprice 在他的评论中指出的那样，最好的解决方案是：

```
<Error Condition="Exists('C:\Process\Fail.txt')" Text="Process did not pass!" /> 
```

# java - Java Graphics 无法更改字体

> ID：757347
> 
> 赞同：2
> 
> 时间：2009-04-16T18:04:48.817
> 
> 标签：java, graphics, word-wrap

我正在尝试使用 Graphics 对象进行自定义绘画。我想以自动换行样式绘制文本，因此我使用了在此页面某处找到的一些示例代码。

我的问题是我无法以任何方式更改字体大小。请帮助我，我附上了下面的可执行源代码。

谢谢

克里斯

```
import java.awt.Color;
import java.awt.Dimension;
import java.awt.Font;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.font.LineBreakMeasurer;
import java.awt.font.TextLayout;
import java.text.AttributedCharacterIterator;
import java.text.AttributedString;

import javax.swing.JFrame;

public class JavaFontProblem extends JFrame {

    public JavaFontProblem() {
        setSize(new Dimension(1024, 768));
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
    }

    public void paint(Graphics g) {

        Graphics2D g2d = (Graphics2D) g;
        String longtext = "Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.";

        g2d.setColor(Color.BLACK);
        g2d.setFont(new Font("Verdana", Font.PLAIN, 250));

        AttributedString atString = new AttributedString(longtext);
        AttributedCharacterIterator iterator = atString.getIterator();

        LineBreakMeasurer measurer = new LineBreakMeasurer(iterator, g2d
                .getFontRenderContext());
        measurer.setPosition(iterator.getBeginIndex());

        int m_width = 500;

        float x = 50, y = 50;
        while (measurer.getPosition() < iterator.getEndIndex()) {
            TextLayout layout = measurer.nextLayout(m_width);

            y += layout.getAscent();
            float dx = layout.isLeftToRight() ? 0 : m_width
                    - layout.getAdvance();

            layout.draw(g2d, x + dx, y);
            y += layout.getDescent() + layout.getLeading();
        }

    }

    public static void main(String[] args) {
        new JavaFontProblem().setVisible(true);
    }

} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T18:22:16.420

```
atString.addAttribute(TextAttribute.FONT, myFont, 0, atString.length()); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T19:09:34.247

您需要发送长文本的长度...而不是 atString 长度

此外，您必须声明自己的 Font 对象。它也不需要你的 setFont。

```
import java.awt.font.TextAttribute;
import java.awt.Color;
import java.awt.Dimension;
import java.awt.Font;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.font.LineBreakMeasurer;
import java.awt.font.TextLayout;
import java.text.AttributedCharacterIterator;
import java.text.AttributedString;

import javax.swing.JFrame;

public class JavaFontProblem extends JFrame {

    public JavaFontProblem() {
        setSize(new Dimension(1024, 768));
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
    }

    public void paint(Graphics g) {

        Graphics2D g2d = (Graphics2D) g;
        String longtext = "Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.";

        g2d.setColor(Color.BLACK);
        //g2d.setFont(new Font("Verdana", Font.PLAIN, 250));

        Font myFont = new Font("Verdana", Font.PLAIN, 250);

        AttributedString atString = new AttributedString(longtext);
        atString.addAttribute(TextAttribute.FONT, myFont, 0, longtext.length());

        AttributedCharacterIterator iterator = atString.getIterator();

        LineBreakMeasurer measurer = new LineBreakMeasurer(iterator, g2d
                        .getFontRenderContext());
        measurer.setPosition(iterator.getBeginIndex());

        int m_width = 500;

        float x = 50, y = 50;
        while (measurer.getPosition() < iterator.getEndIndex()) {
                TextLayout layout = measurer.nextLayout(m_width);

                y += layout.getAscent();
                float dx = layout.isLeftToRight() ? 0 : m_width
                                - layout.getAdvance();

                layout.draw(g2d, x + dx, y);
                y += layout.getDescent() + layout.getLeading();
        }

    }

    public static void main(String[] args) {
        new JavaFontProblem().setVisible(true);
    }

} 
```

# javascript - javascript (jQuery) 的问题。可以在 Firefox 中使用，但不能在 IE 中使用

> ID：757355
> 
> 赞同：1
> 
> 时间：2009-04-16T18:07:29.450
> 
> 标签：javascript, jquery, cross-browser

我正在处理的网站有问题，可[在此处](http://dev.istocat.se/)获取。

使用 firefox 浏览时，网站上的 javascript 可以正常工作。然而，在 IE7 中，javascript 甚至不会被执行。

由于我是 javascript 新手，我怀疑我可能在代码的某个地方犯了一个明显的错误。

任何帮助表示赞赏！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-16T18:11:39.113

这是你的问题：

```
$.get("ajax.php", {case: caseNr, picturenr: picNr, pictureinfo: true}, function(data){ 
```

**case**是保留字。使用散列时，始终将键设置为字符串，您永远不会陷入困境

```
$.get("ajax.php", {"case": caseNr, "picturenr": picNr, "pictureinfo": true}, function(data){ 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T18:13:03.367

您的问题在 IE8 上的第 43 行 karlsten.js 上，因此您可能希望在 IE8 上调试它（如果可能），或者获取 Web 开发人员工具。$.get("ajax.php", {case: caseNr,

但是，有人在我之前提交了这个，并给出了一个很好的答案。:)

# javascript - 使用浏览器的后退按钮时删除/禁用 javascript

> ID：757358
> 
> 赞同：1
> 
> 时间：2009-04-16T18:07:59.370
> 
> 标签：javascript

我有一个包含两个框架的页面：一个是 Flash 应用程序，一个是带有用户控件的 aspx 页面，该用户控件包含一个带有多个“添加到购物车”按钮的网格。当用户单击一个按钮时，我想用购物车页面重新加载整个窗口。

[通过避免response.redirect，并使用response.write 插入一些重定向的javascript，我在这里](http://weblogs.asp.net/ksamaschke/archive/2003/02/23/2831.aspx)很好地发现了如何做到这一点。问题是当用户从购物车页面点击后退按钮时，脚本再次执行，有效地取消了后退按钮。（可用性差）

所以我的问题是，有没有办法检测用户是否通过后退按钮到达页面并避免执行脚本？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-16T18:17:36.447

更改您的 javascript 以替换当前 URL，而不仅仅是设置它

```
// Creates browser history
top.location = 'http://www.stackoverflow.com'

// Doesn't create browser history
top.location.replace( 'http://www.stackoverflow.com' ); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-17T00:12:37.373

> 当用户单击一个按钮时，我想用购物车页面重新加载整个窗口。

您应该使用[Post-Redirect-Get](http://en.wikipedia.org/wiki/Post/Redirect/Get)模型。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-17T00:55:32.730

通过使按钮以`target`属性为`_top`. 请注意，该`target`属性不会验证为 HTML4 或 XHTML。

如果您使用 POST 请求提交到购物车（一个好主意），那么 bobince 提到的 Post-Redirect-Get 习惯用法将进一步加强您的应用程序 - 如果用户使用后退或前进按钮进入您的购物车页面。

# pdf - Acrobat 上下文菜单

> ID：757365
> 
> 赞同：0
> 
> 时间：2009-04-16T18:08:56.140
> 
> 标签：pdf

当用户在 acrobat 中右键单击弹出的上下文菜单时，是否可以自定义我可以向其添加菜单项吗

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-18T06:57:48.213

在编写 C 插件时你绝对可以。您应该在插件的 init 方法中调用 AVAppRegisterForContextMenuAddition(...) 。IIRC，插件开发工具包有一个或两个样本可以更详细地说明这一点。

同时，我试图弄清楚如何从 JS 中做同样的事情。

# batch-file - 命名参数如何传递给批处理文件？

> ID：757370
> 
> 赞同：6
> 
> 时间：2009-04-16T18:09:38.727
> 
> 标签：batch-file

我拥有的批处理文件中的第一行是：

```
IF "%FirstServer2%" == "No" goto :SkipSolution 
```

变量 %FirstServer2% 未在任何地方声明，因此必须以某种方式将其传递给批处理文件。那么，我怎样才能传递价值呢？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-16T18:11:29.377

```
set FirstServer2=No
MyBatchFile.cmd 
```

只需事先设置环境变量，然后再启动批处理。

在这种情况下，命名参数有点误导，因为`FirstServer2`它只是一个普通的环境变量。

我曾在我曾经编写过的批处理中使用了类似的技术，该技术非常可配置。根据是否设置了变量，它会采用一些默认值或使用已经定义的值。如果您想避免过度解析直接传递给批处理的参数，这是一种非常有用的技术。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T18:14:25.067

从命令行传递的参数按数字引用（%1、%2 等）

前面有 % 的任何其他内容都将成为环境变量，可以在外部设置，也可以在 bat 或 cmd 文件中设置。

# c# - 如何在基类对象上调用子类方法？

> ID：757371
> 
> 赞同：2
> 
> 时间：2009-04-16T18:10:17.790
> 
> 标签：c#, inheritance, c#-2.0, polymorphism

我正在使用一个为我生成一堆类的库。

这些类都继承自一个公共基类，但该基类没有定义所有子类共有的几个方法。

例如：

```
SubClassA : BaseClass{
  void Add(ItemA item) {...}
  ItemA CreateNewItem() {...}
}

SubClassB: BaseClass{
  void Add(ItemB item) {...}
  ItemB CreateNewItem() {...}
} 
```

不幸的是，基类**没有这些方法**。这会很棒：

```
BaseClass{
  // these aren't actually here, I'm just showing what's missing:
  abstract void Add(ItemBaseClass item);  // not present!
  abstract ItemBaseClass CreateNewItem(); // not present!
} 
```

由于我的 A+B 对象有一个公共基类，而 Item 对象有一个公共基类，我希望能从多态的美妙世界中受益。

不幸的是，因为通用方法实际上并不存在于基类中，所以我不能虚拟地调用它们。例如，这将是完美的：

```
BaseClass Obj;
Obj = GetWorkUnit(); // could be SubClassA or SubClassB

ItemBaseClass Item = Obj.CreateNewItem(); // Compile Fail: CreateNewItem() isn't in the base class

Item.DoSomething();

Obj.Add(Item); // Compile Fail: Add(...) isn't in the base class 
```

显然铸造会起作用，但我需要知道我拥有哪种类型会否定这些好处。

如何“强制”调用这些方法？我不担心得到一个不实现我试图调用的方法的对象。我实际上可以在 VB 中做我想做的事——我没有得到智能感知，但编译器很高兴并且它可以工作：

```
CType(Obj, Object).Add(Item) // Note: I'm using C#--NOT VB 
```

同样，我无法控制这些类（我认为排除了部分类）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T18:13:50.417

如果不求助于反射或其他肮脏的技巧，就不能调用派生类的非虚拟方法。如果你想这样做，那么很容易：

```
// obj is your object reference.
obj.GetType().InvokeMember("MethodName", 
    System.Reflection.BindingFlags.InvokeMethod, null, obj, null /* args */) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T18:22:42.253

我可能遗漏了一些东西，但为什么不使用这些方法从接口创建和继承呢？

如果您可以控制实例的创建过程，则可以通过从您没有编写的类继承并添加接口来获得所需的内容（无需编写代码，编译器会将接口映射到现有的非虚拟方法）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T18:14:42.880

将它们声明为虚拟：

[http://msdn.microsoft.com/en-us/library/9fkccyh4(VS.71).aspx](http://msdn.microsoft.com/en-us/library/9fkccyh4(VS.71).aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T18:26:57.780

如果您使用的是 Visual Studio 2008 - 您可以为基类创建扩展方法。在该扩展方法中，您将进行强制转换并调用子类的方法。只要您从 VS 2008 编译，这也应该适用于 2.0 框架目标项目。借用其他建议的反射代码，您可以执行以下操作...

```
public static class MyExtensions
{
   public static ItemBaseClass CreateNewItem(this BaseClass item)
   {
      return item.GetType().InvokeMember("MethodName", System.Reflection.BindingFlags.InvokeMethod, null, obj, null /* args */);
   }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T18:30:34.543

另一种可能性是使用一些代理机制，例如 RealProxy（虽然在性能方面不是很有效），或者通过使用动态创建的 DynamicMethods 更好，这样使用反射的开销对于每种类型只有一次支持，同时保持它为灵活的反射方法。当您需要多次调用该方法时，这会带来很大的回报，但它需要一些 MSIL 知识。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T18:40:42.163

问题 #1：您的子类没有覆盖任何东西 问题 #2：您的子类具有与基类不同的函数签名

确保您的签名是正确的，如果您要覆盖它们，请将它们标记为虚拟而不是抽象。如果您不希望基类虚函数执行任何操作，则必须向基类虚函数添加一个空主体。

```
class ItemBase{}

class ItemA : ItemBase{}

class ItemB : ItemBase{}

class BaseClass
{
    public virtual void Add(ItemBase item){}
    public virtual ItemBase CreateItem() { return null; }
}

class ClassA : BaseClass
{
    public override void Add(ItemBase item)
    {
        //do whatever
        throw new NotImplementedException();
    }

    public ItemBase CreateItem()
    {
        //create an ItemBase and return
        throw new NotImplementedException();
    }
} 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-04-16T18:35:39.850

您忘记了子类的方法定义中的“覆盖”关键字。当某些东西被声明为“抽象”时，它根据定义是虚拟的，因此在子类中，您需要将“覆盖”关键字放在方法声明的前面。所以应该工作如下：

```
BaseClass{
  abstract void Add(ItemBaseClass item);  // not present!
  abstract ItemBaseClass CreateNewItem(); // not present!
}

SubClassA : BaseClass{
  override void Add(ItemA item) {...}
  override ItemA CreateNewItem() {...}
}

SubClassB: BaseClass{
  override void Add(ItemB item) {...}
  override ItemB CreateNewItem() {...}
} 
```

这应该完全按照您在使用示例中的需要工作。

# c# - 如何在 Resharper 4.5 中使用 bdd 命名风格？

> ID：757381
> 
> 赞同：14
> 
> 时间：2009-04-16T18:12:18.987
> 
> 标签：c#, resharper, bdd

我刚刚升级到 Resharper 4.5，现在看到我所有的 BDDish 测试方法都被标记为不符合命名标准。我的命名约定是这样的：

```
public void Something_ShouldHaveThisResult() 
```

Resharper 不喜欢方法中的下划线。有没有办法关闭它，只是为了测试方法？对于我的其余代码，我有一个正常的命名约定。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2010-10-27T14:36:06.957

[如何更改测试方法的 ReSharper 命名样式](http://atombrenner.blogspot.com/2010/07/how-to-change-resharper-naming-style.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-21T21:08:07.790

如果您想在非测试代码源中遵循 Microsoft 样式指南 - 您是否尝试过使用[StyleCop for ReSharper 插件](http://www.codeplex.com/StyleCopForReSharper)？

如前所述：禁用内部 ReSharper 命名规则集或切换检查设置。StyleCop（因此是 StyleCop ReSharper 插件）允许继承解决方案文件夹结构中的 Settings.StyleCop 文件。因此，您可以检查“真实”来源中的有效名称，同时禁用对测试代码的分析。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-21T14:05:21.877

你可以使用

// ReSharper 禁用 InconsistentNaming

// ReSharper 恢复 InconsistentNaming

围绕每个班级的四肢。例如

```
// ReSharper disable InconsistentNaming
namespace bob
{
    [TestClass]
    public class MyTestClass
    {
        [TestMethod] 
        public void Test_Test()
        {
        }
    }
}
// ReSharper restore InconsistentNaming 
```

但是，这将删除所有命名警告，而不仅仅是方法名称上的警告。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-26T05:57:38.440

我已经在 ReSharper 错误跟踪器中添加了一个请求。你可以[投票给它](http://www.jetbrains.net/jira/browse/RSRP-104309)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-07-28T17:33:18.553

Resharper 4.5.1 已添加此功能。您现在可以添加专门适用于测试方法的新自定义命名规则，并允许它包含下划线。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-16T18:19:38.110

您可以使用[Agent Smith](http://www.agentsmithplugin.com/)来获得更精确的代码命名约定。

注意：最终 R# 4.5 的版本似乎还没有编译...但我相信它很快就会出现。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-26T06:13:49.680

无需删除规则。可以添加接受下划线的新规则

锐器 | 选项 -> 语言 -> 通用 -> 命名样式并将新规则添加到底部“用户定义的命名规则”

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-16T18:38:36.740

在菜单上：

锐器 | 选项 -> 语言 -> 通用 -> 命名样式：删除您想要的任何命名样式。他们应该有一个“禁用”功能，但他们没有。

# code-reuse - 具有通用代码的多个应用程序——如何解决这个问题？

> ID：757382
> 
> 赞同：4
> 
> 时间：2009-04-16T18:12:20.750
> 
> 标签：code-reuse

我的公司有两三个使用大量通用代码的 Web 应用程序——自定义 MVC 框架、实用程序类、JavaScript 库等等。

我们不希望在每个应用程序中复制所有这些代码，因为我们最终会使用几个略有不同的版本。但是我们不希望应用程序需要此代码的完全相同的副本，因为我们不希望对一个应用程序的更新可能会破坏另一个应用程序。

有没有人有任何关于处理这个问题的提示？我认为我不是在寻找技术答案——更多的是一种通用方法。

我们可以将代码制作成库，并允许应用程序保留在旧版本的库中，直到它们准备好升级。或者我们可以把它做成多个库，这样我们就不必一次升级所有东西。但是管理库版本之间的相互依赖会变得困难吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T18:15:11.913

我将 SVN 与 svn:externals 一起使用。你想要稳定的东西应该在标签文件夹中，这样依赖的项目就不会受到主干中其他开发的影响。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T18:57:15.383

我将为代表最新和最佳版本的通用代码创建一个源代码控制分支。

然后，对于每个项目，都有你自己独立的代码分支，你可以在需要的地方进行快速修复，或者在接近发布时保持稳定性。

您可能希望有一个 Wiki，其中列出了在公共代码中发现的错误，以便共享代码的其他用户知道它并有时间在闲暇时修复它。

Git 可以很好地解决这个问题，因为它擅长将更改合并回“主”分支。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T18:40:08.280

我用 svn:externals 支持 SVN。我们有一个共享一些代码的客户端和服务器。代码在服务器下维护（但可以移出到自己的仓库），客户端使用 svn:externals 将其拉入。客户端主干从服务器主干中拉出。但是，当我们分支（比如发布）时，我们会将外部拉入的内容固定在特定的转速、分支或标签上。如果你不这样做并且你回到旧分支并更新，你可能会得到共享代码的主干，这很可能不是你想要的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T18:16:07.900

这取决于很多很多因素——不同的语言在库方面有不同的行为。我通常处理这个问题的方法是让每个应用程序对其外部依赖项进行一系列测试，包括我编写的库，并使用它来防止对所述库的升级破坏应用程序。

有关您正在使用的平台的更多详细信息吗？可能有特定的工具可以帮助满足您的特定需求。

# javascript - 动作脚本 + JavaScript

> ID：757390
> 
> 赞同：1
> 
> 时间：2009-04-16T18:14:35.050
> 
> 标签：javascript, actionscript, flash

我想从嵌入式`.swf`文件中调用 JavaScript 函数。具体来说，我想在我的一个外部链接的 JavaScript 文件中调用一个函数：

```
function loadTrack(){

    //Radio Mode feature by nosferathoo, more info in: https://sourceforge.net/tracker/index.php?func=detail&aid=1341940&group_id=128363&atid=711474

    if (radio_mode && track_index == playlist_size - 1) {
        playlist_url=playlist_array[track_index].location;
        for (i=0;i<playlist_mc.track_count;++i) {
            removeMovieClip(playlist_mc.tracks_mc["track_"+i+"_mc"]);
        }
        playlist_mc.track_count=0;
        playlist_size=0;
        track_index=0;
        autoload=true;
        autoplay=true;
        loadPlaylist();
        return(0);
    }
    start_btn_mc.start_btn._visible = false;
    track_display_mc.display_txt.text = playlist_array[track_index].label;

    if (track_display_mc.display_txt._width > track_display_mc.mask_mc._width) {
        track_display_mc.onEnterFrame = scrollTitle;
    }else{
        track_display_mc.onEnterFrame = null;
        track_display_mc.display_txt._x = 0;
    }
    mysound.loadSound(playlist_array[track_index].location,true);
    play_mc.gotoAndStop(2)

    //info button
    if(playlist_array[track_index].info!=undefined){
        info_mc._visible = true;
        info_mc.info_btn.onPress = function(){
            getURL(playlist_array[track_index].info,"_blank")
        }
        info_mc.info_btn.onRollOver = function(){
            track_display_mc.display_txt.text = info_button_text;
        }
        info_mc.info_btn.onRollOut = function(){
            track_display_mc.display_txt.text = playlist_array[track_index].label;
        }
    }else{
        info_mc._visible = false;
    }
    resizeUI();
    _root.onEnterFrame=function(){
        //HACK doesnt need to set the volume at every enterframe
        mysound.setVolume(this.volume_level)
        var load_percent = (mysound.getBytesLoaded()/mysound.getBytesTotal())*100
        track_display_mc.loader_mc.load_bar_mc._xscale = load_percent;
        if(mysound.getBytesLoaded()==mysound.getBytesTotal()){
            //_root.onEnterFrame = null;
        }
    }
} 
```

它在一个 .as 文件中，我假设它以某种方式变成了 swf 文件。我将如何处理这个和`re-compile`文件`.as`？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-16T20:22:20.797

让我们使用 JS 注入和 ExternalInterface 为 AS2 和 AS3 编译这些答案（两种方式都适用于两种语言）

AS2：

```
 // to use javascript injection in a url request
getURL("javascript:displayPost(" + postId + "," + feedId +");", "_self");

// to use the external interface
import flash.external.ExternalInterface;
ExternalInterface.call("displayPost",postId,feedId); 
```

AS3：

```
 // to use javascript injection in a url request
navigateToURL(new URLRequest("javascript:displayPost(" + postId + "," + feedId +");"), "_self");

// to use the external interface
import flash.external.ExternalInterface;
ExternalInterface.call("displayPost",postId,feedId); 
```

请注意，在 AS2 和 AS3 中，ExternalInterface 方法完全相同（在 Flash 8 中为 AS2 引入了 ExternalInterface）。在 AS2 和 AS3 中，javascript 注入方法是相同的，只是它是 navigateToURL 而不是 getURL，并且 url 字符串被包裹在 new URLRequest() 中，因为它需要一个 URLRequest 对象。此外，在使用 javascript 注入时，最好将目标窗口设置为“_self”以避免打开新选项卡或窗口。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T18:55:04.827

此外，如果将来有人在看这个问题，那么 Actionscript 3 版本的 altCognito 的答案是这样的：

```
ExternalInterface.call("displayPost",postId,feedId); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T18:18:48.113

```
 getURL("javascript:displayPost(" + postId + "," + feedId +")"); 
```

从：

*   [http://www.klynch.com/archives/000079.html](http://www.klynch.com/archives/000079.html)

您还可以查看以下内容：

[http://osflash.org/projects/flashjs/tutorials/jstoas](http://osflash.org/projects/flashjs/tutorials/jstoas)

# jquery - 在 IE6 中，当我显示模式时，父页面的下拉列表在模型顶部可见

> ID：757394
> 
> 赞同：1
> 
> 时间：2009-04-16T18:15:29.493
> 
> 标签：jquery, drop-down-menu, popup, modal-dialog

在 IE6 中，当我显示模式时，父页面的下拉列表在模型顶部可见。

即父页面的下拉列表覆盖在模型弹出窗口上方。

在 Firefox 和 IE 7 中它很好（下拉列表就像它假设的那样隐藏在模型下方）。

有什么想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T18:18:03.730

IE 6 对此有问题。解决方法是在模态框后面放置一个 iframe，以阻止后面的内容显示。

有一个 jQuery 插件旨在解决这个特定问题。 [http://plugins.jquery.com/project/bgiframe](http://plugins.jquery.com/project/bgiframe)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-22T11:13:05.250

一个快速的解决方法是在您调用模式时隐藏所有下拉菜单，并在您关闭它时再次显示它们。

# assembly - 有哪些方法可以管理大型汇编语言项目？

> ID：757398
> 
> 赞同：7
> 
> 时间：2009-04-16T18:16:13.640
> 
> 标签：assembly, x86

在我的大学，汇编编程（x86 和 MIP）课程即将结束。

我非常喜欢我在装配方面的工作，我真的很想继续工作。你会认为必须自己做所有事情会很累，但我发现有一定程度的透明度，这是我用更高级别的语言所没有的。

事情通常会按照我的预期进行，因为我执行了机器代码以使它们发生。没有魔法。

然而，在学校里，我写的最长的汇编程序可能只有 2-3 页。

我最近读到过山车大亨是由一个开发人员[**在汇编中编写的。**](http://en.wikipedia.org/wiki/Roller_Coaster_Tycoon)[（来源：][[com.com](http://i.d.com.com/i/dl/media/dlimage/15/06/92/150692_large.jpeg)][）]
[![替代文字](https://i.stack.imgur.com/nkDNa.jpg)](https://i.stack.imgur.com/nkDNa.jpg)

我很难想象有人如何在装配中维护如此大的项目。

现在，我正在努力从 2-3 页的汇编程序飞跃到更大规模的程序。甚至在我的 Ti-83 计算器上，人们也已经在组装中编写了马里奥/塞尔达克隆体，这一定非常复杂！

必须有一些更好的工具、IDE 和方法来管理大型 x86 汇编项目，使其至少在某种程度上可维护。

这些是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-17T00:36:24.867

大型汇编程序的管理与任何其他程序一样 - 具有清晰接口的良好分区功能块。由于您在汇编中工作，因此您的接口将仅限于寄存器文件或堆栈上的内容。最终是在实际实施之前制定一个好的设计**计划。**您需要清楚地知道要写什么以及如何写。

话虽如此，如果您喜欢汇编，还有另一种方法可以让您在不实际编写汇编代码的情况下尽情享受激情——您可以用 C 或 C++ 编写代码，然后看看代码是如何编译为汇编的。然后，以不同的方式编写相同的内容，并了解它如何更改程序集。因此，您很快就能像编译器一样思考并编写高度优化的代码。

无论哪种方式，了解汇编中的工作方式最终将使您成为更好的程序员。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-17T00:37:38.170

宏、函数和库。从头开始开发自己的程序需要数年时间，因此请搜索 x86 汇编程序资源并依靠其他资源 - 许多人仍在为 PC 进行积极的汇编程序开发。

装配社区的一位活跃成员是史蒂夫吉布森，他有一大堆链接到这里装配编程的好资源：

[http://www.grc.com/smgassembly.htm](http://www.grc.com/smgassembly.htm)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-16T18:46:15.753

我知道的唯一一个完全用汇编语言编写的现代项目是[FASM](http://flatassembler.net)（我最喜欢的汇编程序）。

一些汇编器支持高级构造，如果宏引擎很好，您可以编写自己的。我个人觉得这没用；如果我想要高级构造并理解我的工作，我会使用 C 或 C++。（不过，我认为它们不是管理大型项目的好语言）。

我只是在需要或学习时使用汇编。

如果您想在汇编中编写项目，请记住：

*   可能不会有很多人愿意帮助您完成您的项目，即使他们觉得它很有趣。很少有人喜欢汇编，如果您希望有人理解它，您的代码必须得到很好的注释。
*   组装不是便携式的。即使从 32 位 PC 转移到 64 位，您基本上也必须重写所有内容。
*   “组装速度更快”的论点不再成立。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-24T22:04:33.857

在已经提到的之上，我应该提到[文学编程](http://en.wikipedia.org/wiki/Literate_programming)；我编写了一个大约 20KLOC 的 ARM 程序集的应用程序（不是很大，但也不是微不足道的），我发现使用[noweb](http://www.cs.tufts.edu/~nr/noweb/)构建代码非常有帮助。

这使我能够将代码分解成小的概念性片段，即使出于性能原因实际上必须将多个片段组合在一起/展开/等等。它还使其他程序员更容易理解我写的内容，尤其是我做出某些微妙决定的原因（例如，根据操作数的预期大小决定乘法中哪个操作数应该放在第一位）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-16T18:31:06.117

不是您问题的真正答案，但在许多现实世界的场景中，应用程序是使用高级语言编写的，使用该语言通用的习语，并且仅在需要性能或硬件需求时使用一点汇编语言。对于实际项目，这可能是唯一明智的方法，因为汇编语言不像其他语言那样高效，就让计算机每花费一小时进行更多的编程工作而言。

话虽如此，以任何其他语言管理项目的所有工具和技术都同样适用于汇编语言。源代码控制、TDD、项目规范、标识符的有意义的名称、关注点分离、面向对象的设计模式（您可以在没有面向对象的语言的情况下进行面向对象的设计）都同样适用于汇编语言，就像它适用于 C# 或 PHP

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-17T00:29:52.340

[这是 Peter Langston 的白皮书，](http://www.langston.com/Papers/vidgam.pdf)描述了他们用于编写 Ballblazer 和 Rescue from Fractalus 的工具和推理，其中涵盖了组织等。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-16T18:21:26.297

我认识使用汇编程序（不是英特尔）的人。他们构建了一个广泛的宏库，因此他们几乎可以像使用高级语言一样使用它。

要创建类似于宏库的东西，请从简单开始。通过将常用的结构分组到一个宏中。最终，您将能够创建更复杂的功能。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-16T18:35:43.393

我总是像用高级语言那样做。将其写入链接在一起以形成运行时的模块中。

# foxpro - 如何判断独享会不会在foxpro成功？

> ID：757406
> 
> 赞同：1
> 
> 时间：2009-04-16T18:19:00.110
> 
> 标签：foxpro

如果我试图在 FoxPro 中打开一个独占表，如果访问被拒绝，它会生成一个对话框。由于我的目标是非交互式应用程序，有没有办法检测操作是否会成功，或者至少让它静默失败？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T18:34:19.073

如果您有 VFP 8 或更高版本：

```
尝试
    使用 MyTable 0 独占
ENDTRY
...
如果使用（“我的表”）
    *-- 使用此处的表格
万一
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T19:39:17.577

对于旧版本：

```
cOldError = ON("ERROR")
ON ERROR *
USE MyTable IN 0 EXCLUSIVE
lSuccess = used("MyTable")
ON ERROR &cOldError

if lSuccess ... 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-04T16:58:50.710

我已经成功使用 FOPEN ......

```
nFHdl = FOPEN("myfile.dbf", 1)  &&  1 tries to open the file for writing
IF nFHdl > 0 THEN
   FCLOSE(nFHdl)
   USE myfile.dbf exclusive
ELSE
   = messagebox("Can't open Exclusive")
ENDIF 
```

# c# - C# UserControl.VerticalScroll.Value 未设置

> ID：757408
> 
> 赞同：6
> 
> 时间：2009-04-16T18:19:48.813
> 
> 标签：c#, winforms, controls

我有一大段 C# 代码应该在继承自 UserControl 的类中设置 VerticalScroll.Value。当类的任何子对象改变大小时，它会被调用。该类的 AutoScroll 属性设置为 true。

```
 public void ScrollTo(int top)
    {
        if (top >= this.VerticalScroll.Minimum && top <= this.VerticalScroll.Maximum)
        {
            this.VerticalScroll.Value = top;
        }
    } 
```

问题是，在跟踪代码时，有时 this.VerticalScroll.Value 会被设置，有时它会保留调用此方法之前的值。

这是 VS 中的错误，还是存在已知条件下该值将忽略设置它的尝试？

谢谢，罗伯

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-06-16T21:40:10.003

我遇到了同样的问题，并在一些开发论坛中找到了解决方案。设置 VerticalScroll.Value 后，您必须调用 PerformLayout() 来更新滚动控件。所以这样做：

```
scrollingcontrol.VerticalScroll.Value = top;
scrollingcontrol.PerformLayout(); 
```

这比设置 .Value 两次更有意义，尽管它似乎具有相同的效果。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-19T22:01:00.030

我遇到了同样的问题，我在 MSDN 网页上找到了解决方案（不会让我发布链接，因为我是新用户）。

建议的解决方案是分配给 .Value 两次，它对我有用：

```
int newVerticalScrollValue = 
         pDashboard.VerticalScroll.Value - pDashboard.VerticalScroll.SmallChange;

pDashboard.VerticalScroll.Value = newVerticalScrollValue;
pDashboard.VerticalScroll.Value = newVerticalScrollValue; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-07-29T15:47:11.770

FlowLayoutPanel 似乎是另一种野兽。滚动条确实向下移动，但 flowlayoutpanel.VerticalScroll.Value 的值仍然为 0。我尝试了上述所有技术以及一些 DoEvents() 和 Thread.Sleep()，甚至是在进行下一次迭代之前完全屈服的计时器。这一切都失败了。我最终发现 DisplayRectangle.Y 立即表达了滚动变化......

```
private void PrintButton_Click(object sender, EventArgs e)
{
    FlowLayoutPanel flp = TheBuildFlowLayoutPanel;
    List<Bitmap> printPics = new List<Bitmap>();
    int printLastY = 100;
    flp.VerticalScroll.Value = 0;
    while (flp.DisplayRectangle.Y < printLastY) // DisplayRect.Y becomes successively more negative
    {
        Bitmap bmp = new Bitmap(flp.Width, flp.Bounds.Height);
        printPics.Add(bmp);
        flp.DrawToBitmap(bmp, flp.ClientRectangle);
        printLastY = flp.DisplayRectangle.Y;
        flp.VerticalScroll.Value = Math.Min(flp.VerticalScroll.Maximum, flp.VerticalScroll.Value + flp.Height);
    }

    flp.VerticalScroll.Value = 0;
    for (int i = 0; i < printPics.Count; i++)
    {
        printPics[i].Save("C:\\Temp" + i.ToString() + ".bmp");
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-03-12T22:28:57.590

在我的情况下，有必要将 VerticalScroll.Value 设置为不同的值，然后设置为感兴趣的值，例如

```
this.panel1.VerticalScroll.Value = verticalScrollPosition - 1;
this.panel1.VerticalScroll.Value = verticalScrollPosition; 
```

注意滚动位置始终在 VerticalScroll.Minimum 和 VerticalScroll.Maximum 之间。

# error-correction - 如何使用汉明码更正消息

> ID：757409
> 
> 赞同：1
> 
> 时间：2009-04-16T18:20:57.640
> 
> 标签：error-correction, hamming-code

所以我想在这个暑期项目中使用汉明码纠正消息传输中的错误，但我无法弄清楚它是如何工作的。我在网上看了很多文章，但我对算法不是很了解。任何人都可以简单地解释一下吗？

谢谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-16T19:23:05.540

这都是关于[汉明距离](http://en.wikipedia.org/wiki/Hamming_distance)的。

两个以 2 为底的值之间的汉明距离是它们不同的位数。因此，如果您传输 A，但我收到 B，那么传输中必须切换的位数就是 A 和 B 之间的汉明距离。

当每个码字中的位以某种方式单独传输时，汉明码很有用。我们不在乎它们是串行的还是并行的，但它们不会例如组合成代表几个位的模拟值，或者在编码后压缩/加密。

因此，每个比特都是独立的（以某种固定的概率随机地），要么被正确接收，要么被翻转。假设传输相当可靠，大多数比特都被正确接收。因此，少量比特的错误更有可能发生，而同时出现大量比特的错误则不太可能发生。

因此，汉明码通常旨在纠正 1 位错误和/​​或检测 2 位错误（有关两种主要类型的详细信息，请参阅 Wikipedia 文章）。可以构建纠正/检测更大错误的代码，但 AFAIK 的使用并不多。

该代码通过在“汉明空间”中均匀地隔开代码点来工作，在数学术语中，汉明空间是由相关字长的所有值组成的度量空间，以汉明距离作为度量。想象一下，每个代码点都被一个无效值的小“缓冲区”包围。如果接收到的值不是代码点，则一定发生了错误，因为只传输了有效的代码点。

如果接收到缓冲区中的值，则*假设发生 1 位错误*，则传输的值与接收的值的距离必须为 1。但由于码点分散，只有一个码点接近。因此，它被“纠正”到该代码点，因为 1 位错误比任何其他代码点产生接收到的值所需的更大错误更有可能。在概率方面，假设我收到了我所做的值，您发送附近代码点的条件概率大于您发送任何其他代码点的条件概率。所以我猜你发送了附近的一个，基于传输的可靠性和每个字的位数有一定的信心。

如果接收到一个与两个代码点等距的无效值，那么我不能说一个比另一个更有可能是真实值。所以我检测到错误，但我无法纠正它。

显然 3 位错误不能由 SECDED 汉明码纠正。收到的值比您实际发送的值更远，而不是其他代码点，我错误地将其“更正”为错误的值。因此，您要么需要足够可靠的传输，以至于您不关心它们，要么您还需要更高级别的错误检测（例如，整个消息的 CRC）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T19:07:35.140

具体来自[维基百科](http://en.wikipedia.org/wiki/Hamming_Code)，算法如下：

1.  从 1 开始对位进行编号：位 1、2、3、4、5 等。
2.  以二进制形式写入位数。1、10、11、100、101 等
3.  所有为 2 的幂的位位置（在其位置的二进制形式中只有一个 1 位）都是奇偶校验位。
4.  所有其他位位置，在其位置的二进制形式中具有两个或多个 1 位，都是数据位。
5.  每个数据位都包含在一组唯一的 2 个或更多奇偶校验位中，由其位位置的二进制形式确定。
    1.  奇偶校验位 1 涵盖所有设置了最低有效位的位位置：位 1（奇偶校验位本身）、3、5、7、9 等。
    2.  奇偶校验位 2 涵盖了设置了第二个最低有效位的所有位位置：位 2（奇偶校验位本身）、3、6、7、10、11 等。
    3.  奇偶校验位 4 涵盖了设置了第三个最低有效位的所有位位置：位 4-7、12-15、20-23 等。
    4.  奇偶校验位 8 涵盖了设置了第四个最低有效位的所有位位置：位 8-15、24-31、40-47 等。
    5.  通常，每个奇偶校验位覆盖奇偶校验位置和位位置的二进制与非零的所有位。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T18:26:48.530

维基[百科文章](http://en.wikipedia.org/wiki/Hamming_Code)很好地解释了它。

如果您不了解算法的特定方面，那么您将需要重新表述（或详细说明）您的问题，以便有人可以解决您问题的特定部分。

# excel - Excel 对当前单元格的引用

> ID：757413
> 
> 赞同：76
> 
> 时间：2009-04-16T18:21:45.967
> 
> 标签：excel, worksheet-function

如何获取对当前单元格的引用？

例如，如果我想显示 A 列的宽度，我可以使用以下内容：

```
=CELL("width", A2) 
```

但是，我希望公式是这样的：

```
=CELL("width", THIS_CELL) 
```

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2014-08-13T16:38:24.343

迟了几年：

为了完整起见，我想再给出一个答案：

首先，转到*Excel-Options* -> *Formulas*并启用*R1C1 references*。然后使用

```
 =CELL("width", RC) 
```

`RC`总是指当前行、当前列，即“此单元格”。

[Rick Teachey 的解决方案](https://stackoverflow.com/a/22264393/2437514)基本上是一个调整，以使*A1 参考样式*中的相同成为可能（另请参阅[GSerg](https://stackoverflow.com/questions/757413/excel-reference-to-current-cell/25291631#comment569235_757420)对 Joey 的回答的评论，并注意[他](https://stackoverflow.com/questions/757413/excel-reference-to-current-cell/25291631#comment569230_757446)对 Patrick McDonald 的回答的评论）。

干杯
:-)

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2014-03-08T02:54:11.687

# Create a named formula called THIS_CELL

1.  In the current worksheet, select cell A1 (this is important!)

2.  Open `Name Manager` (Ctl+F3)

3.  Click `New...`

4.  Enter "THIS_CELL" (or just "THIS", which is my preference) into `Name:`

5.  Enter the following formula into `Refers to:`

    `=!A1`

    NOTE: *Be sure cell A1 is selected*. This formula is relative to the ActiveCell.

6.  Under `Scope:` select `Workbook`.

7.  Click `OK` and close the `Name Manager`

# Use the formula in the worksheet exactly as you wanted

```
=CELL("width",THIS_CELL) 
```

**EDIT:** Better solution than using `INDIRECT()`

It's worth noting that the solution I've given should be preferred over any solution using the `INDIRECT()` function for two reasons:

1.  It is nonvolatile, while `INDIRECT()` is a volatile Excel function, and as a result will dramatically slow down workbook calculation when it is used a lot.
2.  It is much simpler, and does not require converting an address (in the form of `ROW()` `COLUMN()`) to a range reference to an address and back to a range reference again.

**EDIT:** Also see [this question](https://stackoverflow.com/questions/22920090/excel-vba-worksheet-dependent-named-formula-named-range-result-changes-dependi) for more information on workbook-scoped, sheet dependent named ranges.

**EDIT:** Also see [@imix's answer](https://stackoverflow.com/a/25291631/2437514) below for a variation on this idea (using RC style references). In that case, you could use `=!RC` for the `THIS_CELL` named range formula, or just use `RC` directly.

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2009-04-16T18:27:39.947

你可以使用

```
=CELL("width", INDIRECT(ADDRESS(ROW(), COLUMN()))) 
```

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2012-04-11T11:43:42.540

`=ADDRESS(ROW(),COLUMN(),4)` 会给我们当前单元格的相对地址。 `=INDIRECT(ADDRESS(ROW(),COLUMN()-1,4))`将为我们提供当前单元格左侧的单元格 `=INDIRECT(ADDRESS(ROW()-1,COLUMN(),4))`内容 将为我们提供当前单元格上方单元格的内容（非常适合计算运行总数）

使用**CELL()**函数返回有关最后一个已更改单元格的信息。因此，如果我们输入新的行或列，**CELL()**引用将受到影响，并且不再是当前单元格的引用。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-04-16T18:23:46.010

`A2`已经是相对引用，并且会在您移动单元格或复制公式时发生变化。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2013-12-28T14:22:52.983

```
=ADDRESS(ROW(),COLUMN())
=ADDRESS(ROW(),COLUMN(),1)
=ADDRESS(ROW(),COLUMN(),2)
=ADDRESS(ROW(),COLUMN(),3)
=ADDRESS(ROW(),COLUMN(),4) 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2014-07-02T14:01:33.857

没有间接（）：`=CELL("width", OFFSET($A$1,ROW()-1,COLUMN()-1) )`

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-06-28T16:11:47.577

我发现（对我而言）处理此问题的最佳方法是使用以下内容：

```
Dim MyString as String
MyString = Application.ThisCell.Address
Range(MyString).Select 
```

希望这可以帮助。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-12-19T21:38:08.870

在表格中，您可以使用`[@]`（不幸的是）Excel 自动扩展到的表格，`Table1[@]`但它确实有效。（我使用的是 Excel 2010）

例如，当有两列时`[Change]`，`[Balance]`将其放入`[Balance]`列中：

```
=OFFSET([@], -1, 0) + [Change] 
```

当然请注意，这取决于行的顺序（就像大多数其他解决方案一样），所以它有点脆弱。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-06-27T19:31:56.720

有一种更好的方法更安全，不会减慢您的应用程序。Excel是如何设置的，一个单元格可以有一个值或一个公式；公式不能引用自己的单元格。你最终会出现一个无限循环，因为新值会导致另一个计算...... 使用辅助列根据您在另一个单元格中输入的内容计算值。例如：

A 列是 True 或 False，B 列包含货币值，C 列包含以下公式：=B1

现在，要计算只有当 A 列为真且 B 列大于零时，B 列才会以条件格式突出显示为黄色......

=AND(A1=真,C1>0)

然后您可以选择隐藏 C 列

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-11-20T18:06:52.567

完全归功于@rick-teachey 的最佳答案，但您可以扩展该方法以使用条件格式。为了使这个答案完整，我将以摘要形式复制 Rick 的答案，然后对其进行扩展：

1.  在任何工作表中选择单元格`A1`。
2.  创建一个名为的命名范围`THIS`并将其设置`Refers to:`为`=!A1`.

尝试`THIS`在条件格式公式中使用将导致错误：

```
You may not use references to other workbooks for Conditional Formatting criteria 
```

如果您想`THIS`使用条件格式公式：

3.  创建另一个名为的命名范围`THIS_CF`并将其设置`Refers to:`为`=THIS`.

您现在可以使用`THIS_CF`来引用条件格式公式中的当前单元格。

您还可以使用此方法创建其他相关的命名范围，例如`THIS_COLUMN`, `THIS_ROW`, `ROW_ABOVE`,`COLUMN_LEFT`等。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-09-15T14:40:03.113

编辑：以下是错误的，因为 Cell("width") 返回*最后修改单元格*的宽度。

`Cell("width")`返回当前单元格的宽度，因此您不需要对当前单元格的引用。但是，如果您需要一个，`cell("address")`则返回当前单元格的地址，因此如果您需要对当前单元格的引用，请使用`indirect(cell("address"))`. 请参阅文档：[http ://www.techonthenet.com/excel/formulas/cell.php](http://www.techonthenet.com/excel/formulas/cell.php)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-07-12T16:13:39.677

引用包含此公式的单元格（自引用）： **address(row();column())**

例如获取上面单元格的值： **indirect(address(row()-1;column()))**

或者OP问什么： **=Cell(width;address(row();column()))**

# c# - 如何通过 Windows Server 运行外部 .exe 文件

> ID：757417
> 
> 赞同：-1
> 
> 时间：2009-04-16T18:22:46.543
> 
> 标签：c#

如何通过 Windows Server 运行外部 .exe 文件？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T19:12:08.610

您需要提供更多信息以更好地帮助您。您在问我们如何启动应用程序并且您已将其标记为 c#，所以我假设您在问如何使用 c# 启动应用程序/进程。如果是这样，请检查以下链接

[进程类](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.aspx)，您可以使用它运行本地或远程进程。

# c++ - 我应该用 /MD 还是 /MT 编译？

> ID：757418
> 
> 赞同：142
> 
> 时间：2009-04-16T18:22:54.157
> 
> 标签：c++, visual-studio, msbuild, msvcrt, crt

在 Visual Studio 中，有编译标志 /MD 和 /MT 可让您选择所需的 C 运行时库。

我理解实现上的差异，但我仍然不确定使用哪一个。有什么优点/缺点？

我听说 /MD 的一个优点是，它允许某人更新运行时，（比如可能修补安全问题）并且我的应用程序将从这次更新中受益。尽管对我来说，这似乎是一个非功能：我不希望人们在不让我针对新版本进行测试的情况下更改我的运行时！

我很好奇的一些事情：

*   这将如何影响构建时间？（大概 /MT 有点慢？）
*   其他影响是什么？
*   大多数人使用哪一种？

* * *

## 回答 #1

> 赞同：96
> 
> 时间：2009-04-16T18:49:54.403

通过与 /MD 动态链接，

*   您会接触到系统更新（无论好坏），
*   您的可执行文件可以更小（因为它没有嵌入库），并且
*   我相信至少 DLL 的代码段在所有积极使用它的进程之间共享（减少消耗的 RAM 总量）。

我还发现，在实践中，当使用使用不同运行时选项构建的静态链接的 3rd 方仅二进制库时，主应用程序中的 /MT 往往比 /MD 更容易引起冲突（因为你如果 C 运行时被多次静态链接，特别是如果它们是不同的版本，则会遇到麻烦）。

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2009-09-04T07:11:58.447

如果您使用的是 DLL，那么您应该使用动态链接的 CRT (/MD)。

如果您为 .exe 和所有 .dll 使用动态 CRT，那么它们都将共享一个 CRT 实现——这意味着它们都将共享一个 CRT 堆，并且在一个 .exe/.dll 中分配的内存可以在其他。

如果您对 .exe 和所有 .dll 使用静态 CRT，那么它们都将获得 CRT 的单独副本 - 这意味着它们都将使用自己的 CRT 堆，因此必须在它所在的同一模块中释放内存被分配。您还将遭受代码膨胀（CRT 的多个副本）和过多的运行时开销（每个堆从操作系统分配内存以跟踪其状态，并且开销可能很明显）。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2009-04-16T18:28:13.567

我相信通过 Visual Studio 构建的项目的默认设置是 /MD。

如果您使用 /MT，您的可执行文件将不依赖于目标系统上存在的 DLL。如果您将它包装在安装程序中，它可能不会成为问题，您可以采用任何一种方式。

我自己使用 /MT，这样我就可以忽略整个 DLL 的混乱。

PS 正如[Fooz 先生所](https://stackoverflow.com/questions/757418/should-i-compile-with-md-or-mt/757537#757537)指出的，保持一致至关重要。如果您要与其他库链接，则需要使用与它们相同的选项。如果您使用第三方 DLL，几乎可以肯定您需要使用运行时库的 DLL 版本。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-04-16T18:59:20.497

我更喜欢用/MT 静态链接。

即使您确实使用 /MD 获得了一个较小的可执行文件，您仍然必须提供一堆 DLL 以确保用户获得正确的版本来运行您的程序。最后，您的安装程序将比与 /MT 链接时更大。

更糟糕的是，如果您选择将运行时库放在 windows 目录中，用户迟早会安装具有不同库的新应用程序，如果运气不好，会破坏您的应用程序。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-04-16T19:00:54.470

您在使用 /MD 时会遇到的问题是 CRT 的目标版本可能不在您的用户计算机上（尤其是如果您使用的是最新版本的 Visual Studio 并且用户的操作系统较旧）。

在这种情况下，您必须弄清楚如何将正确的版本安装到他们的机器上。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-04-16T18:33:38.013

来自[http://msdn.microsoft.com/en-us/library/2kzt1wy3(VS.71).aspx](http://msdn.microsoft.com/en-us/library/2kzt1wy3(VS.71).aspx)：

> /MT 定义 _MT 以便从标准头 (.h) 文件中选择运行时例程的多线程特定版本。此选项还会导致编译器将库名称 LIBCMT.lib 放入 .obj 文件中，以便链接器将使用 LIBCMT.lib 来解析外部符号。创建多线程程序需要 /MT 或 /MD（或它们的调试等效项 /MTd 或 /MDd）。
> 
> /MD 定义 _MT 和 _DLL 以便从标准 .h 文件中选择运行时例程的多线程和 DLL 特定版本。此选项还会导致编译器将库名称 MSVCRT.lib 放入 .obj 文件中。
> 
> 使用此选项编译的应用程序静态链接到 MSVCRT.lib。该库提供了一层代码，允许链接器解析外部引用。实际工作代码包含在 MSVCR71.DLL 中，必须在运行时对与 MSVCRT.lib 链接的应用程序可用。
> 
> 当 /MD 与定义的 _STATIC_CPPLIB (/D_STATIC_CPPLIB) 一起使用时，它将导致应用程序链接到静态多线程标准 C++ 库 (libcpmt.lib) 而不是动态版本 (msvcprt.lib)，同时仍通过动态链接到主 CRT msvcrt.lib。

因此，如果我正确解释它，则*/MT*静态链接和*/MD*动态链接。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-03-11T19:32:50.053

如果您正在构建使用其他 dll 或库的可执行文件，则首选 /MD 选项，因为这样所有组件都将共享同一个库。当然，这个选项应该匹配所有涉及的模块，即 dll/lib/exe。

如果您的可执行文件不使用任何 lib 或 dll，而不是任何人的调用。现在差异不是太大，因为共享方面没有发挥作用。

因此，也许您可​​以使用 /MT 启动应用程序，否则没有令人信服的理由，但是当需要添加 lib 或 dll 时，您可以使用 lib/dll 将其更改为 /MD，这很容易。

# database-design - 表中更新字段的首选方法是什么？

> ID：757421
> 
> 赞同：4
> 
> 时间：2009-04-16T18:23:46.370
> 
> 标签：database-design

只是想知道是否有在数据库中存储“更新者”类型字段的首选方法或最佳实践。我倾向于只看到经常存储的用户名，但我一直在使用上次更新该表的用户的 ID 来设计我的表。

有理由使用一种方法而不是另一种方法吗？我喜欢我有一个很好的反向引用来获取用户的方法......另一方面，它通常也意味着你永远不能删除用户（如果你也将它用于 Created By 无论如何）所以也许这有足够的理由不这样做？更不用说当一切都必须指向一张桌子时，图表或 ORM 映射看起来是多么混乱......

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T18:27:12.040

绝对存储一个 id 而不是名称。否则，如果有人出于某种原因想要更改其用户名，您会怎么做？

在大多数系统中，用户永远不应该被删除。只要有一个“活动”标志，或类似的东西。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T18:25:37.503

如果您有办法将更新绑定到由数据库中的实体表示的用户，请使用它。如果您没有这种机制（例如，数据库中没有用户），那么存储用户名就可以了。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-16T18:26:31.887

你的方法是正确的。您不想删除用户（而是使用“活动”位字段归档他们）。这样，即使该用户处于非活动状态，您仍然可以保留历史记录。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-16T18:39:44.193

使用用户 ID 而不是用户名，它占用的空间更少。不要从数据库中删除用户行，使用状态字段将它们标记为已删除。

# c# - 如何使用 .NET 从 FoxPro 备注字段中提取数据？

> ID：757422
> 
> 赞同：1
> 
> 时间：2009-04-16T18:23:54.263
> 
> 标签：c#, field, using, foxpro, memo

我正在编写一个 C# 程序以将 FoxPro 数据库放入数据表中，除了备注字段为空白或某些奇怪字符外，一切正常。我正在使用 C# .Net 2.0。我尝试了 Jonathan Demarks 于 1 月 12 日发布的代码。我能够获取索引，但我不知道如何使用该索引从备忘录文件中获取数据。

请帮帮我。

谢谢马杜

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-25T11:22:02.807

我创建了以下函数，将选择返回的对象转换为字节数组。

```
private byte[] ObjectToByteArray(Object obj)
{
    if (obj == null)
    {
        return null;
    }

    BinaryFormatter bf = new BinaryFormatter();
    MemoryStream ms = new MemoryStream();
    bf.Serialize(ms, obj);
    return ms.ToArray();
} 
```

然后您就可以显示该值。

```
byte [] dBytes = ConvertObjectToByteArray(dr["profile"]);
System.Text.ASCIIEncoding enc = new System.Text.ASCIIEncoding();
string str = enc.GetString(dBytes); 
```

您现在拥有 C# 本机字符串中的值，并且可以用它做任何您想做的事情。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T19:29:43.543

您是否尝试过使用[FoxPro OLEDB 提供程序](http://www.microsoft.com/downloads/details.aspx?familyid=E1A87D8F-2D58-491F-A0FA-95A3289C5FD4&displaylang=en)？如果数据库不使用 VFP8 或 9 引入的功能（特别是数据库事件），您也可以使用 ODBC 驱动程序。

这些通用字段是否包含文档或图像，或文本备忘录或二进制备忘录？您使用什么代码来提取数据？

# php - “公共静态”还是“静态公共”？

> ID：757424
> 
> 赞同：46
> 
> 时间：2009-04-16T18:24:05.730
> 
> 标签：php, oop, readability, public-method

关于 PHP 中函数声明关键字的一个小问题：如果您有一个静态的类方法，该关键字应该`static`在可见性关键字（`public`, `protected`, `private`）之前还是之后？假设您的所有方法，无论是静态方法还是其他方法，都有一个可见性关键字，那么您希望可见性关键字相对于关键字保持在同一位置`function`：

```
public function foo() {}

public function bar() {}

protected function baz() {}

private function quux() {} 
```

现在假设一对是静态的：

```
public function foo() {}

static public function bar() {}

protected function baz() {}

static private function quux() {} 
```

此外，如果一个方法是静态的，你希望它是第*一个*看到的，因为这对它是什么类型的方法的影响甚至比可见性关键字的影响更大。

这严格来说是一个可读性问题，因为它显然没有功能或设计后果。（我能想到的。）

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2014-08-29T05:38:54.823

来自 PSR-2：

> 必须在所有属性和方法上声明可见性；abstract 和 final 必须在可见性之前声明；static 必须在可见性之后声明。[[参考]](https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-2-coding-style-guide.md#1-overview)

...如果您关心 PHP 框架互操作组标准和约定。

所以`public static`不是`static public`根据他们。

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2009-04-16T18:25:40.873

~~Java 和 C# 等语言要求访问修饰符位于首位，因此~~ **编辑：**之前的划线是完全错误的。两种语言都没有这个要求。

* * *

```
public static 
```

对我来说看起来是正确的。可以为这两种方法提出论据，我的观点是：由于“静态”限定了函数而不是访问修饰符，因此说起来更有意义

```
<access_modifier> static 
```

如果你以相反的方式使用它，“静态”的含义就不太清楚了。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2012-04-01T16:48:57.510

继[阿列克谢·特尼茨基的回答之后](https://stackoverflow.com/a/1507818/205814)。

```
I prefer static public since this way 
it is easier to spot [usually rare] static methods in classes. 
```

所有方法都应该指定它们的可见性。所以，我们知道每个方法都会在定义中提到，唯一的问题是“它是哪个设置？”。

只有一些是静态的——所以，对于每一个，我们都必须问“定义中的某处是否提到了 static 关键字？”。所以，把静态放在第一位，让这个问题的答案更明显。

或者，作为更广泛的规则，…………我倾向于把“最非凡的方面”放在首位，这样我在阅读时就不会下意识地跳过一些东西。;o)

试试这个测试。

很快……A 类中有多少个静态方法？

```
class A {
 public static methodA() {
  }
 protected static methodB() {
  }
 private staticlymethodC() {
  } 
} 
```

B 类中有多少个静态方法？

```
class B {
 public methodA() {
  }
 static protected methodB() {
  }
 static private methodC() {
  } 
} 
```

我认为B类更容易快速理解。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-04-16T18:25:50.593

我不认为这是一个严格的 PHP 问题，而且对于它的价值来说，我一直更喜欢将可见性修饰符放在首位的一致性。我觉得扫描起来更容易。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-16T18:31:07.520

在我使用的每种具有类型修饰符的语言中，我都将可见性放​​在首位。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-10-02T05:11:43.673

我更喜欢`static public`这种方式，因为这样更容易在类中发现[通常很少见的]静态方法。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-17T17:33:58.413

您是正确的，因为它对代码没有影响。因此，这取决于您自己或您团队的风格要求，至于您所做的事情。与他们协商并就风格达成一致。

如果您只是为自己编码，那么您应该自己选择。选择并不重要，但一致性很重要。

您可能会问的另一个问题是：您是否应该使用“public”？为了向后兼容（PHP4 没有信息隐藏），任何没有可见性修饰符的东西默认都是公开的。如果它是公开的，你应该费心写公开吗？再次个人选择：无论哪种方式都提出强有力的论据，你会说服我你的选择是最好的。

就个人而言，当我整理并清理自己的代码时，我喜欢将可见性修饰符放在首位，即使它是公开的，也要指定它。

# git - git 推/拉超时

> ID：757432
> 
> 赞同：18
> 
> 时间：2009-04-16T18:25:31.170
> 
> 标签：git, timeout, firewall

我无法从我的公司 vpn git push/pull 到 github：

```
git push origin master
ssh: connect to host github.com port 22: Connection timed out
fatal: The remote end hung up unexpectedly 
```

我认为这是一个防火墙问题，如果我断开与 vpn 的连接，它就可以工作。我能做些什么来解决它吗？或者当我需要推/拉时，我是否卡在与 vpn 断开连接？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-16T18:32:35.317

不确定您使用的是哪种类型的 VPN，但这种影响通常是由于 VPN 设置通过 VPN 路由您的所有流量。您可以通过更新路由表以通过以太网（我假设）接口而不是通过 VPN 将流量路由回 github 来解决此问题。

例如`route add 65.74.177.129 eth0`，将通过 eth0 将流量路由到 github。这是 Linux 语法；Windows 也有一个大致相似的“路由”命令。

（这实际上并不是一个 git 特有的问题，实际上您应该能够通过尝试使用任何客户端（例如 telnet、nc 或 PuTTY）连接到 github.com 端口 22 来证明该问题：sshd 通常会打印一个横幅连接后立即显示其版本号）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-04-13T08:22:59.830

我遇到了完全相同的问题，为 github 添加路由也解决了我的问题。

windows（或在我的情况下为 cygwin）的命令是：`route add <ip> <gateway>`. 所以为我解决它的方法很简单：`route add 207.97.227.239 192.168.0.1`.

请注意与两年前 araqnid 相比，我使用的 github.com 的不同 IP。:)

如果您不确定您添加的路由在一段时间后是否仍然有效，只需键入（在 Windows 或 cygwin 上）`tracert github.com`以查看数据包的路由位置。如果第一个命中似乎位于您的公司内，则您添加的路线不再有效，您需要添加新路线。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-03-23T22:12:47.707

**Mac 用户：**我在安装更新版本的 OS X 后立即发生这种情况。在您深入了解更改网络设置之前，我建议您进行额外的重新启动。这为我纠正了这个问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-03-13T19:48:37.773

增加机器中的 ssh 连接超时。

创建 ~/.ssh/config 文件（如果它不存在）。

将 SSH ServerAliveInterval ServerAliveCountMax 设置添加到文件中，例如：

```
Host *
     ServerAliveInterval 86400
     ServerAliveCountMax 4 
```

通过 vpn 在 Ubuntu 18.04.4 LTS 上测试。

[在这里](https://confluence.atlassian.com/stashkb/git-ssh-push-timeout-on-large-changes-422020193.html)查看更多

# svn - 如何在 Subversion 托管文件名中转义 @ 字符？

> ID：757435
> 
> 赞同：192
> 
> 时间：2009-04-16T18:25:45.897
> 
> 标签：svn, escaping

对于许多 Subversion 操作，将“@”符号附加到文件或 URL 参数的末尾允许您定位该文件的特定版本。例如，“svn info test.txt@1234”将提供有关 test.txt 的信息，因为它存在于修订版 1234 中。

但是，当文件名包含 @ 时，Subversion 会错误地将其解释为修订说明符：

> svn info 'test@.txt' svn: 语法错误解析修订版 '.txt'

我尝试过双引号和单引号以及使用“/”、“\”和“@”转义。如何告诉 Subversion 将 @ 符号视为文件名的一部分？

* * *

## 回答 #1

> 赞同：284
> 
> 时间：2009-04-16T18:42:42.767

来自[SVN 书](http://svnbook.red-bean.com/en/1.5/svn.advanced.pegrevs.html)（强调添加）：

> 敏锐的读者此时可能想知道 peg 修订语法是否会导致工作副本路径或实际上具有 at 符号的 URL 出现问题。毕竟，*svn*是如何知道`news@11`我的目录树中的目录名还是“revision 11 of *news* ”的语法？值得庆幸的是，虽然*svn*总是假设后者，但有一个简单的解决方法。**您只需在路径末尾附加一个 at 符号**，例如`news@11@`. *svn*只关心参数中的最后一个 at 符号，并且在 at 符号之后省略文字 peg 修订说明符并不被认为是非法的。此解决方法甚至适用于以 at 符号结尾的路径——您可以使用`filename@@`谈论一个名为*filename@*的文件。

* * *

## 回答 #2

> 赞同：83
> 
> 时间：2011-02-21T22:19:10.773

最初的答案是正确的，但可能不够明确。特定的 unix 命令行选项如下：

```
svn info 'image@2x.png@' 
```

或者

```
svn info "image@2x.png@" 
```

或者

```
svn info image\@2x.png\@ 
```

我刚刚测试了所有三个。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2012-09-06T03:17:47.040

在不同子文件夹中添加多个文件的解决方案：

```
for file in $(find ./ -type f -name "*@*.png"); do svn add $file@; done 
```

只需将“ *@* .png”中的“png”替换为您要添加的文件类型即可。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2010-12-16T16:26:00.840

添加以下文件：image@2x.png 执行以下操作：svn add image\@2x.png@

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2017-07-25T20:17:47.217

只需添加

> @

在您需要使用的文件中，无论它是什么 SVN 命令，例如：

```
file@2x.jpg 
```

到

```
file@2x.jpg@ 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2011-09-22T23:37:47.120

就我而言，我需要从包含 @ 符号的 SVN 存储库中删除文件：

这行不通：

```
svn remove 'src/assets/images/hi_res/locales-usa@2x.png' 
```

但这确实：

```
svn remove 'src/assets/images/hi_res/locales-usa@2x.png@' 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2015-07-23T09:45:29.393

要添加多个文件，有替代解决方案：

```
svn status | grep \.png | awk '{print $2"@"}'| xargs svn add 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-02-20T10:44:28.543

**对于带有 2 个参数（如“move”）的 svn 命令，您必须仅**在左侧（第一个）参数处附加“@” 。例如：

```
$ svn add README@txt@
A         README@txt

$ svn move README@txt@ README2@txt
A         README2@txt
D         README@txt

$ svn status
A       README2@txt

$ svn commit -m "blah"
Adding         README2@txt
Transmitting file data .
Committed revision 168.

$ svn delete README2@txt@
D         README2@txt

$ svn commit -m "blahblah"
*Deleting       README2@txt

Committed revision 169. 
```

这一行很重要：**$ svn move README@txt@ README2@txt**

如您所见，我们不需要在“README2@txt”处附加“@”

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-08-26T09:22:39.607

@大卫H

我只是尝试了一个类似的命令而没有转义 @ 符号，它仍然可以正常工作

```
svn ci splash.png splash@2x.png@ 
```

这是在 GNU bash，版本 3.2.48(1)-release (x86_64-apple-darwin10.0) 和 svn 1.6.16

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-03-05T13:52:09.257

唯一对我有用的解决方案与@NPike 建议的相同

**svn revert '路径/到/文件名@ext@'**

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-04-19T10:32:49.947

我今天遇到了从电子邮件地址生成的文件名的问题（不是一个好主意！）。

解决方案，使用 `printf`的选项`find`和 shell 扩展

```
 svn add  $(find . -name "*@*.png" -printf "%p@ ") 
```

# c - 强制转换函数在 C 中实际上是如何工作的？

> ID：757445
> 
> 赞同：6
> 
> 时间：2009-04-16T18:27:23.507
> 
> 标签：c, pointers, function, casting, function-pointers

```
int foo(char *c)  {...}

main() {
     int (*thud)(void *);

     thud = (int (*)(void *))(foo);
} 
```

在评估作业期间实际发生了什么？

`foo`转换类型和;之间有区别 强制转换类型是一个*指针*并且`foo`是一个*函数*。那么，编译器是否将 ' `(foo)`' 中的内容转换为指向的指针，`foo`然后才进行强制转换？因为似乎没有其他任何意义；另一种选择是将函数*本身*转换为*指向获取 a*`void*`*并返回`int`*a 的函数的指针，据我所知，函数是内存中一段代码的标签，因此不能成为指针，即一个变量。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T18:31:52.077

在 C 中，绝对没有。它只是编译器胶水，以防止您做一些愚蠢的事情。在C 中，调用者负责维护堆栈帧，因此在调用函数时需要进行强制转换（即参数和返回值被压入堆栈）。这使得它是安全的（r），因为调用者的堆栈不太可能被不正确地改变。但是，在某些极少数情况下，被调用的函数仍然会弄乱调用者的堆栈。

我应该澄清分配复制了函数指针。但是在 C 中，所有函数指针都只是指针。类型和转换都是编译器胶水。

另一个澄清：标准规定（在 6.5.2.2 中）如果调用者使用不兼容的类型，则行为是未定义的。例如，将返回 void 的函数转换为返回 int 的函数，然后调用该函数，“返回”值是没有意义的。在调用之前将函数转换为兼容类型是个好主意，否则您可能会看到意外结果。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-16T18:32:27.877

当这样使用时，函数的名称是一个指针。这有点类似于数组的名称是指向其第一个元素的指针。

话虽如此，通过类型与函数的实际原型不同的指针调用函数（如您的示例所做的那样）是未定义的行为。不要这样做。

### 附录

> 如果转换后的指针用于调用类型与指向的类型不兼容的函数，则行为未定义。

来自C 标准的[第 6.3.2.3 节。](http://c0x.coding-guidelines.com/6.3.2.3.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T18:32:44.227

C 中的指针是一个地址，即存储在某个地方的数字。C 中的函数是某些代码的地址。这两个是一样的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-16T18:34:03.317

正确的术语是*衰变*。函数`foo`衰减为指向强制转换`foo`之前的指针。在我能想到的所有平台上，演员阵容本身都将是无操作的。

但是请注意，包含这种类型转换的程序的行为在 C 标准中是未定义的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-16T19:35:23.623

这将是对 Rick C. Petty 的回答的评论 - 但它不适合 300 个字符。

C 标准不是很严格——指向对象的指针（和函数不是对象）可以转换为“指向 void 的指针”并返回没有问题。POSIX 要求指向函数的指针大小相同，并且可以转换为指向 void 的指针。

## POSIX 2008 - 一般信息 - 编译环境

### 2.12.3 指针类型

> 所有函数指针类型都应具有与指向 void 的类型指针相同的表示。将函数指针转换为 void * 不应改变表示。这种转换产生的 void * 值可以使用显式转换转换回原始函数指针类型，而不会丢失信息。
> 
> 注意：ISO C 标准不要求这样做，但它是 POSIX 一致性所必需的。

# java - 在运行时重新加载 JTree

> ID：757447
> 
> 赞同：0
> 
> 时间：2009-04-16T18:27:57.530
> 
> 标签：java, swing, awt, jtree

我在与 GUI 类分开的类中创建了一个 JTree 并为其建模。JTree 的数据是从文件中提取的。

现在在 GUI 类中，用户可以将文件从文件系统添加到 AWT 列表。用户单击列表中的文件后，我希望 JTree 更新。JTree 的变量名称是 schemaTree。

我有选择列表中的项目的以下代码：

```
private void schemaListItemStateChanged(java.awt.event.ItemEvent evt) {
        int selection = schemaList.getSelectedIndex();
        File selectedFile = schemas.get(selection);
        long fileSize = selectedFile.length();
        fileInfoLabel.setText("Size: " + fileSize + " bytes");

        schemaParser = new XSDParser(selectedFile.getAbsolutePath());

        TreeModel model = schemaParser.generateTreeModel();
        schemaTree.setModel(model);
} 
```

我已经更新了代码以对应于接受的答案。JTree 现在根据我在列表中选择的文件正确更新。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T18:53:59.260

来自[`Component.add`](http://java.sun.com/javase/6/docs/api/java/awt/Container.html#add(java.awt.Component))API 文档。

> 注意：如果组件已添加到已显示的容器中，则必须在该容器上调用 validate 以显示新组件。如果要添加多个组件，您可以通过在添加所有组件后仅调用一次 validate 来提高效率。

您调用`repaint`了`validate`一个未显示的组件，它不会生效。您需要`mainPanel`在`add`. 也`revalidate`往往比`validate`它有效地合并更好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T13:27:55.120

我不确定我是否理解您的问题，但我会尝试...

正确的做法应该是，恕我直言：

*   获取文件
*   从您的文件创建一个新的 TreeModel
*   将模型提供给 JTree

在伪代码中，它看起来像这样：

```
File newContent = getSelectedByUser(...);
TreeModel newModel = new MyFileBasedTreeModel(newContent);
//this next part must be done in the EventDispatcherThread
myTree.setModel(newModel); 
```

然后 JTree 将被更新，而无需任何重绘等调用。

希望能帮助到你

# javascript - IE中window.name的范围是什么？

> ID：757450
> 
> 赞同：1
> 
> 时间：2009-04-16T18:29:20.833
> 
> 标签：javascript, internet-explorer, scope

我们的产品同时具有 winforms 和 Web 客户端，并为用户提供了一种启动另一个公司资产（Web 应用程序）的方法。我们需要确保用户在浏览器中只打开了另一个 Web 应用程序的一个实例（或者至少*我们已经*为它们打开了）。我们通过执行以下操作完成了这个（某种程度上）......

在 winforms 客户端中，我们有一个隐藏的 WebBrowser 控件，当用户单击按钮启动另一个应用程序时，我们将一个小的 HTML 页面写入 DocumentText 属性，其中包含：

```
window.open('http://othersiteurl', '**sitename**').focus(); 
```

在我们的 Web 客户端中，当用户单击同一个按钮时，我们会执行类似的操作：

```
window.open('http://othersiteurl', '**sitename**'); 
```

仅从一个客户或另一个客户来看，效果出奇的好。当您尝试从两个客户端访问它时，事情变得棘手和奇怪。如果您首先从 winforms 应用程序启动另一个产品，它会启动一个新窗口，然后从任一客户端启动该产品的任何后续都会加载到已打开的实例中。但是如果你反过来做，从 web 客户端开始，第一个实例会在同一个窗口的新选项卡中启动，*但是每次从 winforms 客户端启动都会进入一个新窗口！*

我在两个客户端中对 window.open 的“名称”参数使用相同的值。看到它的工作方式如此可怕地不同，真是太奇怪了。谁能解释一下 'name' 参数在 IE 中的作用域？（是的，这是 IE-only...WebBrowser 控件承载 IE，而我们的产品是 IE-only）首先从 winforms 客户端启动时，它似乎对所有打开的实例都是全局的，但反过来使它看起来恰恰相反。

有任何想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-19T06:57:17.040

你试过 window.createPopup 吗？不知道它是否会更好，但如果您不需要“镀铬”，它可能值得一试。有关更多信息，请查看 MSDN： http: [//msdn.microsoft.com/en-us/library/ms537638 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms537638(VS.85).aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T20:51:15.653

在 IE7 和之前的版本中，据我所知，名称参数的范围仅限于 IE 进程的特定实例。通常，手动启动 IE 会创建一个新进程。通过 js 创建的任何窗口，甚至单击 IE 中的“新窗口”按钮，都会创建一个仍在当前进程下运行的新窗口。在这种情况下，名称在这些窗口的范围内。

当您有一个桌面应用程序以您提到的方式生成一个实例时，它会在一个新进程下打开。根据框架（.NET 等），它可能会在拥有第一个句柄后重用该进程，或者它可能为每个调用创建一个新进程。听起来，从您的初始测试来看，第一种情况是应用程序将重用该过程。

话虽如此，我不确定您可能需要实施什么样的流程来检查“跨流程”的名称。一种选择，取决于您对他们正在访问的 Web 应用程序的控制类型，可能是让服务器跟踪用户到会话 ID 的列表，并且当第二个条目显示给用户时，这意味着他们有第二个浏览器打开，并从那里适当地处理。

# asp.net - 您正在使用哪些身份验证和授权方案 - 为什么？

> ID：757452
> 
> 赞同：39
> 
> 时间：2009-04-16T18:30:05.217
> 
> 标签：asp.net, authentication, asp.net-membership, authorization, azman

我们开始设计一大堆要创建的新服务（WCF、ADO.NET 数据服务，可能在某个时候在云中），弹出的一个问题是使用什么身份验证和授权方案 - 有很多很少！

我们基本上需要能够识别各种协议（HTTP、HTTPS、TCP）上的用户（实际人员和“虚拟”应用程序/服务用户），并且我们需要为他们分配至少一堆角色/权限查看某些数据和/或执行某些操作。

我们绝对不能单独使用 Windows 组成员资格 - 我们有大量服务的外部消费者，我们不希望必须在我们的内部域中为每个人设置域帐户。

所以我认为主要有三个选择：

1.  使用 ASP.NET 成员系统 - 在那里创建用户并分配角色
2.  使用 AzMan（授权管理器），它似乎是一个更细粒度、更成熟、更精细的系统（具有用户、任务、组 - 三个级别，而不仅仅是用户 + 角色）
3.  滚动我们自己的

首先 - 你会推荐这三个中的哪一个？有什么理由吗？

其次 - 我还有更多的选择吗？

感谢您的任何提示，指针，意见！

马克

PS：看到到目前为止的答案，我对投票给选项#3 的人数之多感到惊讶。我原以为 MS 能够设计出可以处理所有这些要求的可重复使用的东西......

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-16T19:14:11.803

实际上，答案可能是 1 和 3 的组合。

如果默认选项没有达到您想要的程度，您可以通过编写[成员资格](http://msdn.microsoft.com/en-us/library/f1kyba5e.aspx)、[角色](http://msdn.microsoft.com/en-us/library/f1kyba5e.aspx)或[个人资料](http://msdn.microsoft.com/en-us/library/0580x1f5.aspx)提供者来利用框架为您提供的许多工具和功能。

我们已经在许多客户网站上做到了这一点 - 例如，我们的一个客户将他们的大部分用户存储为 Commerce Server 用户，并使用 Commerce Server 配置文件系统，因此我们编写了一个会员和配置文件提供程序来与这些用户交谈数据存储 - 一个相当简单的练习。

* * *

大多数人可能会选择 3，因为需要通过原始 TCP 进行身份验证——这引入了一个超出标准**ASP.NET**成员资格提供程序的层。

MS 生产的大部分产品都是“好的”或“足够好”，但总会有一些极端情况，你想做一些“不太标准”的事情，这意味着你最终会自己动手。我猜想除了“基本身份验证”或“Windows 身份验证”之外，您的普通开发人员很容易理解，他们选择了“让我们为网络构建这个”的明智选择。

如果您看一下可以针对 WCF 服务进行身份验证的多种方法，您就会明白我的意思——这些**方法**旨在处理不同的传输机制，因此要复杂得多。

也就是说，默认角色和配置文件提供者相当有限（角色：没有层次结构，因此您需要检查每个可能的角色，或将每个角色显式分配给用户；配置文件：所有存储在一个字段中作为逗号分隔值 - 不是很容易找到所有设置了值的用户）。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-16T18:42:48.133

我们使用（3）。实际上，这有助于我们在整合环境中拥有同步的帐户

1.  业务流程
2.  其他系统（并非都在同一个技术栈 (ASP.NET) 上）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-16T20:41:38.457

在最近的一个项目中，我们扩展了 ASP.NET 成员资格提供程序（编写了一个自定义提供程序），目的是使用一些基于角色的控件来管理权限。现在该项目已经足够成熟，我们发现控制不够灵活，无法满足我们的要求，并且在某种程度上我们对走 MS 会员资格的道路感到遗憾。如果您有时间正确构建身份验证，则滚动您自己的身份验证将是最佳选择。

听起来您的应用程序有点混合，因为您正在为内部和外部客户提供服务，但也许还要考虑为您的外部客户集成[OpenID](http://openid.net/)。有一些很棒的 ASP.NET OpenID 控件可以真正让为外部客户处理新帐户变得轻而易举。这当然取决于您的应用程序的“公开”程度。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T18:38:44.023

[有人](http://www.openldap.org/)吗？它是免费的，跨平台的，易于远程使用和管理，具有与其他身份验证方案的桥梁，以及您知道存在的更多语言的绑定......

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-16T18:44:05.243

AZMan 不是 2003 年的吗？

我会推荐 1 或 3。就我个人而言，我一直选择 3。1 有很多我不使用或不打算使用的功能。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-16T18:46:15.707

我会远离阿兹曼。我们曾经走过那条路，不喜欢我们所在的城镇区域。我们总是使用基于 AD 的登录，使用当前用户的 SID 链接到数据库中的用户，然后获取权限从那里。鉴于您的设置，这可能是不可能的（或实际的），但无论如何我都会远离 AzMan。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-16T18:58:33.697

我不是 ASP 或 .NET 开发人员，但我的直觉告诉我 (3)。您真的不希望公共使用的网络应用程序可以访问您的公司网络，更不用说能够将身份验证凭据放在 AD 附近的任何地方。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-16T19:01:19.477

您似乎提供了太多且太可扩展而无法坚持一种技术解决方案

解决方案 3。

我将围绕用户类建立整个应用程序您只需对其进行建模，以便为您提供所需的灵活性和可扩展性

就像是：

```
 [ClassAttribute ( "Yordan Georgiev", "1.0.2", "20090302", "20090415" , false )]
public class User
{
    #region DomainName
    private string _DomainName;
    public string DomainName
    {
        get { return _DomainName; }
        set { _DomainName = value; }
    } //eof property DomainName 

    #endregion DomainName

    #region Status
    private int _Status;
    public int Status
    {
        get { return _Status; }
        set { _Status = value; }
    } //eof property Status 

    #endregion Status

#region Password
    private string _Password = Resources.GV.Pass; 
    public string Password
    {
        get { return _Password; }
        set {
            _Password = GenApp.Utils.Security.Encryptor.Encrypt ( value,
                GenApp.Conf.GenAppSettings.Instance.EncryptionAlgorithm );
            //debug_Password = value; //unencrypted 
        }
    } //eof property Password 

    #endregion Password 

#region ListUserRoles
        private List<UserRole> _ListUserRoles;
        public List<UserRole> ListUserRoles { get { return _ListUserRoles; } set     { _ListUserRoles = value; } }
        #endregion ListUserRoles

    #region UserSettings
    private GenApp.Conf.UserSettings _UserSettings;
    public GenApp.Conf.UserSettings UserSettings
    {
        get {
            if (_UserSettings == null)
                _UserSettings = (GenApp.Conf.UserSettings)GenApp.Conf.GenAppSettings.Instance;

            return _UserSettings; 
        }
        set { _UserSettings = value; }
    } //eof property UserSettings 
```

}

# windows - 相对文件路径

> ID：757455
> 
> 赞同：0
> 
> 时间：2009-04-16T18:30:53.840
> 
> 标签：windows, ruby, file-io, exe, shoes

我正在尝试使用类似这样的东西从几个文件中读取

```
IO.foreach("TeamFields.txt") { |line| fieldNames.push(line.chomp) } 
```

从命令行运行时它工作正常，但是当我用鞋子打包到 .exe 并运行它时找不到文件。有没有办法指定相对于 .exe 的路径，还是我必须提供完整的文件路径（例如“c:\files\TeamFields.txt”）？谢谢您的帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T18:45:40.577

这是因为您的可执行文件未使用正确的当前目录运行。

修复当前目录（例如在快捷方式中）或修改 Ruby 程序以自动将工作目录设置为程序目录：

```
Dir.chdir(File.dirname($PROGRAM_NAME)) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T18:38:54.680

您需要在相对之前正确设置“当前应用程序目录”。用户可以使用不同的启动目录执行您的应用程序，或者系统可以使用不同的目录调用您的应用程序。

如果有问题的文件在您的应用程序的文件夹中，您唯一需要做的就是获取该文件夹并将其设置为最新。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T18:39:08.360

我没有用 ruby​​ 编程，但我用 windows 编程，而且相对路径很可能基于 .exe 文件的位置。

所以，是的，您最好传递文件名的完整路径。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T18:41:39.853

该常量`__FILE__`将包含当前执行文件的完整路径。然后，您可以使用 File 类的方法去除文件名，为您想要的包中的任何其他文件附加相对路径并解析结果。

# c# - 如何使这个 linq 高效

> ID：757458
> 
> 赞同：1
> 
> 时间：2009-04-16T18:31:39.080
> 
> 标签：c#, linq

我有这个代码片段，我们从 COM Dll 获取集合

```
 public BOCollection SelectedObjects{
get
{
    IMSICDPInterfacesLib.IJMonikerElements oIJMonikerElements;
    oIJMonikerElements = m_oIJSelectSet.Elements as IMSICDPInterfacesLib.IJMonikerElements;
    BOCollection oBusinessObjects = new BOCollection(oIJMonikerElements);
    return oBusinessObjects;
} 
```

}

现在 BOCollection 确实实现了 IEnumerable。所以最好改成

```
public IEnumerable<BusinessObject> SelectedObjects 
```

为了获得迭代器的好处？还是有其他方法？

谢谢苏尼特

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T18:52:32.180

您是否要返回 IEnumerable 以便延迟执行？首先，你不会想在房产中这样做，因为我相信 FxCop 会为此对你大喊大叫。以下是我建议您更改的方法，以便您可以从延迟执行和 LINQ 中受益。

将 m_oIJSelectSet.Elements 属性更改为返回 IEnumerable 的方法，如下所示：

```
public IEnumerable<IJMonikeElements> GetElements() {
    // Do some magic here to determine which elements are selected
    return (from e in this.allElements where e.IsSelected select e).AsEnumerable();

//  This could also be a complicated loop
//  while (someCondition()) {
//      bool isSelected = false;
//      var item = this.allItems[i++];

        // Complicated logic determine if item is selected
//      if (isSelected) {
//          yield return item;
//      }
    }
}

public IEnumerable<BusinessObject> GetSelectedObjects() {
    return m_oIJSelectSet.GetElements().Cast<BusinessObject>();
} 
```

现在，您将拥有完整的延迟执行和 LINQ 支持。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T18:35:25.250

如果 BOCollection 实现了 IEnumerable，那么您已经获得了迭代器的优点。只需将其放入 for 或 foreach 循环中即可。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T18:35:53.220

问题`IEnumerable<T>`是肯定的，它会给你“Linq goodness”，但是 Linq goodness 的最低公分母。最好返回`IList<T>`甚至`IQueryable<T>`（如果你能做到这一点）。

例如，如果有人想要获取第 4 个元素，`IEnumerable<T>`那么如果您已经将对象存储在数组或列表中，则没有任何意义。

要从`IQueryable<T>`中获得`List<T>`：

```
IQueryable<int> query = list.AsQueryable(); 
```

# c++ - 为什么 auto_ptr 构造不能使用 = 语法

> ID：757465
> 
> 赞同：9
> 
> 时间：2009-04-16T18:32:48.313
> 
> 标签：c++, gcc, stl, auto-ptr

我遇到了一个对我来说没有多大意义的编译器错误：

```
#include <memory>
using namespace std;

auto_ptr<Table> table = db->query("select * from t"); 
```

错误：请求从“表*”转换为非标量类型“std::auto_ptr<表>”

但是，以下行确实有效：

```
auto_ptr<Table> table(db->query("select * from t")); 
```

构造函数的这个定义阻止它按我预期工作的原因是什么？我认为初始化声明使用了构造函数。

这是我`auto_ptr`的构造函数（来自 SGI STL）：

```
explicit
auto_ptr(element_type* __p = 0) throw() : _M_ptr(__p) { } 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-16T18:38:33.557

这是“显式”关键字。

```
template <typename T>
struct foo
{
  explicit foo(T const *)
  {
  }
};

template <typename T>
struct bar
{
  bar(T const *)
  {
  }
};

int main(int argc, char **argv)
{
  int a;
  foo<int> f = &a; // doesn't work
  bar<int> b = &a; // works
} 
```

“explicit”关键字防止构造函数用于隐式类型转换。考虑以下两个函数原型：

```
void baz(foo<int> const &);
void quux(bar<int> const &); 
```

使用这些定义，尝试使用 int 指针调用这两个函数：

```
baz(&a);  // fails
quux(&a); // succeeds 
```

在 quux 的情况下，您的 int 指针被隐式转换为条形。

**编辑：**要扩展其他人的评论，请考虑以下（相当愚蠢的）代码：

```
void bar(std::auto_ptr<int>);

int main(int argc, char **argv)
{
  bar(new int()); // probably what you want.

  int a;
  bar(&a); // ouch. auto_ptr would try to delete a at the end of the
           // parameter's scope

  int * b = new int();
  bar(b);
  *b = 42; // more subtle version of the above.
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-16T18:35:48.820

你需要使用

```
auto_ptr<Table> table = auto_ptr<Table>(db->query("select * from t")); 
```

auto_ptr 没有为其模板类型定义赋值运算符。唯一允许的赋值来自另一个 auto_ptr（它的构造函数来自指针是显式的）。这样做是为了防止意外误用 auto_ptr，因为 auto_ptr 假定拥有内存。

我的猜测是，您需要分配表单才能使用多个查询，例如：

```
// initialize using constructor
auto_ptr<Table> table(db->query("select * from t1"));
...
// new query using assignment
table = auto_ptr<Table>(db->query("select * from t2"));
...
// another query using assignment
table = auto_ptr<Table>(db->query("select * from t3")); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-16T19:01:12.613

构造函数被声明为显式，这意味着它不会用于隐式类型转换。隐式转换为 auto_ptr 很容易导致不良情况，因为 auto_ptr 正在获取指针的所有权。

例如，如果 auto_ptr 允许从指针进行隐式转换，并且您不小心将指针传递给采用 auto_ptr 的方法，则该指针将被静默转换为 auto_ptr 并随后在函数结束时被删除，即使这不是本意。但是通过将构造函数标记为显式转换不能再静默发生，并且通过调用构造函数，您可以清楚地表达将所有权传递给 auto_ptr 的意图，从而避免任何潜在的混淆。

```
void fun(std::auto_ptr<Foo> foo) // Assume implicit conversion is allowed.
{
    // do stuff with foo
}

Foo *foo = new Foo();

f(foo); // Normally this isn't allowed.

foo->bar(); // Oops 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-16T18:39:28.780

补充一下lothar 所说的：因为`auto_ptr`构造函数是用`explicit`关键字声明的，所以您需要使用显式转换来`auto_ptr`从原始指针创建一个。（在引入 之前`explicit`，隐式转换是许多新的和有经验的 C++ 开发人员的祸根。）

# python - Perl 和 Python 之间正则表达式行为的区别？

> ID：757476
> 
> 赞同：3
> 
> 时间：2009-04-16T18:35:40.210
> 
> 标签：python, regex, perl

我有几个电子邮件地址，`'support@company.com'`并且`'1234567@tickets.company.com'`.

在 perl 中，我可以使用`To:`原始电子邮件的行并找到上述任一地址

```
/\w+@(tickets\.)?company\.com/i 
```

在 python 中，我只是简单地编写了上面的正则表达式，`'\w+@(tickets\.)?company\.com'`期望得到相同的结果。但是，`support@company.com`根本找不到，第二个 findall 返回一个仅包含`'tickets.'`. 很明显这`'(tickets\.)?'`是问题区域，但是我缺少的 Perl 和 Python 之间的正则表达式规则到底有什么区别？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-16T18:46:12.133

的文档`re.findall`：

> ```
> findall(pattern, string, flags=0)
>     Return a list of all non-overlapping matches in the string.
> 
>     If one or more groups are present in the pattern, return a
>     list of groups; this will be a list of tuples if the pattern
>     has more than one group.
> 
>     Empty matches are included in the result. 
> ```

因为`(tickets\.)`是一个组，`findall`所以返回它而不是整个匹配。如果您想要整个匹配，请在整个模式周围放置一个组和/或使用非分组匹配，即

```
r'(\w+@(tickets\.)?company\.com)'
r'\w+@(?:tickets\.)?company\.com' 
```

请注意，您必须选择`findall`在第一种情况下返回的每个元组的第一个元素。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T18:45:10.047

我认为问题在于您对提取值的期望。尝试在您当前的 Python 代码中使用它：

```
'(\w+@(?:tickets\.)?company\.com)' 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T18:42:40.787

两个问题突然出现在我身上：

1.  您需要使用原始字符串以避免转义“ `\`”
2.  你需要逃跑“ `.`”

所以试试：

```
r'\w+@(tickets\.)?company\.com' 
```

编辑

样本输出：

```
>>> import re
>>> exp = re.compile(r'\w+@(tickets\.)?company\.com')
>>> bool(exp.match("s@company.com"))
True
>>> bool(exp.match("1234567@tickets.company.com"))
True 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T18:52:00.980

正则表达式没有区别，但是您要查找的内容有所不同。您的正则表达式仅在两个正则表达式中都存在时才会捕获`"tickets."`。你可能想要这样的东西

```
#!/usr/bin/python

import re

regex = re.compile("(\w+@(?:tickets\.)?company\.com)");

a = [
    "foo@company.com", 
    "foo@tickets.company.com", 
    "foo@ticketsacompany.com",
    "foo@compant.org"
];

for string in a:
    print regex.findall(string) 
```

# c - “由于数据类型范围有限，比较总是正确的”C中的警告？

> ID：757482
> 
> 赞同：9
> 
> 时间：2009-04-16T18:36:30.050
> 
> 标签：c, gcc, cell, warnings

我有以下代码

```
//Point.h
#define WIDTH 8
#define HEIGHT 8

typedef struct Point
{
  char x;
  char y;
} Point;

//Board.c
#include <stdbool.h>

// Some other functions that we don't care about... 

bool inBounds(Point * p)
{
  return p->x >= 0
    && p->x <= WIDTH
    && p->y >= 0
    && p->y <= HEIGHT;
} 
```

当我编译这个（ppu-gcc 4.1.1）时，我收到以下警告

```
warning: comparison is always true due to limited range of data type 
```

即使 char 的范围是 -127 到 127 并且 WIDTH 是 8，这完全在 char 的范围内。我已经尝试将 WIDTH 显式转换为 char，但仍然出现错误。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-16T18:42:36.480

你确定`char`是签名的？尝试将字段明确声明为`signed char`，看看你得到了什么。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T18:47:21.273

我猜`x >= 0`会导致警告，因为`char`可能被实现为`unsigned char`.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-16T18:54:33.457

`char`类型可以是有符号或无符号的。这取决于您的编译器供应商的选择。甚至可能有一个可用的编译器选项。显然，`char`对你来说是无符号的，所以它总是大于或等于零，因此编译器会警告你。

您在`char`这里使用来表示“占用最少内存的数字类型”。在这种情况下，我建议明确使用`signed char`or `unsigned char`。`char`（尽管`char`必须签名或未签名，但每个都与 plain 不同。）`char`为您保存字符数据时保留。对于数值数据，请使用其他两种类型之一。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T18:43:03.343

嗯......默认情况下你的char不是无符号的吗？在这种情况下，范围为 0-255，这意味着您的 >=0 比较将始终为真

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-04-07T22:27:13.773

C 和 C++ 标准允许字符类型 char 有符号或无符号，具体取决于平台和编译器。大多数系统，包括 x86 GNU/Linux 和 Microsoft Windows，都使用有符号字符，但基于 PowerPC 和 ARM 处理器的系统通常使用无符号字符。(29) 当在具有不同类型默认值的平台之间移植程序时，这可能会导致意外结果的字符。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-04-10T16:57:00.220

试试这个：

```
typedef struct Point
{
  signed char x;
  signed char y;
} Point; 
```

# iphone - 用于图像的 SQLITE Blob 或文件系统

> ID：757493
> 
> 赞同：6
> 
> 时间：2009-04-16T18:38:53.697
> 
> 标签：iphone, sqlite, filesystems

我正在构建一个基于带有文本列的单个表的应用程序。有时，相邻的列会有图像。将此图像存储为 SQLITE 中的 BLOB 是否更好，或者我应该将它们存储在文件系统中并从我的程序中引用它们。谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T18:48:51.067

从长远来看，文件会给您带来更少的问题。您真的不想从数据库服务器提供大量文件，尤其是在您扩展时

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-17T12:10:11.487

Assuming the images you are going to use are not extremely large and there is not an exorbitant number of them I would go with the database.

I am currently using a Sqlite database on several different Windows Mobile and WinCE devices with over 10,000 small images stored as blobs and it is working great.

I have seen software similar to ours running on the same hardware using file based image loading and it was significantly slower. Of course this was on WinCE and different software, so that is not the best test.

I find the single database is much easier to work with than many image files.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T18:43:06.823

**编辑：**

没有意识到您专门针对 iPhone 环境。在那种情况下，我会使用数据库只是为了将所有内容放在一个地方的简单性。您不必担心可扩展性，因为它不像您的 iphone 将用作服务器或任何东西。

**原始回复：**

我没有任何链接来支持这一点，但我确实记得在几项研究中读到“截止”是 1 MB 以提高 blob 效率。但这可以通过足够快的磁盘阵列移动到 10 MB。完全取决于系统。

因此，基本上，考虑到您的效率截止，任何小于该值的数据都将由数据库更好地提供服务，任何更大的数据，只需在数据库中建立索引并保留在文件缓存中即可。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-16T19:27:12.583

我喜欢将图像保存在文件系统中，因为 UIImage 可以缓存图像文件并在必要时自动从内存中转储它们。请注意不要更改或删除加载到 UIImage 中的图像文件，否则您将遇到崩溃或其他奇怪的错误。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-16T18:48:14.640

这实际上取决于您的应用程序。将图像存储在数据库中将使您的生活更轻松，因为您可以在一个点上轻松访问它们，而不是将它们放在可能丢失的单独文件中。另一方面，对于 SQLITE 数据库来说，许多相当大的图像可能证明太多了。在您的情况下，我只会在数据库中引用它们。

# .net - Linq to Entity Vs。表适配器（.Net Windows 窗体）

> ID：757500
> 
> 赞同：0
> 
> 时间：2009-04-16T18:40:37.653
> 
> 标签：.net, winforms, linq-to-entities, dataset, tableadapter

我开始着手开发一个广泛使用可编辑网格的小型 Windows 窗体项目。我想使用 Linq to Entities，但是虽然将网格绑定到 Linq 查询很简单，但它是只读的。我想不出一个好方法来拥有一个自动更新数据库的可编辑网格。（我破解了一个解决方法，我将数据复制到数据集中以进行显示/更新并翻译回来......丑陋！）

所以现在我决定忘记 Linq to Entities 并使用 2.0 中的旧表适配器/数据集方法。

我应该使用 Linq to Entities 是否有令人信服的理由？有没有办法做我刚刚错过的可编辑网格？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T18:53:37.390

您可以将查询返回的实体集合绑定到控件，这将允许编辑绑定的实体。可能您应该`BindingSource`在集合和控件之间插入一个，但这取决于。如果您调用`SaveChanges()`对象上下文，则更改将持久保存到数据库中。因此，与实体框架的数据绑定绝对有效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-19T17:56:56.787

找到解决方案：使用 lambda 表达式过滤实体，然后直接绑定到实体。效果很好。

# mysql - 将 Web 服务器与数据库和 J2ME 连接

> ID：757503
> 
> 赞同：3
> 
> 时间：2009-04-16T18:41:07.827
> 
> 标签：mysql, web-services, java-me

我做了一个移动应用程序，用户可以使用它来获取所需地点的号码。用户必须选择适当的城市和类别才能获得该地点的信息。所有信息都存储在数据库中。

我想知道的..

1) Web 服务有什么好处？

2) 如何连接网络服务和MySQl 数据库？

3) 如何连接网络服务和移动应用程序以从数据库中获取信息？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T08:25:52.687

1) 好处。您没有提到其他选项，但是如果您正在谈论一些自定义服务器端实现，则好处很多：

1.  从 J2ME 连接到 Web 服务很容易。
2.  一次连接多个会话。
3.  您可以使用来自不同应用程序和不同技术的 Web 服务。
4.  身份验证和授权没有问题。
5.  您只需从 ws 调用方法，作为响应，您将获得易于解析的 XML。

* * *

2）网络服务——MySQL：

1.  您必须创建 Tomcat 或 IIS Web 服务。
2.  从 Web 服务代码连接到 MySQL，调用查询并返回结果。

对于 Tomcat 和 Java Web 服务：

[使用 Apache Axis 开始使用 Web 服务 使用](http://www.javaranch.com/journal/2002/05/axis.html) [Apache Tomcat 上的 MySQL 和 Windows 上的 Axis 开发和部署 Java Web 服务](http://www.bengoodger.com/software/webservices/webservices.html) [JDBC for MySQL](http://css.tacoma.washington.edu/~lab/Support/HowToUse/UsingJDBCWithMySQL.html)

对于 IIS 和 C#/.NET Web 服务： [CodeProject:Your first C# Web Service by Chris Maunder](http://www.codeproject.com/KB/webservices/myservice.aspx) [如何连接到 MySQL 5.0。通过 C# .NET 和 MySQL 连接器/网络](http://bitdaddys.com/MySQL-ConnectorNet.html)

* * *

3) J2ME - Web 服务（使用 JAX-RPC） 1\. 使用 J2ME Wireless Toolkit 从 Web 服务 WDDL 生成存根 2\. 将存根添加到项目中，导入存根命名空间，设置连接属性并调用存根方法 [如何构建和运行 J2ME Web 服务应用程序？](http://www.cs.wichita.edu/~chang/lecture/cs898t/program/how-j2me-webservice.html) [J2ME 的 Web 服务 API，第 1 部分：远程服务调用 API](http://www.ibm.com/developerworks/wireless/library/wi-jsr/)

# ruby-on-rails - Rails 中同一个类的多个关联的最佳实践？

> ID：757512
> 
> 赞同：5
> 
> 时间：2009-04-16T18:42:51.033
> 
> 标签：ruby-on-rails, ruby, activerecord

我认为我的问题最好作为一个例子来描述。假设我有一个名为“Thing”的简单模型，它有一些简单数据类型的属性。就像是...

```
Thing
   - foo:string
   - goo:string
   - bar:int 
```

这并不难。db 表将包含具有这三个属性的三列，我可以使用@thing.foo 或@thing.bar 之类的内容访问它们。

但我要解决的问题是，当“foo”或“goo”不再包含在简单数据类型中时会发生什么？假设 foo 和 goo 代表相同类型的对象。也就是说，它们都是“Whazit”的实例，只是具有不同的数据。所以现在事情可能看起来像这样......

```
Thing
  - bar:int 
```

但是现在有一种叫做“Whazit”的新模型看起来像这样……

```
Whazit
  - content:string
  - value:int
  - thing_id:int 
```

到目前为止，这一切都很好。现在这是我卡住的地方。如果我有@thing，我如何设置它以按名称引用我的 2 个 Whazit 实例（为了记录，“业务规则”是任何事物总是有 2 个 Whazit）？也就是说，我需要知道我拥有的 Whazit 基本上是 foo 还是 goo。显然，我不能在当前设置中执行@thing.foo，但我希望这是理想的。

我最初的想法是为 Whazit 添加一个“名称”属性，这样我就可以获得与我的 @thing 关联的 Whatzits，然后通过这种方式选择我想要的 Whazit。不过这看起来很丑。

有没有更好的办法？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-16T19:41:47.040

有几种方法可以做到这一点。首先，您可以设置两个`belongs_to`/`has_one`关系：

```
things
  - bar:int
  - foo_id:int
  - goo_id:int

whazits
  - content:string
  - value:int

class Thing < ActiveRecord::Base
  belongs_to :foo, :class_name => "whazit"
  belongs_to :goo, :class_name => "whazit"
end

class Whazit < ActiveRecord::Base
  has_one :foo_owner, class_name => "thing", foreign_key => "foo_id"
  has_one :goo_owner, class_name => "thing", foreign_key => "goo_id"

  # Perhaps some before save logic to make sure that either foo_owner
  # or goo_owner are non-nil, but not both.
end 
```

另一个更简洁但在处理插件等时也更痛苦的选项是单表继承。在这种情况下，您有两个类，Foo 和 Goo，但它们都保存在 whazits 表中，并带有一个区分它们的类型列。

```
things
  - bar:int

whazits
  - content:string
  - value:int
  - thing_id:int
  - type:string

class Thing < ActiveRecord::Base
  belongs_to :foo
  belongs_to :goo
end

class Whazit < ActiveRecord::Base
  # .. whatever methods they have in common ..
end

class Foo < Whazit
  has_one :thing
end

class Goo < Whazit
  has_one :thing
end 
```

在这两种情况下，您都可以执行 和 之类`@thing.foo`的操作`@thing.goo`。使用第一种方法，您需要执行以下操作：

```
@thing.foo = Whazit.new 
```

而使用第二种方法，您可以执行以下操作：

```
@thing.foo = Foo.new 
```

不过，STI 也有其自身的一系列问题，尤其是在您使用较旧的插件和 gem 的情况下。通常，`@object.class`当他们真正想要的是`@object.base_class`. 必要时很容易修补。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T21:04:21.973

添加“名称”的简单解决方案不需要丑陋：

```
class Thing < ActiveRecord::Base
  has_one :foo, :class_name => "whazit", :conditions => { :name => "foo" }
  has_one :goo, :class_name => "whazit", :conditions => { :name => "goo" }
end 
```

事实上，它与 STI 的工作方式非常相似，只是您不需要单独的类。

唯一需要注意的是在关联 whazit 时设置此名称。这可以很简单：

```
def foo=(assoc)
  assos.name = 'foo'
  super(assoc)
end 
```

# jquery - 扩展一个 jQuery 插件

> ID：757515
> 
> 赞同：13
> 
> 时间：2009-04-16T18:43:24.590
> 
> 标签：jquery

有人扩展了现有的 jQuery 插件吗？

我不确定从哪里开始。我宁愿不实际复制和修改我希望扩展的插件。我是通过原型还是只是对相关插件的扩展调用来做到这一点？

还是我梦想这样做会有意义？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-16T19:27:53.500

编辑：正如 Seb 所指出的，这并不是严格意义上的“扩展”插件的例子，更多的是“封装”一个插件，所以顺其自然吧:)

这是我不久前为简化对[jquery 自动完成插件](http://bassistance.de/jquery-plugins/jquery-plugin-autocomplete/)的使用所做的一些事情：

```
// small autocomplete plugin wrapping the full autocomplete plugin for a standard look and feel
(function($) {
    $.fn.standardAutocomplete = function(type) {
        return this.autocomplete(ToAbsoluteUrl("~/System/Autocomplete/" + type), {
            formatItem: formatItem,
            formatResult: formatResult
        });
        // Autocomplete formatting callbacks
        function formatItem(row) { return row[0] + "<span class=\"sub\">" + row[1] + "</span>"; }
        function formatResult(row) { return row[0].replace(/(<.+?>)/gi, ''); }
    }
})(jQuery); 
```

现在这不是遵循“按书本”的 jquery 编码实践 - 例如，我没有考虑可能选择多个元素的事实，但在这种情况下，我知道我永远不会在页面上选择多个元素有了这个，我想保持简单，它“对我有用”。您也许可以使用类似的方法，也许更复杂一点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T19:09:52.187

如果插件做得很好，那么除了使用它的[选项](http://docs.jquery.com/Types#Options)来改变它的行为之外，你别无选择。

这样做的目的是把它的所有代码都封装起来，不干扰其他代码，所以你不能在里面注入任何代码。

如果你真的需要改变它的行为，那么我想你需要复制和粘贴代码。

# sharepoint - Sharepoint - 尝试将任务字段的值纳入工作流程

> ID：757519
> 
> 赞同：0
> 
> 时间：2009-04-16T18:45:21.357
> 
> 标签：sharepoint, workflow

我正在制作一个共享点状态机工作流程。第一种状态具有“创建具有内容类型的任务”作为任务。内容类型有一个名为“isApproved”的字段。我没有使用任何信息路径表格。我正在尝试获取该字段的值来评估文档是否被批准。无论我做什么，我都会得到“对象未设置为对象的实例”。

我已经尝试了以下所有方法：

```
createTaskWithContentType1_TaskProperties1.ExtendedProperties["isApproved"].ToString();
onTaskChanged1_AfterProperties1.ExtendedProperties["isApproved"].ToString(); 
onTaskChanged1.AfterProperties1.ExtendedProperties["isApproved"].ToString(); 
```

我究竟做错了什么？？？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T19:53:32.580

我曾经遇到过类似的问题，我必须获取字段 ID 才能访问该字段。我是这样做的：

```
Guid isApprovedFieldId = worflowProperties.TaskList.Fields["isApproved"].Id;  
string approvalStatus = (string)(onTaskChanged1_AfterProperties1.ExtendedProperties[isApprovedFieldId]); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-02T14:46:26.523

我知道这个答案来得太晚了，但我想很多人都看过这个帖子......

“isApproved”字段是 msft 在示例工作流中通常使用的 infopath 任务表单的功能。此字段在基本内容类型任务中肯定不可用，这些任务实际上只是简单的 SharePoint 任务表单，与 InfoPath 和“isApproved”字段完全无关。您需要做的是获取任务的 afterprops，查询“状态”字段并确定用户是否完成了任务。如果您向名为“已批准”的任务添加了另一列，则使用 taskItem["fieldName"] 方法而不是 [Extended Properties] 查询该字段。

希望这对某人有帮助！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-11-19T19:27:25.027

艾伦，

除了Abs所说的。我还建议您在获取其 ID 之前检查该字段是否实际存在。像这样...

```
if (worflowProperties.TaskList.Fields["isApproved"] != null)
{
   Guid isApprovedFieldId = worflowProperties.TaskList.Fields["isApproved"].Id;  
   string approvalStatus = (string)(onTaskChanged1_AfterProperties1.ExtendedProperties[isApprovedFieldId]);
} 
```

# python - 外壳：在模式上方两行插入一个空白/新行

> ID：757532
> 
> 赞同：6
> 
> 时间：2009-04-16T18:48:13.610
> 
> 标签：python, perl, text, sed, awk

要在与您的正则表达式匹配的每一行上方添加一个空行，您可以使用：

```
sed '/regexp/{x;p;x;}' 
```

但是我想添加一个空行，而不是上面的*一行*，而是在与我的正则表达式匹配的行之上的*两行。*

我将匹配的模式是地址行中的邮政编码。

以下是文本格式的片段：

> 随机信息（属于以前的商家）
> 商家名称
> 商家地址

例如：

> 所讲语言：英语
> Arnold's Cove, Nfld (sub To Clarenville)
> Nile Road, Arnolds Cove, NL, A0B1N0

我想在商家名称上方添加一个新行：

> 语言：英语
> 
> Arnold's Cove, Nfld (sub To Clarenville)
> Nile Road, Arnolds Cove, NL, A0B1N0

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-16T20:55:45.863

更具可读性的 Perl，并能妥善处理多个文件。

```
#!/usr/bin/env perl
use constant LINES => 2;
my @buffer = ();
while (<>) {
    /pattern/ and unshift @buffer, "\n";
    push @buffer, $_;
    print splice @buffer, 0, -LINES;
}
continue {
    if (eof(ARGV)) {
        print @buffer;
        @buffer = ();
    }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-16T21:18:18.633

有点像您在 sed 中的原始方法：

```
sed '/regexp/i\

$H
x' 
```

基本思想是打印延迟一行的所有内容（**x**更改保持和模式空间 - 打印是隐式的）。这需要完成，因为在我们检查下一行是否与正则表达式匹配之前，我们不知道是否插入**换行符**。

（ $H 只是打印最后一行的技巧。它将最后一行附加到保持缓冲区中，以便最终的隐式打印命令也输出它。）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-17T10:41:04.727

简单的：

```
sed '1{x;d};$H;/regexp/{x;s/^/\n/;b};x' 
```

形容它

```
#!/bin/sed

# trick is juggling previous and current line in hold and pattern space

1 {         # at firs line
  x         # place first line to hold space
  d         # skip to end and avoid printing
}
$H          # append last line to hold space to force print
/regexp/ {  # regexp found (in current line - pattern space)
  x         # swap previous and current line between hold and pattern space
  s/^/\n/   # prepend line break before previous line
  b         # jump at end of script which cause print previous line
}
x           # if regexp does not match just swap previous and current line to print previous one 
```

**编辑**：稍微简单一点的版本。

```
sed '$H;/regexp/{x;s/^/\n/;b};x;1d' 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-16T20:47:56.023

```
perl -ne 'END{print @x} push@x,$_; if(@x>2){splice @x,1,0,"\n" if /[[:alpha:]]\d[[:alpha:]]\s?\d[[:alpha:]]\d/;print splice @x,0,-2}' 
```

如果我将您的文件放入其中，我会得到您想要的...它很丑陋，但是您想要外壳（即单衬里）:-) 如果我要使用完整的 perl 来执行此操作，我将能够清理使它变得可读性很多。:-)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-16T20:36:18.140

这是一种适用于 Python 的方法。

```
import sys
def address_change( aFile ):
    address= []
    for line in aFile:
        if regex.match( line ):
            # end of the address
            print address[0]
            print 
            print address[1:]
            print line
            address= []
         else:
            address.append( line )
address_change( sys.stdin ) 
```

这使您可以根据自己的喜好重新格式化完整的地址。`Address`如果您的格式复杂，您可以扩展它以创建定义类。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T18:55:30.647

我试过

```
sed '/regexp/a\\n' 
```

但它插入了两个换行符。如果那不打扰您，请接受。

> 回声 -e "a\nb\nc" | sed '/^a$/a\n'
> a
> 
> b
> c

**编辑：** 既然您声明需要在匹配的正则表达式上方插入两行，则建议的正则表达式将不起作用。

我什至不确定它是否适用于 sed，因为您需要记住过去的行。听起来像是 python 或 perl 等高级语言的工作:-)

# visual-studio - 我的 VS 2008 工具箱上的标签 #13119 是什么？

> ID：757535
> 
> 赞同：6
> 
> 时间：2009-04-16T18:49:12.220
> 
> 标签：visual-studio, telerik

我昨晚才注意到这一点，因为我已经有一段时间没有在这个特定项目上使用工具箱了。突然间，我以前在自己的选项卡上的所有 Telerik 控件都不见了，而这个神秘的空选项卡 #13119 就在那里。我为 Telerik 添加了一个新选项卡并添加了所有控件，但 Telerik 选项卡仍然不可见，尽管控件仍被勾选以表明它们在工具箱中。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-16T18:53:28.310

这似乎是一个错误。

[从这里](http://zinovate.com/weblog/archive/2009/01/16/38234.aspx)引用：

> 1.  确保您可以看到盒子上的所有文件夹。我们正在前往隐藏文件的领域：（在工具 --> 文件夹选项下）
> 2.  如果 Visual Studio 已打开，请关闭它。
> 3.  转到此处：C:\Users\YOUR_USER_NAME\AppData\Local\Microsoft\VisualStudio\9.0\
> 4.  将以下文件备份到临时文件夹中以确保安全并删除原始文件。(toolboxIndex_reset.tbd,toolboxIndex.tbd,toolbox_reset.tbd,toolbox.tbd)
> 5.  重新启动 Visual Studio，将重新创建文件。工具箱需要几秒钟才能重新填充。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T18:52:32.133

也许这有帮助：[工具箱缺少控件](http://social.msdn.microsoft.com/forums/en-US/vssetup/thread/490c9f52-f0c3-4fd3-9770-b8be9e0fd9d9/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T18:55:41.317

我一次又一次地得到这个。尝试右键单击工具箱并选择“重置工具箱”

# asp.net - 将即时消息集成到 ASP.NET 应用程序中

> ID：757536
> 
> 赞同：3
> 
> 时间：2009-04-16T18:49:45.777
> 
> 标签：asp.net, instant-messaging

我正在考虑将一些即时消息功能集成到现有的 ASP.NET Web 应用程序中，例如：

*   Web 应用程序可以显示用户的在线状态（他们当前是否使用他们的 IM 客户端登录）
*   用户可以从 Web 应用程序向其他用户的 IM 客户端发送消息
*   用户可以从 Web 应用程序发起 IM 聊天（无需事先知道其他用户的 IM 标识）

有谁知道一些现有的库、示例应用程序或其他可能有助于实现此类功能的资源？

非常感谢您分享您的知识。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T18:57:50.280

你应该试试[Jabber](http://code.google.com/p/jabber-net/)。[演示](http://jwchat.org/)客户端可在此处获得。

[有](http://webta.net/docs/ajax-instant-messenger.html)一个架构概述，主要概念如下所示：

[![替代文字](https://i.stack.imgur.com/kvkaK.png)](https://i.stack.imgur.com/kvkaK.png)
[（来源：[webta.net](http://webta.net/docs/Drawing1.png)）]

以及来自该网站的一些引用：

*   **1\. 目标** 创建一个基于 AJAX 的多服务即时消息 Web 应用程序，具有内部记帐功能。
*   **2.主要问题** 我们需要从HTTP客户端（浏览器）连接到IM服务器。HTTP 是一种无状态协议。这意味着，理论上，每个 HTTP 请求都由单独的 http 守护进程处理。一旦请求被处理（数据发送到客户端），服务器就会忘记客户端。所有 IM 服务协议都是有状态的。当客户端连接到 IM 服务器时，正在创建套接字连接并且连接保持打开状态以进行成功通信。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T18:59:27.860

ASP.net 站点上有一个列表。

[http://www.asp.net/Community/Control-gallery/browse.aspx?category=54](http://www.asp.net/Community/Control-gallery/browse.aspx?category=54)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T18:57:09.020

您可能想查看 jabber 的 .net 实现：

> [http://code.google.com/p/jabber-net/](http://code.google.com/p/jabber-net/)

# nhibernate - 流畅的 NHibernate 组件映射 - 传递给工厂的字符串 DB 值产生所需的对象类型

> ID：757542
> 
> 赞同：0
> 
> 时间：2009-04-16T18:53:06.813
> 
> 标签：nhibernate, fluent-nhibernate

桌子：

```
CREATE TABLE Instrument
(   Id              INT IDENTITY
,   Name            VARCHAR(50)
,   Tenor           VARCHAR(10)
//... 
```

模型：

```
 interface ITenor
    {
        int Length { get; }
        string ToString();
    }

    class DayTenor : ITenor
    {
        public int Length
        {
            get { return 1; }
        }

        public override string ToString()
        {
            return "DAY";
        }
    }

    class MonthTenor : ITenor
    {
        public int Length
        {
            get { return 30; }
        }

        public override string ToString()
        {
            return "MONTH";
        }
    }

    class TenorFactory
    {
        ITenor GetTenor(string tenorString)
        {
            switch (tenorString)
            {
                case "DAY":
                    return new DayTenor();
                    break;
                case "MONTH":
                    return new MonthTenor();
                    break;
                default:
                    throw new NotImplementedException(string.Format( "Tenor {0} is not implemented", tenorString ));
            }
        }
    }

    class Instrument
    {
        public int Id { get; set; }
        public string Name { get; set; }
        public ITenor Tenor { get; set; }
    }

    class InstrumentMap : ClassMap<Instrument>
    {
        public InstrumentMap()
        {
            WithTable( "Instrument" );
            Id( x => x.Id );
            Map( x => x.Name );
            Map( x => x.Tenor );
        }
    } 
```

这是对问题域的极大简化。

该行`Map( x => x.Tenor );`显然不起作用，因为您不能将 VARCHAR 列隐式转换为 ITenor 类型。有没有一种方法可以映射以自动使用工厂来获取数据库中指定字符串所需的 ITenor，并使用 ITenor 类中的 ToString() 恢复到数据库？

如果不是，您会建议进行哪些重构以使其可行？非常感谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T19:22:09.363

一种可能的解决方案是将字符串保留在数据库中，并将其映射到 TenorString 属性。然后添加另一个类型化属性，它只是在字符串和类型化值之间进行转换：

```
class Instrument
{
    public string TenorString { get; set; }
    public ITenor Tenor { 
        get { return GetTenor(this.TenorString); } 
        set { TenorString = value.ToString() }; 
    }
} 
```

TenorString 被正常映射，但 Tenor 属性根本没有被映射：

```
Map( x => x.TenorString ); 
```

当然， Tenor get 属性可以返回一个缓存值，当 TenorString 更改时会重置该缓存值，以避免每次都进行工厂调用。

# c - C 到 IEC 61131-3 IL 编译器

> ID：757543
> 
> 赞同：4
> 
> 时间：2009-04-16T18:53:23.147
> 
> 标签：c, compiler-construction, plc, iec61131-3

我需要将一些现有的 C 代码移植到符合[IEC 61131-3](http://en.wikipedia.org/wiki/IEC_61131-3)的PLC。

我有一些将代码拆分为离散功能块并将这些块编织成标准解决方案（梯形图、FB、结构化文本等）的选项。但这需要分割 C 代码以构建每个功能块。

在查看 IEC 规范时，我意识到[IEC 指令列表](http://en.wikipedia.org/wiki/Instruction_list)表单可能是编译器的目标语言。维基百科文章列出了两种开发工具：

1.  [CoDeSys](http://www.3s-software.com/)
2.  [贝雷米兹](http://www.beremiz.org/)

但这些似乎是针对将 IEC 语言编译为 C，而不是 C 编译为 IEC。

另一种可能的解决方案是通过 C 到 Pascal 转换器推送 C 代码，并将其用作[结构化文本](http://en.wikipedia.org/wiki/Structured_text)解决方案的起点。

如果不是其中任何一个，我将沿着将代码拆分为功能块的路线。

**编辑**

正如mlieson 的回复所提示的，我应该提到C 代码是一个现有的实时控制系统。所以程序算法应该已经适合 PLC 环境。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-10-15T12:25:32.470

也许这个答案来得太晚了，但由于有一个外部库，可以从 CoDeSys 调用 C 代码。

[您可以在http://forum-en.3s-software.com/viewtopic.php?t=620](http://forum-en.3s-software.com/viewtopic.php?t=620)的 CoDeSys 论坛上找到文档

这将使您可以在稍作修改的情况下将 C 代码用于 PLC。您只需定义功能或功能块接口。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T22:58:13.293

我的猜测是，C 到 Pascal 的翻译器不会让你离得足够近，不值得麻烦。结构化文本看起来很像 Pascal，但您需要在各处修复差异。

不是错误问题，但不要忘记 PLC 的运行时环境有点不同。AC 应用程序从 main() 开始，并在 main() 返回时结束。PLC 一遍又一遍地调用它 main()，每秒 100:s 次，它永远不会结束。通常冗长的计算和 I/O 需要以不同于 C 应用程序使用的方式进行编码。

除非您的 C 源代码是数千行代码 - 重写它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-08-17T17:04:34.333

是不可能的。简而言之：IL 语言是一种 4GL（即仅限于域，以及其他 IEC 61131-3 语言——ST、FBD、LD、SFC）。C语言是3GL。

为了理解这个问题，试着回答这个问题，用指针在 IL 操作中表达的方式是什么？例如，通过指针来表达调用函数。中断怎么办？对外围设备的低级访问？

（真的，还有更多的问题）

顺便说一句，有 Reflex 语言，又名“带有进程的 C”。Reflex 是用于控制域的 4GL，具有类似 C 的语法。但是已知的翻译器会生成 C 代码和 Python 代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-08-21T20:17:16.477

There are a few IEC development environments and target hardware that can use C blocks... I would also take a look at the reasons why it HAS to be an IEC-61131 complaint target. I have written extensively on compliance and why it doesn't mean squat. SOFTplc corp can help I'm sure with user defined loadable modules... and they can be in C..

Schneider also supports C function blocks...

Labview too!! not sure why IEC is important that's all!! the compiler if existed would create bad code for sure:)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-10-03T06:07:24.167

如果要转换的代码量是几千行，那么手动重新编码可能是您最好的选择。

如果您有很多代码要转换，那么自动化工具可能会非常有效。使用[DMS 软件再造工具包](http://www.semanticdesigns.com/Products/DMS/DMSToolkit.html)，我们构建了将机械运动图映射到 RLL (PLC) 代码的转换器。DMS 还具有完整的 C 解析器/分析器/前端。这些部件用于构建 C 到 RLL 代码。

这不是一件容易的事。将 DMS 配置为类似于您想要的东西可能需要 6-12 个人工月。如果这比手工完成的要少，那么它就是正确的方法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-08-19T13:34:19.057

您最好的选择是将您的 C 代码拆分为更小的部分，这些部分可以重新编码为 PLC 功能块，并为您将在结构化文本中重写的每个块使用 C 到 PASCAL 转换器。准备做大量的手动工作，因为自动转换可能会让您失望。

也看看这个页面： http: [//www.control.com/thread/1026228786](http://www.control.com/thread/1026228786)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-02-19T16:23:22.677

每次我这样做时，我只是手动将其从 C 直接解析并转换为 ST。我只遇到了几个需要完全重写的函数，尽管很少有处理指针的东西，不幸的是，ST 通常会扼杀这一点。

# wpf - 缩放后执行翻译的 WPF 样式

> ID：757549
> 
> 赞同：2
> 
> 时间：2009-04-16T18:54:29.417
> 
> 标签：wpf, styles, translate

[如this question](https://stackoverflow.com/questions/754137/wpf-button-textwrap-style)所述，我有一种`Button`我一直在 WPF 中开发的风格。我想对这种风格做的另一件事是稍微缩小一点，让它看起来像被点击一样被点击。现在，转换代码如下所示：`Button`

```
<Trigger Property="IsPressed" Value="True">
    <Setter Property="RenderTransform">
        <Setter.Value>
            <TransformGroup>
                <ScaleTransform ScaleX="0.98" ScaleY="0.98"/>
                <SkewTransform AngleX="0" AngleY="0"/>
                <RotateTransform Angle="0"/>
                <TranslateTransform X="0" Y="0"/>
            </TransformGroup>
        </Setter.Value>
    </Setter>
    <Setter Property="Button.BitmapEffect">
        <Setter.Value>
            <OuterGlowBitmapEffect GlowColor="Green" GlowSize="10"></OuterGlowBitmapEffect>
        </Setter.Value>                                
    </Setter>
</Trigger> 
```

所以，这很令人兴奋。问题是，与按钮所在区域左上角 相关的`ScaleTransform`比例尺（即，它正在重新缩放到按钮的 0,0 坐标，或者至少，这是我假设的）。`Image``Button`

我的理解`TranslateTransform`是它是像素坐标，而不是相对于对象大小的坐标。如果我输入`TranslateTransform`0.01、0.01 的 a，那么它将`Button`在 x 和 y 上移动 0.01 像素，而不是在每个方向上移动 0.01*sizeof(imagedimension) 像素。我怎样才能得到这种相对变换，我怎样才能让它作为一种风格发生，即，所以我不必为`Button`我所拥有的每种不同尺寸做不同的数学运算？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T19:01:58.507

要通过中心缩放，您可以在触发器中添加：

```
<Setter Property="RenderTransformOrigin" Value=".5,.5"/> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T19:00:43.987

您需要将 Button 上的 RenderTransformOrigin 设置为 0.5 x 0.5：

```
RenderTransformOrigin="0.5,0.5" 
```

# c++ - 在不打开端口的情况下确定设备是否连接/断开到 RS232 端口

> ID：757556
> 
> 赞同：2
> 
> 时间：2009-04-16T18:56:07.133
> 
> 标签：c++, winapi, serial-port

我正在开发一个 C++ Win32 应用程序，我试图基本上“自动检测”设备是否已插入其中一个 RS232 端口，然后是否已断开连接。

检查连接的设备很容易，因为我的用例允许我假设这个特定线程将是第一个尝试启动与端口通信的线程。我能够每分钟左右扫描一次可用端口，一旦我找到一个带有设备的端口，我标记该端口有一个设备，关闭端口，然后设置一个事件，以便实际执行的进程使用设备知道它现在可以连接到该端口。

断开连接检测是我遇到麻烦的地方。当我扫描连接的设备时，我实际上可以向端口发送数据，以确保如果有设备，它就是我正在寻找的特定设备。但是一旦它被连接，那个端口就已经被另一个进程打开了，我不能再从检测线程打开那个端口。所以我正在寻找一种方法来以“侦听模式”或类似的方式打开端口，这样我就可以查看设备是否仍然存在。

我短暂地遇到了一些关于观看 DSR 或 DTR 线路或其他东西的事情......但找不到更多或如何实际做到这一点。

有什么建议么？

**编辑：** 看起来我需要再澄清一点......为了检测断开连接，我*无法*以任何方式将数据发送到 RS232 端口*。* 另外，我不能假设另一个应用程序实际上打开了端口。该设备可能已物理连接，但没有打开连接......但我仍然不能冒险向它发送数据。我希望有一种方法可以检查该端口上是否仍有电源或类似的东西。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T22:01:08.937

断开硬件时调制解调器状态寄存器是否会发生变化取决于连接的硬件，但如果有，则可以使用[*GetCommModemStatus()*](http://msdn.microsoft.com/en-us/library/aa363258(VS.85).aspx)函数检查 CTS 或 DSR 线路的状态。

但是，您需要 COM 端口的文件句柄来调用任何 API 函数，这是一个问题，正如[*CreateFile()*](http://msdn.microsoft.com/en-us/library/aa363858(VS.85).aspx)的文档所述，这是专有的：

> CreateFile 函数可以创建通信资源的句柄，例如串行端口 COM1。对于通信资源，dwCreationDisposition 参数必须为 OPEN_EXISTING，dwShareMode 参数必须为零（独占访问）

因此，当另一个进程打开该端口进行通信时，您不能打开 COM 端口来观察线路状态。

有很多方法可以做到这一点，但它们涉及驱动程序。SysInternals有[Portmon 工具](http://technet.microsoft.com/en-us/sysinternals/bb896644.aspx)，谷歌搜索会发现一些公司销售用于在应用程序之间共享 COM 端口访问的软件，但使用标准 API 不可能同时访问 AFAIK。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T19:01:12.207

听起来最好让那个进程通知连接和断开的事件也将数据中继到另一个进程。让您的应用程序分层工作，以便有一个进程控制 RS232 连接并发送您的上层应用程序事件：已连接、已断开连接、可用数据等。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T21:20:52.043

我已经完成了这样的应用程序，它并不是一个特定于语言的问题（除非您没有使用您的语言访问串行端口）。

根据您的配置，我首选的解决方案始终是每个端口有一个线程，并且线程保持可从某种控制器访问的状态。

默认条件是线程每隔几秒钟轮询一次端口，并且在没有答案的情况下假设没有连接设备。一旦设备似乎响应，更改状态以表明它是响应的。

我设计了一个具有多个队列的应用程序：一个具有断开的线程，一个具有连接但空闲的线程，另一个具有连接和繁忙的线程。当线程改变状态时，控制器在队列之间移动线程。

# c# - 在 ASP.NET 中显示缩略图的最佳方式是什么？

> ID：757559
> 
> 赞同：2
> 
> 时间：2009-04-16T18:56:15.603
> 
> 标签：c#, asp.net, image, thumbnails, imagebutton

我正在 ASP.NET 中创建一个常规画廊，但我对创建缩略图的经验很少。我知道算法和 GetThumbnailImage 方法，但我的问题出在其他地方 - 我目前正在使用 ImageButton 控件显示图像（刚刚调整大小）。这就是重点——我不知道如何将“缩略图”图像连接到 ImageUrl 属性。甚至有可能吗？如果可以，怎么做？或者我应该改用其他控件吗？感谢您的任何建议！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T19:15:15.200

听起来您需要设置一个 HttpHandler，它将创建调整大小的图像并可能还将其缓存到磁盘，以节省在每个请求上重新创建缩略图的麻烦。

因此，例如：

```
<asp:ImageButton ID="ImageButton1" ImageUrl="~/ImageHandler.ashx?ImageId=123" runat="server /> 
```

然后你会有一个处理程序：

```
namespace MyProject
{
    public class ImageHandler : IHttpHandler
    {
        public virtual void ProcessRequest(HttpContext context)
        {
            // 1\. Get querystring parameter
            // 2\. Check if resized image is in cache
            // 3\. If not, create it and cache to disk
            // 5\. Send the image

            // Example Below
            // -------------

            // Get ID from querystring
            string id = context.Request.QueryString.Get("ImageId");

            // Construct path to cached thumbnail file
            string path = context.Server.MapPath("~/ImageCache/" + id + ".jpg");

            // Create the file if it doesn't exist already
            if (!File.Exists(path))
                CreateThumbnailImage(id);

            // Set content-type, content-length, etc headers

            // Send the file
            Response.TransmitFile(path);
        }

        public virtual bool IsReusable
        {
            get { return true; }
        }
    }
} 
```

您还需要在 web.config 中进行设置

```
<system.web>
    <httpHandlers>
        <add verb="*" path="ImageHandler.ashx" type="MyProject.ImageHandler, MyProject"/>
    </httpHandlers>
</system.web> 
```

这应该足以让你开始。您需要修改 ProcessRequest 方法来创建缩略图，但您提到已经处理了这个问题。您还需要确保在将文件传输到浏览器时正确设置标题。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-16T19:02:32.157

您可以创建一个 HttpHandler 来处理图像请求并返回缩略图（或对图像执行任何您需要的操作）。

每当您在 ASP.NET 中进行图形处理时，请记住，几乎*所有*System.Drawing 都是 GDI+ 的包装器，因此包含对需要正确处理的非托管内存的引用（使用该`using`语句）。即使对于像 StringFormat 等简单的类也是如此。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T19:41:42.593

Http 处理程序是要走的路。

关于性能的另一个注意事项：从内存和 CPU 的角度来看，处理图像相对于磁盘空间来说是昂贵的。因此，从完整图像生成缩略图是您只想为每个完整图像执行一次的操作。执行此操作的最佳时间可能是在上传图像时，特别是如果您将在同一页面上显示其中的多个。

# emacs - 在 Emacs Lisp 中，如何检查变量是否已定义？

> ID：757564
> 
> 赞同：103
> 
> 时间：2009-04-16T18:58:20.733
> 
> 标签：emacs, lisp, elisp

在 Emacs Lisp 中，如何检查变量是否已定义？

* * *

## 回答 #1

> 赞同：148
> 
> 时间：2009-04-16T19:06:05.410

你可能想要 boundp: 如果变量（一个符号）不是 void，则返回 t；更准确地说，如果它的当前绑定不是无效的。否则返回 nil 。

```
 (boundp 'abracadabra)          ; Starts out void.
  => nil

  (let ((abracadabra 5))         ; Locally bind it.
    (boundp 'abracadabra))
  => t

  (boundp 'abracadabra)          ; Still globally void.
  => nil

  (setq abracadabra 5)           ; Make it globally nonvoid.
  => 5

  (boundp 'abracadabra)
  => t 
```

* * *

## 回答 #2

> 赞同：49
> 
> 时间：2009-04-17T15:43:10.693

除了[dfa 的答案](https://stackoverflow.com/questions/757564/in-emacs-lisp-how-do-i-check-if-a-variable-is-defined/757593#757593)之外，您可能还想查看它是否使用[fboundp](https://www.gnu.org/software/emacs/manual/html_node/elisp/Function-Cells.html)绑定为函数：

```
(defun baz ()
  )
=> baz
(boundp 'baz)
=> nil
(fboundp 'baz)
=> t 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-06-29T12:01:09.280

如果你想从 emacs 中检查变量值（我不知道这是否适用，因为你写了“在 Emacs Lisp 中”？）：

`M-:`从`Eval`迷你缓冲区开始。写下变量的名称并按回车键。迷你缓冲区显示变量的值。

如果未定义变量，则会出现调试器错误。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2018-07-07T05:28:37.357

请记住，具有值 nil 的变量被视为已定义。

```
(progn (setq filename3 nil) (boundp 'filename3)) ;; returns t

(progn (setq filename3 nil) (boundp 'filename5)) ;; returns nil 
```

# bash - 限制脚本发送警报

> ID：757570
> 
> 赞同：1
> 
> 时间：2009-04-16T19:00:45.797
> 
> 标签：bash

我有一个 bash 脚本，它检测在 unix 机器上运行的失败系统组件。该脚本会在失败时发送一封电子邮件。该脚本通过每分钟运行一次（通过 cron）运行。限制每 15 分钟发送一次警报的最简单方法是什么？

我可以在发送警报时创建/更新文件，并且仅在所述文件的日期已经过几分钟的情况下才发送文件吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T19:30:53.370

像这样的东西可能会起作用：

```
stamp=/tmp/mystamp
# create stamp file, if we haven't yet
[ ! -f $stmp ] && touch $stamp
tmp=$(tempfile)

# see if 15 minutes has passed...
diff=$(echo $(date -d "15 minutes ago"  +%y%d%m%H%M) - $(date -d "$(stat $tmp |grep Change |cut -d: -f2-)" +%y%d%m%H%M)  |bc)
rm $tmp

# if we last touched the stamp file less than 15 minutes ago
# then quit
[ $diff -le 0 ] && exit 0

# update the stamp file
touch $stamp

# do your thing...
echo 'Warning! Warning!' |mail -s "FOOBAR" your@address.com 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T19:04:23.697

您可以为发送警报的脚本实现中间人。与其“直接”发送电子邮件（通过 sendmail，另一个邮件应用程序），您可以将其发送到另一个实际拨打电话的脚本。然后，此脚本可以跟踪（使用另一个文件）上次发送邮件的时间。这样，您可以检查发送它们的频率。:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T19:37:26.613

如果遇到错误情况，请触摸临时文件（例如 /tmp/alert.email）。接下来在脚本中，检查文件是否存在，如果存在并且分钟数为 0、15、30、45，然后发送电子邮件。我不确定这是否完全符合您的要求。基本上它：

*   每 15 分钟发送一封电子邮件的频率不超过一次。
*   针对所有错误情况发送电子邮件，但不一定立即发送。
*   可能会立即或最多 14 分钟后发送错误消息。

所以以后有类似的东西：

```
#!/bin/bash 

MIN=`date '+%M'`

if [ *ERROR_COND* ] ; then
   touch /tmp/alert.email
fi

if [[ -f /tmp/alert.email &&  ( $MIN = "15" || $MIN = "30" || $MIN = "45" || $MIN = "00" ) ]] ; then
   # email here
   rm -f /tmp/alert.email
fi 
```

# .net - 使用 C# 通过 asp.net 将大文件传输到远程服务器的各种方法

> ID：757572
> 
> 赞同：2
> 
> 时间：2009-04-16T19:00:54.547
> 
> 标签：.net, ftp, connection, transfer

我正在用 C# / VS2005 编写一个程序来备份我们的生产数据库，对其进行压缩，然后将其传输到远程服务器。我在远程服务器上设置了一个简单的 ftp 站点。

问题是文件只传输了大约一半（~500 - 600 MB）并且程序抛出异常：

“现有连接被远程主机强行关闭”

我使用的代码基本上是从这里剪切和粘贴的，由 Jaimon Mathew 编写，使用套接字：

[http://www.csharphelp.com/archives/archive9.html](http://www.csharphelp.com/archives/archive9.html)

我已经研究了这个问题，看起来我无法做任何事情来防止连接被关闭，我解决它的唯一方法是使用套接字的“异步”方法。

我一直在搜索并且找不到任何示例代码来执行此操作，而且我无法相信我正在尝试执行的这个简单任务被证明如此困难。

有没有一种简单的方法可以将大型（~1.2 GB）本地文件传输到远程 ftp 站点，如果连接被远程主机关闭，它不会失败（我猜它必须重新连接并恢复传输)?

如果我的老板知道我已经在这方面花了多少时间，而且我们仍然没有前一天在远程服务器上的备份，他会杀了我。

我更愿意在 .NET 程序中做所有事情（我们的系统目前是一个巨大的 Rube Goldberg 机器），但我需要一个快速简单的解决方案。

谢谢，

史蒂夫

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T19:05:52.850

这是[一大堆](http://www.example-code.com/csharp/ftp.asp)关于如何进行 FTP 的 C# 示例。特别是，请查看[Restart/Retry FTP Upload](http://www.example-code.com/csharp/ftp_upload_resume.asp)示例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T19:03:30.237

您链接的代码似乎支持恢复上传：

```
public void upload(string fileName,Boolean resume) 
```

用 resume = true 调用该函数不起作用吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T20:00:49.973

我正在使用后台智能传输服务 (BITS) 通过 HTTP 上传。这是一个特定于平台的解决方案，但运行良好且易于使用。它与 Windows Update 使用的机制相同。

# winforms - WinForms作为menuitem菜单下拉菜单打开弹出用户控件？

> ID：757579
> 
> 赞同：3
> 
> 时间：2009-04-16T19:02:12.813
> 
> 标签：winforms, menu, popup, user-controls, menuitem

一直在到处寻找，找不到办法做到这一点。

我的 winforms 程序顶部有一个菜单栏。现在它只是弹出一个普通的 menuitem 菜单。我想禁用该菜单并弹出一个漂亮的用户控件，它看起来像是该菜单项的下拉菜单，但包含更多自定义。一个很好的例子是 OpenSuse 中的 gnome 菜单栏或 windows vista 中的开始菜单。

任何人都可以向我指出一个教程或帮助我找到一种方法吗？

现在我知道只要菜单项没有子项，菜单就不会出现，这是我想要做的，但我想在单击该菜单项时用我自己的用户控件模拟该菜单。

谢谢！！！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T19:23:29.597

我最近不得不将自己的跟踪栏添加到工具栏，这涉及从[ToolStripControlHost](http://msdn.microsoft.com/en-us/library/system.windows.forms.toolstripcontrolhost.aspx)派生。我想你需要做一些类似的事情，因为[MenuStrip](http://msdn.microsoft.com/en-us/library/system.windows.forms.menustrip.aspx)是[ToolStrip](http://msdn.microsoft.com/en-us/library/system.windows.forms.toolstrip.aspx)的派生。

这是[使用 ToolStripControlHost 的 MSDN 教程](http://msdn.microsoft.com/en-us/library/9k5etstz.aspx)，这里是关于将自定义控件添加到[ToolStripDropDownButton的](http://msdn.microsoft.com/en-us/library/system.windows.forms.toolstripdropdownbutton.aspx)[CodeProject 文章](http://www.codeproject.com/KB/menus/ToolStripDropDown.aspx)。

# java - 如何在 J2ME 中确定明天的日期以在 DateField 中使用？

> ID：757583
> 
> 赞同：0
> 
> 时间：2009-04-16T19:03:22.607
> 
> 标签：java, datetime, java-me

我基本上希望能够显示明天的日期

我有这个显示今天的日期

```
private Date date = new Date(); 
```

我试过这个，但这给了我 1970 年 1 月 1 日

```
private Date date = new Date(+1); 
```

请帮忙

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-16T19:46:50.960

Date 构造函数的整数（实际上是长）参数用于指定从 1970 年 1 月 1 日（格林威治标准时间）开始偏移的毫秒数。

您需要改用日历

```
Calendar cal = Calendar.getInstance();
cal.add(Calendar.DATE, 1);
Date date = cal.getTime(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T19:13:07.327

请注意，`Date.setBlah`和`Date.getBlah`方法已弃用，应使用[Calendar代替。](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Calendar.html)（但不确定 J2ME 中是否可用。）

```
private Date date = new Date();
date.setDate(date.getDate() + 1); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T19:39:17.950

正如这里所建议的，使用类 Calendar~~的实现，如下所示：~~

```
Calendar myCalendar = Calendar.getInstance();
long tomorrow = myCalendar.getTimeInMillis() + 24 * 60 * 60 * 1000;
myCalendar.setTimeInMillis(tomorrow); 
```

并用它做任何你想做的事情......

希望这可以帮助，

尤瓦尔=8-)

# wcf - WCF：跨多个服务共享缓存数据

> ID：757588
> 
> 赞同：3
> 
> 时间：2009-04-16T19:04:56.643
> 
> 标签：wcf

我们正在开发一个项目，该项目涉及大约 10 个不同的 WCF 服务，每个服务有多个端点。其中一项服务在内存中缓存了几张大数据表。

我们发现我们需要从其他服务访问该数据。我希望能够在所有服务之间共享这些表，而不是保留 2 个缓存副本。

我做了一些研究，发现了一些关于使用附加到服务主机的 IExtension 来存储共享数据的文章。

假设所有服务都在同一个网站下运行，那行得通吗？这是正确的方法吗？还是我应该去别处寻找？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T23:04:58.503

如果不止一个服务需要您缓存的数据，那么从面向服务的体系结构的角度来看，无论如何，它不属于您调用它的任何一个服务。

如果被缓存的数据与任何一个服务都没有真正的关系，而是两个服务都需要的东西，那么它可能属于它自己的单独服务。您是否考虑过将缓存封装在第三个服务中，并执行服务到服务调用来检索您需要的数据？好处包括...

1.  它解决了你原来的困境，避免了多次从数据库中读取整个缓存；
2.  它将缓存封装在一个地方，以便以后维护/更改。
3.  它允许您通过放置另一个服务接口来将缓存的实现从其他服务中抽象出来。

总而言之，我建议这是最好的方法。唯一的缺点是进行服务到服务调用的额外开销，但这肯定优于必须从数据库中读取整个缓存。

或者，如果缓存中的数据与调用缓存的两个服务密切相关，即两个服务都添加/更改缓存中的数据等，那么也许这两个现有服务应该组合成一个服务.

如果我说的有点道理，那么我所借鉴的 SOA 原则就是[Service Autonomy](http://en.wikipedia.org/wiki/Service-oriented_architecture#Principles "服务自治")。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T19:35:10.363

如果您的所有服务都是同一个应用程序的一部分，那么您似乎没有任何理由不能通过共享对象引用直接共享缓存。最简单的方法是通过静态字段。

如果您选择这种方法，需要非常小心的一件事是线程安全。如果您的缓存通过两个 WCF 会话同时访问，则必须确保两个会话不会通过同时更改缓存来相互干扰。如果缓存是只读的，则减少执行此操作的需要，但您仍可能需要同步缓存的初始化。

# iphone - 兄弟视图之间的 NSNotification

> ID：757589
> 
> 赞同：1
> 
> 时间：2009-04-16T19:05:25.660
> 
> 标签：iphone, cocoa

使用 UITabBar，我有 4 个同级视图（每个选项卡项一个）。当应用程序加载时，第一个选项卡项和视图是可见的。第一个视图有一个发布 NSNotification 的 IBAction。其他三个视图中的每一个都有通知的观察者，但他们无法“听到”通知，直到通过触摸标签栏项目首次使其可见。

是否可以在激活同级之前将 NSNotification 发布到同级视图的 NSNotification 观察者，或者以一种无需先激活它们就可以观察通知的方式加载同级视图的方式？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T19:16:30.470

兄弟视图（或者，也许更准确地说，*表亲*视图 :) 可能没有收到通知，因为它们还没有被实例化。通常，视图控制器在第一次显示时实例化它的视图（和子视图）。

您可能想要做的是让视图*控制器*处理通知而不是子视图。视图控制器在设置标签栏时被实例化，因此它们应该准备好立即接收通知。

您不能真正将通知从视图控制器转发到子视图，因为出于同样的原因，您将尝试向尚未实例化的视图发送消息。您应该做的是跟踪视图控制器中的状态，然后在`viewDidLoad`or中适当地设置子视图`loadView`（取决于您是否使用 NIB）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T17:50:15.637

解决了 -

在应用程序委托实现文件中：

```
- (void)applicationDidFinishLaunching:(UIApplication *)application {

    [window addSubview:tabBarController.view];

    self.tabBarController.selectedViewController = [self.tabBarController.viewControllers objectAtIndex:2];
    self.tabBarController.selectedViewController = [self.tabBarController.viewControllers objectAtIndex:1];
    self.tabBarController.selectedViewController = [self.tabBarController.viewControllers objectAtIndex:0];
} 
```

这会加载所有 (4) 个视图控制器，它们都会立即监听 NSNotifications。

# wpf - 如果验证失败，则禁用 WPF 中的保存按钮

> ID：757590
> 
> 赞同：21
> 
> 时间：2009-04-16T19:05:28.483
> 
> 标签：wpf, validation, save

我采用了似乎是使用 IDataErrorInfo 接口和样式在 WPF 中验证文本框的标准方法，如下所示。但是，当页面无效时，如何禁用“保存”按钮？这是通过触发器以某种方式完成的吗？

```
Default Public ReadOnly Property Item(ByVal propertyName As String) As String Implements IDataErrorInfo.Item
    Get
        Dim valid As Boolean = True
        If propertyName = "IncidentCategory" Then
            valid = True
            If Len(IncidentCategory) = 0 Then
                valid = False
            End If
            If Not valid Then
                Return "Incident category is required"
            End If
        End If

        Return Nothing

    End Get
End Property 
```

```
<Style TargetType="{x:Type TextBox}">
    <Setter Property="Margin" Value="3" />
    <Setter Property="Height" Value="23" />
    <Setter Property="HorizontalAlignment" Value="Left" />
    <Setter Property="Validation.ErrorTemplate">
        <Setter.Value>
            <ControlTemplate>
                <DockPanel LastChildFill="True">
                    <Border BorderBrush="Red" BorderThickness="1">
                        <AdornedElementPlaceholder Name="MyAdorner" />
                    </Border>
                </DockPanel>
            </ControlTemplate>
        </Setter.Value>
    </Setter>
    <Style.Triggers>
        <Trigger Property="Validation.HasError" Value="true">
            <Setter Property="ToolTip"  Value="{Binding RelativeSource={RelativeSource Self}, Path=(Validation.Errors)[0].ErrorContent}" />
        </Trigger>
    </Style.Triggers>
</Style> 
```

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-04-16T19:22:43.153

有几件事：

首先，我建议使用 RoutedCommand`ApplicationCommands.Save`来实现对保存按钮的处理。

如果您还没有查看 WPF 命令模型，您可以在[此处](http://msdn.microsoft.com/es-es/library/ms752308(VS.85).aspx)获取独家新闻。

```
<Button Content="Save" Command="Save"> 
```

现在，要实现该功能，您可以将命令绑定添加到 Window/UserControl 或 Button 本身：

```
 <Button.CommandBindings>
        <CommandBinding Command="Save" 
                        Executed="Save_Executed" CanExecute="Save_CanExecute"/>
    </Button.CommandBindings>
</Button> 
```

在后面的代码中实现这些：

```
private void Save_Executed(object sender, ExecutedRoutedEventArgs e)
{
}

private void Save_CanExecute(object sender, CanExecuteRoutedEventArgs e)
{
} 
```

中`Save_CanExecute`，`e.CanExecute`根据绑定在文本框上的有效性进行设置。

如果您想使用 MVVM（模型-视图-视图模型）设计模式来实现，请查看 Josh Smith 在[CommandSinkBinding](http://joshsmithonwpf.wordpress.com/?s=commandsink)上的帖子。

最后一点：如果您希望在`TextBox`更改中的值后立即更新启用/禁用，请`UpdateSourceTrigger="PropertyChanged"`在绑定上设置`TextBox`.

编辑：如果您想根据控件中的所有绑定来验证/无效，这里有一些建议。

1）您已经在实施`IDataErrorInfo`. 尝试实现该`IDataErrorInfo.Error`属性，使其返回对您绑定到的所有属性都无效的字符串。这仅在您的整个控件绑定到单个数据对象时才有效。放`e.CanExecute = string.IsNullOrEmpty(data.Error);`

2) 使用反射获取相关控件上的所有公共静态 DependencyProperties。然后`BindingOperations.GetBindingExpression(relevantControl, DependencyProperty)`在每个属性上调用一个循环，以便您可以测试验证。

3) 在构造函数中，手动创建嵌套控件上所有绑定属性的集合。在 CanExecute 中，遍历此集合并通过使用来验证每个`DependencyObject`/`DepencyProperty`组合`BindingOperation.GetBindingExpression()`以获取表达式，然后检查`BindingExpression.HasError`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-01-16T11:20:45.503

我为此创建了附加属性：

```
public static class DataErrorInfoHelper
{
    public static object GetDataErrorInfo(ButtonBase obj)
    {
        return (object)obj.GetValue(DataErrorInfoProperty);
    }

    public static void SetDataErrorInfo(ButtonBase obj, object value)
    {
        obj.SetValue(DataErrorInfoProperty, value);
    }

    // Using a DependencyProperty as the backing store for DataErrorInfo.  This enables animation, styling, binding, etc...
    public static readonly DependencyProperty DataErrorInfoProperty =
        DependencyProperty.RegisterAttached("DataErrorInfo", typeof(object), typeof(DataErrorInfoHelper), new PropertyMetadata(null, OnDataErrorInfoChanged));

    private static void OnDataErrorInfoChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        var button = d as ButtonBase;

        if (button.Tag == null)
            button.Tag = new DataErrorInfoContext { Button = button };

        var context = button.Tag as DataErrorInfoContext;

        if(e.OldValue != null)
        {
            PropertyChangedEventManager.RemoveHandler(((INotifyPropertyChanged)e.OldValue), context.Handler, string.Empty);
        }

        var inotify = e.NewValue as INotifyPropertyChanged;
        if (inotify != null)
        {
            PropertyChangedEventManager.AddHandler(inotify, context.Handler, string.Empty);
            context.Handler(inotify, new PropertyChangedEventArgs(string.Empty));
        }
    }

    private class DataErrorInfoContext
    {
        public ButtonBase Button { get; set; }

        public void Handler(object sender, PropertyChangedEventArgs e)
        {
            var dei = sender as IDataErrorInfo;

            foreach (var property in dei.GetType().GetProperties())
            {
                if (!string.IsNullOrEmpty(dei[property.Name]))
                {
                    Button.IsEnabled = false;
                    return;
                }
            }
            Button.IsEnabled = string.IsNullOrEmpty(dei.Error);
        }
    }
} 
```

我在我的表单上这样使用它：

```
<TextBlock  Margin="2">e-mail:</TextBlock>
<TextBox  Margin="2" Text="{Binding Email, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}"/>
<!-- other databindings--->
<Button Margin="2" local:DataErrorInfoHelper.DataErrorInfo="{Binding}"  Commands="{Binding SaveCommand}">Create account</Button> 
```

# java - 压力测试建议 BlazeDS

> ID：757598
> 
> 赞同：2
> 
> 时间：2009-04-16T19:08:30.410
> 
> 标签：java, apache-flex, actionscript, blazeds, stress-testing

我们正在删除我们的 XSL-> HTML 解决方案，并为我们的用户群用 Flex UI 替换它。问题之一是 BlazeDS（amf 端点，因此流式传输或轮询）将无法像 EJB -> XML -> XSLT -> HTML 堆栈一样处理负载。我的理论是它应该表现更好，但我需要一种方法来统计证明这一点。

对 BlazeDS 压力测试的产品和/或方法有什么建议吗？Adobe 有一个 LCDS 压力测试框架，但它表示它与 BlazeDS 不兼容。我认为测试可能很简单，因为我现在不打算将它用作消息传递解决方案，并且简单地希望它作为 RemoteObject 连接的端点。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T05:09:53.577

我会考虑使用 JMeter 对后端运行一些自动化测试：

[http://jmeter.apache.org/](http://jmeter.apache.org/)

您应该能够针对后端编写一个测试，该后端采用一些 Java 对象并使用 Blaze 中可用的 API 在 AMF 中对它们进行编码并将结果设置为 HTTP 请求的主体。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-25T19:09:19.673

Rob de Boer 有一篇关于在此处实施这种方法的好文章[http://blog.jteam.nl/2009/07/14/performance-testing-a-flex-blazeds-application/](http://blog.jteam.nl/2009/07/14/performance-testing-a-flex-blazeds-application/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-09-25T14:30:48.823

为了扩展 Cliff 的答案，现在有一个用于处理 AMF 消息的 JMeter 插件。它将消息反序列化为 XML，以便可以对其进行编辑。您可以使用变量生成插入到每个 AMF 样本中的唯一会话 ID。

[http://github.com/steeltomato/jmeter-amf](http://github.com/steeltomato/jmeter-amf)

全面披露：我是项目作者。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-09-25T14:47:11.683

我想到了几个框架：

*   [仪表](http://jakarta.apache.org/jmeter/)
*   [perf4j](http://perf4j.codehaus.org/)
*   [TPTP](http://www.eclipse.org/tptp/)。

> ，但我需要一种方法来统计证明这一点。

嗯，如果你想要真正有表现力的统计数据（例如除了平均值、最大值、最小值还有标准差，甚至 95% 置信区间或序列相关），你必须仔细看看这些工具，因为它们中的大多数都很弱关于统计。

希望[这个](https://stackoverflow.com/questions/7146207/what-is-the-best-macro-benchmarking-tool-framework-to-measure-a-single-threaded/7445378#7445378)解释了几种性能测试工具的优缺点的列表可以帮助你。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-08-14T20:32:13.923

我的公司 (UBIK-INGENIERIE) 分发了一个商业 Apache JMeter 插件来加载测试基于 AMF 的应用程序以及扩展 BlazeDS 的应用程序。

您可以使用 Apache JMeter 的标准知识轻松记录、可变和重放基于 Flex/AMF 的应用程序。

看：

*   [http://www.ubik-ingenierie.com/-Solutions-](http://www.ubik-ingenierie.com/-Solutions-)

*   [http://www.ubik-ingenierie.com/blog/ubik-load-pack/](http://www.ubik-ingenierie.com/blog/ubik-load-pack/)

# c# - 哈希表翻倍？

> ID：757608
> 
> 赞同：2
> 
> 时间：2009-04-16T19:11:24.943
> 
> 标签：c#, .net, list, hashtable

我不知道标题是否有意义，但我想知道当您向其中添加项目时哈希表如何扩大？

是否像`List<T>`达到极限时它的大小翻倍？如果是这样，那么这种加倍是否会从头开始重新创建集合（这也可以回答`List<T>`，因为我不确定它是否这样做）？

最后，如果它确实从头开始重新创建它，那么这个特殊的 Add 操作对于不知道已达到限制的用户来说将是非常昂贵的，对吧？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T19:16:20.517

我相信两者`Hashtable`并`Dictionary<TKey, TValue>`在将当前计数增加一倍后扩展到下一个素数，例如从 31 到 67。

据我了解，调整大小不涉及*重新计算*哈希（因为它们与条目一起存储），而是涉及将每个条目放入其新存储桶中，其中存储桶编号基于哈希码和存储桶计数。

你问过`List<T>`- 这真的很简单。该列表由一个数组支持，您只需要创建一个具有正确大小的新数组，并复制当前数组的内容。就像是：

```
private void Resize(int newCapacity)
{
    T[] tmp = new T[newCapacity];
    Array.Copy(backingArray, tmp, backingArray.Length);
    backingArray = tmp;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T19:17:14.853

哈希表使用存储桶工作，每个存储桶可以容纳多个项目（至少在大多数实现中，有一些在已经使用的存储桶的情况下会重用其他存储桶）。桶的数量通常是一个素数，因此将哈希码除以桶的数量会返回可接受的“好”哈希分布。

通常，有一个特定的填充因子会触发更多桶的添加，从而触发哈希表的重建。由于哈希值除以桶数，因此需要根据它们的新桶索引重新分配实例，这基本上是从头开始重新创建。

对于 .NET 哈希表，您可以在[某些构造函数](http://msdn.microsoft.com/en-us/library/7z8x5804.aspx)中指定“加载因子” 。来自 MSDN：

> 负载因子是元素与桶的最大比率。较小的负载因子意味着以增加内存消耗为代价的更快查找。1.0 的负载因子是速度和大小之间的最佳平衡。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T19:14:45.000

大小并不总是翻倍，但会根据项目的数量而变化。

对于一个列表，这并不像重新创建一个字符串或数组那样昂贵，因为只需要将指针从一个列表复制到另一个列表，并且可以非常有效地完成。

对于哈希表/字典，必须重新分配项目，这可能非常昂贵。最好提前用估计的大小初始化哈希表。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T19:18:17.407

从 MSDN 页面上[Hashtable.Add()](http://msdn.microsoft.com/en-us/library/system.collections.hashtable.add.aspx)：

> 如果 Count 小于 Hashtable 的容量，则此方法是 O(1) 操作。如果需要增加容量以容纳新元素，则此方法变为 O(n) 操作，其中 n 为 Count。

由于 List 具有相同的注释，我假设它们在内存分配方面的内部工作方式相似。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T19:18:34.617

如果有兴趣，为什么不深入研究[反射器](http://www.red-gate.com/products/reflector/)做一些研究：

```
private void Insert(object key, object nvalue, bool add)
{
    uint num;
    uint num2;
    if (key == null)
    {
        throw new ArgumentNullException("key", Environment.GetResourceString("ArgumentNull_Key"));
    }
    if (this.count >= this.loadsize)
    {
        this.expand();
    }
    else if ((this.occupancy > this.loadsize) && (this.count > 100))
    {
        this.rehash();
    }
    uint num3 = this.InitHash(key, this.buckets.Length, out num, out num2);
    int num4 = 0;
    int index = -1;
    int num6 = (int) (num % this.buckets.Length);
Label_0071:
    if (((index == -1) && (this.buckets[num6].key == this.buckets)) && (this.buckets[num6].hash_coll < 0))
    {
        index = num6;
    }
    if ((this.buckets[num6].key == null) || ((this.buckets[num6].key == this.buckets) && ((this.buckets[num6].hash_coll & 0x80000000L) == 0L)))
    {
        if (index != -1)
        {
            num6 = index;
        }
        Thread.BeginCriticalRegion();
        this.isWriterInProgress = true;
        this.buckets[num6].val = nvalue;
        this.buckets[num6].key = key;
        this.buckets[num6].hash_coll |= (int) num3;
        this.count++;
        this.UpdateVersion();
        this.isWriterInProgress = false;
        Thread.EndCriticalRegion();
    }
    else if (((this.buckets[num6].hash_coll & 0x7fffffff) == num3) && this.KeyEquals(this.buckets[num6].key, key))
    {
        if (add)
        {
            throw new ArgumentException(Environment.GetResourceString("Argument_AddingDuplicate__", new object[] { this.buckets[num6].key, key }));
        }
        Thread.BeginCriticalRegion();
        this.isWriterInProgress = true;
        this.buckets[num6].val = nvalue;
        this.UpdateVersion();
        this.isWriterInProgress = false;
        Thread.EndCriticalRegion();
    }
    else
    {
        if ((index == -1) && (this.buckets[num6].hash_coll >= 0))
        {
            this.buckets[num6].hash_coll |= -2147483648;
            this.occupancy++;
        }
        num6 = (int) ((num6 + num2) % ((ulong) this.buckets.Length));
        if (++num4 < this.buckets.Length)
        {
            goto Label_0071;
        }
        if (index == -1)
        {
            throw new InvalidOperationException(Environment.GetResourceString("InvalidOperation_HashInsertFailed"));
        }
        Thread.BeginCriticalRegion();
        this.isWriterInProgress = true;
        this.buckets[index].val = nvalue;
        this.buckets[index].key = key;
        this.buckets[index].hash_coll |= (int) num3;
        this.count++;
        this.UpdateVersion();
        this.isWriterInProgress = false;
        Thread.EndCriticalRegion();
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T19:18:37.487

当然，这完全取决于您的哈希实现。

一些散列加倍，一些将它们的大小更改为其他任意大小（例如，下一个素数）。

大多数哈希在更改其缓冲区大小后都需要重新哈希，这“只是”移动指针，但仍然与哈希大小成线性关系。但是，一些哈希使用一致的哈希，这减少了移动元素的需要（通常，只有一小部分元素需要移动）。

# mysql - 谁能解释这个 MySQL 错误？

> ID：757611
> 
> 赞同：1
> 
> 时间：2009-04-16T19:13:05.377
> 
> 标签：mysql, mysql-error-1025

```
ERROR 1025 (HY000): Error on rename of '.\forumf\#sql-1718_20' to '.\forumf\posts' (errno: 150) 
```

1.  错误号是 1025 还是 150？
2.  我正在删除一个当时也是外键的主键（我错误地设置了它）。
3.  什么是HY000？

我在编辑 MySQL 表上的键时收到了这个非常神秘的错误消息。有人可以解释错误，原因和解决方法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T19:17:49.873

是的，您遇到了外键约束。

A`show innodb status;`将显示问题的原因。

一个快速的解决方法是删除约束，做你正在做的事情，然后重新创建约束。

# iphone - 使用渐变背景设计 UITableViewCells

> ID：757613
> 
> 赞同：35
> 
> 时间：2009-04-16T19:13:22.333
> 
> 标签：iphone, cocoa-touch, user-interface

我一直在寻找提高 iPhone 应用程序整体吸引力的方法。大部分功能发生在 UITableView 中。我想我可以从向 UITableViewCells 添加微妙的渐变开始，因为这似乎将应用程序的感觉提高了一个数量级。选择合适的字体/大小也有很大帮助。我对这个论坛的问题是，向 UITableViewCells 添加渐变的最佳策略是什么？你在使用 Core Graphics/Quartz 吗？您是否使用 1x1 像素图像并对其进行拉伸？我对 Tumblr iPhone 应用程序的以下屏幕截图很感兴趣：http: [//dl-client.getdropbox.com/u/57676/screenshots/tumblr.jpg](http://dl-client.getdropbox.com/u/57676/screenshots/tumblr.jpg)

有没有人有任何关于如何让你的 UITableViewCell 脱颖而出的好例子？

出于性能原因，使用图像还是使用 Quartz 绘图更好？如果是 Quartz，我很想看看人们如何将渐变绘制到单元格中的一些示例代码。

谢谢。

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-04-22T15:40:41.390

我为 Tumblr 工作，虽然我没有编写 iPhone 应用程序（[他](http://jeffrock.com/)编写了），但我有源代码并且可以告诉你它是如何完成的。

在`-tableView:cellForRowAtIndexPath:`

```
cell.backgroundView = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@"postCellBackground.png"]];
cell.selectedBackgroundView = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@"postCellBackgroundSelected.png"]]; 
```

非常简单，真的： UIImageView 中的 PNG 图像作为单元格的背景视图。

这两个图像是 1x61 的垂直渐变，UIKit 会自动水平拉伸以适应单元格的宽度。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2009-12-19T00:42:37.073

从 iPhone SDK 3.0 开始，有一个[更简单的解决方案，它依赖于新的 CAGradientLayer 并且不需要子类化或图像](https://stackoverflow.com/questions/422066/gradients-on-uiview-and-uilabels-on-iphone/1931498#1931498)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-04-18T13:25:35.397

Marco 的回答非常适用于普通表格视图单元格和位于表格视图中间的分组表格视图单元格，但是如果您尝试为分组表格中的第一个/最后一个单元格设置背景视图，那么它将破坏圆角。要修复它，您可以将单元格背景颜色设置为**UIColor colorWithPatternImage**，例如：

```
cell.backgroundColor = [UIColor colorWithPatternImage:[UIImage imageNamed:@"Gradient.png"]]; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T19:18:10.123

我会为此使用 Quartz 2D，但在 Photoshop 中设置图像也是完全有效的。

至于性能，如果您按类型重复使用单元格，我认为这不是问题 - 但如果您确实发现它是一个瓶颈，您可以绘制一次位图上下文，从中获取图像并使用它无处不在 - 一种混合解决方案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-21T02:39:24.583

我认为到目前为止，使用自定义单元格处理 UITableView 的最简单方法是使用 Interface Builder。它使 UI 设计工作比纯核心更容易。[这是](http://www.cocoacast.com/?q=node/182)一个很棒的教程（带有视频！）关于如何做到这一点。强烈推荐。自从我遵循之后，我没有使用任何其他 UITableView 编码方法。

话虽如此，向您的单元格添加渐变将非常容易。只需使用 InterfaceBuilder 将包含渐变的图像添加到单元格视图即可。您不必担心 Quartz，并且在性能方面您将获得类似的结果，因为 CocoaTouch 的组件经过了很好的优化，可以执行简单的任务，例如显示图像。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-17T02:56:29.913

UITableViewCell 支持其背景和选定背景的单独视图，因此使用这些属性是有意义的。为此，您将需要提供一个与您的单元格一样大小的图像（UIImageView 不会拉伸它的图像），因此您最好在台式机上制作一次，然后保存手机上的循环将不得不用于拉伸图像或动态制作。尽管如果您打算允许用户更改渐变颜色，则无论如何您都必须动态创建一次。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-02-14T18:51:19.267

如果您不想使用图像，[Mirko 的回答是一个不错的选择。](https://stackoverflow.com/a/1931509/903114)但是，最好将渐变添加到 backgroundView 而不是 UITableViewcell 本身。这样您在选择单元格时不会丢失突出显示效果

# eclipse - Eclipse 编译器或 javac 中的错误？

> ID：757623
> 
> 赞同：7
> 
> 时间：2009-04-16T19:15:53.747
> 
> 标签：eclipse, generics, compiler-construction, javac

谁是对的？Eclipse 还是 javac？

--------------- c/v/A.java ---------------

```
package c.v;
public class A<T> {
} 
```

--------------- c/v/B.java ---------------

```
package c.v;
public class B extends A<B.Secret> {
  private class Secret {};
} 
```

Eclipse 编译 B.java 就好了。

Javac 有问题。

> ```
> $ javac c/v/B.java
> c/v/B.java:3: cvBSecret 在 cvB 中具有私有访问权限
> 公共类 B 扩展 A<B.Secret> {
>                            ^
>     1 个错误
> 
> ```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-16T19:38:05.253

[Java 语言规范](http://java.sun.com/docs/books/jls/third_edition/html/j3TOC.html)的相关部分必须是：

§8.1.4：[...] ClassType 必须命名一个可访问的（§6.6）类类型，否则会发生编译时错误。

§6.6.1：[...] 引用（类、接口或数组）类型的成员（类、接口、字段或方法）或类类型的构造函数只有在类型可访问且成员或构造函数被声明为允许访问：

*   如果成员或构造函数声明为 public，则允许访问。接口的所有成员都是隐式公共的。[...]
    *   否则，如果成员或构造函数被声明为私有，则当且仅当它发生在包含成员或构造函数声明的顶级类（第 7.6 节）的主体内时，才允许访问。

因此，由于 ClassType 不在类的主体内，`B.Secret`在此位置不可访问，因此`A<B.Secret>`不可访问，因此应该发生编译时错误。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-16T19:20:36.933

日食是错误的。如果您将某事宣传为

```
extends A<X> 
```

您需要同时了解 A 和 X。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-16T19:20:20.477

我倾向于认为 javac 是正确的。为了创建一个新类

```
A<B.Secret> 
```

泛型需要能够访问它使用的类。B 然后扩展该类的事实是次要的。

# c - 如何在 C 中对齐这样的数字？

> ID：757627
> 
> 赞同：36
> 
> 时间：2009-04-16T19:16:36.913
> 
> 标签：c, printf, alignment

我需要将 C 中的一系列数字与**printf()**对齐，如下例所示：

```
-------1
-------5
------50
-----100
----1000 
```

当然，所有这些之间都有数字，但这与手头的问题无关......哦，将破折号视为空格，我使用破折号以便更容易理解我想要的内容。

我只能这样做：

```
----1---
----5---
----50--
----100-
----1000 
```

或这个：

```
---1
---5
--50
-100
1000 
```

但这都不是我想要的，我无法仅使用 printf() 实现第一个示例中显示的内容。有可能吗？

**编辑：**
对不起，我很着急，没有很好地解释自己......我的最后一个例子和你所有的建议（使用“%8d”之类的东西）都不起作用，因为虽然最后一个数字是 1000 它没有就这件事而言，不一定要一路达到 1000 甚至 100 或 10。

无论要显示多少位数，我最多只需要 4 个前导空格作为最大数字。假设我必须显示从 1 到 1000 (A) 和 1 到 100 (B) 的数字，并且我对两者都使用“%4d”，这将是输出：

**A：**

```
---1
....
1000 
```

这是我想要的输出...

**乙：**

```
---1
....
-100 
```

这不是我想要的输出，我实际上想要这个：

```
--1
...
100 
```

但是就像我说的，我不知道我要打印的确切数字，它可以有 1 个数字，可以有 2 个、3 个或更多，该功能应该为所有人准备好。我想要四个额外的前导空格，但这并不重要。

**编辑 2：** 似乎我想要的，我需要的方式，这是不可能的（检查 David Thornley 和 Blank Xavier 的答案和我的评论）。谢谢大家的时间。

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-04-16T19:23:03.560

为什么`printf("%8d\n", intval);`不适合你？它应该...

您没有显示任何“不工作”示例的格式字符串，所以我不确定还能告诉您什么。

```
#include <stdio.h>

int
main(void)
{
        int i;
        for (i = 1; i <= 10000; i*=10) {
                printf("[%8d]\n", i);
        }
        return (0);
}

$ ./printftest
[       1]
[      10]
[     100]
[    1000]
[   10000] 
```

**编辑：**对问题澄清的回应：

```
#include <math.h>
int maxval = 1000;
int width = round(1+log(maxval)/log(10));
...
printf("%*d\n", width, intval); 
```

宽度计算计算以 10 + 1 为底的对数，它给出了位数。花式`*`允许您将变量用于格式字符串中的值。

您仍然必须知道任何给定运行的最大值，但没有任何语言或铅笔和纸的方法。

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2009-04-16T20:14:47.757

在我方便的 Harbison & Steele 中查找这个......

确定字段的最大宽度。

```
int max_width, value_to_print;
max_width = 8;
value_to_print = 1000;
printf("%*d\n", max_width, value_to_print); 
```

请记住， max_width 必须是`int`与星号一起使用的类型，并且您必须根据您想要拥有的空间来计算它。在您的情况下，您必须计算最大数字的最大宽度，然后加 4。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-16T19:26:41.053

```
 printf("%8d\n",1);
    printf("%8d\n",10);
    printf("%8d\n",100);
    printf("%8d\n",1000); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2019-12-27T11:16:03.257

*[我意识到这个问题已有一百万年的历史，但它的核心还有一个（或两个）更深层次的问题，关于 OP、编程的教学法以及关于假设的问题。]*

包括模组在内的一些人认为这是不可能的。而且，在某些——包括最明显的——上下文中，确实如此。但有趣的是，这对 OP 来说并不是很明显。

不可能假设contex 在面向行的文本控制台（例如，console+sh 或X-term+csh 或Terminal+bash）上运行从C 编译的可执行文件，这是一个非常合理的假设。但是，“正确”答案（“ `%8d`”）对于 OP 来说还不够好，同时也不明显，这一事实表明附近有相当大的蠕虫罐头……

考虑诅咒（及其许多变体）。在其中，您*可以*导航“屏幕”，“移动”光标，以及“重绘”基于文本的输出部分（窗口）。在 Curses 上下文中，绝对*可以*这样做；即，动态调整“窗口”的大小以容纳更大的数字。但即使是 Curses 也只是屏幕“绘画”的抽象。没有人建议它，而且可能是正确的，因为**C**中的 Curses 实现并不意味着它是“严格的 C”。美好的。

但这究竟意味着什么？为了使响应：“不可能”是正确的，这意味着我们正在谈论运行时系统。换句话说，这不是理论上的（如“如何对一个静态分配的`int`s 数组进行排序？”），这可以解释为完全忽略运行时任何方面的“封闭系统”。

但是，在这种情况下，我们有 I/O：特别是`printf()`. 但这就是有机会说一些更有趣的东西作为回应的地方（尽管，诚然，提问者可能没有挖得这么深）。

假设我们使用一组不同的假设。假设 OP 相当“聪明”并且理解不可能在面向行的流上编辑先前的行（您将如何更正行打印机输出的字符的水平位置？？）。还假设 OP 不仅仅是一个做家庭作业的孩子，却没有意识到这是一个“技巧”问题，旨在梳理对“流抽象”含义的探索。此外，让我们假设 OP 想知道：“等等……如果 C 的运行时环境支持 STDOUT 的想法——如果 STDOUT 只是一个抽象——为什么拥有一个 1) 可以的终端抽象不是一样合理垂直滚动但 2) 支持可定位光标？两者都在屏幕上移动文本。

因为如果*这*是我们试图回答的问题，那么您只需要看：

[ANSI 转义码](https://en.wikipedia.org/wiki/ANSI_escape_code)

看到：

> 几乎所有的视频终端制造商都添加了供应商特定的转义序列来执行操作，例如将光标放在屏幕上的任意位置。一个例子是 VT52 终端，它通过发送 ESC 字符、一个 Y 字符和两个表示等于 x,y 位置加 32 的数值的字符，允许将光标放置在屏幕上的 x,y 位置（因此从 ASCII 空格字符开始并避免控制字符）。Hazeltine 1500 具有类似的功能，使用 ~、DC1 调用，然后用逗号分隔 X 和 Y 位置。虽然这两个终端在这方面具有相同的功能，但必须使用不同的控制序列来调用它们。
> 
> 第一个支持这些序列的流行视频终端是 1978 年推出的 Digital VT100。该型号在市场上非常成功，引发了各种 VT100 克隆，其中最早和最受欢迎的是价格更实惠的 Zenith Z -19 在 1979 年。其他包括 Qume QVT-108、Televideo TVI-970、Wyse WY-99GT 以及可选的“VT100”或“VT103”或“ANSI”模式，在许多其他品牌上具有不同程度的兼容性。这些的流行逐渐导致越来越多的软件（尤其是公告板系统和其他在线服务）假设转义序列有效，导致几乎所有新的终端和仿真程序都支持它们。

早在 1978 年就有可能。C 本身是在 1972 年“诞生”的，而 K&R 版本是在 1978 年建立的。如果当时有“ANSI”转义序列，那么“in C”就有一个答案，*如果*我们也愿意规定：“好吧，假设您的终端支持 VT100。” 顺便说一句，不支持 ANSI 转义的控制台？你猜对了：Windows 和 DOS 控制台。但在几乎所有其他平台（Unices、Vaxen、Mac OS、Linux）上，您都可以期待。

TL；DR - 如果不说明有关运行时环境的假设，就无法给出合理的答案。由于大多数运行时（除非您使用 80 年代和 90 年代的台式计算机市场份额来计算“大多数”）都会有（从 VT-52 时代开始！），那么我不'认为说这是不可能的完全有道理 - 只是为了让它成为可能，这是一个完全不同数量级的工作，而不是那么简单`%8d`......它似乎有点像 OP 知道的.

**我们只需要澄清假设。**

以免有人认为 I/O 是异常的，即，我们唯一需要考虑运行时（甚至硬件）的时候，只需深入研究 IEEE 754 浮点异常处理。对于那些感兴趣的人：

[英特尔浮点案例研究](https://www.intel.com/content/dam/www/public/us/en/documents/case-studies/floating-point-case-study.pdf)

> 根据加州大学伯克利分校的威廉·卡汉教授的说法，1996 年 6 月发生了一个经典案例。一枚名为阿丽亚娜 5 的卫星运载火箭在发射后不久就转动了车轮，并将自身和价值超过 50 亿美元的有效载荷散落在法国的一片沼泽中圭亚那。Kahan 发现这场灾难可归咎于一种无视 IEEE 754 中默认异常处理规范的编程语言。发射后，传感器报告的加速度如此之大，以至于导致用于重新校准火箭惯性的软件转换为整数溢出在发射台上进行指导。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-16T19:23:35.930

那么，您想要一个以空格作为填充的 8 个字符宽的字段吗？试试“%8d”。[这是一个参考](http://www.cplusplus.com/reference/clibrary/cstdio/printf/)。

**编辑**：你想要做的不是 printf 可以单独处理的事情，因为它不会知道你写的最长数字是多少。在执行任何 printfs 之前，您需要计算最大数字，然后计算出要用作字段宽度的位数。然后你可以使用 snprintf 或类似的方法来制作一个 printf 格式。

```
char format[20];
snprintf(format, 19, "%%%dd\\n", max_length);
while (got_output) {
    printf(format, number);
    got_output = still_got_output();
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-16T21:43:43.657

尝试转换为字符串，然后使用“%4.4s”作为格式说明符。这使其成为固定宽度格式。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-16T20:18:20.697

据我从问题中可以看出，您想要的填充量将根据您拥有的数据而有所不同。因此，唯一的解决方案是在打印之前扫描数据，找出最宽的数据，然后找到一个可以使用 asterix 运算符传递给 printf 的宽度值，例如

```
loop over data - get correct padding, put into width

printf( "%*d\n", width, datum ); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-16T21:05:34.653

如果您无法提前知道宽度，那么您唯一可能的答案将取决于将您的输出暂存于某种临时缓冲区中。对于小型报表，仅收集数据并延迟输出直到输入有界是最简单的。

对于大型报告，如果收集的数据超出合理的内存范围，则可能需要一个中间文件。

`printf("%*d", width, value)`获得数据后，使用每个值的习语将其后处理成报告很简单。

或者，如果输出通道允许随机访问，您可以继续编写假定（短）默认宽度的报告草稿，并在违反您的宽度假设时返回并编辑它。这还假设您可以以某种无害的方式在该字段之外填充报告行，或者您愿意通过读取-修改-写入过程替换到目前为止的输出并放弃草稿文件。

但除非你能提前预测正确的宽度，否则如果没有某种形式的两遍算法，就不可能做你想做的事。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-16T22:01:58.763

查看已编辑的问题，您需要找到要呈现的最大数字中的位数，然后使用或使用作为 int 传递的位数生成`printf()`格式，然后是值。一旦你得到最大的数字（并且你必须提前确定），你可以用“整数对数”算法确定位数（在你得到零之前你可以除以 10 多少次），或者通过使用缓冲区长度为零、字符串的格式和空值；返回值告诉你有多少字符被格式化。`sprintf()``%*d``*``snprintf()``%d`

如果您不知道并且无法在其出现之前确定最大数量，那么您就会被斯诺克 - 您无能为力。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-11-28T18:37:45.130

```
#include<stdio.h>
int main()
{
 int i,j,n,b;
 printf("Enter no of rows ");
 scanf("%d",&n);
 b=n;
 for(i=1;i<=n;++i)
 {
    for(j=1;j<=i;j++)
    {
        printf("%*d",b,j);
        b=1;
    }
        b=n;
    b=b-i;
    printf("\n");

 }
 return 0;
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-11-09T15:16:47.370

```
fp = fopen("RKdata.dat","w");
fprintf(fp,"%5s %12s %20s %14s %15s %15s %15s\n","j","x","integrated","bessj2","bessj3","bessj4","bessj5");
for (j=1;j<=NSTEP;j+=1)
    fprintf(fp,"%5i\t %12.4f\t %14.6f\t %14.6f\t %14.6f\t %14.6f\t %14.6f\n",
    j,xx[j],y[6][j],bessj(2,xx[j]),bessj(3,xx[j]),bessj(4,xx[j]),bessj(5,xx[j]));
fclose(fp); 
```

# asp.net-mvc - 当浏览器调整大小时，防止页面上各个部分重新定位的机制是什么

> ID：757630
> 
> 赞同：3
> 
> 时间：2009-04-16T19:16:51.467
> 
> 标签：asp.net-mvc, browser, resize

在此网站中，当您缩小浏览器窗口时，左侧和右侧的空白首先消失，然后是右侧面板的缩小，然后是主容器面板。我最近开始使用 ASP.NET MVC，在我的测试用例中，当我调整浏览器窗口大小时，我的容器低于其他容器。我正在使用带有左侧、中间和右侧部分的站点.master 页面作为正文的一部分。css 中有一个属性来指示行为还是 HTML 元素？我已经查看了该站点主页的页面源代码并查看了 CSS，但没有任何明显的迹象表明这是如何控制的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T19:49:31.063

Web 开发的一大优点是，大多数情况下，当您看到一个站点并想“他们是如何做到的”时，很容易查看代码并找出代码并对其进行测试 - 像[Firebug](http://getfirebug.com)这样的工具对于 Firefox，IE 8 (F12) 和 Chrome 中的开发人员工具都将显示格式良好的源代码和 CSS，并允许您就地修改它。

在 SO 的情况下，网站的主体包含在一个具有“容器”类的 div 中，“容器”的样式规则是：

```
.container {
  margin: 0 auto;
  text-align: left;
  width: 950px;
} 
```

我们在这里看到的关键是这个类有一个**固定**的宽度 - 950 像素，并且边距设置为（扩展）：

```
margin-top: 0px;
margin-right: auto;
margin-bottom: 0px;
margin-left: auto; 
```

将左右边距设置为“自动”具有使 div 在其容器边缘居中的效果，并允许它们在容器占用所需的 950 像素后扩展到所需的任何宽度。

在容器 div 中，您有一个 id 为“content”（无样式规则）的 div，然后是两个 div：“mainbar”和“sidebar”，其样式为：

```
#mainbar {
  float: left;
  margin-bottom: 40px;
  width: 715px;
}

#sidebar {
  float: right;
  width: 220px; /* this is also set in the "style" attribute *
} 
```

这些左右浮动是将条形定位在正确位置的原因。

另一个方便的 CSS 规则是：

```
clear 
```

这可以设置为“both”、“left”或“right”，并且基本上会重置容器上的浮动。

然而，听起来你在追求通常被称为“ [CSS 的圣杯](http://www.alistapart.com/articles/holygrail)”（Rick 指出 IE7 存在一个错误，请参阅[此处以获得修复](http://www.gerd-riesselmann.net/development/the-holy-grail-css-layout-fix-for-ie7)），这是有充分理由的：三列，至少有一个其中灵活。

完全灵活的布局的其他示例包括：

*   [多列布局开箱即用](http://www.alistapart.com/articles/multicolumnlayouts)
*   [流体网格](http://www.alistapart.com/articles/fluidgrids)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T19:23:22.123

它可以是浮动、位置和边距以及如何设置这些元素的组合。如果没有 URL，就很难确切地说出问题是什么或如何解决它。

作为一个起点，我建议看一下 YUI CSS Grids 或 960.gs（960 Grid System）以及漂浮在那里的各种 reset.css 文件之一。YUI 有一个很好的。reset.css 文件使您的 css 在所有浏览器中的外观和行为都相同，并且网格系统为您提供了设计网站的起点。它们还使您确信您所设计的内容在所有浏览器中的外观和行为都相同。

[http://developer.yahoo.com/yui/grids/](http://developer.yahoo.com/yui/grids/) [http://960.gs/](http://960.gs/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T19:32:02.913

这是一个 html 布局问题。可能 asp.net mvc 布局做得不是很好。在网络上搜索“ *css 列布局*”有很多关于如何实现良好布局的示例。例如，参见[MATTHEW LEVINE 的 In Search of the Holy Grail，](http://www.alistapart.com/articles/holygrail)对 3 列布局技术进行了很好的讨论。

# subsonic - 如何从 SubSonic 查询返回 DataTable？

> ID：757638
> 
> 赞同：0
> 
> 时间：2009-04-16T19:18:18.017
> 
> 标签：subsonic

我正在尝试从我用 Subsonic 编写的查询中返回一个数据表（我刚刚开始学习它） - 但只能返回一个 DataSet？

```
public DataTable GetAllCarTypes()
{
    return new Query("tblCarType").ExecuteDataSet();
} 
```

我希望 .ExecuteDataTable()??

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T19:22:39.253

如果您只从查询中返回 1 个表，您可以执行以下操作：

```
public DataTable GetAllCarTypes()
{
    return new Query("tblCarType").ExecuteDataSet().Tables[0];
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T19:21:15.950

Ahhaaa .. 应该在 O 发布之前考虑一下，现在我想我有了

```
public DataTable GetAllCarTypes()
{
    return new Query("tblCarType").ExecuteDataSet().Tables[0];
} 
```

如果不是，请您发布正确的语法

# regex - 我怎样才能 grep 具有两个表达式的文件？

> ID：757648
> 
> 赞同：0
> 
> 时间：2009-04-16T19:20:42.333
> 
> 标签：regex, grep

我想显示包含多个表达式的文件并排除不​​包含所有表达式的文件。

有任何想法吗？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T19:26:32.333

通常我通过多次运行 grep 来做那种事情，比如

```
grep -l 'expression1' * | xargs grep -l 'expression2' | xargs grep -l 'expression3' 
```

等等。它似乎不是很有效，如果有更好的方法我不会感到惊讶，但我不知道。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T19:23:11.467

egrep -r '表达式1|表达式2|表达式3'。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T19:25:39.043

如果你没有 -r 你可以在结果上再次使用 grep grep expression1 * | grep 表达式 2 | grep 表达式 3

# objective-c - 是否有适用于 Twitter 的 iPhone SDK API？

> ID：757649
> 
> 赞同：15
> 
> 时间：2009-04-16T19:20:44.640
> 
> 标签：objective-c, iphone

mobclix.com 有一个用于与 facebook.com 集成的 API。twitter.com 和其他社交服务有类似的东西吗？意思是，这些看起来像你的应用程序的原生部分？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-04-16T19:28:55.697

试试[MGTwitterEngine](http://mattgemmell.com/2008/02/22/mgtwitterengine-twitter-from-cocoa)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2011-10-13T10:56:30.260

iOS上现在有一个内置的[Twitter API](https://developer.apple.com/library/ios/#documentation/Twitter/Reference/TwitterFrameworkReference/_index.html)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-08-03T23:06:41.390

上面 NNN 提供的指向 sharekit 的链接不正确 - 试试这个：

[http://www.getsharekit.com/](http://www.getsharekit.com/)

看起来真的很有前途，并且集成的不仅仅是 Twitter！

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-16T19:24:40.887

Twitter 的 API 让您可以选择使用 XML 或 JSON 格式的提要。检查他们的[文档](http://apiwiki.twitter.com)。我对 iPhone SDK 了解不多，但它肯定有 XML 解析。

我看不到 Apple 包含 SDK 的内置 API，原因有两个：

1.  如果他们从 Twitter 开始，他们将不得不做 myspace、facebook、friendfeed 等。
2.  应用商店 atm 上有很多 Twitter 应用。如果苹果发布了一个 twitter API，他们就会面临更多的竞争，并且不会对苹果感到满意。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-07-13T14:53:25.450

尝试使用[ShareKit](http://getsharekit.com/)。

它还支持 Facebook、Delicious、Tumblr 等其他服务。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-12-14T23:29:09.730

[DETweetComposeViewController](https://github.com/doubleencore/DETweetComposeViewController)

适用于 iOS 4 或更高版本。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-02-28T06:29:38.587

Twitterific 的开发人员 Matt Gemmell 和 Craig Hockenberry 创建了[MGTwitterEngine](http://mattgemmell.com/2008/02/22/mgtwitterengine-twitter-from-cocoa)，这是一个易于使用的类库，提供的方法使开发人员可以非常轻松地访问 Twitter API。看到我相信还有一些其他的库，但它也很容易推出你自己的库，因为就像 Macha 上面所说的那样，Twitter 的 API 让你可以选择使用 XML 或 JSON 格式的提要。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-11-27T01:18:42.067

我会使用[FHSTwitterEngine](https://github.com/fhsjaagshs/FHSTwitterEngine)。它是一个同步库，因此您可以实时获取 Twitter 数据。使用 GCD、队列和线程，您可以获得与异步相同的功能。我写的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-16T19:24:58.670

2.2.1 SDK 中没有内置用于 Twitter 的 API。我无法评论每个 NDA 的 3.0 beta 限制，但你不应该期望 Apple 在 SDK 中包含特定于服务的 API。

任何使用 Twitter 或 Web 服务的功能都必须使用现有的 API 调用进行编码，并且您可以选择使用 Interface Builder 来尽可能接近地模拟原生 iPhone 外观。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-08-23T06:52:45.830

对于 IOS 5 和更多的[推文表](https://dev.twitter.com/docs/ios/using-tweet-sheet)可以完成这项工作

# asp.net - 您必须在回发中调用 RegisterClientScriptInclude 吗？

> ID：757661
> 
> 赞同：1
> 
> 时间：2009-04-16T19:23:20.127
> 
> 标签：asp.net

我需要从代码隐藏中注册一个 javascript 文件。我很想知道这是否只需要在初始页面加载时调用，还是我也必须在每次回发时调用它？

```
string clientUrl = ResolveClientUrl("~/Includes/global.js");
if (!Page.ClientScript.IsClientScriptIncludeRegistered(GetType(), "Global"))
    Page.ClientScript.RegisterClientScriptInclude(GetType(), "Global", clientUrl); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T19:36:52.247

您应该在所有回发中注册它。检查它是否已经注册并不是真正必要的。它只会呈现一个名为“Global”的包含。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T19:30:59.373

如果文件已由 if 子句注册，您已经在检查该文件。所以在所有回发中注册它。没关系。

# c# - 星期几的整数表示

> ID：757665
> 
> 赞同：3
> 
> 时间：2009-04-16T19:23:41.623
> 
> 标签：c#, datetime, parsing

我想在 C# 中将日期对象转换为星期几的整数表示。现在，我正在解析一个 XML 文件以检索日期并将该信息存储在一个字符串中。它采用以下格式：

“2008-12-31T00:00:00.0000000+01:00”

我怎样才能把它转换成它所代表的星期几的 1 到 7 之间的数字？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-16T19:29:10.643

```
(Int32)Convert.ToDateTime("2008-12-31T00:00:00.0000000+01:00").DayOfWeek + 1 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-16T19:25:33.973

如果您将其加载到 DateTime 变量中，DateTime 会公开一个您可以转换为 int 的星期几的枚举。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-16T19:28:25.823

```
DateTime date = DateTime.Parse("2008-12-31T00:00:00.0000000+01:00");
int dayOfWeek = (int)date.DayOfWeek + 1; //DayOfWeek is 0 based, you wanted 1 based 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-16T19:28:40.877

(int)System.DateTime.Parse("2008-12-31T00:00:00.0000000+01:00").DayOfWeek + 1

# perl - 用于解析 cvs log 命令输出的 Perl 脚本

> ID：757667
> 
> 赞同：2
> 
> 时间：2009-04-16T19:24:08.160
> 
> 标签：perl, cvs

有没有人有一个 perl 脚本或包来解析 cvs log 命令的输出并将其转换为 perl 结构以供进一步处理？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T20:18:53.720

我已使用此脚本将“cvs log”输出转换为 XML。您可能会发现它很有用：

[http://www.red-bean.com/cvs2cl/](http://www.red-bean.com/cvs2cl/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T20:05:55.670

看一眼：

[http://www.mozilla.org/projects/bonsai/](http://www.mozilla.org/projects/bonsai/)

# php - 网站截图

> ID：757675
> 
> 赞同：418
> 
> 时间：2009-04-16T19:25:18.047
> 
> 标签：php, screenshot

有没有办法在 PHP 中截取网站的屏幕截图，然后将其保存到文件中？

* * *

## 回答 #1

> 赞同：288
> 
> 时间：2009-04-16T19:48:50.847

**最后编辑**： 7 年后，我仍然对这个答案表示赞成，但我想[这个](https://stackoverflow.com/questions/4912092/using-html5-canvas-javascript-to-take-screenshots "这个")答案现在要准确得多。

* * *

当然可以，但是你需要用一些东西来渲染页面。如果您真的只想使用 php，我建议您使用[HTMLTOPS](http://tufat.com/html2ps-and-html2pdf/ "HTMLTOPS")，它会渲染页面并将其输出为 ps 文件（ghostscript），然后将其转换为 .jpg、.png、.pdf .. 可能会慢一点复杂的页面（并且不支持所有的 CSS）。

否则，您可以使用[wkhtmltopdf](http://wkhtmltopdf.org/ "wkhtmltopdf")以 pdf、jpg 等格式输出 html 页面。接受 CSS2.0，使用 webkit（safari 的包装器）来呈现页面。所以应该没问题。您还必须将其安装在您的服务器上..

**更新**现在，借助新的 HTML5 和 JS 功能，还可以使用 JavaScript 将页面呈现为画布对象。这是一个很好的库：[Html2Canvas](http://html2canvas.hertzen.com/)，[这是同一作者的一个实现](http://hertzen.com/experiments/jsfeedback/)，用于获得像 G+ 这样的反馈。将 dom 渲染到画布中后，您可以通过 ajax 发送到服务器并将其保存为 jpg。

**编辑**：您可以使用 imagemagick 工具将 pdf 转换为 png。我的 wkhtmltopdf 版本不支持图片。例如`convert html.pdf -append html.png`。

**编辑**：[这个小 shell 脚本](http://www.os-cms.net/blog/view/5/how-to-create-a-screen-dump-with-php-on-linux)在 linux 上使用 php5-cli 和上面提到的工具提供了一个简单/但有效的使用示例。

**编辑**：我现在注意到 wkhtmltopdf 团队正在开发另一个项目：wkhtmltoimage，它直接为您提供 jpg

* * *

## 回答 #2

> 赞同：88
> 
> 时间：2010-12-24T14:31:30.283

从 PHP 5.2.2**开始，可以仅使用 PHP 捕获网站**！

> **imagegrabscreen** — 捕获整个屏幕

```
<?php
$img = imagegrabscreen();
imagepng($img, 'screenshot.png');
?> 
```

> **imagegrabwindow** - 使用窗口句柄（COM 实例中的 HWND 属性）抓取窗口或其客户区

```
<?php
$Browser = new COM('InternetExplorer.Application');
$Browserhandle = $Browser->HWND;
$Browser->Visible = true;
$Browser->Fullscreen = true;
$Browser->Navigate('http://www.stackoverflow.com');

while($Browser->Busy){
  com_message_pump(4000);
}

$img = imagegrabwindow($Browserhandle, 0);
$Browser->Quit();
imagepng($img, 'screenshot.png');
?> 
```

编辑：**请注意，这些功能仅在 Windows 系统上可用！**

* * *

## 回答 #3

> 赞同：58
> 
> 时间：2014-03-12T05:36:21.030

如果您不想使用任何第三方工具，我遇到了使用[Google Page Insight](https://developers.google.com/speed/pagespeed/insights/) api 的简单解决方案。

只需要使用 params 调用它的 api 即可`screenshot=true`。

```
https://www.googleapis.com/pagespeedonline/v1/runPagespeed?
url=https://stackoverflow.com/&key={your_api_key}&screenshot=true 
```

对于参数中的移动站点视图传递`&strategy=mobile`，

```
https://www.googleapis.com/pagespeedonline/v1/runPagespeed?
url=http://stackoverflow.com/&key={your_api_key}&screenshot=true&strategy=mobile 
```

[***演示***](https://developers.google.com/speed/pagespeed/insights/?url=www.stackoverflow.com)。

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2013-08-07T07:27:24.977

您可以使用简单的无头浏览器（例如 PhantomJS）来抓取页面。

您也可以将 PhantomJS 与 PHP 一起使用。

查看执行此操作的这个小 php 脚本。看看这里[https://github.com/microweber/screen](https://github.com/microweber/screen)

这是 API - [http://screen.microweber.com/shot.php?url=https://stackoverflow.com/questions/757675/website-screenshots-using-php](http://screen.microweber.com/shot.php?url=https://stackoverflow.com/questions/757675/website-screenshots-using-php)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2019-03-07T14:05:46.973

有很多选择，它们都有自己的优点和缺点。以下是按实施难度排序的选项列表。

# 选项 1：使用 API（最简单）

*   [ApiFlash](https://apiflash.com/)（基于 chrome）
*   [EvoPDF](http://www.evopdf.com)（有 html 选项）
*   [格拉布齐特](https://grabz.it/html-to-pdf-image-api.aspx)
*   ...

**优点**

*   执行 Javascript
*   近乎完美的渲染
*   正确使用缓存选项时速度快
*   规模由 API 处理
*   精确的时间，视口，...
*   大多数时候他们提供免费计划

**缺点**

*   如果您打算大量使用它们，则不是免费的

# 选项 2：使用众多可用库之一

*   [域到图像](https://github.com/tsayen/dom-to-image)
*   [wkhtmltoimage](https://github.com/wkhtmltopdf/wkhtmltopdf)（包含在 wkhtmltopdf 工具中）
*   [phpwkhtmltopdf](https://github.com/mikehaertl/phpwkhtmltopdf)
*   ...

**优点**

*   大多数时候转换速度很快

**缺点**

*   渲染不良
*   不执行 javascript
*   不支持最近的 Web 功能（FlexBox、高级选择器、Webfonts、Box Sizing、媒体查询、HTML5 标签...）
*   有时不那么容易安装
*   规模复杂

# 选项 3：使用 PhantomJs 和包装库

*   [幻影](http://phantomjs.org/)
*   [php-phantomjs](http://jonnnnyw.github.io/php-phantomjs/)（PhantomJs 的 php 包装库）
*   ...

**优点**

*   执行 Javascript
*   蛮快

**缺点**

*   渲染不良
*   PhantomJs 已被弃用，不再维护。
*   不支持最近的 Web 功能（FlexBox、高级选择器、Webfonts、Box Sizing、媒体查询、HTML5 标签...）
*   规模复杂
*   如果要加载图像，要让它工作就不是那么容易了……

# 选项 4：使用 Chrome Headless 和包装库

*   [无头镀铬](https://developers.google.com/web/updates/2017/04/headless-chrome)
*   [chrome-devtools-协议](https://chromedevtools.github.io/devtools-protocol/)
*   [傀儡师](https://github.com/nesk/puphpeteer)
*   ...

**优点**

*   执行 Javascript
*   近乎完美的渲染

**缺点**

*   获得关于以下方面的确切结果并不容易：
    *   页面加载时间
    *   代理集成
    *   自动滚动
    *   ...
*   规模复杂
*   如果 html 包含外部链接，则相当慢甚至更慢

*免责声明：我是 ApiFlash 的创始人。我尽我所能提供一个诚实和有用的答案。*

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2015-12-30T01:19:13.380

嗯，PhantomJS 是一个浏览器，可以很容易地放在服务器上并将其集成到 php 中。您可以在 WDudes 中找到代码。它们包含更多功能，例如指定图像大小、缓存、下载为文件或在 img src 中显示等。

```
<img src=”screenshot.php?url=google.com” /> 
```

**网址参数**

*   宽高：screenshot.php?url=google.com&w=1000&h=800

*   裁剪：screenshot.php?url=google.com&w=1000&h=800&clipw=800&cliph=600

*   禁用缓存并加载新的屏幕截图：
    screenshot.php?url=google.com&cache=0

*   下载图片：screenshot.php?url=google.com&download=true

您可以在此处查看教程：[Capture Screenshot of a Website using PHP without API](http://www.wdudes.com/capture-screenshot-website-using-php-without-api/)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2013-08-19T19:10:11.063

cutycapt 将网页保存为大多数图像格式（jpg，png ..）从您的突触下载它，它比 wkhtmltopdf 好得多

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2017-04-27T08:07:14.893

有很多开源项目可以生成截图。例如 PhantomJS、webkit2png 等

这些项目的最大问题是它们基于较旧的浏览器技术，并且在渲染许多网站时存在问题，尤其是在过去几个月/几年中使用 webfonts、flexbox、svg 以及 HTML5 和 CSS 规范的各种其他补充的网站。

我尝试了一些第三方服务，大多数都是基于 PhantomJS，这意味着它们也会生成质量很差的屏幕截图。生成网站截图的最佳第三方服务是[urlbox.io](https://urlbox.io)。这是一项付费服务​​，尽管有 7 天的免费试用期可以在不承诺任何付费计划的情况下对其进行测试。

[这是文档的链接](https://urlbox.io/docs)，下面是使用 Composer 在 PHP 中工作的简单步骤。

```
// 1 . Get the urlbox/screenshots composer package (on command line):
composer require urlbox/screenshots

// 2\. Set up the composer package with Urlbox API credentials:
$urlbox = UrlboxRenderer::fromCredentials('API_KEY', 'API_SECRET');

// 3\. Set your options (all options such as full page/full height screenshots, retina resolution, viewport dimensions, thumbnail width etc can be set here. See the docs for more.)
$options['url'] = 'example.com';

// 4\. Generate the Urlbox url
$urlboxUrl = $urlbox->generateUrl($options);
// $urlboxUrl is now 'https://api.urlbox.io/v1/API_KEY/TOKEN/png?url=example.com'

// 5\. Now stick it in an img tag, when the image is loaded in browser, the API call to urlbox will be triggered and a nice PNG screenshot will be generated!
<img src="$urlboxUrl" /> 
```

例如，这里是这个页面的全高截图：

[https://api.urlbox.io/v1/ca482d7e-9417-4569-90fe-80f7c5e1c781/8f1666d1f4195b1cb84ffa5f992ee18992a2b35e/png?url=http%3A%2F%2Fstackoverflow.com%2Fquestions%2F757675%2Fwebsite-screenshots使用--%php 2F43652083%2343652083&full_page=true](https://api.urlbox.io/v1/ca482d7e-9417-4569-90fe-80f7c5e1c781/8f1666d1f4195b1cb84ffa5f992ee18992a2b35e/png?url=http%3A%2F%2Fstackoverflow.com%2Fquestions%2F757675%2Fwebsite-screenshots-using-php%2F43652083%2343652083&full_page=true)

[![由 urlbox.io 提供支持的 stackoverflow.com 问题的整页截图](https://i.stack.imgur.com/aNvYQ.jpg)](https://i.stack.imgur.com/aNvYQ.jpg)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2016-02-10T18:28:08.817

我最终使用[@boksiora 提出的 microweber/screen](https://github.com/microweber/screen)进行设置。
最初在这里尝试提到的[*链接*](http://screen.microweber.com/shot.php?url=https://stackoverflow.com/questions/757675/website-screenshots-using-php)时，我得到了：

```
Please download this script from here https://github.com/microweber/screen 
```

我在Linux上。所以如果你想运行它，你可以根据你的环境调整我的步骤。
这是我在`DOCUMENT_ROOT`文件夹上的外壳上执行的步骤：

```
$ sudo wget https://github.com/microweber/screen/archive/master.zip
$ sudo unzip master.zip
$ sudo mv screen-master screen
$ sudo chmod +x screen/bin/phantomjs
$ sudo yum install fontconfig
$ sudo yum install freetype*
$ cd screen
$ sudo curl -sS https://getcomposer.org/installer | php
$ sudo php composer.phar update
$ cd ..
$ sudo chown -R apache screen
$ sudo chgrp -R www screen
$ sudo service httpd restart 
```

将您的浏览器指向`screen/demo/shot.php?url=google.com`. 当你看到[截图](http://web.tophyips.info/screen/demo/shot.php?w=1366&clipw=750&cliph=600&url=google.com)时，你就完成了。更多高级设置的讨论可[*在此处*](https://stackoverflow.com/questions/11340038/phantomjs-not-waiting-for-full-page-load)和[*此处*](https://stackoverflow.com/questions/16807212/how-to-wait-for-element-visibility-in-phantomjs)获得。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-05-13T15:58:55.227

我在 Windows 上，所以在阅读了 stephan 的提示后，我能够使用 imagegrabwindow 功能。我添加了裁剪（以摆脱浏览器标题、滚动条等）和调整大小以获得最终图像。这是[我的代码](http://www.inkplant.com/code/website-screenshots-with-php.php)。希望对某人有所帮助。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-07-16T10:50:05.283

这完全取决于您希望如何截取屏幕截图。

您可以通过 PHP 执行此操作，使用 Web 服务为您获取图像

grabz.it 有一个网络服务可以做到这一点，这里有一篇文章展示了一个使用该服务的简单示例。

[http://www.phpbuilder.com/articles/news-reviews/miscellaneous/capture-screenshots-in-php-with-grabzit-120524022959.html](http://www.phpbuilder.com/articles/news-reviews/miscellaneous/capture-screenshots-in-php-with-grabzit-120524022959.html)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2012-03-18T10:45:03.860

我用过[布鲁加](http://webthumb.bluga.net/home)。该 api 允许您每月拍摄 100 张快照而无需付费，但有时它会为单个页面使用超过 1 个积分。我刚刚将一个 drupal 模块[Bluga WebThumbs](http://drupal.org/project/bluga)升级到了 drupal 7，它允许您在模板或输入过滤器中打印缩略图。

使用此 api 的主要优点是它允许您在使用自适应 css 的情况下指定浏览器尺寸，因此我使用它来获取移动设备和平板电脑布局以及常规布局的渲染。

有以下语言的 api 客户端：

[PHP](http://webthumb.bluga.net/wrapper-php-)、 [Python](http://webthumb.bluga.net/wrapper-python)、 [Ruby](http://webthumb.bluga.net/wrapper-ruby)、 [Java](http://webthumb.bluga.net/wrapper-java)、 [.Net C#](http://webthumb.bluga.net/wrapper-dotnet)、 [Perl](http://webthumb.bluga.net/wrapper-perl) 和[Bash](http://timothybrown.tumblr.com/post/102487779/easythumb-wrapper-for-bash)（shell 脚本看起来需要 perl）

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2019-04-27T11:50:14.387

在网上冲浪了很多之后，我发现了这个。

[PPTRAAS](https://pptraas.com/) > 通过将 URL 作为参数传递来捕获屏幕截图的免费工具

他们只需点击其 URL 即可提供多种选择。

1.  **获取整页截图**

    [https://pptraas.com/screenshot?url=](https://pptraas.com/screenshot?url=) {您在此处的网址}

2.  **获取特定大小的页面截图**

    [https://pptraas.com/screenshot?url=](https://pptraas.com/screenshot?url=) {您的网址}&size=400,400

3.  **甚至可以将页面转换为 pdf**

    [https://pptraas.com/pdf?url=](https://pptraas.com/pdf?url=) {您在此处的网址}

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-06-14T07:20:20.700

您可以使用[https://grabz.it](https://grabz.it)解决方案。

它有一个非常灵活的 PHP API，可以通过不同的方式调用，例如从 cronjob 或 PHP 网页调用。

为了实现它，您首先需要获取[应用程序密钥和秘密](https://grabz.it/api/#Key)并[下载](https://grabz.it/api/php/download.aspx)（免费）SDK。

和一个实施的例子。首先初始化：

```
include("GrabzItClient.class.php");

// Create the GrabzItClient class
// Replace "APPLICATION KEY", "APPLICATION SECRET" with the values from your account!
$grabzIt = new GrabzItClient("Sign in to view your Application Key", "Sign in to view your Application Secret"); 
```

和截图示例：

```
// To take a image screenshot
$grabzIt->URLToImage("http://www.google.com");  
// Or to take a PDF screenshot
$grabzIt->URLToPDF("http://www.google.com");
// Or to convert online videos into animated GIF's
$grabzIt->URLToAnimation("http://www.example.com/video.avi");
// Or to capture table(s)
$grabzIt->URLToTable("http://www.google.com"); 
```

接下来是保存。您可以使用两种保存方法之一，`Save`如果可公开访问的回调句柄可用，`SaveTo`否则。检查文档以获取[详细信息](https://grabz.it/api/php/)。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-07-23T02:41:16.067

有一些方法可以在 PHP 中实现这一点，但实际上最好将其委托给非 PHP 的 API，您可以自己构建或付费。许多人已经在答案中列出了屏幕截图 API，您可以使用其中任何一个来实现这一点。我自己的[屏幕截图 API](https://www.getscreenshotapi.com)经过了非常好的测试，涵盖了大多数 API 未涵盖的许多渲染案例，但老实说，对于大多数人来说，这太过分了。

我的建议是使用 Puppeteer 构建您自己的 API，这是当今构建屏幕截图解决方案的规范解决方案。我的服务 GetScreenshot 建立在 Puppeteer 之上。

[您可以使用https://www.npmjs.com/package/chrome-aws-lambda](https://www.npmjs.com/package/chrome-aws-lambda)之类的东西在 AWS 或 GCP 上构建无服务器 Puppeteer 解决方案，这是一个预装 Chromium 的优秀 Puppeteer 无服务器包。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2009-04-16T19:31:22.977

不是直接的。Selenium 之类的软件具有这样的功能，可以由 PHP 控制，但具有其他依赖项（例如在您要截屏的浏览器的计算机上运行其基于 java 的服务器）

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2016-11-22T20:56:34.763

你可以使用 cutycapt 。

kwhtml 已弃用，并像旧浏览器一样显示页面。

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2018-01-25T20:40:19.607

我发现这是最好和最简单的工具：[ScreenShotMachine](https://www.screenshotmachine.com/)。这是一项付费服务​​，但您可以获得 100 个免费屏幕截图，并且您可以以（约）20 美元的价格再购买 2,000 个，所以这是一笔非常划算的交易。它有一个非常简单的用法，你只需要一个 URL，所以我写了这个小脚本来保存一个基于它的文件：

```
<?php
  $url = file_get_contents("http://api.screenshotmachine.com/?key={mykey}&url=https://stackoverflow.com&size=X");

  $file = fopen("snapshots/stack.jpg", "w+");
  fwrite($file, $url);
  fclose($file);
  die("saved file!");
?> 
```

他们在[这里](https://www.screenshotmachine.com/apiguide.php)有一个非常好的文档，所以你一定要看看。

# c# - 枚举“继承”

> ID：757684
> 
> 赞同：442
> 
> 时间：2009-04-16T19:27:07.667
> 
> 标签：c#, .net, enums

我在低级命名空间中有一个枚举。我想在“继承”低级枚举的中级命名空间中提供一个类或枚举。

```
namespace low
{
   public enum base
   {
      x, y, z
   }
}

namespace mid
{
   public enum consume : low.base
   {
   }
} 
```

我希望这是可能的，或者可能是某种可以代替枚举消耗的类，它将为枚举提供一个抽象层，但仍然让该类的实例访问枚举。

想法？

编辑：我不只是在类中将其切换为 consts 的原因之一是我必须使用的服务需要低级枚举。我得到了 WSDL 和 XSD，它们将结构定义为枚举。服务无法更改。

* * *

## 回答 #1

> 赞同：513
> 
> 时间：2009-04-16T19:45:07.220

这是不可能的。枚举不能从其他枚举继承。事实上，所有枚举实际上都必须继承自`System.Enum`. C# 允许语法更改枚举值的底层表示，这看起来像继承，但实际上它们仍然继承自 System.enum。

[有关详细信息，请参阅CLI 规范](http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-335.pdf)的第 8.5.2 节。规范中的相关信息

*   所有枚举必须来自`System.Enum`
*   由于上述原因，所有枚举都是值类型，因此是密封的

* * *

## 回答 #2

> 赞同：174
> 
> 时间：2009-04-16T20:00:29.240

你可以通过类实现你想要的：

```
public class Base
{
    public const int A = 1;
    public const int B = 2;
    public const int C = 3;
}
public class Consume : Base
{
    public const int D = 4;
    public const int E = 5;
} 
```

现在您可以像使用枚举时一样使用这些类：

```
int i = Consume.B; 
```

**更新**（在您更新问题之后）：

如果将相同的 int 值分配给现有枚举中定义的常量，则可以在枚举和常量之间进行转换，例如：

```
public enum SomeEnum // this is the existing enum (from WSDL)
{
    A = 1,
    B = 2,
    ...
}
public class Base
{
    public const int A = (int)SomeEnum.A;
    //...
}
public class Consume : Base
{
    public const int D = 4;
    public const int E = 5;
}

// where you have to use the enum, use a cast:
SomeEnum e = (SomeEnum)Consume.B; 
```

* * *

## 回答 #3

> 赞同：128
> 
> 时间：2009-04-16T19:36:38.800

最简洁的答案是不。如果你愿意，你可以玩一点：

你总是可以做这样的事情：

```
private enum Base
{
    A,
    B,
    C
}

private enum Consume
{
    A = Base.A,
    B = Base.B,
    C = Base.C,
    D,
    E
} 
```

但是，它并没有那么好用，因为 Base.A != Consume.A

不过，您总是可以这样做：

```
public static class Extensions
{
    public static T As<T>(this Consume c) where T : struct
    {
        return (T)System.Enum.Parse(typeof(T), c.ToString(), false);
    }
} 
```

为了在基础和消费之间跨越...

您也可以将枚举的值转换为整数，并将它们作为整数而不是枚举进行比较，但这也很糟糕。

扩展方法返回应该类型转换为 T 类型。

* * *

## 回答 #4

> 赞同：105
> 
> 时间：2010-10-28T12:19:22.600

上面使用具有 int 常量的类的解决方案缺乏类型安全性。即，您可以发明实际上未在类中定义的新值。此外，不可能编写一个将这些类之一作为输入的方法。

你需要写

```
public void DoSomethingMeaningFull(int consumeValue) ... 
```

但是，当没有可用的枚举时，有一个基于类的 Java 旧时代的解决方案。这提供了几乎类似枚举的行为。唯一需要注意的是，这些常量不能在 switch 语句中使用。

```
public class MyBaseEnum
{
    public static readonly MyBaseEnum A = new MyBaseEnum( 1 );
    public static readonly MyBaseEnum B = new MyBaseEnum( 2 );
    public static readonly MyBaseEnum C = new MyBaseEnum( 3 );

    public int InternalValue { get; protected set; }

    protected MyBaseEnum( int internalValue )
    {
        this.InternalValue = internalValue;
    }
}

public class MyEnum : MyBaseEnum
{
    public static readonly MyEnum D = new MyEnum( 4 );
    public static readonly MyEnum E = new MyEnum( 5 );

    protected MyEnum( int internalValue ) : base( internalValue )
    {
        // Nothing
    }
}

[TestMethod]
public void EnumTest()
{
    this.DoSomethingMeaningful( MyEnum.A );
}

private void DoSomethingMeaningful( MyBaseEnum enumValue )
{
    // ...
    if( enumValue == MyEnum.A ) { /* ... */ }
    else if (enumValue == MyEnum.B) { /* ... */ }
    // ...
} 
```

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2009-04-16T19:44:41.637

忽略 base 是保留字这一事实，您无法继承枚举。

你能做的最好的事情是这样的：

```
public enum Baseenum
{
   x, y, z
}

public enum Consume
{
   x = Baseenum.x,
   y = Baseenum.y,
   z = Baseenum.z
}

public void Test()
{
   Baseenum a = Baseenum.x;
   Consume newA = (Consume) a;

   if ((Int32) a == (Int32) newA)
   {
   MessageBox.Show(newA.ToString());
   }
} 
```

由于它们都是相同的基本类型（即：int），您可以将值从一种类型的实例分配给另一种类型的实例。不理想，但它工作。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2014-05-02T14:10:03.670

我知道这个答案有点晚了，但这就是我最终要做的：

```
public class BaseAnimal : IEquatable<BaseAnimal>
{
    public string Name { private set; get; }
    public int Value { private set; get; }

    public BaseAnimal(int value, String name)
    {
        this.Name = name;
        this.Value = value;
    }

    public override String ToString()
    {
        return Name;
    }

    public bool Equals(BaseAnimal other)
    {
        return other.Name == this.Name && other.Value == this.Value;
    }
}

public class AnimalType : BaseAnimal
{
    public static readonly BaseAnimal Invertebrate = new BaseAnimal(1, "Invertebrate");

    public static readonly BaseAnimal Amphibians = new BaseAnimal(2, "Amphibians");

    // etc        
}

public class DogType : AnimalType
{
    public static readonly BaseAnimal Golden_Retriever = new BaseAnimal(3, "Golden_Retriever");

    public static readonly BaseAnimal Great_Dane = new BaseAnimal(4, "Great_Dane");

    // etc        
} 
```

**然后我可以执行以下操作：**

```
public void SomeMethod()
{
    var a = AnimalType.Amphibians;
    var b = AnimalType.Amphibians;

    if (a == b)
    {
        // should be equal
    }

    // call method as
    Foo(a);

    // using ifs
    if (a == AnimalType.Amphibians)
    {
    }
    else if (a == AnimalType.Invertebrate)
    {
    }
    else if (a == DogType.Golden_Retriever)
    {
    }
    // etc          
}

public void Foo(BaseAnimal typeOfAnimal)
{
} 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2017-02-24T19:21:28.863

这就是我所做的。我所做的不同之处是`new`在“消费”上使用相同的名称和关键字`enum`。由于名称`enum`相同，您可以随意使用它，它会是正确的。另外，您可以获得智能感知。您只需在设置时手动注意从基础复制值并使其保持同步。您可以通过代码注释来帮助解决这个问题。`enum`这是在数据库中存储值时我总是存储字符串而不是值的另一个原因。因为如果您使用自动分配的递增整数值，这些值可能会随着时间而变化。

```
// Base Class for balls 
public class Ball
{
    // keep synced with subclasses!
    public enum Sizes
    {
        Small,
        Medium,
        Large
    }
}

public class VolleyBall : Ball
{
    // keep synced with base class!
    public new enum Sizes
    {
        Small  = Ball.Sizes.Small,
        Medium = Ball.Sizes.Medium,
        Large  = Ball.Sizes.Large,
        SmallMedium,
        MediumLarge,
        Ginormous
    }
} 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2019-12-25T02:46:05.903

# 替代解决方案

在我的公司，我们避免“跳过项目”来处理不常见的较低级别的项目。比如我们的表现层/API层只能引用我们的领域层，而领域层只能引用数据层。

但是，当存在表示层和域层都需要引用的枚举时，这是一个问题。

这是我们已经实施的解决方案（到目前为止）。这是一个很好的解决方案，对我们来说效果很好。其他答案都围绕着这个问题展开。

基本前提是枚举不能被继承——但类可以。所以...

```
// In the lower level project (or DLL)...
public abstract class BaseEnums
{
    public enum ImportanceType
    {
        None = 0,
        Success = 1,
        Warning = 2,
        Information = 3,
        Exclamation = 4
    }

    [Flags]
    public enum StatusType : Int32
    {
        None = 0,
        Pending = 1,
        Approved = 2,
        Canceled = 4,
        Accepted = (8 | Approved),
        Rejected = 16,
        Shipped = (32 | Accepted),
        Reconciled = (64 | Shipped)
    }

    public enum Conveyance
    {
        None = 0,
        Feet = 1,
        Automobile = 2,
        Bicycle = 3,
        Motorcycle = 4,
        TukTuk = 5,
        Horse = 6,
        Yak = 7,
        Segue = 8
    } 
```

然后，在另一个更高级别的项目中“继承”枚举......

```
// Class in another project
public sealed class SubEnums: BaseEnums
{
   private SubEnums()
   {}
} 
```

这具有三个真正的优势......

1.  根据定义，两个项目中的枚举定义自动相同。
2.  对枚举定义的任何更改都会在第二个类中自动回显，而无需对第二个类进行任何修改。
3.  枚举基于相同的代码 - 因此可以轻松比较这些值（有一些警告）。

要引用第**一个项目**中的枚举，可以使用类的前缀：**BaseEnums.StatusType.Pending**或添加*“使用静态 BaseEnums;”* 声明你的用途。

然而，在处理继承类的**第二个项目**中，我无法让*“使用静态...”*方法工作，因此对“继承枚举”的所有引用都将以类为前缀，例如**SubEnums.StatusType.Pending** . 如果有人想出一种方法来允许在第二个项目中使用*“使用静态”*方法，请告诉我。

我确信可以对其进行调整以使其变得更好-但这确实有效，并且我在工作项目中使用了这种方法。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2017-07-02T20:33:34.363

我还想重载 Enums，并[在此页面上创建了“七”](https://stackoverflow.com/a/4042826)的答案和[此重复帖子上的“Merlyn Morgan-Graham”的答案](https://stackoverflow.com/a/4704357/2505186)，再加上一些改进。
我的解决方案与其他解决方案相比的主要优势：

*   基础 int 值的自动递增
*   自动命名

*这是一个开箱即用的解决方案，可以直接插入到您的项目中。它是根据我的需要设计的，所以如果你不喜欢它的某些部分，只需用你自己的代码替换它们。*

首先，`CEnum`所有自定义枚举都应继承自基类。它具有基本功能，类似于 .net`Enum`类型：

```
public class CEnum
{
  protected static readonly int msc_iUpdateNames  = int.MinValue;
  protected static int          ms_iAutoValue     = -1;
  protected static List<int>    ms_listiValue     = new List<int>();

  public int Value
  {
    get;
    protected set;
  }

  public string Name
  {
    get;
    protected set;
  }

  protected CEnum ()
  {
    CommonConstructor (-1);
  }

  protected CEnum (int i_iValue)
  {
    CommonConstructor (i_iValue);
  }

  public static string[] GetNames (IList<CEnum> i_listoValue)
  {
    if (i_listoValue == null)
      return null;
    string[] asName = new string[i_listoValue.Count];
    for (int ixCnt = 0; ixCnt < asName.Length; ixCnt++)
      asName[ixCnt] = i_listoValue[ixCnt]?.Name;
    return asName;
  }

  public static CEnum[] GetValues ()
  {
    return new CEnum[0];
  }

  protected virtual void CommonConstructor (int i_iValue)
  {
    if (i_iValue == msc_iUpdateNames)
    {
      UpdateNames (this.GetType ());
      return;
    }
    else if (i_iValue > ms_iAutoValue)
      ms_iAutoValue = i_iValue;
    else
      i_iValue = ++ms_iAutoValue;

    if (ms_listiValue.Contains (i_iValue))
      throw new ArgumentException ("duplicate value " + i_iValue.ToString ());
    Value = i_iValue;
    ms_listiValue.Add (i_iValue);
  }

  private static void UpdateNames (Type i_oType)
  {
    if (i_oType == null)
      return;
    FieldInfo[] aoFieldInfo = i_oType.GetFields (BindingFlags.Public | BindingFlags.Static);

    foreach (FieldInfo oFieldInfo in aoFieldInfo)
    {
      CEnum oEnumResult = oFieldInfo.GetValue (null) as CEnum;
      if (oEnumResult == null)
        continue;
      oEnumResult.Name = oFieldInfo.Name;
    }
  }
} 
```

其次，这里有 2 个派生的 Enum 类。所有派生类都需要一些基本方法才能按预期工作。它总是相同的样板代码；我还没有找到将它外包给基类的方法。第一级继承的代码与所有后续级别略有不同。

```
public class CEnumResult : CEnum
{
  private   static List<CEnumResult>  ms_listoValue = new List<CEnumResult>();

  public    static readonly CEnumResult Nothing         = new CEnumResult (  0);
  public    static readonly CEnumResult SUCCESS         = new CEnumResult (  1);
  public    static readonly CEnumResult UserAbort       = new CEnumResult ( 11);
  public    static readonly CEnumResult InProgress      = new CEnumResult (101);
  public    static readonly CEnumResult Pausing         = new CEnumResult (201);
  private   static readonly CEnumResult Dummy           = new CEnumResult (msc_iUpdateNames);

  protected CEnumResult () : base ()
  {
  }

  protected CEnumResult (int i_iValue) : base (i_iValue)
  {
  }

  protected override void CommonConstructor (int i_iValue)
  {
    base.CommonConstructor (i_iValue);

    if (i_iValue == msc_iUpdateNames)
      return;
    if (this.GetType () == System.Reflection.MethodBase.GetCurrentMethod ().DeclaringType)
      ms_listoValue.Add (this);
  }

  public static new CEnumResult[] GetValues ()
  {
    List<CEnumResult> listoValue = new List<CEnumResult> ();
    listoValue.AddRange (ms_listoValue);
    return listoValue.ToArray ();
  }
}

public class CEnumResultClassCommon : CEnumResult
{
  private   static List<CEnumResultClassCommon> ms_listoValue = new List<CEnumResultClassCommon>();

  public    static readonly CEnumResult Error_InternalProgramming           = new CEnumResultClassCommon (1000);

  public    static readonly CEnumResult Error_Initialization                = new CEnumResultClassCommon ();
  public    static readonly CEnumResult Error_ObjectNotInitialized          = new CEnumResultClassCommon ();
  public    static readonly CEnumResult Error_DLLMissing                    = new CEnumResultClassCommon ();
  // ... many more
  private   static readonly CEnumResult Dummy                               = new CEnumResultClassCommon (msc_iUpdateNames);

  protected CEnumResultClassCommon () : base ()
  {
  }

  protected CEnumResultClassCommon (int i_iValue) : base (i_iValue)
  {
  }

  protected override void CommonConstructor (int i_iValue)
  {
    base.CommonConstructor (i_iValue);

    if (i_iValue == msc_iUpdateNames)
      return;
    if (this.GetType () == System.Reflection.MethodBase.GetCurrentMethod ().DeclaringType)
      ms_listoValue.Add (this);
  }

  public static new CEnumResult[] GetValues ()
  {
    List<CEnumResult> listoValue = new List<CEnumResult> (CEnumResult.GetValues ());
    listoValue.AddRange (ms_listoValue);
    return listoValue.ToArray ();
  }
} 
```

这些类已使用以下代码成功测试：

```
private static void Main (string[] args)
{
  CEnumResult oEnumResult = CEnumResultClassCommon.Error_Initialization;
  string sName = oEnumResult.Name;   // sName = "Error_Initialization"

  CEnum[] aoEnumResult = CEnumResultClassCommon.GetValues ();   // aoEnumResult = {testCEnumResult.Program.CEnumResult[9]}
  string[] asEnumNames = CEnum.GetNames (aoEnumResult);
  int ixValue = Array.IndexOf (aoEnumResult, oEnumResult);    // ixValue = 6
} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2019-10-25T12:51:34.357

我意识到我参加这个聚会有点晚了，但这是我的两分钱。

我们都清楚框架不支持枚举继承。在这个线程中提出了一些非常有趣的解决方法，但它们都不像我正在寻找的那样，所以我自己尝试了一下。

介绍：对象枚举

您可以在此处查看代码和文档：[https](https://github.com/dimi3tron/ObjectEnum) ://github.com/dimi3tron/ObjectEnum 。

和这里的包：[https ://www.nuget.org/packages/ObjectEnum](https://www.nuget.org/packages/ObjectEnum)

或者只是安装它：`Install-Package ObjectEnum`

简而言之，`ObjectEnum<TEnum>`充当任何枚举的包装器。通过覆盖子类中的 GetDefinedValues()，可以指定哪些枚举值对这个特定类有效。

添加了许多运算符重载以使`ObjectEnum<TEnum>`实例表现得好像它是底层枚举的实例，同时牢记定义的值限制。这意味着您可以轻松地将实例与 int 或 enum 值进行比较，从而在 switch case 或任何其他条件下使用它。

我想参考上面提到的 github repo 以获取示例和更多信息。

希望这个对你有帮助。随意评论或在 github 上打开问题以获取更多想法或评论。

以下是您可以使用的一些简短示例`ObjectEnum<TEnum>`：

```
var sunday = new WorkDay(DayOfWeek.Sunday); //throws exception
var monday = new WorkDay(DayOfWeek.Monday); //works fine
var label = $"{monday} is day {(int)monday}." //produces: "Monday is day 1."
var mondayIsAlwaysMonday = monday == DayOfWeek.Monday; //true, sorry...

var friday = new WorkDay(DayOfWeek.Friday);

switch((DayOfWeek)friday){
    case DayOfWeek.Monday:
        //do something monday related
        break;
        /*...*/
    case DayOfWeek.Friday:
        //do something friday related
        break;
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-04-16T19:39:46.997

枚举不是实际的类，即使它们看起来很像。在内部，它们的处理方式与它们的基础类型一样（默认为 Int32）。因此，您只能通过将单个值从一个枚举“复制”到另一个枚举并将它们转换为它们的整数来比较它们是否相等来做到这一点。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-04-16T19:50:43.227

枚举不能从其他枚举派生，而只能从 int、uint、short、ushort、long、ulong、byte 和 sbyte 派生。

就像 Pascal 所说，您可以使用其他枚举的值或常量来初始化枚举值，但仅此而已。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2016-11-16T15:30:32.183

另一种可能的解决方案：

```
public enum @base
{
    x,
    y,
    z
}

public enum consume
{
    x = @base.x,
    y = @base.y,
    z = @base.z,

    a,b,c
}

// TODO: Add a unit-test to check that if @base and consume are aligned 
```

高温高压

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2017-03-20T16:47:13.057

这是不可能的（正如@JaredPar 已经提到的）。试图用逻辑来解决这个问题是一种不好的做法。如果你有`base class`一个`enum`，你应该列出所有可能的`enum-values`，并且类的实现应该使用它知道的值。

例如，假设您有一个基类`BaseCatalog`，并且它有一个`enum ProductFormats`( `Digital`, `Physical`)。然后你可以有一个`MusicCatalog`or`BookCatalog`可以同时包含`Digital`和`Physical`产品，但如果类是`ClothingCatalog`，它应该只包含`Physical`产品。

* * *

## 回答 #15

> 赞同：-8
> 
> 时间：2011-12-14T14:14:03.537

您可以在枚举中执行继承，但仅限于以下类型。int, uint, byte, sbyte, 短, ushort, 长, ulong

例如

```
public enum Car:int{
Toyota,
Benz,
} 
```

# java - 您会为共享软件/免费软件桌面应用程序使用什么语言/平台？

> ID：757688
> 
> 赞同：2
> 
> 时间：2009-04-16T19:28:02.737
> 
> 标签：java, c++, wpf, qt, desktop-application

我有一个几年前用 MFC 编写的 DVD 编目应用程序。记录保存在 sqlite 数据库中，所以基本上它是一个 CRUD 应用程序。UI 方面，它在左侧有一个树视图，在右上方有一个列表视图（网格），在右下方有一个 HTML 视图（嵌入式 IE）。没有什么花哨。

我想用更多功能更新应用程序，但过去几年我一直在使用 Java EE，我意识到使用 MFC 根本没有效率。所以我在想也许我应该用别的东西来提高我的工作效率。跨平台将是一个很大的好处，但这并不是绝对必要的。

以下是基于我的研究的选项：

*   Java / Swing：我可以利用我的Java知识；优秀的第三方库（例如用于 IoC 的 Spring 和用于 ORM 的 Hibernate）；跨平台。缺点是，用户需要 JRE；Swing 似乎处于“维护”模式，并没有得到 Sun 的太多关注。
*   C++/Qt：本机应用程序；跨平台。但我是 Qt 的新手，所以我必须先学习它。
*   C# / WPF：WPF 似乎是 Windows GUI 开发的未来，一些 WPF 示例应用程序给我留下了深刻的印象。我有一些 C# 经验，但我需要学习 WPF。缺点是，仅限 Windows；需要 .NET 3.5 运行时。

那么，如果您处于我的情况，您会使用什么？在此先感谢您的任何建议。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T19:32:09.620

如果您想在开发此应用程序时学习一些新技能，那么如果您在 Java 中没有 C#/WPF 和 LINQ，那么 C# 3.0 中的 LINQ 真的很棒。

如果您只想加快速度，那么您已经回答了自己的问题，Java / Swing。这是你擅长的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T19:36:52.310

我实际上是 C# 的忠实粉丝，但既然你说跨平台将是一个巨大的好处，我认为 Qt 实际上可能会更好。C# 可以通过 Mono 跨平台，但在这方面我使用[Qt](http://qt.nokia.com/)获得了更好的结果。他们在 QtAssistant 中也有非常好的文档来帮助您入门。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-16T23:44:32.353

在大多数情况下，只要项目范围相当小，并且计算需求适中，我倾向于使用[TCL/Tk](http://www.tcl.tk/about/)。我还没有学习到比 tk 更有效率的 gui api（并不是说没有，只是我尝试了几个，发现它们更慢）。可以肯定的是，TCL 并不是最好的编程语言，尽管有许多附加组件很有帮助，特别是`[`[incr tcl](http://incrtcl.sourceforge.net/itcl/)`]`和[tcllib](http://tcllib.sourceforge.net/doc/index.html)。

我选择这个而不是其他系统的原因，例如，我更喜欢在 python 中编码，是因为使用 tcl/tk 进行部署几乎是无与伦比的。使用[Starkit](http://www.equi4.com/starkit/)，您最终会得到一个无需安装程序且可轻松移植的单文件可双击应用程序。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-16T23:04:58.627

如果您的生产力是一个大问题，也可以考虑使用 PyQt + Python。当我说 Qt 的学习曲线非常值得时，相信我，而且并不像起初看起来那么难。

Sqlite 支持在 Python 标准库和 Qt 中的 QSql 模块中，如果您更喜欢使用它的话。

PyQt + Python 也是一个跨平台选项，因为 Python 可用于许多平台并且 Qt 的跨平台开始。

您提到的您在应用程序中使用的控件在 Qt 中都可用。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-16T23:17:39.813

除了原始 C++ 之外，唯一的其他工具是 Delphi。时期。

使用其他工具，您将在部署中遇到问题。

使用 Delphi，您将生成独立的本地 exe。此外，数据库连接性很好。

您永远不会因缺少控件或 3d 派对工具而感到失望，其中很多是源代码和免费/商业工具集。

而且编译时间是这个星系中最快的；）

因此，如果您认真地为您的客户提供无障碍应用程序，并且客户不像开发人员那样以技术为导向，那么可能会感到困惑，因为安装了 4 个 .NET 运行时中的哪一个，需要最少的支持、易于下载、单击 - click-install-go，像 Skype、TopStyle（由 Delphi 制作）[等](http://delphi.wikia.com/wiki/Good_Quality_Applications_Built_With_Delphi)即时运行的应用程序，那么 Delphi/C++ 是您唯一的选择。严重地。唯一的选择。

* * *

如果你想要一个跨平台的解决方案，那么如果你的 GUI 是极简主义的，那么 FreePascal/Lazarus 可以工作。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-16T19:40:07.107

好吧，如果您真的想要一个类平台类型的应用程序，我会将其转换为 Web 应用程序并托管它。这样，如果一个用户上传 dvd 信息或 dvd 封面图片，另一个用户可以利用已经输入系统的信息。

如果您要为桌面开发，请尝试通过使用 OS UI 工具，让它感觉像是为该平台制作的应用程序。对于 Windows，请选择您的第三个选项 C# /WPF。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-16T20:26:42.110

除了 C#/WPF，您还可以看看 Silverlight。您的应用程序看起来很简单，启动和运行不需要太多时间。类似于在会议上展示的演示。

一旦你掌握了基础知识，就可以很容易地添加一些很酷的功能，如动画、电影剪辑、专辑封面、类似界面的封面流等。

您将能够使用 Moonlight 定位 Windows/Mac 用户和可能的 Linux。但是在过去的 8 年里我没有看过 Linux，所以我真的不能说太多。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-16T23:34:48.617

使用 Eclipse RCP，您可以获得 Java、跨平台开发（请参阅 Delta Pack）、本机外观（通过 SWT）和用于桌面开发的出色框架集合（声明性 UI、插件管理等）。你绝对应该试一试。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-16T19:50:51.947

如果您的 MFC 应用程序中有一些您想重用的非 UI 代码，请考虑使用 QT。否则选择你喜欢学习的任何东西。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-17T21:06:59.183

几个月前，当我遇到几乎完全相同的场景（使用 SQLite 数据库升级应用程序）时，我去了 C++/wxWidgets（但你可以做 Qt）路线。[wxWidgets](http://www.wxwidgets.org/)相当容易上手，拥有我需要的一切，而且比 MFC 容易得多。最好的部分是我在 CodeProject 上为 SQLite 找到了一个很好的 C++ 包装器（例如[CPPSQLite](http://www.codeproject.com/KB/database/CppSQLite.aspx)），并且很快就让整个事情运行起来了……这个项目在 wxWidgetss 上卖给了我，以防你不知道。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-18T01:21:50.007

实际上，我会非常仔细地观察像 adobe air 之类的东西。它是跨平台的，并且可以基于 html/javascript，所以除了一两个 javascript 库之外，您可能没有太多要学习的东西。它能够与本地数据存储或通过互联网与 Web 服务或 RESTFUL 服务进行通信。aptana 可以免费开发。看看里面写的一些东西：

[http://www.adobe.com/products/air/showcase/](http://www.adobe.com/products/air/showcase/)

# pdf - 如何编译 Latex 文档中 24 页的前 2 页？

> ID：757689
> 
> 赞同：3
> 
> 时间：2009-04-16T19:28:18.600
> 
> 标签：pdf, latex, compilation

我的作品在 Latex 中有超过 24 页。我只需要pdf中的摘要和介绍。你怎么能只编译前两页？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T19:45:57.840

除了[大卫的好建议](https://stackoverflow.com/questions/757689/how-can-i-compile-first-2-pages-of-24-pages-in-a-latex-document/757728#757728)，你可以简单地编译整个东西，然后从成品中提取你想要的页面。这可能是一次性任务最简单的方法。

如果您编译为 PDF，请考虑使用[pdftk](http://www.accesspdf.com/pdftk/)，它可以让您使用如下命令：

```
pdftk A=one.pdf cat A1-2 output intro.pdf 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T19:35:53.233

我只是制作一个只有摘要和介绍的新文件并编译它。

实际上，如果这不仅仅是一次性的事情，我会使用三个文件：

`absintro.tex`：

```
\begin{abstract}
  ...
\end{abstract}
...introduction... 
```

`onlyabsintro.tex`：

```
...
\begin{document}
    \include{absintro.tex}
\end{document} 
```

`fullreport.tex`：

```
...
\begin{document}
   \include{absintro.tex}
   ...other stuff...
\end{document} 
```

（很明显，文件名可以是任何你想要的，这只是显示结构）你可以编译`onlyabsintro.tex`只得到摘要和介绍，或者`fullreport.tex`得到整个东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2021-01-17T03:16:47.753

有一个包`pagesel`可以做到这一点。假设您有以下文件

```
% !TEX encoding = UTF-8 Unicode
% !TEX TS-program = xelatex
\documentclass{article}
\usepackage[1, 2]{pagesel}
\usepackage{lipsum}

\begin{document}
\centerline{page 1}
\lipsum[1]
\newpage
\centerline{page 2}
\lipsum[2]
\newpage
\centerline{page 3}
\lipsum[3]
\newpage
\centerline{page 4}
\lipsum[4]
\newpage
\centerline{page 5}
\lipsum[5]
\end{document} 
```

`\usepackage[1, 2]{pagesel}`会告诉 LaTeX 只编译第一页和第二页（`lipsum`只生成随机文本，没有必要）。

# java - 如何在 JEditorPane 中设置选项卡大小？

> ID：757692
> 
> 赞同：9
> 
> 时间：2009-04-16T19:28:40.427
> 
> 标签：java, swing, jeditorpane

`JTextArea`可以使用 轻松设置A的选项卡大小`setTabSize(int)`。

有没有类似的方法来做到这一点`JEditorPane`？

现在，我的窗格中带有选项卡的文本如下所示：

```
if (stuff){
            more stuff;
} 
```

而且，我更喜欢更小的制表位：

```
if (stuff){
    more stuff;
} 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-16T19:48:24.077

由于 JEditorPane 旨在支持不同种类的内容类型，它不提供直接指定“选项卡大小”的方法，因为其含义应由内容模型定义。但是，当您使用作为 PlainDocument 或其后代之一的模型时，有一个“tabSizeAttribute”可以提供您正在寻找的内容。

例子：

```
JEditorPane pane = new JEditorPane(...);
...
Document doc = pane.getDocument();
if (doc instanceof PlainDocument) {
    doc.putProperty(PlainDocument.tabSizeAttribute, 8);
}
... 
```

来自 Javadoc：

```
/**
 * Name of the attribute that specifies the tab
 * size for tabs contained in the content.  The
 * type for the value is Integer.
 */
public static final String tabSizeAttribute = "tabSize"; 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-04-03T17:57:31.667

如果有人使用 StyledDocument （另一个答案的链接已失效）

您创建一个 TabSet，它是一个 TabStops 数组。就我而言，我只关心第一个选项卡，我希望它距离左边 20px，所以这段代码对我有用：

```
StyleContext sc = StyleContext.getDefaultStyleContext();
TabSet tabs = new TabSet(new TabStop[] { new TabStop(20) });
AttributeSet paraSet = sc.addAttribute(SimpleAttributeSet.EMPTY, StyleConstants.TabSet, tabs);
pane.setParagraphAttributes(paraSet, false); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-10-10T21:27:48.313

我花了一段时间才弄清楚这一点。并决定在根据字体大小计算宽度的 TabSet 中使用 TabStop。当字体大小发生变化时（在 JEditPane 的 paint() 方法中），必须重新设置。

复杂的东西！:(

# .net - 在运行时枚举 .NET 嵌入式资源的内容

> ID：757696
> 
> 赞同：1
> 
> 时间：2009-04-16T19:28:59.193
> 
> 标签：.net, resources

我有一个 .resx 文件，其中包含我的项目的一些字符串资源。在运行时，我想读取此文件中定义的所有资源并将它们存储在容器中。原因并不重要。

我读过 ResourceReader 类，它对二进制 .resource 文件进行操作。我的印象是 .resx 在构建时转换为二进制格式并嵌入到程序集中。这是真的，还是我需要使用 resgen 手动生成它？如果我确实需要手动生成它，如何将它添加到我的 VS 项目中，将它嵌入到程序集中，并在运行时访问它？

简而言之，如何使用 ResourceReader 在运行时访问 .resx 中定义的资源？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T19:31:07.503

您可以使用[ResourceReader.GetEnumerator()](http://msdn.microsoft.com/en-us/library/system.resources.resourcereader.getenumerator.aspx)获取资源的枚举器。

如果您尝试直接读取 .resx 文件，您可能需要考虑使用[ResXResourceReader](http://msdn.microsoft.com/en-us/library/system.resources.resxresourcereader.aspx)而不是 ResourceReader。

如果您尝试从 .resources (resx -> resources) 中编译的内容中读取，则需要适当地修改名称。假设您将 .resX 文件命名为“MyRes.resx”，您将要使用：

```
var resManager = new ResourceManager("MyRes.resources"); 
```

但是，如果 resx 文件在附属程序集中，它将添加项目名称，即：`("MyProject.MyRes.resources");`

如果您正在使用本地化，您也将需要它：`("MyProject.MyRes.en-GB.resources");`

# c++ - 递增/递减与赋值？

> ID：757698
> 
> 赞同：1
> 
> 时间：2009-04-16T19:29:11.407
> 
> 标签：c++, statistics

我正在我的应用程序中记录一些统计数据。其中一项统计数据是 BigDataStructure 的大小。我有两个选择：

1.  每次从 BigDataStructure 中添加/删除时，创建一个计数器并增加/减少计数器。

2.  每次从 BigDataStructure 中添加/删除时，将计数器设置为 BigDataStructure.size()。

以一种或另一种方式做这件事有很好的论据吗？自己递增/递减计数器可避免调用 BigDataStructure.size()。它也不直接涉及赋值运算符（尽管它可能在幕后发生？）

鉴于这两种选择，哪一种更可取？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-16T19:32:42.630

.size() 可能是这两个选项中更不容易出错的，因为它是[idempotent](http://en.wikipedia.org/wiki/Idempotent)。如果您想解决线程/同步问题， .size() 在这里更安全。

此外，今天您只有 1 个添加条目的位置和 1 个删除条目的位置。但也许在未来不会是这样。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T19:33:34.393

这取决于...

如果 BigDataStructure.size() 需要计算大小，我会使用计数器。在这种情况下，这将更有效率。

如果 BigDataStructure.size() 是可以由 BigDataStructure 自动确定的，那么只需要很少的计算，我更喜欢这种方法。它具有将逻辑包含在一个地方的优点，因此在这方面它看起来更干净/更面向对象。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-16T19:34:45.857

两全其美，两全其美。如果您的数字不一致，您可能会发现一些奇怪的事情。这是断言的一个很好的候选人。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T19:32:35.407

递增/递减可能会更快，因为它避免了函数调用，但可能存在记录大小与实际大小不同步的风险。如果您有信心他们不会，那么我会说只使用递增/递减。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-16T19:33:40.617

我会选择选项1。

AFAIK, x++ 和 x += 1 在各个方面都与 x = x + 1 相同（除了您键入的内容）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-16T19:38:29.870

如果添加和删除是从多个线程完成的，则递增和递减需要额外注意。另一方面，如果可以快速计算大小，则与正确值不同步的风险很小。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-16T19:49:08.113

为什么不将计数器保留在 BigDataStructure 内部，然后您可以在这些函数中执行添加或删除时递增或递减。当您调用 size() 时，您可以只返回内部计数器的值。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-16T19:45:35.893

如果关注性能，则取决于调用 size() 的成本。例如，对 STL 列表的 size() 调用可以是 O(n)。即使调用是 O(1)，增加和减少外部计数器可能会更快。您可能需要进行一些性能测量来找出哪个更有效。如果不关心性能，则调用 size()。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-16T19:49:23.917

我会使用第一个，然后`assert(counter == BigDataStructure.size());`

# telerik - Telerik RadWindow 没有 NavigateURL？

> ID：757699
> 
> 赞同：1
> 
> 时间：2009-04-16T19:29:18.257
> 
> 标签：telerik

我想要一个模态弹出效果来在单个页面上显示动态内容。我正在使用 Telerik 控件。Telerik 有一个名为 RadWindow 的控件，它或多或少是一个模态窗口。

看起来要在 RadWindow 中显示的唯一内容是在 NavigateURL 中指定的页面内容。这对我来说是个问题，因为我想要显示的是我在同一页面上显示的动态内容。

是否可以使用 RadWindow 显示同一页面上的内容？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T19:45:11.243

RadWindow 是一个 iframe。它必须有一个单独的页面来呈现，除非您使用客户端的 radalert 和 radconfirm 方法——您可以传入 HTML 以获得不需要单独页面的警报或确认对话框。这听起来不像你想要的。考虑改用 RadToolTip 或 AjaxToolkit ModalPopupExtender。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-27T11:44:06.663

RadDock 做 RadWindow 做的事情。只是，它从当前页面而不是从外部 URL 获取输入。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-11-17T08:09:24.073

一段时间以来，RadWindow 也可以显示主页上的内容。这是演示的链接：http: [//demos.telerik.com/aspnet-ajax/window/examples/internalcontent/defaultcs.aspx](http://demos.telerik.com/aspnet-ajax/window/examples/internalcontent/defaultcs.aspx)

# subsonic - SubSonic 部署和更改连接字符串

> ID：757708
> 
> 赞同：0
> 
> 时间：2009-04-16T19:31:03.010
> 
> 标签：subsonic, data-access-layer, connection-string

我使用 Subsonic 为我的一个 Web 应用程序构建了 DAL。当我将它从我的测试服务器移动到生产服务器时，我将连接字符串更改为指向生产数据源，但应用程序仍然针对测试数据库运行。除了 Web.config 之外，连接信息是否存储在其他地方？

部署使用 Subsonic 构建的 Web 应用程序的最佳实践是什么？

TIA

约翰

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-16T20:51:22.550

这是我的配置示例。

```
 <!--########################## Connection Strings ###############################-->
        <connectionStrings>
        <clear/>
        <add name="Ajax" 
connectionString="Data Source=Ajax1;Initial Catalog=AjaxExample_test;User ID=Webuser;Password=Pinecone!" 
providerName="System.Data.SqlClient"/>
        </connectionStrings>
        <!--########################## SubSonic ###############################-->
            <SubSonicService defaultProvider="AjaxProv">
             <providers>
              <clear/>
             <add name="AjaxProv" type="SubSonic.SqlDataProvider, SubSonic"
     connectionStringName="Ajax" 
    generatedNamespace="ICBA.Web.SalesForce.StagingDAL" 
    appendWith="" 
    stripColumnText="" 
    relatedTableLoadPrefix="" 
    enableTrace="false" 
    extractClassNameFromSPName="false" 
    fixDatabaseObjectCasing="true" 
    fixPluralClassNames="true" 
    generateLazyLoads="false" 
    generateNullableProperties="true" 
    generateODSControllers="true" 
    generateRelatedTablesAsProperties="false" 
    includeProcedureList="*" 
    excludeTableList="" 
    includeTableList="*" 
    regexDictionaryReplace="TypeCode,typecode" 
    regexIgnoreCase="true" 
    removeUnderscores="true" 
    setPropertyDefaultsFromDatabase="false" 
    useExtendedProperties="false" 
    useSPs="true"/>
           </providers>
          </SubSonicService> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T19:38:25.503

在您的`SubSonicService`配置部分中，该`connectionStringName`属性是否指向正确的连接字符串？

# binding - Linq to Entities Binding, Filtering and Editing in WinForms

> ID：757712
> 
> 赞同：1
> 
> 时间：2009-04-16T19:32:06.953
> 
> 标签：binding, datagrid, .net-3.5, linq-to-entities

1）绑定到以下填充只读WinFrms网格：

```
 Dim query = (From profile _
              In db.profile _
              Where profile.employee.employeeId = employeeID _
              Select profile.description)

    Me.DataGridView.DataSource = profileQueryList 
```

2）绑定到实体本身使 WinForms 网格可编辑，但未过滤：

```
 Me.DataGridView.DataSource = db.profile 
```

我需要将#1 的过滤功能与#2 的可编辑功能相结合的东西。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-16T19:47:14.220

尝试使用显式`ToList()`调用。

```
Me.DataGridView.DataSource = query.ToList() 
```

我猜想否则只有查询的表达式树被绑定并且实体只是按需获取。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T03:16:44.707

找到了解决方案！它记录在：
[Linq to Entities Filtering an Entity Dynamic/Strongly Typed](https://stackoverflow.com/questions/784363/linq-to-entities-filtering-an-entity-dyamic-strongly-typed)

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-04-23T16:41:03.627

不要直接绑定到可查询对象。相反，您需要通过[EntityDataSource](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.entitydatasource.aspx)类。请特别注意[这篇关于如何使用此控件过滤数据的文章](http://msdn.microsoft.com/en-us/library/cc488531.aspx)。

# java - BoxLayout 中的 JPanel 边距

> ID：757735
> 
> 赞同：1
> 
> 时间：2009-04-16T19:37:59.840
> 
> 标签：java, layout

出于自定义渲染的目的，我创建了一个扩展 JPanel 并覆盖 paintComponent 方法的类 (axisPanel.java)。一个axispanel的实例被添加到一个带有BorderLayout的容器类的西侧。我想在axispanel周围有几个像素的边距，但是将axispanel的边框设置为大小适中的EmptyBorder实例似乎不起作用。关于我如何实现这一点的任何想法？

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T20:14:38.863

您的`paintComponent`方法应该尊重组件的插图。

一个不打扰的简单方法是将您绘制的组件放在一个面板内，该面板具有边框，并且您的组件作为`BorderLayout`.

`JPanel`（顺便说一句：IMO在您不想要面板时扩展是一个坏主意。只需扩展`JComponent`。布局有所不同，并且`JPanel`可能会或可能不会默认为不透明，具体取决于正在使用的 PL&F 版本（所以你总是需要打电话`setOpaque`，除非你觉得幸运）。

# c# - 客户端/服务器连接问题

> ID：757738
> 
> 赞同：1
> 
> 时间：2009-04-16T19:38:13.290
> 
> 标签：c#, .net, client, remoting

我使用 .Net 远程处理在 C# 中编写了一个客户端/服务器模型。如果我将客户端连接到服务器，然后在服务器关闭时终止服务器并重新启动它而不尝试从客户端调用任何服务器方法，我可以愉快地重新连接。

如果我关闭服务器然后尝试从客户端 ping 服务器（我从一个单独的线程执行以避免无休止的等待），那么当服务器重新联机时，客户端永远无法与它交谈，并且我的 Ping 线程被触发在停机期间，在远程库的深处永远等待。我尝试中止此操作（如果尝试加入线程在短时间内失败）但它不会中止。我想知道这是否是问题的一部分。

如果我启动另一个客户端，那么该客户端可以与服务器正常通信。我想我需要重新启动原始客户端的某些方面，但看不到需要关闭的内容。我当然将我连接到的服务器清空并使用相同的地址调用 Activator.GetObject（第二个客户端连接到服务器的操作很好），但重新获取服务器根本没有帮助。

服务器通过 RegisterWellKnownServiceType 作为单例运行。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T19:45:22.773

我将从wireshark 开始，并使用它来查看网络上真正发生了什么。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T20:14:42.123

.NET 远程处理是一项要求，还是您可以考虑改用[WCF ？](http://msdn.microsoft.com/en-us/netframework/aa663324.aspx)这些协议在需要时被更好地考虑和更清晰地公开。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-10-19T22:54:35.603

我正在解决一个类似的问题。我有一个工作的 .NET 远程处理应用程序，它使用远程处理的配置文件和 .NET 远程处理的例程，我必须将其集成到一个更大的应用程序中。`Activator.GetObject`我通过返回的代理实例将其集成到更大的项目中。一旦有来自代理实例的成员调用，它就会在成员调用中结束并且无法下车。较大的应用程序已经包含各种配置文件，因此我放在那里的 .NET 远程处理配置以及另一个配置文件，这就是问题的症结所在。在我将 .NET 远程处理配置放入一个新的空配置文件后，较大应用程序中的 .NET 远程处理开始工作。

# design-patterns - 建造者设计模式和工厂设计模式有什么区别？

> ID：757743
> 
> 赞同：777
> 
> 时间：2009-04-16T19:39:04.753
> 
> 标签：design-patterns, factory-pattern, factory-method, builder-pattern

建造者设计模式和工厂设计模式有什么区别？

哪一个更有优势，为什么？

如果我想测试和比较/对比这些模式，如何将我的发现表示为图表？

* * *

## 回答 #1

> 赞同：540
> 
> 时间：2009-04-16T19:46:52.940

对于设计模式，通常没有适用于所有情况的“更有利”的解决方案。这取决于您需要实施什么。

来自维基百科：

> *   Builder专注于一步一步地构建一个复杂的对象。抽象工厂强调一系列产品对象（简单或复杂）。Builder 作为最后一步返回产品，但就抽象工厂而言，产品会立即返回。
> *   Builder 经常构建一个 Composite。
> *   通常，设计从使用工厂方法（不太复杂、更可定制、子类激增）开始，然后随着设计人员发现需要更多灵活性的地方而向抽象工厂、原型或构建器（更灵活、更复杂）发展。
> *   有时创建模式是互补的：构建器可以使用其他模式之一来实现构建哪些组件。Abstract Factory、Builder 和 Prototype 可以在它们的实现中使用 Singleton。

工厂设计模式的维基百科条目： [http ://en.wikipedia.org/wiki/Factory_method_pattern](http://en.wikipedia.org/wiki/Factory_method_pattern)

构建器设计模式的维基百科条目： [http ://en.wikipedia.org/wiki/Builder_pattern](http://en.wikipedia.org/wiki/Builder_pattern)

* * *

## 回答 #2

> 赞同：450
> 
> 时间：2012-01-22T05:15:42.577

**工厂**只是构造函数（可能是不同类中的一个）的包装函数。关键区别在于工厂方法模式要求整个对象在单个方法调用中构建，所有参数都在一行中传入。最终对象将被返回。

**另一方面，**构建器模式本质上是一个包装器对象，围绕着您可能想要传递给构造器调用的所有可能参数。**这允许您使用 setter 方法来慢慢建立您的参数列表。构建器类的另一种方法是 build() 方法，它只是将构建器对象传递给所需的构造函数，并返回结果。**

 **在像 Java 这样的静态语言中，当您拥有多个（可能是可选的）参数时，这一点变得更加重要，因为它避免了对所有可能的参数组合都具有伸缩构造函数的要求。此外，构建器允许您使用 setter 方法来定义在调用构造函数后无法直接修改的只读或私有字段。

**基本工厂示例**

```
// Factory
static class FruitFactory {
    static Fruit create(name, color, firmness) {
        // Additional logic
        return new Fruit(name, color, firmness);
    }
}

// Usage
Fruit fruit = FruitFactory.create("apple", "red", "crunchy"); 
```

**基本构建器示例**

```
// Builder
class FruitBuilder {
    String name, color, firmness;
    FruitBuilder setName(name)         { this.name     = name;     return this; }
    FruitBuilder setColor(color)       { this.color    = color;    return this; }
    FruitBuilder setFirmness(firmness) { this.firmness = firmness; return this; }
    Fruit build() {
        return new Fruit(this); // Pass in the builder
    }
}

// Usage
Fruit fruit = new FruitBuilder()
        .setName("apple")
        .setColor("red")
        .setFirmness("crunchy")
        .build(); 
```

比较这两个维基百科页面的代码示例可能是值得的：

[http://en.wikipedia.org/wiki/Factory_method_pattern](http://en.wikipedia.org/wiki/Factory_method_pattern)
[http://en.wikipedia.org/wiki/Builder_pattern](http://en.wikipedia.org/wiki/Builder_pattern)

* * *

## 回答 #3

> 赞同：305
> 
> 时间：2009-04-16T19:44:49.717

工厂模式几乎可以看作是建造者模式的简化版。

在**工厂**模式中，工厂负责根据需要创建对象的各种子类型。

工厂方法的用户不需要知道该对象的确切子类型。工厂方法的一个示例`createCar`可能会返回一个`Ford`或一个`Honda`类型化的对象。

在**Builder**模式中，不同的子类型也由 builder 方法创建，但对象的组合在同一个子类中可能不同。

继续汽车示例，您可能有一个`createCar`构建器方法，该方法创建一个`Honda`具有 4 缸发动机的`Honda`类型对象，或一个具有 6 个气缸的类型对象。构建器模式允许这种更精细的粒度。

Wikipedia 上提供了[Builder 模式](http://en.wikipedia.org/wiki/Builder_pattern)和[Factory 方法模式](http://en.wikipedia.org/wiki/Factory_method_pattern)的图表。

* * *

## 回答 #4

> 赞同：68
> 
> 时间：2009-04-16T19:44:44.037

构建器设计模式描述了一个对象，该对象知道如何通过几个步骤来制作另一个特定类型的对象。它在每个中间步骤保持目标项目所需的状态。想想 StringBuilder 生成最终字符串的过程。

工厂设计模式描述了一个对象，它知道如何在一个步骤中创建几种不同但相关的对象，其中特定类型是根据给定的参数选择的。想想序列化系统，您可以在其中创建序列化程序，并在一次加载调用中构建所需的 in 对象。

* * *

## 回答 #5

> 赞同：57
> 
> 时间：2013-06-18T06:15:49.093

*   逐步构建复杂对象：构建器模式

*   使用单一方法创建一个简单的对象：工厂方法模式

*   使用多工厂方法创建对象：抽象工厂模式

* * *

## 回答 #6

> 赞同：25
> 
> 时间：2017-10-09T06:43:46.150

Builder Pattern 和 Factory Pattern 看起来都非常类似于肉眼，因为它们都为您创建对象。

# 但你需要仔细观察

这个现实生活中的例子将使两者之间的区别更加清晰。

假设您去了一家快餐店并点了**Food**。

### 1）什么食物？

比萨

### 2）什么浇头？

辣椒、番茄、烤鸡、无**菠萝**

所以不同种类的食物是由工厂模式制造的，但特定食物的不同变体（口味）是由建造者模式制造的。

> 不同种类的食物

比萨，汉堡，意大利面

> 披萨的变种

只有奶酪，奶酪+番茄+辣椒，奶酪+番茄等。

# 代码示例

您可以在此处查看两种模式的示例代码实现
[Builder Pattern](https://github.com/rohitksingh/Design-Pattern/blob/master/src/BuilderPattern/Test.java)
[Factory Pattern](https://github.com/rohitksingh/Design-Pattern/tree/master/src/FactoryPatternSample)

* * *

## 回答 #7

> 赞同：20
> 
> 时间：2009-04-17T10:00:09.020

两者都是创建模式，用于创建对象。

1) 工厂模式 - 假设您有一个超类和 N 个子类。创建对象取决于传递的参数/值。

2）建造者模式——创造复杂的对象。

```
Ex: Make a Loan Object. Loan could be house loan, car loan ,
    education loan ..etc. Each loan will have different interest rate, amount ,  
    duration ...etc. Finally a complex object created through step by step process. 
```

* * *

## 回答 #8

> 赞同：18
> 
> 时间：2018-02-06T00:45:12.943

| 建造者 | 工厂 |
| --- | --- |
| 仅返回单个实例来处理复杂的对象构造 | 在多个构造函数上返回各种实例 |
| 无需接口 | 接口驱动 |
| 涉及内部类（以避免伸缩构造函数） | 涉及子类 |

[伸缩构造函数模式](https://stackoverflow.com/a/1953567/1697099)

**比喻：**

*   **工厂：**考虑一家餐馆。“今天的饭菜”的创建是一种工厂模式，因为你告诉厨房“给我今天的饭菜”，厨房（工厂）根据隐藏的标准决定生成什么对象。
*   **生成器：**如果您订购定制披萨，生成器会出现。在这种情况下，服务员告诉厨师（建造者）“我需要一个比萨饼；加奶酪、洋葱和培根！” 因此，构建器公开了生成的对象应具有的属性，但隐藏了如何设置它们。

[礼貌](https://stackoverflow.com/a/329194/1697099)

* * *

## 回答 #9

> 赞同：14
> 
> 时间：2017-01-15T17:15:55.187

**首先是一些一般性的事情来遵循我的论点：**

设计大型软件系统的主要挑战是它们必须灵活且易于更改。出于这个原因，有一些指标，如耦合和内聚。为了实现可以轻松更改或扩展其功能而无需从头开始重新设计整个系统的系统，您可以遵循设计原则（如 SOLID 等）。一段时间后，一些开发人员意识到，如果他们遵循这些原则，就会有一些类似的解决方案可以很好地解决类似的问题。这些标准解决方案最终成为设计模式。

因此，设计模式是为了支持您遵循一般设计原则，以实现具有高内聚性的松散耦合系统。

**回答问题：**

通过询问两种模式之间的区别，您必须问自己哪种模式使您的系统以哪种方式更灵活。每个模式都有自己的目的来组织系统中类之间的依赖关系。

**抽象工厂模式：** GoF：“提供一个接口来创建相关或依赖对象的系列，而无需指定它们的具体类。”</p>

*这是什么意思：* 通过提供这样的接口，对每个系列产品的构造函数的调用都封装在工厂类中。因为这是整个系统中唯一调用这些构造函数的地方，所以您可以通过实现一个新的工厂类来更改您的系统。如果您通过另一个交换工厂的表示，您可以在不接触大部分代码的情况下交换一整套产品。

**构建器模式：** GoF：“将复杂对象的构建与其表示分离，以便相同的构建过程可以创建不同的表示。”</p>

*这是什么意思：* 你将构建过程封装在另一个类中，称为director (GoF)。该导向器包含创建产品新实例的算法（例如，由其他部分组成复杂产品）。为了创建整个产品的组成部分，导演使用了构建器。通过在导向器中交换构建器，您可以使用相同的算法来创建产品，但会更改单个部分的表示（以及产品的表示）。要在产品表示中扩展或修改您的系统，您需要做的就是实现一个新的构建器类。

**简而言之：** 抽象工厂模式的目的是交换一组可以一起使用的产品。Builder Pattern 的目的是封装创建产品的抽象算法，以将其重用于产品的不同表示。

在我看来，你不能说抽象工厂模式是建造者模式的老大哥。是的，它们都是创造模式，但模式的主要意图是完全不同的。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2014-08-22T08:49:12.160

我可以看出的 Builder 和 factory 之间的一个显着区别如下

假设我们有一辆车

```
class Car
{
  bool HasGPS;
  bool IsCityCar;
  bool IsSportsCar;
  int   Cylenders;
  int Seats;

  public:
     void Car(bool hasGPs=false,bool IsCityCar=false,bool IsSportsCar=false, int Cylender=2, int Seats=4);
 }; 
```

在上面的界面中，我们可以通过以下方式获取汽车：

```
 int main()
 {
    BadCar = new Car(false,false,true,4,4);
  } 
```

但是如果在创建席位时发生了一些异常呢？？？你根本不会得到对象 // 但是

假设您有如下实现

```
class Car
 {
    bool mHasGPS;
    bool mIsCityCar;
    bool mIsSportsCar;
    int mCylenders;
    int mSeats;

 public:
    void Car() : mHasGPs(false), mIsCityCar(false), mIsSportsCar(false), mCylender(2), mSeats(4) {}
    void SetGPS(bool hasGPs=false)  {mHasGPs = hasGPs;}
    void SetCity(bool CityCar)  {mIsCityCar = CityCar;}
    void SetSports(bool SportsCar)  {mIsSportsCar = SportsCar;}
    void SetCylender(int Cylender)  {mCylenders = Cylender;}    
    void SetSeats(int seat) {mSeats = seat;}    
};

 class CarBuilder 
 {
    Car* mCar;
public:
        CarBuilder():mCar(NULL) {   mCar* = new Car();  }
        ~CarBuilder()   {   if(mCar)    {   delete mCar;    }
        Car* GetCar()   {   return mCar; mCar=new Car();    }
        CarBuilder* SetSeats(int n) {   mCar->SetSeats(n); return this; }
        CarBuilder* SetCylender(int n)  {   mCar->SetCylender(n); return this;  }
        CarBuilder* SetSports(bool val) {   mCar->SetSports(val); return this;  }
        CarBuilder* SetCity(bool val)   {   mCar->SetCity(val); return this;    }
        CarBuilder* SetGPS(bool val)    {   mCar->SetGPS(val); return this; }
} 
```

现在你可以像这样创建

```
 int main()
 {
   CarBuilder* bp =new CarBuilder;
    Car* NewCar  = bp->SetSeats(4)->SetSports(4)->SetCity(ture)->SetGPS(false)->SetSports(true)->GetCar();

     bp->SetSeats(2);

     bp->SetSports(4);

     bp->SetCity(ture);

     bp->SetSports(true)

     Car* Car_II=  bp->GetCar();

  } 
```

在第二种情况下，即使一个操作失败，您仍然会得到 Car。

可能是那辆车以后不能完美地工作，但是，你会有这个目标。

因为工厂方法在单次调用中为您提供汽车，而生成器则一一构建。

虽然，这取决于设计的需要去哪一个。

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2018-12-24T03:50:23.260

**Factory**：用于创建对象的实例，其中对象的依赖项完全由工厂持有。对于***抽象工厂模式***，同一个抽象工厂往往有很多具体的实现。工厂的正确实现是通过依赖注入注入的。

**Builder**：用于构建***不可变***对象，当要实例化的对象的依赖关系部分是预先知道的，部分是由builder的客户端提供的。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2016-02-15T19:35:45.967

*Builder*和*Abstract Factory*有不同的用途。根据正确的用例，您必须选择合适的设计模式。

*建设者*显着特点：

1.  构建器模式使用简单对象并使用逐步方法构建复杂对象
2.  Builder 类逐步构建最终对象。此构建器独立于其他对象
3.  在这种情况下替换为工厂方法/抽象工厂：从客户端程序传递到工厂类的参数过多，容易出错
4.  某些参数可能是可选的，不像 Factory 中强制发送所有参数

*工厂*（简单工厂）的显着特点：

1.  创造模式
2.  基于继承
3.  工厂返回一个工厂方法（接口），该方法又返回具体对象
4.  您可以用新的具体对象替换接口和客户端（调用者）不应该知道所有具体实现
5.  客户端始终只访问接口，您可以在工厂方法中隐藏对象创建细节。

通常，设计开始使用*工厂方法*（不太复杂，更可定制，子类激增）并演变为*Abstract Factory*，*Prototype*或*Builder*（更灵活，更复杂）

看看相关帖子：

[将构建器保持在单独的类中（流畅的界面）](https://stackoverflow.com/questions/39708728/keeping-builder-in-separate-class-fluent-interface/39714699#39714699)

[设计模式：工厂 vs 工厂方法 vs 抽象工厂](https://stackoverflow.com/questions/13029261/design-patterns-factory-vs-factory-method-vs-abstract-factory/35851402#35851402)

您可以参考以下文章了解更多详情：

[资源制作](https://sourcemaking.com/design_patterns)

[日志开发](http://www.journaldev.com/1827/java-design-patterns-example-tutorial)

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2016-01-06T01:37:03.107

抽象工厂模式和生成器模式都是创建模式，但意图不同。

**抽象工厂模式**强调为相关对象族创建对象，其中：

*   每个系列都是从公共基类/接口派生的一组类。
*   每个对象都会作为一次调用的结果立即返回。

**建造者模式**专注于一步一步地构造一个复杂的对象。它将表示与构造复杂对象的过程解耦，使得相同的构造过程可以用于不同的表示。

*   Builder 对象封装了复杂对象的配置。
*   Director 对象知道使用 Builder 的协议，其中协议定义了构建复杂对象所需的所有逻辑步骤。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2020-01-21T11:12:47.927

构建器模式相对于工厂模式的主要优势在于，如果您想创建一些具有许多可能自定义的标准对象，但通常最终只自定义一些。

例如，如果您想编写一个 HTTP 客户端 - 您将设置一些默认参数，如默认写入/读取超时、协议、缓存、DNS、拦截器等。

您客户端的大多数用户只会使用这些默认参数，而其他一些用户可能想要自定义其他一些参数。在某些情况下，您只想更改超时并按原样使用其余部分，而在其他情况下，您可能需要自定义例如缓存。

以下是实例化客户端的可能方法（取自 OkHttpClient）：

```
//just give me the default stuff
HttpClient.Builder().build()   

//I want to use custom cache
HttpClient.Builder().cache(MyCache()).build() 

//I want custom connection timeout
HttpClient.Builder().connectTimeout(30, TimeUnit.SECONDS).build() 

//I am more interested in read/write timeout
HttpClient.Builder()
        .readTimeout(30, TimeUnit.SECONDS)
        .writeTimeout(30, TimeUnit.SECONDS).build() 
```

如果您为此使用工厂模式，您最终会编写许多方法，其中包含所有可能的创建参数组合。使用构建器，您只需指定您关心的那些，然后让构建器为您构建它，并处理所有其他参数。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2018-03-04T09:06:56.433

复杂构造是指要构造的对象由抽象表示的不同其他对象组成。

考虑一下麦当劳的菜单。菜单包含饮料、主菜和配菜。根据各个抽象的哪些后代组合在一起，创建的菜单具有另一种表示形式。

1.  示例：可乐、巨无霸、炸薯条
2.  示例：雪碧、金块、卷薯条

在那里，我们得到了两个具有不同表示形式的菜单实例。反过来，建造过程保持不变。您创建一个包含饮料、主菜和配菜的菜单。

通过使用构建器模式，您可以将创建复杂对象的算法与用于创建它的不同组件分开。

在构建器模式方面，算法被封装在导向器中，而构建器用于创建整体部分。改变导向器算法中使用的构建器会导致不同的表示，因为其他部分组成一个菜单。创建菜单的方式保持不变。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2019-08-17T10:49:02.277

它们之间的主要区别在于Builder模式**主要**描述了逐步创建复杂对象。在抽象工厂模式中，重点是**对象-产品系列**。Builder 在**最后一步**返回产品。而在抽象工厂模式中，产品**立即可用**。

示例：假设我们正在创建迷宫

**1.抽象工厂：**

```
Maze* MazeGame::CreateMaze (MazeFactory& factory) {
Maze* maze = factory.MakeMaze(); /// product is available at start!!
 /* Call some methods on maze */
return maze;
} 
```

**2.生成器：**

```
Maze* MazeGame::CreateMaze (MazeBuilder& builder) {
builder.buildMaze(); /// We don't have access to maze
 /* Call some methods on builder */
return builder.GetMaze();
} 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2016-09-15T23:41:13.080

我相信，当您使用相同的代码库和不断变化的需求时，可以在特定时间段内更容易地理解/澄清 Factory 和 Builder 模式的用法和区别。

根据我的经验，通常，您从包含几个静态创建者方法的工厂模式开始，主要隐藏相对复杂的初始化逻辑。随着您的对象层次结构变得更加复杂（或者随着您添加更多类型、参数），您最终可能会使用更多参数填充您的方法，更不用说您将不得不重新编译您的工厂模块。所有这些都增加了创建者方法的复杂性，降低了可读性并使创建模块更加脆弱。

该点可能是过渡/延伸点。通过这样做，您可以围绕**构造参数**创建一个包装器模块，然后您将能够通过添加更多抽象（可能）和实现来表示新的（相似的）对象，而无需触及实际的创建逻辑。所以你有“更少”的复杂逻辑。

坦率地说，提到某种“在一步或多个步骤中创建对象是不同的”，因为唯一的多样性因素不足以让我区分它们，因为我可以在我面临的几乎所有情况下使用这两种方式现在没有任何好处。所以这就是我最终想到的。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2016-12-15T13:33:36.467

两种模式都有相同的必要性：对某些客户端代码隐藏复杂对象的构造逻辑。但是是什么让一个对象“复杂”（或者，有时，复杂）？主要是由于依赖关系，或者更确切地说是由更多部分状态组成的对象的状态。您可以通过构造函数注入依赖项来设置初始对象状态，但是一个对象可能需要很多依赖项，有些将处于默认初始状态（只是因为我们应该知道将默认依赖项设置为 null 并不是最干净的方法) 和其他一些设置为由某些条件驱动的状态。此外，有些对象属性是某种“不经意的依赖”，但它们也可以假设为可选状态。

有两种众所周知的方法可以控制这种复杂性：

*   组合/聚合：构造一个对象，构造它的依赖对象，然后连接在一起。在这里，构建器可以使确定引导组件构建的规则的过程变得透明和灵活。

*   多态性：构造规则直接声明到子类型定义中，因此您对每个子类型都有一组规则，并且某些条件决定了这些规则中的哪一个适用于构造对象。工厂非常适合这种情况。

没有什么能阻止混合这两种方法。一个产品系列可以抽象使用构建器完成的对象创建，构建器可以使用工厂来确定实例化哪个组件对象。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2013-06-10T21:01:47.593

构建模式强调创建对象的**复杂性** （通过“步骤”解决）

抽象模式在（多个但相关的）对象的“抽象”上强调“公正”。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2015-09-30T10:03:39.543

两者非常相似，但是如果您有大量用于创建对象的参数，其中一些参数是可选的，并且有一些默认值，请选择 Builder 模式。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2017-11-05T13:29:46.763

恕我直言

Builder 是某种更复杂的工厂。

但是**在 Builder 中，您可以使用其他工厂实例化对象**，这是构建最终和有效对象所必需的。

因此，通过复杂性谈论“创建模式”演变，您可以这样考虑：

```
Dependency Injection Container -> Service Locator -> Builder -> Factory 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2013-01-15T22:49:50.460

> ### 生成器和抽象工厂
> 
> Builder 设计模式在某种程度上与抽象工厂模式非常相似。这就是为什么在使用其中一种情况时能够区分情况很重要的原因。在抽象工厂的情况下，客户端使用工厂的方法来创建自己的对象。在 Builder 的情况下，Builder 类被指示如何创建对象，然后被要求提供它，但是将类放在一起的方式取决于 Builder 类，这个细节决定了两种模式之间的区别。
> 
> ### 产品通用接口
> 
> 在实践中，由具体构建者创建的产品具有显着不同的结构，因此如果没有理由派生不同的产品，则可以使用一个共同的父类。这也将 Builder 模式与抽象工厂模式区分开来，后者创建从通用类型派生的对象。

来自：[http ://www.oodesign.com/builder-pattern.html](http://www.oodesign.com/builder-pattern.html)

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2013-09-02T05:07:08.603

区别很明显在构建器模式中，构建器将为您创建特定类型的对象。你必须告诉建造者必须建造什么。在工厂模式中，使用抽象类直接构建特定对象。

这里builder类充当主类和特定类型类之间的中介。更抽象。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2014-02-06T06:59:42.247

在我看来，当您想从一堆其他对象中创建一个对象并且部分的创建需要独立于您要创建的对象时，可以使用 Builder 模式。它有助于向客户隐藏零件的创建，以使构建者和客户独立。它用于创建复杂的对象（可能包含复杂属性的对象）

而工厂模式指定您要创建一个通用系列的对象，并且您希望它立即被创建。它用于更简单的对象。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2020-08-19T16:47:31.300

许多设计从使用**工厂方法**（不太复杂，通过子类更可定制）开始，然后向**抽象工厂**、**原型**或**构建器**发展（更灵活，但更复杂）。

**Builder**专注于逐步构建复杂的对象。

**实现它：**

1.  明确定义构建所有可用产品表示的通用构建步骤。否则，您将无法继续实施该模式。
2.  在基本构建器界面中声明这些步骤。
3.  为每个产品表示创建一个具体的构建器类并实现它们的构建步骤。

**抽象工厂**专门创建相关对象的系列。*Abstract Factory*立即返回产品，而 Builder 允许您在获取产品之前运行一些额外的构建步骤。

您可以将**Abstract Factory**与**Bridge**一起使用。当 Bridge 定义的某些抽象只能与特定实现一起使用时，这种配对很有用。在这种情况下，抽象工厂可以封装这些关系并对客户端代码隐藏复杂性。

[深入了解设计模式](https://refactoring.guru/design-patterns/book)

* * *

## 回答 #26

> 赞同：-2
> 
> 时间：2016-02-19T06:28:14.503

工厂模式在运行时创建一个类的具体实现，即它的主要目的是使用多态性来允许子类决定实例化哪个类。这意味着在编译时我们不知道将创建的确切类，而 Builder 模式主要关注的是解决由于类的大量可选字段而产生的可伸缩构造函数反模式的问题。在构建器模式中没有多态性的概念，因为我们知道在编译时我们试图构建什么对象。

这两种模式的唯一共同主题是在工厂方法和 build 方法后面隐藏构造函数和对象创建，以改进对象构造。

* * *

## 回答 #27

> 赞同：-2
> 
> 时间：2016-08-01T10:55:31.273

工厂模式让你一次创建一个对象，而建造者模式让你打破一个对象的创建过程。这样，您可以在创建对象期间添加不同的功能。

# asp.net - Internet Explorer 的操作中止和延迟问题

> ID：757758
> 
> 赞同：2
> 
> 时间：2009-04-16T19:44:35.147
> 
> 标签：asp.net, javascript, internet-explorer, asp.net-ajax

如果您不知道操作中止错误是什么，这里有一篇关于它的 Microsoft 知识库文章，[http://support.microsoft.com/default.aspx/kb/927917](http://support.microsoft.com/default.aspx/kb/927917)。还有很多关于它的帖子，但它发生的简单答案是这样的；仅当您尝试在加载您尝试操作的元素之前通过 JavaScript 操作 DOM 元素时才会发生该错误。

我知道 Internet Explorer (IE) 臭名昭著的 Operation Aborted 是如何发生的，并且知道如何修复它。我遇到的问题是一个非常奇怪的场景。在本地和使用 IE7 的开发机器上进行测试，我从来没有遇到操作中止错误（两个站点都以 http 运行）。

然而，在我们客户的测试站点上，它一直在发生。不幸的是，我的测试环境与客户端的测试环境不同，因此增加了一些变量，但我看到的主要区别是客户端的测试站点使用的是 SSL。

有没有人遇到过仅针对 SSL 站点的 Operation Aborted 错误？

我脑海中闪现的另一个想法是，这是一个延迟问题。在本地站点几乎立即加载，而在我客户的测试站点上，页面加载速度较慢。因此，考虑到这一点，我让 Fiddler 运行并模拟了以老式调制解调器速度运行的性能，在本地或我们自己的测试服务器上仍然没有操作中止错误。

仅供参考：该站点是使用 ASP.NET AJAX Extensions 1.0 的 ASP.NET 2.0 站点。有问题的页面也有 AJAX Control Toolkit 的 Cascading Drop Down。

是的，据我所知，所有操纵 DOM 的 JavaScript 都在标记的末尾，而不是开头。

非常感谢任何帮助或评论。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T20:19:15.163

好吧，在搜索了互联网之后，我发现了这个问题。它与 ASP.NET AJAX 客户端框架中的错误有关。

我将解释我发现的内容：

该问题是由于 Internet Explorer/ASP.Net AJAX 错误而发生的竞争条件。当应用程序在网页上有大量启用 ASP.Net AJAX 的服务器控件时，遇到此问题的可能性会增加。此处解释了该问题，[http://seejoelprogram.wordpress.com/2008/10/03/fixing-sysapplicationinitialize-again](http://seejoelprogram.wordpress.com/2008/10/03/fixing-sysapplicationinitialize-again)。我已将此修复添加到我正在处理的项目中。

如果使用 ASP.NET 3.5 SP1，仍然需要此修复程序。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T10:46:25.493

我猜你的测试盒上没有 SSL 的原因是证书的成本。您知道您可以获得免费的短期证书吗？我经常用它们来解决这样的问题。

例如[RapidSSL](http://www.rapidssl.com/ssl-certificate-products/free-ssl/freessl.htm)做一个[免费的 30 天证书](http://www.rapidssl.com/ssl-certificate-products/free-ssl/freessl.htm)。

# tsql - GROUP BY 子句的 TOP N 问题

> ID：757763
> 
> 赞同：2
> 
> 时间：2009-04-16T19:45:08.280
> 
> 标签：tsql, select, group-by, greatest-n-per-group

问题：我需要找到最后三个 [GiftDetails] 的所有活动 [GiftPledges] 的数量为零。

```
SELECT gp.PledgeId FROM GiftPledge gp
      INNER JOIN GiftDetail gd ON gp.PledgeId = gd.PledgeId
      WHERE gp.PledgeStatus = 'A'
      GROUP BY PledgeId
      HAVING COUNT(PledgeId) >= 3 
```

现在，我的所有 [GiftPledges] 至少包含三个 [GiftDetails]。

```
SELECT TOP 3 gdi.Amt FROM GiftDetail gdi
      INNER JOIN GiftHeader ghi ON gdi.GiftRef = ghi.GiftRef
      WHERE gdi.PledgeId = gp.PledgeId
      ORDER BY ghi.GDate DESC 
```

这为我提供了与给定 [GiftPledge] 关联的三个最新 [GiftDetails]。问题是我不知道如何对第二个查询求和并将其作为第一个查询中 WHERE 子句的一部分。

我发现[了这篇](http://weblogs.sqlteam.com/jeffs/archive/2007/03/30/More-SQL-Server-2005-Solutions.aspx)关于“每组前 n 名”的文章，这*似乎*是我需要前进的方向，但我不确定我是否走在正确的轨道上。

任何帮助、澄清或建议将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T20:04:00.387

```
SELECT gp.PledgeId FROM GiftPledge gp
      INNER JOIN GiftDetail gd ON gp.PledgeId = gd.PledgeId
      WHERE gp.PledgeStatus = 'A'
      GROUP BY PledgeId
      HAVING COUNT(PledgeId) >= 3 
AND
GP.PledgeID in (
SELECT PledgeID From
(
SELECT TOP 3 gp.PledgeID, gdi.Amt  FROM GiftDetail gdi
      INNER JOIN GiftHeader ghi ON gdi.GiftRef = ghi.GiftRef
      WHERE gdi.PledgeId = gp.PledgeId
      ORDER BY ghi.GDate DESC
) x_amt 
Group By PledgeID
Having SUM(AMT) ) x_sum = 0 
```

反正是这样的。

# javascript - 使用 $(".someClass") 之类的 JQuery 确定元素集合是否可见

> ID：757776
> 
> 赞同：2
> 
> 时间：2009-04-16T19:48:32.670
> 
> 标签：javascript, jquery

我的页面上有一组元素，我想看看它们当前是否可见。

所以：

```
$(".someClass") 
```

我怎样才能循环并解决这个问题？因为如果它是可见的，我必须触发另一个功能。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-16T19:50:29.797

```
$(".someClass").each(function(){
  if($(this).is(":visible")){
    //item is visible: do something
   }
}); 
```

那个怎么样？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T19:50:14.773

```
$(".someClass:visible") 
```

将返回可见的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T19:51:02.697

你可以做什么：

```
$(".someClass").each(function(x) { if ( x.style.display != "none" && x.style.visibility != "hidden" ) { your_function(); } }); 
```

`your_function()`您的函数的名称在哪里。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-28T14:26:23.757

所有的解决方案`$('.someClass').is(':visible')`都是不可靠的。它告诉我们的只是一个特定元素的样式是否为`display:none`or `visibility:hidden`。这和一个元素是否可见是**不一样的！**

考虑这样的情况：

> `<div style="display:none;"><div class="someClass"></div></div>`

大家可以看到 指定的元素`$('.someClass')`是不可见的。但`$('.someClass').is(':visible')`会回来`true`！

唯一的防水解决方案是不仅要检查，还要检查`is(':visible')`其`$('.someClass')`所有父元素。只有当**没有**父母认为 时`is(':visible') === false`，我们才能得出结论，`$('.someClass')`实际上是可见的。

# javascript - 在 IE6 中使用一维 (CSS) 缩放图像时如何保持纵横比？

> ID：757782
> 
> 赞同：93
> 
> 时间：2009-04-16T19:50:03.057
> 
> 标签：javascript, css, internet-explorer, image, internet-explorer-6

这就是问题所在。我有一张图片：

```
<img alt="alttext" src="filename.jpg"/> 
```

注意没有指定高度或宽度。

在某些页面上，我只想显示缩略图。我无法更改 html，所以我使用以下 CSS：

```
.blog_list div.postbody img { width:75px; } 
```

哪个（在大多数浏览器中）使页面具有统一宽度的缩略图，所有这些都具有保留的纵横比。

但在 IE6 中，图像仅按 CSS 中指定的尺寸进行缩放。它保留了“自然”高度。

这是说明问题的一对页面的示例：

*   [该列表应显示缩略图](http://www.escapelondon.co.uk/profiles/blog/list)
*   [一篇博文，显示全尺寸图像。](http://www.escapelondon.co.uk/profiles/blogs/epernay-champagne)

我非常感谢所有建议，但想指出（由于客户选择平台的限制）我正在寻找不涉及修改 html 的东西。CSS 也比 javascript 更可取。

编辑：应该提到图像的大小和纵横比不同。

* * *

## 回答 #1

> 赞同：197
> 
> 时间：2009-04-16T21:31:08.913

Adam Luter 给了我这个想法，但事实证明它非常简单：

```
img {
  width:  75px;
  height: auto;
} 
```

IE6 现在可以很好地缩放图像，这似乎是所有其他浏览器默认使用的。

感谢您的两个答案！

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-04-29T18:15:01.963

我很高兴这成功了，所以我猜你必须在 IE6 上明确设置“自动”才能模仿其他浏览器！

实际上，我最近发现了另一种缩放图像的技术，同样是为背景设计的。这种技术有一些有趣的特点：

1.  保留图像纵横比
2.  图像的原始大小保持不变（即它永远不会缩小只会增长）

标记依赖于包装元素：

```
<div id="wrap"><img src="test.png" /></div> 
```

鉴于上述标记，您可以使用以下规则：

```
#wrap {
  height: 100px;
  width: 100px;
}
#wrap img {
  min-height: 100%;
  min-width: 100%;
} 
```

如果你然后控制包装器的大小，你会得到我上面列出的有趣的缩放效果。

明确地说，考虑以下基本状态：一个 100x100 的容器和一个 10x10 的图像。结果是 100x100 的缩放图像。

1.  从基本状态开始，容器调整为 20x100，图像保持调整为 100x100。
2.  从基本状态开始，图像更改为 10x20，图像大小调整为 100x200。

所以，换句话说，图像总是*至少*和容器​​一样大，但会*超出*它以保持它的纵横比。

这可能对您的站点没有用，并且在 IE6 中不起作用。但是，为您的视口或容器获取缩放背景很有用*。*

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T19:57:00.357

好吧，我可以想到一个 CSS hack 来解决这个问题。

您可以在 CSS 文件中添加以下行：

```
* html .blog_list div.postbody img { width:75px; height: SpecifyHeightHere; } 
```

上面的代码只有 IE6 才能看到。纵横比不会是完美的，但你可以让它看起来有点正常。如果你真的想让它变得完美，你需要编写一些 javascript 来读取原始图片的宽度，并相应地设置比例以指定高度。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-16T20:13:32.207

在 CSS 中进行显式缩放的唯一方法是使用[此处](http://www.markschenk.com/cssexp/background/scaledbgimage.html)找到的技巧。

仅限 IE6，您还可以使用过滤器（查看[PNGFix](http://homepage.ntlworld.com/bobosola/pngtestfixed.htm)）。但是将它们自动应用到页面将需要 javascript，尽管 javascript 可以嵌入到 CSS 文件中。

如果您需要 javascript，那么您可能只想让 javascript 通过在内容加载后检查图像来填充高度的缺失值。（对不起，我没有这项技术的参考）。

最后，请原谅我这个肥皂盒，您可能想在这件事上避开 IE6 支持。您可以`_width: auto`在您的`width: 75px`规则之后添加，以便 IE6 至少可以合理地呈现图像，即使它是错误的大小。

我推荐最后一个解决方案只是因为 IE6 即将淘汰：20% 并且[每月下降近一个百分点](http://marketshare.hitslink.com/browser-market-share.aspx?qprid=3)。另外，我注意到您的网站是娱乐性的，并且位于英国。这两者都有助于人口远离 IE6：周末 IE6 的使用率下降了近 40%（抱歉没有引用），而英国的 IE6 人口要低得多（再次没有引用，抱歉）。

祝你好运！

# javascript - 用于向某些元素添加自定义属性的 Javascript

> ID：757799
> 
> 赞同：49
> 
> 时间：2009-04-16T19:54:40.037
> 
> 标签：javascript

给定一段 HTML，我可以选择性地选择某些类型的元素（例如，输入）并使用 JavaScript 添加自定义属性吗？如果它存在，我还需要删除它。

我在使用 jQuery 之前已经这样做了，但是我无法将它用于这个特定的任务。

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2009-04-16T20:09:15.850

[使用 DOM 访问 HTML 属性](http://www.javascriptkit.com/dhtmltutors/domattribute.shtml)

```
element.hasAttribute('foo');
element.getAttribute('foo');
element.setAttribute('foo', value);
element.removeAttribute('foo'); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2021-01-01T14:49:32.393

```
<div class="first-div">
<p class="first-p">Hello!
</p>
</div> 
```

通过javascript添加属性：

```
var myDiv= document.getElementsByClassName("first-div")[0];
var myp= myDiv.children[0];
nyp.setAttribute('myAttribute','valueForAttribute'); 
```

通过javascript获取属性：

```
 console.log(myp.getAttribute('myAttribute')); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T19:56:37.317

```
el.attribute = value 
```

这就是它的全部。如果该属性不存在，则创建该属性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-08-21T12:52:33.750

您可以在这里查看如何获取和设置属性。

[https://jsfiddle.net/tuc57hbp/6/](https://jsfiddle.net/tuc57hbp/6/)

要获取属性，您必须首先获取`<td>`值。然后你必须得到它的`input`孩子 using`td.children[0]`并设置`input`孩子们的`attribute`价值 using `input.setAttirbute('dummy', 'value')`。然后使用`getAttribute('dummy')`.

# visual-studio - Sql Server Management Studio 是否有类似 devenv.exe /Edit 的命令行选项

> ID：757800
> 
> 赞同：11
> 
> 时间：2009-04-16T19:55:42.343
> 
> 标签：visual-studio, visual-studio-2008, command-line, automation, ssms

我正在使用 Visual Studio 的外部工具在 Sql Server Management Studio (SSMS) 中打开 .sql 脚本。问题是，每次我使用外部工具命令从 Visual Studio 打开一个 .sql 文件时，它都会打开一个新的 SSMS 实例。

Visual Studio 有一个开关 /Edit 可以执行此操作，是否有用于 SQL Server Management Studio 的开关？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-15T08:42:42.597

选择使用 Explorer[1] 而不是 SSMS 打开文件。这样，系统将首先搜索任何现有的 SSMS 实例。

[1] %windir%\explorer.exe

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T06:51:13.583

我认为问题不在于 Visual Studio 外部工具命令。查看 SSMS 命令行选项 - 也许有一种方法可以强制重用现有的 SSMS 实例。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-19T06:26:02.823

以下对我有用（虽然我是 SQL Server 2008）：

所以我想真正的答案是使用[cmdow](http://www.commandline.co.uk/cmdow/)

编辑：经过更多测试后，我意识到以下内容：首先打开带有连接的文件：（复制时删除任何输入，这是一个衬里）

```
"C:\Program Files\Microsoft SQL Server\100\Tools\Binn\VSShell\
Common7\IDE\Ssms.exe" "C:\Users\yordgeor\Desktop\Trigger.sql"
"C:\Users\yordgeor\Desktop\Trigger1.sql" -S ysg -d poc_dev -E -nosplash 
```

在这个例子中，它打开了两个文件（但你当然可以打开更少；）之后，无论我运行多少次

```
cmdow /Run "C:\Users\yordgeor\Desktop\Trigger1.sql" 
cmdow /Run "C:\Users\yordgeor\Desktop\Trigger2.sql" 
cmdow /Run "C:\Users\yordgeor\Desktop\Trigger3.sql" 
```

它使用相同的连接打开 Microsoft Sql Server Management Studio 的相同实例

您可以在命令行一次打开许多文件，但我怀疑您要求上层答案。

因此，您可以通过以下方式找到 Ssms.exe 的路径： cd %ProgramFiles%

目录 *ssms.exe /s /b

所以命令的语法是： pathToTheExe pathToFile1 pathToFile2 -S serverName -d DatabaseToConnectTo -E (toUseWindowsAuthentication) -nosplash

[经过 20 秒的谷歌搜索后，我从这里](http://www.mssqltips.com/tip.asp?tip=1602)作弊：

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-14T21:57:26.767

正确答案是否定的。SSMS 有一组有限的选项，虽然它使用 VS 框架，但不支持编辑命令。这可能是一个有趣的功能。

我假设您需要在 SSMS 中打开这些脚本才能运行它们，否则我建议将它们直接指向 Visual Studio，因为它确实支持语法突出显示。但是，它不会解决您的问题。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2009-04-21T13:05:28.697

如果您将该文件扩展名与 Visual Studio 相关联，则 VS 应该打开它。

如果您发现 VS 每次都启动一个新实例，那么您需要指定 /edit 命令行选项。

查看[http://stevedunns.blogspot.com/2009/03/programs-that-launch-or-should-launch.html](http://stevedunns.blogspot.com/2009/03/programs-that-launch-or-should-launch.html)了解更多信息。

# javascript - jQuery MaskMoney 插件和字段类型 Decimal（SQL SERVER 表）的问题

> ID：757804
> 
> 赞同：1
> 
> 时间：2009-04-16T19:56:25.693
> 
> 标签：javascript, jquery, sql-server, asp.net-mvc, linq-to-sql

我正在使用 ASP.NET MVC 框架、jQuery 库 (1.3.2)、linq to sql、sql server 2005。

我在使用 jQuery MaskMoney 插件时遇到问题，无法将数据保存在 sql server 表中。

我创建了一个表，其中该表有一个字段“valueProducts”，类型为 Decimal(18,2)。

在我的页面中，我有一个带有 jQ​​uery maskmoney 的 html 字段。示例：10.000,00（一万 (R$)）。

当我保存此数据时，出现此错误：“'MercanteWeb.Dados.MateriasPrimasEntradas' 类型的模型未成功更新。” （我使用 UpdateModel 来保存数据）。

我发现这个问题是由于千位分隔符 (.) 而发生的，如果我删除这个掩码插件，它就可以工作。

有人可以帮助我吗？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-17T18:24:38.917

我做到了。

上面答案的问题在于 Linq 到 SQL 的数据映射。字段类型money 或smallmoney 使用十进制类型进行映射。

我找到的解决方案是......

我不使用 UpdateModel 节省视图的钱字段。

前：

```
Check c = new Check();
this.UpdateModel(c, new[] { "number", "name", "value1", "value2" }); 
```

后：

```
Check c = new Check();
this.UpdateModel(c, new[] { "number", "name" });
c.value1 = Convert.ToDecimal(f["value1"]);
c.value2 = Convert.ToDecimal(f["value2"]); 
```

这样，该值成功转换为十进制数据类型。

在视图中，我使用了 Globalization 命名空间的对象。

```
//ViewPage
<%@ Page Title="" Language="C#" MasterPageFile="~/Views/Shared/Site.Master" Inherits="System.Web.Mvc.ViewPage" %>
<%@ Import Namespace="System.Globalization" %>
<asp:Content ID="Content1" ContentPlaceHolderID="MainContent" runat="server">

<% 
NumberFormatInfo LocalFormat = (NumberFormatInfo)NumberFormatInfo.CurrentInfo.Clone();
LocalFormat.CurrencySymbol = "";

Check c = (Check)ViewData.Model;

%>

//In the field, I use de string format type currency and I passed the object of //CurrentSymbol
...
Value1:<br>
<%= Html.TextBox("value1", Convert.ToDouble(c.value1).ToString("C", LocalFormat))%>
....
</asp:Content> 
```

感谢你们对我的帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T03:58:50.357

您可以删除分隔符：

```
$("#real").maskMoney({symbol:"R$",decimal:"",thousands:""}); 
```

或者通过 asp.net 中的数字解析删除它们，它会起作用。我不熟悉asp.net，所以我不能给你语法。

出于安全原因，无论如何我都会在服务器端进行一些数据解析/检查。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-04-20T00:35:29.210

我是 jquery-maskmoney 插件的维护者。正如您在[插件主页](https://github.com/plentz/jquery-maskmoney)中看到的那样，您可以禁用千位分隔符。就像是：

```
$("#currency").maskMoney({thousands:""}); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T05:04:57.747

如果数据作为字符串直接写入数据库，SQL Server 仅支持基本的英国/美国数字格式，例如 10000.00。在转到 SQL Server 之前，您必须将数据清理为基本格式或数字格式。

也请参阅这个问题：[SQL Server 在将值转换为字符串/从字符串转换时是否考虑文化/语言环境？](https://stackoverflow.com/questions/745652)

日期和文本排序可以调整为语言环境等，但不能调整为数字格式。

另外，我建议从效率和性能方面来说，money 或 smallmoney 会是更好的数据类型：[float vs decimal vs money 数据类型文章和流程图](http://sqlcat.com/technicalnotes/archive/2008/09/25/the-many-benefits-of-money-data-type.aspx)

# c# - 获取用户在浏览器中输入的确切 url

> ID：757806
> 
> 赞同：8
> 
> 时间：2009-04-16T19:56:41.013
> 
> 标签：c#, asp.net, url, request

我想获取用户在浏览器中输入的确切网址。当然，我总是可以使用类似的东西，`Request.Url.ToString()`但这并不能在以下情况下给我想要的东西：

`http://www.mysite.com/rss`

上面的网址`Request.Url.ToString()`会给我的是：

`http://www.mysite.com/rss/Default.aspx`

有谁知道如何做到这一点？

我已经尝试过：

*   `Request.Url`
*   `Request.RawUrl`
*   `this.Request.ServerVariables["CACHE_URL"]`
*   `this.Request.ServerVariables["HTTP_URL"]`
*   `((HttpWorkerRequest)((IServiceProvider)HttpContext.Current).GetService(typeof(HttpWorkerRequest))).GetServerVariable( "CACHE_URL")`
*   `((HttpWorkerRequest)((IServiceProvider)HttpContext.Current).GetService(typeof(HttpWorkerRequest))).GetServerVariable( "HTTP_URL")`

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T19:58:54.330

编辑：您想要[`HttpWorkerRequest.GetServerVariable()`](http://msdn.microsoft.com/en-us/library/system.web.httpworkerrequest.getservervariable.aspx)带有键[`HTTP_URL`](http://msdn.microsoft.com/en-us/library/ms524602(VS.85).aspx)或[`CACHE_URL`](http://msdn.microsoft.com/en-us/library/ms524602(VS.85).aspx). 请注意，IIS 5 和 IIS 6 之间的行为不同（请参阅密钥文档）。

为了能够访问所有服务器变量（以防万一`null`），直接访问 HttpWorkerRequest：

```
HttpWorkerRequest workerRequest = 
  (HttpWorkerRequest)((IServiceProvider)HttpContext.Current)
  .GetService(typeof(HttpWorkerRequest)); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T20:59:52.640

还要记住，“用户输入的确切 URL”可能永远不会在服务器上可用。从手指到服务器的链中的每个链接都可以稍微修改请求。

例如，如果我在浏览器窗口中输入 xheo.com，IE 会自动转换为[http://www.xheo.com](http://www.xheo.com)。然后，当请求到达 IIS 时，它会告诉浏览器 - 你真的想要[http://www.xheo.com/Default.aspx](http://www.xheo.com/Default.aspx)的默认页面。所以浏览器通过询问默认页面来响应。

HTTP 30x 重定向请求也会发生同样的情况。服务器可能只会看到浏览器发出的最终请求。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-10-20T05:42:07.057

尝试使用`Request.Url.OriginalString` Might 为您提供您正在寻找的东西。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-04-29T14:38:15.553

有可能，您只需要结合请求对象中的一些值来重建输入的确切 url：

```
Dim pageUrl As String = String.Format("{0}://{1}{2}", 
    Request.Url.Scheme, 
    Request.Url.Host, 
    Request.RawUrl)

Response.Write(pageUrl) 
```

输入地址[http://yousite.com/?hello](http://yousite.com/?hello)准确返回：

```
http://yousite.com/?hello 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T20:51:12.083

```
Request.RawUrl 
```

我想是你追的那只猴子……

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-09-23T05:36:50.297

最简单的方法是使用客户端编程来提取确切的 url：

```
<script language="javascript" type="text/javascript"> 
document.write (document.location.href); 
</script> 
```

# python - django-paypal 设置

> ID：757809
> 
> 赞同：14
> 
> 时间：2009-04-16T19:57:51.277
> 
> 标签：python, django, paypal

有人设置 django-paypal 吗？这是这里的链接[吗](https://github.com/johnboxall/django-paypal)？

我有“myproject”设置，我的文件夹结构如下所示：

myproject > paypal > (stdandard 和 pro 文件夹)

到我添加的 settins.py 文件中

```
INSTALLED_APPS = (
    'myproject.paypal.standard',
    'myproject.paypal.pro',
) 
```

在我的帐户应用程序的网址文件中，我添加了：

```
urlpatterns += patterns('myproject.account.views',
    (r'^payment-url/$', 'buy_my_item'),                   
) 
```

在我的帐户视图中，我添加了：

```
from myproject.paypal.pro.views import PayPalPro
from myproject.paypal.pro.forms import PaymentForm, ConfirmForm

def buy_my_item(request):
    item = {'amt':"10.00",              # amount to charge for item
            'inv':"1111",         # unique tracking variable paypal
            'custom':"2222",       # custom tracking variable for you
            'cancelurl':"http://127.0.0.1:8000/",   # Express checkout cancel url
            'returnurl':"http://127.0.0.1:8000/"}   # Express checkout return url

    kw = {'item':'item',                            # what you're selling
           'payment_template': 'pro/payment.html',          # template to use for payment form
           'confirm_template': ConfirmForm,  # form class to use for Express checkout confirmation
           'payment_form_cls': PaymentForm,  # form class to use for payment
           'success_url': '/success',               # where to redirect after successful payment
           }

    ppp = PayPalPro(**kw)
    return ppp(request) 
```

--- 编辑 --------- 然后，我将 pro 和 standard 模板文件夹添加到我的项目模板文件夹中。

当我去[http://127.0.0.1:8000/account/payment-url/](http://127.0.0.1:8000/account/payment-url/)并提交表格时......

我得到一个 ValueError：“字典更新序列元素 #0 的长度为 1；需要 2”

追溯：

```
File "...\accounts\views.py" in buy_my_item
  655\.     return ppp(request)
File "...\paypal\pro\views.py" in __call__
  115\.                 return self.validate_payment_form()
File "...\paypal\pro\views.py" in validate_payment_form
  133\.             success = form.process(self.request, self.item)
File "...\paypal\pro\forms.py" in process 
```

35.  params.update（项目）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T20:01:16.727

在您的代码中...

```
 'payment_form_cls': 'payment_form_cls',  # form class to use for payment 
```

这必须是用于验证的 Form 对象。

```
 'payment_form_cls': MyValidationForm,  # form class to use for payment 
```

* * *

**编辑**

[http://github.com/johnboxall/django-paypal/tree/master](http://github.com/johnboxall/django-paypal/tree/master)

你的请求应该包含一个 notify-url、return-url 和 cancel-return。您提供给 Paypal 的所有三个网址。

Paypal 将向这些 URL 发送消息。

由于 Paypal 将向这些 URL 发送消息，因此您必须将它们放在您的 urls.py 中。您必须为这三个 url 编写视图函数。这些网址会将您的贝宝回复发送给他们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T11:49:19.740

[PayPal django 集成](http://uswaretech.com/blog/2008/11/using-paypal-with-django/)帖子应该对您有所帮助。

# java - Hibernate 多态性：实例化正确的类

> ID：757812
> 
> 赞同：7
> 
> 时间：2009-04-16T19:58:15.160
> 
> 标签：java, hibernate, orm

正如您很快就会看到的那样，我是休眠的新手。如果这个问题有一个简单的答案，我深表歉意，但我对所有术语都不够熟悉，无法轻松找到它。

假设我有一个基类“A”和一个子类“B”，我正在使用 Hibernate 进行映射，可能使用每个子类策略的表。基类不是抽象的。所有 B 都是 As，但并非所有 As 都是 B。这反映在数据库中，其中表 B 引用表 A。

好的，现在假设我有一个显示 A 对象列表的程序。用户可以选择任何 A 对象并被带到屏幕以对其进行修改...但是，如果 A 对象也是 B，则屏幕将允许用户修改 B 而不仅仅是 A。

我到底该如何处理这个问题？

**注意：我不是在问如何确定对象是什么类。我要问的是如何让休眠状态返回正确类的对象列表。**

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T22:17:53.497

我再次为这个问题道歉。我对hibernate的工作方式感到非常惊讶，它真的很酷。我不认为它会自动完成所有这些，我什至不确定我想问什么。当我回复评论时，我开始在脑海中细化这个问题，然后能够找到我正在寻找的答案。感谢所有帮助过的人。

答案是：hibernate 会自动执行此操作。

假设您的数据库中有一个带有主键“id”的表 A，而表 B 有一个名为“a_id”的主键，它引用了表 A。

因此，您创建了以下类（缩写）：

```
public class A {
  private String aProperty;
  // ... getter and setter, etc
{

public class B extends A {
  private String bProperty;
  // ... getter and setter, etc
} 
```

然后像这样映射它们：

```
<hibernate-mapping>
    <class name="A" table="a" catalog="testokdelete">
        <id name="id" type="java.lang.Integer">
            <column name="id" />
            <generator class="identity" />
        </id>
        <property name="aProperty" column="a_property"/>
        <joined-subclass name="B" table="b">
            <key column="a_id"/>
            <property name="bProperty" column="b_property"/>
        </joined-subclass>
    </class>
</hibernate-mapping> 
```

您可以使用简单的“来自 A”查询返回 A 和 B 对象，如以下代码所示：

```
Query query = session.createQuery("from A");
List<Object> objects = query.list();
for (Object object: objects) {
    System.out.print("A property: ");
    System.out.print(((A)object).getAProperty());
    System.out.print(", B property: ");
    System.out.println( (object.getClass() == B.class) ? ((B)object).getBProperty() : "not a B");
} 
```

它所做的只是使用“来自 A”的查询返回一个对象列表，然后遍历它们，从我们的 A 类中打印出 aProperty，如果该类是 B 类型，则从我们的 B 类中打印出 bProperty。

在这种情况下，hibernate 查询是自动多态的，并会在适当的时候给你一个 B 对象。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T20:10:37.393

您可以将 RTTI 与 instanceof 一起使用，但这不是面向对象的。

相反，给基类`A`一个方法，该方法与 extra a`B`所做的事情有关，例如，如果`A`is`Customer`和`B`is `PreferredCustomer`，则该方法可能是`isPreferredCustomer()`。

在`A`中，该方法返回 false，在`B`它返回 true。

需要注意的是，我们不是在询问一个对象是否属于某个类。我们在问一个业务问题，问一个对象是否可以做某事。这是一个微妙但重要的区别。

特别是，这意味着您的代码在添加更多子类时不必更改`Customer`，只要每个子类如实回答问题，`isPreferredCustomer()`.

在您的代码中：

```
if( a.isPreferredCustomer() ) {
  showPreferredCustomerPage( a) ;
else { 
  show CustomerPage(a);
} 
```

`Customer`你可能认为给出一个方法会更好`showPage()`，但是这将你的模型和你的视图绑定得太紧了。

相反，您将上述代码放在某个`ViewDispatcher`类中，该类可能与 Customer 及其子类正交变化。

例如，您可能有几个`ViewDispatcher`子类，其中一些关心`PreferredCustomer`s 而一些不关心。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-17T05:25:25.093

好吧，我假设您的类已正确映射。如果你这样做了，你应该能够做到以下几点，我认为：

```
public List<A> getAllClassA(){
      Session session = HibernateUtil.getSession();
      Criteria criteria = session.createCriteria(A.class);

      List<A> ret = criteria.list();

      return ret;
} 
```

如果您不熟悉 Criteria，那么它很容易上手。这段代码将从数据库中检索 A 类的所有对象。如果您正确映射了它，我认为 Hibernate 还将维护您的 A 对象的 B 属性，如果它们实际上是 B 对象（对不起，如果这令人困惑）。

如果这是您正在寻找的，或者您是否需要 HibernateUtil 的代码，请告诉我。

# ruby-on-rails - 在 Rails 中延迟设置模型属性？

> ID：757814
> 
> 赞同：0
> 
> 时间：2009-04-16T19:59:00.523
> 
> 标签：ruby-on-rails, model

我有一个通过解析数据文件生成的模型。有几个有趣的值不存在于原始数据文件中，但可以从存在的值中导出。

但是，许多这些派生值的计算成本很高，因此我想在计算完它们后将它们存储在数据库中。

我试过这个：

```
def profit
  if not self[:profit]
    update_attribute :profit, expensive_computation
  end
  self[:profit]
end 
```

不幸的是，这只完成了一半的工作。计算的值被存储，但每次我调用利润时，它都会再次计算该值。

更新：

结果发现问题不在于方法，而在于之前的 find_by_sql 语句中，Rails 对模型的 id 感到困惑。我最终得到的代码是这样的：

```
def profit
  unless read_attribute(:profit)
    update_attribute(:profit, expensive_computation ) 
    self.save!
  end
  read_attribute(:profit)
end 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T20:41:37.457

您创建一个新方法并从中删除读取逻辑。也许是这样的

```
 def update_profit
    update_attribute :profit, expensive_computation
 end 
```

这样您就可以分离阅读逻辑，并使用该方法来获取`profit`rails 为您提供的方法。

```
 @model.profit 
```

其中@model 是属性`profit`所在类的实例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-11-17T19:55:34.333

```
def profit
  super || update_attribute(:profit, expensive_computation)
  return super
end 
```

如果利润列中有信息，只需调用对象的原始利润方法，该方法将从数据库中返回该`profit`列的内容。

否则，（即`profit`列的值为`nil`）使用该`update_attribute`方法计算该`profit`值并将其存储到数据库中，然后再次从数据库中返回该值。

如果您希望获得`profit`它是否已经在数据库中或者只是`true`昂贵的计算已经运行的值，只需执行此操作（`update_attribute`返回 true 或 false）：

```
def profit
  super || update_attribute(:profit, expensive_computation)
end 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T00:39:52.317

这对我来说很好。我的第一个想法是：你有错字`if not self[:profit]`吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T20:50:33.397

代码应该去哪里取决于何时可以计算利润（例如，一旦记录第一次被保存，或者有时会稍后保存？），以及利润是否可以改变。

一般来说，最好将计算放在某种`before_create`/`before_save`调用中，仅在可以计算和/或已更改时才保存它

vrish88 是正确的，您可能应该不理会该`profit`方法，除非您确实需要在需要数据时即时计算此方法。如果这确实是您需要的，请尝试：

```
def profit
  update_attribute(:profit, expensive_computation) unless read_attribute(:profit)

  read_attribute(:profit)
end 
```

# python - 使用 Python 测量高清性能的最简单和最快的方法是什么？

> ID：757816
> 
> 赞同：1
> 
> 时间：2009-04-16T20:00:35.887
> 
> 标签：python, performance, postgresql

我需要使用 python 测量硬盘的性能。最好/最快/最短/最简单的方法是什么？它不必过于准确，只是一个大概的值。

我的实际目标是编写一个小型实用程序，它将 postgres 设置调整为给定硬件的最佳配置。

我天真的方法是写一些文件并测量需要多长时间。我会尝试几种块大小，然后我会尝试访问大文件中的一些随机位置。还有其他想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T21:07:54.150

我认为您最好的选择是使用外部工具，例如 Bonnie++，并解析程序输出。即使您不那么关心精度，也没有理由重新发明轮子。为什么要重写已经存在的东西？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T20:03:19.203

从这里开始：[http ://www.acnc.com/benchmarks.html](http://www.acnc.com/benchmarks.html)

获取您喜欢用 Python 编写类似内容的源代码。

# visual-studio-2008 - 如何防止通用参数被 VS2008 单元测试搞砸

> ID：757817
> 
> 赞同：0
> 
> 时间：2009-04-16T20:00:46.590
> 
> 标签：visual-studio-2008, unit-testing

我有两个这样的类（在实际项目中）：

```
namespace app {
    internal class A {
    }

    internal class B {
        private List<A> list;
        private void SomeMethodToTest() {
            list = new List<A>() { new A() };
        }
    } 
```

我的单元测试看起来像

```
[TestClass()]
public class ATest {
    [TestMethod()]
    public void TestSomeMethod() {
        B_Accessor b = new B_Accessor();
        b.SomeMethodToTest();
        Assert.AreEqual(1, b.list.Count); // ERROR ON THIS LINE
    }
} 
```

在标记的行上，我得到一个 InvalidCastException 说“无法将 System.Collections.Generic.List'1[app.A] 类型的对象转换为 System.Collections.Generic.List'1[app.A_Accessor]

问题是，因为 A 是内部的，所以自动生成的类 B_Accessor 看起来像

```
[Shadowing("app.B")]
public class B_Accessor : BaseShadow {
    ... stuff ...

    [Shadowing("list")]
    public List<A_Accessor> list { get; set; }

    ... stuff ...
} 
```

请注意，在 Accessor 类中，列表的类型是 List<A_Accessor> 而不是 List<A>。我已经在应用程序上指定了InternalsVisibleTo属性，所以测试项目可以访问类型A，但是由于某种原因VS将其替换为访问器类型，这使得该类型与包装类型不兼容。

除了公开 A 之外，我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-16T20:37:46.717

可以用类似的东西替换测试项目

```
internal static class AccessorExtensionMethods {
    internal static List<A> Get_list(this PrivateObject po) {
        return (List<A>)po.GetField("list");
    }
}

[TestClass()]
public class ATest {
    [TestMethod()]
    public void TestSomeMethod() {
        PrivateObject bpo = new PrivateObject(new B());
        B_Accessor b = new B_Accessor(bpo);
        b.SomeMethodToTest();
        Assert.AreEqual(1, bpo.Get_list().Count);
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T20:07:48.087

我已经删除了我之前的答案，因为我没有注意到您已经在使用`InternalsVisibleToAttribute`.

是什么产生了这些“访问器”类？当您说“VS 用访问器类型替换它”时，您的意思是它会更改您的源代码吗？这听起来很奇怪——如果你把它放回去只使用`A`and`B`而不是`A_Accessor`and会发生`B_Accessor`什么？

如果您可以摆脱自动生成的类，这些类看起来像真实的，但不完全是，那么请摆脱它们*。*我怀疑这只是他们会引起问题的*一种*情况。

`InternalsVisibleTo`直接使用和测试内部成员我从来没有遇到过任何问题。（嗯，R# 在以前的版本中有时会感到困惑，但除此之外......）

# vb.net - 将 vb6 项目转换为 VB.NET 后删除警告消息的简单方法

> ID：757821
> 
> 赞同：0
> 
> 时间：2009-04-16T20:01:39.193
> 
> 标签：vb.net, visual-studio-2008

我已将一个 VB6 项目转换为 VB.NET，并留下大量内联“警告消息”，例如我想摆脱的“UPGRADE_WARNING：无法解析对象 varJonSkeet 的默认属性”。有没有办法在 Visual Studio 2008 中做到这一点？使用正则表达式删除警告消息会更容易吗？我更愿意一次删除一个文件，但这不是一个破坏者。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-10-17T13:51:32.350

如果使用 VS 2008，快速简单的修复，使用**Find and Replace**：

*   打开查找选项
*   单击“使用”，然后选择“通配符”
*   在“查找内容”中输入“升级警告*”并将“替换为”留空
*   点击“全部替换”

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T20:05:20.570

消除警告的最佳方法是解决警告所抱怨的可疑代码。也就是说，更改代码，使其不再值得警告。不要仅仅寻求完全禁用警告的生成。

您需要提供有关您关注的特定警告的更多详细信息以及随附的代码。但请记住先在这里搜索以前的答案。

* * *

我看到警告实际上是代码中的文本，而不是编译器输出中发出的消息。摆脱这些问题的方法是搜索关键字（我猜是*UPGRADE_WARNING*），考虑它警告的问题是否已经解决或仍然是一个有效的问题，如果有问题，请修复问题，然后删除警戒线。例如，确实`varJonSkeet` *有*一个默认属性，如果没有，是否需要一个？您应该改用非默认属性吗？（你不是真的在问如何删除一行文本，是吗？）

如果您已经浏览了整个文件并确定没有任何警告是有效的，那么有一种快速删除所有警告行的方法。

```
grep -v UPGRADE_WARNING input_file.vb > output_file.vb
ren output_file.vb input_file.vb

```

如果您`grep`的系统上还没有，那么您还没有完整的开发环境。[去拿一份。](http://unxutils.sourceforge.net/)该`-v`选项告诉它反转搜索结果，从而打印所有*不*包含搜索模式的行。那些被写入新文件。然后用新文件替换旧文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T20:10:54.333

我相信他是说他想从他的代码中删除内联注释。

最快的方法是在文件中查找 UPGRADE_WARNING: 并手动删除它们。

或者，

您可以创建一个新的 .Net 程序来遍历源目录中的每个 .vb 文件并使用 StreamReader 读取它们，然后一次将它们写出 1 行到同一个文件中，并且在您去省略任何包含 UPGRADE_WARNING 的行时： .

如果您采用第二种方式，您会因为完成更多的 vb.net 编码而变得更好。

```
 Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click

        Dim FileName As String = "c:\form1.vb"
        Dim SourceFile As System.IO.FileInfo = New FileInfo(FileName)
        Dim SourceTextStream As System.IO.TextReader = SourceFile.OpenText()

        Dim SourceFileContent() As String = Split(SourceTextStream.ReadToEnd(), vbCrLf)
        SourceTextStream.Close()

        Dim CurrentSourceLine As String
        Dim CurrentSourceLineNumber As Long

        Dim DestStream As StreamWriter = New StreamWriter(FileName)
        Dim LogStream As StreamWriter = New StreamWriter(FileName + ".log")

        For Each CurrentSourceLine In SourceFileContent
            CurrentSourceLineNumber += 1
            If InStr(CurrentSourceLine, "UPGRADE_WARNING") = 0 Then
                DestStream.WriteLine(CurrentSourceLine)
            Else
                ' Write to Log File
                LogStream.WriteLine("Line Skipped at number: " + CurrentSourceLineNumber.ToString())
            End If
        Next

        DestStream.Close()
        LogStream.Close()

    End Sub 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T20:03:52.087

在 VB.NET 中重写项目。摆脱警告可能只是达到（我认为）是一个工作程序的目标的一种手段。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-11-14T19:45:14.567

上面提到的 VS 2008 方法不适用于 VS 2010 及更高版本。对于 VS 2010 及更高版本，请按照以下步骤删除升级警告...

1.  CTRL + F
2.  展开“查找...”下拉菜单并选择“在文件中查找...”。
3.  选择“在文件中替换”选项卡。
4.  查找内容：[^\S\r\n]'UPGRADE_WARNING:.*\r?\n
5.  替换为：空白
6.  展开“查找选项”。
7.  选中“使用正则表达式”。
8.  开始搜索/替换/全部替换。

解释：使用正则表达式， [^\S\r\n] 告诉正则表达式忽略行首的空格，然后显然 'UPGRADE_WARNING: 是正在寻找的警告注释的开始，然后是 . * 告诉 regex 忽略直到 *\r?\n 的所有其他内容，然后 *\r?\n 告诉 regex 也匹配最后的换行符（没有这部分会留下一个空白行，每个警告都会已经）。

# svn - 在被认为有害的 SVN 子目录上提交和合并？

> ID：757831
> 
> 赞同：12
> 
> 时间：2009-04-16T20:05:05.877
> 
> 标签：svn, merge, tortoisesvn, svn-merge

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-16T20:33:46.963

一种可能的解释是您可能会忘记更改集的某些部分。

如果您正在合并的更改集覆盖了您已签出的子目录之外的文件，那么您总是有可能忘记合并这些文件。

例如，如果您在主干上有这样的提交：

```
r5 | rich | 2009-04-16 22:22:46 +0200 (Thu, 16 Apr 2009) | 2 lines
Changed paths:
   M /trunk/subdir1/main.c
   M /trunk/subdir2/main.c

Change some stuff 
```

然后你从你的分支“stable”中签出 subdir1，然后你可以像这样合并更改集 r5：

```
$ svn co http://example.com/svn/branches/stable/subdir1
$ cd subdir1
$ svn merge -c 5 http://example.com/svn/trunk/subdir1 .
--- Merging r5 into '.':
U    main.c
$ svn ci -m"Merged r5 from trunk" 
```

但这只会合并修订版 5 的一半。更糟糕的是，如果您返回查看日志，现在会显示以下内容：

```
$ svn log -g http://example.com/svn/
...
------------------------------------------------------------------------
r5 | rich | 2009-04-16 22:22:46 +0200 (Thu, 16 Apr 2009) | 2 lines
Changed paths:
   M /trunk/subdir1/main.c
   M /trunk/subdir2/main.c
Merged via: r6

Change some stuff 
```

所以看起来你已经合并了整个提交，而实际上你只合并了其中的一部分。当然 r6 确实表明稳定分支上只有 1 个文件发生了变化。

```
------------------------------------------------------------------------
r6 | rich | 2009-04-16 22:28:16 +0200 (Thu, 16 Apr 2009) | 1 line
Changed paths:
   M /branches/stable/subdir2
   M /branches/stable/subdir2/main.c

Merge revision 5 from trunk 
```

有人必须记住或注意到，只有部分变更集被合并了，其余的需要做。不使用子目录合并可以避免这个问题。

有时您真的不想合并以前的所有提交，而上述情况正是您打算做的。在这种情况下，最好添加一个好的提交消息来描述您的意图。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-20T11:33:52.733

造成这种情况的另一个原因可能是仅合并到根目录会限制将在存储库中的文件夹/文件上设置的 svn:mergeinfo 属性的数量。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T20:35:00.140

提交应该没有问题，但在合并中，SVN 会跟踪合并和未合并的内容。

因此，我假设您希望在根处合并以简化将来的合并（关于 SVN 比较的数据集大小）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T20:46:15.420

对于 1.5 之前的 subversion 版本，合并子目录使得以后合并目录树的其余部分变得非常复杂。如果您合并了一个目录，svn 只需将该目录中所做的所有更改应用到另一个分支。如果您已经合并了一个子目录，然后尝试合并主目录，则子目录中的所有更改都已经在目标分支中（因为您之前合并了它们）。svn 现在不知道这些更改来自之前的合并，它只是在尝试合并子目录时看到有一些“阻碍”的东西，从而导致了很多冲突。

为避免这种情况，您必须注意仅合并您之前未合并的目录，从而使整个过程更加复杂。您必须准确记住您已经合并了哪些子目录的哪些修订，并且只应用剩余目录/修订的剩余更改。这可能会让人感到困惑。总是合并整个分支使这更容易。当前版本的 subversion 在内部跟踪以前的合并，因此可以避免这些问题。

提交子目录没有问题。对于 svn，这只是存储库的正常全局修订。在那个版本中，只有一个子目录会发生变化，但对于 svn，它仍然是整个存储库的新版本，就像任何其他提交一样。

# build - 适用于 Visual Studio MSBuild 的现代构建工具

> ID：757836
> 
> 赞同：4
> 
> 时间：2009-04-16T20:05:49.183
> 
> 标签：build, continuous-integration, build-automation

我是构建自动化和持续集成的新手，但已经对该主题进行了广泛的研究。

首先是问题：假设我有一个非托管的 Visual C++ .sln 文件，并且我可以使用 MsBuild 构建它，我应该选择哪种现代构建工具，它可以让我轻松地执行构建前/构建后的步骤？

我不想要像 Ant、Nant、make 这样的“旧”构建工具及其 XML 混乱。我想要一些可以让我以人类可读的方式自由表达我想做的事情的东西。根据我的研究，Waf、Scons 和 Rake 似乎符合要求。

我的环境背景：我的源代码控制是 Subversion。我的单元测试框架是 GoogleTest，它生成与 JUnit 兼容的 XML 文件。我选择 JIRA 作为我的跟踪工具。我为我的 CI 服务器选择了 TeamCity。我使用 Visual Build 来构建我的 .sln 文件。

我希望能够编写一个简单的构建脚本（可从我的 CI 服务器调用），它将：

1) 创建 CI 服务器工作区目录。
2）从SVN签出代码。（我的存储库设置为使用 svn:externals 从我的其他存储库中提取依赖项）
3) 运行 Visual Build 构建文件以在 .sln 中构建所有项目/平台组合。
4) 运行静态代码分析/动态代码分析工具
5) 为 CI 服务器收集来自 MsBuild 的结果（无论是编译失败、静态/动态代码分析警告还是单元测试失败等）
6) CI 服务器记录此内容并将其链接到吉拉。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-05T14:50:56.317

除了编译代码，Visual Build 还可用于拉取源代码并运行您的分析工具（并且有一个很好的 GUI，可以让您隐藏任何“xml 混乱”。）您的 CI 服务器应该有一个将外部日志集成到构建中的方法。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-05T14:54:32.253

Hudson Java 构建工具有一个 MSBuild 和 Nant 插件。插件也可用，包括 fxcop 和一些你 c# 家伙使用的有趣的单元测试库。

我会说它是市场上最好的免费软件。它还可以调用命令行应用程序等

[http://wiki.hudson-ci.org/display/HUDSON/Installation+and+Execution](http://wiki.hudson-ci.org/display/HUDSON/Installation+and+Execution) Karl

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-01-26T17:09:32.650

仅适用于找到此页面的其他人（就像我一样）：查看这些用于 CI 构建服务器的工具：Pulse TeamCity AnthillPro（这非常专业，但也需要很多学习）CruiseControl

Pulse 和 TeamCity 可以使用 msbuild 构建 sln。还有很多不错的功能，我发现最好的（来自 10 多个）工具作为 CI 服务器。易于管理，强大的支持和良好的功能。

# asp.net - 为什么要使用 RIA 服务共享代码？

> ID：757837
> 
> 赞同：2
> 
> 时间：2009-04-16T20:05:49.790
> 
> 标签：asp.net, wcf-ria-services

在 .NET RIA 服务中，您可以在服务器上编写后缀为 .shared.cs 或 .shared.vb 的代码，并且您可以在客户端使用它。

我的问题是我为什么要这个？

假设我使用带有适当业务对象的 DomainModel 和 ViewModel，我需要的所有代码不会都驻留在这些类中吗？这看起来像是一个潜在的垃圾场，因为开发人员没有正确设计，现在在共享代码中有一堆类，这些类可能属于业务层或 UI 层。

我的想法是对的还是我错过了一些基本的东西？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-18T20:50:50.273

以下是共享代码的一些场景：

1.  服务器和客户端通用的计算属性。假设我想在我的 Product 类上添加一个 ImageUrl 属性，该属性是产品 ID 的函数，并在服务器和客户端上使用该属性。

2.  共享验证码。使用相同的产品类，假设我有一个验证规则，即产品的描述属性必须是一段文本。我可以编写一次该规则，并将其附加到产品或其描述属性，并使其共享允许我在客户端和服务器上进行验证。

3.  实用程序类同样有趣。我可能有一个实用程序类来执行计算或被验证规则等引用。

希望有帮助。

# django - 过滤多对多字段

> ID：757839
> 
> 赞同：1
> 
> 时间：2009-04-16T20:06:42.957
> 
> 标签：django, django-models

所以我有这个模型：

```
class Message(models.Model):
    creator = models.ForeignKey(User, unique=True)
    note = models.CharField(max_length=200, blank=True)
    recipients = models.ManyToManyField(User, related_name="shared_to")
    read = models.ManyToManyField(User, related_name="read", blank=True) 
```

我想过滤同时在收件人和阅读中的人，目前我正在这样做。

```
messages = user.shared_to.all()

for message in messages:
    if user not in message.read:
        do something 
```

我确信有一种方法可以过滤它，但我不知道如何。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T20:30:55.783

如果你使用 Django 开发版本，或者等到 1.1 版本发布，那么你的过滤器[可以引用模型中的其他字段](http://docs.djangoproject.com/en/dev/topics/db/queries/#filters-can-reference-fields-on-the-model)。因此，您的查询将如下所示：

```
>>> Message.objects.filter(recipients=F('read')) 
```

（注意：我拼写的收件人与您在模型中的拼写相同，尽管正确的拼写是“收件人”）

**编辑**：

好的，您的问题令人困惑。当我给出上述答案时，我正在阅读您的声明，即您希望所有用户同时处于“收件人”和“阅读”状态）。但是然后阅读您的代码片段，您似乎想要一个作为收件人但尚未在“已读”列表中的用户列表。

这*可能*是你想要的，但由于要求模糊，我不能完全确定，我无法快速测试它：

```
# Get list of recipients
shared_to = Message.shared_to.all().values('id')

# Now list of recipients who are not in the read field
unread = Message.objects.exclude(recipients__in=shared_to) 
```

这将进行一次查询，但如果您使用的是 MySQL，执行两次查询仍然会[更有效](http://docs.djangoproject.com/en/dev/ref/models/querysets/#in)（阅读性能注意事项警告）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T20:22:23.213

我认为我最初误读了您的问题。尝试以下查询。

```
for message in user.shared_to.exclude(read__id__in=[user.id]):
  do_something() 
```

# c# - 为什么没有处理字体句柄？

> ID：757840
> 
> 赞同：2
> 
> 时间：2009-04-16T20:07:20.737
> 
> 标签：c#, .net, winforms

我正在使用[GDIView](http://www.nirsoft.net/utils/gdi_handles.html)试图追踪一些挥之不去的 GDI 句柄的来源，并且来源似乎是表单上菜单中使用的字体。我发现确保字体句柄被 GCed 的唯一方法是将它们显式设置为 null，如下所示：

```
tsmiTextLocation.Font = null;
tsmiLocationSelection.Font = null; 
```

这对我来说似乎不太正确，但我不确定如何解决这个问题。有没有其他人遇到过这个问题？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T21:50:15.170

即使最好的做法`IDisposable.Dispose()`是通过直接调用或利用 using 关键字来调用自己。某些 GDI+ 对象是此规则的例外。

GDI+ 在 Brushes 和 Pens 类中包含预定义的画笔和钢笔。您不应该调用`Dispose()`这些类的成员返回的对象（或您自己没有创建的其他 GDI 预缓存对象）。

以及来自 MSDN 的注释 - [`Font.Dispose`](http://msdn.microsoft.com/en-us/library/system.drawing.font.dispose.aspx)：

> 在发布对字体的最后引用之前，请始终调用 Dispose。否则，在垃圾收集器调用 Font 对象的 Finalize 方法之前，它正在使用的资源不会被释放。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T20:21:43.870

设置为 null 将使它们最终被垃圾收集，并且将调用终结器。这可能需要一些时间，如果没有内存压力，对象可能会存活一段时间。

System.Drawing.Font 实现 IDisposable，因此您应该调用 Font.Dispose 确定性地释放任何非托管资源（GDI 句柄）。

我相信您必须明确调用 Dispose，因为字体可能是共享的，因此表单无法在其 Dispose 方法中处理字体。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T20:44:14.317

最佳实践是，如果该类实现 IDisposable，您应该尽一切努力在您的实例上调用 Dispose。

大多数 GDI 类都支持 IDisposable。

# .net - .NET 中的 XML 代码注释

> ID：757844
> 
> 赞同：3
> 
> 时间：2009-04-16T20:08:08.193
> 
> 标签：.net, xml, comments

您在代码文件中使用了多少 XML 注释，以及如何使用它们？我已经看到您可以使用它们来生成 XML 文档，但是这个 XML 文档可以用来为您的代码生成 HTML 帮助文件或模式文件吗？

另外，您是否使用过任何自动生成的评论工具（即 GhostDoc），您的印象如何？

想法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T20:18:49.167

如果您将构建中的 XML 文件与 DLL 一起分发，则 XML 文档本身会很有用。这样，API 的任何使用者都可以从 IDE 中获得有用的信息（通过 Intellisense 或对象浏览器）。

现在，XML 注释的最大用途可能是从这些构建的 XML 文件生成帮助文档。[Microsoft Sandcastle](http://www.codeplex.com/Sandcastle)是目前解决此问题的方法。它可以生成 HTML Help 1（即 CHM）文件或 HTML Help 2（即可以集成到 Visual Studio Help 中的帮助文件）。（注意：在过去，NDoc 的选项可能看起来更有吸引力 - 有些人仍在使用它 - 但 Sandcastle 似乎是目前官方和推荐的方法，特别是考虑到它相当稳定和完整，几乎可以满足任何目的。）请参阅[SandcastleDocs](http://www.sandcastledocs.com/)网站以开始使用（我相信这是由 Microsoft 的一位开发人员非正式地整理的）。特别是，您需要查看[Sandcastle 帮助文件生成器](http://www.codeplex.com/Wiki/View.aspx?ProjectName=SHFB)GUI - 根据我的经验，我发现它是一个出色的工具。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T20:17:58.513

我尝试为任何不明显的方法来做它。我喜欢它包含 Intellisense 中的文档。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T20:15:30.343

是的，我确实使用了这个功能，并认为所有开发人员评论他们的 api 是一个很好的做法。一旦你为几个 api 完成了这个，只要你掌握它，维护起来真的不是太难。

选项 1：SandCastle 我尝试使用它，但我发现我必须运行、安装和学习配置的安装程序太多了。最后，我得到了一个 chm 文件，但我真的想要更轻一些的东西。

好处是最终产品看起来非常专业。不过，这对我的情况不起作用。

选项 2：NDoc 上次我检查时，该项目没有得到维护，仅适用于 .NET 1.1 版。

选项 3：XSLT CodeProject 上的某个人为此编写了一个 xslt 文件

[http://www.codeproject.com/KB/XML/XMLDocStylesheet.aspx](http://www.codeproject.com/KB/XML/XMLDocStylesheet.aspx)

我已经尝试过了，这就是它的工作原理。构建您的项目并将 xslt 文件放入与输出的 xml 文件相同的目录中。当您双击您的 xml 文件时，将显示一个格式化的网页，而不是 xml 文档。

对我来说，这是最好的选择。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T20:13:30.443

是的！我使用它们，所有项目都要求我做我们包含它们的事情。至于包含的详细程度，这取决于代码的目的。至少所有参数和公共方法都将具有摘要信息。复杂项目通常有代码示例，并且记录了所有具体抛出的异常。

现在我正在使用 SandCastle 进行文档构建，您可以毫无问题地转到 HTML 或 CHM！我还使用了 SlickEdit，它可以进行动态解析，而且效果也很好！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-16T20:15:50.467

我至少包含公共 API 的注释并生成 xml 文件。这足以让智能感知发挥作用，它也出现在 Reflector 中。

就个人而言，我不关心沙堡等——但我可能会为 ISV 项目而烦恼。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-16T20:18:40.150

我过去曾使用 Microsoft 的 SandCastle 工具从 Xml 注释生成 MSDN 样式的文档，并且运气非常好。据说它是用于生成所有 .net 框架文档的工具，这些文档也恰好来自 Xml 注释。

[http://msdn.microsoft.com/en-us/vstudio/bb608422.aspx](http://msdn.microsoft.com/en-us/vstudio/bb608422.aspx)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-16T20:17:20.433

我们用 XML 注释记录所有方法和属性。既用于内部文档目的，也可以为我们的二进制文件提供帮助文件。在智能感知中弹出方法的文档特别好。

我们正在使用 GhostDoc——它可以提供一个——通常是好的——默认文档，但请记住，GhostDoc 只能记录它可以从方法和参数名称中推断出的内容。因此，我们的规则是您可以使用 GhostDoc 来启动文档；然后适当地编辑它 - 在许多情况下，参数的默认文档就可以了。在简单的情况下，如果有意义的话，我们也只是坚持使用默认文档。

可以使用[Sandcastle](http://blogs.msdn.com/sandcastle/) [（下载）](http://www.microsoft.com/downloads/details.aspx?familyid=E82EA71D-DA89-42EE-A715-696E3A4873B2&displaylang=en)生成帮助文件。此外，[Sandcastle 帮助文件生成器](http://www.codeplex.com/SHFB)是一个 GUI，可以让您更轻松地开始使用 Sandcastle。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-06-11T20:23:20.833

我正在利用 NuDoc 生成 Markdown 格式的静态 API 站点。API 干净、现代且非常轻量且易于使用（如果我自己可以这么说的话；））：http: [//kzu.to/nudoc](http://kzu.to/nudoc)

它也是开源的，所以总是欢迎修复和改进。

# c# - 为什么我的 Theme.Master 找不到它的 Site.css？

> ID：757847
> 
> 赞同：0
> 
> 时间：2009-04-16T20:08:31.657
> 
> 标签：c#, css, model-view-controller, master

```
<link href="Site.css" rel="stylesheet" type="text/css" /> 
```

这在我的本地机器上的 Theme.Master (Views/Themes/Blue/Theme.Master) 上运行良好，但在其最终主页的托管提供商上运行良好。如果 css 在 Content 文件夹中，在 Content 文件夹的任何子文件夹中，则 Theme.Master 可以找到 css，但如果 css 与 Theme.Master 在同一文件夹中，则不能。

我说得有道理吗？

非常沮丧

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T21:45:46.243

您对尼克回答的评论意味着您试图将 .css 文件放在与 ~/Views/ 文件夹树下的 Theme.Master 文件相同的文件夹中。你不能这样做。~/Views/ 树被配置为阻止来自 Web 浏览器的所有 HTTP 请求。

您需要将 .css 文件放在可访问的位置。~/Content/ 文件夹树是放置 .css 文件的传统位置。如果您将 .css 文件移到那里，然后按照 Nick 的建议使用它，它将起作用：

```
<link href="<%= Url.Content("~/Content/Site.css") %>" rel="stylesheet" type="text/css" /> 
```

作为记录，由于 web.config 文件中的这些指令，它在 Views 文件夹中不起作用（注意，在 Views 文件夹中直接有一个 web.config 文件）。这只是仅供参考。我不建议您尝试弄乱这些，因为它们通常是有充分理由的：

```
<!-- for IIS6 -->
<httpHandlers>
  <add path="*" verb="*"
      type="System.Web.HttpNotFoundHandler"/>
</httpHandlers>

<!-- for IIS7 -->
<handlers>
  <remove name="BlockViewHandler"/>
  <add name="BlockViewHandler" path="*" verb="*" preCondition="integratedMode" type="System.Web.HttpNotFoundHandler"/>
</handlers> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T20:12:23.753

您必须使用相对文件引用。尝试这个：

```
<link href="<%= Url.Content("~/Content/Site.css") %>" rel="stylesheet" type="text/css" /> 
```

...这应该可以解决问题。

**编辑** 由于您评论说这不起作用，我查找了从哪里找到我的解决方案。我在[这篇](http://lancefisher.net/blog/archive/2008/03/16/referencing-javascript-in-asp.net-mvc-master-pages.aspx)博文中从 Lance Fisher 那里得到了它。如果不能解决（因为它是在谈论 java 脚本文件），您也可以[在这里查看](https://stackoverflow.com/questions/612584/asp-net-mvc-returns-wrong-path-for-url-content/612741#612741)之前回答的类似问题。希望有帮助！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T20:12:57.840

您是否尝试过使用根路径？如：

```
<link href="/Site.css" rel="stylesheet" type="text/css" /> 
```

或者

```
<link href="/style/Site.css" rel="stylesheet" type="text/css" /> 
```

如果您的样式表不在您网站的根目录上。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T20:13:32.720

在托管提供商上，该应用程序是否位于站点根目录中？或在子文件夹中？在这方面，您的开发环境是否与服务器上的设置相匹配？您可能需要确保您的工作相对于应用程序根目录，~/

从根本上说，这类似于[此处讨论](https://stackoverflow.com/questions/347528/using-scripts-in-a-master-page-with-asp-net-mvc)的相同问题（使用脚本） 。

# .net - 如何将 RUNAS /NETONLY 功能构建到（C#/.NET/WinForms）程序中？

> ID：757857
> 
> 赞同：26
> 
> 时间：2009-04-16T20:11:30.213
> 
> 标签：.net, sql-server, security, authentication, runas

我们的工作站不是我们 SQL Server 所在域的成员。（他们实际上根本不在域上 - 不要问）。

当我们使用 SSMS 或任何东西连接到 SQL Server 时，我们使用 RUNAS /NETONLY 和 DOMAIN\user。然后我们输入密码并启动程序。（RUNAS /NETONLY 不允许您在批处理文件中包含密码）。

所以我有一个需要 SQL 连接的 .NET WinForms 应用程序，用户必须通过运行具有 RUNAS /NETONLY 命令行的批处理文件来启动它，然后它会启动 EXE。

如果用户不小心直接启动了 EXE，它就无法连接到 SQL Server。

右键单击应用程序并使用“运行方式...”选项不起作用（可能是因为工作站并不真正了解域）。

我正在寻找一种方法让应用程序在开始任何重要的事情之前在内部执行 RUNAS /NETONLY 功能。

有关 RUNAS /NETONLY 如何工作的说明，请参阅此链接：[http ://www.eggheadcafe.com/conversation.aspx?messageid=32443204&threadid=32442982](http://www.eggheadcafe.com/conversation.aspx?messageid=32443204&threadid=32442982)

我想我将不得不`LOGON_NETCREDENTIALS_ONLY`使用`CreateProcessWithLogonW`

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2012-07-26T15:04:02.387

我知道这是一个旧线程，但它非常有用。我的情况与 Cade Roux 完全相同，因为我想要 /netonly 风格的功能。

**约翰·拉施 (John Rasch) 的答案只需稍作修改即可！！！**

添加以下常量（为了保持一致性，在第 102 行附近）：

```
private const int LOGON32_LOGON_NEW_CREDENTIALS = 9; 
```

然后将调用更改`LogonUser`为 use`LOGON32_LOGON_NEW_CREDENTIALS`而不是`LOGON32_LOGON_INTERACTIVE`.

这是我必须做的*唯一*改变才能让它完美地工作！！！谢谢约翰和凯德！！！

这是完整的修改后的代码，以便于复制/粘贴：

```
namespace Tools
{
    #region Using directives.
    // ----------------------------------------------------------------------

    using System;
    using System.Security.Principal;
    using System.Runtime.InteropServices;
    using System.ComponentModel;

    // ----------------------------------------------------------------------
    #endregion

    /////////////////////////////////////////////////////////////////////////

    /// <summary>
    /// Impersonation of a user. Allows to execute code under another
    /// user context.
    /// Please note that the account that instantiates the Impersonator class
    /// needs to have the 'Act as part of operating system' privilege set.
    /// </summary>
    /// <remarks>   
    /// This class is based on the information in the Microsoft knowledge base
    /// article http://support.microsoft.com/default.aspx?scid=kb;en-us;Q306158
    /// 
    /// Encapsulate an instance into a using-directive like e.g.:
    /// 
    ///     ...
    ///     using ( new Impersonator( "myUsername", "myDomainname", "myPassword" ) )
    ///     {
    ///         ...
    ///         [code that executes under the new context]
    ///         ...
    ///     }
    ///     ...
    /// 
    /// Please contact the author Uwe Keim (mailto:uwe.keim@zeta-software.de)
    /// for questions regarding this class.
    /// </remarks>
    public class Impersonator :
        IDisposable
    {
        #region Public methods.
        // ------------------------------------------------------------------

        /// <summary>
        /// Constructor. Starts the impersonation with the given credentials.
        /// Please note that the account that instantiates the Impersonator class
        /// needs to have the 'Act as part of operating system' privilege set.
        /// </summary>
        /// <param name="userName">The name of the user to act as.</param>
        /// <param name="domainName">The domain name of the user to act as.</param>
        /// <param name="password">The password of the user to act as.</param>
        public Impersonator(
            string userName,
            string domainName,
            string password)
        {
            ImpersonateValidUser(userName, domainName, password);
        }

        // ------------------------------------------------------------------
        #endregion

        #region IDisposable member.
        // ------------------------------------------------------------------

        public void Dispose()
        {
            UndoImpersonation();
        }

        // ------------------------------------------------------------------
        #endregion

        #region P/Invoke.
        // ------------------------------------------------------------------

        [DllImport("advapi32.dll", SetLastError = true)]
        private static extern int LogonUser(
            string lpszUserName,
            string lpszDomain,
            string lpszPassword,
            int dwLogonType,
            int dwLogonProvider,
            ref IntPtr phToken);

        [DllImport("advapi32.dll", CharSet = CharSet.Auto, SetLastError = true)]
        private static extern int DuplicateToken(
            IntPtr hToken,
            int impersonationLevel,
            ref IntPtr hNewToken);

        [DllImport("advapi32.dll", CharSet = CharSet.Auto, SetLastError = true)]
        private static extern bool RevertToSelf();

        [DllImport("kernel32.dll", CharSet = CharSet.Auto)]
        private static extern bool CloseHandle(
            IntPtr handle);

        private const int LOGON32_LOGON_INTERACTIVE = 2;
        private const int LOGON32_LOGON_NEW_CREDENTIALS = 9;
        private const int LOGON32_PROVIDER_DEFAULT = 0;

        // ------------------------------------------------------------------
        #endregion

        #region Private member.
        // ------------------------------------------------------------------

        /// <summary>
        /// Does the actual impersonation.
        /// </summary>
        /// <param name="userName">The name of the user to act as.</param>
        /// <param name="domainName">The domain name of the user to act as.</param>
        /// <param name="password">The password of the user to act as.</param>
        private void ImpersonateValidUser(
            string userName,
            string domain,
            string password)
        {
            WindowsIdentity tempWindowsIdentity = null;
            IntPtr token = IntPtr.Zero;
            IntPtr tokenDuplicate = IntPtr.Zero;

            try
            {
                if (RevertToSelf())
                {
                    if (LogonUser(
                        userName,
                        domain,
                        password,
                        LOGON32_LOGON_NEW_CREDENTIALS,
                        LOGON32_PROVIDER_DEFAULT,
                        ref token) != 0)
                    {
                        if (DuplicateToken(token, 2, ref tokenDuplicate) != 0)
                        {
                            tempWindowsIdentity = new WindowsIdentity(tokenDuplicate);
                            impersonationContext = tempWindowsIdentity.Impersonate();
                        }
                        else
                        {
                            throw new Win32Exception(Marshal.GetLastWin32Error());
                        }
                    }
                    else
                    {
                        throw new Win32Exception(Marshal.GetLastWin32Error());
                    }
                }
                else
                {
                    throw new Win32Exception(Marshal.GetLastWin32Error());
                }
            }
            finally
            {
                if (token != IntPtr.Zero)
                {
                    CloseHandle(token);
                }
                if (tokenDuplicate != IntPtr.Zero)
                {
                    CloseHandle(tokenDuplicate);
                }
            }
        }

        /// <summary>
        /// Reverts the impersonation.
        /// </summary>
        private void UndoImpersonation()
        {
            if (impersonationContext != null)
            {
                impersonationContext.Undo();
            }
        }

        private WindowsImpersonationContext impersonationContext = null;

        // ------------------------------------------------------------------
        #endregion
    }

    /////////////////////////////////////////////////////////////////////////
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-16T20:17:14.613

我只是使用`ImpersonationContext`. 它使用起来非常直观，对我来说效果很好。

要以不同的用户身份运行，语法是：

```
using ( new Impersonator( "myUsername", "myDomainname", "myPassword" ) )
{
    // code that executes under the new context...
} 
```

这是课程：

```
namespace Tools
{
    #region Using directives.
    // ----------------------------------------------------------------------

    using System;
    using System.Security.Principal;
    using System.Runtime.InteropServices;
    using System.ComponentModel;

    // ----------------------------------------------------------------------
    #endregion

    /////////////////////////////////////////////////////////////////////////

    /// <summary>
    /// Impersonation of a user. Allows to execute code under another
    /// user context.
    /// Please note that the account that instantiates the Impersonator class
    /// needs to have the 'Act as part of operating system' privilege set.
    /// </summary>
    /// <remarks>   
    /// This class is based on the information in the Microsoft knowledge base
    /// article http://support.microsoft.com/default.aspx?scid=kb;en-us;Q306158
    /// 
    /// Encapsulate an instance into a using-directive like e.g.:
    /// 
    ///     ...
    ///     using ( new Impersonator( "myUsername", "myDomainname", "myPassword" ) )
    ///     {
    ///         ...
    ///         [code that executes under the new context]
    ///         ...
    ///     }
    ///     ...
    /// 
    /// Please contact the author Uwe Keim (mailto:uwe.keim@zeta-software.de)
    /// for questions regarding this class.
    /// </remarks>
    public class Impersonator :
        IDisposable
    {
        #region Public methods.
        // ------------------------------------------------------------------

        /// <summary>
        /// Constructor. Starts the impersonation with the given credentials.
        /// Please note that the account that instantiates the Impersonator class
        /// needs to have the 'Act as part of operating system' privilege set.
        /// </summary>
        /// <param name="userName">The name of the user to act as.</param>
        /// <param name="domainName">The domain name of the user to act as.</param>
        /// <param name="password">The password of the user to act as.</param>
        public Impersonator(
            string userName,
            string domainName,
            string password)
        {
            ImpersonateValidUser(userName, domainName, password);
        }

        // ------------------------------------------------------------------
        #endregion

        #region IDisposable member.
        // ------------------------------------------------------------------

        public void Dispose()
        {
            UndoImpersonation();
        }

        // ------------------------------------------------------------------
        #endregion

        #region P/Invoke.
        // ------------------------------------------------------------------

        [DllImport("advapi32.dll", SetLastError = true)]
        private static extern int LogonUser(
            string lpszUserName,
            string lpszDomain,
            string lpszPassword,
            int dwLogonType,
            int dwLogonProvider,
            ref IntPtr phToken);

        [DllImport("advapi32.dll", CharSet = CharSet.Auto, SetLastError = true)]
        private static extern int DuplicateToken(
            IntPtr hToken,
            int impersonationLevel,
            ref IntPtr hNewToken);

        [DllImport("advapi32.dll", CharSet = CharSet.Auto, SetLastError = true)]
        private static extern bool RevertToSelf();

        [DllImport("kernel32.dll", CharSet = CharSet.Auto)]
        private static extern bool CloseHandle(
            IntPtr handle);

        private const int LOGON32_LOGON_INTERACTIVE = 2;
        private const int LOGON32_PROVIDER_DEFAULT = 0;

        // ------------------------------------------------------------------
        #endregion

        #region Private member.
        // ------------------------------------------------------------------

        /// <summary>
        /// Does the actual impersonation.
        /// </summary>
        /// <param name="userName">The name of the user to act as.</param>
        /// <param name="domainName">The domain name of the user to act as.</param>
        /// <param name="password">The password of the user to act as.</param>
        private void ImpersonateValidUser(
            string userName,
            string domain,
            string password)
        {
            WindowsIdentity tempWindowsIdentity = null;
            IntPtr token = IntPtr.Zero;
            IntPtr tokenDuplicate = IntPtr.Zero;

            try
            {
                if (RevertToSelf())
                {
                    if (LogonUser(
                        userName,
                        domain,
                        password,
                        LOGON32_LOGON_INTERACTIVE,
                        LOGON32_PROVIDER_DEFAULT,
                        ref token) != 0)
                    {
                        if (DuplicateToken(token, 2, ref tokenDuplicate) != 0)
                        {
                            tempWindowsIdentity = new WindowsIdentity(tokenDuplicate);
                            impersonationContext = tempWindowsIdentity.Impersonate();
                        }
                        else
                        {
                            throw new Win32Exception(Marshal.GetLastWin32Error());
                        }
                    }
                    else
                    {
                        throw new Win32Exception(Marshal.GetLastWin32Error());
                    }
                }
                else
                {
                    throw new Win32Exception(Marshal.GetLastWin32Error());
                }
            }
            finally
            {
                if (token != IntPtr.Zero)
                {
                    CloseHandle(token);
                }
                if (tokenDuplicate != IntPtr.Zero)
                {
                    CloseHandle(tokenDuplicate);
                }
            }
        }

        /// <summary>
        /// Reverts the impersonation.
        /// </summary>
        private void UndoImpersonation()
        {
            if (impersonationContext != null)
            {
                impersonationContext.Undo();
            }
        }

        private WindowsImpersonationContext impersonationContext = null;

        // ------------------------------------------------------------------
        #endregion
    }

    /////////////////////////////////////////////////////////////////////////
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-17T02:50:40.190

我收集了这些有用的链接：

[http://www.developmentnow.com/g/36_2006_3_0_0_725350/Need-help-with-impersonation-please-.htm](http://www.developmentnow.com/g/36_2006_3_0_0_725350/Need-help-with-impersonation-please-.htm)

[http://blrchen.spaces.live.com/blog/cns!572204F8C4F8A77A!251.entry](http://blrchen.spaces.live.com/blog/cns!572204F8C4F8A77A!251.entry)

[http://geekswithblogs.net/khanna/archive/2005/02/09/22430.aspx](http://geekswithblogs.net/khanna/archive/2005/02/09/22430.aspx)

[http://msmvps.com/blogs/martinzugec/archive/2008/06/03/use-runas-from-non-domain-computer.aspx](http://msmvps.com/blogs/martinzugec/archive/2008/06/03/use-runas-from-non-domain-computer.aspx)

事实证明我将不得不使用`LOGON_NETCREDENTIALS_ONLY`with `CreateProcessWithLogonW`。我将看看我是否可以让程序检测它是否以这种方式启动，如果没有，则收集域凭据并自行启动。这样，只有一个自我管理的 EXE。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-16T21:08:08.377

此代码是 RunAs 类的一部分，我们使用该类启动具有提升权限的外部进程。为用户名和密码传递 null 将提示标准 UAC 警告。传递用户名和密码的值时，您实际上可以在没有 UAC 提示的情况下启动提升的应用程序。

```
public static Process Elevated( string process, string args, string username, string password, string workingDirectory )
{
    if( process == null || process.Length == 0 ) throw new ArgumentNullException( "process" );

    process = Path.GetFullPath( process );
    string domain = null;
    if( username != null )
        username = GetUsername( username, out domain );
    ProcessStartInfo info = new ProcessStartInfo();
    info.UseShellExecute = false;
    info.Arguments = args;
    info.WorkingDirectory = workingDirectory ?? Path.GetDirectoryName( process );
    info.FileName = process;
    info.Verb = "runas";
    info.UserName = username;
    info.Domain = domain;
    info.LoadUserProfile = true;
    if( password != null )
    {
        SecureString ss = new SecureString();
        foreach( char c in password )
            ss.AppendChar( c );
        info.Password = ss;
    }

    return Process.Start( info );
}

private static string GetUsername( string username, out string domain ) 
{
    SplitUserName( username, out username, out domain );

    if( domain == null && username.IndexOf( '@' ) < 0 )
        domain = Environment.GetEnvironmentVariable( "USERDOMAIN" );
    return username;
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2019-11-12T04:35:17.487

使用此处非常有用的答案，我创建了以下简化类，该类使用 .NET Standard 中也可用的 API：

```
public class Impersonator
{
    [DllImport("ADVAPI32.DLL", SetLastError = true, CharSet = CharSet.Unicode)]
    private static extern bool LogonUser(
        string lpszUsername,
        string lpszDomain,
        string lpszPassword,
        int dwLogonType,
        int dwLogonProvider,
        out SafeAccessTokenHandle phToken);

    public void RunAs(string domain, string username, string password, Action action)
    {
        using (var accessToken = GetUserAccessToken(domain, username, password))
        {
            WindowsIdentity.RunImpersonated(accessToken, action);
        }
    }

    private SafeAccessTokenHandle GetUserAccessToken(string domain, string username, string password)
    {
        const int LOGON32_PROVIDER_DEFAULT = 0;
        const int LOGON32_LOGON_NETONLY = 9;

        bool isLogonSuccessful = LogonUser(username, domain, password, LOGON32_LOGON_NETONLY, LOGON32_PROVIDER_DEFAULT, out var safeAccessTokenHandle);
        if (!isLogonSuccessful)
        {
            throw new Win32Exception(Marshal.GetLastWin32Error());
        }

        return safeAccessTokenHandle;
    }
} 
```

以下是你如何使用它：

```
_impersonator.RunAs(
    "DOMAIN",
    "Username",
    "Password",
    () =>
    {
        Console.WriteLine("code executed here runs as the specified user with /netonly");
    }); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T20:14:30.080

我想你不能只是将应用程序的用户添加到 sql server 然后使用 sql 身份验证而不是 windows 身份验证？

# css - 智能手机的字体和字体大小单位

> ID：757862
> 
> 赞同：2
> 
> 时间：2009-04-16T20:12:59.523
> 
> 标签：css, fonts, smartphone

为智能手机开发网站推荐使用哪种字体和哪种字体大小单位？智能手机是指具有良好网络浏览器的设备。

我不确定使用 px、em 或 %

感谢您的建议和提示。

问候鲍勃

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T20:16:17.643

我会使用 CSS `medium`, `large`, `small`, `x-large`, 等等...因为浏览器会知道用户的偏好并且不会被限制在一个固定的大小。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T22:01:33.757

如果您主要显示大量文本供用户阅读，请按照 Ben S 所写的那样做。浏览器将预设适合中/大/小/等的合适尺寸，或者用户将有自己的偏好。仅在有充分理由的情况下覆盖用户的偏好。

覆盖用户的一般浏览器首选项的一个很好的理由是，如果您正在创建 Web 应用程序的界面。在这种情况下，请使用功能最大的字体大小。你有办法询问你的用户吗？要么使用服务器日志并针对最流行的设备进行调整（您可能可以为每个设备发送不同的样式表），或者寻求反馈。

查看 CSS 规范，pt 单元看起来很有前途，只要确保您的目标浏览器正确使用它。换句话说，在目标设备本身上对其进行测试。

# c# - GridView 不报异常

> ID：757868
> 
> 赞同：0
> 
> 时间：2009-04-16T20:13:40.833
> 
> 标签：c#, asp.net, sql-server, gridview, ado.net

如果我将 GridView 绑定到 SqlDataSource 并将 AutoGenerateEditButton 设置为 true，然后我尝试更新一个字段（该字段是数据库中的主键），那么数据库应该返回一个错误，因此应该抛出 SqlException？！

那么为什么page不报告异常呢？相反，Gridview 所做的只是将该行中的所有字段设置回其原始值。

当我使用以下代码执行相同的更新语句时，我得到了*Cannot update identity column 'EmployeeID' exception*，所以我假设 Sql Server 在 GridView 尝试更新时确实报告了相同的错误，但由于某种原因没有引发异常：

```
 SqlConnection sc = new SqlConnection();
        sc.ConnectionString = @"Data source=localhost; integrated security=sspi; initial catalog=northwind;";
        SqlCommand sComand = new SqlCommand();

        sComand.Connection = sc;
        sComand.CommandText = "update Employees set EmployeeId=100,FirstName='Suzy',"+ 
                   "LastName='Smile',City='Moon' where EmployeeId=1";
        sc.Open();
        int I = sComand.ExecuteNonQuery(); 
```

顺便说一句 - 我尝试设置 DataKeyNames="EmployeeId"，但仍然没有引发异常

谢谢

编辑：
你好，

很抱歉没有尽快回复，但我没有注意到我收到了回复。

无论如何，由于某种原因它现在正在工作，这意味着 GridView 确实报告了一个异常。因此，我的代码一定犯了一些错误，但由于不断重写我的代码，我不知道错误会在哪里。很抱歉浪费您的时间，感谢您帮助我

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T20:22:52.527

查看错误和您的代码。这似乎是 SQL 数据库错误，而不是 GridView 的问题。

SQL 不允许更新 IDENTITY 列，因为它们是由数据库引擎生成的。在这种情况下，“EmployeeId”就是这样一个字段。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-11T16:12:18.913

我遇到了同样的问题：我在对象数据源的选择处理程序中捕获了异常，但忘记将异常设置为已处理：e.ExceptionHandled = true。页面呈现的页面上没有我的错误消息，就像没有发生错误一样。使用 e.ExceptionHandled = true，一切都很好。

# latex - Latex 文档中的奇怪 Bibtex 行为

> ID：757880
> 
> 赞同：5
> 
> 时间：2009-04-16T20:17:17.470
> 
> 标签：latex, bibtex

我在工作的 Latex 文档中添加了一行“\cite{test}”作为测试。当我编译 bibtex “！bibtex name_of_my_file 时，我得到了预期的错误：

> 警告——我没有找到“测试”的数据库条目

然后，我删除了该行并再次编译了 bibtex，希望再次有一个工作的 Latex 文件。但是，即使使用新的外壳，也会发生相同的错误。我无法理解这种行为。逻辑是什么？我怎样才能让我的 Latex 文档再次工作？

**[更新信息]** 问题一出现就出人意料地消失了。我不知道为什么，但它现在有效。你知道奇怪行为的原因吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-16T20:27:30.470

我认为您正在绊倒 LaTex 和 Bibtex 的多通道性质。如果您查看[此讨论中的第 3 步](http://www.math.uiuc.edu/~hildebr/tex/bibliographies.html)，您将看到以下内容：

> 第一次运行（通过 latex）生成一个辅助文件 paper.aux，其中包含有关引文（和其他类型的参考）、使用的参考书目样式和 bibtex 数据库名称的信息。第二次运行（通过 bibtex）使用辅助文件中的信息以及 bibtex 数据库中包含的数据来创建文件 paper.bbl。该文件包含一个参考书目环境，其中 \bibitem 条目根据指定的参考书目样式格式化。

所以，我认为正在发生的是你的`name_of_my_file.aux`文件仍然包含你的 placeholder `\cite{test}`。如果您删除辅助文件，您应该能够重新开始：

```
latex name_of_my_file
bibtex name_of_my_file
latex name_of_my_file
latex name_of_my_file 
```

**[根据附加信息更新]**：问题是您的`.aux`文件`\cite{}`仍然嵌入。第二次运行时`latex`，您用新文件覆盖了旧文件。这就是为什么整套步骤包括一个初始`latex`呼叫、一个`bibtex`呼叫和两个后续`latex`呼叫。把它想象成一个多遍编译器，它可能更直观。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T21:57:20.130

您可以查看[latexmk](http://www.ctan.org/tex-archive/support/latexmk/)，它将为您处理修复点编译。

无论如何，即使您缺少参考书目项目，您也应该能够构建文档 (pdflatex blah.tex)。相应的参考文献将在 PDF 中显示为问号。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T20:26:20.973

重新运行 latex 以重新生成 aux 文件。

查看[此讨论](http://markmail.org/message/5ier3yfpsxqsmsa6)以获取更多信息。基本上，您可能已将引用从 .tex 文件中取出，但它仍然存在于派生文件之一中（aux、bbl 等...）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-07-23T19:33:08.753

检查您的围兜文件是否具有扩展名 .bib 而不是 .tex。如果是 .tex，只需将其更改为 .bib 即可。一旦我不小心将它更改为 tex，通过添加一些引用，并使用“另存为”选项保存它，而不指定 bib 扩展名。这就是它突然发生的方式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-01-31T17:05:35.777

删除所有 .aux 和临时文件，使用乳胶重新运行，然后使用 bibtex，然后使用乳胶两次。

# apache-flex - 用于嵌入 flashplayer 的 swfobject 的替代方案

> ID：757883
> 
> 赞同：3
> 
> 时间：2009-04-16T20:18:07.203
> 
> 标签：apache-flex, embed, flash, swfobject

有谁知道是否有更好的替代 swfobject？我其实很喜欢 swfobject，我只是想听听是否有人发现了更好的东西。或者也许这是最好的方法。

如果你不知道 swfobject，你可以在这里找到它：

[http://code.google.com/p/swfobject/](http://code.google.com/p/swfobject/)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-17T14:15:34.320

这是我所知道的最好的方法，而且我从来没有遇到过问题。请注意，您不能将 JS 放入嵌入代码中以在 Facebook 等社交网站上发布。在这些情况下，您将需要使用通常的对象和嵌入标签。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-17T17:21:11.097

你可以试试 ActiveContent，它是 Adob​​e 的嵌入 flash 的解决方案。这是 flex builder 和（我相信）CS4 的默认设置。

你可以在 flex builder 目录中找到它的源代码；

```
 $FLEX_BUILDER_LOCATION\sdks\3.3.0\templates\client-side-detection 
```

通常，人们更喜欢 swfobject，因为它很简单。但 activecontent 是经过现场测试的解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-17T05:50:15.017

SWFObject 有许多替代品，包括一些流行的 JS 框架附带的 SWF 嵌入代码，但没有一个像 SWFObject 那样防弹。

Adobe 正在为其大部分出版产品采用 SWFObject 2.x（SWFObject 将取代 Adob​​e 基于 JavaScript 的 ActiveContent 解决方案）。

顺便说一句，如果您使用 SWFObject 的*静态发布*方法，您的 SWF**将**在*没有*启用 JavaScript 的情况下工作。它根本无法访问 Adob​​e 的 ExpressInstall 实用程序。请参阅[http://code.google.com/p/swfobject/wiki/documentation#Should_I_use_the_static_or_dynamic_publishing_method](http://code.google.com/p/swfobject/wiki/documentation#Should_I_use_the_static_or_dynamic_publishing_method)？

如果您使用 Google 的 Ajax API 存储库，您甚至不需要下载 SWFObject :)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-04T20:03:41.727

**[SWF 对象 2](http://code.google.com/p/swfobject/)。**让尽可能多的人看到您的 Flash 电影的最佳方式。（除了那些关闭了 JavaScript 的！）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-07-10T02:51:35.137

swfobject 有一个很好的“包装器”，称为“EasySWF”。**他们正在使用 swfobject**，但只是让它更容易理解/实现。

从他们的文档中添加 SWF 非常简单：

```
easyswf({swf: "path/to/the.swf", width:400, height:100}); 
```

这是地址：

[http://www.gieson.com/Library/projects/utilities/easyswf/](http://www.gieson.com/Library/projects/utilities/easyswf/)

看起来他们也在整个网站上使用它？

# silverlight - 为什么 Silverlight 声音不能在某些计算机上播放？

> ID：757888
> 
> 赞同：1
> 
> 时间：2009-04-16T20:18:53.910
> 
> 标签：silverlight, audio

我的 Silverlight 应用程序成功地在我自己的多台计算机上每十秒播放一次重复的警报声。我的一位客户没有听到任何声音。我刚刚和他通了电话，并证实他可以听到基本的 Windows 声音、来自另一个应用程序的声音，以及来自 IE 中另一个网页（但不是 Silverlight）的声音。

有谁知道任何可能影响 Silverlight 在系统上播放声音的能力的设置，否则听起来（哈，哈）很好？

谢谢，本

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T20:23:22.040

也许他的 DirectX（或更具体地说是 DirectSound）安装有问题。

# ruby-on-rails - 如何在 Ruby on Rails 中创建一个锚点并重定向到这个特定的锚点

> ID：757891
> 
> 赞同：37
> 
> 时间：2009-04-16T20:19:43.830
> 
> 标签：ruby-on-rails, ruby, hyperlink, anchor, page-jump

我正在尝试为我博客上的每条评论创建唯一的锚点，以便人们可以获取锚点的 url 并将其粘贴到他们的浏览器中，这将自动加载页面并向下滚动到页面中他们评论开始的位置.

也许我正在以错误的方式解决这个问题，但我已经尝试过，但无济于事。

评论视图 - 失败 1 - 当粘贴在浏览器中时，此链接不会向下滚动到所需位置

```
<%= link_to '#', :controller => 'posts', :action => 'show', :id => comment.post, :anchor => 'comment_' << comment.id.to_s %> 
```

评论控制器 - 失败 2 - 浏览器中正确的 url 但没有滚动发生它只是停留在页面的顶部

```
redirect_to :controller => 'posts', :action => 'show', :id => @post, :anchor => 'comment_' + @comment.id.to_s 
```

如果有人可以提供帮助，我将不胜感激:)

更新：下面的解决方案几乎可以工作，但是如果我点击它，我会得到以下 URL，它不会被滚动到。

# 即[http://localhost:3000/posts/please-work](http://localhost:3000/posts/please-work)

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2009-04-17T11:08:30.963

实际上，anchor 是路径的一个选项，而不是 link_to

```
<%= link_to '#', post_path(comment.post, :anchor => "comment_#{comment.id}") %> 
```

[http://api.rubyonrails.org/classes/ActionView/Helpers/UrlHelper.html#M001565](http://api.rubyonrails.org/classes/ActionView/Helpers/UrlHelper.html#M001565)

```
link_to "Comment wall", profile_path(@profile, :anchor => "wall")
       # => <a href="/profiles/1#wall">Comment wall</a> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-16T20:35:15.210

看起来您想使用`link_to`问题中的代码。然后在您的评论列表中，您必须确保在链接中有一个名称相同的锚标记。

所以这：

```
 <%= link_to 'Your comment', post_path(@comment.post) + "#comment_#{@comment.id.to_s}" %> 
```

会产生这样的东西

```
 <a href="localhost:3000/posts/2#1comment_234">Your comment</a>

 /* html code */     

 <a name="comment_1234">This is a comment</a> 
```

您必须手动添加，`#comment_`否则 link_to 方法认为您传递的 :anchor 属性是针对该标签的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-06-05T17:17:29.507

这是对@XGamerX 答案的改进。

```
<%= link_to '#', [comment.post, { anchor: dom_id(comment) }] %> 
```

或者

```
<%= link_to '#', post_path(comment.post, anchor: dom_id(comment)) %> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T20:34:28.940

试试这个：

```
<%= link_to '#', post_path(comment.post), :anchor => "comment_#{comment.id}" %> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-02-20T21:15:02.613

这是最好的方法：

```
<%= link_to '#', post_path(comment.post, anchor: dom_id(comment.id)) %> 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-04-16T20:41:17.507

这些链接将向下滚动到您有如下代码的位置：

```
<a name="comment_1"></a> 
```

不知道有没有帮手会帮你做，但是很简单，你可以自己写。

# java - QuickTime for Java 与 iTunes DRM

> ID：757895
> 
> 赞同：1
> 
> 时间：2009-04-16T20:21:52.263
> 
> 标签：java, itunes, quicktime, drm

Apple QuickTime 独立播放器可以很好地管理 iTunes 的 DRM 方案，可以毫无问题地播放从 iTunes 下载的电影。有什么方法可以让 QuickTime for Java 以同样好的方式处理 iTunes DRM，或者这只是超出了软件的能力范围？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T19:32:26.547

我从来没有找到一个明确的答案，但以防万一有类似问题的人在这里找到他们的方式：进一步的研究表明答案是一个响亮的**地狱**不。但是独立的 QuickTime 播放器具有非常丰富的 COM 接口；文档很臭，但是如果您在 COM 对象浏览器下打开它（就像 VB 2008 的免费版本附带的那个），您可以很容易地弄清楚它。

# c# - 命名约定和命名空间

> ID：757897
> 
> 赞同：4
> 
> 时间：2009-04-16T20:22:10.017
> 
> 标签：c#, naming-conventions

如果我在一层上有与另一层上的对象同名的对象，最好用一些前缀更改对象名称或使用新的命名空间并使用完全限定的名称来引用它们？例如：

```
namespace Project1.Data
Object Person;

namespace Project1.Model
Object Person; 
```

* * *

```
Data.Person.Name=Person.Name;

OR

dbPerson.Name= Person.Name; 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-16T20:27:21.937

我会使用命名空间和命名空间别名，例如：

在适当的命名空间中定义你的类：

```
namespace Project1.Data
{
    public class Person {...}
}
namespace Project1.Model
{
    public class Person {...}
} 
```

在你使用类的地方，要么使用完全限定的名称，要么为命名空间定义一个别名（如果完整的命名空间很长，则特别有用）：

```
using data = Project1.Data;
using model = Project1.Model;

data.Person p1 = new data.Person();
model.Person p2 = new model.Person();
//...
p1.Name = p2.Name; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T20:29:30.577

这取决于您引用重载名称的频率。

如果您在一个文件中多次使用它，则使用第一种方式。

如果您只使用一次或两次，请写出完全限定的名称，这样其他人就不必在您的文件顶部四处寻找您所指的对象。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T20:49:36.940

这实际上取决于您请求每个人的频率。一般来说，我对我最常提到的类型使用缩短的版本，对不常用的类型使用较长的名称。我最终会说，如果你最终在同一个文件中有很多用法，那么你应该使用命名空间别名，但对我来说，这是最后的手段，只有在代码膨胀到难以处理的地步之后关注正在发生的事情。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T23:44:34.117

我自己也有同样的想法。我认为更改课程的名称是一个坏主意。例如，我有一个数据访问层和一个业务层。两者都与用户打交道。所以我有...

Project1.Business.User Project1.DataAccess.User

试图为类想出有创意的新名称是浪费时间，并且可能意味着对于没有什么意义的类的奇怪名称。命名类已经够让人头疼的了。

我同意 McWafflestix 的观点，“我对我最常提及的类型使用缩短的版本，而对不太常用的类型使用较长的名称”。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-17T00:10:33.197

这很简单。听一遍 .NET 框架指南实际上会有所帮助（尽管书中的大量材料只是简单的 Java 风格元素，但在 Redmond Wonderland 中再次出现）。

您应该避免在交叉或项目内/库混合命名空间中使用类似的类型名称，即。一般跨域和模型混合（即使在非常严格和强大的 C++ 中，它也具有编译器、解析和枚举式编译器崩溃和问题的化身）。

因此，即使一直完全符合条件也不是万无一失的（顺便说一句，别名和“使用”非常有限，充其量只会导致轻微的重复，并证明 C# 在泛型编程等方面的弱点）。

根据我的经验，数据域类型是更合适名称的主要目标，因此对于名称重构来说，它是：

a) 便宜（作为丰富的 AST 中的一个过程，但像在 C# 中一样简单的 adt-s 支持，在 IDE 中右键单击并根据类型挑战的动态 Ruby 粉丝/支持者感觉强大）

[也可以理解为：4.0 动态特性羊会责怪所有人，但不要考虑命名空间或函数式 JS、C-with 模板（不是 C-with-classes）或类似的 ]

b）更好地传达语义，即。意图（即管道+支持建立您自己的处理）

c）通常具有原始但类型化的性质或消息（类型化而不是 OO；即上述书中的 OO 风格批评，它本身直接脱离介绍，将所有“模型”提升到参考土地）

d) 并且“别名”成为跨域使用中的有用工件（这实际上是可能的，并且非常类似于 2020 年......即值类型编程）

确实没有规则，但请注意，您会在最意想不到的时候看到开发中的命名空间混合......这对于有管理意识的开发人员来说只意味着一件事：混乱。加上稍微不那么严重，更多的编译时间和 IntelliNonsense 错误当然..

所有语言的棘手问题，所以这是您的设计/命名问题。即使是工具供应商也可能搞砸机器来解析。说基于过时的浏览信息的增强流行 IDE 的输出；再说一次，其他人在托管语言方面做得很好。

并不是说我反对重复名称，当混合双重 + 互操作 + 表示等其他模型时，有些情况（它们很难但必要）相同的名称使其更具可读性；IE。其中重复是双重使用的必要条件..但这是 C# 不友好或不鼓励的较低级别的习语（回复：支持开销）。

# asp.net - 什么设置 Page.User.Identity.Name

> ID：757900
> 
> 赞同：2
> 
> 时间：2009-04-16T20:22:25.913
> 
> 标签：asp.net, forms-authentication

我跟踪当前登录的用户 ID，并将我的网站的行为基于此值。我的代码使用以下语句设置登录用户 ID：

```
FormsAuthentication.SetAuthCookie(UserID.ToString(), true); 
```

随后，我读到了这个值`from Page.User.Identity.Name`。

这在我的桌面上工作正常，但在我的服务器上，我将其设置为 8，然后返回 20。我试图弄清楚什么可以将 Page.User.Identity.Name 设置为一个值以及何时发生这种情况。

谢谢...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T20:26:17.463

`FormsAuthenticationModule`处理`Application_OnAuthenticate`并将 分配`HttpContext.User`给一个主要对象，该对象又由`Page.User.Identity.Name`.

服务器和你的桌面没有时差问题吗？

# lambda - 基于 lambda 表达式创建匿名类型

> ID：757905
> 
> 赞同：2
> 
> 时间：2009-04-16T20:24:23.163
> 
> 标签：lambda, anonymous-types, c#, datasource

我正在尝试为 Winforms Datagrid 创建一个流畅的界面。这应该允许我使用类型化的数据源并轻松使用属性的属性（Order.Custom.FullName）

我在初始化时添加列并尝试设置要在那里使用的属性：

```
dgv.With<Order>().Column("Client Name").On(x => x.Client.FullName); 
```

然后在设置数据源时提出原始问题：

```
dgv.SetTypedDatasource<T>(IList<Order> orders) 
```

这里的一个大问题是通用控件是不可能的（我猜），所以不能为类指定 T，但必须为每个方法指定......

我想根据 lambda 表达式中的给定属性创建一个匿名类型列表：

就像是：

```
ProcessList<Client>(clientList, x => x.FullName); 
```

是否有可能做这样的事情：

[编辑] 请注意，在实践中，表达式将更早设置，并将在其他地方获取......

```
public void ProcessList<T>(IList<T> sourceList, Expression<Func<T, object>> expression)
{
    var list =
        (from T x
         in sourceList
         select new { expression })
         .ToList();

    // process list ....  grid.DataSource = list;
} 
```

所以，我想根据给定的表达式创建匿名类型。我知道我可以评估该表达式以检索正确的属性。

我有点卡住了，这样的事情可能吗？

有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T20:30:15.160

好吧，通过一个简单的调用`Select`你可以非常接近：

```
ProcessList(clientList.Select(x => new { x.FullName }));

...

public void ProcessList<T>(IEnumerable<T> list)
{
    // process list ... T will be an anonymous type by now
    grid.DataSource = list;
} 
```

（假设您也不需要*原始*列表`ProcessList`。如果需要，请将选择移到那里。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T20:31:41.163

这不只是`grid.DataSource = sourceList.AsQueryable().Select(expression).ToList();`

请注意，最好引入第二个泛型，以便键入列表：

```
 public static void ProcessList<TSource, TValue>(
        IList<TSource> sourceList,
        Func<TSource, TValue> expression)
    {
        grid.DataSource = sourceList.Select(expression).ToList();
    } 
```

请注意，我从切换`Expression<...>`到 just `Func<...>`，因为它似乎没有任何作用。

# c++ - 黑白图形上下文

> ID：757913
> 
> 赞同：1
> 
> 时间：2009-04-16T20:28:03.917
> 
> 标签：c++, c, macos, core-graphics, cgbitmapcontext

我在 Quartz/Core-graphics 工作。我正在尝试创建一个黑白、每像素 1b 的图形上下文。

我目前有一个带有灰度图像（实际上是黑白的）的 CGImageRef。我想把它画成一个黑白的 BitmapContext，这样我就可以把它拿出来并用 CCITT-group 4 压缩它。（由于某种原因，Quartz 不会让你以除 LZW 之外的任何 TIFF 格式保存）。

所以，我需要每像素 1 位的数据。我认为绘制到 1bpp 上下文中可以做到这一点。但是，它不会让我创建上下文：

```
 context = CGBitmapContextCreate (data,
                pixelsWide,
                pixelsHigh,
                1,
                pixelsWide/8,
                CGColorSpaceCreateDeviceGray(),
                kCGImageAlphaNone
                                 ); 
```

有比灰色更小的色彩空间吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T20:52:55.997

即使支持 1 位位图，如果`pixelsWide`不是 8 的倍数，那么每行的字节数也不是整数：例如，如果您的图像是 12 像素宽，那么每行的字节数是 1 并且一半。您的除法表达式会将其截断为每行一个字节，这是错误的。

但前提是支持 1 位位图，[但它们不](http://developer.apple.com/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/dq_context/dq_context.html#//apple_ref/doc/uid/TP30001066-CH203-BCIBHHBB)支持.

# asp.net - HttpRuntime Close 不会像宣传的那样从缓存中删除项目

> ID：757916
> 
> 赞同：1
> 
> 时间：2009-04-16T20:29:44.833
> 
> 标签：asp.net, caching, asp.net-2.0

我已经为我正在开发的网站创建了自己的缓存管理器，并且我正在寻找在某些情况下清除缓存的最佳方法。

我发现很多文章都说清除缓存的正确方法是调用 HttpRuntime.Close()

但是，在我的单元测试设置中，我调用了封装的函数 HttpRuntime.Close() 并且缓存没有被清除。

我希望它执行类似于

```
foreach (DictionaryEntry cacheItem in HttpRuntime.Cache)
{
    HttpRuntime.Cache.Remove(cacheItem.Key.ToString());
} 
```

foreach 循环在我封装的函数中运行良好，但 Close() 永远无法正常运行。

我是否误解了 HttpRuntime.Close() 的目的，还是这里发生了更险恶的事情？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-16T20:33:48.117

不要使用关闭，它比文档说的要多。文档还说在处理正常请求时不要使用它......

这是 Close() 的反射源：

```
[SecurityPermission(SecurityAction.Demand, Unrestricted=true)]
public static void Close() {
    if (_theRuntime.InitiateShutdownOnce()) {
        SetShutdownReason(ApplicationShutdownReason.HttpRuntimeClose, "HttpRuntime.Close is called");
        if (HostingEnvironment.IsHosted) {
            HostingEnvironment.InitiateShutdown();
        } else {
            _theRuntime.Dispose();
        }
    }
} 
```

此外，您不能同时遍历集合并从中删除项目，因为这会使枚举无效。

所以，试试这个，它不会改变它循环的内容：

```
List<string> toRemove = new List<string>();
foreach (DictionaryEntry cacheItem in HttpRuntime.Cache) {
    toRemove.Add(cacheItem.Key.ToString());
}
foreach (string key in toRemove) {
    HttpRuntime.Cache.Remove(key);
} 
```

话虽如此，实际上，您应该尝试使用缓存依赖项来自动为您清除无效的缓存条目，然后所有这些都变得不必要了。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-01-15T16:11:41.443

> > 我理解枚举的问题，但由于某种原因，缓存在遍历列表时似乎没有删除项目的问题。

如果深入到细节实现，你会发现 Enumerator 是由 CacheSingle.CreateEnumerator 创建的，为枚举创建了一个新的 Hashtable 实例。

这就是为什么您可以在 foreach 循环中执行删除操作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-01-05T21:43:57.707

您可以简单地实现自己的 Cache 类，请检查以下内容：

```
 public sealed class YourCache<T>
{
    private Dictionary<string, T> _dictionary = new Dictionary<string, T>();

    private YourCache()
    {
    }

    public static YourCache<T> Current
    {
        get
        {
            string key = "YourCache|" + typeof(T).FullName;
            YourCache<T> current = HttpContext.Current.Cache[key] as YourCache<T>;
            if (current == null)
            {
                current = new YourCache<T>();
                HttpContext.Current.Cache[key] = current;
            }
            return current;
        }
    }

    public T Get(string key, T defaultValue)
    {
        if (string.IsNullOrWhiteSpace(key))
            throw new ArgumentNullException("key should not be NULL");

        T value;
        if (_dictionary.TryGetValue(key, out value))
            return value;

        return defaultValue;
    }

    public void Set(string key, T value)
    {
        if (key == null)
            throw new ArgumentNullException("key");

        _dictionary[key] = value;
    }

    public void Clear()
    {
        _dictionary.Clear();
    }
} 
```

您可以从缓存中调用项目，甚至可以使用以下命令清除它们：

```
 // put something in this intermediate cache
YourCache<ClassObject>.Current.Set("myKey", myObj);

// clear this cache
YourCache<ClassObject>.Current.Clear(); 
```

# sql-server - 对同一表中的 RowParentId 的约束？

> ID：757918
> 
> 赞同：3
> 
> 时间：2009-04-16T20:30:13.180
> 
> 标签：sql-server

如何在我的字段上指定允许 null 但如果值存在它应该是现有表中的主键值之一的约束？看一下代码：

```
 CREATE TABLE TestTable 
(
    RowId int IDENTITY NOT NULL PRIMARY KEY,
    RowParentId int NULL, -- < how do I specify constraint that RowParentId if not NULL should be RowId (foreign key to existing table?)
    RowName nvarchar(30),
    RowShortName nvarchar(10)
)
GO 
```

我希望能够在不限制深度和对现有父级强制约束的情况下生成父子视图。

希望我能够传达我正在寻找的东西。

干杯

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T20:34:50.720

不就是外键吗？

```
RowParentId int NULL references ParentTable (ParentTableIdColumn), 
```

如果它不为 null，则它必须是父表中的值。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T20:37:22.007

```
ALTER TABLE TestTable
ADD CONSTRAINT fk_testtable_parent
FOREIGN KEY (RowParentId)
REFERENCES TestTable(RowId) 
```

请注意，`NULL`在列中保留 a 是一个坏主意，因为它不能通过索引进行搜索。

您最好添加一个代理记录`id = 0`，将您的真实根引用到该记录，并将其从选择中排除。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T20:38:27.513

您可以有一个引用回同一个表的外键约束。不过，您可能想研究其他模型的层次结构。链接链模型在 SQL 中存在很多问题。在“Joe Celko hierarchies”上进行谷歌搜索，您应该能够找到有关建模层次结构的其他方法的信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T20:39:36.793

你想创建一个*外键*。有几种方法可以做到这一点，但对于像这样的单个键，最简单的方法是在该列的 workld "null" 之后添加以下内容：

```
references table_name (column_name) 
```

您可能需要在此之前添加“外键”字样，我不记得了。无论哪种方式，都应该照顾它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T20:40:22.407

ALTER TABLE [dbo].TestTable WITH CHECK ADD CONSTRAINT [FK_TestTable_RowId_TestTable_RowParentId] FOREIGN KEY(RowParentId) REFERENCES TestTable(RowId)

# ruby - 正在寻找通过阅读代码确定编程语言的 ruby gem？

> ID：757922
> 
> 赞同：5
> 
> 时间：2009-04-16T20:31:32.397
> 
> 标签：ruby, rubygems, gem

几个月前，我阅读了一篇关于 ruby​​ gem 的博客文章，它可以通过阅读代码本身来确定编程语言。对于我的生活，我不记得博客或宝石的名称。谷歌搜索“ruby 编程语言猜测”及其变体也无济于事。

有人碰巧知道相关宝石的名称吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T20:34:22.030

是不是这个：http: [//github.com/chrislo/sourceclassifier/tree/master](http://github.com/chrislo/sourceclassifier/tree/master)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T20:35:45.227

查看[http://blog.chrislowis.co.uk/2009/01/04/identify-programming-languages-with-source-classifier.html](http://blog.chrislowis.co.uk/2009/01/04/identify-programming-languages-with-source-classifier.html)上的文章。

提到的 gem 称为 SourceClassifier，可以在[http://github.com/chrislo/sourceclassifier/tree/master](http://github.com/chrislo/sourceclassifier/tree/master)找到。

希望这就是你要找的！

# wcf - 如何使用 telnet/raw 为 WCF 服务创建远程管理控制台？

> ID：757926
> 
> 赞同：1
> 
> 时间：2009-04-16T20:31:52.770
> 
> 标签：wcf, console, telnet, putty

我有一个当前使用 TCP 端点的 WCF 服务。而不是创建一个单独的控制台客户端应用程序来管理服务器，我希望能够远程登录到服务器，甚至只是使用 putty 使用原始连接进行连接，并直接在服务器上执行 ascii 命令。

有什么想法我会怎么做？不是 WCF 方面的专家，因此将不胜感激。谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T20:35:37.333

我怀疑你能做到这一点 - WCF 将始终必须使用其定义的端点 - TCP、HTTP - 无论如何。正如您所提到的，我不知道有任何 telnet 绑定或原始连接。

从我的角度来看，为什么不为管理目的创建一个服务合同，然后从控制台应用程序中使用 HTTP 和/或 TCP 来实现呢？似乎比尝试“固定”一些没有真正想到的东西更容易。

马克

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T20:45:20.927

为了管理我的 WCF 应用程序，我在 IIS 中托管，并在应用程序虚拟目录中有一个子文件夹，其中包含管理 aspx 页面。使用 ASP.NET 角色保护该文件夹免受未经授权的访问。

Admin 文件夹包括与应用程序无关的页面（例如管理日志记录、查看日志文件）以及适当的应用程序特定页面。

由于 ASP.NET 页面与托管的 WCF 服务在同一个 AppDomain 中执行，因此在添加检测和动态配置功能方面没有任何限制。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T20:35:38.503

我不认为 WCF 支持开箱即用的自定义命令处理，要让它工作起来需要相当多的跳跃。我会建议

1.  在 Windows 服务而不是 IIS 中托管 WCF 服务
2.  在 Windows 服务中创建一个套接字侦听器，侦听您选择的端口
3.  当数据到达套接字时，编写一些代码来处理您的命令

# c++ - 如何更改存储在 C++ 字符串中的文件扩展名？

> ID：757933
> 
> 赞同：13
> 
> 时间：2009-04-16T20:34:50.407
> 
> 标签：c++, encoding, file-extension

好吧，这就是交易，我正在对我大学的 C++ 课程进行介绍，并且无法弄清楚如何更改文件的扩展名。首先，我们要做的是读取 .txt 文件并计算单词、句子、元音等。好吧，我明白了，但下一步是困扰我的事情。然后我们假设使用与输入文件相同的文件名创建一个新文件，但扩展名为 .code 而不是 .txt（在该新文件中，我们将通过在每个文件的 ASCII 码中添加随机数来对字符串进行编码如果你有兴趣的话）。作为编程的初学者，我不太确定如何做到这一点。我使用以下代码首先获取输入文件：

```
cout << "Enter filename: ";
cin >> filename;
infile.open(filename.c_str()); 
```

我假设创建一个新文件，我将使用如下内容：

```
outfile.open("test.code"); 
```

但是在用户输入之前我不会知道文件名是什么，所以我不能说“test.txt”。因此，如果有人知道在我创建新文件时如何更改该扩展名，我将不胜感激！

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2015-01-06T10:05:22.647

我偶尔会问自己这个问题并最终出现在这个页面上，所以为了将来参考，这里是单行语法：

```
string newfilename=filename.substr(0,filename.find_last_of('.'))+".code"; 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-16T20:44:46.297

有几种方法可以解决这个问题。

您可以采用超级懒惰的方法，让他们只输入文件名，而不是 .txt 扩展名。在这种情况下，您可以将 .txt 附加到它以打开输入文件。

```
infile.open(filename + ".txt"); 
```

然后你只需打电话

```
outfile.open(filename + ".code"); 
```

下一种方法是获取包括扩展名在内的整个文件名，然后将 .code 附加到它上面，这样你就有了 test.txt.code。

这是否可以接受有点模棱两可。

最后，您可以使用`std::string`methods [`find`](http://en.cppreference.com/w/cpp/string/basic_string/find)，并[`replace`](http://en.cppreference.com/w/cpp/string/basic_string/replace)获取没有扩展名的文件名，然后使用它。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-04-16T20:50:46.687

当然，如果这不是家庭作业而是一个真实世界的项目，那么您可能会通过使用[Boost.Filesystem](http://www.boost.org/doc/libs/release/libs/filesystem/index.html)而不是自己动手来帮自己 - 以及其他阅读您的代码的人 - 一个忙`replace_extension()`。至少在某些极端情况下，没有任何功能足够简单以至于您无法提出错误。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-16T20:42:55.693

不要放弃它，因为学习是练习的重点，但这里有一个提示。您可能需要[`find_last_of`](http://www.cplusplus.com/reference/string/string/find_last_of/)和的组合[`replace`](http://www.cplusplus.com/reference/string/string/replace/)。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-16T20:41:42.730

这里有一些提示。您已经输入了一个文件名 - 您想要做的是获取不包含扩展名的文件名部分：

```
std::string basename(const std::string &filename)
{
  // fill this bit in
} 
```

编写完该函数后，您可以使用它来创建新文件的名称：

```
std::string codeFile = basename(filename) + ".code";
outFile.open(codeFile); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T20:42:39.047

伪代码会做类似的事情

```
outFilename = filename;
<change outFilename>
outfile.open(outFilename); 
```

要更改 outFilename，请以 strrchr 和 strcpy 为起点（可能是更合适的方法——尽管这对 char* 非常有用）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-16T20:53:01.050

为什么不使用字符串方法`find_last_of()`？

```
std::string new_filename = filename;
size_type result = new_filename.find_last_of('.');

// Does new_filename.erase(std::string::npos) working here in place of this following test?
if (std::string::npos != result)
    new_filename.erase(result);

// append extension:
filename.append(".code"); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-17T02:44:08.070

在 Windows 中（至少），您可以使用[_splitpath](http://msdn.microsoft.com/en-us/library/e737s6tf.aspx)从其余部分中剖析基本名称，然后使用您最喜欢的字符串格式化程序重新组合它们。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-05-11T10:33:45.713

我只会将“.code”附加到用户输入的文件名中。如果他们输入“test.txt”，那么输出文件将是“test.txt.code”。如果他们输入了一个没有扩展名的文件名，比如“test”，那么输出文件就是“test.code”。

我一直使用这种技术来生成输出文件和某种相关的日志/诊断输出的程序。它实现起来很简单，而且在我看来，它使文件之间的关系更加明确。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-05-11T07:51:56.953

如何使用strstr：

```
char* lastSlash;
char* newExtension = ".code";
ChangeFileExtension(char* filename) {
    lastSlash = strstr(filename, ".");
    strcpy(lastSlash, newExtension);
} 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2009-04-16T20:50:40.337

您需要做的是将原始文件名复制到一个新变量中，您可以在其中更改扩展名。像这样的东西：

```
string outFilename;
size_t extPos = filename.rfind('.');
if (extPos != string::npos)
{
    // Copy everything up to (but not including) the '.'
    outFilename.assign(filename, 0, extPos);
    // Add the new extension.
    outFilename.append(".code");
    // outFilename now has the filename with the .code extension.
} 
```

如果您不需要保留原始文件名以供以后使用，则可以使用“文件名”变量。在这种情况下，您可以使用：

```
size_t extPos = filename.rfind('.');
if (extPos != string::npos)
{
    // Erase the current extension.
    filename.erase(extPos);
    // Add the new extension.
    filename.append(".code");
} 
```

关键是看C++字符串类的定义，了解每个成员函数的作用。使用 rfind 将在字符串中向后搜索，您不会意外碰到文件夹名称中可能是原始文件名一部分的任何扩展名（例如“C:\MyStuff.School\MyFile.txt”）。在使用 find、rfind 等的偏移量时，您还需要小心在将它们作为计数传递给其他方法时正确使用它们（例如，您是否使用 assign(filename, 0, extPos-1)、assign （文件名，0，extPos），分配（文件名，0，extPos+1））。

希望有帮助。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2016-06-14T11:59:26.083

```
size_t pos = filename.rfind('.');
if(pos != string::npos)
    filename.replace(pos, filename.length() - pos, ".code");
else
    filename.append(".code"); 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2018-05-19T21:17:53.140

很容易：

```
string str = "file.ext";

str[str.size()-3]='a';
str[str.size()-2]='b';
str[str.size()-1]='c';

cout<<str; 
```

结果：“file.abc”

# silverlight - 您使用什么来测试 Silverlight 应用程序？

> ID：757936
> 
> 赞同：2
> 
> 时间：2009-04-16T20:35:11.420
> 
> 标签：silverlight, testing

我们正在使用 Silverlight 启动一个大型 LOB 应用程序。

我想知道您是否有任何测试 Silverlight 应用程序的经验，您找到的最佳解决方案是什么，以及您是否遇到任何陷阱。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T22:14:31.057

一位名叫 Jeff Wilcox 的坚定人士开发了一个专门针对 Silverlight 2 的单元测试框架。它运作良好。

[http://code.msdn.microsoft.com/silverlightut/](http://code.msdn.microsoft.com/silverlightut/)

我还使用由 Oren Eini 开发的 Rhino Mocks 3.5 For Silverlight 作为我的模拟框架。Rhino Mocks 是免费且优秀的。它还提供 Silverlight 支持：

[http://ayende.com/projects/rhino-mocks.aspx](http://ayende.com/projects/rhino-mocks.aspx)

我使用 Prism 2.0 和 Unity IoC，它们有助于促进 MVVM 模式。这使测试变得轻而易举。我发现的一个缺陷是 Silverlight 单元测试在 Web 浏览器中运行，这阻碍了持续集成。

ib。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T20:43:44.683

SIlverlight 的“必备”调试工具是[Silverlight Spy](http://firstfloorsoftware.com/silverlightspy/download-silverlight-spy/)，可免费下载。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T20:38:43.503

可能不完全是您所追求的，但我订阅了 Netflix，他们使用以下网址

[http://www.tinyurl.com/netflixsl](http://www.tinyurl.com/netflixsl)

...当他们遇到问题时发送订阅者。这当然是在事情结束时，我假设你在实际开发时正在测试一些东西。但是，一旦产品发布，这可能是您可以复制的东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-24T09:11:54.807

我使用[SilverUnit](http://www.codeplex.com/CThru/Wiki/View.aspx?title=SilverUnit%20examples&referringTitle=Home)对[Silverlight 进行单元测试，它是一个位于](http://www.typemock.com/Silverlight_unit_testing_page.php)[Typemock Isolator](http://www.typemock.com/Silverlight_unit_testing_page.php)之上的开源工具

# asp.net - ASP.NET 部署和法规遵从性（SOX 等）

> ID：757938
> 
> 赞同：1
> 
> 时间：2009-04-16T20:35:27.177
> 
> 标签：asp.net, deployment, sox

我有一个客户在我们的 ASP.NET 应用程序的部署实践方面受到 SOX 审计员的严厉追究。注意确保使用适当的文件和文件夹级别的安全和授权。只有少数拥有部署权限的人可以将文件复制到产品服务器（通常使用安全 FTP 完成）。

但是，文件/文件夹级别的安全性和安全 FTP 的要求对于 bean 计数器来说是不够的。他们想要系统日志，记录谁在何时部署了什么、什么版本替换了什么版本（以及为什么），以及通常旨在防止业务被办公空间隔开的许多其他细枝末节（bean 柜台显然希望自己获得四舍五入的美分）。

你有什么让审计师满意的建议？我们不介意为此投入一些资金（事实上，我认为我们可能会投入大量资金来获得足够好的解决方案）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T20:41:26.570

您可能希望查看自动化部署解决方案，并且您将需要一个正式的变更控制流程。我们使用[anthill pro](http://www.anthillpro.com/html/default.html)。它可以跟踪部署的版本和时间。

为了满足 sox，我们每周召开一次会议，讨论何时部署的内容。它必须得到合规经理的批准，并且每次部署都需要填写一份表格，解释改变的内容、原因和方式。填写表格后，必须让第三方参与（不是请求或批准的人，他们都无法访问生产环境，因为您必须遵循职责分离规则）来进行更改和变更是基于“变更文件”中的内容，没有来自提出请求的人的外部沟通。部署后，所有人都必须签字确认已完成以及何时完成。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T20:43:54.427

满足要求应该不会太难，它可能需要对您的开发过程进行一些更改，但这绝对是可能的。

你需要的是：

*   任务跟踪系统，显示工作描述和批准
*   将文档和包链接到该系统的能力。
*   用于测试您的部署的测试系统。
*   最后，所有部署都必须通过安装包和其他脚本方式完成。
*   任何手动更改也必须记录在案并获得批准。

还要打开审核，运行定期安全测试，并记录几乎所有内容。

所有这一切都可以通过许多系统实现，最大的变化是内部流程的变化。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T20:40:08.973

您可能想看看 NTFS 提供的审计功能。

# ms-access - Microsoft Access 字符串解析

> ID：757939
> 
> 赞同：1
> 
> 时间：2009-04-16T20:35:29.390
> 
> 标签：ms-access, vba

在 MS Access 2003 中，我在一列中有以下值

```
0-0-60
20-0-0-24S
20.5-0-0-24S
32-0-0 
```

如何编写查询，以便可以从列中提取第三项，例如“0-0-60”中的“60”。请记住，我还可以选择第 4 列。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T21:01:07.007

您将希望将此函数概括为分隔符和位置，但是：

```
Public Function SplitString(inputString As String) As String
    Dim TestArray() As String
    TestArray = Split(inputString, "-")
    Debug.Print TestArray(2)
    SplitString = TestArray(2)
End Function 
```

您可以像这样在查询中调用：

```
SELECT SplitString([MyField]) AS Expr1
FROM MyTable; 
```

祝你好运！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T20:49:07.970

您是否会在每列中少于 3 个项目？

真的，如果您有 3 位小数或 4 位小数作为值的非常具体的格式，我会考虑将您的架构更改为

```
Value1 decimal
Value2 decimal
Value3 decimal
Value4 decimal (NULLABLE) 
```

但这有点离题了...

如果你真的坚持这一点，那么在你的代码中解析它可能比在 Access SQL 查询中做一些讨厌的左/右/instr工作更快

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T08:57:20.720

您发现查询数据列并非易事，这就是我们所说的“气味”。

这看起来与违反第一范式 (1NF) 完全一样，因为您在单列中有非标量数据。我相信您将这些值拆分为一次性数据清理练习以一劳永逸地解决问题（在这种情况下，如果结果集很小，我会亲自使用 Excel 的文本到列功能）。

如果您打算在查询中为您的应用程序执行此操作，那么我建议您研究规范化并相应地更改您的架构。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-16T20:39:10.333

我相信查询构建器工具上这样的内联表达式可以完成这项工作（未经测试）。

```
right(yourColumnNam, inStrRev(yourColumnName, '-')) 
```

# jquery - jQuery .clone() 和 Microsoft Explorer（错误？）

> ID：757945
> 
> 赞同：4
> 
> 时间：2009-04-16T20:37:03.803
> 
> 标签：jquery, internet-explorer

我在使用 Microsoft Explorer 6/7 和 jQuery“克隆”功能时遇到了一些问题。我正在使用的 jQuery 是：

```
$(function() {
  $('#addFields').click(function() {
    var newCredit = $('#original').clone(); // create new set
    newCredit.find('input').val(''); // empty input fields
    $(this).before(newCredit); // append at the end
    return false;
  });
});
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<div id="original">
  <li id="prodEnt">
    <label class="description" for="entity[]">Entity </label>
    <div>
      <input name="entity[]" class="element text medium" type="text" value="" />
    </div>
  </li>

  <li id="entFunc">
    <label class="description" for="element_5">Function </label>
    <div>
      <input name="function[]" class="element text medium" type="text" value="" />
    </div>
  </li>

  <li class="section_break_small"></li>
</div>
```

Microsoft 浏览器无法复制多个克隆，并且不会为新元素设置样式 (CSS)。

请告诉我一个 IE 友好的替代方案！谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T20:44:28.730

你不能/不应该有`<li>`没有 parent 的元素`<ul>`。此外，你不能/不应该`<div>`在你拥有的元素中拥有元素`<li>`。最后，您`id`在被克隆的 HTML 中有属性，这将导致具有相同`id`. 如果您替换外部`original`div 并将其设为 a `<ul>`，摆脱 id 属性并将其设为 a `class`，应该没问题。

话虽如此，[它在 IE7 上对我有用](http://jsbin.com/iqude)。

**编辑**

回应您的评论：

只选择第一个，这样做（假设它有一个类`fields`）：

```
$('ul.fields').eq(0).clone(); 
```

# python - 为什么添加组时正则表达式不匹配？

> ID：757949
> 
> 赞同：3
> 
> 时间：2009-04-16T20:38:14.830
> 
> 标签：python, regex

我在 python 中有这个正则表达式代码：

```
if re.search(r"\{\\fad|fade\(\d{1,4},\d{1,4}\)\}", text):
  print(re.search(r"\{\\fad|fade\((\d{1,4}),(\d{1,4})\)\}", text).groups()) 
```

`text`是`{\fad(200,200)}Épisode 101 : {\i1}The Ghost{\i0}\Nv. 1.03`并从文件中读取（不知道这是否有帮助）。

这将返回以下内容：

```
(None, None) 
```

当我将打印中的正则表达式更改为 时`r"\{\\fad\((\d{1,4}),(\d{1,4})\)\}"`，它返回正确的值：

```
(200, 200) 
```

谁能看到为什么条件`fad|fade`匹配中的正则表达式`re.search`但不返回打印中组的正确值？

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T20:45:57.103

在选项周围加上额外的括号：`re.search(r"{(?:\\fad|fade)\((\d{1,4}),(\d{1,4})\)}", text).groups()`

此外，转义`{}`大括号不是必需的，它只是不必要地使您的正则表达式混乱。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T20:45:48.027

括号是 or 分支的一部分，以 fade 开头，因此它正在寻找“{fad”或“fade(...”。您需要将 fad|fade 部分组合在一起。尝试：

```
r"\{\\(?:fad|fade)\(\d{1,4},\d{1,4}\)\}" 
```

**[编辑]** 你进入 if 块的原因是因为正则表达式**匹配**，但只是因为它检测到它以“{\fad”开头。但是，匹配的那部分不包含任何组。如果要捕获它们，则需要与定义组的部分匹配。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T20:45:28.150

试试这个：

```
r"\{\\fade?\(\d{1,4},\d{1,4}\)\}" 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T20:43:41.570

我认为您的条件是在寻找“\fad”或“fade”，如果您想寻找“\fad”或“\fade”，我认为您需要将\移出分组。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-16T20:47:57.380

试试这个：

```
r"\{\\fade?\((\d{1,4}),(\d{1,4})\)\}" 
```

`e?`是可选的`e`。你现在拥有它的方式匹配`{\fad`或`fade(0000,0000)}`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T20:47:22.437

我不知道正则表达式的 python 方言，但你不需要以某种方式“分组”“fad|fade”以确保它没有试图找到“fad OR fade(etc...”吗？

# sql - 限制左连接

> ID：757957
> 
> 赞同：5
> 
> 时间：2009-04-16T20:40:05.107
> 
> 标签：sql, oracle

我有一个表，我们称它为“a”，用于涉及大量表的视图中的左连接。但是，如果它们还与另一个表“b”连接，我只想返回“a”行。所以现有的代码看起来像

```
SELECT ....
FROM main ...
...
LEFT JOIN a ON (main.col2 = a.col2) 
```

但它返回的行太多，特别是 a 在 b 中没有匹配的行。我试过

```
SELECT ...
FROM main ...
...
LEFT JOIN (
   SELECT a.col1, a.col2
   FROM a
   JOIN b ON (a.col3 = b.col3)) ON (a.col2 = main.col2) 
```

这给了我正确的结果，但不幸的是“解释计划”告诉这样做最终会强制对 a 和 b 进行全表扫描，这使得事情变得非常缓慢。我的一位同事建议在 b 上使用另一个 LEFT JOIN，但这不起作用，因为当它存在时它给了我 b 行，但不会停止从 a 返回在 b 中没有匹配的行。

有没有办法将 main.col2 条件放在子 SELECT 中，这样可以摆脱全表扫描？或者其他方式来做我想做的事？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T20:41:42.840

```
SELECT ...
FROM ....
LEFT JOIN ( a INNER JOIN b ON .... ) ON .... 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T20:42:10.890

1.  添加一个 where (main.col2 = a.col2)

2.  只需进行联接而不是左联接。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T20:42:18.797

如果您创建了一个让您“a”到“b”连接的视图，那么您的左连接到该视图怎么办？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T20:53:01.813

```
 Select ... 
    From Main 
     Left Join a on main.col2 = a.col2
    where a.col3 in (select b.col3 from b) or a.col3 is null 
```

您可能还需要对 a.col3 和 b.col3 做一些索引

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T20:54:21.920

首先在表“a”和“b”之间定义您的查询，以确保它返回您想要的行：

```
Select
   a.field1,
   a.field2,
   b.field3
from
   table_a a

   JOIN table_b b
      on (b.someid = a.someid) 
```

然后将其作为主查询的子查询：

```
select
   m.field1,
   m.field2,
   m.field3,
   a.field1 as a_field1,
   b.field1 as b_field1
from
   Table_main m

   LEFT OUTER JOIN
      (
      Select
         a.field1,
         a.field2,
         b.field3
      from
         table_a a

         JOIN table_b b
            on (b.someid = a.someid)
      ) sq
   on (sq.field1 = m.field1) 
```

应该这样做。

啊，错过了性能问题说明——我通常最终做的是将视图中的查询放在存储过程中，这样我就可以生成临时表的子查询并在它们上放置索引。出乎意料地快于您的预期。:-)

# java - JasperReports 中的 java.util.ConcurrentModificationException

> ID：757970
> 
> 赞同：2
> 
> 时间：2009-04-16T20:42:49.560
> 
> 标签：java, concurrency, jasper-reports

我们有一个 Web 应用程序部署到 Windows 上的 Websphere 6.1.0.19。我们偶尔会在一些报告中看到此 ConcurrentModificationException。我们在生产中使用 JasperReports 2.0.5。完整的堆栈跟踪如下：

```
java.util.ConcurrentModificationException
      在 java.util.AbstractList$Itr.checkForComodification(AbstractList.java:464)
      在 java.util.AbstractList$Itr.next(AbstractList.java:435)
      在 net.sf.jasperreports.engine.data.JRBeanCollectionDataSource.next(JRBeanCollectionDataSource.java:91)
      在 com.advtechgrp.bop.medical.reports.core.implementation.MedicalReportDataSourceImpl.next(MedicalReportDataSourceImpl.java:61)
      在 net.sf.jasperreports.engine.fill.JRFillDataset.advanceDataSource(JRFillDataset.java:830)
      在 net.sf.jasperreports.engine.fill.JRFillDataset.next(JRFillDataset.java:748)
      在 net.sf.jasperreports.engine.fill.JRBaseFiller.next(JRBaseFiller.java:1438)
      在 net.sf.jasperreports.engine.fill.JRVerticalFiller.fillReport(JRVerticalFiller.java:111)
      在 net.sf.jasperreports.engine.fill.JRBaseFiller.fill(JRBaseFiller.java:895) 在 net.sf.jasperreports.engine.fill.JRBaseFiller.fill(JRBaseFiller.java:817)
      在 net.sf.jasperreports.engine.fill.JRFiller.fillReport(JRFiller.java:89)
      在 net.sf.jasperreports.engine.JasperFillManager.fillReport(JasperFillManager.java:601)
      在 com.advtechgrp.bop.medical.reports.core.MedicalReportBase.getReportList(MedicalReportBase.java:160)
      在 com.advtechgrp.bop.medical.reports.core.implementation.MedicalReportCreator.createJasperExporter(MedicalReportCreator.java:275)
      在 com.advtechgrp.bop.medical.reports.core.implementation.MedicalReportCreator.createExporter(MedicalReportCreator.java:228)
      在 com.advtechgrp.bop.medical.reports.core.implementation.MedicalReportCreator.createReportUnsafe(MedicalReportCreator.java:196)
      在 com.advtechgrp.bop.medical.reports.core.implementation.MedicalReportCreator.createReport(MedicalReportCreator.java:80)
      在 com.advtechgrp.bop.medical.reports.core.web.MedicalReportServlet.doPost(MedicalReportServlet.java:132)
      在 javax.servlet.http.HttpServlet.service(HttpServlet.java:763)
      在 javax.servlet.http.HttpServlet.service(HttpServlet.java:856)
      在 com.ibm.ws.cache.servlet.ServletWrapper.serviceProxied(ServletWrapper.java:282)
      在 com.ibm.ws.cache.servlet.CacheHook.handleFragment(CacheHook.java:459)
      在 com.ibm.ws.cache.servlet.CacheHook.handleServlet(CacheHook.java:265)
      在 com.ibm.ws.cache.servlet.ServletWrapper.service(ServletWrapper.java:262)
      在 com.ibm.ws.webcontainer.servlet.ServletWrapper.service(ServletWrapper.java:1075)
      在 com.ibm.ws.webcontainer.servlet.ServletWrapper.service(ServletWrapper.java:1016)
      在 com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:118)
      在 com.ibm.ws.webcontainer.filter.WebAppFilterChain._doFilter(WebAppFilterChain.java:87)
      在 com.ibm.ws.webcontainer.filter.WebAppFilterManager.doFilter(WebAppFilterManager.java:771)
      在 com.ibm.ws.webcontainer.filter.WebAppFilterManager.doFilter(WebAppFilterManager.java:679)
      在 com.ibm.ws.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:546)
      在 com.ibm.ws.wswebcontainerservlet.ServletWrapper.handleRequest(ServletWrapper.java:478)
      在 com.ibmws.webcontainer.webapp.WebAppRequestDispatcher.forward(WebAppRequestDispatcher.java:321)
      在 com.advtechgrp.bop.medical.web.filter.UrlRewritingFilter.doFilter(UrlRewritingFilter.java:132)
      在 com.ibm.ws.webcontainer.filterFilterInstanceWrapper.doFilter(FilterInstanceWrapper.java:190)
      在 com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:130)
      在 com.advtechgrp.bop.medical.web.filter.GZIPFilter.doFilter(GZIPFilter.java:36)
      在 com.ibm.ws.webcontainer.filter.FilterInstanceWrapper.doFilter(FilterInstanceWrapper.java:190)
      在 com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:130)
      在 com.advtechgrp.bop.medical.web.filter.WebLogFilter.doFilter(WebLogFilter.java:69)
      在 com.ibm.ws.webcontainer.filter.FilterInstanceWrapper.doFilter(FilterInstanceWrapper.java:190)
      在 com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:130)
      在 com.advtechgrp.bop.medical.web.filter.SecurityFilter.doFilter(SecurityFilter.java:174)
      在 com.ibm.ws.webcontainerfilter.FilterInstanceWrapper.doFilter(FilterInstanceWrapper.java:190)
      在 com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:130)
      在 com.ibm.ws.webcontainer.filter.WebAppFilterChain._doFilter(WebAppFilterChain.java:87)
      在 com.ibm.ws.webcontainer.filter.WebAppFilterManager.doFilter(WebAppFilterManager.java:771)
      在 com.ibm.ws.webcontainer.filter.WebAppFilterManager.doFilter(WebAppFilterManager.java:679)
      在 com.ibm.ws.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:546)
      在 com.ibm.ws.wswebcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:478)
      在 com.ibm.ws.webcontainer.servlet.CacheServletWrapper.handleRequest(CacheServletWrapper.java:90)
      在 com.ibm.ws.webcontainer.WebContainer.handleRequest(WebContainer.java:744)
      在 com.ibm.ws.wswebcontainer.WebContainer.handleRequest(WebContainer.java:1455)
      在 com.ibmws.webcontainer.channel.WCChannelLink.ready(WCChannelLink.java:115)
      在 com.ibm.ws.http.channel.inbound.impl.HttpInboundLink.handleDiscrimination(HttpInboundLink.java:458)
      在 com.ibm.ws.http.channel.inbound.impl.HttpInboundLink.handleNewInformation(HttpInboundLink.java:387)
      在 com.ibm.ws.http.channel.inbound.impl.HttpICLReadCallback.complete(HttpICLReadCallback.java:102)
      在 com.ibm.ws.tcp.channel.impl.AioReadCompletionListener.futureCompleted(AioReadCompletionListener.java:165)
      在 com.ibm.io.async.AbstractAsyncFuture.invokeCallback（AbstractAsyncFuture.java:217）
      在 com.ibm.io.async.AsyncChannelFuture.fireCompletionActions（AsyncChannelFuture.java:161）
      在 com.ibm.io.async.AsyncFuture.completed(AsyncFuture.java:136)
      在 com.ibm.io.async.ResultHandler.complete(ResultHandler.java:195)
      在 com.ibm.io.async.ResultHandler.runEventProcessingLoop(ResultHandler.java:743)
      在 com.ibmio.async.ResultHandler$2.run(ResultHandler.java:873)
      在 com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:1473)

```

谢谢，
汤姆

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-17T13:10:18.937

这是由于在使用迭代器时更改了迭代器的后备存储。这不是与线程相关的并发问题，因为在单个线程上也很容易做到。

[关于这个问题](https://stackoverflow.com/questions/602636/concurrentmodificationexception-and-a-hashmap/602660#602660)的更详细的描述

您现在最大的问题将是您是否可以修复它或 Jasper 代码中的错误。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T21:06:04.623

JasperReports 现在是[3.5](http://sourceforge.net/projects/jasperreports/)版本，因此可能值得检查 2.0.5 之后的更改（您的版本）是否解决了任何线程问题。这显然不会解决您*当前*的生产问题，但使用新版本重建可能会。

说了这么多（并且不熟悉 JasperReports）我会怀疑客户端线程代码。

# javascript - 我怎样才能使这个 javascript 更容易阅读、维护和从 OO 背景理解？

> ID：757976
> 
> 赞同：3
> 
> 时间：2009-04-16T20:44:14.457
> 
> 标签：javascript

我来自 Java、C# 等领域。我正在为我拥有的 Web 应用程序开发 javascript 报告引擎。我正在使用 jQuery、AJAX 等。我很难让事情按照我认为应该的方式工作 - 例如，我已经经历了看起来太麻烦的事情，以确保当我进行 AJAX 调用时，我的回调有访问对象的成员。那些回调函数不需要那么复杂，不是吗？我知道我一定做错了什么。请指出我可以做得更好的地方 - 如果提供的片段太多/太少/太糟糕而无法查看，请告诉我。

我正在尝试做的事情：

*   在页面加载时，我有一个完整的用户选择。
*   我创建报告（目前为 1 个）并将它们添加到选择框中。
*   当同时选择用户和报表时，我运行报表。
*   该报告涉及进行一系列调用 - 获取练习系列、联赛和锦标赛 - 对于每个联赛和锦标赛，它会获取所有这些系列，然后对于每个系列，它会抓取所有比赛。
*   它维护活动调用的计数器，当它们全部完成时，将运行报告并将其显示给用户。

代码：

```
//Initializes the handlers and reports
function loadUI() {
    loadReports();
    $("#userSelect").change(updateRunButton);
    $("#runReport").click(runReport);
    updateRunButton();
    return;
    $("#userSelect").change(loadUserGames);
    var user = $("#userSelect").val();
    if(user) {
        getUserGames(user);
    }
}

//Creates reports and adds them to the select
function loadReports() {
    var reportSelect = $("#reportSelect");
    var report = new SpareReport();
    engine.reports[report.name] = report;
    reportSelect.append($("<option/>").text(report.name));

    reportSelect.change(updateRunButton);
}

//The class that represents the 1 report we can run right now.
function SpareReport() {
    this.name = "Spare Percentages";
    this.activate = function() {

    };

    this.canRun = function() {
        return true;
    };

    //Collects the data for the report.  Initializes/resets the class variables,
    //and initiates calls to retrieve all user practices, leagues, and tournaments.
    this.run = function() {
        var rC = $("#rC");
        var user = engine.currentUser();
        rC.html("<img src='/img/loading.gif' alt='Loading...'/> <span id='reportProgress'>Loading games...</span>");
        this.pendingOperations = 3;
        this.games = [];
        $("#runReport").enabled = false;
        $.ajaxSetup({"error":(function(report) {
            return function(event, XMLHttpRequest, ajaxOptions, thrownError) {
                report.ajaxError(event, XMLHttpRequest, ajaxOptions, thrownError);
            };
        })(this)});

        $.getJSON("/api/leagues", {"user":user}, (function(report) {
            return function(leagues) {
                report.addSeriesGroup(leagues);
            };
        })(this));
        $.getJSON("/api/tournaments", {"user":user}, (function(report) {
            return function(tournaments) {
                report.addSeriesGroup(tournaments);
            };
        })(this));
        $.getJSON("/api/practices", {"user":user}, (function(report) {
            return function(practices) {
                report.addSerieses(practices);
            };
        })(this));
    };

    // Retrieves the serieses (group of IDs) for a series group, such as a league or
    // tournament.
    this.addSeriesGroup = function(seriesGroups) {
        var report = this;
        if(seriesGroups) {
            $.each(seriesGroups, function(index, seriesGroup) {
                report.pendingOperations += 1;
                $.getJSON("/api/seriesgroup", {"group":seriesGroup.key}, (function(report) {
                    return function(serieses) {
                        report.addSerieses(serieses);
                    };
                })(report));
            });
        }
        this.pendingOperations -= 1;
        this.tryFinishReport();
    };

    // Retrieves the actual serieses for a series group.  Takes a set of
    // series IDs and retrieves each series.
    this.addSerieses = function(serieses) {
        var report = this;
        if(serieses) {
            $.each(serieses, function(index, series) {
                report.pendingOperations += 1;
                $.getJSON("/api/series", {"series":series.key}, (function(report) {
                    return function(series) {
                        report.addSeries(series);
                    };
                })(report));
            });
        }
        this.pendingOperations -= 1;
        this.tryFinishReport();
    };

    // Adds the games for the series to the list of games
    this.addSeries = function(series) {
        var report = this;
        if(series && series.games) {
            $.each(series.games, function(index, game) {
                report.games.push(game);
            });
        }
        this.pendingOperations -= 1;
        this.tryFinishReport();
    };

    // Checks to see if all pending requests have completed - if so, runs the
    // report.
    this.tryFinishReport = function() {
        if(this.pendingOperations > 0) {
            return;
        }
        var progress = $("#reportProgress");
        progress.text("Performing calculations...");
        setTimeout((function(report) {
            return function() {
                report.finishReport();
            };
        })(this), 1);
    }

    // Performs report calculations and displays them to the user.
    this.finishReport = function() {
        var rC = $("#rC");

        //snip a page of calculations/table generation
        rC.html(html);

        $("#rC table").addClass("tablesorter").attr("cellspacing", "1").tablesorter({"sortList":[[3,1]]});
    };

    // Handles errors (by ignoring them)
    this.ajaxError = function(event, XMLHttpRequest, ajaxOptions, thrownError) {
        this.pendingOperations -= 1;
    };

    return true;
}

// A class to track the state of the various controls.  The "series set" stuff
// is for future functionality.
function ReportingEngine() {
    this.seriesSet = [];
    this.reports = {};
    this.getSeriesSet = function() {
        return this.seriesSet;
    };
    this.clearSeriesSet = function() {
        this.seriesSet = [];
    };
    this.addGame = function(series) {
        this.seriesSet.push(series);
    };
    this.currentUser = function() {
        return $("#userSelect").val();
    };
    this.currentReport = function() {
        reportName = $("#reportSelect").val();
        if(reportName) {
            return this.reports[reportName];
        }
        return null;
    };
}

// Sets the enablement of the run button based on the selections to the inputs
function updateRunButton() {
    var report = engine.currentReport();
    var user = engine.currentUser();
    setRunButtonEnablement(report != null && user != null);
}

function setRunButtonEnablement(enabled) {
    if(enabled) {
        $("#runReport").removeAttr("disabled");
    } else {
        $("#runReport").attr("disabled", "disabled");
    }

}

var engine = new ReportingEngine();

$(document).ready( function() {
    loadUI();
});

function runReport() {
    var report = engine.currentReport();
    if(report == null) {
        updateRunButton();
        return;
    }
    report.run();
} 
```

我即将开始添加新报告，其中一些将仅在用户游戏的子集上运行。我将尝试使用子类（原型？），但如果我不知道如何简化其中的一些......我不知道如何完成那句话。帮助！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T20:54:06.587

```
$.getJSON("/api/leagues", {"user":user}, (function(report) {
        return function(leagues) {
            report.addSeriesGroup(leagues);
        };
    })(this)); 
```

可以写成：

```
var self = this;
$.getJSON("/api/leagues", {"user":user}, (function(leagues) {
            self.addSeriesGroup(leagues);
        }); 
```

当您在循环中并希望绑定到每次在循环中更改的变量时，函数返回函数会更有用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T20:47:06.650

必要时提供“一些”评论。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T20:50:34.253

我要对你说实话，并说我没有读完整本书。然而，我认为你应该知道一些关于 JavaScript 的东西，那就是它有闭包。

```
var x = 1;
$.ajax({
  success: function () {
    alert(x);
  }
}); 
```

无论 AJAX 请求完成需要多长时间，它都可以访问`x`并在成功后提示“1”。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T21:17:16.937

了解闭包。这需要一些时间来适应。（许多人会使用它，并且肯定是做事的典型方式，所以如果你了解它是如何发生的，那就太好了）

[这是一个很好的阅读线索](https://stackoverflow.com/questions/359467/jquery-closures-loops-and-events)，可以简单地解释如何有效地使用它们。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-16T21:41:02.587

您应该使用[原型](http://en.wikipedia.org/wiki/Prototype-based_programming)来定义方法并进行继承：

```
function Parent(x) {
  this.x = x;  /* Set an instance variable. Methods come later. */
}

/* Make Parent inherit from Object by assigning an
 * instance of Object to Parent.prototype. This is
 * very different from how you do inheritance in
 * Java or C# !
 */
Parent.prototype = {  /* Define a method in the parent class. */
  foo: function () {
    return 'parent ' + this.x;  /* Use an instance variable. */
  }
}

function Child(x) {
  Parent.call(this, x)  /* Call the parent implementation. */
}

/* Similar to how Parent inherits from Object; you
 * assign an instance of the parent class (Parent) to
 * the prototype attribute of the child constructor
 * (Child).
 */
Child.prototype = new Parent();

/* Specialize the parent implementation. */
Child.prototype.foo = function() {
  return Parent.prototype.foo.call(this) + ' child ' + this.x;
}

/* Define a method in Child that does not override
 * something in Parent.
 */
Child.prototype.bar = function() {
  return 'bar';
}

var p = new Parent(1);
alert(p.foo());

var ch = new Child(2);
alert(ch.foo());
alert(ch.bar()); 
```

我不熟悉 jQuery，但我知道[Prototype 库](http://prototypejs.org/)（有史以来最糟糕的名称选择）有一些功能可以更轻松地使用继承。

此外，在提出这个问题的答案时，我发现了一个不错的页面，其中详细介绍了[如何在 JS 中正确执行 OO](http://www.coolpage.com/developer/javascript/Correct%20OOP%20for%20Javascript.html)，您可能想看看。

# c# - 通过 Google Apps 帐户通过 C# 发送电子邮件

> ID：757987
> 
> 赞同：67
> 
> 时间：2009-04-16T20:47:30.330
> 
> 标签：c#, smtp, google-apps

我有一个标准的 Google Apps 帐户。我已经通过 Google Apps 设置了一个自定义域。使用 Gmail 界面时，我可以通过 Google Apps 成功发送和接收电子邮件。但是，我想通过代码发送电子邮件。为了尝试这个，我一直在尝试以下代码：

```
MailMessage mailMessage = new MailMessage();
mailMessage.To.Add("someone@somewhere.com");
mailMessage.Subject = "Test";
mailMessage.Body = "<html><body>This is a test</body></html>";
mailMessage.IsBodyHtml = true;

// Create the credentials to login to the gmail account associated with my custom domain
string sendEmailsFrom = "emailAddress@mydomain.com";             
string sendEmailsFromPassword = "password";
NetworkCredential cred = new NetworkCredential(sendEmailsFrom, sendEmailsFromPassword);

SmtpClient mailClient = new SmtpClient("smtp.gmail.com", 587);
mailClient.EnableSsl = true;
mailClient.DeliveryMethod = SmtpDeliveryMethod.Network;
mailClient.UseDefaultCredentials = false;
mailClient.Timeout = 20000;
mailClient.Credentials = cred;
mailClient.Send(mailMessage); 
```

当到达 Send 方法时，会抛出一个异常，指出：

> “SMTP 服务器需要安全连接或客户端未通过身份验证。服务器响应为：5.5.1 需要身份验证。”

如何通过 Google 通过我的自定义域发送电子邮件？

谢谢！

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2009-04-16T20:50:52.507

无需对代码中的所有 smtp 设置进行硬编码。将它们放在 web.config 中。这样，您可以在需要时加密这些设置并即时更改它们，而无需重新编译您的应用程序。

```
<configuration>
  <system.net>
    <mailSettings>
      <smtp from="example@domain.com" deliveryMethod="Network">
          <network host="smtp.gmail.com" port="587"
              userName="example@domain.com" password="password"/>
      </smtp>
    </mailSettings>
  </system.net>
</configuration> 
```

在您发送电子邮件时结束，只需在您的 SmtpClient 上启用 SSL：

```
var message = new MailMessage("navin@php.net");
// here is an important part:
message.From = new MailAddress("example@domain.com", "Mailer");
// it's superfluous part here since from address is defined in .config file
// in my example. But since you don't use .config file, you will need it.

var client = new SmtpClient();
client.EnableSsl = true;
client.Send(message); 
```

确保您发送的电子邮件与您在 Gmail 中尝试进行身份验证的电子邮件地址相同。

*注意*：从 .NET 4.0 开始，您可以将 enableSsl="true" 插入 web.config，而不是在代码中设置它。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2011-01-02T08:02:30.500

这是我在 WPF 4 中使用的

```
SmtpClient client = new SmtpClient();
client.Credentials = new NetworkCredential("sender_email@domain.tld", "P@$$w0rD");
client.Port = 587;
client.Host = "smtp.gmail.com";
client.EnableSsl = true;

try 
{
    MailAddress maFrom = new MailAddress("sender_email@domain.tld", "Sender's Name", Encoding.UTF8),
    MailAddress maTo = new MailAddress("recipient_email@domain2.tld", "Recipient's Name", Encoding.UTF8);
    MailMessage mmsg = new MailMessage(maFrom, maTo);
    mmsg.Body = "<html><body><h1>Some HTML Text for Test as BODY</h1></body></html>";
    mmsg.BodyEncoding = Encoding.UTF8;
    mmsg.IsBodyHtml = true;
    mmsg.Subject = "Some Other Text as Subject";
    mmsg.SubjectEncoding = Encoding.UTF8;

    client.Send(mmsg);
    MessageBox.Show("Done");
} 
catch (Exception ex) 
{
    MessageBox.Show(ex.ToString(), ex.Message);
    //throw;
} 
```

注意防火墙和防病毒。这些令人毛骨悚然的事情往往会阻止应用程序发送电子邮件。我使用 McAfee Enterprise，我必须添加可执行文件名称（如 Bazar.exe 和 Bazar.vshost.exe 的 Bazar.*）才能发送电子邮件...

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-12-12T17:04:10.493

将端口更改为 465

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-02-20T07:33:57.663

没有必要做任何事情。只需第一次登录您当前的帐户并按照说明进行操作。

你的问题会解决的。这是因为您在谷歌应用程序中创建了帐户但没有登录。只需登录并按照说明进行操作即可。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-12-16T15:54:39.330

我的代码使用端口=587 上的 TLS 连接到 smtp.google.com（SSL 应该是端口 465），但仍需要 EnableSsl=true

```
SmtpClient smtp = new SmtpClient();
smtp.Host = "smtp.gmail.com";
smtp.Port = 587;
smtp.EnableSsl = true;
smtp.UseDefaultCredentials = false;
NetworkCredential credentials = new NetworkCredential();
credentials.UserName = "INSERT EMAIL";
credentials.Password = "INSERT PASSWORD";
smtp.Credentials = credentials;

MailAddress addressFrom = new MailAddress(credentials.UserName);
MailAddress addressTo = new MailAddress("INSERT RECIPIENT");
MailMessage msg = new MailMessage(addressFrom, addressTo);
msg.Subject = "SUBJECT"
msg.Body = "BODY";

smtp.Send(msg); 
```

请注意您的 G SUITE 帐户的这些重要先决条件

*   确保您使用的用户名已通过首次登录时出现的 CAPTCHA 字词验证测试。
*   确保该帐户具有安全密码 - [https://support.google.com/accounts/answer/32040](https://support.google.com/accounts/answer/32040)
*   确保为所需帐户启用了不太安全的应用程序 - [https://support.google.com/a/answer/6260879](https://support.google.com/a/answer/6260879)

# c# - 为什么这个 WSDL 文件在 VS2008 中会生成一个空的服务代理？

> ID：757990
> 
> 赞同：2
> 
> 时间：2009-04-16T20:48:48.110
> 
> 标签：c#, web-services, wsdl

为什么[这个 WSDL 文件](http://services.fliqz.com/searchservice/20071001/service.svc?wsdl)在 VS2008 中会生成一个空的服务代理？

如果查看生成的 Reference.cs 文件，它是空的。有任何想法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2011-06-27T13:06:26.190

右键单击 service reference ， cofigure ，取消选中“Reuse types in referenced assembles”，然后单击 OK。尝试更新服务参考。这对我有用！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T21:19:35.137

你读过你的错误列表吗？我得到以下信息：

```
Custom tool warning: There was a validation error on a schema generated during export:
    Source: 
    Line: 144 Column: 12
   Validation Error: Wildcard '##any' allows element 'http://search.yahoo.com/mrss:text', and causes the content model to become ambiguous. A content model must be formed such that during validation of an element information item sequence, the particle contained directly, indirectly or implicitly therein with which to attempt to validate each item in the sequence in turn can be uniquely determined without examining the content or attributes of that item, and without any information about the items in the remainder of the sequence.       

Custom tool warning: Cannot import wsdl:portType
Detail: An exception was thrown while running a WSDL import extension: System.ServiceModel.Description.XmlSerializerMessageContractImporter
Error: Cannot import invalid schemas. Compilation on the XmlSchemaSet failed.
XPath to Error Source: //wsdl:definitions[@targetNamespace='http://fliqz.com/services/search/20071001']/wsdl:portType[@name='IVideoSearchService']

Custom tool warning: Cannot import wsdl:binding
Detail: There was an error importing a wsdl:portType that the wsdl:binding is dependent on.
XPath to wsdl:portType: //wsdl:definitions[@targetNamespace='http://fliqz.com/services/search/20071001']/wsdl:portType[@name='IVideoSearchService']
XPath to Error Source: //wsdl:definitions[@targetNamespace='http://tempuri.org/']/wsdl:binding[@name='basicHttpBinding_IVideoSearchService_20071001']

Custom tool warning: Cannot import wsdl:port
Detail: There was an error importing a wsdl:binding that the wsdl:port is dependent on.
XPath to wsdl:binding: //wsdl:definitions[@targetNamespace='http://tempuri.org/']/wsdl:binding[@name='basicHttpBinding_IVideoSearchService_20071001']
XPath to Error Source: //wsdl:definitions[@targetNamespace='http://tempuri.org/']/wsdl:service[@name='VideoSearchService']/wsdl:port[@name='basicHttpBinding_IVideoSearchService_20071001']

Custom tool error: Failed to generate code for the service reference 'ServiceReference1'.  Please check other error and warning messages for details. 
```

**编辑：**我做了一些挖掘，我发现了以下链接：

*   [MSDN 问题](http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/409d7bb0-3da0-4d66-bb8b-30f7204a6c9d)
*   [博客条目](http://blogs.msdn.com/richardt/archive/2005/03/01/382208.aspx)

我尝试按照 ScottAnderson 在第一个链接中的说明进行操作，但无法使用它们生成客户端代理。也许你可以有更好的运气。

看起来这不起作用的*原因*是因为 Fliqz 使用 XmlSerializer 而不是 DataContract/MessageContract 作为其合同定义，并且 WCF 不想很好地使用它们并生成不适当的 WSDL。如果您可以控制原始合同，您可能会解决问题并继续前进；不幸的是，你可能完全不走运。

如果您可以获取 ServiceContract 接口及其公开的类型，您也许可以手动生成自己的客户端。从我在那里看到的一些类名来看，Fliqz 似乎在他们的合同中暴露了内部对象，所以我怀疑你是否可以，你知道，打电话给他们并要求他们提供一个你可以引用的 .dll。

您可以尝试通过分析 WSDL 和 XSD 自己写出接口和数据/消息协定类型。不过，看起来这将是很多工作。

对不起，我帮不上什么忙。这似乎是 Fliqz 糟糕的 WCF 遗留支持和糟糕的架构/设计的结合。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T20:56:07.377

尝试将其添加为 .NET 2.0 Web 参考。

转到添加服务参考，然后单击“高级”按钮。然后，您可以选择将其添加为 .NET 2.0 Web 参考。我这样做了，并让它工作。我无法通过标准的“添加服务参考”

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T21:11:52.423

我在您的 WSDL 中看不到任何 <wsdl:portType> 元素——这可能是问题所在。

此外，您是从实时 URL 还是磁盘上的某些文件创建服务？如果您使用的是“磁盘上”文件：您是否还获得了此行中引用的“wsdl0”文件：

`<wsdl:import namespace="http://fliqz.com/services/search/20071001" location="http://services.fliqz.com/LegacyServices/Services/search/R20071001/service.svc?wsdl=wsdl0"/>`

马克****************