# StackOverflow 问答 000220000-000220999

# global-variables - 您将程序范围变量放在 UI 驱动的应用程序中的什么位置？

> ID：220010
> 
> 赞同：1
> 
> 时间：2008-10-20T21:27:46.243
> 
> 标签：global-variables, application-design

好的，所以我知道全局变量被认为是不好的，并且单例模式被过度使用了。我在很多地方读到过，一个类应该只执行一项任务，并且只包含那些允许它完成这项任务的变量。然而，在处理我的最新项目时，我实际上在编写任何代码之前考虑了这些规则，并注意到我倾向于在程序的一开始就破坏它们。

我目前正在开发基于 MFC 对话框的应用程序，但这个问题可以应用于任何 UI 驱动的应用程序。我有单独的类来处理状态机、文件读/写和硬件接口。所有这些对象都需要某种类型的 UI 控件或属性显示/编辑。在 MFC 对话框应用程序中，对话框就是程序，所以它必须存在，直到程序关闭。我通常只是将对象放在应用程序的主对话框类中，并让对话框类具有双重职责；作为主 UI 和应用程序中所有其他对象的主页。在其他应用程序中，我在全局范围内创建了这些对象，并从需要它们的任何地方引用它们。这两种方式似乎都不正确。第一个选项打破了一个类，一个任务的规则，第二个依赖全局变量并创建隐藏的依赖项。我可以建立某种类型的依赖注入，但是我要注入的所有这些变量会驻留在哪里？

我只是想知道其他人如何在不违反规则的情况下组织他们的程序？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-23T18:32:14.800

我发现将单例存储为 MFC 对话框应用程序的主对话框类的公共数据属性对于快速而肮脏的程序来说是可以的。然而，随着程序变得越来越大、越来越复杂，事情开始变得杂乱无章。

在对话框类中存储单例需要重构的点可能是当您开始传递指向对话框的指针时，以便其他类可以访问它包含的单例。

单例可以移动到全局命名空间中。这仍然有点不整洁，尤其是当它们数量很多时。由于您必须在头文件中为每个外部编写一个单独的外部，然后在某个地方定义每个外部，因此您很快就会得到一个看起来很像老式 C 程序的东西。

一个巧妙的做法是利用框架已经为您定义的单例。应用程序对象始终称为 theApp，CWinApp 的一个特化。如果你把你的单例作为这个的公共数据成员，那么任何代码都可以很容易地访问它们。

假设您将应用程序称为“求解器”。对话应用程序创建向导将创建一个类 CsolverApp。现在假设您有一个名为“theData”的单例，它是“cData”类的一个实例。

将您的单身人士放在 theApp 中

```
class CsolverApp : public CWinApp
{
public:

cData theData;

… 
```

现在从代码中的任何位置访问它

```
#include “solver.h”

theApp.theData.somepublicmethod(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-25T00:01:04.403

从 MVC（模型 - 视图 - 控制器）的角度来看这一点确实很有意义。（MFC 的命名是对 MVC 的敬意，这是微软的另一个恶作剧；在 MFC 中管理“真正的”MVC 中必需的抽象类型既困难又不直观（但绝不不可能）。）

具体来说，听起来您已经思考了 MVC 设计的基础；您拥有执行底层业务逻辑工作的类（模型），并且您知道它们应该与 UI 组件（视图）分开。现在出现的问题是 MVC 三位一体的第三部分；控制器。

MFC 显然故意混淆了 MVC 过程，让您从 Dialog 开始，从而使这些东西变得困难。在您的实例中，MFC 开始使用的对话框应该是控制器，而不是视图。您的对话框（控制器）正在为您做的是管理您的 UI 组件（视图）并允许它们与您的“工作”类（模型）进行交互。让这再次变得困难的是，您的 UI 组件要可见，很可能需要附加到您的 Dialog 才能可见。

为了正确处理这类事情，您实际上必须基本上将您的 Controller 实现为从 Dialog 实例化的高级对象；您的 Dialog 是初始控制流进入的地方，您的 Controller 获取控制流，从那里，它应该将 Dialog 视为另一个 UI 组件（尽管具有特殊状态）。

这使您可以拥有适当的封装级别；您的控制器调用您的业务逻辑（模型）类，它们可以相互通信或与控制器通信；它们被控制器从视图中分离出来，而不是嵌入到 UI 组件中，并且（可能）采用“简单的方法”对 UI 元素进行过度特权访问（“嗯，我需要这个对象从用户；我可以重构，但只是抛出一个对话框会容易得多，因为我有顶级窗口句柄......“）。

一旦您的 Controller 对象成为所有业务逻辑对象的所在地，事情就变得容易了；您可以使用 Controller 为需要其他对象的任何对象提供跨对象访问。考虑哪些类需要单例，并谨慎使用它们。需要争用管理的资源（例如硬件资源）是“自然单例”的绝佳示例；适合单例方法的东西。您也可以选择让您的 Controller 成为单例；取决于访问它的要求。具体来说，在您的依赖注入场景中，控制器是您实例化对象和管理依赖关系的地方。

这是基本的 MVC 方法；但是，就像我说的，由于 MFC 的基本设计，MFC 使它异常困难和不直观。由于 MFC，在最初对 MVC 产生了**非常负面的印象****之后**，我对 MVC 有了更多的了解；如果可以的话，我建议您研究一下其他语言中的 MVC 实现是什么样的。

 **祝你好运！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-20T21:41:41.300

如果我对您的理解正确，听起来您的对话对象的生命周期太长了。与其在程序运行期间维护对话框，不如考虑在需要时创建和销毁它们。

此外，全局变量（或单例）是可以的，只要变量所代表的东西确实是在程序的生命周期内持续存在的全局事物，而不仅仅是持续时间较短的对象的占位符。为简单起见将全局变量用于错误的事情最终会回来咬你，即使全局变量存储在主对话框中。

# asp.net-mvc - 如何处理 ASP.NET MVC 表单中的复选框？

> ID：220020
> 
> 赞同：246
> 
> 时间：2008-10-20T21:30:10.607
> 
> 标签：asp.net-mvc, forms, checkbox

## 警告：这个问题已经超过九年了！

您最好的选择是搜索较新的问题，或者搜索下面的答案以查找您的特定 MVC 版本，因为这里的许多答案现在已经过时了。

如果您确实找到了适用于您的版本的答案，请确保该答案包含您正在使用的 MVC 版本。
[[（原来的问题从下面开始）]]

* * *

这对我来说似乎有点奇怪，但据我所知，这就是你的做法。

我有一组对象，我希望用户选择其中一个或多个。这对我说“带有复选框的表单”。我的对象没有任何“选择”的概念（它们是通过反序列化 wcf 调用形成的基本 POCO）。因此，我执行以下操作：

```
public class SampleObject{
  public Guid Id {get;set;}
  public string Name {get;set;}
} 
```

在视图中：

```
<%
    using (Html.BeginForm())
    {
%>
  <%foreach (var o in ViewData.Model) {%>
    <%=Html.CheckBox(o.Id)%>&nbsp;<%= o.Name %>
  <%}%>
  <input type="submit" value="Submit" />
<%}%> 
```

而且，在控制器中，这是我可以看到找出用户检查了哪些对象的唯一方法：

```
public ActionResult ThisLooksWeird(FormCollection result)
{
  var winnars = from x in result.AllKeys
          where result[x] != "false"
          select x;
  // yadda
} 
```

首先它很奇怪，其次，对于用户检查的那些项目，FormCollection 将其值列为“真假”而不仅仅是真。

显然，我错过了一些东西。我认为这是基于这样的想法构建的，即在 html 表单中作用于集合中的对象是使用`UpdateModel()`或通过 ModelBinder 更新的。

但是我的对象不是为此设置的；这是否意味着这是唯一的方法？还有另一种方法吗？

* * *

## 回答 #1

> 赞同：262
> 
> 时间：2008-10-20T21:49:11.987

Html.CheckBox 正在做一些奇怪的事情 - 如果您在结果页面上查看源代码，您会看到`<input type="hidden" />`每个复选框旁边都生成了一个，它解释了您为每个表单元素看到的“真假”值。

试试这个，它肯定适用于 ASP.NET MVC Beta，因为我刚刚尝试过。

把它放在视图中，而不是使用 Html.CheckBox()：

```
<% using (Html.BeginForm("ShowData", "Home")) {  %>
  <% foreach (var o in ViewData.Model) { %>
    <input type="checkbox" name="selectedObjects" value="<%=o.Id%>">
    <%= o.Name %>
  <%}%>
  <input type="submit" value="Submit" />
<%}%> 
```

您的复选框都称为`selectedObjects`，`value`每个复选框的 是相应对象的 GUID。

然后发布到以下控制器操作（或类似的操作，而不是 Response.Write()）

```
public ActionResult ShowData(Guid[] selectedObjects) {
    foreach (Guid guid in selectedObjects) {
        Response.Write(guid.ToString());
    }
    Response.End();
    return (new EmptyResult());
} 
```

这个例子将只写你选中的框的 GUID；ASP.NET MVC 将所选复选框的 GUID 值映射到您的`Guid[] selectedObjects`参数中，甚至将 Request.Form 集合中的字符串解析为实例化的 GUID 对象，我认为这很不错。

* * *

## 回答 #2

> 赞同：95
> 
> 时间：2009-01-12T15:55:40.237

HtmlHelper 添加了一个隐藏的输入来通知控制器 Unchecked 状态。所以要有正确的检查状态：

```
bool bChecked = form[key].Contains("true"); 
```

* * *

## 回答 #3

> 赞同：54
> 
> 时间：2009-01-26T09:29:49.207

如果您想知道为什么他们会在其中放置一个与复选框同名的隐藏字段，原因如下：

来自源代码的注释 MVCBetaSource\MVC\src\MvcFutures\Mvc\ **ButtonsAndLinkExtensions.cs**

> `<input type="hidden".../>`为复选框渲染一个附加信息。这解决了未在请求中发送未选中复选框的情况。发送隐藏的输入可以知道提交请求时该复选框已出现在页面上。

我想在幕后他们需要知道这一点才能绑定到控制器操作方法上的参数。然后你可以有一个我想的三态布尔值（绑定到一个可为空的 bool 参数）。我没有尝试过，但我希望这就是他们所做的。

* * *

## 回答 #4

> 赞同：49
> 
> 时间：2009-01-26T09:19:13.643

您还应该使用`<label for="checkbox1">Checkbox 1</label>`，因为人们可以单击标签文本以及复选框本身。它的样式也更容易，至少在 IE 中，当您通过页面控件进行选项卡时，它会突出显示。

```
<%= Html.CheckBox("cbNewColors", true) %><label for="cbNewColors">New colors</label> 
```

这不仅仅是“哦，我能做到”的事情。它显着增强了用户体验。即使不是所有用户都知道他们可以点击很多人会点击的标签。

* * *

## 回答 #5

> 赞同：27
> 
> 时间：2011-10-16T03:31:12.047

我很惊讶这些答案都没有为此使用内置的 MVC 功能。

[我在这里](http://shawnmclean.com/asp-net-mvc-multiple-check-boxes-in-an-array-or-list/)写了一篇关于这个的博客文章，它甚至实际上将标签链接到了复选框。我使用*EditorTemplate*文件夹以干净和模块化的方式完成此任务。

您最终会在 EditorTemplate 文件夹中得到一个新文件，如下所示：

```
@model SampleObject

@Html.CheckBoxFor(m => m.IsChecked)
@Html.HiddenFor(m => m.Id)
@Html.LabelFor(m => m.IsChecked, Model.Id) 
```

在您的实际视图中，无需循环，只需 1 行代码：

```
@Html.EditorFor(x => ViewData.Model) 
```

访问我的[博客文章](http://shawnmclean.com/asp-net-mvc-multiple-check-boxes-in-an-array-or-list/)了解更多详情。

* * *

## 回答 #6

> 赞同：25
> 
> 时间：2008-10-20T21:37:58.483

这就是我一直在做的事情。

看法：

```
 <input type="checkbox" name="applyChanges" /> 

```

控制器：

```
 var checkBox = Request.Form["applyChanges"];

if (checkBox == "on")
{
...
} 

```

我发现 Html.* 辅助方法在某些情况下不是很有用，而且我最好用普通的旧 HTML 来做。这是其中之一，另一个想到的是单选按钮。

编辑：这是在预览版 5 上，显然是版本之间的 YMMV。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2010-03-20T20:36:06.117

他们似乎选择只读取第一个值，所以当复选框被选中时这是“真”，而当只包含隐藏值时这是“假”。这很容易用这样的代码获取：

```
model.Property = collection["ElementId"].ToLower().StartsWith("true"); 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2010-06-04T15:24:48.990

@Dylan Beattie 很棒的发现！！！我非常感谢你。为了进一步扩展，这种技术也可以完美地与视图模型方法配合使用。MVC 太酷了，它很聪明，可以将 Guid 数组绑定到与绑定到 View 的 Model 对象同名的属性。例子：

视图模型：

```
public class SampleViewModel
{
    public IList<SampleObject> SampleObjectList { get; set; }
    public Guid[] SelectedObjectIds { get; set; }

    public class SampleObject
    {
        public Guid Id { get; set; }
        public string Name { get; set; }
    }
} 
```

看法：

```
<asp:Content ID="Content2" ContentPlaceHolderID="MainContent" runat="server">
<h2>Sample View</h2>
<table>
    <thead> 
        <tr>
            <th>Checked</th>
            <th>Object Name</th>
        </tr>
    </thead> 
<% using (Html.BeginForm()) %>
<%{%>                    
    <tbody>
        <% foreach (var item in Model.SampleObjectList)
           { %>
            <tr>
                <td><input type="checkbox" name="SelectedObjectIds" value="<%= item.Id%>" /></td>
                <td><%= Html.Encode(item.Name)%></td>
            </tr>
        <% } %>
    </tbody>
</table>
<input type="submit" value="Submit" />
<%}%> 
```

控制器：

```
 [AcceptVerbs(HttpVerbs.Get)]
    public ActionResult SampleView(Guid id)
    {
        //Object to pass any input objects to the View Model Builder 
        BuilderIO viewModelBuilderInput = new BuilderIO();

        //The View Model Builder is a conglomerate of repositories and methods used to Construct a View Model out of Business Objects
        SampleViewModel viewModel = sampleViewModelBuilder.Build(viewModelBuilderInput);

        return View("SampleView", viewModel);
    }

    [AcceptVerbs(HttpVerbs.Post)]
    public ActionResult SampleView(SampleViewModel viewModel)
    {
        // The array of Guids successfully bound to the SelectedObjectIds property of the View Model!
        return View();
    } 
```

任何熟悉 View Model 哲学的人都会很高兴，这就像一个冠军！

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2010-03-22T14:48:25.790

我还想指出，您可以为每个复选框命名一个不同的名称，并将该名称作为 actionresults 参数的一部分。

例子，

看法：

```
 <%= Html.CheckBox("Rs232CheckBox", false, new { @id = "rs232" })%>RS-232

 <%= Html.CheckBox("Rs422CheckBox", false, new { @id = "rs422" })%>RS-422 
```

控制器：

```
public ActionResults MyAction(bool Rs232CheckBox, bool Rs422CheckBox) {
    ...
} 
```

由于名称相同，因此视图中的值将传递给操作。

我知道这个解决方案不适合你的项目，但我想我会把这个想法扔在那里。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2010-06-21T19:41:28.580

```
<input type = "checkbox" name = "checkbox1" /> <label> Check to say hi.</label> 
```

从控制器：

```
 [AcceptVerbs(HttpVerbs.Post)]
    public ActionResult Index(FormCollection fc)
    {

         var s = fc["checkbox1"];

         if (s == "on")
         {
             string x = "Hi";
         }
    } 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2010-01-18T11:23:28.397

这个问题也在 1.0 版中发生。Html.Checkbox() 会导致添加另一个隐藏字段，其名称/ID 与原始复选框相同。当我尝试使用 document.GetElemtentsByName() 加载复选框数组时，您可以猜到事情是如何搞砸的。这很奇怪。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2012-05-22T21:32:21.343

据我所知，模型不想猜测checked = true还是false，我通过在提交表单之前使用jQuery在checkbox元素上设置一个value属性来解决这个问题：

```
 $('input[type="checkbox"]').each(function () {
       $(this).attr('value', $(this).is(':checked'));
 }); 
```

这样，您不需要隐藏元素来存储复选框的值。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2012-06-14T23:07:43.770

我知道这个问题是在 MVC3 还没有出来的时候写的，但是对于任何遇到这个问题并使用 MVC3 的人，你可能想要“正确”的方式来做到这一点。

虽然我认为做整个

```
Contains("true"); 
```

东西很棒而且很干净，适用于所有 MVC 版本，问题是它没有考虑文化（好像在布尔的情况下它真的很重要）。

至少在 MVC3 中，找出布尔值的“正确”方法是使用 ValueProvider。

```
var value = (bool)ValueProvider.GetValue("key").ConvertTo(typeof(bool)); 
```

当我编辑权限时，我在我的客户的一个站点中执行此操作：

```
var allPermissionsBase = Request.Params.AllKeys.Where(x => x.Contains("permission_")).ToList();
var allPermissions = new List<KeyValuePair<int, bool>>();

foreach (var key in allPermissionsBase)
{
     // Try to parse the key as int
     int keyAsInt;
     int.TryParse(key.Replace("permission_", ""), out keyAsInt);

     // Try to get the value as bool
     var value = (bool)ValueProvider.GetValue(key).ConvertTo(typeof(bool));
} 
```

现在，它的美妙之处在于您可以将它用于几乎任何简单的类型，甚至基于文化（想想钱、小数等）它是正确的。

ValueProvider 是在您形成如下操作时使用的：

```
public ActionResult UpdatePermissions(bool permission_1, bool permission_2) 
```

但是当您尝试动态构建这些列表并检查值时，您将永远不会在编译时知道 Id，因此您必须即时处理它们。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2012-01-05T16:10:31.090

最简单的方法是这样......

您设置名称和值。

`<input type="checkbox" name="selectedProducts" value="@item.ProductId" />@item.Name`

然后在提交时抓取复选框的值并保存在一个 int 数组中。然后是适当的 LinQ 函数。就是这样..

```
[HttpPost]
        public ActionResult Checkbox(int[] selectedObjects)
        {
            var selected = from x in selectedObjects
                           from y in db
                           where y.ObjectId == x
                           select y;                   

            return View(selected);
        } 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2014-03-11T17:05:00.417

与 nautic20 的答案相同，只需使用与 ViewModel 中字符串/整数/枚举的集合属性同名的 MVC 默认模型绑定复选框列表即可。这就对了。

但需要指出一个问题。在每个复选框组件中，您不应将“Id”放入其中，这会影响 MVC 模型绑定。

以下代码适用于模型绑定：

```
 <% foreach (var item in Model.SampleObjectList)
       { %>
        <tr>
            <td><input type="checkbox" name="SelectedObjectIds" value="<%= item.Id%>" /></td>
            <td><%= Html.Encode(item.Name)%></td>
        </tr>
 <% } %> 
```

以下代码不会绑定到模型（这里的区别是它为每个复选框分配了 id）

```
<% foreach (var item in Model.SampleObjectList)
       { %>
        <tr>
            <td><input type="checkbox" name="SelectedObjectIds" id="[some unique key]" value="<%= item.Id%>" /></td>
            <td><%= Html.Encode(item.Name)%></td>
        </tr>
<% } %> 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2010-10-22T16:07:08.947

这就是我在使用 Html.CheckBox(...

```
Replace("true,false","true").Split(',') 
```

选中 4 个框，未选中，未选中，选中它会变成 true，false，false，false，true，false 变成 true，false，false，true。正是我需要的

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2010-11-11T20:49:15.830

这样的事情怎么样？

```
bool isChecked = false;
if (Boolean.TryParse(Request.Form.GetValues(”chkHuman”)[0], out isChecked) == false)
    ModelState.AddModelError(”chkHuman”, “Nice try.”); 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2010-12-29T10:20:55.973

我的解决方案是：

```
<input type="checkbox"  id="IsNew-checkbox"  checked="checked" />     
<input type="hidden"  id="IsNew" name="IsNew" value="true"  />      
<script language="javascript" type="text/javascript" >     
  $('#IsNew-checkbox').click(function () {    
      if ($('#IsNew-checkbox').is(':checked')) {    
          $('#IsNew').val('true');    
      } else {    
          $('#IsNew').val('false');    
       }    
  });   
</script> 
```

您可以在这里找到更多信息：http: [//www.blog.mieten.pl/2010/12/asp-net-mvc-custom-checkbox-as-solution-of-string-was-not-recognized-as-a-有效布尔值/](http://www.blog.mieten.pl/2010/12/asp-net-mvc-custom-checkbox-as-solution-of-string-was-not-recognized-as-a-valid-boolean/)

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2011-04-20T22:25:36.203

使用复选框 HtmlHelper 时，我更喜欢将发布的复选框表单数据作为数组使用。我真的不知道为什么，我知道其他方法有效，但我想我只是更喜欢尽可能将逗号分隔的字符串视为一个数组。

因此，进行“检查”或真实测试将是：

```
//looking for [true],[false]
bool isChecked = form.GetValues(key).Contains("true"); 
```

进行错误检查将是：

```
//looking for [false],[false] or [false]
bool isNotChecked = !form.GetValues(key).Contains("true"); 
```

主要区别是使用`GetValues`as this 作为数组返回。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2011-08-10T15:38:26.103

只需在以下位置执行此操作`$(document).ready`：

```
$('input:hidden').each(function(el) {
    var that = $(this)[0];
    if(that.id.length < 1 ) {

        console.log(that.id);
        that.parentElement.removeChild(that);

    }
}); 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2013-04-17T08:15:22.103

我遇到了几乎相同的问题，但是我的控制器的返回值被其他值阻止了。

找到了一个简单的解决方案，但似乎有点粗糙。

尝试输入`Viewbag.`你的控制器，现在你给它起一个名字`Viewbag.Checkbool`

现在切换到视图并尝试此操作`@Viewbag.Checkbool`，您将从控制器中获取值。

我的控制器参数如下所示：

```
public ActionResult Anzeigen(int productid = 90, bool islive = true) 
```

我的复选框将像这样更新：

```
<input id="isLive" type="checkbox" checked="@ViewBag.Value" ONCLICK="window.location.href = '/MixCategory/Anzeigen?isLive=' + isLive.checked.toString()" /> 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2014-02-25T23:02:14.640

使用@mmacaulay ，我想出了这个布尔：

```
// MVC Work around for checkboxes.
bool active = (Request.Form["active"] == "on"); 
```

如果选中活动 = true

如果未选中 active = false

# vb.net - 如何配置 log4net 以使 log.IsDebugEnabled 为真？

> ID：220021
> 
> 赞同：31
> 
> 时间：2008-10-20T21:30:18.950
> 
> 标签：vb.net, debugging, configuration, log4net

我正在尝试在带有 Visual Studio 2005 的 ASP.NET 应用程序中使用 log4net。我已经声明了一个记录器的实例，如下所示：

```
Private Shared ReadOnly log As ILog = LogManager.GetLogger("") 
```

我正在尝试以下列方式使用它：

```
If log.IsDebugEnabled Then
   log.Debug("Integration Services Constructed")
End If 
```

这是我的配置：

```
<log4net>

    <root>
        <level value="DEBUG" />
        <appender-ref ref="RollingFileAppender" />
    </root>

    <appender name="RollingFileAppender" type="log4net.Appender.RollingFileAppender">
        <file value="..\\logs\\logfile.log"/>
        <appendToFile value="true"/>
        <rollingStyle value="Size"/>
        <maxSizeRollBackups value="10"/>
        <maximumFileSize value="1MB"/>
        <staticLogFileName value="true"/>
        <layout type="log4net.Layout.PatternLayout">
            <conversionPattern value="%date [%thread] %-5level %logger [%property{NDC}] - %message%newline"/>
        </layout>
        <filter type="log4net.Filter.LevelRangeFilter">
            <param name="LevelMin" value="DEBUG" />
            <param name="LevelMax" value="FATAL" />
        </filter>
    </appender>

</log4net> 
```

不幸的是，`log.IsDebugEnabled`总是假的。
如何配置 log4net 以便仅记录调试消息？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-10-20T21:33:20.723

在调用 LogManager.GetLogger("") 之前

你必须调用 log4net.Config.XmlConfigurator.Configure(); 在 ASP.NET 应用程序中，您可能希望将此调用放入 Application_Start

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-10-20T21:35:16.367

是的，按照安森说的去做。此外，如果您在类库中调用配置，您可以通过向您的类添加一个属性来做到这一点：

```
[assembly: XmlConfigurator(Watch = true)] 
```

如果您使用的是`log4net.config`文件，请改为使用它：

```
[assembly: log4net.Config.XmlConfigurator(ConfigFile = "log4net.config", Watch = true)] 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2012-12-02T16:17:01.747

如果您为 log4net 使用单独的配置文件，请执行以下操作：按照所有其他设置说明进行操作后，确保您在 Visual Studio 解决方案资源管理器中右键单击该文件，选择属性，展开“高级”选项组，设置将“复制到输出目录”值设置为“始终复制”。那会变魔术... :) 干杯！！

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2014-11-05T11:31:55.770

如果您在代码中而不是在配置文件中设置 log4net，您可以`log4net.Config.BasicConfigurator.Configure`在`GetLogger`.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-03-20T02:20:08.673

VB.NET -

```
<Assembly: log4net.Config.XmlConfigurator(Watch:=True)> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-02-10T11:20:15.190

在使用 log 之前在任何方法中使用它：

log4net.Config.XmlConfigurator.Configure();

在 App.Config 中，设置应为：

```
<root>
      <level value="ALL" />
      <appender-ref ref="AppenderName" />
    </root> 
```

# apache-flex - 如何让 FlexBuilder 将我的 MXML 文件识别为应用程序而不是组件？

> ID：220026
> 
> 赞同：0
> 
> 时间：2008-10-20T21:30:51.167
> 
> 标签：apache-flex, flexbuilder

我正在尝试将我用 Emacs 开发的 mxml 文件导入 FlexBuilder 中的一个新项目...我创建了一个项目并将我的所有 MXML 和 actionscript 文件手动添加到 FlexBuilder 中。

我现在不知道如何运行该应用程序。我认为问题在于 FlexBuilder 认为我所有的 mxml 文件都是组件，而实际上它们是应用程序......有没有办法改变这一点？

当我右键单击文件时，“设置为默认应用程序”和“运行应用程序”被禁用...

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T03:42:57.903

我通常似乎必须进入项目属性，单击“Flex 应用程序”并将 MXML 添加到该面板中，然后才能运行。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T08:18:25.523

您将拥有 1 个包含 < mx:Application > 标签的文件，因此 FlexBuilder 可能会为您提供右键单击 -> 运行应用程序选项。

或者您还可以做什么，转到“flex 项目-> 属性-> Flex 应用程序” 您可以在此处使用“添加”按钮提及您的应用程序

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-16T09:50:31.120

关于 ActionScript 项目
，您可以在内部包中拥有可运行的应用程序。
只需进入 .actionScriptProperties
并将应用程序添加到应用程序标签：

```
<applications> 
<application path="com/example/games/game1/Main.as"/> 
<application path="com/example/games/game2/Main.as"/> 
</applications> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-20T21:58:44.043

确保 MXML 文件位于主源文件夹中。您不能在辅助源目录或主源目录的子目录中拥有可运行的应用程序。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T02:55:14.863

您还必须确保 mxml 文件的根节点是应用程序或模块。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-08-06T16:35:51.810

在您喜欢的文本编辑器中打开您的**.actionScriptProperties文件**

查找**应用程序**部分并添加**REPLACE_WITH_REAL_NAME.mxml**

```
 <applications>
    <application path="EnvioManualExtractos.mxml"/>
    <application path="REPLACE_WITH_REAL_NAME.mxml"/>
  </applications> 
```

关闭项目，重新打开它并清理它并再次构建它

# asp.net - 最佳 ASP.NET ConfigSection 到 DB 架构

> ID：220031
> 
> 赞同：1
> 
> 时间：2008-10-20T21:32:14.843
> 
> 标签：asp.net, database-design, configuration

以前，用于部署 ASP.NET 应用程序的设置使用 KEY/VALUE 格式存储在 Web.config 配置部分下的多个配置文件中。出于各种原因，我们将这些“站点模块选项”移至数据库。

以下是我们目前正在考虑的两个选项：
1\. 一个单一的表，其中 applicationId、moduleId 和 key 作为主键，并带有一个 Value 字段。
**优点：**
- 这模仿了文件访问。
- 很容易选择整个部分缓存在哈希表/值对象中。
**缺点：**
- 更难更新，因为每个密钥都需要单独更新。
- 如果不是字符串，则必须强制转换每个值。

2\. 每个部分的单独表将存储过程、类等分开。
**优点：**
- 由于列和对象类型是类型化的，因​​此可以保证数据是一致的。
- 通过显式接口在一次访问数据库中完成更新。
**缺点：**
- 必须更改应用程序接口才能访问
- 每次发生更改时都必须更新对象、数据库表和存储过程。

这些听起来像是好主意还是我可能忽略了另一种方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T20:48:24.713

如果我理解你的建议是正确的。我会做第一种方法。它利用了您已经构建的内容。我将使用哈希表在可以为属性提供严格类型接口的包装类内部进行缓存。

例如：

```
/// <summary>
/// The time passwords expire, in days, if ExpirePasswords is on
/// </summary>
public int PasswordExpirationDays {
    get { return ParseUtils.ParseInt(this["PasswordExpirationDays"], PW_MAX_AGE);}
    set { this["PasswordExpirationDays"] = value.ToString(); }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T15:41:24.020

另一种选择是将类似的设置组合到它们自己的类中，然后使用 XML 序列化/反序列化在数据库中存储和检索这些设置类的实例。

除了您不必自己执行任何类型转换之外，这并没有特别提供超越键/值对的优势（这是作为序列化/反序列化过程的一部分在幕后完成的 - 所以它仍然会发生） . 我发现这种方法非常适合解决您所面临的配置问题。它干净，快速实施，非常容易扩展，并且非常容易测试。您不必花时间创建功能丰富的 API 来获取您的设置，尤其是在您已经将配置子类化的情况下。

同样在紧要关头，您可以将您的设置直接来自数据库表或文件系统，而无需更改您的序列化/反序列化代码（这在开发过程中非常好）。

最后，如果您使用的是 SQL Server（可能还有 Oracle，尽管我没有使用 Oracle 和 XML 的经验）并且您预先考虑了设置类的设计，您可以为您的序列化配置对象实例定义一个 XML 模式，这样您就可以使用 XQuery 快速获取配置设置的值，而无需完全反序列化。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-19T19:45:17.690

我们就是这样做的——[点击这里](http://blog.digitaltools.com/post/2009/02/25/Moving-AppSettings-to-a-Database-Table.aspx)

我们更关心的是不同的环境（Dev、Test、QA 和 Prod）对于同一个键有不同的值。现在我们在 WebEnvironment.Config 文件中只有 2 个键，它们永远不会被提升。第一个键是您所在的环境，第二个键是连接字符串。

该表被加载一次到字典中，然后我们可以在我们的代码中使用它，如下所示：

```
 cApp.AppSettings["MySetting"]; 
```

# c++ - 如何从 dbx 中获取尽可能多的信息

> ID：220040
> 
> 赞同：3
> 
> 时间：2008-10-20T21:37:16.567
> 
> 标签：c++, debugging, solaris, dbx

我每天在 Solaris10 上进行 C++ 开发的 TDD。它大大减少了我必须花费在使用调试器上的时间，但有时这是唯一的选择。

DBX 非常强大，但不是那么用户友好。请注意，我说的是控制台 DBX，而不是 DBX 的 SunStudio GUI）。

您可以为 dbx C++ 调试提供哪些最佳生产力提示？

PS。更改调试器不是一种选择。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-21T07:35:12.567

我已经为一些与 dbx 相关的站点添加了书签。它们在这里，没有特别的顺序，以防它们对您有用：

*   [为什么 dbx 找不到我的函数？](http://developers.sun.com/solaris/articles/dbxerr.html)
*   [Dbx 调试器的联机帮助](http://blogs.oracle.com/quenelle/resource/dbxhelp.html)
*   [Sun Studio：使用 dbx 调试多线程应用程序](http://technopark02.blogspot.com/2005/12/sun-studio-debugging-multi-threaded.html)
*   [gdb 与 dbx：命令映射和功能比较](https://blogs.oracle.com/quenelle/entry/dbx_versus_gdb)
*   [将调试信息导入 dbx](http://quenelle.org/unix/2005/importing-debug-information-into-dbx/)
*   [命令行 dbx：查看更多源代码](http://blogs.oracle.com/quenelle/entry/command_line_dbx_see_more)
*   [Sun Studio C++ - 您的 .dbxrc](http://forums.sun.com/thread.jspa?threadID=5070229&messageID=9258271)（注意：根据您的指针大小调整用于转换指针的整数类型）
*   [Sun Studio：使用 dbx 调查内存泄漏](http://technopark02.blogspot.com/2005/10/sun-studio-investigating-memory-leaks.html)
*   [Sun Studio：从正在运行的进程中收集内存分配/泄漏数据](http://technopark02.blogspot.com/2005/11/sun-studio-gathering-memory.html)

2012 年 7 月 19 日编辑：自从 Chris Quenelle 的博客移动后，我尝试修复几个链接。由于回程机器，某些文章仍然可以访问。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-31T05:54:47.877

dbx 的强大功能之一是内置的 ksh。您可以编写复杂的 shell 函数，以打印数据结构的自定义视图，或遵循特定路径中的指针。shell 是 pdksh 的旧变体，因此它不是最好的编程语言，但它比没有任何内置语言要好得多。命令行也提供了广泛的帮助。搜索帮助的一个技巧是在 dbx 命令 shell 中使用“vi $helpfile”。将原始帮助文件数据编辑到一个大文件中。您可以在 dbx 附带的默认加载的 dbxrc 文件中看到一些 shell 函数示例。通过查看 libumem 集成模块，您可以看到更复杂的示例。你可以在这里找到它：

[http://quenelle.org/sun%20tech/2007/using-dbx-and-libumem.html](http://quenelle.org/sun%20tech/2007/using-dbx-and-libumem.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T08:58:05.007

我也*必须*在工作中使用 dbx 并理解您的挫败感！

我发现了一些让我的生活更轻松的小窍门：

使用这样的内置命令系统：when stop { print *whatever* ; 显然，当*超出*范围
时不起作用，但我发现它足够有用。我还没有对“跟踪”设施 YMMV 感到高兴。

 *制作您自己的 .dbxrc 文件会使生活变得更加轻松，“路径图”功能也是如此。

最后，这只有在您已经知道的情况下才明显，但请尝试[Sun 的手册](http://docs.oracle.com/cd/E19422-01/819-3683/)。

写得不是特别好，但仍是必读之物。

# algorithm - 哪种排序算法最适用于大多数排序的数据？

> ID：220044
> 
> 赞同：184
> 
> 时间：2008-10-20T21:38:24.207
> 
> 标签：algorithm, sorting

哪种排序算法对大多数排序的数据最有效？

* * *

## 回答 #1

> 赞同：273
> 
> 时间：2008-10-20T21:41:23.967

基于观看[动画 gif](http://www.sorting-algorithms.com/)的高度科学的方法，我会说插入和冒泡排序是很好的选择。

* * *

## 回答 #2

> 赞同：121
> 
> 时间：2010-11-25T10:40:10.237

只有几项 => 插入排序

项目大多已​​经排序 => INSERTION SORT

担心最坏的情况=> HEAP SORT

对良好的平均情况结果感兴趣 => QUICKSORT

物品来自密集的宇宙 => BUCKET SORT

希望编写尽可能少的代码 => 插入排序

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2008-10-21T04:17:11.297

## 时间排序

[Timsort](http://svn.python.org/projects/python/trunk/Objects/listsort.txt)是“一种自适应的、稳定的、自然的归并排序”，具有“**在多种偏序数组上的超自然性能**（少于 lg(N!) 比较所需，并且少至 N-1）”。Python的内置`sort()`使用这个算法有一段时间了，显然效果不错。它专门用于检测和利用输入中的部分排序子序列，这些子序列通常出现在真实数据集中。在现实世界中，比较通常比交换列表中的项目要昂贵得多，因为通常只是交换指针，这通常使 timsort 成为一个很好的选择。但是，如果您知道您的比较总是非常便宜（例如，编写一个玩具程序来对 32 位整数进行排序），那么存在其他可能表现更好的算法。利用 timsort 最简单的方法当然是使用 Python，但由于 Python 是开源的，您也可以借用代码。或者，上面的描述包含足够的细节来编写您自己的实现。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2008-10-20T21:48:19.757

具有以下行为的插入排序：

1.  `k`对于slot中的每个元素`1..n`，首先检查是否`el[k] >= el[k-1]`. 如果是这样，请转到下一个元素。（显然跳过第一个元素。）
2.  如果不是，请在元素中使用二分搜索`1..k-1`来确定插入位置，然后将元素扫过。`k>T`（只有在某个阈值在哪里时，您才可以这样做`T`；如果阈值很小`k`，那就是矫枉过正了。）

此方法进行的比较次数最少。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-10-20T22:29:37.973

尝试内省排序。[http://en.wikipedia.org/wiki/Introsort](http://en.wikipedia.org/wiki/Introsort)

它是基于快速排序的，但它避免了快速排序对几乎排序列表的最坏情况行为。

诀窍是这种排序算法检测到快速排序进入最坏情况模式并切换到堆或合并排序的情况。通过一些非天真的分区方法检测接近排序的分区，并使用插入排序处理小分区。

**以更多代码和复杂性为代价，您可以获得所有主要排序算法中最好的。**而且您可以确保无论您的数据看起来如何，都不会遇到最坏的情况。

如果您是 C++ 程序员，请检查您的 std::sort 算法。它可能已经在内部使用内省排序。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-10-21T04:02:28.113

[Splaysort](http://www.cs.mu.oz.au/~alistair/splaysort.c)是一种基于[splay 树](http://en.wikipedia.org/wiki/Splay_tree)（一种自适应二叉树）的模糊排序方法。Splaysort 不仅适用于部分排序的数据，也适用于部分反向排序的数据，或者实际上任何具有任何类型预先存在顺序的数据。在一般情况下是 O(nlogn)，在数据以某种方式（正向、反向、风琴管等）排序的情况下是 O(n)。

与插入排序相比，它的最大优势在于，当数据根本没有排序时，它不会恢复为 O(n^2) 行为，因此您无需绝对确定数据在使用前已部分排序.

它的缺点是它需要的展开树结构的额外空间开销，以及构建和销毁展开树所需的时间。但是，根据您期望的数据大小和预排序数量，开销对于提高速度可能是值得的。

一篇[关于 splaysort](http://portal.acm.org/citation.cfm?id=230594)的论文发表在 Software--Practice & Experience 上。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2010-11-09T21:11:59.230

Dijkstra 的smoothsort 是对已排序数据的一种很好的排序。这是一个堆排序变体，在 O(n lg n) 最坏情况和 O(n) 最佳情况下运行。我[写了一个](http://www.keithschwarz.com/smoothsort)算法分析，以防你好奇它是如何工作的。

自然归并排序是另一个非常好的方法——它是一种自下而上的归并排序变体，它通过将输入视为多个不同排序范围的串联，然后使用合并算法将它们连接在一起。您重复此过程，直到对所有输入范围进行排序。如果数据已经排序并且 O(n lg n) 最坏情况，这将在 O(n) 时间内运行。它非常优雅，尽管在实践中它不如 Timsort 或 Smoothsort 等其他自适应排序。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-10-20T21:43:01.733

插入或外壳排序！

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2012-10-29T11:42:27.667

如果元素已经排序或者只有很少的元素，这将是插入排序的完美用例！

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-06-02T21:33:25.247

插入排序需要时间 O(n + 反转次数)。

反转是一对`(i, j)`这样`i < j && a[i] > a[j]`。也就是乱序对。

“几乎排序”的一种衡量标准是反转的数量——可以将“几乎排序的数据”表示具有很少反转的数据。如果知道反转次数是线性的（例如，您刚刚将 O(1) 个元素附加到排序列表中），则插入排序需要 O(n) 时间。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-10-20T22:00:40.513

正如其他人所说，小心天真的快速排序 - 它可以在排序或几乎排序的数据上具有 O(N^2) 性能。尽管如此，使用适当的算法选择枢轴（随机或三的中位数 - 请参阅为快速排序[选择一个枢轴](https://stackoverflow.com/questions/164163/choosing-a-pivot-for-quicksort)），快速排序仍然可以正常工作。

一般来说，选择诸如插入排序之类的算法的困难在于确定数据何时足够乱序，以便快速排序确实更快。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-10-21T03:23:24.277

我不会假装在这里拥有所有答案，因为我认为获得实际答案可能需要对算法进行编码并根据代表性数据样本对其进行分析。但是我整个晚上都在思考这个问题，这是我到目前为止发生的事情，以及一些关于什么地方最有效的猜测。

令 N 为项目总数，M 为无序数。

冒泡排序必须使类似 2*M+1 的东西通过所有 N 个项目。如果 M 非常小（0、1、2？），我认为这将很难被击败。

如果 M 很小（比如小于 log N），则插入排序将具有很好的平均性能。但是，除非有我没有看到的技巧，否则它的最坏情况下的性能会很差。（对吧？如果订单中的最后一项排在第一位，那么您必须插入每一项，据我所知，这会影响性能。）我猜有一个更可靠的排序算法可以解决这个问题案例，但我不知道它是什么。

如果 M 更大（比如等于或大于 log N），内省排序几乎肯定是最好的。

所有这一切的例外：如果您实际上提前知道哪些元素未排序，那么您最好的选择是将这些项目拉出，使用内省排序对它们进行排序，然后将两个排序列表合并为一个排序列表。如果您可以快速找出哪些项目出现故障，这也是一个很好的通用解决方案——但我无法找到一种简单的方法来做到这一点。

进一步的想法（一夜之间）：如果 M+1 < N/M，那么您可以扫描列表以查找已排序的连续 N/M 的运行，然后在任一方向展开该运行以查找出-订购物品。这最多需要 2N 次比较。然后，您可以对未排序的项目进行排序，并对两个列表进行排序合并。总比较应该小于 4N+M log2(M) 之类的东西，我认为这将击败任何非专业排序程序。（进一步思考：这比我想象的要棘手，但我仍然认为这是合理的。）

该问题的另一种解释是，可能有许多乱序项，但它们非常接近它们应该在列表中的位置。（想象一下从一个排序列表开始，然后将所有其他项目与它之后的项目交换。）在这种情况下，我认为冒泡排序表现得非常好——我认为通过的次数将与最不合适的项目成正比是。插入排序效果不佳，因为每个乱序项都会触发插入。我怀疑内省排序或类似的东西也会很好用。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-10-15T13:26:38.500

答案中用于此目的的排序算法的这个不错的集合似乎缺少[Gnome Sort](http://en.wikipedia.org/wiki/Gnome_sort)，这也是合适的，并且可能需要最少的实现工作。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-21T12:10:06.053

如果您需要排序算法、数据结构或任何与上述内容相关的特定实现，我可以向您推荐 CodePlex 上优秀的[“数据结构和算法”](http://www.codeplex.com/dsa)项目吗？

它将拥有您需要的一切，而无需重新发明轮子。

只是我的一小粒盐。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-20T21:44:33.930

插入排序是排序输入的最佳情况 O(n)。它非常接近大多数排序的输入（比快速排序更好）。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-21T12:59:40.620

冒泡排序（或者更安全的双向冒泡排序）可能是大多数排序列表的理想选择，尽管我敢打赌，调整后的梳状排序（初始间隙大小要小得多）在列表不存在时会更快一些t 完全排序。梳排序降级为冒泡排序。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2012-09-21T11:48:43.437

冒泡排序绝对是赢家 雷达上的下一个将是插入排序。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2012-08-16T19:52:14.770

好吧，这取决于用例。如果您知道更改了哪些元素，就我而言，删除和插入将是最好的情况。

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2008-10-20T21:49:36.290

*思考*尝试堆。我相信这是最一致的 O(n lg n) 排序。

* * *

## 回答 #20

> 赞同：-2
> 
> 时间：2008-10-20T21:44:12.730

远离 QuickSort - 它对预排序数据的效率非常低。插入排序通过移动尽可能少的值来很好地处理几乎排序的数据。

# php - 解析数据馈送

> ID：220051
> 
> 赞同：3
> 
> 时间：2008-10-20T21:40:42.643
> 
> 标签：php, database, parsing, explode, datafeed

我不是最擅长 PHP，如果有人能提供帮助，我将不胜感激。基本上我需要解析数据馈送的每一行，并获取每个“|”之间的每一位信息 - 然后我可以将它添加到数据库中。我想我可以通过使用explode从“|”之间获取信息，但是我需要一些帮助来将文本文件中的每一行解析为单数。事实上，为了让它更简单，我只需要它使用变量的每一行，我将使用 textarea 和表单将内容提交给变量。任何帮助将不胜感激！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-20T21:49:08.040

您可以将文件读入行数组并使用以下方法进行所有拆分：

```
$lines = file("filename");
foreach($lines as $line) {
    $parts = explode("|", $line);
    // do the database inserts here
} 
```

如果您已经按照您所说的那样将所有文本包含在变量中（例如，使用类似 file_get_contents() 的内容），您可以先在 \n​​ 上展开，然后执行与上述相同的 foreach 语句。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T21:51:19.643

如果您正在阅读 textarea 帖子，您可以使用explode 函数使用换行符作为分隔符，将变量中的每个“行”作为数组的新元素，然后您可以对数组元素进行explode。

IE

```
$sometext = "balh | balh blah| more blah \n extra balh |some blah |this blah";

$lines = explode("\n", $sometext);
foreach($lines as $oneLine)
{
    $lineElements[] = explode("|", $oneLine);
} 
```

那么你有一个二维数组你的元素。

如果您正在读取文件，则可以简单地使用此处记录的文件函数：

[http://us2.php.net/manual/en/function.file.php](http://us2.php.net/manual/en/function.file.php)

将文件的每一行作为数组的元素。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-06-06T12:42:39.457

有一个现成的 PHP 解析库，可以自动检测 CSV 格式。

例子：

```
$reader = new Dfp_Datafeed_File_Reader();
$reader->setLocation('test.csv');

foreach ($reader AS $record) {
    print_r($record);
} 
```

可以在这里下载[，](http://code.google.com/p/datafeed/wiki/ExampleUsage)[这里](https://github.com/henryhayes/dfp)有一些文档。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-20T21:50:02.233

如果文件很小，您可以使用[file()](http://www.php.net/file)将其读入数组，每个元素一行。

如果失败，请使用[fgets()循环读取文件](http://www.php.net/fgets)

```
$handle = fopen("/tmp/inputfile.txt", "r");
while (!feof($handle)) {
   $buffer = fgets($handle, 4096);
   echo $buffer;
}
fclose($handle); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-20T21:52:33.850

您可以使用 explode 来获得两者：

```
$myFile = "File.txt";
$fh = fopen($myFile, 'r');
$data = fread($fh);
fclose($fh);
$newLines = explode("\n",$data);

foreach($newLines as $s)
{
  $parsed = explode("|",$s);
  foreach($parsed as $item)
  {
    // do your db load here
  }
} 
```

# amazon-web-services - 部署到 Amazon EC2

> ID：220052
> 
> 赞同：8
> 
> 时间：2008-10-20T21:40:48.837
> 
> 标签：amazon-web-services, amazon-ec2, cloud

有没有人有将应用程序部署到 Amazon EC2 的丰富经验？我正在考虑将来这样做，并想知道与共享托管和专用服务器托管相比人们的体验。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-20T23:02:51.057

到现在为止还挺好。一次能够打开 5/10/50/100 多台机器真是太棒了。能够将它们关闭并忘记它们会更好。您需要改变关于如何存储持久数据的心态，但一旦掌握了天空就是极限。

性能方面，小实例很慢。它们适用于负载平衡器和提供静态内容等，但如果您正在做任何处理器密集型的事情，您至少需要一个 m1.medium 实例。

这一切都很新，所以还没有很多工具可以提供帮助。我正在使用[Puppet](http://reductivelabs.com/trac/puppet/)来配置我的主机，并且我有一组用于启动集群的 PHP 脚本。我使用 LDAP 作为主机库存数据库。

如果您没有构建自己的需求/冲动，请参阅[Rightscale](http://rightscale.com/)，了解一些用于部署/增长应用程序的非常棒的工具。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-30T15:04:19.827

一种方法是使用 VMWare 映像在本地完全按照您的需要设置您的实例，然后将其转换为 AMI。例如，使用[这个脚本](http://thewebfellas.com/blog/2008/9/1/creating-an-new-ec2-ami-from-within-vmware-or-from-vmdk-files)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T06:51:07.903

我有一个图像，其中包含我的完整堆栈和一个脚本，可以自动将战争（java）从 S3 存储桶部署到本地文件系统。

当图像启动时，rc2.local 会运行此脚本以在启动 tomcat 之前获取最新的战争。这对我很有效

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-15T23:06:01.863

成本是我最初使用 EC2 忽略的一个很大的因素。最便宜的小型实例每个实例小时的成本为 10c，如果您一直保持运行，则大约为 70 美元/月。这比最便宜的托管解决方案报价多一点。

当然，使用 EC2，您可以选择您的操作系统并安装您喜欢的任何软件，如果您需要大量服务器，它绝对比专用托管更具成本效益。

我读过一个混合模型，人们使用专用服务器处理他们的常规工作负载，但在需求高峰时添加额外的 EC2 实例。

# version-control - MSBuild -- 使用 .csproj 文件还是自己创建？

> ID：220075
> 
> 赞同：21
> 
> 时间：2008-10-20T21:49:37.663
> 
> 标签：version-control, msbuild, continuous-integration, cruisecontrol.net, mbunit

好的，所以我欣然承认在持续集成方面我是新手。

话虽如此，我正在尝试设置一个 CC.NET 环境来教育自己，但我无法找到设置自动构建部分所需的信息。

据我了解，在 C# 中，由 VS 2005 和转发生成的 .csproj 文件*是*有效的 MSBuild 文件。也就是说，我已经能够使用 .csproj 文件将 MSBuild 任务集成到 CC.NET 中，但是我对此有一些问题：

1.  这里发生了很多事情，我不确定我是否真的需要在自动构建环境中。
2.  我没有创建这个文件。我不明白，这让我害怕。（[巧合编程](http://www.pragprog.com/the-pragmatic-programmer/extracts/coincidence)）
3.  大多数正在发生的事情似乎都是通过抽象的`$(MSBuildToolsPath)\Microsoft.CSharp.targets`
4.  作为 1、2 和 3 的结果，修改文件以包含 MbUnit 之类的内容似乎很复杂，而且比它需要的更困难。我唯一真正的选择是将它包含在该`AfterBuild`部分中，这对我来说似乎有点像 hack。

所以，有几个问题要问 CC.NET 人员、MSBuild 人员和 MbUnit 人员。

1.  在使用 MSBuild 时，是否建议使用 VS 生成的 .csproj 文件作为构建文件？还是我应该创建自己的？
2.  MbUnit 测试应该是 MSBuild 文件还是 CC.NET 文件的一部分？我的研究似乎表明它们属于 MSBuild 文件。如果是这种情况，除了 .csproj 文件之外，我是否要创建一个新的 MSBuild .proj 文件并将其签入 CVS？还是 MbUnit 任务成为我的 .csproj 文件的一部分？
3.  与问题 2 类似。如果我将 MbUnit 测试添加到 MSBuild 文件并最终使用 .csproj 文件，那么`Target Name="AfterBuild"`真的是添加该信息的部分吗？不应该有一个`Target Name="Test"`部分吗？使用 VS 生成的 .csproj 文件似乎阻止了第二种选择。

我知道那里有很多东西，但是我在网上找到的大部分内容都假定我对这些我没有的主题有一定程度的熟悉——除非我弄错了，否则这些东西的学习曲线是根本不是曲线，而是阶跃函数。:)

编辑 1：我更新了文本，使其更加简洁，并解决了我在答案中遇到的一些挥之不去的问题。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-21T21:39:04.643

我建议使用生成的 .csproj 文件——事实上，对于生产，我认为使用生成的 .sln 文件是个好主意。我发现您将通过使用与开发人员相同的解决方案文件来获得收益。

请注意，.sln 文件实际上不是有效的 msbuild 项目文件 - 当它们用作输入时，它们会被 msbuild 本身转换为 msbuild 项目。棘手！

出于学习目的，您可能需要记录 .csproj 的构建并逐步了解正在发生的事情。MSBuild 虽然比 nant 更具声明性，所以花点时间进行一些实验。

最后，我会将您的 .sln 或 .csproj 文件包装在一个带有 msbuild 任务的连续构建脚本项目中，以构建您的项目并一起运行您的单元测试。这样，开发人员不必在每次构建时都运行单元测试——但每次集成代码时，单元测试都会运行。是的，确保它们跑得快！任何需要一秒钟以上的东西都应该在计划的（每晚？）构建期间运行。如果它们花费的时间超过一秒钟，那么它们可能是使用单元测试框架编写的更少的单元测试和更多的集成测试。

**编辑：**我发现一些有用的附加信息 - 使用 MSBuild 3.5 将允许您从 .sln 文件中获取目标输出，而 MSBuild 2.0 中不返回此信息（尽管我认为它应该适用于 .csproj两个版本中的文件）。您可以使用输出（您构建的文件）作为单元测试框架的输入。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-20T23:05:44.127

将 csproj 文件单独放置（如您所说，您不了解它）。

创建您自己的 msbuild proj 文件并通过 msbuild 任务从您的主构建文件中调用 csproj（或 sln）。告诉您的 CI 服务器构建您的构建文件。

这种分离可以更轻松地添加您自己的前后任务（单元测试、冒烟测试 SQL 脚本、fxcop/其他静态分析等），并且不会破坏您的工作环境。这也意味着您可以按照自己的意愿（msbuild/ant 等）执行自定义目标。看看 codeplex 上的 MSBuildContrib 以获得额外的好处。

您的构建服务器上不需要visual stuido（除非您有部署项目，除非自从我上次查看以来这也已更改）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-21T08:14:48.743

创建您自己的项目文件（以 *proj 结尾的任何内容都被 MSBuild 视为项目文件）并从那里调用您的构建。像这样：

```
<MSBuild Projects="MySolution.sln" Targets="Clean; Rebuild" Properties="Configuration=$(BuildMode);"> 
```

请注意，msbuild 也可以在不进行任何更改的情况下构建 .sln（解决方案文件），这通常比拥有一堆 csproj 文件更容易......

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-21T19:16:52.760

我同时使用 NAnt 和 MSBuild。[NAnt 使用NAntContrib](http://nantcontrib.sourceforge.net/)进行了升级，因此我得到了[msbuild](http://nantcontrib.sourceforge.net/release/latest/help/tasks/msbuild.html)任务。我可能是临时设置，但到目前为止我还没有遇到重大问题。也就是说，我也没有创建新的 csproj 文件，因为我使用了与 VS2008 中相同的 csproj/sln。使用 msbuild 构建项目大大简化了遗留的 NAnt 脚本（我们使用了[csc](http://nant.sourceforge.net/release/0.85-rc1/help/tasks/csc.html)任务）。

笔记：

1.  如果您在项目中使用 Windows Workflow Foundation，那么在没有 msbuild 的情况下构建此类项目会遇到很大困难。
2.  不要在构建机器上安装 VS.NET。您可以使用[Wix](http://wix.sourceforge.net/)创建安装 msi。
3.  @Franci Penov：运行单元测试应该是每个构建的一部分。你真的要等到明天再找bug吗？附带说明：单元测试应该运行得非常快。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-20T22:33:32.100

我个人认为使用 .csproj 文件是可以的。如果滚动您自己的 MSBuild 项目，那么您不必添加自己的内容。

但是，无论您决定采用哪种路线，我仍然建议不要将 MbUnit 添加为构建步骤的一部分，而是将其作为 CC.Net 中的单独步骤添加。运行单元测试应该是日常 CI 周期的一部分；但是，它不应该是每个构建的一部分。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-20T22:23:13.587

可以使用 .csproj 作为 msbuild 的输入。您可以手动将任务添加到 csproj 中，在从 VS 编译期间将被忽略。但是，如果您要制作一些重要的东西，最好创建单独的 msbuild 脚本。并且可以从 csproj 文件中引用它们。您是否看过作为 TFS 一部分的 MS Build Server？它与 TFS 的 SourceControl 集成，可用于 CI。它的项目文件是 msbuild 脚本。

> 如果我确实使用了nAnt，是否需要在服务器上安装VS？您的意思是“MSBuild”吗？不，不一定要安装 VS 才能将 msbuild 与 csproj 文件一起使用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-20T23:28:01.523

好的，需要注意的事项很少。csproj 格式已从 VS2005 更改为 VS2008。此外，如果您使用 MSBuild，请记住您将无法构建 .vdproj（设置）文件；为此，您需要 devenv（VS 可执行文件）。也就是说，您始终可以创建一个调用 devenv 并为您构建它的 MSBuild 任务。

至于您的问题是构建自己的csproj文件还是使用VS2005创建的文件，我建议中间道路：[创建自己的项目模板](http://msdn.microsoft.com/en-us/library/s365byhx(VS.80).aspx)，满足您的需求，让VS负责其余的工作。

# security - 使用户身份验证脱机的最佳模型是什么？

> ID：220077
> 
> 赞同：5
> 
> 时间：2008-10-20T21:49:59.927
> 
> 标签：security, authentication, hash

我正在将身份验证构建到客户端-服务器应用程序中，我收到的一些反馈是我应该将哈希计算留给服务器（最初实现它是为了让客户端接收哈希，从客户端的输入密码，然后比较它们）。这似乎是有道理的，但我有一个问题 -**我如何验证离线用户**？

例如，如果我部署到无法访问 Internet 的移动设备，那么处理身份验证的最安全方法是什么？

我看到它的方式，我将**不得不允许客户端接收哈希+任何盐信息**，或者**使用单独的密码/密码**并允许客户端接收该密码的哈希+*盐*。

我倾向于后者，因为它似乎限制了攻击媒介——如果移动设备受到威胁，那么整个系统的安全性（例如，所有网络认证的部分）都会保持不变。

我最好的选择和考虑是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T18:06:35.600

如果您更详细地解释您的应用程序，我可能会发现我在这里不合适，但现在我将对您的用例和威胁模型做出一些假设。

我的理解是，您有一些敏感信息要在具有间歇性连接的移动设备和一些远程服务之间同步。该服务只有经过身份验证的用户才能访问，并且用户必须向移动设备验证自己的身份才能访问其信息副本，即使它处于脱机状态。

如果您想要强大的安全性，请使用基于密码的加密来加密移动设备的副本。

您可以使用用于对服务进行身份验证的相同密码，但总的来说，我会避免将相同的密钥用于不同的目的。更好的方法是为移动设备设置一个主加密密码，该密码对移动数据库以及用于向同步服务验证用户身份的“密码”进行加密。请注意，服务身份验证密码实际上可以是 SSL 客户端证书身份验证的私钥或基于字符的密码。

您必须评估只有一个密码的风险，但在许多情况下，我认为这为用户提供了便利，再加上一个强主密码提供的安全性，而不是两个弱但容易记住的密码是一个很好的平衡。

请注意，此方法将允许服务访问权限已被撤销的用户继续访问其本地副本，但没有任何新的更新。您可以包含一些由移动软件强制执行的时间限制的概念，但坚定的攻击者可以规避这一点。

如果您只需要玩具安全性，那么您在移动设备上存储正确哈希的建议就足够了，无论您对真实密码还是替代密码进行哈希处理都无关紧要，因为如果您使用正确的哈希，它应该采用它们数十亿年才能找到允许他们访问远程服务的密码冲突。

但是，假设攻击者可以看到密码哈希，是什么阻止他们查看同步数据呢？为什么他们需要恢复密码？加密移动数据库可以防止这种情况发生。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-20T22:49:54.580

我想这可能取决于您的问题域，但是对于安全的应用程序，由于缺乏信任，无法在客户端完成授权。在您说明在客户端完成哈希计算和比较的简单情况下，要获得访问权限，某人所要做的就是挂钩调试器，单步执行代码并找到完成比较的位置，然后将值替换为返回之前的堆栈（例如）。恭喜你，你被黑了。

我想了解更多关于您的特定应用程序在“离线”模式下想要启用哪些操作的信息，以及在我考虑启用部分功能离线之前重新连接设备后您的协调计划是什么。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T22:02:07.420

几分钟前我发布了一个类似的问题，经过更多思考，我可能找到了一种可以接受的方法，使用公钥/私钥。以下是我为我的应用概述的步骤：

1.  当用户离线时，他可以选择使用密码来保护离线时对应用程序的访问（可选加密以防止被盗）。

2.  上线后，客户端将为当前用户发送一个 id（它可能像一个哈希或唯一标识该用户的东西）。

3.  服务器发送使用该用户的公钥加密的授权令牌。

4.  客户端发回用他的私钥解密的令牌。

5.  服务器最终发送一个会话令牌以继续进一步通信（这最后一步可能是不必要的，也许可以使用已经建立的身份验证令牌？）。

我不是加密或安全方面的专家，但在我看来，这种方法非常安全，因为我能想到的入侵服务器的唯一方法是让攻击者拥有用户的私钥及其通行证短语。

在敏感数据的情况下，这可以通过加密来保护，正如我提到的那样，通过密码来验证用户身份，或者对数据本身进行加密，这样万一设备丢失，它就不会受到损害。

# language-agnostic - 什么是维护或衡量集合排序的最佳方法，以便我们可以选择最佳排序算法？

> ID：220084
> 
> 赞同：4
> 
> 时间：2008-10-20T21:51:45.973
> 
> 标签：language-agnostic, sorting, performance

受[这个问题的启发](https://stackoverflow.com/questions/220044/which-sort-algorithm-works-best-on-mostly-sorted-data)

如果我们提前知道集合的排序有多好，可以更好地选择使用哪种算法对集合进行排序。有没有一种方法可以衡量（或保持衡量）集合的排序程度？我们能否以这样一种方式做到这一点，即维护或衡量某物的排序程度的成本不会超过选择最佳排序算法所带来的好处？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-20T21:58:05.337

增强@Doug：

删除永远不会使列表*的*排序减少，因此您不必跟踪它们。

当插入发生时，与周围的元素进行比较以确定此插入是否有序。如果是，请不要增加计数器。如果否，则增加“未排序”计数器。

也许这是太多的惩罚（即每个插入两次比较）。你可以只做一个比较以获得更模糊的结果吗？或者我确实喜欢只计算插入的想法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T22:16:20.700

有内省排序正是这样做的，有点......

[http://ralphunden.net/content/tutorials/a-guide-to-introsort/](http://ralphunden.net/content/tutorials/a-guide-to-introsort/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-20T21:54:29.340

您可以使用抽样：检查列表中均匀分布的 N 个元素，看看有多少是按顺序排列的。（当然，这只适用于随机访问列表，但通常这是您排序的类型。）

也有一个小 N 的阈值。如果 N 很小（例如`10`），即使列表没有排序，插入排序也是好的。Java 在合并排序中对小 N 进行了优化。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-20T21:55:26.403

一种建议的解决方案：

保持自上次排序以来执行的操作（插入/删除）的数量。这个数字越高，集合可能越未排序。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-20T21:58:58.893

您可以测量数据的频率——如果从一个项目到另一个项目有很多大的变化，那么数据是高频率的，表明一个相当随机的分布。

如果变化较小，则数据频率较低 - 表示非随机分布。

您还可以使用过滤器测量总体趋势 - 是可测量的向下或向上的平均趋势 - 如果向下，您可能会考虑翻转整个数组或对“反转”数据使用良好的排序。

您可以使用其他测量方法，可能会给您带来洞察力 - 检查信号处理，看看您能收集到什么。

-亚当

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-20T21:57:52.250

如果您对集合*一无所知*，那么尝试检测其排序性所花费的任何时间都将远远超过选择最佳排序算法所节省的时间。

另一方面，如果您要对许多具有相似排序量的数据集进行排序，则可以测量第一个数据集，选择一种算法，然后将其用于所有后续数据集。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-20T22:22:59.780

好吧，首先检查集合是否按定义排序，这将始终为您节省大量时间 :) 在大多数情况下，不要费心扩展集合来测试它是否在其插入/删除操作期间排序，如果集合需要排序，使用按定义排序的集合。

如果您尝试扩展集合类以跟踪排序，只需保留一个单独的排序列表，其中包含指向集合中元素的指针......

最后，在 99.99% 的时间里，何必呢？只需使用快速排序。如果您的数据集足够小，以至于快速排序中 Big O 排序的常数部分将覆盖冒泡排序所节省的时间，那么排序将如此之快，您甚至不应该浪费时间问这个问题。

你真的告诉我你的问题是需要解决的排序的 0.01% 吗？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-01-20T05:36:34.800

这是一个很好的问题.. 我解决这个问题的方法是问：给定一个项目列表，从排序的列表中选择两个连续项目的可弹出性是什么。随着列表变得更加有序，概率将接近 100%。

计算这个概率比较简单：

```
int sorted = 0;
for (int i = 0; i < list_length; i++) {
    if (list[i+1] >= list[i]) {
       sorted++;
    }
}
sortedness = sorted/(list_length-1); 
```

我希望这有帮助！

# c# - 读/写“扩展”文件属性 (C#)

> ID：220097
> 
> 赞同：110
> 
> 时间：2008-10-20T21:56:10.663
> 
> 标签：c#, extended-properties

我试图找出如何读取/写入 C# 中的扩展文件属性，例如您可以在 Windows 资源管理器中看到的评论、比特率、访问日期、类别等。任何想法如何做到这一点？编辑：我将主要读/写视频文件（AVI/DIVX/...）

* * *

## 回答 #1

> 赞同：89
> 
> 时间：2010-01-19T19:16:18.817

对于那些不喜欢 VB 的人，这里是 c#：

请注意，您必须从“引用”对话框的 COM 选项卡中添加对*Microsoft Shell 控件和自动化的引用。*

```
public static void Main(string[] args)
{
    List<string> arrHeaders = new List<string>();

    Shell32.Shell shell = new Shell32.Shell();
    Shell32.Folder objFolder;

    objFolder = shell.NameSpace(@"C:\temp\testprop");

    for( int i = 0; i < short.MaxValue; i++ )
    {
        string header = objFolder.GetDetailsOf(null, i);
        if (String.IsNullOrEmpty(header))
            break;
        arrHeaders.Add(header);
    }

    foreach(Shell32.FolderItem2 item in objFolder.Items())
    {
        for (int i = 0; i < arrHeaders.Count; i++)
        {
            Console.WriteLine(
              $"{i}\t{arrHeaders[i]}: {objFolder.GetDetailsOf(item, i)}");
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2016-06-23T09:02:45.800

# 解决方案 2016

将以下 NuGet 包添加到您的项目中：

*   `Microsoft.WindowsAPICodePack-Shell`由微软
*   `Microsoft.WindowsAPICodePack-Core`由微软

### 读写属性

```
using Microsoft.WindowsAPICodePack.Shell;
using Microsoft.WindowsAPICodePack.Shell.PropertySystem;

string filePath = @"C:\temp\example.docx";
var file = ShellFile.FromFilePath(filePath);

// Read and Write:

string[] oldAuthors = file.Properties.System.Author.Value;
string oldTitle = file.Properties.System.Title.Value;

file.Properties.System.Author.Value = new string[] { "Author #1", "Author #2" };
file.Properties.System.Title.Value = "Example Title";

// Alternate way to Write:

ShellPropertyWriter propertyWriter =  file.Properties.GetPropertyWriter();
propertyWriter.WriteProperty(SystemProperties.System.Author, new string[] { "Author" });
propertyWriter.Close(); 
```

**重要的：**

该文件必须是由特定分配的软件创建的有效文件。每种文件类型都有特定的扩展文件属性，并非所有文件都是可写的。

如果您右键单击桌面上的文件并且无法编辑属性，那么您也无法在代码中对其进行编辑。

例子：

*   在桌面上创建txt文件，将其扩展名重命名为docx。您无法编辑其`Author`或`Title`属性。
*   用Word打开，编辑保存。现在你可以。

所以只要确保使用一些`try` `catch`

更多主题： [Microsoft Docs：实现属性处理程序](https://docs.microsoft.com/en-us/windows/win32/properties/building-property-handlers)

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2008-10-20T22:17:24.910

有一个 ID3 阅读器[的 CodeProject 文章](http://www.codeproject.com/KB/shell/shellid3tagreader.aspx)。还有一个[在 kixtart.org](http://www.kixtart.org/forums/ubbthreads.php?ubb=showflat&Number=160880&page=1)上的线程，其中包含有关其他属性的更多信息。基本上，您需要在*文件夹*外壳对象上[`GetDetailsOf()`调用](http://msdn.microsoft.com/en-us/library/bb787870(VS.85).aspx).*`shell32.dll`*

 ** * *

## 回答 #4

> 赞同：25
> 
> 时间：2008-11-28T12:28:23.303

VB.NET 中的此示例读取所有扩展属性：

```
Sub Main()
        Dim arrHeaders(35)

        Dim shell As New Shell32.Shell
        Dim objFolder As Shell32.Folder

        objFolder = shell.NameSpace("C:\tmp")

        For i = 0 To 34
            arrHeaders(i) = objFolder.GetDetailsOf(objFolder.Items, i)
        Next
        For Each strFileName In objfolder.Items
            For i = 0 To 34
                Console.WriteLine(i & vbTab & arrHeaders(i) & ": " & objfolder.GetDetailsOf(strFileName, i))
            Next
        Next

    End Sub 
```

您必须从“*引用*”对话框的*COM*选项卡中添加对*Microsoft Shell 控件和自动化的引用。*

 *** * *

## 回答 #5

> 赞同：8
> 
> 时间：2010-08-23T12:25:28.130

谢谢你们这个话题！当我想弄清楚 exe 的文件版本时，它帮助了我。但是，我需要自己弄清楚所谓的扩展属性的最后一点。

如果您在 Windows 资源管理器中打开 exe（或 dll）文件的属性，您将获得一个版本选项卡，以及该文件的扩展属性视图。我想访问其中一个值。

对此的解决方案是属性索引器 FolderItem.ExtendedProperty，如果您删除属性名称中的所有空格，您将获得该值。例如，文件版本转到 FileVersion，您就拥有了。

希望这对其他人有帮助，只是想我会将此信息添加到此线程中。干杯!

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2013-02-27T12:01:48.937

`GetDetailsOf()`方法 - 检索有关文件夹中项目的详细信息。例如，它的大小、类型或上次修改的时间。文件属性可能因`Windows-OS`版本而异。

```
List<string> arrHeaders = new List<string>();

 Shell shell = new ShellClass();
 Folder rFolder = shell.NameSpace(_rootPath);
 FolderItem rFiles = rFolder.ParseName(filename);

 for (int i = 0; i < short.MaxValue; i++)
 {
      string value = rFolder.GetDetailsOf(rFiles, i).Trim();
      arrHeaders.Add(value);
 } 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2017-10-09T13:49:13.777

[Jerker 的回答](https://stackoverflow.com/a/3547482/661933)要简单一些。这是适用[于 MS](https://msdn.microsoft.com/en-us/library/windows/desktop/bb774055(v=vs.85).aspx)的示例代码：

```
var folder = new Shell().NameSpace(folderPath);
foreach (FolderItem2 item in folder.Items())
{
    var company = item.ExtendedProperty("Company");
    var author = item.ExtendedProperty("Author");
    // Etc.
} 
```

对于那些不能静态引用 shell32 的人，你可以像这样动态调用它：

```
var shellAppType = Type.GetTypeFromProgID("Shell.Application");
dynamic shellApp = Activator.CreateInstance(shellAppType);
var folder = shellApp.NameSpace(folderPath);
foreach (var item in folder.Items())
{
    var company = item.ExtendedProperty("Company");
    var author = item.ExtendedProperty("Author");
    // Etc.
} 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2018-04-23T01:31:55.363

*   在查看了该线程和其他地方的许多解决方案之后，将以下代码放在一起。这只是为了读取一个属性。
*   我无法让 Shell32.FolderItem2.ExtendedProperty 函数工作，它应该接受一个字符串值并为该属性返回正确的值和类型......这对我来说总是空的，开发人员参考资源非常薄。
*   [WindowsApiCodePack](https://stackoverflow.com/questions/24081665/windows-api-code-pack-where-is-it)似乎已被微软抛弃，它为我们带来了下面的代码。

采用：

```
string propertyValue = GetExtendedFileProperty("c:\\temp\\FileNameYouWant.ext","PropertyYouWant"); 
```

1.  将返回您想要的扩展属性的值作为给定文件和属性名称的字符串。
2.  仅循环直到找到指定的属性 - 直到所有属性都像某些示例代码一样被发现
3.  将在 Windows server 2008 等 Windows 版本上工作，如果只是尝试正常创建 Shell32 对象，您将收到错误[“无法将类型为 'System.__ComObject' 的 COM 对象转换为接口类型 'Shell32.Shell'” 。](https://stackoverflow.com/questions/31403956/exception-when-using-shell32-to-get-file-extended-properties)

    ```
    public static string GetExtendedFileProperty(string filePath, string propertyName)
    {
        string value = string.Empty;
        string baseFolder = Path.GetDirectoryName(filePath);
        string fileName = Path.GetFileName(filePath);

        //Method to load and execute the Shell object for Windows server 8 environment otherwise you get "Unable to cast COM object of type 'System.__ComObject' to interface type 'Shell32.Shell'"
        Type shellAppType = Type.GetTypeFromProgID("Shell.Application");
        Object shell = Activator.CreateInstance(shellAppType);
        Shell32.Folder shellFolder = (Shell32.Folder)shellAppType.InvokeMember("NameSpace", System.Reflection.BindingFlags.InvokeMethod, null, shell, new object[] { baseFolder });

        //Parsename will find the specific file I'm looking for in the Shell32.Folder object
        Shell32.FolderItem folderitem = shellFolder.ParseName(fileName);
        if (folderitem != null)
        {
            for (int i = 0; i < short.MaxValue; i++)
            {
                //Get the property name for property index i
                string property = shellFolder.GetDetailsOf(null, i);

                //Will be empty when all possible properties has been looped through, break out of loop
                if (String.IsNullOrEmpty(property)) break;

                //Skip to next property if this is not the specified property
                if (property != propertyName) continue;    

                //Read value of property
                value = shellFolder.GetDetailsOf(folderitem, i);
            }
        }
        //returns string.Empty if no value was found for the specified property
        return value;
    } 
    ```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-20T22:42:05.250

我不确定您要为哪些类型的文件编写属性，但[taglib-sharp](http://github.com/mono/taglib-sharp)是一个优秀的开源标记库，它很好地封装了所有这些功能。它为大多数流行的媒体文件类型提供了大量内置支持，但还允许您对几乎任何文件进行更高级的标记。

**编辑：** 我已经更新了 taglib sharp 的链接。旧链接不再有效。

**编辑：**根据 kzu 的评论再次更新了链接。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-08-10T19:56:29.043

这是基于我在此页面上找到的内容以及[shell32 对象的帮助](http://answers.flyppdevportal.com/MVC/Post/Thread/4a17c71b-ed01-44bd-977a-c8ceb237c538?category=vbgeneral)的读取而不是写入扩展属性的解决方案。

需要明确的是，这是一个 hack。看起来此代码仍将在 Windows 10 上运行，但会遇到一些空属性。以前版本的 Windows 应使用：

```
 var i = 0;
        while (true)
        {
            ...
            if (String.IsNullOrEmpty(header)) break;
            ...
            i++; 
```

在 Windows 10 上，我们假设有大约 320 个属性要读取，并简单地跳过空条目：

```
 private Dictionary<string, string> GetExtendedProperties(string filePath)
    {
        var directory = Path.GetDirectoryName(filePath);
        var shell = new Shell32.Shell();
        var shellFolder = shell.NameSpace(directory);
        var fileName = Path.GetFileName(filePath);
        var folderitem = shellFolder.ParseName(fileName);
        var dictionary = new Dictionary<string, string>();
        var i = -1;
        while (++i < 320)
        {
            var header = shellFolder.GetDetailsOf(null, i);
            if (String.IsNullOrEmpty(header)) continue;
            var value = shellFolder.GetDetailsOf(folderitem, i);
            if (!dictionary.ContainsKey(header)) dictionary.Add(header, value);
            Console.WriteLine(header +": " + value);
        }
        Marshal.ReleaseComObject(shell);
        Marshal.ReleaseComObject(shellFolder);
        return dictionary;
    } 
```

如前所述，您需要引用 Com 程序集 Interop.Shell32。

如果您遇到 STA 相关异常，您将在此处找到解决方案：

[使用 Shell32 获取文件扩展属性时出现异常](https://stackoverflow.com/questions/31403956/exception-when-using-shell32-to-get-file-extended-properties)

我不知道这些属性名称在外部系统上会是什么样子，也找不到有关使用哪些可本地化常量来访问字典的信息。我还发现，并非“属性”对话框中的所有属性都出现在返回的字典中。

顺便说一句，这非常慢，并且 - 至少在 Windows 10 上 - 解析检索到的字符串中的日期将是一个挑战，因此使用这似乎是一个坏主意。

在 Windows 10 上，您绝对应该使用包含 SystemPhotoProperties、SystemMusicProperties 等的 Windows.Storage 库。 [https://docs.microsoft.com/en-us/windows/uwp/files/quickstart-getting-file-properties](https://docs.microsoft.com/en-us/windows/uwp/files/quickstart-getting-file-properties)

最后，我在那里发布**[了](https://stackoverflow.com/questions/19261078/getting-extended-file-properties-in-c-sharp-net)****一个使用 WindowsAPICodePack 的更好的解决方案**

# c# - 如何使用 C#（Windows 窗体）启用控件的双缓冲？

> ID：220100
> 
> 赞同：8
> 
> 时间：2008-10-20T21:57:53.047
> 
> 标签：c#, .net, winforms, doublebuffered, ownerdrawn

如何使用 C#（Windows 窗体）启用控件的双缓冲？

我有一个面板控件，我正在向其中绘制内容，还有一个所有者绘制的选项卡控件。两者都有闪烁，那么如何启用双缓冲？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-20T22:28:08.350

在控件的构造函数中，适当地设置 DoubleBuffered 属性和/或 ControlStyle。

例如，我有一个简单的 DoubleBufferedPanel，其构造函数如下：

```
this.DoubleBuffered = true;
this.SetStyle(ControlStyles.UserPaint | 
              ControlStyles.AllPaintingInWmPaint |
              ControlStyles.ResizeRedraw |
              ControlStyles.ContainerControl |
              ControlStyles.OptimizedDoubleBuffer |
              ControlStyles.SupportsTransparentBackColor
              , true); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-20T21:59:43.027

这里的一些信息：

[如何在表单上加倍缓冲 .NET 控件？](https://stackoverflow.com/questions/76993/how-to-double-buffer-net-controls-on-a-form)

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-10-21T09:17:48.790

使用继承自 System.Windows.Forms.Control 的 DoubleBuffered 属性。

```
System.Windows.Forms.Form myForm = new System.Windows.forms.Form();
myForm.DoubleBuffered = true; 
```

# java - 一个很好的网络数学Java库

> ID：220110
> 
> 赞同：14
> 
> 时间：2008-10-20T22:01:35.330
> 
> 标签：java, math, networking

我正在寻找一个面向网络数学并且已经过测试的 Java 库。没有什么特别花哨的东西，只是保存 ips 和子网，并执行诸如打印子网掩码或计算 IP 是否在给定子网内之类的事情。

我应该自己推出，还是已经有一个强大的库来解决这个问题？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-20T23:15:39.910

[org.apache.lenya.ac.IPRange](http://lenya.apache.org/apidocs/2.0/org/apache/lenya/ac/IPRange.html)似乎具有这些功能。

Apache Lenya 项目是一个开源内容管理系统。它使用 Apache 许可证，因此您可以仅重用您需要的代码。（但一如既往，请自己阅读[许可证](http://lenya.apache.org/index/license.html)；不要相信互联网上某些人的法律建议！:-)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-02-12T11:01:34.590

我们自己开发了一个 Java IPv4 算术库。在这里看到它：http: [//tufar.com/ipcalculator/](http://tufar.com/ipcalculator/) 它是在 BSD 许可下。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2018-01-11T22:23:39.900

[开源 IPAddress Java 库](https://seancfoley.github.io/IPAddress/)可以进行 IP 地址操作，例如与 ipv4/ipv6 的转换和子网检查。免责声明：我是项目经理。

它处理各种网络数学运算，例如屏蔽、按位或、设置前缀长度、将地址切换到前缀块、遍历子网、检查包含、替换地址段、反转地址、计算子网交集、从另一个子网中减去一个子网，以及其他。

下面是一些用于测试 ipv6 地址是否在给定子网中的示例代码：

```
 String ipv6 = "2001:db8:57AB:0000:0000:0000:0000:0001";
    String ipv6subnet = "2001:db8::/32";
    String ipv4 = "1.2.3.4";
    try {
        IPAddressString ipv6addrstr = new IPAddressString(ipv6);
        IPAddressString ipv6addrsubnetstr = new IPAddressString(ipv6subnet);
        IPAddressString ipv4addrstr = new IPAddressString(ipv4);

        IPAddress ipv6addr = ipv6addrstr.toAddress();
        IPAddress ipv6addrsubnet = ipv6addrsubnetstr.toAddress();
        IPAddress ipv4mappedaddr = ipv4addrstr.toAddress().toIPv6();

        System.out.println(ipv6addrsubnet + " contains " + ipv6addr + ": " + ipv6addrsubnet.contains(ipv6addr)); //
        System.out.println(ipv6addrsubnet + " contains " + ipv4mappedaddr + ": " + ipv6addrsubnet.contains(ipv4mappedaddr)); //

    } catch(AddressStringException e) {
        //e.getMessage has validation error
    } 
```

输出：

```
2001:db8::/32 contains 2001:db8:57ab::1 is true
2001:db8::/32 contains ::ffff:102:304 is false 
```

# performance - 有没有比谷歌分析更快的替代品？

> ID：220112
> 
> 赞同：35
> 
> 时间：2008-10-20T22:02:13.177
> 
> 标签：performance, google-analytics, analytics

我喜欢让我的网站非常轻便和快速，但我当然需要某种用户跟踪和分析。

似乎谷歌分析总是需要足够长的处理时间，我想用更快（和/或本地托管）的东西来代替它，也许功能更少。

我真的只关心这些指标：浏览器、操作系统、引荐来源网址以及在给定日期或星期内每页的点击次数。

有没有人有什么好的建议，或者谷歌分析真的是最好的选择吗？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2010-03-07T18:38:34.457

您应该尝试异步 Google Analytics。它在后台加载 GA，因此页面上的其余内容不会被阻止渲染：

[http://code.google.com/apis/analytics/docs/tracking/asyncTracking.html](http://code.google.com/apis/analytics/docs/tracking/asyncTracking.html)

此外，自从您第一次提出这个问题以来，Google 已经升级了他们的服务基础设施。它现在比 2008 年更快，更可靠。对于大多数网站，最好使用 Google 的 CDN，而不是自己托管 ga.js。由于官方 ga.js 存在于如此多的网站上，因此大多数用户会将其保存在浏览器缓存中。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-10-20T22:05:37.787

主要延迟可能是加载时间。尝试在本地托管 google 分析 javascript 文件。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-20T22:15:27.597

我第二次自己托管 GA javascript 文件 - 唯一的缺点是，如果 google 更新文件，您的副本将是旧的，并且您可能会错过某些功能 - 但是您可以通过每周下载最新版本的脚本来缓解这种情况。 ..

自己托管的好处是您可以完全控制缓存等，并且您的站点所需的 DNS 查找更少。

您可能面临的另一个问题是更新数据的延迟（最多 24 小时），但对于一些不花钱的事情，我并没有抱怨太多:)

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2010-08-19T08:03:21.563

我不敢相信，没有人建议[Piwik](http://piwik.org)。在我看来，它是 Google Analytics 的最佳替代品。它也将在几周内完全成熟。

你一定要检查一下！

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-20T22:08:11.637

一个很好的选择是[重振活力](http://reinvigorate.net/)。它“实时”为您提供统计数据，并且（在我看来）速度更快，但它没有 g-analytics 那么多的选项。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-20T22:29:26.163

将 urchin.js 脚本作为页面的最后加载不应减慢页面加载速度（因为它会加载您的网页，然后联系 Google Analytics）。这也意味着如果 urchin.js URL 由于某种原因暂时无法访问（例如，缓慢的 DNS 查找），它不会冻结您的页面

定期下载 urchin.js 并在本地提供它也会加快速度。每小时更新一次就足够了（考虑到它通常每次页面浏览都会收到一个请求，每小时一次是微不足道的）

我想如果你真的很担心，你可以考虑修改 urchin.js 以减少资源密集型，或者弄清楚它的作用并简化它（我建议先检查其他人是否已经这样做了），但我不要认为 JS 执行时间会显着减慢您的网页速度

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-04-22T15:23:24.317

您遇到的问题只是加载 javascript 时的标准 I/O 阻塞。

看看这个解决方案：http: [//lyncd.com/2009/03/better-google-analytics-javascript/](http://lyncd.com/2009/03/better-google-analytics-javascript/)

*这应该在页面加载后*处理 Google Analytics 。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-20T22:11:29.757

对于您需要的指标，您可以使用 Apache/IIS 创建的 Web 日志。

然后，您可以删除分析代码。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-08-19T07:57:03.227

您可以订阅 Google Analytics JavaScript 跟踪代码更改日志
[http://code.google.com/apis/analytics/docs/gaJS/changelog.html](http://code.google.com/apis/analytics/docs/gaJS/changelog.html)
以查看是否有新版本可用于在本地更新 ga.js

* * *

我还遇到了这个新的异步片段
[http://code.google.com/apis/analytics/docs/tracking/asyncTracking.html](http://code.google.com/apis/analytics/docs/tracking/asyncTracking.html)
它通过将 ga.js 插入页面来激活 Google Analytics 跟踪。但它利用浏览器对异步 JavaScript 的支持来提高跟踪代码的加载速度

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-11-11T06:12:15.880

[FoxMetrics](http://www.foxmetrics.com)似乎工作得非常快。它们仍处于测试阶段，但看起来很有希望。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-20T22:09:51.023

您可以简单地获取日志并使用 WebLog Expert Lite 之类的工具对其进行分析以获取这些指标。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-20T22:12:19.037

[WebTrends](http://www.webtrends.com)是一项非常有效的“付费”服务……虽然我得说，谷歌分析的神奇功能更酷。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-20T22:35:11.270

我之前快速浏览过[Mint](http://haveamint.com/)，它看起来很有趣。但我没有关于速度的信息，每个站点的成本为 30 美元。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-20T22:41:02.740

我是[Statcounter](http://www.statcounter.com)的粉丝。我尝试过的一些免费工具似乎不那么令人讨厌，而且我从未使用过它使任何东西都显得迟钝。免费帐户的日志大小是最后 500 次点击，但可以付费扩展。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-02-05T11:18:56.307

对于实时跟踪，您还可以尝试[Woopra](http://www.woopra.com)。它非常稳定和快速，但目前每天只允许 10.000 次浏览量，因为它们仍处于测试阶段。Thye 有一些不错的功能，例如与访问者的实时聊天。虽然它对转化跟踪不太好，但可以通过在您的 url 和广告中使用良好的参数来克服。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-05-20T06:30:24.170

[AWStats](http://awstats.sourceforge.net)将通过每天解析您的日志文件为您提供非常全面且呈现良好的统计信息。它还有一个轻量级的 JS，用于更高级的统计信息，如插件和屏幕大小。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2011-05-25T22:26:14.480

因为并非所有浏览器都支持脚本的异步加载，因为当前 Google Analytics 脚本使用我仍然会仅在加载 DOM 后加载脚本：

```
// first thing to do, make sure _gaq is defined:
var _gaq = _gaq || [];

// set your account settings:
_gaq.push(['_setAccount', 'UA-XXXXX-X']);

// queue trackpageview whenever you want :)
_gaq.push(['_trackPageview']);

//////////////////////////////////////////////////////////////////

(function($){
    // load the GA script only after the dom is ready
    // for simplicity using jQuery, of course you can just listen
    // to the DOMContentLoaded / window.load event
    $(function(){

        // standard code provided by google to load the GA script
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);

    });
})(jQuery);

//////////////////////////////////////////////////////////////////

// if the script is already loaded, it will execute the tracking request, otherwise it's in the queue
_gaq.push(['_trackEvent', 'Videos', 'Play', 'Gone With the Wind']); 
```

演示：http: [//jsfiddle.net/roberkules/xyU8K/](http://jsfiddle.net/roberkules/xyU8K/)

如果您由于某种原因被迫使用旧版本的 Google Analytics 脚本（无需排队），您必须自己编写队列功能（这很容易）并在脚本加载后处理队列（仍然加载只有在 DOM 准备好之后）。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2011-09-30T01:27:22.123

[Mixpanel](http://mixpanel.com/)提供实时分析。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2013-07-28T18:05:29.000

不要重复上面的海报，但我也喜欢 Mixpanel。它是高度可定制的，非常用户友好的，在实时（REAL REAL）时间，并且有一些非常强大和强大的工具——你可以选择学习或不学习的工具类型，但仍然具有惊人的价值。

需要了解一些 PHP/javascript 才能充分利用（好吧，使用它们提供的 100% 需要的还不止这些；但是，达到 100% 意味着您正在做一些超出荒谬的流量分析）所有这一切的优势能力，但它可以根据您的技能水平和您想要将任何编程语言、脚本或任务融入其中的强度高度定制。他们的客户服务也很棒。

他们也免费提供大量流量；但是，如果您达到必须花费任何东西的地步，它可能会得到一点$$$。但是，如果您有那么多流量，那么提供该服务应该不会有太大问题。

不，我不为 Mixpanel 工作，也不是他们的附属机构。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2014-06-09T01:49:38.117

我只用过谷歌分析；但是，如果您想继续使用 Google Analytics，您可以通过以下方式提高速度：

*   使用通用分析。Universal Analytics 的加载速度往往比经典的 Google Analytics 代码（尤其是对于商业）更快 - [http://cutroni.com/blog/2013/03/21/tracking-website-with-universal-analytics/](http://cutroni.com/blog/2013/03/21/tracking-website-with-universal-analytics/)

*   使用谷歌标签管理器。如果您要跟踪多个标签，则可以使用 Google 跟踪代码管理器异步加载标签 - [http://www.google.com/tagmanager/features.html](http://www.google.com/tagmanager/features.html)

# internet-explorer - 重新加载 Orbited 供电页面后 IE7 失败

> ID：220117
> 
> 赞同：1
> 
> 时间：2008-10-20T22:08:25.927
> 
> 标签：internet-explorer, comet, orbited

我正在开发一个基于[Orbited](http://orbited.org)的网站，并且在使用 IE7 时遇到了一些烦人的行为。在 FF3 中一切正常，但在 IE7 中，如果我重新加载页面，我会得到一个反复出现的错误：

```
Error: Can't execute code from a freed script 
```

换句话说，当您第一次浏览该站点时，该站点可以在 IE7 中运行，但在重新加载后会中断。我正在运行 Orbited 0.7.0，并在 CometDaily 上遵循了[本教程](http://cometdaily.com/2008/10/10/scalable-real-time-web-architecture-part-2-a-live-graph-with-orbited-morbidq-and-jsio/)。我的代码与教程代码相同，但有以下例外：

1.  我没有在 localhost 上运行该站点，而是使用具有真实域的服务器。当然，所有链接都会相应更新。
2.  静态文件（index.html）由 Django/Lighttpd 在端口 80 上提供服务，而不是由 Orbited 守护程序提供服务。Orbited 在端口 8000 上运行。

现在是奇怪的部分。如果我在 localhost 上运行，则不会出现此问题。

我知道 Orbited.js 创建一两个 iframe 来与 Orbited 守护进程通信。我猜这里存在某种问题，但我在这方面的知识是有限的。

那么任何人都可以理解我的应用程序发生了什么吗？作为记录，我已经阅读了在元标记之后放置脚本标记以避免这个问题。可悲的是，它并没有解决我的问题。教程代码中甚至没有任何元标记，所以我添加了一个以确保。

BR //弗雷德里克

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-21T03:47:18.177

使用主干（0.7.2）。问题已解决。

# sql - 与数据库无关的 jdbc 表导入/导出到文件？

> ID：220119
> 
> 赞同：3
> 
> 时间：2008-10-20T22:09:22.460
> 
> 标签：sql, mysql, oracle, jdbc, dump

是否有可能进行与数据库无关的表转储/水合物？我没有任何复杂的约束。我也会满足于特定于 db 的方式，但越纯 jdbc 越好（我不想诉诸 impdp/expdp）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-20T23:27:36.670

看看[DBUnit](http://dbunit.sourceforge.net/)。DBUnit 支持导出到 xml 文件和从 xml 文件导入。他们的[常见问题解答](http://dbunit.sourceforge.net/faq.html#streaming)对如何快速进行导出/导入有一些建议，请务必查看。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-20T23:41:18.327

DBUnit 看起来不错，但是您可能不会击败供应商的导入/导出工具。如果要导入或导出 100,000+ 行，最好使用 impdp/expdp。

我还做过一些奇怪的事情，比如从 sql 查询构建插入语句，然后使用 sqlplus 进行处理。[select 'insert into table values (...'||column||' ...) ] 但我很懒，不想创建 sqlldr 或 jdbc 插入程序。

当我需要更大的导入时，我以同样的方式使用 perl。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-20T23:41:45.037

如果是少量数据，一些程序（如 Aqua Data Studio）可以将数据导出为一系列 SQL 'INSERT' 语句。

# winapi - 如何检测硬盘是否通过 USB 连接？

> ID：220123
> 
> 赞同：3
> 
> 时间：2008-10-20T22:10:16.563
> 
> 标签：winapi, usb, hard-drive

我正在尝试为朋友和家人编写一个小备份程序，并希望它尽可能简单易用。我不想问用户将他们的数据备份到哪里，我只想搜索并使用连接到计算机的第一个 USB 硬盘驱动器。获取硬盘驱动器的唯一 ID 可能也是一个好主意，就像在下次运行备份时仔细检查一样。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T05:12:15.180

我知道您的问题被标记为 Win32，但这对于 .NET 来说非常简单：

```
foreach (IO.DriveInfo drive in IO.DriveInfo.GetDrives()) {
  if ((drive.DriveType == IO.DriveType.Removable)) {
    // this is a removable drive
  }
} 
```

请参阅 drive.Name 和 drive.VolumeLabel 以获取标签。您还可以获得大小，并有根据地猜测它是一个 USB 记忆棒（并且足够大）——[根据文档](http://msdn.microsoft.com/en-us/library/system.io.drivetype.aspx)，可移动可能意味着软盘或 USB 。

作为旁注，从 UI 的角度来看，我建议您第一次找到新驱动器时，将其呈现给用户并询问“这是您要用于备份的驱动器吗？”。否则，很可能会意外擦除碰巧插入的 USB 密钥上的数据。没有什么比破坏您的数据更能破坏备份程序的可信度的了。:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T07:27:11.553

您需要使用[RegisterDeviceNotification](http://msdn.microsoft.com/en-us/library/aa363431.aspx)功能。[这里](https://stackoverflow.com/questions/161257/what-languagemethods-to-use-to-listen-to-removeable-drives-in-windows)有一些关于如何做到这一点的指示。还有一个[示例代码](http://www.codeproject.com/KB/system/HwDetect.aspx)

[您可以使用此](http://support.microsoft.com/kb/259695)示例枚举所有大容量存储设备。通常寻找 SetupDiXXX api。

请注意，考虑到 USB 设备的动态特性，恕我直言，使用通知机制是强制性的。您可能会发现您的自我分析设备已经分离或丢失了刚刚到达的新设备。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T22:39:14.193

我花了一点时间环顾四周，发现了一个名为 SetupDiEnumDeviceInfo 的函数，它确实提供了一个解决方案来了解硬盘驱动器是否可移动，但有了这些信息，我仍然无法（还）将我找到的内容映射回驱动器号！

这是我到目前为止所拥有的（以下代码创建了一个 dll）：

```
#include "stdafx.h"
#include <setupapi.h>
#include <devguid.h>
#include <cfgmgr32.h>
extern "C" __declspec(dllexport) int usb_hard_drives() {
  HDEVINFO hdevinfo = SetupDiGetClassDevs(&GUID_DEVCLASS_DISKDRIVE, NULL, NULL, DIGCF_PRESENT);
  if (hdevinfo == INVALID_HANDLE_VALUE) return -1;
  DWORD MemberIndex = 0;
  SP_DEVINFO_DATA sp_devinfo_data;
  ZeroMemory(&sp_devinfo_data, sizeof(sp_devinfo_data));
  sp_devinfo_data.cbSize = sizeof(sp_devinfo_data);
  int c = 0;
  while (SetupDiEnumDeviceInfo(hdevinfo, MemberIndex, &sp_devinfo_data)) {
    DWORD PropertyRegDataType;
    DWORD RequiredSize;
    DWORD PropertyBuffer;
    if (SetupDiGetDeviceRegistryProperty(hdevinfo, &sp_devinfo_data, SPDRP_CAPABILITIES, &PropertyRegDataType, (PBYTE)&PropertyBuffer, sizeof(PropertyBuffer), &RequiredSize)) {
      if (PropertyBuffer && CM_DEVCAP_REMOVABLE == CM_DEVCAP_REMOVABLE) {
        // do something here to identify the drive letter.
        c++;
      }
    }       
    MemberIndex++;
  }
  SetupDiDestroyDeviceInfoList(hdevinfo);
  return c;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-08-29T18:46:49.590

我在 Win32 API 中发现了一个很好的函数来测试驱动器的类型。

```
if( 2 == ::getDriveType( <driveletter> )){
  // its removable 
} 
```

函数返回值：

DRIVE_UNKNOWN 0：无法确定驱动器类型。

DRIVE_NO_ROOT_DIR 1：根路径无效；例如，指定路径上没有安装卷。

DRIVE_REMOVABLE 2：驱动器有可移动媒体；例如，软盘驱动器、拇指驱动器或闪存卡读卡器。

DRIVE_FIXED 3：驱动器有固定介质；例如，硬盘驱动器或闪存驱动器。

DRIVE_REMOTE 4：驱动器是远程（网络）驱动器。

DRIVE_CDROM 5：驱动器是 CD-ROM 驱动器。

DRIVE_RAMDISK 6：驱动器是 RAM 磁盘。

[http://msdn.microsoft.com/en-us/library/windows/desktop/aa364939(v=vs.85).aspx](http://msdn.microsoft.com/en-us/library/windows/desktop/aa364939(v=vs.85).aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-20T22:21:14.090

可以毫不费力地收集一些信息：

*   使用 GetDriveType 查找第一个可移动驱动器，测试是否存在可写介质（这将在很大程度上排除 CD 驱动器）。当您通过 win32 查询驱动器信息时，可能还想查看更多可用的字符串。
*   使用 libusb 查看第一个存储类 USB 设备在哪里（可能是闪存或硬盘驱动器）
*   这篇[C# 文章](http://bytes.com/forum/thread234006.html)指向您可能能够利用的 win32 磁盘驱动器类。

找到答案后在这里发布您的答案！

-亚当

# ruby-on-rails - 给定一组 ActiveRecord 对象，我可以通过方法调用轻松收集它们的关系吗？

> ID：220126
> 
> 赞同：2
> 
> 时间：2008-10-20T22:11:02.957
> 
> 标签：ruby-on-rails, ruby, activerecord

假设我有以下代码：

```
@sites = Site.find(session[:sites]) # will be an array of Site ids
@languages = Language.for_sites(@sites) 
```

for_sites 是 Language 模型中的 named_scope，它返回与这些站点关联的语言，并且语言与使用 has_many through 的站点关联。目标是让@languages 拥有与网站相关联的不同语言数组。

与其在第二行调用 Language 对象，我更愿意说

```
@sites.languages 
```

并将相同的列表返回给我。在 Rails 2.1（或边缘）中有什么方法可以干净地做到这一点？我知道关联和命名范围可以将数组对象扩展为具有属性，但除非我遗漏了一些在这里不适用的东西。任何这样做的插件都会受到欢迎，它不必是核心。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-23T14:35:06.823

您可以扩展 Site.find 返回的数组。

```
class Site
  def find(*args)
    result = super
    result.extend LanguageAggregator if Array === result
    result
  end
end

module LanguageAggregator
  def languages
    Language.find(:all, :conditions => [ 'id in (?)', self.collect { |site| site.id } ])
  end
end 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T11:16:50.500

为什么不同时使用 named_scopes 呢？

```
class Site
  named_scope :sites, lambda{|ids| :conditions => "id in (#{ids.join(',')})"}
  named_scope :languages, :include => :languages ... (whatever your named scope does)
end 
```

称呼：

```
Site.sites(session[:sites]).languages 
```

或者，如果您想要返回语言对象

```
Site.sites(session[:sites]).languages.collect{|site| site.languages}.flatten 
```

您也可以直接在 Language 对象上执行此操作。我使用 :joins 是因为 Rails 2.1 将 :include 拆分为两个查询，这意味着我们不能在 :conditions 中使用站点

```
class Language
  named_scope :for_sites, lambda{|site_ids| :joins => 'inner join sites on languages.site_id = sites.id' :conditions => "sites.id in (#{site_ids.join(',')})"}
end 
```

称呼：

```
Language.for_sites(session[:sites]) 
```

在这两个示例中，我都假设 session[:sites] 完全由您控制，不受 SQL 注入的影响。如果没有，请确保您处理清理 ID

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T01:32:42.957

您的实例变量 @sites 是一个 Array 对象而不是 Site 所以我不认为可以使用 named_scope 。你可以打开 Array 类来实现这个效果（哎呀）

```
class Array

  def languages
    ...
  end

end 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T02:40:57.780

如果您将语言`has_many`或`has_and_belongs_to_many`链接语言添加到站点，则可以使用包含并执行以下操作：

```
Site.find( :all, :conditions =>{:id => session[:sites]}, :include => :languages ) 
```

您可以创建一个命名范围来执行 :id => session[:sites] 的事情，例如：

```
class Site
  named_scope :for_ids, lambda{ |x| {:conditions => {:id => x }
end 
```

然后做

```
Site.for_ids(session[:sites]).find(:all, :include => :languages) 
```

希望这能给你一些想法

# java - Java 实例化

> ID：220133
> 
> 赞同：10
> 
> 时间：2008-10-20T22:13:20.893
> 
> 标签：java, oop, jvm

1.  **当一个对象在 Java 中被实例化时，真正进入内存的是什么？**
2.  是否包含父构造函数的副本？
3.  为什么隐藏数据成员在强制转换时的行为与被覆盖的方法不同？

我理解通常为让您正确使用这些东西而给出的抽象解释，但 JVM 是如何真正做到这一点的。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-20T22:47:20.090

当一个对象被实例化时，只有非静态数据实际上是“创建的”，以及对创建它的对象类型的引用。

没有任何方法被复制。

对创建它的类的“引用”实际上是一个指针调度表。每个类可用的方法都有一个指针。指针始终指向方法的“正确”（通常是对象树中最低/最具体的）实现。

这样，如果您对另一个方法进行了顶级调用，但另一个方法已被覆盖，则将调用被覆盖的方法，因为那是表中指针指向的位置。由于这种机制，调用被覆盖的方法应该不会比调用顶级方法花费更多的时间。

指针表+成员变量是一个类的“实例”。

变量问题与完全不同的机制“名称空间”有关。变量根本不是“子类”（它们不进入调度表），但公共或受保护的变量可以被局部变量隐藏。这一切都是由编译器在编译时完成的，与您的运行时对象实例无关。编译器确定您真正想要的对象，并将对该对象的引用填充到您的代码中。

范围规则通常倾向于“最近”变量。任何更远的同名将被忽略（阴影），有利于更近的定义。

如果您有兴趣，可以更具体地了解内存分配：所有“对象”都分配在“堆”上（实际上比真正的堆更高效、更美观，但概念相同。）变量始终是指针——Java永远不会复制对象，您总是复制指向该对象的指针。方法参数和局部变量的变量指针分配是在栈上完成的，但是即使变量（指针）是在栈上创建的，它们所指向的对象仍然永远不会在栈上分配。

我很想写一个例子，但这已经太长了。如果您希望我输入几个具有扩展关系的类以及它们的方法和数据如何影响生成的代码，我可以......问一下。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T22:23:43.353

我想你会发现这是一个全面的例子：

[http://www.onjava.com/pub/a/onjava/2005/01/26/classloading.html](http://www.onjava.com/pub/a/onjava/2005/01/26/classloading.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-08-25T10:04:03.067

1.  从堆中分配内存以保存对象及其超类的所有实例变量和特定于实现的数据。特定于实现的数据包括指向类和方法数据的指针。

2.  对象的实例变量被初始化为其默认值。

3.  最派生类的构造函数被调用。构造函数做的第一件事就是调用大写的构造函数。这个过程一直持续到调用 java.lang.Object 的构造函数，因为 java.lang.Object 是 java 中所有对象的基类。

4.  在执行构造函数的主体之前，会执行所有实例变量初始化程序和初始化块。然后执行构造函数的主体。因此，基类的构造函数首先完成，最派生类的构造函数最后完成。

# file - 在 JSP/Servlet 中管理文件上传

> ID：220135
> 
> 赞同：2
> 
> 时间：2008-10-20T22:15:02.980
> 
> 标签：file, jsp, servlets, upload, copy

又是一个非常初学者的问题，但我在这里：

我想使用 servlet 或类似工具将上传的文件（从 html 文件选择）复制到永久位置。这就是我需要对文件做的所有事情。我目前正在使用 Apache Commons FileUpload 和 IO 库。没有更简单或更优雅的解决方案吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-20T22:24:16.580

如果您使用纯 JSP 和 servlet，Apache commons FileUpload 可能是最好的方法。如果您使用像 struts2 这样的框架，您将有更多选择，因为它们内置了文件上传组件并且非常易于使用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-20T22:37:32.217

Servlet API 无法从 POST (PUT?) 数据中提取文件。

正如文森特所说，Apache commons FileUpload 是最好的免费方式。

如果您不想使用 Apache 库，您也可以考虑使用签名的小程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-11-20T12:54:06.143

你可以使用 OReilly 的 COS 库。参考这个[链接](http://senior.ceng.metu.edu.tr/2009/praeda/2009/05/28/how-to-file-uploading-using-jspservlet/)！

# sql-server - 在 SQL Server 中打印出文本字段内容的最简单方法

> ID：220142
> 
> 赞同：5
> 
> 时间：2008-10-20T22:18:43.503
> 
> 标签：sql-server, database, query-analyzer

我需要使用 MS Query Analyzer 输出文本字段的内容。我试过这个：

```
select top 1 text from myTable 
```

（其中文本是一个`text`字段）

和

```
DECLARE @data VarChar(8000) 
select top 1 @data = text from myTable
PRINT @data 
```

第一个只打印前 2000 个左右的字符，第二个只打印前 8000 个字符。有没有办法获取所有的文本？

笔记：

*   必须与 SQL Server 7 一起使用

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-20T22:54:49.640

我不认为你可以在 MSSQL7 中使用 varchar(MAX)，所以这里有一些东西可以给你所有的数据（注意，我的理解是你只是想直观地看到数据，你不会放它在一个变量中或返回它）。

因此，这将打印出整个字符串，以便您可以直观地看到该字段中的内容：

```
DECLARE @limit as int,
        @charLen as int,
        @current as int,
        @chars as varchar(8000)

SET @limit = 8000

SELECT  TOP 1 @charLen = LEN(text)
FROM    myTable

SET @current = 1

WHILE @current < @charLen
BEGIN
    SELECT  TOP 1 @chars = SUBSTRING(text,@current,@limit)
    FROM    myTable
    PRINT @chars

    SET @current = @current + @limit
END 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-20T23:24:24.523

我有一段时间没有使用查询分析器了，但是您可以在选项窗口中调整结果窗口中显示的最大字符数。请参阅[MSDN](http://msdn.microsoft.com/en-us/library/aa217017(SQL.80).aspx)文档。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-10-20T10:15:00.400

[http://shortfastcode.blogspot.com/2011/10/getting-around-sql-server-print-8000.html](http://shortfastcode.blogspot.com/2011/10/getting-around-sql-server-print-8000.html)

使用这个存储过程。唯一的缺点是每 8000 个字符换行一次 :(

```
CREATE PROCEDURE [dbo].[LongPrint]
      @String NVARCHAR(MAX)

AS

/*
Example:

exec LongPrint @string =
'This String
Exists to test
the system.'

*/

/* This procedure is designed to overcome the limitation
in the SQL print command that causes it to truncate strings
longer than 8000 characters (4000 for nvarchar).

It will print the text passed to it in substrings smaller than 4000
characters.  If there are carriage returns (CRs) or new lines (NLs in the text),
it will break up the substrings at the carriage returns and the
printed version will exactly reflect the string passed.

If there are insufficient line breaks in the text, it will
print it out in blocks of 4000 characters with an extra carriage
return at that point.

If it is passed a null value, it will do virtually nothing.

NOTE: This is substantially slower than a simple print, so should only be used
when actually needed.
 */

DECLARE
               @CurrentEnd BIGINT, /* track the length of the next substring */
               @offset tinyint /*tracks the amount of offset needed */

set @string = replace(  replace(@string, char(13) + char(10), char(10))   , char(13), char(10))

WHILE LEN(@String) > 1
BEGIN

IF CHARINDEX(CHAR(10), @String) between 1 AND 4000
    BEGIN

SET @CurrentEnd =  CHARINDEX(char(10), @String) -1
           set @offset = 2
    END
    ELSE
    BEGIN
           SET @CurrentEnd = 4000
            set @offset = 1
    END

PRINT SUBSTRING(@String, 1, @CurrentEnd)

set @string = SUBSTRING(@String, @CurrentEnd+@offset, 1073741822)

END /*End While loop*/ 
```

这最初发布在 SQLServerCentral.com 上，网址为[http://www.sqlservercentral.com/scripts/Print/63240/](http://www.sqlservercentral.com/scripts/Print/63240/)

# service - 错误 1783 - instsrv.exe 从 Win2k3 中删除

> ID：220146
> 
> 赞同：2
> 
> 时间：2008-10-20T22:20:14.030
> 
> 标签：service, windows-server-2003, uninstallation, instsrv

我的应用程序安装程序使用户能够通过使用应用程序将应用程序作为服务运行`srvany.exe`。要在卸载时删除应用程序，我一直在使用该应用程序`instsrv.exe`和以下命令：

> instsrv "我的服务" 删除

在 Windows Server 2003 上，我遇到错误 1783。

关于是什么导致这个问题的任何想法？我是否使用了错误的方法`Win2k3`？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T10:28:07.633

我对 Rk-Tools 2003 和 2000 进行了同样的尝试，但两次都出现相同的错误。但是在下次重新启动后手动删除注册表参数后，服务（我尝试了几个星座）消失了。请考虑在（！）您要删除注册表项之前停止服务，因为否则服务将不接受任何进一步的命令。也许这会对你有所帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-12-11T00:35:37.427

首先 - 对 instsrv.c 的引用只是一条错误消息（它告诉您错误在源代码中实际发生的位置）。我认为（但我不确定）这个 1783 错误发生在它尝试枚举服务但遇到溢出错误（安装了太多服务？）

更好的方法是使用 sc.exe：

```
SC STOP servicename
SC DELETE servicename 
```

# sql - 在 SQL 中拆分行

> ID：220147
> 
> 赞同：1
> 
> 时间：2008-10-20T22:21:11.470
> 
> 标签：sql, rows, split

有人可以让我知道如何使用 SQL 获取以不同方式相交的三行的不同段吗？#t2 中的三行代表集合 A、B、C - 我正在寻找 AIB、AIC、BIC、AIBIC、A'、B'、C' 等，（在维恩图中有 3 行的 7 个可能段）我是交叉口。

我正在寻找一种通用解决方案，它可以处理#t2 中的 n 行。

```
-- SQL Code Begin
create table #t1 (key1 int, key2 int) -- for each Key1 there can be 1 or more Key2
go
create table #t2 (row_id int identity(101, 1), key1 int) --row_id is the primary key
go 

insert into #t1
select 1, 11 union select 1, 12 union select 1, 13 union select 1, 14 union 
select 2, 13 union select 2, 15 union select 2, 16 union select 2, 17 union 
select 3, 13 union select 3, 12 union select 3, 16 union select 3, 17

-- 1 --> 11, 12, 13, 14
-- 2 --> 13, 15, 16, 17
-- 3 --> 13, 12, 16, 17

insert into #t2 (key1)
select 1 union select 2 union select 3

-- SQL Code End 
```

我正在寻找的输出是，

```
1001  11 (A')
1001  14 (A')
1002  12 (A I C - A I B I C)
1003  13 (A I B I C)
1004  15 (B')
1005  16 (B I C - A I B I C)
1005  17 (B I C - A I B I C) 
```

输出有 5 个段，而不是可能的 7 个段，因为其中两个为 NULL。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T08:15:04.390

如果我正确理解了这个问题，我认为您可能不得不求助于使用循环来处理“n”行

```
DECLARE @Key2 INT
DECLARE @Subset VARCHAR(1000)
DECLARE @tblResults TABLE
(
    Key2 INT,
    Subset VARCHAR(1000)
)

SET @Subset = ''
SELECT @Key2 = MIN(Key2) FROM #t1

WHILE @Key2 IS NOT NULL
BEGIN
    SELECT @Subset = @Subset + CAST(Key1 AS VARCHAR(10))
    FROM #t1
    WHERE Key2 = @Key2

    INSERT INTO @tblResults (Key2, Subset)
    VALUES (@Key2, @Subset)

    SET @Subset = ''
    SELECT @Key2 = MIN(Key2) FROM #t1 WHERE Key2 > @Key2
END

SELECT * FROM @tblResults 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-20T23:22:02.173

这个怎么样？

```
SELECT key2,
  CASE
  WHEN InA = 1 and InB = 1 and InC = 1 THEN 'ABC'
  WHEN InA = 0 and InB = 1 and InC = 1 THEN 'BC'
  WHEN InA = 1 and InB = 0 and InC = 1 THEN 'AC'
  WHEN InA = 1 and InB = 1 and InC = 0 THEN 'AB'
  WHEN InA = 1 and InB = 0 and InC = 0 THEN 'A'
  WHEN InA = 0 and InB = 1 and InC = 0 THEN 'B'
  WHEN InA = 0 and InB = 0 and InC = 1 THEN 'C'
  ELSE 'I''m broke'
  END as [SubSet]
FROM

(
SELECT key2,
  MAX(CASE WHEN key1 = 1 THEN 1 ELSE 0 END) as InA,
  MAX(CASE WHEN key1 = 2 THEN 1 ELSE 0 END) as InB,
  MAX(CASE WHEN key1 = 3 THEN 1 ELSE 0 END) as InC
FROM #t1
WHERE key1 in (1, 2, 3)
GROUP BY key2
) sub

ORDER BY key2 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T06:46:10.123

如果您可以将表 2 填充为

```
1, Key1-Value 1
2, Key1-Value 2
4, Key1-Value 3 
```

同样，如果您有更多的 key1，那么您所拥有的身份列应该填充为二叉树。这样 t2 中的值将是

```
1 , 1
2 , 2
4 , 3 
```

然后你需要做一个选择：

```
select sum(identity), key2
from t1, t2
where t1.key1 = t2.key1
groupby key2 
```

您将获得的输出将是

```
1   11
5   12
7   13
1   14
2   15
6   16
6   17 
```

你可以看到 1,2,4 将是 A',B',C' 2 将是 A|B ， 7 将是 A|B|C ，同样

# javascript - 如何通过 JavaScript 访问 HTTP 请求标头字段？

> ID：220149
> 
> 赞同：62
> 
> 时间：2008-10-20T22:21:21.140
> 
> 标签：javascript, http, http-headers

我想在我的客户端 JavaScript 中捕获 HTTP 请求标头字段，主要是Referer 和 User-Agent。我如何访问它们？

* * *

Google Analytics 设法通过 JavaScript 获取您嵌入页面的数据，因此这绝对是可能的。

> **相关：**
> [在 JavaScript 中访问网页的 HTTP 标头](https://stackoverflow.com/questions/220231/accessing-http-headers-in-javascript)

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2008-10-20T22:29:21.843

如果您想访问引用者和用户代理，它们可用于客户端 Javascript，但不能通过直接访问标头。

要检索引荐来源网址，请使用[`document.referrer`](https://developer.mozilla.org/en-US/docs/DOM/document.referrer).
要访问用户代理，请使用[`navigator.userAgent`](https://developer.mozilla.org/en-US/docs/DOM/window.navigator.userAgent).

正如其他人所指出的，HTTP 标头不可用，但您特别询问了可通过 Javascript 获得的引用者和用户代理。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-20T22:32:11.947

几乎按照定义，客户端 JavaScript 不在 http 请求的接收端，因此它没有要读取的标头。最常见的是，您的 JavaScript 是 http 响应的结果。如果您尝试获取生成响应的 http 请求的值，则必须编写服务器端代码以将这些值嵌入到您生成的 JavaScript 中。

让服务器端代码生成客户端代码有点棘手，因此请确保这是您需要的。例如，如果您想要用户代理信息，您可能会发现获取 JavaScript 为浏览器检测提供的各种值就足够了。从 navigator.appName 和 navigator.appVersion 开始。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-11-30T15:28:36.373

这可以通过 Javascript 访问，因为它是加载文档的属性，而不是其父文档的属性。

这是一个简单的例子：

```
<script type="text/javascript">
document.write(document.referrer);
</script> 
```

PHP中的相同内容是：

```
<?php echo $_SERVER["HTTP_REFERER"]; ?> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-12-12T03:30:06.650

引用者和用户代理是请求标头，而不是响应标头。

这意味着它们是由浏览器或您的 ajax 调用（您可以修改值）发送的，并且它们是在您获得 HTTP 响应之前决定的。

所以基本上你不是在要求一个 HTTP 标头，而是一个浏览器设置。

您从 document.referer 和 navigator.userAgent 获得的值可能不是实际的标头，而是浏览器的设置。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2020-10-31T18:28:31.397

从 JavaScript 获取标头的一种方法是使用 WebRequest API，它允许我们访问源自 http 或 websockets 的不同事件，其生命周期如下： [WebRequest Lifecycle](https://media.prod.mdn.mozit.cloud/attachments/2016/05/27/13376/b019ebc19eef67978f361d8208b59169/webRequest-flow.png)

因此，为了访问页面的标题，它将是这样的：

```
 browser.webRequest.onHeadersReceived.addListener(
     (headersDetails)=> {
      console.log("Request: " + headersDetails);
    },
    {urls: ["*://hostName/*"]}
    );` 
```

问题是为了使用这个API，它必须从浏览器执行，即浏览器对象是指浏览器本身（标签、图标、配置），并且浏览器确实可以访问所有的请求和响应任何页面，因此您必须向用户询问权限才能执行此操作（必须在清单中声明权限才能让浏览器执行它们）

而且作为浏览器的一部分，您将失去对页面的控制权，也就是说，您不能再操纵 DOM，（不是直接）因此要再次控制 DOM，将按如下方式完成：

```
 browser.webRequest.onHeadersReceived.addListener(
        browser.tabs.executeScript({
        code: 'console.log("Headers success")',
    });
}); 
```

或者如果你想运行很多代码

```
 browser.webRequest.onHeadersReceived.addListener(
        browser.tabs.executeScript({
        file: './headersReveiced.js',
    });
}); 
```

此外，通过控制浏览器，我们可以注入 CSS 和图像

文档：[https ://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webRequest/onHeadersReceived](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webRequest/onHeadersReceived)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-20T22:46:09.703

我想谷歌会在服务器端抓取*一些*数据——记住，当一个页面加载到你的浏览器中时，你的浏览器会向谷歌的服务器发出请求；Google 可以通过这种方式以及通过嵌入在页面中的 JavaScript 来获取数据。

* * *

## 回答 #7

> 赞同：-11
> 
> 时间：2014-07-07T19:40:20.497

```
var ref = Request.ServerVariables("HTTP_REFERER"); 
```

在引号内键入您想要的任何其他服务器变量名称。

# sql - SQL中临时表和物理表的比较速度是多少？

> ID：220151
> 
> 赞同：5
> 
> 时间：2008-10-20T22:22:53.370
> 
> 标签：sql, sql-server, sql-server-2005, tsql

我有一个脚本需要临时提取数据以对其进行额外操作，但在脚本运行后不需要进一步存储它。我目前在一系列临时本地表 (CREATE TABLE #table) 中有相关数据，然后在使用完成时将其删除。我正在考虑切换到以相同方式处理的物理表（CREATE TABLE 表），如果它的脚本速度会有所提高（或其他优势，也许？）。

...那么，临时表和物理表之间的性能是否存在差异？根据我的阅读，临时表只是物理表，只有运行脚本的会话才能查看（减少锁定问题）。

编辑：我应该指出，我说的是物理表与临时表。有很多关于临时表与表变量的信息，例如[http://sqlnerd.blogspot.com/2005/09/temp-tables-vs-table-variables.html](http://sqlnerd.blogspot.com/2005/09/temp-tables-vs-table-variables.html)。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-20T22:53:00.267

临时表在 SQL Server 中是一个很大的问题。

*   它们会引发代价高昂的查询计划重新编译。
*   创建和删除表也是您添加到流程中的昂贵操作。
*   如果有大量数据进入临时数据，您的操作将因缺少索引而变慢。您可以在临时表上创建索引。但我永远不会为任何有大量记录的东西推荐一个临时表。

您的另一种方法：创建然后删除常规表只会产生相同的开销。

另一种方法：使用现有的表，用一个额外的列来增加行，以区分哪些行属于每个用户/会话可以使用。消除了创建/删除表的负担，但是，您将需要对生成值以区分行的代码保持偏执，并且您必须开发一种方法来维护表以应对会话过早结束的情况并且有剩余物（在处理结束时未删除的行）。

我建议您重新考虑您的处理策略。一些替代方法与使用相关查询、派生表或表变量一样简单。看看：[http ://www.sql-server-performance.com/articles/per/temp_tables_vs_variables_p1.aspx](http://www.sql-server-performance.com/articles/per/temp_tables_vs_variables_p1.aspx)

* * *

**编辑：**创建和删除常规表的方法以及重用带有附加字段的常规表的方法：两者都将生成查询计划重新编译，因为更改的数据量将触发重新评估表统计信息。同样，您最好的方法是找到处理数据的替代方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-20T23:47:26.583

你在做什么样的数据操作，你在处理多少数据？

我会坚持使用临时表——对于大型数据集，我一直发现它是迄今为止最好的方法，而不仅仅是在 SQL Server 中。您可以尝试使用全局临时表 (CREATE TABLE ##tablename)，它的持续时间超出了 create 语句的范围。

来自 SQL Server 联机丛书 (2005)：

> 如果您创建全局临时表##employees，则数据库中的任何用户都可以使用此表。如果在您创建该表后没有其他用户使用该表，则该表会在您断开连接时被删除。如果其他用户在您创建该表后使用它，则 SQL Server 会在您断开连接并且所有其他会话不再主动使用它之后将其删除。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T17:08:15.190

要考虑的一件事是您是否可以一次只依靠一个用户运行此 proc。如果您同时有用户，那么常规表选项可能会产生干扰。临时表对用户来说可能是唯一的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-20T22:28:43.653

至少对于 MySql，您将获得的唯一时间节省是实际创建临时表的时间节省。AFAIK 所有表格在磁盘上的处理方式都是一样的，它们只是在会话结束时消失了。这也是我在实践中看到的。同样，这是 mysql 4.x 和 5.x

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-20T22:31:42.383

我对此不是 100% 确定，但我相信表变量严格存在于内存中，但临时表驻留在存储在磁盘上的 tempdb 中。这是使用 SQL Server，我不确定不同 RDMS 的一致性如何。

# objective-c - 如何将堆栈跟踪打印到控制台/登录 Cocoa？

> ID：220159
> 
> 赞同：300
> 
> 时间：2008-10-20T22:24:21.103
> 
> 标签：objective-c, cocoa, callstack, introspection

我想在某些时间点记录*调用跟踪，例如失败的断言或未捕获的异常。*

* * *

## 回答 #1

> 赞同：557
> 
> 时间：2010-02-24T00:42:15.040

此代码适用于任何线程：

```
NSLog(@"%@", NSThread.callStackSymbols); 
```

> 返回一个包含调用堆栈符号的数组。每个元素都是一个`NSString`对象，其值的格式由`backtrace_symbols()`函数确定。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2013-01-09T05:13:31.803

n13 的回答不太奏效 - 我稍微修改了一下以想出这个

```
#import <UIKit/UIKit.h>

#import "AppDelegate.h"

int main(int argc, char *argv[])
{
    @autoreleasepool {
        int retval;
        @try{
            retval = UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class]));
        }
        @catch (NSException *exception)
        {
            NSLog(@"Gosh!!! %@", [exception callStackSymbols]);
            @throw;
        }
        return retval;
    }
} 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-20T22:58:59.770

Cocoa 已经将未捕获异常的堆栈跟踪记录到控制台，尽管它们只是原始内存地址。如果您想要控制台中的符号信息，Apple 提供了一些[示例代码](https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Exceptions/Tasks/ControllingAppResponse.html)。

如果您想在代码中的任意点生成堆栈跟踪（并且您在 Leopard 上），请参阅 backtrace 手册页。在 Leopard 之前，您实际上必须挖掘调用堆栈本身。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-20T22:28:52.560

[这](https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Exceptions/Tasks/ControllingAppResponse.html)几乎告诉你该怎么做。

本质上，您需要设置应用程序异常处理以记录，例如：

```
#import <ExceptionHandling/NSExceptionHandler.h>

[[NSExceptionHandler defaultExceptionHandler] 
                  setExceptionHandlingMask: NSLogUncaughtExceptionMask | 
                                            NSLogUncaughtSystemExceptionMask | 
                                            NSLogUncaughtRuntimeErrorMask] 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-20T22:44:29.393

对于异常，您可以使用异常的 userInfo 字典的 NSStackTraceKey 成员来执行此操作。请参阅Apple 网站上[的控制程序对异常的响应。](http://developer.apple.com/documentation/Cocoa/Conceptual/Exceptions/Tasks/ControllingAppResponse.html#//apple_ref/doc/uid/20000473-DontLinkElementID_3)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-11-12T13:57:20.473

以这种方式快速打印：

```
print("stack trace:\(Thread.callStackSymbols)") 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2021-11-09T07:39:13.943

如果你想得到它作为 NSString。

```
[NSThread  callStackSymbols].description 
```

# makefile - 学习 GNUMake 的资源？

> ID：220165
> 
> 赞同：16
> 
> 时间：2008-10-20T22:27:52.003
> 
> 标签：makefile, gnu-make

我正在尝试为我正在从事的一个小项目学习 GNUMake。到目前为止，即使是“基本”教程看起来也很粗糙，我还没有理解 makefile 的语法。

有没有人有一些好的资源让绝对初学者熟悉 GNUMake？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-20T22:32:23.663

权威指南是[http://www.gnu.org/software/make/manual/make.html](http://www.gnu.org/software/make/manual/make.html)
有一本 o'reilly 书“使用 GNU Make 管理项目”有更多解释。您也可以使用早期版本，它们没有专门涵盖 GnuMake，但更薄。

Make 在开发人员中是一个肮脏的秘密——我们没有人理解它，我们只是从别人那里借了一个 make 脚本并更改它。我想只有一个脚本是从头开始编写的（可能是由该工具的创建者编写的）。

当您需要做的不仅仅是简单的示例时，大多数人要么切换到更现代的构建系统，如 Ant，要么在 Perl/Python/etc 中推出自己的构建系统。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-20T22:59:17.930

make 最常用的功能可以分解为几个简单的概念、目标、依赖项和变量。

目标是您要构建的东西，但目标下的命令可以是编译器命令或脚本。通常，每个目标都指代代码中的一个模块，但您可以根据您的项目使这些目标更细化。

依赖项是项目中的文件或其他目标。最好的例子是一个 C 项目，你从一堆目标文件中构建一个二进制文件。在构建二进制文件之前，每个目标文件都需要存在，因此 make 将遍历您的目标，直到完成所有依赖项，然后为整个目标运行命令。

变量并不总是必需的，但对于处理编译器标志之类的东西非常方便。典型的示例是 CC 和 CCFLAG，它们将引用您使用的编译器，即 gcc 和 -ansi -Wall -o2 等标志。

一些更一般的提示和技巧：

*   命令*必须*以 [tab] 字符开头，否则将不会执行，这只是 make 的旧遗物，我不记得为什么会这样。
*   按照惯例，您可能希望包含一个 all 目标来指定默认值，哪个目标应该是默认值。当您有一个复杂的 makefile 并且有一个您总是希望成为默认目标的特定目标时，这很有用。
*   你的 makefile 应该叫做 makefile 或 Makefile，但是如果你想叫它别的名字，使用 $make -f [makefilename]
*   始终使用完整的变量扩展语法，即 $(VARIABLE) 或 make 可能不会输出您想要的命令。
*   make 可以递归地工作，因此如果您的项目中有一堆子模块位于目录中，您可以在 make 中调用子目录 makefile 上的 make 来构建每个子模块。
*   如果您有一个需要安装脚本等的非常复杂的项目，您可能还想研究自动工具，它会为您生成 makefile 并执行一系列技巧来检查库的存在和其他可移植性问题。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2015-06-25T21:10:15.447

“使用 GNU Make 管理项目，第 3 版”属于“GNU 自由文档许可证”，可以合法免费在线阅读：[链接](https://www.safaribooksonline.com/library/view/managing-projects-with/0596006101/)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-20T23:21:56.667

我同意 O'Reilly 的书建议。

有关 Make 的一些有用提示、技巧和见解，请查看[Mr. Make 文章](http://www.cmcrossroads.com/content/category/8/147/135/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-20T22:50:19.507

mgb：那更糟。我曾经从头写过一个复杂的 make 系统（几千个文件，五十或一百个目录，四五个编译器和交叉编译目标，2 个操作系统等）。我坐下来学习了从里到外的 gnu make，设计了系统，首先玩了一个原型。我们都对结果非常满意。

但那是几年前的事了。你知道我今天是怎么写的吗？和你描述的一样。它足够繁琐，语法细节也足够模糊，除非你经常这样做，否则你无法记住细节。就像任何其他具有非直观语法和一些古怪规则的语言一样，我猜。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-07-06T04:37:21.890

我不是 GNU 信息系统的忠实粉丝，但我发现 GNU 制作信息页面非常有用。一旦您了解了非常基本的概念以及大致有哪些可用的东西，我发现信息页面是引用诸如预建函数之类的信息的最快方式。

（忘记 GNU`info`程序，改用 eg [`pinfo`](http://pinfo.sourceforge.net/)。）

# ruby - 如何安装本地 gem？

> ID：220176
> 
> 赞同：351
> 
> 时间：2008-10-20T22:32:17.623
> 
> 标签：ruby, rubygems

如果我将 .gem 文件下载到计算机中的文件夹中，我可以稍后使用 安装它`gem install`吗？

* * *

## 回答 #1

> 赞同：344
> 
> 时间：2008-11-13T05:54:36.057

此外，您可以使用`gem install --local path_to_gem/filename.gem`

这将跳过您离开时发生的通常的 gem 存储库扫描`--local`。

您可以使用`gem install --help`.

* * *

## 回答 #2

> 赞同：295
> 
> 时间：2008-10-20T22:35:12.003

是的，当你这样做时`gem install`，它会首先搜索当前目录，所以如果你的 .gem 文件在那里，它会选择它。我在[gem reference](https://guides.rubygems.org/command-reference/#gem-install)中找到了它，您可能也会觉得它很方便：

> gem install 将安装命名的 gem。它将尝试进行本地安装（即当前目录中的 .gem 文件），如果失败，它将尝试下载并安装您想要的最新版本的 gem。

* * *

## 回答 #3

> 赞同：68
> 
> 时间：2011-10-31T15:50:30.127

您还可以**对 gem 文件使用完整的文件名：**

```
gem install /full/path/to/your.gem 
```

这也有效——这可能是最简单的方法

* * *

## 回答 #4

> 赞同：41
> 
> 时间：2013-06-12T03:36:41.157

如果您使用 bundler 创建 gem：

```
# do this in the proper directory
bundle gem foobar 
```

您可以在编写完成后使用 rake 安装它们：

```
# cd into your gem directory
rake install 
```

很有可能，您下载的 gem 也会知道`rake install`。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2015-01-05T11:39:13.150

如果您从 github 或其他 scm 主机站点下载项目文件，请先使用 gem build 构建项目，这样您就可以在当前目录中获得一个whatever.gem 文件。然后 gem 安装它！

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2017-03-19T20:38:47.050

如果您想在本地修改的 gem 分支上工作，最好的方法是

`gem 'pry', path: './pry'`

在 Gemfile 中。

...`./pry`您的存储库的克隆在哪里。只需运行`bundle install`一次，您对 gem 源所做的任何更改都会立即反映出来。使用`gem install pry/pry.gem`，源代码仍会移入`GEM_PATH`，您将始终必须同时运行`bundle gem pry`并`gem update`进行测试。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2016-01-25T23:04:03.107

转到宝石所在的路径并调用`gem install -l gemname.gem`

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-10-10T21:32:54.593

好吧，这是我的 DRY 安装：

1.  查看缓存目录中已安装 gem 的计算机（默认情况下`[Ruby Installation version]/lib/ruby/gems/[Ruby version]/cache`：）
2.  将所有“`*.gems`文件”复制到自己的 gem 缓存位置中没有 gem 的计算机（默认情况下与第一步的赞助者路径相同`[Ruby Installation version]/lib/ruby/gems/[Ruby version]/cache`：）
3.  在控制台中位于 gems 缓存 (cd `[Ruby Installation version]/lib/ruby/gems/[Ruby version]/cache`) 中并触发`gem install anygemwithdependencieshere`(by example `cucumber-2.99.0`)

它是干的，因为在安装任何 gem 之后，默认情况下 ruby​​gems 将 gem 文件放在缓存 gem 目录中，并且没有意义重复那些文件，如果您希望两台计算机具有相同的版本（或被偏执的安全规则阻止：v），它会更容易

> 编辑：在 ruby​​ 或 ruby​​gems 的某些版本中，它不起作用并发出警报或错误，您可以将 gem 放在其他地方但不会干燥，其他替代方法是使用启动集成命令`gem server`并在 gem 源中添加 localhost url，更多信息在： [https ://guides.rubygems.org/run-your-own-gem-server/](https://guides.rubygems.org/run-your-own-gem-server/)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-10-30T05:32:06.773

[您可以从https://rubygems.org/gems/](https://rubygems.org/gems/)下载 gem，或者通过 bundle 和 rack 构建本地 gem。

例如：

*   捆绑宝石 yourGemName
*   耙式安装

在安装实际的 gem 之前，请注意安装依赖项。

*   gem install --local /pathToFolder/xxx-2.6.1.gem

注意：如果在同一台机器上使用 fluentd td-agent 和 ruby​​。请确保使用 td-agent 的 td-agent-gem 命令。td-agent 有自己的 Ruby。

# algorithm - 用于文本分析的算法或库，特别是：主要词、跨文本的短语和文本集合

> ID：220187
> 
> 赞同：21
> 
> 时间：2008-10-20T22:38:22.947
> 
> 标签：algorithm, text, nlp, analysis, lexical-analysis

我正在做一个项目，我需要分析一页文本和一组文本来确定主导词。我想知道是否有一个库（首选 c# 或 java）可以为我处理繁重的工作。如果没有，是否有一种或多种算法可以实现我的以下目标。

我想做的类似于从您在网络上找到的 url 或 rss 提要构建的词云，除了我不想要可视化。它们一直用于分析总统候选人的演讲，以了解主题或最常用的词是什么。

复杂之处在于我需要对数千个短文档执行此操作，然后是这些文档的集合或类别。

我最初的计划是解析文档，然后过滤常用词 - of、the、he、she 等。然后计算剩余词在文本中出现的次数（以及整个集合/类别）。

问题是将来我想处理词干、复数形式等。我也想看看有没有办法识别重要的短语。（而不是一个单词的计数，一个短语的计数是2-3个单词一起）

任何有关策略、库或算法的指导都将受到赞赏。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-20T22:53:26.693

您正在做的一个选择是词频到逆文档频率，或 tf-idf。在此计算下，最强项将具有最高权重。检查是否在这里：[http ://en.wikipedia.org/wiki/Tf-idf](http://en.wikipedia.org/wiki/Tf-idf)

另一种选择是使用诸如朴素贝叶斯分类器之类的东西，使用单词作为特征，并找出文本中最强的特征来确定文档的类别。这将与最大熵分类器类似地工作。

就执行此操作的工具而言，最好的工具是 NLTK，这是​​一个包含大量文档和教程的 Python 库：http: [//nltk.sourceforge.net/](http://nltk.sourceforge.net/)

对于 Java，请尝试 OpenNLP： [http ://opennlp.sourceforge.net/](http://opennlp.sourceforge.net/)

对于短语 stuff，考虑我提供的第二个选项，即使用二元组和三元组作为特征，甚至作为 tf-idf 中的术语。

祝你好运！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-20T23:21:44.157

添加到罗伯特埃尔韦尔的答案：

*   词干和折叠词形式。英语中一个简单的方法是在小写单词形式上 使用[Porter Stemming 。](http://tartarus.org/~martin/PorterStemmer/)
*   “常用词”的一个术语是“停止词”或“停止列表”
*   按照建议通读 NLTK 书将很好地解释许多这些介绍性问题。
*   您必须解决的一些问题是解析句子（这样您的二元组和 n-gram 短语不会跨越句子边界），将句子拆分为标记，以及决定如何处理所有格形式。

这些东西都不是明确的，也没有任何“正确答案”。另请参阅“nlp”和“自然语言”SO 标签。

祝你好运！这是一个不平凡的项目。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-05T00:35:14.423

好的。所以你有一个包含文本的文档和一个文档集合（语料库）。有很多方法可以做到这一点。

我建议使用 Lucene 引擎 (Java) 来索引您的文档。Lucene 支持一种数据结构（索引），它在其中维护许多文档。文档本身是一个数据结构，可以包含“字段”——比如作者、标题、文本等。您可以选择哪些字段被索引，哪些字段不被索引。

将文档添加到索引是[微不足道](http://www.javaranch.com/journal/2004/04/Lucene.html)的。Lucene 也是为速度而构建的，并且可以很好地扩展。

接下来，您想弄清楚术语和频率。由于 lucene 在索引过程中已经为您计算了这个，您可以使用 docFreq 函数并构建您自己的词频函数，或者使用 IndexReader 类的 getTermFreqVectors 函数来获取词条（及其频率）。

现在由您决定如何对其进行排序以及您要使用什么标准来过滤您想要的单词。要找出关系，您可以使用 wordnet 开源库的 Java API。要词干，请使用 Lucene 的 PorterStemFilter 类。短语重要性部分比较棘手，但是一旦您走到了这一步 - 您可以搜索有关如何将 n-gram 搜索集成到 Lucene 中的[提示（提示）](http://lucene.apache.org/java/2_2_0/api/org/apache/lucene/analysis/ngram/package-summary.html)。

祝你好运！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T00:54:09.087

您可以使用 Windows 平台 SDK 附带的 Windows 索引服务。或者，只需阅读以下介绍以了解 NLP 的概述。

[http://msdn.microsoft.com/en-us/library/ms693179(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms693179(VS.85).aspx) [http://i.msdn.microsoft.com/ms693179.wbr-index-create(en-us,VS. 85).gif](http://i.msdn.microsoft.com/ms693179.wbr-index-create(en-us,VS.85).gif)

[http://i.msdn.microsoft.com/ms693179.wbr-query-process(en-us,VS.85).gif](http://i.msdn.microsoft.com/ms693179.wbr-query-process(en-us,VS.85).gif)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-29T18:20:30.420

> 我还想看看是否有办法识别重要的短语。（而不是一个单词的计数，一个短语的计数是2-3个单词一起）

这部分问题称为[搭配提取](http://en.wikipedia.org/wiki/Collocation%5Fextraction)。（至少如果您将“重要短语”视为出现频率明显高于偶然出现的短语。）我在另一个关于该特定子问题的[SO 问题上](https://stackoverflow.com/questions/1643616/algorithms-to-detect-phrases-and-keywords-from-text)[给出了答案。](https://stackoverflow.com/questions/1643616/algorithms-to-detect-phrases-and-keywords-from-text/1645429#1645429)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-22T04:00:41.360

检查 MapReduce 模型以获取字数，然后按照 tf-idf 中所述导出频率

Hadoop 是一个 apache MapReduce 框架，可用于对许多文档进行字数统计的繁重任务。 [http://hadoop.apache.org/common/docs/current/mapred_tutorial.html](http://hadoop.apache.org/common/docs/current/mapred_tutorial.html)

您无法获得一个可以解决您想要的所有问题的单一框架。你必须选择正确的概念和框架组合才能得到你想要的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-04-10T12:51:09.940

您正在寻找的似乎是词袋文档聚类/分类。您将通过此搜索找到指导。

# javascript - 如何确定是否已将动态创建的 DOM 元素添加到 DOM？

> ID：220188
> 
> 赞同：41
> 
> 时间：2008-10-20T22:38:38.377
> 
> 标签：javascript, dom

[**根据 spec**](http://www.w3.org/TR/REC-html40/interact/scripts.html)，只有`BODY`and`FRAMESET`元素提供了一个“onload”事件来附加，但我想知道一个动态创建的 DOM 元素何时被添加到 JavaScript 中的 DOM 中。

我目前正在使用的超幼稚启发式方法如下：

*   向后遍历元素的**parentNode**属性，直到找到最终的祖先（即parentNode.parentNode.parentNode.etc直到parentNode为null）

*   如果最终祖先具有已定义的非空**主体**属性

    *   假设有问题的元素是 dom 的一部分
*   别的

    *   在 100 毫秒内再次重复这些步骤

我所追求的要么是确认我所做的是足够的（同样，它在 IE7 和 FF3 中都有效），要么是一个更好的解决方案，无论出于何种原因，我都完全没有注意到；也许我应该检查其他属性等。

* * *

编辑：我想要一种与浏览器无关的方式，不幸的是，我并不生活在一个浏览器的世界中；也就是说，感谢您提供特定于浏览器的信息，但请注意您知道它可以在哪个浏览器*中*运行。谢谢！

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-05-12T03:10:34.650

更新：对于任何对此感兴趣的人，这是我最终使用的实现：

```
function isInDOMTree(node) {
   // If the farthest-back ancestor of our node has a "body"
   // property (that node would be the document itself), 
   // we assume it is in the page's DOM tree.
   return !!(findUltimateAncestor(node).body);
}
function findUltimateAncestor(node) {
   // Walk up the DOM tree until we are at the top (parentNode 
   // will return null at that point).
   // NOTE: this will return the same node that was passed in 
   // if it has no ancestors.
   var ancestor = node;
   while(ancestor.parentNode) {
      ancestor = ancestor.parentNode;
   }
   return ancestor;
} 
```

我想要这样做的原因是提供一种`onload`为 DOM 元素合成事件的方法。这是那个函数（虽然我使用的东西略有不同，因为我将它与[**MochiKit**](http://www.mochikit.com/)结合使用）：

```
function executeOnLoad(node, func) {
   // This function will check, every tenth of a second, to see if 
   // our element is a part of the DOM tree - as soon as we know 
   // that it is, we execute the provided function.
   if(isInDOMTree(node)) {
      func();
   } else {
      setTimeout(function() { executeOnLoad(node, func); }, 100);
   }
} 
```

例如，可以按如下方式使用此设置：

```
var mySpan = document.createElement("span");
mySpan.innerHTML = "Hello world!";
executeOnLoad(mySpan, function(node) { 
   alert('Added to DOM tree. ' + node.innerHTML);
});

// now, at some point later in code, this
// node would be appended to the document
document.body.appendChild(mySpan);

// sometime after this is executed, but no more than 100 ms after,
// the anonymous function I passed to executeOnLoad() would execute 
```

希望这对某人有用。

注意：我最终选择此解决方案而不是[**Darryl 的答案**](https://stackoverflow.com/questions/220188/how-can-i-determine-if-a-dynamically-created-dom-element-has-been-added-to-the-do/220224#220224)的原因是 getElementById 技术仅在您位于同一文档中时才有效；我在页面上有一些 iframe，页面之间以一些复杂的方式相互通信 - 当我尝试这个时，问题是它找不到元素，因为它是与它正在执行的代码不同的文档的一部分.

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2012-12-05T14:57:11.840

最直接的答案是使用[`Node.contains`](https://developer.mozilla.org/en-US/docs/DOM/Node.contains)Chrome、Firefox (Gecko)、Internet Explorer、Opera 和 Safari 支持的方法。这是一个例子：

```
var el = document.createElement("div");
console.log(document.body.contains(el)); // false
document.body.appendChild(el);
console.log(document.body.contains(el)); // true
document.body.removeChild(el);
console.log(document.body.contains(el)); // false 
```

理想情况下，我们会使用`document.contains(el)`，但这在 IE 中不起作用，所以我们使用`document.body.contains(el)`.

不幸的是，您仍然需要轮询，但检查一个元素是否在文档中非常简单：

```
setTimeout(function test() {
  if (document.body.contains(node)) {
    func();
  } else {
    setTimeout(test, 50);
  }
}, 50); 
```

如果您可以在页面中添加一些 CSS，这是另一种使用动画检测节点插入的巧妙技术：[http ://www.backalleycoder.com/2012/04/25/i-want-a-damnodeinserted/](http://www.backalleycoder.com/2012/04/25/i-want-a-damnodeinserted/)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2013-04-06T00:18:42.487

无需将 DOM 树向上移动到文档元素，只需使用`element.ownerDocument`. 看到这里：[https](https://developer.mozilla.org/en-US/docs/DOM/Node.ownerDocument) ://developer.mozilla.org/en-US/docs/DOM/Node.ownerDocument 并这样做：

```
element.ownerDocument.body.contains(element) 
```

你很好。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-10-20T22:53:14.713

你能不做`document.getElementById('newElementId');`，看看是否返回true。如果没有，就像你说的，等待 100 毫秒再试一次？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-21T05:51:42.403

您可以查询**document.getElementsByTagName("*").length**或创建自定义 appendChild 函数，如下所示：

```
var append = function(parent, child, onAppend) {
  parent.appendChild(child);
  if (onAppend) onAppend(child);
}

//inserts a div into body and adds the class "created" upon insertion
append(document.body, document.createElement("div"), function(el) {
  el.className = "created";
}); 
```

**更新**

*根据要求，将我评论中的信息添加到我的帖子中*

[John Resig](http://ajaxian.com/archives/peppy-css3-selector-engine#comments)今天在 Ajaxian 上对 Peppy 库发表了评论，似乎暗示他的 Sizzle 库可能能够处理 DOM 插入事件。我很想知道是否也会有处理 IE 的代码

按照轮询的想法，我读到某些元素属性在元素被附加到文档之前不可用（例如 element.scrollTop），也许您可​​以轮询它而不是执行所有 DOM 遍历。

最后一件事：在 IE 中，可能值得探索的一种方法是使用 onpropertychange 事件。我认为将其附加到文档中必然会触发至少一个属性的该事件。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-21T16:07:30.367

在一个完美的世界中，您可以挂钩突变事件。我怀疑它们即使在标准浏览器上也能可靠地工作。听起来您已经实现了一个突变事件，因此您可以添加它以使用本机突变事件，而不是在支持这些事件的浏览器上进行超时轮询。

我已经看到 DOM-change 实现通过与`document.body.innerHTML`last saved 进行比较来监控更改`.innerHTML`，这并不完全优雅（但有效）。由于您最终要检查是否已添加特定节点，因此最好只检查每个中断。

我能想到的改进是~~使用`.offsetParent`而不是`.parentNode`因为它可能会使一些父母脱离你的循环~~（看评论）。或者`compareDocumentIndex()`在除 IE 之外的所有设备上使用并测试 IE`.sourceIndex`的属性（如果节点不在 DOM 中，则应为 -1）。

这也可能有帮助：[John Resig 的 X 浏览器 compareDocumentIndex 实现](http://ejohn.org/blog/comparing-document-position/)。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2018-01-30T06:07:07.767

**[MutationObserver](https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver)用于检测元素何时添加到 DOM。**现在，所有现代浏览器（Chrome 26+、Firefox 14+、IE11、Edge、Opera 15+ 等）都广泛支持 MutationObservers。

这是一个简单的示例，说明如何使用 a`MutationObserver`来侦听何时将元素添加到 DOM。

为简洁起见，我使用 jQuery 语法来构建节点并将其插入 DOM。

```
var myElement = $("<div>hello world</div>")[0];

var observer = new MutationObserver(function(mutations) {
   if (document.contains(myElement)) {
        console.log("It's in the DOM!");
        observer.disconnect();
    }
});

observer.observe(document, {attributes: false, childList: true, characterData: false, subtree:true});

$("body").append(myElement); // console.log: It's in the DOM! 
```

`observer`每当从`document`. 在处理程序内部，我们然后执行`contains`检查以确定`myElement`现在是否在`document`.

您不需要遍历存储的每个 MutationRecord，`mutations`因为您可以`document.contains`直接在`myElement`.

要提高性能，请替换`document`为将包含`myElement`在 DOM 中的特定元素。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-20T22:42:01.147

您想要`DOMNodeInserted`事件（或`DOMNodeInsertedIntoDocument`）。

编辑：IE 完全有可能不支持这些事件，但我现在无法测试。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-03-10T00:29:33.520

这是从 jQuery 代码中提取的问题的另一个解决方案。以下函数可用于检查节点是否附加到 DOM 或是否“断开连接”。

```
功能已断开连接（节点）{
    返回！节点 || !node.parentNode || node.parentNode.nodeType === 11;
}

```

一个 nodeType === 11 定义了一个 DOCUMENT_FRAGMENT_NODE，它是一个没有连接到文档对象的节点。

有关更多信息，请参阅 John Resig 的以下文章：http: [//ejohn.org/blog/dom-documentfragments/](http://ejohn.org/blog/dom-documentfragments/)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-04-11T00:28:08.360

```
var finalElement=null; 
```

我在循环中构建 dom 对象，当循环处于最后一个循环并且`lastDomObject`然后创建时：

```
 finalElement=lastDomObject; 
```

离开循环：

```
while (!finalElement) { } //this is the delay... 
```

下一个动作可以使用任何新创建的 dom 对象。它在第一次尝试时起作用。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-10-20T23:03:28.780

**IE 中不**支持DOMNodeInserted或**DOMNodeInsertedIntoDocument**事件。DOM 的 IE [only] 功能中缺少的另一个功能是**compareDocumentPosition**函数，该函数旨在执行其名称所暗示的操作。

 ****至于建议的解决方案，我认为没有更好的解决方案（除非你做了一些肮脏的技巧，比如覆盖原生 DOM 成员实现）

另外，更正问题的标题：动态创建的元素从创建的那一刻起就是 DOM 的一部分，它可以附加到文档片段或另一个元素，但它可能不会附加到文档。

我还认为您描述的问题不是您遇到的问题，这看起来是您问题的潜在解决方案之一。你能详细解释一下用例吗？

# c# - 你如何运行一个你不知道参数从哪里开始的程序？

> ID：220202
> 
> 赞同：2
> 
> 时间：2008-10-20T22:46:16.457
> 
> 标签：c#, .net, registry, system.diagnostics, processstartinfo

题主不多说，一句话就不好问了。我必须执行一些从注册表中读取的程序。我必须从有人保存整个路径和参数的字段中读取。
我一直在使用 System.Diagnostics.ProcessStartInfo 设置程序的名称及其参数，但我发现了各种各样的参数，我必须解析这些参数才能将进程可执行文件保存在一个字段中，并将其参数保存在另一个字段中。

有没有办法按原样执行整个字符串？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-21T02:15:35.817

我已经以与上面的海报相同的方式解决了这个问题，使用带有进程启动信息的 cmd.exe。

```
Process myProcess = New Process;
myProcess.StartInfo.FileName = "cmd.exe";
myProcess.StartInfo.Arguments = "/C " + cmd;
myProcess.StartInfo.WindowStyle = ProcessWindowStyle.Hidden;
myProcess.StartInfo.CreateNoWindow = True;
myProcess.Start();
myProcess.WaitForExit();
myProcess.Close(); 
```

cmd /c 执行命令，然后终止。WaitForExit 如果运行时间过长将终止进程。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-20T22:53:50.203

事实上，有几个。

1.  您可以使用 /C [您的命令行] 作为参数调用 cmd.exe。这会导致 cmd.exe 处理您的命令，然后退出。
2.  您可以将命令写入批处理文件并启动它。

当然还有你现在采用的方法，即解析命令行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T02:43:51.623

如果未设置“ [UseShellExecute ”，则 System.Diagnostics.Process 调用](http://msdn.microsoft.com/en-us/library/system.diagnostics.processstartinfo.useshellexecute.aspx)[CreateProcess](http://msdn.microsoft.com/en-us/library/ms682425(VS.85).aspx)或[CreateProcessAsUser](http://msdn.microsoft.com/en-us/library/ms682429.aspx)以实际启动程序（如果您指定用户/域/密码，它将使用第二个程序）。并且这两个调用都可以将命令和文件作为单个参数。来自 MSDN：

> The lpApplicationName parameter can be NULL. In that case, the module name must be the first white space–delimited token in the lpCommandLine string. ...

lpApplication name maps to ProcessStartInfo.Filename and lpCommandLine maps to Arguments. So you should be albe to just go:

```
var processStartInfo = new ProcessStartInfo()
{
    UseShellExecute = false,
    Arguments = cmd
};
Process.Start(processStartInfo); 
```

# winforms - WinForms WebBrowser 控件是否支持 DocumentText 属性设置的 mhtml 内容？

> ID：220203
> 
> 赞同：3
> 
> 时间：2008-10-20T22:47:02.790
> 
> 标签：winforms

或者，如果任何机构知道替代控制？

将内容提供给 WebBrowser 控件会很方便，该控件具有来自数据库的嵌入图像和其他资源，而不依赖于托管在 Web 服务器上的这些资源或在本地文件系统上创建临时文件。

Mhtml 支持这一点，但在使用 DocumentText 属性时似乎在 WebBrowser 控件中不起作用？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T02:15:55.863

我认为使用 DocumentText 属性不可能实现您想要实现的目标。MHTML 是一种文档存档格式，虽然它存储为带有二进制数据（如图像等）编码为 base64 字符串的文本，但似乎没有任何智能内置到 webbrowser 控件的 DocumentText 属性中来读取此文件格式。使用 Reflector 查看此属性，您会发现使用了不同的机制来处理此问题，而不是 Url 属性，后者通过底层 COM 对象调用 webbrowser 控件的“胆量”。

您似乎也无法通过写入 DocumentStream 属性来完成此操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-20T22:58:23.873

似乎为我工作。

例子：

```
this.webBrowser1.Url = new System.Uri(@"C:\TempFiles\MyTest.mht"); 
```

特别是什么不能正常工作？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T09:19:02.970

COM“黑客”解决方案在这里：

[如何让 C# WebBrowser 控件显示 jpeg 文件（原始）？](https://stackoverflow.com/questions/290035/how-do-i-get-a-c-webbrowser-control-to-show-jpeg-files-raw)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T02:18:25.047

您可以创建一个包含所有图像的标准编译资源程序集（非托管，不确定托管），然后像这样链接到库：

<img src="res://yourdll.dll/image.jpg" />

可以在这里找到一篇非常好的文章和一个好的实现：http: [//www.delphidabbler.com/articles? article=10](http://www.delphidabbler.com/articles?article=10)

就我个人而言，我只是将 vb6 编译器用于资源并链接到它们，但大多数非托管编译器都会做同样的事情。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2011-01-19T17:22:09.113

请参考这个答案[c# filenotfoundexception on webbrowser?](https://stackoverflow.com/questions/4737823/c-filenotfoundexception-on-webbrowser/4738244#4738244)

# php - 在 Web 表单中创建 AJAX 自动建议文本框的最佳库是什么？

> ID：220211
> 
> 赞同：6
> 
> 时间：2008-10-20T22:49:36.997
> 
> 标签：php, javascript, ajax

我正在为工作创建一个 Web 应用程序，用户必须输入请求工作的人的姓名。我想创建一个简单的 AJAX 自动建议下拉菜单，这样他们就不需要输入整个名称。在后端，数据库将根据之前的条目提供建议。该网站是使用 CakePHP 1.1 构建的。

我知道那里有很多图书馆，有些比其他图书馆更好。你认为哪一个是最快和最容易实现的？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-20T23:11:06.610

由于您使用的是 CakePHP 1.1，我建议您查看处理[Helpers的手册部分](http://book.cakephp.org/view/316/Helpers)

如果你进入“AJAX”，你可以看到你可以在你的控制器中做这样的事情：

```
function autocomplete () {
    $this->set('people',
    $this->Person->findAll("name LIKE '%{$this->data['Person']['name']}%'")
    );
    $this->layout = "ajax";
} 
```

在您`autocomplete.thtml`看来，您将拥有：

```
<ul>
<?php foreach($people as $person): ?>
<li><?php echo $person['Person']['name']; ?></li>
<?php endforeach; ?>
</ul> 
```

要在另一个视图中创建自动完成字段，您可以：

```
<form action="/people/index" method="POST">
<?php echo $ajax->autoComplete('Person/name', '/people/autocomplete/')?>
<?php echo $html->submit('View Person')?>
</form> 
```

为了让它工作，你需要在你的`helpers`数组中有'Ajax'，并包含 Prototype/script.aculo.us 库。

祝你好运。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T22:58:21.097

我在[Brand Spanking New](http://www.brandspankingnew.net/archive/2007/02/ajax_auto_suggest_v2.html)的 Auto-Suggest 实施方面取得了巨大成功。它也包括 PHP 示例。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-20T23:07:33.450

jQuery 不会出错。[http://nodstrum.com/2007/09/19/autocompleter/](http://nodstrum.com/2007/09/19/autocompleter/)

# php - PHP 最容易使用的 ORM 框架是什么？

> ID：220229
> 
> 赞同：17
> 
> 时间：2008-10-20T22:54:24.977
> 
> 标签：php, orm

我正在寻找 Ruby 的 PHP 活动记录。很简单，我只需要定义我的字段，扩展基本的 ORM 类，就可以免费获得 ACID 操作。我应该在不编写任何代码的情况下获得默认的 getter 和 setter，但是覆盖默认的 getter 或 setter 就像用我想要的行为声明 get$fieldName 或 set$fieldName 函数一样简单。Symphony 让您为每个对象创建大约 5 个文件，并且据我所知，所有已定义的对象总是加载。什么是更好的选择？为什么更好？你能在你的答案中放一些简单的例子吗？

Doctrine 是我看过的另一个 ORM 除了 symphony 。您还需要创建描述数据结构的 yaml 文件。数据库已经定义了这些东西。什么会读取我的表定义而不必在任何地方生成和存储配置文件？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-21T22:48:04.347

[我是Doctrine](http://www.doctrine-project.org/)的忠实粉丝，它是一个功能齐全的 ORM，它将取代 Propel 作为 Symfony 的默认 ORM。

它具有您所期望的基本 ORM 内容以及我发现非常棒的全功能查询构建器。

它带有一整套命令行工具来管理您的数据库。例如，您可以在 YAML 中创建架构和固定装置，让 Doctrine 基于您的架构生成类，创建数据库，根据模型创建架构，然后使用您的固定装置填充数据库，所有这些都使用单个`./doctrine build-all-reload`.

它还包括对数据库迁移的支持，并且[最近更新](http://www.doctrine-project.org/blog/new-to-migrations-in-1-1)了迁移以自动区分和生成您的迁移模型。

**根据您的原则投诉，您可以运行命令`./doctrine generate-models-db`或`./doctrine generate-yaml-db`从当前数据库设置分别自动创建模型和 yaml 文件。**

其他细节包括“[行为](http://www.doctrine-project.org/documentation/manual/1_0?one-page#behaviors)”，当在你的模式中实现某些行为时，它使生活变得更加容易。例如，您可以将“Timestampable”行为添加到您的类文件中。Doctine 自动添加 'created_at' 和 'updated_at' 列，填充它们，并且每次`$object->save()`运行都会自动更新 'updated_at' 列。更复杂的行为包括 i18n、表版本控制和树（尽管实际上只有 NestedSet）。

就我个人而言，我非常迷恋 Doctrine，并且一有机会就对它赞不绝口。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-09-18T09:30:27.140

我使用了一个鲜为人知的 orm 层，叫做 redbean。你可以在这里找到它：[http](http://www.redbeanphp.com) ://www.redbeanphp.com 。从某种意义上说，它绝对是独一无二的，它只是自己创建表列和索引，根本没有任何配置文件。我发现它是一个巨大的节省时间！

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-20T23:33:52.010

CodeIgniter ( [http://codeigniter.com/user_guide/database/active_record.html](http://codeigniter.com/user_guide/database/active_record.html) ) 和它的 PHP5 only fork Kohana ( [http://docs.kohanaphp.com/libraries/orm](http://docs.kohanaphp.com/libraries/orm) ) 都包含 ActiveRecord 模式的实现。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-20T23:35:37.840

我已经创建了自己的，没有臃肿。（虽然我需要更新我的现场资源）

我创建它时完全考虑了您提到的要点：没有几十个 xml 文件，没有庞大的框架，只是带有数据库到属性映射的简单构造函数，它可以完成基本的 CRUD / Find / Join 工作。对于我所做的大部分事情，我什至不需要编写自定义查询。

我之前也在[我的网站](http://www.schizofreend.nl/Pork.dbObject/)上写过所有这些内容，请务必查看[基本示例](http://www.schizofreend.nl/Pork.dbObject/Examples/)以了解它。

我将发布的下一个版本带有工作单线连接 on join on join（通过数据库走一条“路径”）、基于 ini 的数据库设置、跨数据库支持、超级简单的数据库抽象和一个标准的记录器如果您的数据库已关闭，请返回 SQLite。

如果您对更新感兴趣，请大声喊叫，我会尽快处理。

哦，是的，别忘了，还有一个不错的可视化脚手架生成器，叫做[Pork.Generator](http://www.schizofreend.nl/Pork.Generator/)。它会尝试分析您的数据库结构并找到 1:1 1:many 和 many:many 关系，并可以自动为您生成类 :-) [（来源：][[schizofreend.nl](http://www.schizofreend.nl/images/demo3.jpg)][）][![在数据库中找到的关系](https://i.stack.imgur.com/EhOnm.jpg)](https://i.stack.imgur.com/EhOnm.jpg)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-20T23:21:21.193

[Zend_Db_Table](http://framework.zend.com/manual/en/zend.db.table.html)和[Zend_Db_Table_Row](http://framework.zend.com/manual/en/zend.db.table.row.html)非常适合您所描述的内容。您不需要任何配置文件，大多数元数据都是从数据库本身“发现”的。

从技术上讲，这些类不实现 ActiveRecord 模式。相反，它们实现了[表数据网关](http://martinfowler.com/eaaCatalog/tableDataGateway.html)和[行数据网关](http://martinfowler.com/eaaCatalog/rowDataGateway.html)模式。它们一起提供与 ActiveRecord 相似的价值，并且在某些方面比 ActiveRecord 更灵活。

但与任何 ORM 一样，不可避免地存在一些您无法通过 OO 接口进行的 SQL 查询和操作。没有 ORM 可以作为一站式购物。

脚注：我在 Zend Framework 项目上工作了一年多一点，尤其是 Zend_Db 组件。但我不再为他们工作了。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-25T00:16:25.387

检查可维护的框架。尽管我更喜欢代码生成而不是 ActiveRecord（运行时反射），但我发现可维护框架易于使用，尤其是在 ORM 功能方面。

[http://framework.maintainable.com/mvc/3_model.php#c3.7](http://framework.maintainable.com/mvc/3_model.php#c3.7)

如果你想要一个基于代码生成的框架，试试 QCodo。无论 dcousineau 对 Doctrine 说什么，我都可以对 Qcodo 说。这是一个模仿 .NET/Delphi 的事件驱动的成熟框架。但是，您可以只使用代码生成功能并找到将生成的类与框架的其余部分分离的方法。因此，您可以将生成的类嵌入到其他框架中。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-08-20T21:31:39.670

遵循 Ruby DataMapper 实现的另一个选项是[phpDataMapper](http://phpdatamapper.com)。它显然是一个数据映射器而不是一个 ActiveRecord :)。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-01-15T10:45:42.370

我会推荐使用 Symfony 的 Doctrine。尽管还有更多要学习的内容，但您会发现它具有项目发展后所需的功能（CRUD、表单框架、记录模板、DQL、插件支持、行为）。这两个项目都有非常活跃的社区，你不应该发现自己陷入了死胡同，因为你的大部分问题已经在官方教程或论坛中得到了解答。

如果您不喜欢 YAML 中的数据库定义，您可以随时使用[ORM Designer](http://www.orm-designer.com)或 MySQL Workbench。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-02-02T05:10:26.080

我推荐[QCubed](http://qcu.be)。这是一个非常强大的仅 PHP5 的 ORM 框架，专注于代码生成、UI 脚手架和快速应用程序开发。看看培训视频：http: [//qcu.be/content/video-screencasts](http://qcu.be/content/video-screencasts)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-10-19T21:02:45.120

[http://dbphp.net](http://dbphp.net)

优点

*   动态生成/修改数据库/表/字段/各种表/字段属性。
*   无需安装。
*   根本没有配置。
*   只需要包含库并指定数据库链接参数即可开始工作。
*   它内置了本地化支持。
*   它具有各种缓存级别并允许扩展缓存引擎。
*   它同时适用于许多不同的数据库连接。
*   它可以在位于其他数据库服务器的表之间建立关系。
*   它使用类和变量文档注释提取表/字段属性。

缺点

*   它仅适用于对象。即您必须定义类并具有类实例以节省负载等。
*   它没有站点，但有示例文件夹。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-09-07T21:34:54.950

我喜欢[Idiorm 和 Paris](http://j4mie.github.io/idiormandparis/)，并在小型项目中使用它们。Idiorm 是实际的 ORM，而 Paris 是活动记录实现。您可以使用您喜欢的任何一种。

还有一个名为[Granada](https://github.com/Surt/Granada)的 fork ，它建立在 Idiorm 和 Paris 之上，并增加了诸如急切加载等支持。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-10-04T05:34:10.380

位于强大的数据库抽象层 (DBAL) 之上的 PHP 对象关系映射器 (ORM)。它的一个关键特性是可以选择用一种专有的面向对象的 SQL 方言编写数据库查询，这种方言称为 Doctrine Query Language (DQL)，受 Hibernates HQL 的启发。这为开发人员提供了一种强大的 SQL 替代方案，可以保持灵活性，而无需不必要的代码重复。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-10-26T18:20:57.053

如果您想要一个“动态”数据库建模，其中表自动适应您从代码推送的数据，请查看用于[DataMapper](https://foxorm.com/)方法的 FoxORM 或[用于](http://redbeanphp.com/)ActiveRecord 方法的 RedBean

# javascript - 在 JavaScript 中访问网页的 HTTP 标头

> ID：220231
> 
> 赞同：467
> 
> 时间：2008-10-20T22:54:38.767
> 
> 标签：javascript, http, http-headers

如何通过 JavaScript 访问页面的 HTTP 响应标头？

[**与此问题**](https://stackoverflow.com/questions/220149/how-do-i-access-the-http-request-header-fields-via-javascript)相关，该问题已修改为询问有关访问两个特定 HTTP 标头的问题。

> **相关：**
> [如何通过 JavaScript 访问 HTTP 请求标头字段？](https://stackoverflow.com/questions/220149/how-do-i-access-the-http-request-header-fields-via-javascript)

* * *

## 回答 #1

> 赞同：401
> 
> 时间：2011-02-03T01:26:52.083

无法读取当前标题。您可以向同一个 URL 发出另一个请求并读取其标头，但不能保证标头与当前标头完全相同。

* * *

使用以下 JavaScript 代码通过执行`get`请求来获取所有 HTTP 标头：

```
var req = new XMLHttpRequest();
req.open('GET', document.location, false);
req.send(null);
var headers = req.getAllResponseHeaders().toLowerCase();
alert(headers); 
```

* * *

## 回答 #2

> 赞同：328
> 
> 时间：2008-10-20T22:55:12.477

不幸的是，没有 API 可以为您的初始页面请求提供 HTTP 响应标头。这是此处发布的原始问题。它也被[反复询问](https://stackoverflow.com/questions/12258705/how-can-i-read-the-current-headers-without-making-a-new-request-with-js)，因为有些人希望获得原始页面请求的实际响应标头而不发出另一个。

# 
对于 AJAX 请求：

如果通过 AJAX 发出 HTTP 请求，则可以使用该**`getAllResponseHeaders()`**方法获取响应标头。它是 XMLHttpRequest API 的一部分。要了解如何应用此功能，请查看*`fetchSimilarHeaders()`*以下功能。请注意，这是对某些应用程序不可靠的问题的解决方法。

```
myXMLHttpRequest.getAllResponseHeaders(); 
```

*   API 在 XMLHttpRequest 的以下候选推荐中指定：[XMLHttpRequest - W3C Candidate Recommendation 3 August 2010](http://www.w3.org/TR/XMLHttpRequest/#the-getresponseheader-method)

*   具体来说，该`getAllResponseHeaders()`方法在以下部分中指定：[w3.org: `XMLHttpRequest`: the `getallresponseheaders()`method](http://www.w3.org/TR/XMLHttpRequest/#the-getallresponseheaders()-method)

*   MDN 文档也很好：[developer.mozilla.org:`XMLHttpRequest`](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest)。

这不会为您提供有关原始页面请求的 HTTP 响应标头的信息，但它可以用于对这些标头进行有根据的猜测。更多内容将在接下来进行描述。

# 
从初始页面请求中获取标头值：

这个问题是几年前首次提出的，专门询问如何获取*当前页面*（即运行 javascript 的同一页面）的原始 HTTP 响应标头。这是一个与简单地获取任何 HTTP 请求的响应标头完全不同的问题。对于初始页面请求，标头不适用于 javascript。如果您通过 AJAX 再次请求同一页面，您需要的标头值是否可靠且足够一致将取决于您的特定应用程序。

以下是解决该问题的一些建议。

## 
1\. 对资源的请求主要是静态的

如果响应基本上是静态的，并且请求之间的标头不会发生太大变化，您可以对当前所在的同一页面发出 AJAX 请求，并假设它们是相同的值，它们是页面的一部分HTTP 响应。这可以让您使用上面描述的不错的 XMLHttpRequest API 访问所需的标头。

```
function fetchSimilarHeaders (callback) {
    var request = new XMLHttpRequest();
    request.onreadystatechange = function () {
        if (request.readyState === XMLHttpRequest.DONE) {
            //
            // The following headers may often be similar
            // to those of the original page request...
            //
            if (callback && typeof callback === 'function') {
                callback(request.getAllResponseHeaders());
            }
        }
    };

    //
    // Re-request the same page (document.location)
    // We hope to get the same or similar response headers to those which 
    // came with the current page, but we have no guarantee.
    // Since we are only after the headers, a HEAD request may be sufficient.
    //
    request.open('HEAD', document.location, true);
    request.send(null);
} 
```

如果您确实必须依赖请求之间的值保持一致，这种方法将是有问题的，因为您不能完全保证它们是相同的。这将取决于您的特定应用程序以及您是否知道您需要的值不会从一个请求更改为下一个请求。

## 
2\. 做出推论

浏览器通过查看标题来确定**一些 BOM 属性**（浏览器对象模型）。其中一些属性直接反映 HTTP 标头（例如`navigator.userAgent`，设置为 HTTP`User-Agent`标头字段的值）。通过嗅探可用的属性，您可能能够找到您需要的东西，或者一些指示 HTTP 响应包含的内容的线索。

## 
3\. 把它们藏起来

如果您控制服务器端，则可以在构建完整响应时访问您喜欢的任何标头。值可以与页面一起传递给客户端，隐藏在一些标记中，或者可能是内联的 JSON 结构。如果您想让每个 HTTP 请求标头都可用于您的 javascript，您可以在服务器上遍历它们并将它们作为标记中的隐藏值发送回来。以这种方式发送标头值可能并不理想，但您当然可以针对您需要的特定值执行此操作。这个解决方案也可以说是低效的，但如果你需要它，它可以完成这项工作。

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2008-11-03T21:53:37.983

使用`XmlHttpRequest`您可以拉出当前页面，然后检查响应的 http 标头。

最好的情况是只做一个`HEAD`请求，然后检查标头。

有关这样做的一些示例，请查看[http://www.jibbering.com/2002/4/httprequest.html](http://www.jibbering.com/2002/4/httprequest.html)

只是我的2美分。

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2016-06-11T10:19:03.070

# Service Worker 的解决方案

服务工作者能够访问网络信息，其中包括标头。好的部分是它适用于任何类型的请求，而不仅仅是 XMLHttpRequest。

## 这个怎么运作：

1.  在您的网站上添加服务人员。
2.  监视正在发送的每个请求。
3.  使用该功能向服务人员`fetch`发出请求`respondWith`。
4.  当响应到达时，读取标头。
5.  将服务工作者的标头发送到具有该`postMessage`功能的页面。

## 工作示例：

服务工作者理解起来有点复杂，所以我构建了一个小型库来完成所有这些工作。它在 github 上可用：[https](https://github.com/gmetais/sw-get-headers) ://github.com/gmetais/sw-get-headers 。

## 限制：

*   该网站需要使用**HTTPS**
*   浏览器需要支持[Service Workers](https://developer.mozilla.org/fr/docs/Web/API/Service_Worker_API) API
*   同域/跨域策略在起作用，就像在 XMLHttpRequest 上一样

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2008-10-20T23:34:06.923

将标头信息发送到 JavaScript 的另一种方法是通过 cookie。服务器可以从请求头中提取它需要的任何数据，并将它们发送回`Set-Cookie`响应头中——并且可以在 JavaScript 中读取 cookie。不过，正如keparo 所说，最好只对一两个标题执行此操作，而不是对所有标题执行此操作。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2017-12-09T01:11:13.847

对于那些寻找将所有 HTTP 标头解析为可以作为字典访问的对象的方法的人`headers["content-type"]`，我创建了一个函数`parseHttpHeaders`：

```
function parseHttpHeaders(httpHeaders) {
    return httpHeaders.split("\n")
     .map(x=>x.split(/: */,2))
     .filter(x=>x[0])
     .reduce((ac, x)=>{ac[x[0]] = x[1];return ac;}, {});
}

var req = new XMLHttpRequest();
req.open('GET', document.location, false);
req.send(null);
var headers = parseHttpHeaders(req.getAllResponseHeaders());
// Now we can do:  headers["content-type"] 
```

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2021-02-15T16:15:39.957

# *(2021)无需*额外 HTTP 调用的答案

虽然*通常*无法读取顶级 HTML 导航的任意 HTTP 响应标头，但如果您控制服务器（或途中的中间盒）并希望向 JavaScript 公开一些无法在任何其他方式中轻松公开的信息方式比通过标题：

**您可以使用[`Server-Timing`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Server-Timing)header 来公开任意键值数据，并且它可以被 JavaScript 读取。**

*（*在支持的浏览器中：Firefox 61、Chrome 65、Edge 79；**[还没有 Safari](https://bugs.webkit.org/show_bug.cgi?id=185870#c15)，也没有从 2021.09 开始立即发货的计划；没有 IE）***

例子：

```
server-timing: key;desc="value" 
```

*   您可以多次将此标头[用于多条数据](https://w3c.github.io/server-timing/#examples)：

```
server-timing: key1;desc="value1"
server-timing: key2;desc="value2" 
```

*   或使用其紧凑版本，在一个标头中公开多条数据，以逗号分隔。

```
server-timing: key1;desc="value1", key2;desc="value2" 
```

[Wikipedia](https://www.wikipedia.org/)如何使用此标头来公开有关缓存命中/未命中信息的示例：

[![在 Wikipedia 上使用服务器计时响应标头](https://i.stack.imgur.com/EfChY.png)](https://i.stack.imgur.com/EfChY.png)

代码示例（需要考虑 Safari 和 IE 缺乏浏览器支持）：

```
if (window.performance && performance.getEntriesByType) { // avoid error in Safari 10, IE9- and other old browsers
    let navTiming = performance.getEntriesByType('navigation')
    if (navTiming.length > 0) { // still not supported as of Safari 14...
        let serverTiming = navTiming[0].serverTiming
        if (serverTiming && serverTiming.length > 0) {
            for (let i=0; i<serverTiming.length; i++) {
                console.log(`${serverTiming[i].name} = ${serverTiming[i].description}`)
            }
        }
    }
} 
```

这会登录`cache = hit-front`支持的浏览器。

笔记：

*   [如 MDN](https://developer.mozilla.org/en-US/docs/Web/API/PerformanceServerTiming)所述，API 仅支持 HTTPS
*   如果您的 JS 是从另一个域提供的，则必须添加[Timing-Allow-Origin](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Timing-Allow-Origin)响应标头以使数据对 JS 可读（`Timing-Allow-Origin: *`或`Timing-Allow-Origin: https://www.example.com`）
*   `Server-Timing`headers 还支持`dur`(header) 字段，`duration`在 JS 端可读，但它是可选的，`0`如果未传递，则默认为 JS
*   关于 Safari 支持：请参阅[错误 1](https://bugs.webkit.org/show_bug.cgi?id=184363)​​和[错误 2](https://bugs.webkit.org/show_bug.cgi?id=190609)和[错误 3](https://bugs.webkit.org/show_bug.cgi?id=185870)
*   [您可以在此博客文章](https://calendar.perfplanet.com/2018/server-timing/)中阅读有关服务器计时的更多信息
*   请注意，如果页面对子资源发出过多调用，性能条目缓冲区可能会被页面上的 JS（通过 API 调用）或浏览器清理。因此，您应该尽快捕获数据，和/或改用`PerformanceObserver`API。有关详细信息，请参阅[博客文章](https://vaz.ac/post/clearresourcetimings/)。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2013-01-30T00:06:00.910

您无法访问 http 标头，但其中提供的一些信息在 DOM 中可用。例如，如果您想查看 http referer（原文如此），请使用 document.referrer。对于其他 http 标头，可能还有其他类似的方法。尝试使用谷歌搜索您想要的特定内容，例如“http referer javascript”。

我知道这应该很明显，但是当我真正想要的只是引荐来源时，我一直在搜索诸如“http headers javascript”之类的东西，但没有得到任何有用的结果。我不知道我怎么没有意识到我可以进行更具体的查询。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-10-21T05:44:30.670

如果我们谈论的是*请求*标头，您可以在执行 XmlHttpRequests 时创建自己的标头。

```
var request = new XMLHttpRequest();
request.setRequestHeader("X-Requested-With", "XMLHttpRequest");
request.open("GET", path, true);
request.send(null); 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2019-11-10T18:57:30.603

阿兰·拉隆德的链接让我很开心。只需在此处添加一些简单的工作 html 代码。
适用于自古以来任何合理的浏览器以及 IE9+ 和 Presto-Opera 12。

```
<!DOCTYPE html>
<title>(XHR) Show all response headers</title>

<h1>All Response Headers with XHR</h1>
<script>
 var X= new XMLHttpRequest();
 X.open("HEAD", location);
 X.send();
 X.onload= function() { 
   document.body.appendChild(document.createElement("pre")).textContent= X.getAllResponseHeaders();
 }
</script> 
```

注意：您获得第二个请求的标头，结果可能与初始请求不同。

* * *

**另一种方法**
是更现代的`fetch()`API
[https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch)
Per [caniuse.com](https://caniuse.com/#feat=fetch)它支持 Firefox 40、Chrome 42、Edge 14、Safari 11
工作示例代码：

```
<!DOCTYPE html>
<title>fetch() all Response Headers</title>

<h1>All Response Headers with fetch()</h1>
<script>
 var x= "";
 if(window.fetch)
    fetch(location, {method:'HEAD'})
    .then(function(r) {
       r.headers.forEach(
          function(Value, Header) { x= x + Header + "\n" + Value + "\n\n"; }
       );
    })
    .then(function() {
       document.body.appendChild(document.createElement("pre")).textContent= x;
    });
 else
   document.write("This does not work in your browser - no support for fetch API");
</script> 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2014-10-15T11:36:47.800

像许多人一样，我一直在挖网而没有真正的答案:(

尽管如此，我还是找到了可以帮助其他人的旁路。就我而言，我完全控制了我的网络服务器。事实上，它是我的应用程序的一部分（见最终参考）。我很容易将脚本添加到我的 http 响应中。我修改了我的 httpd 服务器以在每个 html 页面中注入一个小脚本。我只在我的标题构造之后推送一个额外的“js脚本”行，它在我的浏览器中从我的文档中设置一个现有变量[我选择位置]，但任何其他选项都是可能的。虽然我的服务器是用 nodejs 编写的，但我毫不怀疑 PHP 或其他人可以使用相同的技术。

```
 case ".html":
    response.setHeader("Content-Type", "text/html");
    response.write ("<script>location['GPSD_HTTP_AJAX']=true</script>")
    // process the real contend of my page 
```

现在，从我的服务器加载的每个 html 页面，都让浏览器在接待处执行此脚本。然后，我可以轻松地从 JavaScript 检查变量是否存在。在我的用例中，我需要知道是否应该使用 JSON 或 JSON-P 配置文件来避免 CORS 问题，但同样的技术可以用于其他目的 [即：在开发/生产服务器之间进行选择，从服务器获取 REST/API钥匙等....]

在浏览器上，您只需要直接从 JavaScript 中检查变量，如我的示例所示，我使用它来选择我的 Json/JQuery 配置文件

```
 // Select direct Ajax/Json profile if using GpsdTracking/HttpAjax server otherwise use JsonP
  var corsbypass = true;  
  if (location['GPSD_HTTP_AJAX']) corsbypass = false;

  if (corsbypass) { // Json & html served from two different web servers
    var gpsdApi = "http://localhost:4080/geojson.rest?jsoncallback=?";
  } else { // Json & html served from same web server [no ?jsoncallback=]
    var gpsdApi = "geojson.rest?";
  }
  var gpsdRqt = 
      {key   :123456789 // user authentication key
      ,cmd   :'list'    // rest command
      ,group :'all'     // group to retreive
      ,round : true     // ask server to round numbers
   };
   $.getJSON(gpsdApi,gpsdRqt, DevListCB); 
```

对于想要检查我的代码的人： [https ://www.npmjs.org/package/gpsdtracking](https://www.npmjs.org/package/gpsdtracking)

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2018-08-14T13:16:00.700

将标题作为一个更方便的对象（改进[Raja 的答案](https://stackoverflow.com/a/4881836/7451109)）：

```
var req = new XMLHttpRequest();
req.open('GET', document.location, false);
req.send(null);
var headers = req.getAllResponseHeaders().toLowerCase();
headers = headers.split(/\n|\r|\r\n/g).reduce(function(a, b) {
    if (b.length) {
        var [ key, value ] = b.split(': ');
        a[key] = value;
    }
    return a;
}, {}); 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-11-10T12:37:16.963

使用 mootools，您可以使用`this.xhr.getAllResponseHeaders()`

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2013-08-16T16:29:57.137

我刚刚测试过，这适用于我使用 Chrome 版本 28.0.1500.95。

我需要下载一个文件并读取文件名。文件名在标题中，所以我做了以下操作：

```
var xhr = new XMLHttpRequest(); 
xhr.open('POST', url, true); 
xhr.responseType = "blob";
xhr.onreadystatechange = function () { 
    if (xhr.readyState == 4) {
        success(xhr.response); // the function to proccess the response

        console.log("++++++ reading headers ++++++++");
        var headers = xhr.getAllResponseHeaders();
        console.log(headers);
        console.log("++++++ reading headers end ++++++++");

    }
}; 
```

输出：

```
Date: Fri, 16 Aug 2013 16:21:33 GMT
Content-Disposition: attachment;filename=testFileName.doc
Content-Length: 20
Server: Apache-Coyote/1.1
Content-Type: application/octet-stream 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2017-12-12T22:34:56.083

这是我获取所有响应标头的脚本：

```
var url = "< URL >";

var req = new XMLHttpRequest();
req.open('HEAD', url, false);
req.send(null);
var headers = req.getAllResponseHeaders();

//Show alert with response headers.
alert(headers); 
```

结果是响应标头。

[![在此处输入图像描述](https://i.stack.imgur.com/8Gs1v.png)](https://i.stack.imgur.com/8Gs1v.png)

这是使用 Hurl.it 的比较测试：

[![在此处输入图像描述](https://i.stack.imgur.com/NVJIx.png)](https://i.stack.imgur.com/NVJIx.png)

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2011-01-31T02:17:32.610

这是一个老问题。不确定何时支持变得更广泛，但`getAllResponseHeaders()`现在`getResponseHeader()`似乎相当标准：[http ://www.w3schools.com/xml/dom_http.asp](http://www.w3schools.com/xml/dom_http.asp)

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2018-03-25T01:58:56.420

正如已经提到的，如果您控制服务器端，那么应该可以在初始响应中将初始请求标头发送回客户端。

例如，在 Express 中，以下工作：

`app.get('/somepage', (req, res) => { res.render('somepage.hbs', {headers: req.headers}); })` 然后标题在模板中可用，因此可以在视觉上隐藏但包含在标记中并由客户端 javascript 读取。

* * *

## 回答 #18

> 赞同：-2
> 
> 时间：2018-12-05T17:02:36.863

我认为这个问题走错了路，如果你想从 JQuery/JavaScript 中获取请求标头，答案很简单。其他解决方案是创建一个 aspx 页面或 jsp 页面，然后我们可以轻松访问请求标头。将 aspx 页面中的所有请求放入会话/cookies 中，然后您可以访问 JavaScript 页面中的 cookie。

# c# - Intercepting an exception inside IDisposable.Dispose

> ID：220234
> 
> 赞同：38
> 
> 时间：2008-10-20T22:56:35.097
> 
> 标签：c#, .net, idisposable

In the `IDisposable.Dispose` method is there a way to figure out if an exception is being thrown?

```
using (MyWrapper wrapper = new MyWrapper())
{
    throw new Exception("Bad error.");
} 
```

If an exception is thrown in the `using` statement I want to know about it when the `IDisposable` object is disposed.

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2013-01-14T15:37:19.310

You can extend `IDisposable` with method `Complete` and use pattern like that:

```
using (MyWrapper wrapper = new MyWrapper())
{
    throw new Exception("Bad error.");
    wrapper.Complete();
} 
```

If an exception is thrown inside the `using` statement `Complete` will not be called before `Dispose`.

If you want to know what exact exception is thrown, then subscribe on `AppDomain.CurrentDomain.FirstChanceException` event and store last thrown exception in `ThreadLocal<Exception>` variable.

Such pattern implemented in `TransactionScope` class.

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-10-21T10:50:01.583

**No**, there is no way to do this in the .Net framework, you cannot figure out the current-exception-which-is-being-thrown in a finally clause.

See this [post on my blog](http://samsaffron.com/blog/archive/2007/08/06/16.aspx), for a comparison with a similar pattern in Ruby, it highlights the gaps I think exist with the IDisposable pattern.

Ayende has a trick that will allow you to [detect an exception happened](http://ayende.com/Blog/archive/2007/06/20/Did-you-know-Find-out-if-an-exception-was-thrown.aspx), however, it will not tell you which exception it was.

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-04-19T20:52:15.890

It is **not possible** to capture the Exception in the `Dispose()` method.

However, it is possible to check `Marshal.GetExceptionCode()` in the Dispose to detect if an Exception did occur, but I wouldn't rely on that.

If you don't need a class and want just want to capture the Exception, you can create a function that accepts a lambda that is executed within a try/catch block, something like this:

```
HandleException(() => {
    throw new Exception("Bad error.");
});

public static void HandleException(Action code)
{
    try
    {
        if (code != null)
            code.Invoke();
    }
    catch
    {
        Console.WriteLine("Error handling");
        throw;
    }
} 
```

As example, You can use a method that automatically does a Commit() or Rollback() of a transaction and do some logging. At this way you don't always need a try/catch block.

```
public static int? GetFerrariId()
{
    using (var connection = new SqlConnection("..."))
    {
        connection.Open();
        using (var transaction = connection.BeginTransaction())
        {
            return HandleTranaction(transaction, () =>
            {
                using (var command = connection.CreateCommand())
                {
                    command.Transaction = transaction;
                    command.CommandText = "SELECT CarID FROM Cars WHERE Brand = 'Ferrari'";
                    return (int?)command.ExecuteScalar();
                }
            });
        }
    }
}

public static T HandleTranaction<T>(IDbTransaction transaction, Func<T> code)
{
    try
    {
        var result = code != null ? code.Invoke() : default(T);
        transaction.Commit();
        return result;
    }
    catch
    {
        transaction.Rollback();
        throw;
    }
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-21T20:42:17.237

James, All `wrapper` can do is log it's own exceptions. You can't force the consumer of `wrapper` to log their own exceptions. That's not what IDisposable is for. IDisposable is meant for semi-deterministic release of resources for an object. Writing correct IDisposable code is not trivial.

In fact, the consumer of the class isn't even required to call your classes dispose method, nor are they required to use a using block, so it all rather breaks down.

If you look at it from the point of view of the wrapper class, why should it care that it was present inside a using block and there was an exception? What knowledge does that bring? Is it a security risk to have 3rd party code privy to exception details and stack trace? What can `wrapper` do if there is a divide-by-zero in a calculation?

The only way to log exceptions, irrespective of IDisposable, is try-catch and then to re-throw in the catch.

```
try
{
    // code that may cause exceptions.
}
catch( Exception ex )
{
   LogExceptionSomewhere(ex);
   throw;
}
finally
{
    // CLR always tries to execute finally blocks
} 
```

* * *

You mention you're creating an external API. You would have to wrap every call at your API's public boundary with try-catch in order to log that the exception came from your code.

If you're writing a public API then you really ought to read [Framework Design Guidelines: Conventions, Idioms, and Patterns for Reusable .NET Libraries (Microsoft .NET Development Series) - 2nd Edition](https://rads.stackoverflow.com/amzn/click/com/0321545613) .. [1st Edition](https://rads.stackoverflow.com/amzn/click/com/0321246756).

* * *

While I don't advocate them, I have seen IDisposable used for other interesting patterns:

1.  Auto-rollback transaction semantics. The transaction class would rollback the transaction on Dispose if not already committed.
2.  Timed code blocks for logging. During object creation a timestamp was recorded, and on Dispose the TimeSpan was calculated and a log event was written.

* These patterns can be achieved with another layer of indirection and anonymous delegates easily and without having to overload IDisposable semantics. The important note is that your IDisposable wrapper is useless if you or a team member forget to use it properly.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-03-16T01:50:39.570

You can do this buy implementing the Dispose method for the "MyWrapper" class. In the dispose method you can check to see if there is an exception as follows

```
public void Dispose()
{
    bool ExceptionOccurred = Marshal.GetExceptionPointers() != IntPtr.Zero
                             || Marshal.GetExceptionCode() != 0;
    if(ExceptionOccurred)
    {
        System.Diagnostics.Debug.WriteLine("We had an exception");
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-20T23:03:46.953

Instead of the syntactic sugar of the using statement, why not just implement your own logic for this. Something like:

```
try
{
  MyWrapper wrapper = new MyWrapper();

}
catch (Exception e)
{
  wrapper.CaughtException = true;
}
finally
{
   if (wrapper != null)
   {
      wrapper.Dispose();
   }
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-11-13T00:04:48.990

It is not only possible to find out if an exception was thrown when a disposable object is disposed you can even get your hands on the exception that was thrown inside the finally clause with a little magic. My Tracing library of the ApiChange tool employs this method to trace exceptions inside a using statement. More infos how this works can be found [here](http://geekswithblogs.net/akraus1/archive/2010/07/04/140761.aspx).

Yours, Alois Kraus

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-04-05T19:55:12.560

Now, in 2017, this is the generic way to do it, incl handling rollback for exceptions.

```
 public static T WithinTransaction<T>(this IDbConnection cnn, Func<IDbTransaction, T> fn)
    {
        cnn.Open();
        using (var transaction = cnn.BeginTransaction())
        {
            try
            {
                T res = fn(transaction);
                transaction.Commit();
                return res;
            }
            catch (Exception)
            {
                transaction.Rollback();
                throw;
            }
            finally
            {
                cnn.Close();
            }
        }
    } 
```

and you call it like this:

```
 cnn.WithinTransaction(
            transaction =>
            {
                var affected = ..sqlcalls..(cnn, ...,  transaction);
                return affected;
            }); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-21T20:54:25.090

This will catch exceptions thrown either directly or inside the dispose method:

```
try
{
    using (MyWrapper wrapper = new MyWrapper())
    {
        throw new MyException("Bad error.");
    }
}
catch ( MyException myex ) {
    //deal with your exception
}
catch ( Exception ex ) {
    //any other exception thrown by either
    //MyWrapper..ctor() or MyWrapper.Dispose()
} 
```

But this is relying on them using this this code - it sounds like you want MyWrapper to do that instead.

The using statement is just to make sure that Dispose always gets called. It's really doing this:

```
MyWrapper wrapper;
try
{
    wrapper = new MyWrapper();
}
finally {
    if( wrapper != null )
        wrapper.Dispose();
} 
```

It sounds like what you want is:

```
MyWrapper wrapper;
try
{
    wrapper = new MyWrapper();
}
finally {
    try{
        if( wrapper != null )
            wrapper.Dispose();
    }
    catch {
        //only errors thrown by disposal
    }
} 
```

I would suggest dealing with this in your implementation of Dispose - you should handle any issues during Disposal anyway.

If you're tying up some resource where you need users of your API to free it in some way consider having a `Close()` method. Your dispose should call it too (if it hasn't been already) but users of your API could also call it themselves if they needed finer control.

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-08-08T15:30:38.793

If you want to stay purely within .net, two approaches I would suggest would be writing a "try-catch-finally" wrapper, which would accept delegates for the different parts, or else writing a "using-style" wrapper, which accept a method to be invoked, along with one or more IDisposable objects which should be disposed after it completes.

A "using-style" wrapper could handle the disposal in a try-catch block and, if any exceptions are thrown in disposal, either wrap them in a CleanupFailureException which would hold the disposal failures as well as any exception that occurred in the main delegate, or else add something to the exception's "Data" property with the original exception. I would favor wrapping things in a CleanupFailureException, since an exception that occurs during cleanup will generally indicate a much bigger problem than one which occurs in main-line processing; further, a CleanupFailureException could be written to include multiple nested exceptions (if there are 'n' IDisposable objects, there could be n+1 nested exceptions: one from the mainline and one from each Dispose).

A "try-catch-finally" wrapper written in vb.net, while callable from C#, could include some features that are otherwise unavailable in C#, including the ability to expand it to a "try-filter-catch-fault-finally" block, where the "filter" code would be executed before the stack is unwound from an exception and determine whether the exception should be caught, the "fault" block would contain code that would only run if an exception occurred, but would not actually catch it, and both the "fault" and "finally" blocks would receive parameters indicating both what exception (if any) occurred during the execution of the "try", and whether the "try" completed successfully (note, btw, that it would be possible for the exception parameter to be non-null even if the mainline completes; pure C# code couldn't detect such a condition, but the vb.net wrapper could).

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-10-08T00:18:49.173

In my case, I wanted to do this to log when an microservice crashes. I already have in place a `using` to properly clean up right before an instance shut down, but if that's because of an exception I want to see why, and I hate no for an answer.

Instead of trying to make it work in `Dispose()`, perhaps make a delegate for the work you need to do, and then wrap your exception-capturing in there. So in my MyWrapper logger, I add a method that takes an Action / Func:

```
 public void Start(Action<string, string, string> behavior)
     try{
        var string1 = "my queue message";
        var string2 = "some string message";
        var string3 = "some other string yet;"
        behaviour(string1, string2, string3);
     }
     catch(Exception e){
       Console.WriteLine(string.Format("Oops: {0}", e.Message))
     }
 } 
```

To implement:

```
using (var wrapper = new MyWrapper())
  {
       wrapper.Start((string1, string2, string3) => 
       {
          Console.WriteLine(string1);
          Console.WriteLine(string2);
          Console.WriteLine(string3);
       }
  } 
```

Depending on what you need to do, this may be too restrictive, but it worked for what I needed.

# javascript - 如何在 HTML 中嵌入字体？

> ID：220236
> 
> 赞同：83
> 
> 时间：2008-10-20T22:57:54.937
> 
> 标签：javascript, html, flash, fonts, embed

我试图找出一个体面的解决方案（尤其是从 SEO 方面）在网页中嵌入字体。到目前为止，我已经看到[了 W3C 解决方案](http://web.archive.org/web/20100208164146/http://www.spoono.com/html/tutorials/tutorial.php?id=19)，它甚至在 Firefox 上都不起作用，而且[这个非常酷的解决方案](http://web.archive.org/web/20130127125919/http://wiki.novemberborn.net/sifr/How+to+use)。第二种解决方案仅适用于标题。是否有可用于全文的解决方案？我厌倦了网页的标准字体。

谢谢！

* * *

## 回答 #1

> 赞同：139
> 
> 时间：2009-12-27T22:27:59.597

**自从最初提出并回答这个问题以来，**情况发生了变化。**在使用@font-face 嵌入使正文文本的跨浏览器字体嵌入工作方面已经完成了大量工作。**

 **Paul Irish 将[Bulletproof @font-face 语法](http://paulirish.com/2009/bulletproof-font-face-implementation-syntax/)结合了多个其他人的尝试。如果您实际上浏览了整篇文章（不仅仅是顶部），它允许使用单个 @font-face 语句来涵盖 IE、Firefox、Safari、Opera、Chrome 以及可能的其他内容。基本上，这可以以不破坏任何东西的方式输出 OTF、EOT、SVG 和 WOFF。

摘自他的文章：

```
@font-face {
  font-family: 'Graublau Web';
  src: url('GraublauWeb.eot');
  src: local('Graublau Web Regular'), local('Graublau Web'),
    url("GraublauWeb.woff") format("woff"),
    url("GraublauWeb.otf") format("opentype"),
    url("GraublauWeb.svg#grablau") format("svg");
} 
```

在此基础上，[Font Squirrel](http://www.fontsquirrel.com/)整合了各种有用的工具，包括[**@font-face 生成器**](http://www.fontsquirrel.com/fontface/generator)，它允许您上传 TTF 或 OTF 文件并获取其他类型的自动转换字体文件，以及预构建的 CSS 和一个演示 HTML 页面。字体松鼠也有[数百个@font-face 套件](http://www.fontsquirrel.com/fontface)。

Soma Design 还整合了[FontFriend Bookmarklet](http://somadesign.ca/projects/fontfriend/)，它可以即时重新定义页面上的字体，以便您可以尝试。它包括在 FireFox 3.6+ 中的拖放 @font-face 支持。

最近，Google 开始提供[Google Web Fonts](http://www.google.com/webfonts)，这是在开源许可下提供的各种字体，由 Google 的服务器提供服务。

**许可限制**

最后，WebFonts.info 整理了一个很好的 wiki 字体列表，可用于基于许可证[的@font-face 嵌入。](https://web.archive.org/web/20140713192153/http://www.webfonts.info/fonts-available-font-face-embedding)它并没有声称是一个详尽的列表，但它上面的字体应该可以用于嵌入/链接（可能有条件，例如 CSS 文件中的属性）。**阅读许可证很重要**，因为在字体下载中存在一些没有明显推进的限制。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-15T11:22:38.023

试试[Facetype.js](https://gero3.github.io/facetype.js/ "Facetype.js")，你将你的 .TTF 字体转换成一个 Javascript 文件。完全兼容 SEO，支持 FF、IE6 和 Safari，并在其他浏览器上优雅降级。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-20T23:17:32.353

不，对于体型没有一个像样的解决方案，除非你愿意只迎合那些拥有尖端浏览器的人。

微软有[WEFT](http://en.wikipedia.org/wiki/Web_Embedding_Fonts_Tool)，他们自己专有的字体嵌入技术，但我已经很多年没有听说过它了，我也不知道有人在使用它。

我使用 sIFR 作为显示类型（标题、博客文章的标题等），并使用一种不太陈旧的网络安全字体作为正文类型（如 Trebuchet MS）。如果你对所有的网络安全字体感到厌烦，你可能对这个术语的定义过于狭隘——看看这个随主要操作系统提供[的库存字体矩阵](http://dustinbrewer.com/fonts-on-the-web-and-a-list-of-web-safe-fonts/)，你很有可能会找到一个字体级联，它将抓住几乎所有的网络用户。

例如：`font-family: "Lucida Grande", "Verdana", sans-serif`是一种常见的字体级联；OS X 带有 Lucida Grande，但 Windows 用户将获得 Verdana，这是一种网络安全字体，其字母的大小和形状与 Lucida Grande 相似。如果 Linux 用户安装了大多数发行版包管理器中存在的网络安全字体包，他们也将获得 Verdana，否则他们将退回到普通的无衬线字体。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-20T23:06:55.853

这也不太可能——EOT 是一种相当严格的格式，仅受 IE 支持。Safari 3.1 和 Firefox 3.1（以及当前的 alpha）以及可能的 Opera 9.6 都支持真字体（ttf）嵌入，至少 Safari 通过相同的机制支持 SVG 字体。不久前，一份单独的清单对此进行了很好的[讨论](http://www.alistapart.com/articles/cssatten)。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-12-27T22:29:50.013

查看[Typekit](http://typekit.com/)，一个商业选项（他们也有一个免费的包）。

它根据使用的浏览器（`@font-face`与`EOT`格式）使用不同的技术，它们还为您处理所有字体许可问题。它支持低至 IE6 的所有内容。

以下是有关 Typekit 工作原理的更多信息：

*   [http://forabeautifulweb.com/blog/about/first_impressions_of_typekit](http://forabeautifulweb.com/blog/about/first_impressions_of_typekit)
*   [http://www.sitepoint.com/blogs/2009/06/01/web-fonts-get-real-with-typekit/](http://www.sitepoint.com/blogs/2009/06/01/web-fonts-get-real-with-typekit/)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-20T23:17:28.627

我不久前问过这个[问题](https://stackoverflow.com/questions/16233/fonts-on-the-web)。答案基本上是它不起作用。:(

# jsp - 如何注释一个JSP 表达式？

> ID：220243
> 
> 赞同：142
> 
> 时间：2008-10-20T22:59:27.680
> 
> 标签：jsp, comments

如何评论 JSP 表达式，如：`<%= map.size() %>`

有没有类似的东西`<%= // map.size() %>?`

* * *

## 回答 #1

> 赞同：225
> 
> 时间：2008-10-20T23:17:09.080

纯 JSP 注释如下所示：

```
<%-- Comment --%> 
```

因此，如果您想保留“ `=`”。您可以执行以下操作：

```
<%--= map.size() --%> 
```

关键是它`<%=`定义了表达式的开头，其中您不能将主体留空，但如果纯 JSP 注释不吸引您，您可以这样做：

```
<% /*= map.size()*/ %> 
```

[JavaServer Pages 技术版本 1.x 语言的代码约定](http://www.oracle.com/technetwork/articles/javase/code-convention-138726.html)详细介绍了您可用的不同注释选项（但完全没有链接目标，因此我无法将您直接链接到相关部分 - 嘘！）

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2015-05-18T04:16:12.923

有多种方法可以在 JSP 文件中进行注释。

```
1\.  <%-- comment --%> 
```

JSP 注释。被 JSP 引擎忽略。在客户端机器中不可见（浏览器源代码）。

```
2\.  <!-- comment --> 
```

HTML 注释。被浏览器忽略。它在客户端机器（浏览器源代码）中作为注释可见。

```
3\. <% my code //my comment %> 
```

Java 单行注释。被编译器忽略。在客户端机器中不可见（浏览器源代码）。

```
4\.   <% my code /**
         my comment  **/  
       %> 
```

Java 多行注释。被编译器忽略。在客户端机器中不可见（浏览器源代码）。

但是应该只使用注释类型 1 和 2，因为 java 文档建议。这两种注释类型（1 和 2）是为 JSP 设计的。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2014-02-14T09:34:03.497

您可以在 jsp 页面中使用此注释

```
 <%--your comment --%> 
```

jsp页面中注释声明的第二种方式可以在jsp代码中使用两种类型的注释

```
 single line comment
 <% your code //your comment%>

multiple line comment 

<% your code 
/**
your another comment
**/

%> 
```

您还可以通过 html 代码对 jsp 页面进行评论，例如：

```
<!-- your commment --> 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2015-01-15T04:45:03.340

当您不希望用户看到评论时，请使用：

```
<%-- comment --%> 
```

如果您不关心/希望用户能够查看源代码并查看您可以使用的评论：

```
<!-- comment --> 
```

如有疑问，请使用 JSP 注释。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-20T23:32:13.370

你`<%= //map.size() %>`不只是工作，因为它应该是

```
<% //= map.size() %> 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2017-05-31T07:48:44.323

我的建议是在 JSP 页面中使用评论的最佳方式`<%-- Comment --%>` 。因为它不会在客户端浏览器中显示（不会在 HTML 页面中呈现）。

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2008-10-20T23:04:31.100

之一：

在 html 中

```
<!-- map.size here because --> 
<%= map.size() %> 
```

从理论上讲，以下应该可以工作，但我从未以这种方式使用它。

```
<%= map.size() // map.size here because %> 
```

# version-control - 使用 VS2005 和 VSS 有没有办法在签到时添加评论？

> ID：220245
> 
> 赞同：3
> 
> 时间：2008-10-20T23:00:32.263
> 
> 标签：version-control, visual-studio-2005, visual-sourcesafe

所有的谷歌搜索还没有为我找到答案......我有一个使用 VSS 和 VS2005 的开发人员。签入作品（尽管在整个网络上非常痛苦）但似乎没有办法将评论放入签入中（除非您将其嵌入源文件中？）我将是第一个承认的人我对 VSS 的了解非常少，如果有一个“Duh”的答案，我会很高兴听到它 :)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-20T23:10:23.897

您可以使用 Visual Studio 中的 View Pending Checkins... 可折叠窗格。它有一个显示评论框的切换按钮。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-20T23:09:22.947

在 Visual Studio 2005 中有一个“Pending Changes”视图，可让您向单个文件或要签入的文件组添加注释。Pending Changes 可以通过 View 菜单访问。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-12-03T15:57:04.077

如果您由于“立即签到”设置而错过添加评论，您仍然可以通过以下方式添加签入评论

1.  签入有问题的文件
2.  在 SolutionExplorer 中右键单击文件名
3.  查看历史
4.  double click on youngest item
5.  adding your comment under Comment

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-20T23:06:19.523

当您去签入文件时，应该有“快速”签入选项，并且签入选项旁边带有省略号（...），表示将打开一个对话框。当您使用此功能签入/签出文件时，对话框中有一个部分允许您添加注释。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-28T18:58:38.510

从 VS2005 IDE 签入时，应提示您输入签入注释。如果不是，那么您可能在工具->选项->源代码控制->环境中勾选了“签入项目时不显示签入对话框”选项。取消勾选，签入时会显示签入注释对话框。

# c# - 在 C# 中，为什么条件运算符不能隐式转换为可空类型

> ID：220250
> 
> 赞同：32
> 
> 时间：2008-10-20T23:04:11.337
> 
> 标签：c#, conditional-operator, nullable

我很好奇为什么隐式强制转换失败...

```
int? someValue = SomeCondition ? ResultOfSomeCalc() : null; 
```

以及为什么我必须执行显式转换

```
int? someValue = SomeCondition ? ResultofSomeCalc() : (int?)null; 
```

在我看来，编译器拥有做出隐式转换决定所需的所有信息，不是吗？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-10-20T23:14:38.880

C# 3.0 规范的相关部分是 7.13，条件运算符：

?: 运算符的第二个和第三个操作数控制条件表达式的类型。设 X 和 Y 是第二个和第三个操作数的类型。然后，

如果 X 和 Y 是相同类型，则这是条件表达式的类型。否则，如果存在从 X 到 Y 的隐式转换（第 6.1 节），但不存在从 Y 到 X 的隐式转换，则 Y 是条件表达式的类型。否则，如果存在从 Y 到 X 的隐式转换（第 6.1 节），而不是从 X 到 Y，则 X 是条件表达式的类型。否则，无法确定表达式类型，并出现编译时错误。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-10-20T23:14:39.240

我也很恼火它不能根据赋值推断类型，尤其是当它是一个值类型时。但是，当您进入对象层次结构时，这是有原因的。

**如果“ResultOfSomeCalc()”返回一个“int？”，那么这将起作用**。无论赋值左侧是什么，C# 都需要找出类型。所以你告诉它你将返回一个 null 或一个 int - 并且编译器中的逻辑不存在让它替换一个 Nullable 作为一个公分母。

请注意，这些变体确实有效，它可以帮助您理解：

```
object someValue = true ? new Nullable<int>(ResultOfSomeCalc()) : null;

object someValue = true ? (int?)ResultOfSomeCalc() : null; 
```

希望这可以帮助。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-06T22:05:55.437

看起来这似乎是编译器应该能够自己解决的问题，但是还有另一种方法可以做到这一点，使用 default 关键字。它可能比演员阵容更丑一点：

```
int? someValue = SomeCondition ? ResultofSomeCalc() : default(int?); 
```

这种默认的使用似乎没有很好的文档记录，但确实有效。至少它使您不必在代码中乱扔魔术值（我认为 null/zero/false/etc. 确实是魔术值）。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-20T23:28:13.177

另请参阅[为什么此代码在 C# 中无效？](https://stackoverflow.com/questions/202271/why-is-this-code-invalid-in-c)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-20T23:30:45.603

如果您的函数 ResultofSomeCalc() 返回 int？那么这将起作用。

如果您的函数返回 int，则编译器会发出警告：无法确定条件表达式的类型，因为 'int' 和 '' 之间没有隐式转换
我猜这就是您所看到的。条件运算符 "?:" 中的两个表达式必须具有相同的类型，或者必须通过隐式强制转换转换为相同的类型。

将 ResultOfSomeCalc 的返回类型更改为 int?，否则您需要对 null 表达式进行强制转换。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-04-14T10:13:17.140

使您的函数 ResultOfSomeCalc() 的返回类型为 nullabel int，如 (int?)
int? someValue =(int?) SomeCondition ? ResultofSomeCalc() : (int?)null;

# delphi - 您可以覆盖对自定义 TForm/Dialog 的 MessageDlg 调用吗？

> ID：220254
> 
> 赞同：5
> 
> 时间：2008-10-20T23:06:08.120
> 
> 标签：delphi

我一直在使用与此类似的代码

```
MessageDlg('', mtWarning, [mbOK], 0); 
```

在我的整个项目中，（感谢 GExperts 消息对话框工具 :)），我想知道是否有人知道一种方法可以覆盖调用并显示我自己的自定义表单。

我能想到的唯一方法就是用类似的东西制作一个新表格

```
function MessageDlg(const Msg: string; DlgType: TMsgDlgType;
  Buttons: TMsgDlgButtons; HelpCtx: Longint): Integer;
begin
  //show my own code here
end; 
```

并将我的每个使用列表放在 Dialogs 单元之前，但是有保证的方法来确保它使用我的代码而不是 Dialogs 单元代码。
我不喜欢将对话框单元复制到本地目录并对其进行更改的想法。

还是这一切都需要做很多工作，我应该只使用我自己的函数调用并用我自己的替换所有 MessageDlg。（这不会很有趣，我可能使用 MessageDlg 太多了）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T00:17:06.727

BTW, you want to add it after the **Dialogs** unit in your uses clause.

You have three choices in my opinion:

1.  Add your own unit after the *Dialogs* unit that has a method called MessageDlg and has the same signature to create your own form.
2.  Or create a whole new method, or set of methods, that creates specific dialogs using your own form.
3.  Do a global Search & Replace for *MessageDlg* with *DarkAxi0mMessageDlg* and then add your DarkAxi0mDialogs unit to your uses clause.

The first one is problematic because you might miss a unit and still get the old MessageDlg. The second one takes a lot more use, but provides better flexibility in the long run. The third one is probably the easiest and with the least downsides. Make sure you backup before doing the replace, and then use a diff tool (like [Beyond Compare](http://www.ScooterSoftware.com/)) to check your changes.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T23:14:56.057

我建议您将 MessageDlg 封装在您自己的程序中，这样，如果您更改程序，所有消息对话框都将被更改并保持标准。

示例：创建一些过程，如 Alert()、Error()、Warning() 等。如果您需要更改错误消息的外观，您只需在一个地方进行。

有一天，您可能想在错误消息、警报中添加图片……无论如何，谁知道呢？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-20T23:28:17.467

您可以使用[TextPad](http://www.textpad.com)之类的工具在文件夹和子文件夹中搜索/替换字符串的所有实例。因此，我建议您将“MessageDlg(”替换为“MyMessageDlg(”)，以便您可以随意自定义它。应该花费 5 分钟。

I think it would cause you problems to create a replacement and leave it named as it is currently in conflict with the VCL.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T01:33:32.283

You can **hijack the MessageDlg function** and make it point to your own MyMessageDlg function (with same signature) but I think it would the least safe of all the solutions.
**A bad hack in lieu of clean code IMO.**

Save the original opcodes of MessageDlg (asm generated by the compiler)
Put a hard jump to your MyMessageDlg code
...then any call to MessageDlg will actually execute YOUR code ...
Restore the original code to MessageDlg
MessageDlg now behaves as usual

It works but should be **reserved for desperate situations**...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T15:41:44.553

i made a MessageDlgEx function based on MessageDlg and dropped it into one of my "library" files so all my apps can use it. my function allows you to specify default & cancel buttons, give button texts, etc. it'd be a bad practice to modify/replace the built-in function. i still use the built-in function but keep this function on hand for situations where a little more is needed.

FYI--the function returns the number of the button pressed. the first button is 1\. pressing Close causes a return value of 0\. the buttons have no glyphs.

i have been using this for about 5 years & it's served me well.

```
function MessageDlgEx(Caption, Msg: string; AType: TMsgDlgType;
                      AButtons: array of string;
                      DefBtn, CanBtn: Integer; iWidth:integer=450;bCourier:boolean=false): Word;
const
  icMin=50;
  icButtonHeight=25;
  icInterspace=10;
  icButtonResultStart=100;
  icFirstButtonReturnValue=1;
var
  I, iButtonWidth, iAllButtonsWidth,
  iIconWidth,iIconHeight:Integer;
  LabelText:String;
  Frm: TForm;
  Lbl: TLabel;
  Btn: TBitBtn;
  Glyph: TImage;
  FIcon: TIcon;
  Rect:TRect;
  Caption_ca:Array[0..2000] of Char;
begin
  { Create the form.}
  Frm := TForm.Create(Application);
  Frm.BorderStyle := bsDialog;
  Frm.BorderIcons := [biSystemMenu];
  Frm.FormStyle := fsStayOnTop;
  Frm.Height := 185;
  Frm.Width := iWidth;
  Frm.Position := poScreenCenter;
  Frm.Caption := Caption;
  Frm.Font.Name:='MS Sans Serif';
  Frm.Font.Style:=[];
  Frm.Scaled:=false;

  if ResIDs[AType] <> nil then
    begin
      Glyph := TImage.Create(Frm);
      Glyph.Name := 'Image';
      Glyph.Parent := Frm;

      FIcon := TIcon.Create;
      try
        FIcon.Handle := LoadIcon(HInstance, ResIDs[AType]);
        iIconWidth:=FIcon.Width;
        iIconHeight:=FIcon.Height;
        Glyph.Picture.Graphic := FIcon;
        Glyph.BoundsRect := Bounds(icInterspace, icInterspace, FIcon.Width, FIcon.Height);
      finally
        FIcon.Free;
      end;
    end
    else
    begin
      iIconWidth:=0;
      iIconHeight:=0;
    end;

  { Loop through buttons to determine the longest caption. }
  iButtonWidth := 0;
  for I := 0 to High(AButtons) do
    iButtonWidth := Max(iButtonWidth, frm.Canvas.TextWidth(AButtons[I]));

  { Add padding for the button's caption}
  iButtonWidth := iButtonWidth + 18;

  {assert a minimum button width}
  If iButtonWidth<icMin Then
    iButtonWidth:=icMin;

  { Determine space required for all buttons}
  iAllButtonsWidth := iButtonWidth * (High(AButtons) + 1);

  { Each button has padding on each side}
  iAllButtonsWidth := iAllButtonsWidth +icInterspace*High(AButtons);

  { The form has to be at least as wide as the buttons with space on each side}
  if iAllButtonsWidth+icInterspace*2 > Frm.Width then
    Frm.Width := iAllButtonsWidth+icInterspace*2;

  if Length(Msg)>sizeof(Caption_ca) then
    SetLength(Msg,sizeof(Caption_ca));

  { Create the message control}
  Lbl := TLabel.Create(Frm);
  Lbl.AutoSize := False;
  Lbl.Left := icInterspace*2+iIconWidth;
  Lbl.Top := icInterspace;
  Lbl.Height := 200;
  Lbl.Width := Frm.ClientWidth - icInterspace*3-iIconWidth;
  Lbl.WordWrap := True;
  Lbl.Caption := Msg;
  Lbl.Parent := Frm;

  if bCourier then
    lbl.Font.Name:='Courier New';

  Rect := Lbl.ClientRect;
  LabelText:=Lbl.Caption;
  StrPCopy(Caption_ca, LabelText);

  Lbl.Height:=DrawText(Lbl.Canvas.Handle,
                       Caption_ca,
                       Length(LabelText),
                       Rect,
                       DT_CalcRect or DT_ExpandTabs or DT_WordBreak Or DT_Left);

  If Lbl.Height<iIconHeight Then
    Lbl.Height:=iIconHeight;

  { Adjust the form's height accomodating the message, padding and the buttons}
  Frm.ClientHeight := Lbl.Height + 3*icInterspace + icButtonHeight;

  { Create the pusbuttons}
  for I := 0 to High(AButtons) do
    begin
      Btn := TBitBtn.Create(Frm);
      Btn.Height := icButtonHeight;
      Btn.Width := iButtonWidth;
      Btn.Left:=((Frm.Width-iAllButtonsWidth) Div 2)+I*(iButtonWidth+icInterspace);
      Btn.Top := Frm.ClientHeight - Btn.height-icInterspace;
      Btn.Caption := AButtons[I];
      Btn.ModalResult := I + icButtonResultStart + icFirstButtonReturnValue;
      Btn.Parent := Frm;

      If I=DefBtn-1 Then
        Begin
          Frm.ActiveControl:=Btn;
          Btn.Default:=True;
        End
        Else
        Btn.Default:=False;

      If I=CanBtn-1 Then
        Btn.Cancel:=True
        Else
        Btn.Cancel:=False;
    end;

  Application.BringToFront;

  Result := Frm.ShowModal;

  {trap and convert user Close into mrNone}
  If Result=mrCancel Then
    Result:=mrNone
    Else
    If Result>icButtonResultStart Then
      Result:=Result - icButtonResultStart
      Else
      Exception.Create('Unknown MessageDlgEx result');

  Frm.Free;
end; 
```

# visual-studio-2005 - NUnit 程序集如何出现在 VS“添加引用”对话框中？

> ID：220266
> 
> 赞同：0
> 
> 时间：2008-10-20T23:13:04.580
> 
> 标签：visual-studio-2005, assemblies, reference, nunit

因此，在安装 NUnit 之后，程序集（`nunit.framework`等）现在出现在`References > Add Reference`对话框中，但它们不在`%WINDIR%\Microsoft.NET\Framework\v2.0.50727`目录中，并且没有`NUnit`针对 Assembly Path 的注册表项`(i.e. HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramewokr\AssemblyFolder)`。

`NUnit`在安装目录的项目属性参考路径中也没有创建自动条目。他们到底是怎么出现在“添加对话框”中的？！？！我认为上述方式是程序集出现在“添加引用”中的唯一方式。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-26T18:55:42.030

我在周末更深入地研究了这一点。[从我的博客](http://www.differentpla.net/content/2008/10/why-nunit-not-gac-or-why-does-assembly-x-not-appear-visual-studios-add-reference-dialog)逐字转载：

## 为什么 NUnit 不在 GAC 中？（或为什么 [assembly X] 不出现在 Visual Studio 的添加引用对话框中？）

因为 Visual Studio 不会在 GAC 中查找引用：

*   [http://blogs.msdn.com/msbuild/archive/2007/04/12/new-reference-assemblies-location.aspx](http://blogs.msdn.com/msbuild/archive/2007/04/12/new-reference-assemblies-location.aspx)
*   [http://blogs.msdn.com/junfeng/archive/2004/03/22/93708.aspx](http://blogs.msdn.com/junfeng/archive/2004/03/22/93708.aspx)

这是设计使然。

您可以显式添加文件，如果团队中的其他人已将文件安装在其他位置，例如 C:\Program Files\NUnit 2.4.6 与 C:\Program Files\NUnit-2.4，这将不起作用。 6\. 或者（更具体地说，因为这是我今天早上遇到的问题）C:\Program Files\NUnit 2.4.6 与 C:\Program Files (x86)\NUnit 2.4.6。注意（x86）——我的家用电脑（截至上周末）运行 Vista Ultimate x64。

你有几个选择：

*   如果您的程序集还没有 home，您可以将它们放在 VS PublicAssemblies 文件夹中：http: [//blogs.msdn.com/csharpfaq/archive/2004/10/20/245239.aspx](http://blogs.msdn.com/csharpfaq/archive/2004/10/20/245239.aspx)
*   如果他们已经有家，您可以将它们添加到 HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework\AssemblyFolders 注册表项： http: [//support.microsoft.com/](http://support.microsoft.com/?kbid=306149) ?kbid=306149 。
*   如果您正在开发程序集供其他开发人员使用（即您是 Microsoft 或开发工具供应商），您可以将它们放在 C:\Program Files\Reference Assemblies 目录的子目录中，然后将其添加到 AssemblyFolders 注册表钥匙。

这意味着您的项目文件将按名称（即名称、版本、公钥令牌、所有爵士乐）引用程序集，并且它实际安装在您的 PC 上的哪个位置并不重要。

但是请注意，这在 64 位上不能按原样工作，因为 Visual Studio 是一个 32 位应用程序。您实际上需要在 HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\.NETFramework\AssemblyFolders 下注册您的东西，并且您可能应该在两者下注册。

这些键也有相应的 HKEY_CURRENT_USER 变体，但是（因为漫游），它没有多大用处（因为路径通常是相对于机器的，无论如何）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-20T23:23:08.600

奇怪的是，[HKEY_CURRENT_USER\SOFTWARE\Microsoft.NETFramework\AssemblyFolders] 应该是唯一驱动这个的东西。

[也许这个页面](http://support.microsoft.com/kb/306149)的这个片段是相关的？

如果您安装 .NET Framework 3.0 Service Pack 1 (SP1)，则会添加以下注册表子项：

```
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework\AssemblyFolders\v3.0 
```

如果您安装 .NET Framework 3.5，则会添加以下注册表子项：

```
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework\AssemblyFolders\v3.5 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T00:56:58.113

在我安装 NUnit 时，我有一个注册表项

```
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework\AssemblyFolders\NUnit 2.4.3 
```

它似乎是我计算机上这种行为的驱动程序。一旦我删除了该键，引用就不会出现。

# html - 如何仅使用 CSS 重新排序我的 div？

> ID：220273
> 
> 赞同：307
> 
> 时间：2008-10-20T23:16:40.687
> 
> 标签：html, css

给定一个由于其他要求而无法修改 HTML 的模板，当它们在 HTML 中的顺序不同时，如何`div`在另一个之上显示（重新排列）？`div`两个`div`s 都包含高度和宽度不同的数据。

```
<div id="wrapper">
    <div id="firstDiv">
        Content to be below in this situation
    </div>
    <div id="secondDiv">
        Content to be above in this situation
    </div>
</div>
Other elements 
```

希望很明显，期望的结果是：

```
Content to be above in this situation
Content to be below in this situation
Other elements 
```

当尺寸固定时，很容易将它们放置在需要的地方，但我需要一些关于内容何时可变的想法。在这种情况下，请只考虑两者的宽度为 100%。

我正在专门寻找一个纯 CSS 的解决方案（如果不成功，它可能必须与其他解决方案相结合）。

这之后还有其他元素。鉴于我演示的有限场景，有人提到了一个很好的建议——考虑到它可能是最好的答案，但我也希望确保以下元素不受影响。

* * *

## 回答 #1

> 赞同：299
> 
> 时间：2015-01-26T22:17:26.197

**A CSS-only solution** (works for [IE10+](http://caniuse.com/flexbox)) – use Flexbox's `order` property:

Demo: [http://jsfiddle.net/hqya7q6o/596/](http://jsfiddle.net/hqya7q6o/596/)

```
#flex { display: flex; flex-direction: column; }
#a { order: 2; }
#b { order: 1; }
#c { order: 3; }
```

```
<div id="flex">
   <div id="a">A</div>
   <div id="b">B</div>
   <div id="c">C</div>
</div>
```

More info: [https://developer.mozilla.org/en-US/docs/Web/CSS/order](https://developer.mozilla.org/en-US/docs/Web/CSS/order)

* * *

## 回答 #2

> 赞同：299
> 
> 时间：2012-08-22T08:56:23.543

[此解决方案](http://tanalin.com/en/articles/css-block-order/)仅使用 CSS 并适用于可变内容

```
#wrapper   { display: table; }
#firstDiv  { display: table-footer-group; }
#secondDiv { display: table-header-group; } 
```

* * *

## 回答 #3

> 赞同：87
> 
> 时间：2008-10-20T23:45:35.340

正如其他人所说，这不是你想要在 CSS 中做的事情。你可以用绝对定位和奇怪的边距来捏造它，但这并不是一个可靠的解决方案。在您的情况下，最好的选择是转向 javascript。在 jQuery 中，这是一个非常简单的任务：

```
$('#secondDiv').insertBefore('#firstDiv'); 
```

或更笼统地说：

```
$('.swapMe').each(function(i, el) {
    $(el).insertBefore($(el).prev());
}); 
```

* * *

## 回答 #4

> 赞同：40
> 
> 时间：2014-06-13T22:59:02.567

这可以使用 Flexbox 来完成。

创建一个同时应用**display:flex**和**flex-flow:column-reverse**的容器。

```
/* -- Where the Magic Happens -- */

.container {

  /* Setup Flexbox */
  display: -webkit-box;
  display: -moz-box;
  display: -ms-flexbox;
  display: -webkit-flex;
  display: flex;

  /* Reverse Column Order */
  -webkit-flex-flow: column-reverse;
  flex-flow: column-reverse;

}

/* -- Styling Only -- */

.container > div {
  background: red;
  color: white;
  padding: 10px;
}

.container > div:last-of-type {
  background: blue;
}
```

```
<div class="container">

  <div class="first">

     first

  </div>

  <div class="second">

    second

  </div>

</div>
```

资料来源：

*   [https://css-tricks.com/using-flexbox/](https://css-tricks.com/using-flexbox/)
*   [https://developer.mozilla.org/en-US/docs/Web/CSS/flex-flow#Browser_compatibility](https://developer.mozilla.org/en-US/docs/Web/CSS/flex-flow#Browser_compatibility)

* * *

## 回答 #5

> 赞同：26
> 
> 时间：2009-02-14T22:45:44.517

[在支持 pre-flexbox 用户代理（主要是旧的 IE](https://caniuse.com/#feat=flexbox)）的同时，绝对没有办法仅通过 CSS 来实现您想要的——**除非**：

1.  您知道每个元素的确切渲染高度（如果是这样，您可以绝对定位内容）。如果您正在处理动态生成的内容，那么您就不走运了。
2.  你知道这些元素的确切数量。同样，如果您需要对动态生成的几块内容执行此操作，那么您就不走运了，尤其是在超过三个左右的情况下。

如果上述情况属实，那么您可以通过绝对定位元素来做您想做的事——

```
#wrapper { position: relative; }
#firstDiv { position: absolute; height: 100px; top: 110px; }
#secondDiv { position: absolute; height: 100px; top: 0; } 
```

同样，如果您至少不知道#firstDiv 所需的高度，那么您无法仅通过 CSS 做您想做的事情。如果其中任何内容是动态的，则必须使用 javascript。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2008-10-20T23:46:14.247

这是一个解决方案：

```
<style>
#firstDiv {
    position:absolute; top:100%;
}
#wrapper {
    position:relative; 
} 
```

但我怀疑你有一些遵循包装器 div 的内容......

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2015-10-21T09:19:52.890

使用 CSS3 flexbox 布局模块，您可以订购 div。

```
#wrapper {
  display: flex;
  flex-direction: column;
}
#firstDiv {
  order: 2;
}

<div id="wrapper">
  <div id="firstDiv">
    Content1
  </div>
  <div id="secondDiv">
    Content2
  </div>
</div> 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2021-11-05T11:11:24.090

您可以使用弹性

```
#wrapper {
  display: flex;
  flex-direction: column;
}

#firstDiv {
  order: 1;
}

#secondDiv {
  order: 0;
}
```

```
<div id="wrapper">
    <div id="firstDiv">
        Content to be below in this situation
    </div>
    <div id="secondDiv">
        Content to be above in this situation
    </div>
</div>
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-10-20T23:40:37.377

如果您知道或可以强制执行待上元素的大小，则可以使用

```
position : absolute; 
```

在你的 CSS 中并给 div 自己的位置。

否则 javascript 似乎是唯一的方法：

```
fd = document.getElementById( 'firstDiv' );
sd = document.getElementById( 'secondDiv' );
fd.parentNode.removeChild( fd );
sd.parentNode.insertAfter( fd, sd ); 
```

或类似的东西。

编辑：我刚刚发现这可能有用：[w3 document css3 move-to](http://www.w3.org/TR/2003/WD-css3-content-20030514/#move-to)

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-10-22T02:05:09.410

负上边距可以达到这种效果，但需要为每个页面定制。例如，这个标记...

```
<div class="product">
<h2>Greatest Product Ever</h2>
<p class="desc">This paragraph appears in the source code directly after the heading and will appear in the search results.</p>
<p class="sidenote">Note: This information appears in HTML after the product description appearing below.</p>
</div> 
```

...还有这个 CSS ...

```
.product { width: 400px; }
.desc { margin-top: 5em; }
.sidenote { margin-top: -7em; } 
```

...将允许您将第二段拉到第一段之上。

当然，您必须针对不同的描述长度手动调整您的 CSS，以便介绍段落跳出适当的数量，但如果您对其他部分的控制有限并且完全控制标记和 CSS，那么这可能是一个选项.

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2020-12-24T17:22:42.593

仅针对移动设备订购并保留台式机的本地订单：

// html

```
<div>
  <div class="gridInverseMobile1">First</div>
  <div class="gridInverseMobile1">Second</div>
</div> 
```

// CSS

```
@media only screen and (max-width: 960px) {
  .gridInverseMobile1 {
    order: 2;
    -webkit-order: 2;
  }
  .gridInverseMobile2 {
    order: 1;
    -webkit-order: 1;
  }
} 
```

结果：

```
Desktop: First | Second
Mobile: Second | First 
```

来源：[https ://www.w3schools.com/cssref/css3_pr_order.asp](https://www.w3schools.com/cssref/css3_pr_order.asp)

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2019-12-18T09:12:02.157

**如果你只是使用 css，你可以使用 flex。**

```
.price {
    display: flex;
    align-items: center;
    justify-content: center;

    flex-direction: row-reverse; //revert horizontally
    //flex-direction: column-reverse; revert vertically
}
```

```
<div class="price">
      <div>first block</div>
      <div>second block</div>
</div>
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2008-10-20T23:38:49.253

好吧，通过一些绝对定位和一些狡猾的边距设置，我可以接近，但它并不完美或漂亮：

```
#wrapper { position: relative; margin-top: 4em; }
#firstDiv { position: absolute; top: 0; width: 100%; }
#secondDiv { position: absolute; bottom: 0; width: 100%; } 
```

“margin-top: 4em”是特别讨厌的一点：这个margin需要根据firstDiv中的内容量来调整。根据您的确切要求，这可能是可能的，但无论如何我希望有人能够在此基础上构建一个可靠的解决方案。

Eric 关于 JavaScript 的评论可能应该被追查。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2011-02-13T12:15:35.567

在您的 CSS 中，将第一个 div 向左或向右浮动。将第二个 div 向左或向右浮动，与第一个相同。对第二个 div应用`clear: left`或`right`同上两个 div。

例如：

```
#firstDiv {
    float: left;
}

#secondDiv {
    float: left;
    clear: left;
} 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2015-05-21T17:05:59.570

这只能用 CSS 来完成！

请检查我对这个类似问题的回答：

[https://stackoverflow.com/a/25462829/1077230](https://stackoverflow.com/a/25462829/1077230)

我不想重复发布我的答案，但不足之处在于父级需要成为 flexbox 元素。例如：

（此处仅使用 webkit 供应商前缀。）

```
#main {
    display: -webkit-box;
    display: -webkit-flex;
    display: flex;
    -webkit-box-orient: vertical;
    -webkit-flex-direction: column;
    flex-direction: column;
    -webkit-box-align: start;
    -webkit-align-items: flex-start;
    align-items: flex-start;
} 
```

然后，通过以下方式指示它们的顺序来交换 div：

```
#main > div#one{
    -webkit-box-ordinal-group: 2;
    -moz-box-ordinal-group: 2;
    -ms-flex-order: 2;
    -webkit-order: 2;
    order: 2;
    overflow:visible;
}

#main > div#two{
    -webkit-box-ordinal-group: 1;
    -moz-box-ordinal-group: 1;
    -ms-flex-order: 1;
    -webkit-order: 1;
    order: 1;
} 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2013-06-28T11:56:59.107

我正在寻找一种方法来更改仅适用于移动版本的 div 的顺序，以便我可以很好地设置它的样式。感谢 nickf 的回复，我得到了这段代码，它可以很好地满足我的需求，所以我想与你们分享：

```
//  changing the order of the sidebar so it goes after the content for mobile versions
jQuery(window).resize(function(){
    if ( jQuery(window).width() < 480 )
    {
        jQuery('#main-content').insertBefore('#sidebar');
    }
    if ( jQuery(window).width() > 480 )
    {
        jQuery('#sidebar').insertBefore('#main-content');
    }
    jQuery(window).height(); // New height
    jQuery(window).width(); // New width
}); 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2016-09-22T01:21:43.500

具有比 flexbox 更大的浏览器支持的解决方案（适用于 IE≥9）：

```
#wrapper {
  -webkit-transform: scaleY(-1);
  -ms-transform: scaleY(-1);
  transform: scaleY(-1);
}
#wrapper > * {
  -webkit-transform: scaleY(-1);
  -ms-transform: scaleY(-1);
  transform: scaleY(-1);
}
```

```
<div id="wrapper">
    <div id="firstDiv">
        Content to be below in this situation
    </div>
    <div id="secondDiv">
        Content to be above in this situation
    </div>
</div>
Other elements
```

与该`display: table;`解决方案相比，该解决方案在`.wrapper`有任意数量的孩子时都有效。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2021-11-08T09:07:07.423

如果要反转子项的显示顺序。我建议你用这个

> `direction: rtl;` // 右到左

在父元素中设置此属性

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2016-08-17T19:03:43.267

只需通过指定`display: flex`和为父 div 使用 flex `flex-direction : column`。然后用order来判断哪个子div先来

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2009-02-14T20:38:34.460

CSS 真的不应该用来重构 HTML 后端。但是，如果您知道所涉及的两个元素的高度并且感觉很hackish，则有可能。此外，在 div 之间移动时，文本选择会变得混乱，但这是因为 HTML 和 CSS 顺序相反。

```
#firstDiv { position: relative; top: YYYpx; height: XXXpx; }
#secondDiv { position: relative; top: -XXXpx; height: YYYpx; } 
```

其中 XXX 和 YYY 分别是 firstDiv 和 secondDiv 的高度。与最佳答案不同，这将适用于尾随元素。

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2011-09-22T12:35:59.570

我有一个更好的代码，由我编写，它是如此之大，只是为了显示这两件事......创建一个 4x4 表格并垂直对齐不仅仅是一个单元格。

它不使用任何 IE hack，不使用 vertical-align:middle；根本...

不用于垂直居中 display-table, display:table-rom; 显示：表格单元格；

它使用具有两个 div 的容器的技巧，一个隐藏（位置不正确，但使父级具有正确的可变大小），一个在隐藏之后可见但顶部：-50%；所以它是正确位置的推动者。

查看 div 类，使伎俩： BloqueTipoContenedor BloqueTipoContenedor_VerticalmenteCentrado BloqueTipoContenido_VerticalmenteCentrado_Oculto BloqueTipoContenido_VerticalmenteCentrado_Visible

请抱歉在课程名称上使用西班牙语（这是因为我说西班牙语，这太棘手了，如果我使用英语我会迷路）。

完整代码：

```
<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta http-equiv="Content-Language" content="en" />
<meta name="language" content="en" />
<title>Vertical Centering in CSS2 - Example (IE, FF & Chrome tested) - This is so tricky!!!</title>
<style type="text/css">
 html,body{
  margin:0px;
  padding:0px;
  width:100%;
  height:100%;
 }
 div.BloqueTipoTabla{
  display:table;margin:0px;border:0px;padding:0px;width:100%;height:100%;
 }
 div.BloqueTipoFila_AltoAjustadoAlContenido{
  display:table-row;margin:0px;border:0px;padding:0px;width:100%;height:auto;
 }
 div.BloqueTipoFila_AltoRestante{
  display:table-row;margin:0px;border:0px;padding:0px;width:100%;height:100%;
 }
 div.BloqueTipoCelda_AjustadoAlContenido{
  display:table-cell;margin:0px;border:0px;padding:0px;width:auto;height:auto;
 }
 div.BloqueTipoCelda_RestanteAncho{
  display:table-cell;margin:0px;border:0px;padding:0px;width:100%;height:auto;
 }
 div.BloqueTipoCelda_RestanteAlto{
  display:table-cell;margin:0px;border:0px;padding:0px;width:auto;height:100%;
 }
 div.BloqueTipoCelda_RestanteAnchoAlto{
  display:table-cell;margin:0px;border:0px;padding:0px;width:100%;height:100%;
 }
 div.BloqueTipoContenedor{
  display:block;margin:0px;border:0px;padding:0px;width:100%;height:100%;position:relative;
 }
 div.BloqueTipoContenedor_VerticalmenteCentrado{
  display:block;margin:0px;border:0px;padding:0px;width:100%;height:auto;position:relative;top:50%;
 }
 div.BloqueTipoContenido_VerticalmenteCentrado_Oculto{
  display:block;margin:0px;border:0px;padding:0px;width:100%;height:auto;visibility:hidden;position:relative;top:50%;
 }
 div.BloqueTipoContenido_VerticalmenteCentrado_Visible{
  display:block;margin:0px;border:0px;padding:0px;width:100%;height:auto;visibility:visible;position:absolute;top:-50%;
 }
</style>
</head>
<body>
<h1>Vertical Centering in CSS2 - Example<br />(IE, FF & Chrome tested)<br />This is so tricky!!!</h1>
<div class="BloqueTipoTabla" style="margin:0px 0px 0px 25px;width:75%;height:66%;border:1px solid blue;">
 <div class="BloqueTipoFila_AltoAjustadoAlContenido">
  <div class="BloqueTipoCelda_AjustadoAlContenido">
   [1,1]
  </div>
  <div class="BloqueTipoCelda_AjustadoAlContenido">
   [1,2]
  </div>
  <div class="BloqueTipoCelda_RestanteAncho">
   [1,3]
  </div>
  <div class="BloqueTipoCelda_AjustadoAlContenido">
   [1,4]
  </div>
 </div>
 <div class="BloqueTipoFila_AltoAjustadoAlContenido">
  <div class="BloqueTipoCelda_AjustadoAlContenido">
   [2,1]
  </div>
  <div class="BloqueTipoCelda_AjustadoAlContenido">
   [2,2]
  </div>
  <div class="BloqueTipoCelda_RestanteAncho">
   [2,3]
  </div>
  <div class="BloqueTipoCelda_AjustadoAlContenido">
   [2,4]
  </div>
</div>
 <div class="BloqueTipoFila_AltoRestante">
  <div class="BloqueTipoCelda_RestanteAlto">
   <div class="BloqueTipoContenedor" style="border:1px solid lime;">
    <div class="BloqueTipoContenedor_VerticalmenteCentrado" style="border:1px dotted red;">
     <div class="BloqueTipoContenido_VerticalmenteCentrado_Oculto">
     The cell [3,1]
     <br />
     *&nbsp;*&nbsp;*&nbsp;*
     <br />
     *&nbsp;*&nbsp;*&nbsp;*
     <br />
     *&nbsp;*&nbsp;*&nbsp;*
     <br />
     Now&nbsp;is&nbsp;the&nbsp;highest&nbsp;one
     </div>
     <div class="BloqueTipoContenido_VerticalmenteCentrado_Visible" style="border:1px dotted blue;">
     The cell [3,1]
     <br />
     *&nbsp;*&nbsp;*&nbsp;*
     <br />
     *&nbsp;*&nbsp;*&nbsp;*
     <br />
     *&nbsp;*&nbsp;*&nbsp;*
     <br />
     Now&nbsp;is&nbsp;the&nbsp;highest&nbsp;one
     </div>
    </div>
   </div>
  </div>
  <div class="BloqueTipoCelda_RestanteAlto">
   <div class="BloqueTipoContenedor" style="border:1px solid lime;">
    <div class="BloqueTipoContenedor_VerticalmenteCentrado" style="border:1px dotted red;">
     <div class="BloqueTipoContenido_VerticalmenteCentrado_Oculto">
      This&nbsp;is<br />cell&nbsp;[3,2]
     </div>
     <div class="BloqueTipoContenido_VerticalmenteCentrado_Visible" style="border:1px dotted blue;">
      This&nbsp;is<br />cell&nbsp;[3,2]
     </div>
    </div>
   </div>
  </div>
  <div class="BloqueTipoCelda_RestanteAnchoAlto">
   <div class="BloqueTipoContenedor" style="border:1px solid lime;">
    <div class="BloqueTipoContenedor_VerticalmenteCentrado" style="border:1px dotted red;">
     <div class="BloqueTipoContenido_VerticalmenteCentrado_Oculto">
      This is cell [3,3]
      <br/>
      It is duplicated on source to make the trick to know its variable height
      <br />
      First copy is hidden and second copy is visible
      <br/>
      Other cells of this row are not correctly aligned only on IE!!!
     </div>
     <div class="BloqueTipoContenido_VerticalmenteCentrado_Visible" style="border:1px dotted blue;">
      This is cell [3,3]
      <br/>
      It is duplicated on source to make the trick to know its variable height
      <br />
      First copy is hidden and second copy is visible
      <br/>
      Other cells of this row are not correctly aligned only on IE!!!
     </div>
    </div>
   </div>
  </div>
  <div class="BloqueTipoCelda_RestanteAlto">
   <div class="BloqueTipoContenedor" style="border:1px solid lime;">
    <div class="BloqueTipoContenedor_VerticalmenteCentrado" style="border:1px dotted red;">
     <div class="BloqueTipoContenido_VerticalmenteCentrado_Oculto">
      This&nbsp;other is<br />the cell&nbsp;[3,4]
     </div>
     <div class="BloqueTipoContenido_VerticalmenteCentrado_Visible" style="border:1px dotted blue;">
      This&nbsp;other is<br />the cell&nbsp;[3,4]
     </div>
    </div>
   </div>
  </div>
 </div>
 <div class="BloqueTipoFila_AltoAjustadoAlContenido">
  <div class="BloqueTipoCelda_AjustadoAlContenido">
   [4,1]
  </div>
  <div class="BloqueTipoCelda_AjustadoAlContenido">
   [4,2]
  </div>
  <div class="BloqueTipoCelda_RestanteAncho">
   [4,3]
  </div>
  <div class="BloqueTipoCelda_AjustadoAlContenido">
   [4,4]
  </div>
 </div>
</div>
</body>
</html> 
```

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2017-03-09T22:43:58.127

晚会有点晚了，但你也可以这样做：

```
<div style="height: 500px; width: 500px;">

<div class="bottom" style="height: 250px; width: 500px; background: red; margin-top: 250px;"></div>

<div class="top" style="height: 250px; width: 500px; background: blue; margin-top: -500px;"></div> 
```

* * *

## 回答 #23

> 赞同：-2
> 
> 时间：2011-07-15T17:49:19.113

或者为元素设置一个绝对位置，并通过从页面边缘而不是对象边缘声明它们来处理边距。使用 % 因为它更适合其他屏幕尺寸等。这就是我克服这个问题的方法......谢谢，希望它是你想要的......

* * *

## 回答 #24

> 赞同：-3
> 
> 时间：2010-06-01T13:15:08.277

仅适用于 CSS 解决方案 1\. 包装器的高度应固定或 2\. 第二个 div 的高度应固定

* * *

## 回答 #25

> 赞同：-3
> 
> 时间：2015-01-09T13:33:48.500

```
.move-wrap {
    display: table;
    table-layout: fixed; // prevent some responsive bugs
    width: 100%; // set a width if u like
    /* TODO: js-fallback IE7 if u like ms */
}

.move-down {
    display: table-footer-group;
}

.move-up {
    display: table-header-group;
} 
```

* * *

## 回答 #26

> 赞同：-4
> 
> 时间：2012-11-11T14:26:18.310

使用 css 很容易，只需使用`display:block`和`z-index`属性

这是一个例子：

**HTML：**

```
<body>
    <div class="wrapper">

        <div class="header">
            header
        </div>

        <div class="content">
            content
        </div>
    </div>
</body> 
```

**CSS：**

```
.wrapper
{
    [...]
}

.header
{
    [...]
    z-index:9001;
    display:block;
    [...]
}

.content
{
    [...]
    z-index:9000;
    [...]
} 
```

编辑：最好设置一些`background-color`以`div-s`正确查看事物。

* * *

## 回答 #27

> 赞同：-4
> 
> 时间：2015-01-29T04:48:12.720

我有一个简单的方法来做到这一点。

```
<!--  HTML  -->

<div class="wrapper">

    <div class="sm-hide">This content hides when at your layouts chosen breaking point.</div>

    <div>Content that stays in place</div>

    <div class="sm-show">This content is set to show at your layouts chosen breaking point.</div>

</div>

<!--  CSS  -->

    .sm-hide {display:block;}
    .sm-show {display:none;}

@media (max-width:598px) {
    .sm-hide {display:none;}
    .sm-show {display:block;}
} 
```

# .net - 远程计算机无法连接到 Visual Studio Web 服务器

> ID：220274
> 
> 赞同：41
> 
> 时间：2008-10-20T23:16:55.100
> 
> 标签：.net, asp.net, visual-studio, visual-studio-2008

我记得当 MS 开发 Cassini 时 - 我相信他们将它纳入 VS 05/08，所以我认为这是一个 Cassini Web 服务器问题。

我正在使用带有 Visual Studio 2008 的 Windows XP，当我想使用多个浏览器和多个操作系统测试网页/样式时，发现它非常不方便。现在我必须在我们的服务器上部署代码，如果需要进行任何更新，那么这个过程就会浪费很多时间。由于我使用的是 XP/IIS 5，所以不能选择使用 IIS。在 XP 上使用 IIS 需要为项目添加额外的前缀，这会破坏所有链接、css 等。这也是一个非常快速的开发项目，因此不需要将根目录之类的东西拉出到配置中，我很喜欢板与这种类型的解决方案，但它没有在这个项目中实现。MS不允许在某个地方使用简单的标志来允许远程连接似乎也很粗略-它非常简单（[http://www.devx.com/dotnet/Article/11711](http://www.devx.com/dotnet/Article/11711)）但我不想重新编译卡西尼。

有谁知道如何让 Visual Studio 2008 中的集成开发 Web 服务器被其他计算机看到？这将节省大量时间。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-11-13T21:45:39.823

刚刚想出了一个好的解决方案：1）在开发机器上设置提琴手 2）设置远程机器以使用提琴手作为代理 3）浏览到`http://localhost.:[insert your dev port # here`远程机器上的 ]/

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2011-11-14T10:49:13.607

很抱歉回答了一个老问题，但它在谷歌中排名所以我决定加我的 2 美分：

在 VS 2010 中有一个选项可以使用“IIS Express”而不是 VS Development Server，它默认允许远程连接。

更新：当前版本的 IIS Express 默认情况下不允许外部连接，请参阅[此处](https://stackoverflow.com/questions/5433786/configure-iis-express-for-external-access-to-vs2010-project)了解如何启用远程连接。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-01-24T17:27:24.647

您可以使用端口转发实用程序侦听端口，例如 5000，然后将所有流量中继到 Visual Studio 的端口。

该解决方案在文章“[从 iPhone 访问 Visual Studio ASP.NET 开发服务器](http://web.archive.org/web/20100826033242/http://www.pluralsight-training.net/community/blogs/jimw/archive/2009/09/03/accessing-the-visual-studio-asp-net-development-server-from-iphone.aspx)”中进行了描述。

我根据上面的文章写了一篇博客文章，总结了它，[远程访问 Visual Studio Web 服务器](http://tahirhassan.blogspot.co.uk/2013/01/accessing-visual-studio-web-server.html)。

[![在此处输入图像描述](https://i.stack.imgur.com/pqAXn.png)](https://i.stack.imgur.com/pqAXn.png)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-20T23:18:51.417

Microsoft 不允许这样做 - 他们不希望您使用 Cassini 部署您的应用程序。 [它被直接编译到它的代码](http://www.devx.com/dotnet/Article/11711)中。

话虽如此，我经常想知道他们是否只是检查“localhost”的url。也许编辑远程机器的 HOSTS 文件并将“localhost”重定向到卡西尼机器可以欺骗它？值得一试...在 Windows 中，您可以在此处找到主机：

```
C:\Windows\system32\drivers\etc 
```

您可以进入您的 Web 项目设置并让它使用本地 IIS 作为主机，然后它就可以正常工作了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-20T23:34:37.250

要解决链接断开、文件路径等问题。使用相对链接。

此外，ASP.NET 服务器控件中的 URL/路径属性/值中的标记“~/”（不带引号）将自动替换为应用程序所在的 IIS 子文件夹的真实路径。

要使此解决方案正常工作，您正在开发的 Web 应用程序的根必须是 IIS 应用程序（请参阅 Web 部分的 Web 项目属性页，您可以在其中找到创建 IIS 应用程序的链接或按钮）。

Google for IIS Web 应用程序根。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T00:00:10.740

我在本地机器上针对多个浏览器进行测试。本地 Web 服务器不关心您是否使用 Opera/Safari/Firefox/IE 连接到它。通常我在调试器中启动项目，它也启动 IE，然后将 IE 中的 URL 剪切/粘贴到我正在测试的任何浏览器中。通常，Cassini 选择的端口不会经常更改，因此很多时候 URL 已经存在于我的浏览器历史记录中。一旦 Web 服务器运行，您甚至可以停止调试器并继续在备用浏览器中进行测试。

对于其他 MacOS，我通常使用 IIS6 发布到 QA 服务器。在使用 IE/Firefox/etc 进行测试后，我发现很少有这种情况。在 WinXP 上，Mac 上存在问题。我没有专门测试 Linux 的变体。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2011-07-14T14:27:49.390

尝试将 .Net 绑定到 127.0.0.1 而不是 localhost，在我遇到的某些情况下，它确实会影响分辨率。我希望我一直都知道这会为我节省几个小时。

我还看到使用 Privoxy，它可能更快，但 Fiddler 更容易，不需要设置环回。

无论如何，我在 localhost:15709 和 Fiddler 上设置了 VS： if (oSession.host.toLowerCase() == "webserver:15709") oSession.host = "localhost:15709";

所以我只需在我的虚拟机中输入 webserver:15709 就可以了。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2010-12-03T09:19:02.787

使用 Fiddler 作为反向代理，开发 Web 服务器可以获取请求，但它变成了内部请求（127.0.0.1），这在我的情况下是无用的。

我正在尝试捕获远程请求以在那里进行调试。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2013-04-01T16:59:50.833

WebMatrix 是另一种选择。

# visual-c++ - 使用 Microsoft 的 Visual C++ 编译器时，gcc 是否有与 -pedantic 等价的功能？

> ID：220298
> 
> 赞同：12
> 
> 时间：2008-10-20T23:29:00.473
> 
> 标签：visual-c++, compiler-warnings

我想使用 Microsoft Visual C++ 编译器将我的警告设置为最高级别。类似于在 gcc 上使用 -pedantic。您使用哪些编译器开关来启用最多警告？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-20T23:48:24.803

Visual C++ 上的最高警告级别是 /Wall。警告级别也可以使用 /W0、/W1、... /W4 以数字方式设置，以生成不断增加的警告级别。

编译器还将检查 /Wp64 的 64 位可移植性问题。

您可以使用 /WX 告诉它将警告视为错误

Visual C++ 似乎没有真正的等效于 -pedantic - 它要求 gcc 报告 ISO C 和 C++ 标准要求报告的所有警告。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-21T00:15:13.017

正如billmcc64[提到](https://stackoverflow.com/questions/220298/is-there-an-equivalent-to-pedantic-for-gcc-when-using-microsofts-visual-c-compi#220341)的那样，如果您使用任何非标准扩展，gcc 的 -pedantic 会导致 gcc 发出警告。我不认为您可以让 MSVC 对类似情况发出警告，但您可以使用 /Za 选项使其在这些情况下生成错误。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-21T00:04:15.863

请注意，Microsoft 不建议使用 /Wp64，而是尽可能直接为 64 位平台编译。

另请注意，Team Developer 版本有一个 /analyze 选项，它添加了对常见代码错误的语义检查。您还可以查看从 gimpel 获取 PC-lint 以进行额外的语义检查。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-21T00:37:12.163

如果您想要类似 -pedantic 的东西，请尝试使用 pc-lint（[http://www.gimpel.com/html/products.htm](http://www.gimpel.com/html/products.htm)）之类的优质 lint。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2020-08-23T01:54:39.520

`/permissive-`查看Visual Studio 2017 及更高版本支持的新选项。从 Windows Fall Creators SDK (10.0.16299.0) 开始，该`/permissive-`选项与最新 Windows 工具包中的几乎所有头文件兼容，例如软件开发工具包 (SDK) 或 Windows 驱动程序工具包 (WDK)。`/permissive-`由于各种源代码一致性原因，旧版本的 SDK 可能无法编译。

*还有禁用所有语言扩展的选项，但是当使用来自**Windows 工具包**的头文件（例如**winnt.h**和**winioctl.h**）`/Za`时，这也会导致编译错误。所以，这个选项实际上并不可行。*

 ******See: [https://docs.microsoft.com/en-us/cpp/build/reference/permissive-standards-conformance](https://docs.microsoft.com/en-us/cpp/build/reference/permissive-standards-conformance)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-20T23:34:29.963

`/W4 /Wall`应该做的伎俩。

# java - 目前哪些 xml/xslt 库适用于 java？

> ID：220313
> 
> 赞同：2
> 
> 时间：2008-10-20T23:34:22.150
> 
> 标签：java, xml, xslt

我需要将一些 xml 模板应用于各种 xml 数据流（有时还有文件），并且似乎有大量用于 java 的 xml 库 - 足以快速确定哪些库仍然处于活动状态，它们与同样有效的其他选项有何不同，以及在选择一个选项时应考虑哪些标准。

您使用哪些库来在 java 中操作 xml，为什么它比其他库更好？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-21T02:08:37.267

saxon 是 xslt 和 xquery 解析器 - [http://saxon.sourceforge.net/](http://saxon.sourceforge.net/)。这是由一位知名的 xslt 专家（他是 xslt 规范委员会的成员并撰写过书籍）构建的。有开源版和商业版。

它（xslt 片）得到不断改进。
java中的另一个xslt工具当然是XALAN。

xml - 有很多。值得注意的（多年来经过良好测试）
1）jdk xml 解析器——dom、sax、stax
2）xerces：来自 apache
3）XOM——如果 DOM 不适合你
4）JDOM——较早流行的一种开源工具
5) JAXB -- 现在内置到 JDK 6 中
6) woodstox -- 不错的 xml 处理器（读/写） -- [http://woodstox.codehaus.org/](http://woodstox.codehaus.org/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T23:41:35.800

您应该决定是否希望/能够将整个文档加载到内存中。如果是大文档，您可能需要查看 sax[解析器](http://java.sun.com/j2se/1.4.2/docs/api/javax/xml/parsers/SAXParser.html)。这适用于大型文档。否则，您可能需要查看 dom 解析器。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-23T05:00:57.340

没有人提到 JAXP，即用于 XML 处理的 Java API。与 jdk 一起开箱即用，具有默认的 xml 库实现。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-26T07:42:30.657

Wrt "JAXP"：这只是一个非常简单的包装器，用于创建 DOM 或 SAX 解析器实例。JDK 捆绑的实现是 Xerces。因此，它本身不是替代方案；它只是前面提到的构造“JDK解析器”的标准API。对于 XSLT，Saxon 严格优于 Xalan；特征，速度（2x）。JAXB v2 适合数据绑定，Stax (Woodstox) 最适合流式传输。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T09:18:24.763

我使用 Xerces 进行 XML 解析 (DOM) 和针对 XSD 的验证。

对于 XSLT 处理，我使用了 Xalan，但它是 3 年前的，所以很多东西必须改变，在我的记忆中它易于使用且功能强大（我使用了几个 Mo 的输入 XML 文件）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-15T13:55:04.453

我一直在使用 StAX 拉解析器来实现自定义内存和性能高效的 POJO-2-xml 序列化解决方案，并且对结果非常满意。它捆绑在 JDK6 中，因此您不需要任何额外的依赖项来运行它。

# c# - DbProviderFactory、DbConnection、DbCommand 和 DbDataAdapter 是线程安全的吗？

> ID：220317
> 
> 赞同：0
> 
> 时间：2008-10-20T23:35:11.990
> 
> 标签：c#, .net, sql, sql-server, database

与 DbProviderFactory 线程相关的 .net 类是否安全？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-22T18:08:08.670

来自 msdn：线程安全

此类型的任何公共静态（在 Visual Basic 中为 Shared）成员都是线程安全的。不保证任何实例成员都是线程安全的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T13:21:04.647

当您说“这些实例在运行时生成一次，并在服务的剩余生命周期中使用”时，您是指连接对象吗？另外，您的意思是您在服务的整个生命周期中保持连接对象处于打开状态？如果您的服务是多线程的，并且您只有一个连接实例（例如单例或静态类），则必须确保一次仅由一个线程使用该连接。

在没有看到太多代码的情况下，这听起来像是您如何对待从工厂获得的 IDbConnection 而不是工厂本身的问题。

我们在多线程应用程序中大量使用 DbProviderFactory，这些应用程序连接到 Oracle、FoxPro 和 SqlServer，我还没有看到这个问题。

祝你好运！

里卡多。

# c++ - 在 Darwin/OSX 中以编程方式确定进程信息

> ID：220323
> 
> 赞同：15
> 
> 时间：2008-10-20T23:38:55.010
> 
> 标签：c++, c, macos, operating-system, darwin

我有一个具有以下成员函数的类：

```
 /// caller pid
virtual pid_t Pid() const = 0; 

/// physical memory size in KB
virtual uint64_t Size() const = 0;  

/// resident memory for this process
virtual uint64_t Rss() const = 0; 

/// cpu used by this process
virtual double PercentCpu() const = 0; 

/// memory used by this process
virtual double PercentMemory() const = 0; 

/// number of threads in this process
virtual int32_t Lwps() const = 0; 

```

此类的职责是返回有关调用者的进程信息。物理内存大小可以通过 sysctl 调用轻松确定，并且 pid 是微不足道的，但是除了在 ps 或 top 上调用 popen 并解析输出之外，其余的调用让我望而却步——这是不可接受的。任何帮助将不胜感激。

要求：
在 g++ 4.0 上编译
没有 obj-c
OSX 10.5

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-21T06:00:16.160

流程信息来自`pidinfo`：

```
cristi:~ diciu$ grep proc_pidinfo /usr/include/libproc.h

int proc_pidinfo(int pid, int flavor, uint64_t arg,  void *buffer, int buffersize); 
```

cpu负载来自`host_statistics`：

```
cristi:~ diciu$ grep -r host_statistics /usr/include/

/usr/include/mach/host_info.h:/* host_statistics() */

/usr/include/mach/mach_host.defs:routine host_statistics(

/usr/include/mach/mach_host.h:/* Routine host_statistics */

/usr/include/mach/mach_host.h:kern_return_t host_statistics 
```

有关更多详细信息，请查看`top`和的来源`lsof`，它们是开源的（您需要注册为 Apple 开发人员，但这是免费的）：

[https://opensource.apple.com/source/top/top-111.20.1/libtop.c.auto.html](https://opensource.apple.com/source/top/top-111.20.1/libtop.c.auto.html)

**稍后编辑：**所有这些接口都是特定于版本的，因此在编写生产代码（libproc.h）时需要考虑到这一点：

```
/*
 * This header file contains private interfaces to obtain process information.
 * These interfaces are subject to change in future releases.
 */ 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-21T02:11:56.573

既然您说没有 Objective-C，我们将排除大多数 MacOS 框架。

您可以使用 getrusage() 获取 CPU 时间，它会为您的进程提供用户和系统 CPU 时间的总量。要获得 CPU 百分比，您需要每秒对 getrusage 值进行一次快照（或者您想要的粒度如何）。

```
#include <sys/resource.h>

struct rusage r_usage;

if (getrusage(RUSAGE_SELF, &r_usage)) {
    /* ... error handling ... */
}

printf("Total User CPU = %ld.%ld\n",
        r_usage.ru_utime.tv_sec,
        r_usage.ru_utime.tv_usec);
printf("Total System CPU = %ld.%ld\n",
        r_usage.ru_stime.tv_sec,
        r_usage.ru_stime.tv_usec); 
```

getrusage 结构中有一个 RSS 字段，但在 MacOS X 10.5 中似乎始终为零。[Michael Knight](http://miknight.blogspot.com/2005/11/resident-set-size-in-mac-os-x.html)几年前写了一篇关于如何确定 RSS 的博客文章。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-20T23:51:59.307

我认为这些值中的大多数都可以在 Mach API 中使用，但是我已经有一段时间没有在那里闲逛了。或者，您可以只查看“ps”或“top”命令的源代码，看看它们是如何做到的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-05-13T12:52:17.453

您可以在 mac OS 中使用以下代码获取进程信息：

```
void IsInBSDProcessList(char *name)    { 
  assert( name != NULL); 
  kinfo_proc *result; 
  size_t count = 0; 
  result = (kinfo_proc *)malloc(sizeof(kinfo_proc)); 
  if(GetBSDProcessList(&result,&count) == 0) { 
    for (int i = 0; i < count; i++) { 
      kinfo_proc *proc = NULL; 
      proc = &result[i]; 
      }
  } 
  free(result);
} 
```

kinfo_proc 结构包含有关进程的所有信息。例如进程标识符（pid）、进程组、进程状态等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-20T23:55:14.557

大部分信息可以从[GetProcessInformation()](http://developer.apple.com/documentation/Carbon/Reference/Process_Manager/Reference/reference.html#//apple_ref/doc/uid/TP30000208-CH1g-TPXREF103)获得。

顺便说一句，为什么要为返回进程范围信息的函数提供虚拟方法？

这只是**碳**，不适用于可可

# sql - 如何通过 T-SQL 检查 SQL 复制状态？

> ID：220340
> 
> 赞同：20
> 
> 时间：2008-10-20T23:47:40.407
> 
> 标签：sql, sql-server, sql-server-2008, replication

我希望能够在 SQL Server 2008 T-SQL 中检查发布和订阅的状态。我希望能够确定它是否可以，最后一次成功是什么时候，同步等等。这可能吗？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2010-10-27T18:29:01.303

我知道这有点晚了......

```
SELECT 
(CASE  
    WHEN mdh.runstatus =  '1' THEN 'Start - '+cast(mdh.runstatus as varchar)
    WHEN mdh.runstatus =  '2' THEN 'Succeed - '+cast(mdh.runstatus as varchar)
    WHEN mdh.runstatus =  '3' THEN 'InProgress - '+cast(mdh.runstatus as varchar)
    WHEN mdh.runstatus =  '4' THEN 'Idle - '+cast(mdh.runstatus as varchar)
    WHEN mdh.runstatus =  '5' THEN 'Retry - '+cast(mdh.runstatus as varchar)
    WHEN mdh.runstatus =  '6' THEN 'Fail - '+cast(mdh.runstatus as varchar)
    ELSE CAST(mdh.runstatus AS VARCHAR)
END) [Run Status], 
mda.subscriber_db [Subscriber DB], 
mda.publication [PUB Name],
right(left(mda.name,LEN(mda.name)-(len(mda.id)+1)), LEN(left(mda.name,LEN(mda.name)-(len(mda.id)+1)))-(10+len(mda.publisher_db)+(case when mda.publisher_db='ALL' then 1 else LEN(mda.publication)+2 end))) [SUBSCRIBER],
CONVERT(VARCHAR(25),mdh.[time]) [LastSynchronized],
und.UndelivCmdsInDistDB [UndistCom], 
mdh.comments [Comments], 
'select * from distribution.dbo.msrepl_errors (nolock) where id = ' + CAST(mdh.error_id AS VARCHAR(8)) [Query More Info],
mdh.xact_seqno [SEQ_NO],
(CASE  
    WHEN mda.subscription_type =  '0' THEN 'Push' 
    WHEN mda.subscription_type =  '1' THEN 'Pull' 
    WHEN mda.subscription_type =  '2' THEN 'Anonymous' 
    ELSE CAST(mda.subscription_type AS VARCHAR)
END) [SUB Type],

mda.publisher_db+' - '+CAST(mda.publisher_database_id as varchar) [Publisher DB],
mda.name [Pub - DB - Publication - SUB - AgentID]
FROM distribution.dbo.MSdistribution_agents mda 
LEFT JOIN distribution.dbo.MSdistribution_history mdh ON mdh.agent_id = mda.id 
JOIN 
    (SELECT s.agent_id, MaxAgentValue.[time], SUM(CASE WHEN xact_seqno > MaxAgentValue.maxseq THEN 1 ELSE 0 END) AS UndelivCmdsInDistDB 
    FROM distribution.dbo.MSrepl_commands t (NOLOCK)  
    JOIN distribution.dbo.MSsubscriptions AS s (NOLOCK) ON (t.article_id = s.article_id AND t.publisher_database_id=s.publisher_database_id ) 
    JOIN 
        (SELECT hist.agent_id, MAX(hist.[time]) AS [time], h.maxseq  
        FROM distribution.dbo.MSdistribution_history hist (NOLOCK) 
        JOIN (SELECT agent_id,ISNULL(MAX(xact_seqno),0x0) AS maxseq 
        FROM distribution.dbo.MSdistribution_history (NOLOCK)  
        GROUP BY agent_id) AS h  
        ON (hist.agent_id=h.agent_id AND h.maxseq=hist.xact_seqno) 
        GROUP BY hist.agent_id, h.maxseq 
        ) AS MaxAgentValue 
    ON MaxAgentValue.agent_id = s.agent_id 
    GROUP BY s.agent_id, MaxAgentValue.[time] 
    ) und 
ON mda.id = und.agent_id AND und.[time] = mdh.[time] 
where mda.subscriber_db<>'virtual' -- created when your publication has the immediate_sync property set to true. This property dictates whether snapshot is available all the time for new subscriptions to be initialized. This affects the cleanup behavior of transactional replication. If this property is set to true, the transactions will be retained for max retention period instead of it getting cleaned up as soon as all the subscriptions got the change.
--and mdh.runstatus='6' --Fail
--and mdh.runstatus<>'2' --Succeed
order by mdh.[time] 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2015-02-11T10:49:29.793

旧帖子但为其他人添加 - 以下存储过程将为您提供所需的内容：

*   sp_replmonitorhelppublication ( [https://msdn.microsoft.com/en-us/library/ms186304.aspx](https://msdn.microsoft.com/en-us/library/ms186304.aspx) )

它允许您查看分发者的所有复制发布的状态和其他信息（在分发数据库上运行它）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2022-01-05T13:45:27.237

如果有帮助，我将给出的两个答案的一部分结合起来，并采用 sp_replmonitorhelppublication 和 sp_replmonitorhelpsubscription 并将它们放入临时表中，以便我可以对它们进行排序并根据需要排除列。

请注意，订阅者脚本从 sp_replmonitorhelpsubscription 中排除了一些合并列，因为我不是在寻找合并复制数据。

```
-------------------------------------------------------------------------------------------------------------------------
--  PUBLISHER SCRIPT
-------------------------------------------------------------------------------------------------------------------------

IF OBJECT_ID ('tempdb..#tmp_replicationPub_monitordata') IS NOT NULL DROP TABLE #tmp_replicationPub_monitordata;

CREATE TABLE #tmp_replicationPub_monitordata (
    publisher_db             sysname
  , publication              sysname
  , publication_id           INT
  , publication_type         INT
  , status                   INT        -- publication status defined as max(status) among all agents
  , warning                  INT        -- publication warning defined as max(isnull(warning,0)) among all agents
  , worst_latency            INT
  , best_latency             INT
  , average_latency          INT
  , last_distsync            DATETIME   -- last sync time
  , retention                INT        -- retention period                                               
  , latencythreshold         INT
  , expirationthreshold      INT
  , agentnotrunningthreshold INT
  , subscriptioncount        INT        -- # of subscription
  , runningdistagentcount    INT        -- # of running agents
  , snapshot_agentname       sysname NULL
  , logreader_agentname      sysname NULL
  , qreader_agentname        sysname NULL
  , worst_runspeedPerf       INT
  , best_runspeedPerf        INT
  , average_runspeedPerf     INT
  , retention_period_unit    TINYINT
  , publisher                sysname NULL
);

INSERT INTO #tmp_replicationPub_monitordata
EXEC sp_replmonitorhelppublication;

SELECT      (CASE WHEN status = '1' THEN 'Start - ' + CAST(status AS VARCHAR)
                 WHEN status = '2' THEN 'Succeed - ' + CAST(status AS VARCHAR)
                 WHEN status = '3' THEN 'InProgress - ' + CAST(status AS VARCHAR)
                 WHEN status = '4' THEN 'Idle - ' + CAST(status AS VARCHAR)
                 WHEN status = '5' THEN 'Retry - ' + CAST(status AS VARCHAR)
                 WHEN status = '6' THEN 'Fail - ' + CAST(status AS VARCHAR)ELSE CAST(status AS VARCHAR)END)  [Run Status]
          , publisher_db
          , publication
          , publication_id
          , (CASE WHEN publication_type = '0' THEN 'Transactional - ' + CAST(publication_type AS VARCHAR)
                 WHEN publication_type = '1' THEN 'Snapshot - ' + CAST(publication_type AS VARCHAR)
                 WHEN publication_type = '2' THEN 'Merge - ' + CAST(publication_type AS VARCHAR)ELSE '' END) AS [Publication Type]
          , (CASE WHEN warning = '1' THEN 'Expiration' + CAST(warning AS VARCHAR)
                 WHEN warning = '2' THEN 'Latency' + CAST(warning AS VARCHAR)
                 WHEN warning = '4' THEN 'Mergeexpiration' + CAST(warning AS VARCHAR)
                 WHEN warning = '16' THEN 'Mergeslowrunduration' + CAST(warning AS VARCHAR)
                 WHEN warning = '32' THEN 'Mergefastrunspeed' + CAST(warning AS VARCHAR)
                 WHEN warning = '64' THEN 'Mergeslowrunspeed' + CAST(warning AS VARCHAR)END)                 warning
          , worst_latency
          , best_latency
          , average_latency
          , last_distsync
          , retention
          , latencythreshold
          , expirationthreshold
          , agentnotrunningthreshold
          , subscriptioncount
          , runningdistagentcount
          , snapshot_agentname
          , logreader_agentname
          , qreader_agentname
          , worst_runspeedPerf
          , best_runspeedPerf
          , average_runspeedPerf
          , retention_period_unit
          , publisher
FROM        #tmp_replicationPub_monitordata
ORDER BY    publication;

-------------------------------------------------------------------------------------------------------------------------
--  SUBSCRIBER SCRIPT
-------------------------------------------------------------------------------------------------------------------------
IF OBJECT_ID ('tempdb..#tmp_rep_monitordata  ') IS NOT NULL DROP TABLE #tmp_rep_monitordata;

CREATE TABLE #tmp_rep_monitordata (
    status                        INT        NULL
  , warning                       INT        NULL
  , subscriber                    sysname    NULL
  , subscriber_db                 sysname    NULL
  , publisher_db                  sysname    NULL
  , publication                   sysname    NULL
  , publication_type              INT        NULL
  , subtype                       INT        NULL
  , latency                       INT        NULL
  , latencythreshold              INT        NULL
  , agentnotrunning               INT        NULL
  , agentnotrunningthreshold      INT        NULL
  , timetoexpiration              INT        NULL
  , expirationthreshold           INT        NULL
  , last_distsync                 DATETIME   NULL
  , distribution_agentname        sysname    NULL
  , mergeagentname                sysname    NULL
  , mergesubscriptionfriendlyname sysname    NULL
  , mergeagentlocation            sysname    NULL
  , mergeconnectiontype           INT        NULL
  , mergePerformance              INT        NULL
  , mergerunspeed                 FLOAT      NULL
  , mergerunduration              INT        NULL
  , monitorranking                INT        NULL
  , distributionagentjobid        BINARY(16) NULL
  , mergeagentjobid               BINARY(16) NULL
  , distributionagentid           INT        NULL
  , distributionagentprofileid    INT        NULL
  , mergeagentid                  INT        NULL
  , mergeagentprofileid           INT        NULL
  , logreaderagentname            sysname    NULL
  , publisher                     sysname    NULL
);

INSERT INTO #tmp_rep_monitordata
EXEC sp_replmonitorhelpsubscription @publication_type = 0;

INSERT INTO #tmp_rep_monitordata
EXEC sp_replmonitorhelpsubscription @publication_type = 1;

SELECT      (CASE WHEN status = '1' THEN 'Start - ' + CAST(status AS VARCHAR)
                 WHEN status = '2' THEN 'Succeed - ' + CAST(status AS VARCHAR)
                 WHEN status = '3' THEN 'InProgress - ' + CAST(status AS VARCHAR)
                 WHEN status = '4' THEN 'Idle - ' + CAST(status AS VARCHAR)
                 WHEN status = '5' THEN 'Retry - ' + CAST(status AS VARCHAR)
                 WHEN status = '6' THEN 'Fail - ' + CAST(status AS VARCHAR)ELSE CAST(status AS VARCHAR)END)  [Run Status]
          , publisher_db
          , publication
          , (CASE WHEN warning = '1' THEN 'Expiration' + CAST(warning AS VARCHAR)
                 WHEN warning = '2' THEN 'Latency' + CAST(warning AS VARCHAR)
                 WHEN warning = '4' THEN 'Mergeexpiration' + CAST(warning AS VARCHAR)
                 WHEN warning = '16' THEN 'Mergeslowrunduration' + CAST(warning AS VARCHAR)
                 WHEN warning = '32' THEN 'Mergefastrunspeed' + CAST(warning AS VARCHAR)
                 WHEN warning = '64' THEN 'Mergeslowrunspeed' + CAST(warning AS VARCHAR)END)                 warning
          , subscriber
          , subscriber_db
          , (CASE WHEN publication_type = '0' THEN 'Transactional - ' + CAST(publication_type AS VARCHAR)
                 WHEN publication_type = '1' THEN 'Snapshot - ' + CAST(publication_type AS VARCHAR)
                 WHEN publication_type = '2' THEN 'Merge - ' + CAST(publication_type AS VARCHAR)ELSE '' END) AS [Publication Type]
          , (CASE WHEN subtype = '0' THEN 'Push - ' + CAST(subtype AS VARCHAR)
                 WHEN subtype = '1' THEN 'Pull - ' + CAST(subtype AS VARCHAR)
                 WHEN subtype = '2' THEN 'Anonymous - ' + CAST(subtype AS VARCHAR)ELSE '' END)               AS SubscriptionType
          , latency
          , latencythreshold
          , agentnotrunning
          , agentnotrunningthreshold
          , last_distsync
          , timetoexpiration
          , expirationthreshold
          , distribution_agentname
          , monitorranking
          , distributionagentjobid
          , mergeagentjobid
          , distributionagentid
          , distributionagentprofileid
          , mergeagentid
          , mergeagentprofileid
          , logreaderagentname
          , publisher
FROM        #tmp_rep_monitordata
ORDER BY    publication ASC; 
```

# asp.net-mvc - 禁用 ASP.NET MVC 中的布局？

> ID：220342
> 
> 赞同：58
> 
> 时间：2008-10-20T23:48:37.953
> 
> 标签：asp.net-mvc

在 MonoRail 中，您只需 CancelLayout() 即可不呈现布局。在 ASP.NET MVC 中，影响布局的唯一方法似乎是将布局名称传递给 View() 方法，例如 View("myview", "mylayout"); 只是似乎传递 null 或空字符串并不能满足我的要求。

我最终创建了一个只呈现内容的空布局，但这似乎很愚蠢。

“不渲染布局”就是这个意思。在 Web 表单视图引擎中，他们将布局称为“母版页”。我只想呈现我*的*操作视图，而不是用母版页包围它。

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2011-01-18T23:01:05.803

在 MVC 3 中，您可以使用以下命令删除主布局代码：

```
 @{
    Layout = "";    
    } 
```

* * *

## 回答 #2

> 赞同：69
> 
> 时间：2012-04-13T07:48:32.010

在视图的开头添加以下内容：

```
@{
    Layout = null;
} 
```

如果您希望保留样式表，则需要在该视图中添加对它的引用。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2016-01-26T00:07:56.423

要对所有页面禁用此功能，请编辑 _ViewStart.cshtml（在根目录中的“Views”文件夹下），并确保它包含以下内容：

```
@{
  Layout = null;
} 
```

要为任何特定视图启用模板，可以将以下内容添加到该视图的 .cshtml 文件中，以*启用*模板：

```
@{
  Layout = "~/Views/Shared/_Layout.cshtml";
} 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2014-11-07T06:57:47.523

在 Controller 动作中，我们可以设置所需的布局。

```
return View("Index", "_LAYOUT_NAME", model); 
```

[https://stackoverflow.com/a/5161384/2039603](https://stackoverflow.com/a/5161384/2039603)

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2018-02-16T19:36:45.010

我在正确的答案中看到它说“在 ASP.NET MVC 版本中这似乎是不可能的”

您使用的是哪个版本？因为我找到了解决您问题的方法（我遇到了同样的问题）

因此，要禁用页面中的布局，您应该使用：

```
@{
   Layout = null;
} 
```

而且，正如[这里](http://www.dotnet-stuff.com/tutorials/aspnet-mvc/how-to-render-different-layout-in-asp-net-mvc)所建议的，这可以解决您的问题：

```
public ActionResult Index()
{
  SampleModel model = new SampleModel();
  //Any Logic
  return View("Index", "_WebmasterLayout", model);
} 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2010-04-22T07:13:59.590

不要使用普通视图，而是创建局部视图。然后可以单独使用它们，其行为非常类似于 CancelLayout() - 或者您可以将它们合并到引用母版页的视图中，在这种情况下它将是完整的布局。如果您想发回部分 HTML 块以响应 AJAX 请求，它们也很有用。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2016-09-03T23:52:22.383

尝试将`masterPage`参数设置为`""`or`null`并返回 a `View`（就像我没有）一样没有运气？

然后试试这个并`PartialView`改用：

```
 public ActionResult Article(string id)
    {
        return PartialView("~/Areas/Store/Views/CustomerService/" + id);
    } 
```

我需要这样做以从 JS 异步加载视图的内容。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-08-11T02:35:51.027

在我询问的 ASP.NET MVC 版本中，这似乎是不可能的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-21T01:27:08.240

您可以创建一个几乎可以执行任何操作的自定义 ActionResult。ActionResult 控制作为响应发送回客户端的内容。创建一个扩展 ActionResult 但什么都不做的类将是微不足道的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-11-13T12:03:46.330

一种替代方法是实际指定一个布局，但使该布局为空“_EmptyLayout.cshtml”，其中不包含任何内容，或者只是一条说明它不包含任何内容的注释，以便稍后有人按预期看到它。

# php - 组织 PHP 类层次结构的最佳方法

> ID：220347
> 
> 赞同：3
> 
> 时间：2008-10-20T23:51:14.063
> 
> 标签：php, frameworks, class-structure, class-hierarchy

我的大多数项目都使用了一个有点原始的框架，但是我想到了一个通用的设计问题，我还没有解决。对于给定的应用程序，我应该将特定于应用程序的类结构与框架的结构分开，还是在框架之上构建不是一件坏事？

例如，假设我有一个带有基本 Controller 类的框架，并为我的应用程序的给定部分扩展了它。哪种安排最有意义，为什么？

**类结构 A：**

*   调试时直观、易于查找源文件。
*   文件命名/目录结构反映了类层次结构。

```
- Framework_Control“框架\Control.php”
   - Framework_Control_Index "Framework\Control\Index.php"
   - Framework_Control_Home "Framework\Control\Home.php"
   - Framework_Control_Contact "Framework\Control\Contact.php"
   - Framework_Control_About "Framework\Control\About.php"

```

**类结构 B：**

*   保持框架模块化，易于更换/更新。
*   给目录结构增加了一些复杂性，目录/文件命名不再遵循类层次结构。

```
- Framework_Control“框架\Control.php”
   - Application_Control_Index "Application\Control\Index.php"
   - Application_Control_Home "应用\控制\Home.php"
   - Application_Control_Contact "Application\Control\Contact.php"
   - Application_Control_About "Application\Control\About.php"

```

总的来说，我知道这将取决于个人喜好，但我想确保在决定走哪条路之前权衡所有利弊。它实际上归结为类命名和目录结构，因为在任何一种情况下，实际的层次结构都将保持不变。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T01:51:07.473

我建议您在两个不同的类别中查看您的源代码，外部依赖项或跨多个站点使用的代码，而不是任何单个站点的本地代码和本地依赖项或您正在处理的特定站点的本地代码.

听起来 Framework/Control.php 是更大的外部依赖项的一部分，应该这样管理，而 Application/Control 文件都是特定网站的本地文件。

在我们的代码结构中使用这种差异化使得在多个站点之间重用我们的内部框架变得更加容易。

作为最后的想法，您可能会考虑查看现有的主要框架正在做什么，例如 Zend Framework、Symfony 等。尽管整个框架可能比您想要的更多，但框架的结构可以提供很多关于 PHP 开发人员正在使用的常见良好实践的见解。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-20T23:58:37.247

真正归结为当您在应用程序 XYZ 中更新 Framework\Control.php 时您将要做什么。您是否要返回应用程序 ABC 并进行相同的更改？如果这是一个严重的错误怎么办？

为了您所有项目的可维护性，我会选择您的第二个选项。

# c# - 使用用户绘制的控件显示表单时如何避免屏幕闪烁？

> ID：220360
> 
> 赞同：7
> 
> 时间：2008-10-20T23:59:03.363
> 
> 标签：c#, .net, winforms, user-controls, onpaint

这样[透明背景的问题](https://stackoverflow.com/questions/214215/user-drawn-controls-are-using-the-previous-forms-background)就解决了。现在，每次我展示表单（或必须重新绘制）时，我都会得到很多闪烁。在绘制事件完成之前有什么方法我不能更新屏幕，或者有什么其他方法可以在绘制所有对象时停止 1/2 秒的闪烁和闪烁？

**回答**： 双缓冲是要走的路。我已经在控件上进行了双重缓冲，但必须在表单上进行设置。我虽然双缓冲仅在您自己继承 OnPaint 时才有效。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-21T00:01:14.577

您是否尝试为表单设置[DoubleBuffered](https://stackoverflow.com/questions/220100/how-do-i-enable-double-buffering-of-a-control-using-c-window-forms)属性？

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-21T00:02:37.723

双缓冲可能会有所帮助，您可能想尝试的另一件事是：

挂起布局（）；

东西……

简历布局（）；

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T00:02:36.553

在窗体上设置 DoubleBuffered 属性。

# licensing - 保留委托工作的所有权的原因是什么？

> ID：220368
> 
> 赞同：4
> 
> 时间：2008-10-21T00:02:36.570
> 
> 标签：licensing

我一直包含将所有源代码、原始图像、原始资源等的完整作者、所有权和使用权转让给我的客户的条款。我为他们开发/创建。

当然，我保留我的库的作者、所有权和使用权，而且我通常不包含这些库的源代码。如果客户需要我的库的源代码，那么我会为这些请求额外费用，并为他们提供正确的使用许可，并包括允许使用所需的限制。

我真的认为没有必要为我自己或我的公司保留权利。客户的工作只为他们服务。我从不重用代码（即使我必须再次编写一些流程，我也不认为它是代码重用）。

为什么许多公司/程序员保留委托作品的作者和所有权？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-21T00:10:19.160

如果一位客户委托它，其他人很可能也会发现它很有价值。通常，开发人员会保留所有权，以便他们可以利用以后的机会。或者，他们可能会收取更多费用以换取放弃作品的权利。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T00:10:01.080

我想这是为了保护他们不被起诉，如果他们确实重用代码（有意或无意）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T00:35:49.810

这可能有很多原因。最常见的一种是杠杆。如果您开发的应用程序的一部分具有广泛的适用性，您可能能够将解决方案的大部分重新定位到其他客户。这将实现以下两件事之一：更短的上市时间，这意味着客户的成本最低，或者在固定投标项目中，为您带来更大的利润。

另一种情况可能是保护自己。你的例子本身就是一个案例研究。您为客户提供您为他们所做的工作的全部权利和来源，但您保留对您的图书馆的权利，他们支付额外费用等......

根据合同的实际措辞方式，如果您使用“您的”库作为最终交付物的一部分，那不是您实际为它们创建的工作。如果您不包含这些库，它们是否仍然具有完整的产品。如果不是，那么您的图书馆不是您为他们所做的工作的一部分吗？他们为什么要为此支付额外费用？律师喜欢这种论点。当然，如果您有友好和满意的客户，那么这不太可能成为问题，但有时事情并不顺利。

如果您的合同说“客户有权使用代码，可以做他们想做的事，但您保留对代码做任何事情的权利”，那么就不存在灰色地带。与一切合法的事情一样，请聘请一位优秀的律师。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-21T00:41:37.893

较早的答案是正确的，并且都是正确的。有两个基本原因：

*   首先，当您在特定领域积累经验时，您可以在多个客户中积累知识，并且对未来的客户更有价值，前提是您能够重用您最初开发的内容。

*   其次，知识产权的起点和终点并不总是 100% 清楚。如果您从上一个项目中获取一些巧妙的代码片段用于下一个项目，您是否重复使用“过多”以侵犯您授予第一个客户的权利？对客户回来并声称侵权的最佳防御不是首先让他们有能力这样做。

还有一点。为什么您的客户无论如何都需要拥有代码的合法所有权？他们可以通过获得许可证来获得使用您的代码所需的所有合法权利。除此之外，拥有所有权对他们使用代码的能力没有任何帮助，并且会阻止您重新使用它。（当然，与此相反的是，他们可能希望阻止您将“他们的”概念提供给竞争对手（如果他们的），但还有其他方法可以解决这个问题。）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-21T00:10:02.607

以防他们写下一个谷歌。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-21T02:14:30.517

目前还没有任何机构提到这一点，但我一直认为公司这样做是为了让以后很难雇佣其他人来改进程序。如果没有提供源代码，这显然尤其如此。

增强功能通常可以在以后根据实施更改所需的实际时间收取额外费用。我已经看到诸如添加额外数据网格过滤成本数千的请求。

# java - 我必须关闭（）每个 EntityManager 吗？

> ID：220374
> 
> 赞同：76
> 
> 时间：2008-10-21T00:08:20.427
> 
> 标签：java, jpa, persistence, toplink

我刚刚开始将我自己开发的持久性框架迁移到 JPA。

鉴于持久性框架隐藏了很多管道，我很想知道不关闭 EntityManagers 是否会造成资源泄漏，或者框架是否会为我收集并关闭它们。

我打算在所有地方关闭它们，但我必须这样做吗？

目前使用 TopLink，只是因为它很容易与 NetBeans 一起工作，但很高兴研究其他 JPA 提供程序。

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2008-10-21T08:23:10.273

这取决于你如何获得它。

如果您使用 EntityManagerFactory 创建它，则无论您使用什么框架，都必须关闭它。

如果您使用依赖注入（例如使用 EJB 和 @PersistenceContext 注释）获得它，则不应手动关闭它（AFAIK 它将导致 RuntimeException）。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-21T01:31:58.090

你应该。

框架不知道您打算如何使用 EM，因此它们无法关闭它（除非，可能是在最终确定时，这不能保证）。是的，不关闭它们会造成资源泄漏。

这个想法与“始终关闭 java.sql.Connection”（尽管某些数据源具有通过不活动自动关闭它们的设置）或“始终关闭 Hibernate 会话”相同。

此外，如果您打算编写可移植代码，则不应依赖特定的 JPA 提供者“聪明”——其他可能无法及时关闭 EM。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-09-18T09:42:00.297

我在我的存储库中获得了`EntityManager`使用`@PersistenceContext`注释。我可以看到，在连接池到达它之后，`maxPoolSize`它并没有被清理。

但是，如果我创建`EntityManager`using`EntityManagerFactory`并调用，`entitymanager.close()`则连接将被清理。我正在`c3p0`用作连接池库。

# .net - Windows 服务如何以编程方式重新启动自身？

> ID：220382
> 
> 赞同：142
> 
> 时间：2008-10-21T00:12:40.357
> 
> 标签：.net, windows, windows-services, windows-server-2003

我需要在 .NET 中编写健壮的代码以使 Windows 服务（服务器 2003）能够自行重新启动。最好的方法是什么？是否有一些 .NET API 可以做到这一点？

* * *

## 回答 #1

> 赞同：200
> 
> 时间：2008-10-21T00:58:35.740

Set the service to restart after failure (double click the service in the control panel and have a look around on those tabs - I forget the name of it). Then, anytime you want the service to restart, just call `Environment.Exit(1)` (or any non-zero return) and the OS will restart it for you.

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2011-05-31T05:26:55.400

```
Dim proc As New Process()
Dim psi As New ProcessStartInfo()

psi.CreateNoWindow = True
psi.FileName = "cmd.exe"
psi.Arguments = "/C net stop YOURSERVICENAMEHERE && net start YOURSERVICENAMEHERE"
psi.LoadUserProfile = False
psi.UseShellExecute = False
psi.WindowStyle = ProcessWindowStyle.Hidden
proc.StartInfo = psi
proc.Start() 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-10-21T00:19:27.300

您甚至无法确定运行您的服务的用户帐户是否有权停止和重新启动服务。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2013-04-12T14:10:25.403

```
const string strCmdText = "/C net stop \"SERVICENAME\"&net start \"SERVICENAME\"";
Process.Start("CMD.exe", strCmdText); 
```

where `SERVICENAME` is the name of your service (double quotes included to account for spaces in the service name, can be omitted otherwise).

Clean, no auto-restart configuration necessary.

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2009-02-11T21:13:04.030

You can create a subprocess using Windows `cmd.exe` that restarts yourself:

```
 Process process = new Process();
 process.StartInfo.FileName = "cmd";
 process.StartInfo.Arguments = "/c net stop \"servicename\" & net start \"servicename\"";
 process.Start(); 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-21T01:02:17.510

It would depend on why you want it to restart itself.

If you are just looking for a way to have the service clean itself out periodically then you could have a timer running in the service that periodically causes a purge routine.

If you are looking for a way to restart on failure - the service host itself can provide that ability when it is setup.

So why do you need to restart the server? What are you trying to achieve?

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-21T00:18:03.777

我不认为你可以在一个独立的服务中（当你调用 Restart 时，它会停止服务，这会中断 Restart 命令，并且永远不会再次启动）。如果您可以添加第二个 .exe（使用 ServiceManager 类的控制台应用程序），那么您可以启动独立 .exe 并让它重新启动服务然后退出。

再想一想，您可能会让服务注册一个计划任务（例如，使用命令行“at”命令）来启动服务，然后让它自行停止；那可能会奏效。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2016-04-27T15:23:53.897

The problem with shelling out to a batch file or EXE is that a service may or may not have the permissions required to run the external app.

The cleanest way to do this that I have found is to use the OnStop() method, which is the entry point for the Service Control Manager. Then all your cleanup code will run, and you won't have any hanging sockets or other processes, assuming your stop code is doing its job.

To do this you need to set a flag before you terminate that tells the OnStop method to exit with an error code; then the SCM knows that the service needs to be restarted. Without this flag you won't be able to stop the service manually from the SCM. This also assumes you have set up the service to restart on an error.

Here's my stop code:

```
...

bool ABORT;

protected override void OnStop()
{
    Logger.log("Stopping service");
    WorkThreadRun = false;
    WorkThread.Join();
    Logger.stop();
    // if there was a problem, set an exit error code
    // so the service manager will restart this
    if(ABORT)Environment.Exit(1);
} 
```

If the service runs into a problem and needs to restart, I launch a thread that stops the service from the SCM. This allows the service to clean up after itself:

```
...

if(NeedToRestart)
{
    ABORT = true;
    new Thread(RestartThread).Start();
}

void RestartThread()
{
    ServiceController sc = new ServiceController(ServiceName);
    try
    {
        sc.Stop();
    }
    catch (Exception) { }
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-03T17:23:41.250

I would use the Windows Scheduler to schedule a restart of your service. The problem is that you can't restart yourself, but you can stop yourself. (You've essentially sawed off the branch that you're sitting on... if you get my analogy) You need a separate process to do it for you. The Windows Scheduler is an appropriate one. Schedule a one-time task to restart your service (even from within the service itself) to execute immediately.

Otherwise, you'll have to create a "shepherding" process that does it for you.

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2010-11-12T03:48:19.870

The first response to the question is the simplest solution: "Environment.Exit(1)" I am using this on Windows Server 2008 R2 and it works perfectly. The service stops itself, the O/S waits 1 minute, then restarts it.

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-21T00:18:07.567

我不认为它可以。当服务“停止”时，它会完全卸载。

好吧，好吧，我想总有办法。例如，您可以创建一个分离的进程来停止服务，然后重新启动它，然后退出。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-08-09T09:30:28.710

Just passing: and thought i would add some extra info...

you can also throw an exception, this will auto close the windows service, and the auto re-start options just kick in. the only issue with this is that if you have a dev enviroment on your pc then the JIT tries to kick in, and you will get a prompt saying debug Y/N. say no and then it will close, and then re-start properly. (on a PC with no JIT it just all works). the reason im trolling, is this JIT is new to Win 7 (it used to work fine with XP etc) and im trying to find a way of disabling the JIT.... i may try the Environment.Exit method mentioned here see how that works too.

Kristian : Bristol, UK

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-08-14T09:02:24.663

Create a restart.bat file like this

```
@echo on
set once="C:\Program Files\MyService\once.bat"
set taskname=Restart_MyService
set service=MyService
echo rem %time% >%once%
echo net stop %service% >>%once%
echo net start %service% >>%once%
echo del %once% >>%once%

schtasks /create /ru "System" /tn %taskname% /tr '%once%' /sc onstart /F /V1 /Z
schtasks /run /tn %taskname% 
```

Then delete the task %taskname% when your %service% starts

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-07-13T09:54:19.733

Create a separate appdomain to host the application code. When requires restart, we could unload and reload the appdomain instead the process (windows service). This is how IIS app pool works, they dont run asp.net app directly, they use separate appdmain.

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2008-10-21T00:40:29.537

更好的方法可能是使用 NT 服务作为应用程序的包装器。当 NT 服务启动时，您的应用程序可以以“空闲”模式启动，等待命令启动（或配置为自动启动）。

想象一辆车，当它启动时，它开始处于空闲状态，等待您的命令前进或后退。这也带来了其他好处，例如更好的远程管理，因为您可以选择如何公开您的应用程序。

* * *

## 回答 #16

> 赞同：-2
> 
> 时间：2009-06-11T04:52:33.013

The easiest way is to have a batch file with:

net stop net start

and add the file to the scheduler with your desired time interval

* * *

## 回答 #17

> 赞同：-3
> 
> 时间：2010-10-12T15:39:39.007

```
private static void  RestartService(string serviceName)
    {
        using (var controller = new ServiceController(serviceName))
        {
            controller.Stop();
            int counter = 0;
            while (controller.Status != ServiceControllerStatus.Stopped)
            {
                Thread.Sleep(100);
                controller.Refresh();
                counter++;
                if (counter > 1000)
                {
                    throw new System.TimeoutException(string.Format("Could not stop service: {0}", Constants.Series6Service.WindowsServiceName));
                }
            }

            controller.Start();
        }
    } 
```

# annotations - Compass Search Annotations 导致编译器错误

> ID：220385
> 
> 赞同：2
> 
> 时间：2008-10-21T00:15:05.843
> 
> 标签：annotations, full-text-search, compass-lucene

我试图在我的 Java 程序中使用 Compass 搜索引擎中的 @Searchable 注释，但我收到一个编译时错误：“类型不匹配：无法将 Searchable 转换为注释”。

我已经包含了我能想到的所有 jar 文件，并在网上搜索了工作示例，但无济于事。

有人有指南针注释的工作示例吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-11-12T12:46:06.033

> “类型不匹配：无法将 Searchable 转换为 Annotation”

此错误是由来自**compass14-xxxjar**的 Searchable 类引起的。在您的 Compass 库中，将**compass14-xxxjar**放在底部，如果不需要，请将其删除。正确的 Searchable 类位于**compass-xxxjar**中。

# vb.net - 在 VB.NET 中加入数组

> ID：220387
> 
> 赞同：6
> 
> 时间：2008-10-21T00:15:41.147
> 
> 标签：vb.net, arrays, .net-3.5

在 Visual Basic 中加入一个或多个数组（或 ArrayList）的最简单方法是什么？

我正在使用 .NET 3.5，如果这很重要的话。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-21T01:24:17.917

这是在 C# 中，但您肯定可以弄清楚...

```
int[] a = new int[] { 1, 2, 3, 4, 5 };
int[] b = new int[] { 6, 7, 8, 9, 10 };
int[] c = a.Union(b).ToArray(); 
```

如果您使用给定的 IEnumerable 而不是在联合之后调用“ToArray”，则效率会更高。

```
int[] a = new int[] { 1, 2, 3, 4, 5 };
int[] b = new int[] { 6, 7, 8, 9, 10 };
IEnumerable<int> c = a.Union(b); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-21T00:19:24.397

您可以查看标题为*[Merging two arrays in .NET](https://stackoverflow.com/questions/59217/merging-two-arrays-in-net)*的主题。

# java - Java 并发和并行 GC

> ID：220388
> 
> 赞同：36
> 
> 时间：2008-10-21T00:15:55.077
> 
> 标签：java, garbage-collection, concurrency

本文[建议](http://www.petefreitag.com/articles/gctuning/)使用`-XX:+UseParNewGC`“To enable a parallel young generation GC with the concurrent GC”。

我的困惑是，为了同时启用并行和并发 GC，我应该

*   使用`-XX:+UseParNewGC`或
*   同时使用`-XX:+UseParNewGC` *和* `-XX:+UseConcMarkSweepGC`?

### 附言

我正在使用 JVM 6。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-10-21T00:32:21.890

由于您链接的文档是针对 1.4.2 VM 的，因此我假设您正在使用它（JVM 5 和 6 的行为不同）。

来自[http://java.sun.com/docs/hotspot/gc1.4.2/](https://web.archive.org/web/20120624153924/http://java.sun.com/docs/hotspot/gc1.4.2/)

> 如果在命令行上使用 -XX:+UseConcMarkSweepGC 则标志 UseParNewGC 也设置为 true，如果它没有在命令行上显式设置

所以答案是你只需要使用 -XX:+UseConcMarkSweepGC 就可以启用并发收集器和并行年轻代收集器。

编辑：对于 Java 6，相同的标志 (-XX:+UseConcMarkSweepGC) 启用并发收集器。你想要的收集器的选择取决于几件事，你应该测试不同的配置。但是有一些非常一般的指导方针。如果您有单处理器、单线程机器，那么您应该使用串行收集器（某些配置的默认设置，可以使用 -XX:+UseSerialGC 显式启用）。对于您的工作负载基本上受 CPU 限制的多处理器机器，请使用并行收集器。如果您使用 -server 标志，默认情况下会启用它，或者您可以使用 -XX:+UseParallelGC 显式启用它。如果您宁愿以减少 GC 总 CPU 时间为代价来缩短 GC 暂停时间，并且您拥有多个 CPU，则可以使用并发收集器 (-XX:+UseConcMarkSweepGC)。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-21T00:37:07.967

This blog entry has a nice breakdown of the different collectors, and which options are valid: [http://blogs.oracle.com/jonthecollector/entry/our_collectors](http://blogs.oracle.com/jonthecollector/entry/our_collectors)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-21T02:14:44.073

java/JDK 6 GC tuning : [http://www.oracle.com/technetwork/java/javase/gc-tuning-6-140523.html](http://www.oracle.com/technetwork/java/javase/gc-tuning-6-140523.html). This is from SUN (now Oracle). The full stuff.

Also, see
[http://kirk.blog-city.com/is_your_concurrent_collector_failing_you.htm](http://kirk.blog-city.com/is_your_concurrent_collector_failing_you.htm)
[http://www.javaperformancetuning.com/](http://www.javaperformancetuning.com/)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-09-14T06:58:55.953

Java GC tuning is basically a dark art, but in my application (runs with a 50+GB heap, and 16 physical cores) the ConcMarkSweep collector resulted in a 3x speedup over the -server default, and a 2.2x speedup over ParallelOldGC.

If you aren't sharing the machine with other processes (so idle cores are just wasted) use the ConcMarkSweepGC.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-02-05T09:26:45.263

ParNew is the default young generation collector when CMS is used.You just have to specify -XX:+UseConcMarkSweepGC to use CMS and ParNew will be used by default. CMS is a good collector if avoiding GC jitters is of higher priority but if throughput is more important for eg for a batch like job the default SUN parallel collector does a better job.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-09-14T09:50:00.913

You cannot enable two GC options at the same time. I would suggest you to use CMS which is better than and next generation GC compare to UseParNewGC. and if you use Java 1.7 or later and heap size is relatively bigger (like > 4GB) consider using G1.

# c# - 无法绑定到 DataSource 上的属性或列名称。参数名称：dataMember

> ID：220392
> 
> 赞同：8
> 
> 时间：2008-10-21T00:18:27.100
> 
> 标签：c#, asp.net, data-binding

这是我在尝试绑定到 System.Type.Name 时遇到的异常。

这是我正在做的事情：

```
this.propertyTypeBindingSource.DataSource = typeof(System.Type);

/* snip */

this.nameTextBox1.DataBindings.Add(
    new System.Windows.Forms.Binding(
        "Text", 
        this.propertyTypeBindingSource, 
        "Name", true)); 
```

绑定到 System.Type 是否有一些技巧，是不允许的还是有任何解决方法？绑定到其他类型没有问题。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-21T05:55:32.597

确实，对 Type 有特殊处理……这种方法用于 IDE 等中以提前配置元数据。如果您查看 IDE 生成的绑定，它们会执行以下操作：

```
bindingSource1.DataSource = typeof(MyObject); 
```

saying "when we get real data, we expect MyObject isntance(s)"; i.e. when you ask for "Name", it is looking for the name property *on MyObject* - not the Name of the Type instance. This allows grids etc to obtain their metadata without having to wait for the real data; but as a consequence you can't bind to Type "for real".

The System.ComponentModel code is identical between simple bindings and list bindings (give or take a currency manager), so simple bindings also inherit this behaviour. Equally, you can't bind to properties of a class that implements IList/IListSource, since this is interpreted in a special way.

Your extra class seems a reasonable approach.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-21T00:42:55.147

找到了解决方法。做了一堂课

```
public class StubPropertyType
{
    public StubPropertyType(Type type)
    {
        this.StubPropertyTypeName = type.Name;
    }

    public string StubPropertyTypeName = string.Empty;
} 
```

创建了绑定源

```
this.propertyStubBindingSource.DataSource = typeof(StubPropertyType); 
```

创建了一个类的实例并将文本框绑定到它。

```
this.nameTextBox.DataBindings.Add(
    new System.Windows.Forms.Binding(
        "Text", 
        this.propertyStubBindingSource, 
        "StubPropertyTypeName", 
        true)); 
```

完全按照要求工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-01-12T04:33:43.170

One of the possible reason for this error is table/ Dataset do not have specified column. Specially, in case of Typed DataSet make sure you have proper names in XSD matching with column names from table

# asp.net-mvc - 如何使用 ASP.NET MVC 实现“注销”链接？

> ID：220393
> 
> 赞同：1
> 
> 时间：2008-10-21T00:18:27.473
> 
> 标签：asp.net-mvc, forms-authentication

这似乎是一个非常愚蠢的问题，但我试图找出最好的方法来做到这一点。您是否只需重定向到 /Logout 页面并让控制器调用 FormsAuthentication.SignOut 函数？

这是我的第一个想法，但后来我想知道它是否会被第三方网站滥用。假设某人刚刚决定发布指向您的 /Logout 页面的链接。用户将退出您的应用程序。有什么好的方法可以防止吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T00:59:49.043

这种恶意链接将是被称为跨站请求伪造、CSRF 的一类安全漏洞的一个示例。注销链接相对无害，但远程站点可以设置许多隐藏表单并将它们发布到您的站点以通过 POST 执行任何可能的操作。

最常见的对策是在每个表单中包含一个挑战、一个随机隐藏值，然后检查该值。检查referer 标头可能有效，但请注意，某些浏览器根本不发送referer。

阅读更多：[http ://en.wikipedia.org/wiki/Cross-site_request_forgery](http://en.wikipedia.org/wiki/Cross-site_request_forgery)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-21T00:36:45.610

如果您担心用户通过使用恶意链接意外退出您的应用程序，您可以检查推荐人以确保注销来自您的站点（或者在用户简单键入的情况下为 NULL中的网址）。

我实际上并不担心这一点，因为注销某人很烦人，但不一定有安全风险。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-21T00:24:27.757

这就是我使用的。

```
public ActionResult Logout()
{
    FormsAuthentication.SignOut();
    return RedirectToAction("Index", "Home");
} 
```

似乎工作正常。

第三方网站只会自行注销。因此，他们不会获得与实际单击注销不同的任何结果。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-21T01:01:48.540

新的 ASP.net MVC Beta 包含一个 AccountController，可能值得一看，因为它基本上实现了从注册到登录/注销到忘记密码功能的所有内容。不确定它有多好，但肯定是一个很好的起点。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-05-13T07:11:43.957

这是一个老问题，但这里有一个 MVC 的现代示例：

```
[Authorize]
public RedirectResult Logout()
{
    FormsAuthentication.SignOut();

    return this.Redirect("/");
} 
```

您可以通过将属性应用于该操作来确保该`Logout`操作只能由登录的人调用。`Authorize`

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-21T03:20:26.997

派生自 ActionResult

```
public class LogoutResult : ActionResult
{
    private readonly IAuthenticationService _authenticationService;
    private readonly IWebContext _context;

    public LogoutResult(IAuthenticationService authenticationService, IWebContext context)
    {
        _authenticationService = authenticationService;
        _context = context;
    }

    public override void ExecuteResult(ControllerContext context)
    {
        _authenticationService.Logout();
        _context.Abandon();
        _context.Redirect("~/");
    }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-21T00:20:43.180

您应该寻找 cookie 或将客户端标识为真正用户的东西。

# sql-server - SQL Server 中数据库数量的实际限制？

> ID：220400
> 
> 赞同：16
> 
> 时间：2008-10-21T00:21:49.713
> 
> 标签：sql-server, database-design, architecture

在其中一个 stackoverflow 播客（我认为是#18）中，Jeff 和 Joel 正在讨论多租户数据库与单租户数据库。Joel 提到“FogBugz on Demand”为每个客户架构使用一个数据库，我想知道是否有一个点超出了您需要多个数据库服务器来分配负载？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-21T00:26:12.527

从技术上讲，SQL Server 中每个实例的数据库限制为 32,767，但我怀疑您是否可以使用具有 2,000 多个数据库的 SQL Server 实例，此时服务器可能没有响应。

如果数据库全部自动关闭且未被使用，您可能拥有近 30,000 个数据库。您可以在此处找到有关容量限制的更多信息：

[SQL Server 的最大容量规格](http://msdn.microsoft.com/en-us/library/ms143432.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-21T11:19:36.127

Joel 在另一个地方谈到了这个问题（对不起，没有参考资料），并说在切换到 MS SQL 2005 之前，管理控制台（和后端）在连接超过 1000 或 2000 个数据库时遇到了问题。似乎 2005 年和可能 2008 年再次改善了这些数字。

至于所有性能问题始终取决于您的实际硬件和工作负载，只能通过本地基准测试/系统监控来肯定地回答。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T00:39:28.040

我认为这主要取决于机器的内存限制。SQL Server 喜欢在内存中保留尽可能多的缓存，并且当您添加数据库时，您会减少可用内存量。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-21T11:00:53.060

此外，您可能需要考虑到 SQL Server 的连接数。在 500-1000 之后，它变得非常堵塞和缓慢。所以这也是一个限制。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-21T01:05:10.703

我认为这更多是数据库负载的问题。如上所述，如果没有负载，则为 32,767。在高负载下，它会下降，最终降至 1 或小于 1。

# wcf - 您如何配置 WCF 以支持使用 net.pipe 的主机和客户端在同一进程中的 FaultContract？

> ID：220401
> 
> 赞同：4
> 
> 时间：2008-10-21T00:22:14.300
> 
> 标签：wcf, unit-testing, metadata, wcf-binding, named-pipes

我正在尝试使用 net.pipe 绑定为我的服务与客户端交互创建一个进程内单元测试。与良好的 WCF 服务一样，它在服务操作上使用 FaultContractAttribute 将可能的错误*（包装异常）*暴露给元数据。我想通过 XML *(App.config) 配置客户端和服务端点。* 但是，每当抛出错误时，它只是一个 CommunicationException“管道已关闭”，而不是我所期望的类型错误。

```
System.ServiceModel.CommunicationException: There was an error reading from the pipe: The pipe has been ended. (109, 0x6d). 
```

我尝试为 net.pipe 添加 IMetadataExchange 端点，但这不起作用。我也试过了。在 Vista 上需要我为 http 端点 netsh 的 ACL。那也没有用。

自定义异常类：

```
public class ValidationException : ApplicationException { } 
```

这是配置的最新尝试，但它抽出*“在服务实施的合同列表中找不到合同名称'IMetadataExchange'”*

任何有关如何完成此操作的示例或建议的链接将不胜感激。

```
<system.serviceModel>

  <client>
    <endpoint name="Client"
              contract="IService"
              address="net.pipe://localhost/ServiceTest/"
              binding="netNamedPipeBinding"
              bindingConfiguration="netPipeBindingConfig" />
  </client>

  <services>
    <service
      name="Service"
      behaviorConfiguration="ServiceFaults">
      <host>
        <baseAddresses>
          <add baseAddress="net.pipe://localhost/ServiceTest/"/>
          <add baseAddress="http://localhost/ServiceTest/"/>
        </baseAddresses>
      </host>
      <endpoint
        address=""
        binding="netNamedPipeBinding"
        bindingConfiguration="netPipeBindingConfig"

        name="ServicePipe"
        contract="IService" />
      <endpoint
        address="MEX"
        binding="mexNamedPipeBinding"
        bindingConfiguration="mexNetPipeBindingConfig"
        name="MexUserServicePipe"
        contract="IMetadataExchange" />
    </service>
  </services>

  <bindings>
    <netNamedPipeBinding>
      <binding name="netPipeBindingConfig"
               closeTimeout="00:30:00"
               sendTimeout="00:30:00" />
    </netNamedPipeBinding>
    <mexNamedPipeBinding>
      <binding name="mexNetPipeBindingConfig"></binding>
    </mexNamedPipeBinding>
  </bindings>

  <behaviors>
    <serviceBehaviors>
      <behavior name="ServiceFaults">
        <serviceDebug includeExceptionDetailInFaults="true"/>
      </behavior>
      <behavior name="MEX">
        <serviceMetadata 
          httpGetEnabled="true"
          httpGetUrl="http://localhost/ServiceTest/MEX"/>
      </behavior>
    </serviceBehaviors>
  </behaviors>

</system.serviceModel> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T14:14:28.107

如果您上面描述的 ValidationException 类是您用于故障的类，那么它可能是您的问题的根源。您应该从 FaultException 派生错误异常，因为它是可序列化的。ApplicationException 不是。

Wagner 是对的，您需要使用 FaultContract 属性来装饰您的操作定义，并为其提供您的合同类型。您还应该使用 DataContract 和 DataMember 属性来装饰您的 FaultContract。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T01:13:17.457

几天前我遇到了同样的错误。
我解决了创建自己的类（MyFault）并从服务器抛出 FaultException 并在客户端捕获它们。MyFault 有一个字符串成员，它是我希望客户端看到的异常消息。

我希望我说清楚了...我会尝试寻找一个不错的示例，然后将其发布在这里

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T02:04:37.883

问题很可能是反序列化或序列化请求或响应的错误。启用跟踪并使用 svctraceviewer 查看日志以了解确切的错误。

此外，请确保您的故障异常标有 [DataContract] 并且不继承和非 [DataContract] 类。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-20T20:44:45.080

最后一件事要补充。您的运营合同是否定义了他们正在使用的 ServiceFault？

我的理解是，您必须在操作层定义您正在使用的 ServiceFault，并且您的业务逻辑会抛出一个 FaulException，其中 T 是您定义的 ServiceFault。

# c# - SQL中如何处理时间存储

> ID：220405
> 
> 赞同：13
> 
> 时间：2008-10-21T00:28:01.947
> 
> 标签：c#, sql, time

我有一个正在编写的 Web 应用程序（C#、MSSQL），当记录存储在系统中时，我需要存储时间戳。通常，我会使用 SQL 和 DATETIME 函数来执行此操作。但是，服务器位于与我们公司所在的时区不同的时区......并且我们可能会更改为完全不同时区的另一台服务器。托管公司不会更改服务器时间以匹配我们当地的时区。（并不是我责怪他们，但这是我尝试过的一件事。）

所以，我的问题是，存储记录更新的日期/时间的最佳方式是什么，以及在我们当地的时区将该日期/时间呈现给用户的最佳方式是什么？

我想要最不混乱的方式，所以只要解决方案易于实施，C# 和 SQL 的组合就可以了。（我的常规风格是在存储过程中做更多的工作，而在 C# 中做更少的工作，如果这很重要的话。）

你能给我看一些示例代码吗？谢谢！

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-21T03:42:43.707

***始终以协调世界时（UTC 又名 GMT）存储 DATETIME 数据***

*   这避免了所有时区问题
*   这避免了夏令时问题
*   这允许简单的日期数学始终有效
*   这允许不同时区的交易保持同步
*   this allows you to move the data to a different server in a different time zone and not screw everything up
*   etc. "Universal" time, make sense?

C# DateTime provides DateTime.UtcNow and ToLocalTime(), SQL provides GETUTCDATE(). Here's a SQL function to convert UTC to local time -

```
-- convert UTC to local time
create FUNCTION [dbo].[udfUtcToLocalTime]
(
    @gmt datetime
)
RETURNS datetime
AS
BEGIN
    DECLARE @dt datetime
    SELECT 
        @dt = dateadd(millisecond,datediff(millisecond,getutcdate(), getdate()),@gmt)
    RETURN @dt
END 
```

example:

```
SELECT dbo.udfUtcToLocalTime(someDateTimeField)
FROM someTable 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-21T00:31:16.310

将 UTC 时间保存在您的数据库中，并在每次您想向用户展示它们时本地化这些时间

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-21T00:38:11.427

将其存储为 UTC 时间，然后在 C# 中在客户端执行时区计算，使用 DateTime 对象上的 .ToUniversalTime() 获取 UTC 时间，将其存储在服务器上，然后使用 .ToLocalTime() 将其转换回来。

# php - Web 应用程序中多个用户的访问控制

> ID：220419
> 
> 赞同：4
> 
> 时间：2008-10-21T00:38:59.053
> 
> 标签：php, mysql, database

我正在开发一个 PHP + MySQL 社交网络应用程序，现在我需要为每个全局（所有项目）和/或自身项目（自己创建的项目）设置不同的访问控制（读取、创建、编辑、删除）模块到组或特定用户。

有没有人有这样做的建议（表结构等）？

* * *

好的，我在这里提供更多细节，目前我有一个 tbl_module、tbl_user 和 tbl_user_role。每个用户和角色可以对特定模块具有不同的访问权限。

*   读
*   更新
*   创造
*   删除

并由全局访问或仅限自己（自己的帐户或自己创建的记录）划分。

和我目前的方法：我创建另一个表来保存访问详细信息：

*   acl_uid
*   mod_id (fk 模块 uid)
*   target_id（fk 用户 uid 或角色 uid）
*   acl_type（用于标识目标 id 引用的用户/角色）
*   acl_read
*   acl_update
*   acl_create
*   acl_delete

acl_read、acl_update、acl_create、acl_delete 值范围：

*   0 拒绝
*   1 允许
*   2 指低优先级检查（如果用户有值 2 则指角色）
*   3只自己

我相信有更有效的方法来解决这个问题，或者可以改进我目前的方法。

感谢您的回复。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T00:48:21.750

这是一个相当广泛的问题，因此您可能只会得到非常广泛的答案。

大多数 CMS 系统都有一个表格，其中列出了可以在系统上生成的内容类型。

另一个表格描述了每种类型的内容是如何显示的（在首页、各个博客页面等）。

另一个表为每个用户提供一个或多个“用户类型”或“组”，例如管理员、未注册、版主等。

最后一个表是各种访问表 - 它显示了每个组有权执行的操作，包括它可以创建、编辑、发布的内容类型等。

我建议您花一点时间研究其他 CMS 软件的数据库模式，例如[Slashcode](http://www.slashcode.com/docs/slashtables.html)、[Drupal](http://jaspan.com/drupal-6s-self-documenting-database-schema)或其他数百万个 CMS 系统之一。

-亚当

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T02:13:37.523

这实际上是一个非常广泛的问题。假设您有明确的应用程序层分离（例如，使用 MVC），那么这就是业务层中的内容。

考虑到您的直接要求，这可能相当简单。在您的用户表中，有一个 hasEdit、hasView 等。对于每个项目，附加一个用户 ID 代表创建者。在业务层中，如果他们是创建者，则规则是他们具有编辑权限，或者他们具有 hasEdit = true。

如果你有不同的类型，并且 hasEdit 权限是*per-type*，那么你需要另一个实体。

**用户权限**

*   用户权限 ID
*   用户 ID (FK)
*   类型 ID (FK)
*   hasEdit（布尔值）
*   有视图
*   ETC..

要确定他们是否有编辑权限，您可以检查他们是否是所有者，或者在 userPermission 表中查找该项目类型和当前用户，然后检查 hasEdit。您可以制定其他规则，例如将全局 hasEdit 放入用户表中。或者通过 userPermissionId 中的条目来表示全局 hasEdit，其 typeId 为 NULL。

这可能会变得更加复杂，使用角色和可变数量的权限..这一切都取决于您的要求。您需要仔细说明您的业务需求（提出一堆用例），然后您可以从那里进行设计。实际上，除了我在这里概述的内容之外，真的没有足够的信息来提供（即使这可能不是您所需要的）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T02:54:43.447

我喜欢使用一种防火墙规则方法或类似的 mysql 表规则方法：您可以授予用户或用户组对某些对象或对象组的某些权限。使每条规则成为规则表中的一行。当您需要执行编辑等操作时，您可以在规则表上为当前用户、当前用户组、布尔编辑列和对象 ID 或对象组进行内部连接。如果您返回任何行，则授予权限。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T03:22:21.173

有很多设计安全性的方法，我喜欢很多不同的情况。有 UNIX 风格的用户组其他。我碰巧喜欢[P​​mWiki 的安全模型](http://www.pmwiki.org/wiki/PmWiki/PasswordsAdmin)。

我开发了一个网站，它使用类似于[Apache](http://httpd.apache.org/docs/2.2/howto/auth.html)的用户角色权限结构。在那个网站上，我使用了一个模板系统，该系统使用一个标题包含文件和一个页脚包含文件来用“标准内容”包装页面内容。具有受限内容的页面可以将变量设置为所需的权限，头脚本会查找该变量，如果设置，则调用验证函数来检查用户是否属于该权限的角色。

使用 user-role-permissions 模型的好处是，如果您的大多数用户都属于简洁的授权类别，那么为用户设置授权很简单，只需为该用户添加正确的角色即可。权限与角色相关联，而不是直接与用户相关联，因此您可以轻松调整整个用户类别的权限。

# c++ - 你如何处理 NUL？

> ID：220423
> 
> 赞同：5
> 
> 时间：2008-10-21T00:41:48.223
> 
> 标签：c++, c

有时，当我们谈论 NULL 时，我会遇到与其他程序员的沟通问题。现在 NULL 可以是

NULL 指针
，NUL 字符
是某种数据库中的空数据元素。

NUL 似乎是最令人困惑的。它是 ASCII 字符 0x00。
我倾向于在我的代码中使用 '\0' 来表示它。我小组中的一些开发人员
倾向于简单地使用 0，并让编译器将其隐式转换为 char。

NUL 你更喜欢用什么？为什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-21T00:47:12.033

我使用`'\0'`空字符和`NULL`指针，因为它在这两种情况下都是最清晰的。

顺便说一句，两者`0`和`'\0'`都是C 中的 s，并且当存储在变量中时`int`，任何一个都将被转换为。`char``char`

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-21T00:43:42.353

我喜欢预定义的*NULL*宏，因为它保留了语义，而不是数字 0 的其他用途。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-21T00:46:00.553

有许多英语单词拼写或口语相似，但含义不同。就像在英语中一样，使用讨论发生的上下文来引导你理解预期的意思。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-21T02:51:16.307

*   为了处理字符串，我总是将空字符表示为 '\0'。
*   对于指针，我尝试使用implicit-conversion-to-boolean (if (!myPtr) or if (myPtr)) 来判断指针是否为空。
*   如果我需要一个指针的默认值，它是 NULL，例如 struct list_head = { 0.0, NULL };)。

END_OF_STRING 很愚蠢，因为它是额外的间接性，只会让新读者感到困惑（任何不能立即识别 '\0' 的人都应该离开键盘）。

另一件事——我认为在谈论数据建模时，空值和空值之间的区别非常重要。在讨论 C 风格的字符串或可为空的数据库字段时尤其如此。有人告诉你“我没有名字”和“我的名字是……”之间存在巨大差异。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-21T00:54:47.743

@BKB：

我在他的建议中看到了这一点，但是“NULL”更清楚地表明上下文是指针。就像在处理字符时使用“0.0”来表示浮点值一样，就像“\0”一样。（同样，如果在算术上下文中使用 char，我更喜欢看到 0。）

Bjarne 在[此 FAQ](http://www.research.att.com/~bs/bs_faq2.html#null)中进一步指出，NULL 无论如何都被 #defined 为 0，因此标准代码不应该有问题。我同意全大写表示法很难看，但我们必须等到 0x （这里可以使用 nullptr 作为关键字。）

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-22T08:02:01.623

如果我没记错的话，大多数 C 编译器都这样定义 NULL：

```
#define NULL ((void*)0) 
```

这是为了确保 NULL 被解释为指针类型（在 C 中）。然而，这可能会在 C++ 的类型严格得多的世界中引起问题。例如：

```
// Example taken from wikibooks.org
std::string * str = NULL; // Can't automatically cast void * to std::string *
void (C::*pmf) () = &C::func;
if (pmf == NULL) {} // Can't automatically cast from void * to pointer to member function. 
```

因此，在当前的 C++ 标准中，空指针应该使用文字 0 进行初始化。显然，因为人们习惯于使用 NULL 定义，我认为很多 C++ 编译器要么默默地忽略这个问题，要么在 C++ 代码中将 NULL 重新定义为 0。例如：

```
#ifdef __cplusplus
#define NULL (0)
#else
#define NULL ((void*)0)
#endif 
```

C++x0 标准现在定义了一个`nullptr`关键字来表示空指针。Visual C++ 2005 的 CLI/C++ 编译器在将托管指针设置为空时也使用此关键字。在当前的编译器中，您可以创建一个模板来模拟这个新关键字。

[wikibooks.org](http://en.wikibooks.org/wiki/More_C%2B%2B_Idioms/nullptr)上有一篇更详细的文章讨论了这个问题。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-05T14:28:10.610

```
A one-L NUL, it ends a string. 
A two-L NULL points to no thing. 
And I will bet a golden bull 
That there is no three-L NULLL. 

(The name of the original author is, alas, lost to the sands of time.) 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-21T00:43:34.007

数据库为 NULL，代码为 NIL。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-21T10:34:41.317

我相当喜欢

```
#define ASCII_NUL ('\0') 
```

我只是偶尔将'\0'错误输入为'0'。但是当我完成它时，我发现通过代码检查很难发现这个错误，结果很可笑。所以我不太喜欢 '\0'，而更喜欢 ASCII_NUL 或 0（当然后者在 C++ 中的类型错误）。显然，在需要与现有代码或样式指南保持一致的情况下，我会使用 '\0'。

Google C++ 风格指南包含一些我喜欢的东西和一些我不喜欢的东西，但似乎大多是合理的，它更喜欢 NULL 而不是 0 作为指针。它指出 NULL 可能不会简单地定义为 0（或 0L），尤其是在 sizeof(void*) 可能不是 sizeof(int)（或 sizeof(long int)）的实现中。

0 和 NULL 都被指定为整数类型，并且当转换为指针类型时，它们都必须产生空指针值。但它们不一定是相同的整数类型。因此，您可能会在某些情况下使用 NULL 得到一些有用的警告或错误。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-21T10:59:30.347

虽然总的来说，我建议使用命名常量，但这是一个例外。对我来说，定义：

```
#define NULL 0
#define END_OF_STRING '\0' 
```

与定义一样有意义：

```
#define SEVEN 7 
```

这是没有的。是的，我知道编译器已经定义了 NULL，但我从不使用它。对于指针，0；对于字符，'\0'。更长并不总是意味着更具表现力。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-21T01:06:53.367

对于通信，我使用 NULL。如果我正在与无法掌握不同数据类型的 NULL 概念的开发人员合作，那么我会担心。

对于实施，它是特定于案例的。数字为 0（浮点的后置 f），指针为 NULL，字符串为 0。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-21T01:24:31.490

不使用二进制 0 表示 NULL 的系统越来越难找到。它们还往往存在各种可移植性问题。为什么？因为在这些系统上，memset 和 calloc 都不能正确清除包含指针的结构。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-21T02:00:40.997

```
const char END_OF_STRING = '\0'; 
```

所以当你说：

```
str[i] = END_OF_STRING; 
```

或者

```
if (*ptr == END_OF_STRING) 
```

毫无疑问你的意思是什么。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-21T10:47:56.423

我们对指针使用 NULL，对字符使用 NULLCHAR，使用

```
#define NULLCHAR '\0' 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-07-23T09:00:36.580

有点相关：Slashdot 最近有一个[`comp.lang.c`关于空指针的常见问题解答部分](http://c-faq.com/null/)的故事，我觉得这很有趣。

# php - 如何使用 MySQL 表过滤 php 数组？

> ID：220432
> 
> 赞同：4
> 
> 时间：2008-10-21T00:46:18.243
> 
> 标签：php, mysql

假设我在一个名为 $foo 的 php 数组中有一个字符串数组，其中包含数百个条目，并且我有一个 MySQL 表“people”，其中包含一个名为“name”的字段，其中包含数千个条目。在不为 $foo 中的每个字符串提交查询的情况下，找出 $foo 中的哪些字符串不是 'people' 条目中的 'name' 的有效方法是什么？

所以我想找出 $foo 中的哪些字符串还没有被输入到“people”中。

请注意，很明显，所有数据都必须一次放在一个盒子上。目标是同时最小化查询数量和 php 处理量。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T00:52:38.527

我会将您的 $foo 数据放在另一个表中，并与您的名称表进行 LEFT OUTER JOIN。否则，在某些时候没有很多不涉及迭代的好方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T01:31:35.360

在不使用临时表的情况下，我能想到的最好的方法是：

```
 $list = join(",", $foo);

// fetch all rows of the result of 
// "SELECT name FROM people WHERE name IN($list)" 
// into an array $result

$missing_names = array_diff($foo, $result); 
```

请注意，如果 $foo 包含用户输入，则必须首先对其进行转义。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T06:56:58.090

以下情况如何：

1.  使用以下方法获取数据库中已经存在的名称列表： `SELECT name FROM people WHERE name IN (imploded list of names)`
2.  从返回的每个项目中插入`array_diff()`

如果你想完全在 SQL 中完成：

1.  使用 PHP 数组中的每个名称创建一个临时表。
2.  执行查询以填充仅包含新名称的第二个临时表。
3.  `INSERT ... SELECT`从第二个临时表执行到人员表。

两者都不会非常快，尽管第二种选择可能会稍微快一些。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T01:00:59.010

除了将所有字符串提交到数据库之外，我不确定是否有更有效的方法来执行此操作。

基本上有两种选择：获取 MySQL 中所有字符串的列表并将它们拉入 PHP 并进行比较，或者将所有字符串的列表发送到 MySQL 服务器并让它进行比较。MySQL 将比 PHP 更快地进行比较，除非数据库中的列表比 PHP 中的列表小很多。

您可以创建一个临时表，但无论哪种方式，您都可以将所有数据推送到数据库。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T01:20:36.770

对于几百个条目，只需使用 array_diff() 或 array_diff_assoc()

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T01:38:20.620

```
$query = 'SELECT name FROM table WHERE name != '.implode(' OR name != '. $foo); 
```

是的，这看起来根本无法很好地扩展。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-21T02:46:00.343

```
CREATE TEMPORARY TABLE PhpArray (name varchar(50));

-- you can probably do this more efficiently
INSERT INTO PhpArray VALUES ($foo[0]), ($foo[1]), ...;

SELECT People.*
FROM People
 LEFT OUTER JOIN PhpArray USING (name)
WHERE PhpArray.name IS NULL; 
```

# php - PHP中的魔术引号

> ID：220437
> 
> 赞同：20
> 
> 时间：2008-10-21T00:50:27.813
> 
> 标签：php, security, magic-quotes

根据[PHP 手册](http://ca3.php.net/manual/en/function.get-magic-quotes-gpc.php)，为了使代码更便携，他们建议使用类似以下的东西来转义数据：

```
if (!get_magic_quotes_gpc()) {
    $lastname = addslashes($_POST['lastname']);
} else {
    $lastname = $_POST['lastname'];
} 
```

我还有其他将要执行的验证检查，但就转义数据而言，上述内容的安全性如何？我还看到 PHP 6 将弃用魔术引号。这将如何影响上述代码？我宁愿不必依赖于特定于数据库的转义函数，如 mysql_real_escape_string()。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-10-21T00:57:28.860

魔术引号本质上是坏的。它们旨在清理对 PHP 脚本的输入，但在不知道如何使用该输入的情况下，不可能正确清理。如果有的话，您最好检查是否启用了魔术引号，然后在 $_GET/$_POST/$_COOKIES/$_REQUEST 上调用 stripslashes()，然后在您在某处使用它的地方清理变量。例如 urlencode() 如果您在 URL 中使用它，htmlentities() 如果您将它打印回网页，或者如果您将它存储到数据库中使用数据库驱动程序的转义函数。请注意，这些输入数组可能包含子数组，因此您可能需要编写一个可以递归到子数组中的函数来去除这些斜杠。

关于魔术引号的 PHP[手册页](http://php.net/magic_quotes)同意：

> “此功能自 PHP 5.3.0 起已弃用，自 PHP 5.4.0 起已删除。强烈建议不要依赖此功能。Magic Quotes 是一个自动将传入数据转义到 PHP 脚本的过程。最好使用魔法进行编码引号，而是根据需要在运行时转义数据。”

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-10-21T08:43:03.353

魔术引号是一个设计错误。它们的使用与保持你的理智不相容。

我更喜欢：

```
if (get_magic_quotes_gpc()) {
   throw new Exception("Turn magic quotes off now!");
} 
```

不要为与固有损坏的设置兼容而编写代码。而是通过让您的代码[FAIL FAST](http://en.wikipedia.org/wiki/Fail-fast)来保护它们的使用。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-21T01:29:16.863

我在我的网站的头文件中使用以下代码来反转magic_quotes的效果：

```
<?php

// Strips slashes recursively only up to 3 levels to prevent attackers from
// causing a stack overflow error.
function stripslashes_array(&$array, $iterations=0) {
    if ($iterations < 3) {
        foreach ($array as $key => $value) {
            if (is_array($value)) {
                stripslashes_array($array[$key], $iterations + 1);
            } else {
                $array[$key] = stripslashes($array[$key]);
            }
        }
    }
}

if (get_magic_quotes_gpc()) {
    stripslashes_array($_GET);
    stripslashes_array($_POST);
    stripslashes_array($_COOKIE);
}

?> 
```

然后我可以编写我的其余代码，就好像 magic_quotes 从未存在过一样。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-21T08:29:06.593

“我宁愿不必依赖特定于数据库的转义函数，如 mysql_real_escape_string()”

然后使用类似[PDO](http://uk.php.net/pdo)的东西。但是无论如何，您都必须扭转魔术引号造成的损害。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-14T03:16:00.797

对您的代码提出 PHP 5.2 或更高版本的要求并使用[过滤器 API](http://php.net/filter)。这些`filter_*`函数直接访问原始输入数据（它们永远不会接触`$_POST`等），因此它们完全不受`magic_quotes_gpc`.

那么这个例子：

```
if (!get_magic_quotes_gpc()) {
    $lastname = addslashes($_POST['lastname']);
} else {
    $lastname = $_POST['lastname'];
} 
```

可以变成这样：

```
$lastname = filter_input(INPUT_POST, 'lastname'); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-21T01:00:19.823

是的，这不是最好的方法，也不是最安全的。最好根据您要逃避的目的进行逃避。如果要存储在 mysql 数据库中，请使用 mysql_real_escape_string 考虑其他语言环境、字符集。对于 HTML，htmlentities。用于代码，escapeshellcmd，escapeshellarg。是的，如果打开了魔术引号，您可能需要先使用stirpslashes。但最好不要指望它或使用它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-21T06:47:47.827

关于使用数据库特定的转义功能，您非常需要。我发现使用`addslashes()`MySQL 在极少数情况下会失败。您可以编写一个函数来转义，以确定您正在使用哪个数据库，然后使用适当的转义函数。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-28T11:21:50.830

你可以试试这个：

```
if (get_magic_quotes_gpc()) { 
          $_REQUEST = array_map('stripslashes', $_REQUEST); 
          $_GET = array_map('stripslashes', $_GET);
          $_POST = array_map('stripslashes', $_POST);
          $_GET = array_map('stripslashes', $_COOKIES);

    } 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-14T02:41:52.457

“我宁愿不必依赖特定于数据库的转义函数，如 mysql_real_escape_string()”

也可以欺骗 addlashes 以及查看这篇文章：

[http://shiflett.org/blog/2006/jan/addslashes-versus-mysql-real-escape-string](http://shiflett.org/blog/2006/jan/addslashes-versus-mysql-real-escape-string)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-14T03:42:44.083

您的示例代码是向后的，您应该执行以下操作：

```
if (get_magic_quotes_gpc()) {
  $lastname = stripslashes($_POST['lastname']);
} else {
  $lastname = $_POST['lastname'];
} 
```

请注意，这会使您的输入数据完全按照用户键入的方式处于“原始”状态 - 没有额外的反斜杠并且可能会加载 SQL 注入和 XSRF 攻击 - 这正是您想要的。然后，确保**始终**使用以下其中一项：

*   将`echo`变量转换为 HTML 时，将其包装在`htmlentities()`
*   将其放入 mysql 时，请`mysql_real_escape_string()`至少使用准备好的语句。
*   将`echo`变量写入 Javascritpt 代码时，请使用`json_encode()`

Joel Spolsky 在[让错误的代码看起来错误方面有一些很好的开始建议](http://joelonsoftware.com/articles/Wrong.html)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-04-22T06:05:26.980

刚刚在[PHP 手册页](http://us2.php.net/manual/en/function.get-magic-quotes-gpc.php#95697)上找到了这个，看起来是一种非常聪明的去除 em 的方法（处理键和值......）：

```
if (get_magic_quotes_gpc())
{
    $_GET = json_decode(stripslashes(json_encode($_GET, JSON_HEX_APOS)), true);
    $_POST = json_decode(stripslashes(json_encode($_POST, JSON_HEX_APOS)), true);
    $_COOKIE = json_decode(stripslashes(json_encode($_COOKIE, JSON_HEX_APOS)), true);
    $_REQUEST = json_decode(stripslashes(json_encode($_REQUEST, JSON_HEX_APOS)), true);
    ini_set('magic_quotes_gpc', 0);
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-07-04T09:25:11.737

[PDO](http://php.net/manual/en/pdo.prepared-statements.php)和[Mysqli](http://php.net/manual/en/mysqli.quickstart.prepared-statements.php)的预处理语句是更好的防止 SQL 注入的方法。

但是，如果您正在为每个 SQL 查询迁移基于 Magic Quotes 的遗留代码，您可以参考[yidas/php-magic-quotes](https://github.com/yidas/php-magic-quotes)在 PHP 5.4 以上版本的环境中实现 Magic Quotes。

> [https://github.com/yidas/php-magic-quotes](https://github.com/yidas/php-magic-quotes)

# .net - 我可以为我自己的用户控件的设计器支持对 Control.Anchor 属性使用相同的编辑器吗？

> ID：220438
> 
> 赞同：0
> 
> 时间：2008-10-21T00:51:46.937
> 
> 标签：.net, visual-studio, user-controls

我有一个简单的扩展器组件，可以在任何控件周围绘制 3D 边框。在我的组件设计器支持中，我想使用 VS 用来选择 Anchor 属性的相同编辑器。

我知道我可以使用 [Editor()] 属性，但我不知道所使用的编辑器的类名。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T01:32:02.940

我使用 .NET Reflector 找到了答案：

```
[Flags, 
Editor("System.Windows.Forms.Design.AnchorEditor, System.Design, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a", typeof(UITypeEditor))]
public enum AnchorStyles 
```

# math - 用于游戏开发的三角数学

> ID：220439
> 
> 赞同：4
> 
> 时间：2008-10-21T00:52:26.720
> 
> 标签：math, javafx, trigonometry

我正在尝试制作一个三角形（等腰三角形）以在屏幕上移动，同时在用户按下方向键（如向右或向左）时稍微旋转它。

我希望三角形的鼻子（顶点）始终引导三角形。（就像那个古老的小行星游戏一样）。

我的问题是这背后的数学。在每个 X 时间间隔，我希望三角形在“某个方向”移动，我需要帮助找到这个方向（x 和 y 递增/递减）。

我可以找到三角形的中心点（质心），并且我有最高的 x 和 y 点，所以我有一个线向量可以使用，但不知道“如何”使用它。

我认为这与旧的 Sin 和 Cos 方法以及三角形旋转的量（角度）有关，但我对那些东西有点生疏。

任何帮助是极大的赞赏。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T01:05:17.440

vy/vx 的反正切（反正切），其中 vx 和 vy 是 (centroid->tip) 向量的分量，为您提供向量所面对的角度。

然而，经典反正切为您提供了一个归一化为 -90° < r < +90° 度的角度，因此您必须根据结果的符号和 vx 的符号从结果中加上或减去 90 度。

幸运的是，您的标准库应该提供一个 atan2() 函数，该函数将 vx 和 vy 分别作为参数，并返回一个介于 0° 和 360° 或 -180° 和 +180° 度之间的角度。它还将处理 vx=0 的特殊情况，如果您不小心，这将导致除以零。

请参阅[http://www.arctangent.net/atan.html](http://www.arctangent.net/atan.html)或仅搜索“arctangent”。

编辑：为了清楚起见，我在帖子中使用了度数，但 Java 和许多其他语言/库以 180° = π 的弧度工作。

您也可以将 vx 和 vy 添加到三角形的点以使其沿“向前”方向移动，但请确保向量已标准化（vx² + vy² = 1），否则速度将取决于三角形的大小。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-21T01:08:23.847

It seems to me that you need to store the rotation angle of the triangle and possibly it's current speed.

```
x' = x + speed * cos(angle)
y' = y + speed * sin(angle) 
```

Note that angle is in radians, not degrees!

Radians = Degrees * RadiansInACircle / DegreesInACircle

RadiansInACircle = 2 * Pi

DegressInACircle = 360

For the locations of the vertices, each is located at a certain distance and angle from the center. Add the current rotation angle before doing this calculation. It's the same math as for figuring the movement.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-21T12:54:41.067

@Mark:

I've tried writing a primer on vectors, coordinates, points and angles in this answer box twice, but changed my mind on both occasions because it would take too long and I'm sure there are many tutorials out there explaining stuff better than I ever can.

Your centroid and "tip" coordinates are not vectors; that is to say, there is nothing to be gained from thinking of them as vectors.

The vector you want, vForward = pTip - pCentroid, can be calculated by subtracting the coordinates of the "tip" corner from the centroid point. The atan2() of this vector, i.e. atan2(tipY-centY, tipX-centX), gives you the angle your triangle is "facing".

As for what it's relative to, it doesn't matter. Your library will probably use the convention that the increasing X axis (---> the right/east direction on presumably all the 2D graphs you've seen) is 0° or 0π. The increasing Y (top, north) direction will correspond to 90° or (1/2)π.

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-22T00:32:02.360

Here's some more:

Vectors represent displacement. Displacement, translation, movement or whatever you want to call it, is meaningless without a starting point, that's why I referred to the "forward" vector above as "from the centroid," and that's why the "centroid vector," the vector with the x/y components of the centroid point doesn't make sense. Those components give you the displacement of the centroid point from the origin. In other words, pOrigin + vCentroid = pCentroid. If you start from the 0 point, then add a vector representing the centroid point's displacement, you get the centroid point.

Note that:

vector + vector = vector
(addition of two displacements gives you a third, different displacement)

point + vector = point
(moving/displacing a point gives you another point)

point + point = ???
(adding two points doesn't make sense; however:)

point - point = vector
(the difference of two points is the displacement between them)

Now, these displacements can be thought of in (at least) two different ways. The one you're already familiar with is the *rectangular* (x, y) system, where the two components of a vector represent the displacement in the x and y directions, respectively. However, you can also use *polar* coordinates, (r, Θ). Here, Θ represents the direction of the displacement (in angles relative to an arbitary zero angle) and r, the distance.

Take the (1, 1) vector, for example. It represents a movement one unit to the right and one unit upwards in the coordinate system we're all used to seeing. The polar equivalent of this vector would be (1.414, 45°); the same movement, but represented as a "displacement of 1.414 units in the 45°-angle direction. (Again, using a convenient polar coordinate system where the East direction is 0° and angles increase counter-clockwise.)

The relationship between polar and rectangular coordinates are:

**Θ = atan2(y, x)**
**r = sqrt(x²+y²)** (now do you see where the right triangle comes in?)

and conversely,

**x = r * cos(Θ)**
**y = r * sin(Θ)**

Now, since a line segment drawn from your triangle's centroid to the "tip" corner would represent the direction your triangle is "facing," if we were to obtain a vector parallel to that line (e.g. **vForward = pTip - pCentroid**), that vector's Θ-coordinate would correspond to the angle that your triangle is facing.

Take the (1, 1) vector again. If this was vForward, then that would have meant that your "tip" point's x and y coordinates were both 1 more than those of your centroid. Let's say the centroid is on (10, 10). That puts the "tip" corner over at (11, 11). (Remember, **pTip = pCentroid + vForward** by adding "+ pCentroid" to both sides of the previous equation.) Now in which direction is this triangle facing? 45°, right? That's the Θ-coordinate of our (1, 1) vector!

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-21T01:25:12.660

keep the centroid at the origin. use the vector from the centroid to the nose as the direction vector. [http://en.wikipedia.org/wiki/Coordinate_rotation#Two_dimensions](http://en.wikipedia.org/wiki/Coordinate_rotation#Two_dimensions) will rotate this vector. construct the other two points from this vector. translate the three points to where they are on the screen and draw.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T01:11:24.637

```
double v; // velocity
double theta; // direction of travel (angle)
double dt; // time elapsed

// To compute increments
double dx = v*dt*cos(theta);
double dy = v*dt*sin(theta);

// To compute position of the top of the triangle
double size; // distance between centroid and top
double top_x = x + size*cos(theta);
double top_y = y + size*sin(theta); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-21T04:24:02.393

I can see that I need to apply the common 2d rotation formulas to my triangle to get my result, Im just having a little bit of trouble with the relationships between the different components here.

**aib**, stated that:

> The arctangent (inverse tangent) of vy/vx, where vx and vy are the components of your (centroid->tip) vector, gives you the angle the vector is facing.

Is vx and vy the x and y coords of the centriod or the tip? I think Im getting confused as to the terminology of a "vector" here. I was under the impression that a Vector was just a point in 2d (in this case) space that represented direction.

So in this case, how is the vector of the centroid->tip calculated? Is it just the centriod?

**meyahoocomlorenpechtel** stated:

> It seems to me that you need to store the rotation angle of the triangle and possibly it's current speed.

What is the rotation angle relative to? The origin of the triangle, or the game window itself? Also, for future rotations, is the angle the angle from the last rotation or the original position of the triangle?

Thanks all for the help so far, I really appreciate it!

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-21T04:30:56.963

you will want the topmost vertex to be the centroid in order to achieve the desired effect.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-30T05:14:08.397

First, I would start with the centroid rather than calculate it. You know the position of the centroid and the angle of rotation of the triangle, I would use this to calculate the locations of the verticies. (I apologize in advance for any syntax errors, I have just started to dabble in Java.)

//starting point

```
double tip_x = 10;
double tip_y = 10;

should be

double center_x = 10;
double center_y = 10; 
```

//triangle details

```
int width = 6; //base
int height = 9; 
```

should be an array of 3 angle, distance pairs.

```
angle = rotation_angle + vertex[1].angle;
dist = vertex[1].distance;    
p1_x = center_x + math.cos(angle) * dist;
p1_y = center_y - math.sin(angle) * dist;
// and the same for the other two points 
```

Note that I am *subtracting* the Y distance. You're being tripped up by the fact that screen space is inverted. In our minds Y increases as you go up--but screen coordinates don't work that way.

The math is a lot simpler if you track things as position and rotation angle rather than deriving the rotation angle.

Also, in your final piece of code you're modifying the location by the rotation angle. The result will be that your ship turns by the rotation angle every update cycle. I think the objective is something like Asteroids, not a cat chasing it's tail!

# javascript - 如何编写 PDF 文件中的文本搜索和替换

> ID：220445
> 
> 赞同：25
> 
> 时间：2008-10-21T00:54:10.880
> 
> 标签：javascript, pdf, replace

我如何能够以编程方式搜索和替换大量 PDF 文件中的某些文本？我想删除已添加到一组文件的 URL。我已经能够在 Adob​​e Pro 的批处理下使用 javascript 删除链接，但链接文本仍然存在。我已经看到使用文本修饰的建议，它可以手动工作，但我不想手动修改 1300 个文件。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-21T04:52:08.763

由于文档格式的图形性质，在 PDF 中查找文本本来就很困难——您要搜索的字母在文件中可能不连续。也就是说，[CAM::PDF](http://search.cpan.org/dist/CAM-PDF)具有一些搜索替换功能和启发式方法。[试试 changepagestring.pl](http://search.cpan.org/dist/CAM-PDF/bin/changepagestring.pl)，看看它是否适用于您的 PDF。

安装：

```
 $ cpan install CAM::PDF
 # start a new terminal if this is your first cpan module
 $ changepagestring.pl input.pdf oldtext newtext output.pdf 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-28T11:48:49.593

我也变得绝望了。在安装了 10 次 PDF 编辑器后，都需要花钱，但没有成功：

pdftk + 编辑器就足够了：

**替换 PDF 文件中的文本**

*   使用 pdftk 解压 PDF 页面流

    pdftk original.pdf 输出 original.uncompressed.pdf 解压

*   替换 original.uncompressed.pdf 中的文本（有时有效，有时无效）

*   修复修改过的（现在损坏的）PDF

    pdftk original.uncompressed.pdf 输出 original.uncompressed.fixed.pdf

> （来自乔尔·戴尔）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-07-28T17:44:47.320

You can use the 'redaction' feature in Adobe Acrobat Pro to find & replace all references in a single document in one step...not sure if it can be automated to multiple steps.

[http://help.adobe.com/en_US/Acrobat/9.0/Professional/WS5E28D332-9FF7-4569-AFAD-79AD60092D4D.w.html](http://help.adobe.com/en_US/Acrobat/9.0/Professional/WS5E28D332-9FF7-4569-AFAD-79AD60092D4D.w.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-11-12T13:54:37.860

I just finished trying out infix for a text that is comprised of text ladened with diacritics with the hope of generating another text where characters with double and composed diacritics are replaced by alternate with single diacritics. Infix is such definitely a good solution for someone who does not care for the trouble of understanding the working of programmatic solutions. All the request changes were effected. Still need to understand how to effect reflow of words that change the layout of text.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-12-18T14:07:17.853

This is just half a solution but I used Touch up combined with AppleScript's support for sending keystrokes to replace a string in thousands of table cells. Depending on how your pages are layout it could work for you. In my case I had to manually insert the cursor in the beginning of every table (tens of tables - quite manageable for a manual process) but after that i replaced thousands of cells automatically.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-01-14T22:26:56.293

The question is for a programmatic solution, but I will still share this free online tool which helped me mass replace text in some PDF files:

[http://www.pdfdu.com/pdf-replace-text.aspx](http://www.pdfdu.com/pdf-replace-text.aspx)

I did not notice any ads or other modifications in the resulting PDF files after replacing the text.

I was not able to make the changes locally with the software I tried. I think the main problem was that I was missing the font used in the PDF and it did not work properly, even with Acrobat Pro. The online tool did not complain and produced a great result.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-01-07T04:13:13.100

Not sure I would want to do all the work to write the code to modify your 1300 files when there is a program that can do it for you. The other day, I used the Professional version of Infix to batch modify almost 100 files using its "Find and Replace in Files" feature. It works great. I have evaluated other programs in hopes finding an find and replace functionality similar to Microsoft Word. Infix was the only one I found that can do it. Check out: [http://www.iceni.com/infix-pro.htm](http://www.iceni.com/infix-pro.htm)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-07-14T00:30:17.137

I suggest you may use VeryPDF PDF Text Replacer Command Line software to batch replace text in PDF pages, you can run pdftr.exe to replace text in PDF pages easily, for example,

pdftr.exe -contentreplace "My Name=>Your Name" D:\in.pdf D:\out.pdf

pdftr.exe -searchandoverlaytext "My Name=>Your Name" D:\in.pdf D:\out.pdf

pdftr.exe -searchandoverlaytext "My Name=>D:\temp\myname.png*20*20" D:\in.pdf D:\out.pdf

pdftr.exe -pagerange 1-3 -contentreplace "Old Text=>New Text||VeryPDF=>VeryDOC||My Name=>Your Name" D:\in.pdf D:\out.pdf

pdftr.exe -searchtext "string" C:\in.pdf

pdftr.exe -pagerange 1 -searchtext "string" C:\in.pdf

pdftr.exe -pagerange 1 -searchandoverlaytext "Old Text=>New Text||VeryPDF=>VeryDOC||My Name=>Your Name" D:\in.pdf D:\out.pdf

pdftr.exe -overlaytextfontname "Arial" -overlaytextcolor FF0000 -overlaybgcolor 00FF00 -searchandoverlaytext "Old Text=>New Text||VeryPDF=>VeryDOC||My Name=>Your Name" D:\in.pdf D:\out.pdf

pdftr.exe -opw 123 -upw 456 -contentreplace "Old Text=>New Text||VeryPDF=>VeryDOC||My Name=>Your Name" D:\in.pdf D:\out.pdf

pdftr.exe -searchandoverlaytext "PDFcamp Printer=>VeryPDF Printer" -overlaytextfontsize 8 D:\in.pdf D:\out.pdf

pdftr.exe -searchandoverlaytext "PDFcamp Printer=>VeryPDF Printer" -overlaytextfontsize 80% D:\in.pdf D:\out.pdf

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-06-11T06:16:20.507

It appears that even with uncompressed pdf's, text is sometimes formatted funky. This makes "normal" text replacement, a la `sed`, not work or not be trivial.

I couldn't find anything that seemed to work with [glyph spacing offsets](https://stackoverflow.com/a/66282749/32453), i.e. text that looks like this (which seems very common in pdf's), in this example, the word "Other information" is stored like this:

```
 [(O)-16(ther i)-20(nformati)-11(on )]TJ 
```

I have attempted to write a tool that satisfies this myself. It works OK for common use cases. Check it out [here](https://github.com/rdp/replace-text-pdf).

First uncompress your pdf, then cd to the checked out git code and:

Syntax

```
 $ crystal replaceinpdf.cr input_filename.pdf "something you want replaced" "what you want it replaced with" output.pdf 
```

Enjoy!

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2021-05-07T17:36:22.190

Although it is quite an old thread. Just wanted to share a Node.js package option to search and replace text in PDF: [Aspose.PDF Cloud SDK for Node.js](https://products.aspose.cloud/pdf/nodejs). It is paid product but it provides 150 free monthly API calls.

```
 const { PdfApi } = require("asposepdfcloud");
const { TextReplaceListRequest }= require("asposepdfcloud/src/models/textReplaceListRequest");
const { TextReplace }= require("asposepdfcloud/src/models/textReplace");

// Get Client ID and Client Secret from https://dashboard.aspose.cloud/
pdfApi = new PdfApi("xxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx", "xxxxxxxxxxxxxxxxxxxxxx");
var fs = require('fs');

const name = "02_pages.pdf";
const remoteTempFolder = "Temp";
//const localTestDataFolder = "C:\\Temp";
//const path = remoteTempFolder + "\\" + name;
//const outputFile= "Replace_output.pdf";

// Upload File
//pdfApi.uploadFile(path, fs.readFileSync(localTestDataFolder + "\\" + name)).then((result) => {  
//                     console.log("Uploaded File");    
//                    }).catch(function(err) {
    // Deal with an error
//    console.log(err);
//});

const textReplace= new TextReplace();
        textReplace.oldValue= "origami"; 
        textReplace.newValue= "aspose";
        textReplace.regex= false;

const textReplace1= new TextReplace();
        textReplace1.oldValue= "candy"; 
        textReplace1.newValue= "biscuit";
        textReplace1.regex= false;

const trr = new TextReplaceListRequest();
            trr.textReplaces = [textReplace,textReplace1];

// Replace text
pdfApi.postDocumentTextReplace(name, trr, null, remoteTempFolder).then((result) => {    
    console.log(result.body.code);                  
}).catch(function(err) {
    // Deal with an error
    console.log(err);
});

//Download file
//const outputPath = "C:/Temp/" + outputFile;

//pdfApi.downloadFile(path).then((result) => {    
//  fs.writeFileSync(outputPath, result.body);
//    console.log("File Downloaded");    
//}).catch(function(err) {
    // Deal with an error
//    console.log(err);
//}); 
```

# php - 作为一个想要做一些 PHP 工作的 C# 开发人员，我应该 [购买/阅读] 哪些 [书籍/在线文章] 来向自己介绍 PHP？

> ID：220450
> 
> 赞同：3
> 
> 时间：2008-10-21T00:57:32.137
> 
> 标签：php, wordpress

我已经掌握了处理堆栈的 Linux/MySQL 部分的最低要求，但在我深入研究之前，我想对 PHP 有一个基本的掌握。我将研究 WordPress 插件，以防有什么特别有趣的东西.

PS - 关于推荐的源代码控制/IDE 的任何建议也很好，但我想这是一个单独的问题。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-21T01:19:17.273

我也会推荐[PHP 手册](http://www.php.net/manual/en/)！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-21T01:06:50.543

对于 PHP 书籍，您可以查看[这个](https://stackoverflow.com/questions/90924/what-is-the-best-php-programming-book)问题，我个人喜欢[Programming PHP](http://oreilly.com/catalog/9780596006815/)，IDEs，我可以推荐您尝试：

*   [日蚀 PDT](http://www.eclipse.org/pdt/)
*   [Zend Studio for Eclipse](http://www.zend.com/en/products/studio/)
*   [用于 PHP 的 NetBeans](http://php.netbeans.org/)
*   [开发PHP](http://devphp.sourceforge.net/)
*   [维姆](https://stackoverflow.com/questions/202685/converting-from-eclipse-pdt-to-vim)

Vim 实际上它不是一个 IDE，但你可以得到全能补全、语法着色、调试等等……

[PHP 手册](http://www.php.net/manual/en/)也是开始学习语言的好地方。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-02T14:52:11.437

当你开发 C# 时，你绝对应该看看[VS.Php](http://www.jcxsoftware.com "VS.PHP")

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T12:08:42.483

最好的 php/mysql 书籍可能是[PHP 和 MySQL Web 开发](http://ibmdw.safaribooksonline.com/9780672329166 "PHP 和 MySQL 网页开发")，但如果您已经有 Web 开发经验，您可能只需要[PHP 食谱](http://safari.oreilly.com/0596101015 "PHP 食谱")之类的东西。

此外，如果您没有任何共享托管经验，您应该阅读[Apache security](http://ibmdw.safaribooksonline.com/0596007248 "阿帕奇安全")（第 6 章）之类的内容。

# c# - 如何最好地从应用程序的另一部分“关闭”网页？

> ID：220458
> 
> 赞同：1
> 
> 时间：2008-10-21T01:01:24.547
> 
> 标签：c#, asp.net, javascript, web-applications, asp.net-ajax

我们有一个 Web 应用程序来管理我们的计算机支持组的库存。我们将使用它的其中一件事是为我们更大的计算机实验室驱动“当前使用的计算机”地图，以便用户可以更轻松地找到开放的计算机（我们主图书馆的实验室大约有 150 台计算机）。用于此页面显示背景的图像是通过应用程序的管理部分进行管理的，以及实验室中的站点及其所在位置之间的关系。

我们希望管理员可以在管理界面中更新地图时“关闭”每个位置的地图页面显示。我的想法是扩展保存位置数据的表以指示该位置是否可用于地图显示，并在地图更新时检查这一点。如果检查表明不应显示地图，则页面将绘制合适的消息，而不是显示地图图像和“使用中”叠加数据。

希望其他人之前可能已经这样做过或类似的事情，我想听听您对替代方案的建议。

地图页面将通过 AJAX 定期刷新（每 2 分钟一次），方法是传递要使用的图像 url 和覆盖数据（表格的位置和每个可用的计算机数量）。我在想，当页面检测到从“不显示”到“显示”的转换时，它会通过 HTTP GET 刷新页面。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T01:31:35.890

使用轮询应该不难做到这一点，因为有少数用户检查计算机的可用性。您可能每分钟轮询几次而不会使服务器负担过重。

我会使用一个带有一堆绝对位置 DIV 的地图，这些 DIV 覆盖在代表每台计算机的地图上。每个 DIV 的背景将是“可用”或“不可用”图像。然后，您可以简单地在您的 Ajax 响应中吐出一些 JavaScript，以从代表其当前状态的每个 DIV 中添加/删除类名。更改类名将更改 DIV 的背景图像。

您可以在管理员编辑状态时显示“加载”微调器（这只是另一个类名）。

# asp.net - 使用 ASP.Net，是否有一种编程方式来截取浏览器内容的屏幕截图？

> ID：220461
> 
> 赞同：6
> 
> 时间：2008-10-21T01:04:29.643
> 
> 标签：asp.net, screenshot

我有一个 ASP.Net 应用程序，作为所需的功能，用户希望能够截屏。虽然我知道这可以模拟，但如果有一种方法可以获取 URL（或当前呈现的页面）并将其转换为可以存储在服务器上的图像，那就太好了。

这是疯了吗？有没有办法做到这一点？如果有，有参考吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-21T01:14:15.443

我现在可以告诉你，在浏览器内部没有办法做到这一点，**也不应该有**. 想象一下，您的页面在 iframe 中嵌入了 GMail。然后，您可以窃取此人的 GMail 收件箱的屏幕截图！

这可以通过让浏览器“屏蔽”所有违反跨域限制的 iframe 和嵌入来确保安全。

您当然可以编写一个扩展来执行此操作，但请注意上述安全注意事项。

**更新：**您可以使用画布实用程序函数来获取与您的代码*同源的页面的屏幕截图。*甚至还有一个库可以让你这样做：[http ://experiments.hertzen.com/jsfeedback/](http://experiments.hertzen.com/jsfeedback/)

你可以在这里找到其他可能的答案：[Using HTML5/Canvas/JavaScript to take screenshots](https://stackoverflow.com/questions/4912092/using-html5-canvas-javascript-to-take-screenshots)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-21T01:08:55.030

[Browsershots](http://browsershots.org/)有一个 XML-RPC 接口和可用的源代码（在 Python 中）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-21T02:00:16.597

我使用了免费的程序集 UrlScreenshot.dll，您可以[在此处](http://blog.taiki.be/index.php/2008/07/generating-screenshots-of-webpages-using-net/)下载。

效果很好！

还有[WebSiteScreenShot](http://www.websitesscreenshot.com/)但它不是免费的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T01:30:57.000

您可以尝试一个浏览器插件，例如[IE7 Pro](http://www.ie7pro.com/) for Internet Explorer，它允许您将当前站点的屏幕截图保存到磁盘上的文件中。我敢肯定那里也有类似的 FireFox 插件。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-21T02:00:52.773

如果你想做你描述的事情。您需要调用一个打印 IE 输出的外部进程，如此处[所述](http://www.codegod.de/WebAppCodeGod/Screenshot-of-Webpage-with-ASP-NET-AID398.aspx)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-21T03:03:21.697

你为什么不采取另一种方法？

If you have the need that users can view the same content over again, then it sounds like that is a business requirement for your application, and so you should be building it into your application.

Structure the URL so that when the same user (assuming you have sessions and the application shows different things to different users) visits the same URL, they always see same thing. They can then bookmark the URL locally, or you can even have an application feature that saves it in a user profile.

Part of this would mean making "clean urls", eg, site.com/view/whatever-information-needed-here.

If you are doing time-based data, where it changes as it gets older, there are probably a couple possible approaches.

*   If your data is not changing on a regular basis, then you could make the "current" page always, eg, site.com/view/2008-10-20 (add hour/minute/second as appropriate).
*   If it is refreshing, and/or updating more regularly, have the "current" page as site.com/view .. but allow specifying the exact time afterwards. In this case, you'd have to have a "link to this page" type function, which would link to the permanent URL with the full date/time. Look to google maps for inspiration here-- if you scroll across a map, you can always click "link to here" and it will provide a link that includes the GPS coordinates, objects on the map, etc. In that case it's not a very friendly url but it does work quite well. :)

# c# - 在应用程序中使用 256 x 256 Windows Vista 图标

> ID：220465
> 
> 赞同：11
> 
> 时间：2008-10-21T01:05:37.863
> 
> 标签：c#, vb.net, png, icons

我有一个应用程序，我为其制作了 256 x 256 Windows Vista 图标。

我想知道如何在用作应用程序图标的 ico 文件中使用 256x256 PNG 文件并将其显示在表单上的图片框中。

我正在使用 VB.NET，但 C# 中的答案很好。我想我可能不得不使用反射。

我不确定这在 Windows XP 中是否可行并且可能需要 Windows Vista API

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-12-22T11:18:42.873

Today, I made a very nice function for **extracting the 256x256 Bitmaps from Vista icons**.

Like you, Nathan W, I use it to display the large icon as a Bitmap in "About" box. For example, this code gets Vista icon as PNG image, and displays it in a 256x256 PictureBox:

```
picboxAppLogo.Image = ExtractVistaIcon(myIcon); 
```

This function takes Icon object as a parameter. So, you can use it with any icons - **from resources**, from files, from streams, and so on. (Read below about extracting EXE icon).

It runs on **any OS**, because it does **not** use any Win32 API, it is **100% managed code** :-)

```
// Based on: http://www.codeproject.com/KB/cs/IconExtractor.aspx
// And a hint from: http://www.codeproject.com/KB/cs/IconLib.aspx

Bitmap ExtractVistaIcon(Icon icoIcon)
{
    Bitmap bmpPngExtracted = null;
    try
    {
        byte[] srcBuf = null;
        using (System.IO.MemoryStream stream = new System.IO.MemoryStream())
            { icoIcon.Save(stream); srcBuf = stream.ToArray(); }
        const int SizeICONDIR = 6;
        const int SizeICONDIRENTRY = 16;
        int iCount = BitConverter.ToInt16(srcBuf, 4);
        for (int iIndex=0; iIndex<iCount; iIndex++)
        {
            int iWidth  = srcBuf[SizeICONDIR + SizeICONDIRENTRY * iIndex];
            int iHeight = srcBuf[SizeICONDIR + SizeICONDIRENTRY * iIndex + 1];
            int iBitCount   = BitConverter.ToInt16(srcBuf, SizeICONDIR + SizeICONDIRENTRY * iIndex + 6);
            if (iWidth == 0 && iHeight == 0 && iBitCount == 32)
            {
                int iImageSize   = BitConverter.ToInt32(srcBuf, SizeICONDIR + SizeICONDIRENTRY * iIndex + 8);
                int iImageOffset = BitConverter.ToInt32(srcBuf, SizeICONDIR + SizeICONDIRENTRY * iIndex + 12);
                System.IO.MemoryStream destStream = new System.IO.MemoryStream();
                System.IO.BinaryWriter writer = new System.IO.BinaryWriter(destStream);
                writer.Write(srcBuf, iImageOffset, iImageSize);
                destStream.Seek(0, System.IO.SeekOrigin.Begin);
                bmpPngExtracted = new Bitmap(destStream); // This is PNG! :)
                break;
            }
        }
    }
    catch { return null; }
    return bmpPngExtracted;
} 
```

**IMPORTANT!** If you want to load this icon directly from EXE file, then you **CAN'T** use *Icon.ExtractAssociatedIcon(Application.ExecutablePath)* as a parameter, because .NET function ExtractAssociatedIcon() is so stupid, it extracts ONLY 32x32 icon!

Instead, you better use the whole **IconExtractor** class, created by Tsuda Kageyu ([http://www.codeproject.com/KB/cs/IconExtractor.aspx](http://www.codeproject.com/KB/cs/IconExtractor.aspx)). You can slightly simplify this class, to make it smaller. Use **IconExtractor** this way:

```
// Getting FILL icon set from EXE, and extracting 256x256 version for logo...
using (TKageyu.Utils.IconExtractor IconEx = new TKageyu.Utils.IconExtractor(Application.ExecutablePath))
{
    Icon icoAppIcon = IconEx.GetIcon(0); // Because standard System.Drawing.Icon.ExtractAssociatedIcon() returns ONLY 32x32.
    picboxAppLogo.Image = ExtractVistaIcon(icoAppIcon);
} 
```

Note: I'm still using my ExtractVistaIcon() function here, because I don't like how **IconExtractor** handles this job - first, it extracts all icon formats by using IconExtractor.SplitIcon(icoAppIcon), and then you have to know the exact 256x256 icon index to get the desired vista-icon. So, using my ExtractVistaIcon() here is much faster and simplier way :)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-21T01:19:10.970

[在这里](http://www.geekpedia.com/tutorial219_Extracting-Icons-from-Files.html)找到信息。要获得大的 Vista 图标，您需要使用 Shell32 的 SHGetFileInfo 方法。我已经复制了下面的相关文本，当然您需要将文件名变量替换为“Assembly.GetExecutingAssembly().Location”。

```
using System.Runtime.InteropServices; 
```

我们将在调用 SHGetFileInfo() 时使用一堆常量来指定我们希望检索的图标的大小：

```
// Constants that we need in the function call
private const int SHGFI_ICON = 0x100;
private const int SHGFI_SMALLICON = 0x1;
private const int SHGFI_LARGEICON = 0x0; 
```

SHFILEINFO 结构非常重要，因为它将是我们处理各种文件信息的句柄，其中包括图形图标。

```
// This structure will contain information about the file
public struct SHFILEINFO
{
    // Handle to the icon representing the file
    public IntPtr hIcon;
    // Index of the icon within the image list
    public int iIcon;
    // Various attributes of the file
    public uint dwAttributes;
    // Path to the file
    [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 256)]
    public string szDisplayName;
    // File type
    [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 80)]
    public string szTypeName;
}; 
```

非托管代码的最后准备工作是定义 SHGetFileInfo 的签名，该签名位于流行的 Shell32.dll 内：

```
// The signature of SHGetFileInfo (located in Shell32.dll)
[DllImport("Shell32.dll")]
public static extern IntPtr SHGetFileInfo(string pszPath, uint dwFileAttributes, ref SHFILEINFO psfi, int cbFileInfo, uint uFlags); 
```

现在我们已经准备好一切，是时候调用函数并显示我们检索到的图标了。将检索的对象是一个图标类型 (System.Drawing.Icon)，但我们希望将其显示在 PictureBox 中，因此我们将使用 ToBitmap() 方法将图标转换为位图。

But first of all there are 3 controls you need to add to the form, a Button btnExtract that has "Extract Icon" for its Text property, picIconSmall which is a PictureBox and a picIconLarge which is also a PictureBox. That's because we will get two icons sizes. Now double click btnExtract in Visual Studio's Design view and you'll get to its Click event. Inside it is the rest of the code:

```
private void btnExtract_Click(object sender, EventArgs e)
{
    // Will store a handle to the small icon
    IntPtr hImgSmall;
    // Will store a handle to the large icon
    IntPtr hImgLarge;

    SHFILEINFO shinfo = new SHFILEINFO();

    // Open the file that we wish to extract the icon from
    if(openFile.ShowDialog() == DialogResult.OK)
    {
        // Store the file name
        string FileName = openFile.FileName;
        // Sore the icon in this myIcon object
        System.Drawing.Icon myIcon;

        // Get a handle to the small icon
        hImgSmall = SHGetFileInfo(FileName, 0, ref shinfo, Marshal.SizeOf(shinfo), SHGFI_ICON | SHGFI_SMALLICON);
        // Get the small icon from the handle
        myIcon = System.Drawing.Icon.FromHandle(shinfo.hIcon);
        // Display the small icon
        picIconSmall.Image = myIcon.ToBitmap();

        // Get a handle to the large icon
        hImgLarge = SHGetFileInfo(FileName, 0, ref shinfo, Marshal.SizeOf(shinfo), SHGFI_ICON | SHGFI_LARGEICON);
        // Get the large icon from the handle
        myIcon = System.Drawing.Icon.FromHandle(shinfo.hIcon);
        // Display the large icon
        picIconLarge.Image = myIcon.ToBitmap();

    }
} 
```

UPDATE: found even more info [here](http://support.microsoft.com/kb/319350).

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T03:26:00.123

None of the above answers handle Vista Icons - only small (32x32) and large (48x48)

There is a library that handles Vista Icons [here](http://www.codeproject.com/KB/cs/IconLib.aspx)

...it looks quite complicated due to the dual-png alpha channel format.

I will try to make a concise answer in vb .net but it may take some time.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-02-01T15:54:34.283

Having the same problem of displaying the 256*256*32 image from an ICO file in a picture box, I found the solution from SAL80 the most efficient one (and almost working). However, the original code doesn't support images stored as BMP (the large icon is usually PNG, but not always...).

Here is my version for future references. The code to create the bitmap is also slightly simpler :

```
 /// <summary>
    /// Extracts  the large Vista icon from a ICO file 
    /// </summary>
    /// <param name="srcBuf">Bytes of the ICO file</param>
    /// <returns>The large icon or null if not found</returns>
    private static Bitmap ExtractVistaIcon(byte[] srcBuf)
    {
        const int SizeIcondir = 6;
        const int SizeIcondirentry = 16;

        // Read image count from ICO header
        int iCount = BitConverter.ToInt16(srcBuf, 4);

        // Search for a large icon
        for (int iIndex = 0; iIndex < iCount; iIndex++)
        {
            // Read image information from image directory entry
            int iWidth = srcBuf[SizeIcondir + SizeIcondirentry * iIndex];
            int iHeight = srcBuf[SizeIcondir + SizeIcondirentry * iIndex + 1];
            int iBitCount = BitConverter.ToInt16(srcBuf, SizeIcondir + SizeIcondirentry * iIndex + 6);

            // If Vista icon
            if (iWidth == 0 && iHeight == 0 && iBitCount == 32)
            {
                // Get image data position and length from directory
                int iImageSize = BitConverter.ToInt32(srcBuf, SizeIcondir + SizeIcondirentry * iIndex + 8);
                int iImageOffset = BitConverter.ToInt32(srcBuf, SizeIcondir + SizeIcondirentry * iIndex + 12);

                // Check if the image has a PNG signature
                if (srcBuf[iImageOffset] == 0x89 && srcBuf[iImageOffset+1] == 0x50 && srcBuf[iImageOffset+2] == 0x4E && srcBuf[iImageOffset+3] == 0x47)
                {
                    // the PNG data is stored directly in the file
                    var x = new MemoryStream(srcBuf, iImageOffset, iImageSize, false, false);
                    return new Bitmap(x); 
                }

                // Else it's bitmap data with a partial bitmap header
                // Read size from partial header
                int w = BitConverter.ToInt32(srcBuf, iImageOffset + 4);
                // Create a full header
                var b = new Bitmap(w, w, PixelFormat.Format32bppArgb);
                // Copy bits into bitmap
                BitmapData bmpData = b.LockBits(new Rectangle(0, 0, b.Width, b.Height), ImageLockMode.WriteOnly, b.PixelFormat);
                Marshal.Copy(srcBuf, iImageOffset + Marshal.SizeOf(typeof(Bitmapinfoheader)), bmpData.Scan0, b.Width*b.Height*4);
                b.UnlockBits(bmpData);
                return b;
            }
        }

        return null;
    } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T02:17:44.050

Have a look at the Windows [icon functions](http://msdn.microsoft.com/en-us/library/ms674654(VS.85).aspx) that are available. There's also an [overview](http://msdn.microsoft.com/en-us/library/ms648050(VS.85).aspx) that mentions querying for different icon sizes. There's a [Dream.In.Code](http://www.dreamincode.net/forums/showtopic60140.htm) forum thread for using the APIs in C# as well as a [Pinvoke.net reference](http://www.pinvoke.net/default.aspx/shell32.ExtractIconEx).

# c# - 在自定义服务器控件中维护状态的正确方法是什么？

> ID：220470
> 
> 赞同：1
> 
> 时间：2008-10-21T01:09:39.693
> 
> 标签：c#, asp.net, custom-server-controls, servercontrols

这行得通，但这是正确的方法吗？？？

我有一个自定义服务器控件，上面有一个 [输入] 框。我希望它有点模仿 ASP.NET 文本框，但不是完全模仿。当呈现文本框时，我有一个 javascript，允许用户选择然后放置在该输入框中的值。

我在控件上有一个公共文本属性。在获取/设置中，我获取/设置控件的视图状态 - 这部分很容易，但是当通过 javascript 填充控件时，实际上并未调用 Text get，使用 JavaScript 设置此公开属性的正确方法是什么（或者即使用户只是在框中输入）？

编辑：在 OnInit 中，我确保通过进入表单值来维护状态。

```
 protected override void OnInit(EventArgs e)
    {
        base.OnInit(e);

        if (HttpContext.Current.Request.Form["MyInputBoxValue"] != "")
        {
            ViewState["MyInputBoxValue"] 
               = HttpContext.Current.Request.Form["MyInputBoxValue"];
        }
    } 
```

然后为了让 HtmlTextWrite 中的值真正回到原位，我这样做：

```
protected override void RenderContents(HtmlTextWriter output)
{

        // There is an input control here and i set its value property
        // like this using the Text internal defined.
        output.Write("<input value=" + Text + ">.....

} 
```

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T02:35:28.210

我发现使用 IStateManager 效果最好。

例如：

```
partial class MyControl : System.Web.UI.UserControl, IStateManager
{
    [Serializable()]
    protected struct MyControlState
    {
        public bool someValue;
        public string name;
    }

    protected MyControlState state;

    public bool someValue {
        get { return state.someValue; }
        set { state.someValue = value; }
    }

    public bool IsTrackingViewState {
        get { return true; }
    }

    protected override void LoadViewState(object state)
    {
        if ((state != null) && state is MyControlState) {
            this.state = state;
        }
    }

    protected override object SaveViewState()
    {
        return state;
    }

    protected override void TrackViewState()
    {
        base.TrackViewState();
    }
} 
```

getDefaultState() 只会将一些健全的默认值加载到新的状态结构中。状态在页面的视图状态中被跟踪，并且 ASP 会为您处理将其引入/输出。

（上面的代码是从 VB 移植的，没有检查，希望我没有犯任何错误，但无论如何它应该明白这一点）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T01:22:49.403

如果您需要在回发时维护状态，您必须提供自己的方法来记录用户在客户端对您的控件所做的事情，并稍后在服务器上使用更改更新服务器控件，或者在客户端重做更改页面刷新时的一面。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T19:26:00.550

Hmm I wonder if we can use the existing ASP.NET persistence... try inheriting from the most basic post-back state persisting control (I'm thinking asp:hidden). Then just override the render and add all the jazz you want.

Let me know if it works, then I won't have to test :)

# javascript - 如何使用 JavaScript 模拟单击 以使当前输入失去焦点

> ID：220488
> 
> 赞同：8
> 
> 时间：2008-10-21T01:27:40.470
> 
> 标签：javascript, focus, yui

我有一个输入，在某些时候恰好有焦点。如果用户点击页面的“背景”，输入就会失去焦点。我试图用下面的代码模拟背景上的点击，但这不起作用（你会注意到输入仍然有焦点）。关于如何编写模拟点击页面“背景”的代码的任何建议？

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <script type="text/javascript" src="http://yui.yahooapis.com/2.6.0/build/yahoo/yahoo-min.js" ></script>
        <script type="text/javascript" src="http://yui.yahooapis.com/2.6.0/build/event/event-min.js" ></script>
        <script type="text/javascript">
            YAHOO.util.Event.onDOMReady(function() {
                document.getElementById("input").focus();    
                document.getElementById("main").focus();    
            });
        </script>
    </head>
    <body>
        <div id="main">
            <form action="/">
                <p>
                    <input type="text" id="input"/>
                </p>
            </form>
        </div>
    </body>
</html> 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-21T01:29:52.383

我想使用`blur()`可以解决问题：

```
<script type="text/javascript">
    YAHOO.util.Event.onDOMReady(function() {
        document.getElementById("input").focus();    
        document.getElementById("input").blur();    
    });
</script> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T01:30:27.563

尝试使用`blur`事件。如果您使用的是 jQuery，则有一个方法可以调用 DOM 对象来引发此事件。该`blur()`方法也应该在没有 jQuery 的情况下工作。

[http://docs.jquery.com/Events/blur](http://docs.jquery.com/Events/blur)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2020-11-20T07:37:34.793

你的想法是对的，但是有一个小问题。

```
document.getElementById("main").focus();

<div id="main"> 
```

如您的代码所示，实际上 div HTMLElement 没有焦点方法。

因此您可以调用具有焦点方法的其他元素或调用`blur()`输入元素

# c# - “CLR 检测到无效程序。” 调用通用方法时

> ID：220507
> 
> 赞同：1
> 
> 时间：2008-10-21T01:34:47.367
> 
> 标签：c#, generics, .net-2.0

我编写了一个大型静态方法，该方法将泛型作为参数参数。我调用此方法，框架抛出 System.InvalidProgramException。甚至在方法的第一行执行之前，就会引发此异常。

我可以创建一个采用泛型参数的静态类，然后将其设为静态类的方法，一切正常。

这是一个 .NET 缺陷，还是我在这里打破了一些模糊的通用规则？

为了完整起见，我已经包含了失败的方法和通过的方法。请注意，这使用了我自己的库中的许多其他类（例如 GridUtils），这里不解释这些类。我认为实际含义并不重要：问题是为什么运行时在方法开始之前就崩溃了。

（我正在使用 Visual Studio 2005 进行编程，所以也许这在 Visual Studio 2008 中已经消失了。）

**这会在调用第一行之前引发异常：**

```
 private delegate void PROG_Delegate<TGridLine>(DataGridView dgv, IEnumerable<TGridLine> gridLines, string[] columns);

    public static void PopulateReadOnlyGrid<TGridLine>(DataGridView dgv, IEnumerable<TGridLine> gridLines, string[] columns)
    {
        if (dgv.InvokeRequired)
        {
            dgv.BeginInvoke
                        (
                            new PROG_Delegate<TGridLine>(PopulateReadOnlyGrid<TGridLine>),
                            new object[] { dgv, gridLines, columns }
                        );
            return;
        }
        GridUtils.StatePreserver statePreserver = new GridUtils.StatePreserver(dgv);
        System.Data.DataTable dt = CollectionHelper.ConvertToDataTable<TGridLine>((gridLines));
        dgv.DataSource = dt;
        dgv.DataMember = "";
        dgv.AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.AllCells;
        GridUtils.OrderColumns<TGridLine>(dgv, columns);
        statePreserver.RestoreState();
        dgv.AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.None;
    } 
```

**这工作正常：**

```
 public static class Populator<TGridLine>
    {
        private delegate void PROG_Delegate(DataGridView dgv, IEnumerable<TGridLine> gridLines, string[] columns);

        public static void PopulateReadOnlyGrid(DataGridView dgv, IEnumerable<TGridLine> gridLines, string[] columns)
        {
            if (dgv.InvokeRequired)
            {
                dgv.BeginInvoke
                            (
                                new PROG_Delegate(PopulateReadOnlyGrid),
                                new object[] { dgv, gridLines, columns }
                            );
                return;
            }
            GridUtils.StatePreserver statePreserver = new GridUtils.StatePreserver(dgv);
            System.Data.DataTable dt = CollectionHelper.ConvertToDataTable<TGridLine>((gridLines));
            dgv.DataSource = dt;
            dgv.DataMember = "";
            dgv.AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.AllCells;
            GridUtils.OrderColumns<TGridLine>(dgv, columns);
            statePreserver.RestoreState();
            dgv.AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.None;

        }
    } 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-21T01:52:43.697

仅供参考，不确定它是否会解决任何问题，但您的 Invoke 方法可以简化。这也消除了对该委托的需求（可能导致修复？）：

```
dgv.BeginInvoke(new MethodInvoker(delegate()
{
    PopulateReadOnlyGrid(dgv, gridLines, columns);
})); 
```

当我将您的代码粘贴到表单中时（在注释掉您的 GridUtils 内容之后），您的代码对我来说运行良好。我什至从 gui 线程和非 gui 线程调用该方法。我在 3.5 和 2.0 中尝试过。工作正常.... （！？）

试试这个代码：

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Text;
using System.Windows.Forms;
using System.Reflection;
using System.Threading;

namespace WindowsFormsApplication1
{
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
        }

        private delegate void PROG_Delegate<TGridLine>(Control dgv, IEnumerable<TGridLine> gridLines, string[] columns);

        public static void PopulateReadOnlyGrid<TGridLine>(Control dgv, IEnumerable<TGridLine> gridLines, string[] columns)
        {
            if (dgv.InvokeRequired)
            {
                dgv.BeginInvoke
                            (
                                new PROG_Delegate<TGridLine>(PopulateReadOnlyGrid<TGridLine>),
                                new object[] { dgv, gridLines, columns }
                            );
                return;
            }
            MessageBox.Show("hi");
            //GridUtils.StatePreserver statePreserver = new GridUtils.StatePreserver(dgv);
            //System.Data.DataTable dt = CollectionHelper.ConvertToDataTable<TGridLine>((gridLines));
            //dgv.DataSource = dt;
            //dgv.DataMember = "";
            //dgv.AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.AllCells;
            //GridUtils.OrderColumns<TGridLine>(dgv, columns);
            //statePreserver.RestoreState();
            //dgv.AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.None;
        }

        private void button1_Click(object sender, EventArgs e)
        {
            PopulateReadOnlyGrid(this, new int[] { 1, 2, 3 }, new string[] { "a" });

            ThreadPool.QueueUserWorkItem(new WaitCallback((a) =>
            {
                PopulateReadOnlyGrid(this, new int[] { 1, 2, 3 }, new string[] { "a" });
            }));

        }

    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T02:22:56.113

*由于我误解了代码示例而更新。*

尝试用 MethodInvoker 包装委托：

[http://msdn.microsoft.com/en-us/library/system.windows.forms.methodinvoker.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.methodinvoker.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T03:36:23.673

按照[TheSoftwareJedi 的](http://stackoverflow.com/users/18941/thesoftwarejedi)建议，我进行了一些测试，最终证明是使用 PROG_Delegate 导致了异常。

如果我使用 MethodInvoker，代码运行不会出错。

```
 private delegate void PROG_Delegate<TGridLine>(DataGridView dgv, IEnumerable<TGridLine> gridLines, string[] columns);

    public static void PopulateReadOnlyGrid<TGridLine>(DataGridView dgv, IEnumerable<TGridLine> gridLines, string[] columns)
    {
        if (dgv.InvokeRequired)
        {
            dgv.BeginInvoke(new MethodInvoker(delegate()
            {
                PopulateReadOnlyGrid(dgv, gridLines, columns);
            }));
            return;
        }
        GridUtils.StatePreserver statePreserver = new GridUtils.StatePreserver(dgv);
        System.Data.DataTable dt = CollectionHelper.ConvertToDataTable<TGridLine>((gridLines));
        dgv.DataSource = dt;
        dgv.DataMember = "";
        dgv.AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.AllCells;
        GridUtils.OrderColumns<TGridLine>(dgv, columns);
        statePreserver.RestoreState();
        dgv.AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.None;
    } 
```

如果我将 PROG_Delegate 放回并删除*其他所有内容，*我就会返回异常。

```
 private delegate void PROG_Delegate<TGridLine>(DataGridView dgv, IEnumerable<TGridLine> gridLines, string[] columns);

    public static void PopulateReadOnlyGrid<TGridLine>(DataGridView dgv, IEnumerable<TGridLine> gridLines, string[] columns)
    {
        if (dgv.InvokeRequired)
        {
            dgv.BeginInvoke
                        (
                            new PROG_Delegate<TGridLine>(PopulateReadOnlyGrid<TGridLine>),
                            new object[] { dgv, gridLines, columns }
                        );
        }
        //GridUtils.StatePreserver statePreserver = new GridUtils.StatePreserver(dgv);
        //System.Data.DataTable dt = CollectionHelper.ConvertToDataTable<TGridLine>((gridLines));
        //dgv.DataSource = dt;
        //dgv.DataMember = "";
        //dgv.AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.AllCells;
        //GridUtils.OrderColumns<TGridLine>(dgv, columns);
        //statePreserver.RestoreState();
        //dgv.AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.None;
    } 
```

因此，有一个简单的解决方法，MethodInvoker 的使用使代码更加简洁易读。

在理论上，鉴于 PROG_Delegate 是合法的并且它正在为其他人工作，它为什么会崩溃仍然存在问题。我怀疑我们能得出的最佳答案是“一些晦涩难懂的错误”，因为编码人员更喜欢使用 Method Invoker，所以它仍然是晦涩难懂的。

# asp.net - 有谁知道用于编码 Orkut 的语言？

> ID：220510
> 
> 赞同：-1
> 
> 时间：2008-10-21T01:44:28.003
> 
> 标签：asp.net

当然，这个问题不会对任何人有很大的帮助，但它可能会以某种方式有用。一开始，所有**Orkut**页面都有扩展名`*.aspx`，但现在所有页面都**伪装**成`Main#page.aspx`.

对不起，如果这`Main#`是一个 ASP 功能，但它看起来不像一个我。有人知道 Orkut 的编码语言吗？（我指的是“Main#”背后的语言）

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-21T01:49:27.180

浏览一下，似乎很多东西都以[.py](http://help.orkut.com/support/bin/answer.py?answer=30993&src=top5) (python) 文件结尾。据我所知，Orkut 是由 Google 创建的，然后被 Google 收购，因此他们可能正在将其转换为 Python，这是一种更标准的 Google 语言。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2017-01-18T22:35:27.997

最初是用 ASP.NET 编写的，然后迁移到 Java（保留 .aspx 扩展名以与 SEO 兼容，并且可能不太深的后端层仍在 ASP.NET 中而不是 Java 中）。Main#page.aspx 没有后端语言的任何东西，但是对于 javascript，这只是一个前端功能（使用 JS 实现），可以由任何一种独立于后端语言来实现。

不太深的后端层，如果不清楚，是指最接近depresentation/UI/front-end层的后端特性层。与服务和数据层通信的人（这可能是 2007 年之后的 Java）

# windows - 如何拦截dll方法调用？

> ID：220515
> 
> 赞同：14
> 
> 时间：2008-10-21T01:49:31.033
> 
> 标签：windows, dll

如何拦截dll方法调用？

*   有哪些可用的技术？
*   只能在 C/C++ 中完成吗？
*   如何拦截所有正在运行的进程对给定dll的方法调用？
*   如何拦截从给定进程到给定dll的方法调用？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-21T02:51:35.557

我可以想到两种标准方法来做到这一点

*   DLL 导入表挂钩。
    为此，您需要解析 DLL 的 PE Header，找到导入表并写入您自己的函数的地址，而不是那里已经写入的地址。您可以保存原始函数的地址以便以后调用它。这篇[维基百科文章](http://en.wikipedia.org/wiki/Portable_Executable)的外部链接中的引用应该为您提供执行此操作所需的所有信息。

*   直接修改代码。找到您要挂钩的函数的实际代码并修改它的第一个操作码以跳转到您自己的代码。您需要保存那里的操作码，以便它们最终会被执行。这比听起来简单，主要是因为它已经由不少于 Microsoft 自己以[Detours 库](http://research.microsoft.com/sn/detours/)的形式实现。
    这是一件非常整洁的事情。例如，只需几行代码，您就可以替换 Outlook.exe 中对 GetSystemMetrics() 的所有调用，并观察发生的奇迹。

一种方法的优点是另一种方法的缺点。第一种方法允许您将手术钩子精确地添加到您想要的所有其他 DLL 未挂钩的 DLL 中。第二种方法允许你用最全局的钩子来拦截所有调用函数。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-21T02:38:48.110

如果您事先知道所有 DLL 函数，一种技术是编写您自己的包装 DLL，它将所有函数调用转发到真正的 DLL。此 DLL 不必用 C/C++ 编写。您需要做的就是匹配原始 DLL 的函数调用约定。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-21T12:06:37.013

有关具有 C/C++ API 的库，请参阅[Microsoft Detours 。](https://www.microsoft.com/en-us/research/project/detours/)在不触发病毒扫描程序/恶意软件检测器的情况下将其注入所有其他程序有点不重要。但你自己的过程是公平的游戏。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T01:55:30.663

在 Linux 上，这可以通过 LD_PRELOAD 环境变量来完成。将此变量设置为指向包含您要覆盖的符号的共享库，然后启动您的应用程序。

# python - 确保 Linux 中应用程序的单个实例

> ID：220525
> 
> 赞同：33
> 
> 时间：2008-10-21T01:58:30.580
> 
> 标签：python, linux, single-instance

我正在使用 WxPython 开发一个 GUI 应用程序，但我不确定如何确保在任何给定时间在机器上只运行我的应用程序的一个副本。由于应用程序的性质，多次运行没有任何意义，并且会很快失败。在 Win32 下，我可以简单地创建一个命名互斥体并在启动时检查它。不幸的是，我不知道 Linux 中有任何工具可以做到这一点。

如果应用程序意外崩溃，我正在寻找将自动释放的东西。我不想让我的用户因为崩溃而不得不手动删除锁定文件。

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2008-10-21T03:43:36.793

正确的做法是使用建议锁定`flock(LOCK_EX)`；在 Python 中，这可以在[`fcntl`模块](http://docs.python.org/3/library/fcntl.html)中找到。

与 pidfiles 不同，这些锁总是在您的进程因任何原因终止时自动释放，不存在与文件删除相关的竞争条件（因为*不需要*删除文件来释放锁），并且没有机会不同进程继承了 PID，因此似乎验证了一个陈旧的锁。

如果你想要不干净的关机检测，你可以在获取锁之后在文件中写入一个标记（例如你的PID，对于传统主义者），然后在干净关机之前将文件截断为0字节状态（同时持有锁); 因此，如果未持有锁且文件非空，则指示不正常关闭。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2008-10-21T08:30:11.147

`fcntl`使用模块的完整锁定解决方案：

```
import fcntl
pid_file = 'program.pid'
fp = open(pid_file, 'w')
try:
    fcntl.lockf(fp, fcntl.LOCK_EX | fcntl.LOCK_NB)
except IOError:
    # another instance is running
    sys.exit(1) 
```

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2008-10-21T02:10:24.143

有几种常见的技术，包括使用信号量。我看到最常用的一个是在启动时创建一个“pid 锁定文件”，其中包含正在运行的进程的 pid。如果程序启动时文件已经存在，打开它并抓取里面的 pid，检查是否有具有该 pid 的进程正在运行，如果是则检查 /proc/ *pid*中的 cmdline 值是否为你的程序的实例，如果它然后退出，否则用你的 pid 覆盖文件。pid 文件的通常名称是*application_name*`.pid`。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-01-24T15:20:51.833

wxWidgets 为此提供了一个 wxSingleInstanceChecker 类：[wxPython doc](http://www.wxpython.org/docs/api/wx.SingleInstanceChecker-class.html)或[wxWidgets doc](http://docs.wxwidgets.org/stable/wx_wxsingleinstancechecker.html)。wxWidgets 文档有 C++ 中的示例代码，但 python 等价物应该是这样的（未经测试）：

```
 name = "MyApp-%s" % wx.GetUserId()
  checker = wx.SingleInstanceChecker(name)
  if checker.IsAnotherRunning():
      return False 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2013-02-22T04:18:27.207

这建立在用户[zgoda的](https://stackoverflow.com/users/12138/zgoda)[答案](https://stackoverflow.com/a/221159/832230)之上。它主要解决了与锁定文件的写访问有关的棘手问题。特别是，如果锁定文件是由 最初创建的，则由于用户 没有写入权限，另一个用户将无法再成功地尝试重写此文件。显而易见的解决方案似乎是为每个人创建具有写入权限的文件。该解决方案还建立在我的不同[答案](https://stackoverflow.com/a/15015748/832230)之上，必须创建具有此类自定义权限的文件。这个问题在现实世界中很重要，您的程序可能由任何用户运行，包括.`root``foo``foo``root`

```
import fcntl, os, stat, tempfile

app_name = 'myapp'  # <-- Customize this value

# Establish lock file settings
lf_name = '.{}.lock'.format(app_name)
lf_path = os.path.join(tempfile.gettempdir(), lf_name)
lf_flags = os.O_WRONLY | os.O_CREAT
lf_mode = stat.S_IWUSR | stat.S_IWGRP | stat.S_IWOTH  # This is 0o222, i.e. 146

# Create lock file
# Regarding umask, see https://stackoverflow.com/a/15015748/832230
umask_original = os.umask(0)
try:
    lf_fd = os.open(lf_path, lf_flags, lf_mode)
finally:
    os.umask(umask_original)

# Try locking the file
try:
    fcntl.lockf(lf_fd, fcntl.LOCK_EX | fcntl.LOCK_NB)
except IOError:
    msg = ('Error: {} may already be running. Only one instance of it '
           'can run at a time.'
           ).format('appname')
    exit(msg) 
```

上述代码的一个限制是，如果锁定文件已经存在并且具有意外的权限，则这些权限将不会被更正。

我本来希望`/var/run/<appname>/`用作锁定文件的目录，但创建此目录需要`root`权限。您可以自行决定使用哪个目录。

请注意，无需打开锁定文件的文件句柄。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2016-01-07T16:04:31.957

这是基于 TCP 端口的解决方案：

```
# Use a listening socket as a mutex against multiple invocations
import socket
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.bind(('127.0.0.1', 5080))
s.listen(1) 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-21T02:10:53.550

[`semaphore.h`](http://www.opengroup.org/onlinepubs/007908799/xsh/semaphore.h.html)我相信，在-- `sem_open()`、等[中定义的函数集](http://www.opengroup.org/onlinepubs/007908799/xsh/semaphore.h.html)`sem_trywait()`是 POSIX 等价的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-21T02:39:56.533

在 unix 上寻找一个与 SYSV 信号量接口的 python 模块。信号量有一个 SEM_UNDO 标志，如果进程崩溃，它将导致进程持有的资源被释放。

否则，正如伯纳德建议的那样，您可以使用

```
import os
os.getpid() 
```

并将其写入 /var/run/ *application_name* .pid。当进程启动时，它应该检查 /var/run/ *application_name* .pid 中的 pid 是否在 ps 表中列出，如果是则退出，否则将自己的 pid 写入 /var/run/ *application_name* .pid。下面的 var_run_pid 是您从 /var/run/ *application_name* .pid读取的 pid

```
cmd = "ps -p %s -o comm=" % var_run_pid
app_name = os.popen(cmd).read().strip()
if len(app_name) > 0:
    Already running 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-21T02:08:17.953

如果您创建一个锁定文件并将 pid 放入其中，您可以对照它检查您的进程 id 并判断您是否崩溃了，不是吗？

我没有亲自这样做过，所以服用适量的盐。:p

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-21T02:09:29.027

您可以使用“pidof”实用程序吗？如果您的应用程序正在运行，pidof 会将您的应用程序的进程 ID 写入标准输出。如果不是，它将打印一个换行符 (LF) 并返回一个错误代码。

示例（来自 bash，为简单起见）：

```
linux# pidof myapp
8947
linux# pidof nonexistent_app

linux# 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-21T02:10:09.963

到目前为止，最常用的方法是将一个名为 [application].pid 的文件放入 /var/run/ 中，该文件仅包含正在运行的进程或父进程的 PID。作为替代方案，您可以在同一目录中创建一个命名管道，以便能够向活动进程发送消息，例如打开一个新文件。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-18T05:41:36.210

当您希望能够将后续尝试实例的命令行参数传递给第一个实例时，我已经为运行这些类型的应用程序创建了一个基本框架。如果一个实例没有找到一个已经在监听的实例，它就会开始监听一个预定义的端口。如果实例已经存在，它会通过套接字发送其命令行参数并退出。

[带解释的代码](http://dwiel.net/blog/single-instance-application-with-command-line-interface/)

# svn - 从 StarTeam 5 迁移到 Subversion 的策略？

> ID：220527
> 
> 赞同：6
> 
> 时间：2008-10-21T01:59:35.117
> 
> 标签：svn, version-control, migration, starteam

我需要将一个大型项目从 StarTeam 5 迁移到 Subversion，并且我想保留（至少）5-10 个主要版本的快照。我考虑了以下几点：

*   每个快照的手动或脚本导出/导入。优点：简单，易于选择标记/日期版本。缺点：耗时，不保存评论。
*   Polarion 提供了似乎是 svnimporter 中完美的工具，但它需要 StarTeam 8.0 中的 .jar 文件，而 StarTeam 5 中没有。优点：自动化、完整。缺点：需要升级到 StarTeam 8.0 才能一次性使用。
*   通过一些中间存储库迁移（*例如*StarTeam -> CVS -> Subversion）。我还没有找到任何与 StarTeam 合作的中介。
*   仅迁移最新的源。优点：简单、快速，鼓励开发人员发明新的解决方案而不是重复历史。缺点：鼓励开发人员发明新的解决方案，而不是重复历史。:-)

我将不胜感激您可能提供的任何经验或建议。谢谢你。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-05T08:05:29.073

您可以在评估期（30 天？）内运行 Star Team 服务器，而无需从 Borland 获得额外许可——这将给您充足的时间来运行一些练习运行，并为您提供完整、可靠的解决方案。非常值得努力。

此外，不要低估保留源历史记录的价值。

11 月 6 日更新：我参与的一个项目使用 Polarion 工具将单个 StarTeam 项目迁移到 SVN。花了一点功夫，但最终的结果是完美的。非常值得花时间投资。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-11T14:58:57.660

关于 StarTeam 版本的评论：是的，Polarion SVNImporter 工具确实需要 starteam80.jar，是的，StarTeam SDK 2005 只有一个名为 starteam70.jar 的文件。但是我发现您可以通过将starteam70.jar 复制到SVNImporter lib 目录并将其重命名为starteam80.jar 来作弊。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-21T02:21:03.590

由于没有使用过 StarTeam，我无法对此发表评论——但我认为您已经提出了一些不错的选择。

1.  脚本导入似乎很耗时，并不能真正为您提供一切，但同时，它是进入 svn 并仍然保留您的发布历史的可靠方式。
2.  之后升级和丢弃安装的真正缺点是什么？需要重新购买软件吗？这是一个乏味的升级吗？除此之外，听起来这可能只是最好的选择。
3.  我真的会远离这个选项。cvs -> svn import 非常不稳定（真的，这是一次性的事情，可能没有多少人致力于它足以真正关心使其完美）。从另一个 SCM 系统转到 cvs，然后转到 svn，这听起来像是无用历史数据和挫折的秘诀。:) 我只做过几次，实际上，最好的部分是一旦你完成了，你就在 svn 中，再也不会接触 cvs。
4.  这个选项确实很烂。你失去了所有的历史......不能再*责怪*其他开发者把事情搞砸了......不过从好的方面来说，如果一切都失败了，它绝对会奏效。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-07T15:15:12.667

我正在努力使用 Polarion 套件将 StarTeam 8 迁移到 SVN。我越来越：

[main] DEBUG STProvider:80 - checkout ...relative/path/to/build.xml 版本：1.0 09:25:10,378

[主要] 信息历史记录器：84 - 异常发现：java.lang.UnsatisfiedLinkError：com.starbase.util.NativeFileAccess.setLastModifiedAsLong(Ljava/lang/String;J)V

并且目标文件存在，但我怀疑它无法解析相对路径。你知道是否有可以设置来控制它的属性（除了 config.properties 文件中的属性）吗？

# messaging - Tibco 和 Windows 进程激活

> ID：220540
> 
> 赞同：2
> 
> 时间：2008-10-21T02:09:31.883
> 
> 标签：messaging, tibco, wpas

我正在考虑如何扩展用托管代码（在本例中为 C#）编写的 Tibco EMS 队列侦听器。我正在寻找主要的隔离和聚类特征。

在 MSMQ 中，我可以使用 Windows Process Activation Service 来托管和管理队列侦听器的数量和生命周期。是否有 Tibco 等价物？

否则我怀疑我最终会得到一个简单的 NT 服务来托管 EMS 侦听器。（它反过来可以执行进程激活）。构建一个 24x7 可监控、强大的生产服务是可行的，但相当棘手。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-02-28T07:45:55.707

如果我正确理解您的问题，那么 TIBCO 等效项是[TIBCO ActiveMatrix Service Grid](http://www.tibco.com/products/soa/composite-applications/activematrix-service-grid/default.jsp)。它支持 C# 服务容器，并且可以托管和管理您的 C# 侦听器。

将此与[TIBCO ActiveMatrix Service Performance Manager](http://www.tibco.com/products/soa/governance/activematrix-spm/default.jsp)结合使用，您可以让它在高负载情况下自动部署和启动更多实例到更多节点。

# sql - 用于格式化 SQL 查询的免费软件或脚本

> ID：220545
> 
> 赞同：4
> 
> 时间：2008-10-21T02:11:04.453
> 
> 标签：sql, code-formatting

我正在寻找整理和重新格式化 SQL 查询的脚本或应用程序。我找到了一些不错的在线 SQL 格式化程序（请参阅[此处](http://www.wangz.net/gsqlparser/sqlpp/sqlformat.htm)），以及一些可下载的商业应用程序。我对使用在线服务持谨慎态度，因为我不想冒险将这些查询的副本存储在可能会受到损害的地方，即使只是在 Web 服务器的缓存中（这违反了我雇主的政策）。

有谁知道任何可以帮助我解决这个问题的开源应用程序、脚本或可下载的免费软件？

可能值得一提的是，我在工作中使用的是 Windows 平台，但我对其他操作系统的建议持开放态度。

干杯!

**更新**

我已经按照 Vinko Vrsalovic 的建议使用了 SQLInform，效果非常好。谢谢文科！

值得关注的还有[SQLTidy](http://code.google.com/p/sqltidy/)，这是一个关于谷歌代码的年轻项目，从长远来看它可能会变成伟大的东西。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T02:52:07.243

一些可以尝试的东西（SQLinForm 在 2009 年之前是免费的）。奇怪的是，一些利基市场完全缺乏好的开源工具。

[http://www.trialpay.com/checkout/?c=bb7014d&tid=6rGUpGo](http://www.trialpay.com/checkout/?c=bb7014d&tid=6rGUpGo)

[http://www.sqlinform.com](http://www.sqlinform.com)

[http://www.fileheap.com/software-universal-sql-editor-download-11096.html](http://www.fileheap.com/software-universal-sql-editor-download-11096.html)

一个 Emacs 宏：

[http://www.emacswiki.org/emacs-en/tsql-indent.el](http://www.emacswiki.org/emacs-en/tsql-indent.el)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T22:55:22.930

别的东西......这个免费软件工具适用于 PL/SQL，所以也许那里有它的用途。

~~PL/SQL 整洁~~（断开的链接）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T02:13:00.270

Red Gate SQL Refactor（试用版）+ 虚拟机

# java - java中的可打印字符

> ID：220547
> 
> 赞同：36
> 
> 时间：2008-10-21T02:12:05.823
> 
> 标签：java, unicode, non-printing-characters

有谁知道如何检测java中的可打印字符？

过了一会儿（试验/错误）我得到了这个方法：

```
 public boolean isPrintableChar( char c ) {
        Character.UnicodeBlock block = Character.UnicodeBlock.of( c );
        return (!Character.isISOControl(c)) &&
                c != KeyEvent.CHAR_UNDEFINED &&
                block != null &&
                block != Character.UnicodeBlock.SPECIALS;
    } 
```

我通过 KeyListener 获取输入，然后 Ctr-'key' 打印了一个正方形。有了这个功能似乎还算够用。

我在这里错过了一些字符吗？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-01-06T23:07:05.243

这似乎是“字体”独立的方式。

```
public boolean isPrintableChar( char c ) {
    Character.UnicodeBlock block = Character.UnicodeBlock.of( c );
    return (!Character.isISOControl(c)) &&
            c != KeyEvent.CHAR_UNDEFINED &&
            block != null &&
            block != Character.UnicodeBlock.SPECIALS;
} 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-10-21T08:02:15.493

我不确定我是否理解你的问题。但是，如果您想检测是否可以将字符绘制到 Graphics 对象，并且如果不能打印一些占位符字符，您可能会发现有用：

```
Font.canDisplay(int) 
```

它将检查字体是否可以显示特定的代码点（更多的是检查字体是否可显示——因为有些字符是可显示的——比如ą——但有些字体不能显示它们。

# vbscript - Word 宏错误消息

> ID：220560
> 
> 赞同：0
> 
> 时间：2008-10-21T02:18:37.357
> 
> 标签：vbscript, ms-word

我正在更改文档模板宏。我不知道该怎么做的一件事是自定义错误消息。例如，文档中的错误消息是

“错误！未找到图表条目”

我想更改它以显示其他内容。是否可以使用 Word VBA 或 VBScript 执行此操作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T09:05:05.960

> 是否可以将其放入某种全局错误处理程序中？– 克雷格

有可能的。这是一个非常粗略的例子。

在标准模块中：

```
Sub HandleErr(ErrNo As Long)
    Select Case ErrNo
    Case vbObjectError + 1024
        MsgBox "No table of figures entries found.", vbOKOnly + vbCritical

    Case vbObjectError + 1034 To vbObjectError + 4999
        MsgBox "Still no table of figures entries found.", vbOKOnly + vbCritical

    Case Else
        MsgBox "I give up.", vbOKOnly + vbCritical, _
            "Application Error"
    End Select
End Sub 
```

一些代码：

```
Sub ShowError()
Dim i As Integer

On Error GoTo Proc_Err

    'VBA Error
    i = "a"

    'Custom error
    If Dir("C:\Docs\TableFigs.txt") = "" Then
        Err.Raise vbObjectError + 1024
    End If

Exit_Here:
    Exit Sub

Proc_Err:
    If Err.Number > vbObjectError And Err.Number < vbObjectError + 9999 Then
        HandleErr Err.Number
    Else
        MsgBox Err.Description
    End If
End Sub 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T02:29:13.013

如果要在 VBA 中捕获特定的错误类型，一种方法是使用 On Error Resume Next 然后在要捕获的操作之后的行上测试错误消息，例如：

```
On Error Resume Next
' try action
If Err.Number <> 0 Then
  ' handle w/ custom message
  Err.Clear
End If 
```

如果您知道确切的错误编号 ( `If Err.Number = N Then`)，那当然会更好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T02:32:00.543

好吧，如果您正在谈论拥有一个自定义消息框 - 这很容易。在 VBA 帮助中查找“msgbox”以获得更好的信息。

```
Msgbox("Error! No table of figures entries found",16,"Error") 
```

16 使其成为“关键”信息。

如果您正在谈论错误捕获，那么您将需要这样的代码：

```
On Error Resume Next
n = 1 / 0    ' this causes an error
If Err.Number <> 0 Then 
    n = 1
    if Err.Number = 1 Then MsgBox Err.Description
End If 
```

当抛出错误时，会为 Err 对象提供一个数字和描述。

# proxy - 什么是好的 Linux 代理服务器可以让我通过它进行连接？

> ID：220574
> 
> 赞同：0
> 
> 时间：2008-10-21T02:29:55.413
> 
> 标签：proxy, squid

我想在 Fedora Core 4 上设置一个代理服务器。知道哪些可能很容易设置吗？我想通过该服务器连接并从我的 ISP 接收 IP 地址，因为我的 apache 服务器上有 IP 地址过滤。

Squid 是一种选择，但我不确定设置的难易程度。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T04:05:27.857

如果您对 apache 足够熟悉，则可能更容易将其设置为代理 ( [mod_proxy](http://httpd.apache.org/docs/2.0/mod/mod_proxy.html) )。如果你想要一个专用代理，squid 可能更健壮。

# ruby-on-rails - 单表继承发现问题

> ID：220584
> 
> 赞同：3
> 
> 时间：2008-10-21T02:34:42.613
> 
> 标签：ruby-on-rails, ruby, inheritance

我有以下 3 个 rails 类，它们都存储在一个表中，使用 rails 的单表继承。

```
class Template < ActiveRecord::Base
class ThingTemplate < Template
class StockThingTemplate < ThingTemplate 
```

如果我有一个`StockThingTemplate`ID ，`150`那么我在逻辑上应该能够做到这一点：

```
ThingTemplate.find(150)
=> #returns me the StockThingTemplate 
```

事实上，这*有时是有效的*

当它工作时，它会生成以下 SQL 查询：

```
SELECT * FROM templates WHERE (templates.`id` = 159) AND ( (templates.`type` = 'ThingTemplate') OR (templates.`type` = 'StockThingTemplate' ) ) 
```

当它不起作用时，它会生成以下 SQL 查询：

```
SELECT * FROM templates WHERE (templates.`id` = 159) AND ( (templates.`type` = 'ThingTemplate') ) 
```

sql 正在做它应该做的事情，但问题是，为什么它一次生成一组 SQL，而另一次生成另一组不同的 SQL。它实际上是完全相同的代码。

笔记：

*   我在轨道上 1.2
*   我已经`require 'stock_thing_template'`在不同的地方尝试过。它要么没有效果，要么导致其他问题

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-21T02:53:08.690

好的。原来这是因为 rails 并不总是看到整个继承层次结构。由于它在每个请求上重新加载所有项目，这解释了不一致的行为（在某些地方，before_filter 可能导致模型加载，在其他地方可能不会）。

它可以通过放置来固定

```
require_dependency 'stock_thing_template' 
```

在我所有引用这些东西的控制器的顶部。

[有关 rails wiki 的更多信息](http://wiki.rubyonrails.org/rails/pages/SingleTableInheritance)- 转到页面底部

# sql-server - 我如何说服某人他们需要从 ms 访问升级到 sql server 或类似

> ID：220585
> 
> 赞同：8
> 
> 时间：2008-10-21T02:35:25.590
> 
> 标签：sql-server, ms-access

我在与一位痴迷于 ms 访问的根深蒂固的开发人员一起工作时遇到了一个真正的问题。用户抱怨随机崩溃、锁定错误、冻结、应用程序变慢（尤其是在 2007 年），但似乎对移动它非常抗拒。大多数时候，他们责怪计算机并且不能相信它是一个 mdb 位于网络驱动器上的事实，而与他们面前的硬件无关，这是全新的。

有一个前端 vb 程序挂在它上面，但我认为调整不会超过几周，事实上我可能会重新编写它，因为它每年都有来自以前开发人员的混乱代码。

说服他们我们需要移动它的最佳论据是什么？

有没有其他人对卡在他们的方式中的开发人员有类似的问题？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-21T02:50:14.280

**随机，崩溃，锁定错误，冻结，减速**（原文如此）怎么样。

在网上快速搜索会发现一些有用的材料：

*   [在多用户环境中使用 Microsoft Office Access 2003 时的最佳实践](http://msdn.microsoft.com/en-us/library/aa167840.aspx)- 如果此处的更改无法实施，或者需要有效地进行重写，那么这是正确执行此操作的好弹药。
*   [SQL Server 与 MS Access](http://www.mssqlcity.com/Articles/Compare/sql_server_vs_access.htm) - 特别注意功能限制。例如，一个访问数据库中只能有 32,000 个对象。警告：虽然它说 255 个并发用户，这可能是一个技术限制，但实际限制确实要低得多。

很难说服那些不愿意学习和不接受新想法的人。你可以继续讨论速度问题、并发问题、安全问题……但最终，有些人永远不会听。越过他们的头顶。用这十年的工具重写它并展示出来。拒绝参与项目和进一步。我不知道政治局势如何，但从技术上讲，根据您的描述，MS 访问对于您所做的事情是错误的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-21T03:05:03.923

周末进来，将数据库复制到sql server，将应用程序的连接字符串更改为sql server，重新测试应用程序，然后卸载ms-access ...无处不在。

然后*什么都别说*，让他认为问题“自己解决了”，用户仍在使用 ms-access

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-21T03:09:12.370

对我来说，这取决于您拥有多少并发用户以及数据库有多大。如果您有超过 5 个并发用户，那么您应该考虑使用数据库服务器。网络流量开始失控，您添加的每个并发用户都会变得更糟。

多年来，我创建了可靠的基于访问的系统。如果您遇到随机崩溃、锁定问题和减速，那么您做的事情不对。在访问中创建应用程序时，我通常会有一个本地 mda 和网络上的 mdb。要获得良好的性能，关键是要优化适当的索引和查询以获取您需要的数据。无论是使用单独的应用程序、访问权限还是针对 sql server 运行的某些应用程序，您都需要积极地正确处理记录锁定。您不能只是盲目地让访问锁定您的记录。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-24T20:31:36.310

忘记关于 DB 大小的争论吧，在我听到的 90% 的案例中，转向客户端-服务器平台是一个不知情的理由。

您最好的论点是基于在低技术水平上解释的功能：（1）您可以在不踢出用户的情况下备份和执行数据库维护（这会带来代价高昂的停机时间）。

(2) 如果数据被意外删除/损坏或损坏，恢复速度更快。同样，风险更低，停机时间更短。这始终是业务案例的良好基础。

(3) 如果（且仅当）您预计需要进行相当大的扩展，升级将更好地实现这一点。

(4) 如果您需要运行自动化作业/更新，SQL 可以更优雅地完成此操作。

记住 SQL 的禁忌症，很容易让你在这个平台上与那个平台上的技术高大上，但你必须在收益与成本之间取得平衡。SQL 的维护成本要高得多，因为它需要专用硬件、昂贵的许可证（服务器操作系统和数据库），并且通常至少需要一个兼职 DBA，这将花费您最低 75,000 美元（如果您运气好的话）来自爱荷华州波登克）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-21T03:56:18.563

我能给你的最好的建议是确保你有一个良好的态度，并且被认为是一个做高质量工作并把事情做好的人。听起来你无法控制这种情况，所以你需要的是影响力。

以您建议的方式找到解决问题的方法（可能是对相关人员威胁较小的不同问题）。让它工作得非常快速和完美。让它运作良好，以至于人们在需要完成某事时开始要求你。快速完成它，您应该能够做到这一点，因为您将使用正确的工具来完成这项工作。

做一个可以共事的好人，而不是知道其他人应该如何编写代码的 PITA。能够回答您可能会采取哪些不同的做法以及原因，但不要自动假设您的想法总是最好的。也许有一些你不知道的权衡 - 额外 CAL 的预算中没有钱，我们有另一个需要首先完成的应用程序。这听起来不像你的情况，但是在提出建设性的批评之前寻找机会去理解可以大大帮助人们接受。

另一件事是，这可能与情况的技术方面无关，而与其他开发人员的不安全感有关。“这就是我所知道的。如果我们改变它，我不会理解它，然后我会在哪里。” 寻找帮助其他人成长的方法——当他遇到问题时，找到可以帮助他开发好的技术解决方案的资源。建议您部门中的每个人都接受一些新技术培训。谁知道呢，一门很好的 SQL Server 课程，这个人可能会成为组织中的 SQL Server 传道者，因为现在这就是他所知道的。

最后，可以这么说，知道何时减少损失。如果您发现自己对这种情况无能为力，请不要增加抱怨。继续做一些你可以控制的事情，并尽可能做好。也许在未来你会处于一个你确实可以控制或影响这种情况的位置，并且可以做一些事情。如果你发现你所在的公司比大多数人都更不正常，那就想办法搬到一个环境更好的地方。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-30T22:03:12.937

在仍将 Access 应用程序用作前端的同时，可以将 Access 数据库转换为在 SQL Server 中具有表/视图，而且实际上相当容易。

从那里开始，您痴迷于 Access 的开发人员仍然可以享受所有 VBA 代码的乐趣。同时，在后端，您添加索引等以加快速度。也许有一天你会走运，他会询问存储过程。那么，应用程序只是一个前端，谁在乎它是用什么写的呢？您的数据在 SQL Server 中是安全的。

您可以自己执行此操作，但只需离开生产应用程序 ALOOOOOOOOOOOONE。拿一份副本，然后转换该副本。然后，为几个用户托管它以测试驱动器.. 使您的 Access 应用程序版本以大红色字母显示“TEST APP”。如果您的开发人员问您在做什么，您可以说实话——您正在测试以查看仅转换表格/视图是否可能对整个应用程序有所帮​​助。

这样，您可以两全其美，让您的开发人员开心，让用户更开心（希望如此），如果您做得对，您的老板会知道您用您的技术实力和成熟度处理了一个棘手的人事问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-21T02:43:04.500

我曾经和一个我会毫不犹豫地称之为完全白痴的人遇到过类似的问题。

无法让他们相信访问问题。最后，强行解决问题比“好”地做起来容易，善良是残酷的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-21T02:46:07.723

如果他们反抗，那么你总是可以超越他们的头脑。管理层必须意识到崩溃和稳定性相关问题。向他们提出提高稳定性的计划，他们可能至少会倾听。然后他们可能会希望与所有开发人员开会讨论，因此请携带大量弹药进行讨论。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-21T06:43:38.990

除了“如何说服他们”，让我们来谈谈“如何在没有人注意的情况下做到”！

首先，我建议您不要将代码优化问题和 SQL 服务器问题混为一谈。当错误与其他事情相关时，不要给用户抱怨 SQL 的机会。

如果您的代码实在难以忍受，请在切换到 SQL 之前重写应用程序，牢记以下几点，以使最终过渡到 SQL Server 对最终用户完全透明。

这是我们 18 个月前所做的，我相信我们仍然有用户认为我们的数据库是 Access：

1.  通过可用的访问向导将当前访问数据库导出到 SQL 以进行测试（可能会出现许多问题，您可能需要另一个工具，例如[此处](http://www.ssw.com.au)提出的工具）。
2.  在应用层创建唯一的连接对象，让你可以随时从Access自由切换到SQL（在开发层，你甚至可以在启动时添加一个输入框询问使用哪个连接）。我们选择了一个 ADODB 连接对象，但它也适用于 ODBC 连接。
3.  如果您使用 SQL 语法更新表，请确保所有 SELECT、INSERT、UPDATE 和 DELETE 都使用此连接。如果您使用记录集，请确保所有这些都在打开时使用此连接。
4.  需要时，通过添加“SELECT CASE”`type_Of_TheConnexion`选项更新所有连接特定代码
5.  切换到 SQL 连接 ..并调试直到完成！

您会发现的问题主要与 SQL 语法有关，其中 MSSQL 使用 ' 而不是 " 和 # 作为分隔符。日期格式也是一个问题，其中标准 SQL 格式是 'YYYYMMDD' 而 MS-Access 格式取决于计算机本地情况（注意从日期到字符串的转换！）并存储为“YYYY-MM-DD”（如果我记得...）。SQL 中的布尔值是 0 和 1，而在 Access 中它们是 True/False 或 0/-1。 ..

测试，更新代码，当你没问题时，进行新的数据传输，将你的应用程序锁定在 SQL 连接上，并分发一个新的运行时。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-23T14:59:27.040

这取决于应用程序的类型和数据库的数据负载，但 Access 非常高效，即使在网络上也是如此。
根据您的用户处理的数据量，您可以轻松地将网络上的用户扩展到 100 个用户，只需使用来自和后端的 Access 数据库。

看起来你的情况可能需要重写。如果您的应用程序是以数据为中心的，如果在 VB6 中开发它没有多大意义：Access 提供的工具比您能够制作的任何工具都要好得多，尤其是在考虑 Access 2007 时。

只有在遇到以下问题时才真正需要升级到 SQL Server：

*   **安全性**：
    您需要确保只有权限用户才能访问数据。您可以在 Access 中实现自己的安全性，但它永远不会像 SQL Server 那样强大。
*   **可扩展性**：
    您正在处理大量数据和复杂查询或大量用户，最好有专用硬件来处理客户端的负载。但问题在于，在消除能力较弱的客户端机器的压力的同时，您向服务器添加了更多内容。
*   **完整性**：
    由于后端数据库只是一个需要对所有连接的客户端进行 R/W 访问的文件，因此总是有可能有人会做坏事，或者客户端可能会崩溃并导致数据库损坏。

如果您的用户数量是平均的（我会说 30），那么可能没有真正需要升级：

*   使用 MS Access 2007 开发您的应用程序，然后只需在所有客户端计算机上使用 MS Access 2007 运行时（它是免费的！）即可获得更现代的用户界面（使用功能区，并且与以前的版本相比有许多 UI 增强）。
    你不能成为那个解决方案的便宜：你只需要完整的零售版 MS Access，其余的都是免费的，无论用户数量如何！
*   不要认为迁移到 SQL Server 会提高查询的性能：MS Access 通常会更好地为您优化查询（它知道需要显示什么并进行大量缓存和优化）。
*   确保您在任何时候只编辑少量数据（不要使用动态集查询只是为了在数据表中显示大量数据；改用快照并在必要时打开仅包含要编辑的数据的详细信息表单。
*   在本地缓存复杂的查询。
    构建了一些缓存机制，可以在本地机器上留下复杂查询结果的副本。性能上的提升非常惊人，如果查询没有太大变化（例如股票操作日志），您可以在本地保留复杂/大查询并根据需要附加新记录。

还有很多话要说。

底线是：您可能正在考虑重写，但不要因为您当前的应用程序编写不佳而将 Access 视为解决方案。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-21T02:38:52.837

尝试进行基准测试并向他展示统计数据

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-21T02:43:19.130

让人们改变有时会让人头疼。

我不得不说主要论点将具有稳定性和速度，但是当然就像您所说的那样，他们已经知道这一点仍然不会动。
要尝试的另一件事是向他们展示 LINQ to SQL 的强大功能以及它将使您的应用程序变得多么清洁。就像 Daniel Silveira 说的那样，你可以尝试在那里抛出一些统计数据，看看他们是否信服。

我们有一个使用 MS 访问作为后端的应用程序构建，我等不及要获得新的 SQL 服务器，所以我可以将所有内容移至该服务器。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-21T02:44:25.930

您可以向他展示比较两者的性能结果，但如果他真的按照自己的方式设置并且拒绝改变，那么除了以某种方式强迫他之外，您无能为力。

如果您是他的老板，那么只需强迫他将其更改为使用 SQL。如果没有，那么通过向他展示性能结果来说服你的老板强制改变，并解释它会解决你遇到的问题。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-21T03:15:59.953

Errr，离开团队？你似乎与完全错误的一群人一起工作。现在，如果团队是您的公司，那么您与错误的公司合作。

当然，一旦你离开公司，你可以告诉你的客户，你可以自己解决网络问题，让他们也离开公司。然后给他们一个可以在 SQL Server Express 上运行的改进系统。

# database-design - 有什么好的MySQL数据库设计软件？

> ID：220601
> 
> 赞同：9
> 
> 时间：2008-10-21T02:47:29.233
> 
> 标签：database-design

如上。通常在工作中由其他人进行数据库设计，而当我进行个人项目时，它们足够小，实际上不需要超过五六张表，但我即将开始一个我认为可能需要十一点左右的个人项目或十二张桌子，我想要一些东西来帮助我整齐地设计它并跟踪它。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-21T02:50:10.083

[MySQL Workbench](http://dev.mysql.com/workbench/)虽然有点小问题，但自从我发现它以来，它对我来说是无价的。

[Visio](http://office.microsoft.com/en-us/visio/default.aspx)有一个很好的可视化数据库设计器，但它不能将结果导出到 MySQL 数据库，并且只是 windows。

[phpMyAdmin](http://phpmyadmin.net/)还有一个[设计器工具，如果您正确配置了](http://wiki.cihar.com/pma/designer)[pma 数据库](http://wiki.cihar.com/pma/pmadb)，就可以使用它。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-25T19:02:15.450

**mysql结合记事本**（和铅笔）

我是认真的，伙计们。除非您可以编写原始 Sql，否则您不会了解数据库。

当我准备好对数据库进行编程时，我已经很清楚要放入其中的内容了。我将声明写入编辑器（我使用比记事本更强大的东西，但记事本就足够了。），然后将它们剪切并粘贴到 mysql 提示符中。如果有错误，我修复命令行或文本文件，然后更新另一个。经常保存是有保证的。

这种方法的美妙之处在于，文本文件既可用作设计文档，又可用作重新创建数据库的模板。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T10:50:06.220

Navicat 是迄今为止最好的 MySQL 管理工具。
基于桌面，但你有一个“隧道”php 文件来连接到不允许远程 mysql 连接的服务器。
[www.navicat.com](http://www.navicat.com)，不是免费的，但非常棒！（也适用于 Oracle 和 PostGre）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-25T18:31:39.410

我已经使用了很多，并审查并[链接](https://stackoverflow.com/questions/40902/looking-for-mysql-ide#41381)了它们。现在虽然我是一个彻头彻尾的[Sqlyog](https://stackoverflow.com/questions/36551/mysql-shell-on-windows#37457)粉丝，但我将不得不同意上面的[Shabbyrobe](https://stackoverflow.com/questions/220601/what-is-some-good-software-for-designing-mysql-databases#220604)并说[Mysql Workbench](http://dev.mysql.com/workbench/)它提供了一个清晰易用的图形用户界面，允许您同时执行 ERM 和 sql 脚本时间。它确实有与 Sqlyog 相同的缺点，因为对于真正有趣的东西，你需要付费。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-28T10:38:55.107

试试 SchemaBank，一个基于 Web 的，无需在您的机器上安装任何东西。我相信他们有可用的免费帐户。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-28T11:11:10.297

也许可以采用不同的方法为您的应用程序设计域对象，并为您创建数据库。

这种设计模式称为“数据持久性”，人们使用多种工具，例如 Hibernate（或 NHibernate，是 .net 的替代品）或 xpodatasource 等等。通过数据持久性，您有动力为手头的应用程序设计、声明甚至绘制您需要的对象（书籍、音乐会、项目、用户）以及它们之间的关系。可以为您生成一个数据库及其表，包括索引等等。

一开始可能很难破解，但它可以帮助您满足日常需求。

抱歉，如果这不是您问题的解决方案。谷歌了解休眠。我仍然感谢让我对数据持久性产生兴趣的人。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-04-27T10:49:57.950

你也可以使用 ORM Designer 来设计你的模型。如果您使用 ORM Designer 支持的任何 ORM 框架（Propel、Doctrine、CakePHP、...），您可以将模型导出到模式定义文件。

[http://www.orm-designer.com](http://www.orm-designer.com)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-04T06:24:48.143

MySQL Workbench 在 MacOS、Fedora、Ubuntu、Windows 上可用。

WB 5.1 专注于数据建模（取代 Mike Zinner 流行的 DBDesigner 产品）。

WB 5.2（2009 年 4 月发布）将包括对 MySQL 查询浏览器的彻底重写。

[http://forums.mysql.com/index.php?151](http://forums.mysql.com/index.php?151)

# javascript - 是否有使用 javascript 生成 html 的最佳实践

> ID：220603
> 
> 赞同：111
> 
> 时间：2008-10-21T02:48:57.637
> 
> 标签：javascript, html, ajax, dynamic, dhtml

我正在调用一个以 JSON 格式返回对象数组的 Web 服务。我想获取这些对象并用 HTML 填充一个 div。假设每个对象都包含一个 url 和一个名称。

如果我想为每个对象生成以下 HTML：

```
<div><img src="the url" />the name</div> 
```

对此有最佳做法吗？我可以看到几种方法：

1.  连接字符串
2.  创建元素
3.  使用模板插件
4.  在服务器上生成 html，然后通过 JSON 提供服务。

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2008-10-21T03:01:27.723

选项 #1 和 #2 将是您最直接的直接选项，但是，对于这两个选项，您将通过构建字符串或创建 DOM 对象来感受到性能和维护的影响。

模板并不是那么不成熟，你会在大多数主要的 Javascript 框架中看到它弹出。

[这是JQuery Template Plugin](http://api.jquery.com/jQuery.template/)中的一个示例，它将为您节省性能损失，并且非常非常简单：

```
var t = $.template('<div><img src="${url}" />${name}</div>');

$(selector).append( t , {
     url: jsonObj.url,
     name: jsonObj.name
}); 
```

我说走很酷的路线（性能更好，更易于维护），并使用模板。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-20T09:43:43.603

如果您绝对必须连接字符串，而不是正常的：

```
var s="";
for (var i=0; i < 200; ++i) {s += "testing"; } 
```

使用临时数组：

```
var s=[];
for (var i=0; i < 200; ++i) { s.push("testing"); }
s = s.join(""); 
```

使用数组要快得多，尤其是在 IE 中。不久前，我用 IE7、Opera 和 FF 对字符串进行了一些测试。Opera 只用了 0.4s 就完成了测试，而 IE7 却在 20 分钟后没有完成！！！（不，我不是在开玩笑。） 用数组 IE 非常快。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-21T02:56:01.947

前两个选项中的任何一个都是常见且可接受的。

[我将在Prototype](http://prototypejs.org/)中给出每个示例。

```
// assuming JSON looks like this:
// { 'src': 'foo/bar.jpg', 'name': 'Lorem ipsum' } 
```

方法#1：

```
var html = "<div><img src='#{src}' /> #{name}</div>".interpolate(json);
$('container').insert(html); // inserts at bottom 
```

方法#2：

```
var div = new Element('div');
div.insert( new Element('img', { src: json.src }) );
div.insert(" " + json.name);
$('container').insert(div); // inserts at bottom 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-21T03:32:35.693

这是一个示例，使用我的 jQuery**[简单模板](http://code.google.com/p/jquery-simple-templates/)**插件：

```
var tmpl = '<div class="#{classname}">#{content}</div>';
var vals = {
    classname : 'my-class',
    content   : 'This is my content.'
};
var html = $.tmpl(tmpl, vals); 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2014-05-15T06:25:30.963

也许更现代的方法是使用诸如[Mustache](https://github.com/janl/mustache.js)之类的模板语言，它具有多种语言的实现，包括 javascript。例如：

```
var view = {
  url: "/hello",
  name: function () {
    return 'Jo' + 'hn';
  }
};

var output = Mustache.render('<div><img src="{{url}}" />{{name}}</div>', view); 
```

您甚至可以获得额外的好处 - 您可以在其他地方重用相同的模板，例如服务器端。

如果你需要更复杂的模板（if语句、循环等），你可以使用[Handlebars](http://handlebarsjs.com/)，它有更多的功能，并且兼容Mustache。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-21T22:32:57.560

您可以将模板 HTML 添加到隐藏 div 中的页面，然后使用 cloneNode 和您喜欢的库的查询工具来填充它

```
/* CSS */
.template {display:none;}

<!--HTML-->
<div class="template">
  <div class="container">
    <h1></h1>
    <img src="" alt="" />
  </div>
</div>

/*Javascript (using Prototype)*/
var copy = $$(".template .container")[0].cloneNode(true);
myElement.appendChild(copy);
$(copy).select("h1").each(function(e) {/*do stuff to h1*/})
$(copy).select("img").each(function(e) {/*do stuff to img*/}) 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2015-04-03T14:43:00.063

披露：我是 BOB 的维护者。

### 有一个名为[BOB](https://github.com/stephan-nordnes-eriksen/BOB)的 javascript 库可以让这个过程变得更容易。

对于您的具体示例：

```
<div><img src="the url" />the name</div> 
```

这可以通过以下代码使用 BOB 生成。

```
new BOB("div").insert("img",{"src":"the url"}).up().content("the name").toString()
//=> "<div><img src="the url" />the name</div>" 
```

或者使用更短的语法

```
new BOB("div").i("img",{"src":"the url"}).up().co("the name").s()
//=> "<div><img src="the url" />the name</div>" 
```

这个库非常强大，可用于创建带有数据插入的非常复杂的结构（类似于 d3），例如：

```
data = [1,2,3,4,5,6,7]
new BOB("div").i("ul#count").do(data).i("li.number").co(BOB.d).up().up().a("a",{"href": "www.google.com"}).s()
//=> "<div><ul id="count"><li class="number">1</li><li class="number">2</li><li class="number">3</li><li class="number">4</li><li class="number">5</li><li class="number">6</li><li class="number">7</li></ul></div><a href="www.google.com"></a>" 
```

BOB 目前不支持将数据注入 DOM。这是在todolist上。现在，您可以简单地将输出与普通的 JS 或 jQuery 一起使用，并将其放在您想要的任何位置。

```
document.getElementById("parent").innerHTML = new BOB("div").insert("img",{"src":"the url"}).up().content("the name").s();
//Or jquery:
$("#parent").append(new BOB("div").insert("img",{"src":"the url"}).up().content("the name").s()); 
```

* * *

我制作这个库是因为我对 jquery 和 d3 等任何替代品都不满意。代码非常复杂且难以阅读。和 BOB 一起工作在我看来，这显然是有偏见的，要愉快得多。

BOB 在**Bower**上可用，因此您可以通过运行获得它`bower install BOB`。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-05-15T07:02:55.030

> 对此有最佳做法吗？我可以看到几种方法：
> 
> 1.  连接字符串
> 2.  创建元素
> 3.  使用模板插件
> 4.  在服务器上生成 html，然后通过 JSON 提供服务。

**1)**这是一个选项。在客户端使用 JavaScript 构建 html，然后将其作为一个整体注入 DOM。

请注意，这种方法背后有一个范例：服务器只输出数据，并且（在交互的情况下）从客户端异步接收数据，并使用 AJAX 请求。客户端代码作为独立的 JavaScript Web 应用程序运行。

Web 应用程序可以运行，呈现界面，即使服务器没有启动（当然它不会显示任何数据或提供任何类型的交互）。

这种范式最近经常被采用，整个框架都是围绕这种方法构建的（例如，参见主干.js）。

**2)**出于性能原因，如果可能的话，最好将 html 构建成一个字符串，然后将其作为一个整体注入到页面中。

**3)**这是另一种选择，以及采用 Web 应用程序框架。其他用户发布了各种可用的模板引擎。我的印象是你有能力评估他们并决定是否走这条路。

**4）**另一种选择。但将其作为纯文本/html 提供；为什么是 JSON？我不喜欢这种方法，因为将 PHP（您的服务器语言）与 Html 混合在一起。但我经常采用它作为选项**1**和**4**之间的合理折衷。

* * *

我的回答：你已经在寻找正确的方向。

我建议像我一样采用**1**到**4之间的方法。**否则采用 Web 框架或模板引擎。

只是根据我的经验我的看法...

# database - 一个表中有多少字段是“太多”？

> ID：220613
> 
> 赞同：23
> 
> 时间：2008-10-21T02:54:38.127
> 
> 标签：database, database-design, database-normalization

我有一位同事正在为一个新应用程序计划一个数据库，该应用程序将有几个表，每个表都有超过 30 个字段。这过分吗？也许我只是不够进取，无法理解。

编辑：另外，很多字段都是选项类型的东西（比如在请求表上，你希望你的小部件是黄色还是绿色，他有一个带有枚举的“颜色”字段）。随着时间的推移，这些很可能会被添加或删除。我还没有真正完成数据库设计并试图自己远离它，所以也许我完全是愚蠢的，但肯定有更好的方法来做到这一点？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-21T03:46:57.647

我见过的表格需要规范化的最明显标志是以整数结尾的字段：CouponCode1、CouponCode2、CouponCode3.. 你明白了。一如既往，规则会有例外。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-21T03:14:50.597

数据库表中可以合法地包含 30 个或更多字段。您需要查看的是数据的规范化以及该规范化是否有意义。它通常也会在未来发生变化。但是，你想尽量减少它。

例如，如果您有一个包含地址的表，您是否在该表中包含城市、州和邮政编码字段？或者，您是否只包含一个字段“指向”这些值的单独表中的记录？单独的表将包含唯一的城市、州、邮政编码组合。将数据分成两个表的效果是减少了存储的数据量（很可能但不是绝对的），但是当您对数据库运行查询时会增加一些复杂性。现在，您必须处理 2 张桌子，而不仅仅是一张。但是，从好的方面来说，它更干净，更小（可能）。

真正的答案是在适当的情况下将 city-state-zip 数据留在地址表中是可以的。或者，您可能希望将其“标准化”。两者都很好。

找一个优秀的数据库管理员并在短期内雇用他们来审查计划，如果它在预算之内。从长远来看，它会得到回报。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-21T03:28:55.060

三十个字段并不算多——你只需要确保你的数据被正确规范化（网上有很多指南）。

根据您在其中指定许多列将是随着时间的推移可能会添加或删除的选项类型字段的编辑，我建议以下是一个更好的主意。

```
BaseTable:
    Id
    NonOptionFields
OptionTable:
    Id
    OptionName
    OptionValue 
```

然后，您可以将所有选项与基本记录联系起来。这意味着您不必一直以标准化的方式在表中添加和删除列来实现您想要的。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-21T03:03:34.177

当然，标准答案是视**情况而**定。在某些情况下，具有这么多字段的表实际上可能很有意义。

想想你将在那里存储的数据。这些字段中的许多字段是否可能为 NULL？这些字段发生变化的可能性有多大（例如：添加更多）？

如果只有某些字段适用于某些对象，或许可以考虑将这些字段放入另一个表中。或者，在一个表中只存储基本的通用字段，在另一个表中存储额外信息，每个字段一行。正如[我建议](https://stackoverflow.com/questions/200394/one-table-or-many#200728)的[一个不同的问题（这可能对你有帮助）](https://stackoverflow.com/questions/200394)：

```
refs (id, title, refType)
-- 引用的标题，以及它是什么类型的引用

fieldDef (id, fieldName, refType, dataType)
-- 字段的名称，它适用于哪些引用类型，以及
-- 这些字段中存储了哪些类型的数据（ISDN 号码、日期等）

字段（refId、fieldId、值）
-- 您实际将数据添加到引用的位置。

```

请注意，这被**否决**了，并且可能有充分的理由。这是*一个选项*，不一定是最佳选项，但它仍然是一种可行的方法。然而，在我链接到的问题中投票最高的答案可能是最好的解决方案。

* * *

编辑：既然您说它将包含每个用户设置之类的东西（例如：小部件颜色），我实际上会推荐上面概述的方法（使用三个表）。大多数人很有可能会保留默认设置，因此您将存储一堆无用的信息。请务必阅读我在另一个问题中的回答，因为其他读者已经指出了这种方法的缺点。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-14T15:39:15.030

术语“太多”是一个相对的......你不应该仅仅为了减少字段数量而拆分表，特别是如果在每个查询中你必须将它们重新连接在一起，因为它们是本质上是一对一的关系。如果可以将字段分解为一个单独的逻辑对象，那么这将是有意义的。例如，不是将地址字段存储在客户表中，而是可以将它们移动到单独的地址表中。这是一个粗略的例子，但它说明了我的观点。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-21T03:02:43.617

没有任意限制；足以完成工作是一个很好的经验法则

如果你有更好的数据库设计，建议

如果您需要更详细的反馈，请发布架构

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-07-22T13:44:21.693

**OLTP**

根据我设计数据库的经验，规范化的 OLTP 数据库中很少有表包含大量的列。

IMO 30 列太多。

对我来说，不超过 10% 的 OLTP 表有大量（>10）列。

**OLAP**

现在，如果您要创建维度/报告结构，有些人可能会认为 30 列的表很窄。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-21T03:05:51.193

字段的数量通常不是问题，但您要确保您的数据库正确规范化。 [第三范式](http://en.wikipedia.org/wiki/Database_normalization#Third_normal_form)是一个好的开始。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-21T03:10:10.170

如果非要问，“这张表的字段是不是太多了？” 然后大概有。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-21T12:10:09.470

数据库理论中对字段数量没有限制。一个表可以限制为一个主键（即使这个主键是由2个字段组成的），这意味着[Apocalisp的回答](https://stackoverflow.com/questions/220613/how-many-fields-is-too-many-in-a-table#220731)不是很清楚。相反，只要遵守[范式规则](http://en.wikipedia.org/wiki/Database_normalization)，表格就可以由数以千计的字段组成。

当表中的字段组明显未充分使用时，可以明智地将这组字段拆分到另一个表中，主表和“子”表之间的关系为 0-1。

出于安全原因，也经常有人提议（很久以前：我认为这是我的第一本关系数据库书，首次出版于 197 年？）将机密信息拆分到另一个表中，主和之间具有相同的 0-1 关系子。然后可以轻松地限制用户访问“子”表。现在可以通过视图轻松管理这样的配置。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-21T03:59:22.393

游击队默认规范化指南：

1.  一个表应该有一个主键和最多一个其他列。
2.  仅根据需要频繁地打破第 1 条规则。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-21T03:12:46.530

一个告示牌就是你所说的。他的字段理论上应该拆分到不同的表中。另一个赠品是存在许多可选字段。

我想说数据库设计课程是为了您的数据库“专家”。我建议你也复习一下……它只会帮助你在职业生涯中成长:)

# java - Java 应用程序/类设计 - Java 中的访问器如何工作？

> ID：220624
> 
> 赞同：0
> 
> 时间：2008-10-21T02:57:36.293
> 
> 标签：java

如何编写 getDB() 函数并正确使用它？

这是我的 App 对象的代码片段：

```
public class MyApp extends UiApplication {

    private static PersistentObject m_oStore;
    private static MyBigObjectOfStorage m_oDB;

    static {
        store = PersistentStore.getPersistentObject(0xa1a569278238dad2L);
    }

    public static void main(String[] args) {
        MyApp theApp = new MyApp();
        theApp.enterEventDispatcher();
    }
    public MyApp() {
        pushScreen(new MyMainScreen());
    }

    // Is this correct?  Will it return a copy of m_oDB or a reference of m_oDB?
    public MyBigObjectOfStorage getDB() {
        return m_oDB;  // returns a reference
    }

} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T03:57:34.240

```
public MyBigObjectOfStorage getDB() {
  return m_oDB;
} 
```

正如你所说，它是正确的。它将返回*引用的副本*，它介于副本和引用之间。

getDB() 返回的实际对象实例与 m_oDB 引用的对象相同。但是，您不能将 getDB() 返回的引用更改为指向不同的对象，并让它实际上导致本地私有 m_oDB 指向新对象。m_oDB 仍将指向它已经存在的对象。

有关详细信息，请参阅[http://www.javaworld.com/javaworld/javaqa/2000-05/03-qa-0526-pass.html 。](http://www.javaworld.com/javaworld/javaqa/2000-05/03-qa-0526-pass.html)

尽管在那里查看了您的代码，但您根本没有设置 m_oDB，因此 getDB() 将始终返回 null。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T03:54:15.337

```
public MyBigObjectOfStorage getDB() {
    Object o = store.getContents();
    if ( o instanceof MyBigObjectOfStorage ) {
        return (MyBigObjectOfStorage) o;
    } else {
        return null;
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T13:21:41.307

我是那些非常反对使用单例和/或静态的人之一，因为它往往会使单元测试变得不可能。由于这是在最佳实践下发布的，我建议您看看使用依赖注入框架。我个人使用并更喜欢[Google Guice](http://code.google.com/p/google-guice/)。

# iphone - 如何在 iPhone 应用程序之间共享自定义数据？

> ID：220630
> 
> 赞同：26
> 
> 时间：2008-10-21T03:00:04.853
> 
> 标签：iphone, cocoa-touch

如果我制作了两个 iPhone 应用程序，我如何/应该在它们之间共享自定义数据（不是联系人和类似的东西）？

谢谢！

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-21T03:18:02.820

有两种不同的方法可以解决这个问题。

1）您需要共享的数据是非持久的。换句话说，您需要使用可以执行某些操作的数据来启动一个应用程序。在这种情况下，您将为每个应用程序注册一个特殊的 URL 方案。

[您可以通过 Craig Hockenberry 在他的[已编辑] 博客文章](http://furbo.org/2008/10/01/redacted/)中找到有关 URL 方案的更多信息。

2）您需要共享的数据是持久的。换句话说，您需要两个应用程序都可以读取和写入的数据文件之类的东西。据我所知，除了将数据存储在远程服务器上之外，没有安全的方法可以做到这一点。如果您需要在没有数据连接的情况下访问数据，那么您需要找到一种在各个应用程序和远程服务器之间同步数据的方法。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-10-21T04:14:18.370

除了已经提到的内容之外，关于代码签名的 iPhone 文档似乎暗示使用相同身份签名的应用程序可以访问相同的 Keychain 项。如果您需要存储相对少量的数据（密码等），这可能是一种有用的技术。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-10-21T15:32:27.440

应用程序可以在 iCloud 上共享容器目录。

来自[Apple 关于配置 iCloud 权利的文档](https://developer.apple.com/library/ios/#documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/iCloud/iCloud.html#//apple_ref/doc/uid/TP40007072-CH5-SW1)：

> iCloud Containers 字段标识您的应用程序可以在用户的​​ iCloud 存储中访问的容器目录列表。（此字段对应于 com.apple.developer.ubiquity-container-identifiers 权利。）您添加到此列表的字符串必须对应于您的团队创建的应用程序的捆绑标识符。Xcode 使用当前应用的包标识符来指定第一个字符串；如果您希望多个应用程序共享一个主容器目录，您可以将其更改为不同的包标识符。您还可以为团队的其他应用程序添加额外的捆绑标识符。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-10-05T22:21:45.493

Dan Grisby[最近的移动果园播客](http://www.mobileorchard.com/podcast-warm-clothed-and-fed-developer-run-iphone-businesses/)假设您还可以使用自定义命名剪贴板在应用程序之间共享信息。我意识到这是一篇较旧的帖子，但我想我会指出这一点，因为它在谷歌搜索结果中占了上风。:)

（文档还表明这`NSUserDefaults`在这里可能有用，但我在[其他地方读到](http://arstechnica.com/apple/news/2009/03/iphone-dev-suite-preferences-fail-to-deliver-on-iphone.ars)实际上并非如此。）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-10-07T16:06:19.623

我能想到的一个技巧是使用 API[写入和读取 Address Book](http://techelp.in/mobile/?p=4)，将数据存储在可用字段中（可能是用户图像的 NSData 转换）。编辑：我已经成功实现了 NSData 转换和对象在联系人显示图像中的存储，从而使它们无法从联系人应用程序中编辑。

# php - 设置 PHP Web 项目，基础设施

> ID：220638
> 
> 赞同：14
> 
> 时间：2008-10-21T03:04:14.237
> 
> 标签：php, sql, deployment

如何最好地设置我的 PHP (LAMP) 开发环境，以便拥有开发、登台和生产服务器。一键“单击”部署到其中任何一个，以及一键回滚到任何修订。回滚还应该将数据库模式和数据回滚到源代码当前的状态。

现在，我已经使用 shell 脚本为一个应用程序完成了所有这些（除了数据库回滚功能）。我很想知道其他人的环境是如何设置的，以及在布局方面是否有任何通用工具或最佳实践可供遵循。

那么，你如何做到这一点？您使用哪些现有工具？

谢谢！

更新：只是为了澄清，因为我对我感兴趣的内容有些困惑。

我真的希望人们对他们的环境是如何设置的。

如果你运行一个 PHP 项目并且你的数据库模式在版本控制中，你是怎么做的？你用什么工具？它们是在内部还是我们都可以在网络上的某个地方找到它们？

如果你运行一个 PHP 项目并且在提交时（和/或每晚）进行自动化测试，你是怎么做的？您使用什么源代码版本控制系统？您是否使用 SVN 并在提交后挂钩中运行测试？

如果你运行一个包含多个开发服务器、一个登台服务器和生产服务器的 PHP 项目，你如何组织它们以及如何部署？

我希望从中得到一个很好的想法，即其他人如何将所有东西粘合在一起。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-22T12:21:49.697

我们的生产环境包括以下内容：

*   为我们网站服务的 3 个前端
*   2个数据库后端（主从，复制）
*   1 混合运行 httpd 和数据库进行广告服务

我们的开发环境是一个同时运行数据库和 httpd 的服务器，配置方面我们为每个人设置了不同的工作空间，我们的 VC 是颠覆性的。登台也相当简单——它在前端之一上运行。

**数据库更改**

最初我们在数据库设计上花了很多时间，而且似乎真的得到了回报。五个月来，我们没有任何重大改变。我们部署的大部分更改都在前端。现在，到目前为止，我们手动运行对数据库的所有更改，我总是编写一个小脚本来恢复。

如果我有更多这些，我会在这里使用[Doctrine](http://www.doctrine-project.org/) and [Migrations](http://www.doctrine-project.org/projects/migrations.html)。我实际上从未有机会在生产中使用它们，但我已经广泛使用它们并且它们看起来非常强大。

**部署**

因此，每当我们部署一个新版本时，我们都会创建一个代码标签，我们在登台时检查它，然后通过几个检查列表等，然后我们将代码部署到生产前端。为了完成所有部署，我在[Capistrano](http://capistranorb.com/)设置了几个任务。

查看此示例`capfile`：

```
role :www, "web01", "web02", "web03"
role :web, "web01", "web02", "web03", "web04"
role :db, "db01", "db02"

desc "Deploy sites"
task :deploy, :roles => :www do
    run "cd /usr/www/website && sudo svn --username=deploy --password=foo update"
end 
```

Capistrano 还允许您在不定义任务的情况下运行任何其他命令：

```
cap invoke COMMAND="uptime" ROLES=web 
```

（需要设置*角色*“web”。参见上面的示例。）

**编码风格和文档**

我们非常遵守[PEAR 编码标准](http://pear.php.net/manual/en/standards.php)，我们使用[PHP_CodeSniffer](http://pear.php.net/package/PHP_CodeSniffer) (phpcs) 进行检查。当我说很多时，我的意思是我分叉了提供的嗅探，并添加了一些我自己的热情的例外。

除了编码风格之外，phpcs 还检查内联文档。该文档最终由[phpDocumentor](http://phpdoc.org/)创建。

**CI**

我在我们的 CI 服务器（**continuos-integration**）中设置了这两个工具，它是使用上面的[phpUnderControl](http://phpundercontrol.org)和 CruiseControl、[phpUnit](http://phpunit.de)、[Xdebug](http://xdebug.org)（几个代码指标......）等。

单元测试是我们目前缺乏的东西。但是我们现在要做的是，对于我们在解析引擎中发现的每个错误（我们将文本解析为某些格式），我们编写一个测试以确保它不会再次出现。我还编写了一些基本测试来检查 URL 路由和内部 XMLRPC API，但这确实需要改进。我们同时使用 phpUnit 风格的测试和[phpt](http://qa.php.net/write-test.php)。

CI 服务器每天*构建*几次新版本，生成图表、文档和各种报告。

除了提到的所有工具之外，我们还使用 Google Apps（主要用于电子邮件）并保留一个包含所有其他文档的 Google 协作平台 wiki。例如，部署程序、QA 测试列表等。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T13:54:09.120

我注意到这并没有得到太多曝光。这也是我感兴趣的事情。你知道[Phing](http://phing.info/trac/)吗？你试过了吗？

安德鲁

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T14:41:30.210

[这是使用 Capistrano 自动部署 PHP 应用程序的一个很好的指南。](http://www.simplisticcomplexity.com/2006/8/16/automated-php-deployment-with-capistrano/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-23T11:26:59.903

对于数据库更改，我们在 VCS 中有一个目录：

```
+ dbchanges
|_ 01_database
|_ 02_table
|_ 03_data
|_ 04_constraints
|_ 05_functions
|_ 06_triggers
|_ 07_indexes 
```

当您对数据库进行更改时，您将 .sql 文件放入正确的目录中，并按顺序运行通过这些目录的集成脚本，并将每个更改导入到数据库中。

sql 文件必须以注释开头，该注释在集成脚本导入更改时显示给用户，描述它的作用。它将每个导入的 sql 文件的名称记录到一个文件中，因此当您下次运行脚本时，它不会再次应用相同的更改。

这样，所有开发人员都可以简单地运行脚本来更新数据库。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-27T21:39:31.060

@andrew：我已经尝试过 Phing 并最终使用了 phpUnderControl。Phing 的问题在于，为了管理代码覆盖率，它实际上必须包含您项目中的所有文件，而我们的项目却没有这样做。CruiseControl 的方法对我们来说效果更好。试一试，它们都很容易设置 - 艰苦的工作是构建测试......

# linux - 适用于 Linux 的与语言无关的正确选项卡代码编辑器？

> ID：220642
> 
> 赞同：6
> 
> 时间：2008-10-21T03:06:08.103
> 
> 标签：linux, editor

我需要一个 Linux 文本编辑器来替换 Textpad 4.7.3（一个 Windows nagware 应用程序），但我尝试过的所有替代方案要么臃肿要么不完整。以下是我认为最重要的功能，按降序排列：

*   正则表达式搜索、标记和替换（甚至跨所有打开的文件），目录树中的正则表达式搜索
*   **具有正确**键盘快捷键的选项卡式编辑器（[ctrl]+[tab] 应该在与[alt]+[tab]*完全相同的模型上工作）*
*   自动缩进、缩进保留和缩进操作（制表符、移位制表符）
*   智能导航键：[home] 在行首和非空格开始之间切换，[F2] 寻找下一个书签，*点击向上和向下箭头键会将您带到您上次导航的列，而不是您上次键入的位置*（我认为 Textpad 是我见过的唯一地方）
*   语法高亮（奖励：混合语言高亮，TextPad 缺乏）
*   块选择模式
*   从程序（例如编译器）运行用户定义的命令，具有交互式命令结果（文本板可让您定义正则表达式以匹配文件名和行号，以便您可以双击错误并转到该文件中的该行。）
*   工作区（同时打开的文件集合）

以下是我在我尝试过的编辑器中发现的令人反感的内容：

*   Vim 和 emacs~~没有充分利用我的屏幕、鼠标和键盘。此外，还有~~相当长的学习曲线——你必须学习一种*全新*的与键盘交互的方式。（当然，如果他们拥有我想要的一切，我会学习他们。）
*   Gedit 几乎是完美的，但它（像大多数一样）有蹩脚的标签，这是*无法容忍的*
*   Eclipse 是个怪物，除非我在做 Java，否则我不会碰它
*   **正则表达式功能**非常罕见
*   几乎没有**最后一次看到的**选项卡遍历
*   我没有看到任何关于最后导航列光标遍历的内容。（一旦我开始使用它，我发现我离不开它。）

我没有时间或构建我的“理想编辑器”所需的具体知识，所以我希望那些对编辑器有相同品味的人可能会偶然发现一块宝石。

ETA：请**不要推荐**您没有**亲自使用**过的编辑器。我听说过 SciTE、Eclipse、gedit、medit、nedit、GVim、Gemacs、Kate、Geany、Gnotepad、ozeditor 等。我相信它们中的大多数都有我提到的一些功能。如果您不确定它是否具有基本功能（例如 ctrl-tab 就像 alt-tab 一样工作），那么您并没有真正提供帮助，是吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-21T04:22:52.143

这是我使用了大约 5 年的 jEdit 的投票：

> ```
> * Regex search mark, and replace (across all open files, even), regex 
> ```
> 
> 在目录树中搜索

是的，并且反向引用，包括整个比赛的 $0

> ```
> * Tabbed editor with proper keyboard shortcuts ([ctrl]+[tab] 
> ```
> 
> 应该在与 [alt]+[tab] 相同的模型上工作）

多种显示缓冲区的方式，以及完全可定制的键盘导航。我最常用的功能之一是“返回上一个缓冲区”，我已将其映射到 F12

> ```
> * Auto-indent, indent preservation, and indent manipulation 
> ```
> 
> （制表符，移位制表符）

是的。您还可以将它们设置为制表符或空格，并在两者之间进行转换

> ```
> * Smart navigation keys: [home] toggles between start of line and 
> ```
> 
> 非空格的开始，[F2] 寻找下一个书签，点击向上和向下箭头键会将您带到您上次导航的列，而不是您上次键入的位置（我认为 Textpad 是我见过的唯一地方）

一般预期的导航。将这些映射到您选择的键。如果将光标放在特定列并向上或向上翻页箭头，则光标将停留在该列中

> *   语法高亮（奖励：混合语言高亮，TextPad 缺乏）

许多不同的语言使用 xml 文件来自定义令牌匹配。一些混合，例如 php + javascript

> ```
> * Block select mode 
> ```

不，据我所知……等等！是的！在编辑 -> 更多选择 -> 矩形选择下。感谢 dwhall 指出这一点

> ```
> * Run user-defined commands from program (such as compilers), have 
> ```
> 
> 交互式命令结果（文本板可让您定义正则表达式以匹配文件名和行号，以便您可以双击错误并转到该文件中的该行。）

从完整的命令行控制台（在 linux 和 windows 中工作）到可以进行系统调用的 BeanShell 宏，许多插件都用于此目的。许多常用任务的插件，如 ant、cc、make、svn 等

> ```
> * Workspaces (collections of files to be open at the same time) 
> ```

yup 插件也是如此，jEdit 还跟踪打开的文件、未保存的更改和会话之间的光标位置

> 以下是我在我尝试过的编辑器中发现的令人反感的内容：
> 
> ```
> * Vim and emacs do not take full advantage of my screen, mouse, and 
> ```
> 
> 键盘。此外，还有相当长的学习曲线。（当然，如果他们拥有我想要的一切，我会学习他们。）

jEdit 是一个 java 程序，但仍然很好地利用了跨平台剪贴板和拖放功能

> ```
> * Regex capability is frighteningly rare 
> ```

jEdit 具有我见过的最好的正则表达式处理，正则表达式搜索可以返回多个结果 grep 样式，当您在搜索后添加或删除文本行时，结果位置不会混淆

> ```
> * Almost nothing has last-seen tab traversal 
> ```

就像我说的，我最喜欢的功能之一是“转到最后一个缓冲区”

> ```
> * I've not seen anything with last-navigation-column cursor 
> ```
> 
> 遍历

就像我说的那样，上下翻页时光标停留在列中

我喜欢的其他功能：

*   **基于缩进的折叠**：不需要语法意识，只需在缩进上折叠
*   **并排**差异：漂亮的图形差异视图
*   **多个视图和拆分窗格**
*   **使用 beanshell 进行宏录制**
*   **缩写**：我有 2-3 个字母的简短关键字，当我点击空格时会扩展为代码片段

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-21T03:44:53.780

*Vim 和 emacs 没有充分利用我的屏幕、鼠标和键盘。*

你看过gvim吗？我自己是一个控制台人，但我很确定它是 GUIlicious。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-21T03:12:05.190

我推荐 Geany（现在是 0.15 版）。它具有您需要的所有（或几乎所有）功能。在手册中查找密钥（我用了一年才发现它有块选择）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-21T18:52:38.613

我认为你对事情的运作方式如此挑剔是一个严重的错误。您可能找不到在各个方面都与 TextPad**完全一样的东西。**您错过了一些建议的文本编辑器中的一些强大功能。

在我使用 Emacs 的这些年里，我学到的一件事是“你能在 Emacs 中做 X”这个问题的答案**总是**“是”！（当然，在某些极端情况下这是不正确的，但它基本上是对现实的一个很好的近似。）所以，我意识到有人可能已经实现了一个使 Emacs 更加 Windowsy 的模块（CUA 快捷方式，`Ctrl`-`Tab`等）在“ **emacs 中的 windows 键**”上进行谷歌搜索后，我找到[了 EmacsW32](http://www.ourcomments.org/Emacs/EmacsW32Util.html)。它似乎具有您要求的许多功能：

*   正则表达式支持：是
*   `Ctrl``Tab`缓冲区切换：是的
*   自动缩进：是
*   语法高亮：是
*   “智能导航键”：不是直接的，但这应该可以通过简单地重新绑定正确的命令来实现。
*   块选择：是
*   用户自定义命令：是
*   直接跳转到编译器错误位置：是的，但如果您使用的是具有非标准错误格式的编译器，您可能需要调整用于提取错误消息的正则表达式
*   工作区：是的（我认为这包括现在作为标准包）

请记住，Emacs 拥有一个庞大而活跃的社区，拥有大量在线资源，并且有很多人愿意帮助您定制 Emacs。如果您缺少 Emacs 中的某个功能，那么很可能其他人已经实现了它！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-21T04:01:50.737

我还建议使用 jEdit。它有许多功能和许多插件。

维基百科对可能有用的文本编辑器进行了很好的比较： [http ://en.wikipedia.org/wiki/Comparison_of_text_editors](http://en.wikipedia.org/wiki/Comparison_of_text_editors)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-21T03:10:58.110

你试过scite吗？

[http://www.scintilla.org/SciTE.html](http://www.scintilla.org/SciTE.html)

你的发行版可能已经有一个包。

我相信有一个插件可以添加项目，但我不记得它了。我不确定是否能够双击错误跳转到该行。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-21T03:23:10.877

你试过用[Wine](http://winehq.org/)在 Linux 中运行 Textpad吗？

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-21T03:30:45.917

[jEdit](http://jedit.org/)可能是您正在寻找的。开箱即用，它有很多你正在寻找的东西，其余的都可以在大量可用的插件集合中找到。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-03-19T22:22:55.123

如果没有其他原因，我当然会推荐[PowerPad 。](http://quickmediasolutions.com/software/powerpad/)

以下是您会在 Linux 版本中找到的一些精彩功能：

*   多标签界面
*   基于 Python 的强大脚本语言
*   无限撤消
*   自动缩进
*   支持通过 FTP 打开和编辑文件
*   能够打开 UTF-8 和 UTF-16 编码文件

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-24T08:29:41.617

notepad++ 功能齐全，我一直使用它来处理所有语言！

它在 Windows 上，但显然它可以使用 WINE [http://notepad-plus.sourceforge.net/uk/nppLinux.php在 linux 上运行](http://notepad-plus.sourceforge.net/uk/nppLinux.php)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-28T19:04:26.580

ActiveState 的 Komodo Edit 有一个 linux 版本，它完成了你描述的大部分事情。我已经 24/7 全天候使用它一年多了，虽然我不喜欢它，但我在 Linux 上没有找到更好的东西。这是他们商业产品的精简版免费版本，如果效果更好，我会很想购买他们功能更强大的 Komodo IDE。

它不是真正稳定的，至少在我的系统上。它经常崩溃或冻结，因此如果您尝试它，请经常保存。

我最近从 4.2 升级到了版本 5，这并不是一个改进。他们破坏了很多东西，所以我要回到 4.2。他们打破的主要让我伤心的是用于编辑多个文件的选项卡。在 4.2 中，他们让 x 在标签行的右边缘关闭，其位置从未改变。在 5 中，它移到了活动选项卡的末尾。现在，如果不将鼠标对准每个文件，您将无法关闭多个文件。

我在 Komodo 之前使用过 Eclipse，而 Komodo 4.2 不如一年前的 Eclipse 糟糕。

真的，这个回应并不是对 Komodo Edit 的认可。我真的不满意，我希望你能找到一个有这个问题的好编辑，这样我也可以切换。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-21T03:15:13.840

你试过[凯特](http://kate-editor.org/)吗？我不确定它是否符合您的所有要求，但可能。此外，对于更面向开发的工具，您可以尝试[KDevelop](http://www.kdevelop.org/)，其默认编辑器是 Kate（但您可以更改任何其他实现 KTextEditor 接口的编辑器）

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-05-22T18:42:24.750

我刚刚根据 Kknd 的帖子安装了 Geany，它很 SWEET。

我最近从 Mac 跳到 Linux (Ubuntu)，并且一直缺少 BBEdit。经过几个月在 gvim 和 gedit 之间来回跳动并发现 jedit 有点笨拙，我相信 Geany 是我的答案。开箱即用，非常直观，开始挖掘时会有很多好东西。

不确定它是否在 phyzome 测试中获得 A，但肯定是 A-：

完全可配置的语法/颜色主题——我刚刚安装了一个由 Barry Van 创建的深色主题，但您可以根据需要创建自己的主题。不得不承认，我从来没有想过混合语言突出显示是一种真正的可能性，所以不确定那个。

多文件搜索，正则表达式。

方向和历史标签导航。

出色的自动缩进选项（不同的大括号模式、制表符与空格，您甚至可以使用制表符进行编辑并让它在保存时自动转换为空格！）

老实说，我并没有过多考虑“智能导航键”（超出基础知识），所以不能真正说明这一点，但它似乎确实有很多键盘快捷键的配置选项..？

还没有研究块选择模式，但 Kknd 说它在那里。

运行/编译控件，用于运行命令的虚拟终端仿真器。

工作区……哎呀！也许不吧。它确实有一个文档侧边栏..也许某处有一个工作区插件？“添加一些东西”仍然比“从头开始构建”好得多；）

# c# - 显示对话框时出现“线程被中止”异常

> ID：220643
> 
> 赞同：5
> 
> 时间：2008-10-21T03:06:49.770
> 
> 标签：c#, .net, multithreading, .net-2.0

在我的应用程序中，我有一个线程显示了一段时间“请稍候”对话框窗口，有时它的时间非常短，并且在绘制 UI 时出现了一些故障（我猜）。

我得到异常“线程被中止”并且完全不知道如何摆脱它。我的意思是以某种方式捕获该异常，或者以某种其他方式将其隐藏在用户面前。此异常与我的应用程序的其余部分无关，并且该错误无论如何都不会影响它。随机出现，很难在通话中重新创建。

我尝试以各种方式通过使用对话窗口启动和停止线程的代码来捕获该异常，但似乎错误显然是在我新创建的线程中显示窗口的其他线程旁边。

这是一个代码示例，静态类的一部分，里面有一些有用的东西，当然我不是说这是解决这种“忙碌”情况的好方法，但我想解决这个问题。线程.睡眠（500）；或其他尝试/捕获改进并不能帮助我避免该线程异常。

```
 public static bool alreadyBusy = false;
    public static BusyIndicator bi = new BusyIndicator("");
    public static Thread backgroundOpertionThread;

    public static void showBusy(bool isBusy, System.Windows.Forms.Form hostform, string message)
    {
        Common.busyMessage = message;
        if (isBusy)
        {
            Common.alreadyBusy = true;
            backgroundOpertionThread = new Thread(new ThreadStart(showBusy));
            Thread.Sleep(500);
            if (hostform != null)
            {
                hostform.Enabled = false;
                hostform.SuspendLayout();
            }
            backgroundOpertionThread.Start();

        }
        else
        {

            backgroundOpertionThread.Abort();
            Thread.Sleep(500);
            Common.alreadyBusy = false;
            if (hostform != null)
            {
                hostform.Enabled = true;
                hostform.ResumeLayout();
            }
        }
    }

    public static void showBusy()
    {
        BusyIndicator bir = new BusyIndicator(Common.busyMessage);
        bir.ShowDialog();
    } 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-21T06:03:42.533

Do **not** use Thread.Abort. This method is reserved for when the .NET runtime needs to forcibly kill threads in order to unload your program.

You can only "safely" use this if you're about to unload an AppDomain and want to get rid of threads running in it first.

To get rid of a thread, write it in cooperative mode. This means that the thread should periodically check some kind of flag, and if the flag is set, exit normally out of the thread method. To "kill" the thread, simply set the flag and wait for the thread to exit.

You can use an Event-object or a simple boolean variable for this flag.

But **do not use Thread.Abort**.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T03:58:49.277

使用[SafeThread](http://www.codeproject.com/KB/threads/SafeThread.aspx)并将 ShouldReportThreadAbort 设置为 false 以使问题消失...

更好的解决方案是在调试器中使用 Debug >> Exceptions >> Throw 检查所有异常类型，并找出中止线程的情况

EDIT: thanks for posting the code sample, that makes the problem much easier to see. **DO NOT CALL THREAD.ABORT**

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T04:58:13.073

Agreed with Steven's idea about turning on all exceptions when thrown. Then you'll be able to immediately see the problem.

One thing that's important to remember, you won't have the debug menu option if your visual studio settings are on general, as opposed to the "Visual C# Developer" setting. Still catches me if I'm on a new machine or using a new profile...

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2008-10-21T06:15:45.070

You can try calling

```
Thread.Sleep(500); 
```

after

```
backgroundOpertionThread.Start(); 
```

This would give the background thread 500 ms to do what it needs to do before the main thread gets an opportunity to call

```
backgroundOpertionThread.Abort(); 
```

Edit: But I agree that the best solution would be not to use Thread.Abort() at all

# c++ - 适用于 Mac 的 C++ IDE

> ID：220644
> 
> 赞同：124
> 
> 时间：2008-10-21T03:08:36.180
> 
> 标签：c++, macos, ide

我使用 Visual Studio 教授 C++ 课程。我的一个学生有一台 Mac，正在寻找在他的机器上使用的 IDE。有什么好推荐的？

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2008-10-21T03:10:33.243

[作为 MacOS 开发者工具一部分的Xcode](http://developer.apple.com/tools/xcode/)是一个很棒的 IDE。还有可以配置为构建和编译 C++ 项目的[NetBeans](http://www.netbeans.org)和[Eclipse 。](http://www.eclipse.org)

[来自 JetBrains 的Clion](https://www.jetbrains.com/clion/)，现在也可以使用，并使用 Cmake 作为项目模型。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-10-21T03:12:51.397

埃马克！Eclipse 也可能工作。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-21T04:03:56.363

[Code::Blocks](http://www.codeblocks.org/)是跨平台的，使用[wxWidgets](http://en.wikipedia.org/wiki/WxWidgets)库。这是我用的那个。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-21T07:48:34.927

另一个（尽管不是免费的）选项是在 Mac 上安装 VMware Fusion 或 Parallels Desktop，并在 VM 中使用 Visual Studio 运行 Windows。

这真的很好用。缺点是：

*   虚拟机软件和 Windows 需要花钱（学校可能有一些学术许可，这可能会有所帮助）
*   Mac 需要是具有相当大内存的 x86 Mac

好处是您和学生无需为 IDE 中的差异而烦恼，这些差异可能未在您的教学材料中说明。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-21T08:58:26.393

If you are looking for a full-fledged IDE like Visual Studio, I think Eclipse might be your best bet.

Eclipse is also highly extensible and configurable.

See here: [http://www.eclipse.org/downloads/](http://www.eclipse.org/downloads/)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2011-02-22T12:18:27.707

Of​​​​​ course there is [Mono](http://en.wikipedia.org/wiki/Mono_(software)).

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-21T04:03:33.463

它本身并不是一个真正的 IDE，但我真的很喜欢 TextMate，并且使用它附带的 C++ 包，它可以做很多你在 IDE 中可以找到的事情（没有所有的臃肿！）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-06-04T20:12:58.493

Avoid [Eclipse](http://en.wikipedia.org/wiki/Eclipse_%28software%29) for C/C++ development for now on [Mac OS X v10.6](http://en.wikipedia.org/wiki/Mac_OS_X_Snow_Leopard) (Snow Leopard). There are serious problems which make debugging problematic or nearly impossible on it currently due to [GDB](http://en.wikipedia.org/wiki/GNU_Debugger) incompatibility problems and the like. See: *[Trouble debugging C++ using Eclipse Galileo on Mac](https://stackoverflow.com/questions/1270285/trouble-debugging-c-using-eclipse-galileo-on-mac)*.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-21T03:11:00.403

[Xcode](http://developer.apple.com/tools/xcode/)是免费的而且很好，这很幸运，因为它几乎是 Mac 上的唯一选择。

# function - “闭包”和“lambda”有什么区别？

> ID：220658
> 
> 赞同：912
> 
> 时间：2008-10-21T03:12:54.860
> 
> 标签：function, lambda, functional-programming, closures

有人可以解释一下吗？我了解它们背​​后的基本概念，但我经常看到它们可以互换使用，我感到困惑。

既然我们在这里，它们与常规函数有何不同？

* * *

## 回答 #1

> 赞同：755
> 
> 时间：2008-10-21T03:58:32.583

**lambda**只是一个匿名函数 - 一个没有名称定义的函数。在某些语言中，例如 Scheme，它们等价于命名函数。实际上，函数定义被重写为在内部将 lambda 绑定到变量。在其他语言中，例如 Python，它们之间存在一些（相当不必要的）区别，但它们的行为方式相同。

**闭包**是在定义它的**环境中****关闭**的任何函数。这意味着它可以访问不在其参数列表中的变量。例子：

 **```
def func(): return h
def anotherfunc(h):
   return func() 
```

这将导致错误，因为`func`未**关闭**`anotherfunc`在-`h`未定义的环境中。`func`仅在全球环境中关闭。这将起作用：

```
def anotherfunc(h):
    def func(): return h
    return func() 
```

因为在这里，`func`在`anotherfunc`, 和 python 2.3 及更高版本（或类似的数字）中定义，当它们*几乎*得到正确的闭包（突变仍然不起作用）时，这意味着它**关闭了** `anotherfunc`'s 环境并可以访问内部的变量它。在 Python 3.1+ 中，突变在使用[关键字`nonlocal`时](http://docs.python.org/release/3.1.3/reference/simple_stmts.html#nonlocal)也有效。

另一个重要的一点 -`func`将继续关闭 over`anotherfunc`的环境，即使它不再在`anotherfunc`. 此代码也将起作用：

```
def anotherfunc(h):
    def func(): return h
    return func

print anotherfunc(10)() 
```

这将打印 10。

**正如您所注意到的，这与lambda** s无关——它们是两个不同（尽管相关）的概念。

* * *

## 回答 #2

> 赞同：476
> 
> 时间：2016-04-27T01:18:04.737

围绕 lambda 和闭包存在很多混淆，即使在此处对 StackOverflow 问题的回答中也是如此。与其随机询问那些从使用某些编程语言或其他无知的程序员实践中了解闭包的程序员，不如踏上寻找*源头*的旅程（一切开始的地方）。由于 lambdas 和闭包来自Alonzo Church 在 30 年代发明的**Lambda Calculus**，当时还没有第一台电子计算机，这就是我所说的*来源。*

Lambda Calculus 是世界上最简单的编程语言。您可以在其中做的唯一事情：►</p>

*   应用：将一个表达式应用于另一个表达式，表示为`f x`。
    （把它想象成一个*函数调用*，函数在哪里`f`，`x`是它唯一的参数）
*   抽象：绑定出现在表达式中的符号以标记该符号只是一个“槽”，一个等待填充值的空白框，一个“变量”。它是通过在前面加上一个希腊字母`λ`(lambda)，然后是符号名称 (例如)，然后在表达式之前加上`x`一个点来完成的。`.`然后，这会将表达式转换为需要一个*参数的**函数*。例如：获取表达式并告诉该表达式中的符号是一个*绑定变量*——它可以用您作为参数提供的值替换。 注意这样定义的函数是*匿名的* *`λx.x+2``x+2``x` **– 它没有名称，因此您还不能引用它，但是您可以通过向它提供它正在等待的参数来*立即调用*`(λx.x+2) 7`它（还记得应用程序吗？），如下所示： . 然后表达式（在本例中为文字值）`7`被替换为应用的 lambda`x`的子表达式`x+2`，所以你得到`7+2`，然后`9`通过常见的算术规则简化为。***

 **所以我们解决了其中一个谜团：
**lambda**是上例中的*匿名函数*，`λx.x+2`.

* * *

在不同的编程语言中，函数抽象 (lambda) 的语法可能不同。例如，在 JavaScript 中它看起来像这样：

```
function(x) { return x+2; } 
```

您可以立即将其应用于某些参数，如下所示：

```
(function(x) { return x+2; })(7) 
```

或者您可以将此匿名函数 (lambda) 存储到某个变量中：

```
var f = function(x) { return x+2; } 
```

这有效地给了它一个 name `f`，允许您引用它并在以后多次调用它，例如：

```
alert(  f(7) + f(10)  );   // should print 21 in the message box 
```

但你不必命名它。您可以立即调用它：

```
alert(  function(x) { return x+2; } (7)  );  // should print 9 in the message box 
```

在 LISP 中，lambda 是这样制作的：

```
(lambda (x) (+ x 2)) 
```

您可以通过立即将其应用于参数来调用这样的 lambda：

```
(  (lambda (x) (+ x 2))  7  ) 
```

* * *

好的，现在是时候解开另一个谜团了：什么是*闭包*。为了做到这一点，让我们谈谈lambda 表达式中的*符号*（*变量*）。

正如我所说，lambda 抽象所做的是在其子表达式中*绑定*一个符号，以便它成为一个可替换的*参数*。这样的符号称为*bound*。但是如果表达式中还有其他符号怎么办？例如：`λx.x/y+2`。在此表达式中，符号受其前面`x`的 lambda 抽象约束。`λx.`但另一个符号 ,`y`不受约束——它是*免费*的。我们不知道它是什么以及它来自哪里，所以我们不知道它*意味着*什么以及它代表什么*价值*，因此我们无法评估该表达式，直到我们弄清楚它的`y`含义。

实际上，其他两个符号`2`和 也是如此`+`。只是我们对这两个符号太熟悉了，以至于我们通常忘记了计算机不知道它们，我们需要通过在某个地方定义它们来告诉它它们的含义，例如在图书馆或语言本身中。

您可以将*自由*符号视为在表达式之外的其他地方定义的“周围上下文”，称为它的**环境**。环境可能是一个更大的表达式，这个表达式是它的一部分（正如 Qui-Gon Jinn 所说：“总有一条更大的鱼”;)），或者在某个库中，或者在语言本身中（作为*原始*语言）。

这让我们将 lambda 表达式分为两类：

*   CLOSED 表达式：出现在这些表达式中的每个符号都受某种 lambda 抽象*约束。*换句话说，它们是*独立的*；它们不需要评估任何周围的上下文。它们也被称为*组合*子。
*   OPEN 表达式：这些表达式中的一些符号是*不受约束的*——也就是说，其中出现的一些符号是*自由*的，它们需要一些外部信息，因此在您提供这些符号的定义之前，它们不能被计算。

**您可以通过提供environment**来关闭一个*开放*的lambda 表达式，它通过将所有这些自由符号绑定到一些值（可能是数字、字符串、匿名函数又名 lambdas 等）来定义所有这些自由符号。

 **这里是*闭包*部分：*lambda 表达式*
的**闭包**是在外部上下文（环境）中定义的一组特殊符号，它们为该表达式中的*自由符号*赋予值，使它们不再是非自由的。它将一个仍然包含一些“未定义”自由符号的*开放*lambda 表达式转换为一个不再有任何自由符号的*封闭表达式。*

 ***例如，如果您有以下 lambda 表达式：`λx.x/y+2`，则符号`x`是绑定的，而符号`y`是自由的，因此除非您说出什么意思，否则该表达式是`open`并且不能被评估`y`（与 and 相同`+`，`2`它们也是自由的）。但是假设你也有这样的*环境*：

```
{  y: 3,
+: [built-in addition],
2: [built-in number],
q: 42,
w: 5  } 
```

这个*环境*`y`为我们的 lambda 表达式 ( , `+`, )中的所有“未定义”（自由）符号`2`和几个额外的符号 ( `q`, `w`) 提供定义。我们需要定义的符号是环境的这个子集：

```
{  y: 3,
+: [built-in addition],
2: [built-in number]  } 
```

这正是我们的 lambda 表达式的*闭包*：>

换句话说，它*关闭*了一个打开的 lambda 表达式。这就是名称*闭包*的最初来源，这就是为什么这个线程中有这么多人的答案不太正确的原因：P

* * *

那么他们为什么会误会呢？为什么他们中的许多人说闭包是内存中的一些数据结构，或者他们使用的语言的一些特性，或者他们为什么将闭包与 lambda 混淆？:P

好吧，应该归咎于 Sun/Oracle、Microsoft、Google 等企业市场，因为这就是他们在他们的语言（Java、C#、Go 等）中所说的这些结构。他们经常称“闭包”应该只是 lambdas。或者他们将“闭包”称为他们用来实现词法作用域的一种特殊技术，也就是说，一个函数可以访问在其定义时在其外部作用域中定义的变量这一事实。他们常说，函数“封装”了这些变量，也就是将它们捕获到某种数据结构中，以防止它们在外部函数执行完毕后被破坏。但这只是*事后虚构的*“民间传说词源”和营销，只会让事情变得更加混乱，

更糟糕的是，他们所说的总是有一点道理，这不允许您轻易将其视为错误：P 让我解释一下：

如果你想实现一种使用 lambdas 作为一等公民的语言，你需要允许它们使用在其周围上下文中定义的符号（即，在你的 lambdas 中使用自由变量）。即使周围的函数返回，这些符号也必须存在。问题是这些符号绑定到函数的一些本地存储（通常在调用堆栈上），当函数返回时，这些符号将不再存在。因此，为了让 lambda 以您期望的方式工作，您需要以某种方式从其外部上下文中“捕获”所有这些自由变量并将它们保存以供以后使用，即使外部上下文将消失。也就是说，你需要找到*闭包*lambda（它使用的所有这些外部变量）并将其存储在其他地方（通过制作副本，或者通过预先为它们准备空间，而不是在堆栈上的其他地方）。你用来实现这个目标的实际方法是你的语言的“实现细节”。这里重要的是*闭包*，它是来自lambda*环境的一组**自由变量*，需要保存在某个地方。

 *人们很快就开始调用他们在语言实现中使用的实际数据结构来实现闭包作为“闭包”本身。该结构通常看起来像这样：

```
Closure {
   [pointer to the lambda function's machine code],
   [pointer to the lambda function's environment]
} 
```

这些数据结构作为参数传递给其他函数，从函数返回，并存储在变量中，以表示 lambda，并允许它们访问其封闭环境以及在该上下文中运行的机器代码。但这只是*实现*闭包的一种方式（其中一种），而不是*闭*包本身。

正如我上面所解释的，lambda 表达式的闭包是其环境中定义的子集，它为该 lambda 表达式中包含的自由变量提供值，有效地*关闭*表达式（将尚未计算的*开放*lambda 表达式转换为一个*封闭*的lambda 表达式，然后可以对其求值，因为其中包含的所有符号现在都已定义）。

其他任何东西都只是程序员和语言供应商的“货物崇拜”和“巫术魔法”，他们不知道这些概念的真正根源。

我希望这能回答你的问题。但是，如果您有任何后续问题，请随时在评论中提出，我会尽力解释得更好。

* * *

## 回答 #3

> 赞同：181
> 
> 时间：2008-10-21T03:46:55.727

当大多数人想到*函数*时，他们会想到**命名函数**：

```
function foo() { return "This string is returned from the 'foo' function"; } 
```

当然，这些都是按名称调用的：

```
foo(); //returns the string above 
```

使用*lambda 表达式*，您可以使用**匿名函数**：

```
 @foo = lambda() {return "This is returned from a function without a name";} 
```

在上面的例子中，你可以通过分配给它的变量来调用 lambda：

```
foo(); 
```

然而，比将匿名函数分配给变量更有用的是，将它们传递给高阶函数或从高阶函数传递它们，即接受/返回其他函数的函数。在很多情况下，命名函数是不必要的：

```
function filter(list, predicate) 
 { @filteredList = [];
   for-each (@x in list) if (predicate(x)) filteredList.add(x);
   return filteredList;
 }

//filter for even numbers
filter([0,1,2,3,4,5,6], lambda(x) {return (x mod 2 == 0)}); 
```

*闭包*可以是命名函数或匿名函数，但当它“关闭”定义函数的范围内的变量时，它就被称为闭包，即闭包仍将引用环境中使用的任何外部变量。关闭本身。这是一个命名的闭包：

```
@x = 0;

function incrementX() { x = x + 1;}

incrementX(); // x now equals 1 
```

这看起来并不多，但是如果这一切都在另一个函数中并且你传递`incrementX`给了一个外部函数呢？

```
function foo()
 { @x = 0;

   function incrementX() 
    { x = x + 1;
      return x;
    }

   return incrementX;
 }

@y = foo(); // y = closure of incrementX over foo.x
y(); //returns 1 (y.x == 0 + 1)
y(); //returns 2 (y.x == 1 + 1) 
```

这就是在函数式编程中获得有状态对象的方式。由于不需要命名“incrementX”，因此您可以在这种情况下使用 lambda：

```
function foo()
 { @x = 0;

   return lambda() 
           { x = x + 1;
             return x;
           };
 } 
```

* * *

## 回答 #4

> 赞同：57
> 
> 时间：2008-10-21T03:29:36.743

并非所有闭包都是 lambda，也不是所有 lambda 都是闭包。两者都是函数，但不一定以我们习惯知道的方式。

lambda 本质上是一个内联定义的函数，而不是声明函数的标准方法。Lambda 可以经常作为对象传递。

闭包是一个函数，它通过引用其主体外部的字段来封闭其周围的状态。封闭状态在闭包的调用中保持不变。

在面向对象的语言中，闭包通常是通过对象提供的。但是，一些 OO 语言（例如 C#）实现的特殊功能更接近于纯[函数式语言](http://en.wikipedia.org/wiki/Category:Functional_languages)（例如 lisp）提供的闭包定义，这些语言没有对象来封装状态。

有趣的是，在 C# 中引入 Lambdas 和 Closures 使函数式编程更接近主流用法。

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2014-03-19T08:31:17.927

就这么简单： lambda 是一种语言结构，即匿名函数的简单语法；闭包是一种实现它的技术——或者任何一流的函数，就此而言，命名的或匿名的。

更准确地说，闭包是[一流函数](http://en.wikipedia.org/wiki/First-class_function)在运行时的表示方式，它是一对“代码”和一个“关闭”该代码中使用的所有非局部变量的环境。这样，即使它们起源的外部范围已经退出，这些变量仍然可以访问。

不幸的是，有许多语言不支持函数作为一等值，或者只支持残缺的形式。所以人们经常用“闭包”这个词来区分“真货”。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2014-03-19T00:11:15.193

从编程语言的角度来看，它们是完全不同的两种东西。

基本上，对于图灵完备的语言，我们只需要非常有限的元素，例如抽象、应用和归约。抽象和应用程序提供了构建 lamdba 表达式的方法，而归约决定了 lambda 表达式的含义。

Lambda 提供了一种可以将计算过程抽象出来的方法。例如，要计算两个数的和，可以抽象出一个接受两个参数 x、y 并返回 x+y 的过程。在方案中，您可以将其写为

```
(lambda (x y) (+ x y)) 
```

您可以重命名参数，但它完成的任务不会改变。在几乎所有的编程语言中，您都可以为 lambda 表达式命名，即命名函数。但是没有太大区别，它们在概念上可以被认为只是语法糖。

好的，现在想象一下如何实现。每当我们将 lambda 表达式应用于某些表达式时，例如

```
((lambda (x y) (+ x y)) 2 3) 
```

我们可以简单地将参数替换为要评估的表达式。这个模型已经很强大了。但是这个模型不能让我们改变符号的值，例如我们不能模仿状态的变化。因此我们需要一个更复杂的模型。简而言之，每当我们想要计算 lambda 表达式的含义时，我们都会将这对符号和对应的值放入一个环境（或表）中。然后通过查找表中的相应符号来评估其余的 (+ xy)。现在，如果我们提供一些原语来直接对环境进行操作，我们就可以对状态的变化进行建模！

在此背景下，检查此功能：

```
(lambda (x y) (+ x y z)) 
```

我们知道，当我们计算 lambda 表达式时，xy 将被绑定到一个新表中。但是我们如何以及在哪里查找 z 呢？实际上 z 被称为自由变量。必须有一个包含 z 的外部环境。否则仅通过绑定 x 和 y 无法确定表达式的含义。为了清楚起见，您可以在方案中编写如下内容：

```
((lambda (z) (lambda (x y) (+ x y z))) 1) 
```

所以 z 将在外部表中绑定到 1。我们仍然得到一个接受两个参数的函数，但它的真正含义还取决于外部环境。换句话说，外部环境关闭了自由变量。在 set! 的帮助下，我们可以使函数有状态，即它不是数学意义上的函数。它返回的内容不仅取决于输入，还取决于 z。

这一点你已经很清楚了，对象的方法几乎总是依赖于对象的状态。这就是为什么有人说“闭包是穷人的对象”。但我们也可以将对象视为穷人的闭包，因为我们真的很喜欢一流的函数。

我使用方案来说明这些想法，因为该方案是最早具有真正闭包的语言之一。这里的所有材料都在 SICP 第 3 章中有更好的介绍。

总而言之，lambda 和闭包是完全不同的概念。lambda 是一个函数。闭包是一对 lambda 和关闭 lambda 的相应环境。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2014-07-31T07:41:33.360

概念与上面描述的相同，但如果您是 PHP 背景的，这将使用 PHP 代码进一步解释。

```
$input = array(1, 2, 3, 4, 5);
$output = array_filter($input, function ($v) { return $v > 2; }); 
```

函数 ($v) { 返回 $v > 2; } 是 lambda 函数定义。我们甚至可以将它存储在一个变量中，这样它就可以被重用：

```
$max = function ($v) { return $v > 2; };

$input = array(1, 2, 3, 4, 5);
$output = array_filter($input, $max); 
```

现在，如果您想更改过滤数组中允许的最大数量怎么办？您必须编写另一个 lambda 函数或创建一个闭包（PHP 5.3）：

```
$max_comp = function ($max) {
  return function ($v) use ($max) { return $v > $max; };
};

$input = array(1, 2, 3, 4, 5);
$output = array_filter($input, $max_comp(2)); 
```

闭包是在自己的环境中评估的函数，它具有一个或多个绑定变量，在调用函数时可以访问这些变量。它们来自函数式编程世界，其中有许多概念在起作用。闭包类似于 lambda 函数，但更智能的是它们能够与定义闭包的外部环境中的变量进行交互。

这是一个更简单的 PHP 闭包示例：

```
$string = "Hello World!";
$closure = function() use ($string) { echo $string; };

$closure(); 
```

[在这篇文章中很好地解释了。](http://www.codeforest.net/anonymous-or-lambda-functions-in-php)

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2014-11-09T17:46:45.397

这个问题很老，得到了很多答案。
现在有了作为非官方闭包项目的 Java 8 和 Official Lambda，它重新提出了这个问题。

Java 上下文中的答案（通过[Lambda 和闭包——有什么区别？](http://www.lambdafaq.org/lambdas-and-closures-whats-the-difference/)）：

> “闭包是与环境配对的 lambda 表达式，该环境将其每个自由变量绑定到一个值。在 Java 中，lambda 表达式将通过闭包实现，因此这两个术语在社区中可以互换使用。”

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2015-05-16T07:03:23.073

简单来说，闭包是一个关于作用域的技巧，lambda 是一个匿名函数。我们可以更优雅地用 lambda 实现闭包，并且 lambda 通常用作传递给更高层函数的参数

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2019-04-14T21:57:21.503

Lambda 表达式只是一个匿名函数。例如，在普通的 java 中，你可以这样写：

```
Function<Person, Job> mapPersonToJob = new Function<Person, Job>() {
    public Job apply(Person person) {
        Job job = new Job(person.getPersonId(), person.getJobDescription());
        return job;
    }
}; 
```

其中类 Function 只是用 java 代码构建的。现在你可以打电话`mapPersonToJob.apply(person)`到某个地方来使用它。这只是一个例子。那是一个 lambda，在它没有语法之前。Lambdas 是一个捷径。

关闭：

当 Lambda 可以访问此范围之外的变量时，它就变成了一个闭包。我想你可以说它的魔力，它可以神奇地环绕它创建的环境并使用其范围之外的变量（外部范围。所以要清楚，闭包意味着 lambda 可以访问它的外部范围。

在 Kotlin 中，lambda 始终可以访问其闭包（位于其外部范围内的变量）

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2021-03-16T21:17:02.823

**Lambda 与闭包**

`Lambda`是**匿名**函数（方法）

`Closure`是从其封闭范围（例如非局部变量）**关闭（捕获）变量的函数**

爪哇

```
interface Runnable {
    void run();
}

class MyClass {
    void foo(Runnable r) {

    }

    //Lambda
    void lambdaExample() {
        foo(() -> {});
    }

    //Closure
    String s = "hello";
    void closureExample() {
        foo(() -> { s = "world";});
    }
} 
```

斯威夫特[^([关闭])](https://stackoverflow.com/questions/24133879/what-are-the-differences-between-functions-and-methods-in-swift/60988242#60988242)

```
class MyClass {
    func foo(r:() -> Void) {}

    func lambdaExample() {
        foo(r: {})
    }

    var s = "hello"
    func closureExample() {
        foo(r: {s = "world"})
    }
} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2018-09-24T09:34:44.743

这取决于函数是否使用外部变量来执行操作。

**外部变量**- 定义在函数范围之外的变量。

*   Lambda 表达式是**无状态**的，因为它依赖于参数、内部变量或常量来执行操作。

    ```
    Function<Integer,Integer> lambda = t -> {
        int n = 2
        return t * n 
    } 
    ```

*   闭包**保持状态**是因为它使用外部变量（即定义在函数体范围之外的变量）以及参数和常量来执行操作。

    ```
    int n = 2

    Function<Integer,Integer> closure = t -> {
        return t * n 
    } 
    ```

当 Java 创建闭包时，它会将变量 n 保存在函数中，以便在传递给其他函数或在任何地方使用时都可以引用它。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2021-08-22T09:59:53.720

这个问题已经有 12 年历史了，我们仍然将它作为 Google 中“closures vs lambda”的第一个链接。所以我不得不说，因为没有人明确表示。

Lambda 表达式是一个匿名函数（声明）。

引用**Scott 的 Programming Language Pragmatics**的闭包解释为：

> ...创建引用环境的显式表示（通常是当前调用子例程将在其中执行的环境）并将其与对子例程的引用捆绑在一起...称为**闭包**。

也就是我们所说的“函数+放弃上下文”*的捆绑*。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2022-01-27T13:50:49.387

在这个问题的各种现有答案中，有很多技术上模糊或“甚至没有错”的人造珍珠的噪音，所以我最后要添加一个新的......

# 术语说明

最好知道，术语“闭包”和“lambda”都可以表示不同的事物，具体取决于上下文。

这是一个正式的问题，因为正在讨论的 PL（编程语言）的规范可能会明确定义这些术语。

例如，通过 ISO C++（自 C++11 起）：

> lambda 表达式的类型（也是闭包对象的类型）是唯一的、未命名的非联合类类型，称为闭包类型，其属性如下所述。

由于类 C 语言的用户每天都对指向“指针值”或“指针对象”（类型的居民）的“指针”（类型）感到困惑，因此这里也存在混淆的风险：大多数 C++ 用户实际上是在谈论使用术语“闭包”来“闭包对象”。小心歧义。

**注意**为了使事情更清晰和更精确，我很少故意使用一些与语言无关的术语（通常特定于[PL 理论](https://en.wikipedia.org/wiki/Programming_language_theory)而不是语言定义的术语。例如，上面使用的[类型居民](https://en.wikipedia.org/wiki/Type_inhabitation)涵盖了特定于语言的“（ r)values”和更广泛意义上的“lvalues”。（由于 C++*值类别定义的句法本质无关紧要，避免“(l/r)values”可能会减少混淆）。（免责声明：* [lvalues](https://en.wikipedia.org/wiki/Value_%28computer_science%29#lrvalue)和 rvalues在许多其他上下文。）未在不同 PL 中正式定义的术语可能会加引号。参考材料的逐字副本也可能加引号，但拼写错误保持不变。

这与“lambda”更为相关。（小写）字母 lambda (λ) 是希腊字母表的一个元素。与“lambda”和“closure”相比，当然不是在谈论字母本身，而是在使用“lambda”派生概念的语法背后的东西。

现代 PL 中的相关结构通常称为“lambda 表达式”。它源自下面讨论的“lambda 抽象”。

在详细讨论之前，我建议阅读问题本身的一些评论。我觉得它们比这里问题的大多数答案更安全，更有帮助，因为混淆的风险更小。（可悲的是，这是我决定在这里提供答案的最重要原因......）

# Lambdas：简史

PL 中名为“lambda”的构造，无论是“lambda 表达式”或其他什么，都是*syntactic*的。换句话说，语言的用户可以找到用于构建其他东西的*源语言结构。*粗略地说，“其他”在实践中只是“匿名函数”。

此类构造源自*lambda 抽象*，它是 A. Church 开发的[（无类型）lambda 演算](https://en.wikipedia.org/wiki/Lambda_calculus)的三个语法类别（“表达式种类”）之一。

Lambda 演算是一个演绎系统（更准确地说，是一个[TRS（术语重写系统）](https://en.wikipedia.org/wiki/Rewriting#Term_rewriting_systems)），用于对计算进行普遍建模。减少 lambda 项的 a 就像评估普通 PL 中的表达式一样。使用内置的归约规则，定义各种计算方式就足够了。（您可能知道，[它是图灵完备的](https://en.wikipedia.org/wiki/Church%E2%80%93Turing_thesis)。）因此，它可以用作 PL。

**注**：评估 PL 中的表达式通常不能与减少 TRS 中的项互换。然而，lambda 演算是一种语言，所有归约结果都可以在源语言中表达（即作为 lambda 项），因此它们具有相同的含义。几乎所有实践中的 PL 都不具备此属性；描述其语义的演算可能包含不是源语言表达式的术语，并且归约可能比评估具有更详细的效果。

lambda 演算（lambda 项）中的每个项（“表达式”）都是变量、抽象或应用程序。这里的“变量”是符号的语法（只是变量的名称），它可以引用之前介绍的现有“变量”（语义上，可以简化为其他 lambda 项的实体）。引入变量的能力由抽象语法提供，它有一个前导字母 λ，后跟一个*绑定变量*、一个点和一个 lambda 项。在许多语言中，绑定变量在语法和语义上都类似于形参名称，而 lambda 抽象中的后面的 lambda 术语就像函数体一样。应用程序语法将 lambda 术语（“实际参数”）与某种抽象相结合，

**注意**lambda 抽象只能引入一个参数。要克服微积分内部的限制，请参阅[Currying](https://en.wikipedia.org/wiki/Currying)。

引入变量的能力使 lambda 演算成为一种典型的高级语言（尽管很简单）。另一方面，通过从 lambda 演算中移除变量和抽象特征，[组合逻辑](https://en.wikipedia.org/wiki/Combinatory_logic)可以被视为 PL。正是在这个意义上，组合逻辑是低级的：它们就像普通的汇编语言，不允许引入用户命名的变量（尽管宏需要额外的预处理）。（......如果不是更底层......通常汇编语言至少可以引入用户命名的标签。）

注意 lambda 抽象可以在任何其他 lambda 术语中就地构建，而无需指定名称来表示抽象。因此，整个 lambda 抽象形成了匿名​​函数（可能是嵌套的）。这是一个相当高级的特性（与不允许匿名或嵌套函数的 ISO C 相比）。

无类型 lambda 演算的继承者包括各种类型的 lambda 演算（如[lambda cube](https://en.wikipedia.org/wiki/Lambda_cube)）。这些更像是静态类型语言，需要对函数的形式参数进行类型注释。尽管如此，lambda 抽象在这里仍然具有相同的作用。

尽管 lambda 演算不打算直接用作在计算机中实现的 PL，但它们在实践中确实影响了 PL。值得注意的是，J. McCarthy`LAMBDA`在 LISP 中引入了运算符，以提供完全遵循 Church 的无类型 lambda 演算思想的函数。显然，这个名字`LAMBDA`来自字母 λ。LISP（后来）具有不同的语法（[S-expression](https://en.wikipedia.org/wiki/S-expression)），但表达式中的所有可编程元素`LAMBDA`都可以通过简单的语法转换直接映射到无类型 lambda 演算中的 lambda 抽象。

另一方面，许多其他 PL 通过其他方式表达类似的功能。引入可重用计算的一种稍微不同的方法是命名函数（或更准确地说，命名子例程），早期的 PL （如 FORTRAN）和派生自 ALGOL 的语言都支持这些方法。它们是由同时指定命名实体作为函数的语法引入的。这在某种意义上比 LISP 方言更简单（尤其是在实现方面），而且它似乎比 LISP 方言更流行了几十年。命名函数也可能允许匿名函数不共享的扩展，如函数重载。

尽管如此，越来越多的工业程序员最终发现[一流函数](https://en.wikipedia.org/wiki/First-class_function)的用处，并且对能够就地引入函数定义（在任意上下文中的表达式中，例如，作为某个其他函数的参数）的需求正在增加. 避免命名不需要的事物是自然且合法的，并且根据定义，任何命名函数在此都会失败。（你可能知道，[正确命名事物是计算机科学中众所周知的难题之一](https://skeptics.stackexchange.com/questions/19836).) 为了解决这个问题，匿名函数被引入传统上只提供命名函数（或类似函数的构造，如“方法”）的语言，如 C++ 和 Java。他们中的许多人将该功能命名为“lambda 表达式”或类似的 lambda 事物，因为它们基本上反映了 lambda 演算中基本相同的想法。*再生。*

有点歧义：在 lambda 演算中，所有术语（变量、抽象和应用程序）都是 PL 中的有效表达式；从这个意义上说，它们都是“lambda 表达式”。但是，为了丰富其特性而添加 lambda 抽象的 PL 可能会专门将抽象的语法命名为“lambda 表达式”，以与现有的其他类型的表达式区分开来。

# 闭包：历史

[数学](https://en.wikipedia.org/wiki/Closure_%28mathematics%29)中的闭包与[PL 中](https://en.wikipedia.org/wiki/Closure_%28computer_programming%29)的闭包不同。

在后一种情况下，该术语[由 PJ Landin 于 1964 年创造](https://www.cs.kent.ac.uk/people/staff/dat/tfp12/tfp12.pdf)，以在评估“以 Church 的 λ 符号为模型”的 PL 的实施中提供一流功能的支持。

具体到 Landin（[SECD 机器](https://en.wikipedia.org/wiki/SECD_machine)）提出的模型，[闭包由 λ 表达式和评估它的相对环境组成](https://www.cs.cmu.edu/%7Ecrary/819-f09/Landin64.pdf)，或者更准确地说：

> 一个环境部分，它是一个列表，其两项是 (1) 环境 (2) 标识符列表的标识符

> 和一个控制部分，它由一个列表组成，其唯一的项目是一个 AE

**注** *AE为论文中**应用性表达*的缩写。这是在 lambda 演算中暴露或多或少相同的应用程序功能的语法。还有一些额外的细节，比如[“应用程序”](https://en.wikipedia.org/wiki/Evaluation_strategy#Strict_evaluation)不过，在 lambda 演算中并不那么有趣（因为它纯粹是函数式的）。SECD 与这些微小差异的原始 lambda 演算不一致。例如，无论子项（“body”）是否具有范式，SECD 都会在任意单个 lambda 抽象上停止，因为它不会在没有应用抽象（“called”）的情况下减少子项（“evaluate the body”）。然而，这种行为可能更像今天的 PL，而不是 lambda 演算。SECD 也不是唯一可以评估 lambda 项的抽象机器；尽管用于类似目的的大多数其他抽象机器也可能有环境。与 lambda 演算（纯粹的）相比，这些抽象机器可以在一定程度上支持变异。

因此，在这个特定的上下文中，闭包是一种内部数据结构，用于使用 AE 实现对 PL 的特定评估。

访问闭包中的变量的规则反映了[词法作用域](https://en.wikipedia.org/wiki/Scope_%28computer_science%29#Lexical_scope)，在 1960 年代初期由命令式语言 ALGOL 60 首次使用。ALGOL 60 确实支持嵌套过程和将过程传递给参数，但不支持将过程作为结果返回。对于完全支持可由函数返回的一等函数的语言，ALGOL 60 风格实现中的静态链不起作用，因为被返回函数使用的自由变量可能不再存在于调用堆栈上。这是[向上的函数问题](https://en.wikipedia.org/wiki/Funarg_problem#Upwards_funarg_problem)。闭包通过捕获环境部分中的自由变量并避免在堆栈上分配它们来解决问题。

另一方面，早期的 LISP 实现都使用动态范围。这使得引用的变量绑定在全局存储中都可以访问，并且名称隐藏（如果有）是作为每个变量的基础实现的：一旦使用现有名称创建变量，旧的变量将由 LIFO 结构支持；换句话说，每个变量的名称都可以访问相应的全局堆栈。这有效地消除了对每个函数环境的需求，因为函数中没有捕获任何自由变量（它们已经被堆栈“捕获”）。

尽管一开始模仿了 lambda 表示法，但 LISP 与这里的 lambda 演算非常不同。lambda 演算是*静态作用域*的。也就是说，每个变量都表示由 lambda 抽象的最接近的相同命名形式参数限定的实例，该 lambda 抽象包含在其归约之前的变量。在 lambda 演算的语义中，减少应用程序将术语（“参数”）替换为抽象中的绑定变量（“形式参数”）。由于在 lambda 演算中所有值都可以表示为 lambda 项，因此这可以通过在归约的每个步骤中替换特定子项来直接重写来完成。

**注意**因此，环境对于减少 lambda 项并不是必不可少的。然而，扩展 lambda 演算的演算可以在文法中显式地引入环境，即使它只对纯计算（没有变异）进行建模。通过显式添加环境，可以对环境有专门的约束规则来强制执行环境归一化，从而加强微积分的方程理论。（参见[[Shu10]](https://web.wpi.edu/Pubs/ETD/Available/etd-090110-124904/unrestricted/jshutt.pdf) §9.1。）

LISP 完全不同，因为它的基本语义规则既不是基于 lambda 演算，也不是基于术语重写。因此，LISP 需要一些不同的机制来维护范围规则。它采用了基于环境数据结构保存变量到值映射（即变量绑定）的机制。在 LISP 的新变体中的环境中可能存在更复杂的结构（例如，词法作用域的 Lisp 允许突变），但最简单的结构在概念上等同于 Landin 论文定义的环境，如下所述。

LISP 实现在早期确实支持一流的函数，但是对于纯动态范围，没有真正的函数参数问题：它们可以避免堆栈上的分配并让全局所有者（GC、垃圾收集器）来管理引用变量的环境（和激活记录）中的资源。那时不需要闭包。这是闭包发明之前的早期实现。

*`FUNARG`1962 年左右，通过该设备在 LISP 1.5 中引入了近似于静态（词法）绑定的*深度绑定。*这最终使这个问题以“Funarg 问题”的名义广为人知。*

 ***注意** [AIM-199](https://dspace.mit.edu/bitstream/handle/1721.1/5854/AIM-199.pdf)指出这本质上是关于环境的。

Scheme 是[第一个默认](https://en.wikipedia.org/wiki/History_of_the_Scheme_programming_language#Influence)[支持词法作用域](https://en.wikipedia.org/wiki/Scheme_%28programming_language%29#Lexical_scope)的Lisp 方言（动态作用域可以通过现代版本的 Scheme 中的`make-parameter`/`parameterize`形式来模拟）。在后来的十年中进行了一些辩论，但最终大多数 Lisp 方言采用了默认词法作用域的想法，就像许多其他语言一样。从那时起，闭包作为一种实现技术在不同风格的 PL 中得到了更广泛的传播和流行。

## 闭包：演变

Landin 的原始论文首先将环境定义为将名称（“常量”）映射到命名对象（“原始”）的数学函数。然后，它将环境指定为“由名称/值对组成的列表结构”。后者也在早期的 Lisp 实现中作为*alist*（关联列表）实现，但现代语言实现不一定遵循这样的细节。特别是，可以*链接*环境以支持嵌套闭包，这不太可能被 SECD 等抽象机器直接支持。

除了环境之外，Landin 论文中“环境部分”的另一个组件用于保存 lambda 抽象的绑定变量的名称（函数的形式参数）。当不需要反映源信息时，这对于现代实现来说也是可选的（并且可能缺少），其中参数的名称可以被静态优化掉（精神上由 lambda 演算的 alpha 重命名规则授予）。

类似地，现代实现可能不会将句法结构（AE 或 lambda 项）直接保存为控制部分。相反，它们可能使用一些内部 IR（中间表示）或“编译”形式（例如，某些 Lisp 方言实现使用的 FASL）。这样的 IR 甚至不能保证是从`lambda`表单生成的（例如，它可以来自一些命名函数的主体）。

此外，环境部分可以保存其他信息，而不是用于 lambda 演算的评估。例如，[它可以保留一个额外的标识符，以提供额外的绑定来命名调用站点的环境](https://web.wpi.edu/Pubs/ETD/Available/etd-090110-124904/unrestricted/jshutt.pdf)。这可以实现基于 lambda 演算扩展的语言。

## 重新审视特定于 PL 的术语

此外，一些语言可以在它们的规范中定义“闭包”相关的术语来命名实体可以由闭包实现。这是不幸的，因为它会导致许多误解，例如“闭包是一个函数”。但幸运的是，大多数语言似乎都避免将其直接命名为语言中的句法结构。

尽管如此，这仍然比语言规范任意重载更完善的通用概念要好。仅举几例：

*   “对象”被重定向到“类的实例”（在[Java](https://docs.oracle.com/javase/specs/jls/se17/html/index.html) /CLR/“OOP”语言中）而不是[传统](https://www.ics.uci.edu/%7Ejajones/INF102-S18/readings/05_stratchey_1967.pdf)的“类型化存储”（在 C 和[C++](http://www.eel.is/c++draft/)中）或只是“值”（在许多 Lisps 中）；

*   “变量”被重定向到传统的称为“对象”（在[Golang](https://go.dev/ref/spec)中）以及可变状态（在许多新语言中），因此它不再与数学和纯函数式语言兼容；

*   “多态性”仅限于[包含多态性](https://en.wikipedia.org/wiki/Inclusion_polymorphism)（在 C++/“OOP”语言中），即使这些语言确实具有其他类型的多态性（参数多态性和临时多态性）。

## 关于资源管理

尽管在现代实现中省略了组件，但 Landin 论文中的定义相当灵活。它不限制如何将环境等组件存储在 SECD 机器的上下文之外。

在实践中，使用了各种策略。最常见和最传统的方法是让所有资源都归一个全局所有者所有，该所有者可以收集不再使用的资源，即（全局）GC，首先在 LISP 中使用。

其他方式可能不需要全局所有者并且对闭包具有更好的局部性，例如：

*   在 C++ 中，允许用户显式管理闭包中捕获的实体资源，方法是指定如何捕获 lambda 表达式的捕获列表中的每个变量（通过值复制、通过引用，甚至通过显式初始化程序）和确切的类型每个变量（智能指针或其他类型）。这可能是不安全的，但如果使用得当，它会获得更大的灵活性。

*   在 Rust 中，资源是通过依次尝试（通过实现）尝试不同的捕获模式（通过不可变借用、借用、移动）来捕获的，并且用户可以指定显式`move`。这比 C++ 更保守，但在某种意义上更安全（因为与 C++ 中未经检查的引用捕获相比，借用是静态检查的）。

上述所有策略都可以支持闭包（C++ 和 Rust 确实有“闭包类型”概念的特定语言定义）。管理闭包使用的资源的规程与闭包的资格无关。

因此，（虽然这里没有看到）[Thomas Lord 在 LtU 的关于闭包的图跟踪必要性的主张在技术上](http://lambda-the-ultimate.org/node/5007#comment-81721)也是不正确的。闭包可以解决 funarg 问题，因为它允许防止对激活记录（堆栈）的无效访问，但事实并没有神奇地断言对包含闭包的资源的每个操作*都是*有效的。这种机制依赖于外部执行环境。应该清楚的是，即使在传统实现中，隐式所有者（GC）也不*是*闭包，所有者的存在是 SECD 机器的实现细节（因此它是用户的“高阶”细节之一）。这样的细节是否支持图追踪对闭包的限定没有影响。此外，AFAIK，[语言结构`let`与`rec`1966 年首次在 ISWIM 中引入（再次由 P. Landin 引入）](https://www.cs.kent.ac.uk/people/staff/dat/tfp12/tfp12.pdf)，它无法强制执行比其更早发明的闭包的原始含义。

# 关系

因此，总结起来，闭包可以（非正式地）定义为：

(1) PL 实现特定的数据结构，包括作为功能类实体的环境部分和控制部分，其中：

(1.1) 控制部分源自一些源语言结构，指定了类函数实体的求值结构；

(1.2) 环境部分由环境和可选的其他实现定义的数据组成；

(1.3) (1.2) 中的环境由类函数实体的潜在上下文相关源语言构造确定，用于保存捕获的自由变量，出现在创建类函数实体的源语言构造的评估构造中.

(2) 或者，使用 (1) 中名为“闭包”的实体的实现技术的总称。

Lambda 表达式（抽象）只是源语言中用于引入（创建）未命名的类函数实体的句法结构之一*。*PL 可以提供它作为引入类函数实体的唯一方式。

一般来说，源程序中的 lambda 表达式与程序执行过程中是否存在闭包之间没有明确的对应关系。由于实现细节对程序的可观察行为没有影响，PL 实现通常允许在可能的情况下合并为闭包分配的资源，或者在与程序语义无关时完全省略创建它们：

*   该实现可以检查lambda表达式中要捕获的自由变量的集合，当集合为空时，可以避免引入环境部分，因此类函数实体不需要维护闭包。这种策略通常在静态语言的规则中强制执行。

*   否则，实现可能会或可能不会总是为通过评估 lambda 表达式是否有要捕获的变量而产生的类函数实体创建闭包。

Lambda 表达式可以计算为类似函数的实体。一些 PL 的用户可能将这种类似函数的实体称为“闭包”。在这种情况下，“匿名函数”应该是这种“闭包”的更中性名称。

# 附录：函数：凌乱的历史

这与问题没有直接关系，但值得注意的是“函数”可以在不同的上下文中命名不同的实体。

数学上已经[是一团糟了](https://en.wikipedia.org/wiki/History_of_the_function_concept)。

目前我懒得在 PL 的上下文中总结它们，但作为警告：密切关注上下文以确保不同 PL 中“功能”的各种定义不会使你的推理偏离主题。

至于一般使用“匿名函数”（在实践中由 PL 共享），我相信它不会在这个主题上引入重大的混淆和误解。

Named functions may have a slightly more problems. Functions may denote the entity of the name themselves (the "symbols"), as well as the evaluated values of these names. Given that the fact that most PLs don't have unevaluated context to differentiate a function with some other entities carrying interesting meaning (e.g. `sizeof(a_plain_cxx_function)` in C++ just ill-formed), users may not observe the differences of the misinterpretation between unevaluated operand and evaluated values. That will be problematic with some Lisp dialects having `QUOTE`. [Even experienced PL specialists can easily miss something important](https://eighty-twenty.org/2011/09/29/fexprs-remain-inscrutable#comment-418744898); this is also why I emphasize to distinguish syntactic constructs with other entities.

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-03-01T16:45:01.433

Lambda 是一个匿名函数*定义*，未（必然）绑定到标识符。

> “匿名函数起源于 Alonzo Church 在他发明的 lambda 演算中的工作，其中所有函数都是匿名的” -[维基百科](https://en.wikipedia.org/wiki/Anonymous_function)

闭包是 lambda 函数的实现。

> “Peter J. Landin 在 1964 年将术语闭包定义为具有环境部分和控制部分，供他的 SECD 机器用于评估表达式” -[维基百科](https://en.wikipedia.org/wiki/Closure_(computer_programming)#History_and_etymology)

Lambda 和 Closure 的一般解释在其他响应中进行了介绍。

对于那些具有 C++ 背景的人，Lambda 表达式是在 C++11 中引入的。将 Lambda 视为创建匿名函数和函数对象的便捷方式。

> “lambda 和对应的闭包之间的区别恰恰等同于类和类的实例之间的区别。一个类只存在于源代码中；它在运行时不存在。运行时存在的是对象类类型。闭包之于 lambda 就像对象之于类一样。这应该不足为奇，因为每个 lambda 表达式都会导致生成一个唯一的类（在编译期间），并且还会导致该类类型的对象，即创建闭包（在运行时）。” -[斯科特迈尔斯](http://scottmeyers.blogspot.com/2013/05/lambdas-vs-closures.html)

C++ 允许我们检查 Lambda 和 Closure 的细微差别，因为您必须明确指定要捕获的自由变量。

在下面的示例中，Lambda 表达式没有自由变量，一个空的捕获列表 ( `[]`)。它本质上是一个普通函数，在最严格的意义上不需要闭包。所以它甚至可以作为函数指针参数传递。

```
void register_func(void(*f)(int val))   // Works only with an EMPTY capture list
{
    int val = 3;
    f(val);
}

int main() 
{
    int env = 5;
    register_func( [](int val){ /* lambda body can access only val variable*/ } );
} 
```

一旦在捕获列表 ( `[env]`) 中引入来自周围环境的自由变量，就必须生成一个闭包。

```
 register_func( [env](int val){ /* lambda body can access val and env variables*/ } ); 
```

由于这不再是一个普通的函数，而是一个闭包，它会产生编译错误。
`no suitable conversion function from "lambda []void (int val)->void" to "void (*)(int val)" exists`

可以使用函数包装器修复错误，该函数包装器`std::function`接受任何可调用目标，包括生成的闭包。

```
void register_func(std::function<void(int val)> f) 
```

有关 C++ 示例的详细说明，请参阅[Lambda 和 Closure](https://cognitivewaves.wordpress.com/lambda-and-closure/)。

# web-applications - 在同一服务器上部署多个 Web 应用程序

> ID：220661
> 
> 赞同：4
> 
> 时间：2008-10-21T03:14:15.840
> 
> 标签：web-applications

我正在考虑使用以下架构在同一台服务器上部署多个（和不同的）Web 应用程序：

www.mydomain.com/app1

www.mydomain.com/app2

这是一个好习惯吗？有什么建议吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-21T03:20:45.623

我看不出有什么明显的理由说明你不应该*这样*做。毕竟，并不是每个网站都只专注于一个任务或应用程序。另一种方法是使用子域，例如：

app1.mydomain.com
app2.mydomain.com

例如，雅虎和谷歌都使用这些。不过，文件夹方法是启动并运行测试的好方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T04:40:23.543

一个原因是如果您想支持与您的 Web 服务器的 SSL 连接。

如果您使用基于文件夹的方法，那么您对 ​​SSL 证书没有任何问题。

如果您选择子域方法（app1.mydomain.com、app2.mydomain.com 等），您可能需要更昂贵的通配符 SSL 证书或多个证书。

如果您不需要 SSL 或很少有需要它的应用程序，这不是问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T03:25:12.433

这种方法的唯一缺点是，如果任何应用程序最终移动到不同的服务器，您将需要进行一些重定向或反向代理，而对于子域，您只需要更改movedapp.domain.com 的A 记录.

因此，为了使其面向未来，我将创建子域。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T03:19:55.203

如果应用程序都与域相关，我认为以这种方式做事没有问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T03:29:02.737

您没有提及任何技术，但如果您碰巧为此使用 Java，则 Web 应用程序（默认情况下）不会共享任何会话信息。如果您希望用户登录到一个 Web 应用程序并同时登录到另一个 Web 应用程序，这可能会成为一个问题。

某些容器（Tomcat、Glassfish）具有单点登录功能，可作为特定于实现的功能。

只是该决定的一些后果的仅供参考。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T03:36:05.233

我通常的做法是将网站视为服务于单一目的。“单一”实际上在这里定义了一个广泛的目标和使用模式。如果多个应用程序都可以组合在一起并协同工作以实现站点的单一目的，那么

mydomain.com/app1 和 mydomain.com/app2 非常好。

这意味着它们的存在和存在是为了增加主站点。

如果应用程序彼此没有太大关系并且几乎都生活在它们的“自己的世界”中，那么它们可能应该作为它们自己的子域存在。

app1.mydomain.com 和 app2.mydomain.com

这允许您将 DNS 策略设置为不同的 IP 地址（Web 服务器/场），而不是将它们捆绑在同一个池中。

# ruby-on-rails - Ruby on Rails 的持续集成？

> ID：220668
> 
> 赞同：149
> 
> 时间：2008-10-21T03:16:54.727
> 
> 标签：ruby-on-rails, ruby, continuous-integration

我一直在寻找 Ruby on Rails 的持续集成解决方案，但对结果不太满意。我来自一家使用 CruiseControl.NET 的 .NET 商店，并且对它的易用性和丰富的状态/报告功能非常满意。

理想情况下，我正在寻找：

*   明显的 Git/SVN 和 Test::Unit 集成

*   与 Rake 和/或 Capistrano 集成

*   显示构建状态的 Web 界面

*   失败构建的电子邮件通知。

*   桌面通知（可能通过 Growl）

*   用于构建状态的 REST API

*   用于在 UI 中运行其他代码分析工具和报告结果的插件框架

* * *

## 回答 #1

> 赞同：83
> 
> 时间：2011-11-08T18:35:52.963

I just went through the options here and thought I'd roll them up as of late 2011.

## [Integrity](https://github.com/integrity/integrity)

After a **near-death experience** that left the still-linked-to [website](http://integrityapp.com/) with **outdated information** and downed the demo site, this project has a spark of life again. But the documentation hasn't moved on, and lots and lots of the **steps in the tutorial are just plain broken**; I had to change references to gems, build some things out of band, and then **I still couldn't get it working**.

## [Cruise Control.rb](http://cruisecontrolrb.thoughtworks.com/)

**Dead simple**: you just download it, run a command line to add your project (there is **no UI** for doing so), and run the Rails app. But there's no UI for editing your project, either, and there's **no real integration with build artifacts** aside from displaying links to them: you get no graphs of tests run, no trend lines, etc. I also had to adjust the `routes.rb` file to get the code linking working (the `resources :projects` line needs to move below all the other non-default routes).

## [TeamCity](http://www.jetbrains.com/teamcity/)

This **looks awesome**, but the pay scale seems out of whack. 3 agents free and then when you're dependent you need to dole out hundreds of dollars. **Personal Builds** looks great, but **don't have the budget**.

## [Jenkins](http://jenkins-ci.org/) (née [Hudson](http://hudson-ci.org/))

This is a Java stalwart and it is **loaded up with a thousand options**, so the **UI is confusing** and it's a **chore to set up your projects**. But once you set it up you get a **whole lot of plugins** that can pull from most anywhere, run most anything, and report most everything. The OS X Installer points Jenkins at `/Users/Shared/Jenkins/Home` but fails to create that directory or `chown` it to `daemon` (which is uses by default, and you should change to a new `jenkins` user so you can set up GitHub integration).

## Others

I didn't really try these, but thought I'd mention why:

*   [CI Joe](https://github.com/defunkt/cijoe) wants to own the GitHub repo more than I want it, and its creators aren't even using it; they're on Jenkins.
*   [Cerberus](http://cerberus.rubyforge.org/) seems neatly small but doesn't have a UI and doesn't automatically publish build artifacts where others can see them.
*   [BigTuna](http://bigtuna.appelier.com/) seems to be a CruiseControl.rb clone without the (already minimal) community support.
*   [Bamboo](http://www.atlassian.com/software/bamboo) looks really neat if you use JIRA and BitBucket, but we use neither. It does deploys but we already have those set up in Capistrano.

## The Choice

We went with [Jenkins](http://jenkins-ci.org/), but I really wish one of the lighter-weight solutions had worked out.

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2008-10-21T03:30:30.830

[CruiseControl.rb](http://cruisecontrolrb.thoughtworks.com/)怎么样？

做`CruiseControl`（思想工作）并写在`Ruby`. 非常易于使用`Rake`以集成您的其他工具，并且可以使用[ruby​​-growl](http://segment7.net/projects/ruby/growl/) gem 进行通知。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2008-10-21T06:33:41.943

您可能还想考虑[Hudson](http://hudson.gotdns.com/wiki/display/HUDSON/Unit+Test)。它是为 Java 项目而设计的，尽管有很多可用的插件可供选择，包括对 Ruby 和 Rake 的支持。它有一个非常有用的 Web 界面，并支持电子邮件通知以及许多其他功能（如 twitter 或巨型熊灯）。

The community is also very active and there have been [several articles](http://www.thinkvitamin.com/features/webapps/easy-automated-web-application-testing-with-hudson-and-selenium) on hooking up Hudson with Selenium which you might be helpful for testing Rails applications on the browser side.

Another one look at is [Team City](http://www.jetbrains.com/teamcity/) which is free for small projects and teams (including commercial). I really like Team City and have used it before for other projects but currently we're using Mercurial for source control and Team City's support was a little too beta when we were considering it.

I switched from CruiseControl.net to Team City and was absolutely shocked at the improvement. I'm partial to Hudson though because of its similar feature set and very active community.

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2012-08-23T01:03:18.373

[Circle](https://circleci.com) is an [advanced CI service for Rails](https://circleci.com) (and other web apps). From your list, it supports the following:

*   **Git and Test::Unit integration** (*also RSpec, Cucumber, Jasmine, Konacha integrations, and supports arbitrary extra test commands*)
*   **Integration with Rake and/or Capistrano** (*uses Rake to run commands and set up DBs, support continuous deployment using Capistrano or Heroku, or anything really*)
*   **A web interface showing the status of the build**
*   **Email notification of failed builds.**
*   **Desktop notification** (*through CCMenu/CCTray*)
*   **REST API for build statuses**
*   **Plugin framework for running other code analysis tools and reporting results in the UI** (*we can run arbitrary commands and support including their status as part of the build*)

Joel and I spent a while chatting about this on the [Stackoverflow podcast](https://blog.stackoverflow.com/2011/10/se-podcast-22/) - [check it out](https://blog.stackoverflow.com/2011/10/se-podcast-22/)!

* * *

*(edit) Disclaimer: Paul Biggar founded Circle as he states in his Stackoverflow profile*

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2012-06-12T11:09:59.893

[Semaphore](https://semaphoreapp.com) is a new hosted CI app for Ruby and Rails apps. It integrates with GitHub, requires no setup and has a simple UI.

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2013-03-06T20:41:10.097

# Updated Feb-2015

## [Codeship](https://codeship.com/)

There was a lack of development on Drone.io so I switched to Codeship and I'm thoroughly enjoying it. It's actively developed and improved, has great design and is very fast. Plus, for the bottom tier it's actually free (up to 100 builds per month) so it ended up being cheaper than Drone.io.

# Original Answer

## [Drone.io](http://drone.io)

I just setup our main Ruby on Rails application with [http://drone.io/](http://drone.io/). Was a piece of cake and it's got a great interface. I'd say worth checking out if you're looking for a **simple, hosted solution**.

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2011-09-09T04:33:04.783

Check out [Tddium](http://www.tddium.com). Tddium support continuous integration, deployment and interactive testing of Ruby applications. It provides a managed environment with support for Selenium, Headless Webkit, and Solr. It hosts live Postgres, MySQL, Mongo, and Redis instances. And it automatically parallelizes large test suites.

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2012-03-19T19:40:20.660

Travis CI has become popular in the ruby world: [http://travis-ci.org/](http://travis-ci.org/)

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-10-21T03:31:23.183

Cruisecontrol.rb 将是完美的匹配。

[http://cruisecontrolrb.thoughtworks.com/](http://cruisecontrolrb.thoughtworks.com/)

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2009-05-11T15:13:18.753

Like a number of people I was a huge fan of cruisecontrol.rb, but have recently switched my projects to [Integrity](http://integrityapp.com/).

Lightweight and easy to setup (much like cc.rb), but with a nicer interface.

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2010-12-15T07:19:07.920

[BigTuna](http://bigtuna.appelier.com/) - written in Ruby, uses Rails and using itself as its CI.

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2012-08-20T10:04:12.093

You can give [Codeship](http://codeship.io) a spin and see if it works for you (I am one of the founders)

Cloud based Continuous Integration and Deployment(with special Heroku support)

The first four of your items are already implemented and work fine for a number of companies

*   The obvious Git/SVN and Test::Unit integration
*   Integration with Rake and/or Capistrano
*   A web interface showing the status of the build
*   Email notification of failed builds.

We are working on those features as well:

*   Desktop notification (potentially through Growl)
*   REST API for build statuses
*   Plugin framework for running other code analysis tools and reporting results in the UI

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2010-11-21T02:49:47.067

Noone here mentioned Atlassian's Bamboo. There is a nice tutorial-like article about Ruby on Rails CI using Bamboo:

[http://blogs.atlassian.com/news/2009/05/bamboo_customer_8.html](http://blogs.atlassian.com/news/2009/05/bamboo_customer_8.html)

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2011-03-08T11:52:40.080

Integrity seems to be a great solution. Deploying onto heroku is a breeze: [http://elabs.se/blog/7-continuous-integration-testing-for-ruby-on-rails-with-integrity](http://elabs.se/blog/7-continuous-integration-testing-for-ruby-on-rails-with-integrity) http://integrityapp.com

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2013-07-14T19:14:56.173

Do it yourself. Write a bash script to run tests and then run a deployment procedure if tests pass. Need notifications? Shoot yourself a plaintext email on success/failure. Need scheduler? Cronjob. This is $0/mo., and you will have a clue as to what you are doing. I do not see how paying someone $40/mo will help me do this in any way more efficient.

Consider for example: my deployment is failing because of an incorrectly configured asset pipeline (assets fail to precompile). This is not going to be caught with unit, functional, integration, regression, or any other tests. This error will not be caught by CI. The amount of time I would spend writing a bash script is likely to be less than the amount of time I would spend setting up a CI environment, and I'll save myself $40/mo.

Juuuuuust throwing my two pennies into the discussion ; )

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-06-03T17:43:54.143

Run Code Run might be what you need.

Edit: link removed since it no longer refers to the former Run Code Run site.

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2010-12-02T03:53:10.737

And then, there is [CI Joe](https://github.com/defunkt/cijoe):

> It's like an old rusty pickup truck: it might be smelly and gross, but it gets the job done.

We use it on a daily basis.

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2011-12-16T09:48:46.533

I only like CI joe, I have had issues with all the rest, CI Joe is the absolute minimum to get the job done, super Agile and reliable. The hudson source is horrible, and the UI does not appeal to me.

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-06-14T21:49:31.803

I just published a very simple Continuous Integration App for RubyOnRails + SVN/GIT. Maybe you should give it a try:

[http://github.com/felipegiotto/Inotegration/tree/master](http://github.com/felipegiotto/Inotegration/tree/master)

I took some ideas of measurement and testing tools and, after trying some CI tools and not liking anyone of them, I decided to build my own, without needing to build big XML files or any other configuration. Just the way Rails was made to be.

If you like, please send me some feedback..

Best regards,

Felipe Giotto.

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2010-03-11T03:26:04.117

Running CI after every commit seems rather expensive if you subscribe to the "commit often" philosophy. How about running a simple cronjob every few hours and email the results to a dev mailing list?

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2011-08-04T11:10:39.513

I just configured a Hudson/Jenkins for it. The ci_reporter gem can help formatting JUnit output, what expected by Hudson, and Hudson has a Rails plugin, so I can see rcov coverage, test reports, rails stats and even more.

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2014-04-16T10:12:14.463

You should consider looking at CloudMunch as well. This provides a polyglot platform to allow you to have different languages as part of your codebase, with rich set of build metadata.

# string - 在 Excel 中将时间字段转换为字符串

> ID：220672
> 
> 赞同：37
> 
> 时间：2008-10-21T03:18:04.227
> 
> 标签：string, excel, text, time, formatting

我有一个完整的 Excel 表。

它们的格式如下：1:00:15

但是，如果我将单元格上的格式更改为文本，它们将更改为时间的基础数字表示：0.041840278

如何将单元格转换为文本单元格但仍有时间？

* * *

## 回答 #1

> 赞同：85
> 
> 时间：2008-10-21T04:00:51.020

这种情况在 Excel 中总是很痛苦，您必须使用函数转换值，因为一旦 Excel 将单元格转换为时间，它们就会在内部存储为数字。这是我知道如何做到这一点的最佳方法：

我假设您的时间从第 1 行开始在 A 列中。在单元格 B1 中输入此公式：`=TEXT(A1,"hh:mm:ss AM/PM")`，将公式向下拖动 B 列到 A 列中数据的末尾。从 B 列中选择值，复制，去到 C 列并选择“选择性粘贴”，然后选择“值”。选择刚刚复制到 C 列的单元格，并将单元格的格式设置为“文本”。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2008-10-21T03:24:53.883

复制列将其粘贴到记事本中再次复制粘贴特殊为文本

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2015-08-20T13:21:47.253

如果要将这些数值显示为时间，请将单元格的格式更改为时间。

如果您想将其转换为另一个单元格中的文本：

```
=TEXT(A1,"hh:mm:ss") 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-06-11T17:12:25.073

简单的。要将时间值（如：1:00:15）更改为文本，您可以使用“TEXT”功能。例如，如果您的时间值 (1:00:15) 包含在单元格“A1”中，您可以通过执行以下操作将其转换为文本：Text(A1, "h:mm:ss")。结果看起来仍然一样：1:00:15。但请注意，这一次，它已成为文本值。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-08-11T12:24:25.097

以下对我有用

*   首先在记事本中复制内容说“1:00:15”
*   然后选择一个新列，您需要从记事本复制文本。
*   然后右键单击并选择格式单元格选项，然后在该选择数字选项卡中，在该选项卡中选择选项“文本”。
*   现在从记事本复制内容并粘贴到此 Excel 列中。它将是文本，但格式为“1:00:15”。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-06-17T19:17:46.597

复制到 Date 变量，然后将其转换为 Text with `format()`。例子：

```
Function GetMyTimeField()
    Dim myTime As Date, myStrTime As String

    myTime = [A1]
    myStrTime = Format(myTime, "hh:mm")
    Debug.Print myStrTime & " Nice!"

End Function 
```

# grails - 为我的网站主页生成排名列表的最佳方法是什么？

> ID：220707
> 
> 赞同：2
> 
> 时间：2008-10-21T03:42:45.097
> 
> 标签：grails, cron, scheduling, ranking

为网站/webapp 的主页生成和维护多个排名列表的最佳方法是什么？例如热门帖子、最新帖子、最多评论、最多连胜等。

目前，我正在考虑使用 cron 作业调度程序来运行查询以收集统计信息，对统计信息运行算法，然后最终生成排名列表，然后将其保存到 mysql 中的临时表中。

但是，我不确定这是否是最有效的方法。我想使用一些缓存也会有所帮助。

注意：我使用的是 grails Web 应用程序框架。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T15:34:21.900

您可能还想考虑使用 Quartz 插件来安排您的任务。

[http://grails.org/Quartz+plugin](http://grails.org/Quartz+plugin)

# c# - 除了原生 UUID 之外，数据库中 UUID 最有效的数据类型

> ID：220717
> 
> 赞同：4
> 
> 时间：2008-10-21T03:48:11.357
> 
> 标签：c#, database, database-design, guid, uuid

在没有本机 UUID/GUID 数据类型的数据库中存储 UUID/GUID 的最有效数据类型是什么？2 BIGINT？

将 GUID 转换为该类型以及从 GUID 转换为该类型的最有效代码（首选 C#）是什么？

谢谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-21T07:01:46.880

如果不知道您正在使用的数据库，很难说什么是最有效的。

我的第一个倾向是使用`binary(16)`列。

至于在 C# 中使用该值，该`System.Guid`类型有一个接受`byte[]`数组的构造函数和一个`ToByteArray()`返回字节数组的方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T04:28:00.933

根据我的经验，将 UUID 分成两个整数仍然比使用 char 字段更有效。但是，不同的数据库以不同的方式做出反应。校对也可以在那里有所作为。话虽如此，整个应用程序通常都有更大的性能“罪过”，我认为这对许多应用程序来说都不是一件大事。您必须根据您的应用程序的这部分会变得多忙来判断自己？您是否需要通过 UUID 进行绝对最快的查询？600ns 和 400ns 对你来说有很大的时间差异吗？

如果要使用 db 执行大量手动 sql，那么当您需要进行插入并且没有 db 默认值时，拥有一个包含来自不同字段的 UUID 的键会很臭。不过，这也是字符的问题。

如果你有一个数据库抽象层，那么组合多个表字段来获取你的 UUID 应该没什么大不了的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T04:06:41.820

查看[.NET guid 类](http://msdn.microsoft.com/en-us/library/system.guid.guid.aspx)，有几种初始化 guid 的方法：

Guid（Int32，Int16，Int16，字节，字节，字节，字节，字节，字节，字节，字节） Guid（字符串）

虽然理论上将整数存储在数据库中可能更有效（您可以使用位移来真正存储 4 个 32 位整数。但每次加载和保存时都必须计算出来。另外，它将在数据库中占用 4 个字段。我想它最终会降低效率。

加上为了调试/测试目的而直接在数据库中读取它的可能性，我会说最好存储一个字符串。它只是一个 32 个字符的字段（如果包含破折号，则为 36 个），并且很容易转换。指导。[ToString()](http://msdn.microsoft.com/en-us/library/system.guid.guid.aspx)和 [新 Guid(stringValue);](http://msdn.microsoft.com/en-us/library/96ff78dc.aspx)

# c++ - 使用 set.insert(key) 作为条件？

> ID：220718
> 
> 赞同：8
> 
> 时间：2008-10-21T03:48:11.997
> 
> 标签：c++, insert, conditional, set

我试图`set.insert (key)`用作条件，如果正确插入了密钥（这意味着密钥在集合中不存在），那么它应该继续执行某种代码。例如，类似：

```
if (set.insert( key )) {
    // some kind of code
} 
```

这是允许的吗？因为编译器抛出这个错误：

```
conditional expression of type 'std::_Tree<_Traits>::iterator' is illegal 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-21T03:53:47.883

采用单个键值的 insert 版本应返回 a `std::pair<iterator,bool>`，其中 bool 指示是否进行了插入。true 值表示已插入该值，false 表示该值已存在。所以你的条件看起来像这样：

```
if( set.insert( key ).second ) {
      // code
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-21T03:53:36.573

set::insert 返回一对，试试这个：

```
if( set.insert( key ).second ) {
    // some kind of code
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T18:17:25.610

其他答案建议只使用“.second”，这将起作用 - 但如果您需要执行的处理使用集合中的现有条目，那么您可以存储插入的完整结果：

```
std::pair<std::set<key>::iterator, bool> iResult = set.insert (key);
if (iResult.second) {
    // some kind of code - insert took place
}
else {
    // some kind of code using iResult.first, which
    // is an iterator to the previous entry in the set.
} 
```

# delphi - 将字符串传递给已运行的应用程序实例

> ID：220719
> 
> 赞同：11
> 
> 时间：2008-10-21T03:52:43.967
> 
> 标签：delphi, winapi

我有一个应用程序，它检测是否有另一个应用程序实例正在运行，如果找到则退出。这部分似乎工作可靠。我的应用程序需要一个命令行参数，我想将它传递给已经运行的实例。到目前为止，我有以下代码：

## 项目1.dpr

```
program Project1;

uses
  ...
  AppInstanceControl in 'AppInstanceControl.pas';

  if not AppInstanceControl.RestoreIfRunning(Application.Handle) then
  begin
    Application.Initialize;
    Application.MainFormOnTaskbar := True;
    Application.CreateForm(TFormMain, FormMain);
    Application.Run;
  end;

end. 
```

## AppInstanceControl.pas

{ 基于在[http://delphi.about.com/library/code/ncaa100703a.htm](http://delphi.about.com/library/code/ncaa100703a.htm)找到的 Zarko Gajic 的代码}

```
unit AppInstanceControl;

interface

uses
  Windows,
  SysUtils;

function RestoreIfRunning(const AAppHandle: THandle; const AMaxInstances: integer = 1): boolean;

implementation

uses
  Messages;

type
  PInstanceInfo = ^TInstanceInfo;
  TInstanceInfo = packed record
    PreviousHandle: THandle;
    RunCounter: integer;
  end;

var
  UMappingHandle: THandle;
  UInstanceInfo: PInstanceInfo;
  UMappingName: string;

  URemoveMe: boolean = True;

function RestoreIfRunning(const AAppHandle: THandle; const AMaxInstances: integer = 1): boolean;
var
  LCopyDataStruct : TCopyDataStruct;
begin
  Result := True;

  UMappingName := StringReplace(
                   ParamStr(0),
                   '\',
                   '',
                   [rfReplaceAll, rfIgnoreCase]);

  UMappingHandle := CreateFileMapping($FFFFFFFF,
                                     nil,
                                     PAGE_READWRITE,
                                     0,
                                     SizeOf(TInstanceInfo),
                                     PChar(UMappingName));

  if UMappingHandle = 0 then
    RaiseLastOSError
  else
  begin
    if GetLastError <> ERROR_ALREADY_EXISTS then
    begin
      UInstanceInfo := MapViewOfFile(UMappingHandle,
                                    FILE_MAP_ALL_ACCESS,
                                    0,
                                    0,
                                    SizeOf(TInstanceInfo));

      UInstanceInfo^.PreviousHandle := AAppHandle;
      UInstanceInfo^.RunCounter := 1;

      Result := False;
    end
    else //already runing
    begin
      UMappingHandle := OpenFileMapping(
                                FILE_MAP_ALL_ACCESS, 
                                False, 
                                PChar(UMappingName));
      if UMappingHandle <> 0 then
      begin
        UInstanceInfo := MapViewOfFile(UMappingHandle,
                                      FILE_MAP_ALL_ACCESS,
                                      0,
                                      0,
                                      SizeOf(TInstanceInfo));

        if UInstanceInfo^.RunCounter >= AMaxInstances then
        begin
          URemoveMe := False;

          if IsIconic(UInstanceInfo^.PreviousHandle) then
            ShowWindow(UInstanceInfo^.PreviousHandle, SW_RESTORE);
          SetForegroundWindow(UInstanceInfo^.PreviousHandle);
        end
        else
        begin
          UInstanceInfo^.PreviousHandle := AAppHandle;
          UInstanceInfo^.RunCounter := 1 + UInstanceInfo^.RunCounter;

          Result := False;
        end
      end;
    end;
  end;
  if (Result) and (CommandLineParam <> '') then
  begin
    LCopyDataStruct.dwData := 0; //string
    LCopyDataStruct.cbData := 1 + Length(CommandLineParam);
    LCopyDataStruct.lpData := PChar(CommandLineParam);

    SendMessage(UInstanceInfo^.PreviousHandle, WM_COPYDATA, Integer(AAppHandle), Integer(@LCopyDataStruct));
  end;
end; (*RestoreIfRunning*)

initialization

finalization
  //remove this instance
  if URemoveMe then
  begin
    UMappingHandle := OpenFileMapping(
                        FILE_MAP_ALL_ACCESS, 
                        False, 
                        PChar(UMappingName));
    if UMappingHandle <> 0 then
    begin
      UInstanceInfo := MapViewOfFile(UMappingHandle,
                                  FILE_MAP_ALL_ACCESS,
                                  0,
                                  0,
                                  SizeOf(TInstanceInfo));

      UInstanceInfo^.RunCounter := -1 + UInstanceInfo^.RunCounter;
    end
    else
      RaiseLastOSError;
  end;

  if Assigned(UInstanceInfo) then UnmapViewOfFile(UInstanceInfo);
  if UMappingHandle <> 0 then CloseHandle(UMappingHandle);

end. 
```

## 在主窗体单元中：

```
procedure TFormMain.WMCopyData(var Msg: TWMCopyData);
var
  LMsgString: string;
begin
  Assert(Msg.CopyDataStruct.dwData = 0);
  LMsgString := PChar(Msg.CopyDataStruct.lpData);

  //do stuff with the received string

end; 
```

我很确定问题是我试图将消息发送到正在运行的应用程序实例的句柄，但试图在主窗体上处理消息。我想我在这里有两个选择：

A）从应用程序的句柄以某种方式获取其主窗体的句柄并将消息发送到那里。

B）在应用程序而不是主表单级别处理接收消息。

我也不确定该怎么做。有更好的方法吗？

谢谢。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-21T05:23:01.463

如果使用 WM_COPYDATA，则无需创建文件映射。这就是 WM_COPYDATA 的全部意义 - 它为您完成了所有这些。

发送字符串

```
procedure IPCSendMessage(target: HWND;  const message: string);
var
  cds: TCopyDataStruct;
begin
  cds.dwData := 0;
  cds.cbData := Length(message) * SizeOf(Char);
  cds.lpData := Pointer(@message[1]);

  SendMessage(target, WM_COPYDATA, 0, LPARAM(@cds));
end; 
```

接收字符串

```
procedure TForm1.WMCopyData(var msg: TWMCopyData);
var
  message: string;
begin
  SetLength(message, msg.CopyDataStruct.cbData div SizeOf(Char));
  Move(msg.CopyDataStruct.lpData^, message[1], msg.CopyDataStruct.cbData);

  // do something with the message e.g.
  Edit1.Text := message;
end; 
```

根据需要修改以发送其他数据。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-21T09:13:02.137

事实证明，这确实很难可靠地做到。我只花了两个小时试图从一个五分钟的解决方案中找出所有的故障:( 不过现在似乎正在工作。

下面的代码在 D2007 中适用于新式 (MainFormOnTaskbar = True) 和旧式方法。因此，我相信它也适用于较旧的 Delphi 版本。它在最小化和正常状态下的应用程序中进行了测试。

测试项目可从[http://17slon.com/krama/ReActivate.zip](http://17slon.com/krama/ReActivate.zip)（小于 3 KB）获得。

为了在线阅读、索引和备份，所有重要的单元都附在下面。

### 主程序

```
program ReActivate;

uses
  Forms,
  GpReActivator, 
  raMain in 'raMain.pas' {frmReActivate};

{$R *.res}

begin
   if ReactivateApplication(TfrmReActivate, WM_REACTIVATE) then
    Exit;

  Application.Initialize;
  Application.MainFormOnTaskbar := True;
//  Application.MainFormOnTaskbar := False;
  Application.CreateForm(TfrmReActivate, frmReActivate);
  Application.Run;
end. 
```

### 主机

```
unit raMain;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs;

const
  WM_REACTIVATE = WM_APP;

type
  TfrmReActivate = class(TForm)
  private
  public
    procedure ReActivate(var msg: TMessage); message WM_REACTIVATE;
  end;

var
  frmReActivate: TfrmReActivate;

implementation

{$R *.dfm}

uses
  GpReactivator;

{ TfrmReActivate }

procedure TfrmReActivate.ReActivate(var msg: TMessage);
begin
  GpReactivator.Activate;
end;                         

end. 
```

### 辅助单元

```
unit GpReActivator;

interface

uses
  Classes;

procedure Activate;
function ReActivateApplication(mainFormClass: TComponentClass; reactivateMsg: cardinal):
  boolean;

implementation

uses
  Windows,
  Messages,
  SysUtils,
  Forms;

type
  TProcWndInfo = record
    ThreadID     : DWORD;
    MainFormClass: TComponentClass;
    FoundWindow  : HWND;
  end; { TProcWndInfo }
  PProcWndInfo = ^TProcWndInfo;

var
  fileMapping      : THandle;
  fileMappingResult: integer;

function ForceForegroundWindow(hwnd: THandle): boolean;
var
  foregroundThreadID: DWORD;
  thisThreadID      : DWORD;
  timeout           : DWORD;
begin
  if GetForegroundWindow = hwnd then
    Result := true
  else begin

    // Windows 98/2000 doesn't want to foreground a window when some other
    // window has keyboard focus

    if ((Win32Platform = VER_PLATFORM_WIN32_NT) and (Win32MajorVersion > 4)) or
      ((Win32Platform = VER_PLATFORM_WIN32_WINDOWS) and
      ((Win32MajorVersion > 4) or ((Win32MajorVersion = 4) and (Win32MinorVersion > 0)))) then
    begin

      // Code from Karl E. Peterson, www.mvps.org/vb/sample.htm
      // Converted to Delphi by Ray Lischner
      // Published in The Delphi Magazine 55, page 16

      Result := false;
      foregroundThreadID := GetWindowThreadProcessID(GetForegroundWindow,nil);
      thisThreadID := GetWindowThreadPRocessId(hwnd,nil);
      if AttachThreadInput(thisThreadID, foregroundThreadID, true) then begin
        BringWindowToTop(hwnd); //IE 5.5 - related hack
        SetForegroundWindow(hwnd);
        AttachThreadInput(thisThreadID, foregroundThreadID, false);
        Result := (GetForegroundWindow = hwnd);
      end;
      if not Result then begin

        // Code by Daniel P. Stasinski <dannys@karemor.com>

        SystemParametersInfo(SPI_GETFOREGROUNDLOCKTIMEOUT, 0, @timeout, 0);
        SystemParametersInfo(SPI_SETFOREGROUNDLOCKTIMEOUT, 0, TObject(0), SPIF_SENDCHANGE);
        BringWindowToTop(hwnd); //IE 5.5 - related hack
        SetForegroundWindow(hWnd);
        SystemParametersInfo(SPI_SETFOREGROUNDLOCKTIMEOUT, 0, TObject(timeout), SPIF_SENDCHANGE);
      end;
    end
    else begin
      BringWindowToTop(hwnd); //IE 5.5 - related hack
      SetForegroundWindow(hwnd);
    end;

    Result := (GetForegroundWindow = hwnd);
  end;
end; { ForceForegroundWindow }

procedure Activate;
begin
  if (Application.MainFormOnTaskBar and (Application.MainForm.WindowState = wsMinimized))
     or
     ((not Application.MainFormOnTaskBar) and (not IsWindowVisible(Application.MainForm.Handle)))
  then
    Application.Restore
  else
    Application.BringToFront;
  ForceForegroundWindow(Application.MainForm.Handle);
end; { Activate }

function IsTopDelphiWindow(wnd: HWND): boolean;
var
  parentWnd: HWND;
  winClass  : array [0..1024] of char;
begin
  parentWnd := GetWindowLong(wnd, GWL_HWNDPARENT);
  Result :=
    (parentWnd = 0)
    or
    (GetWindowLong(parentWnd, GWL_HWNDPARENT) = 0) and
    (GetClassName(parentWnd, winClass, SizeOf(winClass)) <> 0) and
    (winClass = 'TApplication');
end; { IsTopDelphiWindow }

function EnumGetProcessWindow(wnd: HWND; userParam: LPARAM): BOOL; stdcall;
var
  procWndInfo: PProcWndInfo;
  winClass   : array [0..1024] of char;
begin
  procWndInfo := PProcWndInfo(userParam);
  if (GetWindowThreadProcessId(wnd, nil) = procWndInfo.ThreadID) and
     (GetClassName(wnd, winClass, SizeOf(winClass)) <> 0) and
     IsTopDelphiWindow(wnd) and
     (string(winClass) = procWndInfo.MainFormClass.ClassName) then
  begin
    procWndInfo.FoundWindow := Wnd;
    Result := false;
  end
  else
    Result := true;
end; { EnumGetProcessWindow }

function GetThreadWindow(threadID: cardinal; mainFormClass: TComponentClass): HWND;
var
  procWndInfo: TProcWndInfo;
begin
  procWndInfo.ThreadID := threadID;
  procWndInfo.MainFormClass := mainFormClass;
  procWndInfo.FoundWindow := 0;
  EnumWindows(@EnumGetProcessWindow, LPARAM(@procWndInfo));
  Result := procWndInfo.FoundWindow;
end; { GetThreadWindow }

function ReActivateApplication(mainFormClass: TComponentClass; reactivateMsg: cardinal):
  boolean;
var
  mappingData: PDWORD;
begin
  Result := false;
  if fileMappingResult = NO_ERROR then begin // first owner
    mappingData := MapViewOfFile(fileMapping, FILE_MAP_WRITE, 0, 0, SizeOf(DWORD));
    Win32Check(assigned(mappingData));
    mappingData^ := GetCurrentThreadID;
    UnmapViewOfFile(mappingData);
  end
  else if fileMappingResult = ERROR_ALREADY_EXISTS then begin // app already started
    mappingData := MapViewOfFile(fileMapping, FILE_MAP_READ, 0, 0, SizeOf(DWORD));
    if mappingData^ <> 0 then begin // 0 = race condition
      PostMessage(GetThreadWindow(mappingData^, mainFormClass), reactivateMsg, 0, 0);
      Result := true;
    end;
    UnmapViewOfFile(mappingData);
    Exit;
  end
  else
    RaiseLastWin32Error;
end; { ReActivateApplication }

initialization
  fileMapping := CreateFileMapping(INVALID_HANDLE_VALUE, nil, PAGE_READWRITE, 0,
    SizeOf(DWORD), PChar(StringReplace(ParamStr(0), '\', '', [rfReplaceAll, rfIgnoreCase])));
  Win32Check(fileMapping <> 0);
  fileMappingResult := GetLastError;
finalization
  if fileMapping <> 0 then
    CloseHandle(fileMapping);
end. 
```

所有代码都发布到公共领域，可以在没有许可考虑的情况下使用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T05:19:41.593

我最终将 MainForm 的句柄保存到文件映射中的 InstanceInfo 记录中，然后将消息发送到前一个实例的主窗体句柄（如果有的话）。

在项目 dpr 中：

```
 if not AppInstanceControl.RestoreIfRunning(Application.Handle) then
  begin
    Application.Initialize;
    Application.MainFormOnTaskbar := True;
    Application.CreateForm(TFormMain, FormMain);
    SetRunningInstanceMainFormHandle(FormMain.Handle);
    Application.Run;
  end else
    SendMsgToRunningInstanceMainForm('Message string goes here'); 
```

## AppInstanceControl.pas

```
type
  PInstanceInfo = ^TInstanceInfo;
  TInstanceInfo = packed record
    PreviousHandle: THandle;
    PreviousMainFormHandle: THandle;
    RunCounter: integer;
  end;

procedure SetRunningInstanceMainFormHandle(const AMainFormHandle: THandle);
begin
  UMappingHandle := OpenFileMapping(
                            FILE_MAP_ALL_ACCESS,
                            False,
                            PChar(UMappingName));
  if UMappingHandle <> 0 then
  begin
    UInstanceInfo := MapViewOfFile(UMappingHandle,
                                  FILE_MAP_ALL_ACCESS,
                                  0,
                                  0,
                                  SizeOf(TInstanceInfo));

    UInstanceInfo^.PreviousMainFormHandle := AMainFormHandle;
  end;
end;

procedure SendMsgToRunningInstanceMainForm(const AMsg: string);
var
  LCopyDataStruct : TCopyDataStruct;
begin
  UMappingHandle := OpenFileMapping(
                            FILE_MAP_ALL_ACCESS,
                            False,
                            PChar(UMappingName));
  if UMappingHandle <> 0 then
  begin
    UInstanceInfo := MapViewOfFile(UMappingHandle,
                                  FILE_MAP_ALL_ACCESS,
                                  0,
                                  0,
                                  SizeOf(TInstanceInfo));

    LCopyDataStruct.dwData := 0; //string
    LCopyDataStruct.cbData := 1 + Length(AMsg);
    LCopyDataStruct.lpData := PChar(AMsg);

    SendMessage(UInstanceInfo^.PreviousMainFormHandle, WM_COPYDATA, Integer(Application.Handle), Integer(@LCopyDataStruct));
  end;
end; 
```

这似乎可靠地工作。我打算发布完整的源代码，但我想合并一些 gabr 的代码，这些代码看起来更可靠地首先将焦点设置到正在运行的实例上。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T04:05:06.580

为什么不使用 DDE？看看这个搜索返回的链接：[http ://www.google.com/search?q=delphi+dde](http://www.google.com/search?q=delphi+dde)

# shell - 在 MSYS shell 上沸腾 - 它可以更换吗？

> ID：220742
> 
> 赞同：15
> 
> 时间：2008-10-21T04:05:54.550
> 
> 标签：shell, haskell, msys, rxvt

我需要一个可维修的 MSYS 外壳。这是我目前的困境：

默认的 rxvt.exe 具有滚动条和复制粘贴功能，但不会将控制字符或箭头键发送到 shell 中正在运行的程序（如解释器/调试器）。在使用 Haskell 解释器 ghci 时，这是一个真正的难题。

另一个 shell sh.exe 处理控制字符（或至少其中一些），但没有滚动条或复制和粘贴。

rxvt 在输出缓冲方面也有（相对）更多的问题

我有哪些选择？替换外壳是否需要 msys 感知？我想要的只是一个健全的环境来使用 Haskell (ghc)、C++ (gcc) 和基本工具链（make 和 what not）。如果它不涉及疯狂的恶作剧，我愿意编译一个 shell。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-21T04:34:50.030

如果您想要一个更好的终端模拟器，我已经成功使用[http://sourceforge.net/projects/console/](http://sourceforge.net/projects/console/)

它是标准 Windows 命令窗口的替代品。你可以设置 MSYS 或 Cygwin，或者任何你想要的作为支持它的 shell。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-09-11T10:49:35.713

检查[http://code.google.com/p/mintty/](http://code.google.com/p/mintty/)。那个怎么样？我觉得它绝对有用。还是 puttycyg（较旧的尝试）？

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-02-03T05:56:23.970

从 msys 外壳：

```
mingw-get install mintty
mintty 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-21T04:24:41.440

您混淆了“shell”和“终端仿真器”。`sh.exe`是前者；rxvt 是后者。（请注意，在 Windows 下，您可以不使用终端模拟器，因为 Windows 会为任何尚未在其中运行的控制台程序（例如 sh.exe）创建一个（“控制台窗口”））

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-10-10T16:26:45.110

使用 PowerShell 而不是旧的 cmd。然后像这样运行 sh

```
C:\msys64\usr\bin\sh.exe --login -i 
```

我使用 MSYS2 和 Haskell Platform 2014.2.0.0 在 Winows 8.1 上进行了测试。使用 GHCi 没有问题。所有箭头键和其他键都按预期工作。

此外，我无法按照其他答案中的建议让 Console2 在 Windows8 上正常工作。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-06-10T15:23:23.243

这个问题有点过时了；`mintty`现在默认包含在 MSYS2 中。具有讽刺意味的是，我无法访问 GHCi 中的命令历史记录——按下会移动光标，并将`\ESC`代码放在输入缓冲区中——通过*删除* `mintty`(`pacman -R mintty`从 MSYS2 shell 中) 为我解决了这个问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-21T19:13:24.173

我没有使用过 msys 的东西，但是使用 rxvt 以外的东西并在其中运行 sh.exe 就足够了。现在，如果您使用控制字符，您可能需要确保您使用的任何内容都支持您需要的内容（即 vt100 仿真）。

一种方法可能是使用 cygwin。我通常使用无根 X 服务器运行 cygwin，并在其上运行 xterm。到目前为止，它一直非常好，而且我没有遇到很多问题。我知道箭头键和这样的工作就很好。

* * *

## 回答 #8

> 赞同：-5
> 
> 时间：2009-10-22T19:20:39.050

帮自己一个忙，使用适当的 Cygwin，而不是旧 Cygwin 版本的未维护分支，即 msys。

# sql - 有趣的多对多sql连接

> ID：220747
> 
> 赞同：5
> 
> 时间：2008-10-21T04:14:16.483
> 
> 标签：sql, many-to-many, subquery, left-join, inner-join

我有三个相关表“A（id，val）”，“B（id，val）”和一个值为“AB（aid，bid，val）”的链接表

我正在查询 B 以带回 A 值，例如：

```
SELECT A.* 
FROM A INNER JOIN AB ON A.id = AB.aid INNER JOIN B ON AB.bid = B.id
WHERE B.val = 'foo'; 
```

每个 A 都有很多 B，每个 B 都有很多 A。

我崩溃的问题是需要过滤集合，以便查询仅在 AB.val 是任何给定 A/B 对的最大值时才返回行

例如，如果我有数据：

## 一个

```
id   val
1    something
2    somethingelse 
```

## 乙

```
id   val
1    foo
2    bar 
```

## AB

```
aid  bid  val
1    1    3
1    2    2
2    1    1
2    2    4 
```

我只想选择 AB 的第一行和最后一行，因为它们是每个 A 的最大值，然后能够查询 B.val = 'foo' 以仅返回第一行。我不知道如何仅限制 AB 表中的 max val 行。

我能得到的最好的是

```
SELECT * 
FROM A 
INNER JOIN 
  (SELECT aid, bid, MAX(val) AS val FROM AB GROUP BY aid) as AB
  ON A.id = AB.aid 
INNER JOIN B ON AB.id = B.id
WHERE B.val = 'foo' 
```

但这并不完全奏效。首先，它只是感觉是错误的方法，其次，它返回了错误的投标值。也就是说，从子查询返回的出价不一定与 max(val) 来自同一行。我相信这是一个已知的分组问题，当未为排序规则或分组指定列时选择返回的值未定义。

我希望上面的一些内容是有道理的，在过去的几个小时里，我一直在把头撞在墙上，任何帮助都将不胜感激。谢谢。

（对于那些想知道的人，它的实际用途是用于字典后端，其中 A 是单词表，B 是音素表。AB 是带有“位置”列的单词表。查询是查找所有以结尾的单词一个指定的音素。（音素是一个词的声音，在用法上类似于国际音标）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T04:54:33.437

我认为您需要先进行另一个联接才能获得每个 a.id 的 ab 的最大 val。

像这样的东西：

```
select a.*
from a
left join (
    select aid, max(val) as val 
    from ab 
    group by aid
) abmax on abmax.aid=a.id
inner join ab on ab.aid=abmax.aid and ab.val=abmax.val
inner join b on b.id=ab.bid
where b.val='foo' 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T05:08:21.757

这是我刚刚测试的另一种方法：

```
select a.*
from ab
   inner join b on(ab.bid=b.id)
   inner join a on (ab.aid=a.id)
where ab.val = (select max(val) from ab AS ab2 where ab2.aid = ab.aid)
   and b.val='foo' 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T06:10:27.060

我经常使用以下技巧来获得最大的每组：

```
SELECT a.*
FROM ab AS ab1
  LEFT OUTER JOIN ab AS ab2 ON (ab1.aid = ab2.aid AND ab1.val < ab2.val)
  JOIN a ON (ab1.aid = a.id)
  JOIN b ON (ab1.bid = b.id)
WHERE ab2.aid IS NULL
  AND b.val = 'foo'; 
```

诀窍是在外部连接中将 AB 表连接到自身。返回 ab1，其中不存在具有相同的辅助值和更大的值的行。因此，对于给定的帮助值，ab1 具有每组行的最大 val。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T14:22:04.243

```
SELECT *
FROM
(
  SELECT
    A.*,
    (SELECT top 1 AB.BID FROM AB WHERE A.AID = AB.AID ORDER BY AB.val desc) as BID
  FROM A
) as Aplus
JOIN B ON Aplus.BID = B.BID 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T11:43:49.900

我不确定您使用的是哪个 sql，但是在 MS SQL 中，我创建了一个表值数据库函数来返回表 A 中的最大值，然后将其连接到表 B。当我回顾时，我发现这比复杂的连接更容易理解在稍后阶段我的查询。

# .net - 在一个 DataTable 上使用多个 BindingSource

> ID：220751
> 
> 赞同：5
> 
> 时间：2008-10-21T04:17:33.963
> 
> 标签：.net, database

我有一个 DataTable，它有一个名为 [Invalid] 的布尔列。我需要将此数据除以此无效列 - 可以编辑有效行，不能编辑无效行。我最初的计划是使用两个 BindingSource 并设置 Filter 属性（例如 [Invalid] = 'false'），因为我有两个 DataGridView，所以我需要两个 BindingSource。

这不起作用：BindingSources 设置了与 DataTable 关联的 Filter 属性，因此两个 BindingSources 都保存相同的数据。我是否必须从数据库中提取两次，或者我可以对我拥有的对象做我想做的事？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T05:12:00.017

我不认为你可以按照你希望的方式做到这一点。

您可以使用同一个数据表的两个不同的数据视图，并将您的数据网格视图绑定到那些？

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-21T12:41:18.440

绑定到 DataTable 时，实际上是绑定到其默认视图 (DataTable.DefaultView)。当您设置任一 BindingSource 的 Filter 属性时，您正在设置默认视图的 Filter 属性，覆盖由另一个 BindingSource 设置的 Filter。

所以[deadcat 的答案是正确的](https://stackoverflow.com/questions/220751/using-multiple-bindingsources-on-one-datatable#220835)：您需要绑定到 DataTable 上的两个不同视图（如果您愿意，其中一个可以是 DefaultView）：

```
bindingSource1.DataSource = myDataTable;
bindingSource2.DataSource = new DataView(myDataTable); 
```

或者

```
bindingSource1.DataSource = new DataView(myDataTable);
bindingSource2.DataSource = new DataView(myDataTable); 
```

# c++ - 并发的 C++03 内存模型是什么？

> ID：220752
> 
> 赞同：36
> 
> 时间：2008-10-21T04:19:38.923
> 
> 标签：c++, concurrency, c++03, memory-model

C++03中并发的内存模型是什么？

（而且，C++11 是否更改了内存模型以更好地支持并发？）

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-10-21T07:20:28.120

C++ 内存模型是针对 C++ 代码读取/写入物理内存的时间和原因的规范。

在下一个 C++ 标准之前，C++ 内存模型与 C 相同。在 C++0x 标准中，预计将包含一个适合多线程的内存模型（参见[此处](http://en.wikipedia.org/wiki/C%2B%2B0x#Multithreading_memory_model)），并且可能会成为下一个修订版的一部分C标准，C1X。当前的一个是基本的：

*   它仅指定当前程序可观察到的内存操作的行为。
*   当多个进程访问同一内存时（没有共享内存或进程的概念），它没有说明并发内存访问。
*   当多个线程访问同一内存时（没有线程的概念），它没有说明并发内存访问。
*   它无法指定内存访问的顺序（编译器优化包括代码运动和最近的处理器重新排序访问，两者都可能破坏诸如双重检查初始化之类的模式）。

因此，当前状态是：仅当您有 1 个进程、其主线程且不编写取决于变量读/写的特定顺序的代码时才指定 C++ 内存操作，仅此而已。从本质上讲，这意味着除了传统的 hello world 程序之外，您还搞砸了。

当然，您会被提示添加*“它今天在我的机器上运行，您不可能是对的”*。正确的句子是*“它今天可以在我的机器上运行，它具有硬件、操作系统（线程库）和编译器的这种特定组合，这些硬件、操作系统（线程库）和编译器彼此了解足够多，可以实现一些有点工作但可能会在某个时候中断的东西”*。

好吧好吧，这有点苛刻，但地狱，[甚至 Herb Sutter 也承认](http://www.open-std.org/JTC1/sc22/wg21/docs/papers/2007/n2197.pdf)（只需阅读介绍），他正在谈论最普遍的 C/C++ 工具链之一的所有 2007 年之前的版本......

C++ 标准委员会试图提出一些可以解决所有这些问题的方法，同时仍然比 Java 的内存模型限制更少（因此性能更好）。

[Hans Boehm 在这里](http://www.hboehm.info/c++mm/)收集了一些关于这个问题的论文，包括学术论文和 C++ 委员会的论文。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-10-21T07:27:03.800

*看到其他一些答案，似乎许多 C++ 程序员甚至都不知道您所询问的“内存模型”是什么意思。*

*从某种意义上说，问题是关于内存模型的：关于写入/读取重新排序（可能发生在编译器端或运行时端）有什么保证（如果有的话）？这个问题对于多线程编程非常重要，因为如果没有这样的规则，编写正确的多线程程序是不可能的，而且有些令人惊讶的事实是，由于当前缺乏显式内存模型，许多多线程程序或多或少地“靠运气”工作——通常要归功于编译器在函数调用之间假设指针别名。- 见[线程不能作为库实现](http://www.hpl.hp.com/techreports/2004/HPL-2004-209.html)*

在当前的 C++ 中，没有标准的内存模型。一些编译器为 volatile 变量定义内存模型，但这是非标准的。C++0x 为此目的定义了新的“原子”原语。检查最近状态的详尽起点可以在[C++ 的线程和内存模型中找到](http://www.hpl.hp.com/personal/Hans_Boehm/c++mm/)

重要的链接还有[并发内存模型](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2007/n2429.htm)、[原子类型](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2007/n2427.html)和[C++ 数据依赖排序：原子和内存模型](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2007/n2427.html)标准提案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T04:54:04.080

不幸的是，在 C++ 中没有像 Java 那样的“标准内存模型”。实际的实现由编译器、运行时库和处理器决定。

因此，C++ 内存模型 == 模型的混沌混搭，这意味着您总是必须尝试编写不依赖于特定内存模型的安全代码，这也适用于线程编程，因为编译器可以做到它想要在关键部分之外进行的任何优化，甚至是乱序处理！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-21T07:23:33.043

在 C++ 标准委员会网站上查看论文怎么样：

*   [C++ 数据依赖排序：原子和内存模型](http://open-std.org/jtc1/sc22/wg21/docs/papers/2008/n2492.html)
*   [ETC](http://open-std.org/jtc1/sc22/wg21/docs/papers/2008/#mailing2008-10)

?

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-05-04T01:40:27.080

如果您想更深入地了解共享内存一致性模型，我建议您参考以下教程。

[http://rsim.cs.uiuc.edu/~sadve/Publications/computer96.pdf](http://rsim.cs.uiuc.edu/~sadve/Publications/computer96.pdf)

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-21T05:21:51.387

简短的回答：没有

长答案：C++ 没有托管内存，您必须自己分配和释放它。智能指针类可以减轻这种负担。如果您忘记释放分配的内存，那就是内存泄漏和错误。如果您在释放内存后尝试使用内存，或者您尝试多次释放内存，这些也是令人讨厌的错误。

至于低级细节，C++ 没有具体说明——这取决于硬件。内存是通过指针访问的，其中包含某种内存地址。内存地址可以是物理地址或虚拟地址。如果您正在使用操作系统内核，或者您正在阅读以实模式运行的旧 DOS 代码，您只会看到物理地址。有关更多详细信息，请阅读[虚拟内存](http://en.wikipedia.org/wiki/Virtual_memory)，那里有很多好的资源。

x86 架构还允许使用段描述符来寻址内存。这是一大堆蠕虫，自 Win16 时代以来就没有真正使用过，如果幸运的话，你永远不必处理它。

* * *

## 回答 #7

> 赞同：-8
> 
> 时间：2008-10-21T05:38:23.520

简而言之，C++ 内存模型包括...

*   向下增长的堆栈——也就是说，当您压入堆栈帧时，堆栈指针的值小于原来的值

*   向上增长的堆，即新分配的内存的结束地址比之前的内存大。您使用 malloc() 或 new 在堆中分配内存。如果堆中没有足够的可用内存，则 malloc（或 new）调用系统函数 brk() sbrk() 以增加堆的大小。如果对 brk() 或 sbrk() 的调用失败，则 malloc 或 new 失败并出现内存不足异常。

您永远不需要关心堆栈或堆是向下还是向上增长，并且在某些系统中，它们可能以相反的方式运行。只需考虑堆栈和堆从地址空间的末端向内增长。

*   内存分配器 malloc，它以 8 位字节分配内存。New 也分配内存，但它分配的内存量取决于正在更新的对象的大小。

*   包含可执行代码的文本空间。文本位于堆下方。您不能在执行期间更改文本空间

程序可能在文本下方有其他特殊用途的部分。

您可以在 linux 系统上使用 objdump 查看程序是如何静态组织的（在加载之前）。

我注意到虽然您在问题中没有提到它，但“并发”是您分配给这个问题的关键字之一。线程系统在堆上为每个线程分配额外的线程空间，然后管理堆栈指针以在线程之间切换。

还有更多细节，其中许多是特定于特定硬件、操作系统或线程系统的，但这是基本思想。

# javascript - 最佳 AJAX 树视图

> ID：220754
> 
> 赞同：20
> 
> 时间：2008-10-21T04:23:00.147
> 
> 标签：javascript, ajax, json, treeview

有哪些支持异步 JSON 加载的更好的 AJAX Treeviews。

YUI TreeView 看起来不错，但是有表格等臃肿。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-21T04:27:41.980

[jQuery TreeView 插件](http://plugins.jquery.com/project/treeview)非常好，它有非常好的[异步](http://jquery.bassistance.de/treeview/demo/async.html) [JSON](http://jquery.bassistance.de/treeview/demo/source.phps)加载能力......

[ExtJS TreeView 组件](http://extjs.com/deploy/dev/examples/tree/reorder.html)，也很棒，多级异步加载，非常适合大型树。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-10-16T08:54:07.987

我建议 DHTMLX 树：

*   跨浏览器
*   AJAX 支持
*   在线节点编辑
*   拖放功能
*   *智能渲染 - 允许避免在每个级别具有大量节点的树中出现性能问题。
*   富客户端 API

*   组件中实施的特殊技术可以快速有效地加载真正的大树。

*   高级拖放功能不仅可以在一个树内拖动项目，还可以在不同树之间拖动项目（即使树位于不同的框架或 iframe 中）。

您可以立即尝试此功能：

[现场演示](http://dhtmlx.com/docs/products/dhtmlxTree/index.shtml)

# c++ - MySQL 的 C++ 绑定

> ID：220756
> 
> 赞同：1
> 
> 时间：2008-10-21T04:24:01.690
> 
> 标签：c++, mysql, binding

我正在运行 OSX(10.4.11) 并且我正在尝试为 MySQL 找到一个像样的 C（最好是 C++）绑定。我要分析的异地数据库中有一些数据。

我试图让 MySQL++ 工作，但它很时髦。

我正在寻找其他绑定，最好是安装不麻烦的绑定。

编辑：

MySQL 有 C 绑定。笨重且低级，但它可以工作（经过一些图书馆摆弄）。

[http://www.sqlapi.com/](http://www.sqlapi.com/)支持 Solaris/Windows/Linux。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-07T08:16:16.370

MySQL Connector/C++ 是 JDBC 4.0 的 C++ 实现

使用 MySQL Connector/C++ 的参考客户有： - OpenOffice - MySQL Workbench

了解更多： http: [//forums.mysql.com/read.php?167,221298](http://forums.mysql.com/read.php?167,221298)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T04:45:50.913

SQLApi [++](http://www.sqlapi.com/)已经被[这个家伙](http://www.monkeybreadsoftware.de/realbasic/plugin-sql.shtml)移植到 OS/X ，作为 REALBasic 插件的一部分。他可能对许可持开放态度。

我不知道为什么它没有被许可回给他们。也许他们对支持 Mac 客户端不感兴趣。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-03T14:06:06.863

你可能想看看[SOCI](http://soci.sourceforge.net)。尽管它建立在 MySQL C API 之上，但它提供了比使用 C 绑定更好的 C++ 友好接口。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-03T14:08:03.880

有mysql++。我已经将它与我们的一个 c++ 项目一起使用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-07T10:42:09.380

我在使用 MySQL C 库时从来没有遇到过任何问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-07T06:39:35.843

就我个人而言，我过去曾使用过 mymysql（如果我在 C++ 中工作，仍然会这样做），它是一个围绕 C api 的轻量级包装器，并将内存管理与对象生命周期联系起来。

可以在这里找到：[http ://www.redi.uklinux.net/mymysql/](http://www.redi.uklinux.net/mymysql/)

尽管网站上有警告，但它仍然不是一个糟糕的图书馆。它实际上是由一位前同事写的，尽管他不再真正维护它，但它仍然处于相当好的状态。

# grails - 在旧版 Java/JSP Web 应用程序中使用 Groovy/Grails

> ID：220758
> 
> 赞同：5
> 
> 时间：2008-10-21T04:24:10.020
> 
> 标签：grails, groovy

我很幸运能够从 Grails 重新开始。但是，很多人问我如何将 Groovy 和/或 Grails 添加到旧版 Java/JSP Web 应用程序中。对于如何最好地将 Groovy 和 Grails 包含到大型遗留应用程序中，人们是否有经验或建议？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-10T07:50:58.503

这篇 IBM Developerworks 文章详细介绍了[如何将 Grails 与您的遗留数据库一起使用](http://www.ibm.com/developerworks/java/library/j-grails07158/index.html?S_TACT=105AGX02&S_CMP=EDU)。

可以帮助将遗留数据库映射到 grails 域对象的工具是[GRAG - Grails 应用程序生成器](http://grag.sourceforge.net/documentation.html)。这是一个方便的工具，可以帮助您生成映射类。

第三种选择是不将 Grails 用于 gorm/domain 层。相反，因为它与 Java 配合得非常好，所以您可以创建服务来[调用现有的遗留 Java 代码以实现业务逻辑和持久性](http://www.itexto.net/devkico/?p=333)。

我希望其中一种方法对您有用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T13:44:25.007

我见过的一件事是使用 Grails 作为企业 Java 应用程序的管理界面。这不完全是您所要求的，因为没有集成。只有一组需求很容易在 Grails 中快速划分和开发。实际上，它们是独立的应用程序，但使用相同的数据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-04T15:52:24.637

我发现这篇文章描述了让 Groovlets 和 gsp 工作，指定 web.xml 更新和项目所需的 jar 文件。

```
http://www.ibm.com/developerworks/java/library/j-pg03155 
```

我将以下 jar 文件添加到我的项目中并且 groovlets 工作。

groovy-1.5.7.jar
asm-2.2.jar
antlr-2.7.6.jar

我还没有 gsp 的工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T13:57:30.940

我将从在 jsps 和 grails 应用程序之间共享数据模型开始（grails 可以使用普通的 Java 类和 hibernate 配置运行，因此如果您已经在使用 hibernate，那么重用 hibernate 类应该不难）。然后我会将每个 jsp/servlet*原样*迁移到 grails。如果您已经在使用 spring，它应该会让事情变得更容易，因为您可以共享相同的应用程序上下文。

根据应用程序的大小和其他要求，重写整个内容可能会更好，特别是如果遗留应用程序不使用 spring 或 hibernate。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T10:23:31.517

我想这取决于“添加 grails/groovy”到应用程序的含义——因为 grails 是一个完整的堆栈，如果“添加”是指用新的替换旧的，那么可能值得重写它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-11-19T08:33:36.000

正如其他人所说，Grails 是一个完整的堆栈，因此将 Grails 添加到现有 Java 应用程序可能不是您想要的。然而，将 Java 添加到现有的 Grails 应用程序是微不足道的。将 Groovy 添加到现有的 Java 应用程序可能也不会太难。

这在很大程度上取决于您正在谈论的 Java 应用程序的类型。Grails 是基于 Spring MVC、Hibernate 和类似的标准 Java 技术构建的，因此如果您的 Java 应用程序使用所有这些技术，那么使用一些遗留 Java 代码将应用程序转换为 Grails 可能很容易。

# javascript - 使用 jQuery 自动刷新 div - setTimeout 还是其他方法？

> ID：220767
> 
> 赞同：17
> 
> 时间：2008-10-21T04:32:04.450
> 
> 标签：javascript, jquery

您究竟如何`div`使用 JavaScript（特别是 jQuery）进行自动刷新？

我知道这种`setTimeout`方法，但这真的是一个好习惯吗？有没有更好的方法？

```
function update() {
    $.get("response.php", function(data) {
        $("#some_div").html(data);
    });
    window.setTimeout("update();", 10000);
} 
```

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-10-21T04:54:36.200

另一个修改：

```
function update() {
  $.get("response.php", function(data) {
    $("#some_div").html(data);
    window.setTimeout(update, 10000);
  });
} 
```

与此不同的是，它在 ajax 调用后等待 10 秒。所以实际上刷新之间的时间是 10 秒 + ajax 调用的长度。这样做的好处是，如果您的服务器响应时间超过 10 秒，您就不会同时发生两个（并且最终是多个）AJAX 调用。

此外，如果服务器无法响应，它不会继续尝试。

我过去使用过类似的方法，使用 .ajax 来处理更复杂的行为：

```
function update() {
  $("#notice_div").html('Loading..'); 
  $.ajax({
    type: 'GET',
    url: 'response.php',
    timeout: 2000,
    success: function(data) {
      $("#some_div").html(data);
      $("#notice_div").html(''); 
      window.setTimeout(update, 10000);
    },
    error: function (XMLHttpRequest, textStatus, errorThrown) {
      $("#notice_div").html('Timeout contacting server..');
      window.setTimeout(update, 60000);
    }
} 
```

这会在加载时显示加载消息（在其中放置典型的“web 2.0”样式的动画 gif）。如果服务器超时（在这种情况下需要超过 2 秒）或发生任何其他类型的错误，它会显示错误，并等待 60 秒，然后再次联系服务器。

这在对大量用户进行快速更新时特别有用，因为您不希望每个人都突然因请求超时而瘫痪滞后的服务器。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2012-02-13T14:00:55.780

```
$(document).ready(function() {
  $.ajaxSetup({ cache: false }); // This part addresses an IE bug.  without it, IE will only load the first number and will never refresh
  setInterval(function() {
    $('#notice_div').load('response.php');
  }, 3000); // the "3000" 
}); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-21T04:37:21.880

[有一个](http://plugins.jquery.com/project/Timer)你可能想尝试的 jQuery Timer 插件

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-04-17T10:02:31.320

```
function update() {
  $("#notice_div").html('Loading..'); 
  $.ajax({
    type: 'GET',
    url: 'jbede.php',
    timeout: 2000,
    success: function(data) {
      $("#some_div").html(data);
      $("#notice_div").html(''); 
      window.setTimeout(update, 10000);
    },
    error: function (XMLHttpRequest, textStatus, errorThrown) {
      $("#notice_div").html('Timeout contacting server..');
      window.setTimeout(update, 60000);
    }
});
}
$(document).ready(function() {
    update();
}); 
```

这是更好的代码

# css - CSS中的复杂高度

> ID：220772
> 
> 赞同：3
> 
> 时间：2008-10-21T04:35:37.890
> 
> 标签：css

在我解释我要做什么之前，请注意我很幸运只需要针对 Webkit（这意味着我可以使用很多整洁的 CSS）。

所以，基本上，我想要一个高度灵活的块，位置固定，最大高度是可用窗口高度的高度，块顶部和底部的一些元素总是可见的，中间是一个区域带溢出自动。基本上它看起来像这样：

```
----------------------
| 热门项目 | |
| | |
| 东西| |
| | |
| | |
| 最后一条 | |
|------------ |
| |
| |
----------------------

----------------------
| 热门项目 | |
|-----------| |
| 很多|^| |
| |_| 的 |
| 东西|_| |
| | | |
| | | |
|-----------| |
| 最后一条 | |
----------------------
```

可以用 CSS 完成吗？还是我必须用 Javascript 破解它？我愿意接受一点 div-itis，如果这就是使这项工作所需的东西 - 更好的 div-itis，而不是试图解释每一个愚蠢的小事情，比如回流和窗口调整大小以及所有这些废话。

我已经为这不是 CSS 可以做的坏消息做好了准备，但是我对一些 SO 上的人以前可以工作的魔力感到惊喜。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T04:41:03.357

这看起来像你的[票](http://www.xs4all.nl/~peterned/examples/csslayout1.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T19:18:08.857

好的，我想通了，使用了一点 Javascript，但如果这是跨浏览器，则没有必要的复杂性。如果有人关心，我会发布答案。

标记：

```
<div class="complex-height">
    <div class="top"><!-- stuff --></div>
    <div class="middle"><!-- stuff --></div>
    <div class="bottom"><!-- stuff --></div>
</div> 
```

CSS：

```
.complex-height {
    position: fixed;
    top: 0;
    left: 0;
    max-height: 100%;
    width: 300px; /* Can be whatever, but must specify a width */
    overflow: auto;
}
.complex-height .top, .complex-height .bottom {
    width: 100%;
    position: absolute;
    z-index: 2; /* make sure they overlap the center */
}
.complex-height .top {
    top: 0;
}
.complex-height .bottom {
    bottom: 0;
} 
```

Javascript（假设原型，但直接编写或写入另一个库很简单）：

```
$$('.complex-height .middle').each(function(middle) {
    middle.setStyle({
        paddingTop: middle.up('.complex-height').down('.top').getHeight() + 'px',
        paddingBottom: middle.up('.complex-height').down('.bottom').getHeight() + 'px'
    });
});
$$('.complex-height').invoke('observe', 'scroll', function(e) {
    this.down('.top').setStyle({
        top: this.scrollTop + 'px'
    });
    this.down('.bottom').setStyle({
        bottom: (0 - this.scrollTop) + 'px'
    });
}); 
```

# javascript - javascript图像旋转器问题，默认图像

> ID：220773
> 
> 赞同：3
> 
> 时间：2008-10-21T04:36:36.657
> 
> 标签：javascript, image

我写了一个简单的 javascript 图像旋转器，它在每个页面加载时选择一个随机图像。问题是，如果我使用默认图像，该默认图像将在 javascript 加载并替换它之前显示一秒钟。显然，如果有人禁用了 javascript，我希望他们看到图像。如何在不闪烁默认图像的情况下获得默认图像。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T06:08:38.233

听起来您想在 window.onload 触发之前更改页面 HTML（因为此时默认图像已经显示）。

您需要将 javascript 函数附加到“DOMContentLoaded”或通常称为 domready 事件。Dean Edwards 为我们提供了一个出色的跨浏览器实现 [http://dean.edwards.name/weblog/2006/06/again/](http://dean.edwards.name/weblog/2006/06/again/)。

希望有帮助:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T04:51:06.097

如果您在页面加载时首先隐藏默认图像，则用户可能没有机会看到该图像。然后，您可以在图像上安装 onload 处理程序并将其源更改为您的随机图像。当图像加载时，您可以取消隐藏图像。

```
window.onload = function () {
    var img = document.getElementById("rotating_image");

    // Hide the default image that's shown to people with no JS
    img.style.visibility = "hidden";

    // We'll unhide it when our new image loads
    img.onload = function () {
        img.style.visibility = "visible";
    };

    // Load a random image
    img.src = "http://example.com/random" + Math.floor(Math.random() * 5) + ".jpg";

}; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T04:56:15.883

您可能还想考虑只将 JS 放在图像之后。这可能会在页面加载时而不是在页面加载时执行 JS。但我不确定这一点。

```
<img src="/not/rotated/image.jpg" />
<script type="text/javascript">
// change image
</script> 
```

# .net - 始终检查参数并抛出异常

> ID：220775
> 
> 赞同：10
> 
> 时间：2008-10-21T04:39:45.853
> 
> 标签：.net, exception

当参数不符合您的预期时，您是否应该始终检查参数并在 .NET 中引发异常？例如空对象或空字符串？

我开始这样做，但后来认为如果在每个方法上都这样做，这会使我的代码膨胀很多。我应该检查私有和公共方法的参数吗？

我最终抛出了很多 ArgumentNullException("name") 异常，即使处理异常的代码实际上不能以编程方式做任何不同的事情，因为不能保证“name”将来不会改变。

我认为此信息在查看充满异常信息的日志时有用吗？

总是“做最坏的打算”是最好的做法吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-21T04:50:27.877

我的两分钱：您所有的公共方法都应始终检查传入参数的有效性。这通常称为“按合同编程”，是快速捕获错误并避免通过许多人认为的私有函数传播错误的好方法（包括我自己）不应该直接进行单元测试。至于抛出异常，如果你的函数或程序本身不能纠正错误，它应该抛出异常，因为它已被抛出到无效状态。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-21T07:59:45.233

对于**公共**方法，那么是的：绝对有必要检查您的论点；对于**内部/私人**电话，Eric Lippert 可能会将它们归类为“愚蠢的”（[此处](http://blogs.msdn.com/ericlippert/archive/2008/09/10/vexing-exceptions.aspx)）；他的建议是不要抓住他们……修复代码！

为避免代码膨胀，您可能需要考虑 AOP，例如[postsharp](http://www.postsharp.org/)。为了说明，Jon Skeet 有一个 postsharp 属性，它执行空参数检查，[这里](http://msmvps.com/blogs/jon_skeet/archive/2008/03/27/postsharp-and-iterator-blocks-a-beautiful-combination.aspx)。然后（引用他的示例），您可以简单地为该方法添加属性：

```
[NullArgumentAspect("text")]
public static IEnumerable<char> GetAspectEnhancedEnumerable(string text)
{ /* text is automatically checked for null, and an ArgumentNullException thrown */ } 
```

另一个方便的技巧可能是扩展方法；扩展方法有一个奇怪的特性，你可以在空实例上调用它们......所以你可以执行以下操作（使用泛型而不是“对象”，这样你就不会意外地通过装箱值类型来调用它） ：

```
static void ThrowIfNull<T>(this T value, string name) where T : class
{
    if (value == null) throw new ArgumentNullException(name);
}
// ...
stream.ThrowIfNull("stream"); 
```

你可以用超出范围等做类似的事情。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-21T04:49:34.383

没有什么比追踪“未设置对象实例的对象引用”消息更糟糕的了。如果您的代码足够复杂，则很难知道发生了什么故障——尤其是在生产系统中，尤其是在罕见的边界条件下。显式异常在解决这些问题方面大有帮助。*这是一种痛苦，但如果确实*发生了不好的事情，这是你不会后悔的事情之一。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-21T04:41:26.880

这取决于您的类/方法的使用者。如果这都是内部的，我会说它不那么重要。如果您有未知/第 3 方消费者，那么是的，您需要进行广泛的检查。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-21T09:36:27.660

我的大部分经验是使用相对受限的系统，这种代码膨胀是不可取的。所以我自己的直觉是要么使用仅调试断言，要么完全忽略它。您希望在测试给您错误值的调用者期间会发生任何可能的无效输入，因此只要您在调试模式和发布模式下进行测试，您就会看到诊断信息。否则，您将在崩溃最终发生时对其进行调试。

如果代码大小和性能无关紧要（并且在几乎所有代码中，简单的 null 或范围检查无论如何都不会影响性能），那么您在发布模式下的代码中留下的断言越多，您诊断故障的机会就越大无需在测试模式下重新创建错误。这可以节省大量时间。特别是，如果您的产品是一个库，那么很大一部分“故障”报告是由于客户错误造成的，因此再多的预发布测试都无法阻止它们在野外发生。您越早向客户证明他们的代码是错误的，他们就能越早修复它，您就可以重新找到自己的错误。

尽管如此，在 C/C++ 中，我发现检查空指针的具体情况只是一个小帮助。如果有人给你一个指针，那么完整的有效性条件不是“不能为空”。它需要指向当前进程可读（也许也可写）到一定大小的内存，并且包含正确类型的对象，可能处于所有可能状态的某个子集中。它不需要被释放，不需要被其他地方的缓冲区溢出丢弃，可能不需要被另一个线程同时修改，等等。你不会在方法入口处测试所有这些，所以你仍然会错过 invalid参数。任何导致你或其他程序员认为“这个指针不是空的，所以它必须是有效的”的东西，因为你只测试了有效性条件的一小部分，

如果您完全通过指针传递，那么您已经处于需要信任调用者不会给您垃圾的领域。拒绝一个特定的垃圾实例仍然让你相信调用者不会给你任何他们可以变出的更难检测的无数其他类型的垃圾。如果你发现空指针是来自特定调用者的常见垃圾，那么一定要对它们进行测试，因为它可以节省诊断系统其他地方的错误的时间。这取决于评估在调用者代码中发现具有“将空指针传递给我”症状的错误是否值得让您自己的代码膨胀（可能是二进制大小，当然还有源代码）：如果这样的错误很少见，那么你可能会浪费时间和屏幕房地产检查他们。

当然，在某些语言中，您不会通过指针传递，调用者破坏内存的机会有限，因此垃圾的范围较小。但是在 Java 中，例如，传递错误的对象仍然是比传递错误的 null 更常见的编程错误。无论如何，如果将 Null 留给运行时发现并查看堆栈跟踪，则通常很容易诊断 Null。因此，即使在那里，空值检查的价值也非常有限。在 C++ 和 C# 中，您可以在禁止使用空值的情况下使用传递引用。

这同样适用于您可能测试的任何其他特定无效输入以及任何语言。完整的前置条件和后置条件测试（如果可能的话）当然是另一回事，因为如果您可以测试整个通话合约，那么您的基础就更加稳固了。而且，如果您可以使用编织或其他方式来断言合约，而无需添加到函数本身的源代码中，那就更好了。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-21T08:21:06.470

我采取的方法是检查参数并在公开可见的成员上抛出异常 - 任何公开可见的我的意思是在程序集边界之外（所以 any`public`或类上`protected`的`protected internal`方法`public`。这是因为您（通常）设计一个程序集以作为自治单元，因此在程序集范围内的任何内容都应遵循如何在其中调用其他内容的规则。

对于任何非公开可见的成员（即成员`internal`或`private`类），我使用它`Debug.Assert`来执行检查。这样，如果程序集中的任何调用者违反了您在开发/测试时立即发现的合同，但您在最终部署的解决方案中没有性能开销，因为这些语句在 RELEASE 构建中被删除。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-21T04:44:09.107

对于这种情况，我的理念是通知并继续进行（如果适用）。伪代码将是：

```
if value == not_valid then
#if DEBUG
  log failure
  value = a_safe_default_value
#elsif RELASE
  throw
#endif
end 
```

通过这种方式，您可以轻松地在开发过程中进行迭代，并让用户测试您的应用程序，而不会感到沮丧。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-21T08:26:15.350

这得看情况。如果您的代码无论如何都会选择 null 并引发异常，那么确保您拥有合理的清理代码可能更有意义。如果它可能无法以其他方式检测到，或者清理可能运行很长时间，或者可能存在进程外调用（例如数据库），那么您最好不要尝试错误地改变世界，然后将其改回来。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-12-20T14:48:04.407

我会将异常放在应用程序的最高级别，因为最好在可以处理异常的地方捕获异常。如果可以处理异常；然后处理它。

这意味着低级别的东西通常会对传递下来的参数进行较少的错误处理。这可以防止任何混乱并尊重性能。

这通常意味着与更高层的接口的方法得到更多的参数检查。

# python - 在 py2exe 构建中包含 PYD/DLL

> ID：220777
> 
> 赞同：10
> 
> 时间：2008-10-21T04:40:57.397
> 
> 标签：python, dll, installation, py2exe, pyd

我的应用程序的其中一个模块使用 .pyd 文件中的函数。有一个排除 dll (exclude_dlls) 的选项，但有一个选项可以包含它们吗？尽管复制了其余文件（.py），但构建过程似乎并未复制我模块中的 .pyd。我还需要包含一个 .dll。如何让 py2exe 同时包含 .pyd 和 .dll 文件？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-22T02:27:44.420

.pyd 和 .DLL 在这里是不同的，因为 .pyd 应该由 modulefinder 自动找到并被包括在内（只要你有适当的“import”语句）而不需要做任何事情。如果遗漏了一个，您将执行与遗漏 .py 文件相同的操作（它们都只是模块）：对 py2exe 选项使用“include”选项。

Modulefinder 不一定会找到对 .DLL 的依赖项（py2exe 可以检测到一些），因此您可能需要使用“data_files”选项显式包含这些依赖项。

例如，您有两个 .DLL（'foo.dll' 和 'bar.dll'）要包含，三个 .pyd（'module1.pyd'、'module2.pyd' 和 'module3.pyd'）要包含包括：

```
setup(name='App',
      # other options,
      data_files=[('.', 'foo.dll'), ('.', 'bar.dll')],
      options = {"py2exe" : {"includes" : "module1,module2,module3"}}
     ) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T05:08:35.530

如果它们没有被自动检测到，请尝试手动将它们复制到 py2exe 的临时构建目录中。它们将包含在最终的可执行文件中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T05:51:12.263

您可以修改设置脚本以显式复制文件：

```
script = "PyInvaders.py"        #name of starting .PY
project_name = os.path.splitext(os.path.split(script)[1])[0]
setup(name=project_name, scripts=[script]) #this installs the program

#also need to hand copy the extra files here
def installfile(name):
    dst = os.path.join('dist', project_name)
    print 'copying', name, '->', dst
    if os.path.isdir(name):
    dst = os.path.join(dst, name)
    if os.path.isdir(dst):
        shutil.rmtree(dst)
    shutil.copytree(name, dst)
    elif os.path.isfile(name):
    shutil.copy(name, dst)
    else:
    print 'Warning, %s not found' % name

pygamedir = os.path.split(pygame.base.__file__)[0]
installfile(os.path.join(pygamedir, pygame.font.get_default_font()))
installfile(os.path.join(pygamedir, 'pygame_icon.bmp'))
for data in extra_data:
    installfile(data) 
```

等等...当然可以根据您的需要进行修改。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-22T01:22:00.200

也许你可以使用 setup() 的 data_files 选项：

```
import glob
setup(name='MyApp',
      # other options,
      data_files=[('.', glob.glob('*.dll')),
                  ('.', glob.glob('*.pyd'))],
     ) 
```

data_files 应该是一个元组列表，其中每个元组包含：

1.  目标目录。
2.  要复制的文件列表。

这不会将文件放入 library.zip，这对 dll 来说应该不是问题，但我不知道 pyd 文件。

# .net - 您在 .NET 应用程序中使用哪种数学？

> ID：220786
> 
> 赞同：0
> 
> 时间：2008-10-21T04:49:32.230
> 
> 标签：.net, math, base-class-library

您在 .NET 应用程序中使用哪种数学，不包括[System.Math](http://msdn.microsoft.com/en-us/library/system.math.aspx)中的*所有内容*？

我认为 System.Math 严重不足。例如，在几个官方的[.NET](http://en.wikipedia.org/wiki/.NET_Framework)框架中，我可以数出三种不同的矩阵实现。向量也是如此。复数的一种实现；任意有理数的几种不同实现，等等。

那么，您希望在假设的`System.Mathematics`命名空间中看到什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-21T08:42:32.900

这是我使用的：

*   数值积分
*   数值导数
*   FFT
*   矩阵
*   矢量图
*   复数
*   几何类型，例如多边形、球体、环形等
*   高斯分布
*   纳维-斯托克斯方程
*   DSP滤波器
*   符号代数
*   四元数
*   优化
*   常微分方程和 ODE 求解器
*   对于 PDE 也是如此

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T04:58:09.123

除了基本的“会计数学”之外，我很少需要任何东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T07:54:01.687

泛型支持（因为 C# 3.0 不允许使用泛型和运算符），例如[这里](http://www.pobox.com/~skeet/csharp/miscutil/usage/genericoperators.html).

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T10:06:05.650

检查 [http://msdn.microsoft.com/en-us/vcsharp/aa336740.aspx](http://msdn.microsoft.com/en-us/vcsharp/aa336740.aspx)

在 Math 下有一些 C# 库的链接

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T05:00:17.560

[Flee](http://codeplex.com/flee)或[Dotmath](http://hebertsoft.com/dotmath/)中的表达式评估（请参见[此处](https://stackoverflow.com/questions/174664/operators-as-strings)和[此处](https://stackoverflow.com/questions/53844/how-can-i-evaluate-a-c-expression-dynamically)）

# .net - Boost 库是否有 .net 类似物？

> ID：220793
> 
> 赞同：6
> 
> 时间：2008-10-21T04:52:21.540
> 
> 标签：.net, boost

按照标题。

我认为 .Net 库肯定会从某种社区发展中受益；可能类似于 Java 社区进程。这是一个类比将非常有用的地方。

编辑：我认为人们认为我需要使用一些库。这不是我要说的。我的意思是向 BCL 添加新库的正式（或接近正式）流程。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T17:44:45.630

最接近的是 Micorosft 的[Connect 站点](http://connect.microsoft.com/)，这是一个正式的反馈站点，内部团队确实使用和响应。您还可以对功能请求进行投票。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T05:24:02.847

Wintellect 长期致力于一个名为“.NET Power Collections”的项目。其中一个人曾经在 C# 编译器上工作。它似乎停滞不前，但我不确定。

它现在在 codeplex： http: [//www.codeplex.com/PowerCollections](http://www.codeplex.com/PowerCollections)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T17:31:15.797

> 我的意思是向 BCL 添加新库的正式（或接近正式）流程。

似乎没有这样的东西。如果您对希望在 BCL 中看到的内容有任何想法，我建议您先将它们发布在 Microsoft 论坛上。您的提案越完善，就越有可能产生影响。

祝你好运。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T05:07:44.440

不确定 Boost 库，

[但是http://codeplex.com](http://codeplex.com)上有大量开源 .NET 项目， 也可以查看 Microsoft 的“开源”主页[http://www.microsoft.com/opensource/default.aspx](http://www.microsoft.com/opensource/default.aspx)

我认为 codeplex 更像是你正在寻找的东西......

希望有帮助！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T05:07:46.093

我没有使用过 Boost 库，但 .NET FCL 和 CLR 的明显开源/社区实现将是Miguel De icaza 创立的[Mono 项目。](http://mono-project.com/Contributing)

Wintellect (Jeffrey Richter) 还提供了一个[Power Threading](http://www.wintellect.com/Resources.aspx)库，不幸的是它似乎不是开源的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T05:17:37.493

在阅读了这个[Boost Library](https://stackoverflow.com/questions/149268/boost-library)之后 ，我会说我的最后一个答案并不是你真正想要的..

但最接近的可能是 ASP.NET 团队正在开发的一些开源项目。特别是 ASP.NET AJAX 控件工具包 ( [http://www.codeplex.com/AjaxControlToolkit](http://www.codeplex.com/AjaxControlToolkit) ) 和 ASP.NET MVC 项目 ( [http://www.asp.net/mvc/](http://www.asp.net/mvc/) ) 以及一些 Silverlight 控件和项目（[http://www.codeplex.com/sdlsdk](http://www.codeplex.com/sdlsdk)和[http://silverlightcontrib.org/](http://silverlightcontrib.org/)）

您可能还想查看 Mono 项目 ( [http://www.mono-project.com](http://www.mono-project.com) ) 上正在进行的一些工作……这是 .NET 的开源实现

# windows - Ping 失败但 http 链接有效

> ID：220794
> 
> 赞同：11
> 
> 时间：2008-10-21T04:52:53.893
> 
> 标签：windows

在其中一个系统 (Windows) 中，如果我 ping 到一个特定的公共论坛站点，[这里说 testsite.com]，那么我会收到一条请求超时消息。但是，如果我只是将该站点地址放入带有 http:// 的浏览器（使用 IE6，但不是特定的），那么链接工作正常并且浏览器转到网页。浏览器有什么不同？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-21T04:54:35.543

该站点可能位于阻止 ICMP 请求（例如，ping）的防火墙后面。您的浏览器发出的 HTTP 请求通过 TCP/IP 进行。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-21T04:54:45.373

Ping 发送 ICMP 请求包。Web 服务器可以选择忽略它而不响应，而不是使用 ICMP 响应进行响应。

Web 浏览器使用 HTTP，这意味着它通过使用 SYN/SYNACK/ACK 交换在端口 80 上打开 TCP 连接。

这两个过程完全不同且独立，因此您可以独立启用/禁用任何一个。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T04:56:10.487

浏览器使用 TCP/IP 协议与服务器通信 HTTP 请求，当您使用 ping 时，它使用[ICMP](http://en.wikipedia.org/wiki/Internet_Control_Message_Protocol)协议，并且似乎是防火墙后面的服务器，该服务器丢弃了[ICMP Echo Requests](http://en.wikipedia.org/wiki/ICMP_Echo_Request)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T04:56:27.863

ping 本质上是通过 IMCP（一种协议）发送的“回显请求”数据包。对 ping 的正确响应是一个方便的“回显响应”数据包。但是，如果您发送回显响应数据包，人们就会知道您的存在。现在，当您运行 Web 服务器时，这没什么大不了的，但是当您运行标准桌面时，您不希望人们知道您的存在。结果是许多有安全意识的人会默认禁用 ping 响应，即使在服务器机器上也是如此。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-21T06:48:46.640

公共服务器通常不响应 ping 请求。毕竟，人们不会在打开浏览器之前输入 ping testsite.com，对吧？因此，回答这些站点的 ping 操作没有任何意义。另一方面：

几年前，一个孩子设法在几个小时内同时让 amazon.com 和其他几个这样的大网站瘫痪，让数百台机器用大量的 ping 请求轰炸它们。

从那时起，管理员就不再认为 ping 很友好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T04:55:41.610

这不是浏览器。您和阻止 ping 请求的服务器之间可能有防火墙，或者服务器可能根本没有响应 ping。这是一种常见的安全措施。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-21T04:55:51.097

Ping（也称为 ICMP）和 http 协议的工作方式完全不同，并且使用不同的端口。沿途不同的设备/防火墙可能会阻止 ping，但大多数允许 http 通过。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-21T05:46:39.247

正如其他人所说，Ping 数据包是与“HTML”数据包不同的数据包类型 - Ping 数据包是**ICMP/IP**而 HTML 是**TCP/IP**。您和网站之间的各种东西都可以选择阻止 ICMP 数据包，同时允许 TCP 数据包通过。

# html - 列出网站中的所有链接

> ID：220796
> 
> 赞同：1
> 
> 时间：2008-10-21T04:53:58.430
> 
> 标签：html

我有一个网站的所有网页。我的任务是将所有 HTML 文件更改为`.asp`文件并更改链接。我有大约 280 个 HTML 文件。
是否有任何软件或网络服务可以读取网站并向我显示网站的链接结构（以使我的工作更轻松），类似于网站地图？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T05:18:30.020

在 unix 中：

*   `find . -type f -name '*html' | awk '{ print "mv " $0 " " substr($0,0,length($0)-4)} | sh'`
*   `find . type f -name '*asp' | xargs perl -PI -e 's/\.html/\.asp/g;`

那应该这样做。

如果您使用的是 Windows，请安装 cygwin ;)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T05:00:27.467

如果链接使用相对路径，您只需将 .html 文件扩展名更改为 .asp 并将文件放在可以运行 ASP 的服务器上。

如果它们是绝对路径，您可以编辑主机文件以将原始域指向您自己的服务器，然后将未触及的文件放在您的服务器上。

如果您**确实**需要替换 URL，请尝试使用 UltraEdit 或 Notepad++（在 Windows 上）之类的文本编辑器，它们可以查找/替换文件（并使用正则表达式作为搜索短语）。或者，您可以在 Linux 上使用 sed 或 Perl。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T05:44:22.417

Dreamweaver 能够同时重命名文件并更改站点范围内的所有链接。我认为这取决于相对和/或绝对（以/不是 http 开头）文件名，因此如果有任何看起来像外部链接的链接（即以 http 开头）将不起作用。

除此之外，我建议编写一个简单的 python/perl/ruby(etc) 脚本来非常简单地完成它。

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2012-09-25T03:58:58.697

我不明白您在做什么，但是当我想知道网页上的链接时，我会从我的档案中抓取 Avant（版本 10）浏览器并安装。转到您要查看的网页，右键单击该页面并选择“打开此页面中的所有链接”。

# tfs - 以编程方式查找自上次良好构建以来的 TFS 更改

> ID：220813
> 
> 赞同：7
> 
> 时间：2008-10-21T04:58:49.200
> 
> 标签：tfs, msbuild, msbuild-task

我在 TFS 中有几个分支（开发、测试、阶段），当我将更改合并到测试分支中时，我希望自动构建和部署脚本找到所有更新的 SQL 文件并将它们部署到测试数据库。

我想我可以通过查找自上次良好构建以来与构建相关的所有变更集，找到变更集中的所有 sql 文件并部署它们来做到这一点。但是，由于某种原因，我似乎没有与构建相关的变更集，所以我的问题是双重的：

1) 如何确保变更集与特定构建相关联？

2) 如何获取自上次良好构建以来分支中已更改的文件列表？我有最后一次成功构建的构建，但我不确定如何在不检查变更集的情况下获取文件（如上所述，它与构建无关！）

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-31T09:02:32.270

谢谢斯科特，

过了一会儿，我找到了一个很好的方法来管理这个。

基本上，我创建了一个任务，它获取与构建相关的当前变更集（我的问题的第 1 点不是问题），然后遍历它们以查找 .sql 文件。一旦我有了这些列表，我就可以创建一个更改脚本或针对目标数据库执行它们。

代码看起来像这样：

```
TeamFoundationServer tfs = new TeamFoundationServer(TfsServerUrl);
VersionControlServer vcs = (VersionControlServer)tfs.GetService(typeof(VersionControlServer));

var buildServer = (IBuildServer)tfs.GetService(typeof(IBuildServer));

IBuildDetail build = buildServer.GetBuild(
    new Uri(BuildUri)
    , null
    , QueryOptions.All
);

build.RefreshAllDetails();

var changesets = InformationNodeConverters.GetAssociatedChangesets(build);

foreach (var changesetSummary in changesets)
{
    Changeset changeSet = vcs.GetChangeset(changesetSummary.ChangesetId);

    sqlFilePaths.AddRange(
        ProcessChangeSet(changeSet)
    );

} 
```

ProcessChangeSet 中的代码看起来像

```
List<string> sqlFilePaths = new List<string>();
foreach (Change change in changeSet.Changes)
{

    if ((change.Item.ItemType == ItemType.File)
        && (change.Item.ServerItem.EndsWith(".sql", StringComparison.OrdinalIgnoreCase))
        )
    {
        sqlFilePaths.Add(
            sqlPath
        );

    }
}
return sqlFilePathes; 
```

但是如果有人想要我很乐意给他们完整的代码。确保存储过程在整个系统中保持同步。这只会让架构更改在我的数据库中手动管理，我很乐意这样做。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-23T13:18:51.530

所以我可以理解这种方法的直观吸引力，但我认为这不是正确的方法。

一方面，这将是困难的。但第二个问题是 TFS 没有记录部署数据的好方法。

对于第一个问题，我不确定这意味着什么。对于第二个问题，您可以使用已更改文件的构建标签和 tf history today 列表。

作为替代方案，您可以重新考虑如何管理 SQL 更改。我使用一种低技术方法将当前未决更改保存在一个目录中，然后在部署后将文件移动到另一个目录。可以通过在数据库中保留部署历史记录表来增强此方法。您可能还想了解 vsts DB 的补充，当前的[CTP](http://blogs.msdn.com/gertd/archive/2008/09/30/visual-studio-team-system-2008-database-edition-gdr-september-ctp.aspx)有很多关于管理数据库更改的新功能。我还听说[Red Gate](http://www.red-gate.com/products/SQL_Packager/index.htm)也有很好的数据库管理工具。

# shell - 将标准输入和标准输出重定向到文件

> ID：220814
> 
> 赞同：2
> 
> 时间：2008-10-21T04:58:59.653
> 
> 标签：shell, redirect, batch-file, stdout, stdin

我目前是 C类**入门**的助教。这门课是使用 Visual Studio 教授的，但是在评分时，我只使用一个简单的 Windows 批处理脚本来处理所有提交的作业、编译它们、在测试文件上运行它们，并将输出重定向到我可以打印的一系列文本文件出来，做标记，然后交还给学生。整个过程运行得很好，除了当我重定向标准输入时，它不会像直接在控制台中输入相同的标准输入时那样出现在重定向的标准输出中。因此，为控制台格式化的代码输出不会在重定向输出中正确显示。以下文件片段显示了此问题。有谁知道一个简单的解决方案？

**文件：example.c**

```
#include <stdio.h>

int main()
{
    int v;
    printf("Enter a number: ");
    scanf("%i", &v);
    printf("You entered: %d\n", v);
    return 0;
} 
```

**文件：输入.txt**

```
42 
```

**输出（控制台）**

```
C:\>example.exe
Enter a number: 42
You entered: 42

C:\> 
```

**输出（重定向）**

```
C:\>example.exe < input.txt > output.txt

C:\>more output.txt
Enter a number: You entered: 42

C:\> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-21T05:13:48.423

这是预期的（正确的）行为。输入永远不是标准输出的一部分。如果你这样做`example.exe > output.txt`并且盲目地输入 42，你应该期望 42 在输出中也只出现一次。

我能想到的唯一解决方案是终端/外壳将会话记录为一个整体。Windows 命令外壳无法做到这一点。不过，您可以编写自己的终端代理，它将标准输入输入学生的程序并读取输出本身，同时以组合方式写出两者。在 POSIX（由 Cygwin 提供给您）下分叉执行另一个程序并重定向该程序的标准输入/输出非常容易，但我不知道普通的 DOS/Windows。

# c - 检测 C 中的键盘事件

> ID：220818
> 
> 赞同：10
> 
> 时间：2008-10-21T05:02:32.173
> 
> 标签：c, keyboard

如何在不使用第三方库的情况下检测 C 语言中的键盘事件？我应该使用信号处理吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-21T05:42:45.463

没有标准的方法，但是这些应该可以帮助您入门。

视窗：

```
getch(); 
```

Unix：

使用 W. Richard Stevens 的 Unix Programming 一书中的代码将终端设置为原始模式，然后使用 read()。

```
static struct termios   save_termios;
static int              term_saved;

int tty_raw(int fd) {       /* RAW! mode */
    struct termios  buf;

    if (tcgetattr(fd, &save_termios) < 0) /* get the original state */
        return -1;

    buf = save_termios;

    buf.c_lflag &= ~(ECHO | ICANON | IEXTEN | ISIG);
                    /* echo off, canonical mode off, extended input
                       processing off, signal chars off */

    buf.c_iflag &= ~(BRKINT | ICRNL | ISTRIP | IXON);
                    /* no SIGINT on BREAK, CR-toNL off, input parity
                       check off, don't strip the 8th bit on input,
                       ouput flow control off */

    buf.c_cflag &= ~(CSIZE | PARENB);
                    /* clear size bits, parity checking off */

    buf.c_cflag |= CS8;
                    /* set 8 bits/char */

    buf.c_oflag &= ~(OPOST);
                    /* output processing off */

    buf.c_cc[VMIN] = 1;  /* 1 byte at a time */
    buf.c_cc[VTIME] = 0; /* no timer on input */

    if (tcsetattr(fd, TCSAFLUSH, &buf) < 0)
        return -1;

    term_saved = 1;

    return 0;
}

int tty_reset(int fd) { /* set it to normal! */
    if (term_saved)
        if (tcsetattr(fd, TCSAFLUSH, &save_termios) < 0)
            return -1;

    return 0;
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-21T07:41:44.163

What about good old [kbhit](http://msdn.microsoft.com/en-us/library/58w7c94c(VS.80).aspx) ? If I understand the question correctly this will work. [Here](http://linux-sxs.org/programming/kbhit.html) is the kbhit implementation on Linux.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-21T05:04:24.213

不幸的是，标准 C 没有任何检测键盘事件的工具。您必须依赖特定于平台的扩展。信号处理不会帮助你。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-21T05:05:19.703

你真的应该使用第三方库。在 ANSI C 中绝对没有独立于平台的方法。信号处理不是方法。

# .net - 为什么 LINQ to SQL 比直接 SQL 查询执行得更好？

> ID：220822
> 
> 赞同：2
> 
> 时间：2008-10-21T05:05:26.503
> 
> 标签：.net, sql-server, linq-to-sql

奇怪的性能结果，我有一个 LINQ to SQL 查询，它使用几个 let 语句来获取各种信息，看起来像这样

```
 public IQueryable<SystemNews> GetSystemNews()
{
    using (var t = new TransactionScope(TransactionScopeOption.Required,
              new TransactionOptions { IsolationLevel = System.Transactions.IsolationLevel.ReadUncommitted }))
    {
        var results = from s in _datacontext.SystemNews
                      let member = GetMemberInfo(s.MemberID)
                      let determination = GetDetermination(s.DeterminationID.Value)
                      let daimoku = GetDaimoku(s.DaimokuID.Value)
                      let entry = GetEntry(s.EntryID.Value)
                      let encouragment = GetEncouragement(s.EncouragementID.Value)
                      select new SystemNews
                      {
                          NewsDate = s.NewsDate,
                          MemberID = s.MemberID,
                          PhotoID = s.PhotoID.Value,
                          DeterminationID = s.DeterminationID.Value,
                          DaimokuID = s.DaimokuID.Value,
                          EntryID = s.EntryID.Value,
                          EncouragementID = s.EncouragementID.Value,
                          Member = new LazyList<Members>(member),
                          Determination = new LazyList<Determinations>(determination),
                          Daimoku = new LazyList<MemberDaimoku>(daimoku),
                          Entry = new LazyList<MemberEntries>(entry),
                          Encouragement = new LazyList<MemberEncouragements>(encouragment),
                          IsDeterminationComplete = s.IsDeterminationComplete.Value
                      };
        return results;
    }
} 
```

我在 SQL 视图中创建了相同的东西（基本上至少是在此获得的各种信息），并且 LINQ to SQL 在 90 毫秒内返回结果，而视图返回相同的数据实际上在 700 毫秒内返回的信息更少。谁能解释一下？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-21T07:50:46.810

一般来说，LINQ-to-SQL 将“大致相同”，我同意缓存在这里可能是一个问题。确实需要查看生成的 SQL；最简单的方法是：

```
_datacontext.Log = Console.Out; 
```

然后尝试直接在查询分析器中运行 TSQL。SPROC 在能够优化访问、使用表变量等方面有一些优势；但是，LINQ 具有可组合性的优势——即您可以在单个查询中应用分页、排序、投影等。您可以*使用*SPROC 一次性完成，但这是一项非常艰苦的工作。

但实际上，关键在于查看 TSQL；例如，可能是您没有加载所有数据（延迟加载）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T05:14:03.210

您是否使用 SQL 分析器来检查 LINQ 生成的 SQL 与您用来比较的 SQL 之间的差异？

也许 LINQ to SQL 查询得到了更好的优化？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T05:23:16.890

您可能会看到缓存效果；这不是真的。

基准测试的原则之一是，您可以通过运行基准测试一次，在缓存中获取结果，然后再次运行并报告惊人的结果，或者执行相反的操作来调整您的基准测试......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-23T10:56:27.970

粗略一看，您的 Linq to SQL 查询似乎正在使用延迟加载。如果我是对的，那么运行您的查询当时实际上不会运行查询的所有部分是有道理的。这意味着，如果您将其与设置为一次性带回所有这些结果的 SQL 视图进行比较，那么这肯定需要更多的工作，因此需要额外的时间。

另外两点：

1.  确保您正在计时实际查询执行而不是查询表达式的分配。请记住，Linq 查询是延迟的，因此当您从上述方法返回查询时，它实际上是返回表达式而不是结果。通常，执行 Linq 查询的三种流行方法是运行 ToArray 或 ToList 扩展方法，或者使用 foreach 简单地迭代结果。

2.  如果您实际上是在进行延迟加载并为查询的实际执行计时，并且仍然在 Linq to SQL 中获得更好的结果，这可能是由于 SQL 视图返回的宽展平结果与被查询的窄块相比存在差异多次使用 Linq to SQL。

我从来没有做过任何基准测试来查看临界点在哪里，但是您可以想象一下，您有两个表 Table1 和 Table2，每个表都有 100 列，Table1 中有 1,000 行数据，其中也有一个与表 2 的许多关系，通常在表 2 中为表 1 中的每条记录产生 10 个匹配项。现在，如果您编写一个视图以将所有这些结果拉回单个查询中，您将期望大约 10,000 行数据，所有数据大约 200 列宽。通过发出两个单独的查询，但是通过 Linq to SQL 或任何其他机制，您可以改为从 Table1 获取初始 1,000 行 100 列宽的结果，然后选择剩余的 Table2 项目，可能是另外 100 列的 10,000 行，总共 1,100,000 个单元格（这比 SQL 视图中的 2,000,000 个单元格要少得多）。如果我们假设多对多关系的依赖行之间有很大程度的重叠，那么好处会更加夸张。在最极端的情况下，存在 100% 的重叠，这意味着我们只期望总共拉回 100,010 个数据单元，这远远少于平面视图返回的 2,000,000 个。

# wordpress - 如何根除 Wordpress 博客中的神秘字符编码问题？

> ID：220824
> 
> 赞同：3
> 
> 时间：2008-10-21T05:06:18.767
> 
> 标签：wordpress, encoding, utf-8

我正在尝试创建一个新的 Wordpress 博客。我在某些浏览器中看到有趣的字符，但在其他浏览器中没有看到单引号、双引号和省略号。我已经想到的事情：

*   输出本身的 HTML 模板页面设置为 UTF-8
*   管理页面是 UTF-8
*   存储数据的 MySQL 数据库表是 UTF-8 编码的
*   我正在输入常规键盘 (') 和 (") 的 (...)，而不是从另一个应用程序粘贴。
*   我正在使用 WordPress 开箱即用的 WSYWIG

看起来错误的浏览器（例如）：Windows 的 Firefox、IE7 Windows 的浏览器（例如）看起来不错的浏览器：OS X 的 Firefox、OS X 的 Safari

我从这里去哪里？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-29T18:01:19.077

转到 Windows 上的 Firefox，使用右键单击“查看页面信息”来查看 Firefox 看到的内容。

Your situation is probably being caused by not setting correctly the page encoding somewhere along the line. You can basically setup your encodings in the HTTP headers and in the HTML head. HTTP headers are influenced by the web server and the PHP script. HTML head is written out by PHP.

Check out your HTML output and read carefully [the W3C HTML standard on encodings](http://www.w3.org/TR/html401/charset.html) to see which charset encoding is specifying your page. Also, check your PHP to see if it's sending an HTTP header specifying the encoding. Finally, check your web server (some people configure Apache's httpd to send a default encoding. That is *evil*).

According to your symptoms, my guess is that you are not sending any *correct* encoding information through HTML/HTTP and the rendering depends on the default rendering of the browser, thus the issues you are seeing.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-22T09:34:29.427

使用的字体可能有问题。也许 Windows 字体无法正确显示使用的代码点（发生在一些不包括整个 UTF-8 频谱的免费软件字体中），而 OS X 字体包含这些代码点。

使用什么字体？

使用 Arial 或 sans-serif 作为 CSS 中的字体系列时，您可以检查页面输出吗？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-06-01T08:18:26.223

There can sometimes be a problem with other files that get loaded, for example via JavaScript, that might have the charset not set to UTF8.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-28T13:42:07.650

可能值得尝试通过[Browsershots](http://browsershots.org/)查看您的博客。这是一项免费服务，可让您在多个操作系统和浏览器中查看您的网站。如果所有 Browsershot 示例都出现相同的问题，那么您就知道这是一个 WordPress 问题。如果它只出现在少数几个上，那么它可能是每台机器/操作系统/浏览器的问题。

# c# - 只允许一台服务器访问网络驱动器上的文件

> ID：220828
> 
> 赞同：2
> 
> 时间：2008-10-21T05:08:20.820
> 
> 标签：c#, file-io, networking

我有一个在多个 IIS 服务器上运行的应用程序，需要解析放置在公共网络驱动器上的 CSV 文件。如果我使用[System.IO.FileSystemWatcher Created 事件](http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.created.aspx)在文件可用时收到事件通知，如何确保只有一台服务器解析文件？如果所有服务器都收到此更改的通知，所有服务器都将尝试解析它。第一台服务器是否应该在本地复制它然后解析它？这会导致其他服务器上的错误吗？我应该将远程目录访问权限设置为仅允许一台服务器读取访问权限吗？

该文件包含需要插入共享数据库的记录，但记录没有唯一键。因此，如果多台服务器同时抓取文件并插入记录，数据库中就会出现重复。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T06:22:15.663

关键问题是：当他们几乎同时尝试解析文件时，是否会发生不好的事情？文件系统级别基本上允许多次读取访问，因此仅此事实并不一定会破坏任何东西。

我可能会尝试在第一次文件访问时创建锁定文件的方法，并让服务器在访问文件之前查找锁定文件。完成后删除锁定文件。

您还可以在文件上设置排他锁，一次只有一台服务器能够执行此操作。其他人将无法尝试：

```
FileStream fs = new FileStream(
  FilePath, 
  FileMode.Open,
  FileAccess.ReadWrite, 
  FileShare.None
); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T01:58:36.513

替代锁定的另一个选项是将文件重命名为目录。为每个服务器创建一个子目录，然后让服务器尝试将文件重命名到其目录中（重命名是原子操作）。成功者解析文件。

锁定问题将很棘手，因为每个服务器仍然可以看到该文件，并且他们可能会尝试打开该文件，然后重复出错。重命名对于文件的所有者来说是绝对的。

还要记住，无论您使用什么解决方案，都可能出现“丢失文件”。如果服务器停止处理文件（错误、异常、重新启动...），它可能会被放弃。这些类型问题的典型解决方案是除了诸如文件观察器之类的东西之外，您还让服务器不时地轮询。

Copying the file to a server dir will help a bit with this. One downside would be if a server goes completely off-line, then its file will sit in a dir until the server comes back on-line.

# c++ - 在 C++ 中移动字符串中特定字符的简单方法？

> ID：220832
> 
> 赞同：1
> 
> 时间：2008-10-21T05:09:11.380
> 
> 标签：c++, string, character

如果我有字符串`.....ZZ..ZZ.....`or `.Z.1.Z.23Z.4.Z55`,

有没有一种简单的方法可以将`Z`字符串中的所有字符在当前位置右侧移动一个空格？

一些额外的测试字符串是：

*   `.Z`
*   `Z.`
*   `ZZ.`
*   `.ZZ`
*   `Z`
*   `ZZ`
*   `ZZZ`

我认为这个问题的一些较高投票的答案（包括当前接受的答案）在这些测试中不起作用。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T05:12:46.223

只需遍历文本并交换字符：

```
int main ()
{
    char text[] = "...Z.Z.Z...", temp;
    int text_len = strlen (text), i;
    for (i = text_len - 1; i >= 0; i--)
    {
        if (text[i] == 'Z')
        {
                temp = text[i+1];
                text[i+1] = text[i];
                text[i] = temp;
        }
    }
    printf ("%s\n", text);
    return 0;
} 
```

产生：

```
[~]$ gcc zshift.c && ./a.out
....Z.Z.Z.. 
```

* * *

评论中有很多关于上述代码中可能出现的 off-by-1 错误的讨论。但是，简单的测试/单步执行就足以表明情况并非如此。

```
zshift "Z." -> ".Z"
zshift ".Z" -> "."
zshift "Z" -> "" 
```

I think the behavior of "dropping" trailing Zs when shifting off the end of the string is sensible. After all, if you shift the bits of an integer, bits that end up outside the bounds of the integer are dropped.

If another behavior is desired -- for example, shifting only within the string -- the change to the algorithm is minimal:

```
temp = text[i+1];
if (temp == 0) continue;
text[i+1] = text[i];
text[i] = temp; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T05:44:03.337

Building on previously posted code here. Function gets str and strlen, overwrites str. Works also with subsequent Z. Going forward for speed improvement with subsequent Z.

```
void move_z_right (char* str, int strlen) {
    for (unsigned int i = 0; i < strlen - 1; ++i)
    {
        if (str[i] == 'Z')
        {
            unsigned int j = i+1;
            while (str[j] == 'Z' && j < strlen - 1) ++j;
            if (j == strlen) break; // we are at the end, done
            char tmp = str[j];
            str[j] = str[i];
            str[i] = tmp;
            i = j; // continue after new Z next run
        }
    }
} 
```

Note that John Millikin's solution is nicer to read and also correct.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T05:22:14.397

Slight fix to the previous answer (shift to the right and assume '.' means "can move here"):

```
 char text[] = "...Z.Z.Z...";

  for (int i = strlen(text) - 2); i > 0; --i) {
    if (text[i] == 'Z' && text[i + 1] == '.') {
      text[i] = '.';
      text[i + 1] = 'Z';
    }
  } 
```

# javascript - 将 JavaScript 代码转换为 VBScript 代码？

> ID：220838
> 
> 赞同：2
> 
> 时间：2008-10-21T05:13:10.687
> 
> 标签：javascript, vbscript, code-conversion

我的任务是将 JavaScript 编写的代码转换为 VBScript。它实际上是非常基本的代码，实际上只是需要转换的语法。

例如

```
 if (str == "string text") {
   foo = "foo";
} else {
   foo2 = "foo2";
} 
```

变成

```
 If (str = "string text") Then
   foo = "foo"
Else
   foo2 = "foo2"
End If 
```

我想知道是否存在将 JavaScript 转换为 VBScript 的工具？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-10-13T15:55:24.453

[https://stackoverflow.com/questions/569380/how-can-i-convert-javascript-to-vbscript](https://stackoverflow.com/questions/569380/how-can-i-convert-javascript-to-vbscript)

# asp.net-mvc - 带有 ASP.NET MVC 的 RESTful Web 服务

> ID：220845
> 
> 赞同：16
> 
> 时间：2008-10-21T05:20:00.983
> 
> 标签：asp.net-mvc, rest

您认为 ASP.NET MVC 是否能够开发 RESTful Web 服务以及您会使用哪种方法？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-07T13:01:29.710

我已经写了一系列关于[使用 ASP.Net MVC 开发 RESTful Web 服务](http://shouldersofgiants.co.uk/blog/)的文章……至少在 8 篇文章之后我已经完成了 80% 的工作。看一下：

[http://shouldersofgiants.co.uk/blog/](http://shouldersofgiants.co.uk/blog/)

我正在开发的 Web 服务支持多种表示（XHTML / JSON / XML / HELP）处理尽可能多的错误，并支持 POST 重载。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-21T06:08:12.713

看到这个 [http://msmvps.com/blogs/omar/archive/2008/10/03/create-rest-api-using-asp-net-mvc-that-speaks-both-json-and-plain-xml。 aspx](http://msmvps.com/blogs/omar/archive/2008/10/03/create-rest-api-using-asp-net-mvc-that-speaks-both-json-and-plain-xml.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T05:31:41.350

一般来说，我会说是的，ASP.Net MVC 可以开发 RESTful Web 服务。然而，很多时候数据的消费者是独一无二的，这可能不是最好的方法。

对于更大的应用程序服务或更复杂的服务，我建议以 RESTful 方式开发 MVC 控制器，以便在设计 MVC 时由视图使用。然后我会考虑用于大规模数据服务的 ADO.Net 数据服务或 WCF。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T13:08:32.973

彼得，

作为对 calebjenkins 的回应，如果您想创建一个 restful 版本的数据库，ADO.Net 数据服务非常好。

如果您想更好地控制您的 RESTful Web 服务，那么我将使用 WCF Web 服务。或者，如果您的数据存储不是数据库，那么 ADO.NET 数据服务并不是真正正确的解决方案。这是一篇非常好的[文章](http://www.developer.com/net/article.php/10916_3695436_1)，它让我开始了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-04-27T22:24:41.820

从 MVC 4 Web API 开始，正式支持构建 RESTful Web 服务。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T05:22:47.437

我会认真研究 ADO.NET 数据服务。（正式代号为 Astoria）里面有一些非常好的用于 Restful 服务的工具！

[http://msdn.microsoft.com/en-us/data/bb931106.aspx](http://msdn.microsoft.com/en-us/data/bb931106.aspx)

# asp.net - ASP.NET 和 IIS6：捕获所有应用程序错误

> ID：220846
> 
> 赞同：3
> 
> 时间：2008-10-21T05:20:03.027
> 
> 标签：asp.net, iis

我们小组的旧版 ASP 3.0 Web 应用程序能够通过在 IIS 的“自定义错误”选项卡中设置自定义错误文件来利用全局错误文件。我无法为 ASP.NET 应用程序找到类似的解决方案。

有谁知道是否有一种方法可以让一个集中的“Error.aspx”页面（例如）捕获整个应用程序池的错误？目的是避免向每个应用程序的全局错误处理程序添加自定义代码......

非常感谢任何指导！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T09:55:53.673

检查 global.asax.cs 文件的 Application_Error 方法。

您可以使用以下内容在此处获取错误的详细信息：

```
Exception myError = Server.GetLastError();
Exception baseException = myError.GetBaseException(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T13:10:51.330

我们已经使用 ELMAH 来满足您的要求。您可以让它在机器级别工作，这样您就不必在每个网站上设置自定义错误处理：

[http://code.google.com/p/elmah/](http://code.google.com/p/elmah/)

然后，您还可以在 web.config 中合并 <customErrors> 标记，以确保它们被重定向到错误页面。ELMAH 会确保您收到所有通知。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T05:41:18.133

您可以将`<customErrors defaultRedirect="[url]"></customErrors>`标签添加到您的 web.config，甚至添加到您的 machine.config 以重定向到自定义错误页面。自定义错误标签还支持多个可用于定义自定义错误的子元素。

请记住，在编辑 machine.config 文件时，它将影响该机器上的所有应用程序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T12:54:44.187

您还可以构建一个名为“ErrorHandlingModule”的自定义模块，该模块将进入 HttpModule。

```
public class ErrorHandlingModule : IHttpModule
{
    public void Init(HttpApplication application)
    {
        application.Error += new System.EventHandler(OnError);
    }

    public void OnError(object obj, EventArgs args)
    {
        Exception ex = HttpContext.Current.Server.GetLastError();
        //Log your error here or pick a funny message to display
        HttpContext.Current.Server.ClearError();
        HttpContext.Current.Response.Redirect("/Error.aspx", false);
    }
} 
```

它看起来像这样。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T11:57:04.070

您还可以利用 Global.asax 文件中的 Application_OnError 事件来捕获错误。然后，您可以按照上述 Ben R 进行操作。通过 Server.GetLastError() 例程捕获错误。

# multithreading - 在两个线程之间共享 Symbian 的 RFile

> ID：220847
> 
> 赞同：3
> 
> 时间：2008-10-21T05:21:15.693
> 
> 标签：multithreading, symbian

在我使用 Open C 移植到 Symbian 的多线程应用程序中，我有一个使用 RFile 将数据读/写到文件的对象。该对象应该可以从不同的线程访问（它是线程安全的），但是显然 RFile 对象只能在一个线程中访问。只要另一个线程使用 RFile 对象，我就会得到一个 KERN-EXEC 0。

有没有办法在不同线程之间共享 RFile 对象？我不能使用活动对象。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T22:16:52.303

创建第二个 RFile 句柄（我们称之为 secondFile）。不要打开它。改用 RFile::Duplicate(secondFile) 。之后，您进程中的所有线程都应该能够使用 secondFile 句柄。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T09:39:49.507

使用 RFs::ShareAuto() 似乎有效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-12T13:08:19.190

您正在寻找以下组合：

1.  将已经打开的文件从服务器传输到客户端

    ```
    RFile::TransferToClient(const RMessage2 &,TInt)const 
    ```

2.  将已打开的文件传输到另一个进程

    ```
    RFile::TransferToProcess(RProcess &,TInt,TInt)const 
    ```

3.  将已打开的文件传输到服务器

    ```
    RFile::TransferToServer(TIpcArgs &,TInt,TInt)const 
    ```

在第一个线程/服务器/进程和

1.  允许服务器采用客户端已经打开的文件

    ```
    RFile::AdoptFromClient(const RMessage2 &,TInt,TInt) 
    ```

2.  允许服务器采用来自客户端进程的已打开文件

    ```
    RFile::AdoptFromCreator(TInt,TInt) 
    ```

3.  允许客户端采用来自服务器的已打开文件

    ```
    RFile::AdoptFromServer(TInt,TInt) 
    ```

.. 在第二。这有效地复制了文件句柄，允许两者都使用它。

如果在同一进程中的线程之间传输，那么您可以更简单地使用

```
RFile::Duplicate(const RFile &,TOwnerType) 
```

# gcc - g++ 或 gcc 选项以获取带有警告 ID 的警告消息

> ID：220855
> 
> 赞同：6
> 
> 时间：2008-10-21T05:24:51.800
> 
> 标签：gcc, compiler-construction, warnings

默认情况下，gcc/g++ 仅打印带有行号的警告消息。我正在寻找 g++ 或 gcc 将构建警告消息与警告 ID 相关联的选项，以便可以轻松识别警告消息（无需解析）。还有更多选项可以获取更详细的警告信息吗？（虽然我认为每条警告信息本身都可以解释，但只是好奇）

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-21T08:16:24.637

在 GCC 4.x 中有一个选项“-fdiagnostics-show-option”，它显示用于关闭警告的选项：

```
$ gcc -fdiagnostics-show-option foo.c -Wall -o foo
foo.c: In function ‘main’:
foo.c:3: warning: unused variable ‘x’ [-Wunused-variable]
foo.c:4: warning: control reaches end of non-void function 
```

如果您需要解析警告，这可能会简化事情（尤其是在存在本地化错误消息的情况下）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T06:00:43.710

GCC 不提供更改/添加警告消息文本的选项。请参阅联机帮助页中的“控制诊断消息格式的选项”部分。

GCC 也不提供更详细的警告消息。

对不起。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T05:37:32.663

AFAIK，没有这样的选择 - 消息是自我识别的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T06:01:27.593

GCC 没有警告 ID <-> 消息映射。如果您想过滤特定的警告消息，请使用 CFLAG，例如`-Wno-pragmas`或`-Wno-oveflow`。完整的标志列表记录在手册页中。

# python - Python 的最佳视频处理库？

> ID：220866
> 
> 赞同：32
> 
> 时间：2008-10-21T05:34:41.190
> 
> 标签：python, video, editor

我想为我正在编写的 Python 应用程序包含一些简单的视频编辑功能，并通过谷歌搜索得出：

1.  pymedia
2.  pyglet（使用媒体模块）
3.  gst-python

要求：

1.  占地面积小。我已经在使用[wxPython](http://en.wikipedia.org/wiki/WxPython)（只是因为），它很容易使最终的 EXE 文件膨胀，所以最好是我用来实现这个视频编辑功能的任何东西都不应该显着增加膨胀。
2.  该库仍应积极维护。
3.  它不应该需要专有许可，所以 FMOD 是不可能的。
4.  最小依赖
5.  不是一个成熟的视频编辑器。不需要花哨的裤子。只是能够跳到视频的不同部分并抓取一帧或为视频部分的开始和结束放置（多个）标记以删除位。
6.  跨平台 - 最终应该能够在 Windows、Linux 和 OS X 上运行。

如果您使用了上面列出的任何上述视频编辑库或我在您的 Python 应用程序中尚未遇到的其他库，我想知道它们各自的缺陷以及它们如何相互叠加。如果您还知道 avbin 的 Python 绑定，我想知道在哪里可以找到它。

gst-python（带有 Python 绑定的 Gstreamer）似乎没有很好的文档记录。它似乎也与 pyGTK 紧密耦合，后者也是一个相当大的工具包。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-21T16:51:52.397

我建议你再看看 gst-python！它*不*与 pyGTK 耦合。您可以完全单独使用它，而不依赖于 Python 绑定或 GTK 的 C 库。我编写了几个使用 gst-python 而不是 GTK 的命令行实用程序。

确实，[gst-python 文档](http://gstreamer.freedesktop.org/modules/gst-python.html)不是那么好。但是，[C API 和模块的文档](http://gstreamer.freedesktop.org/documentation/)确实非常广泛，从 C API 到 Python API 的映射非常简单。还有一个非常活跃的 Gstreamer 社区，我很幸运能在邮件列表和 IRC 上找到帮助！

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-23T19:48:16.423

我现在正在使用 pyglet 做一个项目，我非常喜欢它。他们的网站现在运行缓慢，但通常他们文档页面上的[编程指南](http://www.pyglet.org/documentation.html)是对该库的极好介绍。他们的标准 API 文档也非常详尽。

我现在无法真正详细说明我们的项目是什么，但是当你说你需要时

> 不是一个成熟的视频编辑器。不需要花哨的裤子。只是能够跳到视频的不同部分并抓取一帧或为视频部分的开始和结束放置（多个）标记以删除位。

我可以验证 pyglet 将使编码变得轻而易举。

通过您的列表的其余部分，我现在不能代表/反对文件大小，但是 pyglet 正在积极维护中（事实上，就在两周前，开发人员在错误跟踪器上对我很有帮助），是 BSD许可，不依赖任何东西（可选的 AVBIN 支持其他文件格式），它适用于我们在 Windows 和 Linux 上。

到目前为止，我们遇到的唯一跨平台问题是，就 Linux 上的声音而言，您可以选择 OpenAL，它将立体声文件混合为单声道，而 ALSA 不会给您任何音量控制，同时正在播放声音。他们声称这两个问题都与上游有关，并且正在解决中。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-21T21:26:52.920

gst-python 根本没有与 pygtk 耦合——它只是碰巧共享一个公共对象模型（pygobject）和一种帮助生成绑定的方法。但是您可以在没有 pygtk 的情况下轻松使用 gst-python - 以[Flumotion](http://www.flumotion.net/Flumotion)为例。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-13T09:05:13.847

我目前也处于同样的困境中。我有幸与[Ardome 媒体库项目](https://code.launchpad.net/ardome-ml)的开发人员取得了联系。

这个库是一个基于过滤器图的系统。我认为它是基于 [http://www.khronos.org/openml/的。](http://www.khronos.org/openml/)

它目前在 Linux 和 OS X 上运行，并有待集成的 Windows。

# c# - 如何在 C# 中处理 XML

> ID：220867
> 
> 赞同：90
> 
> 时间：2008-10-21T05:35:34.103
> 
> 标签：c#, .net, xml

在 C# 2.0 中处理 XML 文档、XSD 等的最佳方法是什么？

使用哪些类等。解析和制作 XML 文档等的最佳实践是什么？

编辑：也欢迎.Net 3.5 建议。

* * *

## 回答 #1

> 赞同：186
> 
> 时间：2008-10-21T06:40:13.617

在 C# 2.0 中读取和写入的主要方法是通过**XmlDocument**类完成的。您可以通过它接受的 XmlReader 将大部分设置直接加载到 XmlDocument 中。

### 直接加载 XML

```
XmlDocument document = new XmlDocument();
document.LoadXml("<People><Person Name='Nick' /><Person Name='Joe' /></People>"); 
```

### 从文件加载 XML

```
XmlDocument document = new XmlDocument();
document.Load(@"C:\Path\To\xmldoc.xml");
// Or using an XmlReader/XmlTextReader
XmlReader reader = XmlReader.Create(@"C:\Path\To\xmldoc.xml");
document.Load(reader); 
```

我发现读取 XML 文档最简单/最快的方法是使用 XPath。

### 使用 XPath 读取 XML 文档（使用允许我们编辑的 XmlDocument）

```
XmlDocument document = new XmlDocument();
document.LoadXml("<People><Person Name='Nick' /><Person Name='Joe' /></People>");

// Select a single node
XmlNode node = document.SelectSingleNode("/People/Person[@Name = 'Nick']");

// Select a list of nodes
XmlNodeList nodes = document.SelectNodes("/People/Person"); 
```

如果您需要使用 XSD 文档来验证 XML 文档，您可以使用它。

### 根据 XSD 模式验证 XML 文档

```
XmlReaderSettings settings = new XmlReaderSettings();
settings.ValidateType = ValidationType.Schema;
settings.Schemas.Add("", pathToXsd); // targetNamespace, pathToXsd

XmlReader reader = XmlReader.Create(pathToXml, settings);
XmlDocument document = new XmlDocument();

try {
    document.Load(reader);
} catch (XmlSchemaValidationException ex) { Trace.WriteLine(ex.Message); } 
```

### 在每个节点上针对 XSD 验证 XML（更新 1）

```
XmlReaderSettings settings = new XmlReaderSettings();
settings.ValidateType = ValidationType.Schema;
settings.Schemas.Add("", pathToXsd); // targetNamespace, pathToXsd
settings.ValidationEventHandler += new ValidationEventHandler(settings_ValidationEventHandler);

XmlReader reader = XmlReader.Create(pathToXml, settings);
while (reader.Read()) { }

private void settings_ValidationEventHandler(object sender, ValidationEventArgs args)
{
    // e.Message, e.Severity (warning, error), e.Error
    // or you can access the reader if you have access to it
    // reader.LineNumber, reader.LinePosition.. etc
} 
```

### 编写 XML 文档（手动）

```
XmlWriter writer = XmlWriter.Create(pathToOutput);
writer.WriteStartDocument();
writer.WriteStartElement("People");

writer.WriteStartElement("Person");
writer.WriteAttributeString("Name", "Nick");
writer.WriteEndElement();

writer.WriteStartElement("Person");
writer.WriteStartAttribute("Name");
writer.WriteValue("Nick");
writer.WriteEndAttribute();
writer.WriteEndElement();

writer.WriteEndElement();
writer.WriteEndDocument();

writer.Flush(); 
```

***（更新 1）***

在 .NET 3.5 中，您可以使用 XDocument 来执行类似的任务。但是，不同之处在于您可以通过执行 Linq 查询来选择您需要的确切数据。通过添加对象初始化器，您可以创建一个查询，甚至可以在查询本身中返回您自己定义的对象。

```
 XDocument doc = XDocument.Load(pathToXml);
    List<Person> people = (from xnode in doc.Element("People").Elements("Person")
                       select new Person
                       {
                           Name = xnode.Attribute("Name").Value
                       }).ToList(); 
```

***（更新 2）***

.NET 3.5 中的一个好方法是使用 XDocument 创建 XML，如下所示。这使得代码以与所需输出相似的模式出现。

```
XDocument doc =
        new XDocument(
              new XDeclaration("1.0", Encoding.UTF8.HeaderName, String.Empty),
              new XComment("Xml Document"),
              new XElement("catalog",
                    new XElement("book", new XAttribute("id", "bk001"),
                          new XElement("title", "Book Title")
                    )
              )
        ); 
```

创建

```
<!--Xml Document-->
<catalog>
  <book id="bk001">
    <title>Book Title</title>
  </book>
</catalog> 
```

所有其他方法都失败了，您可以查看这篇 MSDN 文章，其中包含我在这里讨论过的许多示例以及更多示例。 [http://msdn.microsoft.com/en-us/library/aa468556.aspx](http://msdn.microsoft.com/en-us/library/aa468556.aspx)

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2008-10-21T05:43:00.720

这取决于大小；对于中小型 xml，诸如[XmlDocument](http://msdn.microsoft.com/en-us/library/system.xml.xmldocument.aspx)（任何 C#/.NET 版本）或[XDocument](http://msdn.microsoft.com/en-us/library/system.xml.linq.xdocument.aspx)（.NET 3.5/C#3.0）之类的 DOM 是明显的赢家。对于使用 xsd，您可以使用[XmlReader](http://msdn.microsoft.com/en-us/library/system.xml.xmlreader.aspx)加载 xml ，并且 XmlReader 接受（[创建](http://msdn.microsoft.com/en-us/library/system.xml.xmlreader.create.aspx)）一个[XmlReaderSettings](http://msdn.microsoft.com/en-us/library/system.xml.xmlreadersettings.aspx)。XmlReaderSettings 对象具有可用于执行 xsd（或 dtd）验证的[Schemas属性。](http://msdn.microsoft.com/en-us/library/system.xml.xmlreadersettings.schemas.aspx)

对于编写 xml，同样适用，注意使用 LINQ-to-XML (XDocument) 比旧的 XmlDocument 布局内容要容易一些。

但是，对于巨大的 xml，DOM 可能会占用太多内存，在这种情况下，您可能需要直接使用 XmlReader/XmlWriter。

最后，为了操作 xml，您可能希望使用[XslCompiledTransform](http://msdn.microsoft.com/en-us/library/system.xml.xsl.xslcompiledtransform.aspx)（一个 xslt 层）。

使用 xml 的替代方法是使用对象模型；您可以使用[xsd.exe](http://msdn.microsoft.com/en-us/library/x6c1kb0s.aspx)创建代表 xsd 兼容模型的类，并将 xml 加载*为 objects*，使用 OO 对其进行操作，然后再次序列化这些对象；您可以使用[XmlSerializer](http://msdn.microsoft.com/en-us/library/system.xml.serialization.xmlserializer.aspx)执行此操作。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-21T18:51:26.633

nyxtom 的回答非常好。我会在其中添加几件事：

如果您需要对 XML 文档进行只读访问，那么`XPathDocument`它是一个比`XmlDocument`.

using 的缺点`XPathDocument`是不能使用熟悉的`SelectNodes`和`SelectSingleNode`方法`XmlNode`。相反，您必须使用`IXPathNavigable`提供的工具：用于`CreateNavigator`创建`XPathNavigator`，并使用`XPathNavigator`来创建`XPathNodeIterator`s 来遍历通过 XPath 找到的节点列表。这通常需要比方法多几行的代码`XmlDocument`。

但是：`XmlDocument`和`XmlNode`类实现了`IXPathNavigable`，因此您编写的在 an 上使用这些方法的任何代码`XPathDocument`也可以在`XmlDocument`. 如果您习惯于针对 编写`IXPathNavigable`，您的方法可以针对任一对象工作。（这就是为什么使用`XmlNode`和`XmlDocument`在方法签名中被 FxCop 标记的原因。）

可悲的是，`XDocument`and `XElement`(and `XNode`and `XObject`) 没有实现`IXPathNavigable`.

nyxtom 的答案中没有的另一件事是`XmlReader`. 通常用于`XmlReader`避免在开始处理之前将 XML 流解析为对象模型的开销。相反，您使用 an 一次`XmlReader`处理一个 XML 节点的输入流。这本质上是 .NET 对 SAX 的回答。它使您可以编写非常快速的代码来处理非常大的 XML 文档。

`XmlReader`还提供了处理 XML 文档片段的最简单方法，例如 SQL Server 的 FOR XML RAW 选项返回的没有包含元素的 XML 元素流。

您编写的代码`XmlReader`通常与它所读取的 XML 格式紧密耦合。使用 XPath 可以让您的代码与 XML 更松散地耦合，这就是为什么它通常是正确答案的原因。但是当你需要使用时`XmlReader`，你真的需要它。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-21T05:47:40.303

首先，了解新的**XDocument**和**XElement**类，因为它们是对先前 XmlDocument 系列的改进。

1.  他们使用 LINQ
2.  它们更快、更轻

**但是**，您可能仍必须使用旧类来处理遗留代码——尤其是以前生成的代理。在这种情况下，您将需要熟悉在这些 XML 处理类之间进行互操作的一些模式。

我认为您的问题非常广泛，并且需要在一个答案中提供太多细节才能提供详细信息，但这是我想到的第一个一般性答案，并且可以作为一个开始。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-21T06:51:24.403

101 个 Linq 样本

[http://msdn.microsoft.com/en-us/library/bb387098.aspx](http://msdn.microsoft.com/en-us/library/bb387098.aspx)

和**Linq to XML 示例**

[http://msdn.microsoft.com/en-us/vbasic/bb688087.aspx](http://msdn.microsoft.com/en-us/vbasic/bb688087.aspx)

而且我认为 Linq 使 XML 变得简单。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-21T06:49:49.820

如果您使用 .NET 3.5 并且不害怕实验代码，您可以查看 LINQ to XSD ( [http://blogs.msdn.com/xmlteam/archive/2008/02/21/linq-to- xsd-alpha-0-2.aspx](http://blogs.msdn.com/xmlteam/archive/2008/02/21/linq-to-xsd-alpha-0-2.aspx)），它将从 XSD 生成 .NET 类（包括来自 XSD 的内置规则）。

然后，它能够直接写入文件并从文件中读取，确保它符合 XSD 规则。

我绝对建议为您使用的任何 XML 文档使用 XSD：

*   允许您在 XML 中强制执行规则
*   允许其他人查看 XML 的结构/结构
*   可用于验证 XML

我发现 Liquid XML Studio 是生成 XSD 的绝佳工具，而且它是免费的！

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-02-09T10:18:31.547

使用 XmlDocument 类编写 XML

```
//itemValues is collection of items in Key value pair format
//fileName i name of XML file which to creatd or modified with content
    private void WriteInXMLFile(System.Collections.Generic.Dictionary<string, object> itemValues, string fileName)
    {
        string filePath = "C:\\\\tempXML\\" + fileName + ".xml";
        try
        {

            if (System.IO.File.Exists(filePath))
            {
                XmlDocument doc = new XmlDocument();
                doc.Load(filePath);                   

                XmlNode rootNode = doc.SelectSingleNode("Documents");

                XmlNode pageNode = doc.CreateElement("Document");
                rootNode.AppendChild(pageNode);

                foreach (string key in itemValues.Keys)
                {

                    XmlNode attrNode = doc.CreateElement(key);
                    attrNode.InnerText = Convert.ToString(itemValues[key]);
                    pageNode.AppendChild(attrNode);
                    //doc.DocumentElement.AppendChild(attrNode);

                }
                doc.DocumentElement.AppendChild(pageNode);
                doc.Save(filePath);
            }
            else
            {
                XmlDocument doc = new XmlDocument();
                using(System.IO.FileStream fs = System.IO.File.Create(filePath))
                {
                    //Do nothing
                }

                XmlNode rootNode = doc.CreateElement("Documents");
                doc.AppendChild(rootNode);
                doc.Save(filePath);

                doc.Load(filePath);

                XmlNode pageNode = doc.CreateElement("Document");
                rootNode.AppendChild(pageNode);

                foreach (string key in itemValues.Keys)
                {                          
                    XmlNode attrNode = doc.CreateElement(key);                           
                    attrNode.InnerText = Convert.ToString(itemValues[key]);
                    pageNode.AppendChild(attrNode);
                    //doc.DocumentElement.AppendChild(attrNode);

                }
                doc.DocumentElement.AppendChild(pageNode);

                doc.Save(filePath);

            }
        }
        catch (Exception ex)
        {

        }

    }

OutPut look like below
<Dcouments>
    <Document>
        <DocID>01<DocID>
        <PageName>121<PageName>
        <Author>Mr. ABC<Author>
    <Dcoument>
    <Document>
        <DocID>02<DocID>
        <PageName>122<PageName>
        <Author>Mr. PQR<Author>
    <Dcoument>
</Dcouments> 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-21T16:41:01.827

如果您在设计器中创建类型化数据集，那么您会自动获得一个 xsd，一个强类型化对象，并且可以使用一行代码加载和保存 xml。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-03-31T18:57:44.630

作为一名 C# 程序员，我个人的看法是，在 C# 中处理 XML 的最佳方式是将这部分代码委托给 VB .NET 项目。在 .NET 3.5 中，VB .NET 具有 XML Literals，这使得处理 XML 更加直观。见这里，例如：

[Visual Basic 中的 LINQ to XML 概述](http://msdn.microsoft.com/en-us/library/bb384460.aspx)

（请务必将页面设置为显示 VB 代码，而不是 C# 代码。）

我会用 C# 编写项目的其余部分，但在引用的 VB 项目中处理 XML。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-21T18:55:43.130

Cookey 的回答很好......但这里有关于如何从 XSD（或 XML）创建强类型对象并在几行代码中序列化/反序列化的详细说明：

[指示](http://www.stevehorn.cc/#!/blog/generate-code-from-xml-schema-xsdexe "指示")

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-01-29T14:40:03.320

纽约时报，

示例 1 中的“doc”和“xdoc”不应该匹配吗？

```
XDocument **doc** = XDocument.Load(pathToXml);
List<Person> people = (from xnode in **xdoc**.Element("People").Elements("Person")
                   select new Person
                   {
                       Name = xnode.Attribute("Name").Value
                   }).ToList(); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2018-08-28T11:21:10.750

如果您需要在`XmlNode`<=> `XNode`<=>之间转换数据`XElement`
（例如为了使用 LINQ），此扩展可能对您有所帮助：

```
public static class MyExtensions
{
    public static XNode GetXNode(this XmlNode node)
    {
        return GetXElement(node);
    }

    public static XElement GetXElement(this XmlNode node)
    {
        XDocument xDoc = new XDocument();
        using (XmlWriter xmlWriter = xDoc.CreateWriter())
            node.WriteTo(xmlWriter);
        return xDoc.Root;
    }

    public static XmlNode GetXmlNode(this XElement element)
    {
        using (XmlReader xmlReader = element.CreateReader())
        {
            XmlDocument xmlDoc = new XmlDocument();
            xmlDoc.Load(xmlReader);
            return xmlDoc;
        }
    }

    public static XmlNode GetXmlNode(this XNode node)
    {
        return GetXmlNode(node);
    }
} 
```

用法：

```
XmlDocument MyXmlDocument = new XmlDocument();
MyXmlDocument.Load("MyXml.xml");
XElement MyXElement = MyXmlDocument.GetXElement(); // Convert XmlNode to XElement
List<XElement> List = MyXElement.Document
   .Descendants()
   .ToList(); // Now you can use LINQ
... 
```

# asp.net - 知道我的 ASP.net 应用程序的良好页面加载进度条吗？

> ID：220872
> 
> 赞同：3
> 
> 时间：2008-10-21T05:39:15.640
> 
> 标签：asp.net, progress-bar, pageload

只是想知道是否有人看到 C# .net 应用程序的任何可用进度条。我的应用程序大约需要 20-60 秒才能加载，我希望在用户等待时向他们显示进度条。我看到了[这个，](http://www.codeproject.com/KB/aspnet/ASPNETAJAXPageLoader.aspx)但是示例站点似乎不起作用，这并不能激发信心。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-21T22:34:47.790

您可以使用[AJAX UpdateProgress 控件](http://ajax.net-tutorials.com/controls/updateprogress-control/)。

```
<asp:ScriptManager ID="ScriptManager1" runat="server" />
    <asp:UpdateProgress runat="server" id="PageUpdateProgress">
        <ProgressTemplate>
            Loading...
        </ProgressTemplate>
    </asp:UpdateProgress>
    <asp:UpdatePanel runat="server" id="Panel">
        <ContentTemplate>
            <asp:Button runat="server" id="UpdateButton" onclick="UpdateButton_Click" text="Update" />
        </ContentTemplate>
    </asp:UpdatePanel> 
```

如果您想要动画，您需要做的就是将动画 .gif 弹出到“ProgressTemplate”中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T05:58:11.860

我会查看这篇博客文章 - 似乎是一个很好的方法。我自己没有测试过...

[http://mattberseth.com/blog/2008/05/aspnet_ajax_progress_bar_contr.html](http://mattberseth.com/blog/2008/05/aspnet_ajax_progress_bar_contr.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-09-14T04:50:57.500

在你需要写这个的 aspx 页面中，我添加了一些你自己需要定义的 CSS 类，这个代码将帮助你

```
<asp:Panel ID="ProgressIndicatorPanel" runat="server" Style="display: none" CssClass="modalPopup">
        <div id="ProgressDiv" class="progressStyle">
            <ul class="ProgressStyleTable" style="list-style:none;height:60px">
                <li style="position:static;float:left;margin-top:0.5em;margin-left:0.5em">
                    <asp:Image ID="ProgressImage" runat="server" SkinID="ProgressImage" />
                </li>
                <li style="position:static;float:left;margin-top:0.5em;margin-left:0.5em;margin-right:0.5em">
                    <span id="ProgressTextTableCell"> Loading, please wait... </span>
                </li>
            </ul>
        </div>
    </asp:Panel> 
```

定义一个函数说 ProgressIndicator 如下

```
var ProgressIndicator = function (progPrefix) {
    var divId = 'ProgressDiv';
    var textId = 'ProgressTextTableCell';
    var progressCss = "progressStyle";

    if (progPrefix != null) {
        divId = progPrefix + divId;
        textId = progPrefix + textId;
    }

    this.Start = function (textString) {
        if (textString) {
            $('#' + textId).text(textString);
        }
        else {
            $('#' + textId).text('Loading, please wait...');
        }
        this.Center();
        //$('#' + divId).show();
        var modalPopupBehavior = $find('ProgressModalPopupBehaviour');
        if (modalPopupBehavior != null) modalPopupBehavior.show();
    }

    this.Center = function () {
        var viewportWidth = jQuery(window).width();
        var viewportHeight = jQuery(window).height();
        var progressDiv = $("#" + divId);
        var elWidth = progressDiv.width();
        var elHeight = progressDiv.height();
        progressDiv.css({ top: ((viewportHeight / 2) - (elHeight / 2)) + $(window).scrollTop(),
            left: ((viewportWidth / 2) - (elWidth / 2)) + $(window).scrollLeft(), visibility: 'visible'
        });
    }

    this.Stop = function () {
        //$("#" + divId).hide();
        var modalPopupBehavior = $find('ProgressModalPopupBehaviour');
        if (modalPopupBehavior != null) modalPopupBehavior.hide();
    }
}; 
```

给出的示例包含一个带模态的进度指示器，即当进度指示器运行时，它会禁用在屏幕上执行的其他操作。如果不需要，可以删除模态部分。

# rss - Google 阅读器如何获取 RSS 提要中的每个项目？

> ID：220878
> 
> 赞同：24
> 
> 时间：2008-10-21T05:43:03.777
> 
> 标签：rss, google-reader

Slashdot 的 RSS 提要是[http://rss.slashdot.org/Slashdot/slashdot](http://rss.slashdot.org/Slashdot/slashdot)。如果我直接下载 XML 文件，我只会得到今天的一些帖子。但是，如果我在 Google 阅读器中订阅提要，并在他们的“无限滚动”界面中继续向下滚动，似乎我可以从过去获得任意数量的 Slashdot 帖子——也许我可以得到每一个 Slashdot 帖子？

1.  Google 阅读器如何从 RSS 提要中检索无限数量的帖子？
2.  我该怎么做？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-21T05:49:00.317

谷歌为其所有用户跟踪一个提要实例，因此他们一直在跟踪和存储 Slashdot 文章，例如，早在任何新订阅者开始阅读之前。

为此，您必须定期轮询您想要的 RSS 提要并存储您在本地找到的任何独特文章。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-21T14:54:35.397

我刚刚发现，如果您通过了身份验证，您可以执行以下操作：

[http://www.google.com/reader/atom/feed/http://rss.slashdot.org/Slashdot/slashdot?n=100](http://www.google.com/reader/atom/feed/http://rss.slashdot.org/Slashdot/slashdot?n=100)

从提要中获取任意数量的结果。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-21T05:46:14.830

他们多年来一直在为网络编制索引，并存储他们遇到的所有内容。因此，在您向页面添加“订阅此”链接的那一刻，谷歌爬虫将开始索引该页面并存储它。

对于 RSS，它们还具有让多个人订阅同一个提要的好处。

因此，对于您的应用程序，我建议通过在本地保存任何下载的项目来解决这个问题，以便新订阅可以回到第一个用户订阅该提要的时间点。它不会给你无限的，但随着时间的推移，它会给你一个比仅仅 20 个最新项目更大的存档。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-03-30T18:33:20.023

我构建了一个 RSS 存档服务，可以满足您的要求（[https://app.pub.center](https://app.pub.center)）。所有的 RSS 都可以通过 REST 免费使用。如果您想要推送通知，则必须切换到付费计划。

PubCenter 每天轮询它的 RSS 提要目录，并缓存文章。然后，您可以按时间顺序获取这些文章。例如：

大西洋的第 1 页`https://pub.center/feed/02702624d8a4c825dde21af94e9169773454e0c3/articles?limit=10&page=1`

大西洋的第 2 页`https://pub.center/feed/02702624d8a4c825dde21af94e9169773454e0c3/articles?limit=10&page=2`

# perl - Perl：while ($key = each %hash) 不会在 key = 0 处停止

> ID：220879
> 
> 赞同：10
> 
> 时间：2008-10-21T05:43:55.960
> 
> 标签：perl, hash, each, while-loop

显然，我不需要这个；我只是好奇这里发生了什么。我错过了一些简单的东西吗？我可以在所有版本的 Perl 中依赖这种行为吗？）

Perl v5.8.8：

```
%h = ( 0=>'zero', 1=>'one', 2=>'two' );
while ($k = each %h) {
    $v = delete $h{$k};
    print "deleted $v; remaining: @h{0..2}\n";
} 
```

输出

```
deleted one; remaining: zero  two
deleted zero; remaining:   two
deleted two; remaining: 
```

`man perlfunc`(each) 没有解释为什么当`$k`分配为 0 时 while 循环继续。代码表现得好像`while`循环上的条件是`($k = each %h, defined $k)`。

如果循环条件实际更改为， `($k = each %h, $k)`那么它确实会`$k = 0`按预期停止。

它还停留在`$k = 0`以下重新实现`each`：

```
%h = ( 0=>'zero', 1=>'one', 2=>'two' );
sub each2 {
    return each %{$_[0]};
}
while ($k = each2 \%h) {
    $v = delete $h{$k};
    print "deleted $v; remaining: @h{0..2}\n";
} 
```

只输出：

```
deleted one; remaining: zero  two 
```

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-10-21T06:52:50.437

您`each`在标量上下文中调用，因此由于列表返回值而无法正常工作。

就像

```
while ($line = <FILE>) 
```

是添加隐式的特殊情况`defined`，所以是

```
while ($key = each %hash) 
```

在 5.8.8 中，这发生在 op.c，第 3760-3766 行：

```
case OP_SASSIGN:
  if (k1->op_type == OP_READDIR
      || k1->op_type == OP_GLOB
      || (k1->op_type == OP_NULL && k1->op_targ == OP_GLOB)
      || k1->op_type == OP_EACH)
    expr = newUNOP(OP_DEFINED, 0, expr);
  break; 
```

我不确定这是否适用于所有版本的 Perl 5。

另请参阅： while() 何时在 PerlMonks 上[测试已定义与真值。](http://www.perlmonks.org/?node_id=132451)我找不到 Perl 文档中提到的地方（提到了`<FILE>`案例，但我没有看到`each`案例）。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-21T20:17:51.797

cjm 是对的。我只想补充一点，当遇到类似这样的奇怪事情时，通过[B::Deparse](http://search.cpan.org/perldoc?B::Deparse)运行代码以了解 Perl 如何理解您的代码通常很有帮助。我也喜欢使用 -p 开关来显示优先级错误。

```
$ perl -MO=Deparse,p your_example.plx
(%h) = (0, 'zero', 1, 'one', 2, 'two');
while (defined($k = each %h)) {
    $v = delete $h{$k};
    print "deleted $v; remaining: @h{0..2}\n";
}
your_example.plx syntax OK 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T17:44:31.357

谢谢，cjm。很明显，a 的某种隐式添加`defined` 就像 glob 那样进行，但没有记录在案。现在至少我知道这种特殊处理适用的有限情况。

但是信息应该在 perlfunc 文档中，而不仅仅是 Perl 源代码！

# linux - 如何在 SUSE 中将服务器程序配置为在启动时自动启动？

> ID：220881
> 
> 赞同：0
> 
> 时间：2008-10-21T05:44:13.277
> 
> 标签：linux, suse, autostart

有什么好的 SUSE 帮助网站吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T06:08:20.280

服务器程序使用从 链接的脚本启动`/etc/init.d/rc*.d`。这是添加另一个的正确方法：

1.  创建一个`/etc/init.d/<serverprogram>`使用正确 LSB 元信息调用的 shell 脚本。您可以将其基于现有脚本之一，它应该是不言自明的。
2.  然后用于根据 LSB 元信息`insserv`自动生成正确的符号链接。`/etc/init.d/rc*.d`

# c++ - 我的 C++ 程序应该支持 IA64 还是只支持 x64？

> ID：220884
> 
> 赞同：7
> 
> 时间：2008-10-21T05:46:11.633
> 
> 标签：c++, c, 64-bit, itanium

我的程序应该支持 IA64，还是应该只支持 x64？

我自己无法轻松找到 IA64 计算机。IA64死了吗？

MS 似乎对 IA64 有广泛的支持，但我花了很长时间才找到一个 IA64，最后我不得不在 eBay 上得到它。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-21T07:09:53.510

你开发什么样的软件？如果它不是数据中心类型的应用程序或高端数字运算应用程序，如果对 ia64 版本有任何需求，我会感到惊讶。即便如此，我认为这将是一种情况，如果你必须询问是否应该支持它，你可能不需要。

我想到的几件事可能会妨碍 ia64 端口：

*   您依赖的任何第三方工具或库都需要支持它
*   在 x86 和 x64 上基本上未被注意到的未对齐访问将在 ia64 上引起头痛

当然，我不为 Gartner 或 IDC 或任何进行市场分析的人工作，所以你应该带着怀疑的态度接受我在这里所说的话。

有客户或潜在客户询问过吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-03-07T15:50:05.183

如果您可以访问 IA64，那么让您的代码在其上运行是绝对值得的。将您的代码移植到另一个 CPU 架构将揭示各种隐藏的问题。

您可能有一个字符串溢出 1，它不会在 Linux/Windows/x86 上显示出来，但由于堆栈布局或结构对齐方式不同而导致程序崩溃。您可能会假设 ~1UL == 0xFFFFFFFF。

我保持我的 C++ 代码 IA64 干净，但我已经有几台机器，因为我是粉丝。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T06:00:53.710

您是唯一有资格判断预期销售额是否能够支付开发和支持成本的人。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-03-07T14:59:51.057

从理论上讲，假设您坚持良好的 C++ 编程实践，您不应该关心您正在写入的是 x64、IA64 还是 SPARC 或 PowerPC 或其他什么。只要确保您的代码是 64 位干净的（就像不假设整数和指针大小相同），您就可以了。

除了...

异常的硬件问题、不符合标准的编译器或您的语言中的“实现定义的”尖角总是会导致奇怪的边缘条件。（C 和 C++ 都包含很多“实现定义”的东西！）

所以...

你会想要测试你的目标。这可能会变得非常昂贵，但有些地方可以让您在给定的硬件平台上测试应用程序，但需要付费。如果你在跨平台的东西上做了很多工作，那么在内部购买你的硬件可能是最便宜的，但小商店和稀有平台通常最好在租用的数据中心硬件上进行测试。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T11:16:26.397

除非客户特别要求，否则我不会为 IA64 支持而烦恼。否则，它只是另一个测试平台。英特尔是否仍然生产任何基于 IA64 的处理器？

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-21T06:01:30.400

如果您使用 C++ 编写，这真的很重要吗？我的意思是，你没有说是什么让你的程序“需要知道”它运行的机器的底层架构。从 C++ 本身来看，您应该得到很好的保护，避免两者之间的任何差异。当然，在深奥的平台上进行测试可能会很困难，但是您必须在您“支持”的所有平台上自己进行测试吗？

# java - 如何在 Java 中“要求”一个邻居类？

> ID：220887
> 
> 赞同：2
> 
> 时间：2008-10-21T05:47:05.640
> 
> 标签：java

在 Ruby 中，我经常编写一些小类，并有一个主类组织小家伙完成工作。我通过写作来做到这一点

```
require "converter.rb"
require "screenFixer.rb"
.
.
. 
```

在主类的顶部。我如何在 Java 中做到这一点？是“进口”吗？

另外，有人可以为这个问题想出一个更好的标题吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-21T06:05:29.457

如果您的意思是您要编写一些将使用另一个类的代码。是的，您需要使用 import 语句导入这些类。

IE

```
package com.boo;

import com.foo.Bar;

public class StackOverflow {

private Bar myBar;

} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T06:07:06.927

您不会在 java 中导入您自己的 *.java 文件。相反，你会这样做。

```
javac file1.java file2.java file3.java
java file1 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T06:11:14.203

如果这些其他类仅由您的“主”类使用，则有几个选项需要考虑，它们不需要任何导入：

*   您可以在主类中将它们设为私有静态嵌套类。
*   您可以将它们设为“包访问”（默认值 - 无访问修饰符）

但是，如果它们是其他地方的公共课程，那么您确实需要导入（或在任何地方完全限定它们，但这太可怕了）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T08:34:01.437

您真的应该阅读一些有关面向对象编程的知识。

你不把小家伙组织成大家伙做的工作。

中的类保存一些数据并提供以有意义的方式操作该数据的方法。数据通常是其他类的变量，你必须声明你从哪里得到这些。您可以通过指定 import 语句来执行此声明。

顺便说一句，您应该显式创建一个类实例来使用它，即调用类构造函数方法

```
package com.foo;
import com.foo.Bar;

public class StackOverflow {

private Bar myBar;
    public StackOverflow() { //this is a constructor of StackOverflow class
        myBar = new Bar(); //i'm invoking constructor of Bar class
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-21T09:38:39.683

如果您编写的所有类都在同一个包中，您不需要做任何特别的事情来使用它们。如果 A 类想要 B 类的服务，那么在 A 类中你可以只实例化 B 的一个对象并调用你想要的 B 的方法。

但是，如果这些类位于不同的包中，或者如果您使用来自第三方的类，那么您将需要一个 import 语句

```
import package.ClasName; 
```

在您引用该类的文件的顶部。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T05:58:57.520

```
 public class Example {
   public Example(IConverter converter, IScreenFixer screenFixer) {

   }
} 
```

[http://en.wikipedia.org/wiki/Facade_pattern](http://en.wikipedia.org/wiki/Facade_pattern)？

# sql-server - 如何将新的复制表添加到处于合并复制中的 SQL Server 2005 数据库？

> ID：220890
> 
> 赞同：2
> 
> 时间：2008-10-21T05:49:03.047
> 
> 标签：sql-server, replication

我们在分布式环境（办公室之间 50 到 1500 公里）上为大约 350Gb 的 SQL Server 2005 数据库设置了合并复制。我们现在需要添加几个新表，它们也必须在复制中，但不要将新快照推送给所有订阅者。这可能吗？如果可以，最好的方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T14:43:15.653

sp_addmergearticle - 将文章添加到现有的合并发布。此存储过程在发布数据库上的发布服务器上执行。

[http://msdn.microsoft.com/en-us/library/ms174329.aspx](http://msdn.microsoft.com/en-us/library/ms174329.aspx)

# c++ - COM SDK 参考文档应该用什么语法编写？

> ID：220891
> 
> 赞同：0
> 
> 时间：2008-10-21T05:50:29.957
> 
> 标签：c++, c, com, documentation

我有一个用 C++ 编写的 COM SDK，我想为我的产品创建文档。我知道大多数人可能不会使用 C++ 与这个 COM 组件集成，但很多人会。

哪种方法最适合描述 API，而不会丢失 C++ 开发人员需要知道的细节。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T06:26:39.697

您可以使用属性直接在 IDL 中编写文档`helpstring`- 您的代码的大多数使用者将能够使用例如 OLE 视图或在他们的对象浏览器中直接读取此文档。我们公司编写了一个内部工具来提取帮助字符串文档并将其转换为 HTML 格式的内部参考文档。

此外，您可以使用像[doxygen](http://www.doxygen.org/)这样的工具来记录界面 - 它会输出 HTML、PDF、LaTeX 等格式的文档。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T06:36:56.400

IDL 当然是一个参考的好主意。但我想你会想提供代码示例和片段。

这里有一些想法：

*   它暴露了什么样的 COM 接口？IDispatch，自定义，双重？您可能通过猜测您的 SDK 受众是谁以及他们使用什么语言来做出这个决定。

*   你应该只使用一种语言吗？也许您可以提供一些 C++ 示例，一些 VB6 示例，一些 .NET 示例（VB 或 C#）。

*   根据在该语言中使用特定类型参数的难度（或缺乏）为给定示例选择语言。

# c# - 如何在 WpfToolkit 的 DataGrid 中设置 DataGridCell 的模板？

> ID：220898
> 
> 赞同：1
> 
> 时间：2008-10-21T05:54:48.590
> 
> 标签：c#, wpf, datagrid

使用 WpfToolkit 的 DataGrid 时是否可以设置 DataGridCell 的模板？或者是否可以同时为单个单元格设置样式属性？

我知道有一个 TemplateColumn 类可以让用户设置模板来显示和编辑单元格的数据，但这不是我想要的。

我需要使用 DataGrid 显示二维数组，并根据它们的值设置单个单元格的样式。我还想使用 VM-MV 模型并为每个单元格创建 ViewModel 包装器，该包装器将 IsSelected 属性绑定到单元格的 IsSelected 属性，这样我就可以轻松地遍历选定单元格的数据源，而不是使用 DataGrid 更面向行的 API。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-25T22:39:51.837

以下是我发现的几种入门方法：

[如何基于二维数组填充 WPF 网格](https://stackoverflow.com/questions/276808/how-to-populate-a-wpf-grid-based-on-a-2-dimensional-array)

另一种选择如下：

```
<List<string>> tempList = new List<List<string>> {
    new List<string> { "vince", "elizabeth", "brian", "mark" },
    new List<string> { "vince2", "elizabeth2", "brian2", "mark2" },
    new List<string> { "vince3", "elizabeth3", "brian3", "mark3" },
    new List<string> { "vince4", "elizabeth3", "brian3", "mark4" },
};

for(int i=0; i<tempList[0].Count; i++) {
    DataGrid_Standard.Columns.Add(new DataGridTextColumn {
            Header = i,
            DataFieldBinding = new Binding("[" + i + "]")
        });
}
DataGrid_Standard.ItemsSource = tempList; 
```

# python - 从python加载dll

> ID：220902
> 
> 赞同：2
> 
> 时间：2008-10-21T05:57:08.007
> 
> 标签：python, swig, scons, dynamic-linking

我正在从我在[这里找到的一些源代码构建一个 python 应用程序](http://code.google.com/p/enso)

我已经设法通过搜索网络来编译和修复一些问题，但我被困在这一点上：

运行应用程序时会出现此消息。

[替代文字 http://img511.imageshack.us/img511/4481/loadfr0.png](http://img511.imageshack.us/img511/4481/loadfr0.png)

这个 python 应用程序使用 swig 链接到 c/c++ 代码。

我有 VC++2005 速成版，我用它与 scons 和 Python 2.5 一起编译（也尝试过 2.4）

试图加载的 dll 是“msvcr80.dll”，因为在消息是“msvcr80.dll”之前找不到或类似的东西，所以我得到它并将它放在 window32 文件夹中。

对于我在这里读到的内容：http: [//msdn.microsoft.com/en-us/library/ms235591 (VS.80).aspx](http://msdn.microsoft.com/en-us/library/ms235591(VS.80).aspx)

解决方案是使用清单和 dll 文件运行 MT。我已经这样做了，也不起作用。

谁能指出我正确的方向？

这是清单文件的内容：

```
<?xml version='1.0' encoding='UTF-8' standalone='yes'?>
<assembly xmlns='urn:schemas-microsoft-com:asm.v1' manifestVersion='1.0'>
  <dependency>
    <dependentAssembly>
      <assemblyIdentity type='win32' name='Microsoft.VC80.CRT' version='8.0.50608.0' processorArchitecture='x86' publicKeyToken='1fc8b3b9a1e18e3b' />
    </dependentAssembly>
  </dependency>
</assembly> 
```

我现在要尝试 Python 2.6，我不太确定是否理解这个问题，但是 Python 2.5 和 Python 2.5 .exe 在 .exe 文件中有字符串“MSVCR71.dll”。但这可能无关紧要。

附言。如果一切都像 jar 文件一样简单:(

这是完整性的堆栈跟踪

```
None
INFO:root:Skipping provider enso.platform.osx.
INFO:root:Skipping provider enso.platform.linux.
INFO:root:Added provider enso.platform.win32.
Traceback (most recent call last):
  File "scripts\run_enso.py", line 24, in <module>
    enso.run()
  File "C:\oreyes\apps\enso\enso-read-only\enso\__init__.py", line 40, in run
    from enso.events import EventManager
  File "C:\oreyes\apps\enso\enso-read-only\enso\events.py", line 60, in <module>
    from enso import input
  File "C:\oreyes\apps\enso\enso-read-only\enso\input\__init__.py", line 3, in <module>
    _input = enso.providers.getInterface( "input" )
  File "C:\oreyes\apps\enso\enso-read-only\enso\providers.py", line 137, in getInterface
    interface = provider.provideInterface( name )
  File "C:\oreyes\apps\enso\enso-read-only\enso\platform\win32\__init__.py", line 48, in provideInterface
    import enso.platform.win32.input
  File "C:\oreyes\apps\enso\enso-read-only\enso\platform\win32\input\__init__.py", line 3, in <module>
    from InputManager import *
  File "C:\oreyes\apps\enso\enso-read-only\enso\platform\win32\input\InputManager.py", line 7, in <module>
    import _InputManager
ImportError: DLL load failed: Error en una rutina de inicializaci¾n de biblioteca de vÝnculos dinßmicos (DLL). 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T15:18:38.793

查看您的更新，您似乎需要安装[Pycairo](http://www.cairographics.org/pycairo/)，因为您缺少作为 Pycairo 一部分安装的 _cairo 模块。有关如何获取/安装 Windows 二进制文件的说明，请参阅[Pycairo 下载页面。](http://www.cairographics.org/download/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T06:20:16.103

您可能需要安装 VC++ 运行时可再发行组件。他们的链接在[这里](https://stackoverflow.com/questions/99479/visual-cstudio-application-configuration-incorrect#100310)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T07:53:11.377

通过使用 /LD 作为编译器标志，我已经能够编译和运行 Enso。这动态链接到 MS Visual C++ 运行时，并且似乎允许您在没有清单的情况下逃脱。

如果您使用的是 SCons，请在此处查看差异文件：http: [//paste2.org/p/69732](http://paste2.org/p/69732)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T08:50:26.050

**更新** 我已经下载了 python2.6 和 VS C++ express edition 2008 并且 msvcr80.dll 的问题消失了（我假设因为 Python 和 VSC++2008xe 使用 msvscr90.dll）

我已经用 /LD 和这里列出的所有更改进行了编译：http: [//paste2.org/p/69732](http://paste2.org/p/69732)

现在问题如下：

```
INFO:root:Skipping provider enso.platform.osx.
INFO:root:Skipping provider enso.platform.linux.
INFO:root:Added provider enso.platform.win32.
INFO:root:Obtained interface 'input' from provider 'enso.platform.win32'.
Traceback (most recent call last):
  File "scripts\run_enso.py", line 23, in <module>
    enso.run()
  File "C:\oreyes\apps\enso\enso-comunity\enso\__init__.py", line 41, in run
    from enso.quasimode import Quasimode
  File "C:\oreyes\apps\enso\enso-comunity\enso\quasimode\__init__.py", line 62, in <module>
    from enso.quasimode.window import TheQuasimodeWindow
  File "C:\oreyes\apps\enso\enso-comunity\enso\quasimode\window.py", line 65, in <module>
    from enso.quasimode.linewindows import TextWindow
  File "C:\oreyes\apps\enso\enso-comunity\enso\quasimode\linewindows.py", line 44, in <module>
    from enso import cairo
  File "C:\oreyes\apps\enso\enso-comunity\enso\cairo.py", line 3, in <module>
    __cairoImpl = enso.providers.getInterface( "cairo" )
  File "C:\oreyes\apps\enso\enso-comunity\enso\providers.py", line 137, in getInterface
    interface = provider.provideInterface( name )
  File "C:\oreyes\apps\enso\enso-comunity\enso\platform\win32\__init__.py", line 61, in provideInterface
    import enso.platform.win32.cairo
  File "C:\oreyes\apps\enso\enso-comunity\enso\platform\win32\cairo\__init__.py", line 1, in <module>
    from _cairo import *
ImportError: No module named _cairo 
```

# ajax - JSP与ajax聊天

> ID：220906
> 
> 赞同：0
> 
> 时间：2008-10-21T05:59:40.950
> 
> 标签：ajax, jsp, chat

我正在使用 AJAX（一点点）编写一个网络聊天程序。当两个用户都打开聊天页面时它正在工作，但是当一个用户向其他用户发送数据时我想打开一个窗口。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-11-09T16:20:37.553

除非两个用户都打开了一个共同的网页（由您控制​​），否则这是不可能的。但是，为了提供解决方案，让我们同意一些假设：

1.  两位访问者都在您的主页上
2.  其中一位访问者打开一个聊天窗口并输入一条消息。

输入该消息后，您可以使用 AJAX 将消息发送到服务器。在这一点上，最好继续将消息保存到数据库中（这部分只值我两美分）。必须将主页设置为每隔一段时间轮询任何消息，也使用 AJAX（我建议每 30 秒左右，具体取决于此应用程序的目的）。如果收到新消息，则会通过打开聊天窗口 ( `window.open(url)`) 进行响应，然后就可以开始讨论了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-10T15:53:02.360

两个用户都应该打开您的网页。这是基本要求。之后，当两个用户都在页面上处于活动状态时，您可以使用 AJAX 提供一个 servlet，该 servlet 接受用户名并弹出数据，告诉页面是否有该特定用户未读的新消息。如果有新消息，它应该通过 Javascript 自动打开一个窗口并将其带到主聊天页面。这是在许多实时聊天应用程序中完成的，在这些应用程序中，用户在站点上移动时会突然弹出一个窗口并打开一个聊天窗口。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T08:07:14.330

听起来您需要编写一些 javascript 来在收到消息时打开一个新窗口。您如何发送消息 -[反向 Ajax](http://en.wikipedia.org/wiki/Reverse_Ajax)？

大概两个用户都需要打开您的聊天应用程序网页，以便您有地方放置反向 ajax 挂钩代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T08:07:15.873

不能用一些JS代码打开一个新窗口吗？

```
winRef = window.open( URL, name [ , features [, replace ] ] ) 
```

# reverse-proxy - 反向代理

> ID：220907
> 
> 赞同：8
> 
> 时间：2008-10-21T06:00:09.170
> 
> 标签：reverse-proxy

反向代理服务器如何工作？它是用来保护主服务器的吗？它用作防火墙吗？使用代理服务器的原因是什么？有人可以举一个真实世界的例子吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-21T06:08:51.870

通常，普通代理服务器会查看从内部网络到 Internet 的请求并缓存它们，以便如果另一个客户端请求相同的页面，代理可以比对远程服务器的全新请求更快地将其提供给它们。

反向代理以相反的方式工作。

通常，反向代理会安装在 Web 服务器的前面，以便客户端第二次从该服务器请求页面时，代理会将其返回给远程客户端，而不会打扰 Web 服务器。

在许多情况下，反向代理和 Web 服务器是同一台机器。这通常是因为反向代理所做的工作比完成一个完整的 Web 服务器事务要简单得多。

Apache、lighthttpd 和许多其他 Web 服务器也可以充当反向代理。

查看[维基百科](http://en.wikipedia.org/wiki/Reverse_proxy)了解更多信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T06:46:13.103

如果您正在寻找在 .NET 中的实际实现，可以使用[.NET URL Rewriter](http://urlrewriter.sourceforge.net/)，这是一个用于 IIS/ASP.NET 的免费开源组件。

顾名思义，它是一个 URL 重写组件，但它也具有**反向代理功能**。

在配置文件中像这样简单的一行

```
RewriteRule ^(.*) http://www.testsiteXY.com$1 [P] 
```

您可以轻松地将站点分发到内部或外部位置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-08-10T15:38:16.867

“代理服务器是中间或中间服务器，它将来自多个客户端的内容请求转发到 Internet 上的不同服务器。反向代理服务器是一种代理服务器，通常位于专用网络中的防火墙后面，并将客户端请求定向到适当的后端服务器。反向代理提供了额外的抽象和控制级别，以确保客户端和服务器之间的网络流量顺畅流动。”<a href="https://www.nginx.com/resources/glossary/reverse-proxy-server/ " rel="nofollow noreferrer">[见]

“在 HTTP 请求到达您的 Web 服务器之前，您可以在其中检查、转换和路由它们，这会带来很多好处。” [[看]](https://dzone.com/articles/benefits-reverse-proxy)

反向代理服务器的常见用途包括：

*   负载均衡
*   安全
*   集中认证
*   缓存
*   压缩

# c# - 如何在sql server中存储网页内容

> ID：220914
> 
> 赞同：0
> 
> 时间：2008-10-21T06:02:08.357
> 
> 标签：c#, asp.net

一般来说，在相当高的水平上，并且在没有构建整个 CMS 的情况下，我需要知道关于在 sql server 中存储网页内容（例如，数百篇文章和长达约 2500 字的文本）和照片模板网页设计？

我是将实际内容存储在数据库中还是存储在服务器上的文件中，然后将链接放在数据库中？

将一些 asp.net 代码从 db 中显示出来并将其流入基于 css 的布局中会是什么样子？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T06:44:36.727

将内容存储在数据库中是一种公认​​的做事方式。对于您的问题，我能想到的最简单的示例是查看较小博客包的源代码。

*   [http://www.codeplex.com/blogengine/](http://www.codeplex.com/blogengine/)
*   [http://www.codeplex.com/SUB/](http://www.codeplex.com/SUB/)

他们有非常简单的实现，可以在 xhtml 布局中显示 db 内容。

复杂性完全取决于您，在最低级别，您可以使用 ado.net 从数据库中获取文本字段并在您的 aspx 页面中设置文字控件。

或者...再次，在开箱即用的 cms 前面：

*   [http://graffiticms.com/](http://graffiticms.com/)
*   或全力以赴... [http://www.dotnetnuke.com/](http://www.dotnetnuke.com/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T06:11:36.950

可以将网页内容存储在数据库中，许多 CMS 就是这样做的。有很多方法可以实现这一点。

“......没有建立一个完整的CMS”对我来说听起来像是著名的遗言。我建议您查看第三方 CMS。

# php - 我在哪里可以找到免费的、轻量级的 PHP 类 YUI 压缩器？

> ID：220915
> 
> 赞同：0
> 
> 时间：2008-10-21T06:02:53.690
> 
> 标签：php, yui

我在哪里可以找到免费的、轻量级的 PHP 类 YUI 压缩器？

我确信它会减小文件大小，但压缩 PHP 代码会提高其性能吗？

这和混淆器一样吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-21T06:17:41.587

压缩 JavaScript 有好处，因为脚本必须先通过网络发送到客户端，然后才能被解释——文件越小，到达最终用户的速度就越快。PHP 直接在服务器上解释，因此压缩代码不会影响它的运行速度。

如果它是您想要的速度增益，您应该查看一个[PHP 加速器](http://en.wikipedia.org/wiki/PHP_accelerator)，它将缓存您的应用程序的已编译 PHP 字节码。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-21T06:11:59.583

ionCube ( [http://www.ioncube.com/sa_encoder.php](http://www.ioncube.com/sa_encoder.php) ) 有一个名为 PHP Encoder 的产品，它是企业级压缩和混淆器。

PHP Encoder 是一个 PHP 扩展，用于创建和运行编译后的字节码，以提高运行时性能和最大安全性。

它将缩小文件大小，并加快运行时间，因为代码已经部分编译

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-11T21:12:06.877

我还建议使用 PHP 字节码缓存（我们在[APC](http://www.php.net/apc)上）。

但只是为了完整性：PHP 有一个函数[php_strip_whitespace](http://www.php.net/manual/en/function.php-strip-whitespace.php) () 可以删除注释和不必要的空格（或从命令行运行“php -w”）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-21T06:36:24.713

这是一个相当没有意义的练习——对于 JS，你想要压缩，因为你下载了它，但没有下载 PHP 脚本。无论如何，您需要您的代码漂亮且经过注释，并且所有人都需要参与开源社区。如果你不这样做，那么你就是一只正在消亡的恐龙。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-21T06:21:25.277

NuSphere 还发布了用于保护代码和加速代码的[Nu-Coder 。](http://www.nusphere.com/products/nucoder.htm)

# svn - 当您的 ant 构建过程在您的版本控制上出现问题时该怎么办

> ID：220918
> 
> 赞同：2
> 
> 时间：2008-10-21T06:04:29.787
> 
> 标签：svn, ant, jarbundler

所以我有一个不错的 Java 项目，用 Ant 构建到 /dist 文件夹。
整个项目都在版本控制之下，所以我可以通过 dist 文件夹路径上的 'svn export' 部署最新版本。
但是我的构建不断删除我的 dist 文件夹中的 .svn 文件夹及其所有依赖项，因为它在构建时清除了该文件夹，而不是仅仅覆盖。罪魁祸首是 JarBundler，它是构建我的 mac.app 包的 Ant 任务 - 它在重新创建之前删除了整个包的文件夹。
这显然破坏了我的 svn，因为该文件夹现在缺少所有 .svn 文件夹，因此它说它存在冲突。

有人对我如何解决这个问题有任何想法吗？我不知道如何阻止 jarbundler 删除所有内容，所以我将不得不做一些我担心的更骇人听闻的事情。我对 Ant 也很陌生，仅供参考。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T06:17:07.937

***如果您希望您的源代码控制系统成为所有人的唯一参考***，那么在源代码控制中使用 dist*可以*被认为是一种好的做法：

 **   开发商
*   汇编程序（单元测试）
*   认证测试人员（您在集成平台上查询一堆 dist 并在那里执行您的非回归测试、性能测试、压力测试等）
*   生产发布经理...

但是你需要有一个适当的发布过程来完成它。

在您的情况下，**构建**必须位于***单独的私有目录***中，即不在颠覆中的目录。当构建正常时，如果是*正式版本，则将其****导入***subversion，如果是临时构建，则将其导入共享目录，下一个团队需要（从而避免将数百个构建提交到 SCM，无用空间）。

 *注意：在 SCM 中进行交付（dist）的主要优点是允许***依赖***项目不与您的源一起工作，而是直接与您的交付一起工作（这必然会在某个时间点或另一个时间点投入生产）：如果他们管理为了使他们的代码工作，通过与您的交付一起编译，他们自己的 dist 很可能在与您一起部署时可以工作。
这样，其他团队访问您的交付（您的“myProject.jar”）就像他们访问他们的任何资源一样：他们可以通过 SCM 读取您的 jar 的版本、日期、历史、元数据、标签和很快。

然而，对于一个小型单体（如“没有其他项目依赖它”）项目，可以说 dist （最终打包交付）**可以按需重新构建并存储在外部引用系统**中，作为外部例如 Maven 存储库。
但是：Maven 不是 SCM 存储库，这意味着您需要签署您的 jar（'MyProject-1.0.jar'），您没有历史记录，并且您需要在交付时在单独的文本文件中报告所有元数据。在该 Maven 存储库中访问该交付的任何其他项目都需要根据您的版本命名约定调整其脚本和类路径。
另外，Maven 是您开发架构中的另一个存储库。只要您可以将存储库的数量保持在最低限度（'1' ;)），那就更好了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T06:06:24.137

简单的。不要将 /dist 签入到版本控制中。

版本控制真的不应该有任何生成的代码/二进制文件/jars/what-have-you。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T06:09:39.993

可能我在这里遗漏了一些东西，但是为什么您将构建的产品检查到您的*源代码控制*系统中？一般来说，这不被认为是好的做法。

如果您确实想签入构建产品，请将它们复制到其他地方（可能是一个名为“pre-built”的目录），然后从那里签入。

编辑添加：您不需要这样做的原因是，给定当前源，您应该能够使用单个构建命令重新创建分发。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T22:54:13.353

好的，谢谢大家。我现在明白了为什么从哲学上讲，将构建保持在 SCM 之外是一个好主意，并将在未来牢记这一点。然而，实际上，在这种情况下，我是这个短暂（4 周）项目的唯一开发人员。我正在使用 svn通过低速连接*轻松更新公共网络服务器上的发布版本，因此差异更新是必不可少的。*由于没有人提出更新远程部署构建的简单替代方案，因此我想出了这个 hacky hack 来避免我的问题：

假设我的版本化构建文件夹是 /dist。好吧，我告诉我的构建脚本构建到 /dist-tmp，然后递归地将 /dist-tmp 中的所有文件复制到 /dist 的顶部，最后删除 /dist-tmp。

这是我的 Ant 构建脚本中的一些额外行，并且效果很好。

不过，下一次，请确保部署主机不是 windows，然后一个简单的 rsync 脚本就可以解决问题，然后我可以将构建留在 SCM 之外。

@VonC 得到了最佳哲学解释的答案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-14T11:08:45.573

我同意将内置产品放入 SVN 不是很好的做法。

话虽如此，如果您有一些无法解决的要求，您可以使用更现代的版本控制系统之一，例如 Git、Bazaar 和 Darcs（还有其他的，但我使用了这三个）。

所有这三个都只将版本控制元数据放在根目录中，所以子文件夹中没有元数据，所以我认为你不会有这个问题......

# asp.net - ajax控制工具包哪个版本？

> ID：220919
> 
> 赞同：0
> 
> 时间：2008-10-21T06:05:03.077
> 
> 标签：asp.net, ajaxcontroltoolkit

如果我使用面向 ASP.NET 2.0 的 Visual Studio 2008，那么我应该使用哪个版本的 Ajax Control Toolkit？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T06:17:12.990

版本 11119 似乎是针对 .net 2.0 的工具包的最新版本。你可以在这里找到它：

[http://www.codeplex.com/AjaxControlToolkit/Release/ProjectReleases.aspx?ReleaseId=8513](http://www.codeplex.com/AjaxControlToolkit/Release/ProjectReleases.aspx?ReleaseId=8513)

如果您使用的是 Visual Studio 2008，那么 AJAX VS 2008 模板以及已经提到的 ASP.Net Ajax Extensions V1.0 可能会很方便。这些模板提供了一个 Visual Studio 项目，该项目自动设置 web.config，并为您提供了一个模板“default.aspx”，其中 AJAX 已准备就绪。

[http://www.asp.net/AJAX/downloads/](http://www.asp.net/AJAX/downloads/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T06:09:03.053

您需要 Toolkit 版本[1.0.20229.20821](http://www.codeplex.com/AjaxControlToolkit/Release/ProjectReleases.aspx?ReleaseId=11121)，*AjaxControlToolkit.zip* dll 的目标是 .NET 2.0 ，您还需要 [ASP.NET AJAX Extensions 1.0 for .NET 2.0](http://www.microsoft.com/downloads/details.aspx?FamilyID=ca9d90fa-e8c9-42e3-aa19-08e2c027f5d6&displaylang=en)。

# language-features - Greenspunning：您对一门语言所做的最令人印象深刻的扩展以及是否值得

> ID：220935
> 
> 赞同：2
> 
> 时间：2008-10-21T06:10:03.973
> 
> 标签：language-features, greenspunning

[绿纺](http://en.wikipedia.org/wiki/Greenspun%27s_Tenth_Rule)。我们都有机会破解一种语言缺失的特性来获得我们需要的东西。在 Java 中实现伪单子模式，在 Javascript 中实现 Y 组合器，在 C 中实现变量不变性......

您认为寻找更强大功能的最令人印象深刻的解决方法是什么？事后看来，这值得黑客攻击吗？更好的是：它是否像 Ruby 的[string#to_proc](http://weblog.raganwald.com/2007/10/stringtoproc.html)一样，成为该语言更高版本的公认特性？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T09:02:32.267

[Moose](http://moose.perl.org/)是 Perl 5 的 Perl 6 风格的对象系统，它写在 Perl 5 的 Python 风格的对象系统之上；反过来，它催生了[Joose](http://code.google.com/p/joose-js/)，这是 Moose 到 Javascript 的一个端口，获得了 Google 的大量赞誉（显然，主要是 App Engine 人员）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T06:22:48.207

回到我上高中的时候（*很多*个月前），我编写了代码来拦截 Apple II CTRL-D DOS 处理程序，你使用的那个是：

```
print chr$(4);"catalog" 
```

做你的 DOS 魔法。

我们添加了各种命令，例如向图形屏幕输出文本、快速图形操作、精灵操作、背景音乐播放等。

几个月后，Beagle Bros Software（我认为这是他们记忆中的名字）推出了类似的产品，我的梦想破灭了。

谁知道呢，我可能会成为下一个 Woz（如果我有一个同等的乔布斯来做营销）。哦，好吧，c'est la vie。

它值得吗？是的，Apple II 首先激起了我对计算机的兴趣，并让我选择了一条让我在超过 25 年的时间里获得报酬（和快乐）的职业道路。

# web-services - 网络服务示例

> ID：220958
> 
> 赞同：2
> 
> 时间：2008-10-21T06:22:45.477
> 
> 标签：web-services

谁能指出 SOAP 或 REST Web 服务的实时示例？您如何通过客户端使用或测试现有的 Web 服务？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-21T06:28:58.130

一个将摄氏温度转换为华氏温度和其他方式的 SOAP 网络服务[http://www.w3schools.com/webservices/tempconvert.asmx](http://www.w3schools.com/webservices/tempconvert.asmx)

描述和源代码在这里[http://www.w3schools.com/webservices/ws_example.asp](http://www.w3schools.com/webservices/ws_example.asp)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T06:29:30.890

这是很好的示例 Web 服务集合。我通常将它们用于实验[http://www.webservicex.net/](http://www.webservicex.net/)

对于 WS 调试 - 我使用 VS 生成包装器并编写单元测试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-04-21T06:37:23.833

你可以试试这个，很好

[http://www.eclipse.org/webtools/community/tutorials/BottomUpAxis2WebService/bu_tutorial.html](http://www.eclipse.org/webtools/community/tutorials/BottomUpAxis2WebService/bu_tutorial.html)

# sql-server - SQL Server 2005 中的 CLR UDF 异常

> ID：220964
> 
> 赞同：2
> 
> 时间：2008-10-21T06:28:21.173
> 
> 标签：sql-server, sql-server-2005, tsql, user-defined-functions, sqlclr

当我尝试我的 CLR UDF 时，我收到了这个错误：

消息 6522，第 16 级，状态 1，第 1 行

执行用户定义的例程或聚合“getFileSize”期间发生 .NET Framework 错误：

System.Security.SecurityException：请求“System.Security.Permissions.FileIOPermission，mscorlib，版本=2.0.0.0，文化=中性，PublicKeyToken=b77a5c561934e089”类型的权限失败。

System.Security.SecurityException：

在 System.Security.CodeAccessSecurityEngine.Check（对象需求，StackCrawlMark& stackMark，布尔 isPermSet）

在 System.Security.CodeAccessPermission.Demand()

在 System.IO.DirectoryInfo..ctor（字符串路径）

在 GetFileInfo.ShowDirectoryName.DirSize（SqlString 目录）。

关于如何解决这个问题的任何想法？我试图在 BOL 中度过一段时间，但我现在真的背对着墙……

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T07:12:13.660

SQLCLR 使用代码访问安全性对您的程序集可以执行的操作施加了某些限制。

阅读 SQL 中的各种权限集：

[http://www.devx.com/codemag/Article/31193/0/page/4](http://www.devx.com/codemag/Article/31193/0/page/4)

# excel - 在 Excel 中查找数据

> ID：220966
> 
> 赞同：1
> 
> 时间：2008-10-21T06:28:40.860
> 
> 标签：excel, lookup

我在 excel 中有一个 2 变量 100x100 数据表。

我需要一个函数来返回产生给定目标值的所有可能变量集。我正在看的是某种递归二维查找函数。有人可以指出我正确的方向吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T10:52:54.667

没有内置功能可以满足您的需求，我对此有 99% 的把握。

可以构建一个返回数组的 VBA 函数，沿着已经显示的快速和肮脏的 Sub 的行。创建一个 Variant 来保存输出，可能 Redimed 到最大可能的结果数量，Redim Preserve-d 到最后的实际数量。然后将其作为函数的结果返回，然后需要将其作为数组函数（Control-Shift-Enter）调用。

一个缺点是您必须确保目标范围足够大以容纳整个结果：Excel 不会自动执行此操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T13:08:54.593

它可以在没有 VBA 的情况下完成，相当紧凑，就像这样。

假设您的 100x100 表在 B2:CW101 中，我们将数字列表从 A2 到 A101 的左侧从 1 到 100 放在从 B1 到 CW1 的顶部的 1 到 100 的列表中

在下面创建一列单元格，从（比如）B104 开始

```
 B104=MAX(($A$2:$A$101*100+$B$1:$CW$1<B103)*($B$2:$CW$101=TargetValue)*($A$2:$A$101*100+$B$1:$CW$1)) 
```

这是一个“数组”公式，因此请按`Ctrl`- `Shift`-`Enter`而不是`Enter`，并且大括号 {} 应该出现在公式周围。

然后根据需要复制尽可能多的行。您还需要在您的第一个公式上方放置一个较大的数字，即在 B103 中，例如 999999。

公式的作用是计算Rowx100+Column，但只针对每个成功的单元格，MAX函数查找最大的结果，排除之前找到的所有结果，即一次找到一个目标结果，从右下角开始工作到左上角。（只需稍加努力，您就可以让它以另一种方式搜索）。

这将为您提供类似 9922 的结果，即第 99 行第 22 列，您可以轻松地从数字中提取这些值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T08:33:02.233

求解器适合吗？

[http://office.microsoft.com/en-us/excel/HA011118641033.aspx](http://office.microsoft.com/en-us/excel/HA011118641033.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T10:27:46.947

我在不使用 VBA 的情况下尝试了很多，但没有它似乎是不可能的。为了解决这个问题，我需要遍历整个数组并找到最接近的值。然后使用调用和范围属性取消引用这些值，并在每次有效匹配时递增的范围内生成输出。

快速而肮脏的实现如下：

```
Dim arr As Range
Dim tempval As Range
Dim op As Integer

Set arr = Worksheets("sheet1").Range("b2:ao41")
op = 1
Range("B53:D153").ClearContents

For Each tempval In arr
If Round(tempval.Value, 0) = Round(Range("b50").Value, 0) Then

Range("b52").Offset(op, 0).Value = Range("a" & tempval.Row).Value
Range("b52").Offset(op, 1).Value = Cells(tempval.Column, 1).Value
Range("b52").Offset(op, 2).Value = tempval.Value
op = op + 1

End If

Next
Range("b50").Select 
```

我仍在寻找一种没有 VBA 的方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T12:40:15.963

我有一个不使用 VBA 的解决方案，但它相当混乱。它涉及在 Excel 中创建另一个一维表并对其进行查找。对于 100x100 的数据表，新表需要 10,000 行。

抱歉，如果这不符合您的需求。

总结如下 - 如果您需要更多详细信息，请告诉我。N = 数据的维度，例如在您的示例中为 100。

首先，创建一个包含五列和 NxN 行的新表。在每种情况下，将我的列名替换为适当的 Excel 参考

第一列（称为 INDEX）仅列出 1、2...NxN。

第二列 (DATAROW) 包含一个循环遍历 1, 2... N, 1, 2...N... 的公式，这可以使用类似 =MOD(INDEX-1, N)+1 的方法来完成

第三列 (DATACOL) 包含 1, 1, 1... 2, 2, 2... （每个 N 次）。这可以通过 =INT((INDEX-1)/N)+1 来完成

第四列 (VALUE) 包含数据表中的值，使用类似：=OFFSET($A$1, DATAROW, DATACOL)，假设您的数据表从 $A$1 开始

我们现在有一个包含所有数据的一维表。

第五列 (LOOKUP) 包含公式：=MATCH(target, OFFSET(VALUERANGE, [LOOKUP-1], 0),0)+ [LOOKUP-1]

其中 [LOOKUP-1] 指的是紧邻上方的单元格（例如，在单元格 F4 中，这指的是 F3）。在 LOOKUP 列的第一个单元格上方需要一个 0。

VALUERANGE 应该是对整个 VALUE 列的固定（命名或使用 $ 符号）引用。

然后 LOOKUP 列保存 INDEX 编号，可用于查找 DATAROW 和 DATACOL 以查找数据中匹配项的位置。

这通过在 VALUERANGE 中搜索匹配项，然后在前一个匹配项之后开始在调整后的范围内搜索匹配项来实现。

在电子表格中比通过上面的解释要容易得多，但这是我目前能做的最好的......

# c# - 如何为访问密钥添加下划线?

> ID：220975
> 
> 赞同：6
> 
> 时间：2008-10-21T06:36:24.090
> 
> 标签：c#, .net, asp.net

如何为访问密钥的第一个字母添加下划线？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-21T07:05:31.490

asp:buttons 输出为带有“提交”类型的 html“输入”标签。它们上显示的文本是在标签的“值”属性中输出的，因此不能包含任何样式或 html。如果您可以将 asp:button 输出为 html 按钮，那么您可以尝试以下操作：

```
<button id="mybutton" runat="server" onserverclick="myfunction">
<span style="text-decoration:underline;">P</span>rint</button> 
```

并在您的 c# 代码中使用普通按钮事件：

```
protected void myfunction(object sender, EventArgs e)
{
    Response.Write("clicked");
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T06:43:22.063

尝试了 AccessKey 属性？

```
<asp:button id="Button1" runat="server" Text="Print" AccessKey="P" /> 
```

如果它真的是下划线是你无法控制的。用户代理（例如浏览器）正在决定。

# c# - 使用 WCF 连接到实体

> ID：220982
> 
> 赞同：5
> 
> 时间：2008-10-21T06:42:23.907
> 
> 标签：c#, asp.net, linq, wcf, linq-to-entities

我的 edmx 文件中有一个单独的项目中的所有实体，我使用 WCF 服务将它们公开给我的客户端应用程序。

这意味着我不必为我的客户端应用程序提供指向包含 edmx 文件的项目的直接链接。那会很糟糕，因为它会延续对象来查询数据库。

但只有我的 WCF 服务使用的实体可以从我的客户端应用程序访问。例如，因为我的服务中有以下代码：

```
public MyClass GetMyClass()
{
     return new MyClass();
} 
```

..我可以在我的客户端应用程序中使用访问 MyClass ，例如：

```
myServiceInstance.MyClass cls = new  myServiceInstance.MyClass() 
```

如果我的 edmx 文件中有一个名为 MyClass2 的实体，我想在我的客户端应用程序中使用它，那该怎么办！如何在不给我的客户直接链接到我的 edmx 文件项目或在我的服务层中创建一个返回 MyClass2 的无用方法的情况下实例化它

其他人在做什么？

非常感谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T07:49:15.240

我们使用域传输对象类创建了一个**单独的项目**，作为我们各种**内部**WCF 服务的数据契约。然后，我们与这些内部服务共享合同项目。我们有一项数据服务；这些方法将在存储/检索之前/之后将这些域对象转换为实体对象/从实体对象转换。同时，外部服务使用从 XSD 和 WSDL 文件生成的标准代理，并与共享域传输模型进行转换。

不幸的是，我们不得不这样做，因为**对象上下文（还）不能通过 WCF 移植。**

针对您的情况的一些注意事项：

1.  如果您的客户端应用程序在您的系统**外部**，它不应该知道任何关于您的 EDMX 或其类的信息。它应该只知道您的 WSDL 和 XSD。
2.  如果您的客户端应用程序是**internal**，那么尝试在 EF v1 中共享实体类是没有用的，因为它还没有得到适当的支持。您需要传输的不仅仅是类/对象 - 您还需要上下文，它维护更改跟踪，现在不能直接通过 WCF 完成。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T06:46:16.397

如果 WCF 服务不使用它，你想要它做什么？WCF 服务（本身）纯粹用于数据传输 - 元数据的“mex”方法不共享代码，因此您的 MyClass2 将无能为力。如果你愿意，你可以在客户端使用程序集共享，但在这种情况下我*真的*不推荐这样做；客户端的 EF 对象是一团糟……（此外，它不适用于 Silverlight、Client Profile、Compact Framework 等轻量级框架）

另一种选择是[ADO.NET 数据服务](http://msdn.microsoft.com/en-us/data/bb931106.aspx)；这适用于 WCF，但为您提供比常规 WCF 方法更适合 LINQ 的 API - 并且您的模型公开的任何域对象都应该在客户端数据上下文中可用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T12:46:25.733

如果您想以“正确”的方式进行操作，您应该为通过网络传输的消息创建特殊类，而不是尝试将业务实体或数据对象作为消息重用。这样做的价值在于，您可以自由地更改您的业务实体和数据对象，而不必担心您向消费者公开的合同会发生变化。对服务的每一次更改都需要经过深思熟虑，因为它独立于数据和业务逻辑的更改而发生。

处理此问题的另一种方法是简单地使用 svcutil（或“添加服务引用...”，尽管 svcutil 对多个服务端点工作得更好）来生成客户端将使用的所有类，而不是添加对服务器项目的引用。这样，您的客户将看到的唯一类是服务公开的类。

# eclipse - 凯恩戈姆代码生成器

> ID：220988
> 
> 赞同：0
> 
> 时间：2008-10-21T06:45:16.553
> 
> 标签：eclipse, plugins, generator, cairngorm

我想知道是否有可以作为插件安装在 Eclipse 中的 Cairngorm 代码生成器？没有像 WebORB 那样的代码生成器，FluorineFX 可以检查数据库并生成大量代码。我只想要一个 Eclipse 插件，我可以在其中提供一些选项和属性。然后插件生成适当的事件、命令和委托。例如，如果委托已经存在，则必须将新的远程调用附加到委托。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T20:05:24.830

adobe开源网站上有一个基本的eclipse插件

[http://opensource.adobe.com/wiki/display/cairngorm/Plugin](http://opensource.adobe.com/wiki/display/cairngorm/Plugin)*******************************