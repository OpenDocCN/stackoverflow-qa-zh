# StackOverflow 问答 000691000-000691999

# excel - 从 Excel VBA 的 MS Access 表单中获取价值

> ID：691003
> 
> 赞同：1
> 
> 时间：2009-03-27T18:41:01.707
> 
> 标签：excel, ms-access, vba

最好的检查方法是打开访问表单并使用 Excel VBA 获取文本框的值。

我的意思是有没有办法检查 MS Access 应用程序是否正在运行，如果是，则检查某个表单是否打开，然后从该表单的文本框字段中获取值。

就像是

```
 If MSAccess.([Application name]).Forms("FormName").isOpen then
     MyVar = MSAccess.([Application name]).Forms("FormName")![PO Number]
  end if 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T21:12:14.217

这是一些示例代码。

```
Public Declare Function FindWindow Lib "user32" Alias "FindWindowA" _
    (ByVal lpClassName As String, ByVal lpWindowName As String) As Long
Public Declare Function ShowWindow Lib "user32" _
    (ByVal hWnd As Long, ByVal nCmdShow As Long) As Long

Public Const SW_SHOW = 5
Public Const GW_HWNDNEXT = 2

Sub FindAccess()
Dim WinHandle As Long
Dim objAc As Object

'Form title'
FindWindow vbNullString, "Images"

'use it'
ShowWindow WinHandle, SW_SHOW

'to get the application'
Set objAc = GetObject(, "Access.Application")

'and print a control's value'
Debug.Print objAc.Forms("frmImages").Controls("Description")

Set objAc = Nothing
End Sub 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-09-22T03:13:36.153

如果表单未打开，@Remou 的 Debug.Print 将出错。

大多数 Access 开发人员将 IsLoaded() 函数导入他们的数据库并使用它。我的版本中的代码（可能会或可能不会从原始 MS 版本编辑）是这样的：

```
 Function IsLoaded(ByVal strFormName As String) As Boolean
   ' Returns True if the specified form is open in Form view or Datasheet view.
    Const conObjStateClosed = 0
    Const conDesignView = 0

    If SysCmd(acSysCmdGetObjectState, acForm, strFormName) <> conObjStateClosed Then
       If Forms(strFormName).CurrentView <> conDesignView Then
          IsLoaded = True
       End If
    End If
  End Function 
```

要从 Excel 中使用它，您可以这样重写它：

```
 Function IsLoaded(ByVal strFormName As String, objAccess As Object) As Boolean
   ' Returns True if the specified form is open in Form view or Datasheet view.
    Const conObjStateClosed = 0
    Const conDesignView = 0
    Const acSysCmdGetObjectState = 10
    Const acForm = 2

    If objAccess.SysCmd(acSysCmdGetObjectState, acForm, strFormName) <> conObjStateClosed Then
       If objAccess.Forms(strFormName).CurrentView <> conDesignView Then
          IsLoaded = True
       End If
    End If
  End Function 
```

（我没有从 Excel 测试，但你明白了）

# .net - 如何为系统存储过程生成实体框架或 Linq To SQL 包装器？

> ID：691004
> 
> 赞同：0
> 
> 时间：2009-03-27T18:41:10.927
> 
> 标签：.net, sql-server, linq-to-sql, entity-framework

我希望能够通过生成的 Linq-To-SQL 或实体框架包装器使用系统存储过程（sp_helpXXX 等）。问题是，生成向导中没有列出系统存储过程。我也尝试过手动运行 sqlmetal.exe，但没有出现系统存储过程。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-27T21:11:30.363

不知道有没有自动的方式，但是在linq2sql中可以在数据上下文的部分类上手动定义存储过程和函数。

这是我用于 sql 的 GetDate 函数（我可以在 linq 查询表达式中使用）的函数：

```
[Function(Name = "GetDate", IsComposable = true)]
public DateTime GetSystemDate()
{
    MethodInfo mi = MethodBase.GetCurrentMethod() as MethodInfo;
    return (DateTime)this.ExecuteMethodCall(this, mi, new object[] { }).ReturnValue;
} 
```

同样的原则也适用于存储过程（通过设计器添加一个常规的存储过程，并在生成的代码中检查出来）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-06-30T05:41:39.680

这是一个详尽的文章，介绍了实体框架的基础知识。添加存储过程绝对不是简单的，但如果您在 nHibernate 中尝试过，这似乎是一件轻而易举的事。[http://msdn.microsoft.com/en-us/data/gg699321.aspx](http://msdn.microsoft.com/en-us/data/gg699321.aspx)

# java - Java中的包装器工厂

> ID：691006
> 
> 赞同：0
> 
> 时间：2009-03-27T18:41:30.943
> 
> 标签：java, design-patterns, generics, collections, type-erasure

我可能已经将自己设计成解决这个问题的一个角落，但我觉得有一个可行的已知解决方案来解决我没有看到的类似问题。很可能是我完全把问题复杂化了，跳过了明显的解决方案。任何建议将不胜感激。

我有一组定义为接口的实体。每个都有一个具体的实现和一个包装器实现。例如：

```
-- Foo.java
public interface Foo {
    public String getName();
}

-- FooImpl.java
public class FooImpl implements Foo {
    private String name;

    public String getName() {
        return name;
    }
}

-- AbstractWrapper.java
public class AbstractWrapper {
     protected String decorate(String text) {
         return "** " + text + " **";
     }

-- FooWrapper.java
public class FooWrapper extends AbstractWrapper implements Foo {
    private Foo wrappedFoo;

    public FooWrapper(Foo wrappedFoo) {
         this.wrappedFoo = wrappedFoo;
    }

    public String getName() {
         return decorate(wrappedFoo.getName());
    }
} 
```

现在，使情况复杂化的部分是我正在尝试创建一个 List ，它在添加之前自动使用适当的包装器包装适当的类型。就像是：

```
-- WrappingList.java

/** T is the base entity interface type. */
public class WrappingList<T> implements List<T> {
    private List<T> wrappedList;

    public WrappingList(List<T> wrappedList) {
        this.wrappedList = wrappedList;
    }

    ....

    public boolean add(T item) {
        return wrappedList.add(wrapItem(item));
    }

    protected T wrapItem(T item) {
         T wrappedItem = .....;
         return T;
    }
} 
```

我能做些什么来在这里制作一个有点干净的工厂方法吗？还是因为类型擦除，我现在已经不走运了？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T18:51:21.637

我认为您应该将 WrapperFactory 添加到 WrappingList，并在构造函数中提供实际的工厂实现。就像是：

```
-- WrapperFactory.java
public class WrapperFactory<T> {

   public T wrap(T item);

}

-- WrappingList.java
/**
 * A self-wrapping list.
 *
 * @param T the stored, wrapped item type
 */
public class WrappingList<T> implements List<T> {
    private List<T> wrappedList;
    private WrapperFactory<T> wrapper;

    public WrappingList(List<T> wrappedList, WrapperFactory<T> wrapper) {
        this.wrappedList = wrappedList;
        this.wrapper = wrapper;
    }

    ....

    public boolean add(T item) {
        return wrappedList.add(wrapper.wrap(item));
    }

} 
```

基本问题是擦除不会让您在实际代码中了解有关 T 的任何信息，因此除非您将某些内容传递到您的列表中，知道您正在使用的特定 T （例如如何包装它），否则您将无法做任何事。而且它不是把你设计在一个角落里；）它只是 Java 泛型的一个常见限制。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T19:18:51.883

是的，我也遇到过这种情况。我已经得出结论，实体不应该被包装在接口中。一个实体 - 一个可变值 bean - 不是服务，包装它只会导致无尽的悲伤。

接口意味着每个名义上返回 bean 列表的方法 - 一个非常常见的事情 - 都必须声明为返回`List<? extends BeanInterface>`，并且您必须提供其工作是在这些列表中创建新元素的方法（您不能只放一个豆在那里）。痛在谚语中。

当实体确实实现了某些实体之间共享的一些通用模式时，请谨慎使用接口。

# c# - 考虑更新时的 .NET 解决方案设置建议

> ID：691011
> 
> 赞同：1
> 
> 时间：2009-03-27T18:42:59.830
> 
> 标签：c#, .net, winforms

我编写了一个作为 setup/msi 安装部署的 winforms 应用程序。不使用 ClickOnce 部署的主要原因是：

1.  需要在应用目录中持久化数据存储
2.  需要能够为“所有用户”安装

目前，该应用程序使用“一个 .exe 来统治它们”。本质上，安装后的“程序文件”目录有 .exe、.ico 和 .config 文件。

我正在尝试遵循 MSDN 上的此建议/教程，以便我可以拥有更新机制：http: [//msdn.microsoft.com/en-us/library/aa367564.aspx](http://msdn.microsoft.com/en-us/library/aa367564.aspx)

我的印象是拥有一个 .exe 不一定是最好的方法。我想知道在创建 .dll 库与将我的应用程序类放入项目中的 .cs 文件时是否有“经验法则”？

更新可以像替换一些 .dll 文件而不是 .exe 一样简单吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-01T18:24:41.707

总的来说，我同意 The Great White North 给出的答案，重申一下：

1.  有充分的理由将任何重要规模/功能的应用程序分解为单独的项目/组件。
2.  只需将程序集复制到应用程序的目录中即可安装/更新 .NET 应用程序（假设程序集彼此兼容）。

我对您的另一个强烈建议是，您不要在 Windows Installer 安装程序包（即 VS 部署项目产生的内容）和所谓的“xcopy 部署”（即在需要的地方复制程序集）之间混搭。如果您“xcopy”更新由 Windows Installer 程序包安装的文件，Windows Installer 可能会尝试为您“修复”它。

据说可以创建 Windows 安装程序“补丁”，它只包含/更新更改的文件，但我从来没有充分的理由尝试让它工作。无论如何，我相当肯定这超出了 VS 部署项目的能力。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-28T02:38:42.137

一般来说，我遵循的“经验法则”是将解决方案分解为基于功能的项目。这有助于测试等。

在更新方面，从[MSDN 上这篇文章](http://msdn.microsoft.com/en-us/library/ms973843.aspx)的“应用程序私有程序集”部分看来，是的，您可以将应用程序的新 dll 放入其文件夹中，然后就这样“更新”它。

# jquery - 记住上次打开状态

> ID：691013
> 
> 赞同：2
> 
> 时间：2009-03-27T18:43:15.697
> 
> 标签：jquery

在网站[http://www.ryancoughlin.com/hp/?c=posters](http://www.ryancoughlin.com/hp/?c=posters)上，我在左侧使用此代码：

```
$(".menu-header").click(function() {
        $(this).next().toggle('slow');
        return false;
}).next().hide(); 
```

如果您打开其中一个并点击另一个部分，它会关闭，有没有办法保持该状态打开？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T18:46:54.830

您的部分保持其打开状态正常，但当您打开*新*页面时它们会关闭。

但是，您的问题并没有消除这两个问题之间的歧义。

为了使它在这些页面上工作，您可能想做的是注入一个变量来确定您在哪个页面上。

```
 jQuery(function($){ 
     var matches;
     if( matches = (new String(document.location)).match(/\?c=\w+/) ) {  
        $("a[href=" + matches[0] + "]").parents("ul").toggle(); 
     }
   }); 
```

不过，可以作为一种短期解决方案。

所以完整的代码将是（注释）

```
/* Document Ready, $ = jQuery inside this scope regardless  */

jQuery(function($){  

  /* Bind the click event on all the menus, then hide them all. */

  $(".menu-header").click(function() {
            $(this).next().toggle('slow');
            return false;
  }).next().hide();
  /*
   * Check to see if we're already on a sub-menu-item
   * By looking in the current pages url for the string '?c=somewordhere'
   */
  var matches;
  if( matches = (new String(document.location)).match(/\?c=\w+/) ) {  
    /*
     * If we are, search the page for a link to that submenu item
     * ( by looking for the '?c=somewordhere' part in the hrefs ) 
     * and find its parent menu `ul` and show it.
     */
    $("a[href=" + matches[0] + "]").parents("ul").toggle(); 
  }

}); # End Document Ready Scoping. 
```

为了清楚起见，

```
jQuery(function($){ 

}); 
```

是一种非常方便的速记符号，非常强大。相当于做

```
jQuery(document).ready(function($){ 

}); 
```

这反过来几乎相当于做

```
jQuery(document).ready(function(){ 
     var $ = jQuery; 
}); 
```

它以故障安全的方式保证“$”将是此函数中的 jQuery，而不管页面上的其他所有内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-29T17:17:56.883

I suggest using [reallysimplehistory](http://code.google.com/p/reallysimplehistory/). It allows you to save state between page calls transparently (no need to mess with cookies, URL's, etc.)

You could also use Ajax for your site, but if you want the back button to work, you'd use something like RSH anyway. =]

# c++ - 如何在基于派生类的大小的基础构造函数中分配数组？

> ID：691014
> 
> 赞同：5
> 
> 时间：2009-03-27T18:44:09.500
> 
> 标签：c++, inheritance, static, constructor

我有一个层次结构。基类使用一些可从文件加载（并在运行时可重新加载）的调整参数。每个派生类都可以添加一些额外的参数。我正在寻找一种在基本构造函数中分配正确大小的参数数组的方法，这样我就不必在派生类中重新分配和重新分配。我希望有这样的东西，但它不起作用（参数总是有 2 个元素）：

```
 class Base
   { static int nParms;
     virtual int getNParms() { return nParms;}
     float *parameters;
   public:
     Base() 
     { parameters= new float[this->getNParms()];
       parameters[0] = globalReloadableX;
       parameters[1] = globalReloadableY;
     }
   };
   int Base::nParams =2;

   class Derived : public Base
   { static int nParms;
     virtual int getNParms() { return nParms;}
   public:
     Derived() : Base()
     { parameters[2] = globalReloadableZ;
     }
   }
   int Derived::nParams =3; 
```

我已经看到[了这个问题](https://stackoverflow.com/questions/594730/overriding-static-variables-when-subclassing)，但是那里的解决方案对我来说不太适用。我还尝试在每个类中将参数设为常规数组：

```
 class Base
  {  float parameters[2]
    ...
  class Derived : public Base
  {  float parameters[3]
    ... 
```

但这使得 Derived 有 2 个单独的数组。

有任何想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T18:49:10.423

为什么不在基类的构造函数中传递所需的数组大小作为参数呢？

（虚函数不调用派生类的原因是因为这就是 C++ 虚函数的工作方式；从概念上讲，在派生类构造函数完成之前，对象的类型仍然是基类。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T18:52:10.713

将大小作为参数怎么样？

```
class Base
{ static int nParms;
  virtual int getNParms() { return nParms;}
  float *parameters;
public:
  Base(int n = nParams) 
  { parameters= new float[n];
    parameters[0] = globalRelodableX;
    parameters[1] = globalRelodableY;
  }
};
int Base::nParams =2;

class Derived : public Base
{ static int nParms;
  virtual int getNParms() { return nParms;}
public:
  Derived() : Base(nParams)
  { parameters[2] = globalRelodableZ;
  }
}
int Derived::nParams =3; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-27T19:00:23.267

为什么要使用数组？std::vector 将允许您在派生类中根据需要使用尽可能多的参数，而基类不知道（或关心）它需要多少。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-27T22:10:28.380

您可以按照其他人的建议将其作为构造函数的参数，但您也可以将 Base 设为模板类，并将大小作为参数。这有很多优点，例如无需在堆上分配数组：

```
template <size_t nParams>
class Base
{
    float parameters[nParams];
public:
    Base()
    { // could use a static_assert(nParams > 1) here...
      parameters[0] = globalRelodableX;
      parameters[1] = globalRelodableY;
    }
};

class Derived : public Base<3>  // or whatever
{
public:
    Derived()
    { parameters[2] = globalRelodableZ; }
}; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-27T21:46:46.783

我会考虑使用 std::map。它可以随基数和派生数一起增长，而不关心其他使用的参数数量。键/值对可能更容易管理数字索引，尽管这显然取决于应用程序。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-27T22:02:03.613

我喜欢 Earwicker 和 Steve 的答案，这取决于需要什么。如果频繁地创建和销毁这些对象中的许多，那么您需要尽可能少的内存分配，因此 Earwicker 的效果更好。但是，如果这是通常“创建并且很少重新制作”的东西，那么我会选择史蒂夫的回答，因为地图通常更容易使用，并且可以根据需要动态增长，但如果这个对象是被制造和摧毁的东西很多。

# sql-server-2008 - 在 SQL Server 镜像方案中设置见证时出现错误

> ID：691017
> 
> 赞同：2
> 
> 时间：2009-03-27T18:44:19.483
> 
> 标签：sql-server-2008, certificate, sql-server-2005-express, mirroring

我有三个不属于任何域且不使用 AD 的 Windows 服务器（data1、data2 和 datawitness）。[我正在尝试根据http://alan328.com/SQL2005_Database_Mirroring_Tutorial.aspx](http://alan328.com/SQL2005_Database_Mirroring_Tutorial.aspx)上的说明设置镜像。在我告诉 data1 使用 datawitness 作为见证服务器的最后一组指令之前，我已经取得了成功。该步骤失败并显示以下消息：

> 更改数据库 MyDatabase 设置见证 = 'TCP://datawitness.somedomain.com:7024'
> 
> ALTER DATABASE 命令无法发送到远程服务器实例“TCP://datawitness.somedomain.com:7024”。数据库镜像配置未更改。验证服务器是否已连接，然后重试。

我已经使用 telnet 测试了端口 7024 和 1433，并且两台服务器确实可以相互连接。我还可以从主服务器上的 SQL Server 管理器添加到见证服务器的连接。我已经在两台服务器上使用配置管理器来启用命名管道并验证 IP 流量是否已启用并默认使用端口 1433。

还能是什么？我是否需要打开任何其他端口才能使其正常工作？（防火墙规则非常严格，但我知道前面提到的端口上的流量是明确允许的）

这里值得一提的注意事项：

*   每台服务器在不同的网段

*   服务器不使用 AD 并且不是域的一部分

*   没有为这些服务器配置 DNS 服务器，因此我使用 HOSTS 文件将域名映射到 IP 地址（使用 telnet、ping 等验证）。

*   防火墙规则非常严格，我无法直接调整它们，但如果需要我可以调用更改

*   Data1 和 Data2 使用 SQL Server 2008，Datawitness 使用 SQL Express 2005。它们都使用默认实例（即它们都不是命名实例）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-27T20:16:18.453

在梳理了博客和知识库文章和论坛帖子以及重新安装和重新配置以及重新启动和分析等等之后，我终于找到了谜题的关键 - 见证服务器上的事件日志中的条目报告了这个错误：

```
Database mirroring connection error 2 'DNS lookup failed with error: '11001(No such host is known.)'.' for 'TCP://ABC-WEB01:7024'. 
```

我使用了一个 hosts 文件以 datax.mydomain.com 的形式为所有三台服务器映射了模拟域名。但是，现在很明显，见证人试图使用主服务器的名称进行通信，而我没有主机条目。只需为指向主 Web 服务器的 ABC-WEB01 添加另一个条目就可以了。没有错误，镜像*终于*完成了。

希望这可以为其他人节省十亿小时。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-08-25T12:57:51.893

我想为这个特定问题再添加一个子答案，正如我对克里斯回答的评论所示，我的镜子显示为断开连接（对证人）显然你需要重新启动（或者在我的情况下，我只是重新启动了服务）见证服务器。

一旦我这样做了，镜子就会将见证人连接显示为已连接！

请参阅： http: [//www.bigresource.com/Tracker/Track-ms_sql-cBsxsUSH/](http://www.bigresource.com/Tracker/Track-ms_sql-cBsxsUSH/)

# sql - SQL JOIN：ON vs Equals

> ID：691021
> 
> 赞同：20
> 
> 时间：2009-03-27T18:46:02.180
> 
> 标签：sql, join, equals

以下有什么显着区别吗？

`SELECT a.name, b.name FROM a, b WHERE a.id = b.id AND a.id = 1`

和

`SELECT a.name, b.name FROM a INNER JOIN b ON a.id = b.id WHERE a.id = 1`

SO 用户是否偏好其中之一？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-03-27T18:50:43.633

没有区别，但是当您有一个带有额外 where 子句进行过滤的大型多连接查询时，第二个的可读性要好得多。
将连接子句和过滤子句分开是一件好事 :)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-27T18:55:08.927

前者是 ANSI 89 语法，后者是 ANSI 92。

对于*该特定查询*，没有区别。但是，对于前者，您无法在复杂查询中将过滤器与连接条件分开，并且指定 LEFT、RIGHT 和 INNER 的语法通常会令人困惑，尤其是当您必须在不同的数据库供应商之间来回切换时。我根本不喜欢旧的语法。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-27T18:59:16.920

sql查询引擎没有区别。

为了可读性，如果您使用换行符和缩进，后者更容易阅读。

对于 INNER JOIN，无论您是否将“过滤器”和“连接”放在 ON 或 WHERE 子句中，查询优化器都应该决定首先做什么（它可能选择先进行过滤，然后再进行连接，反之亦然反之亦然

然而，对于 OUTER JOIN，存在差异，有时您希望将条件放在 ON 子句中，有时放在 WHERE 中。将条件放在 OUTER JOIN 的 WHERE 子句中可以将其转换为 INNER JOIN（因为 NULL 的工作方式）

例如，检查以下两个示例之间的可读性：

```
SELECT c.customer_no, o.order_no, a.article_no, r.price
FROM customer c, order o, orderrow r, article a
WHERE o.customer_id = c.customer_id
AND r.order_id = o.order_id
AND a.article_id = r.article_id
AND o.orderdate >= '2003-01-01'
AND o.orderdate < '2004-01-01'
AND c.customer_name LIKE 'A%'
ORDER BY r.price DESC 
```

对比

```
SELECT c.customer_no, o.order_no, a.article_no, r.price
FROM customer c 
INNER JOIN order o
   ON  o.customer_id = c.customer_id
   AND o.orderdate >= '2003-01-01'
   AND o.orderdate < '2004-01-01'
INNER JOIN orderrow r
   ON  r.order_id = o.order_id
INNER JOIN article a 
   ON  a.article_id = r.article_id
WHERE  c.customer_name LIKE 'A%'
ORDER BY r.price DESC 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T18:59:40.493

虽然您可以使用两者来执行大多数任务，并且在您的情况下没有任何区别，但我将始终使用第二个。

1.  这是当前支持的标准
2.  它在 FROM 子句中保留连接，在 WHERE 子句中保留过滤器
3.  它使更复杂的 LEFT、RIGHT、FULL OUTER 连接更容易
4.  MSSQL 帮助完全基于该语法，因此更容易获得有关问题查询的帮助

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-27T19:01:53.407

虽然在技术上没有区别，但使用第一种方法进行连接时需要格外小心。如果你不小心弄错了，你最终可能会在你的 a 和 b 表之间进行笛卡尔连接（一个非常长的内存和 cpu 密集型查询 - 它会将 a 中的每一行与 b 中的所有行匹配。如果 a和 b 是开始的大表）。使用显式 INNER JOIN 既安全又易于阅读。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-27T18:48:09.383

没有不同。我发现第一种格式更具可读性，并且仅在进行其他类型的连接（OUTER、LEFT INNER 等）时才使用第二种格式。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-27T18:55:43.747

第二种形式是符合 SQL92 的语法。这应该意味着所有当前和未来的数据库供应商都支持它。然而，事实是第一种形式是如此普遍，以至于它也保证存在的时间比我们关心的要长。

否则，它们在数据库如何处理这两者的所有方面都是相同的。

# sql - SQL Server中如何确定一个月的天数？

> ID：691022
> 
> 赞同：104
> 
> 时间：2009-03-27T18:46:25.627
> 
> 标签：sql, sql-server, datetime, date, user-defined-functions

我需要确定 SQL Server 中给定日期的一个月中的天数。

有内置功能吗？如果没有，我应该使用什么作为用户定义的函数？

* * *

## 回答 #1

> 赞同：168
> 
> 时间：2013-02-02T09:40:32.267

在 SQL Server 2012 中，您可以使用[EOMONTH (Transact-SQL)](https://docs.microsoft.com/en-us/sql/t-sql/functions/eomonth-transact-sql)获取该月的最后一天，然后您可以使用[DAY (Transact-SQL)](https://docs.microsoft.com/en-us/sql/t-sql/functions/day-transact-sql)获取该月的天数。

```
DECLARE @ADate DATETIME

SET @ADate = GETDATE()

SELECT DAY(EOMONTH(@ADate)) AS DaysInMonth 
```

* * *

## 回答 #2

> 赞同：119
> 
> 时间：2009-03-27T19:00:08.650

您可以在指定月份的第一天使用以下内容：

```
datediff(day, @date, dateadd(month, 1, @date)) 
```

为了使它适用于每个日期：

```
datediff(day, dateadd(day, 1-day(@date), @date),
              dateadd(month, 1, dateadd(day, 1-day(@date), @date))) 
```

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2013-10-25T22:42:26.817

最优雅的解决方案：适用于任何***@DATE***

```
DAY(DATEADD(DD,-1,DATEADD(MM,DATEDIFF(MM,-1,@DATE),0))) 
```

将其放入函数中或仅内联使用它。这回答了原始问题，而其他答案中没有所有额外的垃圾。

其他答案的日期示例：

`SELECT DAY(DATEADD(DD,-1,DATEADD(MM,DATEDIFF(MM,-1,'1/31/2009'),0)))` ***返回 31***

`SELECT DAY(DATEADD(DD,-1,DATEADD(MM,DATEDIFF(MM,-1,'2404-feb-15'),0)))` ***返回 29***

`SELECT DAY(DATEADD(DD,-1,DATEADD(MM,DATEDIFF(MM,-1,'2011-12-22'),0)))` ***返回 31***

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2013-06-05T14:36:48.657

简单得多...试试`day(eomonth(@Date))`

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2009-03-27T19:03:11.623

```
--Last Day of Previous Month
SELECT DATEPART(day, DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)))

--Last Day of Current Month
SELECT DATEPART(day, DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)))

--Last Day of Next Month
SELECT DATEPART(day, DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+2,0))) 
```

不过就个人而言，如果没有内置函数，我会为它制作一个 UDF ......

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2017-04-05T07:07:48.310

**我会建议：**

```
SELECT DAY(EOMONTH(GETDATE())) 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2016-04-28T10:55:49.247

此代码为您获取当月的天数：

```
SELECT datediff(dd,getdate(),dateadd(mm,1,getdate())) as datas 
```

更改`getdate()`为您需要计算天数的日期。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2019-03-22T12:54:02.360

```
 --- sql server below 2012---
    select day( dateadd(day,-1,dateadd(month, 1, convert(date,'2019-03-01'))))
    -- this for sql server 2012--
    select day(EOMONTH(getdate())) 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-27T19:01:23.530

您确实需要添加一个函数，但它是一个简单的函数。我用这个：

```
CREATE FUNCTION [dbo].[ufn_GetDaysInMonth] ( @pDate    DATETIME )

RETURNS INT
AS
BEGIN

    SET @pDate = CONVERT(VARCHAR(10), @pDate, 101)
    SET @pDate = @pDate - DAY(@pDate) + 1

    RETURN DATEDIFF(DD, @pDate, DATEADD(MM, 1, @pDate))
END

GO 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-03-18T14:34:05.867

```
SELECT Datediff(day,
(Convert(DateTime,Convert(varchar(2),Month(getdate()))+'/01/'+Convert(varchar(4),Year(getdate())))),
(Convert(DateTime,Convert(varchar(2),Month(getdate())+1)+'/01/'+Convert(varchar(4),Year(getdate()))))) as [No.of Days in a Month] 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-08-21T19:34:24.383

**解决方案 1：找出我们当前所在月份的天数**

```
DECLARE @dt datetime
SET     @dt = getdate()

SELECT @dt AS [DateTime],
       DAY(DATEADD(mm, DATEDIFF(mm, -1, @dt), -1)) AS [Days in Month] 
```

**解决方案 2：查找给定月年组合中的天数**

```
DECLARE @y int, @m int
SET     @y = 2012
SET     @m = 2

SELECT @y AS [Year],
       @m AS [Month],
       DATEDIFF(DAY,
                DATEADD(DAY, 0, DATEADD(m, ((@y - 1900) * 12) + @m - 1, 0)),
                DATEADD(DAY, 0, DATEADD(m, ((@y - 1900) * 12) + @m, 0))
               ) AS [Days in Month] 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-04-10T08:39:12.720

```
select  datediff(day, 
        dateadd(day, 0, dateadd(month, ((2013 - 1900) * 12) + 3 - 1, 0)),
        dateadd(day, 0, dateadd(month, ((2013  - 1900) * 12) + 3, 0))
        ) 
```

好简单，不需要创建任何功能工作正常

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2015-02-18T12:31:58.853

您需要创建一个函数，但这是为了您自己的方便。它工作得很好，我从来没有遇到过使用这个函数的任何错误计算。

```
CREATE FUNCTION [dbo].[get_days](@date datetime)
RETURNS int
AS
BEGIN
    SET @date = DATEADD(MONTH, 1, @date)
    DECLARE @result int = (select DAY(DATEADD(DAY, -DAY(@date), @date)))
    RETURN @result
END 
```

**它是如何工作的：**从日期本身中减去日期的天数会得到上个月的最后一天。因此，您需要在给定日期上加上一个月，减去天数并获得结果的天分量。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2019-04-12T06:42:53.943

```
select add_months(trunc(sysdate,'MM'),1) -  trunc(sysdate,'MM') from dual; 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-03-27T19:33:06.763

我赞成 Mehrdad，但这也有效。:)

```
CREATE function dbo.IsLeapYear
(
    @TestYear int
)
RETURNS bit
AS
BEGIN
    declare @Result bit
    set @Result = 
    cast(
        case when ((@TestYear % 4 = 0) and (@testYear % 100 != 0)) or (@TestYear % 400 = 0)
        then 1
        else 0
        end
    as bit )
    return @Result
END
GO

CREATE FUNCTION dbo.GetDaysInMonth
(
    @TestDT datetime
)
RETURNS INT
AS
BEGIN

    DECLARE @Result int 
    DECLARE @MonthNo int

    Set @MonthNo = datepart(m,@TestDT)

    Set @Result = 
    case @MonthNo
        when  1 then 31
        when  2 then 
            case 
                when dbo.IsLeapYear(datepart(yyyy,@TestDT)) = 0
                then 28
                else 29
            end
        when  3 then 31
        when  4 then 30
        when  5 then 31
        when  6 then 30
        when  7 then 31
        when  8 then 31
        when  9 then 30 
        when 10 then 31
        when 11 then 30 
        when 12 then 31
    end

    RETURN @Result
END
GO 
```

去测试

```
declare @testDT datetime;

set @testDT = '2404-feb-15';

select dbo.GetDaysInMonth(@testDT) 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-03-27T19:53:40.333

这是另一个...

```
Select Day(DateAdd(day, -Day(DateAdd(month, 1, getdate())), 
                         DateAdd(month, 1, getdate()))) 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2011-12-23T04:12:14.140

我知道这个问题很老，但我想我会分享我正在使用的东西。

```
DECLARE @date date = '2011-12-22'

/* FindFirstDayOfMonth - Find the first date of any month */
-- Replace the day part with -01
DECLARE @firstDayOfMonth date = CAST( CAST(YEAR(@date) AS varchar(4)) + '-' + 
                                      CAST(MONTH(@date) AS varchar(2)) + '-01' AS date)
SELECT @firstDayOfMonth 
```

和

```
DECLARE @date date = '2011-12-22'

/* FindLastDayOfMonth - Find what is the last day of a month - Leap year is handled by DATEADD */
-- Get the first day of next month and remove a day from it using DATEADD
DECLARE @lastDayOfMonth date = CAST( DATEADD(dd, -1, DATEADD(mm, 1, FindFirstDayOfMonth(@date))) AS date)

SELECT @lastDayOfMonth 
```

如果需要，可以将这些组合起来创建一个函数来检索一个月中的天数。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2012-07-13T13:22:49.273

```
SELECT DAY(SUBDATE(ADDDATE(CONCAT(YEAR(NOW()), '-', MONTH(NOW()), '-1'), INTERVAL 1 MONTH), INTERVAL 1 DAY)) 
```

Nice 'n' Simple，不需要创建任何函数

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2016-07-14T11:53:00.867

Mehrdad Afshari 的回复是最准确的，除了通常这个答案是基于 Curtis McEnroe 在他的博客[https://cmcenroe.me/2014/12/05/days-in-month-formula.html中给出的正式数学方法](https://cmcenroe.me/2014/12/05/days-in-month-formula.html)

```
DECLARE @date  DATE= '2015-02-01'
DECLARE @monthNumber TINYINT 
DECLARE @dayCount TINYINT
SET @monthNumber = DATEPART(MONTH,@date )
SET @dayCount = 28 + (@monthNumber + floor(@monthNumber/8)) % 2 + 2 %    @monthNumber + 2 * floor(1/@monthNumber)   
SELECT @dayCount + CASE WHEN @dayCount = 28 AND DATEPART(YEAR,@date)%4 =0 THEN 1 ELSE 0 END -- leap year adjustment 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2016-12-08T07:39:27.730

得到没有。一个月中的天数我们可以直接使用 SQL 中可用的 Day()。

按照我对 SQL Server 2005 / 2008 的答案末尾发布的链接进行操作。

以下示例和结果来自 SQL 2012

```
alter function dbo.[daysinm]
(
@dates nvarchar(12)
)
returns int
as
begin
Declare @dates2 nvarchar(12)
Declare @days int
begin
select @dates2 = (select DAY(EOMONTH(convert(datetime,@dates,103))))
set @days = convert(int,@dates2)
end
return @days
end

--select dbo.daysinm('08/12/2016') 
```

SQL Server SSMS 中的结果

```
 (no column name)
1 31 
```

过程：

当使用EOMONTH 时，无论我们使用哪种日期格式，都会将其转换为SQL-server 的DateTime 格式。那么 EOMONTH() 的日期输出将为 2016-12-31，其中 2016 为年，12 为月，31 为天。此输出在传递给 Day() 时会为您提供当月的总天数。

如果我们想获得即时结果进行检查，我们可以直接运行以下代码，

```
select DAY(EOMONTH(convert(datetime,'08/12/2016',103))) 
```

或者

```
select DAY(EOMONTH(convert(datetime,getdate(),103))) 
```

有关 SQL Server 2005/2008/2012 中的工作参考，请点击以下外部链接...

[在 SQL 中查找一个月中的天数](https://raresql.com/2013/01/06/sql-server-get-number-of-days-in-month/)

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2017-09-10T10:11:14.440

```
DECLARE @date DATETIME = GETDATE(); --or '12/1/2018' (month/day/year) 
SELECT DAY(EOMONTH ( @date )) AS 'This Month'; 
SELECT DAY(EOMONTH ( @date, 1 )) AS 'Next Month'; 
```

结果：本月 31

下个月 30

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2019-08-29T00:59:49.303

```
DECLARE  @m int
SET     @m = 2

SELECT 
       @m AS [Month],
       DATEDIFF(DAY,
                DATEADD(DAY, 0, DATEADD(m, +@m -1, 0)),
                DATEADD(DAY, 0, DATEADD(m,+ @m, 0))
               ) AS [Days in Month] 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2019-10-24T10:10:39.607

```
RETURN day(dateadd(month, 12 * @year + @month - 22800, -1)) 
select day(dateadd(month, 12 * year(date) + month(date) - 22800, -1)) 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2021-06-08T09:26:25.263

实现这一点的一种更简洁的方法是使用该`datefromparts`函数构造一个月的第一天，并从那里计算天数。

```
CREATE FUNCTION [dbo].[fn_DaysInMonth]
(
    @year INT,
    @month INT
)
RETURNS INT
AS
BEGIN

IF @month < 1 OR @month > 12 RETURN NULL;
IF @year < 1753 OR @year > 9998 RETURN NULL;

DECLARE @firstDay DATE = datefromparts(@year, @month, 1);
DECLARE @lastDay DATE = dateadd(month, 1, @firstDay);

RETURN datediff(day, @firstDay, @lastDay);

END
GO 
```

同样，您可以计算一年中的天数：

```
CREATE FUNCTION [dbo].[fn_DaysInYear]
(
    @year INT
)
RETURNS INT
AS
BEGIN

IF @year < 1753 OR @year > 9998 RETURN NULL;

DECLARE @firstDay DATE = datefromparts(@year, 1, 1);
DECLARE @lastDay DATE = dateadd(year, 1, @firstDay);

RETURN datediff(day, @firstDay, @lastDay);

END
GO 
```

* * *

## 回答 #25

> 赞同：-1
> 
> 时间：2013-05-21T14:09:26.270

对于任何日期

```
select DateDiff(Day,@date,DateAdd(month,1,@date)) 
```

* * *

## 回答 #26

> 赞同：-1
> 
> 时间：2016-04-18T08:10:14.460

SQLServer2012 中的简单查询：

选择日期(('20-05-1951 22:00:00'))

我测试了很多日期，它总是返回正确的结果

* * *

## 回答 #27

> 赞同：-1
> 
> 时间：2017-01-09T05:17:37.007

选择 first_day=dateadd(dd,-1*datepart(dd,getdate())+1,getdate()), last_day=dateadd(dd,-1*datepart(dd,dateadd(mm,1,getdate())) ,dateadd(mm,1,getdate())), no_of_days = 1+datediff(dd,dateadd(dd,-1*datepart(dd,getdate())+1,getdate()),dateadd(dd,-1 *datepart(dd,dateadd(mm,1,getdate())),dateadd(mm,1,getdate())))

用 getdate 替换任何日期以获取该特定日期的月份数

* * *

## 回答 #28

> 赞同：-1
> 
> 时间：2018-01-31T11:20:14.410

```
DECLARE @Month INT=2,
    @Year INT=1989
DECLARE @date DateTime=null
SET @date=CAST(CAST(@Year AS nvarchar) + '-' + CAST(@Month AS nvarchar) + '-' + '1' AS DATETIME);

DECLARE @noofDays TINYINT 
DECLARE @CountForDate TINYINT
SET @noofDays = DATEPART(MONTH,@date )
SET @CountForDate = 28 + (@noofDays + floor(@noofDays/8)) % 2 + 2 %    @noofDays + 2 * floor(1/@noofDays)   
SET @noofDays= @CountForDate + CASE WHEN @CountForDate = 28 AND DATEPART(YEAR,@date)%4 =0 THEN 1 ELSE 0 END
PRINT @noofDays 
```

* * *

## 回答 #29

> 赞同：-2
> 
> 时间：2015-01-05T11:42:18.910

```
DECLARE @date nvarchar(20)
SET @date ='2012-02-09 00:00:00'
SELECT DATEDIFF(day,cast(replace(cast(YEAR(@date) as char)+'-'+cast(MONTH(@date) as char)+'-01',' ','')+' 00:00:00' as datetime),dateadd(month,1,cast(replace(cast(YEAR(@date) as char)+'-'+cast(MONTH(@date) as char)+'-01',' ','')+' 00:00:00' as datetime))) 
```

# windows - 有没有办法从 NTFS 卷的 MFT 中获取文件名/位置信息？

> ID：691024
> 
> 赞同：3
> 
> 时间：2009-03-27T18:46:50.587
> 
> 标签：windows, filesystems, ntfs

我需要获取驱动器上所有文件的列表。我正在使用递归解决方案。但这需要很多时间。我想知道，是否可以从它的主文件表中获取 NTFS 驱动器上所有文件的名称和位置？我认为它会非常快。有什么建议么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-11-27T08:29:31.747

有一个工具可以直接搜索mft，它叫做ndff。我以前用过它，速度非常快。

大概可以做你想做的事——还有另一个工具叫做“Everything”，我猜它做同样的事情——它还使用 USN 更改日志来更新它的索引。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T22:14:07.063

当您使用递归解决方案获得 NTFS 格式驱动器上所有文件的列表时，您就是从 MFT 获得它们。当简单地检索文件名和目录列表时，在 MFT 之外应该有很少的磁盘 IO。

在确定 MFT 的格式（可从 Internet 上的许多地方获得）并编写代码以直接读取它之前，您可能应该分析您的代码并确定您还不是 CPU 或 IO边界。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-28T11:17:27.383

我的印象是，您正在想象 MFT 中的某种类似列表的结构，您可以一口气阅读，而无需或只需最少的搜索。

不是这种情况。MFT 使用一种 b 树来存储路径名。当您扫描磁盘上的目录结构时，您实际上是在遍历 MFT b-tree；如果您直接访问 MFT，您正在做您必须做的事情。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-12-21T04:22:33.897

是的，我刚刚开源的[程序就是这样做的。](https://sourceforge.net/projects/swiftsearch/)

您可以阅读源代码以了解它是如何工作的，但基本上，它只是在 $MFT 中查找[`FILE_NAME`属性](http://msdn.microsoft.com/en-us/library/bb470123.aspx)，然后使用该`ParentDirectory`字段来获取每个文件的父级。

这样就可以完全避免读取任何目录的内容。

# java - 这是快速排序的正确实现吗？

> ID：691026
> 
> 赞同：7
> 
> 时间：2009-03-27T18:47:02.490
> 
> 标签：java, quicksort

我想检查这是否是 QuickSort 的正确实现，它似乎在做这项工作，但我错过了什么吗？

```
public class QuickSort implements Sorter {

public void sort(Comparable[] items) {
    QuickSort(items, 0, items.length - 1);
}

static void QuickSort(Comparable[] items, int a, int b) {
    int lo = a;
    int hi = b;
    if (lo >= hi) {
        return;
    }
    Comparable mid = items[(lo + hi) / 2];
    Comparable T;

    while (lo < hi) {
        while (items[lo].compareTo(mid)<0) {
            lo++;
        }
        while (mid.compareTo(items[hi])<0) {
            hi--;
        }
        if (lo < hi) {
            T = items[lo];
            items[lo] = items[hi];
            items[hi] = T;
        }
    }

    QuickSort(items, a, lo);
    QuickSort(items, lo == a ? lo + 1 : lo, b);

} 
```

}

***固定的：***

```
private static void quickSort(Comparable[] items, int a, int b) {
    int i = a;
    int j = b;

    Comparable x = items[(a+ b) / 2];
    Comparable h;

    do {
        while (items[i].compareTo(x) < 0) {
            i++;
        }
        while (items[j].compareTo(x) > 0) {
            j--;
        }
        if (i <= j) {
            h = items[i];
            items[i] = items[j];
            items[j] = h;
            i++;
            j--;
        }
    } while (i <= j);

    if (a < j) {
        quickSort(items, a, j);
    }
    if (i < b) {
        quickSort(items, i, b);
    }
} 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-27T18:50:33.370

1 小点 - 这里有一个潜在的 int 溢出：

(lo + hi) / 2

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-27T20:04:28.607

借此机会学习如何编写单元测试。（例如，谷歌在“junit”上）。生成大数组并确保它们排序正确，例如：用随机数填充的数组，用 0、1、Integer.MAX_INT 填充的数组。尝试引发整数溢出和其他奇怪的极端情况。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-27T18:53:22.660

编辑：我错过了java标签，对不起......下面是C＃通用快速排序......无论如何我都会把它留在这里给.net读者......

乍一看还不错，但是这个通用的呢？

```
public class QuickSort<T> where T : IComparable<T>
{
    #region private variable to sort inplace
    readonly private IList<T> itms;
    #endregion private variable to sort inplace

    #region ctor
    private QuickSort() { } // Hide parameterless constructor
    /// <summary>
    /// Constructor requires IList<T> T must implement CompareTo() method.../>
    /// </summary>
    /// <param name="Lst">List<T> of elements to sort</param>
    public QuickSort(IList<T> Lst):this)() { itms = Lst; }
    #endregion ctor

    #region public sort method
    public void Sort() { Sort(0, itms.Count - 1); }
    /// <summary>
    /// Executes QuickSort algorithm
    /// </summary>
    /// <param name="L">Index of left-hand boundary of partition to sort</param>
    /// <param name="R">Index of right-hand boundary of partition to sort</param>
    private void Sort(long L, long R)
    {
        // Calls iSort (insertion-sort) for partitions smaller than 5 elements
        if (R - L < 4) iSort(L, R); 
        else
        {
            long i = (L + R) / 2, j = R - 1;
            // Next three lines to set upper and lower bounds
            if (itms[L].CompareTo(itms[i]) > 0) Swap(L, i);
            if (itms[L].CompareTo(itms[R]) > 0) Swap(L, R);
            if (itms[i].CompareTo(itms[R]) > 0) Swap(i, R);
            Swap(i, j);
            // --------------------------------
            T p = itms[j]; // p = itms[j] is pivot element
            i = L;
            while (true)
            {
                while (itms[++i].CompareTo(p) < 0) {}
                while (itms[--j].CompareTo(p) > 0) {}
                if (j < i) break;
                Swap(i, j);
            }
            Swap(i, R - 1);
            Sort(L, i);     // Sort  Left partition --  HERE WAS TYPO BUG
            Sort(i + 1, R); // Sort Right partition
        }
    }
    #endregion public sort method

    #region private Helper methods
    private void Swap(long L, long R)
    {
        T t = itms[L];
        itms[L] = itms[R];
        itms[R] = t;
    }
    private void iSort(long L, long R)
    {
        for (long i = L; i <= R; i++)
        {
            T t = itms[i];
            long j = i;
            while ((j > L) && (itms[j - 1].CompareTo(t) > 0))
            {
                itms[j] = itms[j - 1];
                j--;
            }
            itms[j] = t;
        }
    }
    #endregion private Helper methods
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-28T16:22:27.367

这是一个 javascript 版本... QuickSort(a, comp, desc)

*   a 当然是要排序的数组。
*   comp 是比较函数，它必须接受两个值并返回 -1、0 或 +1，具体取决于 2 个参数的排序方式。
*   desc 是用于反转排序顺序的布尔值。

    ```
    function QuickSort(a, comp, desc) {
       function defComp(L, R)  {return((L>R)? 1: (L<R)? -1: 0);}
        var cmp = (comp)? comp: defComp; 
        var siz = a.length;
        qSort(0, siz-1);
        if (desc) reverse();
        // ------------------
        function qSort(L, R) {
            if (R - L < 4) {iSort(L, R);} // insertion-sort--
            else {
                var i = parseInt((L+R) /2),  j=R-1;
                if (cmp(a[L], a[i]) > 0) swap(L,i);
                if (cmp(a[L], a[R]) > 0) swap(L,R);
                if (cmp(a[i], a[R]) > 0) swap(i,R);
                swap(i,j);
                // ------------------------------------------
                var p=a[j]; // p=a[j] is pivot
                i=L;
                while (true) {
                    while(cmp(a[++i], p) < 0); 
                    while(cmp(a[--j], p) > 0);    
                    if (j < i) break;
                    swap(i,j);
                }
                swap(i,R-1);
                qSort(L,i);   // Left  Partition
                qSort(i+1,R); // Right Partition
            }
        }
        function swap(L,R) {var t=a[L];  a[L]=a[R];  a[R]=t;}
        function reverse()
           {for(var i=0; i<parseInt(siz/2); i++) swap(i,(siz-i-1));}
        // insertion-sort 
        function iSort(L,R) {
            var j,t;
            for(var i=L; i<=R; i++) {
                t = a[i], j = i;
                while ((j>L) && (cmp(a[j-1], t) > 0))
                    {a[j] = a[j-1]; j--;}
                a[j] = t;
            }
        }
    } 
    ```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-28T18:50:25.343

```
public static void quicksort( Comparable [ ] a ) {

quicksort( a, 0, a.length - 1 );
}
private static final int CUTOFF = 10;
private static void quicksort( Comparable [ ] a, int low, int high ) {
if( low + CUTOFF > high )
insertionSort( a, low, high );
else {
int middle = ( low + high ) / 2;
if( a[ middle ].compareTo( a[ low ] ) < 0 )
swapReferences( a, low, middle );
if( a[ high ].compareTo( a[ low ] ) < 0 )
swapReferences( a, low, high );
if( a[ high ].compareTo( a[ middle ] ) < 0 )
swapReferences( a, middle, high );
swapReferences( a, middle, high - 1 );
Comparable pivot = a[ high - 1 ];
int i, j;
for( i = low, j = high - 1; ; ) {
while( a[ ++i ].compareTo( pivot ) < 0 )
;
while( pivot.compareTo( a[ --j ] ) < 0 )
;
if( i >= j )
break;
swapReferences( a, i, j );
}
swapReferences( a, i, high - 1
quicksort( a, low, i - 1 ); // Sort small elements
quicksort( a, i + 1, high ); // Sort large elements
 }
}
public static final void swapReferences( Object [ ] a, int index1, int index2 )
{
Object tmp = a[ index1 ];
a[ index1 ] = a[ index2 ];
a[ index2 ] = tmp;
}
private static void insertionSort( Comparable [ ] a, int low, int high ) {
for( int p = low + 1; p <= high; p++ ) {
Comparable tmp = a[ p ];
int j;
for( j = p; j > low && tmp.compareTo( a[ j - 1 ] ) < 0; j-- )
a[ j ] = a[ j - 1 ];
a[ j ] = tmp;
}
} 
```

来自[http://java-blackberry.blogspot.com/2007/12/quick-sort-implementation-with-median.html](http://java-blackberry.blogspot.com/2007/12/quick-sort-implementation-with-median.html)

# c# - 在 System.ComponentModel 默认值属性中将 DateTime 属性的默认值设置为 DateTime.Now

> ID：691035
> 
> 赞同：120
> 
> 时间：2009-03-27T18:49:38.597
> 
> 标签：c#, asp.net, entity-framework, asp.net-core-2.1, ef-core-2.1

有谁知道如何使用 System.ComponentModel DefaultValue 属性为 DateTime 属性指定默认值？

例如我试试这个：

```
[DefaultValue(typeof(DateTime),DateTime.Now.ToString("yyyy-MM-dd"))]
public DateTime DateCreated { get; set; } 
```

它期望值是一个常量表达式。

这是在使用 ASP.NET 动态数据的上下文中。我不想搭建 DateCreated 列，而只是提供 DateTime.Now（如果它不存在）。我使用实体框架作为我的数据层

干杯，

安德鲁

* * *

## 回答 #1

> 赞同：105
> 
> 时间：2009-03-27T18:51:37.750

您不能对属性执行此操作，因为它们只是在编译时生成的元信息。如果需要，只需将代码添加到构造函数以初始化日期，创建触发器并处理数据库中的缺失值，或者以返回 DateTime.Now 的方式实现 getter（如果支持字段未初始化）。

```
public DateTime DateCreated
{
   get
   {
      return this.dateCreated.HasValue
         ? this.dateCreated.Value
         : DateTime.Now;
   }

   set { this.dateCreated = value; }
}

private DateTime? dateCreated = null; 
```

* * *

## 回答 #2

> 赞同：82
> 
> 时间：2017-05-19T12:39:18.063

在 DateTime 属性中添加以下内容

```
[DatabaseGenerated(DatabaseGeneratedOption.Computed)] 
```

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2018-09-22T09:54:38.760

我已经在**EF core 2.1上测试过了**

在这里，您不能使用约定或数据注释。您必须使用**Fluent API**。

```
class MyContext : DbContext
{
    public DbSet<Blog> Blogs { get; set; }

    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        modelBuilder.Entity<Blog>()
            .Property(b => b.Created)
            .HasDefaultValueSql("getdate()");
    }
} 
```

[**官方文档**](https://docs.microsoft.com/en-us/ef/core/modeling/relational/default-values)

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2015-04-16T16:18:04.817

我没有理由想出它不应该通过属性来完成。它可能在微软的积压中。谁知道。

我找到的最佳解决方案是在代码先迁移中使用 defaultValueSql 参数。

```
CreateTable(
    "dbo.SomeTable",
    c => new
        {
            TheDateField = c.DateTime(defaultValueSql: "GETDATE()")
        }); 
```

我不喜欢在实体类构造函数中设置它的经常参考解决方案，因为如果实体框架以外的任何东西在该表中粘贴记录，则日期字段将不会获得默认值。使用触发器来处理这种情况的想法对我来说似乎是错误的。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2012-02-15T10:41:59.050

这是可能的并且非常简单：

为了`DateTime.MinValue`

```
[System.ComponentModel.DefaultValue(typeof(DateTime), "")] 
```

对于任何其他值作为`DefaultValueAttribute`指定字符串的最后一个参数，该字符串表示所需的 DateTime 值。

此值必须是常量表达式，并且是使用创建 object( `DateTime`)所必需的`TypeConverter`。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2017-11-28T09:39:40.643

刚刚发现这个正在寻找不同的东西，但在新的 C# 版本中，您可以使用更短的版本：

```
public DateTime DateCreated { get; set; } = DateTime.Now; 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2010-11-18T17:39:09.183

如果您使用实体框架，一个简单的解决方案是添加一个部分类并为实体定义一个构造函数，因为框架没有定义一个。例如，如果您有一个名为 Example 的实体，您可以将以下代码放在单独的文件中。

```
namespace EntityExample
{
    public partial class Example : EntityObject
    {
        public Example()
        {
            // Initialize certain default values here.
            this._DateCreated = DateTime.Now;
        }
    }
} 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2012-04-17T07:32:02.037

我认为最简单的解决方案是设置

```
Created DATETIME2 NOT NULL DEFAULT GETDATE() 
```

在列声明和 VS2010 EntityModel 设计器中设置相应的列属性**StoreGeneratedPattern = Computed**。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2011-06-03T20:52:36.187

创建一个新的属性类是一个很好的建议。在我的例子中，我想指定“default(DateTime)”或“DateTime.MinValue”，以便 Newtonsoft.Json 序列化程序会忽略没有实际值的 DateTime 成员。

```
[JsonProperty( DefaultValueHandling = DefaultValueHandling.Ignore )]
[DefaultDateTime]
public DateTime EndTime;

public class DefaultDateTimeAttribute : DefaultValueAttribute
{
    public DefaultDateTimeAttribute()
        : base( default( DateTime ) ) { }

    public DefaultDateTimeAttribute( string dateTime )
        : base( DateTime.Parse( dateTime ) ) { }
} 
```

如果没有 DefaultValue 属性，即使设置了 DefaultValueHandling.Ignore 选项，JSON 序列化程序也会输出“1/1/0001 12:00:00 AM”。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2013-04-23T21:39:50.913

只需考虑在实体类的构造函数中设置其值

```
public class Foo
{
       public DateTime DateCreated { get; set; }
       public Foo()
       {
           DateCreated = DateTime.Now;
       }

} 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2018-04-09T18:49:36.303

使用 System.ComponentModel.DataAnnotations.Schema；

```
[DatabaseGenerated(DatabaseGeneratedOption.Computed)]
public DateTime CreatedOn { get; private set; } 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2011-05-25T01:38:03.917

我需要一个 UTC Timestamp 作为默认值，因此修改了 Daniel 的解决方案，如下所示：

```
 [Column(TypeName = "datetime2")]
    [XmlAttribute]
    [DisplayFormat(ApplyFormatInEditMode = true, DataFormatString = "{0:yyyy-MM-dd}")]
    [Display(Name = "Date Modified")]
    [DateRange(Min = "1900-01-01", Max = "2999-12-31")]
    public DateTime DateModified {
        get { return dateModified; }
        set { dateModified = value; } 
    }
    private DateTime dateModified = DateTime.Now.ToUniversalTime(); 
```

对于 DateRangeAttribute 教程，请参阅[这篇很棒的博客文章](http://blogs.msdn.com/b/stuartleeks/archive/2011/01/25/asp-net-mvc-3-integrating-with-the-jquery-ui-date-picker-and-adding-a-jquery-validate-date-range-validator.aspx)

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2017-01-17T18:37:54.627

有一种方法。添加这些类：

DefaultDateTimeValueAttribute.cs

```
using System;
using System.ComponentModel;
using System.ComponentModel.DataAnnotations;
using System.Linq;
using System.Reflection;
using System.Runtime.CompilerServices;
using Custom.Extensions;

namespace Custom.DefaultValueAttributes
{
    /// <summary>
    /// This class's DefaultValue attribute allows the programmer to use DateTime.Now as a default value for a property.
    /// Inspired from https://code.msdn.microsoft.com/A-flexible-Default-Value-11c2db19\. 
    /// </summary>
    [AttributeUsage(AttributeTargets.Property)]
    public sealed class DefaultDateTimeValueAttribute : DefaultValueAttribute
    {
        public string DefaultValue { get; set; }
        private object _value;

        public override object Value
        {
            get
            {
                if (_value == null)
                    return _value = GetDefaultValue();

                return _value;
            }
        }

        /// <summary>
        /// Initialized a new instance of this class using the desired DateTime value. A string is expected, because the value must be generated at runtime.
        /// Example of value to pass: Now. This will return the current date and time as a default value. 
        /// Programmer tip: Even if the parameter is passed to the base class, it is not used at all. The property Value is overridden.
        /// </summary>
        /// <param name="defaultValue">Default value to render from an instance of <see cref="DateTime"/></param>
        public DefaultDateTimeValueAttribute(string defaultValue) : base(defaultValue)
        {
            DefaultValue = defaultValue;
        }

        public static DateTime GetDefaultValue(Type objectType, string propertyName)
        {
            var property = objectType.GetProperty(propertyName);
            var attribute = property.GetCustomAttributes(typeof(DefaultDateTimeValueAttribute), false)
                ?.Cast<DefaultDateTimeValueAttribute>()
                ?.FirstOrDefault();

            return attribute.GetDefaultValue();
        }

        private DateTime GetDefaultValue()
        {
            // Resolve a named property of DateTime, like "Now"
            if (this.IsProperty)
            {
                return GetPropertyValue();
            }

            // Resolve a named extension method of DateTime, like "LastOfMonth"
            if (this.IsExtensionMethod)
            {
                return GetExtensionMethodValue();
            }

            // Parse a relative date
            if (this.IsRelativeValue)
            {
                return GetRelativeValue();
            }

            // Parse an absolute date
            return GetAbsoluteValue();
        }

        private bool IsProperty
            => typeof(DateTime).GetProperties()
                .Select(p => p.Name).Contains(this.DefaultValue);

        private bool IsExtensionMethod
            => typeof(DefaultDateTimeValueAttribute).Assembly
                .GetType(typeof(DefaultDateTimeExtensions).FullName)
                .GetMethods()
                .Where(m => m.IsDefined(typeof(ExtensionAttribute), false))
                .Select(p => p.Name).Contains(this.DefaultValue);

        private bool IsRelativeValue
            => this.DefaultValue.Contains(":");

        private DateTime GetPropertyValue()
        {
            var instance = Activator.CreateInstance<DateTime>();
            var value = (DateTime)instance.GetType()
                .GetProperty(this.DefaultValue)
                .GetValue(instance);

            return value;
        }

        private DateTime GetExtensionMethodValue()
        {
            var instance = Activator.CreateInstance<DateTime>();
            var value = (DateTime)typeof(DefaultDateTimeValueAttribute).Assembly
                .GetType(typeof(DefaultDateTimeExtensions).FullName)
                .GetMethod(this.DefaultValue)
                .Invoke(instance, new object[] { DateTime.Now });

            return value;
        }

        private DateTime GetRelativeValue()
        {
            TimeSpan timeSpan;
            if (!TimeSpan.TryParse(this.DefaultValue, out timeSpan))
            {
                return default(DateTime);
            }

            return DateTime.Now.Add(timeSpan);
        }

        private DateTime GetAbsoluteValue()
        {
            DateTime value;
            if (!DateTime.TryParse(this.DefaultValue, out value))
            {
                return default(DateTime);
            }

            return value;
        }
    }
} 
```

DefaultDateTimeExtensions.cs

```
using System;

namespace Custom.Extensions
{
    /// <summary>
    /// Inspired from https://code.msdn.microsoft.com/A-flexible-Default-Value-11c2db19\. See usage for more information.
    /// </summary>
    public static class DefaultDateTimeExtensions
    {
        public static DateTime FirstOfYear(this DateTime dateTime)
            => new DateTime(dateTime.Year, 1, 1, dateTime.Hour, dateTime.Minute, dateTime.Second, dateTime.Millisecond);

        public static DateTime LastOfYear(this DateTime dateTime)
            => new DateTime(dateTime.Year, 12, 31, dateTime.Hour, dateTime.Minute, dateTime.Second, dateTime.Millisecond);

        public static DateTime FirstOfMonth(this DateTime dateTime)
            => new DateTime(dateTime.Year, dateTime.Month, 1, dateTime.Hour, dateTime.Minute, dateTime.Second, dateTime.Millisecond);

        public static DateTime LastOfMonth(this DateTime dateTime)
            => new DateTime(dateTime.Year, dateTime.Month, DateTime.DaysInMonth(dateTime.Year, dateTime.Month), dateTime.Hour, dateTime.Minute, dateTime.Second, dateTime.Millisecond);
    }
} 
```

并使用 DefaultDateTimeValue 作为属性的属性。输入到验证属性的值类似于“Now”，它将在运行时从使用 Activator 创建的 DateTime 实例呈现。源代码的灵感来自这个线程：[https](https://code.msdn.microsoft.com/A-flexible-Default-Value-11c2db19) ://code.msdn.microsoft.com/A-flexible-Default-Value-11c2db19 。我对其进行了更改，以使我的类使用 DefaultValueAttribute 而不是 ValidationAttribute 继承。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2019-09-28T18:25:37.313

我遇到了同样的问题，但最适合我的问题如下：

```
public DateTime CreatedOn { get; set; } = DateTime.Now; 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2018-03-08T08:34:54.617

在 C# 版本 6 中，可以提供默认值

```
public DateTime fieldname { get; set; } = DateTime.Now; 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2021-07-22T10:51:20.730

使用`EntityTypeConfiguration`，我得到它是这样的：

```
public class UserMap : IEntityTypeConfiguration<User>
{
    public void Configure(EntityTypeBuilder<User> builder)
    {
        //throw new NotImplementedException();
        builder.Property(u => u.Id).ValueGeneratedOnAdd();
        builder.Property(u => u.Name).IsRequired().HasMaxLength(100);
        builder.HasIndex(u => u.Email).IsUnique();
        builder.Property(u => u.Status).IsRequired();
        builder.Property(u => u.Password).IsRequired();
        builder.Property(u => u.Registration).HasDefaultValueSql("getdate()");

        builder.HasMany(u => u.DrawUser).WithOne(u => u.User);

        builder.ToTable("User");
    }
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-03-27T23:02:09.707

您目前如何处理这取决于您使用的是什么模型 Linq to SQL 或 EntityFramework？

在 L2S 中，您可以添加

```
public partial class NWDataContext
{
    partial void InsertCategory(Category instance)
    {
        if(Instance.Date == null)
            Instance.Data = DateTime.Now;

        ExecuteDynamicInsert(instance);
    }
} 
```

EF 稍微复杂一些，请参阅[http://msdn.microsoft.com/en-us/library/cc716714.aspx](http://msdn.microsoft.com/en-us/library/cc716714.aspx)了解有关 EF 业务逻辑的更多信息。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2010-07-07T17:00:11.533

```
public DateTime DateCreated
{
   get
   {
      return (this.dateCreated == default(DateTime))
         ? this.dateCreated = DateTime.Now
         : this.dateCreated;
   }

   set { this.dateCreated = value; }
}
private DateTime dateCreated = default(DateTime); 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2015-03-11T18:14:46.393

我知道这篇文章有点旧，但有一个建议可能会对一些人有所帮助。

我使用 Enum 来确定在属性构造函数中设置什么。

财产声明：

```
[DbProperty(initialValue: EInitialValue.DateTime_Now)]
public DateTime CreationDate { get; set; } 
```

属性构造函数：

```
Public Class DbProperty Inherits System.Attribute

    Public Property InitialValue As Object

    Public Sub New(ByVal initialValue As EInitialValue)
       Select Case initialValue
          Case EInitialValue.DateTime_Now
             Me.InitialValue = System.DateTime.Now

          Case EInitialValue.DateTime_Min
             Me.InitialValue = System.DateTime.MinValue

          Case EInitialValue.DateTime_Max
             Me.InitialValue = System.DateTime.MaxValue

       End Select

    End Sub
End Class 
```

枚举：

```
Public Enum EInitialValue
   DateTime_Now
   DateTime_Min
   DateTime_Max
End Enum 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2017-04-17T01:36:55.340

我*认为*您可以使用`StoreGeneratedPattern = Identity`（在模型设计器属性窗口中设置）来执行此操作。

我不会猜到那是怎么做的，但是在试图弄清楚时，我注意到我的一些日期列已经默认为`CURRENT_TIMESTAMP()`，而有些则不是。检查模型，我发现除了名称之外，两列之间的唯一区别是获得默认值的那一列已`StoreGeneratedPattern`设置为`Identity`.

我没想到会这样，但阅读描述，这有点道理：

> 确定在插入和更新操作期间是否将自动生成数据库中的相应列。

此外，虽然这确实使数据库列具有“现在”的默认值，但我猜它实际上并没有将属性设置为`DateTime.Now`在 POCO 中。这对我来说不是问题，因为我有一个自定义的 .tt 文件，它已经将我的所有日​​期列设置为`DateTime.Now`自动（实际上自己修改 .tt 文件并不难，特别是如果你有 ReSharper 并获得语法突出显示插件。（较新版本的 VS 可能已经语法高亮 .tt 文件，不确定。））

我的问题是：我如何让数据库列具有默认值，以便省略该列的现有查询仍然有效？上述设置适用于此。

我尚未对其进行测试，但设置它也可能会干扰设置您自己的显式值。（我最初只是偶然发现了这一点，因为 EF6 Database First 以这种方式为我编写了模型。）

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2021-03-12T20:24:48.370

以下适用于 .NET 5.0

```
 private DateTime _DateCreated= DateTime.Now;
        public DateTime DateCreated
        {
            get
            {
                return this._DateCreated;
            }

            set { this._DateCreated = value; }
        } 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2021-05-30T11:19:58.440

您还可以考虑使用 DatabaseGenerated 属性，例如

```
[DatabaseGenerated(DatabaseGeneratedOption.Identity)]
public DateTime DateCreated { get; set; } 
```

[https://docs.microsoft.com/en-us/ef/core/modeling/generated-properties?tabs=data-annotations](https://docs.microsoft.com/en-us/ef/core/modeling/generated-properties?tabs=data-annotations)

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2021-09-08T23:27:34.770

使用 Fluent API，在 Context 类的 OnModelCreating 函数中添加以下内容。

```
 builder.Property(u => u.CreatedAt).ValueGeneratedOnAdd();
 builder.Property(u => u.UpdatedAt).ValueGeneratedOnAddOrUpdate(); 
```

注意我使用的是单独的类型配置类。如果你在函数中做得对，就像：

```
builder.Enitity<User>().Property(u => u.CreatedAt).ValueGeneratedOnAdd(); 
```

* * *

## 回答 #24

> 赞同：-8
> 
> 时间：2010-08-27T09:47:46.920

我也想要这个并想出了这个解决方案（我只使用日期部分 - 默认时间作为 PropertyGrid 默认值没有意义）：

```
public class DefaultDateAttribute : DefaultValueAttribute {
  public DefaultDateAttribute(short yearoffset)
    : base(DateTime.Now.AddYears(yearoffset).Date) {
  }
} 
```

这只会创建一个新属性，您可以将其添加到 DateTime 属性中。例如，如果它默认为 DateTime.Now.Date：

```
[DefaultDate(0)] 
```

# linux - 在 linux 中将网页从 UTF-8 转换为 ISO-8859-1

> ID：691040
> 
> 赞同：10
> 
> 时间：2009-03-27T18:51:10.590
> 
> 标签：linux, encoding, character-encoding

任何人都知道如何在 linux (Ubuntu) 中将许多 php 和 html 文件从 UTF-8 转换为 ISO-8859-1？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-27T18:59:25.657

Ubuntu有[重新编码](https://packages.ubuntu.com/cosmic/recode)

```
$ sudo apt-get install recode
$ recode UTF-8..latin1 *.php 
```

递归地，感谢[Ted Dziuba](https://stackoverflow.com/users/104/ted-dziuba)：

```
$ find . -name "*.php" -exec recode UTF-8..latin1 {} \; 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-27T18:57:18.003

我认为 iconv 是你的答案......

表单人 iconv：

```
  姓名
      iconv - 将给定文件的编码从一种编码转换为另一种编码

  概要
      iconv -f 编码 -t 编码输入文件

  描述
      iconv 程序将 inputfile 中的字符编码从一种编码转换为
      字符集为另一个。除非另有说明，否则结果将写入标准输出
      由 --output 选项指定。

      ......

```

所以你可能会做一个

```
find $my_base_dir -name "*.php" -o -name "*.html" -exec sh -c "( \
   iconv -t ISO88592 -f UTF8 {} -o {}.iconv ; \
   mv {}.iconv {} ; \
)" \; 
```

这将递归地找到适当命名的文件并重新编码它们（临时文件是必要的，因为 iconv 将在开始工作之前截断输出）。

# python - 在 Python 中，如何确定 IP 地址是否是私有的？

> ID：691045
> 
> 赞同：30
> 
> 时间：2009-03-27T18:51:53.833
> 
> 标签：python, network-programming, ip-address

在 Python 中，确定 IP 地址（例如，`'127.0.0.1'`或`'10.98.76.6'`）是否在[专用网络](http://en.wikipedia.org/wiki/Private_network)上的最佳方法是什么？代码听起来并不难写。但是可能存在比立即明显更多的边缘情况，并且需要考虑 IPv6 支持等。是否有现有的库可以做到这一点？

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2015-06-24T20:30:24.950

从 Python 3.3 开始，您可以使用 stdlib 中的[ipaddress 模块](https://docs.python.org/3/library/ipaddress.html)。

```
>>> import ipaddress
>>> ipaddress.ip_address('192.168.0.1').is_private
True 
```

如果使用 Python 2.6 或更高版本，我强烈建议使用[此模块的反向移植](https://pypi.python.org/pypi/py2-ipaddress/)。

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2009-03-27T18:55:23.263

查看[IPy](http://pypi.python.org/pypi/IPy/)模块。如果有一个`iptype()`似乎做你想做的功能：

```
>>> from IPy import IP
>>> ip = IP('127.0.0.0/30')
>>> ip.iptype()
'PRIVATE' 
```

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2011-12-01T10:36:41.797

您可以使用 [https://www.rfc-editor.org/rfc/rfc1918](https://www.rfc-editor.org/rfc/rfc1918)和[https://www.rfc-editor.org/rfc/rfc3330 自行](https://www.rfc-editor.org/rfc/rfc3330)检查。如果您有 127.0.0.1 ，您只需要`&`使用掩码（比如说`255.0.0.0`）并查看该值是否与任何专用网络的[网络地址](http://en.wikipedia.org/wiki/Network_address)匹配。所以使用[inet_pton](http://docs.python.org/2/library/socket.html#socket.inet_pton)你可以这样做：`127.0.0.1 & 255.0.0.0 = 127.0.0.0`

这是说明这一点的代码：

```
from struct import unpack
from socket import AF_INET, inet_pton

def lookup(ip):
    f = unpack('!I',inet_pton(AF_INET,ip))[0]
    private = (
        [ 2130706432, 4278190080 ], # 127.0.0.0,   255.0.0.0   https://www.rfc-editor.org/rfc/rfc3330
        [ 3232235520, 4294901760 ], # 192.168.0.0, 255.255.0.0 https://www.rfc-editor.org/rfc/rfc1918
        [ 2886729728, 4293918720 ], # 172.16.0.0,  255.240.0.0 https://www.rfc-editor.org/rfc/rfc1918
        [ 167772160,  4278190080 ], # 10.0.0.0,    255.0.0.0   https://www.rfc-editor.org/rfc/rfc1918
    ) 
    for net in private:
        if (f & net[1]) == net[0]:
            return True
    return False

# example
print(lookup("127.0.0.1"))
print(lookup("192.168.10.1"))
print(lookup("10.10.10.10"))
print(lookup("172.17.255.255"))
# outputs True True True True 
```

另一种实现是计算所有私有块的 int 值：

```
from struct import unpack
from socket import AF_INET, inet_pton

lookup = "127.0.0.1"
f = unpack('!I',inet_pton(AF_INET,lookup))[0]
private = (["127.0.0.0","255.0.0.0"],["192.168.0.0","255.255.0.0"],["172.16.0.0","255.240.0.0"],["10.0.0.0","255.0.0.0"])
for net in private:
    mask = unpack('!I',inet_aton(net[1]))[0]
    p = unpack('!I',inet_aton(net[0]))[0]
    if (f & mask) == p:
        print lookup + " is private" 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2015-02-15T23:03:15.527

这是@Kurt 建议的正则表达式方法的固定版本，包括@RobEvans 推荐的修复

*   ^127.\d{1,3}.\d{1,3}.\d{1,3}$

*   ^10.\d{1,3}.\d{1,3}.\d{1,3}$

*   ^192.168.\d{1,3}.\d{1,3}$

*   ^172.(1[6-9]|2[0-9]|3[0-1]).[0-9]{1,3}.[0-9]{1,3}$

    ```
     def is_ip_private(ip):

         # https://en.wikipedia.org/wiki/Private_network

         priv_lo = re.compile("^127\.\d{1,3}\.\d{1,3}\.\d{1,3}$")
         priv_24 = re.compile("^10\.\d{1,3}\.\d{1,3}\.\d{1,3}$")
         priv_20 = re.compile("^192\.168\.\d{1,3}.\d{1,3}$")
         priv_16 = re.compile("^172.(1[6-9]|2[0-9]|3[0-1]).[0-9]{1,3}.[0-9]{1,3}$")

         res = priv_lo.match(ip) or priv_24.match(ip) or priv_20.match(ip) or priv_16.match(ip)
         return res is not None 
    ```

这不会是 100.xxx 范围，在 kubernetes 内部使用

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-03T07:23:27.437

在问了这个问题几天后，我发现了这个 Google 项目[ipaddr-py](http://code.google.com/p/ipaddr-py/source/browse/trunk/ipaddr.py)`is_rfc1918` ，它在确定地址是否为私有 ( )方面似乎具有一些相同的功能。显然这将是 Python 3.1 中的标准。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-09-23T08:53:01.410

我在 cuckoo 中找到了这个[。](https://github.com/wmetcalf/cuckoo-master/blob/master/modules/processing/network.py)不需要安装新模块。只需导入两个内置模块：socket 和 struct。并使用下面的功能。

```
def _is_private_ip(self, ip):
    """Check if the IP belongs to private network blocks.
    @param ip: IP address to verify.
    @return: boolean representing whether the IP belongs or not to
             a private network block.
    """
    networks = [
        "0.0.0.0/8",
        "10.0.0.0/8",
        "100.64.0.0/10",
        "127.0.0.0/8",
        "169.254.0.0/16",
        "172.16.0.0/12",
        "192.0.0.0/24",
        "192.0.2.0/24",
        "192.88.99.0/24",
        "192.168.0.0/16",
        "198.18.0.0/15",
        "198.51.100.0/24",
        "203.0.113.0/24",
        "240.0.0.0/4",
        "255.255.255.255/32",
        "224.0.0.0/4",
    ]

    for network in networks:
        try:
            ipaddr = struct.unpack(">I", socket.inet_aton(ip))[0]

            netaddr, bits = network.split("/")

            network_low = struct.unpack(">I", socket.inet_aton(netaddr))[0]
            network_high = network_low | 1 << (32 - int(bits)) - 1

            if ipaddr <= network_high and ipaddr >= network_low:
                return True
        except Exception,err:
            continue

    return False 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-28T08:33:51.800

如果你想避免导入一个模块，你可以应用一个简单的正则表达式：

*   ^127.\d{1,3}.\d{1,3}.\d{1,3}$
*   ^10.\d{1,3}.\d{1,3}.\d{1,3}$
*   ^192.168.\d{1,3}$
*   ^172.(1[6-9]|2[0-9]|3[0-1]).[0-9]{1,3}.[0-9]{1,3}$

# windows - 在 for 循环中初始化的批处理文件变量

> ID：691047
> 
> 赞同：17
> 
> 时间：2009-03-27T18:52:11.370
> 
> 标签：windows, batch-file

我有一个批处理文件，它通过 SET 在 for 循环中初始化变量，用于磁盘上的一组文件：

```
for %%f in (%MYTARGETDIR%\*config.xml) do (
  SET TMPFILE=%%F.tmp

  echo In loop %TMPFILE%
)

echo End loop %TMPFILE% 
```

当我在全新的命令外壳（未定义 TMPFILE）中运行它时，循环回显为空，但结束循环回显不是。

当我第二次运行时，它已经设置并输出它的值，忽略设置直到循环关闭。

想法为什么会这样，解决方法是什么？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-27T19:14:41.190

作为记录，更正后的脚本如下所示：

```
setlocal ENABLEDELAYEDEXPANSION

for %%f in (%MYTARGETDIR%\*config.xml) do (

  SET TMPFILE=%%F.tmp

  echo In loop !TMPFILE!
)

echo End loop %TMPFILE% 
```

感谢克里斯的帮助。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-03-27T19:16:02.763

*这是因为在读取*命令时会替换环境变量。对于以下命令：

```
for %%f in (%mytargetdir%\*config.xml) do (
    set tmpfile=%%f.tmp
    echo In loop %tmpfile%
) 
```

整个命令（从`for`到右括号）在执行前被读取和替换。

您需要使用延迟扩展，例如：

```
@echo off
    setlocal enableextensions enabledelayedexpansion
    set full=/u01/users/pax
:loop1
    if not "!full:~-1!" == "/" (
        set full2=!full:~-1!!full2!
        set full=!full:~,-1!
        goto :loop1
    )
    echo !full!
    endlocal 
```

当您启用延迟扩展时，`"%"`标记仍然像以前一样工作，但您可以使用`"!"`标记进行延迟扩展。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-27T19:01:07.213

这是因为 ( ) 块只解析一次，它在运行循环之前替换了 %TMPFILE% 。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-29T02:14:59.033

您也可以使用[CALL SET](http://www.ss64.com/nt/call.html#advanced)代替延迟扩展。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-07-05T00:48:17.470

通常，我使用 /e:on 和 /v:on 开关调用 CMD.EXE 以启用命令扩展和延迟变量扩展。然后对我使用的任何批处理脚本进行编码，以检查延迟变量扩展是否已打开。

这是我第一次听说 SETLOCAL 接受参数。我用 SETLOCAL /? 果然！这对我来说是这样一个时间和代码保护程序。

但是，我确实注意到必须在 CMD.EXE 中启用命令扩展，然后 SETLOCAL 才能识别 ENABLEDELAYEDEXPANSION 选项。这是来自 SETLOCAL /? 的输出

```
If Command Extensions are enabled SETLOCAL changes as follows:

SETLOCAL batch command now accepts optional arguments:
        ENABLEEXTENSIONS / DISABLEEXTENSIONS
            enable or disable command processor extensions. These
            arguments takes precedence over the CMD /E:ON or /E:OFF
            switches. See CMD /? for details.
        ENABLEDELAYEDEXPANSION / DISABLEDELAYEDEXPANSION
            enable or disable delayed environment variable
            expansion. These arguments takes precedence over the CMD
            /V:ON or /V:OFF switches. See CMD /? for details. 
```

谢谢你们俩的宝贵答案。

# version-control - Monotone - 仅拉取存储库的最新版本

> ID：691050
> 
> 赞同：2
> 
> 时间：2009-03-27T18:53:16.763
> 
> 标签：version-control, revision, monotone

我有一个我想从中提取的远程单调存储库，但我真的只需要最新版本（不，不需要历史记录。是的，我确定。而且我真的不想等待一个小时 -获得完整历史记录需要一半）。

有没有一种快速简便的方法可以做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-09-01T19:33:50.123

monotone 是一个版本控制系统，它的主要原因是开发人员使用它来实际管理历史记录，而不是用户获取每晚的压缩包......所以，即使很难，它肯定是一个有用的功能，你想要的是尚未实现。当然，许多网站确实提供了每晚的 tarball，但这与他们使用的特定版本系统无关，更多的是`cron`他们已经放置了一些脚本（对于单调托管的项目也可以很容易地完成这些） ，即使是实时的，也可以使用服务器端的钩子，例如在上传新版本后立即更新[单调网站本身的钩子）。](http://monotone.ca/)

OTOH，如果您想要对一组不完整的修订（针对开发人员，而不是静态 tarball）进行“真正的检查”，您想要的是未来的功能，在单调的术语中称为[partial pull](http://www.monotone.ca/wiki/PartialPull/)。

如果你真正的意思是，是的，你也想拥有历史，但只是出于性能原因试图避免这种情况，那仍然是一个不同的问题......主要原因是“mtn pull” （或“mtn sync”的提取部分）并不意味着“我想下载东西”，而是真正的意思是“我想下载东西并加密检查它的每一位，这样我就确定没有不受信任的数据出现在我的本地数据库中”，当然，加密检查每一位都需要一些时间......是的，“不检查就拉，我稍后会做'mtn检查'”在这里可能会有所帮助。

我确实同意，对于真正只想​​下载当前版本的“即时 tarball”的用户来说可能是有用的，而对于对过去历史不太感兴趣的开发人员来说，部分拉取或“快速未经检查的拉取”可能是一个有趣的功能。不幸的是，单调的贡献者到目前为止还没有编写这些功能。任何帮助表示赞赏。;-)

# c# - 关于 C# 中反射的快速问题

> ID：691073
> 
> 赞同：0
> 
> 时间：2009-03-27T19:01:02.487
> 
> 标签：c#, reflection, nunit

我开始使用测试驱动开发的概念，并且有点失败，因为我发现我知道测试将是什么，但我不知道如何让它做我想做的事. 我所拥有的是一个具有`public`getter 和`internal`setter 的属性。我想通过`internal`从单元测试中访问设置器来测试功能，但我不知道该怎么做。这是测试：

```
 [Test()]
    public void HandleInput() {
        _requestType = _request.GetType();
        PropertyInfo propStdin =
            _requestType.GetProperty("StandardInput", BindingFlags.Public | BindingFlags.NonPublic);
        if(propStdin == null) {
            // Bug in the test.
            throw new Exception("There is a bug in the test. Reflection of stdin property returned null.");
        }
        MethodInfo setStdin = propStdin.GetSetMethod();

        // This will fail at the moment since nothing is here to make this happen.
        Assert.AreEqual("NewInputNewRequestInput", _request.StandardInput);
    } 
```

现在，问题是当我运行测试时，我得到：

```
[mono-2.4] mbt@zest:~/Projects/StaffASAP/Test.FastCGI/bin/Debug$ nunit-console2 Test.FastCGI.dll
NUnit version 2.4.8
Copyright (C) 2002-2007 Charlie Poole.
Copyright (C) 2002-2004 James W. Newkirk, Michael C. Two, Alexei A. Vorontsov.
Copyright (C) 2000-2002 Philip Craig.
All Rights Reserved.

Runtime Environment - 
   OS Version: Unix 2.6.29.0
  CLR Version: 2.0.50727.1433 ( Mono 2.4 )

..F
Tests run: 2, Failures: 1, Not run: 0, Time: 0.111 seconds

Test Case Failures:
1) Test.FastCGI.tRequest.HandleInput : System.Exception : There is a bug in the test. Reflection of stdin property returned null.
at Test.FastCGI.tRequest.HandleInput () [0x00051] in /home/mbt/Projects/StaffASAP/Test.FastCGI/tRequest.cs:54
at (wrapper managed-to-native) System.Reflection.MonoMethod:InternalInvoke (object,object[],System.Exception&)
at System.Reflection.MonoMethod.Invoke (System.Object obj, BindingFlags invokeAttr, System.Reflection.Binder binder, System.Object[] parameters, System.Globalization.CultureInfo culture) [0x00057] in /media/disk/mono-2.4/sources/mono-2.4/mcs/class/corlib/System.Reflection/MonoMethod.cs:159 
```

所以，我一定是在尝试错误地访问该属性，但是通过查看文档，我不知道我做错了什么。我*在*做什么错？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-27T19:23:45.257

你失踪了| GetProperty(...) 调用中的 BindingFlags.Instance？

但是，通过 InternalsVisibleTo 属性向测试程序公开内部变量会更好，因为您不需要依赖反射，并且如果测试项目是 Visual Studio 中解决方案的一部分，重构将传播。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T19:06:44.063

您可能想查看[`InternalsVisibleTo`](http://geekswithblogs.net/jwhitehorn/archive/2007/11/09/116750.aspx)程序集属性：

> [Y]您可以将程序集的内部方法/属性/类公开给“朋友”程序集。通常内部结构只能由同一程序集的成员访问，并且通常用于隐藏“管道”方法和实用程序类。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T19:07:17.603

[这是关于 SO 的类似文章](https://stackoverflow.com/questions/171332/accessing-internal-members-via-system-reflection)，涉及单元测试、内部成员和反射。

# c++ - C++ 有标准的#include 约定吗？

> ID：691079
> 
> 赞同：17
> 
> 时间：2009-03-27T19:03:14.447
> 
> 标签：c++, include

这是一个相当基本的问题，但它困扰了我一段时间。

我的项目有一堆 .cpp（实现）和 .hpp（定义）文件。

我发现当我添加额外的类和更多的类间依赖关系时，我必须#include 其他头文件。一两个星期后，我在很多地方都使用了#include 指令。稍后，我将尝试删除一些#include，并发现一切仍然有效，因为一些其他包含的类也是#include 我刚刚删除的内容。

**是否有一个简单易行的规则来添加#includes，可以从一开始就阻止这种丑陋的混乱发生？最佳做法是什么？**

例如，我从事的项目中，实施 .cpp 文件仅包含相应的定义 .hpp 文件，没有其他内容。如果有任何其他 .hpp 文件需要被实现 .cpp 使用，它们都被定义 .hpp 文件引用。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-27T19:07:35.513

一些最佳实践：

*   每个 .cpp 或 .C 文件都包含它需要的所有头文件，并且不依赖于包含其他相关头文件的头文件
*   每个 .hpp 或 .h 文件都包含其所有依赖项，并且不依赖包含的头文件，包括其他相关头文件
*   每个标题都包含：

    ```
    #ifndef HEADER_XXX_INCLUDED
    #define HEADER_XXX_INCLUDED
    ...
    #endif /* HEADER_XXX_INCLUDED */ 
    ```

*   标头在循环中不包含彼此

*   通常：有一个“项目范围的头文件”，如“config.h”或“.h”，它总是*首先*包含在任何 .cpp 或 .C 文件中。通常，这具有平台相关的配置数据、项目范围的常量和宏等。

这些不一定是“最佳实践”，而是我通常遵循的规则：

*   项目特定的标头包含`#include "..."`在系统范围标头之前和之前，系统范围标头包含为`#include <...>`
*   项目特定的标题*按字母*顺序包含，以确保没有意外的隐藏要求，它们包含的顺序。由于每个标头都应包含其依赖项*，并且*标头应防止多次包含，因此您应该能够以您希望的任何顺序包含它们。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-27T22:13:33.583

查看 John Lakos 的大型 C++ 软件设计。这是我遵循的（作为示例编写）：

### 界面

```
// foo.h
// 1) standard include guards.  DO NOT prefix with underscores.
#ifndef PROJECT_FOO_H
#define PROJECT_FOO_H

// 2) include all dependencies necessary for compilation
#include <vector>

// 3) prefer forward declaration to #include
class Bar;
class Baz;
#include <iosfwd> // this STL way to forward-declare istream, ostream

class Foo { ... };
#endif 
```

### 执行

```
// foo.cxx
// 1) precompiled header, if your build environment supports it
#include "stdafx.h"

// 2) always include your own header file first
#include "foo.h"

// 3) include other project-local dependencies
#include "bar.h"
#include "baz.h"

// 4) include third-party dependencies
#include <mysql.h>
#include <dlfcn.h>
#include <boost/lexical_cast.hpp>
#include <iostream> 
```

### 预编译头文件

```
// stdafx.h
// 1) make this easy to disable, for testing
#ifdef USE_PCH

// 2) include all third-party dendencies.  Do not reference any project-local headers.
#include <mysql.h>
#include <dlfcn.h>
#include <boost/lexical_cast.hpp>
#include <iosfwd>
#include <iostream>
#include <vector>
#endif 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-27T19:08:57.570

我总是使用最小耦合原则。如果当前文件确实需要它，我只包含一个文件；如果我可以使用前向声明而不是完整定义，我将使用它。我的 .cpp 文件顶部总是有一堆#include。

酒吧.h：

```
class Foo;

class Bar
{
    Foo * m_foo;
}; 
```

酒吧.cpp：

```
#include "Foo.h"
#include "Bar.h" 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-27T19:08:43.200

仅使用所需的最少数量的包含。无用的包括减慢编译速度。

此外，如果您只需要指向一个类，则不必包含标题。在这种情况下，您可以只使用前向声明，例如：

```
class BogoFactory; 
```

编辑：只是为了说清楚。当我说最低金额时，我并不是说构建包括链，例如：

```
a.h
#include "b.h"

b.h
#include "c.h" 
```

如果 ah 需要 ch，当然需要将其包含在 ah 中，以防止出现维护问题。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-27T19:57:00.607

C/C++ 中使用的#include 模型存在几个问题，主要问题是它没有表达实际的依赖关系图。相反，它只是以特定顺序连接一堆定义，通常导致定义在每个源文件中以不同的顺序出现。

通常，您需要了解软件的包含文件层次结构，就像了解数据结构一样；您必须知道从哪里包含哪些文件。阅读您的源代码，了解哪些文件在层次结构中处于较高位置，这样您就可以避免意外添加包含，以便“从任何地方”包含它。当您添加新的包含时，请仔细考虑：**我真的需要在此处包含它吗？** **当我这样做时，还会绘制哪些其他文件？**

两个可以提供帮助的约定（除了已经提到的约定）：

*   一个类 == 一个源文件 + 一个头文件，一致命名。A 类进入 A.cpp 和 Ah 代码模板和代码片段在这里很好，可以减少在单独文件中声明每个类所需的输入量。
*   使用 Impl 模式来避免在头文件中暴露内部成员。impl 模式意味着将所有内部成员放在 .cpp 文件中定义的结构中，并且在类中只有一个带有前向声明的私有指针。这意味着头文件只需要包含其公共接口所需的那些头文件，并且其内部成员所需的任何定义都将被排除在头文件之外。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-27T19:17:02.933

基于 antti.huima 所说的：

假设你有 A、B 和 C 类。A 依赖于（包含）B，A 和 B 都依赖于 C。有一天你发现你不再需要在 A 中包含 C，因为 B 为你做了，所以你删除了那个`#include`声明。

现在，如果您在将来某个时候更新 B 以不再使用 C，会发生什么情况？突然间，A 无缘无故坏了。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-27T21:19:27.537

在 A.cpp 中，始终首先包含 Ah，以确保 Ah 没有额外的依赖项。在所有系统文件之前的所有项目文件之前包含所有本地（相同模块）文件，再次确保没有任何东西依赖于预包含的系统文件。尽可能使用前向声明。使用#indef/#define/#endif 模式如果Ah 中包含头文件，则无需将其包含在A.cpp 中。必须明确包含 A.cpp 需要的任何其他标头，即使它们碰巧由其他 .h 文件提供。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-27T21:44:01.597

[用 C 和 C++ 组织代码文件](http://www.gamedev.net/reference/articles/article1798.asp)：

# nhibernate - 使用 NHibernate SchemaExport 将标识种子设置为 0

> ID：691080
> 
> 赞同：0
> 
> 时间：2009-03-27T19:03:43.090
> 
> 标签：nhibernate, nhibernate-mapping

我使用 NHibernate 中的 SchemaExport 类从我的 .hbm.xml 文件生成我的数据库。有没有办法将我的表上的身份种子设置为 0 而不是 1？对于 ref 表，我更喜欢将所有初始状态 id 设置为 0，并且我不希望每次在开发中重新生成数据库时都必须重置此值。我正在使用 SQL Server 2005，NHibernate 版本 1.2.1。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-30T16:24:42.680

如果可能，最好不要在 NHibernate 中使用 Identity 列；它们导致 NHibernate 对数据库进行更多的访问，使批处理变得不可能，并从根本上打破了工作单元模式。[这在nhibernate.info](http://nhibernate.info)和一些类似的[博客文章](http://devlicio.us/blogs/tuna_toksoz/archive/2009/03/20/nhibernate-poid-generators-revealed.aspx)中进行了讨论。Guid.comb 或 Hi-Lo 通常是更好的选择。

如果你真的想继续使用 Identity，并让它从 0 开始，那么这里有一些可能性（未经测试）。

只是一个猜测，但你可能需要首先设置你的`unsaved-value="-1"`：

这允许 NHibernate 知道 -1 的标识意味着对象没有被保存（瞬态）。

您还需要确保所有实体 id 的默认值也为 -1（数字显然默认为 0）：

```
public class Order {
    public virtual long Id{get; private set;}
    public Order(){
      Id = -1;
    }
} 
```

真是太棒了！然后就是弄清楚如何让 SchemaExport 从 0 开始作为种子。它可能已经这样做了（通过使用未保存的值 +1 作为种子）？检查它是否有效。如果没有，那么您可能需要查看修补它或覆盖 hbm.xml。一种方法是使用 XSLT 转换生成的 HBM 文件。再一次，非常讨厌。

# java - 在 Java 中缓存从输入流中读取的图像的最佳实践

> ID：691081
> 
> 赞同：1
> 
> 时间：2009-03-27T19:04:11.917
> 
> 标签：java

我有一个 servlet，它充当通过从 HttpURLConnection 输入流中读取图像作为字节然后将字节写入响应输出流来获取图像的代理。这是相关的代码片段：

```
HttpURLConnection connection = (HttpURLConnection)url.openConnection();
connection.setConnectTimeout(CONNECT_TIMEOUT);
connection.setReadTimeout(READ_TIMEOUT);

InputStream in = connection.getInputStream();
OutputStream out = resp.getOutputStream();

byte[] buf = new byte[1024];
int count = 0;
while ((count = in.read(buf)) >= 0) {
  out.write(buf, 0, count);
} 
```

我想开始在代理 servlet 中缓存图像。我正在考虑包装字节数组并存储在 Map 中，但我怀疑有更好的方法。我注意到了 javax.imagio 包，但我没有使用它的经验，也不确定它在这里是否相关。具体来说，我正在寻找关于如何存储图像而不是缓存机制的想法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T19:15:11.097

如果您只缓存图像，我建议将图像保留为字节数组，而不是图像。使用 imageio 读取图像会解压缩图像，它们会占用更多的内存空间。

WeekHashMap 类可能是缓存内容的最简单方法，但您几乎无法控制从其中逐出条目的方式。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T19:16:54.133

在某些有限的情况下，哈希映射可以工作。但是你需要考虑：

(1) 当缓存“满”时，您将如何从内存中清除缓存的图像（无论您如何定义——可能是您想要用于缓存的最大内存量）。(2) 你将如何处理并发。(3) 与此相关，您将如何处理客户端 A 请求图像，然后客户端 B 请求相同图像的情况，而该图像仍在为客户端 A 加载到缓存中。

(1) 的一个非常简单的解决方案可能是始终将 SoftReference 存储到图像数据中，并让 JVM 负责决定何时清除它们（请记住，它有时可能会在您无法控制的情况下任意清除它们）。否则，您需要制定某种策略（首先，访问时间最长的图像、最小/最大图像等，如果我们必须再次加载图像将需要最长时间解码等）——只有您知道您的数据和使用情况，所以你必须找到正确的策略。

对于（2），[ConcurrentHashMap](http://www.javamex.com/tutorials/synchronization_concurrency_8_hashmap2.shtml)一般会帮你解决；您可能会决定在更奇特的情况下使用显式锁和其他并发实用程序。

对于 (3)，Goetz 等人提出的一个相当优雅的解决方案是劫持 Future 类。在您的地图中，您将 Future 存储到缓存对象（或“缓存条目”对象）。如果请求者发现一个 Future 已经添加到地图中，那么它可以调用 get() 并等待其他线程完成缓存数据。（您可以通过显式锁定和条件实现类似的效果，但 Future 会为您完成一些工作。）

PS 我同意发帖人的说法，他说您可能希望以原始编码形式存储图像。但是从您的代码中，我假设这可能是您一直以来的意图。

# c# - SslStream.DataAvailable 不是一个有效的函数

> ID：691085
> 
> 赞同：4
> 
> 时间：2009-03-27T19:05:49.293
> 
> 标签：c#, .net, ssl, msdn

我正在将 C# 代码从使用 NetworkStream 迁移到 SSLStream，但是在使用 stream.DataAvailable 的地方出现错误：

> 错误 1“System.Net.Security.SslStream”不包含“DataAvailable”的定义，并且找不到接受“System.Net.Security.SslStream”类型的第一个参数的扩展方法“DataAvailable”（您是否缺少使用指令还是程序集引用？）

现在我的本地 MSDN 副本不包括 DataAvailable 作为 SslStream 的成员，但是[http://msdn.microsoft.com/en-us/library/dd170317.aspx](http://msdn.microsoft.com/en-us/library/dd170317.aspx)说它确实有成员 DataAvailable。这是我的代码的副本。

```
using System;
using System.Collections;
using System.Collections.Generic;
using System.Net;
using System.Net.Sockets;
using System.Net.Security;
using System.Security.Authentication;
using System.Security.Cryptography.X509Certificates;
using System.IO;

namespace Node
{

  public static class SSLCommunicator
  {
    static TcpClient client = null;
    static SslStream stream = null;
    static List<byte> networkStreamInput = new List<byte>();
    public static void connect(string server, Int32 port)
    {
        try
        {
          client = new TcpClient(server, port);
          stream = new SslStream(client.GetStream(),false);
    ...
    ...
    ...
    public static List<DataBlock> getServerInput() 
    {
      List<DataBlock> ret = new List<DataBlock>();
      try
      {
      //check to see if stream is readable.
      if (stream.CanRead)
      {
        //Check to see if there is data available.
        if (stream.DataAvailable)
        {
          byte[] readBuffer = new byte[1024];
          int numberOfBytesRead = 0;
          //while data is available buffer the data.
          do
          {
            numberOfBytesRead = stream.Read(readBuffer, 0, readBuffer.Length);
            byte[] tmp = new byte[numberOfBytesRead];
            Array.Copy(readBuffer, tmp, numberOfBytesRead);
            networkStreamInput.AddRange(tmp);
          } while (stream.DataAvailable);
     ... 
```

此外，如果您有更好的方法将流的输出放入托管数组（稍后将在代码中对其进行一些解析），我会很乐意提供帮助。我正在使用 Visual Studio 2008

--EDIT 我刚刚意识到我链接到嵌入式SDK，这不是嵌入式系统，那么我如何查看普通.net SDK中的数据是否可用？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T19:23:18.610

您正在查看的页面适用于 .NET Micro Framework。

根据[.Net 2.0](http://msdn.microsoft.com/en-us/library/system.net.security.sslstream_properties(VS.80).aspx)的[此页面和 .Net 3.5 的此页面，](http://msdn.microsoft.com/en-us/library/system.net.security.sslstream_properties.aspx) SSLStream 上没有 DataAvailable 属性。

编辑：你不能只打电话 Read() 看看你是否得到任何回报？我不认为这会阻止。

# c# - 是否可以在 Web 服务调用时在客户端机器上创建 cookie？

> ID：691086
> 
> 赞同：2
> 
> 时间：2009-03-27T19:06:14.050
> 
> 标签：c#, .net, web-services, cookies

我有一个窗口应用程序，它调用 Web 服务来获取信息。窗口应用程序的功能之一是转到网页。在此网页中，它在客户端机器上寻找 cookie，如果 cookie 有效，则将它们登录。

我试图做的是在 Web 服务调用上创建相同的 cookie。然而，这个 cookie 在服务调用完成后消失了，所以下次我再次调用 Web 服务时，它就消失了。（出于测试目的），它不再在客户端机器中了。

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T19:08:32.327

在客户端上，您应该手动存储 cookie 值，然后在下一次服务调用中重用它。

```
// C#, you have to create a Cookie Container
myService.CookieContainer = new System.Net.CookieContainer(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T19:16:36.897

我不认为这是可能的，特别是如果您不能确定要启动什么网络浏览器。

您最好向他们发送带有来自 Web 服务的 URL 的一次性令牌，以便他们进入网站。然后该站点可以设置 cookie，就好像他们已登录一样。

如果其中任何一个在您的模型中是可行的。我不知道您是否有权访问向他们发送 URL 的站点。

# c# - 在 C# 中合理使用线程？

> ID：691093
> 
> 赞同：5
> 
> 时间：2009-03-27T19:07:10.710
> 
> 标签：c#, multithreading

作为大型自动化过程的一部分，我们正在调用第三方 API，该 API 在另一台机器上调用服务来完成一些工作。我们最近发现，每隔一段时间，当另一台机器不可用时，API 调用有时会在尝试连接到远程服务器时停止长达 40 分钟。

我们使用的 API 没有提供指定超时的方法，而且我们不希望我们的程序等待那么久，所以我认为线程是强制超时的好方法。生成的代码如下所示：

```
 Thread _thread = new Thread(_caller.CallServices());

 _thread.Start();
 _thread.Join(timeout);

 if (_thread.IsAlive)
 {
      _thread.Abort();
      throw new Exception("Timed-out attempting to connect.");
 } 
```

基本上，我想让 APICall() 运行，但如果超时后它仍然在运行，假设它会失败，杀死它并继续前进。

由于我是 C# 和 .net 运行时线程的新手，我想我会问两个相关的问题：

对于我正在尝试做的事情，.net 库中是否有更好/更合适的机制，并且我是否在那段代码中提交了任何线程陷阱？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T19:18:46.033

Thread.Abort() 是对线程中止的请求，并且不保证它会及时这样做。这也被认为是不好的做法（它会在中止的线程中引发线程中止异常，但似乎 3rd 方 API 没有为您提供其他选择。

如果您（以编程方式）知道远程服务主机的地址，则应在将控制权转移到第 3 方 API 之前对其进行 ping 操作。

如果不使用 backgroundworker，您可以将线程的 IsBackgroundThread 设置为 true，这样它就不会阻止您的程序终止。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-27T19:17:23.400

馊主意。Thread.Abort 不一定会清理这种中断的 API 调用留下的烂摊子。

如果调用成本很高，请考虑编写一个单独的 .exe 进行调用，并使用命令行或临时文件将参数传入/传出它。您可以比终止线程更安全地终止 .exe。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-27T19:21:16.010

您也可以只使用委托...为完成工作的方法创建一个委托，然后在委托上调用 BeginInvoke，将参数传递给它，并使用一个回调函数来处理返回值（如果需要）...在 BeginInvoke 之后，您可以立即等待异步委托完成的指定时间，如果在指定时间内没有完成，请继续...

```
 public delegate [ReturnType] CallerServiceDelegate
          ([parameter list for_caller.CallService]);

   CallerServiceDelegate callSvcDel = _caller.CallService;
   DateTime cutoffDate = DateTime.Now.AddSeconds(timeoutSeconds);
   IAsyncResult aR = callSvcDel.BeginInvoke([here put parameters], 
                                             AsynchCallback, null); 
   while (!aR.IsCompleted && DateTime.Now < cutoffDate)
       Thread.Sleep(500);
   if (aR.IsCompleted)
   {
      ReturnType returnValue = callSvcDel.EndInvoke(aR);
      // whatever else you need to do to handle success
   }
   else
   {
      callSvcDel.EndInvoke(aR);
      // whatever you need to do to handle timeout
   } 
```

注意：所写的 AsynchCallback 可能为空，因为代码从 EndInvoke() 检索返回值，但如果您愿意，您可以让 CallService() 方法调用 AsynchCallback 委托并将返回值传递给它...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T19:19:22.693

它可能有效，但如果不了解第三方 API，没有人可以肯定地说。像这样中止线程可能会使组件处于某种无效状态，它可能无法从中恢复，或者它可能不会释放它分配的资源（想想 - 如果你的一个例程中途停止执行怎么办？ . 你能对你的程序所处的状态做出任何保证吗？）。

正如 Cicil 建议的那样，首先 ping 服务器可能是个好主意。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-27T19:40:08.867

您的应用程序是长时间运行还是更像是按需运行的应用程序？如果是后者，我个人会考虑使用 Thread.Abort() 选项。虽然从纯粹主义者的角度来看（资源管理等），它可能不是最理想的，但它确实很容易实现，并且可能会根据您的特定应用程序的工作方式买单。

单独的可执行文件的想法是有道理的。也许另一种选择是使用 AppDomains。我不是这方面的专家（我欢迎对此进行改进/更正），但据我了解，您会将 API 调用放在单独的 DLL 中并将其加载到单独的 AppDomain 中。当 API 调用完成或您必须中止它时，您可以将 AppDomain 与 DLL 一起卸载。这*可能*具有清理简单 Thread.Abort() 不会清理的资源的额外好处。

# asp.net - 如何更改 web.config 文件的名称并让 IIS 从新命名的文件中读取？

> ID：691103
> 
> 赞同：2
> 
> 时间：2009-03-27T19:09:41.357
> 
> 标签：asp.net, iis, web-config

是否可以将 IIS 站点配置为从 web.config 以外的站点读取 ASP.Net 设置？

我们希望在我们的代码库中有三个配置文件——web-dev.config、web-test.config 和 web-prod.config。每个 IIS 实例都将配置为从其特定文件中读取。通过这种方式，我们可以对它们进行版本控制（并一键部署整个站点），但知道每个 IIS 实例都会读取特定于自身的设置。

我在 IIS 中找到了它显示 web.config 的位置，但我看不到如何更改位置。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-27T19:40:19.117

我使用 configSource 属性为开发和生产需要不同值的部分指定外部配置文件。

```
<connectionStrings configSource="Config\ConnDev.config"/> 
```

然后，您只需更改一项设置（手动或使用工具）即可从开发配置切换到生产配置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T19:31:47.250

目前最好的解决方案是使用不同的配置进行开发和生产。然而，这将随着 .net 4 和 VS 2010 的变化而改变，它们添加了 Web.Debug.config、Web.Release.config、Web.Staging.config 和 Web.Testing.config，然后将发布您需要的与环境。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T19:15:25.480

在我的公司，我们只有部署工具集，可以根据我们正在执行的部署类型将适当的文件复制到 web.config。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T19:20:42.503

我相信它必须命名为 web.config。

你面临一个常见的问题。

我使用过的一个在大型组织中运行良好的解决方案是在 Web 服务器上设置环境变量。如DEV、QA、UAT、PROD。然后，在代码中，您可以查询环境变量以查看您在哪台机器上，然后相应地选择 appSettings 的值。例如，您可以有一个名为 DEVconnection 的数据库连接字符串和另一个名为 UATconnection 的数据库连接字符串。如果您的代码根据环境变量确定您在 UAT 上，那么它将使用 UATconnection。

这确实假设您能够在 Web 服务器上设置环境变量。在这种情况下，运行服务器的管理员是建议此解决方案的人。

这样做的好处是只有一个版本的 web.config。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-02-19T11:20:42.897

我认为我们不能以声明方式制作 web.config 以便我们可以指定不同的配置文件。您可以做的一件事是拆分配置文件并针对不同的环境进行设置。请阅读这篇文章 [http://jetmathew.wordpress.com/2011/02/07/split-web-config-for-different-environment/](http://jetmathew.wordpress.com/2011/02/07/split-web-config-for-different-environment/)

干杯

# c# - 来自 asp.net 2.0 的 REST

> ID：691111
> 
> 赞同：13
> 
> 时间：2009-03-27T19:12:12.413
> 
> 标签：c#, .net, wcf, rest

我刚刚建立了一个asp.net 2.0 网站。现在我需要添加 REST Web 服务，以便与另一个 Web 应用程序进行通信。我以前使用过 2 个 SOAP Web 服务项目，但对 REST 完全没有经验。我想只有几个星期就可以了。谷歌搜索后，我发现这并不容易。

这是我发现的：

没有 REST 开箱即用的 asp.net。

[WCF REST Starter Kit Codeplex Preview 2](http://go.microsoft.com/?linkid=9653247)基于 .net 3.5，仍处于测试阶段

[休息 ASP.NET 示例](http://intertwingly.net/wiki/pie/RestAspNetExample)

[ASP.NET 2.0 (C#) 中的 REST Web 服务](http://www.codeproject.com/KB/aspnet/RestServicesInASPNET2.aspx)

[埃克尤斯](http://exyus.com/)

[使用 Lullaby 处理 POST 和 PUT 方法](http://ryanolshan.com/technology/handling-post-and-put-methods-with-lullaby/)

[ADO.NET 数据服务](http://msdn.microsoft.com/en-us/data/bb931106.aspx)

...

现在我的问题，

a) 是 .net 2.0 的 REST 解决方案吗？如果是，哪一个是最好的解决方案？

b) 如果必须，将我的 asp.net 从 2.0 迁移到 3.5 有多难？它是像编译一样简单，还是我必须更改很多代码？

c) WCF REST Starter Kit 是否足以在生产中使用？

d) 我是否必须先学习 WCF，然后再学习 WCF REST Starter Kit？最好的起点在哪里？

我很感激这里的任何帮助。

谢谢韦斯

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-27T19:47:36.557

如果您正在寻找一个模板化 REST 服务的项目，那么您说没有开箱即用的解决方案是正确的。但是，使用 WCF 可以实现 RESTful Web 服务。关键部分是在定义服务函数时使用几个属性，让 .NET 框架知道该函数不需要 SOAP。要使用的主要属性是[WebInvoke](http://msdn.microsoft.com/en-us/library/system.servicemodel.web.webinvokeattribute.aspx)属性。

以下是[developer.com](http://www.developer.com/net/article.php/10916_3695436_2)的示例：

```
[OperationContract]
[WebInvoke(Method = "PUT", UriTemplate = "/admin/post/{id}")]
void UpdatePost(string id, Post post); 
```

上面的代码实际上将在您的 Web 服务的接口中定义。创建 WCF Web 服务项目时会自动创建该界面。该函数的实际代码将放置在用于实现 Web 服务的类中。

查看 developer.com 上的文章以获取完整教程。如果您是 WCF 的新手，一开始可能会觉得不知所措，但在您深入了解它之后，我相信您会开始快速上手。这是文章的链接：http: [//www.developer.com/net/article.php/10916_3695436_1](http://www.developer.com/net/article.php/10916_3695436_1)

要回答您的所有问题，

a) 在 .NET 2.0 中，您应该能够使用[WSE2.0](http://www.microsoft.com/downloads/details.aspx?familyid=fc5f06c5-821f-41d3-a4fe-6c7b56423841&displaylang=en)构建 RESTful 服务，但是如果您可以选择使用 .NET 3.5，我强烈建议您走 WCF 路线，因为它更容易并且是用 REST 设计的心里。

b) 转换您的项目一点也不难。只需在项目设置中定位新版本的框架即可。不过，将 Web 服务从 WSE2.0 服务转换为 WCF 服务会有点棘手。最简单的方法是将代码从每个不同的 Web 服务函数复制到实现新版本函数的类中。复制粘贴 shinanigans :)

c) 我不确定您所指的这个入门套件是什么。从 3.5 开始完全发布的 WCF 应完全支持 RESTful Web 服务

d) 至少在开始之前了解一点 WCF 会有所帮助，但为了开始完全了解它并不是至关重要的。我建议至少阅读[有关 WCF 的 MSDN 文章一次，然后开始工作。](http://msdn.microsoft.com/en-us/library/ms731082.aspx)我相信您在开始时会遇到其他问题，但是您可以在遇到这些部分时查找它们。

无论如何，我希望这些信息有所帮助。祝你好运。

**编辑**

REST 世界已经进行了一些改进。正如 Darrel Miller 在评论中提到的，WCF 实际上并不是在构建时考虑到 REST。我之前说错了。事实上，该框架是在考虑 SOAP 的情况下构建的，而 WebInvoke 属性填补了这一空白。尽管围绕该主题（Web API 与 WCF REST）存在很多争论，但 ASP.NET Web API 是在 .NET 中构建 REST 服务的新选项。我强烈建议任何阅读这篇文章并能够在他们的项目中使用 .NET 4.5 的人将其作为一种选择。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-24T12:57:13.220

如果你想要一个使用 REST 构建的框架，你应该看看 OpenRasta...

[http://openrasta.org/](http://openrasta.org/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-27T19:30:09.407

您可以将 ASP.NET MVC 用作 RESTful Web 服务平台。从长远来看，WCF 可能是要走的路，但 MVC 应该很容易处理它。您的操作只需设置为返回 JSON 或 XML，具体取决于您希望如何对其进行序列化。MVC 提供 JsonResult 和完全可定制的 ContentResult —— 即，您将响应序列化到结果上的字符串属性并设置它的类型和编码。

**注意**：MVC 确实需要 3.5 SP1，因此它不会是 2.0 解决方案。如果您需要 2.0，则需要寻找其他地方。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-31T20:43:37.277

使用 WCF REST。

您今天可以使用它。WCF REST 库已准备就绪，可用于生产。

WCF 入门工具包（请参阅[http://msdn.microsoft.com/en-us/netframework/cc950529.aspx](http://msdn.microsoft.com/en-us/netframework/cc950529.aspx)）是另一回事。它提供了额外的东西；它包括一组 VS 项目模板、文档、示例和一些用于使用 WCF 构建 REST 应用程序（客户端或服务器）的工具。一个很酷的工具是 Visual Studio 的“将 Xml 粘贴为类型”命令加载项。

另一方面，构建一个 REST 客户端，在一般情况下，我建议利用入门工具包 (Microsoft.Http.dll) 中的 HttpClient 程序集。它小巧、简单且有用。即使在初学者工具包的当前“预览”状态下，也是一种低风险和高价值的依赖关系。

如果您只使用单个 REST 服务，则不需要通用 Microsoft.Http.dll 程序集；你可以在一些使用 WebRequest 的代码中完成它所做的所有事情。但是，如果您想要一个更通用、更灵活的类来操作客户端 REST 请求，那么请使用 Microsoft.Http.dll。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-27T19:27:40.537

我不确定 2.0 的 REST 解决方案。因此，我认为 WCF 将成为您必须采用的方式。 [MSDN 对它有很长的介绍](http://msdn.microsoft.com/en-us/library/dd203052.aspx)。

我个人的理念是，如果一项技术仍处于测试阶段，那么我宁愿不将它用于可能成为生产应用程序的东西，所以我会从 WCF 开始，因为它是在 3.0 版本的框架中引入的。

3.0 和 3.5 实际上是对库的更新，但 CLR 仍然是 2.0，因此如果您使用的库在新框架中没有被弃用或更改，那应该没问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-27T19:50:27.593

看看[这个 CodeProject](http://www.codeproject.com/KB/aspnet/RestServicesInASPNET2.aspx)作为起点。这似乎有点...... hacky。现代化到[WCF](http://msdn.microsoft.com/en-us/netframework/aa663324.aspx)会更干净。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-27T22:54:56.200

REST 或 RESTFUL 在 web.config 中将其添加到 System.Web 将启用 http get 和 put.. aka REST-Like... 但不是完全休息。

```
<System.Web>
  <webServices>
            <protocols>
                <add name="HttpSoap"/>
                <add name="HttpPost"/>
                <add name="HttpGet"/>
            </protocols>
        </webServices>
</System.Web> 
```

# sql-server - 如何将 Oracle BLOB 引入 SQL Server？

> ID：691113
> 
> 赞同：0
> 
> 时间：2009-03-27T19:12:59.883
> 
> 标签：sql-server, database, oracle, data-transfer

我有两个数据库：Oracle 10G 和 SQL Server 2000。

在 Oracle 数据库中，我有几个存储为 BLOB 的 MS Word 文档。我需要做的是从 Oracle 中提取文件并将它们放入 SQL Server。我很好奇我是怎么做到的？

我听说过有关 DTS 的一些信息，但不确定这是否值得研究。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T16:16:40.057

在 sql server 2000 中，您对 blob 存储的选择是 binary/varbinary 或 image。如果 blob <=8000bytes，则可以使用 binary/varbinary，当 blob 大于 8000 字节时，应使用 image。

就我个人而言，我会使用 perl DBI 从 oracle 中提取文件并将它们插入到 sql server 中，因为我对 perl 很满意。

您还可以使用 oracle 的 hsodbc 在 oracle 和 sql server 之间建立链接，并尝试从一个到另一个插入数据。

如果您对 sql server 更熟悉，那么 DTS 是一个选择。我不是 sql server 的人，所以我会支持不同的方法。

# mysql - Rails 连接表呈现错误的 sql

> ID：691115
> 
> 赞同：2
> 
> 时间：2009-03-27T19:13:19.040
> 
> 标签：mysql, ruby-on-rails, activerecord

更新：包括模型关系

我在乐队和活动之间有一个多对多连接表（一个活动有很多乐队，一个乐队有很多活动......）

我有一个列出所有事件的主页，以及一个显示过去 7 天更新的事件的最近页面。

有人可以解释为什么最近的方法会生成包含所有连接的完美 sql

```
@events = Event.find(:all, :include => [:venue, :bands], :conditions => {:updated_at => d1..DateTime.now}, :order => 'events.updated_at desc') 
```

主要方法生成可怕的 sql，为每个事件查询带表。

```
@events = Event.find(:all, :include => [:venue, :bands], :order => 'events.day') 
```

他们都使用相同的视图，没有其他处理/查询正在进行。两者之间的唯一区别是 :conditions 参数及其排序所在的列。这真让我抓狂！

抱歉，这是我的模特和他们的关系

事件.rb

```
has_many :event_bands
has_many :bands, :through => :event_bands
belongs_to :venue 
```

带.rb

```
has_many :event_bands
has_many :events, :through => :event_bands 
```

event_bands.rb

```
belongs_to :event
belongs_to :band 
```

最近生成的sql：

```
Processing EventlistController#recent (for 127.0.0.1 at 2009-03-27 14:58:10) [GET]
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m
  [4;36;1mEvent Columns (16.0ms)[0m   [0;1mSHOW FIELDS FROM `events`[0m
  [4;35;1mVenue Columns (15.0ms)[0m   [0mSHOW FIELDS FROM `venues`[0m
  [4;36;1mBand Columns (16.0ms)[0m   [0;1mSHOW FIELDS FROM `bands`[0m
  [4;35;1mEvent Load Including Associations (31.0ms)[0m   [0mSELECT `events`.`id` AS t0_r0, `events`.`is_local` AS t0_r1, `events`.`link` AS t0_r2, `events`.`notes` AS t0_r3, `events`.`band_id` AS t0_r4, `events`.`venue_id` AS t0_r5, `events`.`created_at` AS t0_r6, `events`.`updated_at` AS t0_r7, `events`.`day` AS t0_r8, `events`.`band_list` AS t0_r9, `venues`.`id` AS t1_r0, `venues`.`name` AS t1_r1, `venues`.`link` AS t1_r2, `venues`.`map` AS t1_r3, `venues`.`notes` AS t1_r4, `venues`.`created_at` AS t1_r5, `venues`.`updated_at` AS t1_r6, `bands`.`id` AS t2_r0, `bands`.`name` AS t2_r1, `bands`.`link` AS t2_r2, `bands`.`notes` AS t2_r3, `bands`.`is_local` AS t2_r4, `bands`.`created_at` AS t2_r5, `bands`.`updated_at` AS t2_r6 FROM `events` LEFT OUTER JOIN `venues` ON `venues`.id = `events`.venue_id LEFT OUTER JOIN `event_bands` ON (`events`.`id` = `event_bands`.`event_id`) LEFT OUTER JOIN `bands` ON (`bands`.`id` = `event_bands`.`band_id`) WHERE (`events`.`updated_at` BETWEEN '2009-03-20 14:58:10' AND '2009-03-27 14:58:10') 
```

main生成的sql

```
Processing EventlistController#index (for 127.0.0.1 at 2009-03-27 14:15:47) [GET]
  [4;35;1mSQL (0.0ms)[0m   [0mSET SQL_AUTO_IS_NULL=0[0m
  [4;36;1mEvent Load (0.0ms)[0m   [0;1mSELECT * FROM `events` ORDER BY events.day[0m
  [4;35;1mEvent Columns (15.0ms)[0m   [0mSHOW FIELDS FROM `events`[0m
  [4;36;1mVenue Columns (16.0ms)[0m   [0;1mSHOW FIELDS FROM `venues`[0m
  [4;35;1mVenue Load (0.0ms)[0m   [0mSELECT * FROM `venues` WHERE (`venues`.`id` IN (6,7,8,9,1,2,3,4,5)) [0m
  [4;36;1mEventBand Load (0.0ms)[0m   [0;1mSELECT `event_bands`.* FROM `event_bands` WHERE (`event_bands`.event_id IN (1,24,74,2,75,11,12,3,13,129,76,14,77,78,145,4,146,120,15,130,79,147,5,80,148,144,131,81,132,16,28,82,121,133,83,17,134,84,149,6,18,135,85,122,19,7,136,86,20,9,87,25,137,150,22,138,88,151,124,123,139,89,152,140,90,141,91,8,153,21,142,154,125,143,92,126,10,93,94,155,127,95,128,23,96,97,26,98,99,27,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119)) [0m
  [4;35;1mEventBand Columns (0.0ms)[0m   [0mSHOW FIELDS FROM `event_bands`[0m
  [4;36;1mBand Columns (16.0ms)[0m   [0;1mSHOW FIELDS FROM `bands`[0m
  [4;35;1mBand Load (0.0ms)[0m   [0mSELECT * FROM `bands` WHERE (`bands`.` 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T21:07:53.057

它们生成两个不同 SQL 查询的原因是 Rails 默认尝试优化 SQL 查询以减少连接。当您将条件列表作为查找的一部分包含在需要使用其他表的条件时，那么生成的 SQL 当然必须包含连接。但是，如果您要求做的只是预先填充与您正在检索的对象的关系的对象，那么 Rails 认为执行几个快速查询而不是一个大的慢查询更有效。

请注意，这不会导致 N+1 问题，因为 Rails 会尝试在单个查询中加载所有关联的记录。

# html - 我的 URL 参数在哪里？

> ID：691116
> 
> 赞同：1
> 
> 时间：2009-03-27T19:13:21.270
> 
> 标签：html, iis, asp-classic, vbscript, frames

我有一个用框架制作的旧网页（是的，我知道）。一帧 (letFrame) 正在尝试使用以下锚更新另一帧 (rightFrame)：

```
<a href="foo.asp?myVar=BAR" target=rightFrame> 
```

foo.asp 已经加载到 rightFrame 中，看起来像这样

```
<%@ Language=VBScript %>
<HTML>
<HEAD>
<META NAME="MYNAME" Content="Microsoft Visual Studio 6.0">
</HEAD>
<BODY>
<form target="_self">
<SCRIPT LANGUAGE=vbscript>

    Option Explicit

    dim myURL

    myURL = parent.location.href

<...blahblablah...> 
```

当我打印出`myURL`or的值时，`parent.location.href`我发现参数部分`?myVar=BAR`已经被剥离了。它只是读取`foo.asp`。

IIS 中是否有一些设置可以执行此操作？还是有另一种方法来获取参数部分？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-27T19:19:25.813

看起来你正在抓取父母的网址。试试 window.location.href。

另外.. 在 ASP 中，您应该使用.. Request.Querystring("param")。

# php - PHP 表单复选框

> ID：691128
> 
> 赞同：0
> 
> 时间：2009-03-27T19:16:18.083
> 
> 标签：php, arrays, checkbox

如何在表单中获取 php 复选框的值以在通过电子邮件发送给收件人时显示？我正在学习如何使用 php，但我无法用我生成的表单来解决这个问题。

以下是表单本身的复选框代码：

```
<input type="checkbox" value="Please send me a Travel Planner" name="options[]">
<input type="checkbox" value="Please send me a Visitor Map" name="options[]" />
<input type="checkbox" value="Please sign me up for the email newsletter" name="options[]" /> 
```

现在这是处理它的反馈页面中的表单代码：

```
#<?php
// ------------- CONFIGURABLE SECTION ------------------------

// $mailto - set to the email address you want the form
// sent to, eg
//$mailto       = "youremailaddress@example.com" ;

$mailto = 'xxxxx@xxxxxxxxx.com' ;

// $subject - set to the Subject line of the email, eg
//$subject  = "Feedback Form" ;

$subject = "Request For Visitor Guide" ;

// the pages to be displayed, eg
//$formurl      = "http://www.example.com/feedback.html" ;
//$errorurl     = "http://www.example.com/error.html" ;
//$thankyouurl  = "http://www.example.com/thankyou.html" ;

$formurl = "http://www.example.com/requestform_mtg.php" ;
$errorurl = "http://www.example.com/error.php" ;
$thankyouurl = "http://www.example.com/thankyou.php" ;

$email_is_required = 1;
$name_is_required = 1;
$address_is_required = 1;
$contactname_is_required = 1;
$city_is_required = 1;
$zip_is_required = 1;
$phone_is_required = 1;
$uself = 0;
$use_envsender = 0;
$use_webmaster_email_for_from = 1;
$use_utf8 = 1;

// -------------------- END OF CONFIGURABLE SECTION ---------------

$headersep = (!isset( $uself ) || ($uself == 0)) ? "\r\n" : "\n" ;
$content_type = (!isset( $use_utf8 ) || ($use_utf8 == 0)) ? 'Content-Type: text/plain; charset="iso-8859-1"' : 'Content-Type: text/plain; charset="utf-8"' ;
if (!isset( $use_envsender )) { $use_envsender = 0 ; }
$envsender = "-f$mailto" ;
$name = $_POST['name'] ;
$contactname = $_POST['contactname'] ;
$title = $_POST['title'] ;
$email = $_POST['email'] ;
$address = $_POST['address'] ;
$city = $_POST['city'] ;
$state = $_POST['state'] ;
$zip = $_POST['zip'] ;
$fax = $_POST['fax'] ;
$phone = $_POST['phone'] ;
$mtgname = $_POST['mtgname'] ;
$dates = $_POST['dates'] ;
$attendance = $_POST['attendance'] ;
$guestroom = $_POST['guestroom'] ;
$mtgroom = $_POST['mtgroom'] ;
$timeframe = $_POST['timeframe'] ;
$options = $_POST['options'] ;
$comments = $_POST['comments'] ;
$http_referrer = getenv( "HTTP_REFERER" );

if (!isset($_POST['email'])) {
    header( "Location: $formurl" );
    exit ;
}
if (($email_is_required && (empty($email) || !ereg("@", $email))) || ($name_is_required && empty($name)) || ($address_is_required && empty($address)) || ($contactname_is_required && empty($contactname)) || ($city_is_required && empty($city)) || ($zip_is_required && empty($zip)) || ($phone_is_required && empty($phone))) {
    header( "Location: $errorurl" );
    exit ;
}
if ( ereg( "[\r\n]", $name ) || ereg( "[\r\n]", $email ) || ereg( "[\r\n]", $address ) || ereg( "[\r\n]", $contactname ) ) {
    header( "Location: $errorurl" );
    exit ;
}
if (empty($email)) {
    $email = $mailto ;
}
$fromemail = (!isset( $use_webmaster_email_for_from ) || ($use_webmaster_email_for_from == 0)) ? $email : $mailto ;

if (get_magic_quotes_gpc()) {
    $comments = stripslashes( $comments );
}

$messageproper =
    "This message was sent from:\n" .
    "$http_referrer\n" .
    "------------------------------------------------------------\n" .
    "Organization Name: $name\n" .
    "Contact Name: $contactname\n" .   
    "Email of sender: $email\n" .
    "Address of sender: $address\n" .
    "City of sender: $city\n" .
    "State of sender: $state\n" .
    "Zip Code of sender: $zip\n" . 
    "Fax of sender: $fax\n" .   
    "Phone of sender: $phone\n" .
    "Meeting Name: $mtgname\n" .           
    "Preferred Dates: $dates\n" .          
    "Expected Attendance: $attendance\n" .         
    "Guest Rooms: $guestroom\n" .
    "Largest Meeting Room Needed: $mtgroom\n" .            
    "Decision Timeframe: $timeframe\n" .   
    "Options: $options\n" .                            
    "------------------------- COMMENTS -------------------------\n\n" .
    $comments .
    "\n\n------------------------------------------------------------\n" ;
$headers =
   "From: \"$name\" <$fromemail>" . $headersep . "Reply-To: \"$name\" <$email>" . $headersep . "X-Mailer: chfeedback.php 2.13.0" .
    $headersep . 'MIME-Version: 1.0' . $headersep . $content_type ;

if ($use_envsender) {
    mail($mailto, $subject, $messageproper, $headers, $envsender );
}
else {
    mail($mailto, $subject, $messageproper, $headers );
}
header( "Location: $thankyouurl" );
exit ;

?> 
```

我通过电子邮件收到的所有复选框都是“数组”。

谢谢

### 更新：

刚刚注意到如果我不选择复选框并提交，我会收到这些错误：

警告：implode() [function.implode]：在第 148 行的 /home/content/o/l/t/oltvcb/html/feedback_mtg.php 中传递的参数无效

警告：无法修改标头信息 - 标头已由 /home/content/o/l/t/oltvcb/ 中的（输出开始于 /home/content/o/l/t/oltvcb/html/feedback_mtg.php:148）发送第 162 行的 html/feedback_mtg.php

我确实注意到表单数据实际上来自我的电子邮件。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T19:22:43.637

$options 是一个数组。尝试[内爆](http://ca.php.net/implode)它。

```
$options = implode(', ', $options); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T19:23:20.390

复选框在提交时被视为一个数组。

```
foreach($options as $option) {
  print $option."\n";
} 
```

或者

```
print implode("\n", $options); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-27T19:23:49.077

这是一个建议。而不是这个：

```
"Options: $options\n" . 
```

尝试这个：

```
"Options:".implode("\n",$options)."\n". 
```

总是有可能不存在 $options 数组（没有选中复选框）。在这种情况下，您可以执行以下操作：

```
"Options:".(isset($options) ? implode("\n",$options) : "")."\n". 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T19:22:41.077

```
$options = join(', ', $_POST['options']); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-27T19:38:12.913

首先，您需要去掉 HTML 复选框变量名称中的“[ ]”。

如果在将其提交到处理页面时将其命名为“选项”，它会以数组的形式出现。

从那时起，您现在已经选择了一个值数组。

$_POST['选项']

# mysql - 根据日期和其他表格选择行

> ID：691136
> 
> 赞同：1
> 
> 时间：2009-03-27T19:18:03.147
> 
> 标签：mysql

我有三张桌子：

```
计算机，其中有 id、序列号、品牌、型号等列
用户，其中有 id 和 real name 列
computer_usage，包含列 id、computer_id、user_id、start_date、end_date

```

该数据库记录了我们拥有的所有计算机、我们的用户以及谁在何时使用了哪台计算机。

我想运行一个查询来选择所有没有当前用户的计算机。

这将是：

在 computer_usage 中根本不存在一个 computer_id 或 在 computer_usage 中确实存在一个 computer_id，其 end_date 为

选择这些记录的最佳方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T19:23:10.827

试试这个：

```
SELECT * 
FROM computers 
WHERE id NOT IN 
    (SELECT computer_id 
     FROM computer_usage
     WHERE end_date is NULL) 
```

子查询向您显示当前正在使用的所有计算机（存在一条记录，因此我们假设它有一个 start_date，但没有分配 end_date）。

我在这里假设 end_date 在“使用”完成之前不会被填充。如果这不正确（例如，如果结束日期是预先分配的），那么只需执行以下操作：

```
SELECT * 
FROM computers 
WHERE id NOT IN 
    (SELECT computer_id 
     FROM computer_usage
     WHERE start_date < getDate()
     AND end_date > getDate()) 
```

子查询仍显示当前“正在分配”的所有计算机。只需找到不在该组中的所有计算机。（请注意，我使用了“getDate”，这是一个 MS SQL 函数。我认为 mysql 等价物与 TIMESTAMP 有关。）

# java - 如何处理java枚举和数据库表之间的重复？

> ID：691137
> 
> 赞同：11
> 
> 时间：2009-03-27T19:18:13.427
> 
> 标签：java, sql, database, orm, enums

在我们的应用程序中，某些实体必须由枚举表示，这是很常见的情况：例如类型、类别、状态等。

通常，代码中有条件或流程使用这些值来决定一个动作或另一个动作，因此应用程序必须以某种方式“知道”这些值（即它必须能够引用特定实例决定而不是引用整个类）。这就是我们使用枚举而不是普通类的原因。

问题是这些实体还需要作为其他实体的字段存储（或至少引用）在数据库中。我们通常为每个实体创建一个表，以便能够在这些列中进行引用完整性检查，并且数据仅在数据库中具有“含义”，而无需参考枚举来找出每个 id 的含义.

理想情况下，这些实体的数据应该从枚举中的数据中填充，但现在我们在 db 初始化脚本中重复了这些值。

当使用像 Hibernate 这样的 ORM 时，它会变得有点复杂。

我想知道其他人如何处理这种情况。

我对在枚举和数据库表之间存在重复的想法并不完全满意，但我还没有找到更好的解决方案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T19:22:32.467

试试这个问题的答案：[如何在数据库中保存枚举](https://stackoverflow.com/questions/229856/ways-to-save-enums-in-database)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T22:07:41.947

我的 JPA/Hibernate 应用程序也有同样的问题。我所做的是在遇到它们时在数据库中动态创建枚举条目。在这种情况下，它会根据需要自动填充。

# .net - 确定是否为 IEnumerable 包含另一个 IEnumerable 的任何对象

> ID：691145
> 
> 赞同：18
> 
> 时间：2009-03-27T19:19:54.453
> 
> 标签：.net, ienumerable

我有2个`IEnumerable<int>`

```
IEnumerable<int> x;
IEnumerable<int> y; 
```

确定 x 中是否存在 y 中的任何 int 的最佳方法是什么？
目前我正在使用：

```
return x.Intersect<int>(y).Count() > 0; 
```

单独循环和测试每个程序会明显更快吗？

```
foreach (int i in x)
{
    foreach (int j in y)
    {
        if (i == j) return true;
    }
}
return false; 
```

这些列表相对较轻，x 中不超过 50 个整数，y 中不超过 4 个，如果这在考虑中很重要的话。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-03-27T19:22:05.040

使用[`Any`方法](http://msdn.microsoft.com/en-us/library/system.linq.enumerable.any.aspx)而不是[`Count`方法](http://msdn.microsoft.com/en-us/library/bb357758.aspx)是最快的：

```
return x.Intersect<int>(y).Any(); 
```

这假设[`IEnumerable<int>`](http://msdn.microsoft.com/en-us/library/9eekhta0.aspx)实现也没有实现[`ICollection<int>`](http://msdn.microsoft.com/en-us/library/92t2ye13.aspx). 在这种情况下，`Count`（在`IEnumerable<T>`implements的情况下`ICollection<T>`）是 O(N) 操作，而`Any`始终*是*O(1) 操作。（因为它只检查*单个*元素）。但是， 的行为`Count`是一个实现细节，您不应该依赖它。

我[在一篇博](http://www.caspershouse.com/post/Anything-Counts.aspx)文中更深入地讨论了这一点，详细介绍了何时使用`Count()`与`Any()`. 总之：

*   **请**使用`Enumerable.Any`扩展方法检查序列中是否存在元素。
*   **不要**在与零的比较中使用`Enumerable.Count`扩展方法，因为以下在语义上是等效的：
    *   `sequence.Count() == 0`
    *   `!sequence.Any()`
*   **不要**在与“非零”条件比较时使用`Enumerable.Count`扩展方法，因为以下在语义上是等效的：
    *   `sequence.Count != 0`
    *   `sequence.Any()`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-27T19:22:14.620

编辑：下面的原始答案确实涉及复杂性。如果序列足够短，通过`GetNext()`, 构建`HashSet`等的所有调用实际上将比使用 更昂贵`Intersect(y).Any()`。但是，在这种情况下，无论如何，这两个电话都会非常快。

换句话说，`Intersect(y).Any()`随着两个序列变长，肯定可以更好地扩展，但是如果您绝对*确定*序列很短，那么嵌套循环解决方案会更快。

**原始答案**

不，`Intersect()`会比双循环解决方案更快 - 但正如 CasperOne 所写的那样，它会`Any()`更快，`Count()`因为它会在看到一个元素时立即退出。

假设序列长度为 N 和 M，相交将为 ，`O(N + M)`而双环解为`O(N * M)`。

`HashSet`Intersect从“内部”序列（这需要复杂性）构建 a `O(M)`，然后遍历外部序列（需要`O(N)`复杂性），产生集合中的任何元素。这些结果是流式传输的 - 当从 请求第一个元素时将评估内部序列`Intersect()`，但这仅适用于找到第一个匹配项（如果有）。如果有任何匹配，使用`Any()`您将“提前退出”，因此我们在计算复杂性时不需要考虑匹配的总数。

来自 LINQ 的流式传输结果 - 值得一试（以及延迟执行）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-27T19:24:38.763

`Intersect`没关系，但正如其他人所说，我不会要求`.Count()`结果。

原因是 Intersect 不会*创建*两个列表的交集。它创建了一个`IEnumerable`能够*枚举**该*交集的对象，但实际上还没有枚举这些结果。大部分工作都被推迟到您最终迭代此枚举的时候。

问题`Count`在于它确实迭代了整个枚举。因此，它不仅总是计算所有结果，而且还导致计算这些结果所涉及的所有工作也运行。

相比之下，调用`Any`会*非常快，因为您将在返回之前**最多*计算一个交集结果。当然，在没有匹配的情况下，它仍然需要迭代整个列表。然而，这并不比你以前更糟。事实上，它仍然更快，因为正如 Jon Skeet 所提到的，该`Intersect`函数使用 HashSet 来计算结果，而不是遍历所有内容。您的最佳和平均案例得到了极大的改善。

这就像这两个片段之间的区别：

```
int count = 0;
foreach (int i in x)
{
   foreach (int j in y)
   {
      if (i==j) count++;
   }
}
return (count > 0); 
```

.

```
// this one should look familiar
foreach (int i in x)
{
    foreach (int j in y)
    {
       if (i==j) return true;
    }
}
return false; 
```

显然，第二个平均要快得多。的性能`Any()`将*类似于*（由于 HashSet，与第二个片段不同），而与第一个片段`Count()`类似。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T19:24:09.077

你最好这样做：

```
return x.Intersect(y).Any(); 
```

这将在找到单个匹配项后立即中止，并停止枚举集合。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-11-17T17:10:09.237

与我的回答相比，这个问题和最后一个答案已经超过 1 年了；但是，我的发现与公认的答案不同。我发现循环比使用 Intersect.Any() 快得多。也许我的基准代码不正确？

这是我用来查找 Intersect、嵌套循环和 IndexOf 循环之间每秒迭代次数的代码。请原谅VB。;)

```
Dim ArrayLength As Integer = 50
Dim doesContain As Boolean = False
Dim counter As Integer = 0
Dim sw As New System.Diagnostics.Stopwatch()
Dim BigArray1 As String() = New String(ArrayLength) {}
Dim BigArray2 As String() = New String(ArrayLength) {}
Dim rand As New Random(DateTime.Now.Millisecond)
For i As Integer = 0 To ArrayLength
    BigArray1(i) = Convert.ToChar(rand.Next(0, 255)).ToString()
    BigArray2(i) = Convert.ToChar(rand.Next(0, 255)).ToString()
Next
Dim AnEnumerable1 As IEnumerable(Of String) = BigArray1
Dim AnEnumerable2 As IEnumerable(Of String) = BigArray2

counter = 0
sw.Restart()
Do
    doesContain = False
    For Each x As String In AnEnumerable1
        For Each y As String In AnEnumerable2
            If x.Equals(y) Then
                doesContain = True
                Exit For
            End If
        Next
        If doesContain Then Exit For
    Next
    counter += 1
Loop While sw.ElapsedMilliseconds < 1000
Console.WriteLine("InnerLoop iterated:  " & counter.ToString() & " times in " & sw.ElapsedMilliseconds.ToString() & "ms.")

counter = 0
sw.Restart()
Do
    doesContain = AnEnumerable1.Intersect(AnEnumerable2).Any()
    counter += 1
Loop While sw.ElapsedMilliseconds < 1000
Console.WriteLine("Intersect iterated:  " & counter.ToString() & " times in " & sw.ElapsedMilliseconds.ToString() & "ms.")

counter = 0
sw.Restart()
Do
    For Each x As String In AnEnumerable1
        If Array.IndexOf(Of String)(BigArray2, x) <> -1 Then
            Exit For
        End If
    Next
    counter += 1
Loop While sw.ElapsedMilliseconds < 1000
Console.WriteLine("IndexOf iterated:    " & counter.ToString() & " times in " & sw.ElapsedMilliseconds.ToString() & "ms.") 
```

我的结果超过了两个 5,000,000 项数组。更高的迭代更好：

*   InnerLoop 迭代：2974553 次，1000ms。
*   相交迭代：1168ms 内 4 次。
*   **IndexOf 迭代：4194423 次，1000ms。**

我的结果超过了两个 50 项数组。更高的迭代更好：

*   InnerLoop 迭代次数：375712 次，1000ms。
*   Intersect 迭代次数：1000ms 203721 次。
*   **IndexOf 迭代次数：1000ms 668421 次。**

# python - Pythonic 实现分词器的方法

> ID：691148
> 
> 赞同：12
> 
> 时间：2009-03-27T19:20:43.983
> 
> 标签：python, coding-style, tokenize

我将在 Python 中实现一个标记器，我想知道你是否可以提供一些风格建议？

我之前在 C 和 Java 中实现了一个标记器，所以我对理论很好，我只想确保我遵循 pythonic 风格和最佳实践。

列出令牌类型：

例如，在 Java 中，我会有一个字段列表，如下所示：

```
public static final int TOKEN_INTEGER = 0 
```

但是，很明显，没有办法（我认为）在 Python 中声明一个常量变量，所以我可以用普通的变量声明替换它，但这并不是一个很好的解决方案，因为声明可以改变。

从 Tokenizer 返回令牌：

有没有更好的选择来简单地返回一个元组列表，例如

```
[ (TOKEN_INTEGER, 17), (TOKEN_STRING, "Sixteen")]? 
```

干杯，

皮特

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-03-29T00:01:04.957

模块中有一个未记录的类，`re`名为`re.Scanner`. 用于分词器非常简单：

```
import re
scanner=re.Scanner([
  (r"[0-9]+",       lambda scanner,token:("INTEGER", token)),
  (r"[a-z_]+",      lambda scanner,token:("IDENTIFIER", token)),
  (r"[,.]+",        lambda scanner,token:("PUNCTUATION", token)),
  (r"\s+", None), # None == skip token.
])

results, remainder=scanner.scan("45 pigeons, 23 cows, 11 spiders.")
print results 
```

将导致

```
[('INTEGER', '45'),
 ('IDENTIFIER', 'pigeons'),
 ('PUNCTUATION', ','),
 ('INTEGER', '23'),
 ('IDENTIFIER', 'cows'),
 ('PUNCTUATION', ','),
 ('INTEGER', '11'),
 ('IDENTIFIER', 'spiders'),
 ('PUNCTUATION', '.')] 
```

我用 re.Scanner 编写了一个非常漂亮的配置/结构化数据格式解析器，只用了几百行。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-03-27T19:24:07.987

Python 采用“我们都是成年人”的方法来隐藏信息。可以像使用常量一样使用变量，并相信您的代码的用户不会做一些愚蠢的事情。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-03-27T19:45:28.387

在许多情况下，exp。在解析长输入流时，您可能会发现将标记器实现为生成器函数更有用。这样，您可以轻松地遍历所有令牌，而无需先构建令牌列表需要大量内存。

对于生成器，请参阅[原始提案](http://www.python.org/dev/peps/pep-0255/)或其他在线文档

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-27T21:48:18.170

感谢您的帮助，我已经开始将这些想法整合在一起，并提出以下建议。这个实现有什么严重的错误（特别是我担心将文件对象传递给标记器）：

```
class Tokenizer(object):

  def __init__(self,file):
     self.file = file

  def __get_next_character(self):
      return self.file.read(1)

  def __peek_next_character(self):
      character = self.file.read(1)
      self.file.seek(self.file.tell()-1,0)
      return character

  def __read_number(self):
      value = ""
      while self.__peek_next_character().isdigit():
          value += self.__get_next_character()
      return value

  def next_token(self):
      character = self.__peek_next_character()

      if character.isdigit():
          return self.__read_number() 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-27T19:24:29.437

“除了简单地返回一个元组列表之外，还有更好的选择吗？”

没有。它真的很好用。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-27T19:30:49.200

“除了简单地返回一个元组列表之外，还有更好的选择吗？”

这就是“tokenize”模块用于解析 Python 源代码的方法。返回一个简单的元组列表可以很好地工作。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-28T01:20:48.703

我最近也构建了一个标记器，并通过了您的一些问题。

令牌类型在模块级别被声明为“常量”，即具有 ALL_CAPS 名称的变量。例如，

```
_INTEGER = 0x0007
_FLOAT = 0x0008
_VARIABLE = 0x0009 
```

等等。我在名称前使用了一个下划线来指出不知何故这些字段对于模块来说是“私有的”，但我真的不知道这是典型的还是可取的，甚至不知道有多少 Pythonic。（另外，我可能会放弃数字来支持字符串，因为在调试期间它们更具可读性。）

令牌作为命名元组返回。

```
from collections import namedtuple
Token = namedtuple('Token', ['value', 'type'])
# so that e.g. somewhere in a function/method I can write...
t = Token(n, _INTEGER)
# ...and return it properly 
```

我使用命名元组是因为标记器的客户端代码（例如解析器）在使用名称（例如 token.value）而不是索引（例如 token[0]）时看起来更清晰一些。

最后，我注意到有时，尤其是在编写测​​试时，我更喜欢将字符串传递给标记器而不是文件对象。我称它为“阅读器”，并有一个特定的方法来打开它，让分词器通过相同的接口访问它。

```
def open_reader(self, source):
    """
    Produces a file object from source.
    The source can be either a file object already, or a string.
    """
    if hasattr(source, 'read'):
        return source
    else:
        from io import StringIO
        return StringIO(source) 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-28T08:16:06.430

当我在 Python 中开始一些新的东西时，我通常会首先查看一些要使用的模块或库。有 90% 以上的机会已经有可用的东西。

对于分词器和解析器来说，确实如此。你看过[PyParsing](http://pyparsing.wikispaces.com/)吗？

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-07-24T10:28:01.187

我已经为类似 C 的编程语言实现了一个标记器。我所做的是将令牌的创建分为两层：

*   表面*扫描仪*：这个扫描仪实际上读取文本并使用正则表达式将其拆分为仅最原始的标记（运算符、标识符、数字......）；这个产生元组（tokenname、scannedstring、startpos、endpos）。
*   一个*标记器*：这会消耗第一层的元组，将它们变成标记对象（我认为命名的元组也可以）。它的目的是检测令牌流中的一些长期依赖关系，特别是字符串（带有它们的开始和结束引号）和注释（它们打开一个结束词法；-是的，我想保留注释！）并将它们强制为单个令牌。然后将生成的令牌对象流返回给消费解析器。

两者都是发电机。这种方法的好处是：

*   原始文本的阅读仅以最原始的方式完成，使用简单的正则表达式 - 快速而干净。
*   第二层已经实现为原始解析器，用于检测字符串文字和注释 - 重用解析器技术。
*   您不必使用复杂的检测来拉紧表面扫描仪。
*   但是真正的解析器在要解析的语言的语义级别上获取标记（同样是字符串，注释）。

我对这种分层方法感到非常满意。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-07-24T10:36:27.863

我会求助于David Mertz*[的 Python 中出色的文本处理](http://books.google.com/books?id=GxKWdn7u4w8C)*

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-04-22T08:57:53.867

这是一个较晚的答案，现在官方文档中有一些内容：使用标准库[编写标记器。](http://docs.python.org/3.2/library/re.html#writing-a-tokenizer)`re`这是 Python 3 文档中的内容，而不是 Py 2.7 文档中的内容。但它仍然适用于较旧的 Python。

这包括短代码、简单设置和编写生成器，正如这里提出的几个答案。

如果文档不是 Pythonic，我不知道是什么:-)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-27T19:56:48.110

“有没有比简单地返回元组列表更好的选择”

我必须实现一个标记器，但它需要比元组列表更复杂的方法，因此我为每个标记实现了一个类。然后你可以返回一个类实例列表，或者如果你想节省资源，你可以返回实现迭代器接口的东西，并在解析过程中生成下一个令牌。

# unit-testing - 使用 MbUnit3 的 [Rollback] 对 NHibernate 与 SQLite 的交互进行单元测试

> ID：691151
> 
> 赞同：2
> 
> 时间：2009-03-27T19:21:03.203
> 
> 标签：unit-testing, nhibernate, sqlite, mbunit, gallio

**背景：**

我的团队致力于确保直接从结帐，我们的代码编译和单元测试成功运行。为了促进这一点并测试我们的一些 NHibernate 映射，我们在存储库中添加了一个 SQLite DB，它是我们生产 SQL Server 2005 数据库的镜像。我们使用的是最新版本：MbUnit3（Gallio 的一部分）、System.Data.SQLite 和 NHibernate。

**问题：**

我发现以下单元测试不适用于 SQLite，尽管对 SQL Server 2005 执行没有问题。

```
 [Test]
    [Rollback]
    public void CompleteCanPersistNode()
    {
        // returns a Configuration for either SQLite or SQL Server 2005 depending on how the project is configured.
        Configuration config = GetDbConfig(); 

        ISessionFactory sessionFactory = config.BuildSessionFactory();
        ISession session = sessionFactory.OpenSession();

        Node node = new Node();
        node.Name = "Test Node";
        node.PhysicalNodeType = session.Get<NodeType>(1);

        // SQLite fails with the exception below after the next line called.
        node.NodeLocation = session.Get<NodeLocation>(2);

        session.Save(node);
        session.Flush();

        Assert.AreNotEqual(-1, node.NodeID);
        Assert.IsNotNull(session.Get<Node>(node.NodeID));
    } 
```

我得到的异常（仅在使用 SQLite 时）如下：

```
NHibernate.ADOException：无法打开连接--->
System.Data.SQLite.SQLiteException：
  数据库文件被锁定 数据库被锁定
    在 System.Data.SQLite.SQLite3.Step（SQLiteStatement stmt）
    在 System.Data.SQLite.SQLiteDataReader.NextResult()
    在 System.Data.SQLite.SQLiteDataReader..ctor（SQLiteCommand cmd，CommandBehavior 行为）
    在 System.Data.SQLite.SQLiteCommand.ExecuteReader（CommandBehavior 行为）
    在 System.Data.SQLite.SQLiteCommand.ExecuteNonQuery()
    在 System.Data.SQLite.SQLiteTransaction..ctor（SQLiteConnection 连接，布尔 deferredLock）
    在 System.Data.SQLite.SQLiteConnection.BeginDbTransaction（IsolationLevel 隔离级别）
    在 System.Data.SQLite.SQLiteConnection.BeginTransaction()
    在 System.Data.SQLite.SQLiteEnlistment..ctor（SQLiteConnection cnn，事务范围）
    在 System.Data.SQLite.SQLiteConnection.EnlistTransaction（事务事务）
    在 System.Data.SQLite.SQLiteConnection.Open()
    在 NHibernate.Connection.DriverConnectionProvider.GetConnection()
    在 NHibernate.Impl.SessionFactoryImpl.OpenConnection()
    --- 内部异常堆栈跟踪结束 ---
    在 NHibernate.Impl.SessionFactoryImpl.OpenConnection()
    在 NHibernate.AdoNet.ConnectionManager.GetConnection()
    在 NHibernate.AdoNet.AbstractBatcher.Prepare（IDbCommand cmd）
    在 NHibernate.AdoNet.AbstractBatcher.ExecuteReader（IDbCommand cmd）
    在 NHibernate.Loader.Loader.GetResultSet(IDbCommand st, Boolean autoDiscoverTypes, Boolean callable, RowSelection selection, ISessionImplementor session)
    在 NHibernate.Loader.Loader.DoQuery(ISessionImplementor session, QueryParameters queryParameters, Boolean returnProxies)
    在 NHibernate.Loader.Loader.DoQueryAndInitializeNonLazyCollections（ISessionImplementor 会话，QueryParameters 查询参数，布尔 returnProxies）
    在 NHibernate.Loader.Loader.LoadEntity（ISessionImplementor 会话，对象 id，IType 标识符类型，对象 optionalObject，字符串 optionalEntityName，对象 optionalIdentifier，IEntityPersister 持久化）
    在 NHibernate.Loader.Entity.AbstractEntityLoader.Load（ISessionImplementor 会话，对象 id，对象 optionalObject，对象 optionalId）
    在 NHibernate.Loader.Entity.AbstractEntityLoader.Load（对象 id，对象 optionalObject，ISessionImplementor 会话）
    在 NHibernate.Persister.Entity.AbstractEntityPersister.Load（对象 id，对象 optionalObject，LockMode lockMode，ISessionImplementor 会话）
    在 NHibernate.Event.Default.DefaultLoadEventListener.LoadFromDatasource（LoadEvent 事件，IEntityPersister 持久化，EntityKey keyToLoad，LoadType 选项）
    在 NHibernate.Event.Default.DefaultLoadEventListener.DoLoad（LoadEvent 事件，IEntityPersister 持久化，EntityKey keyToLoad，LoadType 选项）
    在 NHibernate.Event.Default.DefaultLoadEventListener.Load（LoadEvent 事件，IEntityPersister 持久化，EntityKey keyToLoad，LoadType 选项）
    在 NHibernate.Event.Default.DefaultLoadEventListener.ProxyOrLoad（LoadEvent 事件，IEntityPersister 持久化，EntityKey keyToLoad，LoadType 选项）
    在 NHibernate.Event.Default.DefaultLoadEventListener.OnLoad（LoadEvent 事件，LoadType loadType）
    在 NHibernate.Impl.SessionImpl.FireLoad（LoadEvent 事件，LoadType loadType）
    在 NHibernate.Impl.SessionImpl.Get（字符串 entityName，对象 id）
    在 NHibernate.Impl.SessionImpl.Get（类型 entityClass，对象 id）
    在 NHibernate.Impl.SessionImpl.Get[T](对象 id)
D:\dev\598\Code\test\unit\DataAccess.Test\NHibernatePersistenceTests.cs

```

当使用 SQLite 并且未指定 [Rollback] 属性时，测试也成功完成。

**问题：**

这是 MbUnit3 用于 [Rollback] 的 System.Data.SQLite 的 TransactionScope 实现的问题还是 SQLite 引擎的限制？

有没有办法编写这个单元测试，针对 SQLite，回滚以避免每次运行测试时影响数据库？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T19:48:14.183

这不是您问题的真正答案，但可能是解决问题的解决方案。

我使用 sql lite 的内存实现进行集成测试。我在每次测试之前建立架构并填充数据库。模式创建和初始数据填充发生得非常快（每次测试不到 0.01 秒），因为它是一个内存数据库。

为什么要使用物理数据库？

编辑：对上述问题的回答：

1.) 因为我直接从 SQL Server 2005 迁移了我的架构和数据，并且我希望它保留在源代码管理中。

*   我建议在其中存储一个包含数据库架构的文件以及一个在源代码管理中创建示例数据的文件或脚本。您可以使用 sql server studion management express 生成文件，您可以从 NHibernate 映射生成它，或者您可以使用 sql compare 之类的工具，您可能会在需要时找到其他解决方案。纯文本文件比完整的二进制数据库文件更容易存储在版本控制系统中。

2.) 内存中的 SQLite 引擎是否有所不同以解决这个困难？

*   它可能会解决您的问题，因为您可以在每次测试之前重新创建数据库。在执行每个测试之前，您的被测数据库将处于您期望的状态。这样做的一个好处是无需回滚您的事务，但我已经使用内存中的 sqllite 运行了类似的测试，并且它可以正常工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-28T03:13:09.840

检查`connection.release_mode=on_close`您的 SQLite NHibernate 配置中是否没有丢失。（[参考文档](http://www.nhforge.org/doc/nh/en/index.html#transactions-connection-release)）

顺便说一句：总是处理你的`ISession`和`ISessionFactory`.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T19:40:14.827

抛弃 [Rollback] 并使用[NDbUnit](http://code.google.com/p/ndbunit/)。我自己在这个确切的场景中使用它，它一直工作得很好。

# asp.net - 为什么我的文本字段被清除了？

> ID：691163
> 
> 赞同：0
> 
> 时间：2009-03-27T19:23:16.927
> 
> 标签：asp.net, asp.net-mvc, ajax

我有一个由 Ajax 调用以添加新行项目的部分。如果我在部件 ID 字段中输入一些数据，然后单击添加另一个项目的链接，它会清除我刚刚输入的内容。

看法：

```
<label>Parts Used
<%= Ajax.ActionLink("Add another item", "BlankEditor", new AjaxOptions {
UpdateTargetId = "partusageitems", InsertionMode = InsertionMode.InsertAfter}) %>
</label>

<div id="partusageitems">
        <% foreach (var part in Model.PartUsage)
           {
               Html.RenderPartial("~/Views/Fsr/_PartsUsage.ascx", part);
           }%>
</div> 
```

部分的：

```
<div>
<% var fieldPrefix = "PartUsage[]."; %>
Part ID: <%= Html.TextBox(fieldPrefix + "ID", Model.ID, new { size = "25"})%>
Serial Number: <%= Html.TextBox(fieldPrefix + "Serial", Model.Serial, new { size = "25" })%>   
Quantity: <%= Html.TextBox(fieldPrefix + "Quantity", Model.Quantity, new { size = "10"}) %>
<a href="#partsusagesection" onclick="deleteContainer(event)">Delete</a>
</div> 
```

控制器：

```
public ActionResult BlankEditor()
{
    return View("_PartsUsage", new Part());
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-27T19:46:23.190

这可能只是一个错字，但 Partial 最后缺少一个 DIV 结束标签。

# c++ - C++ 异常处理增加了多少占用空间

> ID：691168
> 
> 赞同：57
> 
> 时间：2009-03-27T19:23:51.590
> 
> 标签：c++, exception, exception-handling, embedded, footprint

这个问题对于嵌入式开发尤其重要。异常处理为生成的二进制输出增加了一些足迹。另一方面，无一例外地需要以其他方式处理错误，这需要额外的代码，最终也会增加二进制大小。

我对你的经历很感兴趣，尤其是：

1.  您的编译器为异常处理添加的平均占用空间是多少（如果您有这样的测量结果）？
2.  就二进制输出大小而言，异常处理真的比其他错误处理策略更昂贵（很多人这么说）吗？
3.  对于嵌入式开发，您会建议什么错误处理策略？

请仅将我的问题作为指导。欢迎任何意见。

附录：是否有人有具体的方法/脚本/工具，对于特定的 C++ 对象/可执行文件，将显示编译器生成的专用于异常处理的代码和数据结构占用的已加载内存占用的百分比？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-03-27T20:13:18.227

当发生异常*时*，会有时间开销，这取决于您如何实现异常处理。但是，作为轶事，应该导致异常的事件的严重性将花费同样多的时间来使用任何其他方法来处理。为什么不使用高度支持的基于语言的方法来处理此类问题？

GNU C++ 编译器默认使用零成本模型，即在不发生异常时没有时间开销。

> 由于有关异常处理代码和本地对象偏移量的信息可以在编译时计算一次，因此这些信息可以保存在与每个函数相关联的单个位置，而不是每个 ARI 中。您基本上消除了每个 ARI 的异常开销，从而避免了将它们推入堆栈的额外时间。这种方法称为异常处理的零成本模型，前面提到的优化存储称为影子堆栈。- Bruce Eckel，用 C++ 思考第 2 卷

大小复杂性开销不容易量化，但 Eckel 表示平均为 5% 和 15%。这将取决于您的异常处理代码的大小与应用程序代码的大小之比。如果您的程序很小，那么异常将是二进制文件的很大一部分。如果您使用的是零成本模型，那么异常将占用更多空间来消除时间开销，因此，如果您关心空间而不是时间，则不要使用零成本编译。

**我的观点**是大多数嵌入式系统都有足够的内存，如果你的系统有一个 C++ 编译器，你就有足够的空间来包含异常。我的项目使用的 PC/104 计算机有几 GB 的辅助内存，512 MB 的主内存，因此对于异常没有空间问题 - 但是，我们的微控制器是用 C 编程的。我的启发是“如果有一个主流的 C++ 编译器它，使用异常，否则使用 C"。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-03-27T22:47:20.493

测量事物，第 2 部分。我现在有两个程序。第一个是 C 语言，用 gcc -O2 编译：

```
#include <stdio.h>
#include <time.h>

#define BIG 1000000

int f( int n ) {
    int r = 0, i = 0;
    for ( i = 0; i < 1000; i++ ) {
        r += i;
        if ( n == BIG - 1 ) {
            return -1;
        }
    }
    return r;
}

int main() { 
    clock_t start = clock();
    int i = 0, z = 0;
    for ( i = 0; i < BIG; i++ ) {
        if ( (z = f(i)) == -1 ) { 
            break;
        }
    }
    double t  = (double)(clock() - start) / CLOCKS_PER_SEC;
    printf( "%f\n", t );
    printf( "%d\n", z );
} 
```

第二个是C++，有异常处理，用g++ -O2编译：

```
#include <stdio.h>
#include <time.h>

#define BIG 1000000

int f( int n ) {
    int r = 0, i = 0;
    for ( i = 0; i < 1000; i++ ) {
        r += i;
        if ( n == BIG - 1 ) {
            throw -1;
        }
    }
    return r;
}

int main() { 
    clock_t start = clock();
    int i = 0, z = 0;
    for ( i = 0; i < BIG; i++ ) {
        try {
         z += f(i); 
        }
        catch( ... ) {
            break;
        }

    }
    double t  = (double)(clock() - start) / CLOCKS_PER_SEC;
    printf( "%f\n", t );
    printf( "%d\n", z );
} 
```

我认为这些回答了对我上一篇文章的所有批评。

**结果：执行时间使 C 版本比 C++ 版本有 0.5% 的优势，但有例外，而不是其他人谈论的 10%（但未演示）**

***如果其他人可以尝试编译和运行代码（应该只需要几分钟）以检查我是否在任何地方都没有犯过可怕而明显的错误，我将非常感激。这就是所谓的“科学方法”！***

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-27T19:56:00.123

我在低延迟环境中工作。（我的应用程序在生产“链”中的时间不到 300 微秒）根据我的经验，异常处理会增加 5-25% 的执行时间，具体取决于您执行的数量！

我们通常不关心二进制膨胀，但如果膨胀过多，就会像疯了一样颠簸，所以你需要小心。

保持二进制合理（取决于您的设置）。

我对我的系统进行了相当广泛的分析。
其他讨厌的地方：

日志记录

持久化（我们只是不这样做，或者如果我们这样做是并行的）

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-27T19:29:23.340

我想这取决于该特定平台的硬件和工具链端口。

我没有数字。然而，对于大多数嵌入式开发，我看到人们抛弃了两件事（对于 VxWorks/GCC 工具链）：

*   模板
*   RTTI

在大多数情况下，异常处理确实同时使用了这两种方法，因此也倾向于将其丢弃。

在那些我们真的想接近金属的情况下，使用`setjmp`/ `longjmp`。*请注意，这可能不是最好的解决方案（或非常强大），但这就是_we_使用的。*

您可以使用带有/不带有异常处理的两个版本的基准测试套件在您的桌面上运行简单的测试，并获得您最依赖的数据。

关于嵌入式开发的另一件事：模板像瘟疫一样被避免——它们会导致过多的膨胀。Johann Gerell 在评论中解释了模板和 RTTI 的异常标记（我认为这很好理解）。

*同样，这正是我们所做的。所有的反对票是怎么回事？*

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-01T08:43:47.097

需要考虑的一件事：如果您在嵌入式环境中工作，您希望应用程序尽可能小。Microsoft C 运行时给程序增加了相当多的开销。通过删除 C 运行时作为要求，我能够得到一个简单的程序，它是一个 2KB 的 exe 文件，而不是一个 70 多千字节的文件，而且所有的大小优化都打开了。

C++ 异常处理需要由 C 运行时提供的编译器支持。细节笼罩在神秘之中，根本没有记录。通过避免 C++ 异常，我可以删除整个 C 运行时库。

您可能会争辩说只是动态链接，但在我的情况下这是不切实际的。

另一个问题是 C++ 异常至少在 MSVC 上需要有限的 RTTI（运行时类型信息），这意味着异常的类型名称存储在可执行文件中。在空间方面，这不是问题，但对我来说，文件中没有这些信息只是“感觉”更干净。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-01T08:49:46.363

很容易看到对二进制大小的影响，只需在编译器中关闭 RTTI 和异常。如果您正在使用它，您会收到有关 dynamic_cast<> 的投诉……但我们通常会避免在我们的环境中使用依赖于 dynamic_cast<> 的代码。

我们一直发现，在二进制大小方面关闭异常处理和 RTTI 是一种胜利。在没有异常处理的情况下，我见过许多不同的错误处理方法。最受欢迎的似乎是将失败代码向上传递到调用堆栈。在我们当前的项目中，我们使用 setjmp/longjmp，但我建议不要在 C++ 项目中这样做，因为在许多实现中退出作用域时它们不会运行析构函数。老实说，我认为这是代码的原始架构师做出的一个糟糕的选择，特别是考虑到我们的项目是 C++。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-27T19:46:25.733

在我看来，异常处理不是嵌入式开发通常可以接受的。

GCC 和 Microsoft 都没有“零开销”异常处理。两个编译器都将序言和结尾语句插入到跟踪执行范围的每个函数中。这导致性能和内存占用显着增加。

根据我的经验，性能差异大约为 10%，这对于我的工作领域（实时图形）来说是一个巨大的数字。内存开销要少得多，但仍然很重要——我不记得这个数字了，但是使用 GCC/MSVC 很容易以两种方式编译你的程序并测量差异。

我见过一些人将异常处理称为“仅当您使用它时”的成本。根据我的观察，这不是真的。当您启用异常处理时，它会影响所有代码，无论代码路径是否可以引发异常（当您考虑编译器的工作方式时，这完全有意义）。

我也会远离 RTTI 进行嵌入式开发，尽管我们确实在调试版本中使用它来检查向下转换的结果。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-02T15:30:18.243

定义“嵌入式”。在 8 位处理器上，我肯定不会处理异常（我肯定不会在 8 位处理器上使用 C++）。如果您使用的 PC104 类型板的功能强大到足以在几年前成为某人的桌面，那么您可能会侥幸成功。但我不得不问——为什么会有例外？通常在嵌入式应用程序中，发生异常之类的事情是不可想象的——为什么在测试中没有解决这个问题？

例如，这是在医疗设备中吗？医疗设备中的草率软件已经杀死了人。任何计划外发生的事情都是不可接受的，期间。必须考虑所有故障模式，正如 Joel Spolsky 所说，异常就像 GOTO 语句，除了你不知道它们是从哪里调用的。所以当你处理你的异常时，什么失败了，你的设备处于什么状态？由于您的例外，您的放射治疗机卡在 FULL 状态并且正在煮活人（这发生在 IRL）？在您的 10,000 多行代码中，异常发生在什么时候。当然，您可以将其减少到大约 100 行代码，但您知道导致异常的每一行代码的重要性吗？

如果没有更多信息，我会说不要计划嵌入式系统中的异常。如果您添加它们，则准备好计划可能导致异常的每一行代码的故障模式。如果您正在制造医疗设备，那么如果您不这样做，人们就会死去。如果您正在制作便携式 DVD 播放器，那么您制作的便携式 DVD 播放器很糟糕。它是哪一个？

# asp.net - Asp:Menu 和 Internet Explorer 8 问题？

> ID：691177
> 
> 赞同：0
> 
> 时间：2009-03-27T19:27:32.673
> 
> 标签：asp.net, aspmenu

我安装了 Internet Explorer 8，现在没有显示顶级菜单项下的菜单项。背景只是白色。如果我在 IE6 或 IE7 中检查它，菜单项显示得很好。有人见过这个吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T19:33:04.780

这是一个已知问题，并且有一个修补程序。请参阅[Bertrand 的博客文章](http://weblogs.asp.net/bleroy/archive/2009/03/23/asp-menu-fix-for-ie8-problem-available.aspx)。

# java - Scanner vs. StringTokenizer vs. String.Split

> ID：691184
> 
> 赞同：163
> 
> 时间：2009-03-27T19:29:22.403
> 
> 标签：java, java.util.scanner, tokenize, split

我刚刚了解了 Java 的 Scanner 类，现在我想知道它如何与 StringTokenizer 和 String.Split 进行比较/竞争。我知道 StringTokenizer 和 String.Split 仅适用于字符串，那么我为什么要使用 Scanner 处理字符串呢？Scanner 是否只是为拆分提供一站式服务？

* * *

## 回答 #1

> 赞同：246
> 
> 时间：2009-03-27T19:40:52.220

它们本质上是课程的马。

*   `Scanner`专为需要解析字符串、提取不同类型数据的情况而设计。它非常灵活，但可以说没有为您提供最简单的 API 来简单地获取由特定表达式分隔的字符串数组。
*   `String.split()`并`Pattern.split()`为您提供执行后者的简单语法，但这基本上就是他们所做的一切。如果您想解析生成的字符串，或者根据特定标记在中途更改分隔符，它们将无助于您。
*   `StringTokenizer`比 更具限制性`String.split()`，而且使用起来也有点复杂。它本质上是为提取由固定子字符串分隔的标记而设计的。由于这个限制，它的速度大约是`String.split()`. （参见我对[和的](http://www.javamex.com/tutorials/regular_expressions/splitting_tokenisation_performance.shtml)[比较`String.split()``StringTokenizer`](http://www.javamex.com/tutorials/regular_expressions/splitting_tokenisation_performance.shtml)。）它还早于正则表达式 API，后者`String.split()`是其中的一部分。

您会从我的计时中注意到，在典型机器上仍然可以**在几毫秒内**`String.split()`标记数千个字符串。此外，它的优势在于它将输出作为字符串数组提供给您，这通常是您想要的。大多数情况下，使用由 提供的过于“语法上的挑剔”。从这个角度来看，现在有点浪费空间，你还不如直接使用.**`StringTokenizer``Enumeration``StringTokenizer``StringTokenizer``String.split()`**

 *** * *

## 回答 #2

> 赞同：58
> 
> 时间：2009-03-27T19:58:41.630

让我们从消除[`StringTokenizer`](http://java.sun.com/javase/6/docs/api/java/util/StringTokenizer.html). 它变老了，甚至不支持正则表达式。其文档指出：

> `StringTokenizer`是一个遗留类，出于兼容性原因保留，但不鼓励在新代码中使用它。建议任何寻求此功能的人使用`split`方法`String`或`java.util.regex`包来代替。

所以让我们马上把它扔掉。留下[`split()`](http://java.sun.com/javase/6/docs/api/java/lang/String.html#split(java.lang.String))和[`Scanner`](http://java.sun.com/javase/6/docs/api/java/util/Scanner.html)。他们之间有什么区别？

一方面，`split()`只需返回一个数组，这使得使用 foreach 循环变得容易：

```
for (String token : input.split("\\s+") { ... } 
```

`Scanner`构建得更像一个流：

```
while (myScanner.hasNext()) {
    String token = myScanner.next();
    ...
} 
```

或者

```
while (myScanner.hasNextDouble()) {
    double token = myScanner.nextDouble();
    ...
} 
```

（它有一个相当[大的 API](http://java.sun.com/javase/6/docs/api/java/util/Scanner.html#method_summary)，所以不要以为它总是局限于这么简单的事情。）

当您在开始解析之前没有（或无法获得）所有输入时，这种流式接口对于解析简单的文本文件或控制台输入很有用。

就个人而言，我唯一记得使用`Scanner`的是学校项目，当时我必须从命令行获取用户输入。它使这种操作变得容易。但如果我有一个`String`我想分手的，那几乎是不费吹灰之力的`split()`。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-27T19:58:23.613

StringTokenizer 一直都在。它是最快的，但类似枚举的习语可能看起来不像其他习语那么优雅。

split 在 JDK 1.4 上出现。比标记器慢但更易于使用，因为它可以从 String 类中调用。

Scanner 出现在 JDK 1.5 上。它是最灵活的，并且填补了 Java API 中长期存在的空白，以支持与著名的 Cs scanf 函数系列等效的功能。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2012-10-11T02:59:51.883

Split 很慢，但没有 Scanner 慢。StringTokenizer 比拆分更快。然而，我发现我可以通过交易一些灵活性来获得双倍的速度，以获得速度提升，这是我在 JFastParser [https://github.com/hughperkins/jfastparser所做的](https://github.com/hughperkins/jfastparser)

对包含一百万个双精度的字符串进行测试：

```
Scanner: 10642 ms
Split: 715 ms
StringTokenizer: 544ms
JFastParser: 290ms 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-03-27T19:41:53.417

如果你有一个要标记的 String 对象，请优先使用 String 的[split](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/String.html#split(java.lang.String))方法而不是 StringTokenizer。如果您要从程序外部的源（例如文件或用户）解析文本数据，那么扫描器就派上用场了。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-11-05T07:50:40.303

String.split 似乎比 StringTokenizer 慢得多。split 的唯一优点是您可以获得一个令牌数组。您也可以在拆分中使用任何正则表达式。org.apache.commons.lang.StringUtils 有一个 split 方法，它比两个中的任何一个都快得多。StringTokenizer 或 String.split。但三者的 CPU 利用率几乎相同。因此，我们还需要一种 CPU 密集度较低的方法，但我仍然找不到。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2012-01-26T09:48:54.907

我最近做了一些关于 String.split() 在高性能敏感情况下性能不佳的实验。您可能会发现这很有用。

[Java 的 String.split() 和 replace() 隐藏的弊端](https://web.archive.org/web/20120131135552/http://eblog.chrononsystems.com/hidden-evils-of-javas-stringsplit-and-stringr)

要点是 String.split() 每次都会编译正则表达式模式，因此与使用预编译的 Pattern 对象并直接使用它来操作字符串相比，它会减慢程序的速度。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-04-21T16:27:34.830

一个重要的区别是 String.split() 和 Scanner 都可以生成空字符串，但 StringTokenizer 从不这样做。

例如：

```
String str = "ab cd  ef";

StringTokenizer st = new StringTokenizer(str, " ");
for (int i = 0; st.hasMoreTokens(); i++) System.out.println("#" + i + ": " + st.nextToken());

String[] split = str.split(" ");
for (int i = 0; i < split.length; i++) System.out.println("#" + i + ": " + split[i]);

Scanner sc = new Scanner(str).useDelimiter(" ");
for (int i = 0; sc.hasNext(); i++) System.out.println("#" + i + ": " + sc.next()); 
```

输出：

```
//StringTokenizer
#0: ab
#1: cd
#2: ef
//String.split()
#0: ab
#1: cd
#2: 
#3: ef
//Scanner
#0: ab
#1: cd
#2: 
#3: ef 
```

这是因为 String.split() 和 Scanner.useDelimiter() 的分隔符不仅仅是一个字符串，而是一个正则表达式。我们可以将上面示例中的分隔符“”替换为“+”，以使其行为类似于 StringTokenizer。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-03-12T11:01:47.953

对于默认情况，我也建议使用 Pattern.split()，但如果您需要最高性能（特别是在 Android 上，我测试的所有解决方案都非常慢）并且您只需要按单个字符拆分，我现在使用我自己的方法：

```
public static ArrayList<String> splitBySingleChar(final char[] s,
        final char splitChar) {
    final ArrayList<String> result = new ArrayList<String>();
    final int length = s.length;
    int offset = 0;
    int count = 0;
    for (int i = 0; i < length; i++) {
        if (s[i] == splitChar) {
            if (count > 0) {
                result.add(new String(s, offset, count));
            }
            offset = i + 1;
            count = 0;
        } else {
            count++;
        }
    }
    if (count > 0) {
        result.add(new String(s, offset, count));
    }
    return result;
} 
```

使用 "abc".toCharArray() 获取字符串的字符数组。例如：

```
String s = "     a bb   ccc  dddd eeeee  ffffff    ggggggg ";
ArrayList<String> result = splitBySingleChar(s.toCharArray(), ' '); 
```

* * *

## 回答 #10

> 赞同：-5
> 
> 时间：2013-02-22T22:09:59.897

String.split() 效果很好，但有自己的界限，比如如果你想根据单管道或双管道 (|) 符号拆分字符串，如下所示，它不起作用。在这种情况下，您可以使用 StringTokenizer。

ABC|IJK

# sql-server - MSSQL：在触发器执行过程中发生错误时会发生什么？

> ID：691189
> 
> 赞同：2
> 
> 时间：2009-03-27T19:32:06.127
> 
> 标签：sql-server, transactions, triggers, atomic

关于 MS SQL Server 的更新和插入触发器，有没有办法让它们成为原子的？也就是说，如果在触发过程中发生错误，是否可以自动回滚原来的插入或更新？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-27T20:05:53.080

After 触发器自动成为表上插入/更新/删除原子 DML 语句的一部分。

您只需在触发器中发出 ROLLBACK TRAN 即可回滚触发器中的所有工作和原始 I/U/D 语句。如果有一个，最外层的 tran 也会回滚。

**重要的**

SQL 2000 和更早版本的触发器中的回滚会中止批处理。在有问题的 I/U/D 之后不会运行任何代码。[请参阅 Erland 的精彩文章](http://www.sommarskog.se/error-handling-II.html#triggers)和[另一篇文章](http://www.sommarskog.se/error-handling-I.html#triggercontext)

对于带有 TRY/CATCH 的 SQL 2005，执行将转到 CATCH 块，并且您的批处理（也称为存储过程等）将正常退出。

请参阅[存储过程和触发器中的回滚和提交](http://msdn.microsoft.com/en-us/library/ms187844(SQL.90).aspx)。触发器和 TRY/CATCH 交互在[这里](http://msdn.microsoft.com/en-us/library/ms175976(SQL.90).aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T19:36:30.903

MSDN 中有一篇关于触发器和事务的好文章，位于此处：

[http://msdn.microsoft.com/en-us/magazine/cc164032.aspx](http://msdn.microsoft.com/en-us/magazine/cc164032.aspx)

基本上，您想使用事务来使操作原子化。

# c++ - 为什么我的 C++ 映射实现不存储值？

> ID：691194
> 
> 赞同：1
> 
> 时间：2009-03-27T19:33:08.743
> 
> 标签：c++, map

我有一个名为 ImageMatrix 的类，它以递归方式实现 C++ 映射；最终结果是我有一个 3 维数组。

```
typedef uint32_t VUInt32;
typedef int32_t VInt32;

class ImageMatrix
{
public:
    ImageMatrixRow operator[](VInt32 rowIndex)
private:
    ImageMatrixRowMap rows;
};

typedef std::map <VUInt32, VInt32> ImageMatrixChannelMap;

class ImageMatrixColumn
{
public:
    VInt32 &operator[](VUInt32 channelIndex);
private:
    ImageMatrixChannelMap channels;
};

typedef std::map<VUInt32, ImageMatrixColumn> ImageMatrixColumnMap;

class ImageMatrixRow
{
public:
    ImageMatrixColumn operator[](VUInt32 columnIndex);
private:
    ImageMatrixColumnMap columns;
};

typedef std::map<VUInt32, ImageMatrixRow> ImageMatrixRowMap; 
```

每个运算符只返回一个映射包装类，如下所示：

```
ImageMatrixRow ImageMatrix::operator[](VInt32 rowIndex)
{
    return rows[rowIndex];
}

ImageMatrixColumn ImageMatrixRow::operator[](VUInt32 columnIndex)
{
    return columns[columnIndex];
}

VInt32 &ImageMatrixColumn::operator[](VUInt32 channelIndex)
{
    return channels[channelIndex];
} 
```

基本上，当我将值设置为 100 并将值测试为 cout 时，它显示为 0，而不是我设置的数字。

```
for (VUInt32 a = 0; a < GetRowCount(); a++)
{
    for (VUInt32 b = 0; b < GetColumnCount(); b++)
    {
        for (VUInt32 c = 0; c < GetChannelCount(); c++)
        {
            VInt32 value = 100;
            matrix[a][b][c] = value;

            VInt32 test = matrix[a][b][c];

                            // pixel = 100, test = 0 - why?
            cout << pixel << "/" << test << endl;
        }
    }
} 
```

注意：我已经对这个例子的原始代码进行了修改，以便它占用更少的空间，因此可能会出现一些语法错误（请不要指出它们）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T19:36:15.820

以下运算符按值返回，没有写入修改实际数据。

```
ImageMatrixRow ImageMatrix::operator[](VInt32 rowIndex);

ImageMatrixColumn ImageMatrixRow::operator[](VUInt32 columnIndex); 
```

采用：

```
ImageMatrixRow& ImageMatrix::operator[](VInt32 rowIndex)

ImageMatrixColumn& ImageMatrixRow::operator[](VUInt32 columnIndex) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T19:36:14.243

除了一个返回值之外，您的所有 operator[] 函数都应该返回引用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T19:36:51.027

您的`ImageMatrixRow`和`ImageMatrixColumn` `operator[]()`方法返回副本，而不是参考。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T19:37:15.100

“每个都返回一个参考” - 你确定吗？

它们看起来像是返回了存储地图的副本，而不是对它们的引用。

试试，例如：

```
ImageMatrixRow & ImageMatrix::operator[](VInt32 rowIndex) 
```

注意`&`符号。

# asp.net - ASP.Net Context.User.Identity 怪异

> ID：691197
> 
> 赞同：1
> 
> 时间：2009-03-27T19:34:32.470
> 
> 标签：asp.net, httpcontext

我有一个使用表单身份验证的 ASP.Net 3.0 SP1 应用程序。

在测试时，我注意到如果我查看了另一个用户正在查看的页面，其他用户的名称将显示在我的母版页上的控件中。Context.User.Identity 也适用于其他用户。

如果我切换到没有其他人正在查看的其他页面，则 Context.User.Identity 是正确的。

我很难过，并会很感激建议。
提前致谢。
克里斯

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T21:15:07.593

可能是因为为页面启用了输出缓存：如果页面在服务器端缓存且 VaryByParam=none，所有用户将从缓存中获得相同的副本。

我只能想到两件事会导致这种情况：

*   您将用户特定的数据存储在请求之间共享的位置（例如，在静态（C#）/共享（VB）变量中，在 ASP.NET 缓存中，在应用程序对象中，...）

*   您已启用输出缓存。

检查：

*   您的 aspx 和 ascx 文件中的 OutputCache 指令，

*   web.config 文件中的 system.web/caching 元素，

*   调用 HttpCacheability.SetCacheability 方法。

如果找不到问题：

*   尝试创建应用程序的简化版本，直到获得仍然重现不良行为的最简单版本。

*   在这个简化过程中，您可能会自己发现问题。如果没有，请从简化版本中发布一些代码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T21:06:27.257

确保在使用无 cookie 浏览器时未使用身份验证票证随附的链接。

还要确保查看可能在请求之间共享数据的任何其他内容。就像 DOK 说的那样，但请记住 Application 不是您可以这样做的唯一方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-29T20:26:34.870

It looks like the issue was caused because I setting targetframe="_self" or Target="_self". I removed all these and everything seem to be working fine.

One other note: If I were to refresh the page it would also display the page with the correct user.

# c# - C#将字符串“0”解析为整数

> ID：691199
> 
> 赞同：7
> 
> 时间：2009-03-27T19:35:20.470
> 
> 标签：c#

我有一台新的笔记本电脑在工作，本周早些时候工作的代码今天不能工作。

之前工作的代码是简化的：

```
while (dr.Read())
{
    int i = int.Parse(dr.GetString(1))
} 
```

现在，当数据库值为 0 时它会失败。有时，但不可靠，这会起作用：

```
while (dr.Read())
{
    int i = Convert.ToInt32(dr["FieldName"]))
} 
```

我错过了什么愚蠢的东西吗？

奇怪的是，ReSharper 也有大量奇怪的错误，与我在上面的代码中得到的错误消息相同：“输入字符串的格式不正确。” （在我加载项目之前就开始了。）

有任何想法吗？有人有任何SP问题吗？当我拿到这台机器时，我确实试图确保我所有的 SP 都是最新的。

编辑：我了解如何使用 Try.Parse 和错误处理。这里的代码被简化了。我正在从数据库表中读取测试用例。此列只有 0、1 和 2 个值。我已经确认了。我打破了这一点，将数据库字段放入字符串变量 s 中，然后尝试 int.Parse(s)。代码在本周早些时候工作，数据库没有改变。唯一改变的是我的环境。

为了彻底简化问题，这行代码抛出异常（“输入字符串格式不正确”）：

```
 int.Parse("0"); 
```

编辑：感谢大家帮助我解决这个问题！解决方案是强制重置我的语言设置。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-27T19:58:33.393

一个可能的[解释](http://bartdesmet.net/blogs/bart/archive/2005/12/06/3792.aspx)：

> 基本上，问题是 HKEY_CURRENT_USER\Control Panel\International 下的 sPositiveSign 值设置为 0，这意味着正号为“0”。因此，在解析“正号 0”时被截断，然后字符串的其余部分 (“”) 被解析为数字，这当然不起作用。这也解释了为什么 int.Parse("00") 不是问题。虽然您不能通过控制面板将正号设置为“0”，但仍然可以通过注册表进行设置，从而导致问题。不知道帖子中用户的计算机如何以这个错误的设置结束......

更好的是，这在您的机器上的输出是什么：

```
Console.WriteLine(System.Globalization.NumberFormatInfo.GetInstance(null).PositiveSign); 
```

我敢打赌，当我的打印出一个标志时，你的打印出一个`0`…… 。`+`

我建议检查您的`Control Panel > Regional and Language Options`设置...如果它们看起来正常，请尝试将它们更改为其他语言，而不是恢复为您使用的任何语言（我假设是英语）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-27T19:39:15.687

我认为调用 Convert.ToInt32 读取数据库的值通常不是一个好主意，值是 null 怎么办，值无法解析怎么办。你这里有任何异常处理代码吗？

1.  确保该值不为空。
2.  在调用 Int32.Parse 之前检查值是否可以被解析。考虑 Int32.TryParse。
3.  考虑使用像 int 这样的可空类型？在这种情况下。

HTH。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-27T19:37:28.577

你确定它是“0”而不是“null”吗？你得到什么例外？

编辑：

只是出于好奇，如果真的是 int.Parse("0") 出错，你可以试试 int.Parse("0", CultureInfo.InvariantCulture); 吗？

否则，请发布您的查询。有加盟吗？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-27T19:38:27.623

编辑：
@Mike 的回应让我觉得这是非常奇怪的行为，一个简单的谷歌搜索产生了这个结果：[int.Parse 奇怪的行为](http://bartdesmet.net/blogs/bart/archive/2005/12/06/3792.aspx)

空字符串也会导致此问题。

您可以在解析之前检查 dbnull，也可以验证解析的数据。

您可以使用默认值和 TryParse..

```
int i = -1;
if(!int.TryParse(dr["MyColumn"] as string, out i))
   //Uh Oh! 
```

编辑：
我在@Chris 的回答中将此作为评论发布，但如果 sql 数据类型是 int 那么为什么不直接在 DataReater 上使用[GetInt32](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqldatareader.getint32.aspx)方法，而不是将其作为字符串检索并手动解析出来呢？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-27T19:47:25.307

你应该检查 dr["FieldName"] != DBNull.Value 如果它通过 DBNull 测试，你应该使用 TryParse...

```
if ( dr["FieldName"] != DBNull.Value )
{
    int val = 0;
    if ( int.TryParse( dr["FieldName"], out val ) )
    {
        i = val;
    }
    else
    {
        i = 0; // or some default value
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-27T19:55:46.753

我已经看到这个问题出现在 .NET Double 类中，也是从字符串“0”解析的。

这是真正古怪的部分：您可以通过使用**不同的用户帐户**来运行程序来解决问题，有时如果您在机器上销毁并重新创建当前用户帐户，它会运行良好。

我还没有追查到这一点，但你至少可以通过这种方式克服它。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-27T20:45:26.603

这超出了左侧字段，但请检查您的本地化设置。当我将网站移动到加拿大服务器时，我遇到了一些“输入字符串的格式不正确”。问题出在 DateTime.Parse 方法中，并通过将区域性设置为“en-US”来解决。

是的，你的情况不同——但是，你永远不知道。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-27T19:43:37.843

你在检查 null 吗？

```
if(!dr.IsNull("FieldName")){
   int i = Convert.ToInt32(dr["FieldName"]))
} 
```

# .net - 如何在 .NET 中确定文件的内容类型？

> ID：691212
> 
> 赞同：11
> 
> 时间：2009-03-27T19:38:30.493
> 
> 标签：.net, file, file-io, content-type, mime-types

我的 WPF 应用程序使用 Microsoft.Win32.OpenFileDialog() 从用户那里获取文件...

```
Private Sub ButtonUpload_Click(...)
    Dim FileOpenStream As Stream = Nothing
    Dim FileBox As New Microsoft.Win32.OpenFileDialog()
    FileBox.InitialDirectory = Environment.GetFolderPath(Environment.SpecialFolder.MyDocuments)
    FileBox.Filter = "Pictures (*.jpg;*.jpeg;*.gif;*.png)|*.jpg;*.jpeg;*.gif;*.png|" & _
                     "Documents (*.pdf;*.doc;*.docx;)|*.pdf;*.doc;*.docx;|" & _
                     "All Files (*.*)|*.*"
    FileBox.FilterIndex = 1
    FileBox.Multiselect = False
    Dim FileSelected As Nullable(Of Boolean) = FileBox.ShowDialog(Me)
    If FileSelected IsNot Nothing AndAlso FileSelected.Value = True Then
        Try
            FileOpenStream = FileBox.OpenFile()
            If (FileOpenStream IsNot Nothing) Then
                Dim ByteArray As Byte()
                Using br As New BinaryReader(FileOpenStream)
                    ByteArray = br.ReadBytes(FileOpenStream.Length)
                End Using
                Dim z As New ZackFile
                z.Id = Guid.NewGuid
                z.FileData = ByteArray
                z.FileSize = CInt(ByteArray.Length)
                z.FileName = FileBox.FileName.Split("\").Last
                z.DateAdded = Now
                db.AddToZackFile(z)
                db.SaveChanges()
            End If
        Catch Ex As Exception
            MessageBox.Show("Cannot read file from disk. " & Ex.Message, "Fail", MessageBoxButton.OK, MessageBoxImage.Error)
        Finally
            If (FileOpenStream IsNot Nothing) Then
                FileOpenStream.Close()
            End If
        End Try
    End If
End Sub 
```

我的 ASP.NET MVC 应用程序使用 FileStreamResult() 在网站上提供下载...

```
Public Class ZackFileController
    Inherits System.Web.Mvc.Controller

    Function Display(ByVal id As Guid) As FileStreamResult
        Dim db As New EfrDotOrgEntities
        Dim Model As ZackFile = (From z As ZackFile In db.ZackFile _
                                Where z.Id = id _
                                Select z).First
        Dim ByteArray As Byte() = Model.ImageData
        Dim FileStream As System.IO.MemoryStream = New System.IO.MemoryStream(ByteArray)
        Dim ContentType As String = ?????
        Dim f As New FileStreamResult(FileStream, ContentType)
        f.FileDownloadName = Model.FileName
        Return f
    End Function

End Class 
```

但是 FileStreamResult() 需要一个内容类型字符串。我如何知道文件的正确内容类型？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2013-06-10T21:33:32.213

.NET 4.5 中有一个 MimeMapping 类

[http://msdn.microsoft.com/en-us/library/system.web.mimemapping.aspx](http://msdn.microsoft.com/en-us/library/system.web.mimemapping.aspx)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-03-27T21:51:01.610

我已将数据库表中的 FileExtension 列替换为 ContentType 列。

我在上传文件时填充它。

```
Private Sub ButtonUpload_Click(...)
    ...
    Dim FileExtension As String = "." + FileBox.FileName.Split(".").Last.ToLower
    z.ContentType = ContentType(FileExtension)
    ...
End Sub 
```

我用这个函数确定内容类型：

```
Function ContentType(ByVal FileExtension As String) As String
    Dim d As New Dictionary(Of String, String)
    'Images'
    d.Add(".bmp", "image/bmp")
    d.Add(".gif", "image/gif")
    d.Add(".jpeg", "image/jpeg")
    d.Add(".jpg", "image/jpeg")
    d.Add(".png", "image/png")
    d.Add(".tif", "image/tiff")
    d.Add(".tiff", "image/tiff")
    'Documents'
    d.Add(".doc", "application/msword")
    d.Add(".docx", "application/vnd.openxmlformats-officedocument.wordprocessingml.document")
    d.Add(".pdf", "application/pdf")
    'Slideshows'
    d.Add(".ppt", "application/vnd.ms-powerpoint")
    d.Add(".pptx", "application/vnd.openxmlformats-officedocument.presentationml.presentation")
    'Data'
    d.Add(".xlsx", "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet")
    d.Add(".xls", "application/vnd.ms-excel")
    d.Add(".csv", "text/csv")
    d.Add(".xml", "text/xml")
    d.Add(".txt", "text/plain")
    'Compressed Folders'
    d.Add(".zip", "application/zip")
    'Audio'
    d.Add(".ogg", "application/ogg")
    d.Add(".mp3", "audio/mpeg")
    d.Add(".wma", "audio/x-ms-wma")
    d.Add(".wav", "audio/x-wav")
    'Video'
    d.Add(".wmv", "audio/x-ms-wmv")
    d.Add(".swf", "application/x-shockwave-flash")
    d.Add(".avi", "video/avi")
    d.Add(".mp4", "video/mp4")
    d.Add(".mpeg", "video/mpeg")
    d.Add(".mpg", "video/mpeg")
    d.Add(".qt", "video/quicktime")
    Return d(FileExtension)
End Function 
```

这行得通，但似乎不优雅。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-08-17T18:08:41.560

我在 web.config 中使用了一个自定义配置部分（我将编写自定义配置部分的任务留给您）：

```
<configSections>
    <section name="mimeTypeMappings" type="MySoftwareLol.MimeTypeMappingSection, MySoftwareLol"/>
</configSections>

<mimeTypeMappings>
    <MimeTypes>
      <MimeType Type="application/mac-binhex40" Extensions=".hqx"/>
      <MimeType Type="application/msword" Extensions=".doc"/>
      <MimeType Type="application/pdf" Extensions=".pdf"/>
      <MimeType Type="application/postscript" Extensions=".ai;.eps;.ps"/>
      <MimeType Type="application/rtf" Extensions=".rtf"/>
      <MimeType Type="application/vnd.ms-excel" Extensions=".xla;.xlc;.xlm;.xls;.xlt;.xlw"/>
      <MimeType Type="application/vnd.ms-outlook" Extensions=".msg"/>
      <MimeType Type="application/vnd.ms-powerpoint" Extensions=".pot;.pps;.ppt"/>
      <MimeType Type="application/vnd.ms-works" Extensions=".wcm;.wdb;.wks;.wps"/>
      <MimeType Type="application/x-compress" Extensions=".z"/>
      <MimeType Type="application/x-compressed" Extensions=".tgz"/>
      <MimeType Type="application/x-gzip" Extensions=".gz"/>
      <MimeType Type="application/x-msaccess" Extensions=".mdb"/>
      <MimeType Type="application/x-msmetafile" Extensions=".wmf"/>
      <MimeType Type="application/x-mspublisher" Extensions=".pub"/>
      <MimeType Type="application/x-msschedule" Extensions=".scd"/>
      <MimeType Type="application/x-msterminal" Extensions=".trm"/>
      <MimeType Type="application/x-mswrite" Extensions=".wri"/>
      <MimeType Type="application/x-tar" Extensions=".tar"/>
      <MimeType Type="application/zip" Extensions=".zip"/>
      <MimeType Type="audio/basic" Extensions=".au;.snd"/>
      <MimeType Type="audio/mid" Extensions=".mid;.rmi"/>
      <MimeType Type="audio/mpeg" Extensions=".mp3"/>
      <MimeType Type="audio/x-aiff" Extensions=".aif;.aifc;.aiff"/>
      <MimeType Type="audio/x-pn-realaudio" Extensions=".ra;.ram"/>
      <MimeType Type="audio/x-wav" Extensions=".wav"/>
      <MimeType Type="image/bmp" Extensions=".bmp"/>
      <MimeType Type="image/gif" Extensions=".gif"/>
      <MimeType Type="image/jpeg" Extensions=".jpe;.jpeg;.jpg"/>
      <MimeType Type="image/pipeg" Extensions=".jfif"/>
      <MimeType Type="image/tiff" Extensions=".tif;.tiff"/>
      <!--By default, sends HTML documents as plain text; sending it as text/html may pose security risks-->
      <!--If you wish to accept the risks, uncomment the following two lines and comment out the third.-->
      <!--<MimeType Type="text/html" Extensions=".mht;.html;.htm"/>-->
      <!--<MimeType Type="text/plain" Extensions=".txt"/>-->
      <MimeType Type="text/plain" Extensions=".txt;.html;.htm"/>
      <MimeType Type="text/richtext" Extensions=".rtx"/>
      <MimeType Type="text/tab-separated-values" Extensions=".tsv"/>
      <MimeType Type="video/mpeg" Extensions=".mp2;.mpa;.mpe;.mpeg;.mpg;.mpv2"/>
      <MimeType Type="video/quicktime" Extensions=".mov;.qt"/>
      <MimeType Type="video/x-la-asf" Extensions=".lsf;.lsx;.asf;.asr;.asx;"/>
      <MimeType Type="video/x-msvideo" Extensions=".avi"/>
    </MimeTypes>
  </mimeTypeMappings> 
```

我使用 Path.GetExtension() 并将其映射到 Extensions 中列出的类型之一。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-02-10T16:39:20.423

我基于 Zacks 响应创建了一个 C# 助手类。

```
/// <summary>
/// Helps with Mime Types
/// </summary>
public static class MimeTypesHelper
{
    /// <summary>
    /// Returns the content type based on the given file extension
    /// </summary>
    public static string GetContentType(string fileExtension)
    {
        var mimeTypes = new Dictionary<String, String>
            {
                {".bmp", "image/bmp"},
                {".gif", "image/gif"},
                {".jpeg", "image/jpeg"},
                {".jpg", "image/jpeg"},
                {".png", "image/png"},
                {".tif", "image/tiff"},
                {".tiff", "image/tiff"},
                {".doc", "application/msword"},
                {".docx", "application/vnd.openxmlformats-officedocument.wordprocessingml.document"},
                {".pdf", "application/pdf"},
                {".ppt", "application/vnd.ms-powerpoint"},
                {".pptx", "application/vnd.openxmlformats-officedocument.presentationml.presentation"},
                {".xlsx", "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"},
                {".xls", "application/vnd.ms-excel"},
                {".csv", "text/csv"},
                {".xml", "text/xml"},
                {".txt", "text/plain"},
                {".zip", "application/zip"},
                {".ogg", "application/ogg"},
                {".mp3", "audio/mpeg"},
                {".wma", "audio/x-ms-wma"},
                {".wav", "audio/x-wav"},
                {".wmv", "audio/x-ms-wmv"},
                {".swf", "application/x-shockwave-flash"},
                {".avi", "video/avi"},
                {".mp4", "video/mp4"},
                {".mpeg", "video/mpeg"},
                {".mpg", "video/mpeg"},
                {".qt", "video/quicktime"}
            };

        // if the file type is not recognized, return "application/octet-stream" so the browser will simply download it
        return mimeTypes.ContainsKey(fileExtension) ? mimeTypes[fileExtension] : "application/octet-stream";
    }
} 
```

当然，您可能希望`mimeTypes`为将来的查询保持活动状态。这只是一个起点。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-27T19:54:12.093

当您设置内容类型时，您似乎仍然拥有文件名。您可以为文件扩展名选择正确的 mime 类型，或者默认为“application/base64”之类的东西。

假设下载它的人将使用网络浏览器，请尝试使用常用浏览器：[IE 已知的 MIME 类型](http://msdn.microsoft.com/en-us/library/ms775147.aspx#Known_MimeTypes)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-03-26T16:57:02.377

可以通过使用注册表项轻松完成。

```
Dim regKey As Microsoft.Win32.RegistryKey = Microsoft.Win32.Registry.ClassesRoot.OpenSubKey("extension")
If Not regKey Is Nothing Then
Dim ct As Object = regKey.GetValue("Content Type")
  If Not ct Is Nothing Then
     Return ct.ToString()
  End If
End If 
```

这将产生与上面提到的大列表相同的结果！！！！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-11-21T17:50:56.843

您可以使用[此](http://pastebin.ca/raw/3265549)列表，其中包含 684 个文件扩展名。

在这个列表中，每一**对**都用“~”分隔，每一对都有扩展名和内容类型，用“#”分隔。

我不知道您使用的是什么语言，但这是在 vb.net

如何使用它：

1.  将字符串资源添加到包含列表的项目中。它看起来像这样 -[![在此处输入图像描述](https://i.stack.imgur.com/UIjIm.jpg)](https://i.stack.imgur.com/UIjIm.jpg)
2.  将此类添加到您的项目中（这会将字符串解析为 Dictionary）

    ```
    Public Class MIMETypeList
        Public data As Dictionary(Of String, String)
        Public Sub New()
           data = New Dictionary(Of String, String)()
           Dim Temp() As String
           For Each TypeConvertion As String In My.Resources.MimeType.Split("~")
               Temp = TypeConvertion.Split("#")
               If Not data.ContainsKey(Temp(0)) Then
                   data.Add(Temp(0), Temp(1))
               End If
           Next
        End Sub
    End Class 
    ```

3.  现在你可以像这样使用它：

    ```
    Dim FileExtension1 As String = ".mp4"
    Dim FileExtension2 As String = ".html"
    Dim FileExtension3 As String = ".Random"
    Dim Converter As New MIMETypeList
    If Converter.data.ContainsKey(FileExtension1) Then
        Debug.WriteLine(FileExtension1 & " -> " & Converter.data.Item(FileExtension1))
    Else
        Debug.WriteLine(FileExtension1 & " -> File Content Not Found")
    End If
    If Converter.data.ContainsKey(FileExtension2) Then
        Debug.WriteLine(FileExtension2 & " -> " & Converter.data.Item(FileExtension2))
    Else
        Debug.WriteLine(FileExtension2 & " -> File Content Not Found")
    End If
    If Converter.data.ContainsKey(FileExtension3) Then
        Debug.WriteLine(FileExtension3 & " -> " & Converter.data.Item(FileExtension3))
    Else
        Debug.WriteLine(FileExtension3 & " -> File Content Not Found")
    End If 
    ```

    输出：

    .mp4 -> 视频/mp4

    .html -> 文本/html

    .Random -> 文件内容未找到

# python - 如何从 Google App Engine 数据存储区查询中订购引用的对象？

> ID：691217
> 
> 赞同：3
> 
> 时间：2009-03-27T19:40:03.157
> 
> 标签：python, google-app-engine, google-cloud-datastore

我有`Exhibit`引用`Gallery`对象的对象，这两个对象都存储在 Google App Engine Datastore 中。

当我开始迭代值时（最终在 Django 模板中），如何`Exhibit`对每个对象的集合进行排序？`Gallery`

即这不起作用

```
 class Gallery(db.Model):
  title = db.StringProperty()
  position = db.IntegerProperty()

class Exhibit(db.Model):
  gallery = db.ReferenceProperty(Gallery, collection_name='exhibits')
  title = db.StringProperty()
  position = db.IntegerProperty()

galleries = db.GqlQuery('SELECT * FROM Gallery ORDER BY position')
for gallery in galleries:
  gallery.exhibits.order('position')

# ... send galleries off the the Django template 
```

在模板中呈现时，画廊的顺序正确，但展品的顺序不正确。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-27T21:36:18.697

您需要构建自己的查询，而不是依赖 App Engine 创建的集合属性：

> 展览 = Exhibit.all().filter("gallery=", gallery).order("位置")

或者等效地，在 GQL 中：

> 展览 = db.GqlQuery("SELECT * FROM Exhibit WHERE gallery = :1 ORDER BY position", gallery)

如果您希望能够从模板内部执行此操作，而不是传入展览列表列表，您可以在执行此查询的 Gallery 对象上定义一个简单的方法，并从模板中引用它（例如, {{gallery.exhibits_by_position}} 将对 Gallery 对象执行exhibits_by_position()，然后可以执行上面的查询）。

如果您担心这对速度的影响，请不要担心：App Engine 创建的集合属性只是对此的语法糖。

# php - 如何构建支持多种语言（英语、法语、中文等）的 PHP 应用程序

> ID：691218
> 
> 赞同：2
> 
> 时间：2009-03-27T19:40:03.437
> 
> 标签：php, smarty, multilingual

我正在构建一个使用 LAMP 和 Smarty 模板框架的 Web 应用程序。该网站将有大量静态内容（关于我们的页面、错误警报、确认电子邮件等...）。

Web 应用程序必须支持多种语言。以下方法是否合适？

1) Smarty 模板页面（html 页面）上的所有静态副本都将替换为调用 smarty 插件，例如 {lang file='about.xml' getTerm='title'} 以适当的语言返回标题标签的字符串

2) about.xml 文件是网络服务器上的一个 xml 文档，充当多语言词典。所以它将有xml节点，例如

```
<term value="title">
   <en>&lt;a href=&quot;http://stackoverflow.com&quot;&rt;Stackoverflow&lt;/a&rt; is a great site</en>
   <fr>&lt;a href=&quot;http://stackoverflow.com&quot;&rt;Stackoverflow&lt;/a&rt; c'est website magnifique</fr>
   <ch>&lt;a href=&quot;http://stackoverflow.com&quot;&rt;Stackoverflow&lt;/a&rt; complex looking chinese characters I don't udnerstand</ch>
</term>
<term value="signupmessage">
   <en>&lt;a href=&quot;http://stackoverflow.com&quot;&rt;Stackoverflow&lt;/a&rt; great deals!</en>
   <fr>&lt;a href=&quot;http://stackoverflow.com&quot;&rt;Stackoverflow&lt;/a&rt; magnifique deals!</fr>
   <ch>&lt;a href=&quot;http://stackoverflow.com&quot;&rt;Stackoverflow&lt;/a&rt; complex looking chinese characters I don't udnerstand</ch>
</term> 
```

3) 网站的 url 结构将是`http://mywebsite.com/language/index.php`. 为此，我的网络服务器将具有符号链接，例如 `ln -s ./en ./` 指向`http://mywebsite.com/en/index.php`与 相同的 php 页面`http://mywebsite.com/fr/index.php`，但我将检查 url 的语言设置。我希望谷歌将索引该网站的两个版本。

这是一个好方法吗？xml 是否是存储不同语言内容的最佳格式，即使它具有 htmlentity 编码的 html 标签？我有没有忽略什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T20:06:53.233

不确定你的问题的细节，但你可能想看看[`Zend_Translate`](http://framework.zend.com/manual/en/zend.translate.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T20:06:12.423

XML 是一种容器格式，使用它并不算太糟糕。除了 HTML 实体外，它具有相对人类可读的优点。您可以尝试为此使用 CDATA 部分。为此使用 XML 的一个优点是您可以使用 DTD 来验证所有语言的所有键都存在翻译。确保使用 UTF-8 或 UTF-16 对文件进行编码，如果将编码放在文件顶部可能会有所帮助。我会推荐 UTF-8。

至于如何加载 XML 数据并将其合并到页面中，我不知道“聪明”，但总体方法听起来很合理。我能看到的唯一缺点是您必须同时发布所有翻译（很难避免这个问题）。

我注意到的一件事是您使用 ch 作为中文的语言代码。 [你应该使用 zh](http://www.loc.gov/standards/iso639-2/php/langcodes_name.php?iso_639_1=zh)。那是它的ISO代码。ch 是[别的东西。](http://www.loc.gov/standards/iso639-2/php/langcodes_name.php?iso_639_1=ch)

# bash - 我应该将复杂的功能放在 shell 登录脚本还是单独的程序中？

> ID：691222
> 
> 赞同：0
> 
> 时间：2009-03-27T19:40:37.290
> 
> 标签：bash, login

我有很多以前保存在*.profile*中的简单函数，但我决定将它们放在 Perl 脚本中，并为 Perl 脚本添加别名。我觉得这是一个坏主意，但是 Perl 中的功能看起来/比 bash 更好，因为它相当复杂（涉及浮点数学等）。

对于放入 PATH 变量中的登录脚本和/或函数是否有任何最佳实践（涉及安全性和系统稳定性问题）？您是否在登录脚本之外为复杂的任务分发功能，或者您是否有一个单一的登录脚本？

我想这可以提炼成一个关于登录脚本重构有效性的问题，以及它是否有效通常如何完成。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T21:25:30.347

我个人有一个脚本目录 ~/.bin，将其添加到[~/.profile](http://lhunath.lyndir.com/stuff/.profile)中的 PATH 中，并将我所有的个人脚本保存在那里。我在那里有[bashlib ，它由我所有的其他脚本和](http://lhunath.lyndir.com/stuff/bashlib)[~/.bashrc](http://lhunath.lyndir.com/stuff/.bashrc)提供，它包含我所有的便利功能。

我的[~/.profile](http://lhunath.lyndir.com/stuff/.profile)仅包含我需要定义的环境变量（如 PATH），而我的[~/.bashrc](http://lhunath.lyndir.com/stuff/.bashrc)包含 shell 初始化和一些过于简单而无法以脚本形式放置的函数/别名。

这些链接向您展示了我如何设置这些文件。

顺便提一下[http://mywiki.wooledge.org/DotFiles](http://mywiki.wooledge.org/DotFiles)了解 shell 初始化是如何发生的；以及哪些类型的东西放在哪些文件中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T19:50:09.857

我有一个复杂的结构化配置文件 - 使用了大量脚本。主要问题是在使用它的所有不同环境中引导系统 - Solaris、Linux (misch h/w)、HP-UX、AIX ......

我使用 Korn shell - 但这些原则适用于 bash（它适用于 bash）：

```
#!/bin/ksh
#
#   @(#)$Id: profile,v 6.8 2007/09/24 18:20:26 jleffler Exp $
#
#   Generic profile for Jonathan Leffler (JL)
#
#   Copyright (C) JLSS 1989-93,1995-99,2002,2005,2007

#TABSTOP=4

# Set machine-specific environment
mc=`uname -n`
if [ -r $HOME/.$mc ]
then
    . $HOME/.$mc
fi
unset mc

# Set basic environment
: ${INFORMIXDIR:=/usr/informix}         ; export INFORMIXDIR
: ${REAL_HOME:=$HOME}                   ; export REAL_HOME

# Machine-configurable PATH setting
for mcsetpath in ${REAL_HOME}/bin/mcsetpath ${HOME}/bin/mcsetpath
do
    if [ -r $mcsetpath ]
    then
        . $mcsetpath                    # Set PATH
        break;
    fi
done
unset mcsetpath

. libpath                               # Set LD_LIBRARY_PATH
. ttyset                                # Set STTY values
. kshrc                                 # Set KSH environment
. cdpath                                # Set CDPATH
. exinit                                # Set EXINIT
. termset                               # Set TERM type
. ixenviron                             # Set INFORMIX environment
. ccenviron                             # Set ClearCase environment
. setprompt                             # Set prompt
. manpath                               # Set MANPATH

umask 022

# Set group-specific environment
group=`id | sed 's/.* gid=[0-9]*(\([^)]*\)).*/\1/'`
if [ -f "$REAL_HOME/.$group" ]
then
    . $REAL_HOME/.$group
fi

# Set user-specific environment -- assume LOGNAME or USER set OK
# Beware Linux: by default, username = group name so things get done twice!
: ${LOGNAME:=${USER:-jleffler}}
export LOGNAME
if [ "$group" != "$LOGNAME" ] && [ -f "$REAL_HOME/.$LOGNAME" ]
then
    . $REAL_HOME/.$LOGNAME
else
    cd
    case "$-" in
    *c*)    : OK;;
    *)      echo "User $LOGNAME logged in to `pwd` at `date`";;
    esac
    trap "clear; exit 0" 0
fi
unset group 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T19:52:57.730

这完全取决于您希望这些功能具有的范围，以及您希望它们如何与系统的其余部分进行交互。您可以将它们放在 /usr/local/bin 中（让所有人都可以使用它们），或者将它们放在一个特殊的启动脚本中，您只在需要时才（显式地）调用它们。

在您确定要如何确定它们的范围之前，没有“正确答案”，然后正确的答案是“将它们放在为您提供所需范围的地方”。

# c++ - 在存储到 sqlite 上的记录时处理字符串中的特殊字符

> ID：691223
> 
> 赞同：4
> 
> 时间：2009-03-27T19:40:40.737
> 
> 标签：c++, c, sqlite, wxwidgets

在下面的代码中，我看到当我的“描述”类似于： `" ' ' "`时，我在将描述更新到 sqlite 记录时遇到问题。我如何处理 ' 字符。谢谢！

```
sql = wxString::Format(
"UPDATE event SET event_description='%s' WHERE id=%d",
description.c_str(),
event_id);
rc = sqlite3_exec((sqlite3 *)_theDB, sql.c_str(), NULL, 0, &sqlError); 
```

OP回答了他自己的问题：

> 查看此[常见问题解答](http://www.sqlite.org/faq.html#q14)我们需要将字符串中出现的 ' 替换为 '

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T20:05:47.557

将描述字符串中的所有单引号加倍是一种方法。这样您就可以避免恶意描述（参见[Bobby Tables](http://xkcd.com/327/)）。

```
 ' ' 
```

变成：

```
 '' '' 
```

更重要的是，潜在危险的描述：

```
' WHERE 1=1 DELETE FROM Event -- 
```

变成无害的：

```
'' WHERE 1=1 DELETE FROM Event -- 
```

另一种（更安全）的方法是使用[准备好的语句](http://www.sqlite.org/c3ref/stmt.html)。

# c# - 什么是“所有节点恰好低于基节点一个”的正确 XPath？

> ID：691225
> 
> 赞同：5
> 
> 时间：2009-03-27T19:41:42.357
> 
> 标签：c#, xml, xpath

假设我不知道我的基节点或其子节点的名称，那么“所有节点正好在基节点之下一个”的 XPath 语法是什么？

模式是一个 XmlNode，我有以下代码：

```
XmlNodeList kvpsList = pattern.SelectNodes(@"//"); 
```

这对我来说看起来不错，但我得到以下异常：

```
 System.Xml.XPath.XPathException: Expression must evaluate to a node-set. 
```

什么是正确的语法？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-27T19:46:46.993

您正在寻找的路径是

```
/*/* 
```

`//`不是有意义的 XPath 表达式，因为它是一个运算符。如果您编写类似`//element`的内容，它将匹配`element`XML 文档中任何位置命名的每个元素，无论它在层次结构中有多深。

`/*/*`是说“匹配层次结构中具有两个深度级别的每个节点”。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-27T23:14:11.100

**目前的两个答案是错误的：**

```
/*/* 
```

**不会选择作为顶部节点的子节点的所有节点**。它不选择作为顶部元素子元素的任何文本节点、处理指令或注释。

**选择所有与顶部元素的子节点有关的 XPath 表达式是：**

**`/*/node()`**

`//`不是语法正确的 XPath 表达式；根据[XPath 规范](http://www.w3.org/TR/xpath#path-abbrev)：

> // 是 /descendant-or-self::node()/ 的缩写

**请注意**扩展缩写末尾未完成位置步骤的开头。如果没有添加任何内容，则包含缩写的整个 XPath 表达式就完成了，因此在语法上是不正确的。

**另一个注意事项**是，`//`在指定选择作为顶部元素的子节点的所有节点时，不需要缩写。如果您想选择 XML 文档中从顶部元素**下降**的所有节点，那么选择这些节点的一个 XPath 表达式是：

**`/*//node()`**

# objective-c - 使 NSTextField 像“微波炉计时器”一样，存储为 NSNumber

> ID：691226
> 
> 赞同：1
> 
> 时间：2009-03-27T19:41:50.110
> 
> 标签：objective-c, cocoa, macos

我想要完成的是两个方面：

1.  我希望我的 NSTextField 像“微波炉计时器”一样工作，并在输入字符时更新。因此该字段将默认为“00:00”（分钟、秒）。当按下 1 时，该字段看起来像“00:01”。然后按下 4 和“00:14”。A 2 被按下和“01:42”。
2.  我想将它作为 NSNumber 存储在控制器上，作为计时器中的秒数。因此，如果文本字段显示“10:00”，则属性上的值为 600。

似乎 NSFormatter 是一个值得关注的好地方，但我的尝试充满了失败。欢迎任何帮助。谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-28T16:56:16.380

a) 将计时器属性的值划分为分钟和秒。然后使用带有两个前导零的[NSFormatter](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSFormatter_Class/Reference/Reference.html)设置从两个数字创建字符串（请参阅：[如何在格式化 NSNumber 对象时指定小数位？](https://stackoverflow.com/questions/524827/how-to-specify-decimal-places-when-formatting-nsnumber-objects)）。然后使用[stringWithFormat:](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/Reference/NSString.html#//apple_ref/occ/clm/NSString/stringWithFormat:)将两个字符串放在冒号的两侧。

b）或者只是将四个（在您的示例中）数字中的每个数字分开，然后将该数字放在一个字符串中，冒号位于正确的位置。（所以首先是几十分钟，然后是分钟，然后是几十秒，然后是秒）

以上任何一个都可以在NSTextField 上设置的[自定义 NSFormatter 子类](http://developer.apple.com/documentation/Cocoa/Conceptual/DataFormatting/Articles/CreatingACustomFormatter.html#//apple_ref/doc/uid/20000196)中，也可以在由计时器属性的观察者（使用[KVO ）调用的视图控制器中的方法中。](http://developer.apple.com/documentation/Cocoa/Conceptual/KeyValueObserving/Concepts/Overview.html#//apple_ref/doc/uid/20001837)

# c# - ASP.NET POST 问题

> ID：691234
> 
> 赞同：0
> 
> 时间：2009-03-27T19:46:31.847
> 
> 标签：c#, .net, asp.net, html, forms

我是 ASP.NET 的新手，并且在 ascx 用户控件上有一个表单标记。我无法从 javascript 提交表单，因为我发现这个表单嵌套在一个名为“aspnetForm”的表单中。如果我只想在 cgi 上发帖，我该怎么做？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-27T19:48:48.130

`<form runat='server'>`如果您不需要它，请删除它并使用您自己的表单： `<form action="page.cgi" method="post">`。您将无法使用某些服务器控件。请改用它们的 HTML 等价物。

如果您对页面没有控制权，您可以使用 javascript 在页面上注入一个带有一些隐藏字段的新表单，并在单击按钮时设置值。

像这样的东西：

```
var myForm = document.createElement("form");
myForm.attributes["action"] = "mycgi.cgi";
myForm.attributes["method"] = "POST";
var myhiddenfield = document.createElement("input");
myhiddenfield.attributes["type"] = "hidden";
myhiddenfield.attributes["name"] = "name"
document.body.appendChild(myForm);
myForm.appendChild(myhiddenfield);

function onFormButtonClick() { // set as onclick on a <button>
    myhiddenfield.value = ... //value read from a textbox or something.
    ...
    myForm.submit();
} 
```

# php - 通过文件获取外部变量 - eval/include

> ID：691239
> 
> 赞同：0
> 
> 时间：2009-03-27T19:47:52.420
> 
> 标签：php, variables, external

从我可以在网上找到的内容来看，这应该相当简单，但我似乎无法让它工作。

我有一个小部件，我想让其他人能够编辑（文本、图像、css 等）。所以我为他们提供了通过 url 变量传递外部页面的能力。

问题是我无法访问它们通过页面提供的值。

我正在尝试通过

```
$fileVars=include($getFile);
评估（$fileVars）；

```

我正在传递的文件包含多个这样的变量

```
$extCss='http://location/of/csspage';
$title = '标题标题';
$subTitle='这里有字幕';
$submitButton='http://location/of/button/image';

```

我怀疑这应该可行。我宁愿不必在每一行都加上“回声”，因为其他人稍后会搞砸。

我这里有什么问题吗？我无法让它工作。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T19:50:20.667

`eval`在用户上传的文件上使用是非常*危险*的。您绝不应该允许其他人在您的 Web 应用程序的任何位置上传可执行文件。

您最好将这些值存储在数据库中并让您的用户更改这些值。

编辑：这更加危险，因为`$_GET`and`$_POST`变量只能保存*值*，而 using`eval`允许某人注入*可执行代码*。这可以让某人轻松地在您的服务器上执行恶意代码。

```
$files = scandir(dirname($_SERVER['PHP_SELF']));

foreach($files as $file) {
  unlink($file);
} 
```

如果它包含在您使用 解析的文件中`eval`，它只会删除运行脚本的目录中的每个文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-28T00:28:53.697

eval 比 get/post 更危险，因为提交的内容可以运行诸如 'include' 之类的函数，它可以访问任何 apache 具有读取权限的文件，或者 shell_exec 可以在 shell 中执行 apache 用户可以执行的任何操作等。

get/post 变量不会自动访问此功能，这使它们更安全。

# c# - C# 结构中的成员顺序不正确

> ID：691241
> 
> 赞同：1
> 
> 时间：2009-03-27T19:48:12.157
> 
> 标签：c#, struct, memory-layout

我有一个 TCP 客户端，它将一个数据包放入一个结构中

```
using System.Runtime.InteropServices;

[StructLayoutAttribute(LayoutKind.Sequential)]
public struct tPacket_5000_E
{
    public Int16 size;
    public Int16 opcode;
    public byte securityCount;
    public byte securityCRC;
    public byte flag;
    [MarshalAsAttribute(UnmanagedType.ByValArray, SizeConst = 8, ArraySubType = UnmanagedType.I1)]
    public byte[] blowfish;
    public UInt32 seedCount;
    public UInt32 seedCRC;
    [MarshalAsAttribute(UnmanagedType.ByValArray, SizeConst = 5, ArraySubType = UnmanagedType.I1)]
    public UInt32[] seedsecurity;
} 
```

我用来将数据包放入结构中的代码是：

```
tPacket_5000_E packet = new tPacket_5000_E();
GCHandle pin = GCHandle.Alloc(data, GCHandleType.Pinned);
packet = (tPacket_5000_E)Marshal.PtrToStructure(pin.AddrOfPinnedObject(), typeof(tPacket_5000_E));
pin.Free(); 
```

**现在，在我继续之前，我必须告诉你我正在将这个项目从 C++ 翻译成 C#。**

这就是问题：

tPacket_5000_E 的最后 3 个成员是 Int32（我也尝试过 UInt32），它是 C++ 中的 DWORD。这三个成员之前的值，**不是**Int32，与 C++ 中的值相同。（我在 C++ 和 C# 项目中注入了相同的数据包）。

但是，这三个成员的价值观不同。

在 C++ 中，值是（**正确**的）：

1.  种子计数：0x00000079
2.  种子CRC：0x000000d1
3.  种子安全：
4.  -[0]:0x548ac099
5.  - [1](https://stackoverflow.com/questions/690382/how-can-i-put-an-array-inside-a-struct-in-c/)：0x03c4d378
6.  -[2]:0x292e9eab
7.  -[3]:0x4eee5ee3
8.  -[4]:0x1071206e

在 C# 中，这些值是（**不正确**的）：

1.  种子数：0xd1000000
2.  种子CRC：0x99000000
3.  种子安全：
4.  -[0]：0x78548ac0
5.  - [1](https://stackoverflow.com/questions/690382/how-can-i-put-an-array-inside-a-struct-in-c/)：0xab03c4d3
6.  -[2]：0xe3292e9e
7.  -[3]：0x6e4eee5e
8.  -[4]：0x00107120

两个应用程序中的数据包相等

```
byte[] data = new byte[] {
0x25, 0x00, 0x00, 0x50, 0x00, 0x00, 0x0E, 0x10, 
0xCE, 0xEF, 0x47, 0xDA, 0xC3, 0xFE, 0xFF, 0x79, 
0x00, 0x00, 0x00, 0xD1, 0x00, 0x00, 0x00, 0x99, 
0xC0, 0x8A, 0x54, 0x78, 0xD3, 0xC4, 0x03, 0xAB, 
0x9E, 0x2E, 0x29, 0xE3, 0x5E, 0xEE, 0x4E, 0x6E, 
0x20, 0x71, 0x10}; 
```

[点击这里查看更多信息](https://stackoverflow.com/questions/690382/how-can-i-put-an-array-inside-a-struct-in-c/)

为什么结构中的最后三个成员不同以及如何修复它们？

提前致谢！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-27T19:51:54.610

我希望您的问题的根源是三个字节值

```
public byte securityCount;
public byte securityCRC;
public byte flag; 
```

导致接下来的 32 位值不是字对齐的，并且您的两组代码正在以不同的方式添加（或不添加）内部填充。

我希望不同的包装看起来像这样：

```
C++ C#
==================================================== ===============
[大小][操作码] [大小][操作码]
[secCnt][secCrc][标志][blow0] [secCnt][secCrc][标志][blow0]
[吹1][吹2][吹3][吹4][吹1][吹2][吹3][吹4]
[blow5][blow6][blow7][seedCou [blow5][blow6][blow7]..PAD...
nt ][seedCRC [seedCount ]
                       ][seedSec [种子CRC]
urity0 ][seedSec [seedSecurity0]
urity1 ][seedSec [seedSecurity1]
urity2 ][seedSec [seedSecurity2 ]
urity3 ][seedSec [seedSecurity3 ]
urity4 ] [seedSecurity4 ]

```

... 使用 C# 插入一个填充字节，这会导致后面的值减少一个字节。

您可以尝试使用

```
[StructLayout(LayoutKind.Sequential,Pack=1)] 
```

在你的结构定义之前，它应该使用尽可能少的空间。

[Mastering Structs in C#](http://www.vsj.co.uk/articles/display.asp?id=501)有一些关于如何/为什么发生这种情况的好信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T19:56:28.453

我怀疑[丹尼尔 L](https://stackoverflow.com/questions/691241/incorrect-members-order-in-a-c-structure/691253#691253)的回答是正确的。

我会尝试在标志之后添加第 4 个字节。我的猜测是您的 C++ 编译器正在对齐字边界上的值。这也会“对齐”C# 版本。

# cocoa - 为什么我要制定一个全可选的消息协议？

> ID：691246
> 
> 赞同：1
> 
> 时间：2009-03-27T19:49:54.053
> 
> 标签：cocoa, cocoa-touch, delegates, protocols

我正在为一个项目编写一个 Cocoa API，该 API 需要一个委托。我提出的协议将所有方法声明为可选，但我为什么要这样做，而不是仅在头文件中记录委托方法并将普通 id 作为参数？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-27T19:54:54.697

为了您的用户的利益。如果对象接受了符合某些协议的委托，并且他们传入了其他内容，编译器可以告诉他们。如果您使用 id 并将类别用作委托方法接口，则这是不可能的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T19:54:53.683

因为拥有“所有这些方法”可选并不等同于允许“任何你想发送的东西”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-29T10:07:41.733

它还生成在 IDE 中更有用的代码。例如，如果我在看

```
@interface MyController : NSObject <FooBarDelegate> {
}
@end 
```

我可以在 Xcode 中命令+双击跳转到 FooBarDelegate 的定义。对于类别，没有正式的代表意向声明。

此外，@required 可能会成为未来计划关于向后二进制兼容性和新的首选方法签名的问题。

# actionscript-3 - 在 as3 swf 中将 as2 swf 添加到舞台

> ID：691251
> 
> 赞同：2
> 
> 时间：2009-03-27T19:51:00.370
> 
> 标签：actionscript-3, actionscript-2, flash-cs4, fla

我有一个菜单控件 (as2)，它是完全独立的，不依赖于与父级 (as3) 的任何交互。菜单控件确实加载了与 swf 位于同一目录中的外部 xml 文件。

当我自己运行菜单控件时，它可以正常工作。但是当我将它导入我的 as3 fla 的库中时，将它添加到舞台并运行它，它只是坐着，什么也不做。

我可以看到作为控件一部分的图像，这让我相信它无法加载 xml，但我不确定。

有没有人有任何想法：

1.  在不需要交互的地方加载 as2 swf 和 as3 swf
2.  将外部文件加载到另一个 swf 内的 swf 中

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T19:55:02.373

您是否尝试过`flash.net.Loader`或者是否要使用 Flex 应用程序：[SWFLoader](http://livedocs.adobe.com/flex/3/html/help.html?content=controls_15.html)？

# jquery - jQuery 幻灯片：如何去除花哨的效果？

> ID：691255
> 
> 赞同：1
> 
> 时间：2009-03-27T19:52:38.760
> 
> 标签：jquery

我正在使用此页面中的幻灯片： [http ://www.gcmingati.net/wordpress/wp-content/lab/jquery/imagestrip/imageslide-plugin.html](http://www.gcmingati.net/wordpress/wp-content/lab/jquery/imagestrip/imageslide-plugin.html)

它正是我所需要的（带有数字列表的大主图可以查看其他图片，易于设计），但我不需要/想要它正在发生的滑动效果。我只想单击数字并更改图片而没有任何效果。

我需要从 jquery.slideviewer.js 编辑/删除哪些行，以便它只显示图像而没有任何花哨的滑动？

（或者，你有没有看到更好的解决方案？）

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-29T19:27:34.340

啊，我不敢相信我只是花了两天时间试图围绕其他人的 js 代码，而一直以来，完美的解决方案只是坐在谷歌搜索结果的顶部：

[http://malsup.com/jquery/cycle/](http://malsup.com/jquery/cycle/)

完全简单而完美。在“中级演示第 2 部分”中，它展示了如何将一个非常简单的属性“pager”添加到函数调用中，VOILA 是一个易于理解和样式以及所有内容的编号 pager。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T20:18:05.890

此处链接到一个简单图像切换器的示例，这与您想要的略有不同，因为它在列表中包含可供选择的图像......但这很容易改变。

[http://www.creativewebspecialist.co.uk/jQuery_examples/image-switcher/index.html#](http://www.creativewebspecialist.co.uk/jQuery_examples/image-switcher/index.html#)

# javascript - javascript if 语句问题

> ID：691258
> 
> 赞同：3
> 
> 时间：2009-03-27T19:53:14.017
> 
> 标签：javascript

```
function valid()
{
    begin_checked = false;
    end_checked = false;

    alert("begin_checked: " +begin_checked);
    alert("end_checked: " +end_checked);

    if (document.dd.begin.checked.length == undefined || document.dd.end.checked.length == undefined )
    {
        alert("In undefined");
    }

    alert("end");
} 
```

当 if 语句为假时，它永远不会 alert("end") ？当它为真时，它会正确执行。为什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-27T19:59:22.893

可能存在空指针异常，并且您没有错误输出到浏览器。

您需要一些输出来检查：

```
alert(document);
alert(document.dd);
alert(document.dd.begin);
alert(document.dd.begin.checked);
alert(document.dd.end);
alert(document.dd.end.checked); 
```

如果您从其中任何一个中得到未定义，那么您的代码将无法正确执行。

编辑：另外，这里的其他答案都有很好的信息。阅读这些。

Edit2：替代方案 - 将您的代码包围在 try/catch 块中并警告错误：

```
function valid(){

    try{
        begin_checked = false;
        end_checked = false;

        alert("begin_checked: " +begin_checked);
        alert("end_checked: " +end_checked);

        if (document.dd.begin.checked.length == undefined || document.dd.end.checked.length == undefined ){
            alert("In undefined");
        }

        alert("end");

    } catch (e) {
        alert(e);
    }

} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-27T19:59:09.930

您的浏览器错误控制台中是否有任何错误？我猜这是因为它试图评估一个不存在的属性，这导致它失败（永远不会到达`== undefined`）。您可以只检查该属性是否存在或使用 typeof 来检查它是否未定义。

```
if (!document.dd.begin.checked.length || !document.dd.end.checked.length)
{
    alert("In undefined");
}

if (typeof document.dd.begin.checked.length == 'undefined' || typeof document.dd.end.checked.length == 'undefined' )
{
    alert("In undefined");
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-28T05:08:23.370

[http://getfirebug.com/](http://getfirebug.com/)

# php - Zend 框架 MVC 设计

> ID：691266
> 
> 赞同：3
> 
> 时间：2009-03-27T19:55:09.970
> 
> 标签：php, zend-framework, zend-framework-mvc

我也在 zfforums 上问过这个问题，但我可能会在这里得到答复。

所以 Zend 框架是一个通用的、灵活的、松耦合的、高质量的框架。但是，我发现一些 MVC 部分不一致且过于复杂。希望你们中的一些人可以证明一些 zf 设计决策的合理性并回答一些问题：

一般问题/评论

1.  为什么 zend mvc 不遵循与其他 zend 组件相同的命名约定？例如，mvc 使用小写，复数目录名和类名不以目录信息为前缀，因此它们不容易自动加载。

2.  我想要添加模块根目录的选项。这样，我就不必通过添加控制器/模块目录来显式配置调度程序。我可以放入一个模块并立即访问它。

3.  为什么视图和动作助手之间有区别？目前，帮助程序并未设计为在整个代码中共享，并且加载和访问帮助程序的方法不一致。其他框架允许您在代码中的任何位置共享相同的助手。我认为没有必要专门化和违反 DRY。

Zend 查看问题

1.  为什么视图使用“$this”来访问资源？我认为不需要额外的打字。其他一些框架 extract() 一组视图变量，并允许从视图中加载全局函数或自动加载静态助手： myHelper::someMethod();

2.  为什么视图助手每个类只允许一个函数？这导致了很多类和相关的维护。如前所述，我更喜欢具有任意数量方法的静态类。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-28T01:26:11.750

我在一个巨大的 Intranet 站点中使用 Zend Framework，因为它处于早期阶段，我认为是 0.3 或 0.4，并且我遵循了关于您的问题的大部分决定。我会试着解释一下：

1.  在大多数情况下，您不需要使用模块。您可以将所有控制器放在您的`application/default`目录中，命名它们，`IndexController`或者`HelpController`您已经完成，只需访问`http://www.domain.com/`或`http://www.domain.com/help`。

    如果您的项目开始增长，您可以根据需要添加模块，以模块名称（目录名称）作为前缀，`Admin_IndexController`或者`Forum_PostController`通过`http://www.domain.com/admin`（您在`admin`模块、`index`控制器中；不在`default`模块/`admin`控制器中）访问它们。

2.  例如，您可以将模块目录设置`applicatoin/modules`为 ，并将 FrontController 配置为在此目录中查找模块。使用[addModuleDictory](http://framework.zend.com/manual/en/zend.controller.front.html#zend.controller.front.methods.primary.addmoduledirectory)每当您创建一个新目录并将您的视图/控制器放在那里时，调度程序都会自动发现它们。[这](http://framework.zend.com/manual/en/zend.controller.modular.html#zend.controller.modular.directories)是一个例子。

3.  正如我所看到的，它们具有明显不同的目的。ViewHelpers 用于生成标记并直接在视图中渲染其他操作，抽象菜单创建、侧边栏等。 OTOH ActionHelpers 与调度过程交互，允许您重定向到另一个操作，例如。

意见

1.  一开始我也觉得有点别扭，但习惯了。我认为主要原因是不污染命名空间，但我可能错了。顺便说一句，我不是很喜欢使用`extract()`，但这只是我个人的喜好。

2.  主要原因是每个文件不允许有多个控制器：自动加载。当您使用`$this->someViewHelper()` 底层引擎时，会查找`*_SomeViewHelper_Helper`插件路径中命名的类。另一个原因是静态类很难进行单元测试。甚至有人提议将 FrontController 重写为实例类，而不是 Singleton。

您在第二段中所说的过于复杂的部分是正确的，开发人员和社区都知道这一点。它必须以这种方式适应所有要求和变化。

最后，我认为 ZF 是一个非常强大的框架，让我们可以自由地做我们想做的事。

我希望我能帮助你解决你的问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T21:39:47.143

我不知道这些问题的所有答案，但它们是有趣的问题，所以我会试一试，希望有人能填补空白。

一般的

1.  不在默认模块中的类以模块名称为前缀，例如 Admin_IndexController 并将驻留在 /admin/controllers 中。我认为分离和命名不一致（与库类相比）的原因是，将它们放在嵌套文件夹结构中几乎没有什么好处。控制器是您实现的一部分，所以我个人认为这是有道理的。然而，遍历文件夹确实有点烦人。

2.  您可以修改调度程序，或编写一个插件来扫描目录并添加它们。

3.  这里肯定有重叠——URL 助手就是一个很好的例子。通常，视图助手会生成标记，所以我认为有足够大的区别。

看法

1.  我不知道确切的原因，但我猜它允许其他助手和视图功能更轻松地协同工作。例如，如果您使用 doctype 帮助器来设置 doctype，那么表单元素帮助器可以根据需要生成 XHTML 或 HTML。

2.  它肯定会导致很多课程，但我不确定维护。我没有遇到任何问题。我可以看到在静态类中的使用，但请记住 Zend_View 不会阻​​止您使用它们。如果您的包含路径中有静态类（并使用 Zend_Loader 或类似的），您可以使用它们来代替 View Helpers 或作为 View Helpers 的补充。

# python - 在 Python 中传递具有多个返回值的函数作为参数

> ID：691267
> 
> 赞同：17
> 
> 时间：2009-03-27T19:55:29.423
> 
> 标签：python, return-value, function-calls

因此，Python 函数可以返回多个值。让我感到震惊的是，如果以下内容可行，那将很方便（尽管可读性较差）。

```
a = [[1,2],[3,4]]

def cord():
    return 1, 1

def printa(y,x):
    print a[y][x]

printa(cord()) 
```

……但事实并非如此。我知道您可以通过将两个返回值转储到临时变量中来做同样的事情，但它看起来并不那么优雅。我也可以将最后一行重写为“printa(cord()[0], cord()[1])”，但这会执行两次 cord()。

有没有一种优雅、有效的方法来做到这一点？还是我应该只看到关于过早优化的引用而忘记这一点？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-03-27T19:56:57.047

```
printa(*cord()) 
```

这里`*`是一个参数扩展运算符...好吧，我忘记了它在技术上的名称，但是在这种情况下，它需要一个列表或元组并将其扩展，因此该函数将每个列表/元组元素视为一个单独的参数。

`*`它基本上与您可以用来捕获函数定义中的所有非关键字参数的相反：

```
def fn(*args):
    # args is now a tuple of the non-keyworded arguments
    print args

fn(1, 2, 3, 4, 5) 
```

印刷`(1, 2, 3, 4, 5)`

```
fn(*[1, 2, 3, 4, 5]) 
```

做同样的事情。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-27T19:58:47.123

试试这个：

```
>>> def cord():
...     return (1, 1)
...
>>> def printa(y, x):
...     print a[y][x]
...
>>> a=[[1,2],[3,4]]
>>> printa(*cord())
4 
```

星星基本上说“使用这个集合的元素作为位置参数”。您可以使用两颗星对关键字参数的 dict 执行相同的操作：

```
>>> a = {'a' : 2, 'b' : 3}
>>> def foo(a, b):
...    print a, b
...
>>> foo(**a)
2 3 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-27T22:56:10.707

实际上，Python 并没有真正返回多个值，它返回一个值，该值可以是将多个值打包到一个元组中。这意味着您需要“解包”返回的值才能获得倍数。像这样的声明

```
x,y = cord() 
```

这样做，但直接使用返回值，就像你在

```
printa(cord()) 
```

没有，这就是为什么你需要使用星号。也许一个很好的术语可能是“隐式元组解包”或“没有赋值的元组解包”。

# javascript - 动态脚本标签的安全问题

> ID：691276
> 
> 赞同：10
> 
> 时间：2009-03-27T19:57:28.873
> 
> 标签：javascript, security, json

这篇[flickr 博客文章](http://code.flickr.com/blog/2009/03/18/building-fast-client-side-searches/)讨论了他们对人员选择器自动完成的最新改进背后的想法。

他们必须克服的一个问题是如何在客户端解析和处理如此多的数据（即所有联系人）。他们尝试通过 AJAX 获取 XML 和 JSON，但发现速度太慢。然后他们就通过动态生成的脚本标签（带有回调函数）加载数据说：

> ## JSON 和动态脚本标签：快速但不安全
> 
> 使用大字符串操作是最后一种方法的问题的理论，我们从使用 Ajax 切换到使用动态生成的脚本标记来获取数据。这意味着联系人数据从未被视为字符串，而是在下载后立即执行，就像任何其他 JavaScript 文件一样。性能上的差异令人震惊：解析 10,000 个联系人需要 89 毫秒（减少了 3 个数量级），而 172 个联系人的最小情况只需要 6 毫秒。每个联系人的解析时间实际上随着列表的变大而减少。这种方法看起来很完美，除了一件事：为了执行这个 JSON，我们必须将它包装在一个回调方法中。**由于它是可执行代码，因此世界上任何网站都可以使用相同的方法下载 Flickr 成员的联系人列表。**这是一个交易破坏者。（强调我的）

有人可以在这里了解确切的安全风险吗（也许有一个示例漏洞）？通过脚本标签中的“src”属性加载给定文件与通过 AJAX 调用加载该文件有何不同？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-27T20:08:08.707

这是一个很好的问题，这种确切的漏洞曾经被用来从 gmail 窃取联系人列表。

每当浏览器从域中获取数据时，它都会发送站点设置的任何 cookie 数据。然后可以使用此 cookie 数据对用户进行身份验证，并获取任何特定的用户数据。

例如，当您加载新的 stackoverflow.com 页面时，您的浏览器会将您的 cookie 数据发送到 stackoverflow.com。Stackoverflow 使用该数据来确定您是谁，并为您显示适当的数据。

从域加载的任何其他内容也是如此，包括 CSS 和 Javascript 文件。

Flickr 面临的安全漏洞是任何网站都可以嵌入托管在 Flickr 服务器上的这个 javascript 文件。然后，您的 Flickr cookie 数据将作为请求的一部分发送（因为 javascript 托管在 flickr.com 上），并且 Flickr 将生成包含敏感数据的 javascript 文档。然后，恶意站点将能够访问已加载的数据。

这是用来窃取谷歌联系人的漏洞，这可能比我上面的解释更清楚：http: [//blogs.zdnet.com/Google/ ?p=434](http://blogs.zdnet.com/Google/?p=434)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-27T20:04:07.920

如果我要像这样在我的网站上放置一个 HTML 页面：

```
<script src="http://www.flickr.com/contacts.js"></script>
<script> // send the contact data to my server with AJAX </script> 
```

假设contacts.js 使用会话来知道要发送哪些联系人，我现在将拥有您的联系人的副本。

但是，如果联系人是通过 JSON 发送的，我不能从我的 HTML 页面请求它们，因为这将是一个跨域 AJAX 请求，这是不允许的。我也无法从我的服务器请求该页面，因为我没有您的会话 ID。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-09-23T20:01:50.817

用简单的英语：

在人们的计算机上运行的未经授权的计算机代码 (Javascript) 不允许从除运行它的站点之外的任何地方获取数据 - 浏览器有义务执行此规则。

There is no corresponding restriction on where code can be sourced from, so if you embed data in code any website the user visits can employ the user's credentials to obtain the user's data.

# python - Python：从 MSSQL 中检索图像

> ID：691288
> 
> 赞同：2
> 
> 时间：2009-03-27T20:03:56.517
> 
> 标签：python, sql-server, file-io

我正在开发一个从 MSSQL 检索图像的 Python 项目。我的代码能够成功检索图像，但大小固定为 63KB。如果图像大于该大小，它只会带来图像的前 63KB！

以下是我的代码：

```
#!/usr/bin/python
import _mssql

mssql=_mssql.connect('<ServerIP>','<UserID>','<Password>')
mssql.select_db('<Database>')

x=1
while x==1:
    query="select TOP 1 * from table;"
    if mssql.query(query):
        rows=mssql.fetch_array()
        rowNumbers = rows[0][1]
        #print "Number of rows fetched: " + str(rowNumbers)
        for row in rows:
        for i in range(rowNumbers):
            FILE=open('/home/images/' + str(row[2][i][1]) + '-' + str(row[2][i][2]).strip() + ' (' + str(row[2][i][0]) + ').jpg','wb')
            FILE.write(row[2][i][4])
            FILE.close()
            print 'Successfully downloaded image: ' + str(row[2][i][0]) + '\t' + str(row[2][i][2]).strip() + '\t' + str(row[2][i][1])
    else:
        print mssql.errmsg()
        print mssql.stdmsg()
mssql.close() 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-28T02:15:14.877

当您使用这样的数据库时，很难说出问题所在。您的查询没有明确选择任何列，因此我们不知道您的表结构是什么，或者这些列是什么类型。我怀疑表格格式不是您所期望的，或者您的数据的列类型不正确。

此外，您的代码甚至看起来都不会运行。你有“for row in rows:”，然后不要缩进。也许发布您的架构？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-03-22T08:44:38.150

如果您使用 freetds（我认为您是）：在您的 freetds.conf 中搜索“文本大小”设置。标准为 63 kb

# windows - 从 Hyper-V 2008 的命令提示符处拍摄快照

> ID：691295
> 
> 赞同：1
> 
> 时间：2009-03-27T20:05:39.883
> 
> 标签：windows, snapshot, hyper-v

背景：我在 Server 2008 上使用 Hyper-V 来管理许多虚拟服务器。我已经构建了一些脚本来对这些虚拟服务器中的部分或全部进行更改或应用更新。使用 Hyper-V 管理器，我可以在进行更新之前对这些虚拟服务器进行快照，然后在出现问题时回滚更改。

问题：我想做的是来自批处理文件的脚本或类似的脚本，这整个过程在 Microsoft Windows Server 2008 上的 Hyper-V 上进行。如何从 Hyper-V 中的 Windows 命令提示符触发快照？

提前感谢您对此的任何帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T21:34:37.703

这是使用[powershell的方法](http://blogs.technet.com/jamesone/archive/2008/05/02/hyper-v-and-snapshots-part-1.aspx)

# wcf - 什么限制了 WCF ServiceModelService.Instances？

> ID：691299
> 
> 赞同：3
> 
> 时间：2009-03-27T20:06:03.813
> 
> 标签：wcf, iis, throttling

我正在尝试使用（IIS6/Server2003/BasicHttpBinding）对 WCF 服务进行负载测试。该服务的限制如下：

```
<serviceThrottling maxConcurrentCalls="100" maxConcurrentSessions="100" maxConcurrentInstances="100"/> 
```

为了评估服务器上的调用次数，我使用了 ServiceModelService 3.0.0.0 性能计数器。如果我将 maxConcurrentCalls 限制为 20、15、10 或任何更低的 Instances 性能计数器，则表明 WCF 正在遵守限制。但是，如果我将 maxConcurrentCalls 更改为 30，我将永远无法让 Instances 超过 24。此外，未完成呼叫永远不会超过 24。还有什么可能限制 WCF？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-28T04:50:45.253

请参阅[为什么 WCF 负载测试只有两个并发请求？](http://blogs.msdn.com/wenlong/archive/2009/02/08/why-only-two-concurrent-requests-for-load-testing.aspx)

> 当我看到这个问题时，我的第一反应是：客户端并没有真正向服务器发送足够的请求。这是为什么？以下是原因：
> 
> 1) 如果您使用同步 WCF HttpModule/HttpHandler（默认安装），您将获得最大并发请求数（由该数量的 ASP.NET 工作线程持有）为 12 * [服务器的 CPU 数量]。
> 
> 2) 上面指定了 WCF 节流。

# exe - EXE提取/反编译器

> ID：691303
> 
> 赞同：0
> 
> 时间：2009-03-27T20:10:44.643
> 
> 标签：exe, extraction

我尝试了一些 EXE 提取器，但它们不适用于很多文件。我正在寻找更好的东西。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-27T20:12:46.667

什么样的.exe？Win32 / DOS / .NET？

*   如果是 .NET，您应该使用**Reflector** ( [http://www.red-gate.com/products/reflector/](http://www.red-gate.com/products/reflector/) )
*   如果 Win32 和 C++，你可以尝试这里发布的反编译器（[有 C++ 反编译器吗？](https://stackoverflow.com/questions/205059/is-there-a-c-decompiler)）

市场上有很多提取器/反编译器，因此您应该更明确地说出您的目标是什么（即提取图像、反编译程序集源等）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-04-02T00:04:08.003

有一种简单的方法，只需下载像 winrar winzip 这样的 zip 视图并打开 .exe，它会显示所有组件

# javascript - 服务器端 Javascript：为什么？

> ID：691307
> 
> 赞同：35
> 
> 时间：2009-03-27T20:13:34.573
> 
> 标签：javascript, scripting, server-side

服务器端javascript的使用是否普遍？为什么要使用它而不是任何其他服务器端脚本？是否有特定的用例使它比其他服务器端语言更好？

另外，对如何开始尝试它感到困惑，我在 freeBSD 上，为了运行服务器端 javascript，我需要安装什么？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-03-27T20:16:26.330

它是这样的：

服务器很昂贵，但用户会在他们的浏览器中免费为您提供处理时间。因此，与任何大到需要运行多个服务器的站点上的客户端代码相比，服务器端代码相对昂贵。但是，有些事情您不能留给客户端，例如数据验证和检索。您希望在客户端上执行这些操作，因为这意味着用户的响应时间更快，您自己的服务器基础设施更少，但安全性和可访问性问题意味着需要服务器端代码。

通常发生的情况是你两者都做。您编写服务器端逻辑是因为您必须这样做，但您也在 javascript 中编写相同的逻辑，希望为用户提供更快的响应并在某些情况下为您的服务器节省一些额外的工作。这对验证码特别有效；浏览器中失败的验证检查可以将整个 http 请求/响应对保存在服务器上。

由于我们都是（大部分）这里的程序员，我们应该立即发现新问题。不仅需要额外的工作来开发两组相同的逻辑，还有维护它所涉及的工作，平台导致的不可避免的错误无法很好地匹配，以及随着时间的推移随着实现的不同而引入的错误。

输入服务器端 javascript。这个想法是您可以编写一次代码，因此相同的代码可以在服务器和客户端上运行。这似乎可以解决大部分问题：您可以一次完成全套服务器和客户端逻辑，没有漂移，也没有双重维护。当您的开发人员只需要知道一种语言即可用于服务器和客户端工作时，这也很好。

不幸的是，在现实世界中它的效果并不好。问题有四个方面：

1.  页面的服务器视图与页面的客户端视图仍有很大不同。服务器需要能够做一些事情，比如直接与数据库对话，而这些事情不应该从浏览器中完成。浏览器需要做一些事情，比如操作与服务器不匹配的 DOM。
2.  您无法控制客户端的 javascript 引擎，这意味着您的服务器代码和客户端代码之间仍然存在重要的语言差异。
3.  数据库通常是比 Web 服务器更大的瓶颈，因此节省和性能收益最终低于预期。
4.  虽然几乎每个人都知道一点 javascript，但真正了解和理解 javascript 的开发人员并不*多*。

这些并非完全无懈可击的技术问题：您将服务器支持的语言限制为大多数浏览器都支持的 javascript 子集，提供了解该子集和服务器端扩展的 IDE，制定一些关于页面结构的规则尽量减少 DOM 问题，并提供一些样板 javascript 以包含在客户端上，以使平台更好用。结果类似于 Aptana Studio/Jaxer，或者最近的 Node.js，它可能非常好。

但并不完美。在我看来，有太多的陷阱和小的兼容性问题才能让它真正发光。最终，与开发人员的时间相比，额外的服务器仍然很便宜，并且大多数程序员能够使用 javascript 以外的东西来提高工作效率。

我真正想看到的是部分服务器端 javascript。当请求页面或提交表单时，服务器平台会在 javascript 中*请求*验证，可能作为 Web 服务器的插件，完全独立于其余部分，但*响应*是使用您选择的平台构建的。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-27T20:16:01.043

我认为服务器端 Javascript 的一个非常酷的用途是用于数据验证，但它几乎不经常使用。有了它，您可以编写一个 javascript 文件来验证表单，在客户端检查它，然后在服务器端再次检查它，因为我们不应该信任客户端的任何内容。它可以让您保持验证规则 DRY。很方便。

另见：

*   [服务器端 Javascript 会起飞吗？哪种实现最稳定？](https://stackoverflow.com/questions/17435/will-server-side-javascript-take-off-which-implementation-is-most-stable)
*   [您何时以及如何使用服务器端 JavaScript？](https://stackoverflow.com/questions/459238/when-and-how-do-you-use-server-side-javascript)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-27T20:17:59.353

Javascript 只是一种语言。因为它只是一种语言，你可以在任何你想要的地方使用它……在你的浏览器中，在服务器上，嵌入到其他应用程序中，独立应用程序等等。

话虽如此，我不知道“服务器端 Javascript”有很多新的发展

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-27T20:22:37.080

Javascript 是一种非常好的语言，具有自我/方案原型样式基础和 C 样式语法。有一些问题，请参阅 Javascript the Good Parts，但总的来说它是一流的语言。问题是大多数 javascript 程序员都是糟糕的程序员，因为它很容易上手。

谷歌的一个团队构建了 Rhino on Rails，这是一个类似于 Ruby on Rails 的 MVC 框架，它是用 javascript 编写的，并在 Rhino 上运行，它是 Java VM 的 javascript 解释器。在这种情况下，他们需要使用 Java VM，但希望获得一种速度快（javascript 很快）、支持鸭子类型且灵活的语言。

另一个例子是 CouchDB，一个面向文档的数据库，它使用 json 作为传输格式，使用 javascript 作为查询和索引语言。他们希望数据库尽可能地是 Web 原生的。

Javascript 擅长字符串和 dom (xml) 操作、沙盒化、网络化、自身扩展等……这些特性是您在开发 Web 应用程序时经常做的事情。

尽管如此，我实际上并没有开发服务器端的javascript。这不是一个坏主意，但绝对不常见。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-28T02:38:56.833

我们在客户端上使用 javascript 是因为它就在那里，而不是因为它是我们从语言列表中选择的。我不会为服务器上的任何杂务选择它。

你可以在服务器上运行任何你喜欢的语言，事实上，你喜欢多少就多少。

javascript 可靠且易于使用，但对于服务器上的常见任务而言，它的劳动强度太大。

# silverlight - 不支持指定的方法 httpwebrequest - Silverlight

> ID：691314
> 
> 赞同：2
> 
> 时间：2009-03-27T20:16:16.160
> 
> 标签：silverlight, httpwebrequest

我正在尝试在 Silverlight 2.0 中使用 HttpWebRequest 对象来执行“POST”。

从 BeginGetStream 方法返回后，我得到以下错误：

消息：“不支持指定的方法。”
StackTrace：“在 System.Net.BHWRAsyncResult.get_AsyncWaitHandle()”

下面是一些示例代码： 注意我使用 fiddler 来查看是否有任何东西通过网络发送并且没有网络活动。

```
 HttpWebRequest req = (HttpWebRequest)WebRequest.Create(new Uri("http://someurl"));
        req.Method = "POST";
        req.ContentType = "application/x-www-form-urlencoded";
        req.Accept = "text/plain, */*";
        req.Headers["X-Requested-With"] = "XMLHttpRequest";

        AsyncCallback callBack = new AsyncCallback(streamResponse);

        req.BeginGetRequestStream(callBack, null); 
```

谢谢，戴夫

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-08T14:50:32.727

我刚刚找到了一个解决这个问题的方法。HTTP 客户端需要知道 Content-Length 来填充 Content-Length HTTP 标头值。在长度已知之前，客户端无法启动请求。当您获得 RequestStream WebRequest 时无法知道您将发送到服务器的字节数。您必须关闭流才能提交 Content-Length，并且只有在关闭 RequestStream 后才能调用 BeginGetResponse。奇怪的是，这不是在 WebRequest 中完成的。希望这会有所帮助，德米特里

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-28T23:26:29.097

我刚才遇到了这个问题。在我的头顶上：

1) [clientaccesspolicy.xml / crossdomain.xml](http://msdn.microsoft.com/en-us/library/cc197955(VS.95).aspx)不在您正在调用的服务器上。像 flash 一样，silverlight 不会与没有域的域通信。

1.1) fiddler 是否记录 404 错误？如果没有，您将不会看到 Silverlight 尝试获取这些策略文件的失败尝试。

2）如果做不到这一点，发送您的自定义标头可能会令人不安。

# autosave - 自动保存草稿的最佳做法？

> ID：691316
> 
> 赞同：5
> 
> 时间：2009-03-27T20:16:19.420
> 
> 标签：autosave

对于在发送之前自动保存电子邮件或在完成或正式保存之前保存博客文章的应用程序的最佳策略是什么？最好在数据库中为临时草稿使用单独的表，还是使用状态列将帖子标记为草稿或已发布？我不是在寻找代码，只是在寻找方法，但也欢迎任何其他相关的建议，比如多久保存一次等。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T20:21:33.340

考虑到草稿和已发表文章的单独表格基本上是相互重复的，我倾向于只使用一个带有状态列的表格来区分两者。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T20:23:30.167

我按照维基百科的方式起草：我保存第一个版本，所有修改都保存（基于时间或明确的用户命令）作为下一个版本。即之后。您可以删除草稿图 - 或不删除。

如果您将数据保存在数据库中，我认为最好使用同一张表（可以避免模式冲突），并使用版本/状态来跟踪草稿生命周期。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-02-09T05:23:47.180

这不仅适用于电子邮件...

我改变了主意。最好的方法是在表中使用 is_draft 列，并将草稿和有效实体存储在同一个表中。这具有实体保持相同 id 的优点，即使它切换到草稿状态（您可能希望在保存后对其进行编辑，但暂时删除所需的值）。如果他们在同一个文档上进行协作并且 id 不断变化，那会让用户感到困惑，amirite？

您将使用 is_draft=1 关闭 ORM 验证规则、触发验证或检查约束以允许保存无效对象。是的，您可能必须在表中允许可为空的字段。

过程：尝试保存对象。验证失败。设置 is_draft=1 并尝试再次保存。它可以节省。把大的“草稿”放在屏幕上的某个地方:)

用户填写所需信息。尝试保存对象。验证通过。设置 is_draft=0。它可以节省。

现在，关于电子邮件和博客文章，除非用户点击保存/发布按钮，否则您的服务器不应尝试立即发送或发布，但这确实是一个不同的问题。

* * *

旧答案

问题是草稿可能无效，并且无法保存在实际表中。例如，假设您的表格要求主题不为空，但用户尚未填写。

一种方法是拥有一个草稿表，并将实体（及其子项）的序列化版本存储到其中。php 的 serialize() 可以使用，或者你可以使用 json。当它最终有效时，系统将改为保存到电子邮件（或其他）表中，并删除草稿：

伪sql：

```
create table draft  
id int primary key auto increment,  
entity varchar(64) not null comment 'this way you can find all drafts of say type Email',  
contents longblob not null,  
modified timestamp comment 'this way you can sort by newer drafts'  
modified_by int not null foreign key to user.id comment 'this way you can filter by the user\'s drafts' 
```

您还可以考虑使用 draft_file 表来存储草稿的附件或照片，并能够单独访问它们：

```
create table draft_file  
id int primary key auto increment,   
draft_id int not null foreign key to draft.id on delete cascade,  
size int not null comment 'bytes',  
mime_type varchar(64) not null,  
file_name varchar(255) not null,  
contents longblob,  
thumbnail blob comment 'this could be an icon for files/documents' 
```

因此，用户开始撰写电子邮件，可能只是在正文中输入内容，并添加一些附件。您的 gui 将电子邮件保存到草稿，并上传附件，将它们保存到 draft_file，并返回草稿 ID，以及您在 gui 中显示的文件的下载 url。

他输入主题（To 仍为空白）。您的 gui 将电子邮件保存到草稿中，通过 id 更新草稿表，因为它从上一步中知道其 id。

您的用户填写“收件人”字段，然后点击“发送”。您的服务器将电子邮件保存到 email 表，将附件从 draft_file 复制到 email_attachment 表，并删除草稿，最好在事务中删除。

这允许长期草稿、gmail 样式的附件上传，同时保持真实实体表的完整性。

# php - 我想将哪些标头与 304 响应一起发送？

> ID：691318
> 
> 赞同：17
> 
> 时间：2009-03-27T20:16:59.497
> 
> 标签：php, http-headers, get, http-status-code-304

当我发送 304 响应时。浏览器将如何解释我与 304 一起发送的其他标头？

例如

```
header("HTTP/1.1 304 Not Modified");
header("Expires: " . gmdate("D, d M Y H:i:s", time() + $offset) . " GMT"); 
```

这会确保浏览器在 $offset 时间“用完”之前不会发送另一个有条件的 GET 请求（也没有任何请求）？

另外，其他标题呢？

我是否应该将这样的标头与 304 一起发送：

```
header('Content-Type: text/html'); 
```

我必须发送：

```
header("Last-Modified:" . $modified);
header('Etag: ' . $etag); 
```

为了确保浏览器在下次 $offset “用完”时发送条件 GET 请求，还是只是保存旧的 Last Modified 和 Etag 值？

发送 304 响应标头时我还应该注意其他事项吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2010-11-19T15:23:13.380

为了驯服“条件获取”野兽，这篇[博文帮助了我很多。](http://edn.embarcadero.com/article/38123)

一段有趣的摘录（与本的回答部分矛盾）指出：

> 如果正常响应包含 ETag 标头，则该标头也必须包含在 304 响应中。
> 
> 缓存标头（Expires、Cache-Control 和/或 Vary），如果它们的值可能与先前响应中发送的值不同。

**这完全符合[RFC 2616 sec 10.3.5](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.3.5)。**

* * *

低于 200 个请求...

```
HTTP/1.1 200 OK
Server: nginx/0.8.52
Date: Thu, 18 Nov 2010 16:04:38 GMT
Content-Type: image/png
Last-Modified: Thu, 15 Oct 2009 02:04:11 GMT
Expires: Thu, 31 Dec 2010 02:04:11 GMT
Cache-Control: max-age=315360000
Accept-Ranges: bytes
Content-Length: 6394
Via: 1.1 proxyIR.my.corporate.proxy.name:8080 (IronPort-WSA/6.3.3-015)
Connection: keep-alive
Proxy-Connection: keep-alive
X-Junk: xxxxxxxxxxxxxxxx 
```

...以及它的最佳有效 304 对应物。

```
HTTP/1.1 304 Not Modified
Server: nginx/0.8.52
Date: Thu, 18 Nov 2010 16:10:35 GMT
Expires: Thu, 31 Dec 2011 16:10:35 GMT
Cache-Control: max-age=315360000
Via: 1.1 proxyIR.my.corporate.proxy.name:8080 (IronPort-WSA/6.3.3-015)
Connection: keep-alive
Proxy-Connection: keep-alive
X-Junk: xxxxxxxxxxx 
```

请注意，`Expires`标头最多`Current Date + One Year`符合[RFC-2616 14.21](https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.21)。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-27T20:27:29.970

标`Content-Type`头仅适用于包含正文的响应。304 响应不*包含*正文，因此该标头不适用。同样，您不想发送`Last-Modified`或`ETag`因为 304 响应意味着文档没有更改（因此这两个标题的值也没有）。

例如，请参阅[Anne van Kesteren 的这篇博客文章](http://annevankesteren.nl/2005/05/http-304)检查[WordPress](http://wordpress.org/)的`http_modified`功能。请注意，它返回*and 或*304*响应* 。`Last-Modified``ETag`

 *# internet-explorer - 尝试在 Internet Explorer 中上传不存在的文件，表单未提交

> ID：691323
> 
> 赞同：4
> 
> 时间：2009-03-27T20:18:37.590
> 
> 标签：internet-explorer, upload, submit

我有一个带有`input type=file`. Internet Explorer 允许用户在该输入中键入任何他们想要的内容（而 Firefox 提供了一个文件选择器）。如果用户输入明显无效的名称，例如：

```
a 
```

并尝试提交表单，Internet Explorer 甚至不尝试提交表单。

有什么办法让我知道这已经发生并让用户知道这正在发生并发出警报？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T20:26:21.580

您应该向提交按钮添加一个“onclick()”事件，该按钮调用一个 JavaScript 函数来测试您的状况并使用 JavaScript“警报”让用户知道他们需要输入值得提交的内容。

查看正则表达式以进行测试。

如果您希望用户做出决定，请使用`confirm()`.

如果您想简单地提醒他们而不是测试他们的价值，您可以使用类似的东西：

```
<input type="submit" value="clickme" onClick="if (confirm('Really submit?')) { this.form.submit(); }"> 
```

下面是一些示例代码，可以从 中的 JavaScript 函数调用中获取值`onclick()`：

```
<html>
    <head>
        <title>hello world</title>
        <SCRIPT LANGUAGE="javascript" type="text/javascript">
            function show_me(form_elem) {
            alert(form_elem.value);
            }
        </script>
    </head>
    <body>
        <form method="GET" name="upload_form" action="index.html" target="_top">
            <input type="file" name="file_name" size="14" maxlength="256" value="">
            <br>
            <input type="submit" value="mybutton" onclick="show_me(this.form.file_name)" />
        </form>
    </body>
</html> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-30T13:28:49.390

我找到了一个更好的方法来做到这一点：http: [//www.priddypictures.co.uk/reference/fileInputProblem.htm](http://www.priddypictures.co.uk/reference/fileInputProblem.htm)

因此，如果这些家伙/女孩是正确的，并且如果输入没有名称属性，则表单提交正常，那么：

*   编写一个 jQuery 插件，它将（如果是 Internet Explorer）从所有文件输入中删除 name 属性
*   使用正确的名称将另一个隐藏的输入插入到表单中
*   将值从文件输入复制到隐藏输入

我可能会在某个时候编写这个插件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T21:05:17.337

您可以通过以下方式模仿 Firefox 行为：

```
<input type="file" name="test" onkeypress="this.click();return false;"> 
```

当用户尝试输入文件输入时，它会弹出文件选择器。

显然，如果客户端禁用了 JavaScript，这将不起作用，但根据您的要求，它可能“足够好”。

在 IE 6、7 和 8 中似乎可以正常工作。

它在 Firefox 3 中运行良好（因为它不允许输入`<input type=file>`）。

它在 Windows 3 和 4 的 Safari 中运行良好（因为它不允许输入`<input type=file>`）。

在 Opera 9（允许输入`<input type=file>`）中，它什么也不做（不弹出选择器或吞下按键）。实际上，该`onkeypress`事件似乎根本没有触发，可能是出于安全考虑。

在 Firefox 2 中它不起作用（它允许输入`<input type=file>`），因为`this.click()`它不会弹出选择器并`return false`吞下按键。

# ruby-on-rails - rails technoweenie / restful-authentication magi-code：找不到`User#register！`

> ID：691330
> 
> 赞同：4
> 
> 时间：2009-03-27T20:22:14.070
> 
> 标签：ruby-on-rails, restful-authentication

我最近安装了 technoweenie / restful-authentication 插件（按承诺工作），但是在通过`users_controller#created`时，我发现对`user`模型的方法调用的引用

```
 @user.register! 
```

*有谁知道该方法在哪里定义？*我几乎搜索了所有生成的代码，但仍然没有看到注册方法。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T20:40:58.113

它在 restful-authentication/lib/authorization/stateful_roles.rb 中定义

```
 event :register do
      transitions :from => :passive, :to => :pending, :guard => Proc.new {|u| !(u.crypted_password.blank? && u.password.blank?) }
    end 
```

实际方法`register!`是通过acts_as_state_machine 插件从这个事件动态创建的，该插件也应该在您的项目中。此方法被插入到您的控制器中，因为当您生成控制器时，您指定了`--stateful`“--aasm”或“--aasm”。

如果您想了解更多信息，[这里](http://rails.aizatto.com/2007/05/24/ruby-on-rails-finite-state-machine-plugin-acts_as_state_machine/)有一篇关于acts_as_state_machine 的很好的文章。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T20:24:25.377

运行 restful 身份验证生成器

# c++ - 自定义复制构造函数并添加字段

> ID：691336
> 
> 赞同：0
> 
> 时间：2009-03-27T20:23:56.813
> 
> 标签：c++, defensive-programming

**重复[这个](https://stackoverflow.com/questions/655856/add-new-member-to-copy-c-tor-copy-o-tor-serialization-reminder)。**

在 C++ 中，您有时必须自己实现复制构造函数（当您通常将指针作为成员时）。编译器生成的复制构造函数的缺点是，当您添加成员字段并忘记在复制构造函数中添加复制行时，您会遇到问题，这通常很难追踪。我喜欢防守性地编程，这让我有点担心。

一种解决方案是使用 memcpy，然后正确处理指针，但据我了解，这是不鼓励的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T20:34:42.590

不要使用裸指针 - 如果需要，请使用智能指针为您完成复制。哟然后不再需要写一个拷贝构造函数——我在过去五年里只写了一个。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T20:33:13.310

不要这样做——如果有人添加了一个指针成员变量并忘记了复制构造函数，这两种方法都行不通——我建议你在复制构造函数中为你的类的 sizeof添加一个编译时断言[链接文本](http://www.flipcode.com/archives/Compile-Time_Assertions.shtml)——如果 sizeof 会改变 - 编译断言将失败并且代码不会编译，直到有人改变条件 - 有人改变位于关于确保正确复制所有成员而不这样做的评论旁边的条件的可能性是相当的低的 ;）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T20:31:57.400

不，不要使用 memcpy。您冒着覆盖您甚至不知道存在的数据的风​​险（例如，vtables）。此外，如果您添加的字段本身就是一个指针，那么您还没有解决任何问题。

针对这种情况进行防御性编程的最佳实践是：

*   每当添加字段时，请养成检查类构造函数、析构函数等的习惯

*   进行自动化测试

*   使用诸如 Purify 之类的内存调试工具（也可以使用开源工具，这可能会有所帮助。）

# c# - 可以转义内联脚本的压缩 HTTP 模块

> ID：691337
> 
> 赞同：0
> 
> 时间：2009-03-27T20:24:06.343
> 
> 标签：c#, regex

我有压缩 HTTP 请求的 HTTP 模块。

```
public override void Write(byte[] buffer, int offset, int count)
{
    byte[] data = new byte[count];
    Buffer.BlockCopy(buffer, offset, data, 0, count);
    string html = System.Text.Encoding.Default.GetString(buffer);

    Regex reg = new Regex(@"(?<=[^])\t{2,}|(?<=[>])\s{2,}(?=[<])|(?<=[>])\s{2,11}(?=[<])|(?=[\n])\s{2,}");
    html = reg.Replace(html, string.Empty);

    byte[] outdata = System.Text.Encoding.Default.GetBytes(html);
    _sink.Write(outdata, 0, outdata.GetLength(0));
} 
```

如何转义所有内联脚本？这是我的脚本正则表达式。

```
Regex reg = new Regex("<script[^>]*?>[\\w|\\t|\\r|\\W]*?</script>", (RegexOptions.Singleline | RegexOptions.IgnoreCase)); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T20:28:47.753

我真的怀疑您是否要使用`Encoding.Default`特定于您的系统的 . 除此之外，为什么不使用更标准的压缩方式，即 gzip 二进制数据而不是进行文本操作？我怀疑这会产生更大的影响，并且在意外破坏 HTML 方面几乎没有那么脆弱。此外，您无需再担心编码问题。

# wpf - 项目控件中的 WPF GridViewRowPresenter

> ID：691339
> 
> 赞同：5
> 
> 时间：2009-03-27T20:24:24.737
> 
> 标签：wpf, data-binding, itemscontrol

我刚刚开始学习 WPF，我正在尝试在 ItemsControl 中使用 GridViewRowPresenter 来基本上复制 HTML 中简单表格的功能。ListView 不合适，因为它是交互式的（我不想要）。我绑定到未知数量的对象的通用列表。

我有一个自定义对象的列表，该对象具有两个字符串属性：名字和姓氏。以下代码有效：

```
<ItemsControl Name="myItemsControl">
    <ItemsControl.ItemTemplate>
        <DataTemplate>
            <TextBlock Text="{Binding Path=FirstName}"/>
        </DataTemplate>
    </ItemsControl.ItemTemplate>
</ItemsControl> 
```

虽然这没有任何效果：

```
<ItemsControl Name="myItemsControl">
    <ItemsControl.ItemTemplate>
        <DataTemplate>
            <GridViewRowPresenter>
                <GridViewRowPresenter.Columns>
                    <GridViewColumnCollection>
                        <GridViewColumn DisplayMemberBinding="{Binding Path=FirstName}"></GridViewColumn>
                        <GridViewColumn DisplayMemberBinding="{Binding Path=LastName}"></GridViewColumn>
                    </GridViewColumnCollection>
                </GridViewRowPresenter.Columns>
            </GridViewRowPresenter>
        </DataTemplate>
    </ItemsControl.ItemTemplate>
</ItemsControl> 
```

我不知道从这里去哪里，我将不胜感激任何帮助！谢谢！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-27T20:47:22.857

如果您想要一个非交互式的项目网格，您可以使用一个使用共享大小范围的`ItemsControl`with a `Grid`：

```
<ItemsControl ItemsSource="{Binding Items}" Grid.IsSharedSizeScope="True">
    <ItemsControl.ItemTemplate>
        <DataTemplate>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" SharedSizeGroup="FirstName"/>
                    <ColumnDefinition Width="*" SharedSizeGroup="LastName"/>
                </Grid.ColumnDefinitions>

                <TextBlock Text="{Binding FirstName}"/>
                <TextBlock Grid.Column="1" Text="{Binding LastName}"/>
            </Grid>
        </DataTemplate>
    </ItemsControl.ItemTemplate>
</ItemsControl> 
```

一种更有效的方法是编写您自己的子类，其工作方式与（您可能可以子类）`Panel`类似，但会根据需要自动添加行。然后将其用作.`Grid``Grid``Panel``ItemsPanel``ItemsControl`

# dotnetnuke - DotNetNuke 社区博客网站的优缺点

> ID：691341
> 
> 赞同：0
> 
> 时间：2009-03-27T20:24:34.797
> 
> 标签：dotnetnuke, blogs

我正在为一个离岸团队将进行开发的项目评估 DotNetNuke。简而言之，该应用程序将是一个与 stackoverflow 有许多相似之处的社区博客平台，除了没有问题，只有帖子。帖子可能包括图像或视频、标签、使用信息、标题、正文、社区投票（向上或向下）评论、热度和其他一些细节。它们应该是可标记的、可排序的、可分类的（超出一组标签提供的功能） 将来，该站点将提供论坛、日历和其他一些功能，这些功能可用于 DotNetNuke 的模块。此外，该站点将包含包含大量自定义皮肤的用户体验。

想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-29T13:24:30.517

使用 Web 应用程序框架（例如 DotNetNuke）有很多好处，可以帮助您更快地启动和运行，并在创建自定义功能时*减少工作量。*

但是，您必须意识到您基本上将大量代码合并到您可能不熟悉的项目中。无论代码多么好，框架多么容易学习，对于您和您的团队来说，仍然会有一个重要的学习曲线。

您的决策过程（如果您仍在决定是否使用 DotNetNuke）应包括（除了阅读、交谈和其他一般调查）：

*   从 Codeplex 下载应用程序并检查源代码。
*   调查存在的第三方模块。
*   下载源代码附带的一两个免费模块，并尝试对创建者的开发过程进行逆向工程。她是如何与框架集成的，她利用了哪些功能，从头开始编写了什么？

DotNetNuke（或任何其他具有大量扩展的框架）真正大放异彩的一个地方是采用现有的可用扩展并对其进行自定义。如果您需要实现给定的功能，请先查看第三方扩展社区中的解决方案。您可能会找到一个可以为您提供很大比例的方法，并将其用作您的功能的基础。

例如，如果您想在您的网站上创建一个照片库，您可能不想从头开始编写它。那里有三个主要的照片画廊出售源代码。核心画廊模块是免费的，简单的画廊很便宜，而且与自己编写相比，超媒体画廊的源代码是合理的。这些中的任何一个都可以让您在实现功能方面取得良好的开端。

# apache-flex - 如何在 Flex (AS3) 中解析 ISO 格式的日期？

> ID：691342
> 
> 赞同：9
> 
> 时间：2009-03-27T20:25:40.553
> 
> 标签：apache-flex, actionscript-3, datetime, parsing

如何将 ISO 日期字符串解析为 Flex (AS3) 中的日期对象？

例如
2009-12-08T04:23:23Z
2009-12-08T04:23:23.342-04:00
等...

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-27T20:34:44.057

```
import com.adobe.utils.DateUtil;

var dateString:String = "2009-03-27T16:28:22.540-04:00";
var d:Date = DateUtil.parseW3CDTF(dateString);
trace(d);
var s:String = DateUtil.toW3CDTF(d);
trace(s); 
```

```
[trace] Fri Mar 27 16:28:22 GMT-0400 2009
[追踪] 2009-03-27T20:28:22-00:00

```

结果[DateUtil](http://weblogs.macromedia.com/as_libraries/docs/corelib/com/adobe/utils/DateUtil.html)处理[W3C 日期和时间](http://www.w3.org/TR/NOTE-datetime)规范中的所有内容。AS3 日期不保持毫秒，但如果可用，它们将被丢弃。

请注意，W3C 输出转换为 UTC（又名 GMT，或祖鲁时间）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-10-31T22:03:18.923

将 ISO 转换为日期格式的示例函数

```
 public function isoToDate(value:String):Date 
    {
        var dateStr:String = value;
        dateStr = dateStr.replace(/\-/g, "/");
        dateStr = dateStr.replace("T", " ");
        dateStr = dateStr.replace("Z", " GMT-0000");

        return new Date(Date.parse(dateStr));
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T20:31:16.187

这是一个实现：[http ://blog.flexexamples.com/2008/02/02/parsing-iso-dates-with-flex-and-actionscript/](http://blog.flexexamples.com/2008/02/02/parsing-iso-dates-with-flex-and-actionscript/)

（抱歉 ff 只是没有显示链接按钮，我懒得自己做。）

# asp.net - Aspx 中的 IFRAME 中的经典 ASP

> ID：691344
> 
> 赞同：0
> 
> 时间：2009-03-27T20:26:49.723
> 
> 标签：asp.net, iframe, asp-classic

我有一个场景，我将一个单独的经典 ASP 应用程序加载到一个 IFRAME 中，我以编程方式嵌入到一个 ASP.Net Web 表单中。此外部应用程序广泛使用会话变量，但是，当它从一个页面导航到另一个页面时，它会丢失会话变量。有什么建议么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-27T20:34:02.153

是的，如果您的 asp 页面是另一个域，会话将丢失。您可以通过将 p3p 标头添加到您的 asp 页面来解决此问题。

检查我前段时间问的这个[问题。](https://stackoverflow.com/questions/540926/ie7-iframe-blank-page)或者，您可以查看此[博客文章](http://www.codegeeks.net/ie7-iframe-and-cookie-hell)。

# python - 处理python socket recv的输出

> ID：691345
> 
> 赞同：6
> 
> 时间：2009-03-27T20:26:51.423
> 
> 标签：python, sockets

为 noob Python 问题道歉，但我已经被困在这个问题上太久了。

我正在使用 python 套接字从服务器接收一些数据。我这样做：

```
 data = self.socket.recv(4)
print "data is ", data
print "repr(data) is ", repr(data) 
```

控制台上的输出是这样的：

> 数据是
> repr(data) 是 '\x00\x00\x00\x01'

我想把这个基本上包含一个 4 字节数字的字符串变成一个 int - 或者实际上是 C 中的 long。我怎样才能把这个数据对象变成一个我可以轻松管理的数值？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-27T20:32:52.297

您可能想使用[struct](http://docs.python.org/library/struct.html#module-struct)。

代码看起来像：

```
import struct

data = self.socket.recv(4)
print "data is ", data
print "repr(data) is ", repr(data)
myint = struct.unpack("!i", data)[0] 
```

# c++ - 在 C++ 中优化时间（NULL）调用

> ID：691347
> 
> 赞同：1
> 
> 时间：2009-03-27T20:27:22.483
> 
> 标签：c++, optimization

我有一个系统在 time(NULL) 调用中花费了 66% 的时间。

有没有办法缓存或优化这个调用？

上下文：我正在玩 C++ 的 Protothread。试图用状态机模拟线程。所以因此我不能使用本机线程。

这是标题：

```
#ifndef __TIMER_H__
#define __TIMER_H__

#include <time.h>
#include <iostream>

class Timer
{
private:
    time_t initial;
public:
    Timer();
    unsigned long passed();
};

#endif 
```

和源文件：

```
#include "Timer.h"

using namespace std;

Timer::Timer()
{
    initial = time(NULL);
}

unsigned long Timer::passed()
{
    time_t current = time(NULL);
    return (current - initial);
} 
```

更新：最终解决方案！cpu循环它在某个地方消失，如果我用它们是正确的。毕竟这还不错。

```
#define start_timer() timer_start=time(NULL)
#define timeout(x) ((time(NULL)-timer_start)>=x)

```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-27T20:32:52.453

我想你是在某个循环中调用它，否则效率会非常高。

您可以做的是计算在时间的返回值更改之前您的循环经历了多少次迭代。

然后不要再调用它，直到你再次经历了那么多迭代。

如果您发现自己正在漂流，您可以向上或向下动态调整此计数，但您应该能够对其进行设计，使其平均每秒调用一次 time()。

这是你如何做的一个粗略的想法（这个主题有很多变化）

```
int iterations_per_sec=10; //wild guess
int iterations=0;

while(looping)
{
    //do the real work

    //check our timing
    if (++iterations>iterations_per_sec)
    {
        int t=time(NULL);
        if (t==lasttime)
        {
            iterations_per_sec++;
        }
        else
        {
            iterations_per_sec=iterations/(t-lasttime);
            iterations=0;
            lastime=t;

            //do whatever else you want to do on a per-second basis
        }
    }

} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-27T20:31:49.553

这听起来相当不错，因为它`time`只有 1 秒的精度。听起来你这么称呼它太频繁了。一种可能的改进可能是每 500 毫秒调用一次。所以它仍然会每秒命中。

因此，与其每秒调用 100 次，不如启动一个每 500 毫秒响铃一次的计时器，获取当前时间并将其存储为整数。然后，改为每秒读取该整数 100 次。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-27T20:32:51.690

正如所指出的，您无法缓存它，因为 time() 的整个时间点是为您提供当前时间，这显然一直在变化。

然而，真正的问题可能是：为什么程序调用 time() 如此频繁？我想不出任何好的理由这样做。

是轮询时间（）吗？在这种情况下 sleep() 可能更合适。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-27T20:31:16.357

不那么频繁地调用它——除非你真的需要每秒数百次的当前时间，否则你不应该那么频繁地调用它。

编辑：尝试后，我更加好奇，我意识到您可能在一个小型嵌入式系统上，但在我的系统上，我在一秒钟内运行 10,000,000 次 time() 调用没有问题。鉴于 time() 每秒只会更改一次，您可能会做一些严重错误的事情。你到底想达到什么目的？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-27T21:13:04.010

如果您在 Unix 上，您可以考虑使用 gettimeofday ( [http://www.opengroup.org/onlinepubs/000095399/functions/gettimeofday.html](http://www.opengroup.org/onlinepubs/000095399/functions/gettimeofday.html) ) - 它更快且精度更高。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-27T20:28:50.437

缓存将无济于事，除非并且直到您不想要当前时间。你能发布一些代码吗？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-27T20:31:17.793

这真的取决于，但如果你总是想要当前时间，保存结果将无济于事。`time( NULL )`可能会导致系统调用，这需要时间，因为您必须切换到/从内核模式。

您**可以**做的是在获取当前时间的同时读取 tsc，然后在您想要获取当前时间时再次读取 tsc，并将周期数/CPU 速度添加到您的时间。

这里有一些答案`rdtsc`应该对你有所帮助。

编辑：请参阅我在 Timer 中的回答，[以查找 C 中函数调用中经过的时间，以](https://stackoverflow.com/questions/638269/timer-to-find-elapsed-time-in-a-function-call-in-c)获取有关`rdtsc`.

**另请注意，除非您绝对必须**这样做，否则我不会特别推荐这个。很可能 call `rdtsc`，从前面的减去`rdtsc`通过除以您的 cpu spped 将其转换为分数的等价物将比再次调用要*慢*`time()`。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-27T20:37:52.847

通常，您可以做的是将时间关闭的结果保存到局部变量中，然后将其用作当前时间，直到您执行一些阻塞调用或一些长时间运行的 CPU 密集型代码部分。

你在做什么，你需要经常调用时间，你能发布一些代码吗？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-27T21:29:55.123

您可以创建一个线程，该线程每秒调用 time() 几次，然后休眠，更新共享变量。

对 Protothread 的快速浏览暗示它不使用操作系统线程，因此您可能会在没有内存障碍的情况下侥幸逃脱。否则，像有效的读/写锁这样的东西应该意味着它的成本可以忽略不计。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-28T15:06:25.553

您可以使用一个单独的线程来运行一个无限循环，该循环将 sleep() 持续 1 秒（如果您需要更精细的粒度，则可以更短），然后更新时间戳值。

其他线程只会检查这个时间戳值而不会造成任何性能损失。

# latex - 如何在 LaTeX 中自定义对子列表的引用？

> ID：691351
> 
> 赞同：11
> 
> 时间：2009-03-27T20:28:39.187
> 
> 标签：latex, pdflatex

我的 LaTeX 文档中有一个列表/子列表结构。默认情况下，子列表用字母分隔，所以你最终会得到：

```
1\. Item
    (a) sub item
    (b) sub item 
```

在我的文档中，我有超过 26 个子项目，所以我遇到了一个计数器溢出错误，我通过重写子项目标签来修复它，所以它们现在看起来像这样

```
1\. Item
    1.1 sub item
    1.2 sub item 
```

我在其中一个项目上贴了一个标签，以便以后可以参考具体步骤。问题是当引用被渲染时，它是使用一个字母来渲染的，而不是子项目的编号。

这是一个显示问题的示例文档。

```
\documentclass[11pt]{report}

\begin{document}

\renewcommand{\labelenumii}{\arabic{enumi}.\arabic{enumii}}

\begin{enumerate}
    \item Item
    \begin{enumerate}
        \item \label{lbl} Label here
    \end{enumerate}
\end{enumerate}

Ref: \ref{lbl}

\end{document} 
```

这将呈现如下：

```
1\. Item
    1.1 Label here
Ref: 1a 
```

所以不是说“Ref：1.1”，而是使用“Ref：1.a”。有没有办法让 \ref 使用源枚举的编号？如果没有，是否可以生成对包含超过 26 个项目的子列表中项目的正确引用？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-27T20:41:27.893

我正在查看我的 The LaTeX Companion，第 129 页的副本，从我所看到的情况来看，我会建议如下内容：

```
\renewcommand{\theenumii}{\arabic{enumii}}
\renewcommand{\labelenumii}{\theenumi.\theenumii.}
\makeatletter
\renewcommand{\p@enumii}{\theenumi.}
\makeatother 
```

不过，我目前无法访问工作的 LaTeX 环境来测试它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-05-18T08:18:20.957

因此，对于 2 个嵌套列表，应按以下方式完成：

```
\begin{enumerate}
\renewcommand{\theenumi}{\arabic{enumi}}
\renewcommand{\theenumii}{\arabic{enumii}}
\renewcommand{\theenumiii}{\arabic{enumiii}}

\renewcommand{\labelenumi}{\theenumi.}
\renewcommand{\labelenumii}{\theenumi.\theenumii.}
\renewcommand{\labelenumiii}{\theenumi.\theenumii.\theenumiii.}

\makeatletter
\renewcommand{\p@enumii}{\theenumi.}
\renewcommand{\p@enumiii}{\theenumi.\theenumii.}
\makeatother

...

\end{enumerate} 
```

我花了太多时间来理解它。我希望这会有所帮助，因为该线程对我有所帮助。

谢谢。

# java - Java 1.5 Calendar#compareTo() 混淆

> ID：691352
> 
> 赞同：1
> 
> 时间：2009-03-27T20:28:43.040
> 
> 标签：java, date, calendar, gregorian-calendar

好的，我正式被这个难住了。我有一个 GregorianCalendar 对象，我想确定它是在过去、现在还是将来。到目前为止，[Calendar#compareTo](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Calendar.html#compareTo(java.util.Calendar))文档让我感到困惑，因为我得到了不稳定的结果。一个简单的测试类将说明我的问题：

```
import java.util.Calendar;
import java.util.GregorianCalendar;
public class MyCal
{

        public static void main( String[] args )
        {
                GregorianCalendar datePast = new GregorianCalendar();
                datePast.add(Calendar.MONTH, -6); // subtract 6 months
                GregorianCalendar datePresent = new GregorianCalendar();
                GregorianCalendar dateFuture = new GregorianCalendar();
                datePast.add(Calendar.MONTH, 6); // add 6 months

                System.out.println("compare datePresent to datePast: "+datePresent.compareTo(datePast));
                System.out.println("compare datePresent to datePresent: "+datePresent.compareTo(datePresent));
                System.out.println("compare datePresent to dateFuture: "+datePresent.compareTo(dateFuture));
        }
} 
```

和输出：

```
compare datePresent to datePast: 1
compare datePresent to datePresent: 0
compare datePresent to dateFuture: 0 
```

我对 compareTo 的理解是最后一行应该是-1。谁能告诉我我做错了什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T20:30:05.410

您已将 6 个月添加到`datePast`，而不是`dateFuture`。这是工作代码：

```
import java.util.Calendar;
import java.util.GregorianCalendar;
public class MyCal
{

    public static void main( String[] args )
    {
        GregorianCalendar datePast = new GregorianCalendar();
        datePast.add(Calendar.MONTH, -6); // subtract 6 months
        GregorianCalendar datePresent = new GregorianCalendar();
        GregorianCalendar dateFuture = new GregorianCalendar();
        dateFuture.add(Calendar.MONTH, 6); // add 6 months

        System.out.println("compare datePresent to datePast: "+datePresent.compareTo(datePast));
        System.out.println("compare datePresent to datePresent: "+datePresent.compareTo(datePresent));
        System.out.println("compare datePresent to dateFuture: "+datePresent.compareTo(dateFuture));
    }
} 
```

您的结果会不一致，因为*有时* `dateFuture`会晚于`datePresent`，具体取决于内部时钟“滴答”的时间。

除了所有这些，我不禁给出我的标准 Java 日期和时间建议：改用[Joda Time](http://joda-time.sourceforge.net/)。它不对这个特定问题负责，尽管许多类型是不可变的这一事实会有所帮助。但总的来说，它是一个*更好*的库。

# .net - 静态属性和锁使用

> ID：691356
> 
> 赞同：4
> 
> 时间：2009-03-27T20:31:01.023
> 
> 标签：.net, vb.net, performance, multithreading, locking

这段代码是否正确，或者是否有可能出现一些随机线程死锁等？

使用静态属性和锁定在一起是个好主意吗？还是静态属性线程安全？

```
Private Shared _CompiledRegExes As List(Of Regex)
Private Shared Regexes() As String = {"test1.Regex", "test2.Regex"}
Private Shared RegExSetupLock As New Object

Private Shared ReadOnly Property CompiledRegExes() As List(Of Regex)
    Get
        If _CompiledRegExes Is Nothing Then
        SyncLock RegExSetupLock

            If _CompiledRegExes Is Nothing Then
                _CompiledRegExes = New List(Of Regex)(Regexes.Length - 1)

                For Each exp As String In Parser.Regexes
                    _CompiledRegExes.Add(New Regex(exp, RegexOptions.Compiled Or RegexOptions.CultureInvariant Or RegexOptions.IgnoreCase))
                Next

            End If

        End SyncLock

    End If

    Return _CompiledRegExes

End Get
End Property 
```

*如果不是很明显，代码正在编译正则表达式并存储在 List(Of Regex) 中，这样它们就可以运行得更快。它是共享的，因此类的每个实例都可以从中受益。*

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-27T20:34:23.353

您的代码不是线程安全的，因为您使用双重检查锁定而不使字段易失。不幸的是 VB.NET 没有 volatile 修饰符，所以你不能应用正常的修复。而是每次都获取锁，或者在类型初始化时使用静态初始化来初始化_CompiledRegExes。

有关单身人士的一般性讨论，请参阅[我的单身人士页面](http://pobox.com/~skeet/csharp/singleton.html)- 我知道这不是一个单身人士，但它很接近*。*该页面提供了 C# 代码，但应该相当容易理解。

此外，我通常建议将锁变量设为只读。你真的不想改变价值:)

笼统：

*   不，静态属性不是自动线程安全的
*   是的，可以锁定一个静态变量（但是像你正在做的那样显式初始化它）
*   *除非您真的*知道自己在做什么，否则不要尝试编写无锁或低锁代码。我认为自己对线程有相当的了解，我仍然不会尝试使用双重检查锁定等。
*   类型初始化是线程安全的（如果您有一些复杂的初始化程序最终会相互引用，请注意一些警告），因此现在是进行这样初始化的好时机 - 那么您真的*不需要*锁。

编辑：您不需要将类型设为单例。只需编写函数来初始化列表并返回它，然后在变量的初始化程序中使用该函数：

```
' This has to be declared *before* _CompiledRegExes '
' as the initializer will execute in textual order '
' Alternatively, just create the array inside BuildRegExes '
' and don't have it as a field at all. Unless you need the array '
' elsewhere, that would be a better idea. '
Private Shared ReadOnly Regexes() As String = {"test1.Regex", "test2.Regex"}

Private Shared ReadOnly _CompiledRegExes As List(Of Regex) = BuildRegExes()

Private Shared ReadOnly Property CompiledRegExes() As List(Of Regex)
    Get
        Return _CompiledRegExes
    End Get
End Property

Private Shared Function BuildRegExes() As List(Of Regex)
    Dim list = New List(Of Regex)(Regexes.Length - 1)

    For Each exp As String In Regexes
        _CompiledRegExes.Add(New Regex(exp, RegexOptions.Compiled Or RegexOptions.CultureInvariant Or RegexOptions.IgnoreCase))
    Next
    Return list
End Function 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T20:41:59.640

（由 jonskeet 编辑）这段文字只是为了让课程开始时的格式正确。如果代码之前没有文本，不知道为什么会失败。）

```
Class Better
    Private Shared Regexes() As String = {"test1.Regex", "test2.Regex"}
    Private Shared _CompiledRegExes As List(Of Regex) = BuildList(Regexes)

    Private Shared Function BuildList(ByVal source() As String) As List(Of Regex)
        Dim result = New List(Of Regex)(Regexes.Length - 1)
        For Each exp As String In source
            result.Add(New Regex(exp, RegexOptions.Compiled Or RegexOptions.CultureInvariant Or RegexOptions.IgnoreCase))
        Next
        Return result
    End Function
    Public Shared ReadOnly Property _CompiledRegExes1() As List(Of Regex)
        Get
            Return _CompiledRegExes
        End Get
    End Property

End Class

Class MoreBetter
    Private Shared ReadOnly Regexes() As String
    Private Shared ReadOnly _CompiledRegExes As List(Of Regex)

    Shared Sub New()
        Regexes = New String() {"test1.Regex", "test2.Regex"}
        _CompiledRegExes = New List(Of Regex)(Regexes.Length - 1)
        For Each exp As String In Regexes
            _CompiledRegExes.Add(New Regex(exp, RegexOptions.Compiled Or RegexOptions.CultureInvariant Or RegexOptions.IgnoreCase))
        Next
    End Sub

    Public Shared ReadOnly Property _CompiledRegExes1() As List(Of Regex)
        Get
            Return _CompiledRegExes
        End Get
    End Property

End Class 
```

编辑：我喜欢第二个的原因是它不容易出错。如果“Private Shared _CompiledRegExes”被意外移动到“Private Shared Regexes()”之前，第一个将不起作用

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T20:46:19.380

VB.Net 有一个`Static`关键字，可用于在成员或属性中声明变量。以这种方式声明的变量在对方法的调用中保持其状态，并保证是线程安全的（在`Monitor`后台使用类实现）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T21:05:24.043

虽然我很少支持使用这种方法，但它是合法的。

```
Class UsingStatic
Private Shared Regexes() As String = {"test1.Regex", "test2.Regex"}
Public Shared ReadOnly Property CompiledRegExes() As List(Of Regex)
    Get
        Static _CompiledRegExes As List(Of Regex) = BuildList(Regexes) <--executes once
        Return _CompiledRegExes <-- executes every time it is called
    End Get
End Property

Private Shared Function BuildList(ByVal source() As String) As List(Of Regex)
    Dim result = New List(Of Regex)(Regexes.Length - 1)
    For Each exp As String In source
        result.Add(New Regex(exp, RegexOptions.Compiled Or RegexOptions.CultureInvariant Or RegexOptions.IgnoreCase))
    Next
    Return result
End Function

End Class 
```

请注意，您必须将 _CompiledRegExes 的构造函数放在同一行。这个微小的变化会导致你每次都得到一个新的对象。

```
Public Shared ReadOnly Property CompiledRegExes() As List(Of Regex)
    Get
        Static _CompiledRegExes As List(Of Regex) <--executes once
        _CompiledRegExes = BuildList(Regexes) <-- executes every time it is called
        Return _CompiledRegExes
    End Get
End Property 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-27T20:32:58.287

当您只有一个资源时，不会发生死锁。

关于静态属性，不，它们不是自动线程安全的。这是锁定私有静态字段的常用方法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-27T23:45:08.123

来自 msdn “lockobject 表达式应始终评估为仅属于您的类的对象。您应声明私有对象变量以保护属于当前实例的数据，或声明私有共享​​对象变量以保护所有实例共有的数据。”

# email - 如何：在 Vim 中为电子邮件设置拼写？

> ID：691362
> 
> 赞同：6
> 
> 时间：2009-03-27T20:32:27.133
> 
> 标签：email, vim, spell-checking, mutt

谷歌在这里不是很有帮助。我想撰写电子邮件`:set spell`，但对于所有其他文件，`:set spell`应该关闭。我使用 mutt 和 Vim 作为编辑器来撰写电子邮件。

事实上，我很好奇，Vim 怎么知道这是我正在撰写的电子邮件？是否有正在编辑的文件类型的命令行参数？mutt 怎么知道要传入什么？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-27T21:01:44.520

您可以在`~/.vimrc`由检测到的文件类型触发的 autocmd 中使用：

```
autocmd FileType mail set spell 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-27T20:41:09.127

在你的 .muttrc 中试试这个：

```
set editor = "/usr/bin/vim -c':set spell'" 
```

您可以使用“which vim”找到正确的 vim 路径。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T20:42:11.497

你不应该使用 mutt 配置命令吗？请参阅以下链接：

*   文字编辑： http: [//mutt.blackfish.org.uk/editing/](http://mutt.blackfish.org.uk/editing/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-04-03T06:46:56.863

将以下内容添加到您的 ~/.vimrc 中：

```
set spelllang=en_gb,fr
au BufRead,BufNewFile *mutt* set filetype=mail
autocmd FileType mail set spell 
```

它应该可以正常工作。您可以（应该？）更改拼写语言以反映您经常使用的任何语言。

# .net - 在 .NET 中将 DataTable 打印到文本框/文本文件

> ID：691363
> 
> 赞同：5
> 
> 时间：2009-03-27T20:32:30.537
> 
> 标签：.net, printing, datatable, writing

是否有将数据表写入文本文件或 TextBox 控件（使用等宽字体）的预定义或“简单”方法，例如 DataTable.Print()：

```
第一栏| 栏目2|
--------|--------|
      v1| v2|
      v3| v4|
      v5| v6|

```

**编辑**

这是一个初始版本 (vb.net) - 如果有人有兴趣或想要构建自己的：

```
Public Function BuildTable(ByVal dt As DataTable) As String

    Dim result As New StringBuilder
    Dim widths As New List(Of Integer)
    Const ColumnSeparator As Char = "|"c
    Const HeadingUnderline As Char = "-"c

    ' determine width of each column based on widest of either column heading or values in that column
    For Each col As DataColumn In dt.Columns
        Dim colWidth As Integer = Integer.MinValue
        For Each row As DataRow In dt.Rows
            Dim len As Integer = row(col.ColumnName).ToString.Length
            If len > colWidth Then
                colWidth = len
            End If
        Next
        widths.Add(CInt(IIf(colWidth < col.ColumnName.Length, col.ColumnName.Length + 1, colWidth + 1)))
    Next

    ' write column headers
    For Each col As DataColumn In dt.Columns
        result.Append(col.ColumnName.PadLeft(widths(col.Ordinal)))
        result.Append(ColumnSeparator)
    Next
    result.AppendLine()

    ' write heading underline
    For Each col As DataColumn In dt.Columns
        Dim horizontal As String = New String(HeadingUnderline, widths(col.Ordinal))
        result.Append(horizontal.PadLeft(widths(col.Ordinal)))
        result.Append(ColumnSeparator)
    Next
    result.AppendLine()

    ' write each row
    For Each row As DataRow In dt.Rows
        For Each col As DataColumn In dt.Columns
            result.Append(row(col.ColumnName).ToString.PadLeft(widths(col.Ordinal)))
            result.Append(ColumnSeparator)
        Next
        result.AppendLine()
    Next

    Return result.ToString()

End Function 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-04-30T11:34:57.297

我建议您查看我的文章[DataTable Formatter](http://bassem-mohsen.com/2011/08/06/datatable-formatter/)。
我的 DataTableFormatter 类包含将 DataTable 格式化为基于字符的表格（您的要求）、HTML 表格或流文档表格的方法。

您可以从我的网站下载包含该类的项目，但为方便起见，我将在此处发布代码。

```
/// <summary>
/// Gets a string representation of the <see cref="System.Data.DataTable" />.
/// </summary>
/// <remarks>The string representation should be displayed with a monospaced font.</remarks>
public static string GetStringRepresentation(DataTable dataTable)
{
    if (dataTable == null)
        throw new ArgumentNullException("'dataTable' cannot be null.");

    StringWriter representationWriter = new StringWriter();

    // First, set the width of every column to the length of its largest element.
    int[] columnWidths = new int[dataTable.Columns.Count];
    for (int columnIndex = 0; columnIndex < dataTable.Columns.Count; columnIndex++)
    {
        int headerWidth = dataTable.Columns[columnIndex].ColumnName.Length;
        int longestElementWidth = dataTable.AsEnumerable()
            .Select((row) => row[columnIndex].ToString().Length)
            .Max();
        columnWidths[columnIndex] = Math.Max(headerWidth, longestElementWidth);
    }

    // Next, write the table
    // Write a horizontal line.
    representationWriter.Write("+-");
    for (int columnIndex = 0; columnIndex < dataTable.Columns.Count; columnIndex++)
    {
        for (int i = 0; i < columnWidths[columnIndex]; i++)
            representationWriter.Write("-");
        representationWriter.Write("-+");
        if (columnIndex != dataTable.Columns.Count - 1)
            representationWriter.Write("-");
    }
    representationWriter.WriteLine(" ");
    // Print the headers
    representationWriter.Write("| ");
    for (int columnIndex = 0; columnIndex < dataTable.Columns.Count; columnIndex++)
    {
        string header = dataTable.Columns[columnIndex].ColumnName;
        representationWriter.Write(header);
        for (int blanks = columnWidths[columnIndex] - header.Length; blanks > 0; blanks--)
            representationWriter.Write(" ");
        representationWriter.Write(" | ");
    }
    representationWriter.WriteLine();
    // Print another horizontal line.
    representationWriter.Write("+-");
    for (int columnIndex = 0; columnIndex < dataTable.Columns.Count; columnIndex++)
    {
        for (int i = 0; i < columnWidths[columnIndex]; i++)
            representationWriter.Write("-");
        representationWriter.Write("-+");
        if (columnIndex != dataTable.Columns.Count - 1)
            representationWriter.Write("-");
    }
    representationWriter.WriteLine(" ");

    // Print the contents of the table.
    for (int row = 0; row < dataTable.Rows.Count; row++)
    {
        representationWriter.Write("| ");
        for (int column = 0; column < dataTable.Columns.Count; column++)
        {
            representationWriter.Write(dataTable.Rows[row][column]);
            for (int blanks = columnWidths[column] - dataTable.Rows[row][column].ToString().Length;
                blanks > 0; blanks--)
                representationWriter.Write(" ");
            representationWriter.Write(" | ");
        }
        representationWriter.WriteLine();
    }

    // Print a final horizontal line.
    representationWriter.Write("+-");
    for (int column = 0; column < dataTable.Columns.Count; column++)
    {
        for (int i = 0; i < columnWidths[column]; i++)
            representationWriter.Write("-");
        representationWriter.Write("-+");
        if (column != dataTable.Columns.Count - 1)
            representationWriter.Write("-");
    }
    representationWriter.WriteLine(" ");

    return representationWriter.ToString();
} 
```

GetStringRepresentation(DataTable) 方法给出了这样的结果

```
    +-----------------+----------------+------------- ------+
    | 项目 | 库存单位 | 单价 |
    +-----------------+----------------+------------- ------+
    | 钻孔机 | 1000 | 1,000,000 美元 |
    | 背包 | 320 | 24 美元 |
    | 巧克力棒 | 100000 | $2.00000000000000 |
    +-----------------+----------------+------------- ------+

```

我应该承认这种表格样式是从 MySQL 命令行客户端欺骗的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-27T20:47:14.883

您可以使用[DataTableReader](http://msdn.microsoft.com/en-us/library/system.data.datatablereader.aspx)：

```
public static string PrintTable(this DataTable dt) 
{
    DataTableReader dtReader = dt.CreateDataReader();
    StringBuilder result = new StringBuilder();
    while (dtReader.Read()) 
    {
        for (int i = 0; i < dtReader.FieldCount; i++) 
        {
            result.AppendFormat("{0} = {1}",
                dtReader.GetName(i).Trim(),
                dtReader.GetValue(i).ToString().Trim());
        }
        result.AppendLine();
    }
    dtReader.Close();
    return result.ToString();
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T20:36:43.753

不，没有。您必须自己进行格式化，或者找一个第三方库来自己做。

# sharepoint - 跨 Sharepoint 站点共享数据 - 上卷还是下拉？

> ID：691375
> 
> 赞同：2
> 
> 时间：2009-03-27T20:37:52.300
> 
> 标签：sharepoint

在接下来的几个月里，我的工作场所将开始在内部使用 Sharepoint。我对在我们的 Intranet 上拥有更多结构化数据的可能性感到非常兴奋。其中一个关键部分是允许相关数据在站点层次结构中传播。

我目前正在试验一份委员会成员名单，想法是在网站的某个地方你可以看到每个委员会的每个人的名单。然后在站点的其他部分，您只想看到一个委员会的成员。从我一直在阅读的各种文章和博客文章中，似乎有三种可接受的方式来解决这个问题：

1.  汇总 - 子网站有自己的列表（可选来自列表模板）。使用内容类型，以便可以将实例收集到父站点上的数据视图 Web 部件中。

2.  下拉 - 在父站点中定义主列表，每个子站点包含该列表的视图，已过滤

3.  购买或创建自定义汇总 Web 部件。

你在不同情况下的经历是什么？这些技术的权衡是什么，还有其他（好的）方法我错过了吗？

顺便说一句，委员会成员的例子是我目前正在尝试尝试不同的可能性。我对一般权衡更感兴趣，不一定特定于这个例子。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-29T22:15:26.713

在不同的站点上多次执行此操作后，根据您的情况，我建议：

> 1.Roll Up - 子网站有自己的列表（可选来自列表模板）。使用内容类型，以便可以将实例收集到父站点上的数据视图 Web 部件中。

这提供了更大的灵活性，不仅您的网站集中的其他网站可以获取此信息，您还可以使用搜索查询 Web 部件来汇总其他网站集中的信息（CQWP 和 DVWP 不能跨网站集工作）。

我唯一使用下拉模型的时候是逻辑上只有一个列表可供我的网站集访问。对我们来说，此类列表本质上一直是功能性的，例如，某些自定义功能的内容查询定义列表或所有站点依赖并用于填充已安装的自定义字段控件的客户列表。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-28T12:26:56.873

我会说这两种方法都可以很好地工作，但是一种方法相对于另一种方法的优势确实归结为更便于您如何构建 Intranet 网站集。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-28T16:57:41.527

您可能还需要考虑将内容查询 Web 部件 (CQWP) 与互补的网站集结构结合使用，以便显示委员会成员数据。

只需稍加定制，CQWP 就可以做一些令人惊奇的事情——产品组团队在后台对它进行了全面优化，用于管理各种查询。它易于配置和使用，并且有很多关于如何在网络上使用它们的示例。

# wpf - 使用网格作为 ItemsHost

> ID：691379
> 
> 赞同：3
> 
> 时间：2009-03-27T20:40:21.593
> 
> 标签：wpf, grid, itemspresenter

我想使用 Grid 作为 ItemsHost 但没有任何项目出现在它们的绑定（列，行）位置。我怎样才能使这项工作？举个简单的例子：

XAML

```
<ItemsControl ItemsSource="{Binding DataSet}">
    <ItemsControl.ItemTemplate>
        <DataTemplate>
            <TextBlock Grid.Column="{Binding Col}" Grid.Row="{Binding Row}" Text="{Binding Text}"   />
        </DataTemplate>
    </ItemsControl.ItemTemplate>
    <ItemsControl.Style>
        <Style TargetType="{x:Type ItemsControl}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ItemsControl}">
                        <Grid HorizontalAlignment="Stretch" IsItemsHost="True">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition />
                                <ColumnDefinition />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition />
                                <RowDefinition />
                            </Grid.RowDefinitions>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </ItemsControl.Style>
</ItemsControl> 
```

代码隐藏

```
Class Window1 

    Private myTestData As TestData

    Public Sub New()
        ' This call is required by the Windows Form Designer.
        InitializeComponent()

        ' Add any initialization after the InitializeComponent() call.
        myTestData = New TestData()
        Me.DataContext = myTestData
    End Sub

End Class

Class TestData

    Private myDataSet As List(Of DataPoint)
    Public Property DataSet() As List(Of DataPoint)
        Get
            Return myDataSet
        End Get
        Set(ByVal value As List(Of DataPoint))
            myDataSet = value
        End Set
    End Property

    Public Sub New()
        Me.DataSet = New List(Of DataPoint)
        For x As Integer = 0 To 1
            For y As Integer = 0 To 1
                Me.DataSet.Add(New DataPoint(x, y, "Column " + x.ToString + ", Row " + y.ToString))
            Next
        Next
    End Sub

End Class

Class DataPoint

    Private myRow As Integer
    Public Property Row() As Integer
        Get
            Return myRow
        End Get
        Set(ByVal value As Integer)
            myRow = value
        End Set
    End Property

    Private myCol As Integer
    Public Property Col() As Integer
        Get
            Return myCol
        End Get
        Set(ByVal value As Integer)
            myCol = value
        End Set
    End Property

    Private myText As String
    Public Property Text() As String
        Get
            Return myText
        End Get
        Set(ByVal value As String)
            myText = value
        End Set
    End Property

    Public Sub New(ByVal x As Integer, ByVal y As Integer, ByVal name As String)
        Me.Row = y
        Me.Col = x
        Me.Text = name
    End Sub

End Class 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T21:15:28.920

因为您使用的是`ItemsControl`，所以会为每个项目生成一个容器。`ContentPresenter`该容器（普通 old的一个实例`ItemsControl`）包装`TextBlock`, 并且是`Grid`. 因此，the`Grid`甚至永远不会看到`Column`and`Row`属性，`TextBlock`因为它正在查看容器。

您可以通过设置`ItemContainerStyle`为容器绑定适当属性的 来解决此问题：

```
<ItemsControl.ItemContainerStyle>
    <Style TargetType="ContentPresenter">
        <Setter Property="Grid.Column" Value="{Binding Column}"/>
        <Setter Property="Grid.Row" Value="{Binding Row}"/>
    </Style>
</ItemsControl.ItemContainerStyle> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T21:16:36.857

可能的解决方法：如果您使用[UniformGrid](http://www.dotnet-blog.com/index.php/2008/06/25/uniformgrid-the-simple-grid/)，您可能不需要指定行和列。

# fortran - 如何在fortran77中解压文件？

> ID：691390
> 
> 赞同：0
> 
> 时间：2009-03-27T20:45:25.857
> 
> 标签：fortran, fortran77, compression

我有一个压缩文件。让我们忽略 tar 命令，因为我不确定它是否被压缩。我所知道的是它是在 fortran77 中压缩的，这就是我应该用来解压缩它的。我该怎么做？解压是一条路还是我需要某个头文件来引导（直接）解压？

它不是 .Z 文件。它以别的东西结束。我需要什么来解压它？我知道最终解压缩档案的格式。

文件是否有可能通过一种简单的方式压缩但它以不同的扩展名出现？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T21:50:43.140

首先，让我们把“fortran”部分排除在外。没有标准（我指的是 fortran 标准）压缩或解压缩文件的方法，因为 fortran 没有压缩实用程序作为语言的一部分。也许有人自己写了一些，但这完全取决于他。

因此，您会被公开可用的压缩实用程序等困住。在有这些可用的系统和支持它的编译器上（它会有所不同），您可以使用 SYSTEM 函数，该函数通过将命令字符串传递给操作系统的命令解释器来执行系统命令（我知道它存在于 cvf 中，可能ivf ...您可能应该在编译器的帮助下查找它）。

[既然你已经](https://stackoverflow.com/questions/680478/is-there-a-command-in-fortran77-or-later-that-decompresses-a-file)问了一个类似的问题，我假设你仍然有这个问题。您提到“它是用 fortran77 压缩的”。你是什​​么意思 ？有人在 f77 中构建了一个压缩实用程序并使用它吗？所以这将使它成为一个定制的解决方案？

如果它是某种自定义解决方案，那么它实际上可以是任何东西，因为许多算法都可以用作“压缩算法”（与纯文本相比，将文件写入二进制文件将节省几个字节；瞧，“压缩”）

还是我误解了什么？请详细说明一下。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-30T06:05:22.763

我的猜测是**你有一个二进制文件**，它是由 Fortran 程序输出的。这些看起来像压缩文件，因为它们在文本编辑器中不可读。

Fortran 允许您将内存中的数据写入文件而不对其进行格式化，以便您以后可以重新加载它而无需解析它。但是，问题是您需要原始源代码才能查看文件中写入了哪些类型的变量。

如果您无法访问 fortran 源代码，但有*很多*空闲时间，您可以编写一些简单的 fortran 程序并猜测正在使用的变量类型。不过，我不建议这样做，因为 Fortran 不是很宽容。

如果您想尝试一些简单的源代码，请查看[此页面](http://users.fmg.uva.nl/rgrasman/rpages/2005/08/reading-and-writing-binary-files-in-r.html)，该页面详细介绍了 Fortran 中的二进制读写，并包含代码示例。只需从替换`reclength=reclength*4`为`reclength=reclength*2`双精度实数开始。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T20:48:32.557

没有标准的减压方法，有吨。您需要知道用于压缩它的方法才能解压缩它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-11T12:40:32.850

**您可以使用file**命令检查它是否是已知的压缩文件类型。假设**文件**返回类似于“二进制文件”的内容，那么您几乎可以肯定正在查看纯二进制数据。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-27T21:28:26.673

你说文件扩展名不是.Z，而是别的。那是什么东西？

如果是 .gz（在 Unix 系统上很常见），“gunzip”是正确的命令。如果是 .tgz，您可以对其进行压缩和解压缩。（或者您可以阅读 tar(1) 的手册页，因为它可能具有 gunzip 和解压缩的能力。）

如果它在 Windows 上，请查看 Windows 是否可以直接读取它，因为文件系统本身似乎支持 ZIP 格式。

如果还有其他内容，请仅列出文件名（或者，如果存在安全隐患，请列出以第一个句点开头的文件名），我们也许能够弄清楚。

# c - 需要帮助将 C 宏重写为函数

> ID：691394
> 
> 赞同：3
> 
> 时间：2009-03-27T20:46:57.647
> 
> 标签：c, macros, c-preprocessor

我需要一些帮助以更安全的方式重写以下行并将其重写为函数，但是该代码是在函数内部定义的事实使我很难想到一种聪明的方法，因为显然它将涉及声明几个论点。

```
#define CHECK(id) if(table->cells[id]) isgood[table->cells[id]-1] = 0; 
```

哪里`table`是一个`struct`，`isgood`是一个`int`。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T20:51:24.297

直接翻译（如果 table->cells[id] 是 int）：

```
void check(int id, int*isgood) { if (id) isgood[id-1] = 0; } 
```

致电：

```
check(table->cells[id], isgood); 
```

但是，我会稍微重命名/重做这个。我特别想改名字。也没有错误检查 - 即，如果 table->cells[id]==0，您将尝试设置 isgood[-1]，这会很糟糕。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-27T20:52:38.053

> 显然这将涉及声明几个论点

那有什么问题？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-27T20:50:04.580

为什么不只是一个接收`table`并`id`执行此操作的函数？

```
void foo(TableType & t, int id)
{
    if (t.cells[id]) 
        isgood[t.cells[id]-1] = 0;
} 
```

ps

这确实是一个糟糕的宏。这个名字非常具有误导性。

pps

整个事情很奇怪，这个函数的逻辑让我无法理解。这究竟应该达到什么目的？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-27T20:55:57.857

如果您在 C++ 中工作，我会考虑将 check 作为表的成员函数，这似乎是一个很好的类候选：

```
class Table {
    //...
    public bool check(int id) {
        if (this->cells[id]) {
            this->isGood[id] = 0;
            // the line you have, isgood[table->cells[id]-1] = 0 looks buggy:
            // you treat table->cells[id] as a true/false value one line ago;
            // probably not a valid array index? I'm taking a stab at what to do.
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-28T07:40:15.390

我认为 C99 可以将函数限定为*内联*函数，这样您就可以在不使用宏的情况下加速无函数调用。此外，大多数 C 编译器为此目的支持诸如 __inline 之类的扩展。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-27T20:52:04.623

通常最好不要在宏中引用变量。

首先，确保名称有意义。你在检查什么？而且有副作用吗？

```
void update_valid_cells(Table& table, int id, BoolArray& validArray)
{
     if(table.cells[id]==NULL) return;
     validArray[id]-1=false;
} 
```

# perfmon - 在打开 perfmon 日志记录之前，如何保证 w3wp 进程存在？

> ID：691401
> 
> 赞同：1
> 
> 时间：2009-03-27T20:48:44.177
> 
> 标签：perfmon, w3wp

我有一个在性能测试之前运行的批处理脚本，它在我们的服务器上进行了一些预测试设置；它清除日志文件、启动适当的服务、恢复数据库、设置一些应用程序设置并打开 perfmon 日志记录。

我的问题; 在我们打开 perfmon 日志记录时，我们需要监控的 w3wp 进程并不总是存在。如果此过程在日志中，则几乎是偶然的。测试需要 4 到 18 小时才能完成，直到测试完成我才知道 w3wp 是否被监控（即使我的日志文件配置为监控，perfmon 似乎也没有检测到新进程`Process(*)`） ，这最终会浪费很多时间。

1.  有没有办法强制 w3wp 加载？在启动 perfmon 日志之前，我可以调用一些命令吗？
2.  或者，是否可以配置 perfmon 日志来监控日志启动时可能不存在的进程？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T21:00:23.323

如果安装 IIS 管理工具，则可以调用名为 TinyGet 的命令行应用程序。你可以传入你的网络服务器上的任何页面来初始化它。这将启动该过程，以便您可以捕获它。

# c++ - 你还在 C++ 程序中捕获内存分配失败吗？

> ID：691402
> 
> 赞同：9
> 
> 时间：2009-03-27T20:49:34.160
> 
> 标签：c++, memory-management

我正在为公司写一些指导方针，我需要回答一些棘手的问题。这个相当难。

解决方案可以是：

1.  根本不追踪。确保使用 new 分配对象，这将在分配失败时引发异常。应用程序会死掉，这没什么大不了的。PRO - 代码通常可以非常干净。

2.  跟踪内存分配失败并相应地报告它，就像任何错误（例如文件访问错误）一样。

老实说，如果我们使用选项 2，我必须编写更多代码。例如，许多 std::tring 操作涉及内存分配。如

标准：：字符串str1，str2；str1 = str2; str += str2;

我们的软件将始终运行主要平台，而不是嵌入式。不知何故，我认为选项1是要走的路。你怎么看？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-27T20:57:12.987

我确实会捕获内存分配，但只是偶尔。

特别是，我偶尔会在以下情况下捕获内存分配：

*   我知道分配的内存量非常大
*   如果分配失败，我可以做一些事情（即：优雅地处理条件并通知用户等）

话虽这么说，这两件事非常罕见 - 通常我最终只是让程序因异常而死。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-27T20:55:40.450

**一般来说，不要检查小分配的内存分配失败。**不可避免的是，它的麻烦多于它的价值，而且无论如何都很难做到正确。大多数时候，您对此无能为力。在非常大的内存操作上，如果你能做点什么，可能值得根据具体情况考虑。

**[C++ Gotchas: Avoiding Common Problems in Coding and Design](https://rads.stackoverflow.com/amzn/click/com/0321125185)**很好地涵盖了这一点。特别是，请参阅**[问题 #61：检查分配失败](http://www.informit.com/articles/article.aspx?p=30642&seqNum=2)**：

> 有些问题不应该被问到，特定的内存分配是否成功就是其中之一。
> 
> [...] 所涉及的错误检查代码最初很少完全正确，并且在经过一段时间的维护后几乎永远不会正确。更好的方法是根本不检查：
> 
> ```
> String **array = new String *[n];
> for( String **p = array; p < array+n; ++p )
>   *p = new String; 
> ```
> 
> 这段代码更短、更清晰、更快、更正确。new 的标准行为是在分配失败的情况下抛出 bad_alloc 异常。这允许我们从程序的其余部分封装分配失败的错误处理代码，从而实现更简洁、更清晰且通常更高效的设计。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-07-01T21:56:54.547

根据另一个建议，我正在将此作为实际答案。

到目前为止，很多建议基本上都表明“bad_alloc == 你的程序中的错误”。相反，bad_alloc 抛出并不总是表明存在错误。

例如，我正在为我正在处理的游戏项目开发地图编辑器。有时，地图尺寸较大时会抛出 bad_alloc。这并不表示存在错误，只是地图尺寸太大而无法容纳用户计算机上的可用内存。这几乎不是我希望程序崩溃的情况，并且在使用“新”运算符创建地图时，使用简单的 try/catch 块可以很好地恢复它。如果它失败了，很简单，我会释放所有剩余的内存并继续愉快地继续。当然，并非所有 bad_alloc 的情况都是直截了当的，因此真正理解为什么会抛出 bad_alloc 非常重要。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-27T20:53:34.417

除非您正在执行一些令人印象深刻的分配，否则您不太可能在 32 位虚拟内存空间中遇到分配失败。（在 64 位系统中更不可能）。如果内存不足，最好死掉。在极少数情况下出现问题并且您确实耗尽了内存，无论如何您都不太可能报告错误。（当然，除非您事先专门留出一块内存以在分配失败的情况下释放。）

一种可能性 - 分配相当大的内存块仅用于紧急使用，然后在您的应用程序中以相当高的级别捕获内存不足异常，释放紧急内存，记录发生的事情，然后死亡。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-27T20:57:58.353

是的，我愿意，但这取决于您的应用程序。对于在客户端系统上运行的关键任务应用程序、大量服务器应用程序和服务，您绝对不应该在 OOM 情况下崩溃 - 内存不足的情况可能会暂时出现，用户希望您的代码在问题解决后继续运行.

想象一下，如果一个内存猪开始在你的系统上运行，突然你的 shell、你的 web 浏览器、应用程序等因为它而失败。这根本不是一个好的用户体验。

另一方面，如果您的工具是一次性工具，其中 OOM 意味着您无法完成用户要求您完成的一件事，那么失败可能是可以的。

无论如何，即使对于未处理的情况，您也应该添加一个顶级捕获，以便在 OOM 实际上是由您的代码引起的事件中进行一些日志记录。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-27T20:56:18.060

如果您发现内存不足异常，您可以获得发生故障的堆栈跟踪，99% 的时间都是您诊断问题所需要的。那就是你的日志。

您可以锁定 1MB 缓冲区或可用于生成此信息的东西，方法是直接使用它或释放它，以便在创建日志时内存可用。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-27T20:58:29.287

在现代操作系统上，您的计算机将在您实际用完 VM 之前很久很久就会死机并且可能会崩溃。对它进行毫无意义的测试。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-27T21:07:18.627

在 99.9% 的情况下，我所有的 C++ 应用程序都会因为分配失败而死掉。一旦内存不足，除非您的应用程序专门设计用于处理和纠正内存不足的情况，否则您真的无能为力。

0.1% 的情况适用于以下情况：1) 已知非常大并且有很大的失败机会；2) 表示适当的回退是适当的情况。这是**非常**罕见的，自从我尝试这样的事情以来已经有好几年了（我不会再这样做了）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-27T21:53:57.360

我不会在调用站点检查，但我建议将大部分程序包装在一个 catch 子句中以记录并希望运行错误（内存分配失败可能表明内存泄漏、while 循环失控、内存管理不善（分配多个缓冲区，但一次只使用一个）等）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-27T20:55:43.617

分配失败时死亡并没有错。很可能，在那之后的一切都会失败。

只需验证您是否真的在分配失败时遇到异常，而不是稍后因为使用 NULL 指针。

# syntax - 采用 Ordered[A] 的任何子类型的函数的 Scala 语法是什么？

> ID：691422
> 
> 赞同：14
> 
> 时间：2009-03-27T20:58:42.673
> 
> 标签：syntax, scala, subclass

我想编写一个适用于任何具有总排序的Scala 类型的函数（即我可以在其上使用'<'）。那是什么语法？我想出的最好的是

```
def lessThan[T <: Ordered[T]](x: T, Y: T) = x < y 
```

但是，当我尝试从 REPL 使用它时，这不起作用：

```
scala> lessThan(1, 2)
<console>:8: error: inferred type arguments [Int] do not conform to method lessThan's type parameter bounds [T <: Ordered[T]]
       lessThan(1, 2)
       ^

scala> import runtime._
import runtime._

scala> lessThan(new RichInt(1), new RichInt(2))
<console>:8: error: inferred type arguments [scala.runtime.RichInt] do not conform to method lessThan's type parameter bounds [T <: Ordered[T]]
       lessThan(new RichInt(1), new RichInt(2)) 
```

本质上，我相信我想要这个 Haskell 代码的等价物：

```
lessThan :: (Ord a) => a -> a -> Bool
lessThan x y = x < y 
```

我在 Debian 系统上使用 scala 2.7.3。

我错过了什么，在哪里？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-03-27T22:21:27.187

Scala 中的 Haskell 类型类的等价物是通过隐式完成的。有两种方法可以做你想做的事

第一个是视图边界

```
scala> def lessThan[T <% Ordered[T]](x : T, y : T) = x < y
lessThan: [T](T,T)(implicit (T) => Ordered[T])Boolean

scala> lessThan(1,2)
res0: Boolean = true 
```

第二种是带隐式参数

```
scala> def lessThan[T](x : T, y : T)(implicit f : T => Ordered[T]) = x < y      
lessThan: [T](T,T)(implicit (T) => Ordered[T])Boolean

scala> lessThan(4,3)
res1: Boolean = false 
```

前者是后者的语法糖。后者允许更大的灵活性。

# iphone - 这两个 iPhone UI 是如何完成的？

> ID：691423
> 
> 赞同：0
> 
> 时间：2009-03-27T20:58:49.507
> 
> 标签：iphone, cocoa, cocoa-touch

这对你们中的一些人来说可能是微不足道的，但我有两张来自 Lose It 的截图！我很好奇两个不同的屏幕是如何组合在一起的应用程序。

首先： ![http://dl-client.getdropbox.com/u/57676/screenshots/loseit1.jpg](https://i.stack.imgur.com/ybcm3.jpg)

显示统计图表的中间图。那是在 Core Graphics / Quartz 上绘制的自定义图像以实现所需的数字吗？动态分配的黄线是 Quartz 的所有工作吗？

第二： ![http://dl-client.getdropbox.com/u/57676/screenshots/loseit2.jpg](https://i.stack.imgur.com/1C3QO.jpg)

这个可能更简单一些，但整个栏看起来像一个原生的 UIKit 小部件，其中包含 [预算、食物、锻炼、净额、下]。上面似乎有一个阴影。他们在 UINavigationBar 上做投影吗？它下面的菜单是否只是一个 UIImage，设计师可以制作它看起来像 UINavigationBar？

如果那里有一个博客教授诸如此类的 UI 技巧，我很乐意阅读更多。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-27T21:04:34.437

1）是的，很可能是一个以图表为背景，然后使用核心图形来渲染线条的视图，

2) 这可以是一个单独的视图，分为四个部分。每个部分都有两行用不同颜色绘制的文本。每个部分都可能是封装此行为的视图。

我不知道有任何博客教授这些“技巧”。这实际上是一个了解可用功能然后创造性地使用它来开发您的 UI 的案例。

例如，我们知道有可能；

*   绘制不同尺寸/位置的图像。
*   以不同的字体、大小、颜色、对齐方式绘制文本
*   绘制图元

真的，当你拥有这些时，你几乎可以创造任何东西。

我认为有一个 SDK 示例演示了使用自定义视图创建精美的时区样式应用程序。这可能是值得一试的。

更新：找到了，就在[这里](http://developer.apple.com/iphone/library/samplecode/TableViewSuite/index.html)。

# facebook - 你如何在 facebook 页面上发布到墙上（不是个人资料）

> ID：691425
> 
> 赞同：86
> 
> 时间：2009-03-27T20:59:52.077
> 
> 标签：facebook, facebook-wall

我有一个用 php 编写的博客站点，它使用 php curl 传递的简单 http 帖子请求将新的博客帖子发布到 twitter 和博客自动 ping。

我有一个博客网站的 Facebook 页面，并希望将更新发布到页面上的墙上，有没有简单的方法可以做到这一点？

我真正想要的是一个 url 和一组参数来打包为一个 http post 请求。

请注意，这是在新样式页面而不是个人资料上发布到墙上。

提前致谢。

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2010-08-07T08:26:45.673

[从github](https://github.com/facebook/facebook-php-sdk)获取 PHP SDK并运行以下代码：

```
<?php
$attachment = array(
    'message' => 'this is my message',
    'name' => 'This is my demo Facebook application!',
    'caption' => "Caption of the Post",
    'link' => 'http://mylink.com',
    'description' => 'this is a description',
    'picture' => 'http://mysite.com/pic.gif',
    'actions' => array(
        array(
            'name' => 'Get Search',
            'link' => 'http://www.google.com'
        )
    )
);

$result = $facebook->api('/me/feed/', 'post', $attachment); 
```

上面的代码会将消息发布到您的墙上……如果您想发布到您的朋友或其他人的墙上，请替换`me`为该用户的 Facebook 用户 ID。有关更多信息，请查看 API 文档。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2011-06-05T12:56:20.400

这对我有用：

```
try {
       $statusUpdate = $facebook->api('/me/feed', 'post',
                 array('name'=>'My APP on Facebook','message'=> 'I am here working',
                 'privacy'=> array('value'=>'CUSTOM','friends'=>'SELF'),
                 'description'=>'testing my description',
                 'picture'=>'https://fbcdn-photos-a.akamaihd.net/mypicture.gif',
                 'caption'=>'apps.facebook.com/myapp','link'=>'http://apps.facebook.com/myapp'));
 } catch (FacebookApiException $e) {
      d($e);
} 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2011-05-16T09:26:01.753

Harish 在这里有答案 - 除非您需要`manage_pages`在进行身份验证时请求许可，然后在发布时使用`page-id`而不是`me`......

```
$result = $facebook->api('page-id/feed/','post',$attachment); 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-09T19:19:19.153

正如弗兰克指出的那样，如果不创建应用程序并使用模板化的提要发布者，您将无法自动发布到 Facebook 墙上。

您唯一能做的就是使用他们提供的“共享”小部件，这需要用户交互。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-10-22T17:58:14.980

如果您的博客输出 RSS 提要，您可以使用 Facebook 的“ [RSS Graffiti](http://www.rssgraffiti.com/) ”应用程序将该提要发布到 Facebook 的墙上。还有其他 RSS Facebook 应用程序；只需搜索“Facebook 的 RSS 应用程序”...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-10-08T04:41:13.397

您可以通过选择 HTTP 方法并设置可选参数来进行 api 调用：

```
$facebook->api('/me/feed/', 'post', array(
    'message' => 'I want to display this message on my wall'
)); 
```

> 提交帖子到 Facebook 墙：
> 
> 包含 fbConfig.php 文件以连接 Facebook API 并获取访问令牌。
> 
> 发布消息、名称、链接、描述，图片将提交到 Facebook 墙。将显示提交后的状态。
> 
> 如果 FB 访问令牌 ($accessToken) 不可用，将生成 Facebook 登录 URL，并将用户重定向到 FB 登录页面。

[发布到 facebook 墙 php sdk](https://www.codexworld.com/post-to-facebook-wall-from-website-php-sdk/)

```
<?php
//Include FB config file
require_once 'fbConfig.php';

if(isset($accessToken)){
    if(isset($_SESSION['facebook_access_token'])){
        $fb->setDefaultAccessToken($_SESSION['facebook_access_token']);
    }else{
        // Put short-lived access token in session
        $_SESSION['facebook_access_token'] = (string) $accessToken;

        // OAuth 2.0 client handler helps to manage access tokens
        $oAuth2Client = $fb->getOAuth2Client();

        // Exchanges a short-lived access token for a long-lived one
        $longLivedAccessToken = $oAuth2Client->getLongLivedAccessToken($_SESSION['facebook_access_token']);
        $_SESSION['facebook_access_token'] = (string) $longLivedAccessToken;

        // Set default access token to be used in script
        $fb->setDefaultAccessToken($_SESSION['facebook_access_token']);
    }

    //FB post content
    $message = 'Test message from CodexWorld.com website';
    $title = 'Post From Website';
    $link = 'http://www.codexworld.com/';
    $description = 'CodexWorld is a programming blog.';
    $picture = 'http://www.codexworld.com/wp-content/uploads/2015/12/www-codexworld-com-programming-blog.png';

    $attachment = array(
        'message' => $message,
        'name' => $title,
        'link' => $link,
        'description' => $description,
        'picture'=>$picture,
    );

    try{
        //Post to Facebook
        $fb->post('/me/feed', $attachment, $accessToken);

        //Display post submission status
        echo 'The post was submitted successfully to Facebook timeline.';
    }catch(FacebookResponseException $e){
        echo 'Graph returned an error: ' . $e->getMessage();
        exit;
    }catch(FacebookSDKException $e){
        echo 'Facebook SDK returned an error: ' . $e->getMessage();
        exit;
    }
}else{
    //Get FB login URL
    $fbLoginURL = $helper->getLoginUrl($redirectURL, $fbPermissions);

    //Redirect to FB login
    header("Location:".$fbLoginURL);
} 
```

参考文献：

[https://github.com/facebookarchive/facebook-php-sdk](https://github.com/facebookarchive/facebook-php-sdk)

[https://developers.facebook.com/docs/pages/publishing/](https://developers.facebook.com/docs/pages/publishing/)

[https://developers.facebook.com/docs/php/gettingstarted](https://developers.facebook.com/docs/php/gettingstarted)

[http://www.pontikis.net/blog/auto_post_on_facebook_with_php](http://www.pontikis.net/blog/auto_post_on_facebook_with_php)

[https://www.codexworld.com/post-to-facebook-wall-from-website-php-sdk/](https://www.codexworld.com/post-to-facebook-wall-from-website-php-sdk/)

# ejb-3.0 - 何时使用 POJO 和何时使用 SLSB

> ID：691428
> 
> 赞同：1
> 
> 时间：2009-03-27T21:00:50.483
> 
> 标签：ejb-3.0, pojo

我们在我们的应用程序中使用 EJB3。我们的设计目标是将持久层与业务层分开。所以我们开发了用作 SLSB 的 XXXbean 类和用作持久性类的 XXXRepository 类。我们还有 POJO 实现可重用的 NON 业务逻辑（获取国家列表等），然后我们调用服务/助手类。

我们使用 EJB3 JPA（使用 Hibernate 提供程序），并且 Repository 类具有用于 CRUD 操作的所有方法和用于数据访问的 get 方法。目前 XXXRepository 类都是 POJO，我们直接从 bean XXXClasses 或从服务对象实例化这些类。

XXXRepository 类应该是 SLSB 吗？将它们转换为 SLSB 的好处和缺陷是什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-03-02T15:58:00.323

EJB 是容器管理的 bean。这意味着，容器管理许多选项，如事务、安全、资源访问（例如数据库），并提供定时器、远程访问或拦截器等可能性。另一个优点是池和实例的重用。

我想说，如果您需要从这个容器管理的选项中获得一些东西，比如实体管理器，那么请使用 EJB，在您的情况下使用 SLSB。但是，如果您不需要任何提供的功能，那么通常的 POJO 就可以完成这项工作。

如果 XXXRepository 类没有 SLSB，它们如何访问数据库来执行 CRUD 操作？您是否直接使用休眠会话？交易如何管理？在这种情况下，在 SLSB 中转换这些类并使用注入的实体管理器可能是有意义的。

Adam Bien 写了一本名为[Real World Java EE Pattern](http://press.adam-bien.com/)的书。在这本书中，他写了关于良好的 EJB 架构的文章，还提到了哪些类应该是 EJB（例如作为事务边界的 ServiceFacade）以及哪些类可以用作 POJO。

# linq - 为什么 AsQueryable 会抛出 StackOverflowException？

> ID：691431
> 
> 赞同：0
> 
> 时间：2009-03-27T21:03:56.607
> 
> 标签：linq

我从通用列表中调用 LINQ 扩展方法 AsQueryable。当我访问它时它会引发 StackOverflowException 异常。这是在 NerdDinner asp.net mvc 演示应用程序中使用的类似技术。我究竟做错了什么？

```
 class FakeUserRepository : IUserRepository
    {
        List<User> users = new List<User>();

        public FakeUserRepository() {
            users.Add(new User() {
                UserID = new Guid("2C3028AC-B51C-4AA6-8E19-AF962AC07EE7"),
                DisplayName = "User1"
            });

            users.Add(new User() {
                UserID = new Guid("EBA48956-2BFE-4C03-8D1B-29747FA7DB25"),
                DisplayName = "User2"
            });
        }

        public IQueryable<User> Users {
            get { return users.AsQueryable(); }
        }
    }

    public interface IUserRepository
    {
        IQueryable<User> Users { get; }
    }

public class MyController : Controller
{
    IUserRepository _userRepository;

    public MyController(IUserRepository userRepository) {
        _userRepository = userRepository;
    }

    protected override void Execute(System.Web.Routing.RequestContext requestContext) {
        Guid userID = new Guid("2C3028AC-B51C-4AA6-8E19-AF962AC07EE7");

        if (requestContext.HttpContext.Request.IsAuthenticated) {
            var query = (from u in _userRepository.Users
                         where u.UserID == userID
                         select new {
                             u.DisplayName
                         }).FirstOrDefault();

            ViewData["displayName"] = query.DisplayName;
        }

        base.Execute(requestContext);
    }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T21:13:12.247

堆栈跟踪是您的朋友。异常是来自 AsQueryable 还是来自您自己的班级？

同时，检查没有说`get { return **u**sers.AsQueryable(); }``get { return **U**sers.AsQueryable(); }`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-21T01:31:03.630

也许是一个错误。并在 LINQ 4.0 中得到纠正

[http://damieng.com/blog/2009/06/01/linq-to-sql-changes-in-net-40](http://damieng.com/blog/2009/06/01/linq-to-sql-changes-in-net-40)

> 查询稳定性 Contains 现在检测自引用 IQueryable 并且不会导致堆栈溢出

在 .NET 3.5 中解决问题：当使用“自动生成值”= True 时，您必须将“延迟加载”设置为 False - 否则会出现递归错误。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T21:15:01.557

您在此处发布的代码工作正常。我猜你是真正的代码做这样的事情。

```
public IQueryable<User> Users
{
    get { return Users.AsQueryable(); }
} 
```

注意 Users.AsQueryable() 中用户的大小写。

# css - 如何在 GWT 中向 Flextable 添加行侦听器？

> ID：691446
> 
> 赞同：4
> 
> 时间：2009-03-27T21:08:01.137
> 
> 标签：css, gwt

如何将行侦听器添加到特定行或表中的所有行？我需要向行添加一种“onMouseOver”侦听器，以便当您将鼠标悬停在它们上时，它会更改行的背景颜色，就像 getRowFormatter 允许您做的那样。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2010-06-06T00:53:31.913

```
// this is click 
final FlexTable myTable = new FlexTable();
myTable.addClickHandler(new ClickHandler() {
    public void onClick(ClickEvent event) {
        Cell cell = myTable.getCellForEvent(event);
        int receiverRowIndex = cell.getRowIndex(); // <- here!
    }
}); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-30T07:24:14.117

假设 GWT 1.5.3：

**点击事件处理**

如果您正在使用`FlexTable`并且想要一个 click 事件处理程序，您可以使用[`FlexTable.addTableListener()`](http://google-web-toolkit.googlecode.com/svn/javadoc/1.5/com/google/gwt/user/client/ui/HTMLTable.html#addTableListener(com.google.gwt.user.client.ui.TableListener))并注册您自己的[`TableListener`](http://google-web-toolkit.googlecode.com/svn/javadoc/1.5/com/google/gwt/user/client/ui/TableListener.html). 该`TableListener`对象将需要实现`onCellClicked`回调，该回调将为您提供行号。

**其他事件处理（例如悬停）**

如果您需要处理除单击（例如，悬停）之外的其他类型的事件，GWT 目前还没有现成的接口。你几乎是自己去实现它们。我现在可以想到两种方法：

1.  快速而肮脏的方法可能是利用 JSNI，它为您提供了一种将 Javascript 注入 GWT 代码的方法。我在我的代码中没有使用太多 JSNI（除了非常困难的变通方法，不值得用纯 GWT 编写它），所以我不能给你看一个例子；但坦率地说，我不会推荐这样做，因为它会降低可维护性和可扩展性。

2.  如果您想要一个原生的 GWT 接口，您可以创建一个继承 HTMLTable 或 FlexTable 的新类。在构造[`sinkEvents`](http://google-web-toolkit.googlecode.com/svn/javadoc/1.5/com/google/gwt/user/client/ui/UIObject.html#sinkEvents(int))函数中，使用您需要的事件调用该函数。（例如，对于悬停，您可能需要 sinkEvents(Event.ONMOUSEOVER)）。然后，您将需要处理鼠标悬停的 onBrowserEvent 函数。

    代码外观的快速模板：

    ```
    import com.google.gwt.user.client.DOM;
    import com.google.gwt.user.client.Event;
    import com.google.gwt.user.client.ui.FlexTable;
    public class FlexTableWithHoverHandler
        extends FlexTable
    {
        public FlexTableWithHoverHandler()
        {
            super();
            sinkEvents(Event.ONMOUSEOVER);
        }
        @Override
        public void onBrowserEvent(Event event)
        {
            switch(DOM.eventGetType(event))
            {
            case Event.ONMOUSEOVER:
                // Mouse over handling code here
                break;
            default:
                break;
            }
        }
    } 
    ```

    学习如何编写代码的最好方法是查看 GWT 源代码本身（搜索`sinkEvent`）并了解如何以 GWT 方式编写代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-09-21T16:28:47.383

我发现将 javascript 直接添加到 TR 元素非常简单。我的代码假定小部件 DOM 父级是 TD，祖父级是 TR，因此您需要确保您知道您的 DOM。

这是我的代码。漂亮而简单，不需要 JSNI 或 GWT DOM 事件管理。

TableRowElement rowElement = (TableRowElement) checkbox.getElement().getParentElement().getParentElement();

rowElement.setAttribute("onMouseOver", "this.className='" + importRecordsResources.css().normalActive() + "'");

rowElement.setAttribute("onMouseOut", "this.className='" + importRecordsResources.css().normal() + "'");

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-08-11T20:42:43.087

我只是以这种简单的方式做到了：

```
protected void handleRowsSelectionStyles(ClickEvent event) {
    int selectedRowIndex = fieldTable.getCellForEvent(event).getRowIndex();
    int rowCount = fieldTable.getRowCount();
    for (int row = 0; row < rowCount; row++) {
        Element rowElem = fieldTable.getRowFormatter().getElement(row);
        rowElem.setClassName(row == selectedRowIndex ? "row selected" : "row");
    }
} 
```

您从您希望可点击的单元格中调用此方法

```
int row = 0;
for (final RowDataProxy rowData : rowDataList) {
    Label fieldName = new Label(rowData.name());
    fieldName.addClickHandler(new ClickHandler() {

        @Override
        public void onClick(ClickEvent event) {
            handleRowsSelectionStyles(event);
        }
    });
    fieldTable.setWidget(row++, 0, fieldName);
} 
```

最好的祝福，

齐德哈姆迪

# windows - Windows 注册表最佳实践

> ID：691448
> 
> 赞同：19
> 
> 时间：2009-03-27T21:08:15.100
> 
> 标签：windows, registry

Windows 注册表的使用方式是什么？我知道存储少量用户偏好是可以的，但是将所有用户数据存储在那里被认为是不好的做法吗？我认为这将取决于数据集，所以对于少量数据，比如小于 2KB，在 100 个左右不同的键/值对中怎么样。这是不好的做法吗？平面文件或 SQLite db 会是更好的做法吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-29T17:39:25.800

我将采取相反的观点。

注册表是放置所有类型配置数据的好地方。通常，它比大多数配置文件更快且更可靠（注册表上的各个操作都是事务处理的，因此如果您的应用程序在写入期间崩溃，则注册表不会损坏 - 通常 ini 文件不会出现这种情况）。

Marcelo MD 是完全正确的：在注册表（或任何其他非易失性存储）中存储诸如操作完成百分比之类的东西是一个可怕的想法。另一方面，存储最近使用的文件之类的数据就很好——注册表就是为这种问题而构建的。

这篇文章中讨论 MRU 列表的其他一些评论者讨论了当 MRU 列表由于应用程序崩溃而不同步时会发生什么问题。我想知道为什么将 MRU 列表存储在每个用户存储的平面文件中会更好？

我也不确定将数据存储在注册表中的“安全隐患”是什么。注册表和文件系统一样安全——注册表和文件系统使用相同的 ACL 机制来保护它们的数据。

如果您要将您的用户数据存储在一个文件中，您绝对应该将您的数据至少放在 %APPDATA%\CompanyName\ApplicationName - 如果两个不同的开发人员创建一个具有相同名称的应用程序（有多少“媒体管理器”应用程序在那里？）你不会有碰撞。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-27T21:14:31.497

对我来说，简单的用户配置项和用户数据最好存储在简单的 XML 配置文件、SQLLite db 或 MS SQL Server Compact db 中。确切的存储介质取决于实现的细节。

我只将注册表用于我需要不经常设置并且用户不需要能够更改/查看的内容。例如，我之前在注册表中存储了加密的许可证信息，以避免用户意外删除数据。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-27T21:21:46.720

使用注册表存储数据主要有一个问题：它不是很人性化。用户几乎没有机会备份他们的设置、将它们复制到另一台计算机、在它们被损坏时对其进行故障排除（或重置它们），或者通常只是*查看*他们的软件在做什么。

我的经验法则是仅使用注册表与操作系统进行通信。文件类型关联、卸载程序条目、启动时运行的进程，这些东西显然必须在注册表中。

但是在您的应用程序中使用的数据只属于您的 App Data 文件夹中的一个文件。（无论如何，微软目前希望您使用的 3 个以上 App Data 文件夹之一）

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-27T21:16:16.530

由于每个用户在 Windows 中都有专门用于存储应用程序用户数据的目录空间，因此我使用它来存储用户级数据（例如首选项）。

在 C# 中，我会通过执行以下操作来获得它：

```
Environment.GetFolderPath( Environment.SpecialFolder.ApplicationData); 
```

通常，我会在那里存储 SQLite 文件或任何适合应用程序的文件。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-29T15:09:49.017

如果您的应用程序要“在企业中”部署，请记住管理员可以使用组策略工具调整注册表。例如，如果 Firefox 将注册表用于代理服务器之类的东西，它会使部署变得轻而易举，因为管理员可以使用活动目录中的标准工具来设置它。如果您使用其他任何东西，我认为这样的事情不会很容易完成。

所以不要一起关闭注册表。如果管理员有可能希望跨网络标准化您的部分配置，请将设置放入注册表中。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-27T21:15:33.037

我认为微软鼓励使用隔离存储而不是 Windows 注册表。

[这](http://www.codeproject.com/KB/dotnet/IsolatedStorage.aspx)是一篇解释如何在 .Net 中使用它的文章。

您可以在 Windows XP 中的 Documents & Settings\\Local Settings\App Data\Isolated Storage 下找到这些文件。数据位于 .dat 文件中

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-27T22:03:58.553

我会区分：

一方面，应用程序运行需要特定于应用程序的配置数据，例如要连接的 IP 地址、用于哪种文件的文件夹等，以及每个用户的设置都非常重要。我放入配置文件的那些，简单的东西的ini格式，如果变得更复杂，则使用xml。

另一方面，每个用户的设置都是微不足道的（最好的例子：窗口位置和布局）。为了避免弄乱配置文件（有些用户想要自己编辑，所以必须很少且排列清晰的条目），我喜欢将它们放在注册表中（如果注册表中没有设置，则在应用程序中设置保守的默认值能够被找到的）。

我主要像[istmatt](https://stackoverflow.com/questions/691448/windows-registry-best-practices/691474#691474) sais 那样做：我将配置文件存储在`%APPDATA%`文件夹中。通常在.NET 中`%APPDATA%\ApplicationName`，我不喜欢 .NET 默认的 `APPDATA%\CompanyName\ApplicationName\Version`，这种详细程度和复杂性对于大多数中小型应用程序来说适得其反。

我不同意[Marcelo MD](https://stackoverflow.com/questions/691448/windows-registry-best-practices/691501#691501)的示例，即不在注册表中存储最近使用的文件。IMO 这正是可以存储在那里的易失性用户特定信息。（不过，他的不做什么的例子**非常**好！）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-27T21:23:52.143

对我来说，想到不应该放在那里的东西似乎更容易。例如：动态数据，例如编辑器的“最后打开的文件”和每个项目的选项。当您的应用程序失去与注册表的同步（文件删除、系统崩溃等）并检索到不再有效的信息时，这真的很烦人，可能会导致用户死锁。

在较早的工作中，我看到一个人在那里存储了数据传输完成百分比，每隔 10k 左右写入新值，并让 GUI 每秒检索该值，以便它可以显示在标题栏上。

# javascript - 双脚本标签中的任何值？

> ID：691449
> 
> 赞同：4
> 
> 时间：2009-03-27T21:08:38.250
> 
> 标签：javascript, html

我在几段代码中看到了这一点，我不想“假设”它不重要，但这是 Google Analytics 代码的副本：

```
<script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-xxxxxx");
        pageTracker._trackPageview();
    } catch(err) {}
</script> 
```

您会注意到有两个打开/关闭脚本标签。为什么将代码位封装在两个不同的脚本标签中是有益的？我的第一反应是简单地删除冗余。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T21:15:34.643

第一个块将`<script>`标签写入页面。我认为如果代码都在一个块中，则无法保证在`<script>`代码的第二部分执行之前会加载书面代码。

通过使用两个块，写入将在第二个块执行之前`<script>`加载（其中包含对象）。`_gat`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T21:10:53.360

我猜这两个脚本块是由不同的源模块（类/对象/其他）创建的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T21:11:03.377

页面有两个脚本标签的最可能原因是因为系统的两个独立模块都希望将 javascript 功能添加到页面，但希望确保它干净地插入自己。

如果他们将页面创作为单个静态页面，那么一个脚本标签就可以了。由于该页面可能是动态生成的，因此不必太担心。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T21:57:42.530

如果第一个脚本标签发生错误，第二个脚本仍然会执行。

但是，如果第二个依赖于第一个（例如，如果它使用第一个中定义的函数），它可能仍然会失败。（因为第一个没有完全执行）

# asp.net - ASP.NET 变量问题

> ID：691455
> 
> 赞同：0
> 
> 时间：2009-03-27T21:11:18.430
> 
> 标签：asp.net, postback, long-integer

我有一些写得非常糟糕的 ASP.NET 代码，但它不能正常工作（看图）。我负责维护和修复此代码的错误，但我几乎无法对它产生影响

不幸的是，我没有时间重写它。

如果有人可以提供帮助，那就太好了：

（代码）：在这里给你（一些必要的最小混淆）： [http://mastergeektheater.com/issues.txt](http://mastergeektheater.com/issues.txt)

**它应该做什么：** 从购物车应用程序接收订单，并根据所订购对象的数量创建一个文本框表。一旦验证了整个内容（submit_Click()），它就会显示一个带有进一步说明的 div，并使输入字段变灰，因此您仍然可以看到输入的内容，但不能再影响了。电子邮件被发送到每个输入的电子邮件地址。

**它的实际作用：** 接收订单，并正确显示输入。在提交时，所有“必填字段验证器都会触发 - 如果它们是 Vaild，则比较验证器会触发。在这里的某个地方，一切都会向南。”

表中除第一个用户外的所有输入区域都消失了。如果比较成功，则回发，第一个用户在那里（灰色），其他用户消失。如果比较失败，那么它没有成功回发，并停留在输入表单上，*但是除了第一个用户之外的所有输入字段仍然消失*

我知道这有点太具体了，不能成为一个非常完善的 Stack Overflow 问题，但我试图将其分解为我认为错误的事情，并且我提出了其他更具体的问题来尝试解决它。不幸的是，它没有奏效。代码变得更好了，但整个事情还是坏了。在这一点上，我很绝望。

如果有人可以提供帮助，那将是一个巨大的救命稻草。提前感谢所有通过这个可怕的代码（和可怕的问题）倾注一分钟的人......

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-27T23:01:49.287

我想问题可能是由于这条线。

`Session["quantity"] =(null != Request["quantity1"]) ? Request["quantity1"].ToString() : "1";` 

表单上是否有一个名为 quantity1 的字段（隐藏/输入）？
它是传递给查询字符串还是作为表单项集合的一部分？

它将为 1（当表单回发给自身时），因此循环只会运行一次。

# sql-server - Sql Server 2005、Xml 类型和 ODBC？

> ID：691457
> 
> 赞同：0
> 
> 时间：2009-03-27T21:11:30.443
> 
> 标签：sql-server, odbc

使用 xml 类型的 Sql 2005 数据库可以用 ODBC 访问吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-07-07T11:32:57.060

我相信 XML 数据类型将在很大程度上作为字符数据类型处理......

当然，OpenLink ODBC 驱动程序在本地返回 XML 数据类型作为 SQL_LONGVARCHAR。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-11-15T07:18:18.197

这在带有新 SQL_SS_XML 类型的 sql server 的本机客户端 odbc 驱动程序中得到支持。

[http://msdn.microsoft.com/en-US/library/ms131375%28v=SQL.90%29.aspx](http://msdn.microsoft.com/en-US/library/ms131375%28v=SQL.90%29.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T21:30:59.957

不确定这是否适用于所有连接到 SQL Server 2005 的 ODBC 驱动程序，但 DataDirect 确实声称支持几乎所有 SQL Server 2005 甚至大多数新的 SQL Server 2008 功能。[在这里](http://www.datadirect.com/products/odbc/odbc-sqlserver/index.ssp)查看他们的列表。

啊，[这是微软对此的评论](http://msdn.microsoft.com/en-us/library/ms130828(SQL.90).aspx)：

*如果您正在开发基于 COM 的应用程序并需要访问 SQL Server 2005 的新功能，则应使用 SQL Native Client。如果您不需要访问 SQL Server 2005 的新功能，您可以继续使用 Microsoft 数据访问组件 (MDAC)。*

所以我猜，如果您使用 SQL Native Client ODBC 驱动程序，您应该可以使用 XML 数据类型。

马克

# parsing - Mgrammar 语法和变量声明

> ID：691461
> 
> 赞同：1
> 
> 时间：2009-03-27T21:12:28.177
> 
> 标签：parsing, grammar, mgrammar

我敢肯定，我会被告知以另一种方式进行，但出于特定原因，必须以这种方式进行。如果没有，我就不会被卡住:-P

我正在使用的脚本语言必须接受这样定义的变量：

```
Variables: x(1), y("hi"); 
```

这是一个要求。我之前写了一个小语法，让我这样定义它们

```
int x = 1;
string y = "hi"; 
```

但要求发生了变化。我的语法之前的样子是这样的

```
syntax sDeclareVar = t:sType i:tID "=" x:sExpression ";"  => DeclareVar { VariableName{i},Type{t},Value{x}}; 
```

sType 的值是 System.String、Int32 等，然后是变量名，然后是表达式。然后我将其投影到 DeclareVar 节点并为其提供所需的参数，在代码中我将其解析为 XML，然后让 MGrammar 解析 XML 并很好地遍历我的 AST。由于他们希望能够在不声明类型的情况下执行变量，所以我有点坚持现在要做什么，即如何将没有声明类型的变量存储到适当的类中。任何帮助将不胜感激，希望这一切都有意义。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-27T21:31:22.733

这取决于语法的其余部分的结构，但您可能会被卡在大致按照以下方式进行操作：

```
syntax sDeclareVar = "Variables:" sVarList ":";
syntax sVarList = sVarDeclaration ("," sVarList)?;
syntax sVarDeclaration = sIntVarDeclaration | sStringVarDeclaration | ...
syntax sIntVarDeclaration = i:tID "(" x:sIntegerLiteral ")"  => DeclareVar VariableName{i},Type{Int32},Value{x}};
syntax sStringVarDeclaration = i:tID "(" x:sStringLiteral ")"  => DeclareVar VariableName{i},Type{System.String},Value{x}}; 
```

等等。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-28T15:47:52.020

谢谢马库斯，这让我走上了正轨，这就是我最终要做的。

语法 sDeclareVar = tVariableKeywords s:Common.List(sVarDeclaration) ";" => 变量列表{语句{s}}；

语法 sVarDeclaration = s:sIntVarDeclaration => s | s:sStringVarDeclaration => s;

语法 sIntVarDeclaration = ","? i:tID "(" x:tIntegerLiteral ")" => DeclareVar{VariableName{i}, Type{Type{RawValue{"System.Int32"}}}, Value{IntegerLiteral{RawValue{x}}}};

语法 sStringVarDeclaration = ","? i:tID '(' x:tStringLiteral ')' => DeclareVar{VariableName{i}, Type{Type{RawValue{"System.String"}}}, Value{StringLiteral{RawValue{x}}}};

如此接近您上面的内容，尽管将变量存储在列表中更容易，而且我还必须添加一些预测以将一些节点从我不需要的图中取出。谢谢您的帮助。

# internet-explorer-8 - IE8 会破坏我的 CDN 托管的 jQuery 吗？

> ID：691464
> 
> 赞同：7
> 
> 时间：2009-03-27T21:13:17.520
> 
> 标签：internet-explorer-8, cdn

IE8 有一个称为[InPrivate Filtering](http://blogs.msdn.com/ie/archive/2008/08/25/ie8-and-privacy.aspx)的功能，它会阻止它在来自超过“n”个不同站点的网页上找到的脚本。

我正在收听最新的“ [Security Now”](http://www.grc.com/sn/sn-189.htm)播客，该播客对这个功能赞不绝口。

与此同时，我尖叫着不！*#&$ 是什么——因为我的网站（和许多其他网站一样）包括以下内容（jQuery + SWFObject）。即我正在使用[Google 的 CDN](http://code.google.com/apis/ajaxlibs/)来托管我的 jQuery。

```
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>   
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/swfobject/2.1/swfobject.js"></script> 
```

那么有什么关系 - 我应该停止使用 CDN 中的 jQuery 和 swfobject 吗？

其他人在做什么？

**编辑：** 我不知道他们是否保留了“受信任站点”列表，但根据微软的[这一点](http://www.microsoft.com/windows/internet-explorer/features/browse-privately.aspx)，InPrivate 过滤是每个会话的。所以至少有人必须在每个会话中主动启用它。

> InPrivate 过滤默认关闭，必须在每个会话的基础上启用。要使用此功能，请从“安全”菜单中选择 InPrivate 过滤。要访问和管理 Internet Explorer 8 的不同过滤选项，请从“安全”菜单中选择 InPrivate 过滤设置。要结束您的 InPrivate 浏览会话，只需关闭浏览器窗口。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-27T21:18:49.830

如果您的网站包含人们不希望缓存的内容（银行网站、色情或其他“敏感”内容），那么我不会使用外部托管文件。或者，如果文件未加载，您的网站完全损坏，我会考虑。但是，如果您的网站是其他东西，我不会担心。我不认为这是大多数人想要隐藏他们的踪迹时会使用的功能。如果他们真的想，让他们处理后果。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-12-02T04:52:50.013

这可能看起来很傻，但既然 IE8 已经出局，为什么不打开 InPrivate 测试您的网站，看看它的行为如何？另外，如果您可以在这里报告您的发现，那就太好了:)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-12-03T02:45:33.907

看起来很有可能在启用 InPrivate 的情况下禁用此功能，但这最终取决于每个用户的浏览习惯。

如果用户以常规模式访问 10 个站点，这些站点都链接到来自同一个第三方域的文件，则在启用 InPrivate 时，指向该域上文件的链接将被阻止。

因此，虽然您将无法利用 CDN，但如果您需要这些文件可靠地工作，您应该自己托管此类文件。

> InPrivate Blocking 会在您浏览时保留上述第三方项目的记录。当您选择使用 InPrivate 浏览时，IE 会自动阻止在十多个网站上“看到”您的网站。
> 
> 您也可以手动选择要阻止或允许的项目，或者通过单击“来自本网站的更多信息”链接直接从网站获取有关第三方内容的信息。请注意，Internet Explorer 只会在您处于“常规”浏览模式时记录 InPrivate Blocking 的数据，因为在浏览 InPrivate 时不会保留浏览历史记录。一个简单的想法是，您的正常浏览决定了您在浏览 InPrivate 时要阻止哪些项目。

免责声明：由于我没有 IE8，因此我实际上没有测试过任何这些，但是您链接到的文档对此非常清楚。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T21:18:04.530

您应该在自己的站点上托管 JS 文件。

这是在您的站点上托管 JS 文件[的另一个原因。](http://news.zdnet.com/2100-9595_22-302332.html?tag=nl.e539)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-12-06T00:36:54.827

我一直想知道，如果 CDN 关闭/不可用，是否有可能进行安全的回退？

就像是：

```
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script> 
<script type="text/javascript">
   if (typeof jQuery == 'undefined') {
       document.write(unescape("%3Cscript src='local/jquery.min.js' type='text/javascript'%3E%3C/script%3E"));
}
</script> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-12-03T23:30:04.933

我认为会有一小部分人使用 IE8（*我认为*），然后打开“InPrivate Browsing”选项。谷歌的 CDN 不知何故说“它在用户访问网站的位置附近有一个服务器，因此性能得到了提高”（未直接引用）。IE 过去给我带来了很多问题，我放弃了对它的支持。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-12-04T18:42:35.353

它是否可以从站点的域名（例如 ajax.googleapis.com）工作，还是可以解析名称？如果它只是记录域，你不能把它包装在一个 CNAME 中，例如 js.yourdomain.com -> ajax.googleapis.com 吗？

# visual-studio - Visual Studio 安装项目有任何限制吗？

> ID：691469
> 
> 赞同：2
> 
> 时间：2009-03-27T21:15:22.150
> 
> 标签：visual-studio, deployment, installation, windows-installer

使用 VS 设置项目时，我可能会遇到任何限制吗？我打算使用它们，但不确定这是否是个好主意。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T21:22:35.593

好吧，在更高级的设置中：VS 设置项目不能自动化，例如，您不能将项目和 VS 设置项目放在构建服务器上并自动构建它们。对于较小的商店或单个开发人员来说，这可能不是问题，但对于较大的企业级开发环境来说，仅此一项就可能是一个非常致命的标准。

为了解决这个问题，我们使用 WiX 进行设置 - 前期工作更多，但可以很好地与持续集成配合使用。

马克

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T21:18:54.980

他们没问题，如果你从头开始我会说看看 WIX，或者甚至为 Install Shield 或其他商业项目之一支付现金，从长远来看，这将为你节省时间和金钱。

构建可能非常缓慢，尤其是在您有大量二进制文件的情况下。我有一个包含大量产品图像的项目，这些图像被打包到安装包中，这需要很长时间，即使在快速机器上也是如此。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-03-07T17:08:39.907

Visual Studio 安装项目缺少 Windows Installer 提供的许多关键功能。其中最值得注意的是“功能”功能，它允许您设置用户可以选择安装或排除的多个工具。如前所述，使用 WiX 或第 3 方全功能安装工具。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T21:17:42.440

我想这取决于你的项目。过去使用它来设置 Web 项目很痛苦，但我认为现在有一个插件可以让创建 Web 应用程序设置变得更加容易。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-04-11T05:17:01.290

更多限制...

*   安装项目中无法对用户在 UI 对话框（采集阶段）上提供的数据执行验证。
*   无法指定自定义操作以提升权限（系统帐户）运行。
*   无法让您的自定义操作在 UI 序列期间执行。

# php - 单行 if 语句或没有大括号的 if 语句是不好的做法吗？

> ID：691476
> 
> 赞同：17
> 
> 时间：2009-03-27T21:16:28.900
> 
> 标签：php, c, coding-style

```
if (condition) { /* do something */ }
else { /* do something */ }

if (condition)
    /* do something */
else
    /* do something */ 
```

有人告诉我，第一个实例不是一个好主意。我不知道这是否真的是这种情况（或第二种情况）；它不会缩短键入的数量吗？还是因为它只会弄得一团糟？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-03-27T21:21:35.677

最佳实践是编写其他人可以轻松阅读和更新的代码。

您的第一个表单是有问题的，因为它不遵循大多数 PHP 开发人员习惯的表单：

```
if (condition) {
  // code
} else {
  // code
}

// ... or ...

if (condition)
{
  // code
}
else
{
  // code
}

// ... or ...

if (condition) { /* short code */ } else { /* short code */ }

// ... or ...

condition ? /* short code */ : /* short code */; 
```

请注意，这完全是关于标准实践，不一定有意义——它只是关于其他开发人员习惯看到的内容。

更重要的是，您的第二种形式不太好，因为它使其他程序员很容易犯这个错误：

```
if (condition)
  // code A
else
  // code B
  // code C (added by another programmer) 
```

在此示例中，另一个程序员添加了`code C`，但忘记将整个`else`块包裹在大括号中。这会导致问题。`if`您可以通过简单地将您的和`else`块包裹在大括号中来防御这种情况。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-27T21:23:16.217

如果为了一致性，我的偏好......所以：

```
if(...)
{
   statement 1;
   statement 2;
}
else
{
   statement 1;
   statement 2;
} 
```

无异于：

```
if(...)
{
   statement 1;
}
else
{
   statement 1;
} 
```

所以我总是使用它们，因为它是一致的，它避免了以后忘记添加它们的问题。

但是其他人会看到我的代码并认为放入 { 和 } 是愚蠢的。他们有他们的理由，我有我的……我碰巧喜欢我的理由胜过喜欢他们的理由:-)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-27T21:17:02.083

通常不可读的代码是一种不好的做法。单行在您的打字和保存行号时效率更高，但在一年后或在您扫描错误时再使用它，这会使它变得更加困难。

在我看来，是的，单行 if 语句是不好的做法。

计算机并不真正关心（据我所知），但您应该始终编写代码，就像它将由知道您住在哪里的连环杀手维护一样。

可读！很容易自我辨别。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-27T21:19:43.417

我看到的问题是开发人员在将代码添加到其中一个条件时无法识别 {}-less-if。例子：

```
//before
if(something)
    statement;

//after
if(something)
    statement;
    addedstatement; 
```

显然，这不会达到他们的预期。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-27T22:23:33.123

你在 C 或 C++ 中见过这样的代码吗？

```
 /*  Warning:  bogus C code!  */

if (some condition)
        if (another condition)
                do_something(fancy);
else
        this_sucks(badluck); 
```

缩进错误，或者程序有问题，因为“else”总是适用于最近的“if”，除非你使用大括号。

*（让我们只使用python。没有括号，只是纯干净的空格。：P）*

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-27T21:26:30.610

对于除最短语句之外的所有语句，请使用大括号并相应地隔开它们。你想这样做有几个原因：

*   在某件事的去向上犯错更难。

*   它更容易阅读。

*   在具有宏扩展功能的语言（例如 C、C++）中，当包含多个语句的宏在无括号的`if-else`.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-27T22:24:50.187

使用多行的一个主要好处是易于调试。如果你在一行上有一个 if else 语句，并且调试器告诉你第 x 行爆炸了，那么确定语句的哪一部分失败就更困难了。多行代码还可以更轻松地使用调试器单步执行代码。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-27T21:21:29.513

那是两行长，所以不是真正的一行。

`if`当它使代码*更易于*阅读时，单行 s 没有任何问题。

例如，像这样：

```
if (last_item) print ", and " else print ", " 
```

比

```
if (last_iem)
{
    print ", and "
}
else
{
    print ", "
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-27T21:24:33.810

这比其他任何东西都更具编码风格。也就是说，我个人认为你的第二个例子可能非常有害。在大括号是创建块的唯一方法的语言中，很容易意外地“在块中添加第二行”。但是在存在替代语法的 PHP 中，这更不可能引发必要的警告：

```
if ($_GET["asdf"]==1):
    /* do something */
else:
    /* do something */
endif; 
```

经验法则：如果您要将“做某事”放在单独的行上，请使用大括号；如果您不打算使用大括号，请将其放在同一行！

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-27T21:33:56.567

我见过很多带有愚蠢问题的第三方代码，我更喜欢一直使用大括号。那就是说我从来没有感觉好过

```
if(){}
else (){} 
```

当它是一条简短的指令并且它是单独的时，我在同一行使用 if(){}。如果有 else 使用 long：

```
if(checkSomething)
{
   //dosomething
}
else
{
   //doanotherthing
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-27T22:15:31.037

这是我从不久前的一次就业考试中真正记得的事情。代码类似于以下内容：

```
if (x == 0)
    x = 2;
else
    print("x is: %d", x); // debugging!
    x = 4; 
```

这里的大多数人都可以发现错误，但是您可以将任何您想要的东西替换为插入的“错误代码”。当你有一个“旧版本”的东西被注释掉时，更微妙的错误出现了，有人取消了它的注释，突然第二个语句在块之外。

基本上，除非它是一个快速学习概念的小型测试应用程序，否则我*总是*括起来（甚至在我*通常*括起来的测试应用程序中）。如果我不这样做，即使在 5 行方法中也不值得头疼。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-27T23:05:10.263

您应该将“if”和“do something”放在不同的行中，以使您的代码对交互式调试器更友好。

如果你把“if”和“do something”放在同一行，那么你不能在“do something”行设置断点。

# matlab - 如何在 MATLAB 图中结合设置轴限制和缩放？

> ID：691489
> 
> 赞同：3
> 
> 时间：2009-03-27T21:19:51.640
> 
> 标签：matlab

这是 MATLAB 会话中的基本情况

```
>> figure
>> h=axes;
>> y=sin(0:2*pi/100:pi);
>> plot(y);
>> set(h,'xlim',[20 80]); 
```

现在我希望能够使用图形工具栏的放大/缩小按钮来重置视图，以便 x 轴限制为默认值（即 [0 100]）。但是，它们只允许放大和缩小当前视图。必须有一种简单的方法在代码中设置绘图视图，允许用户使用图形工具栏的缩小按钮再次缩小。有什么想法或建议吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-27T22:00:08.297

简单的答案：`zoom reset`在设置轴限制之前调用。如在

```
>>plot(y)
>>zoom(gcf,'reset') % reset the zoom out point to current view
>>set(h,'xlim',[20 60]); 
```

# linq - 字符串或二进制数据将被截断错误

> ID：691493
> 
> 赞同：0
> 
> 时间：2009-03-27T21:21:33.210
> 
> 标签：linq, linq-to-sql

我在 SQL 2005 中使用 Linq to SQL。我正在解析一个固定宽度的大型文件，并通过使用属性属性映射到数据库的自定义实体将数据导入 SQL。

在抛出此错误之前，该程序运行了大约 240 条记录。我已经检查了列（全部四个）和它试图放入的数据，它不应该抛出这个错误。我什至已经将列从 varchar 更改为 text，但它仍然会引发错误。当我手动插入相同的值时，它们插入得很好。

Linq to SQL 中是否存在已知错误或任何内容？我在每个要插入的循环上调用 context.submitall() 。我[读过](https://stackoverflow.com/questions/306459/any-clever-way-to-fix-string-or-binary-data-would-be-truncated-warning-with-lin/416482#416482).NET 3.5 SP1 从 SQL 提供了更好的错误消息，但我仍然没有看到任何东西。

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-27T21:51:53.480

自从您构建 Linq to SQL 类以来，您是否可能更改了架构？当您更改 SQL 架构时，设计器实体不会更新，除非您在设计器中删除/重新创建类或手动编辑设计器生成的类的属性。我知道它会跟踪类中字符串（varchar）列的列宽——尽管我不知道它是在提交之前实际检查它还是只是将它作为任何验证的参考。不过，我已经看到了类似的问题，比如自动生成的 id，这些问题是通过更新设计器中的类来解决的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-02T05:40:20.867

嗯，我发现了这个bug，而且绝对不是Linq 或者SQL 的问题。我正在切碎并更改另一个对象的属性，没有意识到它现在通过 Linq 附加到 SQL，并且是该对象引发了错误。

经验教训：不要直接更改对象的属性，除非您真的想更改它们，尤其是当它附加到数据上下文时。

# sql-server - 将 Access 链接从 SQL Server 更改为另一个 Access 文件？

> ID：691500
> 
> 赞同：1
> 
> 时间：2009-03-27T21:23:38.137
> 
> 标签：sql-server, ms-access, odbc, ms-access-2007

我已经看到很多关于将数据从 Access 移动到 SQL Server 的问题，但我想走另一条路。原因如下：

我一直在从事一个具有 SQL Server 2008 后端和 Access 2007 前端的大型项目。我希望能够在周末在家中做一些前端工作，但我无法从那里访问（VPN 或其他方式）SQL Server。我想将我的链接表从 SQL Server 更改为另一个 Access 数据库文件，我在其中导入了 SQL Server 数据的快照。然后，在星期一早上，将链接切换回 SQL Server。

我的问题是当我转到链接表管理器并尝试更改链接时，我得到的只是 ODBC 选择数据源对话框。如果我尝试链接到 Access 数据库，它会告诉我 ODBC 不能用于链接、导入或导出到另一个 Access 文件。

我想到了一个想法，但我还没有尝试过；也许有人可以告诉我这是一个好主意还是坏主意：我能否删除链接，将它们重新创建到另一个 Access 文件，并且不会丢失我的查询/表单/报告中的任何功能？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-28T17:23:32.727

我的建议是在您的计算机上安装 SQLExpress（免费）。然后，您可以在机器上获得所有可用数据。在您的主服务器上创建一个发布，并让您的本地计算机订阅此复制（如果您不需要保存/同步在您的计算机上完成的数据更改，您可以坚持基本的“快照”复制。）

然后，您只需将连接字符串从您的网络 MSSQLSERVER 更改为您的 localhost SQLEXPRESS 服务器实例即可让您的应用程序正常工作。

如果出于任何原因，您必须在离线时更改数据库模型，那么您必须在本地服务器上进行更改之前取消订阅主服务器。当您回到办公室时，请确保在主服务器上进行相同的更改。我的建议是在 T-SQL 中编写您的更改，将它们保存在一个文件中，并在您恢复工作后针对主服务器启动该文件。

**我的意见**：周末不要工作太多，或者确保您的客户为此付费。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-28T05:13:46.163

对于链接表，您需要完全删除它们并重新创建它们。当您仍在使用 ODBC 时，使用链接表管理器刷新 ODBC 链接甚至无法可靠地工作，因为表链接定义中缓存的数据不会被刷新（例如，如果您更改了SQL Server 视图，使用链接表管理器刷新表链接将更新列数，但您不一定会获得可更新的视图（假设原始视图是可更新的）。

但尚不清楚您是否会失去功能。这一切都取决于您的应用程序的逻辑有多少是服务器端的，在 SQL Server 视图和存储过程中。如果您链接到 Jet 后端，这些都不起作用。

# web-safe-fonts - Rockwell 是网络安全字体吗？

> ID：691504
> 
> 赞同：27
> 
> 时间：2009-03-27T21:24:39.270
> 
> 标签：web-safe-fonts

最近，我们从一个客户那里收到了一个网站模型，该模型在菜单项、文章标题、块标题等的布局中广泛使用了[Rockwell字体……](http://www.fonts.com/findfonts/detail.asp?pid=201908)

我以前从未听说过这种字体，我认为它不是网络安全的，我也在几个地方在线检查以确认这一点，比如[这里](http://www.ampsoft.net/webdesign-l/WindowsMacFonts.html)和[这里](http://www.fonttester.com/)，但找不到任何关于这种字体的参考。

因此，在告诉设计师我们将需要使用某种文本替换技术来使用这种字体后，他们告诉我们这确实是一种网络安全字体，并且他们在 Windows 和 Mac 中检查并安装了字体.

所以我们将使用这种字体，但我仍然很好奇这是一种标准字体，还是它与 Adob​​e 产品或任何其他应用程序一起安装。

有人有这方面的信息吗？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-03-27T21:34:43.023

有一[组非常小](http://en.wikipedia.org/wiki/Web-safe_fonts)的网络安全字体；Rockwell 不是其中之一，因为它带有第三方软件，如 Microsoft Office。

也就是说，如果您必须使用 Rockwell 作为您的主要字体，请务必为其定义一个体面的字体堆栈。也就是说，使用 CSS 来定义一个后备列表，其中每个后备*都是*一种网络安全字体：

```
body, input, textarea {
  font-family: Rockwell, "Courier New", Courier, Georgia,
                 Times, "Times New Roman", serif;
} 
```

关于字体堆栈的一些信息：

*   [http://www.petercolesdc.com/web-fonts-nice-honest/](http://www.petercolesdc.com/web-fonts-nice-honest/)（包括关于罗克韦尔的信息）
*   [http://unitinteractive.com/blog/2008/06/26/better-css-font-stacks/](http://unitinteractive.com/blog/2008/06/26/better-css-font-stacks/)

如今（2011 年），现代浏览器支持[通过`@font-face`](https://developer.mozilla.org/en/css/@font-face). 流行的选项包括[Typekit](http://typekit.com/)、[Google Fonts](http://www.google.com/fonts/)和[Font Squirrel](http://www.fontsquirrel.com/)。请注意，并非所有浏览器都支持通过 CSS 加载自定义字体，因此您仍应将 Web 安全字体列为备用字体。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2011-02-22T13:46:17.607

作为 Rockwell 的替代品，您可以使用来自[Google Web Fonts API](http://www.google.com/webfonts/family?family=Arvo&subset=latin)的名为 Arvo 的字体。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-27T23:06:33.490

正如其他人所说，Rockwell*不是*网络安全字体。例如，我在一个非常普通的 Windows 盒子上输入这个并且没有它。它与某些版本的 Office 一起安装。

当前接受的答案建议使用适当的 CSS 字体堆栈将 Rockwell 提供给拥有它的访问者，并将更常见但不太适合的字体提供给没有它的访问者。这是很好的建议，所以这样做。

但是，您实际上可以做得更好。所有现代非 IE 浏览器要么现在支持 CSS Webfonts，要么将在其下一个版本中支持。此模块允许您在服务器上托管字体并在访问者访问时透明地将其提供给访问者，从而允许您使用大量不可靠的字体。继续为 Rockwell 添加 Webfont 支持，使其成为字体堆栈中的第二选择（在普通 Rockwell 之后）。这将允许使用高级浏览器但未安装 Rockwell 的访问者仍然可以获得您的排版的全部效果，同时允许使用较少浏览器的访问者仍然优雅地降级为另一种字体。

最后，如果你真的需要用字体打 IE，就用图像替换。SIFR 始终是一种选择，但它确实会减慢页面速度，尤其是在您使用大量页面的情况下。我是[PIR](http://www.xanthir.com/pir/)的开发人员，这是一个不显眼且超轻量级的基于 javascript 的图像替换器，它使用 PHP 后端来生成图像。它直接从 CSS 中获取所有相关信息，甚至可以自动处理自动换行。我的一位用户还在开发一个 FastCGI 后端。PIR 生成 32 位 PNG，因此它可以提供完全透明（如果访问者使用知道如何处理透明颜色的浏览器，它甚至可以使字体本身透明）。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-27T21:29:30.507

Rockwell 随 Office 2003 及更高版本以及某些 Adob​​e 产品一起安装。这不是我认为的网络安全的，所以一定要有一个后备。[**这是**](http://www.apaddedcell.com/web-fonts)常用字体的列表。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-27T21:27:06.347

罗克韦尔安装[办公室](http://support.microsoft.com/kb/837463)。可能想尝试在没有办公室的计算机上运行东西！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-27T21:29:51.817

你可以告诉你的设计师，比在 Windows 上，Rockwell 默认没有安装。它作为 Office 套件（更具体地说，Publisher）的一部分安装。更多信息在这里：http: [//support.microsoft.com/kb/837463](http://support.microsoft.com/kb/837463)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-27T21:29:36.747

罗克韦尔的可用性不一致，所以我不会依赖它。

但是，如果 Rockwell 使设计工作，那么我建议在字体上使用 sIFR 以使它们出现，而不管用户计算机上的内容是什么。

更多关于 sIFR 的[信息在这里](http://www.divitodesign.com/2008/09/implant-sifr3-healthy-alternative-browser-tex/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-27T21:30:18.180

****如果***您提供合理的回退，*任何*字体都是网络安全的。IE：*

 *```
* { font-family:"Rockwell, Times New Roman, Times, serif";} 
```

当然，这意味着要意识到后备字体和所需字体之间的差异。确保您在没有该字体的地方进行测试。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-27T21:30:51.440

我的 Mac OS 10.5.6 (Leopard) 有迄今为止的所有更新，我的系统上没有这样的字体。我还在虚拟机上全新安装了 Windows XP，那里也没有 Rockwell 的迹象。

我认为你们的设计师只是想避免进一步的工作。在几个月前 Smashing Magazine 刊登“Sketch Rockwell”之前，我从未听说过 Rockwell。

我也会选择 sIFR，特别是如果您使用大于 16 的字体。这不仅是因为没有字体，而且在 Windows 上运行的浏览器也没有抗锯齿字体，这使得它们在大尺寸下看起来很糟糕。你可以[在这里找到一个不错的 sIFR 教程](http://www.wakeuplater.com/website-building/use-your-own-fonts-a-simple-sifr-guide.aspx)。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-07-20T03:35:15.160

直接回答：Rockwell 不是网络安全字体。您可以做的是获取字体（可[在此处](http://ufonts.com/fonts/rockwell.html "uFonts.com 下载站点")免费下载，您可以将其导入样式表，从而使其在您的所有网页上可用。这样，您的访问者无需将其安装在计算机上即可查看它。

# regex - 正则表达式仅匹配奇数或偶数

> ID：691519
> 
> 赞同：32
> 
> 时间：2009-03-27T21:29:32.363
> 
> 标签：regex

我有一个用户可以输入数据库的文本条目列表，我需要使用正则表达式验证这些输入，因为其中一些很复杂。其中一个字段的数字必须有间隙（即 10、12、14、16...）。我的问题是，是否有一个正则表达式结构允许我只匹配偶数或奇数运行？我知道我可以提取这个值并对其进行除法检查，但如果可能的话，我希望有一个纯正则表达式解决方案。

**[编辑]**

我最终使用的解决方案是对 JaredPar 的改编，因为除了只需要奇数或偶数之外，我还需要限制一个范围（即，10-40 之间的所有偶数）。下面是完成的正则表达式。

**^[123][02468]$**

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2009-03-27T21:32:51.840

奇数

```
"^\d*[13579]$" 
```

偶数

```
"^\d*[02468]$" 
```

带有 , 和潜在空格分隔符的奇数运行

```
"$\s*(\d*[13579]\s*,\s*)*\d*[13579]$" 
```

使用 , 和潜在的空白分隔符运行 Evens

```
"$\s*(\d*[02468]\s*,\s*)*\d*[02468]$" 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-27T21:36:14.563

正则表达式实际上并不难设计，如果您考虑到偶数或奇数可以通过仅查看最后一位数字来测试，这也需要是偶数或奇数。所以奇数运行的正则表达式可能是：

```
"^(\s*\d*[13579]\s*,)*(\s*\d*[13579]\s*)$" 
```

将 [13579] 替换为 [02468] 以获得偶数...

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-27T21:34:26.597

你的意思是这样的：

```
/(\d*[02468](, *\d*[02468]))|(\d*[13579](, *\d*[13579]))/ 
```

还是对您的问题的其他三种可能的解释之一？

# flash - 开源 actionscript/flash 音频编辑器

> ID：691531
> 
> 赞同：4
> 
> 时间：2009-03-27T21:31:11.237
> 
> 标签：flash, actionscript, audio, editor

我正在寻找一个基于开源浏览器的音频编辑器，它可以显示波形并让我剪辑音频。有人知道吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-29T00:54:57.510

抱歉，现在这可能有点令人失望，...但请确保您了解这个非常棒的基于 Flash 的编辑器，它将在[Aviary](http://aviary.com/)中提供。

来自digimix的视频：[http ://www.digimix.com/](http://www.digimix.com/)

在这里阅读：http: [//aviary.com/blog/posts/aviary-acquires-digimix](http://aviary.com/blog/posts/aviary-acquires-digimix)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-09-13T20:45:42.903

makeownringtone.com

今天对我来说不是很好，但通常都很好。您需要良好的连接并且音频文件不能太大，但它会显示波形并具有数量惊人的选项和编辑工具。

祝你好运。

# asp.net - ASP.NET web.config 授权设置被忽略

> ID：691533
> 
> 赞同：1
> 
> 时间：2009-03-27T21:31:31.533
> 
> 标签：asp.net, security, iis, authorization

我有一个 asp.net（动态数据）网站设置为另一个网站的子目录中的应用程序。此站点需要与顶级站点不同的安全设置。就像是：

```
 <authorization>
       <allow roles="ADMIN"/>
       <deny users="*"/>
    </authorization> 
```

这些设置在子站点中被忽略。但是，它们在顶级站点上工作，但即使在顶级站点上设置，它们也不会被子站点继承，并且可以自由访问。什么可能导致这些设置被忽略？我试过添加：

```
<location path="." inheritInChildApplications="false"> 
```

到顶级web.config，然后在子站点中设置上述授权规则，甚至尝试拒绝所有用户。访问该站点时，它看起来像：[http://mysite/mybrokensite](http://mysite/mybrokensite)

我正在使用 Windows 身份验证。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T22:48:26.980

我认为关键是这个

> 网站设置为另一个网站的子目录中的应用程序

如果它是 IIS 中的一个单独的应用程序，它应该有它自己的 web.config 文件，并且可以从那里设置安全设置。因此，您将拥有一个用于主站点的 web.config 和一个用于子站点的 web.config。它们实际上是两个应用程序。

如果它只是您网站下的子文件夹，那么这不适用。这取决于您如何在 IIS 下设置它。如果它是一个单独的应用程序，那么该图标将是一个世界/卷心菜类型的图标。如果它是一个子文件夹，它们的图标将是......以及一个文件夹。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-03-23T03:24:57.830

我输入了一个摘要，因为许多人在子文件夹身份验证方面面临同样的情况。

子文件夹授权

*   ASP.NET 只能为一个应用程序提供一种身份验证模式。
*   不同的应用程序不能在它们之间共享资源。

设想

假设主页不应提示登录对话框。它应该让用户在没有任何登录的情况下通过。但是，在同一个应用程序中，可能在不同的文件夹中，另一个页面需要使用用户网络登录 ID 来检查用户对数据库表的权限。默认情况下，IE 将所有只有主机名的网站视为 Intranet。根据其默认的 Intranet 设置，如果使用 Windows 身份验证，它将不会提示登录对话框并将用户登录名和密码传递给应用程序。然而，棘手的是，如果应用程序有一个实际的域，IE 会认为它是一个 Internet 站点，如果使用 Windows 身份验证，它会提示登录名和密码。

* * *

**不使用 Windows 身份验证提示 Internet 站点登录对话框的唯一方法是在 IIS 中也打开匿名身份验证。**但是，您将无法捕获登录信息，因为匿名优先于 Windows 身份验证。好消息是有办法解决这个问题。如果应用程序子文件夹需要捕获登录信息，则需要覆盖 web.config 中 Location 元素中的父授权。

1 在 IIS 中，按如下方式配置身份验证：

1.  启用匿名身份验证，
2.  启用 Windows 身份验证

2 在 Web.Config 中添加以下内容。

```
<authentication mode="Windows" />
  <authorization>
   <allow users="*" />
</authorization>

<!-- secured is the relative subfolder name. deny anonymous user, so only the authenticated login will pass through -->
<location path="secured" allowOverride="true">
  <system.web>
    <authorization>        
        <deny users="?" />
    </authorization>
  </system.web>
</location> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T23:19:41.163

要详细说明蒂姆的答案，请确保在 IIS 中将其设置为虚拟目录。在 IIS 管理、目录（或主目录）选项卡中查看该目录的属性页。如果应用程序标签显示为灰色，请点击创建按钮。现在 IIS 将从该目录加载 web.config。

# c# - 通过 .NET TcpClient 与 HTTP 代理通信

> ID：691550
> 
> 赞同：7
> 
> 时间：2009-03-27T21:35:12.180
> 
> 标签：c#, .net, http-proxy

如何`TcpClient`在 C# 中通过 HTTP 代理进行通信，就像`WebProxy`使用时一样`HttpWebResponse`？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-27T21:45:08.130

好吧，TCP 没有任何直接等同于 HTTP 代理的东西。在 HTTP 中，客户端（通常）知道代理 - 它与代理对话，并*要求*代理代表它连接到真实的 Web 服务器。

TCP 没有定义那种东西，所以任何代理都必须是透明的（即路由器或操作系统在客户端不知道的情况下执行的操作，例如使用[iptables](http://en.wikipedia.org/wiki/Iptables)）或作为 TCP 之上协议的一部分（ HTTP 代理就是一个很好的例子，正如另一个答案中提到的[SOCKS一样）。](http://en.wikipedia.org/wiki/SOCKS)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-27T21:45:08.880

如果您深入到低级套接字编程，我很确定您需要编写自己的代理客户端。如果您只处理 HTTP 协议，则最好使用 HTTP 特定的类。如果您需要使用套接字来实现，[HTTP 规范](https://www.rfc-editor.org/rfc/rfc2616)很好地描述了代理的行为，因此您可以编写自己的客户端。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T21:47:11.743

如果您想使用 SOCKS 代理，已经有一些为 C# 编写的 SOCKS 库。试试[这个](http://www.codeproject.com/KB/IP/zasocks5proxy.aspx)。

# delphi - 需要帮助与 JCL 的 TEvaluator 进行有趣的通话

> ID：691553
> 
> 赞同：3
> 
> 时间：2009-03-27T21:35:42.723
> 
> 标签：delphi, jedi-code-library

我正在使用 JCL 的表达式评估器 TEvaluator（由 barry kelly 捐赠的奇妙创作）。（谢谢你巴里！）

**背景**

我使用了 AddFunc 方法。

```
function MyFunc:double;
begin
  // calculations here
  Result:=1;  
end; 
```

您可以使用 AddFunc 方法使函数可用：

```
 AddFunc('MyFunc', MyFunc); 
```

**这就是问题...**

我需要在一个对象上调用一个方法，而不是一个独立的例程。

原因是我有一个提供值的对象列表。

假设我们有一个车辆对象列表。每个对象都有一个权重函数。我希望能够在公式中使用每个对象的重量。

一个愚蠢的例子，但很容易解释：

```
type
  TVehicle=class
  private
  public
    function Weight:double;
  end;

function StrangeCalculation:double;
var
  vehicle:TVehicle;
begin
  for iVehicle = 0 to Count - 1 do
    begin
      vehicle:=GetVehicle(iVehicle);
      // E2250 There is no overloaded version of 'AddFunc' that can be called with these arguments
      eval.AddFunc(vehicle.Name, vehicle.Weight);
    end;

  Result:=eval.Evaluate('JeepTJWeight + FordF150Weight * 2');
end; 
```

**我的选择：**

1.  AddVar() 或 AddConst()——但这不是很好，因为如果值不可用，我需要能够引发异常。

2.  带有独立函数的 AddFunc( )。不能这样做，因为变量的名称（和数量）在运行之前是未知的。

3.  如果未找到变量，请修改对象以添加回调。我实际上已经这样做了，但需要编辑源的副本以回调以使其执行此操作。

4.  制作一个能够使用方法函数的 AddFunc()。

选项 #3 实际上已构建，但额外的 AddFunc 会更好。问题是我不知道要提供什么方法​​原型。我认为 TMethod 会是这样，但我的知识在这里太有限了......这是我不成功的尝试，但我仍然在 eval.AddFunc 处得到“E2250 没有可以用这些参数调用的 'AddFunc' 的重载版本” () 像以前一样调用。

```
TFloat64MethodFunc = function(c:pointer): TFloat64;

procedure TEasyEvaluator.AddFunc(const AName: string; AFunc: TFloat64MethodFunc);
begin
  FOwnContext.Add(TExprFloat64MethodFuncSym.Create(AName, AFunc));
end;

TExprFloat64MethodFuncSym = class(TExprAbstractFuncSym)
private
  FFunc: TFloat64MethodFunc;
public
  constructor Create(const AIdent: string; AFunc: TFloat64MethodFunc);
  function Evaluate: TFloat; override;
// not using   function Compile: TExprNode; override;
end; 
```

感谢您的帮助！

mp

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T22:00:16.567

弄清楚了...

TFloat64MethodFunc = 函数：对象的 TFloat；

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-03-10T16:46:24.800

很久以前（2004 年），我遇到过这个问题。然后我的解决方案是使用 Turbo Power SysTools 评估器，它接受方法。

# asp.net - 在无状态的 asp.net 应用程序中，静态类的生命周期如何受到影响？

> ID：691560
> 
> 赞同：1
> 
> 时间：2009-03-27T21:38:34.697
> 
> 标签：asp.net, class, static, shared, lifetime

我已经定义了一个帮助类来跟踪一个小的项目字典。它将这些信息存储为静态属性，该属性在静态构造函数中初始化。该列表非常小，永远不会改变，所以我选择了这种方法而不是 xml 或 db 查找表......

但是我想知道的是，如果 asp.net 应该是无状态的，这个静态属性是否会在页面之间甚至在页面内保留其值？

例如，我将此列表绑定到我页面上的两个不同的下拉列表

```
DropDownList1.DataSource = Helper.MyList;
DropDownList2.DataSource = Helper.MyList; 
```

由于静态类 Helper 被调用了两次，它的构造函数是否也被调用了两次，或者它是否在整个页面生命周期中保持在范围内？

如果我导航到下一页并需要再次绑定，它仍然会被初始化还是会重新开始？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T21:41:41.523

不，这不会初始化类型两次。`Helper`仅当您下次获得新的类时才需要重新初始化该类`AppDomain`- 因为应用程序已刷新/重新启动或由于[`AppDomain`回收](http://weblogs.asp.net/owscott/archive/2006/02/21/ASP.NET-v2.0-_2D00_-AppDomain-recycles_2C00_-more-common-than-before.aspx#440333)。

# sql - SELECT DISTINCT 是否暗示某种结果

> ID：691562
> 
> 赞同：8
> 
> 时间：2009-03-27T21:39:29.890
> 
> 标签：sql, oracle, sqlplus

在 SELECT 查询中包含 DISTINCT 是否意味着应该对结果集进行排序？

我认为没有，但我正在寻找一个权威的答案（网络链接）。

我有这样的查询：

```
Select Distinct foo
From Bar 
```

在 oracle 中，结果是不同的，但不是按排序顺序排列的。在 Jet/MS-Access 中，似乎需要做一些额外的工作来确保对结果进行排序。我假设 oracle 在这种情况下遵循规范，而 MS Access 正在超越。

另外，有没有办法可以给表格一个提示它应该排序`foo`（除非另有说明）？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-27T22:41:20.227

从[SQL92 规范](http://www.contrib.andrew.cmu.edu/~shadow/sql/sql1992.txt)：

> 如果指定了 DISTINCT，则令 TXA 为从 TX 中消除冗余重复值的结果。否则，令 TXA 为 TX。

...

> 4) 如果未指定 an，则 Q 的行的顺序取决于实现。

最终真正的答案是 DISTINCT 和 ORDER BY 是 SQL 语句的两个独立部分；如果您没有 ORDER BY 子句，则不会按定义对结果进行专门排序。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-28T03:10:08.520

不会。在许多情况下，Oracle 中的 DISTINCT 并不意味着排序，其中最重要的是 10g+ 中用于 group by 和 distinct 操作的散列算法。

**如果您想要一个有序的结果集，请始终**指定 ORDER BY，即使在 9i 及以下版本中也是如此。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-27T21:52:28.627

没有“权威”的答案链接，因为这是没有 SQL 服务器保证的。

当使用 distinct 作为查找这些结果的最佳方法的副作用时，您通常会按顺序看到结果。但是，任何数量的其他事情都可能混淆结果，并且某些服务器可能会以不给它们排序的方式交回结果，即使它必须排序才能获得结果。

底线：如果你的服务器不能保证你不应该指望它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T21:44:15.450

不，这并不意味着排序。根据我的经验，它按已知索引排序，可能恰好是 foo。

为什么要微妙？为什么不从 foo 的 Bar Order 中具体选择 Distinct foo？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-27T21:44:43.233

据我所知，没有。我能想到的唯一原因是 SQL Server 会在内部对数据进行排序以检测和过滤掉重复项，从而以“预先排序”的方式返回它。但我不会依赖那个“副作用”:-)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-27T21:44:51.313

在我使用过的至少一台服务器上（大约六年前，可能是 Oracle 或 SQL Server），如果您没有 ORDER BY 子句，则 SELECT DISTINCT 会被拒绝。它在“其他”服务器（Oracle 或 SQL Server）上被接受。你的旅费可能会改变。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-27T21:50:17.120

不，结果未排序。如果你想给它一个“提示”，你当然可以提供一个 ORDER BY：

从 bar order by foo 中选择不同的 foo

但请记住，您可能想要的不仅仅是按字母顺序排序。相反，您可能希望根据其他字段的标准进行排序。看：

[http://weblogs.sqlteam.com/jeffs/archive/2007/12/13/select-distinct-order-by-error.aspx](http://weblogs.sqlteam.com/jeffs/archive/2007/12/13/select-distinct-order-by-error.aspx)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-29T05:16:30.457

正如大多数答案所说，DISTINCT 不强制要求排序 - 只有 ORDER BY 强制要求。但是，获得 DISTINCT 结果的一种标准方法是排序；另一种是散列值（这往往会导致半随机排序）。依靠 DISTINCT 的排序效果是愚蠢的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-04-26T19:59:09.023

在我的情况下（SQL 服务器），作为一个例子，我有一个国家列表，每个国家都分配了一个数值 X。当我按 X 执行 select distinct * from Table order 时，它按 X 排序，但同时结果集国家也被排序，这不是直接实现的。根据我的经验，我会说 distinct 确实意味着隐式排序。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-03-27T23:55:41.017

是的。Oracle确实使用排序来计算不同的。如果你看一下解释计划，你就会看到。它对该计算进行排序这一事实绝不意味着结果集将被排序。如果要对结果集进行排序，则需要使用 ORDER BY 子句。

# c# - 无法让 SAFEARRAY 与 Interop 一起工作

> ID：691572
> 
> 赞同：1
> 
> 时间：2009-03-27T21:42:55.217
> 
> 标签：c#, c++, interop, atl

我有一个 ATL COM 服务器，接口的方法是

```
STDMETHODIMP CWrapper::RUN(long iDataSize, SAFEARRAY** iData) 
```

这个函数的 MIDL 看起来像

```
[id(1), helpstring("method RUN")] HRESULT RUN([in] long nSize, [in, size_is(nSize)] SAFEARRAY(_MyDataType*)* iData); 
```

我使用 tlbimp 从这个项目中导入 tlb，所以我可以使用本机数组。然后我从 C# 调用它如下

```
 m_ServerWrapper.RUN(iInputs.Length,ref iInputs) 
```

其中 Inputs 已经分配并填充了我的 C# 程序内部的另一个 COM 对象。现在，当我调用 C++ 包装器时，我有一个`BadPtr`用于我的 safearray 并且从后续 COM 对象调用`CWrapper::RUN`失败，该数组没有进入最终的 dll。它显示为未分配。有谁知道我做错了什么？谢谢

编辑：我应该说该数组在 C# 中看起来很好。

EDIT2：调试器`iData`显示`IDispatch* = 0x0000000 <Bad Ptr>, 5, 0x0000000 <Bad Ptr>({lpvtbl = 0xblahblah},...`. 所以看起来我的一些信息正在到达那里。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-27T22:08:54.190

普通的 C# 数组与 SAFEARRAY 不同。我认为您必须自己制作：

```
[StructLayout(LayoutKind.Sequential)]
struct SafeArray
{
    public ushort   dimensions;  
    public ushort   features;    
    public uint     elementSize; 
    public uint     locks;       
    public IntPtr   dataPtr;     
    public uint     elementCount;
    public int      lowerBound;  
} 
```

然后使用 Marshal.AllocCoTaskMem() 创建内存。填写所有数据，然后传递。

# php - 其他框架，如 PEAR

> ID：691574
> 
> 赞同：0
> 
> 时间：2009-03-27T21:43:52.453
> 
> 标签：php, frameworks, components, pear

你知道其他框架，如 PEAR ( [http://pear.php.net](http://pear.php.net) ) 吗？我想在不使用著名的 PEAR 的情况下使用可重用的 PHP 组件。我已经使用了一个框架（Zend 框架），我想使用 ZF 中不存在的 php 组件，例如支付、加密、数学......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T22:39:58.247

查看[EZ 组件](http://ez.no/ezcomponents)。它是一组非常松散耦合的库，我总是认为它们介于 PEAR 和 Zend Framework 之间。精湛的编码和最新的，值得仔细看看。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T21:59:01.857

我并没有真正做那么多 php，但我与 php 开发人员一起工作了一段时间，而且我一直听到 PEAR、[SMARTY](http://www.smarty.net/)和[Zend Framework](http://framework.zend.com/)之间的比较。我真的不能告诉你他们有多相似，但这些是我听过最多的。我还听到有人说他们使用[Cake PHP](http://cakephp.org/)或[Symfony](http://www.symfony-project.org/)，但没有那么多。

我还发现了两个很好的比较，可能会有所帮助，[这里](http://www.phpit.net/demo/framework%20comparison/chart.php)和[这里](http://www.thecredence.com/php-frameworks-which-one-is-most-suitable-for-you/)。这就是我所能提供的所有帮助。祝你好运。:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T22:57:15.367

作为 Zend Framework 的粉丝，我不明白为什么不根据自己的需要扩展 Zend Framework。我使用了一种相当简单的方法，在我的*应用程序文件夹中有一个**classes*文件夹，您需要在 bootstrap 中设置或使用 Zend_Loader 加载，您可以在那里定义自己的逻辑或导入您感兴趣的不同模块（[phpClasses](http://www.phpclasses.org)可能也非常有帮助）。

 *您还可以找到很多由 Zend Framework 社区制作的助手，它们可能在任何给定时间都有帮助。如果你想从不同的源中剥离代码片段，你可能还想尝试将一些模块从其他框架（如 Code Igniter 或 CakePhp）导入 Zend 框架，这对你来说可能是一件有趣且有用的事情，并且如果您想分享，也许是针对所有以 ZF 为基础的社区

我应该警告你 Symfony（邪恶企鹅写的），如果你愿意尝试它，别忘了它是所有这些中“最懒惰的”。

# .net - MembershipCreateStatus.InvalidEmail 使用有效的电子邮件地址到达

> ID：691576
> 
> 赞同：0
> 
> 时间：2009-03-27T21:44:12.673
> 
> 标签：.net, validation, email, membership-provider

使用 .NET Membership Provider 并尝试重新创建已被其他开发人员使用的添加用户页面（实际开发人员已离开我的公司）。但是，虽然大多数事情都有效，例如编辑用户，但我无法添加新用户，因为此向导将所有电子邮件标记为无效。我不知道如何更新提供商的配置以停止将有效电子邮件标记为无效。电子邮件通过“Internet 电子邮件”的 .NET 正则表达式验证。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-03T11:44:08.180

似乎实际的开发人员为 CreateUserWizard 控件的[EmailRegularExpression属性设置了错误的值。](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.createuserwizard.emailregularexpression.aspx)

# iphone - 邮件应用程序向上/向下箭头

> ID：691587
> 
> 赞同：1
> 
> 时间：2009-03-27T21:46:21.263
> 
> 标签：iphone, cocoa-touch

有没有办法访问邮件应用程序中使用的向上/向下箭头并以相同的方式实现它们？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-28T00:11:23.207

不，没有支持的方式来做到这一点。我建议您在 Radar 上提交一个错误，要求 Apple 包含更多内置艺术品。与此同时，你只需要自己画。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-05-04T22:46:14.697

你能澄清你的问题吗？

向上/向下的图形不容易访问，尽管您可能会找到一种方法来获取它们。例如，请参阅[http://0xced.blogspot.com/2009/04/extract-uikit-artwork.html](http://0xced.blogspot.com/2009/04/extract-uikit-artwork.html)。

但是，如果您正在寻找行为，那真的很简单。箭在瞬间`UISegmentedControl`。附加到`valueChanged:`以告知用户何时点击其中一个，并用于`selectedSegmentIndex`告知他们点击了哪一个。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-11-19T23:31:14.997

现在它们是 IOS 4.1 示例代码的一部分。检查 NavBar 示例。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-11-13T08:37:05.357

正如 Steven Fisher 所说，您无法轻松访问 Apple 图形。但它们相对容易重新制作。

`UISegmentedControl`鉴于图像在 iOS 7 中无法正常工作，我遇到了一些麻烦。然而，这段代码成功了（添加到`viewDidLoad`ViewController 中）。

```
UIButton *upButton = [UIButton buttonWithType:UIButtonTypeCustom];
[upButton setImage:[upImage imageWithRenderingMode:UIImageRenderingModeAlwaysTemplate]
          forState:UIControlStateNormal];
upButton.contentEdgeInsets = UIEdgeInsetsMake(0, 0, 0, 6);
[upButton sizeToFit];

UIButton *downButton = [UIButton buttonWithType:UIButtonTypeCustom];
[downButton setImage:[downImage imageWithRenderingMode:UIImageRenderingModeAlwaysTemplate]
            forState:UIControlStateNormal];
downButton.contentEdgeInsets = UIEdgeInsetsMake(0, 6, 0, 0);
[downButton sizeToFit];

UIBarButtonItem *upButtonItem = [[UIBarButtonItem alloc] initWithCustomView:upButton];
UIBarButtonItem *downButtonItem = [[UIBarButtonItem alloc] initWithCustomView:downButton];

[upButton addTarget:self action:@selector(YOUR_UP_SELECTOR:) forControlEvents:UIControlEventTouchUpInside];
[downButton addTarget:self action:@selector(YOUR_DOWN_SELECTOR:) forControlEvents:UIControlEventTouchUpInside];

self.navigationItem.rightBarButtonItems = @[downButtonItem, upButtonItem]; 
```

# sql - 查询不会与变量一起运行，将在粘贴变量的定义时工作

> ID：691590
> 
> 赞同：1
> 
> 时间：2009-03-27T21:47:41.557
> 
> 标签：sql, string, ms-access, vba

这是 VBA (Access 2007) 中的一个查询，我定义了 3 个字符串：

```
str_a = "db.col1 = 5"
str_b = " and db.col2 = 123"
str_c = " and db.col3 = 42" 
```

然后我在查询的 WHERE 部分使用这些：

```
"WHERE '" & str_a & "' '" & str_b & "' '" & str_c & "' ;" 
```

这失败了，但如果我粘贴这样的字符串：

```
"WHERE db.col1 = 5 and db.col2 = 123 and db.col3 = 42;" 
```

它完美地工作。我猜在字符串中使用多个变量时语法是错误的。
有人有任何提示吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T21:51:22.187

你在那里有一些额外的单引号。

试试这个：

```
"WHERE " & str_a & str_b  & str_c 
```

注意：通常，您不应该通过连接字符串来构建查询字符串，因为这会使您容易受到 SQL 注入的攻击，并且会错误处理特殊字符。更好的解决方案是使用准备好的语句。但是假设您在一个非常受控的环境中操作，我给出的解决方案应该可以工作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-28T01:06:55.353

```
"WHERE '" & str_a & "' '" & str_b & "' '" & str_c & "' ;" 
```

将在您完成的 WHERE 子句中包含单引号。您向我们展示的工作版本没有：

```
"WHERE db.col1 = 5 and db.col2 = 123 and db.col3 = 42;" 
```

因此，尝试构造`WHERE`不带单引号的子句：

```
"WHERE " & str_a & " " & str_b & " " & str_c & ";" 
```

出于调试目的，在 VBA 完成构建后查看最终字符串很有用。如果要将字符串存储在名为 的变量中`strSQL`，则可以使用：

```
Debug.Print strSQL 
```

在 VB 编辑器的即时窗口中显示完成的字符串。`CTRL`（您可以使用+`g`键盘快捷键进入即时窗口。）

或者，您可以在消息框窗口中显示完成的字符串：

```
MsgBox strSQL 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-27T21:56:26.950

关于对动态构建的 SQL 进行故障排除的快速提示： **[回](http://msdn.microsoft.com/en-us/library/h8f603s7(VS.85).aspx)显由所有连接和插值产生的 SQL 字符串**，而不是盯着你的代码。

```
WHERE 'db.col1 = 5' ' and db.col2 = 123' ' and db.col3 = 42'; 
```

十分之九，问题变得更加清晰。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-28T16:40:49.710

对于 VB6/VBA 动态 SQL，我总是觉得创建一个 SQL 模板更具可读性，然后使用 Replace() 函数添加动态部分。试试这个：

```
Dim sql As String
Dim condition1 As String
Dim condition2 As String
Dim condition3 As String

sql = "SELECT db.col1, db.col2, db.col3 FROM db WHERE <condition1> AND <condition2> AND <condition3>;"

condition1 = "db.col1 = 5"
condition2 = "db.col2 = 123"
condition3 = "db.col3 = 'ABCXYZ'"

sql = Replace(sql, "<condition1>", condition1)
sql = Replace(sql, "<condition2>", condition2)
sql = Replace(sql, "<condition3>", condition3) 
```

但是，在这种情况下，WHERE 子句中的值会发生变化，而不是字段本身，因此您可以将其重写为：

```
Dim sql As String

sql = "SELECT col1, col2, col3 FROM db "
sql = sql & "WHERE col1 = <condition1> AND col2 = <condition2> AND col3 = '<condition3>';"

sql = Replace(sql, "<condition1>", txtCol1.Text)
sql = Replace(sql, "<condition2>", txtCol2.Text)
sql = Replace(sql, "<condition3>", txtCol3.Text) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-28T05:09:58.717

关于在 VBA 中构造 WHERE 子句的一些评论。

根据定义，您的示例将是不正确的，因为您将单引号放在不需要的地方。这：

```
str_a = "db.col1 = 5"
str_b = " and db.col2 = 123"
str_c = " and db.col3 = 42"
"WHERE '" & str_a & "' '" & str_b & "' '" & str_c & "' ;" 
```

...将产生这个结果：

```
WHERE 'db.col1 = 5' ' and db.col2 = 123' ' and db.col3 = 42' ; 
```

这显然行不通。

去掉单引号，它应该可以工作。

现在，这就是说，我永远不会那样做。我永远不会将 AND 放在用于构造 WHERE 子句的子字符串中，因为如果我有第二个字符串的值但没有第一个字符串的值，我该怎么办？

当您必须使用分隔符连接多个字符串并且可以取消分配一些字符串时，要做的一件事就是将它们全部连接起来，而不用担心连接之前的字符串是否未分配：

```
str_a = "db.col1 = 5"
str_b = "db.col2 = 123"
str_c = "db.col3 = 42" 
```

要连接它，你会这样做：

```
If Len(str_a) > 0 Then
   strWhere = strWhere & " AND " str_a
End If
If Len(str_b) > 0 Then
   strWhere = strWhere & " AND " str_b
End If
If Len(str_c) > 0 Then
   strWhere = strWhere & " AND " str_c
End If 
```

当所有三个字符串都被分配时，这会给你：

```
" AND db.col1 = 5 AND db.col2 = 123 AND db.col3 = 42" 
```

只需使用 Mid() 删除前 5 个字符，无论哪个变量分配了值，它都会始终正确：

```
strWhere = Mid(strWhere, 6) 
```

如果它们都没有被分配，你会得到一个长度为零的字符串，这就是你想要的。如果分配了其中任何一个，您将首先得到“AND ...”，这是一个错误的前导运算符，您只需使用 Mid() 命令将其删除。这是有效的，因为您知道 Mid() 之前的所有结果都将以“ AND ”开头，无论如何 - 无需对 strWhere 是否已经分配了值进行不必要的测试 - 只需将 AND 粘贴在那里并切碎它最后关闭。

另一方面，有人提到了 SQL 注入。关于 Access，有一个冗长的讨论，其中考虑了许多与此线程相关的问题：

[非 Web SQL 注入](https://stackoverflow.com/questions/512174/non-web-sql-injection)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-28T17:05:35.297

我有我最喜欢的“addANDclause”函数，具有以下参数：

```
public addANDclause( _ 
    m_originalQuery as string, _
    m_newClause as string) _
as string 
```

*   如果 m_originalQuery 不包含 WHERE 关键字，则 addANDClause() 将返回添加了“ WHERE ”的原始查询。
*   如果 m_orginalQuery 已经包含 WHERE 关键字，那么 addANDClause() 将返回添加了“ AND ”的原始查询。

所以我可以添加尽可能多的“AND”子句。使用您的示例，我将编写以下内容来动态创建我的 SQL 查询：

```
m_SQLquery = "SELECT db.* FROM db"
m_SQLquery = addANDClause(m_SQLQuery, "db.col1 = 5")
m_SQLQuery = addANDClause(m_SQLQuery, "db.col2 = 123")
m_SQLQuery = addANDClause(m_SQLQuery, "db.col3 = 42") 
```

当然，代替这些固定值，这样的函数可以获取绑定或未绑定表单控件中可用的值，以动态构建记录集过滤器。也可以发送参数，例如：

```
m_SQLQuery = addANDClause(m_SQLQuery, "db.text1 like 'abc*'") 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-01T08:43:42.227

虽然动态 SQL 对引擎来说可能更高效，但这里的一些评论似乎支持我的观点，即动态 SQL 可能会让人类读者感到困惑，尤其是当他们没有编写代码时（想想将继承你的代码）。

我更喜欢 a 中的静态 SQL，`PROCEDURE`并通过选择适当的值在运行时动态调用 proc；如果您使用 SQL DDL（下面的示例）来定义 proc，您可以为参数指定`DEFAULT`值（例如`NULL`），以便调用者可以简单地省略不需要的参数，例如查看您是否可以遵循此 proc 中的逻辑：

```
CREATE PROCEDURE MyProc
(
   arg_col1 INTEGER = NULL, 
   arg_col2 INTEGER = NULL, 
   arg_col3 INTEGER = NULL
)
AS 
SELECT col1, col2, col3
  FROM db 
 WHERE col1 = IIF(arg_col1 IS NULL, col1, arg_col1) 
       AND col2 = IIF(arg_col2 IS NULL, col2, arg_col2) 
       AND col3 = IIF(arg_col3 IS NULL, col3, arg_col3); 
```

当然，它可能不会产生最好的执行计划，但 IMO 你必须平衡优化与良好的设计原则（它在我的机器上运行得非常快:)

# regex - 寻找不同正则表达式的比较表

> ID：691593
> 
> 赞同：1
> 
> 时间：2009-03-27T21:49:36.857
> 
> 标签：regex, comparison

我使用 vim、sed、bash 和 Perl。每个都有一些不同的正则表达式语法。我只是花时间发现我需要在 sed 中转义花括号，而不是在 BASH 中（当使用它们作为计数器元素时）。嗯。

任何人都可以给我指出一张表格，该表格总结了这 4 种环境中不同正则表达式解析器之间的差异。

TIA

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-27T22:00:54.490

[http://www.regular-expressions.info/refflavors.html](http://www.regular-expressions.info/refflavors.html) - 向下滚动一点。

Bash 使用 posix 正则表达式。Sed 和 vim（使用 ed）使用被列为“GNU BRE”的内容，尽管这取决于您传递的标志。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T21:59:18.627

Jan Goyvaerts. 的网站[regular-expressions.info](http://www.regular-expressions.info/tools.html)列出了流行的正则表达式引擎及其支持的选项。

# email - POP3 协议是否允许您指定要下载的电子邮件子集？

> ID：691613
> 
> 赞同：1
> 
> 时间：2009-03-27T21:56:07.340
> 
> 标签：email, pop3

我正在编写一个 POP3 邮件客户端。我想将消息留在服务器上，但我不想每次重新连接时都必须重新下载所有消息。

如果我今天下载所有消息，明天重新连接，该协议是否支持仅下载过去 24 小时内的消息或某个顺序 ID 的消息？还是我必须重新下载所有消息？

我知道唯一标识列表功能，但根据[http://www.faqs.org/rfcs/rfc1939.html](http://www.faqs.org/rfcs/rfc1939.html)，原始规范不支持它。大多数邮件服务器是否支持此功能？

是的，我的客户端也支持 IMAP，但这个问题是专门针对 POP 服务器的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T22:02:01.133

您是否考虑过使用 IMAP？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-28T04:12:27.387

我已经做到了。

您必须重新阅读所有标题，但您可以决定要下载哪些邮件。

但是，我不记得标题中的任何内容会给您一个万无一失的时间戳。如果不记录您已经看到的内容，我认为您的解决方案是不可能的。

（就我而言，我不在乎——我只是在标题中寻找具有某些识别特征的消息——这些消息被下载、处理和杀死，其他一切都没有受到影响。）

我也想知道你是否误解了协议。仅仅因为您下载了一条消息并不意味着它已从服务器中删除。如果您给出明确的命令来终止消息，它只会从服务器中删除。（当一条消息包含如此多的附件以致在您正确注销之前系统超时并因此您的 kill 命令被丢弃时，您将被逼上墙！）（这是设计中的疏忽。原始逻辑是附加一个超过 100k 的文件，或尽可能多的文件，其总数低于 100k。另一个任务发出并生成数千个文件，每个文件大约 100 字节。虽然它是一个完全合法的文件，尽管极端，但电子邮件却无法杀死它！）

因此，如果我正在编写一个邮件客户端，我会简单地下载我在本地没有的任何东西。如果它应该保留在服务器上，很好，只是不要发出 kill 命令。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T22:00:29.420

我所看到的过去处理的方式是逐个客户的。例如，如果我使用 Scribe 在一台机器上获取电子邮件而不删除，然后移动到另一台机器，尽管我以前见过它们，但所有电子邮件都会再次下载。在内部，我想客户端有一个表来存储以前是否下载过电子邮件。

我知道协议中没有任何内容允许这样做。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-28T03:46:28.557

有点。您可以下载单个消息，但不能将状态存储在远程服务器上。

[请参阅http://www.faqs.org/rfcs/rfc1939.html](http://www.faqs.org/rfcs/rfc1939.html)上的 RETR 命令。

# java - 在不使封闭类通用的情况下缩小 Java 字段类型？

> ID：691616
> 
> 赞同：1
> 
> 时间：2009-03-27T21:57:08.990
> 
> 标签：java, generics

是否可以在不使包含类本身通用的情况下缩小 Java 类中字段的类型？

通用示例将是这样的：

```
abstract class MyClass {
    //...
}

interface MyInterface {
    //...
}

class MyConcreteClass<T extends MyClass & MyInterface> {
    private T value;
} 
```

有没有办法做到以下几点：

```
class MyConcreteClass {
    private MyClass & MyInterface value;
} 
```

这本质上等同于 MyConcreteClass 或原始的 MyConcreteClass 类型。在我的实现中，类型参数将随着对象的生命周期而变化（被诅咒的可变性！它是 JPA 强加给我的！），因此类型注释似乎有些多余。

*   编辑 -

我忘了提到一个额外的限制。我们也会有这个：

```
class SubA extends MyClass
class SubB extends MyClass
class SubC extends MyClass

class SubSubA extends SubA implements MyInterface
class SubSubB extends SubB implements MyInterface
class SubSubC extends SubC implements MyInterface 
```

因此，简单地声明一个实现 MyInterface 的 MyClass 的抽象子类不是一个合适的解决方案。

此外，最终的字段类型必须是具体类型，而不是简单地表示交集的接口，原因很简单，JPA 持久化的实体不能被它们的接口类型引用。也就是说，JPA 实体类中的持久字段必须是原始类型或具体实体类型。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T22:14:10.120

我从来没有遇到过这样的问题（因此没有想到优雅的解决方案:-)......但是......

```
interface Fooable 
{
}

abstract class MyClass 
    implements Fooable 
{
}

interface MyInterface 
    extends Fooable 
{
}

class MyConcreteClass 
{
    private Fooable value;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-28T06:54:34.143

在这种复杂的情况下，您应该将类​​隐藏在接口后面。

然后可以为交集定义一个显式接口，即扩展MyClass和MyInterface对应的接口的接口，并让相应的超类实现它而不是MyInterface。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T22:20:00.370

我不认为有办法做到这一点。反正也不完全一样。但是，由于这是一个私有字段并且您可以完全控制它，您可以将其声明为

```
 private MyClass value; 
```

但还要确保在您的所有代码中，只有实现 MyInterface 的对象才会受到影响，并在您需要作为接口访问它的任何地方进行转换。是的，它看起来很脏，而且（有点）。

您还可以创建以下派生类

```
abstract class MyDerivedClass extends MyClass implements MyInterface {
    //...
} 
```

然后使用

```
 private MyDerivedClass value; 
```

这更清洁，但你必须创建一个其他类，只是为了这个目的......

# c# - 如何在 asp.net 中运行自动“作业”？

> ID：691619
> 
> 赞同：3
> 
> 时间：2009-03-27T21:58:39.923
> 
> 标签：c#, asp.net

我想让我的网站每 10 分钟进行一次计算，然后用结果更新数据库。我该如何设置这样的计时器，我假设它会在 global.asax 中？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-27T22:04:40.860

您最好编写一个单独的非 UI 应用程序，然后将其作为计划任务运行。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-27T22:32:46.987

在 Web 应用程序中做类似的事情介于困难和不稳定到不可能之间。Web 应用程序根本不意味着不间断地运行，只是为了响应请求。

你真的需要每十分钟计算一次吗？我发现在大多数情况下，当有人问这样的问题时，他们确实只需要间隔运行的东西的出现，但只要没有人访问页面查看结果，结果并不需要进行计算。

如果您的情况也是如此，那么您只需要跟踪上次计算的时间，并为每个请求检查是否有足够的时间重新计算。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-27T22:41:20.913

除了关于计划任务执行的 Web 应用程序不稳定性的（正确）陈述之外，您还可以实施以下策略：

在 global.asax 中，定义 application.onstart 事件，其中创建计时器：

```
var dueTime = 5000;
var period = 5000;
var MyTimer = new Timer(new TimerCallback(MyClass.MyTaskProc), null, dueTime, period);
Application["MyTaskTimer"] = MyTimer; 
```

这将非常负责创建任务并在应用程序退出时重新启动它

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-27T22:05:57.783

如果其严格的数据库计算，请将其保存在数据库中。创建一个执行所需操作的存储过程，然后让 SQL Server 代理按计划运行该过程。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-27T22:05:26.710

cagdas 答案中的缓存解决方案有效。我用过。唯一的缺点是，如果您出于某种原因需要暂停计时器，则很难将其关闭。我们使用过的替代方案，但并不完全相同。

1.  SQL Server 中的计划任务
2.  计划的窗口任务。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-27T22:25:34.507

我真的不喜欢安排好的任务。我宁愿把这个函数放在一个windows服务中，然后在里面扔一个计时器。使用窗口服务，您可以很好地处理停止事件。我同意其他所有人的观点，该网站不是这个地方。

# sql-server - 从 SQL Server 报表服务器导出非 Unicode CSV

> ID：691620
> 
> 赞同：4
> 
> 时间：2009-03-27T21:58:53.590
> 
> 标签：sql-server, reporting-services, csv, report

我正在使用 Microsoft SQL Server 2005 中的 SQL Server Report Server。

在报表服务器报表查看器控件中，有一个 CSV 下载选项。CSV 下载选项当前正在下载 Unicode CSV 文件，该文件无法以正确的列格式加载到 Microsoft Excel。

如果我保存 Unicode CSV 文件并将其转换为 ASCII 文件，它在 Excel 中可以正常工作。

如何设置报告或 SSRS 报告查看器以将 CSV 导出为 ASCII 而不是 Unicode？

提前感谢您对此的任何帮助。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-09T15:18:58.747

转到**RSReportserver.config**文件（应位于您的报告服务器虚拟目录的根目录中，例如“ **C:\Program Files\Microsoft SQL Server\MSSQL.3\Reporting Services\ReportServer** ”）

找到 CSV 扩展 - 应该如下所示。将 Encoding 节点更改为读取**ASCII**而不是**Unicode**或其中的任何内容。

```
 <Extension Name="CSV" Type="Microsoft.ReportingServices.Rendering.CsvRenderer.CsvReport,Microsoft.ReportingServices.CsvRendering">
            <Configuration>
                <DeviceInfo>
                    <Encoding>Unicode</Encoding>
                </DeviceInfo>
            </Configuration>
        </Extension> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-11-10T19:07:47.917

更多信息，请访问[http://msdn.microsoft.com/en-us/library/ms156281.aspx](http://msdn.microsoft.com/en-us/library/ms156281.aspx)。您可以创建多个扩展，即除了默认的“CSV”之外，您还可以添加“CSV - ASCII”或“CSV - Pipe”等。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-11-19T00:47:21.680

为了完整起见，这里是添加“CSV-ANSI”导出选项的方法。您需要添加“OverrideNames”标签，以免出现重复的“CSV”选项。由于我在澳大利亚，我需要添加一个“en-AU”语言选项，如果您不需要它可以将其删除（或替换为您自己的语言）。

```
<Extension Name="CSV-UTF8" Type="Microsoft.ReportingServices.Rendering.DataRenderer.CsvReport,Microsoft.ReportingServices.DataRendering">
    <OverrideNames>
        <Name Language="en-US">CSV (UTF8)</Name>
        <Name Language="en-AU">CSV (UTF8)</Name>
    </OverrideNames>                
</Extension>

<Extension Name="CSV-ANSI" Type="Microsoft.ReportingServices.Rendering.DataRenderer.CsvReport,Microsoft.ReportingServices.DataRendering">
    <OverrideNames>
        <Name Language="en-US">CSV (ANSI)</Name>
        <Name Language="en-AU">CSV (ANSI)</Name>
    </OverrideNames>                
    <Configuration>     
        <DeviceInfo>
            <Encoding>ASCII</Encoding>
        </DeviceInfo>
    </Configuration>
</Extension> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-10T09:08:55.563

在保存按钮中有一个小的下拉菜单，上面写着“使用编码保存”，您可以在其中将编码类型指定为 ansi ~Ram

# c# - WPF 中的动态字符串本地化

> ID：691632
> 
> 赞同：2
> 
> 时间：2009-03-27T22:02:15.530
> 
> 标签：c#, wpf, string, localization

我有一个 C#/WPF 应用程序，我正在尝试添加多语言支持。从我环顾四周，我发现为每种语言使用字符串值的资源文件是我应该如何去做的。然后更新 CultureInfo。如果在创建窗口时或之前设置文化信息，这似乎可以正常工作，但我希望能够动态更改文化。我怎样才能做到这一点？我尝试过使用绑定和动态资源，但无法弄清楚如何让其中任何一个工作。我想我应该补充一点，我几乎是 WPF 的初学者。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T23:59:04.597

看看[这个 Codeplex 项目](http://codeplex.com/wpflocalizeextension)。它提供了一个与 WPF 的绑定系统很好地融合的动态本地化系统。

# asp.net - 在现有解决方案中集成自定义会员提供程序

> ID：691638
> 
> 赞同：0
> 
> 时间：2009-03-27T22:07:10.073
> 
> 标签：asp.net, membership, provider, solution

我有 MS 提供的 sqlMembershipProvider 和 sqlRolesProvider 的源代码，我想修改它以使用我自己的表和模式。

我有一个将使用此提供程序的现有解决方案，我想在该解决方案中调试提供程序代码，直到我确定它可以工作。

如何在该解决方案的项目中设置我的提供程序代码，以便我可以在解决方案的 Web 项目的 web.config 中引用我的自定义提供程序？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-27T22:28:00.493

只要您在配置中提供完全限定的类型名称，这并不重要：

```
<membership defaultProvider="YourProvider">
    <providers>
        <add name="YourProvider" type="FullTypeName, YourAssembly"/>
    </providers>
</membership> 
```

它可以是单独程序集中的类型，也可以是 Web 应用程序中的类型。但它不适用于“网站”项目，因为 App_Code 文件夹中的所有代码都是动态编译的，所以你无法知道它的类型名称。

# css - 什么是表格布局的对齐 CSS 样式？

> ID：691639
> 
> 赞同：0
> 
> 时间：2009-03-27T22:07:36.640
> 
> 标签：css

我有一个 html 表格。我更喜欢将表格布置为居中。这个布局的 css 样式是什么？还有任何在线 css 工具可以交互地查看样式变化吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T22:16:58.443

鉴于此 HTML：

```
<div>
  <table>
    <!-- contents -->
  </table>
</div> 
```

你可以使用这个 CSS：

```
div{
  margin:0 auto;
  text-align:center;
}
div table{
  margin:0 auto;
  text-align:left;
} 
```

如果您`margin: 0 auto`申请`table`.

然而，`text-align`CSS 使它适用于更挑剔的浏览器。具体来说，`text-align: center`会将.`table``text-align: left`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T22:09:45.950

如果我没记错的话，它是[text-align](http://www.w3schools.com/CSS/pr_text_text-align.asp)属性。还是您的意思是在 html 页面中将表格居中？

# c# - 如何在asp.net中读取WebRequest返回的数据？

> ID：691642
> 
> 赞同：0
> 
> 时间：2009-03-27T22:07:50.540
> 
> 标签：c#, .net, asp.net, httpwebrequest

我正在尝试将 3D Secure 集成到我客户的电子商店。我需要将一些数据发布到 3DGate 并从中获取返回的结果。

我为此使用了 WebRequest，我已经成功发布了数据，但返回的数据是一个 Html 文本，其中包含一个表单和表单中的一些输入。我需要读取这些值，`Request.Form.Get("HashParams")`但由于只是一个字符串，我无法做到。

有什么方法可以让我获得这些表单值。

*我在 btnPayment_Click 事件中执行此 WebRequest*

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T22:18:00.063

我相信 madcolor 正在考虑不同的情况。您正在服务器上进行全新的 webrequest，这意味着没有请求参数；你正在处理一个响应。从本质上讲，您已经成为网络浏览器，您必须自己进行解析。

由于您使用的电子商店是专为浏览器设计的应用程序，因此您必须处理该格式固有的限制。您本质上受制于“屏幕抓取”技术，因为服务器不会将响应中的文本视为除此之外的任何其他内容：纯文本。

如果您正在处理有效的 XHTML，您可以将其加载到 XmlDocument 中，并使用 XPath/XQuery 提取值。

如果您正在处理标准糟糕的 HTML，您将不得不求助于一些解析；我会为此建议一个正则表达式。

理想情况下，将有一个非 HTML 版本的电子商店，因此您会知道您正在使用有效的 XML/JSON/任何东西，但如果没有其他选择，您就会被困在自己的数据中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T22:19:34.240

我看不出必须解析从 WebRequest 返回的 HTML 的方法。如果幸运的话，它可能是有效的 XML。否则，您将不得不进行自己的字符串解析或使用其他 HTML 解析器之一。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T22:25:29.250

这是返回的数据...

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- gateerr_en.htm -->
<html>
<head>
<script type="text/javascript" language="javascript">
function moveWindow() {
  document.returnform.submit();
}
</script>  
</head>

<body onLoad="javascript:moveWindow()">
<form action="urlHere" method="post" name="returnform">

    <input type="hidden" name="clientid" value="xxx">
    <input type="hidden" name="oid" value="">

    <input type="hidden" name="mdStatus" value="7">
    <input type="hidden" name="mdErrorMsg" value="Tanimlanamayan">

    <input type="hidden" name="ErrMsg" value="Tanimlanamayan">
    <input type="hidden" name="Response" value="Error">
    <input type="hidden" name="ProcReturnCode" value="99">  

    <!-- To support javascript unaware/disabled browsers -->
    <noscript>
        <center>
        An Error Occurred, Please Click to continue.<br>
        <input type="submit"  value="Submit"></center>
    </noscript> 
</form>
</body>
</html> 
```

我需要得到那些隐藏的输入

# java - 为什么我在 Java 中的 XPath 表达式返回了太多的子项？

> ID：691647
> 
> 赞同：1
> 
> 时间：2009-03-27T22:10:05.527
> 
> 标签：java, xpath

我有以下 xml 文件：

```
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<config>
 <a>
  <b>
   <param>p1</param> 
   <param>p2</param> 
  </b>
 </a>
</config> 
```

以及获取我的节点参数的 xpath 代码：

```
Document doc = ...;
XPath xpath = XPathFactory.newInstance().newXPath();
XPathExpression expr = xpath.compile("/config/a/b");
Object o = expr.evaluate(doc, XPathConstants.NODESET);
NodeList list = (NodeList) o; 
```

但事实证明，节点列表 (list) 有 5 个子节点，包括`"\t\n"`，而不是只有两个。我的代码有问题吗？我怎样才能得到我的两个节点？

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T23:05:12.930

当您选择 时`/config/a/b/`，您将选择的*所有*子项`b`，其中包括三个文本节点和两个元素。也就是说，给定您上面的 XML 并且只显示有问题的片段：

```
<b>
 <param>p1</param> 
 <param>p2</param> 
</b> 
```

第一个孩子是后面`<b>`和前面的文本（空白） `<param>p1 ...`。第二个孩子是第一个`param`元素。第三个孩子是两个`param`元素之间的文本（空白）。等等。XML 中不会忽略空格，尽管处理 XML 的许多形式都会忽略它。

你有几个选择：

1.  按照 Ted Dziuba 的建议，更改您的 xpath 表达式，使其仅选择元素节点，或者
2.  循环返回的五个节点，只选择非文本节点。

你可以这样做：

```
for (int i = 0; i < nodes.getLength(); i++) {
    if (nodes.item(i).getNodeType() != Node.TEXT_NODE) {
        System.out.println(nodes.item(i).getNodeValue());
    }
} 
```

您可以使用节点类型仅选择元素节点，或删除文本节点。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-27T22:32:33.430

所以 xpath 看起来像： `/config/a/b/*/text()`. 和输出：

```
for (int i = 0; i < nodes.getLength(); i++) {
        System.out.println(nodes.item(i).getNodeValue());
    } 
```

将如预期的那样：p1 和 p2

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-27T22:40:47.357

怎么样

```
/config/a/b/*/text()/.. 
```

?

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-10-10T20:12:27.197

```
import org.w3c.dom.*;

import javax.xml.xpath.*;

import javax.xml.parsers.*;

import java.io.IOException;

import org.xml.sax.SAXException;

public class TestClient_XPath {

    public static void main(String[] args) throws ParserConfigurationException,
            SAXException, IOException, XPathExpressionException {

        DocumentBuilderFactory domFactory = DocumentBuilderFactory
                .newInstance();
        domFactory.setNamespaceAware(true);
        DocumentBuilder builder = domFactory.newDocumentBuilder();

        Document doc = builder.parse("yourfile.xml");
        XPath xpath = XPathFactory.newInstance().newXPath();

        XPathExpression xPathExpression = xpath.compile("/a/b/c");

        Object res = xPathExpression.evaluate(doc);

        System.out.println(res.toString());
    }

} 
```

Xalan 和 Xerces 似乎嵌入在 rt.jar 中。

不要包含 xerces 和 xalan 库。

[http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4624775](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4624775)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-28T00:22:51.183

我不确定，但**/config/a/b**不应该只返回**b**吗？**/config/a/b/param**应该返回两个**参数**节点...

对问题的看法会是问题吗？当然，您会取回结果节点及其所有子节点。所以你只需要查看第一个元素而不是它的子元素。

但我可能完全错了，因为我通常只是使用 Xpath 在 DOM 树（HtmlUnit）上导航。

# iphone - 如何用 Cocos2d-iPhone 画线

> ID：691648
> 
> 赞同：19
> 
> 时间：2009-03-27T22:10:24.590
> 
> 标签：iphone, objective-c, cocoa-touch, cocos2d-iphone

我试图通过完成简单的事情来掌握 Cocos2d。此时，我有一个场景，该场景有一个背景精灵和一个图层。我正在尝试使用 drawLine 绘制到图层上。这是我目前的尝试。

```
@implementation MyLayer
-(id)init{
    self = [super init];
    if(self != nil){
        glColor4f(0.8, 1.0, 0.76, 1.0);  
        glLineWidth(2.0f);
        CocosNode *line = drawLine(10.0f, 100.0f,400.0f,27.0f);
        [self addChild:line z:1];
    }
    return self;
}
@end 
```

这会产生错误“不应忽略的无效值”。所以很明显我做错了，但希望你能看到我的推理。

我也试过这个

```
-(id)init{
    self = [super init];
    if(self != nil){
        glColor4f(0.8, 1.0, 0.76, 1.0);  
        glLineWidth(2.0f);
        drawLine(10.0f, 100.0f,400.0f,27.0f);
    }
    return self;
} 
```

这不会给我一个错误，但它也不起作用。我意识到我不了解一些基本的东西，但是谁能引导我朝着正确的方向前进？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2010-07-20T08:21:46.450

来自 cocos2d [drawPrimitivesTest.m](http://github.com/cocos2d/cocos2d-iphone/blob/454d1753ea73b37dbde4d686a876a542a65e4677/tests/drawPrimitivesTest.m)：

```
- (void)draw {
  // ...

  // draw a simple line
  // The default state is:
  // Line Width: 1
  // color: 255,255,255,255 (white, non-transparent)
  // Anti-Aliased
  glEnable(GL_LINE_SMOOTH);
  ccDrawLine( ccp(0, 0), ccp(s.width, s.height) );

  // ...
} 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-03-27T22:34:29.027

好的，我想出来给任何有兴趣的人。这是带有注释的代码，解释了要做什么。

```
@implementation GameLayer
-(id)init{
    self = [super init];
    if(self != nil){
        // init stuff here      
    }
    return self;
}

// You have to over-ride this method
-(void)draw{
    glColor4f(0.8, 1.0, 0.76, 1.0);  
    glLineWidth(2.0f);
    drawLine(10,100,50,79);
}    
@end 
```

所以我假设，draw方法在每一帧都被调用。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2011-11-18T06:43:50.290

您还可以使用 CCRibbon 类来绘制纹理与线条。这是一个例子：

首先，您使用 width 、 image 、 length 、 color 和 fade 参数创建 CCribbon

```
ccColor4B myColor = ccc4(255, 255, 255, 150);

CCRibbon *ribbon = [CCRibbon ribbonWithWidth:10 image:@"green.png" length:10.0 color:myColor fade:0.7f]; 
```

然后我们将其添加为子项：

```
[self addChild:ribbon z:8]; 
```

如果您现在运行应用程序，您将看不到任何内容，因为您还没有向 CCRibbon 添加任何点，所以让我们添加 2 个点

```
[ribbon addPointAt:ccp(10,10) width:10];

[ribbon addPointAt:ccp(15,15) width:10]; 
```

您不能删除单个点，但可以从其父级中删除 CCRibbon

```
[self removeChild:ribbon cleanup:YES]; 
```

源代码来自： [http ://www.ccsprite.com/cocos2d/using-ccribbon-example.html](http://www.ccsprite.com/cocos2d/using-ccribbon-example.html)

# php - 在drupal中根据$nid查找$cid

> ID：691650
> 
> 赞同：0
> 
> 时间：2009-03-27T22:10:51.563
> 
> 标签：php, drupal

我在drupal中有一个节点。我希望能够输入一个节点 ID，然后让它输出在该节点上创建的单个评论 ID。我该怎么做呢？谢谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-28T00:11:49.993

```
$mycid = db_fetch_object(db_query('SELECT * FROM {comments} WHERE nid = %d ORDER BY RAND() LIMIT 1', $mynid));
return theme_comment_view($mycid,$mynid); 
```

$mynid 是您要加载的节点 ID。此代码将获取您的节点 ID 并从该节点的评论中呈现随机评论。

[在这里](http://api.drupal.org/api/function/theme_comment_view/6)检查。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-28T00:53:16.757

你希望这是它自己的页面吗？在节点的页面上？在一个街区？你想要一个特定的评论还是一个随机的评论？您想如何“输入”节点 ID？

在大多数情况下，我可能会使用[Views 模块](http://drupal.org/project/views)来执行此操作。创建视图时，您可以将类型设置为“评论”，将过滤器/参数设置为特定的节点/节点类型并将其限制为单个评论。如果您想要一个页面或一个块，视图可以简单地为您创建它们。如果您想显示整个评论或部分评论，Views 可以解决这个问题。如果您想将它们嵌入到其他页面中，通过 PHP 将视图嵌入到另一个页面中仍然相对容易。

# windows-mobile - 在 Windows Mobile 6 上注册 driectshow 过滤器

> ID：691651
> 
> 赞同：1
> 
> 时间：2009-03-27T22:11:17.257
> 
> 标签：windows-mobile, activex, directshow

我正在尝试在 Windows Mobile 上注册我的 DirectShow 过滤器。我的项目将 Linker/General/Register Output 设置为 Yes。但是，什么都没有注册，我收到以下错误：项目：错误 PRJ0050：无法注册输出。请尝试使用提升的权限从命令提示符注册组件。

我正在运行 Vista 并且 UAC 已禁用。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-29T05:20:23.190

这是一个猜测，但我的猜测是它试图在主机系统（vista）上注册 WM DLL，而不是在 WM 设备上。我认为没有一种方法可以在 Visual Studio 的 WM 设备上注册 DLL。

您可以创建一个 CAB 文件，在其中指明哪个 DLL 是自注册的，或者您可以编写一个快速工具来为您注册 DLL。两者都很简单。

# readline - 使用 GNU 阅读线；如何在同一程序中添加 ncurses？

> ID：691652
> 
> 赞同：25
> 
> 时间：2009-03-27T22:11:35.117
> 
> 标签：readline, ncurses, editline

标题比我的实际目标更具体：

我有一个使用 GNU Readline 的命令行程序，主要用于命令历史记录（即使用向上箭头检索以前的命令）和其他一些细节。现在程序的输出似乎与用户的输入穿插在一起，这有时是可以的，但输出是异步的（它通过网络连接来响应输入命令），有时会变得烦人（例如，如果在用户输入时输出行正在输入新的输入）。

我想为这个程序添加一个功能：一个单独的“窗口”用于输出。我考虑过为此使用ncurses。但是从[ncurses FAQ](http://invisible-island.net/ncurses/ncurses.faq.html#readline_library)看来，这两个库并不容易一起使用。

我可能会考虑使用[Editline](http://www.thrysoee.dk/editline/)或[tecla](http://www.astro.caltech.edu/~mcs/tecla/)而不是 Readline，但我不清楚其中任何一个是否能解决我的问题。我还考虑使用 ncurses 以外的东西，包括提供两种功能（文本模式窗口和命令历史记录）的库，但我不知道什么可能是最好的。

哦，对彩色文本的支持可能会获得奖励积分。我怀疑我可以用 Readline 做到这一点，所以也许这是一个单独的问题，但如果我的问题的解决方案也可以很容易地为输出添加一些颜色，那就更好了。

我正在使用 Ubuntu Hardy (Linux 2.6)。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2015-02-25T02:14:22.417

我现在在 GitHub 上整理了一个简单的示例程序：[https](https://github.com/ulfalizer/readline-and-ncurses) ://github.com/ulfalizer/readline-and-ncurses 。

它支持无缝高效的终端大小调整和多字节/组合/宽字符。该代码有有用的注释。

截图如下：

![ncurses和readline结合的程序截图](https://i.stack.imgur.com/Rxyz9.png)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-28T22:33:05.107

我做了一些搜索，看来你运气不好。

对于 ncurses 替代品，有[SLang](http://www.jedsoft.org/slang/)、[Newt](http://en.wikipedia.org/wiki/Newt_%28programming_library%29)和[Turbo Vision](http://tvision.sourceforge.net/)。俚语不仅仅是屏幕处理，因此更复杂，但也许它可以用于您的目的？Newt 使用屏幕处理并且更简单，但我认为对于您的目的来说太简单和单线程模式了。

Turbo vision 是 Borland 的文本模式图形库，在 80 年代末/90 年代初被他们所有的工具使用。当这类东西的市场减少时，Borland 发布了源代码，现在有一个用于 linux 的端口（旁注，[这个项目](http://vax64.dk/tdbr/)似乎已经编写了自己的 turbo vision 实现）。那个端口没有死（今年有一些 cvs 更新编译得很好（旧版本没有）），但我发现的电视示例都不是最新的，我之前只编译了其中的几个放弃其余的。这有点可惜，因为电视是一个可爱的使用环境。电视是 Btw C++（我假设您使用的是 C？）。

对于 readline 的替代方案，有[libkinput](http://labs.asn.pl/asnlibs/wiki/libkinput)，它可能与 ncurses 一起使用（它说它可以使用 ncurses 的 terminfo。但我不确定这是否意味着它可以与 ncurses 使用共存）？

也许一种选择是使用[rlwrap](http://utopia.knoware.nl/~hlub/rlwrap/)在您的 ncurses 程序“外部”运行 readline ？

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2015-02-17T21:15:51.343

这让我头疼了几个小时，所以只是为了让人们在谷歌上搜索一些痛苦：

如果您使用 ncurses 的内置`SIGWINCH`处理程序 with `KEY_RESIZE`，请注意 readline 默认设置`LINES`和`COLUMNS`环境变量。这些会覆盖`ioctl()` `TIOCGWINSZ`ncurses 否则会执行的任何动态大小计算（通常使用 ），这意味着即使在调整终端大小后您仍将继续获得初始终端大小。

这可以通过在初始化 readline 之前设置`rl_change_environment`为来防止。`0`

**更新：**

以下是我从 readline 来源收集的一些附加信息：

readline 的`SIGWINCH`处理代码（如果`rl_catch_sigwinch`为 1 则使用）确实更新了`LINES`and `COLUMNS`，这似乎对于 ncurses 来说应该足够了。但是，当使用备用 readline 接口时（将 readline 与 ncurses 结合使用时最有意义），信号处理程序（包括一个 for `SIGWINCH`）将仅在每次`rl_callback_read_char()`调用期间安装，这意味着在两次调用之间的任何终端调整大小`rl_callback_read_char()`都不会被readline看到。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-05-06T17:45:29.560

所以事实证明gdb同时使用了readline和ncurses。如果您对此感兴趣，我建议您查看他们的实现： http: [//sourceware.org/git/ ?p=gdb.git;a=blob;f=gdb/tui/tui-io.c](http://sourceware.org/git/?p=gdb.git;a=blob;f=gdb/tui/tui-io.c)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-06-09T18:54:00.877

我已经实现了您在我的程序中描述的内容：

[http://dpc.ucore.info/lab:xmppconsole](http://dpc.ucore.info/lab:xmppconsole)

以下是文件处理io：

[http://github.com/dpc/xmppconsole/blob/master/src/io.c](http://github.com/dpc/xmppconsole/blob/master/src/io.c)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-09-14T05:34:58.873

我不确定您尝试了哪个版本。截至今天(2012.09.14) 非常简单，我们只需要将我们的自定义函数挂钩到以下函数指针。

```
rl_getch_function
rl_redisplay_function
rl_completion_display_matches_hook

```

我在[这里](https://github.com/mohan43u/tweetpts/blob/master/tweetpts-readlineapi.c)做了一些合理的事情。

# c# - C#：HtmlDocument 对象没有构造函数？

> ID：691657
> 
> 赞同：9
> 
> 时间：2009-03-27T22:13:42.943
> 
> 标签：c#, parsing, dom

那是怎么回事？似乎获得工作 HtmlDocument 对象的唯一方法是复制 mshtml/webbrowser 控件的 Document 属性。但是产卵是slooooooooooooow的。我想避免编写自己的 HTML 解析器，而 HtmlAgilityPack 是 copyleft。

是否有其他获取实例化 HtmlDocument 的来源，我可以将 HTML 从字符串转储到其中？

或者，有没有办法在使用带有 img 标签和 tr 元素的 InnerHtml/OuterHtml 时改写 HtmlElement 令人讨厌的习惯？

编辑：我指的是 System.Windows.Forms.HtmlDocument。抱歉，我还是 C# 和 .Net 的新手，对 COM 和该主题提出的其他一些事情知之甚少。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-27T22:18:17.753

它没有构造函数，因为它只是一个非托管对象的包装类。

参考：http: [//msdn.microsoft.com/en-us/library/system.windows.forms.htmldocument.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.htmldocument.aspx)

> HtmlDocument 为 Internet Explorer 的文档对象（也称为 HTML 文档对象模型 (DOM)）提供了一个托管包装器。您可以通过 WebBrowser 控件的 Document 属性获得 HtmlDocument 的实例。

根据您想要它的用途，您可能需要查看[SGMLReader](http://code.msdn.microsoft.com/SgmlReader)或最新的[社区版本](http://wiki.developer.mindtouch.com/Community/SgmlReader)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-27T22:34:13.643

健壮的编程？

通过 WebBrowser 控件使用 DOM 时，应始终等到 DocumentCompleted 事件发生，然后再尝试访问 WebBrowser 控件的 Document 属性。DocumentCompleted 事件在整个文档加载后引发；如果在此之前使用 DOM，则可能会在应用程序中导致运行时异常。

[http://msdn.microsoft.com/en-us/library/ms171712.aspx](http://msdn.microsoft.com/en-us/library/ms171712.aspx)

# .net - .NET 的自动更新库？

> ID：691663
> 
> 赞同：39
> 
> 时间：2009-03-27T22:15:39.663
> 
> 标签：.net, auto-update

在 Mac 上有一个非常棒的库，叫做[Sparkle](http://sparkle.andymatuschak.org/)，程序可以使用它来实现自动更新的检查/安装功能。

.NET 有类似的东西吗？还是只是普通的Win32？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-03-27T22:36:12.127

[ClickOnce](http://en.wikipedia.org/wiki/ClickOnce)有其自身的安全限制（可以理解）。如果您想要 Windows 应用程序的全部功能和控制，请使用[.NET](http://en.wikipedia.org/wiki/.NET_Framework) [应用程序更新程序](http://windowsclient.net/articles/appupdater.aspx)组件。它就像一个魅力，甚至被微软内部用于他们基于 .NET 的游戏（虽然我不记得游戏名称）。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2010-02-23T21:03:46.333

首先让我说我们提供了一个完整的更新解决方案，其中包括：

*   用 C# 编写的开源[更新程序 wyUpdate](http://wyday.com/wyupdate/)
*   免费的[AutomaticUpdater 控件](http://wyday.com/wybuild/help/automatic-updates/)，您可以将其添加到 .NET 应用程序的表单中
*   [wyBuild 用于构建补丁](http://wyday.com/wybuild/)和管理您的版本

wyUpdate 可处理所有 Vista/Windows 7 UAC 问题以及在您尝试更新复杂软件时不可避免地出现的所有文件权限问题。

话虽如此，如果您想构建自己的更新程序，这里有一些提示：

## 构建自己的更新程序

一个好的起点是我上面提到的[wyUpdate C# 源代码。](http://wyday.com/wyupdate/)您可以将其蚕食并将其用于您自己的目的。它包含的一些算法：

*   完整的 Windows Vista / Windows 7 UAC 支持
*   有限用户能够检查然后更新他们是否有凭据
*   支持不稳定的企业内部网。（如果您曾经与一家公司合作过，这是一个真正的问题）。
*   快速提取、修补和安装文件。
*   注册表支持。
*   在用户出错或取消时回滚文件和注册表
*   自我更新（不留下任何文件）

我们这里也有[文件规范](http://wyday.com/wyupdate/file-specifications.php)。

## 自动更新

由于自动化是一项要求，让我告诉您我们如何使用[AutomaticUpdater 控件](http://wyday.com/wybuild/help/automatic-updates/)来做到这一点。

我们使用命名管道在独立更新程序 (wyUpdate) 和位于程序窗体上的自动更新程序控件之间进行通信。wyUpdate 向 Automatic Updater 报告进度，Automatic Updater 可以告诉 wyUpdate 取消进度、开始下载、开始解压等。

这使更新程序与您的应用程序分开。

事实上，我们使用的确切命名管道 C# 代码包含在我不久前写的一篇文章中：**[Multi-process C# app like Google Chrome](http://wyday.com/blog/2010/multi-process-c-sharp-application-like-google-chrome-using-named-pipes/)**。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-03-27T22:17:15.557

[ClickOnce](http://en.wikipedia.org/wiki/ClickOnce)是我的首选方法。它有一些缺点，但它带有 Visual Studio 并且运行良好。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-27T22:34:56.577

ClickOnce 被大量使用，但您可以像我为大型应用程序所做的那样尝试这些：

*   [VB.NET 中的应用程序自动更新](http://www.codeproject.com/KB/vb/autoupdate.aspx)

*   [重新审视应用程序自动更新](http://www.codeproject.com/KB/vb/Auto_Update_Revisited.aspx)

我稍微修改了一下逻辑并构建了我认为更好的 XML 更新文件。现在，当我需要更新客户端时，我只需发布新的 EXE 文件或 DLL 文件并在公共 XML 文件中设置正确的版本。我的应用程序会检测到较旧的版本并自行更新。如果您在[Windows Vista](http://en.wikipedia.org/wiki/Windows_Vista)上执行此操作，则需要提示管理员权限，以便可以写入 Program Files（如果您安装在那里）。

您还可以使用[C#/VB.NET Converter](http://www.developerfusion.com/tools/convert/csharp-to-vb/)轻松地将其转换为 C# 。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2011-01-05T10:01:33.607

我刚刚完成了这个过程并使用[了 NetSparkle](http://netsparkle.codeplex.com/)。

它像广告宣传的那样使用覆盖先前版本的[MSI安装程序的](http://en.wikipedia.org/wiki/Windows_Installer)[Windows 窗体](http://en.wikipedia.org/wiki/Windows_Forms)应用程序。我很高兴我也找到了它——我正要自己动手。我是唯一一个制作真正简单的 .NET 应用程序的人吗？大多数情况下，我所看到的一切似乎都完全是矫枉过正。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2011-02-22T10:18:50.137

我还没有尝试过 NetSparkle（我稍后会尝试），但它似乎正是您想要的。

[**NetSparkle**](http://netsparkle.codeplex.com/)是一个易于使用的软件更新框架，适用于 Windows、Mac 或 Linux 上的 .NET 开发人员。它的灵感来自[Cocoa](http://en.wikipedia.org/wiki/Cocoa_%28API%29)开发人员[的Sparkle](http://sparkle.andymatuschak.org/)项目[和WinSparkle](http://winsparkle.org/)项目（一个[Win32](http://en.wikipedia.org/wiki/Windows_API)端口）。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-08-07T19:46:36.833

我认为[WyBuild](http://wyday.com/wybuild/)是很好的 Sparkle 替代品）

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-27T23:27:08.057

有一个非常好的实用程序，叫做[Updater](http://www.codeproject.com/KB/applications/updater.aspx)。看起来它是用[C](http://en.wikipedia.org/wiki/C_%28programming_language%29)或[C++](https://en.wikipedia.org/wiki/C++)编写的。我已经能够配置 XML 文件并将它们加载到生产服务器，然后我可以让更新程序运行并检查 XML 文件的不同版本并下载我使用[Nullsoft Scriptable Install System](http://en.wikipedia.org/wiki/Nullsoft_Scriptable_Install_System)构建的新更新安装包（国家情报局）。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-06-17T12:37:12.560

我们调查了一些选项并决定使用[AppLife Update](http://www.kineticjump.com/update/default.aspx)。AppLife Update 可以快速轻松地为您的 .NET 应用程序添加自动更新功能，但由于其全面的 API，它也很灵活。

在他们的网站上查看完整的功能列表和一些演示视频。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-09-14T07:03:22.833

> ## [点网自动更新](http://code.google.com/p/dotnetautoupdate)

我已经实现了一个名为[DotNetAutoUpdate](http://code.google.com/p/dotnetautoupdate)的库（原名是吗？）。它的目标是：

*   使用简单
*   设置简单
*   安全的

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2010-08-24T22:35:29.827

这是我为解决我们对 WinForms 和 WPF 应用程序的特定需求而编写的一个开源解决方案。总体思路是以尽可能低的开销获得最大的灵活性。

因此，**集成**非常简单，该库几乎可以为您完成所有工作，包括同步操作。它也**非常灵活**，可以让您确定要执行哪些任务以及在什么条件下执行 - 您制定规则（或使用一些已经存在的规则）。最后但并非最不重要的是支持**任何更新源**（网络、BitTorrent 等）和任何**提要格式**- 任何未实现的内容您都可以自己编写。

还支持冷更新（需要重新启动应用程序），并且会自动完成，除非为任务指定“热交换”。

这归结为一个 DLL，大小小于 70kb。

更多详情请访问[http://www.code972.com/blog/2010/08/nappupdate-application-auto-update-framework-for-dotnet/](http://www.code972.com/blog/2010/08/nappupdate-application-auto-update-framework-for-dotnet/)

代码位于[http://github.com/synhershko/NAppUpdate](http://github.com/synhershko/NAppUpdate)（在 Apache 2.0 许可下获得许可）

当我有更多时间时，我计划进一步扩展它，但老实说，你应该能够自己快速增强它，以应对它目前不支持的任何东西。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2009-04-27T15:38:18.377

要更新 .Net 客户端应用程序，请查看[AppLife 更新](http://www.kineticjump.com/update/default.aspx)。它非常灵活、可扩展和可定制。

免责声明 - 我与 AppLife 更新相关联。

# crystal-reports - 检测 x86/x64 并安装正确的 .msi

> ID：691666
> 
> 赞同：4
> 
> 时间：2009-03-27T22:17:44.603
> 
> 标签：crystal-reports, windows-installer, x86-64, merge-module

我正在完成一份申请，该申请将很快提交以进行 Windows 徽标计划验证。要求之一是 x64 兼容性。具体来说，Crystal Reports 2008 必须在 x64 下工作。

我的问题是 Crystal Reports basic 2008（与 Visual Studio 2008 一起打包的那个）没有合并模块，必须使用提供的 .msi 安装程序进行安装。他们为 x86 和 x64 提供单独的安装程序。

那么如何在安装过程中检测 x86 和 x64，然后运行适当的 Crystal msi？如果没有合并模块，这甚至可能吗？

编辑：

这：

```
IF PROCESSOR_ARCHITECTURE == x86 AND
   PROCESSOR_ARCHITEW6432 NOT DEFINED THEN
   // OS is 32bit
ELSE
   // OS is 64bit
END IF 
```

似乎告诉我如何检测它（感谢 MicSim）。但是如何在 MSI 中执行此操作？是自定义动作吗？然后如何触发 x32 和 x64 水晶报告所需的不同 msi？

为什么 x86 水晶安装程序在 WOW64 下不起作用？您必须安装 x64 Crystal 才能使用您的 WOW64 x86 应用程序。令人沮丧...

编辑2：

好的，所以这里似乎涵盖了检测 x86/x64。现在如何手动触发您选择的 msi？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-28T16:06:44.427

我发现检测 64 位操作系统的最简单方法是使用**VersionNT64**属性。此属性可用于组件或自定义操作的条件（例如，条件**Not VersionNT64**仅适用于 32 位操作系统）。

至于在安装过程中安装其他 MSI 软件包，那就有点棘手了。Windows 安装程序一次只允许一个 MSI 运行**执行序列**。这意味着您必须在**UI 序列**期间使用自定义操作安装 Crystal Reports MSI（如果这样做要小心，如果 MSI 在静默模式下运行，则会跳过**UI 序列**），或者创建某种引导程序将依次运行 Crystal Reports MSI 和您自己的。

我从未创建过自己的引导程序，但 InstallShield 在其 setup.exe 中内置了引导程序；他们称以这种方式安装的软件包为**先决条件**。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T22:27:32.537

刚刚搜索了一下：如果你有一个 MSI 项目，你可以检查[这里](http://community.installshield.com/showthread.php?t=175853)描述的属性。

有关检测进程和操作系统架构的更多信息，您可能需要阅读有关“HOWTO：检测进程位数”的[MSDN 博客。](http://blogs.msdn.com/david.wang/archive/2006/03/26/HOWTO-Detect-Process-Bitness.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-21T17:28:57.300

您可以使用执行 [SystemFolder]msiexec 的自定义操作来触发 Crystal Reports MSI。只需指定“/i [YourFolderWithCMSI]msiname.msi”作为参数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-15T00:39:20.623

根据[这个论坛](http://gery.vessere.com/2008/04/05/crystal-reports-in-visual-studio-2008-no-more-merge-modules)，Crystal Reports 现在包含一个用于 Visual Studio 2008 的合并模块。

[HREF=](https://smpdl.sap-ag.de/~sapidp/012002523100005986132008E/cr10_net_mm.zip) [https://smpdl.sap-ag.de/~sapidp/012002523100005986132008E/cr10_net_mm.zip](https://smpdl.sap-ag.de/~sapidp/012002523100005986132008E/cr10_net_mm.zip)

**编辑（来自作者）**：事实证明，这不适用于与 Visual Studio 2008 捆绑在一起的 Crystal Reports。

# c# - 下拉列表复选框

> ID：691675
> 
> 赞同：1
> 
> 时间：2009-03-27T22:21:27.467
> 
> 标签：c#, asp.net, html

如果您曾经使用过 SQL 报告服务，则会弹出一些下拉列表，其中包含一个复选框列表。它允许用户很好地选择多个项目。有谁知道免费的用户控件或实现的示例。好的，所以我知道我可以用一些肘部油脂和 html 来做到这一点，只是想看看那里是否已经有东西了。我正在使用 ASP.NET C#。

谢谢，

乔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T22:25:57.173

看一下这个。

1.  [http://www.metabuilders.com/Tools/CheckedListBox.aspx](http://www.metabuilders.com/Tools/CheckedListBox.aspx)

2.  [http://forums.asp.net/t/1040242.aspx](http://forums.asp.net/t/1040242.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T22:32:07.707

好的，很快就会在这里发布。我使用基础设施并找到了一个可能的解决方案。

谢谢！

[http://forums.infragistics.com/forums/t/3962.aspx](http://forums.infragistics.com/forums/t/3962.aspx)

# c - 从 Linux 上的根程序获得对 tty 设备的独占访问权

> ID：691676
> 
> 赞同：3
> 
> 时间：2009-03-27T22:22:07.637
> 
> 标签：c, linux, unix, tty

我有一个在 Linux 上以 root 身份运行的程序，与一个 tty（实际上是一个作为 tty 实现的 LCD）交谈。值得的设备是/dev/ttyUSB0。我希望写入此设备的程序能够独占访问该设备，以免受到同时运行的其他程序实例的任何干扰。

我看到有一个名为 TIOCEXCL 的 ioctl 选项，它可以防止设备的附加打开，“除非发出 TIOCEXCL ioctl，否则对同一文件的多个 open() 调用将成功。这将阻止除 root 拥有的进程之外的其他打开。 " 我对此进行了测试，它的工作原理与宣传的一样：如果非 root 用户尝试打开 /dev/ttyUSB0 （一旦我更改了权限），则打开失败并显示“设备忙”之类的内容，并且如果 root 用户尝试打开它， 有用。

我理想中想要的是一种对 tty 的独占访问权，以便为 root 用户工作。因此，我将有多个 root 用户使用写入 LCD 的程序，但不知何故，他们对 LCD (tty) 的访问将被序列化。显然 TIOCEXCL ioctl 选项对我不起作用，因为它不会阻止 root 用户打开已经打开的 tty 设备。

我想这里有很多选择，但我正在与大家联系，看看您是否有其他想法或建议。

1.  也许我错过了使用 TIOCEXCL 的一些东西......

2.  也许还有其他方法可以通过 open() 或 ioctl() 或其他方式获得独占访问。

3.  如果有某种方法可以检测到其他进程打开了设备，我可以等待并重试。我知道 lsof 但我不愿意从这个程序内部调用它只是为了了解这一点。并且有竞争条件。（也许我可以克服它？:)）

4.  我可以像以前那样实现锁定，以获得对 tty 设备的独占访问权限。

更新1：

由于写入 LCD 设备的唯一程序是我的，因此我倾向于执行以下操作（伪代码）来锁定代码内部：

```
f = open("/dev/ttyUSB0", O_RDWR)
flock(f, LOCK_EX)

// do any ioctl's, etc.

// do any write's

// sleep a tad to not flash messages too fast on LCD
nanosleep({0, 250000000}, NULL)

flock(f, LOCK_UN)
close(f) 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-27T23:03:57.910

或许这篇[关于LKML的讨论：【TTY】独占模式问题](http://lkml.indiana.edu/hypermail/linux/kernel/0506.1/0384.html)对你有帮助！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-12-02T10:41:17.613

我有一些像你这样的问题。如果你可以破解你的 linux 内核，你可以像这样进行肮脏的破解。在文件中

`linux/drivers/char/tty_io.c`

添加新命令到函数

```
long tty_ioctl(struct file *file, unsigned int cmd, unsigned long arg)
{
    ...
    switch (cmd) {
    ...
    case 0x54FF:
        return put_user(tty->count, (int __user *)p);
    ...
} 
```

的值`tty->count`是当前打开的描述符的计数。

在您的应用程序中，您可以尝试此代码

```
int fd, count, res;
fd = open("/dev/ttyS0", O_RDWR|O_NOCTTY|O_NONBLOCK);
if (fd >= 0)
{
    count = 0;
    res = ioctl(fd, 0x54FF, &count);
    if (res>=0)
    {
        if (count > 1)
        {
            printf("Device already in use.\n")
            close(fd);
            fd = -1;
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T23:42:22.297

答： Root 始终具有访问权限。总是。

也许如果您更多地说明还有什么正在抓取设备，或者您担心什么可能会抓取设备......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-11T18:12:10.650

我鼓励您研究 UUCP 锁定。Linux 上应该有一个实现它的库，但如果没有，它很容易实现。我已经在类似的情况下广泛使用它，我不希望同一程序的多个实例相互踩踏。

作为旁注，也许您应该重新考虑解决方案的架构。访问 LCD/ttyUSB0 的进程可以充当服务器并处理来自需要写入 LCD 的客户端进程的消息。这将需要某种形式的 IPC。对于您的项目来说，这可能是矫枉过正。

请记住，您提出的任何解决方案只有在访问设备的所有进程都符合协议时才有效。如果您担心以 root 身份运行的恶意进程，那么您可能会陷入破解内核以获得所需解决方案的困境。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-10-21T21:04:22.820

我不知道你是否已经找到了解决方案，或者你只是改变了你的设计，但这里有一个“根域”的解决方法：

1.  在您的系统中创建另一个与您的端口名称相同的文件，或者包括类似`ttyUSB0_islocked`.
2.  当您打开端口时，让您的进程查找/创建并打开此文件并在其中写入一些信息，例如它的进程 ID。
3.  在其他程序中打开端口之前，请检查该文件是否存在以及文件中是否存在具有相同进程 ID 的进程，如果没有此类进程，则继续执行，否则请等待或退出。

# dns - 什么是 ADS 领域？

> ID：691678
> 
> 赞同：2
> 
> 时间：2009-03-27T22:24:09.253
> 
> 标签：dns

我正在尝试在我的 SAN 系统中设置共享，它正在为我的域控制器请求 ADS 领域。

它是什么？我在哪里可以找到这个值？

我使用 ActiveDirectory 作为域控制器。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-06T03:24:27.323

ADS 领域是附加到已加入域的所有主机的 Active Directory 域后缀。

# php - 了解框架

> ID：691682
> 
> 赞同：5
> 
> 时间：2009-03-27T22:25:53.400
> 
> 标签：php, open-source, frameworks

理解一个框架是如何以及为什么这样写的最好的方法是什么？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-27T22:36:22.017

为它开发一个特性，或者修复一个错误。如果您使用该框架来开发现实世界的解决方案，您可以列出要解决的缺点或要添加的功能，以使您的任务更容易。

修复一个 bug 真的会帮助你理解代码，因为大多数时候你会得到一段重新创建它的示例代码，然后你可以追溯到地狱的深处，找出哪里出了问题。

真正需要的是坚持。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-27T22:47:04.270

取一个非常简单的组件并分析代码。例如，看一下 Zend 框架的一些组件（非常简单的东西，比如`Zend_Version`或，稍微加强一点，但仍然保持简单，`Zend_Debug`）。把它们分开，看看是什么让它们打勾。然后，尝试编写自己的简单组件。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-28T04:35:41.170

在“从头开始”制作了许多网站后，我发现自己一遍又一遍地重用相同的脚本，而且我发现有些东西非常乏味，因为我以前从未费心将它们抽象出来以实现重用性。所以，如果你有任何制作网站的经验，你应该对你的框架应该包含什么有一个很好的感觉。如果没有，我可能会从考虑 MVC 文件结构开始，让您的框架首先使用视图，然后是控制器，然后是模型。然后确保它们中的每一个都易于扩展，因为无论您多么努力，总会缺少一些东西......然后在您需要时开始使用实用程序（表单助手，模型助手等）。换句话说，想出一个你想使用框架的项目，并同时构建框架和网站。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-27T23:25:10.417

我知道世界需要另一个，就像它需要一个洞，但是编写自己的框架是学习语言的好方法。在不到两周的时间里，我用 PHP 写了一篇相当完整的文章，并在此过程中学到了很多关于 PHP 和 Web 开发的知识。

我没有发布它的唯一原因是因为我最终对它管理会话状态的方式不满意，但这也是一次很好的学习体验！

我认为开始框架设计的方法是为它写下大约 5 个基本目标。对我来说，这些是：

*   旨在生成具有十几种形式的简单 Web 应用程序
*   针对具有良好 SQL 知识的人
*   没有 PHP 或其他程序代码（SQL SP 中的除外）
*   无需 HTML/javascript/CSS 编程
*   XML 中描述的应用程序
*   在普通 PHP/Apache 堆栈上工作
*   服务器上没有状态维护

这足以让我开始。

我可以提出的另一个建议是在构建框架本身的同时尝试使用框架构建应用程序。这将很快揭示问题并为新方向 abd 功能提出想法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-27T22:56:40.783

你在正确的轨道上。请记住，罗马不是一天建成的。每栋房屋都是在较长的时间内建造的，一砖一瓦。

通过使用一个框架，你会发现它的一些缺点，并且能够找到一些缺失或需要改进的功能。

从那里开始，开发改进并将其提交给框架社区进行同行评审。即使他们决定不将您的工作纳入框架，您也会收到有关您工作的非常有价值的反馈。

不要止步于此，将您在第一次尝试中学到的知识用于第二次（以及第三次、第四次、第五次……）这样您将学会理解其他人对框架的期望（这可能与您自己的期望），并慢慢了解hte框架本身的内部工作原理。

**结论：**要有耐心和坚持。理解会随之而来。（听起来很深奥，我知道。但它可能会奏效！）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-28T02:27:46.937

大多数框架都包含许多内容，尽管定义很模糊。

*   提供一个基本的引导程序（管理设置、设置环境、检查 PHP 版本之间的兼容性问题等）
*   URL 路由 - 如何定义哪些 URL 指向哪些页面的规则。
*   管理插件、库、模块等。
*   数据库 ORM - 操作对象而不是编写 SQL 查询（简化）
*   模板化——通常涉及为模板逻辑（循环、条件）创建一种迷你语言，以避免在模板本身中包含 PHP 代码。

除此之外，大多数框架还包括大量库，从简单的电子邮件到高级 Web 服务 API。

我会推荐两个框架来看看：

1.  [代码点火器](http://www.codeigniter.com)

    我推荐这个，因为它是一个“包含电池”的框架，开箱即用。它还有一个很棒的社区，很多 3rd 方库。CI 有一些技巧可以让框架同时与 PHP4 和 PHP5 兼容，这也很好知道（因为出于某种原因，很多人仍在使用 PHP5）。您还应该看看[KohanaPHP](http://kohanaphp.com/)，它是 CodeIgniter 的一个分支，已被重写为严格的 PHP5 框架。

2.  [Zend 框架](http://framework.zend.com/)

    Zend 是一个基于模块的框架。您无需将所有内容都放在目录中并大量制作页面，而是选择您需要的部分并自己将它们粘合在一起。由于 Zend 是由 PHP 背后的引擎背后的人制作的（感到困惑吗？），它使用 PHP5 的“最新和最伟大的”——一切都是面向对象的，并且它使用类型提示。非常干净的代码，如果有点冗长的话。

我认为基本的东西是引导程序（框架的“粘合剂”），以及每个框架如何实现一个系统来支持用户制作的库和插件。其余的您可以在其他地方作为独立应用程序找到。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-28T08:11:26.207

您应该真正尝试从高层次上理解请求的生命周期。这是一个很好的例子，说明 Zend 框架中从请求到响应会发生什么， http: [//framework.zend.com/manual/en/zend.controller.basics.html](http://framework.zend.com/manual/en/zend.controller.basics.html)

# gwt - GXT KeyListener.componentKeyDown() 立即关闭 MessageBox.alert()

> ID：691684
> 
> 赞同：1
> 
> 时间：2009-03-27T22:26:52.787
> 
> 标签：gwt, messagebox, gxt, keylistener

在 GXT 中，`MessageBox`方法是异步的，这意味着在显示消息框时应用程序不会“锁定”。

我使用 a`KeyListener`来处理表单中的输入键（以提高可用性，即允许通过输入键提交表单），然后在应用程序处理用户凭据时禁用表单字段。如果它们不正确，我会显示 a`MessageBox.alert()`然后重新启用表单字段。但是，由于`alert()`立即返回，因此表单字段立即再次可用，允许用户在不关闭警报的情况下输入数据。

`alert()`解决方案是在;中使用回调。然而，回车键不仅会导致表单提交，还会导致警报立即关闭（好像表单和消息框都在处理回车键）。如何在用户第二次按下输入或单击“确定”按钮之前保持警报框打开？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T22:27:06.797

密钥`DeferredCommand`由[GWT](http://google-web-toolkit.googlecode.com/svn/javadoc/1.5/index.html?com/google/gwt/user/client/DeferredCommand.html)提供：

> 此类允许您在所有当前挂起的事件处理程序完成后使用`addCommand(Command)`or`addCommand(IncrementalCommand)`方法执行代码。当您需要在当前堆栈的上下文之外执行代码时，这很有用。

```
if(!validate())
{
    DeferredCommand.addCommand(new Command() {
        public void execute() {
            MessageBox.alert("Error", "You must enter a username and password.", alertListener);
            return;
        }
    });
} 
```

# c++ - 如何使用 Visual Studio 2008 构建在普通旧 XP SP2 上运行且没有并行 DLL 的 C++ 应用程序？

> ID：691686
> 
> 赞同：1
> 
> 时间：2009-03-27T22:27:04.567
> 
> 标签：c++, visual-studio-2008, side-by-side, crt

我想通过一次调用来编译一个 C++ 项目，`WinExec`以便使用一些命令行参数启动另一个可执行文件。我不知道在我的项目中要指定哪些设置才能生成不需要 Microsoft 并行 DLL 的可执行文件，我不想在我的目标系统上安装它。有什么提示吗？

症状是应用程序无法启动并且以下事件被写入应用程序日志（免费翻译自法语）：

```
Error, SideBySide, event #33
Microsoft.VC90.CRT,processorArchitecture="x86",publicKeyToken="1fc8b3b9a1e18e3b",type="win32",version="9.0.21022.8" cannot be found. 
```

*更新：我知道使用`WinExec`是不好的做法，但它就像一个魅力，微软不可能在任何未来的 API 版本中删除它，不是吗？*

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-27T22:31:38.220

如果您指定要静态链接运行时（/MT 或 /MTd），您应该很好。项目属性->C/C++->代码生成->运行时库

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-27T22:38:12.760

如果您只需要 CreateProcess/ShellExecute（WinExec 自 NT 3.1/Win 95 起已弃用），则根本不需要任何运行时库。在**Project Properties/Configuration/Linker/Input**中启用**Ignore All Default Libraries**并将 kernel32.lib 添加到**Additional Dependencies**。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-28T09:36:37.017

jachymko 和 Josh 已（部分）回答了该解决方案。这是完整的解决方案：

1.  将**Project Properties / Configuration / Linker / Input / Ignore All Default Libraries**设置为**Yes**并添加**`kernel32.lib`**到**Additional Dependencies**。仅此一项不会链接，因为代码会自动引用`__security_check_cookie`and `_WinMainCRTStartup`。

2.  移除**/GS**开关以指示编译器不要注入安全检查代码。为此，将**Project Properties / Configuration / C/C++ / Code Generation / Buffer Security Check**设置为**No**。

3.  将**项目属性/配置/C/C++/代码生成/运行时库**设置为**多线程 (/MT)**。

4.  初始 Visual Studio 2008 生成的代码包含一个**名为**`_tWinMain(HINSTANCE, HINSTANCE, LPTSTR, int)`. 通过重命名来修改它**`WinMain`**并将第三个参数转换为**`LPSTR`**.

5.  将**项目属性/配置/链接器/高级/入口点**设置为**`WinMain`**.

通过对默认 C++ 项目的这些更改，代码最终可以编译和链接，并在缺少运行时库的新安装的 Vista 或 XP 上运行。

# ruby - 截断给定字符串的文件名和扩展名

> ID：691688
> 
> 赞同：0
> 
> 时间：2009-03-27T22:27:11.430
> 
> 标签：ruby, regex, string, path

我构建了一个小脚本，它为给定文件类型的文件解析目录并将位置（包括文件名）存储在数组中。这看起来像这样：

```
def getFiles(directory)
  arr = Dir[directory + '/**/*.plt']
  arr.each do |k|
    puts "#{k}"
  end
end 
```

输出是路径和文件。但我只想要路径。

而不是 /foo/bar.txt 我只想要 /foo/

我的第一个想法是一个正则表达式，但我不知道该怎么做。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-27T22:36:58.537

[File.dirname](http://ruby-doc.org/core/classes/File.html#M002565)有什么用吗？

> **File.dirname(file_name) → dir_name**
> 
> 返回 file_name 中给出的文件名的所有组成部分，最后一个除外。文件名必须使用正斜杠 (``/'') 组成，无论本地文件系统上使用的分隔符如何。
> 
> ```
> File.dirname("/home/gumby/work/ruby.rb") #=> "/home/gumby/work" 
> ```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-27T22:36:41.173

您不需要正则表达式或拆分。

```
File.dirname("/foo/bar/baz.txt")
# => "/foo/bar" 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T22:32:49.483

以下代码应该可以工作（在 ruby​​ 控制台中测试）：

```
>> path = "/foo/bar/file.txt"
=> "/foo/bar/file.txt"
>> path[0..path.rindex('/')]
=> "/foo/bar/" 
```

rindex 查找最后一次出现的子字符串的索引。这是文档[http://docs.huihoo.com/api/ruby/core/1.8.4/classes/String.html#M001461](http://docs.huihoo.com/api/ruby/core/1.8.4/classes/String.html#M001461)

祝你好运！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T22:32:35.270

我会用斜杠将它拆分成一个数组，然后删除最后一个元素（文件名），然后再次将它加入一个字符串。

```
path = '/foo/bar.txt'

path = path.split '/'
path.pop
path = path.join '/'

# path is now '/foo' 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-27T22:33:08.967

不确定您使用哪种语言，但这里是字符串最后 / 到结尾的正则表达式。

```
/[^\/]*+$/ 
```

音译为字符串结尾之前所有非'/'的字符

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-27T22:49:14.840

对于正则表达式，这应该有效，因为 * 是贪婪的：

```
.*/ 
```

# c# - MVC处理数据输入的方式

> ID：691692
> 
> 赞同：0
> 
> 时间：2009-03-27T22:27:51.583
> 
> 标签：c#, .net, javascript, asp.net-mvc

我有一个数据输入模块，我在其中添加了我的产品信息及其子信息，例如：

产品基本信息 产品价格信息 产品价格详情

价格信息和价格详细信息与产品相关并且是列表

在我的 Web 表单方法中，我会将主要产品对象存储在视图状态中，并在执行 ajax 回发时填充它的定价信息和详细信息。通过这种方式，我可以创建一个紧凑的模块，该模块非常用户友好，可以从一个地方定义大量数据，而无需从单独的模块中输入这些数据。当我完成后，我会做一个 product.save() 并将所有数据保存到数据库上的相应表中。

现在我正在.net mvc 框架上构建类似的应用程序，并思考在 mvc 上处理这个问题的好方法是什么。

在单击保存之前，我不会对将所有这些存储在客户端产生共鸣。每次操作后保存到数据库让我想起了我在 asp 上编码的日子。

将感谢您在 mvc 框架上处理此问题的方法的输入

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-27T22:37:07.867

我相信最好的方法是将数据存储在客户端。它减少了不必要的回发并提高了应用程序的响应能力。如果你真的想将它存储在服务器上，你可以使用`SessionState`.

如果你真的想将它存储在 ViewState 之类的东西中，你可以使用这样的解决方案：[ASP.NET MVC - Is there a way to simulation a ViewState?](https://stackoverflow.com/questions/669492/asp-net-mvc-is-there-a-way-to-simulate-a-viewstate/669495#669495) . 但是，我建议不要这样做，因为它会使事情变得更加复杂。在客户端执行它可能是最优雅的方式，将其存储在 SessionState 中是最简单的。

请记住，您始终可以避开 MVC 模式并为该特定页面使用简单的 Web 表单（这将在您需要的地方为您提供 ViewState）：[ASP.NET MVC 控制器操作设计](https://stackoverflow.com/questions/594898/asp-net-mvc-controller-actions-design-question/598021#598021)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-05T05:58:59.557

将您的产品列表存储到视图的模型中，每次更改值时，您都可以将 Ajax 发布到控制器并将更改保存到数据库，使用部分视图显示产品列表中的每个项目

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-31T12:48:52.623

您可以尝试集成[http://www.castleproject.org/ActiveRecord/](http://www.castleproject.org/ActiveRecord/)以便于保存和更新。这样你就可以使用 ORM（对象关系映射）将你的模型映射到你的数据库上。一开始需要做更多的工作，但最终会得到简单的命令，如 product.Update() 和 product.Create()

# apache-flex - 受 PV3D 启发的建模有哪些选项和最佳实践

> ID：691705
> 
> 赞同：0
> 
> 时间：2009-03-27T22:35:03.330
> 
> 标签：apache-flex, flash, actionscript-3, papervision3d

我工作的工作室目前正在开发 Tony Hawk XI 网站，我负责 flash/AS3 的开发。作为推介的一部分，我输入了一个增强现实滑板示例来展示，这给客户留下了非常深刻的印象。

在使用 Papervision3D 变得更强大并了解 Flar Toolkit 几周后，我已经成功导入了 md2 和 dae 文件，这些文件可以加载并与我的自定义标记交互。

现在是时候开发一些我自己的模型了；我将使用 3DSMAX。我想知道在多边形数量、角色绑定和动画、纹理、导出和创建正确格式文件的技巧以及任何其他信息方面有什么限制，这些信息可能会让我在路上遇到一些严重的问题。

[目前我有一个 Quake2 MD2 模型，Ernie，在此处](http://www.hodgedev.com/plainium/dev/FLARToolkit_PV3D_Quake2_MD2_Ernie/)的 FlarToolkit 演示中拉取。

这是非常低的多边形，我想知道今天的机器速度要快得多，我可以期望有多少多边形可以逃脱；

Brian Hodge
[blog.hodgedev.com](http://blog.hodgedev.com) [hodgedev.com](http://hodgedev.com)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T15:36:39.497

我听说 2000 polys 大约是良好性能的门槛。但在实践中，它会受到打击或错过，很多事情都会产生影响。到目前为止，我在使用动画影片剪辑材料、带有 alpha chanel 的动画材料和精确材料时遇到了性能问题。

必须剪辑对象似乎是一把双刃剑。在某些情况下，它会大大提高性能，而在其他情况下（似乎主要是当视口边缘有很多多边形时），它会将帧速率降低 10-15 fps。所以，我想说你设置的视图也是需要考虑的。

例如，我们有一个商店内部模型，其中有一些货架和产品以及四处走动的顾客。我们总共有不到 600 个三角形（根据 StatsView，如果您还没有的话，应该检查一下：org.papervision3d.view.stats.StatsView）。在我的电脑上，这是一台四核的新电脑，它以稳定的 30 fps 运行（这是我们想要的），但在旧的戴尔 XPS（奔腾 4）上，它运行在 20 到 30 fps 之间，具体取决于正在运行的对象剪裁之类的

我们尝试创造性地减少多边形数量和纹理，以解决尽可能多的性能问题。不幸的是，我们的最低规格非常低，所以我们需要做很多事情才能让它运行良好。

编辑：我们正在做的另一件事是在放大时将不太详细的模型换成更详细的模型。如果您根本不放大，那么这可能无济于事。

希望有点帮助。

# c# - 通过 .NET 运行 cmd 命令？

> ID：691716
> 
> 赞同：4
> 
> 时间：2009-03-27T22:41:12.847
> 
> 标签：c#, .net, process, cmd

```
System.Diagnostics.Process proc0 = new System.Diagnostics.Process();
proc0.StartInfo.FileName = "cmd";
proc0.StartInfo.WorkingDirectory = Path.Combine(curpath, "snd");
proc0.StartInfo.Arguments = omgwut; 
```

现在来了解一些背景...

```
string curpath = System.IO.Path.GetDirectoryName(Application.ExecutablePath); 
```

omgwut 是这样的：

> 复制 /b a.wav + b.wav + ... + y.wav + z.wav output.wav

什么都没有发生。所以很明显出了点问题。我也尝试将“复制”作为可执行文件，但这不起作用。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-27T22:44:25.303

**尝试用 cmd 为参数添加前缀`/C`**，有效地说`cmd /C copy /b t.wav ...`

根据`cmd.exe /?`使用

`/C <command>`

> 执行字符串指定的命令，然后终止

对于您的代码，它可能看起来像

```
// .. 
proc0.StartInfo.Arguments = "/C " + omgwut; 
```

**笔记：**

*   测试您的命令是否有效的一个好方法是从命令提示符实际尝试它。如果您尝试这样做，`cmd.exe copy ...`您会发现副本不会发生。
*   您可以作为参数传递的参数的长度是有限制的。来自[MSDN](http://msdn.microsoft.com/en-us/library/system.diagnostics.processstartinfo.arguments.aspx)：“最大字符串长度是`2,003`.NET Framework 应用程序中的`488`字符和 .NET Compact Framework 应用程序中的字符。”
*   `System.IO`您可以通过使用类打开文件并手动连接它们来绕过对命令的脱壳。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-03-25T18:36:02.453

试试这个它可能会帮助你..它与我的代码一起工作。

```
System.Diagnostics.ProcessStartInfo procStartInfo =
    new System.Diagnostics.ProcessStartInfo("cmd", "/c " + command);

// The following commands are needed to redirect the standard output.
// This means that it will be redirected to the Process.StandardOutput StreamReader.
procStartInfo.RedirectStandardOutput = true;
procStartInfo.UseShellExecute = false;
// Do not create the black window.
procStartInfo.CreateNoWindow = true;
// Now we create a process, assign its ProcessStartInfo and start it
System.Diagnostics.Process proc = new System.Diagnostics.Process();
proc.StartInfo = procStartInfo;
proc.Start();
// Get the output into a string
string result = proc.StandardOutput.ReadToEnd();
// Display the command output.
Console.WriteLine(result);
  }
  catch (Exception objException)
  {
  // Log the exception
  } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-03-25T18:43:35.557

即使你可以试试这个..这更好。

```
System.Diagnostics.Process proc = new System.Diagnostics.Process(); 

proc.EnableRaisingEvents=false;
proc.StartInfo.FileName="iexplore";
proc.StartInfo.Arguments="http://www.microsoft.com";

proc.Start();

proc.WaitForExit();

MessageBox.Show("You have just visited " + proc.StartInfo.Arguments); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T22:54:37.510

Daniels cmd /c 想法会起作用。请记住，在您的情况下，命令行的长度可能为 8k，有关详细信息，请参阅[此](http://blogs.msdn.com/oldnewthing/archive/2003/12/10/56028.aspx)内容。

由于无论如何您都在使用 .Net 应用程序，因此 File.Copy 可能比这种方法更容易/更干净。

# c++ - C++ 在异常时显示堆栈跟踪

> ID：691719
> 
> 赞同：235
> 
> 时间：2009-03-27T22:42:46.480
> 
> 标签：c++, exception, exception-handling, stack-trace

如果抛出异常，我想有一种方法向用户报告堆栈跟踪。做这个的最好方式是什么？是否需要大量的额外代码？

回答问题：

如果可能的话，我希望它是便携式的。我希望弹出信息，以便用户可以复制堆栈跟踪并在出现错误时通过电子邮件将其发送给我。

* * *

## 回答 #1

> 赞同：82
> 
> 时间：2014-11-12T09:16:49.103

[Andrew Grant 的回答](https://stackoverflow.com/a/691742/913098)无助于获取*throwing*函数的堆栈跟踪，至少对于 GCC***没有***帮助，因为 throw 语句不会自行保存当前堆栈跟踪，并且 catch 处理程序将无法访问堆栈跟踪那一点了。

 *解决此问题的唯一方法是使用 GCC 确保在 throw 指令处生成堆栈跟踪，并将其与异常对象一起保存。

当然，此方法要求每个引发异常的代码都使用该特定的异常类。

*2017 年 7 月 11 日更新*：对于一些有用的代码，请查看[cahit beyaz 的答案](https://stackoverflow.com/a/42664648/913098)，它指向[http://stacktrace.sourceforge.net](http://stacktrace.sourceforge.net) - 我还没有使用它，但它看起来很有希望。

* * *

## 回答 #2

> 赞同：79
> 
> 时间：2009-03-27T22:55:57.273

这取决于哪个平台。

在 GCC 上，这非常简单，请参阅[这篇文章](https://stackoverflow.com/questions/77005/how-to-generate-a-stacktrace-when-my-gcc-c-app-crashes)了解更多详细信息。

在 MSVC 上，您可以使用[StackWalker](http://www.codeproject.com/KB/threads/StackWalker.aspx)库来处理 Windows 所需的所有底层 API 调用。

您必须找出将此功能集成到您的应用程序中的最佳方法，但您需要编写的代码量应该是最少的。

* * *

## 回答 #3

> 赞同：57
> 
> 时间：2017-09-11T11:08:48.097

如果您使用的是 Boost 1.65 或更高版本，则可以使用[boost::stacktrace](https://boost.org/libs/stacktrace)：

```
#include <boost/stacktrace.hpp>

// ... somewhere inside the bar(int) function that is called recursively:
std::cout << boost::stacktrace::stacktrace(); 
```

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2017-12-03T13:29:50.487

我想添加一个**标准库选项**（即跨平台）如何生成异常回溯，这已在**C++11**中可用：

## 使用[`std::nested_exception`](http://en.cppreference.com/w/cpp/error/nested_exception)和[`std::throw_with_nested`](http://en.cppreference.com/w/cpp/error/throw_with_nested)

这不会给你一个堆栈放松，但在我看来是下一个最好的事情。它在[此处](https://stackoverflow.com/a/37227893/4069571)和[此处](https://stackoverflow.com/a/348862/4069571)的 StackOverflow 上进行了描述，如何通过简单地编写一个将重新抛出嵌套异常的适当异常处理程序来**获取代码中异常的回溯，而无需调试器或繁琐的日志记录。**

由于您可以对任何派生异常类执行此操作，因此您可以向此类回溯添加大量信息！你也可以看看我[在 GitHub 上的 MWE](https://github.com/GPMueller/mwe-cpp-exception)，回溯看起来像这样：

```
Library API: Exception caught in function 'api_function'
Backtrace:
~/Git/mwe-cpp-exception/src/detail/Library.cpp:17 : library_function failed
~/Git/mwe-cpp-exception/src/detail/Library.cpp:13 : could not open file "nonexistent.txt" 
```

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2013-08-30T22:26:13.507

Unix： [回溯](http://www.kernel.org/doc/man-pages/online/pages/man3/backtrace.3.html)

Mac： [回溯](https://developer.apple.com/library/archive/documentation/System/Conceptual/ManPages_iPhoneOS/man3/backtrace.3.html)

窗口：[CaptureBackTrace](http://msdn.microsoft.com/en-us/library/windows/desktop/bb204633(v=vs.85).aspx)

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2019-08-07T11:26:55.407

如果您使用的是 C++ 并且不想/不能使用 Boost，则可以使用以下代码[[link to the original site]](https://panthema.net/2008/0901-stacktrace-demangled/)打印带有去错名称的回溯。

请注意，此解决方案特定于 Linux。它使用 GNU 的 libc 函数 backtrace()/backtrace_symbols()（来自 execinfo.h）来获取回溯，然后使用 __cxa_demangle()（来自 cxxabi.h）对回溯符号名称进行分解。

```
// stacktrace.h (c) 2008, Timo Bingmann from http://idlebox.net/
// published under the WTFPL v2.0

#ifndef _STACKTRACE_H_
#define _STACKTRACE_H_

#include <stdio.h>
#include <stdlib.h>
#include <execinfo.h>
#include <cxxabi.h>

/** Print a demangled stack backtrace of the caller function to FILE* out. */
static inline void print_stacktrace(FILE *out = stderr, unsigned int max_frames = 63)
{
    fprintf(out, "stack trace:\n");

    // storage array for stack trace address data
    void* addrlist[max_frames+1];

    // retrieve current stack addresses
    int addrlen = backtrace(addrlist, sizeof(addrlist) / sizeof(void*));

    if (addrlen == 0) {
    fprintf(out, "  <empty, possibly corrupt>\n");
    return;
    }

    // resolve addresses into strings containing "filename(function+address)",
    // this array must be free()-ed
    char** symbollist = backtrace_symbols(addrlist, addrlen);

    // allocate string which will be filled with the demangled function name
    size_t funcnamesize = 256;
    char* funcname = (char*)malloc(funcnamesize);

    // iterate over the returned symbol lines. skip the first, it is the
    // address of this function.
    for (int i = 1; i < addrlen; i++)
    {
    char *begin_name = 0, *begin_offset = 0, *end_offset = 0;

    // find parentheses and +address offset surrounding the mangled name:
    // ./module(function+0x15c) [0x8048a6d]
    for (char *p = symbollist[i]; *p; ++p)
    {
        if (*p == '(')
        begin_name = p;
        else if (*p == '+')
        begin_offset = p;
        else if (*p == ')' && begin_offset) {
        end_offset = p;
        break;
        }
    }

    if (begin_name && begin_offset && end_offset
        && begin_name < begin_offset)
    {
        *begin_name++ = '\0';
        *begin_offset++ = '\0';
        *end_offset = '\0';

        // mangled name is now in [begin_name, begin_offset) and caller
        // offset in [begin_offset, end_offset). now apply
        // __cxa_demangle():

        int status;
        char* ret = abi::__cxa_demangle(begin_name,
                        funcname, &funcnamesize, &status);
        if (status == 0) {
        funcname = ret; // use possibly realloc()-ed string
        fprintf(out, "  %s : %s+%s\n",
            symbollist[i], funcname, begin_offset);
        }
        else {
        // demangling failed. Output function name as a C function with
        // no arguments.
        fprintf(out, "  %s : %s()+%s\n",
            symbollist[i], begin_name, begin_offset);
        }
    }
    else
    {
        // couldn't parse the line? print the whole line.
        fprintf(out, "  %s\n", symbollist[i]);
    }
    }

    free(funcname);
    free(symbollist);
}

#endif // _STACKTRACE_H_ 
```

！

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2012-12-19T17:26:22.587

AFAIK libunwind 非常便携，到目前为止我还没有发现任何更容易使用的东西。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2017-03-08T06:43:06.820

我推荐[http://stacktrace.sourceforge.net/](http://stacktrace.sourceforge.net/)项目。它支持 Windows、Mac OS 和 Linux

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2018-07-26T11:52:20.257

由于在进入 catch 块时堆栈已经展开，因此我的解决方案是**不捕获某些异常**，然后导致 SIGABRT。在 SIGABRT 的信号处理程序中，我然后 fork() 和 execl() gdb（在调试版本中）或 Google breakpads stackwalk（在发布版本中）。我也尝试只使用信号处理程序安全功能。

广发银行：

```
static const char BACKTRACE_START[] = "<2>--- backtrace of entire stack ---\n";
static const char BACKTRACE_STOP[] = "<2>--- backtrace finished ---\n";

static char *ltrim(char *s)
{
    while (' ' == *s) {
        s++;
    }
    return s;
}

void Backtracer::print()
{
    int child_pid = ::fork();
    if (child_pid == 0) {
        // redirect stdout to stderr
        ::dup2(2, 1);

        // create buffer for parent pid (2+16+1 spaces to allow up to a 64 bit hex parent pid)
        char pid_buf[32];
        const char* stem = "                   ";
        const char* s = stem;
        char* d = &pid_buf[0];
        while (static_cast<bool>(*s))
        {
            *d++ = *s++;
        }
        *d-- = '\0';
        char* hexppid = d;

        // write parent pid to buffer and prefix with 0x
        int ppid = getppid();
        while (ppid != 0) {
            *hexppid = ((ppid & 0xF) + '0');
            if(*hexppid > '9') {
                *hexppid += 'a' - '0' - 10;
            }
            --hexppid;
            ppid >>= 4;
        }
        *hexppid-- = 'x';
        *hexppid = '0';

        // invoke GDB
        char name_buf[512];
        name_buf[::readlink("/proc/self/exe", &name_buf[0], 511)] = 0;
        ssize_t r = ::write(STDERR_FILENO, &BACKTRACE_START[0], sizeof(BACKTRACE_START));
        (void)r;
        ::execl("/usr/bin/gdb",
                "/usr/bin/gdb", "--batch", "-n", "-ex", "thread apply all bt full", "-ex", "quit",
                &name_buf[0], ltrim(&pid_buf[0]), nullptr);
        ::exit(1); // if GDB failed to start
    } else if (child_pid == -1) {
        ::exit(1); // if forking failed
    } else {
        // make it work for non root users
        if (0 != getuid()) {
            ::prctl(PR_SET_PTRACER, PR_SET_PTRACER_ANY, 0, 0, 0);
        }
        ::waitpid(child_pid, nullptr, 0);
        ssize_t r = ::write(STDERR_FILENO, &BACKTRACE_STOP[0], sizeof(BACKTRACE_STOP));
        (void)r;
    }
} 
```

minidump_stackwalk：

```
static bool dumpCallback(const google_breakpad::MinidumpDescriptor& descriptor, void* context, bool succeeded)
{
    int child_pid = ::fork();
    if (child_pid == 0) {
        ::dup2(open("/dev/null", O_WRONLY), 2); // ignore verbose output on stderr
        ssize_t r = ::write(STDOUT_FILENO, &MINIDUMP_STACKWALK_START[0], sizeof(MINIDUMP_STACKWALK_START));
        (void)r;
        ::execl("/usr/bin/minidump_stackwalk", "/usr/bin/minidump_stackwalk", descriptor.path(), "/usr/share/breakpad-syms", nullptr);
        ::exit(1); // if minidump_stackwalk failed to start
    } else if (child_pid == -1) {
        ::exit(1); // if forking failed
    } else {
        ::waitpid(child_pid, nullptr, 0);
        ssize_t r = ::write(STDOUT_FILENO, &MINIDUMP_STACKWALK_STOP[0], sizeof(MINIDUMP_STACKWALK_STOP));
        (void)r;
    }
    ::remove(descriptor.path()); // this is not signal safe anymore but should still work
    return succeeded;
} 
```

编辑：为了使其适用于breakpad，我还必须添加以下内容：

```
std::set_terminate([]()
{
    ssize_t r = ::write(STDERR_FILENO, EXCEPTION, sizeof(EXCEPTION));
    (void)r;
    google_breakpad::ExceptionHandler::WriteMinidump(std::string("/tmp"), dumpCallback, NULL);
    exit(1); // avoid creating a second dump by not calling std::abort
}); 
```

资料来源：[如何使用带有行号信息的 gcc 获取 C++ 的堆栈跟踪？](https://stackoverflow.com/questions/4636456/how-to-get-a-stack-trace-for-c-using-gcc-with-line-number-information)是否可以将 gdb 附加到[崩溃的进程（又名“即时”调试）](https://stackoverflow.com/questions/22509088/is-it-possible-to-attach-gdb-to-a-crashed-process-a-k-a-just-in-time-debuggin)

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2010-01-06T22:56:55.147

在 Windows 上，查看[BugTrap](http://www.codeproject.com/Articles/14618/Catch-All-Bugs-with-BugTrap)。它不再位于原始链接中，但仍可在 CodeProject 上使用。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2013-09-23T12:16:19.313

在带有 g++ 的 linux 上查看这个库

[https://sourceforge.net/projects/libcs​​dbg](https://sourceforge.net/projects/libcsdbg)

它为您完成所有工作

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2016-07-09T14:59:21.760

我有类似的问题，虽然我喜欢可移植性，但我只需要 gcc 支持。在 gcc 中，可以使用 execinfo.h 和[回溯](https://www.gnu.org/software/libc/manual/html_node/Backtraces.html)调用。为了解开函数名称，Bingmann 先生有[一段很好的代码。](https://panthema.net/2008/0901-stacktrace-demangled/)为了在异常上转储回溯，我创建了一个在构造函数中打印回溯的异常。如果我希望这适用于库中抛出的异常，则可能需要重建/链接以便使用回溯异常。

```
/******************************************
#Makefile with flags for printing backtrace with function names
# compile with symbols for backtrace
CXXFLAGS=-g
# add symbols to dynamic symbol table for backtrace
LDFLAGS=-rdynamic
turducken: turducken.cc
******************************************/

#include <cstdio>
#include <stdexcept>
#include <execinfo.h>
#include "stacktrace.h" /* https://panthema.net/2008/0901-stacktrace-demangled/ */

// simple exception that prints backtrace when constructed
class btoverflow_error: public std::overflow_error
{
    public:
    btoverflow_error( const std::string& arg ) :
        std::overflow_error( arg )
    {
        print_stacktrace();
    };
};

void chicken(void)
{
    throw btoverflow_error( "too big" );
}

void duck(void)
{
    chicken();
}

void turkey(void)
{
    duck();
}

int main( int argc, char *argv[])
{
    try
    {
        turkey();
    }
    catch( btoverflow_error e)
    {
        printf( "caught exception: %s\n", e.what() );
    }
} 
```

使用 gcc 4.8.4 编译和运行它会产生一个回溯，其中包含很好的未损坏的 C++ 函数名称：

```
stack trace:
 ./turducken : btoverflow_error::btoverflow_error(std::string const&)+0x43
 ./turducken : chicken()+0x48
 ./turducken : duck()+0x9
 ./turducken : turkey()+0x9
 ./turducken : main()+0x15
 /lib/x86_64-linux-gnu/libc.so.6 : __libc_start_main()+0xf5
 ./turducken() [0x401629] 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2014-10-23T13:09:18.940

[Poppy](https://github.com/orling/Poppy)不仅可以收集堆栈跟踪，还可以收集参数值、局部变量等 - 导致崩溃的所有内容。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2015-06-11T20:01:40.327

以下代码在引发异常后立即停止执行。您需要设置 windows_exception_handler 以及终止处理程序。我在 MinGW 32bits 中对此进行了测试。

```
void beforeCrash(void);

static const bool SET_TERMINATE = std::set_terminate(beforeCrash);

void beforeCrash() {
    __asm("int3");
}

int main(int argc, char *argv[])
{
SetUnhandledExceptionFilter(windows_exception_handler);
...
} 
```

检查 windows_exception_handler 函数的以下代码：http: [//www.codedisqus.com/0ziVPgVPUk/exception-handling-and-stacktrace-under-windows-mingwgcc.html](http://www.codedisqus.com/0ziVPgVPUk/exception-handling-and-stacktrace-under-windows-mingwgcc.html)

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2013-06-16T18:56:38.067

Cpp-tool [ex_diag](https://code.google.com/p/exception-diagnostic/) -easyweight，多平台，最少的资源使用，简单而灵活的跟踪。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2020-08-17T17:35:59.290

OSX 的一个工作示例（现在在 Catalina 10.15 上测试）。显然不能移植到 linux/windows。可能它对某人有用。

在“Mew-exception”字符串中，您可以使用 backtrace 和/或 backtrace_symbols 函数

```
#include <stdexcept>
#include <typeinfo>
#include <dlfcn.h>

extern "C" void __cxa_throw(void *thrown_object, std::type_info *tinfo, void (*dest)(void *));
static void (*__cxa_throw_orig)(void *thrown_object, std::type_info *tinfo, void (*dest)(void *));
extern "C" void luna_cxa_throw(void *thrown_object, std::type_info *tinfo, void (*dest)(void *))
{
    printf("Mew-exception you can catch your backtrace here!");
    __cxa_throw_orig(thrown_object, tinfo, dest);
}

//__attribute__ ((used))
//__attribute__ ((section ("__DATA,__interpose")))
static struct replace_pair_t {
    void *replacement, *replacee;
} replace_pair = { (void*)luna_cxa_throw, (void*)__cxa_throw };

extern "C" const struct mach_header __dso_handle;
extern "C" void dyld_dynamic_interpose(const struct mach_header*,
                               const replace_pair_t replacements[],
                               size_t count);

int fn()
{
    int a = 10; ++a;
    throw std::runtime_error("Mew!");
}

int main(int argc, const char * argv[]) {
    __cxa_throw_orig = (void (*)(void *thrown_object, std::type_info *tinfo, void (*dest)(void *)))dlsym(RTLD_DEFAULT, "__cxa_throw");

    dyld_dynamic_interpose(&__dso_handle, &replace_pair, 1);

    fn();
    return 0;
} 
```

# asp.net - 如何在其他配置元素中引用配置元素值？

> ID：691722
> 
> 赞同：2
> 
> 时间：2009-03-27T22:45:51.323
> 
> 标签：asp.net, xml, configuration

例如，我创建了一个使用数据库的提供者服务。在 web.config 中，如何将提供程序的连接字符串设置为 <ConnectionStrings> 中定义的主应用程序连接字符串？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T22:58:50.293

您可以创建一个自定义配置元素来读取主应用配置的配置。

不要以这条线为线，而是像......

```
public class ProviderConfiguration : ConfigurationSection
{
    #region Constructors
    public ProviderConfiguration () { }
    #endregion

    #region Public Properties
    [ConfigurationProperty("ProviderConnection")]
    public ProvderSettingsConfigElement ProvderConnection
    {
        get { return (ProvderSettingsConfigElement)this["ProviderConnection"]; }
    }

    #endregion
}

public class ProvderSettingsConfigElement : ConfigurationElement
{
    #region Constructors
    public ProvderSettingsConfigElement () { }

    public WebSecuritySettingsDataProviderElement(string name, string type)
    {
        ConnectionString = ConfigurationManager.Get("mainAppConnString");
    }

    #region Public Properties
    [ConfigurationProperty("connectionString")]
    public string ConnectionString{get; set;}

} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-23T20:32:07.220

[Matt](https://stackoverflow.com/questions/691722/how-do-i-reference-config-elements-values-in-other-config-elements/691757#691757)的答案几乎就在那里，并进行了一些调整。

如果您很高兴将它放在配置代码本身之外，一旦您选择了提供程序配置，您就可以直接从您的提供程序类中与主连接字符串部分交谈：

```
var provider = ConfigurationManager.GetSection("ProviderConfiguration")
                as ProdviderSettingsSection;

ConnectionString connStr = 
    WebConfigurationManager.ConnectionStrings[provider.ConnectionString]; 
```

如果您想将其全部包含在提供程序中，您需要为您的属性提供一个支持字段：

```
public class ProvderSettingsConfigElement : ConfigurationElement {
  private m_ConnectionString;

  [ConfigurationProperty("connectionString")]
  public string ConnectionString{
    // Probably want to check m_ConnectionString for IsNullOrEmpty
    get{ return WebConfigurationManager.ConnectionStrings[m_ConnectionString]; } 
    set{ m_ConnectionString = value;}
  }
} 
```

# .net - 模拟对象 - 将所有方法声明为虚拟或使用接口？

> ID：691725
> 
> 赞同：12
> 
> 时间：2009-03-27T22:47:13.707
> 
> 标签：.net, unit-testing, mocking

在 .net 中，与 Java 不同，默认情况下方法不是虚拟的。为了使用大多数模拟对象框架，您要么必须将要在模拟上使用的方法标记为“真实”对象上的虚拟方法，要么必须有一个可以模拟的接口，以便被测类将接受代替执行。

将每个方法标记为虚拟方法似乎是一种不好的形式，但为每个类定义一个接口似乎也是一种不好的形式。

最好的事情是什么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-27T22:50:45.883

如果我必须在两者之间进行选择，我会选择界面的东西。接口旨在定义合同，这基本上是模拟对象要遵守的内容。将方法标记为虚拟方法可能会产生意想不到的副作用。它会影响被模拟的实际类的设计。接口仅定义方法名称，对真实类没有影响。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-27T22:58:40.793

我的经验法则是，如果我希望有多个实现（实际的具体应用程序类或单个应用程序实现和用于单元测试的假实现），则定义接口。如果我只期望一个实现并且该类不需要伪造（大多数不需要），那么我将使用虚拟方法路由并根据需要重构为接口。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T22:49:54.387

谁说你的模拟对象必须派生自同一个类层次结构？

创建具有所需接口的简单独立类并创建该对象的实例要容易得多。

您甚至可以创建模拟类的层次结构并将其用于单元测试。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-27T22:50:48.863

最好的办法是用你的头脑。想想你的场景，如果使用 virtual 更有意义，那就这样做。但是，如果界面更适合您的任务，请执行此操作。

所以我真的认为它是在添加新功能

*   继承：使用虚方法。
*   组合：使用接口。

我敢肯定这有很多警告。因此，只需动动脑筋，做最简单的事情。

# c++ - 用于向量、双端队列和列表的 push_back

> ID：691734
> 
> 赞同：12
> 
> 时间：2009-03-27T22:52:06.673
> 
> 标签：c++, stl

我正在尝试优化 C++ 例程。该例程的主要瓶颈是对象向量的 push_back()。我尝试使用双端队列，甚至尝试使用列表。但奇怪的是（并且与理论相反）双端队列和列表实现比向量对应物运行得慢得多。

事实上，对于双端队列和列表实现，甚至 clear() 的运行速度都比矢量对应物慢得多。在这种情况下，Vector 实现似乎也是最快的，而列表实现是最慢的。

任何指针？

注意：向量 reserve() 可以加快实现速度，但由于大小未知，因此无法完成。

谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-27T23:07:39.820

预计向量比双端队列或列表更快地构建或清除；这是一个更简单的数据结构。

关于[`vector::push_back`](http://en.cppreference.com/w/cpp/container/vector/push_back)，它必须做两件事：

1.  检查向量是否足够大以容纳新项目。
2.  插入新项目。

[`operator[]`](http://en.cppreference.com/w/cpp/container/vector/operator_at)您通常可以通过简单地调整矢量大小并使用来设置项目来消除第 1 步来加快速度。

**更新：** 原始海报要求举个例子。下面的代码乘以 128 兆插入和输出

```
push_back           : 2.04s
reserve & push_back : 1.73s
resize & place      : 0.48s 
```

在旧 P4 机器上的 Debian/Lenny 上使用 g++ -O3 编译和运行时。

```
#include <iostream>
#include <time.h>
#include <vector>

int main(int,char**)
{
  const size_t n=(128<<20);

  const clock_t t0=clock();
  {
    std::vector<unsigned char> a;
    for (size_t i=0;i<n;i++) a.push_back(i);
  }
  const clock_t t1=clock();
  {
    std::vector<unsigned char> a;
    a.reserve(n);
    for (size_t i=0;i<n;i++) a.push_back(i);
  }
  const clock_t t2=clock();
  {
    std::vector<unsigned char> a;
    a.resize(n);
    for (size_t i=0;i<n;i++) a[i]=i;
  }
  const clock_t t3=clock();

  std::cout << "push_back           : " << (t1-t0)/static_cast<float>(CLOCKS_PER_SEC) << "s" << std::endl;
  std::cout << "reserve & push_back : " << (t2-t1)/static_cast<float>(CLOCKS_PER_SEC) << "s" << std::endl;
  std::cout << "resize & place      : " << (t3-t2)/static_cast<float>(CLOCKS_PER_SEC) << "s" << std::endl;

  return 0;  
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-27T23:12:22.693

如果您不知道要添加多少对象，则很难提出最佳解决方案。您所能做的就是尽量减少您知道正在发生的成本 - 在这种情况下，您的矢量正在不断调整大小。

您可以通过两种方式做到这一点；

1) 将您的操作拆分为构建和完成。在这里，您可以将列表构建成一个保证足够大的向量，并在完成后将其复制到另一个向量。

例如

```
std::vector<Foo> hugeVec;
hugeVec.reserve(1000);    // enough for 1000 foo's

// add stuff

std::vector<Foo> finalVec;
finalVec = hugeVec; 
```

2）或者，当您的向量是完整的呼叫储备时，足以容纳另一组对象；

```
if (vec.capacity() == vec.size())
  vec.reserve(vec.size() + 16);  // alloc space for 16 more objects 
```

您可以选择一个不同的容器，该容器不会导致在调整大小时复制所有元素，但您的瓶颈可能会成为新元素的单独内存分配。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-28T14:40:20.047

如果对象的副本很慢，“push_back()”可能会很慢。如果默认构造函数很快并且你有办法使用交换来避免复制，你可以有一个更快的程序。

```
void test_vector1()
{
    vector<vector<int> > vvi;
    for(size_t i=0; i<100; i++)
    {
        vector<int> vi(100000, 5);
        vvi.push_back(vi);    // copy of a large object
    }
}

void test_vector2()
{
    vector<int> vi0;
    vector<vector<int> > vvi;
    for(size_t i=0; i<100; i++)
    {
        vector<int> vi(100000, 5);
        vvi.push_back(vi0);  // copy of a small object
        vvi.back().swap(vi); // swap is fast
    }
} 
```

结果 ：

```
VS2005-debug 
* test_vector1 -> 297
* test_vector2 -> 172

VS2005-release
* test_vector1 -> 203
* test_vector2 -> 94

gcc
* test_vector1 -> 343
* test_vector2 -> 188

gcc -O2
* test_vector1 -> 250
* test_vector2 -> 156 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-27T22:56:24.293

您是推回对象本身还是指向它们的指针？与对象的大小相比，指针通常会快得多，因为它只需 4-8 个字节即可复制。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-27T23:15:07.633

如果你想让向量快，你必须要reserve() 足够的空间。这有很大的不同，因为每次种植都非常昂贵。如果你不知道，做一个很好的猜测。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-27T22:58:24.630

您需要提供有关例程行为的更多信息。

在一个地方你关心的速度`push_back()`在另一个你关心的地方`clear()`。您是否正在构建容器，做某事然后倾倒它？

您看到的结果`clear()`是因为`vector<>`只需要释放一个内存块，`deque<>`必须释放几个，并且`list<>`必须为每个元素释放一个。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-27T23:05:52.227

Deque 的结构比 vector 更复杂，两者的速度差异很大程度上取决于具体实现和实际推回的元素数量，但对于大量数据，它应该更快。clear() 可能会更慢，因为它可能会选择摆脱更复杂的底层结构。列表也是如此。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-27T23:12:11.573

关于 push_back() 很慢并且保留没有帮助，MSVC 中使用的 STL 的实现是这样的：当你第一次创建一个向量时，它会为我认为 10 个元素保留空间。从那时起，每当它变满时，它就会为向量中元素数量的 1.5 倍保留空间。所以，像 10、15、22、33、49、73、105、157 之类的......重新分配的成本很高。

即使您不知道确切的大小，reserve() 也很有用。如果需要，reserve() 不会阻止向量增长。如果您 reserve() 并且向量增长超过该大小，那么由于保留，您仍然可以改进一些事情。如果向量变得更小，好吧，也许没关系，因为通常性能在较小的尺寸下效果更好。

您需要在 RELEASE 模式下进行分析，以确定哪种策略最有效。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-29T07:40:05.070

您必须根据要使用的容器来选择容器。

相关操作是：扩展（使用`push`）、插入（可能根本不需要）、提取、删除。

在[cplusplus.com](http://www.cplusplus.com/reference/stl/)上，对每种容器类型的操作都有很好的概述。

如果操作是`push`绑定的，则向量击败所有其他向量是有道理的。deque 的好处是它分配了固定的块，因此可以更有效地使用碎片内存。

# php - lastinsertid 和 zend 框架的 postgresql 序列问题

> ID：691737
> 
> 赞同：2
> 
> 时间：2009-03-27T22:54:14.890
> 
> 标签：php, database, zend-framework, postgresql

我刚刚开始从事一个项目，我正在使用 zend 框架和 postgresql（通常使用 MySQL）但是当我在使用 Zend_Db insert 命令时尝试获取最后插入的 id 时遇到了问题。

使用该功能时，`$db->lastinsertid('users', 'userid');`我收到以下错误消息：

```
SQLSTATE[42P01]: Undefined table: 7 ERROR: relation "users_userid_seq" does not exist LINE 1: SELECT CURRVAL('users_userid_seq') ^ 
```

我检查了数据库并且序列确实存在，并且表和序列都由用于访问应用程序的同一用户拥有。

我什至尝试过`$db->lastSequenceId('users_userid_seq');` ，但仍然收到相同的错误消息。

我不确定问题出在 postgresql（我认为最有可能）还是框架上。

有没有其他人遇到过类似的问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-29T20:30:53.423

我看到你找到了答案，这只是一个印刷错误。

FWIW，我将提供以下建议作为您看到错误的另一个原因：

您需要准确拼写存储的序列名称，如果序列名称存储为小写以外的任何内容，则包括匹配大小写。

换句话说，如果序列是使用拼写“ `Users_userid_seq`，”创建的，但您将其查询为“ `users_userid_seq`，”，这不匹配，您将收到错误。

尝试在`psql`工具中列出序列：

```
postgres=# \ds 
```

这将向您显示定义的序列，以及它们存储在数据库中的拼写。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-28T00:45:08.040

检查表“users”的模式是否在 Zend_Db 会话的“search_path”中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-28T00:08:08.973

“userid”字段是“users”表中的主键？如果不是，请更改用户标识类型。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-05-19T15:17:27.933

以下代码适用于我（PostgreSQL 和 Zf）：

```
$db->insert($this->getTableName(), $data);

$id = $db->lastSequenceId($this->_sequence); 
```

替换`$this->_sequence`为您在数据库中使用的序列。

# python - python 中是否有类似于 os.path.split 的其他分隔符的方法？

> ID：691740
> 
> 赞同：0
> 
> 时间：2009-03-27T22:55:11.910
> 
> 标签：python, string

我想使用这样的东西：

```
os.path.split("C:\\a\\b\\c") 
```

有了这种输出：

('C:\a\b', 'c')

* * *

但是我希望它适用于其他分隔符，如下所示：

```
method ('a_b_c_d') 
```

有了这种输出：

（'A B C D'）

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-27T22:56:46.850

```
>>> 'a_b_c_d'.rsplit('_', 1)
['a_b_c', 'd'] 
```

> 内置函数 rsplit 的帮助：
> 
> rsplit(...) `S.rsplit([sep [,maxsplit]])`-> 字符串列表
> 
> 返回字符串 S 中的单词列表，使用 sep 作为分隔符字符串，从字符串末尾开始，一直到前面。如果给出了 maxsplit，则最多完成 maxsplit 拆分。如果 sep 未指定或为 None，则任何空白字符串都是分隔符。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T22:58:18.377

```
string.split(separator) 
```

# java - Java的哔声库？

> ID：691743
> 
> 赞同：5
> 
> 时间：2009-03-27T22:56:06.510
> 
> 标签：java, beep

在 Java 中，是否有任何函数可以以给定的频率和持续时间发出（主板）哔声？在我使用过的许多语言中，你可以；哔声可用于指示某些类型的错误，也可用于轻松生成音乐。

发出哔声的标准方法是打印 BEEP 字符（\007 或其他内容）或使用 Toolkit.beep()，这两者都不允许您指定频率和持续时间。

我正在考虑实现一个本地方法，但应该有一个库来完成这个简单的任务。我正在寻找类似的东西`SomeClass.beep(500,1000);`

我的应用程序将仅在 Windows 上受支持。

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-27T23:27:32.300

在此处查看此链接：

[http://mindprod.com/products2.html#SPEAKER](http://mindprod.com/products2.html#SPEAKER)

它包含用于实现所需功能的 Java 源代码和 DLL。它在给定的持续时间内以特定频率从内部 PC 扬声器发出各种声音。查看 Auld Lang Syne 示例：) 它使用 JNI 通过包含的 DLL 来实现这一点。

顺便说一句..我不相信使用该工具包是可靠的。它没有在我的电脑上产生输出。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-27T23:03:47.817

如果你 100% 确定你只会支持 windows，你总是可以使用[JNA调用相应的](https://github.com/twall/jna/)[os 方法](http://msdn.microsoft.com/en-us/library/ms679277(VS.85).aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2017-04-26T19:49:20.767

图书馆`algo4j`也可以这样做。

[https://github.com/ice1000/algo4j/](https://github.com/ice1000/algo4j/)

请参阅此文件：

[https://github.com/ice1000/algo4j/blob/master/src/test/kotlin/org/algo4j/win/WinAPITest.kt](https://github.com/ice1000/algo4j/blob/master/src/test/kotlin/org/algo4j/win/WinAPITest.kt)

# .net - 找不到 WCF 合同名称“IMyService”？

> ID：691746
> 
> 赞同：53
> 
> 时间：2009-03-27T22:56:39.690
> 
> 标签：.net, wcf, exception-handling

> 在服务“MyService”实施的合同列表中找不到合同名称“IMyService”。---> System.InvalidOperationException：在服务实施的合同列表中找不到合同名称“IMyService”服务“我的服务”。

这真让我抓狂。我有一个可以在我的开发机器上运行的 WCF Web 服务，但是当我将它复制到我用于测试的虚拟机时，我收到似乎表明我没有实现接口的错误，但它没有感觉，因为该服务确实可以在我的 windows xp IIS 上运行。虚拟机使用 Windows Server 2003 IIS。有任何想法吗？

这里要注意的一件事是，即使只是尝试在 Web 浏览器中作为客户端访问该服务，我也会在我的 VM 上收到此错误。

注意：我正在使用 principalPermissionMode="UseWindowsGroups"，但这在我的本地计算机上不是问题。我只是将自己添加到适当的 Windows 组中。但是我的虚拟机没有运气。

配置：

```
<configuration>
    <system.serviceModel>
        <diagnostics>
            <messageLogging logEntireMessage="false" maxSizeOfMessageToLog="2147483647" />
        </diagnostics>
        <services>
            <service behaviorConfiguration="MyServiceBehaviors" name="MyService">
                <endpoint binding="basicHttpBinding" bindingConfiguration="basicHttpBinding"
                  name="MyService" bindingName="basicHttpBinding" bindingNamespace="http://my.test.com"
                  contract="IMyService">
                </endpoint>
            </service>
        </services>
        <bindings>
            <basicHttpBinding>
                <binding name="basicHttpBinding" maxReceivedMessageSize="2147483647">
                    <readerQuotas maxStringContentLength="2147483647" />
                    <security mode="TransportCredentialOnly">
                        <transport clientCredentialType="Windows" proxyCredentialType="None" />
                    </security>
                </binding>
            </basicHttpBinding>
            <netTcpBinding>
                <binding name="WindowsClientOverTcp" maxReceivedMessageSize="2147483647">
                    <readerQuotas maxStringContentLength="2147483647" />
                </binding>
            </netTcpBinding>
            <wsHttpBinding>
                <binding name="wsHttpBinding" maxReceivedMessageSize="2147483647">
                    <readerQuotas maxDepth="32" maxStringContentLength="2147483647"
                      maxArrayLength="16384" maxBytesPerRead="4096" maxNameTableCharCount="16384" />
                </binding>
            </wsHttpBinding>
        </bindings>
        <behaviors>
            <serviceBehaviors>
                <behavior name="MyServiceBehaviors">
                    <serviceMetadata httpGetEnabled="true" />
                    <serviceAuthorization principalPermissionMode="UseWindowsGroups"
                      impersonateCallerForAllOperations="false" />
                    <serviceCredentials />
                </behavior>
            </serviceBehaviors>
        </behaviors>
    </system.serviceModel>
</configuration> 
```

* * *

## 回答 #1

> 赞同：106
> 
> 时间：2010-04-01T15:41:49.097

`[ServiceContract]`在我的情况下丢失了。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2010-03-23T04:21:33.513

@Garry（我知道有点晚了）

如果您的 ServiceContract 属性定义了 ConfigurationName，则这应该是端点中的值，而不是完全限定名称。正如OP所描述的那样，我现在遇到了这个问题，这就是我的解决方案。希望这可以帮助其他偶然发现这一点的人。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2011-02-02T00:57:57.973

这是一个稍微不常见的解决方案，适用于我的情况，但出现相同的错误：

可以使用以下属性覆盖合同命名空间：

```
[System.ServiceModel.ServiceContractAttribute([...], ConfigurationName = "IServiceSoap")]
public interface ISomeOtherServiceName 
```

这将需要：

```
<endpoint address="" binding="basicHttpBinding" contract="IServiceSoap" /> 
```

而不是通常的**(namespace).ISomeOtherServiceName**。

这可能是代码生成的结果，在我的例子中[是 WSCFBlue](http://wscfblue.codeplex.com/)

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2012-02-08T10:30:38.460

您在 service 元素中的 name 属性和 endpoint 元素中的 contract 属性不正确。它们需要是完全限定名称：

```
<service name="namespace.MyService">
      <endpoint contract="namespace.IMyService" > 
```

一旦您将值更改为应该解决您的错误的完全限定名称。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-05-18T12:41:29.897

端点上的契约属性不需要是完全限定的命名空间吗？

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-05-19T05:02:26.327

是的@Garry，你是对的。端点中的合同应该是完全限定名称

```
<endpoint binding="basicHttpBinding" bindingConfiguration="basicHttpBinding"      name="MyService" bindingName="basicHttpBinding" bindingNamespace="http://my.test.com"  contract="Namespace.IMyService"> 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2012-02-08T10:13:51.673

我有这样做的习惯...

```
<system.serviceModel>
    <services>
      <service name="Service" behaviorConfiguration="wsHttpBehaviour">
        <endpoint 
            binding="wsHttpBinding" 
            contract="IService" 
            bindingConfiguration="wsHttpBinding" 
            />
        <endpoint contract="IService" binding="mexHttpBinding" address="mex" />
      </service> 
```

我什么时候应该这样做...

```
<system.serviceModel>
    <services>
      <service name="namespace.Service" behaviorConfiguration="wsHttpBehaviour">
        <endpoint 
            binding="wsHttpBinding" 
            contract="namespace.IService" 
            bindingConfiguration="wsHttpBinding" 
            />
        <endpoint contract="namespace.IService" binding="mexHttpBinding" address="mex" />
      </service> 
```

明白我的意思...这是有史以来最愚蠢的事情（尤其是当应用程序中只有 1 或 2 个项目时），但“完全合格”的类名似乎使一切变得不同。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-18T12:27:02.233

你可以发布你的界面代码......？通常，如果您没有在接口中指定 ServiceContract 属性，则会发生这种情况......

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-08-09T23:53:47.760

我有同样的错误，但问题的根源不同。我边做边学，我首先使用 Visual Studio 中 Silverlight 模板中启用了 Silverlight 的 WCF 服务创建了一个服务。我调用了这个 TerritoryService。当您以这种方式创建服务时，web.config 将更改如下：

```
 <services>
      <service name="Services.TerritoryService">
        <endpoint address="" binding="customBinding" bindingConfiguration="Services.TerritoryService.customBinding0"
          contract="Services.TerritoryService" />
        <endpoint address="mex" binding="mexHttpBinding" contract="IMetadataExchange" />
      </service>
    </services> 
```

但是，我正在处理的示例使用 DomainServices.ie，当使用这些您从 DomainService 继承时。所以我删除了我创建的 TerritoryService，然后从 Visual Studio 的 Web 模板菜单中的模板创建了一个 DomainService 类。我继续工作，一切都编译得很好。但是当我运行它时，根据这个问题的标题，我得到了一个错误。

事实证明，当您从域服务继承时，不会在 web.config 文件中创建此类条目。它不需要它。但是，当您删除通过启用 Silverlight 的 Web 服务创建的服务时，它不会删除 web.config 文件中的条目。

因此，因为我在调用服务时将这两个服务都命名为 TerritoryService，所以 web.config 中的条目被拉动，服务器开始寻找以这种方式定义的服务，因为我已经删除了它而无法找到它。

**因此，解决方案是简单地删除上面由 Visual Studio 在配置文件中自动创建的条目存根，但在我删除服务时没有由 Visual Studio 自动删除。一旦我这样做了，问题就解决了。**

由于命名“冲突”，我花了半个小时才解决这个问题。它“看起来”非常正确，并且与许多示例一致。因此，如果您从域服务类继承，则不需要/不应该像创建 wcf 服务时那样在配置文件中有条目。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-09-15T15:29:37.637

使用 Visual Studio 2013“添加”->“服务”菜单选项为我创建了 Web 配置部分，但“端点”“合同”设置为具体类的名称而不是接口。

一旦我纠正了一切，一切都开始工作了。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-02-21T15:41:37.410

就我而言，问题是命名空间错误。高温高压

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-08-17T06:53:22.743

我的情况有两个错误：

1.  配置部分是从另一个代理项目复制的，我忘记将命名空间更改为完整路径。

2.  作为客户端，我将端点部分复制到服务节点中——客户端也是 wcf 服务。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-30T22:24:08.213

好的，这并不能真正满足我的问题，但我发现解决它的一种方法是安装 .NET 3.5。因为我的其他两个环境都有 3.0。

所以我真的没有确定为什么它会在一种环境中工作而不是在另一种环境中工作，尤其是在那个接口错误的情况下。

去搞清楚？

# sql-server - 如何判断 SQL 连接过多？

> ID：691751
> 
> 赞同：4
> 
> 时间：2009-03-27T22:57:12.280
> 
> 标签：sql-server, connection-string

我正在创建一个我想作为服务提供的网站。每个客户都有自己的数据库，每个站点需要两个数据库。如果我有 100 个活跃客户并且他们都在他们的网站上工作，我可以有 200 个不同的连接字符串。

我怎么知道有多少是太多了？我不想等到遇到问题 - 我想提前计划。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T23:13:19.930

连接的数量并不是一个特别有用的限制资源。服务器上的负载对这些连接上正在执行的操作要敏感得多。你会用这些知识做什么？达到限制后拒绝连接？你怎么知道超过这个限制会开始降低用户体验？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T23:06:11.883

你在使用 ASP.NET 吗？.NET 使用*连接池*重用 SQL 连接。真正的问题，直接打开了多少个连接：

```
select COUNT(*) 
from master.dbo.sysprocesses p
join master.dbo.sysdatabases d on p.dbID = d.dbID
where d.name = '<database>' 
```

您可以从您的 DAL 调用此语句，但我认为这不是必需的。为什么？我有使用 MSSQL 2000 的经验。它在有数百个打开的连接时很稳定。

如果您的 Web 服务是**无状态**的（我认为这是一种常见且良好的模式），您可以避免该连接问题。

使用**statefull**（我的意思是有一个永久的开放连接）服务很难计划，我认为你应该重新考虑你的设计。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T23:06:51.523

负载测试。

编写一个小的多线程控制台应用程序，打开许多您想建立的连接并自己检查一下。尝试确定每个连接将执行多少查询，并确保将其包含在测试中。运行测试时，打开 db 服务器上的性能监视器并观察 CPU 周期。弄清楚你的 CPU 周期基准是什么，当你完成这个基准时，你就有了答案。确保您测试的数据库服务器的设置与您将在生产中运行的服务器完全相同。

不要等到你有问题。您的客户不会对此感到满意。

# iphone - 为 NSURLRequest 创建一个 cookie？

> ID：691761
> 
> 赞同：24
> 
> 时间：2009-03-27T23:01:25.140
> 
> 标签：iphone, cocoa, cocoa-touch

我正在尝试通过 NSMutableURLRequest 中的 cookie 发送身份验证字符串。我正在尝试通过创建 NSHTTPCookie

```
 +(id)cookieWithProperties:(NSDictionary *)properties 
```

但是，除了用于身份验证的简单键值对之外，我在任何地方都找不到如何指定属性。当我只使用我的键值对时，返回 nil。

任何关于此的示例、文档或想法将不胜感激。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-07-02T05:30:20.227

我注意到，在我的 2.2.1 iphone 上，如果未指定 NSHTTPCookiePath，则不会创建 cookie，即使它在文档中显示为“可选”：

所以，我这样做：

```
NSDictionary *properties = [NSDictionary dictionaryWithObjectsAndKeys:
                            @"domain.com", NSHTTPCookieDomain,
                            @"/", NSHTTPCookiePath,  // IMPORTANT!
                            @"testCookies", NSHTTPCookieName,
                            @"1", NSHTTPCookieValue,
                            nil];
NSHTTPCookie *cookie = [NSHTTPCookie cookieWithProperties:properties];

NSArray* cookies = [NSArray arrayWithObjects: cookie, nil];

NSDictionary * headers = [NSHTTPCookie requestHeaderFieldsWithCookies:cookies];

[request setAllHTTPHeaderFields:headers]; 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-03-28T19:23:15.123

这是您在 cookie 中设置属性的方式：

```
 NSDictionary *properties = [NSDictionary dictionaryWithObjectsAndKeys:
                              url, NSHTTPCookieOriginURL,
                              @"testCookies", NSHTTPCookieName,
                              @"1", NSHTTPCookieValue,
                              nil];
  NSHTTPCookie *cookie = [NSHTTPCookie cookieWithProperties:properties]; 
```

在上面的示例中： `url`、`testCookies`和`1`是**值**。同样，`NSHTTPCookieOriginURL`, `NSHTTPCookieName`,`NSHTTPCookieValue`是对象的**键**，*就像键值对一样*。`NSDictionary`

 *您使用`NSDictionary`并添加到`NSHTTPCookie`.

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-07-16T03:59:11.757

我无法让它发挥作用。

然而，我得到了这个工作：

```
NSMutableURLRequest* ret = [NSMutableURLRequest requestWithURL:myURL];
[ret setValue:@"myCookie=foobar" forHTTPHeaderField:@"Cookie"];
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2011-12-15T08:55:29.583

我在 jm 的示例中发现了一个错误： NSHTTPCookiePath 应该是`@"/"`，但不是`@"\\\\"`。

```
NSDictionary *properties = [NSDictionary dictionaryWithObjectsAndKeys:
                            @"domain.com", NSHTTPCookieDomain,
                            @"/", NSHTTPCookiePath,  // IMPORTANT!
                            @"testCookies", NSHTTPCookieName,
                            @"1", NSHTTPCookieValue,
                            nil];
NSHTTPCookie *cookie = [NSHTTPCookie cookieWithProperties:properties];

NSArray* cookies = [NSArray arrayWithObjects: cookie, nil];

NSDictionary * headers = [NSHTTPCookie requestHeaderFieldsWithCookies:cookies];

[request setAllHTTPHeaderFields:headers]; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-04-18T09:50:35.537

使用时键`NSHTTPCookiePath`应存在于字典中

```
[NSHTTPCookie cookieWithProperties:dictionary] 
```

方法是否使用`NSHTTPCookieDomain`或`NSHTTPCookieOriginURL`。和价值不`NSHTTPCookiePath`应该。`@"/"``@"\\"`

# installation - 我可以将 ClickOnce 应用程序从一台 PC“移植”到另一台 PC 吗？

> ID：691764
> 
> 赞同：2
> 
> 时间：2009-03-27T23:02:52.203
> 
> 标签：installation, clickonce

我妻子的旧工作计算机上有一个 ClickOnce 部署的应用程序，她现在需要在她的新工作计算机上使用该应用程序。（它在她的旧电脑上运行良好，但她的旧电脑根本不能正常运行，因此是新电脑。）

该应用程序的源代码分发早已不复存在；它托管在很久以前离开的员工的工作站上。

该应用程序可以移动到她的新 PC 上吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-28T00:29:52.697

您是否尝试过简单地将应用程序从旧计算机复制并粘贴到新计算机？他们运行相同的操作系统吗？找到 ClickOnce 应用程序的确切位置可能有点尴尬，但当然可以。您是否还需要移动保存的数据？这可能更棘手，但使用[FileMon](http://technet.microsoft.com/en-us/sysinternals/bb896642.aspx)和/或[RegMon](http://technet.microsoft.com/en-us/sysinternals/bb896652.aspx)应该涵盖大多数基础。

# c++ - Visual Studio 非托管 C++ 智能文件资源管理器

> ID：691773
> 
> 赞同：0
> 
> 时间：2009-03-27T23:06:06.470
> 
> 标签：c++, visual-studio

我使用 Visual Studio 开发非托管 C++ 应用程序为生。

是否有足够智能的附加工具（价格不是问题）来检测我在解决方案文件夹中创建的文件夹并将它们添加到包含路径 (/I) 中？它会自动为 win32 或 x64 平台设置或调试和发布等执行此操作。

如果文件夹被删除，它也应该足够聪明以删除包含路径

当您双击解决方案资源管理器下的文件并且 Visual Studio 说由于有人移动或重命名它而无法找到该文件时，您是否有时会感到沮丧？---> 是否有一种工具可以定期扫描解决方案资源管理器中的文件并自动删除或提示用户让他们知道这些文件不再有效？

就像 John Lakos 曾经说过的那样，我也愿意为一个插件付费，它可以通过解析我的项目的 .h/.cpp 文件来自动将#include 添加到我的代码中。

Visual Studio 什么时候会有一个类似 Eclipse 的解决方案资源管理器，允许用户直接从 Visual Studio 中直接操作文件/文件夹结构？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T23:13:51.507

您*可以*从 IDE 操作文件/文件夹！只需单击解决方案资源管理器中的“显示所有文件”按钮（左起第二个，在顶部）。我最近才发现。

# c# - 将单值和双值格式化为 SimpleDB 字符串的最佳方法？

> ID：691778
> 
> 赞同：1
> 
> 时间：2009-03-27T23:07:52.080
> 
> 标签：c#, amazon-simpledb

Amazon 的 SimpleDB 将值存储为字符串，我需要存储数值以便它们仍然可以正确比较，例如：

“0001” < “0002”

我认为字节、整数和小数将相当简单，但我对处理单打和双打的最佳方式有点不确定，因为它们可以非常小或很大，并且会感谢比我更聪明的人的任何建议！

（我正在使用 C#）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T23:29:01.483

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T23:24:37.890

一种选择（如果您不要求它们是人类可读的）是首先存储指数（零填充），然后是尾数。类似 "(07:4.5) 的东西通常写成 4.5e7.

`*`微笑`*` 你要处理有符号值还是小于 1 的正浮点数？如果是这样，您还需要在括号上（例如，[] 表示正数，() 表示负数）以及尾数上进行[偏移之类的操作。](http://docs.amazonwebservices.com/AmazonSimpleDB/2007-11-07/DeveloperGuide/)

如果您希望能够用您的单打等对整数进行排序。您可能应该在进入的过程中将所有内容标准化为最大的类型（例如您的双打），而不是试图变得太棘手。

因此：

*   7 --> [100,17.0]
*   0.1 --> [099,11.0]
*   -2 --> (100,08.0)

等等。

# java - Spring验证，如何让PropertyEditor生成特定的错误消息

> ID：691790
> 
> 赞同：14
> 
> 时间：2009-03-27T23:17:36.520
> 
> 标签：java, validation, spring

我正在使用 Spring 进行表单输入和验证。表单控制器的命令包含正在编辑的模型。某些模型的属性是自定义类型。例如，Person 的社会安全号码是自定义 SSN 类型。

```
public class Person {
    public String getName() {...}
    public void setName(String name) {...}
    public SSN getSocialSecurtyNumber() {...}
    public void setSocialSecurtyNumber(SSN ssn) {...}
} 
```

并将 Person 包装在 Spring 表单编辑命令中：

```
public class EditPersonCommand {
    public Person getPerson() {...}
    public void setPerson(Person person) {...}
} 
```

由于 Spring 不知道如何将文本转换为 SSN，因此我使用表单控制器的活页夹注册了一个客户编辑器：

```
public class EditPersonController extends SimpleFormController {
    protected void initBinder(HttpServletRequest req, ServletRequestDataBinder binder) {
        super.initBinder(req, binder);
        binder.registerCustomEditor(SSN.class, "person.ssn", new SsnEditor());
    }
} 
```

而 SsnEditor 只是一个`java.beans.PropertyEditor`可以将文本转换为 SSN 对象的自定义：

```
public class SsnEditor extends PropertyEditorSupport {
    public String getAsText() {...} // converts SSN to text
    public void setAsText(String str) {
        // converts text to SSN
        // throws IllegalArgumentException for invalid text
    }
} 
```

如果`setAsText`遇到无效且无法转换为 SSN 的文本，则会抛出`IllegalArgumentException`（根据`PropertyEditor` `setAsText`的规范）。我遇到的问题是文本到对象的转换（通过`PropertyEditor.setAsText()`）发生**在**我的 Spring 验证器被调用之前。当`setAsText`throws时`IllegalArgumentException`，Spring 只显示定义在`errors.properties`. 我想要的是一个特定的错误消息，它取决于输入的 SSN 无效的确切原因。`PropertyEditor.setAsText()`将确定原因。我已经尝试在 's text 中嵌入错误原因文本`IllegalArgumentException`，但 Spring 只是将其视为一般错误。

有针对这个的解决方法吗？重复一遍，我想要的是由`PropertyEditor`Spring 表单上的错误消息生成的特定错误消息。我能想到的唯一选择是将 SSN 作为文本存储在命令中并在验证器中执行验证。文本到 SSN 对象的转换将在表单的`onSubmit`. 这是不太可取的，因为我的表单（和模型）具有许多属性，并且我不想创建和维护一个将每个模型属性都作为文本字段的命令。

以上只是一个例子，我的实际代码不是Person/SSN，所以不需要回复“为什么不将SSN存储为文本......”

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-28T02:11:26.070

您正在尝试在活页夹中进行验证。这不是活页夹的目的。绑定器应该将请求参数绑定到您的支持对象，仅此而已。属性编辑器将字符串转换为对象，反之亦然——它不是为了做任何其他事情而设计的。

换句话说，您需要考虑关注点分离——您试图将功能硬塞到一个对象中，而该对象除了将字符串转换为对象外，反之亦然。

您可能会考虑将您的 SSN 对象分解为易于绑定的多个可验证字段（字符串对象、日期等基本对象等）。这样你可以在绑定后使用验证器来验证SSN是否正确，也可以直接设置错误。使用属性编辑器，您抛出 IllegalArgumentException，Spring 将其转换为类型不匹配错误，因为它就是这样 - 字符串与预期的类型不匹配。就是这样。另一方面，验证者可以做到这一点。只要填充了 SSN 实例，就可以使用 spring 绑定标签绑定到嵌套字段 - 它必须首先使用 new() 进行初始化。例如：

```
<spring:bind path="ssn.firstNestedField">...</spring:bind> 
```

但是，如果您真的想坚持这条路径，请让您的属性编辑器保留一个错误列表 - 如果要抛出 IllegalArgumentException，请将其添加到列表中，然后抛出 IllegalArgumentException（如果需要，捕获并重新抛出）。因为您可以在与绑定相同的线程中构造属性编辑器，所以如果您简单地覆盖属性编辑器的默认行为，它将是线程安全的 - 您需要找到它用于进行绑定的钩子，并覆盖它 - 执行相同的属性编辑器您现在正在做的注册（除了使用相同的方法，以便您可以保留对编辑器的引用）然后在绑定结束时，如果您提供公共访问器，您可以通过从编辑器中检索列表来注册错误. 检索到列表后，您可以对其进行处理并相应地添加错误。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-08-19T20:47:23.437

如前所述：

> 我想要的是**由 PropertyEditor 生成的特定错误消息，**以显示 Spring 表单上的错误消息

在幕后，Spring MVC 使用 BindingErrorProcessor 策略来处理缺少的字段错误，并将**PropertyAccessException 转换为 FieldError**。因此，如果要覆盖默认的 Spring MVC BindingErrorProcessor 策略，则必须根据以下内容提供 BindingErrorProcessor 策略：

```
public class CustomBindingErrorProcessor implements DefaultBindingErrorProcessor {

    public void processMissingFieldError(String missingField, BindException errors) {
        super.processMissingFieldError(missingField, errors);
    }

    public void processPropertyAccessException(PropertyAccessException accessException, BindException errors) {
        if(accessException.getCause() instanceof IllegalArgumentException)
            errors.rejectValue(accessException.getPropertyChangeEvent().getPropertyName(), "<SOME_SPECIFIC_CODE_IF_YOU_WANT>", accessException.getCause().getMessage());
        else
            defaultSpringBindingErrorProcessor.processPropertyAccessException(accessException, errors);
    }

} 
```

为了测试，让我们执行以下操作

```
protected void initBinder(HttpServletRequest request, ServletRequestDataBinder binder) {
    binder.registerCustomEditor(SSN.class, new PropertyEditorSupport() {

        public String getAsText() {
            if(getValue() == null)
                return null;

            return ((SSN) getValue()).toString();
        }

        public void setAsText(String value) throws IllegalArgumentException {
            if(StringUtils.isBlank(value))
                return;

            boolean somethingGoesWrong = true;
            if(somethingGoesWrong)
                throw new IllegalArgumentException("Something goes wrong!");
        }

    });
} 
```

现在我们的测试类

```
public class PersonControllerTest {

    private PersonController personController;
    private MockHttpServletRequest request;

    @BeforeMethod
    public void setUp() {
        personController = new PersonController();
        personController.setCommandName("command");
        personController.setCommandClass(Person.class);
        personController.setBindingErrorProcessor(new CustomBindingErrorProcessor());

        request = new MockHttpServletRequest();
        request.setMethod("POST");
        request.addParameter("ssn", "somethingGoesWrong");
    }

    @Test
    public void done() {
        ModelAndView mav = personController.handleRequest(request, new MockHttpServletResponse());

        BindingResult bindingResult = (BindingResult) mav.getModel().get(BindingResult.MODEL_KEY_PREFIX + "command");

        FieldError fieldError = bindingResult.getFieldError("ssn");

        Assert.assertEquals(fieldError.getMessage(), "Something goes wrong!");
    }

} 
```

问候，

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-01-18T23:00:22.583

作为@Arthur Ronald 回答的后续行动，这就是我最终实现这一点的方式：

在控制器上：

```
setBindingErrorProcessor(new CustomBindingErrorProcessor()); 
```

然后是绑定错误处理器类：

```
public class CustomBindingErrorProcessor extends DefaultBindingErrorProcessor {

    public void processPropertyAccessException(PropertyAccessException accessException, 
                                               BindingResult bindingResult) {

        if(accessException.getCause() instanceof IllegalArgumentException){

            String fieldName = accessException.getPropertyChangeEvent().getPropertyName();
            String exceptionError = accessException.getCause().getMessage();

            FieldError fieldError = new FieldError(fieldName,
                                                   "BINDING_ERROR", 
                                                   fieldName + ": " + exceptionError);

            bindingResult.addError(fieldError);
        }else{
            super.processPropertyAccessException(accessException, bindingResult);
        }

    }

} 
```

因此，处理器方法的签名在此版本上采用 BindingResult 而不是 BindException。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-28T00:27:27.413

这听起来类似于我在 NumberFormatExceptions 遇到的问题，即如果在表单中输入了字符串，则无法绑定整数属性的值。表单上的错误消息是该异常的通用消息。

解决方案是将我自己的消息资源包添加到我的应用程序上下文中，并为该属性上的类型不匹配添加我自己的错误消息。也许您可以对特定字段的 IllegalArgumentExceptions 执行类似的操作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-23T10:37:58.447

我相信您可以尝试将其放在您的消息源中：

typeMismatch.person.ssn=SSN 格式错误

# c - 查找上次释放内存的位置？

> ID：691794
> 
> 赞同：4
> 
> 时间：2009-03-27T23:23:19.347
> 
> 标签：c, debugging, memory, profiler

**非常笼统：** 当发生访问冲突时，是否有一种简单的方法可以判断哪一行代码最后释放了一块内存？

**不太笼统：** 我对分析器的理解是它们会覆盖分配和释放过程。如果这是真的，他们是否会碰巧存储最后释放一段内存的代码行，以便以后由于访问冲突而崩溃时，您知道最后释放的是什么吗？

**规格：** Windows、ANSI C、使用 Visual Studio

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-27T23:34:32.500

是的！

安装[Windows 调试工具](http://www.microsoft.com/whdc/devtools/debugging/installx86.mspx#a)并使用[Application Verifier](http://www.microsoft.com/downloads/details.aspx?FamilyID=c4a25ab9-649d-4a1b-b4a7-c9d8b095df18&displaylang=en)。

1.  文件 -> 添加应用程序，选择您的 .exe
2.  在 Basics 下，选择 Memory 和 Heaps。
3.  在 ntsd (ntsd yourprogram.exe) 下运行程序的调试版本。
4.  重现错误。

现在，当您发生崩溃时，您将从 AppVerifier 的调试器中获得更多信息。使用 !avrf （可能需要很长时间才能运行（分钟）），它会尝试为您提供尽可能多的有用信息。

您都可以在内存地址上使用 dps 命令来获取所有存储的堆栈信息（分配、释放等）。

您还可以对内存地址使用 !heap 命令：

```
0:004> !heap -p -a 0x0C46CFE0 
```

这也将转储信息。

延伸阅读：

*   [高级 Windows 调试，Hewardt 和 Pravat](https://rads.stackoverflow.com/amzn/click/com/0321374460)
*   [使用 PageHeap 进行调试](http://support.microsoft.com/kb/286470)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T23:32:57.403

简短的回答：没有。

你需要的是一个调试malloc。我不再跟上 Windows，但有几个，包括[这个免费的](http://dmalloc.com/docs/5.4.3/online/dmalloc.html)。

### 更新

看起来 Visual Studio C 有一个内置版本。看[这里](http://msdn.microsoft.com/en-us/library/6ewkz86d(VS.80).aspx)

> 当应用程序与 C 运行时库的调试版本链接时，malloc 解析为 `_malloc_dbg`. 有关在调试过程中如何管理堆的详细信息，请参阅 CRT 调试堆。

...并在此处查看[_malloc_dbg](http://msdn.microsoft.com/en-us/library/faz3a37z(VS.80).aspx)。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-27T23:28:39.893

不，除非您提供自己的分配器（例如通过重载 new/delete）来存储此信息。

分析器所做的工作高度依赖于他们正在分析的内容。我不知道有任何分析器可以跟踪您正在寻找的内容。

也许如果您提供有关您的情况的更多详细信息，人们可能会建议一种替代方法来诊断您遇到的问题。

# asp.net-mvc - 第一次尝试在 NerdDinner 中的 Linq to Sql - 违反规则阻止保存

> ID：691795
> 
> 赞同：4
> 
> 时间：2009-03-27T23:23:43.870
> 
> 标签：asp.net-mvc, linq-to-sql

我正在尝试浏览 ASP.Net MVC 1.0 中的[NerdDinner](http://www.nerddinner.com/)示例章节，但遇到了一个错误。在我到需要编辑晚餐的部分之前，一切都很糟糕。从项目创建到现在（至少我能说的最好），我一直按照指南逐字进行操作。但是，当我在**NerdDinnerDataContext对象上调用****SubmitChanges**方法时，我得到一个异常，上面写着：

 **> 违反规则会阻止保存

我没有注意到我现在的代码与最终项目中的代码之间有任何区别（显然，除了一些我还没有添加的附加功能）。基本上，我现在不知道如何解决这个错误。我试图在网上寻找一些答案，但没有运气。

以下是我项目中的一些代码片段，尽管我不确定它们会有多好。

**从我的 DinnerRepository 类：**

```
 private NerdDinnerDataContext db = new NerdDinnerDataContext();
...
    public void Save()
    {
        db.SubmitChanges();
    } 
```

**来自晚餐控制器**

```
 [AcceptVerbs(HttpVerbs.Post)]
    public ActionResult Edit(int id, FormCollection formValues)
    {
        // Retrieve existing dinner
        Dinner dinner = dinnerRepository.GetDinner(id);

        // Update dinner with form posted values
        dinner.Title = Request.Form["Title"];
        dinner.Description = Request.Form["Description"];
        dinner.EventDate = DateTime.Parse(Request.Form["EventDate"]);
        dinner.Address = Request.Form["Address"];
        dinner.Country = Request.Form["Country"];
        dinner.ContactPhone = Request.Form["ContactPhone"];

        // Persist changes back to database
        dinnerRepository.Save();

        // Perform HTTP redirect to details page for the saved Dinner
        return RedirectToAction("Details", new { id = dinner.DinnerID });
    } 
```

### 我该如何解决这个问题？我怎样才能找到这些“违反规则”是什么？

这是我的第一个 SO 问题，如果不是那么好，我深表歉意。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-27T23:30:07.393

RuleViolations 是 NerdDinners 的创建者 Scott Hanselman 决定封装业务逻辑的方式。

他分出了 Linq To SQL 类并添加了一个名为 GetRuleViolations() 的函数，这是他添加所有业务规则的地方。看看那个方法，看看发生了什么。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-09T19:33:18.977

我遇到了像 atcrawford 一样的问题，但是感谢 Giovanni 我设法解决了它。首先，当我开始本教程时，我用一些随机数字填充了数据库中的电话号码。现在，当我尝试编辑现有数据时，我收到了这个“违反规则”，因为电话号码的格式不正确。因此，请查看 Dinner.cs 的 Models 文件夹：

```
public IEnumerable<RuleViolation> GetRuleViolations()
    {//if (!PhoneValidator.IsValidNumber(ContactPhone, Country))
        //    yield return new RuleViolation("Phone# does not match country", "ContactPhone");

    } 
```

您可以看到我评论了该行，因此永远不会调用 PhoneValidator 类的 IsValidNumber 方法。

或者，您可以根据 PhoneValidator 的正则表达式输入电话号码的数据

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-28T00:33:40.940

有关设置书呆子晚餐的更多信息，请务必查看 ASP.NET MVC 1.0 书籍和免费的第一章。

你提到的网站上有一个链接。又来了，[http ://tinyurl.com/aspnetmvc](http://tinyurl.com/aspnetmvc)

# java - 一种简单的方法（工具？）来比较不同格式的图像像素？

> ID：691799
> 
> 赞同：18
> 
> 时间：2009-03-27T23:25:33.130
> 
> 标签：java, image, image-processing, comparison, jpeg

好吧，我现在已经在 java 中编写了一个基本的无损 jpeg 连接器，但我想将它生成的文件与原始文件进行比较。

我只能在十六进制编辑器中比较这么多，有没有人知道一种简单的方法，基于软件或基于 Java 的（最好是软件，因为我现在不想再编码了！）我可以比较两个图像并生成“差异图” “哪里的像素不一样？

谢谢。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-31T00:31:59.110

感谢您的建议。

我首先尝试了 Gimp 方法，该方法效果很好，除非图像之间的差异非常小。我找不到“增强差异”选项来使差异明显，直方图也只能粗略表示差异。

最后，我使用了[ImageMagick](http://www.imagemagick.org/script/index.php)，这是我前段时间安装的，但我忘记了。创建差异/比较图像就像键入一样简单：

```
 compare first.jpg second.png difference.gif 
```

在命令行中。

这一切都很好地解释[了here。](http://www.imagemagick.org/Usage/compare/#difference)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-01T14:12:54.807

TortoiseIDiff 是一个免费的图像差异查看器：

[http://tortoisesvn.tigris.org/TortoiseIDiff.html](http://tortoisesvn.tigris.org/TortoiseIDiff.html)

它是 TortoiseSVN 的一部分，但可以在没有 Subversion 的情况下使用。

> 根据您的项目，并非所有受版本控制的文件都是文本文件。很可能您也会有图像，例如文档/帮助文件的屏幕截图和图表。
> 
> 对于这些文件，不可能使用通用文件比较工具，因为它们只能处理文本文件并逐行比较。这是 Tortoise Image Diff 工具 (TortoiseIDiff) 的用武之地。它可以并排显示两个图像，甚至可以将图像显示在彼此之间进行 alpha 混合。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-28T01:39:45.257

你可以做的比[Perceptual Diff](http://pdiff.sourceforge.net)差很多。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-08-19T22:46:13.300

最好的方法是使用 Pix for windows（随 DirectX SDK 提供）。支持位图、PNG 和 Jpeg...享受吧！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-28T00:03:50.467

使用像 Photoshop 或 Gimp 之类的具有多个图层的图像编辑器。创建一个图像，其中每个源图像位于一个单独的图层中。

此时，您可以通过关闭和打开顶层的可见性来直观地比较图像。

在大多数体面的编辑器中，您还可以将顶层设置为“差异”模式。现在每个图像像素的值是基础图像中像素值的绝对差。您可以使用例如直方图工具来查看图像是否相同。如果它们相同，则所有像素值都将为 0。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-28T01:11:47.057

对于这样的东西，我喜欢[`netpbm`](http://netpbm.sourceforge.net/)/[`pbmplus`](http://www.acme.com/software/pbmplus/)工具包。您可以使用`djpeg`和`pnmtoplainpnm`将每个图像转换为简单的 ASCII 格式。然后，您只需读取这两个文件并发出一个新图像，该图像显示像素不同的地方。例如，您可以计算 RGB 空间中新旧像素之间的欧几里德距离，并为零差异发出白色像素，为小差异发出浅灰色，为较大差异发出较暗的像素，等等。ASCII 格式很简单，并且在手册页上有很好的记录，所有标准查看器程序都可以直接查看它。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-28T01:54:52.710

最新版本的 Araxis Merge 将进行图像差异 ( [http://www.araxis.com/merge/topic_comparing_image_files.html](http://www.araxis.com/merge/topic_comparing_image_files.html) )。

不幸的是，它不是一个免费的应用程序，所以你是否愿意为此付费是另一回事......

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-04-14T06:55:57.560

还有一个[名为 Resemble.js 的便捷网络应用程序](https://huddle.github.io/Resemble.js/)，它可以逐个像素地分析和比较图像。根据您的喜好，图像中的不同像素（如果有）以粉红色或黄色突出显示。

# open-source - 我应该从 codeplex 为我的开源项目选择什么许可证？

> ID：691802
> 
> 赞同：40
> 
> 时间：2009-03-27T23:27:28.680
> 
> 标签：open-source, licensing, codeplex

如果我想要一个开源项目，我应该在 codeplex 上选择什么许可证？所有许可证的优缺点是什么？

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-03-27T23:58:57.373

如果您想确保修改您的程序或在您的程序之上构建（通过链接到它）的任何人都应该以与您共享您的相同的方式共享他们的更改，您应该选择**GPL**。

如果您想确保修改您的库的任何人共享他们的更改，但允许人们从专有应用程序动态链接到它，他们不会根据您与他们共享的条款与您共享源代码，您应该选择**LGPL**。

如果您想允许任何人按照他们的意愿使用您的代码，除了为您提供信用之外没有其他重大限制，您应该使用**MIT**（也称为**X11**）许可证。它简短、简单、易于理解和宽容。

如果您需要与已有许可证的现有项目集成，您可能应该只使用相同的许可证。在同一个许可证下将所有内容都放在一个项目中，对于任何想要使用它的人来说，生活都会变得更加轻松。但是如果你正在创建一个新项目，我会推荐上面列出的三个许可证之一，因为它们被广泛使用，众所周知，所以当你提到它们时人们会确切地知道你的意思，并且会使你的代码更容易集成与现有项目。还有许多其他许可证可供选择，但总的来说，它们只会使事情变得更加复杂和困难（因为它们不太为人所知，因为许可证不兼容等），而没有改进上面列出的许可证之一。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-28T00:03:28.127

这很大程度上取决于你想要什么。我将非常简要地总结一下，但我建议您更深入地阅读各种许可证。

*   GPL：如果您想共享代码，那很好，但如果有人将您的代码放入商业产品中，您将无法入睡。缺点：大量几乎无法理解的法律内容。
*   BSD/ISC/MIT：非常小的许可证，只保留版权归属。也许被使用的是商业产品。一般人都能理解。缺点：如果您关心 Apple 是否采用您的代码，那么它不适合您（Safari 中的 webkit，OSX 中的 freebsd 用户区）。
*   Apache/Mozilla：有点像 GPL，但也保护品牌名称。缺点：你不能调整并仍然用你得到的名字来称呼它。
*   上面有很多变化。缺点：没有人知道许可证的含义。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-27T23:51:34.630

许可证的选择是个人的，取决于您希望如何使用您的项目。

我建议[在 Open Source Inititive 阅读此内容。](http://www.opensource.org/)

特别是，他们有一个[页面描述按类别分组的许可证](http://www.opensource.org/licenses/category)。

* * *

以下是一些更常见的目标：

为了鼓励您的项目用于商业用途，我建议您查看[BSD](http://www.opensource.org/licenses/bsd-license.php)和[MIT](http://www.opensource.org/licenses/mit-license.php)许可证。

为了鼓励商业和非商业工作，但强制所有用户共享对您的代码的任何修改，请查看[LGPL 许可证。](http://www.opensource.org/licenses/lgpl-license.php)

如果您想强制使用您的代码的每个人共享任何修改，请查看[GPL 许可证。](http://www.opensource.org/licenses/gpl-license.php)

列出了许多其他的，每一个都有自己的显着优点和缺点......这些只是四个非常常见的选择。

# javascript - 在 GWT 中使用 SVG

> ID：691809
> 
> 赞同：15
> 
> 时间：2009-03-27T23:32:14.503
> 
> 标签：javascript, html, gwt, svg

我想知道是否可以在面板中包含 SVG 内容（或在 GWT 中可以使用的任何内容），能够以编程方式向 SVG 添加更多内容（例如添加圆或曲线），并处理鼠标事件（这将是在 SVG 或 GWT 中？）。我尝试创建一个 HTML 对象，添加以下内容：

```
<svg xmlns="http://www.w3.org/2000/svg" version="1.1">
<circle cx="50" cy="50" r="30" />
</svg> 
```

那没有用（输出中没有任何可见），但我不确定是因为我做错了还是不允许这样做。

我可以使用 Google Visualization 的 LineChart 在 GWT 中做一个简单的示例，但我想摆脱 Google Visualization 并能够自己生成 SVG 并进一步自定义它。我环顾四周，许多资源都指向使用 Canvas，但我不确定这是否是最好的路线。

我对[这里](https://developer.mozilla.org/en/SVG_In_HTML_Introduction)的例子也有点困惑。我尝试了一个简单的复制粘贴在本地尝试，但它似乎根本不起作用。但是，我能够获得另一个仅使用 HTM 的示例（嵌入 src 指向 SVG 文件）L + 单独的 SVG 文件，但我无法使用 GWT 使用 RootPanel.get(...) 访问它。

编辑：我已经阅读了有关 SVG 不能与托管浏览器一起使用的信息，并且编译它确实有效，但我不确定如何引用 SVG（我已通过 将其放入 HTML 中）。如果我可以访问它，那么大概我可以添加到它的innerHTML。我已经尝试过 RootPanel.get("hi").getElement().setInnerHTML("...") 但这似乎不起作用还是我搞砸了？ **我想目标是能够操作我以某种方式链接的 SVG 文件（无论是在 GWT 还是在 HTML 中），并能够根据用户的输入对其进行修改。**

**第二次编辑** 到目前为止，我一直在实际的 SVG 文件中编写功能。在我们的设置中，我们的 SVG 是一个嵌入式对象，我们将“文档”传递给嵌入式 SVG。将信息从嵌入对象传入和传出 HTML 是非常可行的，因为 HTML 可以访问我们的 SVG 函数，而 SVG 可以访问“文档”。

这样做有更透明的方法（Rapahel），FireBug 可以直接看到 SVG，这很好，但现在不太必要。到目前为止，我认为我看过的任何解决方案都不是 IFrame，但我可能是错的。一点警告，SVG 有时会很慢。

我想说我的问题已经解决了（有点？），但我目前没有使用 Raphael、jQuery 或 GWT，但如果我想使用 GWT，我在回答中描述的方法应该仍然有效。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-11-03T10:17:14.910

我不完全明白为什么，但是 createElementNS JavaScript 方法允许您在 html 中创建并正确格式化 xhtml。

因为资源管理器中没有等价物，GWT 没有实现 createElementNS，但您可以使用快速的本地方法：

```
private static native Element createElementNS(final String ns, 
        final String name)/*-{
    return document.createElementNS(ns, name);
}-*/; 
```

将其放入 SVGPanel 类是有意义的。

```
import com.google.gwt.user.client.Element;
import com.google.gwt.user.client.ui.ComplexPanel;

public class SVGPanel extends ComplexPanel{

    private static final String SVG_NAMESPACE = "http://www.w3.org/2000/svg";

    public SVGPanel() {
        setElement(createElementNS(SVG_NAMESPACE, "svg"));
        showcaseSVG(); //Demonstrate that SVG works! Inexplicably!
    }

    private void showcaseSVG(){
        Element svgElement = createElementNS(SVG_NAMESPACE, "circle");
        svgElement.setAttribute("cx", "50");
        svgElement.setAttribute("cy", "50");
        svgElement.setAttribute("r", "30");
        getElement().appendChild(svgElement);
    }
} 
```

当添加到您的程序中时，这应该会产生一些简单的 SVG。恭喜！你现在把它贴在 xhtml 人身上。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-04-26T13:43:14.090

哇。这个问题已经被搁置了一段时间。- 一个很棒的（确定的？）GWT SVG 库已经发布了！见[lib-gwt-svg](http://www.vectomatic.org/lib-gwt-svg)。那里没有任何东西几乎一样好。作者（Lukas Laag）反应迅速，一直在努力保持库的更新和最佳状态。上面的链接将带您到一些令人印象深刻的演示，您可以随时参与[lib-gwt-svg 论坛](http://www.vectomatic.org/lib-gwt-svg)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-02-04T14:30:08.420

我们刚刚开源了一个 GWT 小部件，它允许您将 GWT 与 Raphael 集成： [http ://code.google.com/p/raphaelgwt/](http://code.google.com/p/raphaelgwt/)

这个小部件最初是为 Hydro4GE 创建的，并在官方 GWT 博客的一篇文章中提到。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-31T12:47:17.407

您可能对 html 与 xhtml 的问题感到困惑：内联 SVG 需要被解释为 XML/XHTML，但至少对我而言，我无法说服 GWT 将 applicaton/xhtml+xml 作为内容类型。对于您想知道的本地测试：尝试将文件另存为 .xhtml 并将其加载到 Firefox - 然后它可以工作，因为在这种情况下 FF 将其解释为 XHTML。

有关背景信息，请参见[http://wiki.svg.org/Inline_SVG](http://wiki.svg.org/Inline_SVG)。

如果您找到问题的解决方案，请发布。问候， 阿克塞尔

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-07T18:57:57.297

在玩了一会儿之后，我在使用[Raphaël](http://raphaeljs.com/)（处理跨浏览器兼容性）方面取得了最大的成功，尽管我怀疑这些方面的任何东西都可以正常工作。基本上我在**JavaScript**中执行以下操作：

```
var r = Raphael("someID", WND_WIDTH, WND_HEIGHT);
// additional configuration and setup if needed.... 
```

然后我会在**GWT**中执行以下操作：

```
public native JavaScriptObject getRaphael() /*-{
  return $wnd.r;
}-*/;

// I now have access to the JavaScript object and could do the following:

public native void drawCircle(JavaScriptObject obj, int x, int y, int r) /*-{
  obj.circle(x, y, r);
}-*/; 
```

我也一直在阅读，似乎将 Raphaël 移植到 GWT（这篇[文章](http://googlewebtoolkit.blogspot.com/2008/08/getting-to-really-know-gwt-part-2.html)很好读）不仅会提高性能（根据我在 Google Groups 上阅读但目前找不到的一些帖子 - 他们提到了编译器做了很多工作）但也方便了编码和调试。

所以我实现了能够直接操作 SVG 的目标（直到我将 Raphaël 移植到 Java 或至少创建包装器）。我还没有认真研究过 Google Visualization API，但我怀疑它可能也能正常工作，但我不确定它是否足够强大以满足我的需求。

正如 Raphaël 的网站上所说，我认为我遗漏了一件重要的事情：

> 这意味着您创建的每个图形对象也是一个 DOM 对象，因此您可以附加 JavaScript 事件处理程序或稍后修改它们。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-07T19:11:01.757

如果您看不到 SVG，可能是因为您的浏览器将您的文档视为 HTML 文件而不是 XHTML 文件。尝试更改文件的扩展名（.xhtml），检查 html 格式是否正确，添加 html 'meta' 标签等。

仅供参考，还有一个用于 GWT 的 SVG 模块：http: [//gwt-widget.sourceforge.net/](http://gwt-widget.sourceforge.net/)

皮埃尔

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-04T17:38:12.977

请注意，SVG 将无法在当前 GWT Shell（托管模式）高达 1.6（含）中工作，因为：

1）在windows上，它使用IE组件

2) 在 Linux 上，它使用 Firefox 1.0 或同等的 mozilla 运行时，不支持 SVG。

编译后的代码在非 IE 浏览器中运行良好。

此外，无论浏览器中的 HTML/XHTML 是什么，它都可以工作，因为在 GWT 中您使用 createElementNS（您可以使用 JSNI 自己编写方法）。此外，您的 SVG 标签可能需要宽度/高度属性（请参阅 SVG 规范）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-14T16:57:09.080

有趣的！

我试图通过 GWT/Java 代码使用 Raphael，但我似乎无法使用你的技巧。

我的 HTML 页面中有以下块：

```
<script  type="text/javascript" language="javascript" ><br/>
     window.onload=function(){
     var rr = Raphael(20,20, 200,200);
     rr.circle(50,40,30);
     }
</script> 
```

当我在 Firefox 中编译/浏览页面时，我的页面中出现了我的圆圈，没问题。

然后我将以下本机 java 添加到我的模块入口点方法并调用它：

```
 private native JavaScriptObject returnRaphael() /*-{
            return $wnd.rr;
        }-*/; 
```

调试显示返回的对象总是`null`...

另外，我不明白为什么我不能简单地在我的 Java 代码中执行以下操作：

```
public native void createRaphael()/*-{
    Raphael("some_div", 200,200);
}-*/; 
```

GWT 一直告诉我 Raphael 不存在，但是，正如我通过 firebug 看到的那样，该库完全包含在内。这也不起作用：

```
public native void createRaphael()/*-{
    $wnd.Raphael("some_div", 200,200);
}-*/; 
```

令人惊讶的是，我设法使用它访问 draw2d (openJacob draw2d) 类和函数，`$wnd`但不是我的 Raphael 对象......一定有一些我没有得到的东西......

# java - Java中是否有空输出流？

> ID：691813
> 
> 赞同：126
> 
> 时间：2009-03-27T23:33:29.507
> 
> 标签：java, outputstream

我需要为`OutputStream`我正在使用的 API 指定一个，但我实际上并不需要输出。Java是否有`OutputStream`等价于`> /dev/null`？

* * *

## 回答 #1

> 赞同：118
> 
> 时间：2009-03-28T10:38:45.790

```
/**Writes to nowhere*/
public class NullOutputStream extends OutputStream {
  @Override
  public void write(int b) throws IOException {
  }
} 
```

* * *

## 回答 #2

> 赞同：70
> 
> 时间：2009-03-27T23:36:19.673

Java 看起来不是，但 Apache Commons IO 是。看看以下内容：

[https://commons.apache.org/proper/commons-io/javadocs/api-2.5/org/apache/commons/io/output/NullOutputStream.html](https://commons.apache.org/proper/commons-io/javadocs/api-2.5/org/apache/commons/io/output/NullOutputStream.html)

希望有帮助。

* * *

## 回答 #3

> 赞同：46
> 
> 时间：2012-05-22T18:45:10.487

还没有提到，所以我还要添加**[Guava](https://github.com/google/guava)的[ByteStreams](http://google.github.io/guava/releases/19.0/api/docs/com/google/common/io/ByteStreams.html)。[nullOutputStream()](http://google.github.io/guava/releases/19.0/api/docs/com/google/common/io/ByteStreams.html#nullOutputStream())**，因为有些人可能更喜欢 Guava 而不是 Apache Commons IO 或者已经在他们的项目中拥有它。

**注意：**如果您使用旧版本的 Guava（从 1.0 到 13.0），则需要使用[com.google.io.NullOutputStream](http://docs.guava-libraries.googlecode.com/git-history/5e074af6a526af39a4410a836517e57c72aa50bb/javadoc/com/google/common/io/NullOutputStream.html)。

* * *

## 回答 #4

> 赞同：44
> 
> 时间：2018-10-04T00:12:58.207

从 Java 11 开始，有一个静态实用程序可以完全满足您的需要，即静态工厂方法[`OutputStream.nullOutputStream()`](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/io/OutputStream.html#nullOutputStream())：

> 返回一个丢弃所有字节的新 OutputStream。返回的流最初是打开的。通过调用 close() 方法关闭流。对 close() 的后续调用无效。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2009-03-27T23:51:41.023

重新散列已经提供的答案-

Java 没有`NullOutputStream`类。但是，您可以自己滚动`OutputStream`忽略写入它的任何数据 - 换句话说`write(int b)`，`write(byte[] b)`并且`write(byte[] b, int off, int len)`将具有空的方法体。这就是 Common IO`NullOutputStream`类所做的。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2019-12-27T12:38:50.260

Java 11 添加了[OutputStream.nullOutputStream()](https://docs.oracle.com/en/java/javase/13/docs/api/java.base/java/io/OutputStream.html#nullOutputStream())

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-27T23:45:36.000

不，但它很容易实现。

请参阅此问题[“如何从代码库中删除 System.out.println”](https://stackoverflow.com/questions/572134/how-to-remove-system-out-printlns-from-codebase/572222#572222)

然后你只需要：

```
System.setOut( DevNull.out ); 
```

~~或类似的东西 ：）~~

[System.setOut（打印流）](http://docs.oracle.com/javase/7/docs/api/java/lang/System.html#setOut%28java.io.PrintStream%29)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2018-11-25T19:30:53.000

镇上来了一个新男孩，他像个魅力一样照顾这个，只需几行代码就可以了。它的**[JDK 11](https://docs.oracle.com/en/java/javase/11/)**和[nullWriter()](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/io/Writer.html#nullWriter())已经在那里引入，可以解决这个问题。这是处理相同旧问题的代码，新方法无需担心操作系统（OS）。

```
String fileContent = "Welcome to StackOverflow readers !! Here goes the question link...";
Writer writer = Writer.nullWriter();
writer.write(fileContent);
writer.close(); 
```

希望这可以帮助某人！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-09-10T17:45:39.663

我相信这就是您要寻找的东西，我也在寻找同样的东西：这是用于从标准错误重定向输出流，在 ProcessBuilder 对象中标准输出。

> 块引用

```
pb.redirectError( ProcessBuilder.Redirect.appendTo( new File( "NUL:" ) ) ); 
```

*   多姆

# mysql - 数据库设计 - 显示可用时间的最佳方式？

> ID：691815
> 
> 赞同：6
> 
> 时间：2009-03-27T23:33:39.103
> 
> 标签：mysql, database, database-design

我有兴趣查看有关营业时间的数据库设计建议。

它与 Facebook 所拥有的非常相似 -[替代文本 http://uploader.ws/upload/200903/widget.png](http://uploader.ws/upload/200903/widget.png)

我有一个企业列表，我希望用户能够为该企业输入多组可用时间。例如，

周一：9-5 开放；周二：9-12 开放；1-5; 等等。我不希望每天被限制在两组时间。理想情况下，每天 N 组小时。如果这不切实际，不超过 4... 不低于 2。

我对“最好的”（理论上的）和最实用的解决方案感兴趣。

我使用的 DBMS 是 MySQL。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-27T23:44:49.310

怎么样：

```
create table business (
  id int not null auto_increment primary key,
  name varchar(255)
);

create table open_hour_range (
  id int not null auto_increment primary key,
  business_id int,
  day_of_week tinyint, /* 0-6 */
  open_time time,
  close_time time,
  foreign key(business_id) references business(id)
); 
```

这允许您任意组合时间，包括每天多个时间。但是，从查询的角度来看，它可能有点慢，因为您需要进行大量的加入才能得出企业营业时间的列表。

此外，如果您希望能够以如下格式显示小时数：

MF 9-5 萨苏 9-12

您需要在数据库之外的代码中合并类似的范围。如果您想要这种合并，您可以将 day_of_week 更改为 start_day 和 end_day。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-28T03:55:26.883

对 Scotty Allen 模型的小调整：

business table:
id - int
business_name - string
open_hour_range table:
id - int
business_id - int //营业日的外键_of_week-
int // (位掩码) 1-127
open_time - time
close_time - time

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T23:39:06.077

使用**[Microsoft SQL Server](http://www.microsoft.com/sql/)**数据库，您可以将该数据存储为**类型化的 XML**，并且仍然能够根据该字段中的一个或多个值对数据进行排序和搜索。如果需要，请进行任何计算等。

该列中的值可能类似于以下内容：

```
<businessDays>
    <monday>
        <hours from="12" to="15" />
        <hours from="16" to="21" />
    </monday>
    <friday>
        <hours from="13" to="15" />
        <hours from="16" to="18" />
        <hours from="19" to="21" />
    </friday>
</businessDays> 
```

**类型化 XML**的参考资料：

*   [SQL Server 2005 中的类型化 XML](http://blogs.msdn.com/denisruc/)
*   [类型化 XML 与非类型化 XML 的比较](http://msdn.microsoft.com/en-us/library/ms184277.aspx)

在 SQL Server 中对**XML 数据**进行索引和查询的参考资料：

*   [SQL Server 2005 中的 XML 查询和索引](http://www.developer.com/db/article.php/3565996)
*   [SQL Server 2005 XQuery 和 XML-DML - 第 1 部分](http://www.15seconds.com/Issue/050803.htm)

在您的应用程序中，您可以将此数据**序列化/反序列化进出**业务对象。

极其简单和高效。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-28T09:33:58.660

我宁愿在列`open_time`和`close_time`. 它适用于将在晚上开始并在第二天早上结束的会议。:)

# iphone - UIViewController.... AppDelegate.... 代码去哪了！

> ID：691819
> 
> 赞同：2
> 
> 时间：2009-03-27T23:35:44.090
> 
> 标签：iphone

我正在慢慢学习 Objective-C 和 iPhoneSDK，但我在理解 MVC 模式时遇到了一些问题。

我正在充实一个游戏，我希望它会有启动画面、标题、帮助等屏幕。我目前正在做的是为每个屏幕创建一个新的 UIViewController 和一个新的 nib，这是正确的做法吗？在主 AppDelegate 中，我创建了显示视图并使用 [window addSubView:controller.view] 添加它们的方法。我发现，在 AppDelegate 中显示/隐藏代码时，我必须在加载的控制器中创建 AppDelegate 的引用才能定位隐藏代码。这似乎有点尴尬，但我想我可能是在接近这个错误，你们通常是怎么做这种事情的？

```
// example from AppDelegate
-(IBAction)showHelp:(id)sender
{
    helpScreen = [[helpController alloc] initWithNibName:@"helpView" bundle:nil];

    // send copy of self in order to target closeHelp method from InterfaceBuilder
    helpScreen.appDel = self;

    helpScreen.view.alpha = 0;
    [window addSubview:helpScreen.view];

    [UIView beginAnimations:nil context:nil];
    [UIView setAnimationDuration:1.0];
    helpScreen.view.alpha = 1.0;
    [UIView commitAnimations];
} 
```

非常感谢，

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T23:55:13.170

> > UIViewController 和每个屏幕的新笔尖，这是正确的做法吗

是的！

> > [窗口 addSubView:controller.view]

您是否还删除了动画结束时的旧视图？您应该是，否则您将同时运行多个视图控制器，这是您真正不想要的。

> 我发现，在 AppDelegate 中显示/隐藏代码时，我必须在加载的控制器中创建 AppDelegate 的引用，以便定位隐藏代码

那么在某个地方你需要负责切换视图的代码，如果视图可以控制这种切换，那么它们确实需要一种方法来触发它。而不是应用程序委托，我通常有一个 RootViewController 来执行这些更改。

我倾向于从具有用于执行这些更改的委托属性的基类派生这些视图中的每一个。当视图需要更改时，它们会调用委托中的函数。这些通常是；

*   pushView - 暂时将视图推送为活动视图，当前视图从视图层次结构中删除但不被销毁。这将用于帮助屏幕之类的东西。
*   popView - 当前视图被破坏，前一个视图被恢复。这就是帮助屏幕自行删除的方式。
*   changeView - 当前视图被销毁并替换为指定的视图。这可能是您从帮助的 page1 更改为 page2 的方式。

例如

```
// your root controller
-(void) changeView:(UIViewController) newController
{
  newController = blah blah;
  newController.delegate = self;

  // add newController view, remove old one etc
}

// new controller
-(void) userPressedHelp
{
  UIViewController* help = blah blah;
  [self.delegate pushView: newController];
}

// help controller
-(void) userPressedOk
{
  [self.delegate popView];
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T23:50:37.813

这对我来说似乎很合理。我对 Obj-C 很陌生，但这就是我完成应用程序的方式。

只要 ViewControllers 彼此不了解，我认为你做得很好。

# .net - 如何将 DataTable/DataSet 转换为 ObjectDataSource

> ID：691828
> 
> 赞同：5
> 
> 时间：2009-03-27T23:46:33.440
> 
> 标签：.net, data-binding

我有一个绑定到 ObjectDataSource 的 GridView。我有一个返回 DataTable 的方法。如何将 DataTable 提供给 ObjectDataSource 以便在代码中更新 GridView？

例子：

```
protected void Page_Load(object sender, EventArgs e) 
{
    MyClass obj = new MyClass(textbox.Text);
    DataTable dt = obj.GetData();

    ObjectDataSource1.DataSource = dt; 
} 
```

是的，我知道 ODS 没有 DataSource 属性。这就是为什么我被困住了。

如果您正在考虑，为什么不直接将 GridView 分配给 DataTable；答案是：我们喜欢 ODS + GridView 组合提供的自动排序功能。

Google 上的所有搜索都返回了如何从 ODS 获取 DT。我找不到关于如何将 DT 放入 ODS 的单一参考。这似乎是一个相当普遍的需求，因为来自 ASP.NET 1.1 的人会有很多生成 DT 的代码，如果他们想要更新 UI，他们会想要将 DT 放入 ODS。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T23:57:08.220

像这样的东西：

```
public YourDataTableName GetData()
{
 YourDataSet ds = new YourDataSet();

 //TODO:Load your data in the set

  return ds.YourDataTableName;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-03-16T09:46:32.163

尝试这个：

```
(objDtSrcUsers.Select() as DataView).Table.DataSet 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-04-29T02:45:48.603

您可以将数据包装在公共方法周围，然后在 ObjectDataSource 的构造函数中使用该方法的签名。在绑定过程中，它将调用指定的方法，您将获得数据。

看看这篇博文[http://www.superedge.net/2010/04/how-to-populate-objectdatasource.html](http://www.superedge.net/2010/04/how-to-populate-objectdatasource.html)

```
/// <summary>

    /// Gets the data table for object source.

    /// </summary>

    /// <returns></returns>

    public DataSet GetDataTableForObjectSource()

    {

        // do whatever you want to do here and 

        // return the table with the data

        return MyDataSet.MyTable;

    }

    /// <summary>

    /// Called by the ASP.NET page framework to notify server controls that use 

    /// composition-based implementation to create any child controls 

    /// they contain in preparation for posting back or rendering.

    /// </summary>

    protected override void CreateChildControls()

    {

        base.CreateChildControls();

        // in this constructor specify the type name, the class name and 

        // the public method inside this class where the object datasource will retrieve the data

        // make it a signed assembly for security reasons.

        var edgeDataSource =

            new ObjectDataSource(

                "MyNamespace.MyClass, MyNamespace.MyClasss, Version=1.0.0.0, Culture=neutral, PublicKeyToken=ce8ab85a8f42a5e8",

                "GetDataTableForObjectSource") {ID = "EdgeDataSource"};

        Grid = new SPGridView

                       {

                           AutoGenerateColumns = false,

                           AllowSorting = true,

                           AllowPaging = true,

                           AllowFiltering = true,

                           PageSize = 10

                       };

        // do not use DataSource property. MUST USE DataSourceID with the control name

        Grid.DataSourceID = "EdgeDataSource";

        // do this before the databind

        Controls.Add(edgeDataSource);

        Controls.Add(Grid);

        // bind the objects and execute the call 

        //specified in the ObjectDataSource constructor

        Grid.DataBind();

    } 
```

我希望它可以帮助干杯，-Edge

# javascript - AJAX+页面动态添加java脚本功能

> ID：691829
> 
> 赞同：1
> 
> 时间：2009-03-27T23:46:45.593
> 
> 标签：javascript, ajax

我正在使用 AJAX 调用加载页面的一部分，其中可能包含其中定义的脚本函数。它们与正在加载不同事件的控件相连。现在的问题是，当这些事件触发时，我收到错误“找不到对象”，这表明未找到/定义该函数。在使用 Firebug 时，我可以看到该函数已定义且可用。那么我如何确保浏览器可以找到相应的功能。

我试过了，但要么我错过了一些东西，要么它不起作用，这就是我正在做的事情

```
 Page
           --->Partial View A
                  ----->Partial View B 
```

现在页面加载带有 Ajax 调用的部分 A，这进一步加载带有 Ajax 调用的部分 B。部分 A 和 B 都包含很少的 Java 脚本函数，这些函数在逻辑上只与它们相关联，而不与母版页相关联。页面加载正常，除了“找不到对象”进入时无法执行功能。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-28T00:20:43.810

您应该使用以下语法定义函数：

```
myFunction = function(foo) {} 
```

不是这个语法

```
function myFunction(foo) {} 
```

当 eval()'d 时，第二种形式将不起作用（这可能是正在发生的事情）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T23:52:53.127

如果您使用的是框架或库，则必须设置一个参数才能评估 ajax 请求响应中存在的脚本。它通常被称为 evalScripts

```
evalScripts:true 
```

您还可以使用请求的回调（成功/错误）来触发事件，这样更容易将代码保存在一个位置并避免此类情况。

如果您使用的是普通的 javasciprt 和 XmlHttpObject，那么您必须手动查找响应中的所有*脚本*标签，然后对它们进行*eval()*。

# c# - 如何在运行时为 DataView 传递行索引？

> ID：691832
> 
> 赞同：0
> 
> 时间：2009-03-27T23:50:35.723
> 
> 标签：c#, .net, asp.net, .net-3.5

我有一个问题，在我的页面上我有一个 DataView 控件，我还有一个带有 CommandArgument 的按钮。我知道我可以将 DataView 读取为：

```
myDataView.Rows[i].FindControl("FaqQuestion"); 
```

我想在运行时将索引值添加到 CommantParameter，所以当我转到函数 onCommand 时，我会确切地知道从哪一行 [i] 我需要从 DataView 获取我的控件。

所以我的问题是，如何在运行时将 DataView.Rows[i] 的索引动态添加到 CommmandArgument 中的 Button ？

提前致谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-27T23:57:47.953

```
<ItemTemplate>
<%# Container.ItemIndex %>
</ItemTemplate> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-29T03:42:03.817

为按钮实现 OnDataBinding 事件。在这种情况下，将 CommandArguemnt 值分配给您想要的任何值。通常您会分配一个 ID 或其他标识符。

# bash - 用于在目录树中查找文件并将其附加到另一个文件的 Bash 脚本

> ID：691842
> 
> 赞同：0
> 
> 时间：2009-03-27T23:58:28.247
> 
> 标签：bash, scripting

标题比我试图在脚本中表达的功能要简单得多。

我有一个包含各种内容的一级深层目录树（比示例大得多），尽管我只对两个特定文件感兴趣。一个名为“current”的文件和另一个名为“revisions”的文件

```
- foo
   |
   |-> current

- bar
   |
   |-> current
   |-> revisions

- baz
   |
   |-> not-affected 
```

考虑到的脚本将从父目录触发到 foo/bar/baz ，它将执行以下操作

1.  扫描所有子目录
2.  当它找到一个包含“当前”的目录时，它会

    3.  将 'current' 的内容附加到修订版本 'cat ${pwd}/current >> ${pwd}/revisions'
3.  不包含名为“当前”的文件的目录将不受影响

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-28T00:02:04.090

如果它是一层深，这应该工作：

```
for c in */current; do cat ${c} >> ${c%%current}revisions; done 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-28T00:02:57.317

```
for i in */current; do
  cat "${i}" >> "{i%/*}/revisions"
done 
```

请注意，如果它不存在，这将创建修订。

# testing - 如何测试解释器或编译器？

> ID：691844
> 
> 赞同：13
> 
> 时间：2009-03-27T23:59:01.523
> 
> 标签：testing, compiler-construction, interpreter, brainfuck

我一直在尝试为 Brainfuck 创建一个解释器，虽然制作和启动和运行非常简单，但我的一部分希望能够针对它运行测试。我似乎无法理解一个人可能需要编写多少测试来测试所有可能的指令组合以确保实现正确。

显然，使用 Brainfuck，指令集很小，但我不禁认为，随着更多指令的添加，您的测试代码会成倍增长。无论如何，比您的典型测试更重要。

现在，在编写编译器和解释器方面，我几乎是新手，所以我的假设很可能是错误的。

基本上，你甚至从哪里开始测试这样的东西？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-28T00:55:38.437

测试编译器与测试其他类型的应用程序略有不同，因为编译器可以生成程序的不同汇编代码版本，只要它们都做正确的事情。但是，如果您只是测试解释器，它与任何其他基于文本的应用程序几乎相同。这是一个以 Unix 为中心的视图：

1.  你会想要建立一个*回归测试套件*。每个测试应该有
    *   你将解释的源代码，比如说`test001.bf`
    *   您将解释的程序的标准输入，例如`test001.0`
    *   你期望解释器在标准输出上产生什么，比如说`test001.1`
    *   你期望解释器在标准错误上产生什么，比如说`test001.2` （你关心标准错误，因为你想测试你的解释器的错误信息）
2.  您将需要一个执行以下操作的“运行测试”脚本

    ```
    function fail {
      echo "Unexpected differences on $1:"
      diff $2 $3
      exit 1
    }

    for testname
    do
      tmp1=$(tempfile)
      tmp2=$(tempfile)
      brainfuck $testname.bf < $testname.0 > $tmp1 2> $tmp2
      [ cmp -s $testname.1 $tmp1 ] || fail "stdout" $testname.1 $tmp1
      [ cmp -s $testname.2 $tmp2 ] || fail "stderr" $testname.2 $tmp2
    done 
    ```

3.  您会发现拥有一个执行类似操作的“创建测试”脚本很有帮助

    ```
    brainfuck $testname.bf < $testname.0 > $testname.1 2> $testname.2 
    ```

    只有当您完全确信解释器适用于这种情况时，您才运行此程序。

4.  您将测试套件置于源代码控制之下。

5.  修饰您的测试脚本很方便，这样您就可以省去预期为空的文件。

6.  任何时候发生任何变化，您都会重新运行所有测试。您可能还通过 cron 作业每晚重新运行它们。

7.  最后，您希望添加足够的测试来获得编译器源代码的良好*测试覆盖率*。覆盖工具的质量差异很大，但[GNU Gcov](http://gcc.gnu.org/onlinedocs/gcc/Gcov.html)是一个足够的覆盖工具。

祝你的口译员好运！如果您想查看精心制作但文档不完善的测试基础架构，请查看[Quick C-compiler](http://www.cminusminus.org/)`test2`的目录。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-28T00:12:17.497

我不认为测试编译器有什么特别之处。从某种意义上说，它几乎比测试某些程序更容易，因为编译器有这样一个基本的高级摘要——你提交源代码，它会给你返回（可能）编译的代码和（可能）一组诊断消息。

像任何复杂的软件实体一样，会有许多代码路径，但由于它们都是面向数据的（文本输入、文本和字节输出），因此编写测试很简单。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T18:54:56.620

我写了一篇关于编译器测试的文章，其最初的结论（为了发表而稍微淡化了）是： **重新发明轮子在道德上是错误的。** 除非您已经了解所有现有解决方案并且有充分的理由忽略它们，否则您应该从查看已经存在的工具开始。最容易开始的地方是[Gnu C Torture](http://gcc.gnu.org/install/test.html)，但请记住，它基于 Deja Gnu，容我们说，它有问题。（我花了六次尝试才让维护人员允许将有关 Hello World 示例 的[严重错误报告放到邮件列表中。）](http://lists.gnu.org/archive/html/bug-dejagnu/2006-02/msg00003.html)

我会不谦虚地建议您将以下内容作为工具进行调查的起点：

1.  [*软件：实践与经验*2007 年 4 月](http://www3.interscience.wiley.com/journal/114206015/abstract)。（付费软件，不向公众提供——http://pobox.com/~flash/Practical_Testing_of_C99.pdf 上的免费预[印本](http://pobox.com/~flash/Practical_Testing_of_C99.pdf)。

2.  [http://en.wikipedia.org/wiki/Compiler_correctness#Testing](http://en.wikipedia.org/wiki/Compiler_correctness#Testing)（大部分由我编写。）

3.  [编译器测试参考书目](http://pobox.com/~flash/compiler_testing_bibliography.html)（请让我知道我错过的任何更新。）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-28T00:21:25.960

在brainfuck 的情况下，我认为应该使用brainfuck 脚本对其进行测试。不过，我会测试以下内容：

1：是否所有单元格都初始化为0

2：当你减少当前指向第一个单元格的数据指针时会发生什么？它会包裹吗？它是否指向无效的内存？

3：当指向最后一个单元格时增加数据指针会发生什么？它会包裹吗？是否指向无效内存

4：输出功能是否正确

5：输入功能是否正确

6: [ ] 的东西是否正常工作

7：当你增加一个字节超过 255 次时会发生什么，它是否正确地回绕到 0，或者它是否被错误地视为整数或其他值。

也可以进行更多测试，但这可能是我要开始的地方。几年前我写了一个 BF 编译器，并且有一些额外的测试。特别是我通过在块中包含大量代码来大量测试 [ ] 东西，因为我的代码生成器的早期版本在那里存在问题（在使用 jxx 的 x86 上，当块产生超过 128 个字节左右时我遇到问题代码，导致无效的 x86 asm）。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-03-28T00:11:48.403

您可以使用一些已经编写好的应用程序进行测试。

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2010-07-08T05:52:46.497

秘诀是：

*   分离关注点
*   遵守得墨忒耳定律
*   注入你的依赖

好吧，难以测试的软件表明开发人员像 1985 年那样编写它。很抱歉，但是利用我在这里介绍的三个原则，即使是行号 BASIC 也是可单元测试的（可以将依赖项注入BASIC，因为你可以做“goto variable”。

# iphone - 在 obj-c/iPhone SDK 中，我如何获得一个调用自身的方法？

> ID：691846
> 
> 赞同：1
> 
> 时间：2009-03-27T23:59:42.270
> 
> 标签：iphone, objective-c

我有一种方法需要重复，直到满足某个条件。我正在使用如下语句：

if（不满足条件）{

再次运行此方法

} 别的 {

}

但我不知道如何“再次运行此方法”。该方法称为runAction，所以我尝试了[self runAction]，但它导致了运行时错误。

任何帮助表示赞赏。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-28T00:03:45.723

从内部调用方法是合法的，但如果调用无穷大，最终可能会导致堆栈溢出

```
- (void)runAction
{
    [self runAction]; // Stack Overflow on this line ;)
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-28T00:17:00.403

rpetrich 给了您正确的答案，但您是否考虑过使用循环代替？

```
while (condition is not met)
{
  // logic that affects condition.
} 
```

此外，如果“条件”取决于外部力量（用户输入、下载等），那么这些都不正确，您可能会导致死锁 - 这是两种情况无法完成的地方，因为它们都在等待另一个。

如果是这种情况，您应该使用每 XXX 秒左右检查一次条件的计时器。最简单的方法是使用“performSelector”函数，该函数可用于在指定时间后触发调用。

例如

```
-(void)someFunc
{
  if(!condition)
  {
    [self performSelector:@selector(someFunc) withObject:nil afterDelay:1.0];
  }
} 
```

# memory-management - 基于区域的内存管理

> ID：691861
> 
> 赞同：4
> 
> 时间：2009-03-28T00:06:03.220
> 
> 标签：memory-management, language-design

我正在设计一种高级语言，我希望它具有 C++ 的速度（它将使用 LLVM），但要像 C# 一样安全和高级。垃圾回收很慢，new/delete 不安全。我决定尝试使用“基于区域的内存管理”（网上有几篇关于它的论文，主要是针对函数式语言）。唯一使用它的“有用”语言是 Cyclone，但它也有 GC。基本上，对象是在词法堆栈上分配的，并在块关闭时被释放。对象只能引用同一区域或更高区域中的其他对象，以防止悬空引用。为了使这更灵活，我添加了可以在堆栈上上下移动的并行区域，并通过循环保留。在大多数情况下，类型系统将能够验证分配，

前任：

```
region(A) {
    Foo@A x=new Foo(); //x is deleted when this region closes.
    region(B,C) while(x.Y) {
        Bar@B n=new Bar();
        n.D=x; //OK, n is in lower region than x.
        //x.D=n; would cause error: x is in higher region than n.
        n.DoSomething();
        Bar@C m=new Bar();
        //m.D=n; would cause error: m and n are parallel.
        if(m.Y)
            retain(C); //On the next iteration, m is retained.
    }
} 
```

这看起来实用吗？我需要添加非词法范围的引用计数区域吗？我是否需要添加可以引用任何对象但检查区域删除的弱变量？您能想到任何算法很难与该系统一起使用或会泄漏吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-28T01:07:13.887

我会劝阻你不要尝试地区。问题是，为了保证区域安全，您需要一个非常复杂的类型系统——我相信您已经看过 Tofte 和 Talpin 的论文，并且您对所涉及的复杂性有所了解。即使您确实使区域成功运行，您的程序也很可能需要一个其生命周期就是程序生命周期的区域——并且该区域至少必须被垃圾收集。（这就是 Cyclone 有区域*和*GC 的原因。）

由于您才刚刚开始，我鼓励您使用垃圾收集。现代垃圾收集器可以在不费力气的情况下变得非常快。主要问题是从连续的可用空间进行分配，以便快速分配。它有助于以 AMD64 或其他具有备用寄存器的机器为目标，这样您就可以使用硬件寄存器作为分配指针。

有很多好主意可以适应；最容易实现的一种是基于页面的收集器，例如 Joel Bartlett 的主要复制收集器，其想法是您仅从完全空的页面进行分配。

如果你想研究现有的垃圾收集器，[Lua](http://www.lua.org/)有一个相当复杂的增量垃圾收集器（因此没有可见的暂停时间），实现只有 700 行。它足够快，可以在性能很重要的许多游戏中使用。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-28T01:00:07.133

如果我正在实现一种具有基于区域的内存管理的语言，我可能会阅读[A language-independent framework for region inference](http://www.diku.dk/~makholm/thesis.ps)。也就是说，我已经有一段时间没有研究这些东西了，如果我知道最先进的技术是什么的话，我相信最先进的技术已经发展了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-28T01:00:41.250

那么你应该去研究苹果的内存管理。它有发布池和区域，这听起来很像你在这里所做的。

我不会评论“GC很慢”的评论，

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-02-17T19:35:03.263

您可以从 Tofte 和 Talpin 关于基于区域的内存管理的论文开始。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-03-28T00:30:49.497

它将如何返回一个动态创建的对象？谁将“拥有”它并负责释放内存？

Refcounting 或 GC 如此普遍，因为它们几乎总是最好的选择。分代垃圾收集器可能非常有效。

# flash - 使用 Flash + AS3 发布/调试配置

> ID：691868
> 
> 赞同：7
> 
> 时间：2009-03-28T00:10:14.413
> 
> 标签：flash, actionscript-3, debugging, release

我最近在一些 Flash 编码中遇到了一个令人尴尬的情况，我不得不不小心向客户端发送了一个构建，其中并非所有调试标志和变量都未设置。（它正在向调试而不是发布服务器等发送请求......）

部分原因是我糟糕的代码组织；我已经解决了。

但是，Flash 似乎不允许设置不同的构建配置，并且 Actionscript Compile 设置托管了各种开关，这些开关以一种忘记选中/取消选中某些内容的方式排列（天哪，我忘了禁用调试器支持！）可能就像发生在我身上一样。无论如何，我发现在我的发布配置和调试配置之间手动跳转很容易搞砸。

那么，其他开发人员，您使用什么技术在您的测试配置和您发布给您的老板/客户/任何人的构建配置之间进行防错跳转？

我知道我可能应该放慢速度，但我更喜欢设置一些我可以拨动开关的地方。经过长时间的中断（Flash MX + 2004 年），我才重新回到 Flash。

哦，我知道禁用调试支持和设置导入密码以及所有这些都是徒劳的，我的目标是简单地将脚本小子排除在我的项目之外。反编译器胜过这一切......

无论如何，谢谢！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-28T16:28:28.913

如果您使用的是 Flash CS4，则可以使用配置常量。您可以在发布设置|ActionScript3.0 设置...|配置常量下找到它们

如果您添加了 DEBUG::PLAYER 那么您可以使用如下代码：

```
config namespace DEBUG;

//... code here ...

DEBUG::PLAYER
{
    trace("Player state here");
} 
```

现在您可以在真假之间切换常量。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-28T01:00:23.963

我使用环境类，如下所示：

```
public class MyEnvironment {
  public static const DEBUG:Boolean = true;
  public static const SERVER:String = 'localhost';
  // More here
} 
```

将此导入到您的主 ActionScript 类中，并确保您的所有辅助函数都引用它。例如，您的调试器函数应该仅在`MyEnvironment.DEBUG`为 true 时运行，并且您的网络函数应该将请求发送到`MyEnvironment.SERVER`.

在我的设置中，我会将其保存为`MyEnvironment.as`. （显然，类名在现实生活中会有所不同。）我还将副本另存为`MyEnvironment.as-debug`and `MyEnvironment.as-release`; 后者会有不同的设置。然后，如果我需要发布版本，我的构建脚本将复制`MyEnvironment.as-release`到`MyEnvironment.as`（覆盖原始版本）并重新编译。这会将我的所有发布设置加载到我的主要 ActionScript 类中；如果我为调试构建运行脚本，则相反。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-28T08:44:12.507

一个好主意是在调试模式下使用视觉提示。设置 DEBUG 标志后，在屏幕的一个角落显示一个带有“调试模式”和版本号或类似内容的 TextField。

当您在将其发送给客户端之前进行最终测试时，您会发现您忘记禁用调试模式。

这当然取决于您如何构建项目。如另一个答案中所述，最好将标志存储在可通过整个应用程序访问的高级“全局”类中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-06T08:00:13.067

我使用了一个名为“TestingEnvironment”的 flashvar。在应用程序启动时，我检查 loaderInfo.parameters 以查看它是否设置为“true”（字符串文字，而不是布尔值），如果是，我将全局 Environment 类实例上的 public static var debugMode 设置为 true。然后我所有的班级都可以看到我们处于测试环境中，并会采取相应的行动。

此外，由于我使用不同的页面代码来嵌入测试和生产，我希望 flashvar 永远不会在生产页面嵌入中结束。如果是这样，它很容易关闭，无需重新编译。

# mysql - ColdFusion URL 属性返回按钮名称而不是必填字段 (ID)

> ID：691869
> 
> 赞同：1
> 
> 时间：2009-03-28T00:10:48.950
> 
> 标签：mysql, coldfusion

我正在尝试创建一个页面，让用户在登录后删除图像。单击按钮时，我通过 URL 传递图像 ID。问题是它确实捕获了图像 ID，但是当我单击删除时，它会将按钮的值传递给 URL，而不是图像 ID。它看起来`user_acc_images.cfm?delete=Delete`而不是`user_acc_images.cfm?uploaded_image_id=1`在浏览器中。

这是我的代码：

```
<cfif isdefined("session.username")>
<cfoutput><h3 class="uname">Hello #session.username# </h3></cfoutput></cfif>

<h2>Your Uploaded Images</h2> 
<p>On this page you can view the list of all the images you uploaded.You can also delete some of your photographs if you wish.</p>  
    <table cellspacing="25">     
    <cfif isDefined("session.username")>
    <cfinvoke component="cfc.user_acc_images" method="viewimages" returnvariable="vimages">
        <cfoutput query="vimages">
           <tr>
           <cfform name="formurl" action="http://www.humbermedia3.ca/portfolio0809/farnauz/AcePhotographyMain/user_acc_images.cfm?uploaded_photo_id=#uploaded_photo_id#" method="get"> 
            <td align="left">
                <img src="#uploaded_photo_name#" name="photo_name" width="200" height="200"/>
                </td></tr><tr><td>
                <b>Uploaded on: </b>#upload_date# <br/><br/>
                <!---<button type="submit" name="delete" value="Delete" class="button" >--->
                <input type="submit" name="delete" value="Delete" class="button" />
                <br/><br /><hr/>
            </td> 
            </tr></cfform>
          </cfoutput> 
    </table>

<cfelse>
    <cfoutput> 
         <h3>Sorry you cannot access this page.<h3>
            <p>
                You have to be logged in to view your uploaded images.<br/><br/>
                Click<a href="login.cfm"> here </a>to log in.<br/>
                Dont have an account? Click<a href="register.cfm"> here </a>to create a new account.
            </p>
    </cfoutput>
</cfif>

<cfif isDefined("form.delete")>
    <cfinvoke component="cfc.user_acc_images" method="deleteimage" returnvariable="dimage">
    <cfinvokeargument name="url" value="#URL.uploaded_photo_id#">
    <cfoutput>#URL.uploaded_photo_id#</cfoutput>
</cfif> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-28T00:15:48.797

删除`?uploaded_photo_id=#uploaded_photo_id#`表单中 URL 字符串的一部分，并添加一个隐藏的输入，如下所示：

```
<input type='hidden' name='uploaded_photo_id' value='#uploaded_photo_id#'> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-28T00:24:16.237

Paolo 是对的，但我还要补充一点，您遇到此问题的原因是因为当您执行表单 GET 时，操作 url 中的任何 url 变量都不会传递。他的解决方案是最好的，但您也可以将其更改为表单帖子，然后您通过 action 属性传递的 url 变量*将*被传递。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-28T01:53:06.520

将方法=“get”更改为方法=“post”

# php - 为什么浏览器不在 AJAX 请求中缓存 301？

> ID：691877
> 
> 赞同：1
> 
> 时间：2009-03-28T00:14:20.393
> 
> 标签：php, apache, http-headers

这是 XMLHttpRequest：

```
$.ajax({
    method: "get",
    url: "getPage.php",
    data: $data,
    dataType: 'json',
    timeout: 2000,
    success: function(result) {
        handleContent(result);
        }
    }); 
```

这是 getPage.php?data=data

```
header("Expires: " . gmdate("D, d M Y H:i:s", time() + $offset) . " GMT");
header("Cache-Control: max-age=" . $offset . ", public");
header("HTTP/1.1 301 Moved Permanently");
header("Location: $location); 
```

这是$位置：

```
header("Expires: " . gmdate("D, d M Y H:i:s", time() + $offset) . " GMT");
header("Cache-Control: max-age=" . $offset . ", public");
print $print; 
```

客户端浏览器正确缓存 $location。但是它不会在 getPage.php?data=data 中缓存重定向

每次调用 ajax 请求时，它都会请求 GET getPage.php?data=data。

我希望它自动 GET $location 代替（或者尝试 GET $location 并从缓存中获取页面）。

这不是 301 永久重定向的用途吗？创建一个由浏览器缓存的重定向（当然还有一些代理、搜索引擎等）？

请不要质疑我为什么选择这样做。我有这个原因，我不打算在这里讨论。我想要的只是一个答案，也可能是一个解决方案，它可以让 301 重定向被缓存，导致在第一次请求之后根本没有 GET 请求。

提前致谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-28T01:08:52.617

**编辑**：现在（2013 年 11 月）大多数浏览器都进行缓存重定向，请参阅[Browserscope](http://www.browserscope.org/?category=network&v=top)（“缓存重定向”测试），但在提出问题时他们没有。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-28T00:40:15.073

该线程及其评论包含处理这个确切问题的方法，尽管针对该问题提出的解决方案仍然有点“脆弱”（主要是因为目前的浏览器实现）：

[如何在 jQuery Ajax 调用后管理重定向请求](https://stackoverflow.com/questions/199099/how-to-manage-a-redirect-request-after-a-jquery-ajax-call)

我希望你能从中受益。

# .net - 确定 ASP.NET 应用程序是否在本地运行

> ID：691881
> 
> 赞同：80
> 
> 时间：2009-03-28T00:18:09.307
> 
> 标签：.net, asp.net, localhost

我想知道是否有推荐的方法来确定 asp 应用程序是否在本地运行。目前，我使用 Request 对象并在服务器变量上对 localhost 或 127.0.0.1 进行字符串搜索，但这有几个限制。最大的问题是 Request 对象在我需要时并不总是可用的。

* * *

## 回答 #1

> 赞同：149
> 
> 时间：2009-03-28T00:20:20.347

请参阅[HttpRequest.IsLocal](http://msdn.microsoft.com/en-us/library/system.web.httprequest.islocal.aspx)

```
bool isLocal = HttpContext.Current.Request.IsLocal; 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-03-28T00:19:47.150

您可以检查 Request.IsLocal 属性

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2017-06-19T15:34:53.183

这对我有用 Application_Start

```
if (!HostingEnvironment.IsDevelopmentEnvironment)
{
      GlobalFilters.Filters.Add(new RequireHttpsAttribute());
} 
```

要了解更多关于 IsDevelopmentEnvironment 是如何设置的，请查看以下线程。

[在 ASP.NET 中，什么决定了 HostingEnvironment.IsDevelopmentEnvironment 的值？](https://stackoverflow.com/questions/18135304/in-asp-net-what-determines-the-value-of-hostingenvironment-isdevelopmentenviron)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2018-01-25T17:49:58.217

在 MVC 视图/ASP 页面/类后面的代码中：

```
bool isLocal = HttpContext.Current.Request.IsLocal; 
```

在 MVC 控制器中：

```
bool isLocal = Request.IsLocal; 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2020-04-16T17:46:42.863

回应@Meh Men 对该线程中其他答案的评论，他问：

> Request 为空的地方呢？即：Application_start？

如果您确定您的网站的生产和测试或“同源”版本都将与您的网站的发布版本一起部署，而您的本地环境将以“调试”模式构建和开发，您可以使用`#if DEBUG`sintax编写只应在本地运行的代码，而在此块之外，甚至在匹配的`#else`块内，您可能会编写一些您希望仅在非本地运行的其他代码（例如：远程）。

这是我在当前正在处理的特定项目中如何解决此问题的一个小示例：

```
#if DEBUG
    // Code here will only be run locally.
#else
    // Code here will only be run "remotely". 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-09-16T15:31:07.813

Request.IsLocal 与检查 127.0.0.1 或 ::1 相同。见这篇文章：[http](http://forums.asp.net/p/1065813/4081335.aspx) ://forums.asp.net/p/1065813/4081335.aspx 。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-04-25T20:35:47.253

如果 HttpContext.Current 不为空，请使用

```
HttpContext.Current.Request.IsLocal 
```

否则，例如在 App_Start 或 HttpContext.Current 可用之前，您可以测试

```
HostingEnvironment.ApplicationPhysicalPath.StartsWith(@"C:\") 
```

或 PC 上的专用磁盘。

另一种方法是在生产环境中使用常量编译变量集，例如来自 Azure 和 visualstudio.com（如果您使用它们）。

它很脏，但它有效。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-28T01:08:59.840

请求在 ASP.NET 环境中并不总是可用？

一旦服务器开始处理页面，HttpContext 及其属性 Request/Response 就会被初始化。因此，您可以在页面生命周期中的任何地方执行 c# 代码，您应该能够检查请求 url。

# c# - C# 3.0 ElementAt 是否因迭代器函数而损坏？

> ID：691889
> 
> 赞同：1
> 
> 时间：2009-03-28T00:21:28.410
> 
> 标签：c#, linq, streamreader

谁能告诉我为什么下面的代码不能按我期望的方式工作？我正在尝试围绕 StreamReader 编写一个 IEnumberable 包装器，但是当我在其上使用 ElementAt 时，它会从流中读取顺序字符，而不管我传递给 ElementAt 的索引如何。

文件“test.txt”包含“abcdefghijklmnopqrstuvwxyz”。我希望输出是：

> 啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊 啊啊
> 啊啊

相反，我得到

> abcdefghijklmnopqrstuvwxyz

并且 ArgumentOutOfRangeException 被调用，即使到目前为止我传递给 ElementAt 的唯一索引是 0。

MSDN 说：

> 如果源的类型实现 IList<(Of <(T>)>)，则该实现用于获取指定索引处的元素。否则，此方法获取指定元素。

应该读作“获得*下一个*元素”吗？如果是这样，那有点违背了惰性列表的目的......

```
 static IEnumerable<char> StreamOfChars(StreamReader sr)
    {
        while (!sr.EndOfStream)
            yield return (char)sr.Read();
    }

    static void Main(string[] args)
    {
        using (StreamReader sr = new StreamReader("test.txt"))
        {
            IEnumerable<char> iec = StreamOfChars(sr);

            for (int i = 0; i < 26; ++i)
            {
                for (int j = 0; j < 27; ++j)
                {
                    char ch = iec.ElementAt(i);
                    Console.Write(ch);
                }
                Console.WriteLine();
            }
        }
    } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-28T00:24:41.803

是的，MSDN 文档应该是“获取下一个元素”。显然，您的`iec`对象没有实现[IList](http://msdn.microsoft.com/en-us/library/5y536ey6.aspx)并且*仅*实现[IEnumerable](http://msdn.microsoft.com/en-us/library/9eekhta0.aspx)，因此不可能进行随机读取（当然没有扩展方法或使用枚举器到达随机索引的东西）。只进读是唯一可用的选项。

让我们看一下 ElementAt 方法的反汇编代码。显然，如果源集合没有实现 IList，我们在枚举器中检索当前项：

```
public static TSource ElementAt<TSource>(this IEnumerable<TSource> source, int index)
{
    TSource current;
    if (source == null)
    {
        throw Error.ArgumentNull("source");
    }
    IList<TSource> list = source as IList<TSource>;
    if (list != null)
    {
        return list[index];
    }
    if (index < 0)
    {
        throw Error.ArgumentOutOfRange("index");
    }
    using (IEnumerator<TSource> enumerator = source.GetEnumerator())
    {
    Label_0036:
        if (!enumerator.MoveNext())
        {
            throw Error.ArgumentOutOfRange("index");
        }
        if (index == 0)
        {
            current = enumerator.Current;
        }
        else
        {
            index--;
            goto Label_0036;
        }
    }
    return current;
} 
```

# java - 在 NetBeans GUI 设计器中重用 JPanel

> ID：691890
> 
> 赞同：9
> 
> 时间：2009-03-28T00:22:44.460
> 
> 标签：java, netbeans, reusability, gui-designer

这是在 NetBeans 6.5、Java 6 中。

我在 NetBeans GUI 设计器中有以下层次结构：

```
JFrame
  JTabbedPane
    JPanel X
      <...>
    JPanel
      JButton
      JPanel Y
        <...>
      JButton 
```

## 问题：

JPanel Y 与 JPanel X 相同，所以我想在两个地方简单地重用 JPanel X，但是如何在 GUI Builder 中执行此操作？

## 尝试：

我尝试复制粘贴 JPanel X，但它创建了一个完整的“深层”副本（JPanel X1 等），复制了 JPanel X 中的所有内容。

一些谷歌搜索表明可以将它添加到调色板，但我还没有找到一种方法将简单的 JPanel 添加到调色板（而不是完整的 JFrame）。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-03-28T02:26:48.763

创建一个单独的 JPanel 类。根据需要自定义 JPanel。然后，您可以将 JPanel 类拖放到表单设计器上。这正是我所做的。

或者，您可以单击使用 Bean，然后输入类的名称。

或者，您可以从托盘中添加，它会扫描您的 JAR 中的任何“bean”。它也应该选择您的自定义 JPanel。

# iphone - 是否有相当于 MAC_OS_X_VERSION_MIN_REQUIRED 的 iPhone？

> ID：691904
> 
> 赞同：8
> 
> 时间：2009-03-28T00:31:49.820
> 
> 标签：iphone, cocoa, cocoa-touch, xcode

我想有条件地包含 iPhone 应用程序的代码，具体取决于我正在编译的 SDK 版本。在 Mac OS X 上，有一个`MAC_OS_X_VERSION_MIN_REQUIRED`预处理器宏，它被`MACOSX_DEPLOYMENT_TARGET`编译器设置为构建设置的值。iPhone上有类似的吗？

### 更新：

我`IPHONE_DEPLOYMENT_TARGET`在构建设置中设置为 3.0，但 Xcode 正在传递`-D__IPHONE_OS_VERSION_MIN_REQUIRED=20000`并传递`-mmacosx-version-min=10.5`给 GCC。不应该是第一个`30000`和第二个`-miphoneos-version-min=3.0`吗？我究竟做错了什么？

### 更新 2：

看来我没有做错什么。 `__IPHONE_OS_VERSION_MIN_REQUIRED`并且`-miphoneos-version-min`在为设备构建时都设置正确——只有在使用 iPhone Simulator SDK 时才会出错。我认为这是模拟器 SDK 中的错误。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-28T05:09:44.020

见可用性.h

```
 #if __IPHONE_OS_VERSION_MIN_REQUIRED >= __IPHONE_2_0 
```

等等

[http://developer.apple.com/iphone/library/documentation/DeveloperTools/Reference/XcodeBuildSettingRef/1-Build_Setting_Reference/build_setting_ref.html#//apple_ref/doc/uid/TP40003931-CH3-SW156](http://developer.apple.com/iphone/library/documentation/DeveloperTools/Reference/XcodeBuildSettingRef/1-Build_Setting_Reference/build_setting_ref.html#//apple_ref/doc/uid/TP40003931-CH3-SW156)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-28T01:17:31.117

为每个版本的操作系统定义了预处理器宏。例如，如果`__IPHONE_OS_3_0`定义了，那么您正在针对 3.0 SDK 构建（或者可能稍后，我不确定）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-28T01:04:46.107

对于它的价值，如果不存在这样的宏，一个体面的解决方法是创建 2 个构建目标，并在其中一个中添加`GCC_PREPROCESSOR_DEFINITIONS`具有类似`IPHONE_OS_3`. 然后在您的代码中，您可以执行以下操作：

```
#ifdef IPHONE_OS_3
    [foo thisMethodIsUnderNDA];
#else
    [foo oldSchoolMethod];
#endif 
```

# css - CSS孤儿检测器？

> ID：691908
> 
> 赞同：4
> 
> 时间：2009-03-28T00:34:47.333
> 
> 标签：css

我想知道是否有人知道可以帮助我在我的网站中识别过时的 css（从未使用过的声明样式）的工具。谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-28T00:40:48.723

请参阅SO 上的[CSS 清洁器。](https://stackoverflow.com/questions/285442/css-cleaner)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-28T00:50:44.690

由于可以使用脚本添加样式表，并且可以使用脚本创建元素和类，因此如果在那些字面上链接到这些样式表的页面的 html 中找不到 css 类和 id 声明，则删除它们可能会有风险。

也就是说，perl 对于任何类型的站点范围内的搜索和替换操作都是一个很好的工具。

# ruby-on-rails - Rails Restful-Authentication 插件无法登录

> ID：691910
> 
> 赞同：0
> 
> 时间：2009-03-28T00:35:40.310
> 
> 标签：ruby-on-rails, restful-authentication

我的***Restful-Authentication***插件的全新安装失败并显示以下消息。

```
undefined method `acts_as_state_machine' for #Class:0x46edaf8 
```

关于如何解决这个问题的任何想法？

注意：安装了***act_as_state_machine***插件

注意：restful-authentication 插件是使用以下命令安装的

```
script/generate authenticated user sessions --include-activation --stateful 
```

谢谢

H

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-28T01:45:15.557

代码没有任何问题。我只需要重新启动服务器。此外，我发现一篇很棒的博客文章提供了可用于扩展 vanilla restful-authentication 插件的信息。 [Restful 身份验证（第 3 部分，共 3 部分）](http://railsonedge.blogspot.com/2008/03/rails-forum-restful-authenticationpart.html)

# ruby-on-rails - 使用 rails 选项的服务器推送

> ID：691916
> 
> 赞同：4
> 
> 时间：2009-03-28T00:49:03.180
> 
> 标签：ruby-on-rails, server-push, orbited

我正在尝试构建一个需要“服务器推送”功能的 rails 应用程序，即 Comet 。

我开始寻找我找到的三个选项并尝试了其中一个：

1.  Juggernaut：我试过了，但并不完全满意/舒适，Opera 和 Flash 10 可能存在一些浏览器问题（我已经尝试了大约一个小时，所以..所以我的判断可能并不完全正确）。

2.  轨道的

3.  流星

    2 和 3 都是基于 Comet 的，而 Juggernaut 使用 Flash xmlsocket 等进行服务器推送。

使用哪一个或基本上应该是什么标准我应该判断这些选项..双方的人都说他们更好..这令人困惑......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T12:48:23.877

决定您要使用哪些技术的基本标准是您要支持什么技术以及兼容性需要有多好。

我个人更喜欢剑圣，因为它使用起来非常简单，而且闪存设备比彗星更容易保持连接并且更稳定。但是，闪存要求确实会导致轻微的兼容性问题（您提到的 Opera）。

我已经很久没有看到《Shooting Star》的任何发展了，所以我想说这可能不是一个好的选择。

如果你在围栏上，你一定要试试 Orbited。它实际上是用 python 编写的，但它非常强大并且支持许多不同的协议。他们有一些很好的文档，很容易设置，而且我发现它非常可靠。

# oracle - 如何在多线程应用程序中处理 MS Access 事务，以及如何同步 MS Access 和 Oracle 表？

> ID：691917
> 
> 赞同：1
> 
> 时间：2009-03-28T00:50:18.670
> 
> 标签：oracle, delphi, ms-access

我正在一个项目中使用本地数据库编写程序。

我们使用 Delphi、MS Access 和 Oracle。

问题是：

1.  插入和更新 MS Access DB 需要几个线程。我现在还没有测试它，我知道访问在这里有一个多线程问题。我是否需要使用锁或将 MS Access DB 操作放入线程中？
2.  出于性能考虑，我们需要将同一张表从 Oracle 移动到 MS Access。（我个人并不建议这样做，但我不是项目经理）。我们仍然需要将数据从 MS Access 同步到 Oracle 一段时间（可能是几天）。我必须做很多工作，有没有简单的方法（我们使用 BDE）？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-28T22:38:48.790

**问题 #1**
我会考虑将 MS Access 部分迁移到 MS SQL（Oracle 也是可能的，但我不确定与此相关的问题）。这将处理 MS Access 的许多多线程/多用户问题。

我在将其他 MS Access 应用程序转换为 MS SQL 时遇到了一些问题（前端保留在 MS Access 中，并且表通过 ODBC 链接到 MS SQL DB）。所以它的痛苦很小，而且你也得到了速度/可靠性。

**问题 #2**
如果有某种技术迫使您使用 MS Access，最简单的做法就是通过 MS Access 创建到 Oracle 表的 ODBC 链接。这样你只更新一个地方。我也质疑将表从 Oracle 移动到 MS Access 的决定。1) 我从一开始就更信任 Oracle DB，2) 不知道 MS Access/Jet 的性能优于 Oracle。为 Oracle 服务器增加更多内存；给它一个更快的处理器；等等

无论如何，你最紧的瓶颈不会是数据库。它将成为您的网络。因此，您将问题从一台服务器转移到另一台服务器，并且由于必须将 MS Access 表与 Oracle 表同步，从而增加了网络拥塞。

# c# - 如何将这两种方法重构为 1？

> ID：691921
> 
> 赞同：2
> 
> 时间：2009-03-28T00:53:59.690
> 
> 标签：c#, asp.net, entity-framework, .net-3.5, refactoring

我正在尝试重构一些实体框架代码，其中我有一个产品实体和产品系列、系列、品牌等的相关实体。系列、系列和品牌实体都具有相同的基本结构，具有 Id 和 Text 属性。

下面的两种方法非常相似，应该可以重构为一个方法，但我不确定如何动态传递我正在查询的实体。在这种情况下，我需要能够传入 db.ProductFamilies 或 db.ProductSeriesSet。任何想法如何使这 2 变为 1？

谢谢！

```
 public DTOs.ProductCollection GetFamily(int id)
    {
        using (Entities db = new Entities())
        {
            var fam = (from collection in db.ProductFamilies.Include("Product")
                        .Include("Product.Stuff1")
                        .Include("Product.Stuff2")
                       where collection.Id == id
                       select collection).FirstOrDefault();
            return ProductCollectionEFToProductCollectionDTO(fam, true);
        }
    }

    public DTOs.ProductCollection GetSeries(int id)
    {
        using (Entities db = new Entities())
        {
            var ser = (from collection in db.ProductSeriesSet.Include("Product")
                        .Include("Product.Stuff1")
                        .Include("Product.Stuff2")
                       where collection.Id == id
                       select collection).FirstOrDefault();
            return ProductCollectionEFToProductCollectionDTO(ser, true);
        }
    } 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-28T01:03:46.843

您可以使用 a`Func<T, TResult>`将好的实体集合的选择委托给调用者：

```
public DTOs.ProductCollection Get(int id, Func<Entities, XXX> selector)
{
    using (Entities db = new Entities())
    {
        var result = (from collection in selector(db).Include("Product")
                    .Include("Product.Stuff1")
                    .Include("Product.Stuff2")
                   where collection.Id == id
                   select collection).FirstOrDefault();
        return ProductCollectionEFToProductCollectionDTO(result, true);
    }
} 
```

这里， XXX 的类型是`db.ProductFamilies`和`db.ProductSeriesSet`。

然后你可以这样称呼它：

```
Get(42, db => db.ProductFamilies);
Get(12, db => db.ProductSeriesSet); 
```

它有效吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-28T01:02:19.687

如果 db.ProductFamilies 和 db.ProductSeriesSet 继承自同一个基类，那么当你使用 ProductCollectionEFToProductCollectionDTO( **BaseClass** obj, bool value);

或者想想**Generic type**。

这是两种基本方法。

# algorithm - 如何聚类对象（无坐标）

> ID：691922
> 
> 赞同：8
> 
> 时间：2009-03-28T00:54:31.373
> 
> 标签：algorithm, language-agnostic, cluster-analysis

我有一个不透明对象的列表。我只能计算它们之间的距离（不是真的，只是为问题设置条件）：

```
class Thing {
    public double DistanceTo(Thing other);
} 
```

我想对这些对象进行聚类。我想控制集群的数量，并且我希望“关闭”对象位于同一个集群中：

```
List<Cluster> cluster(int numClusters, List<Thing> things); 
```

任何人都可以建议（并链接到;-)）一些聚类算法（越简单越好！）或可以帮助我的库？

**澄清**大多数聚类算法要求对象被布置在一些 N 维空间中。该空间用于查找集群的“质心”。就我而言，我不知道 N 是什么，也不知道如何从对象中提取坐标系。**我只知道两个物体相距多远。**我想找到一个只使用该信息的好的聚类算法。

想象一下，您正在根据对象的“气味”进行聚类。您不知道如何在 2D 平面上放置“气味”，但您确实知道两种气味是否相似。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-04T21:21:47.740

我认为您正在寻找[K-Medoids](http://en.wikipedia.org/wiki/K-medoids)。就像 K-means 一样，您可以预先指定聚类的数量*K*，但它不需要像 K-means 那样具有“平均”聚类对象的概念。

相反，每个集群都有一个代表**medoid**，它是最靠近中间的集群的成员。您可以将其视为 K-means 的一个版本，它查找“中位数”而不是“均值”。您所需要的只是一个距离度量来聚类事物，我在自己的一些工作中使用了它，原因与您引用的完全相同。

Naive K-medoids 不是最快的算法，但有一些快速变体可能足以满足您的目的。[以下是算法的描述以及它们在R](http://www.r-project.org/)中实现的文档链接：

1.  [PAM](http://stat.ethz.ch/R-manual/R-patched/library/cluster/html/pam.html)是 K-medoids 的基本 O(n^2) 实现。
2.  [CLARA](http://stat.ethz.ch/R-manual/R-patched/library/cluster/html/clara.html)是 PAM 的一个更快的采样版本。它通过使用 PAM 对随机采样的对象子集进行聚类并根据子集对整个对象集进行分组来工作。你应该仍然能够快速获得非常好的集群。

如果您需要更多信息，[这里有一篇论文](http://ieeexplore.ieee.org/stamp/stamp.jsp?arnumber=01181751)概述了这些和其他 K-medoids 方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-28T19:54:03.070

这是一个聚类算法的大纲，它没有找到质心的 K-means 要求。

1.  确定所有对象之间的距离。记录**n 个**最独立的对象。
    [*找到我们集群的根，时间 O(n^2)* ]
2.  **将这n 个**随机点中的每一个分配给**n 个**新的不同簇。
3.  对于每个其他对象：
    [*将对象分配给集群，时间 O(n^2)* ]
    1.  对于每个集群：
        1.  通过平均集群中每个对象到对象的距离来计算从集群到该对象的平均距离。

    2.  将对象分配给最近的集群。

该算法肯定会对对象进行聚类。但它的运行时间是*O(n^2)*。另外，它由选择的前**n**个点引导。

任何人都可以改进这一点（更好的运行时性能，更少依赖初始选择）？我很想看看你的想法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-28T00:59:58.350

这是一个快速算法。

```
While (points_left > 0) {
 Select a random point that is not already clustered
 Add point and all points within x distance 
   that aren't already clustered to a new cluster.
} 
```

或者，阅读[维基百科页面](http://en.wikipedia.org/wiki/Data_clustering)。K-means 聚类是一个不错的选择：

> K-means 算法将每个点分配给其中心（也称为质心）最近的集群。中心是集群中所有点的平均值——也就是说，它的坐标是集群中所有点的每个维度的算术平均值。
> 
> 算法步骤为：
> 
> ```
> * Choose the number of clusters, k.
> * Randomly generate k clusters and determine the cluster centers, or
>   directly generate k random points as cluster centers.
> * Assign each point to the nearest cluster center.
> * Recompute the new cluster centers.
> * Repeat the two previous steps until some convergence criterion is
>   met (usually that the assignment hasn't changed). 
> ```
> 
> 该算法的主要优点是其简单性和速度，使其能够在大型数据集上运行。它的缺点是每次运行都不会产生相同的结果，因为生成的集群取决于初始随机分配。它最小化集群内方差，但不能确保结果具有全局最小方差。另一个缺点是要求均值的概念是可定义的，但情况并非总是如此。对于此类数据集，k-medoids 变体是合适的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-28T21:28:13.920

这种方法怎么样：

1.  将所有对象分配给一个集群。
2.  找到两个对象*a*和*b*，它们在同一个簇*k*中，并且相距最大。为了澄清，整个集合应该有一个*a*和*b ，而不是每个集群都有一个**a*和*b*。
3.  将集群*k*分成两个集群，*k1*和*k2*，一个与对象*a*，一个与对象*b*。
4.  对于集群*k*中的所有其他对象，通过确定与该集群中所有其他对象的最小平均距离，将它们添加到*k1*或*k2 。*
5.  重复步骤 2-5，直到形成 N 个簇。

我认为这个算法应该给你一个相当好的聚类，虽然效率可能很差。为了提高效率，您可以更改第 3 步，以便仅找到与启动集群的原始对象的最小距离，而不是与集群中已存在的所有对象的平均距离。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-04T20:36:44.667

系统发育 DNA 序列分析通常在文本字符串上使用层次聚类，并使用 [对齐] 距离矩阵。这是一个不错的 R 聚类教程：

*   [http://www.statmethods.net/advstats/cluster.html](http://www.statmethods.net/advstats/cluster.html)

（快捷方式：直接进入“分层凝聚”部分...）

以下是一些其他 [语言] 库：

*   [http://bonsai.ims.u-tokyo.ac.jp/~mdehoon/software/cluster/](http://bonsai.ims.u-tokyo.ac.jp/~mdehoon/software/cluster/)
*   [http://code.google.com/p/scipy-cluster/](http://code.google.com/p/scipy-cluster/)

这种方法可以帮助确定有多少 [k] 个“自然”簇，以及哪些对象用作上述 k 均值方法的根。

# java - Clojure nil vs Java null？

> ID：691925
> 
> 赞同：32
> 
> 时间：2009-03-28T00:57:06.233
> 
> 标签：java, clojure, null

如果我很迟钝，请原谅我，但我对 Clojure 中关于 nil 的文档有点困惑。它说：

> nil 与 Java null 具有相同的值。

这是否意味着它们是相同的东西，或者它们以某种方式不同？NullPointerException 是否意味着遇到了 Java null 或者如果遇到 nil 我也会得到这个？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-03-28T03:58:43.473

从 Clojure 源代码，`lang/LispReader.java`：

```
static private Object interpretToken(String s) throws Exception{
    if(s.equals("nil"))
        {
        return null;
        } 
```

来自`lang/RT.java`：

```
static public void print(Object x, Writer w) throws Exception{
    {
    ...
    if(x == null)
        w.write("nil"); 
```

`nil`Clojure 对底层平台的表示也是如此`null`。 `nil`Clojure 的 Java 源代码中没有其他地方出现。`nil`和之间的唯一区别`null`是一个是 Clojure，另一个是 Java，但它们本质上是别名，在从 Clojure 到 Java 再到 Clojure 时，根据阅读器和打印机的需要无缝地来回转换。

是的，`nil`可以导致`NullPointerException`s。尝试调用任何 Java 方法`nil`，你会得到一个 NPE，例如

```
(.tostring nil) 
```

Clojure 源代码在涉及到这样的事情时非常容易阅读，请看一下。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-03-28T01:01:56.770

从[学习 Clojure](http://en.wikibooks.org/wiki/Learning_Clojure)

“在大多数 Lisp 方言中，有一个值与 Java null 半等价，称为 nil。在 Clojure 中，nil 只是 Java 的 null 值，故事结束。”

由于 Clojure 编译为 java 字节码，听起来任何对 nil 的引用都只是底层 JVM 中的空对象引用。执行 Clojure 的 NPE 是访问 nil 的结果。

# javascript - JavaScript setAttribute 替代品

> ID：691927
> 
> 赞同：0
> 
> 时间：2009-03-28T00:58:23.767
> 
> 标签：javascript, dom

我正在创建这个创建元素的 JS 函数该函数有两个参数 strName 和 objAttributes

```
function createElement( strName, objAttributes )
{
  var elem = document.createElement(strName);

  for ( var i in objAttributes )
    elem.setAttribute(i, objAttributes[i]);

  return elem;
} 
```

这在 Fx 中可以正常工作，但在 MSIE 中不行 我知道 setAttibute 方法有问题，建议的解决方法是

```
elem.attr = 'val'; 
```

但现在我不知道如何在我的循环中写这个。

我已经尝试过 elem.style 和 elem['style'] 但它们都不起作用。

谁能给我一些建议，

提前致谢

吨

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-28T01:06:41.127

使用`elem[i]`.

```
function createElement( strName, objAttributes )
{
  var elem = document.createElement(strName);

  for ( var i in objAttributes )
      elem[i] = objAttributes[i];

  return elem;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-28T02:17:42.843

您不能只交换设置属性和 setAttribute。

您必须小心设置元素的属性，而不是使用 setAttribute。样式属性和事件处理程序需要仔细编写，并且那些过去在 html 中最小化的属性（禁用、多个、只读）具有特定于浏览器的有效值。

此外，如果你设置 element.class="mynewclass"，你会得到一个错误，因为 class 是一个保留的 javascript 单词，尽管在 setAttribute 赋值中将它用作字符串是完全安全的。属性名称是“.className”，标签的“for”属性的正确名称是“htmlFor”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-29T04:49:37.710

让[jQuery](http://jquery.com)处理跨浏览器的废话……

```
 $(elem).attr(i, objAttributes[i]); 
```

# svn - Mac OSX 终端上的 SVN 提交问题

> ID：691928
> 
> 赞同：0
> 
> 时间：2009-03-28T00:58:31.630
> 
> 标签：svn, macos

我从终端中的 googlecode 检查我的项目没有问题。我尝试提交更改，但收到以下错误消息：

“...programming/softwaredefinedradio/out' 不受版本控制”

问题是我的目录中没有调用文件。

什么会导致这种情况？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-25T01:20:22.123

问题是我错误地使用了 -m 选项引起的。我的命令行类似于'svn commit -m取出......'它认为我的消息是我猜的文件。将其更改为“...... -m”取出......“”就像一种魅力。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-28T05:04:02.443

作为构建或运行代码的结果，您是否在项目目录中创建了一个名为“out”的目录？

# c++ - 将 int64_t 转换为双精度

> ID：691935
> 
> 赞同：19
> 
> 时间：2009-03-28T01:01:54.443
> 
> 标签：c++, type-conversion

```
 int64_t a = 1234;

  double d = (double) a; 
```

这是推荐的方式吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-28T01:55:17.700

用作`static_cast`更奇怪的答案。我建议*不要*使用隐式转换（甚至是 C++ 源代码中的 C 样式转换），原因如下：

*   隐式转换是编译器警告的常见来源，这意味着您可能会在构建中添加噪音（现在或稍后添加更好的警告标志时）。
*   您后面的下一个维护程序员将看到一个隐式转换，并且需要知道它是故意行为还是错误/错误。这样`static_cast`做会使您的*意图*立即显而易见。
*   `static_cast`其他 C++ 风格的转换很容易`grep`处理。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-28T01:04:15.093

您应该使用`static_cast`或依赖隐式转换：

```
int64_t a = 1234;
double d = static_cast<double>(a);
double f = a; 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-28T02:26:55.050

对于 POD 类型，两个版本都做同样的事情。选择您喜欢的并保持一致。

我知道很多人更喜欢前者的打字/可读性，我倾向于同意这一点，但我可以接受。

我已经多次听到“易于 grep for”的论点，但从未遇到过需要 grep 代码库以进行 POD 转换的情况。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-28T04:11:45.443

您还可以使用转换语法，它等效于 static_cast：

```
int64_t a = 1234;
double d = double(a); 
```

这是一个有用的句法构造，因为它允许在模板代码中以相同的方式处理原始类型和类类型，或者为原始类型执行 static_cast，或者为类类型调用构造函数。

# php - 代码执行速度：ASP.NET-MVC 与 PHP

> ID：691942
> 
> 赞同：75
> 
> 时间：2009-03-28T01:04:40.413
> 
> 标签：php, asp.net-mvc, arguments

我与一位同事对此进行了友好的争论，我个人认为，一个 ASP.NET-MVC 编译的 Web 应用程序将比用 PHP 编写的同一个项目更有效/更快地运行。我朋友不同意。

不幸的是，我没有任何可靠的数据可以用来支持我的论点。（他也没有）

对此，我试图在谷歌上寻找答案，试图找到证明他错了的证据，但大多数时候争论变成了在哪个平台上开发更好、成本、安全功能等......为了这个我真的不在乎这些。

我想知道堆栈溢出社区对在 ASP.NET 中使用 MVC 开发的网站的原始速度/效率与使用 PHP 开发的完全相同的网站有何看法？

有没有人在实际场景中比较这两种技术的性能的任何实际示例？

*（我意识到对于你们中的一些人来说，这很可能是一个无关紧要甚至愚蠢的论点，但这是一个论点，我仍然想听听这里的优秀人士的答案）*

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2009-03-28T01:18:27.430

这是一个很难进行的比较，因为各个堆栈的差异意味着你最终会以不同的方式做同样的事情，如果你为了比较而做同样的事情，这不是一个非常现实的测试。

我喜欢的 PHP 以最基本的形式加载每个请求，解释然后丢弃。在这方面它非常像 CGI（考虑到它大约有 15 年的历史，这并不奇怪）。

多年来，已经进行了各种优化以提高性能，例如，最显着的是使用 APC 进行操作码缓存（以至于 APC 将成为 PHP 6 的标准部分，而不是像现在这样的可选模块）。

但是 PHP 脚本仍然基本上是瞬态的。会话信息（通常）是基于文件且互斥的（session_start() 会阻止其他脚本访问同一用户会话，直到 session_commit() 或脚本完成），而在 ASP.NET 中并非如此。除了会话数据之外，在 ASP.NET（或 Java 中，与 ASP.NET 更相似）的应用程序上下文中拥有对象是相当容易（并且正常）的。

这是一个关键的区别。例如，PHP 中的数据库访问（使用 mysql、mysqli、PDO 等）是瞬态的（尽管有持久连接），而 .Net/Java 几乎总是使用持久连接池并在此之上构建以创建 ORM 框架等，超出任何特定请求的缓存。

作为字节码解释平台，ASP.NET 理论上更快，但 PHP 所能做的限制如此之高，以至于对大多数人来说无关紧要。例如，互联网上访问量最大的 20 个站点中有 4 个是 PHP。当您开始扩展时，开发速度、健壮性、运行环境的成本等往往比任何理论速度差异更重要。

请记住，.Net 具有原始类型、类型安全性以及这些将使代码比 PHP 运行速度更快的东西。如果您想做一些不公平的测试，请在两个平台上对包含一百万个随机 64 位整数的数组进行排序。ASP.NET 将杀死它，因为它们是原始类型，简单数组将比 PHP 的关联数组更有效（并且 PHP 中的所有数组最终都是关联的）。再加上 32 位操作系统上的 PHP 不会有原生的 64 位整数，所以会因此受到很大的影响。

还应该指出的是，ASP.NET 是预编译的，而 PHP 是动态解释的（不包括操作码缓存），这可以产生影响，但 PHP 在这方面的灵活性是一件好事。能够在不反弹服务器的情况下部署脚本非常棒。只需将其放入即可。杰出的。但它最终的性能较差。

最终，尽管我认为您在争论什么才是真正无关紧要的细节。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2012-06-05T23:27:08.857

**ASP.NET 运行得更快。ASP.NET 开发速度更快。购买速度快的电脑，如果你做严肃的商业网络应用，就可以享受它**

与 PHP 相比，ASP.NET 代码的执行速度要快得多，当它在发布模式下构建、优化、缓存等时。但是，对于网站（除了大玩家，如 Facebook），它不太重要 - 页面渲染时间最多的时间是访问和查询数据库。

在连接数据库方面，ASP.NET 要好得多——在 asp.net 中，我们通常使用 LINQ，它将我们的对象查询转换为 SQL 服务器数据库中的存储过程。与数据库的连接也是持久的，一对一的网站，无需重新连接。

相比之下，PHP 无法在请求之间保持 sql server 连接，它连接，从 db 中获取数据并销毁，重新连接数据库时通常是页面渲染时间的 20-30%。

整个 web 应用程序配置也会在每次请求时在 php 中重新加载，而在 asp.net 中它会保留在内存中。在 symfony/symfony2 等大型企业框架中很容易看到它，大量渲染时间是 symfony 内部进程，其中 asp.net 加载它一次，不要浪费你的服务器做无用的工作。

ASP.NET 可以将对象保存在应用程序内存中的缓存中 - 在 php 中，您必须将其写入文件，或者使用像 memcache 这样的 hack。使用 memcache 需要处理很多并发和危险问题（在文件中存储缓存也有它自己的并发问题 - 每个请求都会启动 apache 服务器的新线程，并且许多请求可以一次工作 - 你必须考虑这些之间的并发性线程，它需要大量的开发时间并且并不总是有效，因为 php 在语言中没有任何互斥机制，所以你不能以任何方式制作关键部分）。

现在关于开发速度：ASP.NET 有两个为其设计的主要框架（Webforms 和 MVC），安装在环境中，在 PHP 中你必须获得一个开源框架。php 中没有像 asp.NET 那样的标准框架。

ASP.NET 语言是如此丰富，标准库有解决非常常见问题的方法，其中 PHP 标准库是......赤裸裸的......他们不能保持一种命名约定。

.NET 具有类型，其中 PHP 是动态的，因此这意味着在您运行它或编写单元测试之前无法控制源代码。

.NET 有很棒的 IDE，其中 PHP IDE 是平均的或一般的好（PHPStorm 仍然比 VS+resharper 差很多，甚至没有它）

当 ASP.NET 脚手架集成到环境中时，symfony 中的 PHP 脚手架会从命令行触发。

如果你有像我这样的慢速计算机（一个核心 2,2ghz），开发 asp.net 页面可能会很痛苦，因为你必须在源代码发生任何变化时重新编译你的项目，其中 PHP 代码会立即刷新。

与 C# 语法相比，PHP 语言的语法是如此的未完成、不稳固和赤裸裸。C# 中的强类型和许多灵活的语言特性可以加快您的开发速度并减少代码错误。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2009-03-28T01:39:21.563

在我的（非硬基准）经验中，Asp.Net 在原始速度方面肯定可以与 PHP 竞争（并且在某些领域超过）。但与许多其他与语言选择相关的问题类似，以下陈述（在这种情况下）是有效的（在我看来）：

*   语言 x 中存在缓慢、错误的站点（无论是 PHP 还是 Asp.Net）
*   语言 x 中有很多很棒的快速网站（无论是 PHP 还是 Asp.Net）

我想说的是：开发人员的（人才）将影响整体速度，而不是在两种（在某种抽象程度上大致等效）技术之间进行选择。

确实，“整体速度”比较没有多大意义，因为除非您处于非常特定的专业领域（您尚未告知我们），否则两者都可以以某种方式相互赶超。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2014-03-27T12:04:33.337

我做过性能测试。

程序：10000000 个数字的总和

![在此处输入图像描述](https://i.stack.imgur.com/gse6O.png)

![在此处输入图像描述](https://i.stack.imgur.com/yUooi.png)

给定的输出证明php比C#慢............

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2012-03-05T19:16:24.937

我会说 ASP.net

需要考虑的事项：

*   ASP.net 是预编译的
*   ASP.net 通常是用 C# 编写的，它的执行速度应该比 PHP 快

当然，差异非常小。两者都有优点，我认为 PHP 更容易部署并且可以在任何服务器上运行，而不仅仅是 IIS。虽然我很喜欢 ASP.net MVC。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2015-01-28T09:25:14.110

我是两种技术（ASP.Net c# 和 PHP5）的开发专家。经过多年的工作和在实际生产环境中比较它们，我的印象是：

*   首先，无法比较它们循环添加值 1.000.000，这不是真实情况。

*   在我的开发环境中将它们与真实的生产环境进行比较是不一样的。例如：在开发中 ASP.Net 默认不使用 IIS，使用具有不同优化的内部开发服务器。在开发中，没有并发。

**所以我的意见是下一个：**

*   循环 1.000.000 次 c# 会更快。（无意义）

*   提供访问数据库、显示图像、具有表单等的真实页面。ASP.Net 比 PHP 慢。

*   ASPX 页面的重量比 PHP 重 10 倍，因此这使得最终用户等待更多时间来获取页面。

*   ASPX 的开发速度比 PHP 慢，这很重要，因为归根结底就是钱。我们在 PHP 中的开发速度比 ASP.Net 快 35%，因为每次您想要检查 smthg 时都必须编译并重新启动。

*   在大型项目中，从长远来看，ASP.Net 更适合避免错误并具有复杂的体系结构。

*   由于 Windows 服务器、IIS、.... 最后，您需要一个强大的服务器来容纳与 PHP 相同数量的 ASP 用户。例如：我们使用 ASP.net 提供大约 20.000 个并发用户，而在 PHP 中，同一台服务器可以获取大约 30.000 个用户。

唯一重要的不是如果循环哪个更快。问题是当网站是真实的并且正在生产中时，他们可以容纳多少用户，页面有多大（更重==用户等待时间更多，服务器的净费用更多，服务器的磁盘费用更多，内存费用更多服务器）。尝试并发检查时间，你会看到。

希望能帮助到你。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-08-30T07:44:03.303

如果没有任何优化，.net 编译的应用程序当然会比 php 运行“更快”。但是你是对的，这是一个愚蠢和无关紧要的论点，因为它除了吹牛的权利之外与现实世界没有任何关系。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-03-28T02:38:50.700

通常 ASP.Net 在给定的硬件上会比 PHP 表现更好。ASP.Net MVC 还可以做得更好（可以是这里的操作词）。大多数平台的设计都考虑到了企业发展。可测试的代码、关注点分离等。ASP.Net 中的许多臃肿来自页面内的对象堆栈（嵌套控件）。预编译可以提高性能，但这可能是一个关键问题。MVC 倾向于允许更少的嵌套，使用基于 webforms 的视图引擎（其他可用）。

Web 应用程序最慢的地方往往是远程服务，尤其是数据库持久性。PHP 的编程没有连接池或内存会话状态的好处。这可以通过 memcached 和其他性能更高的服务层（也可用于 .Net）来克服。

它实际上归结为站点/应用程序的细节。这个站点恰好在相当普通的硬件上很好地运行 MVC。PHP 下的类似网站可能会因自身的重量而下降。其他要考虑的事情。IIS vs. Apache vs LightHTTPD 等。老实说，php vs asp.net 不仅仅是原始性能差异。PHP 并不像 asp.net mvc 那样适合大型、复杂的应用程序，它就是这么简单……这本身与 VS+SCC 的关系比其他任何事情都多。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-28T01:56:47.573

我倾向于同意你的观点（ASP.NET MVC 更快），但为什么不和你的朋友友好地打赌并分享结果呢？创建一个从 MySQL 数据库派生的非常简单的 DYNAMIC 页面，并多次加载该页面。

例如，创建一个包含 1,000,000 行的表，其中包含一个顺序主键，然后在第二列中包含一个随机 #。您的每个站点都可以接受 GET 中的主键，根据传入的键检索随机 #，并在某种类型的动态生成的 html 中显示随机 #。

我很想知道结果……如果你有博客或类似的东西，世界其他地方也会有（这个问题一直被问到）。

如果你也可以在普通的 ASP 中构建这个简单的小应用程序，那就更好了。哎呀，如果测试设计得很好，我什至会为这些结果付钱给你。说真的 - 只要在这里表达你的兴趣，我就会给你发我的电子邮件。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-10-10T13:24:34.170

需要注意的是，问题是 .NET MVC vs PHP，而不是 .NET (Web Forms) vs PHP。我没有事实，但总体感觉是 PHP 网站比 .NET Web 表单网站运行得更快（而且我只使用 .NET）。.NET Web 表单尽管被编译与解释 PHP 通常很慢，因为所有代码块都是由 .NET 引擎自动生成的，用于为您在设计模式下使用的每个 <asp:control> 呈现 HTML。让 .NET Web 表单与 PHP 在速度上竞争是一个完整的过程，从设置 EnableViewState = false 开始，然后可以使用带有 runat=server 的每个 html 控件结束......疯了吧？

现在，MVC 就不同了，我用 .NET MVC2 做了两个网站，感觉不错，现在可以感受一下速度了！并且代码与任何 PHP 网站一样干净。所以，现在，MVC 可以让你像 PHP 一样编写干净的代码，而 MVC 是针对 PHP 解释编译的，它只能导致一件事，MVC 比 PHP 快……时间会证明，当一般意义上是“MVC 网站运行比 PHP 更快”，那么我们今天在这里所说的就是正确的。

再见/！

* * *

## 回答 #11

> 赞同：-3
> 
> 时间：2015-01-25T05:00:23.400

C++... 现在战斗将在 PHP 和 ASP.NET 之间展开。PHP 将赢得易用性，ASP.NET 将赢得性能（在 Windows 服务器生态系统中）。很多以 php 开头的大型网站都已升级为 C++。

# python - 简短（且有用）的 python 片段

> ID：691946
> 
> 赞同：48
> 
> 时间：2009-03-28T01:07:06.430
> 
> 标签：python, code-snippets

本着现有的[“你最有用的 C/C++ 片段是什么”的](https://stackoverflow.com/questions/469696/what-is-your-most-useful-c-c-snippet)精神- 线程：

你们有没有（经常）使用的简短的、单功能的 Python 代码片段并想与 StackOverlow 社区分享？请尽量减少条目（可能少于 25 行？），并且每篇文章只提供一个示例。

我将从一个我不时使用的简短片段开始计算 python 项目中的 sloc （源代码行）：

```
# prints recursive count of lines of python source code from current directory
# includes an ignore_list. also prints total sloc

import os
cur_path = os.getcwd()
ignore_set = set(["__init__.py", "count_sourcelines.py"])

loclist = []

for pydir, _, pyfiles in os.walk(cur_path):
    for pyfile in pyfiles:
        if pyfile.endswith(".py") and pyfile not in ignore_set:
            totalpath = os.path.join(pydir, pyfile)
            loclist.append( ( len(open(totalpath, "r").read().splitlines()),
                               totalpath.split(cur_path)[1]) )

for linenumbercount, filename in loclist: 
    print "%05d lines in %s" % (linenumbercount, filename)

print "\nTotal: %s lines (%s)" %(sum([x[0] for x in loclist]), cur_path) 
```

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-03-29T05:57:20.420

我喜欢使用`any`和生成器：

```
if any(pred(x.item) for x in sequence):
    ... 
```

而不是这样编写的代码：

```
found = False
for x in sequence:
    if pred(x.n):
        found = True
if found:
    ... 
```

[我首先从 Peter Norvig 的一篇文章](http://norvig.com/sudoku.html)中了解到这种技术。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-03-28T08:35:01.780

初始化二维列表

虽然这可以安全地初始化列表：

```
lst = [0] * 3 
```

相同的技巧不适用于 2D 列表（列表列表）：

```
>>> lst_2d = [[0] * 3] * 3
>>> lst_2d
[[0, 0, 0], [0, 0, 0], [0, 0, 0]]
>>> lst_2d[0][0] = 5
>>> lst_2d
[[5, 0, 0], [5, 0, 0], [5, 0, 0]] 
```

运算符 * 复制其操作数，并且用 [] 构造的复制列表指向同一个列表。正确的方法是：

```
>>> lst_2d = [[0] * 3 for i in xrange(3)]
>>> lst_2d
[[0, 0, 0], [0, 0, 0], [0, 0, 0]]
>>> lst_2d[0][0] = 5
>>> lst_2d
[[5, 0, 0], [0, 0, 0], [0, 0, 0]] 
```

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2009-03-28T02:16:45.340

我知道的唯一让我惊叹的“技巧”就是枚举。它允许您访问 for 循环中元素的索引。

```
>>> l = ['a','b','c','d','e','f']
>>> for (index,value) in enumerate(l):
...     print index, value
... 
0 a
1 b
2 c
3 d
4 e
5 f 
```

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2009-03-28T18:11:56.060

`zip(*iterable)`转置一个可迭代的。

```
>>> a=[[1,2,3],[4,5,6]]
>>> zip(*a)
    [(1, 4), (2, 5), (3, 6)] 
```

它对字典也很有用。

```
>>> d={"a":1,"b":2,"c":3}
>>> zip(*d.iteritems())
[('a', 'c', 'b'), (1, 3, 2)] 
```

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2011-09-16T15:40:14.590

为当前目录中的文件启动一个简单的 Web 服务器：

```
python -m SimpleHTTPServer 
```

用于共享文件。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2010-12-13T16:27:04.580

一个“进度条”，如下所示：

```
|#############################---------------------|
59 percent done 
```

代码：

```
class ProgressBar():
    def __init__(self, width=50):
        self.pointer = 0
        self.width = width

    def __call__(self,x):
         # x in percent
         self.pointer = int(self.width*(x/100.0))
         return "|" + "#"*self.pointer + "-"*(self.width-self.pointer)+\
                "|\n %d percent done" % int(x) 
```

测试功能（windows系统，将“clear”改为“CLS”）：

```
if __name__ == '__main__':
    import time, os
    pb = ProgressBar()
    for i in range(101):
        os.system('clear')
        print pb(i)
        time.sleep(0.1) 
```

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2009-03-29T01:47:41.923

展平列表列表，例如

```
[['a', 'b'], ['c'], ['d', 'e', 'f']] 
```

进入

```
['a', 'b', 'c', 'd', 'e', 'f'] 
```

采用

```
[inner
    for outer in the_list
        for inner in outer] 
```

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2009-03-28T21:36:56.050

嵌套列表和字典的巨大加速：

```
deepcopy = lambda x: cPickle.loads(cPickle.dumps(x)) 
```

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2009-03-28T08:36:40.793

假设您有一个项目列表，并且您想要一个以这些项目作为键的字典。使用 fromkeys：

```
>>> items = ['a', 'b', 'c', 'd']
>>> idict = dict().fromkeys(items, 0)
>>> idict
{'a': 0, 'c': 0, 'b': 0, 'd': 0}
>>> 
```

fromkeys 的第二个参数是要授予所有新创建的键的值。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2009-03-28T08:35:49.173

要确定行是否为空（即大小为 0 或仅包含空格），请在条件中使用字符串方法 strip，如下所示：

```
if not line.strip():    # if line is empty
    continue            # skip it 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2009-03-28T01:13:34.323

我喜欢这个将所有内容压缩到一个目录中。热键它用于 instabackups！

```
import zipfile

z = zipfile.ZipFile('my-archive.zip', 'w', zipfile.ZIP_DEFLATED)
startdir = "/home/johnf"
for dirpath, dirnames, filenames in os.walk(startdir):
  for filename in filenames:
    z.write(os.path.join(dirpath, filename))
z.close() 
```

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2009-03-28T21:32:02.100

对于需要当前的列表推导，下一步：

```
[fun(curr,next) 
 for curr,next 
 in zip(list,list[1:].append(None)) 
 if condition(curr,next)] 
```

对于循环列表`zip(list,list[1:].append(list[0]))`。

对于以前，当前：`zip([None].extend(list[:-1]),list)`循环：`zip([list[-1]].extend(list[:-1]),list)`

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2009-03-28T01:10:48.713

硬链接当前目录中的相同文件（在 unix 上，这意味着它们共享物理存储，这意味着空间要少得多）：

```
import os
import hashlib

dupes = {}

for path, dirs, files in os.walk(os.getcwd()):
    for file in files:
        filename = os.path.join(path, file)
        hash = hashlib.sha1(open(filename).read()).hexdigest()
        if hash in dupes:
            print 'linking "%s" -> "%s"' % (dupes[hash], filename)
            os.rename(filename, filename + '.bak')
            try:
                os.link(dupes[hash], filename)
                os.unlink(filename + '.bak')
            except:
                os.rename(filename + '.bak', filename)
            finally:
        else:
            dupes[hash] = filename 
```

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2011-04-18T19:15:51.243

以下是我认为值得了解但可能对日常没有用的一些内容。他们中的大多数是一个班轮。

从列表中删除重复项

```
L = list(set(L)) 
```

从字符串中获取整数（空格分隔）

```
ints = [int(x) for x in S.split()] 
```

寻找阶乘

```
fac=lambda(n):reduce(int.__mul__,range(1,n+1),1) 
```

求最大公约数

```
>>> def gcd(a,b):
...     while(b):a,b=b,a%b
...     return a 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2011-04-17T14:38:13.270

模拟 switch 语句。例如 switch(x) {..}：

```
def a():
  print "a"

def b():
  print "b"

def default():
   print "default"

apply({1:a, 2:b}.get(x, default)) 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2011-04-17T16:41:15.717

*   像上面的另一个人一样，我说“哇！！” 当我发现**enumerate()**

*   当我发现**repr()**让我有可能准确地看到我想用正则表达式分析的字符串的内容时，我对 Python 赞不绝口

*   我很满意地发现**'\n'.join(...)**`print '\n'.join(list_of_strings)`的显示速度比**`for ch in list_of_strings: print ch`**

***   **带参数的splitlines(1)**保留换行符** 

 **这四个“技巧”组合在一个片段中非常有用，可以快速显示网页的代码源，逐行显示，每一行都被编号，所有特殊字符（如 '\t' 或换行符都不会被解释，以及换行符）展示：

```
import urllib
from time import clock,sleep

sock = urllib.urlopen('http://docs.python.org/')
ch = sock.read()
sock.close()

te = clock()
for i,line in enumerate(ch.splitlines(1)):
    print str(i) + ' ' + repr(line)
t1 = clock() - te

print "\n\nIn 3 seconds, I will print the same content, using '\\n'.join(....)\n" 

sleep(3)

te = clock()
# here's the point of interest:
print '\n'.join(str(i) + ' ' + repr(line)
                for i,line in enumerate(ch.splitlines(1)) )
t2 = clock() - te

print '\n'
print 'first  display took',t1,'seconds'
print 'second display took',t2,'seconds' 
```

用我不是很快的电脑，我得到了：

```
first  display took 4.94626048841 seconds
second display took 0.109297410704 seconds 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2011-08-18T00:28:38.123

```
import tempfile
import cPickle

class DiskFifo:
    """A disk based FIFO which can be iterated, appended and extended in an interleaved way"""
    def __init__(self):
        self.fd = tempfile.TemporaryFile()
        self.wpos = 0
        self.rpos = 0
        self.pickler = cPickle.Pickler(self.fd)
        self.unpickler = cPickle.Unpickler(self.fd)
        self.size = 0

    def __len__(self):
        return self.size

    def extend(self, sequence):
        map(self.append, sequence)

    def append(self, x):
        self.fd.seek(self.wpos)
        self.pickler.clear_memo()
        self.pickler.dump(x)
        self.wpos = self.fd.tell()
        self.size = self.size + 1

    def next(self):
        try:
            self.fd.seek(self.rpos)
            x = self.unpickler.load()
            self.rpos = self.fd.tell()
            return x

        except EOFError:
            raise StopIteration

    def __iter__(self):
        self.rpos = 0
        return self 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-03-29T10:46:58.430

对于 Python 2.4+ 或更早版本：

```
for x,y in someIterator:
  listDict.setdefault(x,[]).append(y) 
```

在 Python 2.5+ 中有使用[defaultdict](http://docs.python.org/library/collections.html#collections.defaultdict)的替代方法。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-07-12T13:23:42.953

一个自定义列表，当乘以其他列表时返回一个笛卡尔积......好在笛卡尔积是可索引的，不像 itertools.product 那样（但被乘数必须是序列，而不是迭代器）。

```
import operator

class mylist(list):
    def __getitem__(self, args):
        if type(args) is tuple:
            return [list.__getitem__(self, i) for i in args]
        else:
            return list.__getitem__(self, args)
    def __mul__(self, args):
        seqattrs = ("__getitem__", "__iter__", "__len__")
        if all(hasattr(args, i) for i in seqattrs):
            return cartesian_product(self, args)
        else:
            return list.__mul__(self, args)
    def __imul__(self, args):
        return __mul__(self, args)
    def __rmul__(self, args):
        return __mul__(args, self)
    def __pow__(self, n):
        return cartesian_product(*((self,)*n))
    def __rpow__(self, n):
        return cartesian_product(*((self,)*n))

class cartesian_product:
    def __init__(self, *args):
        self.elements = args
    def __len__(self):
        return reduce(operator.mul, map(len, self.elements))
    def __getitem__(self, n):
        return [e[i] for e, i  in zip(self.elements,self.get_indices(n))]
    def get_indices(self, n):
        sizes = map(len, self.elements)
        tmp = [0]*len(sizes)
        i = -1
        for w in reversed(sizes):
            tmp[i] = n % w
            n /= w
            i -= 1
        return tmp
    def __add__(self, arg):
        return mylist(map(None, self)+mylist(map(None, arg)))
    def __imul__(self, args):
        return mylist(self)*mylist(args)
    def __rmul__(self, args):
        return mylist(args)*mylist(self)
    def __mul__(self, args):
        if isinstance(args, cartesian_product):
            return cartesian_product(*(self.elements+args.elements))
        else:
            return cartesian_product(*(self.elements+(args,)))
    def __iter__(self):
        for i in xrange(len(self)):
            yield self[i]
    def __str__(self):
        return "[" + ",".join(str(i) for i in self) +"]"
    def __repr__(self):
        return "*".join(map(repr, self.elements)) 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2011-11-20T19:39:03.640

实际上我只是创建了这个，但我认为它将是一个非常有用的调试工具。

```
def dirValues(instance, all=False):
    retVal = {}
    for prop in dir(instance):
        if not all and prop[1] == "_":
            continue
        retVal[prop] = getattr(instance, prop)
    return retVal 
```

我通常在 pdb 上下文中使用 dir() ，但我认为这会更有用：

```
(pdb) from pprint import pprint as pp
(pdb) from myUtils import dirValues
(pdb) pp(dirValues(someInstance)) 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2012-08-07T08:30:43.127

通过 x 元素块迭代任何大小（包括未知大小）的任何可迭代对象（列表、集合、文件、流、字符串等）：

```
from itertools import chain, islice

def chunks(iterable, size, format=iter):
    it = iter(iterable)
    while True:
        yield format(chain((it.next(),), islice(it, size - 1)))

>>> l = ["a", "b", "c", "d", "e", "f", "g"]
>>> for chunk in chunks(l, 3, tuple):
...         print chunk
...     
("a", "b", "c")
("d", "e", "f")
("g",) 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2012-10-07T15:13:47.557

调试时，有时您希望使用基本编辑器查看字符串。用记事本显示字符串：

```
import os, tempfile, subprocess

def get_rand_filename(dir_=os.getcwd()):
    "Function returns a non-existent random filename."
    return tempfile.mkstemp('.tmp', '', dir_)[1]

def open_with_notepad(s):
    "Function gets a string and shows it on notepad"
    with open(get_rand_filename(), 'w') as f:
        f.write(s)
        subprocess.Popen(['notepad', f.name]) 
```

# c++ - 我应该评论 C++ 中的声明还是定义？

> ID：691954
> 
> 赞同：12
> 
> 时间：2009-03-28T01:13:12.717
> 
> 标签：c++, comments

声明（在头文件中）或定义（在源文件中）哪个更实用？也许我应该同时评论，或者都不评论并将其全部放在一个单独的文件中......

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-28T01:15:02.493

您应该完整记录具有最高优先级的头文件。

定义中的注释应该集中在实现细节上，而标题注释应该集中在接口上。

正如您所建议的，第三个文档来源也很有用。它应该描述整体概念。

注释头文件的一大优点是，如果您遵循一些简单的语法，您可以从它们自动创建文档。[向doxygen](http://www.doxygen.nl)打个招呼！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-28T01:46:35.803

我想添加到 ypnos 的答案：

你的评论去哪里取决于你的听众是谁。将您的代码视为封闭源代码在这方面会有所帮助：维护人员可以看到实现，客户/用户只能看到界面。如果用户需要评论，则必须进入界面。如果评论只与给定的实现相关，它可能只需要进入实现（但不一定，取决于你的听众）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-28T01:15:37.140

取决于评论的内容以及您希望阅读的人。

# windows-mobile - DataGrid 行/列过滤

> ID：691964
> 
> 赞同：1
> 
> 时间：2009-03-28T01:21:17.347
> 
> 标签：windows-mobile, compact-framework

我正在开发一个 Windows 移动应用程序。如何在网格中的数据表中仅显示十二列中的两列？

此外，是否可以删除 Windows Mobile 数据网格中的行？

请提供示例代码。

* * *

嗨 StartClass0830，

感谢您的回复，我不想删除网格中的列，假设在 Windows 移动应用程序中，dtNewOrder 表包含 11 列，我需要显示从 dtNewOrder 到数据网格的某些字段。

另一个问题是数据网格包含 10 行我如何删除网格中的某些行。

请给我示例代码；这几天我一直在努力解决这个问题。

这是我所拥有的：

```
Imports System.Data
Imports System.Text
Imports System.IO
Imports System.Data.SqlServerCe

 Dim dtCustomerName As DataTable
 Dim dtNewOrder As DataTable
 Dim _objDataAccess As New DataAccess

Private Sub NewOrder_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Load

        dtNewOrder = CreateNewOrderDataTable()
 End Sub

 Private Sub btnAdd_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)  Handles btnAdd.Click
     AddNewOrderMember(dtNewOrder)
End Sub

 Private Sub AddNewOrderMember(ByVal dtNewOrder As DataTable)
        Try
            Dim NewOrderMemberRow As DataRow = dtNewOrder.NewRow()
            NewOrderMemberRow("OrderID") = System.Guid.NewGuid()
            NewOrderMemberRow("SalesPersonID") = "123"
            NewOrderMemberRow("CustomerGroupID") = ddlCutomerGroup.SelectedValue.ToString()
            NewOrderMemberRow("CustomerID") = ddlCustomerName.SelectedValue.ToString()
            NewOrderMemberRow("CustomerItemCode") = "123"
            NewOrderMemberRow("Category") = "Dummy Category"
            'NewOrderMemberRow("Description") = "Dummy Des"
            NewOrderMemberRow("OrderUnit") = "Each"
            NewOrderMemberRow("OrderQuantity") = txtOrderQuantity.Text
            NewOrderMemberRow("UnitPrice") = "123"
            NewOrderMemberRow("TotalAmount") = "30000"
            dtNewOrder.Rows.Add(NewOrderMemberRow)
            dtNewOrder.AcceptChanges()

            If dtNewOrder.Rows.Count > 0 Then
                dgNewOrder.DataSource = dtNewOrder
            End If

        Catch ex As Exception
            MessageBox.Show(ex.Message, "Mobile Retail Merchandising", MessageBoxButtons.OK, MessageBoxIcon.Question, MessageBoxDefaultButton.Button1)
        End Try
    End Sub

Private Function CreateNewOrderDataTable() As DataTable

        dtNewOrder = New DataTable("NewOrder")
        Try
            dtNewOrder.Columns.Add(New DataColumn("OrderID", Type.GetType("System.String")))
            dtNewOrder.Columns.Add(New DataColumn("SalesPersonID", Type.GetType("System.String")))
            dtNewOrder.Columns.Add(New DataColumn("CustomerGroupID", Type.GetType("System.String")))
            dtNewOrder.Columns.Add(New DataColumn("CustomerID", Type.GetType("System.String")))
            dtNewOrder.Columns.Add(New DataColumn("CustomerItemCode", Type.GetType("System.String")))
            dtNewOrder.Columns.Add(New DataColumn("Category", Type.GetType("System.String")))
            dtNewOrder.Columns.Add(New DataColumn("Description", Type.GetType("System.String")))
            dtNewOrder.Columns.Add(New DataColumn("OrderUnit", Type.GetType("System.String")))
            dtNewOrder.Columns.Add(New DataColumn("OrderQuantity", Type.GetType("System.String")))
            dtNewOrder.Columns.Add(New DataColumn("UnitPrice", Type.GetType("System.String")))
            dtNewOrder.Columns.Add(New DataColumn("TotalAmount", Type.GetType("System.String")))

            Dim PrimaryKeyColumns() As DataColumn = New DataColumn(1) {}
            PrimaryKeyColumns(0) = dtNewOrder.Columns("OrderID")
            dtNewOrder.PrimaryKey = PrimaryKeyColumns
            Return dtNewOrder
        Catch ex As Exception
            MessageBox.Show(ex.Message, "Mobile Retail Merchandising", MessageBoxButtons.OK, MessageBoxIcon.Question, MessageBoxDefaultButton.Button1)
            Return dtNewOrder
        End Try
    End Function 
```

谢谢美女

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-28T01:25:03.360

你的问题有点问题。您提到了网格中的 2 列和数据表中的 12 列，并且您想要删除 ROWS！

我认为您的意思是 COLUMNS 而不是 ROWS。当您对网格进行数据绑定时，您可以指定 12 列中的哪些列。无需删除列。

如果您真的是指 ROWS，您可以修改 SQL 或 LINQ 查询以删除那些不需要的 ROWS。

# installation - 鞋子和宝石

> ID：691968
> 
> 赞同：1
> 
> 时间：2009-03-28T01:24:14.203
> 
> 标签：installation, openssl, gem, shoes, xml-rpc

我有鞋葡萄干 (0.r1134) [i686-darwin8.9.1] +视频

我正在尝试像这样设置 Shoes.setup 块：

```
 Shoes.setup do
  gem 'mini_exiftool'
  gem 'xml-simple > 1.0'

  require "mini_exiftool"
  require 'xmlrpc/client'
  require 'xmlsimple.rb'
  require "my_webservice_api_wrapper"

  mwa = MyWebserviceApiWrapper.new
  mwa.login  # problems...
end 
```

一切正常，直到我们到达 mwa.login，这将我们带到我的 XML-RPC 包装 API，它将执行安全登录。我得到错误：

未定义的方法“关闭？” 为了 ＃

如果我启动 irb 并加载“my_webservice_api_wrapper.rb”，一切正常，所以我想也许我误解了应该在鞋中加载什么以及何时加载。

任何帮助表示赞赏。鞋子看起来真的很酷。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-03T19:43:48.347

我认为您需要将其分解为两个单独的块：

```
Shoes.setup do
  gem 'mini_exiftool'
  gem 'xml-simple > 1.0'
end

require "mini_exiftool"
require 'xmlrpc/client'
require 'xmlsimple.rb'
require "my_webservice_api_wrapper"

Shoes.app do
  mwa = MyWebserviceApiWrapper.new
  mwa.login  # problems...
end 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-09T09:47:28.380

我希望您的登录模块不使用 HTTPS，因为我认为 Shoes 尚不支持。

# linq - 是否可以从 Visual Studio 2008 中的 edmx 更新 sql 数据库架构？

> ID：691969
> 
> 赞同：5
> 
> 时间：2009-03-28T01:24:16.153
> 
> 标签：linq, linq-to-sql, entity-framework, linq-to-entities, edmx

因此，使用 LINQ-to-SQL 我知道您可以从 LINQ 对象更新数据库并从 SQL 更新 LINQ 对象。

我正在使用 LINQ 的**实体框架**（又名 LINQ-to-entities），我可以更新 SQL 数据库中的实体，但我无法通过更改实体来更新数据库架构。

这令人沮丧。有什么我想念的吗？难道我做错了什么？如果 Visual Studio 2008 无法做到这一点，是否有插件或其他 3rd 方应用程序可以做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-28T01:29:43.487

目前只能从数据库生成 EF 模型。无法从模型生成数据库。

未来版本中讨论的内容。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-06T23:00:39.400

我一直致力于扩展 LINQ to SQL Database Sync(*) (csdb.exe) 工具以处理 edmx 文件。目前，我有一个初步但有效的版本，可以在您的数据库中生成和更新表。关系还没有工作，你可能会遇到一些其他问题。[该代码可在 github 上](http://github.com/valhallasw/csdb/tree/edmx)的 Ms-PL 下获得（与原始 csdb.exe 一样）。

请注意，数据库连接字符串和 edmx 文件名现在是硬编码的。这是我的原型版本，不是发布版本；）

(*) 请谷歌原始工具。Stack Overflow 不允许我发布多个链接...

# asp.net-mvc - 如何从 WebForms 应用程序激活 VS2008 中的 MVC 模板

> ID：691970
> 
> 赞同：1
> 
> 时间：2009-03-28T01:24:24.610
> 
> 标签：asp.net-mvc, templates, webforms

我正在将 ASP.NET MVC 添加到 WebForms 应用程序中。您从头开始创建的 ASP.NET MVC 解决方案的一个简洁功能是右键单击解决方案资源管理器并添加 > 新项目... 将提供包含 MVC 模板的模板列表。但是，在 WebForms 应用程序中，这些模板不会出现。

我认为 .sln 解决方案文件中可能有一个设置表明一个是 ASP.NET MVC 应用程序，但我找不到任何突出的东西。

编辑：为了扩展问题，当您右键单击 MVC 应用程序的解决方案资源管理器中的 Controllers 文件夹时，Visual Studio 如何知道在“添加”菜单上添加“控制器...”菜单项？同样，当您右键单击“视图”文件夹时，它会在“添加”菜单中添加“视图...”菜单项。Visual Studio 从哪里获取此信息，如何将这 2 个文件夹添加到另一个 Web 应用程序并获得相同的功能？

想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-28T20:55:17.367

我相信它的逻辑包含在 dll 中

> Microsoft.VisualStudio.Web.ExtensionsUI

在创建新的 ASP.NET MVC 项目时使用的项目模板中注册：

```
<WizardExtension>
  <Assembly>
    Microsoft.VisualStudio.Web.Extensions, 
    Version=9.0.0.0, 
    Culture=neutral, 
    PublicKeyToken=31bf3856ad364e35
  </Assembly>
  <FullClassName>
    Microsoft.VisualStudio.Web.Mvc.TemplateWizard
  </FullClassName>
</WizardExtension> 
```

> C:\Program Files\Microsoft Visual Studio 9.0\Common7\IDE\ProjectTemplates\CSharp\Web\1033\MvcWebApplicationProjectTemplatev1.cs.zip

您可能还会在 .xxproj 文件中弄乱项目类型指南：

```
<ProjectTypeGuids>
  {603c0e0b-db56-11dc-be95-000d561079b0};
  {349c5851-65df-11da-9384-00065b846f21};
  {fae04ec0-301f-11d3-bf4b-00c04f79efbc}
</ProjectTypeGuids> 
```

似乎是 ASP.NET MVC 项目的默认项目，将它们与您的 Web 应用程序中的项目进行比较，然后从那里开始。

但是，在很多情况下，我同意 gisresearch：首先创建更复杂的项目（MVC 项目）通常更容易，然后将原始项目移入其中。

此外，没有什么可以阻止您在同一个 Web 应用程序中托管多个项目 - 将 Web 应用程序中的公共逻辑拉到共享类库中，然后从一个干净的 MVC 应用程序中引用它，使用稍微不同的命名空间，然后合并IIS 中的两个站点，将 dll 放入共享 bin 文件夹中（或强命名它们并将它们放在全局程序集缓存中），共享图像/脚本，然后离开 - 你只需要注意 Global. asax，这对两者都是通用的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-28T01:33:33.167

反过来呢。首先创建一个 asp.net mvc 项目，然后添加你的 web 表单代码。

这是Scott Hanselman的[混合应用程序](http://www.hanselman.com/blog/PlugInHybridsASPNETWebFormsAndASPMVCAndASPNETDynamicDataSideBySide.aspx)示例。

您也可以考虑创建一个默认的 asp.net mvc 应用程序和 asp.net web 表单应用程序，然后对两个项目进行文本比较，看看有什么区别。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T19:27:42.593

就像 Zhaph 提到的那样，添加 ProjectTypeGuid 对我有用。卸载 Web 项目，编辑并将额外的 ProjectTypeGuid 添加到现有列表中。

{603c0e0b-db56-11dc-be95-000d561079b0}；

# windows - windows mobile中的复选框验证

> ID：691977
> 
> 赞同：0
> 
> 时间：2009-03-28T01:32:13.700
> 
> 标签：windows, mobile, checkbox

在 Windows 移动应用程序中，我如何验证复选框。例如：

```
 I have two checkboxs A,B

        If i checked the A checkbox, B checkbox is Unchecked and If i checked the B checkbox A checkbox is unchecked  

        I struggling couple of days plz help me  how i am solve it. 
```

谢谢美女

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-31T03:29:30.460

也许你想要一个[RadioButton](http://msdn.microsoft.com/en-us/library/system.windows.forms.radiobutton.aspx)？它开箱即用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T03:36:05.920

你用什么语言写作？

在 C# 中，我会设置 EventHandlers 来监视`Checkbox1.Checked = True`和设置`Checkbox2.Checked = false`（反之亦然）

# delphi - 在各种 Windows 机器上存储 INI 类型设置和/或 DB 文件的通用方法

> ID：691979
> 
> 赞同：4
> 
> 时间：2009-03-28T01:34:41.697
> 
> 标签：delphi, initialization, registry, ini

好的，首先坦白：也许只是我，但有时 Windows 机器上的“程序设置最佳实践”感觉它比微软的数据访问策略改变得更多。我仍在运行 XP，在此过程中，我只是对 MS 希望我在哪里存储我的所有应用程序的数据等有点“呆滞”。我控制了我编写的所有机器，所以这真的没关系。

现在我正在为“in the wild”编写应用程序，以支持 Win98SE。我必须再次注意这一切。:-\

由于主要与轻松迁移到新计算机有关的原因，我不太喜欢使用注册表进行应用程序设置——我更喜欢使用 INI 文件，并且有一些用于任务的旧 INI 组件（Raize，通常）。我愿意接受对其他第三方组件的建议，如果他们能让这更容易/更少麻烦的话。

基本上，我需要存储应用程序设置（比如记住选项设置等）。

我已阅读： [用于存储用户可配置应用程序设置的注册表与 INI 文件](https://stackoverflow.com/questions/6607/registry-vs-ini-file-for-storing-user-configurable-application-settings)
[在哪里存储程序设置而不是 HKEY_LOCAL_MACHINE？](https://stackoverflow.com/questions/285277/where-to-store-program-settings-instead-of-hkeylocalmachine)
[我的 win32 程序应该将其文件保存在哪里？](https://stackoverflow.com/questions/579673/where-should-my-win32-program-keep-its-files)
[在 Windows 上为我的程序存储配置文件和日志文件的最佳位置？](https://stackoverflow.com/questions/269893/best-place-to-store-config-files-and-log-files-on-windows-for-my-program)

...所以至少在这个问题上我并不孤单...; ）
（对于有点重复的问题表示歉意，尽管角度略有不同）。

听起来我可以只使用 %APPDATA%/MyProgram，并将所有数据存储在那里，**但是**从 Win98SE 开始，这是否适用于所有 Windows 风格？如果不是，最好的方法是什么，这种方法是什么时候出现的？

老实说，我真正想要的是解决这个问题的最简单方法——我只想要一种（如果可能的话）简单、简单、可靠的方法来在任何情况下获取“我的程序的数据文件夹” . 以上会实现吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-28T02:46:37.797

转到[使 Delphi 程序为 Vista-Ready 准备](http://www.theabsolute.net/sware/delphivista.html "例子")并向下滚动到底部：“在哪里保存您的应用程序数据？”

> 函数GetRoamingUserAppDataPath：字符串；//只要人们至少有 IE 4 就可以工作。（和 Win95 或更高版本）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-28T01:53:22.183

%APPDATA% 在 Win95 上似乎不存在。我会使用在 Win98 或 Win95 w/IE4 上可用的[SHGetSpecialFolderPath 。](http://msdn.microsoft.com/en-us/library/bb762204(VS.85).aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-28T12:35:43.933

到目前为止你得到的答案很好，但是我认为你在你的问题中混合了不属于一起的东西，所以不可能完全回答你的问题。

您的问题标题说明

> INI 类型设置和/或 DB 文件

这可能是两件完全不同的事情。您必须区分每个用户的文件、所有用户通用但只读的文件以及每个用户应该能够使用的通用文件。

第一类很简单，使用*CSIDL_APPDATA*或*CSIDL_PERSONAL*文件夹下的合适目录。

第二类也很简单，只需要通过安装程序将文件安装在正确的位置，安装程序必须以正确的权限运行，因为标准（受限）用户将无法写入正确的位置。

然而，最后一个类别是困难的，因为在所有 Windows 安装中根本没有一个目录可以被认为对所有用户都是可写的。特别是在具有锁定用户帐户的业务设置中，用户可能根本没有本地磁盘的写入权限，只能写入网络服务器上某处的用户目录。因此，没有一种简单的方法可以为您的程序获取该数据位置并确保它能够正常工作 - 您可能需要重新访问所有程序和所有用例。

对于奖励积分，您还应该始终考虑文件是否应该进入漫游配置文件并在域中的所有机器上可用，或者它们是否是特定于机器的。

对于需要在计算机上的用户之间共享数据的应用程序，我要给出的一个提示是不要使用桌面样式的数据库文件，例如 Paradox 或 Access 文件。只有使用真实的（本地）数据库服务器，您才能在锁定的帐户/机器上拥有多用户数据。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-28T01:47:51.807

我无法评论它是否适用于所有版本，但我当然同意 .ini 文件是正确的答案。当 XP 说要使用注册表时，我尝试了它——用于一个程序。内部部署表明需要将设置从一台机器复制到另一台机器——下一次更新是回到 .ini 文件。

我认为整个注册表位是他们的反盗版措施，他们希望将隐藏作为最佳实践。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-28T12:17:33.633

我倾向于使用 %APPDATA% 中的 xml 文件来保存我的设置。只是因为对于 C#，xml 比 ini 更容易。无论如何，%APPDATA% 似乎是一个安全的赌注。

我无法建议 98SE 是否支持这一点。

# c# - 如何第一次保存需要附加另一个预先存在的实体的实体

> ID：691980
> 
> 赞同：1
> 
> 时间：2009-03-28T01:35:27.250
> 
> 标签：c#, .net, model-view-controller, entity-framework, repository-pattern

我需要将公司实体作为新实体保存到数据库中。为此，我需要将 CompanyType 实体与 Company 实体相关联。如果不这样做，我就无法拯救公司。我是否将新创建的公司附加到上下文，然后将公司类型实体附加到公司，然后保存我的结果？这段代码有效......但感觉不对。

```
public RepositoryStatus SaveCompany(Company company, CompanyType companyType)
    {
        RepositoryStatus rs = new RepositoryStatus();
        try
        {
            using (RanchBuddyEntities dc = new Connection().GetContext())
            {
                if (company.CompanyID > 0)
                {
                    company.UpdateDate = DateTime.Now;
                    Company original = dc.CompanySet.Where(c => c.CompanyID == company.CompanyID).FirstOrDefault();
                    dc.ApplyPropertyChanges("CompanySet", company);
                    dc.Attach(companyType);
                    company.CompanyTypesReference.Attach(companyType);
                }
                else
                {
                    company.CreateDate = DateTime.Now;
                    company.UpdateDate = DateTime.Now;
                    dc.AddToCompanySet(company);
                    dc.Attach(companyType);
                    company.CompanyTypesReference.Value = companyType;
                }
                dc.SaveChanges();
            }
            rs.SetObject(company);
            rs.StatusType = Status.StatusTypes.Success;
        }
        catch (Exception e)
        {
            rs.SetObject(company);
            rs.StatusType = Status.StatusTypes.Failure;
            rs.AddMessage(e.Message + Environment.NewLine + e.StackTrace);
        }

        return rs;
    } 
```

CompanyType 附加到另一个上下文并分离，这就是它在此处传递的原因。传递 CompanyTypeID 并在同一 using 语句中查询关联对象会更好吗？

我无法忍受我必须采取这么多步骤才能让 EF goign LINQ to SQL 如此简单！仍然 - EF 似乎比 NHibernate 更容易！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-28T15:22:20.443

我这样做：

```
Company company = new Company();
company.CreateDate = DateTime.Now;
company.UpdateDate = DateTime.Now;
company.CompanyType = companyType;
RanchBuddyEntities.AddToCompanies(company);
RanchBuddyEntities.SaveChanges(); 
```

# delphi - Delphi 的完整 VCL 类浏览器

> ID：691989
> 
> 赞同：1
> 
> 时间：2009-03-28T01:45:15.557
> 
> 标签：delphi, oop, ide, components, rtti

还记得过去与 Delphi 一起出现的旧类层次结构海报吗？

我想要一个完整的类层次结构浏览器，用于我所有的 Delphi 类，包括我在调色板上构建和安装的自定义类，以及第三方组件。理想情况下，可以通过类名轻松搜索（包括“仅整个单词”搜索，因此不计算部分匹配）。

我只看到了两件接近的事情：

1) GExpets 类浏览器 - 效果很好，但不会自动加载所有已安装的组件/类，这正是我想要的。据我所知，您必须手动导入所有源单元......这可能很麻烦。它也不允许“仅整个单词”搜索，因此有时搜索带有通用“子名称”的类需要很长时间。

2）Eagle / DevExpress CDK - 它自动加载完整的类列表，并且看起来工作得很好，但它只能在 D7 和更早版本中使用，它并没有*真正*专注于成为一个类浏览器本身，而是“继承自“选择器。

有什么东西已经这样做了吗？如果不是，那么编写一个至少构建一个自引用类名表的应用程序会有多困难，所以我至少可以将它放入数据库/树视图组件中以轻松查看继承/祖先等。 ?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-29T01:15:16.977

ESSModel 是另一个不错的类浏览器工具，它是开源的。我不知道是否有任何方法可以让它自动加载单位列表。不确定，但您可以手动导入所需的所有单元，然后将其保存为您从所有单个项目开始的基础项目。不确定加载这么多的性能如何，或者查看所需部件的难易程度。

[http://essmodel.sourceforge.net/](http://essmodel.sourceforge.net/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-28T05:09:31.073

我觉得[ModelMaker Code Explorer](http://www.modelmakertools.com/code-explorer/index.html)有这个功能，但是我没用

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-01-24T12:07:41.727

假设您需要 Delphi IDE 专家（您在帖子中的某处提到：*“...安装在调色板上，加上第三方组件”*），[DelphiDiver](http://www.delphipraxis.net/140771-delphi-2010-rtti-demo-delphidiver%99.html)对您有好处（[DelphiPraxis](http://www.delphipraxis.net/)上提供**源代码**，需要注册） .

### 外观和感觉：

![在此处输入图像描述](https://i.stack.imgur.com/UAGeM.jpg)

如果您想深入研究 IDE 以获得更深入的详细信息，请单击`Inspect the IDE`专家的名称 ( **DelphiDiver** ) ;-)

单击`Inspect the Packages`以浏览任何其他第三方组件或您已安装的任何包/组件。

它利用了先进的 RTTI 并且需要 Delphi 2010 以后的版本。

我已经在我的盒子上使用 Delphi XE 亲自安装了它。

* * *

我希望它可以作为您正在寻找的更专注的**Full VCL 类浏览器的基础。**

# regex - 如何在 Ant 文件中使用 replaceregex 提取列表中的第一个元素？

> ID：691991
> 
> 赞同：1
> 
> 时间：2009-03-28T01:46:11.140
> 
> 标签：regex, ant

使用 Ant 的正则表达式系统似乎给我带来了无穷无尽的麻烦。通过足够的工作，我通常可以让它工作（并理解我之前做错了什么）。但这次不是。我有一个简单的目标，我想从包含一个或多个逗号分隔词的属性中提取第一个元素，如下所示：

```
tgt.list.full=word1,word2,word3,word4 
```

（编辑：tgt.list.full 实际上由另一个属性填充：tgt.list.basic，因此实际的 cfg.list.file 如下所示：

```
tgt.list.basic=word1,word2,word3,word4
tgt.list.full=${tgt.list.basic} 
```

)

我想要第一个单词：“word1”来替换 ${target} 属性。这是我的任务的样子：

```
 <target name="load-configuration-list">
     <loadproperties srcfile="${cfg.list.file}">
         <filterchain>
             <containsregex pattern="^tgt.list.full=(.*),?.*" replace="target=\1" />
             <concatfilter prepend="${cfg.list.file}" />
         </filterchain>
     </loadproperties>
     <echo message="TGT: ${target}, FULL: ${tgt.list.full}"/>
     <fail unless="target" message="A target cannot be determined"/>
 </target> 
```

对于我在“containsregex”任务下列出的当前版本，${target} 会填充完整列表（“word1,word2,word3,word4”），而不仅仅是“word1”。我已经尝试了它们的大量变体。这是一个例子：

```
<containsregex pattern="^tgt.list.full=(word1),?.*" replace="target=\1" /> 
```

我希望这至少会强制填充目标属性，但在这种情况下， ${target} 仍然未定义（甚至没有将完整列表放入其中）。

也许我的过滤器链逻辑存在缺陷。我知道我可能会编写自己的任务，但如果我能更好地理解它们，Ant*似乎*已经拥有我需要的组件。

重新表述我最初的问题：给定 Ant 属性中的逗号分隔列表，我如何使用 Ant 任务（甚至不一定使用 containsregex 或 replaceregex）来提取第一个元素？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-28T01:52:54.603

这个正则表达式会更适合您的需要吗？

```
^tgt.list.full=([^,]+),?.*
^tgt.list.full=([^,]+),?[^\r\n]*$ 
```

由于 ' `.`'（点）表示任何字符，因此 ' `(.*),?.*`' 会选择 word1,word2,... 因为量词的[贪婪](http://www.regular-expressions.info/repeat.html)。 可能 ' ' 会更好，但至少有了，我们知道贪婪的算子不会捕获任何 ' '。`*`
`(.*?),?.*``[^,]+``,`

可能需要第二种形式来确保只捕获*一行*中的内容，而不是“后面的所有内容`,`”（包括下一行，因为 '.' 在 'dotall' 模式下，可以包含 crlf 字符）。

* * *

正如[亚当](https://stackoverflow.com/users/51538/adam)在评论中提到的：

> " `target`" 属性实际上是由 " `${tgt.list.basic},`" 而不是 " `full`" 填充的。
> 因此，在一切解决之后，目标现在由基本列表填充。
> 我将完整列表从 cfg 文件中移出，稍后（而不是立即）由基本列表填充

# delphi - 组件初始化 - 运行时与设计时

> ID：691997
> 
> 赞同：5
> 
> 时间：2009-03-28T01:52:31.560
> 
> 标签：delphi, custom-component

我正在构建一系列视觉复合组件，它们使用类似/常见的“连接”方法，可以在那里启动内部表等。

我正在自动化一些连接内容以在运行时自动连接。在组件级别，我如何判断当前状态是运行时还是设计时？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-28T04:46:14.623

我想你想检查`csDesigning`标志是否存在于组件的`ComponentState`属性中：

```
if csDesigning in ComponentState then
  // designtime
else
  // not designtime 
```***********