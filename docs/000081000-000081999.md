# StackOverflow 问答 000081000-000081999

# windows-server-2008 - 是否可以通过任何稳定的方法在 Windows Server 2008 上启用 ReadyBoost？

> ID：81008
> 
> 赞同：2
> 
> 时间：2008-09-17T08:08:32.617
> 
> 标签：windows-server-2008, development-environment

我知道标准答案是否定的。但是请听出想要它的原因，然后我们将通过启用（和安装）ReadyBoost 或使用第三方软件来确定是否可以达到与 ReadyBoost 相同的效果。

在笔记本电脑上使用 Widows Server 2008 作为开发环境的原因：

1.  64 位，因此您可以充分利用 4GB RAM。
2.  SharePoint 开发人员，因此您可以在本地运行 SharePoint 并成功调试。
3.  Hyper-V，让您获得测试环境的硬件虚拟化，并能够在路上演示存储在 Hyper-V 中的完整解决方案

所以所有这些都等于：笔记本电脑上的 Windows Server 2008 (64)。

现在因为我们正在运行 Hyper-V，我们需要大量的磁盘空间。这意味着我们使用的是 5,000 rpm 250GB 硬盘。

所以我们在笔记本电脑上，我们不能使用固态硬盘，我们只有 4GB 的 RAM 和笔记本电脑主板而不是服务器主板的吞吐量......所有这些都意味着我们没有飞行......这东西不是懒惰的，但也不是活泼的。

Windows Server 2008 基于与 Vista 相同的代码库。Vista 具有ReadyBoost 功能，可以将USB 2 闪存设备用作系统文件的弱缓存，从而显着提高Vista 的性能。由于代码库相似，ReadyBoost 应该可以在 WS2008 上运行，但是微软尚未在 WS2008 中发布或启用 ReadyBoost。

鉴于我们在笔记本电脑上运行 WS2008 作为开发环境，我们如何通过在 Windows Server 2008 中使用闪存设备来实现 ReadyBoost 的性能提升？

为了使答案被接受，它必须概述实现性能增益的端到端过程。

“否”的答案将不被接受，因为我了解一些第三方工具实现了某些功能，但我还没有看到关于如何使用它们的完整端到端描述。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-01T00:12:42.807

对于虚拟机，“你真的需要这么多内存吗”的答案是肯定的。尝试运行 4-6 个虚拟机，每个虚拟机配置为 512MB 或更多，确实会给系统带来压力。

使用任何东西作为附加虚拟内存的能力是关键。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-28T04:01:55.903

好的，所以这不是 ReadyBoost，但最终结果应该非常相似。这是 youtube 上的视频，您可以关注如何在 Vista 上执行此操作 - WS2008 应该没有什么不同。

[http://www.youtube.com/watch?v=A0bNFvCgQ9w](http://www.youtube.com/watch?v=A0bNFvCgQ9w)

此外，您可能需要升级笔记本电脑上的硬盘：

推荐 ST9500420ASG 500GB 7200RPM 16MB SATA 带 G-Shock 传感器

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-29T15:37:49.617

*   安装的所有东西都是64位的吗？
*   您是否具有硬件虚拟化功能，是否在 bios 中打开？
*   [你启用了超取吗？](http://www.ditii.com/2008/03/04/windows-server-2008-enable-superfetch/)
*   [桌面体验的转变。](http://www.tech-recipes.com/rx/2576/windows_server_2008_install_desktop_experience_vista_theme/)
*   最后但并非最不重要的一点是，看看[这篇文章](http://www.synergyonline.com/blog/blog-moss/Lists/Posts/Post.aspx?List=fcb287b5-7a1a-4206-a04f-2a97805e4a25&ID=10)，看看它是否能给你任何指示。

太补充了：看起来没有在 WS2008 上使用 ReadyBoost 的合理方法

# php - 基于数据库的拼写替代方案？

> ID：81021
> 
> 赞同：1
> 
> 时间：2008-09-17T08:10:26.120
> 
> 标签：php, mysql

我正在寻找一种有效的方法（使用 PHP 和 Mysql 数据库）来建议查询的替代拼写。

我知道我可以使用[Yahoo 的 Spelling Suggestion](http://developer.yahoo.com/search/web/V1/spellingSuggestion.html)等服务，但我希望这些建议基于数据库中当前可用的内容。

例如：用户必须填写一个带有“城市”字段的表格，我想确保每个人都会对所述城市使用相同的拼写，（所以我最终不会有人填写“匹兹堡”时他们的意思是“匹兹堡”）。

这只是一个例子，但是，基本上我想搜索数据库中已经存在的条目，其中拼写非常接近用户输入的条目......

关于如何实现这一目标的任何算法、教程或想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T10:30:03.197

我已经使用 pspell [http://uk.php.net/pspell](http://uk.php.net/pspell)包来做到这一点。取搜索词，检查拼写。如果不行，PSPELL 会提出建议。

您甚至可以通过搜索运行建议，计算结果，然后说：您对“foo”的搜索返回了 0 个结果。您的意思是“baz”（12 个结果）还是“bar”（3 个结果）。

如果您担心性能，请仅在搜索返回 0 个结果时执行此操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T08:49:49.177

Maybe this will help [http://jquery.bassistance.de/autocomplete/demo/](http://jquery.bassistance.de/autocomplete/demo/) It uses JQuery (client side) and php (serverside). The example feeds from an array but can be easily modified so it will use a MySQL database.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T08:53:56.110

Spelling alternatives are often implemented by using the [Levenshtein distance](http://www.merriampark.com/ld.htm) between two words (the one the user typed, en the one inside, for example, your database)

here is the pseudocode for the algorithm ([from wikipedia](http://en.wikipedia.org/wiki/Levenshtein_distance)):

```
int LevenshteinDistance(char s[1..m], char t[1..n])
   // d is a table with m+1 rows and n+1 columns
   declare int d[0..m, 0..n]

   for i from 0 to m
       d[i, 0] := i
   for j from 0 to n
       d[0, j] := j

   for i from 1 to m
       for j from 1 to n
       {
           if s[i] = t[j] then cost := 0
                          else cost := 1
           d[i, j] := minimum(
                                d[i-1, j] + 1,     // deletion
                                d[i, j-1] + 1,     // insertion
                                d[i-1, j-1] + cost   // substitution
                            )
       }

   return d[m, n] 
```

and here you can find the *real* implementation for all sorts of languages: [http://en.wikibooks.org/wiki/Algorithm_implementation/Strings/Levenshtein_distance](http://en.wikibooks.org/wiki/Algorithm_implementation/Strings/Levenshtein_distance)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T08:17:54.497

我会在用户键入并按前缀建议时执行此操作（ala Google Suggest）。尝试[一下](http://en.wikipedia.org/wiki/Trie "维基文章")会很好。纠正拼写错误的首字母无济于事，但这种情况非常罕见。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-17T08:44:52.013

MySQL 有一个内置函数来查找 Levenshtein 编辑距离，虽然它很慢。我会使用上面提供的自动完成功能，或者每周左右简单地在事后编辑条目。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T08:23:47.540

请看一下[雅虎！UI 库自动完成组件](http://developer.yahoo.com/yui/autocomplete/)。我认为这正是您正在寻找的。“使用数据源”部分解释了如何使用不同类型的数据源，包括像您这样的基于服务器端的数据源。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T08:41:59.477

看看[Javascript 示例](http://www.javascript-examples.com/autocomplete-demo/)，它列出了 13 个不同的自动完成字段代码。

我在我的一个站点上使用了类似的东西，我基本上在文本框下设置了一个 div 层，当用户键入这个基于 Ajax 的 HTTP 请求到我的 SQL 查询脚本时，它会更新他们键入的每个字母。div 会使用用户可以单击以选择的任何匹配的数据库条目进行更新。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-28T13:53:15.040

我相信[SoundEx](http://en.wikipedia.org/wiki/Soundex "SoundEx 的维基百科解释")比 Levenshtein distance 更合适。

SoundEx 是一个函数，它根据它在英语中发出的声音产生一个单词/短语的哈希值。它非常适合帮助无法拼写匹配规范拼写的人。

我已经非常成功地使用它来查找两个人何时在数据库中注册了同一家公司，名称的变体略有不同。

SoundEx 内置在 MySql 中。[这是一个关于其使用](http://www.madirish.net/?article=85 "在 MySQL 中使用 SoundEx")的教程。

# unix - 如何使用 vi 编辑器在 KornShell 命令行自动完成

> ID：81022
> 
> 赞同：7
> 
> 时间：2008-09-17T08:10:54.903
> 
> 标签：unix, shell, vi, ksh, aix

在**AIX UNIX 版本 5.3**上的 KornShell (ksh) 中，编辑器模式设置为 vi，使用：

```
set -o vi 
```

在 shell 命令行中自动完成文件或目录名称的按键是什么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-17T08:30:02.313

ESC\ 至少在 AIX4.2 上运行良好。我注意到的一件事是它只会自动完成文件名的唯一部分。

因此，如果您有文件 x.txt、x171go 和 x171stop，则会发生以下情况：

```
Press keys:           Command line is:
x                     x
<ESC>\                x
1                     x1
<ESC>\                x171
g<ESC>\               x171go 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-17T19:19:16.450

扩展其他答案： <ESC>* 将在命令行上列出所有匹配的文件。然后您可以使用标准的 vi 编辑命令来删除您不关心的那些。所以要添加到上表中：

```
<ESC><shift-8>             x.txt x171 x171go 
```

然后使用退格键删除最后两个，或再次按 <ESC> 并使用 h 或 b 向后退，并使用 dw 删除您不想要的那些。

# c# - 何时应将类成员声明为虚拟 (C#)/可覆盖 (VB.NET)？

> ID：81052
> 
> 赞同：4
> 
> 时间：2008-09-17T08:15:59.103
> 
> 标签：c#, .net, vb.net

为什么我不选择抽象？声明类成员虚拟有哪些限制？只能将方法声明为虚拟方法吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-17T08:36:39.083

抽象方法或属性（都可以是虚拟的或抽象的）只能在抽象类中声明并且不能有主体，即您不能在抽象类中实现它。

虚拟方法或属性必须有一个主体，即您必须提供一个实现（即使主体为空）。

如果有人想使用您的抽象类，他将必须实现一个继承自它的类并显式实现抽象方法和属性，但可以选择不覆盖虚拟方法和属性。

例子：

```
using System;
using C=System.Console;

namespace Foo
{
    public class Bar
    {
        public static void Main(string[] args)
        {
            myImplementationOfTest miot = new myImplementationOfTest();
            miot.myVirtualMethod();
            miot.myOtherVirtualMethod();
            miot.myProperty = 42;
            miot.myAbstractMethod();
        }
    }

    public abstract class test
    {
        public abstract int myProperty
        {
            get;
            set;
        }

        public abstract void myAbstractMethod();

        public virtual void myVirtualMethod()
        {
            C.WriteLine("foo");
        }

        public virtual void myOtherVirtualMethod()
        {
        }
    }

    public class myImplementationOfTest : test
    {
        private int _foo;
        public override int myProperty
        {
            get { return _foo; }
            set { _foo = value; }
        }

        public override void myAbstractMethod()
        {
            C.WriteLine(myProperty);
        }

        public override void myOtherVirtualMethod()
        {
            C.WriteLine("bar");
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-17T08:18:20.207

如果您不想在基类中定义任何实现并希望强制在任何派生类中定义它，您将使用抽象。如果您想提供可以被派生类覆盖的默认实现，请将其定义为虚拟。

是的，只有方法可以是虚拟的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-17T08:22:01.897

如果存在基本实现，则应将成员声明为虚拟成员，但该功能有可能在子类中被覆盖。Virtual 也可以用来代替 abstract 以允许方法实现是可选的（即基本实现是一个空方法）

将成员设置为虚拟时没有限制，但虚拟成员比非虚拟方法慢。

方法和属性都可以标记为虚拟的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T08:50:49.253

对于 Windows 窗体，这里有一个需要注意的问题。

如果您想要一个可以从中继承的 Control/UserControl，即使您在基类中没有逻辑，您也不希望它抽象，因为否则您将无法在派生类中使用 Designer： [http ://www.urbanpotato.net/default.aspx/document/2001](http://www.urbanpotato.net/default.aspx/document/2001)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T08:17:48.553

如果你想在你的基类中给它一个实现，你就让它成为虚拟的，如果你不这样做，你就让它成为抽象的。

是的，只有方法可以声明为虚拟的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T08:21:48.543

抽象意味着您不能提供默认实现。这反过来意味着所有子类都必须提供抽象方法的实现才能实例化（具体）。

我不确定您所说的“限制”是什么意思，所以无法回答这一点。

属性可以声明为虚拟的，但您也可以在概念上将它们视为方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T08:35:56.280

首先，我会回答你第二个问题。只有方法可以声明为虚拟的。当您希望基类中具有一些默认功能时，您会选择虚拟而不是抽象，但是您希望保留由从您的基类继承的类覆盖此功能的选项。举些例子：

如果您正在实现**Shape**类，您可能会有一个名为**getArea()**的方法，它返回您的形状的面积。在这种情况下，Shape 类中的 getArea() 方法没有默认行为，因此您可以将其实现为**abstract**。将方法实现为抽象将阻止您实例化**Shape**对象。

另一方面，如果你实现类**Dog**，你可能想要实现方法**Bark()**在这种情况下，你可能想要实现一个默认的吠叫声并将它放在**Dog**类中，而一些继承的类，如**Chiwawa**类可能想要重写此方法并实现特定的吠叫声。在这种情况下，方法 bark 将被实现为**虚拟**的，您将能够实例化 Dogs 以及 Chiwawas。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-17T10:45:29.540

您的问题与风格有关，而不是与技术有关。我认为这本书 [http://www.amazon.com/Framework-Design-Guidelines-Conventions-Development/dp/0321246756](https://rads.stackoverflow.com/amzn/click/com/0321246756) 对您的问题和许多其他问题进行了很好的讨论。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-18T09:38:05.637

我个人将大多数方法和属性标记为虚拟。我经常使用代理和延迟加载，所以我不想担心以后会发生变化。

# php - MDB2 断开连接并在重新连接时忘记字符集设置

> ID：81061
> 
> 赞同：0
> 
> 时间：2008-09-17T08:17:59.927
> 
> 标签：php, mysql, pear, mdb2

我们最近调试了一个奇怪的错误。找到了解决方案，但解决方案并不完全令人满意。

我们使用 IntSmarty 本地化我们的网站，并使用我们自己的包装器将本地化的字符串存储在数据库中。IntSmarty 在其析构函数中保存它可能拥有的任何新字符串，从而导致数据库调用。

我们使用 MDB2 的 Singleton 实例对 MySQL 进行查询，连接后我们使用 SetCharset() 函数将字符集更改为 UTF-8。我们发现在进行最终插入时，由 IntSmarty 保存的字符串被解释为 ISO-8859-1。我们仔细查看了查询日志，发现 MySQL 连接在 IntSmarty 的析构函数被调用之前就断开了。然后它重新建立，但在新连接上没有发出“SET NAMES utf8”查询。这导致保存的字符串被 MySQL 解释为 ISO-8859-1。

似乎没有在 MDB2 上设置默认字符集的选项。我们对这个问题的解决方案是更改 MySQL 服务器配置，通过添加

```
init-connect='SET NAMES utf8' 
```

到我的.cnf。这只解决了我们的字符集总是一样的问题。

那么，有什么方法可以防止在所有查询运行之前断开连接？我可以强制 MDB2 实例在其他所有操作之后被破坏吗？

打开持久连接有效，但不是理想的答案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-18T05:47:57.920

来自 PHP5 文档：

> **一旦对特定对象的所有引用被删除或对象被显式销毁或以关闭序列中的任何顺序**调用，就会调用析构函数方法。
> 
>  **[PHP 文档](http://www.php.net/manual/en/language.oop5.decon.php)**

 **（强调我的）

可能发生的情况是您的脚本没有显式销毁对象，因此当 PHP 到达脚本末尾时，它开始以任何感觉的顺序清理事物 - 在您的情况下，首先关闭数据库链接.

如果您在脚本实际结束之前明确销毁 IntSmarty 对象，那应该可以解决您的问题。

# c++ - C++ 中的垃圾收集库

> ID：81062
> 
> 赞同：70
> 
> 时间：2008-09-17T08:18:12.750
> 
> 标签：c++, garbage-collection, libraries

哪些免费和商业垃圾收集库可用于 C++，它们各自的优缺点是什么？

我感兴趣的是从该领域的实际使用中来之不易的经验教训，而不是营销或促销宣传。

无需详细说明与自动垃圾收集相关的通常权衡，但请务必提及使用的算法（引用计数、标记和清除、增量等）并简要总结后果。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-09-17T08:26:43.180

我过去使用过[Boehm 收集器](http://hboehm.info/gc/)并取得了很好的成功。它是开源的，可用于商业软件。

它是一种保守的收集器，由垃圾收集技术领域最重要的研究人员之一开发的历史悠久。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-09-17T09:41:44.437

Boost 有很多[智能指针](http://www.boost.org/doc/libs/1_36_0/libs/smart_ptr/smart_ptr.htm)，它们可以实现引用计数或范围内删除退出或侵入式引用计数。这些已经证明足以满足我们的需求。一个很大的优点是它都是免费的、开源的、模板化的 C++。因为它是引用计数，所以在大多数情况下，当一个对象被销毁时，它是高度确定的。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-17T08:26:31.573

[Boehm 垃圾收集器](https://hboehm.info/gc/)是免费提供的，据说相当不错（我自己没有第一手经验）

[关于Boehm 垃圾收集器的 C++0x 提案的](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2007/n2310.pdf)理论论文（PDF 格式）

最初据说可以制作 C++0x [，但毕竟不会制作](http://herbsutter.spaces.live.com/Blog/cns!2D4327CC297151BB!330.entry)（我想是由于时间限制）。

[不过， Proprosal N2670](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2008/n2670.htm)（对垃圾收集器的最低支持）确实在 2008 年 6 月获得批准，因此随着编译器实现对此有所了解，并且标准最终确定，C++ 的垃圾收集世界肯定会改变......

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-07-29T14:10:40.460

我经常使用 boehm-gc。它使用起来很简单，但是文档真的很差。有一个 C++ 页面，但很难找到。

基本上，您只需确保每个类都继承自它们的基类，并且始终将 gc_allocator 传递给容器。在许多情况下，您希望使用 libgccpp 来捕获 new 和 delete 的其他用途。这些主要是高级更改，我们发现我们可以在编译时使用#ifdef 关闭 GC，并且支持这一点只会影响一两个文件。

我的主要问题是你不能再使用 Valgrind，除非你先关闭收集器。虽然关闭收集器很容易做到，并且不需要重新编译，但如果您开始耗尽内存，显然无法使用它。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-10T05:08:27.823

C++ 中 GC 的主要困难是需要处理 GC 意义上的不合作模块。即，处理从未考虑过 GC 编写的库。

这就是为什么经常建议使用 Boehm GC。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-17T08:27:38.793

我知道的唯一一个是 Boehm，底部是一个传统的标记和扫描。它可能使用各种技术来优化这一点，但通常增量/分代/压缩 GC 将很难为 C++ 创建而不使用托管子集，例如您可以使用 .Net C++ 获得的内容。一些需要移动指针的方法可以通过编译器支持固定指针或读/写块来实现，但是对性能的影响可能太大，而且对 GC 的更改不一定是不重要的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-06-12T14:35:21.753

您还可以使用 Microsoft 的托管 C++。CLR 和 GC 非常可靠并用于服务器产品，但您必须使用 CLR 类型才能让 GC 实际收集 - 您不能只重新编译现有代码并删除所有删除语句。

我宁愿使用 C# 来编写全新的代码，但是托管 C++ 可以让您以更渐进的方式发展您的代码库。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-06-12T14:25:35.507

这是我在寻找同样的东西时发现的商业产品

HnxGC [http://hnxgc.harnixworld.com/](http://hnxgc.harnixworld.com/)

过去，Geodesic Systems 还推出了一款名为 Great Circle 的产品，但看起来他们不再销售了。不知道是否将产品卖给了其他人。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-06-12T15:02:24.760

阅读[本文](http://stlab.adobe.com/wiki/index.php/Argument_Against_GC)并仔细查看结论：

> 结论
> 
> *   问题的复杂解决方案，简单的解决方案被广泛使用，并将由 C++0x 改进，使我们几乎不需要。
>     
>     
> *   对于要标准化的推荐语言功能，我们几乎没有经验。
>     
>     
> *   修复糟糕的软件复杂系统永远不会奏效。
>     
>     
> *   建议对语言进行较小的更改以改进未来的 GC 支持 - 以禁止隐藏指针（异或列表技巧）为例。
>     
>     
> *   最后 - 正面解决“C++ 不好，因为它没有 GC”参数。**C++ 不会产生垃圾，因此不需要 GC**。显然，Java、C#、Objective C 等会产生大量垃圾。

是的，最后一句话是主观的，也是圣战的一部分。
我使用 C++ 是因为我不喜欢有人需要为我倒垃圾的想法。
市政厅就是这样做的，这对我来说就足够了。
如果您需要 GC，请使用另一种语言。为正确的工作选择正确的工具。

# c# - 是否有比 TextWriter/StringBuilder 更高效的文本假脱机程序

> ID：81067
> 
> 赞同：4
> 
> 时间：2008-09-17T08:18:31.267
> 
> 标签：c#, .net, performance, string, data-structures

对于像增量捕获文本这样的情况，例如，如果您在呈现页面时接收所有 output.write 调用，并且这些调用通过字符串构建器附加到文本编写器中。

有没有更有效的方法来做到这一点？dotnet 中已经存在的东西最好？特别是如果总大小超过一百千。也许更像是页面数组而不是连续内存？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T08:40:20.450

我认为 StringBuilder 是在 .net 中附加文本的最有效方式。为了提高效率，您可以在创建 StringBuilder 时指定它的初始大小。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-12T18:08:53.020

这取决于您对该文本的处理方式。

如果关注的是跟踪或日志记录，我会说您最好的选择是使用 ETW（Windows 事件跟踪）。它是自 Windows 2000 以来内置于 Windows 中的内核级跟踪工具，它比文件 I/O 快得多。

如果您不使用 .NET 2.0，则必须做一些 win32 API 工作才能使用它，并且必须创建一个在系统上注册的提供程序类。这有点复杂，但值得努力。

如果您使用的是 .NET 3.5，则可以在 System.Diagnostics.Eventing 中找到托管的 Etw 类。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T14:38:46.623

这是最好的。您可以使用 StringWriter 但它仍在写入 StringBuilder

# c# - 在 Visual Studio 2005 中构建解决方案时访问被拒绝错误

> ID：81071
> 
> 赞同：4
> 
> 时间：2008-09-17T08:18:41.763
> 
> 标签：c#, visual-studio-2005

在进行构建时，我在 Visual Studio 2005 中收到以下错误：

> 错误 9 无法注册程序集“E:\CSharp\project\Some.Assembly.dll” - 访问被拒绝。访问被拒绝。（来自 HRESULT 的异常：0x80070005 (E_ACCESSDENIED)）项目

它只是间歇性地发生，并且如果我重新启动 IDE 就会消失，但是这非常烦人，如果可以的话，我想永久阻止它发生。我检查了程序集本身，它没有设置为只读，所以我不知道为什么 Visul Studio 会锁定它。我正在调试模式下工作。

我环顾了谷歌，但除了“重启VS”之外似乎找不到任何东西。有人对我如何解决这个烦人的问题有任何建议吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-17T08:20:18.080

听起来你有一个不时被锁定的 DLL，防止 VS 覆盖/锁定它。您是否尝试过使用 Process Explorer ( [http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx) ) 或 Unlocker ( [http://www.emptyloop.com/unlocker/](http://www.emptyloop.com/unlocker/) ) 等工具来查看是什么锁定DLL？特别是 Unlocker 为我节省了很多时间。

如以下评论中所述（感谢[Jeff](https://stackoverflow.com/users/1/jeff-atwood)），您还可以从 Process Explorer 中终止单个锁。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2018-11-05T10:45:12.137

这可能是由于 Visual Studio 需要 Windows 7 或更高版本的管理员权限造成的。要检查，请查看是否设置了下面提到的注册表项。如果没有，请复制到 a`.reg`并合并。请务必检查`.reg`文件中的 Visual Studio 2005 安装路径是否正确！

```
Windows Registry Editor Version 5.00

; Run Visual Studio 2005 with administrator rights
; This is required to run / debug the program directly from the IDE
[HKEY_CURRENT_USER\Software\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\Layers]
"C:\\Program Files (x86)\\Microsoft Visual Studio 8\\Common7\\IDE\\devenv.exe"="~ RUNASADMIN" 
```

# networking - 在 windows 上将 192.168.0.10 映射到 127.0.0.1

> ID：81073
> 
> 赞同：1
> 
> 时间：2008-09-17T08:18:49.847
> 
> 标签：networking, hosts

我需要从家里访问一个 svn 存储库，它在工作网络中的 IP 192.168.0.10 下运行。我可以建立到我的本地主机的 SSH 隧道。现在我必须以某种方式映射 192.168.0.10，而不是访问 127.0.0.1。有人知道在 Windows 下执行此操作的方法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T08:51:06.290

TortoiseSVN allows you to relocate your repository

[http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-relocate.html#tsvn-dug-relocate-dia-1](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-relocate.html#tsvn-dug-relocate-dia-1):

> If your repository has for some reason changed it's location (IP/URL). Maybe you're even stuck and can't commit and you don't want to checkout your working copy again from the new location and to move all your changed data back into the new working copy, TortoiseSVN → Relocate is the command you are looking for. It basically does very little: it scans all entries files in the .svn folder and changes the URL of the entries to the new value.

Or you can use svn command:

> svn switch --relocate From_URL To_URL

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-02T08:23:19.737

当你在工作时，编辑你的 HOSTS 文件以使 svn = 192.168.0.10; 当您在家时，将其编辑为 svn = 127.0.0.1，然后通过使用“svn”作为服务器名称来访问它。

或者，在需要时使用“svn switch --relocate”命令更改存储库位置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T06:04:49.847

我想我以前也遇到过同样的情况，不过我必须找到确切的配置。

您可以从[PuTTY Portable](http://portableapps.com/apps/internet/putty_portable "腻子便携式")开始，它支持 SSH，您可以将本地 IP“重定向”到远程 IP。

据我记得，当你运行 PuTTY 时，你可以：

1.  首先指定您的本地地址和端口（这将是您指向 SVN 客户端的位置，例如 Tortoise）
2.  然后转到 Connection->SSH->Tunnels-> 指定要重定向的源端口（同上），然后指定目标 IP 和端口并单击添加

我认为应该是这样，我已经有一段时间没有这样做了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T08:21:55.673

您可以引用 DNS 名称吗？您可以覆盖主机文件 (C:\windows\system32\drivers\etc\hosts) 中 DNS 名称的 IP 地址。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T08:23:33.423

我不确定这是否可能。您可以做的是引用 DNS 名称。[您可以使用主机文件](http://en.wikipedia.org/wiki/Hosts_file)更改 DNS 名称指向的 IP 。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T08:24:30.097

编辑您的主机文件位于`%SystemRoot%\system32\drivers\etc\`

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T08:28:58.900

据我了解，问题是您在笔记本电脑（或其他计算机）上签出了一个颠覆存储库，您在工作中使用 ip 地址 192.168.0.10 签出，现在您在家并想使用它。

就个人而言，我不会尝试任何花哨的网络重新排序（或修改主机文件），而只是使用 SSH 隧道再次检查机器上存储库的新副本。这样您就可以从 127.0.0.1 地址检查源。然后，如果您需要移动更改，您可以在两个签出的副本之间使用补丁。诚然，这不是最理想的解决方案，但它可以让你快速前进，而不会搞砸太多。

尽管更好的解决方案是说服工作允许使用更好的方法访问存储库（使用正确的密码、身份验证、SSL 等），例如使用 dav_svn/webdav 的 apache。

如果他们不这样做，请尝试让他们提供 VPN，以便您可以使用工作 IP 地址继续使用存储库。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-17T08:31:04.217

为什么不直接通过 127.0.0.1 访问 svn？这肯定是一个更好的解决方案吗？

如果我理解正确，您在这里面临几个问题。只有一种方法可以完成这项工作，即让您的家用计算机的地址为 192.168.0.10。然后，使用 192.168.0.10 而不是 127.0.0.1 指定 ssh 本地地址。

远程 ssh 连接也将通过 192.168.0.10。

例如，ssh -l work_user -L 192.168.0.10:svn:192.168.0.10:svn work_ssh_host

OpenSSH 可以使用这种语法。

如果我正确理解您的情况，这就是全部。

更优雅的解决方案是使用 OpenVPN，并通过 VPN 路由连接。

# javascript - 使用 Javascript 检测 Google Chrome 的基于安全功能的方法？

> ID：81099
> 
> 赞同：16
> 
> 时间：2008-09-17T08:24:00.240
> 
> 标签：javascript, browser, google-chrome

正如标题所述，我有兴趣找到一种基于安全功能（即，不使用 navigator.appName 或 navigator.appVersion）的方法来检测 Google Chrome。

我所说的基于特征的意思是，例如：

```
if(window.ActiveXObject) {
    // internet explorer!
} 
```

**编辑：**正如已经指出的那样，这个问题没有多大意义（显然，如果你想实现一个特性，你测试它，如果你想检测一个特定的浏览器，你检查用户代理），对不起，现在是早上 5 点 ;) 让我这样说：是否有任何 JavaScript 对象和/或 Chrome 独有的功能...

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-09-17T15:45:51.550

```
isChrome = function() {
    return Boolean(window.chrome);
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-05-18T06:43:24.447

[**这个答案非常过时**，但在当时的石器时代非常相关。]

[我认为特征检测比 navigator.userAgent 解析更有用，因为我在这里](http://www.javascriptkit.com/javatutors/navigator.shtml "这里")搜索了Opera ambiguosity 。没有人知道 IE16 是否会解析 /MSIE 16.0;/ 正则表达式 - 但我们可以肯定，会有 document.all 支持。在现实生活中，这些特性通常是浏览器的同义词，例如：*“No XMLHttpRequest？It is the f..d IE6！”* 没有非IE浏览器支持document.all，但是像傲游这样的浏览器可以打乱userAgent。（当然脚本可以出于某种原因在Firefox中定义document.all，但它很容易控制。）因此我建议这个解决方案。

**编辑** [在这里](http://www.javascriptkit.com/javatutors/objdetect3.shtml "这里")我找到了完整的资源。

**编辑 2**我已经测试过 Opera 也支持 document.all ！

```
var is = {
  ff: window.globalStorage,
  ie: document.all && !window.opera,
  ie6: !window.XMLHttpRequest,
  ie7: document.all && window.XMLHttpRequest && !XDomainRequest && !window.opera,
  ie8: document.documentMode==8,
  opera: Boolean(window.opera),
  chrome: Boolean(window.chrome),
  safari: window.getComputedStyle && !window.globalStorage && !window.opera
} 
```

使用很简单：

```
if(is.ie6) { ... } 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-17T08:27:22.087

不完全是问题的答案......但如果您试图检测特定的浏览器品牌，那么功能检查的意义就有点丢失了。我非常怀疑任何其他浏览器都在使用 Chrome userAgent 字符串，所以如果你的问题是“这个浏览器是 Chrome”，你应该看看那个。（顺便说一句，window.ActiveXObject 不保证 IE，有其他浏览器的插件提供此对象。哪种说明了我试图提出的观点。）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-24T17:58:40.510

对于所有的标准纳粹...有时您可能想要使用不只是标准的出血“标准技术”，但它们将是...例如 css3 功能。

这就是我找到这个页面的原因。

出于某种原因，Safari 可以很好地运行边框半径与框阴影的组合，但 chrome 无法正确呈现组合。因此，即使是 webkit 禁用组合，找到一种检测 chrome 的方法也会很好。

我遇到了数百个理由来检测特定的浏览器/版本，这通常最终会放弃一个很酷的功能的想法，因为我想做的事情不受大恶魔的支持......

但有时，有些功能太酷了，即使它们还没有标准化，也不能使用它们。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-17T08:38:20.157

因此，如果您接受 Marijn 的观点并*有*兴趣通过 javascript 测试用户代理字符串：

`var is_chrome = navigator.userAgent.toLowerCase().indexOf('chrome') > -1;`

（归功于：[http](http://davidwalsh.name/detecting-google-chrome-javascript) ://davidwalsh.name/detecting-google-chrome-javascript ）

* * *

这是 chromes 用户代理字符串的一个非常好的分析/分解：[http ://www.simonwhatley.co.uk/whats-in-google-chromes-user-agent-string](http://www.simonwhatley.co.uk/whats-in-google-chromes-user-agent-string)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-05-18T07:22:45.363

我经常使用行为/能力检测。在解决它之前直接检查浏览器是否支持功能，而不是根据浏览器的名称（用户代理）来解决它。

特定于浏览器的解决方法的一个问题是，您不知道该错误是否已修复或该功能现在是否受支持。当您进行功能检测时，您*知道*浏览器是否直接支持它，并且您不仅仅是浏览器专家。

[http://diveintohtml5.ep.io/everything.html](http://diveintohtml5.ep.io/everything.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T15:52:47.057

您不应该专门检测 Chrome。如果有的话，您应该检测到 WebKit，因为就页面渲染而言，Chrome 的行为应该与其他 WebKit 浏览器（Safari、Epiphany）完全一样。

如果您不仅需要检测 WebKit，还需要准确了解正在使用的版本，请参阅此链接：[http ://trac.webkit.org/wiki/DetectingWebKit](http://trac.webkit.org/wiki/DetectingWebKit)

但是，正如上面其他人所说，您不应该检测浏览器，而应该检测功能。有关更多信息，请参阅此 ADC 文章：http: [//developer.apple.com/internet/webcontent/objectdetection.html](http://developer.apple.com/internet/webcontent/objectdetection.html)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-24T16:38:43.727

您可能需要了解 Chrome 浏览器的原因之一是因为它“非常”符合标准。我已经遇到了我认为符合标准的旧 JavaScript 代码的问题（通过 FF 或 Opera 标准——这非常好），但 Chrome 更加挑剔。它迫使我重写一些代码，但有时使用 if(isChrome) { blah...blah ) 技巧可能更容易让它运行。Chrome 似乎运行良好（我支持标准合规性），但有时您只需要详细了解用户正在运行的内容。

此外，Chrome 的速度非常快。问题是，一些 JavaScript 代码无意中依赖于其他浏览器的缓慢才能正常工作，即：页面加载、iframe 加载、样式表链接的放置和页面头部中的 javascript 链接等。当函数真正可用时，这些可能会导致新问题与页面元素交互。所以现在，你真的可能需要知道...

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-26T16:46:34.177

我使用此代码为每个浏览器制作书签（或为 webkit 显示一条消息）

```
如果（window.sidebar）{
// Mozilla Firefox 书签
window.sidebar.addPanel(title, url,"");
} else if( window.external ) { // IE 收藏夹
  如果（窗口。ActiveXObject）{
  //IE
  window.external.AddFavorite（网址，标题）；
  } 别的 {
  //铬合金
  alert('点击确定后按 ctrl+D 加入书签（Mac 为 Command+D）');
  }
} else if(window.opera && window.print) {
// 歌剧
  返回真；}
 否则 { //萨弗里
 alert('点击确定后按 ctrl+D 加入书签（Mac 为 Command+D）'); }

```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-06-20T07:26:56.533

`window.chrome`由于歌剧也有对象，因此可能存在误报。作为我使用的一个很好的解决方案；

```
var isOpera = !!window.opera || !!window.opr;// Opera 8.0+

var isChrome = !!window.chrome && !isOpera; 
```

这个解决方案几乎总是有效的。但是我发现的一件事是，在 iPad Chrome 版本 52.0 中以 return 的形式`isChrome`返回。`false``window.chrome``false`

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2010-07-07T17:39:58.087

isIE: !!(!window.addEventListener && window.ActiveXObject),

isIE6: typeof document.createElement('DIV').style.maxHeight == "undefined",

isIE7: !!(!window.addEventListener && window.XMLHttpRequest && !document.querySelectorAll),

isIE8: !!(!window.addEventListener && document.querySelectorAll && document.documentMode == 8),

isGecko: navigator.product == 'Gecko',

isOpera: !!window.opera,

isChrome: !!window.chrome,

isWebkit: !!(!window.opera && !navigator.taintEnable && document.evaluate && navigator.product != 'Gecko'),

# .net - .NET 数字文本框

> ID：81104
> 
> 赞同：0
> 
> 时间：2008-09-17T08:24:51.843
> 
> 标签：.net, textbox, numerical

有谁知道为什么 Microsoft 不使用其 .NET 框架提供数字文本框，例如确保输入的字符始终是有效数字的文本框？这是在不同风格的应用程序中常用的东西，实际上是大多数 GUI 库（嗯，我知道的那些）以某种方式提供的东西。虽然编写自己的代码并不难，但也不是微不足道的*。*

所以，我很想知道是否有人可以为这种遗漏合理化。

编辑：感谢您的建议。虽然蒙面文本框和数字上下有它们的位置；我对一个看起来像文本框但在按键时自动执行验证输入对应于有效数字的控件感兴趣。在我的（诚然有限的）经验中，这是使用了很多的东西（我们并不总是想要由蒙面文本框施加的静态约束，就像我们并不总是想要侧面的上下控件一样） .

网上有很多质量不同的实现，实际上在[MSDN](http://msdn.microsoft.com/en-us/library/ms229644.aspx)上甚至有一个例子。

编辑2：谢谢大家，所以听起来数字上下是仅用于数字输入的.NET控件（以及我们实际上没有显式数字文本框控件的原因）。如果它自动禁止输入非数字字符（按键、粘贴等），那就太好了，但我想它在控件失去焦点时执行验证已经足够了。而且，如果一个人真的很热心，可以在按键上进行粘贴验证......

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-17T08:29:45.530

您可以使用[MaskedTextBox](http://msdn.microsoft.com/en-us/library/system.windows.forms.maskedtextbox.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-17T09:09:11.660

我第二次 Garry Shutlers 建议使用 NumericUpDown。您可能不喜欢上下控件，但这*是*Windows 中数字输入控件的标准外观，您应该三思而后行使用不同的外观。

如果您最终编写自己的实现代码（或在网络上找到一个），则需要注意一些陷阱。请记住，除了按键之外，还有许多方法可以让值进入控件。您在 MSDN 上的链接中的那个甚至不会覆盖粘贴，因此您可以轻松地 ctrl-V 将非数字字符串放入控件中。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-17T08:26:43.493

有一个[NumericUpDown](http://msdn.microsoft.com/en-us/library/system.windows.forms.numericupdown.aspx)控件，专门用于输入数字，可以像 TextBox 一样使用。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-17T08:31:10.877

从 WinForms 2.0 开始，您有一个 MaskedTextBox。您可以将掩码设置为您想要的任何内容，即数字使用掩码全为 0。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-17T10:31:51.053

奇怪的是，某些 .NET Framework 控件并未公开它们封装的底层 Windows 控件的所有功能。在这种情况下，由于某种原因，该`ES_NUMBER`样式尚未实现。

您可以处理 HandleCreated 事件（或覆盖 OnHandleCreated，因为 TextBox 未密封）并调用[SetWindowLong](http://www.pinvoke.net/default.aspx/user32/SetWindowLong.html)`ES_NUMBER`以在基础 Edit 控件上设置样式。`ES_NUMBER`在 WinUser.h 中定义为 0x2000。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T09:20:37.543

您还可以派生 TextBox 类并获取键盘事件并确保只写入数字。

如果它是一个网页，那么对使用 Javascript 的 html 文本框也是如此。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T10:14:10.583

Microsoft 将其留给第 3 方来填补工具箱中缺少控件的空白。我想时间和成本会成为他们的理由。

但是，在这种情况下，我认为[FilteredTextBox](http://www.asp.net/ajax/ajaxcontroltoolkit/Samples/FilteredTextBox/FilteredTextBox.aspx)提供了您描述的功能。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-18T02:04:40.097

基于第二次编辑：

[Windows 窗体常见问题解答](http://www.syncfusion.com/faq/windowsforms/default.aspx)告诉您如何在问题[26.12](http://www.syncfusion.com/faq/windowsforms/faq_c94c.aspx#q830q)中限制文本框中的字符：

**26.12 如何限制我的文本框可以接受的字符？**

*您可以处理文本框的 KeyPress 事件，如果传入的字符不可接受，则将 events 参数标记为显示该字符已被处理。下面是一个派生的 TextBox，它只接受数字（和控制字符，如退格，...）。即使该片段使用派生文本框，也没有必要，因为您只需将处理程序添加到其父表单即可。*

有关代码示例，请参阅常见问题解答。

# asp.net - ASP.net 的运行时页面优化器 - 有什么意见吗？

> ID：81108
> 
> 赞同：2
> 
> 时间：2008-09-17T08:25:33.777
> 
> 标签：asp.net, javascript, optimization

RPO 1.0（运行时页面优化器）是最近（今天？）发布的 ASP 和 Sharepoint 组件，它压缩、组合和缩小（我不敢相信这是一个真实的词）Javascript、CSS 和其他东西。

有趣的是，它是为去年在 TechEd 上看到的新西兰商店 ActionThis.com 开发的。他们建立了一个站点，由于部署规模，该站点很快就需要缩减，这似乎是其中一些努力的结果。

有人有意见吗？这值得评价吗？

[http://www.getrpo.com/Product/HowItWorks](http://www.getrpo.com/Product/HowItWorks)

**更新** 我昨天下载了这个并在我们的网站上试了一下。该站点很大，很复杂，并且使用了大量的 javascript、css、ajax、jquery 等以及 URL 重写器等。安装太容易了，我不得不用头撞它几次才能让它工作。诀窍... web.config 中正确位置的条目并仔细阅读 AdvancedSetup.txt 以手动翻转设置。**该网站大部分都**正确呈现，但有一些问题可能是由于命名关闭 css 分类 - 它需要密切关注和大量测试以确保它适合，但到目前为止它看起来不错并且非常值得成本。

**第二次更新**我们正忙于尝试连接 RPO。字符编码以及我们的某些脚本的组成可能存在一些问题。必须指出，供应商的响应和支持非常积极和主动

**第三次更新**我继续着手将 RPO 集成到我参与的站点中。虽然有一些小问题，但 RPO 人​​员非常乐于助人，并付出了很多努力来改进产品并使其适合在我们的环境中。使用 RPO 绝对是一件轻而易举的事 - 功能成本意味着继续实施它很简单。任务完成。继续下一个任务

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T11:26:04.653

在评估了一下之后，我决定再次回答这个问题。

*   图像组合真的很棒
*   CSS 和 Javascript 被很好地缩小了
*   所有文件都缓存在服务器上，这意味着服务器不会在每次发出请求时都被缓存
*   缓存是在浏览器级别执行的，这意味着如果您使用旧的（不受支持的）浏览器，它仍然可以工作，因为您只会收到未压缩的页面
*   您可以自己查看[优化](http://www.getrpo.com/?rpo=on)与未优化的[区别](http://www.getrpo.com/?rpo=off)

价格如下...

*   9 月底之前的 499 美元是一笔不小的数目
*   每年续订 199 美元很划算

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-17T09:46:18.997

我喜欢 RPO 即插即用的方式。创建像他们这样的模块需要时间，并且取决于工作量，每年 750 美元的价值与重新创建它所需的开发时间相比。

我对 RPO 和审查它对我的网站的影响感到非常兴奋。

我最近使用的东西是我在[Darksider 的](http://www.darkside.co.za/archive/2008/03/03/web-page-optmisation-using-httpmodule.aspx)博客上找到的页面优化模块。它不像 RPO 所要实现的那样激烈，但如果这是您所追求的，那么它是构建您自己的优化模块的一个很好的起点。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-17T22:12:23.087

澄清 RPO 价格。到 2008 年 9 月末的发布价格为 499 美元 - 此折扣是通过优惠券（发送电子邮件至 service@getrpo.com 以获得优惠券）。这包括 12 个月的软件保障，之后您可以选择以 199 美元的价格续订或不续订 - 软件仍然有效。

RPO 自动化了 Steve Souders/Yahoo 的 8 条高性能网站原则——对我们来说重要的是制作一个对开发人员友好的工具——您可以将资源保持在对开发有意义的格式和结构中，并且优化发生在运行时。我不想向这个论坛发送销售信息的垃圾邮件，所以如果您有任何问题，请给我发电子邮件 - ed.robinson@aptimize.net。感谢您查看 RPO。

Aptimize Ltd 首席执行官 Ed Robinson

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-21T14:21:28.583

自测试版以来，我一直是 RPO 的用户，并在我的两个网站上愤怒地部署它： [http](http://www.syringe.net.nz) ://www.syringe.net.nz （我的博客）和 [http://www.medrecruit.com](http://www.medrecruit.com)（A我感兴趣的公司）

我写了一篇冗长的博文，为什么不在这里打开缓存问题： [http ://www.syringe.net.nz/2008/10/21/RuntimePageOptimizerWhyNotJustEnableCachingInIIS.aspx](http://www.syringe.net.nz/2008/10/21/RuntimePageOptimizerWhyNotJustEnableCachingInIIS.aspx)

简短的摘要版本-缓存对于那些没有真正准备好在 IIS 中打开它的人来说是一个很好的选择（在 IIS6 中仍然不是超级容易）......真正的力量在于组合资源，因为它的延迟 * 请求计数真的会扼杀你的表现。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-17T09:21:31.317

压缩和压缩通常称为脚本和样式表是完全值得的 - 文件大小的减少不言自明。这是您可以通过您的网络服务器完成的事情，无需其他产品的帮助。

然而，从一般的“请求越少越好”的角度来看，合并脚本和样式并将它们一起服务是一个有趣的想法。

它看起来很有趣——我会尝试一下。几乎可以肯定它不会受到伤害。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T09:17:53.620

只是看了一下，他们提供的很多东西你应该能够自己做一点计划和远见（结合所有 javascript 文件，结合所有 css，缩小，启用 GZip ......

每年 750 美元似乎有点贵，而且别无选择。

（编辑）在与营销机构交谈后，到 9 月底是 499 美元，续订许可证将是 199 美元。这让我更有说服力！

我要试一试，然后看看它对我们的 DEV 服务器有多大的改进。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T18:18:09.203

我个人一直在使用 Snapsis 的一款名为[PageBlaster 的](http://www.snapsis.com/Default.aspx?tabid=589&CATReferrer=3780)产品，它可以进行缓存、缩小。它主要用于 DotNetNuke 应用程序，但如果我没记错的话，它可以与任何 ASP.NET 应用程序一起使用，而且价格合适......

# java - 阅读 Firefox 3 书签

> ID：81132
> 
> 赞同：6
> 
> 时间：2008-09-17T08:29:31.567
> 
> 标签：java, sqlite, parsing, firefox-3, bookmarks

Firefox 3 将书签存储在 sqlite 数据库中。有几个黑客可用的 sqlite java 库。有没有办法破解java中的sqlite数据库（不使用库）来可靠地读取书签？有人知道如何以编程方式存储和访问 sqlite DB（来自 java）吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-17T08:34:26.873

您需要[SQLite JDBC 驱动程序](http://www.zentus.com/sqlitejdbc/)（本页说明如何在 Java 中使用该驱动程序在 SQLite 数据库上运行查询）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-17T14:15:29.177

我不知道为什么您不需要使用 JDBC 驱动程序，但根据您的软件要求，还有另一种可能的“解决方案”。在 FF3 中，在地址栏中输入 about:config

将属性值：browser.bookmarks.autoExportHTML 更改为 true。

这将在您关闭 FF 时以 HTML 格式导出您的书签。然后，您可以阅读 HTML。它可能会或可能不会解决您的问题......

# c# - 在 c# 中处理全局热键的最佳方法是什么？

> ID：81150
> 
> 赞同：24
> 
> 时间：2008-09-17T08:32:48.360
> 
> 标签：c#, global, hotkeys

> **可能重复：**
> [如何使用 WPF 和 .NET 3.5 注册全局热键以说出 CTRL+SHIFT+(LETTER)？](https://stackoverflow.com/questions/48935/how-can-i-register-a-global-hot-key-to-say-ctrlshiftletter-using-wpf-and-ne)

我想在我的新应用程序中有多个全局热键（从 Windows 中的任何位置控制应用程序），并且我在网络上找到的所有给定源/解决方案似乎都提供了一种跛行解决方案（两种解决方案仅适用于一个 g.hotkey，或者在运行时会在屏幕上产生烦人的鼠标延迟的解决方案）。

这里有没有人知道可以帮助我实现这一目标的资源，我可以从中学习？任何事物？

谢谢 ！:)

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2010-04-10T00:34:38.813

我发现的最好的解决方案是[http://bloggablea.wordpress.com/2007/05/01/global-hotkeys-with-net/](http://bloggablea.wordpress.com/2007/05/01/global-hotkeys-with-net/)

```
Hotkey hk = new Hotkey();

hk.KeyCode = Keys.1;
hk.Windows = true;
hk.Pressed += delegate { Console.WriteLine("Windows+1 pressed!"); };

hk.Register(myForm); 
```

请注意如何为不同的热键设置不同的 lambda

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-17T09:08:29.197

[http://www.codeproject.com/KB/cs/CSLLKeyboardHook.aspx](http://www.codeproject.com/KB/cs/CSLLKeyboardHook.aspx)

如果您不使用 .net 3.5。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-11T00:01:38.637

我将通过使用 P/Invoke 为每个热键调用 RegisterHotKey() 来处理这个问题，然后使用 NativeForm（假设您使用的是 WinForms）来接收 WM_HOTKEY 消息的通知。这应该将您的大部分热键代码保存在一个地方。

# ms-access - 如何确定我的 MS Access 数据库中使用的编码系统

> ID：81154
> 
> 赞同：3
> 
> 时间：2008-09-17T08:34:17.467
> 
> 标签：ms-access

我有一个 MS Access 数据库，如何确定数据库中使用了哪些编码字符？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T08:36:01.240

自（至少）2000 版以来，ACCESS 数据库都使用 UTF-8 编码

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2015-05-25T21:15:12.460

我认为默认情况下它是 Windows 特定的 ANSI“编码”，更多细节在这里：

[https://stackoverflow.com/a/701920/2230844](https://stackoverflow.com/a/701920/2230844)

在这个答案的第二部分：

[https://stackoverflow.com/a/24893224/2230844](https://stackoverflow.com/a/24893224/2230844)

我有一个案例，因为省略号字符，ACCESS 数据库（.mdb）在 Python 2 中不“适合”ASCII，并且`str.encode('dbcs')`为我工作。不是 UTF-8！

# c++ - XP 上的文件：关闭“最后访问时间”是否安全？

> ID：81158
> 
> 赞同：6
> 
> 时间：2008-09-17T08:34:42.960
> 
> 标签：c++, performance, file-io, windows-xp

我正在拼命寻找便宜的方法来降低我家用 PC 的构建时间。我刚刚阅读了[一篇关于在 Windows XP 上禁用文件的 Last Access Time 属性](http://www.axantum.com/Blog/post/How-to-make-a-file-read-in-Windows-not-become-a-write.aspx)的文章，这样简单的读取就不会将任何内容写回磁盘。

> 这也很简单。在 DOS 提示符下写入：
> 
> `fsutil behavior set disablelastaccess 1`

有没有人在**构建 C++ 项目**的环境中尝试过它？有什么缺点吗？

[编辑] 更多关于[这里](http://www.windowsdevcenter.com/pub/a/windows/2005/02/08/NTFS_Hacks.html)的主题。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-17T11:02:27.847

来自[SetFileTime 的文档](http://msdn.microsoft.com/en-us/library/ms724933(VS.85).aspx)：

“NTFS 将文件的最后一次访问时间的更新延迟到最后一次访问后一小时。”

关闭它没有任何意义 - 原始文章是错误的，数据并未在每次访问时都写出。

编辑：

至于为什么那篇文章的作者声称加速了 10 倍，我认为他将他的加速归因于错误的事情：他还禁用了 8.3 文件名生成。要为文件生成 8.3 文件名，NTFS 基本上必须依次生成每种可能性，然后查看它是否已经在使用中（没有参考；我确信[Raymond](http://blogs.msdn.com/oldnewthing/)已经讨论过它，但找不到链接）。如果您的文件都共享相同的前六个字符，那么您将被这个问题所困扰，并且推论是您应该将区分文件的字符放在前六个字符中，这样它们就不会发生冲突。关闭短名称生成将防止这种情况发生。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-17T08:37:37.913

**我还没有在 Windows 机器上尝试过这个（我今晚会，谢谢），但是 Linux 上的类似事情（安装驱动器时的 noatime 选项）大大**加快了速度。

除了用于审计目的之外，我想不出最后一次访问时间有用的任何用途，即便如此，Windows 是否会存储访问它的用户？我知道Linux没有。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-17T08:40:06.330

我建议你尝试一下，看看它是否有所作为。

但是我对这实际上会产生什么影响感到悲观，因为在更大/干净的构建中，无论如何您都会写出大量数据，因此调整文件访问时间不会花费太多时间（加上它可能无论如何都要缓存）。

不过，我很想被证明是错误的。

* * *

**结果：**

在启用和禁用最后访问时间的调试和发布配置中，在工作中的代码库上运行了一些构建。

我们的源代码大约为 39 MB（磁盘大小为 48 MB），我们为我为这些测试构建的配置构建了大约一半的代码。调试版本生成了**1.76 GB**的临时和输出文件，而发布版本生成了大约 600 MB 的此类数据。我们使用 Ant 和 Visual Studio 命令行构建工具的组合在命令行上构建。

我的机器是 Core 2 Duo 3GHz，4GB 内存，7200rpm 硬盘，运行 Windows XP 32 位。

> 禁用上次访问时间的建筑物：
> 
> 调试时间 = 6:17、5:41
> 
> 发布时间 = 6:07、6:06
> 
> 启用最后访问时间的构建：
> 
> 调试时间 = 6:00、5:47
> 
> 发布时间 = 6:19、5:48

总的来说，我没有注意到这两种模式之间有任何区别，因为在这两种情况下，文件很可能已经在系统缓存中，所以它应该只是从内存中读取。

我相信，只要实现适当的预编译头文件（而不是 Visual Studio 在项目中创建的自动生成的头文件），您将获得最大的收益。几年前我们在工作中实现了这一点（当时代码库要小得多），它将我们的构建时间减少到原来的三分之一。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T09:14:12.613

这是一个很好的选择，但它会影响一些工具。像远程存储服务和其他依赖文件访问统计来优化文件系统的实用程序（即 Norton Defrag）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T13:17:11.377

我不想将注意力从“最后访问时间”问题上移开，但可能还有其他方法可以加快构建速度。不知道上下文和您的项目设置，很难说什么可能很慢，但可能有一些事情可能会有所帮助：

创建“超级”构建。也就是说，创建一个包含一堆行的单个编译 uber.cpp 文件，例如

```
#include "file1.cpp"
#include "file2.cpp" 
```

您可能会遇到静态变量名称冲突的问题，但这些通常很容易解决。初始设置有点痛苦，但构建时间会显着增加。对我们来说，最大的缺点是在开发人员工作室中，如果该文件是 uber 构建的一部分，您不能右键单击文件并说“编译”。不过这没什么大不了的。我们为“uber”构建提供了单独的构建配置，它们编译了 uber 文件，但从构建过程中排除了单个 cpp 文件。如果您需要更多信息，请发表评论，我可以为您提供。此外，优化器倾向于在 uber 构建中做得更好。

另外，您是否有大量包含文件，或者包含文件之间有很多依赖关系？如果是这样，那将大大减慢构建时间。

你在使用预编译的头文件吗？如果没有，您可能会将其视为一种解决方案，因为这也会有所帮助。

缓慢的构建时间*通常*归因于大量的文件 I/O。到目前为止，这是构建中最大的时间消耗——只是打开、读取和解析所有文件。如果您减少文件 I/O，您将​​缩短构建时间。

无论如何，很抱歉稍微偏离主题，但是手头上更改文件最后访问时间设置方式的建议似乎有点像“大锤”解决方案。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T08:45:20.983

它将稍微提高性能。除此之外，它不会做更多的事情（当然，您将无法看到文件最后一次访问的时间）。当我使用[nLite](http://www.nliteos.com/)安装 Windows XP以消除我不需要的臃肿时，我默认将其关闭。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-18T06:59:57.233

对于繁忙的服务器，禁用上次访问时间通常是一个好主意。唯一潜在的缺点是是否有脚本使用上次访问时间来告知文件不再被写入。

也就是说，如果您希望缩短 C++ 项目的构建时间，我强烈建议您阅读[Recursive Make Considered Harmful](http://aegis.sourceforge.net/auug97.pdf)。这篇文章大约有十年的历史，但它关于我们构建脚本中的递归定义如何导致构建时间长的观点仍然值得理解。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-12T13:02:06.577

禁用访问时间在使用 ssd（固态驱动器 - 卡、USB 驱动器等）时很有用，因为它减少了对驱动器的写入次数。所有固态存储设备的寿命都是通过可以对每个单独地址进行的写入次数来衡量的。一些媒体指定至少为 100 的数千，甚至 100 万。操作系统和其他可执行文件可以在单个操作中访问许多文件以及用户文档访问。这将适用于eee pc、嵌入式系统和其他。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2010-01-15T10:36:07.503

致迈克·迪米克：

尝试将 USB 驱动器与许多文件连接并将它们复制到您的内部驱动器。除了程序编译（在原始帖子中描述）之外，情况也是如此。

# java - 为遗留 Java 代码自动生成单元测试

> ID：81160
> 
> 赞同：13
> 
> 时间：2008-09-17T08:35:00.837
> 
> 标签：java, unit-testing, legacy

用于自动生成 Java 单元测试的最好的、最好是免费/开源的工具是什么？我知道，单元测试不能真正起到与记录和驱动系统设计的普通 TDD 单元测试相同的目的。但是，如果您拥有庞大的遗留代码库并想知道您需要进行的更改是否会产生不需要的、晦涩的副作用，那么自动生成的单元测试可能会很有用。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-17T09:37:02.153

不是免费的。不是开源的。但我发现 AgitarOne Agitator ( [http://www.agitar.com/solutions/products/agitarone.html](http://www.agitar.com/solutions/products/agitarone.html) ) 非常适合自动生成单元测试并寻找不需要的晦涩副作用

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-17T11:14:20.780

这很有趣，但是这样**生成的单元测试实际上很有用。**如果您正在处理遗留应用程序，通常很难编写正确的、最先进的单元测试。

这样生成的测试（当然，如果您有生成它们的方法）可以确保代码的行为在您的更改期间保持不变，这可以帮助您**重构代码并编写更好的测试**。

现在关于**生成自身**。我不知道任何魔术工具，但您可能想搜索 JUnit 功能，以在 javadocs 中包含一些方法测试。这将允许您编写一些简单的测试。是的，它实际上具有一定的价值。

其次，您可以手动编写“大”测试。当然，这些本身并不是单元测试*（*没有隔离、潜在的副作用等），但可能是很好的第一步。特别是如果您没有时间和遗留应用程序。

**奖金提示！**有一本很棒的书“有效地使用遗留代码”，其中包含 Java 示例，包括在这种情况下使用的技术。不幸的是，您必须手动执行某些操作，但无论如何您都必须在某个步骤中执行此操作。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-17T08:43:44.607

老实说，我可能不会这样做。单元测试是孤立的，你实际上不会知道你是否有“不想要的、晦涩的副作用”，因为一切都与导致副作用的其他事物隔离开来。因此，您需要集成或系统测试，而*这*不是您可以自动化的。

构建一些高级的、端到端的系统测试，给你一定程度的信心，然后使用覆盖测试来找出你错过了什么，缺点是当错误出现时，很难指出他们的确切原因，但好处是你更有可能看到错误。

一旦发现错误，就为它们编写单元测试。随着您的前进，您可以将 TDD 用于要重构的位。

我知道这可能不是您想听到的答案，但是我已经测试了很多很多年，这是一种可靠的方法（尽管我几乎不会将其称为唯一方法:)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-02-27T01:06:53.693

Eclipse 的 Coview 插件 (http://www.codign.com/products.html) 看起来恰到好处。我有兴趣生成涵盖代码中所有路径的测试，这似乎可以做到。它还会生成模拟，这应该可以节省我大量的时间。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2020-10-21T13:50:13.750

Diffblue Cover 是一款可以做到这一点的产品，并且有一个免费的社区版，它是一个 IntelliJ 插件，在这里：[https ://www.diffblue.com/community-edition/download/](https://www.diffblue.com/community-edition/download/)

它通过使用强化学习来搜索可能有用的测试空间，并努力编写类似人类的测试。它会自动创建模拟并具有完整的 Spring/SpringBoot 支持。

这是它编写的 Spring PetClinic 中所有者控制器的示例测试：

```
@Test
public void testInitUpdateOwnerForm() throws Exception {
    // Arrange
    Owner owner = new Owner();
    owner.setLastName("Doe");
    owner.setId(1);
    owner.setCity("Oxford");
    owner.setPetsInternal(new HashSet<Pet>());
    owner.setAddress("42 Main St");
    owner.setFirstName("Jane");
    owner.setTelephone("4105551212");
    when(this.ownerRepository.findById((Integer) any())).thenReturn(owner);
    MockHttpServletRequestBuilder requestBuilder = MockMvcRequestBuilders.get("/owners/{ownerId}/edit", 123456789);

    // Act and Assert
    MockMvcBuilders.standaloneSetup(this.ownerController)
        .build()
        .perform(requestBuilder)
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(MockMvcResultMatchers.model().size(1))
        .andExpect(MockMvcResultMatchers.model().attributeExists("owner"))
        .andExpect(MockMvcResultMatchers.view().name("owners/createOrUpdateOwnerForm"))
        .andExpect(MockMvcResultMatchers.forwardedUrl("owners/createOrUpdateOwnerForm"));
} 
```

# ruby-on-rails - 在 Rails 中，获得显示名称但使用 ID 的自动完成功能的最佳方法是什么？

> ID：81174
> 
> 赞同：4
> 
> 时间：2008-09-17T08:37:12.203
> 
> 标签：ruby-on-rails, model, autocomplete

我想要一个用户可以输入的文本框，显示我的模型名称的 Ajax 填充列表，然后当用户选择一个时，我希望 HTML 保存模型的 ID，并在提交表单时使用它.

我一直在研究 Rails 2 中删除的 auto_complete 插件，但似乎没有暗示这可能有用。有一个[Railscast 插曲](http://railscasts.com/episodes/102-auto-complete-association)涵盖了使用该插件，但它没有涉及这个主题。评论[指出这可能是一个问题](http://railscasts.com/episodes/102-auto-complete-association#comment_37039)，并[指出了`model_auto_completer`一个可能的解决方案](http://model-ac.rubyforge.org/)，如果查看的项目是简单的字符串，这似乎可以工作，但如果（我想做）你插入的文本包含很多垃圾空格将图片包含在列表项中，[尽管文档中说了什么](http://model-ac.rubyforge.org/classes/ModelAutoCompleterHelper.html#M000003)。

我可能会变身`model_auto_completer`，我可能最终还是会这样做，但我很想知道是否有更好的选择。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T08:56:13.780

我自己滚动。这个过程有点复杂，但是......

我刚刚和观察者一起在表单上创建了一个 text_field。当您开始在文本字段中输入时，观察者发送搜索字符串，控制器返回对象列表（最多 10 个）。

然后通过填充动态自动完成搜索结果的部分将对象发送到渲染。部分实际上填充了再次回发到控制器的 link_to_remote 行。link_to_remote 发送用户选择的 id，然后一些 RJS 清理搜索，在文本字段中填写名称，然后将选定的 id 放入隐藏的表单字段中。

呼……我当时找不到一个插件来做这个，所以我自己做了，我希望这一切都有意义。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T09:13:17.717

我已经对图像中的垃圾空间进行了陈旧的修复。我`:after_update_element => "trimSelectedItem"`在选项哈希中添加了一个`model_auto_completer`（这是三个给定的第一个哈希）。然后我`trimSelectedItem`找到适当的子元素并将其内容用作元素值：

```
function trimSelectedItem(element, value, hiddenField, modelID) {
    var span = value.down('span.display-text')
    console.log(span)
    var text = span.innerText || span.textContent
    console.log(text)
    element.value = text
} 
```

但是，这会与该`:allow_free_text`选项发生冲突，如果其中的文本不是列表中的“有效”项目，则默认情况下，一旦文本框失去焦点，该选项就会将文本更改回来。`:allow_free_text => true`所以我也必须通过传递选项散列（同样是第一个散列）来关闭它。不过，我真的宁愿它继续存在。

所以我目前创建自动完成器的调用是：

```
<%= model_auto_completer(
    "line_items_info[][name]", "", 
    "line_items_info[][id]", "",
    {:url => formatted_products_path(:js),
     :after_update_element => "trimSelectedItem",
     :allow_free_text => true},
    {:class => 'product-selector'},
    {:method => 'GET',  :param_name => 'q'}) %> 
```

products/index.js.erb 是：

```
 <ul class='products'>
    <%- for product in @products -%>
    <li id="<%= dom_id(product) %>">
            <%= image_tag image_product_path(product), :alt => "" %>
            <span class='display-text'><%=h product.name %></span>
    </li>
    <%- end -%>
 </ul> 
```

# html - 如何从 Firefox 3 中的 HTML 输入表单中获取文件路径

> ID：81180
> 
> 赞同：52
> 
> 时间：2008-09-17T08:38:49.173
> 
> 标签：html, file-upload, firefox-3

我们有简单的 HTML 表单`<input type="file">`，如下所示：

```
<form>
  <label for="attachment">Attachment:</label>
  <input type="file" name="attachment" id="attachment">
  <input type="submit">
</form> 
```

在 IE7（可能还有所有著名的浏览器，包括旧的 Firefox 2）中，如果我们提交一个像 '//server1/path/to/file/filename' 这样的文件，它会正常工作并给出文件的完整路径和文件名。

在 Firefox 3 中，它只返回“文件名”，因为它们有新的“安全功能”来截断路径，如 Firefox 错误跟踪系统 ( [https://bugzilla.mozilla.org/show_bug.cgi?id=143220](https://bugzilla.mozilla.org/show_bug.cgi?id=143220) )中所述

我不知道如何克服这个“新功能”，因为它会导致我的 webapp 中的所有上传表单在 Firefox 3 上停止工作。

任何人都可以帮助找到一个解决方案来获取 Firefox 3 和 IE7 上的文件路径吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2010-01-03T18:12:13.883

For preview in Firefox works this - attachment is object of attachment element in first example:

```
 if (attachment.files)
             previewImage.src = attachment.files.item(0).getAsDataURL();
           else
             previewImage.src = attachment.value; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-08T06:18:12.603

实际上，就在 FF3 出来之前，我做了一些实验，FF2 只发送文件名，就像 Opera 9.0 一样。只有 IE 发送完整路径。这种行为是有道理的，因为服务器不必知道用户在他的计算机上存储文件的位置，它与上传过程无关。除非你正在编写一个 Intranet 应用程序并通过直接网络访问来获取文件！

改变的地方（这就是你指出的错误项的真正意义）是 FF3 不再允许从 JavaScript 访问文件路径。并且不会让在那里输入/粘贴路径，这对我来说更烦人：我有一个 shell 扩展，它将文件的路径从 Windows 资源管理器复制到剪贴板，我以这种形式使用了很多。我通过使用 DragDropUpload 扩展解决了这个问题。但我担心这会偏离主题。

我想知道您的 Web 表单正在做什么来停止使用这种新行为。

[编辑] 在阅读了 Mike 链接的页面后，我确实看到了路径的 Intranet 使用（例如识别用户）和本地使用（显示图像预览，文件的本地管理）。用户 Jam-es 似乎提供了 nsIDOMFile 的解决方法（尚未尝试）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-12-07T21:40:51.673

我们无法在 FF3 中获得完整的文件路径。以下内容可能对文件组件自定义有用。

```
<script>

function setFileName()
{
    var file1=document.forms[0].firstAttachmentFileName.value; 

    initFileUploads('firstFile1','fileinputs1',file1);
    }
function initFileUploads(fileName,fileinputs,fileValue) {
    var fakeFileUpload = document.createElement('div');
    fakeFileUpload.className = 'fakefile';
    var filename = document.createElement('input');
    filename.type='text';
    filename.value=fileValue;
    filename.id=fileName;
    filename.title='Title';
    fakeFileUpload.appendChild(filename);
    var image = document.createElement('input');
    image.type='button';
    image.value='Browse File';
    image.size=5100;
    image.style.border=0;
    fakeFileUpload.appendChild(image);
    var x = document.getElementsByTagName('input');
    for (var i=0; i&lt;x.length;i++) {
        if (x[i].type != 'file') continue;
        if (x[i].parentNode.className != fileinputs) continue;
        x[i].className = 'file hidden';
        var clone = fakeFileUpload.cloneNode(true);
        x[i].parentNode.appendChild(clone);
        x[i].relatedElement = clone.getElementsByTagName('input')[0];
        x[i].onchange= function () {
            this.relatedElement.value = this.value;
        }}
    if(document.forms[0].firstFile != null && document.getElementById('firstFile1') != null)
    {
    document.getElementById('firstFile1').value= document.forms[0].firstFile.value;
    document.forms[0].firstAttachmentFileName.title=document.forms[0].firstFile.value;
    }
}

function submitFile()
{
alert( document.forms[0].firstAttachmentFileName.value);
}
</script>
<style>div.fileinputs1 {position: relative;}div.fileinputs2 {position: relative;}
div.fakefile {position: absolute;top: 0px;left: 0px;z-index: 1;}
input.file {position: relative;text-align: right;-moz-opacity:0 ;filter:alpha(opacity: 0);
    opacity: 0;z-index: 2;}</style>

<html>
<body onLoad ="setFileName();">
<form>
<div class="fileinputs1">
<INPUT TYPE=file NAME="firstAttachmentFileName" styleClass="file" />
</div>
<INPUT type="button" value="submit" onclick="submitFile();" />
</form>
</body>
</html> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T08:48:53.097

Simply you cannot do it with FF3.

The other option could be using applet or other controls to select and upload files.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T08:53:04.303

Have a look at [XPCOM](http://www.mozilla.org/projects/xpcom/), there might be something that you can use if Firefox 3 is used by a client.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T09:08:17.183

如果您需要的不完全是路径，而是对脱机工作的文件的引用，那么这个示例可能对您有用。

[http://www.ab-d.fr/date/2008-07-12/](http://www.ab-d.fr/date/2008-07-12/)

它是法语的，但代码是 javascript :)

这是文章指向的参考： [http://developer.mozilla.org/en/nsIDOMFile](http://developer.mozilla.org/en/nsIDOMFile) [http://developer.mozilla.org/en/nsIDOMFileList](http://developer.mozilla.org/en/nsIDOMFileList)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-23T05:01:09.277

这是替代解决方案/修复... 在 FF3 中，您可以在文本框中检索文件的完整路径，而不是文件浏览框。这也是......通过拖放文件！

您可以将文件拖放到 html 页面中的文本框中。它将显示文件的完整路径。这些数据可以轻松地传输到您的服务器或对其进行操作。

您所要做的就是使用扩展 DragDropUpload

[http://www.teslacore.it/wiki/index.php?title=DragDropUpload](http://www.teslacore.it/wiki/index.php?title=DragDropUpload)

此扩展将帮助您将文件拖放到文件浏览（输入文件）框中。但是，如果您尝试检索，您仍然无法获得文件的完整路径。

所以，我稍微调整了这个扩展。我可以将文件拖放到任何“文本输入”框并获取文件完整路径。因此我可以在 FF3 Firefox 3 中获取文件完整路径。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-08-20T20:08:33.160

解决此问题的一种极其难看的方法是让用户手动将目录键入文本框中，然后将其添加回 JavaScript 中文件值的前面。

凌乱......但这取决于您正在使用的用户级别，并解决了安全问题。

```
<form>
    <input type="text" id="file_path" value="C:/" />
    <input type="file" id="file_name" />
    <input type="button" onclick="ajax_restore();" value="Restore Database" />
</form> 
```

JavaScript

```
var str = document.getElementById('file_path').value;
var str = str + document.getElementById('file_name').value; 
```

# python - PythonWin的python交互式shell调用构造函数两次？

> ID：81191
> 
> 赞同：3
> 
> 时间：2008-09-17T08:42:07.760
> 
> 标签：python, python-2.x, activestate

在 Python 中回答[静态类变量时](https://stackoverflow.com/questions/68645/python-static-variable#81002)

我注意到 PythonWin PyWin32 build 209.2 解释器似乎评估了两次？

```
PythonWin 2.5 (r25:51908, Mar  9 2007, 17:40:28) [MSC v.1310 32 bit (Intel)] on win32.
Portions Copyright 1994-2006 Mark Hammond - see 'Help/About PythonWin' for further copyright information.
>>> class X:
...     l = []
...     def __init__(self):
...         self.__class__.l.append(1)
...         
>>> X().l
[1, 1]
>>> 
```

而python解释器做正确的事

```
C:\>python
ActivePython 2.5.0.0 (ActiveState Software Inc.) based on
Python 2.5 (r25:51908, Mar  9 2007, 17:40:28) [MSC v.1310 32 bit (Intel)] on win32
Type "help", "copyright", "credits" or "license" for more information.
>>> class X:
...   l = []
...   def __init__(self):
...     self.__class__.l.append(1)
...
>>> X().l
[1]
>>> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T08:57:41.313

我的猜测如下。PythonWin 编辑器为对象提供自动完成功能，即当您键入`myobject.`它时，它会弹出所有可用方法名称的小窗口。所以我认为当你输入`X().`它时，它会在后台创建一个实例`X`并做一个`dir`或类似的操作来找出对象的属性。

所以构造函数只*为每个对象运行一次，*但是为了给你交互性，它在后台默默地创建对象而不告诉你它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-17T15:08:22.247

Dave Webb 是正确的，您可以通过添加打印语句来看到这一点：

```
>>> class X:
...     l = []
...     def __init__(self):
...             print 'inited'
...             self.__class__.l.append(1)
... 
```

然后，在您输入完成弹出窗口之前，`X().`它会立即打印出来。`inited`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T10:18:30.027

两个小的附加点。

第一，`self.__class__.l.append(1)`实在是太不理智了。

就说吧`self.l.append(1)`。Python 在搜索类以获取引用之前先搜索实例。

更重要的是，类级别的变量很少有用。类级别的常量有时是明智的，但即便如此，它们也很难证明是正确的。

在 C++ 和 Java 中，类级 (' `static`') 变量看起来很方便，但没有多大价值。它们很难教给 n00bz——经常在细节上浪费大量课堂时间——而且它们也不是很实用。如果您想知道创建的 X 的所有实例，最好创建一个不依赖于类变量的 XFactory 类。

```
class XFactory( object ):
    def __init__( self ):
        self.listOfX= []
    def makeX( self, *args, **kw ):
        newX= X(*args,**kw)
        self.listOfX.append(newX)
        return newX 
```

没有类级变量异常。而且，它不会将 X 与 X 的集合混为一谈。从长远来看，当一个类既是一些东西又是一些东西的集合时，我会感到困惑。

简单比复杂好。

# c++ - 如何在没有 gdbserver 的情况下使用 Eclipse CDT 进行远程调试？

> ID：81194
> 
> 赞同：14
> 
> 时间：2008-09-17T08:42:32.143
> 
> 标签：c++, eclipse, eclipse-cdt, remote-debugging, aix

我们在 Windows 上使用 Eclipse CDT 5 C++ IDE 在远程 AIX 主机上开发 C++ 应用程序。

Eclipse CDT 能够使用 gdbserver 执行远程调试。不幸的是，AIX 不支持 gdbserver。

有没有人熟悉在没有 gdbserver 的情况下使用 Eclipse CDT 进行远程调试的方法？也许使用 SSH shell 连接到 gdb？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-12T17:09:35.683

最后我现在无论如何都让gdb远程运行了。在任务栏上的错误符号处，我选择了调试配置 - GDB 硬件调试。

在主要 C/C++ 应用程序中，我在可执行文件 ( `X:\abin\vlmi9506`) 的 Samba 共享上设置了完整路径。我还在`X:\abin`项目中设置了一个链接文件夹。然后我在 GDB 设置中修改了我的批处理脚本。它不是在 plink-session 中直接调用 gdb，而是一个打开 gdb 的 unix-shell-script。这样我就有可能在调试之前为程序设置一些 unix 环境变量。我的批处理中的调用：

```
plink.exe prevoax1 -l suttera -pw XXXXX -i /proj/user/dev/suttera/vl/9506/test/vlmi9506ddd.run 20155 dev o m 
```

在 unix 脚本中，我使用来自 eclipse 的命令行参数启动 gdb，这是我在以前的尝试中发现的。shell 命令中的调用如下所示：

```
gdb -nw -i mi -cd=$LVarPathExec $LVarPathExec/vlmi9506 
```

然后 IBM 只为 AIX 提供了 gdb 6.0。我在[http://www.perzl.org/aix/index.php?n=Main.Gdb](http://www.perzl.org/aix/index.php?n=Main.Gdb)的网上找到了 6.8 版。我们的管理员安装了它。

我现在可以单步执行程序并观察变量。我什至可以直接在控制台视图中编写 gdb 命令。yabadabadooooooo

希望对其他人也有帮助。不能说，什么是真正的胜利者行动。但每个答案都会提出更多新问题。现在我得到了其中的3个。

1.  当我启动调试配置时，我必须单击工具栏中的重新启动才能真正进入主程序。是否可以直接进入main而不重新启动？
2.  在 AIX 上，我们的程序首先针对嵌入式 sql 进行预处理。预处理的 c 源代码放在另一个目录中。当我双击该行设置断点时，我收到警告“未解析的断点”，并且在我看到的 gdb-console 中，断点设置为错误的预处理源。是否可以在正确的源上设置断点？
3.  我们在 AIX 上使用 CICS。使用 xldb-Debugger 和 CICS 的 CDCN-command，当我们进入程序时，我们管理调试已启动。是否也可以使用 gdb-eclipse 远程获取（在 plink 中）？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-18T06:34:14.330

对于我无法真正测试答案的问题，我通常不会在黑暗中试一试，但由于这个问题已经坐了一天，我会试一试。看起来似乎：

[http://wiki.eclipse.org/TM_and_RSE_FAQ#How_can_I_do_Remote_Debugging_with_CDT.3F](http://wiki.eclipse.org/TM_and_RSE_FAQ#How_can_I_do_Remote_Debugging_with_CDT.3F)

...即使 CDT 自该 wiki 页面创建以来已更改，您仍然应该能够将调试命令更改为：

ssh 远程主机 gdb

而不是使用使用 gdbserver 的 TM。这可能会比 TM 远程调试稍微慢一些，因为它实际上使用本地 gdb，但另一方面，您不必通过 NFS 或 SMB 挂载源代码以使其可用于本地调试器（如果您在局域网上，无论如何可能都无关紧要）。

还有一个用于 linux 的参考 TCF 实现，您可能会或可能不会有任何运气为 AIX 重新编译，但如果 gdbserver 不可用，它允许远程调试：

[http://wiki.eclipse.org/DSDP/TM/TCF_FAQ](http://wiki.eclipse.org/DSDP/TM/TCF_FAQ)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-27T11:04:06.297

还尝试使用 windows eclipse-cdt-gdb 远程调试 aix-appl。最后被 unix/windows 路径问题阻塞。也许我的结果可以进一步帮助你——也许你已经得到了它的工作。我对你的评论很感兴趣。在 eclipse 新闻门户网站上询问 - 按照 martin oberhuber 的回答（再次感谢）尝试了 dsp dd（也因路径问题而被阻止）并在 eclipse bugzilla 中设置了一个请求。

这里是新闻的链接：http: [//www.eclipse.org/newsportal/article.php?id](http://www.eclipse.org/newsportal/article.php?id=406&group=eclipse.dsdp.tm) =406&group= eclipse.dsdp.tm 这里是我的 bugzilla： [https ://bugs.eclipse.org/bugs/show_bug.cgi ?id=252758](https://bugs.eclipse.org/bugs/show_bug.cgi?id=252758)

目前我们仍然使用 xldb 调试本地化，但我目前正在尝试 ddd-gdb。至少本地 gdb 正在运行。

# linux - 堆栈溢出时的段错误

> ID：81202
> 
> 赞同：12
> 
> 时间：2008-09-17T08:43:48.007
> 
> 标签：linux, segmentation-fault

为什么linux内核会在堆栈溢出时产生段错误？当 c 中的 alloca 或 fortran 创建的临时数组溢出时，这会使调试变得非常尴尬。当然，运行时可能会产生更有用的错误。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-09-17T22:42:34.153

您实际上可以使用信号处理程序捕获堆栈溢出的条件。

为此，您必须做两件事：

*   使用 sigaction 为 SIGSEGV（segfault）设置信号处理程序，为此设置 SO_ONSTACK 标志。这指示内核在传递信号时使用替代堆栈。

*   调用 sigaltstack() 来设置 SIGSEGV 的处理程序将使用的备用堆栈。

然后，当您溢出堆栈时，内核将在传递信号之前切换到您的备用堆栈。在您的信号处理程序中，您可以检查导致错误的地址并确定它是堆栈溢出还是常规错误。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-17T08:48:01.087

The "kernel" (it's actually not the kernel running your code, it's the CPU) doesn't know how your code is referencing the memory it's not supposed to be touching. It only knows that you tried to do it.

The code:

```
char *x = alloca(100);
char y = x[150]; 
```

can't really be evaluated by the CPU as you trying to access beyond the bounds of x.

You may hit the exact same address with:

```
char y = *((char*)(0xdeadbeef)); 
```

BTW, I would discourage the use of alloca since stack tends to be much more limited than heap (use malloc instead).

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-17T08:55:31.100

A stack overflow is a segmentation fault. As in you've broken the given bounds of memory that the you were initially allocated. The stack of of finite size, and you have exceeded it. You can read more about it at [wikipedia](http://en.wikipedia.org/wiki/Segmentation_fault)

Additionally, one thing I've done for projects in the past is write my own signal handler to segfault (look at man page signal (2)). I usually caught the signal and wrote out "Fatal error has occured" to the console. I did some further stuff with checkpoint flags, and debugging.

In order to debug segfaults you can run a program in GDB. For example, the following C program will segfault: #segfault.c #include #include

```
int main() 
{
        printf("Starting\n");
        void *foo=malloc(1000);
        memcpy(foo, 0, 100); //this line will segfault
        exit(0);
} 
```

If I compile it like so:

```
gcc -g -o segfault segfault.c 
```

and then run it like so:

```
$ gdb ./segfault
GNU gdb 6.7.1
Copyright (C) 2007 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "i686-pc-linux-gnu"...
Using host libthread_db library "/lib/libthread_db.so.1".
(gdb) run
Starting program: /tmp/segfault 
Starting

Program received signal SIGSEGV, Segmentation fault.
0x4ea43cbc in memcpy () from /lib/libc.so.6
(gdb) bt
#0  0x4ea43cbc in memcpy () from /lib/libc.so.6
#1  0x080484cb in main () at segfault.c:8
(gdb) 
```

I find out from GDB that there was a segmentation fault on line 8\. Of course there are more complex ways of handling stack overflows and other memory errors, but this will suffice.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T09:06:34.160

只需使用[Valgrind](http://valgrind.org)。它会以极其精确的方式指出你所有的内存分配错误。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-09T23:29:55.633

一些评论很有帮助，但问题不在于内存分配错误。那就是代码没有错误。在 fortran 中，运行时在堆栈上分配临时值是一件很麻烦的事情。因此，诸如 write(fp)x,y,z 之类的命令可以触发是没有警告的段错误。英特尔 Fortran 编译器的技术支持人员表示，运行时库无法打印出更有帮助的消息。但是，如果 Miguel 是正确的，那么这应该是可能的，正如他所建议的那样。非常感谢。剩下的问题是我如何首先找到段错误的地址，并确定它是来自堆栈溢出还是其他问题。

对于发现此问题的其他人，有一个编译器标志可以将临时变量放在堆上的某个大小之上。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-18T20:05:18.983

堆栈溢出不一定会导致崩溃。它可能会默默地丢弃程序的数据，但会继续执行。

我不会使用 SIGSEGV 处理程序 kludges 而是解决原始问题。

如果你想要自动帮助，你可以使用 gcc 的 -Wstack-protector 选项，它会在运行时发现一些溢出并中止程序。

valgrind 适用于动态内存分配错误，但不适用于堆栈错误。

# flash - 在 Flash CS3 中构建 SWF 文件时可以调用外部脚本或程序吗？

> ID：81209
> 
> 赞同：3
> 
> 时间：2008-09-17T08:45:13.463
> 
> 标签：flash, svn, build-process

每次构建 SWF 文件时，有没有办法从 Flash CS3 调用外部脚本或程序？我想使用 subwcrev 添加颠覆信息 - SVN 关键字不起作用，因为它们仅在更新版本类文件时更新。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T08:57:41.983

这些天我不确定 JSFL 的功能是什么，但我想说 Flash IDE 是你唯一的选择。JSFL 是一种扩展 Flash IDE 的语言，但我不确定你能做到这一点。

在相关说明中，将 SVN 信息添加到您的 SWF 中并非易事。在实际编译 SWF 本身*之前*，您可能需要 SVN 挂钩来放置信息。

我怀疑您是否可以使用 Flash IDE 进行此编译，但我很乐意听到其他情况。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T10:47:17.103

多亏了 Zárate，看起来 JSFL 是答案，或者至少是答案的一部分。我无法让 flash 运行外部脚本，但我*可以*让外部脚本运行 flash；所以我现在有两个脚本；build.bat 和 build.jsfl

构建.bat：

```
subwcrev . Version.svn.as Version.as
IF ERRORLEVEL 1 EXIT /B $ErrLev
flash.exe ./build.jsfl
IF ERRORLEVEL 1 EXIT /B $ErrLev 
```

构建.jsfl：

```
fl.openDocument("file:///movie.fla");
var documentDom = fl.getDocumentDOM();
documentDom.exportSWF("file:///movie.swf",true);
documentDom.close(false);
FLfile.remove("file:///Version.as"); 
```

我已将 build.bat 添加到我的项目中；如果我双击 build.bat，该项目将使用 SVN 版本信息构建 SWF 电影。这可以在 Flash IDE 或文件资源管理器中工作。如果我忘记了，然后单击“测试项目”，则构建失败，因为它找不到 Version.as。

再次感谢，扎拉特！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T14:19:23.983

减少我这样做可能我们已经吃饱了，因为你也是

var fileURL = fl.browseForFileURL("打开", "选择文件");

fl.openDocument(fileURL);

var documentDom = fl.getDocumentDOM();

documentDom.exportSWF("movie.swf",true);

documentDom.close(false);

# svn - Lighttpd 和 WebDAV 用于提供 Subversion 存储库

> ID：81212
> 
> 赞同：2
> 
> 时间：2008-09-17T08:45:56.317
> 
> 标签：svn, webdav, lighttpd

当我转到某个 URL 时，我已经配置（至少我尝试过配置）Lighty 以启用 WebDAV 插件。我没有收到任何错误，所以它似乎正在工作。那么，我如何配置它来服务于我的 subversion 存储库（其中我有很多）？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T08:48:27.170

我认为现在不可能，因为 mod_dav_svn 是一个 apache 模块，而 AFAIK 没有可用的 lighttpd 模块。

# asp.net - “DropDownList.SelectedIndex = -1”问题

> ID：81214
> 
> 赞同：8
> 
> 时间：2008-09-17T08:46:21.870
> 
> 标签：asp.net, webforms, drop-down-menu

我只想要一个没有选定项目的 ASP.NET DropDownList。到目前为止，将 SelectedIndex 设置为 -1 无济于事。我将Framework 3.5 与AJAX 一起使用，即这个DropDownList 在UpdatePanel 中。这是我正在做的事情：

```
 protected void Page_Load (object sender, EventArgs e)
    {
        this.myDropDownList.SelectedIndex = -1;
        this.myDropDownList.ClearSelection();

        this.myDropDownList.Items.Add("Item1");
        this.myDropDownList.Items.Add("Item2");
    } 
```

当我在 DropDown 中添加一个元素时，它的 SelectedIndex 更改为 0，并且不能再设置为 -1（我也尝试在添加项目后调用 SelectedIndex）......我做错了什么？蚂蚁帮助将不胜感激！

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-17T09:14:24.517

请记住，如果您在执行 DataSource/DataBind 调用后调用 myDropDownList.Items.Add 将在底部添加一个新的 Listitem 元素，因此请改用 myDropDownList.Items.Insert 方法，例如...

```
myDropDownList.DataSource = DataAccess.GetDropDownItems(); // Psuedo Code
myDropDownList.DataTextField = "Value";
myDropDownList.DataValueField = "Id";
myDropDownList.DataBind();

myDropDownList.Items.Insert(0, new ListItem("Please select", "")); 
```

将“请选择”下拉项添加到顶部。

并且如前所述，在下拉列表中总是会选择一个项目（我相信 ListBox 是不同的），如果没有明确选择，则默认为最上面的项目。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-17T09:10:59.050

我正在阅读以下内容：http: [//msdn.microsoft.com/en-us/library/a5kfekd2.aspx](http://msdn.microsoft.com/en-us/library/a5kfekd2.aspx)

它说：要获取所选项目的索引值，请读取 SelectedIndex 属性的值。该索引从零开始。如果未选择任何内容，则该属性的值为 -1。

同时，在[http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.dropdownlist.selectedindex(VS.80).aspx](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.dropdownlist.selectedindex(VS.80).aspx)我们看到：

使用 SelectedIndex 属性以编程方式指定或确定 DropDownList 控件中选定项的索引。在 DropDownList 控件中始终选择一个项目。您不能同时清除列表中每个项目的选择。

也许 -1 仅适用于获取而不是设置索引？如果是这样，我将使用您的“补丁”。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-14T12:49:21.347

可以使用客户端脚本将*DropDownList的**selectedIndex*属性设置为 -1（即清除选择）：

 *```
<form id="form1" runat="server">
    <asp:DropDownList ID="DropDownList1" runat="server">
        <asp:ListItem Value="A"></asp:ListItem>
        <asp:ListItem Value="B"></asp:ListItem>
        <asp:ListItem Value="C"></asp:ListItem>
    </asp:DropDownList>
    <button id="СlearButton">Clear</button>
</form>

<script src="jquery-1.2.6.js" type="text/javascript"></script>
<script type="text/javascript">
    $(document).ready(function()
    {
        $("#СlearButton").click(function()
        {
            $("#DropDownList1").attr("selectedIndex", -1); // pay attention to property casing
        })

        $("#ClearButton").click();
    })
</script> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-17T08:52:32.417

我很确定下拉菜单必须选择一些项目；我通常添加一个空列表项

this.myDropDownList.Items.Add("");

作为我的第一个列表项，并相应地进行。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-17T09:01:06.513

selectedIndex 只能在控件第一次初始化并且集合中没有项目时为 -1。

不可能像在 WinForm 上那样在 Web 下拉列表中选择任何项目。

我发现最好有：this.myDropDownList.Items.Add(new ListItem("请选择...", ""));

这样我向用户传达他们需要选择一个项目，您可以检查 SelectedIndex == 0 来验证

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-11-04T18:46:45.013

1.  创建您的下拉列表并指定一个初始 ListItem
2.  设置`AppendDataBoundItems`为`true`以便追加新项目。

> ```
> <asp:DropDownList ID="YourID" DataSourceID="DSID" AppendDataBoundItems="true"> 
> <asp:ListItem Text="All" Value="%"></asp:ListItem> 
> </asp:DropDownList> 
> ```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-07-26T09:17:10.493

请尝试以下语法：

```
DropDownList1.SelectedIndex = DropDownList1.Items.IndexOf(DropDownList1.Items.FindByValue("Select")) 
```

或者

```
DropDownList1.SelectedIndex = DropDownList1.Items.IndexOf(DropDownList1.Items.FindByText("SelectText")) 
```

或者

```
DropDownList1.Items.FindByText("Select").selected =true 
```

欲了解更多信息：http: [//vimalpatelsai.blogspot.in/2012/07/dropdownlistselectedindex-1-problem.html](http://vimalpatelsai.blogspot.in/2012/07/dropdownlistselectedindex-1-problem.html)

# windows-vista - 在 Vista 中如何查看 NTFS 分区的分配单元大小？

> ID：81236
> 
> 赞同：85
> 
> 时间：2008-09-17T08:50:23.513
> 
> 标签：windows-vista, ntfs

我可以使用哪个内置（如果有）工具来确定某个 NTFS 分区的分配单元大小？

* * *

## 回答 #1

> 赞同：161
> 
> 时间：2008-09-17T08:54:20.727

打开管理员命令提示符，然后执行以下命令：

```
fsutil fsinfo ntfsinfo [your drive] 
```

每个簇的字节数相当于分配单元。

* * *

## 回答 #2

> 赞同：48
> 
> 时间：2010-08-24T21:09:41.843

使用`diskpart.exe`.

进入 diskpart`select volume <VolumeNumber>`后，键入`filesystems`.

它应该告诉您文件系统类型和分配单元大小。它还会告诉您支持的尺寸等。前面提到的`fsutil`确实有效，但答案不是很清楚，我找不到为连接点获取相同信息的语法。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2013-09-06T17:17:59.147

在任何 Windows 系统上通过 GUI 快速找到它的另一种方法：

1.  创建一个文本文件，在其中键入一两个单词（或随机文本），然后保存。

2.  右键单击文件以显示属性。

3.  “磁盘大小” = 分配单元。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2018-03-23T16:55:51.300

我知道这是一个旧线程，但是有一种更新的方法，然后必须使用 fsutil 或 diskpart。

运行这个 powershell 命令。

`Get-Volume | Format-List AllocationUnitSize, FileSystemLabel`

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2016-02-09T18:03:51.507

每个集群的字节数 - 65536 = 64K

```
C:\temp>fsutil fsinfo drives

Drives: C:\ D:\ E:\ F:\ G:\ I:\ J:\ N:\ O:\ P:\ S:\

C:\temp>fsutil fsinfo ntfsInfo N:
NTFS Volume Serial Number :       0xfe5a90935a9049f3
NTFS Version   :                  3.1
LFS Version    :                  2.0
Number Sectors :                  0x00000002e15befff
Total Clusters :                  0x000000005c2b7dff
Free Clusters  :                  0x000000005c2a15f0
Total Reserved :                  0x0000000000000000
Bytes Per Sector  :               512
Bytes Per Physical Sector :       512
Bytes Per Cluster :               4096
Bytes Per FileRecord Segment    : 1024
Clusters Per FileRecord Segment : 0
Mft Valid Data Length :           0x0000000000040000
Mft Start Lcn  :                  0x00000000000c0000
Mft2 Start Lcn :                  0x0000000000000002
Mft Zone Start :                  0x00000000000c0000
Mft Zone End   :                  0x00000000000cc820
Resource Manager Identifier :     560F51B2-CEFA-11E5-80C9-98BE94F91273

C:\temp>fsutil fsinfo ntfsInfo N:
NTFS Volume Serial Number :       0x36acd4b1acd46d3d
NTFS Version   :                  3.1
LFS Version    :                  2.0
Number Sectors :                  0x00000002e15befff
Total Clusters :                  0x0000000005c2b7df
Free Clusters  :                  0x0000000005c2ac28
Total Reserved :                  0x0000000000000000
Bytes Per Sector  :               512
Bytes Per Physical Sector :       512
Bytes Per Cluster :               65536
Bytes Per FileRecord Segment    : 1024
Clusters Per FileRecord Segment : 0
Mft Valid Data Length :           0x0000000000010000
Mft Start Lcn  :                  0x000000000000c000
Mft2 Start Lcn :                  0x0000000000000001
Mft Zone Start :                  0x000000000000c000
Mft Zone End   :                  0x000000000000cca0
Resource Manager Identifier :     560F51C3-CEFA-11E5-80C9-98BE94F91273 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2020-06-02T15:17:03.457

最简单的方法，在 2012r2 上确认。

1.  转到“这台电脑”
2.  右键单击磁盘
3.  点击格式

在下拉“分配单元大小”下将是单元大小磁盘的分配值。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-12-16T20:57:09.857

根据[Microsoft](http://technet.microsoft.com/en-us/library/cc722475.aspx)的说法，分配单元大小“指定文件系统的集群大小” - 因此它是“每个集群的字节数”显示的值，如下所示：

```
fsutil fsinfo ntfsinfo C: 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-05-09T20:13:52.443

您可以从命令行使用 Mark Russinovich 的 SysInternals [NTFSInfo ，它将 fsutil fsinfo ntfsinfo 转换为更具可读性的信息，尤其是 MFT 表信息。](http://technet.microsoft.com/en-us/sysinternals/bb897424.aspx)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-11-24T18:20:13.633

JY 在上一个答案中提供的简单 GUI 方式：

1.  创建一个小文件（非空）
2.  右键单击，选择属性
3.  检查“磁盘大小”（在“常规”选项卡中），仔细检查您的文件大小是否小于该大小的一半，以便它肯定使用单个分配单元。

这很好用，并提醒您分配单元大小的重要性。但它确实有一个警告：如对先前答案的评论中所见，对于一个非常小的文件，Windows 有时会将“磁盘大小”显示为 0。在我的测试中，分配单元大小为 4096 字节的 NTFS 文件系统要求文件为 800 字节，以始终避免此问题。在 FAT32 文件系统上，这个问题似乎不存在，即使是单字节文件也可以工作 - 只是不是空的。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-11-28T08:06:15.673

从命令行：

chkdsk l：（等待扫描完成）

sizdir32 [http://www.ltr-data.se/opencode.html/](http://www.ltr-data.se/opencode.html/)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2021-08-10T17:14:06.233

在`CMD`（作为管理员）中，首先运行`diskpart`. 在打开的程序中，输入`list disk`. 它将列出所有连接的磁盘。 [![列出磁盘](https://i.stack.imgur.com/b22Qm.png)](https://i.stack.imgur.com/b22Qm.png)

根据其大小选择正确的磁盘。如果它是闪存，通常它会是列表中的最后一项。就我而言，我选择`Disk 2`使用此命令：`select disk 2`.

选择磁盘后，使用`list partion`命令列出分区。您将获得如下图所示的列表。 [![列表分区](https://i.stack.imgur.com/4uTsr.png)](https://i.stack.imgur.com/4uTsr.png)

现在，是时候根据其大小选择正确的分区了。就我而言，我使用以下命令选择分区 1 `select partition 1`：.

最后，您可以运行`filesystem`命令来获取`Allocation Unit Size`. [![分配单元大小](https://i.stack.imgur.com/0265T.png)](https://i.stack.imgur.com/0265T.png)

注意：此过程适用于**NTFS**和**FAT32**。

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2013-07-03T10:45:48.583

开始 > 运行 > MSINFO32

转到组件

转到存储

转到磁盘

在右侧查找字节/扇区

# apache - 如何在 Apache 下阻止来自我网站的 mp3 爬虫？

> ID：81238
> 
> 赞同：4
> 
> 时间：2008-09-17T08:50:47.240
> 
> 标签：apache, bandwidth

是否有某种方法可以使用 .htaccess 文件或类似文件来阻止引用者的访问？我的带宽被来自[http://www.dizzler.com](http://www.dizzler.com)的人占用了，这是一个基于 Flash 的网站，允许您浏览已抓取的公开可用 mp3 库。

**编辑：** Dizzler 仍在进入（可能并非在所有情况下都指示引用者）所以我将所有 mp3 移动到一个新文件夹，禁用目录浏览，并创建了一个 robots.txt 文件以（希望）防止它被索引再次。接受的答案已更改以反映我之前尝试的徒劳：P

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T08:59:56.487

这就像说您想阻止垃圾邮件机器人在您公开可见的页面上收集电子邮件 - 在不强制您的查看者登录以确认他们的身份的情况下，很难区分用户和机器人。

您可以使用 robots.txt 来禁止实际上遵循这些规则的蜘蛛，但这是在他们这边，而不是在您的服务器那边。有一个页面解释了如何捕捉那些违反规则并明确禁止它们的页面：[使用 Apache 阻止坏机器人](http://www.evolt.org/article/Using_Apache_to_stop_bad_robots/18/15126/)[evolt.org]

如果您想要一种简单的方法来停止 Dizzler，特别是使用 .htaccess，您应该能够将其弹出并添加：

```
<Directory /directoryName/subDirectory>
Order Allow,Deny
Allow from all
Deny from 66.232.150.219
</Directory> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-17T08:53:15.300

从[这个站点](http://www.javascriptkit.com/howto/htaccess14.shtml)：（把它放在你的 .htaccess 文件中）

```
RewriteEngine on
RewriteCond %{HTTP_REFERER} ^http://((www\.)?dizzler\.com [NC]
RewriteRule .* - [F] 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-17T08:56:38.553

你可以使用类似的东西

```
SetEnvIfNoCase Referer dizzler.com spammer=yes

Order allow,deny
allow from all
deny from env=spammer 
```

来源：[http ://codex.wordpress.org/Combating_Comment_Spam/Denying_Access](http://codex.wordpress.org/Combating_Comment_Spam/Denying_Access)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T08:52:50.700

这不是一个非常优雅的解决方案，但您可以阻止网站的爬虫机器人，然后重命名您的 mp3 文件以破坏网站上已有的链接。

# delphi - Opening two HTMLHelp files simultaneously in Delphi causes both help windows to hang

> ID：81243
> 
> 赞同：4
> 
> 时间：2008-09-17T08:51:43.760
> 
> 标签：delphi, chm

In Delphi, the application's main help file is assigned through the TApplication.HelpFile property. All calls to the application's help system then use this property (in conjunction with CurrentHelpFile) to determine the help file to which help calls should be routed.

In addition to TApplication.HelpFile, each form also has a TForm.HelpFile property which can be used to specify a different (separate) help file for help calls originating from that specific form.

If an application's main help window is already open however, and a help call is made display help from a secondary help file, both help windows hang. Neither of the help windows can now be accessed, and neither can be closed. The only way to get rid of the help windows is to close the application, which results in both help windows being automatically closed as well.

Example:

```
Application.HelpFile := 'Main Help.chm'; //assign the main help file name
Application.HelpContext(0); //dispays the main help window
Form1.HelpFile := 'Secondary Help.chm'; //assign a different help file
Application.HelpContext(0); //should display a second help window 
```

The last line of code above opens the secondary help window (but with no content) and then both help windows hang.

My Question is this:

1.  Is it possible to display two HTMLHelp windows at the same time, and if so, what is the procedure to be followed?

2.  If not, is there a way to tell whether or not an application's help window is already open, and then close it programatically before displaying a different help window?

(I am Using Delphi 2007 with HTMLHelp files on Windows Vista)

**UPDATE: 2008-09-18**

Opening two help files at the same time does in fact work as expected using the code above. The problem seems to be with the actual help files I was using - not the code.

I tried the same code with different help files, and it worked fine.

Strangely enough, the two help files I was using each works fine on it's own - it's only when you try to open both at the same time that they hang, and only if you open them from code (in Windows explorer I can open both at the same time without a problem).

Anyway - the problem is definitely with the help files and not the code - so the original questions is now pretty much invalid.

**UPDATE 2: 2008-09-18**

I eventually found the cause of the hanging help windows. I will post the answer below and accept it as the correct one for future reference. I have also changed the questions title.

Oops... It seems that I cannot accept my own answer...

Please vote it up so it stays at the top.

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-18T06:27:52.320

假设您有两个名为“Help File 1.chm”和“Help File 2.chm”的帮助文件，并且您正在从 Delphi 代码中打开这些帮助文件。

要打开帮助文件 1，以下代码将起作用：

```
procedure TForm1.Button1Click(Sender: TObject);
begin
  Application.HelpFile := 'Help File 1.chm';
  Application.HelpContext(0);
end; 
```

要打开帮助文件 2，以下代码将起作用：

```
procedure TForm1.Button1Click(Sender: TObject);
begin
  Application.HelpFile := 'Help File 2.chm';
  Application.HelpContext(0);
end; 
```

但是要同时打开两个文件，下面的代码会导致**两个帮助窗口都挂起**。

```
procedure TForm1.Button1Click(Sender: TObject);
begin
  Application.HelpFile := 'Help File 1.chm';
  Application.HelpContext(0);

  Application.HelpFile := 'Help File 2.chm';
  Application.HelpContext(0);
end; 
```

**解决方案：**

问题是由帮助文件名中有**空格**引起的。

从文件名中删除空格将解决问题。

以下代码可以正常工作：

```
procedure TForm1.Button1Click(Sender: TObject);
begin
  Application.HelpFile := 'HelpFile1.chm';
  Application.HelpContext(0);

  Application.HelpFile := 'HelpFile2.chm';
  Application.HelpContext(0);
end; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-18T00:18:38.663

I just tested that and **it works, as expected,** with the kind of code you tried.
Compiled in D2007/XP, ran in both XP and Vista without problem.

```
procedure TForm1.Button1Click(Sender: TObject);
begin
  Application.HelpFile:= 'depends.chm';
  Application.HelpContext(0);
  HelpFile:='GExperts.chm';
  Application.HelpContext(0);
end; 
```

Both help files open and are alive and well....

Q1: Have you checked the validity of your help files?
Q2: Where did you place your code?

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-18T00:47:08.440

试过了。只是工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T09:05:36.783

对这里的帮助文件没有经验，对 Vista 更是如此，但我可以为您提供一个可能的解决方法......

构建第二个应用程序，其唯一工作是打开帮助文件。您可以将帮助文件名作为命令行参数传递。

您可以从主应用程序轻松检查此帮助应用程序是否正在运行。这将使您完全控制，因为您可以决定是否要

*   在打开辅助帮助之前发送消息以关闭帮助应用程序
*   允许多个帮助应用程序实例允许同时打开不同的帮助文件
*   允许帮助在您的应用程序关闭后保持打开状态，或者您是否要向它发送消息以关闭它

您还可以检查帮助应用程序的实例是否已经打开了请求的帮助文件，并决定是否要允许第二次打开它，或者只是将现有实例置于前台。

*如前所述，这是一种解决方法 - 如果它是您唯一的选择，请告诉我您是否需要代码示例。否则我会保持这篇文章的干净（并在短期内节省自己的时间），而不是用不必要的来源弄乱它*

# java - 将发布合并到一个 JAR 文件中的最简单方法

> ID：81260
> 
> 赞同：75
> 
> 时间：2008-09-17T08:54:50.273
> 
> 标签：java, jar, merge, restructuredtext, uberjar

是否有工具或脚本可以轻松地将一堆[JAR](http://en.wikipedia.org/wiki/JAR_%28file_format%29)文件合并到一个 JAR 文件中？一个好处是可以轻松设置主文件清单并使其可执行。

具体案例是一个[Java 重组文本工具](http://jrst.labs.libre-entreprise.org/en/user/functionality.html)。我想用类似的东西运行它：

> java -jar rst.jar

据我所知，它没有依赖关系，这表明它不应该是一个简单的单文件工具，但下载的 ZIP 文件包含很多库。

```
 0  11-30-07 10:01   jrst-0.8.1/
    922  11-30-07 09:53   jrst-0.8.1/jrst.bat
    898  11-30-07 09:53   jrst-0.8.1/jrst.sh
   2675  11-30-07 09:42   jrst-0.8.1/readmeEN.txt
 108821  11-30-07 09:59   jrst-0.8.1/jrst-0.8.1.jar
   2675  11-30-07 09:42   jrst-0.8.1/readme.txt
      0  11-30-07 10:01   jrst-0.8.1/lib/
  81508  11-30-07 09:49   jrst-0.8.1/lib/batik-util-1.6-1.jar
2450757  11-30-07 09:49   jrst-0.8.1/lib/icu4j-2.6.1.jar
 559366  11-30-07 09:49   jrst-0.8.1/lib/commons-collections-3.1.jar
  83613  11-30-07 09:49   jrst-0.8.1/lib/commons-io-1.3.1.jar
 207723  11-30-07 09:49   jrst-0.8.1/lib/commons-lang-2.1.jar
  52915  11-30-07 09:49   jrst-0.8.1/lib/commons-logging-1.1.jar
 260172  11-30-07 09:49   jrst-0.8.1/lib/commons-primitives-1.0.jar
 313898  11-30-07 09:49   jrst-0.8.1/lib/dom4j-1.6.1.jar
1994150  11-30-07 09:49   jrst-0.8.1/lib/fop-0.93-jdk15.jar
  55147  11-30-07 09:49   jrst-0.8.1/lib/activation-1.0.2.jar
 355030  11-30-07 09:49   jrst-0.8.1/lib/mail-1.3.3.jar
  77977  11-30-07 09:49   jrst-0.8.1/lib/servlet-api-2.3.jar
 226915  11-30-07 09:49   jrst-0.8.1/lib/jaxen-1.1.1.jar
 153253  11-30-07 09:49   jrst-0.8.1/lib/jdom-1.0.jar
  50789  11-30-07 09:49   jrst-0.8.1/lib/jewelcli-0.41.jar
 324952  11-30-07 09:49   jrst-0.8.1/lib/looks-1.2.2.jar
 121070  11-30-07 09:49   jrst-0.8.1/lib/junit-3.8.1.jar
 358085  11-30-07 09:49   jrst-0.8.1/lib/log4j-1.2.12.jar
  72150  11-30-07 09:49   jrst-0.8.1/lib/logkit-1.0.1.jar
 342897  11-30-07 09:49   jrst-0.8.1/lib/lutinwidget-0.9.jar
2160934  11-30-07 09:49   jrst-0.8.1/lib/docbook-xsl-nwalsh-1.71.1.jar
 301249  11-30-07 09:49   jrst-0.8.1/lib/xmlgraphics-commons-1.1.jar
  68610  11-30-07 09:49   jrst-0.8.1/lib/sdoc-0.5.0-beta.jar
3149655  11-30-07 09:49   jrst-0.8.1/lib/xalan-2.6.0.jar
1010675  11-30-07 09:49   jrst-0.8.1/lib/xercesImpl-2.6.2.jar
 194205  11-30-07 09:49   jrst-0.8.1/lib/xml-apis-1.3.02.jar
  78440  11-30-07 09:49   jrst-0.8.1/lib/xmlParserAPIs-2.0.2.jar
  86249  11-30-07 09:49   jrst-0.8.1/lib/xmlunit-1.1.jar
 108874  11-30-07 09:49   jrst-0.8.1/lib/xom-1.0.jar
  63966  11-30-07 09:49   jrst-0.8.1/lib/avalon-framework-4.1.3.jar
 138228  11-30-07 09:49   jrst-0.8.1/lib/batik-gui-util-1.6-1.jar
 216394  11-30-07 09:49   jrst-0.8.1/lib/l2fprod-common-0.1.jar
 121689  11-30-07 09:49   jrst-0.8.1/lib/lutinutil-0.26.jar
  76687  11-30-07 09:49   jrst-0.8.1/lib/batik-ext-1.6-1.jar
 124724  11-30-07 09:49   jrst-0.8.1/lib/xmlParserAPIs-2.6.2.jar 
```

如您所见，不需要手动执行此操作在某种程度上是可取的。

到目前为止，我只尝试过 AutoJar 和 ProGuard，它们都相当容易上手。JAR 文件中的常量池似乎存在一些问题。

显然 jrst 有点坏了，所以我会去修复它。[Maven](http://en.wikipedia.org/wiki/Apache_Maven) 文件显然也被`pom.xml`破坏了，所以我必须在修复 jrst 之前修复它......我觉得自己像一个错误磁铁 :-)

* * *

更新：我从来没有解决这个应用程序，但我检查了基于胖 JAR 的[Eclipse的“可运行 JAR 导出向导”。](http://en.wikipedia.org/wiki/Eclipse_%28software%29)我发现这很容易用于部署我自己的代码。

其他一些优秀的建议可能更适合在非 Eclipse 环境中构建，oss 可能应该使用[Ant](http://en.wikipedia.org/wiki/Apache_Ant)进行良好的构建。（Maven，到目前为止刚刚给我带来了痛苦，但其他人喜欢它。）

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2008-10-08T22:09:10.747

蚂蚁的`zipfileset`工作

```
<jar id="files" jarfile="all.jar">
    <zipfileset src="first.jar" includes="**/*.java **/*.class"/>
    <zipfileset src="second.jar" includes="**/*.java **/*.class"/>
</jar> 
```

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2008-09-17T09:08:56.760

Eclipse 3.4 JDT 的 Runnable JAR 导出向导。

在 Eclipse 3.5 中，这已被扩展。现在您可以选择如何处理引用的 JAR 文件。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2008-09-17T09:32:54.317

在尝试了几种不同的解决方案后，我发现[One-JAR](http://one-jar.sourceforge.net/) 是最容易使用的，并且成功地做到了这一点：生成一个包含我需要的所有内容的单个可执行 JAR。

One-JAR 使用可以导航嵌套资源的自定义类加载器。查看下载中的 .bat 文件，看起来 jrst-0.8.1.jar 中的 org.codelutin.jrst.JRST 是主类，所以你的清单应该是这样的：

```
Main-Class: com.simontuffs.onejar.Boot
One-Jar-Main-Class: org.codelutin.jrst.JRST 
```

真正酷的是 One-JAR 将为您处理传递命令行参数。类路径由自定义类加载器处理，假设您需要的所有资源都捆绑到单个 JAR 中。

使用 One-JAR 最简单的方法是使用 ant；有一个自定义的“one-jar”ant 任务，其工作方式如下（假设您的清单称为“rst.mf”）：

```
<target name="jar-rst">
    <one-jar destfile="rst.jar" manifest="rst.mf">
        <main jar="jrst-0.8.1.jar" />
        <lib>
            <fileset dir="${pathToJars}">
                <include name="batik-util-1.6-1.jar" />
                <include name="icu4j-2.6.1.jar" />
                <include name="commons-collections-3.1.jar" />
                <!-- Snip -->
            </fileset>
        </lib>
    </one-jar>
</target> 
```

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-09-17T08:57:37.147

如果你是一个[Maven](http://en.wikipedia.org/wiki/Apache_Maven)用户，通常组装插件会做你想做的事，或者可能是阴影插件，在某些情况下是组合。

使用程序集插件，您可以在项目中放置一个带有任何必要设置的清单文件，尽管默认值通常非常好。然后构建完成

```
mvn assembly:assembly 
```

或者，如果您有更多特殊的事情要处理，那就是其他目标之一。所有要包含的 JAR 文件都由 Maven 的依赖解析器拾取。如果您使用 shade 插件，它通常是安装目标的一部分，并且在我现在正在做的一个特定项目中我做

```
mvn install
mvn assembly:single 
```

`assembly:single`目标是解决生命周期问题，在这种情况下是在Spring[应用](http://en.wikipedia.org/wiki/Spring_Framework)程序中。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-09-17T09:38:10.467

[ProGuard](http://proguard.sourceforge.net/)不仅可以将您的 JAR 文件打包成一个，还可以优化、清理或混淆您的类文件，使生成的 JAR 文件比之前所有 JAR 文件的总和小得多。

我实际上使用 JRST 工具尝试了 ProGuard，正如您所报告的那样。我试图追踪问题并发现它与jrst 引用的 ICU4J 库中的[一个错误有关。](http://bugs.icu-project.org/trac/ticket/3209)问题是，现在使用的 ICU 版本已经过时了。所以我`icu.jar`用 ICU4J 3.2 版替换了文件。现在 ProGuard 发现了一堆关于 JRST 库不一致的其他错误/警告。

我的猜测是 ProGuard 按预期工作，但 jrst 的库并不一致。我不知道除了与开发人员交谈之外，您是否可以做更多的事情，因为他们应该检查和更新项目的依赖关系。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-09-22T16:10:31.877

您可以使用[JarJar](http://code.google.com/p/jarjar/)，它将使用包阴影来确保您的 JAR 文件不会与其他文件冲突。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2011-04-13T16:46:43.703

（基于安德里安的）：

```
<jar id="files" jarfile="all.jar">
  <zipgroupfileset dir="${library.dir}" includes="*.jar" excludes="test-helper.jar"/>
  <zipfileset src="first.jar" includes="**/*.java **/*.class"/>
  <zipfileset src="second.jar" includes="**/*.java **/*.class"/>
  <fileset dir=".">
    <include name="LICENSE"/>
    <include name="NOTICE"/>
  </fileset>
</jar> 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2010-07-17T07:17:22.050

One-JAR 0.97 刚刚在[http://one-jar.sourceforge.net](http://one-jar.sourceforge.net)上发布，并且已经扩展了对[Spring](http://en.wikipedia.org/wiki/Spring_Framework)和[Guice](http://en.wikipedia.org/wiki/Google_Guice)等框架的支持，这可能会给其他方法带来麻烦。它还处理类加载器反转——其中一些 JAR 文件在 One-JAR 外部（例如，可能未捆绑交付的[JDBC驱动程序）。](http://en.wikipedia.org/wiki/Java_Database_Connectivity)

One-JAR 是命令行，带有[Ant](http://en.wikipedia.org/wiki/Apache_Ant)和[Maven](http://en.wikipedia.org/wiki/Apache_Maven) 2 插件。仅使用“jar”工具构建也很简单。

我还可以推荐 Eclipse Jar Exporter (Runnable)，Ference Hechler 在上面写道：他在提出一种简单的方法来包装一组 JAR 文件方面做得很好。他和我在 One-JAR 上工作，但 Jar Exporter 基于不同的代码库。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-17T08:59:07.580

有一个名为[autojar](http://sourceforge.net/projects/autojar/)的工具，它将扫描您的字节码并使用它找到的类编译一个 .jar 文件，包括引用（导入）的类。

但是，它并不总是适用于 Spring 之类的东西，您在配置中指定类名并由框架加载。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-17T09:40:03.753

或使用 Maven 程序集插件 (mvn assembly:assembly)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2015-06-07T21:00:41.987

我认为您需要的工具是**JarSplice**：[http ://ninjacave.com/jarsplice](http://ninjacave.com/jarsplice)

它**不需要**Ant 或 Maven，有自己的 GUI，使用起来很简单，完全按照你的要求做 -->***它将几个 jar 文件的内容合并到一个文件中***（请注意它仍然需要添加自己的类加载器）。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-06-12T16:31:34.663

您应该使用 maven 着色插件来做到这一点。我经常使用maven构建独立的jar文件，它非常强大

看更多：

[http://maven.apache.org/plugins/maven-shade-plugin/examples/includes-excludes.html](http://maven.apache.org/plugins/maven-shade-plugin/examples/includes-excludes.html)

* * *

## 回答 #13

> 赞同：-4
> 
> 时间：2008-09-17T08:58:03.590

听起来[Apache Ant](http://ant.apache.org/)就是您正在寻找的东西。

# performance - Sybase 上不区分大小写的搜索

> ID：81268
> 
> 赞同：7
> 
> 时间：2008-09-17T08:56:38.367
> 
> 标签：performance, case-sensitive, sap-ase

我已经厌倦了谷歌搜索在 Sybase ASE 上进行不区分大小写搜索的解决方案（Sybase 数据/列名区分大小写）。Sybase 文档自豪地说，只有一种方法可以进行此类搜索，即使用 Upper 和 Lower 函数，但俗话说，它存在性能问题。相信我他们是对的，如果你的表有大量数据，那么性能会很尴尬，你永远不会再使用 Upper 和 Lower。我对其他开发人员的问题是：你们如何解决这个问题？

PS 请不要建议更改排序顺序或移动到任何其他数据库，在现实世界中，开发人员不会控制数据库。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-06-22T07:01:36.237

尝试创建一个`functional index`, 像

```
Create Index INDX_MY_SEARCH on TABLE_NAME(LOWER(@MySearch) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-11-23T02:31:12.353

在您的选择语句中添加额外的大写或小写列。例子：

```
select col1, upper(col1) upp_col1 from table1 order by upp_col1 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T09:07:12.193

如果您无法更改数据库的排序顺序（最佳选项），那么未知案例字段的索引将无济于事。如果字段的数量是可管理的，那么有一种方法可以做到这一点并保持性能。您制作了一个额外的列 MyFieldLower。您使用触发器来保持字段用小写的 MyField 填充。

那么查询是： WHERE MyFieldLower = LOWER(@MySearch)

这将使用索引。

# macos - 如何在 OS X 终端中逐字移动光标

> ID：81272
> 
> 赞同：846
> 
> 时间：2008-09-17T08:57:17.040
> 
> 标签：macos, terminal, keyboard-shortcuts

我知道组合`Ctrl`+`A`跳到当前命令的开头，`Ctrl`+`E`跳到结尾。

但是有什么方法可以逐字跳转，就像Cocoa 应用程序中的`Alt`+ `←`/`→`一样？

* * *

## 回答 #1

> 赞同：621
> 
> 时间：2008-09-17T09:04:01.687

Out of the box you can use the quite bizarre `Esc`+`F` to move to the beginning of the next word and `Esc`+`B` to move to the beginning of the current word.

* * *

## 回答 #2

> 赞同：489
> 
> 时间：2011-04-04T19:00:13.680

On Mac OS X - the following keyboard shortcuts work by default. Note that you have to make **Option** key act like **Meta** in Terminal preferences (under keyboard tab)

*   `alt (⌥)`+`F` to jump **F**orward by a word
*   `alt (⌥)`+`B` to jump **B**ackward by a word

I have observed that default emacs key-bindings for simple text navigation seem to work on bash shells. You can use

*   `alt (⌥)`+`D` to delete a word starting from the current cursor position
*   `ctrl`+`A` to jump to start of the line
*   `ctrl`+`E` to jump to end of the line
*   `ctrl`+`K` to kill the line starting from the cursor position
*   `ctrl`+`Y` to paste text from the kill buffer
*   `ctrl`+`R` to reverse search for commands you typed in the past from your history
*   `ctrl`+`S` to forward search (works in zsh for me but not bash)
*   `ctrl`+`F` to move forward by a char
*   `ctrl`+`B` to move backward by a char
*   `ctrl`+`W` to remove the word backwards from cursor position

* * *

## 回答 #3

> 赞同：297
> 
> 时间：2008-09-17T09:01:23.643

* * *

## 回答 #4

> 赞同：186
> 
> 时间：2011-11-24T00:39:30.750

Switch to [iTerm2](http://www.iterm2.com/). It's free and much nicer than plain old terminal. Also it has a lot more options for customization, like keyboard shortcuts.

Also I love that you can use `cmd` and 1-9 to switch between tabs. Try it and you will never go back to regular terminal :)

**How to set up custom keyboard preferences in iterm2**

*   Install iTerm2
*   Launch and then go to preference pane.
*   Choose the keyboard profiles tab
*   You will either need to copy the profile to something new and then delete the arrow key shortcuts such as `^`+ `Right`/`Left` or if you don't care about a backup just delete them from the default profile.
*   Next make sure your modified profile is selected (starred)

[![Picture 1.png](https://i.stack.imgur.com/cqLnO.png)](https://i.stack.imgur.com/cqLnO.png)

*   Now choose the keyboard tab (very top row)

[![iTerm 2](https://i.stack.imgur.com/i2o2y.png)](https://i.stack.imgur.com/i2o2y.png)

*   Click on the plus button to add a new keyboard shortcut
*   In the first box type `CMD`+`Left arrow`
*   In the second box choose "send escape code"
*   In the third box type the letter `B`

[![Picture 2.png](https://i.stack.imgur.com/xFBlY.png)](https://i.stack.imgur.com/xFBlY.png)

*   Repeat with desired key combinations. `escape`+`B` moves one word to the left, `escape`+`f` moves one word to the right.
*   you may also wish to set up `cmd`+`d` to delete the word in front of the cursor with `escape`+`d`

I often hit the wrong button (`cmd` / `control` / `alt`) with an arrow key and so i have my arrow key combinations with those buttons all set to jump forward and back words, but please do what fits you best.

* * *

## 回答 #5

> 赞同：165
> 
> 时间：2012-12-08T17:55:11.563

Actually there is a much better approach. Hold `option` ( `alt` on some keyboards) and press the arrow keys left or right to move by word. Simple as that.

`option``←`
`option``→`

Also `ctrl``e` will take you to the end of the line and `ctrl``a` will take you to the start.

* * *

## 回答 #6

> 赞同：79
> 
> 时间：2008-09-17T09:03:17.913

I have `Alt`+`←`/`→` working: open *Preferences » Settings » Keyboard*, set the entry for *option cursor left* to *send string to shell: \033b*, and set *option cursor right* to *send string to shell: \033f*. You can also use this for other Control key combinations.

* * *

## 回答 #7

> 赞同：38
> 
> 时间：2008-09-17T21:19:20.703

Actually it depends on what shell you use, however most shells have similar bindings. The bindings you are referring to (e.g. `Ctrl`+`A` and `Ctrl`+`E`) are bindings you will find in many other programs and they are used for ages, BTW also work in most UI apps.

Here's a look of default bindings for Bash:

[Most Important Bash Keyboard Shortcuts](http://www.howtogeek.com/howto/ubuntu/keyboard-shortcuts-for-bash-command-shell-for-ubuntu-debian-suse-redhat-linux-etc/)

Please also note that you can customize them. You need to create a file, name as you wish, I named mine .bash_key_bindings and put it into my home directory. There you can set some general bash options and you can also set key bindings. To make sure they are applied, you need to modify a file named *".bashrc"* that bash reads in upon start-up (you must create it, if it does not exist) and make the following call there:

```
bind -f ~/.bash_key_bindings 
```

~ means home directory in bash, as stated above, you can name the file as you like and also place it where you like as long as you feed the right path+name to bind.

Let me show you some excerpts of my .bash_key_bindings file:

```
set meta-flag on
set input-meta on
set output-meta on
set convert-meta off
set show-all-if-ambiguous on
set bell-style none
set print-completions-horizontally off 
```

These just set a couple of options (e.g. disable the bell; this can be all looked up on the bash webpage).

```
"A": self-insert
"B": self-insert
"C": self-insert
"D": self-insert
"E": self-insert
"F": self-insert
"G": self-insert
"H": self-insert
"I": self-insert
"J": self-insert 
```

These make sure that the characters alone just do nothing but making sure the character is "typed" (they insert themselves on the shell).

```
"\C-dW": kill-word
"\C-dL": kill-line
"\C-dw": backward-kill-word
"\C-dl": backward-kill-line
"\C-da": kill-line 
```

This is quite interesting. If I hit `Ctrl`+`D` alone (I selected d for delete), nothing happens. But if I then type a lower case w, the word to the left of the cursor is deleted. If I type an upper case, however, the word to the right of the cursor is killed. Same goes for l and L regarding the whole line starting from the cursor. If I type an "a", the whole line is actually deleted (everything before and after the cursor).

I placed jumping one word forward on `Ctrl`+`F` and one word backward on `Ctrl`+`B`

```
"\C-f": forward-word
"\C-b": backward-word 
```

As you can see, you can make a shortcut, that leads to an action immediately, or you can make one, that just inits a character sequence and then you have to type one (or more) characters to cause an action to take place as shown in the example further above.

So if you are not happy with the default bindings, feel free to customize them as you like. Here's a [link to the bash manual](http://www.gnu.org/software/bash/manual/bashref.html#Bindable-Readline-Commands) for more information.

* * *

## 回答 #8

> 赞同：37
> 
> 时间：2019-05-07T16:03:55.383

Use *Natural Text Editing* preset!

[![enter image description here](https://i.stack.imgur.com/EUuAA.png)](https://i.stack.imgur.com/EUuAA.png)

Essentially it binds, among other key sequences, Option + LeftArrow to `^[b` sequence and Option + RightArrow to `^[f`

This works in fish and bash, as well as in psql terminal.

* * *

## 回答 #9

> 赞同：27
> 
> 时间：2019-04-11T19:23:48.177

Hold down the Option key and click where you'd like the cursor to move

* * *

## 回答 #10

> 赞同：17
> 
> 时间：2011-08-11T23:03:08.283

If you happen to be a Vim user, you could try bash's vim mode. Run this or put it in your `~/.bashrc` file:

```
set -o vi 
```

By default you're in insert mode; hit escape and you can move around just like you can in normal-mode Vim, so movement by word is `w` or `b`, and the [usual movement keys also work](http://tnerual.eriogerg.free.fr/vimqrc.html).

* * *

## 回答 #11

> 赞同：15
> 
> 时间：2008-09-17T09:09:23.420

If you check `Use option as meta key` in the keyboard tab of the preferences, then the default emacs style commands for forward- and backward-word and `⌥F` (`Alt`+`F`) and `⌥B` (`Alt`+`B`) respectively.

I'd recommend reading [From Bash to Z-Shell](https://rads.stackoverflow.com/amzn/click/com/1590593766 "Amazon.com: From Bash to Z Shell: Conquering the Command Line: Oliver Kiddle, Jerry Peek, Peter Stephenson: Books"). If you want to increase your bash/zsh prowess!

* * *

## 回答 #12

> 赞同：14
> 
> 时间：2011-08-12T01:03:03.257

As of Mac OS X Lion 10.7, Terminal maps `Option`-`Left/Right Arrow` to `Esc`-`b/f` by default, so this is now built-in for bash and other programs that use these emacs-compatible keybindings.

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2008-09-17T09:08:22.347

In Bash, these are bound to `Esc`-`B` and `Esc`-`F`. Bash has many, many more keyboard shortcuts; have a look at the output of `bind -p` to see what they are.

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2019-01-02T04:04:37.010

Under `iterm2`'s **Preferences > Profile > Keys**, you click the `+` below **Key Mappings** and record a new shortcut. For **Action**, select `Send Escape Sequence` and type `b` or `f` for backwards and forwards respectively.

When I tried to record one for (`Ctrl`+`←</kbd>), I noticed in the **Keyboard Shortcut** field that the arrow never showed up. Turns out I had to disable the default mac's **System Preferences > Keyboard > Shortcuts > Mission Control** shorcuts first to get things to work, as they'll override iterm2's default shortcuts. Should be true for the standard terminal app, too.`

[![Keyboard system preferences](https://i.stack.imgur.com/mitIx.png)](https://i.stack.imgur.com/mitIx.png)

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2019-09-17T05:47:01.603

As answered previously, you can add `set -o vi` in your `~/.bashrc` to use `vi`/`vim` key bindings, or else you can add following part in `.bashrc` to move with `Ctrl` and arrow keys:

```
# bindings to move 1 word left/right with ctrl+left/right in terminal, just some apple stuff!
bind '"\e[5C": forward-word'
bind '"\e[5D": backward-word'
# bindings to move 1 word left/right with ctrl+left/right in iTerm2, just some apple stuff!
bind '"\e[1;5C": forward-word'
bind '"\e[1;5D": backward-word' 
```

To start effect of these lines of code, either `source ~/.bashrc` or start a new terminal session.

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2019-10-01T18:11:02.687

New answer for iTerm2 Build 3.3.4 users:

Step 1: (macOS X) System Preferences > Keyboard > Shortcuts tab > Select Mission Control (left panel) > Uncheck shortcuts that labeled as "Move left a space" and "Move right a space"

Step 2: (iTerm2 Build 3.3.4) Preferences > Profiles > Select * Default (left panel) > Keys tab > Delete both "⌥->" and "⌥&lt;-" entries > Set both "Left Option (⌥) Key:" and "Right Option (⌥) Key:" to Esc+

No messing around with shell profiles, no messing around with inferior masOS (default) Terminal, no awkwards Esc+F/B, rinse & repeat non-sense.

Done deal!!!

Enjoy this tip, my fellow PROGRAMMERS!

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2020-09-03T00:25:39.990

For some reason, my terminal's option+arrow weren't working. To fix this on macOS 10.15.6, I opened the terminal app's preferences, and had to set the bindings.

```
Option-left = \033b
Option-right = \033e 
```

[![Keyboard settings in Mac terminal app](https://i.stack.imgur.com/fFjC8.png)](https://i.stack.imgur.com/fFjC8.png)

For some reason, the `option-right` I had was set up to be `\033f`. Now that it's fixed, I can freely skip around words in the termianl again.

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2021-09-09T08:15:32.647

Just check the "**Use Option as meta key**" option in **Terminal > Preferences > Settings > [profile] > Keyboard**, as mentioned here already by @cris-page.

Note however, that in macOS Catalina (10.15) and newer, **zsh** becomes the default shell for newly added users: its default configuration considers only whitespaces as word-boundaries, whereas the old **bash** makes meta-left/right jump to the nearest *non-alphanumerical* character (similar to `B`/`W` as opposed to `b`/`w` for those familiar with *vim*):

```
 v----v- bash jumps here
$ vim some-folder/what.txt_<- jump left twice from here
  ^---^- zsh jumps here by default 
```

(similar motions are true for *meta-backspace* as well)

There are more than one ways to make zsh command line editor navigation work similarly to bash's - here is one such method:

```
# Place in your profile init script, e.g. `~/.zshrc`
autoload -U select-word-style
select-word-style bash 
```

# sql-server - 避免 SQL Server 上急切假脱机操作的方法

> ID：81278
> 
> 赞同：41
> 
> 时间：2008-09-17T08:58:18.393
> 
> 标签：sql-server, tsql, spool, eager

我有一个 ETL 过程，其中涉及一个存储过程，该过程大量使用`SELECT INTO`语句（最少记录，因此速度更快，因为它们生成的日志流量更少）。在一个特定存储的存储过程中发生的一批工作中，几个最昂贵的操作是急切的假脱机，它们似乎只是缓冲查询结果，然后将它们复制到刚刚制作的表中。

[关于Eager spools](http://msdn.microsoft.com/en-us/library/ms190435.aspx)的 MSDN 文档非常少。有没有人对这些是否真的有必要（以及在什么情况下）有更深入的了解？我有一些理论可能有意义，也可能没有意义，但没有成功从查询中消除这些理论。

.sqlplan 文件非常大（160kb），所以我想将它们直接发布到论坛可能不合理。

因此，这里有一些可能适用于特定答案的理论：

*   该查询使用一些 UDF 进行数据转换，例如解析格式化的日期。这种数据转换是否需要在构建表之前使用急切的假脱机来为表分配合理的类型（例如 varchar 长度）？
*   作为上述问题的扩展，是否有人对查询中驱动此操作或不驱动此操作的内容有更深入的了解？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-09-17T20:23:10.133

我对假脱机的理解是，它对您的执行计划有点牵强。是的，它占了您查询成本的很大一部分，但它实际上是 SQL Server 自动进行的优化，因此它可以避免代价高昂的重新扫描。如果要避免假脱机，它所在的执行树的成本会上升，几乎可以肯定整个查询的成本会增加。对于可能导致数据库的查询优化器以这种方式解析执行的具体原因，我没有任何特别的见解，尤其是在没有看到 SQL 代码的情况下，但您最好相信它的行为。

但是，这并不意味着您的执行计划无法优化，具体取决于您正在做什么以及源数据的易失性。当你在做一个`SELECT INTO`时，你会经常在你的执行计划中看到假脱机项目，这可能与读隔离有关。如果它适合您的特定情况，您可以尝试将事务隔离级别降低到成本较低的水平，和/或使用`NOLOCK`提示。我在复杂的性能关键查询中发现`NOLOCK`，如果安全且适合您的数据，即使似乎没有任何理由，它也可以极大地提高查询执行速度。

在这种情况下，如果您尝试`READ UNCOMMITTED`或`NOLOCK`提示，您也许可以消除一些 Spools。（很明显，如果这样做可能会使您处于不一致的状态，那么您不希望这样做，但是每个人的数据隔离要求都不同）。`TOP`运算符和运算`OR`符偶尔会导致假脱机，但我怀疑您是否在 ETL 过程中执行任何这些...

您说得对，您的 UDF 也可能是罪魁祸首。如果您只使用每个 UDF 一次，那么尝试将它们内联以查看您是否获得了很大的性能优势，这将是一个有趣的实验。（如果你想不出一种方法将它们与查询内联，这可能就是它们可能导致假脱机的原因）。

One last thing I would look at is that, if you're doing any joins that can be re-ordered, try using a hint to force the join order to happen in what you know to be the most selective order. That's a bit of a reach but it doesn't hurt to try it if you're already stuck optimizing.

# wpf - 如何从不从 FrameworkElement 派生的类中收听 RoutedEvent ？可以做到吗？

> ID：81280
> 
> 赞同：2
> 
> 时间：2008-09-17T08:58:38.813
> 
> 标签：wpf, routed-events

这个问题基本上说明了一切。

我想在一个

```
class MyClass 
```

收听路由事件。可以做到吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T09:54:13.377

实际上我以错误的方式连接了事件：|

我有

```
EventManager.RegisterClassHandler ( typeof ( MyClass )...... 
```

代替

```
EventManager.RegisterClassHandler ( typeof ( TheClassThatOwnedTheEvent ) 
```

所以..我的坏。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T09:52:17.030

如果您可以创建从 FrameworkElement 派生的 MyClass 的*内部*类（称为 MyInnerClass），同时保留访问封闭 MyClass 对象的能力，您的问题将得到解决。然后，您可以在 MyClass 中实现一个“getListener”方法，该方法返回嵌入的 MyInnerClass，您将使用它来实际侦听事件。

# asp.net - 我应该如何在 ASP.NET 中检测上传文件的 MIME 类型？

> ID：81283
> 
> 赞同：24
> 
> 时间：2008-09-17T08:59:12.290
> 
> 标签：asp.net, types, mime

人们通常如何使用 ASP.NET 检测上传文件的 MIME 类型？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-09-17T09:04:40.593

在 aspx 页面中：

```
<asp:FileUpload ID="FileUpload1" runat="server" /> 
```

在代码隐藏（c#）中：

```
string contentType = FileUpload1.PostedFile.ContentType 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-08-06T12:02:06.117

如果文件被重命名和上传，上面的代码将不会给出正确的内容类型。

请为此使用此代码

```
using System.Runtime.InteropServices;

[DllImport("urlmon.dll", CharSet = CharSet.Unicode, ExactSpelling = true, SetLastError = false)]
static extern int FindMimeFromData(IntPtr pBC,
    [MarshalAs(UnmanagedType.LPWStr)] string pwzUrl,
    [MarshalAs(UnmanagedType.LPArray, ArraySubType = UnmanagedType.I1, SizeParamIndex = 3)] byte[] pBuffer,
    int cbSize,
    [MarshalAs(UnmanagedType.LPWStr)] string pwzMimeProposed,
    int dwMimeFlags, out IntPtr ppwzMimeOut, int dwReserved);

public static string getMimeFromFile(HttpPostedFile file)
{
    IntPtr mimeout;

    int MaxContent = (int)file.ContentLength;
    if (MaxContent > 4096) MaxContent = 4096;

    byte[] buf = new byte[MaxContent];
    file.InputStream.Read(buf, 0, MaxContent);
    int result = FindMimeFromData(IntPtr.Zero, file.FileName, buf, MaxContent, null, 0, out mimeout, 0);

    if (result != 0)
    {
        Marshal.FreeCoTaskMem(mimeout);
        return "";
    }

    string mime = Marshal.PtrToStringUni(mimeout);
    Marshal.FreeCoTaskMem(mimeout);

    return mime.ToLower();
} 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-11-29T00:48:23.230

虽然 aneesh 说 HTTP 请求的内容类型可能不正确是正确的，但我认为非托管调用的编组是不值得的。如果您需要回退到扩展到 mimetype 的映射，只需从 System.Web.MimeMapping.cctor 中“借用”代码（使用 Reflector）。这种字典方法绰绰有余，不需要本机调用。

# windows - Windows Vista 以编程方式重新映射用户目录

> ID：81285
> 
> 赞同：0
> 
> 时间：2008-09-17T08:59:19.793
> 
> 标签：windows, windows-vista, user-environment

我定期为我的一台机器重新成像；并在操作系统安装完成后运行一个脚本来配置我的机器；这样它就可以按我喜欢的方式工作。

我碰巧有我的数据在另一个驱动器上......我想在我的脚本中添加代码以将 Documents 目录的位置从“C:\Users\bryansh\Documents”更改为“D:\Users\bryansh \文档”。

在我启动 regmon 并真正卷起袖子之前，有人有任何见解吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T09:01:07.810

我使用重新解析点[http://www.hanselman.com/blog/MoreOnVistaReparsePoints.aspx](http://www.hanselman.com/blog/MoreOnVistaReparsePoints.aspx)来重定向我的文档。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T09:10:55.523

[`SHSetFolderPath`函数](http://msdn.microsoft.com/en-us/library/bb762247(VS.85).aspx)应该有所帮助，因为[本文](http://technet.microsoft.com/en-us/library/cc787939.aspx)提到了它用于通过组策略 API 进行文件夹重定向。

# design-patterns - 用于保存和写入不同文件格式的模式

> ID：81288
> 
> 赞同：5
> 
> 时间：2008-09-17T08:59:44.270
> 
> 标签：design-patterns, file-io

在保存和加载不同的文件格式时，是否有一种很好用的模式？

例如，我有一个复杂的文档类层次结构，但我想支持几种不同的文件格式。

我考虑了策略模式，但我不相信，因为需要访问对象的每个部分才能保存和加载它。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T09:17:08.583

您可以使用[访问者模式](http://en.wikipedia.org/wiki/Visitor_pattern)，它允许根据访问者当前正在处理的节点对您的层次结构进行不同的操作。

坏消息：您可能需要在层次结构的顶部添加至少一个虚拟方法，并且可能在某些派生类中重新定义它，访问者仍然访问节点的数据，但是您将文件格式解耦，作为不同的访问者实现可以写入以不同方式收集的数据。

如果必须隐藏类层次结构数据，还可以查看[备忘录模式。](http://en.wikipedia.org/wiki/Memento_pattern)[这篇文章](http://www.ondotnet.com/pub/a/dotnet/2002/09/09/memento.html)也可能会有所帮助。

编辑：使用谷歌缓存链接到原始[备忘录模式文章](http://webcache.googleusercontent.com/search?q=cache:www.ondotnet.com/pub/a/dotnet/2002/09/09/memento.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T09:06:29.997

您可能想看看 Builder 模式。第 97 页 ..

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T09:09:39.223

（基于）[模板方法模式](http://en.wikipedia.org/wiki/Template_method_pattern)怎么样？

一个超类知道如何拆分类层次结构，但依赖于它的子类来实际做一些有用的事情。

# c - sizeof(bitfield_type) 在 ANSI C 中合法吗？

> ID：81294
> 
> 赞同：4
> 
> 时间：2008-09-17T09:00:31.570
> 
> 标签：c

```
struct foo { unsigned x:1; } f;
printf("%d\n", (int)sizeof(f.x = 1)); 
```

预期的输出是什么，为什么？不允许直接取位域左值的大小。但是通过使用赋值运算符，我们似乎仍然可以获取位域类型的大小。

什么是“位域的字节大小”？它是保存位域的存储单元的大小吗？是 bf 占用的位数四舍五入到最接近的字节数吗？

或者是构造未定义的行为，因为标准中没有任何内容可以回答上述问题？同一平台上的多个编译器给我的结果不一致。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-17T15:18:29.040

你是对的，整数提升不适用于 的操作数`sizeof`：

> 整数提升仅适用于：作为通常算术转换的一部分，适用于某些参数表达式，适用于一元 +、- 和 ~ 运算符的操作数，以及移位运算符的两个操作数，由它们各自的子条款指定。

真正的问题是位域是否有自己的类型。

约瑟夫迈尔斯告诉我：

> C90 DR 的结论是位域有自己的类型，而 C99 DR 的结论是让它们是否有自己的类型实现定义，而 GCC 遵循 C90 DR，因此分配的类型为 int:1 而不是提升为 sizeof 的操作数。

这在[缺陷报告 #315](http://www.open-std.org/jtc1/sc22/wg14/www/docs/dr_315.htm)中进行了讨论。

总结一下：您的代码是合法的，但由实现定义。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-17T13:42:16.743

C99 标准（[最新草案的 PDF](http://www.open-std.org/JTC1/SC22/WG14/www/docs/n1256.pdf)）在第 6.5.3.4 节中说关于`sizeof`约束：

> `sizeof`运算符不应应用于具有函数类型或不完整类型的表达式、此类类型的括号名称或指定位域成员的表达式。

这意味着允许应用于`sizeof`赋值*表达式*。

6.5.16.3 说：

> 赋值表达式的类型是左操作数的类型...

6.3.1.1.2 说关于整数促销：

> 可以在可以使用 int 或 unsigned int 的表达式中使用以下内容：
> 
> *   ...
> *   `_Bool`, `int`,`signed int`或类型的位域`unsigned int`。
> 
> 如果 int 可以表示原始类型的所有值，则将该值转换为`int`; 否则，将其转换为`unsigned int`.

因此，您的测试程序应该输出 的大小`int`，即 `sizeof(int)`.

有没有不这样做的编译器？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T09:18:51.387

如您所见，尝试获取位域的大小是不合法的。（`sizeof`以字节为单位返回大小，这对于位域没有多大意义。）

`sizeof(f.x = 1)`将返回表达式类型的大小。由于 C 没有真正的“位域类型”，因此在您的示例中，表达式（此处：赋值表达式）通常获取位域的基本类型的类型，`unsigned int`但编译器可以在内部使用较小的类型（在这种情况下可能是`unsigned char`因为它足够大一点）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T09:10:36.757

不会

```
(f.x = 1) 
```

是一个表达式，计算结果为真（技术上计算为赋值的结果，在这种情况下为 1/true），因此，

```
sizeof( f.x = 1) 
```

是根据存储它需要多少个字符来询问 true 的大小？

我还应该补充一点，关于[sizeof](http://en.wikipedia.org/wiki/Sizeof)的维基百科文章很好。特别是，他们说“sizeof 是一个编译时运算符，它返回它前面的变量或带括号的类型说明符的大小，以 char 大小的倍数表示。”

文章还解释了 sizeof 对表达式起作用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T09:18:17.690

```
sizeof( f.x = 1) 
```

返回 1 作为其答案。sizeof(1) 可能是您正在编译的平台上的整数大小，可能是 4 或 8 个字节。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T09:18:37.737

不，您一定在考虑 == 运算符，它在 C 中产生 int 类型的“布尔”表达式，在 C++ 中确实产生 bool。

我认为表达式会将值 1 转换为对应的位域类型并将其分配给位域。结果也应该是位域类型，因为我看不到隐藏的促销或转换。

因此，我们有效地访问了位域类型。

不需要编译器诊断，因为“fx = 1”不是左值，即它不直接指定位域。它只是“无符号：1”类型的值。

我专门使用“fx = 1”，因为“sizeof fx”采用位域左值的大小，这显然是不允许的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T09:19:05.240

这

```
(f.x = 1) 
```

**不是表达式，它是一个赋值**，因此返回赋值。在这种情况下，该值的大小取决于已分配给它的变量。

```
unsigned x:1 
```

有 1 位，它的 sizeof 返回 1 字节（8 位对齐）

如果你会使用

```
unsigned x:12 
```

然后 sizeof(fx = 1) 将返回 2 字节（再次因为 8 位对齐）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-17T09:21:28.807

> sizeof(1) 可能是您正在编译的平台上的整数大小，可能是 4 或 8 个字节。

请注意，我没有使用 sizeof(1)，它实际上是 sizeof(int)。仔细看，我正在使用 sizeof(fx = 1)，它实际上应该是 sizeof(bitfield_type)。

我想看到一个参考，告诉我构造是否合法。作为额外的奖励，如果它告诉我预期什么样的结果会很好。

gcc 当然不同意 sizeof(bitfield_type) 应该与 sizeof(int) 相同的断言，但仅在某些平台上。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-17T09:24:09.983

> 如您所见，尝试获取位域的大小是不合法的。（sizeof 以字节为单位返回大小，这对于位域没有多大意义。）

那么你是说行为是未定义的，即它与“*（int *）0 = 0;”具有相同程度的合法性，编译器可以选择不明智地处理这个问题？

这就是我想要找出的。您是否认为它因遗漏而未定义，或者是否有明确声明它是非法的？

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-17T09:36:20.970

> 不是表达式，它是一个赋值，因此返回赋值。在这种情况下，该值的大小取决于已分配给它的变量。

首先，它**是**一个包含赋值运算符的表达式。

其次，我很清楚我的例子中发生了什么:)

> 然后 sizeof(fx = 1) 将返回 2 字节（再次因为 8 位对齐）

你从哪里得到这个？这是在您尝试过的特定编译器上发生的情况，还是标准中规定了这些语义？因为我还没有找到任何这样的说法。我想知道该构造是否完全可以保证工作。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-17T09:52:06.203

在第二个示例中，如果您将结构定义为

```
struct foo { unsigned x:12} f; 
```

然后将像 1 这样的值写入 fx - 由于对齐，它使用 2 个字节。如果你做一个像

```
f.x = 1; 
```

这将返回分配的值。这与

```
int a, b, c;
a = b = c = 1; 
```

从右到左评估分配的位置。c = 1 将 1 分配给变量 c，并且此分配返回分配的值并将其分配给 b（依此类推），直到 1 分配给 a

它等于

```
a = ( b = ( c = 1 ) ) 
```

在您的情况下， sizeof 获取分配的大小，这**不是**位域，而是分配给它的变量。

```
sizeof ( f.x = 1) 
```

不返回位域大小，但变量赋值是 1 的 12 位表示（在我的情况下），因此 sizeof() 返回 2 字节（因为 8 位对齐）

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-17T09:58:45.003

看，我完全理解我在用分配技巧做什么。

您是在告诉我位域类型的大小四舍五入到最近的字节数，这是我在最初的问题中列出的一个选项。但是你没有用引用来支持它。

特别是，我尝试了各种编译器，即使我将它应用于只有一个位的位域，它们也会给我 sizeof(int) 而不是 sizeof(char) 。

我什至不介意多个编译器随机选择他们自己对这个结构的解释。当然，位域存储分配是完全由实现定义的。

但是，我真的很想知道该构造是否可以**保证**工作并产生**一些**价值。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-17T15:03:57.937

CL，我以前看过你的引用，并且同意它们是完全相关的，但即使在阅读它们之后，我也不确定代码是否已定义。

> 6.3.1.1.2 说关于整数促销：

是的，但整数促销规则仅适用于实际执行促销的情况。我不认为我的例子需要提升。同样，如果你这样做

```
char ch;
sizeof ch; 
```

...然后 ch 也没有被提升。

我认为我们在这里直接处理位域类型。

我还看到了 gcc 输出 1，而许多其他编译器（甚至其他 gcc 版本）却没有。这并不能说服我该代码是**非法**的，因为大小也可以由实现定义，足以使多个编译器之间的结果不一致。

但是，我对代码是否可能未定义感到困惑，因为标准中似乎没有任何内容说明如何处理 sizeof 位域的情况。

# c# - Custom X509SecurityTokenManager ignored

> ID：81295
> 
> 赞同：1
> 
> 时间：2008-09-17T09:00:46.297
> 
> 标签：c#, web-services, certificate, x509

I have a webservice that that uses message layer security with X.509 certificates in WSE 3.0\. The service uses a X509v3 policy to sign various elements in the soapheader.

I need to do some custom checks on the certificates so I've tried to implement a custom X509SecurityTokenManager and added a section in web.config.

When I call the service with my Wseproxy I would expect a error (NotImplementedException) but the call goes trough and, in the example below, "foo" is printed at the console.

The question is: What have missed? The binarySecurityTokenManager type in web.config matches the full classname of RDI.Server.X509TokenManager. X509TokenManager inherits from X509SecurityTokenManager (altough methods are just stubs).

```
using System;
using System.Xml;
using System.Security.Permissions;
using System.Security.Cryptography;
using Microsoft.Web.Services3;
using Microsoft.Web.Services3.Security.Tokens;

namespace RDI.Server
{

[SecurityPermissionAttribute(SecurityAction.Demand,Flags = SecurityPermissionFlag.UnmanagedCode)]
public class X509TokenManager : Microsoft.Web.Services3.Security.Tokens.X509SecurityTokenManager
{
    public X509TokenManager() : base()
    {
        throw new NotImplementedException("Stub");
    }

    public X509TokenManager(XmlNodeList configData) : base(configData)
    {
        throw new NotImplementedException("Stub");
    }

    protected override void AuthenticateToken(X509SecurityToken token)
    {
        base.AuthenticateToken(token);
        throw new NotImplementedException("Stub");
    }
}
} 
```

The first few lines of my web.config, edited for brevity

```
<?xml version="1.0"?>
  <configuration><configSections><section name="microsoft.web.services3" type="..." />
  </configSections>
  <microsoft.web.services3>
    <policy fileName="wse3policyCache.config" />
    <security>
      <binarySecurityTokenManager>
        <add type="RDI.Server.X509TokenManager" valueType="http://docs.oasis-open.org/..." />
      </binarySecurityTokenManager>
    </security>
  </microsoft.web.services3>` 
```

(Btw, how do one format xml nicely here at stackoverflow?)

```
Administration.AdministrationWse test = new TestConnector.Administration.AdministrationWse();

X509Certificate2 cert = GetCert("RDIDemoUser2");
X509SecurityToken x509Token = new X509SecurityToken(cert);
test.SetPolicy("X509");
test.SetClientCredential(x509Token);

string message = test.Ping("foo");

Console.WriteLine(message); 
```

I'm stuck at .NET 2.0 (VS2005) for the time being so I presume WCF is out of the question, otherwise interoperability isn't a problem, as I will have control of both clients and services in the system.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-18T12:31:59.197

问题出在其他地方。我的服务器项目是一个网络应用程序，某些选项不适用于仅适用于网站的网络应用程序。所以我做了一个小型网站项目并比较了 web.configs 并注意到有些行有所不同。

这些行在网站 web.config 中，但不在我的其他项目中

```
 <soapServerProtocolFactory type="Microsoft.Web.Services3.WseProtocolFactory, Microsoft.Web.Services3, Version=3.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" />
  <soapExtensionImporterTypes>
    <add type="Microsoft.Web.Services3.Description.WseExtensionImporter, Microsoft.Web.Services3, Version=3.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" />
  </soapExtensionImporterTypes> 
```

添加这些行后，我得到了预期的错误。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T09:59:33.410

我知道不是特别有建设性的建议，但如果我是你，我会尽快离开 WSE3.0。今年早些时候，我们做了一些工作，试图让它与 WCF 和 Java 客户端互操作，但它是一个过时的 KNIGHTMARE。

另一方面，WCF 实际上是理智的，关于此类领域的文档非常好。这对你来说是一个选择吗？

# c# - Where to put the dependency injection framework config file?

> ID：81305
> 
> 赞同：1
> 
> 时间：2008-09-17T09:02:33.530
> 
> 标签：c#, .net, dependency-injection, inversion-of-control

I've got a solution with several different projects in it, some are pure class libraries and some are web app projects. If I want my default types to be available to all projects, where should I put the config file for the container?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-17T23:36:46.060

我倾向于做的是在解决方案根目录中创建它。然后，对于每个需要它的项目，我会：

*   右键单击->添加现有
*   浏览并选择文件
*   单击向下箭头并选择“添加为链接”
*   选择项目中的文件
*   特性
*   构建动作 -> 内容
*   复制到输出目录 -> 如果更新则复制

然后，当您初始化 Dependency Inject 框架时，您可以使用类似`Server.MapPath("~/bin/filename.config")`.

# wcf - WCF - 错误/异常与消息

> ID：81306
> 
> 赞同：37
> 
> 时间：2008-09-17T09:03:07.260
> 
> 标签：wcf, exception

我们目前正在争论是否最好通过 WCF 通道抛出错误，而不是传递指示状态的消息或来自服务的响应。

错误来自 WCF 的内置支持，您可以在其中使用内置的错误处理程序并做出相应的反应。然而，这会带来开销，因为在 .NET 中引发异常可能会非常昂贵。

消息可以包含必要的信息来确定您的服务调用发生了什么，而无需引发异常的开销。然而，它确实需要几行重复的代码来分析消息并确定其内容之后的操作。

我们尝试创建一个可以在我们的服务中使用的通用消息对象，这就是我们想出的：

```
public class ReturnItemDTO<T>
{
    [DataMember]
    public bool Success { get; set; }

    [DataMember]
    public string ErrorMessage { get; set; }

    [DataMember]
    public T Item { get; set; }
} 
```

如果我的所有服务调用都返回此项目，我可以持续检查“成功”属性以确定一切是否顺利。然后，如果需要，我会在指示出现问题的事件中收到错误消息字符串，以及包含 Dto 的通用项目。

异常信息必须记录到中央日志服务，而不是从服务传回。

想法？评论？想法？建议？

**进一步澄清我的问题**

我遇到的错误合同问题是传达业务规则。

例如，如果有人登录，并且他们的帐户被锁定，我该如何沟通？他们的登录显然失败了，但由于“帐户锁定”的原因而失败。

我也是：

A) 使用布尔值，在消息帐户被锁定的情况下抛出错误

B）返回带有相关信息的AuthenticatedDTO

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-09-17T09:09:10.910

> 然而，这会带来开销，因为在 .NET 中引发异常可能会非常昂贵。

您正在将对象序列化和反序列化为 XML 并通过慢速网络发送它们。与此相比，抛出异常的开销可以忽略不计。

我通常坚持抛出异常，因为它们清楚地传达出了问题，并且*所有*Web 服务工具包都有处理它们的好方法。

在您的示例中，我会抛出带有“帐户锁定”消息的 UnauthorizedAccessException。

*澄清：* .NET wcf 服务默认将异常转换为 FaultContracts，但您可以更改此行为。[MSDN：指定和处理合同和服务中的错误](http://msdn.microsoft.com/en-us/library/ms733721.aspx)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-09-25T05:39:43.657

如果您考虑像调用任何其他方法一样调用服务，这可能有助于正确看待事情。想象一下，如果您调用的每个方法都返回一个状态，而您需要检查它是真还是假。这会变得相当乏味。

```
result = CallMethod();
if (!result.Success) handleError();

result = CallAnotherMethod();
if (!result.Success) handleError();

result = NotAgain();
if (!result.Success) handleError(); 
```

这是结构化错误处理系统的优势之一，您可以将实际逻辑与错误处理分开。您不必继续检查，如果没有抛出异常，您就知道它是成功的。

```
try 
{
    CallMethod();
    CallAnotherMethod();
    NotAgain();
}
catch (Exception e)
{
    handleError();
} 
```

同时，通过返回结果，您将更多的责任放在了客户身上。您可能很清楚要检查结果对象中的错误，但是 John Doe 进来并开始调用您的服务，因为没有抛出异常而忘记了任何错误。例外的另一个巨大优势是，当出现问题并需要处理时，它们会给我们一个很好的耳光。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T09:13:39.777

我会认真考虑使用 FaultContract 和 FaultException 对象来解决这个问题。这将允许您将有意义的错误消息传递回客户端，但仅限于发生故障情况时。

不幸的是，我目前正在参加培训课程，因此无法写出完整的答案，但幸运的是，我正在学习 WCF 应用程序中的异常管理。今晚我会回复更多信息。（对不起，这是一个微弱的答案）

# winforms - DataGridView：如何以可用的方式进行多行数据输入？

> ID：81315
> 
> 赞同：0
> 
> 时间：2008-09-17T09:05:08.423
> 
> 标签：winforms, datagridview

使用 DataGridView 可以显示包含一些长文本的单元格。网格只是增加了行高以显示所有文本，同时处理自动换行和换行。数据输入也是可能的。`Control`+`Return`插入换行符。

但是：如果单元格最初只有一行文本，则行高只是一行的高度。当我输入文字时，我总是只看到一行。Ctrl+Return 向上滚动文本，我可以输入一个新行。但是最后一行不再可见，只有我刚刚输入的那一行。

如何告诉 DataGridView 在输入文本时自动增加行高？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-17T09:13:30.010

这里有一个来自 DataGridView 程序管理器的条目[，](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=60290&SiteID=1)应该是一个很好的起点。

# c# - 在存储库接口的各种实现上使用相同的测试套件

> ID：81317
> 
> 赞同：3
> 
> 时间：2008-09-17T09:05:30.123
> 
> 标签：c#, unit-testing, interface, duplication

我一直在按照 Rob Connery 的 Asp.net MVC 店面用 C# 制作一个小玩具 Web 应用程序。

我发现我有一个存储库接口，称之为 IFooRepository，带有方法，比如说

```
IQueryable<Foo> GetFoo();
void PersistFoo(Foo foo); 
```

我有这三个实现：ISqlFooRepository、IFileFooRepository 和 IMockFooRepository。

我也有一些测试用例。我想做的，但还没有想出如何去做，是对这三个实现中的每一个运行相同的测试用例，并为每个接口类型的每个测试通过一个绿色勾号。

例如

```
[TestMethod]
Public void GetFoo_NotNull_Test()
{
   IFooRepository repository = GetRepository();
   var results = repository. GetFoo();
   Assert.IsNotNull(results);
} 
```

我希望这个测试方法运行 3 次，环境中的一些变化允许它获取三种不同类型的存储库。目前我有三个剪切和粘贴的测试类，它们仅在私有帮助器方法 IFooRepository GetRepository() 的实现上有所不同；显然，这很臭。

但是，我不能仅仅通过合并剪切和粘贴方法来消除重复，因为它们需要存在、公开并标记为测试才能运行测试。

我正在使用 Microsoft 测试框架，如果可以的话，我更愿意继续使用它。但是关于如何在 MBUnit 中执行此操作的建议也会引起一些兴趣。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T09:07:09.603

在 MbUnit 中，您可能能够使用 RowTest 属性来指定测试的参数。

```
[RowTest]
[Row(new ThisRepository())]
[Row(new ThatRepository())]
Public void GetFoo_NotNull_Test(IFooRepository repository)
{
   var results = repository.GetFoo();
   Assert.IsNotNull(results);
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-17T09:32:03.663

创建一个包含测试的具体版本的抽象类和一个返回 IFooRepository 的抽象 GetRepository 方法。创建三个派生自抽象类的类，每个类都以返回适当 IFooRepository 实现的方式实现 GetRepository。将所有三个类添加到您的测试套件中，您就可以开始了。

为了能够有选择地为某些提供程序而不是其他提供程序运行测试，请考虑使用 MbUnit '[FixtureCategory]' 属性对您的测试进行分类 - 建议的类别是 'quick' 'slow' 'db' 'important' 和 'unimportant' (最后两个是笑话 - 老实说！）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T09:16:56.400

如果您有 3 种复制和粘贴的测试方法，您应该能够重构（提取方法）它以消除重复。

即这就是我的想法：

```
private IRepository GetRepository(RepositoryType repositoryType)
{
    switch (repositoryType)
    {   
          case RepositoryType.Sql:
          // return a SQL repository
          case RepositoryType.Mock:
          // return a mock repository
          // etc
    }
}

private void TestGetFooNotNull(RepositoryType repositoryType)
{
   IFooRepository repository = GetRepository(repositoryType);
   var results = repository.GetFoo();
   Assert.IsNotNull(results);
}

[TestMethod]
public void GetFoo_NotNull_Sql()
{
   this.TestGetFooNotNull(RepositoryType.Sql);
}

[TestMethod]
public void GetFoo_NotNull_File()
{
   this.TestGetFooNotNull(RepositoryType.File);
}

[TestMethod]
public void GetFoo_NotNull_Mock()
{
   this.TestGetFooNotNull(RepositoryType.Mock);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T10:26:41.393

```
[TestMethod]
public void GetFoo_NotNull_Test_ForFile()
{   
   GetFoo_NotNull(new FileRepository().GetRepository());
}

[TestMethod]
public void GetFoo_NotNull_Test_ForSql()
{   
   GetFoo_NotNull(new SqlRepository().GetRepository());
}

private void GetFoo_NotNull(IFooRepository repository)
{
  var results = repository. GetFoo();   
  Assert.IsNotNull(results);
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T12:22:21.850

总结一下，有以下三种方法：

1）使测试成为调用常用方法的衬线（Rick 的回答，也是 Hallgrim）

2）使用 MBUnit 的 RowTest 功能自动执行此操作（Jon Limjap 的回答）。我也会在这里使用枚举，例如

```
[RowTest]
[Row(RepositoryType.Sql)]
[Row(RepositoryType.Mock)]
public void TestGetFooNotNull(RepositoryType repositoryType)
{
   IFooRepository repository = GetRepository(repositoryType);
   var results = repository.GetFoo();
   Assert.IsNotNull(results);
} 
```

3）使用基类，由belugabob回答
我根据这个想法制作了一个样本

```
public abstract class TestBase
{
    protected int foo = 0;

    [TestMethod]
    public void TestUnderTen()
    {
        Assert.IsTrue(foo < 10);
    }

    [TestMethod]
    public void TestOver2()
    {
        Assert.IsTrue(foo > 2);
    }
}

[TestClass]
public class TestA: TestBase
{
    public TestA()
    {
        foo = 4;
    }
}

[TestClass]
public class TestB: TestBase
{
    public TestB()
    {
        foo = 6;
    }
} 
```

这会在两个测试类中产生四个通过测试。
3 的好处是：
1）最少的额外代码，最少的维护
2）如果需要，插入新存储库的输入最少 - 与其他地方不同，它将在一个地方完成。

缺点是：
1) 如果需要，不针对提供者运行测试的灵活性较低
2) 更难阅读。

# java - 更改 String(byte[]) 的默认编码

> ID：81323
> 
> 赞同：10
> 
> 时间：2008-09-17T09:06:33.770
> 
> 标签：java, encoding

有没有办法改变 String(byte[]) 构造函数使用的编码？

在我自己的代码中，我使用 String(byte[],String) 来指定编码，但我使用的是无法更改的外部库。

```
String src = "with accents: é à";
byte[] bytes = src.getBytes("UTF-8");
System.out.println("UTF-8 decoded: "+new String(bytes,"UTF-8"));
System.out.println("Default decoded: "+new String(bytes)); 
```

输出是：

```
UTF-8 解码：带重音符号：é à
默认解码：带重音符号：Ã© Ã 

```

我尝试更改系统属性`file.encoding`，但它不起作用。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-17T09:12:56.080

您需要在启动 JVM 之前更改语言环境；看：

[Java，错误 ID 4163515](http://bugs.sun.com/bugdatabase/view_bug.do;jsessionid=6f932817e77b249681417c21bfaf?bug_id=4163515)

有些地方似乎暗示您可以通过在启动 JVM 时设置 file.encoding 变量来做到这一点，例如

```
java -Dfile.encoding=UTF-8 ... 
```

...但我自己没有尝试过。最安全的方法是在操作系统中设置环境变量。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T09:12:26.457

引用自[defaultCharset()](http://java.sun.com/j2se/1.5.0/docs/api/java/nio/charset/Charset.html)

> 默认字符集在虚拟机启动期间确定，通常取决于底层操作系统的区域设置和字符集。

在大多数操作系统中，您可以使用环境变量设置字符集。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-10-06T16:42:42.313

我想你想要这个： System.setProperty("file.encoding", "UTF-8");

它解决了一些问题，但我还有其他问题。如果 SO 为 ISO-8859-1，则字符“í”和“Í”无法正确转换。只需在启动时使用 JVM 选项，我就可以解决它。现在，我在 NetBeans IDE 中的 Java 控制台在显示特殊字符时会导致字符集崩溃。

# blogs - 如何在 wordpress.com 上写博客代码

> ID：81338
> 
> 赞同：72
> 
> 时间：2008-09-17T09:09:00.443
> 
> 标签：blogs, code-formatting, wordpress.com

几天前在 wordpress 上获得了一个新博客（[http://ghads.wordpress.com](http://ghads.wordpress.com)），我想不时发布一些代码片段。有没有办法让它看起来像代码而不需要支付额外的插件？

* * *

## 回答 #1

> 赞同：116
> 
> 时间：2008-09-17T09:11:14.883

见这里：[http ://en.support.wordpress.com/code/posting-source-code/](http://en.support.wordpress.com/code/posting-source-code/)

将您的代码包装在这些标签中：[sourcecode language='css'] .. [/sourcecode]

（或更短的 [code lang='css'] .. [/code] ）

请注意，可视化编辑器不会解释标签，您需要单击预览以查看它是如何工作的。

可用的语言代码：

*   动作脚本3
*   重击
*   clojure
*   冷融合
*   cpp
*   夏普
*   css
*   德尔福
*   二郎
*   锐化
*   差异
*   时髦的
*   html
*   javascript
*   爪哇
*   javafx
*   matlab（仅关键字）
*   对象
*   perl
*   php
*   文本
*   电源外壳
*   Python
*   r
*   红宝石
*   斯卡拉
*   sql
*   VB
*   xml

希望有帮助。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2012-03-28T10:38:44.420

您也可以使用**[hilite.me](http://hilite.me)**。它不需要安装插件或 JS/CSS 文件。它也是开源的并且有一个 API。

*免责声明：我是开发人员。*

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2015-03-07T10:14:30.470

[Crayon Syntax Highlighter](https://wordpress.org/plugins/crayon-syntax-highlighter/)是一款出色的免费插件。我选择了那个，但我遇到了许多其他可能达到目的的：

*   [语法荧光笔进化](https://wordpress.org/plugins/syntaxhighlighter/screenshots/)
*   [语法荧光笔 MT](https://wordpress.org/plugins/syntax-highlighter-mt/)
*   [WP Prism 语法荧光笔](https://wordpress.org/plugins/wp-prism-syntax-highlighter/)
*   [启蒙者](https://wordpress.org/plugins/enlighter/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-17T09:13:06.347

您可以使用一个 <code> html 元素。否则，您可以尝试[Textile](http://hobix.com/textile/)或[Markdown](http://daringfireball.net/projects/markdown/syntax)语法（我不确定 WordPress.com 是否使用它们）。试一试并使用 WordPress 中的预览功能，看看你什么时候做对了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-10-16T20:14:37.507

用我的 Wordpress。**org**安装，我无法在[这里](http://en.support.wordpress.com/code/posting-source-code/)得到接受的答案（*不确定这是否只适用于 Wordpress.com **？**）* ...

我最终改用了[SyntaxHighlighter](https://wordpress.org/plugins/syntaxhighlighter/)插件。

[使用该插件，首先，您的代码将在“预览更改”视图中出现转义：它会在发布后正确显示](https://wordpress.stackexchange.com/a/7497/78162)。我*认为*此后发布它将正确显示在“预览更改”中（不是 100% 的）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-30T19:15:21.113

如果您在 WP.com 上托管自己的 wordpress 博客，则可以通过安装此插件来获得此功能，因为它与 WP.com 代码所依赖的插件相同。

[http://wordpress.org/extend/plugins/google-syntax-highlighter/](http://wordpress.org/extend/plugins/google-syntax-highlighter/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-19T14:55:43.367

您还可以使用我编写的名为 BlogTrog CodeWindow 的新 Web 应用程序——它由 Actipro CodeHighlighter 提供支持。

[http://www.blogtrog.com](http://www.blogtrog.com)

它是免费的，应该适用于所有现代浏览器，并且不需要您在任何地方安装任何东西。只需粘贴您的代码并嵌入结果。

# networking - 将 Quagga 与 XORP 进行比较

> ID：81344
> 
> 赞同：1
> 
> 时间：2008-09-17T09:09:29.583
> 
> 标签：networking, routing, bgp, ospf

与作为动态软件路由引擎的 XORP 相比，您如何看待[Quagga ？](http://quagga.net)相对而言，每种发动机的技术优势是什么？此外，从编程的角度来看，大多数人如何看待它们。谁使用这些工程师操纵了网络？我从 OSPF、路由、​​BGP 协议用户的角度想知道。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-05-14T08:28:09.463

以下内容并未完全回答您的问题，但 Vyatta 开源路由器和 Amazon VPC 的 OpenSolaris 客户网关软件都使用 quagga 来实现 BGP 支持。

从[XORP 的维基百科条目中](http://en.wikipedia.org/wiki/XORP)，

> “该软件套件在其早期版本中被商业选为 Vyatta 系列产品的路由平台，但后来被 quagga 取代。

* * *

## 回答 #2

> 赞同：-4
> 
> 时间：2008-11-07T00:59:15.437

> 与作为动态软件路由引擎的 XORP 相比，您如何看待 Quagga？

它是众多选项之一，但根据您在此处发布的问题/信息，对您来说并不是特别有用。您是否尝试过寻找一些替代方案，例如（没有想到）？

> 相对而言，每种发动机的技术优势是什么？

小，快，奇怪的放置，优化，超级英雄和更多的简历填充。

> 此外，从编程的角度来看，大多数人如何看待它们。

我不能代表大多数人说话，但我自己并没有给它太多的荣誉或优点，或者……你知道我的意思。

> 谁使用这些工程师操纵了网络？

我找不到具体的参考资料，但我记得读过迪斯尼和“著名的”南非 YUV 公司以前都使用过这个概念。我相信随着迈克尔·艾斯纳的倒台，迪斯尼放弃了它。

> 我从 OSPF、路由、​​BGP 协议用户的角度想知道。

我是一个BGP协议用户的准。希望我们能很快听到 OSPF 和路由用户的观点。

好问题。

# java - 在 Java 中增加 Map 值的最有效方法

> ID：81346
> 
> 赞同：460
> 
> 时间：2008-09-17T09:10:11.843
> 
> 标签：java, optimization, collections

我希望这个问题对于这个论坛来说不是太基本，但我们会看到。我想知道如何重构一些代码以获得更好的性能，这些代码正在运行很多次。

假设我正在使用 Map（可能是 HashMap）创建一个词频列表，其中每个键都是一个字符串，其中包含正在计算的单词，值是一个整数，每次找到单词的标记时都会递增。

在 Perl 中，增加这样一个值非常容易：

```
$map{$word}++; 
```

但是在Java中，它要复杂得多。这是我目前正在这样做的方式：

```
int count = map.containsKey(word) ? map.get(word) : 0;
map.put(word, count + 1); 
```

这当然依赖于较新 Java 版本中的自动装箱功能。我想知道您是否可以提出一种更有效的方法来增加这样的值。避免使用 Collections 框架并改用其他东西是否有很好的性能原因？

更新：我已经对几个答案进行了测试。见下文。

* * *

## 回答 #1

> 赞同：415
> 
> 时间：2008-09-20T11:59:00.267

## 部分测试结果

对于这个问题，我已经得到了很多很好的答案——谢谢大家——所以我决定进行一些测试并找出哪种方法实际上最快。我测试的五种方法是：

*   [我在问题](https://stackoverflow.com/questions/81346/most-efficient-way-to-increment-a-map-value-in-java)中提出的“ContainsKey”方法
*   Aleksandar Dimitrov 建议的“TestForNull”方法
*   Hank Gay 提出的“AtomicLong”方法
*   jrudolph 建议的“Trove”方法
*   phax.myopenid.com 建议的“MutableInt”方法

## 方法

这就是我所做的......

1.  创建了五个相同的类，除了下面显示的差异。每个类都必须执行我提出的场景的典型操作：打开一个 10MB 的文件并读入它，然后对文件中的所有单词标记执行频率计数。由于这平均只需要 3 秒，我让它执行频率计数（不是 I/O）10 次。
2.  对 10 次迭代的循环而*不是 I/O 操作进行计时，并基本上使用*[Ian Darwin 在 Java Cookbook 中的方法](http://books.google.com/books?id=t85jM-ZwTX0C&printsec=frontcover&dq=java+cookbook&sig=ACfU3U1lAe1vnbVUwdIcWeTpaxZi1xVUXQ#PPA734,M1)记录所花费的总时间（以时钟秒为单位）。
3.  连续执行了所有五项测试，然后又执行了三遍。
4.  平均每种方法的四个结果。

## 结果

我将首先为感兴趣的人展示结果和下面的代码。

正如预期的那样， **ContainsKey**方法是最慢的，因此我将给出每种方法的速度与该方法的速度的比较。

*   **ContainsKey：** 30.654 秒（基线）
*   **AtomicLong：** 29.780 秒（快 1.03 倍）
*   **TestForNull：** 28.804 秒（快 1.06 倍）
*   **Trove：** 26.313 秒（快 1.16 倍）
*   **MutableInt：** 25.747 秒（快 1.19 倍）

## 结论

似乎只有 MutableInt 方法和 Trove 方法明显更快，因为只有它们提供了超过 10% 的性能提升。但是，如果线程是一个问题，AtomicLong 可能比其他的更有吸引力（我不太确定）。我还使用变量运行了 TestForNull `final`，但差异可以忽略不计。

请注意，我没有分析不同场景中的内存使用情况。我很高兴听到任何对 MutableInt 和 Trove 方法可能如何影响内存使用有深入了解的人的来信。

就个人而言，我发现 MutableInt 方法最有吸引力，因为它不需要加载任何第三方类。因此，除非我发现它有问题，否则这是我最有可能采用的方式。

## 编码

这是每种方法的关键代码。

### 包含密钥

```
import java.util.HashMap;
import java.util.Map;
...
Map<String, Integer> freq = new HashMap<String, Integer>();
...
int count = freq.containsKey(word) ? freq.get(word) : 0;
freq.put(word, count + 1); 
```

### 空测试

```
import java.util.HashMap;
import java.util.Map;
...
Map<String, Integer> freq = new HashMap<String, Integer>();
...
Integer count = freq.get(word);
if (count == null) {
    freq.put(word, 1);
}
else {
    freq.put(word, count + 1);
} 
```

### 原子长

```
import java.util.concurrent.ConcurrentHashMap;
import java.util.concurrent.ConcurrentMap;
import java.util.concurrent.atomic.AtomicLong;
...
final ConcurrentMap<String, AtomicLong> map = 
    new ConcurrentHashMap<String, AtomicLong>();
...
map.putIfAbsent(word, new AtomicLong(0));
map.get(word).incrementAndGet(); 
```

### 特罗夫

```
import gnu.trove.TObjectIntHashMap;
...
TObjectIntHashMap<String> freq = new TObjectIntHashMap<String>();
...
freq.adjustOrPutValue(word, 1, 1); 
```

### 可变整数

```
import java.util.HashMap;
import java.util.Map;
...
class MutableInt {
  int value = 1; // note that we start at 1 since we're counting
  public void increment () { ++value;      }
  public int  get ()       { return value; }
}
...
Map<String, MutableInt> freq = new HashMap<String, MutableInt>();
...
MutableInt count = freq.get(word);
if (count == null) {
    freq.put(word, new MutableInt());
}
else {
    count.increment();
} 
```

* * *

## 回答 #2

> 赞同：407
> 
> 时间：2017-03-07T12:49:26.337

现在，Java 8 有一种更短的方法，使用[`Map::merge`](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Map.html#merge(K,V,java.util.function.BiFunction)).

```
myMap.merge(key, 1, Integer::sum) 
```

它能做什么：

*   如果*键*不存在，则将*1*作为值
*   否则将1与链接到*键的值**相加*

 *更多信息[在这里](https://docs.oracle.com/javase/8/docs/api/java/util/Map.html#merge-K-V-java.util.function.BiFunction-)。

* * *

## 回答 #3

> 赞同：48
> 
> 时间：2014-08-17T23:13:53.473

2016年的一点研究：[https](https://github.com/leventov/java-word-count) ://github.com/leventov/java-word-count ，[基准源码](https://github.com/leventov/java-word-count/blob/8a12a5ea4f53f01b9ee0e57f8aec70d75bc2030d/src/jmh/java/com/koloboke/wordcount/WordCount.java)

每种方法的最佳结果（越小越好）：

```
 time, ms
kolobokeCompile  18.8
koloboke         19.8
trove            20.8
fastutil         22.7
mutableInt       24.3
atomicInteger    25.3
eclipse          26.9
hashMap          28.0
hppc             33.6
hppcRt           36.5 
```

时间\空间结果： ![](https://i.stack.imgur.com/nR5yp.png)

* * *

## 回答 #4

> 赞同：40
> 
> 时间：2015-11-14T17:44:55.150

```
Map<String, Integer> map = new HashMap<>();
String key = "a random key";
int count = map.getOrDefault(key, 0); // ensure count will be one of 0,1,2,3,...
map.put(key, count + 1); 
```

这就是您使用简单代码增加值的方式。

益处：

*   无需添加新类或使用可变 int 的另一个概念
*   不依赖任何库
*   易于理解到底发生了什么（没有太多抽象）

缺点：

*   哈希映射将被搜索两次以获得 get() 和 put()。所以它不会是性能最高的代码。

理论上，一旦你调用 get()，你就已经知道 put() 应该放在哪里，所以你不必再次搜索。但是在哈希映射中搜索通常需要很短的时间，您可以忽略这个性能问题。

但是如果你对这个问题非常认真，你是一个完美主义者，另一种方法是使用合并方法，这（可能）比前面的代码片段更有效，因为你将（理论上）只搜索一次地图：（虽然这段代码乍一看并不明显，它简短而高效）

```
map.merge(key, 1, (a,b) -> a+b); 
```

建议：在大多数情况下，您应该关心代码的可读性而不是很少的性能提升。如果您更容易理解第一个代码片段，请使用它。但是，如果您能够理解第二个罚款，那么您也可以去做！

* * *

## 回答 #5

> 赞同：38
> 
> 时间：2008-09-17T09:40:23.190

作为我自己评论的后续行动：Trove 看起来像是要走的路。如果出于某种原因，您想坚持使用标准 JDK，[ConcurrentMap](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ConcurrentMap.html)和[AtomicLong](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/atomic/AtomicLong.html)可以使代码更好一点，尽管 YMMV *。*

```
 final ConcurrentMap<String, AtomicLong> map = new ConcurrentHashMap<String, AtomicLong>();
    map.putIfAbsent("foo", new AtomicLong(0));
    map.get("foo").incrementAndGet(); 
```

将`1`作为地图中的值保留为`foo`。实际上，增加对线程的友好性是这种方法所推荐的全部。

* * *

## 回答 #6

> 赞同：37
> 
> 时间：2012-09-04T15:08:39.930

## 谷歌[番石榴](https://github.com/google/guava)是你的朋友...

...至少在某些情况下。他们有这个不错的[*AtomicLongMap*](http://google.github.io/guava/releases/21.0/api/docs/index.html?com/google/common/util/concurrent/AtomicLongMap.html)。特别好，因为您正在处理地图中的*long* as 值。

例如

```
AtomicLongMap<String> map = AtomicLongMap.create();
[...]
map.getAndIncrement(word); 
```

也可以将超过 1 的值添加到：

```
map.getAndAdd(word, 112L); 
```

* * *

## 回答 #7

> 赞同：28
> 
> 时间：2008-09-17T16:58:25.180

看看[Google 收藏库](http://code.google.com/p/google-collections/)中的这类东西总是一个好主意。在这种情况下，[Multiset](http://google-collections.googlecode.com/svn/trunk/javadoc/com/google/common/collect/Multiset.html)可以解决问题：

```
Multiset bag = Multisets.newHashMultiset();
String word = "foo";
bag.add(word);
bag.add(word);
System.out.println(bag.count(word)); // Prints 2 
```

有类似 Map 的方法用于迭代键/条目等。内部实现当前使用 a `HashMap<E, AtomicInteger>`，因此您不会产生装箱成本。

* * *

## 回答 #8

> 赞同：23
> 
> 时间：2008-09-17T10:20:32.283

您应该意识到您最初的尝试

```
int count = map.containsKey(word) ？地图.get（字）：0；
```

在地图上包含两个可能代价高昂的操作，即`containsKey`和`get`。前者执行的操作可能与后者非常相似，因此您要做*两次*相同的工作！

如果您查看 Map 的 API，`get`通常会`null`在地图不包含请求的元素时返回操作。

请注意，这将使解决方案像

```
map.put(key, map.get(key) + 1);
```

危险，因为它可能会产生`NullPointerException`s。你应该先检查一下`null`。

**另请注意**，这非常重要，`HashMap`s*可以*根据定义包含`nulls`。因此，并非每个返回的人`null`都说“没有这样的元素”。在这方面，`containsKey`行为*与*`get`实际告诉你*是否*存在这样的元素不同。有关详细信息，请参阅 API。

但是，对于您的情况，您可能不想区分存储的`null`和“noSuchElement”。如果您不想允许`null`s，您可能更喜欢`Hashtable`. 使用其他答案中已经提出的包装库可能是手动处理的更好解决方案，具体取决于应用程序的复杂性。

要完成答案（我一开始忘了把它放进去，多亏了编辑功能！），最好的原生方法是`get`进入一个`final`变量，检查`null`并`put`用`1`. 该变量应该是`final`因为它无论如何都是不可变的。编译器可能不需要这个提示，但这样会更清楚。

```
final HashMap map = generateRandomHashMap();
最终对象键 = fetchSomeKey();
最终整数 i = map.get(key);
如果（我！= null）{
    map.put(i + 1);
} 别的 {
    // 做点什么
}

```

如果你不想依赖自动装箱，你应该说类似的话`map.put(new Integer(1 + i.getValue()));`。

* * *

## 回答 #9

> 赞同：20
> 
> 时间：2008-09-17T09:47:03.020

另一种方法是创建一个可变整数：

```
class MutableInt {
  int value = 0;
  public void inc () { ++value; }
  public int get () { return value; }
}
...
Map<String,MutableInt> map = new HashMap<String,MutableInt> ();
MutableInt value = map.get (key);
if (value == null) {
  value = new MutableInt ();
  map.put (key, value);
} else {
  value.inc ();
} 
```

当然，这意味着创建一个额外的对象，但与创建一个整数（即使使用 Integer.valueOf）相比的开销不应该那么多。

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2016-05-25T14:21:13.393

您可以在**Java 8**提供的接口中使用[computeIfAbsent](https://docs.oracle.com/javase/8/docs/api/java/util/Map.html#computeIfAbsent-K-java.util.function.Function-)方法。`Map`

 **```
final Map<String,AtomicLong> map = new ConcurrentHashMap<>();
map.computeIfAbsent("A", k->new AtomicLong(0)).incrementAndGet();
map.computeIfAbsent("B", k->new AtomicLong(0)).incrementAndGet();
map.computeIfAbsent("A", k->new AtomicLong(0)).incrementAndGet(); //[A=2, B=1] 
```

该方法`computeIfAbsent`检查指定的键是否已与值关联？如果没有关联值，则它尝试使用给定的映射函数计算其值。在任何情况下，它都会返回与指定键关联的当前（现有或计算的）值，如果计算的值为 null，则返回 null。

附带说明一下，如果您遇到多个线程更新一个公共总和的情况，您可以查看[LongAdder](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/LongAdder.html)类。在高争用情况下，该类的预期吞吐量明显高于`AtomicLong`，但代价是更高的空间消耗。

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2019-03-25T15:33:42.373

很简单，使用内置函数`Map.java`如下

```
map.put(key, map.getOrDefault(key, 0) + 1); 
```

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2008-09-17T16:25:48.067

内存轮换在这里可能是一个问题，因为大于或等于 128 的 int 的每个装箱都会导致对象分配（请参阅 Integer.valueOf(int)）。尽管垃圾收集器非常有效地处理短期对象，但性能会受到一定程度的影响。

如果您知道增量的数量将大大超过键的数量（在这种情况下为=words），请考虑使用 int 持有者。Phax 已经为此提供了代码。又是这样，有两个变化（持有者类设为静态，初始值设置为 1）：

```
static class MutableInt {
  int value = 1;
  void inc() { ++value; }
  int get() { return value; }
}
...
Map<String,MutableInt> map = new HashMap<String,MutableInt>();
MutableInt value = map.get(key);
if (value == null) {
  value = new MutableInt();
  map.put(key, value);
} else {
  value.inc();
} 
```

如果您需要极高的性能，请寻找直接针对原始值类型量身定制的 Map 实现。jrudolph 提到了[GNU Trove](http://trove4j.sourceforge.net)。

顺便说一下，这个主题的一个很好的搜索词是“直方图”。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2008-09-17T10:14:32.360

与其调用 containsKey()，不如调用 map.get 并检查返回值是否为空，这样更快。

```
 Integer count = map.get(word);
    if(count == null){
        count = 0;
    }
    map.put(word, count + 1); 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2019-09-08T01:34:18.977

我建议使用 Java 8 Map::compute()。它也考虑密钥不存在的情况。

```
Map.compute(num, (k, v) -> (v == null) ? 1 : v + 1); 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2008-09-17T09:19:50.447

有几种方法：

1.  使用类似于 Google Collections 中包含的集合的 Bag 算法。

2.  创建可以在 Map 中使用的可变容器：

```
 class My{
        String word;
        int count;
    } 

```

并使用 put("word", new My("Word") ); 然后您可以检查它是否存在并在添加时增加。

避免使用列表滚动您自己的解决方案，因为如果您进行内循环搜索和排序，您的性能会很糟糕。第一个 HashMap 解决方案实际上非常快，但在 Google Collections 中找到的类似解决方案可能更好。

使用 Google Collections 计算单词，看起来像这样：

```
 HashMultiset s = new HashMultiset();
    s.add("word");
    s.add("word");
    System.out.println(""+s.count("word") ); 

```

使用 HashMultiset 非常优雅，因为袋算法正是您在计算单词时所需要的。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2008-09-17T12:12:33.870

你确定这是一个瓶颈吗？你做过性能分析吗？

尝试使用 NetBeans 分析器（它是免费的，内置于​​ NB 6.1）来查看热点。

最后，JVM 升级（比如从 1.5->1.6）通常是一种廉价的性能提升器。即使是内部版本号的升级也可以提供良好的性能提升。如果您在 Windows 上运行并且这是一个服务器类应用程序，请在命令行上使用 -server 来使用 Server Hotspot JVM。在 Linux 和 Solaris 机器上，这是自动检测的。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2010-11-26T09:20:32.870

Google Collections HashMultiset :
- 使用起来非常优雅
- 但会消耗 CPU 和内存

最好的方法是：（`Entry<K,V> getOrPut(K);` 优雅且低成本）

这样的方法将只计算一次哈希和索引，然后我们可以对条目做我们想做的事情（替换或更新值）。

更优雅：
- 采取`HashSet<Entry>`
- 扩展它，以便`get(K)`在需要时放置一个新条目
- 条目可以是您自己的对象。
-->`(new MyHashSet()).get(k).increment();`

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2012-07-02T03:29:28.813

MutableInt 方法的一种变体可能更快，如果有点破解的话，是使用单元素 int 数组：

```
Map<String,int[]> map = new HashMap<String,int[]>();
...
int[] value = map.get(key);
if (value == null) 
  map.put(key, new int[]{1} );
else
  ++value[0]; 
```

如果您可以使用此变体重新运行性能测试，那将会很有趣。这可能是最快的。

* * *

编辑：上述模式对我来说效果很好，但最终我改用 Trove 的集合来减少我正在创建的一些非常大的地图中的内存大小——而且它也更快。

一个非常好的特性是`TObjectIntHashMap`该类有一个`adjustOrPutValue`调用，取决于该键是否已经存在一个值，将放置一个初始值或增加现有值。这非常适合递增：

```
TObjectIntHashMap<String> map = new TObjectIntHashMap<String>();
...
map.adjustOrPutValue(key, 1, 1); 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2010-11-23T15:57:46.170

“put”需要“get”（确保没有重复键）。
所以直接做一个“put”，
如果有之前的值，再做一个加法：

```
Map map = new HashMap ();

MutableInt newValue = new MutableInt (1); // default = inc
MutableInt oldValue = map.put (key, newValue);
if (oldValue != null) {
  newValue.add(oldValue); // old + inc
} 
```

如果计数从 0 开始，则加 1：（或任何其他值...）

```
Map map = new HashMap ();

MutableInt newValue = new MutableInt (0); // default
MutableInt oldValue = map.put (key, newValue);
if (oldValue != null) {
  newValue.setValue(oldValue + 1); // old + inc
} 
```

*注意：*此代码不是线程安全的。使用它来构建然后使用地图，而不是同时更新它。

*优化：*在一个循环中，保持旧值成为下一个循环的新值。

```
Map map = new HashMap ();
final int defaut = 0;
final int inc = 1;

MutableInt oldValue = new MutableInt (default);
while(true) {
  MutableInt newValue = oldValue;

  oldValue = map.put (key, newValue); // insert or...
  if (oldValue != null) {
    newValue.setValue(oldValue + inc); // ...update

    oldValue.setValue(default); // reuse
  } else
    oldValue = new MutableInt (default); // renew
  }
} 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-09-17T09:17:37.363

例如，各种原始包装器`Integer`是不可变的，因此实际上没有更简洁的方法来完成您所要求的操作*，除非*您可以使用[AtomicLong](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/atomic/AtomicLong.html)之类的东西来完成。我可以在一分钟内试一试并更新。顺便说一句，[Hashtable](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Hashtable.html) *是*[Collections Framework](http://java.sun.com/j2se/1.5.0/docs/guide/collections/index.html)的一部分。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2008-09-17T10:21:19.690

我将使用 Apache Collections Lazy Map（将值初始化为 0）并使用来自 Apache Lang 的 MutableIntegers 作为该映射中的值。

最大的成本是必须在您的方法中搜索两次地图。在我的情况下，您只需执行一次。只需获取值（如果不存在，它将被初始化）并增加它。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2009-05-12T22:18:35.850

[函数式 Java](http://code.google.com/p/functionaljava)库的数据结构在最新的主干头中`TreeMap`有一个方法：`update`

```
public TreeMap<K, V> update(final K k, final F<V, V> f) 
```

示例用法：

```
import static fj.data.TreeMap.empty;
import static fj.function.Integers.add;
import static fj.pre.Ord.stringOrd;
import fj.data.TreeMap;

public class TreeMap_Update
  {public static void main(String[] a)
    {TreeMap<String, Integer> map = empty(stringOrd);
     map = map.set("foo", 1);
     map = map.update("foo", add.f(1));
     System.out.println(map.get("foo").some());}} 
```

该程序打印“2”。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2013-09-13T18:03:56.763

如果您使用的是[Eclipse Collections](http://www.eclipse.org/collections/)，您可以使用`HashBag`. 就内存使用而言，这将是最有效的方法，并且在执行速度方面也将表现良好。

`HashBag`由`MutableObjectIntMap`存储原始整数而不是`Counter`对象的 a 支持。这减少了内存开销并提高了执行速度。

`HashBag`提供您需要的 API，因为它还`Collection`允许您查询项目的出现次数。

[这是Eclipse Collections Kata](https://github.com/eclipse/eclipse-collections-kata)中的一个示例。

```
MutableBag<String> bag =
  HashBag.newBagWith("one", "two", "two", "three", "three", "three");

Assert.assertEquals(3, bag.occurrencesOf("three"));

bag.add("one");
Assert.assertEquals(2, bag.occurrencesOf("one"));

bag.addOccurrences("one", 4);
Assert.assertEquals(6, bag.occurrencesOf("one")); 
```

**注意：**我是 Eclipse Collections 的提交者。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2016-05-18T10:00:23.000

我不知道它的效率如何，但下面的代码也可以。您需要`BiFunction`在开始时定义 a 。另外，您可以使用此方法进行更多操作。

```
public static Map<String, Integer> strInt = new HashMap<String, Integer>();

public static void main(String[] args) {
    BiFunction<Integer, Integer, Integer> bi = (x,y) -> {
        if(x == null)
            return y;
        return x+y;
    };
    strInt.put("abc", 0);

    strInt.merge("abc", 1, bi);
    strInt.merge("abc", 1, bi);
    strInt.merge("abc", 1, bi);
    strInt.merge("abcd", 1, bi);

    System.out.println(strInt.get("abc"));
    System.out.println(strInt.get("abcd"));
} 
```

输出是

```
3
1 
```

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2021-06-28T07:48:45.517

使用流和 计数`getOrDefault`：

```
String s = "abcdeff";
s.chars().mapToObj(c -> (char) c)
 .forEach(c -> {
     int count = countMap.getOrDefault(c, 0) + 1;
     countMap.put(c, count);
  }); 
```

* * *

## 回答 #26

> 赞同：-3
> 
> 时间：2018-02-10T00:16:27.983

由于很多人在 Java 主题中搜索 Groovy 的答案，因此您可以在 Groovy 中执行以下操作：

```
dev map = new HashMap<String, Integer>()
map.put("key1", 3)

map.merge("key1", 1) {a, b -> a + b}
map.merge("key2", 1) {a, b -> a + b} 
```

* * *

## 回答 #27

> 赞同：-3
> 
> 时间：2019-02-03T20:25:41.017

希望我能正确理解你的问题，我是从 Python 来到 Java 的，所以我可以理解你的挣扎。

如果你有

```
map.put(key, 1) 
```

你会做的

```
map.put(key, map.get(key) + 1) 
```

希望这可以帮助！

* * *

## 回答 #28

> 赞同：-3
> 
> 时间：2019-06-22T04:36:14.473

java 8中简单易行的方法如下：

```
final ConcurrentMap<String, AtomicLong> map = new ConcurrentHashMap<String, AtomicLong>();
    map.computeIfAbsent("foo", key -> new AtomicLong(0)).incrementAndGet(); 
```

# c# - 在 IIS 中允许匿名访问的同时在 asp.net 中获取 Windows/域凭据

> ID：81347
> 
> 赞同：5
> 
> 时间：2008-09-17T09:10:15.040
> 
> 标签：c#, asp.net, iis, single-sign-on

我有一个在我们的数据中心运行的 asp.NET Web 应用程序，我们希望客户在其中使用单点登录进行登录。如果我们可以使用 IIS 集成安全性，这将非常容易。然而我们不能这样做。我们不信任客户的域控制器。并且我们希望网站可用于一般互联网。只有当人们从客户端网络内连接时，他们才应该自动登录。

我们拥有的是域帐户列表和一种通过 LDAP 在 asp.net 代码中查询 DC 的方法。当 IIS 中允许匿名访问时，IIS 从不向浏览器询问凭据。因此我们的应用程序永远不会获得用户凭据。

有没有办法强制浏览器在 IIS 接受匿名请求的情况下发送凭据（从而能够使用单点登录）。

**更新：**

我尝试自己发送 401：未授权的 www-authenticate：NTLM 标头。接下来发生的事情（正如 Fiddler 告诉我的）是 IIS 完全控制并处理完整的请求链。正如我从各种来源了解到的那样，IIS 采用用户名，将质询发送回浏览器。浏览器返回加密响应，并且 IIS 连接到域控制器以使用此响应对用户进行身份验证。

但是，在我的场景中，IIS 与客户端位于不同的 Windows 域中，并且无法对用户进行身份验证。出于这个原因，建立一个启用了 Windows 身份验证的单独站点也不会奏效。

现在我必须留下我正在研究的选项：

1.  在我们的托管域和客户域之间创建域信任（我们的 IT 部门对此不满意）
2.  使用 NTML 代理将 IIS 身份验证请求转发到客户端域控制器（我们有一个 VPN 连接可用于通过 LDAP 连接）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T22:43:14.417

您要求的是混合模式身份验证。我最近使用了[Paul Glavich 的两个入口点机制](http://www.15seconds.com/issue/050203.htm)，它运行良好。我想这是解决这个问题的最优雅的解决方案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T09:25:51.370

不确定您是否可以轻松地使其正常工作。与基本的 401 挑战发生在用户请求的带内 - 这样凭据出现在标头中，NTLM 握手在单独的端口上完成 - 然后由非托管代码强制进入线程上下文。

您尝试在 VS2008（或反射器）中拆开 ASP.NET NTLM 模块，看看它是如何提取凭据的？

不是一个真正的答案 - 对不起......

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-09-17T15:48:08.003

[此解决方案](http://www.pluralsight.com/community/blogs/craig/archive/2006/06/19/28435.aspx)是关于表单身份验证的，但它详细说明了 401 问题。

> 解决方案是简单地将处理程序附加到应用程序的 EndRequest 事件，方法是将以下内容放入 Global.asax：

```
protected void Application_EndRequest(object sender, EventArgs e) {
    if (Context.Items["Send401"] != null)
    {
         Response.StatusCode = 401;
         Response.StatusDescription = "Unauthorized";
    } } 
```

> 然后，为了触发这个代码，你所要做的就是放一个

```
Context.Items["Send401"] = true; 
```

编辑：
我已使用此方法启用匿名和集成来获取用户的域凭据。我不确定它是否适用于你的情况，但我认为我值得一试。

# networking - 私有 IP 地址范围

> ID：81350
> 
> 赞同：11
> 
> 时间：2008-09-17T09:10:58.410
> 
> 标签：networking, ip-address

什么是私有 IP 地址范围？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-17T09:12:46.610

您将在[RFC 1918](http://www.faqs.org/rfcs/rfc1918.html)中找到答案。不过，我在下面为您列出了它们。

```
 10.0.0.0        -   10.255.255.255  (10/8 prefix)
 172.16.0.0      -   172.31.255.255  (172.16/12 prefix)
 192.168.0.0     -   192.168.255.255 (192.168/16 prefix) 
```

169.254.0.0/16 是私有 IP 地址块是一个常见的误解。这不是真的。它是本地链接，基本上它只能在网络中使用，但它不是官方的 RFC1918。有关 IPv4 地址的其他信息可以在[RFC 3300](http://www.faqs.org/rfcs/rfc3300.html)中找到。

另一方面，IPv6 没有等同于 RFC1918，但任何类型的站点本地工作都应该在 fc00::/7 中完成。这在 [RFC 4193](http://www.faqs.org/rfcs/rfc4193.html)中进一步涉及。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-17T09:13:56.280

此外，169.254.0.0 - 169.254.255.255 保留用于自动专用 IP 寻址。参考[链接本地地址维基百科文章](http://en.wikipedia.org/wiki/Link-local_address)

# asp.net - 如何从 TableAdapter 中检索存储过程的返回值

> ID：81360
> 
> 赞同：7
> 
> 时间：2008-09-17T09:12:13.710
> 
> 标签：asp.net, sql-server

使用 TableAdapters 时，我找不到从存储过程中获取返回值的优雅方法。

使用非标量存储过程调用时，TableAdapter 似乎不支持 SQL 存储过程返回值。您希望自动生成函数的返回值是存储过程的返回值，但事实并非如此（它实际上是受影响的行数）。尽管可以使用“out”参数并将变量作为 ref 传递给自动生成的函数，但这不是一个非常干净的解决方案。

我在网上看到了一些丑陋的黑客来解决这个问题，但没有像样的解决方案。任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-02T15:17:53.387

[http://blogs.msdn.com/smartclientdata/archive/2006/08/09/693113.aspx](http://blogs.msdn.com/smartclientdata/archive/2006/08/09/693113.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T10:53:28.007

获取返回值的方法是在其 Direction 设置为 ParameterDirection.ReturnValue 的 SqlCommand 对象上使用 SqlParameter。您应该在调用 Fill 后检查 TableAdapter 的 SelectCommand 属性。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T17:42:38.947

*注意*：要走的路是使用 SqlParameter 其中 Direction = ParameterDirection.ReturnValue

话虽如此，正如有人已经提到过 SqlParameters，这里是一个使用 DataSet 的动态方法替代。（如果你是这样骑的）：

示例 SQL 语句和 C# 作为休闲方式：

```
string sql = @"DECLARE @ret int 
            EXEC @ret = SP_DoStuff 'parm1', 'parm2'
            SELECT @ret as ret";

DataSet ds = GetDatasetFromSQL(sql); //your sql to dataset code here...

int resultCode = -1;
int.TryParse(ds.Tables[ds.Tables.Count-1].Rows[0][0].ToString(), out resultCode); 
```

存储过程结果被加载到 DataSet 中，并且在存储过程中将具有与返回 select 语句一样多的 DataTable。

DataSet 中的最后一个 DataTable 将有 1 行和 1 列，其中包含存储过程的返回值。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T03:33:39.580

我不能肯定地说，因为我没有使用 TableAdapters，但您可能需要查看您的存储过程并在您的过程周围包含以下内容。

```
SET ROWCOUNT OFF

BEGIN
<Procedure Content>
END

SET ROWCOUNT ON 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-26T15:14:00.820

关闭这个问题，因为它似乎不支持返回值并且没有优雅的解决方法！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-06-10T01:52:11.857

实际上，您需要做的就是使用 SELECT 语句而不是 RETURN 语句从存储过程中返回最终值。SELECT 的结果将是返回值。例如，如果您只是让您的 sp 退出语句“SELECT 1”，那么您将返回一个 1。现在只需选择您想要返回的实际标量。

# svn - 如何在 SVN 中设置访问控制？

> ID：81361
> 
> 赞同：85
> 
> 时间：2008-09-17T09:12:16.923
> 
> 标签：svn, authorization, svn-administraton

我已经使用 SVN 建立了一个存储库并上传了项目。有多个用户在从事这些项目。但是，并不是每个人都需要访问所有项目。我想为每个项目设置用户权限。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2008-09-17T09:29:50.300

在您的**svn\repos\YourRepo\conf**文件夹中，您会找到两个文件，**authz**和**passwd**。这是您需要调整的两个。

在**passwd**文件中，您需要添加一些用户名和密码。我假设您已经这样做了，因为您有人使用它：

```
[users]
User1=password1
User2=password2 
```

然后你想用**authz**文件相应地分配权限：

创建您想要的概念组，并向其中添加人员：

```
[groups]
allaccess = user1
someaccess = user2 
```

然后从权限和项目级别选择他们拥有的访问权限。

所以让我们给我们的“所有访问权限”的人从根目录所有访问权限：

```
[/]
@allaccess = rw 
```

但只给我们的“一些访问权限”的人只读访问一些较低级别的项目：

```
[/someproject]
@someaccess = r 
```

您还将在**authz**和**passwd**文件中找到一些简单的文档。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-09-17T13:49:16.913

@斯蒂芬·贝利

要完成您的回答，您还可以通过存储库中的纯文本文件将用户权限委派给项目经理。

为此，您使用`authz`包含以下内容的默认文件设置 SVN 数据库：

```
###########################################################################
# The content of this file always precedes the content of the
# $REPOS/admin/acl_descriptions.txt file.
# It describes the immutable permissions on main folders.
###########################################################################
[groups]
svnadmins = xxx,yyy,....

[/]
@svnadmins = rw
* = r
[/admin]
@svnadmins = rw
@projadmins = r
* =

[/admin/acl_descriptions.txt]
@projadmins = rw 
```

此默认`authz`文件授权 SVN 管理员修改 SVN 存储库中的可见纯文本文件，称为**'/admin/acl_descriptions.txt'**，SVN 管理员或项目经理将在其中修改和注册用户。

然后你设置一个预提交钩子，它将检测修订是否由该文件（并且仅该文件）组成。

如果是，这个钩子的脚本将验证你的纯文本文件的内容，并检查每一行是否符合 SVN 语法。

然后一个 post-commit 钩子将使用以下**连接**`\conf\authz`更新文件：

 ***   上面显示的 TEMPLATE`authz`文件
*   纯文本文件`/admin/acl_descriptions.txt`

第一次迭代由 SVN 管理员完成，他补充说：

```
[groups]
projadmins = zzzz 
```

他提交了他的修改，并更新了`authz`文件。

然后项目经理“zzzz”可以添加、删除或声明任何用户组和他想要的任何用户。他提交文件并`authz`更新文件。

**这样，SVN 管理员不必单独管理所有 SVN 存储库的任何和所有用户**。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2009-11-25T00:43:10.080

一个让我大吃一惊的问题：

```
[repos:/path/to/dir/] # this won't work 
```

但

```
[repos:/path/to/dir]  # this is right 
```

您不需要在目录中包含尾部斜杠，否则您将看到 403 用于 OPTIONS 请求。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-17T10:12:45.907

您可以使用 svn+ssh:，然后它基于对给定位置的存储库的访问控制。

这就是我在我的大学托管项目组存储库的方式，在那里我无法设置其他任何东西。只需拥有该组拥有的目录，并在其中运行 svn-admin （或其他任何东西）就意味着我不需要进行任何配置。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-17T09:31:25.023

尽管我建议 Apache 方法更好，但 SVN Serve 工作正常且非常简单。

假设您的存储库名为“my_repo”，它存储在 C:\svn_repos 中：

1.  在“C:\svn_repos\my_repo\conf”中创建一个名为“passwd”的文件。该文件应如下所示：

    ```
    [Users]
    username = password
    john = johns_password
    steve = steves_password 
    ```

2.  在 C:\svn_repos\my_repo\conf\svnserve.conf 设置：

    ```
    [general]
    password-db = passwd
    auth-access=read
    auth-access=write 
    ```

这将强制用户登录以读取或写入此存储库。

对每个存储库执行这些步骤，仅在`passwd`每个存储库的文件中包括适当的用户。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-17T09:17:01.530

最好的方法是设置 Apache 并通过它设置访问权限。查看[svn 书籍](http://svnbook.red-bean.com/)寻求帮助。如果你不想使用 Apache，你也可以使用 svnserve 进行简单的访问控制。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-04-29T21:21:41.523

Apache Subversion 支持[基于路径的授权](https://www.visualsvn.com/support/svnbook/serverconfig/pathbasedauthz/)，可帮助您为存储库（文件或目录）中的路径上的用户和组帐户配置细粒度权限。基于路径的授权支持三种访问级别 - 无访问、只读和读/写。

基于路径的授权权限使用特殊语法存储在每个存储库或每个服务器的授权文件中。这是一个来自 SVNBook 的示例：

```
[calc:/branches/calc/bug-142]
harry = rw
sally = r 
```

当您需要具有许多路径和帐户的复杂权限结构时，您可以从 VisualSVN Server 提供的基于 GUI 的权限管理工具中受益：

*   服务器管理员可以通过 VisualSVN 服务器管理器控制台或 PowerShell 管理用户和组权限，
*   非管理员用户可以通过 RepoCfg 管理权限。

*VisualSVN 服务器管理器中的存储库权限* [![在此处输入图像描述](https://i.stack.imgur.com/XjoMn.png)](https://i.stack.imgur.com/XjoMn.png)

*PowerShell 中的存储库权限* [![在此处输入图像描述](https://i.stack.imgur.com/4DeLR.png)](https://i.stack.imgur.com/4DeLR.png)

*非管理员用户可以通过 RepoCfg 工具管理权限* [![在此处输入图像描述](https://i.stack.imgur.com/RHPLJ.png)](https://i.stack.imgur.com/RHPLJ.png)

# outlook - 将 Outlook 2007 连接到 Domino 6.5？

> ID：81362
> 
> 赞同：0
> 
> 时间：2008-09-17T09:12:22.167
> 
> 标签：outlook, lotus-notes

Outlook（现在是 2007 年）是我最喜欢的邮件客户端，我想继续将它用于私人和工作电子邮件。但是在我的新工作中，我（惊恐地）发现我们必须使用 Lotus Domino 和 Lotus Notes 6.5 作为客户端。

是否可以在 Outlook 中获取我的 Lotus 邮件，同时将我的私人 POP 邮件保留在其现有的 PST 中？

这是配置：

*   Lotus Domino 服务器版本为 6.5
*   Outlook 2007（已完全修补），其中包含为处理私人 POP 邮件帐户而创建的 pst 文件。
*   适用于 IBM Lotus Domino 的 MS Office Outlook 连接器 v2.0.4007.0

编辑：当然，我尝试使用工具 ==> 帐户设置 ==> 新建 ==> 其他 ==> Lotus Notes 邮件直接添加帐户，退出 Outlook 并重新打开它。然后我收到以下错误：

> 无法打开该组文件夹。发生了意外错误。MAPI 无法加载信息服务 nwnsp.dll。确保服务已正确安装和配置。

（这也是我对 StackOverflow 的第一个问题，所以这是我测试该站点返回的方法。）

编辑 1/07/2009：当我发现 POP/SMTP 端口已打开时，我决定使用这种方法来检索和发送电子邮件，充分意识到这些方法的缺点，但至少我现在正在使用Outlook 作为客户端。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-04T03:54:08.503

最好的方法是使用 Domino Access Manager for Outlook。

IBM 红皮书在此处提供了所有详细信息：

[http://www.redbooks.ibm.com/abstracts/sg246754.html](http://www.redbooks.ibm.com/abstracts/sg246754.html)

摘要：

这本 IBM 红皮书讨论了 IBM Lotus® Domino® Access for Microsoft® Outlook，该软件解决方案允许 Outlook 客户端用户轻松访问存储在 Lotus Domino 服务器上的邮件和日历数据。

如果您想提高消息传递基础架构的可靠性和可扩展性并增加协作，从 Microsoft Exchange 升级到 IBM Lotus Domino Access for Microsoft Outlook (DAMO) 提供了解决方案。使用 DAMO，您可以向 Microsoft Outlook 用户提供可靠、可扩展和安全的 Lotus Domino 消息传递，而无需用户从 Outlook 客户端进行更改——用户只需在 Lotus Domino 而不是 Microsoft Exchange 上处理邮件、日历和任务数据。支持熟悉的 Microsoft Outlook 功能，包括富文本、文件夹和目录目录。Lotus Domino Access for Microsoft Outlook 还为 Microsoft Outlook 用户提供了 Domino Messaging 功能的额外好处，包括对其邮箱的全文搜索功能和对 Internet 标准（SMTP/MIME 和 HTML）的本机支持。

# c# - 我应该开始使用 LINQ To SQL 吗？

> ID：81376
> 
> 赞同：8
> 
> 时间：2008-09-17T09:13:59.870
> 
> 标签：c#, linq, linq-to-sql, .nettiers

目前我正在使用 NetTiers 来生成我的数据访问层和服务层。我使用 NetTiers 已有 2 年多了，发现它非常有用。在某些时候，我需要查看 LINQ，所以我的问题是......

1.  有其他人从 NetTiers 转到 LINQ To SQL 吗？
2.  这种转变是好事还是坏事？
3.  有什么我应该注意的吗？
4.  你会推荐这个开关吗？

基本上我会欢迎任何想法。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-08T22:12:05.080

1.  不
2.  见#1
3.  您应该注意标准抽象开销。它也是基于当前状态的非常 SQL Server。
4.  您是否使用 SQL Server，那么也许。如果您现在正在将 LINQ 用于其他事情，例如 XML 数据（很好）、对象数据、数据集，那么是的，您应该可以切换为所有这些都使用统一的数据语法。就像[lagerdalek](https://stackoverflow.com/questions/81376/should-i-start-using-linq-to-sql#81422)提到的，如果它没有坏，请不要修复它。通过快速浏览 .netTiers 应用程序框架，我想说如果您已经对该解决方案进行了投资，它似乎给您提供的不仅仅是一个简单的数据访问层，您应该坚持使用它。

根据我的经验，LINQ to SQL 对于中小型项目来说是一个很好的解决方案。这是一个 ORM，它是提高生产力的好方法。它还***应该***为您提供另一层抽象，允许您将下面的层更改为其他内容。Visual Studio 中的设计器（我也相信 VS Express）非常简单易用。它为您提供对象映射的通用拖放和基于属性的编辑。

@ [Jason Jackson](https://stackoverflow.com/questions/81376/should-i-start-using-linq-to-sql#154525) - 设计器确实允许您手动添加属性，但是您需要指定该属性的属性，但是您这样做一次，它可能比最初将表格拖入设计器要长 3 分钟，但是它每次更改数据库本身只需要一次。这与其他 ORM 并没有太大的不同，但是您是正确的，它们可以使这变得更容易，并且只找到那些已更改的属性，甚至为此类需求实施某种重构工具。

资源：

*   [为什么使用 LINQ to SQL？](http://dotnet.org.za/hiltong/archive/2008/02/01/why-use-linq-to-sql-part-1-performance-considerations.aspx)
*   [Scott Guthrie 谈 LINQ to SQL](http://weblogs.asp.net/scottgu/archive/2007/09/07/linq-to-sql-part-9-using-a-custom-linq-expression-with-the-lt-asp-linqdatasource-gt-control.aspx)
*   [提高 LINQ to SQL 应用程序性能的 10 个技巧](http://www.sidarok.com/web/blog/content/2008/05/02/10-tips-to-improve-your-linq-to-sql-application-performance.html)
*   [LINQ To SQL 和 Visual Studio 2008 性能更新](http://www.davidhayden.com/blog/dave/archive/2007/09/28/LINQToSQLVisualStudio2008PerformanceUpdate.aspx)
*   [性能比较 LINQ to SQL / ADO / C#](http://www.codeproject.com/KB/linq/performance_comparisons.aspx)
*   [LINQ to SQL 5 分钟概述](http://www.hookedonlinq.com/LINQtoSQL5MinuteOverview.ashx)

请注意，正在开发[Parallel LINQ](http://msdn.microsoft.com/en-us/magazine/cc163329.aspx)以在多核机器上实现更高的性能。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T19:18:54.950

我尝试在一个小项目上使用 Linq to SQL，认为我想要一些可以快速生成的东西。我在设计师中遇到了很多问题。例如，每当您需要向表中添加列时，您基本上必须在设计器中删除并重新添加表定义。如果您在表格上设置了任何属性，那么您必须重新设置这些属性。对我来说，这确实减慢了开发过程。

LINQ to SQL 本身很好。我真的很喜欢可扩展性。如果他们可以改进设计师，我可能会再试一次。我认为该框架将受益于针对 Web 开发等断开连接模型的更多功能。

查看[Scott Guthrie 的 LINQ to SQL 系列](http://weblogs.asp.net/scottgu/archive/2007/05/19/using-linq-to-sql-part-1.aspx)博客文章，了解如何使用它的一些很好的示例。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T09:20:43.533

NetTiers 非常适合生成重且健壮的 DAL，我们在内部将它用于核心库和框架。

正如我所看到的，LINQ（在它的所有化身中，但特别是我认为您要求 SQL）非常适合快速数据访问，我们通常将它用于更灵活的情况。

如果不重新生成代码或 dbml 层，这两种技术都很难更改。

话虽如此，正确使用 LINQ 2 SQL 是一个非常强大的解决方案，由于它易于使用，您甚至可以开始将它用于未来的开发，但我不会为它丢弃您当前的 DAL - 如果它没有坏掉的话。 ..

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T09:42:27.087

我的经验告诉我，使用 linq 可以更快地完成工作，但对数据库的实际操作速度较慢。

所以......如果你有一个小数据库，我会说去吧。如果没有，我会在更改之前等待一些改进

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T19:25:27.367

我现在在相当大的项目（大约 150 个表）上使用 LINQ to SQL，它对我来说效果很好。我使用的最后一个 ORM 是 IBatis，它运行良好，但需要大量工作才能完成映射。LINQ to SQL 对我来说执行得非常好，而且到目前为止已证明非常容易开箱即用。在过渡过程中肯定有一些差异需要克服，但我建议使用它。

旁注，我从未使用或阅读过有关 NetTiers 的信息，因此我不会低估它的有效性，但 LINQ to SQL 总体上已被证明是一种非常可行的 ORM。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-28T02:27:13.653

我们的团队曾经使用过 NetTiers，发现它很有用。但是......我们使用它的次数越多，我们发现它的头痛和痛点就越多。例如，每当您对数据库进行更改时，您都需要使用 CodeSmith 重新生成 DAL，其中涉及：

*   在 3 个单独的项目中重新生成数千行代码
*   重新生成数百个存储过程

也许还有其他方法可以做到，但这是我们必须做的。源代码的重新生成是好的，可怕的，但是好的。真正的问题来自存储过程。它没有清除任何未使用的存储过程，因此如果您从架构中删除表并重新生成 DAL，则该表的存储过程不会被删除。此外，这对于数据库更改脚本来说变得相当头疼，我们必须将旧的数据库结构与新的数据库结构进行比较，并创建一个更改脚本来更新客户端安装。这个脚本可能会遇到上万行的sql代码，如果执行它时出现问题，总是存在的，解决它是相当痛苦的。

然后灯亮了，NHibernate 作为 ORM。它当然有一个加速时间，但它非常值得。有大量的支持，所以如果有什么你需要做的，很可能以前已经做过了。它非常灵活，允许您控制它的各个方面，然后是一些方面。它也变得越来越容易使用。Fluent Nhibernate 正在兴起并成为摆脱所需 xml 映射文件的好方法，NHibernate Profiler 提供了一个出色的界面来查看幕后发生的事情以提高效率并消除冗余。

Moving from NetTiers to NHibernate has been painful, but in a good way. It has forced us to move into a better architecture and re-evaluate functional needs. NetTiers provided tons of data access code, get this entity by its id, get this other entity by its foreign key, get a tlist and vlist of this and that, but most of it was unnecessary and unused. NHibernate with a generic repository and custom repositories only where needed reduced tons of unused code and really increased readability and reliability.

# java - Java：为什么我会收到错误消息“类型不匹配：无法将 int 转换为字节”

> ID：81392
> 
> 赞同：12
> 
> 时间：2008-09-17T09:16:19.987
> 
> 标签：java, type-conversion, byte, type-mismatch

如果您声明 byte 或 short 类型的变量并尝试对它们执行算术运算，则会收到错误“类型不匹配：无法将 int 转换为 short”（或相应地“类型不匹配：无法将 int 转换为字节”）。

```
byte a = 23;
byte b = 34;
byte c = a + b; 
```

在这个例子中，编译错误在第三行。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-17T09:16:38.410

尽管算术运算符被定义为对任何数字类型进行操作，但根据 Java 语言规范（5.6.2 二进制数字提升），byte 和 short 类型的操作数在交给运算符之前会自动提升为 int。

要对 byte 或 short 类型的变量执行算术运算，您必须将表达式括在括号中（其中的运算将作为 int 类型执行），然后将结果转换回所需的类型。

```
字节 a = 23;
字节 b = 34;
字节 c = (字节) (a + b);
```

下面是对真正的 Java 大师的后续问题：为什么？byte 和 short 类型是非常好的数字类型。为什么 Java 不允许对这些类型进行直接算术运算？（答案不是“精度损失”，因为首先没有明显的理由转换为 int。）

更新：jrudolph 建议此行为基于 JVM 中可用的操作，特别是仅实现全字和双字运算符。因此，要对字节和短裤进行操作，必须将它们转换为 int。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-17T09:26:49.167

您的后续问题的答案在这里：

> byte 和 short 类型的操作数在交给操作员之前会自动提升为 int

因此，在您的示例中，`a`and在交给 + 运算符之前`b`都转换为 a 。`int`两个`int`s 相加的结果也是一个`int`。然后尝试将其分配`int`给一个`byte`值会导致错误，因为存在潜在的精度损失。通过显式转换结果，您是在告诉编译器“我知道我在做什么”。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-17T09:34:00.507

我认为，问题在于 JVM 仅支持两种类型的堆栈值：字长和双字长。

然后他们可能决定他们只需要一个对堆栈上字大小的整数起作用的操作。所以在字节码级别只有 iadd、imul 等（并且没有字节和短裤的运算符）。

因此，Java 无法安全地将其转换回较小的字节和短数据类型的这些操作的结果是您得到一个 int 值。所以他们强迫你将值缩小到字节/短。

但最后你是对的：例如，这种行为与 int 的行为不一致。如果结果溢出，您可以毫无问题地添加两个整数并且不会出错。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T10:15:20.563

Java 语言总是将算术运算符的参数提升为 int、long、float 或 double。所以取表达式：

```
a + b 
```

其中 a 和 b 是字节类型。这是以下的简写：

```
(int)a + (int)b 
```

这个表达式是 int 类型的。在将 int 值分配给字节变量时给出错误显然是有意义的。

为什么要以这种方式定义语言？假设 a 为 60，b 为 70，则 a+b 为 -126 - 整数溢出。作为预期会导致 int 的更复杂表达式的一部分，这可能会成为一个困难的错误。限制使用字节和短到数组存储、文件格式/网络协议和谜题的常量。

JavaPolis 2007 中有一段有趣的记录。James Gosling 举了一个例子，说明无符号算术有多复杂（以及为什么它不在 Java 中）。Josh Bloch 指出，他的示例在正常有符号算术下也给出了错误的示例。对于可理解的算术，我们需要任意精度。

# database - Postgres 复制

> ID：81404
> 
> 赞同：4
> 
> 时间：2008-09-17T09:18:02.777
> 
> 标签：database, postgresql, replication

现在我在 PostgreSQL 中有一个数据库（大约 2-3 GB），它用作类似 RoR/Python LAMP 的应用程序的数据存储。

有哪些简单且强大的工具可以将主数据库复制到第二台机器？

我浏览了一些包（Slony-I 等），但如果能听到真实的故事也很棒。

现在我不关心负载平衡等。我现在正在考虑使用简单的 Write-Ahead-Log 策略。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-02-02T08:12:08.560

如果您可以升级到第 9 页，我希望使用流式复制 - 非常简单的设置。或者，如果您无法升级，您可以只查看热备用（您可以查询）。

见这里：[http ://eggie5.com/15-setting-up-pg9-streaming-replication](http://eggie5.com/15-setting-up-pg9-streaming-replication)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T09:55:28.333

如果您不进行复制，预写日志是最简单的解决方案。

# c# - C# 解析器

> ID：81406
> 
> 赞同：103
> 
> 时间：2008-09-17T09:18:14.180
> 
> 标签：c#, parsing

哪些解析器可用于解析 C# 代码？

我正在寻找一个可以在 C# 中使用的 C# 解析器，并让我可以访问有关所分析代码的每个工件的行和文件信息。

* * *

## 回答 #1

> 赞同：119
> 
> 时间：2008-09-17T09:21:39.570

适用于源代码：

*   [CSParser](http://www.codeplex.com/csparser)：从 C# 1.0 到 2.0，开源
*   [Metaspec C# Parser](http://www.csharpparser.com/csparser.php)：从 C# 1.0 到 3.0，商业产品（约 5000 美元）
*   [＃认出！](http://www.sharprecognize.com/)：从 C# 1.0 到 3.0，商业产品（约 900 欧元）（[SharpRecognize](https://stackoverflow.com/questions/81406/parser-for-c#185380)的回答）
*   [SharpDevelop Parser](http://www.icsharpcode.net/OpenSource/SD/)（[Akselsson](https://stackoverflow.com/questions/81406/parser-for-c#81434)的回答）
*   [NRefactory](https://github.com/icsharpcode/NRefactory/)：从 C# 1.0 到 4.0 (+async)，开源，SharpDevelop 中使用的解析器。包括语义分析。
*   [C# Parser 和 CodeDOM](http://www.inevitablesoftware.com/Products.aspx)：一个完整​​的 C# 4.0 Parser，已经支持 C# 5.0 异步功能。商业产品（49 美元到 299 美元）（肯贝克特的[回答](https://stackoverflow.com/questions/81406/parser-for-c/7631455#7631455)）
*   [Microsoft Roslyn CTP](http://msdn.microsoft.com/en-us/roslyn)：编译器即服务。

组装工作：

*   系统反射
*   [Microsoft 通用编译器基础结构](http://ccimetadata.codeplex.com/)：从 C# 1.0 到 3.0，Microsoft 公共许可证。由[Fxcop](http://www.microsoft.com/downloads/details.aspx?FamilyID=9aeaa970-f281-4fb0-aba1-d59d7ed09772&displaylang=en)和[Spec#使用](http://research.microsoft.com/en-us/projects/specsharp/)
*   [Mono.Cecil](http://www.mono-project.com/Cecil)：从 C# 1.0 到 3.0，开源

程序集“解析”的问题在于我们对行和文件的信息较少（这些信息基于 .pdb 文件，而 Pdb 仅包含方法的行信息）

我个人推荐**Mono.Cecil**和**NRefactory**。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-17T09:22:25.683

[Mono](http://www.mono-project.com/)（开源）包括 C# 编译器（当然还有解析器）

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-03-09T11:38:23.843

如果要将 C# v3.5 编译为 .net 程序集：

```
var cp = new Microsoft.CSharp.CSharpCodeProvider(new Dictionary<string, string>() { { "CompilerVersion", "v3.5" } }); 
```

[http://msdn.microsoft.com/en-us/library/microsoft.csharp.csharpcodeprovider.aspx](http://msdn.microsoft.com/en-us/library/microsoft.csharp.csharpcodeprovider.aspx)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-10-13T01:33:22.790

如果您熟悉 ANTLR，则可以使用[Antlr C# 语法](http://antlrcsharp.codeplex.com/)。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-02-06T21:28:34.557

我已经使用 SharpDevelop AST API在[OWASP O2 平台](http://www.owasp.org/index.php/OWASP_O2_Platform)项目中实现了您所要求的（C# 代码的 AST 解析） 。

为了更容易使用，我编写了一个快速 API，它公开了许多关键源代码元素（使用语句、类型、方法、属性、字段、注释），并且能够将原始 C# 代码重写为 C# 和 VBNET .

您可以在此 O2 XRule 脚本文件中查看此 API：[ascx_View_SourceCode_AST.cs.o2](http://code.google.com/p/o2platform/source/browse/trunk/O2%20-%20All%20Active%20Projects/O2_XRules_Database/_Rules/DotNet/ascx_View_SourceCode_AST.cs.o2)。

例如，这是您处理 C# 源代码文本并填充许多 TreeView 和 TextBox 的方式：

```
 public void updateView(string sourceCode)
    {   
        var ast = new Ast_CSharp(sourceCode);
        ast_TreeView.show_Ast(ast);
        types_TreeView.show_List(ast.astDetails.Types, "Text");
        usingDeclarations_TreeView.show_List(ast.astDetails.UsingDeclarations,"Text");
        methods_TreeView.show_List(ast.astDetails.Methods,"Text");
        fields_TreeView.show_List(ast.astDetails.Fields,"Text");
        properties_TreeView.show_List(ast.astDetails.Properties,"Text");
        comments_TreeView.show_List(ast.astDetails.Comments,"Text");

        rewritenCSharpCode_SourceCodeEditor.setDocumentContents(ast.astDetails.CSharpCode, ".cs");
        rewritenVBNet_SourceCodeEditor.setDocumentContents(ast.astDetails.VBNetCode, ".vb");                                
    } 
```

[ascx_View_SourceCode_AST.cs.o2](http://code.google.com/p/o2platform/source/browse/trunk/O2%20-%20All%20Active%20Projects/O2_XRules_Database/_Rules/DotNet/ascx_View_SourceCode_AST.cs.o2)上的示例还展示了如何使用从 AST 收集的信息在源代码上选择类型、方法、注释等。

这里的参考是编写的 API 代码（请注意，这是我第一次使用 SharpDevelop 的 C# AST 解析器，我仍在了解它是如何工作的）：

*   [AstDetails.cs](http://code.google.com/p/o2platform/source/browse/trunk/O2%20-%20All%20Active%20Projects/O2%20Modules%20Using%203rd%20Party%20Dlls/O2_External_SharpDevelop/AST/AstDetails.cs)
*   [AstTreeView.cs](http://code.google.com/p/o2platform/source/browse/trunk/O2%20-%20All%20Active%20Projects/O2%20Modules%20Using%203rd%20Party%20Dlls/O2_External_SharpDevelop/AST/AstTreeView.cs)
*   [AstValue.cs](http://code.google.com/p/o2platform/source/browse/trunk/O2%20-%20All%20Active%20Projects/O2%20Modules%20Using%203rd%20Party%20Dlls/O2_External_SharpDevelop/AST/AstValue.cs)
*   [Ast_CSharp.cs](http://code.google.com/p/o2platform/source/browse/trunk/O2%20-%20All%20Active%20Projects/O2%20Modules%20Using%203rd%20Party%20Dlls/O2_External_SharpDevelop/AST/Ast_CSharp.cs)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-10-03T05:50:27.047

我们最近发布了一个 C# 解析器，它可以处理所有 C# 4.0 特性以及新的异步特性： [C# Parser 和 CodeDOM](http://www.inevitablesoftware.com/Products.aspx "C# 解析器和 CodeDOM")

该库生成一个语义对象模型，该模型保留注释和格式信息，并且可以修改和保存。它还支持使用 LINQ 查询来分析源代码。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-04-15T02:38:52.977

[您绝对应该查看 Roslyn，因为 MS 刚刚在此处](http://roslyn.codeplex.com/)打开（或即将打开）带有 Apache 2 许可证的代码。[您还可以从GitHub](https://github.com/Zenoware/RoslynParser)查看使用此代码解析此信息的方法。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-17T09:19:40.853

[http://www.codeplex.com/csparser](http://www.codeplex.com/csparser)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-17T09:22:47.197

[SharpDevelop](http://www.icsharpcode.net/OpenSource/SD/)是一个开源 IDE，带有一个基于访问者的代码解析器，它运行得非常好。它可以独立于 IDE 使用。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-17T09:32:00.997

考虑在构建的二进制文件上使用反射，而不是直接解析 C# 代码。反射 API 真的很容易使用，也许您可​​以获得您需要的所有信息？

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-10-23T19:20:47.493

看看[黄金解析器](http://www.devincook.com/goldparser/)。它有一个非常直观的 IU，可以让您交互式地测试您的语法并生成 C# 代码。它有很多可用的示例，而且它是完全免费的。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2010-12-30T09:39:40.637

也许您可以在 irony.codeplex.com 上尝试 Irony。

它非常快，而且 ac# 语法已经存在。

语法本身是直接用 C# 以类似 BNF 的方式编写的（通过一些运算符重载实现）

最好的一点是“语法”直接生成 AST。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-03-09T11:21:29.253

[不是在 C# 中，而是在我们的DMS 软件再工程工具包](http://www.semanticdesigns.com/Products/DMS/DMSToolkit.html)中提供了一个完整的 C# 2/3/4 解析器，它构建了完整的 AST 。

DMS 为解析、树构建、符号表构建和流分析、源到源转换以及从（修改的）AST 重新生成源代码提供了庞大的基础设施。（它还处理许多其他语言，而不仅仅是 C#。）

编辑（九月）2013：这个答案最近没有更新。DMS 长期处理 C# 5.0

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-07-17T13:19:06.263

正在获得动力并且非常适合这项工作的东西是[Nemerle](http://nemerle.org/)

您可以在 NDC 的这些视频中看到它是如何解决它的：

*   [Igor Tkachev - 使用 Nemerle 进行元编程](http://vimeo.com/43690661)
*   [Igor Tkachev - Nemerle 编程语言](http://vimeo.com/43588432)

* * *

## 回答 #15

> 赞同：-2
> 
> 时间：2008-10-09T06:26:05.177

如果您愿意编写自己的解析器（这很有趣），[GPPG可能会有用。](http://plas.fit.qut.edu.au/gppg/)

# javascript - 如何将 JavaScript 小部件添加到 Wordpress.com 托管的博客？

> ID：81410
> 
> 赞同：14
> 
> 时间：2008-09-17T09:18:44.193
> 
> 标签：javascript, wordpress, widget

我有一个通过 JavaScript 提供对博客友好的小部件的[网站。](http://notebooks.readerville.com/)这些在大多数情况下都可以正常工作，包括自托管的 Wordpress 博客。但是，在 Wordpress.com 上托管的博客中，侧边栏文本模块中不允许使用 JavaScript。有没有人看到这个限制的解决方法？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-17T09:37:40.157

您可以随时请求 wp 将您的小部件添加到他们的“已批准”列表中，但谁知道这需要多长时间。您正在谈论一种规避他们关于发布任意脚本的规则的方法。尤其是 myspace javascript 漏洞利用提高了对此类变通办法可能性的认识，因此您可能很难绕过限制 - 但是，这里有一个经典的尝试：

将 javascript 放在一个奇怪的地方，比如执行 URL 的任何地方。例如：

```
<div style="background:url('javascript:alert(this);');" /> 
```

有时“javascript”这个词会被删掉，但有时你可以把它当作 java\nscript 或类似的东西偷偷溜进去。

有时引号会被去掉 - 尝试 String.fromCharCode(34) 来解决这个问题。此外，一般来说，使用 eval("codepart1" + "codepart2") 来绕过受限制的单词或字符。

潜入 javascript 是一项棘手的工作，主要是利用非正统（可能未记录）浏览器行为来在页面上执行任意 javascript。欢迎来到黑客。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-18T03:32:07.950

来自官方[WordPress.com 常见问题解答](http://faq.wordpress.com/2006/05/07/javascript-can-i-use-that-on-my-blog/)：

> Javascript 可用于恶意目的，虽然您想做的事没问题，但这并不意味着所有的 javascript 都会好起来。

它继续提醒读者，MySpace 和 LiveJournal 都受到了恶意 Javascript 的影响，因此不会被允许（因为它可能会被不怀好意的用户利用）。他们不能冒险使用非常大的网站（想想我可以吃 Cheezburger、Anderson Cooper 360、Fox 等）。

如果您认为您拥有可以使 WordPress.com 受益的 Javascript，您可以[直接与他们联系](http://wordpress.com/contact-support/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-03-24T18:12:24.877

没有解决办法。Wordpress 目前不支持 Javascript。对不起。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-08-17T11:12:50.887

如果你真的需要那个 js 来工作，那就找一个关于 XSS 的好网站。但是，如果它适用于您，它适用于任何人，并且您发布了有关如何在您的页面上使用帖子或评论进行 XSS 攻击的教程。

参考： [http ://ha.ckers.org/xss.html](http://ha.ckers.org/xss.html)

# .net - 在桌面应用程序和网站之间启用单点登录

> ID：81423
> 
> 赞同：1
> 
> 时间：2008-09-17T09:21:05.110
> 
> 标签：.net, asp.net

我们有一个客户端/服务器应用程序，它带有一个富客户端前端（在.Net 中）以及一个管理门户（Asp.Net）。目前，用户必须在富客户端和网站上登录。我们希望他们能够登录富客户端，但如果他们从客户端中启动网站，则不必登录网站。我们怎么能做到这一点？

走另一条路不太重要，但如果可能的话会很好：登录网站，然后不必登录富客户端。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-17T09:26:39.573

一个可能的解决方案是：

*   登录富客户端
*   服务器生成一个随机令牌并存储在登录用户的反面
*   富客户端从服务器获取该令牌
*   该令牌用于指向该网站的 url
*   转到该网址（使用富客户端中的链接或按钮）将自动登录用户并重置令牌

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-17T21:50:16.277

简单的代币解决方案存在设计缺陷：如果需要，您将拥有某种可以逆向工程的秘密。如果圆顶正确，则可以完全避免这种情况。

我会提出一个挑战-响应算法。

*) 用户使用 pw 登录富客户端

*) 从 salt+password 计算 sha256 或类似的哈希值。（哈希 A）

*) 用户点击“转到网站”链接。

*) 启动 http 响应（例如 web 服务），用户获取用户帐户的“获取票号”。这张票的有效期很短（几分钟）

*) 客户端计算哈希(HashA+ticket) HashB

*) 最后 - 浏览器指向 www.example.org/?username=donkey&key=99754106633f94d350db34d548d6091a

*) 服务器检查他计算的哈希值是否与提交的哈希值相同。

这种方法的优点：

-server 从不知道密码，只知道加盐哈希。

- 甚至哈希也不会通过线路传输 -> 没有重放攻击。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-17T21:54:36.420

[OAuth](http://oauth.net/)怎么样？

> 一种开放协议，允许从桌面和 Web 应用程序以简单和标准的方法进行安全 API 授权。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T21:38:19.440

确保令牌有一个超时时间，比如 2-5 分钟，以确保它是真实的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T09:23:07.193

您可以向打开站点的 URL 添加一个令牌以识别它们。

您必须为令牌添加一些安全性：TTL、哈希、盐

# collaboration - 多用户片段管理器

> ID：81445
> 
> 赞同：3
> 
> 时间：2008-09-17T09:26:41.367
> 
> 标签：collaboration, code-snippets

目前，我们在工作中使用 wiki 来分享见解、技巧和信息。但不知何故，人们并没有那样分享片段。写起来可能太不方便，也很难在那里找到片段。

那么，是否有一个多用户/协作片段管理器？像[Snippely 之](http://code.google.com/p/snippely/)类的东西。（有人在多用户模式下尝试过 Snippely 吗？）

*   由于我们都在同一个站点上，因此最好使用映射的网络驱动器或 ODBC 而不是它自己的服务器进程。
*   哦，它必须支持 Unicode，让我们选择任何 truetype 字体。我们正在使用可怕的 APL 语言，它使用[特殊字符](http://en.wikipedia.org/wiki/APL_(programming_language)#APL_symbols_and_keyboard_layout)。
*   如果它不花钱就好了，这样我就不必说服管理层支付它以及其他开发人员使用它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T13:48:54.263

**Pastebin**是一个常见的解决方案。只需安装在网络上的某个位置，然后粘贴片段。[http://pastebin.com/](http://pastebin.com/)

在尝试调试一段代码或堆栈跟踪时效果很好。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T18:07:21.193

有 Snip-it pro ( [http://www.snipitpro.com](http://www.snipitpro.com) )，我不久前看了它，界面看起来很糟糕。40块钱/座，还不错。上次我在寻找这样的工具时，我什么也没找到，而且我发现让我的同事开始使用代码片段库非常困难——每个人都乐于用谷歌搜索它或搜索他们的旧代码库。这些天来，我使用 Evernote 来满足我自己的所有片段需求。

# sql - 列数据类型中 BYTE 和 CHAR 的区别

> ID：81448
> 
> 赞同：182
> 
> 时间：2008-09-17T09:27:30.773
> 
> 标签：sql, oracle, unicode, varchar

在 Oracle 中，有什么区别：

```
CREATE TABLE CLIENT
(
 NAME VARCHAR2(11 BYTE),
 ID_CLIENT NUMBER
) 
```

和

```
CREATE TABLE CLIENT
(
 NAME VARCHAR2(11 CHAR), -- or even VARCHAR2(11)
 ID_CLIENT NUMBER
) 
```

* * *

## 回答 #1

> 赞同：285
> 
> 时间：2008-09-17T09:34:39.990

让我们假设数据库字符集是 UTF-8，这是最新版本的 Oracle 中推荐的设置。在这种情况下，某些字符需要超过 1 个字节才能存储在数据库中。

如果将字段定义为`VARCHAR2(11 BYTE)`，Oracle 最多可以使用 11 个字节进行存储，但实际上您可能无法在字段中存储 11 个字符，因为其中一些需要超过一个字节来存储，例如非英文字符。

通过定义字段，`VARCHAR2(11 CHAR)`告诉 Oracle 它可以使用足够的空间来存储 11 个字符，无论存储每个字符需要多少字节。单个字符最多可能需要 4 个字节。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-09-17T09:31:18.720

一个正好有 11 个字节的空间，另一个正好有 11 个字符。某些字符集（例如 Unicode 变体）可能每个字符使用一个以上的字节，因此 11 字节字段的空间可能少于 11 个字符，具体取决于编码。

另请参阅[http://www.joelonsoftware.com/articles/Unicode.html](http://www.joelonsoftware.com/articles/Unicode.html)

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-09-17T10:13:00.977

根据系统配置，以 BYTES 为单位测量的 CHAR 大小可能会有所不同。在您的示例中：

1.  将字段限制为 11 **BYTE**
2.  将字段限制为 11 个**CHAR**角色

* * *

结论：1 CHAR 不等于 1 BYTE。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-17T09:31:25.677

我不确定，因为我不是 Oracle 用户，但我认为不同之处在于使用多字节字符集，例如 Unicode (UTF-16/32)。在这种情况下，11 个字节可以占不到 11 个字符。

此外，这些字段类型在重音字符或大小写方面可能会受到不同的处理，例如 'binaryField(ete) = "été"' 将不匹配，而 'charField(ete) = "été"' 可能（再次不确定 Oracle） .

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2021-05-05T09:20:23.637

简而言之，当您编写时`NAME VARCHAR2(11 BYTE)`，该变量中只能容纳 11 个字节。

无论您使用哪种字符集，例如，如果您使用的是 Unicode (UTF-16)，那么在`NAME`.

另一方面，如果您编写 `NAME VARCHAR2(11 CHAR)`then`NAME`可以容纳 11 CHAR，而不管它们的字符编码如何。

`BYTE`如果您不指定`BYTE`或`CHAR`

因此，如果您编写`NAME VARCHAR2(4000 BYTE)`并使用 Unicode(UTF-16) 字符编码，则只能容纳 2000 个字符`NAME`

这意味着应用了变量的大小限制，`BYTES`并且取决于字符编码，该变量中可以容纳多少个字符。

# java - 将完整的 HTML 内容推回客户端时，如何避免在服务器端创建临时文件？

> ID：81449
> 
> 赞同：0
> 
> 时间：2008-09-17T09:27:46.763
> 
> 标签：java, tomcat, servlets, rpc

在 Tomcat 上运行的服务器端应用程序中，我根据从 Internet 下载的随机用户请求站点生成完整的 HTML 页面（带有标题）。客户端应用程序使用异步回调来请求处理特定网页。由于处理可能需要一段时间，我想通过轮询通知用户进度，因此回调。

在服务器端，检索网页后，对其进行处理并创建“增强”版本。然后这个版本必须返回给用户。将页面显示为客户端应用程序页面的一部分不是一种选择。

目前，服务器会生成一个临时文件并将链接发回给它。这显然是次优的。

下一个最好的解决方案是我可以用 inolves 创建一个缓存数据库，将 HTML 内容与其 md5-sum 或 sha1-id 一起存储，然后将链接发送回 servlet，并将 hash-ID 作为参数。servlet 然后从缓存数据库请求站点。

有没有更好的解决方案？如果没有，您会建议使用哪个数据库后端？我在考虑 SQLite。要解决的部分问题是：如何将页面推`<html>`送回`</html>`客户端？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T09:30:57.503

如果不需要真正的持久性，那么使用像 memcached 这样更临时的东西而不是 SQL 怎么样？调用语义非常干净和简单——当然您可以手动、ttl 或 @restart 使数据过期。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T09:43:05.027

*您可以创建一个内存缓冲区，将其填满，然后将其*作为响应发送（使用 mime-type 'text/html' 提供它），而不是创建一个临时文件，填充它，然后发送链接。如果您不想立即发送页面缓冲区，您可以保存它们以供稍后在用户会话中使用。如果您担心这样会占用太多内存，您可能希望只在内存中保留一定数量的页面缓冲区，并将其余部分写入磁盘以供以后检索。使用数据库听起来有点矫枉过正（毕竟，不涉及任何关系信息）——但它可以很好地解决缓存问题。

# python - 在 Google App Engine 中上传文件

> ID：81451
> 
> 赞同：79
> 
> 时间：2008-09-17T09:28:53.313
> 
> 标签：python, google-app-engine

我计划创建一个 Web 应用程序，允许用户降级他们的 Visual Studio 项目文件。但是，Google App Engine 似乎通过 和 接受文件上传和平面文件存储在 Google 服务器`db.TextProperty`上`db.BlobProperty`。

我很高兴任何人都可以提供代码示例（客户端和服务器端）来说明如何做到这一点。

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2008-10-06T11:15:22.800

事实上，这个问题在 App Egnine 文档中得到了解答。请参阅[上传用户图像](http://code.google.com/appengine/docs/images/usingimages.html#Uploading)的示例。

<form></form> 内的 HTML 代码：

```
<input type="file" name="img"/>
```

Python代码：

```
类留言簿（webapp.RequestHandler）：
  def post（自我）：
    问候=问候（）
    如果 users.get_current_user():
      greeting.author = users.get_current_user()
    greeting.content = self.request.get("content")
    头像 = self.request.get("img")
    问候.头像 = db.Blob（头像）
    问候语.put()
    self.redirect('/')
```

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2011-01-24T21:46:46.073

这是一个完整的工作文件。我从谷歌网站上提取了原件并对其进行了修改，使其更加真实。

需要注意的几点：

1.  此代码使用[BlobStore API](http://code.google.com/appengine/docs/python/blobstore/)
2.  ServeHandler 类中这一行的目的是“修复”密钥，以便它摆脱浏览器中可能发生的任何名称修改（我在 Chrome 中没有观察到任何名称）

    ```
    blob_key = str(urllib.unquote(blob_key)) 
    ```

3.  最后的“save_as”子句很重要。它将确保文件名在发送到您的浏览器时不会被破坏。摆脱它以观察会发生什么。

    ```
    self.send_blob(blobstore.BlobInfo.get(blob_key), save_as=True) 
    ```

祝你好运！

```
import os
import urllib

from google.appengine.ext import blobstore
from google.appengine.ext import webapp
from google.appengine.ext.webapp import blobstore_handlers
from google.appengine.ext.webapp import template
from google.appengine.ext.webapp.util import run_wsgi_app

class MainHandler(webapp.RequestHandler):
    def get(self):
        upload_url = blobstore.create_upload_url('/upload')
        self.response.out.write('<html><body>')
        self.response.out.write('<form action="%s" method="POST" enctype="multipart/form-data">' % upload_url)
        self.response.out.write("""Upload File: <input type="file" name="file"><br> <input type="submit" name="submit" value="Submit"> </form></body></html>""")

        for b in blobstore.BlobInfo.all():
            self.response.out.write('<li><a href="/serve/%s' % str(b.key()) + '">' + str(b.filename) + '</a>')

class UploadHandler(blobstore_handlers.BlobstoreUploadHandler):
    def post(self):
        upload_files = self.get_uploads('file')
        blob_info = upload_files[0]
        self.redirect('/')

class ServeHandler(blobstore_handlers.BlobstoreDownloadHandler):
    def get(self, blob_key):
        blob_key = str(urllib.unquote(blob_key))
        if not blobstore.get(blob_key):
            self.error(404)
        else:
            self.send_blob(blobstore.BlobInfo.get(blob_key), save_as=True)

def main():
    application = webapp.WSGIApplication(
          [('/', MainHandler),
           ('/upload', UploadHandler),
           ('/serve/([^/]+)?', ServeHandler),
          ], debug=True)
    run_wsgi_app(application)

if __name__ == '__main__':
  main() 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-27T15:20:58.977

Google Groups 中有一个关于它的线程：

[上传文件](http://groups.google.com/group/google-appengine/browse_thread/thread/f9d0f22d8de8c025/bba32165e308dd13?lnk=gst&q=uploading+files#bba32165e308dd13)

有了很多有用的代码，该讨论对我上传文件很有帮助。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-12-31T23:33:53.283

谷歌发布了一项存储大文件的服务。查看[blobstore API 文档](http://code.google.com/appengine/docs/python/blobstore/)。如果您的文件 > 1MB，则应该使用它。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2010-06-16T04:55:55.947

我今天试了一下，它的工作原理如下：

我的 sdk 版本是 1.3.x

html页面：

```
<form enctype="multipart/form-data" action="/upload" method="post" > 
<input type="file" name="myfile" /> 
<input type="submit" /> 
</form> 
```

服务器代码：

```
file_contents = self.request.POST.get('myfile').file.read() 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-10T21:47:22.863

如果您仍然有问题，请检查您是否在表单标签中使用 enctype

不：

```
<form encoding="multipart/form-data" action="/upload"> 
```

是的：

```
<form enctype="multipart/form-data" action="/upload"> 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-17T09:32:32.243

您不能存储文件，因为没有传统的文件系统。您只能将它们存储在它们自己的 DataStore 中（在定义为[BlobProperty](http://code.google.com/appengine/docs/datastore/typesandpropertyclasses.html)的字段中）

上一个链接中有一个例子：

```
class MyModel(db.Model):
  blob = db.BlobProperty()

obj = MyModel()
obj.blob = db.Blob( file_contents ) 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-08-06T19:19:13.120

[就我个人而言，我发现此处](http://shogi-software.blogspot.com/2009/04/google-app-engine-and-file-upload.html)描述的教程在将 Java 运行时与 GAE 结合使用时很有用。出于某种原因，当我尝试使用上传文件时

```
<form action="/testservelet" method="get" enctype="multipart/form-data">
    <div>
        Myfile:<input type="file" name="file" size="50"/>
    </div>

    <div>
        <input type="submit" value="Upload file">
    </div>
</form> 
```

我发现我的 HttpServlet 类由于某种原因不接受带有“enctype”属性的表单。删除它可以，但是，这意味着我无法上传任何文件。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-17T09:33:52.100

Google App Engine 中没有存储平面文件。一切都必须进入[数据存储](http://code.google.com/appengine/docs/datastore/)区，这有点像关系数据库，但又不完全一样。

您可以将文件存储为[TextProperty](http://code.google.com/appengine/docs/datastore/typesandpropertyclasses.html#TextProperty)或[BlobProperty](http://code.google.com/appengine/docs/datastore/typesandpropertyclasses.html#BlobProperty)属性。

DataStore 条目有 1MB 的限制，这可能是也可能不是问题。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-08-23T05:53:11.867

在 App Engine 上上传文件时，我观察到一些奇怪的行为。当您提交以下表格时：

```
<form method="post" action="/upload" enctype="multipart/form-data">
    <input type="file" name="img" />
    ...
</form> 
```

然后你`img`像这样从请求中提取：

```
img_contents = self.request.get('img') 
```

该`img_contents`变量`str()`在 Google Chrome 中是 a，但在 Firefox 中是 unicode。就像你现在一样，`db.Blob()`构造函数接受一个字符串，如果你传入一个 unicode 字符串，它将抛出一个错误。

有谁知道如何解决这个问题？

此外，我发现绝对奇怪的是，当我复制和粘贴留言簿应用程序（带有头像）时，它可以完美运行。我在我的代码中以完全相同的方式执行所有操作，但它不起作用。我非常接近把头发拉出来。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-08-05T07:27:45.133

有一种使用**平面文件系统**的方法（从使用角度来看至少）

有这个[**Google App Engine Virtual FileSystem 项目**](http://code.google.com/p/gaevfs/)。这是在数据存储和内存缓存 API 的帮助下实现的，以模拟普通文件系统。使用这个库，您可以在项目中使用**类似的文件系统访问（读取和写入）**。

# .net - 首次安装后如何检查 ClickOnce 先决条件？

> ID：81459
> 
> 赞同：11
> 
> 时间：2008-09-17T09:29:53.653
> 
> 标签：.net, clickonce

如果我理解正确，`ClickOnce`则仅通过包含先决条件信息的 setup.exe 文件在首次安装应用程序时检查先决条件。如果用户将来打开应用程序，它将检查新版本，但不会再次启动 setup.exe，因此不会检查可能已添加的任何新先决条件。

有什么方法可以强制 ClickOnce 再次检查先决条件，或者是否有人有一个好的解决方案而不要求用户`setup.exe`再次运行？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-17T11:42:23.897

不幸的是，您的用户将不得不重新运行 setup.exe 以检查并安装您添加的所有新先决条件。

使用 ClickOnce 部署的应用程序仅检查应用程序更新（如果启用），而不是先决条件，因为引导程序的工作是确保在安装应用程序之前安装所有依赖项。

我在[微软的网站上](http://msdn.microsoft.com/en-us/library/h4k032e1.aspx)找到了这个：

> Setup.exe（引导程序）负责在应用程序运行之前安装所有依赖项。此引导程序作为独立于 ClickOnce 运行时引擎的单独进程运行。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-18T15:50:34.947

哈迪斯是正确的。但是，只要您的应用程序可以*在*没有新的先决条件的情况下启动，您就可以选择在代码中检查它。

我在使用 Crystal Reports 时遇到了完全相同的情况，最后编写代码来检查它是否已安装、下载安装文件并在后台运行它。绝对是一种痛苦，但最终结果效果很好。

# asp.net - 如何为 ASP.NET 移动页面进行手动表单身份验证

> ID：81472
> 
> 赞同：0
> 
> 时间：2008-09-17T09:31:56.580
> 
> 标签：asp.net, mobile

我正在开发一个使用 .NET 3.5 和框架附带的移动控件的 ASP.NET 移动网站。我有一个登录表单，系统将对用户进行身份验证，以便他/她可以访问某些受限页面。

在标准的 ASP.NET 网站中，我可以在用户登录后使用会话来存储一些标志，但我想知道我可以为移动版本做同样的事情吗？这些移动设备的浏览器是否支持会话变量（或 cookie）？对移动页面进行身份验证是否也有任何标准做法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T09:46:49.947

会话变量存储在服务器中，因此您可以忘记设备浏览器功能。

我没有练习过为移动设备开发，但 4 年前我正在使用一项使用 cookie 身份验证的服务，而手机并不是一流的，所以......我认为你可以理所当然地认为 cookie 的可用性。面向移动设备的完整未来浏览器正在兴起，因此...投资于未来，不要将精力花在即将被弃用的旧技术上...

在我看来，更喜欢cookie身份验证，它更标准，您可以将cookie保存在手机上以防止进一步的身份验证......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-18T16:42:12.730

您确实可以支持 cookie 身份验证，但唯一能保证其工作的方法是将 cookie ID 作为 URL 的一部分附加，即无 cookie 会话。是的，这是不好的做法，因为它丑陋且非常不安全，而且所有现代手机都支持 cookie。

但有些设备有 cookie 限制，更重要的是，一些网络从通过其网关的 HTTP 标头中删除所有 cookie 信息，即使电话没有问题（NTT DoCoMo 在日本这样做）。它可能不适用于您的情况，但请记住这一点。

幸运的是，ASP.NET 确实很容易支持无 cookie 会话。在 app.config 文件中：

```
<sessionState cookieless="true" /> 
```

成功了。

# ftp - 使用 FTPS 连接传输文件时，“二进制模式 taransfer”和“ASCII 模式传输”有什么区别？

> ID：81484
> 
> 赞同：2
> 
> 时间：2008-09-17T09:33:18.123
> 
> 标签：ftp, sap, file-transfer, edi, ftps

我正在使用**FTPS**连接将文本文件 *[此文件将包含 EDI（电子数据交换）信息]*发送到邮箱 INOVIS。我已将系统配置为打开 FTPS 连接并使用 PUT 命令将文件写入FTP 服务器上的文件夹。问题是：我应该使用什么文件传输模式？如何在模式之间切换？

此外，通过 FTPS 连接传输文件时使用哪种模式是“最佳实践”。如果有人可以为我提供一个小的 ftp 脚本，那将会很有帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-24T20:24:21.863

这个问题的许多其他答案都是几乎正确到完全错误的信息的集合。

ASCII 模式意味着文件应在线上转换为规范的文本形式。这意味着：

*   NVT-ASCII 字符集。即使原始文件使用其他字符集，例如 ASCII、EBCDIC 或 UTF-8。从技术上讲，这不允许设置第 8 位的字符，但大多数实现不会强制执行此操作。
*   CRLF 行尾。

EBCDIC 模式意味着一组类似的规则，只是线路上的数据应该在 EBCDIC 中。

LOCAL 模式允许发送大小不是每字节 8 位的数据。

IMAGE（或 BINARY）模式意味着数据应该在没有任何更改的情况下发送。用户有责任确保目标系统在数据到达后能够理解数据。

除此之外，这意味着如果所涉及的系统之一不使用基于 ASCII 的字符集，则使用 BINARY 模式发送文本数据的建议将失败。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T09:41:18.010

ASCII 模式在 unix 和 DOS 格式之间更改换行符。\n 到 \r\n 反之亦然。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T09:42:41.687

实际上，ASCII/BINARY 与第 8 位无关。这是翻译行尾的惯例。

当您在 Windows 机器上与 Unix FTP 服务器（FTPS 或 FTP - 无关紧要 - 协议相同）通信时，服务器将在存储之前将任何 <CR><LF>-Combination 替换为 <LF>文件，因此如果您从 unix 服务器获取文件，请进行反向翻译。

ASCII 模式背后的想法是将行结尾转换为目标平台的相应结尾。

由于当今世界似乎正在​​趋向于 unix 约定 (<LF>)，并且几乎所有当今的编辑器（除了记事本）都可以轻松处理 Unix-Line-Endings，因此 ASCII 模式的日子确实已经屈指可数了，我会无论如何建议始终使用 BINARY 传输模式。

无论如何，在传输过程中更改数据的前景有些令人恐惧。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T09:39:05.003

ASCII 模式还使最终用户更直接地跨不同平台共享文本文件。他们不必担心默认的行结尾（例如 cr/lf 与仅 lf），因为 ASCII 模式会即时为他们进行翻译。

不过，对于大多数文件类型，您总是希望使用 BINARY 模式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T09:42:05.933

ACSII 模式基于服务器和客户端平台（CR/LF 与 LF）在 UNIX 和 Windows 格式之间转换文本文件，而二进制则没有。当然，如果您以 ASCII 模式传输几乎所有非文本的内容，它可能会因此而损坏。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-17T09:37:04.383

如果您想要精确复制数据，请使用二进制模式 - 使用 ascii 模式将假定数据是 7 位文本（字符 0-127）并截断此范围之外的任何数据。可以追溯到神秘的 7 位网络时代，ASCII 模式可以节省您的时间。

在我们生活的全球化环境中——例如外语、货币符号等非 ascii 字符很常见——你应该始终使用 BINARY 模式。

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2008-09-17T09:45:47.750

对于 FTP 协议，ASCII 传输模式会将每个字符的第 8 位视为无关紧要，并将其用于错误检查。至于二进制传输模式，您的数据将按原样发送。请注意，以 ASCII 模式发送二进制数据（几乎）总是会导致数据损坏。但是，只要发送和接收系统以相同的方式使用第 8 位，以二进制模式传输 ASCII 数据就可以工作（在现代系统中，第 8 位应保持为 0 以防止与扩展的 ASCII 字符集发生冲突）。

# smalltalk - 如何在 OpenBSD 下运行 VisualWorks？

> ID：81491
> 
> 赞同：4
> 
> 时间：2008-09-17T09:34:06.403
> 
> 标签：smalltalk, squeak, openbsd, visualworks

有没有人让 VisualWorks 在 OpenBSD 下运行？它不是官方支持的平台，但 Cincom 的一个人告诉我，它应该能够在 linux 兼容模式下运行。你是怎么设置的？

我已经让 Squeak 运行没有问题，所以我不是在寻找替代方案。我特别需要为一个项目运行 VisualWorks 的 Web Velocity。

谢谢，

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-17T12:01:28.127

如果您想知道如何设置 linux 兼容模式并且您正在运行 GENERIC 内核：

```
# sysctl kern.emul.linux=1 
```

在启动时启用取消注释 /etc/sysctl.conf 中的 kern.emul.linux=1 行

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-06T15:44:09.447

请参阅[OpenBSD 常见问题解答](http://www.openbsd.org/faq/)，特别是第[9.4 节 - 在 OpenBSD 上运行 Linux 二进制文件](http://www.openbsd.org/faq/faq9.html#Interact)。

通常需要更多的步骤，`kern.emul.linux=1`除非您有静态链接（即完全独立）的二进制文件。好消息是存在包含 Linux 库的软件包，并且它们易于安装。这在上面的链接中都有详细说明。

# java - 向 J2SE 应用程序添加插件支持的最佳技术？

> ID：81495
> 
> 赞同：5
> 
> 时间：2008-09-17T09:35:36.807
> 
> 标签：java, plugins, plugin-architecture

我正在编写一个 J2SE 桌面应用程序，它需要它的一个组件是可插入的。我已经为这个插件定义了 Java 接口。用户应该能够在运行时（通过 GUI）选择他们想要使用该接口的哪个实现（例如在初始化对话框中）。我设想每个插件都被打包为一个 JAR 文件，其中包含实现类以及它可能需要的任何辅助类。

在桌面 Java 应用程序中做这类事情的最佳技术是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-17T11:17:13.770

在多次尝试基于插件的 Java 架构（这正是您所寻找的）之后，我终于发现[JSPF](http://code.google.com/p/jspf/)是 Java5 代码的最佳解决方案。它没有像 OSGI 这样的解决方案的巨大需求，而是相当容易使用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-17T09:49:22.593

OSGI 无疑是一种有效的方法。但是，假设您不需要卸载来重新加载插件，它可能是用锤子敲碎螺母。

您可以使用“java.util.jar”中的类来扫描插件文件夹中的每个 JAR 文件，然后使用“java.net.URLClassLoader”加载正确的文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T09:44:38.843

如果您“只”需要一个可插入的组件，则只需根据元信息实例化类就足够了，例如通过类加载器从类路径或某个插件目录中的各种 jar 中读取 META-INF/ 信息.

另一方面，OSGi 提供了构建整个应用程序的方法。如果您已经有一个大型桌面应用程序需要一个部件可插拔，这将是一个陡峭的学习曲线。如果您对桌面应用程序一无所知，OSGi 提供了模块化整个应用程序的方法。它是关于“组件的隔离”和模块的独立性。

如果您想进入 OSGi 通道，Apache Felix 提供了一个很好的开始。它可能看起来复杂而重量级，但这只是因为人们不习惯模块之间的那种隔离级别。过去调用任何公共方法都很容易......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T09:38:11.357

我正在考虑的一种方法是让我的应用程序启动一个轻量级 OSGi 容器，如果我理解正确，它将能够发现指定文件夹中存在哪些插件 JAR 文件，这反过来又可以让我列出它们供用户选择从。这可行吗？

我还发现了 Richard Deadman 的[这篇文章](http://www.deadman.ca/articles/pluggableArticle.html)，但它看起来有点过时（2006 年？）并且既没有提到 OSGi（至少没有提到名字）也没有提到`java.util.jar`包

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T09:38:50.853

您是否想过使用 OSGi 作为插件框架？使用 OSGi，您可以按需更新/替换、加载或卸载您的模块。

# encoding - Linux上最好的he-aac编码器？

> ID：81497
> 
> 赞同：4
> 
> 时间：2008-09-17T09:36:00.563
> 
> 标签：encoding, mp3, aac, aac+

我需要一个可以将 mp3 文件转换为 he-aac（又名 aac+）的编码器。到目前为止，我发现最好的一个是[nero aac encoder](http://www.nero.com/eng/down-ndaudio.php)。我有两个问题： - 只有一种输入格式：wav。将mp3文件转换为wav然后转换为he-aac有点慢。**-非商业**用途的免费许可证。

太糟糕了 ffmpeg 不支持 he-aac ......有一个商业解决方案[on2 flix](https://flix.on2.com/)，但它似乎是我需要做的简单任务的金锤。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-17T09:44:09.797

据我所知，Nero AAC 是唯一的一个。即使 FAAC 支持 HE-AAC 也没有用，因为作为编码器，它的设计非常糟糕，质量甚至无法与 LAME 竞争，更不用说好的 AAC 编码器了。

FFMPEG 团队的 Kostya 目前正在开发 AAC 编码器，但它还有很长的路要走——它还没有准备好使用 LC-AAC 的黄金时段，更不用说 HE-AAC（它甚至还没有提交到存储库）。第一步是让 ffmpeg 解码器支持 HE-AAC；目前只能通过FAAD解码。

我认为目前在任何平台上都没有*任何*HE-AAC 编码器的许可比 Nero 的许可更宽松。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-01-05T04:39:23.827

我已经使用`neroAacEnc`了很长一段时间了，我对结果很满意。如果你在 Linux 上，用`.AAC`一个或其他任何东西制作一个文件`.MP3`是很容易的，你只需要一个小的包装脚本，它负责解码`.WAV`和编码之后，删除`.WAV`文件。

请注意：从一种有损编码转换为另一种会进一步降低质量。因此，当您可以忍受`.MP3`并且没有无损来源时，您最好坚持使用它们。

这是一个小脚本，它从 转换`.FLAC`为`.AAC`，它只接受`.FLAC`文件作为参数：

```
#!/bin/zsh

for file in ${argv[*]}; do
    flac -d ${file}
    neroAacEnc -q 0.6 -if ${file%%.flac}.wav -of ${file%%.flac}.aac
    rm ${file%%.flac}.wav
done 
```

该脚本是顺序的，但可以很容易地制成多线程脚本。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-11-14T10:42:45.993

有一个编码器`accplus`，它是在 GNU 许可下[可用的](http://ffmpeg.org/doxygen/trunk/libaacplus_8c-source.html)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T21:44:13.043

另一个编码器：[mp4tools](http://teknoraver.net/software/mp4tools/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-12T18:40:57.327

我不知道质量，但我发现了 [enhAacPlusEnc](http://dgaapenc.berlios.de/en/)

# statistics - 找到具有相同有效负载的 TCP 数据包的概率？

> ID：81504
> 
> 赞同：0
> 
> 时间：2008-09-17T09:37:20.547
> 
> 标签：statistics, tcp, protocols, probability, packets

今天早些时候，我与一位开发人员进行了一次讨论，重新识别在特定接口上发出的具有相同有效负载的 TCP 数据包。他告诉我，由于 TCP 数据包是在系统级别构建的方式，找到具有相同有效负载的 TCP 数据包（即使相同的数据被发送多次）的概率非常低。我知道这可能是由于系统的 MTU 设置（通常是 1500 字节）等原因，但我真正在看什么样的概率统计数据？是否有任何特定协议可以更轻松地识别匹配的有效负载？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T11:28:01.823

定义有效载荷唯一性的是运行在 tcp 上的协议，而不是 tcp 协议本身。

例如，您可能天真地认为在请求服务器主页时所有 HTTP 请求都是相同的，但是引用者和用户代理字符串使有效负载不同。

同样，如果响应是动态生成的，它可能有一个日期头：

日期：格林威治标准时间 2008 年 9 月 12 日星期五 10:44:27

所以这将使响应有效负载不同。但是，如果内容是静态的，则后续有效负载可能相同。

请记住，由于序列号不同，实际数据包会有所不同，这些序列号应该是递增的和伪随机的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-17T11:57:04.343

克里斯是对的。更具体地说，包头中的两条或三条信息应该是不同的：

*   序列号（其目的是不可预测的）随着发送和接收的字节数而增加。
*   时间戳，包含两个时间戳的字段（尽管此字段是可选的）。
*   校验和，因为有效负载*和标头*都是校验和，包括不断变化的序列号。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T10:34:15.153

编辑：对不起，我最初的想法很荒谬。

你让我感兴趣，所以我用谷歌搜索了一下，发现[了这个](http://monkey.org/~jose/software/flowgrep/)。如果您想编写自己的工具，您可能必须检查每个有效负载，最简单的方法可能是某种哈希/校验和来检查相同的有效负载。只要确保您检查的是有效载荷，而不是整个数据包。

至于统计数据，我将不得不听从对 TCP 工作原理有更深入了解的人。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-27T16:41:52.087

发送相同的 PAYLOAD 可能相当普遍（特别是如果您正在运行某种网络服务）。如果您的意思是发送相同的 tcp 段（header 和 all）或整个网络数据包（ip 和 up），那么概率会大大降低。

# javascript - 无法使用 Scriptaculous Sortables 将项目拖到空列表中

> ID：81512
> 
> 赞同：1
> 
> 时间：2008-09-17T09:38:30.637
> 
> 标签：javascript, drag-and-drop, scriptaculous

我有三个无序列表，它们被创建为 Scriptaculous Sortables，以便用户可以在列表中以及它们之间拖动项目：

```
var lists = ["pageitems","rowitems","columnitems"];    
Sortable.create("pageitems", { dropOnEmpty: true, containment: lists, constraint: false });
    Sortable.create("rowitems", { dropOnEmpty: true, containment: lists, constraint: false });
    Sortable.create("columnitems", { dropOnEmpty: true, containment: lists, constraint: false }); 
```

我怎样才能做到这一点，如果用户将所有项目从列表中拖出，他们能够再次将它们放回原处？目前它不允许将项目拖到空列表中。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T11:32:07.133

也许空列表没有高度，因此没有可用的可放置区域。如果是这种情况，也许你只需要设置一个最小高度，或者在块上设置一些填充。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-02-03T02:32:42.703

将 dropOnEmpty:true 添加到选项参数中。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-09-23T22:51:41.623

确保您的目标列表样式为 float:left

我今天也有类似的经历。

# bash - 在bash中杀死后如何抑制终止消息？

> ID：81520
> 
> 赞同：68
> 
> 时间：2008-09-17T09:40:10.477
> 
> 标签：bash, unix, shell

在 bash 脚本中终止进程后，如何抑制出现的`Terminated`消息？

我试过`set +bm`了，但这不起作用。

我知道另一种解决方案涉及调用`exec 2> /dev/null`，但这可靠吗？如何重置它以便我可以继续看到 stderr？

* * *

## 回答 #1

> 赞同：149
> 
> 时间：2011-04-19T21:22:01.720

为了使消息静音，您必须`stderr` **在消息生成时**进行重定向。因为[`kill`](http://ss64.com/bash/kill.html)命令发送一个信号并且不等待目标进程响应，所以重定向`stderr`命令`kill`对你没有好处。内置 bash[`wait`](http://ss64.com/bash/wait.html)是专门为此目的而制作的。

这是一个非常简单的示例，可以杀死最近的后台命令。（[在此处了解有关 $! 的更多信息。](https://stackoverflow.com/a/5163260/117471)）

```
kill $!
wait $! 2>/dev/null 
```

因为两者都`kill`接受`wait`多个 pid，所以您也可以进行批量杀戮。这是一个杀死所有后台进程（当然是当前进程/脚本）的示例。

```
kill $(jobs -rp)
wait $(jobs -rp) 2>/dev/null 
```

我是从[bash 被带到这里的：silently kill background function process](https://stackoverflow.com/questions/5719030/bash-silently-kill-background-function-process/5722850)。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-09-17T10:07:39.663

简短的回答是你不能。Bash 总是打印前台作业的状态。监视标志仅适用于后台作业，并且仅适用于交互式 shell，不适用于脚本。

请参阅 jobs.c 中的 notify_of_job_status()。

正如您所说，您可以重定向，因此标准错误指向 /dev/null 但随后您会错过任何其他错误消息。您可以通过在运行脚本的子shell 中进行重定向来使其临时化。这留下了原始环境。

```
(script 2> /dev/null) 
```

这将丢失所有错误消息，但仅来自该脚本，而不是来自该 shell 中运行的任何其他内容。

您可以通过将新的文件描述符重定向到那里来保存和恢复标准错误：

```
exec 3>&2          # 3 is now a copy of 2
exec 2> /dev/null  # 2 now points to /dev/null
script             # run script with redirected stderr
exec 2>&3          # restore stderr to saved
exec 3>&-          # close saved version 
```

但我不推荐这个——第一个的唯一好处是它保存了一个子shell调用，同时更复杂，如果脚本改变文件描述符，甚至可能改变脚本的行为。

* * *

**编辑：**

*如需更合适的答案，请查看[Mark Edgar给出的答案](https://stackoverflow.com/users/129332/mark-edgar)*

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2011-01-31T09:55:05.200

解决方案：使用 SIGINT（仅适用于非交互式 shell）

演示：

```
cat > silent.sh <<"EOF"
sleep 100 &
kill -INT $!
sleep 1
EOF

sh silent.sh 
```

[http://thread.gmane.org/gmane.comp.shells.bash.bugs/15798](http://thread.gmane.org/gmane.comp.shells.bash.bugs/15798)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-17T09:44:15.303

也许通过调用将进程与当前的 shell 进程分离`disown`？

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-08-30T13:35:40.483

这就是我们都在寻找的吗？

不想要：

```
$ sleep 3 &
[1] 234
<pressing enter a few times....>
$
$
[1]+  Done                    sleep 3
$ 
```

通缉：

```
$ (set +m; sleep 3 &)
<again, pressing enter several times....>
$
$
$
$
$ 
```

如您所见，没有作业结束消息。在 bash 脚本中也适用于我，也适用于终止的后台进程。

'set +m' 禁用当前 shell 的作业控制（参见 'help set'）。因此，如果您在子 shell 中输入命令（如在括号中所做的那样），您将不会影响当前 shell 的作业控制设置。唯一的缺点是，如果要检查后台进程是否已终止或评估返回码，则需要将后台进程的 pid 返回到当前 shell。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-11-04T21:43:10.020

这也适用于 killall（对于那些喜欢它的人）：

```
killall -s SIGINT (yourprogram) 
```

抑制消息...我在后台模式下运行 mpg123。它只能通过发送 ctrl-c (SIGINT) 而不是 SIGTERM (默认) 静默地被杀死。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2021-02-24T16:40:07.110

由 bash 3.x 和 4.x的`Terminated`默认信号处理程序记录。只需在子进程的第一个捕获 TERM 信号：

```
#!/bin/sh

## assume script name is test.sh

foo() {
  trap 'exit 0' TERM ## here is the key
  while true; do sleep 1; done
}

echo before child
ps aux | grep 'test\.s[h]\|slee[p]'

foo &
pid=$!

sleep 1 # wait trap is done

echo before kill
ps aux | grep 'test\.s[h]\|slee[p]'

kill $pid ## no need to redirect stdin/stderr

sleep 1 # wait kill is done

echo after kill
ps aux | grep 'test\.s[h]\|slee[p]' 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-01-28T21:04:58.983

disown 为我做了完全正确的事—— exec 3>&2 有很多风险—— set +bm 似乎不能在脚本中工作，只能在命令提示符下工作

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-03-08T17:49:16.907

禁用作业通知的另一种方法是将您的命令放置在`sh -c 'cmd &'`构造中。

```
#!/bin/bash
# ...
pid="`sh -c 'sleep 30 & echo ${!}' | head -1`"
kill "$pid"
# ...

# or put several cmds in sh -c '...' construct
sh -c '
sleep 30 &
pid="${!}"
sleep 5 
kill "${pid}"
' 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-05-07T16:34:40.177

在脚本中添加 ' `jobs 2>&1 >/dev/null`' 成功，不确定它是否会帮助其他人的脚本，但这里有一个示例。

```
 while true; do echo $RANDOM; done | while read line
    do
    echo Random is $line the last jobid is $(jobs -lp)
    jobs 2>&1 >/dev/null
    sleep 3
    done 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2013-06-23T05:31:26.183

简单的：

```
{ kill $! } 2>/dev/null 
```

优势？可以使用任何信号

前任：

```
{ kill -9 $PID } 2>/dev/null 
```

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2018-02-10T22:15:15.833

我发现将 kill 命令放在一个函数中，然后将该函数置于后台会抑制终止输出

```
function killCmd() {
    kill $1
}

killCmd $somePID & 
```

# sql-server - 与 MS Sql Server 2005 的预定网络同步

> ID：81521
> 
> 赞同：0
> 
> 时间：2008-09-17T09:40:10.650
> 
> 标签：sql-server

我已经解决了作为发布者的 SQLSERVER 2005 和作为订阅者的 SQLEXPRESS 之间的网络同步。Web 同步必须通过 IE 界面（菜单工具/同步）手动启动，并在可用同步中进行选择。

一切工作正常，除了我没有找到一种方法来自动化同步，我仍然必须手动启动。任何的想法？

我不知道是否可以通过运行特定的 T-SQL 代码从 SQLEXPRESS 启动此同步（在这种情况下，我的问题可以间接解决）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T10:12:10.307

我不太了解 SQL Server Web 同步，但由于 SQL Express 没有 SQL Server 代理，因此您可以编写一个与计划任务一起运行的 C# 控制台应用程序。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-13T01:26:34.637

SQL Server MVP Denny Cherry 正在编写 SQL Server Agent 的替代品。

*   [丹尼关于它的博客](http://itknowledgeexchange.techtarget.com/sql-server/tag/standalone-sql-agent/)
*   [他在 Codeplex 上的独立 SQL 代理项目](http://standalonesqlagent.codeplex.com/)

使用它，您将能够按计划自动启动代码。但要么是这样，要么是编写自己的 .NET 应用程序来开始工作。SQL Server Express Edition 不包括任何类型的自动作业调度。

# database-design - 数据库设计查找表

> ID：81533
> 
> 赞同：4
> 
> 时间：2008-09-17T09:42:58.223
> 
> 标签：database-design, magic-numbers

我目前正在尝试改进遗留数据库的设计，我有以下情况

目前我有一个表 SalesLead，我们在其中存储 LeadSource。

```
Create Table SalesLead(
    ....
    LeadSource varchar(20)
    ....
) 
```

潜在客户来源有用地存储在表格中。

```
Create Table LeadSource (
    LeadSourceId int,   /*the PK*/
    LeadSource varchar(20)
) 
```

所以我只想创建一个从一个到另一个的外键并删除非规范化列。

我希望所有标准的东西。

这是我的问题。我似乎无法摆脱这个问题，而不是写作

```
 SELECT * FROM SalesLead Where LeadSource = 'foo' 
```

这是完全明确的，我现在必须写

```
SELECT * FROM SalesLead where FK_LeadSourceID = 1 
```

或者

```
SELECT * FROM SalesLead 
INNER JOIN LeadSource ON SalesLead.FK_LeadSourceID = LeadSource.LeadSourceId 
where LeadSource.LeadSource = "foo" 
```

如果我们改变 LeadSource 字段的内容，就会中断。

在我的应用程序中，当我想更改 SalesLead 的 LeadSource 的值时，我不想从 1 更新到 2（例如），因为我不想让开发人员记住这些**神奇的数字**。id 是任意的，应该保持不变。

***如何在我的应用程序代码中删除或否定对它们的依赖？***

**编辑**我的解决方案必须支持的语言

*   .NET 2.0 + 3（对于它的价值 asp.net、vb.net 和 c#）
*   vba（访问）
*   数据库 (MSSQL 2000)

**编辑 2.0**加入很好，只是 'foo' 可能会根据请求更改为 'foobar'，我不想处理查询。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T09:50:57.753

如果要对表进行反规范化，只需将 LeadSource (Varchar) 列添加到 SalesLead 表，而不是使用 FK 或 ID。

另一方面，如果您的语言支持 ENUM 结构，则“幻数”应该安全地存储在枚举中，因此您可以：

```
SELECT * FROM SALESLEAD WHERE LeadSouce = (int) EnmLeadSource.Foo; //pseudocode 
```

你的代码会有一个

```
public enum EnmLeadSource 
{
   Foo = 1,
   Bar = 2
} 
```

如果这给您带来的麻烦比它所修复的更多，那么删除一些过度的规范化是可以的。但是，请记住，如果您使用 VARCHAR 字段（与幻数相反），您必须保持一致性，如果您需要多种语言或文化，以后可能很难本地化。

规范化之后的最佳方法似乎是使用枚举结构。它使代码保持干净，您始终可以跨方法和函数传递枚举。（我在这里假设.NET，但也使用其他语言）

**更新**：由于您使用的是 .NET，因此如果您通过代码构建查询，则 DB 后端是“无关紧要的”。想象一下这个函数：

```
public void GiveMeSalesLeadGiven( EnmLeadSource thisLeadSource )
{
  // Construct your string using the value of thisLeadSource 
} 
```

在表中，您将有一个 LeadSource (INT) 列。但是它有 1,2 或 N 的事实对你来说并不重要。如果您以后需要将 foo 更改为 foobar，这可能意味着：

1）所有“数字1”必须是数字“2”。您必须更新表格。2）或者您现在需要 Foo 为 2 号，Bar 为 1 号。您只需更改 Enum（但确保表值保持一致）。

如果使用得当，枚举是一个非常有用的结构。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-17T12:34:54.783

您是否考虑过不为`LeadSource`表使用人工键？然后，您可以在 中`LeadSource`用作 FK `SalesLead`，这可以简化您的查询，同时保留使用一组规范值（中的行`LeadSource`）的好处。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T09:47:57.883

您是否考虑过可更新的视图？根据您的数据库服务器和数据库设计的完整性，您将能够创建一个视图，当它的值发生变化时，它将依次更新组成表。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T09:51:17.890

我真的没有看到加入背后的问题。

当然，直接通过 FK_LeadSourceID 询问是错误的，但使用 JOIN 似乎是正确的方法，因为我可以很好地掩盖更改 ID。例如，如果“foo”在某一天变为 3（并且您更新了外键字段），那么您显示的最后一个查询仍将完全相同。

如果您想在不更改应用程序中当前查询的情况下更改架构，那么包含此连接的视图是可行的方法。

或者，如果您担心连接语法不直观，那么总会有子选择...

```
SELECT * FROM SalesLead where FK_LeadSourceID = 
         (SELECT LeadSourceID from LeadSource WHERE LeadSource = 'foo') 
```

但请记住在 LeadSource.LeadSource 上保留索引 - 至少如果您有很多它们存储在表中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T09:58:49.560

如果您通过引入新的关系/表来“改进设计”，那么您肯定会需要不同的实体。如果是这样，您将需要处理它们的语义。

在之前的解决方案中，您可以在适当的 SalesLead 行中将 LeadSource 名称更新为您想要的任何名称。如果您更新新结构中的名称，您将对所有 SalesLead 行执行此操作。

没有办法处理这些不同的语义。你只需要这样做。为了使表格更易于查询，您可以使用已经建议的视图，但我希望它们主要用于报告目的或向后兼容性，前提是它们不可更新，因为更新此视图的每个人都不会意识到更改的语义.

如果您不喜欢加入，请尝试 SELECT * FROM SalesLead where LeadSourceId IN (SELECT Id FROM LeadSource WHERE LeadSource = 'foo')

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T10:01:22.173

在典型的应用程序中，用户将看到一个潜在客户来源列表（通过查询 LeadSource 表返回），随后的 SalesLead 查询将由应用程序根据用户的选择动态创建。

您的应用程序似乎有一些您需要为其编写特定查询的“众所周知的”潜在客户来源。如果是这种情况，则向 LeadSource 表添加第三个（唯一）字段，其中包含一个不变的“名称”，您可以将其用作应用程序查询的基础。

这将魔术的负担从数据库生成的魔术数字（可能因安装而异）转移到系统定义的魔术名称（由设计固定）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T11:29:35.800

这里有一个错误的二分法。

```
SELECT * FROM SalesLead 
INNER JOIN LeadSource ON SalesLead.FK_LeadSourceID = LeadSource.LeadSourceId 
where LeadSource.LeadSource = "foo" 
```

不会比原来的更坏

```
SELECT * FROM SalesLead Where LeadSource = 'foo' 
```

当`foo`更改为`foobar`. 此外，如果您正在使用参数化查询（并且您确实应该这样做），则在`foo`更改为`foobar`.

# apache-flex - 使用 Flex RemoteObject 方法时如何设置 HTTP 标头？

> ID：81548
> 
> 赞同：4
> 
> 时间：2008-09-17T09:46:46.983
> 
> 标签：apache-flex, flash, http-headers, blazeds, remoteobject

我在服务器端运行 blazeds。我想使用 http 标头过滤 http 请求。我的目标是在不更改我的 blazeds 服务签名的情况下向服务器发送额外的参数。

在客户端，我使用 Flex **RemoteObject**方法。

使用 Flex WebService 组件，可以使用属性**httpHeaders**设置 http 标头。我在 RemoteObject 类上没有发现任何类似的东西......

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2015-04-03T17:34:08.970

这对我使用 BlazeDS 和 Spring-Flex 1.5.2 有效

**柔性：**

```
use namespace mx_internal;

var service:RemoteObject = new RemoteObject(destination);
var operation:Operation = service[functionName];
operation.asyncRequest.defaultHeaders  = {company:'company'};

var token:AsyncToken =  operation.send(); 
```

Java Spring-Flex：

```
public class FlexJavaCustomAdapter extends JavaAdapter{
    @Override
    public Object invoke(Message message) {
        String locale = (String) message.getHeader("com.foo.locale");   
        return super.invoke(message);
    }   
} 
```

**调度程序-servlet.xml**

```
<bean id="customAdapter" class="org.springframework.flex.core.ManageableComponentFactoryBean">
            <constructor-arg value="com.codefish.model.flex.FlexJavaCustomAdapter"/>
        </bean> 

        <flex:message-broker id="_messageBroker"  services-config-path="classpath*:/com/codefish/resources/spring/services-config.xml"  > 
              <flex:remoting-service default-adapter-id="customAdapter" 
            default-channels="my-amf, my-secure-amf" />
        </flex:message-broker>
</bean> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-07-05T08:55:25.177

我无法修改来自 flex 的 http 请求，而是可以将自定义标头添加到`mx.messaging.messages.IMessage`发送`RemoteObject`到服务器并在那里扩展`flex.messaging.services.remoting.adapters.JavaAdapter`（用于访问 Spring beans），读取标头参数并将它们放入 HTTPRequest 是可能的。

在 flex 部分，我必须扩展`mx.rpc.AsyncRequest`：声明一个新属性“header”并覆盖调用方法，该方法检查是否有一个非空值来设置 msg.headers。

和`mx.rpc.remoting.mxml.RemoteObject`：构造函数创建我们自定义 AsyncRequest 的新实例并覆盖旧实例，`AsyncRequest`它定义了一个`setHeaders`将参数设置为自定义的方法`AsyncRequest`。

`com.asfusion.mate.actions.builders.RemoteObjectInvoker`（额外：P）：这个读取在伴侣的地图中声明的参数`RemoteObjectInvoker`并放入`RemoteObject`标题中。

我希望它是可以理解的（用我的apache英语xDDD）

再见。阿古尔！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T12:44:37.820

RemoteObject 使用 AMF 作为数据通道，其管理方式与 HttpService 或 WebService（使用 Http）完全不同。您可以做的是调用`setCredentials(username,password)`，然后使用 FlexLoginCommand 在服务器端捕获它（您的容器的标准命令，或者您自己的）。查找`setCredentials`以及如何在双方（客户端和服务器）上处理此问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-01T08:22:53.693

我有类似的问题，恐怕在使用 AMF 时没有简单的方法来设置 HTTP 标头。但我设计了以下解决方案。

Flex 使用 HTTP 传输 AMF，但通过浏览器接口调用它，这允许您设置 cookie。仅在包含应用程序调用的文档中遵循 JavaScript

```
document.cookie="clientVersion=1.0;expires=2100-01-01;path=/"; 
```

浏览器应将其传输到服务器，您可以进行过滤（问题是用户是否会关闭 cookie）。

您可以从 Flex 调用更多的 JavaScript 函数（更多内容在这里： http://livedocs.adobe.com/flex/3/html/help.html?content= [passingarguments_4.html](http://livedocs.adobe.com/flex/3/html/help.html?content=passingarguments_4.html)）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-22T10:38:52.130

我也在考虑使用 http 标头的一个原因是服务器能够在服务版本控制的上下文中“识别”弹性客户端。在服务器上，我总是可以构建一个间接/代理，允许不同的客户端仅使用 1 个端点并根据客户端版本路由到正确的适配器。问题在客户端。服务器将如何识别 flex 客户端令牌或“版本”。一种方法当然是通过身份验证。但是，假设不涉及身份验证？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T09:56:56.397

您可能正在尝试重新发明轮子。您是否有不能使用标准 HTTP(s) 身份验证的原因？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-11-04T21:56:24.473

我们最近遇到了同样的问题，这就是我们在不创建子类的情况下添加自定义标题的方式：

```
var operation:AbstractOperation = _remoteSession.getOperation('myRemoteOperation');
var async:AsyncRequest = operation.mx_internal::asyncRequest;
async.defaultHeaders = {my_header:'my_value'}; 
```

AsyncRequest 对象实际上可以通过 mx_internal 命名空间的操作对象访问。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2013-03-12T20:08:21.863

您可以在 PHP 中调试 $GLOBALS 以查看它。我认为这是在

```
$GLOBALS['HTTP_RAW_POST_DATA']; 
```

或者你可以简单地做

```
file_get_contents('php://input'); 
```

# c# - 在 C# 中将值和键从一个字典复制到另一个字典的最快方法是什么？

> ID：81552
> 
> 赞同：29
> 
> 时间：2008-09-17T09:47:33.190
> 
> 标签：c#, dictionary, copy, foreach

似乎没有 dictionary.AddRange() 方法。有谁知道在不使用 foreach 循环的情况下将项目复制到另一个字典的更好方法。

我正在使用 System.Collections.Generic.Dictionary。这适用于 .NET 2.0。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-09-17T09:52:27.297

有一个`Dictionary`构造函数需要另一个`Dictionary`.

你必须强制转换它`IDictionary`，但是有一个`Add()`重载需要`KeyValuePair<TKey, TValue>`. 不过，您仍在使用 foreach。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-09-17T10:48:26.927

for/foreach 循环没有任何问题。无论如何，这都是假设的 AddRange 方法。

我唯一需要担心的是内存分配行为，因为添加大量条目可能会导致多次重新分配和重新散列。没有办法将现有字典的容量增加给定的数量。您最好为当前的两个字典分配一个具有足够容量的新字典，但您仍然需要一个循环来加载其中至少一个。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2017-08-09T14:15:36.790

```
var Animal = new Dictionary<string, string>(); 
```

可以将现有的动物字典传递给构造函数。

```
Dictionary<string, string> NewAnimals = new Dictionary<string, string>(Animal); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-17T15:14:08.270

为了好玩，我为字典创建了这个扩展方法。这应该尽可能地进行深层复制。

```
public static Dictionary<TKey, TValue> DeepCopy<TKey,TValue>(this Dictionary<TKey, TValue> dictionary)
        {
            Dictionary<TKey, TValue> d2 = new Dictionary<TKey, TValue>();

            bool keyIsCloneable = default(TKey) is ICloneable;
            bool valueIsCloneable = default(TValue) is ICloneable;

            foreach (KeyValuePair<TKey, TValue> kvp in dictionary)
            {
                TKey key = default(TKey);
                TValue value = default(TValue);
                if (keyIsCloneable)
                {
                    key = (TKey)((ICloneable)(kvp.Key)).Clone();
                }

                else
                {
                    key = kvp.Key;
                }

                if (valueIsCloneable)
                {
                    value = (TValue)((ICloneable)(kvp.Value)).Clone();
                }

                else
                {
                    value = kvp.Value;
                }

                d2.Add(key, value);
            }

            return d2;
        } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T09:57:54.863

如果您正在处理两个现有对象，您可能会使用 CopyTo 方法获得一些好处：http: [//msdn.microsoft.com/en-us/library/cc645053.aspx](http://msdn.microsoft.com/en-us/library/cc645053.aspx)

使用其他集合（接收者）的 Add 方法来吸收它们。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T09:58:53.850

我不明白，为什么不使用 Dictionary( Dictionary ) （如 ageektrapped 所建议的那样）。

您要执行浅拷贝还是深拷贝？（也就是说，两个字典都指向新字典中每个对象的相同引用或新副本？）

如果您想创建一个指向*新对象的**新*Dictionary ，我认为唯一的方法是通过**foreach**。

 **** * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-03-04T12:31:41.293

对于原始类型字典：

```
public void runIntDictionary()
{
    Dictionary<int, int> myIntegerDict = new Dictionary<int, int>() { { 0, 0 }, { 1, 1 }, { 2, 2 } };
    Dictionary<int, int> cloneIntegerDict = new Dictionary<int, int>();
    cloneIntegerDict = myIntegerDict.Select(x => x.Key).ToList().ToDictionary<int, int>(x => x, y => myIntegerDict[y]);
} 
```

或使用实现 ICloneable 的对象：

```
public void runObjectDictionary()
{
    Dictionary<int, number> myDict = new Dictionary<int, number>() { { 3, new number(3) }, { 4, new number(4) }, { 5, new number(5) } };
    Dictionary<int, number> cloneDict = new Dictionary<int, number>();
    cloneDict = myDict.Select(x => x.Key).ToList().ToDictionary<int, number>(x => x, y => myDict[y].Clone());
}

public class number : ICloneable
{
    public number()
    {
    }
    public number(int newNumber)
    {
        nr = newnumber;
    }
    public int nr;

    public object Clone()
    {
        return new number() { nr = nr };
    }
    public override string ToString()
    {
        return nr.ToString();
    }
} 
```

# ms-office - 使用参数启动 Infopath 表单

> ID：81556
> 
> 赞同：0
> 
> 时间：2008-09-17T09:48:21.220
> 
> 标签：ms-office, infopath

可以像这样打开带有参数的 Infopath 表单：

```
System.Diagnostics.Process.Start(PathToInfopath + "infopath.exe", "Template.xsn /InputParameters Id=123"); 
```

但这需要我知道 Infopath.exe 的路径，该路径会随 Office 的每个版本而变化。有没有办法简单地启动模板并传递参数？还是有一种标准方法可以找到 Infopath.exe 所在的位置？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-18T07:52:49.603

这是一篇关于查找 Office Apps 安装路径的文章：

[http://support.microsoft.com/kb/234788](http://support.microsoft.com/kb/234788)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T11:51:08.557

玩转 System.Diagnostics.ProcessStartInfo，它允许您指定要打开的文件，还允许您指定参数。

然后，您可以使用 Process.Start(ProcessStartInfo) 启动该过程。框架将根据 ProcessStartInfo 中指定的文件确定运行哪个应用程序。

我没有安装 Infopath，所以很遗憾无法尝试。但希望它对你有所帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-11T22:58:41.753

尝试使用基于浏览器的表单和查询字符串

# delphi - 防止在 Delphi 包中隐式导入单位

> ID：81557
> 
> 赞同：5
> 
> 时间：2008-09-17T09:49:20.033
> 
> 标签：delphi, compiler-construction, packages

有没有办法防止 Delphi 中的包隐式导入“包含”列表中未列出的单元？我正在寻找一个编译器指令，如果它试图进行隐式导入，它会使构建失败。

当您将一个包安装到隐式导入单元 A 的 IDE 中，然后您尝试安装另一个真正包含单元 A 的包并且 IDE 告诉您它无法安装该包时，会出现问题，因为单元 A 已经包含在第一个包中如果不应该！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-17T10:36:02.183

Delphi 2009 可以选择将警告变为失败。就让它失败而言，这将做你想做的事情。

为了防止隐式导入，您需要显式导入它，或删除隐式导入它的单元。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-08T10:14:56.993

如果您使用的 Delphi 版本早于 2009 年，您可以使用[DDevExtensions](http://andy.jgknet.de/blog/?page_id=10)（它是免费的）使警告导致错误。安装后，转到工具 > DDevExtensions - 选项并在“编译器增强”部分中选择“活动”复选框和“将警告视为错误”。您可以在下面的备忘录中添加您不希望被视为错误的警告。不幸的是，在您的情况下，您似乎只想将一个警告视为错误，因此您必须添加几乎所有警告，除了关于隐式导入到列表中的警告，尽管通常是很好的编码实践来解决无论如何，所有编译器警告，因此您可能只想让所有警告导致错误。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T10:42:39.330

没有办法将该警告变为错误。在 Delphi 2009 中，您可以将所有警告视为错误。

PS：这是Delphi for .Net的错误

# sql - 在运行时覆盖从无操作到级联的约束

> ID：81560
> 
> 赞同：0
> 
> 时间：2008-09-17T09:50:08.003
> 
> 标签：sql, constraints, cascade

我觉得我有一个非常基本/愚蠢的问题，但我从来没有看到/读过/听到这个方向的任何东西。

假设我有一个表*users(userId, name)*和一个表*首选项(id, userId, language)*。该示例很简单，但可以扩展到具有多级关系和更多表的情况。
当我的 UI 请求删除用户时，我首先想显示一个警告，说明其首选项也将被删除。如果在某个时候数据库扩展了更多的表和关系，但软件没有相应地调整（客户端没有更新），则应该显示一条通用消息。

我该如何实施？UI 不知道整个数据结构，也不应该费心去遍历所有关系来手动删除所有依赖记录。

我认为这将受到限制。
约束最初不会是*任何动作*，因此约束会抛出一个可以被 UI 捕获的错误。UI 收到确认后，约束应该变成*cascade*。

不知怎的，我觉得我把这一切都弄错了..

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T09:53:16.810

我要做的是：

1.  约束是 CASCADE
2.  应用程序检查首选项是否存在。
3.  如果他们这样做，请显示警告。
4.  如果不存在首选项，或者接受警告，请删除客户端。

动态更改数据库关系不是一个好主意！

干杯，

RB。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T10:06:09.820

如果您担心用户没有意识到他们删除的全部影响，您可能需要考虑不实际删除数据 - 相反，您可以简单地在名为“说”的列上设置一个标志`marked_for_deletion`。（然后可以在安全的时间后删除条目）
缺点是您需要记住过滤掉其他查询中的标记行。这可以通过在表上创建一个过滤掉标记行的视图来缓解，然后始终在查询中使用该视图。

# java - 你如何处理不同的 Java IDE 和 svn？

> ID：81567
> 
> 赞同：8
> 
> 时间：2008-09-17T09:51:09.937
> 
> 标签：java, eclipse, svn, ide, collaboration

您如何确保可以将代码签出到 Eclipse 或 NetBeans 中并在那里使用它？

编辑：如果您不签入与 ide 相关的文件，则每次签出项目时都必须重新配置构建路径、包含和所有这些内容。我不知道，如果 ant（尤其是从 eclipse 创建/导出的 ant 构建文件）将与另一个 ide 无缝协作。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-17T16:19:37.897

实际上，我们现在在 SVN 中为我们的代码维护了一个 Netbeans 和一个 Eclipse 项目，完全没有任何问题。Netbeans 文件不会踩到 Eclipse 文件。我们的项目结构如下：

```
sample-project   
+ bin
+ launches  
+ lib  
+ logs
+ nbproject  
+ src  
  + java
.classpath
.project
build.xml 
```

最大的点似乎是：

*   禁止任何 IDE 的项目文件中的任何绝对路径。
*   将项目文件设置为将类文件输出到同一目录。
*   svn：忽略 .nbproject 目录中的私有目录。
*   svn:ignore 用于从 IDE 和任何其他运行时生成的目录（如上面的日志目录）输出类文件的目录。
*   让人们始终使用这两种方法，以便快速解决差异。
*   还要维护一个独立于 IDE 的构建系统，例如巡航控制。
*   使用 UTF-8 并立即更正任何编码问题。

我们在 Fedora 9 32 位和 64 位、Vista 和 WindowsXP 上进行开发，大约一半的开发人员使用一种或另一种 IDE。少数人同时使用并定期来回切换。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-17T10:08:38.333

聪明的答案是“这样做”——除非你不使用多个 IDE，否则你不知道你是否真的准备好使用多个 IDE。诚实。:)

我一直认为多个平台更麻烦，因为它们可能使用不同的编码标准（例如，Windows 可能默认为 ISO-8859-1，Linux 可能默认为 UTF-8）——对我来说，编码比 IDE 引起的问题要多得多。

更多指针：

*   您可能想使用 Maven ( [http://maven.apache.org](http://maven.apache.org) )，让它生成 IDE 特定文件，并且永远不要将它们提交到源代码控制。
*   为了确保生成正确的人工制品，您应该有一个专用的服务器来构建您的可交付成果（例如 Cruisecontrol），或者借助 ant、maven 或任何其他工具。这些可交付成果是在开发机器之外进行测试的成果。让人们意识到在他们自己的机器之外还有另一个世界的好方法。
*   禁止在源代码管理中找到的任何 IDE 特定文件中包含任何机器特定路径。始终通过逻辑路径名引用外部库，最好包含它们的版本（如果你不使用 maven）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T09:53:41.613

最好的办法可能是*不*提交任何与 IDE 相关的文件（例如 Eclipse 的 .project），这样每个人都可以签出项目并按照自己的意愿做事。

话虽这么说，我猜大多数 IDE 都有自己的配置文件方案，所以也许你可以在没有任何冲突的情况下提交所有内容，但 imo 感觉很混乱。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T10:01:09.287

在大多数情况下，我同意 seldaek，但我也倾向于说，您至少应该提供一个文件，说明依赖项是什么、用于编译的 Java 版本等，以及 NetBeans 之外的任何其他内容/Eclipse 开发人员可能需要在他们的 IDE 中进行编译。

我们目前只使用 Eclipse，因此我们将所有 Eclipse .classpath .project 文件提交给 svn，我认为这是更好的解决方案，因为这样每个人都能够重现错误和不容易的东西，而不是对 IDE 细节感到厌烦。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T10:24:08.967

我的理念是构建应该使用“最小公分母”的方法来完成。源代码控制中的内容是构建所需的内容。虽然我专门使用 Eclipse 进行开发，但我的构建是在命令行中使用 ant 进行的。

关于源代码控制，我只从命令行签入对构建至关重要的文件。没有 Eclipse 文件。当我设置一台新的开发机器时（似乎一年两次），让 Eclipse 从一个 ant 构建文件导入项目需要一点努力，但没什么可怕的。（理论上，这对于其他 IDE 应该也是一样的，不是吗？他们必须能够从 ant 导入？）

我还记录了如何设置一个最低限度的构建环境。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T10:43:04.913

我使用 maven，只签入 pom 和源代码。
签出项目后，我运行 mvn eclipse:eclipse
我告诉 svn 忽略生成的 .project 等。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-18T01:31:16.477

这就是我所做的：

1.  仅在源代码控制中维护您的 ant 构建脚本和相关的类路径。类路径可以在 ant 脚本、属性文件中明确显示，也可以由 ivy 管理。
2.  编写一个 ant 目标以从 ant 类路径生成 Eclipse .classpath 文件
3.  Netbeans 将使用您的构建脚本和类路径，只需通过自由形式的项目对其进行配置即可。

这样您就可以获得独立于 IDE 的构建脚本和快乐的开发人员 :)

netbeans 网站上有一个关于如何做 3 的博客。但我现在找不到。我已经在我的网站上记录了如何执行上述操作 -[链接文本](http://www.bradmcevoy.com/ant_netbeans_eclipse.html "蚂蚁+Netbeans+Eclipse")（虽然又快又丑，对不起）

请注意，如果您使用的是 Ivy（一个好主意）和 eclipse，您可能会想使用 eclipse ivy 插件。我用过它，发现它非常糟糕而且不可靠。最好使用 2\. 以上。

# python - 用于 Python 的 IDE 是什么？

> ID：81584
> 
> 赞同：1026
> 
> 时间：2008-09-17T09:53:15.423
> 
> 标签：python, ide, editor

其他人使用哪些 IDE（“GUI/编辑器”）进行 Python 编码？

* * *

## 回答 #1

> 赞同：1292
> 
> 时间：2008-09-17T09:57:19.953

## 结果

[电子表格版本](https://docs.google.com/spreadsheets/d/1l3x94P55qoxqYbq5GosWQ7IonZ4vR-4ZyCaImiVmCSk/pubhtml)

[![电子表格屏幕截图](https://i.stack.imgur.com/Jrc6C.png)](https://docs.google.com/spreadsheets/d/1l3x94P55qoxqYbq5GosWQ7IonZ4vR-4ZyCaImiVmCSk/pubhtml)

或者，以纯文本形式：（也可作为[屏幕截图](https://i.stack.imgur.com/ItVKB.png)提供）

```
 Bracket Matching -.  .- Line Numbering
                          Smart Indent -.  |  |  .- UML Editing / Viewing
         Source Control Integration -.  |  |  |  |  .- Code Folding
                    Error Markup -.  |  |  |  |  |  |  .- Code Templates
  Integrated Python Debugging -.  |  |  |  |  |  |  |  |  .- Unit Testing
    Multi-Language Support -.  |  |  |  |  |  |  |  |  |  |  .- GUI Designer (Qt, Eric, etc)
   Auto Code Completion -.  |  |  |  |  |  |  |  |  |  |  |  |  .- Integrated DB Support
     Commercial/Free -.  |  |  |  |  |  |  |  |  |  |  |  |  |  |  .- Refactoring
   Cross Platform -.  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |     
                  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
Atom              |Y |F |Y |Y*|Y |Y |Y |Y |Y |Y |  |Y |Y |  |  |  |  |*many plugins
Editra            |Y |F |Y |Y |  |  |Y |Y |Y |Y |  |Y |  |  |  |  |  |
Emacs             |Y |F |Y |Y |Y |Y |Y |Y |Y |Y |Y |Y |Y |Y |  |  |  |
Eric Ide          |Y |F |Y |  |Y |Y |  |Y |  |Y |  |Y |  |Y |  |  |  |
Geany             |Y |F |Y*|Y |  |  |  |Y |Y |Y |  |Y |  |  |  |  |  |*very limited
Gedit             |Y |F |Y¹|Y |  |  |  |Y |Y |Y |  |  |Y²|  |  |  |  |¹with plugin; ²sort of
Idle              |Y |F |Y |  |Y |  |  |Y |Y |  |  |  |  |  |  |  |  |
IntelliJ          |Y |CF|Y |Y |Y |Y |Y |Y |Y |Y |Y |Y |Y |Y |Y |Y |Y |
JEdit             |Y |F |  |Y |  |  |  |  |Y |Y |  |Y |  |  |  |  |  |
KDevelop          |Y |F |Y*|Y |  |  |Y |Y |Y |Y |  |Y |  |  |  |  |  |*no type inference
Komodo            |Y |CF|Y |Y |Y |Y |Y |Y |Y |Y |  |Y |Y |Y |  |Y |  |
NetBeans*         |Y |F |Y |Y |Y |  |Y |Y |Y |Y |Y |Y |Y |Y |  |  |Y |*pre-v7.0
Notepad++         |W |F |Y |Y |  |Y*|Y*|Y*|Y |Y |  |Y |Y*|  |  |  |  |*with plugin
Pfaide            |W |C |Y |Y |  |  |  |Y |Y |Y |  |Y |Y |  |  |  |  |
PIDA              |LW|F |Y |Y |  |  |  |Y |Y |Y |  |Y |  |  |  |  |  |VIM based
PTVS              |W |F |Y |Y |Y |Y |Y |Y |Y |Y |  |Y |  |  |Y*|  |Y |*WPF bsed
PyCharm           |Y |CF|Y |Y*|Y |Y |Y |Y |Y |Y |Y |Y |Y |Y |Y |Y |Y |*JavaScript
PyDev (Eclipse)   |Y |F |Y |Y |Y |Y |Y |Y |Y |Y |Y |Y |Y |Y |  |  |  |
PyScripter        |W |F |Y |  |Y |Y |  |Y |Y |Y |  |Y |Y |Y |  |  |  |
PythonWin         |W |F |Y |  |Y |  |  |Y |Y |  |  |Y |  |  |  |  |  |
SciTE             |Y |F¹|  |Y |  |Y |  |Y |Y |Y |  |Y |Y |  |  |  |  |¹Mac version is
ScriptDev         |W |C |Y |Y |Y |Y |  |Y |Y |Y |  |Y |Y |  |  |  |  |    commercial
Spyder            |Y |F |Y |  |Y |Y |  |Y |Y |Y |  |  |  |  |  |  |  |
Sublime Text      |Y |CF|Y |Y |  |Y |Y |Y |Y |Y |  |Y |Y |Y*|  |  |  |extensible w/Python,
TextMate          |M |F |  |Y |  |  |Y |Y |Y |Y |  |Y |Y |  |  |  |  |    *PythonTestRunner
UliPad            |Y |F |Y |Y |Y |  |  |Y |Y |  |  |  |Y |Y |  |  |  |
Vim               |Y |F |Y |Y |Y |Y |Y |Y |Y |Y |  |Y |Y |Y |  |  |  |
Visual Studio     |W |CF|Y |Y |Y |Y |Y |Y |Y |Y |? |Y |? |? |Y |? |Y |
Visual Studio Code|Y |F |Y |Y |Y |Y |Y |Y |Y |Y |? |Y |? |? |? |? |Y |uses plugins
WingIde           |Y |C |Y |Y*|Y |Y |Y |Y |Y |Y |  |Y |Y |Y |  |  |  |*support for C
Zeus              |W |C |  |  |  |  |Y |Y |Y |Y |  |Y |Y |  |  |  |  |
                  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
   Cross Platform -'  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |     
     Commercial/Free -'  |  |  |  |  |  |  |  |  |  |  |  |  |  |  '- Refactoring
   Auto Code Completion -'  |  |  |  |  |  |  |  |  |  |  |  |  '- Integrated DB Support
    Multi-Language Support -'  |  |  |  |  |  |  |  |  |  |  '- GUI Designer (Qt, Eric, etc)
  Integrated Python Debugging -'  |  |  |  |  |  |  |  |  '- Unit Testing
                    Error Markup -'  |  |  |  |  |  |  '- Code Templates
         Source Control Integration -'  |  |  |  |  '- Code Folding
                          Smart Indent -'  |  |  '- UML Editing / Viewing
                         Bracket Matching -'  '- Line Numbering 
```

* * *

使用的缩写词：

```
 L  - Linux
 W  - Windows
 M  - Mac
 C  - Commercial
 F  - Free
 CF - Commercial with Free limited edition
 ?  - To be confirmed 
```

我没有提到语法高亮之类的基础知识，因为默认情况下我期望这些。

* * *

这是一份反映您的反馈和评论的干货清单，我不提倡使用任何这些工具。当您不断发布答案时，我将不断更新此列表。

***PS。您能帮我将上述编辑器的功能添加到列表中（如自动完成、调试等）吗？***

我们有一个关于这个问题的综合维基页面[https://wiki.python.org/moin/IntegratedDevelopmentEnvironments](https://wiki.python.org/moin/IntegratedDevelopmentEnvironments)

[提交对电子表格的编辑](https://docs.google.com/spreadsheets/d/1l3x94P55qoxqYbq5GosWQ7IonZ4vR-4ZyCaImiVmCSk/edit#gid=0&fvid=1960281650 "提交对电子表格的编辑")

# sql-server - 迁移现有应用程序以接受 Unicode

> ID：81587
> 
> 赞同：0
> 
> 时间：2008-09-17T09:53:31.990
> 
> 标签：sql-server, oracle, delphi, unicode, migration

我们正在将我们的应用程序升级到完全兼容 Unicode，因为我们最近获得了开箱即用的 Delphi 2009。我正在寻找任何有升级应用程序以接受 Unicode 字符的经验的人。具体回答以下任何问题。

*   我们需要将 VarChars 更改为 NVarchar，将 Char 更改为 NChar。这里有什么陷阱吗。
*   我们需要更新所有 sql 语句以在任何 sql 字符串前面包含 N。所以 Update tbl_Customer set Name = 'Smith' 必须变成 Update tbl_Customer set Name = **N** 'Smith' 。对于某些字段，有什么方法可以默认此设置。这似乎是非同寻常的，这仍然是必需的。
*   是否可以在 SQLServer 中设置任何默认值来简化此操作？

ps 我们还需要升级我们的Oracle代码

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T10:39:33.737

Oracle 不要求您使用`nvarchar`来存储 Unicode 字符串——服务器可以配置为`varchar2`以 UTF-8 存储。如果你之前只支持 ASCII，它应该是透明的。这应该可以防止对 to 的所有应用程序端搜索和替换的`'`需要`N'`。

至于 Damien 的观点：它现在可能对您没有帮助，但您确实应该优先考虑摆脱非参数化查询。从维护、性能和安全的角度来看，它们只会拖累您的系统。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T13:17:25.010

SQL Server 的明显限制是 nchar/nvarchar 的限制是其对应的 char/varchar 的一半（除非您将所有 > 4000 的内容迁移到 nvarchar(max)）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T10:02:50.127

达米安

我不确定你的答案有多大用处。我们有一个庞大的 700,000 行编译代码库，这些代码库是在过去十年中编写的，其中包含大量的 sql 查询。大多数都标准化为几个功能，这些功能是数据库上大多数更新的基础。这些可以很简单地更新。但是，我们还需要检查 CustomerName = '%s' 的每个 where 子句，现在应该是 CustomerName = N'%s'

这是一个真正的问题，需要一个真正的答案。

# sql - 如何在 Sql Server 2005 中清除连接

> ID：81589
> 
> 赞同：3
> 
> 时间：2008-09-17T09:53:51.457
> 
> 标签：sql, sql-server, sql-server-2005, performance

我的工作场所有销售人员使用直接连接 Sql Server 的 3rd 方桌面应用程序，该软件为每个用户留下数百个休眠连接。无论如何以编程方式清除这些连接？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T13:48:54.497

您运行哪个版本的 SQL Server？您可以编写一个存储过程来执行此操作，查看来自 sp_who 的数据，然后对最后一个活动进行一些猜测。有一个“LastBatch”列表示该用户最后一次提交的内容。我会说如果那超过一个小时（或任何时间间隔），请为该 SPID 执行 KILL。

您可以像这样在 SQL 2005 中执行此操作：

```
declare @spid int
   , @cmd varchar(200)
declare Mycurs cursor for
select spid
 from master..sysprocesses
 where status = 'sleeping'
 and last_batch > dateadd( s, -1, getdate())
open mycurs
fetch next from mycurs into @spid
while @@fetch_status = 0
 begin
  select @cmd = 'kill ' + cast(@spid as varchar)
  exec(@cmd )
  fetch next from mycurs into @spid
 end
deallocate MyCurs 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-01T12:46:23.327

但是，与其手动杀死这些进程，难道不应该有办法避免这些吗？我在一个项目中遇到了同样的问题

在我们的 Web 应用程序中，我们正在使用 Web 服务执行一些更新（即程序调用 Web 服务方法。该方法打开连接，执行更新，提交并使用 connection.close() 关闭连接）

在 sqlserver mgmt 工作室中，如果我执行 sp_who2，我会看到连接随着应用程序的运行而增加 - 事实上，每次更新执行的速度为 1 个连接。并且有关的部分是它越过 100，然后不允许更多连接到数据库。用户无法登录以及程序失败，因为他们无法获得更多新连接。

如何确保连接被重用——我们没有写任何连接池代码，使用默认的asp.net和Sqlserver连接池。为什么连接没有被重用，为什么它们在“关闭”后没有消失？这是否取决于 web 服务正在处理事务的事实？

非常感谢

# unix - 如何设置 sendmail 的触发器？

> ID：81591
> 
> 赞同：1
> 
> 时间：2008-09-17T09:54:38.820
> 
> 标签：unix, sendmail

如果我的电子邮件 ID 收到来自特定发件人的电子邮件，我可以要求 sendmail 触发不同的程序并将新到达的电子邮件传递给它以进行进一步处理吗？这类似于 gmail 中的过滤器。等待一些电子邮件到达，看看它是否符合标准，如果符合，请采取一些措施。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T09:58:57.857

这就是 Procmail 的用途。

将 Sendmail 设置为使用 procmail 作为邮件传递代理 (MDA)，或设置您的 .forward 以通过 procmail 传输内容。（参见手册页。）

然后你可以写你的 .procmailrc 来做这些事情。

此过滤器早于 gmail。如果您正在运行邮件服务器，它仍然很有用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T11:15:05.617

好的。然后我建议使用 Colins 方法。我使用 cron 监控电子邮件（针对特定域）并发送短信作为警报！和你问的一样！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T09:58:37.640

我们通过在邮件服务器上运行一个 cron 进程来处理这个问题，该进程监视收件箱目录并每 10 分钟左右扫描任何新消息（文件）。

当进程找到感兴趣的电子邮件时，它会将信息发送到另一个进程，然后该进程对新消息做出反应（在我们的例子中，从收件箱中删除该消息）。

- 编辑 -

查找电子邮件收件箱取决于您的实施 - 检查“手册”您的 sendmail 版本以获取详细信息 - 我们将传入的电子邮件定向到特殊目录或使用参数来计算收件箱详细信息。我觉得更具体一点没有用，因为“收件箱在哪里”的答案是“视情况而定”。

至于要搜索的模式 - 我们将电子邮件消息（文本文件）解码为我们可以操作的 DOM。例如，我们可以在属性“subject”中查找特定的词。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T09:58:40.183

你在谈论电子邮件客户端吗？如果是这样，那么您可以在 Outlook 中设置规则，我相信其他电子邮件客户端也必须有方法！如果你问别的。对不起

# .net - 删除未使用的引用（！=“使用”）

> ID：81597
> 
> 赞同：100
> 
> 时间：2008-09-17T09:55:41.283
> 
> 标签：.net, visual-studio, reference

如何在我的项目中查找和删除未使用的引用？

我知道您可以轻松删除 vs 2008 中的 using 语句，但这不会删除您项目中的实际引用。引用的 dll 仍将复制到您的 bin/setup 包中。

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2009-09-05T08:19:33.100

*注意：有关此答案的另一个版本，请参阅[http://www.jetbrains.net/devnet/message/5244658](http://www.jetbrains.net/devnet/message/5244658)。

通读帖子，似乎对原始问题有些困惑。让我试一试。

原始帖子实际上是在问一个问题：“我如何识别和删除一个 Visual Studio 项目对其他未使用的项目/程序集的引用？” 发帖人希望程序集不再作为构建输出的一部分出现。

在这种情况下，ReSharper 可以帮助您*识别*它们，但您必须自己*删除*它们。

为此，打开解决方案浏览器中的引用，右键单击每个引用的程序集，然后选择“查找相关代码”。看：

[http://www.jetbrains.com/resharper/features/navigation_search.html#Find_ReferencedDependent_Code](http://www.jetbrains.com/resharper/features/navigation_search.html#Find_ReferencedDependent_Code)

您将获得：

1.  浏览器窗口中该引用的依赖项列表，或

2.  一个对话框告诉您“未找到依赖于模块 XXXXXXX 的代码。”。

如果你得到第二个结果，你可以右击引用，选择移除，然后从你的项目中移除它。

虽然您必须“手动”执行此操作，即一次引用一个，但它会完成工作。如果有人以某种方式将其自动化，我有兴趣了解它是如何完成的。

您几乎可以忽略 .Net 框架中的那些，因为它们通常不会被复制到您的构建输出中（通常 - 尽管对于 Silverlight 应用程序不一定如此）。

有些帖子似乎在回答这个问题：“如何从源代码文件中删除不需要解析该文件中的任何引用的 using 子句 (C#)”。

在这种情况下，ReSharper 确实可以通过以下几种方式提供帮助：

1.  在动态错误检测期间为您识别未使用的 using 子句。它们显示为代码检查警告 - 代码将在文件中显示为灰色（默认情况下），ReSharper 将提供删除它的提示：

    [http://www.jetbrains.com/resharper/features/code_analysis.html#On-the-fly_Error_Detection](http://www.jetbrains.com/resharper/features/code_analysis.html#On-the-fly_Error_Detection)

2.  允许您在代码清理过程中自动删除它们：

    [http://www.jetbrains.com/resharper/features/code_formatting.html#Optimizing_Namespace_Import_Directives](http://www.jetbrains.com/resharper/features/code_formatting.html#Optimizing_Namespace_Import_Directives)

**最后，意识到 ReSharper 会对您的解决方案进行静态代码分析。因此，如果您有对程序集的动态引用——比如通过反射或在运行时动态加载并通过接口访问的程序集——它不会拾取它。** 在您处理项目时，没有什么可以替代了解您的代码库和项目依赖项。我确实发现 ReSharper 功能非常有用。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2011-05-11T08:39:20.350

您可以使用我写的“**删除未使用的引用**”扩展名：

[http://visualstudiogallery.msdn.microsoft.com/9811e528-cfa8-4fe7-9dd1-4021978b5097](http://visualstudiogallery.msdn.microsoft.com/9811e528-cfa8-4fe7-9dd1-4021978b5097)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-11-13T13:58:20.313

删除未使用的引用是 Visual Studio 2008 已经支持的功能。不幸的是，仅适用于 VB .NET 项目。

我已经在 Microsoft Connect 上提出了一项建议，以便为 C# 项目获取此功能：

[http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=510326](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=510326)

如果你也喜欢这个功能，那么你可以投票给我的建议。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-02-06T01:38:20.633

试试这个：[参考助手](http://visualstudiogallery.msdn.microsoft.com/fc504cc6-5808-4da8-ae86-8d3f9ed81606)

> 概括
> 
> Reference Assistant 有助于从 Visual Studio 2010 中的 C#、F#、VB.NET 或 VC++/CLI 项目中删除未使用的引用。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-17T09:57:31.807

[ReSharper](https://www.jetbrains.com/resharper/)将为您执行此操作（还有更多！）

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2011-11-15T09:17:52.143

ReSharper 6.1 将包括以下功能：

*   **优化引用**：分析您的程序集引用及其在代码中的用法，获取冗余引用列表并将其删除。

*   **删除未使用的引用**：快速重构以删除多余的程序集引用。

*   **程序集引用上的安全删除**：如果所有程序集引用都是冗余的，则将删除它们，否则会显示用法并且只能删除所选列表的冗余程序集引用。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2012-10-28T10:29:17.323

我在 VS 2010 Ultimate Architecture->Generate Dependency Graph->By Assembly 中没有扩展就完成了这项工作，它显示了使用的程序集，并手动删除了未使用的引用。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2015-08-26T17:06:05.687

我有一个适用于任何版本的 Visual Studio 和任何框架版本的免费答案。它不会删除未使用的引用，但会识别它们。

您可以在项目 dll 上使用[Telerik JustDecompile 。](http://www.telerik.com/products/decompiler.aspx)只需在 JustDecompile 中打开 dll 并进入下`References`查看编译后的 dll 中实际使用了什么。

[![在此处输入图像描述](https://i.stack.imgur.com/Lc9BT.png)](https://i.stack.imgur.com/Lc9BT.png)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-23T07:21:07.197

鉴于 VisualStudio（或者它是 msbuild？）检测到未使用的引用并且不将它们包含在输出文件中，您可以编写一个脚本来解析 csproj 中的引用，并将其与通过反射检测到的引用程序集进行比较项目输出。

如果你有动力...

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-12-08T18:44:11.400

我认为这是在 bin\ 中复制的，因为在删除引用的项目中，引用了具有相同引用的其他项目...

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-12-18T12:22:24.923

如果您知道哪些参考未被使用，您可以手动删除它们。
在解决方案资源管理器中，右键单击“引用”节点中的*引用*，然后单击“删除”。

# shell - Microsoft sort.exe 是否能够对 unicode UTF-16 (LE) 文件进行排序？

> ID：81617
> 
> 赞同：1
> 
> 时间：2008-09-17T09:58:06.160
> 
> 标签：shell, sorting, command-line

Microsoft sort.exe 5.1.2600.0 (xpclient.010817-1148) 是否能够对 UTF-16 (LE) 文件进行排序？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T11:25:42.300

sort.exe 有许多限制，使其难以使用。例如，虽然 sort.exe 似乎可以正常读取 UTF-16 (LE) 文件，但它似乎使用当前区域设置输出文件。

# qt - 如何隐藏/删除“？” Qt对话框的“标题栏”上的帮助按钮？

> ID：81627
> 
> 赞同：92
> 
> 时间：2008-09-17T09:59:16.327
> 
> 标签：qt, qt4, qdialog

我在我的一个应用程序中使用 Qt 对话框。我需要隐藏/删除帮助按钮。但我无法找到我得到他帮助按钮的句柄的确切位置。不确定它是否是 Qt 窗口上的特定标志。

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2015-06-19T09:43:47.120

```
// remove question mark from the title bar
setWindowFlags(windowFlags() & ~Qt::WindowContextHelpButtonHint); 
```

* * *

## 回答 #2

> 赞同：69
> 
> 时间：2008-09-17T10:44:00.527

默认情况下，*Qt::WindowContextHelpButtonHint*标志被添加到对话框中。您可以使用对话框构造函数的*WindowFlags*参数来控制它。

例如，您可以通过执行以下操作仅指定*TitleHint*和*SystemMenu*标志：

```
QDialog *d = new QDialog(0, Qt::WindowSystemMenuHint | Qt::WindowTitleHint);
d->exec(); 
```

如果您添加*Qt::WindowContextHelpButtonHint*标志，您将获得帮助按钮。

在 PyQt 中，您可以执行以下操作：

```
from PyQt4 import QtGui, QtCore
app = QtGui.QApplication([])
d = QtGui.QDialog(None, QtCore.Qt.WindowSystemMenuHint | QtCore.Qt.WindowTitleHint)
d.exec_() 
```

有关窗口标志的更多详细信息可以在 Qt 文档中的[WindowType 枚举中找到。](https://doc.qt.io/qt-5.7/qt.html#WindowType-enum)

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2018-04-18T17:46:24.630

从 Qt 5.10 开始，您可以使用单个`QApplication`属性全局禁用这些按钮！

```
QApplication::setAttribute(Qt::AA_DisableWindowContextHelpButton); 
```

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2008-09-17T11:53:13.713

好的，我找到了一种方法来做到这一点。

它确实处理窗口标志。所以这是我使用的代码：

```
Qt::WindowFlags flags = windowFlags()

Qt::WindowFlags helpFlag =
Qt::WindowContextHelpButtonHint;

flags = flags & (~helpFlag);   
setWindowFlags(flags); 
```

但是这样做有时会重置对话框的图标。因此，要确保对话框的图标不会改变，您可以添加两行。

```
QIcon icon = windowIcon();

Qt::WindowFlags flags = windowFlags();

Qt::WindowFlags helpFlag =
Qt::WindowContextHelpButtonHint;

flags = flags & (~helpFlag);   

setWindowFlags(flags);

setWindowIcon(icon); 
```

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2014-02-26T11:07:14.530

我在 Windows 7、Qt 5.2 中遇到了这个问题，最适合我的标志组合是：

**Qt::WindowTitleHint | Qt::WindowCloseButtonHint**

这给了我一个工作关闭按钮，但没有问号帮助按钮。仅使用 Qt::WindowTitleHint 或 Qt::WindowSystemMenuHint 摆脱了帮助按钮，但它也禁用了关闭按钮。

正如 Michael Bishop 所建议的那样，正是在使用 windowflags 示例导致我进行了这种组合。谢谢！

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-12-11T02:15:27.417

此处列出的答案将起作用，但要自己回答，我建议您运行示例程序`$QTDIR/examples/widgets/windowflags`。这将允许您测试窗口标志的所有配置及其效果。对于找出 squirrelly windowflags 问题非常有用。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2017-08-29T12:34:29.593

默认情况下，可以使用以下方法为应用程序中的所有对话框删除问号：

将以下事件过滤器附加到`QApplication`程序开头的某个位置：

```
 bool eventFilter (QObject *watched, QEvent *event) override
  {
    if (event->type () == QEvent::Create)
      {
        if (watched->isWidgetType ())
          {
            auto w = static_cast<QWidget *> (watched);
            w->setWindowFlags (w->windowFlags () & (~Qt::WindowContextHelpButtonHint));
          }
      }
    return QObject::eventFilter (watched, event);
  } 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-09-28T22:12:13.997

我找不到插槽，但您可以覆盖虚拟`winEvent`功能。

```
#if defined(Q_WS_WIN)
bool MyWizard::winEvent(MSG * msg, long * result)
{
    switch (msg->message)
    {
    case WM_NCLBUTTONDOWN:
        if (msg->wParam == HTHELP)
        {

        }
        break;
    default:
        break;
    }
    return QWizard::winEvent(msg, result);
}
#endif 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-12-23T21:17:42.770

由于来自@amos 的 PyQt4 解决方案对我不起作用并且 PyQt4 的版本已被弃用，这是我关于如何删除“？”的解决方案。在 PyQt5 的对话框中：

```
class window(QDialog):
    def __init__(self):
        super(window, self).__init__()
        loadUi("window.ui", self)
        self.setWindowFlag(QtCore.Qt.WindowContextHelpButtonHint,False)  # This removes it 
```

# asp.net - 构建基于查询字符串的单选按钮值

> ID：81628
> 
> 赞同：0
> 
> 时间：2008-09-17T09:59:30.757
> 
> 标签：asp.net, vb.net

我想根据从 5 组单选按钮中获取的值构建一个查询字符串。

选择任何组是可选的，因此您可以选择集合 A 或 B 或两者。我将如何基于此构建查询字符串？我正在使用 VB.NET 1.1

asp:Radiobuttonlist 控件不喜欢空值，所以我使用普通的 html 单选按钮。我的问题是如何将选定的值串入查询字符串

我现在有这样的事情：

HTML：

```
<input type="radio" name="apBoat" id="Apb1" value="1" /> detail1
<input type="radio" name="apBoat" id="Apb2" value="2" /> detail2

<input type="radio" name="cBoat" id="Cb1" value="1" /> detail1
<input type="radio" name="cBoat" id="Cb2" value="2" /> detail2 
```

VB.NET

```
Public Sub btnSubmit_click(ByVal sender As Object, ByVal e As System.EventArgs)
  Dim queryString As String = "nextpage.aspx?"

  Dim aBoat, bBoat, cBoat bas String

  aBoat = "apb=" & Request("aBoat")
  bBoat = "bBoat=" & Request("bBoat")
  cBoat = "cBoat=" & Request("cBoat ")

  queryString += aBoat & bBoat & cBoat

  Response.Redirect(queryString)

End Sub 
```

这是构建查询字符串的最佳方式还是我应该完全采用不同的方法？感谢我能得到的所有帮助。非常感谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T10:12:18.997

最简单的方法是使用带有 method="get" 的非服务器端 <form> 标记，然后在提交表单时，您将自动获取您所追求的查询字符串（并且不要忘记添加 <label>标签并将它们与您的单选按钮相关联）：

```
<form action="..." method="get">
    <input type="radio" name="apBoat" id="Apb1" value="1" /> <label for="Apb1">detail1</label>
    <input type="radio" name="apBoat" id="Apb2" value="2" /> <label for="Apb2">detail2</label>

    <input type="radio" name="cBoat" id="Cb1" value="1" /> <label for="Cb1">detail1</label>
    <input type="radio" name="cBoat" id="Cb2" value="2" /> <label for="Cb2">detail2</label>
</form> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T10:09:03.357

您可以使用 StringBuilder 而不是创建这三个不同的字符串。您可以通过预先分配存储字符串所需的内存量来帮助它。您也可以使用 String.Format 代替。

如果这就是您的提交按钮所做的一切，为什么要让它成为一个 .Net 页面，而只是让一个 GET 表单转到 nextpage.aspx 进行处理？

# apache - .htaccess mod 重写 301-redirect

> ID：81631
> 
> 赞同：0
> 
> 时间：2008-09-17T09:59:39.150
> 
> 标签：apache, .htaccess, mod-rewrite

我想要：所有不包含文件名（不是 .html、.jpg、.png、.css）的链接都以状态 301 重定向到目录，例如： http: [//mysite.com/article](http://mysite.com/article) -> [http://mysite。 com/article/](http://mysite.com/article/) 但[http://mysite.com/article/article-15.html](http://mysite.com/article/article-15.html)不重定向。我必须向 .htaccess 写入什么规则表达式才能将斜杠添加到虚拟目录？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T10:19:52.130

我认为以下可能有效：

```
RewriteEngine on   
RewriteCond %{REQUEST_URI} ^/[^\.]+[^/]$
RewriteRule ^(.*)$ http://%{HTTP_HOST}/$1/ [R=301,L] 
```

说到 mod_rewrite 我永远无法确定没有测试......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T10:02:38.113

需要澄清：

给定网址： [http://server/path/file](http://server/path/file)

是否被重定向到： [http://server/path/](http://server/path/)

还是被重定向到： [http://server/path/file/](http://server/path/file/)

如：您希望重定向转到父路径，还是只想添加一个斜杠并假设当前路径之外的目录？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-10T23:03:44.570

上面 MB 的 RewriteRule 将在路径上失败，`/a`因为它需要在斜杠后匹配至少两个字符。此外，它仅匹配顶级目录 URL。

```
RewriteRule ^(([^\/]+\/)*[^\/\.]+)$ http://%{HTTP_HOST}/$1/ [R=301,L] 
```

这样做的目的是为了减少历史污染/假阴性吗？

# vb.net - 如何从xml文件中获取元素

> ID：81635
> 
> 赞同：-1
> 
> 时间：2008-09-17T10:00:28.603
> 
> 标签：vb.net, web-services, xpath, reference

我从 Web 服务获得一个 XML 文件。现在我想从文件中取出这些元素之一。

我想我应该使用 XPath - 有什么好的入门参考吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T10:12:37.933

我刚刚恢复了我的 XPath 技能 - 这个[Xslt 和 XPath 快速参考表](http://www.mulberrytech.com/quickref/)是一个非常有用的参考 - 它没有深入，但它确实列出了可用的内容以及您可能想要搜索的更多信息。

之前链接的 w3schools 教程并不是那么好——它需要很长时间才能涵盖很多内容——但它仍然值得一读。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T10:01:24.140

不是 VB 特定的，但试试这个：[http ://www.w3schools.com/xsl/xpath_intro.asp](http://www.w3schools.com/xsl/xpath_intro.asp)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T10:02:35.510

一种方法是仅将带有 xslt 文件的所需信息提取到新的 xml 中，并将此新 xml 用作进一步处理的数据基础

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T12:07:02.963

如果我需要做一些 XPath，我只需调整其中一个示例。

*   **child::node()**选择上下文节点的所有子节点，无论它们的节点类型如何
*   **attribute::name**选择上下文节点的名称属性
*   **attribute::***选择上下文节点的所有属性
*   **descendant::para**选择上下文节点的 para 元素后代
*   **祖先::div**选择上下文节点的所有**div祖先**
*   **ancest-or-self::div**选择上下文节点的**div**祖先，如果上下文节点是 div 元素，则上下文节点也是如此
*   **descendant-or-self::para**选择上下文节点的**para**元素后代，如果上下文节点是**para**元素，则上下文节点也是
*   **self::para**如果是**para**元素则选择上下文节点，否则不选择任何内容
*   **child::chapter/descendant::para**选择上下文节点的 chapter 元素子元素的**para元素后代**
*   **child::*/child::para**选择上下文节点的所有**para**孙子
*   **/**选择文档根（始终是文档元素的父级）
*   **/descendant::para**选择同一文档中的所有**para元素作为上下文节点**
*   **/descendant::olist/child::item**选择具有**olist**父级且与上下文节点位于同一文档中的所有 item 元素
*   **child::para[position()=1]**选择上下文节点的第一个**para**子节点
*   **child::para[position()=last()]**选择上下文节点的最后一个**para**子节点
*   **child::para[position()=last()-1]**选择上下文节点的最后一个**para**子节点
*   **child::para[position()>1]**选择上下文节点的所有**para**子节点，除了上下文节点的第一个 para 子节点
*   **following-sibling::chapter[position()=1]**选择上下文节点的下一个**章节兄弟**
*   **previous -sibling::chapter[position()=1]**选择上下文节点的上一个**章节兄弟**
*   **/descendant::figure[position()=42]**选择文档中第 40 秒的图形元素
*   **/child::doc/child::chapter[position()=5]/child::section[position()=2]选择****doc**文档元素第五**章**的第二节
***   **child::para[attribute::type="warning"]**选择上下文节点的所有**para**子节点，它们的 type 属性带有值**warning***   **child::para[attribute::type='warning'][position()=5]**选择上下文节点的第五个**para**子节点，该节点的 type 属性值为 warning*   **child::para[position()=5][attribute::type="warning"]**选择上下文节点的第五个**para**子节点，如果该子节点的 type 属性具有值**warning***   **child::chapter[child::title='Introduction']**选择具有一个或多个标题子项且字符串值等于 Introduction 的上下文节点的章节子项*   **child::chapter[child::title]**选择具有一个或多个标题子项的上下文节点的**章节子项***   **child::*[self::chapter or self::appendix]**选择上下文节点的**章节**和**附录**子节点*   **child::*[self::chapter or self::appendix][position()=last()]**选择上下文节点的最后一个**章节**或**附录**子节点**

 **可以在[此处](http://www.w3.org/TR/xpath)找到深入的文档。这些示例也取自那里。

# c++ - 如何在 C++ 中超时 mysql++ 查询

> ID：81644
> 
> 赞同：6
> 
> 时间：2008-09-17T10:02:24.463
> 
> 标签：c++, mysql

我正在使用 mysql++ 连接到 MySQL 数据库以执行一堆数据查询。由于我正在读取的表不断被写入，并且我需要一致的数据视图，我首先锁定表。但是，MySQL 在其锁定查询中没有“NOWAIT”的概念，因此如果表被其他东西锁定了很长时间，我的应用程序就会坐在那里等待。我想要它做的是能够返回并说“无法获得锁定”之类的内容，然后在几秒钟内重试。我对此超时的一般尝试如下。

如果我在锁定数据库上的表后运行它，我会收到超时命中的消息，但我不知道如何让 mysql_query 行终止。我将不胜感激任何帮助/想法！

```
 volatile sig_atomic_t success = 1;

void catch_alarm(int sig) {
        cout << "Timeout reached" << endl;
        success = 0;
        signal(sig,catch_alarm);
}

// connect to db etc.
// *SNIP

signal (SIGALRM, catch_alarm);
alarm(2);
mysql_query(p_connection,"LOCK TABLES XYZ as write"); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T17:24:07.463

您可以通过这种方式实现“类似取消”的行为：

您在单独的线程上执行查询，无论是否发生超时，该线程都会继续运行。超时发生在主线程上，并将变量设置为“1”，标记它发生了。然后你在你的主线程上做任何你想做的事情。

查询线程在查询完成后检查是否发生超时。如果没有，它会做它需要做的其余工作。如果它有，它只是解锁它刚刚锁定的表。

我知道这听起来有点浪费，但是锁定解锁周期应该基本上是瞬时的，并且您尽可能接近您想要的结果。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-18T17:10:09.623

我不知道这在资源使用和“最佳实践”和“清洁度”以及所有其他方面是否是一个好主意......但你现在已经反复描述了在重新架构方面束缚你的手铐“清洁”系统......所以这里......

你能打开一个新的、单独的连接来发送 LOCK 语句吗？然后当您捕获超时警报时关闭该连接？通过关闭/销毁专用于 LOCK 语句的连接，这不会本质上“取消” LOCK 语句吗？我不确定是否会像我所描述/猜测的那样发生此类事件，但也许需要测试一下。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-18T16:16:14.010

正如我所说，当这是一个实时的生产系统时，“切换”或重新架构并不是那么容易。我对 MySQL 没有提供检查锁或选择不挂起等待锁的方法感到有点沮丧。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-19T14:28:25.063

到目前为止，我所描述的经验向我表明，关闭正在运行查询的连接会导致段错误。因此，将该查询分派到不同的连接并没有真正的帮助，因为这也会出现段错误。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T10:52:43.547

如果我从头开始编写，我会这样做，但这是一个服务器应用程序，我们只是对其进行升级而不是进行大规模返工。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T14:15:41.640

与其尝试使用表锁来伪造事务，不如切换到获得实际事务的 innodb 表？只需确保将默认事务隔离级别设置为 REPEATABLE READ。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T10:05:50.947

您可以在不同的线程中执行阻塞查询，并且永远不会被超时所困扰。当一些数据到达时，您通知需要了解事务状态的线程。

# c++ - 在哪里可以找到当前的 C 或 C++ 标准文档？

> ID：81656
> 
> 赞同：394
> 
> 时间：2008-09-17T10:04:04.663
> 
> 标签：c++, c, standards, c++-faq

对于许多问题，答案似乎可以在“标准”中找到。但是，我们在哪里可以找到呢？最好是在线的。

谷歌搜索有时会让人感到徒劳，尤其是对于 C 标准，因为它们被编程论坛上的大量讨论淹没了。

为了开始这个，因为这些是我现在正在搜索的，哪里有好的在线资源：

*   C89
*   C99
*   C11
*   C++98
*   C++03
*   C++11
*   C++14
*   C++17

* * *

## 回答 #1

> 赞同：514
> 
> 时间：2008-09-17T14:23:17.037

### 标准的 PDF 版本

截至~~2014 年~~9 月 1 日 2021 年 9 月，PDF 中官方 C 和 C++ 标准文档的最佳价格位置似乎是：

*   C++20 – ISO/IEC 14882:2020：[198 瑞士法郎（约 217 美元），来自 iso.org](https://www.iso.org/standard/79358.html)

*   C++17 – ISO/IEC 14882:2017：[新西兰标准协会 90 新西兰元（约 65 美元）](https://www.standards.govt.nz/shop/isoiec-148822017/)

*   C++14 – ISO/IEC 14882:2014：[新西兰标准协会 90 新西兰元（约 65 美元）](https://www.standards.govt.nz/shop/isoiec-148822014/)

*   C++11 – ISO/IEC 14882-2011：[ansi.org 60 美元](https://webstore.ansi.org/Standards/INCITS/INCITSISOIEC148822012)或[Techstreet 60 美元](https://www.techstreet.com/standards/incits-iso-iec-14882-2011-2012?product_id=1852925)

*   C++03 – INCITS/ISO/IEC 14882:2003：[来自 ansi.org 的 30 美元](https://webstore.ansi.org/standards/incits/incitsisoiec148822003)

*   C++98 – ISO/IEC 14882:1998：[新西兰标准局 80 新西兰元（约 60 美元）](https://www.standards.govt.nz/shop/asnzs-148821999/)

*   C17/C18 – INCITS/ISO/IEC 9899:2018：从 2017 年 11 月[的 INCITS/ANSI](https://webstore.ansi.org/Standards/INCITS/INCITSISOIEC989920182019) / [N2176/c17_updated_proposed_fdis.pdf 草案中获得](http://www.open-std.org/jtc1/sc22/wg14/www/abq/c17_updated_proposed_fdis.pdf)116 美元（链接断开，请参阅[Wayback Machine N2176](https://web.archive.org/web/20181230041359if_/http://www.open-std.org/jtc1/sc22/wg14/www/abq/c17_updated_proposed_fdis.pdf)）

*   C11 – ISO/IEC 9899:2011：[~~30~~美元 60 美元，来自 ansi.org](https://webstore.ansi.org/Standards/INCITS/INCITSISOIEC989920112012) / [WG14 草案版本 N1570](http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1570.pdf)

*   C99 – INCITS/ISO/IEC 9899-1999(R2005)：[60 美元，来自 ansi.org](https://webstore.ansi.org/Standards/INCITS/INCITSISOIEC98991999R2005) / [WG14 草案版本 N1256](http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1256.pdf)

*   C90 – ISO/IEC 9899:1990：[新西兰标准协会 90 新西兰元（约 65 美元）](https://www.standards.govt.nz/shop/isoiec-98991990/)

### 标准的非 PDF 电子版本

***警告：标准草案的大多数副本以 PDF 格式发布，如果文本/HTML 是从 PDF 转录或自动生成的，则可能会引入错误。***

*   C89 – ANSI 文本格式的草稿版本：（[https://web.archive.org/web/20161223125339/http://flash-gordon.me.uk/ansi.c.txt](https://web.archive.org/web/20161223125339/http://flash-gordon.me.uk/ansi.c.txt)）
*   C89 – HTML 文档的草稿版本：( [http://port70.net/~nsz/c/c89/c89-draft.html](http://port70.net/%7Ensz/c/c89/c89-draft.html) )
*   C90 TC1；ISO/IEC 9899 TCOR1，单页 HTML 文档：( [http://www.open-std.org/jtc1/sc22/wg14/www/docs/tc1.htm](http://www.open-std.org/jtc1/sc22/wg14/www/docs/tc1.htm) )
*   C90 TC2；ISO/IEC 9899 TCOR2，单页 HTML 文档：( [http://www.open-std.org/jtc1/sc22/wg14/www/docs/tc2.htm](http://www.open-std.org/jtc1/sc22/wg14/www/docs/tc2.htm) )
*   C99 – 草案版本 (N1256) 作为 HTML 文档： ( [http://port70.net/~nsz/c/c99/n1256.html](http://port70.net/%7Ensz/c/c99/n1256.html) )
*   C11 – 草案版本 (N1570) 作为 HTML 文档：( [http://port70.net/~nsz/c/c11/n1570.html](http://port70.net/%7Ensz/c/c11/n1570.html) )
*   C++11 – 工作草案 (N3337) 作为纯文本文档：( [http://port70.net/~nsz/c/c%2B%2B/c%2B%2B11_n3337.txt](http://port70.net/%7Ensz/c/c%2B%2B/c%2B%2B11_n3337.txt) )

*（托管 C++11 工作草案纯文本版本的站点也有一些这种格式的 C++14 草案。但它们都不是最终工作草案 N4140 的副本。）*

### 标准的印刷版本

标准的印刷副本可从国家标准机构和[ISO](https://www.iso.org/home.html)获得，但非常昂贵。

如果您想要一份 C90 标准的硬拷贝，而且价格比上面要少得多，您可以在[Amazon上找到](https://rads.stackoverflow.com/amzn/click/com/0078819520)[Herb Schildt](http://www.catb.org/jargon/html/B/bullschildt.html)的书[*The Annotated ANSI Standard*](http://www.davros.org/c/schildt.html)的廉价二手副本，其中包含标准的实际文本（有用）和对该标准的评论（不太有用 - 它包含几个危险和误导性的错误）。

C99 和 C++03 标准可从 Wiley 和 BSI（英国标准协会）以书本形式获得：

*   亚马逊上的[C++03 标准](https://rads.stackoverflow.com/amzn/click/com/0470846747)
*   亚马逊上的[C99 标准](https://rads.stackoverflow.com/amzn/click/com/0470845732)

### 标准委员会草案版本（免费）

未来标准的工作草案通常可从委员会网站获得：

*   [C++ 委员会网站](http://www.open-std.org/jtc1/sc22/wg21/)
*   [C委员会网站](http://www.open-std.org/jtc1/sc22/wg14/)

如果您想从当前或更早的 C/C++ 标准中获取草稿，可以在 Internet 上免费获得一些：

### 对于 C：

*   ANSI X3.159-198 (C89)：我找不到 C89 的 PDF，但它与 C90 几乎相同。唯一的主要区别在于样板和章节编号，尽管有一些细微的文本差异

*   ISO/IEC 9899:1990 (C90)：（与 ANSI X3.159-198 (C89) 几乎相同，只是前文和章节编号除外。第 6.5.7 节（之前的 3.5.7）至少有一处文字差异，其中*“a list”*变成*了“a括号括起来的list”*。请注意，ANSI和ISO/IEC标准之间的转换见于本文档中，文档将其名称称为“ANSI/ISO: 9899/99”，尽管这不是后来制定的标准的正确名称，正确名称是“ISO/IEC 9899:1990”）

*   C90 的 TC1：[http ://www.open-std.org/jtc1/sc22/wg14/www/docs/n423.pdf](http://www.open-std.org/jtc1/sc22/wg14/www/docs/n423.pdf)

*   [遗憾的是， WG14 网站](http://www.open-std.org/jtc1/sc22/wg14/www/wg14_document_log.htm)上没有 TC2 的 PDF 链接。

*   ISO/IEC 9899:1999（包含所有三个技术勘误的 C99）： [http ://www.open-std.org/jtc1/sc22/wg14/www/docs/n1256.pdf](http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1256.pdf)

*   仅包含 TC1 和 TC2 的 C99 早期版本： [http ://www.open-std.org/jtc1/sc22/wg14/www/docs/n1124.pdf](http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1124.pdf)

*   原始（即勘误前）C99 的工作草案：[http](http://www.open-std.org/jtc1/sc22/wg14/www/docs/n843.htm) ://www.open-std.org/jtc1/sc22/wg14/www/docs/n843.htm (HTML) 和[http://www.dkuug。 dk/JTC1/SC22/WG14/www/docs/n843.pdf](http://www.dkuug.dk/JTC1/SC22/WG14/www/docs/n843.pdf) (PDF)。请注意，后来有两个工作草案：N869 和 N878，但它们似乎已从 WG14 网站上删除，因此这是可用的最新版本。

*   C89/C90 和 C99 之间的变化列表：http: [//port70.net/~nsz/c/c89/c9x_changes.html](http://port70.net/%7Ensz/c/c89/c9x_changes.html)

*   C99 的 TC1（只有 TC，不是包含它的标准）：[http ://www.open-std.org/jtc1/sc22/wg14/www/docs/9899tc1/n32071.PDF](http://www.open-std.org/jtc1/sc22/wg14/www/docs/9899tc1/n32071.PDF)

*   C99 的 TC2（只有 TC，不是包含它的标准）：[http ://www.open-std.org/jtc1/sc22/wg14/www/docs/9899-1999_cor_2-2004.pdf](http://www.open-std.org/jtc1/sc22/wg14/www/docs/9899-1999_cor_2-2004.pdf)

*   ISO/IEC 9899:2011 (C11)： [http ://www.open-std.org/jtc1/sc22/wg14/www/docs/n1570.pdf](http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1570.pdf)

    有关 N1570 与 C11 最终发布版本之间差异的信息，请参阅 C11 中的[最新更改](https://stackoverflow.com/questions/8631228/latest-changes-in-c11/15737472#15737472)和[https://groups.google.com/g/comp.std.c/c/v5hsWOu5vSw](https://groups.google.com/g/comp.std.c/c/v5hsWOu5vSw)

*   ISO/IEC 9899:2011/Cor 1:2012（C11 唯一的技术勘误）：可在[https://www.iso.org/obp/ui/#iso:std:iso-iec:9899:ed-查看3:v1:cor:1:v1:en](https://www.iso.org/obp/ui/#iso:std:iso-iec:9899:ed-3:v1:cor:1:v1:en)但无法下载。这是实际的更正，而不是草稿。

*   ISO/IEC 9899:2018 (C17/C18)： [https://web.archive.org/web/20181230041359if_/http://www.open-std.org/jtc1/sc22/wg14/www/abq/c17_updated_proposed_fdis。 pdf](https://web.archive.org/web/20181230041359if_/http://www.open-std.org/jtc1/sc22/wg14/www/abq/c17_updated_proposed_fdis.pdf) (N2176)

*   C2x 正在进行的工作 - 截至 2020 年 10 月 18 日的最新工作草案 (N2731)： [http ://www.open-std.org/JTC1/SC22/WG14/www/docs/n2731.pdf](http://www.open-std.org/JTC1/SC22/WG14/www/docs/n2731.pdf)

### 对于 C++：

*   ISO/IEC 14882:1998 (C++98)： [http ://www.lirmm.fr/~ducour/Doc-objets/ISO+IEC+14882-1998.pdf](http://www.lirmm.fr/%7Educour/Doc-objets/ISO+IEC+14882-1998.pdf)

*   ISO/IEC 14882:2003 (C++03)： [https ://cs.nyu.edu/courses/fall11/CSCI-GA.2110-003/documents/c++2003std.pdf](https://cs.nyu.edu/courses/fall11/CSCI-GA.2110-003/documents/c++2003std.pdf)

*   ISO/IEC 14882:2011 (C++11)： [http ://www.open-std.org/jtc1/sc22/wg21/docs/papers/2012/n3337.pdf](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2012/n3337.pdf)

*   ISO/IEC 14882:2014 (C++14)： [https ://github.com/cplusplus/draft/blob/master/papers/n4140.pdf?raw=true](https://github.com/cplusplus/draft/blob/master/papers/n4140.pdf?raw=true)

*   ISO/IEC 14882:2017 (C++17)： [http ://www.open-std.org/jtc1/sc22/wg21/docs/papers/2017/n4659.pdf](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2017/n4659.pdf)

*   ISO/IEC 14882:2020 (C++20)：[https ://isocpp.org/files/papers/N4860.pdf](https://isocpp.org/files/papers/N4860.pdf)

*   ISO/IEC 14882:2023（C++23 正在进行中。工作草案日期为 2021 年 3 月 17 日）： http: [//open-std.org/JTC1/SC22/WG21/docs/papers/2021/n4885.pdf](http://open-std.org/JTC1/SC22/WG21/docs/papers/2021/n4885.pdf)

请注意，这些文件与标准不同，尽管在决定标准的会议之前的版本通常非常接近最终标准中的版本。FCD（最终委员会草案）版本受密码保护；您需要加入标准委员会才能获得它们。

尽管草稿版本可能与标准的最终批准版本非常接近，但本文的一些编辑强烈建议您获取实际文档的副本——特别是如果您打算引用它们作为参考。当然，如果现金拮据，饥饿的学生应该继续使用汇票。

* * *

看来，如果您愿意并且能够在标准批准后等待几个月，那么在寻找标准时搜索“INCITS/ISO/IEC”而不是“ISO/IEC”是关键。通过这样做，本文的一位编辑能够以合理的价格找到 C11 和 C++11 标准。例如，如果您在[webstore.ansi.org](https://webstore.ansi.org)上搜索“INCITS/ISO/IEC 9899:2011”而不是“ISO/IEC 9899:2011”，您会找到价格合理的 PDF 版本。

* * *

站点[https://wg21.link/](https://wg21.link/)提供 C++ 当前工作草案和标准草案以及委员会文件的短 URL 链接：

*   [https://wg21.link/std11](https://wg21.link/std11) - C++11
*   [https://wg21.link/std14](https://wg21.link/std14) - C++14
*   [https://wg21.link/std17](https://wg21.link/std17) - C++17
*   [https://wg21.link/std20](https://wg21.link/std20) - C++20
*   [https://wg21.link/std](https://wg21.link/std) - 当前工作草案

* * *

该标准的当前草案在[Github](https://github.com/cplusplus/draft)上作为 LaTeX 源维护。可以使用[cxxdraft-htmlgen](https://github.com/Eelis/cxxdraft-htmlgen)将这些源转换为 HTML 。以下站点维护这样生成的 HTML 页面：

*   Tim Song -[当前工作草案](https://timsong-cpp.github.io/cppwp/)- [C++11](https://timsong-cpp.github.io/cppwp/n3337/) - [C++14](https://timsong-cpp.github.io/cppwp/n4140/) - [C++17](https://timsong-cpp.github.io/cppwp/n4659/) - [C++20](https://timsong-cpp.github.io/cppwp/n4861/)
*   Eelis -[当前工作草案](http://eel.is/c++draft/)

[Tim Song](https://github.com/timsong-cpp/cppwp)还维护生成的 HTML 和 PDF 版本的 Networking TS 和 Ranges TS。

### C 标准的 POSIX 扩展

[POSIX](https://en.wikipedia.org/wiki/POSIX)标准 (IEEE 1003.1) 要求兼容的操作系统包含 C 编译器。该编译器又必须符合 C 标准，并且还必须支持 POSIX 的“系统接口”部分中定义的各种扩展（例如`off_t`数据类型、`<aio.h>`标头、`clock_gettime()`函数和`_POSIX_C_SOURCE`宏。）

因此，如果您尝试查找特定函数，被告知“此函数是 POSIX 的一部分，而不是 C 标准”，并想知道为什么操作系统标准要求编译器功能和语言扩展......现在你知道了！

*   POSIX.1-2001：系统接口部分可以作为单独的文档从[https://mirror.math.princeton.edu/pub/oldlinux/download/c951.pdf](https://mirror.math.princeton.edu/pub/oldlinux/download/c951.pdf)下载。第 1.7 节指出 C 标准的相关版本是 C99。

    “Shell 和实用程序”部分 ( [https://mirror.math.princeton.edu/pub/oldlinux/download/c952.pdf](https://mirror.math.princeton.edu/pub/oldlinux/download/c952.pdf) ) 要求不仅应该存在符合 C99 的编译器，而且应该可以从名为“c99”的命令行。实现这一点的一种方法是在 /usr/bin 中放置一个名为“c99”的 shell 脚本，该脚本调用 gcc 并将`-std=c99`选项添加到命令行参数列表中，并阻止指定任何竞争标准。

    POSIX.1-2001 有两份技术勘误，一份日期为 2002 年，另一份日期为 2004 年。我认为它们没有包含在上面链接的文件中。[在https://pubs.opengroup.org/onlinepubs/009695399/](https://pubs.opengroup.org/onlinepubs/009695399/)有一个包含更正的在线 HTML 版本- 但我应该补充一点，我的搜索框遇到了一些问题，因此使用谷歌搜索该网站可能是你的最好的选择。

    有一个付费链接可以在[https://standards.ieee.org/standard/1003_1-2001-Cor1-2002.html](https://standards.ieee.org/standard/1003_1-2001-Cor1-2002.html)下载第一个勘误。

    在[https://standards.ieee.org/standard/1003_1-2001-Cor2-2004.html上还有第二个付费链接](https://standards.ieee.org/standard/1003_1-2001-Cor2-2004.html)

*   [在http://www.open-std.org/jtc1/sc22/open/n4217.pdf](http://www.open-std.org/jtc1/sc22/open/n4217.pdf)有 POSIX.1-2008 的草稿版本。

    POSIX.1-2008 也有两个技术更正，后者的日期是 2016 年。在[https://pubs.opengroup.org/onlinepubs/9699919799.2016edition/](https://pubs.opengroup.org/onlinepubs/9699919799.2016edition/)上有一个包含更正的标准的在线 HTML 版本- 虽然，我也遇到过网站自己的搜索框不适合查找信息的情况。

*   [在https://pubs.opengroup.org/onlinepubs/9699919799/](https://pubs.opengroup.org/onlinepubs/9699919799/)上有一个 POSIX.1-2017 的在线 HTML 版本- 不过，我再次建议使用 Google 而不是该站点的搜索框。根据[Open Group 网站](https://www.opengroup.org/austin/)， “IEEE 1003.1-2017 ... 是对 1003.1-2008 标准的修订，以汇总该标准，包括其两个技术勘误（原样）”。[Linux 联机帮助页](https://man7.org/linux/man-pages/man7/standards.7.html)将其描述为与应用了 Technical Corrigenda 1 和 2 的 POSIX.1-2008 “技术上相同”。因此，这不是重大修订，也不会更改`_POSIX_C_SOURCE`宏的值。

* * *

## 回答 #2

> 赞同：451
> 
> 时间：2011-01-11T02:02:48.263

可以找到该标准的在线版本：

### 工作草案，编程语言 C++ 标准

***以下所有标准草案版本***：
以下所有内容均可免费下载
2021-06-18： [N4892](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/n4892.pdf)
2021-03-17： [N4885](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/n4885.pdf)
2020-12-15： [N4878](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2020/n4878.pdf)
2020-10-18： [N4868](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2020/n4868.pdf)
2020-04-08： [N4861](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2020/n4861.pdf)

***这是 C++20 标准：***
此版本需要身份验证
2020-04-08： [N4860](http://www.open-std.org/jtc1/sc22/wg21/prot/14882fdis/n4860.pdf)

***以下所有标准草案版本***：
以下所有内容均可免费下载
（其中许多可在此[主要 GitHub 链接上](https://github.com/cplusplus/draft/tree/master/papers)找到）
2020-01-14： [N4849](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2020/n4849.pdf)
2019-11-27： [N4842](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2019/n4842.pdf)
2019-10-08： [N4835](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2019/n4835.pdf) [git](https://github.com/cplusplus/draft/blob/master/papers/n4835.pdf)
2019-08-15 [: N4830](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2019/n4830.pdf) [git](https://github.com/cplusplus/draft/blob/master/papers//n4830.pdf) 2019-06-17:
N4820 [git](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2019/n4820.pdf) [2019-03-15](https://github.com/cplusplus/draft/blob/master/papers/n4820.pdf) : [N4810](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2019/n4810.pdf) [git 2019-01-21:](https://github.com/cplusplus/draft/blob/master/papers/n4810.pdf) [N4800](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2019/n4800.pdf) [git](https://github.com/cplusplus/draft/blob/master/papers/n4800.pdf) 2018-11-26: [N4791](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/n4791.pdf) [git](https://github.com/cplusplus/draft/blob/master/papers/n4791.pdf) 2018-10-08: [N4778](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/n4778.pdf) [git](https://github.com/cplusplus/draft/blob/master/papers/n4778.pdf) 2018- 07-07： [N4762](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/n4762.pdf)[混帐](https://github.com/cplusplus/draft/blob/master/papers/n4762.pdf) 2018-05-07： [N4750](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/n4750.pdf)[混帐](https://github.com/cplusplus/draft/blob/master/papers/n4750.pdf)

2018-04-02 ：[N4741](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/n4741.pdf) [混帐](https://github.com/cplusplus/draft/blob/master/papers/n4741.pdf)
2018-02-12 ：[N4727](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/n4727.pdf) [混帐](https://github.com/cplusplus/draft/blob/master/papers/n4727.pdf)
2017-11-27：[N4713](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2017/n4713.pdf) [混帐](https://github.com/cplusplus/draft/blob/master/papers/n4713.pdf)
2017-10-16：[N4700](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2017/n4700.pdf) [混帐](https://github.com/cplusplus/draft/blob/master/papers/n4700.pdf)
2017-07-30：[N4687](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2017/n4687.pdf) [混帐](https://github.com/cplusplus/draft/blob/master/papers/n4687.pdf)

***这是旧的 C++17 标准：***
此版本需要身份验证
2017-03-21： [N4660](http://www.open-std.org/jtc1/sc22/wg21/prot/14882fdis/n4660.pdf)

***以下所有标准草案版本***：
以下所有内容均可免费下载
2017-03-21： [N4659](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2017/n4659.pdf) [git](https://github.com/cplusplus/draft/blob/master/papers/n4659.pdf)
2017-02-06： [N4640](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2017/n4640.pdf) [git](https://github.com/cplusplus/draft/blob/master/papers/n4640.pdf)
2016-11-28： [N4618](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/n4618.pdf) [git](https://github.com/cplusplus/draft/blob/master/papers/n4618.pdf)
2016-07-12： [N4606](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/n4606.pdf) [git](https://github.com/cplusplus/draft/blob/master/papers/n4606.pdf)
2016-05 -30： [N4594](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/n4594.pdf) [混帐](https://github.com/cplusplus/draft/blob/master/papers/n4594.pdf)
2016-03-19： [N4582](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/n4582.pdf) [混帐](https://github.com/cplusplus/draft/blob/master/papers/n4582.pdf)
2015-11-09： [N4567](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2015/n4567.pdf) [混帐](https://github.com/cplusplus/draft/blob/master/papers/n4567.pdf)
2015-05-22： [N4527](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2015/n4527.pdf) [混帐](https://github.com/cplusplus/draft/blob/master/papers/n4527.pdf)
2015-04-10： [N4431](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2015/n4431.pdf) [混帐](https://github.com/cplusplus/draft/blob/master/papers/n4431.pdf)
2014-11-19： [N4296](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2014/n4296.pdf) [混帐](https://github.com/cplusplus/draft/blob/master/papers/n4296.pdf)

***这是旧的 C++14 标准***：
这些版本需要身份验证
2014-10-07： [N4140](http://www.open-std.org/jtc1/sc22/wg21/prot/14882fdis/n4140.pdf) [git](https://github.com/cplusplus/draft/blob/master/papers/n4140.pdf)本质上是 C++14，有小错误和拼写错误更正
2014-09-02： [N4141](http://www.open-std.org/jtc1/sc22/wg21/prot/14882fdis/n4141.pdf) [git](https://github.com/cplusplus/draft/tree/n4141) Standard C++14
2014-03- 02: [N3937](http://www.open-std.org/jtc1/sc22/wg21/prot/14882fdis/n3937.pdf)
2014-03-02: [N3936](http://www.open-std.org/jtc1/sc22/wg21/prot/14882fdis/n3936.pdf) [git](https://github.com/cplusplus/draft/blob/b7b8ed08ba4c111ad03e13e8524a1b746cb74ec6/papers/N3936.pdf)

***以下所有标准草案版本***：
以下所有内容均可免费下载
2013-10-13： [N3797](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3797.pdf) [git](https://github.com/cplusplus/draft/blob/master/papers/N3797.pdf)
2013-05-16： [N3691](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3691.pdf)
2013-05-15： [N3690](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3690.pdf)
2012-11-02： [N3485](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2012/n3485.pdf)
2012-02-28： [N3376](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2012/n3376.pdf)
2012-01-16： [N3337](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2012/n3337.pdf) [git](https://github.com/cplusplus/draft/tree/n3337)本质上是 C++11，有小错误和错别字已更正

***这是旧的 C++11 标准***：
此版本需要身份验证
2011-04-05： [N3291](http://www.open-std.org/Jtc1/sc22/wg21/prot/14882fdis/n3291.pdf)

***以下所有标准草案版本***：
以下所有内容均可免费下载
2011-02-28： [N3242](http://www.open-std.org/Jtc1/sc22/wg21/docs/papers/2011/n3242.pdf) （与 N3291 的差异非常小）
2010-11-27： [N3225](http://www.open-std.org/Jtc1/sc22/wg21/docs/papers/2010/n3225.pdf)
2010-08-21： [N3126](http://www.open-std.org/Jtc1/sc22/wg21/docs/papers/2010/n3126.pdf)
2010-03-29： [N3090](http://www.open-std.org/Jtc1/sc22/wg21/docs/papers/2010/n3090.pdf)
2010-02-16： [N3035](http://www.open-std.org/Jtc1/sc22/wg21/docs/papers/2010/n3035.pdf)
2009-11-09： [N3000](http://www.open-std.org/Jtc1/sc22/wg21/docs/papers/2009/n3000.pdf)
2009-09-25： [N2960](http://www.open-std.org/Jtc1/sc22/wg21/docs/papers/2009/n2960.pdf)
2009-06-22： [N2914](http://www.open-std.org/Jtc1/sc22/wg21/docs/papers/2009/n2914.pdf)
2009-03-23： [N2857](http://www.open-std.org/Jtc1/sc22/wg21/docs/papers/2009/n2857.pdf)
2008-10-04： [N2798](http://www.open-std.org/Jtc1/sc22/wg21/docs/papers/2008/n2798.pdf)
2008-08-25： [N2723](http://www.open-std.org/Jtc1/sc22/wg21/docs/papers/2008/n2723.pdf)
2008 -06-27： [N2691](http://www.open-std.org/Jtc1/sc22/wg21/docs/papers/2008/n2691.pdf)
2008-05-19： [N2606](http://www.open-std.org/Jtc1/sc22/wg21/docs/papers/2008/n2606.pdf)
2008-03-17： [N2588](http://www.open-std.org/Jtc1/sc22/wg21/docs/papers/2008/n2588.pdf)
2008-02-04： [N2521](http://www.open-std.org/Jtc1/sc22/wg21/docs/papers/2008/n2521.pdf)
2007-10-22：[N2461](http://www.open-std.org/Jtc1/sc22/wg21/docs/papers/2007/n2461.pdf)
2007-08-06：[N2369](http://www.open-std.org/Jtc1/sc22/wg21/docs/papers/2007/n2369.pdf)
2007-06-25：[N2315](http://www.open-std.org/Jtc1/sc22/wg21/docs/papers/2007/n2315.pdf)
2007-05-07：[N2284](http://www.open-std.org/Jtc1/sc22/wg21/docs/papers/2007/n2284.pdf)
2006-11-03：[N2134](http://www.open-std.org/Jtc1/sc22/wg21/docs/papers/2006/n2134.pdf)
2006-04-21：[N2009](http://www.open-std.org/Jtc1/sc22/wg21/docs/papers/2006/n2009.pdf)
2005-10-19：[N1905](http://www.open-std.org/Jtc1/sc22/wg21/docs/papers/2005/n1905.pdf)
2005 -04-27：[N1804](http://www.open-std.org/Jtc1/sc22/wg21/docs/papers/2005/n1804.pdf)

**这是旧的 C++03 标准：**
以下所有版本都需要身份验证
2004-11-05：[N1733](http://www.open-std.org/Jtc1/sc22/wg21/prot/14882fdis/n1733.pdf)
2004-07-16：[N1655](http://www.open-std.org/Jtc1/sc22/wg21/prot/14882fdis/n1655.pdf)非官方
2004-02-07：[N1577](http://www.open-std.org/Jtc1/sc22/wg21/prot/14882fdis/n1577.pdf) C++03（或非常接近）
2001-09 -13：[N1316](http://www.open-std.org/Jtc1/sc22/wg21/docs/papers/2001/n1316)扩展技术勘误
草案 1997-00-00：N1117 扩展技术勘误草案

***以下所有标准草案版本***：
以下所有内容均可免费下载
1996-00-00： [N0836](http://www.open-std.org/Jtc1/sc22/wg21/docs/papers/1996/N0836.pdf) Draft Expanded Technical Corrigendum
1995-00-00：N0785 Working Paper for Draft Proposed International Standard for Information Systems - Programming Language C++

### 其他有趣的论文：

[2022](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/) / [2021](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/) / [2020](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2020/) / [2019](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2019/) / [2018](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/) / [2017](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2017/) / [2016](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/) / [2015](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2015/) / [2014](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2014/) / [2013](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/) / [2012](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2012/) / [2011](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2011/)

* * *

## 回答 #3

> 赞同：64
> 
> 时间：2008-09-17T15:33:15.840

C99[可在线获得](http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1256.pdf)。引自[www.open-std.org](http://www.open-std.org/jtc1/sc22/wg14/www/standards.html#9899)：

> 该标准的最新公开版本是 C99 + TC1 + TC2 + TC3 的组合，[WG14 N1256](http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1256.pdf)，日期为 2007-09-07。这是一份 WG14 工作文件，但它反映了发布时的综合标准。

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2012-05-05T18:53:45.543

**草稿链接：**

C++11（+编辑修复）：N3337 [HTML](https://timsong-cpp.github.io/cppwp/n3337/) , [PDF](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2012/n3337.pdf)

C++14（+编辑修复）：N4140 [HTML](https://timsong-cpp.github.io/cppwp/n4140/) , [PDF](https://timsong-cpp.github.io/cppwp/n4140/draft.pdf)

C11 [N1570](http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1570.pdf)（[正文](http://www.iso-9899.info/n1570.html)）

C99 [N1256](http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1256.pdf)

> [标准草案](http://clc-wiki.net/wiki/c_standard#Drafts)在批准和出版之前分发以征求意见。
> 
> [请注意](http://herbsutter.com/2010/03/03/where-can-you-get-the-iso-c-standard-and-what-does-open-standard-mean/)，工作草案不是当前有效的标准，也不完全是已发布的标准

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-09-17T10:57:08.700

您可能会发现C++0x的[国际标准草案很有用。](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2010/n3225.pdf)

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2008-09-17T10:10:45.490

ISO 标准需要花钱，从中等（PDF 版本）到更多（书籍版本）。

然而，虽然它们尚未最终确定，但它们通常可以在网上找到，作为草稿。大多数情况下，最终版本与最终草案没有太大区别，因此虽然不完美，但它们会很好地适应。

*   [C++ 0x 草案](http://www.justsoftwaresolutions.co.uk/cplusplus/new-cplusplus-draft-and-concurrency-papers.html)

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-09-17T13:57:52.667

Wiley 提供了 C99 和 C++03 标准的书本形式：

*   [亚马逊上的 C++ 标准](https://rads.stackoverflow.com/amzn/click/com/0470846747)
*   [亚马逊上的 C 标准](https://rads.stackoverflow.com/amzn/click/com/0470845732)

另外，如前所述，未来标准的工作草案通常可从委员会网站获得：

*   [C++ 委员会网站](http://www.open-std.org/jtc1/sc22/wg21/)
*   [C委员会网站](http://www.open-std.org/jtc1/sc22/wg14/)

C-201x 草案以[N1336](http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1336.pdf)形式提供，C++0x 草案以[N3225 形式提供](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2010/n3225.pdf)。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2013-08-16T21:52:02.307

[ANSI C 标准（又名 C.89）的草案](http://www.bsb.me.uk/ansi-c/ansi-c-one-file)文本可在线获取。这在被 ISO C 标准 (C.90) 接受之前由 ANSI 委员会标准化，因此各部分的编号不同（ANSI 部分 2 到 4 大致对应于 ISO 部分 5 到 7），尽管内容是（假设to be) 大体相同。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-17T10:18:04.537

ISO C 和 C++ 标准非常昂贵。另一方面，INCITS 以更少的价格重新发布它们。[http://www.techstreet.com/](http://www.techstreet.com/)似乎有 30 美元的 PDF（搜索 INCITS/ISO/IEC 14882:2003）。

也提供硬拷贝版本。查找由 Wiley 出版的英国标准协会版本。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-17T15:38:42.003

实际的标准文件可能不是最有用的。大多数编译器没有完全实现这些标准，有时实际上可能会发生冲突。因此，您已经拥有的编译器文档将更加有用。此外，文档将包含特定于平台的备注和任何警告说明。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2014-12-08T13:36:48.893

虽然不是一个实际标准，但 ISO C (C89/90) 有一个修订，称为 C94/95 或规范附录 1。它被集成到 C99 中，尽管一些编译器（如[Clang](http://clang.llvm.org/docs/UsersManual.html) ）允许您`-std=c94`在命令行上指定。ISO/IEC 9899:1990/Amd 1:1995 可以从[**SAI GLOBAL**](http://infostore.saiglobal.com/store/Details.aspx?DocN=isoc000767513)以高价购买（PDF 或硬拷贝）。

*   [http://clc-wiki.net/wiki/The_C_Standard](http://clc-wiki.net/wiki/The_C_Standard)

可以在[此处](http://www.lysator.liu.se/c/na1.html)找到该文档的摘要。

> 当（当时的草案）ANSI C 标准在 1990 年被考虑采用国际标准时，有几个反对意见，因为它没有解决国际化问题。由于该标准已经制定了几年，因此同意进行一些更改以提供基础（例如，增加了第 7.10.7 条中的功能），并将单独开展工作以提供标准的适当国际化。这项工作在规范性附录 1 中达到高潮。
> 
> 规范性附录 1 体现了 C 对国际字符集的限制和承诺的反应。Digraphs 和 header 旨在改善以 ISO 646 的国家变体编写的 C 程序的外观，没有例如 { 或 } 字符。另一方面，这些设施连接到旧标准的勉强基础并将其扩展为一套完整且一致的实用程序，用于处理宽字符和多字节字符串。
> 
> 本文档总结了规范性附录 1。旨在快速告知已经熟悉该标准的读者；它没有也不能介绍 NA1 背后的复杂主题，也不能代替原始文档作为参考手册。（尽管如此，它试图尽可能准确，其作者希望了解任何错误或遗漏。）

*   [http://www.lysator.liu.se/c/na1.html](http://www.lysator.liu.se/c/na1.html)

# sql - 移动 psql 数据库的最有效方法

> ID：81657
> 
> 赞同：0
> 
> 时间：2008-09-17T10:04:07.067
> 
> 标签：sql, pg-dump

将 postgresSQL 数据库的内容通过管道传输到压缩的 tar 文件中，然后复制到另一台机器的最有效、最安全的方法是什么？

这将用于 localhosting 开发，或备份到远程服务器，在两端使用基于 *nix 的机器。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T10:09:07.100

[这个页面](http://www.cyberciti.biz/faq/how-to-back-up-a-web-server/)有一个完整的网络服务器备份脚本，包括 pg_dump 输出。

这是它使用的语法：

```
BACKUP="/backup/$NOW"
PFILE="$(hostname).$(date +'%T').pg.sql.gz"
PGSQLUSER="vivek"
PGDUMP="/usr/bin/pg_dump"

$PGDUMP -x -D -U${PGSQLUSER} | $GZIP -c > ${BACKUP}/${PFILE} 
```

gzip 压缩后，您可以根据您的网络和服务，使用[scp](http://en.wikipedia.org/wiki/Secure_copy)、[rsync](http://en.wikipedia.org/wiki/Rsync)或[nfs将其传输到另一台服务器。](http://en.wikipedia.org/wiki/Network_file_system)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T11:34:35.723

pg_dump 确实是正确的解决方案。请务必阅读手册页。在 Espo 的示例中，一些选项是有问题的（-x 和 -D）并且可能不适合您。

与其他所有数据库操作一样，进行大量测试！

# java - SWT 中是否有 RTF 显示小部件

> ID：81671
> 
> 赞同：4
> 
> 时间：2008-09-17T10:07:10.320
> 
> 标签：java, eclipse, swt, rtf

我想在 SWT（实际上是 Eclipse RCP）应用程序中显示一个 RTF 文档。

我知道有一个用于显示和编辑 RTF 文本的 Swing 小部件，但它是 Swing 并且在其他平台中使用时在外观和感觉上非常陌生（更不用说据我所知它没有显示图像并且只有对格式化的支持有限）

其他选项是在 windows 上使用 COM 接口，但这仅适用于 windows 平台，并且需要在客户机器上安装 ActiveX RichEdit 控件......这会使应用程序的部署非常可怕......

在 Eclipse/SWT 应用程序中显示富文档的其他选项是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T10:14:04.140

您可以使用 swt.custom.StyledText。它有很多功能可以改变文本的外观。但我不认为它现在可以加载或保存 RTF。

我曾经用它编写了一个 HTML 编辑器，但它非常困难，因为与 HTML/RTF 的工作方式相比，将样式添加到部分文本的 StyledText 模型是如此陌生。

AFAIK 您可以直接从此控件打印，该控件在内部创建内容的 RTF 表示。但这并不是你所要求的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-04T10:14:44.063

为什么不首先使用 RTFEditorKit 将 RTF 文本读入 StyledDocument，然后使用 HTMLEditorKit 将 StyledDocument 写入 StringWriter？

```
String rtf = "whatever";
BufferedReader input = new BufferedReader(new StringReader(rtf));

RTFEditorKit rtfKit = new RTFEditorKit();
StyledDocument doc = (StyledDocument) rtfKit.createDefaultDocument();
rtfEdtrKt.read( input, doc, 0 );
input.close();

HTMLEditorKit htmlKit = new HTMLEditorKit();       
StringWriter output = new StringWriter();
htmlKit.write( output, doc, 0, doc.getLength());

String html = output.toString(); 
```

然后显示HTML？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-06T15:33:50.977

您可能希望将 Swing 控件与[AWT/SWT 桥接](http://www.eclipsezone.com/eclipse/forums/t45697.html)器一起使用。我用它来将 OpenOffice 嵌入到 SWT 应用程序中：

```
package ooswtviewer;

import java.awt.Panel;

import com.sun.star.awt.XView;
import com.sun.star.beans.Property;
import com.sun.star.beans.UnknownPropertyException;
import com.sun.star.beans.XPropertySet;
import com.sun.star.comp.beans.Frame;
import com.sun.star.comp.beans.NoConnectionException;
import com.sun.star.comp.beans.OOoBean;
import com.sun.star.comp.beans.OfficeDocument;
import com.sun.star.drawing.XDrawView;
import com.sun.star.frame.XController;
import com.sun.star.frame.XDesktop;
import com.sun.star.frame.XFrame;
import com.sun.star.frame.XFramesSupplier;
import com.sun.star.frame.XLayoutManager;
import com.sun.star.frame.XModel;
import com.sun.star.lang.WrappedTargetException;
import com.sun.star.ui.XUIElement;
import com.sun.star.uno.Any;
import com.sun.star.uno.UnoRuntime;
import com.sun.star.uno.XInterface;
import com.sun.star.view.XViewSettingsSupplier;

/**
 * Code based on example from http://www.eclipsezone.com/eclipse/forums/t48966.html
 * 
 * @author Aaron digulla
 */
public class OOoSwtViewer extends Panel
{
    private static final String RESOURCE_TOOLBAR_TEXTOBJECTBAR = "private:resource/toolbar/textobjectbar";
    private static final String RESOURCE_TOOLBAR_STANDARDBAR = "private:resource/toolbar/standardbar";
    private static final String RESOURCE_MENUBAR = "private:resource/menubar/menubar";

    private static final long serialVersionUID = -1408623115735065822L;

    private OOoBean aBean;

    public OOoSwtViewer()
    {
        super();
        aBean = new OOoBean();
        setLayout(new java.awt.BorderLayout());
        add(aBean, java.awt.BorderLayout.CENTER);

        aBean.setAllBarsVisible (false);
    }

    public XPropertySet getXPropertySet ()
    {
        return getXPropertySet (getFrame ());
    }

    public XPropertySet getXPropertySet (Object o)
    {
        return (XPropertySet)UnoRuntime.queryInterface (XPropertySet.class, o);
    }

    public Frame getFrame ()
    {
        try
        {
            return aBean.getFrame ();
        }
        catch (NoConnectionException e)
        {
            throw new OOException ("Error getting frame from bean", e);
        }
    }

    public XLayoutManager getXLayoutManager ()
    {
        try
        {
            return (XLayoutManager)UnoRuntime.queryInterface (XLayoutManager.class, getXPropertySet ().getPropertyValue ("LayoutManager"));
        }
        catch (Exception e)
        {
            throw new OOException ("Error getting LayoutManager from bean's properties", e);
        }        
    }

    public void setMenuBarVisible (boolean visible)
    {
        if (visible)
            getXLayoutManager ().showElement (RESOURCE_MENUBAR);
        else
            getXLayoutManager ().hideElement (RESOURCE_MENUBAR);
    }

    public void setStandardBarVisible (boolean visible)
    {
        if (visible)
            getXLayoutManager ().showElement (RESOURCE_TOOLBAR_STANDARDBAR);
        else
            getXLayoutManager ().hideElement (RESOURCE_TOOLBAR_STANDARDBAR);
    }

    public void setTextObjectBarVisible (boolean visible)
    {
        if (visible)
            getXLayoutManager ().showElement (RESOURCE_TOOLBAR_TEXTOBJECTBAR);
        else
            getXLayoutManager ().hideElement (RESOURCE_TOOLBAR_TEXTOBJECTBAR);
    }

    private Thread loadThread;
    private Exception loadException;

    public void setDocument(final String url)
    {
        loadThread = new Thread () {
            public void run() {
                try
                {
                    aBean.loadFromURL(url, null);
                    aBean.aquireSystemWindow();

                    setTextObjectBarVisible (false);

//                    for (XUIElement e: getXLayoutManager ().getElements ())
//                    {
//                        XInterface i = (XInterface)e.getRealInterface ();
//                        System.out.println (e);
//                        System.out.println (i);
//                        printProperties (getXPropertySet (e));
//                    }

                    /*
                    System.out.println ("frame:");
                    printProperties (getXPropertySet ());

frame:
Title=test - OpenOffice.org Writer 
IndicatorInterception=Any[Type[com.sun.star.task.XStatusIndicator], null]
LayoutManager=Any[Type[com.sun.star.frame.XLayoutManager], [Proxy:26506390,717ea70;msci[0];342169f1a1164ee688893a857f65b3e1,Type[com.sun.star.frame.XLayoutManager]]]
DispatchRecorderSupplier=Any[Type[com.sun.star.frame.XDispatchRecorderSupplier], null]
IsHidden=false
                    */

                    XController controller = aBean.getDocument ().getCurrentController ();
                    /*
                    System.out.println ("controller:");
                    printProperties (getXPropertySet (controller));

controller:
IsConstantSpellcheck=true
IsHideSpellMarks=false
LineCount=1
PageCount=1
                    */

                    /*
                    System.out.println ("layoutManager:");
                    printProperties (getXPropertySet (getXLayoutManager ()));

layoutManager:
AutomaticToolbars=true
HideCurrentUI=false
LockCount=0
MenuBarCloser=true
RefreshContextToolbarVisibility=false
                    */

                    /*
                    System.out.println ("document:");
                    printProperties (getXPropertySet (aBean.getDocument ()));
                    OfficeDocument doc = aBean.getDocument ();
ApplyFormDesignMode=false
ApplyWorkaroundForB6375613=false
AutomaticControlFocus=false
BasicLibraries=Any[Type[com.sun.star.script.XLibraryContainer], [Proxy:14806696,73ca178;msci[0];342169f1a1164ee688893a857f65b3e1,Type[com.sun.star.script.XLibraryContainer]]]
BuildId=680$9310
CharFontCharSet=1
CharFontCharSetAsian=1
CharFontCharSetComplex=1
CharFontFamily=3
CharFontFamilyAsian=6
CharFontFamilyComplex=6
CharFontName=Times New Roman
CharFontNameAsian=Arial Unicode MS
CharFontNameComplex=Tahoma
CharFontPitch=2
CharFontPitchAsian=2
CharFontPitchComplex=2
CharFontStyleName=
CharFontStyleNameAsian=
CharFontStyleNameComplex=
CharLocale=com.sun.star.lang.Locale@fb6354
CharacterCount=20
DialogLibraries=Any[Type[com.sun.star.script.XLibraryContainer], [Proxy:3556929,73a39c0;msci[0];342169f1a1164ee688893a857f65b3e1,Type[com.sun.star.script.XLibraryContainer]]]
ForbiddenCharacters=Any[Type[com.sun.star.i18n.XForbiddenCharacters], [Proxy:11544872,7669148;msci[0];342169f1a1164ee688893a857f65b3e1,Type[com.sun.star.i18n.XForbiddenCharacters]]]
HasValidSignatures=false
HideFieldTips=false
IndexAutoMarkFileURL=
LockUpdates=false
ParagraphCount=1
RecordChanges=false
RedlineDisplayType=2
RedlineProtectionKey=[B@f593af
RuntimeUID=10
ShowChanges=true
TwoDigitYear=1930
WordCount=5
WordSeparator=()        
                    */

//                    System.out.println ("viewData:");
//                    printProperties (getXPropertySet (controller.getFrame ().getContainerWindow ()));

                    XViewSettingsSupplier settingsSupplier = (XViewSettingsSupplier)UnoRuntime.queryInterface (XViewSettingsSupplier.class, controller);
//                    System.out.println ("settingsSupplier:");
//                    printProperties (settingsSupplier.getViewSettings ());
                    settingsSupplier.getViewSettings ().setPropertyValue ("ShowVertRuler", Boolean.FALSE);
                    settingsSupplier.getViewSettings ().setPropertyValue ("ShowHoriRuler", Boolean.FALSE);
                    // Switch to Web Layout. This layout mode comes without gray border and the page borders automatically adujst to the frame
                    settingsSupplier.getViewSettings ().setPropertyValue ("ShowOnlineLayout", Boolean.TRUE);
//                    settingsSupplier.getViewSettings ().setPropertyValue ("ShowTextBoundaries", Boolean.TRUE);

//                    XView view = (XView)UnoRuntime.queryInterface (XView.class, getFrame ());
//                    System.out.println ("drawView="+view);
//                    printProperties (getXPropertySet (view));

                    /*
                    XModel model = (XModel)UnoRuntime.queryInterface (XModel.class, doc);
                    printProperties ("model", model);

                    Same as getDocument()
                    */

                    /*
                    System.out.println ("Interfaces implemented by aBean.getDocument():");
                    for (Class c: OOoInspector.queryInterface (aBean.getDocument ()))
                        System.out.println ("    "+c.getName ());
    com.sun.star.datatransfer.XTransferable
    com.sun.star.document.XDocumentInfoSupplier
    com.sun.star.document.XDocumentLanguages
    com.sun.star.document.XDocumentSubStorageSupplier
    com.sun.star.document.XEmbeddedScripts
    com.sun.star.document.XEventBroadcaster
    com.sun.star.document.XEventsSupplier
    com.sun.star.document.XLinkTargetSupplier
    com.sun.star.document.XRedlinesSupplier
    com.sun.star.document.XStorageBasedDocument
    com.sun.star.document.XViewDataSupplier
    com.sun.star.drawing.XDrawPageSupplier
    com.sun.star.embed.XVisualObject
    com.sun.star.frame.XLoadable
    com.sun.star.frame.XModel
    com.sun.star.frame.XModel2
    com.sun.star.frame.XModule
    com.sun.star.frame.XStorable
    com.sun.star.frame.XStorable2
    com.sun.star.script.provider.XScriptProviderSupplier
    com.sun.star.style.XAutoStylesSupplier
    com.sun.star.style.XStyleFamiliesSupplier
    com.sun.star.text.XBookmarksSupplier
    com.sun.star.text.XChapterNumberingSupplier
    com.sun.star.text.XDocumentIndexesSupplier
    com.sun.star.text.XEndnotesSupplier
    com.sun.star.text.XFootnotesSupplier
    com.sun.star.text.XLineNumberingProperties
    com.sun.star.text.XNumberingRulesSupplier
    com.sun.star.text.XPagePrintable
    com.sun.star.text.XReferenceMarksSupplier
    com.sun.star.text.XTextDocument
    com.sun.star.text.XTextEmbeddedObjectsSupplier
    com.sun.star.text.XTextFieldsSupplier
    com.sun.star.text.XTextFramesSupplier
    com.sun.star.text.XTextGraphicObjectsSupplier
    com.sun.star.text.XTextSectionsSupplier
    com.sun.star.text.XTextTablesSupplier
    com.sun.star.ui.XUIConfigurationManagerSupplier
    com.sun.star.util.XCloseable
    com.sun.star.util.XCloseBroadcaster
    com.sun.star.util.XLinkUpdate
    com.sun.star.util.XModifiable
    com.sun.star.util.XModifiable2
    com.sun.star.util.XModifyBroadcaster
    com.sun.star.util.XNumberFormatsSupplier
    com.sun.star.util.XRefreshable
    com.sun.star.util.XReplaceable
    com.sun.star.util.XSearchable
    com.sun.star.view.XPrintable
    com.sun.star.view.XPrintJobBroadcaster
    com.sun.star.view.XRenderable
    com.sun.star.xforms.XFormsSupplier
                    */

                    /*
                    System.out.println ("Interfaces implemented by controller:");
                    for (Class c: OOoInspector.queryInterface (controller))
                        System.out.println ("    "+c.getName ());

    com.sun.star.awt.XUserInputInterception
    com.sun.star.datatransfer.XTransferableSupplier
    com.sun.star.frame.XController
    com.sun.star.frame.XControllerBorder
    com.sun.star.frame.XDispatchInformationProvider
    com.sun.star.frame.XDispatchProvider
    com.sun.star.task.XStatusIndicatorSupplier
    com.sun.star.text.XRubySelection
    com.sun.star.text.XTextViewCursorSupplier
    com.sun.star.ui.XContextMenuInterception
    com.sun.star.view.XControlAccess
    com.sun.star.view.XFormLayerAccess
    com.sun.star.view.XSelectionSupplier
    com.sun.star.view.XViewSettingsSupplier
                    */

                    /*
                    System.out.println ("Interfaces implemented by frame:");
                    for (Class c: OOoInspector.queryInterface (getFrame ()))
                        System.out.println ("    "+c.getName ());

    com.sun.star.awt.XFocusListener
    com.sun.star.awt.XTopWindowListener
    com.sun.star.awt.XWindowListener
    com.sun.star.document.XActionLockable
    com.sun.star.frame.XComponentLoader
    com.sun.star.frame.XDispatchInformationProvider
    com.sun.star.frame.XDispatchProvider
    com.sun.star.frame.XDispatchProviderInterception
    com.sun.star.frame.XFrame
    com.sun.star.frame.XFramesSupplier
    com.sun.star.task.XStatusIndicatorFactory
    com.sun.star.util.XCloseable
    com.sun.star.util.XCloseBroadcaster
                    */

                    /*
                    XFramesSupplier frames = OOoInspector.queryInterface (XFramesSupplier.class, getFrame ());
                    printProperties ("frames", frames);

                    for (int i=0; i<frames.getFrames ().getCount (); i++)
                    {
                        XFrame frame = (XFrame)frames.getFrames ().getByIndex (i);
                        printProperties ("Frame "+i, frame);
                    }

frames=[Proxy:16382237,6ace84c;msci[0];342169f1a1164ee688893a857f65b3e1,Type[com.sun.star.frame.XFramesSupplier]]
Title=test - OpenOffice.org Writer 
IndicatorInterception=Any[Type[com.sun.star.task.XStatusIndicator], null]
LayoutManager=Any[Type[com.sun.star.frame.XLayoutManager], [Proxy:22149392,76bd794;msci[0];342169f1a1164ee688893a857f65b3e1,Type[com.sun.star.frame.XLayoutManager]]]
DispatchRecorderSupplier=Any[Type[com.sun.star.frame.XDispatchRecorderSupplier], null]
IsHidden=false
                    */
                    XPropertySet p = getXPropertySet (getFrame ());
                    Any any = (Any)p.getPropertyValue ("LayoutManager");
                    System.out.println (any);
                    System.out.println (any.getClass ().getName ());
                    XLayoutManager layoutManager = (XLayoutManager)any.getObject ();
                    printProperties ("layoutManager", layoutManager);

                    /*
                    printProperties ("containerWindow", getFrame ().getContainerWindow ());

containerWindow=[Proxy:11970262,6d33e60;msci[0];342169f1a1164ee688893a857f65b3e1,Type[com.sun.star.awt.XWindow]]
null
                    */

                    /*
                    printProperties ("componentWindow", getFrame ().getComponentWindow ());

componentWindow=[Proxy:25380515,8657cc4;msci[0];342169f1a1164ee688893a857f65b3e1,Type[com.sun.star.awt.XWindow]]
null
                    */
                }
                catch (Exception e)
                {
                    e.printStackTrace ();
                }
            }
        };
        if (1 == 1)
            loadThread.start ();
        else
            loadThread.run ();
    }

    /** closes the bean viewer and tries to terminate OOo.
     */
    public void terminate() throws NoConnectionException {
        setVisible(false);
        XDesktop xDesktop = null;
        xDesktop = aBean.getOOoDesktop();
        aBean.stopOOoConnection();
        if (xDesktop != null)
            xDesktop.terminate();
    }

    /** closes the bean viewer, leaves OOo running.
     */
    public void close() {
        setVisible(false);
        aBean.stopOOoConnection();
    }

    public void printProperties (String name, Object obj)
    {
        System.out.println (name+"="+obj);
        if (obj != null)
            printProperties (getXPropertySet (obj));
    }

    public void printProperties (XPropertySet set)
    {
        if (set == null)
        {
            System.out.println ("null");
            return;
        }

        for (Property p: set.getPropertySetInfo ().getProperties ())
        {
            try
            {
                System.out.println (p.Name+"="+set.getPropertyValue (p.Name));
            }
            catch (Exception e)
            {
                throw new OOException ("Error getting value of property "+p.Name, e);
            }
        }
    }

} 
```

您可以像这样使用控件：

```
package ooswtviewer;

import java.awt.BorderLayout;
import java.awt.Frame;
import java.awt.Panel;
import java.io.File;

import javax.swing.JRootPane;

import org.eclipse.swt.SWT;
import org.eclipse.swt.awt.SWT_AWT;
import org.eclipse.swt.events.DisposeEvent;
import org.eclipse.swt.events.DisposeListener;
import org.eclipse.swt.layout.FillLayout;
import org.eclipse.swt.widgets.Composite;
import org.eclipse.swt.widgets.Display;
import org.eclipse.swt.widgets.Shell;

/**
 * Code based on example from http://www.eclipsezone.com/eclipse/forums/t48966.html
 * 
 * @author Aaron Digulla
 */
public class OOoSwtSnippet {
    public static void main(String[] args) {
        OOoSwtSnippet obj = new OOoSwtSnippet ();
        try
        {
            obj.run (args);
        }
        catch (Exception e)
        {
            e.printStackTrace ();
        }
    }

    public void run (String[] args) throws Exception
    {
        final Display display = new Display();
        final Shell shell = new Shell(display);
        shell.setLayout(new FillLayout());

        Composite composite = new Composite(shell, SWT.NO_BACKGROUND
                | SWT.EMBEDDED);

        System.setProperty("sun.awt.noerasebackground", "true");

        /* Create and setting up frame */
        Frame frame = SWT_AWT.new_Frame(composite);
        Panel panel = new Panel(new BorderLayout()) {
            public void update(java.awt.Graphics g) {
                paint(g);
            }
        };
        frame.add(panel);
        JRootPane root = new JRootPane();
        panel.add(root);
        java.awt.Container contentPane = root.getContentPane();

        shell.setSize(800, 600);
        final OOoSwtViewer viewer = new OOoSwtViewer();
        contentPane.add(viewer);

        // viewer.setDocument(NEW_WRITTER_DOCUMENT);
        File document = new File ("test.odt");
        String url = document.getAbsoluteFile ().toURL ().toString ();
        url = "file:///" + url.substring (6);
        System.out.println ("Loading "+url);
        viewer.setDocument(url);

        shell.setText ("OOoSwtSnippet");
        shell.open();
        shell.addDisposeListener(new DisposeListener() {
            public void widgetDisposed(DisposeEvent e) {
                try {
                    viewer.close();
                } catch (RuntimeException exception) {
                    exception.printStackTrace();
                }
            }

        });
        while (!shell.isDisposed()) {
            if (!display.readAndDispatch())
                display.sleep();
        }
        display.dispose();
    }

} 
```

OOException 是一个 RuntimeException：

```
package ooswtviewer;

/**
 * Wrapper for all OO exceptions to keep throws clauses in check
 * 
 * @author Aaron Digulla
 */
public class OOException extends RuntimeException
{

    public OOException ()
    {
        super ();
    }

    public OOException (String message, Throwable cause)
    {
        super (message, cause);
    }

    public OOException (String message)
    {
        super (message);
    }

    public OOException (Throwable cause)
    {
        super (cause);
    }

} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-21T08:01:52.383

[http://sites.google.com/site/anshunjain/eclipse-musings/eclipse-hacks/eclipse-richt-text-editor](http://sites.google.com/site/anshunjain/eclipse-musings/eclipse-hacks/eclipse-richt-text-editor)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-02-19T07:39:10.593

实际上，我刚刚发现了另一个很有前途的小部件：

[http://onpositive.com/richtext](http://onpositive.com/richtext)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-03T00:50:54.790

我不确定不使用 ActiveX 的方法。如果您确实朝这个方向发展，您可能需要研究[IBM Container for ActiveX Documents](http://www.alphaworks.ibm.com/tech/swtactivexcontainer?open&S_TACT=106AH21W&S_CMP=AWRSSJAV)，它应该允许更好地集成文档。

# c# - 如何在 C# 中检查对象是否可序列化

> ID：81674
> 
> 赞同：96
> 
> 时间：2008-09-17T10:08:13.653
> 
> 标签：c#, serialization

我正在寻找一种简单的方法来检查 C# 中的对象是否可序列化。

正如我们所知，您可以通过实现*ISerializable*接口或将*[Serializable]*放在类的顶部来使对象可序列化。

我正在寻找的是一种快速检查这一点的方法，而无需反映类来获取它的属性。*使用is*语句，界面会很快。

使用@Flard 的建议，这是我想出的代码，尖叫是否有更好的方法。

```
private static bool IsSerializable(T obj)
{
    return ((obj is ISerializable) || (Attribute.IsDefined(typeof (T), typeof (SerializableAttribute))));
} 
```

或者更好的是获取对象的类型，然后在类型上使用 IsSerializable 属性：

```
typeof(T).IsSerializable 
```

请记住，虽然这似乎只是我们正在处理的类，如果该类包含其他类，您可能想要全部检查它们或尝试序列化并等待@pb 指出的错误。

* * *

## 回答 #1

> 赞同：121
> 
> 时间：2008-09-17T10:20:08.773

你在类上有一个可爱的属性，`Type`叫做`IsSerializable`.

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2008-09-17T10:13:30.863

您将不得不检查正在序列化的对象图中的所有类型以获取可序列化属性。最简单的方法是尝试序列化对象并捕获异常。（但这不是最干净的解决方案）。Type.IsSerializable 和检查 serializalbe 属性不考虑图形。

*样本*

```
[Serializable]
public class A
{
    public B B = new B();
}

public class B
{
   public string a = "b";
}

[Serializable]
public class C
{
    public D D = new D();
}

[Serializable]
public class D
{
    public string d = "D";
}

class Program
{
    static void Main(string[] args)
    {

        var a = typeof(A);

        var aa = new A();

        Console.WriteLine("A: {0}", a.IsSerializable);  // true (WRONG!)

        var c = typeof(C);

        Console.WriteLine("C: {0}", c.IsSerializable); //true

        var form = new BinaryFormatter();
        // throws
        form.Serialize(new MemoryStream(), aa);
    }
} 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2010-10-27T21:22:32.553

这是一个老问题，可能需要针对 .NET 3.5+ 进行更新。如果类使用 DataContract 属性，Type.IsSerializable 实际上可以返回 false。这是我使用的一个片段，如果它很臭，请告诉我:)

```
public static bool IsSerializable(this object obj)
{
    Type t = obj.GetType();

     return  Attribute.IsDefined(t, typeof(DataContractAttribute)) || t.IsSerializable || (obj is IXmlSerializable)

} 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-17T11:46:14.823

正如其他人指出的那样，使用 Type.IsSerializable 。

可能不值得尝试反映和检查对象图中的所有成员是否都是可序列化的。

可以将成员声明为可序列化类型，但实际上将其实例化为不可序列化的派生类型，如以下人为设计的示例：

```
[Serializable]
public class MyClass
{
   public Exception TheException; // serializable
}

public class MyNonSerializableException : Exception
{
...
}

...
MyClass myClass = new MyClass();
myClass.TheException = new MyNonSerializableException();
// myClass now has a non-serializable member 
```

因此，即使您确定您的类型的特定实例是可序列化的，通常也不能确定所有实例都是如此。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-17T10:12:21.523

```
Attribute.IsDefined(typeof (YourClass), typeof (SerializableAttribute)); 
```

可能涉及水下反射，但最简单的方法是什么？

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-17T10:29:15.540

这是一个 3.5 变体，使用扩展方法使其可用于所有类。

```
public static bool IsSerializable(this object obj)
{
    if (obj is ISerializable)
        return true;
    return Attribute.IsDefined(obj.GetType(), typeof(SerializableAttribute));
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-10-24T17:25:48.403

我接受了这个问题的答案和[这里](https://stackoverflow.com/questions/236599/how-to-unit-test-if-my-object-is-really-serializable/236698#236698)的答案并对其进行了修改，以便您获得一个不可序列化的类型列表。这样你就可以很容易地知道要标记哪些。

```
 private static void NonSerializableTypesOfParentType(Type type, List<string> nonSerializableTypes)
    {
        // base case
        if (type.IsValueType || type == typeof(string)) return;

        if (!IsSerializable(type))
            nonSerializableTypes.Add(type.Name);

        foreach (var propertyInfo in type.GetProperties(BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Instance))
        {
            if (propertyInfo.PropertyType.IsGenericType)
            {
                foreach (var genericArgument in propertyInfo.PropertyType.GetGenericArguments())
                {
                    if (genericArgument == type) continue; // base case for circularly referenced properties
                    NonSerializableTypesOfParentType(genericArgument, nonSerializableTypes);
                }
            }
            else if (propertyInfo.GetType() != type) // base case for circularly referenced properties
                NonSerializableTypesOfParentType(propertyInfo.PropertyType, nonSerializableTypes);
        }
    }

    private static bool IsSerializable(Type type)
    {
        return (Attribute.IsDefined(type, typeof(SerializableAttribute)));
        //return ((type is ISerializable) || (Attribute.IsDefined(type, typeof(SerializableAttribute))));
    } 
```

然后你叫它...

```
 List<string> nonSerializableTypes = new List<string>();
    NonSerializableTypesOfParentType(aType, nonSerializableTypes); 
```

当它运行时，nonSerializableTypes 将拥有该列表。可能有比将空列表传递给递归方法更好的方法。如果是这样，有人纠正我。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-08-02T15:24:33.817

我的解决方案，在 VB.NET 中：

对于对象：

```
''' <summary>
''' Determines whether an object can be serialized.
''' </summary>
''' <param name="Object">The object.</param>
''' <returns><c>true</c> if object can be serialized; otherwise, <c>false</c>.</returns>
Private Function IsObjectSerializable(ByVal [Object] As Object,
                                      Optional ByVal SerializationFormat As SerializationFormat =
                                                                            SerializationFormat.Xml) As Boolean

    Dim Serializer As Object

    Using fs As New IO.MemoryStream

        Select Case SerializationFormat

            Case Data.SerializationFormat.Binary
                Serializer = New Runtime.Serialization.Formatters.Binary.BinaryFormatter()

            Case Data.SerializationFormat.Xml
                Serializer = New Xml.Serialization.XmlSerializer([Object].GetType)

            Case Else
                Throw New ArgumentException("Invalid SerializationFormat", SerializationFormat)

        End Select

        Try
            Serializer.Serialize(fs, [Object])
            Return True

        Catch ex As InvalidOperationException
            Return False

        End Try

    End Using ' fs As New MemoryStream

End Function 
```

对于类型：

```
''' <summary>
''' Determines whether a Type can be serialized.
''' </summary>
''' <typeparam name="T"></typeparam>
''' <returns><c>true</c> if Type can be serialized; otherwise, <c>false</c>.</returns>
Private Function IsTypeSerializable(Of T)() As Boolean

    Return Attribute.IsDefined(GetType(T), GetType(SerializableAttribute))

End Function

''' <summary>
''' Determines whether a Type can be serialized.
''' </summary>
''' <typeparam name="T"></typeparam>
''' <param name="Type">The Type.</param>
''' <returns><c>true</c> if Type can be serialized; otherwise, <c>false</c>.</returns>
Private Function IsTypeSerializable(Of T)(ByVal Type As T) As Boolean

    Return Attribute.IsDefined(GetType(T), GetType(SerializableAttribute))

End Function 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-05-06T14:43:20.537

异常对象可能是可序列化的，但使用另一个不是的异常。这就是我刚刚使用 WCF System.ServiceModel.FaultException: FaultException 是可序列化的，但 ExceptionDetail 不是！

所以我正在使用以下内容：

```
// Check if the exception is serializable and also the specific ones if generic
var exceptionType = ex.GetType();
var allSerializable = exceptionType.IsSerializable;
if (exceptionType.IsGenericType)
    {
        Type[] typeArguments = exceptionType.GetGenericArguments();
        allSerializable = typeArguments.Aggregate(allSerializable, (current, tParam) => current & tParam.IsSerializable);
    }
 if (!allSerializable)
    {
        // Create a new Exception for not serializable exceptions!
        ex = new Exception(ex.Message);
    } 
```

# windows - WinXP 和 WinVista 中是否存在所有用户都具有写入权限的文件夹？

> ID：81686
> 
> 赞同：1
> 
> 时间：2008-09-17T10:10:41.417
> 
> 标签：windows, installation

我们有一个安装到 Program Files 文件夹的 NET 应用程序。应用程序本身会写入一些文件并为其应用程序文件夹创建一些目录。但是当一个普通的 Windows 用户尝试使用我们的应用程序时，它会崩溃，因为该用户没有写入应用程序文件夹的权限。WinXP 和 WinVista 中是否有默认所有用户都具有写入权限的文件夹？所有用户文件夹或类似的东西？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T10:22:15.913

没有这样的文件夹。

但是你可以创建一个。

CSIDL_COMMON_APPDATA 在 Vista 中映射到 %ProgramData% (c:\ProgramData)，在 XP 中映射到 c:\Documents and Settings\AllUsers\Application Data

随意在您的安装程序中创建一个文件夹并设置 ACL，以便每个人都可以写入该文件夹。

请记住，COMMON_APPDATA 是在通用控件库的版本 5 中实现的，这意味着它在 Windows 2000 及更高版本中可用。在 NT4 中，您可以在安装目录和 Windows 98 及以下系统中创建该文件夹，因为这些系统无论如何都没有权限系统，所以无论如何都没有关系。

这是一些用于创建该文件夹的示例 InnoSetup 代码：

```
[Dirs]
Name: {code:getDBPath}; Flags: uninsalwaysuninstall; Permissions: authusers-modify

[Code]

function getDBPath(Param: String): String;
var
   Version: TWindowsVersion;
begin
  Result := ExpandConstant('{app}\data');
  GetWindowsVersionEx(Version);
  if (Version.Major >= 5) then begin
    Result := ExpandConstant('{commonappdata}\myprog');
  end;
end; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T10:16:45.023

我不确定是否存在所有非管理员用户都有权写入的单一路径。

我认为正确的应该是`<User>\Application Data`

# task-tracking - 带有命令行界面的任务/问题跟踪系统

> ID：81698
> 
> 赞同：10
> 
> 时间：2008-09-17T10:11:56.203
> 
> 标签：task-tracking

是否有任何带有命令行界面的任务跟踪系统？

以下是我感兴趣的功能列表：

*   简单任务模板
    类似于带有属性：类型对的纯文本文件，例如：

> ```
> description:string  
> some-property:integer required 
> ```

*   命令行界面
    例如：

> ```
> // Creates task
> <task tracker>.exe -create {description: "Foo", some-property: 1}   
> // Search for tasks with description field starting from F
> <task tracker>.exe -find { description: "F*" } 
> ```

*   XCopy 部署
    它应该不需要安装繁重的 DBMS

*   多用户支持
    所以它不仅仅是一个人的待办事项列表

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-17T10:19:27.527

有趣的想法；我听说过的最接近的是[todo.txt](http://todotxt.com/)。

或者，您可以通过仅使用数据库（例如 sqllite）和 SQL 来创建自己的。或者，编写一个包装脚本来解析您的纯文本文件和命令行选项，并生成相应的 SQL。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-17T07:33:09.050

> Ditz 是一个简单、轻量级的分布式问题跟踪器，旨在与 darcs 和 git 等分布式版本控制系统一起使用。

迪茨：[http ://web.archive.org/web/20121212202849/http://gitorious.org/ditz](http://web.archive.org/web/20121212202849/http://gitorious.org/ditz)

也在这里克隆：[https ://github.com/jashmenn/ditz](https://github.com/jashmenn/ditz)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-17T14:24:42.087

你见过[ticgit](http://github.com/schacon/ticgit/wikis)吗？听起来它可能会做你们所追求的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-06-28T10:15:00.697

# Erlangs 票务系统

由 Peter Högfeldt 于 1986 年创建。这是在 Erlang 发行版中使用的票证系统。

资料来源：[乔·阿姆斯特朗的博客](https://joearms.github.io/published/2014-06-25-minimal-viable-program.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-17T10:22:31.593

[http://roundup.sourceforge.net/](http://roundup.sourceforge.net/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-17T10:25:45.827

@彼得希尔顿，

我要创建这样的系统。所以我想知道这样的系统是否存在。一般的想法是让它尽可能简单：用于管理任务的命令行实用程序和带有 REST 接口的简单服务器。我使用了十几种不同的任务跟踪系统，得出的结论是我不需要花哨的 UI。它应该像 Subversion - 你可以愉快地使用基于命令行的 svn.exe

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-29T22:54:05.200

我经常滥用命令`cal`行`calendar`工具来完成这类任务。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-09-21T21:51:28.417

[ciss](http://codespeak.net/ciss/) issue tracker 是一个简单的命令行工具，用于管理您的 ISSUES.txt 文件。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-17T10:25:28.120

Fogbugz 有一个[命令行客户端](http://support.fogcreek.com/default.asp?W840)。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-02-25T13:39:07.927

看看[Pitz](http://pitz.tplus1.com/) and [Bugs Everywhere](http://bugseverywhere.org/be/show/HomePage)。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-04-08T00:23:49.900

我在终端模式下使用[org-mode](http://www.org-mode.org)和 emacs (emacs -nw)。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-02-11T06:12:23.643

我们之前使用过一些工具。我们现在使用 GitHub 私有存储库来维护各种开发人员 TBD 列表（作为 .md 文件）和问题跟踪，因为具有以下优势：

*   开发人员已经在使用 GitHub，他们不需要学习任何新东西。
*   开发人员可以使用他们喜欢的任何工具来维护 TBD 列表；命令行或图形编辑器、GitHub Web 界面或大量移动客户端
*   降价支持
*   可靠的备份
*   合并和修订历史
*   针对不同项目和模块的灵活文件组织

# c - MinGW“stdio.h：没有这样的文件或目录”

> ID：81716
> 
> 赞同：6
> 
> 时间：2008-09-17T10:13:10.180
> 
> 标签：c, compiler-construction

我正在尝试使用 MinGW 在 Windows XP 下编译 C 程序。gcc.exe 给出以下错误：

**stdio.h : 没有这样的文件或目录**

代码 (hello.c) 如下所示：

```
#include < stdio.h >

void main()
{
    printf("\nHello World\n");
} 
```

我使用批处理文件来调用 gcc。批处理文件如下所示：

```
@echo off
set OLDPATH=%PATH%
set path=C:\devtools\MinGW\bin;%PATH%
set LIBRARY_PATH=C:\devtools\MinGW\lib
set C_INCLUDE_PATH=C:\devtools\MinGW\include

gcc.exe hello.c 

set path=%OLDPATH% 
```

我试过选项**-I**没有效果。我做错了什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-17T10:15:30.843

尝试将第一行更改为：

```
#include <stdio.h> 
```

没有空格。它试图寻找一个名为“stdio.h”的文件，开头和结尾都有一个空格。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-17T10:16:26.460

您应该尝试将 MinGW 安装在默认安装目录（即 C:\MinGW）中，我多次阅读建议避免出现问题。gcc 中可能存在（错误的）硬编码路径。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-18T00:52:28.567

还要注意 main() 应该返回一个 int：

```
int main(void) 
```

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2014-02-23T12:10:27.440

您可以使用

$ sudo apt-get install build-essential

解决这个问题

# java - 通用方法类型安全

> ID：81723
> 
> 赞同：2
> 
> 时间：2008-09-17T10:14:32.610
> 
> 标签：java, generics

我有`NodeType`s和`Node`s的概念。A`NodeType`是一堆元数据，您可以从中创建`Node`实例（很像整个类/对象关系）。

我有各种`NodeType`实现和各种节点实现。

在我的 AbstractNodeType （NodeTypes 的顶级）中，我有 ab 抽象`createInstance()`方法，一旦由子类实现，它将创建正确的 Node 实例：

```
public abstract class AbstractNodeType {
  // ..

  public abstract <T extends AbstractNode> T createInstance();
} 
```

在我的`NodeType`实现中，我实现了这样的方法：

```
public class ThingType {
  // ..

  public Thing createInstance() {
    return new Thing(/* .. */);
  }
}

// FYI
public class Thing extends AbstractNode { /* .. */ } 
```

这一切都很好，但`public Thing createInstance()`会产生关于类型安全的警告。具体来说：

> 类型安全：来自 ThingType 类型的 createInstance() 的返回类型 Thing 需要未经检查的转换以符合来自 AbstractNodeType 类型的 T

**我做错了什么导致这样的警告？**

**我如何重构我的代码来解决这个问题？**

*`@SuppressWarnings("unchecked")`不好，我希望通过正确编码来解决这个问题，而不是忽略问题！*

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T10:17:40.403

[由于协变返回](http://en.wikipedia.org/wiki/Covariant_return_type)的魔力，您可以替换`<T extends AbstractNode> T`为`AbstractNode`感谢。增加了支持，但它没有得到应得的 pub。`Java 5`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-17T10:28:16.773

两种方式：

(a) 不要使用泛型。在这种情况下可能没有必要。（尽管这取决于您未显示的代码。）

(b) 生成 AbstractNodeType 如下：

```
public abstract class AbstractNodeType<T extends AbstractNode> {
  public abstract T createInstance();
}
public class ThingType<Thing> {
  public Thing createInstance() {
    return new Thing(...);
  }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T10:25:13.787

像这样的东西应该工作：

```
interface Node{
}
interface NodeType<T extends Node>{
    T createInstance();
}
class Thing implements Node{}
class ThingType implements NodeType<Thing>{
    public Thing createInstance() {
        return new Thing();
    }
}
class UberThing extends Thing{}
class UberThingType extends ThingType{
    @Override
    public UberThing createInstance() {
        return new UberThing();
    }
} 
```

# c - 在 Win32 上停止进程的最干净方法？

> ID：81727
> 
> 赞同：1
> 
> 时间：2008-09-17T10:15:03.857
> 
> 标签：c, user-interface, winapi, console, ipc

在用 C++ 实现应用服务器及其客户端库时，我无法找到一种干净可靠的方法来在 Windows 上的服务器关闭时停止客户端进程。

假设服务器和它的客户端在同一个用户下运行，要求是：

*   该解决方案应适用于以下情况：
    *   每个客户端都可能具有控制台或 gui。
    *   用户可能没有特权。

    *   客户端可能会或变得无响应（无限循环、死锁）。
    *   客户端可能是也可能不是服务器的孩子（直接或间接）。
*   除非被客户端缺陷阻止，否则应允许客户端有机会干净地退出（释放他们的资源，将一些数据同步到磁盘......）和一些合理的时间这样做。
*   在关闭过程中，所有客户端返回代码都应提供给服务器（如果可能）。
*   服务器将等到所有客户端都消失。

* * *

截至本次编辑，以下大多数答案都主张在服务器及其客户端之间使用共享内存（或其他 IPC 机制）来传达关闭命令和客户端状态。这些解决方案可以工作，但需要客户端成功初始化库。

我没有说的是，服务器还用于启动客户端，在某些情况下，其他程序/脚本根本不使用客户端库。不依赖于服务器和客户端之间的优雅通信的解决方案会更好（如果可能的话）。

前段时间，我偶然发现了一个 C 代码片段（我相信在 MSDN 中），它执行了以下操作：

1.  在进程中通过 CreateRemoteThread 启动一个线程来关闭。
2.  让那个线程直接调用ExitProcess。

不幸的是，现在我正在寻找它，但我无法找到它，而且搜索结果似乎暗示这个技巧在 Vista 上不再适用。对此有任何专家意见吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T12:48:42.100

如果使用线程，一个简单的解决方案是使用命名系统事件，线程在事件上休眠等待它发出信号，控制应用程序可以在它希望客户端应用程序退出时发出事件信号。

对于 UI 应用程序，它（线程）可以将消息发布到主窗口，WM_ CLOSE 或 QUIT 我忘了哪个，在控制台应用程序中它可以发出 CTRL-C 或者如果主控制台代码循环它可以检查一些退出条件由线程设置。

无论哪种方式，与其找到客户端应用程序并告诉他们退出，不如使用操作系统发出信号他们应该退出。如果它使用 WaitForSingleObject 睡眠，睡眠线程将几乎不使用 CPU 占用空间。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T10:27:18.740

您需要客户端和服务器之间的某种 IPC。如果所有客户都是孩子，我认为管道会最简单；因为它们不是，我猜服务器操作的共享内存段可用于注册客户端，发出关闭命令，并收集成功关闭的客户端发布的返回代码。

在这个共享内存区域中，客户端放置它们的进程 ID，以便服务器可以使用 TerminateProcess() 强制终止任何无响应的客户端（以服务器权限为模）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T12:51:06.523

如果你愿意走IPC路由，就让客户端和服务端正常通信双向，让服务端请求客户端关闭。或者，如果做不到这一点，让客户轮询。或者作为最后的手段，当向服务器发出请求时，应指示客户端退出。您可以让库用户注册退出回调，但我知道的最好方法是在客户端被告知关闭时简单地在客户端库中调用“退出”。如果客户端卡在关闭代码中，服务器需要能够通过忽略该客户端的数据结构和连接来解决它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-24T00:13:02.790

使用 PostMessage 或命名事件。

回复：PostMessage——除 GUI 之外的应用程序，以及除 GUI 线程之外的线程，都可以有消息循环，这对于这样的东西非常有用。（事实上​​，COM 在底层使用了消息循环。）我以前用 ATL 做过，但对它有点生疏。

如果您想对来自“不良”进程的恶意攻击具有鲁棒性，请将客户端/服务器共享的私钥作为消息中的参数之一包含在内。

命名事件方法可能更简单。使用名称为客户端/服务器共享的秘密名称的 CreateEvent，并让相应的应用程序在其主循环中检查事件的状态（例如，超时为 0 的 WaitForSingleObject）以确定是否关闭。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T10:28:20.160

这是一个非常笼统的问题，并且存在一些不一致之处。

虽然这不是 100% 的规则，但大多数控制台应用程序运行完成，而 GUI 应用程序运行直到用户终止它们（并且服务运行直到通过 SCM 停止）。因此，请求关闭 GUI 会更容易。您向他们发送相当于 Alt-F4 的内容。但是对于控制台程序，您必须向他们发送相当于 Ctrl-C 的命令并希望他们处理它。在这两种情况下，您只需等待。如果该过程持续存在，则将其击落（TerminateProcess）并祈祷损害有限。但是您的硬盘驱动器可能会装满临时文件。

GUI 应用程序通常没有退出代码——它们会去哪里？并且根据定义强制终止的控制台进程不会退出，因此它没有退出代码。因此，在服务器关闭的情况下，不要期望退出代码。

如果您连接了调试器，则通常无法从另一个应用程序关闭该进程。这将使调试器无法调试退出代码！

# .net - 是什么阻止了 C# 中的线程被收集？

> ID：81730
> 
> 赞同：16
> 
> 时间：2008-09-17T10:15:25.027
> 
> 标签：.net, multithreading, garbage-collection

在 .NET 中，在这段代码之后，什么机制可以阻止`Thread`对象被垃圾收集？

```
new Thread(Foo).Start();
GC.Collect(); 
```

是的，假设**某些东西**对线程有引用是安全的，我只是在徘徊到底是什么。出于某种原因，Reflector 没有显示给我`System.Threading`，所以我自己无法挖掘它（我知道 MS 发布了 .NET 框架的源代码，我只是手边没有它）。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-17T10:20:18.103

只要它正在运行，运行时就会保留对线程的引用。只要有人仍然保留该引用，GC 就不会收集它。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-19T10:00:35.170

这取决于线程是否正在运行。如果你刚刚创建了 Thread 对象并没有启动它，它是一个普通的托管对象，即符合 GC 条件。一旦你启动线程，或者当你为已经运行的线程（GetCurrentThread）获取线程对象时，它就有点不同了。“公开对象”，托管线程，现在在 CLR 中保持强引用，因此您始终获得相同的实例。当线程终止时，这个强引用被释放，并且一旦你没有对线程的任何其他引用（现在已经死），托管对象就会被收集。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-17T10:26:14.627

这是垃圾收集器的硬连线功能。不收集正在运行的线程。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T10:17:16.830

好吧，可以安全地假设，如果某个线程正在某个地方运行，那么某事物对其有引用，那么这不足以停止垃圾收集吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-19T09:38:17.080

不过需要注意的重要一点 - 如果您的线程标记为 IsBackground=True，它不会阻止整个进程退出

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2008-09-17T10:19:11.070

将新线程分配给本地字段？

```
class YourClass
{
  Thread thread;

  void Start()
  {
    thread = new Thread(Foo);
    thread.Start();
    GC.Collect();
  }
} 
```

垃圾收集收集不是引用的所有内容，因此在您的代码中没有引用线程的字段/变量，因此它将被收集。

# vmware - 如何杀死不会死的VMware虚拟机？

> ID：81732
> 
> 赞同：25
> 
> 时间：2008-09-17T10:15:51.373
> 
> 标签：vmware

我在服务器上运行了一个无法停止或重新启动的虚拟机 - 我无法再登录它，也无法使用 VMware 服务器控制台停止它。还有其他 VM 正在运行，因此重新启动主机是不可能的。有没有其他方法可以强制一台机器停止？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-17T10:20:06.980

如果您使用的是 linux，那么您可以使用以下命令获取来宾进程

```
ps axuw | grep vmware-vmx 
```

正如@Dubas 指出的那样，您应该能够通过 VMD 的路径名找出错误的进程

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-09-17T10:17:40.900

如果您使用的是 Windows，则虚拟机应该有自己的进程，该进程在任务管理器中可见。使用 sysinternals [Process Explorer](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)找到正确的，然后从那里杀死它。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-07-16T16:42:56.090

在某些情况下，您可能无法暂停，或者就此而言对 VM 执行任何“电源”操作。您可能还已经启动并运行了多个 VM。使用此过程来识别要杀死的正确 PID。

在 Windows 7 上 - 打开任务管理器 - 查找名称为“vmware-vmx.exe”的进程，记下 PID。

切换到性能选项卡并启动“资源监视器”。展开“磁盘活动”面板。对“文件”列进行排序。为要杀死的 VM 查找适当的 vmdk 文件。“映像”列将列出“vmware-vmx”进程。注意PID。

切换回“进程”选项卡并终止 PID。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-17T10:58:40.897

这是我根据

a）@Espo 的评论和
b）我只有 Windows 任务管理器可以玩的事实......

我登录到主机，打开任务管理器并使用视图菜单将 PID 列添加到进程选项卡。

我写下了（是的，用纸和笔）在盒子上运行的 vmware-wmx.exe 进程的每个实例的 PID。

使用 VMWare 控制台，我暂停了错误的虚拟机。

当我恢复它时，我可以识别与我的机器对应的 vmware-vmx 进程并可以杀死它。

到目前为止，似乎没有任何不良影响。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-09-07T08:19:41.083

类似，但使用 WMIC 命令行获取进程 ID 和路径：

```
WMIC /OUTPUT:C:\ProcessList.txt PROCESS get Caption,Commandline,Processid 
```

这将创建一个包含每个进程及其参数的文本文件。您可以在文件中搜索您的 VM 文件路径，并获取正确的进程 ID 以结束任务。

感谢[http://windowsxp.mvps.org/listproc.htm](http://windowsxp.mvps.org/listproc.htm)提供了正确的命令行参数。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-09-09T00:15:14.713

对于 ESXi 5，您首先需要通过 vSphere 控制台启用 ssh，然后登录并使用以下命令查找进程 ID

```
ps -c | grep -i "machine name" 
```

然后，您可以找到进程 ID 并使用结束进程`kill`

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2013-09-18T12:52:32.647

从 VMware 的网页中查看以下内容

关闭 ESXi 主机上的虚拟机 (1014165) 症状

您遇到以下问题：

```
You cannot power off an ESXi hosted virtual machine.
A virtual machine is not responsive and cannot be stopped or killed. 
```

[http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=1014165](http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=1014165)

“使用 ESXi 5.x esxcli 命令关闭虚拟机电源

esxcli 命令可用于本地或远程关闭在 ESXi 5.x 上运行的虚拟机的电源。有关详细信息，请参见 vSphere 命令行界面参考的 esxcli vm 命令部分。

```
Open a console session where the esxcli tool is available, either in the ESXi Shell, the vSphere Management Assistant (vMA), or the location where the vSphere Command-Line Interface (vCLI) is installed.

Get a list of running virtual machines, identified by World ID, UUID, Display Name, and path to the .vmx configuration file, using this command:

esxcli vm process list

Power off one of the virtual machines from the list using this command:

esxcli vm process kill --type=[soft,hard,force] --world-id=WorldNumber

Notes:
Three power-off methods are available. Soft is the most graceful, hard performs an immediate shutdown, and force should be used as a last resort.
Alternate power off command syntax is: esxcli vm process kill -t [soft,hard,force] -w WorldNumber

Repeat Step 2 and validate that the virtual machine is no longer running. 
```

对于 ESXi 4.1：

```
Get a list of running virtual machines, identified by World ID, UUID, Display Name, and path to the .vmx configuration file, using this command:

esxcli vms vm list

Power off one of the virtual machines from the list using this command:

esxcli vms vm kill --type=[soft,hard,force] --world-id=WorldNumber" 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-08-19T17:25:29.660

对于 VmWare fusion，按住`alt`键，同时单击“重新启动虚拟机”

[http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=1006215](http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=1006215)

# javascript - 关闭带有大量标记的 Yahoo 地图时避免挂起

> ID：81768
> 
> 赞同：5
> 
> 时间：2008-09-17T10:21:00.347
> 
> 标签：javascript, maps, yui, yahoo-maps

我有一个带有很多标记（〜500）的雅虎地图。在我关闭页面之前，地图的性能足够好，此时它会暂停（在 Firefox 中）并显示“停止运行此脚本？” 对话框（在 IE7 中）。如果给定足够长的时间，脚本确实完成了它的工作。

我能做些什么来减少这种延迟吗？

这个精简的代码显示了问题：

```
<script type="text/javascript">
var map = new YMap(document.getElementById('map'));
map.drawZoomAndCenter("Algeria", 17);

for (var i = 0; i < 500; i += 1) {
    var geoPoint = new YGeoPoint((Math.random()-0.5)*180.0, (Math.random()-0.5)*360.0);
    var marker = new YMarker(geoPoint);
    map.addOverlay(marker);
}
</script> 
```

如果您动态添加和删除标记，我知道事件处理程序存在一些内存泄漏，但这些是静态的（尽管问题可能是相关的）。哦，我*知道*地图上的这么多标记可能不是传达数据的最佳方式，但这不是我要寻找的答案；）

**编辑：**按照我尝试过的以下建议：

```
window.onbeforeunload = function() {
    map.removeMarkersAll();
} 
```

和

```
window.onbeforeunload = function() {
    mapElement = document.getElementById('map');
    mapElement.parentNode.removeChild(mapElement);
} 
```

但都没有工作:(

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-13T01:37:05.627

使用 Javascript 分析器，看看哪个函数慢。然后，您将更好地了解如何制定解决方法或至少如何删除昂贵的清理（并让它在 IE6 中泄漏）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T08:32:25.480

当您关闭窗口时，您确定没有尝试访问地图吗？

我会做这种类型的测试：

有一个包装器可以到达地图本身，并且在卸载时，可以让包装器块访问地图本身。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T13:40:57.060

您可以尝试删除所有标记，甚至使用“onbeforeunload”事件从 DOM 中删除地图。

# facebook - 有人在 Grails 上开发 Facebook 应用吗

> ID：81770
> 
> 赞同：7
> 
> 时间：2008-09-17T10:21:17.337
> 
> 标签：facebook, grails

我没有看到对 Grails 开发 facebook 应用程序的太多支持。我只是想知道周围的人是否正在 Grails 上开发 facebook 应用程序

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-19T21:45:51.813

约瑟夫·德兰斯菲尔德： [http ://www.grassr.com/wordpress/?cat=8](http://www.grassr.com/wordpress/?cat=8)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-09-14T14:07:53.983

我从社交网站 ESMZone.com 深入了解 Facebook 集成。我最初开始使用 Grails [facebook-connect 插件](http://www.grails.org/plugin/facebook-connect)，并在 Facebook 登录与 Grails jScurity 插件的集成方面取得了巨大成功。然而，当我尝试实现其他功能，尤其是好友邀请时，我发现 facebook-connect 插件使用的是旧的 facebook SDK，它与新的 Javascript SDK 不兼容。与旧 API 不同，使用此新 SDK 的文档和示例在搜索中很容易获得。

我切换到 Grails [facebook-graph 插件](http://www.grails.org/plugin/facebook-graph)，并且能够无缝地使用 Javascript API 并获得朋友邀请。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-02-23T00:36:47.067

上周我研究了一个仅涉及服务器端集成（没有 facebook 连接样式应用程序）的用例。在这里查看我的一些想法：http: [//lbroudoux.wordpress.com/2011/02/23/integrating-facebook-from-a-grails-app/](http://lbroudoux.wordpress.com/2011/02/23/integrating-facebook-from-a-grails-app/)。解决方案实际上是在 Trailplans.com 应用程序上实现的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-11T18:02:05.313

我帮助了旧金山的一家初创公司，该公司将 Grails 与 Facebook 应用程序一起使用。所以是的，它正在发生。甚至还有一个用于 facebook 集成的 grails 插件（在我写这篇文章的时候，它是非常不完整的，但看起来它已经完成了工作，所以很快就会再次检查它）。

# c# - C# - 从项目的发布版本中排除单元测试

> ID：81784
> 
> 赞同：24
> 
> 时间：2008-09-17T10:22:47.550
> 
> 标签：c#, .net, unit-testing, assemblies, reference

你通常如何**分离你的代码库和相关的单元测试**？我认识一些为单元测试创​​建单独项目的人，我个人觉得这很混乱且难以维护。另一方面，如果您将代码及其测试混合在一个项目中，您最终会得到与您的单元测试框架（无论是 NUnit、MbUnit 还是其他任何东西）相关的二进制文件和您自己的二进制文件。

这对于调试来说很好，但是一旦我构建了**发布版本**，我真的不希望我的代码再**引用单元测试框架**。

我发现的一种解决方案是将所有单元测试包含在#if DEBUG -- #endif 指令中：当没有代码引用单元测试程序集时，编译器足够聪明，可以忽略编译代码中的引用。

是否有任何其他（可能更舒适）的选择来实现类似的目标？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-09-17T10:24:09.683

我绝对主张将您的测试分离到一个单独的项目中。在我看来，这是唯一的出路。

是的，正如[Gary](https://stackoverflow.com/users/6369/garry-shutler)所说，它还迫使您通过公共方法测试行为，而不是玩弄类的内部结构

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-09-17T10:37:37.437

正如其他人指出的那样，一个单独的测试项目（对于每个普通项目）是一个很好的方法。我通常镜像命名空间并为每个普通类创建一个测试类，并在名称后附加“test”。如果您拥有可以在另一个项目中自动生成测试类和方法的 Visual Studio Team System，则直接在 IDE 中支持这一点。

如果您想使用“内部”访问器测试类和方法，需要记住的一件事是将以下行添加到每个要测试的项目的 AssemblyInfo.cs 文件中：

```
[assembly: InternalsVisibleTo("UnitTestProjectName")] 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-17T10:37:32.633

v2 之后的 .Net 框架有一个有用的功能，您可以使用 InternalsVisibleTo 属性标记程序集，该属性允许其他人访问该程序集。
一种装配隧道功能。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-23T13:43:51.207

在文件中使用编译器指令或创建单独项目的另一种替代方法是仅在项目中创建额外的 .cs 文件。

借助项目文件本身的一些魔力，您可以指定：

1.  nunit.framework DLL 仅在调试版本中引用，并且
2.  您的测试文件仅包含在调试版本中

示例 .csproj 摘录：

```
<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="3.5">

   ...

   <Reference Include="nunit.framework" Condition=" '$(Configuration)'=='Debug' ">
      <SpecificVersion>False</SpecificVersion>
      <HintPath>..\..\debug\nunit.framework.dll</HintPath>
   </Reference>

   ...

   <Compile Include="Test\ClassTest.cs" Condition=" '$(Configuration)'=='Debug' " />

   ...
</Project> 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-17T10:32:20.257

我会推荐一个单独的单元测试项目（还有更多的集成测试、功能测试等项目）。我尝试在同一个项目中混合代码和测试，发现它比将它们分成单独的项目更难维护。

维护并行命名空间并为测试使用合理的命名约定（例如 MyClass 和 MyClassTest）将帮助您保持代码库的可维护性。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-17T10:45:40.537

只要您的测试位于单独的项目中，测试就可以引用代码库，但代码库永远不必引用测试。我不得不问，维护两个项目有什么困惑？您可以将它们保留在相同的组织解决方案中。

当然，复杂的部分是当企业在解决方案中有 55 个项目并且其中 60% 是测试时。算自己幸运。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-17T11:31:29.523

我将测试放在一个单独的项目中，但在同一个解决方案中。诚然，在大型解决方案中可能会有很多项目，但解决方案资源管理器在分离它们方面已经足够好了，如果你给所有的东西都提供合理的名称，我真的不认为这是一个问题。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-13T15:19:28.883

需要考虑的一件事是 2005 年之前的 VisualStudio 版本不允许从其他项目引用 EXE 程序集项目。因此，如果您在 VS.NET 中处理遗留项目，您的选择将是：

*   将单元测试放在同一个项目中，并使用条件编译将它们从发布版本中排除。
*   将所有内容移至 dll 程序集，以便您的 exe 只是一个入口点。
*   通过在文本编辑器中破解项目文件来绕过 IDE。

三个条件编译中最不容易出错。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-17T10:24:38.280

我一直将我的单元测试保存在一个单独的项目中，以便它编译成它自己的程序集。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-17T10:27:20.067

对于每个项目，都有一个相应的 .Test 项目，其中包含对它的测试。

例如，对于名为“Acme.BillingSystem.Utils”的程序集，会有一个名为“Acme.BillingSystem.Utils.Test”的测试程序集。

通过不发送该 dll 将其从产品的发货版本中排除。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-07-08T15:12:05.953

如果**#if(DEBUG)**标签允许一个干净的“发布”版本，为什么你需要一个单独的项目进行测试。nunit LibarryA/B 示例（是的，我知道它是一个示例）就是这样做的。目前正在与场景搏斗。一直在使用一个单独的项目，但这似乎可能会提高一些生产力。仍然是hummin和hawin。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-17T10:42:54.600

我绝对同意其他所有人的观点，即您应该将测试与生产代码分开。但是，如果您坚持不这样做，您应该定义一个称为 TEST 的条件编译常量，并用

```
#if TEST
#endif 
```

首先要确保测试代码不会在生产场景中编译。完成后，您应该能够从生产部署中排除测试 dll，或者更好（但维护更高），为生产创建 NAnt 或 MSBuild，在没有对测试 dll 的引用的情况下进行编译。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-17T11:20:13.123

我总是创建一个单独编译的 Acme.Stuff.Test 项目。

相反的论点是：您为什么要进行测试？为什么不交付测试？如果您与测试运行程序一起交付测试，您将获得与产品一起交付的某种程度的验收测试和自测。

我已经多次听到这个论点并考虑过，但我个人仍然将测试保留在一个单独的项目中。

# java - 我可以向 Java 中的 String 类添加新方法吗？

> ID：81786
> 
> 赞同：28
> 
> 时间：2008-09-17T10:23:39.653
> 
> 标签：java, string

我想`AddDefaultNamespace()`在 Java 中的 String 类中添加一个方法，以便我可以键入`"myString".AddDefaultNamespace()`而不是`DEFAULTNAMESPACE + "myString"`, 以获得类似`"MyDefaultNameSpace.myString"`. 我也不想添加另一个派生类（`PrefixedString`例如）。

也许这种方法对您不利，但我个人讨厌使用`+`. 但是，无论如何，是否可以在 Java 中向 String 类添加新方法？

谢谢并恭祝安康。

* * *

## 回答 #1

> 赞同：67
> 
> 时间：2008-09-17T10:25:49.900

`String`是一个最终类，这意味着它不能扩展为在您自己的实现上工作。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2011-07-24T11:09:13.633

好吧，实际上每个人都缺乏想象力。我需要编写自己的startsWith 方法版本，因为我需要一个不区分大小写的方法。

```
class MyString{
    public String str;
    public MyString(String str){
        this.str = str;
    }
    // Your methods.
} 
```

那么这很简单，你可以这样制作你的字符串：

```
MyString StringOne = new MyString("Stringy stuff"); 
```

当您需要调用 String 库中的方法时，只需这样做：

```
StringOne.str.equals(""); 
```

或类似的东西，你有它...... String 类的扩展。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-09-17T14:01:02.877

正如其他人所指出的那样，您不允许扩展 String （由于 final ）。但是，如果您真的很疯狂，您可以修改 String 本身，将其放入 jar 中，并在 bootclasspath 前面加上 -Xbootclasspath/p:myString.jar 以实际替换内置的 String 类。

由于我不会进入的原因，我实际上之前已经这样做过。您可能有兴趣知道，即使您可以替换该类，但 String 在 Java 的各个方面的内在重要性意味着它在整个 JVM 启动过程中都会使用，并且某些更改只会破坏 JVM。添加新方法或构造函数似乎没有问题。添加新字段非常冒险 - 特别是添加对象或数组似乎会破坏事物，尽管添加原始字段似乎有效。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-17T10:27:42.390

这是不可能的，因为 String 是 Java 中的 final 类。

您可以一直使用辅助方法来为某些内容添加前缀。如果你不喜欢，你可以研究一下 Groovy 或 Scala、JRuby 或 JPython，它们都是与 Java 兼容的 JVM 语言，并且允许此类扩展。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-17T10:34:45.290

类声明几乎说明了一切，因为你不能继承它，因为它是最终的。您当然可以实现自己的字符串类，但这很可能只是一个麻烦。

```
public final class String 
```

C# (.net 3.5) 具有使用扩展方法的功能，但遗憾的是 java 没有。有一些名为 nice [http://nice.sourceforge.net/](http://nice.sourceforge.net/)的 java 扩展，虽然这似乎为 java 添加了相同的功能。

以下是您将如何使用 Nice 语言（Java 的扩展）编写示例：

```
private String someMethod(String s)
{
   return s.substring(0,1);

}

void main(String[] args)
{
   String s1 = "hello";
   String s2 = s1.someMethod();
   System.out.println(s2);

} 
```

[您可以在http://nice.sf.net](http://nice.sf.net)找到更多关于尼斯的信息

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2018-05-18T13:54:45.250

**是的！**

根据您的要求（向 String 添加不同的命名空间而不使用派生类），您可以使用 Lombok 项目来做到这一点，并在 String 上使用如下功能：

```
String i = "This is my String";
i.numberOfCapitalCharacters(); // = 2 
```

使用 Gradle 和 IntelliJ IDEA 的步骤如下：

1.  从 intelliJ 插件存储库下载 lombok 插件。
2.  将 lombok 添加到 gradle 中的依赖项，如下所示：`compileOnly 'org.projectlombok:lombok:1.16.20'`
3.  转到`"Settings > Build > Compiler > Annotation Processors"`并启用注释处理
4.  使用您的扩展函数创建一个类并添加一个静态方法，如下所示：

    ```
    public class Extension {
        public static String appendSize(String i){
            return i + " " + i.length();
        }
    } 
    ```

5.  注释要在其中使用方法的类，如下所示：

    ```
    import lombok.experimental.ExtensionMethod;

    @ExtensionMethod({Extension.class})
    public class Main {
        public static void main(String[] args) {
            String i = "This is a String!";
            System.out.println(i.appendSize());
        }
    } 
    ```

现在您可以`.appendSize()`在任何类中的任何字符串上使用该方法，只要您已对其进行注释并为上述示例生成结果

> 这是一个字符串！

将会：

> 这是一个字符串！17

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-17T10:29:20.703

不可能，这是一件好事。一个字符串就是一个字符串。它的行为是有定义的，偏离它就是邪恶的。此外，它被标记为 final，这意味着即使你想也不能继承它。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-17T10:47:34.357

正如其他人所说，不，你不能继承 String 因为它是最终的。但是可能会有类似以下的帮助吗？

```
public final class NamespaceUtil {

    // private constructor cos this class only has a static method.
    private NamespaceUtil() {}

    public static String getDefaultNamespacedString(
            final String afterDotString) {
        return DEFAULT_NAMESPACE + "." + afterDotString;
    }

} 
```

或许：

```
public final class NamespacedStringFactory {

    private final String namespace;

    public NamespacedStringFactory(final String namespace) {
        this.namespace = namespace;
    }

    public String getNamespacedString(final String afterDotString) {
        return namespace + "." + afterDotString;
    }

} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-05-24T06:50:26.937

使用关键字“将方法添加到内置类”搜索的人可能会在这里结束。如果您希望将方法添加到诸如 HashMap 之类的非 final 类中，您可以执行类似的操作。

```
public class ObjectMap extends HashMap<String, Object> {

    public Map<String, Object> map;

    public ObjectMap(Map<String, Object> map){
        this.map = map;
    }

    public int getInt(String K) {
        return Integer.valueOf(map.get(K).toString());
    }

    public String getString(String K) {
        return String.valueOf(map.get(K));
    }

    public boolean getBoolean(String K) {
        return Boolean.valueOf(map.get(K).toString());
    }

    @SuppressWarnings("unchecked")
    public List<String> getListOfStrings(String K) {
        return (List<String>) map.get(K);
    }

    @SuppressWarnings("unchecked")
    public List<Integer> getListOfIntegers(String K) {
        return (List<Integer>) map.get(K);
    }

    @SuppressWarnings("unchecked")
    public List<Map<String, String>> getListOfMapString(String K) {
        return (List<Map<String, String>>) map.get(K);
    }

    @SuppressWarnings("unchecked")
    public List<Map<String, Object>> getListOfMapObject(String K) {
        return (List<Map<String, Object>>) map.get(K);
    }

    @SuppressWarnings("unchecked")
    public Map<String, Object> getMapOfObjects(String K) {
        return (Map<String, Object>) map.get(K);
    }

    @SuppressWarnings("unchecked")
    public Map<String, String> getMapOfStrings(String K) {
        return (Map<String, String>) map.get(K);
    }
} 
```

现在将此类的新实例定义为：

```
ObjectMap objectMap = new ObjectMap(new HashMap<String, Object>(); 
```

现在您可以访问内置 Map 类的所有方法，以及新实现的方法。

```
objectMap.getInt("KEY"); 
```

**编辑：**

在上面的代码中，要访问地图类的内置方法，您必须使用

```
objectMap.map.get("KEY"); 
```

这是一个更好的解决方案：

```
public class ObjectMap extends HashMap<String, Object> {

    public ObjectMap() {

    }

    public ObjectMap(Map<String, Object> map){
        this.putAll(map);
    }

    public int getInt(String K) {
        return Integer.valueOf(this.get(K).toString());
    }

    public String getString(String K) {
        return String.valueOf(this.get(K));
    }

    public boolean getBoolean(String K) {
        return Boolean.valueOf(this.get(K).toString());
    }

    @SuppressWarnings("unchecked")
    public List<String> getListOfStrings(String K) {
        return (List<String>) this.get(K);
    }

    @SuppressWarnings("unchecked")
    public List<Integer> getListOfIntegers(String K) {
        return (List<Integer>) this.get(K);
    }

    @SuppressWarnings("unchecked")
    public List<Map<String, String>> getListOfMapString(String K) {
        return (List<Map<String, String>>) this.get(K);
    }

    @SuppressWarnings("unchecked")
    public List<Map<String, Object>> getListOfMapObject(String K) {
        return (List<Map<String, Object>>) this.get(K);
    }

    @SuppressWarnings("unchecked")
    public Map<String, Object> getMapOfObjects(String K) {
        return (Map<String, Object>) this.get(K);
    }

    @SuppressWarnings("unchecked")
    public Map<String, String> getMapOfStrings(String K) {
        return (Map<String, String>) this.get(K);
    }

    @SuppressWarnings("unchecked")
    public boolean getBooleanForInt(String K) {
        return Integer.valueOf(this.get(K).toString()) == 1 ? true : false;
    }
} 
```

现在你不必打电话

```
objectMap.map.get("KEY"); 
```

只需调用

```
objectMap.get("KEY"); 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-17T10:29:24.180

更好地使用 StringBuilder，它具有方法 append() 并且可以完成您想要的工作。String 类是最终的，不能扩展。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2017-07-24T13:50:02.047

不，您不能在 java 中修改字符串类。因为这是最后一节课。并且默认情况下存在于最终类中的每个方法都是最终的。

String 是不可变或 final 的绝对最重要的原因是它被类加载机制使用，因此具有深刻和基本的安全方面。

如果 String 是可变的或不是最终的，加载“java.io.Writer”的请求可能已更改为加载“mil.vogoon.DiskErasingWriter”

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-17T10:38:53.363

Java String 类是 final 类，使其不可变。这是出于效率原因，并且在逻辑上没有错误地扩展将是极其困难的；因此，实现者选择使其成为最终类，这意味着它不能通过继承进行扩展。

[根据单一职责原则](http://www.oodesign.com/single-responsibility-principle.html)，您希望您的类支持的功能不是 String 的常规职责的一部分，它是一个不同的抽象，它更专业。因此，您应该定义一个新类，其中包括 String 一个成员并支持您提供所需的命名空间管理所需的方法。

不要害怕添加抽象（类），这些是良好 OO 设计的精髓。

尝试使用[类责任协作 (CRC) 卡](http://en.wikipedia.org/wiki/Class-Responsibility-Collaboration_card) 来阐明您需要的抽象。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-01-16T14:11:19.477

以上都是其他贡献者所说的。您不能直接扩展 String 因为它是最终的。

如果您要使用 Scala，则可以使用如下隐式转换：

```
object Snippet {
  class MyString(s:String) {
    def addDefaultNamespace = println("AddDefaultNamespace called")
  }
  implicit def wrapIt(s:String) = new MyString(s)

  /** test driver */
  def main(args:Array[String]):Unit = {
    "any java.io.String".addDefaultNamespace // !!! THAT is IT! OR?
  } 
```

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2008-09-17T10:39:01.320

您可以创建自己的 String 类版本并添加一个方法 :-)

* * *

## 回答 #15

> 赞同：-2
> 
> 时间：2008-09-17T10:41:39.173

实际上，您可以修改 String 类。如果您编辑位于 src.zip 中的 String.java 文件，然后重新构建 rt.jar，则 String 类将拥有更多由您添加的方法。缺点是该代码只能在您的计算机上运行，​​或者如果您提供您的 String.class，并将其放置在默认路径之前的类路径中。

# .net - .Net 开发人员使用什么 3rd 方控件

> ID：81787
> 
> 赞同：16
> 
> 时间：2008-09-17T10:23:45.863
> 
> 标签：.net, controls, infragistics

我正在重新评估我的第 3 方控制。我目前使用 ASP.Net 和 WinForms 的 Infragistics 工具套件。您使用什么控件，您会推荐它们吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-17T10:32:54.330

我更喜欢[DevExpress](http://www.devexpress.com/)。它的组件在我看来比 Infragistic 的更直观。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-17T14:45:39.463

Telerik 在 asp.net 方面相当多产且易于使用。尽管您会发现自己在其中破解了一些功能，然后每次更新都会破坏您的破解时更改代码..尽管它们仍然比重新发明轮子更容易。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-17T10:41:57.100

[DevExpress](http://www.devexpress.com/)的东西，一路走来。获得较大的 DevEx 订阅的一个很大的副作用是您获得 CodeRush 和 Refactor！也扔进去了：D

尤其是 DevEx 网格，它是首屈一指的。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-17T10:29:37.473

我可以推荐[Telerik](http://www.telerik.com/) for ASP.NET。它们非常好，但只会将它们用于 Intranet 应用程序，因为它们大多功能强大但很重。对于 WinForms [，DevComponents](http://www.devcomponents.com/)拥有一组出色的组件。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-17T10:45:38.290

我使用过[Telerik](http://www.telerik.com/)、[Syncfusion](http://www.syncfusion.com/)和[Infragistics](http://www.infragistics.com/)第三方控件，我会按此顺序对它们进行评分。

Telerik 控件比 Infragistics 更易于使用。

我的 0.02 美元。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-17T11:08:46.457

我将 DevExpress 用于 WinForms 应用程序，主要用于 XtraGrid。

然而，丰富的功能是有代价的：

*   您的开发团队必须学习并接受有时复杂的设计。

*   有些事情不能正常工作，你需要可怕的黑客来解决限制。幸运的是，DevExpress 支持通常在提供解决方案和变通方法方面非常敏感。

*   有些事情根本不起作用——例如，XtraGrid 不正确地支持从网格中逐行保存数据。

*   许可非常有限：在开发机器上安装许可副本需要连接到 DevExpress 的服务器；我不知道如果 DevExpress 走雷曼兄弟的道路会发生什么。在缓解措施中，源代码许可证的价格合理。

总的来说，我对这个选择感到满意。但我想在提出建议之前对竞争（例如 Infragistics）进行深入评估。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-17T12:50:56.557

Peter Blum 的数据输入套件

[http://www.peterblum.com/DES/Home.aspx](http://www.peterblum.com/DES/Home.aspx)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-17T14:40:19.913

我只使用了基础设施，但不会真正推荐它。为了复杂，它通常看起来很复杂，更不用说我在其中看到了多个错误。此外，在网络领域，它不是很兼容跨浏览器。很多 App Stylist 的东西并不能很好地转换到 Firefox，而且 WebCombo 在新的 Google Chrome/Chromium 浏览器中非常糟糕。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-22T17:09:07.290

适用于 Windows 窗体和 ASP.net 的 DevExpress。有一个学习曲线，但是一旦你了解了事情的运作方式，你就没有什么是做不到的。几年前我们使用调度程序时，它是市场上最好的。网格和图表让客户大吃一惊。他们的支持通常很及时。当您尝试执行控件无法执行的操作时，您会经常看到在未来版本中添加了该功能。

底线：好东西！

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-11-13T06:11:55.353

到目前为止，我只做过 Winforms，并且使用过 Infragistics、devexpress 和 januscontrols。

我可以建议您使用**devexpress**。
最快的运行时执行，良好的社区，良好的在线支持

**Infragistics**是非常重的控件，大量的属性，难以使用
和支持论坛，知识库及其主页-会员区非常可怕。

**januscontrols**轻量级且易于使用，但不如其他控件强大。
运行时执行不如 devexpress

来自我的博客
[这些控件的比较，以及详细信息......](http://peitor.blogspot.com/2007/02/infragistics-controls-compared.html)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-17T10:41:09.863

基础设施网络优势

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-17T12:22:02.193

我第二个 DevExpress - 尽管它们并不总是最终的解决方案。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-17T14:15:16.947

仅使用 Infragistics 和 Janus 控件。

基础设施还可以，但不是很好。

我希望我不必再次使用 Janus，这是最糟糕且不直观的 API 之一。只需单击几下，我就可以使提供的示例崩溃...

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-21T07:45:50.270

除了其他答案，我不想忘记[Intersoft](http://www.intersoftpt.com/)的控件：Webgrid、WebCombo、WebDesktop 等等。

我使用它们（除了其他供应商的控件）多年。尤其是webgrid非常专业。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-03-28T05:05:24.000

DevExpress 也得到了我的投票，我和我的开发团队在过去 3 年中一直在使用 Enterprise 包，它达到了我们的期望。我们喜欢 DevExpress 的一件事是他们拥有出色的支持并不断更新他们的套件。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-06-03T19:35:31.407

无论你做什么，都*不要*使用 ComponentArt....可怕的工具，充满错误，糟糕的支持。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-06-03T19:38:42.307

Telerik、DevExpress、Peter Blum 验证控件都很好。尽管我们不再使用服务器控件来完成只能在客户端完成的事情，而是开始尽可能多地使用 jQuery。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2010-03-28T21:39:22.900

老实说，Syncfusion 是可怕的控件，因为客户的原因，已经使用了 2 年。糟糕的控制，糟糕的架构，没有文档。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2010-07-19T21:02:24.850

我正在使用 Xceed 的 DataGrid 和来自 DevComponents 的许多不同的组件。

此外，Xceed 有一套非凡的文档和代码示例。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-09-17T10:29:09.500

Telerik - RAD 编辑器、树和图表 - 不错的应用程序

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-09-17T10:59:08.417

我们选择[Syncfusion](http://www.syncfusion.com)主要是因为它几乎可以完全处理 RightToLeft - 他们仍然到处都有一些错误，但他们非常关注问题、错误和功能请求。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2009-02-26T14:15:11.900

我现在工作的客户端也在使用 SyncFusion Essential Suite。我们主要使用 Excel 和 Word IO 库，对此我很满意。它们还提供了许多 ASP.NET Ajax 控件，其中一个非常广泛的 DataGrid。这提供了相当多的功能，但不幸的是表现不佳。总而言之，价格比 Telerik 组件便宜一点，这就是客户最终决定购买它的原因。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2010-01-15T18:01:27.303

多年来，我们已经在我们的一个项目中广泛使用了 ComponentArt。它们在某种程度上很有用，因为时不时地会有一个要求，即使用现有的 API 是不可能实现的。

在另一个项目中也使用过 Infragistics，现在正在开发一个使用 Telerik 的项目，我可以告诉你一件事：花一些额外的钱购买一个包含完整源代码的控制套件。迟早你会遇到一个限制，随身携带源代码将是一个很大的帮助。

当然，更改源代码的缺点是它会在新版本到来时变得过时，但最好还是向控制套件供应商请求一个功能，然后希望它会成为下一个版本的一部分。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2010-03-28T21:53:38.803

从我所看到的intersoft网格似乎很慢

# ruby - 线程池死锁

> ID：81788
> 
> 赞同：14
> 
> 时间：2008-09-17T10:24:06.097
> 
> 标签：ruby, multithreading, threadpool, deadlock

我找不到适合 Ruby 的 ThreadPool 实现，所以我写了我的（部分基于这里的代码：http://web.archive.org/web/20081204101031/http://snippets.dzone.com: [80/ posts/show/3276](http://web.archive.org/web/20081204101031/http://snippets.dzone.com:80/posts/show/3276) ,但更改为等待/信号和其他实现 ThreadPool 关闭。但是在运行一段时间后（有 100 个线程并处理大约 1300 个任务），它在第 25 行因死锁而死 - 它等待新工作有任何想法，为什么会发生？

```
require 'thread'
begin
  require 'fastthread'
rescue LoadError
  $stderr.puts "Using the ruby-core thread implementation"
end 

class ThreadPool
  class Worker
    def initialize(callback)
      @mutex = Mutex.new
      @cv = ConditionVariable.new
      @callback = callback
      @mutex.synchronize {@running = true}
      @thread = Thread.new do
        while @mutex.synchronize {@running}
          block = get_block
          if block
            block.call
            reset_block
            # Signal the ThreadPool that this worker is ready for another job
            @callback.signal
          else
            # Wait for a new job
            @mutex.synchronize {@cv.wait(@mutex)} # <=== Is this line 25?
          end
        end
      end
    end

    def name
      @thread.inspect
    end

    def get_block
      @mutex.synchronize {@block}
    end

    def set_block(block)
      @mutex.synchronize do
        raise RuntimeError, "Thread already busy." if @block
        @block = block
        # Signal the thread in this class, that there's a job to be done
        @cv.signal
      end
    end

    def reset_block
      @mutex.synchronize {@block = nil}
    end

    def busy?
      @mutex.synchronize {!@block.nil?}
    end

    def stop
      @mutex.synchronize {@running = false}
      # Signal the thread not to wait for a new job
      @cv.signal
      @thread.join
    end
  end

  attr_accessor :max_size

  def initialize(max_size = 10)
    @max_size = max_size
    @workers = []
    @mutex = Mutex.new
    @cv = ConditionVariable.new
  end

  def size
    @mutex.synchronize {@workers.size}
  end

  def busy?
    @mutex.synchronize {@workers.any? {|w| w.busy?}}
  end

  def shutdown
    @mutex.synchronize {@workers.each {|w| w.stop}}
  end
  alias :join :shutdown

  def process(block=nil,&blk)
    block = blk if block_given?
    while true
      @mutex.synchronize do
         worker = get_worker 
         if worker
           return worker.set_block(block)
         else
           # Wait for a free worker
           @cv.wait(@mutex)
         end
      end
    end
  end

  # Used by workers to report ready status
  def signal
    @cv.signal
  end

  private
  def get_worker
    free_worker || create_worker
  end

  def free_worker
    @workers.each {|w| return w unless w.busy?}; nil
  end

  def create_worker
    return nil if @workers.size >= @max_size
    worker = Worker.new(self)
    @workers << worker
    worker
  end
end 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-17T12:49:26.060

好的，所以实现的主要问题是：如何确保没有信号丢失并避免死锁？

根据我的经验，使用条件变量和互斥锁很难实现，但使用信号量很容易。碰巧 ruby​​ 实现了一个名为 Queue（或 SizedQueue）的对象，它应该可以解决问题。这是我建议的实现：

```
require 'thread'
begin
  require 'fasttread'
rescue LoadError
  $stderr.puts "Using the ruby-core thread implementation"
end

class ThreadPool
  class Worker
    def initialize(thread_queue)
      @mutex = Mutex.new
      @cv = ConditionVariable.new
      @queue = thread_queue
      @running = true
      @thread = Thread.new do
        @mutex.synchronize do
          while @running
            @cv.wait(@mutex)
            block = get_block
            if block
              @mutex.unlock
              block.call
              @mutex.lock
              reset_block
            end
            @queue << self
          end
        end
      end
    end

    def name
      @thread.inspect
    end

    def get_block
      @block
    end

    def set_block(block)
      @mutex.synchronize do
        raise RuntimeError, "Thread already busy." if @block
        @block = block
        # Signal the thread in this class, that there's a job to be done
        @cv.signal
      end
    end

    def reset_block
      @block = nil
    end

    def busy?
      @mutex.synchronize { !@block.nil? }
    end

    def stop
      @mutex.synchronize do
        @running = false
        @cv.signal
      end
      @thread.join
    end
  end

  attr_accessor :max_size

  def initialize(max_size = 10)
    @max_size = max_size
    @queue = Queue.new
    @workers = []
  end

  def size
    @workers.size
  end

  def busy?
    @queue.size < @workers.size
  end

  def shutdown
    @workers.each { |w| w.stop }
    @workers = []
  end

  alias :join :shutdown

  def process(block=nil,&blk)
    block = blk if block_given?
    worker = get_worker
    worker.set_block(block)
  end

  private

  def get_worker
    if !@queue.empty? or @workers.size == @max_size
      return @queue.pop
    else
      worker = Worker.new(@queue)
      @workers << worker
      worker
    end
  end

end 
```

这是一个简单的测试代码：

```
tp = ThreadPool.new 500
(1..1000).each { |i| tp.process { (2..10).inject(1) { |memo,val| sleep(0.1); memo*val }; print "Computation #{i} done. Nb of tasks: #{tp.size}\n" } }
tp.shutdown 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2010-01-14T09:25:10.403

您可以尝试[work_queue](http://gemcutter.org/gems/work_queue) gem，它旨在协调生产者和工作线程池之间的工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T11:06:14.700

我在这里略有偏见，但我建议用一些过程语言对此进行建模并对其进行模型检查。免费提供的工具有，例如 mCRL2 工具集（使用基于 ACP 的语言）、Mobility Workbench（pi-calculus）和 Spin (PROMELA)。

否则，我建议删除对问题而言并非必不可少的每一段代码，并找到发生死锁的最小情况。我怀疑 100 个线程和 1300 个任务对于获得死锁是必不可少的。对于较小的情况，您可能只需添加一些调试打印，它们提供足够的信息来解决问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T11:09:48.390

好的，问题似乎出在您的 ThreadPool#signal 方法中。可能发生的情况是：

1 - 你所有的工人都很忙，你试图处理一份新工作

2 - 第 90 行得到一个 nil 工人

3 - 一个工作人员被释放并发出信号，但由于线程池没有等待它，所以信号丢失了

4 - 你掉在第 95 行，即使有空闲的工人也在等待。

这里的错误是即使没有人在听，您也可以向空闲的工作人员发出信号。这个 ThreadPool#signal 方法应该是：

```
def signal
     @mutex.synchronize { @cv.signal }
end 
```

Worker 对象中的问题也是一样的。可能发生的情况是：

1 - 工人刚刚完成了一项工作

2 - 检查（第 17 行）是否有工作在等待：没有

3 - 线程池发送一个新作业并发出信号......但是信号丢失了

4 - 工作人员等待信号，即使它被标记为忙

您应该将您的初始化方法设置为：

```
def initialize(callback)
  @mutex = Mutex.new
  @cv = ConditionVariable.new
  @callback = callback
  @mutex.synchronize {@running = true}
  @thread = Thread.new do
    @mutex.synchronize do
      while @running
        block = get_block
        if block
          @mutex.unlock
          block.call
          @mutex.lock
          reset_block
          # Signal the ThreadPool that this worker is ready for another job
          @callback.signal
        else
          # Wait for a new job
          @cv.wait(@mutex)
        end
      end
    end
  end
end 
```

接下来，Worker#get_block 和 Worker#reset_block 方法不应该再同步了。这样，您就不能在测试块和等待信号之间将块分配给工作人员。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-08-09T14:34:47.603

多年来，顶级评论者的代码提供了很多帮助。在这里，它针对 ruby​​ 2.x 进行了更新，并通过线程识别进行了改进。那是如何改进的？当每个线程都有一个 ID 时，您可以将 ThreadPool 与一个存储任意信息的数组组成。一些想法：

*   无数组：典型的 ThreadPool 用法。即使使用 GIL，它也使线程死去很容易编码，并且对于高延迟应用程序（如大容量网络爬虫）非常有用，
*   ThreadPool 和 Array 大小与 CPU 数量一致：易于 fork 进程以使用所有 CPU，
*   ThreadPool 和 Array 大小取决于资源数量：例如，每个数组元素代表一个跨实例池的处理器，因此如果您有 10 个实例，每个实例有 4 个 CPU，TP 可以管理跨 40 个子进程的工作。

对于最后两个，与其考虑线程在做工作，不如考虑 ThreadPool 管理正在做工作的子进程。管理任务是轻量级的，当与子流程结合时，谁关心 GIL。

使用这个类，您可以用大约一百行代码编写一个基于集群的 MapReduce！这段代码非常简短，尽管要完全理解它可能有点费力。希望能帮助到你。

```
# Usage:
#
#   Thread.abort_on_exception = true # help localize errors while debugging
#   pool = ThreadPool.new(thread_pool_size)
#   50.times {|i|
#     pool.process { ... }
#     or
#     pool.process {|id| ... } # worker identifies itself as id
#   }
#   pool.shutdown()

class ThreadPool

  require 'thread'

  class ThreadPoolWorker

    attr_accessor :id

    def initialize(thread_queue, id)
      @id = id # worker id is exposed thru tp.process {|id| ... }
      @mutex = Mutex.new
      @cv = ConditionVariable.new
      @idle_queue = thread_queue
      @running = true
      @block = nil
      @thread = Thread.new {
        @mutex.synchronize {
          while @running
            @cv.wait(@mutex) # block until there is work to do
            if @block
              @mutex.unlock
              begin
                @block.call(@id)
              ensure
                @mutex.lock
              end
              @block = nil
            end
            @idle_queue << self
          end
        }
      }
    end

    def set_block(block)
      @mutex.synchronize {
        raise RuntimeError, "Thread is busy." if @block
        @block = block
        @cv.signal # notify thread in this class, there is work to be done
      }
    end

    def busy?
      @mutex.synchronize { ! @block.nil? }
    end

    def stop
      @mutex.synchronize {
        @running = false
        @cv.signal
      }
      @thread.join
    end

    def name
      @thread.inspect
    end
  end

  attr_accessor :max_size, :queue

  def initialize(max_size = 10)
    @process_mutex = Mutex.new
    @max_size = max_size
    @queue = Queue.new # of idle workers
    @workers = []      # array to hold workers

    # construct workers
    @max_size.times {|i| @workers << ThreadPoolWorker.new(@queue, i) }

    # queue up workers (workers in queue are idle and available to
    # work).  queue blocks if no workers are available.
    @max_size.times {|i| @queue << @workers[i] }

    sleep 1 # important to give threads a chance to initialize
  end

  def size
    @workers.size
  end

  def idle
    @queue.size
  end

  # are any threads idle

  def busy?
    # @queue.size < @workers.size
    @queue.size == 0 && @workers.size == @max_size
  end

  # block until all threads finish

  def shutdown
    @workers.each {|w| w.stop }
    @workers = []
  end

  alias :join :shutdown

  def process(block = nil, &blk)
    @process_mutex.synchronize {
      block = blk if block_given?
      worker = @queue.pop # assign to next worker; block until one is ready
      worker.set_block(block) # give code block to worker and tell it to start
    }
  end

end 
```

# mfc - VFW（Windows 视频）API 是否支持 Alpha 通道透明度？

> ID：81791
> 
> 赞同：0
> 
> 时间：2008-09-17T10:24:12.603
> 
> 标签：mfc, alpha, visual-c++-6, vfw, color-channel

VFW（Windows 视频）API 是否支持 Alpha 通道透明度？我希望能够导出带有 Alpha 通道信息的视频。如何在 VC6 中做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T10:25:42.723

我很确定确实如此；只需将像素格式设置为 RGB32，它应该会给你一个 alpha 通道来使用。

当然，找到适合您所有需求并支持 alpha 通道的视频压缩格式是另一个问题。

# ruby-on-rails - Rails 还是 Grails？

> ID：81830
> 
> 赞同：27
> 
> 时间：2008-09-17T10:28:54.337
> 
> 标签：ruby-on-rails, ruby, grails, groovy

Grails 与 Rails。哪个支持更好？哪一个是开发中型应用程序的更好选择？最重要的是哪个插件多？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-09-18T13:48:48.407

另一件值得一提的事情：两个框架的设计理念在模型方面有些不同。Grails 更“面向领域”，而 Rails 更“面向数据库”。
在 Rails 中，您基本上是从定义表开始（使用字段名称及其细节）。然后 ActiveRecord 会将它们映射到 Ruby 类或模型。
在 Grails 中，情况正好相反：您从定义模型（Groovy 类）开始，当您点击运行时，GORM（Grails ActiveRecord 等效项）将创建相关的数据库和表（或更新它们）。这也可能是您在 Grails 中没有“迁移”概念的原因（尽管我认为它会在未来的某个版本中出现）。
我不知道一个是否比另一个更好。我想这取决于你的上下文。

话虽如此，我仍然在想选择哪一个。正如 Tom 所说，如果您依赖 Java，您仍然可以选择 JRuby——因此 Java 重用不应该是您的唯一标准。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-09-17T10:33:31.817

我想如果您是一名 Java 开发人员并且想要访问所有现有的企业 Java 库和功能……请选择 Grails。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-17T11:08:44.757

Rails 更成熟，有更多插件，有更大的用户群，有更好的文档和支持。如果需要，它还可以在 JRuby 上运行，从而可以访问 Java 库。

Grails 有一些有趣的特性，但还不能声称与 Rails 一样。但是，如果您主要是 Java 或 groovy 开发人员，您可能更喜欢它。否则，我建议现在将 Rails 用于中型项目。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-18T07:15:55.230

我说 grails 是因为那里有很多 Java 库。但是由于我来自java背景，所以我有点偏见。

如果应用程序不会很大，任何一个都足够了——并且选择应该取决于现有的基础设施。假设您已经运行了一个 java servlet 容器服务器，那么您最好还是坚持使用 grails，而不是为 rails 提供另一个服务器。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2012-01-03T23:39:32.977

我以前使用过rails，非常喜欢它。但是，我现在的公司有很多遗留的 Java 代码，因此自然而然的选择是 grails。

当我开始使用 Rails 时，很少有网站在使用它，而且文档也很糟糕。有很棒的 railscast 和 railsforum.com，但任何不寻常的事情，你都是靠自己的。部署它是一场噩梦，使用 mongrel-clusters 并没有真正为生产做好准备。正如每个人都可以看到的那样，现在这是非常不同的，更加成熟并部署在任何地方。

一年多前，由于我上面提到的原因，我不得不学习 grails。过渡到 grails 非常容易，因为它与 Rails 非常相似。同样，它与 Rails 的早期阶段非常相似，但有一个巨大的不同。因为您可以轻松导入 java 代码，grails 用户可以使用几乎所有可用的生产测试 java 库。我已经能够成功地将我们遗留的 java 项目集成到 grails 项目中，并且只需要很少的调整。您还会注意到插件开发非常迅速，主要是因为开发人员只是编写 grails “钩子”，但底层代码是旧的 java 库。部署 grails 也只是部署一个 WAR 文件。

您必须查看的另一件事是IDE。如果您对 eclipse 感到满意，那么用于 grails 的 eclipse-STS 将为您提供所有的花里胡哨。我仍然看到很多 Rails 开发人员使用 textmate，尽管 ruby​​mine 取得了长足的进步（早期版本的 ruby​​mine 曾经让我的 ubuntu 陷入停顿）。

归根结底，两者都是很棒的 MVC 框架。RoR 更加成熟，拥有更多的开发人员。Grails 是 RoR 3-4 年前所处的位置，但我看到进展要快得多。希望这可以帮助。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-17T12:35:36.640

这取决于您使用 Ruby 和/或 Groovy 的技能，是否有遗留的 Java 系统需要处理，以及您想在哪里部署应用程序。

我最初对 Rails 很感兴趣。当时，没有选择在工作的应用服务器上进行部署，因为工作全是 Java。这已经改变了。我不能放弃现有的 Java 基础设施和应用程序而转向 Ruby，即使我认为 Rails 很棒。Grails 之所以有效，是因为我们可以将 Groovy 与现有的 Java 解决方案混合搭配。

工作之余，Ruby 更容易在价格范围的低端找到托管服务。因为 Grails 使用了很多现有的 Java 项目，所以 .war 文件，即使对于小型应用程序，也往往很大。如果您有专用服务器，这不是问题，但尝试在具有 128 MB RAM 的共享主机上运行是行不通的。

2008 年是 Groovy 和 Grails 书籍之年，但仍有更多可用的 Rails 资源。

根据您的具体标准，Rails 可能是一个更好的学习框架。如果您有任何 Java 知识或包袱 ;-)，您应该看看 Grails。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-13T22:28:52.737

看到制作 Grails 的人昨天如何被 Spring source 收购，我会说 Grails。

此外，由于 Groovy 是 Java 的超集，您可以直接使用您所知道的 Java，而无需学习 Ruby。现在，您还将学习很多动态的东西，并最终编写 Groovy 代码而不是 Java 代码，但它降低了入门门槛。

一路圣杯！

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-12-24T11:43:06.750

我会选择 Grails，因为我喜欢它的方法（指定您的域类并让 Grails 生成其他所有内容）比 Rails 更好（构建数据库表并让 Rails 生成其他所有内容）。如果您是一名 Java 开发人员，您也会喜欢 Java 代码是有效的 Groovy 代码，而 Groovy 类是 Java 类，因此两种方式的集成都是无缝的。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-07-28T13:33:43.517

作为一名来自 Java 的 Grails 开发人员，我从一开始就喜欢它。

现在，我开始深入研究 Rails 并遇到 gem 问题。虽然使用 Grails 设置 MySQL 连接非常简单，但我仍在努力使其与 Rails 一起使用。

该命令`gem install mysql`不起作用，显然是因为我没有安装 XCode。

如果不是因为它的内存消耗问题，我会说 Grails 是完美的。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-17T12:38:09.457

我可以推荐[Merb](http://merbivore.com)吗？它是基于机架的、模块化的、与 ORM 无关的，由 Ezra Zygmuntowicz 为提高速度而构建。现在开始有点热了...

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-17T10:30:15.613

Rails 更主流，但灵活性较差。Grails 仍在快速变化，没有相同的开发者生态系统，文档也没有那么成熟，但它可以在 Rails 不具备的某些情况下工作。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-18T20:26:35.313

我已经使用了一点涡轮齿轮和导轨。在使用 rails 之前，我尝试使用 grails，因为我使用 groovy 编写脚本。Grails 是一段艰难的经历。

groovy 调用堆栈对于小程序来说很难阅读，但是当您添加几个重量级的框架时，一个简单的错误可能会产生 100 行。与 rails 不同，我使用的 grails 版本没有工具来帮助我确定什么是我的，什么属于框架。

我最终转而使用 Google Web 工具包，因为我真的不需要数据库。

我认为 Grails 和 Groovy 很有希望，但目前使用它们的用户体验很麻烦（目前是去年春天）。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-12-15T11:47:16.197

我认为这在某种程度上取决于你工作的环境。

Grails 似乎有更多的企业级接受度。

Rails 具有 Koolaid 的风格，对于没有遗留系统的初创公司来说非常容易接受。

就个人而言，我正在使用两者。虽然在 Grails 世界中才刚刚开始——我喜欢 Grails 中的身份验证/授权更容易——一个简单的插件；四郎。我喜欢 Rails 不依赖于 JVM，并且不需要一分钟左右的时间来启动。

我发现在 Rails 中设置 BDD/Cucumber 要容易得多，但这可能只是因为我觉得这很舒服！在 Grails 世界（cuke4duke 等）中肯定有努力使这更容易 - 并且是一个开发 Grails 的活跃社区。

只是我的2p·

两个都试试:)

# system - 学习安全关键系统开发 (C/C++) 的最佳资源是什么

> ID：81832
> 
> 赞同：4
> 
> 时间：2008-09-17T10:29:13.620
> 
> 标签：system, safety-critical

我正在寻找关于安全关键系统开发技术/方法的良好资源（书籍或其他），尤其是涵盖硬件和软件的内容。我对 C/C++ 有很好的工作知识，所以即使它只是 SourceForge 等上的代码，我仍然希望有一个链接可以浏览。

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-17T10:34:31.907

播客[软件工程电台](http://se-radio.net/)有一些关于实时和容错系统的剧集，我发现它们非常有用。这些情节也很好地参考了书籍。

# java - 如何使用指定的客户端从 Java 以编程方式发送电子邮件附件

> ID：81862
> 
> 赞同：5
> 
> 时间：2008-09-17T10:33:39.960
> 
> 标签：java, uri, email

我想鼓励我们的 RCP 应用程序的用户将问题详细信息发送给我们的支持部门。为此，我在标准错误对话框中添加了“联系支持”小部件。

我已经设法使用 URI 标头通过 Java 6 的 JDIC 调用发送堆栈跟踪：[`Desktop.getDesktop().mail(java.net.URI)`](http://java.sun.com/javase/6/docs/api/java/net/URI.html). 这将启动用户的邮件客户端，准备好让他们添加评论，然后点击发送。

我喜欢启动电子邮件客户端，因为它是用户习惯的，它告诉支持人员很多关于用户的信息（签名、联系方式等），我真的不想[使用 Java Mail](http://www.catb.org/~esr/jargon/html/Z/Zawinskis-Law.html)。

我想做的是将日志文件和堆栈跟踪作为文件附加，因此没有最大长度要求，用户会看到一封漂亮干净的电子邮件，并且支持部门有更多信息可供使用。

我可以用我正在采取的方法做到这一点吗？或者，还有更好的方法？

**编辑**：我在 OSGi 上下文中，所以捆绑 JDIC 是必要的。如果可能的话，我希望提供尽可能少的依赖项，并且为多个平台捆绑 JDIC 听起来并不有趣，尤其是对于这样一个小功能。

JavaMail 可能是合适的，但事实上这将在我们公司客户的桌面上。配置的**设置/发现**必须是透明的、自动的和可靠的。关于 JavaMail，配置似乎只是手动的。是这样吗？

我最喜欢的答案是使用`Desktop.open()`*.eml 文件。不幸的是**Outlook Express（而不是 Outlook）打开 eml 文件**。我不知道这是否是通常或默认配置 Windows 以打开这样的 EML 文件。这是平常的吗？或者是否有另一种基于文本的格式，a) 易于生成，b) 默认情况下在用户已经使用的同一电子邮件客户端中打开？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T10:57:12.647

您可以保存一个临时的 .eml 文件，然后 Desktop.getDesktop().open(emlFile)
**编辑：**正如您所指出的，不幸的是，这将打开 Outlook Express 而不是 Outlook。
但是，如果您安装了 Windows Live Mail，它将使用它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T14:28:03.937

如果您使用的是 JDK 6（您确实应该使用），那么 Desktop API 现在是 JRE 的一部分。有关详细信息，请参阅[http://java.sun.com/developer/technicalArticles/J2SE/Desktop/javase6/desktop_api/](http://java.sun.com/developer/technicalArticles/J2SE/Desktop/javase6/desktop_api/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T18:31:46.267

作为处理相同问题的完全不同的方式，我们使用带有 XML-RPC 接口的错误跟踪器，并且我们的（RCP 也是，顺便说一句）应用程序使用自定义提交对话与该接口进行对话。这意味着我们可以发送日志文件来帮助诊断问题，而无需用户找到它们。

我确信大多数错误跟踪器都有类似的东西可用。我们使用 Jira，它运行良好（显然，他们刚刚发布了一个免费的个人版本，可以轻松尝试）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T10:38:07.467

使用该方法，您可以使用 URI 设置主题行和正文

```
mailto:me@here.com?SUBJECT=Support mail&BODY=This is a support mail 
```

但是，主题和正文的长度[会有一些限制](http://forums.java.net/jive/thread.jspa?messageID=204302&tstart=0)

我无法想到使用此方法或类似方法附加文件（无需将 javamail 添加到您的应用程序）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T12:02:12.960

JDIC 可能并不总是在您的用户平台上可用。一个很好的方法是使用 javamail API。您可以按照 SUN 在本教程中的说明发送多部分电子邮件：

[发送附件](http://java.sun.com/developer/onlineTraining/JavaMail/contents.html#SendingAttachments)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-10-25T12:31:24.697

```
import java.awt.Desktop;
import java.io.File;
import java.net.URI;

public class TestMail {

    public static void main(String[] args) {
        try {       
         Runtime.getRuntime().exec(
                  new String[] {"rundll32", "url.dll,FileProtocolHandler",
                        "mailto:a@a.de?subject=someSubject&cc=a@a.de&bcc=a@a.de&body=someBodyText&Attach=c:\\test\\test.doc"}, null
                  );

        } catch (Exception e) {
            e.printStackTrace();
        }
    }

} 
```

# c++ - 是否可以在标准 C++ 中打印变量的类型？

> ID：81870
> 
> 赞同：551
> 
> 时间：2008-09-17T10:34:44.013
> 
> 标签：c++, variables, c++11, typeof

例如：

```
int a = 12;
cout << typeof(a) << endl; 
```

预期输出：

```
int 
```

* * *

## 回答 #1

> 赞同：686
> 
> 时间：2013-11-24T04:14:32.117

C++11 更新了一个非常古老的问题：在 C++ 中打印变量类型。

公认的（和好的）答案是使用`typeid(a).name()`，其中`a`是变量名。

现在在 C++11 中我们有了`decltype(x)`，它可以将表达式转换为类型。并`decltype()`带有自己的一套非常有趣的规则。例如`decltype(a)`，并且`decltype((a))`通常会是不同的类型（一旦这些原因暴露出来，出于良好和可理解的原因）。

我们的信任会`typeid(a).name()`帮助我们探索这个勇敢的新世界吗？

不。

但是那个工具并没有那么复杂。这就是我用来回答这个问题的工具。我会将这个新工具与`typeid(a).name()`. 而这个新工具实际上是建立在`typeid(a).name()`.

**根本问题：**

```
typeid(a).name() 
```

丢弃 cv 限定符、引用和左值/右值。例如：

```
const int ci = 0;
std::cout << typeid(ci).name() << '\n'; 
```

对我来说输出：

```
i 
```

我在猜测 MSVC 输出：

```
int 
```

即`const`消失了。这不是 QOI（实施质量）问题。该标准规定了这种行为。

我在下面推荐的是：

```
template <typename T> std::string type_name(); 
```

这将像这样使用：

```
const int ci = 0;
std::cout << type_name<decltype(ci)>() << '\n'; 
```

对我来说输出：

```
int const 
```

`<disclaimer>`我没有在 MSVC 上测试过这个。`</disclaimer>` 但我欢迎那些这样做的人提供反馈。

**C++11 解决方案**

我正在使用[ipapadop](https://stackoverflow.com/users/487362/ipapadop)在他对 demangle 类型的回答中`__cxa_demangle`推荐的非 MSVC 平台。但在 MSVC 上，我相信可以解开名称（未经测试）。这个核心围绕着一些简单的测试来检测、恢复和报告 cv-qualifiers 和对输入类型的引用。`typeid`

```
#include <type_traits>
#include <typeinfo>
#ifndef _MSC_VER
#   include <cxxabi.h>
#endif
#include <memory>
#include <string>
#include <cstdlib>

template <class T>
std::string
type_name()
{
    typedef typename std::remove_reference<T>::type TR;
    std::unique_ptr<char, void(*)(void*)> own
           (
#ifndef _MSC_VER
                abi::__cxa_demangle(typeid(TR).name(), nullptr,
                                           nullptr, nullptr),
#else
                nullptr,
#endif
                std::free
           );
    std::string r = own != nullptr ? own.get() : typeid(TR).name();
    if (std::is_const<TR>::value)
        r += " const";
    if (std::is_volatile<TR>::value)
        r += " volatile";
    if (std::is_lvalue_reference<T>::value)
        r += "&";
    else if (std::is_rvalue_reference<T>::value)
        r += "&&";
    return r;
} 
```

**结果**

有了这个解决方案，我可以做到这一点：

```
int& foo_lref();
int&& foo_rref();
int foo_value();

int
main()
{
    int i = 0;
    const int ci = 0;
    std::cout << "decltype(i) is " << type_name<decltype(i)>() << '\n';
    std::cout << "decltype((i)) is " << type_name<decltype((i))>() << '\n';
    std::cout << "decltype(ci) is " << type_name<decltype(ci)>() << '\n';
    std::cout << "decltype((ci)) is " << type_name<decltype((ci))>() << '\n';
    std::cout << "decltype(static_cast<int&>(i)) is " << type_name<decltype(static_cast<int&>(i))>() << '\n';
    std::cout << "decltype(static_cast<int&&>(i)) is " << type_name<decltype(static_cast<int&&>(i))>() << '\n';
    std::cout << "decltype(static_cast<int>(i)) is " << type_name<decltype(static_cast<int>(i))>() << '\n';
    std::cout << "decltype(foo_lref()) is " << type_name<decltype(foo_lref())>() << '\n';
    std::cout << "decltype(foo_rref()) is " << type_name<decltype(foo_rref())>() << '\n';
    std::cout << "decltype(foo_value()) is " << type_name<decltype(foo_value())>() << '\n';
} 
```

输出是：

```
decltype(i) is int
decltype((i)) is int&
decltype(ci) is int const
decltype((ci)) is int const&
decltype(static_cast<int&>(i)) is int&
decltype(static_cast<int&&>(i)) is int&&
decltype(static_cast<int>(i)) is int
decltype(foo_lref()) is int&
decltype(foo_rref()) is int&&
decltype(foo_value()) is int 
```

`decltype(i)`注意（例如）和之间的区别`decltype((i))`。前者是*声明*的类型`i`。后者是*表达式* `i`的“类型” 。（表达式从不具有引用类型，但作为约定，`decltype`表示具有左值引用的左值表达式）。

`decltype`因此，除了探索和调试您自己的代码之外，该工具还是一个很好的学习工具。

相反，如果我只是在 上构建它`typeid(a).name()`，而不添加丢失的 cv-qualifiers 或引用，输出将是：

```
decltype(i) is int
decltype((i)) is int
decltype(ci) is int
decltype((ci)) is int
decltype(static_cast<int&>(i)) is int
decltype(static_cast<int&&>(i)) is int
decltype(static_cast<int>(i)) is int
decltype(foo_lref()) is int
decltype(foo_rref()) is int
decltype(foo_value()) is int 
```

即每个引用和 cv 限定符都被剥离。

**C++14 更新**

就在您认为自己已经找到了解决问题的方法时，总会有人突然冒出来，向您展示更好的方法。:-)

[Jamboree的](https://stackoverflow.com/users/2969631/jamboree)[这个答案](https://stackoverflow.com/a/35943472/576911)显示了如何在编译时获取 C++14 中的类型名称。这是一个绝妙的解决方案，原因如下：

1.  它在编译时！
2.  您可以让编译器本身而不是库（甚至是 std::lib）来完成这项工作。这意味着最新语言功能（如 lambdas）的结果更准确。

[Jamboree 的](https://stackoverflow.com/users/2969631/jamboree) [回答](https://stackoverflow.com/a/35943472/576911)并没有完全说明 VS 的所有内容，我正在稍微调整他的代码。但是由于这个答案得到了很多意见，所以花一些时间去那里并支持他的答案，没有它，这个更新永远不会发生。

```
#include <cstddef>
#include <stdexcept>
#include <cstring>
#include <ostream>

#ifndef _MSC_VER
#  if __cplusplus < 201103
#    define CONSTEXPR11_TN
#    define CONSTEXPR14_TN
#    define NOEXCEPT_TN
#  elif __cplusplus < 201402
#    define CONSTEXPR11_TN constexpr
#    define CONSTEXPR14_TN
#    define NOEXCEPT_TN noexcept
#  else
#    define CONSTEXPR11_TN constexpr
#    define CONSTEXPR14_TN constexpr
#    define NOEXCEPT_TN noexcept
#  endif
#else  // _MSC_VER
#  if _MSC_VER < 1900
#    define CONSTEXPR11_TN
#    define CONSTEXPR14_TN
#    define NOEXCEPT_TN
#  elif _MSC_VER < 2000
#    define CONSTEXPR11_TN constexpr
#    define CONSTEXPR14_TN
#    define NOEXCEPT_TN noexcept
#  else
#    define CONSTEXPR11_TN constexpr
#    define CONSTEXPR14_TN constexpr
#    define NOEXCEPT_TN noexcept
#  endif
#endif  // _MSC_VER

class static_string
{
    const char* const p_;
    const std::size_t sz_;

public:
    typedef const char* const_iterator;

    template <std::size_t N>
    CONSTEXPR11_TN static_string(const char(&a)[N]) NOEXCEPT_TN
        : p_(a)
        , sz_(N-1)
        {}

    CONSTEXPR11_TN static_string(const char* p, std::size_t N) NOEXCEPT_TN
        : p_(p)
        , sz_(N)
        {}

    CONSTEXPR11_TN const char* data() const NOEXCEPT_TN {return p_;}
    CONSTEXPR11_TN std::size_t size() const NOEXCEPT_TN {return sz_;}

    CONSTEXPR11_TN const_iterator begin() const NOEXCEPT_TN {return p_;}
    CONSTEXPR11_TN const_iterator end()   const NOEXCEPT_TN {return p_ + sz_;}

    CONSTEXPR11_TN char operator[](std::size_t n) const
    {
        return n < sz_ ? p_[n] : throw std::out_of_range("static_string");
    }
};

inline
std::ostream&
operator<<(std::ostream& os, static_string const& s)
{
    return os.write(s.data(), s.size());
}

template <class T>
CONSTEXPR14_TN
static_string
type_name()
{
#ifdef __clang__
    static_string p = __PRETTY_FUNCTION__;
    return static_string(p.data() + 31, p.size() - 31 - 1);
#elif defined(__GNUC__)
    static_string p = __PRETTY_FUNCTION__;
#  if __cplusplus < 201402
    return static_string(p.data() + 36, p.size() - 36 - 1);
#  else
    return static_string(p.data() + 46, p.size() - 46 - 1);
#  endif
#elif defined(_MSC_VER)
    static_string p = __FUNCSIG__;
    return static_string(p.data() + 38, p.size() - 38 - 7);
#endif
} 
```

`constexpr`如果您仍然停留在古老的 C++11 中，此代码将自动退避。如果你用 C++98/03 在洞壁上作画，`noexcept`也会被牺牲掉。

**C++17 更新**

在下面的评论中，[Lyberta](https://stackoverflow.com/users/3624760/lyberta)指出新的`std::string_view`可以替换`static_string`：

```
template <class T>
constexpr
std::string_view
type_name()
{
    using namespace std;
#ifdef __clang__
    string_view p = __PRETTY_FUNCTION__;
    return string_view(p.data() + 34, p.size() - 34 - 1);
#elif defined(__GNUC__)
    string_view p = __PRETTY_FUNCTION__;
#  if __cplusplus < 201402
    return string_view(p.data() + 36, p.size() - 36 - 1);
#  else
    return string_view(p.data() + 49, p.find(';', 49) - 49);
#  endif
#elif defined(_MSC_VER)
    string_view p = __FUNCSIG__;
    return string_view(p.data() + 84, p.size() - 84 - 7);
#endif
} 
```

由于 Jive Dadson 在下面的评论中所做的非常出色的侦探工作，我已经更新了 VS 的常量。

## 更新：

请务必查看[下面的重写，](https://stackoverflow.com/a/56766138/576911)它消除了我最新公式中不可读的幻数。

* * *

## 回答 #2

> 赞同：253
> 
> 时间：2008-09-17T10:38:45.233

尝试：

```
#include <typeinfo>

// …
std::cout << typeid(a).name() << '\n'; 
```

您可能必须在编译器选项中激活 RTTI 才能使其正常工作。此外，它的输出取决于编译器。它可能是原始类型名称或名称修饰符号或介于两者之间的任何内容。

* * *

## 回答 #3

> 赞同：113
> 
> 时间：2013-01-31T03:13:03.310

非常难看，但如果您只想要编译时间信息（例如用于调试），则可以解决问题：

```
auto testVar = std::make_tuple(1, 1.0, "abc");
decltype(testVar)::foo= 1; 
```

回报：

```
Compilation finished with errors:
source.cpp: In function 'int main()':
source.cpp:5:19: error: 'foo' is not a member of 'std::tuple<int, double, const char*>' 
```

* * *

## 回答 #4

> 赞同：110
> 
> 时间：2019-06-26T06:00:18.837

根据[Howard](https://stackoverflow.com/a/20170989/11638718)的解决方案，如果您不喜欢幻数，我认为这是一种很好的表示方式，并且看起来很直观：

```
#include <string_view>

template <typename T>
constexpr auto type_name() {
  std::string_view name, prefix, suffix;
#ifdef __clang__
  name = __PRETTY_FUNCTION__;
  prefix = "auto type_name() [T = ";
  suffix = "]";
#elif defined(__GNUC__)
  name = __PRETTY_FUNCTION__;
  prefix = "constexpr auto type_name() [with T = ";
  suffix = "]";
#elif defined(_MSC_VER)
  name = __FUNCSIG__;
  prefix = "auto __cdecl type_name<";
  suffix = ">(void)";
#endif
  name.remove_prefix(prefix.size());
  name.remove_suffix(suffix.size());
  return name;
} 
```

[演示。](https://godbolt.org/z/Mr1ercr49)

* * *

## 回答 #5

> 赞同：58
> 
> 时间：2008-09-17T10:41:27.460

不要忘记包括`<typeinfo>`

我相信您指的是运行时类型识别。您可以通过执行上述操作来实现。

```
#include <iostream>
#include <typeinfo>

using namespace std;

int main() {
  int i;
  cout << typeid(i).name();
  return 0;
} 
```

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2008-09-17T11:15:51.387

请注意，由 C++ 的 RTTI 功能生成的名称**不可**移植。例如，类

```
MyNamespace::CMyContainer<int, test_MyNamespace::CMyObject> 
```

将具有以下名称：

```
// MSVC 2003:
class MyNamespace::CMyContainer[int,class test_MyNamespace::CMyObject]
// G++ 4.2:
N8MyNamespace8CMyContainerIiN13test_MyNamespace9CMyObjectEEE 
```

因此，您不能使用此信息进行序列化。但是，typeid(a).name() 属性仍然可以用于日志/调试目的

* * *

## 回答 #7

> 赞同：22
> 
> 时间：2008-09-17T10:49:55.847

您可以使用模板。

```
template <typename T> const char* typeof(T&) { return "unknown"; }    // default
template<> const char* typeof(int&) { return "int"; }
template<> const char* typeof(float&) { return "float"; } 
```

在上面的示例中，当类型不匹配时，它将打印“未知”。

* * *

## 回答 #8

> 赞同：21
> 
> 时间：2013-01-31T19:16:34.937

如前所述，`typeid().name()`可能会返回一个损坏的名称。在 GCC（和其他一些编译器）中，您可以使用以下代码解决它：

```
#include <cxxabi.h>
#include <iostream>
#include <typeinfo>
#include <cstdlib>

namespace some_namespace { namespace another_namespace {

  class my_class { };

} }

int main() {
  typedef some_namespace::another_namespace::my_class my_type;
  // mangled
  std::cout << typeid(my_type).name() << std::endl;

  // unmangled
  int status = 0;
  char* demangled = abi::__cxa_demangle(typeid(my_type).name(), 0, 0, &status);

  switch (status) {
    case -1: {
      // could not allocate memory
      std::cout << "Could not allocate memory" << std::endl;
      return -1;
    } break;
    case -2: {
      // invalid name under the C++ ABI mangling rules
      std::cout << "Invalid name" << std::endl;
      return -1;
    } break;
    case -3: {
      // invalid argument
      std::cout << "Invalid argument to demangle()" << std::endl;
      return -1;
    } break;
 }
 std::cout << demangled << std::endl;

 free(demangled);

 return 0; 
```

}

* * *

## 回答 #9

> 赞同：14
> 
> 时间：2019-10-10T21:10:09.373

[Howard Hinnant](https://stackoverflow.com/a/20170989)使用幻数提取类型名称。[康桓玮</a> 建议字符串前缀和后缀。但是前缀/后缀不断变化。使用“probe_type” type_name 自动计算“probe_type”的前缀和后缀大小以提取类型名称：](https://stackoverflow.com/a/56766138)

 [```
#include <string_view>
using namespace std;

namespace typeName {
 template <typename T>
  constexpr string_view wrapped_type_name () {
#ifdef __clang__
    return __PRETTY_FUNCTION__;
#elif defined(__GNUC__)
    return  __PRETTY_FUNCTION__;
#elif defined(_MSC_VER)
    return  __FUNCSIG__;
#endif
  }

  class probe_type;
  constexpr string_view probe_type_name ("typeName::probe_type");
  constexpr string_view probe_type_name_elaborated ("class typeName::probe_type");
  constexpr string_view probe_type_name_used (wrapped_type_name<probe_type> ().find (probe_type_name_elaborated) != -1 ? probe_type_name_elaborated : probe_type_name);

  constexpr size_t prefix_size () {
    return wrapped_type_name<probe_type> ().find (probe_type_name_used);
  }

  constexpr size_t suffix_size () {
    return wrapped_type_name<probe_type> ().length () - prefix_size () - probe_type_name_used.length ();
  }

  template <typename T>
  string_view type_name () {
    constexpr auto type_name = wrapped_type_name<T> ();

    return type_name.substr (prefix_size (), type_name.length () - prefix_size () - suffix_size ());
  }
}

#include <iostream>

using typeName::type_name;
using typeName::probe_type;

class test;

int main () {
  cout << type_name<class test> () << endl;

  cout << type_name<const int*&> () << endl;
  cout << type_name<unsigned int> () << endl;

  const int ic = 42;
  const int* pic = &ic;
  const int*& rpic = pic;
  cout << type_name<decltype(ic)> () << endl;
  cout << type_name<decltype(pic)> () << endl;
  cout << type_name<decltype(rpic)> () << endl;

  cout << type_name<probe_type> () << endl;
} 
```

输出](https://stackoverflow.com/a/56766138) 

[GCC 10.2](https://godbolt.org)：

```
test
const int *&
unsigned int
const int
const int *
const int *&
typeName::probe_type 
```

[铿锵声 11.0.0](https://godbolt.org)：

```
test
const int *&
unsigned int
const int
const int *
const int *&
typeName::probe_type 
```

VS 2019 版本 16.7.6：

```
class test
const int*&
unsigned int
const int
const int*
const int*&
class typeName::probe_type 
```

* * *

## 回答 #10

> 赞同：13
> 
> 时间：2008-09-17T10:46:45.980

您可以为此使用特征类。就像是：

```
#include <iostream>
using namespace std;

template <typename T> class type_name {
public:
    static const char *name;
};

#define DECLARE_TYPE_NAME(x) template<> const char *type_name<x>::name = #x;
#define GET_TYPE_NAME(x) (type_name<typeof(x)>::name)

DECLARE_TYPE_NAME(int);

int main()
{
    int a = 12;
    cout << GET_TYPE_NAME(a) << endl;
} 
```

定义的`DECLARE_TYPE_NAME`存在是为了让您更轻松地为您期望需要的所有类型声明此特征类。

这可能比涉及的解决方案更有用，`typeid`因为您可以控制输出。例如，在我的编译器上使用`typeid`for会给出“x”。`long long`

* * *

## 回答 #11

> 赞同：12
> 
> 时间：2020-10-22T21:09:06.423

[另一种对[@康桓玮的回答的](https://stackoverflow.com/a/56766138)看法（最初），对前缀和后缀细节做更少的假设，并受到[@Val的回答的](https://stackoverflow.com/a/58331141/1593077)启发——但不会污染全局命名空间；无条件；并希望更容易阅读。]

流行的编译器提供了一个带有当前函数签名的宏。现在，函数是可模板化的；所以签名包含模板参数。因此，基本方法是：给定一个类型，在一个函数中，将该类型作为模板参数。

不幸的是，类型名称包含在描述函数的文本中，这在编译器之间是不同的。例如，对于 GCC，`template <typename T> int foo()`with 类型的签名`double`是：`int foo() [T = double]`.

那么，如何摆脱包装文本呢？@HowardHinnant 的解决方案是最短和最“直接”的：只需使用每个编译器的幻数来删除前缀和后缀。但显然，这很脆弱；没有人喜欢他们代码中的幻数。然而，事实证明，给定具有已知名称的类型的宏值，您可以确定构成包装的前缀和后缀。

```
#include <string_view>

template <typename T> constexpr std::string_view type_name();

template <>
constexpr std::string_view type_name<void>()
{ return "void"; }

namespace detail {

using type_name_prober = void;

template <typename T>
constexpr std::string_view wrapped_type_name() 
{
#ifdef __clang__
    return __PRETTY_FUNCTION__;
#elif defined(__GNUC__)
    return __PRETTY_FUNCTION__;
#elif defined(_MSC_VER)
    return __FUNCSIG__;
#else
#error "Unsupported compiler"
#endif
}

constexpr std::size_t wrapped_type_name_prefix_length() { 
    return wrapped_type_name<type_name_prober>().find(type_name<type_name_prober>()); 
}

constexpr std::size_t wrapped_type_name_suffix_length() { 
    return wrapped_type_name<type_name_prober>().length() 
        - wrapped_type_name_prefix_length() 
        - type_name<type_name_prober>().length();
}

} // namespace detail

template <typename T>
constexpr std::string_view type_name() {
    constexpr auto wrapped_name = detail::wrapped_type_name<T>();
    constexpr auto prefix_length = detail::wrapped_type_name_prefix_length();
    constexpr auto suffix_length = detail::wrapped_type_name_suffix_length();
    constexpr auto type_name_length = wrapped_name.length() - prefix_length - suffix_length;
    return wrapped_name.substr(prefix_length, type_name_length);
} 
```

看到它[`GodBolt`](https://godbolt.org/z/3ac5f5)。这也应该适用于 MSVC。

* * *

## 回答 #12

> 赞同：11
> 
> 时间：2016-10-08T20:56:43.050

在 C++11 中，我们有 decltype。标准 C++ 中无法显示使用 decltype 声明的变量的确切类型。我们可以使用 boost typeindex 即`type_id_with_cvr`（cvr 代表 const、volatile、reference）来打印如下所示的类型。

```
#include <iostream>
#include <boost/type_index.hpp>

using namespace std;
using boost::typeindex::type_id_with_cvr;

int main() {
  int i = 0;
  const int ci = 0;
  cout << "decltype(i) is " << type_id_with_cvr<decltype(i)>().pretty_name() << '\n';
  cout << "decltype((i)) is " << type_id_with_cvr<decltype((i))>().pretty_name() << '\n';
  cout << "decltype(ci) is " << type_id_with_cvr<decltype(ci)>().pretty_name() << '\n';
  cout << "decltype((ci)) is " << type_id_with_cvr<decltype((ci))>().pretty_name() << '\n';
  cout << "decltype(std::move(i)) is " << type_id_with_cvr<decltype(std::move(i))>().pretty_name() << '\n';
  cout << "decltype(std::static_cast<int&&>(i)) is " << type_id_with_cvr<decltype(static_cast<int&&>(i))>().pretty_name() << '\n';
  return 0;
} 
```

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2016-02-29T15:28:34.417

您也可以使用带有选项 -t (type) 的 c++filt 来解开类型名称：

```
#include <iostream>
#include <typeinfo>
#include <string>

using namespace std;

int main() {
  auto x = 1;
  string my_type = typeid(x).name();
  system(("echo " + my_type + " | c++filt -t").c_str());
  return 0;
} 
```

仅在 linux 上测试。

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2008-09-17T11:23:13.957

涉及 RTTI (typeid) 的其他答案可能是您想要的，只要：

*   您可以承受内存开销（对于某些编译器来说可能相当大）
*   编译器返回的类名很有用

另一种方法（类似于 Greg Hewgill 的回答）是建立一个特性的编译时间表。

```
template <typename T> struct type_as_string;

// declare your Wibble type (probably with definition of Wibble)
template <>
struct type_as_string<Wibble>
{
    static const char* const value = "Wibble";
}; 
```

请注意，如果您将声明包装在宏中，则由于逗号的原因，您将难以为采用多个参数（例如 std::map）的模板类型声明名称。

要访问变量类型的名称，您只需要

```
template <typename T>
const char* get_type_as_string(const T&)
{
    return type_as_string<T>::value;
} 
```

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2015-03-13T19:38:01.827

我喜欢尼克的方法，一个完整的形式可能是这样的（对于所有基本数据类型）：

```
template <typename T> const char* typeof(T&) { return "unknown"; }    // default
template<> const char* typeof(int&) { return "int"; }
template<> const char* typeof(short&) { return "short"; }
template<> const char* typeof(long&) { return "long"; }
template<> const char* typeof(unsigned&) { return "unsigned"; }
template<> const char* typeof(unsigned short&) { return "unsigned short"; }
template<> const char* typeof(unsigned long&) { return "unsigned long"; }
template<> const char* typeof(float&) { return "float"; }
template<> const char* typeof(double&) { return "double"; }
template<> const char* typeof(long double&) { return "long double"; }
template<> const char* typeof(std::string&) { return "String"; }
template<> const char* typeof(char&) { return "char"; }
template<> const char* typeof(signed char&) { return "signed char"; }
template<> const char* typeof(unsigned char&) { return "unsigned char"; }
template<> const char* typeof(char*&) { return "char*"; }
template<> const char* typeof(signed char*&) { return "signed char*"; }
template<> const char* typeof(unsigned char*&) { return "unsigned char*"; } 
```

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2015-03-14T00:03:24.047

没有函数重载的更通用的解决方案比我以前的解决方案：

```
template<typename T>
std::string TypeOf(T){
    std::string Type="unknown";
    if(std::is_same<T,int>::value) Type="int";
    if(std::is_same<T,std::string>::value) Type="String";
    if(std::is_same<T,MyClass>::value) Type="MyClass";

    return Type;} 
```

这里 MyClass 是用户定义的类。这里也可以添加更多条件。

例子：

```
#include <iostream>

class MyClass{};

template<typename T>
std::string TypeOf(T){
    std::string Type="unknown";
    if(std::is_same<T,int>::value) Type="int";
    if(std::is_same<T,std::string>::value) Type="String";
    if(std::is_same<T,MyClass>::value) Type="MyClass";
    return Type;}

int main(){;
    int a=0;
    std::string s="";
    MyClass my;
    std::cout<<TypeOf(a)<<std::endl;
    std::cout<<TypeOf(s)<<std::endl;
    std::cout<<TypeOf(my)<<std::endl;

    return 0;} 
```

输出：

```
int
String
MyClass 
```

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2017-08-17T18:59:36.967

当我挑战时，我决定测试一个与平台无关的（希望是）模板诡计能走多远。

这些名称在编译时完全组装。（这意味着`typeid(T).name()`无法使用，因此您必须明确提供非复合类型的名称。否则将显示占位符。）

示例用法：

```
TYPE_NAME(int)
TYPE_NAME(void)
// You probably should list all primitive types here.

TYPE_NAME(std::string)

int main()
{
    // A simple case
    std::cout << type_name<void(*)(int)> << '\n';
    // -> `void (*)(int)`

    // Ugly mess case
    // Note that compiler removes cv-qualifiers from parameters and replaces arrays with pointers.
    std::cout << type_name<void (std::string::*(int[3],const int, void (*)(std::string)))(volatile int*const*)> << '\n';
    // -> `void (std::string::*(int *,int,void (*)(std::string)))(volatile int *const*)`

    // A case with undefined types
    //  If a type wasn't TYPE_NAME'd, it's replaced by a placeholder, one of `class?`, `union?`, `enum?` or `??`.
    std::cout << type_name<std::ostream (*)(int, short)> << '\n';
    // -> `class? (*)(int,??)`
    // With appropriate TYPE_NAME's, the output would be `std::string (*)(int,short)`.
} 
```

代码：

```
#include <type_traits>
#include <utility>

static constexpr std::size_t max_str_lit_len = 256;

template <std::size_t I, std::size_t N> constexpr char sl_at(const char (&str)[N])
{
    if constexpr(I < N)
        return str[I];
    else
        return '\0';
}

constexpr std::size_t sl_len(const char *str)
{
    for (std::size_t i = 0; i < max_str_lit_len; i++)
        if (str[i] == '\0')
            return i;
    return 0;
}

template <char ...C> struct str_lit
{
    static constexpr char value[] {C..., '\0'};
    static constexpr int size = sl_len(value);

    template <typename F, typename ...P> struct concat_impl {using type = typename concat_impl<F>::type::template concat_impl<P...>::type;};
    template <char ...CC> struct concat_impl<str_lit<CC...>> {using type = str_lit<C..., CC...>;};
    template <typename ...P> using concat = typename concat_impl<P...>::type;
};

template <typename, const char *> struct trim_str_lit_impl;
template <std::size_t ...I, const char *S> struct trim_str_lit_impl<std::index_sequence<I...>, S>
{
    using type = str_lit<S[I]...>;
};
template <std::size_t N, const char *S> using trim_str_lit = typename trim_str_lit_impl<std::make_index_sequence<N>, S>::type;

#define STR_LIT(str) ::trim_str_lit<::sl_len(str), ::str_lit<STR_TO_VA(str)>::value>
#define STR_TO_VA(str) STR_TO_VA_16(str,0),STR_TO_VA_16(str,16),STR_TO_VA_16(str,32),STR_TO_VA_16(str,48)
#define STR_TO_VA_16(str,off) STR_TO_VA_4(str,0+off),STR_TO_VA_4(str,4+off),STR_TO_VA_4(str,8+off),STR_TO_VA_4(str,12+off)
#define STR_TO_VA_4(str,off) ::sl_at<off+0>(str),::sl_at<off+1>(str),::sl_at<off+2>(str),::sl_at<off+3>(str)

template <char ...C> constexpr str_lit<C...> make_str_lit(str_lit<C...>) {return {};}
template <std::size_t N> constexpr auto make_str_lit(const char (&str)[N])
{
    return trim_str_lit<sl_len((const char (&)[N])str), str>{};
}

template <std::size_t A, std::size_t B> struct cexpr_pow {static constexpr std::size_t value = A * cexpr_pow<A,B-1>::value;};
template <std::size_t A> struct cexpr_pow<A,0> {static constexpr std::size_t value = 1;};
template <std::size_t N, std::size_t X, typename = std::make_index_sequence<X>> struct num_to_str_lit_impl;
template <std::size_t N, std::size_t X, std::size_t ...Seq> struct num_to_str_lit_impl<N, X, std::index_sequence<Seq...>>
{
    static constexpr auto func()
    {
        if constexpr (N >= cexpr_pow<10,X>::value)
            return num_to_str_lit_impl<N, X+1>::func();
        else
            return str_lit<(N / cexpr_pow<10,X-1-Seq>::value % 10 + '0')...>{};
    }
};
template <std::size_t N> using num_to_str_lit = decltype(num_to_str_lit_impl<N,1>::func());

using spa = str_lit<' '>;
using lpa = str_lit<'('>;
using rpa = str_lit<')'>;
using lbr = str_lit<'['>;
using rbr = str_lit<']'>;
using ast = str_lit<'*'>;
using amp = str_lit<'&'>;
using con = str_lit<'c','o','n','s','t'>;
using vol = str_lit<'v','o','l','a','t','i','l','e'>;
using con_vol = con::concat<spa, vol>;
using nsp = str_lit<':',':'>;
using com = str_lit<','>;
using unk = str_lit<'?','?'>;

using c_cla = str_lit<'c','l','a','s','s','?'>;
using c_uni = str_lit<'u','n','i','o','n','?'>;
using c_enu = str_lit<'e','n','u','m','?'>;

template <typename T> inline constexpr bool ptr_or_ref = std::is_pointer_v<T> || std::is_reference_v<T> || std::is_member_pointer_v<T>;
template <typename T> inline constexpr bool func_or_arr = std::is_function_v<T> || std::is_array_v<T>;

template <typename T> struct primitive_type_name {using value = unk;};

template <typename T, typename = std::enable_if_t<std::is_class_v<T>>> using enable_if_class = T;
template <typename T, typename = std::enable_if_t<std::is_union_v<T>>> using enable_if_union = T;
template <typename T, typename = std::enable_if_t<std::is_enum_v <T>>> using enable_if_enum  = T;
template <typename T> struct primitive_type_name<enable_if_class<T>> {using value = c_cla;};
template <typename T> struct primitive_type_name<enable_if_union<T>> {using value = c_uni;};
template <typename T> struct primitive_type_name<enable_if_enum <T>> {using value = c_enu;};

template <typename T> struct type_name_impl;

template <typename T> using type_name_lit = std::conditional_t<std::is_same_v<typename primitive_type_name<T>::value::template concat<spa>,
                                                                               typename type_name_impl<T>::l::template concat<typename type_name_impl<T>::r>>,
                                            typename primitive_type_name<T>::value,
                                            typename type_name_impl<T>::l::template concat<typename type_name_impl<T>::r>>;
template <typename T> inline constexpr const char *type_name = type_name_lit<T>::value;

template <typename T, typename = std::enable_if_t<!std::is_const_v<T> && !std::is_volatile_v<T>>> using enable_if_no_cv = T;

template <typename T> struct type_name_impl
{
    using l = typename primitive_type_name<T>::value::template concat<spa>;
    using r = str_lit<>;
};
template <typename T> struct type_name_impl<const T>
{
    using new_T_l = std::conditional_t<type_name_impl<T>::l::size && !ptr_or_ref<T>,
                                       spa::concat<typename type_name_impl<T>::l>,
                                       typename type_name_impl<T>::l>;
    using l = std::conditional_t<ptr_or_ref<T>,
                                 typename new_T_l::template concat<con>,
                                 con::concat<new_T_l>>;
    using r = typename type_name_impl<T>::r;
};
template <typename T> struct type_name_impl<volatile T>
{
    using new_T_l = std::conditional_t<type_name_impl<T>::l::size && !ptr_or_ref<T>,
                                       spa::concat<typename type_name_impl<T>::l>,
                                       typename type_name_impl<T>::l>;
    using l = std::conditional_t<ptr_or_ref<T>,
                                 typename new_T_l::template concat<vol>,
                                 vol::concat<new_T_l>>;
    using r = typename type_name_impl<T>::r;
};
template <typename T> struct type_name_impl<const volatile T>
{
    using new_T_l = std::conditional_t<type_name_impl<T>::l::size && !ptr_or_ref<T>,
                                       spa::concat<typename type_name_impl<T>::l>,
                                       typename type_name_impl<T>::l>;
    using l = std::conditional_t<ptr_or_ref<T>,
                                 typename new_T_l::template concat<con_vol>,
                                 con_vol::concat<new_T_l>>;
    using r = typename type_name_impl<T>::r;
};
template <typename T> struct type_name_impl<T *>
{
    using l = std::conditional_t<func_or_arr<T>,
                                 typename type_name_impl<T>::l::template concat<lpa, ast>,
                                 typename type_name_impl<T>::l::template concat<     ast>>;
    using r = std::conditional_t<func_or_arr<T>,
                                 rpa::concat<typename type_name_impl<T>::r>,
                                             typename type_name_impl<T>::r>;
};
template <typename T> struct type_name_impl<T &>
{
    using l = std::conditional_t<func_or_arr<T>,
                                 typename type_name_impl<T>::l::template concat<lpa, amp>,
                                 typename type_name_impl<T>::l::template concat<     amp>>;
    using r = std::conditional_t<func_or_arr<T>,
                                 rpa::concat<typename type_name_impl<T>::r>,
                                             typename type_name_impl<T>::r>;
};
template <typename T> struct type_name_impl<T &&>
{
    using l = std::conditional_t<func_or_arr<T>,
                                 typename type_name_impl<T>::l::template concat<lpa, amp, amp>,
                                 typename type_name_impl<T>::l::template concat<     amp, amp>>;
    using r = std::conditional_t<func_or_arr<T>,
                                 rpa::concat<typename type_name_impl<T>::r>,
                                             typename type_name_impl<T>::r>;
};
template <typename T, typename C> struct type_name_impl<T C::*>
{
    using l = std::conditional_t<func_or_arr<T>,
                                 typename type_name_impl<T>::l::template concat<lpa, type_name_lit<C>, nsp, ast>,
                                 typename type_name_impl<T>::l::template concat<     type_name_lit<C>, nsp, ast>>;
    using r = std::conditional_t<func_or_arr<T>,
                                 rpa::concat<typename type_name_impl<T>::r>,
                                             typename type_name_impl<T>::r>;
};
template <typename T> struct type_name_impl<enable_if_no_cv<T[]>>
{
    using l = typename type_name_impl<T>::l;
    using r = lbr::concat<rbr, typename type_name_impl<T>::r>;
};
template <typename T, std::size_t N> struct type_name_impl<enable_if_no_cv<T[N]>>
{
    using l = typename type_name_impl<T>::l;
    using r = lbr::concat<num_to_str_lit<N>, rbr, typename type_name_impl<T>::r>;
};
template <typename T> struct type_name_impl<T()>
{
    using l = typename type_name_impl<T>::l;
    using r = lpa::concat<rpa, typename type_name_impl<T>::r>;
};
template <typename T, typename P1, typename ...P> struct type_name_impl<T(P1, P...)>
{
    using l = typename type_name_impl<T>::l;
    using r = lpa::concat<type_name_lit<P1>,
                          com::concat<type_name_lit<P>>..., rpa, typename type_name_impl<T>::r>;
};

#define TYPE_NAME(t) template <> struct primitive_type_name<t> {using value = STR_LIT(#t);}; 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2019-06-05T02:40:21.260

正如 Scott Meyers 在 Effective Modern C++ 中所解释的，

> 调用`std::type_info::name`不保证返回任何明智的。

最好的解决方案是让编译器在类型推导过程中产生错误信息，例如，

```
template<typename T>
class TD;

int main(){
    const int theAnswer = 32;
    auto x = theAnswer;
    auto y = &theAnswer;
    TD<decltype(x)> xType;
    TD<decltype(y)> yType;
    return 0;
} 
```

结果将是这样的，具体取决于编译器，

```
test4.cpp:10:21: error: aggregate ‘TD<int> xType’ has incomplete type and cannot be defined TD<decltype(x)> xType;

test4.cpp:11:21: error: aggregate ‘TD<const int *> yType’ has incomplete type and cannot be defined TD<decltype(y)> yType; 
```

因此，我们知道`x`' 的类型是`int`，`y`' 的类型是`const int*`

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2017-08-02T09:45:51.667

```
#include <iostream>
#include <typeinfo>
using namespace std;
#define show_type_name(_t) \
    system(("echo " + string(typeid(_t).name()) + " | c++filt -t").c_str())

int main() {
    auto a = {"one", "two", "three"};
    cout << "Type of a: " << typeid(a).name() << endl;
    cout << "Real type of a:\n";
    show_type_name(a);
    for (auto s : a) {
        if (string(s) == "one") {
            cout << "Type of s: " << typeid(s).name() << endl;
            cout << "Real type of s:\n";
            show_type_name(s);
        }
        cout << s << endl;
    }

    int i = 5;
    cout << "Type of i: " << typeid(i).name() << endl;
    cout << "Real type of i:\n";
    show_type_name(i);
    return 0;
} 
```

输出：

```
Type of a: St16initializer_listIPKcE
Real type of a:
std::initializer_list<char const*>
Type of s: PKc
Real type of s:
char const*
one
two
three
Type of i: i
Real type of i:
int 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2020-04-21T13:30:24.723

对于仍在访问的任何人，我最近遇到了同样的问题，并决定根据这篇文章的答案编写一个小型库。它提供 constexpr 类型名称和类型索引，并在 Mac、Windows 和 Ubuntu 上进行了测试。

库代码在这里：[https ://github.com/TheLartians/StaticTypeInfo](https://github.com/TheLartians/StaticTypeInfo)

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2020-11-06T16:02:08.907

从这个答案复制：[https ://stackoverflow.com/a/56766138/11502722](https://stackoverflow.com/a/56766138/11502722)

我能够让它在*某种程度上*适用于 C++ `static_assert()`。这里的皱纹是`static_assert()`只接受字符串文字；`constexpr string_view`不管用。您需要接受类型名周围的额外文本，但它有效：

```
template<typename T>
constexpr void assertIfTestFailed()
{
#ifdef __clang__
    static_assert(testFn<T>(), "Test failed on this used type: " __PRETTY_FUNCTION__);
#elif defined(__GNUC__)
    static_assert(testFn<T>(), "Test failed on this used type: " __PRETTY_FUNCTION__);
#elif defined(_MSC_VER)
    static_assert(testFn<T>(), "Test failed on this used type: " __FUNCSIG__);
#else
    static_assert(testFn<T>(), "Test failed on this used type (see surrounding logged error for details).");
#endif
    }
} 
```

MSVC 输出：

```
error C2338: Test failed on this used type: void __cdecl assertIfTestFailed<class BadType>(void)
... continued trace of where the erroring code came from ... 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2021-05-17T00:13:46.407

对于不同的东西，这里是类型的“到英语”转换，解构每个限定符、范围、参数等，递归地构建描述类型的字符串我认为“推导这个”提案将有助于减少许多专业化. 无论如何，这是一个有趣的晨练，不​​管过度膨胀。:)

```
struct X {
    using T = int *((*)[10]);
    T f(T, const unsigned long long * volatile * );
};

int main() {

    std::cout << describe<decltype(&X::f)>() << std::endl;
} 
```

输出：

```
pointer to member function of class 1X taking (pointer to array[10]
of pointer to int, pointer to volatile pointer to const unsigned 
long long), and returning pointer to array[10] of pointer to int 
```

这是代码： [https ://godbolt.org/z/7jKK4or43](https://godbolt.org/z/7jKK4or43)

```
// Print types as strings, including functions, member 

#include <type_traits>
#include <typeinfo>
#include <string>
#include <utility>

namespace detail {

template <typename T> struct Describe;

template <typename T, class ClassT> 
struct Describe<T (ClassT::*)>  {
    static std::string describe();
};
template <typename RetT, typename... ArgsT> 
struct Describe<RetT(ArgsT...)>  {
    static std::string describe();
};
template <typename RetT, class ClassT, typename... ArgsT> 
struct Describe<RetT(ClassT::*)(ArgsT...)>  {
    static std::string describe();
};
template <typename RetT, class ClassT, typename... ArgsT> 
struct Describe<RetT(ClassT::*)(ArgsT...) const>  {
    static std::string describe();
};
template <typename RetT, class ClassT, typename... ArgsT> 
struct Describe<RetT(ClassT::*)(ArgsT...) volatile>  {
    static std::string describe();
};
template <typename RetT, class ClassT, typename... ArgsT> 
struct Describe<RetT(ClassT::*)(ArgsT...) noexcept>  {
    static std::string describe();
};
template <typename RetT, class ClassT, typename... ArgsT> 
struct Describe<RetT(ClassT::*)(ArgsT...) const volatile>  {
    static std::string describe();
};
template <typename RetT, class ClassT, typename... ArgsT> 
struct Describe<RetT(ClassT::*)(ArgsT...) const noexcept>  {
    static std::string describe();
};
template <typename RetT, class ClassT, typename... ArgsT> 
struct Describe<RetT(ClassT::*)(ArgsT...) volatile noexcept>  {
    static std::string describe();
};
template <typename RetT, class ClassT, typename... ArgsT> 
struct Describe<RetT(ClassT::*)(ArgsT...) const volatile noexcept>  {
    static std::string describe();
};
template <typename RetT, class ClassT, typename... ArgsT> 
struct Describe<RetT(ClassT::*)(ArgsT...)&>  {
    static std::string describe();
};
template <typename RetT, class ClassT, typename... ArgsT> 
struct Describe<RetT(ClassT::*)(ArgsT...) const &>  {
    static std::string describe();
};
template <typename RetT, class ClassT, typename... ArgsT> 
struct Describe<RetT(ClassT::*)(ArgsT...) volatile &>  {
    static std::string describe();
};
template <typename RetT, class ClassT, typename... ArgsT> 
struct Describe<RetT(ClassT::*)(ArgsT...) & noexcept>  {
    static std::string describe();
};
template <typename RetT, class ClassT, typename... ArgsT> 
struct Describe<RetT(ClassT::*)(ArgsT...) const volatile &>  {
    static std::string describe();
};
template <typename RetT, class ClassT, typename... ArgsT> 
struct Describe<RetT(ClassT::*)(ArgsT...) const & noexcept>  {
    static std::string describe();
};
template <typename RetT, class ClassT, typename... ArgsT> 
struct Describe<RetT(ClassT::*)(ArgsT...) volatile & noexcept>  {
    static std::string describe();
};
template <typename RetT, class ClassT, typename... ArgsT> 
struct Describe<RetT(ClassT::*)(ArgsT...) const volatile & noexcept>  {
    static std::string describe();
};
template <typename RetT, class ClassT, typename... ArgsT> 
struct Describe<RetT(ClassT::*)(ArgsT...) &&>  {
    static std::string describe();
};
template <typename RetT, class ClassT, typename... ArgsT> 
struct Describe<RetT(ClassT::*)(ArgsT...) const &&>  {
    static std::string describe();
};
template <typename RetT, class ClassT, typename... ArgsT> 
struct Describe<RetT(ClassT::*)(ArgsT...) volatile &&>  {
    static std::string describe();
};
template <typename RetT, class ClassT, typename... ArgsT> 
struct Describe<RetT(ClassT::*)(ArgsT...) && noexcept>  {
    static std::string describe();
};
template <typename RetT, class ClassT, typename... ArgsT> 
struct Describe<RetT(ClassT::*)(ArgsT...) const volatile &&>  {
    static std::string describe();
};
template <typename RetT, class ClassT, typename... ArgsT> 
struct Describe<RetT(ClassT::*)(ArgsT...) const && noexcept>  {
    static std::string describe();
};
template <typename RetT, class ClassT, typename... ArgsT> 
struct Describe<RetT(ClassT::*)(ArgsT...) volatile && noexcept>  {
    static std::string describe();
};
template <typename RetT, class ClassT, typename... ArgsT> 
struct Describe<RetT(ClassT::*)(ArgsT...) const volatile && noexcept>  {
    static std::string describe();
};

template <typename T>
std::string describe()
{
    using namespace std::string_literals;
    auto terminal = [&](char const * desc) {
        return desc + " "s + typeid(T).name();
    };
    if constexpr(std::is_const_v<T>) {
        return "const " + describe<std::remove_const_t<T>>();
    }
    else if constexpr(std::is_volatile_v<T>) {
        return "volatile " + describe<std::remove_volatile_t<T>>();
    }
    else if constexpr (std::is_same_v<bool, T>) {
        return "bool";
    }
    else if constexpr(std::is_same_v<char, T>) {
        return "char";
    }
    else if constexpr(std::is_same_v<signed char, T>) {
        return "signed char";
    }
    else if constexpr(std::is_same_v<unsigned char, T>) {
        return "unsigned char";
    }
    else if constexpr(std::is_unsigned_v<T>) {
        return "unsigned " + describe<std::make_signed_t<T>>();
    }
    else if constexpr(std::is_void_v<T>) {
        return "void";
    }
    else if constexpr(std::is_integral_v<T>) {
        if constexpr(std::is_same_v<short, T>) 
            return "short";
        else if constexpr(std::is_same_v<int, T>) 
            return "int";
        else if constexpr(std::is_same_v<long, T>) 
            return "long";
        else if constexpr(std::is_same_v<long long, T>) 
            return "long long";
    }
    else if constexpr(std::is_same_v<float, T>) {
        return "float";
    }
    else if constexpr(std::is_same_v<double, T>) {
        return "double";
    }
    else if constexpr(std::is_same_v<long double, T>) {
        return "long double";
    }
    else if constexpr(std::is_same_v<std::nullptr_t, T>) { 
        return "nullptr_t";
    }
    else if constexpr(std::is_class_v<T>) {
        return terminal("class");
    }
    else if constexpr(std::is_union_v<T>) {
        return terminal("union");
    }
    else if constexpr(std::is_enum_v<T>) {
        std::string result;
        if (!std::is_convertible_v<T, std::underlying_type_t<T>>) {
            result += "scoped ";
        }
        return result + terminal("enum");
    }  
    else if constexpr(std::is_pointer_v<T>) {
        return "pointer to " + describe<std::remove_pointer_t<T>>();
    }
    else if constexpr(std::is_lvalue_reference_v<T>) {
        return "lvalue-ref to " + describe<std::remove_reference_t<T>>();
    }
    else if constexpr(std::is_rvalue_reference_v<T>) {
        return "rvalue-ref to " + describe<std::remove_reference_t<T>>();
    }
    else if constexpr(std::is_bounded_array_v<T>) {
        return "array[" + std::to_string(std::extent_v<T>) + "] of " +
            describe<std::remove_extent_t<T>>();
    }
    else if constexpr(std::is_unbounded_array_v<T>) {
        return "array[] of " + describe<std::remove_extent_t<T>>();
    }
    else if constexpr(std::is_function_v<T>) {
        return Describe<T>::describe();
    }
    else if constexpr(std::is_member_object_pointer_v<T>) {
        return Describe<T>::describe();
    }
    else if constexpr(std::is_member_function_pointer_v<T>) {
        return Describe<T>::describe();
    }
}

template <typename RetT, typename... ArgsT> 
std::string Describe<RetT(ArgsT...)>::describe() {
    std::string result = "function taking (";
    ((result += detail::describe<ArgsT>(", ")), ...);
    return result + "), returning " + detail::describe<RetT>();
}

template <typename T, class ClassT> 
std::string Describe<T (ClassT::*)>::describe() {
    return "pointer to member of " + detail::describe<ClassT>() +
        " of type " + detail::describe<T>();
}

struct Comma {
    char const * sep = "";
    std::string operator()(std::string const& str) {
        return std::exchange(sep, ", ") + str;
    }
};
enum Qualifiers {NONE=0, CONST=1, VOLATILE=2, NOEXCEPT=4, LVREF=8, RVREF=16};

template <typename RetT, typename ClassT, typename... ArgsT>
std::string describeMemberPointer(Qualifiers q) {
    std::string result = "pointer to ";
    if (NONE != (q & CONST)) result += "const ";
    if (NONE != (q & VOLATILE)) result += "volatile ";
    if (NONE != (q & NOEXCEPT)) result += "noexcept ";
    if (NONE != (q & LVREF)) result += "lvalue-ref ";
    if (NONE != (q & RVREF)) result += "rvalue-ref ";
    result += "member function of " + detail::describe<ClassT>() + " taking (";
    Comma comma;
    ((result += comma(detail::describe<ArgsT>())), ...);
    return result + "), and returning " + detail::describe<RetT>();
}

template <typename RetT, class ClassT, typename... ArgsT> 
std::string Describe<RetT(ClassT::*)(ArgsT...)>::describe() {
    return describeMemberPointer<RetT, ClassT, ArgsT...>(NONE);
}
template <typename RetT, class ClassT, typename... ArgsT> 
std::string Describe<RetT(ClassT::*)(ArgsT...) const>::describe() {
    return describeMemberPointer<RetT, ClassT, ArgsT...>(CONST);
}
template <typename RetT, class ClassT, typename... ArgsT> 
std::string Describe<RetT(ClassT::*)(ArgsT...) noexcept>::describe() {
    return describeMemberPointer<RetT, ClassT, ArgsT...>(NOEXCEPT);
}
template <typename RetT, class ClassT, typename... ArgsT> 
std::string Describe<RetT(ClassT::*)(ArgsT...) volatile>::describe() {
    return describeMemberPointer<RetT, ClassT, ArgsT...>(VOLATILE);
}
template <typename RetT, class ClassT, typename... ArgsT> 
std::string Describe<RetT(ClassT::*)(ArgsT...) volatile noexcept>::describe() {
    return describeMemberPointer<RetT, ClassT, ArgsT...>(VOLATILE | NOEXCEPT);
}
template <typename RetT, class ClassT, typename... ArgsT> 
std::string Describe<RetT(ClassT::*)(ArgsT...) const volatile>::describe() {
    return describeMemberPointer<RetT, ClassT, ArgsT...>(CONST | VOLATILE);
}
template <typename RetT, class ClassT, typename... ArgsT> 
std::string Describe<RetT(ClassT::*)(ArgsT...) const noexcept>::describe() {
    return describeMemberPointer<RetT, ClassT, ArgsT...>(CONST | NOEXCEPT);
}
template <typename RetT, class ClassT, typename... ArgsT> 
std::string Describe<RetT(ClassT::*)(ArgsT...) const volatile noexcept>::describe() {
    return describeMemberPointer<RetT, ClassT, ArgsT...>(CONST | VOLATILE | NOEXCEPT);
}

template <typename RetT, class ClassT, typename... ArgsT> 
std::string Describe<RetT(ClassT::*)(ArgsT...) &>::describe() {
    return describeMemberPointer<RetT, ClassT, ArgsT...>(LVREF);
}
template <typename RetT, class ClassT, typename... ArgsT> 
std::string Describe<RetT(ClassT::*)(ArgsT...) const &>::describe() {
    return describeMemberPointer<RetT, ClassT, ArgsT...>(LVREF | CONST);
}
template <typename RetT, class ClassT, typename... ArgsT> 
std::string Describe<RetT(ClassT::*)(ArgsT...) & noexcept>::describe() {
    return describeMemberPointer<RetT, ClassT, ArgsT...>(LVREF | NOEXCEPT);
}
template <typename RetT, class ClassT, typename... ArgsT> 
std::string Describe<RetT(ClassT::*)(ArgsT...) volatile &>::describe() {
    return describeMemberPointer<RetT, ClassT, ArgsT...>(LVREF | VOLATILE);
}
template <typename RetT, class ClassT, typename... ArgsT> 
std::string Describe<RetT(ClassT::*)(ArgsT...) volatile & noexcept>::describe() {
    return describeMemberPointer<RetT, ClassT, ArgsT...>(LVREF | VOLATILE | NOEXCEPT);
}
template <typename RetT, class ClassT, typename... ArgsT> 
std::string Describe<RetT(ClassT::*)(ArgsT...) const volatile &>::describe() {
    return describeMemberPointer<RetT, ClassT, ArgsT...>(LVREF | CONST | VOLATILE);
}
template <typename RetT, class ClassT, typename... ArgsT> 
std::string Describe<RetT(ClassT::*)(ArgsT...) const & noexcept>::describe() {
    return describeMemberPointer<RetT, ClassT, ArgsT...>(LVREF | CONST | NOEXCEPT);
}
template <typename RetT, class ClassT, typename... ArgsT> 
std::string Describe<RetT(ClassT::*)(ArgsT...) const volatile & noexcept>::describe() {
    return describeMemberPointer<RetT, ClassT, ArgsT...>(LVREF | CONST | VOLATILE | NOEXCEPT);
}
template <typename RetT, class ClassT, typename... ArgsT> 
std::string Describe<RetT(ClassT::*)(ArgsT...)&&>::describe() {
    return describeMemberPointer<RetT, ClassT, ArgsT...>(RVREF);
}
template <typename RetT, class ClassT, typename... ArgsT> 
std::string Describe<RetT(ClassT::*)(ArgsT...) const &&>::describe() {
    return describeMemberPointer<RetT, ClassT, ArgsT...>(RVREF | CONST);
}
template <typename RetT, class ClassT, typename... ArgsT> 
std::string Describe<RetT(ClassT::*)(ArgsT...) && noexcept>::describe() {
    return describeMemberPointer<RetT, ClassT, ArgsT...>(RVREF | NOEXCEPT);
}
template <typename RetT, class ClassT, typename... ArgsT> 
std::string Describe<RetT(ClassT::*)(ArgsT...) volatile &&>::describe() {
    return describeMemberPointer<RetT, ClassT, ArgsT...>(RVREF | VOLATILE);
}
template <typename RetT, class ClassT, typename... ArgsT> 
std::string Describe<RetT(ClassT::*)(ArgsT...) volatile && noexcept>::describe() {
    return describeMemberPointer<RetT, ClassT, ArgsT...>(RVREF | VOLATILE | NOEXCEPT);
}
template <typename RetT, class ClassT, typename... ArgsT> 
std::string Describe<RetT(ClassT::*)(ArgsT...) const volatile &&>::describe() {
    return describeMemberPointer<RetT, ClassT, ArgsT...>(RVREF | CONST | VOLATILE);
}
template <typename RetT, class ClassT, typename... ArgsT> 
std::string Describe<RetT(ClassT::*)(ArgsT...) const && noexcept>::describe() {
    return describeMemberPointer<RetT, ClassT, ArgsT...>(RVREF | CONST | NOEXCEPT);
}
template <typename RetT, class ClassT, typename... ArgsT> 
std::string Describe<RetT(ClassT::*)(ArgsT...) const volatile && noexcept>::describe() {
    return describeMemberPointer<RetT, ClassT, ArgsT...>(RVREF | CONST | VOLATILE | NOEXCEPT);
}

} // detail

///////////////////////////////////
// Main function
///////////////////////////////////
template <typename T>
std::string describe() {
    return detail::describe<T>();
}

///////////////////////////////////
// Sample code
///////////////////////////////////
#include <iostream>

struct X {
    using T = int *((*)[10]);
    T f(T, const unsigned long long * volatile * );
};

int main() {
    std::cout << describe<decltype(&X::f)>() << std::endl;
} 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2022-01-24T20:20:35.713

基于之前的一些答案，我提出了这个不将结果存储`__PRETTY_FUNCTION__`在二进制文件中的解决方案。它使用一个静态数组来保存类型名称的字符串表示。

它需要 C++23。

```
#include <iostream>
#include <string_view>
#include <array>

template <typename T>
constexpr auto type_name() {
    auto gen = [] <class R> () constexpr -> std::string_view  {
        return __PRETTY_FUNCTION__;
    };
    constexpr std::string_view search_type = "float";
    constexpr auto search_type_string = gen.template operator()<float>();
    constexpr auto prefix = search_type_string.find(search_type);
    constexpr auto suffix = search_type_string.size() - prefix - search_type.size();
    constexpr auto str = gen.template operator()<T>();
    constexpr int size = str.size() - prefix - suffix;
    constexpr auto static arr = [&]<std::size_t... I>(std::index_sequence<I...>) constexpr {
        return std::array<char, size>{str[prefix + I]...};
    } (std::make_index_sequence<size>{});

    return std::string_view(arr.data(), size);
} 
```

# php - 如何启动脸书应用程序？

> ID：81874
> 
> 赞同：11
> 
> 时间：2008-09-17T10:35:54.243
> 
> 标签：php, ruby-on-rails, ruby, facebook

只是想知道开始开发 faccebook 应用程序的更好方法是什么？任何教程推荐？启动 -php 或 rails 哪个更好？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-30T13:53:46.777

根据我的经验，对 PHP 的支持比对其他任何东西都要好得多。也就是说，仅仅为了利用卓越的支持而学习 PHP 是没有意义的。

另外两个一般要点：

1.  官方支持社区真的很糟糕。社区没有专家的声音，FB 工作人员只有在他们的声誉受到威胁时才会插话。你最好的朋友是谷歌，你从教程中推断的能力。
2.  FB 交互风格并不真正适合 MVC 框架。一个可能仍然可以节省您的时间，但我发现他们在我的脚下。如果您需要在这一点上令人信服，我可以向您推荐许多需要 JSON 响应或需要为配置文件“设置”FBML 的情况。

Facebook 平台并不好玩，您的用户不会感谢您的工作。但这是一个庞大的受众和非常有用的学习经验。

祝你好运！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-16T20:34:57.743

顺便说一句，您也可以使用 ASP.NET，在这种情况下，如何开始：

[http://www.stevetrefethen.com/wiki/Facebook%20application%20development%20in%20ASP.NET.ashx](http://www.stevetrefethen.com/wiki/Facebook%20application%20development%20in%20ASP.NET.ashx)

该链接包括一个 VS.NET 入门工具包，它可以很容易地快速入门。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T10:39:56.230

从他们的文档开始：http: [//developer.facebook.com/get_started.php ?tab=tutorial](http://developer.facebook.com/get_started.php?tab=tutorial)

有许多不同语言和框架的库随处可见，所以我说：你最满意的地方就是你应该从哪里开始。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-08T19:38:29.700

我已经看到了相当完整的 PHP 和 Ruby 的 FB 包装器库。您应该选择哪一种实际上取决于您更喜欢哪种语言/框架。

我会说，当我最近在评估 Ruby 库时，[Facebooker在网络上的积极开发和](http://github.com/mmangino/facebooker/tree/master "脸书人")[教程内容](http://apps.facebook.com/facebooker_tutorial/ "Facebooker 教程")方面似乎更胜一筹。（请务必使用 GitHub 上的 Facebooker 项目，而不是 RubyForge 上已弃用的项目。）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-10-08T18:16:35.407

我可以用 Koala gem 为 Ruby On Rails 大喊大叫吗？

在过去的两个月里，我构建了一个 Facebook 应用程序，从头开始学习 Ruby On Rails（我所做的最后一次编程是 1995 年在 Fortran 中为我的物理学学位项目进行数学建模！）。

Ruby On Rails 很容易上手，而且有很多帮助。Ruby Gems 的方式也已经为您完成了很多工作。对于 Facebook，我浏览了所有这些，我发现考拉是最容易使用的，就个人而言。

[http://github.com/arsduo/koala/](http://github.com/arsduo/koala/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T10:41:09.083

使用[developer.facebook.com](http://developers.facebook.com)上的[入门教程](http://developers.facebook.com/get_started.php?tab=tutorial)。这将建议您使用示例代码按钮，该按钮将为您提供一些 PHP 来列出您的朋友。然后，您可以使用 wiki 参考 FQL 和 FBML 开始使用 PHP。

PHP 将更容易开始，因为 PHP 中有很多示例。但从长远来看，Rails 可能具有优势。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T13:14:28.310

回复：Ruby on Rails 与 PHP - 无论你目前能胜任的。如果两者都不是，无论你想*成为*胜任的。两者都可以做你想做的事。

# php - 为什么内容标题“应用程序/javascript”会导致 500 错误？

> ID：81896
> 
> 赞同：21
> 
> 时间：2008-09-17T10:39:34.203
> 
> 标签：php, iis-7, mime-types

我有一个在我的测试服务器上运行良好的脚本（使用 IIS6）。该脚本处理 ajax 请求并发送带有以下行的响应：

```
header( 'application/javascript' ); 
```

但是在我的实时服务器上，这一行会使页面崩溃并导致 500 错误。

我是否需要允许 PHP 在 IIS7 中发送不同的 MIME 类型？如果是这样，我该怎么做？我在界面上找不到任何方法。

* * *

## 回答 #1

> 赞同：122
> 
> 时间：2008-09-17T10:46:52.033

标题不正确，请尝试以下操作：

```
header('Content-Type: application/javascript'); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-27T14:32:40.287

看看**[http://en.wikipedia.org/wiki/Mime_type](http://en.wikipedia.org/wiki/Mime_type)**

那里说你应该使用 application/javascript 而不是 text/javascript。

# java - 如何从 Java 中查找并杀死正在运行的 Win-Processes？

> ID：81902
> 
> 赞同：28
> 
> 时间：2008-09-17T10:40:05.777
> 
> 标签：java, windows, process

我需要一种 Java 方法来找到一个正在运行的 Win 进程，我从中知道可执行文件的名称。我想看看它现在是否正在运行，如果我找到它，我需要一种方法来终止该进程。

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2011-09-19T15:44:31.220

```
private static final String TASKLIST = "tasklist";
private static final String KILL = "taskkill /F /IM ";

public static boolean isProcessRunning(String serviceName) throws Exception {

 Process p = Runtime.getRuntime().exec(TASKLIST);
 BufferedReader reader = new BufferedReader(new InputStreamReader(
   p.getInputStream()));
 String line;
 while ((line = reader.readLine()) != null) {

  System.out.println(line);
  if (line.contains(serviceName)) {
   return true;
  }
 }

 return false;

}

public static void killProcess(String serviceName) throws Exception {

  Runtime.getRuntime().exec(KILL + serviceName);

 } 
```

例子：

```
public static void main(String args[]) throws Exception {
 String processName = "WINWORD.EXE";

 //System.out.print(isProcessRunning(processName));

 if (isProcessRunning(processName)) {

  killProcess(processName);
 }
} 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-09-17T11:06:18.833

您可以使用命令行窗口工具`tasklist`，`taskkill`并使用`Runtime.exec()`.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-04-19T13:59:56.177

有一个小 API 提供了所需的功能：

[https://github.com/kohsuke/winp](https://github.com/kohsuke/winp)

Windows 进程库

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2015-04-02T12:54:32.280

这是一种很时髦的做法：

```
final Process jpsProcess = "cmd /c jps".execute()
final BufferedReader reader = new BufferedReader(new InputStreamReader(jpsProcess.getInputStream()));
def jarFileName = "FileName.jar"
def processId = null
reader.eachLine {
    if (it.contains(jarFileName)) {
        def args = it.split(" ")
        if (processId != null) {
            throw new IllegalStateException("Multiple processes found executing ${jarFileName} ids: ${processId} and ${args[0]}")
        } else {
            processId = args[0]
        }
    }
}
if (processId != null) {
    def killCommand = "cmd /c TASKKILL /F /PID ${processId}"
    def killProcess = killCommand.execute()
    def stdout = new StringBuilder()
    def stderr = new StringBuilder()
    killProcess.consumeProcessOutput(stdout, stderr)
    println(killCommand)
    def errorOutput = stderr.toString()
    if (!errorOutput.empty) {
        println(errorOutput)
    }
    def stdOutput = stdout.toString()
    if (!stdOutput.empty) {
        println(stdOutput)
    }
    killProcess.waitFor()
} else {
    System.err.println("Could not find process for jar ${jarFileName}")
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-17T10:53:58.473

您可以使用命令行工具来杀死[SysInternals PsKill](http://technet.microsoft.com/de-de/sysinternals/bb896683.aspx)和SysInternals [PsList](http://technet.microsoft.com/de-de/sysinternals/bb896682.aspx)等进程。

您也可以使用内置的 tasklist.exe 和 taskkill.exe，但这些仅适用于 Windows XP Professional 及更高版本（不适用于家庭版）。

使用[java.lang.Runtime.exec](http://java.sun.com/javase/6/docs/api/java/lang/Runtime.html#exec(java.lang.String))执行程序。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-06-15T11:10:38.487

使用以下类[杀死 Windows 进程](https://en.wikipedia.org/wiki/Kill_(command)#Microsoft_Windows)（[如果它正在运行](https://en.wikipedia.org/wiki/Tasklist)）。我正在使用 force 命令行参数`/F`来确保该`/IM`参数指定的进程将被终止。

```
import java.io.BufferedReader;
import java.io.InputStreamReader;

public class WindowsProcess
{
    private String processName;

    public WindowsProcess(String processName)
    {
        this.processName = processName;
    }

    public void kill() throws Exception
    {
        if (isRunning())
        {
            getRuntime().exec("taskkill /F /IM " + processName);
        }
    }

    private boolean isRunning() throws Exception
    {
        Process listTasksProcess = getRuntime().exec("tasklist");
        BufferedReader tasksListReader = new BufferedReader(
                new InputStreamReader(listTasksProcess.getInputStream()));

        String tasksLine;

        while ((tasksLine = tasksListReader.readLine()) != null)
        {
            if (tasksLine.contains(processName))
            {
                return true;
            }
        }

        return false;
    }

    private Runtime getRuntime()
    {
        return Runtime.getRuntime();
    }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T10:48:12.873

您将不得不调用一些本机代码，因为恕我直言，没有库可以做到这一点。由于 JNI 既麻烦又困难，您可以尝试使用 JNA（Java Native Access）。[https://jna.dev.java.net/](https://jna.dev.java.net/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-05-26T12:17:53.947

Super kakes 写的答案的微小变化

```
private static final String KILL = "taskkill /IMF "; 
```

变成 ..

```
private static final String KILL = "taskkill /IM "; 
```

`/IMF`选项不起作用.它不会杀死记事本..而`/IM`选项实际上有效

# virtual-pc - 创建重复 Virtual PC 映像的更快方法？

> ID：81904
> 
> 赞同：3
> 
> 时间：2008-09-17T10:40:15.497
> 
> 标签：virtual-pc

我使用 Virtual PC 来创建全新的环境来测试我的安装程序。但我一定是做错了什么，因为内部带有 Vista 或 XP 的 VPC 映像占用了大约 15GB 的磁盘空间（其中包括安装在其中的 VS2005/S2008）。

为了创建一个用于测试的新副本，我复制并粘贴了其中包含 .vhd、.vmc 和 .vsv 文件的文件夹。在使用新的 VPC 映像进行测试后，我删除了该复制的文件夹。这可行，但每次复制 15GB 需要很长时间。有没有更快/更有效的方法？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-17T10:44:11.807

使用[差异/撤消磁盘](http://www.petri.co.il/virtual_creating_differencing_disks_with.htm)。这意味着当您关闭 VPC 时，系统会询问您是否要保存更改，只需回答“否”，您就会回到开始的位置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T10:43:00.200

VirtualPC 没有假写/快照模式吗？这样，除非您在会话结束时这样说，否则它根本不应该写入您的原始磁盘。

如果没有，您可能会认真考虑 VMWare 或 VirtualBox，因为它们确实具有此功能，并且对于此类事情非常有用。

编辑：看起来 VPC 确实有一个称为差异磁盘的功能。看看这个： [http ://www.andrewconnell.com/blog/articles/UseVirtualPCsDifferencingDisksToYourAdvantage.aspx](http://www.andrewconnell.com/blog/articles/UseVirtualPCsDifferencingDisksToYourAdvantage.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T10:44:33.723

VPC 有一个所谓的撤消磁盘。您创建类似于“恢复点”的 sg，在 vpc 中您可以回滚到该版本。非常适合测试设置。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T10:44:48.980

听起来您需要使用差异化虚拟硬盘，而不是每次都创建一个新副本。

[这里的](http://dotnet.org.za/matt/pages/2413.aspx)说明

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T18:46:08.647

另一种选择：您可以使用 Microsoft 的 ImageX 以 WIM 格式存储 VHD。如果您有多个要不断重复使用的映像，那么这是管理 VM 的绝佳方式。我有大量以压缩 WIM 格式保存的 Windows XP 和 2003 图像。

您可以通过在 Windows PE 中安装 VM，然后将它们捕获到网络驱动器来捕获 VM。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T10:55:38.720

另外，您提到了剪切和粘贴，这不是在 Windows 中复制大量数据的最佳方式。至少使用 xcopy，robocopy 甚至更快。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-11T23:25:38.357

此外，如果您希望复制图像以在其他真实机器上使用，另一种选择是，您可以将磁盘转换为动态扩展磁盘，这将减小虚拟磁盘的大小，从而更容易复制。这也允许更快速的备份，这看起来是您的测试默认执行的一部分。动态磁盘的问题在于它们的性能往往比固定大小的磁盘稍慢。

但是，如果您所做的只是在同一台机器上使用它进行测试，请参阅上面的答案。差异化是要走的路。

# sql - Transact-SQL 总结经过的时间

> ID：81905
> 
> 赞同：5
> 
> 时间：2008-09-17T10:40:27.023
> 
> 标签：sql, sql-server, tsql

我的数据库中有一个表，记录了特定任务的开始和停止时间。以下是数据示例：

```
Start                       Stop
9/15/2008 5:59:46 PM        9/15/2008 6:26:28 PM
9/15/2008 6:30:45 PM        9/15/2008 6:40:49 PM
9/16/2008 8:30:45 PM        9/15/2008 9:20:29 PM
9/16/2008 12:30:45 PM       12/31/9999 12:00:00 AM 
```

我想编写一个脚本来汇总这些时间范围内经过的分钟数，并且只要有 12/31/9999 日期，我希望它使用当前日期和时间，因为这仍在进行中。

我将如何使用 Transact-SQL 执行此操作？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-17T13:13:06.563

```
SELECT  SUM( CASE  WHEN Stop = '31 dec 9999' 
                   THEN DateDiff(mi, Start, Stop)
                   ELSE DateDiff(mi, Start, GetDate())
             END ) AS TotalMinutes 
FROM    task 
```

但是，更好的解决方案是使`Stop field nullable, and make it null when the task is still running. That way, you could do this:`

```
SELECT  SUM( DateDiff( mi, Start, IsNull(Stop, GetDate() ) ) AS TotalMinutes 
FROM    task 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-25T23:26:39.913

我认为这更清洁：

```
 SELECT  SUM(
               DATEDIFF(mi, Start, ISNULL(NULLIF(Stop,'99991231'), GetDate()))
              ) AS ElapsedTime
   FROM Table 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-17T11:06:55.947

尝试：

```
Select Sum(
    DateDiff(
        Minute,
        IsNull((Select Start where Start != '9999.12.31'), GetDate()),
        IsNull((Select End where End != '9999.12.31'), GetDate())
    )
)
from *tableName* 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T11:15:34.820

以下将适用于 SQL Server，其他数据库使用不同的函数进行日期计算和获取当前时间。

```
Select  Case When (Stop <> '31 Dec 9999') Then 
          DateDiff(mi, Start, Stop) 
        Else 
          DateDiff(mi, Start, GetDate()) 
        End
From    ATable 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T10:44:07.390

[datediff 函数](http://msdn.microsoft.com/en-us/library/ms189794.aspx)可以显示经过的分钟数。9999 年 12 月 31 日检查的 if 语句我将作为练习留给读者 ;-)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T10:55:34.680

--你可以用 mi 玩 datediff 几分钟

-- 这给了你每个任务的第二个

```
select  Start,  
        Stop, 
        CASE 
            WHEN Stop = '9999-12-31' THEN  datediff(ss, start,getdate())
            ELSE datediff(ss, start,stop) 
        END duration_in_seconds 

from mytable 
```

——总和

```
Select Sum(duration_in_seconds)
from 
(
select  Start,  
        Stop, 
        CASE 
            WHEN Stop = '9999-12-31' THEN  datediff(ss, start,getdate())
            ELSE datediff(ss, start,stop) 
        END duration_in_seconds 

from mytable)x 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T10:56:41.120

Datediff 变得更加难以使用，因为您的差异中有更多的日期部分（即在您的情况下，看起来像分钟和秒；偶尔是小时）。幸运的是，在大多数 TSQL 变体中，您可以简单地对日期执行数学运算。假设这是一个日期字段，您可能只需要查询：

选择持续时间 = 停止 - 开始

举一个实际的例子，让我们选择两个日期时间之间的差异，而不用考虑表格：

选择转换（日期时间，'2008-09-17 04:56:45.030'） - 转换（日期时间，'2008-09-17 04:53:05.920'）

返回“1900-01-01 00:03:39.110”，表示有零年/月/日；这两个日期时间之间 3 分 39.11 秒。从那里，您的代码可以 TimeSpan.Parse 这个值。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-17T19:40:05.777

使用 AJ 的[回答](https://stackoverflow.com/questions/81905/transact-sql-to-sum-up-elapsed-time#83005)、BelowNinety 的[回答](https://stackoverflow.com/questions/81905/transact-sql-to-sum-up-elapsed-time#82039)和 Nerdfest 的[回答](https://stackoverflow.com/questions/81905/transact-sql-to-sum-up-elapsed-time#82039)的帮助，我得出以下结论：

```
Select Sum(
    Case When End = '12/31/9999 12:00:00 AM' Then
         DateDiff(mi, Start, Getdate()) 
    Else 
         DateDiff(mi, Start, End) 
    End) As ElapsedTime 
From Table 
```

谢谢您的帮助！

# asp.net - ASP.NET 网站不重建

> ID：81911
> 
> 赞同：0
> 
> 时间：2008-09-17T10:41:18.113
> 
> 标签：asp.net

我在 Visual 2008 中有几个项目的解决方案，比如说 SuggestionProcessor（一个类库）和 Suggestions（一个网站）和一个 webhandler GetSuggestions.ashx。我更改了 Webhandler 中使用的 SuggestionProcessor 中的方法。webhandler 中的调用已调整为更改的方法。

但是现在，当我尝试在重建后执行 webhandler 时，我得到一个错误，我更改的方法**丢失**，显示**旧的方法签名**。当我尝试重建整个项目时，网站似乎没有正确重建，并且我在 webhandler 中更改的代码似乎没有包含在重建中。我确保该网站位于构建顺序中的最后一个。

我尝试的是从 bin 文件夹**中删除构建过程应该重建的 dll**（不是从网站外部引用的那些）。重建时，我现在得到一个：'**无法加载类型**Suggestions.global'。呃，这就是构建过程应该创建的。这里出了什么问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T12:55:54.873

我通过在它仍然有效时恢复到以前的状态来解决这个问题。

感谢您的建议，很抱歉它们在我的情况下不起作用。

现在我应该删除这个问题，因为它对其他人并没有明确的用途吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T10:43:48.560

我会检查你的 web.config 文件，那里可能有导致错误的引用，因为它们丢失了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T10:52:55.887

也许尝试右键单击您的解决方案并选择“清洁解决方案”，然后尝试重新构建所有解决方案。

如果这不起作用，请检查您的解决方案构建配置并确保您的所有项目都在构建

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T11:02:26.347

尝试“清理解决方案”，然后构建 SuggestionProcessor，然后清理并重建 Web 解决方案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T12:38:55.757

Visual Studio 会创建所有 DLL 的副本，有时不会刷新此副本。只需执行**iisreset**并删除以下所有文件夹：

> C:\WINDOWS\Microsoft.NET\Framework\v1.1.4322\Temporary ASP.NET Files\

当然将Windows安装文件夹和框架文件夹更改为您的版本！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T12:59:46.113

我不这么认为......我在 Visual Studio 2008 中看到了类似的问题，这些问题正在处理构建和重建会一次又一次失败的 Web 项目。我知道我的更改不应该影响构建，所以我只是不断清理和构建解决方案中的每个单独项目，直到最后（我的意思是最后，它需要多达 10 个构建）我的 Web 项目将构建正确。我不知道为什么，但感觉像是某种缓存问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-01-07T20:08:16.707

从我在[“无法加载类型 [Namespace].Global”的回答中让我感到悲痛](https://stackoverflow.com/questions/2005747/could-not-load-type-namespace-global-causing-me-grief/2023267#2023267)：

> 默认情况下，VS 2008 似乎并不总是正确添加 .asax(.cs) 文件。

在这种情况下，刷新、重建、删除和重新添加等都无法解决问题。反而：

> 检查 Global.asax.cs 的构建操作。它应该设置为编译。
> 
> 在解决方案资源管理器中，右键单击 Global.asax.cs 并转到属性。在“属性”窗格中，设置构建操作（而不是调试）。

# php - 无需访问服务器或 phpMyADMIN 即可导出 SQL 表的简便方法

> ID：81934
> 
> 赞同：29
> 
> 时间：2008-09-17T10:45:29.227
> 
> 标签：php, mysql, export, load-data-infile

我需要一种方法来轻松地将 MySQL 表中的数据从远程服务器导出然后导入到我的家庭服务器。我没有直接访问服务器的权限，也没有安装 phpMyAdmin 等实用程序。但是，我确实有能力将 PHP 脚本放在服务器上。

我如何获取数据？

*我问这个问题纯粹是为了记录我的做法*

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-09-17T11:19:49.160

您可以为此使用 SQL：

```
$file = 'backups/mytable.sql';
$result = mysql_query("SELECT * INTO OUTFILE '$file' FROM `##table##`"); 
```

然后只需将浏览器或 FTP 客户端指向目录/文件 (backups/mytable.sql)。这也是进行增量备份的好方法，例如给定文件名一个时间戳。

要将其从该文件中恢复到您的数据库中，您可以使用：

```
$file = 'backups/mytable.sql';
$result = mysql_query("LOAD DATA INFILE '$file' INTO TABLE `##table##`"); 
```

另一种选择是使用 PHP 在服务器上调用系统命令并运行“mysqldump”：

```
$file = 'backups/mytable.sql';
system("mysqldump --opt -h ##databaseserver## -u ##username## -p ##password## ##database | gzip > ".$file); 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-09-17T10:48:24.213

我通过导出到 CSV，然后使用任何可用的实用程序导入来做到这一点。我非常喜欢使用 php://output 流。

```
$result = $db_con->query('SELECT * FROM `some_table`');
$fp = fopen('php://output', 'w');
if ($fp && $result) {
    header('Content-Type: text/csv');
    header('Content-Disposition: attachment; filename="export.csv"');
    while ($row = $result->fetch_array(MYSQLI_NUM)) {
        fputcsv($fp, array_values($row));
    }
    die;
} 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-09-18T21:31:44.767

您还应该考虑[phpMinAdmin](http://phpminadmin.sourceforge.net/)，它只有一个文件，因此很容易上传和设置。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2015-05-13T19:31:39.093

**工作解决方案**（最新版本： [**Export.php**](https://github.com/tazotodua/useful-php-scripts/blob/master/export-mysql-database-sql-backup.php) + [**Import.php**](https://github.com/tazotodua/useful-php-scripts/blob/master/import-sql-database-mysql.php)）

```
EXPORT_TABLES("localhost","user","pass","db_name"); 
```

代码：

```
//https://github.com/tazotodua/useful-php-scripts
function EXPORT_TABLES($host,$user,$pass,$name,  $tables=false, $backup_name=false ){
    $mysqli = new mysqli($host,$user,$pass,$name); $mysqli->select_db($name); $mysqli->query("SET NAMES 'utf8'");
    $queryTables = $mysqli->query('SHOW TABLES'); while($row = $queryTables->fetch_row()) { $target_tables[] = $row[0]; }   if($tables !== false) { $target_tables = array_intersect( $target_tables, $tables); }
    foreach($target_tables as $table){
        $result = $mysqli->query('SELECT * FROM '.$table);  $fields_amount=$result->field_count;  $rows_num=$mysqli->affected_rows;     $res = $mysqli->query('SHOW CREATE TABLE '.$table); $TableMLine=$res->fetch_row();
        $content = (!isset($content) ?  '' : $content) . "\n\n".$TableMLine[1].";\n\n";
        for ($i = 0, $st_counter = 0; $i < $fields_amount;   $i++, $st_counter=0) {
            while($row = $result->fetch_row())  { //when started (and every after 100 command cycle):
                if ($st_counter%100 == 0 || $st_counter == 0 )  {$content .= "\nINSERT INTO ".$table." VALUES";}
                    $content .= "\n(";
                    for($j=0; $j<$fields_amount; $j++)  { $row[$j] = str_replace("\n","\\n", addslashes($row[$j]) ); if (isset($row[$j])){$content .= '"'.$row[$j].'"' ; }else {$content .= '""';}     if ($j<($fields_amount-1)){$content.= ',';}      }
                    $content .=")";
                //every after 100 command cycle [or at last line] ....p.s. but should be inserted 1 cycle eariler
                if ( (($st_counter+1)%100==0 && $st_counter!=0) || $st_counter+1==$rows_num) {$content .= ";";} else {$content .= ",";} $st_counter=$st_counter+1;
            }
        } $content .="\n\n\n";
    }
    $backup_name = $backup_name ? $backup_name : $name."___(".date('H-i-s')."_".date('d-m-Y').")__rand".rand(1,11111111).".sql";
    header('Content-Type: application/octet-stream');   header("Content-Transfer-Encoding: Binary"); header("Content-disposition: attachment; filename=\"".$backup_name."\"");  echo $content; exit;
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-17T11:02:57.453

如果您有 FTP/SFTP 访问权限，您可以继续自己上传 phpMyAdmin。

我正在使用这个小包从我只有 FTP 访问权限的服务器进行自动 mysql 备份：
[http](http://www.taw24.de/download/pafiledb.php?PHPSESSID=b48001ea004aacd86f5643a72feb2829&action=viewfile&fid=43&id=1)
://www.taw24.de/download/pafiledb.php?PHPSESSID=b48001ea004aacd86f5643a72feb2829&action=viewfile&fid=43&id= 1 该网站是德语，但下载也有一些英文文档。

一个快速的谷歌也出现了这个，但我自己没有使用它：http:
[//snipplr.com/view/173/mysql-dump/](http://snipplr.com/view/173/mysql-dump/)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-17T16:57:40.440

您可能会考虑查看：[http](http://www.webyog.com) ://www.webyog.com 这是一个很棒的 GUI 管理工具，并且它们具有非常简洁的 HTTP 隧道功能（我不确定这是否仅在企业中花费几美元）。

基本上，您将他们提供的脚本上传到您的网站空间（php 脚本）并将 sqlog 管理器指向它，您就可以访问数据库。它使用此脚本来隧道/代理您的家庭客户端和服务器之间的请求/查询。

我知道至少有 1 人使用这种方法取得了很好的效果。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2015-08-20T12:00:31.130

这是`PHP`我制作的脚本，它将备份数据库中的所有表。它基于这个[http://davidwalsh.name/backup-mysql-database-php](http://davidwalsh.name/backup-mysql-database-php)并进行了一些改进。首先它将正确设置`foreign key restrictions`。

在我的设置中，脚本将在一周中的某一天运行，比如说星期一。如果它没有在星期一运行，它仍然会在星期二运行（例如），创建`.sql`具有上星期一日期的文件，当时它应该运行。它将`.sql`从 4 周前删除文件，因此它始终保留最后 4 个备份。这是代码：

```
<?php

backup_tables();

// backup all tables in db
function backup_tables()
{
    $day_of_backup = 'Monday'; //possible values: `Monday` `Tuesday` `Wednesday` `Thursday` `Friday` `Saturday` `Sunday`
    $backup_path = 'databases/'; //make sure it ends with "/"
    $db_host = 'localhost';
    $db_user = 'root';
    $db_pass = '';
    $db_name = 'movies_database_1';

    //set the correct date for filename
    if (date('l') == $day_of_backup) {
        $date = date("Y-m-d");
    } else {
        //set $date to the date when last backup had to occur
        $datetime1 = date_create($day_of_backup);
        $date = date("Y-m-d", strtotime($day_of_backup.' -7 days'));
    }

    if (!file_exists($backup_path.$date.'-backup'.'.sql')) {

        //connect to db
        $link = mysqli_connect($db_host,$db_user,$db_pass);
        mysqli_set_charset($link,'utf8');
        mysqli_select_db($link,$db_name);

        //get all of the tables
        $tables = array();
        $result = mysqli_query($link, 'SHOW TABLES');
        while($row = mysqli_fetch_row($result))
        {
            $tables[] = $row[0];
        }

        //disable foreign keys (to avoid errors)
        $return = 'SET FOREIGN_KEY_CHECKS=0;' . "\r\n";
        $return.= 'SET SQL_MODE="NO_AUTO_VALUE_ON_ZERO";' . "\r\n";
        $return.= 'SET AUTOCOMMIT=0;' . "\r\n";
        $return.= 'START TRANSACTION;' . "\r\n";

        //cycle through
        foreach($tables as $table)
        {
            $result = mysqli_query($link, 'SELECT * FROM '.$table);
            $num_fields = mysqli_num_fields($result);
            $num_rows = mysqli_num_rows($result);
            $i_row = 0;

            //$return.= 'DROP TABLE '.$table.';'; 
            $row2 = mysqli_fetch_row(mysqli_query($link,'SHOW CREATE TABLE '.$table));
            $return.= "\n\n".$row2[1].";\n\n"; 

            if ($num_rows !== 0) {
                $row3 = mysqli_fetch_fields($result);
                $return.= 'INSERT INTO '.$table.'( ';
                foreach ($row3 as $th) 
                { 
                    $return.= '`'.$th->name.'`, '; 
                }
                $return = substr($return, 0, -2);
                $return.= ' ) VALUES';

                for ($i = 0; $i < $num_fields; $i++) 
                {
                    while($row = mysqli_fetch_row($result))
                    {
                        $return.="\n(";
                        for($j=0; $j<$num_fields; $j++) 
                        {
                            $row[$j] = addslashes($row[$j]);
                            $row[$j] = preg_replace("#\n#","\\n",$row[$j]);
                            if (isset($row[$j])) { $return.= '"'.$row[$j].'"' ; } else { $return.= '""'; }
                            if ($j<($num_fields-1)) { $return.= ','; }
                        }
                        if (++$i_row == $num_rows) {
                            $return.= ");"; // last row
                        } else {
                            $return.= "),"; // not last row
                        }   
                    }
                }
            }
            $return.="\n\n\n";
        }

        // enable foreign keys
        $return .= 'SET FOREIGN_KEY_CHECKS=1;' . "\r\n";
        $return.= 'COMMIT;';

        //set file path
        if (!is_dir($backup_path)) {
            mkdir($backup_path, 0755, true);
        }

        //delete old file
        $old_date = date("Y-m-d", strtotime('-4 weeks', strtotime($date)));
        $old_file = $backup_path.$old_date.'-backup'.'.sql';
        if (file_exists($old_file)) unlink($old_file);

        //save file
        $handle = fopen($backup_path.$date.'-backup'.'.sql','w+');
        fwrite($handle,$return);
        fclose($handle);
    }
}

?> 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-06-14T18:59:41.540

我发现我没有足够的权限`SELECT * INTO OUTFILE`。但是与其他方法相比，我能够使用足够多的 php（迭代和内爆）来真正减少嵌套循环。

```
$dbfile = tempnam(sys_get_temp_dir(),'sql');

// array_chunk, but for an iterable
function iter_chunk($iterable,$chunksize) {
    foreach ( $iterable as $item ) {
        $ret[] = $item;
        if ( count($ret) >= $chunksize ) {
            yield $ret;
            $ret = array();
        }
    }
    if ( count($ret) > 0 ) {
        yield $ret;
    }
}

function tupleFromArray($assocArr) {
    return '('.implode(',',array_map(function($val) {
        return '"'.addslashes($val).'"';
    },array_values($assocArr))).')';
}

file_put_contents($dbfile,"\n-- Table $table --\n/*\n");
$description = $db->query("DESCRIBE `$table`");
$row = $description->fetch_assoc();
file_put_contents($dbfile,implode("\t",array_keys($row))."\n",FILE_APPEND);
foreach ( $description as $row ) {
    file_put_contents($dbfile,implode("\t",array_values($row))."\n",FILE_APPEND);
}
file_put_contents($dbfile,"*/\n",FILE_APPEND);
file_put_contents($dbfile,"DROP TABLE IF EXISTS `$table`;\n",FILE_APPEND);
file_put_contents($dbfile,array_pop($db->query("SHOW CREATE TABLE `$table`")->fetch_row()),FILE_APPEND);
$ret = $db->query("SELECT * FROM `$table`");
$chunkedData = iter_chunk($ret,1023);
foreach ( $chunkedData as $chunk ) {
    file_put_contents($dbfile, "\n\nINSERT INTO `$table` VALUES " . implode(',',array_map('tupleFromArray',$chunk)) . ";\n", FILE_APPEND );
}
readfile($dbfile);
unlink($dbfile); 
```

如果您有带有外键的表，如果您以正确的顺序删除它们，然后以正确的（反向）顺序重新创建它们，这种方法仍然可以工作。该`CREATE`语句将为您创建外键依赖项。通过`SELECT * FROM information_schema.referential_constraints`以确定该顺序。

如果您的外键具有循环依赖关系，则不可能删除或创建顺序。在这种情况下，您也许可以效仿 phpMyAdmin，它会在最后创建所有外键。但这也意味着你必须调整`CREATE`报表。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2008-09-17T16:22:38.153

我通过命令行使用 mysqldump ：

```
exec("mysqldump sourceDatabase -uUsername -p'password'  > outputFilename.sql"); 
```

然后，您只需下载生成的文件并完成。

# javascript - 通过javascript隐藏谷歌工具栏

> ID：81945
> 
> 赞同：2
> 
> 时间：2008-09-17T10:47:31.517
> 
> 标签：javascript, browser, google-toolbar

有没有办法在我的可编程浏览器中隐藏谷歌工具栏？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-17T10:52:17.747

您还没有说您使用的是哪种浏览器，所以我将假设 Internet Explorer* 并回答否。

如果网页上的 JavaScript 可以操纵浏览器，那将是一个严重的安全漏洞，并可能给用户带来很多混乱。

所以不......有一个很好的理由：安全性。

*。如果您使用的是 Firefox，并且在扩展中谈论 JavaScript 来操作和主题化窗口镶边，那么这将是一个不同的故事。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T10:53:01.347

我真的认为用 javascript 做到这一点是不可能的。这是因为 javascript 旨在控制网站的行为。浏览器不是网站的一部分。

当然，您可能正在谈论其他一些 Google 工具栏，然后是浏览器中的插件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T10:54:54.930

据我所知，由于安全问题，您无法访问浏览器的这些部分。但是您可以加载没有工具栏的新浏览器窗口。我不确切知道如何（希望其他用户会帮助你），但也许从这里开始：[http ://www.experts-exchange.com/Web/Web_Languages/JavaScript/Q_20782379.html](http://www.experts-exchange.com/Web/Web_Languages/JavaScript/Q_20782379.html)

（PS：我知道，这是专家交流，但我不会复制别人的工作，即使它发布在EE上）。

# visual-studio-2008 - Visual Studio 2008 中的 Unicode 调试可视化工具

> ID：81949
> 
> 赞同：2
> 
> 时间：2008-09-17T10:48:21.560
> 
> 标签：visual-studio-2008, unicode, debugging

Visual Studio 2008 中是否有 unicode 调试可视化工具？我有一个 xml 文件，我很确定它是 unicode 格式的。当我在写字板中打开它时，它会正确显示日文字符。当我使用 File.ReadAllText (UTF8) 将文件读入字符串时，所有日文字符都在字符串可视化器中显示为块。如果我使用 xml 可视化工具，字符会正确显示。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-18T22:48:40.823

如果你得到的是方块，而不是完全的垃圾，你可能只需要在 Visual Studio 中指定更合适的字体（在工具 | 选项 | 字体和颜色中）。试试 MS Gothic 或 MS Mincho（都是日文字体）；我猜您的问题可以通过调整 [Watch, Locals and Autos Tool Windows] 的设置来解决，但它可能在其他地方。

并非所有应用程序都会神奇地将字体链接到包含您要显示的字符的字体。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T12:07:28.627

你说它是**Unicode**，那为什么不使用 File.ReadAllText( **Encoding.Unicode** ) 呢？

# delphi - 在 DCOM 中设置远程启动

> ID：81963
> 
> 赞同：2
> 
> 时间：2008-09-17T10:51:55.030
> 
> 标签：delphi, dcom

我可以使用 DCOMCNFG 在我的 DCOM 应用程序上禁用远程启动，但我想以编程方式执行此操作。我查看了 CoInitializeSecurity，但似乎并没有这样做。有人做过吗？

我正在使用德尔福顺便说一句。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-12-21T18:59:54.373

二进制数据只是一个安全描述符结构（PSecurityDescriptor）。我的意思是它是这个结构的内存的副本。而且，当然，安全描述符是自相关的。JWSCL 可以轻松创建这样的结构。

每个用户访问权限的 Launch- 和 AccessPermission 列表也包含远程和本地访问。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T11:25:24.343

远程/本地激活/启动的权限存储在对象的 AppID 下的注册表中。

我不确定如何以编程方式对其进行编辑。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-15T18:56:58.827

[这与使用脚本/api 更改组件服务 > COM 安全性中的访问权限](https://stackoverflow.com/questions/1998882/change-access-permissions-in-component-services-com-security-with-script-api/2072344#2072344)非常相似？我对此发表了回应。

# c# - 通过向下转换继承树在 C# 中“更宽松”键入

> ID：81972
> 
> 赞同：5
> 
> 时间：2008-09-17T10:53:36.917
> 
> 标签：c#, inheritance, data-structures, bittorrent

我想问的问题是：

从抽象类内部向下转换继承树（即朝向更专业的类）是可以原谅的，甚至是一件好事，还是它总是一个糟糕的选择，有更好的选择？

现在，为什么我认为它可以用于良好的例子。

我最近在 C# 中[从 BitTorrent 协议实现了 Bencoding 。](http://www.bittorrent.org/beps/bep_0003.html#the-connectivity-is-as-follows)一个足够简单的问题，如何表示数据。我选择这样做，

我们有一个`abstract BItem`类，它提供了一些基本功能，包括`static BItem Decode(string)`用于将 Bencoded 字符串解码为必要结构的类。

还有四个派生类，、`BString`和，表示要编码的四种不同数据类型。现在，这是棘手的部分。和have和accessors 分别允许访问这些数据类型的类似数组的质量。`BInteger``BList``BDictionary``BList``BDictionary``this[int]``this[string]`

潜在的可怕部分现在来了：

```
BDictionary torrent = (BDictionary) BItem.DecodeFile("my.torrent");
int filelength = (BInteger)((BDictionary)((BList)((BDictionary)
             torrent["info"])["files"])[0])["length"]; 
```

好吧，你明白了……哎呀，这对眼睛来说很难，更不用说大脑了。所以，我在抽象类中引入了一些额外的东西：

```
public BItem this[int index]
{
    get { return ((BList)this)[index]; }
}
public BItem this[string index]
{
    get { return ((BDictionary)this)[index]; }
} 
```

现在我们可以将旧代码重写为：

```
BDictionary torrent = (BDictionary)BItem.DecodeFile("my.torrent");
int filelength = (BInteger)torrent["info"]["files"][0]["length"]; 
```

哇，嘿presto，更具可读性的代码。但是我是否只是为了将子类的知识暗示到抽象类中而出卖了我的一部分灵魂？

编辑：作为对一些答案的回应，你完全偏离了这个特定问题的轨道，因为结构是可变的，例如我的例子`torrent["info"]["files"][0]["length"]`是有效的，但也是如此`torrent["announce-list"][0][0]`，两者都将在 90% 的 torrent 文件中在那里。泛型不是要走的路，至少有这个问题:(。点击我链接的规范，它只有 4 个小点。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-17T11:02:16.053

我想我会将 this[int] 和 this[string] 访问器设为虚拟并在 BList/BDictionary 中覆盖它们。访问器没有意义的类应该强制转换 NotSupportedException() （可能通过在 BItem 中具有默认实现）。

这使您的代码以相同的方式工作，并为您提供更具可读性的错误，以防您应该编写

```
 (BInteger)torrent["info"][0]["files"]["length"]; 
```

因为失误。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-17T10:57:54.610

你真的不应该从基类访问任何派生类，因为它几乎打破了 OOP 的想法。可读性当然有很长的路要走，但我不会用它来换取可重用性。考虑需要添加另一个子类的情况 - 您还需要相应地更新基类。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T11:02:02.620

如果文件长度是您经常检索的东西，为什么不在 BDictionary (?) 类中实现一个属性......这样您的代码就变成了：

```
BDictionary torrent = BItem.DecodeFile("my.torrent");
int filelength = torrent.FileLength; 
```

这样，实现细节就对用户隐藏了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T11:07:33.527

在我看来，并非所有 BItem 都是集合，因此并非所有 BItem 都有索引器，因此索引器不应该在 BItem 中。我将从 BItem 派生另一个抽象类，我们将其命名为 BCollection，并将索引器放在那里，例如：

```
abstract class BCollection : BItem {

      public BItem this[int index] {get;}
      public BItem this[string index] {get;}
} 
```

并使 BList 和 BDictionary 继承自 BCollection。或者你可以加倍努力，让 BCollection 成为一个泛型类。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-17T18:56:48.407

我的建议是引入更多抽象。我发现 BItem 有一个返回 BDictionary 的 DecodeFile() 令人困惑。我不知道，这可能是在 torrent 域中做的合理的事情。

但是，我会发现类似以下的 api 更合理：

```
BFile torrent = BFile.DecodeFile("my.torrent");
int filelength = torrent.Length; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T11:04:05.097

您是否考虑过解析一个简单的“路径”，以便您可以这样编写：

`BDictionary torrent = BItem.DecodeFile("my.torrent");
int filelength = (int)torrent.Fetch("info.files.0.length");`

也许不是最好的方法，但可读性增加（一点）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T11:06:43.607

*   如果您可以完全控制自己的代码库和思维过程，那么一定要这样做。
*   如果没有，那么当某个新人将您没有看到的 BItem 派生注入*您的*BList 或 BDictionary 的那一天，您会后悔的。

如果你必须这样做，至少将它（控制对列表的访问）包装在一个具有强类型方法签名的类中。

```
BString GetString(BInteger);
SetString(BInteger, BString); 
```

接受并返回 BStrings，即使您在内部将它存储在 BItems 的 BList 中。*（让我在做我的 2 B 或不做 2 B 之前分开）*

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-17T11:07:06.290

唔。我实际上认为第一行编码比第二行更具可读性 - 弄清楚它发生了什么需要更长的时间，但更明显的是你将对象视为 BList 或 BDictionary。将方法应用于抽象类会隐藏该细节，这会使您更难弄清楚您的方法实际上在做什么。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-17T11:31:21.927

如果引入泛型，则可以避免强制转换。

```
class DecodedTorrent : BDictionary<BDictionary<BList<BDictionary<BInteger>>>>
{
} 
```

* * *

```
DecodedTorrent torrent = BItem.DecodeFile("mytorrent");
int x = torrent["info"]["files"][0]["length"]; 
```

嗯，但这可能行不通，因为类型可能取决于您通过结构所采用的路径。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-17T12:10:33.203

只有我吗

```
BDictionary torrent = BItem.DecodeFile("my.torrent");int filelength = (BInteger)((BDictionary)((BList)((BDictionary)             torrent["info"])["files"])[0])["length"]; 
```

您不需要将 BDictionary 强制转换“torrent”声明为 BDictionary

```
public BItem this[int index]{&nbsp; &nbsp; get { return ((BList)this)[index]; }}public BItem this[string index]{&nbsp; &nbsp; get { return ((BDictionary)this)[index]; }} 
```

这些不能达到预期的结果，因为返回类型仍然是抽象版本，所以你仍然需要强制转换。

重写的代码必须是

```
BDictionary torrent = BItem.DecodeFile("my.torrent");int filelength = (BInteger)((BList)((BDictionary)torrent["info"]["files"])[0])["length"]; 
```

哪个和第一批一样糟糕

# ruby - 在 64 位多平台上使用 ruby (on rails) 的问题

> ID：81973
> 
> 赞同：0
> 
> 时间：2008-09-17T10:53:55.417
> 
> 标签：ruby, 64-bit, cross-platform

有没有人在严重依赖数据库的商业生产环境中在各种平台（HP=UX、Solaris、AIX 等）的 64 位环境中使用 ruby​​。

在这些时间里，您是否遇到过任何问题/错误？

我知道总体上看起来还不错。编译、部署等。我想知道您是否遇到任何“陷阱”

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-26T12:03:16.987

我不得不在我的 64 位 MacBookPro 上使用 32 位 MySQL，rails b/c mysql.gem 无法处理 64 位 MySQL。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T12:09:42.527

很抱歉，除了 Linux，我没有在其他任何平台上使用 Ruby 的经验。正如 epochwolf 所写，我对 Debian、Postgres、Rails 也没有任何问题（Apache 和乘客也没有 Mongrel 集群。所以我使用的可能是最广泛使用的 Ruby 平台，所以我希望会有更少问题。我已经完成了 AIX 管理的工作，但到那时 ruby​​ 甚至还不为人所知。所以我不知道 Ruby 是否是其他 Unices 的稳定器。但是似乎可以通过两种方式解决这个问题 1) 只是如果您遇到问题，请在 Linux（或某些 BSD（无论是免费、开放或网络）2）以外的其他系统上尝试使用 Linux 下的服务器和/或某些已知可以工作的 BSD。

问候弗里德里希

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T20:46:27.280

我们在 64 位 freebsd（mysql 数据库服务器）上使用它。Ruby 本身很好。

前一阵子 phusion 乘客有一个问题，但它已经被修复了，我们在 C 扩展（特别是 RMagick）方面遇到了一些问题，但我们已经能够克服所有这些问题。
RMagick 没有崩溃，但有一个错误，即在使用剪切路径合成 TIFF 文件时它不会产生有效的输出。

如果您不依赖任何晦涩的 C 扩展，我会说您会没事的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-18T01:55:00.180

我对 64 位平台上的 Debian 没有任何问题。我在 64 位 Linux 环境中遇到的唯一问题与 Firefox 的 flash 插件有关。

编辑：我在服务器和笔记本电脑上使用了 Debian。Firefox 问题仅在笔记本电脑上。（原因很明显）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-26T02:46:57.127

我在 Solaris 10 上同时运行 32 位和 64 位 ruby​​。为 64 位 AMD64 编译扩展可能有点棘手。有一个[Sybase 驱动程序，它可以工作，但有几个错误](http://www.theeggeadventure.com/wikimedia/index.php/Ruby_Sybase_Solaris)。Oracle 驱动程序稍微好一点。这不是最常见的设置，因此寻求帮助可能有点困难。

我正在运行 Ruby 1.8.6-p287。更高版本引起了问题。我通常用 gcc 编译 32 位 ruby​​，用 Sun C 5.8 编译 64 位。

# asp.net - 从客户端检测到潜在危险的 Request.Form 值

> ID：81991
> 
> 赞同：1545
> 
> 时间：2008-09-17T10:58:14.253
> 
> 标签：asp.net, asp.net-mvc, validation, html-encode, request.form

每次用户在我的 Web 应用程序中发布包含`<`或`>`在页面中的内容时，我都会抛出此异常。

我不想讨论由于有人在文本框中输入了一个字符而引发异常或使整个 Web 应用程序崩溃的聪明之处，但我正在寻找一种优雅的方式来处理这个问题。

捕获异常并显示

> 发生错误，请返回并重新输入整个表单，但这次请不要使用 <

对我来说似乎不够专业。

禁用后验证 ( `validateRequest="false"`) 肯定会避免此错误，但它会使页面容易受到许多攻击。

理想情况下：当回发包含 HTML 受限字符时，表单集合中的发布值将自动进行 HTML 编码。所以`.Text`我的文本框的属性将是`something & lt; html & gt;`

有没有办法从处理程序中做到这一点？

* * *

## 回答 #1

> 赞同：1124
> 
> 时间：2008-09-17T11:26:23.030

我认为您通过尝试对所有发布的数据进行编码来从错误的角度对其进行攻击。

请注意，“ `<`”也可能来自其他外部来源，如数据库字段、配置、文件、提要等。

此外，“ `<`”本身并不危险。它仅在特定上下文中是危险的：当编写尚未编码为 HTML 输出的字符串时（因为 XSS）。

在其他情况下，不同的子字符串是危险的，例如，如果您将用户提供的 URL 写入链接，则子字符串“ `javascript:`”可能是危险的。另一方面，单引号字符在 SQL 查询中插入字符串时很危险，但如果它是从表单提交或从数据库字段读取的名称的一部分，则非常安全。

底线是：您不能过滤随机输入的危险字符，因为任何字符在适当的情况下都可能是危险的。您应该在某些特定字符可能变得危险的地方进行编码，因为它们会进入具有特殊含义的不同子语言。将字符串写入 HTML 时，应使用 Server.HtmlEncode 对 HTML 中具有特殊含义的字符进行编码。如果您将字符串传递给动态 SQL 语句，您应该对不同的字符进行编码（或者更好的是，让框架通过使用准备好的语句等来为您完成）..

*当*您确定您在将字符串传递给 HTML 的任何地方都进行了 HTML 编码时，然后在文件`ValidateRequest="false"`中的`<%@ Page ... %>`指令中进行设置`.aspx`。

在 .NET 4 中，您可能需要做更多的事情。有时还需要添加`<httpRuntime requestValidationMode="2.0" />`到 web.config（[参考](http://www.asp.net/%28S%28ywiyuluxr3qb2dfva1z5lgeg%29%29/learn/whitepapers/aspnet4/breaking-changes/)）。

* * *

## 回答 #2

> 赞同：524
> 
> 时间：2009-10-08T22:56:30.173

如果您使用的是 ASP.NET MVC，则此错误有不同的解决方案：

*   [ASP.NET MVC – 页面 validateRequest=false 不起作用？](http://jwwishart.wordpress.com/2009/06/22/asp-net-mvc-pages-validaterequestfalse-doesnt-work/)
*   [为什么 ValidateInput(False) 不起作用？](https://stackoverflow.com/questions/807662/why-is-validateinputfalse-not-working)
*   [ASP.NET MVC RC1，验证输入，一个潜在的危险请求和陷阱](https://web.archive.org/web/20160327063049/http://weblogs.asp.net:80/rashid/asp-net-mvc-rc1-validateinput-a-potential-dangerous-request-and-the-pitfall)

C# 示例：

```
[HttpPost, ValidateInput(false)]
public ActionResult Edit(FormCollection collection)
{
    // ...
} 
```

Visual Basic 示例：

```
<AcceptVerbs(HttpVerbs.Post), ValidateInput(False)> _
Function Edit(ByVal collection As FormCollection) As ActionResult
    ...
End Function 
```

* * *

## 回答 #3

> 赞同：433
> 
> 时间：2011-09-05T09:33:36.187

在 ASP.NET MVC（从版本 3 开始）中，您可以将[`AllowHtml`](http://msdn.microsoft.com/en-us/library/system.web.mvc.allowhtmlattribute.aspx)属性添加到模型的属性中。

它允许请求在模型绑定期间通过跳过对属性的请求验证来包含 HTML 标记。

```
[AllowHtml]
public string Description { get; set; } 
```

* * *

## 回答 #4

> 赞同：218
> 
> 时间：2010-07-30T04:51:29.697

如果您使用的是 .NET 4.0，请确保将其添加到标签内的*web.config*文件中：`<system.web>`

```
<httpRuntime requestValidationMode="2.0" /> 
```

* * *

在 .NET 2.0 中，请求验证仅适用于`aspx`请求。在 .NET 4.0 中，这被扩展为包括**所有**请求。您可以在处理时恢复为*仅*执行 XSS 验证，方法`.aspx`是指定：

```
requestValidationMode="2.0" 
```

您可以通过指定*完全*禁用请求验证：

```
validateRequest="false" 
```

* * *

## 回答 #5

> 赞同：118
> 
> 时间：2012-11-27T17:22:15.530

`<location>`对于 ASP.NET 4.0，您可以通过将标记全部放在一个元素中来允许将标记作为特定页面而不是整个站点的输入。这将确保您的所有其他页面都是安全的。您不需要放入`ValidateRequest="false"`您的 .aspx 页面。

```
<configuration>
...
  <location path="MyFolder/.aspx">
    <system.web>
      <pages validateRequest="false" />
      <httpRuntime requestValidationMode="2.0" />
    </system.web>
  </location>
...
</configuration> 
```

在 web.config 中控制它更安全，因为您可以在站点级别查看哪些页面允许将标记作为输入。

**您仍然需要以编程方式验证禁用请求验证的页面上的输入。**

* * *

## 回答 #6

> 赞同：73
> 
> 时间：2010-11-06T14:58:46.003

以前的答案很好，但没有人说如何排除单个字段进行 HTML/JavaScript 注入验证。我不知道以前的版本，但在 MVC3 Beta 中你可以这样做：

```
[HttpPost, ValidateInput(true, Exclude = "YourFieldName")]
public virtual ActionResult Edit(int id, FormCollection collection)
{
    ...
} 
```

这仍然会验证除排除字段之外的所有字段。这样做的好处是您的验证属性仍然验证该字段，但您只是没有收到“从客户端检测到潜在危险的 Request.Form 值”异常。

我用它来验证正则表达式。我制作了自己的 ValidationAttribute 来查看正则表达式是否有效。由于正则表达式可以包含看起来像脚本的东西，我应用了上面的代码 - 正则表达式仍在检查它是否有效，但如果它包含脚本或 HTML，则不会。

* * *

## 回答 #7

> 赞同：53
> 
> 时间：2010-11-30T12:56:45.707

在 ASP.NET MVC 中，您需要在 web.config 中设置 requestValidationMode="2.0" 和 validateRequest="false"，并将 ValidateInput 属性应用于控制器操作：

```
<httpRuntime requestValidationMode="2.0"/>

<configuration>
    <system.web>
        <pages validateRequest="false" />
    </system.web>
</configuration> 
```

和

```
[Post, ValidateInput(false)]
public ActionResult Edit(string message) {
    ...
} 
```

* * *

## 回答 #8

> 赞同：50
> 
> 时间：2008-09-17T11:20:03.653

您可以对文本框内容[进行 HTML 编码](https://docs.microsoft.com/en-us/dotnet/api/system.web.httpserverutility.htmlencode)，但不幸的是，这并不能阻止异常的发生。根据我的经验，没有办法，您必须禁用页面验证。这样做是在说：“我会小心的，我保证。”

* * *

## 回答 #9

> 赞同：47
> 
> 时间：2013-04-25T20:56:17.357

这个问题的答案很简单：

```
var varname = Request.Unvalidated["parameter_name"]; 
```

这将禁用对特定请求的验证。

* * *

## 回答 #10

> 赞同：43
> 
> 时间：2009-10-13T22:37:18.767

您可以在 Global.asax 中发现该错误。我仍然想验证，但显示适当的消息。在下面列出的博客中，提供了这样的示例。

```
 void Application_Error(object sender, EventArgs e)
    {
        Exception ex = Server.GetLastError();

        if (ex is HttpRequestValidationException)
        {
            Response.Clear();
            Response.StatusCode = 200;
            Response.Write(@"[html]");
            Response.End();
        }
    } 
```

重定向到另一个页面似乎也是对异常的合理响应。

[http://www.romsteady.net/blog/2007/06/how-to-catch-httprequestvalidationexcep.html](http://www.romsteady.net/blog/2007/06/how-to-catch-httprequestvalidationexcep.html)

* * *

## 回答 #11

> 赞同：43
> 
> 时间：2014-01-29T09:40:05.307

对于 MVC，通过添加忽略输入验证

> [验证输入（假）]

在Controller中的每个Action之上。

* * *

## 回答 #12

> 赞同：35
> 
> 时间：2008-09-17T14:40:25.717

请记住，一些 .NET 控件会自动对输出进行 HTML 编码。例如，在 TextBox 控件上设置 .Text 属性将自动对其进行编码。这具体意味着转换`<`为`&lt;`，`>`into`&gt;`和`&`into `&amp;`。所以要小心这样做...

```
myTextBox.Text = Server.HtmlEncode(myStringFromDatabase); // Pseudo code 
```

但是，HyperLink、Literal 和 Label 的 .Text 属性不会对内容进行 HTML 编码，因此需要包装 Server.HtmlEncode(); 如果您想防止`<script> window.location = "http://www.google.com"; </script>`输出到您的页面并随后执行，则必须围绕在这些属性上设置的任何内容。

做一些实验，看看什么被编码，什么没有。

* * *

## 回答 #13

> 赞同：29
> 
> 时间：2012-03-14T22:20:43.247

在 web.config 文件的标记中，插入属性为 requestValidationMode="2.0" 的 httpRuntime 元素。还要在 pages 元素中添加 validateRequest="false" 属性。

例子：

```
<configuration>
  <system.web>
   <httpRuntime requestValidationMode="2.0" />
  </system.web>
  <pages validateRequest="false">
  </pages>
</configuration> 
```

* * *

## 回答 #14

> 赞同：24
> 
> 时间：2009-01-12T17:35:03.980

如果您不想禁用 ValidateRequest，则需要实现 JavaScript 函数以避免异常。这不是最好的选择，但它确实有效。

```
function AlphanumericValidation(evt)
{
    var charCode = (evt.charCode) ? evt.charCode : ((evt.keyCode) ? evt.keyCode :
        ((evt.which) ? evt.which : 0));

    // User type Enter key
    if (charCode == 13)
    {
        // Do something, set controls focus or do anything
        return false;
    }

    // User can not type non alphanumeric characters
    if ( (charCode <  48)                     ||
         (charCode > 122)                     ||
         ((charCode > 57) && (charCode < 65)) ||
         ((charCode > 90) && (charCode < 97))
       )
    {
        // Show a message or do something
        return false;
    }
} 
```

然后在后面的代码中，在 PageLoad 事件上，使用以下代码将属性添加到您的控件：

```
Me.TextBox1.Attributes.Add("OnKeyPress", "return AlphanumericValidation(event);") 
```

* * *

## 回答 #15

> 赞同：21
> 
> 时间：2012-01-27T15:01:37.053

似乎还没有人提到以下内容，但它为我解决了这个问题。在有人说是之前，它是 Visual Basic ......糟糕。

```
<%@ Page Language="vb" AutoEventWireup="false" CodeBehind="Example.aspx.vb" Inherits="Example.Example" **ValidateRequest="false"** %> 
```

我不知道是否有任何缺点，但对我来说，这太棒了。

* * *

## 回答 #16

> 赞同：21
> 
> 时间：2013-12-08T05:39:56.990

另一种解决方案是：

```
protected void Application_Start()
{
    ...
    RequestValidator.Current = new MyRequestValidator();
}

public class MyRequestValidator: RequestValidator
{
    protected override bool IsValidRequestString(HttpContext context, string value, RequestValidationSource requestValidationSource, string collectionKey, out int validationFailureIndex)
    {
        bool result = base.IsValidRequestString(context, value, requestValidationSource, collectionKey, out validationFailureIndex);

        if (!result)
        {
            // Write your validation here
            if (requestValidationSource == RequestValidationSource.Form ||
                requestValidationSource == RequestValidationSource.QueryString)

                return true; // Suppress error message
        }
        return result;
    }
} 
```

* * *

## 回答 #17

> 赞同：15
> 
> 时间：2015-12-10T07:35:47.357

如果您使用的是框架 4.0，那么 web.config 中的条目 (<pages validateRequest="false" />)

```
<configuration>
    <system.web>
        <pages validateRequest="false" />
    </system.web>
</configuration> 
```

如果您使用的是框架 4.5，那么 web.config 中的条目 (requestValidationMode="2.0")

```
<system.web>
    <compilation debug="true" targetFramework="4.5" />
    <httpRuntime targetFramework="4.5" requestValidationMode="2.0"/>
</system.web> 
```

如果你只想要单页，那么在你的 aspx 文件中，你应该把第一行写成这样：

```
<%@ Page EnableEventValidation="false" %> 
```

如果您已经有类似 <%@ Page 的内容，那么只需添加其余部分 => `EnableEventValidation="false"`%>

我建议不要这样做。

* * *

## 回答 #18

> 赞同：14
> 
> 时间：2008-09-17T11:26:53.433

我想你可以在一个模块中做到这一点；但这留下了一些问题；如果要将输入保存到数据库怎么办？突然，因为您将编码数据保存到数据库中，您最终会信任来自它的输入，这可能是一个坏主意。理想情况下，您将原始未编码数据存储在数据库中，并且每次都进行编码。

在每页级别禁用保护，然后每次编码是更好的选择。

与其使用 Server.HtmlEncode，不如查看 Microsoft ACE 团队提供的更新、更完整[的 Anti-XSS 库](http://blogs.msdn.com/ace_team/archive/2006/11/20/microsoft-anti-cross-site-scripting-library-v1-5-is-done.aspx)。

* * *

## 回答 #19

> 赞同：14
> 
> 时间：2012-07-17T20:19:11.183

在 ASP.NET 中，您可以捕获异常并对其执行一些操作，例如显示友好消息或重定向到另一个页面...还有可能您可以自己处理验证...

显示友好消息：

```
protected override void OnError(EventArgs e)
{
    base.OnError(e);
    var ex = Server.GetLastError().GetBaseException();
    if (ex is System.Web.HttpRequestValidationException)
    {
        Response.Clear();
        Response.Write("Invalid characters."); //  Response.Write(HttpUtility.HtmlEncode(ex.Message));
        Response.StatusCode = 200;
        Response.End();
    }
} 
```

* * *

## 回答 #20

> 赞同：12
> 
> 时间：2014-09-16T15:31:21.020

我找到了一个使用 JavaScript 对数据进行编码的解决方案，该解决方案在 .NET 中解码（并且不需要 jQuery）。

*   使文本框成为 HTML 元素（如 textarea）而不是 ASP 元素。
*   添加隐藏字段。
*   将以下 JavaScript 函数添加到您的标头。

    函数 boo() { targetText = document.getElementById("HiddenField1"); sourceText = document.getElementById("userbox"); targetText.value = escape(sourceText.innerText); }

在您的文本区域中，包含一个调用 boo() 的 onchange：

```
<textarea id="userbox"  onchange="boo();"></textarea> 
```

最后，在 .NET 中，使用

```
string val = Server.UrlDecode(HiddenField1.Value); 
```

我知道这是单向的-如果您需要双向，则必须发挥创造力，但是如果您无法编辑 web.config，这提供了一种解决方案

这是我（MC9000）通过 jQuery 提出并使用的示例：

```
$(document).ready(function () {

    $("#txtHTML").change(function () {
        var currentText = $("#txtHTML").text();
        currentText = escape(currentText); // Escapes the HTML including quotations, etc
        $("#hidHTML").val(currentText); // Set the hidden field
    });

    // Intercept the postback
    $("#btnMyPostbackButton").click(function () {
        $("#txtHTML").val(""); // Clear the textarea before POSTing
                               // If you don't clear it, it will give you
                               // the error due to the HTML in the textarea.
        return true; // Post back
    });

}); 
```

和标记：

```
<asp:HiddenField ID="hidHTML" runat="server" />
<textarea id="txtHTML"></textarea>
<asp:Button ID="btnMyPostbackButton" runat="server" Text="Post Form" /> 
```

这很好用。如果黑客试图绕过 JavaScript 来发帖，他们只会看到错误。您也可以将所有这些编码的数据保存在数据库中，然后将其取消转义（在服务器端），并在显示其他位置之前解析和检查攻击。

* * *

## 回答 #21

> 赞同：12
> 
> 时间：2015-06-15T06:44:17.133

**原因**

[默认情况下，ASP.NET 会针对可能导致跨站点脚本](http://en.wikipedia.org/wiki/Cross-site_scripting)(XSS) 和[SQL 注入](http://en.wikipedia.org/wiki/SQL_injection)的潜在不安全内容验证所有输入控件。因此，它通过抛出上述异常来禁止此类内容。默认情况下，建议允许在每次回发时进行此检查。

**解决方案**

在许多情况下，您需要通过富文本框或富文本编辑器将 HTML 内容提交到您的页面。`@Page`在这种情况下，您可以通过将指令中的 ValidateRequest 标记设置为 false来避免此异常。

```
<%@ Page Language="C#" AutoEventWireup="true" ValidateRequest = "false" %> 
```

这将禁用对已将 ValidateRequest 标志设置为 false 的页面的请求验证。如果您想禁用此功能，请检查整个 Web 应用程序；您需要在 web.config <system.web> 部分将其设置为 false

```
<pages validateRequest ="false" /> 
```

对于 .NET 4.0 或更高版本的框架，您还需要在 <system.web> 部分添加以下行以使上述工作正常进行。

```
<httpRuntime requestValidationMode = "2.0" /> 
```

就是这样。我希望这可以帮助您摆脱上述问题。

参考：*[ASP.Net 错误：从客户端检测到潜在危险的 Request.Form 值](http://www.aspsnippets.com/Articles/ASPNet-Error-A-potentially-dangerous-RequestForm-value-was-detected-from-the-client.aspx)*

* * *

## 回答 #22

> 赞同：10
> 
> 时间：2012-03-16T14:34:52.413

这里的其他解决方案很好，但是必须将 [AllowHtml] 应用于每个 Model 属性是一件很麻烦的事，特别是如果您在一个相当大的网站上有超过 100 个模型。

如果像我一样，您想在站点范围内关闭此功能（恕我直言，毫无意义），您可以覆盖基本控制器中的 Execute() 方法（如果您还没有基本控制器，我建议您制作一个，它们可以是对于应用通用功能非常有用）。

```
 protected override void Execute(RequestContext requestContext)
    {
        // Disable requestion validation (security) across the whole site
        ValidateRequest = false;
        base.Execute(requestContext);
    } 
```

只需确保您对来自用户输入的视图中的所有内容进行 HTML 编码（无论如何，这是带有 Razor 的 ASP.NET MVC 3 中的默认行为，所以除非出于某种奇怪的原因，您正在使用 Html.Raw()不应该需要这个功能。

* * *

## 回答 #23

> 赞同：9
> 
> 时间：2008-09-17T11:32:43.297

如果您确实需要特殊字符（如 , , 等），请禁用页面验证`>`。`<`然后确保在显示用户输入时，数据是 HTML 编码的。

页面验证存在安全漏洞，因此可以绕过。此外，不应仅依赖页面验证。

请参阅：[http ://web.archive.org/web/20080913071637/http://www.procheckup.com:80/PDFs/bypassing-dot-NET-ValidateRequest.pdf](http://web.archive.org/web/20080913071637/http://www.procheckup.com:80/PDFs/bypassing-dot-NET-ValidateRequest.pdf)

* * *

## 回答 #24

> 赞同：9
> 
> 时间：2012-08-14T15:27:07.107

我也收到了这个错误。

在我的例子中，用户在角色名称中输入了一个重音字符`á`（关于 ASP.NET 成员资格提供程序）。

我将角色名称传递给将用户授予该角色的方法，并且`$.ajax`发布请求失败了......

我这样做是为了解决问题：

代替

```
data: { roleName: '@Model.RoleName', users: users } 
```

做这个

```
data: { roleName: '@Html.Raw(@Model.RoleName)', users: users } 
```

`@Html.Raw`成功了。

我将角色名称作为 HTML 值`roleName="Cadastro b&#225;s"`。带有 HTML 实体的这个值`&#225;`被 ASP.NET MVC 阻止。现在我以应有`roleName`的方式获取参数值：`roleName="Cadastro Básico"`并且 ASP.NET MVC 引擎将不再阻止请求。

* * *

## 回答 #25

> 赞同：8
> 
> 时间：2012-02-11T02:33:11.943

您还可以使用 JavaScript 的[escape(string)](http://www.w3schools.com/jsref/jsref_escape.asp)函数来替换特殊字符。然后服务器端使用Server。[URLDecode(string)](http://msdn.microsoft.com/en-us/library/hwzhtkke.aspx)将其切换回来。

这样您就不必关闭输入验证，并且其他程序员会更清楚字符串可能包含 HTML 内容。

* * *

## 回答 #26

> 赞同：7
> 
> 时间：2012-08-03T15:22:12.793

我最终在每次回发之前使用 JavaScript 来检查您不想要的字符，例如：

```
<asp:Button runat="server" ID="saveButton" Text="Save" CssClass="saveButton" OnClientClick="return checkFields()" />

function checkFields() {
    var tbs = new Array();
    tbs = document.getElementsByTagName("input");
    var isValid = true;
    for (i=0; i<tbs.length; i++) {
        if (tbs(i).type == 'text') {
            if (tbs(i).value.indexOf('<') != -1 || tbs(i).value.indexOf('>') != -1) {
                alert('<> symbols not allowed.');
                isValid = false;
            }
        }
    }
    return isValid;
} 
```

当然，我的页面主要是数据输入，并且很少有元素进行回发，但至少保留了它们的数据。

* * *

## 回答 #27

> 赞同：6
> 
> 时间：2013-05-31T22:55:36.583

你可以使用类似的东西：

```
var nvc = Request.Unvalidated().Form; 
```

后来，`nvc["yourKey"]`应该工作。

* * *

## 回答 #28

> 赞同：5
> 
> 时间：2018-07-24T05:17:31.443

对于那些不使用模型绑定，从 Request.Form 中提取每个参数，确定输入文本不会造成伤害的人，还有另一种方法。不是一个很好的解决方案，但它会完成这项工作。

从客户端，将其编码为 uri 然后发送。
例如：

```
encodeURIComponent($("#MsgBody").val()); 
```

从服务器端，接受它并将其解码为 uri。
例如：

```
string temp = !string.IsNullOrEmpty(HttpContext.Current.Request.Form["MsgBody"]) ?
System.Web.HttpUtility.UrlDecode(HttpContext.Current.Request.Form["MsgBody"]) : 
null; 
```

或者

```
string temp = !string.IsNullOrEmpty(HttpContext.Current.Request.Form["MsgBody"]) ?
System.Uri.UnescapeDataString(HttpContext.Current.Request.Form["MsgBody"]) : 
null; 
```

`UrlDecode`请寻找和之间的区别`UnescapeDataString`

* * *

## 回答 #29

> 赞同：4
> 
> 时间：2008-09-17T11:28:22.807

只要这些**只是**“<”和“>”（而不是双引号本身）字符并且您在 <input value=" *this* " /> 之类的上下文中使用它们，您就是安全的（而对于 <textarea >*这个*</textarea> 你当然会很脆弱）。这可能会简化您的情况，但要**使用**其他已发布的解决方案之一。

* * *

## 回答 #30

> 赞同：4
> 
> 时间：2008-09-17T11:41:07.597

如果您只是想告诉您的用户不要使用 < 和 >，那么您不希望事先处理/回发整个表单（并丢失所有输入），您可以不简单地放入字段周围的验证器来筛选那些（可能还有其他潜在危险的）字符？

* * *

## 回答 #31

> 赞同：4
> 
> 时间：2013-02-17T19:40:01.127

没有任何建议对我有用。无论如何，我不想为整个网站关闭此功能，因为 99% 的时间我不希望我的用户将 HTML 放在 Web 表单上。我刚刚创建了自己的解决方法，因为我是唯一使用此特定应用程序的人。我在后面的代码中将输入转换为 HTML 并将其插入到我的数据库中。

* * *

## 回答 #32

> 赞同：4
> 
> 时间：2014-05-01T20:04:07.207

正如我对[Sel 的回答](https://stackoverflow.com/questions/81991/a-potentially-dangerous-request-form-value-was-detected-from-the-client/20450300#20450300)所指出的，这是我们对自定义请求验证器的扩展。

```
public class SkippableRequestValidator : RequestValidator
{
    protected override bool IsValidRequestString(HttpContext context, string value, RequestValidationSource requestValidationSource, string collectionKey, out int validationFailureIndex)
    {
        if (collectionKey != null && collectionKey.EndsWith("_NoValidation"))
        {
            validationFailureIndex = 0;
            return true;
        }

        return base.IsValidRequestString(context, value, requestValidationSource, collectionKey, out validationFailureIndex);
    }
} 
```

* * *

## 回答 #33

> 赞同：4
> 
> 时间：2016-02-25T08:17:06.400

您可以在自定义模型绑定器中自动对字段进行 HTML 编码。我的解决方案有些不同，我在 ModelState 中输入错误并在字段附近显示错误消息。修改此代码以自动编码很容易

```
 public class AppModelBinder : DefaultModelBinder
    {
        protected override object CreateModel(ControllerContext controllerContext, ModelBindingContext bindingContext, Type modelType)
        {
            try
            {
                return base.CreateModel(controllerContext, bindingContext, modelType);
            }
            catch (HttpRequestValidationException e)
            {
                HandleHttpRequestValidationException(bindingContext, e);
                return null; // Encode here
            }
        }
        protected override object GetPropertyValue(ControllerContext controllerContext, ModelBindingContext bindingContext,
            PropertyDescriptor propertyDescriptor, IModelBinder propertyBinder)
        {
            try
            {
                return base.GetPropertyValue(controllerContext, bindingContext, propertyDescriptor, propertyBinder);
            }
            catch (HttpRequestValidationException e)
            {
                HandleHttpRequestValidationException(bindingContext, e);
                return null; // Encode here
            }
        }

        protected void HandleHttpRequestValidationException(ModelBindingContext bindingContext, HttpRequestValidationException ex)
        {
            var valueProviderCollection = bindingContext.ValueProvider as ValueProviderCollection;
            if (valueProviderCollection != null)
            {
                ValueProviderResult valueProviderResult = valueProviderCollection.GetValue(bindingContext.ModelName, skipValidation: true);
                bindingContext.ModelState.SetModelValue(bindingContext.ModelName, valueProviderResult);
            }

            string errorMessage = string.Format(CultureInfo.CurrentCulture, "{0} contains invalid symbols: <, &",
                     bindingContext.ModelMetadata.DisplayName);

            bindingContext.ModelState.AddModelError(bindingContext.ModelName, errorMessage);
        }
    } 
```

在 Application_Start 中：

```
ModelBinders.Binders.DefaultBinder = new AppModelBinder(); 
```

请注意，它仅适用于表单字段。危险值未传递给控制器​​模型，但存储在 ModelState 中，并且可以在表单上重新显示并显示错误消息。

URL 中的危险字符可以这样处理：

```
private void Application_Error(object sender, EventArgs e)
{
    Exception exception = Server.GetLastError();
    HttpContext httpContext = HttpContext.Current;

    HttpException httpException = exception as HttpException;
    if (httpException != null)
    {
        RouteData routeData = new RouteData();
        routeData.Values.Add("controller", "Error");
        var httpCode = httpException.GetHttpCode();
        switch (httpCode)
        {
            case (int)HttpStatusCode.BadRequest /* 400 */:
                if (httpException.Message.Contains("Request.Path"))
                {
                    httpContext.Response.Clear();
                    RequestContext requestContext = new RequestContext(new HttpContextWrapper(Context), routeData);
                    requestContext.RouteData.Values["action"] ="InvalidUrl";
                    requestContext.RouteData.Values["controller"] ="Error";
                    IControllerFactory factory = ControllerBuilder.Current.GetControllerFactory();
                    IController controller = factory.CreateController(requestContext, "Error");
                    controller.Execute(requestContext);
                    httpContext.Server.ClearError();
                    Response.StatusCode = (int)HttpStatusCode.BadRequest /* 400 */;
                }
                break;
        }
    }
} 
```

错误控制器：

```
public class ErrorController : Controller
 {
   public ActionResult InvalidUrl()
   {
      return View();
   }
} 
```

* * *

## 回答 #34

> 赞同：4
> 
> 时间：2018-12-03T08:54:35.213

在我的情况下，使用 asp:Textbox 控件（Asp.net 4.5），而不是设置`validateRequest="false"` 我使用的所有页面

```
<asp:TextBox runat="server" ID="mainTextBox"
            ValidateRequestMode="Disabled"
 ></asp:TextBox> 
```

在导致异常的文本框上。

* * *

## 回答 #35

> 赞同：3
> 
> 时间：2008-09-17T11:21:33.230

您应该使用 Server.HtmlEncode 方法来保护您的站点免受危险输入。

[更多信息在这里](http://www.asp.net/learn/whitepapers/request-validation/)

* * *

## 回答 #36

> 赞同：3
> 
> 时间：2018-04-03T21:44:58.837

**一个办法**

我不喜欢关闭帖子验证 (validateRequest="false")。另一方面，应用程序崩溃只是因为无辜的用户碰巧键入`<x`或其他东西是不可接受的。

因此，我编写了一个客户端 javascript 函数 (xssCheckValidates) 进行初步检查。当尝试发布表单数据时调用此函数，如下所示：

```
<form id="form1" runat="server" onsubmit="return xssCheckValidates();"> 
```

该功能非常简单，可以改进，但它正在发挥作用。

请注意，这样做的目的不是为了保护系统免受黑客攻击，而是为了保护用户免受不良体验。在服务器上完成的请求验证仍然处于打开状态，这是系统保护的（部分）（在它能够做到的范围内）。

我在这里说“部分”的原因是因为我听说内置的请求验证可能还不够，因此可能需要其他补充手段来获得全面保护。但是，我在这里介绍的 javascript 函数与保护系统*无关。*这*只是*为了确保用户不会有糟糕的体验。

你可以在这里试试：

```
 function xssCheckValidates() {
      var valid = true;
      var inp = document.querySelectorAll(
          "input:not(:disabled):not([readonly]):not([type=hidden])" +
          ",textarea:not(:disabled):not([readonly])");
      for (var i = 0; i < inp.length; i++) {
        if (!inp[i].readOnly) {
          if (inp[i].value.indexOf('<') > -1) {
            valid = false;
            break;
          }
          if (inp[i].value.indexOf('&#') > -1) {
            valid = false;
            break;
          }
        }
      }
      if (valid) {
        return true;
      } else {
        alert('In one or more of the text fields, you have typed\r\nthe character "<" or the character sequence "&#".\r\n\r\nThis is unfortunately not allowed since\r\nit can be used in hacking attempts.\r\n\r\nPlease edit the field and try again.');
        return false;
      }
    }
```

```
<form onsubmit="return xssCheckValidates();" >
  Try to type < or &# <br/>
  <input type="text" /><br/>
  <textarea></textarea>
  <input type="submit" value="Send" />
</form>
```

* * *

## 回答 #37

> 赞同：2
> 
> 时间：2018-03-30T14:06:40.393

我看到有很多关于这个的文章......我没有看到提到这个。这从 .NET Framework 4.5 开始可用

控件的[ValidateRequestMode](https://msdn.microsoft.com/en-us/library/system.web.ui.control.validaterequestmode.aspx)设置是一个很好的选择。这样页面上的其他控件仍然受到保护。无需更改 web.config。

```
 protected void Page_Load(object sender, EventArgs e)
 {
     txtMachKey.ValidateRequestMode = ValidateRequestMode.Disabled;
 } 
```

* * *

## 回答 #38

> 赞同：2
> 
> 时间：2018-05-04T11:43:37.570

我知道这个问题是关于表单发布的，但我想为在其他情况下收到此错误的人添加一些详细信息。它也可能发生在用于实现 Web 服务的处理程序上。

假设您的 Web 客户端使用 ajax 发送 POST 或 PUT 请求，并将 json 或 xml 文本或原始数据（文件内容）发送到您的 Web 服务。因为您的 Web 服务不需要从 Content-Type 标头中获取任何信息，所以您的 JavaScript 代码没有将此标头设置为您的 ajax 请求。但是，如果您没有在 POST/PUT ajax 请求中设置此标头，Safari 可能会添加此标头：“Content-Type: application/x-www-form-urlencoded”。我在 iPhone 上的 Safari 6 上观察到，但其他 Safari 版本/操作系统或 Chrome 可能会这样做。因此，当接收到这个 Content-Type 标头时，.NET Framework 的某些部分假定请求正文数据结构对应于一个 html 表单发布，而它不对应，并引发 HttpRequestValidationException 异常。

我还发现了这个细节：
在这些情况下，当您的代码尝试访问 HttpRequest.Params 集合时，会出现 HttpRequestValidationException 异常。但令人惊讶的是，当它访问 HttpRequest.ServerVariables 集合时，并没有出现这个异常。这表明虽然这两个集合看起来几乎相同，但一个通过安全检查访问请求数据，而另一个则没有。

* * *

## 回答 #39

> 赞同：1
> 
> 时间：2016-04-19T14:27:05.170

使用`Server.HtmlEncode("yourtext");`

* * *

## 回答 #40

> 赞同：1
> 
> 时间：2017-01-16T14:48:57.993

对于我们这些仍然停留在网络表单上的人，我发现了以下解决方案，使您只能禁用一个字段的验证！（我不想为整个页面禁用它。）

VB.NET：

```
Public Class UnvalidatedTextBox
    Inherits TextBox
    Protected Overrides Function LoadPostData(postDataKey As String, postCollection As NameValueCollection) As Boolean
        Return MyBase.LoadPostData(postDataKey, System.Web.HttpContext.Current.Request.Unvalidated.Form)
    End Function
End Class 
```

C＃：

```
public class UnvalidatedTextBox : TextBox
{
    protected override bool LoadPostData(string postDataKey, NameValueCollection postCollection)
    {
        return base.LoadPostData(postDataKey, System.Web.HttpContext.Current.Request.Unvalidated.Form);
    }
} 
```

现在只需使用`<prefix:UnvalidatedTextBox id="test" runat="server" />`而不是`<asp:TextBox`，它应该允许所有字符（这对于密码字段来说是完美的！）

* * *

## 回答 #41

> 赞同：1
> 
> 时间：2018-01-27T20:10:44.100

最后但同样重要的是，请注意 ASP.NET 数据绑定控件在数据绑定期间自动对值进行**编码。**这会更改`ItemTemplate`. 以下示例演示（`ValidateRequest`设置为 false）：

**aspx**

```
<%@ Page Language="C#" ValidateRequest="false" AutoEventWireup="true" CodeBehind="Default.aspx.cs" Inherits="WebApplication17._Default" %> <html> <body>
    <form runat="server">
        <asp:FormView ID="FormView1" runat="server" ItemType="WebApplication17.S" SelectMethod="FormView1_GetItem">
            <ItemTemplate>
                <asp:TextBox ID="TextBox1" runat="server"></asp:TextBox>
                <asp:Button ID="Button1" runat="server" Text="Button" OnClick="Button1_Click" />
                <asp:Label ID="Label1" runat="server" Text="<%#: Item.Text %>"></asp:Label>
                <asp:TextBox ID="TextBox2" runat="server" Text="<%#: Item.Text %>"></asp:TextBox>
            </ItemTemplate>
        </asp:FormView>
    </form> 
```

**后面的代码**

```
public partial class _Default : Page
{
    S s = new S();

    protected void Button1_Click(object sender, EventArgs e)
    {
        s.Text = ((TextBox)FormView1.FindControl("TextBox1")).Text;
        FormView1.DataBind();
    }

    public S FormView1_GetItem(int? id)
    {
        return s;
    }
}

public class S
{
    public string Text { get; set; }
} 
```

1.  案例提交值：`&#39;`

`Label1.Text`价值：`&#39;`

`TextBox2.Text`价值：`&amp;#39;`

2.  案例提交值：`<script>alert('attack!');</script>`

`Label1.Text`价值：`<script>alert('attack!');</script>`

`TextBox2.Text`价值：`&lt;script&gt;alert(&#39;attack!&#39;);&lt;/script&gt;`

* * *

## 回答 #42

> 赞同：0
> 
> 时间：2018-03-15T19:16:55.987

在 .Net 4.0 及更高版本（通常情况下）中，将以下设置放入 system.web

```
<system.web>
     <httpRuntime requestValidationMode="2.0" /> 
```

* * *

## 回答 #43

> 赞同：0
> 
> 时间：2020-05-06T16:33:48.407

**如何为 ASP.NET 4.6.2 中的 AjaxExtControls 解决此问题：**

我们在使用 AjaxExtControls 富文本编辑器时遇到了同样的问题。此问题在从 .NET 2.0 升级到 .NET 4.5 后立即开始。我查看了所有 SOF 答案，但找不到不损害 .NET 4.5 提供的安全性的解决方案。

**修复 1（不推荐，因为它会降低应用程序的安全性）**：我在更改此属性后进行了测试 `requestValidationMode = "2.0`，它有效，但我担心安全功能。所以这个修复就像降低整个应用程序的安全性。

**修复 2（推荐）：**由于此问题仅发生在 AjaxExtControl 之一中，因此我终于能够使用以下简单代码解决此问题：

```
editorID.value = editorID.value.replace(/>/g, "&gt;");
editorID.value = editorID.value.replace(/</g, "&lt;"); 
```

在将请求发送到服务器之前，此代码在客户端（javascript）上执行。请注意，editorID 不是我们在 html/aspx 页面上的 ID，而是 AjaxExtControl 内部使用的富文本编辑器的 ID。

* * *

## 回答 #44

> 赞同：0
> 
> 时间：2021-04-08T16:18:39.397

我有一个 Web 表单应用程序，它的文本框评论字段存在此问题，用户有时会在其中粘贴电子邮件文本，并且电子邮件标题信息中的“<”和“>”字符会潜入其中并引发此异常。

我从另一个角度解决了这个问题……我已经在使用 Ajax Control Toolkit，所以我能够使用 FilteredTextBoxExtender 来防止这两个字符进入文本框中。然后，用户复制粘贴文本将得到他们所期望的，减去这些字符。

```
<asp:TextBox ID="CommentsTextBox" runat="server" TextMode="MultiLine"></asp:TextBox>
<ajaxToolkit:FilteredTextBoxExtender ID="ftbe" runat="server" TargetControlID="CommentsTextBox" filterMode="InvalidChars" InvalidChars="<>" /> 
```

* * *

## 回答 #45

> 赞同：0
> 
> 时间：2021-12-13T09:41:03.483

没有一个答案对我有用。然后我发现如果我删除以下代码，我可以让它工作：

```
//Register action filter via Autofac rather than GlobalFilters to allow dependency injection
builder.RegisterFilterProvider();
builder.RegisterType<OfflineActionFilter>()
    .AsActionFilterFor<Controller>()
    .InstancePerLifetimeScope(); 
```

我只能得出结论，Autofac 的 RegisterFilterProvider 中的某些内容会破坏或覆盖 validateRequest 属性

* * *

## 回答 #46

> 赞同：0
> 
> 时间：2022-01-26T16:33:22.250

即使在添加`<httpRuntime requestValidationMode="2.0">`到 web.config 之后，我仍然在使用 WIF 进行身份验证的应用程序中不断收到错误消息。
为我解决的问题是在元素`<sessionState mode="InProc" cookieless="UseUri"/>`内部添加。`<system.web>`

* * *

## 回答 #47

> 赞同：-1
> 
> 时间：2015-03-31T10:50:19.623

尝试

> `Server.Encode`

和

> `Server.HtmlDecode` 在发送和接收时。

# web-applications - 如何通过openId获取登录凭据？

> ID：81994
> 
> 赞同：2
> 
> 时间：2008-09-17T10:58:42.597
> 
> 标签：web-applications, openid

如果用户通过 OpenId 登录，是否可以获得登录凭据，例如名称/ID？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-17T11:03:04.257

通过 OpenID 检索此类事物有两种公认的方法：SReg 和属性交换 (AX)。这两者都是标准 OpenID 规范的扩展；SReg 是两者中较老的一个，它指定了一组可以通过身份验证请求和发送的字段，而 AX 允许请求任何属性。

两个规范文档都非常简洁地说明了它们的工作方式，尽管很难判断从 AX 请求属性的标准“名称”是什么。通常，服务器倾向于实现 SReg 名称。

[OpenID 简单注册扩展规范 1.0](http://openid.net/specs/openid-simple-registration-extension-1_0.html)

[OpenID 属性交换规范 1.0 最终版](http://openid.net/specs/openid-attribute-exchange-1_0.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T11:01:04.807

你不会得到他们的实际用户名（或密码），但你会得到他们唯一的 OpenID。*************