# StackOverflow 问答 000065000-000065999

# database - 在数据库中存储电子邮件消息

> ID：65001
> 
> 赞同：17
> 
> 时间：2008-09-15T17:38:57.847
> 
> 标签：database, email, schema

您将使用哪种数据库模式将包含尽可能多的标题信息的电子邮件消息存储到数据库中？

假设它们已从 MTA 输入脚本并解析为相关的标题/正文/附件。

您会将消息正文整体存储在数据库表中，还是将任何 MIME 部分分开？附件呢？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-17T17:08:32.583

您可能需要检查“Archiveopteryx”的[架构](http://www.archiveopteryx.org/architecture)和[数据库架构](http://www.archiveopteryx.org/schema)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-15T20:18:42.597

您可能希望使用可以在邮件的多个收件人之间共享邮件正文和附件记录的模式。经常会看到电子邮件服务器中 50% 的磁盘存储空间被重复的电子邮件使用。

正文/附件的简单散列足以查看该记录是否已在数据库中。但是，您仍然需要保留单独的标题。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-15T17:41:11.447

取决于你要用它做什么。如果您需要对其中的某些部分进行频繁的搜索，则需要以对您的用例有意义的方式将其分解。如果只是为了符合 Sarbanes-Oxley 标准而存储电子邮件，您可能可以将整个内容（标题、部分等）存储为一个大文本字段。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-15T17:44:58.380

建议：创建一个定义明确的表来存储电子邮件，并为邮件的每个相关部分设置一列：发件人、标题、主题、正文。如果您想查询，例如，按主题字段，稍后会简单得多。在同一个表中，您可以定义一个字段来保存附件的路径并将附件存储在文件系统上，而不是将其存储在 blob 字段中。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-11-10T21:34:15.330

数据库模式设计的一个重要步骤是确定要建模的实体类型。对于此应用程序，实体可能是：

*   留言
*   电子邮件地址
*   对话线程（也许：如果你想做高效的线程）
*   附件（也许：如其他答案中所建议）
*   ...

一旦你知道了实体，你就可以识别实体之间的关系，这些关系可以用表来表示：

*   `In-Reply-To`消息与消息（和标头）具有多对多的关系`References`。
*   `From`消息与电子邮件地址（ 、`To`等`Cc`标题）具有多对多的关系。
*   消息与线程具有多对一的关系。
*   消息与附件具有多对多的关系。
*   ...

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-17T15:11:03.893

您可能希望至少单独存储附件以优化存储。大多数用户毫不犹豫地附加到电子邮件中的附件（视频等）的大小和数量令人惊讶。

在外发电子邮件的情况下，您可能有多封电子邮件发送相同的附件。存储所有共享它的电子邮件引用的附件的单个副本效率更高。

单独存储附件的另一个原因是它稍后会为您提供一些归档选项。如果存储空间成为问题，您可以随时返回并删除早于给定日期的大型附件，以压缩数据库。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-15T17:41:50.680

这完全取决于您想对数据做什么，但总的来说，我希望存储所有数据，并确保 MUA 解释的语义保留在数据库中，例如： - 解析的所有标头应该有自己的列 - 列应该包含整个标题 - 附件（包括正文、多部分）应该与电子邮件表位于多对一表中。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-15T17:56:12.690

如果它已经被拆分，并且您可以确定拆分数据的例程是正确的，那么我会尽可能精细地拆分表。您始终可以在中间层将其重新解析。如果空间不是问题，您总是可以存储两次。一个，拆分为相关字段，另一个字段将整个事物作为一个 blob，如果将其重新组合起来很困难。

# caching - akamai 缓存和站点渲染

> ID：65007
> 
> 赞同：0
> 
> 时间：2008-09-15T17:40:02.523
> 
> 标签：caching, rendering, akamai

我是一家大型电视台的网络人。我们的网站由 Akamai 缓存。页面在我们的测试环境（未缓存）和我们的“原始”页面（同样，未缓存）中完美呈现，但是当它们在我们的实时环境（缓存站点）上查看时，它们的呈现方式与我的方式并不完全相同对它们进行编码。也许是一点点间距，也许是 CSS 元素（尤其是背景）没有显示，最糟糕的是，忘记所有关于浮动 DIV 的事情。由于无法浮动，我必须做多少表设计，这太疯狂了。

有没有其他人有这样的缓存经验？有没有可以用来查看渲染变化的工具？

我没有人可以寻求支持，因为公司不相信问题存在。如果可以，请提供帮助。

该站点建立在我无法访问的 VB.Net 后端上。我只能访问前端。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T13:14:04.377

我一直在 Akamai 背后的网站上工作，老实说他们不会弄乱您的代码，所以这不是问题。它很可能是以下之一：

**您遇到了缓存延迟问题**- 您更新了 html 和 css，其中一个已更新，而另一个仍由 Akamai 缓存或使用时间戳来增加相关文件。这里有几种解决方案，包括确保通过 Akamai 的控制面板清除缓存以及更多编程方式的编码。标题也可以使用，但不是真正的首选方式。

**绝对 URL** - 在多个环境中进行测试时最好使用相对 URL，以确保您将所有内容都指向同一个环境。

这绝对是环境问题，而不是 Akamai 问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-15T17:44:21.797

样式表、Javascript 文件等是否都从 Akamai 正确加载？

您能否保存直接从“源”服务器检索到的页面副本和使用 Akamai 保存的副本，然后使用 diff 查找更改？

而且，最重要的是，您是否向 Akamai 询问过此事？这不是一个真正的编程问题:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T17:44:08.130

从开发中下载所有文件作为静态文件，然后从生产中下载。并使用 WinMerge 之类的工具来查看差异。

如果您使用 CTRL-F5 刷新浏览器，这个问题也会消失吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T17:46:57.593

也许 Akamaia 没有看到 HTML 代码中 <link /> 的 CSS 文件的更新版本？在 URL 中嵌入版本号可能是个好主意，这样当您发布 HTML 的更新版本时，它总是会向 Akamai 询问 CSS 的新版本（我想这也适用于图像）。

从理论上讲，Akamai 应该识别您的 Web 服务器发送的更新的缓存标头，但我从来没有从事过不需要采取一些对策来确保我们可以强制 Akamai 刷新其缓存版本的工作。

# .net - .NET WCF 错误生成不正确的 SOAP 1.1 错误代码值

> ID：65008
> 
> 赞同：9
> 
> 时间：2008-09-15T17:40:14.490
> 
> 标签：.net, wcf, web-services, soap

我正在尝试使用 FaultException 和 FaultException<T> 来确定我们应用程序中的最佳使用模式。我们需要支持 WCF 以及非 WCF 服务消费者/客户端，包括 SOAP 1.1 和 SOAP 1.2 客户端。

仅供参考：使用带有 wsHttpBinding 的 FaultExceptions 会产生 SOAP 1.2 语义，而使用带有 basicHttpBinding 的 FaultExceptions 会产生 SOAP 1.1 语义。

我正在使用以下代码抛出 FaultException<FaultDetails>：

```
 throw new FaultException<FaultDetails>(
      new FaultDetails("Throwing FaultException<FaultDetails>."),
      new FaultReason("Testing fault exceptions."),
      FaultCode.CreateSenderFaultCode(new FaultCode("MySubFaultCode"))
      ); 
```

FaultDetails 类只是一个简单的测试类，它包含一个字符串“Message”属性，如下所示。

使用 wsHttpBinding 时，响应为：

```
<?xml version="1.0" encoding="utf-16"?>
<Fault xmlns="http://www.w3.org/2003/05/soap-envelope">
<Code>
  <Value>Sender</Value>
  <Subcode>
    <Value>MySubFaultCode</Value>
  </Subcode>
</Code>
<Reason>
  <Text xml:lang="en-US">Testing fault exceptions.</Text>
</Reason>
<Detail>
  <FaultDetails xmlns="http://schemas.datacontract.org/2004/07/ClassLibrary" xmlns:i="http://www.w3.org/2001/XMLSchema-instance">
    <Message>Throwing FaultException&lt;FaultDetails&gt;.</Message>
  </FaultDetails>
</Detail> 
```

根据 SOAP 1.2 规范，这看起来是正确的。主/根“代码”是“发件人”，其“子代码”为“MySubFaultCode”。如果服务使用者/客户端使用 WCF，客户端上的 FaultException 也模仿相同的结构，faultException.Code.Name 为“Sender”，faultException.Code.SubCode.Name 为“MySubFaultCode”。

使用 basicHttpBinding 时，响应为：

```
<?xml version="1.0" encoding="utf-16"?>
<s:Fault xmlns:s="http://schemas.xmlsoap.org/soap/envelope/">
  <faultcode>s:MySubFaultCode</faultcode>
  <faultstring xml:lang="en-US">Testing fault exceptions.</faultstring>
  <detail>
    <FaultDetails xmlns="http://schemas.datacontract.org/2004/07/ClassLibrary" xmlns:i="http://www.w3.org/2001/XMLSchema-instance">
      <Message>Throwing FaultException&lt;FaultDetails&gt;.</Message>
    </FaultDetails>
  </detail>
</s:Fault> 
```

这看起来不对。查看 SOAP 1.1 规范，当我使用 FaultCode.CreateSenderFaultCode(new FaultCode("MySubFaultCode")) 时，我希望看到“faultcode”的值为“s:Client.MySubFaultCode”。此外，WCF 客户端的结构不正确。faultException.Code.Name 是“MySubFaultCode”而不是“Sender”，faultException.Code.SubCode 是 null 而不是 faultException.Code.SubCode.Name 是“MySubFaultCode”。此外，faultException.Code.IsSenderFault 为假。

使用 FaultCode.CreateReceiverFaultCode(new FaultCode("MySubFaultCode")) 时的类似问题：

*   按预期工作于 SOAP 1.2
*   生成“s:MySubFaultCode”而不是“s:Server.MySubFaultCode”，并且 SOAP 1.1 的 faultException.Code.IsReceiverFault 为 false

这个项目也是2006年别人在[http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=669420&SiteID=1](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=669420&SiteID=1)上发布的，没有人回答。我很难相信还没有人遇到过这种情况。

这是其他人遇到类似问题：[http ://forums.microsoft.com/msdn/ShowPost.aspx?PostID=3883110&SiteID=1&mode=1](http://forums.microsoft.com/msdn/ShowPost.aspx?PostID=3883110&SiteID=1&mode=1)

Microsoft Connect 错误：[https ://connect.microsoft.com/wcf/feedback/ViewFeedback.aspx?FeedbackID=367963](https://connect.microsoft.com/wcf/feedback/ViewFeedback.aspx?FeedbackID=367963)

故障应该如何工作的描述：http: [//blogs.msdn.com/drnick/archive/2006/12/19/creating-faults-part-3.aspx](http://blogs.msdn.com/drnick/archive/2006/12/19/creating-faults-part-3.aspx)

我做错了什么还是这真的是 WCF 中的一个错误？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-16T04:29:38.797

这是我目前的解决方法：

```
 /// <summary>
    /// Replacement for the static methods on FaultCode to generate Sender and Receiver fault codes due
    /// to what seems like bugs in the implementation for basicHttpBinding (SOAP 1.1). wsHttpBinding 
    /// (SOAP 1.2) seems to work just fine.
    /// 
    /// The subCode parameter for FaultCode.CreateReceiverFaultCode and FaultCode.CreateSenderFaultCode
    /// seem to take over the main 'faultcode' value in the SOAP 1.1 response, whereas in SOAP 1.2 the
    /// subCode is correctly put under the 'Code->SubCode->Value' value in the XML response.
    /// 
    /// This workaround is to create the FaultCode with Sender/Receiver (SOAP 1.2 terms, but gets
    /// translated by WCF depending on the binding) and an agnostic namespace found by using reflector
    /// on the FaultCode class. When that NS is passed in WCF seems to be able to generate the proper
    /// response with SOAP 1.1 (Client/Server) and SOAP 1.2 (Sender/Receiver) fault codes automatically.
    /// 
    /// This means that it is not possible to create a FaultCode that works in both bindings with
    /// subcodes.
    /// </summary>
    /// <remarks>
    /// See http://stackoverflow.com/questions/65008/net-wcf-faults-generating-incorrect-soap-11-faultcode-values
    /// for more details.
    /// </remarks>
    public static class FaultCodeFactory
    {
        private const string _ns = "http://schemas.microsoft.com/ws/2005/05/envelope/none";

        /// <summary>
        /// Creates a sender fault code.
        /// </summary>
        /// <returns>A FaultCode object.</returns>
        /// <remarks>Does not support subcodes due to a WCF bug.</remarks>
        public static FaultCode CreateSenderFaultCode()
        {
            return new FaultCode("Sender", _ns);
        }

        /// <summary>
        /// Creates a receiver fault code.
        /// </summary>
        /// <returns>A FaultCode object.</returns>
        /// <remarks>Does not support subcodes due to a WCF bug.</remarks>
        public static FaultCode CreateReceiverFaultCode()
        {
            return new FaultCode("Receiver", _ns);
        }
    } 
```

遗憾的是，我看不到在不破坏 SOAP 1.1 或 1.2 客户端的情况下使用子代码的方法。

如果您使用 Code.SubCode 语法，您可以创建与 SOAP 1.1 兼容的错误代码值，但它会破坏 SOAP 1.2。

如果您在 .NET 中使用适当的子代码支持（通过静态 FaultCode 方法或其中一种重载），它会破坏 SOAP 1.1，但在 SOAP 1.2 中有效。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-15T22:49:20.167

微软的回应：

如[http://msdn.microsoft.com/en-us/library/ms789039.aspx](http://msdn.microsoft.com/en-us/library/ms789039.aspx)中所述，Soap 1.1 规范中概述了两种用于自定义故障代码的方法：

(1) 如您所描述，使用“点”符号

(2) 定义全新的故障代码

不幸的是，应该避免使用“点”表示法，因为在 WS-I Basic Profile 规范中不鼓励使用它。从本质上讲，这意味着在使用 Soap 1.1 时没有真正等效的 Soap 1.2 故障子代码。

因此，在生成故障时，您必须了解绑定中定义的 MessageVersion，并相应地生成故障代码。

由于“sender”和“receiver”对于 Soap 1.1 来说不是有效的故障代码，并且没有真正等效的故障子代码，因此在为 Soap 1.1 生成自定义故障代码时不应使用 CreateSenderFaultCode 和 CreateReceiverFaultCode 方法。

相反，您需要使用自己的命名空间和名称定义自己的故障代码：

FaultCode customFaultCode = new FaultCode(localName, faultNamespace);

# java - Is GCJ (GNU Compiler for Java) a viable tool for publishing a webapp?

> ID：65010
> 
> 赞同：13
> 
> 时间：2008-09-15T17:40:35.987
> 
> 标签：java, gcj

Is it really viable to use GCJ to publish server-side applications? Webapps?

My boss is convinced that compiling our (***my***) webapp into a binary executable is a brilliant idea. (Then again, he likes nice, small simple things with blinky lights that he can understand.) He instinctively sees no issues with this, while I only see an endless series of problems and degradations. Once I start talking to him about the complexity of our platform, and more in depth specifics of byte code, JVMs, libraries, differences between operating systems, processor architectures, etc...well...his eyes glaze over, he smiles and he has made it clear he thinks I'm being childishly resistive.

Why does he want a single magic executable? He sees a couple of "benefits":

*   If it is a binary executable, then it is hard to reverse engineer and circumvent any licensing. Management lives in constant fear that this is happening, even though we sell into larger corporates who generally do not do cheat with server software.
*   There is that vision of downloading this magic executable, running it, and everything works. (No more sending me out to do customer installations, which is not that frequent.)

So, I've done my obligatory 20 minutes of googling, and now I am here.

A bit of background on my application:

**What it is made from:**

*   Java 6 (Sun's JVM)
*   AspectJ 1.6
*   Tomcat 6
*   Hibernate 3
*   Spring 2
*   another two dozen supporting jar files

**What it does**

*   A streaming media CMS
*   Performance sensitive
*   Deployed on Linux, Solaris, Windows (and developed on a Mac)

As you can probably gather, I'm highly skeptical of this *"compiling Java to native code"* thing. It sound like where Mono (VB on Linux) was back in 2000\. But am I being overly pessimistic? Is it viable? Should I actually spend the time (days if not weeks) to try this out?

There is one other similar thread ([Java Compiler Options to produce .exe files](https://stackoverflow.com/questions/53845/java-compiler-options-to-produce-exe-files)) but it is a bit too simple, the links dated, and not really geared towards a server-side question.

Your informed opinions will be highly cherished, my dear SOpedians! TIA!

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-15T17:52:12.340

I don't know about GCJ, but my company uses Excelsior JET with success. We haven't done it with a webapp (yet) but it should be able to handle anything that the Sun JRE can. In fact JET is a Sun-certified Java implementation.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-15T17:47:03.460

FWIW: I have never had good luck with GCJ, I have had a lot of problems using it and have had some obscure issues pop up that took forever to diagnose to GCJ rather than me (I am always very very reluctant to blame things on external libraries). I will openly admit this happened several years ago and I have never wanted to go near GCJ again. To give that more substance this was while I was in school and was working on a mostly trivial program so on an *"enterprise level"* I have had a healthy fear of GCJ.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-09-18T05:20:12.547

Excelsior JET is the definitive answer

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-15T19:03:21.140

Having one executable has a few downsides:

*   You can't patch it as easy (i.e. replace one class file)
*   I don't think it can be called a webapp -- I assume it won't run in Tomcat.
*   It is non-standard so that increases your maintenance costs.
*   It is non-standard so tool support is reduced.

If he wants something simple maybe a war or ear would be better. I can't see any benefit to doing this -- I would think this *might* be beneficial it it was a standalone application that you distributed so that people can just double-click on it.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-09-17T10:27:34.680

I've only used GCJ very briefly, and quickly moved to Sun's JDK. The main problems I saw was that GCJ seems to always lag a little behind the latest version of Sun's JDK and that there were weird mysterious bugs caused by subtle differences with Sun's JDK. In version 1.5 (which is supposd to be compatible with Sun's v1.5), I had problems compiling using generics, and finally gave up and moved to Sun's JDK.

I must say, any difference in performance was negligible (for my purposes, YMMV) and really the solution for installation issues is to create an installer for your app. Reverse engineering a binary isn't really all that harder than reverse engineering bytecode. Use an obfuscator if it is that important.

Overall, I think the compatibility problems involved in using GCJ greatly outweighs any gains (which I think questionable at best) you might possible derive from it. Try compiling parts of your app in gcj and see how it goes though. If it works out fine, otherwise you get something solid to pitch to your boss.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-09-17T10:51:49.397

I'll play devils advocate a bit, though I know little about GCJ.

Compiling to native code may give your application a performance boost and use less memory, so if it can be made to work, there are advantages for the business in terms of competition.

Being able to support an application better is also a good for business.

So perhaps it is worth investigating baring in mind that nothing can lose a customer faster than an application that doesn't work.

You need proper project time to try this out and a customer, that knows what they are getting into, that is willing to give it whirl (harder to find).

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-15T17:47:11.073

I don't think that a large application like yours will compile to machine code. Remember that java is not only java syntax (might compile to machine code) but also a virtual machine which is more like an application / process environment. I would suggest making an [uberjar](http://classworlds.codehaus.org/uberjar.html) or like that instead.

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-09-16T14:28:37.670

Perhaps your boss just needs a demo as to how easy it is to distribute and deploy a war file for your customers on their own app servers. Every file is "binary", so you might be too-literal in thinking he means an executable on the command-line.

# vb6 - 有没有办法在 Visual Basic 6.0 应用程序中添加全局错误处理程序？

> ID：65020
> 
> 赞同：5
> 
> 时间：2008-09-15T17:41:56.920
> 
> 标签：vb6

VB 6.0 没有任何全局处理程序。为了捕捉运行时错误，我们需要在每个我们认为可能发生错误的方法中添加一个处理程序。但是，仍然可能会遗漏一些地方。所以，我们最终会得到运行时错误。在应用程序的所有方法中添加错误处理程序，唯一的方法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-15T17:45:58.097

不，没有办法在 VB6 中添加全局错误处理程序。但是，您不需要在每个方法中都添加错误处理程序。您只需要在每个事件处理程序中添加一个错误处理程序。例如每个点击事件、加载事件等

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-15T23:06:46.373

虽然错误确实向上传播，但 VB6 无法进行堆栈跟踪，因此您永远不知道哪个方法引发了错误。不幸的是，如果您需要此信息，您必须为每个方法添加一个处理程序，以便记录您所在的位置。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T17:59:45.753

另外：错误确实向上传播：如果方法 X 调用方法 Y 和 Z，则方法 X 中的单个错误处理程序将涵盖所有三个方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-05-28T13:59:09.567

我昨天发现了这个工具：

[http://www.everythingaccess.com/simplyvba-global-error-handler.htm](http://www.everythingaccess.com/simplyvba-global-error-handler.htm)

它是一个商业产品，可以在 VB6 和 VBA 应用程序中进行全局错误处理。

它有它的成本，但它完美地完成了它的工作。我已经看到其他工具（尽管是免费的）在这个 VB6 mangle 中有所帮助，但是没有一个可以像“SimplyVB6 Global Error Handler for VB6”那样涵盖真正的全局错误处理。

使用“SimplyVB6 Global Error Handler for VB6”，无需更改任何现有代码行，也无需对代码行进行编号（通过插件或其他方式）。只需启用全局错误处理（主模块中的一行代码）就可以了。

“用于 VB6 的 SimpleVB6 全局错误处理程序”：

*   可以显示带有真实模块和函数名称的调用堆栈，以及显示源代码行。
*   仅适用于 P-Code 编译的 VB6 程序。
*   可以通过早期或晚期绑定工作（无 DLL Hell）。

我与 www.everythingaccess.com 没有任何关系，只是很高兴昨天下午找到了它，我的一个客户在我们的 VB6 应用程序中遇到了错误，因此我再次考虑了这个问题。昨天下午我能够测试该工具，与 www.everythingaccess.com 支持交换电子邮件，并通过邮件获得评估产品。他们的 web 端还不允许下载 VB6 产品的评估版，你必须给他们发电子邮件，但他们会在不到一个小时内回复。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2008-09-15T17:52:52.040

下一个错误恢复 - 有点接近，但已经有一段时间了。您可能想查找任何警告

# asp.net - ASP.net Membership Provider - 在表单和集成身份验证之间切换

> ID：65024
> 
> 赞同：2
> 
> 时间：2008-09-15T17:42:18.417
> 
> 标签：asp.net, authentication

我正在编写一个 Web 应用程序，我希望能够使用指向 SQL 数据库的表单身份验证，或者在 Web 应用程序的不同安装中使用集成身份验证。我对任一提供商的用户身份验证都很好，但我对如何构建我的数据库有疑问。

目前我正在做的是使用代码：

```
public static string UserID
{
  get
  {
     if (HttpContext.Current.User.Identity.AuthenticationType == "Forms")
     {
       //using database auth
       return Membership.GetUser().ProviderUserKey.ToString();
     }
     else
     {
       //using integrated auth
       return HttpContext.Current.Request.LogonUserIdentity.User.ToString();
     }
   }
 } 
```

然后，我使用返回的密钥（取决于提供者，它是 aspnetdb 数据库中的用户 ID，或 windows SID）作为他们创建的项目的用户 ID，等等。虽然用户 ID 字段与数据库中的用户表无关就像你传统上会做的那样。

有没有更好的方法来解决这个问题？我曾想过创建一个用户表，其中包含两个字段 UserID（内部）和 ExternalID（存储 Windows SID 或来自 aspnetdb 的 ID），然后在整个应用程序中使用内部 UserID，但它与成员资格不一样c# 中的类。

似乎有很多应用程序允许您在集成身份验证和 FBA 之间切换（首先想到的是 Sharepoint 2007），但我在网上找不到任何关于如何构建解决方案的好的教程。任何帮助将不胜感激。谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-15T21:54:39.777

为什么不只使用两个不同的成员资格提供程序（Windows 和 Forms，而不是专门使用 LogonUserIdentify）？在您发布的代码示例中，您可以在 Membership 命名空间中为任何提供者使用相同的方法。您可以更改 Web.config 文件中的默认提供程序。我同意使用特定于“集成身份验证”的代码并不干净。这是一个例子：

```
<membership defaultProvider="1">
 <providers>
  <clear/>
  <add name="1" ... />
  <add name="2" ... />
 </providers>
</membership> 
```

然后，更改 defaultProvider。处理 Membership 的 ASP.NET 控件（例如 Login 控件）有一个属性，可以让您选择 Membership 提供程序，这意味着您可以通过编程方式选择一个。

~~用户 ID 仅在提供者的上下文中相关，因此使用“内部”用户名似乎没有必要 - 在您自己的数据存储中使用提供者名称和外部用户 ID（因为相同的用户 ID 可能存在于多个提供者中） .~~

通常不需要创建您自己的用户 ID，因为 ASP.NET 提供程序会在幕后处理这些问题。例如，如果您使用 ASP.NET 配置文件提供程序，您将拥有每个用户的配置文件信息，而与用于对用户进行身份验证的成员资格提供程序无关。

# html - 从 IFrame 中删除边框

> ID：65034
> 
> 赞同：808
> 
> 时间：2008-09-15T17:43:53.263
> 
> 标签：html, css, iframe, internet-explorer-6, noborder

如何从嵌入在我的网络应用程序中的 iframe 中删除边框？iframe 的一个示例是：

```
<iframe src="myURL" width="300" height="300">Browser not compatible.</iframe> 
```

假设背景颜色一致，我希望从我的页面内容到 iframe 内容的过渡是无缝的。目标浏览器仅限 IE6，不幸的是，其他人的解决方案无济于事。

* * *

## 回答 #1

> 赞同：1244
> 
> 时间：2008-09-15T17:45:47.487

* * *

## 回答 #2

> 赞同：167
> 
> 时间：2008-11-02T21:29:54.787

在 IE7 中尝试删除边框后，我发现 frameBorder 属性区分大小写。

您必须使用大写**B**设置 frameBorder 属性。

```
<iframe frameBorder="0"></iframe> 
```

* * *

## 回答 #3

> 赞同：109
> 
> 时间：2011-12-08T21:27:47.603

根据[iframe](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe)文档，不推荐使用 frameBorder，并且首选使用“border”CSS 属性：

```
<iframe src="test.html" style="width: 100%; height: 400px; border: 0"></iframe> 
```

*   注意 CSS 边框属性在 IE6、7 或 8中**没有达到预期的效果。**

* * *

## 回答 #4

> 赞同：56
> 
> 时间：2008-09-15T17:54:00.510

除了添加 frameBorder 属性之外，您可能还需要考虑将滚动属性设置为“no”以防止出现滚动条。

```
<iframe src="myURL" width="300" height="300" frameBorder="0" scrolling="no">Browser not compatible. </iframe > 
```

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2011-02-01T10:23:46.683

对于浏览器特定问题，还`frameborder="0" hspace="0" vspace="0" marginheight="0" marginwidth="0"`根据 Dreamweaver 添加：

```
<iframe src="test.html" name="banner" width="300" marginwidth="0" height="300" marginheight="0" align="top" scrolling="No" frameborder="0" hspace="0" vspace="0">Browser not compatible. </iframe> 
```

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2015-10-23T03:23:58.630

您可以`style="border:0;"`在 iframe 代码中使用。这是在 HTML5 中删除边框的推荐方法。

查看我的[html5 iframe 生成器](http://codegena.com/generator/iframe-code-generator)工具，无需编辑代码即可自定义 iframe。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2014-07-10T07:45:21.893

使用 HTML iframe frameborder 属性

[http://www.w3schools.com/tags/att_iframe_frameborder.asp](http://www.w3schools.com/tags/att_iframe_frameborder.asp)

注意：IE 使用框架**B**顺序（cap B），否则将不起作用。但是，HTML5 不支持 iframe frameborder 属性。因此，请改用 CSS。

```
<iframe src="http://example.org" width="200" height="200" style="border:0"> 
```

您还可以使用滚动属性 [http://www.w3schools.com/tags/att_iframe_scrolling.asp删除滚动](http://www.w3schools.com/tags/att_iframe_scrolling.asp)

```
<iframe src="http://example.org" width="200" height="200" scrolling="no" style="border:0"> 
```

您也可以使用 HTML5 中新增的无缝属性。iframe 标签的无缝属性仅在 Opera、Chrome 和 Safari 中受支持。如果存在，它指定 iframe 应该看起来像是包含文档的一部分（没有边框或滚动条）。目前，标签的无缝属性仅在 Opera、Chrome 和 Safari 中支持。但在不久的将来，它将成为标准解决方案，并将与所有浏览器兼容。[http://www.w3schools.com/tags/att_iframe_seamless.asp](http://www.w3schools.com/tags/att_iframe_seamless.asp)

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2017-02-11T11:27:09.237

**如果要删除框架的边框或可以使用样式属性的任何内容，则可以将样式属性**用于HTML5。**如下所示**

 **代码在这里

```
<iframe src="demo.htm" style="border:none;"></iframe> 
```

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2012-01-23T21:50:36.337

您也可以通过这种方式使用 JavaScript。它会在 IE 和其他浏览器中找到任何 iframe 元素并删除它们的边框（尽管您可以在非 IE 浏览器中设置“border : none;”样式而不是使用 JavaScript）。并且即使在生成 iframe 并在文档中就位后使用它也会起作用（例如，以纯 HTML 而不是 JavaScript 添加的 iframe）！

这似乎可行，因为 IE 创建边框，不是像您期望的那样在 iframe 元素上，而是在 iframe 的 CONTENT 上 - 在 BOM 中创建 iframe 之后。($@&*#@!!! IE!!!)

注意：IE 部分只有在父窗口和 iframe 来自相同的来源（相同的域、端口、协议等）时才起作用（当然）。否则脚本将在 IE 错误控制台中出现“拒绝访问”错误。如果发生这种情况，您唯一的选择是在生成之前设置它，正如其他人所指出的那样，或者使用非标准 frameBorder="0" 属性。（或者只是让 IE 看​​起来很丑——我目前最喜欢的选项；））

我花了很多时间工作到绝望的地步来解决这个问题......

享受。:)

```
// =========================================================================
// Remove borders on iFrames

var iFrameElements = window.document.getElementsByTagName("iframe");
for (var i = 0; i < iFrameElements.length; i++)
{
  iFrameElements[i].frameBorder="0";   //  For other browsers.
  iFrameElements[i].setAttribute("frameBorder", "0");   //  For other browsers (just a backup for the above).
  iFrameElements[i].contentWindow.document.body.style.border="none";   //  For IE.
} 
```

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2016-03-16T06:17:02.173

添加 frameBorder 属性（大写“B”）。

```
<iframe src="myURL" width="300" height="300" frameBorder="0">Browser not compatible. </iframe> 
```

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2014-06-12T19:43:04.277

我尝试了以上所有方法，如果这对您不起作用，请尝试以下 CSS 为我解决了问题。这只是告诉浏览器不要添加任何填充或边距。

```
* {
  padding:0px;
  margin:0px;
 } 
```

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2013-07-03T15:06:19.157

如果您放置 iframe 的页面的文档类型是 HTML5，那么您可以`seamless`像这样使用该属性：

```
<iframe src="..." seamless="seamless"></iframe> 
```

[关于无缝属性的 Mozilla 文档](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe)

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2015-02-18T00:25:07.820

在您的样式表中添加

```
{
  padding:0px;
  margin:0px;
  border: 0px

} 
```

这也是一个可行的选择。

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2018-01-09T10:21:49.747

添加 frameBorder 属性，或使用边框宽度为 0px 的样式；或将边框样式设置为无。

使用以下 3 中的任何一种：

```
<iframe src="myURL" width="300" height="300" style="border-width:0px;">Browser not compatible.</iframe>

<iframe src="myURL" width="300" height="300" frameborder="0">Browser not compatible.</iframe>

<iframe src="myURL" width="300" height="300" style="border:none;">Browser not compatible.</iframe>
```

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2016-07-20T17:24:20.120

如果您使用 iFrame 来适应整个屏幕的宽度和高度，我假设您不是基于 300x300 大小，您还必须将主体边距设置为“0”，如下所示：

```
<body style="margin:0px;"> 
```

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2016-09-03T13:59:15.167

```
<iframe src="mywebsite" frameborder="0" style="border: 0px solid white;">HTML iFrame is not compatible with your browser</iframe> 
```

这段代码应该在 HTML 4 和 5 中都能工作。

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2017-01-05T12:17:16.563

还设置边框=“0px”

```
 <iframe src="yoururl" width="100%" height="100%" frameBorder="0"></iframe> 
```

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2017-07-01T08:31:08.700

尝试

```
<iframe src="url" style="border:none;"></iframe> 
```

这将删除框架的边框。

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2017-09-17T08:01:39.603

用这个

```
style="border:none; 
```

例子：

```
<iframe src="your.html" style="border:none;"></iframe> 
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2017-07-22T09:10:28.597

要删除边框，您可以使用 CSS 边框属性为无。

```
<iframe src="myURL" width="300" height="300" style="border: none">Browser not compatible.</iframe> 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2018-02-18T21:08:35.360

它很简单，只需在 iframe 标签中添加属性 frameborder = 0 `<iframe src="" width="200" height="200" frameborder="0"></iframe>`

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2020-02-11T10:59:34.097

**1.通过内联样式设置边框：0**

```
 <iframe src="display_file.html" style="height: 400px; width:
   100%;border: 0;">HTML iFrame is not compatible with your browser
   </iframe> 
```

**2.通过标签属性frameBorder Set 0**

```
<iframe src="display_file.html" width="300" height="300" frameborder="0">Browser not compatible.</iframe> 
```

**3.如果我们有多个I Frame我们可以给class和Put css in internal or external。**

**HTML：**

```
<iframe src="display_file.html" class="no_border_iframe">
    HTML iFrame is not compatible with your browser 
</iframe> 
```

**CSS：**

```
<style>
.no_border_iframe{
border: 0; /* or border:none; */
}
</style> 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2020-03-20T10:31:00.877

我遇到了底部白色边框的问题，我无法用边框、边距和填充规则修复它......所以添加`display:block;`，因为 iframe 是一个内联元素。

这会将 HTML 中的空格考虑在内。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2021-12-09T20:03:42.243

对我来说，添加效果很好

```
.iframe{
box-shadow: none !important;
} 
```

此解决方案特别适用于我正在编辑的 shopify 主题。shopify 主题在整个主题中以不同的方式使用 iframe，其中一种出现故障。我不得不手动进入 css 并覆盖 css 属性。

* * *

## 回答 #25

> 赞同：-1
> 
> 时间：2014-01-15T16:47:53.250

```
iframe src="XXXXXXXXXXXXXXX"
marginwidth="0" marginheight="0" width="xxx" height="xxx" 
```

适用于 Firefox ;)

* * *

## 回答 #26

> 赞同：-1
> 
> 时间：2018-09-07T19:43:22.380

```
<iframe src="URL" frameborder="0" width="100%" height="200">
<p>Your browser does not support iframes.</p>
</iframe>

<iframe frameborder="1|0">

(OR)

<iframe src="URL" width="100%" height="300" style="border: none">Your browser 
does not support iframes.</iframe>

The <iframe> frameborder attribute is not supported in HTML5\. Use CSS 
instead. 
```

# java - finally 块是否总是在 Java 中执行？

> ID：65035
> 
> 赞同：2584
> 
> 时间：2008-09-15T17:43:54.513
> 
> 标签：java, error-handling, return, try-catch-finally

考虑到这段代码，我是否可以*绝对确定*该`finally`块始终执行，无论`something()`是什么？

```
try {  
    something();  
    return success;  
}  
catch (Exception e) {   
    return failure;  
}  
finally {  
    System.out.println("I don't know if this will get printed out");
} 
```

* * *

## 回答 #1

> 赞同：2910
> 
> 时间：2008-09-15T17:45:39.203

是的，`finally`将在`try`或`catch`代码块执行后调用。

唯一`finally`不会被调用的时间是：

1.  如果你调用`System.exit()`
2.  如果你调用`Runtime.getRuntime().halt(exitStatus)`
3.  如果 JVM 先崩溃
4.  `try`如果 JVM 在or`catch`块中到达无限循环（或其他一些不可中断、非终止的语句）
5.  如果操作系统强行终止JVM进程；例如，`kill -9 <pid>`在 UNIX 上
6.  如果主机系统死机；例如，电源故障、硬件错误、操作系统恐慌等
7.  如果该`finally`块将由守护线程执行并且所有其他非守护线程在`finally`被调用之前退出

* * *

## 回答 #2

> 赞同：606
> 
> 时间：2008-09-15T17:59:52.460

示例代码：

```
public static void main(String[] args) {
    System.out.println(Test.test());
}

public static int test() {
    try {
        return 0;
    }
    finally {
        System.out.println("something is printed");
    }
} 
```

输出：

```
something is printed. 
0 
```

* * *

## 回答 #3

> 赞同：413
> 
> 时间：2008-09-15T18:19:53.507

此外，虽然这是不好的做法，但如果 finally 块中有 return 语句，它将胜过常规块的任何其他 return。也就是说，以下块将返回 false：

```
try { return true; } finally { return false; } 
```

从 finally 块中抛出异常也是如此。

* * *

## 回答 #4

> 赞同：262
> 
> 时间：2010-05-25T06:50:16.820

这是 Java 语言规范中的官方用语。

[14.20.2。try-finally 和 try-catch-finally 的执行](https://docs.oracle.com/javase/specs/jls/se8/html/jls-14.html#jls-14.20.2)

> **通过首先执行块来执行`try`带有块的语句。然后有一个选择：`finally``try`**
> 
> *   如果`try`块的执行正常完成，[...]
> *   如果块的执行由于值*V*`try`而突然完成，[...]`throw`
> **   **如果块的执行`try`由于任何其他原因*R*突然完成，则执行该`finally`块。然后有一个选择：**
>     *   如果 finally 块正常完成，则`try`语句由于原因*R*突然完成。
>     *   如果`finally`块由于原因*S*突然完成，则`try`语句由于原因*S*突然完成（**并且原因*R*被丢弃**）。*

 *的规范`return`实际上明确了这一点：

[JLS 14.17 返回声明](https://docs.oracle.com/javase/specs/jls/se8/html/jls-14.html#jls-14.17)

> ```
> ReturnStatement:
>      return Expression(opt) ; 
> ```
> 
> **不尝试**将控制权转移给包含它的方法或构造函数的调用者的语句`return`。`Expression`
> 
>  ****试图**将控制权转移给包含它的方法的调用者的语句`return`；的值成为方法调用的值。`Expression` **`Expression`**
> 
>  **前面的描述说“***尝试**转移控制*”而不仅仅是“*转移控制*`try`”，因为如果方法或构造函数中有任何语句的`try`块包含该`return`语句，那么`finally`这些语句的任何子句都`try`将按从内到外的顺序执行，在将控制权转移到方法或构造函数的调用者之前。一个子句的突然完成`finally`可能会中断由`return`语句启动的控制转移。****

 ***** * *

## 回答 #5

> 赞同：171
> 
> 时间：2010-05-13T07:11:59.567

除了其他响应之外，重要的是要指出“终于”有权覆盖 try..catch 块的任何异常/返回值。例如，以下代码返回 12：

```
public static int getMonthsInYear() {
    try {
        return 10;
    }
    finally {
        return 12;
    }
} 
```

同样，下面的方法也不会抛出异常：

```
public static int getMonthsInYear() {
    try {
        throw new RuntimeException();
    }
    finally {
        return 12;
    }
} 
```

虽然以下方法确实抛出了它：

```
public static int getMonthsInYear() {
    try {
        return 12;          
    }
    finally {
        throw new RuntimeException();
    }
} 
```

* * *

## 回答 #6

> 赞同：127
> 
> 时间：2008-11-17T16:25:36.027

我尝试了上面的例子，稍作修改-

```
public static void main(final String[] args) {
    System.out.println(test());
}

public static int test() {
    int i = 0;
    try {
        i = 2;
        return i;
    } finally {
        i = 12;
        System.out.println("finally trumps return.");
    }
} 
```

上面的代码输出：

> 终于胜过回归。
> 2

这是因为 when `return i;`is executed`i`的值为 2。在此之后`finally`执行块，其中分配了 12 `i`，然后`System.out`执行 out。

执行完`finally`块后，`try`块返回 2，而不是返回 12，因为这个 return 语句不再执行。

如果您将在 Eclipse 中调试此代码，那么您会感觉到在执行块之后再次执行`System.out`块`finally`的`return`语句`try`。但这种情况并非如此。它只是返回值 2。

* * *

## 回答 #7

> 赞同：126
> 
> 时间：2013-12-03T23:36:13.040

这是[凯文答案](https://stackoverflow.com/a/65185/2684342)的详细说明。重要的是要知道要返回的表达式是在之前计算的`finally`，即使它是在之后返回的。

```
public static void main(String[] args) {
    System.out.println(Test.test());
}

public static int printX() {
    System.out.println("X");
    return 0;
}

public static int test() {
    try {
        return printX();
    }
    finally {
        System.out.println("finally trumps return... sort of");
    }
} 
```

输出：

```
X
finally trumps return... sort of
0 
```

* * *

## 回答 #8

> 赞同：52
> 
> 时间：2010-05-13T06:19:17.580

这就是 finally 块的全部想法。它可以让你确保你做的清理工作可能会因为你返回而被跳过，当然，除其他外。

无论try 块**中发生什么**，最终都会被调用（*除非*您调用`System.exit(int)`或 Java 虚拟机因其他原因退出）。

* * *

## 回答 #9

> 赞同：42
> 
> 时间：2008-09-15T19:26:44.797

考虑这个问题的一个合乎逻辑的方法是：

1.  放置在 finally 块中的代码必须在 try 块中**发生的任何情况下执行**
2.  因此，如果 try 块中的代码尝试返回值或抛出异常，则该项目将被放在“货架上”，直到 finally 块可以执行
3.  因为 finally 块中的代码（根据定义）具有高优先级，它可以返回或抛出任何它喜欢的东西。在这种情况下，任何留在“架子上”的东西都会被丢弃。
4.  唯一的例外是如果虚拟机在尝试块期间完全关闭，例如通过“System.exit”

* * *

## 回答 #10

> 赞同：21
> 
> 时间：2008-09-15T17:46:18.343

finally 总是被执行，除非有异常的程序终止（比如调用 System.exit(0)..）。所以，你的系统输出将被打印出来

* * *

## 回答 #11

> 赞同：19
> 
> 时间：2013-07-13T23:02:23.970

不，并非总是一种例外情况是// System.exit(0); 在 finally 块阻止 finally 被执行之前。

```
 class A {
    public static void main(String args[]){
        DataInputStream cin = new DataInputStream(System.in);
        try{
            int i=Integer.parseInt(cin.readLine());
        }catch(ArithmeticException e){
        }catch(Exception e){
           System.exit(0);//Program terminates before executing finally block
        }finally{
            System.out.println("Won't be executed");
            System.out.println("No error");
        }
    }
} 
```

* * *

## 回答 #12

> 赞同：18
> 
> 时间：2008-09-15T18:11:55.660

finally 块总是被执行，除非程序异常终止，要么是由于 JVM 崩溃，要么是由于调用`System.exit(0)`.

最重要的是，从 finally 块中返回的任何值都将覆盖在 finally 块执行之前返回的值，因此在使用 try finally 时要小心检查所有退出点。

* * *

## 回答 #13

> 赞同：18
> 
> 时间：2008-09-15T19:26:15.717

finally 中的 return 也会抛出任何异常。 [http://jamesjava.blogspot.com/2006/03/dont-return-in-finally-clause.html](http://jamesjava.blogspot.com/2006/03/dont-return-in-finally-clause.html)

* * *

## 回答 #14

> 赞同：12
> 
> 时间：2010-05-13T06:18:23.697

finally 总是 run 这就是重点，仅仅因为它出现在 return 之后的代码中并不意味着它就是这样实现的。Java 运行时有责任在退出`try`块时运行此代码。

例如，如果您有以下情况：

```
int foo() { 
    try {
        return 42;
    }
    finally {
        System.out.println("done");
    }
} 
```

运行时将生成如下内容：

```
int foo() {
    int ret = 42;
    System.out.println("done");
    return 42;
} 
```

如果抛出未捕获的异常，则该`finally`块将运行并且异常将继续传播。

* * *

## 回答 #15

> 赞同：10
> 
> 时间：2008-09-15T17:46:40.043

是的，它会被调用。这就是使用 finally 关键字的全部意义所在。如果跳出 try/catch 块可以跳过 finally 块，这与将 System.out.println 放在 try/catch 之外是一样的。

* * *

## 回答 #16

> 赞同：10
> 
> 时间：2010-05-13T06:19:17.147

`System.exit()`因为除非您调用（或线程崩溃），否则将始终调用 finally 块。

* * *

## 回答 #17

> 赞同：10
> 
> 时间：2010-05-25T06:36:29.320

这是因为您将 i 的值分配为 12，但没有将 i 的值返回给函数。正确的代码如下：

```
public static int test() {
    int i = 0;
    try {
        return i;
    } finally {
        i = 12;
        System.out.println("finally trumps return.");
        return i;
    }
} 
```

* * *

## 回答 #18

> 赞同：10
> 
> 时间：2014-10-13T21:51:50.630

简而言之，在官方 Java 文档（单击[此处](http://docs.oracle.com/javase/tutorial/essential/exceptions/finally.html)）中，写到 -

> 如果在执行 try 或 catch 代码时 JVM 退出，则 finally 块可能不会执行。同样，如果执行 try 或 catch 代码的线程被中断或杀死，即使应用程序作为一个整体继续运行，finally 块也可能不会执行。

* * *

## 回答 #19

> 赞同：10
> 
> 时间：2015-12-12T14:30:53.560

# 不总是

Java 语言规范在[14.20.2](https://docs.oracle.com/javase/specs/jls/se7/html/jls-14.html#jls-14.20.2)`try`中描述了-和`catch`-块的工作方式，它 在任何地方都没有指定块总是被执行。但是对于- -和-块完成的所有情况，它确实指定必须在完成之前执行。`finally``try``catch`
`finally``try``catch``finally``try``finally``finally`

```
try {
  CODE inside the try block
}
finally {
  FIN code inside finally block
}
NEXT code executed after the try-finally block (may be in a different method). 
```

JLS 不保证**FIN在****CODE**之后执行。JLS 保证如果**CODE**和**NEXT**被执行，那么**FIN**将始终在**CODE之后和****NEXT**之前执行。

为什么 JLS 不保证`finally`块总是在`try`块之后执行？*因为这是不可能的。*`try`在完成块之后但在执行块之前，JVM 不太可能但可能会中止（杀死、崩溃、关闭电源）`finally`。JLS 无法避免这种情况。

因此，任何在其块完成后总是依赖于`finally`块的正确行为的软件都会被`try`窃听。

`return`块中的指令`try`与此问题无关。如果执行到达`try`- `catch`-之后的代码`finally`，则保证该`finally`块之前已经执行过，无论块`return`内是否有指令`try`。

* * *

## 回答 #20

> 赞同：10
> 
> 时间：2016-08-13T07:00:38.443

> 答案很简单**YES**。

**输入：**

```
try{
    int divideByZeroException = 5 / 0;
} catch (Exception e){
    System.out.println("catch");
    return;    // also tried with break; in switch-case, got same output
} finally {
    System.out.println("finally");
} 
```

**输出：**

```
catch
finally 
```

* * *

## 回答 #21

> 赞同：10
> 
> 时间：2020-01-27T13:24:21.903

`finally`块总是在返回`x`（计算的）值之前执行。

```
System.out.println("x value from foo() = " + foo());

...

int foo() {
  int x = 2;
  try {
    return x++;
  } finally {
    System.out.println("x value in finally = " + x);
  }
} 
```

输出：

> finally 中的 x 值 = 3
> x 来自 foo() 的值 = 2

* * *

## 回答 #22

> 赞同：9
> 
> 时间：2013-08-16T12:00:20.937

是的，它会。无论您的 try 或 catch 块中发生什么，除非另有 System.exit() 调用或 JVM 崩溃。如果块中有任何 return 语句，finally 将在该 return 语句之前执行。

* * *

## 回答 #23

> 赞同：8
> 
> 时间：2014-01-14T22:29:17.323

是的，它会。唯一的情况是 JVM 退出或崩溃

* * *

## 回答 #24

> 赞同：8
> 
> 时间：2014-12-02T12:30:14.930

是的，finally 块总是执行。大多数开发人员使用此块来关闭数据库连接、结果集对象、语句对象，并使用 java hibernate 来回滚事务。

* * *

## 回答 #25

> 赞同：8
> 
> 时间：2014-12-18T06:36:56.457

`finally`将执行，这是肯定的。

`finally`在以下情况下不会执行：

情况1 ：

当你正在执行`System.exit()`.

案例2：

当您的 JVM / 线程崩溃时。

案例3：

当您手动停止执行时。

* * *

## 回答 #26

> 赞同：8
> 
> 时间：2016-03-20T16:20:42.763

我试过这个，它是单线程的。

```
public static void main(String args[]) throws Exception {
    Object obj = new Object();
    try {
        synchronized (obj) {
            obj.wait();
            System.out.println("after wait()");
        }
    } catch (Exception ignored) {
    } finally {
        System.out.println("finally");
    }
} 
```

将永远`main` `Thread`处于`wait`状态，因此*`finally`永远不会被调用*，

所以控制台输出不会`print` `String`：在`wait()`或之后`finally`

同意@Stephen C，上面的例子是[这里](https://stackoverflow.com/a/65049/2987755)提到的第三种情况之一：

在以下代码中添加更多这样的无限循环可能性：

```
// import java.util.concurrent.Semaphore;

public static void main(String[] args) {
    try {
        // Thread.sleep(Long.MAX_VALUE);
        // Thread.currentThread().join();
        // new Semaphore(0).acquire();
        // while (true){}
        System.out.println("after sleep join semaphore exit infinite while loop");
    } catch (Exception ignored) {
    } finally {
        System.out.println("finally");
    }
} 
```

案例2：如果JVM先崩溃

```
import sun.misc.Unsafe;
import java.lang.reflect.Field;

public static void main(String args[]) {
    try {
        unsafeMethod();
        //Runtime.getRuntime().halt(123);
        System.out.println("After Jvm Crash!");
    } catch (Exception e) {
    } finally {
        System.out.println("finally");
    }
}

private static void unsafeMethod() throws NoSuchFieldException, IllegalAccessException {
    Field f = Unsafe.class.getDeclaredField("theUnsafe");
    f.setAccessible(true);
    Unsafe unsafe = (Unsafe) f.get(null);
    unsafe.putAddress(0, 0);
} 
```

参考：[你如何使 JVM 崩溃？](https://stackoverflow.com/q/65200/2987755)

情况 6：如果`finally`块将由守护进程执行，并且调用之前的`Thread`所有其他非守护进程`Threads`退出。`finally`

```
public static void main(String args[]) {
    Runnable runnable = new Runnable() {
        @Override
        public void run() {
            try {
                printThreads("Daemon Thread printing");
                // just to ensure this thread will live longer than main thread
                Thread.sleep(10000);
            } catch (Exception e) {
            } finally {
                System.out.println("finally");
            }
        }
    };
    Thread daemonThread = new Thread(runnable);
    daemonThread.setDaemon(Boolean.TRUE);
    daemonThread.setName("My Daemon Thread");
    daemonThread.start();
    printThreads("main Thread Printing");
}

private static synchronized void printThreads(String str) {
    System.out.println(str);
    int threadCount = 0;
    Set<Thread> threadSet = Thread.getAllStackTraces().keySet();
    for (Thread t : threadSet) {
        if (t.getThreadGroup() == Thread.currentThread().getThreadGroup()) {
            System.out.println("Thread :" + t + ":" + "state:" + t.getState());
            ++threadCount;
        }
    }
    System.out.println("Thread count started by Main thread:" + threadCount);
    System.out.println("-------------------------------------------------");
} 
```

输出：这不会打印“finally”，这意味着“daemon thread”中的“Finally block”没有执行

> ```
> main Thread Printing  
> Thread :Thread[My Daemon Thread,5,main]:state:BLOCKED  
> Thread :Thread[main,5,main]:state:RUNNABLE  
> Thread :Thread[Monitor Ctrl-Break,5,main]:state:RUNNABLE   
> Thread count started by Main thread:3  
> -------------------------------------------------  
> Daemon Thread printing  
> Thread :Thread[My Daemon Thread,5,main]:state:RUNNABLE  
> Thread :Thread[Monitor Ctrl-Break,5,main]:state:RUNNABLE  
> Thread count started by Main thread:2  
> -------------------------------------------------  
> 
> Process finished with exit code 0 
> ```

* * *

## 回答 #27

> 赞同：8
> 
> 时间：2018-04-10T11:33:34.993

添加到[@vibhash 的答案](https://stackoverflow.com/a/296053/4298200)，因为没有其他答案可以解释在像下面这样的可变对象的情况下会发生什么。

```
public static void main(String[] args) {
    System.out.println(test().toString());
}

public static StringBuffer test() {
    StringBuffer s = new StringBuffer();
    try {
        s.append("sb");
        return s;
    } finally {
        s.append("updated ");
    }
} 
```

将输出

> ```
> sbupdated 
> ```

* * *

## 回答 #28

> 赞同：8
> 
> 时间：2018-04-30T08:36:45.770

考虑以下程序：

```
public class SomeTest {

    private static StringBuilder sb = new StringBuilder();

    public static void main(String args[]) {

        System.out.println(someString());
        System.out.println("---AGAIN---");
        System.out.println(someString());
        System.out.println("---PRINT THE RESULT---");
        System.out.println(sb.toString());
    }

    private static String someString() {

        try {
            sb.append("-abc-");
            return sb.toString();

        } finally {
            sb.append("xyz");
        }
    }
} 
```

从 Java 1.8.162 开始，上述代码块给出以下输出：

```
-abc-
---AGAIN---
-abc-xyz-abc-
---PRINT THE RESULT---
-abc-xyz-abc-xyz 
```

这意味着使用`finally`释放对象是一种很好的做法，如下面的代码：

```
private static String someString() {

    StringBuilder sb = new StringBuilder();

    try {
        sb.append("abc");
        return sb.toString();

    } finally {
        sb = null; // Just an example, but you can close streams or DB connections this way.
    }
} 
```

* * *

## 回答 #29

> 赞同：7
> 
> 时间：2008-09-15T18:03:05.637

这实际上在任何语言中都是正确的……finally 总是在 return 语句之前执行，无论 return 在方法体中的什么位置。如果不是这样，finally 块就没有多大意义。

* * *

## 回答 #30

> 赞同：7
> 
> 时间：2008-10-01T15:15:44.153

除了关于 return 在 try 块中最终替换 return 的点之外，异常也是如此。抛出异常的 finally 块将替换从 try 块中抛出的返回或异常。

* * *

## 回答 #31

> 赞同：7
> 
> 时间：2015-05-13T11:11:01.483

我对不同论坛上提供的所有答案感到非常困惑，并决定最终编码并查看。输出是：

**即使在 try 和 catch 块中有 return，finally 也会被执行。**

```
try {  
  System.out.println("try"); 
  return;
  //int  i =5/0;
  //System.exit(0 ) ;
} catch (Exception e) {   
  System.out.println("catch");
  return;
  //int  i =5/0;
  //System.exit(0 ) ;
} finally {  
   System.out.println("Print me FINALLY");
} 
```

**输出**

> 尝试
> 
> 最后打印我

2.  如果在上面的代码中，return 被替换为`System.exit(0)`try 和 catch 块，并且在它之前发生异常，无论出于何种原因。

* * *

## 回答 #32

> 赞同：7
> 
> 时间：2017-05-20T12:16:09.667

1.  finally 块总是被执行。除非并且直到 **System.exit()**语句在那里存在（finally 块中的第一条语句）。
2.  如果**system.exit()**是第一个语句，那么 finally 块将不会被执行并且控制来自 finally 块。每当 System.exit() 语句进入 finally 块，直到该语句最终块执行，当 System.exit() 出现时，控制力完全从 finally 块中出来。

* * *

## 回答 #33

> 赞同：6
> 
> 时间：2017-06-08T12:41:40.633

如果不处理异常，在终止程序之前，JVM 会执行 finally 块。只有当程序的正常执行失败意味着由于以下原因终止程序时，它才会执行。

1.  通过导致导致进程中止的致命错误。

2.  由于内存损坏而终止程序。

3.  通过调用 System.exit()

4.  如果程序进入无限循环。

* * *

## 回答 #34

> 赞同：6
> 
> 时间：2017-12-16T15:36:36.123

是的，因为**没有控制语句**可以阻止`finally`执行。

这是一个参考示例，其中将执行所有代码块：

```
| x | Current result | Code 
|---|----------------|------ - - -
|   |                |     
|   |                | public static int finallyTest() {
| 3 |                |     int x = 3;
|   |                |     try {
|   |                |        try {
| 4 |                |             x++;
| 4 | return 4       |             return x;
|   |                |         } finally {
| 3 |                |             x--;
| 3 | throw          |             throw new RuntimeException("Ahh!");
|   |                |         }
|   |                |     } catch (RuntimeException e) {
| 4 | return 4       |         return ++x;
|   |                |     } finally {
| 3 |                |         x--;
|   |                |     }
|   |                | }
|   |                |
|---|----------------|------ - - -
|   | Result: 4      | 
```

在下面的变体中，`return x;`将被跳过。结果仍然是`4`：

```
public static int finallyTest() {
    int x = 3;
    try {
        try {
            x++;
            if (true) throw new RuntimeException("Ahh!");
            return x; // skipped
        } finally {
            x--;
        }
    } catch (RuntimeException e) {
        return ++x;
    } finally {
        x--;
    }
} 
```

当然，参考文献会跟踪它们的状态。此示例返回一个引用`value = 4`：

```
static class IntRef { public int value; }
public static IntRef finallyTest() {
    IntRef x = new IntRef();
    x.value = 3;
    try {
        return x;
    } finally {
        x.value++; // will be tracked even after return
    }
} 
```

* * *

## 回答 #35

> 赞同：6
> 
> 时间：2018-04-16T06:01:09.333

`try`- `catch`-`finally`是使用异常处理案例的关键词。
正常解释

```
try {
     //code statements
     //exception thrown here
     //lines not reached if exception thrown
} catch (Exception e) {
    //lines reached only when exception is thrown
} finally {
    // always executed when the try block is exited
    //independent of an exception thrown or not
} 
```

finally 块阻止执行...

*   当你打电话`System.exit(0);`
*   如果 JVM 退出。
*   JVM 中的错误

* * *

## 回答 #36

> 赞同：5
> 
> 时间：2011-10-13T16:01:55.700

如果抛出异常，finally 运行。如果没有抛出异常，finally 运行。如果异常被捕获，finally 运行。如果没有捕获到异常，finally 运行。

只有当 JVM 退出时它不运行。

* * *

## 回答 #37

> 赞同：5
> 
> 时间：2017-11-09T09:41:41.930

在几个独特的场景中，在 return 之后不会调用 finally 块：如果首先调用 System.exit()，或者如果 JVM 崩溃。

让我尝试以最简单的方式回答您的问题。

**规则 1**：finally 块总是运行（虽然有例外。但让我们坚持一段时间。）

**规则 2**：finally 块中的语句在控制离开 try 或 catch 块时运行。控制的转移可以作为正常执行、break 、 continue、goto 或 return 语句的执行，或 a传播异常。

在返回语句的情况下（因为它的标题），控件必须离开调用方法，因此调用相应的 try-finally 结构的 finally 块。return 语句在 finally 块之后执行。

如果 finally 块中也有 return 语句，它肯定会覆盖 try 块中未决的语句，因为它清除了调用堆栈。

您可以在这里参考更好的解释：http: [//msdn.microsoft.com/en-us/](http://msdn.microsoft.com/en-us/) .... 这个概念在所有高级语言中基本相同。

* * *

## 回答 #38

> 赞同：5
> 
> 时间：2018-04-02T16:06:12.670

是的，写[在这里](https://docs.oracle.com/javase/tutorial/essential/exceptions/finally.html)

> 如果在执行 try 或 catch 代码时 JVM 退出，则 finally 块可能不会执行。同样，如果执行 try 或 catch 代码的线程被中断或杀死，即使应用程序作为一个整体继续运行，finally 块也可能不会执行。

* * *

## 回答 #39

> 赞同：4
> 
> 时间：2012-04-17T09:06:56.140

试试这段代码，你会明白**finally 块中的代码是在 return 语句之后执行的**。

```
public class TestTryCatchFinally {
    static int x = 0;

    public static void main(String[] args){
        System.out.println(f1() );
        System.out.println(f2() );
    }

    public static int f1(){
        try{
            x = 1;
            return x;
        }finally{
            x = 2;
        }
    }

    public static int f2(){
        return x;
    }
} 
```

* * *

## 回答 #40

> 赞同：4
> 
> 时间：2014-02-17T08:48:25.997

无论是否处理异常，finally 块始终执行。如果在 try 块之前发生任何异常，则 finally 块将不会执行。

* * *

## 回答 #41

> 赞同：3
> 
> 时间：2010-05-13T06:19:47.347

因为无论你有什么情况，总决赛都会被调用。你没有异常，它仍然被调用，捕获异常，它仍然被调用

* * *

## 回答 #42

> 赞同：3
> 
> 时间：2010-05-13T11:50:14.550

在正常的执行过程中考虑这一点（即没有抛出任何异常）：如果方法不是“void”，那么它总是显式地返回一些东西，然而，最终总是被执行

* * *

## 回答 #43

> 赞同：3
> 
> 时间：2016-04-28T22:11:32.080

`finally`*如果 an 在嵌套**块*`Exception`中为`throw`n ，也可以提前退出。编译器将警告您该块未正常完成或给出您有无法访问的代码的错误。仅当不在条件语句或循环内时才会显示无法访问代码的错误。*`finally`*`finally``throw`

```
try{
}finally{
   try{
   }finally{
      //if(someCondition) --> no error because of unreachable code
      throw new RunTimeException();
   }
   int a = 5;//unreachable code
} 
```

* * *

## 回答 #44

> 赞同：3
> 
> 时间：2016-07-04T14:53:53.153

与以下代码相同：

```
static int f() {
    while (true) {
        try {
            return 1;
        } finally {
            break;
        }
    }
    return 2;
} 
```

f 将返回 2！

* * *

## 回答 #45

> 赞同：3
> 
> 时间：2016-09-13T05:36:30.857

是的，它总是会被调用，但在一种情况下，当你使用 System.exit() 时它不会调用

```
try{
//risky code
}catch(Exception e){
//exception handling code
}
finally(){
//It always execute but before this block if there is any statement like System.exit(0); then this block not execute.
} 
```

* * *

## 回答 #46

> 赞同：2
> 
> 时间：2018-04-20T23:57:32.020

即使您在 try 块中放置了 return 语句，finally 块也会始终执行。finally 块将在 return 语句之前执行。

* * *

## 回答 #47

> 赞同：2
> 
> 时间：2018-05-09T21:52:07.790

finally 总是在最后被调用

当你尝试时，它会执行一些代码，如果在 try 中发生了某些事情，那么 catch 将捕获该异常并且你可以打印一些 mssg 或抛出错误，然后执行 finally 块。

finally 通常在进行清理时使用，例如，如果您在 java 中使用扫描仪，您可能应该关闭扫描仪，因为它会导致其他问题，例如无法打开某些文件

* * *

## 回答 #48

> 赞同：2
> 
> 时间：2019-08-07T21:53:58.210

以下是一些可以绕过 finally 块的条件：

1.  如果在执行 try 或 catch 代码时 JVM 退出，则 finally 块可能不会执行。更多关于[太阳教程](http://download.oracle.com/javase/tutorial/essential/exceptions/finally.html)
2.  正常关机 - 这发生在最后一个非守护线程退出或 Runtime.exit() （[一些不错的博客](http://geekexplains.blogspot.com/2008/06/jvm-shutdown-jvm-shutdown-sequence.html)）时。当一个线程退出时，JVM 会清点正在运行的线程，如果剩下的唯一线程是守护线程，它会启动有序关闭。当 JVM 停止时，任何剩余的守护线程都被放弃，finally 块不执行，堆栈不展开，JVM 就退出。应该谨慎使用守护线程，很少有处理活动可以随时安全地放弃而无需清理。特别是，将守护线程用于可能执行任何类型 I/O 的任务是很危险的。守护进程线程最好保存用于“管家”任务，例如定期从内存缓存中删除过期条目的后台线程（[来源](https://rads.stackoverflow.com/amzn/click/com/0321349601)）

最后一个非守护线程退出示例：

```
public class TestDaemon {
    private static Runnable runnable = new Runnable() {
        @Override
        public void run() {
            try {
                while (true) {
                    System.out.println("Is alive");
                    Thread.sleep(10);
                    // throw new RuntimeException();
                }
            } catch (Throwable t) {
                t.printStackTrace();
            } finally {
                System.out.println("This will never be executed.");
            }
        }
    };

    public static void main(String[] args) throws InterruptedException {
        Thread daemon = new Thread(runnable);
        daemon.setDaemon(true);
        daemon.start();
        Thread.sleep(100);
        // daemon.stop();
        System.out.println("Last non-daemon thread exits.");
    }
} 
```

输出：

```
Is alive
Is alive
Is alive
Is alive
Is alive
Is alive
Is alive
Is alive
Is alive
Is alive
Last non-daemon thread exits.
Is alive
Is alive
Is alive
Is alive
Is alive 
```

* * *

## 回答 #49

> 赞同：1
> 
> 时间：2020-02-08T04:45:25.507

尝试资源示例

```
static class IamAutoCloseable implements AutoCloseable {
    private final String name;
    IamAutoCloseable(String name) {
        this.name = name;
    }
    public void close() {
        System.out.println(name);
    }
}

@Test
public void withResourceFinally() {
    try (IamAutoCloseable closeable1 = new IamAutoCloseable("closeable1");
         IamAutoCloseable closeable2 = new IamAutoCloseable("closeable2")) {
        System.out.println("try");
    } finally {
        System.out.println("finally");
    }
} 
```

测试输出：

```
try
closeable2
closeable1
finally 
```

* * *

## 回答 #50

> 赞同：0
> 
> 时间：2022-01-07T15:19:04.970

我在这里回答太晚了，但我很惊讶没有人提到 Java 调试器选项来删除堆栈帧。我是 IntelliJ 中此功能的重度用户。（我*确信*Eclipse 和 NetBeans 支持相同的功能。）

如果我从 try 或 catch 块中删除堆栈帧，然后是 finally 块，IDE 将提示我：“我应该执行 finally 块吗？” 显然，这是一个人工的运行时环境——一个调试器！

要回答你的问题，我想说你只能保证它在附加调试器时忽略它运行，并且（就像其他人所说）方法`something()`不（a）调用 Java 方法`System.exit(int)`或（b）C 函数`exit(int)`/`abort()`通过 JNI 或（c）做一些疯狂的事情，比如`kill -9 $PID`自己打电话（！）。

* * *

## 回答 #51

> 赞同：0
> 
> 时间：2022-01-24T22:15:15.480

[公认](https://stackoverflow.com/a/65049/1554195)的答案几乎在所有方面都是正确的，但它仍然只是一半的真相（好吧，95% 的真相）。

假设以下代码：

```
private final Lock m_Lock = new ReentrantLock();
…
public final SomeObject doSomething( final SomeObject arg )
{
  final SomeObject retValue;
  try
  {
    lock.lock();
    retValue = SomeObject( arg );
  }
  finally
  {
    out.println( "Entering finally block");
    callingAnotherMethod( arg, retValue );
    lock.unlock();
  }

  return retValue;
}
…
try
{
   final var result = doSomething( new SomeObject() );
}
catch( final StackOverflowError e ) { /* Deliberately ignored */ } 
```

调用该方法`doSomething()`将`StackOverflowError`几乎立即导致。

并且`lock`不会被释放！

`finally`但是，当块总是被执行（除了已在[接受的答案](https://stackoverflow.com/a/65049/1554195)中列出的例外）时，怎么会发生这种情况呢？

那是因为*无法保证*块中的*所有*语句都*真正*执行！`finally`

 *`System.exit()`如果在调用之前有调用或`throws`语句，这将是显而易见的`lock.unlock()`。

但是示例代码中没有这样的东西……</p>

`finally`除了调用之前块中的另外两个方法调用`lock.unlock()`将导致另一个`StackOverflowError`......</p>

瞧，锁没有被释放！

尽管这样的示例代码很愚蠢，但在许多软件中都可以找到很多类似的模式。只要`finally`块中没有发生任何丑陋的事情，一切都可以正常工作......</p>

有趣的事实是它在 Java 的更高版本中不起作用（意味着在更高版本中，锁被释放了……）。不知道何时以及为什么会发生这种变化。

但是你仍然必须确保`finally`块总是正常终止，否则它是否总是被执行可能并不重要......</p>

# c++ - 有没有办法在 Visual C++ 中编写带有变量参数列表的宏？

> ID：65037
> 
> 赞同：16
> 
> 时间：2008-09-15T17:43:59.690
> 
> 标签：c++, visual-c++, c-preprocessor, variadic-macros

据我所知，在 gcc 中，您可以编写如下内容：

```
#define DBGPRINT(fmt...) printf(fmt); 
```

有没有办法在 VC++ 中做到这一点？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-09-15T17:51:32.450

是的，但仅从 VC++ 2005 开始。您示例的语法为：

```
#define DBGPRINT(fmt, ...) printf(fmt, __VA_ARGS__) 
```

完整的参考资料在[这里](http://msdn.microsoft.com/en-us/library/ms177415(VS.80).aspx)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-15T17:48:29.743

是的，您可以在 2005 及更高版本的 Visual Studio C++ 中执行此操作（不确定 VS 2003）。看看**VA_ARGS**。你基本上可以做这样的事情：

```
#define DBGPRINTF(fmt, ...)  printf(fmt, __VA_ARGS__) 
```

并且宏的变量参数将传递给作为“...”参数提供的函数，然后您可以在其中使用 va_args 将它们解析出来。

**VA_ARGS**和宏的使用可能会出现奇怪的行为。因为**VA_ARGS**是可变的，这意味着可以有 0 个参数。这可能会在您不想要的地方留下逗号。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-15T18:22:31.923

如果您不想使用非标准扩展，则必须提供额外的括号：

```
#define DBGPRINT(args) printf(args);
DBGPRINT(("%s\n", "Hello World")); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T17:48:53.143

您要查找的内容称为 [可变参数宏]( [http://msdn.microsoft.com/en-us/library/ms177415(VS.80).aspx)](http://msdn.microsoft.com/en-us/library/ms177415(VS.80).aspx))。

链接摘要：是的，从 VC++ 2005 开始。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T03:23:51.530

如果您实际上不需要宏的任何功能（`__FILE__`、、`__LINE__`标记粘贴等），您可能需要考虑使用`stdargs.h`. 除了调用`printf()`，可变参数函数可以调用`vprintf()`以传递可变参数列表。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-05-03T18:57:17.297

对于 MSVC 7.1 (.NET 2003)，这有效：

```
#if defined(DETAILED_DEBUG)
#define DBGPRINT fprintf
#else
__forceinline void __DBGPRINT(...){}
#define DBGPRINT __DBGPRINT
#endif 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-15T17:49:45.713

以下应该工作。（参见[可变参数宏](http://msdn.microsoft.com/en-us/library/ms177415(VS.80).aspx)的链接）

（下面的示例显示了固定和可变参数。）

```
#  define DBGPRINTF(fmt,...) \
    do { \
        printf(fmt, __VA_ARGS__); \
    } while(0) 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-15T17:57:32.107

在 MSDN 中搜索“ **VA_ARGS** ”和 va_list！

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2008-09-15T17:47:04.177

几乎。它比那更难看（而且你可能不希望宏本身的尾随分号：

```
#define DBGPRINT(DBGPRINT_ARGS) printf DBGPRINT_ARGS // note: do not use '(' & ')' 
```

要使用它：

```
DBGPRINT(("%s\n", "Hello World")); 
```

（缺少一对括号）。

不知道为什么所有的否定，原始问题没有说明 VC++ 的版本，并且所有编译器都不支持可变参数宏。

# asp.net - 如何使用带有 ASP.net runat='server' 标记的传统 HTML id 属性？

> ID：65039
> 
> 赞同：7
> 
> 时间：2008-09-15T17:44:13.357
> 
> 标签：asp.net, css

我正在重构网站上的一些 CSS。我一直在研究，并注意到代码中没有传统的 HTML ID。

大量使用`CssClass='&hellip;'`，或者有时只是`class='&hellip;'`，但我似乎找不到说 id='...' 并且没有被服务器换掉的方法。

这是一个例子：

```
<span id='position_title' runat='server'>Manager</span> 
```

当响应从服务器返回时，我得到：

```
<span id='$aspnet$crap$here$position_title'>Manager</span>
```

这里有什么帮助吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-15T18:15:50.130

使用 jQuery 选择元素：

```
$("span[id$='position_title']").... 
```

jQuery 灵活的选择器，尤其是它的“开始于”/“结束于”选择器（上面显示了“结束于”选择器，为 ASP.NET 的 dom id munge 提供了一个很好的方法。

rp

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-15T17:48:49.163

放置在 id 前面的“废话”与控件的容器有关，除了不将其放入任何容器之外，没有办法（据我所知）阻止这种行为。

如果需要在脚本中引用id，可以使用控件的ClientID，如下：

```
<script type="text/javascript">
    var theSpan = document.getElementById('<%= position_title.ClientID %>');
</script> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T14:14:43.743

您可以在页面中嵌入您的 CSS，并使用一些服务器标签来解决这个问题。在运行时，代码块将替换为 ASP.NET 生成的 ID。

例如：

```
[style type="text/css"]
  #<%= AspNetId.ClientID %> {
      ... styles go here...
  }
[/style]

[script type="text/javascript"]
   document.getElementById("<%= AspNetId.ClientID %>");
[/script] 
```

如果您想将 CSS 包含在单独的文件中，您可以更进一步并拥有一些生成 CSS 的代码文件。

此外，我在这里可能有点过头了，但是您可以使用 ASP.NET MVC 的东西（在撰写本文时尚未正式发布），它可以远离 Web 窗体并让您完全控制生成的标记。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T01:54:54.787

大多数修复建议她对于一个非常简单的问题来说太过分了。只需拥有您使用 CSS 定位的单独的 div 和 span。如果要使用 ID，请不要直接针对 ASP.NET 控件。

```
 <span id="FooContainer">
     <span runat="server" id="Foo" >
         ......
     <span>
  </span> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T17:45:46.300

.Net 将始终用一些损坏的（每一个都可以预测，但仍然不要指望它）值替换您的 id 值。你真的需要那个 id runat=server 吗？如果你不输入 runat=server，那么它就不会破坏它......

补充：就像 leddt 所说，您可以使用 ClientID 引用跨度（或任何带有 id 的 runat=server），但我认为这在 CSS 中不起作用。

但我认为如果你的 CSS 使用基于 ID 的选择器，你会遇到更大的问题。您不能重复使用 ID。同一页面上不能有多个具有相同 ID 的项目。.Net 会抱怨这一点。

那么，考虑到这一点，你重构 CSS 的工作范围会变得更大吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-15T17:54:01.087

好吧，我想陪审团已经出局了。

@leddt，我已经知道“废话”是围绕它的容器，但我认为微软可能会留下一个后门来单独留下 ID。通过包含 ClientID 在每次使用时重新生成 CSS 文件将是一个可怕的想法。

我要么到处使用类，要么在 css 中硬编码一些看起来乱码的 ID。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-15T17:55:25.420

@Matt Dawdy：CSS 中的 ID 有一些很好的用途，主要是当您想要设置您知道在网站或页面中只出现一次的元素的样式时，例如注销按钮或标头。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-15T17:56:32.203

如果您正在访问`span`或任何标签给您带来 C# 或 VB 代码后面的问题，那么`runat="server"`必须保留，您应该使用`<span class="some_class" id="someID">`. 如果您没有访问后面代码中的标签，请删除`runat="server"`.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-15T17:59:01.870

最好的办法是给它一个唯一的类名。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-15T18:05:54.817

您可能必须从 span 中删除 runat="server" ，然后在 span 中放置 a ，这样您就可以对 span 进行样式化并仍然拥有动态的内部内容。

这不是一个优雅或简单的解决方案（并且需要重新编译），但它可以工作。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-15T18:46:09.790

我不知道有什么方法可以阻止 .NET 破坏 ID，但我可以想出几种解决方法：

1 - 嵌套跨度，一个带有 runat="server"，一个没有：

```
<style type="text/css">
#position_title { // Whatever
}
<span id="position_titleserver" runat="server"><span id="position_title">Manager</span></span> 
```

2 - 正如 Joel Coehoorn 建议的那样，改用唯一的类名。已经在使用该课程？没关系，你可以使用超过1个！这个...

```
<style type="text/css">
.position_title { font-weight: bold; }
.foo { color: red; }
.bar { font-style: italic; }
</style>
<span id="thiswillbemangled" class="foo bar position_title" runat="server">Manager</span> 
```

...将显示：

***经理***

3 - 编写一个 Javascript 函数来在页面加载后修复 ID

```
function fixIds()
{
    var tagList = document.getElementsByTagName("*");
    for(var i=0;i<tagList.length;i++)
    {
        if(tagList[i].id)
        {
            if(tagList[i].id.indexOf('$') > -1)
            {
                var tempArray = tagList[i].id.split("$");
                tagList[i].id = tempArray[tempArray.length - 1];
            }
        }
    }
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-15T19:53:09.910

如果您担心 classitus，请尝试在包含您希望设置样式的元素的父或子选择器上使用 id。此父元素不应应用 runat 服务器。简而言之，将结构容器规划为不运行代码（即不运行代码）是一个好主意，这样您就可以使用未更改的 ID 访问应用程序/站点的主要部分。如果为时已晚，请添加包装器 div/span 或使用上述的类解决方案。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-15T19:59:20.130

是否有特定原因希望控件运行在 runat="server"？

如果是这样，我支持使用 < asp : Literal > 。. .

它应该为您完成这项工作，因为您仍然可以在后面的代码中编辑数据。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-15T20:00:06.370

我通常制作自己的控件来扩展 WebControl 或 HtmlGenericControl，并覆盖 ClientID - 返回 ID 属性而不是生成的 ClientID。这将导致 .NET 由于命名容器而对 ClientID 进行的任何转换都恢复为您在标记标记中指定的原始 id。如果您使用 jQuery 之类的客户端库并且需要可预测的唯一 ID，这非常好，但如果您在任何服务器端都依赖视图状态，这将很难。

# java - 如何在 Java 代码中重写或转换 C# 代码？

> ID：65058
> 
> 赞同：4
> 
> 时间：2008-09-15T17:46:30.857
> 
> 标签：java, c#, .net, mono, interop

我开始使用 .net (C#) 为客户端和服务器端编写客户端 - 服务器应用程序。

不幸的是，我的公司拒绝为服务器盒上的 Windows 许可证付费，这意味着我需要用 Java 重写我的代码，或者采用 Mono 方式。

有什么好方法可以用 Java 翻译 C# 代码吗？服务器应用程序没有使用 .net 特定功能，仅使用 Spring.net、Hibernate.net 和 log4net 等跨语言工具。

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-15T17:50:24.667

我建议为 Mono 构建。你会遇到一些灰色区域，但总的来说它很棒。但是，如果您想为 Java 构建，您可以查看[Grasshopper](http://dev.mainsoft.com/Default.aspx?tabid=130)。它是一个商业产品，但它声称能够将 CIL（C# 编译器的输出）转换为 Java 字节码。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-15T17:55:36.793

除了可能的解决方案之外，将用一种语言编写的程序直接翻译成另一种语言通常被认为是一个 Bad Idea™——特别是如果这种翻译是以某种自动化方式完成的。即使由“真正的”程序员完成，逐行翻译应用程序通常会导致不太理想的最终结果，因为每种语言都有自己的习惯用法、优点和缺点，需要以稍微不同的方式完成工作。

尽管这可能很痛苦，但如果这是您的雇主要求的话，这可能符合您的最大利益以及必须维护此应用程序的人用 Java 重写它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T17:48:46.060

我只知道另一种方式。[Dbo4](http://www.db4o.com/)是用java开发的，c#版本是从java源自动生成的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T17:48:54.297

没有什么好办法。我的建议是从 Java 重新开始，或者像你说的那样使用 Mono。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T17:49:53.467

虽然我认为第一个错误是在没有确保合适的部署环境的情况下选择实现语言，但现在对此无能为力。我认为 Mono 方式会更好。必须重写代码只会增加项目的成本，特别是如果您已经有大量用 C# 编写的代码。我个人尽量避免重写代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-15T17:57:00.080

Java 和 C# 在语法和语义上非常接近。真正的问题是细微的差异。当你没想到时，它们会咬你。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-15T18:14:23.237

如果许可适合您，Grasshopper 确实是目前最好的解决方案（免费版本有一些重大限制）。它完全基于 Mono 类库（实际上非​​常好），但运行在标准 Java VM 之上。这很好，因为根据我的经验，Java VM 通常比 Mono 更快、更稳定。在与表单/图形相关的 API 方面，它确实比 Mono 有更多的弱点，因为其中大部分还没有从 Mono VM 移植到 Java。

不过，在它有效的情况下，它可能会很棒。有时，性能甚至比在 Windows 上的 MS 的 VM 上运行相同的代码时还要好。:)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-16T14:35:21.023

我会说从维护的角度重写代码。这将提高项目的初始成本，但对于查看代码的人来说，以后的劳动强度会降低。就像以前的海报所说的那样，任何像这样的自动化都不能像“真正的”程序员那样做得好，并且逐行转换也无济于事。你不想在以后生成代码，但是维护起来很麻烦。

# nhibernate - NHibernate，求和查询

> ID：65060
> 
> 赞同：2
> 
> 时间：2008-09-15T17:46:54.990
> 
> 标签：nhibernate, hql, querying

如果我定义了一个简单的命名查询，则会在一列上执行一个计数函数：

```
 <query name="Activity.GetAllMiles">
    <![CDATA[
      select sum(Distance) from Activity
    ]]>

  </query> 
```

如何使用 NHibernate 使用 IQuery 或 ICriteria 获得总和或任何不返回一个映射实体的查询的结果？

这是我的尝试（我现在无法测试），这行得通吗？

```
 public decimal Find(String namedQuery)
    {
        using (ISession session = NHibernateHelper.OpenSession())
        {
            IQuery query = session.GetNamedQuery(namedQuery);

            return query.UniqueResult<decimal>();
        }
    } 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-15T22:38:03.480

作为对您问题的间接回答，以下是我在没有命名查询的情况下如何做到的。

```
var session = GetSession();
var criteria = session.CreateCriteria(typeof(Order))
            .Add(Restrictions.Eq("Product", product))
            .SetProjection(Projections.CountDistinct("Price"));
return (int) criteria.UniqueResult(); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-17T15:17:24.097

对不起！我实际上想要一个总和，而不是一个计数，这解释了很多。iv 相应地编辑了帖子

这工作正常：

```
var criteria = session.CreateCriteria(typeof(Activity))
                          .SetProjection(Projections.Sum("Distance"));
   return (double)criteria.UniqueResult(); 
```

命名查询方法仍然失效，“命名查询中的错误：{Activity.GetAllMiles}”：

```
 using (ISession session = NHibernateHelper.OpenSession())
            {
                IQuery query = session.GetNamedQuery("Activity.GetAllMiles");

                return query.UniqueResult<double>();
            } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T15:23:36.533

我认为在你原来的例子中，你只需要 query.UniqueResult(); 计数将返回一个整数。

# sql - DB2 SQL 中的 IsNull 函数？

> ID：65071
> 
> 赞同：20
> 
> 时间：2008-09-15T17:47:43.333
> 
> 标签：sql, null, db2

是否有与 DB2 的 isnull 函数等效的性能？

想象一下我们的一些产品是内部的，所以它们没有名字：

```
Select product.id, isnull(product.name, "Internal) 
From product 
```

可能返回：

```
1 Socks 
2 Shoes 
3 Internal 
4 Pants 
```

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-07-14T00:44:40.540

就其价值而言，COALESCE 是相似的，但

```
IFNULL(expr1, default) 
```

是您在 DB2 中寻找的完全匹配。

COALESCE 允许多个参数，返回第一个 NON NULL 表达式，而 IFNULL 只允许表达式和默认值。

因此

```
SELECT product.ID, IFNULL(product.Name, "Internal") AS ProductName
FROM Product 
```

为您提供您正在寻找的内容以及以前的答案，只是为了完整性而添加。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2017-03-31T09:02:36.533

在 DB2 中有一个函数 NVL(field, value if null)。

例子：

SELECT ID, NVL(NAME, "Internal) AS NAME, NVL(PRICE,0) AS PRICE FROM PRODUCT WITH UR;

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-15T17:52:25.240

我对 DB2 不熟悉，但是您尝试过 COALESCE 吗？

IE：

```
 SELECT Product.ID, COALESCE(product.Name, "Internal") AS ProductName
FROM Product 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-05-26T14:32:01.363

```
Select Product.ID, VALUE(product.Name, "Internal") AS ProductName from Product 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-02T08:45:48.133

I think `COALESCE` function partially similar to the `isnull`, but try it.

Why don't you go for null handling functions through application programs, it is better alternative.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T16:28:33.297

`COALESCE` function same `ISNULL` function Note. you must use `COALESCE` function with same data type of column that you check is null.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-09-28T08:41:04.490

希望这可以帮助其他人

```
 SELECT 
.... FROM XXX XX
WHERE
....
AND(
       param1 IS NULL
       OR XX.param1 = param1
       ) 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-09-15T08:06:02.427

如果您需要使用 if/else，另一种选择是：

```
NVL2 (string_to_be_tested, string_if_not_null, string_if_null); 
```

IE：

```
SELECT product.ID, NVL2(product.Name, "Internal", "External") AS ProductName
FROM Product; 
```

# c++ - C++ 单元测试遗留代码：如何处理#include？

> ID：65074
> 
> 赞同：19
> 
> 时间：2008-09-15T17:47:54.080
> 
> 标签：c++, unit-testing, legacy

我刚刚开始使用#include 指令为具有大量物理依赖性的遗留代码模块编写单元测试。我一直在用一些感觉过于乏味的方法来处理它们（提供空头文件来打破长的#include 依赖列表，并使用#define 来防止类被编译）并且正在寻找一些更好的策略来处理这些问题。

我经常遇到使用空白版本复制几乎每个头文件的问题，以便将我正在测试的整个类分开，然后为需要的对象编写大量存根/模拟/假代码替换，因为它们现在未定义。

有人知道一些更好的做法吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-15T19:22:35.633

回复中的沮丧是压倒性的......但不要害怕，我们有一[本可以驱除遗留 C++ 代码恶魔的圣书](https://rads.stackoverflow.com/amzn/click/com/0131177052)。如果您与遗留 C++ 代码较量超过一周，请认真购买这本书。

转到第 127 页：**可怕的包含依赖关系的案例。**（现在我什至不在迈克尔·费瑟斯的英里范围内，但在这里我可以尽可能短地回答..）

**问题**：在 C++ 中，如果 classA 需要了解 ClassB，则 Class B 的声明是直接提升/以文本形式包含在 ClassA 的源文件中。而且由于我们程序员喜欢把它推向错误的极端，一个文件可以递归地包含无数其他的可传递文件。构建需要数年......但至少它会构建......我们可以等待。

现在说“在测试工具下实例化 ClassA 很困难”是轻描淡写的。（引用 MF 的示例 - 调度程序是我们的海报问题孩子，拥有大量的部门。）

```
#include "TestHarness.h"
#include "Scheduler.h"
TEST(create, Scheduler)     // your fave C++ test framework macro
{
  Scheduler scheduler("fred");
} 
```

这将带出带有一系列构建错误的包含龙。
**Blow#1 Patience-n-Persistence**：每次包含一个，然后决定我们是否真的需要这种依赖。假设 SchedulerDisplay 是其中之一，它的 displayEntry 方法在 Scheduler 的 ctor 中被调用。
**Blow#2 Fake-it-til-you-make-it**（感谢 RonJ）：

```
#include "TestHarness.h"
#include "Scheduler.h"
void SchedulerDisplay::displayEntry(const string& entryDescription) {}
TEST(create, Scheduler)
{
  Scheduler scheduler("fred");
} 
```

并且 pop 去依赖和它所有的传递包含。您还可以通过将 Fake 方法封装在 Fakes.h 文件中以包含在您的测试文件中来重用 Fake 方法。
**Blow#3 练习**：它可能并不总是那么简单.. 但你明白了。在前几次决斗之后，破坏部门的过程将变得容易-n-机械

**警告**（我有没有提到有警告？:)

*   我们需要为这个文件中的测试用例单独构建；我们在一个程序中只能有一个 SchedulerDisplay::displayEntry 方法的定义。因此，为调度程序测试创建一个单独的程序。
*   我们没有破坏程序中的任何依赖关系，因此我们没有使代码更干净。
*   只要我们需要测试，您就需要维护这些假货。
*   你的审美可能会被冒犯一段时间......咬紧嘴唇，“与我们一起共创美好明天”

将此技术用于具有严重依赖性问题的非常大的类。不要经常或轻率地使用。**使用它作为更深入重构的起点。**随着时间的推移，这个测试程序可以在你提取更多类时在谷仓后面进行（通过他们自己的测试）。

更多..请读这本书。无价。战哥！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T17:53:15.737

由于您正在测试遗留代码，我假设您无法重构所述代码以减少依赖项（例如，通过使用[pimpl idiom](http://www.gotw.ca/gotw/028.htm)）

恐怕这让你别无选择。包含在类型或函数中的每个标头都需要该类型或函数的模拟对象才能编译所有内容，您几乎无能为力...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T17:58:01.687

我没有直接回答你的问题，但如果你使用大量遗留代码，我担心单元测试可能不是要做的事情。

在带领 XP 团队完成一个新的开发项目后，我真的很喜欢我的单元测试。事情发生了，几年后我发现自己正在处理一个有很多质量问题的大型遗留代码库。

我试图找到一种将单元测试添加到应用程序的方法，但最后只是陷入了 catch-22：

1.  为了编写有意义的完整单元测试，需要重构代码。
2.  没有单元测试，重构代码太危险了。

如果您觉得自己像个英雄，并且在单元测试中喝了凉水，那么您仍然可以尝试一下，但是存在真正的风险，即您最终会得到更多价值不大的测试代码，现在也需要维护。

有时最好以“设计”的方式处理代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T18:24:00.047

我不知道这是否适用于您的项目，但您可能会尝试从构建的**链接阶段解决问题。**

这将完全消除您的#include 问题。您需要做的就是重新实现包含文件中的接口以执行您想要的任何操作，然后只需链接到您创建的模拟对象文件以实现包含文件中的接口。

这种方法的最大缺点是构建系统更复杂。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T17:57:56.210

如果您继续编写 stubs/mock/fake 代码，您可能会对具有不同行为的类进行单元测试，然后在主项目上编译。

但是，如果这些包含存在并且没有添加行为，那么没关系。

在进行单元测试时，我会尝试不更改包含的任何内容，这样您就可以确定（就您可以使用遗留代码而言：））您正在测试真正的代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-15T18:09:34.420

对于具有大量依赖项的遗留代码，您肯定处于困境和困境之间。你还有很长的路要走才能解决所有问题。

从您所说的来看，您似乎正试图依次保持每个模块的源代码完整，将其放置在模拟外部依赖项的测试工具中。我的建议是采取更勇敢的步骤，尝试进行一些重构以消除（或[反转](http://www.objectmentor.com/resources/articles/dip.pdf "依赖倒置原则")）依赖关系，这可能正是您试图避免的步骤。

我建议这样做是因为我猜测依赖项会在您编写测试时杀死您。如果您可以消除依赖关系，从长远来看，您肯定会变得更好。

# python - 如何正确设置 Vim 自动缩进以编辑 Python 文件？

> ID：65076
> 
> 赞同：89
> 
> 时间：2008-09-15T17:48:22.817
> 
> 标签：python, vim, configuration, spaces

我无法设置 Vim (7.1.xxx) 来编辑 Python 文件 (*.py)。缩进似乎被破坏了（最佳 4 个空格）。我遵循了一些通过 Google 找到的教程。仍然没有效果：/请帮助。

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2008-09-15T17:53:33.083

我在我的 macbook 上使用它：

```
" configure expanding of tabs for various file types
au BufRead,BufNewFile *.py set expandtab
au BufRead,BufNewFile *.c set expandtab
au BufRead,BufNewFile *.h set expandtab
au BufRead,BufNewFile Makefile* set noexpandtab

" --------------------------------------------------------------------------------
" configure editor with tabs and nice stuff...
" --------------------------------------------------------------------------------
set expandtab           " enter spaces when tab is pressed
set textwidth=120       " break lines when line length increases
set tabstop=4           " use 4 spaces to represent tab
set softtabstop=4
set shiftwidth=4        " number of spaces to use for auto indent
set autoindent          " copy indent from current line when starting a new line

" make backspaces more powerfull
set backspace=indent,eol,start

set ruler                           " show line and column number
syntax on               " syntax highlighting
set showcmd             " show (partial) command in status line 
```

（编辑为仅显示与缩进/制表符相关的内容）

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2012-08-06T15:01:33.240

我用：

```
$ cat ~/.vimrc
syntax on
set showmatch
set ts=4
set sts=4
set sw=4
set autoindent
set smartindent
set smarttab
set expandtab
set number 
```

但是我要试试达人的词条

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2017-06-03T02:05:02.140

一个更简单的选项：只需在 /etc/vim/vimrc 文件中取消注释以下配置部分（最初已被注释掉）：

```
 if has("autocmd")
      filetype plugin indent on
    endif 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-12-08T18:37:41.153

我在 python 存储库中使用 vimrc 等：

[http://svn.python.org/projects/python/trunk/Misc/Vim/vimrc](http://svn.python.org/projects/python/trunk/Misc/Vim/vimrc)

我也补充

```
set softtabstop=4 
```

[我在这里有我正在更新的旧配置](http://github.com/skyl/vim-config-python-ide)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-15T20:50:36.170

确保您正在为 VIM 编辑正确的配置文件。特别是如果您使用的是 Windows，文件可以命名为 _vimrc 而不是 .vimrc ，就像在其他平台上一样。

在 vim 类型中

`:help vimrc`

并检查 _vimrc/.vimrc 文件的路径

`:echo $HOME`

`:echo $VIM`

确保您只使用一个文件。如果你想将你的配置拆分成更小的块，你可以从你的 _vimrc 文件中获取其他文件。

`:help source`

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-02-13T10:25:27.757

结合 Daren 和 Thanos 提出的解决方案，我们有一个很好的 .vimrc 文件。

```
-----
" configure expanding of tabs for various file types
au BufRead,BufNewFile *.py set expandtab
au BufRead,BufNewFile *.c set noexpandtab
au BufRead,BufNewFile *.h set noexpandtab
au BufRead,BufNewFile Makefile* set noexpandtab

" --------------------------------------------------------------------------------
" configure editor with tabs and nice stuff...
" --------------------------------------------------------------------------------
set expandtab           " enter spaces when tab is pressed
set textwidth=120       " break lines when line length increases
set tabstop=4           " use 4 spaces to represent tab
set softtabstop=4
set shiftwidth=4        " number of spaces to use for auto indent
set autoindent          " copy indent from current line when starting a new line
set smartindent
set smarttab
set expandtab
set number

" make backspaces more powerfull
set backspace=indent,eol,start

set ruler                           " show line and column number
syntax on               " syntax highlighting
set showcmd             " show (partial) command in status line
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-15T23:42:29.143

对于更高级的 python 编辑考虑安装[simplefold](http://eigenclass.org/hiki/simplefold) vim 插件。它允许您使用正则表达式进行高级代码折叠。我用它来折叠我的类和方法定义以便更快地编辑。

# image - 创建网页缩略图的最佳方法是什么？

> ID：65078
> 
> 赞同：8
> 
> 时间：2008-09-15T17:48:41.363
> 
> 标签：image, thumbnails

是否有一些合理的跨平台方法来创建给定 URL 的缩略图？我知道有缩略图网络服务可以做到这一点，但我想要一个软件或库可以在本地做到这一点。我想在 Linux 中我总是可以使用无头 X 服务器生成浏览器窗口，但是 Windows 或 OS X 呢？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-15T18:18:24.617

您可以将 Firefox 或 XULRunner 与一些相当简单的 XUL 一起使用，以将缩略图创建为 PNG 数据 URL（如果需要，您可以随后将其写入文件）。罗伯特奥卡拉汉在这里有一些很好的信息：

[http://weblogs.mozillazine.org/roc/archives/2005/05/rendering_web_p.html](http://weblogs.mozillazine.org/roc/archives/2005/05/rendering_web_p.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-15T18:05:17.660

我知道你说过你希望服务是本地的，但是......如果你必须连接到互联网才能截取屏幕截图，你应该同样可以访问网络服务。这样做似乎比向本地截屏的跨平台问题敞开心扉更好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T18:13:25.127

有许多商业软件包可以满足您的需求。我不确定是否需要免费阅读您的问题。但这里有一些我发现的应用程序价格合理，并且完全符合您的要求。我自己没有使用过它们，但它们提供免费试用下载，因此您可以在购买前进行评估。

*   [关明软件的 HTML 到图像](http://www.guangmingsoft.net/htmltoimage/help.htm)- 在 Linux 和 Windows 上运行
*   [来自 SysImage 的 HTML2Image](http://www.sysimage.com/windows/html2image/) - 在 Windows 上运行
*   [Tooto 的 HTML2Image](http://www.tooto.com/html2image/) - 在 Windows 上运行
*   [从 FrameworkTeam 将 HTML 转换为图像](http://www.converthtmltoimage.com/)- Windows 命令行工具

# php - 使 PHP 对象表现得像一个数组？

> ID：65091
> 
> 赞同：23
> 
> 时间：2008-09-15T17:50:04.590
> 
> 标签：php, arrays, oop

我希望能够编写一个行为类似于数组并使用普通数组语法进行获取和设置的 PHP 类。

例如（其中 Foo 是我制作的 PHP 类）：

```
$foo = new Foo();

$foo['fooKey'] = 'foo value';

echo $foo['fooKey']; 
```

我知道 PHP 有 _get 和 _set 魔术方法，但它们不允许您使用数组表示法来访问项目。Python 通过重载 __getitem__ 和 __setitem__ 来处理它。

有没有办法在 PHP 中做到这一点？如果它有所作为，我正在运行 PHP 5.2。

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-09-15T17:54:56.060

如果您扩展`ArrayObject`或实施`ArrayAccess`，那么您可以做您想做的事。

*   [数组对象](http://php.net/arrayobject)
*   [数组访问](http://php.net/arrayaccess)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-05-13T01:17:06.350

不，强制转换只会导致一个普通的 PHP 数组——失去 ArrayObject 派生类所具有的任何功能。看一下这个：

```
class CaseInsensitiveArray extends ArrayObject {
    public function __construct($input = array(), $flags = 0, $iterator_class =     'ArrayIterator') {
        if (isset($input) && is_array($input)) {
            $tmpargs = func_get_args();
            $tmpargs[0] = array_change_key_case($tmpargs[0], CASE_LOWER);
            return call_user_func_array(array('parent', __FUNCTION__), $tmp    args);
        }
        return call_user_func_array(array('parent', __FUNCTION__), func_get_args());
    }

    public function offsetExists($index) {
        if (is_string($index)) return parent::offsetExists(strtolower($index));
        return parent::offsetExists($index);
    }

    public function offsetGet($index) {
        if (is_string($index)) return parent::offsetGet(strtolower($index));
        return parent::offsetGet($index);
    }

    public function offsetSet($index, $value) {
        if (is_string($index)) return parent::offsetSet(strtolower($index, $value));
        return parent::offsetSet($index, $value);
    }

    public function offsetUnset($index) {
        if (is_string($index)) return parent::offsetUnset(strtolower($index));
        return parent::offsetUnset($index);
    }
}

$blah = new CaseInsensitiveArray(array(
    'A'=>'hello',
    'bcD'=>'goodbye',
    'efg'=>'Aloha',
));

echo "is array: ".is_array($blah)."\n";

print_r($blah);
print_r(array_keys($blah));

echo $blah['a']."\n";
echo $blah['BCD']."\n";
echo $blah['eFg']."\n";
echo $blah['A']."\n"; 
```

正如预期的那样，array_keys() 调用失败。此外，is_array($blah) 返回 false。但是，如果您将构造函数行更改为：

```
$blah = (array)new CaseInsensitiveArray(array( 
```

那么你只得到一个普通的 PHP 数组（is_array($blah) 返回 true，并且 array_keys($blah) 有效），但是 ArrayObject 派生的子类的所有功能都丢失了（在这种情况下，不区分大小写的键不再工作）。尝试以两种方式运行上述代码，您就会明白我的意思。

PHP 应该提供一个本机数组，其中的键不区分大小写，或者使 ArrayObject 可以转换为数组而不会丢失子类实现的任何功能，或者只是让所有数组函数接受 ArrayObject 实例。

# mysql - 归档实时 MySQL 数据库的最佳方式

> ID：65093
> 
> 赞同：27
> 
> 时间：2008-09-15T17:50:23.780
> 
> 标签：mysql, database

我们有一个实时的 MySQL 数据库，它是 99% 的 INSERT，大约每秒 100 次。我们希望每天归档数据，以便我们可以在不影响主实时数据库的情况下对其运行查询。此外，一旦归档完成，我们要清除实时数据库。

没有（如果可能）锁定插入的最佳方法是什么？我们对查询使用 INSERT DELAYED。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-15T18:18:42.773

[http://www.maatkit.org/](http://www.maatkit.org/)有 mk-archiver

> 将表中的行归档或清除到另一个表和/或文件。它旨在有效地“蚕食”非常小的数据块，而不会干扰关键在线事务处理 (OLTP) 查询。它通过一个非回溯查询计划来实现这一点，该计划在查询之间保持其在表中的位置，因此每个后续查询几乎不需要做任何工作来查找更多可归档的行。

另一种选择是每天简单地创建一个新的数据库表。MyIsam 确实有一些优势，因为插入到表末尾通常不会阻塞，并且有一种合并表类型可以将它们全部重新组合在一起。许多网站将 httpd 流量记录到这样的表中。

在 Mysql 5.1 中，也有分区表可以做很多相同的事情。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-19T16:49:34.250

我使用mysql分区表，我在各个方面都取得了很好的成绩。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-16T16:20:12.333

听起来复制是最好的解决方案。在初始同步之后，slave 通过[Binary Log](http://dev.mysql.com/doc/refman/5.0/en/binary-log.html)获取更新，因此根本不会影响 master DB。

[更多关于复制。](http://dev.mysql.com/doc/refman/5.0/en/replication.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-07-09T00:41:53.640

MK-ARCHIVER 是一个优雅的工具来归档 MYSQL 数据。

[http://www.maatkit.org/doc/mk-archiver.html](http://www.maatkit.org/doc/mk-archiver.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T00:13:56.370

MySQL 复制可以完美地解决这个问题。
Master -> 实时服务器。
从站 -> 同一网络上的不同服务器。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-15T17:57:25.010

你能保留两个镜像数据库吗？写一个，将第二个保存为档案。每隔 24 小时（或您认为合适的时间）切换一次。在作为存档的数据库中，插入今天的所有活动。那么这两个数据库应该匹配。将其用作新的实时数据库。获取存档的数据库并对其执行任何操作。您可以备份/提取/读取所有您想要的内容，因为它没有被主动写入。

它有点像镜像RAID，您可以将一个驱动器脱机进行备份，重新同步它，然后取出另一个驱动器进行备份。

# timer - 组装CPU测频算法

> ID：65095
> 
> 赞同：17
> 
> 时间：2008-09-15T17:50:31.533
> 
> 标签：timer, system, cpu, assembly

测量处理器频率的常用算法有哪些？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-15T18:20:47.183

Core Duo 之后的 Intel CPU 支持两个特定于型号的寄存器，称为 IA32_MPERF 和 IA32_APERF。
MPERF 以 CPU 支持的最大频率计数，而 APERF 以实际当前频率计数。

实际频率由下式给出：

![频率 = 最大频率 * APERF / MPERF](https://chart.apis.google.com/chart?cht=tx&chl=%5CLARGE%5C%21freq%20%3D%20%5Cfrac%7Bmax%20frequency%20%5Ccdot%20APERF%7D%7BMPERF%7D)

您可以使用此流程阅读它们

```
; read MPERF
mov ecx, 0xe7
rdmsr
mov mperf_var_lo, eax
mov mperf_var_hi, edx

; read APERF
mov ecx, 0xe8
rdmsr
mov aperf_var_lo, eax
mov aperf_var_hi, edx 
```

但请注意，rdmsr 是一条特权指令，只能在 ring 0 中运行。

我不知道操作系统是否提供了读取这些的接口，尽管它们的主要用途是用于电源管理，因此它可能不提供这样的接口。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-23T00:16:38.667

我将在这个答案中用各种细节与自己约会，但到底是什么......

几年前我不得不在基于 Windows 的 PC 上解决这个问题，所以我处理的是 Intel x86 系列处理器，如 486、Pentium 等。这种情况下的标准算法是执行一长串 DIVide 指令，因为这些指令通常是 Intel 集中受 CPU 限制最多的单条指令。因此内存预取和其他架构问题不会对指令执行时间产生实质性影响——预取队列总是满的，并且指令本身不会触及任何其他内存。

您可以使用在您运行的环境中可以访问的最高分辨率时钟对其进行计时。（在我的情况下，我在兼容 PC 的启动时间附近运行，所以我直接在主板上对定时器芯片进行编程。不是推荐在真正的操作系统中，通常这些天有一些适当的 API 可以调用）。

您必须处理的主要问题是不同的 CPU 类型。当时有英特尔、AMD 和一些较小的供应商（如 Cyrix）制造 x86 处理器。相对于 DIV 指令，每个模型都有自己的性能特征。我的汇编计时函数只会返回一定数量的 DIV 指令在紧密循环中完成的时钟周期数。

因此，我所做的是从运行我想要计时的每个处理器型号的实际 PC 中收集一些计时（来自该函数的原始返回值），并根据已知的处理器速度和处理器类型将这些计时记录在电子表格中。实际上，我有一个命令行工具，它只是我的计时功能的一个薄壳，我会将磁盘放入计算机商店并从显示模型中获取计时！（当时我在一家很小的公司工作）。

使用这些原始时序，我可以绘制一个理论图表，说明在该特定 CPU 的任何已知速度下我应该获得什么时序。

诀窍是：我总是讨厌你运行一个实用程序，它会宣布你的 CPU 是 99.8 Mhz 或其他什么。显然它是 100 Mhz，测量中只有一个小的舍入误差。在我的电子表格中，我记录了每个处理器供应商销售的实际速度。然后我会使用实际时间图来估计任何已知速度的预计时间。但我会沿着线建立一个点表，在这些点上时间应该四舍五入到下一个速度。

换句话说，如果 100 个滴答声进行所有重复划分意味着 500 Mhz，而 200 个滴答声意味着 250 Mhz，那么我将建立一个表格，说明低于 150 的任何东西都是 500 Mhz，高于 150 的任何东西都是 250 Mhz。（假设这是该芯片供应商提供的仅有的两种速度）。这很好，因为即使 PC 上的一些奇怪的软件会影响我的时间，最终结果通常仍然是死机。

当然，现在，在超频、电源管理的动态时钟速度和其他此类技巧的时代，这样的方案将不太实用。至少在运行计时功能之前，您需要先确保 CPU 处于其最高动态选择的速度。

好的，我现在回去把孩子们从我的草坪上赶走。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-26T09:06:03.213

自 Pentium 以来，x86 Intel CPU 上的一种方法是使用 RDTSC 指令的两个采样，并使用已知壁时间的延迟循环，例如：

```
#include <stdio.h>
#include <stdint.h>
#include <unistd.h>

uint64_t rdtsc(void) {
    uint64_t result;
    __asm__ __volatile__ ("rdtsc" : "=A" (result));
    return result;
}

int main(void) {
    uint64_t ts0, ts1;    
    ts0 = rdtsc();
    sleep(1);
    ts1 = rdtsc();    
    printf("clock frequency = %llu\n", ts1 - ts0);
    return 0;
} 
```

（在带有 GCC 的 32 位平台上）

如果设置了 CR4 中的 TSC 标志，RDTSC 在 ring 3 中可用，这很常见但不能保证。这种方法的一个缺点是它很容易受到频率缩放变化的影响，如果它们发生在延迟之内，则会影响结果。为了缓解这种情况，您可以执行使 CPU 保持忙碌的代码并不断轮询系统时间以查看您的延迟期是否已过期，以使 CPU 保持在可用的最高频率状态。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-08-05T09:07:00.250

我使用以下（伪）算法：

```
basetime=time();    /* time returns seconds */

while (time()==basetime);
stclk=rdtsc();    /* rdtsc is an assembly instruction */

basetime=time();
while (time()==basetime
endclk=rdtsc();

nclks=encdclk-stclk; 
```

此时，您可能会假设您已经确定了时钟频率，但即使它看起来正确，也可以改进。

所有 PC 都包含一个 PIT（可编程间隔定时器）设备，其中包含（曾经）用于串行端口和系统时钟的计数器。它的馈电频率为 1193182 Hz。系统时钟计数器设置为最高倒计时值 (65536)，导致系统时钟滴答频率为 1193182/65536 => 18.2065 Hz 或每 54.925 毫秒一次。

因此，时钟递增到下一秒所需的滴答数将取决于。通常需要 18 个刻度，有时需要 19 个刻度。这可以通过执行算法（如上）两次并存储结果来处理。这两个结果将等于两个 18 滴答序列或一个 18 和一个 19。不会出现连续两个 19。因此，通过取两个结果中较小的一个，您将获得 18 个滴答秒。通过乘以 18.2065 并除以 18.0 或使用整数运算，乘以 182065，加 90000 并除以 180000 来调整此结果。90000 是 180000 的一半，用于舍入。如果您选择使用整数路由进行计算，请确保您使用的是 64 位乘法和除法。

您现在将拥有一个以 Hz 为单位的 CPU 时钟速度 x，它可以转换为 kHz ((x+500)/1000) 或 MHz ((x+5000000)/1000000)。500 和 500000 分别是 1000 和 1000000 的二分之一，用于四舍五入。计算 MHz 不要通过 kHz 值，因为可能会出现舍入问题。使用 Hz 值和第二种算法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-15T17:59:15.410

这就是[BogoMIPS](http://en.wikipedia.org/wiki/BogoMips)之类的东西的意图，但现在 CPU 复杂得多。超标量 CPU 可以在每个时钟发出多条指令，从而使基于时钟周期计数的任何测量都非常不准确。

CPU 频率也会根据提供的负载和/或温度而变化。CPU 当前以 800 MHz 运行的事实并不意味着它将始终以 800 MHz 运行，它可能会根据需要调高或调低。

如果确实需要知道时钟频率，应该作为参数传入。板上的 EEPROM 将提供基本频率，如果时钟可以变化，您需要能够读取 CPU 电源状态寄存器（或进行操作系统调用）以找出当时的频率。

尽管如此，可能还有其他方法可以完成您想要做的事情。例如，如果您想对特定代码路径花费多长时间进行高精度测量，CPU 可能具有以固定频率运行的性能计数器，这比读取滴答计数寄存器更好地测量挂钟时间。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-27T09:50:29.673

“lmbench”为不同架构提供可移植的cpu频率算法。

它运行一些不同的循环，处理器的时钟速度是各种循环执行频率的最大公约数。

当我们能够获得具有相对质数的循环计数时，此方法应该始终有效。

[http://www.bitmover.com/lmbench/](http://www.bitmover.com/lmbench/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2020-04-25T16:44:08.093

在 Intel CPU 上，获取当前（平均）CPU 频率的常用方法是从几个 CPU 计数器计算它：

```
CPU_freq = tsc_freq * (aperf_t1 - aperf_t0) / (mperf_t1 - mperf_t0) 
```

[TSC](https://en.wikipedia.org/wiki/Time_Stamp_Counter)（时间戳计数器）可以使用专用的 x86 指令从用户空间读取，但其频率必须通过时钟校准来确定。最好的方法是[从内核](https://stackoverflow.com/a/57835630/427158)（已经完成校准）获取 TSC 频率。

aperf 和 mperf 计数器是特定于模型的寄存器[MSR](https://en.wikipedia.org/wiki/Model-specific_register)，需要 root 权限才能访问。同样，有专门的 x86 指令用于访问 MSR。

由于 perf 计数器速率与 TSC 速率成正比，而 aperf 速率与 CPU 频率成正比，您可以通过上述等式得到 CPU 频率。

当然，如果 CPU 频率在您的`t0 - t1`时间增量中发生变化（例如由于频率缩放），您可以使用此方法获得平均 CPU 频率。

我写了一个小工具[cpufreq](https://github.com/gsauthof/utility/blob/master/cpufreq.py)可以用来测试这个方法。

也可以看看：

*   [[PATCH] x86：使用 APERF/MPERF 计算 MHz，用于 cpuinfo 和 scaling_cur_freq。2016-04-01, LKML](https://lore.kernel.org/lkml/52f711be59539723358bea1aa3c368910a68b46d.1459485198.git.len.brown@intel.com/)
*   [x86 的频率不变利用率跟踪。2020-04-02, LWN.net](https://lwn.net/Articles/816388/)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-10-16T00:20:06.993

一种选择是通过在每个循环中运行具有已知指令的代码来检测 CPU 频率

这个功能包含在 7zip 中，因为我认为大约是 v9.20。

```
> 7z b
7-Zip 9.38 beta  Copyright (c) 1999-2014 Igor Pavlov  2015-01-03

CPU Freq:  4266  4000  4266  4000  2723  4129  3261  3644  3362 
```

最终数字应该是正确的（在我的 PC 和许多其他设备上，我发现它非常正确 - 测试运行得非常快，因此 turbo 可能无法启动，并且设置为平衡/省电模式的服务器很可能会给出1GHz左右的读数）

源代码在[GitHub](https://github.com/jljusten/LZMA-SDK/blob/master/CPP/7zip/UI/Common/Bench.cpp)（官方源是从 7-zip.org 下载）

最重要的部分是：

```
#define YY1 sum += val; sum ^= val;
#define YY3 YY1 YY1 YY1 YY1
#define YY5 YY3 YY3 YY3 YY3
#define YY7 YY5 YY5 YY5 YY5
static const UInt32 kNumFreqCommands = 128;

EXTERN_C_BEGIN

static UInt32 CountCpuFreq(UInt32 sum, UInt32 num, UInt32 val)
{
  for (UInt32 i = 0; i < num; i++)
  {
    YY7
  }
  return sum;
}

EXTERN_C_END 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-07T02:04:12.200

[在AMD](http://www.amd.com/us-en/Processors/ProductInformation/0,,30_118_6291_965%5E871%5E2364,00.html)和[Intel](http://www.intel.com/assets/pdf/appnote/241618.pdf)上的快速谷歌显示 CPUID 应该可以让您访问 CPU 的最大频率。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-15T17:57:34.620

我不确定你为什么需要为此组装。如果您在具有 /proc 文件系统的机器上，则运行：

```
> cat /proc/cpuinfo 
```

可能会给你你需要的东西。

# com - Windows Server 2008：COM 错误：0x800706F7 - 存根收到错误数据

> ID：65097
> 
> 赞同：4
> 
> 时间：2008-09-15T17:50:41.343
> 
> 标签：com, windows-server-2008

我正在评估 Server 2008。我的 C++ 可执行文件出现此错误。我在 MSDN 上看到了这个错误，似乎需要对以前的几个操作系统进行热修复。还有人看到这个吗？对于 32 位和 64 位操作系统，我得到了相同的结果。

代码片段：

```
HRESULT GroupStart([in] short iClientId, [in] VARIANT GroupDataArray,
    [out] short* pGroupInstance, [out] long* pCommandId); 
```

其中 GroupDataArray VARIANT 参数包装了一维 SAFEARRAY 的 VARIANT 包装 DCAPICOM_GroupData 结构条目：

```
// DCAPICOM_GroupData
[
      uuid(F1FE2605-2744-4A2A-AB85-1E1845C280EB),
      helpstring("removed")
]

typedef struct DCAPICOM_GroupData {
      [helpstring("removed")]
      long              m_lImageID;

      [helpstring("removed")]
      unsigned char     m_ucHeadID;

      [helpstring("removed")]
      unsigned char     m_ucPlateID;
} DCAPICOM_GroupData; 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T17:16:37.383

在向 Microsoft 提出支持案例后，我现在可以回答我自己的问题了。这是（现在）一个公认的**错误**。该问题与服务器端的编组有关，但在调用服务器代码之前。我们的结构是 6 字节长，但这个 COM 实现将其解释为 8，因此编组失败，这是您返回的错误。在发布 Service Pack 来处理此问题之前，解决方法是向结构添加两个额外字节以将其填充到 8 个字节。我们还没有遇到任何失败的实例，但我们仍然有很多测试要做。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-15T19:59:03.250

我们最近在通过 DCOM 通信的客户端/服务器应用程序中遇到了同样的错误。事实证明，通过线路（即，非本地）的编组接口指针的大小已经改变（变得更大）。您可能想检查您的代码是否通过 CoMarshalInterface 等进行任何特殊编组。

# javascript - MVC验证，会不会和其他JS框架冲突？

> ID：65119
> 
> 赞同：0
> 
> 时间：2008-09-15T17:53:05.893
> 
> 标签：javascript, asp.net-mvc, validation

如果我想使用可以与 ASP.NET MVC 一起使用的验证框架，JavaScript 会与 jQuery 或 YUI 等其他 JavaScript 框架冲突吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T07:25:45.753

不，它不会。目前，ASP.NET MVC 没有固有的验证框架。因此，您可以随意使用任何服务器/客户端验证框架。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-15T18:21:15.140

有许多 MVC 框架。有许多 JavaScript 框架具有不同的功能。如果你想要一个有意义的答案，你应该选择一个 MVC 和一个 JavaScript 框架并询问这两者。请在您的问题中尽可能详细。

例如，ActiveRecord（在 Ruby on Rails 中使用）上的验证处理仅在服务器端执行验证。您始终可以在此基础上添加 JavaScript 验证，但服务器端验证对于数据完整性来说才是真正重要的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-06T16:50:08.007

我很确定 Haacked 正在谈论此处显示的 ASP.NET MVC 验证：
[ScottGu 的博客 - ASP.NET MVC Preview 5 and Form Posting Scenarios](http://weblogs.asp.net/scottgu/archive/2008/09/02/asp-net-mvc-preview-5-and-form-posting-scenarios.aspx)

如果是这种情况，那么答案是：是的，您可以将 JQuery 与此结合使用。
链接页面上的多个评论谈论使用 JQuery for Ajax。

# java - 追踪文件句柄

> ID：65128
> 
> 赞同：2
> 
> 时间：2008-09-15T17:54:04.613
> 
> 标签：java, logging, file, jakarta-ee, websphere

我有一个使用 log4j 的大耳朵，并且有一个用于设置它的配置文件。在这个配置文件中没有提到某些日志文件，但是除了配置文件中指定的文件之外的其他文件会在日志文件夹中生成。我搜索了 (logger|log4j|log).(properties|xml) 的其他组合，但在耳朵中包含的所有 jar 文件中都没有发现任何有希望的东西。我如何追踪创建这些额外文件的有问题的线程/类？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-15T18:49:00.237

尝试在 File 类的构造函数以及 mkdir 和 createNewFile 方法中放置一个断点。通常，代码将使用 File 类来创建其文件或目录。您的 JVM 中应该包含这些类的 Java 源代码。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-15T19:27:25.730

添加`-Dlog4j.debug`到命令行，标准输出中将有关于如何配置的额外信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T18:01:59.600

正式的 SysInternal，现在是 Microsoft 的 Process Explorer [http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)

“查找”菜单项 -> “查找句柄或 DLL...”

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T18:11:48.937

SysInternals 可能对 Java 类 IO 没有帮助。尝试在写入这些日志时获取 JVM 的线程转储（例如，kill -3）。您应该能够在堆栈跟踪顶部附近使用 java.io 包捕获线程。

# jquery - 一起使用 ASP.Net AJAX 和 JQuery 的任何缺点

> ID：65129
> 
> 赞同：12
> 
> 时间：2008-09-15T17:54:10.040
> 
> 标签：jquery, asp.net-ajax

我们计划使用 jQuery 库来增加我们的客户端 JavaScript 需求。

尝试同时使用 ASP.Net AJAX 和 jQuery 是否有任何重大问题？这两个库似乎都将 $ 用于特殊目的。有没有我们需要注意的冲突？

我们还使用使用 ASP.Net AJAX 的 Telerik 控件。

TIA

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-15T18:45:12.883

我们在一个大型项目中使用 ASP.NET Ajax、jQuery 和 Telerik 组件已经有一段时间了，并且没有遇到任何问题

我肯定会推荐使用 jQuery

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-15T18:02:14.063

jQuery 有一个 noConflict() 方法作为核心的一部分，但它要求您使用 jQuery 作为您的命名函数或您选择的其他东西（而不是美元选择器）。但是，我会说该方法通常依赖于“竞争”库的实现。我曾尝试将它用于 Ning 社交网络（使用 Dojo）和 Magento（使用 Prototype），但我无法正确使用 jQuery。这只是我个人的经验，其他人都非常成功。

[http://docs.jquery.com/Core/jQuery.noConflict](http://docs.jquery.com/Core/jQuery.noConflict)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-15T22:47:41.660

ASP.NET Ajax 的开发人员采取了特定的步骤来确保该库可以与 jQuery 结合使用。

例如，ATLAS CTP（成为 ASP.NET Atlas 的测试版）曾经有一个 $() 函数，但它被删除并替换为 $get()。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-15T23:22:55.633

一个缺点是服务器端控件可以重命名，具体取决于它们的容器。例如，您可能有：

```
<asp:panel id="panel1" runat="server"></asp:panel> 
```

这可以在页面上呈现为：

```
<div id="ctl00$panel1"></div> 
```

因此，如果您使用`$('#panel1')`选择器编写 jQuery，它将无法正常工作。解决这个问题的方法是动态生成 id，例如：

```
 Dim js as String = "$('" & panel1.ClientID & "').whatever();" 
```

这会使 javascript 有点不可读，但它确实工作得很好。我使用这种方法在一个大型 Web 应用程序上工作，jQuery 为我们节省了大量时间，更不用说让网站看起来和工作得更好了。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-16T23:05:20.800

无论如何，jQuery 的 $ 函数和 ASP.NET AJAX 的 $ 前缀快捷函数（$get、$find、$create 等）之间没有冲突。就像使用变量**f**一样，不会阻止您使用名为 foo 的**变量**。

在大多数情况下，jQuery 和 ASP.NET AJAX 可以很好地协同工作。在过去的一年中，我唯一一次看到 ASP.NET AJAX 破坏 jQuery 代码是[使用 jDrawer 的这种场景](http://forums.asp.net/t/1313299.aspx)。不过，解决方法还不错。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-15T22:53:39.510

我一直在使用 ext，这是另一个带有 .net 的 javascript 框架。它比老式的 HTML 表单控件更容易使用

```
<input type="text" id="whatever" /> 
```

比使用 ASP.net 表单控件。您可能想使用很酷的 javascript 框架表单验证，而不是不太好的内置 .net 验证器，但我想这取决于您的偏好

如果您确实想继续使用 .net 控件，请记住标记中生成的 ID 与您定义的不同，因此如果您想在 JS 中通过 id 引用控件，请使用：

```
<%=MyControlId.ClientID%> 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-29T21:16:43.910

与此问题相关的最新进展：

Scott Guthrie 在 2008 年 9 月 28 日发布（参见：[http](http://weblogs.asp.net/scottgu/archive/2008/09/28/jquery-and-microsoft.aspx) ://weblogs.asp.net/scottgu/archive/2008/09/28/jquery-and-microsoft.aspx ），微软实际上将**开始使用 Visual Studio 发布 JQuery**。MVC 项目将默认包含该库。Scott 表示这是在 JQuery 团队的同意和鼓励下完成的。

请参阅原始帖子以获取[完整详细信息](http://weblogs.asp.net/scottgu/archive/2008/09/28/jquery-and-microsoft.aspx)。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-23T11:33:35.147

显然，Telerik 已经开始将 jQuery 添加到他们的一些 RadControls 中，从发布 Q3 开始。

我同时使用 jQuery 和 RadControls，但没有时间进一步研究这种纠缠......可以双向摆动......
我有一种普遍的感觉，这需要更多的 clusterf ***，但这只是基于根据对其中一些和一点点的一般经验；-)

在 Telerik 上查看 Atanas Korchev 关于这个主题的博客：http:
[//blogs.telerik.com/AtanasKorchev/Posts/08-11-06/ASP_NET_Ajax_Controls_and_jQuery.aspx](http://blogs.telerik.com/AtanasKorchev/Posts/08-11-06/ASP_NET_Ajax_Controls_and_jQuery.aspx)

当 MS、jQuery、Telerik、JP Morgan 和 McDonalds 都在我们的桌面上混杂在一起时，祝我们所有人好运...... ;-)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-15T00:10:17.043

我已经将 jQuery 与 ASP.NET Ajax 一起使用，因为它们都可以很好地完成不同的事情。我从来没有遇到过将两者一起使用的问题。事实上，我通过使用超级强大的 jQuery 选择器绕过了奇怪的 ASP.NET id mishmash。通过能够选择元素的类和子元素（基本上是 CSS），它非常易于使用。

# c++ - Internet Explorer 在什么情况下无法正确卸载 ActiveX 控件？

> ID：65133
> 
> 赞同：1
> 
> 时间：2008-09-15T17:54:52.690
> 
> 标签：c++, internet-explorer, internet-explorer-6, activex, atl

我正在编写的 ActiveX 控件遇到了一个令人困惑的问题 - 有时，Internet Explorer 似乎无法在进程关闭时正确卸载控件。这导致不调用控件实例的析构函数。

该控件是用 C++ 编写的，使用 ATL 并使用 Visual Studio 2005 编译。当用户浏览远离嵌入控件的页面时，始终调用控件实例的析构函数 - 只有在关闭浏览器时才会出现问题。

当我在调试器下运行 IE 时，我没有看到任何异常 - 调试器没有捕获任何异常、访问冲突或断言失败，但问题仍然存在 - 我可以在控件的析构函数中设置断点，它永远不会当我关闭浏览器时点击。

此外，当我加载一个嵌入多个控件实例的简单 HTML 页面时，我看不到问题。该问题仅在从我们的 Web 应用程序实例化控件时才会出现，该应用程序将标签动态插入到网页中 - 当然，不知道是什么导致了这个问题，我不知道这部分信息是否相关，但它似乎表明这可能是一个 IE 问题，因为它依赖于数据。

当我在调试器下运行简单的测试用例时，我可以在控件的析构函数中设置一个断点，并且每次都会命中它。我相信这排除了控件本身的问题（例如，会阻止调用析构函数的错误，例如接口泄漏。）

我使用 IE 6 进行了大部分测试，但我也看到 IE 7 上也出现了问题。我还没有测试过 IE 8。

我现在的工作假设是动态 HTML 代码中的某些内容会导致浏览器泄漏 ActiveX 控件上的界面。到目前为止，我还没有能够在应用程序之外生成一个好的测试用例来重现这个，而且应用程序有点太大而无法制作一个好的测试用例。

我希望有人能够深入了解可能导致这种行为的 IE 错误。顺便说一句，下面提供的答案太笼统了——我正在寻找一组已知会导致这种情况的特定情况。肯定有人以前见过这个。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-16T03:18:29.513

要使用 C++ 调试 COM 中未调用对象 (C++) 析构函数的问题，最好的方法是关注 COM 对象的引用计数如何递增或递减。可能发生的情况是有人将 refcount 增加了太多次，然后没有减少相同的次数。这导致对象未被释放。

您的动态 HTML 可能只是在 IE 中显示了一个错误，而如果您使用静态页面则不会发生这种情况。

如果 IE 中存在错误，诀窍是找出导致错误出现的原因，以及您可以采取哪些措施来诱使 IE 正确释放您的 COM 对象（例如，使 HTML 消失）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-03T02:46:57.557

另一种方法 - 将清理代码添加到您的[DllMain](http://msdn.microsoft.com/en-us/library/ms682583.aspx)函数（如果该函数尚不存在，则添加该函数）。然后不管引用计数（和引用计数错误），当你的 DLL 被卸载时，你可以清理自己：

```
BOOL WINAPI DllMain(HINSTANCE, DWORD dwReason, LPVOID) {
    if (dwReason == DLL_PROCESS_DETACH) {
        CleanUpAnyObjectsStillAlive();
    }
} 
```

哦，还有一点警告 - 不要花太长时间进行清理 - 如果你这样做了，我不能保证进程关闭无论如何都不会杀死你。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T13:03:15.537

我有同样的问题，但只在特定的计算机上。这台计算机的 Flash ActiveX 也有问题，关闭选项卡后它仍然存在。我的猜测是问题不在于您的代码。其他电脑有这个问题吗？

# svn - 如何加快 SVN 更新速度？

> ID：65135
> 
> 赞同：30
> 
> 时间：2008-09-15T17:54:55.327
> 
> 标签：svn, tortoisesvn

我们有一个相当大的 SVN 存储库。我们添加的代码越多，进行 SVN 更新所花费的时间就越长。我们添加`svn:externals`到在一些项目中重复的文件夹中，例如各种网站上的[FCKeditor](http://en.wikipedia.org/wiki/CKEditor)。这有帮助，但没有那么多。

减少更新时间和提高 SVN 速度的最佳方法是什么？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-15T18:09:32.250

如果它是一个较旧的 SVN 存储库（或者甚至是相当新的，但没有以最佳方式设置），它可能使用较旧的 BDB 存储库数据库样式。 [http://svn.apache.org/repos/asf/subversion/trunk/notes/fsfs](http://svn.apache.org/repos/asf/subversion/trunk/notes/fsfs)有关于新的注释。从一个转换到另一个并不难 - 转储整个历史记录，使用新的 svn 文件系统格式重新初始化并重新导入。同时过滤 repo-dump 以删除无用信息的整个签入可能也很有用（例如，我删除了某人签入的 20MB+ tarball 文件）。

就一般速度而言 - 质量（快速）的硬盘驱动器和基于操作系统的缓存的额外内存在提高 SVN 的工作速度方面很难出错。

在客户端，如果您通过 PuttyAgent 设置了 tortoisesvn 以通过 SSH 访问外部存储库机器，您还可以启用 SSH 压缩，这也有帮助。

**编辑：** SVN v1.5 还具有[fsfs-reshard.py](http://svnbook.red-bean.com/en/1.5/svn.reposadmin.maint.html#svn.reposadmin.maint.tk.fsfsreshard)工具，它可以帮助将基于 FSFS 的 svn 存储库拆分为多个目录 - 这些目录本身可以链接到不同的驱动器主轴。如果您有数千个修订版，那也会有所帮助 - 如果没有其他原因，只是在数千个文件中查找一个文件需要时间（并且您可以通过查看 IOwait 时间来判断这是否是一个问题）

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2010-02-02T22:35:01.610

禁用对包含工作副本代码的文件夹的病毒检查。这导致我的更新速度提高了一倍。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-15T18:07:53.737

不是一个真正的答案，但知道 svn 如此 I/O 繁重的原因之一是它在 .svn/text-base 目录中存储了每个文件的一个额外副本，这可能会很有趣。这使得本地差异操作快速，但会占用大量硬盘空间和 I/O。

[http://subversion.tigris.org/issues/show_bug.cgi?id=525](http://subversion.tigris.org/issues/show_bug.cgi?id=525)有详细信息。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-15T17:57:04.713

听起来您在一个存储库中有多个项目。在适当的地方将它们分开会给你带来很大的提升。

据推测，由于它存储/处理更改的方式，Git 比 Subversion 快得多，但我没有第一手经验。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-15T17:59:45.333

有一些常见的性能调整。SVN 的 I/O 非常繁重，因此可以选择更快的硬盘（在两端）。为您的服务器添加更多内存。确保您的客户端具有碎片整理的硬盘（适用于 Windows）。

您使用什么访问方法也很重要。存储在远程文件系统上的存储库（使用 file:/// 访问）将比使用 mod_svn 的 svnserve 或 Apache 慢得多。如果您在简单文件共享上拥有存储库，请考虑使用后者之一。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-15T18:00:09.200

确保您与服务器的连接速度尽可能快（千兆以太网）。确保服务器在阵列中有快速磁盘。而且，当然，只检查你需要什么。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-15T21:33:35.520

TotoiseSVN 默认在后台查看文件更改，我发现这会降低我的机器速度。我更改了配置以排除所有内容，然后仅包含我有结帐的目录。您也可以关闭背景调查。这两个设置都在 Icon Overlays 设置节点中。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2017-03-20T08:19:07.707

有时缓慢的 svn 操作，尤其是在有许多外部的情况下，是与 DNS 相关的。看起来 svn 执行每个 svn:external 的 DNS 查找，即使是相对的。将您的 svn 服务器主机名添加到 /etc/hosts 或修复 resolv.conf 会很有用。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-15T19:12:16.797

我根据自己的经验（即：不是通过任何*实际*测试）发现，特别是如果 SVN 存储库服务器是远程的，使用外部似乎会减慢速度。如果你在多个地方有重复的代码（比如你的 FCK 编辑器），我会倾向于坚持使用外部，因为保持这些文件同步和可管理比更新速度更重要 - 不过，你可以考虑使用符号链接来带来而是在重复的代码中。（如果您使用的是 Windows XP，则可以使用[junction points](http://technet.microsoft.com/en-us/sysinternals/bb896768.aspx)）。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-15T20:50:12.037

我们将代码库拆分为几个同级模块并编写了 Ant 脚本，这样一位开发人员就可以一次处理一个模块，而不必过多地关心其他模块中发生的事情。

*   顶级构建脚本触发所有模块构建脚本
*   外部库**不**存储在 Subversion 中，而是使用 Apache Ivy 从网络驱动器中提取。（把它想象成一个内部的 Maven 存储库）。
*   模块之间的依赖关系也使用 Ivy 进行管理。

通常，开发人员需要每周更新他们的整个树几次，但在午餐/咖啡休息时间之前很容易完成。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-01-10T10:42:43.110

使用读访问权限（即限制对某些人/组的读访问）会大大降低存储库的速度。特别是当以某种特殊方式进行身份验证时，例如针对 Windows 域。当然，写访问权限也是如此，但写的频率不如读的频繁。限制写访问可能比限制读访问更重要

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-15T18:15:31.690

如果你的仓库根目录有很多文件夹，而你的本地副本反映了仓库，那么尝试将单体本地副本分割成许多单独的可下载文件夹，并分别更新这些文件夹，这将比一个大文件夹快得多。

# java - Java 开源工作流引擎

> ID：65150
> 
> 赞同：6
> 
> 时间：2008-09-15T17:56:50.860
> 
> 标签：java, open-source, workflow

什么是最好的开源 Java 工作流框架（例如 OSWorkflow、jBPM、XFlow 等）？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-15T18:07:22.443

[这是一篇](http://eprints.qut.edu.au/archive/00014320/)比较 kBPM、OpenWFE 和 Enhydra Shark 的文章，看起来它有一些很好的、全面的信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-15T20:35:12.773

这取决于您想要进行什么样的初始投资。jBPM 在功能和灵活性方面是最好的，但 OSWorkflow 更轻量级，更容易启动和运行，并且学习曲线更小。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-12-08T19:35:52.583

[Drools Flow](http://www.jboss.org/drools/drools-flow.html)是我最近遇到的最好的工作流解决方案。它比其他解决方案更好，因为它是最近构建和设计的，并且基于从其他长期存在的、有些过度设计的框架中吸取的经验教训。

Drools Flow 是一个社区项目，连同一个官方的[Drools 5](http://blog.athico.com/2009/05/drools-5-released.html)版本，除了 Flow 之外还包括：Guvnor、Expert 和 Fusion。

不幸的是，Drools Flow 还没有正式的红帽支持合同，这对于一些大公司来说是一个障碍。由于 jBPM 项目生活在同一支持屋檐下，人们可能会认为出于政治原因没有支持。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-31T14:45:42.467

YAWL - 另一种工作流语言 [http://en.wikipedia.org/wiki/YAWL](http://en.wikipedia.org/wiki/YAWL)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T18:00:39.027

我将为 jBPM 投票。我们在内部的一个大型 ETL 平台上使用它，它似乎工作得很好。然而，我没有任何东西可以与之相比。

# wcf - .NET 3.5 中 DateTime 序列化的最佳实践

> ID：65164
> 
> 赞同：22
> 
> 时间：2008-09-15T17:57:51.077
> 
> 标签：wcf, sql-server-2008, datetime, serialization, .net-3.5

大约 4 年前，我关注了这篇[MSDN 文章](http://msdn.microsoft.com/en-us/library/ms973825.aspx)，了解在 .Net 1.1 和 ASMX Web 服务（以 SQL 2000 服务器作为后端）上构建 .Net 客户端的 DateTime 使用最佳实践。我仍然记得我在使用 DateTime 时遇到的序列化问题以及它为不同时区的服务器所做的测试工作。

我的问题是：对于 WCF 和 SQL Server 2008 等一些新技术，是否有类似的最佳实践文档，特别是添加了新的日期时间类型来存储时区感知信息。

这是环境：

1.  太平洋时间的 SQL Server 2008。
2.  不同时区的 Web 服务层。
3.  客户可以在不同的时区使用 .Net 2.0 或 .Net 3.5。如果方便的话，我们可以强制大家升级到.Net 3.5。:)

对于每一层中使用的数据类型有什么好的建议/最佳实践吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-15T18:14:18.043

我认为最好的方法是始终将对象作为 UTC 传递，并在客户端转换为本地时间。通过这样做，所有客户都有一个共同的参考点。

要转换为 UTC，请在 DateTime 对象上调用 ToUniversalTime。然后，在客户端上，调用 ToLocalTime 以获取其当前时区。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-16T20:00:22.413

一个大问题是 WCF 序列化不支持 xs:Date。这是一个大问题，就好像你想要的只是一个日期，你不应该被迫关心时区。以下连接问题讨论了一些问题：[http ://connect.microsoft.com/wcf/feedback/ViewFeedback.aspx?FeedbackID=349215](http://connect.microsoft.com/wcf/feedback/ViewFeedback.aspx?FeedbackID=349215)

如果您想明确表示一个时间点，即不仅仅是日期部分，如果您在客户端和服务器上都有 .NET 3.5，则可以使用 DateTimeOffset 类。或者为了互操作性，始终将日期/时间值作为 UTC 传递。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-16T07:53:31.770

UTC/GMT 在分布式环境中是一致的。

一件重要的事情是在使用数据库中的值填充 DateTime 属性后指定 datetimeKind。

```
dateTimeValueUtcKind = DateTime.SpecifyKind(dateTimeValue, DateTimeKind.Utc); 
```

[见 MSDN](http://msdn.microsoft.com/en-us/library/system.datetime.specifykind.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-15T18:34:59.240

只要您的 Web 服务层和客户端层使用 .NET DateTime 类型，它就应该正确地序列化和反序列化为带有时区信息的 SOAP 标准本地日期/时间，例如：

2008-09-15T13:14:36.9502109-05:00

如果您绝对肯定必须知道时区本身（即上面可能是东部标准时间或中央夏令时间），您需要创建自己的数据类型来公开这些部分：

```
[Serializable]
public sealed class MyDateTime
{
    public MyDateTime()
    {
        this.Now = DateTime.Now;
        this.IsDaylightSavingTime = this.Now.IsDaylightSavingTime();
        this.TimeZone = this.IsDaylightSavingTime
            ? System.TimeZone.CurrentTimeZone.DaylightName
            : System.TimeZone.CurrentTimeZone.StandardName;
    }

    public DateTime Now
    {
        get;

        set;
    }

    public string TimeZone
    {
        get;

        set;
    }

    public bool IsDaylightSavingTime
    {
        get;

        set;
    }
} 
```

那么您的回复将如下所示：

```
<Now>2008-09-15T13:34:08.0039447-05:00</Now>
<TimeZone>Central Daylight Time</TimeZone>
<IsDaylightSavingTime>true</IsDaylightSavingTime> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-15T18:21:13.267

我很幸运，只保留了 DateTime 数据类型并始终将其存储为 GMT。在每一层中，我会将 GMT 值调整为该层的本地值。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-11-30T10:11:46.503

对于日期时间对象应该保持不变的情况，请使用 JsonConvert：

```
DateTime now = DateTime.Now;
string json = JsonConvert.SerializeObject(now);
DateTime nowJson = JsonConvert.DeserializeObject<DateTime>(json); 
```

# c - 如何获取与打开 HANDLE 关联的名称

> ID：65170
> 
> 赞同：15
> 
> 时间：2008-09-15T17:58:21.450
> 
> 标签：c, windows, winapi

在 Win32 中获取与打开的 HANDLE 关联的文件名的最简单方法是什么？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2013-09-13T18:00:13.903

我尝试了 Mehrdad 在这里发布的代码。它有效，但有局限性：

1.  它不应该用于网络共享，因为 MountPointManager 可能会挂起很长时间。
2.  它使用未记录的 API (IOCTL_MOUNTMGR_QUERY_DOS_VOLUME_PATH) 我不太喜欢
3.  它不支持创建虚拟 COM 端口的 USB 设备（我的项目中需要它）

我还研究了其他方法，例如`GetFileInformationByHandleEx()`and `GetFinalPathNameByHandle()`，但这些方法没有用，因为它们只返回 Path + Filename 但没有驱动器。另外`GetFinalPathNameByHandle()`还有挂机bug。

MSDN 中的`GetMappedFileName()`方法（由 Max 在此处发布）也非常有限：

1.  它仅适用于真实文件
2.  文件大小不得为零字节
3.  不支持目录、网络和 COM 端口
4.  代码很笨拙

所以我写了自己的代码。我在 Win XP 和 Win 7、8 和 10 上对其进行了测试。它运行良好。

注意：您不需要任何额外的 LIB 文件来编译此代码！

**CPP文件：**

```
t_NtQueryObject NtQueryObject()
{
    static t_NtQueryObject f_NtQueryObject = NULL;
    if (!f_NtQueryObject)
    {
        HMODULE h_NtDll = GetModuleHandle(L"Ntdll.dll"); // Ntdll is loaded into EVERY process!
        f_NtQueryObject = (t_NtQueryObject)GetProcAddress(h_NtDll, "NtQueryObject");
    }
    return f_NtQueryObject;
}

// returns
// "\Device\HarddiskVolume3"                                (Harddisk Drive)
// "\Device\HarddiskVolume3\Temp"                           (Harddisk Directory)
// "\Device\HarddiskVolume3\Temp\transparent.jpeg"          (Harddisk File)
// "\Device\Harddisk1\DP(1)0-0+6\foto.jpg"                  (USB stick)
// "\Device\TrueCryptVolumeP\Data\Passwords.txt"            (Truecrypt Volume)
// "\Device\Floppy0\Autoexec.bat"                           (Floppy disk)
// "\Device\CdRom1\VIDEO_TS\VTS_01_0.VOB"                   (DVD drive)
// "\Device\Serial1"                                        (real COM port)
// "\Device\USBSER000"                                      (virtual COM port)
// "\Device\Mup\ComputerName\C$\Boot.ini"                   (network drive share,  Windows 7)
// "\Device\LanmanRedirector\ComputerName\C$\Boot.ini"      (network drive share,  Windwos XP)
// "\Device\LanmanRedirector\ComputerName\Shares\Dance.m3u" (network folder share, Windwos XP)
// "\Device\Afd"                                            (internet socket)
// "\Device\Console000F"                                    (unique name for any Console handle)
// "\Device\NamedPipe\Pipename"                             (named pipe)
// "\BaseNamedObjects\Objectname"                           (named mutex, named event, named semaphore)
// "\REGISTRY\MACHINE\SOFTWARE\Classes\.txt"                (HKEY_CLASSES_ROOT\.txt)
DWORD GetNtPathFromHandle(HANDLE h_File, CString* ps_NTPath)
{
    if (h_File == 0 || h_File == INVALID_HANDLE_VALUE)
        return ERROR_INVALID_HANDLE;

    // NtQueryObject() returns STATUS_INVALID_HANDLE for Console handles
    if (IsConsoleHandle(h_File))
    {
        ps_NTPath->Format(L"\\Device\\Console%04X", (DWORD)(DWORD_PTR)h_File);
        return 0;
    }

    BYTE  u8_Buffer[2000];
    DWORD u32_ReqLength = 0;

    UNICODE_STRING* pk_Info = &((OBJECT_NAME_INFORMATION*)u8_Buffer)->Name;
    pk_Info->Buffer = 0;
    pk_Info->Length = 0;

    // IMPORTANT: The return value from NtQueryObject is bullshit! (driver bug?)
    // - The function may return STATUS_NOT_SUPPORTED although it has successfully written to the buffer.
    // - The function returns STATUS_SUCCESS although h_File == 0xFFFFFFFF
    NtQueryObject()(h_File, ObjectNameInformation, u8_Buffer, sizeof(u8_Buffer), &u32_ReqLength);

    // On error pk_Info->Buffer is NULL
    if (!pk_Info->Buffer || !pk_Info->Length)
        return ERROR_FILE_NOT_FOUND;

    pk_Info->Buffer[pk_Info->Length /2] = 0; // Length in Bytes!

    *ps_NTPath = pk_Info->Buffer;
    return 0;
}

// converts
// "\Device\HarddiskVolume3"                                -> "E:"
// "\Device\HarddiskVolume3\Temp"                           -> "E:\Temp"
// "\Device\HarddiskVolume3\Temp\transparent.jpeg"          -> "E:\Temp\transparent.jpeg"
// "\Device\Harddisk1\DP(1)0-0+6\foto.jpg"                  -> "I:\foto.jpg"
// "\Device\TrueCryptVolumeP\Data\Passwords.txt"            -> "P:\Data\Passwords.txt"
// "\Device\Floppy0\Autoexec.bat"                           -> "A:\Autoexec.bat"
// "\Device\CdRom1\VIDEO_TS\VTS_01_0.VOB"                   -> "H:\VIDEO_TS\VTS_01_0.VOB"
// "\Device\Serial1"                                        -> "COM1"
// "\Device\USBSER000"                                      -> "COM4"
// "\Device\Mup\ComputerName\C$\Boot.ini"                   -> "\\ComputerName\C$\Boot.ini"
// "\Device\LanmanRedirector\ComputerName\C$\Boot.ini"      -> "\\ComputerName\C$\Boot.ini"
// "\Device\LanmanRedirector\ComputerName\Shares\Dance.m3u" -> "\\ComputerName\Shares\Dance.m3u"
// returns an error for any other device type
DWORD GetDosPathFromNtPath(const WCHAR* u16_NTPath, CString* ps_DosPath)
{
    DWORD u32_Error;

    if (wcsnicmp(u16_NTPath, L"\\Device\\Serial", 14) == 0 || // e.g. "Serial1"
        wcsnicmp(u16_NTPath, L"\\Device\\UsbSer", 14) == 0)   // e.g. "USBSER000"
    {
        HKEY h_Key; 
        if (u32_Error = RegOpenKeyEx(HKEY_LOCAL_MACHINE, L"Hardware\\DeviceMap\\SerialComm", 0, KEY_QUERY_VALUE, &h_Key))
            return u32_Error;

        WCHAR u16_ComPort[50];

        DWORD u32_Type;
        DWORD u32_Size = sizeof(u16_ComPort); 
        if (u32_Error = RegQueryValueEx(h_Key, u16_NTPath, 0, &u32_Type, (BYTE*)u16_ComPort, &u32_Size))
        {
            RegCloseKey(h_Key);
            return ERROR_UNKNOWN_PORT;
        }

        *ps_DosPath = u16_ComPort;
        RegCloseKey(h_Key);
        return 0;
    }

    if (wcsnicmp(u16_NTPath, L"\\Device\\LanmanRedirector\\", 25) == 0) // Win XP
    {
        *ps_DosPath  = L"\\\\";
        *ps_DosPath += (u16_NTPath + 25);
        return 0;
    }

    if (wcsnicmp(u16_NTPath, L"\\Device\\Mup\\", 12) == 0) // Win 7
    {
        *ps_DosPath  = L"\\\\";
        *ps_DosPath += (u16_NTPath + 12);
        return 0;
    }

    WCHAR u16_Drives[300];
    if (!GetLogicalDriveStrings(300, u16_Drives))
        return GetLastError();

    WCHAR* u16_Drv = u16_Drives;
    while (u16_Drv[0])
    {
        WCHAR* u16_Next = u16_Drv +wcslen(u16_Drv) +1;

        u16_Drv[2] = 0; // the backslash is not allowed for QueryDosDevice()

        WCHAR u16_NtVolume[1000];
        u16_NtVolume[0] = 0;

        // may return multiple strings!
        // returns very weird strings for network shares
        if (!QueryDosDevice(u16_Drv, u16_NtVolume, sizeof(u16_NtVolume) /2))
            return GetLastError();

        int s32_Len = (int)wcslen(u16_NtVolume);
        if (s32_Len > 0 && wcsnicmp(u16_NTPath, u16_NtVolume, s32_Len) == 0)
        {
            *ps_DosPath  =  u16_Drv;
            *ps_DosPath += (u16_NTPath + s32_Len);
            return 0;
        }

        u16_Drv = u16_Next;
    }
    return ERROR_BAD_PATHNAME;
} 
```

**头文件：**

```
#pragma warning(disable: 4996) // wcsnicmp deprecated
#include <winternl.h>

// This makro assures that INVALID_HANDLE_VALUE (0xFFFFFFFF) returns FALSE
#define IsConsoleHandle(h) (((((ULONG_PTR)h) & 0x10000003) == 0x3) ? TRUE : FALSE)

enum OBJECT_INFORMATION_CLASS 
{
    ObjectBasicInformation, 
    ObjectNameInformation,
    ObjectTypeInformation, 
    ObjectAllInformation, 
    ObjectDataInformation
};

struct OBJECT_NAME_INFORMATION 
{
    UNICODE_STRING Name; // defined in winternl.h
    WCHAR NameBuffer;
};

typedef NTSTATUS (NTAPI* t_NtQueryObject)(HANDLE Handle, OBJECT_INFORMATION_CLASS Info, PVOID Buffer, ULONG BufferSize, PULONG ReturnLength); 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2011-03-13T01:51:23.703

在 Windows XP 上，有一种正确的（尽管没有记录）方法，**它也适用于目录**——与[GetFinalPathNameByHandle](http://msdn.microsoft.com/en-us/library/aa364962.aspx)在 Windows Vista 及更高版本上使用的方法相同。

这是 eneded 的声明。其中一些已经在里面`WInternl.h`，`MountMgr.h`但我还是把它们放在这里：

```
#include "stdafx.h"
#include <Windows.h>
#include <assert.h>

enum OBJECT_INFORMATION_CLASS { ObjectNameInformation = 1 };
enum FILE_INFORMATION_CLASS { FileNameInformation = 9 };
struct FILE_NAME_INFORMATION { ULONG FileNameLength; WCHAR FileName[1]; };
struct IO_STATUS_BLOCK { PVOID Dummy; ULONG_PTR Information; };
struct UNICODE_STRING { USHORT Length; USHORT MaximumLength; PWSTR Buffer; };
struct MOUNTMGR_TARGET_NAME { USHORT DeviceNameLength; WCHAR DeviceName[1]; };
struct MOUNTMGR_VOLUME_PATHS { ULONG MultiSzLength; WCHAR MultiSz[1]; };

extern "C" NTSYSAPI NTSTATUS NTAPI NtQueryObject(IN HANDLE Handle OPTIONAL,
    IN OBJECT_INFORMATION_CLASS ObjectInformationClass,
    OUT PVOID ObjectInformation OPTIONAL, IN ULONG ObjectInformationLength,
    OUT PULONG ReturnLength OPTIONAL);
extern "C" NTSYSAPI NTSTATUS NTAPI NtQueryInformationFile(IN HANDLE FileHandle,
    OUT PIO_STATUS_BLOCK IoStatusBlock, OUT PVOID FileInformation,
    IN ULONG Length, IN FILE_INFORMATION_CLASS FileInformationClass);

#define MOUNTMGRCONTROLTYPE ((ULONG) 'm')
#define IOCTL_MOUNTMGR_QUERY_DOS_VOLUME_PATH \
    CTL_CODE(MOUNTMGRCONTROLTYPE, 12, METHOD_BUFFERED, FILE_ANY_ACCESS)

union ANY_BUFFER {
    MOUNTMGR_TARGET_NAME TargetName;
    MOUNTMGR_VOLUME_PATHS TargetPaths;
    FILE_NAME_INFORMATION NameInfo;
    UNICODE_STRING UnicodeString;
    WCHAR Buffer[USHRT_MAX];
}; 
```

这是核心功能：

```
LPWSTR GetFilePath(HANDLE hFile)
{
    static ANY_BUFFER nameFull, nameRel, nameMnt;
    ULONG returnedLength; IO_STATUS_BLOCK iosb; NTSTATUS status;
    status = NtQueryObject(hFile, ObjectNameInformation,
        nameFull.Buffer, sizeof(nameFull.Buffer), &returnedLength);
    assert(status == 0);
    status = NtQueryInformationFile(hFile, &iosb, nameRel.Buffer,
        sizeof(nameRel.Buffer), FileNameInformation);
    assert(status == 0);
    //I'm not sure how this works with network paths...
    assert(nameFull.UnicodeString.Length >= nameRel.NameInfo.FileNameLength);
    nameMnt.TargetName.DeviceNameLength = (USHORT)(
        nameFull.UnicodeString.Length - nameRel.NameInfo.FileNameLength);
    wcsncpy(nameMnt.TargetName.DeviceName, nameFull.UnicodeString.Buffer,
        nameMnt.TargetName.DeviceNameLength / sizeof(WCHAR));
    HANDLE hMountPointMgr = CreateFile(_T("\\\\.\\MountPointManager"),
        0, FILE_SHARE_READ | FILE_SHARE_WRITE | FILE_SHARE_DELETE,
        NULL, OPEN_EXISTING, 0, NULL);
    __try
    {
        DWORD bytesReturned;
        BOOL success = DeviceIoControl(hMountPointMgr,
            IOCTL_MOUNTMGR_QUERY_DOS_VOLUME_PATH, &nameMnt,
            sizeof(nameMnt), &nameMnt, sizeof(nameMnt),
            &bytesReturned, NULL);
        assert(success && nameMnt.TargetPaths.MultiSzLength > 0);
        wcsncat(nameMnt.TargetPaths.MultiSz, nameRel.NameInfo.FileName,
            nameRel.NameInfo.FileNameLength / sizeof(WCHAR));
        return nameMnt.TargetPaths.MultiSz;
    }
    __finally { CloseHandle(hMountPointMgr); }
} 
```

这是一个示例用法：

```
int _tmain(int argc, _TCHAR* argv[])
{
    HANDLE hFile = CreateFile(_T("\\\\.\\C:\\Windows\\Notepad.exe"),
        0, FILE_SHARE_READ | FILE_SHARE_WRITE, NULL, OPEN_EXISTING, 0, NULL);
    assert(hFile != NULL && hFile != INVALID_HANDLE_VALUE);
    __try
    {
        wprintf(L"%s\n", GetFilePath(hFile));
        //  Prints:
        //  C:\Windows\notepad.exe
    }
    __finally { CloseHandle(hFile); }
    return 0;
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-15T18:08:32.800

*编辑*感谢您对此仅是 Vista 或 Server 2008 的评论。我在页面上错过了。我想我应该阅读*整篇*文章；）

看起来您可以使用[GetFileInformationByHandleEx()](http://msdn.microsoft.com/en-us/library/aa364953.aspx)来获取此信息。

您可能想要执行以下操作：

```
GetFileInformationByHandleEx( fileHandle, FILE_NAME_INFO, lpFileInformation, sizeof(FILE_NAME_INFO)); 
```

仔细检查 MSDN 页面，确保我没有误导你太严重:)

干杯，

泰勒

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T19:07:36.183

[FWIW，这是 Prakash 在 Python 中使用美妙的ctypes](http://python.net/crew/theller/ctypes/)建议的 MSDN 文章中的相同解决方案：

```
from ctypes import *
# get handle to  c:\boot.ini to test
handle = windll.kernel32.CreateFileA("c:\\boot.ini", 0x80000000, 3, 0, 3, 0x80, 0)
hfilemap = windll.kernel32.CreateFileMappingA(handle, 0, 2, 0, 1, 0)
pmem = windll.kernel32.MapViewOfFile(hfilemap, 4, 0, 0, 1)
name = create_string_buffer(1024)
windll.psapi.GetMappedFileNameA(windll.kernel32.GetCurrentProcess(), pmem, name, 1024)
print "The name for the handle 0x%08x is %s" % (handle, name.value)
# convert device name to drive letter
buf = create_string_buffer(512)
size = windll.kernel32.GetLogicalDriveStringsA(511, buf)
names = buf.raw[0:size-1].split("\0")
for drive in names:
    windll.kernel32.QueryDosDeviceA(drive[0:2], buf, 512)
    if name.value.startswith(buf.value):
        print "%s%s" % (drive[0:2], name.value[len(buf.value):])
        break 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-03-08T09:34:42.810

对于 Windows Vista 及更高版本，我更喜欢使用 [GetFinalPathNameByHandle()](https://msdn.microsoft.com/en-us/library/aa364962.aspx)

```
char buf[MAX_PATH];
GetFinalPathNameByHandleA(fileHandle, buf, sizeof(buf), VOLUME_NAME_DOS) 
```

对于 Windows XP，我更喜欢[Mehrdad 的解决方案](https://stackoverflow.com/a/5286888/4727717.)。

因此，我通过 GetProcAddress() 动态加载 GetFinalPathNameByHandle()，如果失败（因为它是 Windows XP），我会使用 Mehrdad 的 NtQueryObject() 解决方案

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-15T18:25:46.127

如果您需要在 Win32 pre-Vista 或 Server 2008 上执行此操作，请查看该`GetMappedFileName(...)`功能，这是 Win32 中保存最好的秘密之一。只需一点`C/C++-`*fu*，您就可以对相关文件的一小部分进行内存映射，然后将该句柄传递给该函数。

此外，在 Win32 上，您不能真正删除打开的文件（另一个答案中提到的打开/取消链接问题） - 您可以在关闭时将其标记为删除，但它仍然会挂起，直到其最后打开的句柄关闭。不知道在这种情况下映射（通过`mmap(...)`）文件是否会有所帮助，因为它必须指向物理文件......

-=- 詹姆斯。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-15T18:08:27.370

在 Unix 上，没有真正可靠的方法来做到这一点。在具有传统 unix 文件系统的 unix 中，您可以打开文件然后取消链接（从目录中删除其条目）并使用它，此时名称不会存储在任何地方。此外，因为一个文件可能有多个到文件系统的硬链接，每个名称都是等效的，所以一旦你得到了打开的句柄，就不清楚你应该映射回哪个文件名。

因此，您可以使用其他答案在 Win32 上执行此操作，但如果您需要将应用程序移植到 unix 环境，那么您将不走运。我对您的建议是，如果可能的话，重构您的程序，这样您就不需要操作系统来维护与文件名连接的开放资源。

# php - PHP - Windows 中的命令行参数

> ID：65173
> 
> 赞同：7
> 
> 时间：2008-09-15T17:59:00.730
> 
> 标签：php, command-line, parameters

我正在尝试从[Windows XP](https://en.wikipedia.org/wiki/Windows_XP)下的命令行运行 PHP 。

这行得通，除了我无法为我的 PHP 脚本提供参数这一事实。

我的测试用例：

```
echo "param = " . $param . "\n";
var_dump($argv); 
```

我想称之为：

```
php.exe -f test.php -- param=test 
```

但我从来没有让脚本接受我的参数。

我从上面的脚本得到的结果：

> PHP 注意：未定义变量：第 2 行 C:\test.php 中的参数

```
param = ''
array(2) {
  [0]=> string(8) "test.php"
  [1]=> string(10) "param=test"
} 
```

我正在尝试使用 PHP 5.2.6。这是 PHP 5 中的错误吗？

参数传递在[在线帮助](http://us3.php.net/features.commandline)中处理：

> 注意：如果您需要将参数传递给脚本，则需要在使用 -f 开关时将 -- 作为第一个参数传递。

这似乎在 PHP 4 下有效，但在 PHP 5 下无效。

在 PHP 4 下，我可以使用可以在服务器上运行的相同脚本，而无需在命令行上进行更改。这对于本地调试很方便，例如，将输出保存在文件中，以供研究。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-15T18:06:14.490

为什么您期望将*param*设置为该值？

您负责从*$argv*数组中以您想要的方式解析命令行。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-05-12T12:39:29.813

您可以使用[getopt()](http://in2.php.net/getopt)函数。

检查博客文章*[PHP CLI 脚本和命令行参数](http://sharingphp.blogspot.com/2011/04/php-cli-script-and-command-line.html)*。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-15T18:19:18.327

> 参数传递在在线帮助中处理 注意：如果您需要将参数传递给您的脚本，您需要传递 -- 作为使用 -f 开关时的第一个参数。这似乎在 PHP 4 下有效，但在 PHP 5 下无效。

但是 PHP 仍然不解析这些参数。*它只是将它们传递给$argv*数组中的脚本。

**使用--**的唯一原因是 PHP 可以分辨出哪些参数适用于 PHP 可执行文件，哪些参数适用于您的脚本。

这使您可以执行以下操作：

```
php -e -n -f myScript.php -- -f -n -e 
```

**（后面**的-f、-n 和 -e 选项`--`被传递给文件*myScript.php*。前面的选项被传递给 PHP 本身）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-05-27T19:37:34.740

如果要传递类似于 GET 变量的参数，则可以使用[parse_str()](http://us.php.net/manual/en/function.parse-str.php)函数。与此类似的东西：

```
<?php
    parse_str($argv[1]);
?> 
```

将产生一个变量*$test*，其值为 <myValue>。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-15T18:13:16.390

PHP 不会为您参数化命令行参数。查看第二个输入`ARGV`为“param=test”的输出。

您很可能希望使用 PEAR 包[Console_CommandLine](http://pear.php.net/package/Console_CommandLine)：“功能齐全的命令行选项和参数解析器”。

或者您可以自虐并添加代码来检查您`ARGV`并自己设置参数。这是一个非常简单的片段，可以帮助您入门（如果第一部分不是有效的变量名或部分中有超过 1 个“=”，这将不起作用`ARGV`：

```
foreach($argv as $v) {
    if(false !== strpos($v, '=')) {
        $parts = explode('=', $v);
        ${$parts[0]} = $parts[1];
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-10-09T03:00:14.657

命令行示例：

```
 php myserver.php host=192.168.1.4 port=9000 
```

在文件*myserver.php*中，使用以下行：

```
<?php
    parse_str(implode('&', array_slice($argv, 1)), $_GET);
    // Read arguments

    if (array_key_exists('host', $_GET))
    {
        $host = $_GET['host'];
    }

    if (array_key_exists('port', $_GET))
    {
        $port = $_GET['port'];
    }
?> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-15T20:36:22.927

你可以使用类似的东西

```
if (isset($argv[1]) {
  $arg1 = $argv[1];
  $arg1 = explode("=", $arg1);
  $param = $arg1[1];
} 
```

（如何处理缺少参数取决于您。）

或者，如果您需要更复杂的场景，请查看命令行解析器库，例如[Pear](http://pear.php.net/package/Console_CommandLine)中的解析器库。

使用`${$parts[0]} = $parts[1];`在另一个解决方案中发布的内容可以让您覆盖代码中的任何变量，这**听起来并不安全**。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-15T18:13:44.597

您可以执行以下操作：

```
if($argc > 1){
    if($argv[1] == 'param=test'){
        $param = 'test';
    }
} 
```

当然，您可以根据需要变得比这复杂得多。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-10-12T21:59:26.967

如果你喜欢生活在最前沿，PHP 5.3 有[getOpt()](http://php.net/getopt)命令，它将为你处理所有这些杂乱无章的事情。有些。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-15T18:10:51.030

$argv 是一个包含所有命令行参数的数组...您需要解析该数组并自己设置 $param。

```
$tmp = $argv[1];             // $tmp="param=test"
$tmp = explode("=", $tmp);   // $tmp=Array( 0 => param, 1 => test)

$param = $tmp[1];            // $param = "test"; 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-09-15T19:00:56.293

您可以使用 $argv 数组。像这样：

```
<?php
    echo $argv[1];
?> 
```

请记住*$argv*数组的第一个成员（即*$argv[0]*）是脚本本身的名称，因此为了使用应用程序的参数，您应该开始使用*$argv[]*的成员第'1'个索引。

调用应用程序时，请使用以下语法：

```
php myscript.php -- myValue 
```

不需要为参数命名。如您所见，您在*$argv[]上调用了**var_dump()*，第二个成员（即第一个参数）是字符串*PARAM=TEST*。正确的？所以没有必要为参数命名。只需输入*参数*值。

 ***# c# - C# 比较算法

> ID：65199
> 
> 赞同：26
> 
> 时间：2008-09-15T18:01:26.310
> 
> 标签：c#, algorithm, diff

c#中是否有任何开源算法可以解决在两个文本文件之间创建差异的问题？

如果它能够以某种方式突出显示文本文档中发生更改的确切区域，那将是非常酷的。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2010-05-22T08:42:09.707

还有 Google (Neil Fraser) [diff、match 和 patch](http://code.google.com/p/google-diff-match-patch/)的 ac# 端口。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-15T18:13:54.830

[Menees Diff](http://www.menees.com/Diff.Net.htm)将为您提供 C# diff 实现。源代码包括在内。我过去曾使用它并成功地将它包装在我自己的实现中。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2011-02-16T03:52:38.773

这个怎么样？: [DIFFPLEX](https://github.com/mmanela/diffplex "差速器")

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-15T18:05:51.340

查看[差异](http://en.wikipedia.org/wiki/Diff)。它[在 gnu 项目](http://www.gnu.org/software/diffutils/diffutils.html)中（当然是开源的），更多实现的链接可以在 wikipedia 文章中找到。[在这里](http://en.wikipedia.org/wiki/Comparison_of_file_comparison_tools)可以找到不同此类程序的比较。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2010-02-01T10:54:51.290

检查此链接“良好的逐行差异算法” [http://www.codeproject.com/KB/recipes/diffengine.aspx](http://www.codeproject.com/KB/recipes/diffengine.aspx)

# java - 如何使 JVM 崩溃？

> ID：65200
> 
> 赞同：155
> 
> 时间：2008-09-15T18:01:35.187
> 
> 标签：java, jvm

我正在读一本关于编程技巧的书，其中作者问受访者，“你是如何使 JVM 崩溃的？” 我认为您可以通过编写一个最终会耗尽所有内存的无限 for 循环来做到这一点。

有人有什么想法吗？

* * *

## 回答 #1

> 赞同：179
> 
> 时间：2008-09-16T17:24:17.657

我不会将抛出 OutOfMemoryError 或 StackOverflowError 称为崩溃。这些只是正常的例外。要真正使 VM 崩溃，有 3 种方法：

1.  使用 JNI 并在本机代码中崩溃。
2.  如果没有安装安全管理器，您可以使用反射使 VM 崩溃。这是特定于 VM 的，但通常 VM 在私有字段中存储一堆指向本地资源的指针（例如，指向本地线程对象的指针存储在**java.lang.Thread**的长字段中）。只需通过反射更改它们，VM 迟早会崩溃。
3.  所有虚拟机都有错误，所以你只需要触发一个。

对于最后一种方法，我有一个简短的示例，它将很好地使 Sun Hotspot VM 崩溃：

```
public class Crash {
    public static void main(String[] args) {
        Object[] o = null;

        while (true) {
            o = new Object[] {o};
        }
    }
} 
```

这会导致 GC 中的堆栈溢出，因此您不会收到 StackOverflowError 而是真正的崩溃，包括 hs_err* 文件。

* * *

## 回答 #2

> 赞同：129
> 
> 时间：2008-09-15T18:06:27.110

[杰尼](http://en.wikipedia.org/wiki/Java_Native_Interface). 事实上，对于 JNI，崩溃是默认的操作模式。你必须加倍努力才能让它不崩溃。

* * *

## 回答 #3

> 赞同：64
> 
> 时间：2009-09-04T10:18:22.377

用这个：

```
import sun.misc.Unsafe;

public class Crash {
    private static final Unsafe unsafe = Unsafe.getUnsafe();
    public static void crash() {
        unsafe.putAddress(0, 0);
    }
    public static void main(String[] args) {
        crash();
    }
} 
```

这个类必须在引导类路径上，因为它使用的是受信任的代码，所以像这样运行：

> java -Xbootclasspath/p:. 碰撞

**编辑**：简化版与出风头的建议：

```
Field f = Unsafe.class.getDeclaredField("theUnsafe");
f.setAccessible(true);
Unsafe unsafe = (Unsafe) f.get(null);
unsafe.putAddress(0, 0); 
```

* * *

## 回答 #4

> 赞同：36
> 
> 时间：2012-07-24T17:41:10.313

我来到这里是因为我在Chad Fowler的[The Passionate Programmer](https://rads.stackoverflow.com/amzn/click/com/1934356344)中也遇到了这个问题。对于那些无法获得副本的人来说，这个问题被设计为一种过滤/测试，用于面试需要“真正优秀的 Java 程序员”的职位的候选人。

具体来说，他问：

> 你将如何用纯 Java 编写一个会导致 Java 虚拟机崩溃的程序？

我用 Java 编程超过 15 年，我发现这个问题既令人费解又不公平。正如其他人指出的那样，Java 作为一种托管语言，专门设计为*不会崩溃*。当然总有 JVM 错误，但是：

1.  经过 15 年以上的生产级 JRE，这种情况很少见。
2.  任何此类错误都可能在下一个版本中得到修补，那么作为程序员，您有多大可能遇到并回忆当前 JRE 显示停止器的详细信息？

正如其他人所提到的，一些通过 JNI 的本机代码是使 JRE 崩溃的可靠方法。但是作者特意提到*了纯Java*，所以就不说了。

另一种选择是提供 JRE 虚假字节码；将一些垃圾二进制数据转储到 .class 文件并要求 JRE 运行它很容易：

```
$ echo 'crap crap crap' > crap.class
$ java crap
Exception in thread "main" java.lang.ClassFormatError: Incompatible magic value 1668440432 in class file crap 
```

这算不算？我的意思是 JRE 本身并没有崩溃。它正确地检测到虚假代码，报告它并退出。

这给我们留下了最明显的解决方案，例如通过递归破坏堆栈、通过对象分配耗尽堆内存或简单地抛出`RuntimeException`. 但这只会导致 JRE 以`StackOverflowError`或类似的异常退出，这又*不是真正的 crash*。

那么还剩下什么？我真的很想听听作者真正想到的正确解决方案。

**更新**：乍得福勒[在这里回应](https://twitter.com/chadfowler/status/227845163031072768)。

PS：这是一本非常棒的书。我在学习 Ruby 时选择了它以获得精神上的支持。

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2010-05-17T14:01:35.863

此代码将以令人讨厌的方式使 JVM 崩溃

```
import sun.dc.pr.PathDasher; 

public class Crash
{
     public static void main(String[] args)
     {    
        PathDasher dasher = new PathDasher(null) ;
     }
} 
```

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2015-02-21T19:02:39.827

上次我尝试这样做会这样做：

```
public class Recur {
    public static void main(String[] argv) {
        try {
            recur();
        }
        catch (Error e) {
            System.out.println(e.toString());
        }
        System.out.println("Ended normally");
    }
    static void recur() {
        Object[] o = null;
        try {
            while(true) {
                Object[] newO = new Object[1];
                newO[0] = o;
                o = newO;
            }
        }
        finally {
            recur();
        }
    }
} 
```

生成的日志文件的第一部分：

```
#
# An unexpected error has been detected by Java Runtime Environment:
#
#  EXCEPTION_STACK_OVERFLOW (0xc00000fd) at pc=0x000000006dad5c3d, pid=6752, tid=1996
#
# Java VM: Java HotSpot(TM) 64-Bit Server VM (11.2-b01 mixed mode windows-amd64)
# Problematic frame:
# V  [jvm.dll+0x2e5c3d]
#
# If you would like to submit a bug report, please visit:
#   http://java.sun.com/webapps/bugreport/crash.jsp
#

---------------  T H R E A D  ---------------

Current thread (0x00000000014c6000):  VMThread [stack: 0x0000000049810000,0x0000000049910000] [id=1996]

siginfo: ExceptionCode=0xc00000fd, ExceptionInformation=0x0000000000000001 0x0000000049813fe8 

Registers:
EAX=0x000000006dc83090, EBX=0x000000003680f400, ECX=0x0000000005d40ce8, EDX=0x000000003680f400
ESP=0x0000000049813ff0, EBP=0x00000000013f2df0, ESI=0x00000000013f0e40, EDI=0x000000003680f400
EIP=0x000000006dad5c3d, EFLAGS=0x0000000000010206 
```

* * *

## 回答 #7

> 赞同：16
> 
> 时间：2008-09-15T18:16:20.970

一个完美的 JVM 实现永远不会崩溃。

要使 JVM 崩溃，除了 JNI 之外，您还需要在 VM 本身中找到错误。无限循环只会消耗 CPU。在构建良好的 JVM 中，无限分配内存只会导致 OutOfMemoryError。这可能会导致其他线程出现问题，但一个好的 JVM 仍然不应该崩溃。

如果你能在 VM 的源代码中发现一个 bug，例如在 VM 的实现中导致内存使用的分段错误，那么你实际上可以将它崩溃。

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2011-09-03T04:03:02.913

如果您想使 JVM 崩溃 - 在 Sun JDK 1.6_23 或更低版本中使用以下命令：

```
Double.parseDouble("2.2250738585072012e-308"); 
```

这是由于 Sun JDK 中的一个[错误](http://www.theregister.co.uk/2011/02/07/java_denial_of_service_bug/)- OpenJDK 中也有。这是从 Oracle JDK 1.6_24 开始修复的。

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2008-09-15T18:12:25.630

取决于你所说的崩溃是什么意思。

您可以进行无限递归以使其耗尽堆栈空间，但这会“优雅地”崩溃。你会得到一个异常，但 JVM 本身会处理一切。

您还可以使用 JNI 调用本机代码。如果你做得不好，那么你可以让它很难崩溃。调试这些崩溃是“有趣的”（相信我，我必须编写一个大的 C++ DLL，我们从签名的 java 小程序中调用它）。:)

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2008-09-15T18:12:28.907

最接近单一“答案”的是`System.exit()`，它会立即终止 JVM，而无需进行适当的清理。但除此之外，本机代码和资源耗尽是最有可能的答案。或者，您可以在 Sun 的错误跟踪器上查找您的 JVM 版本中的错误，其中一些允许可重复的崩溃场景。在 32 位版本（我们现在通常使用 64 位）下，当接近 4 Gb 内存限制时，我们曾经遇到过半定期的崩溃。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2008-09-15T18:48:07.930

Jon Meyer所著的[Java Virtual Machine](http://www.amazon.co.uk/Java-Virtual-Machine-Series/dp/1565921941)一书中有一个导致 JVM 核心转储的一系列字节码指令的示例。我找不到这本书的副本。如果有人在那里有一个，请查看并发布答案。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2008-09-20T06:50:45.123

在带有 wmp10 jre6.0_7 的 winxpsp2 上

Desktop.open(uriToAviOrMpgFile)

这会导致生成的线程抛出未捕获的 Throwable 并崩溃热点

YMMV

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2009-05-04T13:08:49.427

损坏的硬件可能会使任何程序崩溃。我曾经有一个应用程序崩溃在特定机器上可重现，而在具有完全相同设置的其他机器上运行良好。原来那台机器的内存有问题。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2014-04-07T06:37:39.440

最短的方法:)

```
public class Crash
{
    public static void main(String[] args)
    {
        main(args);
    }
} 
```

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2016-06-15T15:05:12.907

不是崩溃，但比使用的公认答案更接近崩溃`System.exit`

您可以通过调用停止 JVM

`Runtime.getRuntime().halt( status )`

根据文档：-

> “此方法不会导致关闭挂钩启动，并且如果已启用退出时终结器，则不会运行未调用的终结器”。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2008-09-16T17:34:51.903

如果您将崩溃定义为由于未处理的情况（即没有 Java 异常或错误）而导致的进程中止，那么这不能在 Java 中完成（除非您有权使用 sun.misc.Unsafe 类）。这就是托管代码的全部意义所在。

本机代码中的典型崩溃是通过取消引用指向错误内存区域（空地址或未对齐）的指针而发生的。另一个来源可能是非法机器指令（操作码）或来自库或内核调用的未处理信号。如果 JVM 或系统库有错误，两者都可以触发。

例如，JITed（生成）代码、本机方法或系统调用（图形驱动程序）可能会出现导致真正崩溃的问题（当您使用 ZIP 函数并且内存不足时发生崩溃是很常见的）。在这些情况下，JVM 的崩溃处理程序会启动并转储状态。它还可以生成操作系统核心文件（Windows 上的 Watson 博士和 *nix 上的核心转储）。

在 Linux/Unix 上，您可以通过向正在运行的进程发送信号来轻松地使 JVM 崩溃。注意：您不应该`SIGSEGV`为此使用，因为 Hotspot 会捕获此信号并在大多数地方将其作为 NullPointerException 重新抛出。所以最好发送一个`SIGBUS`例子。

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2008-09-30T08:57:43.163

以下是关于导致 JVM 核心转储（即崩溃）的原因的详细说明：http: //kb.adobe.com/selfservice/viewContent.do?externalId= [tn_17534](http://kb.adobe.com/selfservice/viewContent.do?externalId=tn_17534)

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2009-04-28T20:47:33.447

如果你想假装你的内存不足，你可以这样做

```
public static void main(String[] args) {
    throw new OutOfmemoryError();
} 
```

我知道几种通过调用本机方法（内置方法）导致 JVM 转储错误文件的方法，但最好你不知道如何执行此操作。;)

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2009-04-28T20:53:09.003

JNI 是一个很大的崩溃源。您也可以使用 JVMTI 接口崩溃，因为它也需要用 C/C++ 编写。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2017-09-14T05:16:25.663

如果您创建一个无限产生更多线程的线程进程（产生更多线程，这...），您最终将在 JVM 本身中导致堆栈溢出错误。

```
public class Crash {
    public static void main(String[] args) {

        Runnable[] arr = new Runnable[1];
        arr[0] = () -> {

            while (true) {
                new Thread(arr[0]).start();
            }
        };

        arr[0].run();
    }
} 
```

这给了我输出（5分钟后，注意你的内存）

```
An unrecoverable stack overflow has occurred.
#
# A fatal error has been detected by the Java Runtime Environment:
#
#  EXCEPTION_STACK_OVERFLOW (0xc00000fd) at pc=0x0000000070e53ed7, pid=12840, tid=0x0000000000101078
#
# JRE version: Java(TM) SE Runtime Environment (8.0_144-b01) (build 1.8.0_144-b01)
# Java VM: Java HotSpot(TM) 64-Bit Server VM (25.144-b01 mixed mode windows-amd64 compressed oops)
# Problematic frame:
# 
```

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2019-08-28T17:05:52.767

如果“崩溃”是指 JVM 的突然中止，**例如会导致 JVM 写入其 hs_err_pid%p.log**，则可以这样做。

将 -Xmx 参数设置为一个很小的值并告诉 JVM 在内存不足时强制崩溃：

```
 -Xmx10m -XX:+CrashOnOutOfMemoryError 
```

需要明确的是，如果没有上面的第二个参数，它只会导致 jvm以 OutOfMemoryError**终止**，但它不会“崩溃”或突然中止 jvm。

当我尝试测试 JVM -XX:ErrorFile arg 时，这种技术被证明是有用的，它控制应该在哪里写入这样的 hs_err_pid 日志。我在这里找到了这篇文章，同时试图找到迫使这种崩溃的方法。当我后来发现上述方法最适合我的需要时，我想将其添加到此处的列表中。

最后，FWIW，如果有人在您的参数中已经设置了 -Xms 值（比上面的值更大）时可以测试这个，您也需要删除或更改它，否则您不会崩溃，而只是简单地jvm 启动失败，报告“初始堆大小设置为大于最大堆大小的值”。（如果将 JVM 作为服务运行，例如使用一些应用程序服务器，这不会很明显。再一次，它咬了我，所以我想分享它。）

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2016-06-25T17:23:31.430

最短？使用 Robot 类触发 CTRL+BREAK。当我试图在不关闭控制台的情况下关闭程序时发现了这一点（它没有“退出”功能）。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2019-03-27T15:55:45.957

这算不算？

```
long pid = ProcessHandle.current().pid();
try { Runtime.getRuntime().exec("kill -9 "+pid); } catch (Exception e) {} 
```

它仅适用于 Linux 和 Java 9。

由于某种原因，我没有得到，`ProcessHandle.current().destroyForcibly();`不会杀死 JVM 并抛出`java.lang.IllegalStateException`消息*destroy of current process not allowed*。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-09-15T18:12:28.390

如果将无限 for 循环更改为对同一函数的递归调用，则会出现堆栈溢出异常：

```
public static void main(String[] args) {
    causeStackOverflow();
}

public void causeStackOverflow() {
    causeStackOverflow();
} 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2009-04-28T17:18:43.823

我现在正在这样做，但不完全确定如何...... :-) JVM（和我的应用程序）有时会完全消失。没有抛出错误，没有任何记录。从工作到完全不运行，没有任何警告。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2020-03-26T02:26:29.113

尝试复制 JVM 崩溃时遇到此问题。

Jni 可以工作，但需要针对不同的平台进行调整。最终，我使用这种组合使 JVM 崩溃

1.  使用此 JVM 选项启动应用程序`-XX:+CrashOnOutOfMemoryError`
2.  使用 a`long[] l = new long[Integer.MAX_VALUE];`触发 OOM

然后JVM会崩溃并生成崩溃日志。

* * *

## 回答 #27

> 赞同：-2
> 
> 时间：2016-01-31T07:44:49.097

如果“崩溃”是任何中断 jvm/程序正常终止的东西，那么未处理的异常可以做到这一点。

```
public static void main(String args[]){
   int i = 1/0;
   System.out.print(i); // This part will not be executed due to above  unhandled exception
  } 
```

所以，这取决于什么类型的崩溃？！

# sql - SQL中的链表

> ID：65205
> 
> 赞同：67
> 
> 时间：2008-09-15T18:02:01.503
> 
> 标签：sql, data-structures

在 MySQL 数据库中存储链表的最佳方法是什么，以便插入简单（即您不必每次都重新索引一堆东西）并且可以轻松地按顺序拉出列表？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-15T18:12:39.793

创建一个包含两个自引用列 PreviousID 和 NextID 的表。如果项目是列表中的第一个，PreviousID 将为空，如果是最后一个，NextID 将为空。SQL 将如下所示：

```
create table tblDummy
{
     PKColumn     int     not null, 
     PreviousID     int     null, 
     DataColumn1     varchar(50)     not null, 
     DataColumn2     varchar(50)     not null,  
     DataColumn3     varchar(50)     not null, 
     DataColumn4     varchar(50)     not null, 
     DataColumn5     varchar(50)     not null, 
     DataColumn6     varchar(50)     not null, 
     DataColumn7     varchar(50)     not null, 
     NextID     int     null
} 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-09-15T18:11:36.893

使用 Adrian 的解决方案，但不是以 1 递增，而是以 10 甚至 100 递增。然后插入可以计算为您插入的内容之间差异的一半，而无需更新插入下方的所有内容。选择一个足够大的数字来处理您的平均插入次数 - 如果它太小，那么您将不得不在插入期间更新所有具有更高位置的行。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-09-15T18:06:31.790

在您的表中存储一个名为“位置”的整数列。为列表中的第一项记录 0，为第二项记录 1，等等。在数据库中索引该列，当您想要提取值时，按该列排序。

```
 alter table linked_list add column position integer not null default 0;
 alter table linked_list add index position_index (position);
 select * from linked_list order by position; 
```

要在索引 3 处插入值，请修改第 3 行及以上的位置，然后插入：

```
 update linked_list set position = position + 1 where position >= 3;
 insert into linked_list (my_value, position) values ("new value", 3); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-15T18:11:56.100

可以使用表中的递归指针来存储链表。这与存储在 Sql 中的层次结构非常相似，并且使用递归关联模式。

您可以[在此处](https://web.archive.org/web/20180729174436/http://www.tomjewett.com/dbdesign/dbdesign.php?page=recursive.php)了解更多信息（Wayback Machine 链接）。

我希望这有帮助。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-15T18:16:04.280

最简单的选项是创建一个表，其中每个列表项有一行，项目位置的列和项目中其他数据的列。然后您可以在位置列上使用 ORDER BY 以按所需顺序检索。

```
create table linked_list
(   list_id   integer not null
,   position  integer not null 
,   data      varchar(100) not null
);
alter table linked_list add primary key ( list_id, position ); 
```

要操作列表，只需更新位置，然后根据需要插入/删除记录。因此，要将项目插入到索引 3 的列表 1 中：

```
begin transaction;

update linked_list set position = position + 1 where position >= 3 and list_id = 1;

insert into linked_list (list_id, position, data)
values (1, 3, "some data");

commit; 
```

由于列表上的操作可能需要多个命令（例如，插入将需要 INSERT 和 UPDATE），因此请确保您始终在事务中执行命令。

这个简单选项的一个变体是让每个项目的位置增加某个因子，比如 100，这样当您执行 INSERT 时，您并不总是需要重新编号以下元素的位置。但是，这需要更多的努力来确定何时增加以下元素，因此如果您有很多插入，您会失去简单性但会提高性能。

根据您的要求，其他选项可能会吸引您，例如：

*   如果您想对列表执行大量操作而不是多次检索，您可能更喜欢使用 ID 列指向列表中的下一项，而不是使用位置列。然后您需要在检索列表中进行迭代逻辑，以便按顺序获取项目。这可以在存储过程中相对容易地实现。

*   如果您有许多列表，一种将列表序列化和反序列化为文本/二进制的快速方法，并且您只想存储和检索整个列表，然后将整个列表作为单个值存储在单个列中。可能不是你在这里要求的。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-04-06T16:42:36.543

这是我自己一直试图弄清楚的事情。到目前为止，我发现的最好方法是使用以下格式为链表创建一个表（这是伪代码）：

链表（

*   键1，
*   信息，
*   键2

)

key1 是起点。Key2 是在下一列中链接到自身的外键。所以你的专栏将链接一些类似这样的链接

**col1**

*   键1 = 0，
*   信息='你好'
*   键2 = 1

*Key1 是 col1 的主键。key2 是通向 col2 的 key1 的外键*

**col2**

*   键1 = 1，
*   信息='wassup'
*   key2 = 空

*col2 中的 key2 设置为 null，因为它不指向任何内容*

当您第一次在表中输入一列时，您需要确保将 key2 设置为 null，否则您将收到错误消息。输入第二列后，可以返回将第一列的key2设置为第二列的主键。

这是一次输入多个条目的最佳方法，然后返回并相应地设置外键（或构建一个为您执行此操作的 GUI）

这是我准备的一些实际代码（所有实际代码都在 MSSQL 上运行。您可能需要对您正在使用的 SQL 版本进行一些研究！）：

*创建表.sql*

```
create table linkedlist00 (

key1 int primary key not null identity(1,1),

info varchar(10),

key2 int

) 
```

*register_foreign_key.sql*

```
alter table dbo.linkedlist00

add foreign key (key2) references dbo.linkedlist00(key1) 
```

*我把它们放在两个单独的文件中，因为它必须分两步完成。MSSQL 不会让您一步完成，因为该表尚不存在供外键引用。

链表在*一对多*关系中特别强大。因此，如果您曾经想要制作一组外键？好吧，这是一种方法！您可以创建一个指向链表中第一列的主表，然后您可以使用所需信息表的外键代替“信息”字段。

例子：

假设您有一个保留表格的官僚机构。

假设他们有一张叫做*文件柜的桌子*

文件柜（

*   机柜 ID (pk)
*   文件 ID (fk) )

*每列包含文件柜的主键和文件的外键。这些文件可能是税表、健康保险文件、实地考察许可单等*

文件（

*   文件 ID (pk)

*   文件 ID (fk)

*   下一个文件 ID (fk)

)

*这用作文件的容器*

文件（

*   文件 ID (pk)

*   档案资料

)

*这是特定的文件*

可能有更好的方法可以做到这一点，并且有，这取决于您的具体需求。该示例仅说明了可能的用法。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-15T18:27:36.873

我可以立即想到几种方法，每种方法都具有不同程度的复杂性和灵活性。我假设您的目标是保留检索顺序，而不是要求存储为实际的链表。

最简单的方法是为表中的每条记录分配一个序数值（例如 1、2、3、...）。然后，当您检索记录时，在序号列上指定 order-by 以使它们按顺序返回。

这种方法还允许您检索记录而不考虑列表中的成员资格，但只允许一个列表中的成员资格，并且可能需要一个额外的“列表 ID”列来指示记录属于哪个列表。

一种稍微复杂但也更灵活的方法是将有关成员资格的信息存储在一个列表或单独的表中的列表中。该表需要 3 列：列表 ID、序数值和指向数据记录的外键指针。在这种方法下，底层数据对其在列表中的成员身份一无所知，并且可以轻松地包含在多个列表中。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-01-10T07:35:58.967

这篇文章很旧，但仍然会给我 0.02 美元。更新表或记录集中的每条记录对于解决排序问题听起来很疯狂。索引的数量也很疯狂，但听起来大多数人都接受了它。

我想出的减少更新和索引的疯狂解决方案是创建两个表（在大多数用例中，无论如何您都不会对一张表中的所有记录进行排序）。表 A 保存正在排序的列表的记录，表 B 分组并保存作为字符串的订单记录。order 字符串表示一个数组，可用于对 Web 服务器或网页应用程序的浏览器层上的选定记录进行排序。

```
Create Table A{
Id int primary key identity(1,1),
Data varchar(10) not null
B_Id int
}

Create Table B{
Id int primary key Identity(1,1),
GroupName varchat(10) not null,
Order varchar(max) null
} 
```

订单字符串的格式应该是 id、位置和一些分隔符来分割（）你的字符串。对于 jQuery UI，.sortable('serialize') 函数会为您输出一个对 POST 友好的订单字符串，其中包括列表中每条记录的 id 和位置。

真正的魔力在于您选择使用保存的排序字符串重新排序所选列表的方式。这将取决于您正在构建的应用程序。这里又是一个来自 jQuery 的示例，用于重新排序项目列表： http: [//ovisdevelopment.com/oramincite/ ?p=155](http://ovisdevelopment.com/oramincite/?p=155)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2014-09-18T09:10:15.900

[https://dba.stackexchange.com/questions/46238/linked-list-in-sql-and-trees](https://dba.stackexchange.com/questions/46238/linked-list-in-sql-and-trees)建议使用浮点位置列进行快速插入和排序。

它还提到了专门的 SQL Server 2014 [hierarchyid](http://technet.microsoft.com/en-us/library/bb677173.aspx)功能。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-08-11T12:34:23.980

`Datetime`我认为添加一个 created类型的列和一个 position 的列要简单得多`int`，所以现在你可以有重复的位置，在 select 语句中使用`order by`position，created desc 选项，你的列表将按顺序获取。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-01-08T03:03:00.797

将 SERIAL 'index' 增加 100，但手动添加中间值，其 'index' 等于 Prev+Next / 2。如果您曾经饱和 100 行，请将索引重新排序回 100s。

这应该与主索引保持顺序。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2008-09-15T18:05:46.673

可以通过让列包含偏移量（列表索引位置）来存储列表——中间的插入然后在新父级之上递增，然后进行插入。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2020-07-31T19:42:11.613

您可以像双端队列（deque）一样实现它，以支持快速推送/弹出/删除（如果已知 oridnal）和检索，您将拥有两个数据结构。一个带有实际数据，另一个带有在键的历史记录中添加的元素数量。权衡：对于任何插入到链表中间的 O(n)，此方法会更慢。

```
create table queue (
    primary_key,
    queue_key
    ordinal,
    data
) 
```

你会有一个关于 queue_key+ordinal 的索引

您还将有另一个表存储添加到队列中的行数......

```
create table queue_addcount (
    primary_key,
    add_count
) 
```

将新项目推送到队列的任一端（左或右）时，您总是会增加 add_count。

如果你推到后面，你可以设置序数......

```
ordinal = add_count + 1 
```

如果你推到前面，你可以设置序数......

```
ordinal = -(add_count + 1) 
```

更新

```
add_count = add_count + 1 
```

这样，您可以删除队列/列表中的任何位置，它仍会按顺序返回，您还可以继续推送新项目以保持顺序。

如果发生大量删除，您可以选择重写序数以避免溢出。

您还可以在序号上有一个索引，以支持对列表的快速有序检索。

如果你想支持插入到中间，你需要找到它需要插入的序数，然后用那个序数插入。然后在该插入点之后将每个序数加一。此外，像往常一样增加 add_count。如果序数是负数，您可以递减所有较早的序数以减少更新。这将是 O(n)

# jquery - 使用jQuery，如何动态设置选择框的大小属性？

> ID：65206
> 
> 赞同：11
> 
> 时间：2008-09-15T18:02:09.600
> 
> 标签：jquery

使用[jQuery](http://en.wikipedia.org/wiki/JQuery)，如何动态设置选择框的大小属性？

我想将其包含在此代码中：

```
$("#mySelect").bind("click",
    function() {
        $("#myOtherSelect").children().remove();
        var options = '' ;
        for (var i = 0; i < myArray[this.value].length; i++) {
            options += '<option value="' + myArray[this.value][i] + '">' + myArray[this.value][i] + '</option>';
        }
        $("#myOtherSelect").html(options).attr [... use myArray[this.value].length here ...];
    });
}); 
```

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-09-15T18:06:34.613

糟糕，是

```
$('#mySelect').attr('size', value) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T18:09:38.537

```
$("#mySelect").bind("click", function(){
    $("#myOtherSelect").children().remove();
    var myArray = [ "value1", "value2", "value3" ];
    for (var i = 0; i < myArray.length; i++) {
        $("#myOtherSelect").append( '<option value="' + myArray[i] + '">' + myArray[i] + '</option>' );
    }
    $("#myOtherSelect").attr( "size", myArray.length );
}); 
```

# php - 在 PHP 中使用 PSD

> ID：65209
> 
> 赞同：2
> 
> 时间：2008-09-15T18:02:15.233
> 
> 标签：php, psd

我最近被要求提供一个脚本，允许最终用户上传 PSD (Photoshop) 文件，然后将其拆分并从每个图层创建图像。

为此，我很想继续使用 PHP，但我也对 Python 或 Perl 持开放态度。

任何想法将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-15T18:10:29.410

您可以尝试[PHP PSD Reader](http://www.phpclasses.org/browse/package/3627.html)，它至少可以帮助您入门。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T19:25:29.150

将 GraphicsMagick 或 ImageMagick 与 Magick++ 一起使用，您就可以使用 imagick。

imagick 具有从图层转换 PSD 所需的所有调用，包括制作蒙版。

# vba - SQLite UDF - VBA 回调

> ID：65243
> 
> 赞同：4
> 
> 时间：2008-09-15T18:07:16.547
> 
> 标签：vba, sqlite, vb6

是否有人试图将 VBA（或 VB6）函数（通过 AddressOf ？）传递给 SQLite 创建 UDF 函数（[http://www.sqlite.org/c3ref/create_function.html](http://www.sqlite.org/c3ref/create_function.html)）。

VBA 将如何处理生成的回调参数？

要调用的函数将具有以下签名...

无效（*xFunc）（sqlite3_context*，int，sqlite3_value**）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-16T08:07:23.703

不幸的是，您不能直接使用 VB6/VBA 函数作为回调，因为 VB6 只生成`stdcall`函数而不是`cdecl`SQLite 期望的函数。

您将需要编写一个 C dll 来代理来回调用或重新编译 SQLite 以支持您自己的自定义扩展。

重新编译 dll 以将函数导出为`stdcall`后，您可以使用以下代码注册函数：

```
'Create Function
Public Declare Function sqlite3_create_function Lib "SQLiteVB.dll" (ByVal db As Long, ByVal zFunctionName As String, ByVal nArg As Long, ByVal eTextRep As Long, ByVal pApp As Long, ByVal xFunc As Long, ByVal xStep As Long, ByVal xFinal As Long) As Long

'Gets a value
Public Declare Function sqlite3_value_type Lib "SQLiteVB.dll" (ByVal arg As Long) As SQLiteDataTypes    'Gets the type
Public Declare Function sqlite3_value_text_bstr Lib "SQLiteVB.dll" (ByVal arg As Long) As String        'Gets as String
Public Declare Function sqlite3_value_int Lib "SQLiteVB.dll" (ByVal arg As Long) As Long                'Gets as Long

'Sets the Function Result
Public Declare Sub sqlite3_result_int Lib "SQLiteVB.dll" (ByVal context As Long, ByVal value As Long)
Public Declare Sub sqlite3_result_error_code Lib "SQLiteVB.dll" (ByVal context As Long, ByVal value As Long)

Public Declare Sub CopyMemory Lib "kernel32" Alias "RtlMoveMemory" (dest As Any, source As Any, ByVal bytes As Long)

Public Property Get ArgValue(ByVal argv As Long, ByVal index As Long) As Long
    CopyMemory ArgValue, ByVal (argv + index * 4), 4
End Property

Public Sub FirstCharCallback(ByVal context As Long, ByVal argc As Long, ByVal argv As Long)
    Dim arg1 As String
    If argc >= 1 Then
        arg1 = sqlite3_value_text_bstr(ArgValue(argv, 0))
        sqlite3_result_int context, AscW(arg1)
    Else
        sqlite3_result_error_code context, 666
    End If
End Sub

Public Sub RegisterFirstChar(ByVal db As Long)
    sqlite3_create_function db, "FirstChar", 1, 0, 0, AddressOf FirstCharCallback, 0, 0
    'Example query: SELECT FirstChar(field) FROM Table
End Sub 
```

# ruby - 将 .doc 或 .pdf 转换为图像并在 Ruby 中显示缩略图？

> ID：65250
> 
> 赞同：11
> 
> 时间：2008-09-15T18:08:11.117
> 
> 标签：ruby, pdf, doc

将 .doc 或 .pdf 转换为图像并在 Ruby 中显示缩略图？
有谁知道如何在Ruby（或C，python ...）中生成文档缩略图

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-16T06:27:29.513

将 PDF 转换为 PNG 的简单 RMagick 示例如下：

```
require 'RMagick'
pdf = Magick::ImageList.new("doc.pdf")
thumb = pdf.scale(300, 300)
thumb.write "doc.png" 
```

要转换 MS Word 文档，不会那么容易。您最好的选择可能是在生成缩略图之前先将其转换为 PDF。您生成 PDF 的选项很大程度上取决于您运行的操作系统。一种可能是使用 OpenOffice 和[Python Open Document Converter](http://www.artofsolving.com/opensource/pyodconverter)。您还可以尝试在线转换服务，包括[http://Zamzar.com](http://Zamzar.com)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2014-06-17T15:35:19.607

回答上述@aisensiy 评论的示例代码：

```
require 'rmagick'
pdf_path = "/path/to/interesting/file.pdf"
page_index_path = pdf_path + "[0]" # first page in PDF
pdf_page = Magick::Image.read( page_index_path ).first # first item in Magick::ImageList
pdf_page.write( "/tmp/indexed-page.png" ) # implicit conversion based on file extension 
```

基于回答另一个问题的路径线索：

[https://stackoverflow.com/a/6369524/765063](https://stackoverflow.com/a/6369524/765063)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T18:12:23.633

不确定任何开源库中的 .doc 支持，但 ImageMagick（和 RMagick gem）可以使用 pdf 支持编译（我认为默认情况下它是打开的）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T18:17:19.830

ImageMagick 中的 PDF 支持有点问题 - 但它是迄今为止 ruby​​ 的最佳操作系统方式。还有一个纯 Ruby PDF 支持的谷歌夏季代码项目。

我已经阅读了有关在没有 GUI 的情况下使用 OpenOffice 来转换 .doc 文件的内容 - 但它充其量只是复杂的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T02:51:05.850

正如前两张海报所说，ImageMagick 可能是生成缩略图的最简单方法。

您可以执行以下操作：

```
´convert -size 300x300 doc.pdf doc.png´ 
```

（反引号告诉 Ruby 将其去掉）。

如果您不想使用 exec 进行转换，您可以使用 RMagick gem 为您完成转换，但它可能需要更多代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-05-22T05:22:55.640

如果您不介意为 Imgix 付费，它也可以[处理 PDF](https://www.imgix.com/docs/reference/pdf)。使用它，您可以获得快速 CDN 的所有好处。

# asp.net - Server Core 2008 是否支持 asp.net？

> ID：65262
> 
> 赞同：1
> 
> 时间：2008-09-15T18:09:52.140
> 
> 标签：asp.net, server-core

Server Core 2008 是否支持 asp.net？我看到网上的参考资料说它不受支持，但它们都是来自 CTP 的旧参考资料。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-02-23T19:41:29.577

Server Core 2008 不支持 ASP.NET。但是，Windows 2008 R2 Server Core 开箱即可支持最高 3.5 的 .NET，并且自 2011-02-21 起，它还可以运行 .NET 4.0 应用程序。要启用 .NET 4.0 支持，您需要安装[Service Pack 1](http://www.microsoft.com/downloads/en/details.aspx?FamilyID=c3202ce6-4056-4059-8a1b-3a9b77cdfdda&displaylang=en)和[.NET 4.0 Standalone Installer for Server Core](http://go.microsoft.com/fwlink/?LinkID=211830)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-15T18:13:59.963

不。

在这里回答：http: [//www.microsoft.com/windowsserver2008/en/us/compare-core-installation.aspx](http://www.microsoft.com/windowsserver2008/en/us/compare-core-installation.aspx)

“ASP.NET 不适用于任何版本的 Server Core 安装选项”

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T18:20:42.067

正如其他人所说，简短的回答是：**不。**

更长的答案：有 IIS，有经典的 ASP，其他服务器端语言（如 PHP）也可以工作。[缺少的是 .NET Framework，并且正在将其添加到 Server Core。](http://blogs.iis.net/bills/archive/2007/06/04/iis7-on-server-core.aspx)

> 目前 .NET Framework 不在 Server Core 上，这意味着 ASP.NET 当前不可用。这是 .NET 团队想要添加的内容，**我们正在努力尽快添加。**

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T18:11:05.400

[不](http://www.microsoft.com/windowsserver2008/en/us/compare-core-installation.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-10-10T02:56:40.413

使用新的 Server Core 2008 R2，您可以在 IIS 中运行 asp.net，但只能运行到 3.5 版。4.0 不受支持，因为您根本无法在 Server Core 2008 R2 上安装 .Net 4.0。

# python - 在 Python 中缓存已编译的正则表达式对象？

> ID：65266
> 
> 赞同：20
> 
> 时间：2008-09-15T18:10:35.273
> 
> 标签：python, regex, caching

每次导入包含大量静态正则表达式的 python 文件时，都会花费 cpu 周期将字符串编译到内存中的代表性状态机中。

```
a = re.compile("a.*b")
b = re.compile("c.*d")
... 
```

问题：是否可以将这些正则表达式以预编译的方式存储在磁盘上的缓存中，以避免每次导入时都必须执行正则表达式编译？

酸洗对象只是执行以下操作，无论如何都会导致编译发生：

```
>>> import pickle
>>> import re
>>> x = re.compile(".*")
>>> pickle.dumps(x)
"cre\n_compile\np0\n(S'.*'\np1\nI0\ntp2\nRp3\n." 
```

并且`re`对象是不可编组的：

```
>>> import marshal
>>> import re
>>> x = re.compile(".*")
>>> marshal.dumps(x)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
ValueError: unmarshallable object 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-15T18:29:51.187

> 是否可以以预编译的方式将这些正则表达式存储在磁盘上的缓存中，以避免在每次导入时都执行正则表达式编译？

不容易。您必须编写一个自定义序列化程序，该序列化程序`sre`与 Python 正则表达式引擎的 C 实现挂钩。所需的时间和精力远远超过了任何性能优势。

首先，你真的分析过代码吗？我怀疑编译正则表达式是应用程序运行时的重要组成部分。请记住，它们仅在当前执行中第一次导入模块时编译——此后，模块及其属性被缓存在内存中。

如果您的程序基本上只生成一次，编译一堆正则表达式，然后退出，您可以尝试重新设计它以在一次调用中执行多个测试。然后你可以重复使用正则表达式，如上所述。

最后，您可以将正则表达式编译为基于 C 的状态机，然后将它们与扩展模块链接。虽然这可能更难以维护，但它会完全从您的应用程序中消除正则表达式编译。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-15T18:16:24.277

请注意，每个模块在应用程序的生命周期中只初始化一次，无论您导入多少次。因此，如果您在模块的全局范围内（即不在函数中）编译表达式，您应该没问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-28T13:02:56.863

首先，这是 python re 模块中的一个明显限制。它会限制正则表达式的合理程度和大小。长期运行的进程限制更大，而命令行应用程序等短期进程的限制更小。

几年前我确实看过它，可以挖掘出编译结果，腌制它，然后解开它并重用它。问题是它需要使用 sre.py 内部结构，因此可能无法在不同的 python 版本中工作。

我想在我的工具箱中有这种功能。我还想知道，是否可以使用任何单独的模块。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T19:14:24.730

[搁置](http://docs.python.org/lib/module-shelve.html)模块似乎工作得很好：

```
 import re
import shelve
a_pattern = "a.*b"
b_pattern = "c.*d"
a = re.compile(a_pattern)
b = re.compile(b_pattern)

x = shelve.open('re_cache')
x[a_pattern] = a
x[b_pattern] = b
x.close()

# ...
x = shelve.open('re_cache')
a = x[a_pattern]
b = x[b_pattern]
x.close() 
```

然后，您可以创建一个很好的包装类，自动为您处理缓存，使其对用户透明......留给读者的练习。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T20:53:14.900

打开 /usr/lib/python2.5/re.py 并查找“def _compile”。你会发现 re.py 的内部缓存机制。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-15T18:45:37.717

可以将每个正则表达式（或一组正则表达式）放入一个单独的文件中，然后使用 imp 模块动态导入您需要的文件。我怀疑它的扩展性很好，但它可能是你需要的。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-15T20:34:12.480

哼，

搁置不用泡菜吗？

无论如何，我同意以前的回答者。由于一个模块只处理一次，我怀疑编译正则表达式将成为您的应用程序瓶颈。而且 Python re 模块速度很快，因为它是用 C 编码的 :-)

但好消息是 Python 有一个不错的社区，所以我相信你可以找到目前正在破解你需要的东西的人。

我用谷歌搜索了 5 秒，发现：[http](http://home.gna.org/oomadness/en/cerealizer/index.html) ://home.gna.org/omadness/en/cerealizer/index.html 。

不知道它是否会这样做，但如果没有，祝你研究好运:-)

# audio - 您如何分析 PCM 或 WAV 样本的基频？

> ID：65268
> 
> 赞同：26
> 
> 时间：2008-09-15T18:10:40.890
> 
> 标签：audio, signal-processing, fft, pitch-tracking

我有一个样本保存在 DirectX 的缓冲区中。它是从乐器演奏和捕捉的音符样本。如何分析样本的频率（就像吉他调音器一样）？我相信涉及 FFT，但我没有指向 HOWTO。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-07-14T20:06:43.967

FFT 可以帮助您确定频率在哪里，但它不能*准确地*告诉您频率是多少。FFT 中的每个点都是频率的“bin”，因此如果 FFT 中有一个峰值，那么您所知道的就是您想要的频率在该 bin 或频率范围内的某个位置。

如果您希望它真正准确，则需要具有高分辨率和大量 bin（= 大量内存和大量计算）的长 FFT。[您还可以使用对数标度频谱上的二次插值](https://ccrma.stanford.edu/%7Ejos/sasp/Quadratic_Interpolation_Spectral_Peaks.html)从低分辨率 FFT 中猜测真正的峰值，效果非常好。

如果计算成本最重要，您可以尝试将信号转换为可以计算过零的形式，然后计算的越多，测量就越准确。

[但是，如果缺少基本要素](http://en.wikipedia.org/wiki/Missing_fundamental)，这些都将不起作用。:)

我在[这里](https://gist.github.com/endolith/255291)概述了一些不同的算法，插值 FFT 通常是最准确的（尽管这仅[在基波是最强谐波](https://www.flickr.com/photos/omegatron/4180172061/)时才有效- 否则你需要更聪明地找到它），过零紧随其后（尽管这只适用[于每个周期有一次交叉的波形](https://www.flickr.com/photos/omegatron/4180888094/)）。这些条件都不是典型的。

请记住，在许多乐器（如钢琴或吉他）中，基频以上的分音**并不是完美的泛音。**每个部分[实际上都有点跑调](https://www.flickr.com/photos/omegatron/4166565758/)，或[*不和谐*](http://en.wikipedia.org/wiki/Inharmonicity)。因此，FFT 中的高频峰值不会正好在基波的整数倍上，而且波形会从一个周期到下一个周期略有变化，这会消除自相关。

为了获得真正准确的频率读数，我会说使用自相关来猜测基频，然后使用二次插值找到真正的峰值。（您可以在频域中进行自相关以节省 CPU 周期。）有很多陷阱，使用正确的方法实际上取决于您的应用程序。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-09-19T04:03:11.567

还有其他基于时间的算法，而不是基于频率的算法。自相关是一种相对简单的音高检测算法。参考：[http ://cnx.org/content/m11714/latest/](http://cnx.org/content/m11714/latest/)

我已经编写了自相关和其他可读算法的 c# 实现。查看[http://code.google.com/p/yaalp/](http://code.google.com/p/yaalp/)。

[http://code.google.com/p/yaalp/source/browse/#svn/trunk/csaudio/WaveAudio/WaveAudio](http://code.google.com/p/yaalp/source/browse/#svn/trunk/csaudio/WaveAudio/WaveAudio) 列出文件，PitchDetection.cs 就是你想要的。

（该项目是 GPL；如果您使用代码，请理解这些条款）。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-15T18:33:05.643

吉他调音器不使用 FFT 或 DFT。通常他们只计算零交叉。您可能无法获得基频，因为某些波形比其他波形具有更多的过零，但您通常可以通过这种方式获得基频的倍数。尽管您可能会偏离一个或多个八度音阶，但这足以得到音符。

在计算过零之前进行低通滤波通常可以去除多余的过零。调整低通滤波器需要一些您想要检测的频率范围的知识

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-15T18:14:31.927

确实会涉及 FFT（快速傅立叶变换）。FFT 允许您用固定频率和变化幅度的简单正弦波之和来近似任何模拟信号。您实际上要做的是获取样本并将其分解为幅度->频率对，然后获取与最高幅度相对应的频率。

希望另一个 SO 读者可以填补我在理论和代码之间留下的空白！

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-16T22:29:49.997

更具体一点：

如果您从输入阵列中的原始 PCM 开始，您基本上拥有的是波幅与时间的关系图。执行 FFT 会将其转换为频率从 0 到 1/2 输入采样率的频率直方图。结果数组中每个条目的值将是相应子频率的“强度”。

因此，要在给定以 S 个样本/秒采样的大小为 N 的输入数组的情况下找到根频率：

```
FFT(N, input, output);
max = max_i = 0;
for(i=0;i<N;i++)
  if (output[i]>max) max_i = i;
root = S/2.0 * max_i/N ; 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-07-15T12:50:16.187

检索 PCM 音频信号中的基频是一项艰巨的任务，并且有很多话要说……

无论如何，通常基于时间的方法不适用于复音信号，因为由多个基频引起的不同谐波分量之和给出的复波具有仅取决于最低频率分量的过零率......也在频域 FFT 不是最合适的方法，因为音符之间的频率间隔遵循指数比例，而不是线性的。这意味着，如果时域中的分析窗口大小不够大，FFT 方法中使用的恒定频率分辨率可能不足以解析低频音符。

更合适的方法是常数 Q 变换，它是在对信号进行低通滤波和 2 抽取（即每步采样频率减半）的过程之后应用 DFT，以获得具有不同频率的不同子带解析度。通过这种方式优化了 DFT 的计算。问题是时间分辨率也是可变的，并且对于较低的子带会增加......

最后，如果我们试图估计单个音符的基频，FFT/DFT 方法是可以的。在复音环境中情况会发生变化，其中不同声音的部分重叠并根据它们的相位差求和/抵消它们的幅度，因此单个频谱峰值可能属于不同的谐波内容（属于不同的音符）。在这种情况下，相关性不会给出好的结果......

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-15T18:16:18.083

应用[DFT](http://en.wikipedia.org/wiki/Discrete_Fourier_transform)，然后从结果中导出基频。谷歌搜索 DFT 信息将为您提供所需的信息——我会将您链接到一些信息，但它们对数学知识的期望差异很大。

祝你好运。

# iis-6 - 将状态服务器切换到集群中的另一台机器

> ID：65273
> 
> 赞同：1
> 
> 时间：2008-09-15T18:11:11.373
> 
> 标签：iis-6, windows-server-2003, stateserver

我们在机器集群中的 IIS 6 上运行了许多 Web 应用程序。其中一台机器也是集群的状态服务器。我们不使用粘性 IP。

当我们需要关闭状态服务器机器时，这需要整个集群在从一台机器切换到另一台机器时离线几分钟。

有没有办法以零停机时间将状态服务器从一台机器切换到另一台机器？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-22T22:04:20.223

您可以使用[Velocity](http://msdn.microsoft.com/en-us/library/dd187409.aspx)，这是 Microsoft 的一种分布式缓存技术。您将在两台或多台服务器上安装缓存。然后，您将[配置您的 Web 应用程序](http://blogs.msdn.com/velocity/archive/2008/10/29/changes-to-session-state-provider-configuration-web-config-for-ctp2.aspx)以将会话数据存储在 Velocity 缓存中。如果您需要重新启动其中一台服务器，则集群的整个状态仍然可用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T18:15:10.520

您可以使用 SQL 服务器选项来存储状态。我过去使用过它，只要它创建的 ASPState 表在内存中，它就可以很好地工作。我不知道它作为磁盘表的扩展性如何。

如果由于某种原因不能选择 SQL Server，您可以使用负载均衡器为您的状态服务器创建一个虚拟 IP，并在需要更改时将其指向新的状态服务器。不会有停机时间，但当时在您网站上的人会失去他们的会话状态。我不知道您使用什么来进行负载平衡，所以我不知道这在您的环境中会有多困难。

# process-management - 还有人相信软件的能力成熟度模型吗？

> ID：65296
> 
> 赞同：22
> 
> 时间：2008-09-15T18:12:57.267
> 
> 标签：process-management, cmmi

十年前，当我第一次遇到[软件 CMM](http://en.wikipedia.org/wiki/Capability_Maturity_Model)时，我想我和许多人一样，被它准确地描述了许多企业中软件开发的混乱“一级”状态所震惊，特别是它提到了对英雄的依赖。它似乎也为组织提供了现实的指导，以提高其流程的水平。

但是，虽然它似乎为改进提供了一个很好的模型和现实的指导，但我从未真正目睹过对 CMM 的坚持对我曾经工作过或合作过的任何组织产生重大的积极影响。我知道一家大型软件咨询公司声称 CMM 5 级 - 最高级别 - 当我亲眼看到他们的流程和其他非 CMM 业务一样混乱，他们的软件产品的质量也多种多样。

所以我想知道，有没有人看到根据 CMM 坚持流程改进带来的真正、切实的好处？

如果您看到了改进，您认为改进是否特别归因于 CMM，或者替代方法（例如[六西格玛](http://en.wikipedia.org/wiki/Six_Sigma)）是否同样或更多有益？

还有人相信吗？

顺便说一句，对于那些还没有看过的人，看看这个有趣的，因为它的真实[模仿](http://en.wikipedia.org/wiki/Capability_Immaturity_Model)

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-15T18:25:17.673

问题的核心在于这个问题，CMM 指南本身巧妙地描述了这个问题......

“<em>...正确的判断对于正确和有洞察力地使用 CMM 是必要的。智慧、经验和知识必须在特定环境中形成对 CMM 的适当解释。这种解释应该基于组织和项目的业务需求和目标。CMM 的死记硬背、以清单为导向的应用程序有可能损害组织而不是帮助它......”</p>

从第 14 页，*能力成熟度模型的*第 1.6 节，卡内基梅隆大学软件工程研究所改进软件过程的指南，ISBN 0-201-54664-7。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-15T18:31:17.283

我发现它很臃肿，主要用作合同获取/维护工具的文档练习。一旦我们签订了合同，那就是绕开流程的练习。

作为一名开发人员，我一无所获，只是浪费了几个月的职业生涯——在 CMMI 上胡闹。

6 Sigma 也是如此，我将其命名为“盒子中的常识”。我不需要接受培训如何找出流程的问题——这通常很明显。

对我来说，小团队和敏捷机制工作得更好。周期短，沟通多。这可能不适用于所有环境，但它绝对适用于我的环境。

只是我的两分钱。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-15T18:27:48.603

如果您看到 CMM 运行。并且跑得快。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-15T19:29:04.370

对于典型的 CMM 1 级编程车间，努力达到 2 级是值得的；这意味着您需要考虑您的流程并将其写下来。当然，这会遇到牛仔程序员的抵制，他们觉得受到标准、文档和测试用例的限制。

从 2 级（“有一个过程”）到 3 级（“每个人都有相同的过程”）的努力通常会陷入部门间的战争，因此可能不值得开始。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-09-15T18:18:34.443

如果您的组织将其试图教授的课程放在心上，CMM 和 CMMI 都会提供一些好处。问题是达到更高的水平非常困难和昂贵，而我唯一一次看到一个组织通过努力是因为他们的客户在合同达到一定水平之前不会让他们投标。

这具有组织尽其所能“只获得数字”的效果，而实际上并不关心改进他们的流程。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-15T18:21:10.913

更高端？不，CMM-5 商店没有给我留下深刻印象。

低端？是的。CMM-1 组织吓到我了。

CMM 可以帮助新/新手团队衡量自己并进行自我改进。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-15T18:20:02.367

CMMI 并不是真的要改进您的软件，而是要记录您所做的事情。您几乎可以通过公司生成的文档的权重来估计公司的 CMMI 级别。

背景：我在我的软件工程研究生课程中学习了 CMMI，并且在一个遵循其指导方针的团队中工作。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-15T18:25:48.780

我的经验是 CMM 非常模糊，很容易实现。此外，当他们来认证您时，他们会查看您的组织选择的项目。我以前工作的地方，这个项目没有真正的截止日期，有很多钱，还有很多时间可以花在过程的每一个角落和缝隙上。许多其他项目在没有版本控制软件的情况下继续进行，几乎没有代码/设计审查。

我认为对 CMM 认证的强调是不幸的。公司知道如何运作系统，并且做到。他们没有专注于满足其底线的实际流程改进，而是专注于获得认证和运行系统。老实说，我认为大多数组织宁愿花时间在前者上，也不愿在后者上浪费太多时间。

真正重要的是让有责任心的人想要做出良好的开发决策，并且知道他们在做出这些决定时需要帮助。没有什么可以替代高素质的程序员，他们知道编程是一项持续的集体活动，他们和其他人一样容易犯错误。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-09-15T18:39:08.887

我一直在为做迭代开发的小团队做很多面试。就个人而言，如果我在简历上看到 CMM，这是一个很大的危险信号，表明对过程的兴趣高于结果。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-15T19:31:57.780

存在所有正式的方法来销售书籍/培训课程/认证，并且没有其他原因。这就是为什么有这么多形式化方法的原因。一旦你意识到这一点，你就自由了:-)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-15T18:20:55.420

Yourdon仍然[相信](http://www.yourdonreport.com/index.php/2008/05/21/moving-beyond-sei-cmm-level-one/)。但他也可能仍然相信世界将因千年虫而终结。

这不是我个人会非常相信或希望在未来被束缚的事情。但通常我们的理由不是……

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-09-15T18:22:44.183

PS 虽然有点跑题，但我想提一下，伪造的 CMMI 认证以及通过贿赂获得的真实认证非常普遍。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-09-15T18:28:54.670

CMM 并没有真正谈论软件的质量，而是更多地谈论过程的文档和可重复性。换句话说，有可能有一个有序且可重复的开发过程，但仍然会创建蹩脚的软件。只要过程被正确记录，就有可能达到 CMM 5 级。

归根结底，CMM 是另一种可以使用或误用的工具。如果最终目标是提高软件质量，则可以使用 CMM 来改进开发过程并提高软件质量。如果目标是达到某个 CMM 级别，那么软件质量很可能会受到影响。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-09-16T06:23:11.957

该模型正在失去它的可信度，首先是因为公司采用该模型不是为了寻找更成熟的软件开发模型，而是要被评估为 CCMI 级别。

另一个问题，我认为导致信誉丧失的问题是，作为承包商，您无法保证您的 CMMI 评估供应商向您出售的项目将使用模型实践开发。CMMi 标签仅表明该公司曾经开发过被评估为符合特定 CMMi 成熟度级别的项目。

问题不仅在于 CMMi，还在于公司开发的流程。CMMi 没有描述流程本身，而只是描述了流程应该做什么。PMBOK 也有同样的问题。实际上问题不仅在于 PMBOK，而主要的问题在于声称遵循 PMI 声明的糟糕项目经理。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-15T18:18:50.933

在学校，我被教导：CMM 是一个好主意，但缺乏认证（任何人都可以说他们是 5 级 / 4 级）它最终成为离岸商店的营销工具。所以，是的，这个想法是合理的，但你如何证明坚持？

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-15T18:22:28.553

我曾经。但现在我发现 CMM 和 CMMI 并不太适合敏捷方法。

哦，当然，您可以挤压东西以将方形钉子放入圆孔中，但是当事关重大时，您的方法仍然基于预测所需一切的能力，并预测将遇到的一切，当构建一个软件系统。

我们都知道，这种方法在现实生活中的效果如何！（-：

干杯，

抢

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-09-15T18:25:43.693

敏捷是下一个 CMM，两者都很脆弱。流程和质量咨询领域在任何行业都是一项很好的业务，就像工程人员一样，每个人都需要新的流行语来保持资金流动。

CMM 刚从 SEI 出来时是一个基于扎实学术工作的好概念，但很快就被流程顾问采纳，现在是一个毫无价值的认证，大多数 CIO 都用它来掩盖他们的屁股（没有人因为选择一家 CMM 5 级公司）

敏捷很快就会沿着这条路走下去，然后我们肯定会很快看到地平线上的下一个灵丹妙药:)

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-09-15T18:28:48.943

当我从事商业飞行软件工作时，我们使用了 CMM，并且随着我们的流程改进，我们准确预测完成时间的能力也提高了。但这是一个繁琐的过程，其他方法应该也可以。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-09-15T19:21:49.893

较小的项目不太依赖成功的过程。关键指标是英雄与旁观者的比率。任何 HTBR 小于 0.2 的项目都会遇到严重的问题。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-10-16T06:30:11.780

有很多好的想法可以很容易地被任何组织为了自己的利益而改编和采用，但是由于需要各种冗余文档，因此获得徽章是一件痛苦的事情。

问题是 CMMi 不是一个过程，而只是您可能选择拥有的任何过程的指南，而这本身就会引发不成熟的想法四处流传。

另一点是，当您开始迁移时，迁移是一个真正的痛苦，但我猜它与任何其他初期问题一样。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2013-04-01T16:51:34.127

理解 CMMi 价值的主要问题是理解 CMMi 本身。

CMMi 是一种记录在案的软件生产持续改进方法。

在制造中理解 SPC 的持续改进已经够难了，但是加上无形的软件产品，难度是指数级的。

我会向任何不熟悉 CMMi 的人或组织推荐：记录他们当前的流程，然后查看可以独立于流程衡量的结果（成本/收益）。这样，如果任何过程，标准程序被改变，它会产生一个“更好”的结果。本练习的先决条件是一个记录在案的、稳定的可重复过程，因为在临时环境中无法衡量任何更改的好处，因为您不是在比较“同类”。

通过最初关注上述概念，组织将开始理解并接受 CMMi 的基本价值。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2015-02-27T13:05:23.020

相传，做了大量承包工作的美国国防部发现，其许多项目都面临时间和成本超支，甚至在交付时，这些项目也与订单不符。

因此，他们想要一种方法来确保承包商能够按时、在预算范围内并接近要求的交付。于是能力成熟度模型诞生了。

论点是，如果事情被写下来，那么它们就会在消耗中幸存下来。但是说写下所有内容是不够的，必须检查它们是否正确写下。除其他事项外。

在所有这一切中，他们从未想过要考虑这样做的成本。因为从国防部的角度来看，如果它以 100 万美元的价格在一年内获得一些东西，但最终在 10 年内支付 1000 万美元却没有得到他们想要的东西，那么现在如果他们有为同样的东西支付 500 万美元，以在两年内得到他们真正想要的东西，他们仍然节省了 500 万美元，更不用说他们实际上得到了一些东西。

因此，如果您是美国国防部或类似机构的承包商，请继续获得 CMM，因为这是一项要求。但是，如果您要在 elance 上与 1000 家软件开发商店竞争，以获取预算有限、时间有限等的项目...... CMM 不是一个好的选择。

也就是说，请随意阅读 CMMI Dev pdf（在撰写本文时为 1.3 版）。它有很多好处。它很好地解构了组织。如果你看到任何让你去的点'啊哈！我有这个问题'，那么一定要用这种智慧来解决你的问题。在我们的案例中，我们所做的一个小改动是确保我们列出了所有被允许向我们提出要求的人。如果有不止一个人被允许向我们提出要求，那么来自一个来源的任何要求都会传给其他人，他们必须在我们将其添加到积压工作之前说“好的”。这个小小的改变对我们的工作和返工产生了很大的影响。

简而言之，查看过程区域并将它们与您的痛点进行比较，并接受 CMM 给出的建议。你实现它的方式是你自己的。而且您始终可以以不花费太多时间或花费太多金钱的方式实施它。但我想这同样适用于相关的 ISO/IEC 标准。

# java - Apache Axis ConfigurationException

> ID：65310
> 
> 赞同：16
> 
> 时间：2008-09-15T18:13:53.037
> 
> 标签：java, apache, axis

I am using Apache Axis to connect my Java app to a web server. I used wsdl2java to create the stubs for me, but when I try to use the stubs, I get the following exception:

> org.apache.axis.ConfigurationException: No service named `<web service name>` is available

any idea?

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2013-07-31T21:19:03.303

According to the [documentation](http://wiki.apache.org/ws/FrontPage/Axis/DealingWithCommonExceptions) linked to by @arnonym, this exception is somewhat misleading. In the first attempt to find the service a ConfigurationException is thrown and caught. It is logged at DEBUG level by the ConfigurationException class. Then another attempt is made using a different method to find the service that may then succeed. The workaround for this is to just change the log level on the ConfigurationException class to INFO in your log4j.properties:

```
log4j.logger.org.apache.axis.ConfigurationException = INFO 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T16:56:16.947

Just a guess, but it looks like that error message is reporting that you've left the service name blank. I imagine the code that generates that error message looks like this:

```
throw new ConfigurationException("No service named" + serviceName + " is available"); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-06-27T16:45:09.527

It is an exception used by Axis' control flow.

[http://wiki.apache.org/ws/FrontPage/Axis/DealingWithCommonExceptions](http://wiki.apache.org/ws/FrontPage/Axis/DealingWithCommonExceptions) --> org.apache.axis.ConfigurationException: No service named XXX is available

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T18:45:18.810

This is what my code looks like. It seems to work fine. Are you using a service locator or just creating your service?

```
SomeServiceLocator locator = new SomeServiceLocator();
SomeService service = null;
try
{
    service = locator.getSomeServiceImplPort();
}
catch (ServiceException e)
{
    e.printStackTrace();
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-14T11:48:12.700

I don't know what version of Axis you're using but I'm using Axis2 for both server and client and the Java2WSDL create a default endpoint for the service on localhost. If you create the client stub with WSDL2Java, the default constructor of the stub will then point to localhost. If the service is on other endpoint you must use the constructor with the endpoint as parameter... Maybe the problem is not that at all but as said on other answers, without the WSDL you're using as WSDL2Java input it's hard to say.

# cocoa - 如何在另一个程序的窗口上发布可可“工作表”？

> ID：65343
> 
> 赞同：2
> 
> 时间：2008-09-15T18:17:11.530
> 
> 标签：cocoa, modal-dialog, daemon, interprocess, interaction

使用 Apple OS X Cocoa 框架，如何在另一个进程的窗口上发布工作*表*（向下滑动模式对话框）？

**编辑：**澄清一点：

我的应用程序是一个 Finder 扩展，用于进行 Subversion 版本控制 ( [http://scplugin.tigris.org/](http://scplugin.tigris.org/) )。我的应用程序的一部分是插件（Finder 的上下文菜单项）；然而，我的大部分应用程序都在一个单独的守护进程中。出于几个原因，我们选择将几乎所有代码都放入守护进程；该插件只定义了菜单本身，并将 Apple-Events 交给了守护进程。

有时，守护程序需要提示用户提供更多信息。它可以为此在屏幕上抛出一个窗口，但这是破坏性的（随机定位），在我看来，这里的工作流程是合法的模式，例如“选择一个文件，从菜单中选择‘提交’，提供提交评论，做手术。”

进程间合作（例如传递某种引用）是可以接受的：两个进程都是我的，但我想避免将工作表的代码绑定到主进程中。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-15T18:34:32.940

真的，听起来您正试图让您的进程间通信发生在视图级别，但这并不是 Cocoa 通常的工作方式。如果您将图层分开多一点，事情会容易得多。

为什么不想将工作表代码放入其他进程？它是视图代码，而视图代码本质上是特定于进程的。正确的做法可能是为您的插件代码添加一些通用的模态表支持，以及您的守护程序可以调用该代码的 IPC 调用。如果你能让它工作的话，试图将视图对象传送到远程进程将是一场噩梦。

您正在使用这种方法与框架作斗争。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T00:12:22.800

您不能将工作表添加到另一个进程中的窗口，因为您最多只能对另一个进程中的窗口进行最受限制的访问。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T20:50:38.713

请不要这样做。如果可能的话，使交互成为非模态的。尤其是在提交之类的事情中，在编写提交评论时能够浏览文件会更好。

OS X 确实有窗口组，但我认为它们不能（轻松）跨越应用程序。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T22:00:41.320

另一件需要考虑的事情是，在 OS X 中，可以在同一个文件夹中打开多个 Finder 窗口（与 OS 9 不同）。即使您**确实**有足够的权限/API 将工作表添加到 Finder 窗口，但该窗口的模式不会阻止用户继续使用文件。

（作为 Mac 的老用户，我个人的看法是，这种交互方式会让我崩溃。）

# c# - C#中泛型参数的空值或默认比较

> ID：65351
> 
> 赞同：316
> 
> 时间：2008-09-15T18:17:59.190
> 
> 标签：c#, generics

我有一个这样定义的通用方法：

```
public void MyMethod<T>(T myArgument) 
```

我要做的第一件事是检查 myArgument 的值是否是该类型的默认值，如下所示：

```
if (myArgument == default(T)) 
```

但这不能编译，因为我不能保证 T 会实现 == 运算符。所以我将代码切换为：

```
if (myArgument.Equals(default(T))) 
```

现在可以编译，但如果 myArgument 为空，则将失败，这是我正在测试的一部分。我可以像这样添加一个明确的空检查：

```
if (myArgument == null || myArgument.Equals(default(T))) 
```

现在这对我来说是多余的。ReSharper 甚至建议我将 myArgument == null 部分更改为 myArgument == default(T) ，这是我开始的地方。有没有更好的方法来解决这个问题？

我需要同时支持**引用**类型和值类型。

* * *

## 回答 #1

> 赞同：673
> 
> 时间：2009-05-14T18:11:23.613

为避免装箱，比较泛型是否相等的最佳方法是使用`EqualityComparer<T>.Default`. 这尊重`IEquatable<T>`（没有拳击）以及`object.Equals`, 并处理所有`Nullable<T>`“提升”的细微差别。因此：

```
if(EqualityComparer<T>.Default.Equals(obj, default(T))) {
    return obj;
} 
```

这将匹配：

*   类为空
*   空（空）为`Nullable<T>`
*   其他结构的零/假/等

* * *

## 回答 #2

> 赞同：121
> 
> 时间：2008-09-15T18:30:54.180

这个怎么样：

```
if (object.Equals(myArgument, default(T)))
{
    //...
} 
```

使用该`static object.Equals()`方法可以避免您`null`自己进行检查。`object.`根据您的上下文，可能不需要显式地限定调用，但我通常`static`在调用前加上类型名称，以使代码更易溶解。

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2008-09-15T18:26:37.110

我能够找到一篇详细讨论此问题的[Microsoft Connect 文章](http://msdn.microsoft.com/en-us/library/system.icomparable.compareto.aspx)：

> 不幸的是，这种行为是设计使然，并且没有简单的解决方案可以使用可能包含值类型的类型参数。
> 
> 如果已知类型是引用类型，则在对象上定义的默认重载会测试变量的引用相等性，尽管类型可以指定其自己的自定义重载。编译器根据变量的静态类型确定使用哪个重载（确定不是多态的）。因此，如果您更改示例以将泛型类型参数 T 约束为非密封引用类型（例如 Exception），编译器可以确定要使用的特定重载，并且将编译以下代码：

```
public class Test<T> where T : Exception 
```

> 如果已知类型是值类型，则根据使用的确切类型执行特定的值相等测试。这里没有好的“默认”比较，因为引用比较对值类型没有意义，并且编译器不知道要发出哪个特定的值比较。编译器可以发出对 ValueType.Equals(Object) 的调用，但此方法使用反射并且与特定值比较相比效率很低。因此，即使您要在 T 上指定值类型约束，编译器在此处生成的内容也不合理：

```
public class Test<T> where T : struct 
```

> 在您介绍的情况下，编译器甚至不知道 T 是值类型还是引用类型，同样没有生成对所有可能类型有效的内容。引用比较对值类型无效，并且对于不重载的引用类型，某种值比较将是意外的。

这是您可以做的...

我已经验证这两种方法都适用于引用和值类型的通用比较：

```
object.Equals(param, default(T)) 
```

或者

```
EqualityComparer<T>.Default.Equals(param, default(T)) 
```

要使用“==”运算符进行比较，您需要使用以下方法之一：

如果 T 的所有情况都派生自已知的基类，则可以使用泛型类型限制让编译器知道。

```
public void MyMethod<T>(T myArgument) where T : MyBase 
```

然后编译器会识别如何执行操作`MyBase`并且不会抛出您现在看到的“运算符'=='不能应用于'T'和'T'类型的操作数”错误。

另一种选择是将 T 限制为任何实现`IComparable`.

```
public void MyMethod<T>(T myArgument) where T : IComparable 
```

然后使用[IComparable 接口](http://msdn.microsoft.com/en-us/library/system.icomparable.compareto.aspx)`CompareTo`定义的方法。

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2008-09-15T18:33:29.090

试试这个：

```
if (EqualityComparer<T>.Default.Equals(myArgument, default(T))) 
```

那应该编译，并做你想做的事。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-05-14T16:14:00.807

（已编辑）

Marc Gravell 给出了最好的答案，但我想发布一个简单的代码片段来演示它。只需在一个简单的 C# 控制台应用程序中运行它：

```
public static class TypeHelper<T>
{
    public static bool IsDefault(T val)
    {
         return EqualityComparer<T>.Default.Equals(obj,default(T));
    }
}

static void Main(string[] args)
{
    // value type
    Console.WriteLine(TypeHelper<int>.IsDefault(1)); //False
    Console.WriteLine(TypeHelper<int>.IsDefault(0)); // True

    // reference type
    Console.WriteLine(TypeHelper<string>.IsDefault("test")); //False
    Console.WriteLine(TypeHelper<string>.IsDefault(null)); //True //True

    Console.ReadKey();
} 
```

还有一件事：有 VS2008 的人可以试试这个作为扩展方法吗？我在这里坚持使用 2005 年，我很想知道这是否会被允许。

* * *

**编辑：**以下是如何让它作为扩展方法工作：

```
using System;
using System.Collections.Generic;

class Program
{
    static void Main()
    {
        // value type
        Console.WriteLine(1.IsDefault());
        Console.WriteLine(0.IsDefault());

        // reference type
        Console.WriteLine("test".IsDefault());
        // null must be cast to a type
        Console.WriteLine(((String)null).IsDefault());
    }
}

// The type cannot be generic
public static class TypeHelper
{
    // I made the method generic instead
    public static bool IsDefault<T>(this T val)
    {
        return EqualityComparer<T>.Default.Equals(val, default(T));
    }
} 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-05-14T16:16:09.427

要处理所有类型的 T，包括其中 T 是原始类型，您需要在两种比较方法中进行编译：

```
 T Get<T>(Func<T> createObject)
    {
        T obj = createObject();
        if (obj == null || obj.Equals(default(T)))
            return obj;

        // .. do a bunch of stuff
        return obj;
    } 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2020-02-18T12:50:58.073

基于已接受答案的扩展方法。

```
 public static bool IsDefault<T>(this T inObj)
   {
       return EqualityComparer<T>.Default.Equals(inObj, default);
   } 
```

用法：

```
 private bool SomeMethod(){
       var tValue = GetMyObject<MyObjectType>();
       if (tValue == null || tValue.IsDefault()) return false;
   } 
```

与 null 交替以简化：

```
 public static bool IsNullOrDefault<T>(this T inObj)
   {
       if (inObj == null) return true;
       return EqualityComparer<T>.Default.Equals(inObj, default);
   } 
```

用法：

```
 private bool SomeMethod(){
       var tValue = GetMyObject<MyObjectType>();
       if (tValue.IsNullOrDefault()) return false;
   } 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-05-14T16:16:55.697

这里会有问题——

如果您要允许它适用于任何类型，则 default(T) 对于引用类型将始终为 null，对于值类型将始终为 0（或 struct full of 0）。

不过，这可能不是您所追求的行为。如果您希望它以通用方式工作，您可能需要使用反射来检查 T 的类型，并处理与引用类型不同的值类型。

或者，您可以对此设置接口约束，并且该接口可以提供一种方法来检查类/结构的默认值。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-24T12:23:07.600

我认为您可能需要将此逻辑分成两部分并首先检查 null 。

```
public static bool IsNullOrEmpty<T>(T value)
{
    if (IsNull(value))
    {
        return true;
    }
    if (value is string)
    {
        return string.IsNullOrEmpty(value as string);
    }
    return value.Equals(default(T));
}

public static bool IsNull<T>(T value)
{
    if (value is ValueType)
    {
        return false;
    }
    return null == (object)value;
} 
```

在 IsNull 方法中，我们依赖于 ValueType 对象根据定义不能为 null 的事实，因此如果 value 恰好是派生自 ValueType 的类，我们已经知道它不为 null。另一方面，如果它不是值类型，那么我们可以将转换为对象的值与 null 进行比较。我们可以通过直接对对象进行强制转换来避免对 ValueType 的检查，但这意味着值类型会被装箱，这是我们可能想要避免的，因为这意味着在堆上创建了一个新对象。

在 IsNullOrEmpty 方法中，我们正在检查字符串的特殊情况。对于所有其他类型，我们将值（已经知道*不*为空）与它的默认值进行比较，对于所有引用类型，默认值都是空的，对于值类型，通常是某种形式的零（如果它们是整数）。

使用这些方法，以下代码的行为与您可能预期的一样：

```
class Program
{
    public class MyClass
    {
        public string MyString { get; set; }
    }

    static void Main()
    {
        int  i1 = 1;    Test("i1", i1); // False
        int  i2 = 0;    Test("i2", i2); // True
        int? i3 = 2;    Test("i3", i3); // False
        int? i4 = null; Test("i4", i4); // True

        Console.WriteLine();

        string s1 = "hello";      Test("s1", s1); // False
        string s2 = null;         Test("s2", s2); // True
        string s3 = string.Empty; Test("s3", s3); // True
        string s4 = "";           Test("s4", s4); // True

        Console.WriteLine();

        MyClass mc1 = new MyClass(); Test("mc1", mc1); // False
        MyClass mc2 = null;          Test("mc2", mc2); // True
    }

    public static void Test<T>(string fieldName, T field)
    {
        Console.WriteLine(fieldName + ": " + IsNullOrEmpty(field));
    }

    // public static bool IsNullOrEmpty<T>(T value) ...

    // public static bool IsNull<T>(T value) ...
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-07-08T23:55:16.147

我用：

```
public class MyClass<T>
{
  private bool IsNull() 
  {
    var nullable = Nullable.GetUnderlyingType(typeof(T)) != null;
    return nullable ? EqualityComparer<T>.Default.Equals(Value, default(T)) : false;
  }
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-02-23T04:59:18.890

只是一个骇人听闻的答案，并作为对自己的提醒。但我发现这对我的项目很有帮助。我这样写的原因是因为如果值为 0，我不希望默认整数 0 被标记为 null

```
private static int o;
public static void Main()
{
    //output: IsNull = False -> IsDefault = True
    Console.WriteLine( "IsNull = " + IsNull( o ) + " -> IsDefault = " + IsDefault(o)); 
}

public static bool IsNull<T>(T paramValue)
{
  if( string.IsNullOrEmpty(paramValue + "" ))
    return true;
  return false;
}

public static bool IsDefault<T>(T val)
{
  return EqualityComparer<T>.Default.Equals(val, default(T));
} 
```

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2008-09-15T18:32:35.080

不知道这是否符合您的要求，但您可以将 T 限制为实现 IComparable 等接口的类型，然后使用该接口中的 ComparesTo() 方法（IIRC 支持/处理空值）像这样：

```
public void MyMethod<T>(T myArgument) where T : IComparable
...
if (0 == myArgument.ComparesTo(default(T))) 
```

您可能还可以使用其他接口 IEquitable 等。

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2008-09-15T18:37:39.437

@ilitirit：

```
public class Class<T> where T : IComparable
{
    public T Value { get; set; }
    public void MyMethod(T val)
    {
        if (Value == val)
            return;
    }
} 
```

运算符“==”不能应用于“T”和“T”类型的操作数

如果没有显式的空测试，然后调用 Equals 方法或 object.Equals，我想不出一种方法，如上所述。

您可以使用 System.Comparison 设计一个解决方案，但实际上这最终会导致更多的代码行并大大增加复杂性。

* * *

## 回答 #14

> 赞同：-3
> 
> 时间：2011-07-28T10:56:46.303

我想你很接近。

```
if (myArgument.Equals(default(T))) 
```

现在可以编译，但如果`myArgument`为 null 则会失败，这是我正在测试的一部分。我可以像这样添加一个明确的空检查：

您只需要反转调用 equals 的对象即可获得优雅的 null 安全方法。

```
default(T).Equals(myArgument); 
```

# c# - 如何在.net 中发布 wmi 类？

> ID：65364
> 
> 赞同：2
> 
> 时间：2008-09-15T18:20:07.373
> 
> 标签：c#, .net, .net-3.5, .net-2.0, wmi

我创建了一个单独的程序集，其中包含一个旨在通过 wmi 发布的类。然后我创建了一个 Windows 窗体应用程序，它引用了该程序集并尝试发布该类。当我尝试发布该类时，我收到 System.Management.Instrumentation.WmiProviderInstallationException 类型的异常。异常消息显示“抛出了‘System.Management.Instrumentation.WMIInfraException’类型的异常。”。我不知道这是什么意思。我已经尝试过 .Net2.0 和 .Net3.5（也是 sp1）并得到相同的结果。

下面是我的 wmi 类，后面是我用来发布它的代码。

```
//Interface.cs in assembly WMI.Interface.dll

using System;
using System.Collections.Generic;
using System.Text;

[assembly: System.Management.Instrumentation.WmiConfiguration(@"root\Test",
    HostingModel = 
System.Management.Instrumentation.ManagementHostingModel.Decoupled)]

namespace WMI
{
    [System.ComponentModel.RunInstaller(true)]
    public class MyApplicationManagementInstaller :
        System.Management.Instrumentation.DefaultManagementInstaller { }

    [System.Management.Instrumentation.ManagementEntity(Singleton = true)]
    [System.Management.Instrumentation.ManagementQualifier("Description",
        Value = "Obtain processor information.")]
    public class Interface
    {
        [System.Management.Instrumentation.ManagementBind]
        public Interface()
        {
        }

        [System.Management.Instrumentation.ManagementProbe]
        [System.Management.Instrumentation.ManagementQualifier("Descriiption",
            Value="The number of processors.")]
        public int ProcessorCount
        {
            get { return Environment.ProcessorCount; }
        }
    }
} 
```

```
//Button click in windows forms application to publish class
try
{
    System.Management.Instrumentation.InstrumentationManager.Publish(new 
WMI.Interface());
}
catch (System.Management.Instrumentation.InstrumentationException 
exInstrumentation)
{
    MessageBox.Show(exInstrumentation.ToString());
}
catch (System.Management.Instrumentation.WmiProviderInstallationException 
exProvider)
{
    MessageBox.Show(exProvider.ToString());
}
catch (Exception exPublish)
{
    MessageBox.Show(exPublish.ToString());
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-18T21:18:01.133

总而言之，这是最终有效的代码：

提供者类，在它自己的程序集中：

```
// the namespace used for publishing the WMI classes and object instances 
[assembly: Instrumented("root/mytest")]

using System;
using System.Collections.Generic;
using System.Text;
using System.Management;
using System.Management.Instrumentation;
using System.Configuration.Install;
using System.ComponentModel;

namespace WMITest
{

    [InstrumentationClass(System.Management.Instrumentation.InstrumentationType.Instance)] 
    //[ManagementEntity()]
    //[ManagementQualifier("Description",Value = "Obtain processor information.")]
    public class MyWMIInterface
    {
        //[System.Management.Instrumentation.ManagementBind]
        public MyWMIInterface()
        {
        }

        //[ManagementProbe]
        //[ManagementQualifier("Descriiption", Value="The number of processors.")]
        public int ProcessorCount
        {
            get { return Environment.ProcessorCount; }
        }
    }

    /// <summary>
    /// This class provides static methods to publish messages to WMI
    /// </summary>
    public static class InstrumentationProvider
    {
        /// <summary>
        /// publishes a message to the WMI repository
        /// </summary>
        /// <param name="MessageText">the message text</param>
        /// <param name="Type">the message type</param>
        public static MyWMIInterface Publish()
        {
            // create a new message
            MyWMIInterface pInterface = new MyWMIInterface();

            Instrumentation.Publish(pInterface);

            return pInterface;
        }

        /// <summary>
        /// revoke a previously published message from the WMI repository
        /// </summary>
        /// <param name="Message">the message to revoke</param>
        public static void Revoke(MyWMIInterface pInterface)
        {
            Instrumentation.Revoke(pInterface);
        }        
    }

    /// <summary>
    /// Installer class which will publish the InfoMessage to the WMI schema
    /// (the assembly attribute Instrumented defines the namespace this
    /// class gets published too
    /// </summary>
    [RunInstaller(true)]
    public class WMITestManagementInstaller :
        DefaultManagementProjectInstaller
    {
    }
} 
```

Windows 窗体应用程序主窗体，发布提供程序类：

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Text;
using System.Windows.Forms;
using System.Management;
using System.Management.Instrumentation;

namespace WMI
{
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
        }

        WMITest.MyWMIInterface pIntf_m;

        private void btnPublish_Click(object sender, EventArgs e)
        {
            try
            {
                pIntf_m = WMITest.InstrumentationProvider.Publish();
            }
            catch (ManagementException exManagement)
            {
                MessageBox.Show(exManagement.ToString());
            }
            catch (Exception exPublish)
            {
                MessageBox.Show(exPublish.ToString());
            }
        }
    }
} 
```

测试 Web 应用程序，消费者：

```
using System;
using System.Data;
using System.Configuration;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Web.UI.HtmlControls;
using System.Management.Instrumentation;
using System.Management;

public partial class _Default : System.Web.UI.Page 
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
        {
            ManagementClass pWMIClass = null;

            pWMIClass = new ManagementClass(@"root\interiorhealth:MyWMIInterface");

            lblOutput.Text = "ClassName: " + pWMIClass.ClassPath.ClassName + "<BR/>" +
                 "IsClass: " + pWMIClass.ClassPath.IsClass + "<BR/>" +
                 "IsInstance: " + pWMIClass.ClassPath.IsInstance + "<BR/>" +
                 "IsSingleton: " + pWMIClass.ClassPath.IsSingleton + "<BR/>" +
                 "Namespace Path: " + pWMIClass.ClassPath.NamespacePath + "<BR/>" +
                 "Path: " + pWMIClass.ClassPath.Path + "<BR/>" +
                 "Relative Path: " + pWMIClass.ClassPath.RelativePath + "<BR/>" +
                 "Server: " + pWMIClass.ClassPath.Server + "<BR/>";

            //GridView control
            this.gvProperties.DataSource = pWMIClass.Properties;
            this.gvProperties.DataBind();

            //GridView control
            this.gvSystemProperties.DataSource = pWMIClass.SystemProperties;
            this.gvSystemProperties.DataBind();

            //GridView control
            this.gvDerivation.DataSource = pWMIClass.Derivation;
            this.gvDerivation.DataBind();

            //GridView control
            this.gvMethods.DataSource = pWMIClass.Methods;
            this.gvMethods.DataBind();

            //GridView control
            this.gvQualifiers.DataSource = pWMIClass.Qualifiers;
            this.gvQualifiers.DataBind();
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T05:34:30.187

我使用 gacutil - installutil 来测试你的类（作为一个 dll）。gacutil 部分有效，但 installutil（实际上是 mofcomp）抱怨语法错误：

...

错误语法 0X80044014：类名中有意外字符（必须是标识符）

编译器返回错误 0x80044014

...

所以我将类名更改为'MyInterface' installutil 部分工作，但该类没有返回任何实例。最后，我将托管模型更改为网络服务并让它工作。

# python - 如何使用元类添加方法

> ID：65400
> 
> 赞同：10
> 
> 时间：2008-09-15T18:24:14.557
> 
> 标签：python, metaclass

如何使用元类向类添加实例方法（是的，我确实需要使用元类）？以下类型的作品，但 func_name 仍将是“foo”：

```
def bar(self):
    print "bar"

class MetaFoo(type):
    def __new__(cls, name, bases, dict):
        dict["foobar"] = bar
        return type(name, bases, dict)

class Foo(object):
    __metaclass__ = MetaFoo

>>> f = Foo()
>>> f.foobar()
bar
>>> f.foobar.func_name
'bar' 
```

我的问题是一些库代码实际上使用了 func_name 并且后来找不到 Foo 实例的 'bar' 方法。我可以做：

```
dict["foobar"] = types.FunctionType(bar.func_code, {}, "foobar") 
```

还有 types.MethodType，但我需要一个尚不存在的实例来使用它。我在这里错过了什么吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-15T19:01:27.850

尝试以可以利用 mro 的方式动态扩展基础，并且这些方法是实际方法：

```
class Parent(object):
    def bar(self):
        print "bar"

class MetaFoo(type):
    def __new__(cls, name, bases, dict):
        return type(name, (Parent,) + bases, dict)

class Foo(object):
    __metaclass__ = MetaFoo

if __name__ == "__main__":
    f = Foo()
    f.bar()
    print f.bar.func_name 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-15T18:57:29.750

我想你想要做的是：

```
>>> class Foo():
...   def __init__(self, x):
...     self.x = x
... 
>>> def bar(self):
...   print 'bar:', self.x
... 
>>> bar.func_name = 'foobar'
>>> Foo.foobar = bar
>>> f = Foo(12)
>>> f.foobar()
bar: 12
>>> f.foobar.func_name
'foobar' 
```

现在您可以自由地将`Foo`s 传递给期望`Foo`实例具有名为 的方法的库`foobar`。

不幸的是，（1）我不知道如何使用元类和（2）我不确定我是否正确阅读了你的问题，但我希望这会有所帮助。

请注意，`func_name`它只能在 Python 2.4 及更高版本中分配。

# lucene - 如何估计 Lucene 索引的大小？

> ID：65406
> 
> 赞同：8
> 
> 时间：2008-09-15T18:24:46.660
> 
> 标签：lucene

是否有一个已知的数学公式可以用来估计新的 Lucene 索引的大小？我知道我想要索引多少个字段，以及每个字段的大小。而且，我知道有多少项目将被编入索引。那么，一旦这些被 Lucene 处理，它是如何转化为字节的呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T09:03:14.910

这是[lucene 索引格式文档](http://lucene.apache.org/core/3_6_1/fileformats.html)。主要文件是复合索引（.cfs 文件）。如果您有术语统计信息，您可能可以获得 .cfs 文件大小的估计值，请注意，这会根据您使用的分析器和您定义的字段类型而有很大差异。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-10-08T18:13:13.670

索引存储每个“令牌”或文本字段等，仅一次......因此大小取决于被索引的材料的性质。再加上正在存储的任何内容。一种好的方法可能是抽取样本并将其编入索引，并使用它来推断完整的源集合。但是，索引大小与源大小的比率也会随着时间的推移而减小，因为索引中已经存在单词，因此您可能希望使样本占原始样本的相当大的百分比。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T18:59:42.210

我认为这也与每个术语的频率有关（即 10,000 个相同术语的索引应该远小于 10,000 个完全唯一术语的索引）。

此外，您是否使用术语向量以及是否存储字段可能有一点依赖性。你能提供更多细节吗？你能分析你的源数据的词频吗？

# objective-c - NSAutoreleasePool 自动释放池是如何工作的？

> ID：65427
> 
> 赞同：96
> 
> 时间：2008-09-15T18:27:33.847
> 
> 标签：objective-c, memory-management, nsautoreleasepool, foundationkit

据我了解，使用**alloc**、**new**或**copy**创建的任何内容都需要手动发布。例如：

```
int main(void) {
    NSString *string;
    string = [[NSString alloc] init];
    /* use the string */
    [string release];
} 
```

不过，我的问题是，这不是同样有效吗？：

```
int main(void) {
    NSAutoreleasePool *pool;
    pool = [[NSAutoreleasePool alloc] init];
    NSString *string;
    string = [[[NSString alloc] init] autorelease];
    /* use the string */
    [pool drain];
} 
```

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2008-09-15T18:36:18.457

是的，您的第二个代码片段是完全有效的。

每次将 -autorelease 发送到对象时，都会将其添加到最内层的自动释放池中。当池被耗尽时，它只是向池中的所有对象发送-release。

自动释放池只是一种方便，它允许您将发送 -release 推迟到“稍后”。“稍后”可能发生在几个地方，但在 Cocoa GUI 应用程序中最常见的是在当前运行循环周期的末尾。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2008-10-08T01:14:52.060

## NSAutoreleasePool：流失与释放

由于`drain`and的功能`release`似乎会引起混淆，因此可能值得在这里澄清（尽管这在[文档](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSAutoreleasePool_Class/Reference/Reference.html#//apple_ref/occ/instm/NSAutoreleasePool/drain)中有所介绍......）。

*严格来说*，从大局来看`drain`并不等同于：*`release`*

 *在引用计数环境中，`drain`确实执行与 相同的操作`release`，因此两者在这个意义上是等效的。需要强调的是，这意味着如果您使用而*不是*.`drain``release`

在垃圾收集环境中，`release`是无操作的。因此它没有效果。 `drain`另一方面，它包含对收集器的提示，即它应该“在需要时收集”。因此，在垃圾收集环境中，使用`drain`有助于系统平衡收集扫描。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2011-11-03T07:02:21.997

正如已经指出的那样，您的第二个代码片段是正确的。

我想建议一种更简洁的方式来使用适用于所有环境（引用计数、GC、ARC）的自动释放池，并且还可以避免排放/释放混淆：

```
int main(void) {
  @autoreleasepool {
    NSString *string;
    string = [[[NSString alloc] init] autorelease];
    /* use the string */
  }
} 
```

在上面的示例中，请注意**@autoreleasepool**块。这[在此处](http://developer.apple.com/library/mac/#documentation/Cocoa/Reference/Foundation/Classes/NSAutoreleasePool_Class/Reference/Reference.html)记录。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-15T23:55:44.463

不你错了。文档明确指出，在非 GC 下，-drain 等价于 -release，这意味着 NSAutoreleasePool**不会**被泄露。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-02-20T13:27:30.943

我从 Apple 那里读到的内容：“在自动释放池块的末尾，在块内收到自动释放消息的对象会收到一条释放消息——对象每次在块内收到自动释放消息时都会收到一条释放消息。 "

[https://developer.apple.com/library/mac/documentation/cocoa/conceptual/MemoryMgmt/Articles/mmAutoreleasePools.html](https://developer.apple.com/library/mac/documentation/cocoa/conceptual/MemoryMgmt/Articles/mmAutoreleasePools.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-06-27T13:07:08.080

向对象发送 autorelease 而不是 release 可以延长该对象的生命周期，至少直到池本身被耗尽（如果该对象随后被保留，则可能会更长）。一个对象可以多次放入同一个池中，在这种情况下，每次放入池中都会收到一条释放消息。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-09-15T18:39:48.997

是和不是。如果您在垃圾收集（不是内存管理）环境下运行它，您最终会释放字符串内存，但通过使用排水而不是释放将 NSAutoreleasePool 对象“泄漏”到内存中。这种“泄漏”只会使 NSAutoreleasePool 的实例“无法访问”，就像在 GC 下没有强指针的任何其他对象一样，并且该对象将在下次 GC 运行时被清理，这很可能是直接在调用之后`-drain`：

> 流走
> 
> 在垃圾收集环境中，如果自上次收集后分配的内存大于当前阈值，则触发垃圾收集；否则表现为释放。...在垃圾收集环境中，此方法最终调用`objc_collect_if_needed`.

否则，它类似于`-release`在非 GC 下的行为，是的。正如其他人所说，`-release`是 GC 下的无操作，因此确保池在 GC 下正常运行的唯一方法是 through `-drain`，并且`-drain`在非 GC 下的工作方式与非 GC`-release`下完全相同，并且可以更清楚地传达其功能好。

我应该指出，您的声明“用 new、alloc 或 init 调用的任何东西”都不应该包括“init”（但应该包括“copy”），因为“init”不分配内存，它只设置对象（构造函数时尚）。如果你收到一个分配的对象并且你的函数只调用了 init，你不会释放它：

```
- (void)func:(NSObject*)allocd_but_not_init
{
    [allocd_but_not_init init];
} 
```

这不会消耗比您已经开始使用的内存更多的内存（假设 init 不实例化对象，但无论如何您都不对这些负责）。

# windows - 检测 WinHelp 是否安装在 Vista 或更新的 Windows 上

> ID：65431
> 
> 赞同：1
> 
> 时间：2008-09-15T18:27:53.533
> 
> 标签：windows, windows-vista, windows-server-2008, winhelp

是否有可靠的方法来检测 Windows Vista 或更新版本的 Windows 上是否安装了 WinHelp？如果可能的话，我想要一个不特定于任何特定 Windows 版本的解决方案。

我已将此问题发布到其他留言板上，并在安装 Microsoft 记录的 WinHelp 和注册表条目之前和之后得到了有关 Winhlp32.exe 大小的答案，但没有一个是正确的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T20:22:43.080

从 Microsoft 下载的 WinHelp 似乎是启用 WinHelp 程序的修补程序 (.msu)。这可以解释为什么大小/注册表项不会更改，因为修补程序只是原始文件的“增量”更改。

由于它是一个修补程序，这意味着您应该能够查询为您的操作系统安装的修补程序。

以下命令会生成一个 .htm 文档，其中列出了所有已安装的修补程序。

```
wmic qfe list full /format:htable >C:\hotfixes.htm 
```

生成的表列出了与已安装的修补程序相对应的知识库文章。您可以搜索“917607”，因为如果您安装了 WinHelp 修补程序，它应该存在。您可以将不同的选项传递给该实用程序以执行更好的搜索。注意 - wmic 命令需要管理员权限才能运行。

[链接到 WinHelp 上的 Microsoft 知识库文章](http://www.microsoft.com/downloads/details.aspx?FamilyId=6EBCFAD9-D3F5-4365-8070-334CD175D4BB&displaylang=en)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T11:31:21.717

除了试图说服管理层解决这种方法的问题外，您还可以查看 Windows 注册表。

基本上，如果 WinHelp 已注册，则存在以下注册表项：

*   HKEY_CLASSES_ROOT \ .hlp ->（默认）= hlpfile

*   HKEY_CLASSES_ROOT\hlpfile\shell\open\command\（默认）包含字符串“winhlp32.exe”

如果这两个值都正确，则 winhelp 可用并已注册。您还可以从此处检索 winhlp32.exe 的位置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T18:56:53.480

我不想这么说，但从 WinHelp 继续。它已被弃用是有原因的。我们能够在几个小时内迁移到 .chm。使用较新的帮助创作工具非常简单，而 .chm 等较新的格式为您提供了级联样式表等好处。

# javascript - 在页面 DOM 加载时收到通知（但在 window.onload 之前）

> ID：65434
> 
> 赞同：7
> 
> 时间：2008-09-15T18:28:43.860
> 
> 标签：javascript, dom

我知道有一些方法可以在页面正文加载时获得通知（在所有图像和第 3 方资源加载触发**window.onload**事件之前），但对于每个浏览器来说都是不同的。

是否有明确的方法可以在所有浏览器上执行此操作？

到目前为止，我知道：

*   **DOMContentLoaded**：在 Mozilla、Opera 9 和最新的 WebKits 上。这涉及向事件添加侦听器：

    document.addEventListener("DOMContentLoaded", [初始化函数], false );

*   **延迟脚本**：在 IE 上，您可以发出带有 @defer 属性的 SCRIPT 标记，该标记仅在 BODY 标记关闭后才会可靠地加载。

*   **轮询**：在其他浏览器上，您可以继续进行轮询，但是是否有标准的事情可以轮询，或者您需要在每个浏览器上做不同的事情？

我希望能够不使用 document.write 或外部文件。

这可以通过 jQuery 简单地完成：

```
$(document).ready(function() { ... }) 
```

但是，我正在编写一个 JS 库，不能指望 jQuery 总是在那里。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-15T18:40:52.987

没有跨浏览器的方法来检查 DOM 何时准备就绪——这就是为什么存在像 jQuery 这样的库，以抽象出令人讨厌的一点点不兼容性。

Mozilla、Opera 和现代 WebKit 支持该`DOMContentLoaded`活动。IE 和 Safari 需要一些奇怪的技巧，比如滚动窗口或检查样式表。血淋淋的细节包含在 jQuery 的`bindReady()`函数中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-15T21:27:08.703

我找到了这个页面，它显示了一个紧凑的独立解决方案。它似乎适用于每个浏览器，并解释了如何：

[http://www.kryogenix.org/days/2007/09/26/shortloaded](http://www.kryogenix.org/days/2007/09/26/shortloaded)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-15T18:45:43.897

YUI 使用三个测试来做到这一点：对于 Firefox 和最近的 WebKit，有一个 DOMContentLoaded 事件被触发。对于较旧的 Safari，document.readyState 一直在观察，直到它变为“已加载”或“完成”。对于 IE，会创建一个 HTML <P> 标记并调用“doScroll()”方法，如果 DOM 未准备好，该方法会出错。[YAHOO.util.Event](http://developer.yahoo.com/yui/docs/Event.js.html)的源代码显示了特定于 YUI 的代码。在 Event.js 中搜索“doScroll”。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-15T19:50:20.153

使用像 jQuery 这样的库将为您节省无数小时的浏览器不一致问题。

在这种情况下，使用 jQuery 你可以

```
$(document).ready ( function () {
    //your code here
}); 
```

如果您好奇，您可以查看源代码以了解它是如何完成的，但是在这个时代，当图书馆作者为您完成所有痛苦的工作时，我认为没有人应该重新发明这个轮子。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-15T18:32:15.363

只需从 jQuery 中获取相关的代码，John Resig 已经在 jQuery 中涵盖了这个问题的大部分基础。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T10:37:11.767

为什么不这样：

```
<body>  
  <!-- various content -->  
  <script type="text/javascript">  
  <!--  
    myInit();  
  -->
  </script>  
</body> 
```

如果我理解正确，myInit 将在浏览器在页面中点击它时立即执行，这是正文中的最后一件事。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-03-11T12:15:07.860

您正在寻找的花哨的跨浏览器解决方案......不存在......（想象一大群人说“啊啊啊......”的声音）。

**DomContentLoaded**是您最好的选择。您仍然需要`polling`IE-oldies 的技术。

1.  尝试使用 addEventListener；
2.  如果不可用（显然是 IE），请检查框架；
3.  如果不是帧，则滚动直到没有抛出错误（轮询）；
4.  如果是frame，使用IE事件document.onreadystatechange；
5.  对于其他不支持的浏览器，请使用旧的 document.onload 事件。

我在[javascript.info](http://javascript.info/tutorial/onload-ondomcontentloaded#the-crossbrowser-domcontentloaded-handling-code)上找到了以下代码示例，您可以使用它来覆盖所有浏览器：

```
function bindReady(handler){

    var called = false

    function ready() { 
        if (called) return
        called = true
        handler()
    }

    if ( document.addEventListener ) { // native event
        document.addEventListener( "DOMContentLoaded", ready, false )
    } else if ( document.attachEvent ) {  // IE

        try {
            var isFrame = window.frameElement != null
        } catch(e) {}

        // IE, the document is not inside a frame
        if ( document.documentElement.doScroll && !isFrame ) {
            function tryScroll(){
                if (called) return
                try {
                    document.documentElement.doScroll("left")
                    ready()
                } catch(e) {
                    setTimeout(tryScroll, 10)
                }
            }
            tryScroll()
        }

        // IE, the document is inside a frame
        document.attachEvent("onreadystatechange", function(){
            if ( document.readyState === "complete" ) {
                ready()
            }
        })
    }

    // Old browsers
    if (window.addEventListener)
        window.addEventListener('load', ready, false)
    else if (window.attachEvent)
        window.attachEvent('onload', ready)
    else {
        var fn = window.onload // very old browser, copy old onload
        window.onload = function() { // replace by new onload and call the old one
            fn && fn()
            ready()
        }
    }
} 
```

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2008-09-15T18:35:11.223

这很好用：

```
setTimeout(MyInitFunction, 0); 
```

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2008-09-16T09:10:47.920

使用 setTimeout 可以很好地工作，尽管它何时执行取决于浏览器。如果您通过零作为超时时间，浏览器将在事情“解决”时执行。

这样做的好处是您可以拥有许多，而不必担心链接 onLoad 事件。

```
setTimeout(myFunction, 0);
setTimeout(anotherFunction, 0);
setTimeout(function(){ doSomething ...}, 0); 
```

等等

它们都将在文档加载完成后运行，或者如果您在文档加载后设置了一个，它们将在您的脚本完成运行后运行。

它们运行的​​顺序是不确定的，并且可以在浏览器之间改变。因此，例如，您不能指望在`myFunction`之前运行`anotherFunction`。

# database - 从 oracle 数据库获取数据作为 CSV 文件（或任何其他自定义文本格式）

> ID：65447
> 
> 赞同：3
> 
> 时间：2008-09-15T18:31:14.163
> 
> 标签：database, oracle

连接到 oracle 数据库、执行简单的 SELECT 查询并将结果以 CSV 格式输出到标准输出的示例 perl 脚本会很棒。Python 或任何其他在典型的 unix 发行版中可用的语言也可以。

请注意，我只是从头开始，只使用远程 Oracle 数据库的用户名/密码。除了拥有正确的 oracle 连接库之外，还有更多的东西吗？

如果有一种方法可以直接在mathematica 中执行此操作，那将是理想的（大概使用J/Link （mathematica 的java 集成事物）应该是可能的）。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-21T02:11:56.703

像从 sqlplus 创建文件这样简单的事情怎么样...

```
set echo off heading off feedback off colsep ,;
spool file.csv;
select owner, table_name
from all_tables;
spool off; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-15T18:58:08.593

这是 Python 中的一个实现：

```
import cx_Oracle, csv

orcl = cx_Oracle.connect('ohd/john@ohddb')
curs = orcl.cursor()

csv_file_dest = "C:\\test.csv"

output = csv.writer(open(csv_file_dest,'wb'))

sql = "select * from parameter"

curs.execute(sql)

headers_printed = False
for row_data in curs:        
    if not headers_printed:
        cols = []
        for col in curs.description:
            cols.append(col[0])
        output.writerow(cols)
        headers_printed = True

    output.writerow(row_data) 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-15T18:44:33.850

在 perl 中你可以做这样的事情，省略我所有的局部变量声明和......或者为了简洁起见而死掉“失败消息”错误处理。

```
use DBI; 
use DBD::Oracle;

$dbh = DBI->connect( "dbi:Oracle:host=127.0.0.1;sid=XE", "username", "password" );

# some settings that you usually want for oracle 10
$dbh->{LongReadLen} = 65535;
$dbh->{PrintError} = 0;     

$sth = $dbh->prepare("SELECT * FROM PEOPLE");

$sth->execute();

# one example for error handling just to show how it's done in principle
if ( $dbh->err() ) { die $dbh->errstr(); }

# you can also do other types of fetchrow, see perldoc DBI 
while ( $arrayref = $sth->fetchrow_arrayref ) {
    print join ";", @$arrayref;
    print "\n";
}

$dbh->disconnect(); 
```

两个注释，因为人们在评论中问：

*   sid=XE 是 oracle 服务 ID，就像您的数据库的名称。如果您安装免费版的 oracle，它默认为“XE”，但您可以更改它。
*   安装 DBD::Oracle 需要系统上的 oracle 客户端库。安装它还将设置所有必要的环境变量。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-02T19:35:49.290

正如 dreeves 所说，DatabaseLink 使这变得微不足道。我不知道的部分是 JDBC 声明的细节。但这里是 MySQL 的样子：

然后从 Mathematica 内部：

```
Needs["DatabaseLink`"]
conn = OpenSQLConnection[JDBC["mysql","hostname/dbname"], Username->"user", Password->"secret"]
Export["file.csv", SQLSelect[conn, "MyTable"]] 
```

您当然可以先将 SQLSelect 分配给一个变量并检查它。它将是包含表数据的列表列表。您可以将条件传递给 SQLSelect，请参阅相关文档（例如 SQLColumn["Name"]=="joeuser"）。

这里唯一特定于 Oracle 的是您如何在 JDBC 表达式中建立连接。它可能类似于 JDBC["oracle", "hostname/dbname"]。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T19:01:10.287

Mathematica 有一个内置的包“DatabaseLink”，它应该使这很容易，但您需要为 Oracle 找到一个驱动程序。安装“oracle 客户端库”应该这样做......

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-15T19:35:53.777

获取 Oracle Application Express。这是一个基于浏览器的工具，随数据库免费提供。它允许您快速单击报告并指定 CSV（或 Excel）作为输出格式。（您也可以使用它来构建完整的应用程序）。

您可以在此处找到大量文档、演示等：http: [//apex.oracle.com](http://apex.oracle.com)

您还可以在此 URL 下载该工具，或者您可以注册一个免费工作区并在 Oracle 服务器上使用该工具。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T15:53:59.487

我不是 PERL 程序员，但这里有一些您可能想要研究的额外功能。看看Oracle中外部表的概念。您创建一个表，其定义类似于以下内容：-

> ```
> CREATE TABLE MY_TABLE
> (
>   COL1    NUMBER(2),
>   COL2  VARCHAR2(20 BYTE)
> )
> ORGANIZATION EXTERNAL
>   (  TYPE ORACLE_LOADER
>      DEFAULT DIRECTORY SOME_DIRECTORY_NAME
>      ACCESS PARAMETERS 
>        ( FIELDS TERMINATED BY ','
>          MISSING FIELD VALUES ARE NULL
>        )
>      LOCATION (SOME_DIRECTORY_NAME:'my_file.csv')
>   )
> REJECT LIMIT UNLIMITED; 
> ```

请注意，此 DDL 语句假定您已经创建了一个名为“SOME_DIRECTORY_NAME”的目录。然后，您可以发出 DML 命令以将数据输入或输出此表，一旦提交完成，您的文件 my_file.csv 中的数据就会非常整洁。之后，用你的 PERL 魔法把文件放到你想要的任何地方。

# web-services - 在 WebService 调用中序列化字符串时出错

> ID：65452
> 
> 赞同：14
> 
> 时间：2008-09-15T18:31:58.670
> 
> 标签：web-services, xmlreader, maxstringcontentlength

今天早上，我遇到了一个问题，即从 Web 服务调用返回一个文本字符串。我得到的错误如下

```
************** Exception Text **************
System.ServiceModel.CommunicationException: Error in deserializing body of reply message for operation 'GetFilingTreeXML'. ---> System.InvalidOperationException: There is an error in XML document (1, 9201). ---> System.Xml.XmlException: The maximum string content length quota (8192) has been exceeded while reading XML data. This quota may be increased by changing the MaxStringContentLength property on the XmlDictionaryReaderQuotas object used when creating the XML reader. Line 1, position 9201.
at System.Xml.XmlExceptionHelper.ThrowXmlException(XmlDictionaryReader reader, String res, String arg1, String arg2, String arg3)
at System.Xml.XmlExceptionHelper.ThrowMaxStringContentLengthExceeded(XmlDictionaryReader reader, Int32 maxStringContentLength)
at System.Xml.XmlDictionaryReader.ReadString(Int32 maxStringContentLength)
at System.Xml.XmlDictionaryReader.ReadString()
at System.Xml.XmlBaseReader.ReadElementString()
at Microsoft.Xml.Serialization.GeneratedAssembly.XmlSerializationReaderImageServerClientInterfaceSoap.Read10_GetFilingTreeXMLResponse()
at Microsoft.Xml.Serialization.GeneratedAssembly.ArrayOfObjectSerializer9.Deserialize(XmlSerializationReader reader)
at System.Xml.Serialization.XmlSerializer.Deserialize(XmlReader xmlReader, String encodingStyle, XmlDeserializationEvents events)
--- End of inner exception stack trace ---
at System.Xml.Serialization.XmlSerializer.Deserialize(XmlReader xmlReader, String encodingStyle, XmlDeserializationEvents events)
at System.Xml.Serialization.XmlSerializer.Deserialize(XmlReader xmlReader, String encodingStyle)
at System.ServiceModel.Dispatcher.XmlSerializerOperationFormatter.DeserializeBody(XmlDictionaryReader reader, MessageVersion version, XmlSerializer serializer, MessagePartDescription returnPart, MessagePartDescriptionCollection bodyParts, Object[] parameters, Boolean isRequest)
--- End of inner exception stack trace --- 
```

我进行了搜索，结果如下： [搜索结果](http://search.yahoo.com/search?p=This+quota+may+be+increased+by+changing+the+MaxStringContentLength+property+on+the+XmlDictionaryReaderQuotas+object+used+when+creating+the+XML+reader.)

其中大多数与 WCF 相关，但足以为我指明正确的方向。我将发布答案作为回复。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-09-15T18:38:42.540

[在此处](http://geekswithblogs.net/niemguy/archive/2007/12/11/wcf-maxstringcontentlength-maxbuffersize-and-maxreceivedmessagesize.aspx)尝试此博客文章。您可以在 Binding 配置中修改 MaxStringContentLength 属性。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-15T18:38:01.653

[Jow Wirtley 的博客文章](http://joewirtley.blogspot.com/2007/08/maximum-string-content-length-and.html)为我指明了正确的方向。

我所要做的就是更新客户端应用程序的 app.config 中的绑定，现在一切正常。

# vim - 除了 Windows 上的 C/C++ 之外，还有其他语言的 CScope 样式的源浏览器吗？

> ID：65456
> 
> 赞同：14
> 
> 时间：2008-09-15T18:32:25.487
> 
> 标签：vim

我对可以插入 Vim 以允许 CScope 风格的源代码浏览（1-2 个击键命令来定位函数定义、调用者、全局符号等）的工具特别感兴趣，这些工具适用于 C/C++ 之外的语言，例如 Java 和 C# （因为 Vim 和 Cscope 已经很好地集成以浏览 C/C++）。我对基于 IDE 的工具不感兴趣，因为我知道 Microsoft 和其他供应商已经解决了这个问题——我更喜欢使用 Vim 进行编辑和浏览，但不知道有哪些 C# 和/或 Java 工具能给我与 CScope 相同的功能。

这个问题的原始答案包括一个指向 CSWrapper 应用程序的指针，它显然修复了一些用户在集成 Vim 和 CScope 时遇到的错误。但是，我的 Vim/CScope 安装工作正常；我只是想扩展功能以允许使用 Vim 编辑其他语言的代码。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2011-08-25T22:09:07.753

声称 Cscope 支持 Java 是一种极端的延伸。它似乎把一个方法当成一个函数，所以它不知道 A.foo()、A.foo(Object) 和 B.foo() 都是不同的。对于具有许多同名方法的大型代码库（包括第三方库）来说，这是一个大问题。（我没有查看 Cscope 源代码，但这是我在尝试来自 Debian 不稳定的最新 Cscope 版本 15.7a-3.3 时发现的。）

我在一个大型 Java 项目上尝试了 Cscope，由于这个限制，它对我一点用处都没有。遗憾的是，使用大型 IDE 之外的免费软件，我们无法快速回答“谁调用此方法”之类的基本问题，但我们不妨接受它。（如果我错了，我会喜欢它。我求助于注释掉方法和重新编译等黑客行为。）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-02T22:17:04.630

CScope 确实适用于 Java。

来自[http://cscope.sourceforge.net/cscope_vim_tutorial.html](http://cscope.sourceforge.net/cscope_vim_tutorial.html)：

> 尽管 Cscope 最初只打算用于 C 代码，但它实际上是一个非常灵活的工具，可以很好地与 C++ 和 Java 等语言一起使用。您可以将其视为通用的“grep”数据库​​，能够识别某些附加结构，如函数调用和变量定义。默认情况下，Cscope 仅解析当前目录（以及子目录，如果您传递 -R 标志）中的 C、lex 和 yacc 文件（.c、.h、.l、.y），目前无法更改它文件扩展名列表（是的，我们应该改变它）。因此，您必须列出要解析的文件，并将其命名为“cscope.files”（如果您调用“cscope -i foofile”，您可以随意调用它）。一种简单（且非常灵活）的方法是通过可信赖的 Unix 'find'

```
find . -name '*.java' > cscope.files 
```

> 现在运行'cscope -b' 来重建数据库（-b 只是在不启动Cscope GUI 的情况下构建数据库），您将能够浏览Java 文件中的所有符号。显然有人使用 Cscope 来浏览和编辑大量文档文件，这表明 Cscope 的解析器是多么灵活。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2015-09-21T14:22:15.810

在这里聚会有点晚了，但我的[https://github.com/eapache/starscope/](https://github.com/eapache/starscope/)项目为生成更多语言的 cscope 数据库提供了一个很好的框架。目前它支持 Ruby 和 Go，并且 Javascript 正在进行中。添加 Java/C# 应该没有那么困难。

编辑：现在完全支持 Javascript。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-08-21T12:50:09.897

我同意 Andrew - 尝试获取方法的调用层次结构会返回所有同名调用，即使它们来自不同的类。

您可以使用 Eclim 将 Eclipse 插入 VIM

[http://eclim.org/](http://eclim.org/)

支持者称之为等级制度

[http://eclim.org/vim/java/inspection.html#call-hierarchy](http://eclim.org/vim/java/inspection.html#call-hierarchy)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-15T18:42:37.193

这可能是您正在寻找的：

[http://www.vim.org/scripts/script.php?script_id=1783](http://www.vim.org/scripts/script.php?script_id=1783)

您还可以使用各种风格的[map](http://vimdoc.sourceforge.net/htmldoc/map.html)在您自己的 .vimrc 文件中模仿一些 CScope 功能。

# version-control - 对于拥有 1000 多个开发人员的组织，您会使用哪种版本控制系统？为什么？

> ID：65458
> 
> 赞同：28
> 
> 时间：2008-09-15T18:32:49.607
> 
> 标签：version-control, dvcs

那里有许多 SCM 系统。一些开放的，一些封闭的，一些免费的，一些相当昂贵的。对于拥有 3000 多名开发人员且拥有多个站点（一些位于非常慢的链接后面）的组织，您会使用哪一个*（请仅选择一个）？*解释你为什么选择你选择的那个。（给出一些理由，而不仅仅是“因为”。）

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-09-16T10:39:04.087

*   对于如此庞大的安装，至少有以下几个主要要求：**数据安全性**、成熟度、健壮性、**可扩展性**、**价格**（无论每个席位的价格如何，每个席位许可证与开源总是会产生巨大差异）、易于管理
*   我认为**颠覆**会很好。
*   有可用的**支持**（来自[collabnet](http://www.open.collab.net/products/subversion/)、[clearvision](http://www.clearvision-cm.com/consulting.html)、[wandisco](http://wandisco.com/php/subversion_support.php)等）。你可以问他们颠覆是否能够处理你的任务。
*   subversion 有一个非常成熟的数据库后端——FSFS。它绝对坚如磐石，从 1.5 版本开始，它可以处理很多版本而不会降低性能。修订被写入文件系统。因此，您的 subversion 存储库的可靠性取决于您的文件系统、操作系统和存储系统的质量。
*   这就是为什么我会推荐使用 ZFS作为文件系统的**Solaris 10 。**ZFS 为生产系统提供了非常棒的文件系统功能。但最重要的是，它提供了数据完整性校验和。因此，使用 subversion 存储库中的大量源代码，您不必担心存储库损坏，因为无声硬盘驱动器位错误或控制器或电缆位错误。到目前为止，ZFS 已经足够成熟，可以安全地用作 UFS 或任何替代品。
*   我不知道硬件要求。也许 Collabnet 可以给你建议。
*   但是一个非常好的开始（如果结果太慢，可以用作 NFS 存储或备份存储 - 你肯定可以很好地利用它）将是第二代重[击器](http://www.sun.com/servers/x64/x4540/)，即**Sun Fire X4540 服务器**：您可以拥有（所有都在一个不错的 4U 机架服务器中，价格为 80.000 美元（标价 - 这可能可以协商））：48 TB 磁盘空间！，8 个 AMD Opteron CPU 内核，64 GB RAM，预装 Solaris 10，3 年白金来自 sun 的软件和硬件支持。因此，仅此服务器的硬件和支持价格将是 3000 名开发人员的每个席位 25 美元。
*   为了确保真正的数据安全，您可以将 48 个硬盘驱动器分区如下：3 个用于操作系统的驱动器（3 路 Raid-1 镜像）、3 个热备件（未使用，在发生故障时备用其他驱动器），一个包含 14 个 3-way Raid 1 镜像（14*3=42 个驱动器）的 zfs 池，用于 subversion 存储库。如果您只想将 14 TB ZFS Raid 空间填充 80%，那么这将是存储库的大约 10 Tebibyte 实际可用磁盘空间，即每个开发人员平均 3 GB。
*   ***使用此配置： Sun x4540 thumper 上的 Subversion 1.6 具有 10 TiB 3-way Raid-1 ZFS 冗余和校验和磁盘空间，这应该是一个非常严肃的开始。***
*   如果计算能力不足以满足 3000 多名开发人员的需求，那么您可以购买更强大的服务器来使用 thumper 的磁盘空间。如果磁盘性能太慢，您可以将大量快速 scsi 驱动器连接到计算服务器，并使用 thumper 作为备份解决方案。
*   当然，从 collabnet 获得有关该颠覆服务器的规划和部署的咨询服务以及从 sun 获得硬件和 solaris 操作系统的白金支持是有意义的。
*   编辑（对评论 #1 的回答）：对于**分布式团队，可以进行主从配置**：[WebDAV-Proxy](http://svn.apache.org/repos/asf/subversion/trunk/notes/http-and-webdav/webdav-proxy/). 每个本地团队都有一个从服务器，用于复制存储库。开发人员从这个奴隶那里得到所有的结帐。签入从从属透明地转发到主控。这样，主站始终是最新的。绝大多数流量是结帐：每个开发人员都会收到任何开发人员提交的每个签入。所以结账流量应该是 3000 名开发者流量的 99.97%。如果您有一个拥有 50 名开发人员的本地团队，结帐流量将减少 98%。签入应该不是问题：任何人输入新代码的速度有多快？显然，对于一个小团队，你不会买一个重击器。您只需要一个有足够硬盘空间的盒子（即，如果您打算容纳 10TB 的空穴存储库）。它可以是 raid5 配置，因为数据丢失不是公司的末日。您也不需要 Solaris。如果当地人更喜欢它，你可以在上面安装 linux。再一次：询问像 collabnet 这样的顾问，这是否真的是一个合理的概念。有这么多座位，支付一次性咨询费用应该不是问题。他们可以设置整个事情。Sun 提供预装了 solaris 的盒​​子。你有太阳支持。因此，您不需要在现场安装 solaris 专家，因为配置在未来几年内不会发生变化。这种配置意味着 现场不需要solaris guru，因为配置在未来几年内不会改变。这种配置意味着 现场不需要solaris guru，因为配置在未来几年内不会改变。这种配置意味着
    *   从团队到总部的慢线不会被多余的结账数据堵塞，
    *   当地团队的成员可以快速结账
    *   它将显着减少重击器的负载 - 这意味着使用该配置您根本不必担心重击器是否能够处理负载
    *   它降低了带宽成本
*   编辑（在 M3000 发布之后）：一个**更加极端的硬件配置甚至更加针对疯狂的数据完整性**，这将是[M3000](http://www.sun.com/m3000)服务器和[J4500](http://www.sun.com/J4500)阵列的组合：
    *   J4500 存储阵列实际上是一个重击器，但没有 CPU 电源和外部存储接口，使其能够连接到服务器。
    *   M3000 服务器是一款 Sparc64 服务器，价格适中，具有高端 RAS 功能。大多数数据路径甚至 cpu 寄存器都经过校验和等。RAM 不仅受 ECC 保护，而且具有与 IBM Chipkill 功能相当的功能：它是对内存的突袭：不仅检测和纠正单个位错误，而且整个内存芯片都可能出现故障完全没有数据丢失 - 类似于 RAID 阵列中的硬盘驱动器故障。
    *   由于 ZFS 文件系统在数据来自之前或之后对数据进行基于 CPU 的错误校验和，因此存储控制器的质量和 J4500 的布线并不重要。重要的是 M3000 CPU、内存、内存控制器等的比特错误预防和检测能力。
    *   不幸的是，sun 用来提高质量的高品质记忆棒更加昂贵，以至于四核（八线程）4GB Ram M3000 + 48 TB J4500 的组合大致相当于重击器，但如果你愿意喜欢将服务器内存从 4GB 增加到 8、16 或 32 GB 用于内存缓存目的，价格急剧上涨。但是如果使用分布式团队的主从配置，也许 4GB 的配置就足够了。
    *   如果管理层非常重视这 3000 名开发人员存储库的源代码和数据完整性，那么这种硬件组合将值得考虑。然后，添加两个或更多重击器作为轮换备份解决方案也是有意义的（不必防止硬件故障，但可以防止管理员错误或在物理灾难的情况下进行异地备份）。
    *   由于这将是 Sparc 而不是 x86 解决方案，因此可以免费获得该平台的经过认证的[Collabnet Subversion 二进制文件。](http://www.collab.net/downloads/subversion/solaris.html)
*   subversion 的优点之一也是优秀的文档：[O'Reilly](http://oreilly.com/catalog/9780596510336/)有一本优秀的书（[带有 Subversion 的版本控制](http://svnbook.red-bean.com/)）也可以免费提供[PDF](http://svnbook.red-bean.com/nightly/en/svn-book.pdf)或[HTML](http://svnbook.red-bean.com/nightly/en/index.html)版本。
*   总结一下：Subversion 1.6 + Solaris 10 + 3-way-raid-1 冗余和校验和 ZFS + thumper + 本地团队的主从服务器复制 + sun 支持 + collabnet/clearvision/orcaware/Karl Vogel 咨询 +为所有开发人员提供的优秀且免费的颠覆手册，您应该有一个提供的解决方案
    *   **极高的数据安全性**（对于如此多的源代码非常重要 - 您不想损坏存储库，确实会发生位错误，硬盘驱动器会发生故障！）您拥有一个真正可靠地保存所有版本/修订的主数据存储库：源代码控制系统的主要特点。
    *   **成熟度**- Subversion 已被许多公司和开源项目使用。
    *   **可扩展性**- 使用主从复制，您应该不会在主服务器上遇到负载问题：签入的负载可以忽略不计。结帐由奴隶处理。
    *   **慢速连接后的本地团队没有高延迟**（因为复制）
    *   **低廉的价格：**颠覆是免费的（没有每个席位的费用），优秀的免费文档，在三年的时间里，每个席位每年只需 8 美元，主服务器的硬件和支持成本，廉价的从属 Linux 盒，一次性咨询来自协作网等 al.，由于主从复制，带宽成本低。
    *   **易于管理：**基本上无需管理主服务器：颠覆顾问可以部署所有内容。Sun 员工将更换有故障的硬盘驱动器等。从设备可以是 linux 机器或本地站点上可用的任何管理技能。优秀的颠覆文档。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-09-15T18:44:09.920

在几家拥有 1000 多名员工的公司工作过，我发现他们都使用 Perforce。

我问过“你为什么不使用其他东西？SVN？Git？Mercurial？Darcs？”——他们已经说过（这对所有公司都是一样的）——当他们决定使用Perforce，要么是那个，要么是 SourceSafe，要么是 CVS——老实说，考虑到这三个选择，我也会选择 Perforce。

“更难”的版本控制系统很难获得这么多人的关注，而且当您的大部分软件团队在彼此之间 18 英尺的范围内工作时，DCVS 的许多好处就不那么有用了。

Perforce 有很多 API 钩子供开发人员使用，对于集中式系统，它有很多胆量。

我并不是说它是最好的解决方案——但我至少见过一些非常大的公司使用 Perforce，而且它几乎无处不在。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-15T18:37:37.707

Git 是为 Linux 内核编写的，这可能是最接近这种情况的示例，您可以在其中找到公共信息。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-15T18:41:26.323

我想说 git，但不要认为这种规模的公司会全部使用 Linux（Windows 对 git 的支持仍然很烂）。所以用 git 之前 Linux 使用的 SCM 即[BitKeeper](http://www.bitkeeper.com/Products.html)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-15T19:59:49.710

截至 2015 年，最重要的因素是使用*分布式*版本控制系统 (DVCS)。使用 DVCS 的主要好处：通过减少源代码操作的摩擦，允许在多个级别上进行源代码协作。这对于拥有 1000 多名开发人员的组织尤其重要。

### 减少摩擦

单个开发人员签到与协作活动分离。轻量级签到鼓励在短时间内（每小时或每天多次签到）独立工作的干净单元。由于系统是在分布式组织中建立的，因此协作自然会以不同的、通常更长的时间尺度（每天、每周、每月与其他人同步）进行处理。

### 使用 Git

在 DVCS 选项中，您可能应该*只使用[Git](http://git-scm.com)*并利用[GitHub](https://github.com)或[Bitbucket](https://bitbucket.org)上的优秀社区。对于大型私人组织，*内部社区*和*内部源代码托管*可能很重要（有供应商销售私人托管系统，例如[Atlassian Stash](https://www.atlassian.com/software/stash)和可能其他）。

使用 Git 的主要原因是它是最流行的 DVCS。因为这：

*   Git 很好地集成到了广泛的开发工具链中

*   大多数开发人员都知道并使用 Git

*   Git 有[据可查](http://git-scm.com/documentation)

### 或水银

作为 Git 的替代品，[Mercurial](http://www.selenic.com/mercurial/)也非常出色。与 Git 相比，Mercurial 的命令集更简洁、更正交。在 2000 年代后期，它曾经在 Windows 系统上比 Git 得到更好的支持，主要是因为核心开发人员更关心 Windows。

### 图形用户界面

对于那些想在命令行上使用 GUI 而不是使用 GUI 的人来说，`git`SourceTree[是](http://www.sourcetreeapp.com)一个很棒的 Windows 和 OS X 应用程序，它为 Git 和 Mercurial 提供了一个干净的界面。`hg`

### 过时的建议

截至 2010 年，我推荐[Mercurial](http://www.selenic.com/mercurial/)和[TortoiseHG](http://bitbucket.org/tortoisehg/stable/wiki/Home)。它是 Windows 支持和分布式版本控制功能的最佳组合。

从 2006 年到 2009 年，我推荐[Subversion](http://subversion.tigris.org/) (SVN)，因为它是免费的并且与大多数 IDE 有很好的集成。对于组织中旅行或更喜欢更分布式模型的人员，他们可以使用 Git 进行所有本地工作，但在想要共享代码时仍然提交到 SVN 存储库。这是集中式和分布式系统之间的一个很好的平衡。请参阅[Git-SVN 速成课程](http://git.or.cz/course/svn.html)以开始使用。使用 SVN 的最后一个可能也是最重要的原因是[TortoiseSVN](http://tortoisesvn.tigris.org/)，这是一个 SVN 的 Windows 客户端，任何人都可以通过右键单击访问存储库。在我的公司，这已被证明是向非开发人员提供存储库访问权限的好方法。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-15T21:44:16.633

首先，在 CVS 上大 NO。在 2008 年使用 CVS 就像驾驶 92 五十铃 Trooper。他们在路上，人们花钱维护他们的唯一原因，纯粹是出于感性的原因。CVS 是老帽子，技术方面，你会后悔的。

我通常也会避开那种规模的公司的开源工具。Subversion 是一个优秀的小工具，而且非常可靠，但如果你遇到了你不知道的错误，你有责任在 3000 人闲置时修复它。从这个角度来看，Perforce 很便宜，我强烈推荐它。

令我惊讶的是，有多少自称是 SCM 专业人士的人选择“免费”。从表面上看，它看起来很棒，但当您处于困境时，拥有一支高素质的支持团队会有所帮助。当您在周日凌晨 3 点醒来，因为您在新加坡的团队无法做任何工作时，您不会认为“免费”是个好主意。

源代码控制工具是关键任务，您谈论的是公司资产和知识产权。永远不要吝啬源代码控制工具！

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-15T18:34:41.597

任何 DVCS（BitKeeper、git、Bazaar、Mercurial 等）因为分布式将减少中央“规范”SCM 服务器上的负载。需要注意的是，它们是相当新的技术，没有多少人会熟悉它们的使用。

如果您想坚持使用较旧的集中式模型，如果您负担得起，我会推荐 Perforce，如果您不想为 Perforce 付费，我会推荐 Subversion。我会推荐 CVS 上的 subversion，因为它有足够的功能让它值得，但又足够相似，以至于已经知道 CVS 的开发人员仍然会感到舒服。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-04-24T18:14:01.457

总结：在我亲身体验过 git 的系统中，这些系统处理得最好。

细节：

我曾在多家拥有大量开发人员的大公司工作过。在之前的工作中（我猜大约有 500 名开发人员），我们使用（因为那个时代）RCS 和 CVS。另一组也使用了 ClearCase。ClearCase 小组有严重的问题，但我不知道这是由于 ClearCase 还是由于滥用了应有的 ClearCase 方法，还是由于 ClearCase 管理人员的差劲。

在我现在所在的公司（远远超过 10000 名开发人员，但我怀疑超过 1000 名开发人员在大多数人认为的单个项目中，尽管他们在单个*产品*上这么多），我们使用了 CVS （由于历史原因）、SVN（因为它是一条简单的迁移路径）、SVK（当时很好，但我不推荐）、Mercurial（抱歉，没有直接经验）、Perforce（同上）和 Git。

除非你被卷入过去并被困在那里，否则我不会推荐 RCS 或 CVS。他们有很好的观点，但与更现代的版本控制系统相比，他们没有什么可推荐的。

SVN 稳定且成熟，分支速度比 CVS 快得多（大型项目只需几秒钟而不是几分钟）。然而，合并这些分支仍然有点原始（在简单的情况下，一个小的 shell 脚本可以让它变得非常容易，但是如果一个分支得到了更新并且有一些东西被拉进来，而且这些东西也被提交到了其他地方，那就很难管理了）。SVN 源代码库似乎也比任何其他开源代码库需要更多的关注和支持（但比商业代码库似乎需要的要少）。SVN 有一个很好的简单概念模型。

然而，你有“几个站点（一些在一个非常慢的链接后面）”，SVN 可以解决这个问题，但它并不能很好地工作。它不仅对“慢站点”的人来说更慢，而且当“慢站点”的人做一些操作时，其他人都被锁定了。尽管如此，我会说 SVN 适用于对中央存储库具有相当良好（快速且可靠）访问权限的组。

SVK 对我们的“慢站点”工作得更好（并且允许更多的“独立工作”）。它对于复杂的合并也比 SVN 工作得更好。SVK 不再维护，否则我会推荐它。

Git 对于大型企业来说相对年轻，值得认真考虑，但除此之外......</p>

它做得很好，但学习曲线相当陡峭。对于已经使用集中式源代码控制系统的团体来说更是如此。在这里有帮助的一件事是将诸如“X 是项目 Y 的权威回购”之类的东西正式化，并采用您所有的旧审查流程等并将它们应用于该回购（如果您曾经需要来自 R 的代码审查和签字测试 T 在检入旧的源代码控制系统的主干之前通过，在提交到权威 repo 的主分支之前需要相同的事情）。

在某些方面，git 实际上比SVN**更适合大型团体。**您可以通过让少数人能够提交您指定为权威的任何 repo 来强制执行流程。这些人可以负责确保在将更改拉入存储库之前已遵循所有“过程”。Git 甚至会跟踪谁做了更改以及谁集成了它们（SVN 似乎经常出错）。

Git 比 SVN 更便宜地创建分支（你可以断开连接，它不到一秒，而在 SVN 上可能是 3 秒），但尽管大多数人声称这不是一个大问题。最重要的是合并非常容易。即使你已经做了一些事情，比如创建了一个分支，完成了一半的工作，不得不在一个月内做其他事情，更新你的分支中的源代码，因为其他人在一个月内更改了基础项目，然后完成了第二个一半的工作，被搁置了，后来不得不回来发现还有第三半的工作，更多的外部更新，等等……即使在合并之后发现了你的分支中真正新的东西vs. 来自您的更新，并将真正需要合并的内容保持在最低限度。

git 有很多我不喜欢的地方，但它们几乎都归结为“有些工具很锋利，你应该小心”。诸如 SVN 之类的许多不存在的操作之类的事情应该只在只存在于您的存储库中的提交上完成（不要编辑其他人看到的历史记录！）。其他源代码控制系统也有类似的问题，但 git 更强调编辑历史记录以保持其“干净”，因此您需要忽略更多工具和工具选项，或者知道何时安全与灾难。总的来说，我发现它优于我使用过的其他版本控制系统。

我关于 Perforce 的二手信息是“它比 SVN 更好，但不是”。我关于 Mercurial 的二手信息是“它或多或少像 git，除了在细节上，有些人更喜欢它，有些人更喜欢 Git”。

在一家拥有 1000 多名开发人员的公司中，我建议您为所使用的任何源代码控制系统获得一份支持合同。对于 git，我会查看 github:fi。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-22T17:32:40.087

好的，完全免责声明：我是一家名为[MKS](http://www.mks.com/)的公司的开发人员，该公司为“企业”公司制作版本控制系统，作为名为[Integrity](http://www/products/index.jsp?page_id=14726)的软件配置管理平台的一部分。Blah blah blah，明显的插头。

所以我不能诚实地回答这个问题。

但是，我想指出，建议分布式版本控制的人缺少一些对大公司来说非常重要的东西。对他们来说，开发人员在处理他们的版本控制系统时有多少灵活性并不重要，重要的是他们对交付的每一行代码都有绝对的控制权。监管合规性和审计比合并的痛苦程度更重要。

一家拥有 1000 多名开发人员的公司想知道每个人都在做他们应该做的事情，没有人做他们不应该做的事情，所有事情都被跟踪，经理们得到可爱的报告和图表，他们可以粘贴到 PowerPoint 幻灯片中为*他们的*经理。

如果一家大公司不特别关心这些事情，他们更有可能让各个开发团队自己解决问题，在这种情况下，1000 多名开发人员正在使用各种不同工具的大杂烩基于当时看起来最方便的任何东西。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-15T20:10:59.713

不要使用 CVS！！如果您想要 CVS 模型，Subversion 是一个更好的选择。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-15T19:14:41.690

强制

与 CVS 相比，我喜欢 perforce 的一点是，分支管理必须更加复杂（但仍然相当容易），并且您不需要让中央官僚机构创建分支/标签等。换句话说，它允许单个团队（或开发人员）在提交到由其他人集中管理的主线之前以他们喜欢的方式管理他们的源组件。

哦，我还要说它拥有最好的 GUI 之一，同时仍然拥有一等公民命令行界面。我通常讨厌 GUI，但他们的作品。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-15T20:55:53.007

我会使用bitkeeper。我使用过 bitkeeper、clearcase、accurev、perforce、subversion、cvs、sccs 和 rcs，在所有这些 bitkeeper 中，它远远超过了最好的。我玩过 git，它的速度给我留下了深刻的印象，但我认为它的 UI 有点笨重（虽然这个意见是在使用它半天后形成的）。

bitkeeper 的图形用户界面看起来很笨拙，但它们的功能非常强大。bitkeeper 命令行工具可以说是同类产品中的佼佼者，其合并功能绝对出色。

我最喜欢 bitkeeper 的地方（这可能适用于所有分布式系统）是分支非常便宜。创建分支是一种生活方式，而不是令人恐惧的事情。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-15T21:55:52.673

如果您有 1000 多名开发人员在开发一个软件，那么您就有资源投资于自己的大量工具。无论您选择什么，您都可能会做大量工作以使其适应您的情况。

Microsoft 的 Team Foundation Server 在 Microsoft 内部的一些非常大的团队中使用，TFS 团队正在努力使其能够很好地扩展。此外，源代码控制和错误跟踪的集成很有吸引力。它并不便宜，而且管理很麻烦，不能很好地*缩小*到小型团队，但对于您的情况，您可以负担这些费用。当您遇到麻烦时，您可能还希望能够调用像 Microsoft 这样的大型支持组织（但如果您使用免费软件，那么您可以选择在内部提供支持）。

如果您的公司有 1000 多名工程师，但他们正在开发单独发布的软件，我认为您希望将每个软件放在自己的服务器上。这使得性能规模和管理更好。但是，我会坚持只使用一种技术进行源代码控制。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-17T20:00:07.617

我会使用AccuRev。我用过 svn、cvs、clearcase (base, ucm)、ccc/harvest，但没有一个能超越 AccuRev 的优势。“拥有多个站点的 3000 多个开发人员组织”？您可以为此使用 Accurev 分布式解决方案 (AccuReplica) - 这意味着您有一个主服务器，并且在远程站点上有任意数量的副本（因此那些具有“慢链接”的人不会受到太大影响）

最重要的是，AccuRev 带来了一种独特的方法——一种基于流的 SCM 工具的真正新概念/设计/实施。不是以 ClearCase-UCM 的（坏）方式做到这一点（因为 ClearCase “流”最终是分支），而是以巧妙的现代方式。

最好自己尝试一下，我知道他们提供 30 天的试用期，并提供足够的许可证来使用该工具 - 尝试一下，您就不会想考虑其他工具了。我的承诺。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-21T09:14:13.100

我怀疑您的组织中是否有 3000 名开发人员都在使用相同的代码库。我在一家中大型软件公司工作，我们整个公司可能没有那么多，但也有很多独立的项目。

在内部，一些小组向其他小组提供版本以在他们的产品中使用；这不是通过 SCM 系统管理的。

我们自己的团队有自己的 SCM，但只有大约 25 名活跃的开发人员。我们使用 CVS，老实说，它并没有真正做到（我们会迁移但有很多脚本/提交挂钩和其他需要大量工作来更改的零碎）。在合理大小的代码库上使用 CVS 的问题在于，许多操作非常缓慢并且涉及锁定其他开发人员。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-15T18:50:21.200

我会使用任何没有悲观锁定（[http://old.davidtanzer.net/?q=node/118](http://old.davidtanzer.net/?q=node/118)）机制的 SCM。特别是因为您希望人们能够在任何大型项目中同时“编辑”同一个文件。

就我个人而言，我会选择带有一些分发解决方案的 SVN，但是由于在 SVN 中您只提交您更改的内容（无论如何每次提交都应该很少），因此网络开销非常小。此外，服务器负载在某种程度上可以用更多的硬件来处理。在使用 SVN 时，我还没有找到硬件扩展的上限。

其他选择可能包括 Linux Kernel 人们使用的“git”，但我对此并没有任何经验。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-09-15T18:56:32.480

如果您有如此大的组织，那么不要强制要求一个特定的 SCM。

我确信他们不会都在使用相同的代码，让团队自己选择他们最熟悉的代码是值得的。

（您可能需要提供一些培训，以便了解如何在 Git、SVN 和一些内部遗留系统之间进行选择。）

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2011-04-24T20:21:17.330

令我感到震惊的是，这里提倡 DCVS-es 的大多数人都被视为某种狂热分子。DCVS-es 被渲染为另一个流行词，就像云计算、社交媒体等一样。

这里的一些人提倡使用 SVN 以及一些特定的硬件设置，特定的磁盘存储应该（甚至能够）带来可靠性。现在这不只是破坏了 SCM 的两个主要目的之一——即确保数据完整性吗？

您没有足够的数据存储级别信息来确保整个源库在所有过去修订中的完整性。如果您希望将数据迁移到另一台机器上怎么办？如果您想在完成之前不停止所有开发的情况下逐步迁移它怎么办？如果存在安全问题并且有人弄乱了您的主副本怎么办？你如何找到最后一个有效的？存储完整性只能让您做到这一点，并且不会让您解决任何这些问题。正是因为它在不适当的抽象级别上运行。不是您关心的存储。这是你的代码库。

另一个问题。有些人无法相信实际上有可能让 3000 多人在同一个项目中进行操作。他们说“去烤你自己的 scm”，我想这是另一种表达方式“是的......对...... 3000 多个开发人员......祝你好运”。同时，也有涉及更多人的项目。从工程到法律，几乎可以做任何事情。但不知何故，当涉及到软件开发时，这是不可能的，不可能。这个想法（我想）是这样的：什么？3000 多人接触同一个文件？现在，那不可能。而且，是的，它是正确的。不可能。问题是你为什么要让 3000 多人接触同一个文件？在自然界中，你会在哪里找到这样的情况？3000 多名律师是否会互相发送一份文件，直到他们最终就所有事情达成一致？人们不是那样工作的。在现实中永远不可能像那样工作。然而，从理论上讲，集中式 CVS 使之成为可能。更糟糕的是，它迫使人们实际上与他们甚至不认识的人协调他们的工作。在这种情况下，即使有聪明的人加入也不是问题，尽管我想在成千上万的人中很难保证每个人都不是白痴。这只是关于犯常见的愚蠢错误。每个人都会犯错误（字面意思）。你为什么突然想把这件事通知整个公司？不能那样工作。在现实中永远不可能像那样工作。然而，从理论上讲，集中式 CVS 使之成为可能。更糟糕的是，它迫使人们实际上与他们甚至不认识的人协调他们的工作。在这种情况下，即使有聪明的人加入也不是问题，尽管我想在成千上万的人中很难保证每个人都不是白痴。这只是关于犯常见的愚蠢错误。每个人都会犯错误（字面意思）。你为什么突然想把这件事通知整个公司？不能那样工作。在现实中永远不可能像那样工作。然而，从理论上讲，集中式 CVS 使之成为可能。更糟糕的是，它迫使人们实际上与他们甚至不认识的人协调他们的工作。在这种情况下，即使有聪明的人加入也不是问题，尽管我想在成千上万的人中很难保证每个人都不是白痴。这只是关于犯常见的愚蠢错误。每个人都会犯错误（字面意思）。你为什么突然想把这件事通知整个公司？甚至不是让聪明人加入的问题，尽管我想在成千上万的人中很难保证每个人都不是白痴。这只是关于犯常见的愚蠢错误。每个人都会犯错误（字面意思）。你为什么突然想把这件事通知整个公司？甚至不是让聪明人加入的问题，尽管我想在成千上万的人中很难保证每个人都不是白痴。这只是关于犯常见的愚蠢错误。每个人都会犯错误（字面意思）。你为什么突然想把这件事通知整个公司？

现在有些人可能会说 - 但您不必向所有人授予提交访问权限。嗯 - 那是作弊。在集中式环境中构建分布式工作流，这完全是一种无望的尝试。突然你有一个两级树 - 具有提交访问权限的人发送所有那些没有提交的工作。好吧，如果你走得那么远，为什么不就不可避免的问题达成一致——没有也永远不会只有整个源代码库的单一通用版本。人们需要在他们分离的环境中工作，这些环境可以很容易地融合在一起。

现在有很多 DCVS。只有 Git 有这种跟踪内容的方法，而不是单个文件，在这种情况下，这可能不是最佳选择（但它在很大程度上取决于项目的组织）。还有 Mercurial，还有 Bazaar。所以这两个属性不相互依赖。

我真的不想推荐任何特定的 DCVS，我觉得没有那么有能力。然而，在大多数推荐的解决方案都没有分发的情况下，不确保数据完整性，实际上比根本没有任何 CVS 更糟糕，我觉得我需要写一些东西。真正的问题应该是哪个 DCVS 最适合完成这项工作。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-11-04T14:35:40.207

让我们看看选项。

1 - 强制执行。许多公司（正如人们所说的那样）使用 Adob​​e、Amazon、MS、Google 公司，这些公司成长、进步并依赖于每天销售软件来提供食物，这是他们的选择。我想如果我需要为众多站点等提供支持的“全球解决方案”等，我会采用这种方式对 Win/Linux 有好处（虽然不确定 Mac）

2 - SVN。也被大团队使用，KDE 使用它（巨大的，巨大的项目），目前修订版 880,000（是的！）对于 Windows 和 Linux 使用非常实用（即使我认为 TortoiseSVN 在某些方面低于平均水平） 可以签订商业支持也是。也适用于 Windows / Linux / Macs。

3 - Accurev 如果我想变得“前卫”。如果不进行一些测试并先习惯它，我不会在整个公司部署它。

4 - MS Team Foundation 这可能是一个很好的解决方案，但我从未尝试过，可能只是 Windows。

5 - Git / Bzr / Hg - Bzr 和 Hg 有它们的“乌龟”，所以，对 Windows 有好处（尽管我不确定成熟度）Git 暂时只是 linux，即使它非常好（并且比几年前更好、更容易使用）。

我永远不会，永远，绝对不可能 JOSE 使用 Clearcase。期间 这是对每个人的金钱、时间和理智的浪费。

避开：CVS / Clearcase / 任何旧的

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-09-15T20:50:04.720

如果您的意思是 3000 多名开发人员在同一个代码库上工作，我不知道。如果您的意思是在不同地点从事数百个项目并且您需要有一个标准，那么我会选择在大量在线用户支持下流行的东西，即不是让您在 Google 上获得 10 次点击的晦涩难懂的东西。

就我个人而言，我会选择 SVN，我在一个拥有数百名开发人员的 IT 部门，并且最好的源代码控制应用程序是 SVN。

:)

//W

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-09-15T23:38:35.610

Perforce 已被证明可以在 Google 的单个服务器上扩展到 5000 多个用户，请参阅： [Life on the Edge: Monitoring and Running a Very Large Perforce Installation](http://www.perforce.com/perforce/conferences/us/2007/presentations/DBloch_Life_on_the_Edge2007_paper.pdf)

似乎许多最大的软件公司要么专门使用 Perforce，要么将其用作主要 SCM。例如：Adobe、Cisco、SAP、Symantec、EA、UbiSoft 和 Autodesk 都是 Perforce 用户。它并不完美，但仍然优于 SVN 或 TFS（它们本身都不好）

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-09-15T23:06:47.607

我实际上会检查 Team Foundation Server。这是一个非常好的系统，可以扩展，并且很容易通过内部 IT 部门。我知道它以 Windows 为中心，但您也可以为 Linux/Mac 使用附加组件，并且您可以为一些连接速度较慢的站点使用代理。

而且我会考虑在一个大型组织中拥有 2 个系统，这可能有助于在某些单独的情况下获得最佳效果。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-09-15T23:14:25.920

Perforce 和 TFS 是我所知道的唯一选择。我知道它们都已在 Microsoft 的大型项目中使用过。Vault*可能会*扩展那么大，但我不知道它是否超过 500-1000 个用户。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-09-15T18:36:29.503

Adobe 使用 Perforce

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2008-09-15T19:30:57.623

Perforce 是一个不错的系统，并且可以很好地扩展。

我在一个拥有大约 5000 名员工的组织中工作，而 perforce 是一个快速高效的系统。它可以很好地扩展，具有良好的分支支持，具有原子提交。每个更改都有一个更改编号，可用于“软件考古”和许多其他出色功能。

此外，它对 windows、mac 和 unix 有很好的支持，包括很好的命令行和很好的脚本支持。

我以前使用过 CVS，它不能很好地扩展到超过 25-50 名工程师的团队（主要是因为原子操作和性能）

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2008-09-15T23:56:44.897

Perforce 也得到了我的投票。我没有在这么大的项目中使用过它，但它在我的环境中绝对坚如磐石。它还拥有令人印象深刻的大型项目履历。

[谣言]我听说微软将它用于 Vista。[/谣言] 显然它是为他们定制的版本，但它并没有比这大得多。

* * *

## 回答 #27

> 赞同：-1
> 
> 时间：2008-09-15T21:02:04.240

Subversion 易于扩展和拆分。Perforce 只为少数员工花费数千美元，非常昂贵，此外，它没有提供颠覆不提供的任何东西。

Subversion 真的很简单，比 cvs 好。

如果只有他们的 Windows 支持更好，我会推荐 git

* * *

## 回答 #28

> 赞同：-1
> 
> 时间：2008-09-21T08:50:25.577

对于使用 Visual Studio 的开发人员，我强烈推荐带有 TortiseSVN 客户端和 Visual-SVN 插件的 SVN。

* * *

## 回答 #29

> 赞同：-1
> 
> 时间：2008-09-16T00:37:58.447

我会使用颠覆。Subversion 已在具有大型开发人员社区的许多大型分布式开源项目中得到证明。此外，Subversion 提交的事务性质使其非常适合连接可能不可靠的情况。

* * *

## 回答 #30

> 赞同：-1
> 
> 时间：2008-09-15T19:29:42.200

如果他们都在开发同一个产品，可能是 Perforce。

如果有很多较小的项目（2 到 50 个），我会运行几个 Subversion (SVN) 机器。

* * *

## 回答 #31

> 赞同：-1
> 
> 时间：2008-09-15T21:34:23.710

在我们公司，我们使用 alienbrain，但我们正在迁移到 Perforce。Perforce 拥有您想要的一切：它处理代码和数据，他集成了用于持续集成的工具，它处理本地（每个开发人员）存储库，因此您可以在提交到服务器之前签入本地存储库。

我投票给 Perforce

* * *

## 回答 #32

> 赞同：-1
> 
> 时间：2008-09-16T00:01:29.080

带有 TortiseSVN（在 Windows 上）的 SVN 非常棒。我强烈推荐它。

* * *

## 回答 #33

> 赞同：-1
> 
> 时间：2008-09-16T00:03:43.693

我是 Subversion 的粉丝，但有很多不错的开源和闭源选择。我会避免使用 CVS，因为它确实不像现代 SCM（没有原子提交等）。

有人可能会建议 SourceSafe。像瘟疫一样避免它。SourceSafe 默默地摧毁了历史，造成了无尽的悲痛。一点谷歌搜索会告诉你更多关于这一点。

Subversion 很成熟，有很多很好的工具和 IDE 集成。它在大多数网络上运行良好，因为它使用 HTTP 访问存储库。

几年前我进行了 SCM 转换，你能做的最好的事情就是尝试一下。SCM 供应商将为您的评估提供演示和技术支持。

选择 SCM 并不是一件容易的事。这实际上取决于您的代码库和工作流程。一些系统比其他系统更好地处理庞大的代码库。有些处理大量的分支和合并比其他更好。有些比其他的更适合远程访问。有些具有更细粒度的安全模型。

让所有将与系统交互的人一起列出你需要/想要的东西。获取演示并将您的代码导入其中并尝试一下。为这么大的团队选择 SCM 是一个重大项目，应该这样对待。

# .net - 是否有一个很好的 .net 库，用于对可用于合并的 HTML 进行 3 路比较？

> ID：65463
> 
> 赞同：1
> 
> 时间：2008-09-15T18:33:36.530
> 
> 标签：.net, merge, diff

为了合并独立的 HTML 更改，我正在为 HTML 的 3 路比较/合并库寻找建议。常见的 3 路文本合并算法性能不佳，因为它们不理解 HTML 和 XML 的树状结构。当然，这样的库必须理解 HTML 的松散语法，即标签并不总是封闭的。我的平台是.Net。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-15T18:45:55.143

你也可以偷偷摸摸：通过[tidy](http://tidy.sourceforge.net/)运行文件，然后进行比较。这将导致类似的结构，其中新/删除的子项将使用传统的差异工具显示。它会在删除/添加周围节点时崩溃 - 祝你好运...

此外，Microsoft 的[XML 记事本](http://www.snapfiles.com/get/xmlnotepad.html)（抱歉，找不到适用于 microsoft.com 的链接）可以比较 XML 文件，并以基于树的方式执行此操作。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-09-15T18:44:00.500

提供了一个简单的谷歌搜索：[不同](http://www.codeproject.com/KB/cs/differ.aspx)。我从来没有用过它，所以我不能保证它的质量:-)

# java - Java 类名中的有效字符

> ID：65475
> 
> 赞同：77
> 
> 时间：2008-09-15T18:35:04.187
> 
> 标签：java, class, unicode, naming-conventions, invalid-characters

Java 类名中哪些字符是有效的？还有哪些其他规则管理 Java 类名（例如，Java 类名不能以数字开头）？

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2008-09-15T18:37:06.583

您可以拥有几乎任何字符，包括大多数 Unicode 字符！确切的定义在[Java 语言规范第 3.8 节：标识符下](http://docs.oracle.com/javase/specs/jls/se7/html/jls-3.html#jls-3.8)。

> *标识符*是*Java 字母*和*Java 数字*的无限长度序列，其中第一个必须是*Java 字母*。...
> 
> 字母和数字可能来自整个 Unicode 字符集，......这允许程序员在他们的程序中使用以他们的母语编写的标识符。
> 
> 标识符不能与关键字（第 3.9 节）、布尔文字（第 3.10.3 节）或空文字（第 3.10.7 节）具有相同的拼写（Unicode 字符序列），否则会发生编译时错误。

但是，请参阅[此问题](https://stackoverflow.com/questions/61615/should-you-use-international-identifiers-in-javac)以了解您是否应该这样做。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-15T18:41:17.010

> 对于允许使用的名称类型，每种编程语言都有自己的一套规则和约定，Java 编程语言也不例外。命名变量的规则和约定可以总结如下：
> 
> *   变量名区分大小写。变量的名称可以是任何合法标识符——长度不限的 Unicode 字母和数字序列，以字母、美元符号“$”或下划线字符“_”开头。但是，惯例是始终以字母开头变量名，而不是“$”或“_”。此外，按照惯例，从不使用美元符号字符。您可能会发现在某些情况下自动生成的名称将包含美元符号，但您的变量名称应始终避免使用它。下划线字符也有类似的约定；虽然以“_”开头的变量名称在技术上是合法的，但不鼓励这种做法。不允许使用空格。
>     
>     
> *   后续字符可以是字母、数字、美元符号或下划线字符。惯例（和常识）也适用于该规则。为变量选择名称时，请使用完整的单词而不是隐晦的缩写。这样做将使您的代码更易于阅读和理解。在许多情况下，它还会使您的代码自我记录；例如，名为 cadence、speed 和 gear 的字段比 s、c 和 g 等缩写版本更直观。另请记住，您选择的名称不能是关键字或保留字。
>     
>     
> *   如果您选择的名称仅包含一个单词，则将该单词拼写为所有小写字母。如果它包含多个单词，则将每个后续单词的第一个字母大写。名称 gearRatio 和 currentGear 是该约定的主要示例。如果您的变量存储一个常量值，例如`static final int NUM_GEARS = 6`，则约定会略有变化，将每个字母大写并用下划线分隔后续单词。按照惯例，下划线字符从不在其他地方使用。

来自[官方 Java 教程](https://docs.oracle.com/javase/tutorial/java/nutsandbolts/variables.html)。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-15T19:49:12.247

除了先前的答案，值得注意的是：

1.  Java 允许在符号名称中使用任何 Unicode 货币符号，因此以下所有操作都可以：

> $var1 £var2 €var3

我相信货币符号的使用起源于 C/C++，其中由编译器添加到代码中的变量通常以“$”开头。Java 中一个明显的例子是内部类的“.class”文件的名称，按照惯例，其格式为“Outer$Inner.class”

2.  许多 C# 和 C++ 程序员采用将“I”放在接口（也称为 C++ 中的纯虚拟类）前面的约定。这在 Java 中不是必需的，因此也不需要这样做，因为 implements 关键字可以非常清楚地说明什么时候是接口。

比较：

> class Employee : public IPayable //C++

和

> 员工类：IPayable //C#

和

> Employee类实现Payable //Java

3.  许多项目使用在字段名称前放置下划线的约定，以便它们可以很容易地与局部变量和参数区分开来，例如

> 私人双倍工资；

极少数人在字段名称之后放置下划线，例如

> 私人双薪_;

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-06-26T14:20:21.890

正如 Jason Cohen 所述，Java 语言规范在 3.8 节中定义了合法标识符是什么：

“标识符是 Java 字母和 Java 数字的无限长度序列，其中第一个必须是 Java 字母。[...]‘Java 字母’是 Character.isJavaIdentifierStart(int) 方法返回的字符真。“Java 字母或数字”是 Character.isJavaIdentifierPart(int) 方法返回真的字符。

这希望能回答你的第二个问题。关于你的第一个问题；老师和（据我所知）Java 编译器都教过我，Java 类名应该是一个以大写字母 AZ 开头的标识符，但我找不到任何可靠的来源。在使用 OpenJDK 进行尝试时，以小写字母甚至 $ 符号开头的类名不会出现警告。但是，在使用 $ 符号时，如果您从 bash shell 编译，则必须将其转义。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-15T19:27:18.413

我想补充一下 bosnic 的答案，即任何有效的货币字符对于 Java 中的标识符都是合法的。th€is 是合法标识符，€this 和€ 也是如此。但是，我不知道如何编辑他或她的答案，所以我不得不发布这个微不足道的补充。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-02-18T19:19:52.567

> 还有哪些其他规则管理 Java 类名（例如，Java 类名不能以数字开头）？

*   Java 类名通常以大写字母开头。
*   Java 类名不能以数字开头。
*   如果类名中有多个单词，例如“MyClassName”，每个单词都应该以大写字母开头。例如-“MyClassName”。此命名约定基于**CamelCase**类型。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-01-18T15:55:09.270

类名应该是大写形式的名词，每个单词的首字母大写。使用完整的单词——避免使用首字母缩写词和缩写词（除非缩写词比长格式更广泛使用，例如 URL 或 HTML）。可以在此处阅读命名约定：

[http://www.oracle.com/technetwork/java/codeconventions-135099.html](http://www.oracle.com/technetwork/java/codeconventions-135099.html)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-09-07T13:25:38.373

标识符用于类名、方法名和变量名。标识符可以是大写和小写字母、数字或下划线和美元符号字符的任何描述性序列。它们不能以数字开头，以免与数字文字混淆。同样，Java 区分大小写，因此 VALUE 是不同于 Value 的标识符。有效标识符的一些示例是：

AvgTemp ,count a4 ,$test ,this_is_ok

无效的变量名称包括：

2计数，高温，不/正常

# algorithm - 您如何根据文本内容进行分类？

> ID：65487
> 
> 赞同：3
> 
> 时间：2008-09-15T18:36:37.567
> 
> 标签：algorithm, cluster-analysis, machine-learning, nlp

如何根据内容自动查找文本类别？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-01T12:42:19.610

我鼓励您查看与[Natural Language Toolkit](http://www.nltk.org/)捆绑的文本分类库。即使您不熟悉 Python，我想您也会发现该 API 相当直观。[NLTK Book](http://www.nltk.org/book)中有很多很好的例子，邮件列表中的人也很有帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-31T18:17:23.407

1.  阅读**[数据挖掘：实用机器学习工具和技术](http://www.cs.waikato.ac.nz/~ml/weka/book.html)**- Ian H. Witten，Eibe Frank
2.  使用**[Weka](http://www.cs.waikato.ac.nz/~ml/weka/)**或**[Orange](http://www.ailab.si/orange/)**

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-04-26T18:52:40.550

进行文本分类的最简单方法是使用[词袋](http://en.wikipedia.org/wiki/Bag-of-words_model)表示。每个文档中的单词/ n-gram 单词可以用作特征。有了这个，您可以将每个文档表示为度量空间中的向量。随后，您可以将[聚类](http://en.wikipedia.org/wiki/Cluster_analysis)应用于内容相似的文档组。例如，您可以使用带有这些向量的 k-means 聚类来将词汇相似的文档聚类在一起。

基于 Python 的文本挖掘工作台，[NTLK](http://www.nltk.org/)非常适合快速尝试此类任务（通常，python 非常适合处理文本）。您可能会发现它很有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T18:38:01.917

有一篇关于此的好论文：[http ://www.cs.utexas.edu/users/hyukcho/classificationAlgorithm.html](http://www.cs.utexas.edu/users/hyukcho/classificationAlgorithm.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T18:53:07.887

对内容（无论是文本还是多媒体）进行分类的最佳方法是使用[分类法](http://en.wikipedia.org/wiki/Enterprise_taxonomy)。大多数著名的 CMS 都内置了对分类法的支持。在各种 CMS 中，[Drupal](http://drupal.org)是对[分类法最好的支持之一。](http://drupal.org/handbook/modules/taxonomy)

# javascript - 减小 Javascript 和 CSS 文件大小的最佳方法是什么？

> ID：65491
> 
> 赞同：23
> 
> 时间：2008-09-15T18:37:09.843
> 
> 标签：javascript, css, jscompress

处理大型和/或许多 Javascript 和 CSS 文件时，减小文件大小的最佳方法是什么？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-15T20:08:36.753

除了使用服务器端压缩之外，使用智能编码是保持低带宽成本的最佳方式。您始终可以使用[Dean Edward 的 Javascript Packer 之](http://dean.edwards.name/download/#packer)类的工具，但对于 CSS，请花时间学习[CSS Shorthand](http://www.webcredible.co.uk/user-friendly-resources/css/css-shorthand-properties.shtml "CSS 速记示例")。例如使用：

```
background: #fff url(image.gif) no-repeat top left; 
```

...代替：

```
background-color: #fff;
background-image: url(image.gif);
background-repeat: no-repeat;
background-position: top left; 
```

此外，使用 CSS 的级联特性。例如，如果您知道您的网站将使用一种字体系列，请为 body 标签中的所有元素定义它，如下所示：

```
body{font-family:arial;} 
```

另一件可以帮助的事情是将您的 CSS 和 JavaScript 作为文件而不是内联或在每个页面的开头包含在内。这样，您的服务器只需在浏览器从缓存中删除后将它们提供给浏览器一次。

### 包括 Javascript

```
<script type="text/javascript" src="/scripts/loginChecker.js"></script> 
```

### 包括 CSS

```
<link rel="stylesheet" href="/css/myStyle.css" type="text/css" media="All" /> 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-15T18:38:11.747

[Minify](http://developer.yahoo.net/blog/archives/2007/07/high_performanc_8.html)似乎是缩小 Javascript 的最简单方法之一。

在 Web 服务器级别打开 zip 也会有所帮助。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-15T18:40:45.890

我建议不要直接调整文件，而是压缩它们。大多数客户都支持它。

我想你会发现这更容易而且同样有效。

[更多来自 Jeff 的冒险经历](http://www.codinghorror.com/blog/archives/000059.html)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-16T21:47:16.650

压缩和缩小（删除空格）是一个开始。

此外：

1.  将所有 JavaScript 和 CSS 包含到一个文件中。这样，浏览器可以在一个请求中下载源到服务器。将此作为构建过程的一部分。

2.  [使用缓存控制](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.9)http 标头在 Web 服务器级别打开缓存。将过期时间设置为较大的值（如一年），这样浏览器只会下载一次源。要允许将来进行编辑，请在查询字符串中包含版本号，如下所示：

`<script src="my_js_file.js?1.2.0.1" type="text/javascript"></script>`

`<link rel="stylesheet" type="text/css" href="my_css_file.css?3.1.0.926" />`

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-21T22:28:19.463

我很惊讶没有人建议对您的代码进行 gzip 压缩。直接节省约 50%！

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2018-12-12T08:51:10.157

以下是您可以执行此操作的在线工具：-

*   要缩小 java 脚本代码，您可以使用[Javascript Online Minifier Tool](https://www.cssminifiers.com/js-minify)。这是目前最好的 js minifier/un-minifiers

*   要缩小 css 代码，您可以使用[CSS Minifier/Minify Tool](https://www.cssminifiers.com/css-minifier)。这是目前最好的 css minifier/un-minifiers

以上是我似乎对你有用的工具。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-15T18:47:56.310

查看问题：[最佳 javascript 压缩器](https://stackoverflow.com/questions/28932/best-javascript-compressor)

根据您是否要对 JavaScript 文件进行 gzip 压缩，可能会改变您对压缩器的选择。（如果您还打算使用 gzip，目前 Packer 不是最佳选择，但请参阅上述问题以获取当前最佳答案）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-15T18:48:25.120

[Dojo Shrinksafe](http://shrinksafe.dojotoolkit.org/)是一个使用真正的 JS 解释器的 Javascript 压缩器，因此它不会破坏您的代码。其他的可以很好地工作，但是 Shrinksafe 是在构建脚本中使用的好方法，因为您不必重新测试压缩脚本。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-15T20:19:06.043

Shrinksafe 可能会有所帮助：[http](http://shrinksafe.dojotoolkit.org/) ://shrinksafe.dojotoolkit.org/ 我们正在使用它，它做得很好。在打包我们的 Web 应用程序时，我们从 ant 构建中执行它。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-15T20:28:46.410

[帮助 YUI Compressor](http://yuiblog.com/blog/2008/02/11/helping-the-yui-compressor)提供了一些关于如何调整脚本以实现更好的节省的好建议。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-16T20:32:12.010

[Google 托管了一些预压缩的 JavaScript 库文件](http://code.google.com/apis/ajaxlibs/)，您可以将它们包含在您自己的网站中。谷歌不仅为此提供带宽，而且基于大多数浏览器的文件缓存算法，如果用户已经从谷歌下载了另一个网站的文件，他们就不必再为你的网站下载了。对于那里的一些 90k+ JS 库来说，这是一个不错的小奖励。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-15T18:38:16.910

对于 javascript，我使用[Dean Edwards 的 Javascript Packer](http://dean.edwards.name/download/#packer)。它已被移植到 .NET、perl、php4、php5、WSH，甚至还有一个 aptana 插件。

Javascript 打包有几种风格——有些只是去掉注释和空格，有些会改变你的变量名以使其简洁，还有一些，好吧，我什至不知道他们做了什么，但输出肯定很小。高端压缩通过使用 eval() 函数来工作，这会给客户端带来一些额外的负担，因此如果您的脚本特别复杂，或者您正在为较慢的硬件进行设计，请记住这一点。Javascript 打包程序为您提供了您想要使用的压缩级别的选项。

对于 CSS，你能做的最好的就是去掉空格和注释。值得庆幸的是，这意味着您可以使用单行函数来实现：

```
function compressCSS($css) {
    return
        preg_replace(
            array('@\s\s+@','@(\w+:)\s*([\w\s,#]+;?)@'),
            array(' ','$1$2'),
            str_replace(
                array("\r","\n","\t",' {','} ',';}'),
                array('','','','{','}','}'),
                preg_replace('@/\*[^*]*\*+([^/][^*]*\*+)*/@', '', $css)
            )
        )
    ;
} 
```

虽然该功能和 Javascript 打包程序将减少单个文件的文件大小，但为了从您的站点获得最佳性能，您还需要减少您发出的 HTTP 请求的数量。每个 Javascript 和 CSS 文件都是一个单独的请求，因此将它们组合到一个文件中将获得最佳结果。您可以使用我在我的博客（无耻的自我插件）上写的程序/技术，而不是尝试维护一个单一的庞然大物 JS 文件，网址为[http://spadgos.com/?p=32](http://spadgos.com/?p=32)

该程序基本上会读取一个“构建脚本”类型的文件，该文件会同时将多个 Javascript 和 CSS 文件组合并压缩为一个（每个）为您（或更多，如果您愿意）。所有文件的输出和显示有几个选项。那里有更大的文章，源代码是免费提供的。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-16T06:15:17.780

YUI Compressor 在压缩 Javascript 和 CSS 方面做得很好。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-16T06:36:31.783

YUI Compressor 有我的投票权，原因很简单，它不仅仅对代码执行正则表达式转换，它实际上构建了代码的解析树，类似于 Javascript 解释器，然后以这种方式压缩它。它通常非常小心它如何处理标识符的压缩。

此外，它还有一个 CSS 压缩模式，我没怎么玩过。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-21T22:45:44.790

[CssTidy](http://csstidy.sourceforge.net/)是我所知道的最好的 CSS 优化器。它（可配置地）去除注释，消除空格，重写以使用许多速记规则[nickf 提到](https://stackoverflow.com/questions/65491/what-is-the-best-method-to-reduce-the-size-of-my-javascript-and-css-files#65505)的等等。压缩结果也有帮助，正如其他人所提到的。

压缩率可能相当高，它可以让您自由地广泛评论您的 CSS 而不必担心文件大小。

不幸的是，这种级别的预处理以不可预测（或可预测但不受欢迎）的方式与一些流行的“css hacks”交互。[有些工作](http://csstidy.sourceforge.net/hacks.php)，有些不工作，有些需要配置设置来降低其他事物的压缩级别（尤其是注释）。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2015-12-20T22:03:48.183

我发现[JSCompress](http://jscompress.com/)是一种很好的方法，它不仅可以缩小 JavaScript，还可以组合多个脚本。如果您只使用各种脚本一次，这很有用。压缩前节省了 70%（压缩后也节省了类似的东西）。

记得在之后添加任何版权声明。

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2008-09-15T20:21:35.087

我会试驾一下发布在[http://www.codeplex.com/NCOptimizer上的 ASP.Net 中的新运行时优化器](http://www.codeplex.com/NCOptimizer)

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2009-06-17T14:25:00.423

尝试[使用 Boryi 的 Web 压缩器工具](http://www.boryi.com/html/free-tools.html)来压缩您的标准 HTML 文件（没有嵌入 Javascript 代码和 css 代码，但可以链接或导入）、Javascript 代码（正确以 ; 结尾）和 css 代码。

# php - 为 .NET/Windows 和 PHP/Linux/Apache 网站使用 OpenID

> ID：65494
> 
> 赞同：1
> 
> 时间：2008-09-15T18:37:19.297
> 
> 标签：php, asp.net, linux, apache, openid

**是否可以同时*用于*`OpenID`网站和网站（Apache/Linux）？ *`.NET``PHP`***

 *我有一位经理想要*单点登录以访问任何/所有网站，无论哪个 Web 服务器托管网站*。

我创建`.NET`网络应用程序，`PHP`网站/应用程序由另一个程序员完成。

我将如何使用`OpenID`网络`.NET`应用程序？

`PHP`程序员呢？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-15T18:40:31.163

对于 .NET：[http ://code.google.com/p/dotnetopenid/](http://code.google.com/p/dotnetopenid/)

对于 PHP： http: [//openidenabled.com/php-openid/](http://openidenabled.com/php-openid/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-15T18:42:54.340

无论平台如何，您都可以对所有站点使用 OpenID。使用它便于登录（它是 javascript）： [https ://www.idselector.com/](https://www.idselector.com/)

对于您的 .NET 站点，dotnetopenid 可以很好地工作。对于 PHP，您可以使用此处的代码：http: [//openidenabled.com/php-openid/](http://openidenabled.com/php-openid/)

OpenID 使用 URL 来识别站点 - 而不是技术。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T18:38:16.097

使用以下库：

[http://code.google.com/p/dotnetopenid](http://code.google.com/p/dotnetopenid)

# sql - 哪个更快/最好？SELECT * 或 SELECT column1、colum2、column3 等

> ID：65512
> 
> 赞同：194
> 
> 时间：2008-09-15T18:38:49.450
> 
> 标签：sql, database

我听说`SELECT *`在编写 SQL 命令时使用这种做法通常是不好的做法，因为它对`SELECT`您特别需要的列更有效。

如果我需要`SELECT`表格中的每一列，我应该使用

```
SELECT * FROM TABLE 
```

或者

```
SELECT column1, colum2, column3, etc. FROM TABLE 
```

在这种情况下，效率真的很重要吗？如果您真的需要所有数据，我认为`SELECT *`在内部会更优化，但我是在对数据库没有真正了解的情况下这么说的。

我很想知道在这种情况下最佳做法是什么。

**更新：我可能应该指定我真正***想做*的唯一情况`SELECT *`是当我从一个表中选择数据时，我知道所有列都需要被检索，即使添加了新列也是如此。

然而，鉴于我所看到的响应，这似乎仍然是一个坏主意，并且`SELECT *`永远不应该用于我曾经想过的更多技术原因。

* * *

## 回答 #1

> 赞同：187
> 
> 时间：2008-09-15T18:41:23.110

选择特定列更好的一个原因是它提高了 SQL Server 可以从索引访问数据而不是查询表数据的可能性。

这是我写的一篇文章： [**选择查询是不良索引覆盖率的真正原因**](http://weblogs.asp.net/jgalloway/archive/2007/07/18/the-real-reason-select-queries-are-bad-index-coverage.aspx)

它也不易更改，因为任何使用数据的代码都将获得相同的数据结构，无论您将来对表模式进行何种更改。

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2008-09-15T21:53:18.330

鉴于**您选择所有列****的**规范，**此时**几乎没有区别 。然而，要意识到数据库模式确实发生了变化。如果您使用**`SELECT *`**，您将获得添加到表中的任何新列，即使您的代码很可能不准备使用或呈现该新数据。这意味着您将系统暴露在意外的性能和功能更改中。

您可能愿意将此视为一笔不小的成本，但要意识到您仍然不需要的列必须是：

1.  从数据库中读取
2.  通过网络发送
3.  编组到您的流程中
4.  （对于 ADO 类型的技术）保存在内存中的数据表中
5.  忽略和丢弃/垃圾收集

第 1 项有许多隐藏的成本，包括消除一些潜在的覆盖索引、导致数据页面加载（和服务器缓存抖动）、产生本来可以避免的行/页面/表锁定。

将此与指定列与指定列的潜在节省进行平衡**`*`**，唯一可能的节省是：

1.  程序员不需要重新访问 SQL 来添加列
2.  SQL 的网络传输更小/更快
3.  SQL Server 查询解析/验证时间
4.  SQL Server 查询计划缓存

对于第 1 项，现实情况是您将添加/更改代码以使用您可能添加的任何新列，因此这是一个清洗。

对于第 2 项，差异很少足以将您推入不同的数据包大小或网络数据包数量。如果您到了 SQL 语句传输时间是主要问题的地步，您可能需要首先降低语句速率。

对于第 3 项，没有任何节省，因为**`*`**无论如何都必须进行扩展，这意味着无论如何都要咨询表模式。实际上，列出列将产生相同的成本，因为它们必须针对架构进行验证。换句话说，这是一次彻底的清洗。

对于第 4 项，当您指定特定列时，您的查询计划缓存可能会变大，但前提**是**您要处理不同的列集（这不是您指定的）。在这种情况下，您**确实需要**不同的缓存条目，因为您需要根据需要使用不同的计划。

因此，由于您指定问题的方式，这一切都归结为面对最终模式修改时的问题弹性。如果您将此模式刻录到 ROM 中（它发生了），那么 an**`*`**是完全可以接受的。

但是，我的一般准则是您应该只选择您需要的列，这意味着**有时**看起来您要求所有列，但 DBA 和模式演变意味着可能会出现一些新列，这可能会极大地影响查询.

我的建议是您应该**始终选择特定的列**。请记住，您一遍又一遍地擅长做的事情，所以要养成正确做事的习惯。

如果您想知道为什么架构可能会在不更改代码的情况下更改，请考虑审计日志、生效/到期日期以及 DBA 为系统性地解决合规性问题而添加的其他类似内容。另一个不正当更改的来源是系统或用户定义字段中其他地方的性能的非规范化。

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2010-06-04T06:48:04.600

您应该只选择您需要的列。即使您需要所有列，最好列出列名，这样 sql server 就不必查询系统表的列。

此外，如果有人向表中添加列，您的应用程序可能会中断。你的程序也会得到它没有预料到的列，它可能不知道如何处理它们。

除此之外，如果表有一个二进制列，那么查询会慢得多并且使用更多的网络资源。

* * *

## 回答 #4

> 赞同：36
> 
> 时间：2010-06-04T07:03:28.663

有四大原因`select *`是一件坏事：

1.  最重要的实际原因是它迫使用户神奇地知道返回列的顺序。最好是明确的，这也可以保护您免受表格更改的影响，这很好地融入...

2.  如果您正在使用的列名称发生更改，最好尽早（在 SQL 调用时）捕获它，而不是在您尝试使用不再存在（或名称已更改等）的列时捕获它。 )

3.  列出列名使您的代码更加自文档化，因此可能更具可读性。

4.  如果您通过网络传输（或者即使您不是），您不需要的列只是浪费。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-09-15T18:50:04.713

指定列列表*通常*是最佳选择，因为如果有人向表中添加/插入列，您的应用程序不会受到影响。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-09-22T14:11:55.983

指定列名肯定更快 - 对于服务器。但如果

1.  **性能不是一个大问题**（例如，这是一个网站内容数据库，每个表中有数百行，可能是数千行，但不是数百万行）；和
2.  你的工作是使用一个通用框架创建**许多类似的小型应用程序**（例如面向公众的内容管理网站），而不是创建一个复杂的一次性应用程序；和
3.  **灵活性很重要**（为每个站点定制大量的数据库模式）；

那么你最好坚持使用 SELECT *。在我们的框架中，大量使用 SELECT * 允许我们将一个新的网站管理内容字段引入到一个表中，使其具有 CMS 的所有好处（版本控制、工作流/批准等），同时只触及代码几个点，而不是几十个点。

我知道 DB 专家会因此而恨我 - 继续，投票给我 - 但在我的世界里，开发人员的时间很稀缺，CPU 周期很丰富，所以我会相应地调整我节省的和浪费的。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2010-06-04T07:00:34.790

即使查询不是通过网络发送的，SELECT * 也是一种不好的做法。

1.  选择比您需要的更多的数据会使查询效率降低 - 服务器必须读取和传输额外的数据，因此需要时间并在系统上产生不必要的负载（不仅是网络，如其他人所提到的，还有磁盘、CPU 等。 ）。此外，服务器无法尽可能优化查询（例如，为查询使用覆盖索引）。
2.  一段时间后，您的表结构可能会发生变化，因此 SELECT * 将返回一组不同的列。因此，您的应用程序可能会获得一个具有意外结构的数据集并在下游某处中断。明确说明列可确保您获得已知结构的数据集，或在数据库级别获得明确的错误（如“未找到列”）。

当然，对于一个小而简单的系统来说，这一切都无关紧要。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-15T18:42:23.403

性能方面，带有特定列的 SELECT 可以更快（无需读取所有数据）。如果您的查询确实使用了所有列，则仍然首选带有显式参数的 SELECT。任何速度差异基本上是不明显的并且接近恒定时间。有一天，您的架构会发生变化，这是防止由此引起的问题的良好保险。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2010-06-04T14:00:57.763

到目前为止，这里已经回答了很多很好的理由，这里还有一个没有提到的理由。

明确命名列将帮助您进行后续维护。在某些时候，您将进行更改或故障排除，并发现自己在问“该列到底在哪里使用”。

如果您已经明确列出了名称，那么通过所有存储过程、视图等查找对该列的每个引用都很简单。只需为您的数据库模式转储一个 CREATE 脚本，然后通过它进行文本搜索。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-15T18:39:59.633

肯定定义列，因为 SQL Server 不必对列进行查找来提取它们。如果您定义列，则 SQL 可以跳过该步骤。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-09-15T18:40:57.293

指定您需要的列总是更好，如果您考虑一次，SQL 不必每次查询时都认为“wtf is *”。最重要的是，稍后有人可能会向表中添加您在查询中实际上不需要的列，在这种情况下，通过指定所有列会更好。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-09-15T18:47:35.530

“select *”的问题在于可能会带来您并不真正需要的数据。在实际的数据库查询期间，选定的列并没有真正添加到计算中。真正“繁重”的是数据传输回您的客户端，而您并不真正需要的任何列都只会浪费网络带宽并增加您等待查询返回的时间。

即使您确实使用了从“选择 *...”中获取的所有列，也只是现在。如果将来您更改表格/视图布局并添加更多列，即使您不需要它们，您也会开始将它们带入您的选择中。

“select *”语句不好的另一点是视图创建。如果您使用“select *”创建视图并稍后将列添加到表中，则视图定义和返回的数据将不匹配，您需要重新编译视图才能使其再次工作。

我知道写一个“select *”很诱人，因为我真的不喜欢手动指定查询中的所有字段，但是当你的系统开始发展时，你会发现花这些额外的时间是值得的/努力指定字段，而不是花费更多的时间和精力来消除视图上的错误或优化应用程序。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-09-15T18:47:53.843

虽然明确列出列对性能有好处，但不要发疯。

因此，如果您使用所有数据，请尝试 SELECT * 为简单起见（想象有很多列并执行 JOIN... 查询可能会变得很糟糕）。然后 - 测量。与明确列出列名的查询进行比较。

不要猜测性能，**测量它！**

当您有一些包含大数据的列（如帖子或文章的正文）并且在给定的查询中不需要它时，显式列表最有帮助。然后通过不在您的答案数据库服务器中返回它可以节省时间、带宽和磁盘吞吐量。您的查询结果也会更小，这对任何查询缓存都有好处。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2010-06-04T06:50:01.973

您真的应该只选择您需要的字段，并且只选择所需的数字，即

```
SELECT Field1, Field2 FROM SomeTable WHERE --(constraints) 
```

在数据库之外，动态查询存在注入攻击和畸形数据的风险。通常，您可以使用存储过程或参数化查询来解决这个问题。此外（虽然问题不大）每次执行动态查询时服务器都必须生成执行计划。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-09-15T18:43:12.700

如果您使用 * 或列，则选择同样有效（就速度而言）。

区别在于内存，而不是速度。当您选择多个列时，SQL Server 必须分配内存空间来为您提供查询服务，包括您请求的所有列的所有数据，即使您只使用其中之一。

就性能而言，重要的是执行计划，而这又在很大程度上取决于您的 WHERE 子句以及 JOIN、OUTER JOIN 等的数量......

对于您的问题，只需使用 SELECT *。如果您需要所有列，则没有性能差异。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2008-09-15T19:02:31.687

与 * 相比，使用显式字段名称并不快，当且仅当您需要获取所有字段的数据时。

您的客户端软件不应该依赖于返回字段的顺序，所以这也是无稽之谈。

您可能（尽管不太可能）需要使用 * 获取所有字段，因为您还不知道存在哪些字段（想想非常动态的数据库结构）。

使用显式字段名称的另一个缺点是，如果它们很多并且它们很长，那么它会使阅读代码和/或查询日志更加困难。

所以规则应该是：如果你需要所有字段，使用*，如果你只需要一个子集，明确命名它们。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2010-06-04T06:47:48.920

结果太大了。从 SQL 引擎生成结果并将结果发送到客户端的速度很慢。

客户端作为一个通用的编程环境，不是也不应该被设计为过滤和处理结果（例如 WHERE 子句、ORDER 子句），因为行数可能很大（例如数千万行）。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2010-06-04T06:58:37.567

只要您的列仍然存在（以任何顺序），命名您希望在应用程序中获得的每一列还可以确保您的应用程序在有人更改表时不会中断。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2015-03-12T09:48:05.057

性能方面，我看到两者都是平等的。但可用性方面有一些+和-

当您在查询中使用 (select *) 并且有人更改表并添加上一个查询不需要的新字段时，这是不必要的开销。如果新添加的字段是 blob 或图像字段怎么办？？？你的查询响应时间会很慢。

另一方面，如果您使用 (select col1,col2,..) 并且表被更改并添加了新字段，并且如果结果集中需要这些字段，则您始终需要在表更改后编辑您的选择查询。

但我建议始终在您的查询中使用 select col1,col2,... 并在以后更改表时更改查询...

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-09-15T18:43:37.270

这取决于您的数据库服务器的版本，但现代版本的 SQL 可以以任何一种方式缓存计划。我会说使用您的数据访问代码最易于维护的任何东西。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2008-09-15T18:44:17.223

最好的做法是准确说明您想要的列的一个原因是因为表结构将来可能会发生变化。

如果您正在使用基于索引的方法手动读取数据以使用查询结果填充数据结构，那么将来当您添加/删除列时，您将很难找出问题所在。

至于什么更快，我会听从其他人的专业知识。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2008-09-15T19:07:53.967

与大多数问题一样，这取决于您想要实现的目标。如果您想创建一个允许任何表中的所有列的数据库网格，那么“选择 *”就是答案。但是，如果您只需要某些列并且很少从查询中添加或删除列，那么请单独指定它们。

它还取决于您要从服务器传输的数据量。如果其中一列被定义为备忘录、图形、blob 等，而您不需要该列，则最好不要使用“Select *”，否则您将获得一大堆您不需要的数据想要，你的表现可能会受到影响。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2008-09-15T21:43:44.793

补充一下其他人所说的，如果您选择的所有列都包含在索引中，则将从索引中提取您的结果集，而不是从 SQL 中查找其他数据。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2008-11-09T13:33:49.783

如果要获取列数等元数据，SELECT * 是必需的。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2009-11-05T16:46:59.190

我会为此受到猛烈抨击，但我选择 * 因为几乎我所有的数据都是从 SQL Server 视图中检索的，这些视图将多个表中所需的值预先组合到一个易于访问的视图中。

然后，我确实希望视图中的所有列在将新字段添加到基础表时都不会改变。这还有一个额外的好处，就是允许我更改数据的来源。视图中的 FieldA 可能会被计算一次，然后我可以将其更改为静态的。无论哪种方式，View 都为我提供了 FieldA。

这样做的好处是它允许我的数据层获取数据集。然后它将它们传递给我的 BL，然后它可以从它们创建对象。我的主应用程序只知道对象并与之交互。我什至允许我的对象在传递数据行时自行创建。

当然，我是唯一的开发人员，所以这也有帮助:)

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2010-06-04T07:54:14.453

上面每个人都说的，加上：

如果您正在努力获得可读可维护的代码，请执行以下操作：

SELECT foo, bar FROM 小部件；

立即可读并显示意图。如果你打那个电话，你就知道你会得到什么。如果小部件只有 foo 和 bar 列，那么选择 * 意味着您仍然需要考虑返回的内容，确认订单映射正确等。但是，如果小部件有更多列但您只对 foo 感兴趣和 bar，那么当您查询通配符然后只使用返回的部分内容时，您的代码就会变得混乱。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2010-06-04T13:21:01.870

请记住，如果根据定义您有一个内部连接，则您不需要所有列，因为连接列中的数据是重复的。

在 SQl 服务器中列出列并不困难甚至耗时。您只需从对象浏览器中拖动它们（您可以通过从单词列中拖动来一次性完成）。对您的系统造成永久性的性能影响（因为这可以减少索引的使用，并且因为通过网络发送不需要的数据代价高昂），并且在数据库更改时更有可能出现意外问题（有时会添加列例如，您不希望用户看到）只是为了节省不到一分钟的开发时间是短视和不专业的。

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2019-05-04T14:29:06.023

这是一个旧帖子，但仍然有效。作为参考，我有一个非常复杂的查询，包括：

*   12张桌子
*   6 左连接
*   9个内连接
*   所有 12 个表共有 108 列
*   我只需要 54 列
*   一个 4 列的 Order By 子句

当我使用 Select * 执行查询时，平均需要 2869 毫秒。当我使用 Select 执行查询时，平均需要 1513 毫秒。

返回的总行数为 13,949。

毫无疑问，选择列名意味着比 Select * 更快的性能

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2008-09-15T18:43:53.230

绝对定义每次要选择的列。没有理由不这样做，性能改进非常值得。

他们永远不应该选择“SELECT *”

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2008-09-15T18:44:14.103

如果您需要每一列，那么只需使用 SELECT * 但请记住，顺序可能会发生变化，因此当您使用结果时，按名称而不是按索引访问它们。

我会忽略有关 * 需要如何获取列表的评论 - 解析和验证命名列的机会等于处理时间，如果不是更多的话。不要过早地优化 ;-)

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2008-09-15T18:44:47.517

在执行效率方面，我不知道有任何显着差异。但是为了程序员的效率，我会写字段的名称，因为

*   如果您需要按数字索引，或者您的驱动程序在 blob 值上的行为很有趣，您就知道顺序，并且您需要一个明确的顺序
*   如果您应该添加更多字段，您只阅读您需要的字段
*   如果您拼写错误或重命名字段，而不是记录集/行中的空值，则会收到 sql 错误
*   您可以更好地阅读正在发生的事情。

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2008-09-15T18:49:37.210

嘿，实用一点。在原型设计时使用 select *，在实施和部署时选择特定列。从执行计划的角度来看，两者在现代系统上是相对相同的。但是，选择特定列会限制必须从磁盘检索、存储在内存中和通过网络发送的数据量。

最终最好的计划是选择特定的列。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2008-09-15T18:51:44.443

还要记住变化。今天，Select * 只选择您需要的列，但明天它也可能选择我刚刚添加的 varbinary(MAX) 列，而您现在还检索了所有 3.18 GB 的二进制数据昨天在桌子上。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2008-09-15T18:55:14.170

让我们想想哪个更快。如果您可以只选择您需要的数据，那么它会更快。但是在测试中可以拉取所有数据，根据业务需求判断哪些数据可以过滤掉。

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2008-09-15T19:07:09.617

好吧，这实际上取决于您的指标和目的：

1.  如果您有 250 列并且想要（确实）全部选择它们，如果您想在同一天回家，请使用 select * :)
2.  如果您的编码需要灵活性并且需要的表很小，那么再次选择 * 可以帮助您更快地编码并更轻松地维护它。
3.  如果您想要强大的工程和性能：
    *   如果它们只是几个，请写下您的列名，或者
    *   编写一个工具，让您轻松选择/生成列名

根据经验，当我需要选择所有列时，我会使用“select *”，除非我有非常具体的理由不这样做（另外，我认为在有很多很多列的表上更快）

最后但并非最不重要的一点是，您希望如何添加或删除表中的列以影响您的代码或其维护？

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2008-09-15T19:12:32.130

两者的主要区别在于来回传递的数据量。任何关于时间差的论点都存在根本缺陷，因为“select *”和“select col1, ..., colN”会导致数据库引擎执行相同数量的相对工作。但是，每行传输 15 列与每行 5 列是 10 列的差异。

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2008-09-15T19:51:04.143

如果您关心速度，请确保使用准备好的语句。否则，我认为改变是你保护自己免受的影响。

/艾伦

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2008-09-15T20:01:19.703

我总是建议指定您需要的列，以防万一您的架构发生更改并且您不需要额外的列。

此外，用表名限定列名。当查询包含连接时，这一点至关重要。如果没有表限定条件，可能很难记住哪一列来自哪个表，并且将类似名称的列添加到其他表之一可能会破坏您的查询。

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2008-09-15T20:11:56.420

使用特定的字段名称，因此如果有人更改了您的表格，您不会得到意外的结果。关于主题：在进行插入时始终指定字段名称，因此如果您稍后需要添加列，则不必在生产版本中同时返回并修复程序并更改数据库。

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2008-09-15T20:42:13.630

我发现如果其他开发人员可能使用代码，或者数据库可能会更改，那么列出列名尤其重要，以便您始终获得一致的数据。

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2008-09-15T20:51:05.933

效率是否重要在很大程度上取决于生产数据集的大小（及其增长率）。如果您的数据集不会那么大，并且它们不会那么快增长，那么选择单个列可能不会带来太多性能优势。

随着更大的数据集和更快的数据增长速度，性能优势变得越来越重要。

要以图形方式查看是否有任何区别，我建议使用查询分析器查看 SELECT * 和等效的 SELECT col1、col2 等的查询执行计划。这应该告诉您这两个查询中哪一个更有效。您还可以生成一些不同数量的测试数据，看看时间是什么。

* * *

## 回答 #42

> 赞同：0
> 
> 时间：2008-09-16T13:38:22.113

当您有一个连接时，不使用 select * 对性能尤其重要，因为根据定义，至少两个字段包含相同的数据。您不想浪费网络资源将不需要的数据从数据库服务器发送到应用程序或 Web 服务器。使用 select * 似乎更容易，但这是一种不好的做法。由于将列名拖到查询中很容易，因此只需这样做即可。

使用 select * 时出现的另一个问题是有些白痴选择在表的中间添加新字段（总是一个不好的做法），如果您使用 select * 作为插入的基础，那么突然您的列顺序可能是错了，您可能会尝试将社会安全号码插入酬金（演讲者可能会获得报酬以选择非随机示例的金额），这可能对数据完整性非常不利。即使选择不是插入，当数据在报表或网页上突然处于磨损顺序时，它对客户来说也很糟糕。

我认为使用 select * 比使用列列表更可取。您可能认为它更易于维护，但实际上并非如此，并且当您不需要的字段被添加到表中时，它会导致您的应用程序无缘无故变慢。如果您使用列列表，您还必须面对修复不会损坏的问题的问题，因此您节省的不添加列的时间已经用完了。

* * *

## 回答 #43

> 赞同：0
> 
> 时间：2008-09-18T21:58:41.380

在某些情况下 SELECT * 有利于维护目的，但通常应避免使用。

这些是特殊情况，例如视图或存储过程，您希望在其中传播基础表中的更改，而无需更改使用该表的每个视图和存储过程。即使那样，这本身也可能导致问题，例如在您有两个视图连接的情况下。一个基础表发生更改，现在视图不明确，因为两个表都有一个同名的列。（请注意，只要您没有使用表前缀限定所有列，就会发生这种情况）。即使有前缀，如果你有这样的结构：

SELECT A. *, B.* - 您可能会遇到客户现在难以选择正确字段的问题。

一般来说，我不使用 SELECT *，除非我做出有意识的设计决策并指望相关风险很低。

* * *

## 回答 #44

> 赞同：0
> 
> 时间：2008-09-18T22:08:31.900

对于直接查询数据库（例如在 sqlplus 提示符下或通过数据库管理工具），选择 * 通常很好——它省去了写出所有列的麻烦。

另一方面，在应用程序代码中最好枚举列。这有几个好处：

*   代码更清晰
*   您将知道返回结果的顺序（这可能对您很重要，也可能不重要）

* * *

## 回答 #45

> 赞同：0
> 
> 时间：2008-12-03T22:25:22.067

我看到有几个人似乎认为指定列需要更长的时间。由于您可以从对象浏览器中拖动列列表，因此在查询中指定列（如果您有很多列并且需要花费一些时间将它们放在单独的行上）可能需要额外的时间。为什么人们认为这很耗时？

* * *

## 回答 #46

> 赞同：0
> 
> 时间：2010-06-04T06:53:57.250

如果您确实需要所有列，这`SELECT *` *可能*没问题 - 但您仍然应该单独列出它们。您当然不应该从表中选择所有行 - 即使应用程序和数据库位于同一服务器或网络上。传输所有行需要时间，尤其是随着行数的增长。您应该至少有一个 where 子句过滤结果，和/或对结果进行分页以仅选择需要显示的行子集。根据您使用的应用程序语言，存在几种 ORM 工具，以帮助查询和分页您需要的数据子集。例如，在 .NET Linq to SQL、Entity Framework 和 nHibernate 中，所有这些都将为您提供帮助。

* * *

## 回答 #47

> 赞同：-3
> 
> 时间：2008-09-15T18:58:51.213

如果记录遍历 Internet，则可以通过限制返回的列来获得巨大的性能提升。

* * *

## 回答 #48

> 赞同：-3
> 
> 时间：2020-09-29T13:05:15.543

When we need all columns, I think select * is faster than all columns.

# html - 如何在网站上找到损坏的链接

> ID：65515
> 
> 赞同：43
> 
> 时间：2008-09-15T18:39:29.700
> 
> 标签：html

推荐哪些技术或工具来查找网站上的损坏链接？

我可以访问日志文件，因此可以想象分析这些以查找 404 错误，但希望自动跟踪（或尝试跟踪）站点上的所有链接。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-09-15T18:40:39.930

对于 Chrome 扩展，有[hexometer](https://chrome.google.com/webstore/detail/hexometer-tool/hikinokpbcadaepfkacpnkhbdjfpfcgc)

请参阅Firefox 的[LinkChecker](http://www.kevinfreitas.net/extensions/linkchecker/)。

对于 Mac OS，有一个工具[Integrity](http://peacockmedia.co.uk/integrity/)可以检查 URL 是否有损坏的链接。

对于 Windows，有[Xenu 的 Link Sleuth](http://home.snafu.de/tilman/xenulink.html)。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2013-02-22T16:45:45.233

刚刚找到了一个 wget 脚本，可以满足您的要求。

```
wget --spider  -o wget.log  -e robots=off --wait 1 -r -p http://www.example.com 
```

这归功于[此页面](http://www.commandlinefu.com/commands/view/8234/check-broken-links-using-wget-as-a-spider)。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-15T18:45:41.650

我喜欢[W3C 链接检查器](http://validator.w3.org/checklink)。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-15T18:46:22.803

请参阅[链接检查器](http://wummel.github.io/linkchecker/)工具：

> LinkChecker 是一个免费的、GPL 许可的网站验证器。LinkChecker 检查 Web 文档或完整网站中的链接。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-15T18:42:03.780

要么使用解析您的日志文件并为您提供“断开链接”报告的工具（例如[Analog](http://www.analog.cx/)或 Google [Webmaster Tools](http://www.google.com/webmasters/tools/)），要么运行一个工具来爬取您的网站并报告断开的链接（例如[W3C Link Checker](http://validator.w3.org/checklink)）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-03-07T16:36:41.013

在 .NET 应用程序中，您可以设置 IIS 以将所有请求传递给 ASP.NET，然后在全局错误处理程序中，您可以捕获并记录 404 错误。这是您除了爬取您的网站以检查内部缺失链接之外还要做的事情。这样做可以帮助从其他站点找到损坏的链接，然后您可以通过 301 重定向将它们修复到正确的页面。

为了帮助您在内部测试您的网站，还有 Microsoft SEO 工具包。

当然最好的技术是在编译时避免问题！在 ASP.NET 中，您可以通过要求从每个页面上的静态方法生成所有链接来接近这一点，因此只有一个位置可以生成任何给定的 URL。例如[http://www.codeproject.com/KB/aspnet/StronglyTypedPages.aspx](http://www.codeproject.com/KB/aspnet/StronglyTypedPages.aspx)

如果你想要一个完整的 C# 爬虫，这里有一个：- [http://blog.abodit.com/2010/03/a-simple-web-crawler-in-c-using-htmlagilitypack/](http://blog.abodit.com/2010/03/a-simple-web-crawler-in-c-using-htmlagilitypack/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-01-25T14:54:23.193

我们的商业产品[DeepTrawl](http://www.deeptrawl.com)可以做到这一点，并且可以在 Windows / Mac 上使用。

披露：我是 DeepTrawl 背后的首席开发人员。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-15T18:49:53.463

您最好的选择是用您选择的脚本语言将您自己的蜘蛛组合在一起，它可以按照以下方式递归地完成：

```
// Pseudo-code to recursively check for broken links
// logging all errors centrally
function check_links($page)
{
    $html = fetch_page($page);
    if(!$html)
    {
        // Log page to failures log
        ...
    }
    else
    {
        // Find all html, img, etc links on page
        $links = find_links_on_page($html);
        foreach($links as $link)
        {
            check_links($link);
        }
    }
} 
```

一旦您的网站从 Google 获得了一定程度的关注，他们的[网站管理员工具](http://www.google.com/webmaster)在显示用户可能遇到的断开链接方面非常宝贵，但这是相当反动的 - 死链接可能会在谷歌索引它们并记录之前存在几周404 在您的网站管理员面板中。

像上面这样编写自己的脚本将向您显示所有可能损坏的链接，而无需等待 google（网站管理员工具）或您的用户（访问日志中的 404）偶然发现它们。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-16T01:35:00.043

有一个名为 CheckWeb 的 Windows 应用程序。它不再开发，但运行良好，并且代码是开放的（我相信是 C++）。

您只需给它一个 url，它就会爬取您的网站（以及您选择的外部链接），报告任何错误、图像/页面“权重”等。

[http://www.algonet.se/~hubbabub/how-to/checkweben.html](http://www.algonet.se/~hubbabub/how-to/checkweben.html)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-08-23T12:04:46.183

[LinkTiger](http://www.linktiger.com)似乎是一个非常完善的（虽然不是免费的）服务来做到这一点。我没有使用它，只是想添加它，因为它尚未提及。

# mono - Mono-Develop 在尝试创建选择 Gtk 对象（对话框）时抛出错误“”，为什么？

> ID：65516
> 
> 赞同：1
> 
> 时间：2008-09-15T18:39:34.970
> 
> 标签：mono, dialog, gtk, monodevelop

我最近开始使用 Mono-Develop IDE (v1) 在 Ubuntu 8.04 上使用 Mono (1.9.1)。我正在尝试使用 GTK-Sharp 2 为播放应用程序运行 GUI。

由于某种原因，当我尝试创建 gtk 对话框（`ColorSelectionDialog`或`MessageDialog`）时，编译器会抛出错误“'Gtk.ColorSelectionDialog.ColorSelectionDialog(GLib.GType)' is inaccessible due to its protection level (CS0122)”

也许这些对话框不是 GTK 库中的公共对象？

以下是一些引发异常的 c# 代码示例：

```
Gtk.ColorSelectionDialog dlg = new Gtk.ColorSelectionDialog(); //dont need any more than this 
```

有什么建议么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-15T18:52:27.810

找到了解决方案。不能使用没有参数的默认构造函数。由于某种原因，这个构造函数不起作用。如果它是这样调用的：

```
MessageDialog md = new MessageDialog (parent_window, 
                                  DialogFlags.DestroyWithParent,
                              MessageType.Error, 
                                  ButtonsType.Close, "Error loading file"); 
```

然后它工作正常。显然有些地方出了问题，但我没有技术知识如何弄清楚如何解决 Gtk 或 Mono 中的潜在问题。

# c++ - 在 C++ 中生成唯一 ID

> ID：65524
> 
> 赞同：9
> 
> 时间：2008-09-15T18:40:42.533
> 
> 标签：c++, hash

从 C++ 中的两个（或更多）短整数生成唯一 ID 的最佳方法是什么？我正在尝试唯一标识图中的顶点。顶点包含两到四个短整数作为数据，理想情况下，ID 是它们的某种散列。比起速度或易用性，更喜欢便携性和独特性。

这里有很多很棒的答案，我今晚将全部尝试，看看最适合我的问题。再说几句我在做什么。

该图是来自音频文件的样本集合。我使用该图作为马尔可夫链从旧文件生成一个新的音频文件。由于每个顶点存储几个样本并指向另一个样本，并且样本都是短整数，因此从数据中生成 ID 似乎很自然。将它们组合成一个 long long 听起来不错，但也许`generateID`我只需要像 0 1 2 3 这样简单的东西。不确定需要多少空间来保证唯一性，如果每个顶点存储 2 个 16 位样本，那么有 2^32 种可能的组合是否正确？那么如果每个顶点存储 4 个样本，那么有 2^64 种可能的组合？

库和平台特定的解决方案与这个问题并不真正相关。我不希望任何可能编译我的程序的人不得不下载其他库或更改代码以适应他们的操作系统。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-15T18:47:26.170

有时最简单的事情效果最好。

您可以只向 Vertex 对象添加一个 id 字段并按构造顺序为其分配一个数字吗？

```
static int sNextId = 0;
int getNextId() { return ++sNextId; } 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-15T18:46:18.183

一个简单的解决方案是使用 64 位整数，其中低 16 位是第一个顶点坐标，接下来的 16 位是第二个，依此类推。这对于您的所有顶点都是唯一的，尽管不是很紧凑。

所以这里有一些半途而废的代码来做到这一点。希望我选对了演员表。

```
uint64_t generateId( uint16_t v1, uint16_t v2, uint16_t v3, uint16_t v4)
{ 
   uint64_t id;
   id = v1 | (((uint64_t)v2) << 16) | (((uint64_t)v3) << 32) | (((uint64_t)v4) << 48);
   return id;
} 
```

或者，这可以通过联合来完成（Leon Timmermans 的好主意，请参阅评论）。这样很干净：

```
struct vertex
{
    uint16_t v1;
    uint16_t v2;
    uint16_t v3;
    uint16_t v4;
};

union vertexWithId
{
    vertex v;
    uint64_t id;
};

int main()
{
    vertexWithId vWithId;
    // Setup your vertices
    vWithId.v.v1 = 2;
    vWithId.v.v2 = 5;

    // Your id is automatically setup for you!
    std::cout << "Id is " << vWithId.id << std::endl;
    return 0;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T18:43:19.673

那么，保证 ID 唯一的唯一方法是使 id 组合比您获得的 id 多

例如，对于 2 条短裤（假设 16 位），您应该使用 32 位 int

```
int ID = ((int)short1 << 16) | short2; 
```

对于 4 条短裤，你需要一个 64 位的 int 等......

基本上任何其他冲突（多个事物可能获得相同的 id）几乎都可以保证。

然而，获取 id 的另一种方法（我认为会更好）是在插入顶点时将它们分发出去：

```
unsigned LastId = 0;//global

unsigned GetNewId(){return ++LastId;} 
```

这还具有允许您向每个顶点添加更多/不同数据的效果。但是，如果您希望在不重置的情况下创建超过 2^32 个顶点，这可能不是最好的方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T18:43:21.017

使用 long long 这样您就可以存储所有 4 种可能性，然后对每个 short 进行位移：

((long long)shortNumberX) << 0、4、8 或 12

确保在移动之前进行投射，否则您的数据可能会丢失。

编辑：忘记添加，您应该将它们组合在一起。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T19:13:32.643

如果您更喜欢可移植性，那么[boost::tuple](http://www.boost.org/doc/libs/1_35_0/libs/tuple/doc/tuple_users_guide.html)很好：

您需要一个包含 4 个项目的元组：

```
typedef boost::tuple<uint16,uint16,uint16,uint16> VertexID; 
```

您可以这样分配：

```
VertexID id = boost::make_tuple(1,2,3,4); 
```

boost tuple 已经支持比较、相等等，所以在容器和算法中很容易使用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-15T19:18:01.713

问题中“ID”的定义不是很清楚：您是否需要将其用作快速顶点查找的键？您可以定义一个比较器`std::map`（参见下面的示例）

您是否需要能够区分具有相同坐标（但在另一个字段中不同）的两个 Vertex 对象？定义一些“id 工厂”（参见单例模式），它生成例如与 Vertex 对象的值无关的整数序列。- 与 Fire Lancer 建议的方式很相似（但要注意线程安全问题！）

在我看来，具有相同坐标的两个顶点是相同的。那么为什么你甚至需要一个额外的ID呢？

只要您在此类型上定义了“[严格弱排序](http://en.wikipedia.org/wiki/Strict_weak_ordering)”，您就可以将其用作例如 an 中的键`std::map`，

```
struct Vertex {
  typedef short int Value;
  Value v1, v2;

  bool operator<( const Vertex& other ) const {
    return v1 < other.v1 || ( v1 == other.v1 && v2 < other.v2 ) ;
};

Vertex x1 = { 1, 2 };
Vertex x2 = { 1, 3 };
Vertex y1 = { 1, 2 }; // too!

typedef std::set<Vertex> t_vertices;

t_vertices vertices;
vertices.insert( x1 );
vertices.insert( x2 );
vertices.insert( y1 ); // won't do a thing since { 1, 2 } is already in the set.

typedef std::map<Vertex, int> t_vertex_to_counter;
t_vertex_to_counter count;
count[ x1 ]++;
assert( count[x1] == 1 );
assert( count[y1] == 1 );
count[ x2 ]++;
count[ y1 ]++; 
assert( count[x1] == 2 );
assert( count[y1] == 2 ); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-15T19:36:13.230

如果你在 Windows 上，你可以使用[CoCreateGUID](http://msdn.microsoft.com/en-us/library/ms688568(VS.85).aspx) API，在 Linux 上你可以使用 /proc/sys/kernel/random/uuid，你也可以查看'libuuid'。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-16T03:15:06.947

如果您正在构建一个用于存储顶点的哈希表，我可以想到几种避免冲突的方法：

1.  直接从输入数据生成 ID，不丢弃任何位，并使用足够大的哈希表来保存所有可能的 ID。对于 64 位 ID，后者将是非常有问题的：您将不得不使用一个小于您的 ID 范围的表，因此您将不得不处理冲突。即使使用 32 位 ID，您也需要超过 4GB 的 RAM 才能在不发生冲突的情况下实现这一目标。
2.  在读取顶点时按顺序生成 ID。不幸的是，这使得搜索先前读取的顶点以更新它们的概率非常昂贵，因为顺序 ID 生成器不是散列函数。如果用于构建马尔可夫链的数据量明显小于马尔可夫链用于生成的数据量（或者如果两者都很小），这可能不是问题。

或者，您可以使用为您处理冲突的哈希表实现（例如[unordered_map](http://en.cppreference.com/w/cpp/container/unordered_map) / [hash_map](http://www.sgi.com/tech/stl/hash_map.html)），并专注于应用程序的其余部分。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-05-12T09:09:29.630

尝试使用这个：

```
int generateID()
{
    static int s_itemID{ 0 };
    return s_itemID++; // makes copy of s_itemID,
                         increments the real s_itemID, 
                         then returns the value in the copy
} 
```

这从[这里](https://www.learncpp.com/cpp-tutorial/static-local-variables/)。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-05-12T15:12:48.623

实现自己的散列可能很乏味，并且容易出现一些在您推出或部分推出系统时难以调试和解决的问题。Windows API 中已经存在更好的唯一 ID 实现。您可以[在此处](https://docs.microsoft.com/en-us/windows/win32/api/guiddef/ns-guiddef-guid)查看更多详细信息；

[https://docs.microsoft.com/en-us/windows/win32/api/guiddef/ns-guiddef-guid](https://docs.microsoft.com/en-us/windows/win32/api/guiddef/ns-guiddef-guid)

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-09-15T18:50:29.750

即兴发挥我会说使用素数，

```
id = 3 * value1 + 5 * value2 + .... + somePrime * valueN 
```

确保你没有溢出你的 id 空间（长？长长？）。由于您有固定数量的值，因此只需丢弃一些随机素数。不要费心生成它们，列表中有足够的可用内容让您继续使用一段时间。

不过，我对证明有点粗略，也许更数学的人可以把我联系起来。可能与数字的唯一素数分解有关。

# tomcat - 在 Tomcat 中，我的 servlet 如何确定配置了哪些连接器？

> ID：65530
> 
> 赞同：1
> 
> 时间：2008-09-15T18:40:57.480
> 
> 标签：tomcat

在 Tomcat 5.5 中，server.xml 可以有许多连接器，通常只有 8080 端口，但对于我的应用程序，用户可能会将其 servlet.xml 配置为也打开其他端口（例如 8081-8088）。我想让我的 servlet 弄清楚哪些套接字连接端口将是有效的（在 Servlet.init() 期间，tomcat 尚未启动连接器。）

我可以自己找到并解析 server.xml（grotty），我可以查看线程名称（在 tomcat 启动后 - 但我怎么知道什么时候是这样做的好时机？）但我更喜欢一个可以在我的 servlet.init() 中执行并确定有效的端口范围。有任何想法吗？对于我的应用程序，可以将解决方案紧密绑定到 Tomcat，这没问题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-15T18:54:15.700

在 Tomcat 6.0 中，它应该类似于：

```
org.apache.catalina.ServerFactory.getServer().getServices 
```

获得服务。之后你可以使用

```
Service.findConnectors 
```

它返回一个最终具有该方法的连接器

```
Connector.getPort 
```

有关详细信息，请参阅[JavaDocs](http://tomcat.apache.org/tomcat-6.0-doc/api/org/apache/catalina/connector/Connector.html)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-15T18:59:16.780

为什么？

如果您在页面生成期间需要图像或 css 文件 URL，那么[ServletRequest.getLocalPort()](http://java.sun.com/javaee/5/docs/api/javax/servlet/ServletRequest.html#getLocalPort())或者更好的是[HttpServletRequest.getContextPath()](http://java.sun.com/javaee/5/docs/api/javax/servlet/http/HttpServletRequest.html#getContextPath())对于整个 shebang 有什么问题？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-22T07:07:09.437

无论您要做什么-我都不会走tomcat特定的道路。

如果您确实需要定位不同的端口，请通过通常的配置方式将它们配置到您的 webapp - 例如指定值。你不会有任何自动发现，但它也不会在下一次更新的 tomcats 上中断。

更具体地说，我想说我相信你问错了问题。例如，您有您的要求，选择了一种解决方案并询问如何实施该解决方案。如果您陈述您的第一手要求并为此寻求解决方案，我相信您会得到更好的答案。

# css - 如何使用css将文本放在“框”的右上角或右下角

> ID：65536
> 
> 赞同：15
> 
> 时间：2008-09-15T18:41:36.060
> 
> 标签：css, layout

我怎样才能让`here`and`and here`在右边，与 lorem ipsums 在同一行？请参阅以下内容：

```
Lorem Ipsum etc........here  
blah.......................  
blah blah..................  
blah.......................  
lorem ipsums.......and here 
```

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-09-15T18:47:32.893

```
<div style="position: relative; width: 250px;">
  <div style="position: absolute; top: 0; right: 0; width: 100px; text-align:right;">
    here
  </div>
  <div style="position: absolute; bottom: 0; right: 0; width: 100px; text-align:right;">
    and here
  </div>
  Lorem Ipsum etc <br />
  blah <br />
  blah blah <br />
  blah <br />
  lorem ipsums
</div>
```

让您非常接近，尽管您可能需要调整“顶部”和“底部”值。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-15T19:50:29.183

将要显示在右侧的文本向右浮动，并在标记中确保该文本及其周围的跨度出现在应该在左侧的文本之前。如果它没有首先出现，您可能会遇到浮动文本出现在不同行上的问题。

```
<html>
  <body>
    <div>
      <span style="float:right">here</span>Lorem Ipsum etc<br/>
      blah<br/>
      blah blah<br/>
      blah<br/>
      <span style="float:right">and here</span>lorem ipsums<br/>
    </div>
  </body>
</html> 
```

请注意，这适用于任何线条，而不仅仅是顶角和底角。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T18:48:23.063

```
<style>
  #content { width: 300px; height: 300px; border: 1px solid black; position: relative; }
  .topright { position: absolute; top: 5px; right: 5px; text-align: right; }
  .bottomright { position: absolute; bottom: 5px; right: 5px; text-align: right; }
</style>
<div id="content">
  <div class="topright">here</div>
  <div class="bottomright">and here</div>
  Lorem ipsum etc................
</div> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T18:53:37.480

如果包含 Lorum Ipsum 的元素的位置设置为绝对位置，则可以通过 CSS 指定位置。“here”和“and here”元素需要包含在块级元素中。我会像这样使用标记。

```
print("<div id="lipsum">");
print("<div id="here">");
print("  here");
print("</div>");
print("<div id="andhere">");
print("and here");
print("</div>");
print("blah");
print("</div>"); 
```

这是上面的CSS。

```
#lipsum {position:absolute;top:0;left:0;} /* 示例 */
#这里{位置：绝对；顶部：0；右：0；}
#andhere {位置：绝对；底部：0；右：0；}

```

同样，如果#lipsum 通过绝对定位，上述方法（可靠）才有效。

如果没有，您将需要使用 float 属性。

```
#here, #andhere {浮动：对；}

```

您还需要将标记放在适当的位置。为了更好地展示，您的两个 div 可能需要一些填充和边距，以便文本不会全部一起运行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T18:44:57.220

第一行由 3`<div>`秒组成。一个包含两个内部`<div>`s 的外部。第一个内部`<div>`将`float:left`确保它保持在左侧，第二个内部将具有`float:right`，这将使其保持在右侧。

```
<div style="width:500;height:50"><br>
<div style="float:left" >stuff </div><br>
<div style="float:right" >stuff </div> 
```

...显然内联样式不是最好的主意-但您明白了。

2,3 和 4 将是单`<div>`s。

5 会像 1 一样工作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-15T18:46:23.473

您需要将“这里”放入 a`<div>`或`<span>`with 中`style="float: right"`。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-15T18:46:54.377

您也许可以使用绝对定位。

容器框应设置为`position: relative`。

右上角的文本应设置为`position: absolute; top: 0; right: 0`. 右下角的文本应设置为`position: absolute; bottom: 0; right: 0`。

您需要尝试`padding`阻止框的主要内容在绝对定位元素下方运行，因为它们存在于文本内容的正常流程之外。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-15T19:49:55.113

或者更好的是，使用适合您需要的 HTML 元素。它更干净，并产生更精简的标记。例子：

```
<dl>
   <dt>Lorem Ipsum etc <em>here</em></dt>
   <dd>blah</dd>
   <dd>blah blah</dd>
   <dd>blah</dd>
   <dt>lorem ipsums <em>and here</em></dt>
</dl> 
```

`em`将 向右浮动（使用`display: block`），或将其设置为`position: absolute`与其父级为`position: relative`。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-03-24T22:51:24.850

您只需要将 div 元素向右浮动并给它一个边距。确保在这种情况下不要使用“绝对”。

```
#date {
  margin-right:5px;
  position:relative;
  float:right;
} 
```

# sql - 使用 ADO.NET 和 AddWithValue() 处理空值

> ID：65566
> 
> 赞同：3
> 
> 时间：2008-09-15T18:44:22.167
> 
> 标签：sql, vb.net, ado.net

我有一个控件，可以在回发时将表单结果保存回数据库。它通过遍历查询字符串来填充要保存的值。所以，对于下面的 SQL 语句（为了讨论而大大简化）......

```
UPDATE MyTable
SET MyVal1 = @val1,
    MyVal2 = @val2
WHERE @id = @id 
```

...它会因此循环遍历查询字符串键：

```
For Each Key As String In Request.QueryString.Keys
    Command.Parameters.AddWithValue("@" & Key, Request.QueryString(Key))
Next 
```

但是，我现在遇到的情况是，在某些情况下，其中一些变量可能不存在于查询字符串中。如果我没有在查询字符串中传递 val2，我会收到一个错误：`System.Data.SqlClient.SqlException: Must declare the scalar value "@val2"`.

尝试检测 SQL 语句中的缺失值...

```
IF @val2 IS NOT NULL
UPDATE MyTable
SET MyVal1 = @val1,
    MyVal2 = @val2
WHERE @id = @id 
```

... 失败了。

攻击这个的最好方法是什么？我必须用 RegEx 解析 SQL 块，扫描查询字符串中不存在的变量名吗？或者，有没有更优雅的方法？

更新：在 VB 代码隐藏中检测空值违背了将代码与其上下文分离的目的。我宁愿不要在我的函数中乱扔可能通过或未通过的每个可能的变量的条件。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-15T18:50:14.027

首先，我建议不要将查询字符串上的所有条目添加为参数名称，我不确定这是否不安全，但我不会冒险。

问题是你打电话

```
Command.Parameters.AddWithValue("@val2", null) 
```

而不是这个，你应该打电话：

```
If MyValue Is Nothing Then
    Command.Parameters.AddWithValue("@val2", DBNull.Value)
Else
    Command.Parameters.AddWithValue("@val2", MyValue)
End If 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-15T18:51:16.660

更新：我给出的解决方案是基于它是一个存储过程的假设。 *将默认值 Null 赋予 SQL 存储过程参数是否有效？*

如果是动态 sql，始终传递正确数量的参数，无论是 null 还是实际值或指定默认值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T18:57:06.333

我喜欢使用这种`AddWithValue`方法。

我总是为“可选”参数指定默认 SQL 参数。这样，如果它为空，ADO.NET 将不包含该参数，存储过程将使用它的默认值。

我不必以这种方式处理检查/传递 DBNull.Value 。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T20:37:23.067

在努力寻找一个更简单的解决方案之后，我放弃了并编写了一个例程来解析我的 SQL 查询中的变量名：

```
Dim FieldRegEx As New Regex("@([A-Z_]+)", RegexOptions.IgnoreCase)
Dim Fields As Match = FieldRegEx.Match(Query)
Dim Processed As New ArrayList

While Fields.Success
    Dim Key As String = Fields.Groups(1).Value
    Dim Val As Object = Request.QueryString(Key)
    If Val = "" Then Val = DBNull.Value
    If Not Processed.Contains(Key) Then
        Command.Parameters.AddWithValue("@" & Key, Val)
        Processed.Add(Key)
    End If
    Fields = Fields.NextMatch()
End While 
```

这有点像 hack，但它允许我让我的代码幸福地忽略我的 SQL 查询的上下文。

# eclipse - 在 Eclipse 中运行 PDT + XDebug 时如何摆脱 Javascript 运行时错误？

> ID：65576
> 
> 赞同：2
> 
> 时间：2008-09-15T18:45:23.867
> 
> 标签：eclipse, drupal, xdebug, eclipse-pdt

我目前正在使用 PDT 开发 Drupal 网页。在没有 XDebug 的情况下运行时，该站点工作正常。

当我启用 XDebug 时，该站点运行良好，但会打开大量需要单击的 Javascript 错误。

例子：

发生了运行时错误。你想调试吗？

行：1 错误：语法错误

--

似乎只有在XDebug/PDT 使用Firefox 作为浏览器时才会出现问题，使用IE 时不会出现此问题。会不会是与 Firebug 不兼容？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-24T21:27:08.147

这是解决此问题的方法：

关闭 XDebug 输出捕获：

Window -> Preferences，展开PHP，展开Debug，选择“Installed Debuggers”，选择“XDebug”，点击右侧的“Configure”，弹出配置对话框。在中间的“Output Capture Settings”中，将“Capture stdout”设置为“Off”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T02:05:02.380

这有点猜测，但请尝试 Windows => Preferences => JavaScript => Include Path

# c# - 是否有用于在 C# 应用程序中查找未引用函数（死、过时的代码）的工具？

> ID：65585
> 
> 赞同：18
> 
> 时间：2008-09-15T18:46:07.577
> 
> 标签：c#, .net, code-analysis

如果没有从任何地方调用 foo()，我想删除 foo()。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-15T18:47:50.473

[宪兵](http://www.mono-project.com/Gendarme)将检测没有上游调用者的私有方法。它可以跨平台使用，最新版本处理“ [AvoidUncallPrivateCodeRule](http://www.mono-project.com/Gendarme.Rules.Performance) ”。

[FxCop](http://msdn.microsoft.com/en-us/library/bb429476(VS.80).aspx "FxCop")将检测没有上游调用者的公共/受保护方法。但是，FxCop 不会检测没有上游调用者的所有方法，因为它旨在检查您的代码是否属于库的一部分，因此会忽略公共成员。[您可以使用 NDepend 搜索没有上游调用者的公共成员，我在另一个 StackOverflow 答案中对此进行了详细说明](https://stackoverflow.com/questions/71518/is-there-a-custom-fxcop-rule-that-will-detect-unused-public-methods#71929)。

*（编辑：添加了关于宪兵的信息，实际上是按照提问者的要求做的）*

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-15T19:38:04.347

[NDepend](http://www.ndepend.com)还将报告可能未使用的代码。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-15T19:04:17.643

请记住，如果方法被标记，Resharper（可能还有其他类似的工具）不会突出显示未使用的方法`public`。静态代码分析工具无法检查您的程序集的方法是否被您的解决方案之外的其他程序集使用。因此，淘汰未使用方法的第一步是降低它们对`private`or的可见性`internal`。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-15T18:47:43.547

[Resharper](http://www.jetbrains.com/resharper/)做到了这一点，而不仅仅是方法。它也可以通过 using 语句、变量等来实现。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-15T18:48:01.410

是的，[MZ-Tools](http://www.mztools.com/index.aspx)插件具有审查死代码功能。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-10-19T13:19:56.403

[NDepend](http://www.NDepend.com)工具可以帮助在 .NET 代码库中查找未使用的代码。*免责声明：我是这个工具的开发者之一。*

NDepend 建议[在 LINQ 查询 (CQLinq) 上编写代码规则](http://www.ndepend.com/Features.aspx#CQL)。提出了大约[200 条默认代码规则](http://www.ndepend.com/DefaultRules/webframe.html)，其中 3 条专用于*未使用/死代码*检测：

*   [潜在的死类型](http://www.ndepend.com/DefaultRules/webframe.html?Q_Potentially_dead_Types.html)（因此检测未使用的类、结构、接口、委托......）
*   [可能死掉的方法](http://www.ndepend.com/DefaultRules/webframe.html?Q_Potentially_dead_Methods.html)
*   [潜在死区](http://www.ndepend.com/DefaultRules/webframe.html?Q_Potentially_dead_Fields.html)

NDepend 集成在 Visual Studio 中，因此可以[在 IDE 中检查/浏览/编辑](http://www.ndepend.com/Doc_VS_CQL.aspx)这些规则。该工具还可以集成到您的 CI 流程中，它可以构建[报告](http://www.ndepend.com/SampleReports.aspx)，显示违反规则和罪魁祸首代码元素。

如果你点击这三个链接指向这些规则的源代码，你会发现关于类型和方法的部分有点复杂。这是因为它们不仅检测未使用的类型和方法，还检测*仅*由未使用的死类型和方法（递归）使用的类型和方法。

这是*静态分析*，因此规则名称中的前缀*可能是。*如果*仅*通过反射使用代码元素，则这些规则可能会将其视为未使用，但事实并非如此。

除了使用这 3 条规则之外，我还建议通过测试来衡量代码覆盖率并争取完全覆盖。通常，您会看到测试无法覆盖的代码实际上是可以安全丢弃的*未使用/死代码。*这在不清楚代码分支是否可达的复杂算法中特别有用。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-15T18:48:43.640

好吧，如果 VS 本身不这样做，一个简单的方法是右键单击该方法并选择“查找所有引用”。如果只有 1 个引用（声明它的地方），它很可能不会在其他任何地方使用。

# macros - 在 Common Lisp 中编写 ++ 宏

> ID：65607
> 
> 赞同：6
> 
> 时间：2008-09-15T18:47:57.820
> 
> 标签：macros, lisp, common-lisp

出于语义原因，我一直在尝试编写一个 Lisp 宏，该宏将在其他编程语言中执行相当于 ++ 的功能。我尝试以几种不同的方式来做到这一点，但它们似乎都不起作用，并且都被解释器接受，所以我不知道我是否有正确的语法。我对如何定义的想法是

```
(defmacro ++ (variable)
  (incf variable)) 
```

但这在尝试使用它时给了我一个简单的类型错误。什么会让它发挥作用？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-15T18:52:25.160

请记住，宏返回要计算的表达式。为此，您必须反引号：

```
(defmacro ++ (variable)
   `(incf ,variable)) 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-15T20:54:35.800

前面的两个答案都有效，但它们为您提供了一个宏，您称之为

```
(++ varname) 
```

而不是我怀疑你想要的 varname++ 或 ++varname。我不知道你是否真的可以得到前者，但对于后者，你可以做一个读取宏。由于它是两个字符，因此调度宏可能是最好的。未经测试，因为我没有一个方便的运行 lisp，但类似：

```
(defun plusplus-reader (stream subchar arg)
   (declare (ignore subchar arg))
   (list 'incf (read stream t nil t)))
(set-dispatch-macro-character #\+ #\+ #'plusplus-reader) 
```

应该使 ++var 实际上*读*为 (incf var)。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2012-05-12T22:13:42.073

语法`(++ a)`是一个无用的别名`(incf a)`。但是假设您想要后增量的语义：检索旧值。在 Common Lisp 中，这是用 完成的`prog1`，如：`(prog1 i (incf i))`。Common Lisp 不会受到不可靠或模棱两可的评估顺序的影响。前面的表达式意味着`i`被评估，并且值被隐藏在某个地方，然后`(incf i)`被计算，然后返回隐藏的值。

制作一个完全防弹`pincf`（post- `incf`）并不是一件容易的事。`(incf i)`具有`i`仅评估一次的 nice 属性。我们也想`(pincf i)`拥有那个属性。所以这个简单的宏不够用：

```
(defmacro pincf (place &optional (increment 1))
  `(prog1 ,place (incf ,place ,increment)) 
```

为了做到这一点，我们必须求助于 Lisp 的“分配位置分析器”`get-setf-expansion`来获取允许我们的宏正确编译访问的材料：

```
(defmacro pincf (place-expression &optional (increment 1) &environment env)
  (multiple-value-bind (temp-syms val-forms
                        store-vars store-form access-form)
                        (get-setf-expansion place-expression env)
    (when (cdr store-vars)
      (error "pincf: sorry, cannot increment multiple-value place. extend me!"))
    `(multiple-value-bind (,@temp-syms) (values ,@val-forms)
       (let ((,(car store-vars) ,access-form))
         (prog1 ,(car store-vars)
                (incf ,(car store-vars) ,increment)
                ,store-form))))) 
```

使用 CLISP 进行一些测试。（注意：依赖于材料的扩展`get-setf-expansion`可能包含特定于实现的代码。这并不意味着我们的宏不可移植！）

```
8]> (macroexpand `(pincf simple))
(LET* ((#:VALUES-12672 (MULTIPLE-VALUE-LIST (VALUES))))
 (LET ((#:NEW-12671 SIMPLE))
  (PROG1 #:NEW-12671 (INCF #:NEW-12671 1) (SETQ SIMPLE #:NEW-12671)))) ;
T
[9]> (macroexpand `(pincf (fifth list)))
(LET*
 ((#:VALUES-12675 (MULTIPLE-VALUE-LIST (VALUES LIST)))
  (#:G12673 (POP #:VALUES-12675)))
 (LET ((#:G12674 (FIFTH #:G12673)))
  (PROG1 #:G12674 (INCF #:G12674 1)
   (SYSTEM::%RPLACA (CDDDDR #:G12673) #:G12674)))) ;
T
[10]> (macroexpand `(pincf (aref a 42)))
(LET*
 ((#:VALUES-12679 (MULTIPLE-VALUE-LIST (VALUES A 42)))
  (#:G12676 (POP #:VALUES-12679)) (#:G12677 (POP #:VALUES-12679)))
 (LET ((#:G12678 (AREF #:G12676 #:G12677)))
  (PROG1 #:G12678 (INCF #:G12678 1)
   (SYSTEM::STORE #:G12676 #:G12677 #:G12678)))) ;
T 
```

现在这是一个关键的测试用例。在这里，这个地方包含一个副作用：`(aref a (incf i))`. 这必须只评估一次！

```
[11]> (macroexpand `(pincf (aref a (incf i))))
(LET*
 ((#:VALUES-12683 (MULTIPLE-VALUE-LIST (VALUES A (INCF I))))
  (#:G12680 (POP #:VALUES-12683)) (#:G12681 (POP #:VALUES-12683)))
 (LET ((#:G12682 (AREF #:G12680 #:G12681)))
  (PROG1 #:G12682 (INCF #:G12682 1)
   (SYSTEM::STORE #:G12680 #:G12681 #:G12682)))) ;
T 
```

所以首先发生的是`A`and`(INCF I)`被评估，并成为临时变量`#:G12680`and `#:G12681`。访问数组并在 中捕获值`#:G12682`。然后我们有我们的`PROG1`which 保留了返回值。`system::store`该值递增，并通过 CLISP 的函数存储回数组位置。请注意，此存储调用使用临时变量，而不是原始表达式`A`和`I`. `(INCF I)`只出现一次。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-10-27T23:36:15.940

我强烈建议不要为 incf 创建别名。它会降低其他阅读您的代码的人的可读性，他们必须问自己“这是什么？它与 incf 有什么不同？”

如果你想要一个简单的后增量，试试这个：

```
(defmacro post-inc (number &optional (delta 1))
  "Returns the current value of number, and afterwards increases it by delta (default 1)."
  (let ((value (gensym)))
    `(let ((,value ,number))
       (incf ,number ,delta)
       ,value))) 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-09-16T22:09:07.627

从语义上讲，前缀运算符 ++ 和 -- 在诸如 c++ 之类的语言中或在普通 lisp 中等效的 incf/decf 中。如果你意识到这一点，并且像你的（不正确的）宏一样，实际上是在寻找一个句法改变，那么你已经被展示了如何使用像 `(incf ,x) 这样的反引号来做到这一点。甚至已经向您展示了如何让读者绕过这个来获得更接近非 lisp 语法的东西。不过，这就是问题所在，因为这些都不是一个好主意。一般来说，使一种语言更接近另一种语言的非惯用编码并不是一个好主意。

但是，如果实际上是在寻找语义，您已经得到了前面提到的前缀版本，但后缀版本在语法上并不容易匹配。您可以使用足够多的阅读器黑客技术来做到这一点，但这并不漂亮。

如果这就是你要找的，我建议 a) 坚持使用 incf/decf 名称，因为它们是惯用的并且工作良好 b) 编写 post-incf、post-decf 版本，例如 (defmacro post-incf (x) `(prog1 ,x (incf ,x)) 之类的东西。

就个人而言，我不认为这会特别有用，但 ymmv。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-16T21:52:09.273

对于预增量，已经有 incf，但您可以定义自己的

```
(define-modify-macro my-incf () 1+) 
```

对于后增量，您可以使用它（来自 fare-utils）：

```
(defmacro define-values-post-modify-macro (name val-vars lambda-list function)
 "Multiple-values variant on define-modify macro, to yield pre-modification values"
 (let ((env (gensym "ENV")))
   `(defmacro ,name (,@val-vars ,@lambda-list &environment ,env)
      (multiple-value-bind (vars vals store-vars writer-form reader-form)
          (get-setf-expansion `(values ,,@val-vars) ,env)
       (let ((val-temps (mapcar #'(lambda (temp) (gensym (symbol-name temp)))
                                 ',val-vars)))
          `(let* (,@(mapcar #'list vars vals)
                  ,@store-vars)
             (multiple-value-bind ,val-temps ,reader-form
               (multiple-value-setq ,store-vars
                 (,',function ,@val-temps ,,@lambda-list))
               ,writer-form
               (values ,@val-temps))))))))

(defmacro define-post-modify-macro (name lambda-list function)
 "Variant on define-modify-macro, to yield pre-modification values"
 `(define-values-post-modify-macro ,name (,(gensym)) ,lambda-list ,function))

(define-post-modify-macro post-incf () 1+) 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-03-20T15:25:07.970

尽管我肯定会记住*simon*在他的帖子中评论的评论和提示，但我真的认为*user10029*的方法仍然值得一试，所以，只是为了好玩，我试图将它与接受的答案结合起来使**++x**运算符工作（即，将 x 的值增加 1）。试试看！

**解释**：好的旧 SBCL 不会编译他的版本，因为必须在 dispatch-char 查找表上显式设置“+”符号`make-dispatch-macro-character`，并且在评估它之前仍然需要宏传递变量的名称。所以这应该做的工作：

```
(defmacro increment (variable)
  "The accepted answer"
  `(incf ,variable))

(make-dispatch-macro-character #\+) ; make the dispatcher grab '+'

(defun |inc-reader| (stream subchar arg)
  "sets ++<NUM> as an alias for (incf <NUM>).
   Example: (setf x 1233.56) =>1233.56
            ++x => 1234.56
            x => 1234.56"
   (declare (ignore subchar arg))
   (list 'increment (read stream t nil t)))

(set-dispatch-macro-character #\+ #\+ #'|inc-reader|) 
```

有关用法示例，请参见`|inc-reader|`的*文档字符串。*（密切）相关的文档可以在这里找到：

*   [http://clhs.lisp.se/Body/f_set__1.htm](http://clhs.lisp.se/Body/f_set__1.htm)
*   [http://clhs.lisp.se/Body/f_mk_dis.htm#make-dispatch-macro-character](http://clhs.lisp.se/Body/f_mk_dis.htm#make-dispatch-macro-character)

这种实现的结果是不再理解像 +123 这样的数字条目（调试器使用 跳转`no dispatch function defined for #\Newline`）但进一步的解决方法（甚至避免）似乎是合理的：如果你仍然想坚持这个，也许最好的选择是不要采取++ 作为前缀，但 ## 或任何其他更多 DSL-ish 解决方案

干杯！

安德烈斯

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2008-09-15T18:54:32.940

这应该可以解决问题，但是我不是 lisp 大师。

```
(defmacro ++ (variable)
  `(setq ,variable (+ ,variable 1))) 
```

# apache-flex - 你能从 summaryObjectFunction 中返回一个字符串吗

> ID：65627
> 
> 赞同：4
> 
> 时间：2008-09-15T18:50:07.317
> 
> 标签：apache-flex, advanceddatagrid

在 Flex`AdvancedDatGrid`中，我们做了很多分组。大多数列对于父母和孩子都是相同的，所以我想将组的第一个值显示为摘要而不是 MAX、MIN 或 AVG

此代码适用于数值但不适用于文本值（没有注释行，您会得到 NaN）：

```
private function firstValue(itr:IViewCursor,field:String, str:String=null):Object 
{
  //if(isNaN(itr.current[field])) return 0  //Theory: Only works on Numeric Values?
  return itr.current[field]
} 
```

XML：

```
(mx:GroupingField name="Offer")
  (mx:summaries)
    (mx:SummaryRow summaryPlacement="group")
      (mx:fields)
        (mx:SummaryField dataField="OfferDescription"   label="OfferDescription" summaryFunction="firstValue"/)
        (mx:SummaryField dataField="OfferID"   label="OfferID" summaryFunction="firstValue"/)
        (/mx:fields)
    (/mx:SummaryRow)
  (/mx:summaries)
(/mx:GroupingField) 
```

`OfferID`的工作正确，`OfferDescription`不。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-09-10T17:10:07.600

如果您需要获取要显示的字符串，请使用高级数据网格列上的标签函数。这将呈现摘要行。

(mx:AdvancedDataGridColumn headerText="Comment" width="140" dataField="comment" labelFunction="formatColumn" /)

```
 private function getNestedItem(item:Object):Object {

                try {
                    if (item.undefined[0]) {
                        item = getNestedItem(item.undefined[0]);
                    }
                } catch (e:Error) {
                    // leave item alone
                }
                return item;
            }           
            private function formatColumn(item:Object, column:AdvancedDataGridColumn):String {

                var output:String;
                // If this is a summary row
                if (item.GroupLabel) {

                    item = getNestedItem(item);
                } 

                switch (column.dataField) {

                    case 'comment':

                        return item.comment;

                }

            } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T03:25:16.503

看起来 summaryFunction 必须返回一个数字。根据[Adob​​e bug tracker](https://bugs.adobe.com/jira/browse/FLEXDOCS-431)，这是文档中的一个错误：

> 萨米尔·巴特评论：
> 
> 在文档中提到 - SUM、MIN、MAX、AVG 和 COUNT 的内置汇总函数都返回一个包含汇总数据的数字。
> 
> 所以人们可以得到一个想法，但我同意你的观点，我们应该清楚地提到返回类型应该是一个数字。
> 
> 我们将它保留为一个对象，以便将来在其中添加更多内容变得容易。

# php - PHPUnit 测试的目录布局？

> ID：65651
> 
> 赞同：14
> 
> 时间：2008-09-15T18:53:24.203
> 
> 标签：php, unit-testing, phpunit

我是一名长期从事 PHP 项目的 Java 程序员，我正在尝试让 PHPUnit 正常工作。在 Java 中进行单元测试时，通常将测试用例类和常规类放在单独的目录中，如下所示 -

```
/src  
  MyClass.java

/test  
  MyClassTest.java 
```

等等。

使用 PHPUnit 进行单元测试时，遵循相同的目录结构是常见的，还是有更好的方法来布置测试类？到目前为止，我可以让“include（“MyClass.php”）”语句正常工作的唯一方法是将测试类包含在同一目录中，但我不想在推送时包含测试类生产。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-15T19:11:38.577

我认为将文件分开是个好主意。我通常使用这样的文件夹结构：

```
/myapp/src/        <- my classes
/myapp/tests/       <- my tests for the classes
/myapp/public/      <- document root 
```

在您的情况下，为了将类包含在您的测试文件中，为什么不将整个路径传递给 include 方法呢？

```
include('/path/to/myapp/src/MyClass.php'); 
```

或者

```
include('../src/MyClass.php'); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-15T19:04:57.110

您需要修改 PHP 的 include_path 以便`include()`在您进行单元测试时知道在哪里可以找到 MyClass.php。

你可以在你的测试文件的顶部有这样的东西（在你的包含之前）：

```
 set_include_path(get_include_path() . PATH_SEPARATOR . "../src"); 

```

这会将您的`src`目录附加到包含路径中，并且应该允许您将真实代码与测试代码分开。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T11:25:19.070

根据我的经验，Brian Phillips 的回答还远远不够。当您的测试由 PHPUnit 运行时，您不知道当前目录是什么。所以你需要在你的 set_include_path() 表达式中引用测试类文件的绝对路径。像这样：

```
set_include_path(get_include_path() . PATH_SEPARATOR . 
                        dirname(__FILE__) . "/../src"); 
```

这个片段可以放在它自己的头文件 SetupIncludePath.php 中，并包含在带有“require_once”的测试文件中，这样测试套件就不会多次附加路径。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-19T10:15:26.960

我将我的测试用例放在源代码旁边的一个同名但扩展名为 .phpt 的文件中。部署脚本在推送到生产环境时只是过滤掉 *.phpt。

# .net - 与 DataReader 一起使用时输出参数不可读

> ID：65662
> 
> 赞同：10
> 
> 时间：2008-09-15T18:55:13.827
> 
> 标签：.net, stored-procedures, ado.net, parameters, datareader

当使用`DataReader`对象通过存储过程访问数据库（如 SQL Server）中的数据时，在执行之前添加到 Command 对象的任何输出参数在读取后都不会被填充。我可以很好地读取行数据以及所有输入参数，但不能读取输出参数。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-15T18:55:33.420

这是由于[DataReaders](http://msdn.microsoft.com/en-us/library/system.data.common.dbdatareader.aspx)的“设计”性质。在关闭 DataReader 之前，任何标记为的参数`ParameterDirection.Output`都不会被“填充”。虽然仍然打开，但所有输出参数很可能会回来`null`。

可以在[此处](http://support.microsoft.com/kb/308621)查看有关此的完整 Microsoft 知识库文章。

# java - 为什么在 Java 中使用 StringBuffer 而不是字符串连接运算符

> ID：65668
> 
> 赞同：59
> 
> 时间：2008-09-15T18:55:47.820
> 
> 标签：java, optimization, string-concatenation

有人告诉我，`StringBuffer`在 Java 中使用连接字符串比使用 s 的`+`运算符更有效`String`。当你这样做时，引擎盖下会发生什么？有什么`StringBuffer`不同？

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2008-09-15T19:02:48.177

现在，几乎在所有情况下，最好使用 StringBuilder （它是一个不同步的版本；你什么时候并行构建字符串？），但会发生以下情况：

当您将 + 与两个字符串一起使用时，它会编译如下代码：

```
String third = first + second; 
```

对于这样的事情：

```
StringBuilder builder = new StringBuilder( first );
builder.append( second );
third = builder.toString(); 
```

因此，对于一些小例子，它通常没有什么区别。但是，当您构建一个复杂的字符串时，您通常需要处理的事情远不止这些；例如，您可能正在使用许多不同的附加语句，或者像这样的循环：

```
for( String str : strings ) {
  out += str;
} 
```

在这种情况下，每次迭代都需要一个新的`StringBuilder`实例和一个新的（ -s`String`的新值是不可变的）。这是非常浪费的。用一个来替换它意味着你可以只生产一个，而不是用你不关心的 s来填充堆。`out``String``StringBuilder``String``String`

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2008-09-15T19:18:30.790

对于简单的连接，例如：

```
String s = "a" + "b" + "c"; 
```

使用它是毫无意义的`StringBuffer`——正如*jodonnell*指出的那样，它将被巧妙地翻译成：

```
String s = new StringBuffer().append("a").append("b").append("c").toString(); 
```

**但是**在循环中连接字符串是非常糟糕的，例如：

```
String s = "";
for (int i = 0; i < 10; i++) {
    s = s + Integer.toString(i);
} 
```

在此循环中使用字符串会在内存中生成 10 个中间字符串对象：“0”、“01”、“012”等。在使用您编写相同的内容时，`StringBuffer`您只需更新一些内部缓冲区，`StringBuffer`并且您不会创建那些您不需要的中间字符串对象：

```
StringBuffer sb = new StringBuffer();
for (int i = 0; i < 10; i++) {
    sb.append(i);
} 
```

实际上，对于上面的示例，您应该使用`StringBuilder`（在 Java 1.5 中引入）而不是`StringBuffer`-`StringBuffer`稍微重一些，因为它的所有方法都是同步的。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2008-09-15T18:57:07.473

一个不应该比另一个快。在 Java 1.4.2 之前情况并非如此，因为当使用“+”运算符连接两个以上的字符串时，`String`会在构建最终字符串的过程中创建中间对象。

但是，正如[StringBuffer 的 JavaDoc](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/StringBuffer.html)所述，至少从使用“+”运算符的 Java 1.4.2 开始编译为创建 a`StringBuffer`和`append()`ing 到它的许多字符串。所以显然没有区别。

但是，在循环内使用将字符串添加到另一个字符串时要小心！例如：

```
String myString = "";

for (String s : listOfStrings) {
  // Be careful! You're creating one intermediate String object
  // for every iteration on the list (this is costly!)
  myString += s;
} 
```

但是请记住，通常将几个字符串与“+”连接比`append()`将它们全部连接起来更干净。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-15T18:57:09.377

在后台，它实际上创建并附加到一个 StringBuffer，在结果上调用 toString()。因此，实际上您不再使用哪个并不重要。

所以

```
String s = "a" + "b" + "c"; 
```

变成

```
String s = new StringBuffer().append("a").append("b").append("c").toString(); 
```

这对于单个语句中的一堆内联追加是正确的。如果您在多个语句的过程中构建字符串，那么您就是在浪费内存，而 StringBuffer 或 StringBuilder 是您更好的选择。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-09-15T19:04:14.333

我认为给定 jdk1.5（或更高版本）并且您的连接是线程安全的，您应该使用 StringBuilder 而不是 StringBuffer [http://java4ever.blogspot.com/2007/03/string-vs-stringbuffer-vs-stringbuilder.html](http://java4ever.blogspot.com/2007/03/string-vs-stringbuffer-vs-stringbuilder.html) 至于速度上的提升： [http ://www.about280.com/stringtest.html](http://www.about280.com/stringtest.html)

就我个人而言，我会编写代码以提高可读性，因此除非您发现字符串连接会使您的代码变得相当慢，否则请使用使您的代码更具可读性的任何方法。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-15T19:28:38.567

在某些情况下，由于编译器执行的优化，这已过时，但一般问题是代码如下：

```
string myString="";
for(int i=0;i<x;i++)
{
    myString += "x";
} 
```

将如下所示（每个步骤都是下一个循环迭代）：

1.  构造一个长度为 1 且值为 "x" 的字符串对象
2.  创建一个大小为 2 的新字符串对象，将旧字符串“x”复制到其中，在位置 2 添加“x”。
3.  创建一个大小为 3 的新字符串对象，将旧字符串“xx”复制到其中，在位置 3 添加“x”。
4.  ... 等等

如您所见，每次迭代都必须再复制一个字符，导致我们在每个循环中执行 1+2+3+4+5+...+N 次操作。这是一个 O(n^2) 操作。但是，如果我们事先知道我们只需要 N 个字符，我们可以在一次分配中完成，只复制我们正在使用的字符串中的 N 个字符 - 只需 O(n) 操作。

StringBuffer/StringBuilder 避免了这种情况，因为它们是可变的，因此不需要一遍又一遍地复制相同的数据（只要在它们的内部缓冲区中有空间可以复制）。他们避免执行与附加数量成正比的分配和复制，方法是按照其当前大小的比例过度分配缓冲区，从而提供摊销的 O(1) 附加。

然而值得注意的是，编译器通常能够自动将代码优化为 StringBuilder 样式（或者更好——因为它可以执行常量折叠等）。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-15T19:18:54.550

AFAIK 它取决于 JVM 的版本，在 1.5 之前的版本中，使用“+”或“+=”实际上每次都复制整个字符串。

请注意，使用 += 实际上会分配字符串的新副本。

正如在循环中使用 + 所指出的那样，涉及复制。

当连接的字符串是编译时常量时，在编译时连接，所以

```
String foo = "a" + "b" + "c"; 
```

已编译为：

```
String foo = "abc"; 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-15T19:01:41.923

Java 将 string1 + string2 转换为 StringBuffer 构造、append() 和 toString()。这是有道理的。

但是，在 Java 1.4 和更早版本中，它会为语句中的*每个+ 运算符**单独*执行此操作。这意味着执行 a + b + c 将导致*两个带有**两个*toString() 调用的StringBuffer 构造。如果你有一长串 concats，它会变成一团糟。自己做意味着你可以控制它并正确地做到这一点。

Java 5.0 及更高版本似乎更明智地做到了这一点，因此问题更小，当然也更少冗长。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-07-21T01:48:39.910

更多信息：

StringBuffer 是一个线程安全的类

```
 public final class StringBuffer extends AbstractStringBuilder
    implements Serializable, CharSequence
{
// .. skip ..
     public synchronized StringBuffer append(StringBuffer stringbuffer)
    {
        super.append(stringbuffer);
        return this;
    }
// .. skip ..
} 
```

但是 StringBuilder 不是线程安全的，因此如果可能的话使用 StringBuilder 会更快

```
 public final class StringBuilder extends AbstractStringBuilder
    implements Serializable, CharSequence
{
// .. skip ..
    public StringBuilder append(String s)
    {
        super.append(s);
        return this;
    }
// .. skip ..
} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-15T19:03:11.810

StringBuffer 类维护一个字符数组来保存您连接的字符串的内容，而 + 方法在每次调用时创建一个新字符串并附加两个参数 (param1 + param2)。

StringBuffer 更快，因为 1\. 它可能能够使用其已经存在的数组来连接/存储所有字符串。2\. 即使它们不适合数组，分配更大的后备数组比为每次调用生成新的 String 对象更快。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-15T18:57:39.047

StringBuffer 是可变的。它将字符串的值添加到*同一个*对象而不实例化另一个对象。做类似的事情：

```
myString = myString + "XYZ" 
```

将创建一个*新*的String 对象。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-15T19:02:11.470

要使用“+”连接两个字符串，需要为两个字符串分配空间，然后从两个字符串复制数据。StringBuffer 针对连接进行了优化，并分配了比最初所需更多的空间。在连接新字符串时，在大多数情况下，字符可以简单地复制到现有字符串缓冲区的末尾。
对于连接两个字符串，'+' 运算符的开销可能会更少，但是当你连接更多的字符串时，StringBuffer 会领先，使用更少的内存分配和更少的数据复制。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-15T19:04:15.100

因为字符串是不可变的，所以每次调用 + 运算符都会创建一个新的 String 对象并将 String 数据复制到新的 String 中。由于复制字符串所需的时间与字符串的长度呈线性关系，因此对 + 运算符的 N 次调用序列会导致 O(N ² ) 运行时间（二次）。

相反，由于 StringBuffer 是可变的，它不需要每次执行 Append() 时都复制 String，因此 N Append() 调用的序列需要 O(N) 时间（线性）。如果您将大量字符串附加在一起，这只会在运行时产生显着差异。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-15T19:04:56.843

如前所述，String 对象是不可变的，这意味着一旦创建（见下文）就无法更改。

> String x = new String("something"); // 或者
> 
> 字符串 x = "某事";

因此，当您尝试连接 String 对象时，会获取这些对象的值并将其放入新的 String 对象中。

如果您改为使用可变的 StringBuffer，您会不断地将值添加到 char（基元）的内部列表中，该列表可以扩展或截断以适应所需的值。不创建新对象，仅在需要保存值时创建/删除新字符。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-15T19:08:12.280

连接两个字符串时，实际上是在 Java 中创建了第三个 String 对象。使用 StringBuffer（或 Java 5/6 中的 StringBuilder）更快，因为它使用内部字符数组来存储字符串，并且当您使用它的 add(...) 方法之一时，它不会创建新的 String目的。相反，StringBuffer/Buider 附加了内部数组。

在简单的连接中，使用 StringBuffer/Builder 或 '+' 运算符连接字符串并不是真正的问题，但是在进行大量字符串连接时，您会发现使用 StringBuffer/Builder 更快。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2019-11-10T20:58:40.990

原因是字符串不可变。它不是修改字符串，而是创建一个新字符串。字符串池存储所有字符串值，直到垃圾收集器对其进行处理。想想有两个字符串作为`Hello`和`how are you`。如果我们考虑字符串池，它有两个字符串。

[![在此处输入图像描述](https://i.stack.imgur.com/fRNOG.jpg)](https://i.stack.imgur.com/fRNOG.jpg)

如果您尝试将这两个字符串连接为，

> 字符串 1 = 字符串 1+字符串 2

现在创建一个新的 String 对象并将其存储在 String 池中。

[![在此处输入图像描述](https://i.stack.imgur.com/NbKGW.jpg)](https://i.stack.imgur.com/NbKGW.jpg)

如果我们尝试连接数千个单词，它会获得更多内存。解决方案是 StringBuilder 或 StringBuffer。它只能创建一个 Object 并且可以修改。因为两者都是可变的。那么不需要更多的内存。如果您认为线程安全，则使用 StringBuffer，否则使用 StringBuilder。

```
public class StringExample {
   public static void main(String args[]) {
      String arr[] = {"private", "default", "protected", "public"};
      StringBuilder sb= new StringBuilder();
      for (String value : arr) {
         sb.append(value).append(" ");
      }
      System.out.println(sb);
   }
} 
```

> 输出：私有默认受保护公共

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-15T18:57:27.877

因为字符串在 Java 中是不可变的，所以每次连接字符串时，都会在内存中创建新对象。SpringBuffer 在内存中使用相同的对象。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-15T19:04:28.407

我认为最简单的答案是：它更快。

如果您真的想了解所有底层知识，您可以随时查看源代码：

[http://www.sun.com/software/opensource/java/getinvolved.jsp](http://www.sun.com/software/opensource/java/getinvolved.jsp)

[http://download.java.net/jdk6/latest/archive/](http://download.java.net/jdk6/latest/archive/)

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-09-15T19:06:39.290

[Java 语言规范的字符串连接运算符 +](http://java.sun.com/docs/books/jls/third_edition/html/expressions.html#15.18.1)部分为您提供了更多关于 + 运算符为何如此缓慢的背景信息。

# asp.net - ASP.NET 的 Comet 实现？

> ID：65673
> 
> 赞同：103
> 
> 时间：2008-09-15T18:56:59.437
> 
> 标签：asp.net, iis, comet

我一直在寻找在浏览器中实现类似 gmail 的消息传递的方法，并得出了[Comet](http://en.wikipedia.org/wiki/Comet_(programming))的概念。但是，我还没有找到允许我在 IIS 中执行此操作的良好 .NET 实现（我们的应用程序是用 ASP.NET 2.0 编写的）。

我找到的（或可能想到的）解决方案需要为每个用户留下一个正在运行的线程——这样一旦他收到消息，它就可以向他返回响应。当然，这根本无法扩展。

所以我的问题是 - 你知道以不同方式工作的 Comet 的 ASP.NET 实现吗？IIS甚至可以吗？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-09-16T04:08:26.303

由于 Comet 的持久连接性，Comet 很难通过 IIS 进行扩展，但现在有一个团队正在研究 Comet 方案。另请查看[Aaron Lerch 的博客](http://www.aaronlerch.com/blog/2007/07/08/creating-comet-applications-with-aspnet/)，因为我相信他在 ASP.NET 中完成了一些早期的 Comet 工作。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-07-27T19:37:27.350

[WebSync](http://www.frozenmountain.com/websync)是一种符合标准的可扩展 Comet 服务器，可直接集成到 IIS/.NET 管道中。它也可以作为托管服务按需提供。

它正式支持每个服务器节点最多 20,000 个并发客户端连接，但个别测试显示它高达 50,000 个。消息吞吐量在 1,000-5,000 个并发客户端标记附近是最佳的，从单个节点传递的消息高达每秒 300,000 条。

它包括对 JavaScript、.NET/Mono、iOS、Mac OS X、Java、Silverlight、Windows Phone、Windows Runtime 和 .NET Compact 的客户端支持，以及对 .NET/Mono 和 PHP 的服务器端支持。

使用开箱即用的 SQL Server 或 Azure 缓存支持集群，但可以为几乎任何东西（Redis、NCache）编写自定义提供程序。

**免责声明：**我为开发此产品的公司工作。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2011-04-13T14:22:12.933

我最近根据[Clay Lenhart 的一篇精彩文章](http://clay.lenharts.net/blog/2010/10/19/websockets-is-cool-but-what-can-you-do-today/)编写了一个使用 MVC 3 异步控制器[的长轮询聊天服务器的简单示例](https://bitbucket.org/jacob4u2/mvcchatsite/src "BitBucket 上的 MVC 聊天站点源")

您可以在我根据 BitBucket 项目的源设置[的 AppHarbor 部署中使用该示例。](http://mvcchatsite.apphb.com)

[此外，我的博客文章中](http://jacob4u2.posterous.com/mvc-3-long-polling-comet-chat-example)提供了更多信息，解释了该项目。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-07-20T14:54:22.713

实际上，使用 ASP.NET 创建支持 ajax 的网站有很多选择，但老实说，**[PokeIn](http://pokein.com)**是创建彗星 ajax 支持的 Web 应用程序的最简单方法。它挽救了我公司的一个项目。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-23T18:28:49.453

您还可以查看[Kaazing Enterprise Gateway](https://kaazing.com/products/websocket-gateway/editions/)，它已经发布了他们的 webSocket [HTML5] 网关的生产版本，它完全取代了 comet 方式并支持浏览器和应用程序服务器之间的全双工连接。

您还可以查看[Light Streamer 演示](http://www.lightstreamer.com/demos.htm)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-10-17T00:04:24.150

我很久以前曾经使用过一个聊天网站，它使用了一个定制的 http 流服务器。实际上，出于纯粹的好奇心，我曾一度复制了该软件，我认为这很容易做到。我永远不会尝试在 IIS 中实现类似类型的“无限请求”，尤其是在 ASP.NET 中，因为请求会无限期地占用线程池线程（或 IO 线程，如果使用异步处理程序），这意味着您只能在您的线程池配置允许的情况下为每台服务器处理这么多。

如果我对这种功能有强烈的合法需求，我会诚实地为它编写一个自定义的 http 服务器。

我知道这并不能真正回答您的问题，但我认为输入可能是相关的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-04-20T01:52:03.787

WS-I 小组发布了一个名为[“Reliable Secure Profile”](http://www.ws-i.org/deliverables/workinggroup.aspx?wg=reliablesecure)的东西，它有一个 Glass Fish 和[.NET 实现](http://msdn.microsoft.com/en-us/library/ee818238.aspx)，显然可以很好地[互操作](http://msdn.microsoft.com/en-us/library/ff842400.aspx#requestResponse)。

运气好的话，那里也有一个[Javascript](https://stackoverflow.com/questions/5724558/is-there-a-javascript-implementation-for-ws-i-reliable-secure-profile)实现。

还有一个使用[HTTP Duplex 的 Silverlight 实现。](http://msdn.microsoft.com/en-us/library/cc645027%28v=vs.95%29.aspx) 您可以[将 javascript 连接到 Silverlight](https://stackoverflow.com/questions/5449642/http-push-comet-reverse-ajaxusing-silverlight-to-javascript-bridge)对象以在推送发生时获取回调。

还有[商业付费版本](https://stackoverflow.com/questions/5427681/how-do-modern-implementations-of-comet-reverse-ajax-work-any-stable-c-wcf-or-as)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-16T03:29:56.133

我认为 Comet 方法不是真正可扩展的，除非您准备水平扩展 Web 场（通过添加更多 Web 服务器来混合）。它的工作方式是让每个用户会话打开一个 TCP 连接，这样服务器就可以不时将内容推送到该连接中，以立即通知用户更改或活动。

# php - 如何将 PHPUnit 与 Zend 框架一起使用？

> ID：65683
> 
> 赞同：41
> 
> 时间：2008-09-15T18:57:36.083
> 
> 标签：php, unit-testing, zend-framework, testing, phpunit

我想知道如何用 Zend_Test 和一般的 PHP 编写 PHPUnit 测试。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-16T07:31:58.063

我正在使用 Zend_Test 来完全测试所有控制器。设置起来非常简单，因为您只需要设置引导文件（引导文件本身不应该调度前端控制器！）。我的基本测试用例类如下所示：

```
abstract class Controller_TestCase extends Zend_Test_PHPUnit_ControllerTestCase
{
    protected function setUp()
    {
        $this->bootstrap=array($this, 'appBootstrap');
        Zend_Auth::getInstance()->setStorage(new Zend_Auth_Storage_NonPersistent());
        parent::setUp();
    }

    protected function tearDown()
    {
        Zend_Auth::getInstance()->clearIdentity();
    }

    protected function appBootstrap()
    {
        Application::setup();
    }
} 
```

`Application::setup();`所有设置实际应用程序的设置任务在哪里。一个简单的测试将如下所示：

```
class Controller_IndexControllerTest extends Controller_TestCase
{
    public function testShowist()
    {
        $this->dispatch('/');
        $this->assertController('index');
        $this->assertAction('list');
        $this->assertQueryContentContains('ul li a', 'Test String');
    }
} 
```

就这样...

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-08T13:59:36.790

他们在 Zend Developer Zone 上有一个“[单元测试艺术简介](http://devzone.zend.com/1115/an-introduction-to-the-art-of-unit-testing-in-php/)”，其中涵盖了 PHPUnit。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-21T11:24:12.383

我发现[这篇](http://weierophinney.net/matthew/archives/190-Setting-up-your-Zend_Test-test-suites.html)文章非常有用。Zend_Test文档也有很大帮助[。](http://framework.zend.com/manual/en/zend.test.html)在这两个资源的帮助下，我成功地在 Zend Framework 的[QuickStart 教程](http://framework.zend.com/docs/quickstart)中实现了单元测试，并为它编写了一些测试。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-03-08T07:03:36.020

使用 ZF 1.10，我将一些引导代码放入 tests/bootstrap.php（基本上是 (public/index.php) 中的内容，直到 $application->bootstrap()）。

然后我可以使用

```
phpunit --bootstrap ../bootstrap.php  PersonControllerTest.php 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T19:33:45.747

我没有使用 Zend_Test，但我已经使用 Zend_MVC 等针对应用程序编写了测试。最重要的部分是在测试设置中获得足够的引导代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-04-18T23:27:40.443

另外，如果您使用数据库事务，那么最好删除通过单元测试完成的所有事务，否则您的数据库会变得一团糟。

如此设置

```
public function setUp() {

    YOUR_ZEND_DB_INSTANCE::getInstance()->setUnitTestMode(true);

    YOUR_ZEND_DB_INSTANCE::getInstance()->query("BEGIN");

    YOUR_ZEND_DB_INSTANCE::getInstance()->getCache()->clear();

    // Manually Start a Doctrine Transaction so we can roll it back
    Doctrine_Manager::connection()->beginTransaction();
} 
```

在拆解时，您需要做的就是回滚

```
public function tearDown() {

    // Rollback Doctrine Transactions
    while (Doctrine_Manager::connection()->getTransactionLevel() > 0) {
        Doctrine_Manager::connection()->rollback();
    }

    Doctrine_Manager::connection()->clear();

    YOUR_ZEND_DB_INSTANCE::getInstance()->query("ROLLBACK");
    while (YOUR_ZEND_DB_INSTANCE::getInstance()->getTransactionDepth() > 0) {
        YOUR_ZEND_DB_INSTANCE::getInstance()->rollback();
    }
    YOUR_ZEND_DB_INSTANCE::getInstance()->setUnitTestMode(false);

} 
```

# c# - 从 FlowDocument 对象获取路径几何

> ID：65687
> 
> 赞同：2
> 
> 时间：2008-09-15T18:58:07.127
> 
> 标签：c#, wpf

有人能告诉我如何从 WPF FlowDocument 对象中获取路径几何吗？请注意，我**不想**使用`FormattedText`. 谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T21:11:29.410

获取在*整个****FlowDocument*****上初始化的TextRange**对象的**Text**属性：

 ****```
FlowDocument myFlowDocument = new FlowDocument();  //get your FlowDocument

//put in some (or it already has) text
string inText = "Hello, WPF World!";
TextRange tr = new TextRange(FlowDocument.ContentStart, FlowDocument.ContentEnd);
tr.Text = inText;

//get the current text out of the FlowDocument
TextRange trPrime = new TextRange(FlowDocument.ContentStart, FlowDocument.ContentEnd);
string outText = trPrime.Text;

//now outText == "Hello, WPF World!";

//to get formatting, looks like you would use myFlowDocument.TextEffects 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T19:58:05.537

`FlowDocument`可以通过多种方式查看A ，但 a`Path`是固定形状。我想也许你真的想要一些简化的、仅视觉形式的 a`FlowDocument`内容。

在这种情况下，您可以尝试将 s 转换`FlowDocument`为 XPS `FixedDocument`- `FixedPage`s 具有`Canvas`包含一堆`Path`s 和`Glyph`s 的 es。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T20:33:54.570

你能用吗

> ChildVisual = VisualTreeHelper.GetChild(Visual yourVisual)

不知道您是否可以将 Visual 转换为路径几何图形..

# flash - 那么到底哪个更快呢？Flash、Silverlight 或 GIF 动画？

> ID：65694
> 
> 赞同：2
> 
> 时间：2008-09-15T18:58:45.020
> 
> 标签：flash, silverlight, animated-gif

我正在尝试开发一个多媒体站点，并且我非常倾向于 Silverlight，但 Flash 始终是主要参与者。我是一名速度和性能类型的开发人员。在给定的场景中，哪种技术加载速度最快？56k、DSL 和电缆？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-15T19:05:12.913

这完全取决于你在做什么：动画、视频、计算等？有[一些测试表明 Silverlight 的原始计算速度更快](http://www.tobinharris.com/2008/8/30/performance-of-silverlight-vs-flash-vs-javascript-vs-tracemonkey)，而 Flash 的图形引擎则更进一步（GPU 利用率、3D 等）。

如果您谈论的是加载时间，那么您肯定可以在 Silverlight 中做一些事情来使您的 XAP 文件比大多数图像更小 - Hard Rock Memorabilia 团队将他们的 XAP 降低到 70K 以下，并且该网站浏览了 GB 的照片数据。我相信你可以在 Flash 中做同样的事情。

虽然您的问题集中在性能上，但正如其他人所提到的，您必须考虑 Silverlight 的 4.5MB 安装，因为它尚未广泛安装。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-15T19:07:50.550

Animator Gif 的速度通常比 Flash/Silverlight 快。但 Flash/Silverlight 处于不同的联盟。

WRT Flash Vs Silverlight：根据我看到的演示，flash 似乎比 silverlight 更快/更少 CPU 密集型。可能是因为Flash已经成熟了很多，有很多已知的优化代码可用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T19:01:01.393

实际上，您必须假设 Flash 可能已经安装在用户的浏览器上，而 SilverLight 可能没有。所以安装 silverlight 的成本（虽然下载量很小）也必须考虑在内。

然而，Silverlight 确实有一些非常简洁的开箱即用多媒体支持。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T19:01:21.690

这取决于您提供的内容。如果图像可以是矢量数据而不是光栅（如 .gif），那么 flash 或 silverlight 的大小将比等效的 .gif 小得多。

很难将 Silverlight 与 Flash 进行比较，因为它仍处于测试阶段。如果您选择使用 Silverlight，请意识到 Flash 安装在比 Silverlight 更多的机器上，因此此时您最好有充分的理由（Flash 缺少功能）来使用它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T19:02:30.983

Silverlight 还没有对关键任务产品的市场渗透。它的大规模部署主要是微软试图通过向 NBC 付费来举办奥运会内容等来推动市场渗透的情况。

Flash 是富媒体网站的事实标准。动画 GIF 非常有限，在大多数情况下不太可能是一个完整的解决方案。

# search - 我将如何像 Lucene 一样创建自定义搜索索引？

> ID：65704
> 
> 赞同：2
> 
> 时间：2008-09-15T19:00:06.060
> 
> 标签：search, indexing, multilingual

不久前我实现了一个 Lucene 搜索解决方案，它让我对可搜索的压缩文件索引感兴趣。当时我找不到任何关于您将如何创建自定义搜索索引的好信息，所以我想知道是否有人能指出我正确的方向？

我的主要兴趣是文件格式化、压缩以及类似于 Lucene 的文档和字段的概念。它不一定是特定于语言的，但是如果您可以向我指出具有特定于语言的实现并完整描述该过程的在线资源，那也没关系。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-15T19:08:49.113

[管理千兆字节](https://rads.stackoverflow.com/amzn/click/com/1558605703)作者：Alistair Moffat、Timothy C. Bell

![管理千兆字节封面](https://i.stack.imgur.com/9wNWV.jpg)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T19:11:41.853

您也可以尝试查看优秀的[Sphinx](http://www.sphinxsearch.com)搜索引擎的源代码。

它是现代全文开源搜索引擎，它使用智能优化的索引。

# versions - 版本中的数字通常代表什么（即 v1.9.0.1）？

> ID：65718
> 
> 赞同：156
> 
> 时间：2008-09-15T19:01:49.177
> 
> 标签：versions

也许这是一个愚蠢的问题，但我一直认为用句点描绘的每个数字代表软件的一个组件。如果这是真的，它们是否代表了不同的东西？我想开始为我的软件的不同版本分配版本，但我不确定它应该如何构建。我的软件有五个不同的组件。

* * *

## 回答 #1

> 赞同：235
> 
> 时间：2008-09-15T19:04:42.213

在版本*1.9.0.1 中*：

*   **1**：重大修订（新 UI、许多新功能、概念变化等）

*   **9**：次要修订（可能是对搜索框的更改，添加了 1 个功能，错误修复的集合）

*   **0**：错误修复发布

*   **1**：内部版本号（如果使用）——这就是为什么你看到 .NET 框架使用类似 2.0.4.2709 的东西

您不会发现很多应用程序会下降到四个级别，通常 3 个就足够了。

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2014-07-24T18:38:39.610

有[语义版本控制规范](https://semver.org/)

这是2.0.0版本的总结：

> 给定版本号 MAJOR.MINOR.PATCH，增加：
> 
> 1.  进行不兼容的 API 更改时的主要版本，
> 2.  以向后兼容的方式添加功能时的次要版本，以及
> 3.  进行向后兼容的错误修复时的补丁版本。
> 
> 预发布和构建元数据的附加标签可作为 MAJOR.MINOR.PATCH 格式的扩展。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-09-15T19:03:11.623

它可以是非常任意的，并且因产品而异。例如，对于 Ubuntu 发行版，8.04 指的是 2008.April

通常，最左边（主要）的数字表示主要版本，并且越往右，所涉及的更改越小。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-09-15T19:04:19.530

主要.次要[.maintenance[.build]]

[http://en.wikipedia.org/wiki/Software_versioning#Numeric](http://en.wikipedia.org/wiki/Software_versioning#Numeric)

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-09-15T20:05:07.950

正如其他答案所描述的那样，数字可能很有用，但考虑一下它们如何也可能毫无意义...... Sun，你知道 SUN，java：1.2、1.3、1.4 1.5 或 5 然后 6。在旧的 Apple II 版本中，数字意味着某物。如今，人们放弃了版本号，取了一些愚蠢的名字，比如“Feisty fig”（或类似的东西）、“hardy heron”、“europa”和“ganymede”。当然，这用处不大，因为在停止更改程序之前，您将用完木星的卫星，并且由于没有明显的顺序，您无法分辨哪个是更新的。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-09-15T19:05:57.373

点数越多，释放越小。除此之外没有真正可靠的标准 - 根据项目维护者的决定可能意味着不同的事情。

例如，WordPress 遵循以下原则：

1.6 -> 2.0 -> 2.0.1 -> 2.0.2 -> 2.1 -> 2.1.1 -> 2.2 ...

1.6 到 2.0 将是一个大版本 - 功能、界面更改、API 的重大更改、一些 1.6 模板和插件的损坏等。2.0 到 2.0.1 将是一个小版本 - 可能修复安全错误。2.0.2 到 2.1 将是一个重要的版本——通常是新功能。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2018-12-04T09:55:12.850

在 v1.9.0.1 版本中： **这是**在您不想为预发布使用名称或构建类似 -alpha、-beta 时使用的显式版本控制方案。

1：可能破坏向后兼容性的主要版本

9：添加新功能以支持您的应用程序以及与以前版本的向后兼容性。

0：一些小错误修复

1：内部版本号（预发布号）

但现在，你不会找到这样的版本控制方案。请参考语义版本控制 [semver2.0] [https://semver.org/](https://semver.org/)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-15T19:03:46.787

release.major.minor.revision 将是我的猜测。
但产品之间的差异可能很大。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-15T19:05:32.820

版本号通常不代表单独的组件。对于某些人/软件来说，数字是相当随意的。对于其他人来说，版本号字符串的不同部分确实代表不同的东西。例如，某些系统会在文件格式更改时增加部分版本号。所以 V 1.2.1 是与所有其他 V 1.2 版本（1.2.2、1.2.3 等）兼容的文件格式，但与 V 1.3 不兼容。最终取决于您要使用哪种方案。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-15T19:04:46.330

通常它的：

MajorVersion.MinorVersion.Revision.Build

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-15T19:06:04.673

这取决于，但典型的表示是*major.minor.release.build*。

在哪里：

*   *major*是您的软件的主要发布版本，例如 .NET 3.x
*   *次要*是您的软件的次要版本，例如 .NET x.5
*   *release*是该版本的发布，通常错误修正会增加这个
*   *build*是一个数字，表示您已执行的构建次数。

例如，1.9.0.1 意味着它是您的软件的 1.9 版，在 1.8 和 1.7 等之后。其中 1.7、1.8 和 1.9 都以某种方式通常会在错误修复的同时添加少量新功能。由于它是 xx0.x，它是 1.9 的初始版本，也是该版本的第一个版本。

您还可以在[有关该主题的 Wikipedia 文章中](http://en.wikipedia.org/wiki/Software_versioning)找到很好的信息。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-09-15T19:06:19.010

主要.次要.错误

（或对此的一些变化）

错误通常是没有新功能的错误修复。

Minor 是一些添加新功能但不会以任何主要方式更改程序的更改。

主要是程序中的更改，它要么破坏旧功能，要么太大以至于它以某种方式改变了用户应该如何使用程序。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-09-15T19:10:55.770

每个人都选择他们想用这些数字做什么。我一直很想将releases称为abc，因为无论如何它都相当愚蠢。话虽如此，我在过去 25 多年的发展中所看到的往往是这样的。假设您的版本号是 1.2.3。

“1”表示“主要”修订。通常这是初始版本、大型功能集更改或重要部分代码的重写。一旦确定了功能集并至少部分实现了，您将转到下一个数字。

“2”表示系列中的一个版本。我们经常利用这个职位来了解上一个主要版本中没有出现的功能。这个位置 (2) 几乎总是表示添加了功能，通常带有错误修复。

大多数商店中的“3”表示补丁发布/错误修复。几乎从来没有，至少在商业方面，这表明一个重要的特性添加。如果功能出现在第 3 位，那么可能是因为在我们知道我们必须进行错误修复发布之前有人签入了一些东西。

超越“3”的位置？我不知道为什么人们会做那种事情，它只会变得更加混乱。

值得注意的是，那里的一些 OSS 将所有这些都搞砸了。例如，Trac 版本 10 实际上是 0.10.XX 我认为 OSS 世界中的很多人要么缺乏信心，要么只是不想宣布他们已经完成了主要版本。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-15T19:04:33.290

Major.minor.point.build 通常。Major 和 minor 是不言自明的，point 是一些小错误修复的发布，而 build 只是一个构建标识符。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-15T19:05:50.947

是的。主要版本添加了大的新功能，可能会破坏兼容性或具有显着不同的依赖关系等。

次要版本也添加了功能，但它们更小，有时是来自 beta 主要版本的精简移植版本。

如果有第三个版本号组件，它通常用于重要的错误修复和安全修复。如果还有更多，它真的非常依赖于产品，很难给出一般性的答案。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-15T19:07:36.683

一般来说，数字是 version.major.minor.hotfix 的格式，而不是单独的内部组件。所以 v1.9.0.1 将是版本 1，主要版本 9（v1），次要版本（v1.9）0，（v1.9.0）的热修复 1。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-09-15T19:11:07.750

从 C# AssemblyInfo.cs 文件中，您可以看到以下内容：

```
// Version information for an assembly consists of the following four values:
//
//      Major Version
//      Minor Version 
//      Build Number
//      Revision
//
/ You can specify all the values or you can default the Build and Revision Numbers 
// by using the '*' as shown below:
// [assembly: AssemblyVersion("1.0.*")] 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-09-15T19:59:29.897

我认为主要版本.次要版本.bug 修复的范式很常见。

在某些企业支持合同中，存在与如何指定特定版本相关的 $$$（或违反合同责任）。例如，一份合同可能授权客户在一段时间内获得一定数量的主要版本，或者承诺在一段时间内将有少于 x 个次要版本，或者将继续为这么多的版本提供支持发布。当然，无论在合同中写了多少字来解释什么是主要版本和次要版本，它始终是主观的，并且总是存在灰色区域 - 导致软件供应商可以将系统游戏到击败此类合同条款。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-09-25T17:20:26.317

人们并不总是能识别出 2.1、2.0.1 或 2.10 等版本号之间的细微差别——询问技术支持人员他们遇到过多少次问题。开发人员注重细节，熟悉层次结构，所以这对我们来说是一个盲点。

如果可能，请向您的客户公开一个更简单的版本号。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2010-11-28T16:34:27.910

在库的情况下，版本号告诉您两个版本之间**的兼容性级别**，以及升级的难度。

错误修复版本需要保留二进制、源代码和序列化兼容性。

次要版本对不同的项目意味着不同的东西，但通常它们不需要保持源代码兼容性。

主要版本号可以打破所有三种形式。

[我在这里](http://motlin.com/2010/how-to-do-version-numbers/)写了更多关于基本原理的文章。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-09-15T19:04:50.823

主要、次要、补丁、构建、安全补丁等的组合。

前两个是主要的和次要的——其余的将取决于项目、公司，有时还取决于社区。在像 FreeBSD 这样的操作系统中，您将拥有 1.9.0.1_number 来表示安全补丁。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-09-15T19:06:34.033

取决于语言，例如 Delphi 和 C# 有不同的含义。

通常，前两个数字代表主要和次要版本，即 1.0 表示第一个真正的版本，1.1 表示一些重要的错误修复和次要新功能，2.0 表示大的新功能版本。

第三个数字可以指“真正次要”的版本或修订版。例如，1.0.1 只是对 1.0.0 的一个非常小的错误修复。但它也可以携带来自您的源代码控制系统的修订号，或者随着每次构建而增加的不断增加的数字。或日期戳。

[这里](https://stackoverflow.com/questions/650/automatically-update-version-number#706)稍微详细一点。“正式”，在 .net 中，4 个数字是“Major.Minor.Build.Revision”，而在 Delphi 中有“Major.Minor.Release.Build”。我使用“Major.Minor.ReallyMinor.SubversionRev”进行版本控制。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-09-15T19:09:34.057

第一个数字通常称为主要版本号。它基本上用于表示构建之间的重大变化（即，当您添加许多新功能时，您会增加主要版本）。来自同一产品的不同主要版本的组件可能不兼容。

下一个数字是次要版本号。它可以代表一些新功能，或者一些错误修复或小的架构更改。来自同一产品的不同次要版本号的组件可能会或可能不会一起工作，并且可能不应该一起工作。

下一个通常称为内部版本号。这可以每天增加，或者随着每个“发布”的构建增加，或者每次构建都增加。两个组件之间可能只有很小的差异，它们仅在内部版本号上有所不同，并且通常可以很好地协同工作。

最终编号通常是修订号。这通常由自动构建过程使用，或者当您制作“一次性”一次性构建以进行测试时。

当您增加版本号时，由您决定，但它们应该始终*增加*或*保持不变*。您可以让所有组件共享相同的版本号，或仅在更改的组件上增加版本号。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-09-15T19:11:36.563

一个复杂软件的版本号代表了整个包，与各个部分的版本号无关。Gizmo 版本 3.2.5 可能包含 Foo 版本 1.2.0 和 Bar 版本 9.5.4。

创建版本号时，按如下方式使用它们：

1.  第一个数字是主要版本。如果您对用户界面进行了重大更改或需要破坏现有界面（这​​样您的用户将不得不更改他们的界面代码），您应该转到新的主版本。

2.  第二个数字应表明已添加新功能或内部工作方式有所不同。（例如，Oracle 数据库可能决定使用不同的策略来检索数据，使大多数事情变得更快，而让一些事情变慢。）现有的界面应该继续工作并且用户界面应该是可识别的。

3.  版本编号进一步取决于编写软件的人 - Oracle 使用五个（！）组，即。Oracle 版本类似于 10.1.3.0.5。从第三组开始，您应该只引入错误修复或功能上的微小更改。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2008-09-15T19:14:54.997

对于major.minor，变化较小的是前两个，之后它可以是从构建、修订、发布到任何自定义算法（如在某些MS产品中）的任何东西

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2008-09-15T19:26:53.203

每个组织/团体都有自己的标准。重要的是你要坚持你选择的任何符号，否则你的客户会感到困惑。话虽如此，我通常使用 3 个数字：

x.yz.bbbbb。其中： x：是主要版本（主要的新功能） y：是次要版本号（小的新功能，没有 UI 更改的小改进） z：是服务包（与 xy 基本相同，但有一些错误修复 bbbb：是内部版本号，只有在“关于框”中才能真正看到，还有其他详细信息供客户支持。bbbb 是免费格式，每个产品都可以使用它自己的。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2008-09-15T19:48:46.413

这是我们使用的：

1.  第一个数字 = 整个系统时代。每隔几年就会发生变化，通常代表技术或客户端功能或两者的根本变化。
2.  第二个数字 = 数据库模式修订。此数字的增加需要数据库迁移，因此需要进行重大更改（或系统复制，因此更改数据库结构需要仔细升级过程）。如果第一个数字更改，则重置为 0。
3.  第三个数字 = 仅软件更改。这通常可以在一个客户端一个客户端的基础上实现，因为数据库模式是不变的。如果第二个数字发生变化，则重置为零。
4.  颠覆版本号。我们使用 TortoiseSVN 工具在构建时自动填充它。这个数字永远不会重置，而是不断增加。使用它，我们总是可以重新创建任何版本。

这个系统很好地为我们服务，因为每个数字都有一个明确而重要的功能。我看到其他团队正在努力解决主要数字/次要数字的问题（主要的变化有多大），我看不到这样做的好处。如果您不需要跟踪数据库修订，只需转到 3 或 2 位版本号，让生活更轻松！

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2020-06-26T08:50:00.373

版本：v1.9.0.1

在哪里-

. v 是版本的缩写。它因公司而异，取决于其组织中采用的命名法。在像 1.9.0.1 这样的组织中它可能会保持沉默

. 1 表示主要版本，将在应用程序堆栈、基础设施（平台）或暴露的网络接口中的架构修改时更新

. 9 incates 次要，将更新活动，如添加新组件，如 ui、api、数据库等；在特定架构下

. 0 表示功能，将在现有组件（ui、api、数据库等）的任何增强上进行更新

. 1 表示跨所有主要阶段、次要阶段和特征的构建计数器。它还包括发布后的修补程序。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2022-02-22T17:17:35.263

尽管前面的大多数答案都很好地解释了如何使用版本编号，但还有另一种方案，我称之为*营销版本方案*。我将其添加为答案，因为它存在，而不是因为我认为值得关注。

在*营销版本方案*中，所有那些技术思想和意义都被**更大更好**所取代。产品的版本号来源于两个规则：

*   较大（较高）的数字优于较小（较低）的数字
*   我们的版本号应该大于（高于）任何竞争对手的版本号

这将版本编号从技术人员手中转移到它所属的地方（销售和营销）。

然而，由于技术版本在某种程度上仍然有意义，营销版本通常伴随着技术版本号。它们通常以某种方式隐藏，但可以通过一些*信息*或*对话*来揭示。

# c++ - VC++中未初始化的内存块

> ID：65724
> 
> 赞同：6
> 
> 时间：2008-09-15T19:02:36.477
> 
> 标签：c++, memory, allocation

众所周知，[Visual C++](http://en.wikipedia.org/wiki/Visual_C%2B%2B)运行时用特殊的非零标记标记未初始化或刚刚释放的内存块。有没有办法完全禁用此行为而无需手动将所有未初始化的内存设置为零？它对我的有效非空检查造成了严重破坏，因为`0xFEEEFEEE != 0`.

嗯，也许我应该解释得更好一点。我创建并初始化一个变量（通过new），一切都很好。当我释放它（通过删除）时，它会将指针设置为`0xFEEEFEEE`而不是`NULL`. 当我插入适当的检查时`NULL`，就像所有管理自己内存的好程序都应该做的那样，我会遇到问题，因为`0xFEEEFEEE`检查`NULL`没有问题。除了在删除它们时手动设置所有指针之外，还有什么好方法`NULL`可以检测内存何时已被释放？我宁愿不使用[Boost](http://en.wikipedia.org/wiki/Boost_C%2B%2B_Libraries)仅仅是因为我不想要开销，尽管它可能很小，因为这是我使用 Boost 的唯一目的。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-15T19:05:17.623

创建指针时，将其显式初始化为`NULL`. 同样在`delete`. 取决于未初始化数据的值（除了在少数特定情况下）是自找麻烦。

通过使用智能指针类（例如 ），您可以省去很多麻烦，[`boost::shared_ptr`](http://www.boost.org/doc/libs/1_38_0/libs/smart_ptr/shared_ptr.htm)它会自动处理指针是否已初始化。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-15T19:08:39.270

VC++ 的行为不应该对您可以执行的任何**有效检查造成严重破坏。**如果您看到 0xfeeefeee，那么您还没有写入内存（或已释放它），所以无论如何您都不应该从内存中读取。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-15T19:10:06.787

如果您正在读取未初始化的内存，那么您的检查肯定不是“有效的”。内存被释放。它可能已经用于其他用途。您不能对 C/C++ 中未初始化内存的内容做出任何假设。

Java（和 C#，我相信）将保证分配的内存在使用前清零，当然垃圾收集会阻止您看到已释放的内存。但这不是 C 堆的属性，它直接暴露内存。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-15T19:37:08.797

将`delete`所有指向对象的指针重置为`NULL`. 此外，您不应更改 Windows DEBUG 运行时的默认内存填充，并且您应该`boost::shared_ptr<>`以任何方式使用指针之类的东西。

也就是说，如果你真的想**在脚上开枪，**你可以。

您可以使用这样的分配器挂钩来**更改**Windows **DEBUG 运行时**的**默认填充。**这仅适用于 HEAP 分配的对象！

 **```
int main(int argc,char** arv)
{
  // Call first to register hook    
  _CrtSetAllocHook(&zero_fill);
  // Do other stuff
  malloc(100);
}

int zero_fill(int nAllocType, 
              void* pvData, 
              size_t nSize,
              int nBlockUse, 
              long lRequest, 
              const unsigned char *szFileName, 
              int nLine )
{
  /// Very Importaint !! 
  /// infinite recursion if this is removed !!
  /// _CRT_BLOCK must not do any thing but return TRUE
  /// even calling printf in the _CRT_BLOCK will cause
  /// infinite recursion
  if ( nBlockUse == _CRT_BLOCK )
    return( TRUE );
  switch(nAllocType)
  {
  case _HOOK_ALLOC:
  case _HOOK_REALLOC:
    // zero initialize the allocated space.
    memset(pvData,0,nSize);
    break;
  case _HOOK_FREE:
    break;
  }
  return TRUE;
} 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-15T19:09:06.787

如果您在 Release 模式而不是 Debug 模式下构建，则运行时根本不会填充未初始化的内存，但它仍然不会为零。但是，您不应该**依赖**这种行为 - 您应该使用 memset()、ZeroMemory() 或 SecureZeroMemory() 自己显式初始化内存，或者在某处设置一个标志，指示内存尚未初始化。读取未初始化的内存将导致未定义的行为。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-16T15:51:15.960

你说：

> 我创建并初始化一个变量（通过new），一切都很好。当我释放它（通过删除）时，它会将指针设置为 0xFEEEFEEE 而不是 NULL。当我插入对 NULL 的正确检查时，就像所有管理自己内存的好程序都应该那样，我遇到了问题，因为 0xFEEEFEEE 通过了 NULL 检查而没有问题。

即使是 MSVC 的调试堆例程也不会改变你要删除的**指针**的值——你要删除的指针的值不会改变（甚至是 NULL）。听起来您正在访问一个属于您刚刚删除的对象的指针，这是一个简单明了的错误。

我很确定您尝试做的只是掩盖无效的内存访问。您应该发布一段代码，向我们展示真正发生的事情。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-16T03:16:12.017

这实际上是 VC++（我相信其他编译器）中的一个非常好的特性，因为它允许您在调试器中查看指针的未分配内存。在禁用该功能之前，我会三思而后行。当您在 C++ 中删除一个对象时，您应该将指针设置为`NULL`以防万一以后尝试再次删除该对象。此功能可让您找出忘记将指针指向的位置`NULL`。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-16T22:07:53.590

@杰夫哈伯德（[评论](https://stackoverflow.com/questions/65724/uninitialized-memory-blocks-in-vc/66036#66036)）：

> 这实际上无意中为我提供了我想要的解决方案：我可以在 _HOOK_FREE 上将 pvData 设置为 NULL，并且不会遇到指针地址的 0xFEEEFEEE 问题。

如果这对您有用，那么这意味着您在测试 NULL 指针时正在读取已释放的内存（即，指针本身驻留在您释放的内存中）。

这是一个错误。

您使用的“解决方案”只是隐藏而不是修复错误。当释放的内存被分配给其他东西时，突然间你会使用错误的值作为指向错误东西的指针。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-09-17T03:15:54.270

如果它在释放模式下工作，那是因为剪切运气。

Mike B 认为调试修复隐藏了一个错误是正确的。在释放模式下，正在使用的指针已被释放但未设置为`NULL`，并且它指向的内存仍然“有效”。在未来的某个时刻，内存分配会发生变化，或者内存映像会发生变化，或者某些事情会导致“有效”内存块变为“无效”。那时，您的发布版本将开始失败。切换到调试模式来查找问题是没有用的，因为调试模式已经“修复”了。

我想我们都同意以下代码不应该工作。

```
char * p = new char[16];     // 16 bytes of random trash
strcpy(p, "StackOverflow");  // 13 characters, a '\0' terminator, and two bytes of trash
delete [] p;                 // return 16 bytes to the heap, but nothing else changes;

if (p != NULL)               // Why would p be NULL?  It was never set to NULL
    ASSERT(p[0] == 'S');     // In debug, this will crash, because p = 0xfeeefeee and 
                             // dereferencing it will cause an error.
                             // Release mode may or may or may not work, depending on
                             // other memory operations 
```

正如几乎所有其他发帖人所说，指针应该设置为`NULL`after 调用`delete`。无论您是自己做还是使用 boost 或其他一些包装器，甚至这个线程中的宏都取决于您。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-12-06T16:41:34.240

> 发生的事情是我的代码在调试编译下崩溃，但在发布编译下成功。

发布版本将在客户的机器上崩溃。它总是这样。

> 我已经在调试器下检查了它，并且在我对它们调用 delete 后，我的指针被设置为 0xFEEEFEEE。

*调用 delete 后，指针*不会更改。他们指向的内存被设置为 0xfeeefeee, 0xfeeefeee, ..., 0xfeeefeee。

如果你发现你的程序从释放的内存中读取数据（这在 DEBUG 构建中由 0xfeeefeee 模式方便地指示），那么你就有一个错误。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-17T02:05:37.667

@[杰夫哈伯德]：

> 发生的事情是我的代码在调试编译下崩溃，但在发布编译下成功。`0xFEEEFEEE`我已经在调试器下检查了它，并且在我对它们调用 delete 之后，我的指针被设置为。同样，发布时的相同代码不会崩溃并且按预期运行。

这是一种非常奇怪的行为——我仍然相信`_CrtSetAllocHook()`解决方法可能隐藏了一个潜在的错误。

OS 堆管理器使用`0xFEEEFEEE`签名来指示释放的内存（请参阅[http://www.nobugs.org/developer/win32/debug_crt_heap.html](http://www.nobugs.org/developer/win32/debug_crt_heap.html)）。您是否可以发布一些重现代码并准确指出您正在使用的编译器版本？

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-15T19:07:39.723

我很确定您不能在此处禁用 Visual Studio 默认值，即使您这样做了，该值也将是分配内存之前内存中的任何值。

最好的办法是养成一开始就将它们设置为 0 的习惯，这只是额外的 2 个字符。

```
int *ptr=0; 
```

您还可以使用定义为 0 的 NULL 宏（但不是默认值，因此在包含 windows.h 之类的内容并自行定义时，请注意多个定义！

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-15T22:53:19.683

如果您使用的是 malloc，它不会将内存初始化为任何内容。你得到什么。如果您想分配一个块并将其初始化为 0，请使用“calloc”，它与 malloc 类似，仅用于初始化（如果您想模拟 malloc，则将其设置为 1 的元素大小参数）。你应该在使用 calloc 之前阅读它，因为它有一些细微的差别。

[http://wiki.answers.com/Q/What_is_the_difference_between_malloc_and_calloc_functions](http://wiki.answers.com/Q/What_is_the_difference_between_malloc_and_calloc_functions)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-16T03:38:53.927

为什么不创建自己的#define 并养成使用它的习惯呢？

IE

```
#define SafeDelete(mem) { delete mem; mem = NULL; }
#define SafeDeleteArray(mem) { delete [] mem; mem = NULL; }
```

显然，您可以随意命名它。deleteZ，deletesafe，随便你。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-09-23T19:58:59.190

您也可以创建一个内存管理器。然后，您可以覆盖 new 和 delete 以从/放回预分配的内存块。

# xss - 如何安全地使用 fckEditor，没有跨站脚本的风险？

> ID：65734
> 
> 赞同：3
> 
> 时间：2008-09-15T19:03:23.213
> 
> 标签：xss, fckeditor

此链接描述了使用 fckEditor 对我的应用程序的利用：http: [//knitinr.blogspot.com/2008/07/script-exploit-via-fckeditor.html](http://knitinr.blogspot.com/2008/07/script-exploit-via-fckeditor.html)

如何在仍然使用 fckEditor 的同时确保我的应用程序安全？它是 fckEditor 配置吗？从 fckEditor 获取文本后，我应该在服务器端进行一些处理吗？

这是一个难题，因为 fckEditor*使用*html 标签进行格式化，所以当我显示文本时不能只进行 HTML 编码。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-15T19:11:08.827

清理 html 服务器端，别无选择。对于 PHP，它将是[HTML Purifier](http://htmlpurifier.org)，对于 .NET，我不知道。清理 HTML 很棘手 - 去除脚本标签是不够的，您还必须注意 on* 事件处理程序，甚至更多，这要归功于 IE 的愚蠢。

此外，使用自定义 html 和 css 很容易劫持您网站的外观和布局 - 使用覆盖所有屏幕的覆盖（绝对定位）等。为此做好准备。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-15T19:10:15.273

该错误实际上不是 FCKeditors 的错误。只要您让用户编辑将在您的网站上显示的 HTML，除非您在输出数据之前检查数据，否则他们总是有可能造成伤害。

有些人使用 HTMLencoding 来执行此操作，但这会破坏 FCKeditor 完成的所有格式，而不是您想要的。

* * *

也许您可以使用[Microsoft Anti-Cross Site Scripting Library](http://msdn.microsoft.com/en-us/library/aa973813.aspx)。[MSDN](http://msdn.microsoft.com/en-us/library/aa973813.aspx)上的示例

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-15T19:14:49.940

> 从 fckEditor 获取文本后，我应该在服务器端进行一些处理吗？

恰恰。StackOverflow 也有一些与此相关的早期问题。解决它的最简单方法是使用 HTML 库来解析用户的输入，然后转义输出中不需要的任何标签。在打印到页面时将其作为后处理步骤执行 - 数据库中的数据应该与用户输入的数据完全相同。

例如，如果用户输入`<b><script>evil here</script></b>`，您的代码将`<b>&lt;script&gt;evil here&lt;/script&gt;</b>`在呈现页面之前将其转换为。

并且**不要**使用正则表达式来解决这个问题，这只是邀请聪明的人再次打破它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-29T17:52:24.740

FCKEditor 可以配置为仅使用几个标签。除了那几个标签之外，您将需要对所有内容进行编码。

这些标签是：<strong> <em> <u> <ol> <ul> <li> <p> <blockquote> <font> <span>。

字体标签只应该有 face 和 size 属性。span 标签应该只有一个类属性。

这些标签不应有其他属性。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T19:22:19.050

> 我了解不要。我缺少一个 DO。

是否需要使用 FCKEditor，或者您可以使用不同的编辑器/标记语言？我建议使用 Markdown 和 WMD 编辑器，StackOverflow 使用的语言相同。.NET 的 Markdown 库应该有一个转义所有 HTML 标记的选项——一定要打开它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-28T01:56:13.473

XSS 是一件棘手的事情。我建议阅读：

*   [HTML 是一种人性化的标记语言吗？](http://www.codinghorror.com/blog/archives/001116.html)
*   [安全的 HTML 和 XSS](https://blog.stackoverflow.com/2008/06/safe-html-and-xss/)

无论如何，我的总结是，归根结底，您必须只允许严格接受的项目；您不能拒绝已知的漏洞利用向量，否则您将永远支持永恒的斗争。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-01-22T23:41:49.017

我认为有些人提出的问题不是 Fckeditor 只编码了几个标签。这是一个天真的假设，即邪恶的用户会使用 Fckeditor 来写他的恶意。允许手动更改输入的工具有很多。

我将所有用户数据视为已污染；并使用 Markdown 将文本转换为 HTML。它会清理文本中的任何 HTML，从而减少恶意。

# c# - .NET 框架的部署率是多少？

> ID：65749
> 
> 赞同：3
> 
> 时间：2008-09-15T19:04:37.453
> 
> 标签：c#, .net, deployment, statistics

我一直在为我的商业桌面产品寻找此信息，但无济于事。

具体来说，我正在寻找的是面向最终用户的 .NET 框架的部署统计信息（包括奶奶“我只是在浏览互联网”XP 和高端用户，如果可能的话），以及商业/商业部门。

编辑：除了下面的数据点，这里有一篇关于 .NET[部署率](http://www.nbdtech.com/blog/archive/2009/05/25/what-percentage-of-users-have-the-.net-framework-installed-and.aspx)的有趣博文。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-15T19:12:33.690

我在[Scott Wiltamuth 的博客上](http://blogs.msdn.com/scottwil/archive/2005/03/09/391199.aspx)找到了 2005 年的一些统计数据（你可以肯定这些数字现在要高得多）：

*   已使用 Microsoft 下载或 Windows 更新下载并安装了超过 1.2 亿份 .NET Framework
*   2004 年销售的新消费 PC 中超过 85% 安装了 .NET Framework
*   超过 58% 的商用 PC 预装或预装了 .NET Framework
*   每台新的 HP 消费类成像设备（打印机/扫描仪/相机）都将安装 .NET Framework（如果尚未安装）——每年 300 万台
*   每张新的 Microsoft IntelliPoint 鼠标软件 CD 都附带 .NET Framework

还值得指出的是，Vista 和 Windows Server 2008 都带有 .NET Framework。XP 通过 Windows Update 获得它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T19:06:35.797

我没有任何确切的数字，但这些天来，假设大多数 Windows XP 和 Vista 用户至少拥有 .NET 2.0 是相当安全的。我相信这实际上是通过 Windows Update for XP 删除的，Vista 至少附带 2.0（显然是 3.0，正如对此答案的评论中指出的那样）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T19:07:55.450

这在很大程度上取决于您所针对的框架版本。我相信 1.1（甚至 2.0）被广泛部署。后面的版本不是。

您还应该访问此站点以获取有关 .Net Framework 部署的一些非常好的信息：[http ://www.hanselman.com/smallestdotnet/](http://www.hanselman.com/smallestdotnet/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T19:20:31.283

我在上一份工作中也需要同样的信息，当时我试图说服我的经理允许 .NET 开发。客户群主要是拨号用户，因此需要 20+ MB 的下载量是一项艰难的销售。不幸的是，我无法从微软或研究公司找到任何类型的统计数据。

然而，我能够得到的是来自公司主页的网络分析。.NET 将其版本号插入到用户代理字段中，我可以使用我们的分析包记录该字段。从那里，一些 Excel 工作能够让我大致了解有多少客户已经安装了 .NET，以及哪些版本。

不幸的是，这不会帮助您回答跨多个人口统计的更广泛的部署率问题，但它对于单个客户群可能是一种有用的技术。

# asp.net - Web 开发人员可以使用的最好的 HTML WYSISYG 编辑器是什么？为什么？

> ID：65800
> 
> 赞同：13
> 
> 时间：2008-09-15T19:10:13.790
> 
> 标签：asp.net, javascript, html, editor, wysiwyg

从 javascript 到 ASP.Net Web 控件，有许多不同风格的 HTML WYSIWYG 编辑器，但功能通常是相同的。有没有人喜欢在项目中使用的最喜欢的 HTML 编辑器？为什么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-15T19:16:25.257

由于以下原因，我偏爱 TinyMCE WYSIWYG 编辑器：

1.  Javascript - 因此无论我在哪个平台上工作，它都可以广泛使用。

2.  易于使用 - 只需几行代码和一个文本区域，控件即可启动并运行。

3.  轻松主题 - 所以我可以快速让它看起来像正在使用它的网站

4.  最重要的是 - 根据我的应用程序需求轻松定制以显示/隐藏特定按钮

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-15T19:16:02.683

FCKeditor，可在[http://www.fckeditor.net/](http://www.fckeditor.net/)获得，非常棒，因为它与包括 Safari 在内的所有主要浏览器兼容。大多数 HTML 富文本编辑器不支持 Safari。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-15T19:34:27.977

我在我的 ASP.Net 应用程序中使用[FCKEditor运气不错。](http://www.fckeditor.net/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-15T22:19:34.897

TinyMCE 很棒，因为它很容易定制和编写插件。

它也已经存在了一段时间，因此有大量的资源和帮助可供使用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-15T19:18:27.157

如果您正在寻找放置在网站上的所见即所得编辑器，我喜欢[TinyMCE](http://tinymce.moxiecode.com/)。免费获得体面的社区支持。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-15T19:20:46.323

如果您谈论的是编辑组件（与 DreamWeaver 等独立应用程序相反），我使用过 CuteEditor、TinyMCE、FCKEditor、eWebEditPro 和 Telerik 的 RAD 编辑器。他们都有自己的优点和缺点，你必须习惯他们看待世界的方式。他们吐出的 HTML 差异很大，我发现我经常需要调整结果。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-15T20:03:57.577

到目前为止，TinyMCE。它完成了 FCKeditor 所做的一切，甚至更多。客户从 MS Word 粘贴内容时遇到问题，FCK 解析时遇到问题，而且我们的文本有问题。我部门的目标之一是将我们的 CMS 迁移到 TinyMCE。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-15T22:17:26.990

我在我的项目中使用 TinyMCE。很久以前我做了我的研究，但我仍然很高兴：

*   更好地过滤 MS Word HTML
*   文件少于 FCKe :)
*   有一个免费改编的 FCKe 插件，用于高级文件和图像处理，tinymcpuk

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-15T19:21:54.510

我强烈推荐 HTML Kit [http://www.chami.com/html-kit/](http://www.chami.com/html-kit/)，它不仅有免费版本，而且有许多模块可以让 HTML 标记更容易。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-15T19:50:32.587

我总是使用 FCKEditor，即使 tinymce 也具有与 fcke 几乎相同的功能。您可以像普通的 TextBox 一样使用拖放，并且编辑配置文件和添加/删除功能非常容易。
此外，对于 fcke 和 tinymce，您必须购买图像缩略图浏览器，在免费版本中，您只有文件名列表。我认为这两个编辑器之间没有太大区别，它们可能是市场上最好的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-15T19:52:59.663

[Spaw 看起来](http://www.solmetra.com/en/disp.php/en_products/en_spaw/en_spaw_about)不错，而且易于使用。迄今为止，我们已经在多个项目中使用了它。

* * *

## 回答 #12

> 赞同：-6
> 
> 时间：2008-09-15T19:12:49.947

这完全取决于您使用它的目的。

例如，我使用 VS2008 进行 ASP.NET 编码，使用 Notepad++ 查看 HTML 源代码。这完全取决于您对编辑器的最终用途。例如，如果您所做的只是修改 CSS 文件，那么您将不会关心它如何提供体面的 PHP 开发体验。

* * *

## 回答 #13

> 赞同：-6
> 
> 时间：2008-09-15T19:14:54.823

Adobe Dreamweaver。它将让您在视觉上或在代码中工作并在它们之间切换。此类工具的杀手级标准是，当您以可视方式构建时，它可以构建良好、干净的代码，而 Dreamweaver 就是这样做的。

# design-patterns - 具有多个值的实体的最佳设计

> ID：65805
> 
> 赞同：4
> 
> 时间：2008-09-15T19:11:00.793
> 
> 标签：design-patterns, database-design

假设您有一个实体，例如您正在捕获其详细信息的车辆。您要捕捉的汽车被涂成红色、黑色和白色。前轮胎为普利司通 275/35-18，后轮胎为 325/30-19。有时您可能只有两个轮胎（是的，这将被视为摩托车，这是一种车辆），有时可能只有 18 个轮胎。然后有一些字段总是单值的，比如引擎大小（如果我们让我们的想象力疯狂，我们可以想到多引擎车辆，但我试图保持简单）。

我们目前处理这个问题的策略是为每个可以有多个值的字段创建一个表。这将产生大量的表（我们有一堆不同的实体有这个要求）并且闻起来有点难闻。这是最好的策略吗？如果不是，什么会更好？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-15T19:13:35.093

如果您的应用有可能，您可能需要查看[couchdb](http://incubator.apache.org/couchdb/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T19:37:40.620

如果您使用的是关系数据库，那么您的建议几乎是唯一的方法。[范式理论](http://en.wikipedia.org/wiki/Database_normalization)会给你更多关于它的信息——关于它的维基百科文章非常好，虽然有点沉重，因为当你进入更高的规范化水平时，它是一个棘手的理论主题。不过，这些例子大多是常识。

假设您有一个 Vehicle 表、一个 Color 表和一个 TyreType 表（对不起英国拼写），您大概定义了一个 VehicleTyre 和 VehicleColour 表，它充当相关表对之间的连接。这种结构实际上是相当健康的。它不仅直接封装了您想要的信息，还可以让您以自然的方式捕捉诸如哪个轮胎是哪个轮胎（例如左前是普利司通 275/35-18）或汽车有多少被涂成红色（例如VehicleColour 表中的百分比字段）。

您可能想要对可以控制轮胎数量的车辆类型实体进行建模。虽然这对于从系统中获取有效的 SELECT 查询不是必需的，但它可能在您的用户界面和确定要插入表中的轮胎数量方面都很有用。

我的公司有很多正是在这个基础上运行的模式——事实上，我们的对象关系框架会自动创建它们来管理多对多关系（有时甚至是一对多关系，具体取决于我们对它们的建模方式）。我们的几个应用程序有 150 多个实体和 100 多个这样的连接表。没有性能问题，也没有对数据的可管理性产生有意义的影响，除了一些表名长得令人讨厌。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T19:15:02.123

您正在描述[Star Schema](http://en.wikipedia.org/wiki/Star_schema)。我认为在您的情况下这是相当标准的做法

编辑：实际上你的模式是从星模式稍微修改的，你使用每个维度表中事实表的主键来加入，所以你可以有多种油漆颜色等。无论哪种方式，我认为这是一个很好的处理方式与您的实体。您可以更进一步并规范化维度表，然后您将拥有一个[雪花模式](http://en.wikipedia.org/wiki/Snowflake_schema)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T19:16:08.253

看起来您可能正在查看称为[Hierarchical Model](http://en.wikipedia.org/wiki/Hierarchical_model)的东西。

或者也许一个简单的 (attr, value) 对列表就可以了？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T19:22:35.103

如果您使用的是 SQL Server，请不要害怕存储[XML 数据类型](http://davidhayden.com/blog/dave/archive/2006/04/11/2909.aspx)。我发现它使这样的事情变得容易得多。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-15T19:24:16.080

这实际上取决于变量本身是否只有一个变量（例如：您可以拥有可变数量的相同类型的轮胎，或者具有可变类型的固定数量的轮胎）。

由于您似乎需要有多个变量（例如，每个轮胎的特定类型，轮胎数量可变），恐怕最好的解决方案是为您希望定制的汽车的每个特定区域提供特定的表格。

如果您有一些字段只有一组值可供选择（例如，2、4 或 6 个窗口），您可以简单地使用枚举或使用用户定义的域定义新的字段类型（取决于您使用的 DBMS '正在使用）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T21:37:38.810

您当前的策略是正确的。您正在跟踪如此多类型的数据，因此您将需要大量表。就是这样。DBMS 在抱怨吗？

# snmp - 使用 SNMP 跨不同型号设备查询数据的 Cisco IOS OID 的稳定性如何？

> ID：65809
> 
> 赞同：1
> 
> 时间：2008-09-15T19:11:11.853
> 
> 标签：snmp, oid, cisco-ios

我正在使用 SNMP 从 cisco 交换机查询一堆信息。例如，我通过在 .1.3.6.1.4.1.9.9.23 上执行 snmpwalk 来获取有关使用 CDP 检测到的邻居的信息

我可以在不同的 cisco 型号中使用此 OID 吗？我应该注意哪些陷阱？对我来说，我对使用数字 OID 有点不安 - 似乎我应该使用 MIB 数据库或其他东西并使用命名 OID，以获得跨设备兼容性，但也许我只是在想象需要为了那个原因。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-15T19:19:52.673

这是非常一致的。

监控工具依赖于一致性，Cicso 生产的 MIB 很少更改旧值，通常只实施新值。

查看 Cisco [OID 查找工具](http://tools.cisco.com/Support/SNMP/do/BrowseOID.do?local=en&translate=Translate&objectInput=1.3.6.1.4.1.9.9.23)。

请注意，它不会询问您查找的产品是什么。

-MW

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-15T19:19:57.760

一旦 MIB 发布，它就不会移动到新的 OID。这样做会破坏网络管理工具并引起没人想要的支持电话。继续您的示例，CDP MIB 已在 Cisco 的[SNMP Object Navigator 上发布。](http://tools.cisco.com/Support/SNMP/do/BrowseMIB.do?local=en&step=2&mibName=CISCO-CDP-MIB)

对于一般的代码清洁度，最好在一个中心位置定义 OID，特别是因为您不想为需要访问的每个表复制完整的 OID。

您需要最小心的地方是思科最近收购的产品中的独特 MIB。OID 将发生变化，如果没有其他方法将其移动到他们自己的企业 OID 空间中，但 MIB 也可能会发生变化以符合 Cisco 的 SNMP 实践。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-06T17:32:09.077

OID 可以随硬件而变化，但也可以随相同硬件的固件版本而变化，因为随着时间的推移，管理功能的架构可能会发生变化并需要新的 MIB。值得检查您打算使用的任何 OID 是否在已弃用的 MIB 中，或者在应用程序的生命周期中变得如此，因为这不仅表明 MIB 有朝一日可能不受支持，而且可能会得到改进，更丰富的数据或访问数据。在广泛部署之前，作为固件更新常规测试的一部分，针对示例升级设备测试管理应用程序也是一种很好的做法。

由于 MIB 被弃用而导致 OID 更改的示例位于

[http://www.cisco.com/en/US/tech/tk648/tk362/technologies_configuration_example09186a0080094aa6.shtml](http://www.cisco.com/en/US/tech/tk648/tk362/technologies_configuration_example09186a0080094aa6.shtml)

> “本文档展示了如何使用 CISCO-CONFIG-COPY-MIB 将配置文件复制到思科设备或从思科设备复制。如果您从思科 IOS® 软件版本 12.0 开始，或者在某些设备上早于版本 11.2P，思科已经使用新的 CISCO-CONFIG-COPY-MIB 实现了一种新的简单网络管理协议 (SNMP) 配置管理方法。此 MIB 取代了 OLD-CISCO-SYSTEM-MIB 中已弃用的配置部分。"

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T14:49:01.193

*   我会避免输入数字 OID，而是使用“OID 名称”，并将繁重的工作（翻译）留给您正在使用的任何 SNMP API。

如果这不可能，那么可以使用 OID，因为它们不应根据 SNMP MIB 指南进行更改。除非设备本身发生变化，但无论如何都需要一个不能重用旧 OID 的新 MIB。

*   这很明显，但请务必查看 SNMP MIB 变量的属性。确保不要查询状态为“过时”的变量。

杰..

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-19T18:05:52.577

在某些情况下，使用名称而不是数字表示可能会严重影响性能，因为需要读取和解析 MIB 文件以获取较低级别库所需的 OID 的数字表示。

例如，假设您使用一个程序每分钟收集一些东西，然后一遍又一遍地加载 MIB 是非常低效的。

正如其他人所说，一旦发布，数字映射的名称将永远不会改变，因此您将内容硬编码到程序中这一事实并不是真正的问题。

如果您可以访问命令行 SNMP 工具，请查看“ [snmptranslate](http://www.net-snmp.org/docs/man/snmptranslate.html) ”，以获得从文本到数字 OID 来回转换的好工具。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-19T19:02:38.087

我认为这是一个常见的误解（关于每次解析名称时都会重新加载 MIB）。

大多数 SNMP API（例如 AdventNet、CMU）在启动时加载 MIBS，之后每次您请求从名称到 oid 的“转换”时都没有加载 MIB 的“开销”，反之亦然。更重要的是，其中一些缓存了结果，此时，名称查找和直接编码 OID 之间没有区别。

这有点类似于指定“IP 地址”与“主机名”。

# c - 单元测试 C 代码

> ID：65820
> 
> 赞同：917
> 
> 时间：2008-09-15T19:12:00.383
> 
> 标签：c, unit-testing, testing, embedded

今年夏天我研究了一个用纯 C 语言编写的嵌入式系统。这是我工作的公司接管的一个现有项目。我已经非常习惯于使用 JUnit 在 Java 中编写单元测试，但是对于为现有代码（需要重构）以及添加到系统中的新代码编写单元测试的最佳方法感到茫然。

是否有任何项目可以使单元测试纯 C 代码像使用 JUnit 单元测试 Java 代码一样简单？任何特别适用于嵌入式开发（交叉编译到 arm-linux 平台）的见解将不胜感激。

* * *

## 回答 #1

> 赞同：537
> 
> 时间：2008-09-15T19:14:36.837

C 中的一个单元测试框架是[Check](https://libcheck.github.io/check/)；可以在[此处](http://check.sourceforge.net/doc/check_html/check_2.html#SEC3)找到 C 中的单元测试框架列表，并在下面复制。根据您的运行时有多少标准库函数，您可能会或不能使用其中之一。

> ### 王牌单位
> 
> AceUnit（高级 C 和嵌入式单元）自称是一个舒适的 C 代码单元测试框架。它试图模仿 JUnit 4.x 并包含类似反射的功能。AceUnit 可用于资源受限的环境，例如嵌入式软件开发，重要的是它在不能包含单个标准头文件并且不能从 ANSI/ISO C 库调用单个标准 C 函数的环境中运行良好。它还有一个 Windows 端口。它不使用分叉来捕获信号，尽管作者表示有兴趣添加这样的功能。请参阅[AceUnit 主页](http://aceunit.sourceforge.net/)。
> 
> ### GNU 自动单元
> 
> 与 Check 大同小异，包括分叉在单独的地址空间中运行单元测试（事实上，Check 的原作者借鉴了 GNU Autounit 的想法）。GNU Autounit 广泛使用 GLib，这意味着链接等需要特殊选项，但这对您来说可能不是什么大问题，特别是如果您已经在使用 GTK 或 GLib。请参阅[GNU Autounit 主页](http://autounit.tigris.org/)。
> 
> ### cUnit
> 
> 也使用 GLib，但不分叉以保护单元测试的地址空间。
> 
> ### 单元
> 
> 标准 C，计划实现 Win32 GUI。当前不分叉或以其他方式保护单元测试的地址空间。在早期发展中。请参阅[CUnit 主页](http://cunit.sourceforge.net/)。
> 
> ### 酷测
> 
> 一个简单的框架，只有一个 .c 和一个 .h 文件，您可以放入源代码树。请参阅[CutTest 主页](http://cutest.sourceforge.net/)。
> 
> ### CppUnit
> 
> 首屈一指的 C++ 单元测试框架；您还可以使用它来测试 C 代码。它稳定，积极开发，并具有 GUI 界面。不使用 CppUnit for C 的主要原因首先是它很大，其次你必须用 C++ 编写测试，这意味着你需要一个 C++ 编译器。如果这些听起来不像问题，那么绝对值得考虑，以及其他 C++ 单元测试框架。请参阅[CppUnit 主页](http://cppunit.sourceforge.net/doc/cvs/index.html)。
> 
> ### embUnit
> 
> embUnit（Embedded Unit）是另一个嵌入式系统的单元测试框架。这个似乎已被 AceUnit 取代。[嵌入式单元主页](http://sourceforge.net/projects/embunit/)。
> 
> ### 最小单位
> 
> 一组最小的宏，就是这样！重点是展示对代码进行单元测试是多么容易。请参阅[MinUnit 主页](http://www.jera.com/techinfo/jtns/jtn002.html)。
> 
> ### 安藤先生的CUnit
> 
> 一个相当新的 CUnit 实现，显然仍处于早期开发阶段。请参阅[安藤先生主页的 CUnit](http://park.ruru.ne.jp/ando/work/CUnitForAndo/html/)。
> 
> *该列表最后一次更新是在 2008 年 3 月。*

## 更多框架：

### 西莫卡

CMocka 是一个支持模拟对象的 C 测试框架。它易于使用和设置。

请参阅[CMocka 主页](https://cmocka.org/)。

### 标准

Criterion 是一个跨平台的 C 单元测试框架，支持自动测试注册、参数化测试、理论，可以输出多种格式，包括 TAP 和 JUnit XML。每个测试都在自己的进程中运行，因此可以根据需要报告或测试信号和崩溃。

有关详细信息，请参阅[标准主页](https://github.com/Snaipe/Criterion)。

### 武汉理工大学

HWUT 是一个通用的单元测试工具，对 C 有很好的支持。它可以帮助创建 Makefile、生成以最小“迭代表”编码的大量测试用例、遍历状态机、生成 C-stub 等等。一般方法非常独特：判断基于“好标准输出/坏标准输出”。但是，比较功能是灵活的。因此，任何类型的脚本都可以用于检查。它可以应用于任何可以产生标准输出的语言。

请参阅[HWUT 主页](http://hwut.sourceforge.net/)。

### 绿

用于 C 和 C++ 的现代、可移植、跨语言单元测试和模拟框架。它提供了一个可选的 BDD 表示法、一个模拟库以及在单个进程中运行它的能力（使调试更容易）。可以使用自动发现测试功能的测试运行器。但是您可以通过编程方式创建自己的。

所有这些功能（以及更多）都在[CGreen 手册](https://cgreen-devs.github.io/)中进行了解释。

维基百科在单元测试框架列表下给出了 C 单元测试框架的详细列表[：C](https://en.wikipedia.org/wiki/List_of_unit_testing_frameworks#C)

* * *

## 回答 #2

> 赞同：178
> 
> 时间：2009-09-11T10:19:22.913

我个人喜欢[Google 测试框架](http://code.google.com/p/googletest/)。

测试 C 代码的真正困难是打破对外部模块的依赖关系，以便您可以将代码隔离在单元中。当您尝试围绕遗留代码进行测试时，这可能会特别成问题。在这种情况下，我经常发现自己使用链接器在测试中使用存根函数。

这就是人们在谈论“**接缝**”时所指的内容。在 C 中，您唯一的选择实际上是使用预处理器或链接器来模拟您的依赖项。

我的一个 C 项目中的典型测试套件可能如下所示：

```
#include "myimplementationfile.c"
#include <gtest/gtest.h>

// Mock out external dependency on mylogger.o
void Logger_log(...){}

TEST(FactorialTest, Zero) {
    EXPECT_EQ(1, Factorial(0));
} 
```

**请注意，您实际上是包含 C 文件而不是头文件**。这提供了访问所有静态数据成员的优势。在这里，我模拟了我的记录器（它可能在 logger.o 中并给出了一个空实现。这意味着测试文件独立于代码库的其余部分进行编译和链接，并独立执行。

至于交叉编译代码，要使其工作，您需要在目标上提供良好的设施。我已经使用 googletest 在 PowerPC 架构上交叉编译到 Linux 来完成此操作。这是有道理的，因为你有一个完整的外壳和操作系统来收集你的结果。对于不太丰富的环境（我将其归类为没有完整操作系统的任何环境），您应该只在主机上构建和运行。无论如何，您都应该这样做，这样您就可以在构建过程中自动运行测试。

我发现测试 C++ 代码通常要容易得多，因为 OO 代码通常比程序代码耦合少得多（当然这在很大程度上取决于编码风格）。同样在 C++ 中，您可以使用依赖注入和方法覆盖之类的技巧来将接缝连接到以其他方式封装的代码中。

Michael Feathers 有一[本关于测试遗留代码的优秀书籍](https://rads.stackoverflow.com/amzn/click/com/0131177052)。在其中一章中，他介绍了我强烈推荐的处理非 OO 代码的技术。

**编辑**：我写了[一篇](http://meekrosoft.wordpress.com/2009/11/09/unit-testing-c-code-with-the-googletest-framework/)关于单元测试程序代码的博客文章，[源代码在 GitHub 上可用](http://github.com/meekrosoft/helloc)。

**编辑**：[Pragmatic Programmers 出版了一本新书](http://pragprog.com/titles/jgade/test-driven-development-for-embedded-c)，专门解决了[我强烈推荐](http://meekrosoft.wordpress.com/2011/03/25/book-review-test-driven-development-for-embedded-c-beta/)的单元测试 C 代码。

* * *

## 回答 #3

> 赞同：143
> 
> 时间：2008-09-15T19:27:50.893

[Minunit](http://www.jera.com/techinfo/jtns/jtn002.html)是一个非常简单的单元测试框架。我正在使用它对 avr 的 c 微控制器代码进行单元测试。

* * *

## 回答 #4

> 赞同：46
> 
> 时间：2011-11-08T08:40:21.147

我说的和ratkok几乎一样，但如果你对单元测试有一个嵌入的扭曲，那么......

[Unity](http://www.throwtheswitch.org/unity/) - 强烈推荐用于单元测试 C 代码的框架。

```
#include <unity.h>

void test_true_should_be_true(void)
{
    TEST_ASSERT_TRUE(true);
}

int main(void)
{
    UNITY_BEGIN();
    RUN_TEST(test_true_should_be_true);
    return UNITY_END();
} 
```

该线程[TDD for Embedded C](http://pragprog.com/titles/jgade/test-driven-development-for-embedded-c)中提到的书中示例是使用 Unity（和 CppUTest）编写的。

* * *

## 回答 #5

> 赞同：43
> 
> 时间：2008-09-16T18:00:38.300

我目前正在使用 CuTest 单元测试框架：

[http://cutest.sourceforge.net/](http://cutest.sourceforge.net/)

它非常适合嵌入式系统，因为它非常轻巧且简单。我可以毫无问题地让它在目标平台和桌面上工作。除了编写单元测试之外，还需要：

*   无论您在何处调用 CutTest 例程，都包含一个头文件
*   要编译/链接到图像中的单个附加“C”文件
*   一些简单的代码添加到 main 以设置和调用单元测试 - 如果在构建期间定义了 UNITTEST，我只是将它放在一个特殊的 main() 函数中。

系统需要支持堆和一些 stdio 功能（并非所有嵌入式系统都有）。但是代码很简单，如果您的平台没有这些要求，您可能可以替代这些要求。

通过对 extern "C"{} 块的一些明智使用，它还支持很好地测试 C++。

* * *

## 回答 #6

> 赞同：37
> 
> 时间：2008-09-16T06:32:12.747

您可能还想看看[libtap](https://github.com/zorgnax/libtap)，这是一个 C 测试框架，它输出测试任何协议 (TAP)，因此可以很好地与针对该技术推出的各种工具集成。它主要用于动态语言世界，但它易于使用并且非常流行。

一个例子：

```
#include <tap.h>

int main () {
    plan(5);

    ok(3 == 3);
    is("fnord", "eek", "two different strings not that way?");
    ok(3 <= 8732, "%d <= %d", 3, 8732);
    like("fnord", "f(yes|no)r*[a-f]$");
    cmp_ok(3, ">=", 10);

    done_testing();
} 
```

* * *

## 回答 #7

> 赞同：27
> 
> 时间：2013-01-20T13:43:02.243

有一个优雅的 C 单元测试框架，支持名为[cmocka](http://cmocka.org/)的模拟对象。它只需要标准 C 库，适用于一系列计算平台（包括嵌入式）和不同的编译器。

它还支持不同的消息输出格式，如 Subunit、Test Anything Protocol 和 jUnit XML 报告。

cmocka 的创建也可以在嵌入式平台上工作，并且还支持 Windows。

一个简单的测试如下所示：

```
#include <stdarg.h>
#include <stddef.h>
#include <setjmp.h>
#include <cmocka.h>

/* A test case that does nothing and succeeds. */
static void null_test_success(void **state) {
    (void) state; /* unused */
}

int main(void) {
    const struct CMUnitTest tests[] = {
        cmocka_unit_test(null_test_success),
    };
    return cmocka_run_group_tests(tests, NULL, NULL);
} 
```

该[API](http://api.cmocka.org/)有完整的文档，并且有几个示例是源代码的一部分。

要开始使用 cmocka，您应该阅读 LWN.net 上的文章：[Unit testing with mock objects in C](https://lwn.net/Articles/558106/)

cmocka 1.0 已于 2015 年 2 月发布。

* * *

## 回答 #8

> 赞同：21
> 
> 时间：2010-07-22T13:03:58.620

在我开始寻找模拟函数的方法之前，我并没有对遗留的 C 应用程序进行太多测试。我非常需要模拟来将我想要测试的 C 文件与其他文件隔离开来。我给了 cmock 一个尝试，我想我会采用它。

Cmock 扫描头文件并根据它找到的原型生成模拟函数。Mocks 将允许您在完全隔离的情况下测试 C 文件。您所要做的就是将您的测试文件与模拟链接，而不是您的真实目标文件。

cmock 的另一个优点是它将验证传递给模拟函数的参数，并且它可以让您指定模拟应该提供的返回值。这对于测试函数中的不同执行流程非常有用。

测试由典型的 testA()、testB() 函数组成，您可以在其中构建期望、调用函数来测试和检查断言。

最后一步是为你的测试统一生成一个运行器。Cmock 与统一测试框架相关联。Unity 与任何其他单元测试框架一样易于学习。

非常值得一试并且很容易掌握：

[http://sourceforge.net/apps/trac/cmock/wiki](http://sourceforge.net/apps/trac/cmock/wiki)

**更新 1**

我正在研究的另一个框架是 Cmockery。

[http://code.google.com/p/cmockery/](http://code.google.com/p/cmockery/)

它是一个支持单元测试和模拟的纯 C 框架。它不依赖于 ruby​​（与 Cmock 相反），并且它对外部库的依赖很少。

它需要更多的手动工作来设置模拟，因为它不生成代码。这并不代表现有项目的大量工作，因为原型不会有太大变化：一旦你有了你的模拟，你暂时不需要改变它们（这是我的例子）。额外的类型提供了对模拟的完全控制。如果有你不喜欢的东西，你只需改变你的模拟。

不需要特殊的测试运行器。您只需要创建一个测试数组并将其传递给 run_tests 函数。这里也需要更多的手动工作，但我绝对喜欢自包含自治框架的想法。

此外，它还包含一些我不知道的漂亮 C 技巧。

总体而言，Cmockery 需要对 mock 有更多了解才能开始。示例应该可以帮助您克服这一点。看起来它可以用更简单的机制来完成这项工作。

* * *

## 回答 #9

> 赞同：18
> 
> 时间：2014-10-03T17:14:06.830

我们编写[CHEAT](http://users.jyu.fi/~sapekiis/cheat/)（托管在[GitHub 上](http://github.com/Tuplanolla/cheat)）是为了便于使用和移植。

它没有依赖关系，不需要安装或配置。只需要一个头文件和一个测试用例。

```
#include <cheat.h>

CHEAT_TEST(mathematics_still_work,
    cheat_assert(2 + 2 == 4);
    cheat_assert_not(2 + 2 == 5);
) 
```

测试编译成可执行文件，负责运行测试并报告其结果。

```
$ gcc -I . tests.c
$ ./a.out
..
---
2 successful of 2 run
SUCCESS 
```

它也有漂亮的颜色。

* * *

## 回答 #10

> 赞同：16
> 
> 时间：2011-10-08T23:10:25.873

作为一个 C 新手，我发现名为[**C 中测试驱动开发**](http://www.slideshare.net/amritayan/test-driven-development-in-c)的幻灯片非常有帮助。基本上，它使用标准`assert()`连同`&&`传递消息，没有任何外部依赖。如果有人习惯了全栈测试框架，这可能不会：)

* * *

## 回答 #11

> 赞同：12
> 
> 时间：2008-09-15T19:27:28.523

有[**CUnit**](http://cunit.sourceforge.net/)

[**Embedded Unit**](https://sourceforge.net/projects/embunit/)是嵌入式C系统的单元测试框架。它的设计是从 JUnit 和 CUnit 等中复制而来的，然后在某种程度上适应了嵌入式 C 系统。嵌入式单元不需要标准 C 库。所有对象都分配到 const 区域。

Tessy自动化[**了**](http://www.hitex.de/perm/tessy.htm)嵌入式软件的单元测试。

* * *

## 回答 #12

> 赞同：12
> 
> 时间：2008-09-16T13:54:28.893

我不使用框架，我只是使用自动工具“检查”目标支持。实现“主要”并使用断言。

我的测试目录 Makefile.am(s) 看起来像：

```
check_PROGRAMS = test_oe_amqp

test_oe_amqp_SOURCES = test_oe_amqp.c
test_oe_amqp_LDADD = -L$(top_builddir)/components/common -loecommon
test_oe_amqp_CFLAGS = -I$(top_srcdir)/components/common -static

TESTS = test_oe_amqp 
```

* * *

## 回答 #13

> 赞同：12
> 
> 时间：2009-09-11T19:21:05.457

Michael Feather 的书“Working Effectively with Legacy Code”介绍了许多特定于 C 开发期间单元测试的技术。

有一些与依赖注入相关的技术是特定于 C 的，我在其他任何地方都没有见过。

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2011-06-07T18:46:48.490

[CppUTest](http://www.cpputest.org/) - 强烈推荐的用于单元测试 C 代码的框架。

该线程[TDD for Embedded C](http://pragprog.com/titles/jgade/test-driven-development-for-embedded-c)中提到的书中示例是使用 CppUTest 编写的。

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2008-09-15T22:47:08.993

我将[CxxTest](http://cxxtest.tigris.org/)用于嵌入式 c/c++ 环境（主要是 C++）。

我更喜欢 CxxTest 因为它有一个 perl/python 脚本来构建测试运行器。经过一个小斜率来设置它（因为您不必编写测试运行器，所以更小），它非常易于使用（包括示例和有用的文档）。最多的工作是设置代码访问的“硬件”，以便我可以有效地进行单元/模块测试。之后很容易添加新的单元测试用例。

如前所述，它是一个 C/C++ 单元测试框架。所以你需要一个 C++ 编译器。

[CxxTest 用户指南](http://cxxtest.sourceforge.net/guide.html) [CxxTest Wiki](http://cxxtest.com/index.php?title=Main_Page)

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2008-09-15T19:14:53.623

谷歌有优秀的测试框架。[https://github.com/google/googletest/blob/master/googletest/docs/primer.md](https://github.com/google/googletest/blob/master/googletest/docs/primer.md)

是的，据我所知，它可以与普通 C 一起使用，即不需要 C++ 功能（可能需要 C++ 编译器，不确定）。

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2010-07-01T05:09:36.550

除了我明显的偏见

[http://code.google.com/p/seatest/](http://code.google.com/p/seatest/)

是一种对 C 代码进行单元测试的好方法。模仿 xUnit

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2011-02-18T20:38:42.097

在阅读了 Minunit 之后，我认为一个更好的方法是在断言宏中进行测试，我使用的很像防御性程序技术。所以我使用了与标准断言混合的 Minunit 相同的想法。[你可以在k0ga 的博客](http://www.shike2.com/blog/2010/12/written-unit-test-using-c.html)中看到我的框架（一个好名字可能是 NoMinunit）

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2008-09-15T19:22:11.000

[http://code.google.com/p/cmockery/](http://code.google.com/p/cmockery/)上的 cmockery

* * *

## 回答 #20

> 赞同：4
> 
> 时间：2008-09-16T15:40:09.667

[Cmockery](https://github.com/google/cmockery)是一个最近启动的项目，它包含一个非常简单易用的 C 库来编写单元测试。

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2008-09-15T20:39:24.840

首先，看这里：[http ://en.wikipedia.org/wiki/List_of_unit_testing_frameworks#C](http://en.wikipedia.org/wiki/List_of_unit_testing_frameworks#C)

我的公司有一个客户使用的 C 库。我们使用 CxxTest（一个 C++ 单元测试库）来测试代码。CppUnit 也可以工作。如果你被 C 困住，我会推荐 RCUNIT（但 CUnit 也很好）。

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2008-09-15T19:22:11.903

如果你熟悉 JUnit，那么我推荐 CppUnit。 [http://cppunit.sourceforge.net/cppunit-wiki](http://cppunit.sourceforge.net/cppunit-wiki)

那是假设您有 c++ 编译器来进行单元测试。如果不是，那么我必须同意 Adam Rosenfield 的观点，即支票就是你想要的。

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2008-11-25T11:12:08.900

在对目标进行测试之前，我使用[RCUNIT](http://rcunit.sourceforge.net/)对 PC 上的嵌入式代码进行了一些单元测试。良好的硬件接口抽象很重要，否则字节序和内存映射寄存器会杀死你。

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2010-10-10T01:43:07.320

试试lcut！- [http://code.google.com/p/lcut](http://code.google.com/p/lcut)

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2011-01-25T14:57:02.473

[API Sanity Checker](http://lvc.github.io/api-sanity-checker/) — C/C++ 库的测试框架：

> 用于共享 C/C++ 库的基本单元测试的自动生成器。它能够为参数生成合理的（在大多数情况下，但不幸的是不是所有情况下）输入数据，并通过分析标题中的声明为 API 中的每个函数编写简单（“健全”或“浅薄”质量）的测试用例文件。
> 
> 生成测试的质量允许检查简单用例中是否存在严重错误。该工具能够构建和执行生成的测试并检测崩溃（段错误）、中止、各种发出的信号、非零程序返回码和程序挂起。

例子：

*   fontconfig 2.8.0 的[测试套件](http://upstream-tracker.org/tests/fontconfig/2.8.0/view_tests.html)
*   FreeType 2.4.8 的[测试套件](http://upstream-tracker.org/tests/freetype2/2.4.8/view_tests.html)

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2008-09-15T19:22:34.727

使用的一种技术是使用 C++ xUnit 框架（和 C++ 编译器）开发单元测试代码，同时将目标系统的源代码保持为 C 模块。

确保您定期在交叉编译器下编译您的 C 源代码，如果可能的话，自动使用您的单元测试。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2010-04-16T08:55:58.313

LibU ( [http://koanlogic.com/libu](http://koanlogic.com/libu) ) 有一个单元测试模块，它允许明确的测试套件/用例依赖、测试隔离、并行执行和可定制的报告格式器（默认格式为 xml 和 txt）。

该库是 BSD 许可的，并且包含许多其他有用的模块 - 网络、调试、常用数据结构、配置等 - 如果您在项目中需要它们...

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2013-01-22T14:48:20.437

我很惊讶没有人提到[Cutter (http://cutter.sourceforge.net/)](http://cutter.sourceforge.net/) 你可以测试 C 和 C++，它与 autotools 无缝集成，并且有一个非常好的教程可用。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2008-10-11T16:18:50.770

如果你的目标是 Win32 平台或 NT 内核模式，你应该看看[cfix](http://cfix.sf.net/)。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2009-01-12T00:30:39.430

如果您仍在寻找测试框架，[CUnitWin32](http://code.google.com/p/cunitwin32/)是针对 Win32/NT 平台的一种。

这解决了我在使用其他测试框架时遇到的一个基本问题。即全局/静态变量处于确定状态，因为每个测试都是作为单独的进程执行的。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2015-01-04T22:33:43.540

我只是出于对现有 C 单元测试库的挫败感而编写了[Libcut 。](https://github.com/kirbyfan64/libcut)它具有基元的自动类型字符串（不需要 test_eq_int、test_eq_long、test_eq_short 等……；只有两个不同的基元和字符串集），并由一个头文件组成。这是一个简短的示例：

```
#include <libcut.h>

LIBCUT_TEST(test_abc) {
    LIBCUT_TEST_EQ(1, 1);
    LIBCUT_TEST_NE(1, 0);
    LIBCUT_TEST_STREQ("abc", "abc");
    LIBCUT_TEST_STRNE("abc", "def");
}

LIBCUT_MAIN(test_abc); 
```

不过，它仅适用于 C11。

# html - 如何使用 CSS 在 HTML 文档中插入换行符

> ID：65849
> 
> 赞同：40
> 
> 时间：2008-09-15T19:14:42.873
> 
> 标签：html, css

我正在编写一个 Web 服务，我想将数据作为 XHTML 返回。因为它是数据，而不是标记，所以我想保持它非常干净——没有额外`<div>`的 s 或`<span>`s。但是，为了方便开发人员，我还想让返回的数据在浏览器中具有合理的可读性。为此，我在想一个很好的方法是使用 CSS。

我特别想做的是在某些地方插入换行符。我知道`display: block`，但在我现在尝试处理的情况下它并没有真正起作用 -`form`带有`<input>`字段。像这样的东西：

```
<form>
  Thingy 1: <input class="a" type="text" name="one" />
  Thingy 2: <input class="a" type="text" name="two" />
  Thingy 3: <input class="b" type="checkbox" name="three" />
  Thingy 4: <input class="b" type="checkbox" name="four" />
</form> 
```

我希望它能够呈现，以便每个标签显示在与相应输入字段相同的行上。我试过这个：

```
input.a:after { content: "\a" } 
```

但这似乎没有任何作用。

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-09-15T19:26:49.803

最好将所有元素包装在标签元素中，然后将 css 应用于标签。:before 和 :after 伪类没有以一致的方式完全支持。

标签标签有很多优点，包括增加可访问性（在多个级别上）等等。

```
<label>
    Thingy one: <input type="text" name="one">;
</label> 
```

然后在标签元素上使用 CSS...

```
label {display:block;clear:both;} 
```

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2008-09-15T19:33:00.880

浏览器对表单控件进行了特殊处理，因此很多事情不一定能正常工作。其中之一是生成的内容——它不适用于表单控件。相反，将标签包裹起来`<label>`并使用`label:before { content: '\a' ; white-space: pre; }`. 您也可以通过浮动所有内容并添加`clear: left`到`<label>`元素来做到这一点。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-09-15T19:30:29.857

看起来您有一堆想要在列表中显示的表单项，对吧？嗯...如果只有那些 HTML 规范的人认为包含标记来处理项目列表...

我建议你这样设置：

```
<form>
  <ul>
    <li><label>Thingy 1:</label><input class="a" type="text" name="one" /></li>
    <li><label>Thingy 1:</label><input class="a" type="text" name="one" /></li>
 </ul>
</form> 
```

然后 CSS 变得容易多了。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-15T19:26:27.293

以下将为您提供换行符。它也会在前面放置额外的空格......你必须通过删除标签来搞乱你的源缩进。

```
form { white-space: pre } 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-15T19:16:28.330

一种选择是在您的 XML 中指定一个 XSLT 模板，（某些）浏览器将处理该模板，允许您包含不应影响 Web 服务使用者的带有标记、CSS、颜色等的表示。

在 XHTML 中，您可以简单地使用 CSS 在元素周围添加一些填充，例如

表单 input.a { margin-bottom: 1em }

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-15T19:58:29.883

```
<form>
   <label>Thingy 1: <input class="a" type="text" name="one" /></label>
   <label>Thingy 2: <input class="a" type="text" name="two" /></label>
   <label>Thingy 3: <input class="b" type="checkbox" name="three" /></label>
   <label>Thingy 4: <input class="b" type="checkbox" name="four" /></label>
</form> 
```

和下面的CSS

```
form label { display: block; } 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-15T20:00:08.490

```
<style type="text/css">
label, input { float: left; }
label { clear:left; }
</style>

<form>
    <label>thing 1:</label><input />
    <label>thing 2:</label><input />
</form> 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-15T20:00:07.353

秘诀是围绕你的整个事物、标签和小部件，在一个跨度中，其类会阻止和清除：

CSS

```
<style type="text/css">
  .lb {
    display:block;
    clear:both;
  }
</style> 
```

HTML

```
<form>
  <span class="lb">Thingy 1: <input class="a" type="text" name="one" /></span>
  <span class="lb">Thingy 2: <input class="a" type="text" name="two" /></span>
  <span class="lb">Thingy 3: <input class="b" type="checkbox" name="three" /></span>
  <span class="lb">Thingy 4: <input class="b" type="checkbox" name="four" /></span>
</form> 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-15T19:25:55.640

我同意约翰·米利金的观点。您可以在`<span>`定义了 CSS 类的每一行周围添加标签或其他内容，然后在必要时将它们设置为 display:block。我能想到的唯一另一种方法是制作`<input>`一个内联块并让它们发出“非常大”的填充权，这将使内联内容包裹起来。

即便如此，您最好的选择是在`<span>`标签（或类似标签）中对数据进行逻辑分组，以指示该数据属于一起（然后让 CSS 进行定位）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-15T19:34:28.520

CSS clear 元素可能是您正在寻找的获取换行符。伴随着一些东西：

> #登录表单输入{清除：两者；}

将确保没有其他浮动元素留在输入字段的两侧。

[参考](http://www.w3schools.com/CSS/pr_class_clear.asp)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-16T19:10:00.817

javascript 选项使事情变得复杂。按照 Jon Galloway 或 daniels0xff 的建议去做。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2008-09-15T19:23:48.233

使用 JavaScript。如果您使用的是 jQuery 库，请尝试以下操作：

```
$("input.a").after("<br/>") 
```

或者你需要的任何东西。

# http - 如何在 PowerShell 中执行 HTTP PUT 上传到 VMware ESX 服务器？

> ID：65856
> 
> 赞同：2
> 
> 时间：2008-09-15T19:14:56.883
> 
> 标签：http, powershell, vmware, esx

VMware ESX、ESXi 和 VirtualCenter 自版本 3.5 起应该能够支持 HTTP PUT 上传。我知道如何进行下载，这很容易。我以前从未做过 PUT。

有关该主题的背景信息在这里：http: [//communities.vmware.com/thread/117504](http://communities.vmware.com/thread/117504)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-15T21:16:08.013

您应该查看[PoshCode](http://PoshCode.org/)`Send-PoshCode` cmdlets 脚本模块中的函数……它使用 POST，而不是 PUT，但技术实际上是相同的。我没有我能想到的 PUT 服务器进行测试，但基本上，设置你的 $url 和你的 $data，并执行以下操作：

```
param($url,$data,$filename,[switch]$quiet)

$request = [System.Net.WebRequest]::Create($url)
$data = [Text.Encoding]::UTF8.GetBytes( $data )

## Be careful to set your content type appropriately...
## This is what you're going to SEND THEM
$request.ContentType = 'text/xml;charset="utf-8"' # "application/json"; # "application/x-www-form-urlencoded"; 
## This is what you expect back
$request.Accept = "text/xml" # "application/json";

$request.ContentLength = $data.Length
$request.Method = "PUT"
## If you need Credentials ...
# $request.Credentials = (Get-Credential).GetNetworkCredential()

$put = new-object IO.StreamWriter $request.GetRequestStream()
$put.Write($data,0,$data.Length)
$put.Flush()
$put.Close()

## This is the "simple" way ...
# $reader = new-object IO.StreamReader $request.GetResponse().GetResponseStream() ##,[Text.Encoding]::UTF8
# write-output $reader.ReadToEnd()
# $reader.Close()

## But there's code in PoshCode.psm1 for doing a progress bar, something like ....

$res = $request.GetResponse();
if($res.StatusCode -eq 200) {
   [int]$goal = $res.ContentLength
   $reader = $res.GetResponseStream()
   if($fileName) {
      $writer = new-object System.IO.FileStream $fileName, "Create"
   }

   [byte[]]$buffer = new-object byte[] 4096
   [int]$total = [int]$count = 0
   do
   {
      $count = $reader.Read($buffer, 0, $buffer.Length);
      if($fileName) {
         $writer.Write($buffer, 0, $count);
      } else {
         $output += $encoding.GetString($buffer,0,$count)
      }
      if(!$quiet) {
         $total += $count
         if($goal -gt 0) {
            Write-Progress "Downloading $url" "Saving $total of $goal" -id 0 -percentComplete (($total/$goal)*100)
         } else {
            Write-Progress "Downloading $url" "Saving $total bytes..." -id 0
         }
      }
   } while ($count -gt 0)

   $reader.Close()
   if($fileName) {
       $writer.Flush()
       $writer.Close()
   } else {
       $output
   }
}
$res.Close(); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-07T18:56:34.577

在[VI Toolkit Extensions](http://www.codeplex.com/vitoolkitextensions)中使用 Copy-TkeDatastoreFile。它将与二进制文件一起使用。

# perl - 安装缺少的 Perl 模块的最简单方法是什么？

> ID：65865
> 
> 赞同：217
> 
> 时间：2008-09-15T19:16:07.910
> 
> 标签：perl, ubuntu, installation, cpan, lib

我收到此错误：

`Can't locate Foo.pm in @INC`

有没有比下载、解压、制作等更简单的安装方法？

* * *

## 回答 #1

> 赞同：254
> 
> 时间：2008-09-15T19:17:52.553

**在 Unix 上**：

通常你在你的 shell 中启动*cpan ：*

`$ cpan`

并输入

`install Chocolate::Belgian`

或简称：

`cpan Chocolate::Belgian`

**在 Windows 上**：

> 如果您在 Windows 上使用 ActivePerl，则[PPM（Perl 包管理器）](http://docs.activestate.com/activeperl/5.10/faq/ActivePerl-faq2.html#pkg_operations)与 CPAN.pm 具有许多相同的功能。

例子：

`$ ppm`
`ppm> search net-smtp`
`ppm> install Net-SMTP-Multipart`

**请参阅[如何安装 Perl 模块？](http://www.cpan.org/misc/cpan-faq.html#How_install_Perl_modules)在 CPAN 常见问题解答中**

许多发行版将许多 perl 模块作为软件包提供。

*   Debian/Ubuntu：`apt-cache search 'perl$'`
*   Arch Linux：`pacman -Ss '^perl-'`
*   Gentoo：类别`dev-perl`

您应该*始终*喜欢它们，因为您可以从自动（安全）**更新**和易于**删除**中受益。*使用cpan*工具本身可能会非常棘手。

**[对于 Gentoo，有一个名为g-cpan](https://wiki.gentoo.org/wiki/Project:Perl/g-cpan)**的好工具，它可以从 CPAN 构建/安装模块并为您创建一个 Gentoo 包（[ebuild](http://en.wikipedia.org/wiki/Ebuild)）。

* * *

## 回答 #2

> 赞同：68
> 
> 时间：2010-08-28T08:34:48.363

试试[App::cpanminus](http://search.cpan.org/perldoc/App::cpanminus)：

```
# cpanm Chocolate::Belgian 
```

非常适合安装东西。它不提供 CPAN 或 CPANPLUS 更复杂的功能，因此它很容易使用，只要您知道要安装哪个模块。如果您还没有 cpanminus，只需输入：

```
# cpan App::cpanminus 
```

安装它。

也可以完全不使用 cpan 来安装它。基本的引导程序是，

```
curl -L http://cpanmin.us | perl - --sudo App::cpanminus 
```

有关更多信息，请访问 App::cpanminus 页面并查看安装部分。

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2008-09-15T20:08:08.177

我注意到有些人建议在 sudo 下运行 cpan。这曾经是安装到系统目录所必需的，但现代版本的 CPAN shell 允许您将其配置为**仅**使用 sudo进行安装。这更安全，因为这意味着测试不会以 root 身份运行。

如果您有旧的 CPAN shell，只需安装新的 cpan（“安装 CPAN”），当您重新加载 shell 时，它会提示您配置这些新指令。

现在，当我在一个带有旧 CPAN 的系统上时，我要做的第一件事就是更新 shell 并将其设置为执行此操作，这样我就可以作为普通用户完成大部分 cpan 工作。

另外，我强烈建议 Windows 用户研究[草莓 Perl](http://strawberryperl.com)。这是一个 Perl 版本，它带有一个预配置的 CPAN shell 和一个编译器。它还包括一些难以编译的 Perl 模块及其外部 C 库依赖项，尤其是 XML::Parser。这意味着在安装模块时，您可以像所有其他 Perl 用户一样做同样的事情，而且事情往往更频繁地“正常工作”。

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2008-09-15T19:21:23.950

如果您在 Ubuntu 上并且想要安装预打包的 perl 模块（例如 geo::ipfree），请尝试以下操作：

```
    $ apt-cache search perl geo::ipfree
    libgeo-ipfree-perl - IP 地址 Perl 模块的查找国家/地区

    $ sudo apt-get install libgeo-ipfree-perl

```

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2008-09-15T22:47:11.740

有几个人提到了 cpan 实用程序，但它不仅仅是启动一个 shell。只需给它您要安装的模块并让它工作即可。

```
$prompt> cpan Foo::Bar 
```

如果你不给它任何参数，它会启动 CPAN.pm shell。这适用于 Unix、Mac，并且在 Windows（尤其是 Strawberry Perl）上应该没问题。

您还可以使用 cpan 工具执行其他几项操作。以下是当前功能的摘要（可能比 CPAN.pm 和 perl 附带的功能更新）：

```
-a
Creates the CPAN.pm autobundle with CPAN::Shell->autobundle.

-A module [ module ... ]
Shows the primary maintainers for the specified modules

-C module [ module ... ]
Show the Changes files for the specified modules

-D module [ module ... ]
Show the module details. This prints one line for each out-of-date module (meaning,
modules locally installed but have newer versions on CPAN). Each line has three columns:
module name, local version, and CPAN version.

-L author [ author ... ]
List the modules by the specified authors.

-h
Prints a help message.

-O
Show the out-of-date modules.

-r
Recompiles dynamically loaded modules with CPAN::Shell->recompile.

-v
Print the script version and CPAN.pm version. 
```

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2008-09-15T19:17:11.370

`sudo perl -MCPAN -e 'install Foo'`

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2008-09-16T06:36:04.810

另请参阅[是的，即使您可以使用 CPAN](http://perlmonks.org/?node=693828)。它展示了如何在没有 root 或 sudo 访问权限的情况下使用 CPAN。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-09-16T19:25:35.493

奥托提出了一个[很好的建议](https://stackoverflow.com/questions/65865/cant-locate-foopm-in-inc-how-to-install-a-missing-perl-module#65911)。这也适用于 Debian，以及任何其他 Debian 衍生产品。缺少的部分是当 apt-cache search 找不到东西时该怎么做。

```
$ sudo apt-get install dh-make-perl build-essential apt-file
$ sudo apt-file update 
```

然后每当你有一个随机模块你想安装：

```
$ cd ~/some/path
$ dh-make-perl --build --cpan Some::Random::Module
$ sudo dpkg -i libsome-random-module-perl-0.01-1_i386.deb 
```

这会给你一个 deb 包，你可以安装它来获取 Some::Random::Module。这里最大的好处之一是手册页和示例脚本以及模块本身将放置在您选择的发行版位置。如果发行版发布了更新版本的 Some::Random::Module 的官方软件包，它将在您进行 apt-get 升级时自动安装。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2011-05-22T18:19:38.007

已经回答并接受了答案 - 但无论如何：

恕我直言，安装 CPAN 模块的最简单方法（在类似 unix 的系统上，并且不知道这些奇迹）是：

```
curl -L http://cpanmin.us | perl - --sudo App::cpanminus 
```

以上是安装“零配置 CPAN 模块安装程序”，名为`cpanm`. （可能需要几分钟才能安装 - 不要中断该过程）

之后 - 简单地说：

```
cpanm Foo
cpanm Module::One
cpanm Another::Module 
```

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2008-09-16T15:25:57.220

很多推荐`CPAN.pm`，这很棒，但如果你正在使用，`Perl 5.10`那么你也可以访问`CPANPLUS.pm`类似`CPAN.pm`但更好的。

当然，它仍然适用于`CPAN`仍在使用旧版本 Perl 的人。为什么不试试：

```
$ cpan CPANPLUS 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2012-11-10T02:24:59.020

很多时候确实会发生 cpan install 命令失败并显示 **“make test has returned bad status, won't install without force”之类的消息**

在这种情况下，以下是安装模块的方法：

```
perl -MCPAN -e "CPAN::Shell->force(qw(install Foo::Bar));" 
```

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2014-05-14T05:38:57.013

使用 cpan 命令作为`cpan Modulename`

```
$ cpan HTML::Parser 
```

要自动安装依赖项，请执行以下操作

```
$ perl -MCPAN -e shell
cpan[1]>  o conf prerequisites_policy follow
cpan[2]>  o conf commit
exit 
```

我更喜欢[App::cpanminus](https://metacpan.org/pod/App::cpanminus)，它会自动安装依赖项。做就是了

```
$ cpanm HTML::Parser 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2011-05-22T15:55:25.263

即使它应该工作：

```
cpan -i module_name 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2013-02-22T13:02:57.177

在 ubuntu 上，大多数 perl 模块已经打包，因此安装速度比大多数其他必须编译的系统快得多。

`Foo::Bar`例如，要在命令提示符下安装，通常您只需执行以下操作：

```
sudo apt-get install libfoo-bar-perl 
```

遗憾的是，并非所有模块都遵循该命名约定。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2014-10-30T10:39:32.430

在`Fedora Linux`or上`Enterprise Linux`，`yum`还跟踪 perl 库依赖项。因此，如果 perl 模块可用，并且某些 rpm 包导出该依赖项，它将为您安装正确的包。

```
yum install 'perl(Chocolate::Belgian)' 
```

（很可能是 perl-Chocolate-Belgian 包，甚至 ChocolateFactory 包）

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2008-09-15T19:27:42.453

我知道的2种方法：

**使用 PPM：**

对于**Windows** (ActivePerl)，我使用了 ppm

从命令行类型 ppm。在 ppm 提示符下...

```
ppm> install foo 
```

或者

```
ppm> search foo 
```

获取可用的 foo 模块列表。输入所有命令的**帮助**

**使用 CPAN：**

您也可以像这样使用 CPAN（***nix 系统**）：

```
perl -MCPAN -e 'shell' 
```

给你一个提示

```
cpan> 
```

在提示下...

```
cpan> install foo  (again to install the foo module) 
```

键入 h 以获取 cpan 的命令列表

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2008-11-21T19:59:27.450

在 Fedora 上，您可以使用

```
# yum install foo 
```

只要 Fedora 有该模块的现有软件包。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2016-12-28T11:16:18.100

对我来说最简单的方法是：

```
PERL_MM_USE_DEFAULT=1 perl -MCPAN -e 'install DateTime::TimeZone' 
```

a) 自动递归依赖检测/解析/安装

b) 它是一个 shell onlineer，适用于 setup-scripts

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2013-09-11T18:06:06.097

如果您想将新模块放入您的 cpan shell 未配置为使用的自定义位置，那么也许以下内容会很方便。

```
 #wget <URL to the module.tgz>
 ##unpack
 perl Build.PL
./Build destdir=$HOME install_base=$HOME
./Build destdir=$HOME install_base=$HOME install 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2014-05-20T08:14:12.000

有时您可以使用`yum search foo`搜索相关的 perl 模块，然后使用`yum install xxx`安装。

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2019-10-25T13:17:35.830

**安全解决方案**

许多答案都提到了`cpan`实用程序（使用`CPAN.pm`）的使用，而没有提及安全性。默认情况下，`CPAN`2.27 及更早版本配置`urllist`为使用 http URL（即[http://www.cpan.org/](http://www.cpan.org/)），它允许 MITM 攻击，因此是不安全的。这是用于下载`CHECKSUMS`文件的内容，因此需要将其更改为安全 URL（例如[https://www.cpan.org/](https://www.cpan.org/)）。

所以，运行cpan并接受默认配置后，需要通过`MyConfig.pm`如下方式修改生成的文件（输出全路径）。代替

```
'urllist' => [q[http://www.cpan.org/]], 
```

经过

```
'urllist' => [q[https://www.cpan.org/]], 
```

注意：https 是不够的；您还需要一个可以信任的网站。所以，如果你想选择一些任意的镜像，请小心。

然后你可以`cpan`按照通常的方式使用。

我在 rt.cpan.org 上关于不安全 URL 的[错误报告。](https://rt.cpan.org/Public/Bug/Display.html?id=130819)

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2016-11-04T15:26:15.397

似乎您已经得到了答案，但我想我会插话。这就是我在 Ubuntu（或 debian 服务器）上的某些脚本中所做的

```
#!/usr/bin/perl

use warnings;
use strict;

#I've gotten into the habit of setting this on all my scripts, prevents weird path issues if the script is not being run by root
$ENV{'PATH'} = '/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin';

#Fill this with the perl modules required for your project
my @perl = qw(LWP::Simple XML::LibXML MIME::Lite DBI DateTime Config::Tiny Proc::ProcessTable);

chomp(my $curl = `which curl`);

if(!$curl){ system('apt-get install curl -y > /dev/null'); }

chomp(my $cpanm = system('/bin/bash', '-c', 'which cpanm &>/dev/null'));

#installs cpanm if missing
if($cpanm){ system('curl -s -L http://cpanmin.us | perl - --sudo App::cpanminus'); }

#loops through required modules and installs them if missing
foreach my $x (@perl){
    eval "use $x";
    if($@){
        system("cpanm $x");
        eval "use $x";
    }
} 
```

这对我来说效果很好，也许这里有一些你可以使用的东西。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-09-15T19:26:21.113

在带有 Perl 的 ActiveState 发行版的 Windows 上，使用[ppm](http://docs.activestate.com/activeperl/5.10/faq/ActivePerl-faq2.html#pkg_operations)命令。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2015-10-01T09:56:36.833

简单地`cpan Foo::Bar`在 shell 上执行就可以达到目的。

# encryption - 我应该在加密的同时使用初始化向量 (IV) 吗？

> ID：65879
> 
> 赞同：40
> 
> 时间：2008-09-15T19:17:30.887
> 
> 标签：encryption, cryptography

是否建议我使用[初始化向量](http://en.wikipedia.org/wiki/Initialization_vector)来加密/解密我的数据？它会让事情更安全吗？这是需要逐案评估的事情之一吗？

为了将其置于实际上下文中，Win32 加密函数[CryptSetKeyParam](http://msdn.microsoft.com/en-us/library/aa380272(VS.85).aspx)允许在加密/解密之前在密钥上设置初始化向量。其他 API 也允许这样做。

一般推荐什么，为什么？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-15T19:19:03.317

当同一密钥可能用于加密多条消息时，IV 是必不可少的。

原因是，在大多数加密模式下，可以同时分析使用相同密钥加密的两条消息。例如，在一个简单的流密码中，对使用相同密钥加密的两个密文进行异或运算会导致两个消息的异或，使用传统的密码分析技术可以很容易地从中提取明文。

弱 IV 是 WEP 易碎的部分原因。

IV 基本上将一些唯一的、非秘密的数据混合到密钥中，以防止同一个密钥被使用两次。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-15T19:24:08.763

在大多数情况下，您应该使用 IV。由于 IV 每次都是随机生成的，如果你对相同的数据进行两次加密，加密的消息就会不同，观察者无法判断这两条消息是否相同。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-15T19:53:48.273

仔细看一张 CBC 模式的图片（见下文）。您很快就会意识到，知道 IV 的攻击者就像知道前一个*密文*块的攻击者一样（是的，他们已经知道很多了）。

这就是我所说的：当您*不*确保数据完整性时，IV=0 的大多数“问题”都是块加密模式的一般问题。你真的必须确保完整性。

这就是我所做的：使用强校验和（加密哈希或 HMAC）并在加密之前将其添加到您的明文中。这是您已知的第一个密文块：它是没有校验和的同一事物的 IV，并且您出于一百万个其他原因需要校验和。

最后： CBC 和流密码之间的任何类比都不是非常有见地恕我直言。

看看CBC模式的图片，我想你会感到惊喜。

这是一张图片：

[http://en.wikipedia.org/wiki/Block_cipher_modes_of_operation](http://en.wikipedia.org/wiki/Block_cipher_modes_of_operation)

[链接文本](http://en.wikipedia.org/wiki/Block_cipher_modes_of_operation)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-07-24T17:50:38.053

如果同一密钥多次用于多个不同的秘密模式，则加密结果中可能会出现。IV应该是伪随机的并且每个密钥只使用一次，用于混淆结果。您永远不应该使用相同的密钥两次使用相同的 IV，这会破坏它的目的。

为了不必费心跟踪 IV，最简单的方法是将其添加或附加到生成的加密机密中。这样你就不用多想了。然后，您将始终知道第一个或最后 N 位是 IV。

解密秘密时，您只需拆分 IV，然后将其与密钥一起使用来解密秘密。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-15T19:31:25.987

我发现 HTTP Digest Auth ( [RFC 2617](http://www.faqs.org/rfcs/rfc2617.html) ) 的文章对于理解 IV/nonce 的使用和需求非常有帮助。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-09-25T12:56:22.073

> 这是需要逐案评估的事情之一吗？

是的。始终阅读您正在使用的密码以及它期望其输入的外观。一些密码不使用 IV，但确实需要盐以确保安全。IV 可以有不同的长度。密码的模式可以改变 IV 的用途（如果它被使用的话），因此，它需要哪些属性是安全的（随机的、唯一的、增量的？）。

通常建议使用它，因为大多数人习惯于在称为“密码块链接”的模式下使用 AES-256 或类似的块密码。对于许多工程用途来说，这是一个很好的、明智的默认选择，它需要你有一个适当的（非重复的）IV。在这种情况下，它不是可选的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-15T19:35:21.810

IV 允许对明文进行加密，从而使加密的文本更难被攻击者解密。您使用的每一位 IV 都会使给定纯文本中加密文本的可能性加倍。

例如，让我们使用一个字符长的 IV 来加密“hello world”。IV 被随机选择为“x”。然后加密的文本是“xhello world”，例如“asdfghjkl”。如果我们再次加密它，首先生成一个新的 IV——比如这次我们得到“b”——然后像往常一样加密（从而加密“bhello world”）。这次我们得到'qwertyuio'。

关键是攻击者不知道 IV 是什么，因此必须计算给定纯文本的每个可能的 IV 以找到匹配的密文。这样，IV 就像[密码 salt](http://en.wikipedia.org/wiki/Password_salt)一样。最常见的是，IV 与链接密码（流密码或分组密码）一起使用。在链接块密码中，每个纯文本块的结果被馈送到密码算法以找到下一个块的密文。这样，每个块都链接在一起。

那么，如果你有一个用于加密纯文本的随机 IV，你如何解密它呢？简单的。将 IV（纯文本）与您的加密文本一起传递。使用我们上面的第一个示例，最终的密文将是“xasdfghjkl”（IV + 密文）。

是的，您应该使用 IV，但一定要正确选择它。使用一个好的随机数源来制作它。永远不要使用相同的 IV 两次。并且**永远不要**使用常量 IV。

[关于初始化向量](http://en.wikipedia.org/wiki/Initialization_vector)的 Wikipedia 文章提供了一般概述。

# c# - 在 .NET 中检测 COMCTL32 版本

> ID：65889
> 
> 赞同：1
> 
> 时间：2008-09-15T19:18:26.250
> 
> 标签：c#, .net, comctl32

如何确定 C# .NET 应用程序正在使用哪个版本的 comctl32.dll？我看到的这个问题的答案通常涉及从 Windows\System 中的物理文件获取版本信息，但由于并行考虑，这不一定是实际使用的版本。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-15T19:29:49.030

`System.Diagnostics.Process.GetCurrentProcess.Modules`为您提供当前进程中加载​​的所有模块。这也包括非托管的 win32 dll。您可以搜索集合并检查`FileVersionInfo`加载版本的属性。

# debugging - 调试 VBO 顶点缓冲区崩溃

> ID：65910
> 
> 赞同：2
> 
> 时间：2008-09-15T19:21:17.290
> 
> 标签：debugging, opengl, vbo

我正在使用 VBO 扩展来存储顶点、法线和颜色缓冲区 (glBindBufferARB) 出于某种原因，在更改缓冲区或执行某些操作时，应用程序会因访问冲突而崩溃。附加调试器时，我看到崩溃发生在某个线程中，该线程不是我的主线程，该线程执行 opengl 调用，并在与 nvidia 图形驱动程序相关的某个 dll 中执行。

可能发生的事情是我给了一些缓冲区调用错误的缓冲区或大小错误。所以我的问题是，我该如何调试这种情况？崩溃似乎发生在实际调用之后的某个时间并且在不同的线程中。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-16T16:29:36.133

假设这是关于 Windows，NVIDIA 有一个[GLExpert](http://developer.nvidia.com/object/glexpert_home.html)工具。它可以打印各种 OpenGL 警告/错误。

在其他一些情况下，使用打开错误检查的[GLIntercept](http://glintercept.nutty.org/) OpenGL 调用拦截器会很有用。

如果这些工具没有帮助，那么，这是很好的旧调试。尝试缩小问题范围并找出导致崩溃的确切原因。如果是 NVIDIA 特定问题，请尝试安装不同的驱动程序和/或在 NVIDIA 开发者论坛上提问。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-15T19:35:41.217

我想你可能只需要暴力破解那个。即一次使用几行注释掉任何vbo，直到您的程序不再崩溃。然后，您将了解将注意力集中在哪些行上，并真正仔细检查您传递的参数。

还可以尝试在您的程序周围自由地使用 glError() 调用。通常，如果你传递了一个虚假参数，glError 会在它到达崩溃点之前告诉你有什么问题。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-09-15T19:37:13.147

最好的 OpenGl/D3D 调试工具之一是 nVidia 的 NvPerfHUD。它不会帮助您找到确切的问题，但它确实提供了您发送到渲染管道的内容的另一个视图。

但是，我会说我只将它用于 D3D 应用程序，所以我不知道它是否对 OpenGL 程序有同样的帮助。

编辑：

我不知道为什么这被否决了。我之前用 NvPerfHUD 调试过 VB 和 IB 问题。简单的事情，例如错误的原始计数，并通过查看每个单独的绘图调用来诊断。

# macos - 在 Mac OS X 中断开连接时使用网络服务

> ID：65925
> 
> 赞同：0
> 
> 时间：2008-09-15T19:22:50.950
> 
> 标签：macos, networking

我有时会使用 Macbook Pro 在完全断开的环境中工作。出于测试目的，我需要在 VMWare 会话中运行本地 DNS 服务器。我已经将查找系统配置为使用 DNS 服务器（/etc/resolve.conf 并通过网络配置面板，它在下面使用 configd），并且像“dig”和“nslookup”这样的命令可以工作。例如，我的 DNS 服务器配置为将 www.example.com 解析为 127.0.0.1，这是“dig www.example.com”的输出：

```
; <<>> DiG 9.3.5-P1 <<>> www.example.com
;; global options:  printcmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 64859
;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0

;; QUESTION SECTION:
;www.example.com.               IN      A

;; ANSWER SECTION:
www.example.com.        86400   IN      A       127.0.0.1

;; Query time: 2 msec
;; SERVER: 172.16.35.131#53(172.16.35.131)
;; WHEN: Mon Sep 15 21:13:15 2008
;; MSG SIZE  rcvd: 49 
```

不幸的是，如果我尝试在浏览器中 ping 或设置连接，则无法解析 DNS 名称。这是“ping www.example.com”的输出：

```
ping: cannot resolve www.example.com: Unknown host 
```

似乎那些更集成在 Mac OS X 10.4（及更高版本）中的工具不再使用“/etc/resolv.conf”系统。通过 scutil 配置它们没有任何帮助，因为如果无线或内置以太网接口**处于非活动状态**，则基本网络功能似乎无法正常工作。

在 Linux（例如 Ubuntu）中，可以关闭无线适配器，而无需打开网络功能。所以在 Linux 中，我似乎可以完全断开连接工作。

解决方案可能是使用以太网环回连接器，但我更喜欢软件解决方案，因为 Windows 和 Linux 都没有这个问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-15T20:44:55.777

在从 10.4 开始的 OS X 上，`/etc/resolv.conf`不再是 DNS IP 地址的规范位置。一些 Unix 工具，例如`dig`and`nslookup`将直接使用它，但任何使用 Unix 或 Mac API 进行 DNS 查找的工具都不会。相反，configd 维护一个提供更多选项的数据库，例如为不同的域使用不同的名称服务器。（为了兼容性，此信息的一个子集被镜像到`/etc/resolv.conf`。）

您可以使用 编辑从代码中的名称服务器信息`SCDynamicStore`，或者以`scutil`交互方式使用或从脚本中使用。[我在这里](http://njr.sabi.net/2005/11/07/alternate-openvpn-os-x-dns-updating-script/)发布了一些指向这两种方法的示例脚本的链接。 当我试图弄清楚这些东西时的 [这个线程也可能有一些用处。](http://lists.apple.com/archives/Macnetworkprog/2005/Jun/msg00011.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-15T20:30:24.470

我不时在不同的笔记本电脑上遇到这个问题，我发现最简单的是一种技术含量低的非软件解决方案——创建一个以太网环回连接器。您可以使用旧网线在 2 分钟内完成此操作，只需切断末端并在 RJ45 连接器上方加入发送和接收对。（显然你的接口需要一个静态 IP）

老派，但完全独立于软件，适合在长途飞行的开发环境中工作...... :)

[这里](http://www.juniper.net/techpubs/software/nog/nog-interfaces/html/fe-ge-loopback25.html)有一个简单的图表

# xml - 使用浏览器转换 XML 时，是否可以通过 URL 将参数传递给 XSLT？

> ID：65926
> 
> 赞同：16
> 
> 时间：2008-09-15T19:23:04.133
> 
> 标签：xml, xslt, browser, transform, param

使用浏览器转换 XML（Google Chrome 或 IE7）时，是否可以通过 URL 将参数传递给 XSLT 样式表？

例子：

**数据.xml**

```
<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="sample.xsl"?>
<root>
    <document type="resume">
        <author>John Doe</author>
    </document>
    <document type="novella">
        <author>Jane Doe</author>
    </document>
</root> 
```

**示例.xsl**

```
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet
    version="1.0"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:fo="http://www.w3.org/1999/XSL/Format">

    <xsl:output method="html" />
    <xsl:template match="/">
    <xsl:param name="doctype" />
    <html>
        <head>
            <title>List of <xsl:value-of select="$doctype" /></title>
        </head>
        <body>
            <xsl:for-each select="//document[@type = $doctype]">
                <p><xsl:value-of select="author" /></p>
            </xsl:for-each>
        </body>
    </html>
</<xsl:stylesheet> 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-16T22:39:41.250

不幸的是，不，您不能仅在客户端将参数传递给 XSLT。网络浏览器从 XML 中获取处理指令；并直接使用 XSLT 对其进行转换。

* * *

可以通过查询字符串 URL 传递值，然后使用 JavaScript 动态读取它们。然而，这些将无法在 XSLT（XPath 表达式）中使用——因为浏览器已经转换了 XML/XSLT。它们只能用于呈现的 HTML 输出。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-11T15:25:53.930

只需将参数作为属性添加到 XML 源文件，并将其用作样式表的属性。

```
xmlDoc.documentElement.setAttribute("myparam",getParameter("myparam")) 
```

而JavaScript函数如下：

```
//Get querystring request paramter in javascript
function getParameter (parameterName ) {

   var queryString = window.top.location.search.substring(1);

   // Add "=" to the parameter name (i.e. parameterName=value)
   var parameterName = parameterName + "=";
   if ( queryString.length > 0 ) {
      // Find the beginning of the string
      begin = queryString.indexOf ( parameterName );
      // If the parameter name is not found, skip it, otherwise return the value
      if ( begin != -1 ) {
         // Add the length (integer) to the beginning
         begin += parameterName.length;
         // Multiple parameters are separated by the "&" sign
         end = queryString.indexOf ( "&" , begin );
      if ( end == -1 ) {
         end = queryString.length
      }
      // Return the string
      return unescape ( queryString.substring ( begin, end ) );
   }
   // Return "null" if no parameter has been found
   return "null";
   }
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-15T19:34:24.793

即使转换是客户端的，您也可以在服务器端生成 XSLT。

这允许您使用动态脚本来处理参数。

例如，您可以指定：

```
<?xml-stylesheet type="text/xsl"href="/myscript.cfm/sample.xsl?paramter=something" ?> 
```

然后在 myscript.cfm 中，您将输出 XSL 文件，但使用动态脚本处理查询字符串参数（这取决于您使用的脚本语言）。

# java - 用 Java 读取 Outlook .msg 文件的最佳库是什么？

> ID：65936
> 
> 赞同：5
> 
> 时间：2008-09-15T19:25:16.030
> 
> 标签：java, outlook, msg

我想从 Java 应用程序读取保存的 Outlook 消息（.msg 文件）中的文本和二进制附件，而不使用本机代码（JNI，Java 本机接口）。

[Apache POI-HSMF](http://poi.apache.org/hsmf/index.html)似乎朝着正确的方向发展，但它还处于非常早期的发展阶段......

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-07-22T04:10:30.677

[msgparser](http://auxilii.com/msgparser/)是一个小型开源 Java 库，可解析 Outlook .msg 文件并使用 Java 对象提供其内容。msgparser 使用[Apache POI - POIFS](http://poi.apache.org/poifs/)库来解析使用 OLE 2 复合文档格式的消息文件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-15T19:36:12.590

*   您可以使用 Apache POIFS，它似乎更成熟一些，但这似乎重复了 POI-HSMF 的努力。

*   您可以使用 POI-HSMF 并做出更改以获取您需要的功能。这通常是 FOSS 项目的扩展方式。

*   您可以使用 com4j、j-Interop 或其他一些 COM 级别的互操作功能，并直接与提供对结构化文档的访问的 COM 接口进行交互。这比尝试通过 JNI 直接命中它要容易得多。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-09-15T19:36:59.483

您是否尝试过将 Jython 与 Python win32 扩展 ( [http://www.jython.org/Project/](http://www.jython.org/Project/) + [http://python.net/crew/mhammond/win32/](http://python.net/crew/mhammond/win32/) ) 一起使用？如果这是针对“个人”或“内部”项目，带有 Python 的 Jython 可能是一个非常好的选择。如果您正在构建“收缩包装”软件包，这可能不是最佳选择。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2015-06-17T20:23:23.517

阿帕奇 POI-HSMF。

您可以从以下链接中给出的示例开始。 [http://svn.apache.org/viewvc/poi/trunk/src/scratchpad/examples/src/org/apache/poi/hsmf/examples/Msg2txt.java?revision=821500&view=markup&pathrev=821500](http://svn.apache.org/viewvc/poi/trunk/src/scratchpad/examples/src/org/apache/poi/hsmf/examples/Msg2txt.java?revision=821500&view=markup&pathrev=821500)

进一步阅读图书馆文档。

# sql-server - 使用 ColdFusion 将 Access 数据导入 SQL Server

> ID：65940
> 
> 赞同：0
> 
> 时间：2008-09-15T19:25:42.210
> 
> 标签：sql-server, ms-access, coldfusion

这应该很简单。我正在尝试将数据从 Access 导入 SQL Server。我没有直接访问 SQL Server 数据库的权限——它在 GoDaddy 上，他们只允许 Web 访问。所以我不能使用 Management Studio 工具，或其他需要远程访问数据库的第三方 Access 升迁程序。

我在 Access 数据库上编写了一个查询，我试图循环并将每条记录插入到相应的 SQL Server 表中。但它不断出错。我相当肯定这是因为 HTML 和上帝知道 Access 文本字段之一中还有哪些其他奇怪的字符。我尝试使用 CFQUERYPARAM 但这似乎也无济于事。

任何想法都会有所帮助。谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-15T20:25:18.557

尝试使用[GoDaddy SQL 备份/恢复工具](http://blog.godaddyhosting.com/2007/07/20/presentingdrum-roll-please-the-ms-sql-backuprestore-feature.aspx)获取数据库的本地副本。此时，使用[SQL Server DTS 工具](http://www.microsoft.com/technet/prodtechnol/sql/2000/deploy/dtssql2k.mspx)导入数据。这是一个易于使用的拖放式图形界面。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T14:10:25.140

抛出什么错误？你用的是什么奇怪的字符？您是指 HTML 标记，还是扩展（例如 UTF-8）字符？

如果可能，请打开强大的错误报告。

如果问题是页面超时，您可以使用 Admin 增加超时时间，使用 cfsetting 标签，或者重写脚本以运行一定数量的行，然后在下一个起点转发到自身。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T22:42:53.573

您应该能够从应用程序服务器的命令行执行 MS SQL Server 中保存的 DTS 包。既然是这种情况，您可以使用`<cfexecute>`向 DTSRUNNUI.EXE 发出请求。（[参见示例](http://www.mssqltips.com/tip.asp?tip=1007)）这当然是假设您在该命令可用的服务器上。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-09-15T19:59:18.867

当可以使用 SQL 更新时，永远不建议循环遍历记录。

从您的问题中不清楚您正在使用哪个数据库接口层，但*如果*正在使用的接口支持两种类型的数据库，则可以使用正确的接口从数据库外部的源插入数据。这可以在 SQL 语句的 FROM 子句中完成，方法是不仅指定表名，还指定数据库的连接字符串。假设您的 Web 主机具有 Jet 数据的 ODBC 驱动程序（您实际上并未使用 Access，它是应用程序开发部分——您仅使用 Jet 数据库引擎），连接字符串应该足够了。

编辑：如果您使用 Jet 数据库引擎来执行此操作，您应该能够指定类似这样的源表（其中 tblSQLServer 是您的 Jet MDB 中的一个表，它通过 ODBC 链接到您的 SQL Server）：

```
INSERT INTO tblSQLServer (ID, OtherField ) 
SELECT ID, OtherField
FROM [c:\MyDBs\Access.mdb].tblSQLServer 
```

关键是您在这里利用 Jet db 引擎为您完成所有繁重的工作。

# asp.net - 我什么时候在 PostBackURL 上使用 Server.Transfer？

> ID：65956
> 
> 赞同：3
> 
> 时间：2008-09-15T19:27:22.657
> 
> 标签：asp.net

或相反亦然。

更新：
嗯，假设我有一个购物车应用程序，用户点击 Checkout 按钮。我要做的下一件事是将用户发送到 Invoice.aspx 页面（或类似页面）。当用户点击结帐时，我可以`Button.PostBackURL = "Invoice.aspx"`

或者我可以

```
Server.Transfer("Invoice.aspx") 
```

（我还更改了标题，因为该方法称为 Transfer 而不是 TransferURL）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-15T19:34:34.823

*   Server.TransferURL 不会导致 HTTP 请求/响应的往返。地址栏不会更新，只要浏览器知道它只收到一个文档。Server.Transfer 还保留执行上下文，因此脚本“继续运行”而不是“重新开始”。
*   PostbackURL 确保 HTTP 请求，导致可能不同的 URL，当然会产生网络延迟成本。

通常，当您尝试“在两者之间做出决定”时，这意味着您最好使用 PostbackURL。

随意扩展您的具体问题，我们可以查看您的确切需求。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-15T19:34:18.490

这是两者之间的一个很好的细分：

[Server.Transfer 与 Response.Redirect](http://www.developer.com/net/asp/article.php/3299641)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T19:29:52.837

Server.Transfer 完全由服务器完成。Postback 是从客户端发起的，用于发布表单内容，并且 postback url 标识要发布到的页面。

也许您打算与 Response.Redirect 进行比较，后者会强制客户端提交新 url 的新请求。

# c# - 什么是 C# 文档标签？

> ID：65969
> 
> 赞同：35
> 
> 时间：2008-09-15T19:29:37.660
> 
> 标签：c#, xml, documentation

在 C# 文档标签中，您可以生成类似于 MSDN 的输出。在类、方法和属性上方的 ///（三斜杠）注释区域内允许使用的标签列表是什么？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-15T19:34:58.987

如果您在方法或类的上方键入此内容，智能感知应提示您提供可用标签列表：

```
/// < 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-15T19:47:45.277

这是一个列表：

*   概括
*   参数
*   返回
*   例子
*   代码
*   看
*   也可以看看
*   列表
*   价值
*   文件
*   版权

这是一个例子：

```
<文件>
<copyright>(c) Extreme Designers Inc. 2008.</copyright>
<datecreated>2008-09-15</datecreated>
<摘要>
这是我的总结
</总结>
<备注>
<para><see cref="TextReader"/> 可以通过以下方式使用：</para>
<list type="数字">
<item>第一项</item>
<item>第二项</item>
</列表>
</备注>
<示例>
<代码>
System.Console.WriteLine("Hello, World");
</代码>
</示例>
<param name="aParam">我的第一个参数</param>
<returns>代表摘要的对象</returns>
</文件>

```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-15T19:31:37.950

查看[有关各种 C# XML 文档标签的优秀文档。](http://web.archive.org/web/20100118163744/http://thoughtpad.net/alan-dean/cs-xml-documentation.html)（转到底部查看标签）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-15T19:31:13.740

2002 年的 MSDN 文章详细介绍了所有标签以及何时使用它们：

[http://msdn.microsoft.com/en-us/magazine/cc302121.aspx](http://msdn.microsoft.com/en-us/magazine/cc302121.aspx)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-15T19:33:30.350

[GhostDoc](http://www.roland-weigelt.de/ghostdoc/)通过为您的方法/类创建存根注释来提供帮助。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-15T19:31:50.400

[请参阅此处](http://msdn.microsoft.com/en-us/magazine/cc302121.aspx)的出色 MSDN 文章作为您的第一站。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-15T19:52:39.007

查看[Sandcastle](http://blogs.msdn.com/sandcastle/)的文档。这是 .NET 的新文档标准。

# php - 在不使用 shuffle() 函数的情况下，在 PHP 中随机化数组顺序的最佳方法是什么？

> ID：65970
> 
> 赞同：3
> 
> 时间：2008-09-15T19:29:37.817
> 
> 标签：php, arrays, random

我在一次工作面试中被问到这个问题。面试官和我不同意正确答案是什么。我想知道是否有人有这方面的任何数据。

更新：我应该提到 shuffle() 的使用是严格禁止的......对不起。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-15T19:30:10.887

```
shuffle($arr); 
```

:)

编辑：我应该澄清......我对最佳的定义不仅涉及算法效率，还涉及代码的可读性和可维护性。使用标准库函数意味着维护更少的代码并减少阅读量。除此之外，您可以与博士教授就最佳“真正随机”函数进行长达一年的辩论，因此总会有人在随机化问题上不同意您的观点。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-15T20:49:34.190

那么这是我想出的解决方案：

```
function randomize_array_1($array_to_randomize) {
    $new_array = array();
    while (count($array_to_randomize) > 0) {
        $rand_num = rand(0, count($array_to_randomize)-1);
        $extracted = array_splice($array_to_randomize, $rand_num, 1);
        $new_array[] = $extracted[0];
    }
    return $new_array;
} 
```

这是他的解决方案：

```
function randomize_array_2($array_to_randomize) {
    usort($array_to_randomize, "rand_sort");
    return $array_to_randomize;
}
function rand_sort($a, $b) {
    return rand(-1, 1);
} 
```

我对这两种方法都进行了一系列试验（每个试验 1,000,000 次），速度差异可以忽略不计。然而，在检查结果的实际随机性后，我对分布的不同感到惊讶。这是我的结果：

```
randomize_array_1:
    [2, 3, 1] => 166855
    [2, 1, 3] => 166692
    [1, 2, 3] => 166690
    [3, 1, 2] => 166396
    [3, 2, 1] => 166629
    [1, 3, 2] => 166738

randomize_array_2:
    [1, 3, 2] => 147781
    [3, 1, 2] => 73972
    [3, 2, 1] => 445004
    [1, 2, 3] => 259406
    [2, 3, 1] => 49222
    [2, 1, 3] => 24615 
```

如您所见，第一种方法提供了几乎完美的分布，表明它或多或少是真正随机的，而第二种方法则无处不在。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-15T20:32:26.290

您可以使用[Fisher-Yates shuffle](http://en.wikipedia.org/wiki/Knuth_shuffle)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T20:44:30.427

他可能正在测试您在大多数人在实施洗牌算法时犯的一个相对常见的错误（这实际上也是几年前涉及在线扑克网站的[争议的中心）](http://itmanagement.earthweb.com/entdev/article.php/11070_616221_2)

不正确的洗牌方式：

`for (i is 1 to n) Swap i with random position between 1 and n`

正确的洗牌方式：

`for (i is 1 to n) Swap i with random position between i and n`

画出这些情况的概率分布，很容易看出为什么第一个解决方案不正确。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T19:37:15.160

“正确”的方式非常模糊。对数组进行排序的最佳（最快/最简单/最优雅）将是仅使用内置的 shuffle() 函数。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-15T20:08:21.780

PHP 有一个内置函数 --> shuffle() 。我会说这应该做你喜欢的事情，但它很可能不会完全“随机”。

查看[http://computer.howstuffworks.com/question697.htm](http://computer.howstuffworks.com/question697.htm)了解为什么它非常非常难以从计算机中获得完全随机性。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-15T20:35:49.793

简答：PHP的`array_rand()`函数

鉴于禁止使用 shuffle 函数，我将使用以随机顺序`$keys = array_rand($myArray, count($myArray))`返回一个键数组。`$myArray`从那里可以很容易地将它们重新组装成一个随机的新数组。就像是：

```
$keys = array_rand($myArray, count($myArray));
$newArray = array();

foreach ($keys as $key) {
$newArray[$key] = $myArray[$key];
} 
```

# php - 在 php 上生成报告？

> ID：65976
> 
> 赞同：0
> 
> 时间：2008-09-15T19:29:57.783
> 
> 标签：php, reporting

我收到的最常见的请求之一是为 YZ App 创建 XY 报告。这些应用程序通常是基于 PHP 构建的，到目前为止，我已经手动创建了大部分此类报告，虽然我喜欢按照自己的意愿构建它，但计算小计、平均值、导出到不同格式等通常变得相当乏味。

有哪些解决方案（首选免费/OSS）可以帮助我完成这些重复性任务？

编辑：

*   我说的是来自 SQL 数据的报告/摘要。很多时候来自不是为报告用途而设计的数据库。
*   虽然我知道“商业智能”，但我们还没有准备好实施全面的“智能”结构，更多的是寻找各种帮手......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T21:38:06.890

您面临的问题由所谓的商业智能软件解决。该软件往往臃肿且昂贵，但如果您了解它们的方法，您将能够立即制作此类报告。

我只熟悉一种特定的专有解决方案，它也不是很好。但是快速搜索会出现以下页面，其中列出了许多免费/开源替代方案：

[http://en.wikipedia.org/wiki/Business_intelligence_tools](http://en.wikipedia.org/wiki/Business_intelligence_tools)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-15T20:06:04.687

这取决于你在谈论什么样的报告。例如...网站统计...您可以安装谷歌分析，客户端可以导出他们想要的任何格式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T20:20:53.980

一点谷歌搜索给了我以下 OSS：

> 资源库
> 
> > [http://rlib.sicompos.com/](http://rlib.sicompos.com/)
> 
> 下午报告
> 
> > [http://www.hotscripts.com/Detailed/48187.html](http://www.hotscripts.com/Detailed/48187.html)

我没有关于他们的任何信息，抱歉。

# .net - 有人知道框架中已经内置的代表列表吗？

> ID：65990
> 
> 赞同：6
> 
> 时间：2008-09-15T19:31:42.037
> 
> 标签：.net

我发现自己偶尔会为非常简单的函数编写委托（例如不带参数并返回 void），我想知道是否有人知道某个地方已经编译了 .NET 框架中已经可用的所有预定义委托的列表，以便我可以重用它们？

要清楚，我正在寻找这样的东西：

*   无效 System.AsyncCallback(System.IAsyncResult)
*   int System.Comparison(T x, T y)
*   无效 System.IO.ErrorEventHandler（对象，System.Io.ErrorEventArgs）

等等

如果没有，听起来像是一篇博客文章的好主意。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-15T19:44:23.443

只需在 msdn 数据库中查找 (T) 委托。

在这里你有一个直接的链接：[代表名单](http://social.msdn.microsoft.com/Search/en-us/?Query=(T)%20delegate)

那应该让你开始。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-15T19:43:56.517

我以前在[这里](http://kentb.blogspot.com/2008/01/consolidating-delegates-with-reflector.html)写过这些内容。基本上，我描述了如何使用 Reflector 找到现有的委托来满足您的需求。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-15T20:07:39.127

要记住的一件事是，您编写的代码可供未来的编码人员阅读，包括您未来的自己。即使您可以在框架中找到具有正确签名的内置委托，如果它掩盖了代码的目的，使用该委托并不总是正确的。

六个月后，*BondMaturationAction*类型的委托的使用将比 Action 类型的委托更清晰，即使签名相同。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T20:00:59.347

只需将 Action、Action<T>、Action<T1,T2,..> 委托用于不返回任何内容 (void) 的方法，或 Func<TResult>, Func<T, TResult>, Func<T1, ... , TResult> 代表返回 TResult 的方法。

这些代表是 .net 3.5 中的新代表。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T22:35:35.217

在 .NET 2.0 及更高版本中，如果您根本没有参数，请使用 EventHandler，如果您想提供一些自定义数据，请使用 EventHandler<T>（您需要从 EventArgs 派生一个类，其中包含您的附加数据）。如果您没有要使用的 EventArgs，请传递 EventArgs.Empty。

因为 EventArgs 是一种引用类型，所以 EventHandler<T> 的所有实例都使用相同的 JITted 代码。

# perl - 从文件中提取版本字符串的最佳方法是什么？

> ID：65994
> 
> 赞同：1
> 
> 时间：2008-09-15T19:31:51.540
> 
> 标签：perl, bash, scripting

我想使用一个文件来存储一个客户软件的当前版本号，启动脚本可以使用该文件在正确的目录中运行二进制文件。

例如，如果运行目录如下所示：

```
.
..
1.2.1
1.2.2
1.3.0
run.sh
current_version 
```

current_version 包含：

```
1.2.2 
```

我想`run.sh`降到 1.2.2 并运行程序`foo`。

目前的解决方案是这样的：

```
#!/bin/sh
version = `cat current_version`
cd $version
./foo 
```

它可以工作，但不是很健壮。它不检查文件是否存在，不能处理多行、前导空格、注释行、空白文件等。

使用 shell 或 perl 脚本执行此操作的最可行的方法是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-15T19:38:40.307

这是一种常见的做法。您可以使用测试运算符检查目录/文件是否存在，例如“if [ -d "somedirectory" ]; then" 或 [ -t "somefile" ]

不过，我更经常使用符号链接。然后，您可以更改符号链接以使用您想要的版本。

例如，

```
$ ln -s 1.2.2 当前版本
$ ls -al
共 20 个
drwxr-xr-x 5 dbreese dbreese 4096 2008-09-15 13:34。
drwxr-xr-x 3 dbreese dbreese 4096 2008-09-15 13:34 ..
drwxr-xr-x 2 dbreese dbreese 4096 2008-09-15 13:34 1.2.1
drwxr-xr-x 2 dbreese dbreese 4096 2008-09-15 13:34 1.2.2
drwxr-xr-x 2 dbreese dbreese 4096 2008-09-15 13:34 1.3.0
lrwxrwxrwx 1 dbreese dbreese 6 2008-09-15 13:34 current_version -> 1.2.2/

```

然后你的脚本可以只使用“cd current_version”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T14:02:55.313

关于什么：

```
#!/usr/bin/perl -w
use strict;
use warnings;

my $version_file = 'current_version';
open my $fh, '<', $version_file or die "Can't open $version_file: $!";

# Read version from file
my $version = <$fh>;
chomp $version;

# Remove whitespace (and match version)
die "Version format not recognized" if $version !~ m/(\d+\.\d+\.\d+)/;

my $dir = $1;
die "Directory not found: $dir" unless -d $dir;

# Execute program in versioned directory.
chdir $dir;
system("./foo"); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T19:39:38.587

我会更改脚本以接受参数。参数应该是一个文件名。使用您喜欢的任何脚本语言 [perl, python] 打开文件并遍历文件，直到找到与您的版本匹配的文件。

我会使用正则表达式...类似于 /\d\.\d\.\d/ 的东西。然后让它通过您的脚本执行应用程序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T19:40:31.330

您可以使用 && 和 || 检查是否存在 运营商：

```
!$/bin/sh
版本 = `cat current_version`
cd $版本 && ./foo || echo "坏版本"

```

&& 运算符使第二个语句仅在第一个语句成功（退出状态 0）时执行，而 || 运算符仅在第一个语句失败（退出状态非零）时才执行第二个语句。

我不确定您处理多行、前导空格或注释行是什么意思。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T19:44:17.467

如果版本控制将始终采用 #.#.# 格式，您可以这样做：

```
ls | grep ^[0-9]\.[0-9]\.[0-9]$ | sort -nr | head -n 1 
```

这将按数字降序列出版本，然后选择其中的第一个

* * *

## 回答 #6

> 赞同：-4
> 
> 时间：2008-09-15T19:40:51.797

```
!#/bin/sh

if [ -e 'current_version' ]; then
    version=`cat current_version`;
    version=`echo $version | tr -ds [[:blank:]]`
    if [ -n "$version" ]; then
      if [ -d "$version" ]; then
         cd "$version"
      else
         echo $version is not a directory
      fi
    else
      echo version_file contained only blanks
    fi
else 
   No file named current_version exists
fi 
```

# graphics - 同时支持 DirectX 9 和 10 的应用程序

> ID：65998
> 
> 赞同：3
> 
> 时间：2008-09-15T19:32:17.573
> 
> 标签：graphics, directx, compatibility

对于任何图形程序员，我都有一个愚蠢的问题。

我很困惑某些游戏（如孤岛危机）如何同时支持 DirectX 9（在 XP 中）和 10（在 Vista 中）？

到目前为止我的理解是，如果你写一个 DX10 应用程序，那么它只能在 Vista 中运行。

也许他们有 2 个代码库——一个用 DX9 编写，另一个用 DX10 编写？但这不是矫枉过正吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-15T19:35:56.177

他们有两个渲染管道，一个使用 DX9 调用，一个使用 DX10 调用。这些 API 不兼容，尽管任何游戏引擎的大部分都可以重用。如果您想要一些关于如何完成不同渲染管道的开源示例，请查看 Ogre3d 之类的东西，它支持 OpenGL、DX9 和（很快）DX10 渲染。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-15T20:21:09.203

游戏的渲染层通常是整个应用程序中一个相当隔离/抽象的部分。就游戏引擎而言，每一帧都只是建立一个概念对象（树、角色等）的列表。如果游戏引擎选择渲染特定对象，则取决于渲染层如何将该意图实际转换为 DX 绘制调用。DX10 渲染将生成一组不同的对 DX9 图层的绘制调用，但从概念上讲，它们仍在执行相同的操作 - “渲染这棵树”。

渲染被很好地抽象了，因为您很少想从渲染层获取任何信息，一旦执行“渲染这棵树”操作，游戏引擎将假设渲染看起来正确。几乎不需要处理来自 DX9/DX10 渲染调用的不同潜在结果，因为 99.9% 的信息是从引擎传递到图形系统的，而返回的 0.1% 可能在两个 API 之间采用相同的形式。

应用程序设置有点棘手，因为您必须询问系统是否支持 DX10，否则优雅地回退到 DX9，但这是应用程序设置的标准费用（与游戏必须选择分辨率、刷新率、输入设备等）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T19:37:59.747

他们很可能有一个抽象层，并针对它进行开发。在运行时，它们会实例化 DX9 或 DX10 包裹混凝土引擎。

我想他们的抽象定位非常接近 DirectX 层，并且简单地为 DX9 提供 DX10 功能的合理手动实现，或者在 DX10 上运行时增强 DX9 逻辑。*******************