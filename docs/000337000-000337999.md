# StackOverflow 问答 000337000-000337999

# c# - 如何为静态变量分配内存？

> ID：337019
> 
> 赞同：50
> 
> 时间：2008-12-03T13:01:55.917
> 
> 标签：c#, .net, memory-management

在下面的程序中：

```
class Main
{   
    static string staticVariable = "Static Variable";
    string instanceVariable = "Instance Variable";

    public Main(){}   
} 
```

将`instanceVariable`存储在为对象实例分配的内存中。将存储在哪里`staticVariable`，是存储在对象实例本身还是其他地方？如果它存储在其他地方，内存位置是如何连接的？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-03T13:08:42.207

静态变量的内存通常保存在一些有根（和隐藏）的地方`object[]`。可以看到在 WinDbg（使用 SOS）中对对象执行 !gcroot 操作。

补充一点，这些引用永远不能被 GC 处理（除非你将该字段设为空），正如我最近发现的那样。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-12-03T13:12:50.153

例如，在 C++ 中，静态变量与全局变量一起分配在全局内存空间中。编译器使用特殊的命名约定来知道该变量属于该类。

# wpf - 如何检测损坏的 WPF 数据绑定？

> ID：337023
> 
> 赞同：73
> 
> 时间：2008-12-03T13:04:22.137
> 
> 标签：wpf, data-binding

在尝试回答“[单元测试 WPF 绑定](https://stackoverflow.com/questions/331215/unit-test-wpf-bindings)”附近的一个问题时，我遇到了以下琐碎的问题。
**如果您的 WPF 数据绑定布线设置不正确（或者您只是破坏了正确连接的东西），最好的方法是什么?**

尽管单元测试方法似乎就像 Joel 的“扯掉你的手臂以去除碎片”。我正在四处寻找更简单、更少开销的方法来检测这一点。

每个人似乎都致力于使用 WPF 在很大程度上进行数据绑定。它确实有其优点。

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2008-12-05T08:35:39.120

在 .NET 3.5 中，引入了一种专门输出有关特定数据绑定的跟踪信息的新方法。

这是通过新的**System.Diagnostics.PresentationTraceSources.TraceLevel**附加属性完成的，您可以将其应用于任何绑定或数据提供者。这是一个例子：

```
<Window x:Class="WpfApplication1.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:diag="clr-namespace:System.Diagnostics;assembly=WindowsBase"
    Title="Debug Binding Sample"
    Height="300"
    Width="300">
    <StackPanel>
        <TextBox Name="txtInput" />
        <Label>
            <Label.Content>
                <Binding ElementName="txtInput"
                         Path="Text"
                         diag:PresentationTraceSources.TraceLevel="High" />
            </Label.Content>
        </Label>
    </StackPanel>
</Window> 
```

这将把特定绑定的跟踪信息放在 Visual Studio 的输出窗口中，而不需要任何跟踪配置。

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2008-12-03T13:05:51.870

我能找到的最好的...

## [如何调试 WPF 绑定？比阿特丽斯·斯托尔尼茨](https://web.archive.org/web/20151215181325/http://www.zagstudio.com/blog/486)

因为每个人都不能总是盯着输出窗口寻找绑定错误，所以我喜欢 Option#2。将其添加到您的 App.Config

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
  <system.diagnostics>
    <sources>
      <source name="System.Windows.Data" switchName="SourceSwitch" >
        <listeners>
          <add name="textListener" />
        </listeners>
      </source>

    </sources>
      <switches>
        <add name="SourceSwitch" value="All" />
      </switches>

      <sharedListeners>
        <add name="textListener"
        type="System.Diagnostics.TextWriterTraceListener"
        initializeData="GraveOfBindErrors.txt" />
      </sharedListeners>

      <trace autoflush="true" indentsize="4"></trace>

  </system.diagnostics>
</configuration> 
```

将其与一个好的正则表达式扫描脚本配对以提取相关信息，您可以偶尔在输出文件夹中的 GraveOfBindErrors.txt 上运行这些信息

```
System.Windows.Data Error: 35 : BindingExpression path error: 'MyProperty' property not found on 'object' ''MyWindow' (Name='')'. BindingExpression:Path=MyProperty; DataItem='MyWindow' (Name=''); target element is 'TextBox' (Name='txtValue2'); target property is 'Text' (type 'String') 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-07-24T13:41:30.993

我使用此处提供的解决方案将绑定错误转换为本地异常：[http ://www.jasonbock.net/jb/Default.aspx?blog=entry.0f221e047de740ee90722b248933a28d](http://www.jasonbock.net/jb/Default.aspx?blog=entry.0f221e047de740ee90722b248933a28d)

但是，WPF 绑定中的正常情况是在用户输入无法转换为目标类型的情况下引发异常（例如，绑定到整数字段的 TextBox；非数字字符串的输入会导致 FormatException，输入太大的数字会导致 OverflowException）。类似的情况是源属性的 Setter 抛出异常。

处理此问题的 WPF 方法是通过 ValidatesOnExceptions=true 和 ValidationExceptionRule 向用户发出所提供的输入不正确的信号（使用异常消息）。

但是，这些异常也会发送到输出窗口，因此被 BindingListener“捕获”，从而导致错误……显然不是您想要的行为。

因此，我将`BindingListener`类扩展为在这些情况下不抛出异常：

```
private static readonly IList<string> m_MessagesToIgnore =
        new List<String>()
        {
            //Windows.Data.Error 7
            //Binding transfer from target to source failed because of an exception
            //Normal WPF Scenario, requires ValidatesOnExceptions / ExceptionValidationRule
            //To cope with these kind of errors
            "ConvertBack cannot convert value",

            //Windows.Data.Error 8
            //Binding transfer from target to source failed because of an exception
            //Normal WPF Scenario, requires ValidatesOnExceptions / ExceptionValidationRule
            //To cope with these kind of errors
            "Cannot save value from target back to source"  
        }; 
```

*public override void WriteLine(string message)*中的修改行：

```
 ....
        if (this.InformationPropertyCount == 0)
        {
            //Only treat message as an exception if it is not to be ignored
            if (!m_MessagesToIgnore.Any(
                x => this.Message.StartsWith(x, StringComparison.InvariantCultureIgnoreCase)))
            {
                PresentationTraceSources.DataBindingSource.Listeners.Remove(this);

                throw new BindingException(this.Message,
                    new BindingExceptionInformation(this.Callstack,
                        System.DateTime.Parse(this.DateTime),
                        this.LogicalOperationStack, int.Parse(this.ProcessId),
                        int.Parse(this.ThreadId), long.Parse(this.Timestamp)));
            }
            else
            {
                //Ignore message, reset values
                this.IsFirstWrite = true;
                this.DetermineInformationPropertyCount();
            }
        }
    } 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2013-12-28T00:37:09.867

您可以使用 WPF Inspector 的触发调试功能。只需从 codeplex 下载该工具并将其附加到您正在运行的应用程序中。它还在窗口底部显示绑定错误。非常有用的工具！

![在此处输入图像描述](https://i.stack.imgur.com/Xfeoa.png)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-23T10:12:42.750

这是一种有效调试/跟踪触发器的有用技术。它允许您记录所有触发操作以及被操作的元素：

[http://www.wpfmentor.com/2009/01/how-to-debug-triggers-using-trigger.html](http://www.wpfmentor.com/2009/01/how-to-debug-triggers-using-trigger.html)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-03-29T15:04:25.890

这对我们非常有帮助，但我想向那些觉得这很有用的人补充一点，微软提供了一个实用程序来读取这个文件。

在这里找到：http: [//msdn.microsoft.com/en-us/library/ms732023.aspx](http://msdn.microsoft.com/en-us/library/ms732023.aspx)

> 打开跟踪文件
> 
> 1\. 使用命令窗口启动 Service Trace Viewer，导航到 WCF 安装位置 (C:\Program Files\Microsoft SDKs\Windows\v6.0\Bin)，然后键入 SvcTraceViewer.exe。（尽管我们在 \v7.0\Bin 中找到了我们的）
> 
> 注意：服务跟踪查看器工具可以与两种文件类型相关联：.svclog 和 .stvproj。您可以在命令行中使用两个参数来注册和取消注册文件扩展名。
> 
> /register：注册文件扩展名“.svclog”和“.stvproj”与SvcTraceViewer.exe的关联
> 
> /unregister：取消注册文件扩展名“.svclog”和“.stvproj”与 SvcTraceViewer.exe 的关联
> 
> 1.Service Trace Viewer 启动时，单击文件，然后指向打开。导航到存储跟踪文件的位置。
> 
> 2.双击要打开的跟踪文件。
> 
> 注意：按住 SHIFT 的同时单击多个跟踪文件可以同时选择并打开它们。服务跟踪查看器合并所有文件的内容并呈现一个视图。例如，您可以打开客户端和服务的跟踪文件。当您在配置中启用消息记录和活动传播时，这很有用。通过这种方式，您可以检查客户端和服务之间的消息交换。您还可以将多个文件拖到查看器中，或使用“项目”选项卡。有关更多详细信息，请参阅管理项目部分。
> 
> 3\. 要将其他跟踪文件添加到打开的集合中，请单击文件，然后指向添加。在打开的窗口中，导航到跟踪文件的位置并双击要添加的文件。

此外，对于日志文件的过滤，我们发现这些链接非常有用：

[http://msdn.microsoft.com/en-us/library/ms751526.aspx](http://msdn.microsoft.com/en-us/library/ms751526.aspx)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-05-15T09:40:08.720

对于像我这样正在寻找一种在给定跟踪级别启用所有 WPF 跟踪的纯编程方式的人，这里有一段代码可以做到这一点。作为参考，它基于这篇文章：[Trace sources in WPF](http://blogs.msdn.com/b/mikehillberg/archive/2006/09/14/wpftracesources.aspx)。

它不需要更改 app.config 文件，也不需要更改注册表。

这就是我在某些启动位置（应用程序等）中使用它的方式：

```
....
#if DEBUG
    WpfUtilities.SetTracing();
#endif
.... 
```

这是实用程序代码（默认情况下，它会将所有警告发送到默认跟踪侦听器）：

```
public static void SetTracing()
{
    SetTracing(SourceLevels.Warning, null);
}

public static void SetTracing(SourceLevels levels, TraceListener listener)
{
    if (listener == null)
    {
        listener = new DefaultTraceListener();
    }

    // enable WPF tracing
    PresentationTraceSources.Refresh();

    // enable all WPF Trace sources (change this if you only want DataBindingSource)
    foreach (PropertyInfo pi in typeof(PresentationTraceSources).GetProperties(BindingFlags.Static | BindingFlags.Public))
    {
        if (typeof(TraceSource).IsAssignableFrom(pi.PropertyType))
        {
            TraceSource ts = (TraceSource)pi.GetValue(null, null);
            ts.Listeners.Add(listener);
            ts.Switch.Level = levels;
        }
    }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-03-18T11:24:50.293

**我在 2021 年的建议：**

## 最好的方法是使用`Benoit Blanchon`Nuget 的小型库

他的原始帖子在这里：[https ://stackoverflow.com/a/19610384/6296708](https://stackoverflow.com/a/19610384/6296708)

他的 GitHub 链接以及有关如何使用它的更多信息 + Nuget 命令：[https ://github.com/bblanchon/WpfBindingErrors](https://github.com/bblanchon/WpfBindingErrors)

它的特点（直到现在！）：

*   绑定错误时抛出异常（+行号）
*   如果源变量抛出任何异常，该库将捕获并显示它。
*   单元测试也支持！

快乐编码！

# svn - 如何从包含多个项目的 SVN 存储库中转储一个项目？

> ID：337024
> 
> 赞同：42
> 
> 时间：2008-12-03T13:04:59.593
> 
> 标签：svn, svnadmin, svndump, svndumpfilter

我正在使用包含许多项目的 SVN 存储库。我需要将一些项目从该存储库中移出到单独的存储库中，每个项目一个，保留历史记录。

我已经能够使用`svnadmin dump`转储整个存储库并将`svnadmin load`其转储到另一个存储库中，但是我找不到一种仅从原始存储库中转储一个项目的方法，因此我可以将其加载到新存储库中。这可能吗？如果有怎么办？

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2008-12-03T13:33:28.380

您可以使用[svndumpfilter](http://svnbook.red-bean.com/en/1.8/svn.reposadmin.maint.html#svn.reposadmin.maint.tk.svndumpfilter)实用程序来执行此操作。SVN 书[很好地解释](http://svnbook.red-bean.com/en/1.8/svn.reposadmin.maint.html#svn.reposadmin.maint.filtering)了如何做到这一点。

例如，一种方法是：

```
 $ svnadmin dump /path/to/repo 
     | svndumpfilter include /proj > dump-file
$ svnadmin create /new/proj/repo
$ svnadmin load --ignore-uuid /new/proj/repo < dump-file
$ svn rm file:///path/to/repo/proj 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-10-20T14:48:11.503

只是对@Avi 答案和@Kit 评论的一个小补充。

如果您使用，您可能会丢失加载存储库（ [source](http://www.celticwolf.com/blog/2010/05/03/subversion-svnadmin-load-error-file-not-found-transaction-0-1-path/comment-page-1/)`svndumpfilter` ）所需的提交。

就我而言：

```
cat dump | svndumpfilter --drop-empty-revs --renumber-revs include trunk/project > project.dump 
svnadmin load --ignore-uuid /opt/svn/newlocation < project.dump
<<< Started new transaction, based on original revision 1 
svnadmin: File not found: transaction '0-0', path 'trunk/project' 
```

解决方案是先提交上层目录`trunk`。

# javascript - 使用 Ajax 和 JSP 实现论坛实时视图

> ID：337028
> 
> 赞同：0
> 
> 时间：2008-12-03T13:06:13.617
> 
> 标签：javascript, html, ajax, jsp, forum

我正在开始一个个人项目，所以我目前拥有完整的建筑/设计控制权。我现在只是在计划结构。我的目标是某种网络论坛，聊天的东西。不同之处在于它应该实时更新，新帖子在客户端视图上会在它们到达服务器后不久增长。

我认为使用 ajax 和 jquery 下载已查看线程的新帖子（来自 tomcat 服务器），这些帖子将是一些小的 XML 结构，在客户端编译成一个不错的帖子。这有望降低我的带宽成本。带宽是我最关心的问题。我担心有几个用户使用 javascript 线程每十秒轮询一次服务器会导致对我的服务器的 http 请求风暴，即使内容很小。

有没有比让每个用户执行轮询更好的方法？我可以用任何必要的结构编写后端，前端也是如此。我想远离 Flash 和 Silverlight。作为一个公共网页，它最终可能会有很多观众（每个网络开发人员的团队）。让每个人都以 30 秒的间隔进行轮询将是一个难以置信的支持数量，而且 30 秒对于“实时取景”来说可能太慢了！我的首选语言是 JSP。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T15:53:15.620

客户端池不是实现“实时视图”的唯一选择。您也应该考虑所谓的“[反向 AJAX](http://en.wikipedia.org/wiki/Reverse_Ajax) ”技术。

此外，您可以使用一些成熟的框架来为您提供开箱即用的功能：[DWR](http://directwebremoting.org/dwr/overview/dwr)甚至[JSF(ice faces)](http://blog.icefaces.org/blojsom/blog/default/2008/04/10/Ajax-Push-Comes-of-Age/)。

# java - 平等比较 - 任何更理智的方式？

> ID：337029
> 
> 赞同：2
> 
> 时间：2008-12-03T13:06:17.047
> 
> 标签：java, comparison

如何实现这种相等比较是一种理智的 java 方式？

```
boolean x = (a == b) || (a.equals(b)) 
```

我想确保两个对象的内容相等，但 null 也可以，即两者都可以为 null，因此相等。

更新：为了清楚起见，我必须多次实施这种比较，并且不想每次都复制和粘贴这些东西，特别是对于长对象名称。使用 'a' 和 'b' 它看起来小而简单，但往往会增长......我想知道我是否缺少一些现有的 Java 功能。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-03T13:18:51.953

您可能想看看总是有用的[Apache Commons Lang](http://commons.apache.org/lang/)，更准确地说是[ObjectUtils.equals()](http://commons.apache.org/lang/api-2.3/org/apache/commons/lang/ObjectUtils.html#equals(java.lang.Object,%20java.lang.Object))。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-03T13:24:51.177

另一种方法

```
boolean x = null==a ? null==b : a.equals(b); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-03T13:10:28.663

如果 a 为 null 但 b 不是，会发生什么？我想你真的想要：

```
boolean x = (a == null && b == null) || (a != null && a.equals(b)) 
```

**编辑：**您可以为该类实现一个静态 NullEquals 方法，该方法采用该类的两个对象并按上述方式进行比较以避免重写并使代码更简洁。

```
public class MyClass {

    public static boolean NullEquals( MyClass a, MyClass b )
    {
         return (a == null && b == null) || (a != null && a.equals(b));
    }
}

if (MyClass.NullEquals(a,b))
{
    ...
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-03T13:15:42.817

典型的模式是：

```
if (a == b)
{
    return true;
}
if (a == null || b == null)
{
    return false;
}
// Now deal with a and b, knowing that they are non-identical, non-null references 
```

是的，它很罗嗦——但如果你把它分成自己的方法，你可以把它放在合理的控制之下。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-03T13:49:15.683

不是直接的答案，但是如果您有很多可以为空或不为空的对象，则可能表明您的代码存在问题。看一下[Null Pattern](http://en.wikipedia.org/wiki/Null_Object_pattern)，这是表示对象不存在的另一种方式

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-04T01:30:31.867

关于什么：

```
boolean x = equals( a, b );

public static boolean equals( Object a, Object b ) {
    if ( a == null && a == b ) {
        return true;
    } else {
        return a == b || a.equals( b );
    }
} 
```

让我看看。

*   如果 a 为空且 a 为 b 则没关系
*   如果 a 不为空，则如果 a == b（相同的 ref）通过短路返回 true
*   如果 a 不是 b （OR 的 2dns 部分可能 b 为 null ）则返回 a （不为 null ） .equals( b ) 无论 b 是什么

是的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-03T14:54:02.463

最常见的做法是：

```
a==null ? b==null : a.equals(b) 
```

一个可能稍微更有效但不太清晰的表达式是：

```
a==b || (a!=null && a.equals(b)) 
```

你当然可以把它放在一个方法中：

```
public static boolean eq(Object a, Object b) {
     return a==b || (a!=null && a.equals(b));
} 
```

如果 a 为空且 b 为非空，请注意原始问题代码 NPE。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-03T13:57:04.543

无法添加评论，将此视为对[Jon Skeet](https://stackoverflow.com/users/22656/jon-skeet)答案的评论。

在 Java 中 Null = Null 是真还是假。

更具体地说，什么应该是 Null = Null 应该被处理，以及不同的语言如何以及为什么处理这种情况？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-04T01:07:55.827

出于性能原因，通常最好在执行任何其他逻辑之前检查身份，就像问题中所做的那样。但是，许多答案都没有考虑到这一点。

进行身份检查的最佳位置是在`equals`您的类上实现该方法：

```
public boolean equals(Object obj) {
  if(this == obj) return true;
  ...
} 
```

如果这已经/可以做到，您可以轻松进行比较：

```
a == null ? b == null : a.equals(b); 
```

否则，您可能必须自己检查身份：

```
a == null ? b == null : (a == b || a.equals(b)); 
```

# mysql - MySQL：“where 子句中的列‘column_name’不明确”

> ID：337034
> 
> 赞同：3
> 
> 时间：2008-12-03T13:09:33.767
> 
> 标签：mysql, mysql-error-1052

我加入 2 张桌子

例如

```
表_A
+---------+-----------+------------+
| 用户 ID | 票号 | 用户名 |
+---------+-----------+------------+

表_B
+------------+-------------+
| 票号 | 票名 |
+------------+-------------+

```

如果我运行以下查询：

```
选择
  table_A.user_id
, table_A.user_name
, table_B.ticket_name
从表_A
LEFT JOIN table_B ON table_B.ticket_id = table_A.ticket_id
WHERE ticket_id = '1';

```

在实时服务器上，我们收到错误：“ `Column 'ticket_id' in where clause is ambiguous`”
在测试服务器上，查询被接受。

*我知道如何解决错误，那不是问题。*

但是，如果我们的测试服务器不接受此查询并且（就像生产服务器一样）抛出错误，我会非常高兴。

有谁知道是否有某种设置会使测试服务器像实时服务器一样抛出错误？

*测试服务器*上的PS
MySQL 版本：*Live 服务器* 上的 MySQL 版本：*`5.0.32-Debian_7etch5-log`
*`5.0.41-community-log`**

 *** * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-03T13:25:21.580

MS SQLServer 也有类似的问题，版本 2000 接受一些不明确的查询，而 2005 会抛出错误。基本上较新的版本似乎更严格。

作为一般规则，您应该在测试服务器和生产服务器上使用相同的数据库版本，以避免这种类型的行为，即一段代码在测试机器上工作并在生产中失败。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-03T13:45:11.570

你的两台服务器是什么[SQL模式？](http://dev.mysql.com/doc/refman/5.0/en/server-sql-mode.html)我可以想象一个比另一个更严格。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T13:51:02.480

我认为 Tomalak 是对的 - MySQL 管理设置中有一个严格模式可以解决您的问题。

我记得您在创建数据库时选择了它，但您可以从管理 GUI 进行调整。

MySQL 目前存在一些重大错误，如果可以的话，您可能需要考虑迁移到 SQL Server Express...

Sun 陷入财务困境，我不确定 MySQL 会如何收场。

# algorithm - 替换嵌套的 if 语句

> ID：337037
> 
> 赞同：34
> 
> 时间：2008-12-03T13:09:55.387
> 
> 标签：algorithm, design-patterns, nested

这与[漂亮代码](https://rads.stackoverflow.com/amzn/click/com/0596510047)中的一章有关。在那一章中，我读到了嵌套`if`的 s。

作者说的是深度嵌套`if`的 s 是 bug 的始作俑者，可读性较差。他正在谈论用语句和[决策表](https://en.wikipedia.org/wiki/Decision_table)`if`替换嵌套的 s 。`case`

任何人都可以说明如何使用( ) 和决策表删除嵌套`if`的 s吗？`case``select case`

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-12-03T13:13:44.380

好吧，因为您专门询问 switch/case 语句，所以不能直接回答您的问题，但这里有一个类似的问题。

[反转“if”语句以减少嵌套](https://stackoverflow.com/questions/268132/invert-if-statement-to-reduce-nesting)

这讨论了用早期返回的保护语句替换嵌套的 if，而不是在确定返回值之前逐步检查越来越多的东西。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-03T13:31:00.430

我总是尝试做的一个例子是替换大量嵌套的 if 是这样的（实际上这个**还不错**，但我已经看到它们在野外达到 8 或 9 层）：

```
if (i == 1) {
    // action 1
} else {
    if (i == 2) {
        // action 2
    } else {
        if (i == 3) {
            // action 3
        } else {
            // action 4
        }
    }
} 
```

有了这个：

```
switch (i) {
    case 1:
        // action 1
        break;
    case 2:
        // action 2
        break;
    case 3:
        // action 3
        break;
    default:
        // action 4
        break;
} 
```

我还尝试使动作尽可能小（函数调用最适合此）以保持 switch 语句的压缩（因此您不必提前四页看到它的结尾）。

我相信，决策表只是设置标志，指​​示以后必须采取哪些行动。“稍后”部分是基于这些标志的操作的简单排序。我可能是错的（这不会是第一次或最后一次:-)。

一个例子是（标志设置阶段可能很复杂，因为它的动作非常简单）：

```
switch (i) {
    case 1:
        outmsg = "no paper";
        genmsg = true;
        mailmsg = true;
        phonemsg = false;
        break;
    case 2:
        outmsg = "no ink";
        genmsg = true;
        mailmsg = true;
        phonemsg = false;
        break;
    default:
        outmsg = "unknown problem";
        genmsg = true;
        mailmsg = true;
        phonemsg = true;
        break;
}

if (genmsg)
    // Send message to screen.
if (mailmsg)
    // Send message to operators email address.
if (phonemsg)
    // Hassle operators mobile phone. 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-03T13:46:19.417

链式ifs怎么样？

代替

```
if (condition1)
{
    do1
}   
else
{
    if (condition2)
    {
        do2
    }
    else (condition3)
    {
        do3;

    }
} 
```

和

```
if (condition1) {
   do1;
} else if (condition2) {
   do2;
} else if (condition3) {
   do3;
} 
```

这很像复杂条件的 switch 语句。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-12-03T13:36:57.190

将条件转换为布尔值，然后为每种情况编写布尔表达式。

如果代码是：

```
if (condition1)
{
    do1
}   
else
{
    if (condition2)
    {
        do2
    }
    else (condition3)
    {
        do3;

    }
} 
```

可以这样写：

```
bool cond1=condition1;
bool cond2=condition2;
bool cond3=condition3;

if (cond1) {do1;}
if (!cond1 and cond2) {do2;}
if (!cond1 and cond3) {do2;} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-03T13:57:52.357

对于决策表，请参阅我对[这个问题](https://stackoverflow.com/questions/6126/how-do-you-handle-huge-if-conditions#14220)的回答，或者最好还是阅读[Code Complete 2](https://rads.stackoverflow.com/amzn/click/com/0735619670)中的第 18 章。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-05-16T11:34:18.673

例如，一旦验证的一部分失败，您就可以中断。

```
function validate(){
  if(b=="" || b==null){
      alert("Please enter your city");
      return false;
  }

  if(a=="" || a==null){
      alert("Please enter your address");
      return false;
  }
  return true;
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-03T14:19:19.210

决策表是您**将条件逻辑存储在数据结构中而不是在代码本身**中的位置。

所以代替这个（使用@Pax的例子）：

```
if (i == 1) {
    // action 1
} else {
    if (i == 2) {
        // action 2
    } else {
        if (i == 3) {
            // action 3
        } else {
            // action 4
        }
    }
} 
```

你做这样的事情：

```
void action1()
{
    // action 1
}

void action2()
{
    // action 2
}

void action3()
{
    // action 3
}

void action4()
{
    // action 4
}

#define NUM_ACTIONS 4

// Create array of function pointers for each allowed value of i
void (*actions[NUM_ACTIONS])() = { NULL, action1, action2, action3 }

// And now in the body of a function somewhere...
if ((i < NUM_ACTIONS) && actions[i])
    actions[i]();
else
    action4(); 
```

如果 的可能性`i`不是低编号整数，那么您可以创建一个查找表，而不是直接访问数组的`i`第 th 个元素。`actions`

当您对几十个可能的值做出决定时，这种技术变得比嵌套`if`的 s 或语句更有用。`switch`

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-03T13:58:28.377

if 和 switch 语句不是纯粹的 OO。它们是条件程序逻辑，但做得非常好！如果您想删除这些语句以获得更多面向对象的方法，[请结合“状态”和“描述符”模式](http://www.lostechies.com/blogs/derickbailey/archive/2008/11/26/ptom-descriptive-state-enumeration.aspx)。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-03T14:15:24.193

您也可以考虑使用[访问者模式](http://en.wikipedia.org/wiki/Visitor_pattern)。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-10-03T10:43:53.783

嵌套 if 等价于逻辑运算符 AND

```
if (condition1)
{
    if (function(2))
    {
        if (condition3)
        {
            // do something
        }
    }
} 
```

等效代码：

```
if (condition1 && function(2) && condition3)
{
    // do something
} 
```

在这两种情况下，当表达式计算结果为 false 时，不会计算后续表达式。例如，如果 condition1 为 false，则不会调用 function()，也不会评估 condition3。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-12-03T13:39:24.173

一些语言允许的另一个例子是这个

```
 switch true{
            case i==0
              //action
            break

            case j==2
             //action
            break

            case i>j
             //action
            break
           } 
```

# java - 多态性无法正常工作

> ID：337038
> 
> 赞同：1
> 
> 时间：2008-12-03T13:10:01.750
> 
> 标签：java

我有一个名为 Dictionary 的接口，它有一个方法`insert()`。这个接口是由类实现的`BSTree`，但我也有一个类`AVLTree`，它是 的子类`BSTree`。`AVLTree`重新定义，`insert()`使其适合它的需要。现在，如果我输入以下代码：

```
Dictionary data=new AVLTree();
data.insert(); 
```

有一个问题，因为`insert()`调用的方法是 of`BSTree`而不是`AVLTree`。为什么这里没有多态性？什么是合适的解决方案，一个保留多态性原则的解决方案？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-03T13:13:58.640

当您说 AVLTree “重新定义”插入时，您到底是什么意思？它必须覆盖该方法，这意味着具有完全相同的签名（模方差）。

你能在 BSTree 和 AVLTree 中发布 insert() 的签名吗？

如果您在 AVLTree 中应用 @Override 批注（假设是最近的 JDK），如果您没有正确的签名，您应该会收到警告/错误。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-03T13:29:23.677

您必须提供更多代码片段。我想它看起来像这样：

```
public Interface Dictionary {
  ...
  public void insert();
  ...
}

public Class BSTree implements Dictionary {
  ...
  public void insert() {
    // some implementation here
  }
  ...
}

public Class AVLTree extends BSTree {
  ...
  public void insert() {
    // another implementation of insert
  }
  ...
} 
```

这实际上应该工作。也许您在某处使用了 private 或 final 修饰符？

问候

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-03T13:30:17.843

已经解决了。在接口 Dictionary 中函数看起来像 insert(Object x)，BSTree 遵循了这一要求，将参数定义为 Object，但在 AVLTree 中，参数是 Comparable 类型，将其更改为 Object 后才起作用。

不管怎么说，还是要谢谢你 ：）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-03T13:20:22.260

在java中，（我说的是相对于C++），多态应该“总是”起作用。不看代码很难看出哪里出了问题。也许你可以发布有趣的部分？比如方法的签名、类声明等。我的猜测是你没有为这两个方法使用相同的签名。

# c# - 在 Visual Studio 2005 中从 WSDL 生成 WebService 生产者

> ID：337049
> 
> 赞同：1
> 
> 时间：2008-12-03T13:12:47.597
> 
> 标签：c#, asp.net, visual-studio, web-services, wsdl

我有一个定义 Web 服务接口的 WSDL 文件，我想使用 C#、ASP.Net 和 Visual Studio 2005 实现该服务（即生产者/服务器代码）。将 Web 引用设置为 Web 服务的消费者是一个微风，但作为制片人并不那么明显。

在 java 世界中有 wsdltojava。有没有类似的东西？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-03T13:40:03.330

就在这里。等待它，它被称为`wsdl.exe`！

该文件位于 Microsoft Windows SDK bin 目录中（对于旧版本的 .NET，.NET SDK 可能位于其他位置）。

# .net - 是否可以将 AJAX 工具包集成到 MVC 应用程序中？

> ID：337058
> 
> 赞同：0
> 
> 时间：2008-12-03T13:16:42.533
> 
> 标签：.net, asp.net-mvc, ajax, toolkit

如何将 AJAX 工具包集成到 .net 中的 MVC 应用程序中？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T13:28:11.763

我不确定您具体指的是哪个工具包，但请看一下 Stephen Walther 的这个。在这里，他使用带有 asp.net MVC 的 Ajax Control 工具包来创建一个自动完成文本字段。

[ASP.NET MVC 技巧 #37](http://weblogs.asp.net/stephenwalther/archive/2008/08/23/asp-net-mvc-tip-37-create-an-auto-complete-text-field.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T13:38:53.987

是的，AJAX 控制工具包应该包含在 Beta 版中！

# version-control - 您如何在生产服务器上的 Web 项目上应用补丁？

> ID：337060
> 
> 赞同：5
> 
> 时间：2008-12-03T13:17:22.953
> 
> 标签：version-control, patch

我们最近有一个项目，我们在客户的服务器上发布了一个大型网络应用程序的测试版。我们的客户要求我们在错误出现时进行修复，我们尝试以同样的方式进行。通常，在我们的原型服务器上构建应用程序要容易得多，因为我只需发出简单的“svn up”命令，这需要一秒钟。

但是在生产环境中，我们没有任何可用的版本控制工具。是否可以自动化修补工作，这样我们就不需要登录到 ftp 并逐个上传每个文件？

以这种方式工作非常困难。当我遇到这个问题时，可以肯定的是，你们中的一些人已经解决了这个问题。请分享您的解决方案。

期待您的回复...非常感谢您阅读。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-03T13:29:16.097

根据服务器上可用的工具，您可以执行`svn diff -r x:y`其中 x 是您上次更新的修订版和 y 您要更新到的最后一个修订版（可能是您的存储库上的最后一个修订版）来生成补丁，然后应用用`patch`命令打补丁。

如果`rsync`在生产平台上可用，并且您可以使用它（例如 ssh），您可以设置生产就绪树，在生产服务器上 rsync 它，当有更新时，svn 更新您的生产树，然后 rsync再说一遍。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T14:30:49.403

是什么阻止您在生产服务器上安装 Subversion 客户端？

[编辑] 所以有人不允许你在服务器上安装你需要的软件。问题是：什么更重要？稳定的生产服务器还是任意策略？如果对方不听争论，请到您的计算机上，启动 MS Word 并写下这封信：

“我特此拒绝对我们生产系统的稳定性承担任何责任，因为 [在此处插入姓名] 拒绝为我配备工具以确保生产系统在安装后包含所有必要的文件和数据。 "

签字，让你的老板签字，然后将副本发送到 [在此处插入姓名]。突然之间，安装后可能出现的任何问题都将出现在他的地盘上。或者说得更清楚一点：他将对你可能犯的任何错误负责。

现在，您所要做的就是等待。:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T13:25:03.577

取决于您使用的编程环境。在 Smalltalk 和[Aida/Web](http://www.aidaweb.si)之类的 Web 应用程序服务器中，我们可以即时升级实时 Web 应用程序，而无需停止它。

服务器连接到选择的 SCM，例如用于 Squeak Smalltalk 的 Monticello 或用于 VisualWorks 的 Store。然后手动或自动将新版本加载到服务器的 Smalltalk 映像中。

# language-agnostic - 何时重新抛出异常，何时返回 FALSE？

> ID：337066
> 
> 赞同：15
> 
> 时间：2008-12-03T13:19:19.847
> 
> 标签：language-agnostic, exception

我正在为与一些特殊硬件接口的第三方函数库开发一个包装器。所以基本上，我想用连接和断开方法将 dll 函数（等）封装`bool Connect()`在`void Disconnect()`MyHardwareObject 中。

dll 中的 Connect 函数可能会引发一些特定的异常，例如当硬件不存在时。对于应用程序来说，连接方法为什么失败的信息被认为是不重要的，因此不需要异常中包含的附加信息。

处理这些异常的最佳方法是什么，返回`false`或将异常留在此处未处理并在本应处理连接方法返回的事实的级别上捕获它`false`？

```
 bool MyHardwareObject.Connect()
{
    try
    {
        ThirdPartyLibrary.Connect();
    }
    catch (SomeException)
    {
        return false;
    }
    return true;
} 
```

相对于

```
 bool MyHardwareObject.Connect() 
{
    ThirdPartyLibrary.Connect();
    return true;
} 
```

（或者在第二种情况下更好`void MyHardwareObject.Connect()`，因为我们要么返回 true，要么抛出异常？）

或者你还会做什么？最重要的是：为什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-03T13:24:13.313

在我看来，第一种情况肯定比第二种情况好。您*希望*您的硬件库以您的用户不必确切知道其中的内容的方式环绕第三方库。
如果除了 true 或 false 之外，您还需要错误处理的更多细节，您可以考虑重新抛出您自己的异常，将第三方库中的异常转换为与您自己的代码更一致的东西。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-03T13:25:39.707

在异常和返回码之间做出明智的选择真的很困难。这取决于很多事情，而在代码库的其余部分中如何处理错误将是最重要的——保持一致。

最近，我更倾向于“如果不值得就不要抛出异常”。我们的异常做了很多工作：它们记录内容、创建堆栈跟踪等。如果我只想将字符串转换为整数，那么在输入字符串的格式错误时抛出异常可能是不值得的。另一方面，如果无法从正确的数据构造对象，我的系统中根本不想要这些对象，在这种情况下，它们的构造函数会抛出异常。

如果代码库的其余部分没有给你任何提示，我喜欢这个经验法则：想象抛出异常会使你的计算机发出响亮的哔哔声。只要你能忍受，投掷就可以了。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-03T13:26:24.200

我会传递例外情况。如果你不这样做，你就是在掩盖以后可能有用的潜在重要信息。我知道您现在没有使用它，但是如果您将来决定根据错误类型以不同方式处理恢复怎么办。此时，您将不得不撤消为屏蔽异常而编写的所有代码。虽然我不同意@MadKeithV 将其设为真/假，但我认为他有一点将异常包装在您自己的异常中，这可能对您的应用程序具有更好的语义。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-12-03T14:37:51.387

阅读：[http ://www.onjava.com/pub/a/onjava/2003/11/19/exceptions.html](http://www.onjava.com/pub/a/onjava/2003/11/19/exceptions.html)

简而言之：

调用者对返回值有什么用吗？它可以恢复还是世界末日的错误？如果这只是一个小问题，请使用返回码。如果各种状态同样频繁地发生（50% 的失败，50% 的工作），请使用返回码，因为调用者无论如何都必须处理这种情况，而异常也无济于事。

您是否要传递其他信息（例如第三方事物的设置，以便有人有机会调试后来发生的事情）？使用例外。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-03T13:40:46.527

我建议第二个。处理异常并根据异常采取正确的行动将是调用者的责任。假设 Connect 抛出 AccountExpiredException、NetworkUnavailableException、InvalidCredentialsException 等（这些只是示例），我可以提示用户“修复”异常（联系管理员，检查网络电缆，检查用户名/密码）。我什至建议删除返回值（指标）并使其无效。看一下 SqlConnection Open 方法-就像您连接一样-它不返回值而是引发异常。像这样吞下异常

```
 bool MyHardwareObject.Connect()
{
    try
    {
        ThirdPartyLibrary.Connect();
    }
    catch (SomeException)
    {
        return false;
    }
    return true;
} 
```

恕我直言，这不是一个好主意。我建议您实施 IDisposable 模式。只是我的2美分。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-03T13:35:24.353

这个第三方库是你的程序运行所必需的，还是只是添加了一些额外的功能，虽然很好，但不是必需的？另外，硬件是否有可能发生故障。最后，硬件可以向您抛出多少类型的异常？

如果您的程序运行实际上不需要该库，则您当然需要在某个时候捕获异常，但您可能希望在更高的位置执行此操作。

如果硬件可以抛出多种类型的异常，那么您更有可能想要重新抛出异常，因为简单地返回一个值会导致您丢失一些信息。但是，您确实说过客户不关心它*为什么*失败，只是它确实发生了，所以这不应该是一个问题。

最后，如果硬件故障是司空见惯的，那么与故障司空见惯的情况相比，您可能更希望返回错误代码（在这种情况下为 false）。

我认为在你的情况下，它真的归结为第一个问题。如果您真的不需要这个库，请返回 false 并确保非常清楚地记录了操作可能由于完全任意的原因而失败，并且他们需要检查返回值。如果您需要它工作，请重新抛出异常并让它传播到您可以优雅退出的任何地方。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-03T13:32:10.147

我相信异常机制背后的原理是“**快速失败**”理论。

如果连接不成功，您是否希望您的客户应用程序“快速失败”？
如果是，只需抛出异常或将异常封装在您自己的应用异常中。

如果客户端忽略该异常，他的应用程序将停止。

返回 false 表示客户端可能会忽略该问题，他的应用程序可能仍会崩溃，但“稍后”...

# nhibernate - (N)Hibernate 中的一级和二级缓存是什么？

> ID：337072
> 
> 赞同：261
> 
> 时间：2008-12-03T13:21:19.997
> 
> 标签：nhibernate, hibernate

谁能用简单的话解释一下 Hibernate/NHibernate 中的一级和二级缓存是什么？

* * *

## 回答 #1

> 赞同：315
> 
> 时间：2008-12-03T13:29:49.433

1.1) 一级缓存

> **一级缓存**始终与**Session 对象**相关联。Hibernate 默认使用这个缓存。在这里，它处理一个又一个事务，意味着不会多次处理一个事务。主要是它减少了在给定事务中需要生成的 SQL 查询的数量。这不是在事务中完成每次修改后更新，而是仅在事务结束时更新事务。

1.2) 二级缓存

> **二级缓存**始终与**会话工厂对象**相关联。在运行事务时，它会在会话工厂级别加载对象，这样这些对象将可用于整个应用程序，而不是绑定到单个用户。由于对象已经加载到缓存中，每当查询返回一个对象时，就不需要去进行数据库事务。这样，二级缓存就起作用了。在这里我们也可以使用查询级缓存。

引自：http: [//javabeat.net/introduction-to-hibernate-caching/](http://javabeat.net/introduction-to-hibernate-caching/)

* * *

## 回答 #2

> 赞同：122
> 
> 时间：2008-12-04T00:38:48.257

[Streamline Logic](https://web.archive.org/web/20160501000000*/http://blog.streamlinelogic.ca/2007/03/nhibernate-cache.html)博客上对一级缓存有很好的解释。

基本上，第一级缓存发生在每个会话的基础上，而第二级缓存可以在多个会话之间共享。

* * *

## 回答 #3

> 赞同：113
> 
> 时间：2014-08-01T04:32:38.023

这里有一些关于休眠缓存的基本解释......

一级缓存与“会话”对象相关联。缓存对象的范围是会话。一旦会话关闭，缓存的对象就永远消失了。一级缓存默认启用，您不能禁用它。当我们第一次查询实体时，它会从数据库中检索并存储在与休眠会话关联的一级缓存中。如果我们用相同的会话对象再次查询相同的对象，它将从缓存中加载，并且不会执行任何 sql 查询。`evict()`可以使用方法从会话中删除加载的实体。如果已使用`evict()`方法删除该实体，则该实体的下一次加载将再次进行数据库调用。可以使用`clear()`方法删除整个会话缓存。它将删除存储在缓存中的所有实体。

二级缓存与一级缓存不同，一级缓存可在会话工厂范围内全局使用。二级缓存在会话工厂范围内创建，可用于使用该特定会话工厂创建的所有会话。这也意味着一旦会话工厂关闭，与之关联的所有缓存都会死掉，缓存管理器也会关闭。每当休眠会话尝试加载实体时，它首先会在第一级缓存中查找实体的缓存副本（与特定休眠会话相关联）。如果实体的缓存副本存在于一级缓存中，则作为 load 方法的结果返回。如果一级缓存中没有缓存实体，则在二级缓存中查找缓存实体。如果二级缓存有缓存实体，则作为 load 方法的结果返回。但，在返回实体之前，它也被存储在一级缓存中，以便下次调用实体的加载方法将从一级缓存本身返回实体，并且不需要再次进入二级缓存。如果在一级缓存和二级缓存中也找不到实体，则执行数据库查询并将实体存储在两个缓存级别中，然后作为响应返回`load()`方法。

* * *

## 回答 #4

> 赞同：36
> 
> 时间：2018-07-12T13:23:07.010

## 一级缓存

Hibernate 尝试将持久性上下文刷新延迟到最后可能的时刻。这种策略传统上被称为事务性后写。

write-behind 与 Hibernate 刷新有关，而不是任何逻辑或物理事务。在事务期间，刷新可能会发生多次。

[![在此处输入图像描述](https://i.stack.imgur.com/UXmRs.png)](https://i.stack.imgur.com/UXmRs.png)

刷新的更改仅对当前数据库事务可见。在提交当前事务之前，其他并发事务看不到任何更改。

由于一级缓存，Hibernate 可以做几处优化：

*   JDBC 语句批处理
*   防止丢失更新异常

## 二级缓存

一个合适的缓存解决方案必须跨越多个 Hibernate 会话，这也是 Hibernate 支持额外的二级缓存的原因。

二级缓存绑定到 SessionFactory 生命周期，所以它只有在`SessionFactory`关闭时才会被销毁（通常是在应用程序关闭时）。二级缓存主要是面向实体的，尽管它也支持可选的查询缓存解决方案。

加载实体时，Hibernate 将执行以下操作：

[![实体负载流](https://i.stack.imgur.com/GJkmR.png)](https://i.stack.imgur.com/GJkmR.png)

1.  如果实体存储在一级缓存中，则返回缓存的对象引用。这确保了应用程序级的可重复读取。
2.  如果实体没有存储在一级缓存中，而二级缓存被激活，那么 Hibernate 会检查实体是否已经缓存在二级缓存中，如果是，则将其返回给调用者。
3.  否则，如果实体没有存储在一级或二级缓存中，它将从数据库中加载。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-04-27T13:02:28.313

默认情况下，NHibernate 使用基于会话对象的第一级缓存。但是如果您在多服务器环境中运行，那么一级缓存可能不是非常具有可扩展性以及一些性能问题。发生这种情况是因为它必须非常频繁地访问数据库，因为数据分布在多个服务器上。换句话说，NHibernate 提供了一个开箱即用的基本的、不那么复杂的进程内 L1 缓存。但是，它不提供缓存解决方案必须具备的特性才能对应用程序性能产生显着影响。

所以所有这些问题的问题是使用与会话工厂对象相关联的 L2 缓存。它减少了耗时的数据库访问，因此最终增加了应用程序的响应时间。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2017-10-31T17:42:49.503

一级缓存

Session 对象持有一级缓存数据。默认情况下启用。一级缓存数据不会对整个应用程序可用。一个应用程序可以使用许多会话对象。

二级缓存

SessionFactory 对象保存二级缓存数据。存储在二级缓存中的数据将可供整个应用程序使用。但是我们需要明确地启用它。

* * *

## 回答 #7

> 赞同：-4
> 
> 时间：2014-05-16T06:11:07.720

在二级缓存中，域 hbm 文件的键可以是可变的，而值为 false。例如，在这个领域类中，一天中的某些持续时间作为普遍真理保持不变。因此，它可以被标记为跨应用程序不可变。

# c# - 我可以找出我正在使用的方法的名称吗？

> ID：337087
> 
> 赞同：3
> 
> 时间：2008-12-03T13:26:29.393
> 
> 标签：c#, oop, reflection

说我有一些代码

```
namespace Portal
{
  public class Author
    {
        public Author() { }
        private void SomeMethod(){
          string myMethodName = ""; 
          //  myMethodName = "Portal.Author.SomeMethod()";
        }
    }
} 
```

我可以找出我正在使用的方法的名称吗？在我的示例中，我想以编程方式设置`myMethodName`为当前方法的名称（即在本例中`"Portal.Author.SomeMethod"`）。

谢谢

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-03T13:28:43.430

```
MethodInfo.GetCurrentMethod().Name 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-03T13:29:44.643

System.Reflection.MethodBase.GetCurrentMethod().Name

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-03T13:29:48.357

MethodBase.GetCurrentMethod()

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-03T13:33:26.400

`System.Diagnostics`有`StackFrame`/`StackTrace`可以让你做到这一点，包括更多。您可以像这样检查整个调用堆栈：

```
StackFrame stackFrame = new StackFrame(1, true); //< skip first frame and capture src info
StackTrace stackTrace = new StackTrace(stackFrame);
MethodBase method = stackTrace.GetMethod();
string name = method.Name; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-04T17:06:40.073

虽然@leppie 让我走上了正确的轨道，但它只给了我方法的名称，但如果你看看我的问题，你会看到我想包含命名空间和类信息......

所以

```
myMethodName = System.Reflection.MethodBase.GetCurrentMethod().ReflectedType + 
                 "." + System.Reflection.MethodBase.GetCurrentMethod().Name; 
```

# core - _dl_sysinfo_int80 () 处的核心转储

> ID：337090
> 
> 赞同：1
> 
> 时间：2008-12-03T13:28:29.920
> 
> 标签：core

我创建了一个连接到侦听服务器的 TCP 客户端。我们也实现了 TCP keep alive。有时客户端崩溃和核心转储。以下是核心转储跟踪。

问题出在 linux 内核版本 Update 4，内核 2.6.9-42.0.10 中。

我们有两个核心转储。

```
(gdb) where
#0 0x005e77a2 in _dl_sysinfo_int80 () from /ddisk/d303/dumps/mhx239131/ld-
linux.so.2
#1 0x006c8bd1 in connect () from /ddisk/d303/dumps/mhx239131/libc.so.6
#2 0x08057863 in connect_to_host ()
#3 0x08052f38 in open_ldap_connection ()
#4 0x0805690a in new_connection ()
#5 0x08052cc9 in ldap_open ()
#6 0x080522cf in checkHosts ()
#7 0x08049b36 in pollLDEs ()
#8 0x0804d1cd in doOnChange ()
#9 0x0804a642 in main ()

(gdb) where
#0 0x005e77a2 in _dl_sysinfo_int80 () from /ddisk/d303/dumps/mhx239131/ld-
linux.so.2
#1 0x0068ab60 in __nanosleep_nocancel ( 
from /ddisk/d303/dumps/mhx239131/libc.so.6
#2 0x080520a2 in Sleep ()
#3 0x08049ac1 in pollLDEs ()
#4 0x0804d1cd in doOnChange ()
#5 0x0804a642 in main () 
```

我们试图在我们的环境中重现该问题，但我们不能。

什么会导致核心文件？

请帮助我避免这种情况。

谢谢，纳迦

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T16:26:45.927

`_dl_sysinfo_int80`只是一个对内核进行系统调用的函数。所以核心转储发生在系统调用上（可能是`connect`第一个示例和`nanosleep`第二个示例中使用的那个），可能是因为您传递了无效指针。

无效的指针可能是因为调用这些函数的代码被破坏或因为程序中的*其他地方*被破坏并破坏了程序的内存。

查看两个示例的核心转储中的上述两帧 (frame `#2`)，并检查正在传递的参数。不幸的是，您似乎没有使用调试信息进行编译，因此更难看到它们。

此外，我建议尝试`valgrind`看看它是否找到了一些东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-06T07:22:16.443

您的程序几乎肯定没有**在**上述任何一个地方进行核心转储。

最有可能的是，您的进程中有多个线程（以及其他一些线程导致核心转储），或者外部因素导致您的进程死亡（例如`'kill -SIGABRT <pid>'`）。

如果确实有多个线程，GDB`'info threads'`很`'thread apply all where'`可能会提供进一步的线索。

# html - 我可以在 jsp 中使用 eclipse xml 验证器吗？

> ID：337101
> 
> 赞同：0
> 
> 时间：2008-12-03T13:30:03.117
> 
> 标签：html, xml, eclipse, validation

我正在编写一个输出 xml 的应用程序，并且我正在使用 jsp 来完成它（在 eclipse 中）。它工作正常，但 jsp 编辑器抱怨 xml 标签。有没有办法说服 jsp 编辑器验证 xml 而不是 html？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-03T13:51:40.873

哦，我完全误读了。

您可以在 Eclipse 属性中打开 JSP 格式/验证。

另外确保你`<%@ page contentType="application/rss+xml" %>`在你的 JSP 中有。

上一个答案。

1) 创建一个 XML util 类，该类具有抽象 XML 生成、自动处理漂亮打印等的方法。我可以看到它具有以下公共方法：

```
public void init();
// <tagname> and <tagname />
public void openTag(String tagname, boolean close);
// <tagname x="y">
public void openTag(String tagname, Map<String, String> attributes, boolean close);
// </tagname>
public void closeTag(String tagname);
// <tagname>value</tagname>
public void valueTag(String tagname, String value);
public void valueTag(String tagname, Map<String, String> attributes, String value);
public String getXML(); 
```

或者您可以让每个操作返回一个 String 并自己管理 StringBuilder。

2) 为什么要在 JSP 类中生成 XML，它应该用于表示？

# vba - 运行时显示剩余时间

> ID：337103
> 
> 赞同：2
> 
> 时间：2008-12-03T13:30:45.080
> 
> 标签：vba, ms-access

我有一个带有几个按钮的表单，这些按钮在按下时执行代码，就像在数据库上运行验证一样。

有些代码可以运行几分钟，那么有什么方法可以显示剩余时间或显示已完成进程百分比的消息吗？

还是在代码评估开始时弹出一条消息，并且在代码运行完成后该消息应该消失？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T15:30:55.617

您可能正在寻找的是“进度条”。

我用过Microsoft ProgressBar 控件（你可以在Insert->ActiveX 控件下找到它），而且使用起来并不难。只需将其值设置为百分比（作为整数，而不是小数）。

```
'foo, being the ProgressBar
me.foo = 70 '70% 
```

这里有一些关于另一种方法的好信息：http: [//www.granite.ab.ca/access/progressbar.htm](http://www.granite.ab.ca/access/progressbar.htm)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T13:42:14.993

为了以“正常”方式执行此操作，您需要在另一个线程中运行验证并将其进度报告回 UI 线程。但是，我不相信 VBA 支持任何类型的多线程。

如果您的验证例程涉及一个循环，甚至只是许多单独的离散操作，您可以尝试`DoEvents`在循环迭代（或操作）之间插入一条语句，然后定期更新您的进度显示（例如，在`Application_OnTime`事件处理程序中）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T15:30:17.100

我通常有一个我命名为 frmProgress 或其他名称的表单，带有一个取消按钮和一个用于显示状态消息的标签。然后嵌入到表单代码中，我有一个名为 bCancel 的布尔值，当您点击取消按钮时，它只是将 bCancel 设置为 true。

同样在这段代码中，我有一个名为 ShowPercDone(Idx, NumIdc) 的例程，其中 Idx 是代码所在的步骤，NumIdc 是代码将执行的步骤数（假设每个步骤花费相同的时间）。当我通过 for 循环运行时，这很有效，但基本上任何时候我想显示状态更新，我只需使用我的消息调用表单中的例程，我应该添加它为我运行 doevents 命令。

这就是状态表单的工作方式。在我运行的宏中，我首先调用 frmProgress.show (0) 以便让您单击取消按钮。然后在我的循环中，当我更新状态消息时，我检查 frmProgress.bCancel ，如果它是真的，我退出宏。

希望有帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-04T11:41:23.193

最后为了简单起见，我决定使用这里给出的方法

[http://oreilly.com/pub/h/3330#code](http://oreilly.com/pub/h/3330#code)

# javascript - 如何在 JavaScript 中为 Number.toFixed 编写原型？

> ID：337112
> 
> 赞同：5
> 
> 时间：2008-12-03T13:33:46.180
> 
> 标签：javascript, rounding, precision

我需要使用 JavaScript 将十进制数字四舍五入到六位，但我需要考虑旧版浏览器，所以我[不能依赖 Number.toFixed](http://www.hunlock.com/blogs/The_Complete_Javascript_Number_Reference)

> toExponential、toFixed 和 toPrecision 的一大亮点是它们是相当现代的构造，直到 Firefox 1.5 版才在 Mozilla 中得到支持（尽管 IE 从 5.5 版开始支持这些方法）。虽然使用这些方法大多是安全的，但旧版浏览器会损坏，因此如果您正在编写公共程序，建议您提供自己的原型，以便为旧版浏览器的这些方法提供功能。

我正在考虑使用类似的东西

```
Math.round(N*1000000)/1000000 
```

向旧浏览器提供原型的最佳方法是什么？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-03T13:49:10.363

试试这个：

```
if (!Number.prototype.toFixed)

    Number.prototype.toFixed = function(precision) {
        var power = Math.pow(10, precision || 0);
        return String(Math.round(this * power)/power);
    } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T13:46:40.413

我认为 Firefox 1.5 和 IE 5 几乎不再使用，或者被极少数人使用。
支持 Netscape Navigator 有点像编码...... :-)
除非其他一些主要浏览器（Opera？Safari？不太可能......）不支持这一点，或者如果您的 Web 日志显示大量使用旧版浏览器，您大概可以只用这些方法。
有时，我们必须继续前进。^_^

[编辑] 在 Opera 9.50 和 Safari 3.1 上运行良好

```
javascript: var num = 3.1415926535897932384; alert(num.toFixed(7)); 
```

你参考的那篇文章是一年半前的，IT行业的永恒……我认为，与IE用户不同，Firefox用户经常去最新版本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T13:53:36.377

来自[Bytes website](http://bytes.com/answers/javascript/454098-javascript-mac-number-tofixed-challenge)，这个功能与 Serge llinsky 的几乎相同：

```
if (!num.toFixed) 
{
  Number.prototype.toFixed = function(precision) 
  {
     var num = (Math.round(this*Math.pow(10,precision))).toString();
     return num.substring(0,num.length-precision) + "." + 
            num.substring(num.length-precision, num.length);
  }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-28T04:40:58.813

另一个选项是 ( 它不会不必要地转换为字符串，并且还将 (162.295).toFixed(2) 的错误计算更正为 162.29 （应该是 162.30 ））。

```
Number.prototype._toFixed=Number.prototype.toFixed; //Preserves the current function
Number.prototype.toFixed=function(precision){
/* step 1 */ var a=this, pre=Math.pow(10,precision||0);
/* step 2 */ a*=pre; //currently number is 162295.499999
/* step 3 */ a = a._toFixed(2); //sets 2 more digits of precision creating 16230.00
/* step 4 */ a = Math.round(a);
/* step 5 */ a/=pre;
/* step 6 */ return a._toFixed(precision);
}
/*This last step corrects the number of digits from 162.3 ( which is what we get in
 step 5 to the corrected 162.30\. Without it we would get 162.3 */ 
```

编辑：在尝试这个特定的化身时，`this*=Math.pow(10, precision||0)`会创建一个错误无效的左手赋值。所以给这个关键字变量`a`。如果我关闭我的功能也会有所帮助^_^;;

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-09-04T15:43:06.513

试试这个：

```
 Number.prototype.toFixed = function(precision) {
     var power = Math.pow(10, precision || 0);
     return String(Math.round(this * power)/power);
 } 
```

# tcp - 设置 TIME_WAIT TCP

> ID：337115
> 
> 赞同：73
> 
> 时间：2008-12-03T13:35:07.880
> 
> 标签：tcp, network-protocols

我们正在尝试调整一个通过 TCP 接受消息并使用 TCP 进行一些内部消息传递的应用程序。在负载测试时，我们注意到响应时间显着降低（然后完全停止），因为系统同时发出更多请求。在此期间，我们看到很多 TCP 连接处于`TIME_WAIT`状态，有人建议将`TIME_WAIT`环境变量从默认的 60 秒降低到 30 秒。

据[我了解](http://www.developerweb.net/forum/showthread.php?t=2941)，该`TIME_WAIT`设置实质上设置了连接关闭后 TCP 资源再次可供系统使用的时间。

我不是“网络人”，对这些事情知之甚少。我需要该链接帖子中的很多内容，但有点“笨拙”。

*   我想我明白为什么`TIME_WAIT`不能将值设置为 0，但可以安全地设置为 5 吗？10个呢？什么决定了这个值的“安全”设置？
*   为什么这个值的默认值为 60？我猜想比我聪明得多的人有充分的理由选择它作为合理的默认值。
*   关于覆盖此值的潜在风险和收益，我还应该知道什么？

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2008-12-03T13:46:17.170

TCP 连接由元组（源 IP、源端口、目标 IP、目标端口）指定。

会话关闭后出现 TIME_WAIT 状态的原因是，网络中可能仍有实时数据包在发送给您的途中（或来自您的可能会请求某种响应的数据包）。如果您要重新创建相同的元组并且其中一个数据包出现，它将被视为您的连接的有效数据包（并且可能由于排序而导致错误）。

所以TIME_WAIT时间一般设置为包最大年龄的两倍。该值是在网络丢弃数据包之前允许数据包到达的最长时间。

这保证了，在您被允许使用相同的元组创建连接之前，属于该元组先前化身的所有数据包都将失效。

这通常决定了您应该使用的最小值。最大数据包寿命由网络属性决定，一个例子是卫星寿命高于 LAN 寿命，因为数据包还有很长的路要走。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-12-03T15:40:34.863

通常，只有发出“主动关闭”的端点才应该进入 TIME_WAIT 状态。因此，如果可能的话，让您的客户端发出主动关闭，这会将 TIME_WAIT 留在客户端而不是服务器上。

请参阅此处：[http](http://www.serverframework.com/asynchronousevents/2011/01/time-wait-and-its-design-implications-for-protocols-and-scalable-servers.html) ://www.serverframework.com/asynchronousevents/2011/01/time-wait-and-its-design-implications-for-protocols-and-scalable-servers.html和[http://www.isi.edu/touch/pubs/infocomm99/infocomm99-web/](http://www.isi.edu/touch/pubs/infocomm99/infocomm99-web/)了解详细信息（后者还解释了为什么由于协议设计不考虑 TIME_WAIT 而并非总是可行）。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-12-03T14:05:28.003

Pax 关于 TIME_WAIT 的原因是正确的，以及为什么您应该小心降低默认设置。

更好的解决方案是更改用于套接字原始端的端口号。一旦你这样做了，你就不会真正关心等待单个套接字的时间了。

对于侦听套接字，您可以使用 SO_REUSEADDR 来允许侦听套接字绑定，尽管 TIME_WAIT 套接字位于周围。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-03-24T00:47:03.220

在 Windows 中，您可以[通过注册表](http://msdn.microsoft.com/en-us/library/aa560610.aspx)[更改](http://publib.boulder.ibm.com/infocenter/cicstg/v6r0m0/index.jsp?topic=/com.ibm.cicstg600.doc/ccllal0264.htm)它：

```
; Set the TIME_WAIT delay to 30 seconds (0x1E)

[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\TCPIP\Parameters]
"TcpTimedWaitDelay"=dword:0000001E 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-06-02T19:38:10.337

设置 tcp_reuse 比更改 time_wait 更有用，只要您有参数（内核 3.2 及更高版本，不幸的是，这会取消所有版本的 RHEL 和 XenServer）。

删除该值，特别是对于 VPN 连接的用户，可能会导致在出站连接上不断地重新创建代理隧道。使用低于默认 Linux 配置的默认 Netscaler (XenServer) 配置，Chrome 有时必须重新创建代理隧道多达十几次才能检索一个网页。不重试的应用程序，例如 Maven 和 Eclipse P2，只会失败。

参数的最初动机（避免重复）被一个 TCP RFC 变得多余，该 RFC 指定所有 TCP 请求中包含时间戳。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-04-28T06:54:48.537

我一直在使用具有 20 个线程的测试程序对服务器应用程序（在 linux 上）进行负载测试。

在 959,000 个连接/关闭周期中，我在 TIME_WAIT 中有 44,000 个失败的连接和数千个套接字。

我在关闭调用之前将 SO_LINGER 设置为 0，并且在测试程序的后续运行中没有连接失败，并且 TIME_WAIT 中的套接字少于 20 个。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-12-03T18:04:41.250

TIME_WAIT 可能不是罪魁祸首。

```
int listen(int sockfd, int backlog); 
```

根据 Unix Network Programming Volume1，积压被定义为已完成连接队列和未完成连接队列的总和。

假设积压为 5。如果您有 3 个已完成的连接（ESTABLISHED 状态）和 2 个未完成的连接（SYN_RCVD 状态），并且还有另一个带有 SYN 的连接请求。TCP 堆栈只是忽略 SYN 数据包，知道它会在其他时间重新传输。这可能会导致降级。

至少那是我一直在读的。;)

# c# - “公共”嵌套类与否

> ID：337121
> 
> 赞同：20
> 
> 时间：2008-12-03T13:37:18.297
> 
> 标签：c#, class-design, nested-class

假设我有一个类“应用程序”。为了被初始化，它需要在构造函数中进行某些设置。让我们还假设设置的数量如此之多，以至于将它们放在自己的类中是令人信服的。

比较此方案的以下两种实现。

实施1：

```
class Application 
{
   Application(ApplicationSettings settings) 
   {
       //Do initialisation here
   }
}

class ApplicationSettings 
{
   //Settings related methods and properties here
} 
```

实施2：

```
class Application 
{
   Application(Application.Settings settings) 
   {
       //Do initialisation here
   }

   class Settings 
   {
      //Settings related methods and properties here
   }
} 
```

对我来说，第二种方法非常可取。它更具可读性，因为它强烈强调了两个类之间的关系。当我编写代码以在任何地方实例化 Application 类时，第二种方法看起来会更漂亮。

现在想象一下，Settings 类本身又具有一些类似的“相关”类，而该类也同样如此。只进行三个这样的级别，并且在“非嵌套”情况下类命名会失控。然而，如果你嵌套，事情仍然保持优雅。

尽管如此，我还是读到有人在 StackOverflow 上说嵌套类只有在它们对外界不可见时才是合理的；也就是说，如果它们仅用于包含类的内部实现。普遍引用的反对意见是膨胀包含类的源文件的大小，但部分类是该问题的完美解决方案。

我的问题是，为什么我们要警惕嵌套类的“公开”使用？还有其他反对这种使用的论据吗？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-12-03T13:47:31.207

我认为这很好。这基本上是构建器模式，使用嵌套类效果很好。它还允许构建器访问外部类的私有成员，这非常有用。例如，您可以在构建器上有一个 Build 方法，该方法在外部类上调用私有构造函数，该构造函数采用构建器的实例：

```
public class Outer
{
    private Outer(Builder builder)
    {
        // Copy stuff
    }

    public class Builder
    {
        public Outer Build()
        {
            return new Outer(this);
        }
    }
} 
```

这确保了构建外部类实例的*唯一方法是通过构建器。*

我在协议缓冲区的 C# 端口中使用了非常类似的模式。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-03T14:01:07.857

您可以使用命名空间来关联...相关的事物。

例如：

```
namespace Diner
{
    public class Sandwich
    {
        public Sandwich(Filling filling) { }
    }

    public class Filling { }
} 
```

与像使用命名空间一样使用类相比，这样做的优点是您可以选择`using`在调用方使用来缩写事物：

```
using Diner;

...

var sandwich = new Sandwich(new Filling()); 
```

如果您使用`Sandwich`该类，就好像它是一个名称空间一样`Filling`，您必须使用全名`Sandwich.Filling`来引用`Filling`.

知道这一点，你晚上怎么睡觉？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T13:44:09.530

您可能想查看[Microsoft 对此](http://msdn.microsoft.com/lv-lv/library/ms229042(en-us).aspx)主题的看法。基本上这是我要说的风格问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-03T13:44:42.023

我主要使用嵌套类来微调对嵌套类和/或容器类的访问。

要记住的一件事是嵌套类定义基本上是类成员，并且可以访问容器的所有私有变量。

您还可以使用它来控制特定类的使用。

例子：

```
public abstract class Outer
{
  protected class Inner
  {
  }
} 
```

现在，在这种情况下，（您的类的）用户只能访问 Inner 类，如果他实现了 Outer。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-12-21T15:23:46.887

另一个有效使用公共嵌套类的实际示例是在 MVC 模式中，当我使用具有 IEnumerable 属性的视图模型时。例如：

```
public class OrderViewModel
{
public int OrderId{ get; set; }
public IEnumerable<Product> Products{ get; set; }

public class Product {
public string ProductName{ get; set; }
public decimal ProductPrice{ get; set; }
}

} 
```

我使用它是因为我不希望`Product`在外部重新使用类，因为它仅针对包含它的特定视图模型进行定制。但我不能将其设为私有，因为 Products 属性是公开的。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2019-12-11T23:20:23.147

我不知道这是否被认为是糟糕的设计，但我有一些搜索类，用户在其中调用 Run() 方法，传入一个包含搜索条件的对象。然后它返回一个搜索结果对象的集合。

除了将它们与 Search 类一起使用之外，这些 SearchCriteria 和 SearchResult 类没有任何实用性。因此，我将它们嵌套在 Search 类下以显示它们一起使用。

我必须公开嵌套类，以便 Search 类的客户端可以将 SearchCriteria 传递给 Search 类，这样他们就可以获得搜索结果。

```
public class PersonSearch
{
    public PersonSearchCriteria
    {
        string FirstName {get; set;}
        string LastName {get; set;}
    }

    public PersonSearchResult
    {
        string FirstName {get;}
        string MiddleName {get;}
        string LastName {get;}
        string Quest {get;}
        string FavoriteColor {get;}
    }

    public static List<PersonSearchResult> Run(PersonSearchCriteria criteria)
    {
        // create a query using the given criteria

        // run the query

        // return the results 
    }
}

public class PersonSearchTester
{
    public void Test()
    {
        PersonSearch.PersonSearchCriteria criteria = new PersonSearch.PersonSearchCriteria();
        criteria.FirstName = "George";
        criteria.LastName  = "Washington";

        List<PersonSearch.PersonSearchResults> results = 
            PersonSearch.Run(criteria);
    }
} 
```

# silverlight - 在 Silverlight 中创建 RE-USABLE 控件模板的最佳实践是什么

> ID：337128
> 
> 赞同：1
> 
> 时间：2008-12-03T13:41:35.633
> 
> 标签：silverlight, controls, templates, blend, silverlightcontrols

创建可重用控件模板的最佳实践是什么。

例如。我想从标准复选框开始并修改其模板以在多个未来项目中重复使用。

我了解如何在 Blend 中修改模板，但它总是希望将模板保存到当前项目的 App.xaml 或我第一次放置复选框的父控件中。

理想情况下，我想要一些包含我所有自定义控件和自定义模板（现有控件的修改模板）的 ControlLibrary 软件

-杰夫

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-04T12:30:56.603

隐式样式管理器可能会有所帮助。

Silverlight 控件团队和其他人最近发布了一些关于 ISM 的博客，它允许将替代样式集全面应用于标准控件。试试[Jesse Liberty 的博客](http://jesseliberty.com/2008/10/31/themes-revisited-the-implicit-style-manager-updated/)或[Mehdi Slaoui Andaloussi 的博客](http://blogs.msdn.com/mehdis/archive/2008/11/02/customizing-silverlight-toolkit-themes.aspx)

高温高压

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-04T06:39:43.677

I don't think you can have a ControlTemplate as a separate entity, without it being attached to a Control. For your control library you can create custom controls that have the appropriate custom templates and reuse the controls.

# sql - 如何在 SQL 2000 中计算订单行号

> ID：337141
> 
> 赞同：1
> 
> 时间：2008-12-03T13:47:03.800
> 
> 标签：sql

我正在使用具有两个表 Order 和 OrderLine 的订单系统非常标准的东西。我想针对订单计算订单行的订单行号，例如

Orderid Orderlineid 行
号 1 1 1
2 2 1
2 3 2
3 4 1
4 5 1
4 6 2

OrderLineId 是一个标识列。我不想将行号作为数据存储在数据库中，原因有两个。首先，系统中已经有很多现有的订单和线路，追溯添加数据是我希望避免的一个令人头疼的问题。其次，如果用户删除了一行，那么我需要重新计算整个订单的行号。

在 SQL 2005 中，我可以使用 ROW_NUMBER 函数轻松完成这项工作。

```
Select Orderid, OrderLineid, ROW_NUMBER() 
OVER(PARTITION BY Orderid ORDER BY Orderlineid) as LineNumber
FROM OrderLine 
```

无论如何我可以在 SQL 2000 中做到这一点吗？

我发现最接近的是排名函数（见下文），但这计算的是订单而不是行。

```
SELECT x.Ranking, x.OrderId
FROM (SELECT (SELECT COUNT( DISTINCT t1.Orderid) FROM orderline t1 WHERE z.Orderid >= t1.Orderid)AS Ranking, z.orderid 
FROM orderline z ) x 
ORDER BY x.Ranking 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-03T14:10:40.367

你可以使用这样的东西：

```
select 
    ol1.orderId,
    ol1.orderLineId,
    count(*) as lineNumber
from 
    orderLine ol1
    inner join orderLine ol2 
        on ol1.orderId = ol2.orderId
        and ol1.orderLineId >= ol2.orderLineId
group by 
    ol1.orderId, 
    ol1.orderLineId 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T14:11:18.383

恕我直言，每次需要时计算它可能最终会让人头疼而不是值得。虽然更新历史行号并将其保存到数据库中可能会很痛苦，但您只需要这样做一次......然后只需要编写代码以使其稍后自动化。

要处理删除，您只需将代码添加到现有的删除过程中并让它重新计算行号。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T14:21:38.550

另一种方法是将您的数据（不带行号）插入到#temp 表中，在其中添加带有标识（1,1）的列，然后从#temp 表中选择所有内容。

# .net - .NET 程序集大小会影响性能吗？

> ID：337144
> 
> 赞同：27
> 
> 时间：2008-12-03T13:48:05.170
> 
> 标签：.net, performance, assemblies

.net 程序集的大小是否会影响性能？您的 Windows 窗体/Web 窗体项目中的程序集数量如何？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-12-03T14:14:09.827

来自微软[提高 .NET 应用程序性能和可扩展性](http://msdn.microsoft.com/en-us/library/ms998530.aspx)的模式和实践第 5 章：

**首选单个大型组件而不是多个较小的组件**

为了帮助减少应用程序的工作集，您应该更喜欢单个较大的程序集而不是多个较小的程序集。如果您有几个总是一起加载的程序集，则应将它们组合并创建一个程序集。

与拥有多个较小的程序集相关的开销可归因于以下原因：

*   为较小的程序集加载元数据的成本。
*   触摸 CLR 中预编译映像中的各种内存页面以加载程序集（如果它是使用 Ngen.exe 预编译的）。
*   JIT 编译时间。
*   安全检查。

由于您只需为程序访问的内存页面付费，因此较大的程序集为本机映像生成器实用程序 (Ngen.exe) 提供了更大的机会来优化其生成的本机映像。更好的图像布局意味着可以更密集地布局必要的数据，这反过来意味着与在多个程序集中布局的相同代码相比，完成这项工作所需的整体页面更少。

有时您无法避免拆分程序集；例如，出于版本控制和部署原因。如果您需要单独运送类型，您可能需要单独的组件。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-12-03T13:50:40.187

好吧，每次加载程序集时都会因为分辨率损失而受到*一些*打击 - 找到正确的文件，可能会验证版本号等。这可能主要是在启动时。

但是，我认为它不会显着影响“稳态”性能。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-03T14:02:20.913

一个紧凑的框架 DLL 将始终加载到 64 kb 的最小内存空间中，无论它有多小。因此，加载四个单独的 10 kb CF DLL 将在设备上花费 256 kb。如果将它们组合在一起 ( [ILMerge](http://research.microsoft.com/~mbarnett/ILMerge.aspx) )，则只需在设备上花费 64 kb 的内存。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-03T13:55:52.923

我从来没有遇到过我追踪到的组件大小或数量对性能的重大影响。我发现的绝大多数重大性能问题都是算法缺陷的结果。

正如 Jon Skeet 所说，由于启动时的分辨率，可能会有一些小影响。lassevk 也有关于通过反射对组件进行动态解析的观点。但是，在整个程序过程中，这些都不应该对性能产生一次以上的影响，而且在正常情况下，除非您在一些非常严格的性能限制下工作，否则这可能不会对性能造成重大影响。

也许有关该问题的一些其他上下文会有所帮助。你问这个问题是因为你有一个包含很多大程序集的软件，并且你正在尝试加速它，例如？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-03T13:53:48.153

我非常怀疑它会在任何可衡量的程度上影响性能。在启动时加载它会有一些惩罚；并且内存使用量可能会增加一到两 MB，但除此之外 - 不会。好吧，除非您自己编写因此而受苦的代码。

也就是说，我还没有看到任何测试，所以我可能是错的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-03T13:50:10.780

我知道的一件事会影响性能，与程序集大小有关，至少如果程序集大小与类、方法等的数量有关。

如果您使用反射并*为所有程序集使用循环，对于这些程序集中的所有类型，请检查它们是否具有属性等*。这可能会 JIT 静态构造函数并在某些情况下调用它们。

啊，看到乔恩的回答，忘记说了。当然，每段代码只会发生一次代码的 JIT，因此，如果您所做的只是反映类型，而不是事后触及它们，则程序集的大小将影响该反射循环的持续时间，但在那之后一点都不重要。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-08-10T06:37:33.563

我同意丹的回答，只是添加更多信息：这是另一个支持该观点的相关博客文章：http: [//blogs.msdn.com/junfeng/archive/2004/02/23/78139.aspx](http://blogs.msdn.com/junfeng/archive/2004/02/23/78139.aspx)

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2008-12-03T13:55:27.730

不，不影响

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2010-04-12T05:06:22.473

未使用的局部变量和不必要的赋值会增加程序集的大小并降低性能。

# sql - 如何在 MS Access 中实现 SQL INTERSECT 和 MINUS 操作

> ID：337158
> 
> 赞同：21
> 
> 时间：2008-12-03T13:54:05.267
> 
> 标签：sql, database, ms-access

我已经研究并没有找到在 MS Access 中运行 INTERSECT 和 MINUS 操作的方法。有没有办法存在

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-12-03T14:07:36.020

INTERSECT 是内连接。MINUS 是一个外连接，在这里您只选择另一个表中不存在的记录。

* * *

**相交**

```
select distinct
  a.*
from
  a
  inner join b on a.id = b.id 
```

* * *

**减**

```
select distinct
  a.*
from
  a
  left outer join b on a.id = b.id
where
  b.id is null 
```

如果您编辑原始问题并发布一些示例数据，则可以给出一个示例。

编辑：忘记添加不同的查询。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-12-03T15:46:16.397

INTERSECT 不是 INNER JOIN。他们是不同的。在没有 INTERSECT 的情况下，INNER JOIN 将为您提供重复的行。您可以通过以下方式获得等效结果：

```
SELECT DISTINCT a.*
FROM a
INNER JOIN b
   on a.PK = b.PK 
```

请注意，PK 必须是主键列或列。如果桌子上没有PK（坏！），你必须这样写：

```
SELECT DISTINCT a.*
FROM a
INNER JOIN b
   ON  a.Col1 = b.Col1
   AND a.Col2 = b.Col2
   AND a.Col3 = b.Col3 ... 
```

使用 MINUS，您可以执行相同的操作，但使用 LEFT JOIN 和 WHERE 条件检查表 b 的一个不可为空的列（最好是主键）是否为空。

```
SELECT DISTINCT a.*
FROM a
LEFT JOIN b
   on a.PK = b.PK
WHERE b.PK IS NULL 
```

那应该这样做。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-03T14:06:51.123

它们是通过 JOIN 完成的。老式的方式:)

对于 INTERSECT，您可以使用 INNER JOIN。很简单。如果您没有纯粹的一对一关系，只需要使用 GROUP BY 或 DISTINCT。否则，正如其他人所提到的，您可以获得比预期更多的结果。

对于 MINUS，您可以使用 LEFT JOIN 并使用 WHERE 来限制它，因此您只能从主表中获取与 LEFT JOINed 表不匹配的行。

十分简单。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-03T14:07:54.350

不幸的是，MS Access 不支持 MINUS - 一种解决方法是创建三个查询，一个包含完整数据集，一个拉出要过滤掉的行，第三个左连接两个表并仅提取仅存在于您的完整数据集中。

INTERSECT 也是如此，除了您将通过内部联接执行此操作并且仅返回两者中都存在的记录。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-10-06T11:47:16.933

Access 中没有 MINUS，但您可以使用子查询。

```
SELECT DISTINCT a.*
FROM a
WHERE a.PK NOT IN (SELECT DISTINCT b.pk FROM b) 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2019-08-16T05:34:15.817

我相信这个可以减号

```
SELECT DISTINCT
  a.CustomerID, 
  b.CustomerID
FROM 
  tblCustomers a
LEFT JOIN 
  [Copy Of tblCustomers] b
ON
  a.CustomerID = b.CustomerID
WHERE
  b.CustomerID IS NULL 
```

# c# - C#：加载漫游配置文件并以用户身份执行程序

> ID：337159
> 
> 赞同：1
> 
> 时间：2008-12-03T13:55:14.377
> 
> 标签：c#, .net, impersonation, runas, roaming-profile

在应用程序中，我需要使用其他用户的凭据执行其他程序。目前我使用**[System.Diagnostics.Process.Start](http://msdn.microsoft.com/en-us/library/ed04yy3t.aspx)**来执行程序：

```
public static Process Start(
   string fileName,
   string arguments,
   string userName,
   SecureString password,
   string domain
) 
```

但是，此功能不会从网络加载漫游配置文件 - 这是必需的。

我可以使用“runas /profile ...”来加载配置文件并执行命令，但这会要求输入密码。一定有更优雅的方式...

但是哪里？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-03T14:56:53.830

我的解决方案（基于 leppie 的提示）：

```
 Process p = new Process();

        p.StartInfo.FileName = textFilename.Text;
        p.StartInfo.Arguments = textArgument.Text;
        p.StartInfo.UserName = textUsername.Text;
        p.StartInfo.Domain = textDomain.Text;
        p.StartInfo.Password = securePassword.SecureText;

        p.StartInfo.LoadUserProfile = true;
        p.StartInfo.UseShellExecute = false;

        try {
            p.Start();
        } catch (Win32Exception ex) {
            MessageBox.Show("Error:\r\n" + ex.Message);
        } 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-03T14:12:47.943

[System.Diagnostics.ProcessStartInfo.LoadUserProfile](http://msdn.microsoft.com/en-us/library/system.diagnostics.processstartinfo.loaduserprofile.aspx)

# c# - 帮我解决那个CrossThread？

> ID：337165
> 
> 赞同：0
> 
> 时间：2008-12-03T13:56:12.487
> 
> 标签：c#, .net, winforms, multithreading

此代码通过多种方式执行。当它由表单按钮执行时，它起作用（按钮启动一个线程并在循环中调用此方法=它起作用）。但是，当我从表单中的 BackgroundWorker 调用该方法时，它不起作用。

使用以下代码：

```
private void resizeThreadSafe(int width, int height)
{
    if (this.form.InvokeRequired)
    {
        this.form.Invoke(new DelegateSize(resizeThreadSafe),
            new object[] { width, height });
    }
    this.form.Size = new Size(width, height); // problem occurs on this line
    this.form.Location = new Point(0, 0); // dummy coordinate
} 
```

然后在包含`this.form.Size = ...`我的行上出现以下异常：

```
InvalidOperationException was unhandled
Cross-thread operation not valid: Control 'Form1' accessed from a thread other
than the thread it was created on. 
```

为什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-03T13:58:00.953

您需要在 if 块的末尾返回 - 否则您将在正确的线程中调整它的大小，然后也在错误的线程中执行它。

换句话说（如果你剪切和粘贴代码而不是图片，这会更容易......）

```
private void resizeThreadSafe(int width, int height)
{
    if (this.form.InvokeRequired)
    {
        this.form.Invoke(new DelegateSize(resizeThreadSafe,
            new object[] { width, height });
        return;
    }
    this.form.Size = new Size(width, height);
    this.form.Location = new Point(0, SystemInformation.MonitorSize // whatever comes next
} 
```

或者，只需将方法的后半部分放在“else”块中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T14:00:49.403

你需要这样写：

```
if ( this.form.InvokeRequired ) {
    this.form.Invoke( ...... );
    return;
}
this.form.Size = new Sizte( ... ); 
```

或者

```
if ( this.form.InvokeRequired ) {
    this.form.Invoke( ...... );
}
else {
    this.form.Size = new Sizte( ... );
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T14:00:59.370

根据您的编码风格，在 Invoke 之后使用**return**或将实际操作作为**else 块**。

# visual-studio-2008 - VS2008 - 前端页面服务器扩展

> ID：337173
> 
> 赞同：0
> 
> 时间：2008-12-03T13:58:27.987
> 
> 标签：visual-studio-2008, frontpage

再会，

我正在寻找外行对 FrontPage 服务器扩展和 .NET Web 应用程序之间关系的解释。

背景：我们的一个团队正在使用 VS2008 开发一个位于网络服务器上的 Web 应用程序。这是一个内部项目——我们都在同一个域中。我在服务器上创建了站点，并确保每个人都对该服务器具有足够的文件系统权限。但是，当他们尝试通过 VS 打开站点时，系统会提示他们输入用户名和密码。我不明白他们被要求验证什么 - 他们已经拥有必要的文件系统权限。我们知道这一点是因为他们能够浏览到该站点并创建文件夹/文件、删除文件夹/文件等等。

在谷歌搜索之后，我想出了一个事实，即我需要通过 VS 将它们添加到 FrontPage Server Extensions 2002 管理页面中的“作者”角色。之后，我这样做了，一切都很好。

在我看来，这些权限与服务器、IIS 服务或网站上的文件系统权限无关。在我看来，这些权限与任何事情无关，但我显然错了。

我正在寻找关于幕后发生的事情的一点历史。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-07T18:09:57.683

有关安全问题，请参阅此链接：http: [//docs.sun.com/source/816-5666-10/esapmsfp.htm](http://docs.sun.com/source/816-5666-10/esapmsfp.htm)

如果您在配置权限后安装了扩展，则可能必须通过重置项目文件夹的权限来替换这些文件上的 ACL，因为它在 Web 应用程序本身中创建了*vti * 文件夹和文件；*它会重置这些文件夹的权限，并将删除您设置的权限。此外，它可能会将应用程序的 _vti_bin 文件夹映射到程序文件文件夹位置。我知道答案有点晚了，但我总是告诉她，迟到总比没有好！

会推荐 TFS 源代码控制开发而不是使用 UNC 共享路径进行开发。

# sql - 您什么时候放弃 SQL 中的集合操作并转而使用程序化？

> ID：337175
> 
> 赞同：2
> 
> 时间：2008-12-03T13:58:54.353
> 
> 标签：sql, language-agnostic, procedural

我曾经被赋予在 RDBMS 中执行此任务：

给定表格客户、订单、订单线和产品。使用通常的字段和关系完成所有操作，并在订单表上使用注释备注字段。

对于一个客户，检索客户曾经订购过的所有产品的列表，其中包含产品名称、首次购买的年份、最后三次购买的日期、最新订单的评论、该产品-客户组合过去 12 个月的总收入总和。

几天后，我放弃了将其作为查询，并选择只为客户获取每个订单和每个产品，并按程序运行数据以构建所需的表客户端。

我认为这是以下一项或多项的症状：

*   我是个懒惰的白痴，应该知道如何在 SQL 中做到这一点
*   集合操作不如过程操作富有表现力
*   SQL 没有应有的表现力

我做对了吗？我有其他选择吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-03T18:15:05.083

您绝对应该能够在不执行与`JOIN`应用程序代码中的 a 等效的工作的情况下完成此练习，即从订单行和产品中获取所有行并遍历它们。您不必成为 SQL 向导也能做到这一点。 **`JOIN`循环之于 SQL 就像循环之于过程语言**——因为两者都是您应该知道如何使用的基本语言特性。

人们陷入的一个陷阱是认为必须在单个 SQL 查询中生成整个报告。不对！正如托尼·安德鲁斯（Tony Andrews）所指出的，大多数报告都不适合矩形。有很多汇总、摘要、特殊情况等，因此在单独的查询中获取报告的部分内容既简单又高效。同样，在程序语言中，您不会尝试在一行代码中进行所有计算，甚至在单个函数中（希望如此）。

一些报告工具坚持认为报告是从单个查询生成的，您没有机会合并多个查询。如果是这样，那么您需要生成多个报告（如果老板想要在一页上，那么您需要手动进行一些粘贴）。

要获得**所有订购产品的列表（带有产品名称）、最近三笔购买的日期以及对最新订单的评论，**非常简单：

```
SELECT o.*, l.*, p.*
FROM Orders o
 JOIN OrderLines l USING (order_id)
 JOIN Products p USING (product_id)
WHERE o.customer_id = ?
ORDER BY o.order_date; 
```

可以逐行迭代结果以提取最新订单的日期和评论，因为无论如何您都在获取这些行。但是通过要求数据库返回按日期排序的结果来让自己轻松一点。

**第一次购买**的年份可从上一个查询中获得，如果您按 排序`order_date`并逐行获取结果，您将可以访问第一个订单。否则，您可以这样做：

```
SELECT YEAR(MIN(o.order_date)) FROM Orders o WHERE o.customer_id = ?; 
```

**过去 12 个月的产品购买总和**最好通过单独的查询来计算：

```
SELECT SUM(l.quantity * p.price)
FROM Orders o
 JOIN OrderLines l USING (order_id)
 JOIN Products p USING (product_id)
WHERE o.customer_id = ?
 AND o.order_date > CURDATE() - INTERVAL 1 YEAR; 
```

**编辑：**您在另一条评论中说您想看看如何在标准 SQL 中获取最近三笔购买的日期：

```
SELECT o1.order_date
FROM Orders o1
  LEFT OUTER JOIN Orders o2 
  ON (o1.customer_id = o2.customer_id AND (o1.order_date < o2.order_date 
      OR (o1.order_date = o2.order_date AND o1.order_id < o2.order_id)))
WHERE o1.customer_id = ?
GROUP BY o1.order_id
HAVING COUNT(*) <= 3; 
```

如果您可以使用一些特定于供应商的 SQL 功能，则可以使用 Microsoft/Sybase `TOP` *n*或 MySQL/PostgreSQL `LIMIT`：

```
SELECT TOP 3 order_date
FROM Orders
WHERE customer_id = ?
ORDER BY order_date DESC;

SELECT order_date
FROM Orders
WHERE customer_id = ?
ORDER BY order_date DESC
LIMIT 3; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-03T14:08:31.370

> 集合操作不如过程操作富有表现力

也许更像：“对于习惯于过程语言的开发人员来说，集合操作不像过程操作那样熟悉”;-)

像您现在所做的那样迭代地执行它对于小型数据集很好，但根本不会以相同的方式扩展。您是否做了正确的事情的答案取决于您是否对现在的性能感到满意和/或不期望数据量会增加太多。

如果您可以提供一些示例代码，我们或许可以帮助您找到一个基于集合的解决方案，该解决方案将更快开始并且可以更好地扩展。正如 GalacticCowboy 所提到的，诸如临时表之类的技术可以帮助使语句更具可读性，同时在很大程度上保留性能优势。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-03T14:06:37.253

在大多数 RDBMS 中，您可以选择临时表或本地表变量，您可以使用它们将此类任务分解为可管理的块。

我看不到任何方法可以轻松地将其作为*单个*查询（没有一些**讨厌的**子查询），但如果您使用临时表，它仍然应该是可行的，而无需退出程序代码。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-03T14:11:02.847

这个问题可能不是*一个*查询就能解决的。我看到几个不同的部分......

对于一位客户

1.  获取所有订购产品的列表（带有产品名称）
2.  获取首次购买年份
3.  获取最近三笔购买的日期
4.  获取最新订单评论
5.  获取过去 12 个月的产品购买总和

您的过程是步骤 1 - 5，SQL 为您获取数据。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-03T16:14:24.283

对我来说，这听起来像是一个数据仓库项目。如果您需要诸如“最近的三件事”和“过去 12 个月内某件事的总和”之类的内容，请存储它们，即非规范化。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-03T21:26:44.823

**编辑：**这是一个全新的解决方案，不使用临时表或奇怪的子子子查询。但是，它只适用于 SQL 2005 或更高版本，因为它使用了该版本中新增的“pivot”命令。

基本问题是从一组行（在数据中）到输出中的列的所需枢轴。在思考这个问题时，我回忆起 SQL Server 现在有一个“枢轴”运算符来处理这个问题。

*这仅*适用于 SQL 2005 ，使用 Northwind 示例数据。

```
-- This could be a parameter to a stored procedure
-- I picked this one because he has products that he ordered 4 or more times
declare @customerId nchar(5)
set @customerId = 'ERNSH'

select c.CustomerID, p.ProductName, products_ordered_by_cust.FirstOrderYear,
    latest_order_dates_pivot.LatestOrder1 as LatestOrderDate,
    latest_order_dates_pivot.LatestOrder2 as SecondLatestOrderDate,
    latest_order_dates_pivot.LatestOrder3 as ThirdLatestOrderDate,
    'If I had a comment field it would go here' as LatestOrderComment,
    isnull(last_year_revenue_sum.ItemGrandTotal, 0) as LastYearIncome
from
    -- Find all products ordered by customer, along with first year product was ordered
    (
        select c.CustomerID, od.ProductID,
            datepart(year, min(o.OrderDate)) as FirstOrderYear
        from Customers c
            join Orders o on o.CustomerID = c.CustomerID
            join [Order Details] od on od.OrderID = o.OrderID
        group by c.CustomerID, od.ProductID
    ) products_ordered_by_cust
    -- Find the grand total for product purchased within last year - note fudged date below (Northwind)
    join (
        select o.CustomerID, od.ProductID, 
            sum(cast(round((od.UnitPrice * od.Quantity) - ((od.UnitPrice * od.Quantity) * od.Discount), 2) as money)) as ItemGrandTotal
        from
            Orders o
            join [Order Details] od on od.OrderID = o.OrderID
        -- The Northwind database only contains orders from 1998 and earlier, otherwise I would just use getdate()
        where datediff(yy, o.OrderDate, dateadd(year, -10, getdate())) = 0
        group by o.CustomerID, od.ProductID
    ) last_year_revenue_sum on last_year_revenue_sum.CustomerID = products_ordered_by_cust.CustomerID
        and last_year_revenue_sum.ProductID = products_ordered_by_cust.ProductID
    -- THIS is where the magic happens.  I will walk through the individual pieces for you
    join (
        select CustomerID, ProductID,
            max([1]) as LatestOrder1,
            max([2]) as LatestOrder2,
            max([3]) as LatestOrder3
        from
        (
            -- For all orders matching the customer and product, assign them a row number based on the order date, descending
            -- So, the most recent is row # 1, next is row # 2, etc.
            select o.CustomerID, od.ProductID, o.OrderID, o.OrderDate,
                row_number() over (partition by o.CustomerID, od.ProductID order by o.OrderDate desc) as RowNumber
            from Orders o join [Order Details] od on o.OrderID = od.OrderID
        ) src
        -- Now, produce a pivot table that contains the first three row #s from our result table,
        -- pivoted into columns by customer and product
        pivot
        (
            max(OrderDate)
            for RowNumber in ([1], [2], [3])
        ) as pvt
        group by CustomerID, ProductID
    ) latest_order_dates_pivot on products_ordered_by_cust.CustomerID = latest_order_dates_pivot.CustomerID
        and products_ordered_by_cust.ProductID = latest_order_dates_pivot.ProductID
    -- Finally, join back to our other tables to get more details
    join Customers c on c.CustomerID = products_ordered_by_cust.CustomerID
    join Orders o on o.CustomerID = products_ordered_by_cust.CustomerID and o.OrderDate = latest_order_dates_pivot.LatestOrder1
    join [Order Details] od on od.OrderID = o.OrderID and od.ProductID = products_ordered_by_cust.ProductID
    join Products p on p.ProductID = products_ordered_by_cust.ProductID
where c.CustomerID = @customerId
order by CustomerID, p.ProductID 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-03T14:09:23.817

SQL 查询以行和列的单个“平面”表的形式返回结果。报告要求通常比这更复杂，需要像您的示例一样的“锯齿状”结果集。“程序化”来解决此类需求或使用位于数据库顶部的报告工具并没有错。但是，您应该尽可能使用 SQL 以从数据库中获得最佳性能。

# java - 如何在 JDBC 中设置光标类型？

> ID：337179
> 
> 赞同：1
> 
> 时间：2008-12-03T13:59:49.280
> 
> 标签：java, oracle, jdbc, cursors

我正在运行 tomcat 并且有一些显示表格子集的 jsp 页面。我在单个页面上一次显示 20 行。当表格有大量数据时，jsp页面不呈现。我猜 ResultSet 正在使用客户端游标。我过去使用过 ASP，我们总是使用服务器端仅向前游标，并且在处理大量数据时从未遇到任何问题。我们的数据库是oracle 10g。

如何在 JDBC 中指定服务器端只进游标？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-03T14:29:21.577

oracle 驱动程序通过 FetchSize 属性实现服务器端游标。

不幸的是，JDBC 并没有明确地允许设置客户端游标和服务器端游标，因此不同的驱动程序以不同的方式实现它。以下是其他有帮助的链接：

[获取大小](http://blog.lishman.com/2008/03/jdbc-fetch-size.html)
[游标](http://wiki.gxtechnical.com/commwiki/servlet/hwiki?Client+and+server+cursors+-+using+MySQL)
[Oracle 驱动程序](http://www.rakeshv.org/docs/oracle/jdbc3.0/oracle/jdbc/OracleDriver.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-03T14:08:53.990

```
Statement stmt = con.createStatement(ResultSet.TYPE_FORWARD_ONLY);
ResultSet rs = stmt.executeQuery(sql); 
```

这应该设置它，但显然*有些*驱动程序会忽略它。

您可以随时尝试在 ResultSet 级别再次设置它。

```
rs.setFetchDirection(ResultSet.TYPE_FORWARD_ONLY); 
```

希望有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T19:15:55.540

没有完全回答这个问题，但是您是否考虑过在 WHERE 子句中使用 ROWNUM 或 ROWNUMBER 将分页显式添加到您的 SELECT 查询中？

eg：对于第二页数据，20个元素的页面大小：

```
SELECT * 
  FROM MyDataObjects
  WHERE rownum > 20 AND rownum < 41 
```

这将确保最多返回一页记录，从而消除大游标问题。

# .net - 如何创建自定义 WPF 控件，例如具有恒定角的卡通气泡

> ID：337181
> 
> 赞同：21
> 
> 时间：2008-12-03T14:00:17.627
> 
> 标签：.net, wpf, custom-controls

我需要创建一个带有圆角的矩形气泡，里面有文字，就像卡通语音气泡一样。我需要气泡根据其包含的文本大小水平和垂直扩展。我希望语音箭头和圆角的半径保持不变。

我可以简单地使用路径来创建我的气泡，但我无法调整气泡的大小并保持角半径和箭头不变......这是将调整大小的整个路径。

我很感激有人能指出我正确的方向。

*删除了无效的 ImageShack 链接*

这是卡通泡泡用户控件的最终版本。我在 Jobi Joy 的版本中添加了一个没有笔划的矩形来隐藏路径线的末端，而不是试图让然后看起来与矩形齐平。

```
<Grid>
    <Grid.RowDefinitions>
        <RowDefinition Height="*"/>
        <RowDefinition Height="40"/>
    </Grid.RowDefinitions>
    <Rectangle Fill="#FF686868" Stroke="#FF000000" RadiusX="10" RadiusY="10"/>
    <Path Fill="#FF686868" Stretch="Fill" Stroke="#FF000000" HorizontalAlignment="Left" Margin="30,-5.597,0,-0.003" Width="25" Grid.Row="1" Data="M22.166642,154.45381 L29.999666,187.66699 40.791059,154.54395"/>                  
    <Rectangle Fill="#FF686868" RadiusX="10" RadiusY="10" Margin="1"/>
    <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="25" Text="Hello World" TextWrapping="Wrap"/>                       
</Grid> 
```

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-12-03T16:02:06.193

使用此 XAML，您可以创建 PopUp 或 ContentControl，并可以将此 Grid 作为其上的控件模板以获得一致的外观

```
<Grid x:Name="grid">
    <Grid.RowDefinitions>
        <RowDefinition Height="*"/>
        <RowDefinition Height="40"/>
    </Grid.RowDefinitions>
    <Rectangle Fill="#FF686868" Stroke="#FF000000" RadiusX="10" RadiusY="10"/>
    <Path Fill="#FF686868" Stretch="Fill" Stroke="#FF000000" HorizontalAlignment="Left" Margin="30,-1.6,0,0" Width="25" Grid.Row="1" 
        Data="M22.166642,154.45381 L29.999666,187.66699 40.791059,154.54395"/>          
    <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="25" Text="Hello World" TextWrapping="Wrap"/>           
</Grid> 
```

*删除了无效的 ImageShack 链接*

我已经为此发表了[一篇博文](http://jobijoy.blogspot.com/2008/12/xaml-balloon-comments-expression-blend.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T15:52:02.470

圆角可以只是带有角锯齿设置的边框。

常量/语音箭头可以是与边界一起位于网格中的路径。

看一下 GroupBox 的控件模板，看看“标题”内容是如何定位到浮动在组框的边框上的。

除了将路径放置在底部而不是顶部之外，您将执行相同的操作。

# html - 输出 html 控件 - 动态控件名称

> ID：337183
> 
> 赞同：3
> 
> 时间：2008-12-03T14:00:56.000
> 
> 标签：html, xslt, xslt-1.0

我想使用 xslt 输出 html 控件，但我需要能够命名控件，以便在表单回发时可以找到它们。

我希望能够命名单选按钮`"action_" + _case_id`。

```
<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="data.xsl"?>
<NewDataSet>
  <Cases>
    <Case>
      <case_id>30</case_id>
    </Case>
  <Cases>
</NewDataSet>

<?xml version="1.0" encoding="iso-8859-1"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
  <xsl:template match="/">
     <div class="your_action">
      Your action:<br />
      <input type="radio" name="?" value="No" checked ="true"/> nothing to report<br />
      <input type="radio" name="?" value="Yes" /> memo to follow
    </div>
  </xsl:template>
</xsl:stylesheet> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-03T15:07:41.640

采用：

```
**<input type="radio" name="{concat('action_', /*/*/*/case_id)}"
 值=“否”检查=“真”/>** 
```

**如果您的 xml 文档发生更改，可能需要用更详细的位置步骤替换上面的“*”字符。**

 *** * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T14:12:48.863

```
<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="data.xsl"?>
<NewDataSet>
  <Cases>
    <Case>
      <case_id>30</case_id>
    </Case>
  <Cases>
</NewDataSet>

<?xml version="1.0" encoding="iso-8859-1"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
  <xsl:template match="/">
     <xsl:variable name="actionid">action_<xsl:value-of select="Cases/Case/case_id"/></xsl:variable>
     <div class="your_action">
      Your action:<br />
      <input type="radio" name="{actionid}" value="No" checked ="true"/> nothing to report<br />
      <input type="radio" name="{actionid}" value="Yes" /> memo to follow
    </div>
  </xsl:template>
</xsl:stylesheet> 
```

注意：未经测试。您可能想要专门为 Case 节点添加一个匹配器，而不仅仅是在根节点上匹配。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T15:05:16.200

引用变量时，需要在变量前面加上 $ 符号：

```
<input type="radio" name="{$actionid}" value="No" checked ="true"/> nothing to report<br /> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-03T15:57:39.790

您的数据集具有良好的属性，即它是一棵树，每个节点都可以通过它在树中的路径来识别。我想说你最好的选择是以反映这一点的方式命名与每个 XML 节点对应的控件：

1.  NewDataSet_Cases_Case1_case_id1_rb。
2.  NewDataSet_Cases_Case1_case_id2_rb。

您只需要一种获取父节点名称的方法，例如：

```
&lt;xsl:variable name="parent1Name"
              select="name(parent::*)" /&gt; 
```

# jsp - 没有从 JSP 中的 for 循环到 if 循环中获取“索引”值

> ID：337186
> 
> 赞同：0
> 
> 时间：2008-12-03T14:01:21.057
> 
> 标签：jsp, struts2, taglib

我的 if 语句总是评估为 false 并且不进入`<span>`块。因此，我无法在 if 条件下获得“index”的值，我已经尝试了所有使用 # 和 % 附加索引的东西。有人可以提出解决方案吗？

```
<c:forEach var="index" begin="1" end="<%=a%>" step="1">
    <s:if test="index == 1">
        <span class="currentpage"><b>${page_id}</b></span>
    </s:if>
    <s:else>
        <a href="searchAction.html?page_id=${index}&searchString=${searchString}" class="paginglinks">${index}</a>
    </s:else>
</c:forEach> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-04T11:33:45.237

得到它实际上是标签中的一些冲突

它应该像

```
<c:forEach var="index" begin="1" end="<%=a%>" step="1" varStatus="status">
                            <c:choose>
                            <c:when test="${page_id==index}">                       
                                <span class="currentpage"><b>${page_id}</b></span>
                            </c:when>
                            <c:otherwise>
                            <a href="searchAction.html?page_id=${index}&searchString=${searchString}" class="paginglinks">${index}</a>
                            </c:otherwise>
                            </c:choose>
                            </c:forEach> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-30T14:25:48.993

冲突在于，在第一篇文章中，您正在混音

*   JSTL 标签（c:forEach）
*   Struts 标签（s:if）

您提出的解决方案有效，因为您现在拥有

*   JSTL 标签（c:forEach）
*   再次使用 JSTL 标记（c:when）

另一个好的解决方案是

*   Struts 标签（s:iterator）
*   再次使用 Struts 标签（s:if）

一般来说，使用来自多种技术的标签是有问题的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T14:10:17.060

测试值是不可评估的，它只是页面的一个字符串。

编辑，你有你使用strut的语法。

添加“%{}”，如下所示：

```
<s:if test="%{index == 1}"> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-03T14:13:08.707

采用

```
 test="${index == 1}" 
```

或尝试使用 varStatus 属性...

```
<c:forEach var="index" varStatus="status" begin="1" end="<%=a%>" step="1">

 <s:if test="${status.count == 1}">
  <span class="currentpage"><b>${page_id}</b></span>
 </s:if>
 <s:else>
  <a href="searchAction.html?page_id=${index}&searchString=${searchString}" class="paginglinks">${index}</a>
 </s:else>
</c:forEach> 
```

# .net - 如何编写自己的 .net 混淆器

> ID：337200
> 
> 赞同：7
> 
> 时间：2008-12-03T14:07:12.043
> 
> 标签：.net, obfuscation

我很好奇人们如何编写自己的混淆器。

简单地执行以下操作有多难：

1.  使用 GUID 类型名称重命名所有公共方法。

我从哪里开始？我将如何阅读 .net dll 程序集，将公共方法拉出并重命名它们？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-03T14:20:14.060

您可以检查使用[Cecil](http://www.mono-project.com/Cecil "塞西尔")编写开源混淆器的这两个项目：

*   [http://code.google.com/p/obfuscar/](http://code.google.com/p/obfuscar/)
*   [http://www.codeplex.com/SharpObfuscator](http://www.codeplex.com/SharpObfuscator)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-03T15:22:34.073

[Jason Haley 有一些很棒的链接...](http://jasonhaley.com/Obfuscation/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T14:21:32.683

如果您从源代码开始，则进行文本替换然后通过编译器运行代码非常简单。如果您从已编译的程序集开始，那么您需要使用 System.Reflection 命名空间中的内容来加载程序集并使用 System.CodeDom 来生成可编译的代码单元。

# ms-access - 用户如何在 MS Access 中插入空值？

> ID：337208
> 
> 赞同：9
> 
> 时间：2008-12-03T14:09:37.043
> 
> 标签：ms-access, null

MS Access 似乎支持代码中的空值，但我一生都无法弄清楚如何直接在表中输入空值。这很让人抓狂，因为一旦一个字段中输入了一个数字，它就永远不能被删除/设置为 null。通常，允许零长度字符串会解决此问题，但 Access 以不同的方式处理 null 和零长度字符串的 XML 导出。空值消除关联的 XML 标记，长度为零的字符串发送一个空标记。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-03T14:49:44.437

在表定义中设置“允许零长度字符串”选项有帮助吗？它可能会强制将空字符串解释为 NULL。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-03T14:14:44.960

您是在谈论需要在数据表视图中执行此操作吗？如果您需要在更新查询中执行此操作，您可以这样做：

```
UPDATE test SET test.test = Null; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-08-04T07:06:38.650

按 ctrl-0 并插入一个空值。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-03-31T21:24:18.093

删除所有字符都可以，但是 Access 有点变幻莫测。除非字段中有字符，否则按退格键或删除键将不起作用。我发现最好输入几个字符，全选，然后点击删除，更改焦点并更改记录。综上所述，如果您运行查询以查找“is null”，则将找到该记录。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-03T14:47:20.947

我实际上正在寻找一种让外行直接在表格中输入的方法。在 MSSQL 中，您可以简单地按 ctrl-0 并插入一个空值。删除所有字符似乎不起作用。剩下的不是空字符串，而是一个空字符串。出于出口目的，Access 对它们的处理方式不同。

我想我最终要做的是创建一个 xslt 文件以在导出期间使用，以消除空标签。这样用户就无法真正分辨出区别。

不过，能够键入空值肯定会很好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-03T17:01:22.503

好的，我认为这不是一个容易解决的问题，而且我最初的问题有点偏离目标。问题不在于空值，尽管它们与最初创建表的方式有关。如果您使用 xsd 文件来创建您计划导出的表，则在 Access 中会发生一些事情，导致这些字段的处理方式与使用编辑器创建的字段略有不同。

我找到的唯一解决方案是在表中创建一个新字段，重命名旧字段，将数据从旧字段复制到新字段并删除旧字段。

完成此操作后，XML 输出中不再包含曾经包含数据的空白字段。这可能不是最好的方法，我仍然不知道为什么会这样，但至少我可以解决这个问题。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-12-03T14:29:42.137

只需删除列中的所有字符，如果 coumn 允许，访问将为您插入一个空值。

# python - Python：项目中的项目直到项目中的停止词？

> ID：337223
> 
> 赞同：3
> 
> 时间：2008-12-03T14:11:57.383
> 
> 标签：python

免责声明：我对python相当陌生！

如果我想要一个文件的所有行，直到（编辑：并包括）包含一些字符串的行`stopterm`，有没有一种使用列表语法的方法？我希望会有类似的东西：

```
usefullines = [line for line in file until stopterm in line] 
```

目前，我有

```
usefullines = []
for line in file:
    usefullines.append(line)
    if stopterm in line:
        break 
```

这不是世界末日，但由于 Python 的其他语法非常简单，我希望有一个 1thought->1 Python line mapping。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-03T14:28:58.067

```
from itertools import takewhile
usefullines = takewhile(lambda x: not re.search(stopterm, x), lines)

from itertools import takewhile
usefullines = takewhile(lambda x: stopterm not in x, lines) 
```

这是一种保持 stopterm 行的方法：

```
def useful_lines(lines, stopterm):
    for line in lines:
        if stopterm in line:
            yield line
            break
        yield line

usefullines = useful_lines(lines, stopterm)
# or...
for line in useful_lines(lines, stopterm):
    # ... do stuff
    pass 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-03T14:26:43.733

“我希望 1 个想法 ->1 个 Python 线映射。” 难道我们不都喜欢一种以某种方式反映我们的自然语言的编程语言吗？

你可以做到这一点，你只需要定义一次你独特的想法。然后你就有了你希望的 1:1 映射。

```
def usefulLines( aFile ):
    for line in aFile:
        yield line
        if line == stopterm:
            break 
```

差不多吧。

```
for line in usefulLines( aFile ):
    # process a line, knowing it occurs BEFORE stopterm. 
```

还有更通用的方法。`lassevk`答案是`enum_while`和`enum_until`是这种简单设计模式的概括。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-03T15:48:06.347

itertools 解决方案很简洁。我之前对 itertools.groupby 感到惊讶，这是一个方便的工具。

但是，如果我可以在没有 itertools 的情况下做到这一点，我仍然只是在修补。所以它就是这样（虽然有一个假设和一个缺点：文件并不大，并且它分别在行上进行了一次额外的完整迭代。）

我创建了一个名为“try”的示例文件：

```
hello
world
happy
day
bye 
```

一旦您阅读了文件并将这些行放在变量名行中：

```
lines=open('./try').readlines() 
```

然后

```
 print [each for each in lines if lines.index(each)<=[lines.index(line) for line in lines if 'happy' in line][0]] 
```

给出结果：

```
['hello\n', 'world\n', 'happy\n'] 
```

和

```
print [each for each in lines if lines.index(each)<=[lines.index(line) for line in lines if 'day' in line][0]] 
```

给出结果：

```
['hello\n', 'world\n', 'happy\n', 'day\n'] 
```

所以你得到了最后一行 - 还包括停止项行。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-03T14:20:10.860

## 忘掉这个

留下答案，但将其标记为社区。**有关执行此操作的正确**方法，请参阅[Stewen Huwig](https://stackoverflow.com/users/28604/steven-huwig)的答案。

 *** * *

好吧，[x for x in enumerable] 将一直运行，直到 enumerable 不再产生数据，if 部分将允许您一路过滤。

你可以做的是添加一个函数，并通过它过滤你的枚举：

```
def enum_until(source, until_criteria):
    for k in source:
        if until_criteria(k):
            break;
        yield k;

def enum_while(source, while_criteria):
    for k in source:
        if not while_criteria(k):
            break;
        yield k;

l1 = [k for k in enum_until(xrange(1, 100000), lambda y: y == 100)];
l2 = [k for k in enum_while(xrange(1, 100000), lambda y: y < 100)];
print l1;
print l2; 
```

当然，它看起来不像你想要的那么好......

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-03T14:42:23.577

我认为保持这种状态很好。复杂的单线并不是真正的pythonic，而且由于Guido必须在某个地方设置一个限制，我想就是这样......

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-03T16:57:50.573

我会选择[Steven Huwig](https://stackoverflow.com/questions/337223/python-item-for-item-until-stopterm-in-item#337285)或S.Lott[的](https://stackoverflow.com/questions/337223/python-item-for-item-until-stopterm-in-item#337279)解决方案来实际使用，但作为一个有点 hacky 的解决方案，这是获得这种行为的一种方法：

```
def stop(): raise StopIteration()

usefullines = list(stop() if stopterm in line else line for line in file) 
```

它稍微滥用了这样一个事实，即任何引发 StopIteration 的东西都会中止当前的迭代（这里是生成器表达式）并且比你想要的语法更难读，但是会起作用。

# asp.net - 显示时隐藏的面板无法正确居中

> ID：337229
> 
> 赞同：0
> 
> 时间：2008-12-03T14:13:13.963
> 
> 标签：asp.net, ajax, asp.net-ajax

我有一个简单的 AlwaysVisibleControlExtender，它扩展了一个包含“正在加载...”消息和动画 GIF 的小面板。整个事情都在一个 UpdateProgress 控件中，所以它只在我的应用程序正在处理时显示。我已将其设置为显示在顶部中心。它工作正常，但我注意到它显示在它应该在的位置的右​​侧。如果我稍微调整窗口大小，面板会捕捉到正确的位置。

我的猜测是它在 UpdateProgress 控件允许渲染面板之前计算中心的位置，因此面板的宽度为零。只有在面板显示后，它才能正确计算中心。有解决方法吗？

**更新：**这是标记：

```
<%@ Page Language="VB" MasterPageFile="~/Compass.master" AutoEventWireup="false" CodeFile="SubmissionPrep.aspx.vb" Inherits="SubmissionPrep" Title="Untitled Page" %>

<%@ Register Assembly="AjaxControlToolkit" Namespace="AjaxControlToolkit" TagPrefix="ajax" %>
<asp:Content ID="Content1" ContentPlaceHolderID="ContentPlaceHolder1" runat="Server">
    <asp:UpdatePanel ID="UpdatePanel" runat="server" UpdateMode="Always">
        <ContentTemplate>
            <%-- Data and Controls here --%>
            <asp:UpdateProgress ID="ProcessingUpdateProgress" runat="server">
                <ProgressTemplate>
                    <asp:Panel ID="ProcessingPanel" runat="server" CssClass="loading">
                        Processing...
                        <img src="images/ajax-loader.gif" alt="" />
                    </asp:Panel>
                    <ajax:AlwaysVisibleControlExtender ID="ProcessingAlwaysVisibleControlExtender" runat="server"
                        TargetControlID="ProcessingPanel" VerticalSide="Top" HorizontalSide="Center">
                    </ajax:AlwaysVisibleControlExtender>
                </ProgressTemplate>
            </asp:UpdateProgress>
        </ContentTemplate>
    </asp:UpdatePanel>
</asp:Content> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-08-10T05:37:56.227

我已经在这篇文章的帮助下实现了 Progressbar，所以我没有遇到任何问题
这是一篇很棒的文章.....并逐步解释了 setp，请检查

[http://www.codedigest.com/Articles/ASPNETAJAX/125_Using_UpdateProgress_Control_Effectively.aspx](http://www.codedigest.com/Articles/ASPNETAJAX/125_Using_UpdateProgress_Control_Effectively.aspx)

# javascript - 在没有编程经验的情况下，我应该使用哪种 CMS 来管理小型 Internet 站点？

> ID：337236
> 
> 赞同：5
> 
> 时间：2008-12-03T14:14:59.250
> 
> 标签：javascript, html, content-management-system

我正在寻找一个 CMS 系统来管理一个简单而小型的网站。该网站将使用纯 HTML 和一些 JavaScript（可能是原型库）制作。我在寻找CMS系统的原因是，因为客户以后有能力自己更改内容，当然他没有任何HTML和JavaScript或编程经验。

CMS 应该非常易于使用，尤其是管理。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-03T14:18:54.327

我个人会推荐[WordPress](http://wordpress.org/)。尽管它作为博客平台被“营销”，但它对“页面”的支持非常好。

*   免费;
*   它通常在 cPanel 安装中可用，或者很容易在您自己的服务器上设置；
*   它有非常流畅的编辑功能；
*   有大量可用的主题和文档。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-03T15:48:24.537

[http://www.opensourcecms.com/](http://www.opensourcecms.com/)有一堆 cms 的演示供您尝试。

就个人而言， [http://www.concrete5.org/](http://www.concrete5.org/)将是我的选择，方便非程序员使用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T21:42:04.010

如果这个网站涉及电子商务，我会推荐[Joomla](http://www.joomla.org/)，因为它有一个流行的电子商务插件，叫做[VirtueMart](http://virtuemart.net/)。Joomla 具有良好的社区支持、许多插件，其功能使其非常可扩展和可定制。Joomla 也有很好的用户管理。然而，起初使用 Joomla 可能很困难，因为它的内容组织相当复杂。

如果该网站由基本的类似博客的网页组成，那么[WordPress](http://wordpress.org/)就是要走的路。WordPress 是一个非常简单的博客 CMS，拥有庞大的用户社区。它非常易于使用，有许多插件，最新版本的 WordPress 甚至具有自动更新功能。不过，在用户管理方面，WordPress 不如 Joomla 好。例如，Joomla 可以准确指定用户和用户组可以访问的内容。WordPress 有基本的用户组，但需要额外的自定义和插件才能拥有该功能。

[OpenSourceCMS](http://www.opensourcecms.com/)包含 Joomla 和 WordPress 的演示。

在我过去的 Web 开发经验中，我为我的客户使用过 Joomla 和 WordPress。Joomla 通常需要与客户坐下来讨论如何使用该软件的基本功能，而 WordPress 很容易让客户在没有任何帮助的情况下弄清楚。然而，我使用过的 WordPress 网站需要的不仅仅是标准的博客功能（例如电子商务、图片库、论坛），通常涉及将 WordPress 与单独的软件应用程序集成，而 Joomla 往往没有这些插件可用为了它。最终结果是一个安装了多个应用程序（例如，WordPress、Coppermine、phpBB）的网站，每个应用程序都有单独的登录和管理屏幕。

对于具有基本功能的简单易用的网站，我建议使用 WordPress。对于具有特定需求（例如电子商务）和扩展潜力的网站，我建议使用 Joomla。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-03T14:26:17.917

发现[Drupal](http://drupal.org/)非常简单，它可以和你一起成长

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-03T14:27:07.977

这也取决于您自己的技能水平，但我会使用具有良好前端编辑实现的 CMS，因此客户甚至不必经常登录管理区域。

你可以选择：

*   [银条](http://www.silverstripe.com)
*   [Joomla](http://www.joomla.org)
*   [WordPress](http://www.wordpress.com)（不是这样的 CMS）
*   [Drupal](http://www.drupal.org)（是一个很好的 CMS，但我认为它不适合您的需求，因为它的管理后端对于非技术人员来说不太容易理解。）

对于不精通技术的最终用户**，我推荐 Joomla**（1.5 系列），因为它很难破解和组件/插件/等。位于中心位置 (joomla.org)，易于安装和卸载。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-08T18:40:08.837

你说“纯 HTML”，所以[http://www.cushycms.com/](http://www.cushycms.com/)会做你想做的事。观看演示，它非常流畅和简单，虽然没有多余的装饰，但你不需要任何东西，它只是完成了工作；）

此外，[http://www.synthasite.com/](http://www.synthasite.com/)是一个很好的网站创建工具，可以快速启动和运行。

您可以为表单、提要、照片、地图等添加 3rd 方插件，然后它将所有这些导出为 HTML，或者它可以发布到您的 FTP 站点，我认为他们也可以为您托管它。[http://www.synthasite.com/tutorials](http://www.synthasite.com/tutorials)

使用 Synthasite 和 CushyCMS 是获得“纯 HTML”并以极快的速度运行的绝佳组合。

[http://www.squarespace.com](http://www.squarespace.com)，不是免费的，但很容易让你的奶奶微笑。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-03T14:39:03.070

像 stusmith 一样，如果需求真的很基础，我会选择 wordpress。它真的很简单，易于安装然后处理。

但是如果你需要一个真正的 CMS，Drupal 仍然不复杂而且非常强大。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-01T18:58:46.630

我很惊讶还没有人提到[Plone](http://www.plone.org)。这是一款非常适合您描述的需求的开源产品。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-03T14:25:03.473

一个好的 .Net 是 Umbraco...

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-04T07:50:26.997

一个简单的 cms 例如 Zimplit，它有一个在线编辑器，因此您的客户可以直接在现场编辑他们的页面，没有管理区域，您也可以使用任何您想要的 html 模板，您可以查看[演示](http://demo.zimplit.org/zimplit.php)或阅读更多信息关于[它](http://www.zimplit.org/)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-08T18:53:48.700

古德，

看看[typolight](http://www.typolight.org)，它有我见过的最好的后端。这很容易理解。[登录](http://demo.typolight.org/typolight/)到演示后端并玩得开心：D

问候，塞巴斯蒂安

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-04T08:14:48.633

[凯霍加](http://www.cuyahoga-project.org)呢？这是一个 .NET CMS Web 应用程序，具有非常简单的编辑 + 管理界面 + 它非常面向模块。开发人员也很容易创建自己的自定义模块。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-02-02T15:10:06.080

If it is a pure HTML site use Veolay CMS. This CMS doesn’t use database but it has a good content and user management system. for example if you want to edit a div then you have to add a class with veoaly- Content here can be edit... and you can assign users to edit “EditMe” region. Try the demo [http://www.veolay.com/livedemo/](http://www.veolay.com/livedemo/) to take a good idea. Read more [http://veolay.com/features.html](http://veolay.com/features.html)

# vb6 - 使用 VB6，如何在 Windows XP 上获取当前用户和域？

> ID：337237
> 
> 赞同：5
> 
> 时间：2008-12-03T14:15:14.787
> 
> 标签：vb6, windows-xp

我需要当前用户和域。我正在使用 VB 6 应用程序。

谢谢

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-12-03T14:22:52.633

一种方法是询问环境：

```
Dim UserName As String
Dim UserDomain As String
UserName   = Environ("USERNAME")
UserDomain = Environ("USERDOMAIN") 
```

（显然，仅适用于 Windows NT 及更高版本。）

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-03T14:50:37.353

和 API 版本：

```
Private Declare Function GetUserName Lib "advapi32.dll" Alias "GetUserNameA" (ByVal lpBuffer As String, nSize As Long) As Long  

Declare Function LookupAccountName Lib "advapi32.dll" Alias "LookupAccountNameA" (lpSystemName As String, ByVal lpAccountName As String, sid As Any, cbSid As Long, ByVal ReferencedDomainName As String, cbReferencedDomainName As Long, peUse As Long) As Long

Private Sub Form_Load()  
     Dim sDomainName As String * 255   
     Dim lDomainNameLength As Long     
     Dim sUserName as String
     Dim bUserSid(255) As Byte      
     Dim lSIDType As Long 

    Rem Create a buffer
    sUserName = String(100, Chr$(0))  

    Rem Get the username
     GetUserName sUserName, 100  

    Rem strip the rest of the buffer
    sUserName = Left$(sUserName, InStr(sUserName, Chr$(0)) - 1)

     rem Show the temppath and the username
     MsgBox "Hello " + strUserName 

     lResult = LookupAccountName(vbNullString, sUserName, bUserSid(0), 255, sDomainName, lDomainNameLength, _
  lSIDType)
    if lResult <>0 then
       msgbox sDomainName
    end if
end sub 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-03T14:50:39.177

使用 WshNetwork 对象的以下方法，在您的项目中引用 Windows 脚本宿主对象模型后可用：

```
Dim Network As WshNetwork
Set Network = New WshNetwork

Debug.Print "ComputerName: " & Network.ComputerName
Debug.Print "UserDomain: " & Network.UserDomain
Debug.Print "UserName: " & Network.UserName 
```

为了保持一致性，我将结果转换为大写或小写，但这些是您需要的方法。

请注意，当在未登录域的机器上运行时，ComputerName 和 UserDomain 返回相同的东西——计算机名称。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-03T14:38:26.817

基本上你需要进行 Windows API 调用。搜索 vbnet.mvps.org 我得到以下答案。

*   [获取域名](http://vbnet.mvps.org/index.html?code/network/getdomainname.htm)
*   [获取线程用户名（运行方式）](http://vbnet.mvps.org/index.html?code/core/getusername.htm)
*   [获取登录用户](http://vbnet.mvps.org/index.html?code/core/wnetgetuser.htm)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-03T14:24:29.543

那这个呢？

```
Private Function IsAdmin() As Boolean
Dim groups As Object
Dim user As Object

Set groups = GetObject("WinNT://./administrators")

For Each user In groups.members

If UCase(Environ("USERNAME")) = UCase(user.Name) Then
IsAdmin = True
End If

Next user

End Function 
```

# c# - 为什么自动属性需要 getter 和 setter？

> ID：337239
> 
> 赞同：4
> 
> 时间：2008-12-03T14:15:58.530
> 
> 标签：c#, .net, automatic-properties

在 C# 中，如果我声明一个自动实现的属性，为什么我必须同时声明 get 和 set 部分？

IE

```
public string ThisWorks { get; set; }

public string ThisDoesnt { get; } 
```

这不只是语法糖——即编译器为属性插入一个私有字段吗？那么为什么会出现问题呢？

好奇的。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-12-03T14:20:10.377

如果您没有 setter - 那么您将如何设置属性？

顺便说一句，您可以指定可访问性，例如：

```
public string Foo
{
  get;
  private set;
} 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-03T14:20:38.007

如果没有 setter，您将永远无法提供值 - 因为您无法指定支持变量的名称。

我请求了一个只读的自动属性，声明如下：

```
public string ReadonlyProperty { get; readonly set; } 
```

这将创建一个只读的后备变量，一个只有一个 getter 的属性，并将所有对 setter 的调用转换为对变量的直接访问。您只能在构造函数中调用 setter - 就像普通的只读变量一样。

我们将看看这个请求是否有任何好处......很遗憾它目前不在那里，因为它使得实现不可变类型比实现可变类型更难:(

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-12-03T14:20:13.887

自动实现的属性没有可访问的私有存储，因此如果没有 setter，您将无法设置值，使其完全无用。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-03T14:20:47.880

你需要一个集合——否则，你的自动实现的属性如何获得它的价值？自动实现该属性时，您必须有一个 set 访问器，以便在构造期间至少为其赋予一个值。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-11-04T14:53:02.023

有趣的是，Visual Studio 2015 中的新 Roslyn 编译器现在允许这样做，即使项目配置为使用 C# 版本 5。

# c# - 为什么 Visual Studio 的表适配器查询不返回与它所代表的存储过程相同的数据？

> ID：337240
> 
> 赞同：0
> 
> 时间：2008-12-03T14:17:39.633
> 
> 标签：c#, sql, visual-studio, tableadapter, data-access-layer

我在 Visual Studio 中使用表适配器来查询我的 SQL Server 2005 数据库中的存储过程。当我通过我的网站应用程序拨打电话时，它什么也不返回。当我通过 SQL Server Manager 进行相同的调用时，它会返回预期的数据。

我在对适配器方法的调用上放置了一个断点，`getData`并查看了所有参数及其值，并在服务器管理的查询中匹配它们以确保。我正在发送以下查询：

```
getData(string, date, date, int, int?, int?, string, int?, string) 
```

更远

```
getData('0000-rtg', '1/1/2007', '3/12/2008', 0, null, null, null, null, null) 
```

我想我想知道 Visual Studio`null`在尝试将查询发送到 SQL 服务器之前是否对 's 做了一些事情。如果没有，我该如何解决这个问题？

编辑：所有这些值都由变量传递，我只是在那个断点输入了这些变量中的内容。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T14:34:25.340

日期需要在 SQL 中用引号括起来，否则它们不起作用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T14:51:50.313

使用 Sql Profiler 查看发送到 sql server 的 sql 的实际样子。这帮助了我很多次。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-09T19:52:16.117

Visual Studio 的查询参数很有趣。确保每个变量都具有正确的长度和类型。例如，我在查询中使用了几个日期参数。每次我编辑查询时，Visual Studio 都会自动检测日期参数并将变量的长度限制为 7。我将日期作为“2009 年 9 月 12 日”传入，它被截断为“20 年 9 月 12 日”，所以我需要手动将我的日期参数更改为 10 的长度。

# junit - 应该测试@Entity Pojos 吗？

> ID：337241
> 
> 赞同：5
> 
> 时间：2008-12-03T14:18:03.673
> 
> 标签：junit

我不知道我是否应该测试我的@Entity 注释 Pojos。毕竟，主要只是生成的 getter/setter。我应该测试它们吗？

在测试 DAO 时，我使用了所有这些实体——所以我猜它们已经经过适当的测试了？

谢谢你的想法。

马特

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-03T14:21:29.330

你的代码可以包含任何错误吗？如果不是，那么测试它的意义何在？事实上，试图测试它只会引入新的错误（因为你的测试可能是错误的）。

所以结论是：你不应该在没有代码的情况下测试getter和setter（即那些只分配或读取字段而没有任何额外代码的）。

例外情况是：当您手动编写这些 getter/setter 时，因为您可能打错了。但即便如此，一些代码将使用这些代码，并且应该对该代码进行测试，进而测试 getter/setter 的行为是否正确。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-03T14:24:42.413

我能想到写测试的唯一原因是测试 @Entity 注释本身。测试值的存储和检索似乎是在怀疑我们的编程环境的基本能力:)

# rdp - 关于如何编写自己的 RDP 客户端的参考

> ID：337244
> 
> 赞同：2
> 
> 时间：2008-12-03T14:18:54.857
> 
> 标签：rdp

我希望能够在远程机器上运行应用程序时访问一些特定于设备的数据。问题是，如果 RDP 窗口最小化，则此数据不可用。我正在研究的一种解决方案是编写自己的 RDP 客户端，以便服务器机器始终认为它具有活动显示（即使客户端机器被锁定）。

有谁知道如何开发 RDP 客户端（最好在 .NET 中）的参考资料？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-03T14:23:13.523

查看 Codeplex 的[终端](http://www.codeplex.com/Terminals)。开源多个 RDP 客户端；浏览代码以获取一些提示。

# c# - C# 控制台/CLI 解释器？

> ID：337254
> 
> 赞同：29
> 
> 时间：2008-12-03T14:21:00.393
> 
> 标签：c#, .net, read-eval-print-loop

我想知道是否有类似 Visual Studios“即时窗口”的独立版本？有时我只是想测试一些简单的东西，比如“DateTime.Parse(“blah”)”，看看它是否有效。但是每次我必须创建一个新的控制台应用程序时，输入我的代码并对其进行测试。

遗憾的是，即时窗口仅在我调试某些东西时才有效。PowerShell 能做到这一点吗？只需打开一个类似于 cmd.exe 的 CLI，允许我执行一些 C# 代码？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-12-03T14:32:04.770

Linqpad - 我一直都这样使用它。 [http://www.linqpad.net/](http://www.linqpad.net/)

不要被这个名字误导——它只是描述了它的原始动机，而不是它的功能。

就在最近，他发布了一个具有正确语句完成功能的版本——这是一个收费的附加组件（核心工具是免费的），但我认为只需少量的钱，而且非常值得。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-03T14:26:40.410

Mono 项目包含一个交互式 C# shell，这可能正是您正在寻找的。

[http://www.mono-project.com/CsharpRepl](http://www.mono-project.com/CsharpRepl)

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2015-12-01T23:43:54.853

*C# 交互式*窗口和*csi.exe* REPL 已添加到**Visual Studio 2015 Update 1**：

> # 介绍互动
> 
> 交互式窗口又回来了！C# 交互窗口在 Visual Studio 2015 更新 1 中返回，同时还提供了一些其他交互功能：
> 
> *   **C# 交互式**. C# 交互式窗口本质上是一个读取-评估-打印-循环 (REPL)，它允许您使用 .NET 技术进行游戏和探索，同时利用 IntelliSense、语法着色等编辑器功能。了解有关如何使用 C# 的更多信息在第 9 频道进行互动或阅读我们的初学者演练。
>     
>     
> *   **CSI** _ 如果您不想打开 Visual Studio 来玩弄 C# 或运行脚本文件，可以从开发人员命令提示符访问交互式引擎。键入`csi /path/myScript.csx`以执行脚本文件，或仅键入`csi`以放入命令行 REPL。
>     
>     
> *   **脚本 API**。脚本 API 使您能够在主机创建的执行环境中执行 C# 代码片段。通过查看我们的代码示例，您可以了解有关如何创建自己的 C# 脚本引擎的更多信息。

请参阅[.NET 托管语言的 Visual Studio Update 1 中的新增功能](https://devblogs.microsoft.com/dotnet/whats-new-in-visual-studio-update-1-for-net-managed-languages/)。

基本上，现在你有：

*   IDE REPL — VS 中的 C# 交互窗口
*   脚本解释器——`csi foo.csx`来自 Dev Cmd Prompt
*   命令行 REPL —`csi`来自 Dev Cmd Prompt
*   脚本 API

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2013-06-06T17:52:33.577

试试[scriptcs](http://scriptcs.net/)，它没有集成到 VS IDE 中，但它确实允许您在脚本窗口中键入和运行 C#，而无需项目编译器等...

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-12-03T14:23:31.057

好吧，这不是您问题的直接答案，但是您可以查看此工具：

*   [片段编译器](http://www.sliver.com/dotnet/SnippetCompiler/)

此外，如果您想查看生成的 IL 或类似内容，则有一个插入到[Reflector](http://www.red-gate.com/products/reflector/)的工具，称为[Snippy](http://msmvps.com/blogs/jon_skeet/archive/2008/11/23/the-snippy-reflector-add-in.aspx)，它基于 Jon 在他自己的答案中进一步提到的 Snippy 工具。

所有这些都非常好用。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-12-03T14:32:40.027

正如你所建议的，PowerShell 可以做你想做的事。例如，要测试你的 DateTime.Parse，下面的一个衬里就可以了：

PS C:\Documents and Settings\Dan> **[System.DateTime]::Parse("Blah")**
使用“1”参数调用“Parse”的异常：“字符串未被识别为有效的 DateTime。有从索引 0 开始的未知单词。” 在 line:1 char:25 + [System.DateTime]::Parse(<<<< "Blah")

PS C:\Documents and Settings\Dan> **[System.DateTime]::Parse("1/2/3")**

2003 年 2 月 1 日 00:00:00

请注意，以上使用的是当前版本的 PowerShell (v1.0)。PowerShell 的下一个版本将允许您更直接地将 C# 与 PowerShell 脚本混合。为了激发您的胃口，请观看[Doug Finke的 7 分钟截屏视频“](http://dougfinke.com/blog/) [C# 到 PowerShell](http://dougfinke.com/video/CSharpToPowerShell..html) ” 。非常令人印象深刻！

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-12-03T14:26:12.533

如果您使用的是 Mono，则如下：

[CsharpRepl](http://www.mono-project.com/CsharpRepl)

几年前， Don Box也[破解了一些非常简单的东西。](http://www.pluralsight.com/community/blogs/dbox/archive/2005/05/26/8626.aspx)

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-12-03T14:29:04.197

按照 lassevk 的回答，我得到了["Snippy"](http://csharpindepth.com/Downloads.aspx)。这是为 C# in Depth 开发的，UI 很垃圾，但它可以工作 - 并且还允许您编写额外的成员（方法、嵌套类等），例如

```
public static void Foo()
{ 
    Console.WriteLine("Hello");
}
...
Foo(); 
```

（... 用于告诉 Snippy “这里的所有内容都属于 Main”。）

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-06-06T17:47:30.517

我们刚刚发布了**CShell**一个功能齐全的 C# REPL IDE。它支持代码完成、脚本文件、添加引用，并且是真正可扩展的。此外，我们计划很快添加 NuGet 支持，这将使编写一些代码并查看它是如何工作的变得超级快。

[http://cshell.net/](http://cshell.net/)

![CShell 截图](https://i.stack.imgur.com/ZznGo.png)

我们喜欢 LINQPad，但它没有 REPL，代码只执行一次，除非您修改脚本并再次运行整个脚本，否则您无法对结果进行任何进一步的处理。这很好，但有时如果你想要更多的脚本感觉，那么在 REPL 中评估你的代码真的很好也很方便。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-12-03T14:30:28.250

我还发现[SharpDevelop](http://www.icsharpcode.net/OpenSource/SD/)非常快速和轻量级，它是快速启动测试项目的最简单方法。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-03T14:43:52.997

您可能会发现 Object Test Bench 很有用。它不是很为人所知，但可以让您创建类的实例、执行静态方法等等。它对于发现如何使用不熟悉的 API 或快速调试您自己的类和方法很有用，无需创建测试工具以进行简单检查。

您可以在此处找到 MSDN 文档：

[http://msdn.microsoft.com/en-us/library/c3775d98%28VS.80%29.aspx](http://msdn.microsoft.com/en-us/library/c3775d98%28VS.80%29.aspx)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-12-03T16:39:10.567

如果你能等一会儿.. 看起来可能有一个 C# 相当于 Ruby 的 irb 及时用于 C# 4.0 Anders H. 演示了一个交互式控制台会话，您可以在其中键入任意 C# 代码并在他的“ [C#的未来”中](http://channel9.msdn.com/pdc2008/TL16/)查看结果' 在 PDC 2008 上发表的文章。您甚至可以从中弹出一个 WPF 窗口，然后通过控制台界面使用它。很酷。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-06-19T17:47:57.907

使用[LINQPad](http://linqpad.net)。

尽管有名称，它可以执行任何 C# 或 VB 代码，从简单的表达式到整个类。

另外，它可以在结果中可视化整个对象图。

您甚至可以添加对您自己的程序集的引用。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2012-08-03T04:13:25.883

尝试作为[O2 平台](http://diniscruz.blogspot.co.uk/p/owasp-o2-platform.html)一部分的[C# REPL 脚本环境](http://diniscruz.blogspot.co.uk/p/c-repl-script-environment.html)。这正是您所要求的。

它将为您提供一个完美的环境来尝试所有 C# 功能和 API（从概念上讲，O2 REPL 环境类似于 LinqPAD）

您还应该看看 Microsoft 的 Roslyn。在[多个基于 Roslyn 的工具上（均在 VisualStudio 之外独立运行）](http://diniscruz.blogspot.co.uk/2012/08/multiple-roslyn-based-tools-all-running.html)，第一个是简单的 Roslyn REPL

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2010-11-24T17:45:38.257

如果您碰巧知道并喜欢 Python，那么[IronPython](http://ironpython.net/)可能是一个不错的选择。它带有一个 (Python) REPL 控制台 (ipy.exe)，您可以在其中导入和使用所有 .Net 类型。

我发现它对于测试小东西很有用，就像`DateTime.Parse("Blah")`.

请注意，它实际上不能执行 C# 代码，但如果您只想访问 .Net，那么它是完美的。此外，如果您安装了[IronPython Tools for VS](http://ironpython.net/tools/)，您可以使用单个键盘快捷键 (Alt+I) 在 VS 中启动 REPL 会话，并在需要时让它在停靠窗口中运行。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2016-02-10T00:45:23.023

更新：[http ://avillenas.com/post/interactive-c](http://avillenas.com/post/interactive-c)

嗯，你可以试试这个。

1.  下载并安装 dotnet.github.io
2.  打开命令
3.  输入“dotnet repl”
4.  键入您需要的任何内容。

我做了你想做的事。[点击这里查看 gif](http://i.stack.imgur.com/yJrnM.gif)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2016-09-23T14:00:00.583

Roslyn 项目源包含一个名为 CSI ( [http://sourceroslyn.io/#csi/Csi.cs](http://sourceroslyn.io/#csi/Csi.cs) ) 的 REPL。Csi 类目前是内部的，但是对于“csi”项目 (Roslyn.sln: Interactive/Hosts/csi) 有一个可执行的控制台应用程序可用，它支持例如命令 #r 加载程序集和 #load 加载和执行脚本文件（启动 csi 并使用#help）。

# java - 在 Java 对象中存储本机指针的“正确”方法是什么？

> ID：337268
> 
> 赞同：27
> 
> 时间：2008-12-03T14:24:07.483
> 
> 标签：java, java-native-interface

在 Java 对象中存储本机指针的“正确”方法是什么？

如果我碰巧知道本机指针的大小 <= 32 位，我可以将指针视为 Java `int`，或者`long`如果我碰巧知道本机指针的大小 <= 64 位，我可以将指针视为 Java 。但是有没有更好或更清洁的方法来做到这一点？

**编辑**：从 JNI 函数返回本机指针正是我*不想*做的。我宁愿返回一个代表本机资源的 Java 对象。但是，我返回的 Java 对象可能必须有一个包含指针的字段，这让我回到了最初的问题。

或者，是否有更好的方法让 JNI 函数返回对本机资源的引用？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-12-03T14:47:52.023

IIRC，两者`java.util.zip`都只`java.nio`使用`long`.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2016-03-21T02:18:31.913

`java.nio.DirectByteBuffer`做你想做的事。

在内部，它使用 a`private long address`来存储指针值。*呸！*

使用 JNI 函数`env->NewDirectByteBuffer((void*) data, sizeof(MyNativeStruct))`在 C/C++ 端创建 DirectByteBuffer，并将其作为 ByteBuffer 返回到 Java 端。**注意：**在本机端释放这些数据是你的工作！它错过了标准 DirectBuffer 上可用的自动清洁器。

在 Java 端，您可以通过这种方式创建 DirectByteBuffer：

```
ByteBuffer directBuff = ByteBuffer.allocateDirect(sizeInBytes); 
```

认为它是一种 C 的 `malloc(sizeInBytes)`。**注意：**它具有自动清理程序，可释放先前请求的内存。

但是使用 DirectByteBuffer 有几点需要考虑：

*   如果您错过了直接的 ByteBuffer 引用，它可能会被垃圾收集 (GC)。
*   您可以读取/写入指向结构的值，但要注意偏移量和数据大小。编译器可能会为填充添加额外的空间并破坏您假定的结构内部偏移量。带有指针的结构（步幅是 4 还是 8 字节？）也会让您的数据感到困惑。
*   Direct ByteBuffers 很容易作为本地方法的参数传递，也很容易将其作为返回值返回。
*   您必须在 JNI 端强制转换为正确的指针类型。返回的默认类型`env->GetDirectBufferAddress(buffer)`是`void*`。
*   一旦创建，您将无法更改指针值。
*   您的工作是释放先前分配给本机缓冲区的内存。你用的那些`env->NewDirectByteBuffer()`。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-03T14:49:16.310

没有什么好办法。在 SWT 中，使用以下代码：

```
int /*long*/ hModule = OS.GetLibraryHandle (); 
```

并且有一个工具可以通过移动注释在 32 位和 64 位之间转换代码。丑陋但有效。如果 Sun 添加了一个对象“NativePointer”或类似的东西，事情会容易得多，但他们没有。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-03T14:32:18.327

更好的方法可能是将它存储在字节数组中，因为本机指针首先不是非常Java-ish。`int`s 和`long`s 更好地保留用于存储数值。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-03T14:32:46.110

我假设这是从一些 JNI 代码返回的指针，我的建议是*不要这样做*:)

理想情况下，JNI 代码应该将某种对资源的逻辑引用传回给您，而不是实际的指针？

至于您的问题，没有想到一种更简洁的存储指针的方法-如果您知道自己拥有什么，则根据需要使用 int 或 long 或 byte[] 。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-03T14:41:33.970

您可以查看 C# 使用 IntPtr 类型处理此问题的方式。通过创建自己的类型来保存指针，相同的类型可以用作 32 位或 64 位，具体取决于您所在的系统。

# objective-c - 延迟通话，有可能取消吗？

> ID：337272
> 
> 赞同：5
> 
> 时间：2008-12-03T14:24:45.860
> 
> 标签：objective-c, cocoa

如何触发延迟，假设我想在 3 秒后调用一个方法（一次），如果需要，如何取消该调用？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-03T15:30:33.700

您也可以使用`-[NSObject performSelector:awithObject:afterDelay:]`和`+[NSObject cancelPreviousPerformRequestsWithTarget:selector:object]`。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-03T14:34:02.127

使用*NSTimer*。使用它在三秒钟内设置对*方法的调用。*它只会被调用一次：

```
 [NSTimer scheduledTimerWithTimeInterval: 3
                                    target: self
                                  selector: @selector(method:)
                                  userInfo: nil
                                   repeats: NO]; 
```

*方法*需要如下所示：

```
- (void) method: (NSTimer*) theTimer; 
```

您可以使用*userInfo*将参数传递给方法（在上面的示例中设置为*nil*）。它可以在方法中以*[theTimer userInfo]*的形式访问。

使用 NSTimer 上的*invalidate*方法取消它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T14:32:15.627

在你的标题中..

```
NSTimer *timer; 
```

当你想设置..

```
timer = [NSTimer scheduledTimerWithTimeInterval:3.0 target:self selector:@selector(yourMethod:) userInfo:nil repeats:NO]; 
```

当你想取消..

```
[timer invalidate]; 
```

# javascript - 如何检查嵌入的 SVG 文档是否加载到 html 页面中？

> ID：337293
> 
> 赞同：41
> 
> 时间：2008-12-03T14:29:55.833
> 
> 标签：javascript, jquery, dom, svg

我需要编辑（使用 javascript）嵌入在 html 页面中的 SVG 文档。

加载 SVG 后，我可以访问 SVG 的 dom 及其元素。但我无法知道 SVG dom 是否已准备好，因此在加载 html 页面时，我无法在 SVG 上执行默认操作。

要访问 SVG dom，我使用以下代码：

```
var svg = document.getElementById("chart").getSVGDocument(); 
```

其中“chart”是嵌入元素的 id。

如果我在 html 文档准备好时尝试访问 SVG，以这种方式：

```
jQuery(document).ready( function() {
var svg = document.getElementById("chart").getSVGDocument();
... 
```

svg 始终为空。我只需要知道它什么时候不为空，这样我就可以开始操作它了。你知道有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2010-08-18T09:19:02.947

在主文档中的嵌入元素（例如“embed”、“object”、“iframe”）上添加一个`onload`调用您的函数的属性，或在脚本中添加事件侦听器，例如`embeddingElm.addEventListener('load', callbackFunction, false)`. 另一种选择可能是听`DOMContentLoaded`，这取决于你想要它。

您还可以在主文档上添加负载侦听器。`jQuery(document).ready`并不意味着所有资源都已加载，只是文档本身有一个准备好执行操作的 DOM。但是请注意，如果您侦听整个文档的负载，则在加载该文档中的所有资源、css、javascript 等之前，不会调用您的回调函数。

但是，如果您使用内联 svg，则`jQuery(document).ready`可以正常工作。

进一步说明，您可能需要考虑使用`embeddingElm.contentDocument`（如果可用）而不是`embeddingElm.getSVGDocument()`.

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2015-11-26T09:32:49.213

> 您可以使用**onload**事件进行检查。

**假设 some.svg 嵌入在对象标签中：**

```
<body>    
<object id="svgholder" data="some.svg" type="image/svg+xml"></object>
</body> 
```

**jQuery**

```
var svgholder = $('body').find("object#svgholder");

svgholder.load("image/svg+xml", function() {
    alert("some svg loaded");
}); 
```

**javascript**

```
var svgholder = document.getElementById("svgholder");

svgholder.onload = function() {
    alert("some svg loaded");
} 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2013-10-02T15:49:18.303

假设您的 SVG 在`<embed>`标签中：

```
<embed id="embedded-image" src="image.svg" type="image/svg+xml" /> 
```

SVG 图像本质上是在一个子文档中，该子文档将具有`load`与主文档不同的事件`document`。但是，您可以侦听此事件并进行处理：

```
var embed = document.getElementById("embedded-image");
embed.addEventListener('load', function()
{
    var svg = embed.getSVGDocument();
    // Operate upon the SVG DOM here
}); 
```

这比轮询要好，因为您对 SVG 所做的任何修改都将在第一次绘制之前发生，从而减少了闪烁和绘制所花费的 CPU 工作量。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2013-12-31T10:09:19.807

嵌入元素（例如对象）的加载事件将是我的偏好，但如果由于某种原因这不是一个可行的解决方案，我发现的唯一通用且可靠的 SVG DOM 测试是 SVG 的 getCurrentTime 方法根元素：

```
var element = document.getElementById( 'elementId' );
var svgDoc = element.contentDocument;
var svgRoot = svgDoc ? svgDoc.rootElement : null;

if ( svgRoot
    && svgRoot.getCurrentTime
    && ( svgRoot.getCurrentTime() > 0 ))
{
    /* SVG DOM ready */
} 
```

[W3C SVG 建议](http://www.w3.org/TR/SVG11/struct.html#__svg__SVGSVGElement__getCurrentTime)声明 SVGSVGElement 上的 getCurrentTime ：

> 返回相对于当前 SVG 文档片段的开始时间的当前时间（以秒为单位）。如果在文档时间线开始之前调用 getCurrentTime（例如，通过在调度文档的 SVGLoad 事件之前在“脚本”元素中运行的脚本），则返回 0。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-11-13T07:48:48.143

使用 jQuery，您可以绑定到 Erik 提到的窗口加载事件：

```
$(window).load(function(){
    var svg = document.getElementById("chart").getSVGDocument();
}); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-03-18T07:26:37.577

供将来参考：[Angular](https://www.typescriptlang.org/) (8)/ [Typescript](https://www.typescriptlang.org/)解决方案如下所示：

```
 @ViewChild('startimage', {static:false})
  private startimage: ElementRef;
...
  this.startimage.nativeElement.addEventListener('load', () => {
    alert('loaded');
  }); 
```

你可以通过`const svg = this.startimage.nativeElement.getSVGDocument();`

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-12-03T14:37:32.730

您可以将 onload 事件处理程序分配给 SVG 文档中的元素，并让它在 html 页面中调用 javascript 函数。onload 映射到 SVGLoad。

[http://www.w3.org/TR/SVG11/interact.html#LoadEvent](http://www.w3.org/TR/SVG11/interact.html#LoadEvent)

> 该事件在用户代理完全解析元素及其后代并准备好对该元素采取适当行动时触发

* * *

## 回答 #8

> 赞同：-4
> 
> 时间：2008-12-03T14:53:50.810

您可以尝试每隔一段时间进行一次轮询。

```
function checkReady() {
    var svg = document.getElementById("chart").getSVGDocument();
    if (svg == null) {
        setTimeout("checkReady()", 300);
    } else {
        ...
    }
} 
```

# delphi - 如何将 Delphi 与 Active Directory 集成？

> ID：337300
> 
> 赞同：16
> 
> 时间：2008-12-03T14:32:00.433
> 
> 标签：delphi, active-directory

我们需要使用 Delphi 7 在 Microsoft 的 Active Directory 上验证用户，最好的方法是什么？

我们可以有两种情况：用户输入其网络用户名和密码，其中用户名可能包括域，我们检查活动目录是否是有效的活动用户。或者我们从 Windows 获取当前登录的用户，并检查 AD 是否仍然有效。

第一个场景需要用户验证，而第二个场景只是一个简单的广告搜索和定位。

有谁知道执行上述一种或两种情况的组件或代码？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-31T22:37:29.157

我很高兴看到这里提到了我的 ADSISearch 组件 :-)，但为了简单地验证用户凭据，使用“LogonUser”Win32 API 可能会更好。我很确定（我自己不再做任何 Delphi 工作了）有一个浮动在某个地方的实现——可能在 JVCL 库或其他地方。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-03T23:23:14.120

这是我们编写和使用的一个单元。简单并完成工作。

```
unit ADSI;

interface

uses
  SysUtils, Classes, ActiveX, Windows, ComCtrls, ExtCtrls, ActiveDs_TLB,
  adshlp, oleserver, Variants;

type
  TPassword = record
    Expired: boolean;
    NeverExpires: boolean;
    CannotChange: boolean;
end;

type
  TADSIUserInfo = record
    UID: string;
    UserName: string;
    Description: string;
    Password: TPassword;
    Disabled: boolean;
    LockedOut: boolean;
    Groups: string; //CSV
end;

type
  TADSI = class(TComponent)

  private
    FUserName:  string;
    FPassword:  string;
    FCurrentUser: string;
    FCurrentDomain: string;

    function GetCurrentUserName: string;
    function GetCurrentDomain: string;

  protected
    { Protected declarations }
  public
    constructor Create(AOwner: TComponent); override;
    destructor Destroy; override;

    property CurrentUserName: string read FCurrentUser;
    property CurrentDomain: string read FCurrentDomain;

    function GetUser(Domain, UserName: string; var ADSIUser: TADSIUserInfo): boolean;
    function Authenticate(Domain, UserName, Group: string): boolean;

  published
    property LoginUserName: string read FUserName write FUserName;
    property LoginPassword: string read FPassword write FPassword;
  end;

procedure Register;

implementation

function ContainsValComma(s1,s: string): boolean; 
var 
  sub,str: string; 
begin 
  Result:=false; 
  if (s='') or (s1='') then exit; 
  if SameText(s1,s) then begin 
    Result:=true; 
    exit; 
  end; 
  sub:=','+lowercase(trim(s1))+','; str:=','+lowercase(trim(s))+','; 
  Result:=(pos(sub, str)>0); 
end;

procedure Register;
begin
  RegisterComponents('ADSI', [TADSI]);
end;

constructor TADSI.Create(AOwner: TComponent);
begin
   inherited Create(AOwner);

   FCurrentUser:=GetCurrentUserName;
   FCurrentDomain:=GetCurrentDomain;
   FUserName:='';
   FPassword:='';
end;

destructor TADSI.Destroy;
begin

   inherited Destroy;
end;

function TADSI.GetCurrentUserName : string;
const
  cnMaxUserNameLen = 254;
var
  sUserName     : string;
  dwUserNameLen : DWord;
begin
  dwUserNameLen := cnMaxUserNameLen-1;
  SetLength(sUserName, cnMaxUserNameLen );
  GetUserName(PChar(sUserName), dwUserNameLen );
  SetLength(sUserName, dwUserNameLen);
  Result := sUserName;
end;

function TADSI.GetCurrentDomain: string;
const
  DNLEN = 255;
var
  sid               : PSID;
  sidSize           : DWORD;
  sidNameUse        : DWORD;
  domainNameSize    : DWORD; 
  domainName        : array[0..DNLEN] of char;

begin
  sidSize := 65536; 
  GetMem(sid, sidSize); 
  domainNameSize := DNLEN + 1;
  sidNameUse := SidTypeUser;
  try
     if LookupAccountName(nil, PChar(FCurrentUser), sid, sidSize,
        domainName, domainNameSize, sidNameUse) then
         Result:=StrPas(domainName);
  finally
    FreeMem(sid);
  end;
end;

function TADSI.Authenticate(Domain, UserName, Group: string): boolean;
var
  aUser: TADSIUserInfo;
begin
  Result:=false;
  if GetUser(Domain,UserName,aUser) then begin
     if not aUser.Disabled and not aUser.LockedOut then begin
        if Group='' then
           Result:=true
        else
           Result:=ContainsValComma(Group, aUser.Groups);
     end;
  end;
end;

function TADSI.GetUser(Domain, UserName: string; var ADSIUser: TADSIUserInfo): boolean;
var
  usr   :    IAdsUser;
  flags :    integer;
  Enum  :    IEnumVariant;
  grps  :    IAdsMembers;
  grp   :    IAdsGroup;
  varGroup : OleVariant;
  Temp :     LongWord;
  dom1, uid1: string;

  //ui: TADSIUserInfo;

begin
  ADSIUser.UID:='';
  ADSIUser.UserName:='';
  ADSIUser.Description:='';
  ADSIUser.Disabled:=true;
  ADSIUser.LockedOut:=true;
  ADSIUser.Groups:='';
  Result:=false;

  if UserName='' then
     uid1:=FCurrentUser
  else
     uid1:=UserName;

  if Domain='' then
     dom1:=FCurrentDomain
  else
     dom1:=Domain;

  if uid1='' then exit;
  if dom1='' then exit;

  try
     if trim(FUserName)<>'' then
        ADsOpenObject('WinNT://' + dom1 + '/' + uid1, FUserName, FPassword, 1, IADsUser, usr)
     else
        ADsGetObject('WinNT://' + dom1 + '/' + uid1, IADsUser, usr);

     if usr=nil then exit;

     ADSIUser.UID:= UserName;
     ADSIUser.UserName := usr.FullName;
     ADSIUser.Description := usr.Description;
     flags := usr.Get('userFlags');
     ADSIUser.Password.Expired := usr.Get('PasswordExpired');
     ADSIUser.Password.CannotChange := (flags AND ADS_UF_PASSWD_CANT_CHANGE)<>0;
     ADSIUser.Password.NeverExpires := (flags and ADS_UF_DONT_EXPIRE_PASSWD)<>0;
     ADSIUser.Disabled := usr.AccountDisabled;
     ADSIUser.LockedOut := usr.IsAccountLocked;

     ADSIUser.Groups:='';
     grps := usr.Groups;
     Enum := grps._NewEnum as IEnumVariant;
     if Enum <> nil then begin
       while (Enum.Next(1,varGroup, Temp) = S_OK) do begin
         grp := IDispatch(varGroup) as IAdsGroup;
         //sGroupType := GetGroupType(grp);
         if ADSIUser.Groups<>'' then ADSIUser.Groups:=ADSIUser.Groups+',';
         ADSIUser.Groups:=ADSIUser.Groups+grp.Name;
         VariantClear(varGroup);
       end;
     end;
     usr:=nil;
     Result:=true;
  except
     on e: exception do begin
        Result:=false;
        exit;
     end;
  end;
end;

end. 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-03T16:39:08.460

我一直使用“ADSISearch.pas”单元来处理 AD，并取得了巨大的成功。另外，这里是我使用的一些代码（使用这个单元）从他们的 AD 对象中检索用户的 HOMEDRIVE 信息：

```
 try
    ADSISearch1.Filter := WideString('samaccountname=' + GetUserFromWindows());

    try
      ADSISearch1.Search;
      slTemp := ADSISearch1.GetFirstRow();
    except
      //uh-oh, this is a problem, get out of here
      // --- must not have been able to talk to AD
      // --- could be the user recently changed pwd and is logged in with
      //      their cached credentials
      // just suppress this exception
      bHomeDriveMappingFailed := True;
      Result := bSuccess;
      Exit;
    end;

    while (slTemp <> nil) do
    begin
      for ix := 0 to slTemp.Count - 1 do
      begin
        curLine := AnsiUpperCase(slTemp[ix]);
        if AnsiStartsStr('HOMEDIRECTORY', curLine) then
        begin
          sADHomeDriveUncPath := AnsiReplaceStr(curLine, 'HOMEDIRECTORY=', '');
          //sADHomeDriveUncPath := slTemp[ix];
        end
        else if AnsiStartsStr('HOMEDRIVE', curLine) then
        begin
          sADHomeDriveLetter := AnsiReplaceStr(curLine, 'HOMEDRIVE=', '');
          //sADHomeDriveLetter := slTemp[ix];
        end;
      end;

      FreeAndNil(slTemp);
      slTemp := ADSISearch1.GetNextRow();
    end;
  except
    //suppress this exception
    bHomeDriveMappingFailed := True;
    Exit;
  end; 
```

事不宜迟，这里是单位（不是我写的）：

```
(* ----------------------------------------------------------------------------
 Module:  ADSI Searching in Delphi
 Author:  Marc Scheuner
 Date:    July 17, 2000

 Changes:

 Description:

   constructor Create(aOwner : TComponent); override;
     Creates a new instance of component

   destructor Destroy; override;
     Frees instance of component

   function CheckIfExists() : Boolean;
     Checks to see if the object described in the properties exists or not
     TRUE: Object exists, FALSE: object does not exist

   procedure Search;
     Launches the ADSI search - use GetFirstRow and GetNextRow to retrieve information

   function GetFirstRow() : TWideStringList;
   function GetNextRow() : TWideStringList;
     Returns the first row / next row of the result set, as a WideStringList.
     The values are stored in the string list as a <name>=<value> pair, so you
     can access the values via the FWideStringList.Values['name'] construct.

     Multivalued attributes are returned as one per line, in an array index
     manner:
            objectClass[0]=top
            objectClass[1]=Person
            objectClass[2]=organizationalPerson
            objectClass[3]=user
     and so forth. The index is zero-based.

     If there are no (more) rows, the return value will be NIL.

     It's up to the receiver to free the string list when no longer needed.

 property Attributes : WideString
   Defines the attributes you want to retrieve from the object. If you leave
   this empty, all available attributes will be returned.
   You can specify multiple attributes separated by comma:
           cn,distinguishedName,name,ADsPath
   will therefore retrieve these four attributes for all the objects returned
   in the search (if the attributes exist).

 property BaseIADs : IADs
   If you already have an interface to an IADs object, you can reuse it here
   by setting it to the BaseIADs property - in this case, ADSISearch can skip
   the step of binding to the ADSI object and will be executing faster.

 property BasePath : WideString
   LDAP base path for the search - the further down in the LDAP tree you start
   searching, the smaller the namespace to search and the quicker the search
   will return what you're looking for.

        LDAP://cn=Users,dc=stmaarten,dc=qc,dc=rnd
   is the well-known LDAP path for the Users container in the stmaarten.qc.rnd
   domain.

 property ChaseReferrals : Boolean
   If set to TRUE, the search might need to connect to other domain controllers
   and naming contexts, which is very time consuming.
   Set this property to FALSE to limit it to the current naming context, thus
   speeding up searches significantly.

 property DirSrchIntf : IDirectorySearch
   Provides access to the basic Directory Search interface, in case you need
   to do some low-level tweaking

 property Filter : WideString
   LDAP filter expression to search for. It will be ANDed together with a
   (objectClass=<ObjectClass>) filter to form the full search filter.
   It can be anything that is a valid LDAP search filter - see the appropriate
   books or online help files for details.

   It can be (among many other things):
      cn=Marc*
      badPwdCount>=0
      countryCode=49
      givenName=Steve
   and multiple conditions can be ANDed or ORed together using the LDAP syntax.

 property MaxRows : Integer
   Maximum rows of the result set you want to retrieve.
   Default is 0 which means all rows.

 property PageSize : Integer
   Maximum number of elements to be returned in a paged search. If you set this to 0,
   the search will *not* be "paged", e.g. IDirectorySearch will return all elements
   found in one big gulp, but there's a limit at 1'000 elements.
   With paged searching, you can search and find any number of AD objects. Default is
   set to 100 elements. No special need on the side of the developer / user to use
   paged searches - just set the PageSize to something non-zero.

 property ObjectClass: WideString
   ObjectClass of the ADSI object you are searching for. This allows you to
   specify e.g. just users, only computers etc.
   Be aware that ObjectClass is a multivalued attribute in LDAP, and sometimes
   has unexpected hierarchies (e.g."computer" descends from "user" and will therefore
   show up if you search for object class "user").
   This property will be included in the LDAP search filter passed to the
   search engine. If you don't want to limit the objects returned, just leave
   it at the default value of  *

 property SearchScope
   Limits the scope of the search.
   scBase: search only the base object (as specified by the LDAP path) - not very
           useful.....
   scOneLevel: search only object immediately contained by the specified base
               object (does not include baes object) - limits the depth of
               the search
   scSubtree: no limit on how "deep" the search goes, below the specified
              base object - this is the default.

---------------------------------------------------------------------------- *)

unit ADSISearch;

interface

uses
  ActiveX,
  ActiveDs_TLB,
  Classes,
  SysUtils
{$IFDEF UNICODE}
  ,Unicode
{$ENDIF}
  ;

type
  EADSISearchException = class(Exception);

  TSearchScope = (scBase, scOneLevel, scSubtree);

  TADSISearch = class(TComponent)
  private
    FBaseIADs       : IADs;
    FDirSrchIntf    : IDirectorySearch;
    FSearchHandle   : ADS_SEARCH_HANDLE;
    FAttributes,
    FFilter,
    FBasePath,
    FObjectClass    : Widestring;
    FResult         : HRESULT;
    FChaseReferrals,
    FSearchExecuted : Boolean;
    FMaxRows,
    FPageSize       : Integer;
    FSearchScope    : TSearchScope;
    FUsername: Widestring;
    FPassword: Widestring;

{$IFDEF UNICODE}
    procedure EnumerateColumns(aStrList : TWideStringList);
{$ELSE}
    procedure EnumerateColumns(aStrList : TStringList);
{$ENDIF}

    function GetStringValue(oSrchColumn : ads_search_column; Index : Integer) : WideString;

    procedure SetBaseIADs(const Value: IADs);
    procedure SetBasePath(const Value: WideString);
    procedure SetFilter(const Value: WideString);
    procedure SetObjectClass(const Value: Widestring);
    procedure SetMaxRows(const Value: Integer);
    procedure SetPageSize(const Value: Integer);
    procedure SetAttributes(const Value: WideString);
    procedure SetChaseReferrals(const Value: Boolean);
    procedure SetUsername(const Value: WideString);
    procedure SetPassword(const Value: WideString);

  public
    constructor Create(aOwner : TComponent); override;
    destructor Destroy; override;

    function CheckIfExists() : Boolean;
    procedure Search;

{$IFDEF UNICODE}
    function GetFirstRow() : TWideStringList;
    function GetNextRow() : TWideStringList;
{$ELSE}
    function GetFirstRow() : TStringList;
    function GetNextRow() : TStringList;
{$ENDIF}

  published
    // list of attributes to return - empty string equals all attributes
    property Attributes     : WideString read FAttributes write SetAttributes;

    // search base - both as an IADs interface, as well as a LDAP path
    property BaseIADs       : IADs read FBaseIADs write SetBaseIADs stored False;
    property BasePath       : WideString read FBasePath write SetBasePath;

    // chase possible referrals to other domain controllers?
    property ChaseReferrals : Boolean read FChaseReferrals write SetChaseReferrals default False;

    // "raw" search interface - for any low-level tweaking necessary
    property DirSrchIntf    : IDirectorySearch read FDirSrchIntf;

    // LDAP filter to limit the search
    property Filter         : WideString read FFilter write SetFilter;

    // maximum number of rows to return - 0 = all rows (no limit)
    property MaxRows        : Integer read FMaxRows write SetMaxRows default 0;
    property ObjectClass    : Widestring read FObjectClass write SetObjectClass;
    property PageSize       : Integer read FPageSize write SetPageSize default 100;
    property SearchScope    : TSearchScope read FSearchScope write FSearchScope default scSubtree;
    property Username       : Widestring read FUsername write SetUsername;
    property Password       : Widestring read FPassword write SetPassword;
  end;

const
  // ADSI success codes
  S_ADS_ERRORSOCCURRED = $00005011;
  S_ADS_NOMORE_ROWS    = $00005012;
  S_ADS_NOMORE_COLUMNS = $00005013;

  // ADSI error codes
  E_ADS_BAD_PATHNAME            = $80005000;
  E_ADS_INVALID_DOMAIN_OBJECT   = $80005001;
  E_ADS_INVALID_USER_OBJECT     = $80005002;
  E_ADS_INVALID_COMPUTER_OBJECT = $80005003;
  E_ADS_UNKNOWN_OBJECT          = $80005004;
  E_ADS_PROPERTY_NOT_SET        = $80005005;
  E_ADS_PROPERTY_NOT_SUPPORTED  = $80005006;
  E_ADS_PROPERTY_INVALID        = $80005007;
  E_ADS_BAD_PARAMETER           = $80005008;
  E_ADS_OBJECT_UNBOUND          = $80005009;
  E_ADS_PROPERTY_NOT_MODIFIED   = $8000500A;
  E_ADS_PROPERTY_MODIFIED       = $8000500B;
  E_ADS_CANT_CONVERT_DATATYPE   = $8000500C;
  E_ADS_PROPERTY_NOT_FOUND      = $8000500D;
  E_ADS_OBJECT_EXISTS           = $8000500E;
  E_ADS_SCHEMA_VIOLATION        = $8000500F;
  E_ADS_COLUMN_NOT_SET          = $80005010;
  E_ADS_INVALID_FILTER          = $80005014;

procedure Register;

(*============================================================================*)
(*                           IMPLEMENTATION                                   *)
(*============================================================================*)

implementation

uses
  Windows;

var
  ActiveDSHandle : THandle;
  gADsGetObject: function(pwcPathName: PWideChar; const xRIID: TGUID; out pVoid): HResult; stdcall;
  gFreeADsMem : function(aPtr : Pointer) : BOOL; stdcall;

// Active Directory API helper functions - implemented in ActiveDs.DLL and
// dynamically loaded at time of initialization of this module

function ADsGetObject(pwcPathName: PWideChar; const xRIID: TGUID; var pVoid): HResult;
begin
  Result := gADsGetObject(pwcPathName, xRIID, pVoid);
end;

function FreeADsMem(aPtr : Pointer) : BOOL;
begin
  Result := gFreeADsMem(aPtr);
end;

// resource strings for all messages - makes localization so much easier!

resourcestring
  rc_CannotLoadActiveDS   = 'Cannot load ActiveDS.DLL';
  rc_CannotGetProcAddress = 'Cannot GetProcAddress of ';

  rc_CouldNotBind      = 'Could not bind to object %s (%x)';
  rc_CouldNotFreeSH    = 'Could not free search handle (%x)';
  rc_CouldNotGetIDS    = 'Could not obtain IDirectorySearch interface for %s (%x)';
  rc_GetFirstFailed    = 'GetFirstRow failed (%x)';
  rc_GetNextFailed     = 'GetNextRow failed (%x)';
  rc_SearchFailed      = 'Search in ADSI failed (result code %x)';
  rc_SearchNotExec     = 'Search has not been executed yet';
  rc_SetSrchPrefFailed = 'Setting the max row limit failed (%x)';
  rc_UnknownDataType   = '(unknown data type %d)';

// ---------------------------------------------------------------------------
//  Constructor and destructor
// ---------------------------------------------------------------------------

constructor TADSISearch.Create(aOwner : TComponent);
begin
  inherited Create(aOwner);

  FBaseIADs    := nil;
  FDirSrchIntf := nil;

  FAttributes := '';
  FBasePath   := '';
  FFilter     := '';
  FObjectClass := '*';

  FMaxRows     := 0;
  FPageSize    := 100;

  FChaseReferrals := False;
  FSearchScope    := scSubtree;

  FSearchExecuted := False;
end;

destructor TADSISearch.Destroy;
begin
  if (FSearchHandle <> 0) then
    FResult := FDirSrchIntf.CloseSearchHandle(FSearchHandle);

  FBaseIADs    := nil;
  FDirSrchIntf := nil;

  inherited;
end;

// ---------------------------------------------------------------------------
// Set and Get methods
// ---------------------------------------------------------------------------

procedure TADSISearch.SetPassword(const Value: WideString);
begin
  if (FPassword <> Value) then
    begin
      FPassword := Value;
    end;
end;

procedure TADSISearch.SetUsername(const Value: WideString);
begin
  if (FUsername <> Value) then
    begin
      FUsername := Value;
    end;
end;

procedure TADSISearch.SetAttributes(const Value: WideString);
begin
  if (FAttributes <> Value) then begin
    FAttributes := Value;
  end;
end;

// the methods to set the search base always need to update the other property
// as well, in order to make sure the base IADs interface and the BasePath
// property stay in sync
// setting the search base will require a new search
// therefore set internal flag FSearchExecuted to false
procedure TADSISearch.SetBaseIADs(const Value: IADs);
begin
  if (FBaseIADs <> Value) then begin
    FBaseIADs := Value;
    FBasePath := FBaseIADs.ADsPath;
    FSearchExecuted := False;
  end;
end;

procedure TADSISearch.SetBasePath(const Value: WideString);
begin
  if (FBasePath <> Value) then begin
    FBasePath := Value;
    FBaseIADs := nil;
    FSearchExecuted := False;
  end;
end;

procedure TADSISearch.SetChaseReferrals(const Value: Boolean);
begin
  if (FChaseReferrals <> Value) then begin
    FChaseReferrals := Value;
  end;
end;

// setting the filter will require a new search
// therefore set internal flag FSearchExecuted to false
procedure TADSISearch.SetFilter(const Value: WideString);
begin
  if (FFilter <> Value) then begin
    FFilter := Value;
    FSearchExecuted := False;
  end;
end;

procedure TADSISearch.SetMaxRows(const Value: Integer);
begin
  if (Value >= 0) and (Value <> FMaxRows) then begin
    FMaxRows := Value;
  end;
end;

procedure TADSISearch.SetPageSize(const Value: Integer);
begin
  if (Value >= 0) and (Value <> FPageSize) then begin
    FPageSize := Value;
  end;
end;

// setting the object category will require a new search
// therefore set internal flag FSearchExecuted to false
procedure TADSISearch.SetObjectClass(const Value: Widestring);
begin
  if (FObjectClass <> Value) then begin
    if (Value = '') then
      FObjectClass := '*'
    else
      FObjectClass := Value;
    FSearchExecuted := False;
  end;
end;

// ---------------------------------------------------------------------------
// Private helper methods
// ---------------------------------------------------------------------------

// EnumerateColumns iterates through all the columns in the current row of
// the search results and builds the string list of results
{$IFDEF UNICODE}
procedure TADSISearch.EnumerateColumns(aStrList: TWideStringList);
{$ELSE}
procedure TADSISearch.EnumerateColumns(aStrList: TStringList);
{$ENDIF}
var
  ix          : Integer;
  bMultiple   : Boolean;
  pwColName   : PWideChar;
  oSrchColumn : ads_search_column;
  wsColName, wsValue : WideString;
begin
  // determine name of next column to fetch
  FResult := FDirSrchIntf.GetNextColumnName(FSearchHandle, pwColName);

  // as long as no error occured and we still do have columns....
  while Succeeded(FResult) and (FResult <> S_ADS_NOMORE_COLUMNS) do begin
    // get the column from the result set
    FResult := FDirSrchIntf.GetColumn(FSearchHandle, pwColName, oSrchColumn);

    if Succeeded(FResult) then begin
      // check if it's a multi-valued attribute
      bMultiple := (oSrchColumn.dwNumValues > 1);

      if bMultiple then begin
        // if it's a multi-valued attribute, iterate through the values
        for ix := 0 to oSrchColumn.dwNumValues-1 do begin
          wsColName := Format('%s[%d]', [oSrchColumn.pszAttrName, ix]);
          wsValue   := GetStringValue(oSrchColumn, ix);
          aStrList.Add(wsColName + '=' + wsValue);
        end;
      end
      else begin
        // single valued attributes are quite straightforward
        wsColName := oSrchColumn.pszAttrName;
        wsValue   := GetStringValue(oSrchColumn, 0);
        aStrList.Add(wsColName + '=' + wsValue);
      end;
    end;

    // free the memory associated with the search column, and the column name
    FDirSrchIntf.FreeColumn(oSrchColumn);
    FreeADsMem(pwColName);

    // get next column name
    FResult := FDirSrchIntf.GetNextColumnName(FSearchHandle, pwColName);
  end;
end;

// Get string value will turn the supported types of data into a string representation
// for inclusion in the resulting string list
// For a complete list of possible values, see the ADSTYPE_xxx constants in the
// ActiveDs_TLB.pas file
function TADSISearch.GetStringValue(oSrchColumn: ads_search_column; Index: Integer): WideString;
var
  wrkPointer : PADSValue;
  oSysTime   : _SYSTEMTIME;
  dtDate,
  dtTime     : TDateTime;
begin
  Result := '';

  // advance the value pointer to the correct one of the potentially multiple
  // values in the "array of values" for this attribute
  wrkPointer := oSrchColumn.pADsValues;
  Inc(wrkPointer, Index);

  // depending on the type of the value, turning it into a string is more
  // or less straightforward
  case oSrchColumn.dwADsType of
    ADSTYPE_CASE_EXACT_STRING  : Result := wrkPointer^.__MIDL_0010.CaseExactString;
    ADSTYPE_CASE_IGNORE_STRING : Result := wrkPointer^.__MIDL_0010.CaseIgnoreString;
    ADSTYPE_DN_STRING          : Result := wrkPointer^.__MIDL_0010.DNString;
    ADSTYPE_OBJECT_CLASS       : Result := wrkPointer^.__MIDL_0010.ClassName;
    ADSTYPE_PRINTABLE_STRING   : Result := wrkPointer^.__MIDL_0010.PrintableString;
    ADSTYPE_NUMERIC_STRING     : Result := wrkPointer^.__MIDL_0010.NumericString;
    ADSTYPE_BOOLEAN            : Result := IntToStr(wrkPointer^.__MIDL_0010.Boolean);
    ADSTYPE_INTEGER            : Result := IntToStr(wrkPointer^.__MIDL_0010.Integer);
    ADSTYPE_LARGE_INTEGER      : Result := IntToStr(wrkPointer^.__MIDL_0010.LargeInteger);
    ADSTYPE_UTC_TIME:
      begin
        // ADS_UTC_TIME maps to a _SYSTEMTIME structure
        Move(wrkPointer^.__MIDL_0010.UTCTime, oSysTime, SizeOf(oSysTime));
        // create two TDateTime values for the date and the time
        dtDate := EncodeDate(oSysTime.wYear, oSysTime.wMonth, oSysTime.wDay);
        dtTime := EncodeTime(oSysTime.wHour, oSysTime.wMinute, oSysTime.wSecond, oSysTime.wMilliseconds);
        // add the two TDateTime's (really only a Float), and turn into a string
        Result := DateTimeToStr(dtDate+dtTime);
      end;
    else Result := Format(rc_UnknownDataType, [oSrchColumn.dwADsType]);
  end;
end;

// ---------------------------------------------------------------------------
// Public methods
// ---------------------------------------------------------------------------

// Check if any object matching the criteria as defined in the properties exists
function TADSISearch.CheckIfExists(): Boolean;
var
{$IFDEF UNICODE}
  slTemp : TWideStringList;
{$ELSE}
  slTemp : TStringList;
{$ENDIF}
  iOldMaxRows     : Integer;
  wsOldAttributes : WideString;
begin
  Result := False;

  // save the settings of the MaxRows and Attributes properties
  iOldMaxRows := FMaxRows;
  wsOldAttributes := FAttributes;

  try
    // set the attributes to return just one row (that's good enough for
    // making sure it exists), and the Attribute of instanceType which is
    // one attribute that must exist for any of the ADSI objects
    FMaxRows := 1;
    FAttributes := 'instanceType';

    try
      Search;

      // did we get any results?? If so, at least one object exists!
      slTemp := GetFirstRow();
      Result := (slTemp <> nil);
      slTemp.Free;

    except
      on EADSISearchException do ;
    end;

  finally
    // restore the attributes to what they were before
    FMaxRows := iOldMaxRows;
    FAttributes := wsOldAttributes;
  end;
end;

{$IFDEF UNICODE}
function TADSISearch.GetFirstRow(): TWideStringList;
var
  slTemp : TWideStringList;
{$ELSE}
function TADSISearch.GetFirstRow(): TStringList;
var
  slTemp : TStringList;
{$ENDIF}
begin
  slTemp := nil;

  try
    if FSearchExecuted then begin
      // get the first row of the result set
      FResult := FDirSrchIntf.GetFirstRow(FSearchHandle);

      // did we succeed? ATTENTION: if we don't have any more rows,
      // we still get a "success" value back from ADSI!!
      if Succeeded(FResult) then begin
        // any more rows in the result set?
        if (FResult <> S_ADS_NOMORE_ROWS) then begin
          // create a string list
{$IFDEF UNICODE}
          slTemp := TWideStringList.Create;
{$ELSE}
          slTemp := TStringList.Create;
{$ENDIF}
          // enumerate all columns into that resulting string list
          EnumerateColumns(slTemp);
        end;
      end
      else begin
        raise EADSISearchException.CreateFmt(rc_GetFirstFailed, [FResult]);
      end;
    end
    else begin
      raise EADSISearchException.Create(rc_SearchNotExec);
    end;

  finally
    Result := slTemp;
  end;
end;

{$IFDEF UNICODE}
function TADSISearch.GetNextRow(): TWideStringList;
var
  slTemp : TWideStringList;
{$ELSE}
function TADSISearch.GetNextRow(): TStringList;
var
  slTemp : TStringList;
{$ENDIF}
begin
  slTemp := nil;

  try
    if FSearchExecuted then begin
      // get the next row of the result set
      FResult := FDirSrchIntf.GetNextRow(FSearchHandle);

      // did we succeed? ATTENTION: if we don't have any more rows,
      // we still get a "success" value back from ADSI!!
      if Succeeded(FResult) then begin
        // any more rows in the result set?
        if (FResult <> S_ADS_NOMORE_ROWS) then begin
          // create result string list
{$IFDEF UNICODE}
          slTemp := TWideStringList.Create;
{$ELSE}
          slTemp := TStringList.Create;
{$ENDIF}
          // enumerate all columns in result set
          EnumerateColumns(slTemp);
        end;
      end
      else begin
        raise EADSISearchException.CreateFmt(rc_GetNextFailed, [FResult]);
      end;
    end
    else begin
      raise EADSISearchException.Create(rc_SearchNotExec);
    end;

  finally
    Result := slTemp;
  end;
end;

// this is the core piece of the component - the actual search method
procedure TADSISearch.Search;
var
  ix        :  Integer;
  wsFilter  : WideString;
{$IFDEF UNICODE}
  slTemp    : TWideStringList;
{$ELSE}
  slTemp    : TStringList;
{$ENDIF}
  AttrCount : Cardinal;
  AttrArray : array of WideString;
  SrchPrefInfo : array of ads_searchpref_info;
  DSO :IADsOpenDSObject;
  Dispatch:IDispatch;

begin
  // check to see if we have assigned an IADs, if not, bind to it
  if (FBaseIADs = nil) then begin
    ADsGetObject('LDAP:', IID_IADsOpenDSObject, DSO);
    Dispatch := DSO.OpenDSObject(FBasePath, FUsername, FPassword, ADS_SECURE_AUTHENTICATION);
    FResult := Dispatch.QueryInterface(IID_IADs, FBaseIADs);
    //FResult := ADsGetObject(@FBasePath[1], IID_IADs, FBaseIADs);

    if not Succeeded(FResult) then begin
      raise EADSISearchException.CreateFmt(rc_CouldNotBind, [FBasePath, FResult]);
    end;
  end;

  // get the IDirectorySearch interface from the base object
  FDirSrchIntf := (FBaseIADs as IDirectorySearch);

  if (FDirSrchIntf = nil) then begin
    raise EADSISearchException.CreateFmt(rc_CouldNotGetIDS, [FBasePath, FResult]);
  end;

  // if we still have a valid search handle => close it
  if (FSearchHandle <> 0) then begin
    FResult := FDirSrchIntf.CloseSearchHandle(FSearchHandle);

    if not Succeeded(FResult) then begin
      raise EADSISearchException.CreateFmt(rc_CouldNotFreeSH, [FResult]);
    end;
  end;

  // we are currently setting 3 search preferences
  // for a complete list of possible search preferences, please check
  // the ADS_SEARCHPREF_xxx values in ActiveDs_TLB.pas
  SetLength(SrchPrefInfo, 4);

  // Set maximum number of rows to be what is defined in the MaxRows property
  SrchPrefInfo[0].dwSearchPref := ADS_SEARCHPREF_SIZE_LIMIT;
  SrchPrefInfo[0].vValue.dwType := ADSTYPE_INTEGER;
  SrchPrefInfo[0].vValue.__MIDL_0010.Integer := FMaxRows;

  // set the "chase referrals" search preference
  SrchPrefInfo[1].dwSearchPref := ADS_SEARCHPREF_CHASE_REFERRALS;
  SrchPrefInfo[1].vValue.dwType := ADSTYPE_BOOLEAN;
  SrchPrefInfo[1].vValue.__MIDL_0010.Boolean := Ord(FChaseReferrals);

  // set the "search scope" search preference
  SrchPrefInfo[2].dwSearchPref := ADS_SEARCHPREF_SEARCH_SCOPE;
  SrchPrefInfo[2].vValue.dwType := ADSTYPE_INTEGER;
  SrchPrefInfo[2].vValue.__MIDL_0010.Integer := Ord(FSearchScope);

  // set the "page size " search preference
  SrchPrefInfo[3].dwSearchPref := ADS_SEARCHPREF_PAGESIZE;
  SrchPrefInfo[3].vValue.dwType := ADSTYPE_INTEGER;
  SrchPrefInfo[3].vValue.__MIDL_0010.Integer := FPageSize;

  // set the search preferences of our directory search interface
  FResult := FDirSrchIntf.SetSearchPreference(Pointer(SrchPrefInfo), Length(SrchPrefInfo));

  if not Succeeded(FResult) then begin
    raise EADSISearchException.CreateFmt(rc_SetSrchPrefFailed, 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-03T14:51:41.953

谷歌使用 ADSI 和 Delphi，你可以找到一些关于这个的文章

[活动目录服务接口](http://www.agnisoft.com/white_papers/active_directory.asp)

[在 Delphi 中使用 ADSI](http://adsi.mvps.org/adsi/Delphi/index.html)

您还可以查看[online-admin](http://www.online-admin.com/index.html)他们提供的组件来管理许多 Windows 服务，包括 AD

# eclipse - 哪些 Eclipse 文件属于版本控制？

> ID：337304
> 
> 赞同：245
> 
> 时间：2008-12-03T14:32:26.390
> 
> 标签：eclipse, version-control, svn

除了明显的源代码之外，哪些 Eclipse 文件适合置于源代码控制之下？

具体来说，在我的项目中，我想知道：

> .metadata/*
> 项目目录/.project
> 项目目录/.classpath
> 项目目录/.settings/*

如果有任何依赖于这些，请解释您的指导方针。

* * *

## 回答 #1

> 赞同：175
> 
> 时间：2008-12-03T14:36:55.477

元数据不应在源代码管理中进行管理。它们主要包含与*您的*工作区相关的数据。

唯一的例外是`.launch`XML 文件（启动器定义）。

它们位于

```
[eclipse-workspace]\.metadata\.plugins\org.eclipse.debug.core\.launches 
```

并且它们应该被复制到您的项目目录中：当您的项目刷新时，这些配置将显示在“运行配置”对话框中。

这样，这些启动参数文件也可以管理到 SCM 中。

（警告：在“*运行*/*启动*/*启动配置”首选项面板中***取消选中“删除关联资源时删除配置”**选项：通常软删除项目以便再次将其导入 - 强制重新初始化eclipse 元数据。但是，如果选中此选项，将删除您的详细启动参数！）

 ***```
project-dir/.project
project-dir/.classpath
project-dir/.settings/* 
```

应该在您的 SCM 中（尤其是`.project`根据`.classpath`Eclipse[文档](http://wiki.eclipse.org/FAQ_How_do_I_set_up_a_Java_project_to_share_in_a_repository%3F)）。

**目标是任何人都可以签出/更新他/她的 SCM 工作区并将 Eclipse 项目导入 Eclipse 工作区。**

为此，您只想使用.classpath 中的**相对路径，使用****[链接资源](https://stackoverflow.com/questions/300328#300346)**。

注意：最好是`project-dir`指“外部”项目目录，而不是在 eclipse 工作区下创建的目录。这样，这两个概念（eclipse 工作区与 SCM 工作区）就清晰地分开了。

* * *

正如[ipsquiggle](https://stackoverflow.com/users/243516/ipsquiggle)在评论中提到的那样，正如我[在旧答案中](https://stackoverflow.com/questions/452571/where-are-the-external-tools-launch-configurations-in-eclipse/452588#452588)所暗示的那样，您实际上可以将启动配置作为**共享文件**直接保存在您的项目目录中。然后可以像其他项目文件一样对所有启动配置进行版本控制。

（来自博客文章提示：从 KD[创建和共享启动配置）](http://eclipsesnippets.blogspot.com/2007/07/tip-creating-and-sharing-launch.html)

![替代文字](https://i.stack.imgur.com/QZ26z.png)

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-12-03T15:19:18.807

我目前正在开发一个项目，我们将 .project 和 .cproject 文件置于源代码控制之下。这个想法是与库路径和链接指令相关的设置将在整个团队中传播。

在实践中它并没有很好地工作，合并几乎总是以冲突状态返回，需要在 Eclipse 之外解除冲突，然后项目关闭并重新打开以使更改生效。

我不建议将它们保留在源代码管理中。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2010-01-23T18:33:34.523

CDT配置文件对源代码控制不友好是[毫无价值的。](https://en.wikipedia.org/wiki/Eclipse_%28software%29).cproject 文件经常更改并导致冲突存在一个错误，请参阅*[在存储库中共享 cdt-project 文件总是导致冲突](https://bugs.eclipse.org/bugs/show_bug.cgi?id=226457)*。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-12-07T00:54:28.160

一些项目，比如使用 Maven 的项目，喜欢基于 POM 生成 .project 文件。

也就是说，除此之外 - .metadata 不应该在源代码管理中。您的项目必须根据您计划如何管理标准等来确定 projectdir/.settings 是否有效。如果您可以诚实地信任您的开发人员根据标准设置他们的环境，并且您不必为任何项目定制任何特殊的东西，那么您就不需要将它们放入。我，我建议专门配置每个项目. 这允许开发人员在同一个工作区中处理多个项目的内容，而无需来回更改默认设置，并且它使设置非常明确，覆盖了它们的默认设置以匹配项目的标准。

唯一困难的部分是确保它们都保持同步。但在大多数情况下，您可以将 .settings 文件从一个项目复制到另一个项目。如果您在源代码管理中特别不想要任何内容​​，请执行相当于为它们设置 svn:ignore（如果您的 SCM 支持）。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2010-06-23T18:22:25.820

.classpath 文件绝对是签入 scm 的好选择，因为手动设置它可能需要大量工作，并且对于新开发人员进入项目来说会很困难。确实它可以从其他来源生成，在这种情况下，您将签入其他来源。

至于.settings，这取决于设置。这是一个灰色区域，但有些设置几乎是强制性的，能够方便地签出项目，将其导入 Eclipse 并设置好一切，一切顺利。

因此，在我们的项目中，我们维护了一个名为 CVS.settings 的 .settings 文件夹的副本，并且我们有一个 ant 任务将其复制到 .settings。当您从 CVS 获取项目时，您调用 'eclipsify' ant 任务将默认设置复制到新的 .settings 文件夹。当您配置项目开发人员所需的设置时，您将这些设置合并回 CVS.settings 文件夹并将其提交给 CVS。这样，在 SCM 中保存设置就成为一个有意识的过程。它确实需要开发人员在签入重大更改时不时将这些设置合并回他们的 .settings 文件夹。但它是一个简单的系统，运行得非常好。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-12-03T15:03:23.333

我会说一个都没有。它们很可能包含仅与您的工作站相关的信息（我正在考虑库和所有的路径）。另外，如果您团队中的某个人不使用 Eclipse 怎么办？

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-06-04T15:37:10.307

考虑：

```
.classpath
.project
.launch 
```

只要您坚持使用项目相对路径，这些都应该在版本控制中。这允许其他开发人员检查项目并立即开始工作，而不必经历其他开发人员经历的所有设置痛苦。

您可能很想将 .metadata 也包含在版本控制中，这样 Eclipse 开发人员可以检查整个工作区并使用所有正确的项目对其进行预配置，但它包含许多用户特定的信息，无论何时任何人使用它，它都会更改，所以我建议不要包含 .metadata。只需导入所有现有的 Eclipse 项目，即可轻松构建本地工作区。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-04-21T01:36:24.067

我花了太多时间为新同事（和我自己）配置 eclipse 工作区设置。我最终做的是将我自己的 .metadata 复制到新的开发者机器上。

如果你在一个团队中工作，那么我认为以下是保持版本控制的非常好的候选者：

*   已安装的 JRE 及其名称
*   服务器运行时环境
*   Java 编辑器模板
*   版本控制键盘快捷键
*   不提供项目特定设置的插件设置
*   Maven 设置
*   预配置的视角
*   ...

# ruby-on-rails - Rails + Oracle：值得麻烦吗？

> ID：337305
> 
> 赞同：5
> 
> 时间：2008-12-03T14:32:37.717
> 
> 标签：ruby-on-rails, oracle

使用 Rails 和 Oracle 在架构上是否合理？我担心甲骨文对于 Rails 来说太“沉重和高端”了。有什么想法吗？谢谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-03T15:19:09.603

Rails 的数据库需求或多或少归结为表、索引和 CRUD。

任何提供这些功能的东西都应该能够作为 Rails 应用程序的后端，而甲骨文当然会在它提供的大量功能中的~~某个地方完成这些部分。~~如果您可以使用 ActiveRecord 迁移，那么无论如何您都无需过多担心特定于平台的方面。

ActiveRecord 的 oracle-adapter（需要单独下载并放置在 activerecord\lib\active_record\connection_adapters 中，顺便说一句）在适当的情况下使用 Oracle 特定的元素，我能想到的主要元素是使用 id 序列一代。

Oracle 查询优化器非常聪明，对于复杂的多表查询可能比 MySQL 更好。

如果您将 Oracle 视为外部托管站点的后端，那么我会怀疑成本的原因，以及已经说明的关于可用性的预订。但我怀疑这个问题更多地与内部已经可用的东西有关，在这种情况下，我会说它是你可以获得的“好”解决方案。

我正在 Rails/Oracle 上开发 Intranet 应用程序，在本地使用 OracleXE 进行开发，部署到一些“大铁”机器（照顾它是别人的工作，我什至不知道它运行的是什么操作系统）用于生产。

编辑：值得看看[activerecord-oracle_enhanced-adapter](http://github.com/rsim/oracle-enhanced)（它是一个 gem）作为内置 oracle 适配器的替代品，如果只是为了改进对日期/日期时间值的处理（Oracle 两者只有一种列类型`DATE`：） . 它可能使我免于崩溃...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T14:42:43.187

为什么太重了？Oracle 它只是一个数据库，可以根据您的使用情况从简单到繁重。今天甲骨文有很多版本来适应任何用途，例如小[甲骨文 XE](http://www.oracle.com/technology/products/database/xe/index.html)。

如果您对 Oracle 满意，请使用它。不用担心。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T14:55:12.100

使用 Oracle 作为数据库时您可能会遇到的问题是，您找不到许多托管公司提供 Oracle 作为您在 Web 上的数据库的选择。

也像巨型数据库一样的oracle，如果您不需要其中的特定功能，为什么要使用它？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-04T11:07:40.640

关于 Oracle 和 Rails 需要考虑的另一件事：Rails 的全文搜索插件目前都不支持 Oracle。事实上，几乎只有 MySQL 和 PostgreSQL 受到各种全文选项的良好支持。

这并不是说如果您使用 Oracle，您将无法进行全文搜索，只是您将无法使用任何现有的插件，使您的操作变得如此简单。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-03T18:26:09.867

我目前正在将 Oracle 与一些 Rails 应用程序一起使用。有标准的 ActiveRecord 和 JDBC-ActiveRecord 适配器（我使用 JRuby 托管一些应用程序），并且在大多数情况下，一切都很好。

不过，我建议使用增强的 ActiveRecord Oracle 适配器。

[http://rubyforge.org/projects/oracle-enhanced/](http://rubyforge.org/projects/oracle-enhanced/)

但是，如果您没有被锁定在 Oracle 中，请使用 Postgres 或 MySQL。

# c# - 为什么我的程序从我的 SD 卡运行这么慢？

> ID：337313
> 
> 赞同：4
> 
> 时间：2008-12-03T14:36:23.667
> 
> 标签：c#, performance, compact-framework, sd-card

将我的 .Net Compact Framework 应用程序移动到 Windows CE 设备的 SD 卡时，该程序的执行速度比从内部存储器运行它要慢。

我想，启动可能会慢一些，但它是整个程序。存储卡没有 IO。

为什么我的应用程序这么慢，紧凑的框架如何处理和加载程序集？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-03T14:45:35.803

它与请求分页有关。您的应用程序不能直接从 SD 卡运行，因为 SD 不是可执行媒体，因此必须将其拉入 RAM 才能运行。Windows CE 通常没有大量的 RAM，因此加载程序不会将您的整个应用程序拉入 RAM 中运行。当然，您的堆和堆栈将在 RAM 中，但程序集本身中的实际 IL 代码会根据需要进行分页。当系统决定不再需要特定页面时，它也会被调出。

这种分页可能会对性能产生影响，尽管我有点惊讶它会产生很大的影响，除非应用程序本身非常大（例如，如果您有很多嵌入式资源，它会从程序集中提取出来）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T15:38:56.990

我同意 ctacke 之前的“按需寻呼”回答。

**您可能会尝试的一个解决方案**是从 SD 卡执行加载程序，将您的实际可执行文件和 DLL 从卡复制到硬盘，然后从加载程序执行您的程序。在随后的执行中，加载程序可以检测硬盘版本是否是最新的，如果是，则直接启动它。如果硬盘版本不是最新的，加载器将再次从卡中复制过期文件，然后执行实际程序。

我之前已经从远程网络位置加载的程序中完成了此操作，并且效果很好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-11T22:59:01.550

如果应用程序在 sd 卡上，某些设备会使您的程序崩溃。它发生在挂起开机设备时。

# javascript - 如何将浏览器从加载状态更改为加载状态？

> ID：337315
> 
> 赞同：3
> 
> 时间：2008-12-03T14:36:49.907
> 
> 标签：javascript, browser

场景：

1.  我通过 JavaScript 在其中动态创建一个 iframe 和一个表单。
2.  表单通过 JavaScript 提交，并向服务器发送 POST 请求。
3.  请求被接收，但浏览器一直处于加载状态（窗口底部的进度条一直在进行，不会停止，仅在表单提交后出现）。

如果我使用这样的 iframe 表单 POST 到其他地方，这不会发生。当尝试不在 iframe 中的常规表单时，也不会发生这种情况。

那么，知道为什么会发生这种奇怪的现象吗？或者如何停止浏览器的加载状态？我尝试从对 POST 的响应中调用`window.stop()`，但无济于事。设置 frame.src 属性似乎可行，但它的代价是在 IE 中会发出恼人的点击声。

在此先感谢您的帮助！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T14:43:35.433

如果在你提交表单之前它处于加载状态：不要忘记`close()`文件，如果你在IFORM中使用`write()`和`writeln()`生成HTML。

如果只是在提交表单之后：你是否从服务器返回了一些东西？

# c# - 没有 .Net Timespan 或 DateTime 函数的 NUnit 测试 DateTime

> ID：337327
> 
> 赞同：0
> 
> 时间：2008-12-03T14:40:07.687
> 
> 标签：c#, timespan

什么是以下的 C# 优化版本，不使用 .Net 的 Timespan 或 DateTime。我将如何进行 NUnit 测试？

```
TimeSpan ts = Date1 - Date2;
int numberOfDays = ts.Days; 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-03T14:48:30.493

您可以将日期转换为刻度，减去，然后将刻度转换回天。虽然你为什么不能使用 TimeSpan？它很可能就是这样做的。

像这样的东西：

```
 DateTime a = DateTime.Now;
      DateTime b = a.AddDays(2);

      // ticks are in hns
      long ticks = b.Ticks - a.Ticks;
      long seconds = ticks / 10000000;
      long minutes = seconds / 60;
      long hours = minutes / 60;
      long days = hours / 24; 
```

我几天都回来了“2”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T14:53:17.237

Date1 和 Date2 是什么类型的？在您的示例中，它看起来是 DateTime。如果不是 DateTime，您希望您的日期在什么变量中？您始终可以在 String 中使用 Date1 和 Date2 并使用 SubString() 来获取年、月和日，但这将是一个真正的痛苦。

解决以下问题的优化方法：

```
TimeSpan ts = Date1 - Date2;
int numberOfDays = ts.Days; 
```

是

```
DateTime Date1 = new DateTime(2008,12,01);
DateTime Date2 = new DateTime(2008,12,25);
int numberOfDayBetweenDateThatShouldBe = 25;
Assert.IsTrue((Date2-Date1).TotalDays == numberOfDayBetweenDateThatShouldBe); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T17:02:17.507

谢谢，这是作业（asp.net）

任务是用 c# 编写一个 asp.net 应用程序，它将 2 个日期作为用户的输入，计算出它们之间的天数并将该数字显示给用户。这不应使用任何内置的 .net 框架 DateTime 或 TimeSpan 类。

唉，我在生产实力上最优雅的实现

```
private int CalculateDays(DateTime start, DateTime end )
{
   DateTime origin = new DateTime(); 
   return (end - origin).Days - (start - origin).Days;
}

protected void Button1_Click(object sender, EventArgs e)
{
    // Parse dates for correctness and range errors, warn as necessary
    DateTime start;
    DateTime end;

    // rough error implement error handling implementation   
    string errors = string.Empty;

         if(!DateTime.TryParse(txt_start_date.Text.Trim(), out start))   errors+="Start date was incorrect";
    else if(!DateTime.TryParse(txt_end_date.Text.Trim(), out end))   errors+= (errors.Length>0? errors+= "\n":"") + "End date was incorrect" ; 
    else if ((end.Day - start.Day) <= 0) errors+= (errors.Length>0? errors+= "\n":"" ) + "End date must be greater than the Start date" ;         //CultureInfo.InvariantCulture
    else 
    {
        Response.Write(CalculateDays(start, end)); 
    }
    Debug.Assert(errors.Length <= 0, errors); 
} 
```

至少在不接触 DateTime.Days 的情况下，我无法看到如何做到这一点。

* * *

**编辑** 好吧，再想一想和一些猴子的工作，但是，在任何地方都没有使用 DateTime 或 Timespan

```
public static class PrimitiveCal
{
    // incremental total days a normal year 
    private static int[] DaysInYr = new int[] {0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334, 365 };

    // incremental total days in a leap year 
    private static int[] DaysInLeapYr = new int[] { 0,31, 60, 91, 121, 152, 182, 213, 244, 274, 305, 335, 366 };

    public static long GetDays(int[] dt_start, int[] dt_end)
    {

        int day_diff = dt_end[0] - dt_start[0];
        int s_mth = dt_start[1];
        int e_mth = dt_end[1];
        int s_year = dt_start[2];
        int e_year = dt_end[2];
        int yr_diff = e_year - s_year;

        return day_diff + (yr_diff > 0 ?
                         // use months as boundaries, cater for leap years
                         (YrType(e_year)[e_mth - 1] +
                         (YrType(s_year)[YrType(s_year).Length - 1] - YrType(s_year)[s_mth - 1])) +
                         (yr_diff == 1 ? 0 : AddMiddleYears(s_year, e_year))

                         // get month sums in same year 
                         : YrType(e_year)[e_mth - 1] - YrType(e_year)[s_mth - 1]);
    }

    private static int AddMiddleYears(int s_year, int e_year)
    {
        int total_days = 0;
        for (int i = s_year + 1; i <= e_year - 1; i++) total_days += YrType(i)[YrType(i).Length - 1];
        return total_days;
    }

    private static int[] YrType(int year)
    {
        return (year % 4  == 0 &&  year%100!=0) || year % 400 ==0 ? DaysInLeapYr : DaysInYr;
    }
} 
```

* * *

# javascript - 要替换的 Javascript 选框 标签 我对 Javascript 毫无希望。这就是我所拥有的： <script type="text/javascript"> function beginrefresh(){ //set the id of the target object var marquee = document.getElementById("marqu 问问题 问问题 2008-12-03T14:40:39.057 88028 次 This question shows research effort; it is useful and clear 13 This question does not show any research effort; it is unclear or not useful Bookmark this question. Show activity on this post. 我对 Javascript 毫无希望。这就是我所拥有的： <script type="text/javascript"> function beginrefresh(){ //set the id of the target object var marquee = document.getElementById("marquee_text"); if(marquee.scrollLeft >= marquee.scrollWidth - parseInt(marquee.style.width)) { marquee.scrollLeft = 0; } marquee.scrollLeft += 1; // set the delay (ms), bigger delay, slower movement setTimeout("beginrefresh()", 10); } </script> 它向左滚动，但我需要它相对无缝地重复。此刻它只是跳回到开头。我的做法可能不可能，如果没有，有人有更好的方法吗？ 这是一个具有很多功能的 jQuery 插件： http://jscroller2.markusbordihn.de/example/image-scroller-windiv/ 而这一款“丝般顺滑” http://remysharp.com/2008/09/10/the-silky-smooth-marquee/ javascripthtmlmarquee 4 7 回答 7 This answer is useful 16 这是一个具有很多功能的 jQuery 插件： http://jscroller2.markusbordihn.de/example/image-scroller-windiv/ 而这一款“丝般顺滑” http://remysharp.com/2008/09/10/the-silky-smooth-marquee/ 于 2008-12-03T15:01:00.263 回答 This answer is useful 8 简单的javascript解决方案： window.addEventListener('load', function () { function go() { i = i < width ? i + step : 1; m.style.marginLeft = -i + 'px'; } var i = 0, step = 3, space = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'; var m = document.getElementById('marquee'); var t = m.innerHTML; //text m.innerHTML = t + space; m.style.position = 'absolute'; // http://stackoverflow.com/questions/2057682/determine-pixel-length-of-string-in-javascript-jquery/2057789#2057789 var width = (m.clientWidth + 1); m.style.position = ''; m.innerHTML = t + space + t + space + t + space + t + space + t + space + t + space + t + space; m.addEventListener('mouseenter', function () { step = 0; }, true); m.addEventListener('mouseleave', function () { step = 3; }, true); var x = setInterval(go, 50); }, true); #marquee { background:#eee; overflow:hidden; white-space: nowrap; } <div id="marquee"> 1 Hello world! 2 Hello world! <a href="#">3 Hello world!</a> </div> JSFiddle 于 2014-10-15T00:15:36.540 回答 This answer is useful 2 我最近使用 Cycle 2 Jquery 插件在 HTML 中实现了一个选取框：http: //jquery.malsup.com/cycle2/demo/non-image.php <div class="cycle-slideshow" data-cycle-fx="scrollHorz" data-cycle-speed="9000" data-cycle-timeout="1" data-cycle-easing="linear" data-cycle-pause-on-hover="true" data-cycle-slides="> div" > <div> Text 1 </div> <div> Text 2 </div> </div> 于 2014-10-17T22:04:22.173 回答 This answer is useful 1 HTML5 不支持该标签，但是许多浏览器仍会“正确”显示文本，但您的代码将无法验证。如果这对您来说不是问题，那可能是一种选择。 CSS3 has the ability, supposedly, to have marquee text, however because anyone that knows how to do it believes it's a "bad idea" for CSS, there is very limited information that I have found online. Even the W3 documents do not go into enough detail for the hobbyist or self-teaching person to implement it. PHP and Perl can duplicate the effect as well. The script needed for this would be insanely complicated and take up much more resources than any other options. There is also the possibility that the script would run too quickly on some browsers, causing the effect to be completely negated. 所以回到 JavaScript - 你的代码 (OP) 似乎是我发现的最干净、最简单、最有效的代码。我会试试这个。对于无缝的事情，我将寻找一种方法来限制结束和开始之间的空白，可能通过执行一个while循环（或类似的）并实际运行两个脚本，让一个休息而另一个正在处理。 也可能有一种方法可以通过单个函数更改来消除空白。我是 JS 的新手，所以我不知道。- 我知道这不是一个完整的答案，但有时想法可能会导致结果，即使只是对其他人而言。 于 2011-07-04T11:13:44.500 回答 This answer is useful 1 此脚本用于替换选框标记 <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script> <script type="text/javascript"> $(document).ready(function() { $('.scrollingtext').bind('marquee', function() { var ob = $(this); var tw = ob.width(); var ww = ob.parent().width(); ob.css({ right: -tw }); ob.animate({ right: ww }, 20000, 'linear', function() { ob.trigger('marquee'); }); }).trigger('marquee'); }); </script> <div class="scroll"> <div class="scrollingtext"> Flash message without marquee tag using javascript! </div> </div> 于 2017-01-09T06:22:02.443 回答 This answer is useful 0 使用@Stano 代码和一些 jQuery 我创建了一个脚本，它将marquee用标准替换旧标签div。该代码还将解析,和marquee等属性。directionscrolldelayscrollamount 这是代码： jQuery(function ($) { if ($('marquee').length == 0) { return; } $('marquee').each(function () { let direction = $(this).attr('direction'); let scrollamount = $(this).attr('scrollamount'); let scrolldelay = $(this).attr('scrolldelay'); let newMarquee = $('<div class="new-marquee"></div>'); $(newMarquee).html($(this).html()); $(newMarquee).attr('direction',direction); $(newMarquee).attr('scrollamount',scrollamount); $(newMarquee).attr('scrolldelay',scrolldelay); $(newMarquee).css('white-space', 'nowrap'); let wrapper = $('<div style="overflow:hidden"></div>').append(newMarquee); $(this).replaceWith(wrapper); }); function start_marquee() { let marqueeElements = document.getElementsByClassName('new-marquee'); let marqueLen = marqueeElements.length for (let k = 0; k < marqueLen; k++) { let space = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'; let marqueeEl = marqueeElements[k]; let direction = marqueeEl.getAttribute('direction'); let scrolldelay = marqueeEl.getAttribute('scrolldelay') * 100; let scrollamount = marqueeEl.getAttribute('scrollamount'); let marqueeText = marqueeEl.innerHTML; marqueeEl.innerHTML = marqueeText + space; marqueeEl.style.position = 'absolute'; let width = (marqueeEl.clientWidth + 1); let i = (direction == 'rigth') ? width : 0; let step = (scrollamount !== undefined) ? parseInt(scrollamount) : 3; marqueeEl.style.position = ''; marqueeEl.innerHTML = marqueeText + space + marqueeText + space; let x = setInterval( function () { if ( direction.toLowerCase() == 'left') { i = i < width ? i + step : 1; marqueeEl.style.marginLeft = -i + 'px'; } else { i = i > -width ? i - step : width; marqueeEl.style.marginLeft = -i + 'px'; } }, scrolldelay); } } start_marquee (); }); 这是一个工作的codepen 于 2018-10-16T10:24:51.767 回答 This answer is useful 0 我最近在一个需要选取框的网站上工作，最初使用的是动态选取框，效果很好，但我无法让文本从屏幕上开始。环顾四周，但找不到像我想要的那样简单的东西，所以我自己做了： <div id="marquee"> <script type="text/javascript"> let marquee = $('#marquee p'); const appendToMarquee = (content) => { marquee.append(content); } const fillMarquee = (itemsToAppend, content) => { for (let i = 0; i < itemsToAppend; i++) { appendToMarquee(content); } } const animateMarquee = (itemsToAppend, content, width) => { fillMarquee(itemsToAppend, content); marquee.animate({left: `-=${width}`,}, width*10, 'linear', function() { animateMarquee(itemsToAppend, content, width); }) } const initMarquee = () => { let width = $(window).width(), marqueeContent = "YOUR TEXT", itemsToAppend = width / marqueeContent.split("").length / 2; animateMarquee(itemsToAppend, marqueeContent, width); } initMarquee(); </script> 和CSS： #marquee { overflow: hidden; margin: 0; padding: 0.5em 0; bottom: 0; left: 0; right: 0; background-color: #000; color: #fff; } #marquee p { white-space: nowrap; margin: 0; overflow: visible; position: relative; left: 0; } 于 2021-08-04T18:11:16.363 回答 Related 1 tomcat - 如何启动外部tomcat？ 1 c - Makefile 中缺少 src 代码文件 1 windows - 使用cmd或双击执行exe 2 magento - 用于电子邮件的 Magento 自定义项和 default.phtml 2 php - 如何实现像 Facebook 这样的通知系统？ 0 c# - 单击后退按钮时如何通过清除浏览器历史记录或缓存来注销我的雅虎帐户 3 javascript - jQuery组合框，如何触发选择事件 0 android - 用于网络服务 android 的 GPS 导航 1 hql - HQL 异常 (org.hibernate.dialect.Dialect$3) 1 php - 已经集成 MailChimp 后如何添加列表 ID？ Reference php × 1429865 c/c++ × 756500 nginx × 49975 mongodb × 159057 mybatis × 3233 anaconda × 13410 pycharm × 14671 python × 1902243 vscode × 56040 docker × 110988 github × 49000 flask × 49129 ffmpeg × 24037 jmeter × 16910 matplotlib × 63493 bootstrap × 54641

> ID：337330
> 
> 赞同：13
> 
> 时间：
> 
> 标签：javascript, html, marquee

我对 Javascript 毫无希望。这就是我所拥有的：

```
<script type="text/javascript">
    function beginrefresh(){

        //set the id of the target object
        var marquee = document.getElementById("marquee_text");

        if(marquee.scrollLeft >= marquee.scrollWidth - parseInt(marquee.style.width)) {
            marquee.scrollLeft = 0;
        }

        marquee.scrollLeft += 1;

        // set the delay (ms), bigger delay, slower movement
        setTimeout("beginrefresh()", 10);

    }
</script> 
```

它向左滚动，但我需要它相对无缝地重复。此刻它只是跳回到开头。我的做法可能不可能，如果没有，有人有更好的方法吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-12-03T15:01:00.263

这是一个具有很多功能的 jQuery 插件：

[http://jscroller2.markusbordihn.de/example/image-scroller-windiv/](http://jscroller2.markusbordihn.de/example/image-scroller-windiv/)

而这一款“丝般顺滑”

[http://remysharp.com/2008/09/10/the-silky-smooth-marquee/](http://remysharp.com/2008/09/10/the-silky-smooth-marquee/)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2014-10-15T00:15:36.540

简单的javascript解决方案：

```
window.addEventListener('load', function () {
	function go() {
		i = i < width ? i + step : 1;
		m.style.marginLeft = -i + 'px';
	}
	var i = 0,
		step = 3,
		space = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
	var m = document.getElementById('marquee');
	var t = m.innerHTML; //text
	m.innerHTML = t + space;
	m.style.position = 'absolute'; // http://stackoverflow.com/questions/2057682/determine-pixel-length-of-string-in-javascript-jquery/2057789#2057789
	var width = (m.clientWidth + 1);
	m.style.position = '';
	m.innerHTML = t + space + t + space + t + space + t + space + t + space + t + space + t + space;
	m.addEventListener('mouseenter', function () {
		step = 0;
	}, true);
	m.addEventListener('mouseleave', function () {
		step = 3;
	}, true);
	var x = setInterval(go, 50);
}, true);
```

```
#marquee {
   background:#eee;
   overflow:hidden;
   white-space: nowrap;
 }
```

```
<div id="marquee">
	1 Hello world! 2 Hello world! <a href="#">3 Hello world!</a>
</div>
```

[JSFiddle](http://jsfiddle.net/lalatino/1r3957g4/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-10-17T22:04:22.173

我最近使用 Cycle 2 Jquery 插件在 HTML 中实现了一个选取框：http: [//jquery.malsup.com/cycle2/demo/non-image.php](http://jquery.malsup.com/cycle2/demo/non-image.php)

```
<div class="cycle-slideshow"  data-cycle-fx="scrollHorz" data-cycle-speed="9000" data-cycle-timeout="1"  data-cycle-easing="linear" data-cycle-pause-on-hover="true" data-cycle-slides="> div" >
  <div>  Text 1  </div>
  <div>  Text 2  </div>
</div> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-07-04T11:13:44.500

HTML5 不支持该标签，但是许多浏览器仍会“正确”显示文本，但您的代码将无法验证。如果这对您来说不是问题，那可能是一种选择。

CSS3 has the ability, supposedly, to have marquee text, however because anyone that knows how to do it believes it's a "bad idea" for CSS, there is very limited information that I have found online. Even the W3 documents do not go into enough detail for the hobbyist or self-teaching person to implement it.

PHP and Perl can duplicate the effect as well. The script needed for this would be insanely complicated and take up much more resources than any other options. There is also the possibility that the script would run too quickly on some browsers, causing the effect to be completely negated.

**所以回到 JavaScript** - 你的代码 (OP) 似乎是我发现的最干净、最简单、最有效的代码。我会试试这个。对于无缝的事情，我将寻找一种方法来限制结束和开始之间的空白，可能通过执行一个while循环（或类似的）并实际运行两个脚本，让一个休息而另一个正在处理。

也可能有一种方法可以通过单个函数更改来消除空白。我是 JS 的新手，所以我不知道。- 我知道这不是一个完整的答案，但有时想法可能会导致结果，即使只是对其他人而言。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-01-09T06:22:02.443

此脚本用于替换选框标记

```
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
    <script type="text/javascript">
    $(document).ready(function() {

         $('.scrollingtext').bind('marquee', function() {
             var ob = $(this);
             var tw = ob.width();
             var ww = ob.parent().width();
             ob.css({ right: -tw });
             ob.animate({ right: ww }, 20000, 'linear', function() {
                 ob.trigger('marquee');
             });
         }).trigger('marquee');

     });
     </script>

<div class="scroll">
    <div class="scrollingtext"> Flash message without marquee tag using javascript!  </div>
 </div> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-10-16T10:24:51.767

使用@Stano 代码和一些 jQuery 我创建了一个脚本，它将`marquee`用标准替换旧标签`div`。该代码还将解析,和`marquee`等属性。`direction``scrolldelay``scrollamount`

这是代码：

```
jQuery(function ($) {

    if ($('marquee').length == 0) {
        return;
    }

    $('marquee').each(function () {

        let direction = $(this).attr('direction');
        let scrollamount = $(this).attr('scrollamount');
        let scrolldelay = $(this).attr('scrolldelay');

        let newMarquee = $('<div class="new-marquee"></div>');
        $(newMarquee).html($(this).html());
        $(newMarquee).attr('direction',direction);
        $(newMarquee).attr('scrollamount',scrollamount);
        $(newMarquee).attr('scrolldelay',scrolldelay);
        $(newMarquee).css('white-space', 'nowrap');

        let wrapper = $('<div style="overflow:hidden"></div>').append(newMarquee);
        $(this).replaceWith(wrapper);

    });

    function start_marquee() {

        let marqueeElements = document.getElementsByClassName('new-marquee');
        let marqueLen = marqueeElements.length
        for (let k = 0; k < marqueLen; k++) {

            let space = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
            let marqueeEl = marqueeElements[k];

            let direction = marqueeEl.getAttribute('direction');
            let scrolldelay = marqueeEl.getAttribute('scrolldelay') * 100;
            let scrollamount = marqueeEl.getAttribute('scrollamount');

            let marqueeText = marqueeEl.innerHTML;

            marqueeEl.innerHTML = marqueeText + space;
            marqueeEl.style.position = 'absolute'; 

            let width = (marqueeEl.clientWidth + 1);
            let i = (direction == 'rigth') ? width : 0;
            let step = (scrollamount !== undefined) ? parseInt(scrollamount) : 3;

            marqueeEl.style.position = '';
            marqueeEl.innerHTML = marqueeText + space + marqueeText + space;

            let x = setInterval( function () {

                if ( direction.toLowerCase() == 'left') {

                    i = i < width ? i + step : 1;
                    marqueeEl.style.marginLeft = -i + 'px';

                } else {

                    i = i > -width ? i - step : width;
                    marqueeEl.style.marginLeft = -i + 'px';

                }

            }, scrolldelay);

        }
    }

    start_marquee ();
}); 
```

这是一个工作的[codepen](https://codepen.io/alordiel/pen/xypEWb)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-08-04T18:11:16.363

我最近在一个需要选取框的网站上工作，最初使用的是[动态选取框](https://www.npmjs.com/package/dynamic-marquee)，效果很好，但我无法让文本从屏幕上开始。环顾四周，但找不到像我想要的那样简单的东西，所以我自己做了：

```
<div id="marquee"> 
```

```
<script type="text/javascript">

  let marquee = $('#marquee p');
  const appendToMarquee = (content) => {
    marquee.append(content);
  }

  const fillMarquee = (itemsToAppend, content) => {
    for (let i = 0; i < itemsToAppend; i++) {
      appendToMarquee(content);
    }
  }

  const animateMarquee = (itemsToAppend, content, width) => {
    fillMarquee(itemsToAppend, content);
    marquee.animate({left: `-=${width}`,}, width*10, 'linear', function() {
      animateMarquee(itemsToAppend, content, width);
    })
  }

  const initMarquee = () => {
    let width = $(window).width(),
    marqueeContent = "YOUR TEXT",
    itemsToAppend = width / marqueeContent.split("").length / 2;
    animateMarquee(itemsToAppend, marqueeContent, width);
  }

  initMarquee();
</script> 
```

和CSS：

```
#marquee {
  overflow: hidden;
  margin: 0;
  padding: 0.5em 0;
  bottom: 0;
  left: 0;
  right: 0;
  background-color: #000;
  color: #fff;
}

#marquee p {
  white-space: nowrap;
  margin: 0;
  overflow: visible;
  position: relative;
  left: 0;
} 
```

# .net - 如何使用 vb.net 将数据插入 Access 表？

> ID：337333
> 
> 赞同：3
> 
> 时间：2008-12-03T14:41:35.060
> 
> 标签：.net, vb.net, ms-access, insert

我想在 Access 数据库中插入一个新行。我正在考虑做类似的事情：

```
oConnection = new Connection("connectionstring")
oTable = oCennection.table("Orders")
oRow = oTable.NewRow
oRow.field("OrderNo")=21
oRow.field("Customer") = "ABC001"
oTable.insert 
```

这对我来说似乎是一种明智的做事方式。

但是，我在网上查找的所有示例似乎都是通过构建 SQL 语句或通过创建“SELECT * From ...”来插入数据，然后使用它来创建大量对象，其中一个似乎允许您to ...
- 使用表的当前内容填充数组。
- 在这个数组中插入一个新行。
- 使用对数组的更改来更新数据库。

使用 vb.net 将数据插入 Access 数据库的最简单方法是什么？
有没有我可以使用的类似于我上面的 pCode 的方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-03T15:15:28.207

这是一种方式：

```
cn = New OleDbConnection("Provider=Microsoft.Jet.OLEDB.4.0;Data Source=C:\emp.mdb;")
cn.Open()
str = "insert into table1 values(21,'ABC001')"
cmd = New OleDbCommand(str, cn)
cmd.ExecuteNonQuery 
```

我会制作一个数据集，添加一个连接到 Access 数据库的 tableadapter，然后让 tableadapter 为我创建更新/删除/修改。然后你可以这样做（假设你的数据库有一个用户表并且你在数据集中映射了它）：

```
 Dim UserDS As New UserDS
    Dim UserDA As New UserDSTableAdapters.UsersTableAdapter
    Dim NewUser As UserDS.UsersRow = UserDS.Users.NewUsersRow

    NewUser.UserName = "Stefan"
    NewUser.LastName = "Karlsson"

    UserDS.User.AddUserRow(NewUser)

    UserDA.Update(UserDS.Users) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T11:35:32.063

如何在 vb.net 中插入字符串只插入我的 pgm 为整数

```
Try
    cn = New OleDbConnection("Provider=Microsoft.Jet.OLEDB.4.0;Data Source=C:\Documents and Settings\User\My Documents\db1.mdb;")
    cn.Open()
    str = "insert into table1 values(" & CInt(t2.Text) & ",'" & (t1.Text) & ") "
    cmd = New OleDbCommand(str, cn)
    icount = cmd.ExecuteNonQuery
    MessageBox.Show("stored")
Catch
End Try
cn.Close() 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-12-16T15:41:40.753

不幸的是，世界并没有重新安排自己以适应你认为它应该如何运作。如果您想使用数据库，最好至少对 SQL 有所了解，因为这通常是它的完成方式。

从好的方面来说，有一整类产品可以满足您的需求。您可以寻找对象关系映射 (ORM) 工具，例如 ActiveRecord、NHibernate 或 LINQ。但是还是要学一些SQL。

# c# - 如何序列化匿名对象以通过 SOAP Web 服务发送？

> ID：337334
> 
> 赞同：5
> 
> 时间：2008-12-03T14:42:18.507
> 
> 标签：c#, asp.net, web-services, serialization, soap

我正在尝试通过 Web 服务发送匿名对象。无论如何我可以在不手动创建一个类并将其转换为该类的情况下做到这一点吗？目前它抛出一个异常，说无法序列化匿名对象。

```
// Some code has been removed here to simplify the example.
[WebMethod(EnableSession = true)]
public Response GetPatientList() {
    var patientList = from patient in ((User)Session["user"]).Practice.Patients
                      select new {
                          patientID = patient.PatientID,
                          status = patient.Active ? "Active" : "Inactive",
                          patientIdentifier = patient.PatientIdentifier,
                          physician = (patient.Physician.FirstName + " " + patient.Physician.LastName).Trim(),
                          lastModified = patient.Visits.Max(v => v.VisitDate)
                      };
    return patientList;
} 
```

提前致谢。

*编辑：*这是我的意思的一个例子，我通过手动创建一个类来返回并用匿名对象填充它......

```
public class Result {
    public bool success;
    public bool loggedIn;
    public string message;
}

public class PracticeInfoResult : Result {
    public string practiceName;
    public string address;
    public string city;
    public string state;
    public string zipCode;
    public string phone;
    public string fax;
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-03T14:49:16.247

匿名类型旨在用于非常松散耦合的数据的简单投影，仅在方法中使用。如果 Web 方法返回某种类型的数据是有意义的，那么它确实应该被体面地封装。换句话说，即使你*能*找到一种方法从 web 方法中返回一个匿名类型的实例，我强烈建议你不要这样做。

我个人也不会创建具有公共字段的类 - 而是使用自动实现的属性，因此如果需要，您可以在以后安全地添加更多行为。

请注意，在您创建了“正确”类型之后，您的查询表达式只需要非常非常轻微地更改 - 只需在两者之间添加类型名称`new`并`{`使用对象初始值设定项即可。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-04T01:06:16.737

这是我最终使用的代码。

```
[WebMethod(EnableSession = true)]
public PatientsResult GetPatientList(bool returnInactivePatients) {
    if (!IsLoggedIn()) {
        return new PatientsResult() {
            Success = false,
            LoggedIn = false,
            Message = "Not logged in"
        };
    }
    Func<IEnumerable<PatientResult>, IEnumerable<PatientResult>> filterActive = 
        patientList => returnInactivePatients ? patientList : patientList.Where(p => p.Status == "Active");
    User u = (User)Session["user"];
    return new PatientsResult() {
        Success = true,
        LoggedIn = true,
        Message = "",
        Patients = filterActive((from p in u.Practice.Patients
                      select new PatientResult() {
                          PhysicianID = p.PhysicianID,
                          Status = p.Active ? "Active" : "Inactive",
                          PatientIdentifier = p.PatientIdentifier,
                          PatientID = p.PatientID,
                          LastVisit = p.Visits.Count > 0 ? p.Visits.Max(v => v.VisitDate).ToShortDateString() : "",
                          Physician = (p.Physician == null ? "" : p.Physician.FirstName + " " + p.Physician == null ? "" : p.Physician.LastName).Trim(),
                      })).ToList<PatientResult>()
    };
}
public class Result {
    public bool Success { get; set; }
    public bool LoggedIn { get; set; }
    public string Message { get; set; }
}
public class PatientsResult : Result {
    public List<PatientResult> Patients { get; set; }
}
public class PatientResult  {
    public int PatientID { get; set; }
    public string Status { get; set; }
    public string PatientIdentifier { get; set; }
    public string Physician { get; set; }
    public int? PhysicianID {get;set;}
    public string LastVisit { get; set; }
} 
```

}

# java - Oracle 表更改监视器

> ID：337335
> 
> 赞同：7
> 
> 时间：2008-12-03T14:42:20.160
> 
> 标签：java, oracle

我有一个连接到远程 Oracle 数据库上的视图的 java 应用程序。

有谁知道在 Java 中监视此表的更改的方法？即，如果有插入更新等我需要做出反应。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-03T14:47:40.277

查看[Oracle Change Notification](https://docs.oracle.com/cd/B19306_01/appdev.102/b14258/d_chngnt.htm#BABEECBE)，这是一个非常有趣的 Oracle 特性。

来自 Oracle 文档：*“数据库更改通知是一项功能，它使客户端应用程序能够向数据库注册查询并接收通知以响应与查询关联的对象的 DML 或 DDL 更改。通知由数据库在 DML 发布时发布或 DDL 事务提交。”*

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-03T14:45:26.427

您可以在表上放置一个 INSERT/UPDATE/DELETE 触发器，以便在对表进行“数据”更改时执行一些操作。（相对于表结构的改变）

我相信 10g 也支持视图触发器。

但我不确定你如何通过轮询来通知java进程。

对不起。

您可能会创建一些解决方案，其中 java 应用程序具有“侦听”服务器，并且数据库将其推回消息。但这听起来很难维护。

[Justin Cave](https://stackoverflow.com/users/10397/justin-cave "贾斯汀洞穴")在评论中建议您可以配置 Oracle Streams 以发送 Java 应用程序可以通过 JMS 订阅的逻辑更改记录 (LCR)。或者触发器可以将记录写入 Java 可以通过 JMS 订阅的高级队列。

您仍然需要警惕 Oracle 事务。由于 Oracle 事务的工作方式，触发器会在更改时触发，但也可能会触发多次。

并且在任何情况下，Java 应用程序在执行提交之前都无法“看到”更改。

# database - 基于文档的数据库与关系数据库的优缺点

> ID：337344
> 
> 赞同：78
> 
> 时间：2008-12-03T14:44:29.580
> 
> 标签：database, nosql, couchdb, relational-database, document-database

我一直在尝试查看是否可以使用基于文档的数据库（在本例中为 CouchDB）来满足某些要求。两个通用要求：

*   具有某些字段的实体的 CRUD，这些字段上具有唯一索引
*   像 eBay 这样的电子商务网络应用程序（[这里有更好的描述](https://stackoverflow.com/questions/299723/can-i-do-transactions-and-locks-in-couchdb)）。

而且我开始认为基于文档的数据库不是满足这些要求的最佳选择。此外，我无法想象基于文档的数据库的用途（也许我的想象力太有限了）。

当我尝试使用面向文档的数据库来满足这些要求时，如果*我向榆树问梨，*你能向我解释一下吗？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-12-03T16:49:00.950

You need to think of how you approach the application in a document oriented way. If you simply try to replicate how you would model the problem in an RDBMS then you will fail. There are also different trade-offs that you might want to make. ([ed: not sure how this ties into the argument but:] Remember that CouchDB's design assumes you will have an active cluster of many nodes that could fail at any time. How is your app going to handle one of the database nodes disappearing from under it?)

One way to think about it is to imagine you didn't have any computers, just paper documents. How would you create an efficient business process using bits of paper being passed around? How can you avoid bottlenecks? What if something goes wrong?

Another angle you should think about is eventual consistency, where you will get into a consistent state eventually, but you may be inconsistent for some period of time. This is anathema in RDBMS land, but extremely common in the real world. The canonical transaction example is of transferring money from bank accounts. How does this actually happen in the real world - through a single atomic transactions or through different banks issuing credit and debit notices to each other? What happens when you write a cheque?

So lets look at your examples:

*   CRUD of entities with some fields with unique index on it.

If I understand this correctly in CouchDB terms, you want to have a collection of documents where some named value is guaranteed to be unique across all those documents? That case isn't generally supportable because documents may be created on different replicas.

So we need to look at the real world problem and see if we can model that. Do you really need them to be unique? Can your application handle multiple docs with the same value? Do you need to assign a unique identifier? Can you do that deterministically? A common scenario where this is required is where you need a unique sequential identifier. This is tough to solve in a replicated environment. In fact if the unique id is required to be strictly sequential with respect to time created it's impossible *if* you need the id straight away. You need to relax at least one of those constraints.

*   ecommerce web app like ebay

I'm not sure what to add here as the last comment you made on that post was to say "very useful! thanks". Was there something missing from the approach outlined there that is still causing you a problem? I thought MrKurt's answer was pretty full and I added a little enhancement that would reduce contention.

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-12-03T16:52:27.543

Is there a need to normalize the data?

*   Yes: Use relational.
*   No: Use document.

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2010-06-14T10:16:17.880

我在同一条船上，我现在喜欢couchdb，我认为整个功能风格很棒。但是我们究竟什么时候开始在 ernest 中将它们用于应用程序。我的意思是，是的，我们都可以非常快速地开始开发应用程序，摆脱所有那些关于正常形式被搁置而不使用模式的讨厌挂断。但是，要造句“我们站在巨人的肩膀上”。使用 RDBMS 以及规范化和使用模式是有充分理由的。我以前的预言机头脑正在思考没有形式的数据。

我在 couchdb 上的主要惊喜因素是复制内容和版本控制系统协同工作。

上个月我一直在绞尽脑汁试图了解 couchdb 的存储机制，显然它使用 B 树但不存储基于正常形式的数据。这是否意味着它真的很聪明，并且意识到数据位被复制，所以让我们只创建一个指向这个 B 树条目的指针？

到目前为止，我正在考虑流式传输到 base64 字符串的 xml 文档、配置文件、资源文件。

但是我会使用 couchdb 来获取结构数据吗？我不知道，对此非常感谢。

在存储 RDF 数据甚至自由格式文本时可能很有用。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2010-01-27T03:13:25.130

一种可能性是拥有一个主要的关系数据库，该数据库存储可以通过其 ID 检索的项目的定义，以及一个用于描述和/或这些项目规范的文档数据库。例如，您可以有一个关系数据库，其中包含具有以下字段的 Products 表：

*   产品编号
*   描述
*   单价
*   批量
*   规格

并且该规格字段实际上将包含对具有产品技术规格的文档的引用。这样，您就可以两全其美了。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-03T14:57:27.837

基于文档的数据库最适合存储文档。Lotus Notes 是一种常见的实现，Notes 电子邮件就是一个例子。对于您所描述的，电子商务、CRUD 等，Realtional DB 更适合存储和检索索引的数据项/元素（与文档相反）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-12-06T15:35:24.103

Re CRUD：整个 REST 范式直接映射到 CRUD（反之亦然）。因此，如果您知道可以使用资源（可通过 URI 识别）和一组基本操作（即 CRUD）对需求建模，那么您可能非常接近基于 REST 的系统，很多面向文档的系统都提供了这种系统的盒子。

# jquery - JQuery：在“内存”而不是 DOM 中构建 HTML

> ID：337352
> 
> 赞同：37
> 
> 时间：2008-12-03T14:46:15.677
> 
> 标签：jquery

有没有办法在将 HTML 片段添加到 DOM 之前“预构建”它？

例如：

```
$mysnippet.append("<h1>hello</h1>");
$mysnippet.append("<h1>world</h1>");
$("destination").append($mysnippet); 
```

其中**$mysnippet**在 DOM 中不存在。我想动态地构建一些 html 块，然后稍后在适当的位置将它们插入到页面中。

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2009-07-07T10:14:34.920

在处理更复杂的节点（尤其是重度嵌套的节点）时，用 HTML 编写节点并将其可见性设置为隐藏是一种更好的方法。

然后，您可以使用 JQuery 的 clone() 方法制作节点的副本并根据您的需要调整其内容。

例如，使用这个 html：

```
<div class="template-node" style="display:none;">
   <h2>Template Headline</h2>
   <p class="summary">Summary goes here</p>
   <a href="#" class="storylink">View full story</a>
</div> 
```

这样做更快且更容易理解：

```
var $clone = $('.template-node').clone();
$clone.find('h2').text('My new headline');
$clone.find('p').text('My article summary');
$clone.find('a').attr('href','article_page.html');
$('#destination').append($clone); 
```

而不是在内存中创建整个节点，如上所示。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2008-12-03T14:54:02.523

是的，你是怎么做到的

这个的一些扩展......

```
$('<div>').attr('id', 'yourid').addClass('yourclass').append().append()... 
```

然后最后

```
.appendTo($("#parentid")); 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2012-12-19T12:48:04.043

旧线程，但我在搜索时碰到了它。

```
var memtag = $('<div />', {
                'class'    : 'yourclass',
                'id'       : 'theId',
                'data-aaa' : 'attributevalue',
                html       : 'text between the div tags'
}); 
```

`memtag`现在是内存中的 html 标记，可以根据需要插入到 DOM 中。如果您使用标签执行此类操作，`img`则可以将图像“预加载”到缓存中以供以后使用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-03T14:54:09.903

当然，只需将它们构建为字符串：

```
$mysnippet = "<h1>hello</h1>";
$mysnippet = $mysnippet + "<h1>world</h1>";
$("destination").append($mysnippet); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-03T14:57:04.873

有一个插件：

[http://plugins.jquery.com/project/appendText](http://plugins.jquery.com/project/appendText)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-05-27T14:23:32.220

```
var sample =
    $('<div></div>')
        .append(
            $('<div></div>')
                .addClass('testing-attributes')
                .text('testing'))
        .html(); 
```

这创造了：

```
<div class="testing-attributes">testing</div> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-07-30T14:53:03.037

您可以预先构建它并附加事件，以及数据属性、内部 html 等。

```
var eltProps = {
    css: {
        border: 1,
        "background-color": "red",
        padding: "5px"
    },
    class: "bblock",
    id: "bb_1",
    html: "<span>jQuery</span>",
    data: {
        name: "normal-div",
        role: "building-block"
    },
    click: function() {
         alert("I was clicked. My id is" + $(this).attr("id"));
    }
};

var elt = $("<div/>", eltProps);

$("body").append(elt); 
```

# entity-framework - *不*在实体框架中使用导航属性？

> ID：337353
> 
> 赞同：7
> 
> 时间：2008-12-03T14:47:08.170
> 
> 标签：entity-framework

有谁知道是否可以*不对*与外键链接的表使用实体框架的导航属性功能？

例如，如果我的客户表有一个 AddressId，我希望在我的模型中使用该 AddressId，我不希望它有一个 .Address 属性。但到目前为止，我一直无法弄清楚如何做到这一点。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-03T15:38:35.977

当然，你可以做到这一点。只是设计师帮不了你太多。删除导航属性，并为 AddressId 添加一个标量属性。它会起作用，但你必须小心在设计器中点击更新模型，因为它可能会尝试为你“修复”一些东西。习惯编辑 EDMX 是值得的；它没有那么坏。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-02-15T18:11:31.853

在设计器中，您可以将导航属性设置为具有私有 getter/setter。虽然它们仍然*存在*，但因为 Entity Framework（默认情况下）会延迟加载，它实际上不会在运行时从数据库中检索任何数据。下次您从数据库更新模型时，它们不会重新生成。

# javascript - JavaScript：长长数的按位移位

> ID：337355
> 
> 赞同：19
> 
> 时间：2008-12-03T14:47:32.880
> 
> 标签：javascript

我需要在 JavaScript 中按位移动一个值 64 次。但是 JavaScript 在`32`.

例如：

```
for(var j = 0; j < 64; j++)
{
    mask = mask << 1;
    console.log(mask);
} 
```

这将打印 value from `0`to`1073741824`但随后几轮并开始打印`0`。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-12-03T15:43:19.070

“在 Java 中，按位运算符处理整数。JavaScript 没有整数。它只有双精度浮点数。因此，按位运算符将其数字操作数转换为整数，执行其业务，然后将它们转换回来。在大多数语言中，这些操作符离硬件很近，速度很快。在 JavaScript 中，它们离硬件很远，速度很慢。JavaScript 很少用于位操作。” - Douglas Crockford，[Javascript：好的部分](http://safari.oreilly.com/9780596517748/bitwise_operators)

关键是您实际上没有任何理由使用按位运算符。只需乘以或除以 2^numbits。

您的代码应该是：

```
for(var j = 0; j < 64; j++) {
 mask = mask * 2;
 console.log(mask);
} 
```

或者一般来说：

```
function lshift(num, bits) {
    return num * Math.pow(2,bits);
} 
```

你明白了。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-03T14:59:30.923

JavaScript 最初将其所有数字存储为 64 位，但是一旦您开始使用按位运算符，解释器就会将数字转换为 32 位表示形式。

位运算符在 JS 中有点 hacky，所以很烦人，你可能不得不做一些更聪明的事情，比如编写你自己的 64 位函数。

# c# - .NET 2.0：向通讯组发送电子邮件

> ID：337363
> 
> 赞同：4
> 
> 时间：2008-12-03T14:48:51.083
> 
> 标签：c#, email, .net-2.0

再会，

我们刚刚将 Web 应用程序 .NET 1.1 转换为 .NET 2.0。我们在发送电子邮件时遇到了重大问题。

我们正在使用通讯组（例如：WebDevelopersGroup）向公司中的所有开发人员发送电子邮件。这些组不以“@ something.com”结尾。这些组是在 Lotus Notes 中创建的，我们无法访问这些组中包含的所有单个电子邮件

在 .NET 2.0 中，您不能使用 email.To 并且需要使用：email.To.Add("WebDevelopersGroup");

这会导致 System.Format 带有以下消息：

指定的字符串不是电子邮件地址所需的格式。

有谁知道如何在 2.0 中发送到电子邮件组？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T13:07:25.737

您可以为小组提供完整的 Internet 电子邮件地址。如果您不知道如何操作，请咨询您的管理员。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T15:16:50.670

我相信您可以从 .net 与 Lotus Notes 交互并查询它以获取组中的 xyz@xyz.xyz 地址。我不是很熟悉，但你可以从这里开始：

*   [http://www.codeproject.com/KB/cs/lotusnoteintegrator.aspx](http://www.codeproject.com/KB/cs/lotusnoteintegrator.aspx)

*   [IBM Lotus Notes 和 .NET](http://www.ibm.com/developerworks/lotus/library/domino-msnet/index.html?S_TACT=105AGX13&S_CMP=EDU)

祝你好运！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T15:32:37.453

我必须在这里假设，如果允许这样做*并*在 .Net 1.1 中工作，那是因为 .Net 或操作系统将域附加到组名“WebDeveloppersGroup”上，这可能是“WebDeveloppersGroup@yourdomain.com”。该组在 Lotus 中可能不会以这种方式显示，但要在该地址接收外部电子邮件，它必须以前已经解析过。为了测试这一点，我只需将您的域名附加到地址上，看看它是否有效。

# excel - OLE Excel 对象操作导致运行时错误“91”

> ID：337364
> 
> 赞同：0
> 
> 时间：2008-12-03T14:48:59.820
> 
> 标签：excel, vb6, ole, runtime-error

我正在维护一个用 Visual Basic 6.0 编写的应用程序，它利用`Excel.Sheet.8`类对象的几个 OLE 控件。一些用户在尝试操作 excel 对象的代码中遇到以下错误。

> 运行时错误“91”：对象变量或未设置块变量

以下是触发此错误的代码示例。我相信问题发生在：

```
Set oExcel = oleXl.object 
```

以下是代码中发生的点：

```
Private Sub Form_Load()
    Dim i As Integer
    Dim j As Integer
    Dim sTempStringA As String
    Dim sTempStringB As String

    'Set up excel sheet
    centerform Me

    Set oOutGrid = oleXlOutput.object
...

Private Sub Form_Load()

centerform Me
Set oOtherFx = oleXlFx.object
...

Private Sub Form_Load()
Dim iRet As Integer
Dim i As Integer

On Error GoTo Err_Handler

centerform Me

Call InitArray

Me.Caption = "TJUJ | Version " & version & " | Enter Custom Fx"
Set oBook = oleExcel.object
... 
```

是否存在从这行代码生成此错误的特定情况或环境，或者我可以确保在代码中的这一点始终可以访问对象的方式？

该错误只是偶尔发生，我根本无法在我的开发人员机器上重现它。我也无权访问它正在发生的机器，但是当有一个 EXCEL.EXE 进程的实例正在运行时，它似乎会遇到。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-19T20:18:58.427

当您收到运行时错误 91 时，您可以打赌语句中的某处存在未初始化的对象。换句话说，您正在尝试使用值为 Nothing 的变量/对象的属性或方法。

在您的示例中，oleXl、oleXlFx 和 oleExcel 可能什么都不是。因此，当您引用他们的 .object 属性时，您会触发 RTE。

在您的代码中的某处，这些变量必须被初始化为某些东西。寻找类似`Set oleXl = CreateObject("Excel.Application")`或的语句`Set oleXl = New Excel.Application`

一个建议；当您找到实际初始化这些 OLE 对象的语句时，请检查错误处理的编码方式。如果你看到这样的事情：

```
On Error Resume Next
Set oleXl = CreateObject(... 
```

添加测试以确保对象已实例化

```
On Error Resume Next
Set oleXl = CreateObject(...
If oleXl Is Nothing Then
   MsgBox "Hey, my object is Nothing!"
End If 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-07-15T11:32:14.177

Microsoft 建议我们可以通过创建新的注册表项来修复**错误 91 。**要创建新密钥，请按照以下步骤操作。

*   单击 Windows 开始菜单
*   `Regedit`在搜索框中输入
*   按回车
*   在注册表中找到以下条目。`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Transaction Server`
*   现在选择事务服务器并右键单击它
*   选择新建，然后选择密钥
*   将密钥命名为`Debug`
*   右键单击调试键并选择新建
*   现在选择密钥并将密钥命名为`RunWithoutContext`

参考：[http ://backspacetab.com/error-91/](http://backspacetab.com/error-91/)

# vb.net - 使用 MSBuild 更新程序集信息失败

> ID：337368
> 
> 赞同：0
> 
> 时间：2008-12-03T14:49:26.327
> 
> 标签：vb.net, msbuild

全部

我正在尝试使用 AssemblyInfo 任务自动更新项目的装配信息，但在构建之前目标似乎什么都不做（没有失败/错误）只是没有更新/创建

下面是我正在使用的 build.proj 文件（显然有些内容已更改）

任何人都可以帮忙吗？

```
<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build"  
         xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <Import Project="$(MSBuildExtensionsPath)\MSBuildCommunityTasks\MSBuild.Community.Tasks.Targets"/>
  <Import Project="$(MSBuildExtensionsPath)\Microsoft\AssemblyInfoTask\Microsoft.VersionNumber.targets"/>
  <PropertyGroup>
    <Major>1</Major>
    <Minor>0</Minor>
    <Build>0</Build>
    <Revision>0</Revision>
  </PropertyGroup>
  <PropertyGroup>
    <BuildDir>C:\svn\Infrastructure</BuildDir>
  </PropertyGroup>

  <ItemGroup>
    <SolutionsToBuild Include="Infrastructure.sln"/>
  </ItemGroup>

  <Target Name="Build" DependsOnTargets="ChangeDataAccessAssemblyInfo">
    <RemoveDir Directories="$(BuildDir)\Builds" Condition="Exists('$(BuildDir)\Builds')" />
    <MSBuild Projects="@(SolutionsToBuild)" Properties="Configuration=Debug" Targets="Rebuild" />
  </Target>

  <ItemGroup>
    <TestAssemblies Include="Build\Logging\Logging.UnitTests.dll" />
  </ItemGroup>

  <!--<UsingTask TaskName="NUnit" AssemblyFile="$(teamcity_dotnet_nunitlauncher_msbuild_task)" />
  <Target Name="Test" DependsOnTargets="Build">
    <NUnit NUnitVersion="NUnit-2.4.6" Assemblies="@(TestAssemblies)" />
  </Target>-->

  <Target Name="ChangeDataAccessAssemblyInfo" >
    <Message Text="Writing ChangeDataAccessAssemblyInfo file for 1"/>
    <Message Text="Will update $(BuildDir)\DataAccess\My Project\AssemblyInfo.vb" />
    <AssemblyInfo CodeLanguage="VB"
       OutputFile="$(BuildDir)\DataAccess\My Project\AssemblyInfo_new.vb"                
       AssemblyTitle="Data Access Layer"
       AssemblyDescription="Message1"
       AssemblyCompany="http://somewebiste"
       AssemblyProduct="the project"
       AssemblyCopyright="Copyright notice"
       ComVisible="true"
       CLSCompliant="true"
       Guid="hjhjhkoi-9898989"
       AssemblyVersion="$(Major).$(Minor).1.1"
       AssemblyFileVersion="$(Major).$(Minor).5.7"
       Condition="$(Revision) != '0' "
       ContinueOnError="false" />

    <Message Text="Updated Assembly File Info" 
             ContinueOnError="false"/>
  </Target>  
</Project> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-04T01:26:36.087

我认为您在 AssemblyInfo 任务中缺少 AssemblyInfoFiles 属性的规范。这是我正在从事的项目的外观...

```
<Target Name="AfterGet">
    <Message Text="In After Get"/>

    <CreateItem Include="$(SolutionRoot)\Source\SomeProject\My Project\AssemblyInfo.vb">
        <Output ItemName="AssemblyInfoFiles" TaskParameter="Include"/>
    </CreateItem>

    <Attrib Files="@(AssemblyInfoFiles)"
            ReadOnly="false"/>

    <AssemblyInfo AssemblyInfoFiles="@(AssemblyInfoFiles)"
        AssemblyDescription="$(LabelName)">
    </AssemblyInfo>
</Target> 
```

我们所做的是首先使用创建一个包含我们将要更新的文件的名称的属性。我们必须通过 createItem 执行此操作，因为当我们开始构建时，该文件不存在（这就是 MSBuild 评估构建文件中的和定义的时候。

然后我们从文件中取出只读位。

最后，我们调用 AssemblyInfo 任务，将要更新的文件和我们想要给它的自定义程序集名称传递给它（在这种情况下，我们将 TFS 构建标签放入“程序集描述”字段，以便我们可以轻松判断哪个团队构建大会来自。

# java - 数据结构刷新（Java）

> ID：337389
> 
> 赞同：5
> 
> 时间：2008-12-03T14:54:37.673
> 
> 标签：java, data-structures

这对你们中的许多人来说应该很容易，但对我来说，当我回到基本的 Java 编码时，这只是需要去除一点锈迹。在其他语言中长期使用血腥的关联数组让我变得很好，被宠坏了。:P

我的问题很简单：我将一组对象存储在一个列表中，每个对象都包含一个字符串和一个数字。我希望插入此列表的每个对象都按其字符串的字母顺序排序。我还希望能够通过字符串从列表中检索对象。我想尽可能正式和/或有效地做到这一点。

Java 标准库中是否已经为此提供了一些可用的东西？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-03T15:01:22.290

有一篇很棒的[关于 java 集合](http://java.sun.com/docs/books/tutorial/collections/index.html)的文章，它涵盖了您的大部分需求。

关于这个的简短建议：使用带有自定义比较器的[TreeMap](http://java.sun.com/j2se/1.5.0/docs/api/java/util/TreeMap.html)（比较器 c）。key 是字符串，value 是字符串和数字的复合对象

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-03T14:57:58.773

这听起来像一个[SortedMap](http://java.sun.com/j2se/1.4.2/docs/api/java/util/SortedMap.html)。以字符串为键，数字为值。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-03T15:00:35.007

除了 SortedMap，你还可以有一个

```
`TreeSet<Pair<String, Number>>`
```

`您在其中提供比较器以对对进行排序（或使您的 Pair 类实现 Comparable 并在那里执行）。

这使对象与数据结构分开，虽然对于像这样的微不足道的示例来说这没什么大不了的，但您可以想象 MyObject 实现 Comparable 的 TreeSet<MyObject> 从长远来看更容易理解。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-03T22:09:16.843

如果列表中的对象中有重复的字符串值，您可能需要查看 [Google Collections 的 TreeMultimap](http://google-collections.googlecode.com/svn/trunk/javadoc/com/google/common/collect/TreeMultimap.html)。使用 TreeMultimap，不仅对键进行排序，而且具有相同键的所有值也存储在集合中。

```
Multimap<String, Pair> mm = new TreeMultimap<String, Pair>(
      new Comparator<String>(){...}, 
      new PairComparator());
mm.put("A", new Pair("A", 1));
mm.put("B", new Pair("B", 2));
mm.put("B", new Pair("B", 3));
Collection values = mm.values(); 
   // values are [Pair("A", 1), Pair("B", 2), Pair("B", 3)]
Collection bValues = mm.get("B"); 
   // bValues are [Pair("B", 2), Pair("B", 3)] 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2010-06-01T13:20:02.083

我做过类似的事情，我使用 ArrayList 来存储它们的对象并编写比较器来对 arraylist 进行排序。

# php - 在 Windows XP Professional 中测试 PHP 的最简单方法是什么？

> ID：337405
> 
> 赞同：0
> 
> 时间：2008-12-03T14:58:52.047
> 
> 标签：php, testing, windows-xp

我想在运行 Windows XP Professional 的本地机器上测试一些 PHP。我熟悉为上传编写 PHP 代码，但不熟悉运行 Web 服务器。

**设置测试环境的最简单方法是什么？**如果您可以提供分步说明，那就太好了。

[（我在这个线程](https://stackoverflow.com/questions/125022/install-php-on-xp-iis-51)中看到推荐的 WAMP - 想法？）

## 更新 - 一年后

一点自我推销：在使用XAMPP很久之后，我开始想要它没有包含的东西。（对 PDO 的支持非常重要 - 每次我尝试同时启用 pdo 和 mysqli 时，都会出现问题。）我最终完成了单独安装 Apache、PHP、MySQL 和 PHPMyAdmin 的过程，并[通过屏幕截图记录了该过程我的博客。](http://sleeplessgeek.blogspot.com/2010/01/setting-up-apache-php-mysql-phpmyadmin.html)

我能够以这种方式进行的一些配置可以在 XAMPP 中完成，但只是因为我必须自己进行设置，我才发现了新的东西（比如能够从 c:\whatever 中提供文件） c:\program files\apache\htdocs)。

总的来说，我对单独安装这些项目更满意。但是 XAMPP 是一个很好的（也很容易）开始的包，并且在我使用它时为我提供了很好的服务。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-03T15:08:10.267

[![替代文字](https://i.stack.imgur.com/8PuYL.gif)](https://i.stack.imgur.com/8PuYL.gif)
[（来源：[apachefriends.org](http://www.apachefriends.org/images/1240.jpg)）]

[Xampp](http://www.apachefriends.org/en/xampp.html)是最简单的。您可以逐步设置所有内容，如果您需要进一步配置（虚拟服务器，扩展），您可以在目录中拥有普通的 php.ini 和其他文件，您可以自己编辑。

这是 Windows 的[分步安装](http://www.apachefriends.org/en/xampp-windows.html#522)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T15:02:14.753

[来自 ApacheFriends](http://www.apachefriends.org/en/xampp.html)的 XAMPP 的设置和使用非常简单。

**请注意**，在 2008 年 12 月 3 日 15:02 UTC 时，该站点似乎已关闭。
**请注意**，它又回来了！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T15:04:41.427

我推荐 XAMPP 而不是 WAMP，用于跨平台 (X)、Apache、MySQL、PHP 和 Perl，所有这些都在一个包中。它的设置和使用非常简单，就像 WAMP 在系统托盘中放置一个图标来管理它一样。

你可以在这里得到它：[www.apachefriends.org/en/xampp-windows.html](http://www.apachefriends.org/en/xampp-windows.html)。该站点还包括快速启动和运行的全面说明。

[http://portableapps.com/apps/development/xampp](http://portableapps.com/apps/development/xampp)甚至还有一个便携版本。

# visual-studio - 在 Visual Studio 中折叠相关文件

> ID：337406
> 
> 赞同：10
> 
> 时间：2008-12-03T14:58:57.303
> 
> 标签：visual-studio, visual-studio-2008

在 Visual Studio 中，你们中的大多数人都会注意到相关文件可以合并为一个。例如

*   Form1.cs
    *   Form1.Designer.cs

我正在创建一个 DAL 库，并将部分类拆分为多个文件，例如：

*   SomeTableClass.cs
    *   SomeTableClass.Generated.cs
    *   SomeTableClass.SomethingElse.cs

Visual Studio 中是否有任何方法可以识别这些文件相互关联并创建可折叠效果？

谢谢

托尼

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-03T15:14:52.170

在我的（VisualStudio 2005）系统中，它们存储在注册表中

`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VisualStudio\8.0\Projects\{E24C65DC-7377-472B-9ABA-BC803B73C61A}\RelatedFiles`

对于 VisualStudio 2008，`\8.0\`将`\9.0\`

但是请注意，中间的 GUID 指的是项目的类型（VB 控制台、C# Web 等）。您可能需要四处寻找适合您的产品。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-30T17:57:27.327

在 VS 2008 中，还有一个项目文件级别的方法可以通过`DependentUpon`标签来执行此操作。您将编辑您的项目文件，使其如下所示：

```
<Compile Include="SomeTableClass.cs" />
<Compile Include="SomeTableClass.Generated.cs">
    <DependentUpon>SomeTableClass.cs</DependentUpon>
</Compile> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-11-01T17:22:19.343

在我的 Windows 7 x64 环境中，Visual Studio 2008 Professional 的注册表项位于此处：

`HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\VisualStudio\9.0\Projects\{E24C65DC-7377-472B-9ABA-BC803B73C61A}\RelatedFiles`

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-11-02T18:39:48.857

在 Visual Studio 2012 中，它们位于 中`HKCU`，即：

`HKEY_CURRENT_USER\Software\Microsoft\VisualStudio\11.0_Config\{E24C65DC-7377-472B-9ABA-BC803B73C61A}\RelatedFiles`

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-11-04T16:52:33.127

一个有用的 VS 插件已经出现，它为我解决了这个问题：[NestIn](http://visualstudiogallery.msdn.microsoft.com/9d6ef0ce-2bef-4a82-9a84-7718caa5bb45)

# macos - 如何在 Mac OSX 上从我的应用程序启动屏幕键盘？

> ID：337412
> 
> 赞同：0
> 
> 时间：2008-12-03T15:00:48.253
> 
> 标签：macos, keyboard, accessibility

我知道您可以在 Mac OSX 上访问一个屏幕键盘，但是我需要添加一个工具栏按钮才能从我的应用程序中启动它。

有人知道我该怎么做吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-03T16:47:27.693

您可以以您的语言执行的任何方式启动 KeyboardViewerServer.app（您不说是哪种方式）

从终端：

```
open -a KeyboardViewerServer 
```

我在 /System/Library/Components/KeyboardViewer.component/Contents/SharedSupport/KeyboardViewerServer.app 找到它

如果您在 Leopard 上遇到问题，另请参阅

[http://discussions.apple.com/thread.jspa?threadID=1257002&tstart=50](http://discussions.apple.com/thread.jspa?threadID=1257002&tstart=50)

# java - Java 的 Earley 解析器生成器

> ID：337414
> 
> 赞同：1
> 
> 时间：2008-12-03T15:01:05.897
> 
> 标签：java, parsing, earley-parser

我正在寻找一个[Earley 解析器](http://en.wikipedia.org/wiki/Earley_algorithm)生成器，它能够生成 Java 输出代码，即为词法分析器和解析器生成 Java 代码，并允许包含为语法规则执行的操作（实现为 Java 代码）。

我查看了两个生成 Java 代码（[Pep](http://www.ling.ohio-state.edu/~scott/#projects-pep)和[PEN](http://linguateca.dei.uc.pt/index.php?sep=recursos)）的 Earley 解析器生成器，但它们似乎都不允许将动作嵌入到语法中。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-10-24T13:47:47.240

如果我理解您的问题，“在语法中嵌入动作”是指在语法中插入语义动作，以便它们“内联”执行（例如，在解析阶段，因为正在解析输入）。

Earley 解析器不适合这种情况，因为它们允许**任何** 上下文无关的语言语法（甚至是模棱两可的语法）。见：[http ://en.wikipedia.org/wiki/Earley_algorithm](http://en.wikipedia.org/wiki/Earley_algorithm)

基本上：对于给定的执行和给定的状态，Earley 解析器包含**所有**可能的解析状态。传统方法（例如 Yacc/Bison）是在匹配规则或部分输入后执行语义动作。但是当解析一个模棱两可的语法时（例如，一个具有 Reduce/Reduce 冲突的语法），Earley 解析器将同时处理“归约”，并且由于它的模棱两可，不会知道应该执行哪个动作。

使用 Earley 解析器的常用方法是解析输入并最终得到一个解析树*森林*，您稍后可以在这些解析树上执行所需的操作（例如丢弃那些您知道无效的，或对其应用一些语义操作或转换）。

然而，有一些关于这个主题的研究试图内联执行一些动作（对不起，只找到这个链接）[https://link.springer.com/article/10.1007/s00236-009-0107-6](https://link.springer.com/article/10.1007/s00236-009-0107-6)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-04-15T19:32:39.777

> 它们似乎都不允许将动作嵌入到语法中。

一般来说，将动作直接嵌入到语法中并不是一个好主意。最好将动作与语法分离。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T16:00:43.263

不确定这是否是一个答案，但我经常使用的扫描仪生成器之一是[JFlex](http://www.jflex.de)，它输出 Java 代码。

它与[CUP](http://www2.cs.tum.edu/projects/cup/manual.html)密切合作，后者在操作方面更接近一些。

# php - 确定数组中最长元素的长度（以字符为单位）的最佳方法是什么？

> ID：337419
> 
> 赞同：2
> 
> 时间：2008-12-03T15:02:06.737
> 
> 标签：php, arrays

确定数组中最长元素的长度（以字符为单位）的最佳方法是什么？

我需要在选择框的选项值数组中找到最长的元素，以便我可以动态设置宽度。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-03T15:40:38.407

如果您只想要最高值：

```
echo max(array_map('strlen', $arr)); 
```

如果你想要最长的值：

```
function array_longest_strings(array $arr)
{
    $arr2 = array_map('strlen', $arr);
    $arr3 = array_intersect($arr2, array(max($arr2)));
    return array_intersect_key($arr, $arr3);
}
print_r(array_longest_strings($arr)); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-03T15:31:19.157

我想我会用一种不同的、不太明显的方式来写这个，因为它太糟糕了。

没有条件，理解这是如何工作的，是留给读者的练习。

```
$x = array( 
  'foo ', 'bar ____' , 'baz', 'q-----------', 'doo' 
);

function max_str( $stringArray )
{
  $m = '_'; 
  foreach($stringArray as $item ) 
  {
    $m[ strlen($item) ] = '_'; 
  }
  return strlen( $m ); 
}

print max_str( $x ); 
```

**注意：**设置`$m`为只是`""`不起作用。Php 很糟糕，并且由于某种原因转换`$m`为一个数组。纯粹的天才。

### 评论回复

> 不初始化 $m=0 然后在循环中执行 $m = max($m, strlen($item)) 有什么意义

因为我想与众不同。已经提供了这个答案范围。这里的想法是尝试“可视化”处理它，从逻辑上讲，我试图尽可能接近“将其打印到动态文本框中并查看文本框有多宽”的逻辑。这里唯一的问题是字符串不是二维的，所以垂直堆叠“线”是尽可能接近的。我真正想做的是

```
 substr( $m , 0 , strlen($item)) = $item; 
```

但是php没有LValues，它会很复杂并且使用糟糕的循环来实现它，所以我只是在$length位置用'_'短路了一点。

当然，您可能会争辩说这是解决问题的错误方法，但是 IMO，正在尝试的方法以及在 PHP 中解决问题的想法也是解决问题的错误方法，所以如果我做错了什么，我在可能暴露其他奇怪的编码技巧的方式上也可能是创新性的错误。

> 另外，据我所知，$stringArray = array("")..

是的，我必须承认一个小警告，但是，如果用户有一个没有字符串或所有字符串长度为 0 的选项框，那么你一开始就有很大的失败，没有人会正确地折腾选项框是在这种情况下太大了 5 个像素。

### 为什么这一切都是失败的

实际上，任何没有将字符对与消耗的有效空间相关联的完全成熟的字符紧缩映射的算法都是不正确的。你可以使用等宽字体，但其他任何东西都会变得很糟糕。

*   **iiiiiiiii**
*   **呸呸呸**
*   **呜呜呜**
*   **嗯嗯嗯嗯嗯**
*   iiiiiiiii
*   呸呸呸
*   呜呜呜
*   嗯嗯嗯嗯嗯
*   `iiiiiiiiii`
*   `llllllllll`
*   `oooooooooo`
*   `mmmmmmmmmm`

每个10份，但这样的空间利用方式多种多样！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T15:07:38.037

有两种方法可以做到这一点：

1.  遍历整个数组并保持最大元素大小；
2.  不要遍历整个数组并从魔术帽中获取最大元素大小:-)

然后，您必须知道将使用什么字体来显示内容，并获取字符大小、字距和所有这些内容，以便您能够计算单词的实际宽度，除非您使用`fixed width`字体，否则不是您将显示的字符串中的字符数。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-03T15:08:37.580

```
$longval = 0;
$index = -1;

for($i = 0; $i < count($array); $i++)  {
   if($len = strlen($array[$i]) > $longval) { 
       $longval = $len;
       $index = $i;
   }
} 
```

那么你知道`$array[$index]`长度最长的元素`$longval`

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-03T15:24:29.157

这将返回最长值的键，也可以为您提供值本身

```
function array_longest_value( $array, &$val = null )
{
    $val = null;
    $result = null;

    foreach( array_keys( $array ) as $i )
    {
        $l = strlen( $array[ $i ] );
        if ( $l > $result )
        {
            $result = $i;
            $val = $array[ $i ];
        }
    }

    return $result;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-03T15:12:09.320

```
$longest_length = 0;

foreach($array as $key => $value
{
    if(isset($value[$longest_length + 1]))
    {
        $longest_length = strlen($value);
    }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-03T15:30:10.580

```
$array = array('andy', 'patrick', 'mat', 'perenenappels');

function len_sort($a, $b) {
    return strlen($a) > strlen($b) ? 1 : 0;
}

usort($array, 'len_sort');

echo array_pop($array); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-03T15:48:07.253

我相信这就是所谓的[高水印算法](http://books.google.com/books?id=4pINCzVk9NMC&pg=PA61&lpg=PA61&dq=high-water+mark+algorithm)。O(n) 是最好的，除非列表已经按长度排序，否则它将是 O(1)。

“你可以爬上拉斯维加斯的一座陡峭山丘，向西看，用正确的眼睛，你几乎可以看到高水位线——海浪最终破裂并倒退的地方。” - Hunter S. Thompson 博士

# linux - 如何在 Linux 中使用 C 进行 UDP 广播？

> ID：337422
> 
> 赞同：35
> 
> 时间：2008-12-03T15:03:00.837
> 
> 标签：linux, udp

如何在 Linux 中使用 C 进行 UDP 广播？

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2012-07-19T18:52:42.267

在许多 IP 堆栈中，例如 Linux，此代码不起作用。您的套接字必须具有广播权限。尝试这个：

```
bcast_sock = socket(AF_INET, SOCK_DGRAM, 0);
int broadcastEnable=1;
int ret=setsockopt(bcast_sock, SOL_SOCKET, SO_BROADCAST, &broadcastEnable, sizeof(broadcastEnable));

/* Add other code, sockaddr, sendto() etc. */ 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-12-03T15:17:13.507

放松是对的，除了你应该使用'sendto'

这是一个示例，假设您已经有一个套接字。它取自[clamav](http://www.blushingpenguin.com/svn/vendor/clamav/0.94.2/clamav-milter/clamav-milter.c)

```
static void
broadcast(const char *mess)
{
    struct sockaddr_in s;

    if(broadcastSock < 0)
        return;

    memset(&s, '\0', sizeof(struct sockaddr_in));
    s.sin_family = AF_INET;
    s.sin_port = (in_port_t)htons(tcpSocket ? tcpSocket : 3310);
    s.sin_addr.s_addr = htonl(INADDR_BROADCAST);

    cli_dbgmsg("broadcast %s to %d\n", mess, broadcastSock);
    if(sendto(broadcastSock, mess, strlen(mess), 0, (struct sockaddr *)&s, sizeof(struct sockaddr_in)) < 0)
        perror("sendto");
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-03T15:07:44.057

通常使用 Berkeley 套接字 API，将`sendto()`一个或多个数据报发送到一个已知的[广播类](http://en.wikipedia.org/wiki/Broadcast_address)IP 地址。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-12T04:15:23.557

我最近写了 udp 多播服务器进行测试。要订阅多播，您需要为客户端订阅多播组 225.0.0.37 端口 12346 和端口 12345（2 个订阅源 - 一个订阅源发送“Hello, World！”另一个“Bye，Office！”）。

我一直在用它来测试我的客户端，客户端和服务器都在同一个盒子上运行，所以可能有些位可能不起作用，但先试一试。

```
#include <stdlib.h>
#include <sys/types.h>
#include <sys/socket.h>
#include <netinet/in.h>
#include <arpa/inet.h>
#include <time.h>
#include <string.h>
#include <stdio.h>

#include <unistd.h>

#define BYE_OFFICE 12346
#define HELLO_PORT 12345
#define HELLO_GROUP "225.0.0.37"

int main(int argc, char *argv[])
{
    struct sockaddr_in addr;
    struct sockaddr_in addr2;
    int fd;
    int fd2;
    char *message = "Hello, World!";
    char *message2 = "Bye, Office!";

    if ((fd = socket(AF_INET, SOCK_DGRAM, 0)) < 0)
    {
        perror("socket");
        exit(1);
    }

    if ((fd2 = socket(AF_INET, SOCK_DGRAM, 0)) < 0)
    {
        perror("socket");
        exit(1);
    }

    /* set up destination address */
    memset(&addr,0,sizeof(addr));
    addr.sin_family = AF_INET;
    addr.sin_addr.s_addr = inet_addr(HELLO_GROUP);
    addr.sin_port=htons(HELLO_PORT);

    memset(&addr2,0,sizeof(addr2));
    addr2.sin_family = AF_INET;
    addr2.sin_addr.s_addr = inet_addr(HELLO_GROUP);
    addr2.sin_port=htons(BYE_OFFICE);

    while (1)
    {
        if (sendto(fd, message, strlen(message), 0,(struct sockaddr *) &addr, sizeof(addr)) < 0)
        {
            perror("sendto");
            exit(1);
        }
        sleep(3);
        if (sendto(fd2, message2, strlen(message2), 0,(struct sockaddr *) &addr2, sizeof(addr2)) < 0)
        {
            perror("sendto2");
            exit(1);
        }
        sleep(3);
    }
} 
```

# c# - 从 .NET 中的 Release 版本中删除代码

> ID：337431
> 
> 赞同：15
> 
> 时间：2008-12-03T15:05:51.783
> 
> 标签：c#, debugging

我一直在围绕 System.Diagnostics.Debug 的使用进行一些性能测试，似乎在构建 Release 配置时，与静态类 Debug 相关的所有代码都被完全删除。我想知道编译器是如何知道的。也许有一些类或配置属性允许准确指定该行为。

我正在尝试创建一些我想从 Release 配置中完全删除的调试代码，我想知道我是否可以像 Debug 类那样简单地更改配置参数来删除代码。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-12-03T15:08:34.617

您可以将带有字符串“DEBUG”的[ConditionalAttribute](https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.conditionalattribute?view=netframework-4.8)属性应用于任何方法，并且对该项目的调用只会出现在 DEBUG 构建中。

这与使用 #ifdef 方法不同，因为这允许您发布方法以供其他人在其 DEBUG 配置中使用（如 .NET 框架中的 Debug 类方法）。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-12-03T15:15:52.810

Visual Studio 为 Debug 配置定义了一个 DEBUG 常量，您可以使用它来包装您不想在 Release 构建中执行的代码：

```
#ifdef DEBUG
  // Your code
#endif 
```

但是，您也可以使用 Conditional 属性装饰方法，这意味着永远不会为非调试构建调用该方法（该方法和任何调用站点都将从程序集中删除）：

```
[Conditional("DEBUG")]
private void MyDebugMethod()
{
  // Your code
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-03T15:09:08.953

看看[预处理器指令](http://www.csharphelp.com/archives/archive36.html)......

```
#if DEBUG
    //code
#endif 
```

# c - 如何在 C 中声明一组常量函数指针？

> ID：337449
> 
> 赞同：25
> 
> 时间：2008-12-03T15:11:25.703
> 
> 标签：c, arrays, pointers, constants, function-pointers

我需要声明一个指向函数的指针数组，如下所示：

```
extern void function1(void);
extern void function2(void);
...

void (*MESSAGE_HANDLERS[])(void) = {
   function1,
   function2,
   ...
}; 
```

但是，我希望将数组声明为常量——数组中的数据和指向数据的指针。不幸的是，我不记得在哪里放置 const 关键字。

我假设实际的指针 MESSAGE_HANDLERS 在这种情况下已经是常量，因为它被声明为一个数组。另一方面，如果数组中的函数指针按所示声明，它不能在运行时更改吗？

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2008-12-03T16:26:53.273

有一种技术可以记住如何构建这种类型。首先尝试从名称开始读取指针，并从右向左读取。

## 如何在没有帮助的情况下声明这些东西？

### 数组

```
T t[5]; 
```

是一个*5 T 的数组*。要使 T 成为函数类型，请将返回类型写在左边，将参数写在右边：

```
void t[5](void); 
```

**将**是一个*包含 5 个函数的数组，返回 void 并且不带任何参数*。但是函数本身不能塞进数组中！它们不是对象。只有指向它们的指针可以。

关于什么

```
void * t[5](void); 
```

这仍然是错误的，因为它只会将返回类型更改为指向 void 的指针。您必须使用括号：

```
void (*t[5])(void); 
```

这实际上会起作用。*t 是一个包含 5 个指针的数组，指向返回 void 且不带参数的函数*。

伟大的！指向 arras 的指针数组呢？这非常相似。元素类型显示在左侧，尺寸显示在右侧。同样，需要括号，否则数组将成为整数指针的多维数组：

```
int (*t[5])[3]; 
```

就是这样！一个*由 5 个指针组成的数组，指向 3 个 int 的数组*。

### 函数呢？

我们刚刚学到的关于函数也是正确的。让我们声明一个带有 int 的函数，该函数返回指向另一个不带参数并返回 void 的函数的指针：

```
void (*f(int))(void); 
```

出于与上述相同的原因，我们再次需要括号。我们现在可以调用它，并再次调用返回的函数指向。

```
f(10)(); 
```

### 返回一个指向函数的指针 返回另一个指向函数的指针

那这个呢？

```
f(10)(true)(3.4); 
```

? 换句话说，一个*采用 int 的函数返回一个指向采用 bool 的函数的指针，返回一个指向采用 double 并返回 void 的函数的指针*会是什么样子？答案是你只是嵌套它们：

```
void (*(*f(int))(bool))(double); 
```

你可以做无数次。实际上，您也可以返回指向数组的指针，就像返回指向函数的指针一样：

```
int (*(*f(int))(bool))[3]; 
```

这是一个*函数，它返回一个指向函数的指针，返回一个指向 3 int 数组的指针*

## 它与 const 有什么关系？

既然上面解释了如何从基本类型构建更复杂的类型，你可以把它们放在`const`你现在知道它们所属的地方。只需考虑：

```
T c * c * c ... * c name; 
```

The`T`是我们最后指向的基本类型。`c`代表 const 或非 const 。例如

```
int const * const * name; 
```

将声明 name 具有指向常量指针的类型*指针，该指针指向常量 int*。你可以改变`name`，但你不能改变`*name`，这将是类型

```
int const * const 
```

也不是`**name`，这将是类型

```
int const 
```

让我们将其应用于上面的函数指针：

```
void (* const t[5])(void); 
```

这实际上会声明数组包含常量指针。所以在创建（和初始化）数组之后，*指针*是 const 的，因为`const`出现在星号之后。`const`请注意，在这种情况下，我们不能在星号之前放置 a ，因为**没有指向常量函数的指针**。函数根本不能是 const ，因为那没有意义。因此以下内容无效：

```
void (const * t[5])(void); 
```

## 结论

C++ 和 C 声明函数和数组的方式实际上有点令人困惑。您必须首先了解它，但如果您理解它，您可以使用它编写非常紧凑的函数声明。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-12-03T15:23:01.017

在这种情况下，请执行 a`typedef`来命名您的函数签名，这样会更简单：

```
typedef void MESSAGE_HANDLER(void); 
```

有了这个，它应该是：

```
MESSAGE_HANDLER * const handlers[] = { function1, function2 }; 
```

获取数组常量的实际内容。

*编辑*：从 中删除了指针部分`typedef`，这确实更好（生活和学习）。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-12-03T15:25:11.293

`cdecl`说：

```
cdecl> explain void (* const foo[])(void)
declare foo as array of const pointer to function (void) returning void 
```

这是你需要的吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-03T15:24:53.087

使用 VisualStudio 2008，我得到：

```
void (* const MESSAGE_HANDLERS[])(void) = {
   NULL,
   NULL
};

int main ()
{
    /* Gives error 
        '=' : left operand must be l-value
    */
    MESSAGE_HANDLERS = NULL;

    /* Gives error 
        l-value specifies const object
    */
    MESSAGE_HANDLERS[0] = NULL;
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-03T15:38:25.680

我不确定这是否适用于“C”。它在'C++'中工作：

*   首先将 MESSAGE_HANDLERS 定义为一个类型：

    `typedef void (*MESSAGE_HANDLER)();`

*   然后，使用类型定义将数组声明为常量：

    `MESSAGE_HANDLER const handlers[] = {function1, function2};`

诀窍在于`typedef`，如果您可以在“C”中在语义上执行相同的操作，它也应该可以工作。

# c# - 如何在 .NET 1.1 中创建和启动参数化线程？

> ID：337452
> 
> 赞同：1
> 
> 时间：2008-12-03T15:12:14.220
> 
> 标签：c#, multithreading, .net-1.1, nt4

.NET 1.1 缺少`ParameterizedThreadStart`（我必须使用 1.1，因为它是支持 NT 4.0 的最后一个）

在 .NET 2.0 中，我会简单地写：

```
Thread clientThread = new Thread(new ParameterizedThreadStart(SomeThreadProc));
clientThread.Start(someThreadParams); 
```

如何创建等效的 .NET 1.1 代码？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-03T15:38:17.117

您需要为状态创建一个类：

```
class Foo {
  private int bar;
  public Foo(int bar) { // and any other args
      this.bar = bar;
  }    
  public void DoStuff() {
     // ...something involving "bar"
  } 
}
...
Foo foo = new Foo(12);
Thread thread = new Thread(new ThreadStart(foo.DoStuff));
thread.Start(); 
```

# .net - 没有版本标识符的 COM 注册

> ID：337453
> 
> 赞同：1
> 
> 时间：2008-12-03T15:13:11.940
> 
> 标签：.net, com

是否可以注册独立于程序集版本的 COM 接口？

现在我得到一个注册表项

```
MyIfaceName, Version=1.0.3259.17799, Culture=neutral, PublicKeyToken=1234567890abcdef 
```

但是由于程序集具有自动版本控制 ( `1.0.*.*`)，所以每天我都会进行新的构建，COM-iface 需要重新注册。

我如何在不指定版本的情况下注册？这有什么后果？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-03T17:55:36.450

如果您使用[regasm.exe](http://msdn.microsoft.com/en-us/library/tzat5yw6(VS.71).aspx)生成 COM 包装器，您可以使用 /codebase 参数，该参数在注册表中创建一个 Codebase 条目。

> Codebase 条目指定未安装在全局程序集缓存中的程序集的文件路径。

如果界面没有改变，您可以轻松地更新程序集而无需重新注册它。

# sql - 如果我有一个表中始终为空的 mssql varchar[1024]，那么将浪费多少实际字节？

> ID：337454
> 
> 赞同：3
> 
> 时间：2008-12-03T15:13:16.510
> 
> 标签：sql, sql-server

如果我有一个在表中始终为空的 mssql varchar[1024]，那么每行磁盘上的 db 文件中将浪费多少实际字节？

请告诉我两者的尺寸：

1.  NULL 允许存储 ''
    *   NULL 不允许存储 ''
    *   NULL 允许存储 NULL

由于最大 varchar 大小 > 2^1 且 < 2^3 我假设长度为 2 个字节。但也许还有一些额外的开销，例如，如果有一个指向实际数据的引用。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-03T15:22:52.047

我相信 varchar 仅使用保存字符串所需的最小存储空间。MSDN 和在线书籍似乎证实了这一点。但是，存储的数据（包括其他字段）的总和不能超过一定的长度（我认为是8K）。我不认为你有这个问题，因为我认为它在创建时被标记。

更多细节在这里：[http ://doc.ddart.net/mssql/sql70/ca-co_3.htm](http://doc.ddart.net/mssql/sql70/ca-co_3.htm)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-03T22:35:31.877

在允许空值的每一行中，都有一个空位图对象控制特定列的值是否为空。此位图的字节大小将为 NumberOfNullableColumns/8，四舍五入到下一个完整字节 此外，varchar 长度的开销为 2 个字节。

考虑到这一点：

1.  存储空字符串的可空列 = 2 个字节（加上位图的 1 位）
2.  存储空字符串的不可为空的列 = 2 个字节
3.  可空列存储 null = 0 字节（位图加上 1 位）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T15:37:20.987

取决于“空”是否意味着 NULL 或 ''。无论如何，在不知道表的 DDL 的情况下无法准确确定（它们都是 NOT NULL 列吗？一些空列？空列是什么意思？）但是计算字段偏移量的长度是每行 2 个字节为下一列。除非您有几十亿行，否则无需担心。即使那样，它也不是很多。

# .net - 派生类中令人讨厌的重复

> ID：337459
> 
> 赞同：0
> 
> 时间：2008-12-03T15:15:10.830
> 
> 标签：.net, asp.net, oop

在我们从 派生的每种形式中`FormBaseControl`，我们都有以下代码。我确信有比这更好的方法来键入控制器对象，但目前我们将它包含在每个页面中。在下面的示例中，`base.Controller`是 类型`BaseController`，从中`ExportController`派生。我发现这个代码在每个派生中都有重复`FormBaseControl`，但我无法找到纠正它的方法。

```
 private ExportController MyController
    {
        get { return base.Controller as ExportController; }
    }

    protected void Page_Load(object sender, EventArgs e)
    {
        base.Controller = new ExportController(WebNavigator.Current); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T15:28:29.833

你不能使用泛型类来解决这个问题吗？

即代替：

```
 private ExportController MyController
 {
        get { return base.Controller as ExportController; }
 } 
```

在派生类中。

放：

```
 protected T MyController
 {
        get { return this as T; }
 } 
```

在基类中，并将基类变成泛型类`BaseController<T>`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T15:26:22.350

我认为这里存在设计问题。

您确定需要 MyController 是 ExportControler （或任何其他）而不是基类（或派生类）吗？中间类、接口或泛型可以避免这种情况吗？

请详细说明为什么您一直需要重新定义 MyControler。

# java - 限制 Java 控制台堆占用空间？

> ID：337463
> 
> 赞同：0
> 
> 时间：2008-12-03T15:16:40.827
> 
> 标签：java, memory

我有一个 Java 小程序（一个实际的 <APPLET>），它经常向 System.out 生成日志消息。如果在用户的浏览器中启用了 Java 控制台，它当然会保留对所有这些字符串的引用并防止它们被垃圾收集。问题是控制台保留的日志消息的数量：applet 堆增长得非常快。运行四天后，它会抛出 OutOfMemory 异常。据我从 jmap 和 jhat 可以看出，日志字符串代表了它的大部分足迹。

是否有 API 可以更严格地限制 Java 控制台保留的消息数量或总大小？如果出现错误，我只需要最近的几条消息。控制台确实会在某个时候开始淘汰最旧的消息，但只是在它变得非常庞大之后。

我意识到“不要启动控制台”或“只清除控制台”是可能的解决方案，但是您是否尝试过询问非技术用户是否启用了 Java 控制台？或者尝试引导他们查看和清除它？我真的希望他们启用控制台，这样如果有错误我可以看到消息。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T15:24:28.393

而不是`System.out.println`使用[java.util.logging](http://java.sun.com/j2se/1.4.2/docs/guide/util/logging/overview.html)。以后更改日志级别并减少日志消息的数量要容易得多。

还要检查[MemoryHandler](http://java.sun.com/j2se/1.4.2/docs/api/java/util/logging/MemoryHandler.html)，它使用缓冲区并自动丢弃旧的日志消息。

# wpf - WPF：更新列表框项目中的标签

> ID：337476
> 
> 赞同：0
> 
> 时间：2008-12-03T15:22:52.390
> 
> 标签：wpf, label, controltemplate, listboxitem

我有一个`ListBox`根据用户设置的整数属性添加项目数的地方。这些项目是从`ControlTemplate`由标签和`TextBox`内部组成的资源创建的`DockPanel`。标签不是数据绑定的，但我希望它具有基于`ListboxItem`它所包含的 (index + 1) 的某种动态内容。我的问题/问题是我希望能够更新每个标签的内容`ListboxItem`，但由于某种原因无法访问标签。我不知道有任何方法可以通过标签的数据绑定来做到这一点，因为标签在模板中并且不知道它的父级是`ListboxItem`. 任何人都可以帮助我消除其中的一些困惑，让我回到正确的轨道上吗？

```
<ControlTemplate TargetType="{x:Type ListBoxItem}">
    <DockPanel Background="Transparent" Height="28" Name="playerDockPanel" VerticalAlignment="Bottom">
        <Label Name="playerNameLabel" DockPanel.Dock="Left" Content="Player"></Label>
        <TextBox Height="23" Width ="150" Name="playerName" DockPanel.Dock="Right"/>
    </DockPanel>
</ControlTemplate> 
```

我希望能够绑定`Label`xaml中的内容，或者更新`Label`后面代码中的内容。我不确定最好的路线是什么。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-04T00:13:53.597

您必须创建一个`IMultiValueConverter`将获取您的模板的索引：

```
public class PositionConverter : IMultiValueConverter
{
    public object Convert(object[] value, Type targetType, object parameter, CultureInfo culture)
    {
        ItemsControl itemsControl = value[0] as ItemsControl;
        UIElement templateRoot = value[1] as UIElement;
        if (templateRoot != null)
        {
            UIElement container = ItemsControl.ContainerFromElement(itemsControl, templateRoot) as UIElement;
            if (container != null)
            {
                return itemsControl.ItemContainerGenerator.IndexFromContainer(container);
            }
        }

        return null;
    }

    public object[] ConvertBack(object value, Type[] targetType, object parameter, CultureInfo culture)
    {
        throw new NotImplementedException();
    }
} 
```

然后，您应该将转换器用于您的`DataTemplate`：

```
<DataTemplate x:Key="itemTemplate">
    <DockPanel Background="Transparent" Height="28" Name="playerDockPanel" VerticalAlignment="Bottom">
        <Label Name="playerNameLabel" DockPanel.Dock="Left" Content="{Binding Title}"></Label>
        <Label Height="23" Width ="150" Name="playerName" DockPanel.Dock="Right">
            <Label.Content>
                <MultiBinding Converter="{StaticResource positionConverter}">
                    <!-- The ItemsControl-->
                    <Binding ElementName="listBox" />
                    <!-- The root UIElement-->
                    <Binding ElementName="playerDockPanel"/>
                </MultiBinding>
            </Label.Content>                    
        </Label>
    </DockPanel>
</DataTemplate> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T17:17:59.207

更新：最初我试图`Label`在模板中找到这样的....

```
 Label label = (Label)lbi.Template.FindName("playerNameLabel",lbi); 
```

我发现您必须先调用`ApplyTemplate()`才能构建模板的可视化树，然后才能找到该元素。

# javascript - 使用 JavaScript 提供下载

> ID：337478
> 
> 赞同：0
> 
> 时间：2008-12-03T15:23:35.007
> 
> 标签：javascript, download, kml

我在 JavaScript 中创建了一个文件。现在我希望能够将其作为下载提供给用户，这可能吗？

确切地说，它是我创建的一个 KML 文件，因此它是基本的 XML。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T15:29:05.823

不。不是简单地使用 JavaScript。

决定浏览器自动提示您保存文件而不是尝试显示文件的是它的 MIME 类型。并且只有服务器可以设置 MIME 时间，因为它是响应标头的一部分。

当然，如果你在服务器上使用 JS（使用 Jaxer 或其他引擎），那就另当别论了……

# python - 如何在 python 中逐行获取 MySQL ResultSet

> ID：337479
> 
> 赞同：49
> 
> 时间：2008-12-03T15:23:49.343
> 
> 标签：python, mysql

默认情况下，MySQL ResultSets 在完成任何工作之前从服务器完全检索。在结果集很大的情况下，这将变得不可用。相反，我想实际从服务器中逐一检索行。

在 Java 中，按照[此处](http://dev.mysql.com/doc/refman/5.1/en/connector-j-reference-implementation-notes.html)的说明（在“ResultSet”下），我创建了如下语句：

```
stmt = conn.createStatement(java.sql.ResultSet.TYPE_FORWARD_ONLY,
              java.sql.ResultSet.CONCUR_READ_ONLY);
stmt.setFetchSize(Integer.MIN_VALUE); 
```

这在 Java 中运行良好。我的问题是：有没有办法在 python 中做同样的事情？

我尝试的一件事是将查询一次限制为 1000 行，如下所示：

```
start_row = 0
while True:
    cursor = conn.cursor()
    cursor.execute("SELECT item FROM items LIMIT %d,1000" % start_row)
    rows = cursor.fetchall()
    if not rows:
        break
    start_row += 1000
    # Do something with rows... 
```

但是，start_row 越高，这似乎越慢。

不，使用`fetchone()`代替`fetchall()`不会改变任何东西。

## 澄清：

我用来重现此问题的简单代码如下所示：

```
import MySQLdb

conn = MySQLdb.connect(user="user", passwd="password", db="mydb")
cur = conn.cursor()
print "Executing query"
cur.execute("SELECT * FROM bigtable");

print "Starting loop"
row = cur.fetchone()
while row is not None:
    print ", ".join([str(c) for c in row])
    row = cur.fetchone()

cur.close()
conn.close() 
```

在约 700,000 行的表上，此代码运行得很快。但是在 ~9,000,000 行表上，它会打印“执行查询”，然后挂起很长一段时间。这就是为什么我使用`fetchone()`or没有区别的原因`fetchall()`。

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2008-12-03T16:17:12.233

我认为你必须连接传递`cursorclass = MySQLdb.cursors.SSCursor`：

```
 MySQLdb.connect(user="user", 
                 passwd="password",
                 db="mydb",
                 cursorclass = MySQLdb.cursors.SSCursor
                ) 
```

默认游标一次获取所有数据，即使您不使用`fetchall`.

编辑：`SSCursor`或任何其他支持服务器端结果集的游标类 - 检查模块文档`MySQLdb.cursors`。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-12-03T17:09:52.517

限制/偏移解决方案以二次时间运行，因为 mysql 必须重新扫描行以找到偏移量。正如您所怀疑的，默认游标将整个结果集存储在客户端上，这可能会消耗大量内存。

相反，您可以使用服务器端游标，它使查询保持运行并根据需要获取结果。游标类可以通过为连接调用本身提供默认值来定制，或者每次都为游标方法提供一个类。

```
from MySQLdb import cursors
cursor = conn.cursor(cursors.SSCursor) 
```

但这还不是全部。除了存储 mysql 结果之外，默认的客户端游标实际上会获取每一行。这种行为是无证的，非常不幸。这意味着为所有行创建完整的 python 对象，这比原始 mysql 结果消耗更多的内存。

在大多数情况下，以迭代器形式存储在客户端上的结果将在合理的内存使用情况下产生最佳速度。但如果你愿意，你必须自己动手。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-03T15:40:16.893

你试过这个版本的 fetchone 吗？还是有什么不同？

```
row = cursor.fetchone() 
while row is not None:
    # process
    row = cursor.fetchone() 
```

另外，你试过这个吗？

```
 row = cursor.fetchmany(size=1)
 while row is not None:
     # process
     row = cursor.fetchmany( size=1 ) 
```

并非所有驱动程序都支持这些，因此您可能遇到错误或发现它们太慢。

* * *

编辑。

当它挂起执行时，您正在等待数据库。这不是逐行 Python 的事情。那是MySQL的事情。

MySQL 更喜欢获取所有行作为它自己的缓存管理的一部分。这可以通过提供 Integer.MIN_VALUE (-2147483648L) 的 fetch_size 来关闭。

问题是，Python DBAPI 的哪一部分相当于 JDBC fetch_size？

我认为它可能是光标的arraysize 属性。尝试

```
cursor.arraysize=-2**31 
```

看看这是否会迫使 MySQL 流式传输结果集而不是缓存它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-09-10T06:49:18.900

尝试使用**MySQLdb.cursors.SSDictCursor**

```
con = MySQLdb.connect(host=host,
                  user=user,
                  passwd=pwd,
                  charset=charset,
                  port=port,
                  cursorclass=MySQLdb.cursors.SSDictCursor);
cur = con.cursor()
cur.execute("select f1, f2 from table")
for row in cur:
    print row['f1'], row['f2'] 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-10-25T03:16:23.817

我发现最好的结果混合了其他一些答案。

这包括设置`cursorclass=MySQLdb.cursors.SSDictCursor`（对于 MySQLdb）或`pymysql.cursors.SSDictCursor`（对于 PyMySQL）作为连接设置的一部分。这将让服务器保存查询/结果（“SS”代表服务器端，而不是带来结果客户端的默认游标）并从每一行构建一个字典（例如 {'id': 1, '名称'：'饼干怪物'}）。

然后循环遍历行，在 Python 2.7 和 3.4 中都有一个无限循环，`while rows is not None`因为即使`cur.fetchmany(size=10000)`被调用并且没有剩余结果，该方法返回一个空列表 ( `[]`) 而不是 None。

实际示例：

```
query = """SELECT * FROM my_table"""
conn = pymysql.connect(host=MYSQL_CREDENTIALS['host'], user=MYSQL_CREDENTIALS['user'],
                          passwd=MYSQL_CREDENTIALS['passwd'], charset='utf8', cursorclass = pymysql.cursors.SSDictCursor)
cur = conn.cursor()
results = cur.execute(query)
rows = cur.fetchmany(size=100)
while rows:
    for row in rows: 
        process(row)
    rows = cur.fetchmany(size=100)
cur.close()
conn.close() 
```

# jsp - servlet/jsp 中的打印对话框

> ID：337482
> 
> 赞同：0
> 
> 时间：2008-12-03T15:24:20.483
> 
> 标签：jsp, servlets, printdialog

我想在 servlet/jsp 中显示打印对话框。下面是我的代码：

```
DocFlavor flavor = DocFlavor.BYTE_ARRAY.AUTOSENSE;
PrintRequestAttributeSet pras = new HashPrintRequestAttributeSet () ;
PrintService printService[] = PrintServiceLookup.lookupPrintServices(flavor, pras);
PrintService defaultService = PrintServiceLookup.lookupDefaultPrintService();
PrintService service = javax.print.ServiceUI.printDialog(null, 200, 200, printService, defaultService, flavor, pras);

if (service != null)
{
  DocPrintJob job = service.createPrintJob();
  Doc doc = new SimpleDoc(decodedImageData, flavor, null);
  job.print(doc, null);
} 
```

它在独立应用程序中运行良好。但是，我无法在 servlet/jsp 中显示打印对话框。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T15:30:19.487

您需要注意，不是客户端在此处执行您的代码。是服务器。

您必须制作一个 javascript 函数才能使其正常工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-04T19:28:59.037

我会`window.print();`用javascript调用。在下面试试。

```
<html>
<body>

<a href="javascript:print()">Print</a>
</body>

</html> 
```

# database - 跟踪从外部程序到 biztalk 和返回的消息

> ID：337487
> 
> 赞同：2
> 
> 时间：2008-12-03T15:24:59.497
> 
> 标签：database, biztalk

我有一个外部程序，它将从数据库中生成一个 xml 文档并将其传递给 BizTalk。是否可以创建事务 id 或其他东西（数据库中的消息 id），以便我可以跟踪 BizTalk 中的消息，并将 BizTalk 自定义管道中的信息存储到具有给定事务 id 的数据库中？

我想存储它是否失败，并且我有自定义管道可以捕获此信息以进行存储。我不想依赖 HAT 进行错误处理。

在 BizTalk 中跟踪从需要存储有关 BizTalk 处理信息的外部程序发送的消息的最佳方式是什么？任何链接/书籍提示也会有所帮助。谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-05T11:06:17.663

从架构的角度来看，通常情况下，有几种方法可以实现您想要的，并且解决方案的外观将根据您的具体场景而有很大差异。

在 BizTalk 中，跟踪由特定消息启动的流的最佳方式是交换 id。

交换 ID 是一种上下文属性，它随着传入消息的处理进行而流动，并在整个过程中从一条消息复制到另一条消息。从技术上讲，是接收到的消息的消息 id 开始了交换。

如果您需要一个 ID 将“所有内容”组合在一起，就是这样。

如果在您的场景中您可以选择将其返回给您的调用者，它将能够将它链接到您需要的任何东西（进出数据库）。

如果您不能，但调用者可以将它分配给此请求的 ID 传递给您，您可以使用交换 ID 更新数据库记录以链接两者。

随着流程的进展（成功与否），您始终可以返回并更新该记录，因为您始终可以访问 BizTalk 中的交换 ID。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-25T20:16:31.360

真正考虑自己想要什么可能是一件好事。可能您希望发送客户/内部系统以某种方式跟踪他们的消息，但是状态是否必须由应用程序读取，还是某些用户需要消息的状态？

一种方法是，如上所述，给他们一个相关的交换 id（在响应消息中），但是然后呢？设置一个应用程序可以查询状态且易于维护的服务（关于流程更改）是非常困难的。我已经构建了一个，您可以获得有关消息传递的所有实例的信息，但这不会让您的客户“更聪明”，因为他们可能无法将您的编排或管道名称翻译成可以理解的东西。

另一种方法是使用 BAM 并创建一个网站，客户可以使用它来查找他们的消息状态，就像大多数快递公司一样，例如 DHL。它可能需要更多的努力，但我认为最好根据需要定制解决方案。

使用 BAM，您可以在完全不更改 BizTalk 项目的情况下提取数据。“只需”分析您的需求，找出要在 BAM-Excel 中提取或聚合的数据，将其导出到 BizTalk 数据库，激活并将其与跟踪配置文件编辑器连接。

然后，您可以在网站上向客户展示重要的里程碑。我知道这并不像我上面描述的那么容易，但它会很好:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T19:14:11.157

如果您向 BizTalk 发布消息，默认情况下它会返回给您 SubmissionHandle。这是您可以从接收端口获得的 Context 属性。然后可以在编排中捕获它，并用于将错误关联回原始提交。

或者，您可以使用两种方式接收 HTTP 端口并将您想要的任何内容发送回调用应用程序。您可以立即返回一条消息，也可以根据处理过程中发生的情况等待返回成功或失败。

祝你好运

# postgresql - 寻找一个 Postgresql 社区

> ID：337499
> 
> 赞同：0
> 
> 时间：2008-12-03T15:29:31.237
> 
> 标签：postgresql

我需要了解 Postgresql。我正在尝试分支一个依赖于 Oracle 以使用 Postgresql 的应用程序框架。我可以通过网络轻松找到 Java 和 JavaScript 程序员社区。Oracle 社区有点困难，但在 OTN 和 AskTom 之间，我做得很好。但是 Postgresql 似乎少之又少。您在哪里使用 Postgresql？教程也很有用，但我希望有一个列表或 SO 风格的网站。

虽然 SO 是一个很棒的社区，但它说明这个问题的标签组合使用只有 155 个。不完全是一个大组。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-03T15:32:50.077

你试过[Postgres 新闻组](http://groups.google.com/group/comp.databases.postgresql.general/topics)吗？Postgres 官方网站上还有[一个社区页面](http://www.postgresql.org/community/)，其中包含指向 IRC、论坛、邮件列表等的链接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T18:51:51.983

Freenode 上的#postgresql 非常有用，还有特定于语言的频道 - 检查 Don 提到的社区页面。

# sql - 表中主键的最佳做法是什么？

> ID：337503
> 
> 赞同：278
> 
> 时间：2008-12-03T15:30:23.450
> 
> 标签：sql, sql-server, database, relational

在设计表格时，我养成了一个习惯，即拥有一个唯一的列并且我将其作为主键。这可以根据要求通过三种方式实现：

1.  自动递增的标识整数列。
2.  唯一标识符 (GUID)
3.  可用作行标识符列的短字符 (x) 或整数（或其他相对较小的数字类型）列

数字 3 将用于相当小的查找，主要是读取可能具有唯一静态长度字符串代码或数值（例如年份或其他数字）的表。

在大多数情况下，所有其他表都将具有自动递增的整数或唯一标识符主键。

# 问题:-)

我最近开始使用没有一致行标识符的数据库，并且主键当前聚集在各个列中。一些例子：

*   日期时间/字符
*   日期时间/整数
*   日期时间/varchar
*   字符/nvarchar/nvarchar

这有一个有效的案例吗？我总是会为这些情况定义一个身份或唯一标识符列。

此外，还有很多表根本没有主键。有什么正当理由（如果有的话）？

我试图理解为什么桌子被设计成原来的样子，这对我来说似乎是一团糟，但也许有很好的理由。

第三个问题可以帮助我破译答案：在使用多列组成复合主键的情况下，这种方法与代理/人工键相比是否有特定优势？我主要考虑性能、维护、管理等方面的问题？

* * *

## 回答 #1

> 赞同：282
> 
> 时间：2008-12-03T19:25:46.970

我遵循一些规则：

1.  主键应尽可能小。首选数字类型，因为数字类型以比字符格式更紧凑的格式存储。这是因为大多数主键将是另一个表中的外键以及用于多个索引。您的键越小，索引越小，您将使用的缓存中的页面就越少。
2.  主键不应该改变。更新主键应该永远是不可能的。这是因为它最有可能在多个索引中使用并用作外键。更新单个主键可能会导致更改的连锁反应。
3.  不要使用“你的问题主键”作为你的逻辑模型主键。例如护照号码、社会安全号码或员工合同号码，因为这些“自然密钥”在现实世界中可能会发生变化。确保在必要时为这些添加 UNIQUE 约束以强制保持一致性。

关于代理与自然键，我参考了上面的规则。如果自然键很小并且永远不会更改，则可以将其用作主键。如果自然键很大或可能会更改，我会使用代理键。如果没有主键，我仍然会创建代理键，因为经验表明您将始终将表添加到您的架构中，并希望您将主键放在适当的位置。

* * *

## 回答 #2

> 赞同：98
> 
> 时间：2008-12-03T16:19:27.097

自然与人工钥匙是数据库社区之间的一种宗教辩论 - 请参阅[本文](https://web.archive.org/web/20171109021306/http://r937.com:80/natural-or-surrogate-key.html)及其链接到的其他文章。我既不赞成**总是**拥有人造钥匙，也不赞成**永远**拥有它们。我会根据具体情况做出决定，例如：

*   美国各州：我会选择 state_code（德克萨斯州等的'TX'），而不是德克萨斯州的 state_id=1
*   员工：我通常会创建一个人工的employee_id，因为很难找到其他有效的方法。SSN 或同等学历可能有效，但可能会出现诸如尚未提供其 SSN 的新加入者之类的问题。
*   员工工资历史：（employee_id，start_date）。我**不会**创建人工的employee_salary_history_id。它有什么用（除了[“愚蠢的一致性”](http://en.wikiquote.org/wiki/Consistency)）

无论在何处使用人工键，您都应该始终声明对自然键的唯一约束。例如，如果必须使用 state_id，但最好在 state_code 上声明一个唯一约束，否则您肯定最终会得到：

```
state_id    state_code   state_name
137         TX           Texas
...         ...          ...
249         TX           Texas 
```

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2011-07-12T20:55:41.877

我避免使用自然键的原因很简单——人为错误。尽管通常可以使用自然唯一标识符（SSN、VIN、帐号等），但它们需要人工正确输入。如果您使用 SSN 作为主键，有人在数据输入期间转置了几个数字，并且没有立即发现错误，那么您将面临更改主键的问题。

我的主键都是由后台的数据库程序处理的，用户从不知道它们。

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2008-12-05T10:38:47.063

只是对经常被忽视的事情的额外评论。有时不使用单个代理键作为主键对子表有好处。假设我们的设计允许您在一个数据库中运行多个公司（可能是托管解决方案，或其他）。

假设我们有这些表和列：

```
Company:
  CompanyId   (primary key)

CostCenter:
  CompanyId   (primary key, foreign key to Company)
  CostCentre  (primary key)

CostElement
  CompanyId   (primary key, foreign key to Company)
  CostElement (primary key)

Invoice:
  InvoiceId    (primary key)
  CompanyId    (primary key, in foreign key to CostCentre, in foreign key to CostElement)
  CostCentre   (in foreign key to CostCentre)
  CostElement  (in foreign key to CostElement) 
```

如果最后一位没有意义，`Invoice.CompanyId`则它是两个外键的一部分，一个到*CostCentre*表，一个到*CostElement*表。主键是（*InvoiceId*，*CompanyId*）。

在此模型中，不可能搞砸并引用一家公司的*CostElement和另一家公司的**CostCentre*。*如果在CostElement*和*CostCentre 表*中使用单个代理键作为主键，并且在*Invoice 表*中没有外键关系，则可以。

搞砸的机会越少越好。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2008-12-03T16:04:11.947

从各个领域制作主键没有问题，那就是*Natural Key*。

您可以使用 Identity 列（与候选字段上的唯一索引相关联）来制作*Surrogate Key*。

这是一个古老的讨论。在大多数情况下，我更喜欢代理键。

但是没有钥匙是没有借口的。

**回复：编辑**

是的，这有很多争议：D

除了它们是自然选择之外，我没有看到自然键有任何明显优势。您总是会想到*Name、SocialNumber*或类似的东西，而不是*idPerson*。

代理键是自然键所具有的一些问题的答案（例如传播更改）。

当你习惯了代理人时，它似乎更干净，更易于管理。

但最后，你会发现这只是品味问题——或心态——。人们使用自然键“思考得更好”，而其他人则没有。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2008-12-03T15:33:49.340

表应该始终有一个主键。如果不是，它应该是一个 AutoIncrement 字段。

有时人们会忽略主键，因为他们传输了大量数据，并且可能会减慢（取决于数据库）该过程。但是，它应该在它之后添加。

*关于链接表的一些评论*，这是正确的，这是一个例外，但字段应该是 FK 以保持完整性，并且在某些情况下，如果链接中的重复未经授权，这些字段也可以是主键......但要保持简单的形式，因为异常在编程中经常出现，所以应该存在主键以保持数据的完整性。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2013-06-03T01:46:43.987

除了所有这些好的答案，我只想分享我刚刚读到*[的一篇好文章，伟大的主键辩论](http://www.techrepublic.com/article/the-great-primary-key-debate/1045050)*。

仅引用几点：

开发人员在为每个表选择主键时必须应用一些规则：

*   主键必须唯一标识每条记录。
*   记录的主键值不能为空。
*   创建记录时，主键值必须存在。
*   主键必须保持稳定——您不能更改主键字段。
*   主键必须紧凑并且包含尽可能少的属性。
*   主键值不能更改。

自然键（倾向于）打破规则。代理键符合规则。（你最好通读那篇文章，值得你花时间！）

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2018-03-05T19:19:39.743

这是我在 25 年以上的开发经验后确定的经验法则。

*   所有表都应该有一个自动递增的单列主键。
*   将其包含在任何可更新的视图中
*   主键在您的应用程序上下文中不应该有任何意义。这意味着它不应是 SKU、帐号或员工 ID 或任何其他对您的应用程序有意义的信息。它只是与实体关联的唯一键。

主键由数据库用于优化目的，您的应用程序不应将其用于识别特定实体或与特定实体相关的任何其他用途。

始终具有单值主键使得执行 UPSERT 非常简单。

*   在多列索引上支持单列上的多个索引。
    例如，如果您有一个两列键，则倾向于在每列上创建一个索引而不是创建一个两列索引。如果我们在 firstname + lastname 上创建一个多列键，我们不能在不提供 firstname 的情况下对 lastname 进行索引查找。在两列上都有索引允许优化器在任一列或两列上执行索引查找，而不管它们在 WHERE 子句中的表达方式。

*   如果您的表很大，请探索根据最突出的搜索条件将表划分为段。

*   如果您的表中包含大量 Id 字段，请考虑将除主键之外的所有内容删除到具有 id (PK)、org_id（原始表的 FK）和 id_type 列的单个表中。为新表上的所有列创建索引并将其与原始表相关联。通过这种方式，您现在可以仅使用单个索引执行任意数量的 id 的索引查找。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2013-01-03T18:57:14.270

## 主键有什么特别之处？

架构中的表的目的是什么？表的键的用途是什么？主键有什么特别之处？围绕主键的讨论似乎忽略了主键是表的一部分，而表是模式的一部分。什么最适合表和表关系应该驱动所使用的键。

表格（和表格关系）包含有关您希望记录的信息的事实。这些事实应该是独立的、有意义的、易于理解的和不矛盾的。从设计的角度来看，从模式中添加或删除的其他表不应影响相关表。必须有存储仅与信息本身相关的数据的目的。了解表中存储的内容不应该需要进行科学研究项目。为同一目的存储的任何事实都不应存储超过一次。键是被记录的信息的全部或一部分，是唯一的，主键是专门指定的键，作为表的主要访问点（即应该选择它是为了数据的一致性和使用，而不仅仅是插入表现）。

*   旁白：不幸的是，大多数由应用程序程序员（有时我也是）设计和开发的数据库的副作用是，最适合应用程序或应用程序框架的往往会驱动表的主键选择。这导致了整数和 GUID 键（因为它们很容易用于应用程序框架）和单片表设计（因为它们减少了表示内存中数据所需的应用程序框架对象的数量）。这些应用程序驱动的数据库设计决策在大规模使用时会导致严重的数据一致性问题。以这种方式设计的应用程序框架自然会导致一次表设计。“部分记录”是在表格中创建的，并且随着时间的推移填写数据。避免多表交互，或在应用程序运行不正常时导致数据不一致。这些设计导致数据无意义（或难以理解）、数据分布在表中（您必须查看其他表才能理解当前表）以及重复数据。

据说主键应该尽可能小。我会说密钥应该只有必要的大小。应避免向表中随机添加无意义的字段。更糟糕的是，从随机添加的无意义字段中生成键，尤其是当它破坏从另一个表到非主键的连接依赖关系时。这仅在表中没有好的候选键时才合理，但如果用于所有表，这种情况肯定是模式设计不佳的标志。

也有人说，主键永远不应该改变，因为更新主键应该永远是不可能的。但更新与删除后插入相同。按照这个逻辑，你永远不应该用一个键从表中删除一条记录，然后用第二个键添加另一条记录。添加代理主键并不会消除表中存在其他键的事实。如果其他表通过代理键依赖于该含义，则更新表的非主键可能会破坏数据的含义（例如，状态描述从“已处理”更改为“已取消”的代理键的状态表' 肯定会破坏数据）。永远不可能破坏数据意义。

话虽如此，我感谢当今企业中存在的许多设计不佳的数据库（无意义的代理键数据损坏的 1NF 庞然大物），因为这意味着对于了解正确数据库设计的人来说，有无穷无尽的工作量. 但在可悲的一面，它有时确实让我觉得自己像西西弗斯，但我敢打赌他有一个 401k （在崩溃之前）。远离博客和网站来解决重要的数据库设计问题。如果您正在设计数据库，请查找 CJ Date。您也可以为 SQL Server 参考 Celko，但前提是您必须先捏住鼻子。在 Oracle 方面，请参考 Tom Kyte。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-12-03T15:34:08.123

自然键（如果可用）通常是最好的。因此，如果 datetime/char*唯一*标识该行并且这两个部分对该行有意义，那就太好了。

如果只是日期时间是有意义的，并且只是添加了字符以使其唯一，那么您不妨只使用一个标识字段。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-12-03T15:32:49.967

我怀疑原始数据结构的设计者需要 Steven A. Lowe 的卷起报纸疗法。

顺便说一句，作为主键的[GUID可能会占用性能。](http://en.wikipedia.org/wiki/Globally_unique_identifier)我不会推荐它。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2008-12-03T19:26:21.757

对我来说，自然键与人工键是您想要在数据库中包含多少业务逻辑的问题。[社会安全号码](http://en.wikipedia.org/wiki/Social_Security_number)(SSN) 就是一个很好的例子。

“我数据库中的每个客户都将并且必须拥有一个 SSN。” Bam，完成，将其设为主键并完成它。请记住，当您的业务规则发生变化时，您就会被烧毁。

由于我在不断变化的业务规则方面的经验，我自己不喜欢自然键。但是，如果您确定它不会改变，它可能会阻止一些关键连接。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-12-03T15:35:28.633

我也总是使用数字 ID 列。在 oracle 中，我无缘无故地使用 number(18,0) 高于 number(12,0) （或者任何是 int 而不是 long 的东西），也许我只是不想担心得到几十亿行分贝！

我还包括一个创建和修改的列（类型时间戳）用于基本跟踪，它似乎很有用。

我不介意对其他列组合设置唯一约束，但我真的很喜欢我的 id、created、modified 基线要求。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2008-12-03T19:33:51.663

我寻找自然主键并尽可能使用它们。

如果找不到自然键，我更喜欢 GUID 而不是 INT++，因为 SQL Server 使用树，并且总是在树的末尾添加键是不好的。

在多对多耦合的表上，我使用外键的复合主键。

因为我很幸运能够使用 SQL Server，所以我可以使用分析器和查询分析器研究执行计划和统计数据，并非常轻松地了解我的键是如何执行的。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-12-03T15:35:22.097

您应该使用包含多个字段的“复合”或“复合”主键。

这是一个完全可以接受的解决方案，请[点击此处](http://en.wikipedia.org/wiki/Compound_key)了解更多信息 :)

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2008-12-03T15:53:28.113

我总是使用自动编号或身份字段。

我为一个使用 SSN 作为主键的客户工作，然后由于 HIPAA 法规被迫更改为“MemberID”，并且在更新相关表中的外键时导致了大量问题。坚持一致的身份列标准帮助我避免了所有项目中的类似问题。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2008-12-03T19:49:18.543

[GUID](http://en.wikipedia.org/wiki/Globally_unique_identifier)可用作主键，但您需要创建正确类型的 GUID 以使其运行良好。

您需要生成 COMB GUID。一篇关于它和性能统计的好文章是 *[The Cost of GUIDs as Primary Keys](http://www.informit.com/articles/article.aspx?p=25862&seqNum=7)*。

在[SQL](http://en.wikipedia.org/wiki/SQL)中构建 COMB GUID 的一些代码也在*[Uniqueidentifier vs identity](http://dotnetslackers.com/Community/forums/uniqueidentifier-vs-identity/t/808.aspx?PageIndex=2) ( [archive](https://web.archive.org/web/20110426003724/http://dotnetslackers.com/Community/forums/uniqueidentifier-vs-identity/t/808.aspx?PageIndex=2) )*中。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-12-03T16:29:58.087

所有表**都应该**有一个主键。否则，您所拥有的是 HEAP - 在某些情况下，这可能是您想要的（例如，当数据通过服务代理复制到另一个数据库或表时，插入负载很重）。

对于行数较少的查找表，您可以使用 3 CHAR 代码作为主键，因为这比 INT 占用的空间更少，但性能差异可以忽略不计。除此之外，除非您有一个引用表，该表可能具有由关联表中的外键组成的复合主键，否则我将始终使用 INT。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-12-03T16:34:54.677

如果你真的想反复阅读这场古老辩论的所有内容，请在 Stack Overflow 上搜索“自然键”。您应该返回结果页面。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-12-03T15:41:19.420

我们做了很多连接，复合主键刚刚成为性能猪。即使您要引入第二个候选键，一个简单的 int 或 long 也可以解决许多问题，但是加入一个字段而不是三个字段要容易得多，也更容易理解。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-12-30T22:34:58.113

我将提前说明我对自然键的偏好 - 尽可能使用它们，因为它们会使您的数据库管理生活变得更加轻松。我在我们公司建立了一个标准，所有表格都有以下列：

*   行 ID (GUID)
*   Creator（字符串；具有当前用户名的默认值（`SUSER_SNAME()`在 T-SQL 中））
*   创建（日期时间）
*   时间戳

行 ID 在每个表上都有一个唯一的键，并且在任何情况下都是每行自动生成的（并且权限会阻止任何人对其进行编辑），并且可以合理地保证在所有表和数据库中都是唯一的。如果任何 ORM 系统需要单个 ID 密钥，则可以使用该密钥。

同时，如果可能的话，实际的 PK 是一个自然密钥。我的内部规则是这样的：

*   人员 - 使用代理键，例如 INT。如果它是内部的，则 Active Directory 用户 GUID 是可接受的选择
*   查找表（例如 StatusCodes） - 使用短 CHAR 代码；它比 INT 更容易记住，并且在许多情况下，纸质表格和用户也会为了简洁起见使用它（例如 Status = “E”代表“已过期”，“A”代表“已批准”，“NADIS”代表“未检测到石棉”在样品中”）
*   链接表 - FK 的组合（例如`EventId, AttendeeId`）

因此，理想情况下，您最终会得到一个自然、人类可读且令人难忘的 PK，以及一个对 ORM 友好的每个表一个 ID 的 GUID。

警告：我维护的数据库倾向于 100,000 条记录，而不是数百万或数十亿条记录，因此，如果您有大型系统的经验而无法接受我的建议，请随时忽略我！

# flash - 更改闪存文件

> ID：337505
> 
> 赞同：1
> 
> 时间：2008-12-03T15:30:44.103
> 
> 标签：flash

我正在尝试开发一种方法，通过单击按钮将屏幕上显示的 Flash 文件更改为另一个文件。我已经能够用 jpg 图像做到这一点，但我不能让它与 flash 文件一起工作。任何人都可以帮忙吗？我将不胜感激。下面是两个 html：第一个更改 jpg 图像并且它可以工作，第二个我构造为类似于对 flash 文件执行相同操作，但它不起作用。

//Html 1。这会在点击时将 Image 1 更改为 Image 2。有用

函数 changeSrc() { document.getElementById("myImage").src="Image 2.jpg"; }

//Html 2。这是为了在点击时将 Flash 1 更改为 Flash 2。这没用

函数 changeSrc() { document.getElementById("myImage").src="Flash 2.swf"; }

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T15:34:36.157

这里有一个更改 Flash 嵌入式 im js 的示例：

```
function setFlashSrc(newSrc)
    {
          var flash='<OBJECT CLASSID="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" CODEBASE="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,29,0" WIDTH="210" HEIGHT="210">';
          flash+='<PARAM NAME=movie VALUE="'+newSrc+'"><PARAM NAME=quality VALUE=high>';
          flash+='<EMBED SRC="'+newSrc+'" QUALITY=high PLUGINSPAGE="http://www.macromedia.com/shockwave/download/index.cgi?P1_Prod_Version=ShockwaveFlash" ';
          flash+='TYPE="application/x-shockwave-flash" WIDTH="210" HEIGHT="210">';
          flash+='</EMBED>';
          flash+='</OBJECT>';
          document.getElementById("urgeo").innerHTML=flash;
    } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T15:37:17.087

您需要使用 embed 或 object 标记的 name 属性来获取对嵌入式 Flash 文件的引用。使用 id 将不起作用。

但是有一种更简单的方法可以做到这一点。如果您使用[swfObject](http://code.google.com/p/swfobject/wiki/documentation)嵌入您的 swf，这可以像一个 javascript 调用一样简单。

```
<script type="text/javascript">

var flashvars = false;
var params = {
  menu: "false",
  flashvars: "name1=hello&name2=world&name3=foobar"
};
var attributes = {
  id: "myDynamicContent",
  name: "myDynamicContent"
};

swfobject.embedSWF("myContent.swf", "myContent", "300", "120", "9.0.0","expressInstall.swf", flashvars, params, attributes);

</script> 
```

# perl - 如何使用 Catalyst 上传文件？

> ID：337507
> 
> 赞同：7
> 
> 时间：2008-12-03T15:31:16.083
> 
> 标签：perl, file-upload, catalyst

我正在开发一个基于 Web 的内部应用程序，用于存储和分类照片。我应该如何检索这些文件并将其保存到服务器？

*注意：我想将文件保存到文件系统，而不是数据库。*
*类似于[如何处理 HTTP 文件上传？](https://stackoverflow.com/questions/162677/how-can-i-handle-http-file-uploads)*

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-03T16:43:58.293

从您熟悉的 HTML 表单上的上传 INPUT 开始，并确保 HTML 表单标签具有参数`enctype="multipart/form-data"`

[Catalyst::Request](http://p3rl.org/Catalyst::Request)对象 ( `$c->request`) 提供了两种访问和操作文件的方法。

每个文件上传字段都将被实例化为[Catalyst::Request::Upload](http://p3rl.org/Catalyst::Request::Upload)对象。

`$c->request->upload`将以标量或列表形式返回上传对象。 `$c->request->uploads`将返回对 Upload 对象哈希的引用。

Upload 对象提供了几种保存和复制文件的方法。

查看我上面链接的手册页。

# .net - 有哪些工具可用于确定自上次构建以来哪些 .NET 程序集发生了更改？

> ID：337514
> 
> 赞同：6
> 
> 时间：2008-12-03T15:32:46.317
> 
> 标签：.net, version-control, msbuild, build-process, assemblies

对于一个非常大的 .NET 站点/解决方案（100 个程序集），是否有任何工具可用于识别自上次构建以来哪些程序集发生了更改（使用比文件日期更智能的东西，文件日期总是会改变）。

我需要将我们的部署过程更改为 a) 增加已更改程序集的版本和 b) 生成增量版本以包含这些修改后的程序集。

我目前对我们的 ASP.NET 网站和 Biztalk 服务器的方法是在构建后重新部署完整的解决方案 - 这可能需要 3 个小时（大部分时间都用于取消部署和重新部署 BizTalk 应用程序）。

Microsoft 建议我们对程序集进行版本控制，并仅部署那些已更改的程序集以减少我们的部署窗口。我想尽可能地自动化这个。

我们目前正在使用 MSBuild、TFS 和优秀的“老式”人员来管理我们的构建过程。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-04T13:17:45.153

看看[NDepend](http://www.ndepend.com/)。我相信您可以使用它来生成此类事情的报告并将其用作部署过程的输入

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-04T12:52:55.140

Team Build 中最重要的可追溯性功能之一是它如何跟踪变更集，以及与从构建到构建的变更集相关联的工作项。

我们使用这些构建摘要来帮助我们生成版本之间的发行说明。当我们准备好部署经过验证的版本时，我们使用手动运行的构建定义，其中最后一次运行构建是我们部署之前经过验证的版本的日期。这会影响这两个构建日期之间的所有更改，并为我们提供生成发行说明的综合报告。

# paypal - 贝宝和经销商佣金

> ID：337518
> 
> 赞同：2
> 
> 时间：2008-12-03T15:33:27.780
> 
> 标签：paypal

我有一个客户对客户 (C2C) 服务的网站。例如，用户正在寻找 Gordie Howe 的曲棍球卡，而另一位客户想要出售 Gordie Howe 曲棍球卡。如果他们以 100 美元的价格出售该卡，我希望有 90 美元给卖家，10 美元给我用于提供服务（某种经销商佣金）。

有没有办法通过贝宝一次性付款来做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T17:24:48.727

让 100 美元给你，然后你每月给客户开一张支票，以获得他们的收益。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T15:35:45.890

不，我不相信。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T17:22:38.357

您可能想要寻找类似 google checkout 或其他为商家而非消费者量身定制的支付系统。

# wordpress - 将 joomla url 重定向到 wordpress

> ID：337519
> 
> 赞同：3
> 
> 时间：2008-12-03T15:33:29.357
> 
> 标签：wordpress, .htaccess, mod-rewrite, joomla

我将一个基于 joomla 的前网站移到了 wordpress。导入工作正常，但问题是旧链接不再起作用。因为只有 50 篇左右的文章，我认为为每个帖子（在 .htaccess 中）设置一个规则是个好主意。

嗯......事情并不总是像你想要的那样，所以重定向根本不起作用:(

旧的 joomla 链接如下所示：

```
http://site.com/index.php?option=com_content&task=view&id=49&Itemid=29
http://site.com/index.php?option=com_content&task=view&id=42&Itemid=29
http://site.com/index.php?option=com_content&task=view&id=68&Itemid=29 
```

并且需要翻译成：

```
http://site.com/?p=23
http://site.com/?p=24
http://site.com/?p=25 
```

*   新旧链接之间基本上没有关系，所以我认为正则表达式不会有帮助

*   新旧站点都在同一个域上

好的，问题是我尝试过的任何规则（我尝试了很多！），都没有奏效。在少数情况下，我会收到 500 错误，但大多数时候重定向不起作用。

那么，你们中的任何人都有同样的问题吗？我不需要很好的永久链接，但如果可以的话，那会更好。问题是我有很多指向旧网址的反向链接，我不想丢失它们。

非常感谢你们！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T17:55:12.707

由于您的网站到 Wordpress 的转换相对较新，有什么阻止您使用旧的 Joomla！ID 在您的 WP 数据库表中？这将允许您相当轻松地使用正则表达式。

另一种选择是创建一个单独的 PHP 脚本来处理 Joomla！然后 URL 重定向到 Wordpress 的。因此，您将在 Apache 配置中使用正则表达式检测 index.php?option=com_content&task=view URL，找到“id”的值，然后重定向到 someotherscript.php，该文件将包含来自 Joomla 的 id 映射！到WordPress。然后，此脚本将使用 header('Location: ?p=' . $id) 重定向到 Wordpress 中的正确页面。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T19:37:22.547

感谢这个想法！我把它放在 index.php 中（wordpres 默认）：

```
if(isset($_GET['option'])) {
    if(is_numeric($_GET['id'])){
        header ('HTTP/1.1 301 Moved Permanently');
        header("Location: http://www.site.com/?p={$_GET['id']}");
        die();
    }else {
        die('Hacking attempt');
    }
} 
```

并且工作起来像......太棒了！:D

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T02:15:20.563

另一种选择可能是使用重定向插件为您执行此操作。每次更改或更新主题时保存解决方案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-09-25T21:36:34.520

我对 Joomla 的一些未知 CMS 有一个非常相似的问题。如果您想在 Apache 中使用 .htaccess 进行此操作，则有一种方法，但如果旧 URL 和新 URL 之间绝对没有关系，那么您必须为每个 URL 对写两行。

```
RewriteEngine On
# now the first Example
RewriteCond %{QUERY_STRING} ^option=com_content&task=view&id=49&Itemid=29$
RewriteRule ^index\.php$ /?p=23 [R=301,L]
# Repeat last two lines for all your URLs 
```

我不确定你是否真的有这种新的 URL。个人而言，SEF URL 会更好，例如：`https://example.com/path/to/new/page`

如果您想这样做，则可以这样做，但是您必须添加一个 ? 在目的地的末尾，否则旧的查询字符串将被添加到您的新目的地，如下所示：`https://example.com/path/to/new/page?option=com_content&task=view&id=49&Itemid=29` 因此对于本示例，请执行以下操作：

```
RewriteCond %{QUERY_STRING} ^option=com_content&task=view&id=49&Itemid=29$
RewriteRule ^index\.php$ /path/to/new/page? [R=301,L] 
```

# windows - 如何从 Windows 批处理文件的 Y 子文件夹中删除 N 个 X 类型的文件？

> ID：337522
> 
> 赞同：17
> 
> 时间：2008-12-03T15:33:42.337
> 
> 标签：windows, file-io, command-line, command-prompt

我正在尝试编写一个可以从子目录中删除文件的 Windows 批处理文件。我宁愿不对目录结构进行硬编码，这样我就可以将此过程用于其他项目。

*   我需要删除 X 类型的文件，
*   我有父文件夹`C:\MyProject`，
*   有 Y 个子文件夹`C:\MyProject\?`，
*   有 N 个文件要删除。

是否有`del`我只是缺少的快速（类型）功能？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-12-03T15:37:02.423

实际上你可以使用标准的 del 命令：

```
c:
cd MyProject
del /S *.type 
```

其中 type 是您要删除的扩展名，/S 参数将检入 MyProject 的所有子文件夹。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-04T16:40:02.483

如果 del 命令没有 /S 标志来递归删除，我会使用 AWK 来做这样的事情（你需要适用于 Windows 的 UNIX 工具）：

```
dir MyProject\*.* /ad /s /b | gawk "{print \"del \\\"\" $0 \"\\*.type\\\"\";}" | cmd 
```

我的 2 美分，以防您需要使用缺少递归标志的命令执行类似操作（将程序应用于所有子文件夹中的所有 X 类型文件）。

# c# - 从资源中读取 xml 文件

> ID：337535
> 
> 赞同：6
> 
> 时间：2008-12-03T15:35:40.710
> 
> 标签：c#, xml, linq-to-xml

我正在尝试加载一个 xml 文件，该文件作为资源存储在我的 C# 项目中，以便我可以执行各种 LINQ 查询。但是在运行时会引发“路径中的非法字符”异常。这就是我加载文件的方式：

```
XDocument doc = XDocument.Load(MyProject.Properties.Resources.XMLFile); 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-03T15:41:11.167

这里实际上不会`XMLFile`返回 xml 本身吗？如果是这样的话：

```
XDocument doc = XDocument.Parse(MyProject.Properties.Resources.XMLFile); 
```

# itunes - Apple 使用哪些软件工具来制作 iTunes Store？

> ID：337541
> 
> 赞同：3
> 
> 时间：2008-12-03T15:36:56.057
> 
> 标签：itunes

我很喜欢使用 iTunes Store，但我很好奇它是在什么基础上开发的（PHP 和 MySQL，Something Custom？）。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-03T15:46:31.233

[网络对象](http://developer.apple.com/tools/webobjects/)。这些天它带有 XCode，但过去花费超过 50 000 美元！不确定数据库后端。我似乎记得读过它是甲骨文，但我没有来源，可能只是不小心编造了。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-03T15:49:34.473

在 java posse 播客中，Joe Nuxoll 的前苹果员工提到他们使用 Web 对象。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T15:52:13.267

@Stephen Darlington 是正确的，它是 WebObjects。WO 代码生成纯 Java，并进一步优化。代码已经重写了几次。

有趣的是，戴尔最初的 BYO 网站是用 1996 年 50,000 美元的 WebObjects 编写的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-10-07T20:34:44.153

iTunes 商店是多种技术的混合体，但最主要的是 Apple 的 WebObjects。WebObjects 是坚如磐石的 Java 框架，包含许多成熟的技术（模板、ORM）。

WebObjects 是免费的（如果我错了，请纠正我），几乎可以安装在每个平台上，并且在 MacOSX 上不受限制。WebObjects 主要是使用 eclipse 和一个名为 WOLips 的插件开发的。这个框架和开发工具背后有一个非常活跃的社区。

一些链接：

*   [官方 WebObjects 社区网站](http://www.wocommunity.org/why_webobjects.html)
*   [WebObjects/Wonder/Wolips 社区 wiki](http://wiki.objectstyle.org/confluence/dashboard.action)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-08T17:39:56.120

是的，它的 webObjects，您也可以将多个数据库源与 WO 一起使用，您可以将其他语言与它结合使用，例如 JS 和 php

实际上，webobjects 已经被忽视了一段时间，主要是因为它过去的价格以及它没有被苹果很好地推销

* * *

## 回答 #6

> 赞同：-6
> 
> 时间：2008-12-03T15:46:38.347

我认为你得到的任何答案都是 99% 的猜测。我敢打赌，如果有人真的为 Apple 工作并且确实掌握了他们不会被允许分享的事实。

# visual-studio - Visual Studio IDE 布局技巧

> ID：337551
> 
> 赞同：2
> 
> 时间：2008-12-03T15:38:02.063
> 
> 标签：visual-studio, ide

我从未在 Visual Studio 中找到用于编码的“理想”布局。我有一个三显示器设置，但似乎解决方案资源管理器/属性/输出/错误/任何窗格总是妨碍或占用屏幕空间。当然，这有点开放式，但是您是否有一个“理想”的布局，其中包含针对特定窗口的无数浮动/可停靠/锚定设置？例如，我喜欢在两个屏幕之间拆分垂直代码窗格，并且通常解决方案资源管理器锚定在最右侧代码窗格的右侧，但这会占用我希望用于代码的屏幕空间。我正在考虑将这些东西放到另一个屏幕上。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T17:06:38.637

Apparently VS 2010 will do a LOT more for multi monitor setups. ScottGu went over this at DevConnections 2008, and a few more times, usually wherever he goes.

I got the impression that the MDI or tabbed codefiles might be able to be detached from the IDE, and float/draggable onto another monitor.

As it stands today in VS 2008, Solution Explorer, Immediate Window, etc are detachable and be able to float onto another monitor, separate from the main IDE.

# html - 通过单击按钮更改屏幕上的 Flash 文件

> ID：337569
> 
> 赞同：0
> 
> 时间：2008-12-03T15:41:54.050
> 
> 标签：html, flash

我正在尝试开发一种方法，通过单击按钮将屏幕上显示的 Flash 文件更改为另一个文件。我已经能够用`jpg`图像做到这一点，但我不能让它与`flash`文件一起工作。任何人都可以帮忙吗？我将不胜感激。

下面是两个html：

1.  第一个更改`jpg`图像并且可以正常工作
2.  我构造的第二个类似于对`flash`文件执行相同操作，但它不起作用。

我必须把`//`所有的行都写好，否则当我提交问题时它试图执行 html。谢谢。

**Html 1。点击时这会将图像 1 更改为图像 2。有用**

```
<html>
<head>
    <script type="text/javascript">
        function changeSrc()
        {
        document.getElementById("myImage").src="Image 2.jpg";
        }
    </script>
</head>
<body>
    <img id="myImage" src="Image 1.jpg" width="400" height="400" />
    <br /><br />
    <input type="button" onclick="changeSrc()" value="Change image">
</body>
</html> 
```

**Html 2。这是为了在点击时将 Flash 1 更改为 Flash 2。这没用**

```
<html>
<head>
    <script type="text/javascript">
    function changeSrc()
        {
        document.getElementById("myImage").src="Flash 2.swf";
        }
    </script>
</head>
<body>
    <object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" 
    id="myImage" width="450" height="335"> 
    <param name="movie"  value="Flash 1.swf" /> 
    </object> 
    <br /><br />
    <input type="button" onclick="changeSrc()" value="Change image">
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-09T03:17:20.720

我有同样的问题。但是，我在 IE 上完成了这项工作，但在 Firefox 中仍然无法正常工作。

在 IE 中工作的代码是：

```
document.getElementById('Flash1').movie = 'flash2.swf';

document.Flash1.movie = "flash2.swf";

document.getElementById('Flash1').LoadMovie(0, 'flash2.swf');

document.getElementsByName("Flash1")[0].movie = 'flash2.swf'; 
```

任何代码都可以在 IE 上运行，请选择您喜欢的代码。

# javascript - 为禁用 javascript 的用户编写不同的功能是否值得？

> ID：337570
> 
> 赞同：21
> 
> 时间：2008-12-03T15:42:55.733
> 
> 标签：javascript

我目前正在构建一个项目，我想使用一些简单的 javascript - 我知道有些人禁用它以防止 XSS 和其他事情。我是不是该...

a）使用简单的javascript，那些禁用它的用户会错过

b) 不要使用简单的 javascript，启用它的用户必须点击更多

c) 对启用 javascript 和禁用 javascript 的功能进行编码

我不太确定，因为网络总是在变化，你有什么建议？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-12-03T15:49:12.880

优雅地降级 - 确保网站在没有 JavaScript 的情况下运行，然后为那些启用 JavaScript 的人添加花里胡哨。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-12-03T16:34:52.993

其他人都发表了很好的评论，但还有一些其他的考虑因素需要考虑。

### 有时 javascript 将托管在不同的域上，并且很容易超时。

有时，该域可能无法访问，而您的站点仍然可以访问。在这种情况下，让您的网站完全堆叠起来并不好。

出于这个原因，应该避免像谷歌跟踪器中那样的“阻塞”脚本（即：document write inline），或者至少应该尽可能晚地进入页面，以便页面呈现无论域是否是是否超时请求。

如果您碰巧从损坏/恶意的服务器上提供 JS，无论是有意还是无意，只需使用一个脚本来服务该 javascript，该脚本在发送所有标头后只需调用“sleep(forever)”即可停止页面渲染。

### 有些人使用 NoScript

与上述问题一样，有时客户端环境可能会阻止某些脚本源，无论是用户选择还是其他原因（即：浏览器安全满意度，奇怪的防病毒/反恶意软件应用程序）。最流行和可控的实例是 NoScript，我自己偏执地用它阻止了一些流行的跟踪/广告服务（一些代理服务器也会这样做）。

然而，如果一个网站设计得不好，一个脚本加载失败仍然会执行依赖于该脚本存在的代码，这会产生错误并停止一切工作。

我的建议是：

1.  使用萤火虫
2.  使用 NoScript 并阻止所有内容 --> 查看站点仍然有效
3.  启用你不能没有任何东西的核心站点脚本->查看站点仍然有效并且firebug不会抱怨。
4.  启用 3rd 方的东西 --> 看到网站仍然有效并且萤火虫不会发牢骚。

还有很多其他的并发症可能会出现，但满足上述 2 应该可以解决大部分问题。只需假设，无论出于何种原因，组成页面的一个或多个资源都可以自发消失（它们总是如此），并且您希望页面尽可能友好地“生存”这个问题。对于可能持续 < 10 秒的问题，它还不错，请刷新页面并修复它，但如果它可能会出现问题，并且一次严重阻碍可用性一个小时或更长时间。

从本质上讲，与其想“哦，有些用户没有 javascript”，不如试着多想“很容易出错，让我们*所有*的用户都使用损坏的 javascript。哎哟！让我们尝试做到这一点，这样当这种情况发生时，我们就不会真正地把自己弄脏了”

（我已经看到 IE 更新推出并为整个浏览器使用 javascript，直到编写脚本的人找到解决方法。失去所有 IE 客户不是一件好事）

`:set sarcasm`

`:set ignoreSpelling`

`:set iq=76`

### 别担心，它只有 5% 的利基市场

没有人关心瞄准利基市场吗？所有那些有趣的螺旋桨头在他们令人讨厌的愚蠢的linoox cpu中运行lynx，把所有的时间都花在intarwebs上冲浪，因为他们与他们的生活或金钱没有更好的关系？疯狂的安全偏执书呆子因为不喜欢而左右禁用javascript？

现在没有人希望他们成为您的主要客户，是吗？利基市场。噗。谁在乎！

`:set nosarcasm`

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-12-03T15:56:45.737

## 考虑你的听众

“优雅地降级”通常是最好的答案。但是现在很多网站都依赖于 JS——尤其是 AJAX。

考虑你的听众。如果您的网站针对的是非常精通技术的人，那么他们没有 javascript 的可能性很小，您可以通知他们在必要时打开它。

如果您的受众可能使用移动设备访问您的网站，请不要假设他们有 JavaScript，甚至不要假设他们正确支持 CSS。旨在优雅地降级到裸 HTML。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-12-18T18:00:52.767

我从我的问题中学到了很多东西：[那些不使用 Javascript 的人是怎么回事](https://stackoverflow.com/questions/373818/whats-with-those-do-not-use-javascript-people)

使用 Ajax 和 Web 2.0。这就是网络的发展方式，而且非常棒。Stackoverflow 不是很好吗？关闭 Javascript 就不太好。

一旦你准备好你的网站，但在你让它上线之前，在关闭 Javascript 的情况下对其进行测试，然后添加你认为需要的任何内容，以使你的网站出现并对其起作用。您只需要添加您认为必不可少的内容。

请记住，除了使用屏幕阅读器的视障人士外，其他人都选择关闭 javascript。如果他们想使用您拥有的所有功能，他们还可以选择信任您的网站并为您的网站打开 javascript。这真的是他们的选择。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-12-03T16:02:58.737

正如其他人所说，它应该“优雅地降级”。

在其他作品中，它必须在没有 Javascript（句号）的情况下工作。它不必工作得很好。禁用 Javascript 的人知道导致这些限制的原因并接受了它们。但是，如果您想向他们推销某些东西，重要的是他们仍然可以购买。

在我正在设计的网站上，有一个基于 JavaScript 的弹出式菜单。关闭 Javascript 后，所有弹出窗口始终处于打开状态。它看起来不像 JS 那样酷，但它仍然可以用来浏览网站。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-12-03T15:53:37.770

这取决于您需要多少时间来开发和维护这两种解决方案，以及非 JavaScript 用户对您来说价值多少。

我的电子商务网站严重依赖 JavaScript，一年半以来，我没有收到任何投诉。事实上，我不认为自从我开始以来，我在任何日志中都没有看到一个访问者禁用了 javascript。这并不意味着他们不在那里。这只是意味着（a）他们是一个很小的百分比，（b）他们对我卖的东西不感兴趣，或者（c）以上两者。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-12-04T19:08:53.977

为您的网站编写代码，支持最低限度的浏览器。然后更多的人可以毫无挫折地使用您的网站，即使他们没有所有的花里胡哨——如 Flash、Javascript 和 Java——启用。继续支持古老的浏览器可能不切实际，比如 Netscape Navigator 4，因为可以合理地期望用户保持他们的计算机是最新的。但是，Javascript、Flash 和 Java 等功能可能是旧浏览器或现代浏览器中的安全漏洞，也可能令人烦恼。

我的父母都没有启用 Javascript 或 Flash，因为他们有太多的经验让他们减慢已经很慢的连接速度，让他们的浏览器崩溃，或者在愚蠢地使用它的网站上更加烦恼（其中很多。 ..) 而不是一个有用的功能。例如，如果您的表单*需要*进行 AJAX 调用，并且在禁用 Javascript 时您实际上不能点击提交按钮来发送表单，那么这只是一个糟糕的设计。

我妈妈最近很沮丧地发现她现在无法点击 eBay 结果页面，因为每个页面都需要 Javascript。她可以看到下一页结果的唯一方法是打开 Javascript 或在每页显示更多结果。现在为什么页面链接需要 Javascript 而“每页结果”链接只是普通链接？它们都应该*是*普通的旧 HTML 链接。也许 Javascript 可以用来为导航添加一些 whiz-bang，但是用户不应该因为禁用 Javascript 而受到糟糕的界面的惩罚。这对 eBay 来说是愚蠢的，并且给他们的用户带来了不必要的麻烦。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-03T16:33:53.180

我是使用“无脚本”的人之一。而且我可以告诉你，使用 javascript 并且没有启用它就无法工作的网站非常烦人，stackOverflow ......不，我们不希望它非常花哨，如果我支持加载一个新页面，上面写着“谢谢。”

我们希望能够在合理的限制下使用该站点，但不要显示说必须启用 JS 的页面，即使该站点没有它也是垃圾。是的，如果您的网站说服我们留下来，我们将启用。网站上不常用的功能也可能需要 javascript。

请注意，您的网站在没有 JS 或 CSS 的情况下也应该看起来不错，如果没有其他的话，它对 Bots 有好处。

正如其他人指出的那样，有些手机没有 JS，这正在发生变化，但另一个很好的理由是合理的非 JS。我建议使用非 JS 代码并在前者工作后添加 JS，JS 可以使用非 JS 布局的好方法。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-08-20T17:46:28.257

它有助于我在实现中将其视为“渐进式增强”而不是优雅降级。降级通常会导致您在实现后弄清楚如何使其在没有 js 的情况下工作，而不是制定基线并使用 js 进行增强。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-03T15:55:11.857

至少在 JavaScript 关闭时测试您的网站是否*正常运行是至关重要的。*

正如 orip 所说，优雅地降级非常重要。当禁用 JavaScript 时，您的页面看起来既美观又能正常运行应该是**至关重要的。**

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-03T18:42:43.903

对于主要用于传达信息的标准网站，请始终优雅地降级。

对于网络应用程序：

在为标准互联网受众构建 Web 应用程序时，我会牢记以下三个事实：

1.  95%-97% 的潜在用户将启用 JavaScript。
2.  有时，当 JavaScript 不可用时，已建立的用户需要访问功能。
3.  3%-5% 的潜在用户会故意禁用 JavaScript。

鉴于事实一，如果您相信构建**一个依赖 JavaScript 的 Web 应用程序将提供卓越的用户体验**，那么一定要去做。这样做可以帮助你积累用户。

但是，鉴于事实二，您应该**始终提供一种方法，使您的用户可以在没有 JavaScript 的情况下访问核心功能**。你需要提供每一个功能吗？可能不是。但是用户应该能够完成他或她的工作。这将使您的用户在发现自己暂时没有 JavaScript 时感到高兴。

鉴于事实三，我还将提供一个深入的介绍，以试图**吸引这些用户启用 JavaScript**。

顺便说一句，我最喜欢的 Web 应用程序之一，[Remember The Milk](http://www.rememberthemilk.com)采用了这种方法。此外，如果没有 JavaScript， [Google 的日历应用程序](http://www.google.com/calendar)将无法使用。因此，依赖 JavaScript 的 Web 应用程序正在兴起，而且这种趋势可能是不可阻挡的。在我看来，这是一件好事。

（请记住，JavaScript 使 Accessbility 成为一个比现在更大的问题。请努力使您的应用程序可供残障人士使用。）

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-03T16:11:39.747

如前所述，这取决于您的目标受众。

如果我是其中的一员，您希望确保您的网站在我的手机上正常运行（如果不是很理想），并且它让我有理由在关闭 Javascript 时打开 Javascript。没有人期望禁用 Javascript 的完整功能，任何使用手机访问网站的人都期望出现一些问题，但您至少需要提供一些预告片。对于网上商店，确保客户至少可以看到一些商品，即使他们不能在没有 Javascript 的情况下购买。

# reporting-services - 如何在文本框集合中显示报告服务记录集

> ID：337571
> 
> 赞同：0
> 
> 时间：2008-12-03T15:42:56.997
> 
> 标签：reporting-services

我有一个只包含 1 条记录的记录集，但我需要在 2 列中显示结果（10 个字段）并带有匹配的标签

文本框没有 datasetname 属性。

如何在 2 列中显示 10 个字段？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-03T15:49:46.670

我找到了

右键单击文本框 选择表达式 选择数据集 选择您的数据集 选择 First([fieldname])

瞧

# .net - 有没有像字典一样工作但没有值的集合？

> ID：337574
> 
> 赞同：8
> 
> 时间：2008-12-03T15:43:45.343
> 
> 标签：.net, data-structures, collections, dictionary

我需要一个像 Dictionary/Hashtable 一样工作的集合，从某种意义上说，它在任何时候都只会包含给定对象的 1 个实例。一个通用类会更好，但我会尽我所能。这个集合是否存在于框架中的某个地方？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-03T15:45:21.110

`HashSet<T>`从`System.Core.dll`

# xml - 命名空间的 XML 属性排序

> ID：337575
> 
> 赞同：4
> 
> 时间：2008-12-03T15:44:35.370
> 
> 标签：xml, namespaces, xsd

[与我之前提出](https://stackoverflow.com/questions/335135/creating-xml-with-namespaces-and-schemas-from-an-xelement)的一个相关问题...

只是检查一下：XML 文件中 xmlns、xmlns:xsi 和 xsi:schemaLocation 属性的顺序是否重要？

我发现确实如此 - 至少在使用 XML Notepad 2007 查看 XML 文件时。例如（假设我的 XML 文件根据我的架构是合法的）这不会产生错误（示例 1）：

```
<myroot 
    xmlns="http://www.someurl.com/ns/myroot" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xsi:schemaLocation="http://www.someurl.com/ns/myroot http://www.someurl.com/xml/schemas/myschema.xsd">

   <sometag>somecontent</sometag>

</myroot> 
```

但是这个确实（示例2）：

```
<myroot 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xsi:schemaLocation="http://www.someurl.com/ns/myroot http://www.someurl.com/xml/schemas/myschema.xsd"
    xmlns="http://www.someurl.com/ns/myroot"> 

   <sometag>somecontent</sometag>

</myroot> 
```

（错误是“sometag”根据架构是非法条目）。

我的问题是，如果我使用其他问题中的代码来生成我的命名空间和模式属性，那么我会按照示例 2 的顺序获得 XML 属性输出......

xmlns 属性是否总是必须在属性列表中排在第一位？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T16:17:23.900

啊 - 我发现了我的问题....

我实际处理的 XML 非常复杂，我没有注意到我在所有子节点中都插入了 xmlns=""。一旦我消除了问题，并且命名空间属性的顺序没有区别 - 这是我所期望的......

# iphone - 在 Facebook 和 AP Mobile News 上看到的“滑块”类型标签

> ID：337576
> 
> 赞同：2
> 
> 时间：2008-12-03T15:44:44.280
> 
> 标签：iphone, cocoa-touch

请原谅我缺乏 Photoshop 技能，但我很好奇 Facebook 和 AP Mobile News 等应用程序在其应用程序中用于“标签滑块”的策略类型。这是一个简短的片段，概述了我正在谈论的内容，因为我确定我正在将实用程序标记为正在被屠杀的名称：http: [//dl-client.getdropbox.com/u/57676/slider.jpg](http://dl-client.getdropbox.com/u/57676/slider.jpg)

本质上，用户可以触摸标签并沿 X 轴滑动它。一旦碰到边缘，它也具有平滑的反弹效果。如果您需要在屏幕上呈现的内容比肖像模式所允许的更多，这会提供更多的空间，因此非常有价值。

只是用一点Touch API + Core Animation创建一个比屏幕更宽的UILabel吗？希望深入了解如何开始解决这个问题。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-03T15:57:55.687

您很可能希望使用 UIScrollView，并将 UILabel 作为其内容视图。根据您的内容调整标签的大小，然后将滚动视图的 contentSize 属性设置为该大小。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-03T17:05:33.820

我创建了一个类似的控件，它比您想象的要容易得多。它只是一个添加了一系列 UIButtons 的 UIScrollView。你可以使用标签而不是按钮——这取决于你想要的感觉。我认为 Facebook 可能正在为他们的标签使用标签。

在任何情况下，如果您想要将“选定”标签的样式设置为与其他标签不同的样式，您可能会想要使用一系列组件而不是一个组件（这是 Ben 建议的）。它还使命中检测更容易一些。

默认情况下，您可以免费获得弹跳效果 - 您可能已经注意到 iPhone 应用程序中的大多数滚动视图都做同样的事情。它也可以关闭。

# sql - 检查存在时我应该在哪里进行行计数：sql 还是 php？

> ID：337581
> 
> 赞同：1
> 
> 时间：2008-12-03T15:46:19.690
> 
> 标签：sql, count

在我想检查的情况下，如果数据库中的某个条目存在，我有两个选择。

我可以使用 COUNT() 创建一个 sql 查询，然后检查结果是否> 0 ...

...或者我可以只检索记录，然后计算返回的行集中的行数。例如 $result->num_rows;

什么更好/更快？在 mysql 中？一般来说？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-03T15:49:20.917

YMMV，但我怀疑如果您只是检查是否存在，并且不需要以任何方式使用检索到的数据，那么 COUNT() 查询会更快。速度快多少取决于数据量。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-03T15:49:34.533

最快的可能是询问数据库是否存在：

```
SELECT EXISTS ([your query here]) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T16:03:29.390

如果您所做的只是检查是否存在，那么

```
Select count(*) ... 
```

但是，如果您要检索数据（如果存在），那么只需获取数据并在 PHP 中检查它，否则您将有两个调用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-03T16:07:03.783

对我来说是在数据库中。

进行 count(1) 比 $result->num_rows 更快，因为在 $result->num_rows 中，您进行 2 次操作 1 选择，如果选择有计数则进行计数更快地获得结果。除非您还想从数据库中获取信息。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-03T16:11:14.523

```
SELECT 1 
  FROM (SELECT 1) t 
 WHERE EXISTS( SELECT * FROM foo WHERE id = 42 ) 
```

刚刚测试，在 MySQL v5 上运行良好

COUNT(*) 通常在以下情况下效率较低：

1.  您可以有重复项（因为 DBMS 必须彻底搜索所有记录/索引才能给您准确的答案）或
2.  有 NULL 条目（出于同样的原因）

如果您基于保证生成单个记录（或 0）的 WHERE 子句进行计数，*并且*DBMS 知道这一点（基于 UNIQUE 索引），那么它应该同样有效。但是，您不太可能总是有这种情况。此外，取决于版本和 DBMS，DBMS 可能并不总是能够接受这一点。

在应用程序中计数（当您不需要该行时）几乎总是保证会更慢/更差，因为：

1.  您必须向客户端发送数据，客户端必须对其进行缓冲并做一些工作
2.  您可能会在 DBMS MRU/LRU 数据缓存中发现更重要的内容
3.  您的 DBMS 将（通常）必须执行更多的磁盘 I/O 来获取您永远不会使用的记录数据
4.  您有更多的网络活动

当然，如果你想对存在的行做一些事情，那么简单地尝试获取开始的行肯定更快/最好！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-03T15:59:16.560

```
SELECT COUNT(*) FROM table 
```

是最好的选择，这个操作在小表和大表上都非常快。虽然有可能

```
SELECT id FROM table 
```

在小桌子上更快，速度差异将是微观的。但是如果你有一个大表，这个操作可能会很慢。

因此，您最好的选择是始终选择`COUNT(*) the table`（这样做`*`比选择特定的要快`column`），总体而言，这将是最快的操作。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-03T16:55:29.330

如果您想要原始速度，请进行基准测试！除了其他人建议的方法：

```
SELECT 1 FROM table_name WHERE ... LIMIT 1 
```

由于避免了子选择，可能会更快。对其进行基准测试。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-12-03T15:50:55.670

我肯定会在 PHP 中这样做以减少数据库的负载。

为了获得计数**并**在 SQL 中获取返回的行，您必须执行两个查询。一个 COUNT，然后是一个 SELECT

PHP 方式在一个结果对象中为您提供所需的一切。

# javascript - 在 Google Maps API 中的 GDirections.loadFromWaypoints 之后触发事件

> ID：337585
> 
> 赞同：1
> 
> 时间：2008-12-03T15:47:41.497
> 
> 标签：javascript, google-maps

我正在尝试向 Google Maps API 返回到指定 div (directionsPanel) 的路线结果添加一些文本。下面的代码可以正常工作，除了 jQuery 行在 loadFromWaypoints 完成修改 DOM 之前触发。如果我在路线内容完成加载后通过手动触发它来运行该行，它将按预期执行。

```
directions = new GDirections(map, directionsPanel);
directions.loadFromWaypoints(waypoints);

$("td[@jscontent='address']").append(" some content"); 
```

如何在 DOM 完成重新加载后添加某种侦听器（可能在 loadFromWaypoints 回调函数或方向面板 div 本身上）以执行我的 jQuery 行？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-03T16:46:32.330

文档不是很好，但它谈到了“加载”和“添加覆盖”事件 [http://code.google.com/apis/maps/documentation/reference.html#GDirections](http://code.google.com/apis/maps/documentation/reference.html#GDirections)

```
GEvent.addListener(directions, "addoverlay", function() {
    $("td[jscontent='address']").append(" some content"); 
}); 
```

# perl - 如何在 Perl 中获取当前登录用户的主要组和其他组？

> ID：337588
> 
> 赞同：4
> 
> 时间：2008-12-03T15:48:14.600
> 
> 标签：perl

根据[这个网站](http://www.builderau.com.au/program/perl/soa/Obtain-user-group-and-process-information-in-Perl/0,339028313,339222142,00.htm)，我可以简单地写

```
$user = getlogin(); 
```

但组处理功能似乎无法接受用户名/用户 ID 作为参数。我真的应该遍历所有 /etc/group 文件行并从中解析组名吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-03T16:01:27.787

无需解析系统文件，在类 UNIX 操作系统上，我将使用 getpwuid 和 getgrgid 系统调用的内置接口：

```
use strict;
use warnings;

# use $< for the real uid and $> for the effective uid
my ($user, $passwd, $uid, $gid ) = getpwuid $< ;
my $group = getgrgid $gid ;

printf "user: %s (%d), group: %s (%d)\n", $user, $uid, $group, $gid; 
```

更简单的东西，比如

```
my $group = getgrgid $( 
```

也可以工作，因为 $( 和 $) 已经应该包含 GID 和 EGID。

最后是 POSIX 模块中定义的 getgroups 函数，

```
use POSIX qw(getgroups) 
```

正如 dsw 所建议的那样，如果您的操作系统（与 Linux 不同）支持同时拥有多个活动组，则还应该允许您获取辅助组。

查找非活动辅助组可能确实涉及解析 /etc/group 文件，直接或通过 getgrend 内置和标准 User::grent 模块的组合使用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-03T16:02:33.870

您应该使用[POSIX 模块](http://perldoc.perl.org/POSIX.html)。更具体地说，其中包含的`getpw*`和`getgr*`函数`getu*`。

# c# - C#中的覆盖和继承

> ID：337598
> 
> 赞同：26
> 
> 时间：2008-12-03T15:50:54.953
> 
> 标签：c#, inheritance, overriding

好的，在我学习的过程中，请多多包涵。这是我的问题。

我不知道为什么我不能覆盖父类的方法。这是来自基类的代码（是的，我从一本 OOP 书籍中窃取了 java 代码，并试图用 C# 重写它）。

```
using System;

public class MoodyObject
{
    protected String getMood()
    {
        return "moody";
    }

    public void queryMood()
    {
        Console.WriteLine("I feel " + getMood() + " today!");
    }
} 
```

这是我的其他 2 个继承基类 (MoodyObject) 的对象：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace ConsoleApplication1
{
    public class SadObject: MoodyObject
    {
        protected String getMood()
        {
            return "sad";
        }

        //specialization
        public void cry()
        {
            Console.WriteLine("wah...boohoo");
        }
    }
} 
```

和：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace ConsoleApplication1
{
    public class HappyObject: MoodyObject
    {
        protected String getMood()
        {
            return "happy";
        }

        public void laugh()
        {
            Console.WriteLine("hehehehehehe.");
        }
    }
} 
```

这是我的主要内容：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace ConsoleApplication1
{
    class Program
    {
        static void Main(string[] args)
        {
            MoodyObject moodyObject = new MoodyObject();
            SadObject sadObject = new SadObject();
            HappyObject happyObject = new HappyObject();

            Console.WriteLine("How does the moody object feel today?");
            moodyObject.queryMood();
            Console.WriteLine("");
            Console.WriteLine("How does the sad object feel today?");
            sadObject.queryMood();
            sadObject.cry();
            Console.WriteLine("");
            Console.WriteLine("How does the happy object feel today?");
            happyObject.queryMood();
            happyObject.laugh();
        }
    }
} 
```

正如你所看到的，非常基本的东西，但这里是输出：

> 喜怒无常的对象今天感觉如何？我今天心情不好！
> 
> 悲伤的对象今天感觉如何？我今天心情不好！哇...嘘
> 
> 快乐的对象今天感觉如何？我今天心情不好！嘿嘿嘿嘿嘿。按任意键继续 。. .

不像我预期的那样。我试图将基本方法设为虚拟并在尝试覆盖它时调用覆盖，这只会让我出现这个错误“无法覆盖继承的成员'MoodyObject.getMood()'，因为它没有被标记为虚拟、抽象或覆盖”。我也尝试过没有虚拟和覆盖，它认为我试图隐藏基本方法。同样，我是 OOP 的新手，希望得到任何指导。

**编辑添加：我找到了！MoodyObject.cs 只是解决方案资源管理器中的“解决方案项”，而不是“ConsoleApplication1”项。我将它拖到解决方案资源管理器中它所属的位置，瞧！现在可以了。我在下面将 Luc 的答案标记为答案，因为他为我提供了解决问题所需的帮助......我在这里学到了很多东西。太棒了，你们这些男孩女孩都非常聪明！**

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2008-12-03T16:00:19.287

在 C# 中，方法默认不是虚拟的，因此如果您将某些方法设计为可覆盖，则应将其指定为虚拟：

```
class Base 
{
  protected virtual string GetMood() {...}
} 
```

其次，您必须指定要从派生类中的基类重写方法。

```
class Derived : Base
{
  protected override string GetMood() {...}
} 
```

如果您不指定“覆盖”关键字，您将获得隐藏基类型的方法（并警告编译器将“新”关键字用于该方法的显式声明）。

如果要停止继承链并禁止进一步覆盖该方法，则应将方法标记为密封，如下所示：

```
 protected sealed override string GetMood() {...} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-03T16:08:32.110

您需要使用 override 关键字来覆盖任何虚拟或实现任何抽象方法。

```
public class MoodyObject
{
    protected virtual String getMood() 
    { 
        return "moody"; 
    }    
    public void queryMood() 
    { 
        Console.WriteLine("I feel " + getMood() + " today!"); 
    }
}

public class HappyObject : MoodyObject
{
    protected override string getMood()
    {
        return "happy";
    }
} 
```

我在这里推荐的是你可能意味着 MoodyObject 是一个抽象类。（如果你这样做，你必须改变你的主要方法，但你应该探索它）处于喜怒无常的模式真的有意义吗？我们上面的问题是你的 HappyObject 不需要为 getMood 提供实现。通过使类抽象它可以做几件事：

1.  您不能新建抽象类的实例。您必须使用子类。
2.  您可以强制派生子实现某些方法。

所以要做到这一点，你最终会：

```
public abstract class MoodyObject
{
    protected abstract String getMood();

    public void queryMood() 
    { 
        Console.WriteLine("I feel " + getMood() + " today!"); 
    }
} 
```

请注意您不再提供 getMood 的实现。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-03T15:59:30.600

据我所知，在 Java 中，默认情况下所有方法都是虚拟的。这不是 C# 的情况，因此您需要用“virtual”标记基类方法，例如`protected virtual string getMood() ...`，用“override”标记覆盖，例如`protected override string getMood()...`.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-03T16:02:27.520

如果要覆盖基类方法，则需要将其声明为`virtual`. 派生类中的重写方法必须显式声明为`override`. 这应该有效：

```
public class BaseObject
{
    protected virtual String getMood()
    {
        return "Base mood";
    }

    //...
}

public class DerivedObject: BaseObject
{
    protected override String getMood()
    {
        return "Derived mood";
    }
    //...
} 
```

**编辑：**我刚刚在 ac# 控制台应用程序中尝试过，它可以编译。因此，您使用的源代码应该与您在此处发布的一些微小但重要的部分有所不同。

我的 program.cs 是这样的：

```
using System;
using System.Collections.Generic;
using System.Text;

namespace ConsoleApplication1
{
    class Program
    {
        static void Main(string[] args)
        {    
            // leaving out your implementation to save space...    
        }
    }    

    public class SadObject : MoodyObject
    {
        protected override String getMood()
        {
            return "sad";
        }

        //specialization
        public void cry()
        {
            Console.WriteLine("wah...boohoo");
        }
    }

    public class HappyObject : MoodyObject
    {
        protected override String getMood()
        {
            return "happy";
        }

        public void laugh()
        {
            Console.WriteLine("hehehehehehe.");
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-03T15:58:50.227

`virtual`通过在 Moody 和派生类中创建方法 GetMood `override`，您的代码应该可以工作。您确定将这些关键字放在它们所属的位置吗？这是完整的代码，可以正常编译和运行：

```
public class MoodyObject
{
    protected virtual String getMood()
    {
        return "moody";
    }

    public void queryMood()
    {
        Console.WriteLine("I feel " + getMood() + " today!");
    }
}

public class SadObject : MoodyObject
{
    protected override String getMood()
    {
        return "sad";
    }

    //specialization
    public void cry()
    {
        Console.WriteLine("wah...boohoo");
    }
}

public class HappyObject : MoodyObject
{
    protected override String getMood()
    {
        return "happy";
    }

    public void laugh()
    {
        Console.WriteLine("hehehehehehe.");
    }
}

class Program
{
    static void Main(string[] args)
    {
        MoodyObject moodyObject = new MoodyObject();
        SadObject sadObject = new SadObject();
        HappyObject happyObject = new HappyObject();

        Console.WriteLine("How does the moody object feel today?");
        moodyObject.queryMood();
        Console.WriteLine("");
        Console.WriteLine("How does the sad object feel today?");
        sadObject.queryMood();
        sadObject.cry();
        Console.WriteLine("");
        Console.WriteLine("How does the happy object feel today?");
        happyObject.queryMood();
        happyObject.laugh();

        Console.Read();
    }
} 
```

也许您的错误来自这样一个事实，即在 Java 中，所有方法都是虚拟的，而 C# 并非如此（正如 Dan C. 所指出的那样）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-03T16:01:54.963

您需要告诉 C# 您的对象正在覆盖基类中的函数。

这是有关您需要的语法的 MSDN 文章：http: [//msdn.microsoft.com/en-us/library/ebca9ah3 (VS.71).aspx](http://msdn.microsoft.com/en-us/library/ebca9ah3(VS.71).aspx)

```
public class SadObject: MoodyObject    
{        
    override String getMood() 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-03T15:56:28.170

```
public class SadObject: MoodyObject
    {
        override String getMood() 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-03T15:59:05.577

您需要使用“override”关键字标记 getMood 的覆盖。您还需要使用“virtual”关键字标记基本 getMood 方法。

# .net - 如何使用设备模拟器的多个实例调试 .NET 移动设备应用程序

> ID：337600
> 
> 赞同：2
> 
> 时间：2008-12-03T15:51:11.957
> 
> 标签：.net, visual-studio, visual-studio-2008, windows-mobile, compact-framework

我想使用多个设备模拟器实例来调试 .NET 移动设备应用程序。如果我右键单击项目并在实例已经运行时转到调试 - > 在 Visual Studio 2008 中启动新实例，我会收到错误消息

> 无法将文件“obj\Debug\MyMobileApp.exe”复制到“bin\Debug\MyMobileApp.exe”。该进程无法访问文件“bin\Debug\MyMobileApp.exe”，因为它正被另一个进程使用。

有谁知道我是否以及如何做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T16:33:07.363

我刚刚发现了一种可以（某种程度上）做到这一点的方法。不能从 Visual Studio 的两个实例部署到相同类型模拟器的两个实例，但*可以*部署到两种*不同*类型模拟器的实例。虽然不是没有小技巧。

若要查看其工作原理，请打开两个 Visual Studio 实例，并在每个实例中打开相同的 CF 项目。接下来，您需要手动启动两个模拟器。找到文件**dvcemumanager.exe**（它应该在**C:\Program Files\Microsoft Device Emulator\1.0**中）并运行它。要启动模拟器，请选择它，然后单击 Actions | 连接。对于此示例，启动常规模拟器和 VGA 模拟器（当然，等待它们完全启动）。

回到 Visual Studio，将一个实例的部署目标设置为常规模拟器，将另一个实例的目标设置为 VGA 模拟器，然后分别启动。每个应用程序都将部署到模拟器的适当已运行实例。

您不能使用这种技术来运行同一类型模拟器的两个版本，因为从设备管理器界面似乎没有任何方法可以做到这一点。此外，您不能只启动两个 VS 实例并将它们设置为不同的模拟器 - 我试过了，但它不起作用。出于某种原因，第二个尝试部署到与第一个相同的模拟器，您会收到您看到的错误。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-19T19:25:12.420

我不确定我是否完全理解这个问题。

你不能为同一个项目启动多个 Visual Studio 实例，每个实例都连接到不同的模拟器，调试同一个应用程序吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-11-03T20:11:42.387

您需要创建额外的模拟器实例。这回答了如何[在 Windows 移动模拟器上的不同调试环境之间切换的好方法](https://stackoverflow.com/questions/7604886/is-there-a-good-way-of-switching-between-different-debugging-environments-on-win/7611038#7611038)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2011-11-03T14:32:07.757

断开设备，去探索并删除所有文件和文件夹而不是创建。确保应用程序没有运行，（taskadmin）。再次连接，重建，部署，然后 f5。

祝你好运

# sql - 存储过程到 .sql 文件

> ID：337601
> 
> 赞同：6
> 
> 时间：2008-12-03T15:51:18.260
> 
> 标签：sql, sql-server, sql-server-2005, stored-procedures

SQL 2005 中是否有一个简单的过程可以将我的所有存储过程吐出到单个 .sql 文件中。我想将它们移到 VSS 中，但对于单击每个以获取源、将其转储到文本文件等的前景并不太兴奋。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-03T15:57:41.493

在 SQL Management Studio 中，右键单击数据库，转到任务 -> 生成脚本，完成向导。其中一个页面将允许您将每个对象编写到其自己的文件中。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-03T15:56:10.077

您可以运行此选择：

```
select
    O.name, M.definition
from
    sys.objects as O
left join
    sys.sql_modules as M
    on O.object_id = M.object_id
where
    type = 'P' 
```

你得到存储过程的名称和源代码。可能是最简单的方法，如何将它放入文件中是一些“经典”语言，如 c#、java 等......

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-03T16:06:15.360

如果您想对整个数据库进行版本控制，Microsoft 有一个 SQL Server 数据库发布向导（您可以[在此处](http://www.microsoft.com/downloads/details.aspx?familyid=56E5B1C5-BF17-42E0-A410-371A838E570A&displaylang=en)下载）。概述说与 Visual Studio 直接集成，但我没有亲自使用它来保证它可能有多好（或多坏）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-05T18:25:49.863

我编写了一个名为[SMOscript](http://devio.wordpress.com/2008/09/05/introducing-smoscript/)的工具，它可以选择为每个数据库对象创建一个 .sql 文件。

它使用 SQL Server 的 SMO 库来生成 CREATE 和 DROP 脚本。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-11-22T12:23:40.250

尝试使用[Sql Server SMO](http://msdn.microsoft.com/en-us/library/ms162169.aspx)。下面包含一个示例：

```
//C:\Program Files\Microsoft SQL Server\{version}\SDK\Assemblies\
using Microsoft.SqlServer;
using Microsoft.SqlServer.Server;
using Microsoft.SqlServer.Management.Smo;
using Microsoft.SqlServer.Management.Common;
using System.Data.SqlClient;

string sqlConnectionString="";
string databaseName="";

var Connection = new SqlConnection(sqlConnectionString);
Connection.Open();
int counter = 0;
var db= new Server(new ServerConnection(Connection)).Databases[databaseName];

foreach (var item in db.StoredProcedures.OfType<StoredProcedure>())
{
    if (item.IsSystemObject ==  false)
    {
        using (TextWriter writer = new StreamWriter(item.Name+".sql", false))
        {
            writer.WriteLine(item.TextHeader + item.TextBody);
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-10-22T19:12:42.057

您还可以使用以下脚本在单独的 .sql 文件中生成选定的数据库存储过程脚本，文件将按过程名称创建。

使用动态查询和游标，您可以这样做：

```
DECLARE @name varchar(100)
DECLARE @Definition varchar(max)
DECLARE @sql varchar(300)
CREATE TABLE TEMPTABLE (ID INT IDENTITY(1,1), def varchar(max))
DECLARE script CURSOR  
FOR
SELECT OBJECT_NAME(SYS.SQL_MODULES.OBJECT_ID), [DEFINITION] FROM 
SYS.SQL_MODULES INNER JOIN SYS.OBJECTS ON
SYS.OBJECTS.OBJECT_ID = SYS.SQL_MODULES.OBJECT_ID 
WHERE SYS.OBJECTS.TYPE='P'
OPEN script
FETCH NEXT FROM script INTO @name, @Definition
WHILE @@FETCH_STATUS = 0 
BEGIN
  FETCH NEXT FROM script INTO @name, @Definition
  INSERT INTO TEMPTABLE VALUES(@definition)
  SET @Sql = ('BCP "SELECT TOP 1 def FROM TEMPTABLE ORDER BY ID DESC" queryout "C:\' + @name + '.sql" -c -T')
  EXEC XP_CmdShell @Sql
END 
CLOSE script
DEALLOCATE script
DROP TABLE TEMPTABLE 
```

# windows - 使用 Windows 搜索以 jsp 结尾的文件

> ID：337602
> 
> 赞同：1
> 
> 时间：2008-12-03T15:51:25.920
> 
> 标签：windows, jsp, search, full-text-search

我正在尝试使用 windows 搜索我的 web 目录之一，以查找 scriptlet 的任何用途。但是，搜索似乎忽略了所有以 .jsp 结尾的文件。我搜索了简单的单词，但也没有用。Windows 在搜索时忽略这些文件是否有原因？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-03T17:01:42.500

我建议你使用这个命令行实用程序（一种 windows grep）

`findstr /c:bla /s *.jsp`

这将递归地找到所有包含`bla`（并将突出显示相应的行）并以`jsp`.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-03T15:59:01.567

您需要搜索通配符，即“*”（不带引号）。如果你搜索 *.txt 你会得到所有以 .txt 结尾的文件，如果你写 abc.** 你会得到所有以 abc 开头的文件。

因此，使用通配符将帮助您找到要搜索的内容。尝试在搜索窗口中按 F1 ( Ctrl + F )

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-03T17:35:13.417

Windows Search 不会在它不识别为已知的可搜索类型的文件中进行搜索。请参阅此[知识库文章](http://support.microsoft.com/?kbid=309173)，了解问题的描述以及针对特定文件类型解决问题的注册表黑客。请注意，您需要为要添加的*每个*无法识别的文件类型执行此操作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-03T15:53:55.557

尝试搜索 *.jsp 并查看是否有任何文件出现。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-03T15:58:32.880

两种可能：

1.  该文件夹未被 Windows 搜索索引
2.  JSP 文件在 Windows 搜索选项中被标记为“文件属性过滤器”。

从“索引选项”控制面板中，添加文件夹。在“高级”下，单击“文件类型”选项卡并查找 JSP。将索引更改为“索引文件属性和内容”或系统上调用的任何内容。如果文件类型尚未列出，您也可以添加文件类型。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-03T16:53:54.717

对非标准（流行）文件类型（除了 .doc、.txt 等）使用内置的 Windows 查找文件似乎不起作用。

我使用 UltraEdit32 及其在文件中的查找实用程序来为 JS 和 ASP.NET 类型执行此操作。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-03T17:21:18.797

一个答案：FileSeek。它快速、免费，并且完全符合您的要求。它将搜索内部文件并支持正则表达式和通配符搜索。

[http://www.binaryfortress.com/fileseek/](http://www.binaryfortress.com/fileseek/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-03T16:01:45.727

我可以向您推荐 StopKa - 桌面搜索工具；我不在这里发布链接（或者有可能？）因为它看起来像广告 - 因为我是作者 - 尝试用谷歌搜索它。

# google-maps - 使用谷歌地图优化地图路线

> ID：337607
> 
> 赞同：20
> 
> 时间：2008-12-03T15:53:09.113
> 
> 标签：google-maps, traveling-salesman

有没有办法使用 Google Maps API 在给定一组航点的情况下返回“优化”路线（换句话说，旅行商问题的“足够好”的解决方案），或者它总是返回带有按指定顺序点？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2012-02-01T14:29:11.450

Google Maps API DirectionsRequest 中有一个名为 optimizeWaypoints 的选项，它应该可以满足您的需求。不过，这最多只能处理 8 个航点。

或者，有一个开源（MIT 许可）库，您可以将其与 Google Maps API 一起使用，以获得最佳（最多 15 个位置）或非常接近最佳（最多 100 个位置）的路线。

请参阅[http://code.google.com/p/google-maps-tsp-solver/](http://code.google.com/p/google-maps-tsp-solver/)

您可以在[www.optimap.net上查看该库的运行情况](http://www.optimap.net)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-02T21:25:49.310

它总是按顺序排列它们。

所以我认为你必须找到每对点之间的距离（或时间），一次一个，然后自己解决旅行商问题。不过，也许您可​​以说服 Google 地图添加该功能。我想什么构成“足够好”的解决方案取决于你在做什么以及它需要多快。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-08-10T06:32:10.127

在典型的 TSP 问题中，假设可以直接在任意两点之间移动。对于地面道路，情况并非如此。当 Google 计算两点之间的路线时，它会进行启发式生成树优化，并且通常会得出一个相当接近最优路径的路径。

要计算 TSP 路线，首先必须让 Google 计算图中每个节点之间的成对距离。我认为这需要 n*(n-1) / 2 计算。然后可以采用这些距离并对它们执行 TSP 优化。

OpenStreetMaps.org 有一个[Java WebStart](http://wiki.openstreetmap.org/wiki/Traveling_salesman)应用程序，它可以做你想做的事。当然，计算是在客户端运行的。该项目是开源的，可能值得一看。

您是在寻找位置之间的最佳直线路径，还是最佳行驶路线？如果你只是想点点，如果你能得到 GPS 坐标，就变成了一个很容易的问题。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2019-01-27T07:37:51.200

谷歌为旅行推销员问题提供了现成的解决方案。您可以在此处找到 OR-Tools（Google 的运筹学工具）：[https ://developers.google.com/optimization/routing/tsp](https://developers.google.com/optimization/routing/tsp)

你需要做的基本上是两件事：

*   使用 Google Maps API 获取每两点之间的距离：[https ://developers.google.com/maps/documentation/distance-matrix/start](https://developers.google.com/maps/documentation/distance-matrix/start)

*   然后，您将数组中的距离提供给[OR-Tools](https://developers.google.com/optimization/routing/tsp)，它会为您找到一个非常好的解决方案（对于具有数百万个节点的某些实例，已发现解决方案保证在最佳游览的 1% 范围内）。

您还可以注意到：

> 除了寻找经典旅行商问题的解决方案外，OR-Tools 还提供了更通用类型的 TSP 的方法，包括以下内容：

*   > 非对称成本问题——传统的 TSP 是对称的：从 A 点到 B 点的距离等于从 B 点到 A 点的距离。但是，将物品从 A 点运送到 B 点的成本可能不等于从 A 点运送到 B 点的成本从 B 点到 A 点。OR-Tools 还可以处理成本不对称的问题。

*   > 收集奖品的 TSP，通过访问节点获得收益

*   > 带时间窗的 TSP

附加链接：

*   Github 上的 OR 工具：[https ://github.com/google/or-tools](https://github.com/google/or-tools)
*   开始使用：[https ://developers.google.com/optimization/introduction/get_started](https://developers.google.com/optimization/introduction/get_started)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-01-16T11:26:28.080

刚刚发现[http://gebweb.net/optimap/](http://gebweb.net/optimap/) 它看起来很简单。使用谷歌地图的在线版本。

# php - 如何在 PHP 中找到 eval 函数的源代码？

> ID：337608
> 
> 赞同：0
> 
> 时间：2008-12-03T15:53:15.230
> 
> 标签：php, function, reflection

我正在尝试找到一种方法来获取字符串中（用户定义的）PHP 函数的源代码。

对于普通代码，这很容易，使用反射我可以找到定义函数的文件和行号；然后我可以打开文件并阅读函数源代码。

如果在 eval'd 代码中定义了函数，这将不起作用。我不想记录所有经过评估的代码。

这可能吗？如果是，那么如何？

**示例代码：**

```
function myfunction() {
    echo "Test";
}
eval('
  function myevalfunction() {
    echo "Test";
  }
');

$a = new ReflectionFunction('myfunction');
echo $a;

$b = new ReflectionFunction('myevalfunction');
echo $b; 
```

**输出：**

```
Function [ <user> <visibility error> function myfunction ] {
  @@ test.php 3 - 5
}
Function [ <user> <visibility error> function myevalfunction ] {
  @@ test.php(11) : eval()'d code 2 - 4
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T16:01:26.930

我最初的反应是说在 eval 中创建一个函数几乎是 0 个很好的理由。

您可以有条件地创建函数，即：

```
if ( $cond ){ 
   function foo(){ 

   }
} 
```

如果你想要像**闭包**一样的行为，我猜 eval 是 PHP5.3 之前的唯一方法，但它的*EPIC*坏东西，你应该避免所有成本。

原因如下：

```
 **01** <?php
 **02 ** 
**03** function foo ()
 **04** {
 **05**    eval(
 **'06**      function baz()
 **07**      {
 **08**         eval("throw new Exception();"); 
 **09**      }
 **10**    '); 
**11**   巴兹（）； 
**12** }
 **13 ** 
**14 ** 
**15 ** 
**16**尝试{ 
 **17**    foo(); 
**18** }catch( 异常 $e ){
 **19**    var_dump($e); 
**20** }
 **21**尝试{ 
 **22**    foo(); 
**23** }
 **24**捕获（异常 $e）{
 **25**    var_dump($e);
**26** } 
```

哪个发出这个：

```
 对象（异常）#1 (6) {
  [“消息：受保护”]=>
  字符串（0）“”
  [“字符串：私有”]=>
  字符串（0）“”
  [“代码：受保护”]=>
  整数（0）
  [“文件：受保护”]=>
  string(50) "/tmp/xx.php(10) : eval()'d code(4) : eval()'d code"
  [“线路：受保护”]=>
  整数（1）
  [“跟踪：私人”]=>
  数组（3）{
    [0]=>
    数组（3）{
      [“文件”]=>
      string(31) "/tmp/xx.php(10) : eval()'d 代码"
      [“行”]=>
      整数（4）
      [“功能”]=>
      字符串（4）“评估”
    }
    [1]=>
    数组（4）{
      [“文件”]=>
      字符串（11）“/tmp/xx.php”
      [“行”]=>
      整数（11）
      [“功能”]=>
      字符串（3）“巴兹”
      [“参数”]=>
      数组（0）{
      }
    }
    [2]=>
    数组（4）{
      [“文件”]=>
      字符串（11）“/tmp/xx.php”
      [“行”]=>
      整数（17）
      [“功能”]=>
      字符串（3）“富”
      [“参数”]=>
      数组（0）{
      }
    }
  }
}

致命错误：无法在 /tmp/xx.php(10) 中重新声明 baz()（之前在 /tmp/xx.php(10) 中声明：eval()'d code:2）：eval()'d code on line 5

调用堆栈：
    0.0002 115672 1\. {main}() /tmp/xx.php:0
    0.0006 122304 2\. foo() /tmp/xx.php:22 
```

这么多的坏事，这么少的努力。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T16:07:48.460

您不能自己搜索文件吗？grep 或wingrep 非常适合这个。

如果没有，您可以尝试使用 pecl 函数 rename_function 并记录所有创建函数的 eval 调用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T16:40:34.650

您如何定义自己的评估函数并在那里进行跟踪？

```
function myeval($code) {
     my_eval_tracking($code, ...);  # use traceback to get more info if necessary
     # (...)
     return eval($code);
} 
```

也就是说，在这种情况下，我确实分享了 Kent Fredric 对 eval 的很多感受。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-08-10T10:43:05.993

如果你想找到源代码，即使在调试器中，你也可以定义你自己的 eval() 函数来处理临时文件：

```
function my_eval($code) {
  $file = << TEMP-DIR >> . '/' . md5($code) . '.php';
  if (!file_exists($file)) {
    file_put_contents($file, "<?php\n" . $code);
  }
  return require($file);
} 
```

其实我觉得如果你调用这个函数`eval`并把它放在默认的命名空间里，代码中大部分的eval()调用都会改为调用这个函数。

# c++ - 矩阵模板库矩阵求逆

> ID：337620
> 
> 赞同：3
> 
> 时间：2008-12-03T15:56:10.247
> 
> 标签：c++, math, stl, boost, linear-algebra

我正在尝试使用 Boost boost_1_37_0 和 MTL mtl4-alpha-1-r6418 版本对矩阵求逆。我似乎无法找到矩阵求逆代码。我搜索了一些示例，它们似乎引用了上述版本中似乎缺少的 lu.h。有什么提示吗？

[@Matt](https://stackoverflow.com/users/8643/matt-cruikshank)建议复制 lu.h，但这似乎来自 MTL2 而不是 MTL4。我在用 VS05 或更高版本编译 MTL2 时遇到问题。

那么，知道如何在 MTL4 中进行矩阵求逆吗？

更新：我想我更了解马特，我正在沿着[这条 ITL 路径前进](http://www.osl.iu.edu/research/itl/)。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-03T16:03:17.673

貌似你用`lu_factor`，然后`lu_inverse`。不过，我不记得您与枢轴有什么关系。从[文档](http://www.osl.iu.edu/research/mtl/reference/html/index.html)中。

是的，就像你说的，看起来他们的文件说你需要 lu.h，不知何故：

> **如何反转矩阵？**
> 
> 您应该问自己的第一个问题是，您是否真的想计算矩阵的逆矩阵，或者您是否真的想求解线性系统。对于求解线性方程组，不必显式计算矩阵逆。相反，计算矩阵的三角因子然后使用这些因子执行正向和反向三角求解更有效。下面给出了有关求解线性系统的更多信息。如果你真的想反转一个矩阵，`lu_inverse()`在 mtl/lu.h 中有一个函数。

如果不出意外，您可以在他们的网站上查看[lu.h。](http://www.osl.iu.edu/research/mtl/mtl/lu.h)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T18:46:05.937

我从未使用 boost 或 MTL 进行矩阵数学，但我使用过 JAMA/ [TNT](http://math.nist.gov/tnt/)。

此页面[http://wiki.cs.princeton.edu/index.php/TNT](http://wiki.cs.princeton.edu/index.php/TNT)展示了如何进行矩阵求逆。基本方法与库无关：

1.  将矩阵 M 分解为 XY ，其中 X 和 Y 是适当的分解（LU 可以，但为了数值稳定性，我认为你会想要使用 QR 或 SVD）。

2.  求解 I = MN = (XY)N for N，前提是 M 已被分解；图书馆应该有一个例程。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-10-04T11:03:28.853

在 MTL4 中使用：

```
mtl::matrix::inv(Matrix const &A, MatrixOut &Inv); 
```

这是[api](http://www.simunova.com/docs/mtl4/html/namespacemtl_1_1matrix.html#aef7c70cf9677d4995c973adcf408a531)的链接。

# xml - 访问多个来源的相同名称元素

> ID：337621
> 
> 赞同：2
> 
> 时间：2008-12-03T15:56:10.310
> 
> 标签：xml, xslt

我正在使用 XSLT 解析文档。在 XSLT 中，我正在使用 document() 函数加载参考文档，并且可以访问两个文档中的项目。源文档和参考文档都有一个名为 name 的属性。我如何将一个与另一个进行比较。我通过声明一个变量来解决这个问题，但如果可能的话，我宁愿不这样做。在我看来，我需要在事物周围放置名称空间，但不知道该怎么做。

源文件：

```
<?xml version="1.0" encoding="UTF-8"?>
<SoccerMatch revision="21" id="2849180" date="20080405" scheduledStart="1245" venue="Emirates Stadium" status="Result" comment="" league="Friendly Match" attendance="60111">
    <stuffhere>stuff</stuffhere>
    <stuffhere>stuff</stuffhere>
    <stuffhere>stuff</stuffhere>
    <stuffhere>stuff</stuffhere>
    <stuffhere>stuff</stuffhere>
</SoccerMatch> 
```

参考文件（comp.xml）：

```
<?xml version="1.0" encoding="utf-8"?>
<competitions>
    <competition id="100" league="Barclays Premier League"/>
    <competition id="101" league="The Coca-Cola Football League Championship"/>
    <competition id="101" league="The Coca-Cola Football League Championship Play-Offs Semi-Final"/>
    <competition id="101" league="The Coca-Cola Football League Championship Play-Offs Final"/>
    <competition id="102" league="Coca-Cola Football League One"/>
    <competition id="102" league="Coca-Cola Football League One Play-Offs Semi-Final"/>
    <competition id="102" league="Coca-Cola Football League One Play-Offs Final"/>
    <competition id="103" league="Coca-Cola Football League Two"/>
    <competition id="103" league="Coca-Cola Football League Two Play-Offs Semi-Final"/>
    <competition id="103" league="Coca-Cola Football League Two Play-Offs Final"/>
    <competition id="104" league="Blue Square Premier"/>
    <competition id="104" league="Blue Square Premier Play-Offs Semi-Final"/>
    <competition id="104" league="Blue Square Premier Final"/>
    <competition id="105" league="Nationwide Championship Shield"/>
    <competition id="120" league="Clydesdale Bank Premier League"/>
    <competition id="121" league="The Irn-Bru Scottish Football League Championship First Division"/>
    <competition id="121" league="The Irn-Bru Scottish Football League Championship First Division Play-Offs Semi-Final"/>
    <competition id="121" league="The Irn-Bru Scottish Football League Championship First Division Play-Offs Final"/>
    <competition id="122" league="The Irn-Bru Scottish Football League Championship Second Division"/>
    <competition id="122" league="The Irn-Bru Scottish Football League Championship Second Division Play-Offs Semi-Final"/>
    <competition id="122" league="The Irn-Bru Scottish Football League Championship Second Division Play-Offs Final"/>
    <competition id="123" league="The Irn-Bru Scottish Football League Championship Third Division"/>
</competitions> 
```

XSLT

```
<xsl:template match="/SoccerMatch">
<xmlfeed>
<payload payload_class="mobile_football_match_details" payload_name="Payload">
<xsl:variable name="compId" select="document('comp.xml')/competitions/competition[@league=@league]/@id" /> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-03T17:21:34.070

在您的 xml 中看不到“名称”属性。你是说“身份证”吗？我不认为你可以在这里控制命名空间。请参阅 Ken Holman 关于这一点的[讨论](http://www.dpawson.co.uk/xsl/sect2/N2602.html#d4227e19)。

我会同意你对变量的想法。就像是：

```
<xsl:template match="/SoccerMatch">
 <xsl:variable name="matchId" select="@id"/>    
 <xsl:for-each select="document('competitions.xml')/competitions/competition">
   <xsl:if test="$matchId = @id">
     <xmlfeed>
      <payload payload_class="mobile_football_match_details" payload_name="Payload">
        <!-- add more stuff here-->
      </payload>
     </xmlfeed>
   </xsl:if>
 </xsl:for-each> 
```

# .net - 如何访问位图图像中的每个字节

> ID：337631
> 
> 赞同：3
> 
> 时间：2008-12-03T15:58:53.893
> 
> 标签：.net, image, bmp

假设我有一个位图图像，是否可以遍历图像中的所有单个字节？如果是，如何？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-03T16:03:05.663

我发现了这个：[http ://channel9.msdn.com/forums/TechOff/108813-Bitmap-to-byte-array/](http://channel9.msdn.com/forums/TechOff/108813-Bitmap-to-byte-array/)

说您可以使用 Memorystream 和 .Save 方法，它看起来像这样：

```
System.Drawing.Bitmap bmp = GetTheBitmap();
System.IO.MemoryStream stream = new System.IO.MemoryStream();
bmp.Save(stream, System.Drawing.Imaging.ImageFormat.Bmp);
stream.Position = 0;
byte[] data = new byte[stream.Length];
stream.Read(data, 0, stream.Length); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-03T16:51:23.397

If you need to access the pixel information, the super-slow but super-easy way is to call the GetPixel and SetPixel methods on your Bitmap object.

The super-fast and not-that-hard way is to call the Bitmap's LockBits method and use the BitmapData object returned from it to read and write the Bitmap's byte data directly. You can do this latter part with the Marshal class as in Ilya's example, or you can skip the Marshal overhead like this:

```
 BitmapData data;
    int x = 0; //or whatever
    int y = 0;
    unsafe
    {
        byte* row = (byte*)data.Scan0 + (y * data.Stride);
        int columnOffset = x * 4;
        byte B = row[columnOffset];
        byte G = row[columnOffset + 1];
        byte R = row[columnOffset + 2];
        byte A = row[columnOffset + 3];
    } 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-03T16:08:26.430

使用 Bitmap 类的 LockBits 成员获取 BitmapData，然后使用 Scan0 和 Marshal.ReadByte 读取字节。这是一个小例子（虽然它不是关于正确的亮度调整）：

```
 public static void AdjustBrightness(Bitmap image, int brightness)
    {
        int offset = 0;
        brightness = (brightness * 255) / 100;
        // GDI+ still lies to us - the return format is BGR, NOT RGB.
        BitmapData bmData = image.LockBits(new Rectangle(0, 0, image.Width, image.Height), ImageLockMode.ReadWrite, PixelFormat.Format24bppRgb);

        int stride = bmData.Stride;
        IntPtr Scan0 = bmData.Scan0;

        int nVal = 0;
        int nOffset = stride - image.Width * 3;
        int nWidth = image.Width * 3;

        for (int y = 0; y < image.Height; ++y)
        {
            for (int x = 0; x < nWidth; ++x)
            {
                nVal = Marshal.ReadByte(Scan0, offset) + brightness;

                if (nVal < 0)
                    nVal = 0;
                if (nVal > 255)
                    nVal = 255;

                Marshal.WriteByte(Scan0, offset, (byte)nVal);
                ++offset;
            }
            offset += nOffset;
        }
        image.UnlockBits(bmData);
    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T17:40:55.453

另一种解决方案是使用 LockBits 和 Marshal.Copy 将您的位图转换为数组。我需要这个解决方案，因为我有两张仅在颜色深度上有所不同的图像，而其他提供的解决方案不能很好地处理（或者太慢）。

```
using (Bitmap bmp = new Bitmap(fname)) {
    // Convert image to int32 array with each int being one pixel
    int cnt = bmp.Width * bmp.Height * 4 / 4;
    BitmapData bmData = bmp.LockBits(new Rectangle(0, 0, bmp.Width, bmp.Height),
                            ImageLockMode.ReadOnly, PixelFormat.Format32bppArgb);
    Int32[] rgbValues = new Int32[cnt];

    // Copy the RGB values into the array.
    System.Runtime.InteropServices.Marshal.Copy(bmData.Scan0, rgbValues, 0, cnt);
    bmp.UnlockBits(bmData);
    for (int i = 0; i < cnt; ++i) {
        if (rgbValues[i] == 0xFFFF0000)
            Console.WriteLine ("Red byte");
    }
} 
```

# project-management - 代码库何时变得庞大而笨重？

> ID：337642
> 
> 赞同：3
> 
> 时间：2008-12-03T16:01:50.173
> 
> 标签：project-management

你什么时候开始考虑代码库变得太大和笨重？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-03T16:09:40.377

- 当您的大量编码时间用于“我将这段代码放在哪里？”时

- 当关于副作用的推理开始变得非常困难时。

- 当有大量代码只是“在那里”时，没有人知道它在做什么，或者它是否仍在运行，但它太吓人而无法删除

- 当许多团队成员花费大量时间来查找由数据中某处未预期的空字符串引起的间歇性错误时，或者您认为通常会在编写良好的应用程序中捕获的某些错误边缘案例

-在考虑如何实现新功能时，“完全重写”开始似乎是一个不错的答案

- 当你害怕看到你需要维护的乱七八糟的代码，并希望你能找到工作来构建一些干净和合乎逻辑的东西，而不是在垃圾箱里翻找别人的杂乱无章的想法

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-03T16:06:33.407

当它超过100行时。玩笑。这可能是最难回答的问题，因为它非常个人化。

但是，如果您很好地构建应用程序并为接口、数据、服务和前端使用不同的层，您将自动获得一个不错的“基础”结构。然后您可以将每一层划分为不同的类，然后在类中指出该类的适当方法。

但是，没有“每个方法的 x 行数不好”，而是更像这样想，如果有复制的可能性，请将其从当前的部分中分离出来并使其可重用。

重用代码是所有良好结构的基础。

拆分成不同的层将有助于基础变得越来越灵活和模块化。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-03T16:10:04.057

如果这就是您要搜索的内容，则存在一些可计算的指标。静态代码分析工具可以帮助解决这个问题：

这是一个列表：[http ://checkstyle.sourceforge.net/config_metrics.html](http://checkstyle.sourceforge.net/config_metrics.html)

其他因素可能是更改/添加某些内容所需的时间。

其他不可计算的因素可以是

*   与变更相关的风险
*   特征的层次混合。
*   如果文档可以跟上功能/代码
*   如果文档代表应用程序。
*   所需的培训水平。
*   重复而不是重复使用的数量。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-03T16:11:51.493

啊，神程序反模式。

*   当你至少不记得它的部分轮廓时。

*   当您必须考虑更改将如何影响自身或依赖项时。

*   当你不记得它依赖或依赖它的所有事物时。

*   当下载源代码或编译需要超过几分钟（？）时。

*   当您不得不担心如何部署新版本时。

*   当您遇到与应用程序其他地方的其他类功能相同的类时。

这么多可能的迹象。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-03T16:12:40.197

我认为为什么某些代码库太大有很多想法。

1.  很难保持不变的命名约定。如果类/方法/属性不能一致命名或找不到一致，那么是时候重新组织了。
2.  当您的程序员正在网上冲浪并去吃午饭以进行编译时。将编译/链接时间保持在最低限度对管理很重要。您最不希望的事情是让程序员因为长时间地玩弄他们的拇指而分心。
3.  当小的更改开始影响许多其他代码位置时。合并代码有好处，但也有成本。如果修复一个错误的小改动会导致更多错误，并且这种情况经常发生，那么您的代码库需要分散（版本化库）或可能未整合（是的，重复代码）。
4.  如果新程序员对该项目的学习曲线明显长于可接受的时间（通常为 90 天），那么您的代码库/培训设置不正确。

..还有很多，我敢肯定。如果从这三个方面考虑：

1.  很难支持吗？
2.  很难改变吗？
3.  很难学吗？

...然后你就会知道你的代码是否适合“大而笨重”的类别

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-04T02:51:05.963

For me, code becomes unwieldy when there's been a lot of changes made to the codebase that weren't planned for when the program was initially written or last refactored significantly. At this point, stuff starts to get fitted into the existing codebase in odd places for expediency and you start to get a lot of design artifacts that only make sense if you know the history of the implementation.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-03T16:09:37.660

简短的回答：这取决于项目。

长答案：

代码库不一定要很大才能笨拙——意大利面条代码可以从第 1 行开始编写。因此，从好到坏并没有真正的神奇跳闸点——它更像是一系列伟大的 <---> 糟糕的，并且每天都需要努力防止您的代码库朝着错误的方向前进。您通常需要的是一位能够客观地审查他人代码的首席开发人员，并从整体上关注代码的体系结构和设计 - 没有一个一线开发人员可以做到这一点。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-03T16:10:28.267

当我不记得一个类做了什么或它使用了哪些其他类时，我的脑海中就会浮现。这实际上更多地取决于我的认知能力以及代码复杂性。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-03T18:26:20.910

我试图根据你的同事对它的看法来考虑一种决定方式。

几年前我参加演出的第一周，我在一次站立会议上说，我一直在跟踪 ContainerManagerBean、ContainerManagementBean 和 ContextManagerBean 周围的一只白兔（想起这些话让我不寒而栗！）。至少有两个开发者看了看他们的鞋子，我可以看到他们一直在窃笑。

就在那时，我知道这不是我对代码库不熟悉的问题——所有开发人员都认为它有问题。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-03T16:11:55.940

如果经过多年的开发，不同的人代码更改请求和错误修复，您迟早会得到具有重复功能、非常相似的类、一些意大利面条等的部分代码。这主要是由于需要快速修复和“新人”不知道代码库。所以他很高兴地把已经存在的东西编码掉。

但是，如果您有自动检查，检查样式​​、单元测试代码覆盖率和类似情况，您可以避免其中的一些。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-03T18:37:13.510

许多人们认为表明问题的事情实际上与代码库的原始大小无关，而是与它的可理解性有关。大小与可理解性有何关系？如果有的话...

我见过非常短的程序，它们只是一团糟——更容易扔掉并从头开始重做。我还看到了非常大的程序，其结构足够透明，即使在逐渐更详细的视图中也可以理解。以及介于两者之间的一切...

我认为从整个代码库的角度来看这个问题是一个很好的问题，但是从底部开始工作并首先查看单个类、多类组件、子系统以及最后向上的可理解性可能是值得的到整个系统。我希望每个细节级别的答案都能相互建立。

对我来说，最简单的基准是这样的：你能用一句话解释 X 的本质吗？其中 X 是组件的某种粒度，您可以假设您了解组件上方和下方的级别。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-03T18:49:03.160

*   当您需要一个实用方法或类时，不知道其他人是否已经实现了它或不知道在哪里寻找它。

*   相关：当存在相同功能的几个略有不同的实现时，因为每个作者都不知道其他作者的工作。

# c# - 将 winform 的元素重置为初始化状态 (C#/.Net)

> ID：337649
> 
> 赞同：2
> 
> 时间：2008-12-03T16:02:57.940
> 
> 标签：c#, asp.net, winforms, initialization

我正在用 C# 构建一个 winform，面板中有各种元素，这些元素从不可见、禁用或设置为 null（标签、组合框、网格等）开始。当用户经历并做出选择时，这些元素会被填充、选择等。

这个想法是上传文件，读取它们，并将条目处理到数据库中。完成此目录的处理后，我希望能够让用户选择另一个目录，而无需退出并重新启动 winform 应用程序，方法是按下该过程完成后变为可见的按钮。

是否有一个简单的调用来重置应用程序（或包含元素的面板），类似于刷新网络表单时，还是我必须编写一个函数来一次“重置”所有这些元素？

编辑：作为开发会议的结果，我的项目改变了方向。我感谢你们两个帮助回答的问题，我将结束这个问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-03T16:11:55.643

简单地从表单中删除面板并创建新面板。

**编辑：** 示例：

```
Panel CreatePanelWithDynamicControls() {
    Panel ret = new Panel();
    ret.Dock = DockStyle.Fill;
    // some logic, which initialize content of panel

    return ret;
}

void InitializeDynamicControls() {
    this.Controls.Clear();
    Panel pnl = this.CreatePanelWithDynamiControls();
    this.Controls.Add( pnl );
}

void Form1_Load( object sender, EventArgs e ) {
    if ( !this.DesignMode ) {
        this.InitializeDynamicControls();
    }
}

// I don't know exactly, on which situation
// do you want reset controls
void SomeEvent( object sender, EventArgs e ) {
    this.InitializeDynamicControls();
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T16:10:47.423

您可以尝试调用 this.InitializeComponent()，这可能会成功。或者，如果您的应用程序具有“目录选择”表单和“处理文件”表单，您可以让“目录选择”表单在“处理文件”表单上执行“新建”，这应该将其返回到其原始状态（而不是在它的开放，但）。

# objective-c - 如何对我的自定义 URL 方案进行故障排除？

> ID：337656
> 
> 赞同：1
> 
> 时间：2008-12-03T16:04:02.697
> 
> 标签：objective-c, cocoa, appleevents

我设置了一个简单的事件处理程序，如此处所述[，](https://stackoverflow.com/questions/49510/how-do-you-set-your-cocoa-application-as-the-default-web-browser)但似乎没有调用选择器。我将代码放在我的 AppDelegate 类中，并将委托连接到 IB 中。尝试在我希望被调用的选择器中放入一些 NSLog() 和断点，但没有一个被命中。URL 方案在启动我的应用程序时起作用，但在那之后它什么也不做。谁能建议如何解决这个问题？谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-04T04:11:35.207

好吧，我不禁注意到你的`-init`方法被错误地声明了。如果应该有返回类型`id`并`return self;`在最后有一个。

```
- (id)init
{
    self = [super init];
    if (self) {
        [[NSAppleEventManager sharedAppleEventManager] setEventHandler:self andSelector:@selector(getUrl:withReplyEvent:) forEventClass:kInternetEventClass andEventID:kAEGetURL];
    }
    return self;
} 
```

通过这些修复，我能够将这两个例程粘贴到测试 AppController 类中，并让它打印出我在 Safari 中键入的 URL（使用自定义方案）。我会在该 -init 方法上放置一个断点并逐步执行它以绝对确保 -setEventHandler: 方法被调用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T22:16:23.317

最大的问题是：你在哪里调用 NSAppleEventManager 的 -setEventHandler:...？如果您想捕获启动应用程序的 URL，您需要在应用程序完成启动之前调用它。如果您的应用程序委托是在您的 MainMenu.nib 中创建的，那么它的 -init 或 -awakeFromNib 方法将起作用，但例如 -applicationDidFinishLaunching: 将不起作用。

此外，确保您提供给 -setEventHandler: 的选择器与您的方法名称完全相同，特别注意大写和正确的冒号数量。

显然，如果您发布了您的应用程序委托的相关代码，那将非常有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-04T02:05:36.460

感谢您的建议。我仔细检查了那些东西。我确定这是一些新手错误，但我会感谢任何查看代码的人。（URL 位存储在 info.plist 中。）现在我只是在尝试对 URL 进行任何操作之前确认它是否正常工作。

```
- (void)init{
    self = [super init];
    if(self){
        [[NSAppleEventManager sharedAppleEventManager] setEventHandler:self andSelector:@selector(getUrl:withReplyEvent:) forEventClass:kInternetEventClass andEventID:kAEGetURL];
    }
}

- (void)getUrl:(NSAppleEventDescriptor *)event withReplyEvent:(NSAppleEventDescriptor *)replyEvent
{    
    NSString *url = [[event paramDescriptorForKeyword:keyDirectObject] stringValue];
    NSLog(url);
    // now you can create an NSURL and grab the necessary parts
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-04T15:12:14.250

新手错误 #2：没有在 IB 中设置我的应用程序委托的类。修复这个和上面的 init 方法让我开始了。呃……

# object - ELF 和 PE 的基本链接过程如何工作

> ID：337659
> 
> 赞同：3
> 
> 时间：2008-12-03T16:05:17.670
> 
> 标签：object, linker, elf, portable-executable

我一直对链接器的工作方式感到困惑，而且这是一个很难搜索的主题。

为了演示我的问题并为答案提供框架，我将写下到目前为止我所知道的（或认为我知道的）。我可能是非常错误的。:)

首先，每个 .cpp 文件都被构建到一个中间文件中（我相信 .o 代表 Posix/ELF 和 .obj 代表 Win/PE）。该中间文件包含由它构建的 .cpp 定义的所有符号，并说明了需要正确解析哪些外部链接。作为对此的扩展，Posix 系统允许您将 .o 文件合并到 .a 文件中（这似乎除了合并之外没有任何作用？这是什么命令？）。.lib 是 Posix .a 文件的 Win/PE 等价物吗？

接下来，将中间文件链接在一起，解决外部依赖关系，并获得可执行文件。我错过了任何步骤吗？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T16:40:41.997

这里有几个拼图：

*   ar(1) 用于创建 .a 文件。它们类似于 tar(1) 或 zip 文件（可能带有按符号名称查找目标文件的索引）
*   链接器将目标文件的各个部分（文本、数据、bss）复制在一起。对于 GNU ld，可以使用链接描述文件控制节的精确复制（例如，将名称中包含“文本”的 .o 文件中的所有节复制到单个文本节中）
*   链接器还进行重定位：一旦知道符号的值，就使用相应的目标地址修补指令（跳转和数据加载）。在某些情况下，这不能在链接时完成，因此链接器将 .o 文件中的重定位记录复制/调整到最终的可执行文件中。
*   windows .lib 有两个用途：静态库 (.lib) 类似于 .a 库。导入库 (.lib) 不包含实际代码，而仅包含符号列表。链接器可以解析导入库中的符号，但随后知道它需要将对相应 .dll 的引用放入可执行文件中。在 Unix/ELF 上，.so 文件同时包含代码和符号表。

# encryption - 在经典asp中加密连接字符串

> ID：337663
> 
> 赞同：3
> 
> 时间：2008-12-03T16:06:34.500
> 
> 标签：encryption, asp-classic, connection-string

是否可以存储加密的连接字符串，以便可以从服务器端 vbscript 使用？在“过去的美好时光”中有相当于 web.config 的东西吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-03T16:17:59.937

当我清理旧的记忆库时...

我记得在经典的 ASP 系统中，我们会将连接字符串（和大多数其他配置设置）放在 Windows 注册表中，即 Web 应用程序的自定义注册表项中。我们将使用 COM DLL 来读取设置。

您可以加密存储在注册表中的连接字符串，但您必须自己进行加密/解密。

所以答案是肯定的，这绝对是可能的，但是框架中没有内置的简单工具可以即时加密/解密，你必须自己做。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T18:58:40.777

.Net 具有内置的所有加密和解密代码，因此加密字符串的最简单方法是使用 .Net 加密/解密函数。创建一个 .Net 组件来执行 decrition 和一个 COM 可调用包装器，它应该注册它。然后从您的 ASP 页调用它。

# algorithm - 计算数组中的反转

> ID：337664
> 
> 赞同：120
> 
> 时间：2008-12-03T16:07:03.407
> 
> 标签：algorithm

我正在设计一种算法来执行以下操作：给定数组`A[1... n]`，对于每个`i < j`，找到所有反转对，例如`A[i] > A[j]`. 我正在使用合并排序并将数组 A 复制到数组 B，然后比较两个数组，但是我很难看到如何使用它来查找反转的数量。任何提示或帮助将不胜感激。

* * *

## 回答 #1

> 赞同：145
> 
> 时间：2011-06-21T11:58:08.337

所以这是java中的O（n log n）解决方案。

```
long merge(int[] arr, int[] left, int[] right) {
    int i = 0, j = 0, count = 0;
    while (i < left.length || j < right.length) {
        if (i == left.length) {
            arr[i+j] = right[j];
            j++;
        } else if (j == right.length) {
            arr[i+j] = left[i];
            i++;
        } else if (left[i] <= right[j]) {
            arr[i+j] = left[i];
            i++;                
        } else {
            arr[i+j] = right[j];
            count += left.length-i;
            j++;
        }
    }
    return count;
}

long invCount(int[] arr) {
    if (arr.length < 2)
        return 0;

    int m = (arr.length + 1) / 2;
    int left[] = Arrays.copyOfRange(arr, 0, m);
    int right[] = Arrays.copyOfRange(arr, m, arr.length);

    return invCount(left) + invCount(right) + merge(arr, left, right);
} 
```

这几乎是普通的归并排序，整个魔法隐藏在归并函数中。请注意，虽然排序算法会删除反转。合并算法计算删除反转的数量（整理出来的人可能会说）。

唯一移除反转的时刻是算法从数组右侧获取元素并将其合并到主数组。此操作删除的反转数是要合并的左侧数组中剩余的元素数。:)

希望它的解释性足够。

* * *

## 回答 #2

> 赞同：88
> 
> 时间：2008-12-03T18:36:54.167

我通过以下方法在 O(n * log n) 时间内找到了它。

1.  合并排序数组 A 并创建一个副本（数组 B）
2.  取 A[1] 并通过二进制搜索找到它在排序数组 B 中的位置。该元素的反转次数将比其在 B 中的位置的索引号少一个，因为出现在 A 的第一个元素之后的每个较低的数字都将是一个反转。

    2a. 将反转次数累积到计数器变量 num_inversions。

    2b。从数组 A 以及数组 B 中的相应位置删除 A[1]

3.  从第 2 步重新运行，直到 A 中不再有元素。

这是该算法的示例运行。原始数组 A = (6, 9, 1, 14, 8, 12, 3, 2)

1：合并排序并复制到数组B

B = (1, 2, 3, 6, 8, 9, 12, 14)

2：取A[1]，二分查找，在数组B中找到

A[1] = 6

B = (1, 2, 3, **6** , 8, 9, 12, 14)

6 在数组 B 的第 4 位，因此有 3 个反转。我们知道这一点是因为 6 在数组 A 中的第一个位置，因此随后出现在数组 A 中的任何较低值元素的索引都将是 j > i（因为在这种情况下 i 是 1）。

2.b：从数组 A 以及数组 B 中的相应位置删除 A[1]（删除粗体元素）。

A = ( **6,** 9, 1, 14, 8, 12, 3, 2) = (9, 1, 14, 8, 12, 3, 2)

B = (1, 2, 3, **6,** 8, 9, 12, 14) = (1, 2, 3, 8, 9, 12, 14)

3：在新的 A 和 B 阵列上从步骤 2 重新运行。

A[1] = 9

B = (1, 2, 3, 8, 9, 12, 14)

9 现在位于数组 B 的第 5 位，因此有 4 次反转。我们知道这一点是因为 9 在数组 A 中的第一个位置，因此随后出现的任何较低值的元素都将具有 j > i 的索引（因为在这种情况下 i 又是 1）。从数组 A 以及数组 B 中的相应位置删除 A[1]（删除粗体元素）

A = ( **9** , 1, 14, 8, 12, 3, 2) = (1, 14, 8, 12, 3, 2)

B = (1, 2, 3, 8, **9** , 12, 14) = (1, 2, 3, 8, 12, 14)

一旦循环完成，按照这种方式继续下去，我们将得到数组 A 的反转总数。

第 1 步（合并排序）需要 O(n * log n) 才能执行。步骤 2 将执行 n 次，并且在每次执行时将执行二进制搜索，需要 O(log n) 来运行总共 O(n * log n)。因此，总运行时间为 O(n * log n) + O(n * log n) = O(n * log n)。

谢谢你的帮助。在一张纸上写出样本数组确实有助于可视化问题。

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2014-04-21T16:40:22.873

我想知道为什么还没有人提到[二叉索引树](https://www.topcoder.com/community/data-science/data-science-tutorials/binary-indexed-trees/)。您可以使用 one 来维护排列元素值的前缀总和。然后，您可以从右到左进行，并为每个元素计算小于右侧的元素数：

```
def count_inversions(a):
  res = 0
  counts = [0]*(len(a)+1)
  rank = { v : i+1 for i, v in enumerate(sorted(a)) }
  for x in reversed(a):
    i = rank[x] - 1
    while i:
      res += counts[i]
      i -= i & -i
    i = rank[x]
    while i <= len(a):
      counts[i] += 1
      i += i & -i
  return res 
```

复杂度为 O(n log n)，常数因子非常低。

* * *

## 回答 #4

> 赞同：28
> 
> 时间：2013-03-01T05:20:36.220

在 Python 中

```
# O(n log n)

def count_inversion(lst):
    return merge_count_inversion(lst)[1]

def merge_count_inversion(lst):
    if len(lst) <= 1:
        return lst, 0
    middle = int( len(lst) / 2 )
    left, a = merge_count_inversion(lst[:middle])
    right, b = merge_count_inversion(lst[middle:])
    result, c = merge_count_split_inversion(left, right)
    return result, (a + b + c)

def merge_count_split_inversion(left, right):
    result = []
    count = 0
    i, j = 0, 0
    left_len = len(left)
    while i < left_len and j < len(right):
        if left[i] <= right[j]:
            result.append(left[i])
            i += 1
        else:
            result.append(right[j])
            count += left_len - i
            j += 1
    result += left[i:]
    result += right[j:]
    return result, count        

#test code
input_array_1 = []  #0
input_array_2 = [1] #0
input_array_3 = [1, 5]  #0
input_array_4 = [4, 1] #1
input_array_5 = [4, 1, 2, 3, 9] #3
input_array_6 = [4, 1, 3, 2, 9, 5]  #5
input_array_7 = [4, 1, 3, 2, 9, 1]  #8

print count_inversion(input_array_1)
print count_inversion(input_array_2)
print count_inversion(input_array_3)
print count_inversion(input_array_4)
print count_inversion(input_array_5)
print count_inversion(input_array_6)
print count_inversion(input_array_7) 
```

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2009-02-12T21:47:42.673

实际上，我有一个与此类似的家庭作业问题。我被限制它必须具有 O(nlogn) 效率。

我使用了您提出的使用 Mergesort 的想法，因为它已经具有正确的效率。我只是在合并函数中插入了一些代码，基本上是：每当右侧数组中的一个数字被添加到输出数组中时，我都会将反转的总数添加到左侧数组中剩余的数字数量。

这对我来说很有意义，因为我已经考虑得够多了。您计算在任何数字之前有多少次更大的数字。

hth。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2017-12-16T13:02:07.790

这个答案的主要目的是比较这里找到的各种 Python 版本的速度，但我也有一些自己的贡献。（FWIW，我刚刚在执行重复搜索时发现了这个问题）。

在 CPython 中实现的算法的相对执行速度可能与人们对算法的简单分析以及使用其他语言的经验所期望的不同。这是因为 Python 提供了许多用 C 实现的强大函数和方法，它们可以以接近完全编译语言的速度对列表和其他集合进行操作，因此这些操作的运行速度比使用 Python“手动”实现的等效算法快得多代码。

利用这些工具的代码通常可以胜过理论上优秀的算法，这些算法试图通过 Python 操作对集合的各个项目进行所有操作。当然，正在处理的实际数据量也会对此产生影响。但是对于中等数量的数据，使用以 C 速度运行的 O(n²) 算法的代码可以轻松击败使用单个 Python 操作完成大部分工作的 O(n log n) 算法。

这个倒数计数问题的许多已发布答案都使用基于合并排序的算法。从理论上讲，这是一个很好的方法，除非数组大小非常小。但是 Python 内置的[TimSort](https://en.wikipedia.org/wiki/Timsort)（一种混合稳定排序算法，源自归并排序和插入排序）以 C 的速度运行，Python 中手工编写的归并排序无法与它竞争速度。

[在Niklas B 发布的答案](https://stackoverflow.com/a/23201616/4014959)中，这里更有趣的解决方案之一是使用内置排序来确定数组项的排名，并使用二[叉​​索引树](https://en.wikipedia.org/wiki/Fenwick_tree)（又名 Fenwick 树）来存储计算反转所需的累积和数数。在试图理解这个数据结构和 Niklas 算法的过程中，我写了一些我自己的变体（贴在下面）。但我还发现，对于中等大小的列表，使用 Python 的内置函数实际上比使用可爱的 Fenwick 树*更快。*`sum`

```
def count_inversions(a):
    total = 0
    counts = [0] * len(a)
    rank = {v: i for i, v in enumerate(sorted(a))}
    for u in reversed(a):
        i = rank[u]
        total += sum(counts[:i])
        counts[i] += 1
    return total 
```

`sum`最终，当列表大小达到 500 左右时，在该循环内调用的 O(n²) 方面`for`抬起了丑陋的头，性能开始下降。

Mergesort 不是唯一的 O(nlogn) 排序，还有其他几个可以用于执行倒数计数。[prasadvk 的答案](https://stackoverflow.com/a/16056139)使用二叉树排序，但他的代码似乎是 C++ 或其派生词之一。所以我添加了一个 Python 版本。我最初使用一个类来实现树节点，但发现 dict 明显更快。我最终使用了 list，它甚至更快，尽管它确实使代码的可读性降低了一些。

树排序的一个好处是它比合并排序更容易迭代实现。Python 不优化递归并且它有一个递归深度限制（尽管如果你*真的*需要它可以增加它）。当然，Python 函数调用相对较慢，因此当您尝试优化速度时，如果可行，最好避免函数调用。

另一种 O(nlogn) 排序是古老的基数排序。它的一大优点是它不会相互比较密钥。它的缺点是它在连续的整数序列上效果最好，理想情况`range(b**m)`下通常是 2 的整数排列。我在尝试阅读[Counting Inversions、Offline Orthogonal Range Counting 和相关问题](http://people.csail.mit.edu/mip/papers/invs/paper.pdf)`b`后添加了一些基于基数排序的版本，这是与[计算排列中“反转”的数量](https://stackoverflow.com/a/6527636/4014959)相关联。

为了有效地使用基数排序来计算长度为 n 的一般序列中的倒数，我们可以创建一个与具有相同倒数数的`seq`排列。我们可以通过 TimSort 在（最坏的情况下）O(nlogn) 时间内做到这一点。诀窍是通过排序来排列 的索引。用一个小例子更容易解释这一点。`range(n)``seq``seq``seq`

```
seq = [15, 14, 11, 12, 10, 13]
b = [t[::-1] for t in enumerate(seq)]
print(b)
b.sort()
print(b) 
```

**输出**

```
[(15, 0), (14, 1), (11, 2), (12, 3), (10, 4), (13, 5)]
[(10, 4), (11, 2), (12, 3), (13, 5), (14, 1), (15, 0)] 
```

通过对 (value, index) 对进行排序，`seq`我们`seq`用相同数量的交换置换了 的索引，这些交换需要`seq`从其排序顺序放入其原始顺序。`range(n)`我们可以通过使用合适的键函数进行排序来创建该排列：

```
print(sorted(range(len(seq)), key=lambda k: seq[k])) 
```

**输出**

```
[4, 2, 3, 5, 1, 0] 
```

我们可以`lambda`通过使用`seq`'s`.__getitem__`方法来避免这种情况：

```
sorted(range(len(seq)), key=seq.__getitem__) 
```

这只是稍微快一点，但我们正在寻找我们可以获得的所有速度增强。;)

* * *

下面的代码[`timeit`](https://docs.python.org/3/library/timeit.html)对这个页面上所有现有的 Python 算法进行了测试，加上我自己的一些：几个蛮力 O(n²) 版本，Niklas B 算法的一些变体，当然还有一个基于 mergesort （我写的没有参考现有的答案）。它还有我的基于列表的树排序代码，大致源自 prasadvk 的代码，以及基于基数排序的各种函数，一些使用与归并排序方法类似的策略，还有一些使用`sum`或 Fenwick 树。

该程序在一系列随机整数列表上测量每个函数的执行时间；它还可以验证每个函数是否给出与其他函数相同的结果，并且它不会修改输入列表。

每个`timeit`调用都会给出一个包含 3 个结果的向量，我对其进行排序。此处要查看的主要值是最小值，其他值仅指示该最小值的可靠性，如[模块文档中的注释中](https://docs.python.org/3/library/timeit.html#timeit.Timer.repeat)[所述`timeit`](https://docs.python.org/3/library/timeit.html#timeit.Timer.repeat)。

不幸的是，该程序的输出太大而无法包含在此答案中，因此我将其发布在[其自己的（社区维基）答案](https://stackoverflow.com/a/47925603/4014959)中。

输出来自我在旧的 Debian 衍生发行版上运行 Python 3.6.0 的古老 32 位单核 2GHz 机器上的 3 次运行。YMMV。在测试期间，我关闭了 Web 浏览器并断开了与路由器的连接，以尽量减少其他任务对 CPU 的影响。

第一次运行测试列表大小从 5 到 320 的所有函数，循环大小从 4096 到 64（随着列表大小加倍，循环大小减半）。用于构建每个列表的随机池是列表本身大小的一半，因此我们可能会得到*很多*重复项。一些反转计数算法比其他算法对重复更敏感。

第二次运行使用更大的列表：640 到 10240，以及 8 的固定循环大小。为了节省时间，它消除了测试中几个最慢的函数。我的蛮力 O(n²) 函数在这些大小*上*太慢了，而且如前所述，我使用的代码`sum`在中小型列表上表现良好，但无法跟上大列表。

最终运行涵盖从 20480 到 655360 的列表大小，以及 4 的固定循环大小，以及 8 个最快的函数。对于 40,000 左右的列表大小，Tim Babych 的代码显然是赢家。干得好蒂姆！Niklas B 的代码也是一个很好的全能表现者，尽管它在较小的列表中被击败。“python”的基于二分法的代码也做得相当好，虽然它看起来有点慢，有大量重复的列表，可能是由于`while`它使用线性循环来跳过欺骗。

但是，对于非常大的列表大小，基于二分法的算法无法与真正的 O(nlogn) 算法竞争。

```
#!/usr/bin/env python3

''' Test speeds of various ways of counting inversions in a list

    The inversion count is a measure of how sorted an array is.
    A pair of items in a are inverted if i < j but a[j] > a[i]

    See https://stackoverflow.com/questions/337664/counting-inversions-in-an-array

    This program contains code by the following authors:
    mkso
    Niklas B
    B. M.
    Tim Babych
    python
    Zhe Hu
    prasadvk
    noman pouigt
    PM 2Ring

    Timing and verification code by PM 2Ring
    Collated 2017.12.16
    Updated 2017.12.21
'''

from timeit import Timer
from random import seed, randrange
from bisect import bisect, insort_left

seed('A random seed string')

# Merge sort version by mkso
def count_inversion_mkso(lst):
    return merge_count_inversion(lst)[1]

def merge_count_inversion(lst):
    if len(lst) <= 1:
        return lst, 0
    middle = len(lst) // 2
    left, a = merge_count_inversion(lst[:middle])
    right, b = merge_count_inversion(lst[middle:])
    result, c = merge_count_split_inversion(left, right)
    return result, (a + b + c)

def merge_count_split_inversion(left, right):
    result = []
    count = 0
    i, j = 0, 0
    left_len = len(left)
    while i < left_len and j < len(right):
        if left[i] <= right[j]:
            result.append(left[i])
            i += 1
        else:
            result.append(right[j])
            count += left_len - i
            j += 1
    result += left[i:]
    result += right[j:]
    return result, count

# . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
# Using a Binary Indexed Tree, aka a Fenwick tree, by Niklas B.
def count_inversions_NiklasB(a):
    res = 0
    counts = [0] * (len(a) + 1)
    rank = {v: i for i, v in enumerate(sorted(a), 1)}
    for x in reversed(a):
        i = rank[x] - 1
        while i:
            res += counts[i]
            i -= i & -i
        i = rank[x]
        while i <= len(a):
            counts[i] += 1
            i += i & -i
    return res

# . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
# Merge sort version by B.M
# Modified by PM 2Ring to deal with the global counter
bm_count = 0

def merge_count_BM(seq):
    global bm_count
    bm_count = 0
    sort_bm(seq)
    return bm_count

def merge_bm(l1,l2):
    global bm_count
    l = []
    while l1 and l2:
        if l1[-1] <= l2[-1]:
            l.append(l2.pop())
        else:
            l.append(l1.pop())
            bm_count += len(l2)
    l.reverse()
    return l1 + l2 + l

def sort_bm(l):
    t = len(l) // 2
    return merge_bm(sort_bm(l[:t]), sort_bm(l[t:])) if t > 0 else l

# . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
# Bisection based method by Tim Babych
def solution_TimBabych(A):
    sorted_left = []
    res = 0
    for i in range(1, len(A)):
        insort_left(sorted_left, A[i-1])
        # i is also the length of sorted_left
        res += (i - bisect(sorted_left, A[i]))
    return res

# Slightly faster, except for very small lists
def solutionE_TimBabych(A):
    res = 0
    sorted_left = []
    for i, u in enumerate(A):
        # i is also the length of sorted_left
        res += (i - bisect(sorted_left, u))
        insort_left(sorted_left, u)
    return res

# . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
# Bisection based method by "python"
def solution_python(A):
    B = list(A)
    B.sort()
    inversion_count = 0
    for i in range(len(A)):
        j = binarySearch_python(B, A[i])
        while B[j] == B[j - 1]:
            if j < 1:
                break
            j -= 1
        inversion_count += j
        B.pop(j)
    return inversion_count

def binarySearch_python(alist, item):
    first = 0
    last = len(alist) - 1
    found = False
    while first <= last and not found:
        midpoint = (first + last) // 2
        if alist[midpoint] == item:
            return midpoint
        else:
            if item < alist[midpoint]:
                last = midpoint - 1
            else:
                first = midpoint + 1

# . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
# Merge sort version by Zhe Hu
def inv_cnt_ZheHu(a):
    _, count = inv_cnt(a.copy())
    return count

def inv_cnt(a):
    n = len(a)
    if n==1:
        return a, 0
    left = a[0:n//2] # should be smaller
    left, cnt1 = inv_cnt(left)
    right = a[n//2:] # should be larger
    right, cnt2 = inv_cnt(right)

    cnt = 0
    i_left = i_right = i_a = 0
    while i_a < n:
        if (i_right>=len(right)) or (i_left < len(left)
            and left[i_left] <= right[i_right]):
            a[i_a] = left[i_left]
            i_left += 1
        else:
            a[i_a] = right[i_right]
            i_right += 1
            if i_left < len(left):
                cnt += len(left) - i_left
        i_a += 1
    return (a, cnt1 + cnt2 + cnt)

# . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
# Merge sort version by noman pouigt
# From https://stackoverflow.com/q/47830098
def reversePairs_nomanpouigt(nums):
    def merge(left, right):
        if not left or not right:
            return (0, left + right)
        #if everything in left is less than right
        if left[len(left)-1] < right[0]:
            return (0, left + right)
        else:
            left_idx, right_idx, count = 0, 0, 0
            merged_output = []

            # check for condition before we merge it
            while left_idx < len(left) and right_idx < len(right):
                #if left[left_idx] > 2 * right[right_idx]:
                if left[left_idx] > right[right_idx]:
                    count += len(left) - left_idx
                    right_idx += 1
                else:
                    left_idx += 1

            #merging the sorted list
            left_idx, right_idx = 0, 0
            while left_idx < len(left) and right_idx < len(right):
                if left[left_idx] > right[right_idx]:
                    merged_output += [right[right_idx]]
                    right_idx += 1
                else:
                    merged_output += [left[left_idx]]
                    left_idx += 1
            if left_idx == len(left):
                merged_output += right[right_idx:]
            else:
                merged_output += left[left_idx:]
        return (count, merged_output)

    def partition(nums):
        count = 0
        if len(nums) == 1 or not nums:
            return (0, nums)
        pivot = len(nums)//2
        left_count, l = partition(nums[:pivot])
        right_count, r = partition(nums[pivot:])
        temp_count, temp_list = merge(l, r)
        return (temp_count + left_count + right_count, temp_list)
    return partition(nums)[0]

# . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
# PM 2Ring
def merge_PM2R(seq):
    seq, count = merge_sort_count_PM2R(seq)
    return count

def merge_sort_count_PM2R(seq):
    mid = len(seq) // 2
    if mid == 0:
        return seq, 0
    left, left_total = merge_sort_count_PM2R(seq[:mid])
    right, right_total = merge_sort_count_PM2R(seq[mid:])
    total = left_total + right_total
    result = []
    i = j = 0
    left_len, right_len = len(left), len(right)
    while i < left_len and j < right_len:
        if left[i] <= right[j]:
            result.append(left[i])
            i += 1
        else:
            result.append(right[j])
            j += 1
            total += left_len - i
    result.extend(left[i:])
    result.extend(right[j:])
    return result, total

def rank_sum_PM2R(a):
    total = 0
    counts = [0] * len(a)
    rank = {v: i for i, v in enumerate(sorted(a))}
    for u in reversed(a):
        i = rank[u]
        total += sum(counts[:i])
        counts[i] += 1
    return total

# Fenwick tree functions adapted from C code on Wikipedia
def fen_sum(tree, i):
    ''' Return the sum of the first i elements, 0 through i-1 '''
    total = 0
    while i:
        total += tree[i-1]
        i -= i & -i
    return total

def fen_add(tree, delta, i):
    ''' Add delta to element i and thus 
        to fen_sum(tree, j) for all j > i 
    '''
    size = len(tree)
    while i < size:
        tree[i] += delta
        i += (i+1) & -(i+1)

def fenwick_PM2R(a):
    total = 0
    counts = [0] * len(a)
    rank = {v: i for i, v in enumerate(sorted(a))}
    for u in reversed(a):
        i = rank[u]
        total += fen_sum(counts, i)
        fen_add(counts, 1, i)
    return total

def fenwick_inline_PM2R(a):
    total = 0
    size = len(a)
    counts = [0] * size
    rank = {v: i for i, v in enumerate(sorted(a))}
    for u in reversed(a):
        i = rank[u]
        j = i + 1
        while i:
            total += counts[i]
            i -= i & -i
        while j < size:
            counts[j] += 1
            j += j & -j
    return total

def bruteforce_loops_PM2R(a):
    total = 0
    for i in range(1, len(a)):
        u = a[i]
        for j in range(i):
            if a[j] > u:
                total += 1
    return total

def bruteforce_sum_PM2R(a):
    return sum(1 for i in range(1, len(a)) for j in range(i) if a[j] > a[i])

# Using binary tree counting, derived from C++ code (?) by prasadvk
# https://stackoverflow.com/a/16056139
def ltree_count_PM2R(a):
    total, root = 0, None
    for u in a:
        # Store data in a list-based tree structure
        # [data, count, left_child, right_child]
        p = [u, 0, None, None]
        if root is None:
            root = p
            continue
        q = root
        while True:
            if p[0] < q[0]:
                total += 1 + q[1]
                child = 2
            else:
                q[1] += 1
                child = 3
            if q[child]:
                q = q[child]
            else:
                q[child] = p
                break
    return total

# Counting based on radix sort, recursive version
def radix_partition_rec(a, L):
    if len(a) < 2:
        return 0
    if len(a) == 2:
        return a[1] < a[0]
    left, right = [], []
    count = 0
    for u in a:
        if u & L:
            right.append(u)
        else:
            count += len(right)
            left.append(u)
    L >>= 1
    if L:
        count += radix_partition_rec(left, L) + radix_partition_rec(right, L)
    return count

# The following functions determine swaps using a permutation of 
# range(len(a)) that has the same inversion count as `a`. We can create
# this permutation with `sorted(range(len(a)), key=lambda k: a[k])`
# but `sorted(range(len(a)), key=a.__getitem__)` is a little faster.

# Counting based on radix sort, iterative version
def radix_partition_iter(seq, L):
    count = 0
    parts = [seq]
    while L and parts:
        newparts = []
        for a in parts:
            if len(a) < 2:
                continue
            if len(a) == 2:
                count += a[1] < a[0]
                continue
            left, right = [], []
            for u in a:
                if u & L:
                    right.append(u)
                else:
                    count += len(right)
                    left.append(u)
            if left:
                newparts.append(left)
            if right:
                newparts.append(right)
        parts = newparts
        L >>= 1
    return count

def perm_radixR_PM2R(a):
    size = len(a)
    b = sorted(range(size), key=a.__getitem__)
    n = size.bit_length() - 1
    return radix_partition_rec(b, 1 << n)

def perm_radixI_PM2R(a):
    size = len(a)
    b = sorted(range(size), key=a.__getitem__)
    n = size.bit_length() - 1
    return radix_partition_iter(b, 1 << n)

# Plain sum of the counts of the permutation
def perm_sum_PM2R(a):
    total = 0
    size = len(a)
    counts = [0] * size
    for i in reversed(sorted(range(size), key=a.__getitem__)):
        total += sum(counts[:i])
        counts[i] = 1
    return total

# Fenwick sum of the counts of the permutation
def perm_fenwick_PM2R(a):
    total = 0
    size = len(a)
    counts = [0] * size
    for i in reversed(sorted(range(size), key=a.__getitem__)):
        j = i + 1
        while i:
            total += counts[i]
            i -= i & -i
        while j < size:
            counts[j] += 1
            j += j & -j
    return total

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# All the inversion-counting functions
funcs = (
    solution_TimBabych,
    solutionE_TimBabych,
    solution_python,
    count_inversion_mkso,
    count_inversions_NiklasB,
    merge_count_BM,
    inv_cnt_ZheHu,
    reversePairs_nomanpouigt,
    fenwick_PM2R,
    fenwick_inline_PM2R,
    merge_PM2R,
    rank_sum_PM2R,
    bruteforce_loops_PM2R,
    bruteforce_sum_PM2R,
    ltree_count_PM2R,
    perm_radixR_PM2R,
    perm_radixI_PM2R,
    perm_sum_PM2R,
    perm_fenwick_PM2R,
)

def time_test(seq, loops, verify=False):
    orig = seq
    timings = []
    for func in funcs:
        seq = orig.copy()
        value = func(seq) if verify else None
        t = Timer(lambda: func(seq))
        result = sorted(t.repeat(3, loops))
        timings.append((result, func.__name__, value))
        assert seq==orig, 'Sequence altered by {}!'.format(func.__name__)
    first = timings[0][-1]
    timings.sort()
    for result, name, value in timings:
        result = ', '.join([format(u, '.5f') for u in result])
        print('{:24} : {}'.format(name, result))

    if verify:
        # Check that all results are identical
        bad = ['%s: %d' % (name, value)
            for _, name, value in timings if value != first]
        if bad:
            print('ERROR. Value: {}, bad: {}'.format(first, ', '.join(bad)))
        else:
            print('Value: {}'.format(first))
    print()

#Run the tests
size, loops = 5, 1 << 12
verify = True
for _ in range(7):
    hi = size // 2
    print('Size = {}, hi = {}, {} loops'.format(size, hi, loops))
    seq = [randrange(hi) for _ in range(size)]
    time_test(seq, loops, verify)
    loops >>= 1
    size <<= 1

#size, loops = 640, 8
#verify = False
#for _ in range(5):
    #hi = size // 2
    #print('Size = {}, hi = {}, {} loops'.format(size, hi, loops))
    #seq = [randrange(hi) for _ in range(size)]
    #time_test(seq, loops, verify)
    #size <<= 1

#size, loops = 163840, 4
#verify = False
#for _ in range(3):
    #hi = size // 2
    #print('Size = {}, hi = {}, {} loops'.format(size, hi, loops))
    #seq = [randrange(hi) for _ in range(size)]
    #time_test(seq, loops, verify)
    #size <<= 1 
```

[请在此处查看输出](https://stackoverflow.com/a/47925603/4014959)

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2015-04-04T20:38:12.243

通过分析归并排序中的归并过程，可以找到反转的次数： ![合并过程](https://i.stack.imgur.com/W46dU.png)

将元素从第二个数组复制到合并数组（本例中的 9）时，它相对于其他元素保持其位置。当将一个元素从第一个数组复制到合并数组（这里是 5）时，它会被反转，所有元素都留在第二个数组中（3 和 4 的 2 次反转）。所以对归并排序稍加修改就可以解决 O(n ln n) 中的问题。
例如，只需取消注释下面的 mergesort python 代码中的两行 # 即可进行计数。

```
def merge(l1,l2):
    l = []
    # global count
    while l1 and l2:
        if l1[-1] <= l2[-1]:
            l.append(l2.pop())
        else:
            l.append(l1.pop())
            # count += len(l2)
    l.reverse()
    return l1 + l2 + l

def sort(l): 
    t = len(l) // 2
    return merge(sort(l[:t]), sort(l[t:])) if t > 0 else l

count=0
print(sort([5,1,2,4,9,3]), count)
# [1, 2, 3, 4, 5, 9] 6 
```

**编辑 1**

使用稳定版本的快速排序可以完成相同的任务，已知速度稍快：

```
def part(l):
    pivot=l[-1]
    small,big = [],[]
    count = big_count = 0
    for x in l:
        if x <= pivot:
            small.append(x)
            count += big_count
        else:
            big.append(x)
            big_count += 1
    return count,small,big

def quick_count(l):
    if len(l)<2 : return 0
    count,small,big = part(l)
    small.pop()
    return count + quick_count(small) + quick_count(big) 
```

选择枢轴作为最后一个元素，反转被很好地计算，并且执行时间比上面的合并要好 40%。

**编辑 2**

对于 python 中的性能，一个 numpy 和 numba 版本：

首先是 numpy 部分，它使用 argsort O (n ln n) ：

```
def count_inversions(a):
    n = a.size
    counts = np.arange(n) & -np.arange(n)  # The BIT
    ags = a.argsort(kind='mergesort')    
    return  BIT(ags,counts,n) 
```

[以及有效的BIT 方法](https://stackoverflow.com/questions/337664/counting-inversions-in-an-array/23201616#23201616)的 numba 部分：

```
@numba.njit
def BIT(ags,counts,n):
    res = 0        
    for x in ags :
        i = x
        while i:
            res += counts[i]
            i -= i & -i
        i = x+1
        while i < n:
            counts[i] -= 1
            i += i & -i
    return  res 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2012-06-19T00:16:49.640

请注意，杰弗里欧文的答案是错误的。

> 数组中的反转次数是必须移动的总距离的一半，以便对数组进行排序。因此，它可以通过对数组进行排序，保持结果排列 p[i]，然后计算 abs(p[i]-i)/2 的和来计算。这需要 O(n log n) 时间，这是最优的。
> 
> [http://mathworld.wolfram.com/PermutationInversion.html](http://mathworld.wolfram.com/PermutationInversion.html)提供了另一种方法。该方法等价于 max(0, p[i]-i) 之和，它等于 abs(p[i]-i])/2 之和，因为元素向左移动的总距离等于总距离元素向右移动。

以序列 { 3, 2, 1 } 为例。有三个反转：(3, 2), (3, 1), (2, 1)，所以反转数是 3。但是，根据引用的方法，答案应该是 2。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2011-02-11T10:44:17.677

看看这个：[http ://www.cs.jhu.edu/~xfliu/600.363_F03/hw_solution/solution1.pdf](http://www.cs.jhu.edu/~xfliu/600.363_F03/hw_solution/solution1.pdf)

我希望它会给你正确的答案。

*   2-3 反转部分（d）
*   它的运行时间是 O(nlogn)

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2013-04-17T09:15:18.207

这是一种具有二叉树变化的可能解决方案。它将一个名为 rightSubTreeSize 的字段添加到每个树节点。继续按照它们在数组中出现的顺序将数字插入二叉树。如果 number 为节点的 lhs，则该元素的反转计数将为 (1 + rightSubTreeSize)。由于所有这些元素都大于当前元素，并且它们会更早地出现在数组中。如果元素去到一个节点的rhs，只需增加它的rightSubTreeSize。以下是代码。

```
Node { 
    int data;
    Node* left, *right;
    int rightSubTreeSize;

    Node(int data) { 
        rightSubTreeSize = 0;
    }   
};

Node* root = null;
int totCnt = 0;
for(i = 0; i < n; ++i) { 
    Node* p = new Node(a[i]);
    if(root == null) { 
        root = p;
        continue;
    } 

    Node* q = root;
    int curCnt = 0;
    while(q) { 
        if(p->data <= q->data) { 
            curCnt += 1 + q->rightSubTreeSize;
            if(q->left) { 
                q = q->left;
            } else { 
                q->left = p;
                break;
            }
        } else { 
            q->rightSubTreeSize++;
            if(q->right) { 
                q = q->right;
            } else { 
                q->right = p;
                break;
            }
        }
    }

    totCnt += curCnt;
  }
  return totCnt; 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2013-07-24T07:18:42.217

```
public static int mergeSort(int[] a, int p, int r)
{
    int countInversion = 0;
    if(p < r)
    {
        int q = (p + r)/2;
        countInversion = mergeSort(a, p, q);
        countInversion += mergeSort(a, q+1, r);
        countInversion += merge(a, p, q, r);
    }
    return countInversion;
}

public static int merge(int[] a, int p, int q, int r)
{
    //p=0, q=1, r=3
    int countingInversion = 0;
    int n1 = q-p+1;
    int n2 = r-q;
    int[] temp1 = new int[n1+1];
    int[] temp2 = new int[n2+1];
    for(int i=0; i<n1; i++) temp1[i] = a[p+i];
    for(int i=0; i<n2; i++) temp2[i] = a[q+1+i];

    temp1[n1] = Integer.MAX_VALUE;
    temp2[n2] = Integer.MAX_VALUE;
    int i = 0, j = 0;

    for(int k=p; k<=r; k++)
    {
        if(temp1[i] <= temp2[j])
        {
            a[k] = temp1[i];
            i++;
        }
        else
        {
            a[k] = temp2[j];
            j++;
            countingInversion=countingInversion+(n1-i); 
        }
    }
    return countingInversion;
}
public static void main(String[] args)
{
    int[] a = {1, 20, 6, 4, 5};
    int countInversion = mergeSort(a, 0, a.length-1);
    System.out.println(countInversion);
} 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2017-12-21T13:02:18.047

此答案包含我的[主要答案](https://stackoverflow.com/a/47845960/4014959)`timeit`中的代码生成的测试结果。详情请看那个答案！

```
count_inversions speed test results

Size = 5, hi = 2, 4096 loops
ltree_count_PM2R         : 0.04871, 0.04872, 0.04876
bruteforce_loops_PM2R    : 0.05696, 0.05700, 0.05776
solution_TimBabych       : 0.05760, 0.05822, 0.05943
solutionE_TimBabych      : 0.06642, 0.06704, 0.06760
bruteforce_sum_PM2R      : 0.07523, 0.07545, 0.07563
perm_sum_PM2R            : 0.09873, 0.09875, 0.09935
rank_sum_PM2R            : 0.10449, 0.10463, 0.10468
solution_python          : 0.13034, 0.13061, 0.13221
fenwick_inline_PM2R      : 0.14323, 0.14610, 0.18802
perm_radixR_PM2R         : 0.15146, 0.15203, 0.15235
merge_count_BM           : 0.16179, 0.16267, 0.16467
perm_radixI_PM2R         : 0.16200, 0.16202, 0.16768
perm_fenwick_PM2R        : 0.16887, 0.16920, 0.17075
merge_PM2R               : 0.18262, 0.18271, 0.18418
count_inversions_NiklasB : 0.19183, 0.19279, 0.20388
count_inversion_mkso     : 0.20060, 0.20141, 0.20398
inv_cnt_ZheHu            : 0.20815, 0.20841, 0.20906
fenwick_PM2R             : 0.22109, 0.22137, 0.22379
reversePairs_nomanpouigt : 0.29620, 0.29689, 0.30293
Value: 5

Size = 10, hi = 5, 2048 loops
solution_TimBabych       : 0.05954, 0.05989, 0.05991
solutionE_TimBabych      : 0.05970, 0.05972, 0.05998
perm_sum_PM2R            : 0.07517, 0.07519, 0.07520
ltree_count_PM2R         : 0.07672, 0.07677, 0.07684
bruteforce_loops_PM2R    : 0.07719, 0.07724, 0.07817
rank_sum_PM2R            : 0.08587, 0.08823, 0.08864
bruteforce_sum_PM2R      : 0.09470, 0.09472, 0.09484
solution_python          : 0.13126, 0.13154, 0.13185
perm_radixR_PM2R         : 0.14239, 0.14320, 0.14474
perm_radixI_PM2R         : 0.14632, 0.14669, 0.14679
fenwick_inline_PM2R      : 0.16796, 0.16831, 0.17030
perm_fenwick_PM2R        : 0.18189, 0.18212, 0.18638
merge_count_BM           : 0.19816, 0.19870, 0.19948
count_inversions_NiklasB : 0.21807, 0.22031, 0.22215
merge_PM2R               : 0.22037, 0.22048, 0.26106
fenwick_PM2R             : 0.24290, 0.24314, 0.24744
count_inversion_mkso     : 0.24895, 0.24899, 0.25205
inv_cnt_ZheHu            : 0.26253, 0.26259, 0.26590
reversePairs_nomanpouigt : 0.35711, 0.35762, 0.35973
Value: 20

Size = 20, hi = 10, 1024 loops
solutionE_TimBabych      : 0.05687, 0.05696, 0.05720
solution_TimBabych       : 0.06126, 0.06151, 0.06168
perm_sum_PM2R            : 0.06875, 0.06906, 0.07054
rank_sum_PM2R            : 0.07988, 0.07995, 0.08002
ltree_count_PM2R         : 0.11232, 0.11239, 0.11257
bruteforce_loops_PM2R    : 0.12553, 0.12584, 0.12592
solution_python          : 0.13472, 0.13540, 0.13694
bruteforce_sum_PM2R      : 0.15820, 0.15849, 0.16021
perm_radixI_PM2R         : 0.17101, 0.17148, 0.17229
perm_radixR_PM2R         : 0.17891, 0.18087, 0.18366
perm_fenwick_PM2R        : 0.20554, 0.20708, 0.21412
fenwick_inline_PM2R      : 0.21161, 0.21163, 0.22047
merge_count_BM           : 0.24125, 0.24261, 0.24565
count_inversions_NiklasB : 0.25712, 0.25754, 0.25778
merge_PM2R               : 0.26477, 0.26566, 0.31297
fenwick_PM2R             : 0.28178, 0.28216, 0.29069
count_inversion_mkso     : 0.30286, 0.30290, 0.30652
inv_cnt_ZheHu            : 0.32024, 0.32041, 0.32447
reversePairs_nomanpouigt : 0.45812, 0.45822, 0.46172
Value: 98

Size = 40, hi = 20, 512 loops
solutionE_TimBabych      : 0.05784, 0.05787, 0.05958
solution_TimBabych       : 0.06452, 0.06475, 0.06479
perm_sum_PM2R            : 0.07254, 0.07261, 0.07263
rank_sum_PM2R            : 0.08537, 0.08540, 0.08572
ltree_count_PM2R         : 0.11744, 0.11749, 0.11792
solution_python          : 0.14262, 0.14285, 0.14465
perm_radixI_PM2R         : 0.18774, 0.18776, 0.18922
perm_radixR_PM2R         : 0.19425, 0.19435, 0.19609
bruteforce_loops_PM2R    : 0.21500, 0.21511, 0.21686
perm_fenwick_PM2R        : 0.23338, 0.23375, 0.23674
fenwick_inline_PM2R      : 0.24947, 0.24958, 0.25189
bruteforce_sum_PM2R      : 0.27627, 0.27646, 0.28041
merge_count_BM           : 0.28059, 0.28128, 0.28294
count_inversions_NiklasB : 0.28557, 0.28759, 0.29022
merge_PM2R               : 0.29886, 0.29928, 0.30317
fenwick_PM2R             : 0.30241, 0.30259, 0.35237
count_inversion_mkso     : 0.34252, 0.34356, 0.34441
inv_cnt_ZheHu            : 0.37468, 0.37569, 0.37847
reversePairs_nomanpouigt : 0.50725, 0.50770, 0.50943
Value: 369

Size = 80, hi = 40, 256 loops
solutionE_TimBabych      : 0.06339, 0.06373, 0.06513
solution_TimBabych       : 0.06984, 0.06994, 0.07009
perm_sum_PM2R            : 0.09171, 0.09172, 0.09186
rank_sum_PM2R            : 0.10468, 0.10474, 0.10500
ltree_count_PM2R         : 0.14416, 0.15187, 0.18541
solution_python          : 0.17415, 0.17423, 0.17451
perm_radixI_PM2R         : 0.20676, 0.20681, 0.20936
perm_radixR_PM2R         : 0.21671, 0.21695, 0.21736
perm_fenwick_PM2R        : 0.26197, 0.26252, 0.26264
fenwick_inline_PM2R      : 0.28111, 0.28249, 0.28382
count_inversions_NiklasB : 0.31746, 0.32448, 0.32451
merge_count_BM           : 0.31964, 0.33842, 0.35276
merge_PM2R               : 0.32890, 0.32941, 0.33322
fenwick_PM2R             : 0.34355, 0.34377, 0.34873
count_inversion_mkso     : 0.37689, 0.37698, 0.38079
inv_cnt_ZheHu            : 0.42923, 0.42941, 0.43249
bruteforce_loops_PM2R    : 0.43544, 0.43601, 0.43902
bruteforce_sum_PM2R      : 0.52106, 0.52160, 0.52531
reversePairs_nomanpouigt : 0.57805, 0.58156, 0.58252
Value: 1467

Size = 160, hi = 80, 128 loops
solutionE_TimBabych      : 0.06766, 0.06784, 0.06963
solution_TimBabych       : 0.07433, 0.07489, 0.07516
perm_sum_PM2R            : 0.13143, 0.13175, 0.13179
rank_sum_PM2R            : 0.14428, 0.14440, 0.14922
solution_python          : 0.20072, 0.20076, 0.20084
ltree_count_PM2R         : 0.20314, 0.20583, 0.24776
perm_radixI_PM2R         : 0.23061, 0.23078, 0.23525
perm_radixR_PM2R         : 0.23894, 0.23915, 0.24234
perm_fenwick_PM2R        : 0.30984, 0.31181, 0.31503
fenwick_inline_PM2R      : 0.31933, 0.32680, 0.32722
merge_count_BM           : 0.36003, 0.36387, 0.36409
count_inversions_NiklasB : 0.36796, 0.36814, 0.37106
merge_PM2R               : 0.36847, 0.36848, 0.37127
fenwick_PM2R             : 0.37833, 0.37847, 0.38095
count_inversion_mkso     : 0.42746, 0.42747, 0.43184
inv_cnt_ZheHu            : 0.48969, 0.48974, 0.49293
reversePairs_nomanpouigt : 0.67791, 0.68157, 0.72420
bruteforce_loops_PM2R    : 0.82816, 0.83175, 0.83282
bruteforce_sum_PM2R      : 1.03322, 1.03378, 1.03562
Value: 6194

Size = 320, hi = 160, 64 loops
solutionE_TimBabych      : 0.07467, 0.07470, 0.07483
solution_TimBabych       : 0.08036, 0.08066, 0.08077
perm_sum_PM2R            : 0.21142, 0.21201, 0.25766
solution_python          : 0.22410, 0.22644, 0.22897
rank_sum_PM2R            : 0.22820, 0.22851, 0.22877
ltree_count_PM2R         : 0.24424, 0.24595, 0.24645
perm_radixI_PM2R         : 0.25690, 0.25710, 0.26191
perm_radixR_PM2R         : 0.26501, 0.26504, 0.26729
perm_fenwick_PM2R        : 0.33483, 0.33507, 0.33845
fenwick_inline_PM2R      : 0.34413, 0.34484, 0.35153
merge_count_BM           : 0.39875, 0.39919, 0.40302
fenwick_PM2R             : 0.40434, 0.40439, 0.40845
merge_PM2R               : 0.40814, 0.41531, 0.51417
count_inversions_NiklasB : 0.41681, 0.42009, 0.42128
count_inversion_mkso     : 0.47132, 0.47192, 0.47385
inv_cnt_ZheHu            : 0.54468, 0.54750, 0.54893
reversePairs_nomanpouigt : 0.76164, 0.76389, 0.80357
bruteforce_loops_PM2R    : 1.59125, 1.60430, 1.64131
bruteforce_sum_PM2R      : 2.03734, 2.03834, 2.03975
Value: 24959

Run 2

Size = 640, hi = 320, 8 loops
solutionE_TimBabych      : 0.04135, 0.04374, 0.04575
ltree_count_PM2R         : 0.06738, 0.06758, 0.06874
perm_radixI_PM2R         : 0.06928, 0.06943, 0.07019
fenwick_inline_PM2R      : 0.07850, 0.07856, 0.08059
perm_fenwick_PM2R        : 0.08151, 0.08162, 0.08170
perm_sum_PM2R            : 0.09122, 0.09133, 0.09221
rank_sum_PM2R            : 0.09549, 0.09603, 0.11270
merge_count_BM           : 0.10733, 0.10807, 0.11032
count_inversions_NiklasB : 0.12460, 0.19865, 0.20205
solution_python          : 0.13514, 0.13585, 0.13814

Size = 1280, hi = 640, 8 loops
solutionE_TimBabych      : 0.04714, 0.04742, 0.04752
perm_radixI_PM2R         : 0.15325, 0.15388, 0.15525
solution_python          : 0.15709, 0.15715, 0.16076
fenwick_inline_PM2R      : 0.16048, 0.16160, 0.16403
ltree_count_PM2R         : 0.16213, 0.16238, 0.16428
perm_fenwick_PM2R        : 0.16408, 0.16416, 0.16449
count_inversions_NiklasB : 0.19755, 0.19833, 0.19897
merge_count_BM           : 0.23736, 0.23793, 0.23912
perm_sum_PM2R            : 0.32946, 0.32969, 0.33277
rank_sum_PM2R            : 0.34637, 0.34756, 0.34858

Size = 2560, hi = 1280, 8 loops
solutionE_TimBabych      : 0.10898, 0.11005, 0.11025
perm_radixI_PM2R         : 0.33345, 0.33352, 0.37656
ltree_count_PM2R         : 0.34670, 0.34786, 0.34833
perm_fenwick_PM2R        : 0.34816, 0.34879, 0.35214
fenwick_inline_PM2R      : 0.36196, 0.36455, 0.36741
solution_python          : 0.36498, 0.36637, 0.40887
count_inversions_NiklasB : 0.42274, 0.42745, 0.42995
merge_count_BM           : 0.50799, 0.50898, 0.50917
perm_sum_PM2R            : 1.27773, 1.27897, 1.27951
rank_sum_PM2R            : 1.29728, 1.30389, 1.30448

Size = 5120, hi = 2560, 8 loops
solutionE_TimBabych      : 0.26914, 0.26993, 0.27253
perm_radixI_PM2R         : 0.71416, 0.71634, 0.71753
perm_fenwick_PM2R        : 0.71976, 0.72078, 0.72078
fenwick_inline_PM2R      : 0.72776, 0.72804, 0.73143
ltree_count_PM2R         : 0.81972, 0.82043, 0.82290
solution_python          : 0.83714, 0.83756, 0.83962
count_inversions_NiklasB : 0.87282, 0.87395, 0.92087
merge_count_BM           : 1.09496, 1.09584, 1.10207
rank_sum_PM2R            : 5.02564, 5.06277, 5.06666
perm_sum_PM2R            : 5.09088, 5.12999, 5.13512

Size = 10240, hi = 5120, 8 loops
solutionE_TimBabych      : 0.71556, 0.71718, 0.72201
perm_radixI_PM2R         : 1.54785, 1.55096, 1.55515
perm_fenwick_PM2R        : 1.55103, 1.55353, 1.59298
fenwick_inline_PM2R      : 1.57118, 1.57240, 1.57271
ltree_count_PM2R         : 1.76240, 1.76247, 1.80944
count_inversions_NiklasB : 1.86543, 1.86851, 1.87208
solution_python          : 2.01490, 2.01519, 2.06423
merge_count_BM           : 2.35215, 2.35301, 2.40023
rank_sum_PM2R            : 20.07048, 20.08399, 20.13200
perm_sum_PM2R            : 20.10187, 20.12551, 20.12683

Run 3
Size = 20480, hi = 10240, 4 loops
solutionE_TimBabych      : 1.07636, 1.08243, 1.09569
perm_radixI_PM2R         : 1.59579, 1.60519, 1.61785
perm_fenwick_PM2R        : 1.66885, 1.68549, 1.71109
fenwick_inline_PM2R      : 1.72073, 1.72752, 1.77217
ltree_count_PM2R         : 1.96900, 1.97820, 2.02578
count_inversions_NiklasB : 2.03257, 2.05005, 2.18548
merge_count_BM           : 2.46768, 2.47377, 2.52133
solution_python          : 2.49833, 2.50179, 3.79819

Size = 40960, hi = 20480, 4 loops
solutionE_TimBabych      : 3.51733, 3.52008, 3.56996
perm_radixI_PM2R         : 3.51736, 3.52365, 3.56459
perm_fenwick_PM2R        : 3.76097, 3.80900, 3.87974
fenwick_inline_PM2R      : 3.95099, 3.96300, 3.99748
ltree_count_PM2R         : 4.49866, 4.54652, 5.39716
count_inversions_NiklasB : 4.61851, 4.64303, 4.73026
merge_count_BM           : 5.31945, 5.35378, 5.35951
solution_python          : 6.78756, 6.82911, 6.98217

Size = 81920, hi = 40960, 4 loops
perm_radixI_PM2R         : 7.68723, 7.71986, 7.72135
perm_fenwick_PM2R        : 8.52404, 8.53349, 8.53710
fenwick_inline_PM2R      : 8.97082, 8.97561, 8.98347
ltree_count_PM2R         : 10.01142, 10.01426, 10.03216
count_inversions_NiklasB : 10.60807, 10.62424, 10.70425
merge_count_BM           : 11.42149, 11.42342, 11.47003
solutionE_TimBabych      : 12.83390, 12.83485, 12.89747
solution_python          : 19.66092, 19.67067, 20.72204

Size = 163840, hi = 81920, 4 loops
perm_radixI_PM2R         : 17.14153, 17.16885, 17.22240
perm_fenwick_PM2R        : 19.25944, 19.27844, 20.27568
fenwick_inline_PM2R      : 19.78221, 19.80219, 19.80766
ltree_count_PM2R         : 22.42240, 22.43259, 22.48837
count_inversions_NiklasB : 22.97341, 23.01516, 23.98052
merge_count_BM           : 24.42683, 24.48559, 24.51488
solutionE_TimBabych      : 60.96006, 61.20145, 63.71835
solution_python          : 73.75132, 73.79854, 73.95874

Size = 327680, hi = 163840, 4 loops
perm_radixI_PM2R         : 36.56715, 36.60221, 37.05071
perm_fenwick_PM2R        : 42.21616, 42.21838, 42.26053
fenwick_inline_PM2R      : 43.04987, 43.09075, 43.13287
ltree_count_PM2R         : 49.87400, 50.08509, 50.69292
count_inversions_NiklasB : 50.74591, 50.75012, 50.75551
merge_count_BM           : 52.37284, 52.51491, 53.43003
solutionE_TimBabych      : 373.67198, 377.03341, 377.42360
solution_python          : 411.69178, 411.92691, 412.83856

Size = 655360, hi = 327680, 4 loops
perm_radixI_PM2R         : 78.51927, 78.66327, 79.46325
perm_fenwick_PM2R        : 90.64711, 90.80328, 91.76126
fenwick_inline_PM2R      : 93.32482, 93.39086, 94.28880
count_inversions_NiklasB : 107.74393, 107.80036, 108.71443
ltree_count_PM2R         : 109.11328, 109.23592, 110.18247
merge_count_BM           : 111.05633, 111.07840, 112.05861
solutionE_TimBabych      : 1830.46443, 1836.39960, 1849.53918
solution_python          : 1911.03692, 1912.04484, 1914.69786 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2012-11-29T21:27:31.580

由于这是一个老问题，我将在 C 中提供我的答案。

```
#include <stdio.h>

int count = 0;
int inversions(int a[], int len);
void mergesort(int a[], int left, int right);
void merge(int a[], int left, int mid, int right);

int main() {
  int a[] = { 1, 5, 2, 4, 0 };
  printf("%d\n", inversions(a, 5));
}

int inversions(int a[], int len) {
  mergesort(a, 0, len - 1);
  return count;
}

void mergesort(int a[], int left, int right) {
  if (left < right) {
     int mid = (left + right) / 2;
     mergesort(a, left, mid);
     mergesort(a, mid + 1, right);
     merge(a, left, mid, right);
  }
}

void merge(int a[], int left, int mid, int right) {
  int i = left;
  int j = mid + 1;
  int k = 0;
  int b[right - left + 1];
  while (i <= mid && j <= right) {
     if (a[i] <= a[j]) {
       b[k++] = a[i++];
     } else {
       printf("right element: %d\n", a[j]);
       count += (mid - i + 1);
       printf("new count: %d\n", count);
       b[k++] = a[j++];
     }
  }
  while (i <= mid)
    b[k++] = a[i++];
  while (j <= right)
    b[k++] = a[j++];
  for (i = left, k = 0; i <= right; i++, k++) {
    a[i] = b[k];
  }
} 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2014-02-16T18:12:03.343

另一个 Python 解决方案，简短的。利用内置的 bisect 模块，该模块提供了将元素插入其在已排序数组中的位置以及在已排序数组中查找元素索引的功能。

这个想法是将第 n 个左侧的元素存储在这样的数组中，这将使我们能够轻松找到大于第 n 个的元素的数量。

```
import bisect
def solution(A):
    sorted_left = []
    res = 0
    for i in xrange(1, len(A)):
        bisect.insort_left(sorted_left, A[i-1])
        # i is also the length of sorted_left
        res += (i - bisect.bisect(sorted_left, A[i]))
    return res 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2014-11-25T18:00:12.410

这是c ++解决方案

```
/**
*array sorting needed to verify if first arrays n'th element is greater than sencond arrays
*some element then all elements following n will do the same
*/
#include<stdio.h>
#include<iostream>
using namespace std;
int countInversions(int array[],int size);
int merge(int arr1[],int size1,int arr2[],int size2,int[]);
int main()
{
    int array[] = {2, 4, 1, 3, 5};
    int size = sizeof(array) / sizeof(array[0]);
    int x = countInversions(array,size);
    printf("number of inversions = %d",x);
}

int countInversions(int array[],int size)
{
    if(size > 1 )
    {
    int mid = size / 2;
    int count1 = countInversions(array,mid);
    int count2 = countInversions(array+mid,size-mid);
    int temp[size];
    int count3 = merge(array,mid,array+mid,size-mid,temp);
    for(int x =0;x<size ;x++)
    {
        array[x] = temp[x];
    }
    return count1 + count2 + count3;
    }else{
        return 0;
    }
}

int merge(int arr1[],int size1,int arr2[],int size2,int temp[])
{
    int count  = 0;
    int a = 0;
    int b = 0;
    int c = 0;
    while(a < size1 && b < size2)
    {
        if(arr1[a] < arr2[b])
        {
            temp[c] = arr1[a];
            c++;
            a++;
        }else{
            temp[c] = arr2[b];
            b++;
            c++;
            count = count + size1 -a;
        }
    }

    while(a < size1)
    {
        temp[c] = arr1[a];
        c++;a++;
    }

while(b < size2)
    {
        temp[c] = arr2[b];
        c++;b++;
    }

    return count;
} 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2019-11-22T08:20:09.957

大多数答案都是基于，`MergeSort`但这并不是解决这个问题的唯一方法`O(nlogn)`

我将讨论几种方法。

1.  用一个`Balanced Binary Search Tree`

    *   增强您的树以存储重复元素的频率。
    *   这个想法是当树从根遍历到叶以进行插入时，继续计算更大的节点。

像这样的东西。

```
Node *insert(Node* root, int data, int& count){
    if(!root) return new Node(data);
    if(root->data == data){
        root->freq++;
        count += getSize(root->right);
    }
    else if(root->data > data){
        count += getSize(root->right) + root->freq;
        root->left = insert(root->left, data, count);
    }
    else root->right = insert(root->right, data, count);
    return balance(root);
}

int getCount(int *a, int n){
    int c = 0;
    Node *root = NULL;
    for(auto i=0; i<n; i++) root = insert(root, a[i], c);
    return c;
} 
```

2.  用一个`Binary Indexed Tree`
    *   创建一个求和 BIT。
    *   从末尾循环并开始查找更大元素的计数。

```
int getInversions(int[] a) {
    int n = a.length, inversions = 0;
    int[] bit = new int[n+1];
    compress(a);
    BIT b = new BIT();
    for (int i=n-1; i>=0; i--) {
         inversions += b.getSum(bit, a[i] - 1);
         b.update(bit, n, a[i], 1);
     }
     return inversions;
} 
```

3.  用一个`Segment Tree`
    *   创建一个求和段树。
    *   从数组末尾循环并在`[0, a[i]-1]`和更新之间进行查询`a[i] with 1`

```
int getInversions(int *a, int n) {
    int N = n + 1, c = 0;
    compress(a, n);
    int tree[N<<1] = {0};
    for (int i=n-1; i>=0; i--) {
        c+= query(tree, N, 0, a[i] - 1);
        update(tree, N, a[i], 1);
    }
    return c;
} 
```

另外，使用时`BIT`还是`Segment-Tree`一个好主意`Coordinate compression`

```
void compress(int *a, int n) {
    int temp[n];
    for (int i=0; i<n; i++) temp[i] = a[i];
    sort(temp, temp+n);
    for (int i=0; i<n; i++) a[i] = lower_bound(temp, temp+n, a[i]) - temp + 1;
} 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-12-03T16:31:38.787

简单的 O(n^2) 答案是使用嵌套的 for 循环并为每次反转增加一个计数器

```
int counter = 0;

for(int i = 0; i < n - 1; i++)
{
    for(int j = i+1; j < n; j++)
    {
        if( A[i] > A[j] )
        {
            counter++;
        }
    }
}

return counter; 
```

现在我想你想要一个更有效的解决方案，我会考虑的。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2013-03-09T15:46:45.487

这是计数反转的C代码

```
#include <stdio.h>
#include <stdlib.h>

int  _mergeSort(int arr[], int temp[], int left, int right);
int merge(int arr[], int temp[], int left, int mid, int right);

/* This function sorts the input array and returns the
   number of inversions in the array */
int mergeSort(int arr[], int array_size)
{
    int *temp = (int *)malloc(sizeof(int)*array_size);
    return _mergeSort(arr, temp, 0, array_size - 1);
}

/* An auxiliary recursive function that sorts the input array and
  returns the number of inversions in the array. */
int _mergeSort(int arr[], int temp[], int left, int right)
{
  int mid, inv_count = 0;
  if (right > left)
  {
    /* Divide the array into two parts and call _mergeSortAndCountInv()
       for each of the parts */
    mid = (right + left)/2;

    /* Inversion count will be sum of inversions in left-part, right-part
      and number of inversions in merging */
    inv_count  = _mergeSort(arr, temp, left, mid);
    inv_count += _mergeSort(arr, temp, mid+1, right);

    /*Merge the two parts*/
    inv_count += merge(arr, temp, left, mid+1, right);
  }
  return inv_count;
}

/* This funt merges two sorted arrays and returns inversion count in
   the arrays.*/
int merge(int arr[], int temp[], int left, int mid, int right)
{
  int i, j, k;
  int inv_count = 0;

  i = left; /* i is index for left subarray*/
  j = mid;  /* i is index for right subarray*/
  k = left; /* i is index for resultant merged subarray*/
  while ((i <= mid - 1) && (j <= right))
  {
    if (arr[i] <= arr[j])
    {
      temp[k++] = arr[i++];
    }
    else
    {
      temp[k++] = arr[j++];

     /*this is tricky -- see above explanation/diagram for merge()*/
      inv_count = inv_count + (mid - i);
    }
  }

  /* Copy the remaining elements of left subarray
   (if there are any) to temp*/
  while (i <= mid - 1)
    temp[k++] = arr[i++];

  /* Copy the remaining elements of right subarray
   (if there are any) to temp*/
  while (j <= right)
    temp[k++] = arr[j++];

  /*Copy back the merged elements to original array*/
  for (i=left; i <= right; i++)
    arr[i] = temp[i];

  return inv_count;
}

/* Driver progra to test above functions */
int main(int argv, char** args)
{
  int arr[] = {1, 20, 6, 4, 5};
  printf(" Number of inversions are %d \n", mergeSort(arr, 5));
  getchar();
  return 0;
} 
```

这里给出了详细的解释：[http ://www.geeksforgeeks.org/counting-inversions/](http://www.geeksforgeeks.org/counting-inversions/)

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2014-07-12T18:19:28.113

java中的O(n log n)时间，O(n)空间解。

合并排序，通过调整来保留合并步骤中执行的反转次数。（对于一个很好解释的合并排序，请查看[http://www.vogella.com/tutorials/JavaAlgorithmsMergesort/article.html](http://www.vogella.com/tutorials/JavaAlgorithmsMergesort/article.html)）

由于可以就地进行归并排序，空间复杂度可以提高到 O(1)。

使用这种排序时，反转仅发生在合并步骤中，并且仅当我们必须将第二部分的元素放在前半部分的元素之前时，例如

*   0 5 10 15

合并

*   1 6 22

我们有 3 + 2 + 0 = 5 次反转：

*   1 与 {5, 10, 15}
*   6 与 {10, 15}
*   22 与 {}

在我们进行了 5 次反转之后，我们新的合并列表是 0、1、5、6、10、15、22

Codility 上有一个名为 ArrayInversionCount 的演示任务，您可以在其中测试您的解决方案。

```
 public class FindInversions {

    public static int solution(int[] input) {
        if (input == null)
            return 0;
        int[] helper = new int[input.length];
        return mergeSort(0, input.length - 1, input, helper);
    }

    public static int mergeSort(int low, int high, int[] input, int[] helper) {
        int inversionCount = 0;
        if (low < high) {
            int medium = low + (high - low) / 2;
            inversionCount += mergeSort(low, medium, input, helper);
            inversionCount += mergeSort(medium + 1, high, input, helper);
            inversionCount += merge(low, medium, high, input, helper);
        }
        return inversionCount;
    }

    public static int merge(int low, int medium, int high, int[] input, int[] helper) {
        int inversionCount = 0;

        for (int i = low; i <= high; i++)
            helper[i] = input[i];

        int i = low;
        int j = medium + 1;
        int k = low;

        while (i <= medium && j <= high) {
            if (helper[i] <= helper[j]) {
                input[k] = helper[i];
                i++;
            } else {
                input[k] = helper[j];
                // the number of elements in the first half which the j element needs to jump over.
                // there is an inversion between each of those elements and j.
                inversionCount += (medium + 1 - i);
                j++;
            }
            k++;
        }

        // finish writing back in the input the elements from the first part
        while (i <= medium) {
            input[k] = helper[i];
            i++;
            k++;
        }
        return inversionCount;
    }

} 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2015-01-29T19:03:04.880

这是 O(n*log(n)) perl 实现：

```
sub sort_and_count {
    my ($arr, $n) = @_;
    return ($arr, 0) unless $n > 1;

    my $mid = $n % 2 == 1 ? ($n-1)/2 : $n/2;
    my @left = @$arr[0..$mid-1];
    my @right = @$arr[$mid..$n-1];

    my ($sleft, $x) = sort_and_count( \@left, $mid );
    my ($sright, $y) = sort_and_count( \@right, $n-$mid);
    my ($merged, $z) = merge_and_countsplitinv( $sleft, $sright, $n );

    return ($merged, $x+$y+$z);
}

sub merge_and_countsplitinv {
    my ($left, $right, $n) = @_;

    my ($l_c, $r_c) = ($#$left+1, $#$right+1);
    my ($i, $j) = (0, 0);
    my @merged;
    my $inv = 0;

    for my $k (0..$n-1) {
        if ($i<$l_c && $j<$r_c) {
            if ( $left->[$i] < $right->[$j]) {
                push @merged, $left->[$i];
                $i+=1;
            } else {
                push @merged, $right->[$j];
                $j+=1;
                $inv += $l_c - $i;
            }
        } else {
            if ($i>=$l_c) {
                push @merged, @$right[ $j..$#$right ];
            } else {
                push @merged, @$left[ $i..$#$left ];
            }
            last;
        }
    }

    return (\@merged, $inv);
} 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2016-06-15T01:14:26.920

好吧，我有一个不同的解决方案，但恐怕这只适用于不同的数组元素。

```
//Code
#include <bits/stdc++.h>
using namespace std;

int main()
{
    int i,n;
    cin >> n;
    int arr[n],inv[n];
    for(i=0;i<n;i++){
        cin >> arr[i];
    }
    vector<int> v;
    v.push_back(arr[n-1]);
    inv[n-1]=0;
    for(i=n-2;i>=0;i--){
        auto it = lower_bound(v.begin(),v.end(),arr[i]); 
        //calculating least element in vector v which is greater than arr[i]
        inv[i]=it-v.begin();
        //calculating distance from starting of vector
        v.insert(it,arr[i]);
        //inserting that element into vector v
    }
    for(i=0;i<n;i++){
        cout << inv[i] << " ";
    }
    cout << endl;
    return 0;
} 
```

为了解释我的代码，我们继续从 Array 的末尾添加元素。对于任何传入的数组元素，我们找到**向量 v 中第一个元素的索引，它大于我们的传入元素**，并将该值分配给传入元素索引的反转计数. 之后，我们将该元素插入向量 v 的正确位置，以使向量 v 保持排序顺序。

```
//INPUT     
4
2 1 4 3

//OUTPUT    
1 0 1 0

//To calculate total inversion count just add up all the elements in output array 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2015-11-03T17:39:07.247

我在 Python 中的回答：

1-首先对数组进行排序并复制它。在我的程序中，B 代表排序后的数组。2-遍历原始数组（未排序），并在排序列表中找到该元素的索引。还要记下元素的索引。3-确保元素没有任何重复项，如果有，则需要将索引的值更改为-1。我的程序中的 while 条件正是这样做的。4-继续计算将您的索引值的反转，并在计算出它的反转后删除元素。

```
def binarySearch(alist, item):
    first = 0
    last = len(alist) - 1
    found = False

    while first <= last and not found:
        midpoint = (first + last)//2
        if alist[midpoint] == item:
            return midpoint
        else:
            if item < alist[midpoint]:
                last = midpoint - 1
            else:
                first = midpoint + 1

def solution(A):

    B = list(A)
    B.sort()
    inversion_count = 0
    for i in range(len(A)):
        j = binarySearch(B, A[i])
        while B[j] == B[j - 1]:
            if j < 1:
                break
            j -= 1

        inversion_count += j
        B.pop(j)

    if inversion_count > 1000000000:
        return -1
    else:
        return inversion_count

print solution([4, 10, 11, 1, 3, 9, 10]) 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2014-08-05T03:13:46.493

这是我在 Ruby 中的 O(n log n) 解决方案：

```
def solution(t)
    sorted, inversion_count = sort_inversion_count(t)
    return inversion_count
end

def sort_inversion_count(t)
    midpoint = t.length / 2
    left_half = t[0...midpoint]
    right_half = t[midpoint..t.length]

    if midpoint == 0
        return t, 0
    end

    sorted_left_half, left_half_inversion_count = sort_inversion_count(left_half)
    sorted_right_half, right_half_inversion_count = sort_inversion_count(right_half)

    sorted = []
    inversion_count = 0
    while sorted_left_half.length > 0 or sorted_right_half.length > 0
        if sorted_left_half.empty?
            sorted.push sorted_right_half.shift
        elsif sorted_right_half.empty?
            sorted.push sorted_left_half.shift
        else
            if sorted_left_half[0] > sorted_right_half[0]
                inversion_count += sorted_left_half.length
                sorted.push sorted_right_half.shift
            else
                sorted.push sorted_left_half.shift
            end
        end
    end

    return sorted, inversion_count + left_half_inversion_count + right_half_inversion_count
end 
```

还有一些测试用例：

```
require "minitest/autorun"

class TestCodility < Minitest::Test
    def test_given_example
        a = [-1, 6, 3, 4, 7, 4]
        assert_equal solution(a), 4
    end

    def test_empty
        a = []
        assert_equal solution(a), 0
    end

    def test_singleton
        a = [0]
        assert_equal solution(a), 0
    end

    def test_none
        a = [1,2,3,4,5,6,7]
        assert_equal solution(a), 0
    end

    def test_all
        a = [5,4,3,2,1]
        assert_equal solution(a), 10
    end

    def test_clones
        a = [4,4,4,4,4,4]
        assert_equal solution(a), 0
    end
end 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2013-09-16T01:29:07.267

满足 O(N*log(N)) 时间复杂度要求的 C++ 中的一种可能解决方案如下。

```
#include <algorithm>

vector<int> merge(vector<int>left, vector<int>right, int &counter)
{

    vector<int> result;

    vector<int>::iterator it_l=left.begin();
    vector<int>::iterator it_r=right.begin();

    int index_left=0;

    while(it_l!=left.end() || it_r!=right.end())
    {

        // the following is true if we are finished with the left vector 
        // OR if the value in the right vector is the smaller one.

        if(it_l==left.end() || (it_r!=right.end() && *it_r<*it_l) )
        {
            result.push_back(*it_r);
            it_r++;

            // increase inversion counter
            counter+=left.size()-index_left;
        }
        else
        {
            result.push_back(*it_l);
            it_l++;
            index_left++;

        }
    }

    return result;
}

vector<int> merge_sort_and_count(vector<int> A, int &counter)
{

    int N=A.size();
    if(N==1)return A;

    vector<int> left(A.begin(),A.begin()+N/2);
    vector<int> right(A.begin()+N/2,A.end());

    left=merge_sort_and_count(left,counter);
    right=merge_sort_and_count(right,counter);

    return merge(left, right, counter);

} 
```

它与常规合并排序的区别仅在于计数器。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2017-10-21T22:29:00.923

在 Swift 中使用归并排序在数组中计数反转的实现：

请注意，交换的数量增加了

```
nSwaps += mid + 1 - iL 
```

（即数组左侧的相对长度减去左侧当前元素的索引）

...因为这是数组右侧的元素必须跳过的元素数（反转数）才能排序。

```
func merge(arr: inout [Int], arr2: inout [Int], low: Int, mid: Int, high: Int) -> Int {
    var nSwaps = 0;

    var i = low;
    var iL = low;
    var iR = mid + 1;

    while iL <= mid && iR <= high {
        if arr2[iL] <= arr2[iR] {
            arr[i] = arr2[iL]
            iL += 1
            i += 1
        } else {
            arr[i] = arr2[iR]
            nSwaps += mid + 1 - iL
            iR += 1
            i += 1
        }
    }

    while iL <= mid {
        arr[i] = arr2[iL]
        iL += 1
        i += 1
    }

    while iR <= high {
        arr[i] = arr2[iR]
        iR += 1
        i += 1
    }

    return nSwaps
}

func mergeSort(arr: inout [Int]) -> Int {
    var arr2 = arr
    let nSwaps = mergeSort(arr: &arr, arr2: &arr2, low: 0, high: arr.count-1)
    return nSwaps
}

func mergeSort(arr: inout [Int], arr2: inout [Int], low: Int, high: Int) -> Int {

    if low >= high {
        return 0
    }

    let mid = low + ((high - low) / 2)

    var nSwaps = 0;
    nSwaps += mergeSort(arr: &arr2, arr2: &arr, low: low, high: mid)
    nSwaps += mergeSort(arr: &arr2, arr2: &arr, low: mid+1, high: high)
    nSwaps += merge(arr: &arr, arr2: &arr2, low: low, mid: mid, high: high)

    return nSwaps
}

var arrayToSort: [Int] = [2, 1, 3, 1, 2]
let nSwaps = mergeSort(arr: &arrayToSort)

print(arrayToSort) // [1, 1, 2, 2, 3]
print(nSwaps) // 4 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2016-08-02T12:37:49.470

最好的优化方法是通过合并排序来解决它，我们可以通过比较左右数组来检查需要多少反转。每当左侧数组中的元素大于右侧数组中的元素时，它将被反转。

**合并排序方法：-**

这是代码。代码与合并排序完全相同，除了`mergeToParent`我在其他条件下计算反转的方法下的代码片段`(left[leftunPicked] < right[rightunPicked])`

```
public class TestInversionThruMergeSort {

    static int count =0;

    public static void main(String[] args) {
        int[] arr = {6, 9, 1, 14, 8, 12, 3, 2};

        partition(arr);

        for (int i = 0; i < arr.length; i++) {

            System.out.println(arr[i]);
        }

        System.out.println("inversions are "+count);

    }

    public static void partition(int[] arr) {

        if (arr.length > 1) {

            int mid = (arr.length) / 2;
            int[] left = null;

            if (mid > 0) {
                left = new int[mid];

                for (int i = 0; i < mid; i++) {
                    left[i] = arr[i];
                }
            }

            int[] right = new int[arr.length - left.length];

            if ((arr.length - left.length) > 0) {
                int j = 0;
                for (int i = mid; i < arr.length; i++) {
                    right[j] = arr[i];
                    ++j;
                }
            }

            partition(left);
            partition(right);
            mergeToParent(left, right, arr);
        }

    }

    public static void mergeToParent(int[] left, int[] right, int[] parent) {

        int leftunPicked = 0;
        int rightunPicked = 0;
        int parentIndex = -1;

        while (rightunPicked < right.length && leftunPicked < left.length) {

            if (left[leftunPicked] < right[rightunPicked]) {
                parent[++parentIndex] = left[leftunPicked];
                ++leftunPicked;

            } else {
                count = count + left.length-leftunPicked;
                if ((rightunPicked < right.length)) {
                    parent[++parentIndex] = right[rightunPicked];
                    ++rightunPicked;
                }
            }

        }

        while (leftunPicked < left.length) {
            parent[++parentIndex] = left[leftunPicked];
            ++leftunPicked;
        }

        while (rightunPicked < right.length) {
            parent[++parentIndex] = right[rightunPicked];
            ++rightunPicked;
        }

    }

} 
```

**我们可以将输入数组与排序数组进行比较的另一种方法：-** 暗黑破坏神答案的这个实现。虽然这不应该是首选方法，因为从数组或列表中删除 n 个元素是 log(n^2)。

```
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collections;
import java.util.Iterator;
import java.util.List;

public class TestInversion {

    public static void main(String[] args) {

        Integer [] arr1 = {6, 9, 1, 14, 8, 12, 3, 2};

        List<Integer> arr = new ArrayList(Arrays.asList(arr1));
        List<Integer> sortArr = new ArrayList<Integer>();

        for(int i=0;i<arr.size();i++){
            sortArr.add(arr.get(i));

        }

        Collections.sort(sortArr);

        int inversion = 0;

        Iterator<Integer> iter = arr.iterator();

        while(iter.hasNext()){

            Integer el = (Integer)iter.next();
            int index = sortArr.indexOf(el);

            if(index+1 > 1){
                inversion = inversion + ((index+1)-1);
            }

            //iter.remove();
            sortArr.remove(el);

        }

        System.out.println("Inversions are "+inversion);

    }

} 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2017-03-28T07:49:24.390

一个大小列表可能的最大反转次数`n`可以通过一个表达式来概括：

```
maxPossibleInversions = (n * (n-1) ) / 2 
```

因此，对于一个大小最大可能的反转数组，`6`将等于`15`.

为了实现复杂性，`n logn`我们可以在归并排序上搭载逆向算法。

以下是通用步骤：

*   将数组一分为二
*   调用mergeSort 例程。如果左子数组中的元素大于右子数组中的元素`inversionCount += leftSubArray.length`

而已！

这是一个简单的示例，我使用 Javascript 制作：

```
var arr = [6,5,4,3,2,1]; // Sample input array

var inversionCount = 0;

function mergeSort(arr) {
    if(arr.length == 1)
        return arr;

    if(arr.length > 1) {
        let breakpoint = Math.ceil((arr.length/2));
        // Left list starts with 0, breakpoint-1
        let leftList = arr.slice(0,breakpoint);
        // Right list starts with breakpoint, length-1
        let rightList = arr.slice(breakpoint,arr.length);

        // Make a recursive call
        leftList = mergeSort(leftList);
        rightList = mergeSort(rightList);

        var a = merge(leftList,rightList);
        return a;
    }
}

function merge(leftList,rightList) {
    let result = [];
    while(leftList.length && rightList.length) {
        /**
         * The shift() method removes the first element from an array
         * and returns that element. This method changes the length
         * of the array.
         */
        if(leftList[0] <= rightList[0]) {
            result.push(leftList.shift());
        }else{
            inversionCount += leftList.length;
            result.push(rightList.shift());
        }
    }

    while(leftList.length)
        result.push(leftList.shift());

    while(rightList.length)
        result.push(rightList.shift());

    console.log(result);
    return result;
}

mergeSort(arr);
console.log('Number of inversions: ' + inversionCount); 
```

* * *

## 回答 #28

> 赞同：-1
> 
> 时间：2013-11-26T13:58:43.770

我最近不得不在 R 中这样做：

```
inversionNumber <- function(x){
    mergeSort <- function(x){
        if(length(x) == 1){
            inv <- 0
        } else {
            n <- length(x)
            n1 <- ceiling(n/2)
            n2 <- n-n1
            y1 <- mergeSort(x[1:n1])
            y2 <- mergeSort(x[n1+1:n2])
            inv <- y1$inversions + y2$inversions
            x1 <- y1$sortedVector
            x2 <- y2$sortedVector
            i1 <- 1
            i2 <- 1
            while(i1+i2 <= n1+n2+1){
                if(i2 > n2 || i1 <= n1 && x1[i1] <= x2[i2]){
                    x[i1+i2-1] <- x1[i1]
                    i1 <- i1 + 1
                } else {
                    inv <- inv + n1 + 1 - i1
                    x[i1+i2-1] <- x2[i2]
                    i2 <- i2 + 1
                }
            }
        }
        return (list(inversions=inv,sortedVector=x))
    }
    r <- mergeSort(x)
    return (r$inversions)
} 
```

* * *

## 回答 #29

> 赞同：-1
> 
> 时间：2014-01-12T15:31:42.163

Java实现：

```
import java.lang.reflect.Array;
import java.util.Arrays;

public class main {

public static void main(String[] args) {
    int[] arr = {6, 9, 1, 14, 8, 12, 3, 2};
    System.out.println(findinversion(arr,0,arr.length-1));
}

public static int findinversion(int[] arr,int beg,int end) {
    if(beg >= end)
        return 0;

    int[] result = new int[end-beg+1];
    int index = 0;
    int mid = (beg+end)/2;
    int count = 0, leftinv,rightinv;
    //System.out.println("...."+beg+"   "+end+"  "+mid);
    leftinv = findinversion(arr, beg, mid);
    rightinv = findinversion(arr, mid+1, end);
    l1:
    for(int i = beg, j = mid+1; i<=mid || j<=end;/*index < result.length;*/ ) {
        if(i>mid) {
            for(;j<=end;j++)
                result[index++]=arr[j];
            break l1;
        }
        if(j>end) {
            for(;i<=mid;i++)
                result[index++]=arr[i];
            break l1;
        }
        if(arr[i] <= arr[j]) {
            result[index++]=arr[i];
            i++;    
        } else {
            System.out.println(arr[i]+"  "+arr[j]);
            count = count+ mid-i+1;
            result[index++]=arr[j];
            j++;    
        }
    }

    for(int i = 0, j=beg; i< end-beg+1; i++,j++)
        arr[j]= result[i];
    return (count+leftinv+rightinv);
    //System.out.println(Arrays.toString(arr));
}

} 
```

* * *

## 回答 #30

> 赞同：-1
> 
> 时间：2014-01-27T01:35:32.683

这是我对 Scala 的看法：

```
trait MergeSort {
  def mergeSort(ls: List[Int]): List[Int] = {
    def merge(ls1: List[Int], ls2: List[Int]): List[Int] =
      (ls1, ls2) match {
        case (_, Nil) => ls1
        case (Nil, _) => ls2
        case (lowsHead :: lowsTail, highsHead :: highsTail) =>
          if (lowsHead <= highsHead) lowsHead :: merge(lowsTail, ls2)
          else highsHead :: merge(ls1, highsTail)
      }

    ls match {
      case Nil => Nil
      case head :: Nil => ls
      case _ =>
        val (lows, highs) = ls.splitAt(ls.size / 2)
        merge(mergeSort(lows), mergeSort(highs))
    }
  }
}

object InversionCounterApp extends App with MergeSort {
  @annotation.tailrec
  def calculate(list: List[Int], sortedListZippedWithIndex: List[(Int, Int)], counter: Int = 0): Int =
    list match {
      case Nil => counter
      case head :: tail => calculate(tail, sortedListZippedWithIndex.filterNot(_._1 == 1), counter + sortedListZippedWithIndex.find(_._1 == head).map(_._2).getOrElse(0))
    }

  val list: List[Int] = List(6, 9, 1, 14, 8, 12, 3, 2)
  val sortedListZippedWithIndex: List[(Int, Int)] = mergeSort(list).zipWithIndex
  println("inversion counter = " + calculate(list, sortedListZippedWithIndex))
  // prints: inversion counter = 28 
} 
```

* * *

## 回答 #31

> 赞同：-1
> 
> 时间：2014-07-05T23:07:24.583

易懂的C代码：

```
#include<stdio.h>
#include<stdlib.h>

//To print an array
void print(int arr[],int n)
{
    int i;
    for(i=0,printf("\n");i<n;i++)
        printf("%d ",arr[i]);
    printf("\n");
}

//Merge Sort
int merge(int arr[],int left[],int right[],int l,int r)
{
    int i=0,j=0,count=0;
    while(i<l || j<r)
    {
        if(i==l)
        {
            arr[i+j]=right[j];
            j++;
        }
        else if(j==r)
        {
            arr[i+j]=left[i];
            i++;
        }
        else if(left[i]<=right[j])
        {
            arr[i+j]=left[i];
            i++;
        }
        else
        {
            arr[i+j]=right[j];
            count+=l-i;
            j++;
        }
    }
    //printf("\ncount:%d\n",count);
    return count;
}

//Inversion Finding
int inversions(int arr[],int high)
{
    if(high<1)
        return 0;

    int mid=(high+1)/2;
    int left[mid];
    int right[high-mid+1];

    int i,j;
    for(i=0;i<mid;i++)
        left[i]=arr[i];

    for(i=high-mid,j=high;j>=mid;i--,j--)
        right[i]=arr[j];

    //print(arr,high+1);
    //print(left,mid);
    //print(right,high-mid+1);

    return inversions(left,mid-1) + inversions(right,high-mid) + merge(arr,left,right,mid,high-mid+1);

}
int main()
{
    int arr[]={6,9,1,14,8,12,3,2};
    int n=sizeof(arr)/sizeof(arr[0]);
    print(arr,n);
    printf("%d ",inversions(arr,n-1));
    return 0;
} 
```

* * *

## 回答 #32

> 赞同：-1
> 
> 时间：2016-08-09T19:50:18.507

另一个 Python 解决方案

```
def inv_cnt(a):
n = len(a)
if n==1:
    return a,0
left = a[0:n//2] # should be smaller
left,cnt1 = inv_cnt(left)    
right = a[n//2:] # should be larger
right, cnt2 = inv_cnt(right)

cnt = 0    
i_left = i_right = i_a = 0
while i_a < n:
    if (i_right>=len(right)) or (i_left < len(left) and left[i_left] <= right[i_right]):
        a[i_a] = left[i_left]
        i_left += 1
    else:
        a[i_a] = right[i_right]
        i_right += 1              
        if i_left < len(left):
            cnt += len(left) - i_left        
    i_a += 1    

return (a, (cnt1 + cnt2 + cnt)) 
```

* * *

## 回答 #33

> 赞同：-1
> 
> 时间：2020-10-16T12:24:54.490

解决方案一.当有大量数字时工作得很好

```
def countInversions(arr):
 n = len(arr)
 if n == 1:
    return 0
 n1 = n // 2
 n2 = n - n1
 arr1 = arr[:n1]
 arr2 = arr[n1:]
 # print(n1,'||',n1,'||',arr1,'||',arr2)
 ans = countInversions(arr1) + countInversions(arr2)
 print(ans)
 i1 = 0
 i2 = 0
 for i in range(n):
     # print(i1,n1,i2,n2)
     if i1 < n1 and (i2 >= n2 or arr1[i1] <= arr2[i2]):
         arr[i] = arr1[i1]
         ans += i2
         i1 += 1
     elif i2 < n2:
         arr[i] = arr2[i2]
         i2 += 1
 return ans 
```

解决方案二。简单的解决方案。

```
def countInversions(arr):
      count = 0
      for i in range(len(arr)):
          for j in range(i, len(arr)):
               # print(arr[i:len(arr)])
                 if arr[i] > arr[j]:
                     print(arr[i], arr[j])
                     count += 1
      print(count) 
```

* * *

## 回答 #34

> 赞同：-1
> 
> 时间：2020-05-13T17:45:06.650

C++ Θ(n lg n) 解决方案，打印对构成反转计数。

```
int merge(vector<int>&nums , int low , int mid , int high){
    int size1 = mid - low +1;
    int size2= high - mid;
    vector<int>left;
    vector<int>right;
    for(int i = 0  ; i < size1 ; ++i){
        left.push_back(nums[low+i]);
    }
    for(int i = 0 ; i <size2 ; ++i){
        right.push_back(nums[mid+i+1]);
    }
    left.push_back(INT_MAX);
    right.push_back(INT_MAX);
    int i = 0 ;
    int j = 0;
    int start  = low;
    int inversion = 0 ;
    while(i < size1 && j < size2){
        if(left[i]<right[j]){
            nums[start] = left[i];
            start++;
            i++;
        }else{
            for(int l = i ; l < size1; ++l){
                cout<<"("<<left[l]<<","<<right[j]<<")"<<endl;
            }
            inversion += size1 - i;
            nums[start] = right[j];
            start++;
            j++;
        }
    }
    if(i == size1){
        for(int c = j ; c< size2 ; ++c){
            nums[start] = right[c];
            start++;
        }
    }
    if(j == size2){
        for(int c =  i ; c< size1 ; ++c){
            nums[start] = left[c];
            start++;
        }
    }
    return inversion;
}
int inversion_count(vector<int>& nums , int low , int high){
    if(high>low){
        int mid = low + (high-low)/2;
        int left = inversion_count(nums,low,mid);
        int right = inversion_count(nums,mid+1,high);
        int inversion = merge(nums,low,mid,high) + left + right;
        return inversion;
    }
    return 0 ;
} 
```

* * *

## 回答 #35

> 赞同：-2
> 
> 时间：2013-08-21T07:23:40.913

在 Java 中蛮力算法的运行速度比背负式合并排序算法更快，这是因为 Java 动态编译器完成了运行时优化。

对于蛮力循环滚动优化将产生更好的结果。

* * *

## 回答 #36

> 赞同：-2
> 
> 时间：2009-10-21T18:02:57.163

如果复制到输出的数字来自正确的数组，则使用合并排序，在合并步骤增量计数器中。

* * *

## 回答 #37

> 赞同：-5
> 
> 时间：2008-12-03T17:36:31.933

数组中的反转次数是必须移动的总距离的一半，以便对数组进行排序。因此，它可以通过对数组进行排序，保持结果排列 p[i]，然后计算 abs(p[i]-i)/2 的和来计算。这需要 O(n log n) 时间，这是最优的。

[http://mathworld.wolfram.com/PermutationInversion.html](http://mathworld.wolfram.com/PermutationInversion.html)提供了另一种方法。该方法等价于 max(0, p[i]-i) 之和，它等于 abs(p[i]-i])/2 之和，因为元素向左移动的总距离等于总距离元素向右移动。

编辑：这种方法是错误的（见评论），不幸的是没有办法在保留方法特征的同时修复它。

# html - 如何覆盖网页书签的标题？

> ID：337669
> 
> 赞同：1
> 
> 时间：2008-12-03T16:08:20.627
> 
> 标签：html, seo, title, bookmarks

添加书签或收藏夹时，浏览器使用页面的 TITLE 标签来自动填充书签的标题。但是，我的网页使用对 SEO 友好的标题，这些标题对用户并不友好。当浏览器制作书签时，是否有一种方法可以覆盖标题？

我知道我可以在调用 javascript 的页面上创建一个链接：

```
javascript:window.external.addFavorite("url","custom title"); 
```

但是当用户使用菜单或热键创建书签时，是否可以做类似的事情？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-03T16:21:13.393

你试图解决错误的问题。

> 但是，我的网页使用对 SEO 友好的标题，这些标题对用户并不友好

这是您需要解决的问题。您的页面标题应该是用户友好的。

老实说，如果你做得对，搜索引擎优化和用户友好的标题应该是同义词......你能发布一些例子来说明为什么你觉得它们需要如此不同吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-03T16:14:01.380

我看不出这怎么可能。浏览器获取加载的标题，即显示在页面顶部的标题。保存书签时，它不会通过代码。它只是添加 URL 并获取站点标题。

您可以检查“书签”按下是否会触发 javascript 事件，不过，我认为它不会是跨浏览器的 :)

# python - Python中的动态关键字参数？

> ID：337688
> 
> 赞同：51
> 
> 时间：2008-12-03T16:12:22.477
> 
> 标签：python

python有创建动态关键字的能力吗？

例如：

```
qset.filter(min_price__usd__range=(min_price, max_price)) 
```

我希望能够根据所选货币更改**美元部分。**

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2008-12-03T16:19:03.570

是的，它确实。`**kwargs`在函数定义中使用。

例子：

```
def f(**kwargs):
    print kwargs.keys()

f(a=2, b="b")     # -> ['a', 'b']
f(**{'d'+'e': 1}) # -> ['de'] 
```

但是你为什么需要那个？

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2008-12-03T16:22:51.427

如果我理解你的要求正确，

```
qset.filter(**{
    'min_price_' + selected_currency + '_range' :
    (min_price, max_price)}) 
```

做你需要的。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-12-03T16:22:38.790

你可以通过像这样声明你的函数来轻松地做到这一点：

```
def filter(**kwargs): 
```

您的函数现在将传递一个名为 kwargs 的字典，其中包含传递给您的函数的关键字和值。请注意，从句法上讲，这个词`kwargs`是没有意义的；这`**`是导致动态关键字行为的原因。

你也可以反过来做。如果你正在调用一个函数，并且你有一个对应于参数的字典，你可以这样做

```
someFunction(**theDictionary) 
```

还有一个较少使用的 *foo 变体，它会导致您接收一个参数数组。这类似于普通的 C 可变参数数组。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-03T16:21:43.223

是的，有点。在您的过滤器方法中，您可以声明一个收集所有未知 [关键字参数](http://www.python.org/doc/2.5.2/tut/node6.html#SECTION006720000000000000000)的通配符变量。您的方法可能如下所示：

```
def filter(self, **kwargs):
    for key,value in kwargs:
        if key.startswith('min_price__') and key.endswith('__range'):
            currency = key.replace('min_price__', '').replace('__range','')
            rate = self.current_conversion_rates[currency]
            self.setCurrencyRange(value[0]*rate, value[1]*rate) 
```

# c# - 正则表达式 - 仅替换表达式的最后一部分

> ID：337691
> 
> 赞同：1
> 
> 时间：2008-12-03T16:13:43.083
> 
> 标签：c#, regex

我试图找到找到特定模式的最佳方法，然后替换模式的结束部分。这是一个简单的示例（在 C# 中）：

//查找以括号或下划线开头的任何年份值

```
string patternToFind = "[[_]2007";

Regex yearFind = new Regex(patternToFind); 
```

//我想将这些值中的任何一个更改为 x2008，其中 x 是文本中最初的括号或下划线。我试图使用 Regex.Replace()，但无法确定它是否可以应用。

如果一切都失败了，我可以使用 MatchCollection 找到匹配项，然后用 2008 切换出 2007 值；但是，我希望有更优雅的东西

```
MatchCollections matches = yearFind.Matches(" 2007 [2007 _2007");
foreach (Match match in matches){
  //use match to find and replace value
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-03T16:17:47.253

您的模式不像描述的那样工作：如上所述，您需要以“ `\[|_`”（管道表示 OR）开头，而实际问题的解决方案是*regex grouping*。将您感兴趣的模式部分括在括号“（”和“）”中，您可以在替换器中访问它们。

因此，您需要这样的模式：`/^(\[|_)2007/`

编辑：.NET 代码

```
string s = Regex.Replace(source, @"^(\[|_)2007", @"$12008"); 
```

nb误解了要求，修改了模式

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-03T16:26:21.730

您可以将要保留的部分括在括号中以创建子匹配组。然后在替换文本中，使用反向引用将其放回原处。如果我理解您要正确执行的操作，您将执行以下操作：

```
Regex yearFind = new Regex("([[_])2007");
yearFine.Replace("_2007", @"$12008"); // => "_2008"
yearFine.Replace("[2007", @"$12008"); // => "[2008" 
```

替换文本中的“$1”将替换为括号内匹配的内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T16:23:00.987

显示替换（在这种情况下使用 vim）。如果我有一个包含以下内容的文件：

```
aaa _2007
bbb , 2007
ccc [2007] 
```

我使用正则表达式

```
:1,$ s/\([_[ ]\)\(2007\)/\12008/g 
```

第一组（在 (, ) 中）将匹配年份之前的字符，第二组将匹配 2007 年。替换在第一个匹配中替换并用 2008 覆盖第二组匹配的任何内容，给出：

```
aaa _2008
bbb , 2008
ccc [2008] 
```

不同的正则表达式库在这个原则上会有细微的语法变化。

# php - 有没有更有效的方法来创建年/月列表？

> ID：337694
> 
> 赞同：3
> 
> 时间：2008-12-03T16:14:37.027
> 
> 标签：php, language-agnostic, datetime, performance

在一个页面上，我想动态列出每年的年份和所有月份，以便可以查看每个月的存档。我想先显示当前年份，但当前年份可能还没有结束，所以我只想显示已经过去的月份和当前月份。然后我想要从今年（即 2008 年）过去的所有年份和所有月份。

我创建的完成这项工作的 PHP 代码如下。有没有更有效的方法来实现这一目标？我正在运行 PHP 5.2。

```
$current_year = date('Y');
$months = array(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12);

// Loop through all the months and create an array up to and including the current month
foreach ($months as $month)
{
    if ($month <= date('m'))
    {
        switch ($month)
        {
            case 1:
                $years[$current_year][] = 'January';
                break;
            case 2:
                $years[$current_year][] = 'February';
                break;
            case 3:
                $years[$current_year][] = 'March';
                break;
            case 4:
                $years[$current_year][] = 'April';
                break;
            case 5:
                $years[$current_year][] = 'May';
                break;
            case 6:
                $years[$current_year][] = 'June';
                break;
            case 7:
                $years[$current_year][] = 'July';
                break;
            case 8:
                $years[$current_year][] = 'August';
                break;
            case 9:
                $years[$current_year][] = 'September';
                break;
            case 10:
                $years[$current_year][] = 'October';
                break;
            case 11:
                $years[$current_year][] = 'November';
                break;
            case 12:
                $years[$current_year][] = 'December';
                break;
        }
    }
}

// Previous years
$years_to_create = $current_year - 2008;

if (!empty($years_to_create))
{
    for ($i = 1; $i <= $years_to_create; $i++)
    {
        $years[$current_year - $i] = array('January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December');
    }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-03T16:20:48.480

试试这个，它会列出过去 5 年的月/年降序列表

```
$years = 5;

for ($i = 0; $i < (12* $years); $i++)
{
    if (date('Y',strtotime("-".$i." month")) > (date('Y') - $years) )
    {
      echo date('F Y',strtotime("-".$i." month")) . '<br />'; 
    }
} 
```

然后，如果您需要它在数组中，只需像这样添加

```
$years = 5;
$myarray = array();

for ($i = 0; $i < (12* $years); $i++)
{
    if (date('Y',strtotime("-".$i." month")) > (date('Y') - $years) )
    {
         $year_key = date('Y') - date('Y',strtotime("-".$i." month")); 
         $myarray[$year_key][] = date('F',strtotime("-".$i." month"));
    }
}

//Write it out to the screen
foreach ($myarray as $yearkey=>$eachyear)
{
    foreach ($eachyear as $eachmonth)
    {   
        echo (date('Y')-$yearkey) . ' ' . $eachmonth . '<br>';
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T21:31:04.967

```
$current_year = date('Y');
$months = array(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12);
$month_names = array('January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December');

// Loop through all the months and create an array up to and including the current month

for ($month=1;$month<=date('m');$month++)
{
$years[$current_year][] = $month_names[$month-1];
}

// Previous years
$years_to_create = $current_year - 2008;

if (!empty($years_to_create))
{
    for ($i = 1; $i <= $years_to_create; $i++)
    {
        $years[$current_year - $i] = $month_names;
    }
} 
```

这似乎有点简单......它更快......？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T16:26:05.990

修改

```
function getMonthsFromYear($start = 2008, $end = null, array $months = null) {
    static $sMonths = array('January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December');
    $thisYear = intval(date('Y'));
    if (!is_array($months) || (count($months) < 12))
        $months = $sMonths;
    if (!is_int($end))
         $end = $thisYear;
    if ($end > $thisYear)
        return array_fill($start, $end - $start + 1, $months);
    if ($start < $end)
        $monthsInDuration = array_fill($start, $end - $start, $months);
    $monthsInDuration[$end] = array_slice($months, 0, (int) date('m'));
    return $monthsInDuration;
}
print_r(getMonthsFromYear());
print_r(getMonthsFromYear(2006));
print_r(getMonthsFromYear(2008, 2010)); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-13T02:26:04.140

```
$current_year = date('Y');
$month_names = array('January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December');
$years[$current_year] = array_slice($month_names, 0, date('m'));

for ($i = 2008; $i < $current_year; $i++) {
   $years[$i] = $month_names;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-03T16:18:10.843

PHP 有一个 Date() 函数和一个 mktime 函数，您可以使用它们来比较日期并从字符串中创建日期等。在不提供代码的情况下，我可以给您一个指令以某种方式进行迭代：

```
 -> Get current Year

  -> Loop the current year untill the current month is reached

     -> Print Month 
```

# apache - 配置 apache 以使用“？”处理静态资源 文件名中的字符

> ID：337698
> 
> 赞同：1
> 
> 时间：2008-12-03T16:14:51.927
> 
> 标签：apache, url, params

由于各种原因，我有一堆静态资源，都具有以下命名格式：

xxxxx?yyyyy

其中 x 是常规字母字符，y 的数字是 0-9。

Apache 在“？”处截断 GET 请求中的文件名。- 因为这传统上用于描述查询参数 - 并因此报告以下错误

找不到文件 xxxx。

我怎样才能让 Apache 不认为 y 是查询参数，实际上是静态文件名的一部分？

非常感谢您的帮助，

大学教师

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-03T16:24:24.107

如果您可以控制 URL 的输出方式，则可以转义“？” chars，这将是 %3F 而不是 '?'。因此，该 URL 将是

```
http://example.com/abcdef%3f99999 
```

# c# - 如何用简历实现一个“catch'em all”异常处理程序？

> ID：337702
> 
> 赞同：30
> 
> 时间：2008-12-03T16:15:56.137
> 
> 标签：c#, exception

我想知道如何在应用程序级别编写一个***catch'em all***异常处理程序，让用户可以选择恢复应用程序流程？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-12-03T16:28:38.217

如果您正在运行 Windows 窗体应用程序：向`Application.ThreadException`事件添加处理程序。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2008-12-03T17:36:47.783

我假设您正在编写一个 Windows 应用程序，在这种情况下，**是**的，您可以这样做。我将把你是否应该的是非留给别人。已经有足够多的答案了，我建议您**在实际执行此操作之前仔细考虑它们**。

请注意，此代码在调试器中的行为与直接运行应用程序时的行为不同（可能是另一个不这样做的原因）。要让应用程序显示消息框并在此后继续，您需要从资源管理器而不是 Visual Studio 运行应用程序。

创建一个新的 Windows 窗体应用程序。Program.cs 中的代码如下所示：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading;
using System.Windows.Forms;

namespace WindowsFormsApplication2 {
    static class Program {
        /// <summary>
        /// The main entry point for the application.
        /// </summary>
        [STAThread]
        static void Main() {
            Application.EnableVisualStyles();
            Application.SetCompatibleTextRenderingDefault(false);
            Form1 form1 = new Form1();
            Application.ThreadException += new ThreadExceptionEventHandler(form1.UnhandledThreadExceptionHandler);
            Application.Run(form1);
        }
    }
} 
```

然后让 Form1 中的代码看起来像这样：

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading;
using System.Windows.Forms;

namespace WindowsFormsApplication2 {
    public partial class Form1 : Form {
        public Form1() {
            InitializeComponent();
        }

        public void UnhandledThreadExceptionHandler(object sender, ThreadExceptionEventArgs e) {
            this.HandleUnhandledException(e.Exception);
        }

        public void HandleUnhandledException(Exception e) {
            // do what you want here.
            if (MessageBox.Show("An unexpected error has occurred. Continue?",
                "My application", MessageBoxButtons.YesNo, MessageBoxIcon.Stop,
                MessageBoxDefaultButton.Button2) == DialogResult.No) {
                Application.Exit();
            }
        }

        private void button1_Click(object sender, EventArgs e) {
            throw new ApplicationException("Exception");
        }

    }
} 
```

（将 button1 添加到表单并附加 button1_Click。）

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-12-03T16:27:52.053

这取决于您所说的“简历”是什么意思。异常的问题在于，除非您*非常*小心，否则当异常发生时，您的应用程序状态很可能已损坏——您可能已经完成了*一半*的操作。

如果您可以隔离您的操作 - 就像数据库隔离事务一样 - 那么您可以有效地让您的用户从“最后提交点”恢复。不过，这在很大程度上取决于您的应用程序的类型。您能否向我们提供有关您正在构建的应用程序类型的更多详细信息？

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-05-15T09:20:51.473

在您的 program.cs 类中使用以下代码。发生异常时会自动发送邮件。

```
using System;
using System.Windows.Forms;
using System.Net;
using System.Net.Mail;
using System.Threading; 

namespace ExceptionHandlerTest
{
    static class Program
    {
        /// <summary>
        /// The main entry point for the application.
        /// </summary>
        [STAThread]
        static void Main()
        {
            Application.ThreadException +=
                new ThreadExceptionEventHandler(Application_ThreadException);

            // Your designer generated commands.
        }

        static void Application_ThreadException(object sender, ThreadExceptionEventArgs e) 
        {

            var fromAddress = new MailAddress("your Gmail address", "Your name");
            var toAddress = new MailAddress("email address where you want to receive reports", "Your name");
            const string fromPassword = "your password";
            const string subject = "exception report";
            Exception exception = e.Exception;
            string body = exception.Message + "\n" + exception.Data + "\n" + exception.StackTrace + "\n" + exception.Source;

            var smtp = new SmtpClient
            {
                Host = "smtp.gmail.com",
                Port = 587,
                EnableSsl = true,
                DeliveryMethod = SmtpDeliveryMethod.Network,
                UseDefaultCredentials = false,
                Credentials = new NetworkCredential(fromAddress.Address, fromPassword)
            };
            using (var message = new MailMessage(fromAddress, toAddress)
            {
                Subject = subject,
                Body = body
            })
            {
                //You can also use SendAsync method instead of Send so your application begin invoking instead of waiting for send mail to complete. SendAsync(MailMessage, Object) :- Sends the specified e-mail message to an SMTP server for delivery. This method does not block the calling thread and allows the caller to pass an object to the method that is invoked when the operation completes. 
                smtp.Send(message);
            }
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-03T16:30:35.840

我不认为使用全局错误处理程序真的可行。您需要弄清楚在应用程序的不同点可以恢复哪些类型的错误，并编写特定的错误处理程序来解决发生的错误——除非您想诉诸应用程序重新启动，这可能会或可能不会起作用，具体取决于实际错误是。为了进行任何类型的恢复，您需要保存足够的状态以从已知的良好状态重新启动。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-12-03T16:53:28.337

In some versions of .NET you can actually put a catcher around the Application.Run() (you'll find this in program.cs) and this should catch all the Main Thread's exceptions however in most cases this maybe poor design and wont give you much of an opportunity to "resume". Additionally you will *always* have to manually handle any exceptions on background threads.

You can design an app to "catch all" and display a common error message and debug info, this is fine as long as you exit afterwards. What is highly discouraged is making a "resume" available to the user as this will probably give you more problems in the long-run.

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-12-03T16:57:32.433

You should read up on all the problems associated with VB's "`On Error Resume Next`" style of error handling. It sounds like you're trying to implement this for C#.

Even if you can resume from the point of where the exception is generated, this is a broken technique for error handling. There's no way for a global handler to actually be able to handle any error/exception - it can't possibly know what's required for any arbitrary situation.

You would have to set some sort of global variable, and have the mainline code continually check it for error indications (ie., use the VB technique).

I think the best you can do to recover from an error like you're describing is to catch the exception at the application level, log the problem, inform the user (and potentially generate/send some sort of problem report for you), and restart the application. Of course, if you catch the exception closer to the problem area, that handler has a chance to do something a bit more intelligent, so you should not rely on the app-level handler as a crutch - just as a fail-safe.

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2008-12-03T16:27:38.013

这只是在尖叫糟糕的设计。永远不要对这样的事情使用异常。仅当程序员不打算发生某些事情时才使用异常。

如果你想要错误处理。不要使用这样的异常，而是构建一个系统，您可以在其中保存状态并可以返回到状态等...但是使用异常进行状态处理，这是个坏主意。

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2008-12-03T16:48:17.660

[Microsoft Enterprise Library Exception Handling Application Block](http://msdn.microsoft.com/en-us/library/ff664698(v=pandp.50).aspx) has examples of how you can do this.

Basically you surround the code that can throw exceptions with this:

```
try
{
  MyMethodThatMightThrow();
}
catch(Exception ex)
{
   bool rethrow = ExceptionPolicy.HandleException(ex, "SomePolicy");
   if (rethrow) throw;
} 
```

Then you can configure the Policy to show a dialog to the user and ask if she wants to continue.

You still need to put try catch blocks around in your code at points where you believe you are at a consistent state.

# sql - 参数化 SQL IN 子句

> ID：337704
> 
> 赞同：1097
> 
> 时间：2008-12-03T16:16:43.187
> 
> 标签：sql, sql-server, parameters

如何参数化包含`IN`具有可变数量参数的子句的查询，例如这个？

```
SELECT * FROM Tags 
WHERE Name IN ('ruby','rails','scruffy','rubyonrails')
ORDER BY Count DESC 
```

在此查询中，参数的数量可以是 1 到 5 之间的任何值。

我不希望为此（或 XML）使用专用的存储过程，但如果有一些特定于[SQL Server 2008](http://en.wikipedia.org/wiki/Microsoft_SQL_Server#SQL_Server_2008)的优雅方式，我对此持开放态度。

* * *

## 回答 #1

> 赞同：752
> 
> 时间：2008-12-03T16:35:54.533

您可以参数化*每个*值，例如：

```
string[] tags = new string[] { "ruby", "rails", "scruffy", "rubyonrails" };
string cmdText = "SELECT * FROM Tags WHERE Name IN ({0})";

string[] paramNames = tags.Select(
    (s, i) => "@tag" + i.ToString()
).ToArray();

string inClause = string.Join(", ", paramNames);
using (SqlCommand cmd = new SqlCommand(string.Format(cmdText, inClause))) {
    for(int i = 0; i < paramNames.Length; i++) {
       cmd.Parameters.AddWithValue(paramNames[i], tags[i]);
    }
} 
```

这会给你：

```
cmd.CommandText = "SELECT * FROM Tags WHERE Name IN (@tag0, @tag1, @tag2, @tag3)"
cmd.Parameters["@tag0"] = "ruby"
cmd.Parameters["@tag1"] = "rails"
cmd.Parameters["@tag2"] = "scruffy"
cmd.Parameters["@tag3"] = "rubyonrails" 
```

[不，这对SQL 注入](http://en.wikipedia.org/wiki/SQL_injection)不开放。唯一注入 CommandText 的文本不是基于用户输入。它完全基于硬编码的“@tag”前缀和数组的索引。索引将*始终*是整数，不是用户生成的，并且是安全的。

用户输入的值仍然填充到参数中，因此不存在漏洞。

编辑：

> 抛开注入问题不谈，请注意构建命令文本以容纳可变数量的参数（如上）会阻碍 SQL 服务器利用缓存查询的能力。最终结果是您几乎肯定会首先失去使用参数的价值（而不是仅仅将谓词字符串插入 SQL 本身）。

并不是说缓存的查询计划没有价值，但 IMO 这个查询还不够复杂，无法从中看到很多好处。虽然编译成本可能接近（甚至超过）执行成本，但您仍然在谈论毫秒。

如果您有足够的 RAM，我希望 SQL Server 也可能会缓存一个用于常见参数计数的计划。我想你总是可以添加五个参数，让未指定的标签为 NULL - 查询计划应该是相同的，但它对我来说看起来很丑，我不确定它是否值得微优化（虽然，在 Stack Overflow 上 - 这可能非常值得）。

此外，SQL Server 7 及更高版本将[自动参数化查询](http://msdn.microsoft.com/en-us/library/aa175264(SQL.80).aspx)，因此从性能的角度来看，使用参数并不是真正必要的——然而，从安全的角度来看，它是*至关重要*的——尤其是对于像这样的用户输入数据。

* * *

## 回答 #2

> 赞同：323
> 
> 时间：2008-12-03T16:41:17.037

这是我使用的一种快速而肮脏的技术：

```
SELECT * FROM Tags
WHERE '|ruby|rails|scruffy|rubyonrails|'
LIKE '%|' + Name + '|%' 
```

所以这里是 C# 代码：

```
string[] tags = new string[] { "ruby", "rails", "scruffy", "rubyonrails" };
const string cmdText = "select * from tags where '|' + @tags + '|' like '%|' + Name + '|%'";

using (SqlCommand cmd = new SqlCommand(cmdText)) {
   cmd.Parameters.AddWithValue("@tags", string.Join("|", tags);
} 
```

两个警告：

*   表演很糟糕。`LIKE "%...%"`查询未编入索引。
*   确保您没有任何`|`、空白或空标签，否则这将不起作用

还有其他方法可以实现这一点，有些人可能会认为更清洁，所以请继续阅读。

* * *

## 回答 #3

> 赞同：256
> 
> 时间：2008-12-03T16:53:19.507

对于 SQL Server 2008，您可以使用[表值参数](http://msdn.microsoft.com/en-us/library/bb675163.aspx)。这有点工作，但可以说它比[我的其他方法](https://stackoverflow.com/questions/337704/parameterizing-a-sql-in-clause#337792)更干净。

首先，您必须创建一个类型

```
CREATE TYPE dbo.TagNamesTableType AS TABLE ( Name nvarchar(50) ) 
```

然后，您的 ADO.NET 代码如下所示：

```
string[] tags = new string[] { "ruby", "rails", "scruffy", "rubyonrails" };
cmd.CommandText = "SELECT Tags.* FROM Tags JOIN @tagNames as P ON Tags.Name = P.Name";

// value must be IEnumerable<SqlDataRecord>
cmd.Parameters.AddWithValue("@tagNames", tags.AsSqlDataRecord("Name")).SqlDbType = SqlDbType.Structured;
cmd.Parameters["@tagNames"].TypeName = "dbo.TagNamesTableType";

// Extension method for converting IEnumerable<string> to IEnumerable<SqlDataRecord>
public static IEnumerable<SqlDataRecord> AsSqlDataRecord(this IEnumerable<string> values, string columnName) {
    if (values == null || !values.Any()) return null; // Annoying, but SqlClient wants null instead of 0 rows
    var firstRecord = values.First();
    var metadata= new SqlMetaData(columnName, SqlDbType.NVarChar, 50); //50 as per SQL Type
    return values.Select(v => 
    {
       var r = new SqlDataRecord(metadata);
       r.SetValues(v);
       return r;
    });
} 
```

**根据@Doug**更新****

 **请尽量避免`var metadata = SqlMetaData.InferFromValue(firstRecord, columnName);`

它设置了第一个值的长度，因此如果第一个值是 3 个字符，则其设置的最大长度为 3，如果超过 3 个字符，其他记录将被截断。

所以，请尝试使用：`var metadata= new SqlMetaData(columnName, SqlDbType.NVarChar, maxLen);`

注意：`-1`最大长度。

* * *

## 回答 #4

> 赞同：191
> 
> 时间：2009-05-29T23:18:15.533

最初的问题是**“我如何参数化查询......”**

让我在这里声明，这不是原始问题**的答案。**在其他好的答案中已经有一些证明。

话虽如此，继续标记这个答案，否决它，将其标记为不是答案......做任何你认为是正确的事情。

请参阅 Mark Brackett 的答案，了解我（和其他 231 人）赞成的首选答案。他的回答中给出的方法允许 1) 有效使用绑定变量，以及 2) 用于 sargable 的谓词。

**选择的答案**

我想在这里解决的是 Joel Spolsky 的答案中给出的方法，答案“选择”为正确答案。

Joel Spolsky 的方法很聪明。并且它工作合理，它将表现出可预测的行为和可预测的性能，给定“正常”值，以及规范的边缘情况，例如 NULL 和空字符串。对于特定的应用程序，它可能就足够了。

但是在概括这种方法时，让我们也考虑更模糊的极端情况，例如当`Name`列包含通配符时（由 LIKE 谓词识别）。我看到最常用的通配符是`%`（百分号。）。所以让我们现在在这里处理这个问题，稍后再讨论其他情况。

**% 字符的一些问题**

考虑一个 Name 值`'pe%ter'`。（对于此处的示例，我使用文字字符串值代替列名。）以下形式的查询将返回 Name 值为 `'pe%ter' 的行：

```
select ...
 where '|peanut|butter|' like '%|' + 'pe%ter' + '|%' 
```

但如果搜索词的顺序颠倒，则**不会**返回同一行：

```
select ...
 where '|butter|peanut|' like '%|' + 'pe%ter' + '|%' 
```

我们观察到的行为有点奇怪。更改列表中搜索词的顺序会更改结果集。

几乎不用说，我们可能不想`pe%ter`搭配花生酱，不管他多么喜欢它。

**不起眼的角落案例**

（是的，我同意这是一个晦涩难懂的情况。可能不太可能被测试。我们不希望列值中有通配符。我们可以假设应用程序阻止存储这样的值。但是根据我的经验，我很少看到数据库约束明确禁止在`LIKE`比较运算符右侧被视为通配符的字符或模式。

**修补一个洞**

修补此漏洞的一种方法是转义`%`通配符。（对于不熟悉运算符上的转义子句的任何人，这里是[SQL Server 文档](http://msdn.microsoft.com/en-us/library/aa933232(SQL.80).aspx)的链接。

```
select ...
 where '|peanut|butter|'
  like '%|' + 'pe\%ter' + '|%' escape '\' 
```

现在我们可以匹配文字 %。当然，当我们有一个列名时，我们将需要动态地转义通配符。我们可以使用该`REPLACE`函数查找出现的`%`字符并在每个字符前面插入一个反斜杠字符，如下所示：

```
select ...
 where '|pe%ter|'
  like '%|' + REPLACE( 'pe%ter' ,'%','\%') + '|%' escape '\' 
```

这样就解决了 % 通配符的问题。几乎。

**逃出逃生**

我们认识到我们的解决方案引入了另一个问题。转义字符。我们看到我们还需要转义任何出现的转义字符本身。这一次，我们使用 ! 作为转义字符：

```
select ...
 where '|pe%t!r|'
  like '%|' + REPLACE(REPLACE( 'pe%t!r' ,'!','!!'),'%','!%') + '|%' escape '!' 
```

**下划线也是**

现在我们已经开始了，我们可以添加另一个`REPLACE`句柄下划线通配符。只是为了好玩，这一次，我们将使用 $ 作为转义字符。

```
select ...
 where '|p_%t!r|'
  like '%|' + REPLACE(REPLACE(REPLACE( 'p_%t!r' ,'$','$$'),'%','$%'),'_','$_') + '|%' escape '$' 
```

我更喜欢这种转义方法，因为它适用于 Oracle 和 MySQL 以及 SQL Server。（我通常使用 \ 反斜杠作为转义字符，因为这是我们在正则表达式中使用的字符。但是为什么要受约定的约束！

**那些讨厌的括号**

SQL Server 还允许通过将通配符括在方括号中来将它们视为文字`[]`。所以我们还没有完成修复，至少对于 SQL Server。由于括号对具有特殊含义，因此我们也需要将其转义。如果我们设法正确地避开括号，那么至少我们不必为括号内的连字符`-`和克拉而烦恼`^`。我们可以将括号内的任何`%`和`_`字符转义，因为我们基本上会禁用括号的特殊含义。

找到匹配的括号对应该不难。这比处理单例 % 和 _ 的出现要困难一些。（请注意，仅仅转义所有出现的括号是不够的，因为单例括号被认为是文字，不需要转义。逻辑变得有点模糊，我在不运行更多测试用例的情况下无法处理.)

**内联表达式变得混乱**

SQL 中的内联表达式越来越长，越来越难看。我们或许可以让它发挥作用，但是上天会帮助那些落后并不得不破译它的可怜的灵魂。作为内联表达式的粉丝，我倾向于不在这里使用一个，主要是因为我不想留下评论来解释混乱的原因，并为此道歉。

**一个函数在哪里？**

好的，所以，如果我们不将其作为 SQL 中的内联表达式来处理，那么我们最接近的替代方案是用户定义的函数。而且我们知道这不会加速任何事情（除非我们可以在其上定义索引，就像我们可以使用 Oracle 一样。）如果我们必须创建一个函数，我们最好在调用 SQL 的代码中这样做陈述。

并且该函数可能在行为上存在一些差异，具体取决于 DBMS 和版本。（向所有热衷于能够互换使用任何数据库引擎的 Java 开发人员大声疾呼。）

**领域知识**

我们可能对列的域有专门的知识（即为列强制执行的一组允许值。我们可能*先验地*知道存储在列中的值永远不会包含百分号、下划线或括号在这种情况下，我们只包含一个快速评论，说明这些情况已涵盖。

存储在列中的值可能允许使用 % 或 _ 字符，但约束可能要求对这些值进行转义，可能使用定义的字符，以便这些值是 LIKE 比较“安全”的。同样，快速评论一下允许的值集，特别是哪个字符用作转义字符，并采用 Joel Spolsky 的方法。

但是，在没有专业知识和保证的情况下，重要的是我们至少要考虑处理那些晦涩难懂的极端情况，并考虑行为是否合理和“符合规范”。

* * *

**其他问题重述**

我相信其他人已经充分指出了一些其他普遍考虑的关注领域：

*   [SQL 注入](http://en.wikipedia.org/wiki/SQL_injection)（获取看似用户提供的信息，并将其包含在 SQL 文本中，而不是通过绑定变量提供它们。不需要使用绑定变量，它只是阻止 SQL 注入的一种方便方法。还有其他处理方法：

*   优化器计划使用索引扫描而不是索引搜索，可能需要一个表达式或函数来转义通配符（表达式或函数上的可能索引）

*   使用文字值代替绑定变量会影响可伸缩性

* * *

**结论**

我喜欢 Joel Spolsky 的方法。这很聪明。它有效。

但一看到它，我就立即看出它有潜在的问题，让它滑落不是我的本性。我并不是要批评别人的努力。我知道许多开发人员非常重视他们的工作，因为他们在其中投入了大量资金并且非常关心它。所以请理解，这不是人身攻击。我在这里确定的是在生产中而不是在测试中出现的问题类型。

是的，我与最初的问题相去甚远。但是，关于我认为与问题的“选定”答案有关的重要问题，还有什么地方可以留下这个注释呢？

* * *

## 回答 #5

> 赞同：138
> 
> 时间：2008-12-03T16:27:11.353

您可以将参数作为字符串传递

所以你有字符串

```
DECLARE @tags

SET @tags = ‘ruby|rails|scruffy|rubyonrails’

select * from Tags 
where Name in (SELECT item from fnSplit(@tags, ‘|’))
order by Count desc 
```

然后您所要做的就是将字符串作为 1 参数传递。

这是我使用的拆分功能。

```
CREATE FUNCTION [dbo].[fnSplit](
    @sInputList VARCHAR(8000) -- List of delimited items
  , @sDelimiter VARCHAR(8000) = ',' -- delimiter that separates items
) RETURNS @List TABLE (item VARCHAR(8000))

BEGIN
DECLARE @sItem VARCHAR(8000)
WHILE CHARINDEX(@sDelimiter,@sInputList,0) <> 0
 BEGIN
 SELECT
  @sItem=RTRIM(LTRIM(SUBSTRING(@sInputList,1,CHARINDEX(@sDelimiter,@sInputList,0)-1))),
  @sInputList=RTRIM(LTRIM(SUBSTRING(@sInputList,CHARINDEX(@sDelimiter,@sInputList,0)+LEN(@sDelimiter),LEN(@sInputList))))

 IF LEN(@sItem) > 0
  INSERT INTO @List SELECT @sItem
 END

IF LEN(@sInputList) > 0
 INSERT INTO @List SELECT @sInputList -- Put the last item in
RETURN
END 
```

* * *

## 回答 #6

> 赞同：66
> 
> 时间：2008-12-19T05:40:15.740

我今天听到 Jeff/Joel 在播客上谈论这个（*[第 34 集](http://itc.conversationsnetwork.org/audio/download/ITC.SO-Episode34-2008.12.16.mp3)*，2008-12-16（MP3，31 MB），1 小时 3 分 38 秒 - 1 小时 06 分 45 秒），我想我记得 Stack Overflow正在使用[LINQ to SQL](http://en.wikipedia.org/wiki/Language_Integrated_Query#LINQ_to_SQL)，但也许它被抛弃了。在 LINQ to SQL 中也是如此。

```
var inValues = new [] { "ruby","rails","scruffy","rubyonrails" };

var results = from tag in Tags
              where inValues.Contains(tag.Name)
              select tag; 
```

就是这样。而且，是的，LINQ 看起来已经够倒退了，但`Contains`对我来说，该子句似乎更加倒退。当我不得不对工作中的项目进行类似查询时，我自然会尝试以错误的方式执行此操作，即在本地数组和 SQL Server 表之间进行连接，认为 LINQ to SQL 转换器足够聪明，可以处理以某种方式翻译。它没有，但它确实提供了一条描述性的错误消息，并指出我要使用*Contains*。

无论如何，如果您在强烈推荐的[LINQPad](http://www.linqpad.net/)中运行它并运行此查询，您可以查看 SQL LINQ 提供程序生成的实际 SQL。它将向您展示每个被参数化为`IN`子句的值。

* * *

## 回答 #7

> 赞同：53
> 
> 时间：2011-06-15T11:04:06.157

如果您从 .NET 调用，则可以使用[Dapper dot net](https://github.com/StackExchange/Dapper)：

```
string[] names = new string[] {"ruby","rails","scruffy","rubyonrails"};
var tags = dataContext.Query<Tags>(@"
select * from Tags 
where Name in @names
order by Count desc", new {names}); 
```

Dapper 在这里进行思考，因此您不必这样做。[当然，使用LINQ to SQL](http://en.wikipedia.org/wiki/Language_Integrated_Query#LINQ_to_SQL)也可以做到类似的事情：

```
string[] names = new string[] {"ruby","rails","scruffy","rubyonrails"};
var tags = from tag in dataContext.Tags
           where names.Contains(tag.Name)
           orderby tag.Count descending
           select tag; 
```

* * *

## 回答 #8

> 赞同：39
> 
> 时间：2016-05-02T10:20:19.820

在`SQL Server 2016+`你可以使用[`STRING_SPLIT`](https://msdn.microsoft.com/en-us/library/mt684588.aspx)功能：

```
DECLARE @names NVARCHAR(MAX) = 'ruby,rails,scruffy,rubyonrails';

SELECT * 
FROM Tags
WHERE Name IN (SELECT [value] FROM STRING_SPLIT(@names, ','))
ORDER BY [Count] DESC; 
```

或者：

```
DECLARE @names NVARCHAR(MAX) = 'ruby,rails,scruffy,rubyonrails';

SELECT t.*
FROM Tags t
JOIN STRING_SPLIT(@names,',')
  ON t.Name = [value]
ORDER BY [Count] DESC; 
```

**[现场演示](https://data.stackexchange.com/stackoverflow/query/481811)**

[接受](https://stackoverflow.com/a/337817/5070879)的答案当然会起作用，这是要走的路之一，但它是反模式的。

> **E. 按值列表查找行**
> 
> 这可以替代常见的反模式，例如在应用层或 Transact-SQL 中创建动态 SQL 字符串，或者使用 LIKE 运算符：
> 
> ```
> SELECT ProductId, Name, Tags
> FROM Product
> WHERE ',1,2,3,' LIKE '%,' + CAST(ProductId AS VARCHAR(20)) + ',%'; 
> ```

* * *

*附录*：

为了改进`STRING_SPLIT`表函数行估计，将拆分值具体化为临时表/表变量是一个好主意：

```
DECLARE @names NVARCHAR(MAX) = 'ruby,rails,scruffy,rubyonrails,sql';

CREATE TABLE #t(val NVARCHAR(120));
INSERT INTO #t(val) SELECT s.[value] FROM STRING_SPLIT(@names, ',') s;

SELECT *
FROM Tags tg
JOIN #t t
  ON t.val = tg.TagName
ORDER BY [Count] DESC; 
```

**[SEDE - 现场演示](https://data.stackexchange.com/stackoverflow/query/1196908?opt.withExecutionPlan=true#executionPlan)**

相关：[如何将值列表传递到存储过程](https://www.brentozar.com/archive/2020/02/how-to-pass-a-list-of-values-into-a-stored-procedure/)

* * *

^(原始问题有要求`SQL Server 2008`。因为这个问题经常被用作重复，所以我添加了这个答案作为参考。)

* * *

## 回答 #9

> 赞同：31
> 
> 时间：2008-12-03T17:04:00.563

这可能是一种半讨厌的方式，我用过一次，相当有效。

根据您的目标，它可能有用。

1.  创建一个包含一列的*临时表。*
2.  `INSERT`每个查找值到该列。
3.  `IN`然后，您可以只使用标准`JOIN`规则，而不是使用。（灵活性++）

这在您可以做的事情上增加了一些灵活性，但它更适合您有一个大表要查询、具有良好索引并且您希望多次使用参数化列表的情况。无需执行两次并手动完成所有卫生工作。

我从来没有弄清楚它到底有多*快*，但在我的情况下它是需要的。

* * *

## 回答 #10

> 赞同：25
> 
> 时间：2008-12-03T17:11:52.230

我们有一个函数可以创建一个表变量，您可以加入：

```
ALTER FUNCTION [dbo].[Fn_sqllist_to_table](@list  AS VARCHAR(8000),
                                           @delim AS VARCHAR(10))
RETURNS @listTable TABLE(
  Position INT,
  Value    VARCHAR(8000))
AS
  BEGIN
      DECLARE @myPos INT

      SET @myPos = 1

      WHILE Charindex(@delim, @list) > 0
        BEGIN
            INSERT INTO @listTable
                        (Position,Value)
            VALUES     (@myPos,LEFT(@list, Charindex(@delim, @list) - 1))

            SET @myPos = @myPos + 1

            IF Charindex(@delim, @list) = Len(@list)
              INSERT INTO @listTable
                          (Position,Value)
              VALUES     (@myPos,'')

            SET @list = RIGHT(@list, Len(@list) - Charindex(@delim, @list))
        END

      IF Len(@list) > 0
        INSERT INTO @listTable
                    (Position,Value)
        VALUES     (@myPos,@list)

      RETURN
  END 
```

所以：

```
@Name varchar(8000) = null // parameter for search values    

select * from Tags 
where Name in (SELECT value From fn_sqllist_to_table(@Name,',')))
order by Count desc 
```

* * *

## 回答 #11

> 赞同：20
> 
> 时间：2008-12-03T16:31:50.393

这很恶心，但如果你保证至少有一个，你可以这样做：

```
SELECT ...
       ...
 WHERE tag IN( @tag1, ISNULL( @tag2, @tag1 ), ISNULL( @tag3, @tag1 ), etc. ) 
```

拥有 IN('tag1', 'tag2', 'tag1', 'tag1', 'tag1' ) 将很容易被 SQL Server 优化掉。另外，您可以获得直接索引搜索

* * *

## 回答 #12

> 赞同：19
> 
> 时间：2008-12-03T16:30:13.970

我会传递一个表类型参数（因为它是[SQL Server 2008](http://en.wikipedia.org/wiki/Microsoft_SQL_Server#SQL_Server_2008)），然后执行一个`where exists`, 或内部连接。您也可以使用 XML，使用`sp_xml_preparedocument`，然后甚至索引该临时表。

* * *

## 回答 #13

> 赞同：18
> 
> 时间：2010-07-22T14:47:17.087

在我看来，解决这个问题的最佳来源是这个网站上发布的内容：

[系统评论。迪纳卡内西](http://weblogs.sqlteam.com/dinakar/archive/2007/03/28/60150.aspx)

```
CREATE FUNCTION dbo.fnParseArray (@Array VARCHAR(1000),@separator CHAR(1))
RETURNS @T Table (col1 varchar(50))
AS 
BEGIN
 --DECLARE @T Table (col1 varchar(50))  
 -- @Array is the array we wish to parse
 -- @Separator is the separator charactor such as a comma
 DECLARE @separator_position INT -- This is used to locate each separator character
 DECLARE @array_value VARCHAR(1000) -- this holds each array value as it is returned
 -- For my loop to work I need an extra separator at the end. I always look to the
 -- left of the separator character for each array value

 SET @array = @array + @separator

 -- Loop through the string searching for separtor characters
 WHILE PATINDEX('%' + @separator + '%', @array) <> 0 
 BEGIN
    -- patindex matches the a pattern against a string
    SELECT @separator_position = PATINDEX('%' + @separator + '%',@array)
    SELECT @array_value = LEFT(@array, @separator_position - 1)
    -- This is where you process the values passed.
    INSERT into @T VALUES (@array_value)    
    -- Replace this select statement with your processing
    -- @array_value holds the value of this element of the array
    -- This replaces what we just processed with and empty string
    SELECT @array = STUFF(@array, 1, @separator_position, '')
 END
 RETURN 
END 
```

采用：

```
SELECT * FROM dbo.fnParseArray('a,b,c,d,e,f', ',') 
```

**学分：Dinakar Nethi**

* * *

## 回答 #14

> 赞同：12
> 
> 时间：2009-02-04T18:51:49.297

恕我直言，正确的方法是将列表存储在字符串中（长度受 DBMS 支持的限制）；唯一的技巧是（为了简化处理）我在字符串的开头和结尾有一个分隔符（在我的例子中是逗号）。这个想法是“即时规范化”，将列表变成一个包含每个值一行的单列表。这使您可以转动

> 在 (ct1,ct2, ct3 ... ctn)

成一个

> 在（选择...）

或者（我可能更喜欢的解决方案）一个常规连接，如果你只是添加一个“distinct”来避免列表中重复值的问题。

不幸的是，分割字符串的技术是相当特定于产品的。这是 SQL Server 版本：

```
 with qry(n, names) as
       (select len(list.names) - len(replace(list.names, ',', '')) - 1 as n,
               substring(list.names, 2, len(list.names)) as names
        from (select ',Doc,Grumpy,Happy,Sneezy,Bashful,Sleepy,Dopey,' names) as list
        union all
        select (n - 1) as n,
               substring(names, 1 + charindex(',', names), len(names)) as names
        from qry
        where n > 1)
 select n, substring(names, 1, charindex(',', names) - 1) dwarf
 from qry; 
```

甲骨文版本：

```
 select n, substr(name, 1, instr(name, ',') - 1) dwarf
 from (select n,
             substr(val, 1 + instr(val, ',', 1, n)) name
      from (select rownum as n,
                   list.val
            from  (select ',Doc,Grumpy,Happy,Sneezy,Bashful,Sleepy,Dopey,' val
                   from dual) list
            connect by level < length(list.val) -
                               length(replace(list.val, ',', '')))); 
```

和 MySQL 版本：

```
select pivot.n,
      substring_index(substring_index(list.val, ',', 1 + pivot.n), ',', -1) from (select 1 as n
     union all
     select 2 as n
     union all
     select 3 as n
     union all
     select 4 as n
     union all
     select 5 as n
     union all
     select 6 as n
     union all
     select 7 as n
     union all
     select 8 as n
     union all
     select 9 as n
     union all
     select 10 as n) pivot,    (select ',Doc,Grumpy,Happy,Sneezy,Bashful,Sleepy,Dopey,' val) as list where pivot.n <  length(list.val) -
                   length(replace(list.val, ',', '')); 
```

（当然，“pivot”必须返回与我们可以在列表中找到的最大项目数一样多的行）

* * *

## 回答 #15

> 赞同：11
> 
> 时间：2012-08-15T16:32:20.070

如果您有[SQL Server 2008](http://en.wikipedia.org/wiki/Microsoft_SQL_Server#SQL_Server_2008)或更高版本，我会使用[Table Valued Parameter](https://stackoverflow.com/questions/5595353/how-to-pass-table-value-parameters-to-stored-procedure-from-net-code)。

如果你不幸被困在[SQL Server 2005](http://en.wikipedia.org/wiki/Microsoft_SQL_Server#SQL_Server_2005)上，你可以像这样添加一个[CLR](http://en.wikipedia.org/wiki/Common_Language_Runtime)函数，

```
[SqlFunction(
    DataAccessKind.None,
    IsDeterministic = true,
    SystemDataAccess = SystemDataAccessKind.None,
    IsPrecise = true,
    FillRowMethodName = "SplitFillRow",
    TableDefinintion = "s NVARCHAR(MAX)"]
public static IEnumerable Split(SqlChars seperator, SqlString s)
{
    if (s.IsNull)
        return new string[0];

    return s.ToString().Split(seperator.Buffer);
}

public static void SplitFillRow(object row, out SqlString s)
{
    s = new SqlString(row.ToString());
} 
```

你可以这样使用，

```
declare @desiredTags nvarchar(MAX);
set @desiredTags = 'ruby,rails,scruffy,rubyonrails';

select * from Tags
where Name in [dbo].[Split] (',', @desiredTags)
order by Count desc 
```

* * *

## 回答 #16

> 赞同：10
> 
> 时间：2010-06-09T20:28:50.923

我认为这是静态查询不可行的情况。为您的 in 子句动态构建列表，转义您的单引号，并动态构建 SQL。在这种情况下，由于列表很小，您可能不会看到与任何方法有太大区别，但最有效的方法确实是完全按照您的帖子中所写的方式发送 SQL。我认为以最有效的方式编写它是一个好习惯，而不是做最漂亮的代码，或者认为动态构建 SQL 是不好的做法。

我已经看到在参数变大的许多情况下，拆分函数的执行时间比查询本身要长。在 SQL 2008 中具有表值参数的存储过程是我会考虑的唯一其他选择，尽管在您的情况下这可能会更慢。如果您在 TVP 的主键上搜索，TVP 可能只会对大型列表更快，因为 SQL 无论如何都会为列表构建一个临时表（如果列表很大）。除非您对其进行测试，否则您将无法确定。

我还看到存储过程有 500 个参数，默认值为 null，并且具有 WHERE Column1 IN (@Param1、@Param2、@Param3、...、@Param500)。这导致 SQL 构建一个临时表，进行排序/区分，然后进行表扫描而不是索引查找。这基本上就是您通过参数化该查询所做的事情，尽管规模足够小，不会产生明显的差异。我强烈建议不要在您的 IN 列表中使用 NULL，因为如果将其更改为 NOT IN，它将无法按预期运行。您可以动态构建参数列表，但唯一明显的好处是对象会为您转义单引号。这种方法在应用程序端也稍微慢一些，因为对象必须解析查询才能找到参数。

重用存储过程或参数化查询的执行计划可能会给您带来性能提升，但它会将您锁定在一个由执行的第一个查询确定的执行计划中。在许多情况下，这对于后续查询可能不太理想。在您的情况下，重用执行计划可能是一个加分项，但它可能根本没有任何区别，因为该示例是一个非常简单的查询。

**悬崖笔记：**

对于您所做的任何事情，无论是在列表中使用固定数量的项目进行参数化（如果不使用，则为 null），使用或不使用参数动态构建查询，或者使用带有表值参数的存储过程不会有太大区别. 但是，我的一般建议如下：

**您的案例/简单查询，参数很少：**

动态 SQL，如果测试显示更好的性能，可能带有参数。

**具有可重用执行计划的查询，只需更改参数或查询很复杂即可多次调用：**

带有动态参数的 SQL。

**具有大列表的查询：**

具有表值参数的存储过程。如果列表可能相差很大，请在存储过程上使用 WITH RECOMPILE，或者简单地使用不带参数的动态 SQL 为每个查询生成新的执行计划。

* * *

## 回答 #17

> 赞同：10
> 
> 时间：2011-10-24T18:41:41.893

也许我们可以在这里使用 XML：

```
 declare @x xml
    set @x='<items>
    <item myvalue="29790" />
    <item myvalue="31250" />
    </items>
    ';
    With CTE AS (
         SELECT 
            x.item.value('@myvalue[1]', 'decimal') AS myvalue
        FROM @x.nodes('//items/item') AS x(item) )

    select * from YourTable where tableColumnName in (select myvalue from cte) 
```

* * *

## 回答 #18

> 赞同：9
> 
> 时间：2012-11-23T18:13:47.133

如果我们在 IN 子句中存储了以逗号 (,) 分隔的字符串，我们可以使用 charindex 函数来获取值。如果您使用 .NET，则可以使用 SqlParameters 进行映射。

**DDL 脚本：**

```
CREATE TABLE Tags
    ([ID] int, [Name] varchar(20))
;

INSERT INTO Tags
    ([ID], [Name])
VALUES
    (1, 'ruby'),
    (2, 'rails'),
    (3, 'scruffy'),
    (4, 'rubyonrails')
; 
```

**T-SQL：**

```
DECLARE @Param nvarchar(max)

SET @Param = 'ruby,rails,scruffy,rubyonrails'

SELECT * FROM Tags
WHERE CharIndex(Name,@Param)>0 
```

您可以在 .NET 代码中使用上述语句并将参数映射到 SqlParameter。

[提琴手演示](http://sqlfiddle.com/#!3/31994/3)

**编辑：** 使用以下脚本创建名为 SelectedTags 的表。

DDL 脚本：

```
Create table SelectedTags
(Name nvarchar(20));

INSERT INTO SelectedTags values ('ruby'),('rails') 
```

T-SQL：

```
DECLARE @list nvarchar(max)
SELECT @list=coalesce(@list+',','')+st.Name FROM SelectedTags st

SELECT * FROM Tags
WHERE CharIndex(Name,@Param)>0 
```

* * *

## 回答 #19

> 赞同：9
> 
> 时间：2015-06-11T15:16:32.783

默认情况下，我会通过将表值函数（从字符串返回表）传递给 IN 条件来解决此问题。

这是 UDF 的代码*（我从某个地方的 Stack Overflow 得到它，我现在找不到源代码）*

```
CREATE FUNCTION [dbo].[Split] (@sep char(1), @s varchar(8000))
RETURNS table
AS
RETURN (
    WITH Pieces(pn, start, stop) AS (
      SELECT 1, 1, CHARINDEX(@sep, @s)
      UNION ALL
      SELECT pn + 1, stop + 1, CHARINDEX(@sep, @s, stop + 1)
      FROM Pieces
      WHERE stop > 0
    )
    SELECT 
      SUBSTRING(@s, start, CASE WHEN stop > 0 THEN stop-start ELSE 512 END) AS s
    FROM Pieces
  ) 
```

一旦你得到这个，你的代码就会像这样简单：

```
select * from Tags 
where Name in (select s from dbo.split(';','ruby;rails;scruffy;rubyonrails'))
order by Count desc 
```

除非你有一个长得离谱的字符串，否则这应该适用于表索引。

如果需要，您可以将其插入临时表，对其进行索引，然后运行连接...

* * *

## 回答 #20

> 赞同：8
> 
> 时间：2010-02-12T19:22:03.213

另一种可能的解决方案是，不是将可变数量的参数传递给存储过程，而是传递一个包含您所追求的名称的字符串，但通过用“<>”将它们括起来使它们唯一。然后使用 PATINDEX 查找名称：

```
SELECT * 
FROM Tags 
WHERE PATINDEX('%<' + Name + '>%','<jo>,<john>,<scruffy>,<rubyonrails>') > 0 
```

* * *

## 回答 #21

> 赞同：8
> 
> 时间：2012-07-26T05:39:30.733

使用以下存储过程。它使用自定义拆分功能，可在[此处](http://blogs.microsoft.co.il/blogs/itai/archive/2009/02/01/t-sql-split-function.aspx)找到。

```
 create stored procedure GetSearchMachingTagNames 
    @PipeDelimitedTagNames varchar(max), 
    @delimiter char(1) 
    as  
    begin
         select * from Tags 
         where Name in (select data from [dbo].[Split](@PipeDelimitedTagNames,@delimiter) 
    end 
```

* * *

## 回答 #22

> 赞同：8
> 
> 时间：2013-04-06T02:39:54.713

这是另一种选择。只需将逗号分隔的列表作为字符串参数传递给存储过程，然后：

```
CREATE PROCEDURE [dbo].[sp_myproc]
    @UnitList varchar(MAX) = '1,2,3'
AS
select column from table
where ph.UnitID in (select * from CsvToInt(@UnitList)) 
```

和功能：

```
CREATE Function [dbo].[CsvToInt] ( @Array varchar(MAX))
returns @IntTable table
(IntValue int)
AS
begin
    declare @separator char(1)
    set @separator = ','
    declare @separator_position int
    declare @array_value varchar(MAX)

    set @array = @array + ','

    while patindex('%,%' , @array) <> 0
    begin

        select @separator_position = patindex('%,%' , @array)
        select @array_value = left(@array, @separator_position - 1)

        Insert @IntTable
        Values (Cast(@array_value as int))
        select @array = stuff(@array, 1, @separator_position, '')
    end
    return
end 
```

* * *

## 回答 #23

> 赞同：7
> 
> 时间：2008-12-03T16:31:13.967

对于像这样可变数量的参数，我知道的唯一方法是显式生成 SQL，或者执行一些涉及使用您想要的项目填充临时表并加入临时表的操作。

* * *

## 回答 #24

> 赞同：7
> 
> 时间：2008-12-10T21:54:18.770

在[ColdFusion](http://en.wikipedia.org/wiki/ColdFusion)中，我们只做：

```
<cfset myvalues = "ruby|rails|scruffy|rubyonrails">
    <cfquery name="q">
        select * from sometable where values in <cfqueryparam value="#myvalues#" list="true">
    </cfquery> 
```

* * *

## 回答 #25

> 赞同：7
> 
> 时间：2012-05-29T23:49:39.050

这是一种重新创建要在查询字符串中使用的本地表的技术。这样做可以消除所有解析问题。

该字符串可以用任何语言构建。在这个例子中，我使用了 SQL，因为那是我试图解决的原始问题。我需要一种干净的方法来在稍后执行的字符串中动态传递表数据。

使用用户定义的类型是可选的。创建类型只创建一次，可以提前完成。否则，只需在字符串中的声明中添加一个完整的表类型。

通用模式易于扩展，可用于传递更复杂的表。

```
-- Create a user defined type for the list.
CREATE TYPE [dbo].[StringList] AS TABLE(
    [StringValue] [nvarchar](max) NOT NULL
)

-- Create a sample list using the list table type.
DECLARE @list [dbo].[StringList]; 
INSERT INTO @list VALUES ('one'), ('two'), ('three'), ('four')

-- Build a string in which we recreate the list so we can pass it to exec
-- This can be done in any language since we're just building a string.
DECLARE @str nvarchar(max);
SET @str = 'DECLARE @list [dbo].[StringList]; INSERT INTO @list VALUES '

-- Add all the values we want to the string. This would be a loop in C++.
SELECT @str = @str + '(''' + StringValue + '''),' FROM @list

-- Remove the trailing comma so the query is valid sql.
SET @str = substring(@str, 1, len(@str)-1)

-- Add a select to test the string.
SET @str = @str + '; SELECT * FROM @list;'

-- Execute the string and see we've pass the table correctly.
EXEC(@str) 
```

* * *

## 回答 #26

> 赞同：7
> 
> 时间：2015-11-07T14:57:20.080

在 SQL Server 2016+ 中，另一种可能性是使用该[`OPENJSON`](https://msdn.microsoft.com/en-us/library/dn921879.aspx)函数。

这种方法在[OPENJSON 中有博客——这是通过 ids 列表选择行的最佳方法之一](http://blogs.msdn.com/b/sqlserverstorageengine/archive/2015/11/03/openjson-one-of-best-ways-to-select-rows-by-list-of-id.aspx)。

下面是一个完整的工作示例

```
CREATE TABLE dbo.Tags
  (
     Name  VARCHAR(50),
     Count INT
  )

INSERT INTO dbo.Tags
VALUES      ('VB',982), ('ruby',1306), ('rails',1478), ('scruffy',1), ('C#',1784)

GO

CREATE PROC dbo.SomeProc
@Tags VARCHAR(MAX)
AS
SELECT T.*
FROM   dbo.Tags T
WHERE  T.Name IN (SELECT J.Value COLLATE Latin1_General_CI_AS
                  FROM   OPENJSON(CONCAT('[', @Tags, ']')) J)
ORDER  BY T.Count DESC

GO

EXEC dbo.SomeProc @Tags = '"ruby","rails","scruffy","rubyonrails"'

DROP TABLE dbo.Tags 
```

* * *

## 回答 #27

> 赞同：6
> 
> 时间：2011-05-13T15:03:27.923

我有一个不需要 UDF、XML 的答案，因为 IN 接受一个选择语句，例如 SELECT * FROM Test where Data IN (SELECT Value FROM TABLE)

您实际上只需要一种将字符串转换为表格的方法。

这可以通过递归 CTE 或使用数字表（或 Master..spt_value）的查询来完成

这是 CTE 版本。

```
DECLARE @InputString varchar(8000) = 'ruby,rails,scruffy,rubyonrails'

SELECT @InputString = @InputString + ','

;WITH RecursiveCSV(x,y) 
AS 
(
    SELECT 
        x = SUBSTRING(@InputString,0,CHARINDEX(',',@InputString,0)),
        y = SUBSTRING(@InputString,CHARINDEX(',',@InputString,0)+1,LEN(@InputString))
    UNION ALL
    SELECT 
        x = SUBSTRING(y,0,CHARINDEX(',',y,0)),
        y = SUBSTRING(y,CHARINDEX(',',y,0)+1,LEN(y))
    FROM 
        RecursiveCSV 
    WHERE
        SUBSTRING(y,CHARINDEX(',',y,0)+1,LEN(y)) <> '' OR 
        SUBSTRING(y,0,CHARINDEX(',',y,0)) <> ''
)
SELECT
    * 
FROM 
    Tags
WHERE 
    Name IN (select x FROM RecursiveCSV)
OPTION (MAXRECURSION 32767); 
```

* * *

## 回答 #28

> 赞同：6
> 
> 时间：2015-03-12T18:11:18.840

[我使用投票最多的答案](https://stackoverflow.com/a/337792/16587)的更简洁版本：

```
List<SqlParameter> parameters = tags.Select((s, i) => new SqlParameter("@tag" + i.ToString(), SqlDbType.NVarChar(50)) { Value = s}).ToList();

var whereCondition = string.Format("tags in ({0})", String.Join(",",parameters.Select(s => s.ParameterName))); 
```

它确实循环了两次标签参数；但这在大多数情况下都无关紧要（它不会成为您的瓶颈；如果是，请展开循环）。

如果你真的对性能感兴趣并且不想重复循环两次，这里有一个不太漂亮的版本：

```
var parameters = new List<SqlParameter>();
var paramNames = new List<string>();
for (var i = 0; i < tags.Length; i++)  
{
    var paramName = "@tag" + i;

    //Include size and set value explicitly (not AddWithValue)
    //Because SQL Server may use an implicit conversion if it doesn't know
    //the actual size.
    var p = new SqlParameter(paramName, SqlDbType.NVarChar(50) { Value = tags[i]; } 
    paramNames.Add(paramName);
    parameters.Add(p);
}

var inClause = string.Join(",", paramNames); 
```

* * *

## 回答 #29

> 赞同：5
> 
> 时间：2013-06-03T22:54:08.533

这是这个问题的另一个答案。

（新版本于 2013 年 6 月 4 日发布）。

```
 private static DataSet GetDataSet(SqlConnectionStringBuilder scsb, string strSql, params object[] pars)
    {
        var ds = new DataSet();
        using (var sqlConn = new SqlConnection(scsb.ConnectionString))
        {
            var sqlParameters = new List<SqlParameter>();
            var replacementStrings = new Dictionary<string, string>();
            if (pars != null)
            {
                for (int i = 0; i < pars.Length; i++)
                {
                    if (pars[i] is IEnumerable<object>)
                    {
                        List<object> enumerable = (pars[i] as IEnumerable<object>).ToList();
                        replacementStrings.Add("@" + i, String.Join(",", enumerable.Select((value, pos) => String.Format("@_{0}_{1}", i, pos))));
                        sqlParameters.AddRange(enumerable.Select((value, pos) => new SqlParameter(String.Format("@_{0}_{1}", i, pos), value ?? DBNull.Value)).ToArray());
                    }
                    else
                    {
                        sqlParameters.Add(new SqlParameter(String.Format("@{0}", i), pars[i] ?? DBNull.Value));
                    }
                }
            }
            strSql = replacementStrings.Aggregate(strSql, (current, replacementString) => current.Replace(replacementString.Key, replacementString.Value));
            using (var sqlCommand = new SqlCommand(strSql, sqlConn))
            {
                if (pars != null)
                {
                    sqlCommand.Parameters.AddRange(sqlParameters.ToArray());
                }
                else
                {
                    //Fail-safe, just in case a user intends to pass a single null parameter
                    sqlCommand.Parameters.Add(new SqlParameter("@0", DBNull.Value));
                }
                using (var sqlDataAdapter = new SqlDataAdapter(sqlCommand))
                {
                    sqlDataAdapter.Fill(ds);
                }
            }
        }
        return ds;
    } 
```

干杯。

* * *

## 回答 #30

> 赞同：4
> 
> 时间：2011-04-28T21:56:21.520

唯一获胜的举措是不玩。

没有无限的可变性。只有有限的可变性。

在 SQL 中有这样的子句：

```
and ( {1}==0 or b.CompanyId in ({2},{3},{4},{5},{6}) ) 
```

在 C# 代码中，您可以执行以下操作：

```
 int origCount = idList.Count;
  if (origCount > 5) {
    throw new Exception("You may only specify up to five originators to filter on.");
  }
  while (idList.Count < 5) { idList.Add(-1); }  // -1 is an impossible value
  return ExecuteQuery<PublishDate>(getValuesInListSQL, 
               origCount,   
               idList[0], idList[1], idList[2], idList[3], idList[4]); 
```

因此，基本上如果计数为 0，则没有过滤器，一切都会通过。如果计数高于 0，则该值必须在列表中，但列表已被填充为五个不可能的值（因此 SQL 仍然有意义）

有时，蹩脚的解决方案是唯一真正有效的解决方案。

* * *

## 回答 #31

> 赞同：4
> 
> 时间：2012-08-10T14:29:44.760

这是针对同一问题的解决方案的交叉帖子。比保留分隔符更健壮 - 包括转义和嵌套数组，并理解 NULL 和空数组。

[C# & T-SQL string[] 打包/解包实用函数](https://stackoverflow.com/questions/6470944/c-sharp-t-sql-string-pack-unpack-utility-functions)

然后，您可以加入表值函数。

* * *

## 回答 #32

> 赞同：4
> 
> 时间：2014-01-12T00:32:38.367

*（编辑：如果表值参数不可用）* 最好的似乎是将大量 IN 参数拆分为多个具有固定长度的查询，因此您有许多具有固定参数计数且没有虚拟/重复值的已知 SQL 语句，也不解析字符串、XML 等。

这是我在这个主题上写的一些 C# 代码：

```
public static T[][] SplitSqlValues<T>(IEnumerable<T> values)
{
    var sizes = new int[] { 1000, 500, 250, 125, 63, 32, 16, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1 };
    int processed = 0;
    int currSizeIdx = sizes.Length - 1; /* start with last (smallest) */
    var splitLists = new List<T[]>();

    var valuesDistSort = values.Distinct().ToList(); /* remove redundant */
    valuesDistSort.Sort();
    int totalValues = valuesDistSort.Count;

    while (totalValues > sizes[currSizeIdx] && currSizeIdx > 0)
    currSizeIdx--; /* bigger size, by array pos. */

    while (processed < totalValues)
    {
        while (totalValues - processed < sizes[currSizeIdx]) 
            currSizeIdx++; /* smaller size, by array pos. */
        var partList = new T[sizes[currSizeIdx]];
        valuesDistSort.CopyTo(processed, partList, 0, sizes[currSizeIdx]);
        splitLists.Add(partList);
        processed += sizes[currSizeIdx];
    }
    return splitLists.ToArray();
} 
```

（您可能有进一步的想法，省略排序，使用 valuesDistSort.Skip(processed).Take(size[...]) 而不是 list/array CopyTo）。

插入参数变量时，您会创建如下内容：

```
foreach(int[] partList in splitLists)
{
    /* here: question mark for param variable, use named/numbered params if required */
    string sql = "select * from Items where Id in("
        + string.Join(",", partList.Select(p => "?")) 
        + ")"; /* comma separated ?, one for each partList entry */

    /* create command with sql string, set parameters, execute, merge results */
} 
```

我看过 NHibernate 对象关系映射器生成的 SQL（当查询数据以从中创建对象时），这看起来最好用多个查询。在 NHibernate 中，可以指定批量大小；如果必须获取许多对象数据行，它会尝试检索与批处理大小等效的行数

```
SELECT * FROM MyTable WHERE Id IN (@p1, @p2, @p3, ... , @p[batch-size]) 
```

，而不是发送成百上千的

```
SELECT * FROM MyTable WHERE Id=@id 
```

当剩余的 ID 小于批量大小但仍大于一个时，它会拆分为更小的语句，但仍具有一定的长度。

如果批量大小为 100，并且查询包含 118 个参数，它将创建 3 个查询：

*   一个有 100 个参数（批量），
*   然后是 12
*   另一个有 6 个，

但没有 118 或 18。这样，它将可能的 SQL 语句限制为可能的已知语句，防止太多不同的查询计划，从而防止太多的查询计划填满缓存，并且在很大程度上永远不会被重用。上面的代码做同样的事情，但长度为 1000、500、250、125、63、32、16、10 比 1。包含超过 1000 个元素的参数列表也会被拆分，以防止由于大小限制而导致数据库错误。

无论如何，最好有一个直接发送参数化 SQL 的数据库接口，而不需要单独的 Prepare 语句和句柄来调用。SQL Server 和 Oracle 等数据库通过字符串相等（值更改，SQL 中的绑定参数不！）来记住 SQL，并在可用的情况下重用查询计划。无需单独的准备语句，也无需在代码中对查询句柄进行繁琐的维护！ADO.NET 像这样工作，但似乎 Java 仍然使用按句柄准备/执行（不确定）。

我对这个主题有自己的问题，最初建议用重复项填充 IN 子句，但后来更喜欢 NHibernate 样式语句拆分： [参数化 SQL - in / not in with fixed numbers of parameters，用于查询计划缓存优化？](https://stackoverflow.com/questions/17620105/parameterized-sql-in-not-in-with-fixed-numbers-of-parameters-for-query-plan)

这个问题仍然很有趣，甚至在被问到 5 年多之后……

*编辑：我注意到在 SQL Server 上，在给定的情况下，具有许多值（如 250 或更多）的 IN 查询仍然很慢。虽然我希望数据库在内部创建一种临时表并加入它，但它似乎只重复了单值 SELECT 表达式 n 次。每个查询的时间最多约为 200 毫秒 - 甚至比将原始 ID 检索 SELECT 与其他相关表连接起来还要糟糕。此外，SQL Server Profiler 中有大约 10 到 15 个 CPU 单元，这对于重复执行相同的参数化是不寻常的查询，表明在重复调用时创建了新的查询计划。也许像个人查询这样的临时查询一点也不差。我不得不将这些查询与更改大小的非拆分查询进行比较以获得最终结论，但就目前而言，似乎无论如何都应该避免使用长 IN 子句。*

* * *

## 回答 #33

> 赞同：4
> 
> 时间：2016-01-28T04:07:52.417

您可以通过执行以下操作以可重用的方式执行此操作 -

```
public static class SqlWhereInParamBuilder
{
    public static string BuildWhereInClause<t>(string partialClause, string paramPrefix, IEnumerable<t> parameters)
    {
        string[] parameterNames = parameters.Select(
            (paramText, paramNumber) => "@" + paramPrefix + paramNumber.ToString())
            .ToArray();

        string inClause = string.Join(",", parameterNames);
        string whereInClause = string.Format(partialClause.Trim(), inClause);

        return whereInClause;
    }

    public static void AddParamsToCommand<t>(this SqlCommand cmd, string paramPrefix, IEnumerable<t> parameters)
    {
        string[] parameterValues = parameters.Select((paramText) => paramText.ToString()).ToArray();

        string[] parameterNames = parameterValues.Select(
            (paramText, paramNumber) => "@" + paramPrefix + paramNumber.ToString()
            ).ToArray();

        for (int i = 0; i < parameterNames.Length; i++)
        {
            cmd.Parameters.AddWithValue(parameterNames[i], parameterValues[i]);
        }
    }
} 
```

有关更多详细信息，请查看此博客文章 -[参数化 SQL WHERE IN 子句 c#](http://nodogmablog.bryanhogan.net/2016/01/parameterize-sql-where-in-clause-c/)

* * *

## 回答 #34

> 赞同：4
> 
> 时间：2016-12-30T03:34:02.017

这是 Mark Bracket 出色答案中解决方案的可重复使用变体。

扩展方法：

```
public static class ParameterExtensions
{
    public static Tuple<string, SqlParameter[]> ToParameterTuple<T>(this IEnumerable<T> values)
    {
        var createName = new Func<int, string>(index => "@value" + index.ToString());
        var paramTuples = values.Select((value, index) => 
        new Tuple<string, SqlParameter>(createName(index), new SqlParameter(createName(index), value))).ToArray();
        var inClause = string.Join(",", paramTuples.Select(t => t.Item1));
        var parameters = paramTuples.Select(t => t.Item2).ToArray();
        return new Tuple<string, SqlParameter[]>(inClause, parameters);
    }
} 
```

用法：

```
 string[] tags = {"ruby", "rails", "scruffy", "rubyonrails"};
        var paramTuple = tags.ToParameterTuple();
        var cmdText = $"SELECT * FROM Tags WHERE Name IN ({paramTuple.Item1})";

        using (var cmd = new SqlCommand(cmdText))
        {
            cmd.Parameters.AddRange(paramTuple.Item2);
        } 
```

* * *

## 回答 #35

> 赞同：3
> 
> 时间：2015-03-18T07:43:22.630

```
 create FUNCTION [dbo].[ConvertStringToList]

      (@str VARCHAR (MAX), @delimeter CHAR (1))
        RETURNS 
        @result TABLE (
            [ID] INT NULL)
    AS
    BEG

IN

    DECLARE @x XML 
    SET @x = '<t>' + REPLACE(@str, @delimeter, '</t><t>') + '</t>'

    INSERT INTO @result
    SELECT DISTINCT x.i.value('.', 'int') AS token
    FROM @x.nodes('//t') x(i)
    ORDER BY 1

RETURN
END 
```

- 您的查询

```
select * from table where id in ([dbo].[ConvertStringToList(YOUR comma separated string ,',')]) 
```

* * *

## 回答 #36

> 赞同：2
> 
> 时间：2014-01-01T18:32:02.673

使用动态查询。前端只是生成需要的格式：

```
DECLARE @invalue VARCHAR(100)
SELECT @invalue = '''Bishnu'',''Gautam'''

DECLARE @dynamicSQL VARCHAR(MAX)
SELECT @dynamicSQL = 'SELECT * FROM #temp WHERE [name] IN (' + @invalue + ')'
EXEC (@dynamicSQL) 
```

[SQL小提琴](http://sqlfiddle.com/#!3/d41d8/27475)

* * *

## 回答 #37

> 赞同：2
> 
> 时间：2017-04-12T09:49:47.567

有一种很好、简单且经过测试的方法：

```
/* Create table-value string: */
CREATE TYPE [String_List] AS TABLE ([Your_String_Element] varchar(max) PRIMARY KEY);
GO
/* Create procedure which takes this table as parameter: */

CREATE PROCEDURE [dbo].[usp_ListCheck]
@String_List_In [String_List] READONLY  
AS   
SELECT a.*
FROM [dbo].[Tags] a
JOIN @String_List_In b ON a.[Name] = b.[Your_String_Element]; 
```

我已经开始使用这种方法来解决我们在实体框架中遇到的问题（对于我们的应用程序来说不够健壮）。所以我们决定给[Dapper](https://stackexchange.github.io/Dapper/)（和 Stack 一样）一个机会。此外，将您的字符串列表指定为带有 PK 列的表可以很好地修复您的执行计划。 [这](https://www.codeproject.com/Articles/835519/Passing-Table-Valued-Parameters-with-Dapper)是一篇关于如何将表格传递给 Dapper 的好文章 - 快速且干净。

* * *

## 回答 #38

> 赞同：1
> 
> 时间：2017-07-30T18:44:15.603

创建一个存储名称的临时表，然后使用以下查询：

```
select * from Tags 
where Name in (select distinct name from temp)
order by Count desc 
```

* * *

## 回答 #39

> 赞同：1
> 
> 时间：2019-02-25T16:57:00.903

在 SQL SERVER 2016 或更高版本中，您可以使用**STRING_SPLIT**。

```
DECLARE @InParaSeprated VARCHAR(MAX) = 'ruby,rails,scruffy,rubyonrails'
DECLARE @Delimeter VARCHAR(10) = ','
SELECT 
    * 
FROM 
    Tags T
    INNER JOIN STRING_SPLIT(@InputParameters,@Delimeter) SS ON T.Name = SS.value
ORDER BY 
    Count DESC 
```

我使用它是因为有时加入比**Like 运算符**在我的查询中工作的速度更快。
此外，您可以以您喜欢的任何分隔格式放置无限数量的输入。
我喜欢这个 ..

* * *

## 回答 #40

> 赞同：1
> 
> 时间：2019-07-12T20:47:05.163

第1步：-

```
string[] Ids = new string[] { "3", "6", "14" };
string IdsSP = string.Format("'|{0}|'", string.Join("|", Ids)); 
```

第2步：-

```
@CurrentShipmentStatusIdArray [nvarchar](255) = NULL 
```

第 3 步：-

```
Where @CurrentShipmentStatusIdArray is null or @CurrentShipmentStatusIdArray LIKE '%|' + convert(nvarchar,Shipments.CurrentShipmentStatusId) + '|%' 
```

或者

```
Where @CurrentShipmentStatusIdArray is null or @CurrentShipmentStatusIdArray LIKE '%|' + Shipments.CurrentShipmentStatusId+ '|%' 
```

# asp.net - ASP.NET 2.0 应用程序中的 Crystal Reports - 报表更改未显示

> ID：337713
> 
> 赞同：1
> 
> 时间：2008-12-03T16:18:12.637
> 
> 标签：asp.net, iis, crystal-reports, asp.net-2.0

我正在开发一个包含 Crystal Reports（版本 10，包含在 VS 2005 中）的 ASP.NET 2.0 应用程序。最初，报告在使用 ASP.NET 开发 Web 服务器从我的机器上运行时，以及在部署到 IIS 服务器时都正常工作。

我对报告进行了一些更改并将应用程序重新部署到 IIS 服务器，但是当我运行应用程序时报告更改没有显示（尽管它们在我的机器上本地提供应用程序时显示）。IIS 服务器是否可能正在缓存 rpt 文件的旧副本并且没有正确刷新它们？我向管理服务器的人建议了这种可能性，但他说他重新启动了应用程序池并且没有任何区别。有任何想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-04T16:11:11.247

仔细检查新的没有在过程中的某个地方重命名，并且代码仍然指的是旧的。

如果您暂时删除 Web 服务器上的 RPT 文件会怎样？如果您没有收到错误，它会从其他地方加载报告。

是否涉及子报告？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-04T15:47:27.363

报表源对象具有缓存持续时间（以秒为单位）属性。我认为它默认设置为 60 秒。您可以缩短它然后再次运行报告，或者您可以通过另一个属性“enableCacheing”将其关闭。我关闭缓存的结果好坏参半，所以我通常只使用 aspx 页面设置报表源上的属性并将其降低到 1 秒以刷新报表，然后在缓存清除后将其恢复。

# iis-7 - 将 IIS7 设置为基本 Web 主机（带有附加 ftp 站点的网站）

> ID：337715
> 
> 赞同：0
> 
> 时间：2008-12-03T16:19:11.293
> 
> 标签：iis-7, ftp

我正在成为一个懒惰的研究人员吗？如果我没有通过谷歌找到好的答案，而不是继续尝试各种研究方法，我又来了……

我想在 Windows Server 2008 上的 IIS7 上托管一些网站。我熟悉如何设置/配置网站。我想做的是为每个网站设置一个 ftp 站点，允许特定用户管理该站点的文件。我不太了解如何管理新的 FTP 服务器，也不知道如何为目录/网站/ftpsite 设置安全性的最佳实践。

有没有人在这方面有经验或知道任何好的在线资源？

谢谢你。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-03T16:23:57.493

您必须使用旧的 IIS6 界面来设置 FTP 网站。然后像常规文件系统访问一样设置目录权限。我不是很喜欢这个，但它确实有效。

# c# - 处理每个应用程序状态的 GUI 元素属性

> ID：337729
> 
> 赞同：0
> 
> 时间：2008-12-03T16:22:12.067
> 
> 标签：c#, winforms, user-interface

我正在考虑通过使用一个传递 AppState 参数的方法来集中此功能，它处理基于此参数更改所有 GUI 元素的属性。每次应用程序更改其状态（准备好、忙碌、下载部分忙碌等）时，都会以适当的状态（或者可能是位字段或其他东西）调用此函数，它会发挥它的魔力。

如果我在各处分散更改 GUI 元素的状态，那么很容易忘记当应用程序处于某种状态时，那里的其他小部件也需要被禁用，等等。

还有其他方法可以处理这种事情吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-25T10:55:59.007

恩拉，

你的想法很好。您需要限制状态结构，这是确保 UI 可靠的唯一方法。另一方面不要严格遵循“一个功能”的想法。而是通过创建一个函数，然后逐步将所有属性重构为一个“setter”函数，不断地遵循它的方向。你需要记住一些在你的路上的事情：

1.  仅使用单向通信。不要从控件中读取状态，因为这是万恶之源。首先限制属性读取次数，然后限制属性写入次数。

2.  您需要结合一些缓存方法。确保缓存不会将属性读取注入主代码。

3.  不理会对话框，只需确保所有对话框通信都在打开和关闭期间完成，而不是在两者之间（尽可能多地）。

4.  在最常用的控件上实施包装器，以确保严格的通信框架。不要创建任何全局控制框架。

5.  除非你的 UI 真的很复杂，否则不要使用这个想法。在这种情况下，使用常规 WinForms 或 JavaScript 事件将导致您编写更小的代码。

6.  代码越少越好。不要重构，除非你松了线。

祝你好运！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T17:11:47.613

@Stefan:

I think we are thinking along the same lines, i.e. a single piece of code that gets to modify all the widget states and everyone else has to call into it to make such changes. Except, I was picturing a direct method call while you are picturing raising/capturing events. Is there an advantage to using events vs just a simple method call?

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T16:42:14.803

是的，这是 GUI 工作中最耗时的部分，用于制作用户友好的应用程序。禁用这个，启用那个，隐藏这个，显示那个。确保在插入/更新/删除/选择/取消选择事物时所有控件都具有正确的状态。

我认为这就是你告诉一个好的程序员和一个坏的程序员的地方。一个糟糕的程序员在没有任何更改要保存时有一个活动的“保存”按钮，一个好的程序员只有在有东西要保存时才启用“保存”按钮（只是许多例子中的一个）。

我喜欢为此目的使用 UIControlstate-handler 的想法。

Me.UIControlStates=UIControlstates.EditMode 或类似的东西。

如果有这样的对象，它可能会在状态更改时引发事件，我们将代码放在那里。

```
Sub UIControlStates_StateChanged(sender as object, e as UIControlStateArgs)
   if e.Oldstate=UIControlStates.Edit and e.NewState=UIControlStates.Normal then
      rem Edit was aborted, reset fields
      ResetFields()
   end if
   select case e.NewState
       case UIControlStates.Edit
         Rem enalbe/disable/hide/show, whatever

       Case UIControlStates.Normal
         Rem enalbe/disable/hide/show, whatever
       Case UIControlStates.Busy
         Rem enalbe/disable/hide/show, whatever
       Case Else
         Rem enalbe/disable/hide/show, whatever
   end select
end sub 
```

# iphone - 使用 cocos2d 在 iPhone 上显示游戏分数的最佳方式？

> ID：337732
> 
> 赞同：9
> 
> 时间：2008-12-03T16:22:26.980
> 
> 标签：iphone, objective-c, cocoa-touch, cocos2d-iphone

我希望使用 cocos2d 在 iPhone 应用程序中持续显示游戏分数。关闭 cocos2d 显示应用程序运行的 FPS 的代码：

```
-(void) showFPS
{
    frames++;
    accumDt += dt;

    if ( accumDt > 0.1)  {
        frameRate = frames/accumDt;
        frames = 0;
        accumDt = 0;
    }

    NSString *str = [NSString stringWithFormat:@"%.1f",frameRate];
    [FPSLabel setString:str];
    [FPSLabel draw];
} 
```

我可以让分数正确显示，但它会闪烁，即使应用程序以 60 FPS 的速度运行......有什么想法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-04T00:45:32.283

对于任何可能感兴趣的人，我最终使用了 cocos2d 标签：

```
scoreLabel = [Label labelWithString: [NSString stringWithFormat:@"%d", score] dimensions: CGSizeMake(180, 20) alignment: UITextAlignmentRight fontName:@"Arial" fontSize: 20];
[scoreLabel setPosition: cpv(100,100)];
[self add: scoreLabel]; 
```

希望这可以帮助别人。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-05T22:13:21.450

尝试改用 LabelAtlas。它更快（它消耗的 CPU 更少）。请参阅 cocos2d 发行版附带的 AtlasDemo 以了解如何使用它。

# xslt - 使用 XSLT 合并 XML 节点

> ID：337734
> 
> 赞同：4
> 
> 时间：2008-12-03T16:22:46.620
> 
> 标签：xslt

是否可以使用 XSLT 合并元素。

如果我有以下 XML

```
<data>
<item column="left" value="1" />
<item column="left" value="2" />
<item column="right" value="3" />
<item column="left" value="4" />
<item column="right" value="5" />
<item column="right" value="6" />
<item column="right" value="7" />
<item column="left" value="8" />
<item column="right" value="9" />
<item column="right" value="10" />
</data> 
```

我想要以下输出：

```
<data>
<item left="1" right="3 />
<item left="2" right="5" />
<item left="4" right="6" />
<item left="8" right="7" />
<item left="" right="9" />
<item left="" right="10" />
</data> 
```

但我完全不知道这是否可以使用 XSLT

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-03T18:43:27.537

这种转变：

```
<xsl:stylesheet 版本="1.0"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
 <xsl:output omit-xml-declaration="yes" indent="yes"/>

    <xsl:template match="数据">
      <xsl:variable name="vNumLeft" select="count(item[@column='left'])"/>

      <数据>
        <xsl:apply-templates select="*[@column='left']"/>
        <xsl:应用模板选择=
                "*[@column='right'][position() > $vNumLeft]"/>
      </数据>
    </xsl:模板>

    <xsl:template match="item[@column='left']">
      <xsl:variable name="vPos" select="position()"/>

      <item left="{@value}"
                    right="{../item[@column='right'][$vPos]/@value}" />
    </xsl:模板>

    <xsl:template match="item[@column='right']">
      <item left="" right="{@value}" />
    </xsl:模板>
</xsl:样式表>

```

应用于提供的 XML 文档时：

```
<数据>
    <item column="left" value="1" />
    <item column="left" value="2" />
    <item column="right" value="3" />
    <item column="left" value="4" />
    <item column="right" value="5" />
    <item column="right" value="6" />
    <item column="right" value="7" />
    <item column="left" value="8" />
    <item column="right" value="9" />
    <item column="right" value="10" />
</数据>

```

产生想要的结果：

```
<数据>
   <item left="1" right="3"/>
   <item left="2" right="5"/>
   <item left="4" right="6"/>
   <item left="8" right="7"/>
   <item left="" right="9"/>
   <item left="" right="10"/>
</数据>

```

* * *

## 回答 #2

> 赞同：-3
> 
> 时间：2008-12-03T16:38:40.597

您将使用元素和属性标签...

```
<xsl:element name="item">
    <xsl:attribute name="left"><xsl:value-of select="$theLeft"/></xsl:attribute>
    <xsl:attribute name="right"><xsl:value-of select="$theRight"/></xsl:attribute>
</xsl:element> 
```

...至于确定 $theLeft 和 $theRight 应该是什么的算法，我把它留给你。

# asp.net - 在 IIS 中将 PUT、DELETE 动词添加到 .aspx 扩展名有什么问题吗？

> ID：337737
> 
> 赞同：3
> 
> 时间：2008-12-03T16:23:03.967
> 
> 标签：asp.net, ajax, iis

我在 ajax 工作中越来越多地使用 PUT 和 DELETE，并想看看将这些动词添加到 IIS 中的 .aspx 应用程序扩展是否是一个“坏主意”。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-03T18:56:28.637

如果您的 AJAX 操作正在利用 RESTful API，那么我认为没有问题。否则，您可能需要查看[RFC2616-sec9](http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html)以对您的案例进行更多分析。我个人认为这并不坏，但人们可能想要坚持标准并考虑服务器开销等。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-03T18:59:13.153

PUT 和 DELETE 应该 - 如果您遵循 RFC - 替换或删除指定的 .aspx 文件。如果这就是你正在做的事情，那就去做吧。如果您正在做其他事情，请将您的解决方案归档在“ugly hack”下，并按照您应该使用的方式使用 GET 和/或 POST。

# ruby-on-rails - 如何在独立的日志文件中记录 Rails 中的某些内容？

> ID：337739
> 
> 赞同：163
> 
> 时间：2008-12-03T16:24:12.327
> 
> 标签：ruby-on-rails, logging

在 Rails 中，我想在不同的日志文件中记录一些信息，而不是标准的 development.log 或 production.log。我想从模型类中进行此日志记录。

* * *

## 回答 #1

> 赞同：197
> 
> 时间：2008-12-03T17:21:32.540

您可以从任何模型中自己创建一个 Logger 对象。只需将文件名传递给构造函数并像通常的 Rails 一样使用对象`logger`：

```
class User < ActiveRecord::Base
  def my_logger
    @@my_logger ||= Logger.new("#{Rails.root}/log/my.log")
  end

  def before_save
    my_logger.info("Creating user with name #{self.name}")
  end
end 
```

这里我使用了一个类属性来记忆记录器。这样就不会为每个创建的 User 对象创建它，但您不需要这样做。还请记住，您可以将`my_logger`方法直接注入到`ActiveRecord::Base`类中（或者如果您不喜欢过多的猴子补丁，也可以注入到您自己的某个超类中）以在您的应用程序模型之间共享代码。

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2012-09-12T02:56:46.863

**更新**

我根据下面的解决方案制作了一个 gem，称为[multi_logger](https://github.com/lulalala/multi_logger)。只需在初始化程序中执行此操作：

```
MultiLogger.add_logger('post') 
```

并打电话

```
Rails.logger.post.error('hi')
# or call logger.post.error('hi') if it is accessible. 
```

你就完成了。

如果您想自己编写代码，请参见下文：

* * *

更完整的解决方案是将以下内容放在您的`lib/`or`config/initializers/`目录中。

好处是您可以设置格式化程序以自动为日志添加时间戳或严重性前缀。这可以从 Rails 中的任何地方访问，并且使用单例模式看起来更整洁。

```
# Custom Post logger
require 'singleton'
class PostLogger < Logger
  include Singleton

  def initialize
    super(Rails.root.join('log/post_error.log'))
    self.formatter = formatter()
    self
  end

  # Optional, but good for prefixing timestamps automatically
  def formatter
    Proc.new{|severity, time, progname, msg|
      formatted_severity = sprintf("%-5s",severity.to_s)
      formatted_time = time.strftime("%Y-%m-%d %H:%M:%S")
      "[#{formatted_severity} #{formatted_time} #{$$}] #{msg.to_s.strip}\n"
    }
  end

  class << self
    delegate :error, :debug, :fatal, :info, :warn, :add, :log, :to => :instance
  end
end

PostLogger.error('hi')
# [ERROR 2012-09-12 10:40:15] hi 
```

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2012-02-29T17:57:28.680

对我有用的一个不错的选择是在您的`app/models`文件夹中添加一个相当简单的类，例如`app/models/my_log.rb`

```
class MyLog
  def self.debug(message=nil)
    @my_log ||= Logger.new("#{Rails.root}/log/my.log")
    @my_log.debug(message) unless message.nil?
  end
end 
```

然后在您的控制器中，或者实际上几乎可以从您的rails应用程序中引用模型类的任何地方，即您可以做的任何地方`Post.create(:title => "Hello world", :contents => "Lorum ipsum");`或类似的事情，您可以像这样登录到您的自定义文件

```
MyLog.debug "Hello world" 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2017-05-24T21:26:03.640

在（比如说）app/models/special_log.rb 中定义一个记录器类：

```
class SpecialLog
  LogFile = Rails.root.join('log', 'special.log')
  class << self
    cattr_accessor :logger
    delegate :debug, :info, :warn, :error, :fatal, :to => :logger
  end
end 
```

在（比如）config/initializers/special_log.rb 中初始化记录器：

```
SpecialLog.logger = Logger.new(SpecialLog::LogFile)
SpecialLog.logger.level = 'debug' # could be debug, info, warn, error or fatal 
```

在您的应用程序中的任何位置，您都可以使用以下方式登录：

```
SpecialLog.debug("something went wrong")
# or
SpecialLog.info("life is good") 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2014-08-08T14:19:55.557

这是我的自定义记录器：

```
class DebugLog
  def self.debug(message=nil)
    return unless Rails.env.development? and message.present?
    @logger ||= Logger.new(File.join(Rails.root, 'log', 'debug.log'))
    @logger.debug(message) 
  end
end 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-01T02:26:11.960

```
class Article < ActiveRecord::Base  

      LOGFILE = File.join(RAILS_ROOT, '/log/', "article_#{RAILS_ENV}.log")  

      def validate  
        log "was validated!"  
      end   

      def log(*args)  
       args.size == 1 ? (message = args; severity = :info) : (severity, message = args)  
       Article.logger severity, "Article##{self.id}: #{message}"  
     end  

     def self.logger(severity = nil, message = nil)  
       @article_logger ||= Article.open_log  
       if !severity.nil? && !message.nil? && @article_logger.respond_to?(severity)  
         @article_logger.send severity, "[#{Time.now.to_s(:db)}] [#{severity.to_s.capitalize}] #{message}\n"  
       end  
       message or @article_logger  
     end  

     def self.open_log  
       ActiveSupport::BufferedLogger.new(LOGFILE)  
     end  

   end 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-04-29T10:48:20.700

我建议使用[Log4r gem](http://log4r.rubyforge.org/)进行自定义日志记录。从其页面引用描述：

> Log4r 是一个全面而灵活的日志库，用 Ruby 编写，用于 Ruby 程序。它具有任意数量级别的分层日志记录系统、自定义级别名称、记录器继承、每个日志事件的多个输出目的地、执行跟踪、自定义格式、线程安全性、XML 和 YAML 配置等。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-04-30T14:24:31.267

```
class Post < ActiveRecord::Base
    def initialize(attributes)
        super(attributes)
        @logger = Logger.new("#{Rails.root}/log/post.log")
    end

    def logger
        @logger
    end

    def some_method
        logger.info('Test 1')
    end
end

ps = Post.new
ps.some_method
ps.logger.info('Test 2')
Post.new.logger.info('Test 3') 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-07-04T12:56:47.630

日志框架，其名称看似简单，却拥有您所渴望的复杂性！

按照[logging-rails](https://github.com/TwP/logging-rails)的简短说明开始过滤噪音、获取警报并以细粒度和高级方式选择输出。

完成后拍拍自己的背。日志滚动，每天。单凭这一点就值得。

# sql-server - 您在 SQL Server 上优化大型表（+1M 行）的方法是什么？

> ID：337744
> 
> 赞同：14
> 
> 时间：2008-12-03T16:25:11.483
> 
> 标签：sql-server, optimization, bigtable

我正在将巴西股市数据导入 SQL Server 数据库。现在我有一张表格，其中包含三种资产的价格信息：股票、期权和远期。我还在 2006 年的数据中，该表有超过 50 万条记录。我有更多 12 年的数据要导入，因此该表肯定会超过一百万条记录。

现在，我的第一种优化方法是将数据保持在最小大小，因此我将行大小减少到平均 60 字节，并包含以下列：

```
[股票] [int] 非空
[日期] [smalldatetime] 非空
[打开] [smallmoney] 非空
[高] [smallmoney] 非空
[低] [smallmoney] 非空
[关闭] [smallmoney] 非空
[交易] [int] 非空
[数量] [bigint] 非空
[数量] [钱] NOT NULL

```

现在，第二种优化方法是创建一个聚集索引。实际上主索引是自动聚集的，我把它做成了一个包含 Stock 和 Date 字段的复合索引。这是独一无二的，我不能在同一天拥有同一股票的两个报价数据。

聚集索引确保来自同一股票的报价保持在一起，并且**可能按日期排序**。第二个信息是真的吗？

现在有 50 万条记录，从特定资产中选择**700条报价大约需要 200****毫秒。**我相信随着桌子的增长，这个数字会越来越高。

 **现在对于第三种方法，我正在考虑将表格分成三个表格，每个表格用于特定市场（股票、期权和远期）。这可能会将表格大小减少 1/3。现在，这种方法会有所帮助还是无关紧要？现在，该表的大小为 50mb，因此它可以完全放入 RAM 中而没有太多麻烦。

另一种方法是使用 SQL Server 的分区功能。我对此了解不多，但我认为它通常在表很大并且您可以跨越多个磁盘以减少 I/O 延迟时使用，对吗？在这种情况下，分区会有所帮助吗？我相信我可以对不同表中的最新值（最近年份）和最旧值进行分区，寻找最新数据的概率更高，并且使用小分区可能会更快，对吧？

还有什么其他的好方法可以使这个过程尽可能快？该表的主要选择用途是从特定资产中查找特定范围的记录，例如资产 X 的最近 3 个月。还有其他用途，但这将是最常见的，可能执行超过 3k用户同时。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-13T23:54:54.503

1.  在 100 万条记录中，我不会认为这是一个特别大的表，需要不寻常的优化技术，例如拆分表、非规范化等。但是当你尝试了所有不影响你的正常方法时，这些决定就会出现使用标准查询技术的能力。

> 现在，第二种优化方法是创建一个聚集索引。实际上主索引是自动聚集的，我把它做成了一个包含 Stock 和 Date 字段的复合索引。这是独一无二的，我不能在同一天拥有同一股票的两个报价数据。
> 
> 聚集索引确保来自同一股票的报价保持在一起，并且可能按日期排序。第二个信息是真的吗？

这在逻辑上是正确的 - 聚集索引定义了磁盘上记录的逻辑顺序，这是您应该关心的全部。SQL Server 可能会放弃在物理块内进行排序的开销，但它仍然会表现得好像这样做了，所以它并不重要。在任何情况下，查询一只股票可能会读 1 或 2 页；并且优化器不会从页面读取中的无序数据中受益匪浅。

> 现在有 50 万条记录，从特定资产中选择 700 条报价大约需要 200 毫秒。我相信随着桌子的增长，这个数字会越来越高。

不一定显着。表大小和查询速度之间没有线性关系。通常有更多更重要的考虑因素。在你描述的范围内，我不会担心它。这就是你担心的原因吗？在我看来，200 毫秒已经很棒了，足以让您达到加载表格的程度，您可以开始进行实际测试，并更好地了解现实生活中的性能。

> 现在对于第三种方法，我正在考虑将表格分成三个表格，每个表格用于特定市场（股票、期权和远期）。这可能会将表格大小减少 1/3。现在，这种方法会有所帮助还是无关紧要？现在，该表的大小为 50mb，因此它可以完全放入 RAM 中而没有太多麻烦。

No! This kind of optimization is so premature it's probably stillborn.

> Another approach would be using the partition feature of SQL Server.

Same comment. You will be able to stick for a long time to strictly logical, fully normalized schema design.

> What would be other good approachs to make this the fastest possible?

The best first step is clustering on stock. Insertion speed is of no consequence at all until you are looking at multiple records inserted per second - I don't see anything anywhere near that activity here. This should get you close to maximum efficiency because it will efficiently read every record associated with a stock, and that seems to be your most common index. Any further optimization needs to be accomplished based on testing.

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-12-03T16:32:18.410

一百万条记录真的没有那么大。听起来确实搜索时间太长了-您要搜索的列是否已编入索引？

与以往一样，第一个调用端口应该是 SQL 分析器和查询计划评估器。询问 SQL Server 它将如何处理您感兴趣的查询。我相信您甚至可以要求它提出更改建议，例如额外的索引。

我还没有开始进入分区等 - 正如你所说，它现在应该都舒服地放在内存中，所以我怀疑你的问题更有可能是缺少索引。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-03T16:35:18.920

首先检查您对该查询的执行计划。确保您的索引正在被使用。我发现了。一百万条记录并不多。为了给出一些观点，我们有一个包含 3000 万行的库存表，我们的整个查询连接了大量的表并进行了大量计算，可以在 200 毫秒以下运行。我们发现在quad proc 64 位服务器上，我们可以有更多的记录，所以我们从不打扰分区。

您可以使用 SQL Profier 查看执行计划，或者只从 SQL Management Studio 或查询分析器运行查询。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-03T16:52:08.933

重新评估索引...这是最重要的部分，数据的大小并不重要，它确实如此，但不完全是出于速度目的。

我的建议是为该表重新构建索引，为您最需要的列创建一个复合索引。现在您只有几条记录使用不同的索引，否则一旦您将所有历史数据都放在表中，尝试新事物会很烦人。

在你检查你的查询之后，让查询计划评估器成为你的朋友，并检查引擎是否使用了正确的索引。

我刚刚读了你上一篇文章，我不明白一件事，你在插入数据时正在查询表？同时？。做什么的？通过插入，您的意思是一条记录还是数十万条记录？你怎么插入？逐个？

但同样的关键是索引，不要搞乱分区和东西..特别是有百万记录，那没什么，我有 150 万条记录的表，返回 40k 特定记录需要引擎大约 1500 毫秒.. .

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-03T16:35:04.723

我在一个学区工作，我们必须跟踪每个学生的出勤率。这就是我们赚钱的方式。我保存每个学生每日出勤分数的表目前有 3890 万条记录。我可以由此快速提高单个学生的出勤率。我们在这张表上保留了 4 个索引（包括主键）。我们的聚集索引是学生/日期，它保存所有学生的记录。如果插入学生的旧记录，我们已经对该表的插入进行了打击，但对于我们的目的而言，这是一个值得冒险的风险。

关于选择速度，我当然会在您的情况下利用缓存。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-03T22:41:42.253

您已经提到您的主键是 (Stock, Date) 上的复合键，并且是聚集的。这意味着该表按 Stock 和 Date 进行组织。每当您插入新行时，它都必须将其插入到表格的中间，这可能会导致其他行被推到其他页面（页面拆分）。

我建议尝试将主键反转为 (Date, Stock)，并在 Stock 上添加非聚集索引以方便快速查找特定 Stock。这将允许插入始终发生在表的末尾（假设您按日期顺序插入），并且不会影响表的其余部分，并且页面拆分的可能性较小。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-03T16:47:01.547

执行计划显示它使用聚集索引非常好，但我忘记了一个非常重要的事实，我仍在插入数据！插入可能过于频繁地锁定表。有没有办法我们可以看到这个瓶颈？

执行计划似乎没有显示任何有关锁定问题的信息。

现在这些数据只是历史数据，当导入过程完成时，插入将停止并且频率要低得多。但是我很快就会有一个更大的实时数据表，它会遇到这个**不断插入的问题**，并且会比这张表大。因此，任何优化这种情况的方法都非常受欢迎。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-03T17:03:55.210

另一种解决方案是为每年创建一个历史表，并将所有这些表放入历史数据库中，填写所有这些表，然后为它们创建适当的索引。完成此操作后，您将无需再触摸它们。为什么你必须继续插入数据？要查询所有这些表，您只需“合并”它们：p

当前年份表应该与这个历史表有很大不同。据我所知，您打算在旅途中插入记录？，我会计划一些不同的事情，比如每天不时进行批量插入或类似的事情。当然，这一切都取决于你想做什么。

这里的问题似乎出在设计上。我会去一个新的设计。你现在拥有的那个我理解它不适合。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-13T22:58:18.673

> 实际上主索引是自动聚集的，我把它做成了一个包含 Stock 和 Date 字段的复合索引。这是独一无二的，我不能在同一天拥有同一股票的两个报价数据。
> 
> 聚集索引确保来自同一股票的报价保持在一起，并且可能按日期排序。第二个信息是真的吗？

SQL Server 中的索引始终按索引中的列顺序排序。因此，[stock,date] 上的索引将首先按股票排序，然后在按日期排序。[日期，股票] 上的索引将首先按日期排序，然后在股票日期内排序。

在进行查询时，您应该始终在 WHERE 部分中包含索引的第一列，否则无法有效地使用索引。

对于您的具体问题：如果股票的日期范围查询是最常见的用法，则在 [date, stock] 上执行主键，因此数据将按日期顺序存储在磁盘上，您应该获得最快的访问。根据需要建立其他索引。插入大量新数据后进行索引重建/统计更新。

# java - 从表示层进行服务层调用

> ID：337751
> 
> 赞同：5
> 
> 时间：2008-12-03T16:27:04.863
> 
> 标签：java, spring, jakarta-ee, soa, esb

我必须选择一种技术来连接我的**应用程序/表示层**（基于 Java）和**服务层**（基于 Java）。基本上是从业务委托对象中查找合适的 Spring Service。

那里有很多选择，这让我感到困惑。以下是我缩小范围但不确定的选项..

*   弹簧 RMI

*   阿帕奇骆驼

*   Apache ServiceMix (ESB)

*   爱奥那保险丝 (ESB)

这是我想知道的

1.  如果您从事过（或评估过）其中任何一项工作，您认为哪种选择更合适？（告诉我原因也无妨：）
2.  还有其他我应该关注的技术吗？
3.  到目前为止，我还**没有**看到应用程序和服务层正在分发，但我不想在将来排除这种可能性。设计以提供这种灵活性是一个好主意吗？

任何帮助都会很有用。谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-03T17:23:53.347

Spring Remoting would seem like the simplest approach. It also would leave you open to more complex approaches in the future if that is the direction you want to take.

From the limited view of your requirements, I would stick with a simple solution with a lower learning curve, and leave the ESB till you determine you actually need it.

The KISS principle is a wonderful thing.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-03T16:46:28.023

它主要归结为您想使用 Spring Remoting（Spring RMI 和[Apache Camel](http://activemq.apache.org/camel/spring-remoting.html)是其实现） - 还是您想将 JAX-WS 用于 Web 服务（CXF 或 Metro 实现）。即，您是否想要为您的 POJO 自动远程处理 - 或者您是否想要带有 WSDL 合同的 WS 等等。

Once you've decided on the remoting technology; your next decision is do you want to bundle it inside your application as a library (e.g. Spring RMI or Camel) - or do you want to deploy it in an ESB container like ServiceMix to be able to hot-redeploy modules and so forth.

If the latter is your choice then use Apache ServiceMix - or use the FUSE ESB if you want a commercial distribution with more documentation, frequent releases, commercial support and so forth.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-07-01T14:40:13.600

Here you can find a simple solution to integrate Metro and Camel together: [http://www.everit.biz/web/guest/everit-blog/-/blogs/calling-a-camel-route-from-web-service-using-metro-and-tomcat?_33_redirect=/web/guest/everit-blog](http://www.everit.biz/web/guest/everit-blog/-/blogs/calling-a-camel-route-from-web-service-using-metro-and-tomcat?_33_redirect=/web/guest/everit-blog)

# java - 什么是好的嵌入式 Java LDAP 服务器？

> ID：337756
> 
> 赞同：24
> 
> 时间：2008-12-03T16:27:51.790
> 
> 标签：java, web-applications, ldap

我正在开发一个 Java Web 应用程序，该应用程序与其他一些与其一起部署的外部应用程序集成在一起。身份验证信息必须在所有内容之间同步，并且其他应用程序想要针对 LDAP 进行身份验证。该应用程序将部署在没有其他 LDAP 服务器可供一切使用的环境中；我必须提供它。到目前为止，我的解决方案是将[Penrose Server](http://docs.safehaus.org/display/PENROSE/Home)用作独立应用程序，我将其设置为检查主应用程序数据库中的表并基于该应用程序发布 LDAP。它工作得很好，但是如果有一些东西可以嵌入到主应用程序本身来简化部署，那就太好了。

看起来 Penrose 可以嵌入，但文档可能有点参差不齐或过时（尽管它似乎正在积极开发中）。这可能是一个可接受的解决方案，但如果有另一个已知在嵌入式配置中运行良好的解决方案，我可能想检查一下。

我还担心 Penrose 的 GPL 问题。我不能自由地 GPL 应用程序的源代码。我不相信独立运行它是一个问题，但嵌入它可能是不行的......有人肯定知道吗？为了避免这些问题，许可许可证会很好。

要求：

1.  LDAP v3
2.  必须能够在运行时更新目录内容，无论是通过编程方式还是通过其他方式（如 Penrose 与数据库同步）
3.  易于配置（在部署时无需对应用程序进行额外配置将是理想的）

到目前为止，我已经简要介绍了似乎是可嵌入的[ApacheDS](http://directory.apache.org/apacheds/1.5/)和[OpenDS 。](https://opends.java.net/)

有没有人有这种事情的经验？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-10-14T07:20:35.053

你应该看看[Apache DS](http://directory.apache.org/)。我刚[开始将它用作嵌入式服务器](https://stackoverflow.com/questions/1560230/running-apache-ds-embedded-in-my-application)来设置 JUnit 测试。到目前为止它运行良好，现在唯一阻止我的是我有限的 LDAP 知识。ApacheDS 看起来是一个不错的项目，我认为值得付出努力。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-14T10:13:51.573

由于这个问题已经有很长一段时间没有答案了，我想建议你也考虑一下 Penrose 的商业许可证——当 GPL 的含义令人望而却步时，它为像你这样的人提供了双重许可证。我不知道他们的价格和型号，但是使用您已经知道的解决方案可能比习惯您需要习惯的另一种解决方案更容易、更便宜。你可以用你的钱或你的时间来支付...

另外 - 作为记录，在这种情况下不适用：当项目使用 GPL 并且您想以非 GPL 方式嵌入它们时，向开发人员要求更宽松的许可证可能会有所帮助。有些人在 GPL 下发布时没有考虑其含义。如果这意味着项目的更广泛使用，您可能会让他们更改许可证。其他人特别想要 GPL 的含义，但问总是好的。Penrose 已经考虑到这一点，并提供了商业许可。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-01-05T01:49:10.720

我自己从未做过，但您可以使用 Spring Security 轻松[设置嵌入式 Apache 目录服务器](http://static.springsource.org/spring-security/site/docs/3.0.x/reference/ldap.html#ldap-server)，只需最少的 Spring XML 配置。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T13:49:39.103

我刚刚花了几天时间研究将我们的内部应用程序用户 db 公开为 LDAP 服务。我最初看的是 apache-ds，虽然它似乎是一个非常强大的目录服务，扩展它以公开一个关系数据库，但它的复杂性令人麻木。

已经选择了 penrose，因为它似乎提供了一个很好的解决方案，并在大约 2 小时内成功地制作了一个解决方案的原型。

# php - 使用 PHP 创建最近 30 天的数组

> ID：337760
> 
> 赞同：11
> 
> 时间：2008-12-03T16:28:37.903
> 
> 标签：php, arrays, date

我正在尝试从今天开始创建一个数组，并使用 PHP 回溯过去 30 天，但我遇到了麻烦。我可以估计，但我不知道这样做的好方法，并考虑到上个月的天数等。有没有人有一个好的解决方案？我无法接近，但我需要确保它是 100% 准确的。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-12-03T16:36:15.300

尝试这个：

```
<?php    
$d = array();
for($i = 0; $i < 30; $i++) 
    $d[] = date("d", strtotime('-'. $i .' days'));
?> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2019-05-22T07:06:20.943

这是相同的高级最新片段，

```
$today     = new DateTime(); // today
$begin     = $today->sub(new DateInterval('P30D')); //created 30 days interval back
$end       = new DateTime();
$end       = $end->modify('+1 day'); // interval generates upto last day
$interval  = new DateInterval('P1D'); // 1d interval range
$daterange = new DatePeriod($begin, $interval, $end); // it always runs forwards in date
foreach ($daterange as $date) { // date object
    $d[] = $date->format("Y-m-d"); // your date
}
print_r($d); 
```

工作[演示](http://sandbox.onlinephpfunctions.com/code/8c25cf124a085dd58d074f8a8a48931f87c16717)。

官方[文档](https://www.php.net/manual/en/class.dateperiod.php)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T16:36:22.427

您可以使用时间来控制天数：

```
for ($i = 0; $i < 30; $i++)
{
    $timestamp = time();
    $tm = 86400 * $i; // 60 * 60 * 24 = 86400 = 1 day in seconds
    $tm = $timestamp - $tm;

    $the_date = date("m/d/Y", $tm);
} 
```

现在，在 for 循环中，您可以将 $the_date 变量用于您可能想要的任何目的。:-)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-04-13T11:02:20.930

```
$d = array();
for($i = 0; $i < 30; $i++)
    array_unshift($d,strtotime('-'. $i .' days')); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-05-19T13:31:48.603

对于那些想要显示过去 X 天的销售额的人，
[正如在这个封闭问题中所问的那样 (https://stackoverflow.com/questions/11193191/how-to-get-last-7-days-using-php# *=* )](https://stackoverflow.com/questions/11193191/how-to-get-last-7-days-using-php#_=_)，这对我有用。

```
 $sales = Sale::find_all();//the sales object or array

  for($i=0; $i<7; $i++){
    $sale_sum = 0;  //sum of sale initial
    if($i==0){ 
    $day = strtotime("today"); 
  } else {
   $day = strtotime("$i days ago");
  }
  $thisDayInWords = strftime("%A", $day);

  foreach($sales as $sale){
    $date = strtotime($sale->date_of_sale)); //May 30th 2018 10:00:00 AM
    $dateInWords = strftime("%A", $date);

    if($dateInWords == $thisDayInWords){
        $sale_sum += $sale->total_sale;//add only sales of this date... or whatever
    } 
  } 
  //display the results of each day's sale
  echo $thisDayInWords."-".$sale_sum; ?> 

 } 
```

在你生气之前：我把这个答案放在这里是为了帮助那些从那个问题被引导到这里的人。无法在那里回答:(

# linq - LINQ to SQL：每个项目有多个/单个 .dbml？

> ID：337763
> 
> 赞同：13
> 
> 时间：2008-12-03T16:29:53.860
> 
> 标签：linq, visual-studio, linq-to-sql

我已经阅读了 Rick Strahl 关于[Linq to SQL DataContext Lifetime Management](http://www.west-wind.com/weblog/posts/246222.aspx)的文章，希望找到一些关于如何管理我的 .dbml 文件的答案，因为它们与 DataContext 密切相关。不幸的是，Rick 的文章似乎专注于*DataContext 在运行时的生命周期*，而我的问题是关于 .dbml 应该如何在*设计时*组织。

“.dbml 的最佳实践”的一般问题[已在此处提出和回答](https://stackoverflow.com/questions/33664/best-practices-for-managing-linq-to-sql-dbml-files)，答案集中在管理 .dbml 的外部工具上。

我要问一个更集中的问题，即**何时以及为什么在基于 LINQ to SQL 的项目中*不*应该有一个 .dbml 文件**？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-10-01T16:06:47.537

请注意，LINQ2SQL 旨在以简单易用的方式处理与对象的数据库关系。

不要通过创建多个 .dbml 文件来破坏表关系和工作单元概念。

如果您需要创建多个 .dbml 文件（我不推荐），请尝试满足以下条件：-

1.  如果您创建多个数据库，这些数据库表之间没有关系。
2.  如果您想使用这些 .dbml 之一来处理存储过程
3.  如果你不关心工作单元的概念。

如果您的数据库太复杂，那么我会考虑 ORM，例如 NHibernate、EF 4

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-03T16:39:47.583

在我看来，您可以拆分 .dmbl 文件，以便每个文件根据功能和关系从数据库中保存一个表/过程的子集。我还没有这样做，所以这只是意见。

然而，我创建了多个 .dbml 文件来帮助进行单元测试。如果您在限制您在生产环境中使用存储过程的环境中工作，那么您不能使用 .dbml 的表部分（尽管您可以使用 proc 部分）。因此，如果您“单元测试”（这实际上是集成测试）代码的 DB 层，您可以调用 proc 包装器，然后通过 .dbml 接口查询表来检查结果。在这种情况下，我会将 .dmbl 文件拆分为我想在“单元测试”中查询的表。

更多信息：我有 2 个我构建的解决方案。一个具有单元测试，并且永远不会在构建服务器上构建。另一个构建在构建服务器上并部署到测试/生产。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-03T16:38:52.640

我想说，您总是只需要 1 个 dbml-file PER 数据库。如果您与其他数据库有多个连接，请考虑设计或使用单独的 dbml 文件。无论哪种方式，每个数据库一个就足够了。

这是因为 dbml 映射到您的表，为什么不只使用一个“数据连接器”/“数据层”，使用多个似乎很奇怪/奇怪的设计。

也可能仅使用 1 更易于控制。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-07-19T15:19:29.963

此问题已在此处进行了彻底分析：http: [//craftycode.wordpress.com/2010/07/19/linq-to-sql-single-data-context-or-multiple/](http://craftycode.wordpress.com/2010/07/19/linq-to-sql-single-data-context-or-multiple/)

总之，您应该为每个强连接的表组最多创建一个数据上下文，或者每个数据库最多创建一个数据上下文。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-08-06T11:59:39.460

假设您有一个数据库：

数据库 D 包含表 A、B、C、X、Y、Z，其中

*   表 A 与表 B 和 C 有外键关系
*   表 X 与表 Y 和 Z 具有外键关系
*   *表 X 也与表 A 有外键关系*

假设您有 2 个基于数据库 D 的 DBML 文件 P 和 Q

*   DBML 文件 P 包含实体 A'、B' 和 C'，其中 A' 通过关联连接到 B' 和 C'。
*   DBML 文件 Q 包含实体 X'、Y' 和 Z'，其中 X' 通过关联连接到 Y' 和 Z'。

AFAIK，DBML 文件 P 和 Q 无法包含实体 A' 和 X' 之间的关联。这是拥有多个 DBML 文件的最大问题。

在我看来，DBML 文件反映了由表表示的数据模型以及数据库中这些表的约束。如果一组 DBML 文件中缺少某些表或约束，则该组 DBML 文件不能准确地反映底层数据库。

回到我们的示例，如果数据库 D 中的表 A 和 X 之间没有关系，则可以创建 2 个 DBML 文件。

一般而言，如果每个 DBML 文件包含所有连接的实体和关系，则可以有多个 DBML 文件。请注意，反过来不是问题，即，一个 DBML 文件可以包含多个实体组，这些实体之间没有任何关联。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-23T00:39:00.600

答案很棘手，因为这是情况所需要的。我尝试在逻辑上将每个 DBML 分离到上下文中（毕竟，DBML 提供了 DataContext 功能）。因此，如果我的应用程序只有一个上下文，那么为每个表设置单独的 DBML 对我来说是没有意义的。在创建 DBML 文件时，上下文为王就是我所说的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-08-06T12:04:32.990

要记住的另一件事是 LINQ 使用 DataContext 来跟踪它创建的实体实例的身份。因此，表示由 DataContext 类的一个实例创建的表中的行的实体与由另一个实例创建的实体不同，即使所有属性都相同。

当一个人有多个 DBML 文件时，必然会有多个 DataContexts 实例，每个 DBML 文件一个。因此，实体不能从一个 DataContext 连接或共享到另一个 DataContext。

这适用于实体存在于两个（或所有）DBML 文件中的情况。

# jquery - 如何在 JQuery 中通过 json 代码使用 $.each 循环

> ID：337766
> 
> 赞同：1
> 
> 时间：2008-12-03T16:30:27.743
> 
> 标签：jquery, json

由于我的服务器端脚本输出方式，我收到了多个 JSON 对象。`{jsonhere}{jsonhere1}{jsonhere2}{jsonhere3} etc..`他们没有被任何东西分开。如果我要进行拆分，`}{`我会失去这些括号。那么是否有一个外循环我可以放在常规`$.each`循环上来完成这项工作？

谢谢，

冰

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-03T17:29:03.787

粗略算法：

```
Define a stack
Define an array
LOOP on each character in the string
    IF the top item of the stack is a single or double quote THEN
        LOOP through each character until you find a matching single or double quote, then pop it from the stack.
    ELSE
        IF "{", push onto the stack
        IF "}" THEN
            pop a "{" from the stack if it is on top    
            IF the stack is empty THEN //we just finished a full json object
                Throw this json object into an array for later consumption
            END IF
        END IF
        IF single-quote, push onto the stack
        IF double-quote, push onto the stack 
    END IF
END LOOP 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T16:39:24.887

这不是 JSON。

jQuery 以懒惰的方式解释 JSON，调用 eval() 并希望那里没有“真正的”代码；因此它不会接受。（我想你已经知道了）。

看来您唯一的出路是将其视为文本字符串，并使用正则表达式来提取数据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-04-25T00:38:47.717

以下将是有效的 JSON 响应：

```
[
     {JSON},
     {JSON},
     {JSON},
     {JSON}
] 
```

由于您的 JSON 格式不正确，因此只需在服务器端进行修复即可。下面的代码比 EndangeredMassa 建议的要简短一些，它避免在用引号括起来的大括号之间添加逗号。我不太擅长 RegEx 用一个 .replace() 来解决这个问题。

```
var string = "{\"key\":\"val}{ue\"}{'key':'val}{ue'}{ \"asdf\" : 500 }";
var result = string.match(/('.*?')|(".*?")|(\d+)|({)|(:)|(})/g);
var newstring = "";
for (var i in result) {
    var next = parseInt(i) + 1;
    if (next <= result.length) {
        if (result[i] == "}" && result[next] == "{") {
            newstring += "},";
        }
        else {
    newstring += result[i];
    }
} 
```

}

要遍历 JSON 对象，请使用以下命令：

```
$.each(eval(newstring), function() {
     //code that uses the JSON values
     alert(this.value1);
     alert(this.value2);
}); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-03T16:56:51.433

Unless you can guarantee that any strings in the data will not contain "}{", you can't even safely split it without parsing the JSON at least enough to keep track of whether you are in a string or not. For example if you just split this:

```
{"foo": "}{", "bar": 42} 
```

around "}{", you would end get two invalid JSON objects instead of one.

If you know that can never happen, you could split around the braces and append "}" to each element except the last one, and prepend "{" to the last element. I would only do that if there was absolutely no other way though, because it's *really* fragile.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-09T23:08:40.807

这不是 JSON，在客户端只需修复您的 JSON 代码，您就可以安全地“评估”它。

```
var jsonWrong = '{a:1}{a:2}{a:3}';
var jsonRight = jsonWrong.replace('}{', '},{');
var json = eval('('+jsonRight+')'); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-03T22:58:06.930

我设法拼凑了一个工作示例！将以下文本另存为 html 页面。它似乎在 IE7 和 FF3 中运行良好。如果您有任何问题，请告诉我。

（我用的是jquery，但是真的完全没必要。）

```
<html>
<head>
    <script type="text/javascript" src="jquery-1.2.6.js"></script>
    <script type="text/javascript">

        function handleClick() {
            var jsonStrs = parse();
            var jsonObjs = [];
            for(var j=0;j<jsonStrs.length;j++) jsonObjs.push( parseJSON(jsonStrs[j]) );

            //jsonObjs now contains an array of json objects 

            document.getElementById('log').innerHTML = '';
            displayResults(jsonObjs);
        }

        function displayResults(jsonObjs) {
            for(var k=0; k<jsonObjs.length; k++) {
                ShowObjProperties(jsonObjs[k]);
            }
        }

        function ShowObjProperties(obj) {
            var property, propCollection = "";

            for(property in obj) {
                propCollection += (property + ": " + obj[property] + "<br>");
            }

            log(propCollection);
        }

        function parseJSON(str) {
            var x_result = null;
            eval('x_result = ' + str);
            return x_result;
        }

        function parse() {
            //Setup
            var out = $('#output');
            var rawinput = $('#inputtext').val();
            var input = rawinput.split('');
            var stack = [];
            stack.top = function() {
                if (this.length == 0) return null;
                return this[this.length-1];
            }
            var jsonStrs = [];

            //Main Loop
            var ch = '';
            var top = '';
            var cursor = 0;
            var i = 0;
            while (i<input.length) {
                //Current Character
                ch = input[i];

                top = stack.top(); 

                if(top == "'" || top == '"') { //Ignore the rest of the string
                    //You can add validation for possible unsafe javascript inside a string, here.

                    ch = input[++i];

                    while(ch != top) {
                        i++;
                        if(i>=input.length) {
                            alert('malformed string');
                            break;
                        }
                        ch = input[i];
                    }
                    stack.pop();

                } else {
                    //You can add validation for unsafe javascript here.

                    if(ch == ' ') {
                        i++;
                        continue; // Ignore spaces
                    }

                    if(ch == "{" || ch == "'" || ch == '"') stack.push(ch);
                    if(ch == "}") {
                        if(top=="{") {
                            stack.pop();
                        } else {
                            alert('malformed string');
                            break;
                        }

                        if(stack.length == 0) {
                            var str = rawinput.substring(cursor, i+1)
                            jsonStrs.push(str);
                            cursor = i+1;
                        }
                    }
                }

                i++;
            }

            return jsonStrs;
        }

        function log(msg) {
            document.getElementById('log').innerHTML += msg + '<br>';
        }

    </script>
</head>

<body>
    <textarea id="inputtext" rows="5" cols="40" style="overflow:auto">{foo:'bar'}</textarea><br>
    <button id="btnParse" onclick="handleClick();">Parse!</button><br /><br />

    <div id="output">
    </div>

    <b>Results:</b>
    <div id="log"></div>

</body>
</html> 
```

# oracle - 为什么 Oracle 在通过 ODBC 绑定 SQL_C_WCHAR 文本时需要 TO_NCHAR

> ID：337769
> 
> 赞同：1
> 
> 时间：2008-12-03T16:30:38.617
> 
> 标签：oracle, odbc, oracle10g

我使用以下在 ODBC 中准备和绑定的语句：

```
SELECT (CASE profile WHEN ? THEN 1 ELSE 2 END) AS profile_order 
FROM engine_properties; 
```

在与 AL32UTF8 字符集的 Oracle 10g 数据库的 ODBC 3.0 连接中执行，即使在使用 绑定到 wchar_t 字符串后`SQLBindParameter(SQL_C_WCHAR)`，它仍然会给出错误 ORA-12704: character set mismatch。

为什么？我绑定为 wchar。不应该将 wchar 视为 NCHAR 吗？

如果我更改参数以包装它，`TO_NCHAR()`那么查询将正常工作。但是，由于这些查询用于多个数据库后端，我不想只在 Oracle 文本绑定上添加 TO_NCHAR。有什么我想念的吗？在没有 TO_NCHAR 锤子的情况下解决这个问题的另一种方法是什么？

我无法通过搜索或手册找到任何相关内容。

更多细节...

- 错误

```
SELECT (CASE profile WHEN          '_default'  THEN 1 ELSE 2 END) AS profile_order
FROM engine_properties; 
```

- 行

```
SELECT (CASE profile WHEN TO_NCHAR('_default') THEN 1 ELSE 2 END) AS profile_order
FROM engine_properties; 
```

```
SQL> 描述引擎属性；
 名称空？类型
 ----------------------------------------- -------- - --------------------------
 EID 非空 NVARCHAR2(22)
 LID 非空数字 (11)
 配置文件不为空 NVARCHAR2(32)
 PKEY 非空 NVARCHAR2(50)
 值非空 NVARCHAR2(64)
 只读非空数字（5）

```

这个没有 TO_NCHAR 的版本在 SQL Server 和 PostgreSQL（通过 ODBC）和 SQLite（直接）中运行良好。但是在 Oracle 中它返回“ORA-12704：字符集不匹配”。

```
SQLPrepare(SELECT (CASE profile WHEN ? THEN 1 ELSE 2 END) AS profile_order 
    FROM engine_properties;) = SQL_SUCCESS
SQLBindParameter(hstmt, 1, SQL_PARAM_INPUT, SQL_C_WCHAR, 
    SQL_VARCHAR, 32, 0, "_default", 18, 16) = SQL_SUCCESS
SQLExecute() = SQL_ERROR
SQLGetDiagRec(1) = SQL_SUCCESS
[SQLSTATE: HY000, NATIVE: 12704, MESSAGE: [Oracle][ODBC]
    [Ora]ORA-12704: character set mismatch]
SQLGetDiagRec(2) = SQL_NO_DATA 
```

如果我确实使用 TO_NCHAR，没关系（但在 SQL Server、Postgres、SQLite 等中不起作用）。

```
SQLPrepare(SELECT (CASE profile WHEN TO_NCHAR(?) THEN 1 ELSE 2 END) AS profile_order
    FROM engine_properties;) = SQL_SUCCESS
SQLBindParameter(hstmt, 1, SQL_PARAM_INPUT, SQL_C_WCHAR, 
    SQL_VARCHAR, 32, 0, "_default", 18, 16) = SQL_SUCCESS
SQLExecute() = SQL_SUCCESS
SQLNumResultCols() = SQL_SUCCESS (count = 1)
SQLFetch() = SQL_SUCCESS 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-03T16:37:41.177

如果 Oracle 数据库字符集是 AL32UTF8，为什么列定义为 NVARCHAR2？这意味着您希望这些列使用国家字符集（通常为 AL16UTF16，但在您的数据库中可能不同）进行编码。除非您主要存储亚洲语言数据（或其他需要在 AL32UTF8 中存储 3 个字节的数据），否则当数据库字符集支持 Unicode 时，在 Oracle 数据库中创建 NVARCHAR2 列相对不常见。

一般来说，坚持使用数据库字符集（CHAR 和 VARCHAR2 列）比尝试使用国家字符集（NCHAR 和 NVARCHAR2 列）要好得多，因为在开发/配置方面。由于您不会通过选择 NVARCHAR2 数据类型来增加可以编码的字符集，因此我敢打赌，您会更喜欢 VARCHAR2 数据类型。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T20:33:14.853

谢谢贾斯汀。

我不能说我仍然完全了解如何在 VARCHAR2 和 NVARCHAR2 之间进行选择。我曾尝试在我的约会中使用 VARCHAR2（其中确实包括许多不同的语言，包括欧洲和亚洲），但当时并没有奏效。

不过，我又玩了一点，我发现使用贾斯汀的建议在这种组合中有效：

*   AL32UTF8 数据库字符集
*   VARCHAR2 列类型
*   在启动 sqlplus.exe 之前设置 NLS_LANG=.UTF8
*   使用 UTF-8 的数据文件（即包含所有 INSERT 语句的文件）
*   使用 SQL_C_WCHAR 从数据库中插入和提取字符串

我仍然觉得 Oracle 不像（例如）PostgreSQL 那样有趣...... :-)

# asp.net - 在 ASP.NET (a la MOSS) 中创建自定义 URL 令牌

> ID：337781
> 
> 赞同：1
> 
> 时间：2008-12-03T16:33:55.693
> 
> 标签：asp.net, sharepoint, moss

在 ASP.NET 中，波浪号 (~) 被视为 URL 中的一个标记，并将带有前缀的路径视为相对于应用程序根目录。这是众所周知的功能。

在 MOSS 中，还有其他标记，例如 ~sitecollection/mypath...，其行为方式类似，但将路径视为相对于网站集根目录。这是如何实现的？经过粗略搜索后，我找不到任何有关如何将这样的令牌添加到 .NET URL 解析机制的信息。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-12T19:06:29.850

它可能不是唯一的地方，但[SPUtility.GetServerRelativeUrlFromPrefixedUrl()](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.utilities.sputility.getserverrelativeurlfromprefixedurl.aspx)将使用 ~site 和 ~sitecollection 解析 URL。MOSS 还提供[SPUrlExpressionBuilder](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.publishing.webcontrols.spurlexpressionbuilder.aspx)用于声明性使用：

```
<link runat="server" rel="stylesheet" type="text/css"
      href="<% $SPUrl:~SiteCollection/Style Library/MyStyles/style.css %>" /> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T18:22:22.370

我不确定——但我敢打赌，代码隐藏在为每个请求运行的 SharePoint HTTPModules 或 HTTPHandler 之一中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T18:46:34.990

我不认为它会在那里，因为它不是在处理程序输出中的任何地方替换的通用令牌。它发生在服务器控件的 URL 解析级别，这让我认为它可能在与控件构建或解析相关的类中的某个位置，但我在那里没有找到任何东西。

# vb.net - 访问 Windows Forms 2.0 组合框或 AXComboBox

> ID：337784
> 
> 赞同：0
> 
> 时间：2008-12-03T16:35:00.323
> 
> 标签：vb.net, winforms, visual-studio-2008, combobox

我使用 windows forms 2.0 在 VB.net 2008 中创建了一个多列组合框。一旦选择在表格的其余部分中使用，我就无法访问数据。似乎没有与 winform 2.0 组合框一起使用的选定事件。

有没有人有使用winforms 2.0的经验？另外我想一个更好的问题是：是否有一个网站破坏了 windows 窗体 2.0？到目前为止，包括 MSDN 在内的一切似乎都没有那么详细。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-09T16:25:42.210

ComboBox 类有一个 SelectIndexChanged 事件

[http://msdn.microsoft.com/en-us/library/system.windows.forms.combobox.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.combobox.aspx)

选择索引更改：

[http://msdn.microsoft.com/en-us/library/system.windows.forms.combobox.selectedindexchanged.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.combobox.selectedindexchanged.aspx)

选定值已更改：

[http://msdn.microsoft.com/en-us/library/system.windows.forms.listcontrol.selectedvaluechanged.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.listcontrol.selectedvaluechanged.aspx)

所有 Winform 控件在 msdn 网站上都有很好的记录。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T19:14:00.483

我所说的控件在：axmicrosoft.vbe.interop.forms.axcombobox。这没有太多的文档方式。但是，它确实适合创建多列组合框。

我对创建多列组合框的前景并不感到兴奋，我已经向客户解释并证明这不是最好的实现，但客户仍然想要一个多列组合框。

我也对第三方工具（免费，而不是免费）的前景持开放态度。

如果有人对此问题有任何经验，请转发他们拥有的任何信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T16:47:48.300

我们购买了基础设施控制，这解决了这个问题。

# c# - 如何在 NHibernate 中映射图像类型？

> ID：337789
> 
> 赞同：14
> 
> 时间：2008-12-03T16:35:27.593
> 
> 标签：c#, sql-server, nhibernate

我的 SQL Server 2000 数据库中有一个类型为**Image**的列。如何将其映射到 NHibernate？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-03T16:42:27.173

我们在映射配置文件上使用了 BinaryBlob，在属性上使用了 byte[]。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-04-03T11:07:34.887

下面是我用来映射图像字段的示例代码。其中 BlogImage 是映射到字节类型属性 BlogImage 的 Image Datatype 列。length="2147483647" 用于确保将完整图像复制到数据库中，因为 nhibernate 有时会限制要插入的数据的最大大小。

```
<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2" auto-import="true">
<class name="EAS.MINDSPACE.Infrastructure.Business.Entities.BlogMaster,EAS.MINDSPACE.Infrastructure.Business.Entities" lazy="false" table="BlogMaster" schema="dbo" >
<id name="BlogId" column="BlogId">
  <generator class="native" />
</id>
<property name="BlogData" column="BlogData" />
<property name="BlogImage" column="BlogImage" length="2147483647"  />
<property name="UserId" column="UserId" />
  <property name="CreatedByName" column="CreatedBy" />
  <property name="CreatedOn" column="CreatedOn" />
  <property name="ReplyCount" column="ReplyCount" />

 </class>
</hibernate-mapping> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-04-01T10:09:44.947

NHibernate 3.x 自己完成了所有的魔法。

数据：

```
Create table tblCompany (..., Logo image); 
```

NHibernate-Mapping（设置长度很重要！！！）：

```
<class name="Company"
     table="tblCompany">
     ...         
     <property name="_logo"
          column="Logo"
          not-null="false"
          length="2147483647"
          access="field" />
     ...
</class> 
```

C#-类：

```
public class Company {
    ...
    private Image _logo;
    ...
} 
```

# silverlight - Silverlight 中带有弹出窗口的文本框

> ID：337791
> 
> 赞同：0
> 
> 时间：2008-12-03T16:35:54.380
> 
> 标签：silverlight, textbox, popup

我想构建一个自己的控件，但因此我需要知道是否可以将 Textbox 事件与 Popup 或多或少像 Datepicker 控件一样组合。或者有比弹出窗口更好的方法吗？

问候

帕特里克

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T21:43:37.207

你当然可以做到这一点。事实上，以 DatePicker 为例，您可以这样做。我想您的控件将是 TextBox、Button 和 Popup 控件的组合。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T18:02:49.397

您可以从[CodePlex Silverlight Toolkit 项目站点](http://www.codeplex.com/Silverlight/Release/ProjectReleases.aspx?ReleaseId=18804)下载 Silverlight Toolkit 的完整源代码。

您可以在[Shawn Burke 的博客上](http://blogs.msdn.com/sburke/archive/2008/03/05/silverlight-2-beta-1-controls-available-including-source-and-unit-tests.aspx)获得 Beta 2 Release 1 控件的源代码和单元测试。

这些都可能不是您正在寻找的东西，但它们可能会让您走上正确的轨道。

# java - 我可以强制生成 JVM 崩溃日志文件吗？

> ID：337793
> 
> 赞同：11
> 
> 时间：2008-12-03T16:35:54.567
> 
> 标签：java, jvm, crash

来自 JVM 崩溃的日志文件包含各种对调试有用的信息，例如加载的共享库和完整的环境。我可以强制 JVM 以编程方式生成其中之一吗？通过执行使其崩溃的代码或其他方式？或者以另一种方式访问​​相同的信息？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-04T19:43:22.330

您可以尝试抛出 OutOfMemoryError 并添加 -XX:+HeapDumpOnOutOfMemoryError jvm 参数。这是从 1.6 开始的新工具，McDowell 建议的其他工具也是如此。 [http://blogs.oracle.com/watt/resource/jvm-options-list.html](http://blogs.oracle.com/watt/resource/jvm-options-list.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-03T17:11:39.487

查看[JDK Development Tools](http://java.sun.com/javase/6/docs/technotes/tools/)，特别是用于转储堆、打印配置信息等的[故障排除工具。](http://java.sun.com/javase/6/docs/technotes/tools/#troubleshoot)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T16:45:47.620

我很确定这可以使用 IBM JDK 完成，因为我前段时间正在使用他们的堆栈分析器。强制转储的一种选择只会导致 outOfMemoryException。

这些工具可能会提供一些线索[http://www.ibm.com/developerworks/java/library/j-ibmtools1/](http://www.ibm.com/developerworks/java/library/j-ibmtools1/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-05-09T11:18:39.907

在 Ubuntu 20.04.1 LTS 上，我通过以下方式强制 jdk 11 进程上的核心转储

```
kill -4 <PID> 
```

# asp.net - 将新行添加到数据表的顶部

> ID：337797
> 
> 赞同：38
> 
> 时间：2008-12-03T16:36:29.823
> 
> 标签：asp.net, datatable, datarow

当我们使用 datatable.newrow 命令时，会在行的底部添加一个新的空行。但是我希望将 newrow 添加到数据表的顶部。我怎样才能做到？

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2008-12-03T16:41:31.450

您使用 NewRow 创建具有相同列的行。要真正将其放入 DataTable，您必须这样做

```
myDataTable.Rows.InsertAt(myDataRow, 0); 
```

其中 0 是您要插入的索引。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2016-05-05T12:40:55.930

这是在表格中添加行的最佳示例

```
DataRow newRow = myDataTable.NewRow();
newRow[0] = "0";
newRow[1] = "Select one";
myDataTable.Rows.InsertAt(newRow, 0); 
```

它首先设置行

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-07-22T13:44:52.493

这个是错的

```
myDataTable.Rows.InsertAt(0,myDataRow); 
```

请使用以下行代替

```
myDataTable.Rows.InsertAt(myDataRow,0); 
```

# wpf - 如何从 ComponentResourceKey 获取实际资源？

> ID：337803
> 
> 赞同：3
> 
> 时间：2008-12-03T16:39:05.387
> 
> 标签：wpf, componentresourcekey

我在资源字典中定义了一个 ComponentResourceKey，如下所示：

```
<Style x:Key="{ComponentResourceKey TypeInTargetAssembly={x:Type local:Resources}, ResourceId=BaseControlStyle}" TargetType="{x:Type FrameworkElement}">
    <Setter Property="Margin" Value="4,4,0,0" />
</Style> 
```

我有一个静态类，用作提供资源键的快捷方式，如下所示：

```
public class Resources
{
    public static ComponentResourceKey BaseControlStyleKey
    {
        get
        {
            return new ComponentResourceKey(typeof(Resources), "BaseControlStyle");
        }
    }
} 
```

现在通常当我使用这种风格时，我会做这样的事情：

```
<TextBlock Style="{DynamicResource {x:Static local:Resources.BaseControlStyleKey}}"/> 
```

但是，我有一个场景，我需要在这样的代码中设置样式：

```
myTextBox.Style = Resources.BaseControlStyleKey // Does not work. 
```

任何想法如何从 ComponentResourceKey 中提取样式？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-03T16:46:26.853

我想到了。

```
myTextBox.Style = 
        Application.Current.TryFindResource(Resources.BaseControlStyleKey)
        as Style; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T14:55:05.937

创建单独的 ComponentResourceKey 持有者（资源类）后，您可以简化密钥声明。

**代替：**

```
<Style x:Key="{ComponentResourceKey TypeInTargetAssembly={x:Type local:Resources}, ResourceId=BaseControlStyle}" TargetType="{x:Type FrameworkElement}">
    <Setter Property="Margin" Value="4,4,0,0" />
</Style> 
```

**您可以简单地使用：**

```
<Style x:Key="{x:Static local:Resources.BaseControlStyle}" TargetType="{x:Type FrameworkElement}">
    <Setter Property="Margin" Value="4,4,0,0" />
</Style> 
```

# powershell - 如何以编程方式更改 Windows Vista 中的功能？

> ID：337811
> 
> 赞同：2
> 
> 时间：2008-12-03T16:40:37.677
> 
> 标签：powershell, windows-vista, system-administration

我正在寻找一种在 Windows Vista（和更新的 Redmond OS，例如 Server 2008）中以编程方式更改功能（“程序和功能”->“打开或关闭 Windows 功能”）的方法。

理想的解决方案是 Powershell 脚本（Get-Features、Set-Features）的形式，但是任何指向 MSDN/其他文档的指针都非常受欢迎！（我最初的快速 Google/StackOverflow 搜索是空的）。

拥有一种自动打开或关闭功能的方法可以让我针对不同的场景自动设置计算机。例如，要使用 IIS 开发 ASP.NET 应用程序，需要安装一些默认情况下未安装的 IIS 功能。我目前的“确保至少检查了此屏幕截图中显示的功能”的过程还有很多不足之处。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-09-28T14:02:17.937

I just found an extension that works for Windows 7\. "PowerShell module to Add/Remove Windows 7 features" - [https://psclientmanager.codeplex.com/](https://psclientmanager.codeplex.com/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T14:15:54.657

在 windows server 2008 中，有[ServerManagerCmd](http://technet.microsoft.com/en-us/library/cc753319.aspx)命令。这可以安装带有或不带有您想要的子功能的 IIS。您还可以安装/卸载大多数主要的 Windows 功能。

1.  您可以按照自己的方式设置服务器，然后运行 ​​ServerManagerCmd -query template.xml。这会将配置导出到 XML 文件。
2.  您需要[转换文件](http://blogs.technet.com/windowsserver/archive/2007/08/16/transforming-servermanagercmd-query-xml-to-input-xml.aspx)以准备在其他服务器上使用
3.  将转换后的文件复制到您要配置的服务器并运行 ServerManagerCmd -inputPath transformTemplate.xml

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-19T22:28:38.197

在 Vista 和 Windows 2008 中执行此操作的方法是使用 PKGMGR 命令行工具。在 MSDN 中搜索此工具以查找功能/包列表。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T20:44:17.147

It looks live Powershell V2 on Server 2008 R2 (Beta) has a module that does exactly this. Let's hope Windows 7 will have this functionality as well...

For more details, see [Managing Server Features with PowerShell Cmdlets on Windows 2008 Server R2 Beta](http://blogs.msdn.com/powershell/archive/2009/01/27/managing-server-features-with-powershell-cmdlets-on-windows-2008-server-r2-beta.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-03T19:03:40.103

不幸的是，目前还没有一组 cmdlet，WMI 或任何其他易于访问的区域中也没有任何内容。有趣的是，Server Core 的基于脚本的角色管理功能仅适用于 Server Core :)。Windows 7 可能会在这方面带来一些缓解——但也可能不会。同时，您几乎只剩下另一个答案中提到的本机 Win32 API。

顺便说一句，我应该指出，出于安全考虑，MS 故意不希望应用程序安装主要的操作系统功能。添加 IIS 不是一件轻而易举的事，它带来了安全考虑和责任。见证 MS 自己的应用程序设置，它会检查类似的先决条件，但不提供为您安装它们。虽然我理解希望使您的应用程序设置尽可能轻松，但将主要功能放入操作系统中也会造成损害 :)。我个人更希望应用程序在谨慎方面犯错，告诉我他们需要什么，让我决定如何安装以及安装什么——尤其是打开端口并能够执行任意代码的主要功能，比如 IIS .

# c# - 如何从 URL 中提取 html？

> ID：337816
> 
> 赞同：0
> 
> 时间：2008-12-03T16:41:14.227
> 
> 标签：c#, .net

我有一个站点正在显示需要在另一个站点上显示的 html 内容（第一个站点是内容管理系统的前端）。

所以 site1 page = [http://site1/pagecontent](http://site1/pagecontent)

在站点 2 ( [http://site2/pagecontent](http://site2/pagecontent) ) 我需要能够显示站点 1 页面上显示的内容。

我正在使用 .Net C# (MVC)，不想只使用 iframe。

有没有办法将 html 吸入字符串变量？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T16:43:43.007

当然。请参阅[`System.Net.WebClient`](http://msdn.microsoft.com/en-us/library/system.net.webclient.aspx)类，特别是[`DownloadString()`](http://msdn.microsoft.com/en-us/library/system.net.webclient.downloadstring.aspx)方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T16:44:48.823

是的，您可以使用 WebClient 类：http: [//msdn.microsoft.com/en-us/library/system.net.webclient.aspx](http://msdn.microsoft.com/en-us/library/system.net.webclient.aspx)

```
WebClient wClient = new WebClient();
string s = wClient.DownloadString(site2); 
```

# vb6 - VB6 程序崩溃：第 2 部分。有关修复访问冲突 (0xC00000005) 的建议

> ID：337835
> 
> 赞同：0
> 
> 时间：2008-12-03T16:46:12.207
> 
> 标签：vb6, crash

与[这个问题有关](https://stackoverflow.com/questions/331901/vb6-capicom-crashes-on-winxp)。有关解决以下问题的任何建议？

在对该程序进行了大量实验后，我发现了几件事。

1.  在运行代码行时，它相对一致地崩溃（大约 90% 的时间）`Set Message = New CAPICOM.EncryptedData`，. 请注意，这上面的行仅仅是`Dim Message As CAPICOM.EncryptedData`.

2.  在程序执行的早期调用时，进行该调用的函数不会崩溃。对错误的二进制搜索无法找到问题，因为在某些地方神秘地调用该函数，不可靠地阻止了错误的发生。如果出现错误，有时重建程序似乎会产生影响。是的，它是一只海森虫。同样的问题也适用于错误的时间二分搜索。花了 5 个小时比较程序的两个版本，却发现两个版本都有错误，即使其中只有一个版本目前显示症状不是很有效。

3.  崩溃是由于访问冲突 0xC00000005

4.  运行 WinDbg（Windows 调试器）显示只有一行代码读取此内存位置，`LoadPicture(szTmpBMP)`. 它在一个可怕的函数结束时调用，该函数从资源中抓取图片并将其粘贴到临时文件中。我很害怕这个函数，为了测试，我用调用替换它`LoadPicture("testcra.bmp")`，然后没有为那个位图调用可怕的资源函数。这没有帮助。完全删除对 loadpicture 的调用也无济于事，尽管调试器无法再找到正在读取受影响内存的任何点，并且受影响的内存不再位于同一位置。此测试是在 VM 上完成的，因此调试器不一定能看到某些内存读取。

5.  一切都在 Vista 上完美运行（我的本地机器和 Vista 虚拟机）。访问冲突只发生在 XP 上。

6.  我正在使用 VB6 版本 8176、6.0.8169

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-03T22:03:08.510

我目前可行的解决方案是尽早创建我所有的 capicom 对象，并且永远不要创建第一个之后的 capicom.encrypteddata 的新实例。这行得通，但根本问题不太可能真正得到解决。

# asp.net - Handling ASP postbacks from Javascript Widget

> ID：337849
> 
> 赞同：0
> 
> 时间：2008-12-03T16:48:45.633
> 
> 标签：asp.net, javascript, vb.net, postback

I am trying to make a small, data-driven widget that is populated with data from a database on the fly. I can load it initially just fine, but when the index of an ASP DropDownMenu is changed, the widget returns a 404.

This could be a symptom of how I am using the Javascript, or how I am using the ASP. I honestly don't know for sure.

Javascript: [http://pastebin.com/f127d6b84](http://pastebin.com/f127d6b84)
ASP: [http://pastebin.com/f38c73708](http://pastebin.com/f38c73708)
VB.NET codebehind: [http://pastebin.com/f7881a903](http://pastebin.com/f7881a903)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T16:56:41.263

If the postback is returning 404, I'd look at the url that you're sending the postback to.

```
http://webwidgetstest.reeceandnichols.com/rDeskWidgetMLSt.aspx?agentname=jendene
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T16:59:38.467

Also your widget has some security issues going on, namely SQL Injection.

> Dim SelectString As String = "select ListingNumber, ListingSearchHitCount, ListingDetailHitCount, VirtualTourHitCount from FNIS.dbo.ListingHitCountCurrent, RAN.dbo.Heartland_Residential where Heartland_Residential.LIST_AGENT_1_ID = '" & Request("agentname") & "' and Heartland_Residential.MLS_Number = FNIS.dbo.ListingHitCountCurrent.ListingNumber and Heartland_Residential.Status = 'A'"

This inline SQL statement is not parameterizing the Request("agentname") field.

# c# - 夜间构建的 NUnit，如何轻松出错？

> ID：337853
> 
> 赞同：3
> 
> 时间：2008-12-03T16:50:26.300
> 
> 标签：c#, .net, unit-testing, automation

我们有很多单元测试，但它们并不是每晚都运行。我已经设置了一些批处理文件来编译来自 SVN 存储库的所有代码，并且我想运行 NUnit。这不是一个大问题，因为我可以在编译后从批处理文件中调用它，但输出存储在网络驱动器中，我需要每天早上打开它以检查是否发生错误。这就是问题所在。

您是否有更好的方法来执行相同的操作，即从存储库中获取代码、执行测试并在出现错误时以“更快捷方便的方式”告诉我？

**更新** 我已经安装了 Team City 4.0，它就像一个魅力。也许 Cruise Control .Net 也可以这样做，但 Team City 网站/文档/功能看起来更好。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-03T16:53:50.707

听起来你需要一个构建服务器。请参阅[巡航控制 .Net](http://sourceforge.net/projects/ccnet/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-03T18:12:03.903

我们最近开始在我们的项目中使用 TeamCity，到目前为止它看起来很棒。我们将它与 Subversion 和 NUnit 一起使用，并运行一个生成应用程序最终安装文件的外部程序。项目和构建配置非常容易设置。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T18:03:13.423

**[队城](http://www.jetbrains.com/teamcity/index.html)**呢？我仍在寻找，我已经看到他们的产品看起来能够做我正在寻找的东西。

[为什么当我看到这个Matrix](http://www.jetbrains.com/teamcity/documentation/featureMatrix.html)时， CruseControl.Net 获得如此多的投票，Team City 看起来更好......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-03T17:24:01.647

查看[从批处理文件发送电子邮件的最佳方式是什么？](https://stackoverflow.com/questions/337918/what-is-the-best-way-to-send-an-email-from-a-batch-file)

您需要做的就是扩展它以将日志文件输入到临时电子邮件文件中。

```
type NUnitLogFile.txt>>tmp.txt 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-03T18:43:42.453

我们有一个基于 FIT 的夜间测试驱动程序，带有一个用于在 DLL 上运行 NUnit 的特殊夹具。测试夹具捕获输出并查找最后的摘要行，说明有多少测试通过和失败。

我们面临的一个必然问题是如何方便地在 HTML 中显示完整的 NUnit 输出，而无需处理大量的 XSLT... 任何将控制台 NUnit 输出转换为 HTML 的实用程序？

# asp.net-mvc - 一个站点，多个客户端用户界面

> ID：337856
> 
> 赞同：0
> 
> 时间：2008-12-03T16:50:56.173
> 
> 标签：asp.net-mvc, routing

我有一个 Asp.net Mvc 站点，我想为不同的客户端提供单独的访问和用户界面，例如： [http://company1.mysite.com http://company2.mysite.com](http://company2.mysite.com) [http](http://company1.mysite.com) [://company3.mysite。 com](http://company3.mysite.com)

每个客户端都有不同的用户界面，但功能几乎相同（或禁用某些功能）。
我想为每个客户分离图形，如徽标、css 和图像。

实现它的最佳方式是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T17:21:21.230

你可以做很多事情。如前所述，第一级是使用不同的 CSS 文件。您可以通过创建 Helper 方法动态地将不同的路径放入您的 CSS 文件。所以它会像这样使用：

```
<link href="<%=AppHelper.GetCSSPath("mysite.css")%>" rel="stylesheet" type="text/css" /> 
```

这为您提供了一定程度的定制。更进一步的级别实际上是每个子站点都有不同的视图文件。您可以通过创建一个新的 ViewEngine 来做到这一点：

```
public class SubSiteViewEngine: WebFormViewEngine
{

  private string GetSiteRoot() {
   // some logic to get the site root from the incoming URL
  }

  public SubSiteViewEngine()
  {

    MasterLocationFormats = new[] { 
            GetSiteRoote() + "/Views/{1}/{0}.master", 
            GetSiteRoote() + "/Views/Shared/{0}.master" ,
            GetSiteRoote() + "/Views/Shared/MasterViews/{0}.master" 
        };
    ViewLocationFormats = new[] { 
            GetSiteRoote() + "/Views/{1}/{0}.aspx", 
            GetSiteRoote() + "/Views/{1}/{0}.ascx", 
            GetSiteRoote() + "/Views/Shared/{0}.aspx", 
            GetSiteRoote() + "/Views/Shared/{0}.ascx",
            GetSiteRoote() + "/Views/Shared/Controls/{0}.ascx" 
        };
    PartialViewLocationFormats = ViewLocationFormats;
  }

} 
```

希望有帮助。

PS 我很快就会为我自己的项目做这个，所以我应该很快就会有一些实际的工作代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T17:31:26.060

另一种选择是使用 IIS 进行安排。您必须检查对性能的影响，但通过这样做，您可以分别控制每个应用程序（或池）。

基本上，您所做的是为系统中的每个租户创建一个不同的网站。使其指向您的应用程序文件夹以获取实际的应用程序代码。然后应该使用指向其文件夹的虚拟目录添加变量内容（css，也许是文件库？发挥你的想象力;-)）。

通过使用这种方法，您将不会有由于意外错误等导致租户之间数据交叉的风险。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T16:52:51.770

您必须检查传入的 URL 并为每个 URL 提供不同的 CSS 文件。如果要在公司之间更改图像，可以使用背景图像。

其他建议：

*   为不同的公司保留单独的文件夹（并为常见的事情使用根目录）
*   如果您必须禁用某些功能，请不要询问公司名称，而是询问当前“个人资料”中是否允许。

    ```
    If Company = A then
       UseFunctionX = true
    else
       UseFunctionX = false

    //later in the code
    If UseFunctionX then
        // do domenthing 
    ```

    这样添加更多配置文件后更简单

# linux - 为什么这个 NASM 代码会打印我的环境变量？

> ID：337857
> 
> 赞同：2
> 
> 时间：2008-12-03T16:50:56.750
> 
> 标签：linux, assembly, nasm

这学期我刚完成一门计算机体系结构课程，除其他外，我们一直在涉足 MIPS 汇编并在 MARS 模拟器中运行它。今天，出于好奇，我开始在我的 Ubuntu 机器上摆弄 NASM，基本上只是从教程中拼凑起来，感受 NASM 与 MIPS 的不同之处。这是我目前正在查看的代码片段：

```
global _start

_start:

    mov eax, 4
    mov ebx, 1
    pop ecx
    pop ecx
    pop ecx
    mov edx, 200
    int 0x80
    mov eax, 1
    mov ebx, 0
    int 0x80 
```

这被保存为 test.asm，并用 .asm 组装`nasm -f elf test.asm`和链接`ld -o test test.o`。当我用 调用它时`./test anArgument`，它会按预期打印“anArgument”，然后是将该字符串填充到总共 200 个字符所需的字符数（由于该`mov edx, 200`语句）。然而，有趣的是，这些填充字符，我原以为是乱码，实际上是从我的环境变量的开头开始的，正如`env`命令所显示的那样。为什么这会打印出我的环境变量？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-03T16:55:07.973

在不知道实际答案或有时间查找的情况下，我猜测环境变量在命令行参数之后存储在内存中。您的代码只是缓冲区溢出到环境变量字符串中并打印它们。

这实际上是有道理的，因为命令行参数由系统/加载器处理，环境变量也是如此，因此它们彼此靠近存储是有意义的。要解决这个问题，您需要找到命令行参数的长度，并且只打印那么多字符。或者，因为我假设它们是空终止的字符串，所以打印直到达到零字节。

编辑：我假设命令行参数和环境变量都存储在初始化数据部分（NASM 中的 .data，我相信）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-04T07:00:24.557

为了理解为什么要获取环境变量，您需要了解内核如何在进程启动时安排内存。[这](http://asm.sourceforge.net/articles/startup.html)是一个很好的图片解释（向下滚动到“堆栈布局”）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T17:17:22.703

只要您好奇，您可能想弄清楚如何打印字符串的地址（我认为它已经传入，然后您将其从堆栈中弹出）。另外，编写一个十六进制转储例程，这样您就可以查看您感兴趣的内存和其他地址。这可以帮助您发现有关程序空间的信息。

好奇心可能是程序员工具箱中最重要的东西。

我没有调查启动进程的细节，但我认为每次启动一个新的 shell 时，都会为它制作一个环境副本。您可能会看到由您运行的命令或您编写的脚本等启动的 shell 的剩余部分。

# python - Python, Popen and select - waiting for a process to terminate or a timeout

> ID：337863
> 
> 赞同：22
> 
> 时间：2008-12-03T16:53:17.120
> 
> 标签：python, select, timeout, subprocess, popen

I run a subprocess using:

```
 p = subprocess.Popen("subprocess", 
                       stdout=subprocess.PIPE, 
                       stderr=subprocess.PIPE, 
                       stdin=subprocess.PIPE) 
```

This subprocess could either exit immediately with an error on stderr, or keep running. I want to detect either of these conditions - the latter by waiting for several seconds.

I tried this:

```
 SECONDS_TO_WAIT = 10
  select.select([], 
                [p.stdout, p.stderr], 
                [p.stdout, p.stderr],
                SECONDS_TO_WAIT) 
```

but it just returns:

```
 ([],[],[]) 
```

on either condition. What can I do?

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-03T17:06:30.480

Have you tried using the Popen.Poll() method. You could just do this:

```
p = subprocess.Popen("subprocess", 
                   stdout=subprocess.PIPE, 
                   stderr=subprocess.PIPE, 
                   stdin=subprocess.PIPE)

time.sleep(SECONDS_TO_WAIT)
retcode = p.poll()
if retcode is not None:
   # process has terminated 
```

This will cause you to always wait 10 seconds, but if the failure case is rare this would be amortized over all the success cases.

* * *

Edit:

How about:

```
t_nought = time.time()
seconds_passed = 0

while(p.poll() is not None and seconds_passed < 10):
    seconds_passed = time.time() - t_nought

if seconds_passed >= 10:
   #TIMED OUT 
```

This has the ugliness of being a busy wait, but I think it accomplishes what you want.

Additionally looking at the select call documentation again I think you may want to change it as follows:

```
SECONDS_TO_WAIT = 10
  select.select([p.stderr], 
                [], 
                [p.stdout, p.stderr],
                SECONDS_TO_WAIT) 
```

Since you would typically want to read from stderr, you want to know when it has something available to read (ie the failure case).

I hope this helps.

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-06-23T21:58:58.497

这就是我想出的。当您需要并且不需要在该进程上超时时工作，但有一个半忙循环。

```
def runCmd(cmd, timeout=None):
    '''
    Will execute a command, read the output and return it back.

    @param cmd: command to execute
    @param timeout: process timeout in seconds
    @return: a tuple of three: first stdout, then stderr, then exit code
    @raise OSError: on missing command or if a timeout was reached
    '''

    ph_out = None # process output
    ph_err = None # stderr
    ph_ret = None # return code

    p = subprocess.Popen(cmd, shell=True,
                         stdout=subprocess.PIPE,
                         stderr=subprocess.PIPE)
    # if timeout is not set wait for process to complete
    if not timeout:
        ph_ret = p.wait()
    else:
        fin_time = time.time() + timeout
        while p.poll() == None and fin_time > time.time():
            time.sleep(1)

        # if timeout reached, raise an exception
        if fin_time < time.time():

            # starting 2.6 subprocess has a kill() method which is preferable
            # p.kill()
            os.kill(p.pid, signal.SIGKILL)
            raise OSError("Process timeout has been reached")

        ph_ret = p.returncode

    ph_out, ph_err = p.communicate()

    return (ph_out, ph_err, ph_ret) 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-05-10T20:03:53.160

这是一个很好的例子：

```
from threading import Timer
from subprocess import Popen, PIPE

proc = Popen("ping 127.0.0.1", shell=True)
t = Timer(60, proc.kill)
t.start()
proc.wait() 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-03T17:52:16.643

使用*select*和 sleep 并没有多大意义。 *select*（或任何内核轮询机制）本质上对异步编程很有用，但您的示例是同步的。因此，要么重写代码以使用正常的阻塞方式，要么考虑使用 Twisted：

```
from twisted.internet.utils import getProcessOutputAndValue
from twisted.internet import reactor    

def stop(r):
    reactor.stop()
def eb(reason):
    reason.printTraceback()
def cb(result):
    stdout, stderr, exitcode = result
    # do something
getProcessOutputAndValue('/bin/someproc', []
    ).addCallback(cb).addErrback(eb).addBoth(stop)
reactor.run() 
```

顺便说一句，通过编写自己的 ProcessProtocol，使用 Twisted 有一种更安全的方法：

[http://twistedmatrix.com/projects/core/documentation/howto/process.html](http://twistedmatrix.com/projects/core/documentation/howto/process.html)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-11-11T20:44:32.060

## 蟒蛇 3.3

```
import subprocess as sp

try:
    sp.check_call(["/subprocess"], timeout=10,
                  stdin=sp.DEVNULL, stdout=sp.DEVNULL, stderr=sp.DEVNULL)
except sp.TimeoutError:
    # timeout (the subprocess is killed at this point)
except sp.CalledProcessError:
    # subprocess failed before timeout
else:
    # subprocess ended successfully before timeout 
```

请参阅[TimeoutExpired 文档](http://docs.python.org/3/library/subprocess.html#subprocess.TimeoutExpired)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-04T05:19:41.030

如果，正如您在上面的评论中所说，您只是每次调整输出并重新运行命令，是否会像下面这样工作？

```
from threading import Timer
import subprocess

WAIT_TIME = 10.0

def check_cmd(cmd):
    p = subprocess.Popen(cmd,
        stdout=subprocess.PIPE, 
            stderr=subprocess.PIPE)
    def _check():
        if p.poll()!=0:
            print cmd+" did not quit within the given time period."

    # check whether the given process has exited WAIT_TIME
    # seconds from now
    Timer(WAIT_TIME, _check).start()

check_cmd('echo')
check_cmd('python') 
```

上面的代码在运行时会输出：

```
python did not quit within the given time period. 
```

我能想到的上述代码的唯一缺点是当您继续运行 check_cmd 时可能会出现重叠的进程。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-03-11T15:36:08.533

这是对埃文的回答的解释，但它考虑了以下几点：

1.  显式取消 Timer 对象：如果 Timer 间隔很长并且进程将按其“自己的意愿”退出，这可能会挂起您的脚本 :(
2.  Timer 方法中有一个内在的竞争（定时器试图在进程死亡*后*立即终止进程，这在 Windows 上会引发异常）。

    ```
     DEVNULL = open(os.devnull, "wb")
      process = Popen("c:/myExe.exe", stdout=DEVNULL) # no need for stdout

      def kill_process():
      """ Kill process helper"""
      try:
         process.kill()
       except OSError:
         pass  # Swallow the error

      timer = Timer(timeout_in_sec, kill_process)
      timer.start()

      process.wait()
      timer.cancel() 
    ```

# data-structures - 想为“20 个问题”游戏将二叉树保存到磁盘

> ID：337868
> 
> 赞同：4
> 
> 时间：2008-12-03T16:53:58.977
> 
> 标签：data-structures, tree, binary-tree, savestate

简而言之，我想学习/开发一种优雅的方法来将二叉树保存到磁盘（一般树，不一定是 BST）。这是我的问题的描述：

我正在实施一个“20 个问题”的游戏。我写了一棵二叉树，其内部节点是问题，叶子是答案。如果有人对您当前的问题回答“是”，则节点的左孩子是您要遵循的路径，而右孩子是“否”的答案。请注意，这不是二叉*搜索*树，只是左孩子为“是”而右孩子为“否”的二叉树。

如果程序遇到一个为空的叶子，程序会通过要求用户将她的答案与计算机正在考虑的答案区分开来，将一个节点添加到树中。

这很简洁，因为树会在用户播放时自行构建。不整洁的是我没有将树保存到磁盘的好方法。

我考虑过将树保存为数组表示形式（对于节点 i，左子节点为 2i+1，右节点为 2i+2，父节点为 (i-1)/2），但它并不干净，我最终得到大量浪费空间。

关于将稀疏二叉树保存到磁盘的优雅解决方案的任何想法？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-03T16:55:20.143

我会做一个水平顺序遍历。也就是说你基本上是在做一个[广度优先的搜索](http://en.wikipedia.org/wiki/Breadth-first_traversal)算法。

你有：

1.  创建一个插入根元素的队列
2.  从队列中取出一个元素，称之为 E
3.  将 E 的左右子节点添加到队列中。如果没有左或右，就放一个空节点表示。
4.  将节点 E 写入磁盘。
5.  从第 2 步开始重复。

![替代文字](https://www.brianbondy.com/static/img/SO/simpleTree.jpg)

层序遍历序列：F、B、G、A、D、I、C、E、H

您将在磁盘上存储的内容：F、B、G、A、D、NullNode、I、NullNode、NullNode、C、E、H、NullNode

从磁盘加载它甚至更容易。只需从左到右读取您存储到磁盘的节点。这将为您提供每个级别的左右节点。即树将从上到下从左到右填充。

第 1 步读入：

```
F 
```

第2步读入：

```
 F 
B 
```

第 3 步读入：

```
 F 
 B  G 
```

第4步读入：

```
 F 
 B  G
A 
```

等等 ...

注意：一旦有了 NULL 节点表示，就不再需要将其子节点列出到磁盘。加载回来时，您将知道跳到下一个节点。所以对于非常深的树，这个解决方案仍然是有效的。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-03T17:11:50.173

您可以递归地存储它：

```
 void encodeState(OutputStream out,Node n) {
        if(n==null) {
            out.write("[null]");
        } else {
           out.write("{");
           out.write(n.nodeDetails());
           encodeState(out, n.yesNode());
           encodeState(out, n.noNode());
           out.write("}");
        }
  } 
```

设计自己的文本较少的输出格式。我确定我不需要描述读取结果输出的方法。

这是深度优先遍历。广度优先也有效。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T17:06:54.597

实现此目的的一种简单方法是在执行此操作时遍历输出每个元素的树。然后要重新加载树，只需遍历您的列表，将每个元素重新插入树中。如果您的树不是自平衡的，您可能需要重新排序列表，以使最终的树合理平衡。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-03T17:23:35.157

不确定它是否优雅，但它简单易懂：为每个节点分配一个唯一的 ID，无论是茎还是叶。一个简单的计数整数就可以了。

保存到磁盘时，遍历树，存储每个节点 ID、“是”链接 ID、“否”链接 ID 以及问题或答案的文本。对于空链接，使用零作为空值。您可以添加一个标志来指示是问题还是答案，或者更简单地说，检查两个链接是否为空。你应该得到这样的东西：

```
1,2,3,"Does it have wings?"
2,0,0,"a bird"
3,4,0,"Does it purr?"
4,0,0,"a cat" 
```

请注意，如果您使用顺序整数方法，则保存节点的 ID 可能是多余的，如此处所示。您可以按 ID 将它们排序。

要从磁盘恢复，请读取一行，然后将其添加到树中。您可能需要一个表或数组来保存前向引用的节点，例如在处理节点 1 时，您需要跟踪 2 和 3，直到您可以填写这些值。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-03T17:09:34.030

我会像这样存储树：

```
<node identifier>
node data
[<yes child identfier>
  yes child]
[<no child identifier>
  no child]
<end of node identifier> 
```

其中子节点只是上述的递归实例。[] 中的位是可选的，四个标识符只是常量/枚举值。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-03T17:12:05.460

最随意的简单方式只是可以用来表示任何图形的基本格式。

```
<parent>,<relation>,<child> 
```

IE：

```
"Is it Red", "yes", "does it have wings" 
"Is it Red", "no" , "does it swim" 
```

这里没有*太多*冗余，并且格式大多是人类可读的，唯一的数据重复是它拥有的每个直接孩子都必须有一个父母的副本。

您真正需要注意的唯一一件事是您不会意外生成循环；）

除非那是你想要的。

> 这里的问题是之后重建树。如果我在阅读第一行时创建了“它有翅膀”对象，那么当我后来遇到“它有翅膀”、“是的”、“它有喙吗？”这行时，我必须以某种方式找到它。

这就是为什么我传统上只使用内存中的图形结构来处理指针无处不在的事情。

```
[0x1111111 "Is It Red"           => [ 'yes' => 0xF752347 , 'no' => 0xFF6F664 ], 
 0xF752347 "does it have wings"  => [ 'yes' => 0xFFFFFFF , 'no' => 0x2222222 ], 
 0xFF6F664 "does it swim"        => [ 'yes' => "I Dont KNOW :( " , ... etc etc ] 
```

那么“子/父”连接只是元数据。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-12-09T05:54:33.557

在java中，如果你要使一个类可序列化，你可以将类对象写入磁盘并使用输入/输出流将其读回。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-09-29T23:20:00.120

这是使用 PreOrder DFS 的 C++ 代码：

```
void SaveBinaryTreeToStream(TreeNode* root, ostringstream& oss)
{
    if (!root)
    {
        oss << '#';
        return;
    }

    oss << root->data;
    SaveBinaryTreeToStream(root->left, oss);
    SaveBinaryTreeToStream(root->right, oss);
}
TreeNode* LoadBinaryTreeFromStream(istringstream& iss)
{
    if (iss.eof())
        return NULL;

    char c;
    if ('#' == (c = iss.get()))
        return NULL;

    TreeNode* root = new TreeNode(c, NULL, NULL);
    root->left  = LoadBinaryTreeFromStream(iss);
    root->right = LoadBinaryTreeFromStream(iss);

    return root;
} 
```

在`main()`中，您可以执行以下操作：

```
ostringstream oss;
root = MakeCharTree();
PrintVTree(root);
SaveBinaryTreeToStream(root, oss);
ClearTree(root);
cout << oss.str() << endl;
istringstream iss(oss.str());
cout << iss.str() << endl;
root = LoadBinaryTreeFromStream(iss);
PrintVTree(root);
ClearTree(root);

/* Output:
               A

       B               C

   D               E       F

     G           H   I
ABD#G###CEH##I##F##
ABD#G###CEH##I##F##
               A

       B               C

   D               E       F

     G           H   I
 */ 
```

DFS 更容易理解。

```
********************************************************************************* 
```

但是我们可以使用队列来使用级别扫描 BFS

```
ostringstream SaveBinaryTreeToStream_BFS(TreeNode* root)
{
    ostringstream oss;

    if (!root)
        return oss;

    queue<TreeNode*> q;
    q.push(root);

    while (!q.empty())
    {
        TreeNode* tn = q.front(); q.pop();

        if (tn)
        {
            q.push(tn->left);
            q.push(tn->right);
            oss << tn->data;
        }
        else
        {
            oss << '#';
        }
    }

    return oss;
}
TreeNode* LoadBinaryTreeFromStream_BFS(istringstream& iss)
{
    if (iss.eof())
        return NULL;

    TreeNode* root = new TreeNode(iss.get(), NULL, NULL);
    queue<TreeNode*> q; q.push(root); // The parents from upper level
    while (!iss.eof() && !q.empty())
    {
        TreeNode* tn = q.front(); q.pop();

        char c = iss.get();
        if ('#' == c)
            tn->left = NULL;
        else
            q.push(tn->left = new TreeNode(c, NULL, NULL));

        c = iss.get();
        if ('#' == c)
            tn->right = NULL;
        else
            q.push(tn->right = new TreeNode(c, NULL, NULL));
    }

    return root;
} 
```

在`main()`中，您可以执行以下操作：

```
root = MakeCharTree();
PrintVTree(root);
ostringstream oss = SaveBinaryTreeToStream_BFS(root);
ClearTree(root);
cout << oss.str() << endl;
istringstream iss(oss.str());
cout << iss.str() << endl;
root = LoadBinaryTreeFromStream_BFS(iss);
PrintVTree(root);
ClearTree(root);

/* Output:
               A

       B               C

   D               E       F

     G           H   I
ABCD#EF#GHI########
ABCD#EF#GHI########
               A

       B               C

   D               E       F

     G           H   I
 */ 
```

# python - 使用 pythonw.exe 时 Python subprocess.call() 失败

> ID：337870
> 
> 赞同：5
> 
> 时间：2008-12-03T16:54:17.227
> 
> 标签：python, multithreading, subprocess

当我使用 python.exe 运行它时，我有一些 Python 代码可以正常工作，但如果我使用 pythonw.exe 会失败。

```
    def runStuff（命令行）：
        outputFileName = 'somefile.txt'
        输出文件 = 打开（输出文件名，“w”）

        尝试：
            结果 = subprocess.call(commandLine, shell=True, stdout=outputFile)
        除了：
            print '抛出异常：', str(sys.exc_info()[1])

    myThread = threading.Thread(None, target=runStuff, commandLine=['whatever...'])
    myThread.start()

```

我得到的信息是：

```
    抛出异常：[错误 6] 句柄无效

```

但是，如果我不指定 'stdout' 参数， subprocess.call() 可以正常启动。

我可以看到 pythonw.exe 可能正在重定向输出本身，但我不明白为什么我被阻止为新线程指定标准输出。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-03T17:26:53.463

`sys.stdin`和`sys.stdout`句柄是无效的，因为 pythonw 在作为守护进程运行时不提供控制台支持，因此默认参数`subprocess.call()`失败。

守护程序故意关闭 stdin/stdout/stderr 并改用日志记录，因此您必须自己管理：我建议使用 subprocess.PIPE。

如果您*真的*不关心子流程对错误和所有内容的说明，您可以使用`os.devnull`（我不确定它的便携性如何？）但我不建议这样做。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-22T14:19:21.973

作为记录，我的代码现在如下所示：

```
def runStuff(commandLine):
    outputFileName = 'somefile.txt'
    outputFile = open(outputFileName, "w")

    if guiMode:
        result = subprocess.call(commandLine, shell=True, stdout=outputFile, stderr=subprocess.STDOUT)
    else:
        proc = subprocess.Popen(commandLine, shell=True, stdout=subprocess.PIPE, stderr=subprocess.STDOUT, stdin=subprocess.PIPE)
        proc.stdin.close()
        proc.wait()
        result = proc.returncode
        outputFile.write(proc.stdout.read()) 
```

请注意，由于 subprocess 模块中的一个明显错误，对 Popen() 的调用也必须为 stdin 指定一个管道，然后我们立即关闭它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-08-22T18:09:19.477

这是一个老问题，但 pyInstaller 也发生了同样的问题。

事实上，任何在没有控制台的情况下将 python 中的代码转换为 exe 的框架都会发生这种情况。

在我的测试中，我观察到如果我在我的规范文件 (pyInstaller) 中使用标志“console=True”，则不再发生错误。.

解决方案是遵循 Piotr Lesnicki 的建议。

# javascript - var self = 这个？

> ID：337878
> 
> 赞同：191
> 
> 时间：2008-12-03T16:55:39.270
> 
> 标签：javascript, jquery, scope, closures

使用实例方法作为事件处理程序的回调将范围`this`从*"My instance"*更改为*"Whatever just called the callback"*。所以我的代码看起来像这样

```
function MyObject() {
  this.doSomething = function() {
    ...
  }

  var self = this
  $('#foobar').bind('click', function(){
    self.doSomethng()
    // this.doSomething() would not work here
  })
} 
```

它有效，但这是最好的方法吗？我觉得很奇怪。

* * *

## 回答 #1

> 赞同：218
> 
> 时间：2008-12-03T17:58:14.540

这个问题不是特定于 jQuery，而是一般特定于 JavaScript。核心问题是如何在嵌入式函数中“引导”变量。这是一个例子：

```
var abc = 1; // we want to use this variable in embedded functions

function xyz(){
  console.log(abc); // it is available here!
  function qwe(){
    console.log(abc); // it is available here too!
  }
  ...
}; 
```

这种技术依赖于使用闭包。但它不起作用，`this`因为`this`它是一个伪变量，可以动态地从范围更改为范围：

```
// we want to use "this" variable in embedded functions

function xyz(){
  // "this" is different here!
  console.log(this); // not what we wanted!
  function qwe(){
    // "this" is different here too!
    console.log(this); // not what we wanted!
  }
  ...
}; 
```

我们能做些什么？将其分配给某个变量并通过别名使用它：

```
var abc = this; // we want to use this variable in embedded functions

function xyz(){
  // "this" is different here! --- but we don't care!
  console.log(abc); // now it is the right object!
  function qwe(){
    // "this" is different here too! --- but we don't care!
    console.log(abc); // it is the right object here too!
  }
  ...
}; 
```

`this`在这方面不是唯一的：`arguments`是另一个应该以相同方式处理的伪变量——通过别名。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-12-03T17:11:05.713

是的，这似乎是一个共同的标准。一些编码员使用自我，其他人使用我。它被用作对“真实”对象的引用，而不是事件。

这是我花了一点时间才真正理解的东西，起初看起来确实很奇怪。

我通常在我的对象顶部执行此操作（请原谅我的演示代码 - 它比其他任何东西都更具概念性，并且不是关于优秀编码技术的课程）：

```
function MyObject(){
  var me = this;

  //Events
  Click = onClick; //Allows user to override onClick event with their own

  //Event Handlers
  onClick = function(args){
    me.MyProperty = args; //Reference me, referencing this refers to onClick
    ...
    //Do other stuff
  }
} 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2016-09-12T22:39:31.690

如果您正在执行 ES2015 或执行类型脚本和 ES5，那么您可以在代码中使用箭头函数并且您不会遇到该错误，这指的是您在实例中所需的范围。

```
this.name = 'test'
myObject.doSomething(data => {
  console.log(this.name)  // this should print out 'test'
}); 
```

作为解释：在 ES2015 中，箭头函数`this`从其定义范围中捕获。普通函数定义不这样做。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2015-04-26T18:07:11.230

```
var functionX = function() {
  var self = this;
  var functionY = function(y) {
    // If we call "this" in here, we get a reference to functionY,
    // but if we call "self" (defined earlier), we get a reference to function X.
  }
} 
```

编辑：尽管如此，对象内的嵌套函数采用全局窗口对象而不是周围对象。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2016-06-01T18:55:50.690

`bind`一种解决方案是使用 javascript 的方法将所有回调绑定到您的对象。

您可以使用命名方法执行此操作，

```
function MyNamedMethod() {
  // You can now call methods on "this" here 
}

doCallBack(MyNamedMethod.bind(this)); 
```

或者使用匿名回调

```
doCallBack(function () {
  // You can now call methods on "this" here
}.bind(this)); 
```

这样做而不是求助于`var self = this`表明您了解绑定`this`在 javascript 中的行为方式并且不依赖于闭包引用。

此外，ES6 中的胖箭头运算符基本上与调用`.bind(this)`匿名函数相同：

```
doCallback( () => {
  // You can reference "this" here now
}); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-03T17:16:16.340

我没有使用过 jQuery，但是在像 Prototype 这样的库中，您可以将函数绑定到特定范围。因此，考虑到这一点，您的代码将如下所示：

```
 $('#foobar').ready('click', this.doSomething.bind(this)); 
```

bind 方法返回一个新函数，该函数在您指定的范围内调用原始方法。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-10-29T21:56:31.200

只需在 ES6 中添加这一点，因为[箭头函数](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions)，您不需要这样做，因为它们捕获了`this`值。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-03T17:10:06.790

我认为这实际上取决于你要在你的`doSomething`函数中做什么。如果您要`MyObject`使用此关键字访问属性，那么您必须使用它。但我认为，如果您不使用`object(MyObject)`属性做任何特殊的事情，以下代码片段也将起作用。

```
function doSomething(){
  .........
}

$("#foobar").ready('click', function(){

}); 
```

# javascript - 有谁知道创建基于 MVC 的组件/扩展方法的好文章？

> ID：337891
> 
> 赞同：2
> 
> 时间：2008-12-03T16:59:24.847
> 
> 标签：javascript, asp.net-mvc, controls, extension-methods

我已经为几个项目开发了几种扩展方法，它们目前严重依赖一些 AJAX 来使零碎工作。问题是他们需要将 JavaScript 文件复制并粘贴到您想要使用它的项目中。

由于这个 JavaScript 文件只需要使用一次（渲染控件的所有实例都使用同一个文件），我想做一些事情，比如将 script 元素添加到通过 web 资源使用的页面的 headers 集合中（将文件作为资源嵌入程序集中）。在 Web 表单中这不是问题 - 您可以将脚本块添加到具有特定 ID 的标题中，并在页面加载时简单地检查它。

什么是 MVC 等价物 - 有没有等价物？

我想要一个不需要消费者复制和粘贴/添加行到页面或配置的解决方案......有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T19:50:27.717

好了，这家伙写了一个自定义的 FormlessScriptManager，即使你的页面中没有 <form runat="server"> ，它也可以让你注册脚本。

[http://developmentalmadness.blogspot.com/2008/04/abstracting-systemwebuiscriptmanager.html](http://developmentalmadness.blogspot.com/2008/04/abstracting-systemwebuiscriptmanager.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T20:35:25.567

Stephen Walther 有一些关于 MVC 的非常好的文章，包括 Html Helpers。 [http://weblogs.asp.net/stephenwalther](http://weblogs.asp.net/stephenwalther)。

查看 Html Helpler 代码的好地方是 [Codeplex](http://www.codeplex.com/aspnet)上提供的 MVC 源代码。

[www.asp.net/mvc](http://www.asp.net/mvc)上有一个关于 Html Helpers的教程

# ajax - 如何在 ASP.net 3.5 中禁用 ASP.net AJAX 框架

> ID：337896
> 
> 赞同：2
> 
> 时间：2008-12-03T17:00:07.527
> 
> 标签：ajax, asp.net-3.5

我正在使用 MooTools 作为 AJAX 框架的 ASP.net 3.5 网站。我想禁用 ASP.net 的 AJAX 框架，使其表现得更像 ASP.net 2.0。这是为了减少页面加载时间并减少不兼容性。这可能吗？如果可以，我该怎么做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T19:14:59.317

我能够从引用中删除 System.Web.Extensions 程序集，然后我找到并删除了 ScriptManager 控件的所有实例。

一旦我这样做了，任何 AJAX 框架的东西都不会呈现到页面上。

我想为 LINQ 和其他爵士乐保留 3.5，因此仅针对 2.0 框架是行不通的。

感谢您的提示。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T17:35:32.900

我看过一些关于如何在 .net 3.5 框架中提高 asp.net ajax 性能的文章。就是找不到链接。但是您可以在 web.config 中进行一些更改，以提高性能。但是，如果你想使用 MooTools，我想你可以删除程序集并删除 web.config 中的所有引用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T17:43:17.877

有几种方法可以做到这一点。如果您在创建项目/网站时使用 Visual Studio 2008，请确保您以 .net framework 2.0 为目标。如果您不使用任何带有框架 3.5 的控件/扩展器，您将不会引用任何 3.5 程序集。为确保这一点，请查看 web.config 文件并解决问题。

我看到您正在寻找使用 moo 工具，上面提到的用于自定义 javascript 内容的设置和 jquery 应该可以完成您的工作。

据我所知，这就是我所能说的。

快乐编码！

# asp.net - What's the reason for my ASP.NET Cache never expiring, despite having a sliding expiration time set?

> ID：337897
> 
> 赞同：5
> 
> 时间：2008-12-03T17:00:30.537
> 
> 标签：asp.net, caching

So, I've cached a value using the ASP.NET Cache object, with the following code:

```
Cache.Insert("TEST_VALUE", 150, null, Cache.NoAbsoluteExpiration, TimeSpan.FromSeconds(120)); 
```

As I understand it, this should mean that if nothing accesses that object for 120 seconds, it will expire and return null.

However, if after 10 minutes I run a page which writes out that value from the cache, it's still there. I know there's nothing else accessing it because this is all on a local server on my machine.

Am I just not getting how this should work, or have I missed something else?

# .net - 在 WPF 中显示第二个表单

> ID：337901
> 
> 赞同：0
> 
> 时间：2008-12-03T17:02:08.257
> 
> 标签：.net, wpf, vb.net

我有一个主表单和一个子表单。我需要主表单来显示子表单并将对象传递给构造函数。子表单完成后，它需要自行销毁，以便可以重复循环。

目前我在全球范围内声明了子表单

```
Public GlobalWindowBookmark As WindowEditBookmark 
```

然后我创建表单并将对象传递给它。

```
GlobalWindowBookmark = New WindowEditBookmark(CType(_MenuBookmark, BookmarkItem))
GlobalWindowBookmark.Visibility = Windows.Visibility.Visible 
```

这只是感觉不对，并且还允许多个窗口。任何帮助，将不胜感激。

谢谢，

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-03T17:10:50.580

您是否希望子表单成为模态对话框 - 即不允许用户在主表单启动时与其交互？如果是这样，你可以这样做（对不起，如果我的 VB 不完全正确，我通常使用 C#）：

```
Dim wndBookmark as New WindowEditBookmark(CType(_MenuBookmark, BookmarkItem))
wndBookmark.ShowDialog() 
```

还有一个 Show 方法，它显示窗口但不使其成为模态。如果您不希望子表单成为模态，这可能会有所帮助。

# java - How can you ensure in java that a block of code can not be interrupted by any other thread

> ID：337903
> 
> 赞同：12
> 
> 时间：2008-12-03T17:02:27.430
> 
> 标签：java, multithreading, synchronization, thread-priority

exampl:

```
new Thread(new Runnable() {
  public void run() {
    while(condition) {

      *code that must not be interrupted*

      *some more code*
    }
  }
}).start();

SomeOtherThread.start();

YetAntherThread.start(); 
```

How can you ensure that *code that must not be interrupted* won't be interrupted?

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-03T17:17:34.933

你不能——至少不能使用普通的 Java，在普通的非实时操作系统上运行。即使其他线程不会中断您的线程，其他*进程*也可能会这样做。基本上，在您完成之前，您将无法保证自己拥有一个 CPU。如果你想要这种保证，你应该使用 Java Real-Time System 之类的东西。我对此知之甚少，不知道这是否肯定会提供您想要的设施。

*最好*的办法是首先避免该要求。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-03T17:32:16.107

假设您只关心应用程序级线程争用，并假设您愿意按照其他人的建议对锁大惊小怪（恕我直言，这是*一个非常糟糕的主意*），那么您应该使用`ReadWriteLock`而不是简单的对象同步：

```
import java.java.util.concurrent.locks.*;

// create a fair read/write lock
final ReadWriteLock rwLock = new ReentrantReadWriteLock(true);

// the main thread grabs the write lock to exclude other threads
final Lock writeLock = rwLock.writeLock();

// All other threads hold the read lock whenever they do 
// *anything* to make sure the writer is exclusive when 
// it is running. NOTE: the other threads must also 
// occasionally *drop* the lock so the writer has a chance 
// to run!
final Lock readLock = rwLock.readLock();

new Thread(new Runnable() {
  public void run() {
    while(condition) {

      writeLock.lock();
      try {
        *code that must not be interrupted*
      } finally {
        writeLock.unlock();
      }

      *some more code*
    }
  }
}).start();

new SomeOtherThread(readLock).start();
new YetAntherThread(readLock).start(); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-03T17:34:52.030

实际上，如果您控制正在运行的线程实例，则*可以执行此操作。*显然，对此有很多警告（例如挂起 io 操作），但本质上您可以子类化 Thread 并覆盖 interrupt() 方法。然后，您可以放置​​某种布尔值，这样当您翻转标志时，线程上的 interrupt() 调用要么被忽略，要么更好地存储以供以后使用。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-03T18:11:39.990

你真的需要留下更多的信息。

除非您在实时操作系统上运行，否则您无法阻止其他系统进程的执行。你是这个意思吗？

除非您运行实时 Java，否则您无法停止垃圾收集等。那是你想要的吗？

剩下的唯一一件事是：如果您只是希望所有其他 java 线程不要相互中断，因为它们都倾向于在不受控制的情况下随意访问某些资源，那么您做错了。正确设计它，以便同步需要以同步方式访问的对象/数据，然后不要担心其他线程会中断您，因为您的同步对象是安全的。

我错过了任何可能的情况吗？

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-03T21:09:59.787

## 使用同步方法（在此处发布的各种形式）根本没有帮助。

这种方法仅有助于确保**一个线程****一次**执行关键部分，但这不是您想要的。您需要防止线程被中断。

读/写锁似乎有帮助，但没有任何区别，因为没有其他线程正在尝试使用写锁。

它只会使应用程序变慢一点，因为 JVM 必须执行额外的验证来执行同步部分（仅由一个线程使用，因此浪费 CPU）

实际上，按照您的方式，线程并没有“*真正*”被中断。但它似乎确实如此，因为它必须为其他线程提供 CPU 时间。线程的工作方式是；CPU 让每个线程有机会在很短的时间内运行一段时间。即使是在单个线程运行时，该线程也会与其他应用程序的其他线程产生 CPU 时间（假设单处理器机器以保持讨论简单）。

这可能是您认为线程不时暂停/中断的原因，因为系统让应用程序中的每个线程运行一段时间。

**所以，你可以做什么？**

为了增加没有中断的感觉，您可以做的一件事是为您的线程分配更高的优先级，并在其余部分降低它。

如果所有线程具有相同的优先级，则线程 1、2、3 的一个可能调度可能是这样的：

*平均分配*

```
1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3 
```

虽然将最大值设置为 1，将最小值设置为 2,3，但它可能是这样的：

*更多 CPU 到线程 1*

```
1,1,1,2,1,1,3,1,1,1,2,1,1,1,3,1,2,1,1,1 
```

对于要被另一个线程中断的线程，它必须处于可中断状态，通过调用 Object.wait、Thread.join 或 Thread.sleep 来实现

下面是一些有趣的代码进行实验。

* * *

代码1：测试如何改变线程的优先级。查看输出上的模式。

```
public class Test {
    public static void main( String [] args ) throws InterruptedException {
        Thread one = new Thread(){
            public void run(){
                while ( true ) {
                    System.out.println("eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee");
                }
            }
        };
        Thread two = new Thread(){
            public void run(){
                while ( true ) {
                    System.out.println(".............................................");
                }
            }
        };
        Thread three = new Thread(){
            public void run(){
                while ( true ) {
                    System.out.println("------------------------------------------");
                }
            }
        };

        // Try uncommenting this one by one and see the difference.

        //one.setPriority( Thread.MAX_PRIORITY );
        //two.setPriority( Thread.MIN_PRIORITY );
        //three.setPriority( Thread.MIN_PRIORITY );
        one.start();
        two.start();
        three.start();

        // The code below makes no difference
        // because "one" is not interruptable
        Thread.sleep( 10000 ); // This is the "main" thread, letting the others thread run for aprox 10 secs.
        one.interrupt();  // Nice try though.
    }
} 
```

代码 2\. 一个线程如何被实际中断的示例（在这种情况下是在休眠时）

```
public class X{
    public static void main( String [] args ) throws InterruptedException  {
        Thread a = new Thread(){ 

            public void run(){ 

                int i = 1 ; 
                while ( true ){ 
                    if ( i++ % 100 == 0 ) try {
                        System.out.println("Sleeping...");
                        Thread.sleep(500);
                    } catch ( InterruptedException ie ) {
                        System.out.println( "I was interrpted from my sleep. We all shall die!! " );
                        System.exit(0);
                    }
                    System.out.print("E,"); 
                }
            }

         };
        a.start();

        Thread.sleep( 3000 ); // Main thread letting run "a" for 3 secs. 
        a.interrupt(); // It will succeed only if the thread is in an interruptable state
    }
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-03T18:14:27.567

在线程被中断之前，会调用安全管理器的 checkAccess() 方法。实现你自己的安全管理器，调用 System.setSecurityManager 来安装它，并确保它在临界区时不会让任何其他线程打断你。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-05-04T16:56:35.157

错误处理是一个用例示例，在该用例中，阻止线程被中断非常有用。假设您有一个大型多线程服务器，并且出现了一些外部条件，导致在多个工作线程上同时检测到错误。每个工作线程都会生成一个发生错误的通知。让我们进一步说，期望的响应是使服务器进入安全状态，允许它在错误条件清除后重新启动。

实现此行为的一种方法是为服务器设置一个状态机，以总顺序处理状态更改。一旦错误通知到达，您将其放入状态机中，并让状态机在不中断的情况下对其进行处理。这是您希望避免中断的地方——您希望第一个通知导致错误处理程序运行。进一步的通知不应中断或重新启动它。这听起来很简单，但实际上并非如此——假设状态机将服务器置于联机状态。您*可能*希望中断它以让错误处理运行。所以有些事情是可以中断的，但有些事情不是。

如果您中断错误处理线程，它可能会在同步方法处理期间将错误处理程序从水中吹走，从而使对象处于潜在的脏状态。这是问题的症结所在——线程中断绕过 Java 中的正常同步机制。

这种情况在正常应用中很少见。然而，当它确实出现时，结果可能是难以预料的拜占庭式失败，更不用说治愈了。答案是保护这些关键部分免受中断。

据我所知，Java 并没有为您提供阻止线程被中断的机制。即使这样做了，您也可能不想使用它，因为中断很容易发生在低级库中（例如，TCP/IP 套接字处理），其中关闭中断的影响可能非常不可预测。

相反，处理这个问题的最佳方法似乎是以不发生此类中断的方式设计您的应用程序。我是一个名为 Tungsten FSM ( [https://code.google.com/p/tungsten-fsm](https://code.google.com/p/tungsten-fsm) ) 的小型状态机包的作者。FSM 实现了一个简单的有限状态机，可确保按总顺序处理事件。我目前正在修复错误，以解决此处描述的问题。FSM 将提供一种解决此问题的方法，但还有许多其他方法。我怀疑它们中的大多数都涉及某种状态机和/或事件队列。

如果您采取防止中断的方法，如果不可中断线程由于某种原因被阻塞，它当然会产生另一个问题。那时，您只是被卡住了，必须重新启动该过程。这似乎与 Java 线程之间的死锁没有什么不同，这实际上是不可中断线程被阻塞的一种方式。对于 Java 中的这类问题，真的没有免费的午餐。

我花了很多时间研究这样的问题——它们很难诊断，更不用说解决了。Java 并没有真正很好地处理这种并发问题。很高兴听到更好的方法。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-10-06T22:51:27.133

我认为你需要锁定一个中断标志。像这样的东西怎么样（未经测试）：

```
new Thread() {
    boolean[] allowInterrupts = { true };

    @Override
    public void run() {
        while(condition) {
            allowInterrupts[0] = false;
            *code that must not be interrupted*
            allowInterrupts[0] = true;
            *some more code*
        }
    }

    @Override
    public void interrupt() {
        synchronized (allowInterrupts) {
            if (allowInterrupts[0]) {
                super.interrupt();
            }
        }
    }
}.start();

SomeOtherThread.start();

YetAntherThread.start(); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-01-11T21:44:19.317

只需启动您自己的子线程，并确保中断调用永远不会过滤到它。

```
new Thread(new Runnable() {
  public void run() {
    Thread t = new Thread() {
      public void run() {
        *code that must not be interrupted*
      }
    }
    t.start(); //Nothing else holds a reference to t, so nothing call call interrupt() on it, except for your own code inside t, or malicious code that gets a list of every live thread and interrupts it.

      while( t.isAlive() ) {
        try {
          t.join();
        } catch( InterruptedException e ) {
          //Nope, I'm busy.
        }
      }

      *some more code*
    }
  }
}).start();

SomeOtherThread.start();

YetAntherThread.start(); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-03T17:09:17.870

Best halfway solution would be to synchronize all threads on some common object so that no other threads are runnable while you're in the critical section.

Other than that I do not think it's possible. And I'm quite curious as to what kind of problem that requires this type of solution ?

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2018-11-05T20:17:22.833

通常的程序不会随机中断线程。所以如果你开始一个新的`Thread`并且你没有传递对 this 的引用`Thread`，你可以很确定没有什么会打断它`Thread`。

在大多数情况下，保持对私有的引用就`Thread`足够了。其他一切都会很糟糕。

通常，当被要求这样做时，像这样的工作队列`ExecutorService`会打断他们的工作队列。`Thread`在这些情况下，您需要处理中断。

# windows - 从批处理文件发送电子邮件的最佳方式是什么？

> ID：337918
> 
> 赞同：3
> 
> 时间：2008-12-03T17:08:39.010
> 
> 标签：windows, email, batch-file

我有一个夜间批处理作业，可以判断它是否失败。我希望它向我发送一封电子邮件，如果它发送，可能带有附件。

如何从 Windows 批处理 (.bat) 文件发送电子邮件？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-03T17:18:28.053

[布拉特](http://www.blat.net/)。无需多言。;)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-03T17:17:22.453

如果安装了作为 IIS 一部分的 SMTP 服务器，您可以使用 Echo 命令将文件写入拾取文件夹，然后将其发送。

```
echo From: test@example.com>tmp.txt
echo To: test@example.com>>tmp.txt
echo Subject: hello>>tmp.txt
echo.>>tmp.txt
echo Hello world>>tmp.txt
copy tmp.txt \Inetpub\mailroot\Pickup 
```

# c# - C# 语法 - 从方法中获得 2 或 3 个答案的首选实践

> ID：337925
> 
> 赞同：8
> 
> 时间：2008-12-03T17:10:54.637
> 
> 标签：c#, .net, syntax, parameters, tuples

我只是想知道其他开发人员如何解决从方法中获得 2 或 3 个答案的问题。

1) 返回一个对象[]
2) 返回一个自定义类
3) 在多个变量上使用 out 或 ref 关键字
4) 编写或借用 (F#) 一个简单的 Tuple<> 泛型类
[http://slideguitarist.blogspot.com/2008 /02/whats-f-tuple.html](http://slideguitarist.blogspot.com/2008/02/whats-f-tuple.html)

我现在正在处理一些可以刷新数据的代码。从进行刷新的方法中，我想传回（1）刷新开始时间和（2）刷新结束时间。
以后我可能想传回第三个值。

想法？开源 .NET 项目在这个主题上有什么好的做法吗？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-12-03T17:15:17.263

这完全取决于结果是什么。如果它们彼此相关，我通常会创建一个自定义类。

如果它们不是真正相关的，我会使用 out 参数或拆分方法。如果一个方法想要返回三个不相关的项目，它可能做得太多了。例外情况是当您在 Web 服务边界或其他“更纯粹”的 API 可能过于冗长的情况下交谈时。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-12-03T17:12:30.950

两个，通常是 4)

不仅如此，2)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-03T17:37:29.403

您的问题指出您将来可能会返回更多数据，因此我建议您实现自己的类来包含数据。

这意味着即使您传递的对象的内部表示发生变化以容纳更多数据，您的方法签名也将保持不变。出于可读性和封装的原因，这也是一种很好的做法。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-03T17:19:12.373

明智的代码架构当需要更改特定数量的变量时，我总是使用自定义类。为什么？仅仅因为类实际上是常用数据类型的“蓝图”，创建自己的数据类型（在这种情况下就是这样）将帮助您获得良好的结构并帮助其他人为您的接口编程。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-03T18:20:29.737

就个人而言，我讨厌 out/ref 参数，所以我宁愿不使用这种方法。此外，大多数情况下，如果您需要返回多个结果，您可能做错了什么。

如果它真的是不可避免的，那么从长远来看，你可能会最开心地编写一个自定义类。返回一个数组很诱人，因为它在短期内既简单又有效，但是使用类可以让您选择在将来更改返回类型，而不必担心会导致下游问题。想象一下，如果有人交换返回的数组中两个元素的顺序，那么可能会发生调试噩梦......

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-03T17:13:32.837

如果它只有 1 个或 2 个附加变量，我会使用 out（例如，一个函数返回一个 bool，它是实际的重要结果，但也有一个 long 作为 out 参数，用于返回函数运行的时间，用于记录目的）。

对于更复杂的事情，我通常会创建一个自定义结构/类。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-03T17:14:46.547

我认为 C# 程序员执行此操作的最常见方式是将要返回的项目包装在单独的类中。恕我直言，这将为您提供最大的灵活性。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-03T17:16:36.997

这取决于。对于仅限内部的 API，我通常会选择最简单的选项。一般都是这样的。

对于公共 API，自定义类通常更有意义 - 但如果它是相当原始的东西，或者函数的自然结果是布尔值（如 *.TryParse），我将坚持使用 out 参数。您也可以使用隐式强制转换为 bool 来创建自定义类，但这通常很奇怪。

对于您的特定情况，一个简单的不可变 DateRange 类对我来说似乎最合适。您可以轻松添加新价值，而不会打扰现有用户。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-03T17:37:30.637

如果您想发回刷新开始时间和结束时间，则建议使用可能的类或结构，可能称为 DataRefreshResults。如果您可能的第三个值也与刷新有关，则可以添加它。请记住，结构总是按值传递，因此在堆上分配它不需要进行垃圾收集。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-03T20:05:07.437

有些人使用`KeyValuePair`两个值。但这并不是很好，因为它只是将这两个东西标记为`Key`和`Value`。不是很描述。此外，它还会从添加以下内容中受益匪浅：

```
public static class KeyValuePair
{
    public static KeyValuePair<K, V> Make(K k, V v) 
    { 
        return new KeyValuePair<K, V>(k, v); 
    }
} 
```

使您不必在创建类型时指定类型。泛型方法可以推断类型，泛型类构造函数不能。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-20T12:18:34.947

对于您的场景，您可能希望定义通用 Range{T} 类（检查范围有效性）。

如果方法是私有的，那么我通常使用[我的助手库](http://rabdullin.com/journal/2008/9/30/using-tuples-in-c-functions-and-dictionaries.html)中的元组。公共或受保护的方法通常总是值得分开。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-12-20T12:23:30.367

返回自定义类型，但不要使用类，使用结构 - 没有内存分配/垃圾收集开销意味着没有缺点。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-03T17:28:12.323

如果是 2，则为一对。

如果超过2个班。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-12-03T18:39:47.047

另一种解决方案是返回命名对象引用的字典。对我来说，这相当于使用自定义返回类，但没有混乱。（并且使用 RTTI 和反射，它与任何其他解决方案一样类型安全，尽管是动态的。）

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-12-20T12:30:46.217

这取决于结果的类型和含义，以及方法是否是私有的。

对于私有方法，我通常只使用我的类库中的元组。

对于公共/受保护/内部方法（即非私有），我使用 out 参数或自定义类。

例如，如果我正在实现 TryXYZ 模式，其中有一个在失败时抛出异常的 XYZ 方法和一个返回布尔值的 TryXYZ 方法，TryXYZ 将使用一个 out 参数。

如果结果是面向序列的（即返回应该处理的 3 个客户），那么我通常会返回某种集合。

除此之外，我通常只使用自定义类。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-12-20T12:39:05.967

If a method outputs two to three related value, I would group them in a type. If the values are unrelated, the method is most likely doing way too much and I would refactor it into a number of simpler methods.

# macos - 如何在 Mac OS X 上的 GTK 中检测 alt/option 键是否关闭？

> ID：337939
> 
> 赞同：1
> 
> 时间：2008-12-03T17:14:11.913
> 
> 标签：macos, gtk, pygtk, alt-key

我想检测在 Mac OS X 上的 GTK 中鼠标拖动期间是否按下了 alt/option 键。我正在使用 pygtk。通常，按住 alt 会将 MOD1_MASK 添加到 event.state，但 alt 确实会影响 event.state。在按键事件中，alt 显示为 gtk.keysyms.kana_switch，但这对于我的目的来说还不够，因为用户可能会在不同的应用程序中按下 alt 并通过单击切换到我的。

是否有可用的设置会导致 alt/option 在 event.state 中显示为修饰符？或者，即使按键按下事件发生在不同的应用程序中，是否有一种方法可以检测按键当前是否按下？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-03-27T12:06:44.557

我认为你应该使用`gtk.accelerator_get_default_mod_mask()`
[http://library.gnome.org/devel/gtk/unstable/checklist-modifiers.html](http://library.gnome.org/devel/gtk/unstable/checklist-modifiers.html)

# c# - 如何将图像添加到 ListView 列标题？

> ID：337942
> 
> 赞同：0
> 
> 时间：2008-12-03T17:14:58.060
> 
> 标签：c#, .net, listview

应该很容易吧？有一个列表视图，添加一个图像列表，将图像添加到图像列表，将图像索引分配给您想要的列。
但是，它不起作用。
[Microsoft 文章](http://support.microsoft.com/kb/314933)指出这是 .NET 1.1 中的一个已知问题。
但是从那以后它被修复了吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-04T14:25:26.093

您仍然必须使用互操作。我建议您使用文章中给出的示例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2017-02-27T12:01:35.163

我确实喜欢这个 1)made imagelist1

2) 设置 listviewlarge=imagelist1 & smallImagelist = imagelist1

3)写入形成初始化区域this.Columname0.ImageIndex = 0; this.Columname1.ImageIndex = 1;

这是工作。

# css - SharePoint - 更改主题样式表

> ID：337953
> 
> 赞同：2
> 
> 时间：2008-12-03T17:17:12.127
> 
> 标签：css, sharepoint, themes

我在共享点门户中使用 Belltown 主题，并且我想在 Belltown 样式表中更改一些样式。我认为我可以编辑位于以下位置的 theme.css 文件：

C:\Program Files\Common Files\Microsoft Shared\web 服务器扩展\12\TEMPLATE\THEMES\BELLTOWN

并重新启动 Web 服务器，但样式表对我来说并没有改变。我应该编辑什么文件来更改主题的样式表，或者我还缺少其他步骤吗？

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-03T17:42:33.387

我相信，如果您将 Belltown 主题重新应用到您的网站，它会接受您的更改。当您应用主题时，Sharepoint 会将 TEMPLATE\THEMES\ *THEME 文件夹*的内容复制到站点。

另一种选择是将 Sharepoint Designer 指向该站点并修改那里的样式以直接应用它们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-04T14:27:00.287

部署新样式表可能是一个迭代过程。因此，使用Heather Solomon 的博客中描述的[CSS 导入技巧可能会有所帮助。](http://www.heathersolomon.com/blog/articles/brandsppart2.aspx)

这可能很有帮助，因为您不必在每次更改样式表时都重新应用主题。只需更改文件系统上的文件并刷新浏览器页面。

# coldfusion - 访问 IIS 虚拟目录中的脚本

> ID：337959
> 
> 赞同：2
> 
> 时间：2008-12-03T17:17:37.617
> 
> 标签：coldfusion, iis-6

我有一个 IIS 6 服务器，其虚拟目录指向另一台机器上的网络共享。该 Web 服务器还提供 ColdFusion 脚本。当我访问驻留在虚拟目录中的常规 HTML 页面时，它们会得到正确的服务。但是，每当我尝试访问 ColdFusion 脚本时，ColdFusion 都会引发“找不到文件”错误。

我错过了一步吗？我还需要在 ColdFusion 中做些什么来告诉它该虚拟目录中的文件实际存在的位置吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-03T17:39:40.037

这听起来像是您可能需要更改 ColdFusion 运行的权限，而现在它没有足够的权限来访问网络共享。

要更改权限或用户 CF 在以下运行：

1.  开放服务
2.  查找 CF 服务（取决于您的版本，它可能以 Macromedia 开头...）
3.  右键，打开属性
4.  点击登录
5.  然后更改它登录的帐户或更改当前用户的权限。
6.  单击确定、应用等...

我很确定您将不得不退回 CF 服务。

# asp.net - 如何将使用 Ajax webmethods 的 ASP.NET 页面转换为启用 Ajax 的服务器控件？

> ID：337978
> 
> 赞同：3
> 
> 时间：2008-12-03T17:23:04.143
> 
> 标签：asp.net, ajax, clientscript, servercontrol

在[我正在阅读的本教程](http://encosia.com/2007/07/11/why-aspnet-ajax-updatepanels-are-dangerous/)中，Dave Ward 创建了一个页面，该页面在标签中显示服务器日期，而不使用更新面板。

我正在尝试学习如何创建使用 ajax 进行部分回发的服务器控件，其中控件中的方法是从同一控件生成的客户端脚本调用的，我认为学习如何将此页面转换为服务器控件将有助于我理解servercontrols 使用什么而不是 webmethods 来将它们的方法公开给 clientscript。

我完全按照文章中的说明创建了页面、代码隐藏和 javascript，并让示例正常工作。

因此，为了开始尝试将其转换为服务器控件，我将页面的 Dave Javascript 移动到文件 ~tests/JScript.js 中：

```
 function UpdateTime() {
   PageMethods.GetCurrentDate(OnSucceeded, OnFailed); 
 }

 function OnSucceeded(result, userContext, methodName) {
   $get('Literal1').innerHTML = result; 
 }

 function OnFailed(error, userContext, methodName) {
   $get('Literal1').innerHTML = "An error occured.";
 } 
```

并将以下类放在我的 App_Code 中：

```
namespace foo
{
    /// <summary>
    /// Summary description for ServerControlTest
    /// </summary>
    public class ServerControlTest : CompositeControl, IScriptControl
    {
        ScriptManager sm;
        protected override void OnPreRender(EventArgs e)
        {
            if (!this.DesignMode)
            {
                // Test for ScriptManager and register if it exists
                sm = ScriptManager.GetCurrent(Page);

                if (sm == null)
                    throw new HttpException("A ScriptManager control must exist on the current page.");

                sm.RegisterScriptControl(this);
                sm.EnablePageMethods = true;
            }

            base.OnPreRender(e);
        }

        protected override void OnLoad(EventArgs e)
        {
            Literal lit = new Literal();
            lit.Text = "<span ID=\"Literal1\" runat=\"server\">test</span><input id=\"Button1\" type=\"button\" value=\"button\"  onclick=\"UpdateTime();\" />";

            this.Controls.Add(lit);
        }
        protected override void Render(HtmlTextWriter writer)
        {
            if (!this.DesignMode)
                sm.RegisterScriptDescriptors(this);

            base.Render(writer);
        }

        [WebMethod]
        public static string GetCurrentDate()
        {
            return DateTime.Now.ToString();
        }

        #region IScriptControl Members

        IEnumerable<ScriptDescriptor> IScriptControl.GetScriptDescriptors()
        {
            return null;
        }

        IEnumerable<ScriptReference> IScriptControl.GetScriptReferences()
        {
            ScriptReference reference = new ScriptReference();
            reference.Path = ResolveClientUrl("~/tests/JScript.js");

            return new ScriptReference[] { reference };
        }

        #endregion
    }
} 
```

现在，在我的示例页面中，当我单击按钮时，出现此错误： **PageMethods is not defined [Break on this error] PageMethods.GetCurrentDate(OnSucceeded, OnFailed);**

如何从我的控件注册的客户端脚本中调用 GetCurrentDate？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-03T17:33:46.710

从 v3.5 开始，实际上还没有完全封装的方法可以针对服务器控件的方法实现 AJAX 回调。这是一个非常令人沮丧的限制。

最常见的解决方案是在服务器控件的程序集中创建一个 HttpHandler，然后要求在 web.config 中注册处理程序。例如，看看 ASP.NET AJAX 的 ScriptResource.axd 是如何连接到 ASP.NET AJAX 1.0 的 web.config 中的。

# iphone - iPhone 上的 COMET（服务器推送到客户端）

> ID：337985
> 
> 赞同：19
> 
> 时间：2008-12-03T17:24:52.407
> 
> 标签：iphone, objective-c, cocoa-touch, http, comet

我正在寻找从我的服务器到我的 iPhone 应用程序的某种套接字/COMET 类型的功能。本质上，只要用户设法在服务器上设置任意对象“脏”，比如更新他们的地址……反馈应该从服务器推送到任何保持对服务器进行实时轮询的客户端。我想这个流行语是彗星。我知道有用于 Web 浏览器应用程序的 DWR，所以我在想，也许最好在我的每个控制器中设置一个隐藏的 UIWebView，这样我就可以从他们的 javascript 框架中开箱即用 COMET？有没有更优雅的方法？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-03T18:20:06.743

有几个解决方案可用于使用[STOMP](http://stomp.codehaus.org/Protocol)客户端。

STOMP 非常简单轻巧，非常适合 iPhone。

我用[这个](http://code.google.com/p/stompframework/)作为我的起点，发现它非常好。它有一些对象分配/内存泄漏问题，但是一旦我掌握了 iPhone 编程的窍门，这些问题就很容易解决了。

希望有帮助！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-13T10:21:03.777

你能在你的应用程序中使用普通的 TCP/IP 套接字吗？

A）如果是，那么原始 TCP/IP 套接字绝对是更优雅的解决方案。在您的 iPhone 应用程序中，您只需等待通知事件。只要您的应用程序打开，套接字就会打开。如果您愿意，您甚至可以使用 HTTP 协议/标头。

在服务器端，您可以使用一些框架来编写有效处理数千个打开的 TCP/IP 连接的服务器。例如[Twisted](http://twistedmatrix.com/trac/)、[EventMachine](http://rubyeventmachine.com/)或[libevent](http://www.monkey.org/~provos/libevent/)。然后只需将服务器主套接字绑定到 http 端口（80）。

这个想法是使用一个服务器，每个客户端只保留一个数据结构。从某个数据库应用程序接收更新事件，然后将其推送到正确的客户端。

B) 不，您必须在 iPhone 端使用 Apache 和 http 客户端。**那么您应该知道，整个 COMET 解决方案实际上是针对 HTTP 协议和 Apache / PHP 的限制而工作的。**

Apache 旨在处理许多短时间连接。据我所知，只有最新版本的 Apache（mpm worker）可以有效地处理大量打开的连接。以前 Apache 为每个连接保留一个进程。

Web 浏览器对一个 Web 服务器的并发打开连接有限制（实际上是 URL 地址，例如 www.foo.com，而不是 www.foo.com 的 IP 地址）。并且限制是 2 个连接。此外，浏览器将只允许 AJAX 连接到从其下载主 HTML 页面的同一服务器。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-03T18:30:51.527

我写了一个[网络服务器](http://github.com/dustin/slosh)来做这种事情。我正在通过长时间轮询的服务器推送实时更新，例如，我[在 iPhone 上进行了 safari](http://skitch.com/dlsspy/78xd/savvy-view-on-iphone)显示该数据。

一个给定的服务器实例应该能够处理几千个并发客户端，而不用太费力。我有一个计划将它们放在一个层次结构中，以允许更多的水平缩放（应该很简单，但不会影响我当前的应用程序）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-11-20T16:11:58.157

[WebSync](http://www.frozenmountain.com/websync)有一个可以在 iPhone 上运行的 javascript 客户端，如果你想要的话

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-20T06:43:08.540

长时间轮询会为您想要实现的目标工作吗？您可以在几行常规 Javascript 中实现客户端，这将比任何框架都轻。

在 ObjC 中实现它也很简单（连接，等待响应或超时，重复）

我的问题的答案[简单的“长轮询”示例代码？](https://stackoverflow.com/questions/333664/simple-long-polling-example-code)希望能解释一下长轮询是多么简单..

基本上，您只需像往常一样请求一个 URL - Web 服务器将接受连接，但在可用之前不会发送任何数据。当您收到数据或连接超时时，您重新连接（并重复）

最复杂的一点是服务器服务器端，因为您不能使用像 Apache 这样的常规线程 Web 服务器，尽管 Comet 也是如此。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-05-29T07:31:18.410

[StreamHub Comet Server 开箱即可](http://www.stream-hub.com/)与 iPhone 配合使用，无需任何插件或任何东西。只需在我的 iPhone 上浏览他们的网站，所有示例都有效，不需要安装 Flash 或任何东西。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-11T01:41:24.787

您是否希望/已经通过 http 为您的应用程序进行通信？如果没有，您可以使用 CFNetwork 框架使用套接字 (TCP/UDP) 来允许您的应用程序和服务器进行通信。从我所看到的 CFNetwork 堆栈来看，它非常酷，并且可以非常严格地读取和写入流，并允许同步和异步通信。它还允许您在套接字上定义回调，从而让您获得有关接收到数据、建立连接等事件的通知。因此，在您的示例中，您可以通过套接字将信息发送到服务器，然后您可以定义一个回调将侦听流上的传入数据，然后相应地更新您的应用程序。

编辑：做了更多的研究，如果你采用套接字方法，你可能还想看看 NSStream 类。它们是构建在 CFSocket 之上的 Cocoa 抽象。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-16T13:24:06.893

你没有提到你正在使用什么服务器端技术。但如果它是 microsoft .net（或任何其他遇到此问题的谷歌用户），comet 有一个简单的选项：http: [//www.codeplex.com/ncomet](http://www.codeplex.com/ncomet)。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-03-16T23:15:52.743

COMET、LightStreamer、AJAX 所有这些垃圾都被破坏了。TCP 的基础是，如果没有 ping 流量，就无法保证“保持活动”。因此，如果要保证任何体面的可靠性或及时交付，您可以忘记长轮询。

这只是 2003 年跛脚狂热开始时每个人都看到的炒作。

# vb.net - VB.Net 中的表单

> ID：337986
> 
> 赞同：2
> 
> 时间：2008-12-03T17:25:29.317
> 
> 标签：vb.net, winforms

我来自 ac# 背景，正在将一个 vb.net windows 窗体应用程序转换为 c#。我有一个名为 associateForm 的 Windows 窗体。在代码中，开发人员引用关联表单如下：-

```
Private Sub NotifyIcon1_MouseClick(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles EMS.MouseDoubleClick
    If e.Button = Windows.Forms.MouseButtons.Left Then

        If associateForm.WindowState = FormWindowState.Normal And associateForm.Visible = True Then
            associateForm.WindowState = FormWindowState.Minimized
        Else
            associateForm.WindowState = FormWindowState.Normal
        End If

        associateForm.Show()
        associateForm.Focus()
        'bring to front of other windows
        associateForm.Activate()
    End If
End Sub 
```

但问题是 associateForm 没有在执行该方法的类中实例化。类也不是静态的。代码中的任何地方似乎也没有该类的实例。任何人都可以阐明为什么这似乎有效，但是当我在 C# 中尝试这个时，它没有任何意义。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-03T17:29:15.630

.Net 2.0 及更高版本的 VB.Net 具有称为默认表单实例的东西。当你定义一个表单时，你会得到一个与类型同名的表单的自动实例。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-03T19:09:29.390

前面的评论有几处有问题。Joel 的答案基本上是正确的，但有一点需要注意：

> 当你定义一个表单时，你会得到一个与类型同名的表单的自动实例。

*实际上，您仅在调用*实例时才获得该实例。在此之前，不会创建默认实例。因此，实例创建被推迟到使用时间。

使用表单的名称作为实例实际上是 的快捷方式`My.Forms.Formname`，它是编译器生成的所有表单的属性列表。这些属性负责对象的创建。不幸的是，微软决定让这些属性在全球范围内隐式可用（因此是 OP 的问题）。

> 之所以存在此功能，是因为 VB.NET 模拟了 VB6 方法，即能够通过其名称引用表单的默认实例。

好。虽然此功能*的*灵感来自以前版本的 VB，但它并不是直接继承的。VB 7 没有。相反，它是在 VB 8 (= VB 2005) 中重新引入的。

> 一个非常愚蠢的“功能”

实际上，它是一个非常有用的功能，与 VB 的 RAD 开发理念相得益彰。如上所述，不幸的是采用了如此宽松的范围。但除此之外，我很想*听听*这个功能有什么“愚蠢”的地方。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T18:19:18.430

乔尔是对的。之所以存在此功能，是因为 VB.NET 模拟了 VB6 方法，即能够通过其名称引用表单的默认实例。

当您将其转换为 C# 时，您需要提供对名为 associateForm 的单个实例的全局访问。有可能在调用此表单之间保留某些内容。在你成功地让它以这种方式工作之后。然后，您可以重构软件并测试以查看本地实例化是否可以正常工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-04T09:27:04.853

我不能直接回答你的问题，但是...

我猜您正在手动从 VB.Net 转换为 C# - 您是否尝试过使用[自动转换器](http://www.vbconversions.net/)？

# asp.net - 将 Web 服务器从 ASP.NET 1.1/2.0 更新到 3.5

> ID：337987
> 
> 赞同：1
> 
> 时间：2008-12-03T17:25:31.597
> 
> 标签：asp.net, iis

我对 ASP.NET 开发还很陌生，所以请多多包涵。

我将在 ASP.NET 1.1 网站的更新版本上开始开发，我将在 ASP.NET 3.5 中进行开发。目前，我的开发服务器允许我在 1.1 和 2.0 上运行网站。我已经安装了 3.5 框架，但是还有其他我应该知道的配置/问题吗？该服务器将需要继续运行 ASP.NET 1.1 网站以及我将开发的 3.5 网站。

提前致谢。

编辑：虽然我安装了 .NET 3.5 框架，但当我进入 IIS 并创建一个新的虚拟目录时，它只给了我 1.1 或 2.0 的选项。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-03T17:30:35.533

您可以将每个站点（实际上，如果需要，也可以是每个虚拟目录）设置为使用特定版本的运行时。

您应该没有其他配置问题。如果服务器设置为运行 2.0 站点，那么您就可以开始了，因为针对 3.5 编写的站点使用 2.0 运行时，如果可用，还会加上 3.5 位。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-03T17:33:26.603

这就是你要找的：

[http://www.hanselman.com/blog/HowToSetAnIISApplicationOrAppPoolToUseASPNET35RatherThan20.aspx](http://www.hanselman.com/blog/HowToSetAnIISApplicationOrAppPoolToUseASPNET35RatherThan20.aspx)

# java - 如何在 Java webapp 中测试 HttpSessionListener.sessionDestroyed？

> ID：337992
> 
> 赞同：1
> 
> 时间：2008-12-03T17:27:24.307
> 
> 标签：java, session, tomcat

一个人如何在会话监听器中模拟触发 HttpSessionListener.sessionDestroyed 对象？

只是将Tomcat会话超时设置为1然后等待唯一的方法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-03T17:51:31.387

使用[`HttpSession.invalidate()`](http://java.sun.com/webservices/docs/1.6/api/javax/servlet/http/HttpSession.html#invalidate()). 或者，您可以拨打[`setMaxInactiveInterval()`](http://java.sun.com/webservices/docs/1.6/api/javax/servlet/http/HttpSession.html#setMaxInactiveInterval(int))一个小号码（即 1）。这不太可靠，因为无法保证 Tomcat 何时会销毁会话。

# project-management - 如何不着急？

> ID：337995
> 
> 赞同：6
> 
> 时间：2008-12-03T17:28:06.597
> 
> 标签：project-management

我经常发现我在某个功能上做得不够完整，尤其是在设计阶段。我检测到几个原因：

1.  我过于乐观
2.  我觉得有必要提供快速的解决方案，所以有时我自欺欺人地认为设计是万无一失的，而实际上它仍然充满漏洞，只是为了更快地完成工作。当然，我最终会付出高昂的代价。

我知道我的这种行为有一段时间了，但我仍然发现我无法弥补。你遇到过类似的问题吗？你如何解决它们？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-03T18:07:28.657

我使用了几种技术。第一个是简单的纸质待办事项清单。早上我会写下当天的任务。我试着完成一项任务，直到我能把它划掉。只有当我完成了自己的满意时，我才会把它划掉。我的待办事项清单帮助我保持专注。当有干扰出现时，我可以有意识地选择是否重要到足以打断我现在正在做的事情。

我使用的第二种技术是放弃设计“完成”的想法。相反，我专注于我开始称之为“成功”的东西，即设计经历了可预测的阶段。每个阶段都很好地支持当前的功能，并将在下一阶段的某个时间点成功。这让我可以做得很好，一份我可以引以为豪的工作，而不会过度设计。

我的直觉是这样的继承的小目录（如[http://www.threeriversinstitute.org/FirstOneThenMany.html](http://www.threeriversinstitute.org/FirstOneThenMany.html)）将涵盖大部分设计。与此同时，我试着记住“每天的烦恼已经够多了”。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-03T17:39:15.687

我经常遇到这个问题。

我的解决方案是笔记本。（老式的纸种）。

我将我计划如何将解决方案实施为项目符号概述列表，然后我尝试充实列表中的每个点。

在这个过程中，我经常会遇到我没有想到的问题。

当然，80/20 规则仍然适用……当我实际执行实施时，我仍然会遇到一些我没有想到的事情，但是随着经验的积累，这些事情往往会减少。

编辑：如果我在这个过程结束时仍然不确定，我会组装一个一次性原型测试平台......确保它是一次性的很重要，因为否则你冒着在你的真实代码库中包含一些讨厌的黑客的风险。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-03T17:52:02.040

在项目的规划阶段，尤其是在软件开发领域，错过边缘案例和细节是很常见的。请不要觉得这是个人的失败；这是地方病。

为了解决这个问题，出现了许多软件开发*方法*。最近，许多开发团队已经转向“敏捷”方法，重点是快速开发，几乎没有前期技术设计（毕竟，许多复杂性只有在您真正开始开发时才会发现）。我目前正在使用 Scrum 系统，这在我的小团队中非常出色：

[http://en.wikipedia.org/wiki/Agile_methods](http://en.wikipedia.org/wiki/Agile_methods)

[http://en.wikipedia.org/wiki/Scrum_%28development%29](http://en.wikipedia.org/wiki/Scrum_%28development%29)

如果您发现您的组织不会接受他们可能认为是方法上的根本转变，那么可能值得调查他们是否会同意开发原型系统。这意味着您可以编写一个功能来调查所涉及的技术并判断它是否可行，而不必承诺全面开发、质量标准、测试计划等。一旦可行性得到证明或证明，原型应该被丢弃，然后可能会开始适当的开发，包括您在此过程中学到的所有知识。

如果您的问题与时间管理更相关，那么我建议您使用 Getting Things Done 方法（[http://en.wikipedia.org/wiki/Getting_things_done](http://en.wikipedia.org/wiki/Getting_things_done)）。这是务实而简单的，专注于提高您的工作效率，而不会让您因与当前工作没有直接关系的信息而超负荷。我发现我有时会被项目/功能想法所淹没，当我有可用资源有效工作时，将所有内容写下来并归档以备后用确实很有帮助。

我希望这会有所帮助，祝你好运！

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-03T18:13:47.427

沟通。

避免让自己陷入编程错误的最好方法是沟通。是的，良好的老式问责制。如果办公室里的另一个人参与了这个过程，结果就越好。如果程序员只是承担任务而不关心其他任何人，那么出错的可能性就更高。

责任清单：

1.  我们如何支持这一点？
2.  谁需要知道发生了什么变化？
3.  为什么我们首先要这样做？
4.  会有人不想改变吗？
5.  别人会明白我是怎么做到的吗？
6.  用户将如何感知和使用这种变化？

持怀疑态度的同志通常足以提供帮助。功能规范很好，它们通常会回答所有这些想法。但是，有时与另一个人的谈话可以帮助你，你可以更快地做出改变。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-03T22:03:46.480

既然你意识到你需要提供一个快速的解决方案，那么如果你在设计上花费更多的前期时间，你可能会更慢地意识到你可以更快地解决问题并更快地交付它。例如，如果您花 3 小时设计和 30 小时编写代码，这可能意味着如果您花 6 小时设计，您可能只需要花 10 小时编写代码。（这些不是实际数字，只是示例）。您可能会尝试在接下来的几个项目中自己量化这一点。做一些你平时会做的事情，看看你实际做的设计/代码编写/测试和调试的比例是多少。然后在下一个项目中故意增加您在设计阶段花费的时间百分比，看看它是否确实缩短了其他阶段所需的时间。您还必须为此尝试多个项目以获得真正的基线，因为这些项目可能完全不同。如果您在设计上多花 20% 或 50% 或 100% 的时间，则将其作为测试，看看您是否可以提高其他阶段的性能，从而交付更快的产品。

请记住，在流程的后期，您发现设计的问题越难（也越费时）修复。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-03T21:22:47.233

我喜欢像其他人在这里所说的那样做。用伪代码写下你的应用程序的流程。这立即突出了一些可能需要进一步注意的详细领域，这些领域在前面并不明显。

伪代码对于可以验证您的方法是否满足其需求的业务用户也是可读的。

使用伪代码还可以创建一组很好的方法，这些方法可以用作最终解决方案中的接口。一旦伪代码相当紧凑，寻找模式并查看一些常见的 GOF 模式。它们不一定是完美的，但使用它们可以使您在以后的修订过程中不必重写代码。

只需花一两个小时编写伪代码，就可以在以后节省一些宝贵的时间：1\. 出现一个对象模型 2\. 程序的流程已为其他人明确定义 3\. 它可以用作您的设计文档并进行一些改进 4 . 注释更容易添加，并且对于其他审查您的代码的人来说会更清晰。

祝你好运！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-03T21:47:03.457

我发现确保您选择了一个好的设计的最佳方法是确保您了解问题，了解您的局限性，并了解哪些东西是必备品和好品。

了解问题将涉及与有需要的人交谈，并让他们专注于需要首先完成的事情，而不是他们认为应该如何完成的事情。一旦你知道实际必须发生什么，你就可以回去讨论如何做的要求。

知道你的限制可能很容易：需要在 iPhone 上运行；必须是网络应用程序；需要与现有的 Java 代码和部署设置集成；等等。这可能相当困难：您不知道您的用户群的潜在规模是多少（数百？数千？数百万？）；你不知道你是否需要本地化它（虽然如果你不确定，假设你必须这样做）。

必备品与必备品：这可能是最困难的部分。用户经常对“要求”（“它应该看起来像 Excel”）有情感依恋，而这实际上并不是“必须发生”的事情的一部分。您经常需要在功能与期望之间进行权衡，以获得可接受的实现。你不能总是给每个人一匹小马。

确保你把这一切都写下来！即使它一直在发展，或者设计很小，当你需要做出关于提交资源的决定时，有一个“这就是我们现在计划做的”指南来参考，这会让你更容易抑制自己实施一个非常酷的快速功能，而不是无聊的必须做的事情。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-03T17:43:39.810

通过多年的错误（尽管仍然犯错误），我了解到几乎任何我想重复使用或分发的东西都需要正确设计。因此，被烧到足够多的时间会结束你的乐观情绪。

当受到管理层的压力时，我告诉他们无论如何我都必须考虑，所以我应该在便宜的时候去做。我也在纸上思考，所以我实际上可以证明我正在做某事并且它让我的手指保持在键盘上，这两者都为管理提供了舒缓的效果。;-)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-03T17:55:03.610

冒着听起来很明显的风险——悲观。我有一些经历，我认为“这应该需要几个小时”，但由于所有意外弹出的小事情，最终需要*几天时间。*

到目前为止，我发现管理事物的最佳方法是（很像 Andrew 的回答）写出设计和要求作为起点。然后我会仔细检查设计中的弱点、陷阱和其他用例等。我尝试将其视为一项关键练习——还没有编写代码，所以现在是时候彻底无情并寻找每一个弱点。寻找您必须处理的错误情况，以及您认为完成每个特性/功能需要多少时间，将这个数量填充很多。我曾经有过把最初的估计翻倍的时候，但仍然没有那么远。

作为一个程序员，实际地预测调试时间是非常困难的——编写代码很容易估计，但是将其调试为有效的、有效的代码完全是另外一回事。因此，我发现它没有精确的科学性，但我只是将一大堆任务填充，这样我就有足够的喘息空间进行调试。

另请参阅[基于证据的调度](http://www.joelonsoftware.com/items/2007/10/26.html)，这是 FogCreek 为他们的 FogBugz 产品开发的调度中的一个迷人概念。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-03T17:55:21.473

你和世界其他地方。

您需要更详细的设计、更准确的估计，并且愿意接受有时最佳解决方案不一定是最佳解决方案（例如，您可以在汇编程序中编写一些循环以获得最佳性能，但这需要很多时间不仅仅是做

```
for (i=1; i<=10; i++) {} 
```

）。花费在导弹系统上的会计软件包的时间真的值得吗？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-03T18:08:42.897

我喜欢设计，但随着时间的推移，我发现很多前期设计很像在空中建造城堡 - 太多的猜测，无论受过良好教育，缺少实际实施和使用设计的关键反馈。

所以今天我更愿意接受这样一个事实，即在实施设计时我*会*学到很多关于它的新东西，并且需要将这些学习反馈到设计中。这样做是一种有趣的学习技能，包括通过保持简单、没有重复、内聚和解耦来保持设计灵活性的技能，以小的可控步骤（=重构）更改设计，并编写必要的广泛的自动化测试套件，使此类更改安全。

对我来说，这似乎是一种比在“预先设计推测”方面做得更好的方法更有效的方法——此外，它让我同样为由于需求中不可预见的变化而需要更改设计的不可避免时刻做好了准备.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-03T18:22:24.350

分，分，分。列出完成项目所需的所有步骤，然后列出这些步骤需要完成的所有步骤*，**依此*类推，直到你达到你绝对确定可以在一天或更短的时间内完成的原子项目。添加所有这些值的持续时间以得出时间长度。

然后加倍。现在你有一个数字，如果令人沮丧，至少在某种程度上是现实的。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-03T18:24:38.467

如果可能，在发布之前“睡上你的设计”。我发现下班后，我通常会想起我错过的事情。这通常发生在我躺在床上睡前甚至第二天洗澡的时候。

我还发现有一个我信任的同行/朋友在分发之前审查我所拥有的内容是很有价值的。其他人几乎总是看到我没有想到或误传的东西。****`*********