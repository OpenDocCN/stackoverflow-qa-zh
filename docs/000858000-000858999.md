# StackOverflow 问答 000858000-000858999

# asp.net - 在 DataBound 事件上获取绑定到 ListView 的数据

> ID：858001
> 
> 赞同：14
> 
> 时间：2009-05-13T13:40:32.367
> 
> 标签：asp.net, listview

我有一个 ListView 控件，并且在控件中添加了一个 DataBound 事件（不知道这是否正确）。

我想从此事件访问绑定到该特定 ItemTemplate 的数据，这可能吗？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-08-13T15:25:52.150

# C# 解决方案

```
protected void listView_ItemDataBound(object sender, ListViewItemEventArgs e)
{        
    if (e.Item.ItemType == ListViewItemType.DataItem)
    {
        ListViewDataItem dataItem = (ListViewDataItem)e.Item;
        // you would use your actual data item type here, not "object"
        object o = (object)dataItem.DataItem; 
    }
} 
```

为什么他们让 ListView 变得如此不同仍然让我感到困惑。不过一定是有原因的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-30T14:54:39.880

有点晚了，但我会尝试回答你的问题，因为我遇到了同样的问题并找到了解决方案。您必须将 ListViewItemEventArgs 的 Item 属性转换为 ListViewDataItem，然后您可以访问该对象的 DataItem 属性，如下所示：

```
Private Sub listView_ItemDataBound(ByVal sender As Object, ByVal e As System.Web.UI.WebControls.ListViewItemEventArgs) Handles productsList.ItemDataBound
    If e.Item.ItemType = ListViewItemType.DataItem Then
        Dim dataItem As Object = DirectCast(e.Item, ListViewDataItem).DataItem
    ...
End Sub 
```

然后，您可以将 dataItem 对象转换为绑定对象的任何类型。这与转发器等其他数据绑定控件的工作方式不同，其中 DataItem 是 DataBound 方法的事件参数上的一个属性。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T14:59:29.163

找到了一种解决方法，我创建了一种方法来根据需要格式化数据，并使用以下方法从标记中调用它：

```
<%# doFormatting(Convert.ToInt32(Eval("Points")))%> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-01-09T23:58:13.553

用于当前项目的数据可以从`EventArgs`.

因此，`RepeaterItemEventArgs e`我们可以通过查看来访问当前项目`e.Item.DataItem`。

```
protected void listView_ItemDataBound(object sender, ListViewItemEventArgs e)
{        
    if (e.Item.ItemType == ListViewItemType.DataItem)
    {
        var currentItem = e.Item.DataItem;
    }
} 
```

# rhino-mocks - Rhino Mocks：当我的参数之一是 Expression 时，我可以使用 Stub() >?

> ID：858008
> 
> 赞同：6
> 
> 时间：2009-05-13T13:41:33.817
> 
> 标签：rhino-mocks

我在一个看起来像这样的接口上有一个方法，我想用 Rhino Mocks 对它进行存根：

```
TValue GetPropertyOfExistingObject<TValue>(long id, Expression<Func<T, TValue>> propertyExpression); 
```

我的存根代码如下所示：

```
var service = MockRepository.GenerateStub<IQuoteService>();
service.Stub(s => s.GetPropertyOfExistingObject(1, q => q.QuoteNumber)).Return(1234); 
```

请注意，该方法中的参数之一是`Expression<Func<T1, T2>>`，并且此存根未返回指定值。我知道我可以通过使用 WhenCalled() 来做到这一点，但我想知道 Stub() 是否应该使用表达式参数，或者我是否只是做错了什么。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-09-10T10:37:32.280

您可以创建一个计算两个表达式之间相等性的方法：

```
public class ExpressionMatcher
{
    public static Expression<Action<T>> Matches<T>(Expression<Action<T>> action)
    {
        var methodName = ((MethodCallExpression) action.Body).Method.Name;
        return Arg<Expression<Action<T>>>.Matches(a => ((MethodCallExpression)a.Body).Method.Name.Equals(methodName));
    }
} 
```

然后更改您的存根语句以将表达式包装在对表达式匹配器的调用中：

```
service.Stub(s => s.GetPropertyOfExistingObject(Arg<int>.Is.Equal(1), ExpressionMatcher.Matches<Quote>(q => q.QuoteNumber))).Return(1234); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T13:49:52.617

我认为问题与 Expressions 如何测试相等性有关。我刚刚在 Snippet Compiler 中进行了快速测试，但我的表达式从未被评估为相同：

```
 Expression<Func<int, string>> p = i => i.ToString();
    Expression<Func<int, string>> s = i => i.ToString();
    var b = p.Equals(s) || p == s; 
```

（此测试中 b 为假）

可能为了让您的测试按原样工作，您必须忽略第二个参数的实际值（这可能可接受也可能不可接受；如果不可接受，我认为您将不得不走WhenCalled 路线）。

# jquery - jQuery隐藏选项卡选择器

> ID：858014
> 
> 赞同：0
> 
> 时间：2009-05-13T13:42:27.043
> 
> 标签：jquery, tabs

有谁知道我可以如何隐藏 jQuery 选项卡控件的选项卡选择器？

我正在尝试通过隐藏多个视图来执行向导设置类型的操作，但仅在我希望它们显示时才显示。

有任何想法吗？我可以使用除标签之外的其他东西吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T13:52:01.067

```
$(function() {
  $(".nextButton").click(function() {
    $(this).parent().hide().next().show();
  });
  $(".prevButton").click(function() {
    $(this).parent().hide().prev().show();
  });
});
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="http://jqueryjs.googlecode.com/files/jquery-1.3.2.min.js">
</script>

<div>
  Tab One<br/>
  <input type="button" class="nextButton" value="next" />
</div>
<div style="display:none;">
  Tab Two<br/>
  <input type="button" class="prevButton" value="prev" />
  <input type="button" class="nextButton" value="next" />
</div>
<div style="display:none;">
  Tab Three<br/>
  <input type="button" class="prevButton" value="prev" />
</div>
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T13:51:15.967

只需在彼此之上创建 div 并使用 show() 和 hide() 显示/隐藏它们。如果您只想以编程方式切换视图，则不需要选项卡。它是如此简单

html:

```
<div class="view" id="view1">
</div>
<div class="view" id="view2">
</div>
<div class="view" id="view2">
</div> 
```

Javascript：

```
function selectView(i) {
    $(".view").hide();
    $("#view" + 1).show();
} 
```

或者如果您不想使用 ID：

```
function selectView(i) {
    $(".view").hide();
    $(".view :eq(" + 1 + ")").show();
} 
```

# php - 如何用 PHP、Ruby 或 Python 编写程序，并使其易于被普通用户下载和安装，如 Win32 应用程序？

> ID：858017
> 
> 赞同：7
> 
> 时间：2009-05-13T13:43:26.353
> 
> 标签：php, windows, ruby, user-interface

我想知道当我们用 PHP、Ruby 或 Python 编写程序时，我们如何让它像 Win32 应用程序一样被普通用户轻松下载和安装？

是否也可以轻松地使其成为 Mac 应用程序？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-13T14:59:43.377

## 红宝石

[RubyScript2Exe](http://www.erikveen.dds.nl/rubyscript2exe/)

> RubyScript2Exe 将您的 Ruby 应用程序转换为独立的、压缩的 Windows、Linux 或 Mac OS X (Darwin) 可执行文件。

还有[一篇关于它的不错的博客文章](http://redhanded.hobix.com/inspect/churningRubyIntoExe.html)

另一个可能的选择是[Shoes GUI 框架](http://shoooes.net/)，它可以从您的 Shoes 应用程序创建 Widows、Linux 和 OS X 可执行文件。

## Python

[py2exe](http://www.py2exe.org/)

> py2exe 是一个 Python Distutils 扩展，可将 Python 脚本转换为可执行的 Windows 程序，无需安装 Python 即可运行。
> 
> py2exe 被 BitTorrent、SpamBayes 等数千用户使用

## PHP

[Bambalam PHP EXE 编译器/嵌入器](http://www.bambalam.se/bamcompile/)

> Bambalam PHP EXE 编译器/嵌入器是一个免费的命令行工具，用于将 PHP 应用程序转换为独立的 Windows .exe 应用程序。生成的 exe 文件是完全独立的，不需要 php dll 等。

## 是否也可以轻松地使其成为 Mac 应用程序？

[Py2App](http://svn.pythonmac.org/py2app/py2app/trunk/doc/index.html)

> py2app 是一个 Python setuptools 命令，它允许您从 Python 脚本制作独立的应用程序包和插件。py2app 的目的和设计类似于 Windows 的 py2exe。

此外，开发人员工具中包含一个实用程序“Build Applet”。将 Python 脚本拖放到它上面，它就变成了`.app`. 该实用程序位于`/Developer/Applications/Utilities/MacPython 2.5/`

* * *

*请注意*，以上所有内容基本上都是使用您的脚本，将其与 Python 解释器和任何依赖项一起打包，然后在启动时运行您的脚本。如果你使用的 GUI 平台不能在 Windows 上运行，通过 Py2EXE 运行它不会让它工作！

同样正如[Peter D](https://stackoverflow.com/questions/858017/how-to-write-a-program-in-php-ruby-or-python-and-make-it-easily-downloadable-a/858059#858059)所提到的，您需要注意依赖关系 - 如果您的应用程序需要 MySQL 数据库，您的用户将必须单独安装它才能使用您的应用程序，并且您使用的每个库都会增加可执行文件的大小。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T13:51:16.170

我认为您的问题应该是“我如何编写 PHP/Ruby/Python 应用程序以便能够在 Windows 机器上轻松下载和安装？”。

如果我编写一个 PHP 应用程序来利用 MySQL 数据库，我现在必须考虑（在打包应用程序时）用户是否会自己安装和设置数据库。也许我会改用 SQLite 数据库来让用户不必自己运行数据库。

所以我认为这里重要的是不要理解如何打包你的应用程序以便用户可以轻松下载它。这是如何创建应用程序以使其尽可能便携。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T13:58:20.450

至少对于 PHP 和 Python，我知道Windows有 GTK 绑定（ [http://gtk.php.net/](http://gtk.php.net/)，[http://www.pygtk.org/ ）（](http://www.pygtk.org/) [http://www.gtk.org/download -windows.html](http://www.gtk.org/download-windows.html) )。将应用程序打包到一个易于分发的包中变得有点棘手，但它当然可以做到。如果您在 Web App 意义上谈论 PHP，通常情况下，用户将设置他们的环境，他们需要做的就是解包脚本。

这些语言还有其他小部件绑定，我只是将 GTK 列为相当常见的绑定。

正确设置应用程序后，为您的应用程序生成安装程序是一件相对简单的事情。有多种解决方案，其中之一是 NSIS ( [http://nsis.sourceforge.net/Main_Page](http://nsis.sourceforge.net/Main_Page) )，它使创建安装程序变得非常容易。它是可编写脚本的，因此有很多自定义。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T19:03:53.493

我不确定你在问什么，所以我会抛出一些一般性的想法。

我是一名 ruby​​ 程序员，JRuby 是运行 ruby​​ 跨平台的好方法。你可以像打包任何java程序一样打包它，并且有很多windowxs的java应用程序示例。

您可能还想研究 adobe [AIR](http://www.adobe.com/products/air/)。“Adobe® AIR™ 运行时允许开发人员使用经过验证的 Web 技术来构建富 Internet 应用程序，这些应用程序在多个操作系统的浏览器之外运行。”

# sql-server - 哪些选项可用于在 SQL Server 2005 / 2008 中进行源代码管理？

> ID：858021
> 
> 赞同：0
> 
> 时间：2009-05-13T13:43:43.873
> 
> 标签：sql-server, version-control

哪些软件可用于在 SQL Server 2005 及更高版本中启用源代码管理。如果有的话，在 SQL Server 中进行源代码管理有什么缺点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T13:51:42.363

那么这取决于你想怎么做。您可以使用 Visual Studio 2005/2008 生成数据库项目，这些项目将生成创建数据库所需的所有脚本。然后，您可以将脚本签入您喜欢的任何版本控制系统。

Toad 还有一个“[团队编码](http://toadworld.com/Community/Blogs/tabid/67/EntryID/136/Default.aspx)”功能，允许您使用 toad 作为您的版本控制系统。

我强烈建议您养成对数据库使用版本控制的习惯。Jeff Atwood 在他的文章[“您的数据库是否处于版本控制之下？”中强调了其中的一些好处。](http://blog.codinghorror.com/is-your-database-under-version-control/)和[“让您的数据库处于版本控制之下”](http://blog.codinghorror.com/get-your-database-under-version-control/)。我已经[将此](http://blog.pnbconsulting.com.au/index.php/database-version-control-process/)方法与 MSSQL 数据库和 Visual Studio 一起用于对我的数据库进行版本控制。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T13:48:10.810

我不喜欢对数据库本身进行源代码控制，而是使用我用来创建数据库的脚本。我正在使用 Visual Studio 的数据库版（现在作为开发人员版的一部分提供）。

本质上，该工具将所有创建脚本保存在源代码控制中，但随后您可以生成将更新数据库以匹配项目的脚本。它工作得很好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T13:49:04.847

这是一件棘手的事情要解决。由于我使用的大多数数据库都与 Visual Studio (YMMV) 中的特定应用程序相关联，因此我通常这样做：一旦开发开始，我只为模式生成一个“创建数据库”脚本，并将其作为 .sql 脚本放入某些我的应用程序项目的一部分。我打开 SQL Management Studio 中的功能，每次更改表或存储过程或您有什么时都会提示我创建更改脚本...所以每当我更改某些内容时，我都会保存更改脚本并将其添加到我原来的“创建”脚本的结尾。这样，任何人都可以获取 SQL 脚本并完全生成数据库的新副本，直到主干所在的任何位置。

它是原始的，需要更多的管理来保持数据库更改与命中它的应用程序版本同步，但对我来说总比没有好。我很想知道是否有更干净集成的源代码控制解决方案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T13:52:42.597

SSMS中[内置的源代码控制](http://msdn.microsoft.com/en-us/library/ms173550.aspx)只允许您处理脚本；它不会直接跟踪对您的数据库的更改。

就个人而言，我使用[ScriptDB](http://www.codeplex.com/ScriptDB)为我的整个数据库自动创建单独的脚本，然后通过 Visual Studio 进行源代码控制——当我签入我的应用程序代码时，它也会签入这些 SQL 脚本。我还明确编写了对数据库的任何更改的脚本——这些更改用于在适当的时候更新生产服务器——这些也通过 VS 进行源代码控制。

我遇到的几乎每个人都使用类似的技术，如果他们使用任何东西的话。许多人没有。

# java - 如何在 java 中更改输入源（语言）（而不是使用 Shift+alt）？

> ID：858025
> 
> 赞同：2
> 
> 时间：2009-05-13T13:44:58.333
> 
> 标签：java, input

我正在编写一个应用程序来重新映射一些键盘键。我想添加一个按钮，以便如果用户单击它，输入源将更改为操作系统中的下一个输入。我用它来输入源阿拉伯语和英语。我应该使用什么，是否可以在 java 中做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T13:56:31.263

我相信[`InputContext.selectInputMethod()`](http://java.sun.com/javase/6/docs/api/java/awt/im/InputContext.html#selectInputMethod(java.util.Locale))这就是你要找的。[本文](http://java.sun.com/products/jfc/tsc/articles/InputMethod/inputmethod.html#Input_method_selection_by_a_hot_key)还介绍了如何通过系统菜单或热键设置输入法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T13:48:44.583

看看[Java 方法输入框架](http://java.sun.com/javase/6/docs/technotes/guides/imf/index.html)。

# sql-server - 如何在 SQL Server 数据库之间移动图表？

> ID：858026
> 
> 赞同：0
> 
> 时间：2009-05-13T13:45:00.143
> 
> 标签：sql-server, publishing, diagrams, import

我正在尝试将数据库从托管服务器移动到我自己的 SQLExpress 实例。我使用数据库发布向导来创建脚本......但图表没有被传输。

然后，我发现并遵循了该站点上另一个答案的建议，该建议让我将数据导入/导出到 sysdiagrams 表。

当我这样做时，我会看到 Diagrams 文件夹中的所有图表。但是，当我尝试打开一个表时，我会看到每个表的轮廓，然后会弹出一条错误消息，上面写着：

“表已从图表中删除，因为这些表的权限已被删除或表已被删除。”

当我退出弹出窗口时，所有表都从图中删除（除了作为一个图一部分的几个 aspnet_xyz 成员表）。

您知道如何在不收到此消息的情况下传输图表吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2016-02-18T09:25:00.657

您需要删除图表并在“新建数据库图表”的右键菜单中创建一个新图表并添加您需要的表格，最后保存。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T14:00:00.570

我以前见过类似的东西，它不太一样，但也许它足够接近适用于你。

您最初遇到的问题很可能与以某种方式与旧服务器绑定的用户权限有关。

请参阅[http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=120849&SiteID=1](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=120849&SiteID=1)和这个：http: [//msdn2.microsoft.com/en-us/library/ms143684.aspx](http://msdn2.microsoft.com/en-us/library/ms143684.aspx)。

*   您需要停止“SQL Server (SQLEXPRESS)”服务。

*   然后删除“\Documents and Settings\Username\Local Settings\Application Data\Microsoft\Microsoft SQL Server Data\SQLEXPRESS”文件夹。

*   重新启动 SQL Server。

*   重新启动 Visual Studio。

我希望这会有所帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-14T19:52:03.980

当我使用数据库发布向导重新编写整个数据库的脚本时，这个问题就停止了……这次我指定了“仅模式”而不是“模式和数据”。完成此操作后，我能够使用导入/导出向导成功导入和打开图表。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T13:49:00.807

最简单的方法是创建整个数据库的备份并将其还原到您的 Express 数据库。您收到错误是因为图表不是简单的图纸 - 它们只是一些元数据并且它们依赖于它们显示的表格 - 您需要图表显示的表格。如果您不想修改图表，只需将其导出为图像即可。

# scripting - 功能脚本

> ID：858034
> 
> 赞同：0
> 
> 时间：2009-05-13T13:46:56.443
> 
> 标签：scripting, task

是否可以编写一个程序来做你经常在电脑上做的事情？例如，登录 torrent 站点并下载 .torrent 文件，然后启动它。或者浏览文件夹并提取任何 RARed 文件？或者只是做你每天在电脑上做的任何单调的事情。只需要朝正确的方向踢。

谢谢，-皮特

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-13T13:51:50.630

好

`for i in **/*.rar; do unrar e $i; done` 会解开所有的 rars，可能

至于 torrent，你可以学习 perl，学习一些 http 并使用 LWP 库。

在 Windows 上，命令行脚本受到严格限制，除非您使用的是没人真正知道的 powershell。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T13:52:05.077

是的，只要使用正确的工具，其中许多事情都是可能的。在类 UNIX 操作系统上，这种脚本非常常见。在 Windows 上稍微少一些。

你的问题非常广泛。如果您有特定需求，那么您应该告诉我们您正在使用哪个操作系统，以及您使用了哪些其他程序。然后人们也许能够给你正确的方向。

如果您使用的是 Linux，请查看[bash](http://tldp.org/LDP/abs/html/) [scripting](http://tldp.org/HOWTO/Bash-Prog-Intro-HOWTO.html)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T13:52:53.860

如果我们谈论的是 Windows，[PowerShell是一个非常强大的脚本环境。](http://en.wikipedia.org/wiki/Windows_PowerShell)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T13:53:51.423

这是一个相当模糊的问题。可以自动执行任何任务，但执行这些任务所需的应用程序必须提供接口。一些 GUI 程序将接受命令行参数，以便您可以在批处理/脚本文件中自动使用它们，但如果程序没有这样的界面，那么您将看到一种记录鼠标移动的笨拙方式。上面对 PowerShell 大喊大叫，但我知道需要对应用程序进行编码以支持该接口？

在像 linux 这样的类 unix 系统上，其理念是*至少有*一个命令行界面，*也许还有*一个 GUI。与用户界面设计理念以 GUI 为中心的 Windows 操作系统相比，您更有可能在该类型的操作系统上编写常见任务的脚本。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-13T13:55:11.483

也许看看[AutoHotkey](http://www.autohotkey.com/)。

# c++ - 工会——无用的时代错误还是有用的老派把戏？

> ID：858035
> 
> 赞同：21
> 
> 时间：2009-05-13T13:47:06.333
> 
> 标签：c++, c, data-structures, unions

我最近在当地图书馆的一次图书特卖会上看到了一本很棒的数据结构书，“ [Data Structures Using C ”（c）1991，](https://rads.stackoverflow.com/amzn/click/com/0131997467)**仅售 2 美元**。正如书名所暗示的，本书涵盖了使用 C 编程语言的数据结构。

我知道这本书会过时，但可能包含许多我在其他地方不会遇到的高级 C 主题。

果然在 5 分钟内我发现了一些我不知道的关于 C 的东西。我遇到了一个讨论`union`关键字的部分，我意识到我从未使用过它，也从未见过任何代码。我很感激能学到一些有趣的东西，很快就买了这本书。

对于那些不了解工会是什么的人，本书使用了一个很好的比喻来解释：

> 要完全理解联合的概念，有必要检查它的实现。结构可以被视为通往内存区域的路线图。它定义了如何解释内存。一个联合为同一内存区域提供了几个不同的路线图，程序员有责任确定当前使用哪个路线图。在实践中，编译器会分配足够的存储空间来包含最大的联合成员。然而，路线图决定了如何解释存储。

**我可以很容易地想出我会使用联合的人为情况或技巧。（但我对人为的情况或黑客不感兴趣......）**

**您是否使用或看到过使用 Union 解决问题的实现**比不使用 Union 更优雅**？**

如果您快速解释为什么使用联合比不使用联合更好/更容易，则会获得额外奖励。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-05-13T13:51:08.010

UNION 在非 OOP 世界中实现了某种多态性。通常，您有一个通用部分，并且根据该部分，您可以使用其余的 UNION。因此，在您没有 OOP 语言并且希望避免过多的指针运算的情况下，联合在某些情况下可能更优雅。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-05-13T14:04:01.033

它对于在寄存器中设置位而不是移位/屏蔽操作很有用：

```
typedef union {
    unsigned int as_int; // Assume this is 32-bits
    struct {
        unsigned int unused1 : 4;
        unsigned int foo : 4;
        unsigned int bar : 6;
        unsigned int unused2 : 2;
        unsigned int baz : 3;
        unsigned int unused3 : 1;
        unsigned int quux : 12;
    } field;
} some_reg; 
```

注意：打包发生的方式取决于机器。

```
some_reg reg;
reg.field.foo = 0xA;
reg.field.baz = 0x5;
write_some_register(some_address, reg.as_int); 
```

我可能在某处吹了一些语法，我的 C 生锈了 :)

**编辑：**

顺便说一句，这也以相反的方式起作用：

```
reg.as_int = read_some_register(some_address);
if(reg.field.bar == BAR_ERROR1) { ... 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-05-13T13:50:01.647

事实上，当您编写诸如设备驱动程序之类的东西（`struct`您想要发送到可以有几种相似但不同格式的设备）并且您需要精确的内存安排时，它是一个很好的工具......

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-05-13T14:00:17.980

您应该知道，在 C++ 中它们并不是一个很好的解决方案，因为只有 POD（普通旧数据）类型可以放在联合中。如果您的类有一个构造函数、析构函数，并且包含具有构造函数和/或析构函数的类（以及大约一百万个其他陷阱），则它不能是联合的成员。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-05-13T13:51:50.943

我想，Union 是在 C/C++ 中实现[类 VARIANT 数据类型的最简单方法。](http://msdn.microsoft.com/en-us/library/ax9wt423(VS.80).aspx)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-05-13T14:10:07.137

它通常用于数据传输协议的规范中，您希望避免在数据结构中浪费空间。它允许通过为多个互斥选项使用相同的空间来节省内存空间。

例如：

```
enum PacketType {Connect, Disconnect};
struct ConnectPacket {};
struct DisconnectPacket {};
struct Packet
{
    // ...
    // various common data
    // ...
    enum PacketType type;
    union
    {
        ConnectPacket connect;
        DisconnectPacket disconnect;
    } payload;
}; 
```

ConnectPacket 和 DisconnectPacket 结构占用相同的空间，但这没关系，因为一个数据包不能同时是两种类型。枚举值用于确定联合的哪个部分正在使用。使用联合使我们能够避免重复数据包结构的公共部分。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-05-13T13:59:35.003

考虑访问大变量中的单个字节的情况：

```
UInt32 x;
x = 0x12345678;
int byte_3 = x & 0x000000FF;          // 0x78
int byte_2 = (x & 0x0000FF00) >> 8;   // 0x56
int byte_1 = (x & 0x00FF0000) >> 16;  // 0x34
int byte_0 = (x & 0xFF000000) >> 24;  // 0x12 
```

使用联合可以更加优雅：

```
typedef union
{
    UInt32 value;  // 32 bits
    Byte byte[4];  // 4 * 8 bits
}
UInt32_Bytes;

UInt32_Bytes x;
x.value = 0x12345678;
int byte_3 = x.byte[3];  // 0x78
int byte_2 = x.byte[2];  // 0x56
int byte_1 = x.byte[1];  // 0x34
int byte_0 = x.byte[0];  // 0x12 
```

使用联合意味着您不再需要使用位掩码和移位运算符来访问各个字节。它还使字节访问显式。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-05-13T14:23:50.547

这是获取浮点数的 IEEE 位值的好方法（当然假设浮点数是您系统上的 IEEE）。任何涉及将 float* 转换为 int* 的操作都有可能违反严格的别名规则。这不仅仅是理论上的——高水平的优化实际上会破坏你的代码。

从技术上讲，union 并没有解决这个问题。在实践中，所有已知的编译器将 (a) 允许您写入联合的一个成员并回读另一个成员，以及 (b) 在执行写入后执行读取。GCC 至少能够将联合滚动到寄存器中，将整个事情变成无操作（假设浮点数一开始就存储在寄存器中）。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-05-13T15:16:21.337

我们在很多代码中使用联合来进行网络数据包解析。

联合分配最大元素的大小。您将创建一个具有最大消息大小的缓冲区元素的联合，然后您可以轻松访问数据包中的值。

假设数据“c123456”在线到达，您需要解析和访问这些值：

```
 #include <iostream>
  using namespace std;

  struct msg
  {
     char header;
     union
     {
       char a[3];
       char b[2];
       char c[5];
       char d[6];
       char buf[10];
     } data;
  } msg;

  int main()
  {
    struct msg m;
    memcpy(&m, "c123456", sizeof("c123456"));

    cout << "m.header: " << m.header << endl;
    cout << "m.data.d: " << string(m.data.d,sizeof(m.data.d)) << endl;
    cout << "m.data.b: " << string(m.data.b,sizeof(m.data.b)) << endl;

    switch (m.header)
    {
     case 'a': cout << "a: " << string(m.data.a, sizeof(m.data.a)) << endl; break;
     case 'b': cout << "b: " << string(m.data.b, sizeof(m.data.b)) << endl; break;
     case 'c': cout << "c: " << string(m.data.c, sizeof(m.data.c)) << endl; break;
     default: break;
    }
  } 
```

输出将如下所示：

```
m.header: c
m.data.d: 123456
m.data.b: 12
c: 12345 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-09-02T19:11:10.287

我知道这已经重复了，但我将发布一个代码示例，看看联合体在读取网络流量时如何增加优雅和效率：

```
#pragma packed(1)
struct header_t {
   uint16_t msg_id;
   uint16_t size;
};
struct command_t {
   uint8_t cmd;
};
struct position_t {
   uint32_t x;
   uint32_t y;
   uint32_t z;
};
// ... Rest of the messages in an IDS
struct message {
   header_t header;
   union {
      command_t command;
      position_t position;
   } body;
};
#pragma packed(0)
message read( int socket ) {
   message data;
   unsigned int readed = read( socket, &data, sizeof(header_t) );
   // error checks... readed bytes smaller than header size and such
   readed = read( socket, &(data.body), data.header.size ); 
   // error checks...
} 
```

在上面的代码片段中，您可以就地执行消息读取，您不需要关心接收到的对象的具体类型。如果您不使用联合，您将需要读取标题，提取大小和类型，实例化适当类型的对象（在层次结构中或包含在变体类型中作为 boost::any/ boost::variant)，并在新创建的空间上执行第二次读取。

我们广泛使用此解决方案来控制模拟器（一些公司不喜欢 DDS 或 HLA 等“新”技术，并且仍然依赖原始 UDP/TCP 数据用于他们的模拟器）。在网络层中，我们使用在将其馈送到应用程序层之前转换为内部数据结构（网络到主机转换、数据缩放......）的联合。如前所述，您必须始终小心填充。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-05-13T16:37:16.943

[我曾经以与markh44 的](https://stackoverflow.com/users/79047/markh44)答案类似的方式将它用于一种粗略的数据多态性。我有几种不同类型的数据，我想可能会使用它们。我创建了所有这些类型的联合和一个包含联合的结构和定义要使用的类型的代码。

```
 union
{
    data_type_1;
    data_type_2;
    data_type_3;
} data_union;

typedef struct _TAG_DATA_WRAPPED_
{
    data_union data;
    int data_type; //better an enum
} WRAPPED_DATA;

WRAPPED_DATA loads_of_data[1024]; 

```

要回答您关于为什么这是有利的问题：

这使您可以轻松地分配不同类型数据的列表或数组，并以编程方式管理它们的类型。最大的问题当然是存储空间，因为如果类型的存储大小非常不同，您可能会浪费大量空间。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-02-14T17:03:43.543

我认为这是一个很好的例子：

```
 struct fieldsv4{
            unsigned int ip4 : 8;
            unsigned int ip3 : 8;
            unsigned int ip2 : 8;
            unsigned int ip1 : 8;
        };
        typedef union {
            unsigned int ip32; // Assume this is 32-bits
            struct fieldsv4 part;
        } ipv4;

        ipv4 dir1;
        struct fieldsv4 f1 = {1, 1, 168, 192}; //for little endian depending OS  for big endian do not invert
        dir1.part = f1;
        ipv4 dir2= dir1;
        dir2.part.ip4 = 2;
        printf("%d.%d.%d.%d\n", dir2.part.ip1, dir2.part.ip2, dir2.part.ip3, dir2.part.ip4);
        printf("%d.%d.%d.%d\n", dir1.part.ip1, dir1.part.ip2, dir1.part.ip3, dir1.part.ip4);
        printf("%X\n", dir1.ip32 ^ dir2.ip32); 
```

# java - 如何在java中安全地删除文件

> ID：858036
> 
> 赞同：2
> 
> 时间：2009-05-13T13:47:40.747
> 
> 标签：java, security, delete-file

如何在java中安全地删除文件？我在[javafaq.nu](http://www.javafaq.nu/java-example-code-1121.html)尝试了代码，但问题是由于[这个错误](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4715154)，一旦它被映射，你就不能真正删除 windows 上的文件。

然后我尝试在 Windows 上使用[sysinternals sdelete](http://technet.microsoft.com/en-us/sysinternals/bb897443.aspx)，但你必须在第一次使用它时单击使用协议，这是我想避免的。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-13T15:08:24.983

我编码并尝试了这个功能，它似乎工作：

```
public static void secureDelete(File file) throws IOException {
    if (file.exists()) {
        long length = file.length();
        SecureRandom random = new SecureRandom();
        RandomAccessFile raf = new RandomAccessFile(file, "rws");
        raf.seek(0);
        raf.getFilePointer();
        byte[] data = new byte[64];
        int pos = 0;
        while (pos < length) {
            random.nextBytes(data);
            raf.write(data);
            pos += data.length;
        }
        raf.close();
        file.delete();
    }
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-13T13:50:53.877

在像 NTFS 这样的日志文件系统上，实际上没有办法在不擦除驱动器上所有可用空间的情况下安全地擦除单个文件。问题是新块（您可能已经用随机数据覆盖）不能保证与旧块在磁盘上的相同位置。

像 sdelete 这样的实用程序可能对您有用，但您可以简单地将可执行文件替换为不会阻止该防御方法的可执行文件。

为了保证您的数据安全，您唯一真正的解决方案是完全加密驱动器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T13:49:24.100

也许对文件执行 deleteOnExit() ？

# c# - 有什么快速方法可以确定 ASP.NET 控件属性是由视图状态还是普通字段支持？

> ID：858040
> 
> 赞同：0
> 
> 时间：2009-05-13T13:48:28.343
> 
> 标签：c#, .net, asp.net, viewstate

在我所有的 Page_Load() 事件中，我必须做一个

```
if(!IsPostBack)
{
  //code runs on initial get
  //Set properties backed by viewstate
}
else
{
  //Code runs on each get and post
  //Set properties backed by ordinary fields
} 
```

有没有什么快速的方法来确定这个反射器的不足，阅读文档，或者创建一个测试页面？

采用视图状态实际上并不存在的约定是否更好，因为如果不研究可能需要在大型业务应用程序中设置的所有潜在的 1000 个属性，您不知道它是否存在？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T14:54:41.417

这似乎更像是一个设计问题——何时使用 ViewState。由于您有源，您显然知道哪些控件使用 ViewState，因此无需猜测或发现。

IsPostback 是确定 GET 或 POST 的常用方法。您还可以检查 Request.HttpMethod。为了决定何时使用 ViewState，页面会在其任务完成之前回发（即根据用户操作更新一些控件）吗？如果您要 Postbck，并且填充所有字段的成本太高，那么使用 ViewState。或者使用 Ajax 调用来避免仅更新内容的回发。

请记住，当您执行回发时，您不需要 ViewState 来读取值。控件在 Form 集合中传递。

# inversion-of-control - 您如何将我当前的业务层转换为 IOC 样式？

> ID：858043
> 
> 赞同：1
> 
> 时间：2009-05-13T13:49:00.730
> 
> 标签：inversion-of-control

您如何将我当前的业务逻辑层方法转换为 IOC？

```
public static List<User> GetUsers()
{
    MyDBProvider db = new MyDBProvider();

    return db.GetUsers();
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T13:52:42.127

```
List<User> users = GetUsers(new MyDbProvider());

List<User> GetUsers(IDataProvider provider){
    return provider.GetUsers();
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T14:23:28.380

我可能会摆脱静态方法并为初学者使用更面向对象的方法。

```
public class UserRepository {
    private DBProvider provider;

    public DBProvider getProvider() { return provider; }
    public void setProvider(DBProvider provider) { this.provider = provider; }

    public List<User> getUsers() { return getProvider().getUsers(); }
}

public interface DBProvider {
    List<User> getUsers();
}

public class MyDbProvider implements DBProvider { ... } 
```

# ms-access - 访问运行总和问题以对子报表的记录进行编号

> ID：858046
> 
> 赞同：3
> 
> 时间：2009-05-13T13:49:16.393
> 
> 标签：ms-access, subreport

我很难弄清楚如何对子报表的记录进行编号。我有一份主报告，它为一条记录提供识别信息。主报表中有一个子报表，它提供与主报表相关的记录。我想将这些记录从一条编号到有多少条记录。我尝试了属性中的运行总和功能（即文本框= 1，运行总和=总体），它在子报表打开时工作，没有主报表；但是，当主报表打开时，子报表运行总和不起作用（即它只显示每条记录的数字 1）。

我了解这是主要报告/子报告的缺点。有谁知道如何解决这个问题或我可以在 On Open 事件中添加的 VBA 解决方案？

谢谢，

DFM

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T18:46:43.083

我使用 Access 2003 进行了快速测试，您的方法运行良好。

我在详细信息部分的子报告中创建了一个文本框：

控制源 = “=1”
运行总和 = “总体”

一定有别的事情发生。

# .net - VSTO：将多个部分粘贴到 Word 文档会生成幻像宏

> ID：858056
> 
> 赞同：0
> 
> 时间：2009-05-13T13:51:04.143
> 
> 标签：.net, ms-word, vsto

我有一些 VSTO 代码，它通过从源文档中复制和粘贴选定的部分来生成 Word 2003 文档：

```
 Dim doc = Globals.ThisDocument.Application.Documents.Add(DocumentType:=Word.WdNewDocumentType.wdNewBlankDocument, Visible:=False)
    For Each sectionNumber As Integer In requiredSections
        sourceDoc.Sections(sectionNumber).Range.Copy()
        doc.Bookmarks("\endofdoc").Range.Paste()
    Next
    doc.SaveAs(FileName:=(fileName), FileFormat:=(format), LockComments:=False, Password:="", AddToRecentFiles:=False)
    doc.Close(SaveChanges:=False) 
```

这很好用，但是当我打开生成的文档时，我会看到宏安全警告对话框（或文档以设计模式打开，具体取决于设置）。我根本看不到文档中的任何宏，例如使用 Word 中的宏管理器。

这导致的真正问题是，如果宏安全性设置为“高”，它会阻止从外壳打印工作（代码正在调用 Process.Start 指定打印动词的文档，这是首选的打印机制它适用于许多文档类型）。

奇怪的是，只有将多个部分粘贴到目标文档时才会出现问题。

有人有想法么？谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-13T16:11:56.177

两个小时，没有人为我完成我的工作;-)

以防万一其他人有这个问题，我最终通过将文档保存为 RTF 来解决它，这样就没有宏并且 shell 打印工作顺利。

现在我屏住呼吸等待有人报告 Word RTF 输出中的限制。

# java - 如何测试 Netbeans 6.7 插件？

> ID：858072
> 
> 赞同：2
> 
> 时间：2009-05-13T13:52:06.887
> 
> 标签：java, swing, netbeans, plugins, testing

我创建了一个简单的 netbeans 插件（参见[本教程](http://silveiraneto.net/2008/02/24/netbeans-your-first-plugin/)），现在我想测试例如 Actionlistener。

但这怎么能做到呢？

更具体

*   哪些测试框架适合 netbeans 插件开发？
*   如何创建一个模拟足够多的 netbeans 的测试设置，例如测试简单的 actionlistener？

**更新**

一个实际的例子：

我在工具菜单中注册了我的操作，我如何测试菜单条目上的“点击”？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-10-31T10:16:37.867

查看[http://jemmy.netbeans.org/](http://jemmy.netbeans.org/)和[http://blogs.oracle.com/geertjan/entry/gui_testing_on_the_netbeans](http://blogs.oracle.com/geertjan/entry/gui_testing_on_the_netbeans)

或者…… 从这里 [http://www.junit.org/taxonomy/term/6](http://www.junit.org/taxonomy/term/6)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-12-16T13:54:47.043

Jemmy 已移至[https://jemmy.dev.java.net/](https://jemmy.dev.java.net/)也不依赖于 NetBeans 模块，因此可用于 AWT/Swing/SWT/JavaFX 测试。

另一个库是 Window Licker [http://code.google.com/p/windowlicker/](http://code.google.com/p/windowlicker/)来自[http://www.growth-object-orientated-software.com/](http://www.growing-object-oriented-software.com/)的作者，它现在支持 Swing/Ajax。

# apache - Apache .htaccess 密码保护与相对路径

> ID：858074
> 
> 赞同：6
> 
> 时间：2009-05-13T13:52:38.260
> 
> 标签：apache, .htaccess, http-authentication

我想在我的 DocumentRoot 中创建一个 .htaccess 文件，以便目录受密码保护。

但是密码文件，我想用DocumentRoot的相对路径来指定。

所以，如果我在另一个系统中检查代码，它就可以正常工作。密码文件将成为我的源代码控制的一部分。

如何从 .htaccess 文件访问 DocumentRoot 的父目录？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-13T14:09:08.153

我不认为这是可能的。该[`AuthUserFile`指令](http://httpd.apache.org/docs/2.2/mod/mod_authn_file.html#authuserfile)要求文件路径是绝对的（因此来自文件系统根目录）或来自[服务器根目录](http://httpd.apache.org/docs/2.2/mod/core.html#serverroot)的相对路径。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-05-30T15:31:18.860

AuthUserFile 路径是相对于服务器根目录（`/etc/apache2/`在 Debian 上）或绝对的。

要照顾不同的服务器，您可以`IfDefine`在每台服务器上使用具有不同变量的指令 - 请参阅[我的博客文章](http://cweiske.de/tagebuch/relative-htpasswd-path.htm)。

# algorithm - 什么是最佳的“最通用的统一器”算法？

> ID：858077
> 
> 赞同：11
> 
> 时间：2009-05-13T13:52:46.370
> 
> 标签：algorithm, prolog, logic, scheme, unification

**问题**

什么是最有效的 MGU 算法？它的时间复杂度是多少？在堆栈溢出答案中描述是否足够简单？

我一直试图在 Google 上找到答案，但一直在寻找我只能通过 ACM 订阅访问的私人 PDF。

我在 SICP 中找到了一个讨论：[这里](http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-29.html#%_sec_4.4.2)

解释什么是“最通用的统一算法”：采用两个包含“自由变量”和“常量”的表达式树......例如

```
e1 = (+ x? (* y? 3) 5)
 e2 = (+ z?q?r?)

```

然后最通用统一器算法返回使两个表达式等效的最通用绑定集。例如：

```
mgu(e1, e2) = { x ↦ z,
                q ↦ (* y 3),
                y ↦ unbound,
                r ↦ 5 } 
```

“最一般”的意思是您可以改为绑定`{x ↦ 1}`and`{z ↦ 1}`并且这也可以使`e1`和`e2`等效，但它会更具体。

SICP 文章似乎暗示它相当昂贵。

对于信息，我问的原因是因为我知道类型推断也涉及这种“统一”算法，我想了解它。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-13T16:03:33.850

在实践中使用的简单算法（例如在 Prolog 中）对于病理病例是指数级的。

[Martelli and Montanari][1] 有一个理论上更有效的算法（IIRC 它是线性的），但是对于实际发生的简单情况来说它的速度要慢得多，因此使用得不多。

[1] [http://www.nsl.com/misc/papers/martelli-montanari.pdf](http://www.nsl.com/misc/papers/martelli-montanari.pdf)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-05-25T11:48:30.897

[Baader 和 Snyder](https://cs-web.bu.edu/faculty/snyder/publications/UnifChapter.pdf)发表了几种统一算法，用于句法统一和等式统一。

他们声明他们的第三个句法统一算法（在第 2.3 节中）运行在`O(n×α(n))`哪里`α(n)`是逆阿克曼函数 - 在实际情况下它相当于一个小常数。

# sql - 如何对 Oracle 时间戳执行算术运算（在 SQL 中）？

> ID：858078
> 
> 赞同：0
> 
> 时间：2009-05-13T13:52:51.723
> 
> 标签：sql, oracle, timestamp

我需要选择一个在不同实体的有效期中间有效的实体。

作为一个简化的例子，我想做这样的事情：

```
select 
    * 
from
    o1, o2
where
    o1.from < (o2.to - ((o2.to - o2.from) /2) )
    and
    o1.to > (o2.to - ((o2.to - o2.from) /2) ) 
```

假设 to 和 from 是时间戳，我如何在 SQL 中计算“(o2.to - ((o2.to - o2.from) /2) )”？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T14:07:18.623

你试过你写的东西吗？看起来它应该对我有用：

```
(o2.to - o2.from) 
```

这将为您提供部分日差，例如：

```
 1  select (trunc(sysdate) - trunc(sysdate+1))/2 from dual
  2*
SQL> /

(TRUNC(SYSDATE)-TRUNC(SYSDATE+1))/2
-----------------------------------
                                -.5

SQL> 
```

然后，如果您将该结果添加到原始日期，您将获得中点的日期和时间：

```
SQL> select to_char(a.d, 'YYYY-MON-DD HH24:MI')
  2  from
  3  (  select trunc(sysdate) + (trunc(sysdate+1) - trunc(sysdate))/2 d from dual
  4  ) a;

TO_CHAR(A.D,'YYYY
-----------------
2009-MAY-13 12:00 
```

# c# - 可空类型和三元运算符：为什么是`？10：null`禁止？

> ID：858080
> 
> 赞同：259
> 
> 时间：2009-05-13T13:52:59.647
> 
> 标签：c#, .net, nullable, conditional-operator

我刚刚遇到一个奇怪的错误：

```
private bool GetBoolValue()
{
    //Do some logic and return true or false
} 
```

然后，在另一种方法中，如下所示：

```
int? x = GetBoolValue() ? 10 : null; 
```

很简单，如果方法返回 true，则将 10 分配给 Nullable `int`x。否则，将 null 分配给可为**空**的int。但是，编译器抱怨：

> 错误 1 ​​无法确定条件表达式的类型，因为`int`和之间没有隐式转换`<null>`。

我要疯了吗？

* * *

## 回答 #1

> 赞同：431
> 
> 时间：2009-05-13T14:03:29.910

编译器首先尝试计算右手表达式：

```
GetBoolValue() ? 10 : null 
```

The`10`是`int`文字（不是`int?`），并且`null`是`null`. 这两者之间没有隐式转换，因此出现错误消息。

如果将右侧表达式更改为以下表达式之一，则它会编译，因为`int?`and `null`(#1) 和`int`and `int?`(#2, #3) 之间存在隐式转换。

```
GetBoolValue() ? (int?)10 : null    // #1
GetBoolValue() ? 10 : (int?)null    // #2
GetBoolValue() ? 10 : default(int?) // #3 
```

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2009-05-13T13:54:58.193

试试这个：

```
int? x = GetBoolValue() ? 10 : (int?)null; 
```

基本上发生的事情是条件运算符无法确定表达式的“返回类型”。由于编译器隐含地决定这`10`是一个`int`它然后决定这个表达式的返回类型也应该是一个`int`。由于 an `int`cannot be `null`（条件运算符的第三个操作数）它会抱怨。

通过将 a 强制转换`null`为 a `Nullable<int>`，我们明确地告诉编译器这个表达式的返回类型应该是 a `Nullable<int>`。您也可以轻松地将 to 投射`10`到`int?`并具有相同的效果。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-05-13T15:09:39.007

顺便说一句，C# 编译器的 Microsoft 实现实际上以一种非常微妙和有趣（对我而言）的方式错误地对条件运算符进行了类型分析。我关于它的文章是*[类型推断问题，第一部分](https://docs.microsoft.com/en-us/archive/blogs/ericlippert/type-inference-woes-part-onex)*(2006-05-24)。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2012-04-02T08:07:52.903

试试这个：

`int? result = condition ? 10 : default(int?);`

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-05-13T13:59:28.217

尝试其中之一：

```
int? x = GetBoolValue() ? (int?)10 : null;

int? x = GetBoolValue() ? 10 : (int?)null; 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-05-13T14:00:53.067

问题是三元运算符根据您的第一个参数分配推断类型...10 在这种情况下，它是一个 int，而不是一个可为空的 int。

你可能有更好的运气：

```
int? x = GetBoolValue() (int?)10 : null; 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-05-13T13:57:23.213

```
int? x = GetBoolValue() ? 10 : (int?)null; 
```

你看到这个的原因是因为你在幕后使用 Nullable 并且你需要告诉 C# 你的“null”是 Nullable 的一个空实例。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-05-13T14:00:03.847

只需添加一个明确的演员表。

```
int? x = GetBoolValue() ? 10 : (int?)null; 
```

令人困惑的是三元运算符 - 第二个参数是一个整数，第三个参数也应该是一个整数，并且 null 不适合。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-05-13T14:09:56.017

这是因为编译器通过其第二个和第三个操作数来确定条件运算符的类型，而不是根据您将结果分配给什么。编译器可以用来确定类型的整数和空引用之间没有直接转换。

# c# - C# 继承和覆盖基本属性

> ID：858081
> 
> 赞同：13
> 
> 时间：2009-05-13T13:53:01.473
> 
> 标签：c#, inheritance, properties

我目前需要一个自定义`ListViewItem`类 - 让我们称之为`MyListViewItem`。它需要与每个项目关联一些附加数据，并在 Checked 属性更改时执行一些操作。我已经尝试了几件事，但目前相关代码如下所示：

```
class MyListViewItem : ListViewItem {
    new public bool Checked {
        get {
            return base.Checked;
        }
        set {
            base.Checked = value;
            // do some other things here based on value
        }
    }
    public MyListViewItem(Object otherData) {
        // ...
    }
} 
```

我遇到的问题是，当我单击 ListView 中项目的复选框时，我的 setter 永远不会被调用。有谁知道我做错了什么？我知道我可以使用父 ListView 的 ItemChecked 事件，但这似乎是一个不太干净的解决方案。（此外，我实际上并没有将 Object 传递给构造函数，但这部分在这里并不重要）。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-05-13T13:56:30.233

它不起作用，因为“new”关键字不会覆盖它只是“隐藏”。

这意味着，如果您在通过 MyListViewItem 的类型定义引用的对象实例上调用 Checked，您*将*运行您的代码。但是，ListView 通过 ListViewItem 的类型定义引用此对象，因此不会调用您的“新”方法。

“新”*不是*覆盖。更好的解决方案可能是在自定义列表视图中处理代码。它真的没有那么丑。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-13T13:54:16.120

[`new`](http://msdn.microsoft.com/en-us/library/aa645625(VS.71).aspx)不是会员`override`。`base`它声明了一个同名的新方法。在 VB.NET 中，它被称为`Shadows`.

实际上，`new`除了关闭编译器警告之外什么都不做。您未声明为的成员`override`（并且您只能在`base`成员为`virtual`或的情况下这样做`override`）将与`base`成员的继承树完全无关。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-13T13:55:27.897

假设`ListViewItem`. `Checked`属性是虚拟的，你需要覆盖它：

```
public override bool Checked 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-13T14:02:24.950

ListViewItem.Checked 属性不是虚拟的（请参阅[此处](http://msdn.microsoft.com/en-us/library/system.windows.forms.listviewitem.checked.aspx)的 MSDN 文档），因此您将无法以这种方式覆盖它的行为。您将不得不使用该事件或从 ListView 派生并覆盖[ListView.OnItemChecked](http://msdn.microsoft.com/en-us/library/system.windows.forms.listview.onitemcheck.aspx)以更改行为。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-13T14:40:40.380

与其创建您自己的自定义 ListViewItem，不如创建一个单独的类型来包含您的自定义数据，然后为每个 ListViewItem Tag 属性分配对自定义数据的引用？

这是我已经使用了一段时间的模式，并且效果很好。至于检查项目时的自定义操作，只需在列表视图中处理相关事件即可。

# forms - 自动提交表单

> ID：858083
> 
> 赞同：1
> 
> 时间：2009-05-13T13:53:31.393
> 
> 标签：forms, vbscript, submission

如何使用 vbscript 自动提交带有随机文本值的 html 表单？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T13:14:26.813

您可以使用“Microsoft.XMLHTTP”自动提交表单。请看下面：

```
Set xml = Server.CreateObject("Microsoft.XMLHTTP")

' Notice the two changes in the next two lines:
xml.Open "POST", "http://www.imdb.com/Find", False
xml.Send "select=All&for=The Usual Suspects"

wscript.echo xml.responseText 
```

或者看看这些很棒的帖子：

[http://www.4guysfromrolla.com/webtech/110100-1.2.shtml](http://www.4guysfromrolla.com/webtech/110100-1.2.shtml)

[http://www.4guysfromrolla.com/webtech/110100-1.shtml](http://www.4guysfromrolla.com/webtech/110100-1.shtml)

[http://support.microsoft.com/kb/290591](http://support.microsoft.com/kb/290591)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T13:18:30.017

您可能想要使用 Selenium ( [http://seleniumhq.org/](http://seleniumhq.org) ) 或 Waitr ( [http://wtr.rubyforge.org/](http://wtr.rubyforge.org/) )，因为它们可以让您更好地控制并且可以满足您的需求。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2010-02-01T06:05:34.127

```
<html>
    <form action='http://127.0.0.1/file.php' method='POST' id=1>
        <input type=hidden name="var" value="val">
        <input type=submit>
    </form>
</html>
<script>
    document.getElementById(1).submit();
</script> 
```

# .net - 在 Visual Studio 中按 F1 时是否可以调用 .NET Reflector？

> ID：858089
> 
> 赞同：1
> 
> 时间：2009-05-13T13:54:16.400
> 
> 标签：.net, visual-studio-2008, reflector

当我在 Visual Studio 2008 中按 F1 时，我想启动 .NET 反射器并导航到选定的类/方法（而不是等待 Visual Studio 文档启动）。

是否可以以这种方式配置 Visual Studio？

* * *

后续问题：

*   如何确定插入符号下的类型/程序集（如[x0n 的回答](https://stackoverflow.com/questions/858089/is-it-possible-to-invoke-net-reflector-when-pressing-f1-in-visual-studio/858129#858129)中所述）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T14:00:51.973

确实。

您必须编写一个宏（工具 > 宏）才能在插入符号下找到上下文 Assembly & Type，然后生成：

```
Reflector <assemblyname> /select:my.namespace.typename 
```

最后将 F1 重新绑定到您的宏（尽管我倾向于将其绑定到一个变体，例如 ctrl+shift+f1 或其他东西，因为您并不总是按 f1 来获取类型帮助）

-Oisin

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T14:01:53.737

这不完全是您问题的答案，但我想补充一点，Visual Studio 中还有一种内置方式可以打开当前所选类/方法定义的（反编译的）源代码只需按下`F12`。

# python - 没有迭代的列表元素

> ID：858109
> 
> 赞同：-7
> 
> 时间：2009-05-13T13:58:28.500
> 
> 标签：python, list, find, iteration

我想知道如何在没有迭代的情况下在列表中找到一个元素

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-13T13:59:42.693

列表的[`mylist.index("blah")`方法](http://docs.python.org/tutorial/datastructures.html#more-on-lists)将返回项目“blah”第一次出现的索引：

```
>>> ["item 1", "blah", "item 3"].index("blah")
1
>>> ["item 1", "item 2", "blah"].index("blah")
2 
```

如果找不到，它将引发 ValueError：

```
>>> ["item 1", "item 2", "item 3"].index("not found")
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
ValueError: list.index(x): x not in list 
```

您还可以使用`in`关键字来确定项目是否在列表中（但不是位置）：

```
>>> "not found" in ["item 1", "blah", "item 3"]
False
>>> "item 3" in ["item 1", "blah", "item 3"]
True 
```

正如 Harper Shelby 评论的那样，Python 仍然需要在内部进行迭代才能找到项目，但是索引或方法可能*比*在 Python 中更快，因为数据结构是用 C 实现的。但更重要的是，

```
"x" in mylist 
```

..**比**..整洁得多

```
found = False
for cur in mylist:
    if cur == "x":
        found = True 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-13T14:03:49.847

这是一个有点奇怪的问题。你想要一个热线`$someDeity`，还是想要另一个函数为你做迭代，或者你想要一个*更有效*的方法来测试成员资格？

在第一种情况下，我无法帮助您。在第二种情况下，请查看[有关 lists 的文档](http://docs.python.org/tutorial/datastructures.html#more-on-lists)，特别是`index`方法。在第三种情况下，创建一个[`set`](http://docs.python.org/tutorial/datastructures.html#sets)并使用`in`关键字。请注意，只有在您打算多次搜索列表时，才能创建集合。

```
>>> l = [1, 2, 3]
>>> l.index(2)
1
>>> 3 in l
True
>>> ls = set(l)
>>> 3 in ls
True 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-13T14:03:45.823

您还可以使用`in`语法：

```
>>> l = [1,2,3]
>>> 1 in l
True 
```

# crystal-reports - 分组和水晶报表

> ID：858127
> 
> 赞同：0
> 
> 时间：2009-05-13T14:00:37.857
> 
> 标签：crystal-reports

我有一个这样的水晶报告：

```
Group By Property.ID
  Group By RentalUnit.PropertyID
    Group By Tenant.PropertyID 
```

这样它看起来像这样：

```
Property1
  unit1 data, tenant data
  unit2 data, tenant data
  ...
  unitN data, tenant data
Property2
  unit1 data, tenant data
  unit2 data, tenant data
  ...
  unitN data, tenant data
...
PropertyN
  unit1 data, tenant data
  unit2 data, tenant data
  ...
  unitN data, tenant data 
```

表格如下所示：

```
Property:
  ID
  other data
RentalUnit
  ID
  PropertyId <-- This is the foreign key representing what property they belong to
  other data
Tenant
  ID
  PropertyID <-- foreign key to their property
  UnitNumber <-- foreign key to their unit
  other data 
```

不过我想更改报告。我向它传递了一个变量调用 SelectedPropertyID，并且我只想显示所选物业的出租单元（以及分配给出租单元的租户）。

我怎样才能做到这一点？我对水晶报告比较陌生，所以请原谅我的经验不足。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T14:24:56.850

好的，我刚刚在 Crystal Reports 中刷新了我的记忆。我将使用 XI R2 版本，因此您的版本可能会有所不同。

这是我所做的：

1.  为属性 ID 定义一个参数。您可以将其定义为自由字段或将其值限制为数据库中的内容。哪个对您的报告最有意义。
2.  打开数据库专家。转到“链接”选项卡并确保在这些表之间定义了链接。如果您不这样做，请定义它们（将它们视为外键）。关闭数据库专家。
3.  打开选择专家。单击“新建”以定义新的选择限制。在弹出的新窗口中，从 tblProperty 表中拖动您的参数和 Property ID 字段，并在它们之间使用等号。这基本上是报告的`WHERE`条款。您的公式应该类似于`{?Parameter}={tblProperty.PropertyID}`.

那应该这样做。

# c# - 在 Visual Studio 中隐藏区域

> ID：858132
> 
> 赞同：24
> 
> 时间：2009-05-13T14:00:59.307
> 
> 标签：c#, visual-studio-2008, regions

我知道 VS 代码折叠问题是一个老问题，但我在浏览过的所有其他讨论中都找不到这个问题：

我们有一个 C# 团队，有些人喜欢他们，有些人讨厌他们，而且我们似乎没有太多的中间立场可以合作。

是否有 VS 的插件或加载项只会“隐藏”这些区域？这样那些想要它们的人就会正常地看到它们，但是安装插件并查看 .cs 文件的人不存在这些区域，就好像它们不存在一样。

我可以看到在移动代码时这可能是一个问题，它可能会导致某些方法在错误区域之内或之外的问题，但这可能是团队满意的权衡......

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2011-05-30T18:50:05.563

我讨厌区域（我的团队喜欢它们）并且惊讶地发现没有人编写扩展来使它们变得更好。我终于自己写了一篇名为**I Hate #Regions 的文章**：

*让#regions 吸得更少（免费）：*

[http://visualstudiogallery.msdn.microsoft.com/0ca60d35-1e02-43b7-bf59-ac7deb9afbca](http://visualstudiogallery.msdn.microsoft.com/0ca60d35-1e02-43b7-bf59-ac7deb9afbca)

*   打开文件时自动扩展区域
*   可选地防止区域被折叠（但仍然能够折叠其他代码）
*   给#region / #end 区域线一个更小、更亮的背景，这样它们就不那么明显了（也是一个选项）
*   在 C# 和 VB 中工作

![区域工具截图](https://i.stack.imgur.com/nPFCK.png)

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-05-13T15:43:21.777

有快捷键可以处理它们：

```
Ctrl+M、Ctrl+M 折叠或展开您当前所在的块。
Ctrl+M, Ctrl+O 折叠文件中的所有块
Ctrl+M, Ctrl+L 展开文件中的所有块
Ctrl+M, Ctrl+P 停止大纲模式。（Ctrl+M，Ctrl+O 恢复）

```

查看[代码折叠问题](https://blog.codinghorror.com/the-problem-with-code-folding/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T14:04:40.313

就个人而言，我编写了一个 VS 宏（工具 > 宏）来扩展文件打开时的所有区域。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T14:03:22.953

老实说，我不知道有这样的插件。但是，使用[VSTO](http://msdn.microsoft.com/en-us/vsto/default.aspx)，自己编写一个非常容易。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-13T14:09:23.643

这有点……低俗，并且可能有副作用，但是：

Tools-->Options-->Environment-->Fonts and Colors-->Preprocessor Keyword 将前景色和背景色更改为白色（或任何您的默认背景）。

不过，您不会看到其他预处理器关键字。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-02-10T13:27:56.003

对于 VS 2008 用户，您可以停止大纲并以编程方式重新启动它（通过宏）。[我在http://weblogs.asp.net/rweigelt/archive/2003/07/06/9741.aspx](http://weblogs.asp.net/rweigelt/archive/2003/07/06/9741.aspx)找到了这段代码

```
Imports EnvDTE

' Expands all regions in the current document    
Sub ExpandAllRegions()        
    DTE.ExecuteCommand("Edit.StopOutlining")        
    DTE.ExecuteCommand("Edit.StartAutomaticOutlining")    
End Sub 
```

以上适用于 C# IDE；出于某种原因，VB 的 IDE 在明确告知时不会删除带有区域的轮廓。希望这可以帮助！

-- 附加编辑：

这是在 Visual Studio 2008 中适用于 Visual Basic .NET 的一个。这有点暴力，但想法是注释所有#region 标记，扩展轮廓。下一步取消它们的注释，将它们返回到它们的原始状态（严格来说不是真的......可能在代码的其他部分有恶意使用#region）。此代码也不会将“查找和替换”对话框返回到其原始状态。有了这些警告，这是将执行此杂务的宏模块：

```
Imports System
Imports EnvDTE
Imports EnvDTE80
Imports EnvDTE90
Imports System.Diagnostics

Public Module MacroMod01
    Sub ExpandAllRegions()
    ' comment out all #region occurances
        DTE.ExecuteCommand("Edit.Replace")
        DTE.Find.Action = vsFindAction.vsFindActionReplaceAll
        DTE.Find.FindWhat = "#region"
        DTE.Find.ReplaceWith = "'#region"
        DTE.Find.Target = vsFindTarget.vsFindTargetCurrentDocument
        DTE.Find.MatchCase = False
        DTE.Find.MatchWholeWord = False
        DTE.Find.MatchInHiddenText = True
        DTE.Find.PatternSyntax = vsFindPatternSyntax.vsFindPatternSyntaxLiteral
        DTE.Find.ResultsLocation = vsFindResultsLocation.vsFindResultsNone
        DTE.Find.Action = vsFindAction.vsFindActionReplaceAll
        DTE.Find.Execute()

    ' uncomment all #region occurances
        DTE.ExecuteCommand("Edit.Replace")
        DTE.Find.Action = vsFindAction.vsFindActionReplaceAll
        DTE.Find.FindWhat = "'#region"
        DTE.Find.ReplaceWith = "#region"
        DTE.Find.Target = vsFindTarget.vsFindTargetCurrentDocument
        DTE.Find.MatchCase = False
        DTE.Find.MatchWholeWord = False
        DTE.Find.MatchInHiddenText = True
        DTE.Find.PatternSyntax = vsFindPatternSyntax.vsFindPatternSyntaxLiteral
        DTE.Find.ResultsLocation = vsFindResultsLocation.vsFindResultsNone
        DTE.Find.Action = vsFindAction.vsFindActionReplaceAll
        DTE.Find.Execute()

    'close the find 'n replace dialog
        DTE.Windows.Item("{CF2DDC32-8CAD-11D2-9302-005345000000}").Close()  

    End Sub

End Module 
```

对于 VS2008 中的 VB，可能还有其他一些方法可以完成此操作。我会在找到它们时发布。

* * *

## 回答 #7

> 赞同：-5
> 
> 时间：2012-04-01T18:35:18.533

我认为任何讨厌地区的人都很有趣。[我非常喜欢 Regions，我编写了一个名为 Regionizer 的程序，这是一个位于http://regionizer.codeplex.com](http://regionizer.codeplex.com)的开源项目

我有老板和一些讨厌他们的团队成员，但我的工具按字母顺序组织所有代码，因此方法在方法区域中按字母顺序排序，属性在属性区域中排序，事件在事件区域中排序。

尝试在没有此工具（或区域）的情况下查找代码就是我所说的意大利面条代码）。

我一直在寻找一种简单的方法来折叠和展开所有区域，并且 MS 告诉我这些区域是 .suo 文件的一部分（与项目或解决方案同名）并且没有一种简单的方法来处理在区域上反对他们自己。

我已经搜索了整个 DTE，但我还没有找到折叠所有区域或展开所有区域的方法，我将尝试使用宏代码，看看它是否有效。

将很快发布更新。

# sql-server - 奇怪的更新行为

> ID：858135
> 
> 赞同：0
> 
> 时间：2009-05-13T14:01:45.593
> 
> 标签：sql-server, sql-server-2005, data-warehouse

在我的数据仓库存储过程的一部分中，我有一个将旧项目数据与新项目数据进行比较的过程（旧数据在表中，新数据在临时表中）并更新旧数据。

奇怪的是，如果旧数据为空，则更新语句不起作用。如果我添加一个 is null 语句，则更新工作正常。我的问题是，为什么这不像我想象的那样工作？

多个更新语句之一：

```
update cube.Projects
set prServiceLine=a.ServiceLine
from @projects1 a
    inner join cube.Projects
        on a.WPROJ_ID=cube.Projects.pk_prID
where prServiceLine<>a.ServiceLine 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T14:09:03.317

```
where prServiceLine<>a.ServiceLine 
```

如果 prServiceLine 为 null 或 a.ServiceLine 为 null 则条件的结果为 null 而不是布尔值

测试这个：

```
declare @x int, @y int
if @x<>@y print 'works'
if @x=@y print 'works!'
set @x=1
if @x<>@y print 'not yet'
if @x=@y print 'not yet!'
set @y=2
if @x<>@y print 'maybe'
if @x=@y print 'maybe!' 
```

输出：

```
maybe 
```

你永远不会看到“作品”、“作品！”、“还没有”或“还没有！” 得到输出。只有Maybe（'也许！'，如果他们都是平等的）。

您不能使用 !=、= 或 <> 测试空值，如果您要测试的值之一可以为 NULL，则需要在 WHERE 中使用 ISNULL()、COALESCE、IS NOT NULL 或 IS NULL。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T14:31:37.650

[关于SQL Nulls](http://en.wikipedia.org/wiki/Null_(SQL))的 Wikipedia 文章实际上非常好 - 它解释了行为通常不是您所期望的，在许多情况下返回“未知”而不是 true 或 false。

如果您引入空值，则会涉及很多问题......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T14:04:56.147

也许您需要左连接（或右连接，具体取决于数据）而不是内部连接。

# javascript - 如何使用 java/vb 脚本调用自定义 ActiveX dll 中的方法

> ID：858140
> 
> 赞同：5
> 
> 时间：2009-05-13T14:02:56.480
> 
> 标签：javascript, dll, vb6, vbscript, activex

我使用 VB6 创建了一个 ActiveX dll，并使用打包和部署向导将其打包，从而生成了一个 cab 文件和一个演示 HTML 页面。

这个 ActiveX dll 包含一个简单的方法，它返回一个字符串并且不接受任何参数。

我遇到的麻烦是，当我调用该方法时，我总是收到**“对象不支持此属性或方法”**错误。但它*确实*支持我正在调用的方法。

我想要实现的是让用户访问其中包含一些 java 或 vb 脚本的网页，该脚本调用我的 ActiveX 中的方法并获取返回的字符串值。DLL 旨在被称为客户端。

我的测试网页如下：

```
<html>
<head>
    <title>SaveClipboardImage.CAB</title>
    <object id="Class1" classid="CLSID:" codebase="SaveClipboardImage.CAB#version=1,0,0,0"></object>
    <script type="text/javascript">
            function displaymessage()
            {
                try
                {
                var filename;

                filename = Class1.SaveClipboardToImage();

                alert(filename);
                }
                catch(e)
                {
                    alert(e.message);
                }               
            }
    </script>
</head>
<body>      
    <input type="BUTTON" onclick="displaymessage()" value="preview" />
</body>
</html> 
```

我显然做错了什么，但我不知道是什么。我是否必须对 VB6 项目中的类做一些特殊的事情才能访问该方法？我是否错误地调用了 DLL？

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-13T14:40:46.247

Javascript 对 Class1 一无所知。您必须将对象放入 javascript。

尝试：

```
 function displaymessage()
        {
            try
            {
                var filename;
                var class1 = document.getElementById("Class1");
                filename = class1.SaveClipboardToImage();

                alert(filename);
            }
            catch(e)
            {
                alert(e.message);
            }                       
        } 
```

# python - Dead-simple web authentication for a single user

> ID：858149
> 
> 赞同：0
> 
> 时间：2009-05-13T14:04:35.087
> 
> 标签：python, security, authentication, web-applications

I wrote a small internal web app using (a subset of) [pylons](http://pylonshq.com/). As it turns out, I now need to allow a user to access it from the web. This is not an application that was written to be web facing, and it has a bunch of gaping security holes.

What is the simplest way I can make sure this site is securely available to that user, but no one else?

I'm thinking something like apache's simple HTTP authentication, but more secure. (Is OpenID a good match?)

There is only one user. No need for any user management, not even to change password. Also, I trust the user not to damage the server (it's actually his).

If it was for me, I would just keep it behind the firewall and use ssh port forwarding, but I would like to have something simpler for this user.

**EDIT**: Hmm... judging by the answers, this should have been on serverfault. If a moderator is reading this, consider migrating it.

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-13T14:08:56.627

if there's only a single user, [using a certificate](http://impetus.us/~rjmooney/projects/misc/clientcertauth.html) would probably be easiest.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-13T14:10:49.993

How about VPN? There should be plenty of user-friendly VPN clients. He might already be familiar with the technology since many corporations use them to grant workers access to internal network while on the road.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-13T14:09:47.467

Basic HTTP authentication can be bruteforced easily by tools like brutus. If his ip is static you can allow his ip and deny all others with htaccess.

# ruby-on-rails - 没有打开文件的 VIM 上的 Rails

> ID：858152
> 
> 赞同：2
> 
> 时间：2009-05-13T14:04:42.250
> 
> 标签：ruby-on-rails, vim

我最近开始在 VIM 插件上使用带有 Rails 的 (Mac)VIM。

我的工作流程如下： 0）在项目路径中打开 VIM 1）在 VIM 中打开新选项卡 2）在项目中打开任何文件 3）在 VIM 上使用 Rails 做我需要的事情

你有什么想法如何跳过第二步，以便我可以在打开新标签后直接运行 R* 命令？

在打开的选项卡上打开一些占位符 ({PROEJCT}/readme)？还有其他想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-31T10:19:36.720

我会按照以下方式编写一个shell脚本

```
cd /project/path
vim README 
```

甚至只是`cd /project/path && vim`- 至少在 Linux rails.vim 检测到一个 Rails 应用程序，如果你在应用程序的目录中启动它

不过，现在，我的工作流程与您的完全相同，我不介意每天进行一两次例行程序。:)

# c# - 使用 WCF 服务 - c#, VS2008 with 3.5 SP1

> ID：858157
> 
> 赞同：1
> 
> 时间：2009-05-13T14:05:39.033
> 
> 标签：c#, visual-studio-2008, wcf

我正在尝试使用 WCF 服务。我获得了 svc 文件的 URL。1\. 创建了一个 Windows 窗体应用程序 2\. 添加了对 svc 文件的服务引用 3\. 在表单加载事件期间的代码中，我调用了服务公开的方法

```
 ServiceReference1.SearchServiceClient search = new WindowsFormsApplication1.ServiceReference1.SearchServiceClient();
        var serviceResult = search.SearchByClientNumber("1"); 
```

我收到此错误 由于内部错误，服务器无法处理请求。有关错误的更多信息，请在服务器上打开 IncludeExceptionDetailInFaults（来自 ServiceBehaviorAttribute 或来自配置行为）以便将异常信息发送回客户端，或根据 Microsoft .NET Framework 3.0 SDK 文档打开跟踪并检查服务器跟踪日志。”

我可以使用 WCFTestClient 调用该方法，但不能在我的应用程序中调用。

我需要在我的测试应用程序配置文件中执行一些更改吗？有一个部分

```
<client>
        <endpoint address="http://somewhere.com/Service.svc"
            binding="basicHttpBinding" bindingConfiguration="BasicHttpBinding_ISearchService"
            contract="ServiceReference1.ISearchService" name="BasicHttpBinding_ISearchService" />
    </client> 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-13T14:10:56.403

当从服务中引发异常并且无法返回消息时，会发生此错误。

如果您有权访问服务代码，只需按照异常状态（“ *...打开 IncludeExceptionDetailInFaults（来自 ServiceBehaviorAttribute 或来自配置行为）...* ”）进行调试。

示例`<serviceBehaviors>`标签：

```
<serviceBehaviors>
    <behavior name="WcfService1.Service1Behavior">
        <serviceDebug includeExceptionDetailInFaults="true"/>
    </behavior>
</serviceBehaviors> 
```

指定服务行为的示例：

```
<service name="WcfService1.Service1" behaviorConfiguration="WcfService1.Service1Behavior"> 
```

可以在[此处](http://msdn.microsoft.com/en-us/library/system.servicemodel.servicebehaviorattribute.includeexceptiondetailinfaults.aspx)找到 ServiceBehaviorAttribute.IncludeExceptionDetailInFaults 属性的详细说明。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T14:15:37.830

如果您可以修改服务器上的配置文件，那么您可以通过服务获取异常信息。

您需要将服务行为部分添加到服务器的配置中。

```
<behaviors>
  <serviceBehaviors>
    <behavior name="serviceNameBehavior">
      <serviceDebug includeExceptionDetailInFaults="True" />
      </behavior>
  </serviceBehaviors>
</behaviors> 
```

然后将服务与该行为相关联。

```
<service name="serviceName" behaviorConfiguration="serviceNameBehavior" ... 
```

# sample - Dynamics AX 2009 编程示例？

> ID：858159
> 
> 赞同：6
> 
> 时间：2009-05-13T14:06:07.567
> 
> 标签：sample, dynamics-ax-2009

我刚刚学习对 Dynamics AX 2009 进行编程。到目前为止，我已经让开发系统运行起来，我对架构有了一些背景知识。

现在，我正在寻找一些演练示例，以了解有关此系统中编程的更多信息。

网上有样品吗？有人可以指点我一些学习帮助吗？也许到一些好的 AX 编程相关博客？

您是如何学习对 DAX9 进行编程的？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-08-07T16:04:14.943

以下是您可能会发现有用的其他一些链接。

[MSDN 上的 Microsoft Dynamics AX 2009 SDK](https://docs.microsoft.com/en-us/ "微软动态 AX 2009 SDK")

[mfp的两分钱博客](https://community.dynamics.com/365/financeandoperations/b/mfp/archive "mfp的两分钱博客")

[Dynamics Axe 性能团队博客](https://web.archive.org/web/20100323003015/http://blogs.msdn.com:80/axperf/default.aspx "Dynamics Axe 性能团队博客")

[关于 X++ 博客的问题](https://docs.microsoft.com/en-us/archive/blogs/x/ "关于 X++ 的问题")

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-08-03T18:30:13.317

伟大的开始：[http ://www.axaptapedia.com/Main_Page](http://www.axaptapedia.com/Main_Page)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-04-16T09:29:44.970

这是我关注的 AX 博客列表：[http ://www.google.com/reader/shared/user/02229624826229113183/label/ax](http://www.google.com/reader/shared/user/02229624826229113183/label/ax)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-01-25T17:50:10.343

[Microsoft AX 客户来源与](http://www.microsoft.com/dynamics/customer/en-us/access-customersource/default.aspx)[AX 用户组](http://www.axug.com/)一样提供大量技术参考和培训

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-04-11T09:00:25.427

还有 4 本书可供您入门；

将这 3 个用于基本代码和开发；

MorphX IT Dynamics AX 在 Microsoft Dynamics AX 2009 第 2 版内入门

这个更高级，基于作者遇到的最常见的请求开发；

Microsoft Dynamics Axe 2009 开发手册

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-05-25T12:59:04.493

[您可以在此处](http://sirprogrammer.blogspot.com/2012/03/e-book-introduction-to-axapta-x-and.html)以 zip 文件的形式找到包含有用示例的英文电子书

如果您要学习在 AX 2012 中进行开发，[请单击此处获取有用的链接。](http://axwonders.blogspot.com/2012/01/helpful-ax-2012-links.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-01-03T12:26:46.720

这里有几个可用的示例：

车队管理 Microsoft Dynamics AX 2009 的车队管理示例应用程序提供了如何在 Microsoft Dynamics AX 中实现常用功能的示例。使用它来了解如何实现您自己的模块或集成应用程序。 [http://archive.msdn.microsoft.com/DynamicsAX2009FM/](http://archive.msdn.microsoft.com/DynamicsAX2009FM/)

设施管理：Microsoft Dynamics AX 2009 的设施管理示例应用程序提供了如何在 Microsoft Dynamics AX 中实现常用功能的示例。使用它来了解如何实现您自己的模块或集成应用程序。 [http://archive.msdn.microsoft.com/FCMDynamicsAX2009](http://archive.msdn.microsoft.com/FCMDynamicsAX2009)

谢谢

# wpf - WPF 中的访问控制

> ID：858164
> 
> 赞同：1
> 
> 时间：2009-05-13T14:07:13.757
> 
> 标签：wpf, xaml, resources

我正在尝试访问 MainWindow.xaml 的代码隐藏文件中的 .xaml 文件中的按钮。我曾尝试在文件中使用 x:Class ，但是当我使用它时，按钮可以工作，但我得到了很多其他错误。所以我不喜欢使用这种方法。

是否有任何其他方法可以使用来自 mainWindows 类的模板访问控件。

编码：

```
<ResourceDictionary xmlns='http://schemas.microsoft.com/winfx/2006/xaml/presentation'
                xmlns:x='http://schemas.microsoft.com/winfx/2006/xaml'
                xmlns:l="clr-namespace:Avalon.Demo" x:Class="Bildbanken.MainWindow"> 
```

```
 <!-- Taggarnas placering under bilderna (Left/ Top/ Right/ Bottom) -->
                        <Label Content="{Binding Type}" Padding="0,5,7,0" HorizontalAlignment="Right" />
                        <Label Content="{Binding Category}" Padding="7,0,0,0" />
                        <ListBox Name="ArtInfo" ItemsSource="{Binding Articles}" BorderThickness="0" Background="{TemplateBinding Background}">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="115px" />
                                            <ColumnDefinition Width="auto" />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0" Text="{Binding Artnr}"></TextBlock>
                                        <Button HorizontalAlignment="Right" Name="testbutton" Grid.Column="1">--</Button>
                                    </Grid>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-14T07:49:17.290

您可以指定一个 RoutedCommand，您可以通过 CommandBinding 将其添加到 DataTemplate 和按钮中。这样，您可以处理按钮单击/命令执行，例如在后面的代码中，并且不需要通过 VisualTreeHelper 找到按钮（或者我的提示是 SomeElement.TryFindResource("ButtonKey")）。

清楚我的意思还是我误解了你想用你按钮做的事情？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T15:54:02.023

可以访问数据模板的内容。您可以像这样获取模板的根元素：

```
UIElement templateRoot = listbox.ItemTemplate.LoadContent() as UIElement; 
```

从那里，您使用 VisualTreeHelper 查找 Button 控件。

如果您只是想处理按钮的单击，则使用 WPF 的 RoutedEvents 是更好的选择。

```
AddHandler(Button.ClickEvent, new RoutedEventHandler(Button_Click)); 
```

这将抓住每个按钮点击，无论来源如何。如果你给按钮一个标签或其他东西，你可以测试它来过滤你想要的那些按钮。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-19T19:43:54.213

首先你制作一个 .cs 文件，在其中注册你的命令。这可以命名为 MyCommandCollection.cs。在这个类中，您定义和注册您的 RoutedCommand：

```
 public static readonly RoutedCommand ButtonPressCommand= new RoutedCommand("ButtonPress", typeof(MyCommandCollection)); 
```

您在 UserControl 或要在其中使用它的窗口中定义命令，例如

```
<UserControl.CommandBindings>
     <CommandBinding Command="Commands:MyCommandCollection.ButtonPressCommand" Execute="Execute_ButtonPressCommand" ... />
</UserControl.CommandBindings> 
```

在 UserControl / Window 的代码隐藏中，您可以实现命令的 Execute / CanExecute 方法。

这样你也可以在 ResourceDictionary 中使用它，例如：

```
<Button Command="Commands:MyCommandCollection.ButtonPressCommand" /> 
```

不要忘记将“MyCommandCollectionClass.cs”的命名空间放在 UserControl / Window 和 ResourceDictionary 中，例如：

```
xmlns:Commands="clr-namespace:MyApp.SomeFolder.Commands" 
```

希望这可以帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-11-29T08:45:44.873

如果您发现自己需要模板内容的代码隐藏，通常最好将模板内容移动到用户控件中。（即使您不需要代码隐藏，这通常也是一个好主意。）

这个[对另一个问题的回答](https://stackoverflow.com/questions/4297195/wpf-passing-parameters-to-a-resourcedictionary/4297283#4297283 "将模板内容放入 UserControl")说明了这项技术。（这个问题可能看起来不相关，但答案恰好涉及我在这里提倡的相同方法。该示例恰好使用分层模板，但它同样适用于普通模板。）

用户控件在这里提供了两个好处。首先，它们有助于避免获得过于复杂的 Xaml 文件 - 如果您将它们的主体保持内联而不是将它们分离到自己的文件中，那么模板很容易支配 Xaml 文件。其次，您可以轻松使用代码隐藏。

也就是说，我同意这里提倡避免代码隐藏的各种其他答案。（我不太同意他们的具体解决方案 - 我使用基于命令的方法，但我不使用`RoutedCommand`- 我使用`ICommand`遵循通常称为 DelegatingCommand 或 RelayCommand 的模式的自定义实现。）但即便如此，我仍然几乎将模板主体定义为用户控件，只是为了简化 Xaml。

# visual-studio - 如何从源代码编译 C# 项目

> ID：858171
> 
> 赞同：8
> 
> 时间：2009-05-13T14:08:25.237
> 
> 标签：visual-studio, compiler-construction

所以我的意思是在没有视觉工作室的情况下编译

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-13T14:11:42.627

从[这里](http://msdn.microsoft.com/en-us/library/ms379563(VS.80).aspx)：

编译 File.cs 生成 File.exe：

```
csc File.cs 
```

编译 File.cs 生成 File.dll：

```
csc /target:library File.cs 
```

编译 File.cs 并创建 My.exe：

```
csc /out:My.exe File.cs 
```

编译当前目录中的所有 C# 文件，优化并定义 DEBUG 符号。输出是 File2.exe：

```
csc /define:DEBUG /optimize /out:File2.exe *.cs 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-05-13T14:09:46.920

转到项目目录（我假设 .NET 框架在您的 .NET 框架中`PATH`）：

```
msbuild <enter> 
```

如果您想编译一堆 C# 源文件（不在项目中），您可以使用该`csc`命令。`vbc`是 VB.NET 编译器。`jsc`是 JScript.NET 编译器。`cl`是 C++/CLI（和纯 C++）编译器。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-17T05:04:41.733

如果您已有解决方案或项目文件，请使用**msbuild**工具。您可以在文件夹“%windir%\Microsoft.NET\”的深处找到它。例如，在我的机器上，我运行以下命令来编译我的项目：

```
C:\Windows\Microsoft.NET\Framework\v3.5\MSBuild.exe MassiveMultithreading.sln 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-13T14:14:25.757

我为此创建了一个批处理文件，因此我可以连续编译多个项目。这应该可以帮助您朝着正确的方向前进：

```
cls
echo off
c:

cd windows
cd microsoft.net
cd framework
cd v3.5

msbuild c:\Project\Project.sln /t:rebuild /p:Configuration=Debug /p:Platform="any cpu" /clp:Nosummary 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-13T14:22:33.280

目前有三种编译 C# 项目的方法。第一个是使用 Visual Studio，但您已声明未安装 VS 是一个约束。第二个是使用原始的 .NET SDK 工具。第三种方法是使用[Mono](http://www.mono-project.com/Main_Page)。

使用 msbuild 需要安装 Visual Studio。不使用 csc，但它确实需要安装 .NET SDK。

使用 .NET：

*   编译 File.cs 生成 File.exe：

    `csc File.cs`

*   编译 File.cs 生成 File.dll：

    `csc /target:library File.cs`

*   编译 File.cs 并创建 My.exe：

    `csc /out:My.exe File.cs`

*   编译当前目录中的所有 C# 文件，优化并定义 DEBUG 符号。输出是 File2.exe：

    `csc /define:DEBUG /optimize /out:File2.exe *.cs`

使用单声道：

*   编译 File.cs 生成与 .NET 1.1 兼容的 File.exe：

    `mcs File.cs`

或 .NET 2.0 兼容

```
gmcs File.cs 
```

*   编译 File.cs 生成 File.dll：

    `msc /target:library File.cs`

*   编译 File.cs 并创建 My.exe：

    `msc /out:My.exe File.cs`

*   编译当前目录中的所有 C# 文件，优化并定义 DEBUG 符号。输出是 File2.exe：

    `msc /define:DEBUG /optimize /out:File2.exe *.cs`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-13T14:16:50.997

使用带有[csc.exe](http://msdn.microsoft.com/en-us/library/78f4aasd.aspx)或[msbuild的命令行](http://msdn.microsoft.com/en-us/library/0k6kkbsd.aspx)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-13T14:17:50.013

将您的路径或更改目录设置为 C:\Windows\Microsoft.NET\Framework\v2.0.50727（注意，如果使用不同框架版本的目录）。

类型：

MSBuild /path/to/your/project/projectname.solution /rebuild

或者，从命令行使用 csc。再次，切换到上面提到的目录，这次的命令是

csc /out:filename.exe /path/to/your/project/*.cs

注意，CSC.exe 有几百个操作。键入 csc -help 以获取更多详细信息。

# c# - 使用线程从外部 dll 传回数据

> ID：858177
> 
> 赞同：0
> 
> 时间：2009-05-13T14:09:10.587
> 
> 标签：c#, multithreading, dll, delegates

我有一个通用的通信库，我已经编写了它来通过 TCP/IP 与我们的硬件进行通信

公共库允许客户端应用程序和我们的工程师工具共享公共代码。公共库运行需要将数据返回到表单的线程。

我有一些工作代码，但我觉得必须有一种更简单的方法来做到这一点。

这是我所拥有的简化版本...

```
namespace EngineerTool
{

    public delegate void DelegateSearchFinished();

    public partial class MainForm : Form
    {
        public DelegateSearchFinished d_SearchFinished;
        Discover discovery;

        public MainForm()
        {
            InitializeComponent();
            discovery = new Discover(this.FinishedSearchInvoke);
            d_SearchFinished = new DelegateSearchFinished(this.FinishedSearch);
            discovery.Start();
        }

        public void FinishedSearchInvoke()
        {
            this.Invoke(this.d_SearchFinished, new Object[] {});
        }

        public void FinishedSearch()
        {
            // Search has finished here!
        }
    }
}

namespace DiscoveryTool
{
    public delegate void DelegateSearchFinished();

    public class Discover
    {
        DelegateSearchFinished _callFinished;

        public Discover(DelegateSearchFinished callFinished)
        {
            _callFinished = callFinished;
        }

        public void Start()
        {
            // starts thread and stuff
        }

        public void ThreadWorker()
        {

            _callFinished();
        }

    }
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-13T14:12:35.607

看一下 BackgroundWorker 类：

[BackgroundWorker 组件概述](http://msdn.microsoft.com/en-us/library/8xs8549b.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T14:16:19.187

如果在 Discover 类上创建一个事件并且 Form 订阅该事件，而不是传递委托，该怎么办。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T14:58:39.413

假设您正在执行将产生一个`List<Customer>`对象的搜索。然后，一种相当直接且简单的方法是在搜索完成时引发一个事件，使用携带结果的特殊 EventArgs 类：

```
public class CustomerSearchEventArgs : EventArgs
{
    public List<Customer> Customers { get; private set; }
    public CustomerSearchEventArgs(List<Customer> customers)
    {
        Customers = customers;
    }
} 
```

...在搜索类中：

```
// the parameter is there to conform to the signature of the WaitDelegate
// used when invoking the method using the ThreadPool
public void Search(object state)
{    
    List<Customer> result = new List<Customer>();
    // perform the search, populate the result list
    // call a method to raise the event
    OnSearchFinished(new CustomerSearchEventArgs(result));
}

protected void OnSearchFinished(CustomerSearchEventArgs e)
{
    EventHandler<CustomerSearchEventArgs> searchFinished = this.SearchFinished;
    if (searchFinished != null)
    {
        searchFinished(this, e);
    }
} 
```

...形式为：

```
private delegate void CustomerListHandler(List<Customer> customers);

private void StartSearch()
{
    CustomerSearch search = new CustomerSearch();
    search.SearchFinished += new EventHandler<CustomerSearchEventArgs>(Search_SearchFinished);
    ThreadPool.QueueUserWorkItem(search.Search);
}
private void Search_SearchFinished(object sender, CustomerSearchEventArgs e)
{
    SearchFinished(e.Customers);
}

private void SearchFinished(List<Customer> list)
{
    if (this.InvokeRequired)
    {
        // the method is NOT executing on the UI thread; we
        // need to invoke it on the right thread
        this.Invoke(new CustomerListHandler(SearchFinished), list);
    }
    else
    {
        lstCustomers.Items.Clear();
        lstCustomers.DisplayMember = "Name";
        lstCustomers.Items.AddRange(list.ToArray());
    }
} 
```

# javascript - 如何在 JavaScript 中检查未定义的变量

> ID：858181
> 
> 赞同：995
> 
> 时间：2009-05-13T14:09:45.407
> 
> 标签：javascript, variables, undefined

我想检查变量是否已定义。例如，以下抛出未定义的错误

```
alert( x ); 
```

我怎样才能捕捉到这个错误？

* * *

## 回答 #1

> 赞同：1796
> 
> 时间：2009-05-13T14:11:30.320

在 JavaScript 中，`null`是一个对象。不存在的事物还有另一个价值，`undefined`. DOM`null`在几乎所有无法在文档中找到某些结构的情况下都会返回，但在 JavaScript 本身`undefined`中就是使用的值。

其次，不，没有直接的等价物。如果您真的想专门检查`null`，请执行以下操作：

```
if (yourvar === null) // Does not execute if yourvar is `undefined` 
```

如果要检查变量是否存在，只能使用`try`/来完成`catch`，因为`typeof`会将未声明的变量和使用值声明的变量`undefined`视为等效的。

但是，要检查变量是否已声明*且未*`undefined`声明：

```
if (yourvar !== undefined) // Any scope 
```

以前，必须使用`typeof`运算符安全地检查 undefined，因为可以`undefined`像变量一样重新分配。旧方式如下所示：

```
if (typeof yourvar !== 'undefined') // Any scope 
```

`undefined`可重新分配的问题已在 2009 年发布的 ECMAScript 5 中得到修复。您现在可以安全地使用`===`和`!==`测试，`undefined`而无需使用一段`typeof`时间`undefined`以来一直是只读的。

如果你想知道一个成员是否独立存在但不关心它的值是什么：

```
if ('membername' in object) // With inheritance
if (object.hasOwnProperty('membername')) // Without inheritance 
```

如果您想知道变量是否为[真](https://developer.mozilla.org/en-US/docs/Glossary/Truthy)：

```
if (yourvar) 
```

[来源](http://lists.evolt.org/archive/Week-of-Mon-20050214/099714.html)

* * *

## 回答 #2

> 赞同：381
> 
> 时间：2009-05-13T14:53:55.867

真正测试变量是否`undefined`是的唯一方法是执行以下操作。请记住，未定义是 JavaScript 中的一个对象。

```
if (typeof someVar === 'undefined') {
  // Your variable is undefined
} 
```

这个线程中的一些其他解决方案会让你相信一个变量是未定义的，即使它已经定义（例如，值为 NULL 或 0）。

* * *

## 回答 #3

> 赞同：72
> 
> 时间：2009-05-13T14:12:29.943

从技术上讲，正确的解决方案是（我相信）：

```
typeof x === "undefined" 
```

你有时会变得懒惰并使用

```
x == null 
```

但这允许未定义的变量 x 和包含 null 的变量 x 返回 true。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2009-05-13T14:26:03.493

一个更简单、更简写的版本是：

```
if (!x) {
   //Undefined
} 
```

或者

```
if (typeof x !== "undefined") {
    //Do something since x is defined.
} 
```

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2009-05-13T14:45:39.000

我经常这样做：

```
function doSomething(variable)
{
    var undef;

    if(variable === undef)
    {
         alert('Hey moron, define this bad boy.');
    }
} 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2018-07-02T14:07:23.343

[`void`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/void)运算符返回`undefined`传递给它的任何参数/表达式。因此您可以针对结果进行测试（实际上一些缩小器将您的代码从 更改`undefined`为`void 0`以保存几个字符）

例如：

```
void 0
// undefined

if (variable === void 0) {
    // variable is undefined
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2018-01-10T06:33:42.990

该错误告诉您`x`甚至不存在！它还没有被**声明**，这与被**赋值**不同。

```
var x; // declaration
x = 2; // assignment 
```

如果您声明`x`，您将不会收到错误消息。您会收到一条警报，说明`undefined`因为`x`存在/已声明但尚未分配值。

要检查变量是否已声明，您可以使用`typeof`，任何其他检查变量是否存在的方法都会引发您最初遇到的相同错误。

```
if(typeof x  !==  "undefined") {
    alert(x);
} 
```

这是检查存储在 中的值的类型`x`。它只会`undefined`在`x`尚未声明或*已*声明但尚未分配时返回。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2017-11-13T20:16:31.537

另一个潜在的“解决方案”是使用`window`对象。它避免了在浏览器中的引用错误问题。

```
if (window.x) {
    alert('x exists and is truthy');
} else {
    alert('x does not exist, or exists and is falsy');
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2021-11-12T09:46:46.740

很抱歉死灵，但这里的大多数答案都混淆了“未定义”和“未定义”

1.  **未定义**- 声明了一个变量，但它的值未定义。

2.  **未定义**- 甚至没有声明变量。

检查这两种情况的唯一安全方法是使用`typeof myVar === 'undefined'`

`myVar === undefined`只会检查案例编号 (1)。`myVar`如果甚至没有声明，它仍然会为案例编号 (2) 抛出“myVar is not defined” 。OP专门询问“甚至没有定义”的情况（2）。

^(PS 我确实理解“案例 2”在现代 ES6 世界中变得越来越少，但一些旧的遗留组件仍然存在于过去。)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2015-12-09T08:44:22.770

我经常使用最简单的方法：

```
var variable;
if (variable === undefined){
    console.log('Variable is undefined');
} else {
    console.log('Variable is defined');
} 
```

**编辑：**

不初始化变量，会抛出异常“Uncaught ReferenceError: variable is not defined...”

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2016-02-12T12:02:28.917

您还可以使用三元条件运算符：

```
var a = "hallo world";
var a = !a ? document.write("i dont know 'a'") : document.write("a = " + a);
```

```
//var a = "hallo world";
var a = !a ? document.write("i dont know 'a'") : document.write("a = " + a);
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2017-08-11T17:25:00.077

接受的答案是正确的。只是想再添加一个选项。您也可以使用`try ... catch`块来处理这种情况。一个怪异的例子：

```
var a;
try {
    a = b + 1;  // throws ReferenceError if b is not defined
} 
catch (e) {
    a = 1;      // apply some default behavior in case of error
}
finally {
    a = a || 0; // normalize the result in any case
} 
```

请注意`catch`块，这有点混乱，因为它创建了块级范围。而且，当然，该示例非常简化以回答所提出的问题，它不包括错误处理的最佳实践；）。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2019-01-31T12:08:03.267

只需执行以下操作：

```
function isNotDefined(value) {
  return typeof value === "undefined";
} 
```

并称之为：

```
isNotDefined(undefined); //return true
isNotDefined('Alireza'); //return false 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2016-07-04T17:17:18.303

我们可以检查`undefined`如下

```
var x; 

if (x === undefined) {
    alert("x is undefined");
} else {
     alert("x is defined");
} 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2018-07-05T17:48:51.457

我使用一个小函数来验证变量是否已被声明，这确实减少了我的 javascript 文件中的杂乱程度。我添加了对该值的检查，以确保该变量不仅存在，而且还被分配了一个值。第二个条件检查变量是否也已实例化，因为如果变量已定义但未实例化（参见下面的示例），如果您尝试在代码中引用它的值，它仍然会抛出错误。

未实例化 -`var my_variable;`已实例化 -`var my_variable = "";`

```
function varExists(el) { 
  if ( typeof el !== "undefined" && typeof el.val() !== "undefined" ) { 
    return true; 
  } else { 
    return false; 
  } 
} 
```

然后，您可以使用条件语句来测试变量是否已像这样定义和实例化......

```
if ( varExists(variable_name) ) { // checks that it DOES exist } 
```

或者测试它没有被定义和实例化使用......

```
if( !varExists(variable_name) ) { // checks that it DOESN'T exist } 
```

# c# - 为什么 Sharepoint Webservice 将 #（磅）符号和 id 添加到字段值？

> ID：858192
> 
> 赞同：3
> 
> 时间：2009-05-13T14:11:28.400
> 
> 标签：c#, xml, web-services, sharepoint, serialization

我编写了一个例程从共享点字段中删除磅和 ID，这些字段工作完美，因为我发现了一个没有 ID 和 #（磅）符号的字段。

我想了解为什么有时该字段会使用 ids 和磅进行序列化，而有时则不会。

例子：

```
ows_Author="23;#Paperino, Pippo" 
```

或者

```
ows_Author="Paperino, Pippo" 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-13T14:16:38.907

';#' 序列是一个分隔符。如果你删除它，你无疑会以一种令人讨厌的方式破坏事物。

23 是 ID，“Paperino, Pippo”是价值。就像下拉列表具有值/文本配对一样。有时它 [ID + 分隔符] 会在那里，有时则不会。这取决于值在 UI 中的绑定方式。如果它绑定到下拉选择器（如“此站点上的用户”），那么它将是一个值/文本配对。如果它是由共享点自动填充的，例如“修改者”，那么它很可能没有 ID 前缀。

有道理？

-Oisin

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-14T21:25:33.460

查阅列（包括安全设置）以 [ID]#;[value] 方式存储值，因为可以删除或重命名查阅列目标中的值。

此更改意味着存储 ID 使字段能够查找正确的 [值]，即使它在查找目标列表中发生更改。

如果查找目标列表已删除项目，则尽管存在差异，仍可显示原始值。

请注意，如果在原始查找 ID 无效的情况下保存该字段，它将仅存储您记录的值（例如 ows_Author="Paperino, Pippo"）。

# apache-flex - Flex：有没有办法让 TileList 高亮“超过”itemRenderer？

> ID：858194
> 
> 赞同：0
> 
> 时间：2009-05-13T14:11:31.503
> 
> 标签：apache-flex, itemrenderer

我的项目渲染器是图像，所选项目的突出显示在图像下方，因此您看不到突出显示，有没有办法使突出显示“超过”图像？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T17:45:44.977

这正是我意识到 Flex 中某些看似简单的事情实际上有多么复杂的时候。:)

根据您所追求的效果，有多种处理此类问题的方法，但我一直这样做的方法是首先覆盖 TileList 的某些功能，然后使用自定义 itemRenderers。（不过，我一直无法弄清楚如何将 List 的图形对象绘制在渲染的内容*之上*——其他人可能会对此有所了解。）

例如，我通常会创建一个扩展 TileList 的新类，然后重写负责绘制高亮和选择指示符的方法，以更好地控制这些函数绘制指示符的方式（或者有时我会注释掉它们的内容完全一致，这样就不会绘制任何内容）：

```
public class MyCustomTileList extends TileList
{
    public function MyCustomTileList()
    {
        super();
    }

    override protected function drawHighlightIndicator(indicator:Sprite, x:Number, y:Number, width:Number, height:Number, color:uint, itemRenderer:IListItemRenderer):void
    {           
        var g:Graphics = Sprite(indicator).graphics;
            g.clear();
            g.beginFill(getStyle("myRolloverColor"), getStyle("myRolloverAlpha"));
            g.drawRect(1, 1, width - 1, height - 1);
            g.endFill();

            indicator.x = x;
            indicator.y = y;
    }

    override protected function drawSelectionIndicator(indicator:Sprite, x:Number, y:Number, width:Number, height:Number, color:uint, itemRenderer:IListItemRenderer):void
    {
        //
    }
} 
```

但正如你所说，由于图形对象似乎总是在列表项的内容*后面*绘制，我通常会选择使用项目渲染器在与我的数据相关联的图像之上绘制一些东西（例如，半透明框）物品：

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml">

    <mx:Script>
        <![CDATA[

            private function img_rollOver():void
            {
                highlight.visible = true;
            }

            private function img_rollOut():void
            {
                highlight.visible = false;
            }

        ]]>
    </mx:Script>

    <mx:Image id="img" source="{something}" horizontalCenter="0" verticalCenter="0" buttonMode="true" useHandCursor="true" mouseChildren="true" rollOver="img_rollOver()" rollOut="img_rollOut()" />
    <mx:Box id="highlight" alpha="0.1" color="#FFFFFF" horizontalCenter="0" verticalCenter="0" width="{img.width}" height="{img.height}" buttonMode="true" useHandCursor="true" mouseChildren="true" rollOver="img_rollOver()" rollOut="img_rollOut()" visible="false" />

</mx:Canvas> 
```

我确信还有其他方法，但是这种方法对我来说效果很好，而且我通常会发现将库存 Flex 控件子类化还有其他好处。

希望能帮助到你！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T14:20:47.947

考虑使用边框，将图像填充 2px 吗？想到的另一种选择是绝对定位......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-14T01:56:23.503

我认为关闭选择和高亮效果更容易，然后在渲染器中创建您期望的内容。渲染器的数据需要有某种 .selected 属性。然后，渲染器可以绑定或响应更改它的 data.selected （或类似的东西）并根据需要更新它的外观。

当我别无选择时，我只使用列表中的默认视觉效果。我永远不想尝试将 List 扩展到它（虽然，好的代码 Christian）。

# sql-server - 在 SQL Server 2005 中，我可以同时拍摄多个数据库快照吗？

> ID：858195
> 
> 赞同：1
> 
> 时间：2009-05-13T14:11:32.317
> 
> 标签：sql-server, snapshot, backupexec

我们正在设置 K2，它要求在备份之前对多个数据库进行快照，以便它们处于完全相同的时间点。我可以这样做吗？怎么做？总共有 14 个数据库需要备份。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T14:17:30.900

如果您希望它们在完全相同的时间点备份，您可以将它们全部置于单用户模式，备份它们，然后将它们返回到多用户模式。

建议的最大数据库快照数约为 10，并且不打算完全按照您建议的方式使用它们。

# c# - 使用亚音速时如何进行或选择？

> ID：858197
> 
> 赞同：0
> 
> 时间：2009-05-13T14:12:18.493
> 
> 标签：c#, subsonic

这是我的代码：

```
TransactionCollection transactions = new TransactionCollection();
transactions.Where("next_action", "RESEND");
transactions.Where("job_id", CurrentJob.Id);
transactions.Load(); 
```

我真的希望它说 next_action 是 RESEND 或 next_action 是 TARGET。谢谢。

基本上我想要一个这样的选择语句：

```
select * from transactions where job_id = 1 and (next_action = 'RESEND' OR next_action = 'TARGET'); 
```

或者

```
select * from transactions where job_id = 1 and next_action IN ('RESEND', 'TARGET'); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T15:33:47.970

如果您使用的是 SubSonic 2.1 或更高版本，您可以利用 AndExpression 和 OrExpression。对于您的第一个示例，以下内容应该有效：

```
TransactionCollection transactions = DB.Select().From(Transaction.Schema)
  .Where("job_id", CurrentJob.Id);
  .AndExpression("next_action")IsEqualTo("RESEND")
  .Or("next_action")IsEqualTo("TARGET")
  .ExecuteCollection<TransactionCollection>() 
```

# python - 如何将 django FileField 保存到用户文件夹？

> ID：858213
> 
> 赞同：3
> 
> 时间：2009-05-13T14:16:48.110
> 
> 标签：python, django, django-models, upload

我有一个这样的模型

> ```
>  def upload_location(instance, filename):
>     return 'validate/%s/builds/%s' % (get_current_user(), filename) 
> 
> class MidletPair(models.Model):
>     jad_file = models.FileField(upload_to = upload_location)
>     jar_file = models.FileField(upload_to = upload_location)
>     upload_to=tempfile.gettempdir() 
> ```

如何在 upload_location()... 中获取当前用户？

旁注：查找 django 的东西令人困惑，因为网上有很多 1.0 之前的东西。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-13T15:13:25.647

当前用户存储在请求对象中，除非您从其他地方传递它，否则您无法在模型方法中获取它 - 您无法在 upload_to 函数中执行此操作。

所以你需要以不同的方式处理这个问题——我建议在表单级别进行。您可以将请求对象传递给表单的`__init__`方法并将其存储在实例属性中，您可以在自定义上传处理程序中访问它。有关上传处理程序的文档，请查看[此处](http://docs.djangoproject.com/en/dev/topics/http/file-uploads/)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-03-11T12:38:04.777

如果您在模型中添加了一个用户字段，并在执行上传之前设置了该属性，那么您可以通过实例属性让用户进入您的 upload_location 函数。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-13T14:23:49.923

首先，不要在网上搜索 Django 帮助。仅在此处搜索：http: [//docs.djangoproject.com/en/dev/](http://docs.djangoproject.com/en/dev/)

其次，当前用户是身份验证的一部分。

[http://docs.djangoproject.com/en/dev/topics/auth/#topics-auth](http://docs.djangoproject.com/en/dev/topics/auth/#topics-auth)

用户被记录在请求中。 `request.user`

# svn - 有没有办法像 svn checkout 那样限制网络带宽？

> ID：858216
> 
> 赞同：2
> 
> 时间：2009-05-13T14:16:54.117
> 
> 标签：svn, networking

在检查一个非常大的 svn 存储库时，我想限制 svn 客户端使用的带宽，以免影响非常敏感的网络。这可以在 svn 中配置吗？这是否可以通过其他方式进行配置？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-14T18:40:00.797

它在 SVN 中不可配置。您可以（痛苦地）通过带宽限制（虚拟）路由器（例如 FreeBSD 上的 DummyNet）运行 SVN 连接来处理此问题。您还可以通过 HTTP 代理（例如 Squid）来路由流量，它可以限制带宽，或者使用内置的 Linux iptables 功能（使用“tc”进行流量控制）来限制带宽，但这通常不容易配置/使用。

有关各种（大部分是过时的）信息，请参阅[http://lartc.org/](http://lartc.org/)，但 lartc 邮件列表（和档案）可能会提供更多信息。另见[http://www.docum.org/docum.org/](http://www.docum.org/docum.org/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T16:30:28.237

如果您的工作站上有复杂的网络（如 OpenBSD 的防火墙或 Linux 的流量控制），那么您应该根据目标网络配置流量整形。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-13T16:16:27.197

我在任何 svn 客户端中都看不到任何东西。但是，您可以编写自己的代理服务并在其中放置一个简单的限制类。

如果您想尝试，请[将此视为参考或向 SO 社区建议一些代码。](http://www.codeproject.com/KB/IP/Bandwidth_throttling.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-10-31T13:15:27.830

如果您控制着 SVN 服务器，并且它通过 Apache 通过 mod_dav_svn 运行，一个可行的解决方案是安装[mod_bw](http://www.uno-code.com/?q=node/64)或[mod_cband](http://dembol.org/blog/mod_cband/documentation/)。

使用任一解决方案，您都可以在提供 SVN 存储库的虚拟主机上设置带宽限制。

# vb.net - 用 VB 在单词后面加上“()”有什么作用？

> ID：858217
> 
> 赞同：0
> 
> 时间：2009-05-13T14:17:14.863
> 
> 标签：vb.net

在单词后面加上“()”有什么作用？有时它不起作用

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-13T14:23:07.553

**方法**

如果您查看 Console.WriteLine，此方法的常用形式有一个或多个参数，例如

```
Console.WriteLine("Hello World") 
```

但是，一个重载不带参数，只打印一个空行

```
Console.WriteLine() 
```

空大括号显示没有争论的方法调用。

**数组**

```
Dim s as String ' declares one string
Dim as(10) as string ' declares 11 strings, accessed by position 
```

以下两者都声明了稍后将分配给字符串数组的变量。

```
Dim n() as string
Dim m as string() 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T14:17:59.013

它调用一个方法。它还用于声明一个数组，具体取决于上下文。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T14:22:49.333

括号用于函数或方法调用。例如，如果您有一个名为 Run 的方法，您可以通过说 MyDog.Run() 来调用它

属性和常规变量不同，不使用括号。例如，MyDog.FurColor = 蓝色

一些函数接受参数。以我们的例子为例，一个参数可能是运行多远。所以，MyDog.Run(10)

但是，鉴于您的其他问题，您可能已经知道这个问题的答案......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T14:21:06.730

我们使用 () 来表示 1) 方法或 2) 函数或 3) 子例程或 4) 过程等。

数组也使用它。

方法 = 可以由对象执行的操作。在 Visual Basic .NET 中，方法被定义为 Subs 和 Functions。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-13T14:26:44.210

扩展 Mehrdad 所说的话：

以下行使用“()”来声明数组：

```
'dynamic array w/o pre-set length'
Dim Doubles() As Double

'array of length 11'
Dim Doubles(10) As Double

'array of Strings initialized with three items'
Dim Strings() As New String() {"String1", "String2", "String3"} 
```

以下行不声明数组：

```
'here the "()" are treated as a call to the MyObject constructor'
Dim MyObjects As New MyObject() 
```

# php - PHP 脚本在浏览器上运行，但不使用 wget

> ID：858219
> 
> 赞同：0
> 
> 时间：2009-05-13T14:17:45.830
> 
> 标签：php, browser, wget, debian-based

我有一个通过 wget 运行 5 个 php 脚本的 bash-sctipt。每个 php 文件都被调用，但是在最后一个脚本上，我收到了这个警告：

> mysql_query()：提供的参数不是 xyz.php 中有效的 MySQL-Link 资源，位于 ABC 行

真正奇怪的是，如果我通过浏览器运行相同的脚本，脚本运行良好，没有任何警告。

这是我在 ABC 线附近的代码：

```
$sqlSTR="INSERT INTO accounts_cstm (id_c, mtk_categoriascompradas_c) VALUES ('". $arr[1] . "', '" . $arr[0] . "')
                    ON DUPLICATE KEY UPDATE mtk_categoriascompradas_c= concat(mtk_categoriascompradas_c, '^,^$arr[0]')";        

$ExecuteSQL = mysql_query ($sqlSTR, $DBConn) or
                die ($sqlSTR); //warning on this line - line ABC 
```

我的 SQL 是完全有效的（如果我运行在“die”语句中输出的查询，它将完美运行），DBConn 已连接到数据库，并且所有其他脚本都运行良好，除了这个。

我真的不知道是什么导致了这个*警告*。欢迎任何帮助。

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-13T14:21:25.980

您的问题实际上在于您的数据库连接 ( `$DBConn`)。看看那个代码。插入一个 var_dump 并再次尝试 wgetting。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T14:40:30.630

`mysql_error()`当您看到此错误消息时，请始终使用。然后你就会知道查询无效的确切原因。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T14:21:23.547

您在查询中对 $arr[0] 的最后引用肯定看起来有问题 - 我认为它需要如下：

```
$sqlSTR="INSERT INTO accounts_cstm (id_c, mtk_categoriascompradas_c) VALUES ('". $arr[1] . "', '" . $arr[0] . "')
ON DUPLICATE KEY UPDATE mtk_categoriascompradas_c= concat(mtk_categoriascompradas_c, '^,^".$arr[0]."')"; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T15:49:02.173

您使用 wget 调用的 URL 中是否有 & 符号？如果这样做，请确保您的 shell 没有将其解释为`send process to background`

# sql-server - SSIS 批量插入是否与 BULK 插入相同

> ID：858220
> 
> 赞同：5
> 
> 时间：2009-05-13T14:17:49.763
> 
> 标签：sql-server, ssis

我正在使用 SSIS 包（不是我构建的）将 CSV 文件批量插入 SQL Server 2005

我正在运行 SQL Profiler 并将插入语句视为：

```
insert bulk [dbo].[stage_dht]( ..... ) 
```

但是该语句中没有 FROM 子句，所以我很好奇它是如何获取数据的，这种所谓的快速加载是将数据批量写入 SQL 的最佳方式吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-15T22:45:05.803

是的，SSIS 批量插入任务使用与 BULK INSERT 命令相同的下划线功能。

您很可能会在 SQL Profiler 中看到差异，因为 Bulk Insert 任务将直接使用带下划线的 COM 对象（它支持批量插入），而不是简单地作为 T-SQL 命令的 GUI 包装器。因此，我猜测它不是指定 FROM ，而是将打开的 IO 流指针传递给 COM 对象。

批量插入几乎是将大量数据加载到 SQL Server 中的最快方法，因为它在进程内运行，“共享相同的内存地址空间。因为数据文件是由 SQL Server 进程打开的，所以数据不会在客户端之间复制进程和 SQL Server 进程”。[1](http://msdn.microsoft.com/en-us/library/ms187042.aspx)

但是，如果文件与 SQL Server 是否在同一台计算机上，性能会有所不同。

[1](http://msdn.microsoft.com/en-us/library/ms187042.aspx) [关于批量导入和批量导出操作](http://msdn.microsoft.com/en-us/library/ms187042.aspx)

# ruby-on-rails - 按关联对象的属性对对象列表进行排序

> ID：858224
> 
> 赞同：3
> 
> 时间：2009-05-13T14:18:25.220
> 
> 标签：ruby-on-rails, ruby, activerecord

我可以按关联对象的属性对对象列表进行排序吗？

例如下面的类

```
class RosterSlot < ActiveRecord::Base
  belongs_to :event
  belongs_to :skill
  belongs_to :person
end 
```

我想做类似 RosterSlot.find(:all, :order => Skill.name)

这意味着 activerecord 需要进行连接和排序。

有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-13T15:12:11.250

是的，您可以使用 :include 选项进行连接。

```
RosterSlot.find(:all, :include => [:skill], :order => "skills.name ASC") 
```

:order 选项接受一个 SQL 片段，因此技能是对复数数据库表名的引用。

:include 接受一系列活动记录关联。

有关更多信息，请参阅[http://www.railsbrain.com/api/rails-2.3.2/doc/index.html?a=M002313&name=find](http://www.railsbrain.com/api/rails-2.3.2/doc/index.html?a=M002313&name=find)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T19:21:08.720

您也可以使用 sort 方法在 ruby​​ 中执行此操作。

```
RosterSlot.all.sort { |x,y| x.skill.name <=> y.skill.name } 
```

我个人会让您的数据库进行排序，但此方法可用于对通过 ActiveRecord::Base 查找以外的方法返回的模型对象的结果集进行排序。

# c# - configSource 在 system.serviceModel *或*它的小节中不起作用

> ID：858225
> 
> 赞同：35
> 
> 时间：2009-05-13T14:18:29.900
> 
> 标签：c#, .net, winforms, wcf, configuration

我正在尝试将 app.config 文件拆分为多个文件，以便更轻松地管理不同环境所需的差异。有些部分很容易......

```
<system.diagnostics>
    various stuff
</system.diagnostics> 
```

变成了

```
<system.diagnostics configSource="ConfigFiles\system.diagnostics.dev" /> 
```

将“各种东西”移至 system.diagnostics.dev 文件。

但是对于该`system.serviceModel`部分，这似乎不起作用。

现在我已经阅读了一些建议，它对自己不起作用`system.serviceModel`，但它适用于它下面的部分：`bindings`, `client`,`diagnostics`等。但是当我尝试将 configSource 与其中之一一起使用时，同样的事情发生在我身上。当我投入

```
<system.serviceModel>
  <bindings configSource="ConfigFiles\whateverFile.dev" /> 
```

我得到：

**'configSource' 属性未声明。**

有没有其他人看过这个？你知道解决办法吗？（也许我有一个过时的模式或什么？）

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2009-05-13T14:32:53.030

VS.NET 的编辑器抱怨配置，但它有效。

我有这样的配置...

```
<system.serviceModel>
  <behaviors configSource="config\system.servicemodel.behaviors.config" />
  <bindings configSource="config\system.servicemodel.bindings.config" />
  <client configSource="config\system.servicemodel.client.config" />
</system.serviceModel> 
```

...效果很好。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-05-13T14:38:50.257

它**不会**起作用，`<system.serviceModel>`因为那是配置 SectionGroup - 而不是配置 Section。

它会在运行时在下面的任何东西上正常工作**-**`<system.serviceModel>`我们一直这样做。马丁的回答很好地说明了这一点 - 他的样本会起作用。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-02-03T17:45:02.187

将配置部分移动到单独的文件时要注意的一件事：确保分离的配置文件不包含 configSource 属性。例如，如果您像这样拆分绑定部分，

```
<system.serviceModel>
    <bindings configSource="yourConfigFile.config" />
</system.serviceModel> 
```

确保您的实际绑定文件不包含“configSource”属性：

```
<?xml version="1.0" encoding="utf-8"?>
<bindings>
    <!-- binding configuration stuff -->
</bindings> 
```

我知道这似乎很明显，但是如果您输入 configSource 属性，然后剪切并粘贴到一个新文件中，很容易忘记将属性取出。

希望这可以帮助。

# com - 如何以另一个（更多特权）用户身份启动进程外 COM 服务器

> ID：858227
> 
> 赞同：2
> 
> 时间：2009-05-13T14:18:40.120
> 
> 标签：com, privileges, runas

我想创建一个作为另一个用户在进程外 COM 服务器中运行的 COM 对象。我怎么做？

我可以控制 COM 服务器源代码，而我的 COM 客户端是唯一将创建这些 COM 对象的客户端。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T14:39:20.477

你是为 Vista 写的吗？如果是这样，您可以使用在提升状态下运行 COM 对象的特殊 COM 调用。有关更多详细信息，请参阅[本文](http://msdn.microsoft.com/en-us/ms679687.aspx)。

如果你不是在谈论 UAC，你可以查看[CoInitializeSecurity](http://msdn.microsoft.com/en-us/library/ms693736(VS.85).aspx)函数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T14:42:51.063

我们使用 COM+ 以网络用户的身份运行对象，该用户具有我们赋予它的某些权限（大多数是对 SQL 服务器的 Windows 身份验证）。这没有做的是控制谁可以调用这些对象，直到我们赋予它的安全性.

在 Vista 和未来，有一个 COM 提升功能可以完全满足您的需求。哦，好像刚刚有人发了。按照他们留下的链接。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T14:52:54.447

使用 RunAs - 请参阅[http://msdn.microsoft.com/en-us/library/ms680046(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms680046(VS.85).aspx)。

NB 此设置也可以通过“DCOM config”下的 dcomcnfg (Win2000) 或 comexp.msc (WinXP+) 进行配置

如果您的对象实现为 InProc 服务器，您可以将其与 DLL 代理项结合使用（请参阅[http://msdn.microsoft.com/en-us/library/ms691260(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms691260(VS.85).aspx)）。

# ironpython - IronPython 和实例化 COM 对象

> ID：858230
> 
> 赞同：3
> 
> 时间：2009-05-13T14:20:08.010
> 
> 标签：ironpython, sharpdevelop, outlook-redemption

我在 SharpDevelop 3.1 控制台窗口中使用 IronPython 2.0。我正在尝试引用和使用 Redemption CDO 替换库。

该库的标准用法是实例化一个 RDOSession 对象，然后使用该对象上的方法在 RDO 对象模型中导航。

我已经注册了 Redemption COM dll 并从一个项目中引用了它，该项目为它创建了一个互操作程序集。然后在 IronPython 控制台窗口中执行以下操作： import clr clr.AddReferenceToFileAndPath(r'd:\SharpDevelop Projects\TestPython\TestPython\obj\Debug\Interop.Redemption.dll') import Redemption

到目前为止，这有效。下一步是获取一个 RDOSession 对象并实例化它。如果它有效，这将是我的想法：

session = Redemption.RDOSession()

但是，这会产生错误：TypeError: Cannot create instances of RDOSession

所以我的问题是（或曾经是）：如何实例化像 RDOSession 这样的对象？

但是，我只是回答了我自己的问题以试图解释它。我将继续回答，因为尽管这样做似乎很愚蠢，但也许对其他人有用。

当我输入“session = Redemption.RDOSession()”行时，调用提示在其下方出现“RDOSession”以及“RDOSessionClass”。我不知道后者是如何生成的，但它听起来像是一个可实例化的（如果这是一个词）对象。

>>> session = Redemption.RDOSessionClass()

>>>

瞧瞧。调用 Logon 方法就像在新会话对象上的冠军一样。

感谢堆栈溢出！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-20T09:53:57.740

你需要使用：

```
session = Redemption.RDOSessionClass() 
```

# encryption - Office Open XML (OOXML) 规范：加密

> ID：858232
> 
> 赞同：8
> 
> 时间：2009-05-13T14:20:40.897
> 
> 标签：encryption, passwords, ms-office, openxml

我试图了解如何捆绑加密（“密码保护”）Office 2007 文档（特别是 Excel 文档）。我正在试验一个已知的、受密码保护的电子表格。

当我解压缩 XLSX 文件时，我遇到三个条目：

*   [6]数据空间（目录）
*   加密信息（文件）
*   加密包（文件）

EncryptedPackage 文件是如何加密的（哪个密码、哪个密钥派生函数等...）？

我曾尝试参考[文档](http://www.ecma-international.org/publications/standards/Ecma-376.htm)，但没有取得多大成功。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-13T14:27:29.637

文件加密不是 OpenXML ECMA/ISO 规范的一部分。最重要的是，它是特定于供应商的标准。规格请查看

> [**[MS-OFFCRYPTO]：Office 文档加密结构规范**](http://msdn.microsoft.com/en-us/library/cc313071.aspx)

加密的 OpenXML 文档不存储为 OPC zip 包，而是作为复合 OLE 文档中的加密 OPC 包存储。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-10-01T19:15:33.443

我创建了一个[OoXmlCrypto 流](http://code.google.com/p/ooxmlcrypto/)包装器，它连接了几个开源的点点滴滴，以便轻松访问 Office 2007 加密文件。

这个[答案](https://stackoverflow.com/questions/1502781/read-write-excel-2007-password-protected-documents/1505836#1505836)可能会有所帮助。

结果 [6]DataSpaces 被忽略了，但使用了其他两个部分。加密的 XLSX 文件并没有真正压缩，它是一个 OLE 复合容器。如果您取出零件并使用 7zip 压缩它们，Excel 不会打开它。

# java - EJB 3：从应用程序客户端访问有状态会话 bean

> ID：858233
> 
> 赞同：5
> 
> 时间：2009-05-13T14:20:44.000
> 
> 标签：java, ejb-3.0, stateful-session-bean, application-client

我在从应用程序客户端访问有状态会话 bean (SFSB) 时遇到了一些问题。我正在使用 JBoss 5.0.1.GA。应用程序客户端和 EJB 都打包在一个 EAR 中进行部署，我还有其他应用程序客户端可以正常工作。到目前为止，我只使用了无状态会话 bean (SLSB)，但据我了解，SLSB 和 SFSB 之间的差异不应该影响从应用程序客户端访问它们的方式。

类/接口的结构：

```
@Local public interface A {...}

@Stateless public class ABean implements A {...}

@Remote public interface B {...}

@Stateful public class BBean implements B {
    @EJB private A anInstanceOfA;

    @PostConstruct private void init() {
        this.anInstanceOfA.someMethod();
    }
} 
```

应用程序客户端通过“appclient-launcher”运行，如[“如何在 JBoss 5 中使用应用程序客户端”](http://www.jboss.org/community/wiki/HowtouseanapplicationclientinJBoss-5)中所述。在执行 init() 期间调用（本地）ABean 上的 someMethod() 之前，查找“BBean”工作正常。在该调用期间，容器抛出 InvalidStateException("Local call: security context is null") （作为根本原因）。当我将有状态 bean 更改为无状态 bean 时，一切正常（当然，除了没有保留状态）。有趣的是，我可以很好地使用来自 Web 应用程序（在 JSF 托管 bean 中）的完全相同的 SFSB。

难道我做错了什么？我应该如何从应用程序客户端使用 SFSB？

到目前为止，我还没有发现任何关于这个特定问题的有用信息。该异常在[[#JBAS-4317] Security Context over the invocation](https://jira.jboss.org/jira/browse/JBAS-4317)中的类似上下文中提到，但考虑到它被标记为已完成并在 JBoss 5.0.0.Beta3 中已修复，这似乎不是同一个问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-14T09:47:41.763

即使我仍然想知道为什么我的原始设置它非常适用于无状态会话 bean，但不适用于有状态会话 bean，这是我找到的解决方案：

也打包在 EAR 中的 Web 应用程序通过 JAAS 进行身份验证。为此，我在 JBoss login-config.xml 中配置了一个安全域，如下所示：

```
<application-policy name="My-SD">
    <authentication>
        <login-module code="org.jboss.security.auth.spi.DatabaseServerLoginModule" flag="required">
            <module-option name="unauthenticatedIdentity">guest</module-option>
            <module-option name="dsJndiName">java:/myDS</module-option>
            <module-option name="principalsQuery">SELECT PASSWORD FROM LOGIN WHERE LOGIN = ? AND STATUS > 0</module-option>
            <module-option name="rolesQuery">SELECT ROLE, 'Roles' FROM USER_ROLE WHERE LOGIN = ?</module-option>
        </login-module>
    </authentication>
</application-policy> 
```

我已经在 web 应用程序的 jboss-web.xml 以及 EJB 项目的 jboss.xml 中使用了这个安全域，尽管我实际上只在 web 应用程序中使用它（无需身份验证即可访问 EJB）。

为了解决访问 SFSB 的问题，我只需要从 EJB 项目的 jboss.xml 中删除我的安全域。这使得 JBoss 使用默认的安全域，这似乎做了正确的事情，我的应用程序客户端终于可以访问和使用 SFSB。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-07-19T13:28:35.193

原因可以在[EJB 3.0 Core Specification](http://jcp.org/aboutJava/communityprocess/final/jsr220/index.html)的第 12.4 节中找到。那里说

> 生命周期回调拦截器方法在未指定的事务和安全上下文中调用。

hth，
-马丁

# c# - 从数据读取器中删除列

> ID：858236
> 
> 赞同：2
> 
> 时间：2009-05-13T14:20:55.280
> 
> 标签：c#, asp.net, sqldatareader

我有一个小的 C# 函数，它接受任何通用 SQLDataReader 并将其转换为 csv 文件。但是，我现在需要忽略传递给它的数据读取器中的 1 列。

**如何从 SQLDataReader 中删除 1 列？**

查询中需要此列，主要用于排序，但在同一页面加载的另一个区域中使用，但我不希望它显示在我将生成的 csv 文件中。

编辑：我认为我有点误导，我希望删除的列在其他情况下使用，而不是这个，所以只需从查询中删除即可，但会导致我必须运行两次查询，而不是只有一次，它是一个更大的查询。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T14:39:12.083

传递要隐藏的整数数组。整数对应于您要关闭的列的索引。您可以创建一个重载方法，这样您就不必更改程序中调用它并打印每一列的代码。

（我在这里假设很多，但重载是关键）

```
public void MakeMyCSV(string MyFileName, SQLDataReader DataToOutput) 
{
    MakeMyCSV(MyFileName, DataToOutput, null);
}

public void MakeMyCSV(string MyFileName, SQLDataReader DataToOutput, int[] ExcludedColumns) //if this is your current method signature...
{
    //iterate through each record
    //    iterate through each column
    //        if ExcludedColumns is not null then see if this column is in it
    //            if it is not in it, output it
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T14:23:35.260

您不需要在结果集中包含在 SQL 查询的 order by 子句中使用的列。你能把它排除在选择语句之外吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T14:24:12.873

您不会从数据读取器中删除列。如果不需要数据，则不要读取该列。如果您需要列数据进行排序，请阅读它。编写 CSV 文件时，简单地省略数据。写入 CSV 文件与使用 SqlDataReader 读取无关。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T14:32:08.333

添加一个参数，包括要忽略的列列表。

我有时有像`ignore_columns`,`include_columns`等参数。如果`ignore_columns`提供了一个参数并且列表中有一个列，它将被忽略。如果`include_columns`提供了参数并且列不在列表中，则将其忽略。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-13T14:32:11.877

你不能！您将需要修改生成 CSV 的代码以仅处理所需的列并忽略其他列。

# nhibernate - NHibernate 和非规范化表

> ID：858244
> 
> 赞同：2
> 
> 时间：2009-05-13T14:21:40.160
> 
> 标签：nhibernate, fluent-nhibernate, nhibernate-mapping

在具有 Employee 和 Branch 实体的网站上工作，使用数据库表“Employees”，其中还包含分支 ID 和分支名称。我无法更改客户的数据库，所以我需要从同一个表中映射员工和分支机构。

我想我需要在映射 XML 中使用某种不同的子句来从员工表中获取不同的列表或一组分支？

有没有办法可以将两个类映射到同一张桌子上？（可以用 Fluent NHibernate 完成吗？）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T15:04:58.110

Stefan 是正确的，使用组件。在 FluentNHibernate 中，它看起来像：

```
class Branch
{
    string Name { get; set; }
    DateTime DateOpened { get; set; }
}

class Employee
{
    int Id { get; set; }
    string Name { get; set; }
    Branch Branch { get; set; }
}

class EmployeeMap : ClassMap<Employee>
{
    public EmployeeMap()
    {
        Id(x => x.Id);
        Map(x => x.Name);
        Component<Branch>(x => x.Branch, c => {
            c.Map(x => x.Name);
            c.Map(x => x.DateOpened);
        });
    }
} 
```

`Component<Branch>`可以缩短为 just因为编译器`Component`会自动找出类型。另外，我喜欢`AsComponent`为我的组件在类上提供一个函数，这样我就不必在映射组件的任何地方重复自己：

```
public static class BranchMap
{
    public Action<ComponentPart<Branch>> AsComponent()
    {
        return c =>
        {
            c.Map(x => x.Name);
            c.Map(x => x.DateOpened);
        };
    }
} 
```

这也使得在实体可能具有多个具有不同命名方案的组件实例的情况下添加前缀/后缀函数变得容易。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T14:55:09.700

使用组件。我不知道 FluentNhibernate，但在 xml 中，它看起来像这样：

```
<class name="Employee">
  ...

  <component name="MyBranch">
    <!-- Branche properties are here: -->
    <property name="BrancheName"/>
    <property name="..."/>
  </component>
</class>

class Employee
{
  Branch MyBranch { get; private set; }
}

class Branch
{
  string BrancheName { get; private set; }
} 
```

这实际上非常简单。您还出于性能原因这样做，因为当员工始终有分支时，您不需要连接表。

注意：如果所有列都为空，则 myBranch 将为空。

# sql-server - 具有小数据的 varchar(max) 列的开销

> ID：858245
> 
> 赞同：14
> 
> 时间：2009-05-13T14:21:48.383
> 
> 标签：sql-server, ssis

作为来自外部源的大量数据加载的一部分，暂存表是使用 varchar(max) 列定义的。这个想法是每列将能够保存它在源 CSV 文件中找到的任何内容，并且稍后我们将验证数据（对于类型、大小、精度等）。

但我担心 varchar(max) 列对于少于 200 个字符的列有很多开销。设计这个的人向我保证这是 ETL 的最佳实践，但我想我会在社区中验证这个断言。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-05-13T14:35:03.307

如果空间允许，VARCHAR(MAX) 列值将存储在表行中。因此，如果您有一个 VARCHAR(MAX) 字段并且它是 200、300 字节，那么它很可能会与您的其余数据内联存储。这里没有问题或额外的开销。

只有当单行的全部数据不再适合单个 SQL Server 页面 (8K) 时，SQL Server 才会将 VARCHAR(MAX) 数据移动到溢出页面中。

总而言之，我认为您可以两全其美 - 尽可能内联存储，必要时溢出存储。

马克

PS：正如 Mitch 指出的那样，可以关闭此默认行为 - 但是，我没有看到任何令人信服的理由这样做......

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-13T14:43:24.400

varchar(n) 和 varchar(max) 的存储开销相同 存储大小是输入数据的实际长度 + 2 个字节

[MSDN 参考](http://msdn.microsoft.com/en-us/library/ms176089.aspx)

查看这些类似的 SO 问题：

[https://stackoverflow.com/questions/166371/varcharmax-versus-varcharn-in-ms-sql-server](https://stackoverflow.com/questions/166371/varcharmax-versus-varcharn-in-ms-sql-server) [总是使用 nvarchar(MAX) 有什么缺点吗？](https://stackoverflow.com/questions/148398/are-there-any-disadvantages-to-always-using-nvarcharmax)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-13T14:31:39.413

据我所知，您可能正在考虑的开销（以与在 sql server 中存储 TEXT 或 BINARY 值相同的方式将数据存储在行外）仅适用于数据大小超过 8000 字节的情况。因此，将其与较小的列用于 ETL 过程应该没有问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-29T07:48:36.723

如果您在 MSSQL2005 中使用 varchar(max) 或 varbinary(max)，SSIS 会为记录中的每一列创建一个临时文件，这可能会降低您的性能并成为一个大问题。MS声称他们在MSSQL2008中解决了这个问题。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-13T14:34:35.133

好吧，我想说不应该有那么大的开销，因为我认为 sql 不会自动为 nvarchar 分配分配的数据量，而是只分配插入所需的数据，但我不没有什么可以证明或支持这个想法。

# java - Java 内存解释 (SUN JVM)

> ID：858250
> 
> 赞同：14
> 
> 时间：2009-05-13T14:22:49.253
> 
> 标签：java, memory, memory-management, jvm

我试图找到对 sun java vm 的内存段的解释，这也是**管理员可以理解的**。它应该解释什么是堆/非堆内存以及不同内存池的意义。

如果它以某种方式与 jconsole 视图相关，那将是一个奖励。

有没有这样解释的网站？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-05-13T15:30:15.727

这是我记下的资源列表。其中一些解释了堆/垃圾收集是如何工作的，还有一些详细介绍了如何配置所有内容。

IBM

*   [垃圾收集是如何工作的？](http://publib.boulder.ibm.com/infocenter/javasdk/v1r4m2/index.jsp?topic=%2Fcom.ibm.java.doc.diagnostics.142%2Fhtml%2Fhowdoesgcwork.html)
*   [垃圾回收详解](http://publib.boulder.ibm.com/infocenter/javasdk/v5r0/topic/com.ibm.java.doc.diagnostics.50/diag/understanding/mm_gc.html)
*   [分代和并发垃圾回收](http://publib.boulder.ibm.com/infocenter/javasdk/v5r0/index.jsp?topic=%2Fcom.ibm.java.doc.diagnostics.50%2Fdiag%2Funderstanding%2Fmm_gc_generational.html)

太阳

*   [Turbo-charging Java HotSpot Virtual Machine, v1.4.x 以提高应用服务器的性能和可扩展性](http://www.oracle.com/technetwork/articles/javase/turbo-141254.html)- （低暂停收集器的讨论）
*   [Java HotSpot VM 的性能文档](http://www.oracle.com/technetwork/java/javase/tech/index-jsp-136373.html)
*   [通过使用 JDK 1.4.1 减少垃圾收集时间和调整内存大小来提高 Java 应用程序的性能和可伸缩性](http://www.oracle.com/technetwork/systems/index-156457.html)
*   [关于 Java HotSpot VM 的常见问题](http://www.oracle.com/technetwork/java/hotspotfaq-138619.html)
*   [Java HotSpot 虚拟机选项](http://www.oracle.com/technetwork/java/javase/tech/vmoptions-jsp-140102.html)

其他

*   [Java 专家通讯](http://javaspecialists.co.za/archive/archive.jsp)
    *   [性能文章](http://javaspecialists.co.za/archive/newsletters.jsp?category=Performance&locale=en_US)
    *   [确定 Java 中的内存使用情况](http://javaspecialists.co.za/archive/Issue029.html)
*   [Java 性能调优网站](http://www.javaperformancetuning.com/)
*   [Java World - 通过分代垃圾收集提升性能](http://www.javaworld.com/javaworld/jw-01-2002/jw-0111-hotspotgc.html)
*   [DZone - 如何驯服 Java GC 暂停](http://java.dzone.com/articles/how-tame-java-gc-pauses)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-13T14:28:14.130

[Sun 的这篇关于使用 5.0 Java 虚拟机调整垃圾收集的文章](http://java.sun.com/docs/hotspot/gc5.0/gc_tuning_5.html)应该对您正在寻找的所有内容都有很好的定义和解释；我不相信在 5.0 和 6.0 之间这个主题发生了很大的变化

还有一份关于[Java HotSpot 虚拟机中的内存管理的](http://java.sun.com/j2se/reference/whitepapers/memorymanagement_whitepaper.pdf)白皮书。

更多 Sun[文档](http://java.sun.com/javase/reference/index.jsp)、[技术文章](http://java.sun.com/javase/reference/techart.jsp)和[白皮书](http://java.sun.com/javase/whitepapers.jsp)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-13T14:26:36.223

最近的一个：[http ://www.ibm.com/developerworks/java/library/j-nativememory-linux/](http://www.ibm.com/developerworks/java/library/j-nativememory-linux/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-03-05T19:14:55.920

此外，请参阅这些用于 JVM GC 的 JavaOne 会话。（包括视频播放）

*   [垃圾回收友好编程](http://developers.sun.com/learning/javaoneonline/j1sessn.jsp?sessn=TS-2906&yr=2007&track=5)
*   [Java HotSpot 虚拟机中的垃圾回收调优](http://developers.sun.com/learning/javaoneonline/j1sessn.jsp?sessn=TS-4887&yr=2009&track=javase)
*   [垃圾优先垃圾收集器](http://developers.sun.com/learning/javaoneonline/j1sessn.jsp?sessn=TS-5419&yr=2008&track=javase)<== 强烈推荐
*   [并发垃圾收集系统中的性能注意事项](http://developers.sun.com/learning/javaoneonline/j1sessn.jsp?sessn=TS-6500&yr=2008&track=javase)

更新：

Oracle 将 JavaOne 内容更改为付费内容。请参阅[这篇文章](http://www.infoq.com/articles/G1-One-Garbage-Collector-To-Rule-Them-All)以了解 G1 垃圾收集器。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-13T15:35:09.153

我发现[Sun 的内存管理白皮书](http://java.sun.com/j2se/reference/whitepapers/memorymanagement_whitepaper.pdf "Sun 的内存管理白皮书")提供了很好的概述。

最后一部分提供了有用的链接，可以更深入地研究特别感兴趣的领域。

# c++ - MS strncpy_s 的替代品

> ID：858252
> 
> 赞同：6
> 
> 时间：2009-05-13T14:22:52.890
> 
> 标签：c++, visual-c++

Microsoft 安全增强功能（例如`strncpy_s`或）有哪些替代方案`_itoa_s`？尽管在 MS 环境中开发，但目标是编写可以轻松移植到其他平台的代码。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-13T17:41:29.897

**如果你真的想用 C 编程：**

使用普通的旧标准`strncpy`。

**如果您使用 C++ 编程：**

使用普通的旧标准字符串类`std::string`。

（提示：您可能想要后者。C 字符串只是等待发生的错误，即使您使用“安全”`*_s`函数。C++ 添加字符串类是有原因的）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T14:27:30.247

```
std::string s(Cstring, n); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-13T15:07:59.180

尝试[strlcpy](http://www.gratisoft.us/todd/papers/strlcpy.html)。虽然不是标准 C，但它存在于许多平台上，您可以下载实现，因为源代码是免费提供的。见[http://www.gratisoft.us/todd/papers/strlcpy.html](http://www.gratisoft.us/todd/papers/strlcpy.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-13T14:25:08.767

只需使用 strncpy 并禁用 VC++ 中的警告。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-13T14:27:52.100

据我了解， strncpy_s 没有复杂的逻辑：只需要最小的字符串长度、源和目标数据大小，并将生成的字符数量复制到目标。如果你这么需要它，为什么不自己实现呢？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-13T14:33:56.553

狂暴是对的，背后没有复杂的逻辑。

我现在只使用微软的版本，如果你决定以后移植到另一个操作系统，那么你自己为目标平台实现它，并使用预处理器命令来指定你在非 Windows 平台上的实现。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-13T15:20:15.590

您可能对[Apache Portable Runtime](http://apr.apache.org/)项目感兴趣：

> Apache Portable Runtime (APR) 项目的使命是创建和维护软件库，为特定平台的底层实现提供可预测且一致的接口。

autoconf 也可以处理其中一些特定于平台的差异（通过设置#defines 等），尽管我在 Windows 下使用它的经验还有一些不足之处。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-02-04T05:44:53.323

我认为@codeLizard 是在询问如何编写兼容代码来处理微软为了支持其安全版本而弃用的*所有*函数，而不仅仅是字符串函数。

基于微软安全功能的功能包含在 C11 标准的附件 K 中，但该附件在 MSVS 之外并未得到广泛支持。

*您可以在包含文件中编写宏和内联函数，以在一些*传统版本和安全版本之间来回映射。我这里贴[了一组转换宏](https://stackoverflow.com/questions/6234682/need-a-define-for-visual-studio-versions-that-include-secure-string-functions/35191283#35191283)，如果要复制，从点赞页面获取；比下面更完整，更好的评论。

但是，该方法不适用于将传统函数映射到采用大小参数的安全版本，除非传统函数中也存在大小参数。此外，安全函数的异常行为不同，有时返回值也不同。我目前的转化没有考虑到这一点。当我有时间时，我会尝试在我能做到的地方改进它们。同时，我将把它作为练习留给读者。

如果可以，我建议在新代码中使用安全函数，如果需要可移植到非 MS 编译器，请使用宏加函数解决方案，并且还可以作为重用旧代码的桥梁，直到您有时间使用安全函数更新它。

这是上述链接宏/内联函数方法的缩写版本：

```
#pragma once
#if !defined(FCN_S_MACROS_H)
   #define   FCN_S_MACROS_H
   #include <cstdio>
   #include <string> // Need this for _stricmp
   using namespace std;

   #if (defined(_MSC_VER) && (_MSC_VER >= 1400) ) // _MSC_VER==MSVC 2005 

      // The function plus macro strategy could be used to maintain
      // consistent exception behaviors and return values. 
      inline extern
      FILE*   fcnSMacro_fopen_s(char *fname, char *mode)
      {  FILE *fptr;
         fopen_s(&fptr, fname, mode);
         return fptr;
      }
      #define fopen(fname, mode)               fcnSMacro_fopen_s((fname), mode))

      #define fprintf(fptr, ...)               fprintf_s((fptr), __VA_ARGS__)
      #define fscanf                           fscanf_s
      #define strncpy(dest, source, count)     strcpy_s((dest), (count), (source))
      // Can't map sprinf to sprintf_s (size argument unavailable). 
      //    #define sprintf                    ???

      ...
    #else
      #define fopen_s(fp, fmt, mode)          *(fp)=fopen( (fmt), (mode))
      #define fprintf_s                        fprintf
      #define fscanf_s                         fscanf
      #define strcpy_s(dest, count, source)    strncpy( (dest), (source), (count) )
      ...
    #endif //_MSC_VER
#endif // FCN_S_MACROS_H 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-13T14:46:10.043

您可以为没有此功能的平台提供自己的实现。或者使用宏将参数减一并映射到标准字符串函数。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-01-15T18:34:36.500

是的，试试[https://rurban.github.io/safeclib/](https://rurban.github.io/safeclib/)。

这是在所有 libc 之上的 C11 Annex K 的平台独立实现。它主要与 Windows sec_api 兼容。Windows 在某些功能上与规范略有不同。

`strncpy_s`是 sec_api 中最棘手的 API 之一。Windows 不会检测到两个长度的溢出，而不是两个字符串的重叠。当第 4 个参数 count = 0 时该怎么做也是有问题的。规范[http://en.cppreference.com/w/c/string/byte/strncpy](http://en.cppreference.com/w/c/string/byte/strncpy)说*返回值为零意味着...... s1 中的结果为空终止*，但在 Windows 上这是错误的。它只是过早地中止。参见例如 wine 实现：[https ://github.com/mirror/reactos/blob/master/reactos/lib/sdk/crt/wine/heap.c#L577](https://github.com/mirror/reactos/blob/master/reactos/lib/sdk/crt/wine/heap.c#L577)

对于`_s`安全后缀，应该假设当发生运行时错误时，错误地复制到目标缓冲区中的字节会被清除，以免被窥探。在带有 sec_api 的 Windows 上并非如此。他们只是将第一个字节设置为 0。

[https://github.com/rurban/safeclib/releases](https://github.com/rurban/safeclib/releases)

# cocoa - 复制保护（mac 应用程序）：最具成本效益的解决方案？

> ID：858262
> 
> 赞同：0
> 
> 时间：2009-05-13T14:24:04.260
> 
> 标签：cocoa, macos, copy-protection

... 刚刚阅读[http://www.cocoadev.com/index.pl?CocoaInsecurity](http://www.cocoadev.com/index.pl?CocoaInsecurity) ...

我很想知道您在保护 macintosh 应用程序的复制保护解决方案方面的经验。
是否值得*任何*时间投资？或者 是否值得在商业解决方案上投资？（如果是这样，哪个？）

请在您的回答中考虑：

1) 解决方案对（合法​​）最终用户来说有多方便（或不方便）？

2）解决方案对软件的实时性能有影响吗（CPU命中？）

3) 解决方案是否会引发与版权保护相关的支持事件？

thx->adv,

|K<

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T14:33:02.747

您可以检查这个相关问题：[您使用什么复制保护技术？](https://stackoverflow.com/questions/515020/what-copy-protection-technique-do-you-use)

您还可以查看这篇博客文章：[我的产品注册解决方案](http://mere-mortal-software.com/blog/details.php?d=2008-03-10)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-03-26T11:20:11.470

**每种**方法对合法的最终用户来说都是不方便的，而且**MOST**无论如何都会在某个时候被黑客入侵（假设任何人都对该应用程序感兴趣）。

鉴于**Mac App Store**的日益流行以及用户迅速习惯它，我们的经验是，他们同时对每个复制保护方案所涉及的麻烦也不太了解。

[Matt 的博客文章](http://mattgemmell.com/2012/08/24/releasing-outside-the-app-store/)有一个关于通过 MAS 进行销售和提出您自己的复制保护方案的主题的优缺点列表。

# sql - MySQL双重查询情况

> ID：858264
> 
> 赞同：0
> 
> 时间：2009-05-13T14:24:24.137
> 
> 标签：sql, mysql

还有另一种方法可以执行此查询吗？

```
 $query = "SELECT * FROM produto, pt WHERE
        produto.refPT = pt.ref AND
        produto.refPT IN (SELECT idProduto FROM amb_prod WHERE idAmbiente='1');";
    $result_set = mysql_query($query); 
```

问题是我的本地主机有 MySQL 版本 5.1.30-community，但我的在线服务器有 5.0.67-community MySQL 版本。

而且我认为这是我仅在尝试在在线服务器上运行时才收到此错误的原因：

```
mysql_fetch_array(): supplied argument is not a valid MySQL result resource 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T14:40:07.010

当您创建一个漂亮的查询视图时，它会使生活更轻松，例如：

```
$query = "SELECT *
          FROM produto, pt, amb_prod 
          WHERE produto.refPT = pt.ref
          AND produto.refPT = amb_prod.idProduto 
          WHERE amb_prod.idAmbiente='1';";
$result_set = mysql_query($query); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T15:45:29.010

去掉最后的分号，看看是否有帮助。

在某些桥接实现（将您的语言连接到 MySQL 服务器的东西）上，您的查询字符串实际上是两个查询：

```
SELECT * 
FROM produto, pt 
WHERE
 produto.refPT = pt.ref AND
 produto.refPT IN (SELECT idProduto 
                   FROM amb_prod 
                   WHERE idAmbiente='1') 
```

和...

```
[Blank] 
```

一些桥可能会混淆要返回哪个结果集（SQL 或空白查询的结果）以及空白查询是否可接受。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T14:30:51.503

好吧，在你的测试系统上安装一个匹配版本的 MySQL 会很有意义，这样你就可以更容易地调试错误。

你也可以试试这样的...

```
$query = "SELECT * FROM produto, pt, amb_prod WHERE
    produto.refPT = pt.ref AND
    produto.refPT = amb_prod.idProduto WHERE amb_prod.idAmbiente='1');";
$result_set = mysql_query($query); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T14:36:20.667

至少为了简化您的查询，您可以使用：

```
"Select * from produto,pt,amb_prod WHERE
       produto.refPT = pt.ref AND
       produto.refPT=amb_prod.idproduto AND
       amb_prod.idAmbiente='1';" 
```

虽然我建议选择字段而不是“*”。我还想知道你为什么引用'1'，那不是数字字段吗？

# java - 以不同方式着色的多个字符串到 JTable 的同一单元格中

> ID：858267
> 
> 赞同：3
> 
> 时间：2009-05-13T14:25:10.763
> 
> 标签：java, swing, colors, jtable

假设您有一个`JTable`并且要为每个单元格显示三个不同颜色的字符串，例如 value1（红色）、value2（蓝色）、value3（绿色）。

我覆盖了`getTableCellRendererComponent`of `DefaultTableCellRenderer`but`setForeground(Color)`方法为单元格中显示的所有字符串提供了独特的颜色。

```
@Override
public Component getTableCellRendererComponent(JTable table, Object value,
        boolean isSelected, boolean hasFocus, int row, int column) {
    String s = table.getModel().getValueAt(row,column).toString();

    StringTokenizer st = new StringTokenizer(s," ");
    int nToken=st.countTokens();

    value1=st.nextToken();
    value2=st.nextToken();
    value3=st.nextToken();
    // so now all the values are blue...
    setForeground(Color.blue);

    return super.getTableCellRendererComponent(table, value, isSelected,
            hasFocus, row, column);

} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T17:17:40.060

JIDE 提供 StyledLabel 作为其开源公共层的一部分，这正是您想要的，而且比您自己实现任何东西要容易 10 倍。

[https://jide-oss.dev.java.net/](https://jide-oss.dev.java.net/ "你可以在这里下载")

![替代文字](https://www.jidesoft.com/images/styledlabel.png "样式标签示例")

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T14:51:06.510

单元格表的默认渲染器是 JLabel。该组件支持 HTML 标签。您可以拥有的最简单的解决方案是使用 HTML 以不同的颜色呈现字符串。因此，您可以构建一个字符串，例如：

```
 <html><font color="blue">A String</font><font color="red">Another String</font></html> 
```

并将其设置为单元格，您不必担心渲染器。

[大多数 Swing 组件都允许您使用 HTML，这不仅限于表格。](http://java.sun.com/docs/books/tutorial/uiswing/components/html.html)

另一种可能性是您创建一个从 JComponent 扩展的类，并编写paintComponent() 程序，以便它以不同的颜色绘制这三个字符串。然后您可以将此组件设置为渲染器。但这要复杂得多。因为渲染器像“印章”一样工作，所以它会在绘制单元格时印上正确的颜色。例如，如果您需要在单元格上绘制极其复杂和自定义的图形，这将非常有用。

如果您没有大量单元格，我会坚持使用 HTML。

# wpf - 在 MVVM 中，ViewModel 响应 View 中的用户操作的最佳方式是什么？

> ID：858268
> 
> 赞同：22
> 
> 时间：2009-05-13T14:25:14.947
> 
> 标签：wpf, mvvm

我明白在 MVVM 中：

*   View 知道 ViewModel
*   ViewModel 知道模型
*   但它不能向上工作，所以模型对 ViewModel 一无所知
*   而 ViewModel 对 View 一无所知

那么**ViewModel 如何响应用户在 View 上执行的操作**，例如在 TextBox 中输入内容或移动滑块等。

1.  我知道这是通过**RoutedEvents**完成的，但我发现的几乎所有 RoutedEvent 示例都在视图中使用 CodeBehind，而这正是 MVVM 中没有的。

2.  这样就**剩下 RoutedCommands**了，我在 MVVM 中找到了更多示例，但例如移动滑块在这个意义上真的不是一个*命令*，它是一个事件，所以我想知道这是否真的应该使用。

3.  然后我[阅读了](https://stackoverflow.com/questions/852441/fat-models-skinny-viewmodels-and-dumb-views-the-best-mvvm-approach/854824#854824)诸如“*在 MVVM**中尽可能少地使用 RoutedEvents**，并且**根本不使用 RoutedCommands** ”之类的建议。*好的。

4.  因此，例如，在WPF 团队本身的[WPF Model-View-ViewModel Toolkit 0.1项目中，您有一个“](https://stackoverflow.com/questions/852441/fat-models-skinny-viewmodels-and-dumb-views-the-best-mvvm-approach/854824#854824) **DelegateCommand** ”，这看起来也是一种有趣的方式。

5.  然后有些人也在使用“ **RelayCommand** ”。

对于开发应用程序如此核心的事情来说，这是很多选择和困惑。

**什么是在 MVVM 中简单地做我们在过去 10 年中使用 Code Behind 所做的最好方法**：

*   创建按钮
*   双击按钮
*   编写处理代码

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-13T14:43:54.463

需要明确的是，当人们提到**DelegateCommand**和**RelayCommand**时，他们实际上是在谈论同一件事：允许您传入委托的 ICommand 的实现。您可以互换使用它们。

就我而言，让您的视图 (XAML) 绑定到 ViewModel 中的 DelegateCommands 是实现 MVVM 的最佳方式。

我尽可能远离 RoutedEvents 和代码隐藏。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-13T14:31:02.113

对于按钮和其他触发器，我使用 WPF 提供的 ICommand 接口，其方式与您链接到的 DelegateCommand 类似。[（实际上我使用此处](http://msdn.microsoft.com/en-us/magazine/dd419663.aspx#id0090030)定义的中继命令）

当您更改值（移动滑块、在文本框中键入）时，在设置 ViewModel 中的属性时使用绑定和处理行为。

一般来说，我发现几乎没有理由在 MVVM 应用程序中使用 RoutedEvents，但是当您无法通过新的 WPF 特定方法实现您想要的目标时，它们是一个很好的、熟悉的舒适毯子。

# git - 在 git 中拒绝大文件

> ID：858278
> 
> 赞同：7
> 
> 时间：2009-05-13T14:27:18.560
> 
> 标签：git, large-files

我们最近开始使用 git，当有人提交了一个大文件（~1.5GB 文件）时遇到了一个令人讨厌的问题，这导致 git 在各种 32 位操作系统上崩溃。这似乎是一个已知的错误（git mmaps 文件到内存中，如果它无法获得足够的连续空间，这将不起作用），不会很快得到修复。

简单的（对我们来说）解决方案是让 git 拒绝任何大于 100MB 左右的提交，但我想不出办法。

编辑：问题来自意外提交的大文件，在这种情况下是程序输出的大量转储。目的是避免意外提交，因为如果开发人员确实不小心提交了一个大文件，然后试图将其从存储库中取回是一个下午，没有人可以做任何工作，并且必须修复他们所有的本地分支有。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T16:51:35.377

问题究竟是什么时候发生的？他们最初提交文件的时间还是被推送到其他地方的时间？如果您有一个每个人都推送到的临时存储库，您可以实现一个更新挂钩来扫描更改的大文件的 refs，以及其他权限等检查。

*非常*粗略和现成的例子：

```
git --no-pager log --pretty=oneline --name-status $2..$3 -- | \
  perl -MGit -lne 'if (/^[0-9a-f]{40}/) { ($rev, $message) = split(/\s+/, $_, 2) }
     else { ($action, $file) = split(/\s+/, $_, 2); next unless $action eq "A"; 
       $filesize = Git::command_oneline("cat-file", "-s", "$rev:$file");
       print "$rev added $file ($filesize bytes)"; die "$file too big" if ($filesize > 1024*1024*1024) }'; 
```

（只是表明，一切都可以用 Perl 单线完成，尽管它可能需要多行；））

以调用 $GIT_DIR/hooks/update 的方式调用（参数是 ref-name、old-rev、new-rev；例如“refs/heads/master master~2 master”）这将显示添加的文件，如果一个是太大了。

请注意，我会说，如果您要对此类事情进行监管，则需要一个集中点来执行此操作。如果您相信您的团队只是相互交换更改，那么您应该相信他们知道添加巨大的二进制文件是一件坏事。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T20:45:10.613

您可以分发防止提交的预提交挂钩。在中央存储库上，您可以有一个 pre-receive 钩子，通过分析接收到的数据来拒绝大 blob 并防止它被引用。数据将被接收，但由于您拒绝对 refs 的更新，所有收到的新对象都将被取消引用，并且可以被 git gc 拾取和删除。

不过我没有给你的剧本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T14:55:13.943

如果您可以控制提交者的工具链，则可以直接修改 git commit 以便在“真实”提交之前对文件大小执行合理性测试。由于内核中的这种更改会在每次提交时给所有 git 用户带来负担，并且“驱逐任何将提交 1.5GB 更改的人”的替代策略具有吸引人的简单性，我怀疑这样的测试永远不会在内核中被接受。我建议您权衡维护本地 git 分支的负担 - nannygit - 与在过于雄心勃勃的提交后修复崩溃的 git 的负担。

我必须承认我很好奇 1.5 GB 的提交是如何产生的。是否涉及视频文件？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-06-27T02:49:04.407

```
Here is my solution. I must admit it doesn't look like others I have seen, but to me it makes the most sense. It only checks the inbound commit. It does detect when a new file is too large, or an existing file becomes too big. It is a pre-receive hook. Since tags are size 0, it does not check them.

    #!/usr/bin/env bash
#
# This script is run after receive-pack has accepted a pack and the
# repository has been updated.  It is passed arguments in through stdin
# in the form
#  <oldrev> <newrev> <refname>
# For example:
#  aa453216d1b3e49e7f6f98441fa56946ddcd6a20 68f7abf4e6f922807889f52bc043ecd31b79f814 refs/heads/master
#
# see contrib/hooks/ for an sample, or uncomment the next line (on debian)
#

set -e

let max=1024*1024
count=0
echo "Checking file sizes..."
while read oldrev newrev refname
do
#   echo $oldrev $newrev $refname
    # skip the size check for tag refs
    if [[ ${refname} =~ ^refs/tags/* ]]
    then
        continue
    fi

    if [[ ${newrev} =~ ^[0]+$ ]]
    then
        continue
    fi

    # find all refs we don't care about and exclude them from diff
    if [[ ! ${oldrev} =~ ^[0]+$ ]]
    then
        excludes=^${oldrev}
    else
        excludes=( $(git for-each-ref --format '^%(refname:short)' refs/heads/) )
    fi
#   echo "excludes " ${excludes}
    commits=$(git rev-list $newrev "${excludes[@]}")
    for commit in ${commits};
    do
#       echo "commit " ${commit}
        # get a list of the file changes in this commit
        rawdiff=$(git diff-tree --no-commit-id ${commit})
        while read oldmode newmode oldsha newsha code fname
        do
#           echo "reading " ${oldmode} ${newmode} ${oldsha} ${newsha} ${code} ${fname}
            # if diff-tree returns anything, new sha is not all 0's, and it is a file (blob)
            if [[ "${newsha}" != "" ]] && [[ ! ${newsha} =~ ^[0]+$ ]] && [[ $(git cat-file -t ${newsha}) == "blob" ]]
            then
                echo -n "${fname} "
                newsize=$(git cat-file -s ${newsha})
                if (( ${newsize} > ${max} ))
                then
                    echo " size ${newsize}B > ${max}B"
                    let "count+=1"
                else
                    echo "ok"
                fi
            fi
        done <<< "${rawdiff}"
    done
done

exit ${count} 
```

# sharepoint - 是否可以创建自定义 Web 级网站定义以用于发布门户网站集？

> ID：858279
> 
> 赞同：0
> 
> 时间：2009-05-13T14:27:28.747
> 
> 标签：sharepoint, site-definition

我最初基于“发布门户”网站定义创建了一个网站集。现在一段时间后，我想在 Web 范围级别为某些子网站创建自己的站点定义。问题是我的自定义站点定义未显示在选项列表中，仅显示“使用工作流发布站点”。

我很确定我已将其追踪到发布门户网站定义的网站定义文件（位于 C:\Program Files\Common Files\Microsoft Shared\web server extensions\12\TEMPLATE\SiteTemplates\BLANKINTERNET\XML \onet.xml)。它包含以下行：

```
<Property Key="AvailableWebTemplates" Value="*-BLANKINTERNET#2"/> 
```

BLANKINTERNET 模板定义的配置#2 恰好是带有工作流的发布站点。

是否有任何解决方案可以显示我的自定义 Web 级网站定义，而无需使用新网站定义重新创建网站集？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-12T18:32:39.140

在 Webtemp.*.xml 中确保模板配置标签的属性设置为

```
SubWebOnly="True" 
and 
RootWebOnly="False" 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T19:06:23.987

通过单击站点操作 -> 站点设置 -> 页面布局和站点模板（在外观类别下）检查您的站点模板是否可用于子站点。

如果您从那里选择“子网站只能使用以下网站模板”选项，请查看您的模板是否已列出并在可能的情况下使其可用。然后它应该出现在选择中。

如果这不起作用，请告诉我队友，因为我可以查找另一种解决方案。

干杯

# sockets - 选择系统调用的虚假就绪通知

> ID：858282
> 
> 赞同：10
> 
> 时间：2009-05-13T14:27:43.927
> 
> 标签：sockets, select, system-calls

在[http://linux.die.net/man/2/select](http://linux.die.net/man/2/select)的 BUGS 部分下，提到 select 系统调用有时可能会虚假地将 FD 设置为就绪，随后的 read 调用将返回 0。文本描述了一个这样的示例（错误的校验和）但我假设也会有其他原因（否则他们会解决这个问题）。

任何想法可能导致 Select 虚假返回 FD 就绪的其他原因。

这是否也适用于其他操作系统。我目前正在询问Linux。

上面链接的相关部分：

> 在 Linux 下，select() 可能会将套接字文件描述符报告为“准备好读取”，但随后会出现读取块。例如，当数据到达但检查时校验和错误并被丢弃时，可能会发生这种情况。可能存在文件描述符被虚假报告为就绪的其他情况。因此，在不应阻塞的套接字上使用 O_NONBLOCK 可能更安全。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-04-01T08:25:47.780

这不完全是一个答案，但是翻看epoll，这些问题似乎都为它解决了。

如果我可以在 netdev 中信任[此消息](http://www.spinics.net/lists/netdev/msg151793.html)，他们至少也尝试在 poll() 和 select() 中修复它（破坏其他东西）。

因此，在可预见的将来，这个错误似乎并不相关。

# java - 官方Java编译器

> ID：858286
> 
> 赞同：2
> 
> 时间：2009-05-13T14:28:07.483
> 
> 标签：java, compiler-construction

我用谷歌搜索，我检查了维基百科。他们都没有帮助我找到 Sun 的官方 java 编译器。

“官方”是指例如 Microsoft 的“C# Express”。我想要 Sun 的那种类型的编译器。

我的问题是：我从哪里得到它？

我很抱歉我的愚蠢问题，当我打开 java dot com 时我迷路了。

提前感谢您的回答。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-05-13T14:32:09.740

C# Express 是一个 IDE（集成开发环境），而不仅仅是一个编译器。

附带的 JDK`javac`相当于`csc`- 它们是编译器。

与 C# Express 最接近的可能是[Netbeans](http://www.netbeans.org/)，尽管还有其他可用于 Java 的 IDE，例如[Eclipse](http://eclipse.org)（免费）和[IntelliJ IDEA](http://www.jetbrains.com/idea/)（非免费）。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-05-13T14:29:56.920

官方的 java 编译器是 Sun 的 JDK 附带的 bin/javac。

[http://java.sun.com/javase/downloads/index.jsp](http://java.sun.com/javase/downloads/index.jsp)（请参阅 Java SE 开发工具包）。它包含有问题的编译器。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-13T14:30:44.530

我认为，根据您对 Visual C# Express 的提及，您正在寻找的是 IDE（集成开发环境），而不是编译器本身。访问[http://java.sun.com/javase/downloads/](http://java.sun.com/javase/downloads/)并获取 NetBeans 包。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-13T14:30:36.357

`javac`编译器作为[JDK 的一部分提供，您可以在此处](http://java.sun.com/javase/downloads/index.jsp)下载。

您可能需要*Java SE 开发工具包*（在撰写本文时已降为第四个）。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-13T14:35:31.310

“官方”编译器是随[Sun Microsystems 版本的 Java Development Kit](http://java.sun.com/javase/downloads/index.jsp)一起提供的。

由于完全指定了 Java 语言和平台，因此 Java 环境还有各种其他实现；例如，Oracle 和 IBM 都销售包含自己的 Java 运行时环境等的产品。

您在问题中提到了“C# Express”，我假设您指的是支持 C# 的 Visual Studio Express 版本；Visual Studio 是一个集成开发环境，它提供源代码编辑、重构和调试工具，并代表您与编译器和构建过程进行交互。如果您正在寻找适用于 Java 的 IDE，那么您可能想看看[NetBeans](http://netbeans.org)（由 Sun 赞助）或[Eclipse](http://eclipse.org)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-13T14:30:49.867

[http://java.sun.com](http://java.sun.com)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-13T14:32:52.047

在此处获取官方编译器[/SDK：http://java.sun.com/javase/downloads/index.jsp](http://java.sun.com/javase/downloads/index.jsp)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-05-13T14:35:38.237

我猜想相当于“C# Express”的是[JDK 6u13 with Netbean IDE bundle](http://java.sun.com/javase/downloads/netbeans.html)。

如果您不需要 IDE，那么您可以下载独立的[JDK](http://java.sun.com/javase/downloads/index.jsp)。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-13T14:58:43.347

Java中没有这样的官方编译器。Java 是一套由社区驱动的规范。你可以称它为一份文件。sun 所做的是它为这个文档提供了一个参考实现。您可以从上面给出的链接下载。[您可以按照http://oyejava.com/tiki-index.php?page=Installing+Java](http://oyejava.com/tiki-index.php?page=Installing+Java)中的说明安装 Java

此外，您可能希望使用 Eclipse 或 Netbeans 等 IDE 之一进行开发。有关 Eclipse 的基础知识，请参见[http://oyejava.com/tiki-index.php?page=Eclipse+Download](http://oyejava.com/tiki-index.php?page=Eclipse+Download)

# matlab - 从 matlab 中检测 matlab 进程

> ID：858301
> 
> 赞同：8
> 
> 时间：2009-05-13T14:30:50.600
> 
> 标签：matlab, process

有什么方法可以从 matlab 程序中检测计算机上正在运行多少个 matlab 进程？

我想运行 n 个 matlab 进程。如果我的数量太少，我想创建它们，如果我有很多，我想杀死一些。您当然可以手动执行此操作，但如果可能的话，我希望它是自动的，并且实现起来并不复杂。

附加信息：目前我正在使用 windowsx64 (vista)，但我也对其他平台感兴趣。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-13T16:17:12.173

如果你在 Windows 上，你可以这样做：

```
[s,w] = dos( 'tasklist' );
numMatlabs = length( regexp( w, '(^|\n)MATLAB.exe' ) ) 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-14T15:38:33.980

这是另一种方法：您可以使用 Matlab 的 COM“自动化服务器”来启动工作人员并从中央 Matlab 进程控制它们。

```
function out = start_workers(n)
myDir = pwd;
for i=1:n
    out{i} = actxserver( 'matlab.application.single' );
    out{i}.Execute(sprintf('cd(''%s'')', myDir));
end 
```

然后您可以使用 Execute() 让它们运行。您可以使用计时器技巧来获得某种异步执行。

```
function out = evalasync(str)
%EVALASYNC Asynchronous version of eval (kind of)
%
% evalasync(str)  % evals code in str
% evalasync()     % gets results of previous call

persistent results status exception

if nargin == 0
    out = {status results exception}; % GetWorkspaceData doesn't like structs
    assignin('base', 'EVALASYNC_RESULTS', out); % HACK for Automation
    return
end

status = 'waiting';
    function wrapper(varargin)
        status = 'running';
        try
            results = eval(str);
            status = 'ok';
        catch err
            status = 'error';
            exception = err;
        end
    end

t = timer('Tag','evalasync', 'TimerFcn',@wrapper);
startat(t, now + (.2 / (60*60*24)));

end 
```

然后

```
w = start_workers(3);
w{1}.Execute('evalasync(''my_workload(1)'')');
w{2}.Execute('evalasync(''my_workload(2)'')'); 
```

不幸的是，您在工作人员中遇到了单线程，因此如果您再次调用 evalasync() 来检查结果，它会阻塞。所以你想通过磁盘上的文件来监控他们的进度。因此，它可能不会有太大的胜利。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-13T14:37:31.290

在 Linux 上

```
!ps -ef |grep "/usr/local/matlab78/bin/glnxa64/MATLAB"|wc -l 
```

可以解决问题（用您自己的路径替换路径并为 grep 过程减去 1）

（或内置到函数中，使用

```
[tmp, result] = system('ps -ef |grep "/usr/local/matlab78/bin/glnxa64/MATLAB"|wc -l');
str2double(result) - 1 
```

另外，您可以使用

```
>>computer
ans = GLNXA64 
```

找出程序当前正在执行的系统架构（win/linux/etc）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-13T16:37:08.037

关于检测您的机器上当前正在运行多少个 MATLAB 进程，我可能会选择[Edric 给出的答案](https://stackoverflow.com/questions/858301/detect-matlab-processes-from-within-matlab/858911#858911)。然后，您必须从那里停止其中一些或开始新的。下面是一些代码（使用 Edrics 方法），它将检测 MATLAB 进程的数量、打开新进程并立即在其中运行代码。我仍在研究进程终止部分......

```
[s,w] = dos('tasklist');
nProcesses = numel(regexp(w,'(^|\n)MATLAB.exe'));
for n = 1:(3-nProcesses),  % Starts new processes if there are less than 3
  dos('MATLAB R2009a -nosplash -r why &');  % Starts a process and runs the
                                            %   built-in function "why.m"
end 
```

假设您有 1 个进程正在运行以启动，此代码将再启动 2 个，然后将控制权返回给原始 MATLAB 进程（由于对[DOS](http://www.mathworks.com/access/helpdesk/help/techdoc/ref/dos.html)函数的调用中的“&”）。当它启动每一个时，它会自动调用内置的 MATLAB 函数 WHY（由于调用 DOS 中的“-rwhy”），从而导致在每个新窗口中出现以下文本：

*秃头和不太秃头和不太聪明的仓鼠服从一只受惊且不太受惊的仓鼠。*

通过用您想要运行的任何代码/m 文件替换对 DOS 的调用中的“为什么”，您可以生成立即开始处理数字的新进程。

* * *

**使用并行计算工具箱：**

*（这是我的答案的旧版本，我会留在这里，以防有人发现它有帮助）*

如果您使用 Parallel Computing Toolbox 创建一个 MATLAB 工作程序池，您可能需要查看[MATLABPOOL](http://www.mathworks.com/access/helpdesk/help/toolbox/distcomp/matlabpool.html)函数。以下是一些使用它的方法：

```
>> poolSize = matlabpool('size')  % Check the current pool size

poolSize =

     0

>> matlabpool('open',2);  % Open a pool of 2 workers
Starting matlabpool using the 'local' configuration ... connected to 2 labs.
>> poolSize = matlabpool('size')  % Check the pool size again

poolSize =

     2

>> matlabpool('close');  % Close the pool of workers
Sending a stop signal to all the labs ... stopped. 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-12-15T14:20:59.130

使用 Windows 的 TASKLIST，您还可以使用窗口标题作为过滤器来获取特定运行任务的 PID。如果您有多个 Matlab 进程正在运行并且您更改了标题，这将特别有用。

使用以下函数 (changeWindowTitle.m) 更改 Matlab 主窗口标题：

```
function changeWindowTitle(str)

% first get all of the Java frames present in the current JVM
frms = java.awt.Frame.getFrames();

% now, lets look through those frames for one that seems like it

root = [];
for m = 1:length(frms)
    if strcmpi(get(frms(m),'Type'),'com.mathworks.mde.desk.MLMainFrame')
        root = frms(m);
        break;
    end
end
if isempty(root)
    error('Could not find my main frame')
end
set(root,'Title',str) 
```

如果您使用 ... 将 Matlab 窗口标题修改为“MyMatlabWindow”。

```
> changeWindowTitle("MyMatlabWindow"); 
```

...您可以使用以下方法从 Matlab 外部找到这个 Matlab 的会话 PID：

```
c:\tasklist /FI "WindowTitle eq MyMatlabWindow" 
```

当然，您可以在 Matlab 中使用`dos()` `system()`感叹号或感叹号来做同样的事情。

此外，您可以添加参数`/FO CSV`（以将输出格式化为 CSV）和`/NH`（以抑制标头的输出。

```
c:\tasklist /FI "WindowTitle eq MyMatlabWindow" /FO CSV /NH 
```

资料来源：

*   [http://www.mathworks.fr/matlabcentral/newsreader/view_thread/97385（Matlab](http://www.mathworks.fr/matlabcentral/newsreader/view_thread/97385) 函数）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-14T04:58:18.310

愿意写一些 VBScript 吗？您可以使用[WMI](http://msdn.microsoft.com/en-us/library/aa394582(VS.85).aspx)编写脚本，这是一个带有脚本绑定的 Windows 管理 API。WMI 可以列出机器上的所有进程，包括映像名称、路径和命令行。搜索 MATLAB.exes。[WMI 的 Win32_Process 对象还公开了Process Explorer](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)显示的大部分信息，例如启动时间、CPU 和内存使用情况。

您*几乎*可以使用 actxserver() 和 COM 方法调用从 Matlab 本身编写 WMI 脚本，但是这些集合还不能正常工作。但是您可以编写一个简单的 VBS 来执行 WMI 进程列表查询并编写对 Matlab 友好的输出，然后对其进行外壳处理。这比使用任务列表要多一些工作，但是如果您正在处理一堆工作进程，您可能会发现额外的信息很有用。例如，命令行、窗口标题或进程启动时间可用于在决定杀死哪些工作人员时区分工作人员。

要杀死它们，您可以使用 WMI 的 Win32_Process.Terminate，或者使用 taskkill 命令。

这都是仅限 Windows 的。如果你想让事情变得可移植，你可以安装 cygwin，然后在任一操作系统上使用 Unix 风格的 ps 和 kill 命令。

旁注：如果您使用“-r”使常规 Windows Matlab 应用程序充当工作人员，请在主脚本的最顶层使用 try/catch 以确保它在完成后退出：

```
try
    do_your_work();
catch err
    warning('Got an error: %s', err.message); 
end

close force all  % prevent figures from making quit() balk
quit force 
```

否则，在 M 代码中抛出的错误可能会冒泡到顶层并将 Matlab 放入主 GUI 循环中等待用户输入，它看起来就像一个挂起的工人。

哦，如果您要从 Matlab 中杀死 Matlab 进程，您可能希望避免杀死自己。这是一个 MEX 函数，可让您在 Windows64 或 Unix 上确定自己的 pid；选择受害者时，对照目标进程的 pid 检查它。更高级的 ifdefs 将使它在 win32 上工作。

```
/* mygetpid.c - MEX function to get PID */
#ifdef _WIN64
#include <process.h>
#define GETPID _getpid
#else
/* assume we're on Unix */
#include <unistd.h>
#define GETPID getpid
#endif
#include "mex.h"

void mexFunction(int nlhs,       mxArray *plhs[],
                 int nrhs, const mxArray *prhs[]
                )
{
    /* ... a real function would have nargin/nargout checks here... */
    plhs[0] = mxCreateDoubleScalar((int) GETPID());
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-02-13T12:07:32.760

[Edric 的回答](https://stackoverflow.com/a/858911/3978545)效果很好，但如果您有很多进程正在运行，它会相对较慢。

`dos`如果您对 使用可选输入，则可以大大提高命令的执行速度`tasklist`，特别是将其限制为仅 MATLAB.exe 图像名称...

```
[~,w] = dos( 'tasklist /fi "IMAGENAME eq MATLAB.exe" /fo "csv"' );
numMatlabs = length( regexp( w, '"MATLAB.exe"' ) ); 
```

# django - Django Pagination - 重定向到对象所在的页面

> ID：858316
> 
> 赞同：0
> 
> 时间：2009-05-13T14:32:37.897
> 
> 标签：django

我正在开发一个图像组合应用程序，我有一个如下所示的网址：

```
url(r'^(?P<slug_val>[-\w]+)/(?P<page>[0-9]+)/(?P<id>[0-9]+)/$', 'portfolio.views.imagedetail') 
```

本质上，该`page`元素只存在于那里，因此我可以很好地将用户重定向回他们来自的缩略图页面。但是，如果 URL 被传递，然后在图像之前添加或删除了一些图像，那么它可能不再出现在该页面上。在这种情况下，我想将用户重定向到：

```
slug/correctpage/id 
```

我无法解决的是如何使用 Django 的内置分页来计算图像在哪个页面上。这是我到目前为止所得到的：

```
def imagedetail(request, slug_val, page, id):
    p = get_object_or_404(MyPortfolio, slug=slug_val)

    paginator = Paginator(p.images.all(), 25)

    # find out which page the image with id is on, if it's not page,
    # then redirect, otherwise render 
```

我知道我可以遍历每个页面，但这似乎会不必要地访问数据库，我确信必须有一种更优雅的方式来做到这一点。

谢谢，

多姆

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T14:46:06.423

如果您想考虑数据库更改，您将别无选择，只能查询数据库，或者……如果您只使用一台 Web 服务器，则必须在内存中某处缓存更改。如果您没有太多数据或足够的可用内存，则后者只是一种选择。

查询类似以下内容的最优雅的方法，但如果不使用 SQL，这在 Django 1.0 中很难实现：

```
SELECT COUNT(*) + 1 FROM images WHERE images.field < currentfield 
```

（其中 field 是您用于订购图像的字段）

要在 Django 中使用原始 SQL，您可以阅读[此页面](http://docs.djangoproject.com/en/dev/topics/db/sql/#topics-db-sql)以获取更多信息。

然后你知道你的图像的位置，你可以很容易地计算出该项目所在的页面。

# cross-platform - JBoss Messaging 是否支持非 Java 客户端？

> ID：858317
> 
> 赞同：1
> 
> 时间：2009-05-13T14:32:40.457
> 
> 标签：cross-platform, jms, amqp, stomp, jboss-messaging

[对于企业集成项目，对 J JBoss Messaging](http://www.jboss.org/jbossmessaging/)等消息代理的非 Java 访问非常有帮助。对于[Apache ActiveMQ](http://activemq.apache.org)和[GlassFish Open Message Queue](https://mq.dev.java.net/)产品，有许多不同的客户端实现可用，使用本机或标准协议（如[Stomp](http://stomp.codehaus.org)）。

JBoss Messaging在问题跟踪器中有一个任务“[本机实施 STOMP 协议”。](https://jira.jboss.org/jira/browse/JBMESSAGING-1406)然而，这个任务并没有出现在[JBoss Messaging 路线图](https://jira.jboss.org/jira/browse/JBMESSAGING?report=com.atlassian.jira.plugin.system.project:roadmap-panel)中。

是否有其他选项可以使用非 Java 客户端连接到 JBoss Messaging？

编辑：[JBoss Messaging 将在版本 2 中支持 AMQP](http://www.jboss.org/feeds/post/jboss_messaging_to_implement_amqp_and_other_exciting_news)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-12-06T10:07:29.860

[HornetQ](http://jboss.org/hornetq/)（将取代 JBoss Messaging）将在 2.1 版本中支持 Stomp 客户端：

> HornetQ 服务器将能够直接使用 STOMP 协议，允许 HornetQ 与任何支持多种语言的 STOMP 客户端一起使用。

[http://www.jboss.org/community/wiki/Roadmap](http://www.jboss.org/community/wiki/Roadmap)

它将在[2.2 版本](http://community.jboss.org/wiki/Roadmap)中支持 AMQP ：

> 实现新兴的 AMQP 协议。我们更愿意实现所有主要各方都同意的更简单的 1.0 版本的协议。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-22T13:34:45.117

JBoss Messaging 将在版本 2 中支持[AMQP](http://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol)，这将允许非 Java 客户端访问它。

# silverlight-2.0 - Silverlight 中的 IP 地址

> ID：858318
> 
> 赞同：6
> 
> 时间：2009-05-13T14:32:44.620
> 
> 标签：silverlight-2.0

如果我的 Silverlight 控件托管在 HTML 中，有没有办法在 Silverlight 中获取客户端的 IP 地址？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-13T14:38:21.413

据我所知，没有直接的方法可以做到这一点。也许您可以创建一个 WebMethod 来实现这一点。或者其他一些技巧。

检查这个线程，有一些建议：[http ://silverlight.net/forums/t/34744.aspx](http://silverlight.net/forums/t/34744.aspx)

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-05-13T14:35:06.147

尝试下面列出的方法（第一个通常应该可以解决问题），或查看[此处](http://michaelsync.net/2008/04/07/silverlight-2-beta1-url-referrer-screen-resolution-clients-data-time-and-ip-address)了解更多信息。

```
Request.ServerVariables(”REMOTE_HOST”)
HttpContext.Current.Request.ServerVariables["REMOTE_ADDR"]
HttpContext.Current.Request.ServerVariables["HTTP_X_FORWARDED_FOR"];
Request.UserHostAddress()
Request.UserHostName()
string strHostName = System.Net.Dns.GetHostName();
string clientIPAddress = System.Net.Dns.GetHostAddresses(strHostName).GetValue(0).ToString(); 
```

# sql - 在 SQL Server 中定义可能包含整数或字符串的列的最佳方法是什么？

> ID：858323
> 
> 赞同：1
> 
> 时间：2009-05-13T14:34:19.737
> 
> 标签：sql, sql-server, sql-variant

我有一种情况，相同类型的两个对象具有不同类型的父对象。下面的伪代码最好地解释了这种情况：

```
TypeA a1, a2;
TypeB b;
TypeC c;
a1.Parent = b;
a2.Parent = c; 
```

更复杂的是，TypeB 和 TypeC 可能具有不同类型的主键，例如，以下断言可能为真：

```
Assert(b.Id is string && c.Id is int); 
```

我的问题是在 SQL Server 中定义这种父子关系的最佳方法是什么？我能想到的唯一解决方案是定义 TypeA 表有两列 - ParentId 和 ParentType，其中：

*   ParentId 是 sql_variant - 能够同时保存数字和字符串
*   ParentType 是字符串 - 保留父类型的程序集限定名称。

但是，当我基于 sql_variant 定义用户数据类型时，它将字段大小指定为固定的 8016 字节，这似乎是太多了。

必须有更好的方法。任何人？谢谢。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-13T14:36:09.390

一个字：**不要**

这是非常糟糕的做法 - 列有**一个单一**的数据类型是有原因的。不要滥用这个，把所有东西都变成变种......

马克

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T14:39:51.520

如果 NEITHER 列永远不会参与任何数学运算，请将它们设为 CHAR() 或 VARCHAR()，因为您将处理一系列字符，而不是数字。在这种情况下，“1”与“A”一样有效。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T14:43:27.770

我不确定我是否完全理解您的情况，但在类似的情况下，我在 TableA 上创建了两列，一列存储字符串键，一列存储 int 键；最终它们都可以为 NULLable（但不在同一记录中）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T14:53:56.193

通过使用一列，您消除了设置外键关系的能力，从而引入了不良数据的可能性。您需要将每个表的键存储在不同的字段中，因为它们是表示不同事物的不同数据。将它们存储在一个列中将是一个非常糟糕的主意。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-13T15:42:39.420

嗯，有两个问题。首先是 OO 设计，在您的模型中，TypeA 可以有不同类型的父级，而这些类型（TypeB 和 TypeC）没有共同的父级。显然，我不相信它会是真实的。但是我不知道这些类型的含义...如果从一些TypeX继承TypeB和TypeC就可以解决这个问题，这种情况下我将在TypeA中引用TypeX。

第二个是数据库设计。由于 OO 设计中的错误，您在 DB 端遇到问题。解决方案是一样的 - 为 TypeX 创建单独的表，并将 TypeA 和 TypeB 之间的所有公共属性放在那里，为 TypeA 和 TypeB 创建单独的表。TypeX 与 TypeA 以及 TypeB 的关系为 1:1。在这种情况下，TypeA 创建看起来是这样的——在 TypeX 中插入新行，获取 ID，在 TypeA 中插入行。在此解决方案中，您将在 TypeX 和 TypeA 或 TypeX 和 TypeB 中找到匹配的行。

TypeX(TypexID int not null primary key identity (1,1), SomeCommonColumn int) TypeA(TypexID int not null primary key, TypeASpecific int) TypeB(TypexID int not null primary key, TypeBSpecific varchar)

只有用关系理论来实现这种情况——清晰且非冗余的方式。它看起来不是很简单，但通常这些表由视图和存储过程覆盖，因此这些表可以被应用程序用作单个（虚拟）表。

谢谢你，亚历山大

# linq-to-sql - 使用 GROUP BY 和 COUNT 的 LINQ to SQL（转换问题）

> ID：858328
> 
> 赞同：1
> 
> 时间：2009-05-13T14:35:29.733
> 
> 标签：linq-to-sql

我已经阅读[了这个问题](https://stackoverflow.com/questions/448203/linq-to-sql-using-group-by-and-countdistinct)，但这并不是我想要的。我的问题是我想这样做：

```
SELECT CONVERT(varchar(10), m.CreateDate, 103) as [Date] , count(*) as [Count] FROM MEMBERS as m
WHERE m.CreateDate >= '24/01/2008' and m.CreateDate <= '26/06/2009' 
Group by CONVERT(varchar(10), m.CreateDate, 103) 
```

结果是：

```
 Date     Count 

 02/03/2009 4  
 24/02/2009 3   
 25/02/2009 3  
 26/02/2009 3 
```

我正在这样做：

```
From m In Me.Members _
Where m.CreateDate >= "22/02/2008" And m.CreateDate <= "22/05/2009" _
Group m By m.CreateDate Into g = Group _
Select New With {CreateDate, .Count = g.Count()} 
```

根据 LINQPad 在 SQL 中执行此操作：

```
SELECT COUNT(*) AS [Count], [t0].[CreateDate]
FROM [Members] AS [t0]
WHERE ([t0].[CreateDate] >= @p0) AND ([t0].[CreateDate] <= @p1)
GROUP BY [t0].[CreateDate] 
```

结果是：

```
 Date          Count
24/02/2009 00:00:00  1
24/02/2009 07:07:10  1
24/02/2009 12:24:10  1
25/02/2009 03:43:05  1 
25/02/2009 03:48:36  1 
25/02/2009 04:25:11  1 
26/02/2009 01:51:24  1 
26/02/2009 09:54:55  1 
26/02/2009 09:55:31  1 
02/03/2009 05:29:22  1 
02/03/2009 05:45:50  1 
02/03/2009 06:15:31  1 
02/03/2009 06:59:07  1 
```

所以我明白区别在于 CONVERT 部分。那么如何在 LINQ 中从 Date 或 Datetime 转换为 SmallDate 或类似的东西？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T14:53:09.610

尝试这个：

```
From m In Me.Members _
Where m.CreateDate.Date >= new DateTime( 2009, 2, 22 ) And m.CreateDate.Date <= new DateTime( 2009, 5, 22) _
Group m By day = m.CreateDate.Date Into g = Group _
Select New With { .Date = day.ToString( "dd/MM/yyyy" ), .Count = g.Count()} 
```

如果 CreateDate 可以为空，那么您需要在提取日期之前使用 Value 参数。您也可以根据结束日期检查的意义省略 WHERE 查询中日期的提取（是否包括在内，然后使用日期，否则省略日期）。

# sharepoint - 有使用 InfoPath 为 SharePoint 开发离线解决方案的经验吗？

> ID：858333
> 
> 赞同：0
> 
> 时间：2009-05-13T14:36:07.313
> 
> 标签：sharepoint, infopath, offline

随着 SharePoint 2007 在我当前的客户中的广泛接受，越来越多的关于离线填写表单然后在连接回网络时得到同步的问题。

这似乎正是 Microsoft 构建 InfoPath 的目的，所以这是我（完全未经测试）的想法：我们有一个 InfoPath 表单库，用户可以将其连接到他们的 Outlook 客户端，因此当他们离线时可以在本地获取表单。然后他们可以在闲暇时打开它们，填写它们并保存结果。然后，他们又上网了……

*...然后一些魔术发生了...*

...并将表单数据保存到 SharePoint 列表中。

所以很自然，我需要找出那个魔法是什么，但是你们中的任何人有任何关于 InfoPath/SharePoint 集成的提示、提示或战争故事可以分享吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T15:46:36.327

我有一些关于为可以访问 SharePoint 的内部用户使用 InfoPath Forms Services 以及为无法访问 SharePoint 的外部用户使用 InfoPath 胖客户端的战争故事。一种巧妙的解决方案，涉及将表单通过电子邮件发送给外部用户并返回到 SharePoint 库，但存在需要代码来解决问题的陷阱。

这可能不适用于您的解决方案，但立即想到的一个问题是 InfoPath Forms Services 要求 XML 具有指向模板的 HREF 属性，但这在客户端上没有使用 - 实际上它已被丢弃由导致表单服务崩溃的客户端。必须编写表单库上的事件处理程序才能将 HREF 放回原处。

* * *

更新 - 我忘了提到我关于 InfoPath 的一些笔记（许多与离线使用有关）可以在我们的 SharePoint 深度 Wiki 上找到：http: [//wiki.threewill.com/display/enterprise/InfoPath+Notes](http://wiki.threewill.com/display/enterprise/InfoPath+Notes)

值得一提的是，我们也将 Groove 与此解决方案一起使用（Groove 与 InfoPath Forms Services 和 InfoPath 客户端一起使用）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T16:21:54.270

您可以利用 MS Groove 进行将与 SharePoint 同步的离线协作：

[Microsoft Office 2007 文档：Groove 和 SharePoint 集成](http://www.microsoft.com/downloads/details.aspx?FamilyID=B109FBC4-6E60-45F6-BF50-218707C37955&displaylang=en)

# java - 如何使用 Hibernate Annotations 在 Lob / Clob / tinyblob 上添加索引

> ID：858336
> 
> 赞同：4
> 
> 时间：2009-05-13T14:36:42.897
> 
> 标签：java, mysql, hibernate

我有一个使用 Hibernate 映射到数据库的 bean。我正在使用 Hibernate Annotations 来指示我想要的映射，并创建索引。彻底简化的代码如下所示。

我遇到的问题是我的 byte[] 字段上的索引没有创建；特别是我的多字段索引 sysUuid 没有被创建（参见示例代码）。在 Hibernate 调试日志中，我什至没有看到创建索引的尝试！

我想指出，uuid 字段上的 @Index 注释也不会导致数据库上的索引。

我确实知道如何使用 MySQL 手动创建索引：

```
create index sysuuid on persons ( system, `uuid`(8) ); 
```

其中有趣的特性是需要转义 uuid（因为它是 MySQL 函数）并且需要在字段上给出长度（如文本字段）。

但是，我还没有找到使用 Hibernate Annotations 提供索引长度字段的方法，因此我无法测试这是否是问题所在。但是，可以肯定的是，在注释中命名字段“uuid(8)”是行不通的。

```
@Entity
// The UniqueConstraints work 
@Table(name = "persons", 
   uniqueConstraints = {@UniqueConstraint(columnNames = {"uid", "system"}) } )
// but these don't generate an index
@org.hibernate.annotations.Table(appliesTo="persons", 
   indexes={@Index(name="sysUuid",  columnNames={"system", "uuid"})  } )
public class Person  {
    @Basic 
    @NotNull
    private String uid;

    @Basic
    private int system;

    // Gets mapped to tinyblob
    @Basic
    @Size(min = 16, max = 16)
    private byte[] uuid;

    // getters and setters here 
} 
```

我想问你的是：是否可以使用注释在 lob 上添加索引，如果可以，如何？

**编辑**

我确实有可能转向基于字符串的 UUID，但我对此并不满意，因为 uuid 在概念上是一个 16 字节的标识符。

我非常喜欢 Java 类型来匹配问题域。

正如我所说 - 我确实有一个方便的 SQL 语句，所以我可以部署代码 + 一个 SQL 脚本。我只是认为在可行的情况下最好有自记录代码。

**编辑和添加赏金**

我相信我需要的索引不能使用 Hibernate Annotations 来创建（关于 Matt Solnit 的回答）。

但是，我希望获得更多关于使用 Hibernate Annotations 创建索引的信息，因此最终的答案最终会记录 API 的局限性。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T23:38:36.943

您可以使用 Hibernate 的[辅助对象](http://docs.jboss.org/hibernate/stable/core/reference/en/html/mapping-database-object.html)支持来做到这一点，但不能使用注释来做到这一点:-(。

在您的示例中，它看起来像这样（为简洁起见，省略了很多东西）：

```
<class name="Person" table="persons">
  <!-- whatever -->
  <database-object>
    <create>create index sysuuid on persons ( system, `uuid`(8) )</create>
    <drop>drop index sysuuid</drop>
    <dialect-scope name="org.hibernate.dialect.MySQL5InnoDBDialect" />
  </database-object>
</class> 
```

对于缺少基于注释的答案，我深表歉意:-(。希望这会有所帮助。

**注意**：如果您确实采用这种方法，请注意方言范围必须*完全*匹配。例如，如果您的 Hibernate 配置说使用`MySQL5InnoDBDialect`，那么您必须在`<dialect-scope>`元素中也有这种方言。`MySQLDialect`即使它是 InnoDB 方言的超类，使用也不会起作用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T17:36:45.523

您真正想要做的是将您的 UUID 属性定义为字符串而不是字节数组。这样，Hibernate 会将其映射到数据库中的字符列而不是 LOB，我认为它会创建您想要的索引。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-23T08:58:18.027

这是我对 MySQL 的研究结果。如果您有一个长度很大的字段：

```
@Column(length = 2000)
public String getMessageId() {
    return messageId;
} 
```

那么它的类型将是 BLOB 并且索引不起作用：

```
HHH000389: Unsuccessful: create index messageid_idx on MessageDetails (messageId)
BLOB/TEXT column 'messageId' used in key specification without a key length 
```

如果使用注解，添加自定义 sql 的唯一方法如下：

```
 cfg.addAuxiliaryDatabaseObject(new SimpleAuxiliaryDatabaseObject(
            "CREATE INDEX messageId_IDX ON MessageDetails(MessageID(128))",
            "DROP INDEX messageId_IDX ON MessageDetails")); 
```

其中 cfg 是用于注册注解的对象：

```
 cfg.addAnnotatedClass(MessageDetails.class); 
```

这对我有用。感谢您的关注。

# c++ - 可能有什么问题： char* param= new char[200];

> ID：858338
> 
> 赞同：0
> 
> 时间：2009-05-13T14:37:03.833
> 
> 标签：c++, new-operator

我正在用 C++ 编写一个程序，由于某种原因，我在以下行出现分段错误：

```
char* param= new char[200]; 
```

我尝试了不同的变体，甚至尝试在它之前放置

```
int* param= new int;//for no reason 
```

并发生同样的错误。我可能做了什么导致这个问题？

什么可能导致像这样的简单内存分配产生问题。

我会包括程序的其余部分，但它超过 1000 行。但请随时询问更多信息。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-13T14:40:08.353

在此之前您是否进行任何内存分配和释放？如果是这样，您可能以某种方式损坏了堆。如果不查看更多代码，就无法进一步诊断。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T14:49:02.923

我会说尼尔走在了正确的轨道上——这可能是你之前踩过的东西，只是在那里被抓住了。

您是否确定：

1.  之前的所有分配都成功了。
2.  您没有写过任何数组的结尾或开头（那里[有大量用于检查边界的信息和工具](http://www.google.co.uk/search?q=C%2B%2B+bounds+checking&ie=utf-8&oe=utf-8&aq=t&rls=org.mozilla:en-GB:official&client=firefox-a)）。

**[编辑]**为了回应您关于拥有 4GB 内存的评论，假设您的代码有效地执行了以下操作：

```
unsigned int amountToAllocate = 0;
amountToAllocate -= 1;

int* someStorage = new int[amountToAllocate];

someStorage[0] = 5; 
```

...因为`amountToAllocate`是`unsigned int`，它将环绕到它的最大值（如果`unsigned int`s 在您的硬件上是 32 位，则为 4294967295）。因此，您将尝试分配 4294967295*4 字节（再次假设`int`s 对您来说是 32 位的）...大约为 4*4GB 并且会失败并死去。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-13T14:49:14.173

这就是您可以使用它的方式，例如，我用 int 替换了 char 以存储一些值，但与 char 相同。

```
#include <iostream>

using namespace std;

int main()
{
    int * param = new int[200];

    for (int i = 0; i < 200; ++i) param[i] = i;
    for (int i = 0; i < 200; ++i) cout << param[i] << endl;

    delete[] param;

    return 0;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-13T16:10:59.360

首先，确认这条线是问题所在。如果你把它注释掉会发生什么？（或替换为`char *param = NULL`）

其次，这可能导致段错误的唯一方法是之前已经出现问题。在此之前会发生什么？

如果您不能向我们展示相关的代码片段，那就是您的问题。开始注释掉一些代码或以其他方式隔离潜在的故障点。迟早，您将能够将问题归结为重现错误的小样本。在这一点上，问题（和解决方案）可能很明显，如果不是，至少你有一个合理大小的代码示例来展示给我们。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-13T16:47:00.487

我支持@jalf 所说的话。你真的确定这是段错误的线路吗？这是非常不可能的。

当您尝试访问您无权访问的内存时，会发生段错误。由于您没有要求任何特定的内存，而是让“新”内存分配为您获取它，所以问题一定出在其他地方。

你真正应该做的是在你的代码中加入一堆打印语句。（我假设你不习惯使用调试器？）这会让你看到程序在段错误发生之前能走多远。祝你好运！

# php - PHP 可以执行类似 p($i) 的操作并打印“$i is 5”——C 和 Ruby 可以...（即自动打印“$i”）

> ID：858339
> 
> 赞同：0
> 
> 时间：2009-05-13T14:37:24.363
> 
> 标签：php, c, ruby, debugging, printing

我想知道 PHP 是否可以做到这一点，因为似乎还没有好的解决方案：

```
p($i) 
```

它会打印

```
$i is 5 
```

和

```
p(1 + 2) 
```

将打印

```
1 + 2 is 3 
```

和

```
p($i * 2)  =>  $i * 2 is 10  
p(3 * factorial(3))  =>  3 * factorial(3) is 18 
```

C 和 Ruby 都可以做到这一点......在 C 中，它可以通过字符串化来完成，而在 Ruby 中，有一个解决方案使用`p{'i'}`or `p{'1 + 2'}`（通过传递带有绑定的块来进行评估）......我想知道在PHP中，也有可能吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T14:44:41.357

我认为可以通过回溯然后加载和标记调用`p()`. 不过，我不会称其为“好”解决方案。

当然你可以自己串起来...

```
p('$i');

function p($str) 
{
    echo $str, " = ", eval("return ($str);");
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T14:46:18.030

如果您将字符串弄乱以使其成为返回语句，则可以使用[eval](http://php.net/eval) ...

```
function p($expr)
{
   $php="return {$expr};";
   echo "$expr is ".eval($php)."\n";
}

p("1+2"); 
```

适用于简单的表达式，但如果你试图在 $expr 中引用一个变量，那么它不会在函数 p() 的范围内找到它 - 像下面这样的小技巧会有所帮助：

```
function p($expr)
{
   $php="return {$expr};";
   $php=preg_replace('/\\$(\w+)/', '$GLOBALS[\'$1\']', $php);

   echo "$expr is ".eval($php)."\n";
}

$x=5;
p('$x+4'); 
```

在这里，我们在代码中搜索变量引用并将它们转换为 $GLOBALS 数组引用。表达式`$x+4`变成了`return $GLOBALS['x']+4;`

不确定我是否想在生产代码中看到这个:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T14:54:05.880

简短的回答：没有

基于 eval() 的解决方案的问题在于范围。以下将不起作用：

```
function p($expr)
{
   $php="return {$expr};";
   echo "$expr is ".eval($php)."\n";
}

$i = 10;

p('$i + 1'); 
```

因为调用 eval() 时 $i 将不在范围内。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T14:43:56.083

好吧，如果你传入一个字符串，你可以使用[eval](http://us.php.net/eval)来进行计算。

# c# - Get IP address in a console application

> ID：858341
> 
> 赞同：17
> 
> 时间：2009-05-13T14:37:34.473
> 
> 标签：c#, console-application

I am looking to figure out what my IP address is from a console application.

I am used to a web application by using the `Request.ServerVariables` collection and/or `Request.UserHostAddress`.

How can this be done in a console app?

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-05-13T14:41:58.617

The easiest way to do this is as follows:

```
using System;
using System.Net;

namespace ConsoleTest
{
    class Program
    {
        static void Main()
        {
            String strHostName = string.Empty;
            // Getting Ip address of local machine...
            // First get the host name of local machine.
            strHostName = Dns.GetHostName();
            Console.WriteLine("Local Machine's Host Name: " + strHostName);
            // Then using host name, get the IP address list..
            IPHostEntry ipEntry = Dns.GetHostEntry(strHostName);
            IPAddress[] addr = ipEntry.AddressList;

            for (int i = 0; i < addr.Length; i++)
            {
                Console.WriteLine("IP Address {0}: {1} ", i, addr[i].ToString());
            }
            Console.ReadLine();
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T14:43:27.443

Try this:

```
String strHostName = Dns.GetHostName();

Console.WriteLine("Host Name: " + strHostName);

// Find host by name    IPHostEntry
iphostentry = Dns.GetHostByName(strHostName);

// Enumerate IP addresses
int nIP = 0;   
foreach(IPAddress ipaddress in iphostentry.AddressList) {
   Console.WriteLine("IP #" + ++nIP + ": " + ipaddress.ToString());    
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-13T14:43:04.137

The System.Net namespace is your friend here. In particular, APIs such as DNS.GetHostByName.

However, any given machine may have multiple IP addresses (multiple NICs, IPv4 and IPv6 etc) so it's not quite as simple a question as you pose.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-10-21T06:25:04.997

IPAddress[] addresslist = Dns.GetHostAddresses(Dns.GetHostName());

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-13T14:41:00.800

```
using System;
using System.Net;

public class DNSUtility
{
    public static int Main (string [] args)
    {

      String strHostName = new String ("");
      if (args.Length == 0)
      {
          // Getting Ip address of local machine...
          // First get the host name of local machine.
          strHostName = DNS.GetHostName ();
          Console.WriteLine ("Local Machine's Host Name: " +  strHostName);
      }
      else
      {
          strHostName = args[0];
      }

      // Then using host name, get the IP address list..
      IPHostEntry ipEntry = DNS.GetHostByName (strHostName);
      IPAddress [] addr = ipEntry.AddressList;

      for (int i = 0; i < addr.Length; i++)
      {
          Console.WriteLine ("IP Address {0}: {1} ", i, addr[i].ToString ());
      }
      return 0;
    }    
 } 
```

source : [http://www.codeproject.com/KB/cs/network.aspx](http://www.codeproject.com/KB/cs/network.aspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-13T14:42:35.743

System.Net.Dns.GetHostAddresses() should do it.

# sql - “<>”与“不在”

> ID：858344
> 
> 赞同：23
> 
> 时间：2009-05-13T14:38:29.527
> 
> 标签：sql, sql-server, sql-server-2005, sql-server-2008

前几天我在调试一个存储过程，发现一些类似这样的逻辑：

```
SELECT something
FROM someTable
WHERE idcode <> (SELECT ids FROM tmpIdTable) 
```

这什么也没返回。我认为“<>”看起来有点奇怪，所以我将其更改为“NOT IN”，然后一切正常。我想知道这是为什么？这是一个相当古老的过程，我不确定这个问题已经存在了多久，但是当我们发现这个问题时，我们最近从 SQL Server 2005 切换到了 SQL Server 2008。“<>”和“NOT IN”之间的真正区别是什么？Server2005 和 2008 之间的行为是否发生了变化？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-05-13T14:43:46.473

```
SELECT something
FROM someTable
WHERE idcode NOT IN (SELECT ids FROM tmpIdTable) 
```

检查列表中的任何值。

但是，NOT IN 不是 NULL 容错的。如果子查询返回一组包含 NULL 的值，则根本不会返回任何记录。（这是因为在内部 NOT IN 被优化为`idcode <> 'foo' AND idcode <> 'bar' AND idcode <> NULL`etc.，这将始终失败，因为任何与 NULL 的比较都会产生 UNKNOWN，从而阻止整个表达式变为 TRUE。）

一个更好的、容忍 NULL 的变体是这样的：

```
SELECT something
FROM someTable
WHERE NOT EXISTS (SELECT ids FROM tmpIdTable WHERE ids = someTable.idcode) 
```

* * *

编辑：我最初认为这是：

```
SELECT something
FROM someTable
WHERE idcode <> (SELECT ids FROM tmpIdTable) 
```

只会检查第一个值。事实证明，这个假设至少对于 SQL Server 是错误的，它实际上触发了他的错误：

```
消息 512，第 16 级，状态 1，第 1 行
子查询返回超过 1 个值。当子查询跟随 =、!=、<、<=、>、>= 或子查询用作表达式时，这是不允许的。

```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-05-13T14:45:13.710

试试这个，可能会因为索引使用而运行得更快：

```
SELECT something
FROM someTable
    LEFT OUTER JOIN tmpIdTable ON idcode=ids
WHERE ids IS NULL 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-05-13T14:40:14.640

`<>`是“单一”`NOT`操作；`NOT IN`是一个集合操作，所以前者不起作用是有道理的。但是，我不知道它是否可能在以前版本的 SQL Server 下这样做了。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-05-13T15:48:19.443

当且仅当没有行或从 tmpIdTable 返回单行时，此代码才有效：

```
SELECT something
FROM someTable
WHERE idcode <> (SELECT ids FROM tmpIdTable) 
```

如果返回多行，您将收到如下错误：

消息 512，级别 16，状态 1，第 1 行子查询返回超过 1 个值。当子查询跟随 =、!=、<、<=、>、>= 或子查询用作表达式时，这是不允许的。

这与嵌套标量意外产生多行的错误相同，例如：

SELECT *, (SELECT blah FROM t1 WHERE etc.) FROM t2

十年来，SQL Server 中的 WRT 没有任何改变，所以我预计原始代码中关于嵌套查询的假设已经被打破。

如果没有返回任何行，则结果将为空，因为`<> NULL`它永远不会为真（假设 ANSI NULL）。

此代码适用于任意数量的行：

```
SELECT something
FROM someTable
WHERE idcode NOT IN (SELECT ids FROM tmpIdTable) 
```

但是，NULL 仍然存在问题。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-13T14:45:17.220

我不知道你为什么要写这样的东西`WHERE idcode <> (SELECT ids FROM tmpIdTable)`。SELECT 语句将返回一组元组，并且您的 idcode 将或不会在此集中。“ `WHERE idcode NOT IN (SELECT ids FROM tmpIdTable)`”是这样做的方法。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-05-13T16:01:22.980

如果 SELECT 子查询返回零行，则为 NULL。当 NULL 与任何东西进行比较时，结果总是 UNKNOWN，永远不会 TRUE。令人困惑的是，NOT UNKNOWN 等于 UNKNOWN。

我尽可能避免使用三值逻辑（TRUE、FALSE、UNKNOWN）。一旦掌握了窍门，这并不难避免。

如果 SELECT 子查询只返回一个值，则不等式比较应该返回您期望的结果。

如果 SELECT 子查询返回多个值，您应该得到一个错误。

通常，当您测试集合中的非成员身份时，NOT IN 将返回您期望的结果。

此响应与其他响应重叠，但措辞略有不同。

编辑以添加有关 NOT IN 的更多详细信息：

我在 Oracle 中做了一些关于 NOT IN 的搜索，并在半小时前学到了一些我不知道的东西。NOT IN 对 NULL 敏感。尤其，

```
X NOT IN (SELECT ...) 
```

不一样

```
NOT (X IN SELECT ...)) 
```

我可能不得不修改我之前的回复！

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-18T20:06:09.267

使用 NOT IN 的查询可能很脆弱：

[http://sqlblog.com/blogs/alexander_kuznetsov/archive/2008/10/21/defensive-database-programming-rewriting-queries-with-not-in.aspx](http://sqlblog.com/blogs/alexander_kuznetsov/archive/2008/10/21/defensive-database-programming-rewriting-queries-with-not-in.aspx)

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-05-13T14:51:30.940

在某些版本的 SQL 中，**!=**应该用于“不等于”逻辑语句。你试过吗？

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2020-07-28T23:36:21.280

`<>`本质上是“也不”

在 [SQL WHERE NOT demo](https://www.w3schools.com/sql/trysql.asp?filename=trysql_select_where_number) 我尝试了以下

失败：

```
WHERE NOT Country='Mexico' AND WHERE NOT country ='Sweden' 
```

作品

```
WHERE NOT Country='Mexico' AND country<>'Sweden' 
```

# iphone - 苹果在哪里提到了 UI 组件的所有重要高度？

> ID：858348
> 
> 赞同：1
> 
> 时间：2009-05-13T14:39:09.057
> 
> 标签：iphone, cocoa-touch, uikit

标签栏、导航栏、标签栏图标、UI 控件的高度……我一整天都在阅读人机界面指南，但他们很少提及高度。我看错地方了吗？Apple 是否有任何文件在一处提到它们？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T15:04:10.763

我很确定他们不会告诉你，因为他们不希望你硬编码任何东西。它们可能会在未来版本的操作系统中改变大小。事实上，他们已经申请了一项专利，以改变 UI 点击目标的大小以响应运动（因此，如果您正在走路并因此摇晃设备，列表元素可能会增加高度以防止误点击）。

最好的办法是在添加子视图时查询有问题的项目。他们的每个视图（导航栏、标签栏等）都有一个框架，您可以从中获取其大小和位置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T15:10:35.993

这是问题的变体，请参阅： -[灵活设计 iPhone 应用程序布局是否重要？](https://stackoverflow.com/questions/852881/is-it-important-to-design-iphone-app-layouts-flexible/853032#853032)

**Apple 在 UICatalog SDK 示例中提供了控件的大小。请参阅常量.h。**

关于是否应该以这种方式生成应用程序大小的意见存在分歧。目前它是安全的，因为没有其他尺寸不同的设备。我认为我们会收到有关其他设备和屏幕尺寸的警告，以修复任何所需的更改。

托尼

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T16:42:02.320

UICatalog 示例的 Constants.h 文件包含以下信息：

```
// these are the various screen placement constants used across all the UIViewControllers

// padding for margins
#define kLeftMargin             20.0
#define kTopMargin              20.0
#define kRightMargin            20.0
#define kBottomMargin           20.0
#define kTweenMargin            10.0

// control dimensions
#define kStdButtonWidth         106.0
#define kStdButtonHeight        40.0
#define kSegmentedControlHeight 40.0
#define kPageControlHeight      20.0
#define kPageControlWidth       160.0
#define kSliderHeight           7.0
#define kSwitchButtonWidth      94.0
#define kSwitchButtonHeight     27.0
#define kTextFieldHeight        30.0
#define kSearchBarHeight        40.0
#define kLabelHeight            20.0
#define kProgressIndicatorSize  40.0
#define kToolbarHeight          40.0
#define kUIProgressBarWidth     160.0
#define kUIProgressBarHeight    24.0

// specific font metrics used in our text fields and text views
#define kFontName               @"Arial"
#define kTextFieldFontSize      18.0
#define kTextViewFontSize       18.0

// UITableView row heights
#define kUIRowHeight            50.0
#define kUIRowLabelHeight       22.0

// table view cell content offsets
#define kCellLeftOffset         8.0
#define kCellTopOffset          12.0 
```

# coldfusion - ColdFusion：从同一组件调用 cffunction

> ID：858354
> 
> 赞同：4
> 
> 时间：2009-05-13T14:40:00.600
> 
> 标签：coldfusion, functional-programming, composition

这个问题可能很幼稚，因为我是 ColdFusion 编程的新手。

我有一个任务，我`f1`在组件内编写了一个函数。我想从同一个组件中定义的`f1`另一个函数调用。`f2`

`f2`在 cfm 文件中被调用。

我的问题 - 这是正确的方法吗？我可以调用`f1`from`f2`吗？

我也可以合并`f1`到`f2`中，但我想保留`f1`为一个单独的函数。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-13T14:54:09.670

是的，如果两个函数都属于同一个组件，您可以在 ColdFusion 中从 f2 调用 f1。（它们不必在同一个组件中，但如果是，答案总是肯定的。）

```
 <cffunction name="f2">
    ...
    <cfset result_of_f1 = f1()>
    ...
 </cffunction>

 <cffunction name="f1">
    ...
 </cffunction> 
```

从另一个函数调用一个函数有很多很好的理由。它被称为[函数组合](http://en.wikipedia.org/wiki/Function_composition_(computer_science))。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-08T03:18:04.653

在 Coldfusion 10 和 Railo 4 中，您可以使用[Underscore.cfc 库](http://russplaysguitar.github.com/UnderscoreCF/#compose)创建组合函数：

```
_ = new Underscore();// instantiate the library

f1 = function (message) {
   return "hello " & message;
};

f2 = function (toOutput) {
   writeOutput(toOutput);
};

sayHelloTo = _.compose(f2, f1);

sayHelloTo("world!");// output: "hello world!" 
```

（注：我写了 Underscore.cfc 库）

# php - 通过 PHP 检测具有代理服务器的客户端

> ID：858357
> 
> 赞同：26
> 
> 时间：2009-05-13T14:40:05.827
> 
> 标签：php, proxy

我正在寻找一种方法或方法来检测使用任何类型的代理服务器查看我的网站的客户端。我正在使用 PHP/Apache ... 最好的方法是什么？需要检测任何代理服务器，而不是具体的一个或另一个。

**编辑**

我对匿名代理更感兴趣......因为正常的代理很容易通过查找来检测`HTTP_X_FORWARDED_FOR`。

**另一个编辑**

尝试这个：

1) 访问[http://kproxy.com](http://kproxy.com)（或任何其他免费匿名代理网站）

2) 访问：[http ://www.worldofwarcraft.com](http://www.worldofwarcraft.com)

3）他们能够以某种方式阻止，因为页面错误“加载样式表时出错：加载XSLT样式表时发生网络错误：http: [//kproxy.com/new-hp/layout/layout.xsl](http://kproxy.com/new-hp/layout/layout.xsl) ”

我想做类似的事情来防止代理。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2012-02-12T18:02:41.973

在 PHP 中使用以下 2 个解决方案。// 方法 1 = 快速但不适用于匿名代理

```
 $proxy_headers = array(
        'HTTP_VIA',
        'HTTP_X_FORWARDED_FOR',
        'HTTP_FORWARDED_FOR',
        'HTTP_X_FORWARDED',
        'HTTP_FORWARDED',
        'HTTP_CLIENT_IP',
        'HTTP_FORWARDED_FOR_IP',
        'VIA',
        'X_FORWARDED_FOR',
        'FORWARDED_FOR',
        'X_FORWARDED',
        'FORWARDED',
        'CLIENT_IP',
        'FORWARDED_FOR_IP',
        'HTTP_PROXY_CONNECTION'
    );
    foreach($proxy_headers as $x){
        if (isset($_SERVER[$x])) die("You are using a proxy!");
    } 
```

// 方法 2 = 端口扫描返回到使用的正常代理端口的原始 IP。

```
 $ports = array(8080,80,81,1080,6588,8000,3128,553,554,4480);
    foreach($ports as $port) {
         if (@fsockopen($_SERVER['REMOTE_ADDR'], $port, $errno, $errstr, 30)) {
              die("You are using a proxy!");
         }
     } 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-05-13T14:44:55.943

您无法检测到这一点，除非他们传递了明确提及它的特殊标头，例如 X-Forwarded-For 或其他东西。

据我所知，您必须使用黑名单。使用 putty 端口转发、VPN 或其他更复杂方法的用户是不可检测的，因为他们的行为与普通用户完全一样。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-05-13T22:43:32.870

[Metasploit](http://decloak.net/)使用许多不同的技术来强制客户端的系统进行直接连接（Flash、Java、QuickTime、MS Office、自定义 DNS 服务器中的漏洞/错误功能）。

或者，如果您无法让客户端的浏览器启动 metasploit，您可以尝试查找开放代理（端口扫描）和[已知的 Tor 出口节点](https://www.torproject.org/tordnsel/)。

*但是请不要认为代理是邪恶的并且需要被阻止——有很多合法的代理并且一些用户必须使用它们。*

*如果您在垃圾邮件或其他滥用流量方面遇到问题，那么仅仅阻止代理将无济于事。您应该寻找解决问题核心的特定解决方案（垃圾邮件过滤器、IDS），而不是假设匿名 = 有罪。*

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2015-08-09T08:00:59.407

有各种付费/免费解决方案。他们中的大多数人查看尝试连接的客户端 IP 以确定他们是否在代理上。

付费：
[Maxmind](http://dev.maxmind.com/proxy-detection/) - 他们专注于欺诈检测，并有一个代理检测子类别。请注意，这现在被视为“遗留”服务。

免费：
[WITCH](https://medium.com/@ValdikSS/detecting-vpn-and-its-configuration-and-proxy-users-on-the-server-side-1bcc59742413) - 能够通过查看唯一可识别的 MSS 值来检测 OpenVPN。代码可在 github 上找到。

[GetIpIntel](http://getipintel.net) - 使用机器学习的代理 / VPN 检测，通过 API 查询。

[安全堆栈交换上](https://security.stackexchange.com/a/32727/81328)列出了更多免费选项。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-13T14:50:53.610

客户端传递给服务器的所有内容都可以自行配置。除了 IP 地址，您不能信任任何东西。因此，您无法检查标头数据，无论它是代理还是普通客户端。
顺便说一句：代理的目的是不显示自己是代理:)

当然，您可以获取请求者的 IP 地址并发送您将发送到代理的 http 请求。如果它有反应，它可能是一个代理，否则它是一个普通的客户端。这种方法将非常昂贵且不可靠。如果您的服务器请求的代理位于防火墙后面，您将得不到任何答复并认为它是普通客户端。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-13T15:05:17.143

我认为这里发生的事情是一些客户端 JavaScript 正在尝试加载某些内容，并且可以“看到”页面正在框架内被查看。这可能是一个更有成效的探索途径——正如其他答案所表明的那样，代理故意使仅从服务器很难确定。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-05-17T20:50:54.237

老话题，但我可能已经想通了。

它在我的网站上运行，我认为它可能适用于大多数情况。

我的问题是被禁止的用户回到我的网站并使用您可以找到的众多代理之一使用新的电子邮件地址重新注册。我所做的是在注册/登录表单上进行简单的 jQuery 调用：

```
<form id="login_form" method="post" action="/#fake_login_url">
   stuff you need for the form
</form>
<script>
   $('#login_form').attr('action','real_login_form');
</script> 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2018-08-25T16:26:22.400

即使这是一个老问题，我也不得不检查代理，不幸的是，没有一个答案能给出好的结果。

经过搜索，我找到了更好的方法。为了理解这种做法，只需使用以下代码创建一个小页面：

```
 <?php
 foreach ($_SERVER as $key => $val)
 {
     echo $key."<br>\n";  
 }
 ?> 
```

从您的服务器直接运行它。您将看到服务器发送的标头中的所有密钥。然后通过代理运行相同的脚本。您将看到（取决于代理）3 个可能的结果：

1.  代理添加新闻键/值
2.  代理不会发送所有原始键/值，因此有些丢失。
3.  代理发送完全相同的键/值，但顺序不同
4.  代理以相同的顺序发送完全相同的键/值

第四种情况可能发生，但其他情况最常见。因此，您只需使用服务器中的键/值创建一个数组（基于在没有代理的情况下运行脚本时的结果）并比较 $_SERVER 中的键/值。如果您没有完全相同的键/值（更少、更多或其他顺序），您可以假设页面来自代理。

请注意，我同意在某些情况下代理可以在“合法”中使用的说法。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2017-07-18T03:38:07.550

我觉得回答一个 8 岁的帖子没用，但我还是会回答以供将来参考。
我不了解代理，但大多数 VPN（如果您使用它们）会带来某种错误页面。如果你做了类似...

```
$cont = file_get_contents($_SERVER["REMOTE_ADDR"]); //the users ip
$errormsg = "nginx";
if(strpos($cont, $errormsg)){
    die("No VPN's or Proxies Allowed");
} 
```

这是非常基本的，您可以获得一组错误消息并这样做。
如果用户转发了他们的 80 端口，这将不起作用，但我不明白为什么普通人会这样做。

* * *

## 回答 #10

> 赞同：-5
> 
> 时间：2011-06-27T08:11:56.317

我正在使用以下内容，但我不确定它是否每次都有效。这只是一个想法:)

```
<?php
$host = gethostbyaddr($_SERVER['REMOTE_ADDR']);
if ($host != $_SERVER['REMOTE_ADDR']) die('Proxy detected.');
?> 
```

# language-agnostic - 实施检查新版本的非常简单的更新程序的建议

> ID：858364
> 
> 赞同：3
> 
> 时间：2009-05-13T14:40:29.147
> 
> 标签：language-agnostic, desktop-application

我想为我的应用程序添加一个非常简单的自动更新程序。我想从最简单的事情开始。

关于如何做到这一点的任何建议？对以下选项有任何改进（或替代方案）的建议吗？

这是我正在考虑的一种选择。

1.  应用程序显示一个表格，提供检查新版本，并可选择每 X 天再次检查一次。
2.  如果用户单击“立即检查”，则会启动一个网页 *www.mysite.com/CheckNewVersion.asp?AppID=<>?AppVersion=<>*
3.  ASP 脚本包含所有程序 ID 和当前可用版本的列表。然后，IT 会向他们显示“没有可用的新版本”或“具有 XYZ 功能/修复的新版本”的页面（以及“免费更新”或“在此付费”）。

这提供了自动更新 80% 的好处，而成本仅为 10%。如果没有人点击自动更新（我怀疑这是一种可能性，因为人们不想被打扰），那么让它变得更简单是没有意义的。没有办法让它变得如此简单，以至于他们不必至少单击“更新”按钮。

顺便说一句，我确实意识到在 SO 上有一个类似的问题，但没有讨论实现细节。它似乎更具理论性，旨在提供更复杂的解决方案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T14:55:28.780

我的建议（在我自己构建了一些之后）是从一个稍微不同的系统开始。让您的应用程序通过查看服务器上的静态 XML 文件在内部运行检查，例如：/AppVersion_[AppID].xml 该 xml 文件仅描述当前的公共版本以及当前的构建/版本号，可能还有时间戳和完整路径到最新的二进制文件以及 MD5 校验和。这将减少一开始的大量工作和复杂性。

您的应用程序只需提取此 XML 文件并将文件中的版本信息与其当前版本进行比较。如果它较新，您可以弹出一个友好的对话框，要求用户升级。

如果用户确实想要升级，请从 XML 文件的路径中下载安装程序二进制文件，检查 MD5 校验和，然后使用 shell 执行启动它。这使用户不必下载您的文件，并确保文件下载没有任何问题。

我建议从 VB6 升级到 VB.NET，原因如下：

1) .NET BCL 中称为 WebClient 的神奇控件，它使获取 URL 的字符串内容就像单行调用一样简单。此外，WebClient 将在一次调用中将文件下载到指定的磁盘位置。

2) 内置的 XML 支持非常棒。

下面是一些基本的 VB.NET 代码，可帮助您开始下载并运行您的软件产品之一：

```
Dim TargetRemoteSetupFile As String = "http://www.bungalowsoftware.com/downloads.asp?programlist=/download/aphasia_tutor_1_and_2_outloud_install.exe"
Dim LocalDownloadPath As String = System.IO.Path.Combine(System.IO.Path.GetTempPath(), "BungalowSoftwareInstall.exe")

Dim FileDownloaderWebClient As New System.Net.WebClient()

Try
   FileDownloaderWebClient.DownloadFile(TargetRemoteSetupFile, LocalDownloadPath)
Catch ex As Exception
   System.Diagnostics.Debugger.Break()
   '...
Finally
   FileDownloaderWebClient.Dispose()
End Try

System.Diagnostics.Process.Start(LocalDownloadPath) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T14:55:00.793

在 Mac OS X 中，Sparkle 框架在用于自动更新的应用程序中非常流行。它的工作原理有点像这样：

用户第一次启动应用程序时，它会询问是否自动检查更新（有时检查之间的间隔）。当用户说他们想检查更新时，应用程序通常会在启动时检查更新，但每天不超过一次。

在服务器上，有一个 XML 文件或脚本生成这样的文件，其中包含可用的软件版本以及每个版本的简短摘要或变更日志。当没有可用的更新时，应用程序*什么也不*做。根本不会通知用户。

当有可用更新时，应用程序会提示：“有可用更新”以及新版本号、更改日志和以下按钮：“更新”和“跳过此版本”。

当然，这些按钮是不言自明的。

# windows - 如何获得最小化窗口的恢复边界？

> ID：858369
> 
> 赞同：1
> 
> 时间：2009-05-13T14:40:53.250
> 
> 标签：windows, interop, user32

很容易获得屏幕上所有可见窗口的边界矩形。判断任何窗口是否具有标志性也很容易。

但是对于最小化的窗口，从 User32.GetWindowInfo.rcWindow 报告的 Top 和 Left 为 -32000。我查看了整个 API，找不到返回如果单击或切换到窗口将恢复到的边界的调用。

感谢您的任何指示。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T14:48:41.617

查看 User32.GetWindowPlacement

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T14:53:26.677

对于 C/C++：

```
WINDOWPLACEMENT wp;
::ZeroMemory(&wp, sizeof(WINDOWPLACEMENT));
::GetWindowPlacement(hWnd, &wp); 
```

# c# - 无法加载外部资源字典

> ID：858381
> 
> 赞同：0
> 
> 时间：2009-05-13T14:42:51.827
> 
> 标签：c#, .net, wpf, xaml

我正在尝试使用以下代码加载外部 XAML 文件：

```
<Application.Resources>
    <ResourceDictionary>
        <ResourceDictionary.MergedDictionaries>
            <ResourceDictionary Source="pack://application:,,,/OfficeStyle;component/OfficeStyleWindow.xaml" />
        </ResourceDictionary.MergedDictionaries>
    </ResourceDictionary>
</Application.Resources> 
```

在“OfficeStyle”DLL 上打开反射器给出：

[替代文字 http://robbertdam.nl/share/p3.png](http://robbertdam.nl/share/p3.png)

运行应用程序会出现此错误：

[替代文字 http://robbertdam.nl/share/p4.png](http://robbertdam.nl/share/p4.png)

弹出错误和我在本文开头放置的 XAML 代码。我错过了什么？我尝试加载的 XAML 文件包含一堆样式等。我想在我的应用程序中重用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T22:24:53.757

您的 OfficeStyleWindow.xaml 文件的构建操作是什么？它应该是 Page，而不是 EmbeddedResource

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T15:41:04.447

尝试将文件夹名称添加到包路径。

pack://application:,,,/OfficeStyle;component/Resources/OfficeStyleWindow.xaml

# javascript - 子窗口更改父位置时的客户端事件？

> ID：858382
> 
> 赞同：2
> 
> 时间：2009-05-13T14:42:55.713
> 
> 标签：javascript, dom, popup, client-side

好的，这是交易：

目前，我们有一个调用弹出窗口的页面，并且该弹出窗口中有一个链接，可将父页面重定向到另一个位置。这一切都很好。

当前：产品页面 <--> 弹出窗口

但是，我正在创建一个新功能，其中主页调用一个新的子窗口以获取产品详细信息。然后该产品详细信息页面具有指向上述弹出窗口的链接。问题是弹出窗口现在将子窗口视为其父窗口，并且重定向发生在那里而不是在主浏览器窗口中。

开发：主站点-->儿童产品详细信息<-->弹出窗口

在重定向发生之前，我是否可以在产品详细信息子项中捕获一个事件，以便我可以将其传递到下一个级别？

TIA

凯文

编辑：发现这个：

[http://www.bennadel.com/blog/1520-Binding-Events-To-Non-DOM-Objects-With-jQuery.htm](http://www.bennadel.com/blog/1520-Binding-Events-To-Non-DOM-Objects-With-jQuery.htm)

但这只是在位置更改**后通知您...**

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-13T17:05:07.150

这就是我最终做的...

```
function smartRedirect(newlocation)
{
    if (window.opener == window.opener.parent)
    {
        // main window opened us...
        window.opener.location.href = newlocation;
    }
    else
    {
        // must have been a child window... so change parent, then close this one...
        window.opener.parent.location.href = newlocation;

        // this is needed because when the child window/frame is killed,
        // window.opener becomes null.
        self.close();
    }
} 
```

# c# - 如何将一个数据表附加到另一个数据表

> ID：858401
> 
> 赞同：51
> 
> 时间：2009-05-13T14:45:31.120
> 
> 标签：c#, .net, vb.net, datatable

我想将一个 DataTable 附加到另一个 DataTable。我看到 DataTable 类有两种方法；“加载（IDataReader）”和“合并（DataTable）”。从文档中，如果存在行，两者似乎都将传入数据与现有 DataTable '合并'。我将在数据访问层中进行合并。

我可以使用`IDataReader`并使用 Load 方法来合并 DataTables。或者我可以使用 加载`IDataReader`数据集，从数据集中获取数据表，然后使用 Merge 方法合并数据表。

我想知道是否有人可以告诉我使用哪种方法合适？

或者，如果您对如何完成此任务有不同的建议，请告诉我。

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2013-05-17T20:42:14.800

同一列名称中的数据类型必须相等。

```
dataTable1.Merge(dataTable2); 
```

之后的结果是：

数据表 1 = 数据表 1 + 数据表 2

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2009-05-13T14:57:23.597

Merge 需要一个 DataTable，Load 需要一个 IDataReader - 因此，根据您的数据层允许您访问的内容，使用所需的方法。我的理解是 Load 会在内部调用 Merge，但不能 100% 确定这一点。

如果您有两个数据表，请使用合并。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-05-13T23:35:33.453

你可以让你`DataAdapter`的工作。 `DataAdapter.Fill(DataTable)`会将您的新行附加到`DataTable`.

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2015-09-22T15:55:40.450

添加两个包含数据表的数据集，现在它将根据需要合并

```
DataSet ds1 = new DataSet();
DataSet ds2 = new DataSet();

DataTable dt1 = new DataTable();
dt1.Columns.Add(new DataColumn("Column1", typeof(System.String)));

DataRow newSelRow1 = dt1.NewRow();
newSelRow1["Column1"] = "Select";
dt1.Rows.Add(newSelRow1);

DataTable dt2 = new DataTable();
dt2.Columns.Add(new DataColumn("Column1", typeof(System.String)));

DataRow newSelRow2 = dt1.NewRow();
newSelRow2["Column1"] = "DataRow1Data";  // Data
dt2.Rows.Add(newSelRow2);

ds1.Tables.Add(dt1);
ds2.Tables.Add(dt2);

ds1.Tables[0].Merge(ds2.Tables[0]); 
```

现在 ds1 将拥有合并的数据

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2019-01-08T21:07:39.200

考虑一个可以巧妙地处理任意多表的解决方案。

```
//ASSUMPTION: All tables must have the same columns
var tables = new List<DataTable>();
tables.Add(oneTableToRuleThemAll);
tables.Add(oneTableToFindThem);
tables.Add(oneTableToBringThemAll);
tables.Add(andInTheDarknessBindThem);
//Or in the real world, you might be getting a collection of tables from some abstracted data source.

//behold, a table too great and terrible to imagine
var theOneTable = tables.SelectMany(dt => dt.AsEnumerable()).CopyToDataTable(); 
```

封装成一个助手以供将来重用：

```
public static DataTable CombineDataTables(params DataTable[] args)
{
    return args.SelectMany(dt => dt.AsEnumerable()).CopyToDataTable();
} 
```

只是在代码中声明了几个表？

```
var combined = CombineDataTables(dt1,dt2,dt3); 
```

想要合并到现有表之一而不是创建一个新表？

```
dt1 = CombineDataTables(dt1,dt2,dt3); 
```

已经有一个表的集合，而不是一个一个地声明？

```
//Pretend variable tables already exists
var tables = new[] { dt1, dt2, dt3 };
var combined = CombineDataTables(tables); 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2018-10-20T12:29:51.923

使用循环

```
 for (int i = 0; i < dt1.Rows.Count; i++)
        {      
           dt2.Rows.Add(dt1.Rows[i][0], dt1.Rows[i][1], ...);//you have to insert all Columns...
        } 
```

# architecture - 自上而下与自下而上的设计方法

> ID：858402
> 
> 赞同：6
> 
> 时间：2009-05-13T14:45:31.650
> 
> 标签：architecture

> **重复**：[设计和编码 - 从上到下还是从下到上？](https://stackoverflow.com/questions/130933/design-coding-top-to-bottom-or-bottom-to-top)

我想我在最近的经历中发现，我设计软件的方式与大多数同龄人不同。在收集到足够多的需求以对软件中的组件有一个高层次的了解后，我倾向于采用增量自下而上的方法。

所以，在设计一个支持多个具体类的接口的情况下......我会看看每个特定的具体候选者的共同点，询问我如何为每个具体完成工作（同时考虑要健壮用于未来的混凝土）。然后我利用这组共性并制作一个界面，我认为这是一种“自下而上”的方法。

在自顶向下方法的情况下，我相信设计者会查看接口的客户端以及客户端如何与接口交互，然后尝试实现具体的类。

所以我可以看到自上而下/自下而上的优缺点。我只是想知道根据您以前的经验哪个更有效并且提供更好的结果？

注意：我不是在谈论开发方法（敏捷、瀑布等），而是在谈论设计方法。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-05-13T14:54:04.883

我相信，对于优秀的软件设计师（在我看来，所有软件开发人员在某种程度上也应该是软件设计师），其神奇之处在于能够同时进行自上而下和自下而上的工作。

我的导师“教育”我做的是从非常简短的自上而下开始了解所涉及的实体，然后转向自下而上找出我想要创建的基本元素，然后备份并看看我是如何可以向下一层，知道我对自下而上的结果的了解，依此类推，直到“他们在中间相遇”。

希望有帮助。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-13T14:54:28.860

这取决于问题。

如果您知道问题是什么[允许客户查看在线银行对帐单]，以及如何解决问题，请使用自下而上的方法。分析每个步骤，按区域将它们组合在一起并制定解决方案。基于项目计划。

如果您对问题有一个模糊的概念[允许现场代理通过分布式离线/在线 wiki 进行通信]，那么自上而下的方法会更好。查看所有问题以及可以使用哪些步骤来解决它们。反复试验。敏捷。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-13T14:55:16.207

设计软件没有完美的方法。没有任何方法可以保证完美的设计。

在为它设计解决方案时，你必须以不同的方式看待问题，当你有一个设计时，你也应该以不同的方式看待它。如果你从顶部接近它，你将不会想出与从底部接近它相同的设计。所以两者都做，并选择两种方法给你的优势。

从最高级别了解问题并逐步解决解决方案，确定细节可能最终改变设计的部分（您应该从最低级别处理细节并按照自己的方式工作）。不断迭代问题的所有组成部分，直到你有一个足够好的设计来使用。

[Code Complete](http://cc2e.com/)第 5 章可以真正帮助敲定我在这里所说的细节。我建议你看看。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-13T14:55:25.100

我不确定我是否正确理解了您的问题，但是如果我理解了，那么您是在询问构建应用程序的优缺点，然后是界面与构建界面然后构建应用程序以使其真正发挥作用。

我想说大部分答案取决于您*为谁*开发/设计。您的目标是为用户提供一个很酷且（也许）有用的应用程序吗？从用户界面开始。或者您是否正在尝试构建与业务系统（可能已经存在）的接口，或者完成已经以其他（效率较低）方式执行的任务？从任务开始。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-13T14:55:40.853

自下而上是我们很多人的代码。不是通过选择，而是通过智能感知。[Petzold在这里](http://charlespetzold.com/etc/DoesVisualStudioRotTheMind.html)写了一篇关于此的文章。

在实践中，我认为您会发现大多数建筑师都是这样设计的。我个人认为我从未见过有人以相反的方式进行设计（具体到抽象）。

当然，需求是具体的，但通常使用需求来指导抽象并定义软件的目的和意图。

# c# - 从表达式访问值

> ID：858413
> 
> 赞同：0
> 
> 时间：2009-05-13T14:46:25.660
> 
> 标签：c#, linq, lambda

```
public Method1(Expression<Func<T, TProperty>> valueToCompare) {
    //Examine expression
}

public Method1(TProperty valueToCompare) : this(x => valueToCompare) {} 
```

我像这样运行它们

```
Method1(x => 1); 
```

和

```
Method1(1); 
```

如果我在调用第一个重载时检查表达式，那么我会得到一个常量表达式。但是，当我检查第二个时，我得到一个成员表达式。

问题是无论我调用哪个重载，我如何才能访问值“1”。

**Update1：** ​​我曾经这样做，直到我意识到两者都没有返回相同的东西。

```
if (valueToCompare.Body.NodeType == ExpressionType.Constant)
{
    var constant = valueToCompare.Body as ConstantExpression;
    ValueToCompare = constant != null ? (TProperty)constant.Value : default(TProperty);
} 
```

如果我编译它会得到什么？

试图这样做，但没有奏效。

```
if (ValueToCompare .Body.NodeType == ExpressionType.MemberAccess) {
   var member = ValueToCompare .Body as MemberExpression;
   if (member.Expression.NodeType == ExpressionType.Constant)
   {
       ConstantExpression constant = member.Expression as ConstantExpression;
       ValueToCompare = constant.Value;
   }
} 
```

干杯。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T14:50:50.973

您是否很高兴只编译表达式并运行它？这对我来说似乎是最简单的解决方案......

或者，您可以使您的重载采用`TProperty`显式构造一个常量表达式，而不是使用 lambda 表达式。这实际上取决于您要实现的目标。

作为后一种方法的示例，您可以编写类似（未经测试）的内容：

```
public void Method1(TProperty valueToCompare) : this(x => valueToCompare)
{
     Expression constant = Expression.Constant(valueToCompare,
                                               typeof(TProperty));
     ParameterExpression parameter = Expression.Parameter(typeof(T),
                                                          "t");
     Expression lambda = Expression.Lambda<Func<T, TProperty>> (constant,
                                                                parameter);
     Method1(lambda);
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T15:00:55.247

> 问题是无论我调用哪个重载，我如何才能访问值“1”。

你没有，正如你所发现的那样。并非没有编译和执行表达式树以产生其值。

请记住，表达式树的**目的是****捕获有关表达式的编译时信息并在运行时呈现它**，而不是**评估表达式产生的运行时值**。

在您的示例中，您有两个不同的表达式——一个是常量，一个是闭包的外部变量。外部变量由字段表示，因此您将获得字段访问表达式。**您获得的表达式树表示您放入 lambda 中的表达式。**

也许你可以描述你真正想做的事情；可能有更好的方法。如果你想要的是*value*，你为什么需要一个表达式树呢？

# c - 可以有效地按值传递多大的结构？

> ID：858424
> 
> 赞同：9
> 
> 时间：2009-05-13T14:47:34.363
> 
> 标签：c, performance, optimization, struct, pointers

经验法则是可以按值传递小结构，而较大的结构应该做指针。

我的问题是这个截止点到底在哪里？在您最好通过指针传递它们之前，结构可以有多大。

我知道这会因平台而异，但我认为可以给出一些粗略的估计。一两年前，我试图在 PPC 架构上弄清楚这一点，令我惊讶的是，一个人可以通过价值有效地传递大量数据。由于 PPC 中有大量寄存器，因此认为 10 个双精度值左右就可以了。通过指针实际上涉及更多的内存复制。

但是我现在在英特尔上，我希望事情可能会有所不同。由于传统上 CPU 没有那么多寄存器，但在 64 位或浮点寄存器上可能有所不同？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-14T10:44:45.450

好的，所以我尝试遵循建议并使用指针和值来分析我的代码。我还查看了汇编代码。x86 上的性能特征似乎与 PPC 有很大不同。在 PPC 上，C 的二进制接口指定将参数放入寄存器（有很多可供选择），但似乎即使在 64 位 x86 上也需要将参数放入堆栈中。

这就解释了为什么在 x86 上通过指针传递似乎总是更快。但是我注意到编译器非常渴望内联。因此，我以哪种方式做到这一点并不重要。所以我想结论是使用任何对你方便的传递。

我认为好处是通过价值传递的，因为处理价值的副本更安全一些。我的测试用例是一个由 4 个双精度组成的结构（所以我猜在大多数平台上它是 32 个字节）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T15:20:39.863

如果您在网上搜索，您会发现一些关于通过引用和值传递的字节大小的指南。我几乎不相信它。**知道**特定结构是问题的唯一方法是

> 剖析它

这是 100% 知道存在问题的唯一方法。

在反对者加入之前。是的，那里有一些明显的案例。例如，如果它有 100 个成员，我不会按值传递一个结构。但这不是性能问题，而是堆栈空间问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-13T18:51:23.310

在 C++ 中，有一条规则是传递不在以下列表中的*所有*`const`内容作为参考，因为性能基本上永远不会变差。例外列表如下：

*   基本类型（`int`等），
*   指针，
*   空类型（标签类型），
*   类函数类型（函子），以及
*   迭代器。

我不确定这是否可以直接应用于 C（除了 C 没有的明显类型），但可能适用类似的准则。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-13T18:43:44.430

一些编译器可能会为您确定最佳大小。如果我没记错的话，如果结构超过一定大小，TI28xx 编译器会自动将按值传递转换为按引用传递。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-13T16:01:29.187

不要忽视对齐在测试中的作用。如果您传递浮点数或双精度数并且您的结构未在适当的边界上对齐，则处理器可能最终会获取您的部分值，对其进行移位，然后在存储之前将其余部分进行 OR 运算。我认为大多数现代编译器都会 DTRT（通过在声明结构时对齐结构），但如果您正在优化空间，那么这可能是一个问题。

嗯，现在我想起来了，对此持保留态度，因为自从 Pentium Pro 以来，我还没有在 x86 架构上进行任何低级编码......

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-05-13T19:03:35.630

通常我通过值传递原始类型，通过引用传递其他所有内容。这是我的经验法则。

# c# - Sharepoint Web 部件 POST

> ID：858425
> 
> 赞同：0
> 
> 时间：2009-05-13T14:47:38.450
> 
> 标签：c#, .net, sharepoint, http, post

通过将参数添加到 URL 中，可以轻松创建使用 GET 传递参数的超链接：

http:\somesite.com?name=fred

但我要连接的网络服务使用 POST。在 Sharepoint 中执行此操作的最佳方法是什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-14T11:00:36.067

好的，我并不惊讶没有答案。我怀疑我可能以错误的方式处理这个问题并且没有很好地解释它。

我想将用户的浏览器带到传递 POST 数据的不同页面，就像 HTML 表单一样。但是在sharepoint中你不能改变'action='——你只能发回同一个页面——如果我正确理解了页面生命周期位。

我将尝试向 Web 部件添加一个按钮，并使用它的 onclick() 来执行 HTTP Web 请求。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T04:34:10.730

如果您需要以不同的方式发布数据，向页面添加第二个表单元素应该可以。它需要位于 SharePoint 表单之外，但使用 javascript/jQuery 在外部添加另一个元素很容易。

# php - 是否可以在 php.ini 中使用环境变量？

> ID：858431
> 
> 赞同：20
> 
> 时间：2009-05-13T14:48:31.880
> 
> 标签：php, configuration, environment-variables

我不想在我的 php.ini 配置中硬连线某些路径，而是想使用在其他一些地方（例如我的 Apache 配置）共享的系统变量来配置它们。我进行了一些搜索，但找不到合适的关键字组合来发现是否有办法做到这一点。

有谁知道这是否可以做到？

```
upload_tmp_dir = $SCRATCH_HOME/uploads 
```

现在 SCRATCH_HOME 可以在环境中导出为 /tmp 或 /var/scratch 或任何我想要的。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2012-05-13T09:43:15.657

正式记录：[https ://www.php.net/manual/en/configuration.file.php#example-36](https://www.php.net/manual/en/configuration.file.php#example-36)

在开始之前，我只想指定我的配置：我使用的是 Windows 7-64 位、PHP 5.4.3、Apache HTTP Server 2.2.x，我已经设置了我的环境变量`PHP_HOME=C:\tools\php-5.4.3`（PHP 安装目录）。我在我的`httpd.conf`和`php.ini`文件中使用变量

注意：为简洁起见，我将省略一些文本。

在`httpd.conf`文件中

```
# For PHP 5 do something like this:
LoadModule php5_module "${PHP_HOME}/php5apache2_2.dll"
AddType application/x-httpd-php .php

# configure the path to php.ini
PHPIniDir "${PHP_HOME}" 
```

在`php.ini`文件中

```
; Directory in which the loadable extensions (modules) reside.
; http://php.net/extension-dir
; extension_dir = "./"
; On windows:
extension_dir = "${PHP_HOME}/ext" 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2013-08-26T18:47:15.873

根据[PHP 文档](http://php.net/manual/en/configuration.file.php)，环境变量确实可以在配置文件中使用。

![带有 URL 的 php 文档的屏幕截图以及有关 PHP.ini 中允许使用 envvars 的注释](https://i.stack.imgur.com/MMSec.png)

它没有说明使用什么语法，但它与使用 *nix 语法的 Apache 配置文件相同。因此，例如，如果您希望 PHP 使用系统临时目录，您可以使用：

```
upload_tmp_dir = ${Temp} 
```

您可以使用以下脚本确认它是否处于活动状态：

```
<?php
    echo "ini:  " . ini_get('upload_tmp_dir') . "\n";
    echo "env:  " . sys_get_temp_dir()        . "\n";
    echo "temp: " . getenv('temp')            . "\n";
    echo "tmp:  " . getenv('tmp')             . "\n";
?> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2019-11-07T09:31:48.270

您可以使用它，而且它现在有据可查：

[https://www.php.net/manual/en/configuration.file.php#example-36](https://www.php.net/manual/en/configuration.file.php#example-36)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-13T15:35:28.637

尝试通过[Apache 配置文件](http://us2.php.net/configuration.changes#configuration.changes.apache)配置 PHP ：

```
PHP_admin_value upload_tmp_dir $SCRATCH_HOME/uploads 
```

对我来说很好。（psst，您不能`upload_tmp_dir`使用 .htaccess 进行更改）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-08-17T14:02:06.553

补充@Synetec 答案，如果您的变量是自定义 php.ini 变量（由您创建，而不是官方的 PHP ini 指令） ，请使用[get_cfg_var( ) 。](https://www.php.net/manual/en/function.get-cfg-var.php)例如：

在 php.ini 中：`custom_variable = "abcde"`
在任何 php 脚本中：`get_cfg_var('custom_variable')`返回`abcde`

我在本地开发人员的一个小项目中使用它。当我通过`php -S localhost:8000 -c php.ini`（不在本地运行 Apache 服务器）运行本地服务器时，调用一些配置常量是一个不错的选择。在生产中，这些常量设置在`.htaccess`.

# asp.net-mvc - 如何显示包含html标签的内容？

> ID：858432
> 
> 赞同：0
> 
> 时间：2009-05-13T14:48:36.543
> 
> 标签：asp.net-mvc

我在 asp.net mvc 应用程序的 Create.aspx 页面中使用 FckEditor。

由于我需要在网页中显示富文本，因此我在控制器类中的操作方法顶部使用了 ValidateInput(false) 属性。

我在 Details.aspx 中使用了 Html.Encode(Model.Message) 来保护用户的攻击。

但是，我得到了我不想要的结果如下：

> `<p> Hello </p>`

我想要以下结果不高于：

> `Hello`

如何显示用户输入的文本？

提前致谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-13T15:08:05.093

似乎用户输入了`"<p> Hello </p>"`（由于按 Enter？）到编辑控件中，并且它在 HTML 中显示正确，因为您已经完成了 Html.Encode。例如，paragrahs 没有被渲染，它们被输出为`"<p>..</p>"`字符串被 HTML 编码成类似`"&lt;p&gt; Hello &lt;p&gt;"`.

如果您不想要标签，我建议在文本字符串中搜索标签（带有 的东西`<...>`）并将它们从输入的文本中删除。在 HTML.Encode 之前执行此操作。

...还是我错过了什么？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T15:13:08.347

您可以使用[HttpServerUtility.HtmlEncode(String)](http://msdn.microsoft.com/en-us/library/w3te6wfz.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T15:14:45.800

简短的回答是 HTMLEncode 正在使您的标记显示为这样。如果您不进行 HTMLEncode，它将执行您想要的操作。

您需要考虑是否需要完全控制标记、输入标记的人员以及是否可以选择像 BBCode 这样的替代方案。

如果您使用编辑器的用户都肯定是“安全”用户，那么 XSS 不太可能成为问题。但是，如果您在评论字段上使用它，那么 BBCode 或类似 SO 本身使用的东西更合适。

您将无法使用 WYSIWYG 编辑器并执行 HTMLEncode...（没有 BBCode 或其他一些令牌系统）

# c# - Web 服务类中的 ToString()

> ID：858435
> 
> 赞同：1
> 
> 时间：2009-05-13T14:48:51.583
> 
> 标签：c#, web-services, tostring

我已经`ToString()`在我的 Web 服务中为我的类实现了一个覆盖方法，并`List<myObject>()`在消费者的函数中返回了一个。如果我这样做，`.ToString()`它会返回对象类型。我如何在 C# 中解决这个问题？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T14:52:36.163

在 Web 服务中来回传递对象时，它只是传递该对象公共属性的 XML 表示。任何方法，无论是否被覆盖，都不会附带它。

我建议创建一个调用 ToString() 的 StringRepresentation 属性

```
public string StringRepresentation
{
    get { return this.ToString(); }
    set { /* Do Nothing, but there has to be a set */ }
} 
```

# c# - 我可以在 .NET 3.5 的代码隐藏中打印标准测试页吗？

> ID：858442
> 
> 赞同：2
> 
> 时间：2009-05-13T14:50:39.070
> 
> 标签：c#, wpf, printing

如果我有网络打印机的名称，有没有办法从 C# 代码打印 WPF 中的标准测试页？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-19T13:54:55.943

以下是使用 System.Management 命名空间访问 WMI 并将测试页打印到打印机的示例。这依赖于连接到计算机的打印机，如果您也需要，我可以提供通过 System.Management 连接网络打印机的代码。此代码适用于任何版本的 .Net Framework

```
using System;
using System.Management;

public class PrintTestPageUsingWMI
{
    private String _name;
    private ManagementObject _printer = null;

    public PrintTestPageUsingWMI(String printerName)
    {
        this._name = printerName;

        //Find the Win32_Printer which is a Network Printer of this name

        //Declare WMI Variables
        ManagementObject MgmtObject;
        ManagementObjectCollection MgmtCollection;
        ManagementObjectSearcher MgmtSearcher;

        //Perform the search for printers and return the listing as a collection
        MgmtSearcher = new ManagementObjectSearcher("Select * from Win32_Printer");
        MgmtCollection = MgmtSearcher.Get();

        foreach (ManagementObject objWMI in MgmtCollection)
        {
            if (objWMI.Item("sharename").ToString().Equals(this._name))
            {
                this._printer = objWMI;
            }
        }

        if (this._printer == null)
        {
            throw new Exception("Selected Printer is not connected to this Computer");
        }        
    }

    public void PrintTestPage()
    {
        this.InvokeWMIMethod("PrintTestPage");
    }

    /// <summary>
    /// Helper Method which Invokes WMI Methods on this Printer
    /// </summary>
    /// <param name="method">The name of the WMI Method to Invoke</param>
    /// <remarks></remarks>
    private void InvokeWMIMethod(String method) {
        if (this._printer == null)
        {
            throw new Exception("Can't Print a Test Page on a Printer which is not connected to the Computer");
        }

        Object[] objTemp = new Object[0] { null };
        ManagementObject objWMI;

        //Invoke the WMI Method
        this._printer.InvokeMethod(method, objTemp);
    }
} 
```

或者，您可以查看 .Net 3.0 及更高版本支持的 System.Printing 命名空间

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T15:11:44.183

应该可以使用prnadmin.dll。如果工作站上尚未配置打印机，您很可能必须首先在 Windows 中创建打印机（通过代码或使用用户界面）。

[http://support.microsoft.com/kb/321025](http://support.microsoft.com/kb/321025)

[http://www.codeproject.com/KB/cs/PrinterAdmin.aspx?display=Print](http://www.codeproject.com/KB/cs/PrinterAdmin.aspx?display=Print)

# subsonic - SubSonic 寻呼语法帮助

> ID：858444
> 
> 赞同：0
> 
> 时间：2009-05-13T14:50:50.240
> 
> 标签：subsonic

我正在努力使亚音速选择查询起作用，我正在编写分页方法并尝试了以下操作

```
Select ns = new Select(maincolumns.ToArray());
ns.PageSize = 10;   ** Error Here **
ns.PageIndex = 1;   ** And Error Here **
ns.Where("IsLive").IsEqualTo(true);
ns.And("Title").Like("%" + SearchTerm + "%");
ns.OrderAsc("RentalExVat");
return ns.ExecuteDataSet().Tables[0]; 
```

现在它不能识别 ns.PageSize 或 ns.PageIndex，查询的其余部分工作正常吗？我看到我需要使用新的“查询”工具才能使用这两个工具，但我无法弄清楚查询语法？？

任何语法帮助表示赞赏

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-13T14:59:29.803

SubSonic 的查询语法是“流利的”，因此在您的代码示例中，Where 子句不适用于您的查询。这个片段可能会更好：

```
Select ns = new Select(maincolumns.ToArray());
ns = ns.Where("IsLive").IsEqualTo(true)
       .And("Title").Like("%" + SearchTerm + "%")
       .OrderAsc("RentalExVat")
       .Paged(1, 10); // paging is set here
return ns.ExecuteDataSet().Tables[0]; 
```

此外，请确保您的“SearchTerm”已被 SQL 转义（或使用备用调用模式），否则您容易受到 SQL 注入的攻击。

# java - 将 JSP 标记转换为 JSF 组件

> ID：858451
> 
> 赞同：4
> 
> 时间：2009-05-13T14:51:48.850
> 
> 标签：java, jsf, taglib

我有一个 JSP 标签，我想在我的 JSF/Seam 应用程序中使用它。有人可以给我一些指导，让我的环境接受标签。我可以将一个 faclets *.taglib.xml 文件指向我的旧标签，还是我需要编写一个扩展前一个标签的组件？

为任何信息干杯，李

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T19:22:02.293

我非常不愿意尝试在 JSP 上下文之外直接调用 JSP 标记。正如[文档所指出](https://facelets.dev.java.net/nonav/docs/dev/docbook.html#dev)的，JSP 和 Facelets 之间的相似之处非常肤浅。

一种 hack（我怀疑任何解决方案都将成为 hack）可能是通过强制转换为 servlet API 来包含 JSP。

此函数使用[RequestDispatcher](http://java.sun.com/javaee/5/docs/api/javax/servlet/RequestDispatcher.html)包含给定资源：

```
public class Includer {

  public static String include(String resource) {
    FacesContext context = FacesContext
        .getCurrentInstance();
    ExternalContext ext = context.getExternalContext();
    include(ext.getContext(), ext.getRequest(), ext
        .getResponse(), resource);
    return "";
  }

  private static void include(Object context,
      Object request, Object response, String resource) {
    ServletContext servletContext = (ServletContext) context;
    ServletRequest servletRequest = (ServletRequest) request;
    ServletResponse servletResponse = (ServletResponse) response;
    RequestDispatcher dispatcher = servletContext
        .getRequestDispatcher(resource);
    try {
      dispatcher.include(servletRequest, servletResponse);
    } catch (IOException e) {
      throw new FacesException(e);
    } catch (ServletException e) {
      throw new FacesException(e);
    }
  }

} 
```

该函数在 Facelet taglib 文件*WEB-INF/facelets/include.taglib.xml*中定义：

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE facelet-taglib PUBLIC
  "-//Sun Microsystems, Inc.//DTD Facelet Taglib 1.0//EN"
  "http://java.sun.com/dtd/facelet-taglib_1_0.dtd">
<facelet-taglib xmlns="http://java.sun.com/JSF/Facelet">
  <namespace>http://demo</namespace>
  <function>
    <function-name>include</function-name>
    <function-class>inc.Includer</function-class>
    <function-signature>
      java.lang.String include(java.lang.String)
    </function-signature>
  </function>
</facelet-taglib> 
```

*这在WEB-INF/web.xml* [中使用上下文参数](https://facelets.dev.java.net/nonav/docs/dev/docbook.html#config-webapp-init)指定为库：

```
 <context-param>
    <param-name>facelets.LIBRARIES</param-name>
    <param-value>/WEB-INF/facelets/include.taglib.xml</param-value>
  </context-param> 
```

* * *

**示例用法**

要包含的 JSP，*includeme.jsp*：

```
<?xml version="1.0" encoding="UTF-8" ?>
<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page" version="2.0">
  <jsp:directive.page language="java"
    contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" />
  <b>Some data: ${foo}</b>
</jsp:root> 
```

包含 JSP 的 Facelet：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:demo="http://demo">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>JSP include hack</title>
</head>
<body>
<h:form>
  <p> ${demo:include('/includeme.jsp')} </p>
  <h:inputText type="text" value="#{foo}" />
  <h:commandButton type="submit" />
</h:form>
</body>
</html> 
```

注意使用*${demo:include('/includeme.jsp')}*来调用请求调度程序（该函数返回一个空字符串）。该函数包含在属性*xmlns:demo="http://demo"*中。请求范围变量*foo*绑定到文本字段并由 JSP 获取。

* * *

关于这一点，我只能说它对我有用，并且可能有十几个原因导致它无法与特定的标签组合或特定的 JSF 库组合一起使用。买者自负。

# silverlight - 在主导航页面上为多个用户控件设置动画时，Silverlight DRY

> ID：858455
> 
> 赞同：1
> 
> 时间：2009-05-13T14:52:48.270
> 
> 标签：silverlight, oop

从 Silverlight 开发开始。尚未阅读一本好的 Silverlight 书籍：欢迎提出建议。

我有一个主 GUI 屏幕，其中 7 个用户控件（菜单项）沿着它们自己的路径“俯冲”到视线中。我将用户控件很好地分开并且表现良好。在一个 .XAML 中包含多个故事板（每个菜单项各 1 个）和多个关键帧动画（X、Y、高度、宽度）对我来说并不合适。重复所有这些属性值是可怕的，更不用说维护了。

我尝试将值移动到 app.xaml 并使用样式键设置动画持续时间，但成功有限。任何人都可以提出一个使这个更清洁的好方法吗？将故事板重构到他们自己的控制之下？资源中的属性值？代码隐藏中的动态构建？

向我推荐一个操作方法网站也很好。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T15:29:05.090

您可能会遇到 XAML 过载。似乎大多数开发人员在开始使用 WPF 或 Silverlight 时，都认为所有可以进入 XAML 的东西都应该进入 XAML。然后，他们到了与 XAML 抗争的地步，以完成需要在代码隐藏中花费一些时间的事情（我也遇到了他的问题）。

如果您在 XAML 中发现一些麻烦或丑陋的东西，请考虑用代码编写它。这不是犯罪。您可能可以声明一个用于创建情节提要的方法，然后多次使用它，或者您可以创建一个包装情节提要的类，并以更简洁的方式将多个实例添加到 XAML 中。正如您在帖子末尾正确地确定的那样，有多种方法可以使其更清洁，您只需要决定哪一种适合您的情况。

如果没有一些示例 XAML，很难想象您面临的确切问题，因此我无法提出明确的建议，但我希望这会有所帮助。我喜欢你俯冲控制的声音——我脑海中的图像确实很好。

# silverlight-2.0 - 如何在 Silverlight 中获取日期时间？

> ID：858469
> 
> 赞同：0
> 
> 时间：2009-05-13T14:54:14.227
> 
> 标签：silverlight-2.0

从标题来看，这似乎是一个愚蠢的问题:) 我知道，但我有一个 silverlight 应用程序需要将日期时间发送到 3rdparty Web 方法并基于日期时间填充一些客户端控件......现在我知道如何从客户端获取日期时间但是问题客户端时间可能是错误的............一种方法是使用网络服务来获取日期时间还有其他想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T17:26:23.870

如果您需要服务器时间的可靠性，那么是的——一个 Web 服务就足够了。我最近遇到了 Silverlight 的限制，只有 Web 服务（WCF 或其他）才能解决。我为我的场景选择了一个普通的 .NET Web 服务，当一切都说完之后，它就像一个魅力。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T15:02:26.290

更具体地了解您的方案。您所说的“客户时间可能是错误的”是什么意思？

如果您的意思是由于世界时差（例如客户端在服务器位于英国时从美国访问），客户端时间可能与服务器时间不同，那么您必须确保在发送之前通过调用将您的时间转换为[世界时。](http://en.wikipedia.org/wiki/Coordinated_Universal_Time)`DateTime.ToUniversalTime()`

# python - Django中的日期时间问题

> ID：858470
> 
> 赞同：4
> 
> 时间：2009-05-13T14:54:17.020
> 
> 标签：python, django, datetime, postgresql

我正在尝试添加一个人的日期时间对象。每当出生年份小于 1942 年时，`DataError: unable to parse time`从数据库中读取数据时就会出现奇怪的错误。

```
class Person(models.Model):
    """A simple class to hold the person info
    """
    name = models.CharField(max_length=100)
    born = models.DateTimeField(blank=True, null=True) 
```

每当我尝试添加`datetime`1929 年出生的人的出生对象然后尝试读取它时，它都会失败。

让我重申一下，数据插入工作正常，但在读取过程中失败。我假设数据库内部发生了问题。

我做了一组测试，发现每当我添加 1940 年或之前出生的人时，它都会失败。它给出了`DataError: unable to parse time`

我正在使用 PostgreSQL。

任何形式的帮助将不胜感激。谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-13T15:08:32.643

我唯一能想到的可以在[PostgreSQL 文档](http://www.postgresql.org/docs/6.3/static/c0804.htm)中找到。我的猜测是 Django 将您的日期存储在“reltime”字段中，该字段只能追溯到 68 年。我的计算器验证了 2009-68 == 1941，这似乎与您报告的非常接近。

我建议通过运行以下命令查看表的架构：

```
$ python manage.py sql appname 
```

看看有问题的日期字段是否是我怀疑的“reltime”字段。如果是这种情况，我不知道如何将其更改为更兼容的字段，而不会弄乱一切。

# java - 如何使用密码和 Java 将 12 位十进制数字加密/解密为其他数字？

> ID：858476
> 
> 赞同：1
> 
> 时间：2009-05-13T14:55:10.450
> 
> 标签：java, encryption

我已经阅读了[Using Java to encrypting integers](https://stackoverflow.com/questions/321787/using-java-to-encrypt-integers)和[Encrypting with DES Using a Pass Phrase](http://www.exampledepot.com/egs/javax.crypto/PassKey.html)。

我所需要的只是一个简单的加密器，它将一个 12 位数字转换为一个 12 位数字，具有以下约束：

1.  加密必须依赖于密码（在应用程序的整个生命周期中都是不变的），而不是其他任何东西。
2.  映射必须是 1-1（没有散列，多个输入给出相同的输出，反之亦然）。
3.  映射不能在不同 VM 之间或 VM 启动时更改（例如，当您重新启动 Java 时，该实用程序应该为您提供相同的映射，这意味着它必须完全依赖于提供的密码）。
4.  以 0 开头的数字不是有效的 12 位数字（输入的数字也不会以 0 开头）。
5.  密钥/密码永远不可猜测。例如，运行具有多个输入的实用程序并分析输出不应让人们猜测密钥/密码/哈希或其他任何东西。
6.  所有输入都将是 12 位且小于 12 位素数（这意味着我们可以使用模运算）。

浏览了文献后，我随身携带了这段代码

```
public void mytestSimple(long code, String password) throws Exception {
    SecretKey key = new SecretKeySpec(password.getBytes(), "DES");
    Cipher ecipher = Cipher.getInstance("DES");
    ecipher.init(Cipher.ENCRYPT_MODE, key);
    System.out.println(ecipher.getOutputSize(8));

    byte[] encrypted = ecipher.doFinal(numberToBytes(code));
    System.out.println(encrypted + "--" + encrypted.length);

    Cipher dcipher = Cipher.getInstance("DES");
    dcipher.init(Cipher.DECRYPT_MODE, key);
    byte[] decrypted = dcipher.doFinal(encrypted);
    System.out.println(bytesToNumber(decrypted) + "--" + decrypted.length);
}

public void testSimple() throws Exception {
    mytestSimple(981762654986L, "password");
} 
```

我遇到了问题

1.  如何将 16 字节转换为 12 位数字。
2.  保持 1-1 映射。
3.  在多个 VM 调用中保持加密/解密相同。

****我在下面添加的答案****

我添加了一个答案，即从标准 Java RSA 密钥对生成逻辑中提取的 40 位 RSA。我仍然需要处理边缘情况。我将接受答案并投票支持我认为有点引导我找到答案的“Tadmas”。有人能告诉我我的算法是否会很弱/可攻击吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-13T14:58:41.007

您将无法在不丢失信息的情况下将 16 个字节转换为 12 位数字。256 ^ 16 > 10 ^ 12。（并不是说您甚至有 10^12 个选项，因为您只有范围 [100000000000, 999999999999]。

我怀疑您是否能够使用任何传统的加密库，因为您的要求有些奇怪。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-13T15:20:14.637

如果严格的 1:1 映射比防止密码分析更重要，那么您可以将密码转换为 12 位数字（通过哈希或其他方式）并简单地添加到您的原始数字 mod 10^12。如果你绝对必须从输出中删除前导零，你可以减去 10^11，做数学模型 (10^12 - 10^11)，然后再加 10^11。当然，这是非常不安全的，但它很简单。:)

如果输入范围以小于 (10^12 - 10^11) 的素数为界，您可以使用 message ^ password mod prime 形成一个环，以满足您的要求并且更难破解。（这类似于 RSA 的工作方式。）我认为如果您不需要解密它，这可能会起作用。

我同意 Jon Skeet 的观点：在输出范围不大于输入域的情况下要求严格的 1:1 映射是大多数加密库都不会处理的事情。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-13T22:12:17.147

一种潜在的解决方案可以建立在[Feistel 密码](http://en.wikipedia.org/wiki/Feistel_cipher)之上。这种结构允许基于伪随机函数构建伪随机排列。例如，可以通过将结果截断为 6 位数字，从适当的分组密码构造伪随机函数。

在以下论文 M. Luby 和 C. Rackoff，“如何从伪随机函数构造伪随机排列”SIAM Journal on Computing，Vol.17，No.2，pp.373--386，1988 中分析了这种构造

* * *

一个具体的提议是[Feistel Finite Set Encryption Mode](http://csrc.nist.gov/groups/ST/toolkit/BCM/documents/proposedmodes/ffsem/ffsem-spec.pdf)，它已提交给 NIST，以便可能包含在即将发布的标准中。该提议还解决了加密范围不是 2 的幂的问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-13T15:16:01.307

我建议一个非常简单的算法。

1.  将密码输入哈希函数。
2.  使用散列或从散列派生的东西初始化随机数生成器。
3.  生成一个 12 位随机数。
4.  将此随机数逐位模10添加到输入数字以进行加密。

解密减去模10的随机数。~~这实际上是[One Time Pad](http://en.wikipedia.org/wiki/One-time_pad)的一种形式。~~由于对此答案的评论，我意识到引用[One Time Pad](http://en.wikipedia.org/wiki/One-time_pad)是一个糟糕的选择。更好的参考是多字母[密码](http://en.wikipedia.org/wiki/Polyalphabetic_substitution)- 而 One Time Pad 使用多字母替换，其主要特征是不使用任何密钥位两次。

```
   输入 1234 1234 1234
   随机号码 6710 3987 2154
   输出 7944 4111 3388

```

还有一个问题 - 该算法可能会创建前导零。为了解决这个问题，可以使用`XOR`而不是加法和减法。只需用 转换数字`XOR`。如果第一个数字变成零，请不要加密第一个数字。当您`XOR`再次解密时，第一位数字将变为零，您知道第一位数字没有被加密。

**更新**

一个简单`XOR`的不是解决方案，因为它会产生大量 -`2 XOR 9 = 11`例如。打算重新考虑这个...

**更新**

`XOR`are`XOR(a, b) = XOR(b, a)`和的好的属性`XOR(XOR(a, b), b) = a`。这使得加密和解密相同，并允许检测未加密的前导数字。但进一步要求我们的函数只返回 0 到 9 范围内的值，这`XOR`是不做的。
但也许我们可以构建一个包含所有必需属性的自定义函数。因此，我们创建了一个`FUNC`10 列和 10 行的数组，并将其用作我们函数的查找表。但是有什么价值？我实际上不知道——我什至不确定这是否可能。但是，如果我们从 0 到 9 范围内选择三个数字，我们必须输入以下六个条目。（它是一个对称矩阵。）

```
FUNC[x,y] = z FUNC[x,z] = y FUNC[y,z] = x
FUNC[y,x] = z FUNC[z,x] = y FUNC[z,y] = x

```

因此，如果没有冲突，也许可以通过重复选择随机数并填充六个条目来创建这样的函数。也许不是。如果有人找到解决方案，我想看看这张桌子。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-13T17:51:08.243

如果这些数字用于用户 ID，我会这样做：

(1) 从密码生成 AES 密钥。如果您相信管理员会使用非常非常强大的密码，那么只需调用 getBytes() 就可以了。理想情况下，使用标准的“基于密码的加密”技术对字节进行哈希处理，例如几千次，每次添加您最初生成的随机“盐”字节以避免字典攻击。

(2) 使用该 AES 密钥加密有问题的号码。

(3) 从生成的加密块中切掉 12 位数的比特，将其转换为十进制，并将该数字呈现给用户。（要做到这一点，您可以在字节周围包裹一个 BigInteger，在其上调用 toString()，然后提取位置 4 和 16 之间的字节。）从实验上看，您似乎不应该从最右端。

[**更新**：我*认为*这可能是因为 BigInteger 从字面上分配它的数字从左到右位——但我没有检查——所以在最右边的字节中可能会有“备用”位，因此可能的数字更少如果你包括最后一个字节。]

现在，我听到你哭了，这显然不是 1-1 映射。但除非你将拥有数以万计的用户，否则它真的已经足够好了。使用 12 位数字，您预计平均会在发生冲突之前加密大约 300,000 个数字。因此，尽管您没有严格的 1-1 映射，但在实践中，它几乎是该死的。

（无论如何，如果您的应用程序确实拥有成千上万的用户并且安全性至关重要，那么您可能需要对此类事情进行一些认真的咨询......）

只是为了让自己相信可以假装它是 1-1 映射确实是可以的，您可以运行一个模拟，重复尝试分配，例如，使用随机键的 200,000 个用户 ID，并打印每次运行时发生了多少冲突：

```
 next_pass :
        for (int pass = 0; pass < 100; pass++) {
          byte[] key = new byte[16];
          (new SecureRandom()).nextBytes(key);
          Cipher ciph = Cipher.getInstance("AES");
          SecretKeySpec ks = new SecretKeySpec(key, "AES");
          ByteBuffer bb = ByteBuffer.allocate(16);
          Set<String> already = new HashSet<String>(100000);
          int colls = 0;
          for (int i = 0; i < 200000; i++) {
            bb.putLong(0, i);
            ciph.init(Cipher.ENCRYPT_MODE, ks);
            byte[] encr = ciph.doFinal(bb.array());
            encr[0] &= 0x7f; // make all numbers positive
            BigInteger bigint = new BigInteger(encr);
            String userNo = bigint.toString();
            userNo = userNo.substring(4, 16);
            if (!already.add(userNo)) {
              System.out.println("Coll after " + i);
              continue next_pass;
            }
          }
          System.out.println("No collision.");
        } 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-15T11:20:53.513

我认为 Tadmas 下面给出的答案非常有帮助，我希望你们在下面破解/欺负我的实现。正如 Tadmas 指出的那样，我所有的数字都是 40 位（12 位数字是 10^12，大约是 2^40）。

我复制了 sun.security.rsa.RSAKeyPairGenerator（链接）并为 40 位 RSA 算法创建了我自己的生成器。标准的需要 512-1024 位，所以我删除了它周围的输入检查。一旦我创建了合适的 n、e、d 值（根据 alog，e 似乎是 65537）。以下代码服务良好，

```
public void testSimple() throws NoSuchAlgorithmException {
    MyKeyPairGenerator x = new MyKeyPairGenerator();
    x.initialize(40, new SecureRandom("password".getBytes()));

    MyPublicPrivateKey keypair = x.generateKeyPair();
    System.out.println(keypair);

    BigInteger message = new BigInteger("167890871234");
    BigInteger encoded = message.modPow(keypair.e, keypair.n);
    System.out.println(encoded); //gives some encoded value
    BigInteger decoded = encoded.modPow(keypair.d, keypair.n);
    System.out.println(decoded); //gives back original value
} 
```

缺点

1.  编码可能并不总是 12 位数字（有时它可能以 0 开头，这意味着只有 11 位数字）。我想总是在前面填充 0 个零并在开始时添加一些 CHECKSUM 数字，这可能会缓解这个问题。所以13位总是...
2.  40 位 RSA 比 512 位弱（不仅仅是 512/40 倍，而是指数倍数）。您的专家能否指出关于 40 位 RSA 与 512 位 RSA 相比有多安全的链接（我可以在 wiki 中看到一些内容，但无法具体确认攻击的可能性）？关于破解 RSA 所需的概率/尝试次数的任何链接（wiki？）作为 N 的函数，其中 n 是使用的位数，将会很棒！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-10-15T17:36:13.933

我会使用[流](http://en.wikipedia.org/wiki/Stream_cipher) [密码](http://en.wikipedia.org/wiki/Block_cipher_modes_of_operation)。*N*字节输入，*N*字节输出。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-04-03T22:59:44.727

该线程已有 4 年历史，但对于那些在 Google 中找到该线程的人：查看 Format Preserving Ciphers：[http ://en.wikipedia.org/wiki/Format-preserving_encryption](http://en.wikipedia.org/wiki/Format-preserving_encryption)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-13T15:16:54.237

出于数学原因，大多数密码将产生“更多”字节（即它们将填充输入）。因此，您必须接受该代码从您的 12 位数字中生成 16 个字节。

当字符串被解码时，你会得到 12 位数字，但在传输过程中，你需要 16 个字节。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-13T16:01:18.907

如果我正确理解了您的问题，则解密后的 16 个字节有问题。诀窍是使用： Cipher.getInstance("DES/ECB/PKCS5Padding");

（以防万一代码有帮助）：

```
public void mytestSimple(long code, String password) throws Exception 
       { SecretKey key       = new SecretKeySpec (password.getBytes(),"DES");
         Cipher    ecipher   = Cipher.getInstance("DES/ECB/PKCS5Padding");
         byte[]    plaintext = new byte[8];

         for (int i=0; i<8; i++)
             { plaintext[7-i] = (byte) (code & 0x00FF);
                >>>= 8;
             }

         ecipher.init      (Cipher.ENCRYPT_MODE, key);
         System.out.println(ecipher.getOutputSize(8));

         byte[] encrypted = ecipher.doFinal(plaintext);
         System.out.println("--" + encrypted.length);

         Cipher dcipher = Cipher.getInstance("DES/ECB/PKCS5Padding");
         dcipher.init(Cipher.DECRYPT_MODE, key);

         byte[] crypttext = dcipher.doFinal(encrypted);
         long   decoded    = 0;

         for (int i=0; i<8; i++)
             { decoded <<= 8;
               decoded  += crypttext[i] & 0x00FF;
             }

         System.out.println(decode + "--" + crypttext.length);
       } 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-13T18:00:28.243

重新思考这个问题，我想出了以下问题。基本上，您需要一个对称密码来获得一对一的映射。并注意到`10^12`几乎是`2^40`( `2^39.863`) 将您的 12 位数字转换为 40 位整数并将此数字输入到块长度为 40 位的块密码中似乎很自然。~~一个不错的选择可能是[Blowfish](http://en.wikipedia.org/wiki/Blowfish_(cipher))以 8 位为步长支持从 32 到 448 位的块长度 - 因此支持 40 位。~~

* * *

**更新**

正如 Accipitridae 指出的那样，Blowfish 的密钥大小可变，但块大小固定，因此没有选择。通过网络进行更多搜索似乎表明，很少或没有块大小为 40 位或更少的密码使这个想法无效。留下答案的其余部分 - 也许可以找到合适的密码。

* * *

剩下的问题是~~Blowfish~~可能会返回一个最多`1,099,511,627,775`13 位的数字，并且返回的数字可能包含前导零，但我相信这可以在第二步中解决。我的第一个想法是将类似[Burrows-Wheeler 变换](http://en.wikipedia.org/wiki/Burrows-Wheeler_transform)之类的东西应用于数字的字符串表示，以便在数字的前面至少有一个零，消除第 13 位，然后修改所有剩余的数字（例如 0 <-> 9, 1 <-> 8, 2 <-> 7, ...) 将额外的前导零转换为其他数字。
几分钟后，我意识到这不起作用 - 输入有大小`2^40`，而输出只有大小`2^39.863`。一种解决方案是使用 39 位分组密码并将输入限制为最多`549,755,813,887`. 我不知道是否有可以处理 39 位块长度的密码，但是这篇[关于弹性块密码](http://www1.cs.columbia.edu/~dcook/pubs/ebc-asiaccs0307.pdf)的论文描述了如何构建一个可以处理从`n`最大到`2n`给定的块密码的每个块大小的块密码可以处理块大小`n`。~~因此，可以从 32 位 Blowfish 构建 39 位块密码。~~

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-15T11:52:34.637

如果您准备接受一个相当**弱的解决方案**......

将 12 位数字视为两个 6 位数字。然后使用密码的哈希作为随机数生成器的种子，随机数生成器对包含 999,990 个连续值的表进行洗牌。然后使用这两个 6 位数字在表中查找条目。这两个结果的串联是您基于密码的 1:1 映射的 12 位“加密”输入。

让我们用 4 位而不是 12 位做一个例子……

```
Input: 4852
Password: passw0rd1 => hashcode = 37592 
```

现在拿这个数组..

```
a = [10, 11, 12, 13, .. 98, 99] 
```

并用 37592 作为随机种子对其进行洗牌......

```
b = [45, 15, 56, 49, .. 33, 88] 
```

现在拆分输入：48、52 并在洗牌数组中查找这些索引，例如...

```
b[48] => 23
b[52] => 96 
```

所以我们4852的加密版本是2396

这确实不是一个强大的解决方案，但您问题中的限制不会导致一个强大的解决方案。您可能需要稍微放松一下这些限制。

# iphone - 如何根据旋转原点旋转视图，在视图坐标系中指定谁的位置？

> ID：858479
> 
> 赞同：1
> 
> 时间：2009-05-13T14:55:19.013
> 
> 标签：iphone, cocoa-touch, uikit

我觉得这很令人困惑。当您要旋转视图时，它将按其中心点旋转。但这并不总是好的。因此，如果您需要在视图中按指定原点旋转，则必须设置视图层的 anchorPoint 属性。

现在，问题是，这个 anchorPoint 属性对于普通的智能程序员来说是相当混乱的值；）

据我所知，它们是从 0 到 1。另外，坐标系被翻转到视图的坐标系，我认为0是视图坐标系中的最小值，1是最大值。

```
myView.layer.anchorPoint = CGPointMake(0.5, 0.5); 
```

将锚点设置在视图的中间。

如果我只知道： - 我的视图是 100 x 150 单位大 - 我希望 anchorPoint 在我的视图坐标系中位于 x=100 和 y=20

知道如何实现吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T15:01:02.703

听起来你会用

```
myView.layer.anchorPoint = CGPointMake(1.0, 0.133); 
```

它们只是百分比值，不是吗？100/100 = 1 和 150/20 = 0.133。

# php - ZendFramework 和开放ID 登录，ZF 是最新的吗？

> ID：858483
> 
> 赞同：2
> 
> 时间：2009-05-13T14:55:43.273
> 
> 标签：php, zend-framework, openid

我正在尝试将 openID 登录集成到 ZF 项目中（使用 MVC）。我遇到了失败。当我跟踪代码时，我发现故障源自：OpenId/Consumer.php（~740 行）。这些行尝试分析从向开放 id 提供者发出的第一个请求开始的开放 id 协议版本。
ZF 中的正则表达式期望接收带有 LINK 标记的 HTML：

```
/<link[^>]*href=(["\ 
```

当我查看响应时，例如来自谷歌的响应，我看到我得到了 XML。我使用的谷歌网址：https: [//www.google.com/accounts/o8/id](https://www.google.com/accounts/o8/id)

我从那里得到的结果：

```
<?xml version="1.0" encoding="UTF-8"?>
<xrds:XRDS xmlns:xrds="xri://$xrds" xmlns="xri://$xrd*($v*2.0)">
  <XRD>
  <Service priority="0">
  <Type>http://specs.openid.net/auth/2.0/server</Type>
  <Type>http://openid.net/srv/ax/1.0</Type>

  <URI>https://www.google.com/accounts/o8/ud</URI>
  </Service>
  </XRD>
</xrds:XRDS> 
```

我是否使用了错误的谷歌链接？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-15T12:27:30.997

查看[ZF 主干](http://framework.zend.com/svn/framework/standard/trunk/library/Zend/OpenId/Consumer.php)中的源代码，目前似乎不支持基于 XRDS 的发现：

```
/* TODO: OpenID 2.0 (7.3) XRI and Yadis discovery */ 
```

ZF 当前支持基于 HTML 的文档，Google 返回一个带有端点地址的 XDRS 文档及其 OpenId 条目 URL。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-09-09T12:51:07.607

我找到了 ZF 的补丁，它可以解决大部分问题[http://ak33m.com/?p=71](http://ak33m.com/?p=71)

# excel - Excel电子表格

> ID：858485
> 
> 赞同：0
> 
> 时间：2009-05-13T14:55:46.627
> 
> 标签：excel

我需要一种显示 3 个数据单元格的方法。
例如

```
单元格 1 单元格 2 单元格 3    

20 140 李
12 110 克里

```

每当在单元格 3 中输入任何人的姓名时，我都需要一个单独的电子表格来显示姓名（单元格 3）和单元格 1 和 2 中的信息（单元格 1 和 2 中的信息总是不同的）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T15:37:47.307

根据您的问题，不清楚您是在谈论将人名输入到单个单元格（例如“C3”）还是在给定列中的某个位置（例如“C:C”）。

在前一种情况下，您可以轻松使用吉尼斯的建议；或者您可以更轻松地编写这样的公式来连接单元格 1 到 3 中的值（假设工作表称为“Sheet1”）：

```
="Name = "&Sheet1!C3&": Cell1 = "&Sheet1!A3&", Cell2 = "&Sheet1!B3 
```

（这是基于您的示例中的单元格 1 到 3 在 A 到 C 列和第 3 行中。）

另一方面，如果您谈论的是后一种情况，并且想要在 C 列添加新名称时运行一些 VBA 代码，则可以使用 Worksheet_Change VBA 函数。如果是这种情况，请编辑问题以表明这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T15:44:12.773

1.  假设您有名为 Book1.xls 的 Excel 工作簿 1。打开该工作簿并在前三行和前三列中键入以下内容

    Row 1 - cell1 cell2 cell3
    Row 2 - 20 12 Jee
    Row 3 - 87 25 Kee

2.  现在打开另一个工作簿 - 比如说 Book2.xls。选择要放置值的单元格。在该单元格中按“=”（“等号”）

3.  现在这是重要的一点。按下“等于”后，返回第一个 Excel 工作簿并选择单元格，您希望在第二个工作簿中输入其内容。

因此，在这种情况下，第二个工作簿中的单元格将具有这样的公式
=[Book1]Sheet1!$A$2

对您想要的其余单元格执行相同的操作。

重要提示：请注意，除非同时打开第一个工作簿，否则不会填写第二个工作簿。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T15:02:25.993

使用功能：VLOOKUP

# c# - C# 3.0，对象初始化器和获取属性返回数组，如何初始化？

> ID：858491
> 
> 赞同：1
> 
> 时间：2009-05-13T14:57:29.540
> 
> 标签：c#, c#-3.0, initialization

具有以下课程：

```
public class SomeClass
{
    private readonly int[] _someThings;

    public SomeClass()
    {
        _someThings = new int[4];
    }

    public int[] SomeThings
    {
        get { return _someThings; }
    }
} 
```

我将如何使用对象初始化器语法来初始化***SomeThings***属性，如以下（非工作）代码提取？

```
var anObject = new SomeClass
    {
        SomeThings[0] = 4,
        SomeThings[3] = 8
    } 
```

* * *

### 更新

可以这样做（即使没有*设置*属性）：

```
anObject.SomeThings[0] = 4;
anObject.SomeThings[3] = 8; 
```

但我正在尝试使用对象初始值设定项语法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T15:00:11.660

AFAIK，你只能有这样的 Add 方法：

```
public class SomeClass
{
  void Add(int index, int item) 
  { 
    // ...
  }
}

var anObject = new SomeClass()
    {
        {0, 4}, // Calls Add(0, 4)
        {4, 8}  // Calls Add(4, 8)
    } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T14:59:48.197

Object Initializer 语法是用于设置公共属性的“语法糖”。

SomeThings 没有公共设置器，所以你不能这样做。

所以这...

```
Foo x = new Foo() { Bar = "cheese" }; 
```

... 是相同的 ...

```
Foo x = new Foo();
x.Bar = "cheese; 
```

...因此没有任何能力接触私人成员来设置东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T15:02:58.177

理论上你可以这样做：

```
var anObject = new SomeClass {
    InitialSomeThings = new[] {
         1,
         2,
         3,
         4
    }
}

class SomeClass {
    private readonly int[] _somethings;
    public int[] 
       get { return _somethings; }
    }

    public int[] InitialSomeThings {
       set { 
           for(int i=0; i<value.Length; i++)
               _somethings[i] = value[i];
       }
   }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T15:04:16.630

You could add an overloaded constructor:

```
public class SomeClass
{
    private readonly int[] _someThings;

    public SomeClass()
    {
        _someThings = new int[4];
    }

    public SomeClass(int[] someThings)
    {
        _someThings = someThings;
    }

    public int[] SomeThings
    {
        get { return _someThings; }
    }
} 
```

...

```
 var anObject = new SomeClass(new [] {4, 8}); 
```

# asp.net - 在.Net的代码中获取表ID

> ID：858500
> 
> 赞同：1
> 
> 时间：2009-05-13T14:59:05.420
> 
> 标签：asp.net, vb.net

我在网络表单上有两个表格。在一个按钮上单击我想隐藏一个并显示另一个。我给了他们一个 ID，我想设置表格的 style="display:"

我在 javaScript 中使用函数和 document.getelementbyid(id).style.display='none' 进行了尝试，但没有成功。

有任何想法吗？

解决方案：

```
OnClientClick="javascript: tbl2.style.display='';tbl1.style.display='none';return false;" 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T15:07:52.537

我假设您的表格是.net 控件？如果是这样，传递 'id' 是不够的，因为 .net 不会分配与客户端 id 相同的服务器 id。

您需要访问 .net 控制服务器端的 ClientID 属性以获取它的真实客户端 ID：

```
MyButton.OnClientClick = string.Format("{0}.style.display=''", ControlIWantToHide.ClientID); 
```

上面的代码显示了如何将一些 javascript（请不要将其称为 java！）附加到名为**MyButton**的 .net asp:button上，然后在客户端单击该按钮以隐藏名为**ControlIWantToHide**的控件。

注意：上面可能需要调整以使其适用于所有浏览器，但 .net 是这里的重要因素，我怀疑 ClientID 是您一直需要的。

**根据您对评论的回复**，您要切换的元素不是 .net 控件，而是触发它们的按钮，因此：（基于 ebrown 发布的功能）：

```
<script type="text/javascript">
  function hide(id)
  {
     var element = document.getElementById(id);

     element.style.display='none';
  }

  function show(id)
  {
     var element = document.getElementById(id);

     element.style.display='block';
  }
</script> 
```

您可以通过附加 javascript 事件处理程序服务器端来触发页面中元素的切换：

```
MyButton.OnClientClick = "Show(tbl1);Hide(tbl2);return false;"; 
```

..它将显示 id 为**tbl1**的元素并隐藏**tbl2**的元素。如果您要切换的元素不是 .net 控件，这将起作用 - 即，它们没有*runat="server"*属性。请记住，即使您将 javascript 代码添加到服务器上的 asp:button，它也只会在客户端单击时执行。不要忘记如上所示返回“false”以停止 asp:button 的默认回发行为。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T18:14:21.483

我认为这应该让你走上正轨：

```
 <table id="tbl1" onclick="javascript:show('tbl2');hide('tbl1');" >
      <tr>
         <td>
             table 1 stuff
         </td>
      </tr>
  </table>

  <table id="tbl2" onclick="javascript:show('tbl1');hide('tbl2');">
      <tr>
         <td>
            table 2 stuff
         </td>
      </tr>
  </table>

<script type="text/javascript">
      function hide(id)
      {
         var element = document.getElementById(id);

         element.style.display='none';
      }

      function show(id)
      {
         var element = document.getElementById(id);

         element.style.display='block';
      }
   </script> 
```

还要确保您的 ID 是唯一的，我注意到您在示例代码中为 tr 元素提供了名称“tbl1”。只有表需要有ID

编辑：这将用于隐藏 Tr（只需给 tr 一个唯一的 id 并使用相同的方法）。但是我相信如果一个表有一个 onclick 事件，你将无法到达该行的 onclick 事件，所以你将不得不使用一个或另一个。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T15:06:56.577

Asp.net 将使用 run="server" 更改任何服务器标签的 id。如果您尝试使用 javascript 隐藏它们，则必须使用 asp.net 吐出的 id（您可以使用查看源代码查看）。或者，您可以将表格包装在 div 中，并使用常用方法显示/隐藏 div。

如果您使用的是 asp:Table 并试图在代码中隐藏表格，则可以使用 .Visible 属性在回发中实现相同的效果。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T15:03:19.640

使用 document.getelementbyid(id).style.display="none" 隐藏和 document.getelementbyid(id).style.display="block" 显示

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-13T17:37:51.790

如果这些是纯粹基于 html 的表格而不是尝试使用 -

document.getElementsByName('table1')[0]。**style.visibility='隐藏'** ;

或者

document.getElementsByName('table1')[0]。**style.visibility='可见'** ;

# mfc - 在 MFC 中配置新文档

> ID：858501
> 
> 赞同：0
> 
> 时间：2009-05-13T14:59:12.253
> 
> 标签：mfc

当用户在我的 SDI 应用程序中创建新文档时，我需要显示一个对话框，指定要创建的文档的详细信息（想想：分辨率、位深度等）。我最初将用于显示此对话框的代码放在 OnNewDocument 中() （打开现有文档时我不需要它），但是将用户界面代码放在文档类中感觉不对（而且，我没有任何 CWnd* 可用作父级对话框）。
在 MFC 中是否有更好的地方来执行此操作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T19:53:31.353

你是对的，文档类不是 UI 的好地方。

`CDocTemplate::[OpenDocumentFile][1](pszPath)`看起来像一个更好的候选人：

pszPath==NULL 表示“创建一个新文档”。

该方法是虚拟的 -> 只需从此类的实例派生`CMySingleDocTemplate`并`CSingleDocTemplate`使用`CMyWinApp::InitInstance().`

这个类负责创建文档、框架和视图，因此我认为这是一个放置 UI 操作的好地方。

```
BOOL CMyWinApp::InitInstance()
{
  ...
  CSingleDocTemplate* pDocTemplate;
  pDocTemplate = new CMySingleDocTemplate( // <--Derives from CSingleDocTemplate
    IDR_MAINFRAME,
    RUNTIME_CLASS(CMyDoc),
    RUNTIME_CLASS(CMainFrame),
    RUNTIME_CLASS(CMyView));
  AddDocTemplate(pDocTemplate);
  ...
}

CDocument* CMySingleDocTemplate::OpenDocumentFile(LPCTSTR lpszPathName,
    BOOL bMakeVisible)
{
  CDocument *pDoc = 
    CSingleDocTemplate::OpenDocumentFile(lpszPathName, bMakeVisible);

  if (lpszPathName==NULL)
  {
    // GUI to get user info

    // update doc
    m_pOnlyDoc->Blah(input);

    // update view
    m_pOnlyDoc->UpdateAllViews(NULL,...,...);
  }
} 
```

但这可能并不理想：在 SDI 中，只有一个 doc 对象。它在 File/Load 和 File/New 操作中重复使用。

然后在创建初始大型机*之前*第一次调用此函数。您可能不希望在创建框架*之前*向用户显示对话框。哎哟! 这有点复杂：不是像上面那样在 OpenDocumentFile(NULL) 中弹出 GUI，只需将自定义消息/命令**发布**到主框架。然后添加一个处理程序，该处理程序将按顺序弹出 GUI/更新文档/更新视图做出反应。这样，主框架将在 GUI 弹出之前显示，您的用户会更开心。

这也解决了您没有 CWnd 父级的问题：主框架已经创建，您的对话框将默认使用它。

顺便说一句，另一个解决方案包括在您的 CMyWinApp 的消息映射中为 ID_FILE_NEW 添加一个命令处理程序，并添加您自己的 OnFileNew() 覆盖。但是当你编写 OnFileNew() 时，我相信你很快就会发现这是一个丑陋的解决方案 :-(

# macos - 什么是 com.apple.Dont_Steal_Mac_OS_X

> ID：858511
> 
> 赞同：27
> 
> 时间：2009-05-13T15:00:24.997
> 
> 标签：macos, copy-protection, iokit

com.apple.Dont_Steal_Mac_OS_X 是一个 IOResources 提供者...

类继承：Dont_Steal_Mac_OS_X：IOService：IORegistryEntry：OSObject

它是如何工作的？

它有什么作用？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-05-13T15:03:18.657

[http://forums.macnn.com/90/mac-os-x/335611/dont-steal-mac-os-x-kernel/](https://web.archive.org/web/20090502033330/http://forums.macnn.com/90/mac-os-x/335611/dont-steal-mac-os-x-kernel/)

> 你今天的业力检查：
> 曾经有一个用户抱怨
> 他现有的操作系​​统是如此盲目，
> 他最好盗版
> 一个运行良好
> 但发现他的硬件下降的操作系统。
> 请不要盗用 Mac OS！
> 真的，这太不酷了。
> (C) 苹果电脑公司

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2011-07-29T23:13:36.017

除了将“Your karma check for today: ...”字符串放入内存之外，

> 我认为它包含解密某些其他加密的 kexts 和 Finder（也是部分加密的）的代码。
> 
> 一些使 OS X 在非 Apple 硬件上运行的 hack 以未加密的格式分发加密的 kext 和 Finder，这使得追踪它们以违反 DMCA（为了侵犯版权而绕过加密）变得容易。分发受 Apple 拥有版权的未加密 kext 是在未经许可的情况下分发受版权保护的作品。

（来自[与马克的答案相同的链接](http://forums.macnn.com/90/mac-os-x/335611/dont-steal-mac-os-x-kernel/)）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2018-06-27T10:47:51.697

扩展程序本身对此进行了解释：

```
cat '/System/Library/Extensions/Dont Steal Mac OSX.kext/Contents/Resources/English.lproj/InfoPlist.strings' 
```

> 版权所有 2006,2009 Apple Inc. 保留所有权利。此 Apple 软件的目的是保护 Apple 受版权保护的材料免遭未经授权的复制和使用。您不得全部或部分复制、修改、反向工程、公开展示、公开执行、再许可、转让或重新分发此文件。如果您已获得此 Apple 软件的副本并且没有 Apple 的有效使用许可，请立即将其从您的计算机中销毁或删除。_..不要窃取 Mac OS X

# iphone - 分发证书没有私钥。找不到有效的签名身份匹配配置文件

> ID：858516
> 
> 赞同：1
> 
> 时间：2009-05-13T15:01:16.930
> 
> 标签：iphone, distributed

一段时间以来，我已经能够生成和使用我的开发证书和配置。升级 xcode 后我确实遇到了一些问题，因为登录证书被丢弃/删除，但我解决了这个问题。

我正在尝试创建我的分发证书和配置。我注意到分发证书没有私钥 - 单击它时无法展开证书。不确定这是否是一个问题。当我将分发配置文件拖入管理器时，它会出现错误消息，“在您的钥匙串中找不到与此配置文件匹配的有效签名身份”。

我已经尝试将分发证书放在登录和系统中。我也确实安装了 WWDRCA 证书。

任何想法 - 一个真正的痛苦......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-20T09:42:48.783

听起来您没有与钥匙串中的证书相对应的钥匙。如果您发布了钥匙串条目和代码签名配置的屏幕截图，则更容易看到到底发生了什么。

还要确保您的钥匙串中有 Apple 证书。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-22T02:13:44.267

检查您是否仍然在登录钥匙串上获得您的私钥。这就是发生在我身上的事情。当我将我的项目从 iMac 复制到 Macbook Pro 时，我遇到了同样的问题。我发现我没有在 Macbook 上安装我的私钥。所以我导出了我的私钥，将它复制并安装到了 Macbook 上，它修复了它！

我在这里记录了信息：[http ://www.creatistblog.com/2009/09/iphone-developer-provisioning.html](http://www.creatistblog.com/2009/09/iphone-developer-provisioning.html)

# java - 推土机映射中的常量

> ID：858519
> 
> 赞同：7
> 
> 时间：2009-05-13T15:02:09.440
> 
> 标签：java, dozer

有人知道如何使用推土机将常量值放入属性中吗？我在推土机的文档中没有看到任何相关内容

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T16:24:07.870

不完全确定您的意思 - 如果您希望 Dozer 在从 BeanA 映射到 BeanB 时始终使用常量填充 BeanB.someField？

您可能希望为此映射注册一个[自定义转换器。](http://dozer.sourceforge.net/documentation/customconverter.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-17T21:40:20.790

如何利用事件机制？

所以你可以注册一个监听器来设置`mappingFinished()`你的监听器的值。有关详细信息，请咨询[有关事件的推土机文档](http://dozer.sourceforge.net/documentation/events.html)。当然，您必须在某种`if ... instanceof`条件下保护设置代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-02-04T00:51:09.787

最新版本的推土机使这更容易。您可以指定两个自定义转换器*，*也可以为给定字段映射指定该转换器的参数。创建一个单一的“ConstantConverter”应该是微不足道的，它将接受一个输入参数并将其 100% 的时间放在输出字段中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-10-15T22:33:37.367

一种可能的实现是：

```
public class ConstantsCustomConvertor implements ConfigurableCustomConverter{

    private String pararamter;
    @Override
    public Object convert(Object existingDestinationFieldValue, Object sourceFieldValue, Class<?> destinationClass, Class<?> sourceClass) {     
        return pararamter;
    }

    @Override
    public void setParameter(String parameter) {
        this.pararamter = parameter;

    }
} 
```

例子：

```
<field custom-converter-param="CONTANT_VALUE" custom-converter="org.yourcompany.ConstantsCustomConvertor">
    <a>a-class-dummyfieldname</a>
    <b>b-class-fieldname</b>
</field> 
```

此自定义转换器假定 b-class-fieldname 是 String 类型。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-06-29T21:54:18.123

[这对于ModelMapper](http://modelmapper.org)来说非常简单：

```
ModelMapper modelMapper = new ModelMapper();

modelMapper.addMappings(new PropertyMap<SourceClass, DestClass>() {
  protected void configure() {
    map().setSomeProperty(someConstant);
  }
}); 
```

此示例映射`someConstant`到`DestClass.someProperty`.

您可以在以下位置查看更多示例和文档： http: [//modelmapper.org](http://modelmapper.org)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-09-05T10:44:45.107

假设您只想在单向映射中执行此操作，则以下内容适用于 String 常量：

```
/**
 * Custom one-way Dozer converter mapping to constant string value specified by a parameter.
 */
public class OneWayStringConstantConverter extends DozerConverter<Class, String> {

    public OneWayBooleanConstantConverter() {
        super(Class.class, String.class);
    }

    @Override
    public String convertTo(Class aClass, String aString) {
        // Return constant value specified by the parameter (source is ignored)
        return getParameter();
    }

    @Override
    public Class convertFrom(String aString, Class aClass) {
        throw new UnsupportedOperationException(
                "OneWayStringConstantConverter should only be used in one-way mappings");
    }
} 
```

...调用者：

```
 <field custom-converter="full.path.to.OneWayStringConstantConverter"
         custom-converter-param="My constant string value">
     <a>class</a> <!-- Source not used: Converter only sets target of a one-way mapping -->
     <b>targetField</b>
  </field> 
```

建议使用该`class`值作为虚拟“源字段”，因为它尚未使用，但`getClass()`方法保证存在于任何对象上。

我需要为布尔值做这件事，所以使用了这个：

```
/**
 * Custom one-way Dozer converter which maps to the constant boolean value (true or false)
 * specified by a parameter.
 */
public class OneWayBooleanConstantConverter extends DozerConverter<Class, Boolean> {

    public OneWayBooleanConstantConverter() {
        super(Class.class, Boolean.class);
    }

    @Override
    public Boolean convertTo(Class aClass, Boolean aBoolean) {
        // Return constant boolean value specified by the parameter (source is ignored)
        return Boolean.parseBoolean(getParameter());
    }

    @Override
    public Class convertFrom(Boolean aBoolean, Class aClass) {
        throw new UnsupportedOperationException(
                "OneWayBooleanConstantConverter should only be used in one-way mappings");
    }
} 
```

# sql - SQL查询使列中的所有数据大写？

> ID：858528
> 
> 赞同：90
> 
> 时间：2009-05-13T15:03:20.797
> 
> 标签：sql, uppercase

我需要一个 SQL 查询来使列中的所有数据都大写？

有任何想法吗？

* * *

## 回答 #1

> 赞同：206
> 
> 时间：2009-05-13T15:05:45.237

永恒的：

```
UPDATE
  MyTable
SET
  MyColumn = UPPER(MyColumn) 
```

暂时的：

```
SELECT
  UPPER(MyColumn) AS MyColumn
FROM
  MyTable 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2014-07-16T20:14:55.783

如果您只想*更新当前不是大写*的行（而不是所有行），则需要使用[`COLLATE`](https://docs.microsoft.com/en-us/sql/t-sql/statements/collations)以下方式识别差异：

```
UPDATE MyTable
SET    MyColumn = UPPER(MyColumn)
WHERE  MyColumn != UPPER(MyColumn) COLLATE Latin1_General_CS_AS 
```

* * *

### 关于排序规则

区分大小写取决于您的排序规则设置，默认情况下通常不区分大小写。

排序规则可以在[服务器、数据库、列或查询](https://www.webucator.com/how-to/how-check-case-sensitivity-sql-server.cfm)级别设置：

```
-- Server
SELECT SERVERPROPERTY('COLLATION')
-- Database
SELECT name, collation_name FROM sys.databases
-- Column 
SELECT COLUMN_NAME, COLLATION_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE CHARACTER_SET_NAME IS NOT NULL 
```

[排序规则名称](https://docs.microsoft.com/en-us/sql/t-sql/statements/sql-server-collation-name-transact-sql)指定应如何编码和读取字符串，例如：

*   `Latin1_General_***CI***_AS`→ 不区分大小写
*   `Latin1_General_***CS***_AS`→ 区分大小写

# .net - .NET Framework 版本问题

> ID：858535
> 
> 赞同：1
> 
> 时间：2009-05-13T15:04:19.903
> 
> 标签：.net, iis, version

我正在使用 IIS 7.0 + Windows Server 2008 x64。我已经在我的机器上安装了 .NET Framework 3.5，但是从 IIS 7.0 应用程序池 .NET 框架设置中，我只能将版本设置为 v1.0 或 v2.0。为什么我不能设置为 v3.5 版本——这是我在我的机器上安装的最新版本的 .NET 框架？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-13T15:06:24.877

CLR 的版本（最新的是 2.0）和 .NET 框架的版本（最新的是 3.5）是有区别的。

相关帖子可以在这里找到：

[ASP.net 2.0 版是什么意思？](https://stackoverflow.com/questions/801114/what-is-meant-by-asp-net-version-2-0)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T15:09:34.780

3.0 和 3.5 版本只是 2.0 框架之上的额外 dll。因此，您只会在 IIS 中看到 2.0 作为选项。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T15:12:32.620

.NET Framework 3.x = .NET Framework 2.0 + 新功能（WPF、WF、WCF 等）

所以不用担心。IIS 中的版本选择器不会显示 3.x 版本。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-13T15:13:00.250

IIS 关心的只是 CLR 的版本，而不是您可能加载或不加载到计算机上的库的版本。所以它只会显示 CLR 的不同版本，而不是各种库的不同版本。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-13T15:31:39.703

要回答 George2 在一个地方留给其他每个答案的评论：

是的。公共语言**运行时**需要是 2.0（目前不能更高，因为这是目前最新的）。

是的。您可以将 .NET Framework 视为 SDK，如果这样更容易的话。这不是很准确，但是......

是的。您将在 CLR 2.0 上部署您的 Framework 3.5 功能。令人困惑，但那是微软给你的。他们做了（一些）很棒的工作，但*似乎很*喜欢用任意版本控制混淆用户。

# .htaccess - 如何在 .htaccess 中正确映射不存在的文件？

> ID：858544
> 
> 赞同：0
> 
> 时间：2009-05-13T15:06:20.680
> 
> 标签：.htaccess, mod-rewrite

### 复制：

> [如何将不存在的文件重写为“默认”文件？(.htaccess)](https://stackoverflow.com/questions/857709/how-to-rewrite-non-existant-files-to-default-files-htaccess)

如果文件不存在，我将如何“重写”到某个位置？我不想使用 404 重定向，而是实际重写。

例如，假设它是一个包含图像的目录。如果找不到图像，那么它会重写为默认图像吗？

IE，

```
images/1.jpg 
images/2.jpg 
images/default.jpg 
```

如果有人试图访问“website.com/images/3.jpg”，因为它不存在，我希望它转到：“website.com/images/default.jpg”

这是以前的“发布”解决方案，但效果不佳：

```
RewriteCond %{REQUEST_FILENAME} !-f [NC] 
RewriteRule /images/.* /images/error.jpg [L] 
```

它仍然没有“获得”正确的图像（只是作为常规 404 请求）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T12:53:04.970

```
RewriteCond %{REQUEST_FILENAME} !-f [NC] 
RewriteRule ^images/.* /images/error.jpg [L] 
```

显然，如果丢失的文件位于 /images/... 下，这只会重定向，但您可以根据自己的需要轻松修改它

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T15:11:48.223

好吧，您之前发布的解决方案是正确的，但它有点疯狂。尝试这个：

```
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule images/.* /images/default.jpg [L] 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T12:58:59.970

如果文件确实不存在，您最好发送 404 状态代码，而不是仅仅用 404 以外的状态代码替代。否则 URL 将被视为有效。

所以在你的情况下，我建议你[`ErrorDocument`](http://httpd.apache.org/docs/2.2/mod/core.html#errordocument)设置`images`设置为默认图像：

```
<Directory "/path/to/your/images/">
    ErrorDocument 404 /images/default.jpg
</Directory> 
```

但请注意，[`<Directory>`块](http://httpd.apache.org/docs/2.2/mod/core.html#directory)仅在服务器或虚拟主机配置上下文中可用，而不是每个目录上下文（因此为 .htaccess）。

如果您无法使用上述内容，您可以使用自定义脚本作为自定义错误文档来检查请求的 URL（请参阅`Request_URI`环境变量）并在必要时发送默认图像。该`ErrorDocument`指令应如下所示：

```
ErrorDocument 404 /your-error-404.script 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T15:11:42.590

为您的图像文件夹重新编写 404 文档：

（在图像文件夹中的 .htaccess 文件中）
ErrorDocument 404 default.jpg

# c# - 如何裁剪部分gif图像？

> ID：858563
> 
> 赞同：2
> 
> 时间：2009-05-13T15:10:46.463
> 
> 标签：c#, .net, image, pixel, crop

*大家好，*

我写了一些代码来将大图像裁剪为小图像。

一切正常，但是当我尝试 GIF 图像时，出现以下异常

"**不能从具有索引像素格式的图像创建 Graphics 对象。** "

我正在使用 Graphics 类来执行此操作

```
Graphics gfx = Graphics.FromImage(croppedBitmap) 
```

谢谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T15:38:19.397

GIF 图像的像素不是 RGB 值，它们是存储在文件头中的颜色表数组的索引。图形对象仅支持非索引像素格式。如果要使用 Graphic 对象，则必须将图像转换为非索引像素格式。

这正是这个人所做的： [http ://www.codeproject.com/KB/cs/WriteTextToGif.aspx?display=PrintAll](http://www.codeproject.com/KB/cs/WriteTextToGif.aspx?display=PrintAll)

# java - 如何在 Java 中创建一个新列表

> ID：858572
> 
> 赞同：857
> 
> 时间：2009-05-13T15:12:45.443
> 
> 标签：java, list, collections

我们创建一个`Set`：

```
Set myset = new HashSet() 
```

我们如何`List`在 Java 中创建一个？

* * *

## 回答 #1

> 赞同：1108
> 
> 时间：2009-05-13T15:15:38.997

```
List myList = new ArrayList(); 
```

或使用泛型（[Java 7](https://docs.oracle.com/javase/tutorial/java/generics/types.html#diamond)或更高版本）

```
List<MyType> myList = new ArrayList<>(); 
```

或使用泛型（旧 Java 版本）

```
List<MyType> myList = new ArrayList<MyType>(); 
```

* * *

## 回答 #2

> 赞同：537
> 
> 时间：2009-05-13T15:18:06.340

此外，如果您想创建一个包含内容的列表（尽管它将是固定大小）：

```
List<String> messages = Arrays.asList("Hello", "World!", "How", "Are", "You"); 
```

* * *

## 回答 #3

> 赞同：197
> 
> 时间：2013-05-29T19:48:56.453

让我总结一下并补充一点：

**[JDK](http://docs.oracle.com/javase/7/docs/)**

```
1\. new ArrayList<String>();
2\. Arrays.asList("A", "B", "C") 
```

**[番石榴](http://code.google.com/p/guava-libraries/)**

```
1\. Lists.newArrayList("Mike", "John", "Lesly");
2\. Lists.asList("A","B", new String [] {"C", "D"}); 
```

**不可变列表**

```
1\. Collections.unmodifiableList(new ArrayList<String>(Arrays.asList("A","B")));
2\. ImmutableList.builder()                                      // Guava
            .add("A")
            .add("B").build();
3\. ImmutableList.of("A", "B");                                  // Guava
4\. ImmutableList.copyOf(Lists.newArrayList("A", "B", "C"));     // Guava 
```

**空的不可变列表**

```
1\. Collections.emptyList();
2\. Collections.EMPTY_LIST; 
```

**人物列表**

```
1\. Lists.charactersOf("String")                                 // Guava
2\. Lists.newArrayList(Splitter.fixedLength(1).split("String"))  // Guava 
```

**整数列表**

```
Ints.asList(1,2,3);                                             // Guava 
```

* * *

## 回答 #4

> 赞同：87
> 
> 时间：2018-02-07T21:12:51.173

### 在 Java 8 中

创建固定大小的非空列表（不支持添加、删除等操作）：

```
List<Integer> list = Arrays.asList(1, 2); // but, list.set(...) is supported 
```

创建一个非空的可变列表：

```
List<Integer> list = new ArrayList<>(Arrays.asList(3, 4)); 
```

### 在 Java 9 中

使用新的[`List.of(...)`](https://docs.oracle.com/javase/9/docs/api/java/util/List.html#of-E...-)静态工厂方法：

```
List<Integer> immutableList = List.of(1, 2);

List<Integer> mutableList = new ArrayList<>(List.of(3, 4)); 
```

### 在 Java 10 中

使用[局部变量类型推断](https://developer.oracle.com/java/jdk-10-local-variable-type-inference.html)：

```
var list1 = List.of(1, 2);

var list2 = new ArrayList<>(List.of(3, 4));

var list3 = new ArrayList<String>(); 
```

并遵循最佳实践...

### [不要使用原始类型](https://stackoverflow.com/questions/2770321/what-is-a-raw-type-and-why-shouldnt-we-use-it)

自 Java 5 以来，泛型已成为该语言的一部分——您应该使用它们：

```
List<String> list = new ArrayList<>(); // Good, List of String

List list = new ArrayList(); // Bad, don't do that! 
```

### [程序接口](https://stackoverflow.com/questions/383947/what-does-it-mean-to-program-to-an-interface)

例如，编程到`List`接口：

```
List<Double> list = new ArrayList<>(); 
```

代替：

```
ArrayList<Double> list = new ArrayList<>(); // This is a bad idea! 
```

* * *

## 回答 #5

> 赞同：31
> 
> 时间：2009-05-13T15:17:30.913

先读[这个](http://java.sun.com/javase/6/docs/api/java/util/List.html)，再读[这个](http://java.sun.com/javase/6/docs/api/java/util/ArrayList.html)和[这个](http://java.sun.com/javase/6/docs/api/java/util/LinkedList.html)。10 次中有 9 次您将使用这两种实现中的一种。

事实上，只需阅读[Sun 的 Collections 框架指南](http://java.sun.com/javase/6/docs/technotes/guides/collections/overview.html)。

* * *

## 回答 #6

> 赞同：22
> 
> 时间：2011-11-21T14:53:39.033

从 Java 7 开始，您可以[进行泛型实例创建的类型推断](http://docs.oracle.com/javase/7/docs/technotes/guides/language/type-inference-generic-instance-creation.html)，因此无需在赋值右侧复制泛型参数：

```
List<String> list = new ArrayList<>(); 
```

固定大小的列表可以定义为：

```
List<String> list = Arrays.asList("foo", "bar"); 
```

对于不可变列表，您可以使用[Guava](https://code.google.com/p/guava-libraries/wiki/ImmutableCollectionsExplained)库：

```
List<String> list = ImmutableList.of("foo", "bar"); 
```

* * *

## 回答 #7

> 赞同：21
> 
> 时间：2009-05-13T15:26:19.353

```
//simple example creating a list form a string array

String[] myStrings = new String[] {"Elem1","Elem2","Elem3","Elem4","Elem5"};

List mylist = Arrays.asList(myStrings );

//getting an iterator object to browse list items

Iterator itr= mylist.iterator();

System.out.println("Displaying List Elements,");

while(itr.hasNext())

  System.out.println(itr.next()); 
```

* * *

## 回答 #8

> 赞同：20
> 
> 时间：2009-05-13T15:55:26.653

[List和](http://java.sun.com/j2se/1.5.0/docs/api/java/util/List.html)[Set](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Set.html)一样只是一个接口。

就像 HashSet 是 Set 的实现，它在添加/查找/删除性能方面具有某些属性，ArrayList 是 List 的裸实现。

如果您查看各个接口的文档，您会发现“所有已知的实现类”，您可以决定哪一个更适合您的需求。

很有可能它是[ArrayList](http://java.sun.com/j2se/1.5.0/docs/api/java/util/ArrayList.html)。

* * *

## 回答 #9

> 赞同：18
> 
> 时间：2015-06-22T06:06:36.067

`List`是一个类似的接口`Set`，具有`ArrayList`和`LinkedList`作为[通用实现](https://docs.oracle.com/javase/tutorial/collections/implementations/list.html)。

我们可以将 List 创建为：

```
 List<String> arrayList = new ArrayList<>();
 List<String> linkedList = new LinkedList<>(); 
```

我们还可以创建一个固定大小的列表：

```
List<String> list = Arrays.asList("A", "B", "C"); 
```

我们几乎总是使用`ArrayList`反对`LinkedList`实现：

1.  `LinkedList`当我们有很多元素时，会为对象使用大量空间并且性能很差。
2.  `LinkedList`与 中的 O(1) 相比，中的任何索引操作都需要 O(n) 时间`ArrayList`。
3.  检查此[链接](https://stackoverflow.com/questions/322715/when-to-use-linkedlist-over-arraylist)以获取更多信息。

上面创建的列表`Arrays.asList`不能在结构上修改，但它的元素仍然可以修改。

## 爪哇 8

根据[doc](https://docs.oracle.com/javase/8/docs/api/java/util/Collections.html#unmodifiableList-java.util.List-)，该方法`Collections.unmodifiableList`返回指定列表的不可修改视图。我们可以像这样得到它：

```
Collections.unmodifiableList(Arrays.asList("A", "B", "C")); 
```

## 爪哇 9

如果我们使用的是**Java 9**，那么：

```
List<String> list = List.of("A", "B"); 
```

## 爪哇 10

如果我们在 Java 10 中，那么该方法`Collectors.unmodifiableList`将返回 Java 9 中引入的真正不可修改列表的实例。查看此[答案以获取有关](https://stackoverflow.com/a/52536126/1216775)**Java 10**中`Collections.unmodifiableList` vs差异的更多信息。`Collectors.unmodifiableList`

 *** * *

## 回答 #10

> 赞同：10
> 
> 时间：2009-05-13T15:15:05.097

```
List list = new ArrayList(); 
```

或使用泛型

```
List<String> list = new ArrayList<String>(); 
```

当然，您也可以将字符串替换为任何类型的变量，例如整数。

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2017-07-14T06:37:47.070

以下是您可以创建列表的一些方法。

*   这将创建一个固定大小的列表，*添加/删除*元素是不可能的，`java.lang.UnsupportedOperationException`如果你尝试这样做，它会抛出一个。

```
 List<String> fixedSizeList = Arrays.asList(new String[] {"Male", "Female"});
    List<String> fixedSizeList = Arrays.asList("Male", "Female");
    List<String> fixedSizeList = List.of("Male", "Female"); //from java9 
```

*   以下版本是一个简单列表，您可以在其中添加/删除任意数量的元素。

    ```
     List<String> list = new ArrayList<>(); 
    ```

*   这是如何`LinkedList`在java中创建一个，如果您需要频繁插入/删除列表中的元素，您应该使用`LinkedList`而不是`ArrayList`

    ```
     List<String> linkedList = new LinkedList<>(); 
    ```

* * *

## 回答 #12

> 赞同：10
> 
> 时间：2019-06-16T06:37:07.100

正如java中数组列表的声明一样

```
public class ArrayList<E> extends AbstractList<E> implements List<E>, RandomAccess, Cloneable, Serializable 
```

有很多方法可以在 java 中创建和初始化数组列表。

```
 1) List list = new ArrayList();

 2) List<type> myList = new ArrayList<>();

 3) List<type> myList = new ArrayList<type>();

 4) Using Utility class

    List<Integer> list = Arrays.asList(8, 4);
    Collections.unmodifiableList(Arrays.asList("a", "b", "c"));

 5) Using static factory method

    List<Integer> immutableList = List.of(1, 2);

 6) Creation and initializing at a time

    List<String> fixedSizeList = Arrays.asList(new String[] {"Male", "Female"});

 Again you can create different types of list. All has their own characteristics

 List a = new ArrayList();
 List b = new LinkedList();
 List c = new Vector(); 
 List d = new Stack(); 
 List e = new CopyOnWriteArrayList(); 
```

* * *

## 回答 #13

> 赞同：9
> 
> 时间：2009-05-13T15:29:00.550

有时——但很少——而不是新的 ArrayList，您可能需要一个新的 LinkedList。从 ArrayList 开始，如果您有性能问题并且有证据表明该列表存在问题，并且对该列表进行了大量添加和删除 - 然后 - 而不是之前 - 切换到 LinkedList 并查看情况是否有所改善。但总的来说，坚持使用 ArrayList，一切都会好起来的。

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2009-05-13T15:14:53.897

一个例子：

```
List somelist = new ArrayList(); 
```

您可以查看[List 的 javadoc](http://java.sun.com/j2se/1.5.0/docs/api/java/util/List.html)`List`并找到包含在 java api中的接口的所有已知实现类。

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2009-08-04T11:55:27.583

使用[Google Collections ，您可以在](http://code.google.com/p/google-collections/)[Lists](http://google-collections.googlecode.com/svn/trunk/javadoc/com/google/common/collect/Lists.html)类中使用以下方法

```
import com.google.common.collect.Lists;

// ...

List<String> strings = Lists.newArrayList();

List<Integer> integers = Lists.newLinkedList(); 
```

可变参数初始化和从`Iterable<T>`.

这些方法的优点是您不需要像使用构造函数那样显式指定泛型参数 - 编译器将从变量的类型推断它。

* * *

## 回答 #16

> 赞同：7
> 
> 时间：2013-08-06T19:13:21.560

作为一个选项，您可以在此处使用双括号初始化：

```
List<String> list = new ArrayList<String>(){
  {
   add("a");
   add("b");
  }
}; 
```

* * *

## 回答 #17

> 赞同：7
> 
> 时间：2014-12-30T14:51:20.257

更多选项可以用 Java 8 做同样的事情，不是更好，也不是更差，只是不同，如果你想对列表做一些额外的工作，[Streams](http://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html)将为你提供更多的选择（过滤器、映射、减少等）

```
List<String> listA = Stream.of("a", "B", "C").collect(Collectors.toList());
List<Integer> listB = IntStream.range(10, 20).boxed().collect(Collectors.toList());
List<Double> listC = DoubleStream.generate(() -> { return new Random().nextDouble(); }).limit(10).boxed().collect(Collectors.toList());
LinkedList<Integer> listD = Stream.iterate(0, x -> x++).limit(10).collect(Collectors.toCollection(LinkedList::new)); 
```

* * *

## 回答 #18

> 赞同：6
> 
> 时间：2013-01-28T16:39:13.977

```
List<Object> nameOfList = new ArrayList<Object>(); 
```

您需要导入`List`和`ArrayList`.

* * *

## 回答 #19

> 赞同：6
> 
> 时间：2017-04-28T00:20:46.760

使用 Java 9，您可以执行以下操作来创建**不可变** `List`对象：

```
List<Integer> immutableList = List.of(1, 2, 3, 4, 5);

List<Integer> mutableList = new ArrayList<>(immutableList); 
```

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2009-05-13T20:01:35.957

有很多方法可以创建 Set 和 List。HashSet 和 ArrayList 只是两个例子。如今，将泛型与集合一起使用也相当普遍。我建议你看看它们是什么

这是对 java 的内置集合的一个很好的介绍。[http://java.sun.com/javase/6/docs/technotes/guides/collections/overview.html](http://java.sun.com/javase/6/docs/technotes/guides/collections/overview.html)

* * *

## 回答 #21

> 赞同：5
> 
> 时间：2014-07-03T12:52:52.530

```
List arrList = new ArrayList(); 
```

最好使用如下建议的泛型：

```
List<String> arrList = new ArrayList<String>();

arrList.add("one"); 
```

如果您使用 LinkedList。

```
List<String> lnkList = new LinkedList<String>(); 
```

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2015-12-10T16:37:01.013

使用[Eclipse Collections](http://www.eclipse.org/collections/)，您可以像这样创建一个列表：

```
List<String> list1 = Lists.mutable.empty();
List<String> list2 = Lists.mutable.of("One", "Two", "Three"); 
```

如果你想要一个不可变的列表：

```
ImmutableList<String> list3 = Lists.immutable.empty();
ImmutableList<String> list4 = Lists.immutable.of("One", "Two", "Three"); 
```

您可以通过使用原始列表来避免自动装箱。以下是创建 int 列表的方法：

```
MutableIntList list5 = IntLists.mutable.empty();
MutableIntList list6 = IntLists.mutable.of(1, 2, 3);

ImmutableIntList list7 = IntLists.immutable.empty();
ImmutableIntList list8 = IntLists.immutable.of(1, 2, 3); 
```

所有 8 个原语都有变体。

```
MutableLongList longList       = LongLists.mutable.of(1L, 2L, 3L);
MutableCharList charList       = CharLists.mutable.of('a', 'b', 'c');
MutableShortList shortList     = ShortLists.mutable.of((short) 1, (short) 2, (short) 3);
MutableByteList byteList       = ByteLists.mutable.of((byte) 1, (byte) 2, (byte) 3);
MutableBooleanList booleanList = BooleanLists.mutable.of(true, false);
MutableFloatList floatList     = FloatLists.mutable.of(1.0f, 2.0f, 3.0f);
MutableDoubleList doubleList   = DoubleLists.mutable.of(1.0, 2.0, 3.0); 
```

**注意：**我是 Eclipse Collections 的提交者。

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2018-01-18T11:50:48.560

试试这个：

```
List<String> messages = Arrays.asList("bla1", "bla2", "bla3"); 
```

或者：

```
List<String> list1 = Lists.mutable.empty(); // Empty
List<String> list2 = Lists.mutable.of("One", "Two", "Three"); 
```

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2018-08-03T21:26:24.637

如果您需要具有单个实体的可序列化、不可变列表，您可以使用：

```
List<String> singList = Collections.singletonList("stackoverlow"); 
```

# nhibernate - Unity 和 NHibernate

> ID：858577
> 
> 赞同：0
> 
> 时间：2009-05-13T15:13:29.967
> 
> 标签：nhibernate, prism, unity-container

我正在寻找配置 Microsoft.Practices.Unity.IUnityContainer 以管理 asp.net 应用程序的 nHibernate ISessionFactory 生命周期的最佳方法。我还希望统一注入我的 IDataLayer 实现，该实现通过在其托管的 ISessionFactory 上调用 GetCurrentSession 来获取 NHibernate.ISession 的实例。

请在您的答案中包含代码:-)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-10-12T10:31:26.927

You can also use a direct dependency to ISession and use some NHConversationLifetimeManager. Or look at Spring's ISession management (the Java one for instance). I think they already worked on this subject (ie Hibernate ISession & Dependency Injection).

Sorry, no code!

# ms-word - 如何使用 Sphinx 生成 Microsoft Word 文档

> ID：858579
> 
> 赞同：25
> 
> 时间：2009-05-13T15:13:49.437
> 
> 标签：ms-word, python-sphinx, documentation-generation

Sphinx 支持几种输出格式：

*   多个 HTML 文件（带`html`或`dirhtml`）
*   乳胶可用于创建`.pdf`或`.ps`
*   文本

我怎样才能获得 Microsoft Word 文件中的输出？

使用另一个文档生成器，我设法生成了一个 html 输出文件，然后使用 Word 应用程序将其转换为 Microsoft Word 格式。

不幸的是，我不知道生成 Word 或 HTML 单页格式的方法。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2017-12-06T12:00:18.313

我使用的解决方案是像评论中提到的andho这样的singlehtml builder，然后使用pandoc将html转换为docx。以下示例假定生成的 html 将位于 _build/singlehtml/index.html

```
make singlehtml
cd _build/singlehtml/
pandoc -o index.docx index.html 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2013-03-13T14:47:59.677

有一个用于生成格式的[Sphinx 扩展](https://github.com/shimizukawa/sphinxcontrib-docxbuilder)`docx`（我没有测试过）和一个[更新的](https://github.com/Liam-Deacon/sphinx-docxbuilder)（我也没有测试过，但看起来它更积极地维护）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-01-11T22:13:21.707

要将重组文本中的文件转换为 MSdoc，我使用`rst2odt`和 next `unoconv`. 看下一个脚本：

```
#!/bin/sh
rst2odt $1 $1.odt
unoconv -f doc $1.odt
rm $1.odt 
```

您可以使用`rst2odt`自己的样式表：`unoconv`OpenOffice 附带，还允许在转换期间应用 Open Office 样式（模板）。只需编辑转换后的文档、更改样式、添加页眉和页脚、将其保存为 ODF 文本文档模板 (OTT) 并将其用作转换的一部分，例如：

```
unoconv -f doc -t template.ott $1.odt 
```

以后使用该模板进行各种转换。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-04-26T17:47:19.867

我意识到这是一个老问题，但我发现 LibreOffice 支持以下转换方式（假设 soffice.exe 在您的路径中）：

```
soffice.exe --invisible --convert-to doc myInputFile.odt 
```

我读过的一些东西说使用--headless 选项而不是--invisible。两者似乎都适用于 Windows。

您可以从 rst2odt.py 脚本开始，然后执行上述操作以转换为 MS Word 文档。

这是 LibreOffice 其他启动选项的链接：http: [//help.libreoffice.org/Common/Starting_the_Software_With_Parameters](http://help.libreoffice.org/Common/Starting_the_Software_With_Parameters)

这是 OpenOffice 支持的文件类型的链接，我相信 LibreOffice 也应该支持： [http ://wiki.services.openoffice.org/wiki/Framework/Article/Filter/FilterList_OOo_3_0](http://wiki.services.openoffice.org/wiki/Framework/Article/Filter/FilterList_OOo_3_0)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-25T13:34:12.497

最好的选择可能是 rst -> odt -> doc

*   将[sphinx 文档转换为 openoffice 格式](http://docutils.sourceforge.net/docs/user/odt.html)。
*   然后用openoffice转换打开odt并保存到Word。但我不知道如何自动执行此操作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-10-27T08:01:09.870

This is a workaround using Calibre ([https://calibre-ebook.com](https://calibre-ebook.com)), which includes a powerful converter. This worked well and most of the formatting are preserved:

*   Generate epub output in Sphinx `make epub`
*   Import epub output into Calibre and then convert epub to docx using inbuilt ebook converter.

Answer is too late for the original question, but people looking at the same problem may find this useful.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-07-14T03:58:44.240

这个答案不是命令行解决方案，它显然不是最好的，但它对我有用并节省了我的时间。生成 html 文件[1](https://stackoverflow.com/questions/858579/do-you-know-a-way-to-generate-microsoft-word-documents-using-sphinx#comment21572250_858579)后，您可以使用浏览器打开生成的 html 并复制整个页面（Crtl + a 和 Ctrl+ c）然后运行 ​​Microsoft Office（或者如果您没有 Microsoft Windows，则使用 live 版本，如我）并粘贴 (Ctrl+v) 到它。

* * *

## 回答 #8

> 赞同：-5
> 
> 时间：2009-05-13T15:28:50.677

我现在不知道 Sphinx 是什么，但你可以创建一个 rtf 文件或 html 文件或类似的东西。

有关更多信息/方法，请参阅以下博文：[办公自动化](http://blogs.msdn.com/johan/archive/2008/10/14/office-automation.aspx)

并从那里：[如何使用 ASP 生成富文本格式 (RTF) 文档以流式传输到 Microsoft Word](http://support.microsoft.com/kb/270906/en-us)

> 本文介绍如何使用 ASP 脚本生成富文本格式 (RTF) 文件，然后将这些文件流式传输到 Microsoft Word。该技术为运行时文档生成提供了 Microsoft Word 服务器端自动化的替代方法。

您不使用 ASP 脚本（谁使用 :-)），而是为了这个想法。

# ruby-on-rails - “黄瓜”可以运行我的 rspec-on-rails 测试吗？

> ID：858584
> 
> 赞同：3
> 
> 时间：2009-05-13T15:14:44.413
> 
> 标签：ruby-on-rails, ruby, rspec, cucumber

我有一个小测试项目，我用它来测试一个更大的项目的水域。我正在使用 rspec on rails 进行测试，但最近研究了 Cucumber。它看起来很不错，但我想知道是否有办法让 cucumber 运行我的规范测试，或者让 rspec (autospec) 运行我的 cucumber 功能。我环顾四周，但还没有找到一个可靠的结论。

谢谢，

麦克风

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-13T21:35:37.550

我也一直在尝试黄瓜。它支持自动测试：

```
AUTOFEATURE=true autospec 
```

这会连续运行 rspec 和 cucumber 测试套件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T17:33:44.247

一个简单的方法是创建一个调用这两个工具的 Rake 任务，例如这个最小的例子：

```
desc 'Run rspec + cucumber'
task :build => [:spec, :features] 
```

然后您可以使用以下方式构建两者：

```
rake build 
```

RSpec 和 Cucumber 都带有一些适用于 Rails 的默认任务，但您可以[自定义任务](http://wiki.github.com/aslakhellesoy/cucumber/using-rake)以满足您的需求。这里有更多关于编写 rake 任务的[信息](http://martinfowler.com/articles/rake.html)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-11-08T21:09:32.000

取决于您要查找的内容，但使用 rspec 运行 cucumber 测试的最佳方法是使用 turnip，它使用与 cucumber 完全相同的功能语法（语法称为 gherkin），但允许您使用大部分功能rspec。[https://github.com/jnicklas/turnip](https://github.com/jnicklas/turnip)。

如果您想更进一步，您可以`_spec.rb`使用我们创建的名为 rutabaga 的 gem 从 rspec 文件中运行您的功能。[https://github.com/simplybusiness/rutabaga](https://github.com/simplybusiness/rutabaga)

在这两种情况下，所有测试都可以通过执行`rspec`或`bundle exec rspec`根据需要运行。

# java - 如何更改 ScrolledComposite 的水平滚动增量？

> ID：858591
> 
> 赞同：1
> 
> 时间：2009-05-13T15:15:40.790
> 
> 标签：java, eclipse, scroll, swt

我有一个显示 ScrolledComposite 的应用程序。用户抱怨水平滚动增量太细，即每次单击水平滚动箭头当前一次移动条一个像素。他们希望单独的点击引起更大的水平移动。有人可以解释我如何实现这个吗？代码片段如下：

```
ScrolledComposite myScrolledComposite = new ScrolledComposite(parent, 
        SWT.H_SCROLL | SWT.V_SCROLL | SWT.BORDER);

if ( myScrolledComposite == null) {
    throw new NullPointerException("ScenePreView.java:  " + 
            "Method createPartControl()  " + 
            "ScrolledComposite myScrolledComposite == null."); 
}

Composite myComposite = new Composite(myScrolledComposite, SWT.NONE);

if ( myComposite == null) {
    throw new NullPointerException("ScenePreView.java:  " + 
            "Method createPartControl()  " + 
            "Composite myComposite == null."); 
}

myScrolledComposite.setContent(myComposite); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-08-25T21:14:42.307

这应该可以很好地工作并提供可用的默认值。当 ScrolledComposite 中的控件调整大小时，它应该会自动更新。

```
myComposite.addControlListener( new ControlAdapter() {
    @Override
    public void controlResized( ControlEvent e ) {
        ScrollBar sbX = scrolledComposite.getHorizontalBar();
        if ( sbX != null ) {
            sbX.setPageIncrement( sbX.getThumb() );
            sbX.setIncrement( Math.max( 1, sbX.getThumb() / 5 ) );
        }
    }
}); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T15:58:54.167

从组合中获取滚动条并设置它的增量。

myScrolledComposite.getVerticalBar().setIncrement(10);

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T15:53:58.047

使用 SWT Scrollbar 类的 setIncrement() 方法。这使您可以修改按下箭头按钮时滚动区域的移动量。 [请参阅 SWT 的 API 参考](http://help.eclipse.org/help32/index.jsp?topic=/org.eclipse.platform.doc.isv/reference/api/org/eclipse/swt/widgets/ScrollBar.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T16:04:10.180

我知道这超出了您的要求，但我强烈建议您查看具有平滑滚动实现的[SWT 动画工具包。](http://blog.richeton.com/swt-animation-toolkit/)它将使您的应用程序更酷。

您可以查看它并查看来源 - 这是一个很好的例子（但有点高级）如何使用滚动。

# windows - Windows malloc 替换（例如 tcmalloc）和动态 crt 链接

> ID：858592
> 
> 赞同：24
> 
> 时间：2009-05-13T15:15:45.283
> 
> 标签：windows, dll, malloc, msvcrt, crt

使用多个 DLL 和 QT 的 C++ 程序应配备 malloc 替代品（如[tcmalloc](http://code.google.com/p/google-perftools/)），以解决可验证为由 Windows malloc 引起的性能问题。使用 linux，没有问题，但是使用 windows，有几种方法，我发现它们都不吸引人：

**1.将新的malloc放入lib并确保首先链接它[（其他SO问题）](https://stackoverflow.com/questions/120627/is-there-a-way-to-redefine-malloc-at-link-time-on-windows)**

这有一个缺点，例如[strdup 仍将使用旧的 malloc 并且 free 可能会使程序崩溃](http://benjamin.smedbergs.us/blog/2008-01-10/patching-the-windows-crt/)。

**2\. 使用 lib.exe (Chrome) 从静态 libcrt 库中删除 malloc**

[这已针对chrome/chromium](http://groups.google.com/group/google-perftools/browse_thread/thread/41cd3710af85e57b)进行了测试/使用（？），但缺点是它仅适用于静态链接 crt。如果一个系统库与 msvcrt 动态链接，则静态链接会出现问题[，堆分配/释放中可能存在不匹配](https://stackoverflow.com/questions/787216/should-i-link-to-the-visual-studio-c-runtime-statically-or-dynamically)。如果我理解正确，tcmalloc 可以动态链接，这样所有自编译的 dll 都有一个公共堆（这很好）。

**3.补丁crt-源码（firefox）**

[Firefox 的 jemalloc](http://benjamin.smedbergs.us/blog/2008-01-10/patching-the-windows-crt/)显然修补了 windows CRT 源代码并构建了一个新的 crt。这又出现了上面的静态/动态链接问题。

可以考虑使用它来生成动态 MSVCRT，但我认为这是不可能的，因为许可证禁止提供具有相同名称的修补 MSVCRT。

**4.在运行时动态修补加载的CRT**

一些商业内存分配器可以做到这一点。tcmalloc 也可以，但这看起来相当难看。它有一些问题，但它们已得到修复。目前，使用 tcmalloc 它不能在 64 位窗口下工作。

有更好的方法吗？任何意见？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-19T12:23:24.850

问：跨多个 dll 拆分的 C++ 程序应该：

A）替换malloc？

B) 确保分配和解除分配发生在同一个 dll 模块中？

答：正确答案是 B。包含多个 DLL 的 c++ 应用程序设计应该确保存在一种机制，以确保在一个 dll 中的堆上分配的东西被同一个 dll 模块释放。

* * *

你为什么要把一个 c++ 程序分成几个 dll 呢？通过 c++ 程序，我的意思是您正在处理的对象和类型是 c++ 模板、STL 对象、类等。如果没有大量非常仔细的设计和大量编译器特定的魔法，或者遭受痛苦，您就无法跨 dll 边界传递 c++ 对象由于各种 dll 中目标代码的大量重复，因此应用程序对版本非常敏感。对类定义的任何微小更改都将强制重新构建所有 exe 和 dll，从而消除 dll 方法对应用程序开发的至少一个主要好处。

要么坚持应用程序和 dll 之间的直接 C 接口，受苦受难，要么只是将整个 c++ 应用程序编译为一个 exe。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-09-09T23:36:54.340

这是一个大胆的主张，即 C++ 程序“应该配备 malloc 替代品（如 tcmalloc）以解决性能问题......”

> “[在] 8 个流行基准测试中的 6 个……[实际大小的应用程序] 替换了人们在其中投入了大量时间和金钱的自定义分配器，……使用系统提供的哑分配器 [yielded]更好的性能......最简单的自定义分配器，针对非常特殊的情况进行调整，是唯一可以提供收益的分配器。” ——[安德烈·亚历山德雷斯库](http://video.google.com/videoplay?docid=8718136231005757634)

大多数系统分配器与*通用*分配器差不多。*只有*当你有一个非常具体的分配模式时，你才能做得更好。

通常，此类特殊模式仅适用于程序的一部分，在这种情况下，最好将自定义分配器应用于可以受益的特定部分，而不是全局替换分配器。

C++ 提供了一些选择性地替换分配器的方法。例如，您可以为 STL 容器提供分配器，或者您可以逐个类地覆盖 new 和 delete。与全局替换分配器的任何 hack 相比，这两者都为您提供了更好的控制。

另请注意，替换 malloc 和 free 不一定会更改运算符 new 和 delete 使用的分配器。虽然全局 new 运算符通常使用 malloc 实现，但并不要求它这样做。因此替换 malloc 甚至可能不会影响大多数分配。

如果您使用的是 C，您可以在重要的地方使用自定义分配器包装或替换密钥 malloc 和 free 调用，并让程序的其余部分使用默认分配器。（如果不是这种情况，您可能需要考虑进行一些重构。）

系统分配器背后有几十年的发展。它们稳定且经过良好测试。它们在一般情况下表现得非常好（在原始速度、线程争用和碎片方面）。他们有用于泄漏检测的调试版本和对跟踪工具的支持。有些甚至通过提供针对堆缓冲区溢出漏洞的防御来提高应用程序的安全性。很有可能，您要使用的库仅使用系统分配器进行了测试。

大多数替换系统分配器的技术丧失了这些好处。在某些情况下，它们甚至会增加内存需求（因为它们不能与其他进程可能使用的 DLL 运行时共享）。面对编译器版本、运行时版本甚至操作系统版本的变化，它们也往往非常脆弱。使用经过调整的运行时版本会阻止您的用户从操作系统供应商处获得运行时更新的好处。当您可以通过将自定义分配器应用到程序中可以从中受益的特殊部分来保留这些好处时，为什么要放弃所有这些呢？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-16T02:51:15.710

您的前提“使用多个 DLL 和 QT 的 C++ 程序应配备 malloc 替代品”从何而来？

在 Windows 上，如果所有 dll 都使用共享的 MSVCRT，则无需替换 malloc。默认情况下，Qt 针对共享的 MSVCRT dll 构建。

如果他们：

1) 混合使用静态链接与使用共享 VCRT 的 dll

2)以及未在其来源处分配的空闲内存（即，由共享**VCRT**分配的静态链接 dll 中的空闲内存，反之亦然）。

请注意，在资源周围添加您自己的引用计数包装器可以帮助缓解与需要以特定方式释放的资源相关的问题（即，通过回调原始 dll 来处理一种类型资源的包装器，不同的来自另一个 dll 的资源的包装器等）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-20T12:24:06.573

内德马洛克？还要注意 smplayer 使用一个特殊的补丁来覆盖 malloc，这可能是你前进的方向。

# linux - 将进程运行所需的秒数保存在变量中

> ID：858594
> 
> 赞同：8
> 
> 时间：2009-05-13T15:16:14.673
> 
> 标签：linux, bash, time

我想在 bash 中运行一个进程并将运行所需的秒数保存在一个环境变量中。我怎么会做这样的事情？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-05-13T15:24:03.553

你想把这段代码放在你的脚本中，还是从启动脚本的过程中开始？

对于后者，您可以使用“时间”保留字，然后解析它返回的内容以获取脚本花费的时间。

如果您想从脚本中执行此操作，您可以将变量 SECONDS 设置为零，此后每次引用该变量时，它将更新为经过的秒数。因此，您可以将“SECONDS=0”放在脚本的最开始，当您需要经过时间时，它将位于 SECONDS 变量中。

您也可以在命令行上使用 $SECONDS 技巧，例如：

```
$ SECONDS=0; sleep 5 ; echo "that took approximately $SECONDS seconds" 
```

时间保留字和 SECONDS 变量都记录在 bash 手册页中。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-13T15:32:35.147

这适用于 Bash，也适用于 Zsh：

```
# Set time format to seconds
TIMEFORMAT=%R
# Time a process
PROC_TIME=$(time (insert command here >/dev/null 2>&1) 2>&1)
echo $PROC_TIME 
```

*   前两个重定向隐藏了进程的输出 ">/dev/null 2>&1"
*   需要最后一次重定向，因为“时间”在 stderr 上打印时间

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T15:40:26.477

使用[GNU 时间](http://www.gnu.org/software/time/)，

```
\time -p -o time.log $COMMAND 
```

然后阅读`time.log`。

（使用`\time`or `command time`，否则你将使用 Bash 的`time`内置，它不支持这些选项。）

即使`$COMMAND`打印到 stderr （这会混淆 Oli 的答案）并保留 stdout/stderr （Farzy 的答案没有），这也会起作用。

`-o ...`告诉`time`将其输出发送到文件而不是标准错误（默认情况下），并`-p`生成传统的

```
real 0.00
user 0.00
sys 0.00 
```

而不是 GNU 时间的默认值

```
0.00user 0.00system 0:00.01elapsed 8%CPU (0avgtext+0avgdata 0maxresident)k
80inputs+0outputs (1major+188minor)pagefaults 0swaps 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-01-24T19:40:17.113

在运行的脚本中使用`$SECONDS`对我不起作用`cron`（尽管当我直接运行它时它起作用了；我`cron`今天第一次使用，所以也可能存在一些用户错误）。@Farzy's answer using working，`TIMEFORMAT`但我不想重定向定时命令的输出。`$SECONDS`如果您处于类似情况，可以使用以下方法：

```
start=$(date +%s)
your_command
seconds=$(($(date +%s) - $start)) 
```

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-05-13T15:33:17.033

使用时间命令。请注意，bash 版本的 time 与 /usr/bin/time 不同。所以你会有类似的东西：

```
TIME=`/usr/bin/time --format="%e" your_command_here >/dev/null` 
```

该格式只是将“实时”时间值拉出来。如果您想做的不仅仅是显示它，则需要将其从字符串转换。

如果您只想导出字符串，请使用`export`.

# c# - 为什么我的 Windows 服务不会写入我的日志文件？

> ID：858597
> 
> 赞同：29
> 
> 时间：2009-05-13T15:16:24.237
> 
> 标签：c#, logging, windows-services, service, nlog

我有一个 Windows 服务并使用 nlog 进行日志记录。当我从 Visual Studio IDE 运行时，一切正常。日志文件更新没有问题。当我安装服务时，服务运行良好，但日志文件永远不会更新。如果有帮助，我正在本地服务下运行。是的，我已经在我的应用程序文件夹下创建了日志目录。

```
 <?xml version="1.0" encoding="utf-8" ?>
 <nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >

  <targets>
    <target name="file" xsi:type="File" fileName="${basedir}/logs/${shortdate}_info.txt"
            layout="${date} ${logger} ${message}" />
  </targets>

  <rules>
    <logger name="*" minlevel="Info" maxlevel="Info" writeTo="file" />
  </rules>
</nlog> 
```

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-05-13T16:17:03.123

我也遇到过这个问题。正如 genki 所提到的，您可能正在登录到 \Windows\System32 目录。也许首先检查您期望在那里的日志文件。在编写服务时，我经常在开头放这样一行，让当前目录表现得像一个普通的应用程序

```
Directory.SetCurrentDirectory(AppDomain.CurrentDomain.BaseDirectory); 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-05-13T15:20:21.533

您的本地服务帐户无权写入指定的文件位置。您可以在服务属性对话框的“登录”选项卡中将其设置为使用系统帐户，或者您可以将用户帐户设置为设置过程的一部分。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2011-04-09T10:30:01.300

如果您使用的是 x64 版本的 Windows，则日志文件保存在 C:\Windows\SysWOW64 文件夹中

如果您使用**AnyCPU**配置构建项目并部署到 64 位操作系统，这是默认情况。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-13T15:34:19.340

您可以使用[Process Monitor](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx "系统内部")查看正在执行的文件操作，以及它们失败的原因。

我会怀疑（与其他回答者一起）这是一个权限问题，服务帐户没有足够的文件访问权限。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-13T16:08:37.927

只是出于好奇，您是否检查过Windows安装的system32目录中是否有任何内容？Iirc，这是服务的默认应用程序运行时基目录...

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-05-24T21:00:10.270

我刚刚在企业框架日志记录方面遇到了同样的问题。

总结这个问题，其中的答案一起讲述了正确的故事。

在您使用 Visual Studio IDE 的示例中，正在使用应用程序的用户权限写入日志文件，并且正在写入日志文件。

Windows 服务没有这些相同的权限，因此不会写入日志文件。Windows 服务确实有权（我已经对此进行了测试）写入

```
AppDomain.CurrentDomain.BaseDirectory 
```

使用 System.IO 命名空间。

因此，将日志文件定向到此基本目录，您将是安全的。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-02-11T21:50:32.873

当我遇到同样的问题时，我发现这篇文章很有帮助：

[http://nlog-forum.1685105.n2.nabble.com/Nlog-not-working-with-Windows-service-tp6711077p6825698.html](http://nlog-forum.1685105.n2.nabble.com/Nlog-not-working-with-Windows-service-tp6711077p6825698.html)

基本上，您需要在配置中包含 ${basedir} 作为文件位置的一部分。这将使 NLog 从您的可执行文件运行的位置开始。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-13T15:20:49.363

您是否尝试过以不同的命名用户身份安装/运行您的服务。

如果可行，那么您可以确定您的本地系统帐户没有权限写入目录/文件的权限问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-10-08T07:10:55.693

这可能是您的服务在其他用户上下文下运行，也可能是由于 Windows 限制。我有同样的问题并解决了它登录到以下文件夹：

```
Environment.GetFolderPath(Environment.SpecialFolder.CommonApplicationData) 
```

也许这会对你有所帮助。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-02-20T21:20:38.587

在为我的服务创建安装项目并多次安装后，我终于意识到我没有将 NLog.config 文件作为要安装的文件之一包含在内。现在它与可执行文件一起包含，它运行良好。

值得一提的是，事后可以手动添加 NLog.config 文件，但可能需要停止并重新启动服务。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-05-09T08:35:18.480

我有一个非常密切相关的问题。我的 NLOG 看起来像这样：

```
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.nlog-project.org/schemas/NLog.xsd NLog.xsd"
  autoReload="true"
  throwExceptions="false"
  internalLogLevel="Off"
  internalLogFile="c:\temp\nlog-internal.log">

<targets>
<!-- Write events to a file with the date in the filename -->
<target xsi:type="File"
  name="File"
  fileName="${basedir}/logs/${shortdate}.log"
  layout="${longdate} ${uppercase:${level}} ${message}" />
</targets>

<rules>
<!-- Exception levels: Fatal, Error, Warn, Info, Debug, Trace -->
<logger name="*"
  minlevel="Debug"
  writeTo="File" />
</rules> 
```

这都是与许可相关的。首先，在我安装服务的地方，我必须确保 LOCAL SERVICE 帐户有权读取/写入**Logs**文件夹。

其次，虽然没有写入 internalLogFile，但 Nlog 似乎无论如何都在尝试访问 - 这就是为什么我通过再次确保 LOCAL SERVICE 有权在 **c:\temp** 中读取/写入来解决我的问题

* * *

## 回答 #12

> 赞同：-4
> 
> 时间：2016-03-04T08:45:06.803

嗨，这就是我所做的，它工作得很好你必须创建类库，并在这个类中添加以下方法 ^^

```
 public static void WriteErrorLog(Exception ex)
    {
        StreamWriter sw = null;
        try
        {
            sw = new StreamWriter(AppDomain.CurrentDomain.BaseDirectory + "\\LogFile.txt", true);
            sw.WriteLine(DateTime.Now.ToString() + ":" + ex.Source.ToString().Trim() + ":" + ex.Message.ToString().Trim());
            sw.Flush();
            sw.Close();
        }
        catch
        {

        }
    }
    public static void WriteErrorLog(String Message)
    {
        StreamWriter sw = null;
        try
        {
            sw = new StreamWriter(AppDomain.CurrentDomain.BaseDirectory + "\\LogFile.txt", true);
            sw.WriteLine(DateTime.Now.ToString() + ":"+Message);
            sw.Flush();
            sw.Close();
        }
        catch
        {

        }
    } 
```

在您的服务中，您必须使用 OnStart 方法：

```
Library.WriteErrorLog(" Service Started ");
//and in your OnStop method
     Library.WriteErrorLog(" Service Stoped "); 
```

希望这会有所帮助。

# java - 带有空字段的 JAXB 编组

> ID：858598
> 
> 赞同：48
> 
> 时间：2009-05-13T15:16:39.417
> 
> 标签：java, jaxb, marshalling

这是一个非常简单的请求，但我只是没有找到办法。

我基本上是在尝试在 JAXB 中设置一个角色，即每当遇到空字段时，而不是在输出中忽略它，而是将其设置为空值。所以对于班级：

```
@XMLRootElement
Class Foo {
   Integer num;
   Date date;
….
} 
```

如果日期字段为空，则将其编组到 XML 文件中时，我的输出中没有该元素。我想要做的是在输出中包含所有字段；如果它们为空，请将它们替换为 - 比如说一个空白。所以输出应该是：

```
<foo>
  <num>123</num>
  <date></date>
</foo> 
```

谢谢，

贾尔佩什。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-05-13T22:55:12.133

谢谢你们的回答。

Chris Dail - 我尝试了你的方法，但它并没有真正达到我想要的效果。尽管为我的字段定义了默认值，但 JAXB 仍然忽略了我的空值。

在泽西论坛中有人向我指出文档部分[2.2.12.8 No Value](https://jaxb.dev.java.net/tutorial/section_2_2_12_8-No-Value.html#No%20Value)之后，我确实偶然发现了答案。

基本上，我所要做的就是将以下内容添加到我的字段中：

```
@XmlElement(nillable = true) 
```

一旦我添加了它，JAXB 会在将这些字段编组为 XML 时显示这些字段，如下所示：

```
...
<num>5</num>
<date xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
.... 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-13T15:28:50.300

但是但是但是...空字符串不是日期的有效词法表示，因此您不能这样做。即，如果您生成了一个日期字段为空值的 XML 文档，它将无法正确验证。

换句话说，如果您的`date`元素有`minOccurs`1 或更多而不是`nillable`，那么您绝对必须有（1 个或更多）日期，日期不能为空（或空白或其他非值）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-13T16:45:11.237

如另一个答案所示，它是无效的，因为它不是有效日期。我有一个类似的问题，我想特别处理（相同）。由于不能使用 null，因此可以使用 JAXB 中的默认值机制。如果未指定，以下将默认值。您可以通过代码检测此特殊日期并处理此异常情况。

```
@XmlElement(defaultValue="1970-01-01T00:00:00.0-00:00") 
```

因此可以检测并清空日期值，但您不能使用 null 来执行此操作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-03-05T10:52:29.640

在 MOXy 中，您可以指定 jsonProvider 必须如何为 JAXB 完成工作。

因此，在执行 JAX-RS 时，请在从 Application 派生的类中添加以下代码

我在 Tomcat 7 上使用了这段代码，效果很好。(eclipselink 2.4.1)

```
@ApplicationPath("/rest")
public class RestApplication extends Application
{

  ...

 public Set< Object> getSingletons()
  {

    HashSet<Object> set = new HashSet<Object>(1);
    set.add( newMoxyJsonProvider());

    return set;
  }

 public static MOXyJsonProvider newMoxyJsonProvider()
  {

    MOXyJsonProvider result = new MOXyJsonProvider();

    //result.setAttributePrefix("@");
    result.setFormattedOutput( false);
    result.setIncludeRoot( false);
    result.setMarshalEmptyCollections( true);
    //result.setValueWrapper("$");

    return result;
  } 
```

然而，在 Glassfish 3.1.2 和 WAS 8.5 上，不需要 newMoxyJsonProvider()，但是 JAXB 提供程序由服务器配置。对于 MOXy 附带的 Glassfish，我目睹了同样的空值问题。尚未检查，但猜测答案是尽可能在应用程序服务器级别配置 JAXB。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-08-30T06:43:40.560

尝试这个：

```
marshal.setListener(new MarshallerListener()); 
```

和

```
public class MarshallerListener extends Marshaller.Listener {

    public static final String BLANK_CHAR = "";

    @Override
    public void beforeMarshal(Object source) {
        super.beforeMarshal(source);
        Field[] fields = source.getClass().getDeclaredFields();
        for (Field f : fields) {
            f.setAccessible(true);
            try {
                if (f.getType() == String.class && f.get(source) == null) {
                    f.set(source, BLANK_CHAR);
                }
            } catch (IllegalAccessException e) {
                e.printStackTrace();
            }
        }
    }
} 
```

# c# - 从 HtmlHelper 中创建 url

> ID：858604
> 
> 赞同：0
> 
> 时间：2009-05-13T15:18:45.670
> 
> 标签：c#, .net, asp.net-mvc

我正在创建一个 HtmlHelper 扩展，它应该创建一组指向当前 URL 的链接，但它们的第一个参数具有不同的语言代码。语言代码作为列表传入。

目前我需要传入 UrlHelper 并执行以下操作：

```
/*Warning: HACK*/
RouteValueDictionary vals = html.ViewContext.RouteData.Values;
vals["siteLanguage"] = "replaceMe";
string siteLanUrl = url.RouteUrl(vals).Replace("replaceMe", "{0}");
/*ENDHACK*/ 
```

然后我做了一个字符串替换，所以“{0}”可以用我拥有的语言代码集替换。

由于多种原因，这当然是丑陋的。但我不知道如何使用 HtmlHelper 生成这些 url。有什么建议么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T16:38:43.527

我会为此创建一个助手...

```
public static string LanguageLink(this HtmlHelper html, string text, string languageCode)
{
    var routeValues = new RouteValueDictionary(html.ViewContext.RouteData.Values);
    routeValues["languageCode"] = languageCode;

    string action = routeValues["action"].ToString();
    return html.ActionLink(text, action, routeValues);
} 
```

..然后在您的母版页（或任何地方）...

```
 <%= Html.LanguageLink("English", "en") %> 
 <%= Html.LanguageLink("Spanish", "es") %> 
 <%= Html.LanguageLink("German", "de") %> 
 <%= Html.LanguageLink("French", "fr") %> 
```

这些将链接到相同的控制器/动作和路由值，但会添加语言代码。要让这些生成友好的 URL，您可以将其添加*到默认路由之上*。

```
 routes.MapRoute(
     "languageRoute",                                       
     "{languageCode}/{controller}/{action}/{id}",           
     new { controller = "Home", action = "Index", id = "" },
     new { languageCode = @"\w{2}" }
 ); 
```

（使用这条路线，您将无法匹配任何名称为 2 个字符的控制器，但这可能没问题）。

# c# - 多个 UpdatePanel 和 onload

> ID：858605
> 
> 赞同：0
> 
> 时间：2009-05-13T15:19:02.080
> 
> 标签：c#, asp.net, ajax

我有一个页面，其中有 2 个动态加载的用户控件，每个控件都在它自己的更新面板中。在加载用户控件时，我执行更新表格单元格的 css 的 javascript。

```
ScriptManager.RegisterStartupScript(this.Page, typeof(Page), "Load_RunScript()", true); 
```

两个用户控件都有一个按钮，每个按钮都会导致回发，并且在服务器端执行 JS 进行一些更改。我遇到的问题是，当我单击其中一个用户控件（例如 UCtlA）上的按钮时，回发会导致用户控件被动态重新加载，这会在 UCtlB 中执行 onload 脚本，从而导致页面执行缓慢。

由于 UC 在 UpdatePanels 中，我的理解是 UI 不应该在回发时重新呈现。为什么会发生这种情况，解决方案是什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-13T15:41:55.430

UpdatePanel 会导致类似于页面回发的回发。为避免在 Pageload 中进行不必要的工作，请检查 ScriptManager.IsInAsyncPostback 属性以检测 UpdatePanel 回发。只有导致回发的 UpdatePanel 中的控件应该更新它们的 GUI。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T15:52:28.187

添加 UpdateMode="Conditional" 属性和可能的​​ ChildrenAsTriggers="false"

[http://weblogs.asp.net/alessandro/archive/2008/01/30/reducing-updatepanel-bloat-by-utilizing-updatemode-quot-conditional-quot-and-childrenastriggers-quot-false-quot.aspx](http://weblogs.asp.net/alessandro/archive/2008/01/30/reducing-updatepanel-bloat-by-utilizing-updatemode-quot-conditional-quot-and-childrenastriggers-quot-false-quot.aspx)

老实说，我会说避开 UpdatePanel，因为它们是狗，尤其是嵌套的 UpdatePanel。

# asp.net - 自定义配置部分

> ID：858618
> 
> 赞同：10
> 
> 时间：2009-05-13T15:21:21.453
> 
> 标签：asp.net, configuration

我目前正在尝试在我忙于的项目中实现自定义配置部分，无论我尝试什么，我都会收到以下错误：

{“为 pageAppearanceGroup/pageAppearance 创建配置节处理程序时出错：无法从程序集 'System.Configuration，Version=2.0.0.0，Culture=neutral，PublicKeyToken=b03f5f7f11d50a3a' 加载类型 'Samples.AspNet.PageAppearanceSection'。（E :\三九发展\lastfm\msdn\msdn\bin\Debug\Samples.Aspnet.vshost.exe.config line 6)"}

我已经从这个 MSDN 文章中复制了代码：

[http://msdn.microsoft.com/en-us/library/2tw134k3.aspx](http://msdn.microsoft.com/en-us/library/2tw134k3.aspx)

我仍然得到同样的错误。

我已经尝试了以下文章中的所有建议/指南，但无济于事。
[http://www.evaclosson.com/devlog/bettercustomerrorsinaspnetcustomconfigurationsection](http://www.evanclosson.com/devlog/bettercustomerrorsinaspnetcustomconfigurationsection)

[http://geekswithblogs.net/akraus1/articles/64871.aspx](http://geekswithblogs.net/akraus1/articles/64871.aspx)

这一定是我想念的愚蠢的东西。我正在运行 Vista，这会是一个问题吗？一些晦涩的安全设置？

```
 <configuration>
  <!-- Configuration section-handler declaration area. -->
  <configSections>
    <sectionGroup name="pageAppearanceGroup">
      <section
        name="pageAppearance"
        type="Samples.AspNet.PageAppearanceSection"
        allowLocation="true"
        allowDefinition="Everywhere"
      />
    </sectionGroup>
    <!-- Other <section> and <sectionGroup> elements. -->
  </configSections>

  <!-- Configuration section settings area. -->
  <pageAppearanceGroup>
    <pageAppearance remoteOnly="true">
      <font name="TimesNewRoman" size="18"/>
      <color background="000000" foreground="FFFFFF"/>
    </pageAppearance>
  </pageAppearanceGroup>

</configuration> 
```

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-05-13T15:30:41.733

我的猜测是您已经复制了代码，但是您有不同的程序集名称。发布配置会有所帮助。

我还将在配置中完全质量您的类型（示例未显示的内容）。就像是...

```
<section name="MySection" type="My.Assembly.Type, My.Assembly" /> 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-13T15:36:32.177

您还应该在 CodeProject 上查看 Jon Rista 关于 .NET 2.0 配置的三部分系列。

*   [揭开 .NET 2.0 配置的奥秘](http://www.codeproject.com/KB/dotnet/mysteriesofconfiguration.aspx)
*   [解读 .NET 2.0 配置的奥秘](http://www.codeproject.com/KB/dotnet/mysteriesofconfiguration2.aspx)
*   [破解 .NET 2.0 配置的奥秘](http://www.codeproject.com/KB/dotnet/mysteriesofconfiguration3.aspx)

强烈推荐，写得很好，非常有帮助！

马克

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-12-08T10:40:05.340

请尝试使用以下代码：

```
<configSections>
    <sectionGroup name="pageAppearanceGroup">
         <section name="pageAppearance" type="Samples.AspNet.PageAppearanceSection,Samples.AspNet" allowLocation="true"         allowDefinition="Everywhere"       />
    </sectionGroup>     <!-- Other <section> and <sectionGroup> elements. -->
</configSections> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-12-08T10:46:49.750

请试试这个

```
<configSections>
 <sectionGroup name="pageAppearanceGroup">
  <section name="pageAppearance"
           type="Samples.AspNet.PageAppearanceSection,Samples.AspNet"
           allowLocation="true"
           allowDefinition="Everywhere" />
 </sectionGroup>
 <!-- Other <section> and <sectionGroup> elements. -->
</configSections> 
```

谢谢，韦迪

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-10-11T22:22:09.947

所以事实证明，当你在 Visual Studio 中创建项目时，它会自动为项目定义一个**根命名空间**（默认为项目名称）。因此，您必须在节类型中包含该根名称空间以及您在设置类中定义的任何自定义名称空间。

例如，在原始海报的情况下，他们的工作配置可能看起来像这样：

```
<section name="MySection" type="ROOT_NAMESPACE.Samples.AspNet.PageAppearanceSection, NAME_OF_ASSEMBLY" /> 
```

ROOT_NAMESPACE 和 NAME_OF_ASSEMBLY 在项目属性中定义，如我的项目快照所示。

![程序集名称和根命名空间 Visual Studio](https://i.stack.imgur.com/S7Tcb.jpg)

在我的特殊情况下，我没有在我的项目中明确定义命名空间。因此，我的部分配置设置只有根名称空间、设置类的名称和程序集的名称；

```
<section name="programSettings" type="ShipmentImport.ProgramSettings, ShipmentImport" /> 
```

我知道它晚了几年，但我希望它可以防止其他人像我一样花几个小时在这上面。

# javascript - 查看javascript中的所有超时/间隔？

> ID：858619
> 
> 赞同：99
> 
> 时间：2009-05-13T15:21:28.707
> 
> 标签：javascript, timeout, setinterval

我正在编写一个利用 JavaScript 超时和间隔来更新页面的应用程序。有没有办法查看设置了多少间隔？我想确保我不会通过设置数百个间隔来意外杀死浏览器。

这甚至是一个问题吗？

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2009-05-13T15:27:47.527

我认为没有办法枚举活动计时器，但您可以覆盖`window.setTimeout`并`window.clearTimeout`用您自己的实现替换它们，这些实现会进行一些跟踪，然后调用原始计时器。

```
window.originalSetTimeout = window.setTimeout;
window.originalClearTimeout = window.clearTimeout;
window.activeTimers = 0;

window.setTimeout = function(func, delay) {
    window.activeTimers++;
    return window.originalSetTimeout(func, delay);
};

window.clearTimeout = function(timerID) {
    window.activeTimers--;
    window.originalClearTimeout(timerID);
}; 
```

当然，您可能并不总是调用`clearTimeout`，但这至少可以为您提供一些方法来跟踪运行时发生的事情。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2013-05-23T15:38:16.087

我做了一个显示所有间隔的 Chrome DevTools 扩展。清除的会变灰。

![计时器 Chrome Devtool 扩展](https://i.stack.imgur.com/O0ZRi.png)

**[setInterval-嗅探器](https://github.com/NV/setInterval-sniffer)**

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2016-03-11T10:01:59.097

这里不仅仅是一个计时器计数，而是一个将所有计时器存储到一个数组中的实现。它只显示**活动计时器**`setTimeout`，而接受的答案只计算对&的调用`clearTimeout`。

```
(function(w) {
    var oldST = w.setTimeout;
    var oldSI = w.setInterval;
    var oldCI = w.clearInterval;
    var timers = [];
    w.timers = timers;
    w.setTimeout = function(fn, delay) {
        var id = oldST(function() {
            fn && fn();
            removeTimer(id);
        }, delay);
        timers.push(id);
        return id;
    };
    w.setInterval = function(fn, delay) {
        var id = oldSI(fn, delay);
        timers.push(id);
        return id;
    };
    w.clearInterval = function(id) {
        oldCI(id);
        removeTimer(id);
    };
    w.clearTimeout = w.clearInterval;

    function removeTimer(id) {
        var index = timers.indexOf(id);
        if (index >= 0)
            timers.splice(index, 1);
    }
}(window)); 
```

这是获取页面上**活动计时器计数的方法**：

```
timers.length; 
```

这是**删除所有活动计时器**的方法：

```
for(var i = timers.length; i--;)
    clearInterval(timers[i]); 
```

已知限制：

*   你只能通过`setTimeout`这个猴子补丁传递一个函数（而不是一个字符串）。
*   该功能假设`clearInterval`并`clearTimeout`执行相同的操作，他们会这样做，但将来可能会发生变化。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2011-09-20T15:38:29.463

看到 Paul 只介绍了 setTimeout，我想我会为 setInterval/clearInterval 共享一个计数器。

```
window.originalSetInterval = window.setInterval;
window.originalClearInterval = window.clearInterval;
window.activeIntervals = 0;
window.setInterval = function (func, delay)
{
    if(func && delay){
            window.activeIntervals++;
    }
    return window.originalSetInterval(func,delay);
};
window.clearInterval = function (intervalId)
{
    // JQuery sometimes hands in true which doesn't count
    if(intervalId !== true){
        window.activeIntervals--;
    }
    return window.originalClearInterval(intervalId);
}; 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2017-05-11T15:25:37.250

我们刚刚[发布](https://www.npmjs.com/package/time-events-manager)了一个包来解决这个确切的问题。

```
npm install time-events-manager 
```

`timeoutCollection`有了它，您可以通过对象（以及通过对象的 javascript 间隔）查看和管理它们`intervalCollection`。

`timeoutCollection.getScheduled(); timeoutCollection.getCompleted(); timeoutCollection.getAll();`

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-02-19T11:47:53.783

我只需要这样的东西，这就是我放在一起的：

```
window.setInterval = function (window, setInterval) {
  if (!window.timers) {
    window.timers = {};
  }
  if (!window.timers.intervals) {
    window.timers.intervals = {};
  }
  if (!window.timers.intervals.active) {
    window.timers.intervals.active = {};
  }
  return function (func, interval) {
    var id = setInterval(func, interval);
    window.timers.intervals.active[id] = func;
    return id;
  }
}(window, window.setInterval);

window.clearInterval = function (window, clearInterval) {
  if (!window.timers) {
    window.timers = {};
  }
  if (!window.timers.intervals) {
    window.timers.intervals = {};
  }
  if (!window.timers.intervals.inactive) {
    window.timers.intervals.inactive = {};
  }
  return function (id) {
    if (window.timers.intervals.active && window.timers.intervals.active[id]) {
      window.timers.intervals.inactive[id] = window.timers.intervals.active[id];
      clearInterval(id);
      delete window.timers.intervals.active[id];
    }
  }
}(window, window.clearInterval); 
```

这记录了区间`id`s 及其函数，并跟踪它们的状态 ( `active`/ `inactive`)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-07-10T00:50:45.903

基于[@Alessio 的](https://stackoverflow.com/users/5268732/alessio-cantarella)回答。下面是我的版本。具有更多的日志记录和检查功能。

以下是一些样板文件，您可以更改它们以使用自己的框架：

```
var s$ = function (s){return new String(s)}
var _w=window
_w.q$ = {
  getMachineTimeMS: function(){
      var d = new Date(), ms = d.getMilliseconds()
      var a = [d.getHours(), d.getMinutes(), d.getSeconds(), '-', ms<10?'00' + s$(ms):ms<100?'0'+s$(ms):ms]
      return a.join('')
  }
  ,getCaller: function(opts){
      return "(implement this)"
  }
} 
```

这是主要代码：

```
_w.setTimeout = function (orig_setTimeout) {
  var t=(_w._Timers = _w._Timers||{})
  var d=(t.Timeouts = t.Timeouts||{})
  d.Active = d.Active||{}
  t.z_to_id_idx = t.z_to_id_idx||{}
  return function (h, n) {
    var t = _w._Timers, d = t.Timeouts
    var id = orig_setTimeout(h, n), ts = q$.getMachineTimeMS()
    var c = q$.getCaller({depth:2})
    t.z_to_id_idx[s$(id)] = d.Active[ts] = {sts: ts, id: id, h: h, n: n, scaller: c}
    return id;
  }
}(_w.setTimeout);

_w.clearTimeout = function (orig_clearTimeout) {
  var t=_w._Timers, d = t.Timeouts
  d.Inactive = d.Inactive||{}
  return function new_clearTimeout(id) {
    var t = _w._Timers, d = t.Timeouts, sId = s$(id)
    if (!d.Active || !sId in t.z_to_id_idx) return
    var r = t.z_to_id_idx[sId]
    r.ccaller = q$.getCaller({depth:2})
    r.cts = q$.getMachineTimeMS()
    d.Inactive[r.ts] = r;
    orig_clearTimeout(r.id);
    delete d.Active[r.ts]
    delete t.z_to_id_idx[sId]
  }
}(_w.clearTimeout);

_w.setInterval = function (orig_setInterval) {
  var t=(_w._Timers = _w._Timers||{})
  var d=(t.Intervals = t.Intervals||{})
  d.Active = d.Active||{}
  t.z_in_id_idx = t.z_in_id_idx||{}
  return function (h, n) {
    var t = _w._Timers, d = t.Intervals
    var id = orig_setInterval(h, n), ts = q$.getMachineTimeMS()
    var c = q$.getCaller({depth:2})
    t.z_in_id_idx[s$(id)] = d.Active[ts] = {sts: ts, id: id, h: h, n: n, scaller: c}
    return id;
  }
}(_w.setInterval);

_w.clearInterval = function (orig_clearInterval) {
  var t=_w._Timers, d = t.Intervals
  d.Inactive = d.Inactive||{}
  return function new_clearInterval(id) {
    var t = _w._Timers, d = t.Intervals, sId = s$(id)
    if (!d.Active || !sId in t.z_in_id_idx) return
    var r = t.z_in_id_idx[sId]
    r.ccaller = q$.getCaller({depth:2})
    r.cts = q$.getMachineTimeMS()
    d.Inactive[r.ts] = r;
    orig_clearInterval(r.id);
    delete d.Active[r.ts]
    delete t.z_in_id_idx[sId]
  }
}(_w.clearInterval); 
```

使用示例：

```
id = setTimeout(()=>{console.log("CALLED")}, 10000)
clearTimeout(id)
setInterval(()=>{console.log("CALLED")}, 1000)

console.table(_w._Timers.Timeouts.Inactive) 
```

console.table 将在 JavaScript 控制台中输出格式良好且可检查的表格

# python - 如何识别脚本是否在 tty 上运行？

> ID：858623
> 
> 赞同：72
> 
> 时间：2009-05-13T15:24:06.533
> 
> 标签：python, shell

我希望我的脚本在交互式 shell 会话中以及在使用重定向的标准输出运行时（例如，当管道传输到其他命令时）表现不同。

我如何识别这两个中的哪一个发生在 Python 脚本中？

现有程序中此类行为的示例： grep --color=auto 在交互式 shell 中运行时突出显示匹配，但在通过管道传输到其他内容时不匹配。

* * *

## 回答 #1

> 赞同：85
> 
> 时间：2009-05-13T15:24:45.957

```
import os, sys
os.isatty(sys.stdout.fileno()) 
```

或者

```
sys.stdout.isatty() 
```

# c++ - 将 SQL Provider 从 SQLOLEDB.1 更改为 SQLNCLI.1 会导致应用程序在通过存储过程访问数据时失败

> ID：858624
> 
> 赞同：0
> 
> 时间：2009-05-13T15:24:14.380
> 
> 标签：c++, sql-server, sqlncli

我支持用 MFC/C++ 编写的旧版应用程序。该应用程序的数据库位于 SQL Server 2000 中。我们最近增加了一些新功能，发现当我们将 SQL Provider 从 SQLOLEDB.1 更改为 SQLNCLI.1 时，一些代码试图通过存储过程从表中检索数据失败。

有问题的表非常简单，是通过以下脚本创建的：

```
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[UAllergenText](
    [TableKey] [int] IDENTITY(1,1) NOT NULL,
    [GroupKey] [int] NOT NULL,
    [Description] [nvarchar](150) NOT NULL,
    [LanguageEnum] [int] NOT NULL,
CONSTRAINT [PK_UAllergenText] PRIMARY KEY CLUSTERED
(
    [TableKey] ASC) WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF,
    IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
ALTER TABLE [dbo].[UAllergenText]  WITH CHECK ADD  CONSTRAINT 
FK_UAllergenText_UBaseFoodGroupInfo] FOREIGN KEY([GroupKey])
REFERENCES [dbo].[UBaseFoodGroupInfo] ([GroupKey])
GO
ALTER TABLE [dbo].[UAllergenText] CHECK CONSTRAINT 
FK_UAllergenText_UBaseFoodGroupInfo] 
```

基本上是四列，其中 TableKey 是一个标识列，其他所有内容都通过以下脚本填充：

```
INSERT INTO UAllergenText (GroupKey, Description, LanguageEnum)
VALUES (401, 'Egg', 1) 
```

上面还有一长串其他 INSERT INTO 的列表。插入的某些行在其描述中具有特殊字符（如字母上方的重​​音符号）。我最初认为包含特殊字符是问题的一部分，但如果我完全清除表格，然后只用上面没有特殊字符的单个 INSERT INTO 重新填充它，它仍然会失败。

所以我继续...

然后通过以下代码访问此表中的数据：

```
std::wstring wSPName = SP_GET_ALLERGEN_DESC;
_variant_t  vtEmpty1 (DISP_E_PARAMNOTFOUND, VT_ERROR);
_variant_t  vtEmpty2(DISP_E_PARAMNOTFOUND, VT_ERROR);

_CommandPtr pCmd = daxLayer::CDataAccess::GetSPCommand(pConn, wSPName); 
pCmd->Parameters->Append(pCmd->CreateParameter("@intGroupKey", adInteger, adParamInput, 0, _variant_t((long)nGroupKey)));
pCmd->Parameters->Append(pCmd->CreateParameter("@intLangaugeEnum", adInteger, adParamInput, 0, _variant_t((int)language)));

_RecordsetPtr pRS = pCmd->Execute(&vtEmpty1, &vtEmpty2, adCmdStoredProc);            

//std::wstring wSQL = L"select Description from UAllergenText WHERE GroupKey = 401 AND LanguageEnum = 1";
//_RecordsetPtr pRS = daxLayer::CRecordsetAccess::GetRecordsetPtr(pConn,wSQL);

if (pRS->GetRecordCount() > 0)
{
    std::wstring wDescField = L"Description";
    daxLayer::CRecordsetAccess::GetField(pRS, wDescField, nameString);
}   
else
{
    nameString = "";
} 
```

daxLayer 是应用程序正在使用的第三方数据访问库，尽管我们有它的来源（其中一些将在下面看到。） SP__GET_ALLERGEN_DESC 是用于从表中获取数据的存储过程，它是通过创建的这个脚本：

```
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[spRET_AllergenDescription] 
-- Add the parameters for the stored procedure here
    @intGroupKey int, 
    @intLanguageEnum int
AS
BEGIN
    -- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    SET NOCOUNT ON;

    -- Insert statements for procedure here
    SELECT Description FROM UAllergenText WHERE GroupKey = @intGroupKey AND LanguageEnum = @intLanguageEnum
END 
```

当 SQL Provider 设置为 SQLNCLI.1 时，应用程序会在以下位置爆炸：

```
daxLayer::CRecordsetAccess::GetField(pRS, wDescField, nameString); 
```

从上面的代码片段。于是我踏入了GetField，如下所示：

```
void daxLayer::CRecordsetAccess::GetField(_RecordsetPtr pRS,
const std::wstring wstrFieldName, std::string& sValue, std::string  sNullValue)
{
    if (pRS == NULL)
    {
        assert(false);
        THROW_API_EXCEPTION(GetExceptionMessageFieldAccess(L"GetField", 
        wstrFieldName, L"std::string", L"Missing recordset pointer."))
    }
    else
    {
        try
        {
            tagVARIANT tv = pRS->Fields->GetItem(_variant_t(wstrFieldName.c_str()))->Value;

            if ((tv.vt == VT_EMPTY) || (tv.vt == VT_NULL))
            {
                sValue = sNullValue;
            }
            else if (tv.vt != VT_BSTR)
            {
                // The type in the database is wrong.
                assert(false);
                THROW_API_EXCEPTION(GetExceptionMessageFieldAccess(L"GetField", 
                wstrFieldName, L"std::string", L"Field type is not string"))
            }
            else
            {
                 _bstr_t bStr = tv ;//static_cast<_bstr_t>(pRS->Fields->GetItem(_variant_t(wstrFieldName.c_str()))->Value);                     
                 sValue = bStr;
            }
        }
        catch( _com_error &e )
        {
            RETHROW_API_EXCEPTION(GetExceptionMessageFieldAccess(L"GetField", 
            wstrFieldName, L"std::string"), e.Description())
        }
        catch(...)
        {        
            THROW_API_EXCEPTION(GetExceptionMessageFieldAccess(L"GetField",
            wstrFieldName, L"std::string", L"Unknown error"))
        }
    }
} 
```

这里的罪魁祸首是：

```
tagVARIANT tv = pRS->Fields->GetItem(_variant_t(wstrFieldName.c_str()))->Value; 
```

进入 Fields->GetItem 将我们带到：

获取项目

```
inline FieldPtr Fields15::GetItem ( const _variant_t & Index ) {
    struct Field * _result = 0;
    HRESULT _hr = get_Item(Index, &_result);
    if (FAILED(_hr)) _com_issue_errorex(_hr, this, __uuidof(this));
    return FieldPtr(_result, false);
} 
```

然后将我们带到：

获取值

```
inline _variant_t Field20::GetValue ( ) {
    VARIANT _result;
    VariantInit(&_result);
    HRESULT _hr = get_Value(&_result);
    if (FAILED(_hr)) _com_issue_errorex(_hr, this, __uuidof(this));
    return _variant_t(_result, false);
} 
```

如果在运行时单步执行时查看 _result，_result 的 BSTR 值是正确的，它的值是表的“描述”字段中的“Egg”。继续遍历所有 COM 释放调用等的跟踪。当我终于回到：

```
tagVARIANT tv = pRS->Fields->GetItem(_variant_t(wstrFieldName.c_str()))->Value; 
```

跳过它到下一行，现在应该是 BSTR="Egg" 的 tv 的内容是：

```
tv BSTR = 0x077b0e1c "ᎀݸﻮﻮﻮﻮﻮﻮﻮﻮﻮﻮﻮﻮ㨼㺛帛᠄" 
```

当 GetField 函数尝试将其返回值设置为 tv.BSTR 中的值时

```
_bstr_t bStr = tv;
sValue = bStr; 
```

不出所料，它会窒息而死。

那么 BSTR 的值发生了什么变化，为什么它只在提供程序设置为 SQLNCLI.1 时才会发生？

最糟糕的是，我在最上面的代码中使用存储过程注释掉了，只是硬编码了存储过程使用的相同 SQL SELECT 语句，发现它工作得很好，返回的值是正确的。

此外，用户可以通过应用程序向表中添加行。如果应用程序在该表中创建一个新行并通过存储过程检索该行，它也可以正常工作，除非您在描述中包含一个特殊字符，在这种情况下它会正确保存该行但以与上面完全相同的方式再次爆炸在检索该行时。

因此，总而言之，如果可以的话，通过 INSERT 脚本放入表中的行在被存储过程访问时总是会炸毁应用程序（无论它们是否包含任何特殊字符）。用户在运行时从应用程序中放入表中的行可以通过存储过程正确检索，除非它们在描述中包含特殊字符，此时它们会破坏应用程序。如果您在运行时使用代码中的 SQL 而不是存储过程访问表中的任何行，则无论描述中是否存在特殊字符，它都可以正常工作。

任何可以对此有所了解的信息都将不胜感激，我提前感谢您。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T16:29:25.507

这条线可能有问题：

```
tagVARIANT tv = pRS->Fields->GetItem(_variant_t(wstrFieldName.c_str()))->Value; 
```

如果我没看错，->Value 会返回一个 _variant_t，它是一个智能指针。智能指针将在超出范围时释放它的变体，就在这一行之后。但是，tagVARIANT 不是智能指针，因此在分配时不会增加引用计数。所以在这行之后， tv 可能指向一个已经有效发布的变体。

如果你这样写代码会发生什么？

```
_variant_t tv = pRS->Fields->GetItem(_variant_t(wstrFieldName.c_str()))->Value; 
```

或者，告诉智能指针不要释放其有效负载：

```
_tagVARIANT tv = pRS->Fields->GetItem(
    _variant_t(wstrFieldName.c_str()))->Value.Detach(); 
```

我已经很久没有用 C++ 编写代码了，阅读这篇文章，我不后悔离开！

# c# - 如何检查 DataGridView 是否包含列“x”和列“x”是否可见？

> ID：858629
> 
> 赞同：15
> 
> 时间：2009-05-13T15:24:49.123
> 
> 标签：c#, winforms, datagridview

如何检查`DataGridView`包含列“x”和列“x”是否可见？

到目前为止我所拥有的都在下面。

```
if (Dgv.Columns.Contains("Address") & .... 
```

谢谢

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-05-13T15:34:01.307

直截了当的方法：

```
if (dgv.Columns.Contains("Address") && dgv.Columns["Address"].Visible)
{
    // do stuff
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-10-17T22:12:49.140

首先验证列是否存在，然后验证其可见性。

为不存在的列调用列的属性将崩溃。

```
if (dgv.Columns.Contains("Address")
{
    if ( dgv.Columns["Address"].Visible )
    {

    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T15:29:48.617

您可以使用以下属性测试列的可见`Visible`性：

```
if (column.Visible)
{
    // Do Stuff
} 
```

这将告诉您是否应显示该列。

如果您知道索引，则可以通过此调用获取列：

```
DataColumn column = dGV.Columns[index]; 
```

如果该列已显示但不在屏幕上，我不知道您将如何对此进行测试。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-13T15:32:22.433

遍历列，检查标题（我假设这就是您要查找的内容）和 Visible 属性。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-08-24T17:45:40.307

```
 var dataGridViewColumn = dgv.Columns["Address"];

 if (dataGridViewColumn != null && dataGridViewColumn.Visible)
   {
                    //do stuff
   } 
```

# c# - 将 XML 字符串注入 XmlWriter 时的 XML 缩进

> ID：858630
> 
> 赞同：18
> 
> 时间：2009-05-13T15:24:51.277
> 
> 标签：c#, .net, xml

我有一个 XmlTextWriter 写入文件和一个 XmlWriter 使用该文本编写器。此文本编写器设置为输出制表符缩进的 XML：

```
XmlTextWriter xtw = new XmlTextWriter("foo.xml", Encoding.UTF8);
xtw.Formatting = Formatting.Indented;
xtw.IndentChar = '\t';
xtw.Indentation = 1;

XmlWriter xw = XmlWriter.Create(xtw); 
```

* * *

根据 Jeff 的 MSDN 链接更改：

```
XmlWriterSettings set = new XmlWriterSettings();
set.Indent = true;
set.IndentChars = "\t";
set.Encoding = Encoding.UTF8;

xw = XmlWriter.Create(f, set); 
```

这不会改变最终结果。

* * *

现在我在我的 XmlWriter 中具有任意深度，并且我从其他地方（我无法控制）得到一个 XML 字符串，它是一个单行、非缩进的 XML。如果我调用 xw.WriteRaw() 则该字符串被逐字注入并且不遵循我想要的缩进。

```
...
string xml = ExternalMethod();
xw.WriteRaw(xml);
... 
```

本质上，我想要一个可以解析 XML 字符串并遍历所有 WriteStartElement 等的 WriteRaw，以便根据 XmlTextWriter 的设置对其进行重新格式化。

我的偏好是使用我已经拥有的设置来执行此操作，并且无需重新加载最终的 XML 来重新格式化它。我也不想用 XmlReader 之类的解析 XML 字符串，然后模仿它在我的 XmlWriter 中找到的内容（非常非常手动的过程）。

最后，我宁愿有一个简单的解决方案，也不愿遵循我的喜好。（当然，最好的解决方案很简单，并且符合我的喜好。）

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-05-13T16:05:49.553

使用 XmlReader 将 xml 作为 xml 节点读取怎么样？

```
string xml = ExternalMethod();
XmlReader reader =  XmlReader.Create(new StringReader(xml));
xw.WriteNode(reader, true); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T15:30:39.660

您不应该使用[`XmlTextWriter`](http://msdn.microsoft.com/en-us/library/system.xml.xmltextwriter.aspx)，如 MSDN 中所述：

> 在 .NET Framework 2.0 版中，推荐的做法是使用 XmlWriter.Create 方法和 XmlWriterSettings 类创建 XmlWriter 实例。这使您可以充分利用此版本中引入的所有新功能。有关更多信息，请参阅创建 XML 编写器。

相反，您应该使用[XmlWriter.Create](http://msdn.microsoft.com/en-us/library/system.xml.xmlwriter.create.aspx)来获取您的作家。然后，您可以使用[`XmlWriterSettings`](http://msdn.microsoft.com/en-us/library/system.xml.xmlwritersettings.aspx)该类来指定缩进等内容。

```
XmlWriterSettings settings = new XmlWriterSettings();
settings.Indent = true;
settings.IndentChars = "\t"; 
```

### 更新

我认为您可以只使用WriteNode。您将 xml 字符串加载到 XDocument 或 XmlReader 中，然后使用其中的节点将其写入 XmlWriter。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-13T15:45:00.790

这是迄今为止我得到的最好的。一个非常手动的过程，只支持所写的内容。我的字符串 XML 只不过是标签、属性和文本数据。如果它支持命名空间、CDATA 等，那么它必须相应地增长。

非常手动，非常混乱并且很可能容易出现错误，但它确实满足了我的喜好。

```
private static void PipeXMLIntoWriter(XmlWriter xw, string xml)
{
    byte[] dat = new System.Text.UTF8Encoding().GetBytes(xml);
    MemoryStream m = new MemoryStream();
    m.Write(dat, 0, dat.Length);
    m.Seek(0, SeekOrigin.Begin);
    XmlReader r = XmlReader.Create(m);

    while (r.Read())
    {
        switch (r.NodeType)
        {
            case XmlNodeType.Element:
                xw.WriteStartElement(r.Name);

                if (r.HasAttributes)
                {
                    for (int i = 0; i < r.AttributeCount; i++)
                    {
                        r.MoveToAttribute(i);
                        xw.WriteAttributeString(r.Name, r.Value);
                    }
                }

                if (r.IsEmptyElement)
                {
                    xw.WriteEndElement();
                }
                break;
            case XmlNodeType.EndElement:
                xw.WriteEndElement();
                break;
            case XmlNodeType.Text:
                xw.WriteString(r.Value);
                break;

            default:
                throw new Exception("Unrecognized node type: " + r.NodeType);
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-08-10T14:55:34.127

撰写上面的答案我发现这是可行的：

```
private static string FormatXML(string unformattedXml) {
    // first read the xml ignoring whitespace
    XmlReaderSettings readeroptions= new XmlReaderSettings {IgnoreWhitespace = true};
    XmlReader reader = XmlReader.Create(new StringReader(unformattedXml),readeroptions);

    // then write it out with indentation
    StringBuilder sb = new StringBuilder();
    XmlWriterSettings xmlSettingsWithIndentation = new XmlWriterSettings { Indent = true};                       
    using (XmlWriter writer = XmlWriter.Create(sb, xmlSettingsWithIndentation)) {
        writer.WriteNode(reader, true);
    }

    return sb.ToString();
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-10-30T21:56:00.773

怎么样：

```
string xml = ExternalMethod();
var xd = XDocument.Parse(xml);
xd.WriteTo(xw); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-09-26T09:58:11.497

我一直在寻找这个问题的答案，但在 VB.net 中。

感谢 Colin Burnett，我解决了这个问题。我做了两个更正：首先，`XmlReader`必须忽略空格（`settings.IgnoreWhiteSpaces`）；其次，阅读器在读取属性后必须回到元素中。下面你可以看到代码的样子。

我也尝试了 GreyCloud 的解决方案，但在生成的 XML 中有一些烦人的空属性（xlmns）。

```
Private Sub PipeXMLIntoWriter(xw As XmlWriter, xml As String)
    Dim dat As Byte() = New System.Text.UTF8Encoding().GetBytes(xml)
    Dim m As New MemoryStream()
    m.Write(dat, 0, dat.Length)
    m.Seek(0, SeekOrigin.Begin)
    Dim settings As New XmlReaderSettings
    settings.IgnoreWhitespace = True
    settings.IgnoreComments = True
    Dim r As XmlReader = XmlReader.Create(m, settings)

    While r.Read()
          Select Case r.NodeType
                Case XmlNodeType.Element
                    xw.WriteStartElement(r.Name)

                    If r.HasAttributes Then
                        For i As Integer = 0 To r.AttributeCount - 1
                            r.MoveToAttribute(i)
                            xw.WriteAttributeString(r.Name, r.Value)
                        Next
                        r.MoveToElement()
                    End If

                    If r.IsEmptyElement Then
                        xw.WriteEndElement()
                    End If
                    Exit Select
                Case XmlNodeType.EndElement
                    xw.WriteEndElement()
                    Exit Select
                Case XmlNodeType.Text
                    xw.WriteString(r.Value)
                    Exit Select
                Case Else

                    Throw New Exception("Unrecognized node type: " + r.NodeType)
            End Select
      End While
End Sub 
```

# sql-server - 什么可能导致 SQL Server JDBC 错误“未为参数编号 0 设置值”以访问输出参数？

> ID：858631
> 
> 赞同：8
> 
> 时间：2009-05-13T15:25:03.677
> 
> 标签：sql-server, stored-procedures, jdbc, mssql-jdbc

我有一些访问 SQL Server 2005 的 Java 代码，看起来像这样：

```
CallableStatement cstmt = ...;
... // Set input parameters
cstmt.registerOutParameter(11, Types.INTEGER);
cstmt.execute();
int out = cstmt.getInt(11); 
```

最后一行抛出以下异常：

```
com.microsoft.sqlserver.jdbc.SQLServerException: The value is not set 
     for the parameter number 0.
   at com.microsoft.sqlserver.jdbc.SQLServerException.
     makeFromDriverError(Unknown Source)
   at com.microsoft.sqlserver.jdbc.SQLServerCallableStatement.
     skipOutParameters(Unknown Source)
   at com.microsoft.sqlserver.jdbc.SQLServerCallableStatement.
     getOutParameter(Unknown Source)
   at com.microsoft.sqlserver.jdbc.SQLServerCallableStatement.
     getterGetParam(Unknown Source)
   at com.microsoft.sqlserver.jdbc.SQLServerCallableStatement.
     getInt(Unknown Source)
   at org.jboss.resource.adapter.jdbc.WrappedCallableStatement.
     getInt(WrappedCallableStatement.java:192) 
```

被调用的存储过程如下所示：

```
CREATE PROCEDURE dbo.stored_proc ( -- 10 input parameters
                                 , @out_param INT OUTPUT) AS

-- Variable declarations 

SET @out_param = 0

-- Do processing...

SET @out_param = 1 
```

**由于在进入存储过程时输出参数设置为零，在什么情况下可以不设置该值？还是我误解了错误信息？**

此错误可通过以下方式重现：

*   SQL Server JDBC 驱动程序 1.2
*   SQL Server 2005（64 位）服务包 2
*   SQL Server 2005（64 位）服务包 3

**更新：**它似乎是由于`-- Do processing...`存储过程的一部分而发生的。删除它可以消除错误。这里要重现的代码太多，我想要的是一些指向可能原因的指针，以缩小可能的候选范围。

**更新：**`-- Do processing...`在存储过程的一部分中注入错误（例如除以零）*不会*导致抛出此异常（相反，正如预期的那样，`execute()`调用失败并显示适当的错误消息）。

**更新：**反编译 com.microsoft.sqlserver.jdbc.SQLServerCallableStatement 类表明 'parameter number 0' is the stored procedure *return value*。

**更新：**我无法通过直接通过 Management Studio 调用存储过程来重现这一点。

**更新：**这个错误的最终原因似乎是**存储过程中的死锁**。但是，通常死锁会导致`execute()`调用失败，并显示`SQLException`包装 SQL Server 错误代码 1205...

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-13T15:37:26.730

在您的参数上，您只是声明它们还是将它们设置为默认值？尝试将它们设置为默认值 null 或其他值，看看是否仍然出现错误。

如果您的参数未设置为默认值并且您在执行存储过程时未将值传递给它，则 sql server 不喜欢它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T15:41:20.267

您是否正在注册输出参数？根据[文档](http://java.sun.com/javase/6/docs/api/java/sql/CallableStatement.html#registerOutParameter(int,%20int))“必须在执行存储过程之前注册所有 OUT 参数。”

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-23T06:53:32.697

我想到了几件事：

1.  您没有 RETURN x（其中 x 是表示处理结果的 INT，0 = 成功，其他任何内容都表示警告或错误）。
2.  除了输出参数之外，您的客户端代码不会为返回值分配参数。

希望这可以帮助，

账单

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-09-22T00:22:08.907

> 反编译 com.microsoft.sqlserver.jdbc.SQLServerCallableStatement 类表明“参数号 0”是存储过程的返回值。

那是正确的。如果您的存储过程定义有 11 个输入/输出参数，您实际上需要在调用代码中定义 12 个。参数 0 是返回码。

例如，对于具有一个输入和一个输出参数的 SP，在 SSMS 中运行以下命令：

```
DECLARE @ReturnValue INT
DECLARE @P1 INT, @P2 INT

EXEC @ReturnValue= YourSP(@P1,@P2 OUTPUT) 
```

您实际上需要在这里处理三个参数，而不是两个。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-04-25T13:06:13.540

万一有人在 SQL Server 2008 上仍然遇到这个问题。

在尝试为 DateTime 字段设置时间戳时，我在更新语句中遇到了同样的问题。违规字段位于与报告的索引不同的索引处的 where 子句中。

# delphi - SQLite 或 Blackfish - 我应该在 delphi 应用程序中使用什么？

> ID：858634
> 
> 赞同：4
> 
> 时间：2009-05-13T15:25:32.273
> 
> 标签：delphi, sqlite, blackfish

我正在考虑使用 SQLite

它是一个独立的、无服务器、零配置、事务性 SQL 数据库引擎，并且是开源的。

**我会通过使用 Blackfish 而不是 SQLight 获得什么吗？**

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-13T16:49:10.560

为什么不是火鸟？

[http://www.firebirdsql.org](http://www.firebirdsql.org)

[http://www.firebirdfaq.org](http://www.firebirdfaq.org)

“...Firebird 是一个关系数据库，提供许多 ANSI SQL 标准功能，可在 Linux、Windows 和各种 Unix 平台上运行。Firebird 为存储过程和触发器提供了出色的并发性、高性能和强大的语言支持。它已被自 1981 年以来，以各种名称用于生产系统……”

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-13T23:51:34.020

坚持使用 FOSS（免费开源软件）。

SQLite 和 Firebird 都是很好的选择。两者都满足您的要求。两者都非常可靠，零配置并支持事务。

在不了解您的预期用途的情况下，Firebird 将是我的首选，因为它可以以接近零的努力迁移到客户端服务器部署，并且它具有一组非常强大的功能。这都是关于选项的。

恕我直言，Blackfish 不是上帝的选择——“Blackfish SQL 可在 .NET 框架和 Java 平台上运行。” - 说够了。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-13T16:03:11.260

使用 SQLite。

更小，更少的开销，没有许可问题等。

Laslty，只有您可以决定哪一个将完成您需要数据库系统执行的所有操作。哪一个具有您需要支持的所有功能？

约翰

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-13T19:13:31.900

我将首先投票支持 Sqlite，因为它紧凑、精简且快速，但取决于您的应用程序，您可能会选择其他选择，例如 Firebird 或 PostgreSql。

例如 Sqlite 对同时一个编写器有限制，对于大多数由一个用户使用的桌面应用程序来说可能没有问题，但它不会扩展到未来更多的用途。

您可以使用嵌入式 FireBird 作为解决方案，其行为类似于 Sqlite，然后在需要更多用户时移至 firebird 服务器。

在另一边的 BlackFish 数据库中，将强制您在客户端计算机上安装 .Net 框架，这在 IMO 中并不是一件好事，特别是如果您需要在 Internet 上分发您的应用程序，而且当它扩展到超过开发者版。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-14T05:07:46.773

要考虑的另一件事是您将如何访问您的数据。例如，如果您使用 DBX4，那么更改您正在查看的数据库非常容易。在这种情况下，我建议两者都尝试（加上人们强烈建议您尝试的任何其他方法）。另一方面，如果您使用 Interbase 或 ADO 数据访问组件，那么您的更改能力会受到更多限制。

# c# - 如何在 Compact Framework 下实现套接字上的非无限接收和发送超时？

> ID：858635
> 
> 赞同：7
> 
> 时间：2009-05-13T15:26:04.237
> 
> 标签：c#, sockets, windows-mobile, compact-framework, timeout

在完整的 .Net 框架上，我使用以下代码：

```
socket.SetSocketOption(
  SocketOptionLevel.Socket, SocketOptionName.ReceiveTimeout, readTimeout);
socket.SetSocketOption(
  SocketOptionLevel.Socket, SocketOptionName.SendTimeout, writeTimeout); 
```

但是，Windows Mobile 不支持此操作并引发异常。

我目前正在测试此[解决方案以实现超时](http://www.csharp-examples.net/socket-send-receive/)。

有谁知道更好的方法？如果可能的话，我想避免产生多个线程，毕竟这是一个嵌入式设备。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-13T15:46:49.977

此代码有效，在预期时引发超时（它是我在问题中链接的示例的修改版本）：

```
// copied from Mono, because CF lacks this enum
enum SocketError
{
    IOPending = 997,
    NoBufferSpaceAvailable = 10055,
    TimedOut = 10060,
    WouldBlock = 10035
}

// milliseconds
int receiveTimeout = 20000;
int sendTimeout = 20000;

public override int Read(byte[] buffer, int offset, int size)
{    
    int startTickCount = Environment.TickCount;
    int received = 0;
    do
    {
        List<Socket> sock = new List<Socket>(new Socket[] {socket});
        Socket.Select(sock, null, null, receiveTimeout*1000 + 1);
        if (Environment.TickCount > startTickCount + receiveTimeout)
            throw new SocketException((int) SocketError.TimedOut);
        try
        {
            received += socket.Receive(buffer, offset + received,
                size - received, SocketFlags.None);
        }
        catch (SocketException ex)
        {
            if (ex.ErrorCode == (int) SocketError.WouldBlock ||
                ex.ErrorCode == (int) SocketError.IOPending ||
                ex.ErrorCode == (int) SocketError.NoBufferSpaceAvailable)
            {
                // socket buffer is probably empty, wait and try again
                Thread.Sleep(30);
            }
            else
                throw; // any serious error occurr
        }
    } while (received < size);
    return received;
}

public override void Write(byte[] buffer, int offset, int size)
{
    int startTickCount = Environment.TickCount;
    int sent = 0;
    do
    {
        List<Socket> sock = new List<Socket>(new Socket[] {socket});
        Socket.Select(null, sock, null, sendTimeout*1000 + 1);
        if (Environment.TickCount > startTickCount + sendTimeout)
            throw new SocketException((int) SocketError.TimedOut);
        try
        {
            sent += socket.Send(buffer, offset + sent,
                size - sent, SocketFlags.None);
        }
        catch (SocketException ex)
        {
            if (ex.ErrorCode == (int) SocketError.WouldBlock ||
                ex.ErrorCode == (int) SocketError.IOPending ||
                ex.ErrorCode == (int) SocketError.NoBufferSpaceAvailable)
            {
                // socket buffer is probably full, wait and try again
                Thread.Sleep(30);
            }
            else
                throw; // any serious error occurr
        }
    } while (sent < size);
} 
```

我发现的示例中缺少的关键元素是`Socket.Select(IList checkRead, IList checkWrite, IList checkError, int microSeconds)`. 请记住，此方法可能会修改传递给它的列表（这就是我的代码每次创建一个新列表的原因）并以微秒而不是毫秒为单位测量时间。并记住使用`Environment.TickCount`（这是一个[单调时间源](http://en.wikipedia.org/wiki/Monotonic_function)）而不是`DateTime.Now`测量时间。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-03-27T09:25:58.407

我遇到过同样的问题。这可以使用`EventWaitHandle`此处描述[的帖子修复](https://stackoverflow.com/questions/6276302/net-cf-socket-receive-timeout)

# django - 如何将登录用户附加到 Django 异常错误消息？

> ID：858640
> 
> 赞同：2
> 
> 时间：2009-05-13T15:28:15.777
> 
> 标签：django

当我从我的 Django 站点收到错误异常电子邮件时，查看当前登录用户的 User 和/或 UserProfile 信息会很有用。如何将此添加到 Django 站点异常错误电子邮件中？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-13T15:56:17.510

Django 在电子邮件末尾附加 repr(request)。使用默认的 wsgi 开发服务器，您可以找到登录用户为

'LOGNAME': '我的用户',

这可能隐藏在某些电子邮件客户端中，因为它包含在尖括号中。

```
<WSGIRequest
GET:<QueryDict: {}>,
POST:<QueryDict: {}>,
...
'LOGNAME': 'myuser', 
...
wsgi.run_once': False,
'wsgi.url_scheme': 'http',
'wsgi.version': (1, 0)}> 
```

此外，您可以实现一个实现 process_exception 方法的自定义中间件：

process_exception（自我，请求，异常）

request 是一个 HttpRequest 对象。异常是视图函数引发的异常对象。

当视图引发异常时，Django 调用 process_exception()。process_exception() 应该返回 None 或 HttpResponse 对象。如果它返回一个 HttpResponse 对象，则响应将返回给浏览器。否则，将启动默认异常处理。

同样，中间件在响应阶段以相反的顺序运行，其中包括 process_exception。如果异常中间件返回响应，则根本不会调用该中间件之上的中间件类。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-09-06T23:45:09.413

由于 Django 的变化，@jsamsa 的答案似乎不再正确（至少我在错误电子邮件中没有收到“LOGNAME”字段）。

我发布了一个替代方案，通过电子邮件接收完整的 django html 错误页面。详细信息在这里： [https ://docs.djangoproject.com/en/dev/topics/logging/#django.utils.log.AdminEmailHandler](https://docs.djangoproject.com/en/dev/topics/logging/#django.utils.log.AdminEmailHandler)

这张[票](https://code.djangoproject.com/ticket/10863)有助于指出您可以这样做：

```
LOGGING['handlers']['mail_admins']['include_html'] = True 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-03-01T12:29:09.393

从 Django 版本 1.10 开始，本机支持此功能：请参阅[https://docs.djangoproject.com/en/dev/releases/1.10/](https://docs.djangoproject.com/en/dev/releases/1.10/)。

> 将 request.user 添加到调试视图。

# sql-server - 消失的存储过程

> ID：858648
> 
> 赞同：17
> 
> 时间：2009-05-13T15:29:57.930
> 
> 标签：sql-server, stored-procedures

所以，不确定发生了什么。但是我有存储过程，它在 SQL 2k 中不断从我的数据库中消失。

我可以再次添加它，然后尝试从我的 Web 应用程序执行它，我得到一个异常，说找不到存储过程。那么病了回去管理和刷新，它又消失了！？！

这是存储过程的配置：

```
set ANSI_NULLS OFF
set QUOTED_IDENTIFIER ON
GO

ALTER PROCEDURE [dbo].[USP_Equipment_Delete]
    @EquipmentID int
AS

DELETE FROM [dbo].[Equipment]
WHERE
    [EquipmentID] = @EquipmentID 
```

我的其他存储过程都没有消失。这是唯一的一个。我那里很容易有100个。它们都使用相同的 SQLHelper 类。这个就一直不见了！！！？？？

任何帮助或建议表示赞赏！

非常感谢！

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-05-13T16:13:28.433

您正在创建这个或另一个存储过程，并且在代码的末尾，可能在评论之后，您没有看到它，您有一个这个过程的下降。

使用以下命令查看您的数据库：

```
select syo.name
from syscomments syc
    join sysobjects syo on
        syo.id = syc.id
where syc.[text] like '%DROP PROC%' 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-08-01T19:20:24.497

我遇到了同样的问题，我刚刚修复了它：

在脚本文件中，在存储过程的结尾和下一个“IF EXIST THEN DROP”语句的开头之间缺少“GO”语句。

所以发生的事情是 drop 语句被附加到脚本中任何存储过程的末尾。因此，当软件运行存储过程时，它将删除脚本中位于其下方的任何存储过程。

现在对我们来说似乎很明显，但当时没有任何意义。我们发现它针对在现场遇到问题的客户数据库运行 SQL 分析器。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-13T15:43:23.430

你`using`是正确的数据库吗？

尝试

`using [database name]`

在执行存储过程之前，只是为了确保。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-13T15:35:00.900

您在任何地方都有创建程序吗？如果程序不存在，则无法更改它。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-13T15:38:43.140

可能访问存储过程的代码使用了不同于 dbo 的上下文。确保将 dbo.USP_Equipment_Delete 添加到使用它的代码中。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-08-15T07:05:07.380

我面临的问题是所有带有 create 语句的存储过程在执行后都从数据库中消失了。

解决方案是：数据库用户应该有权删除、创建和更改要在其中创建“存储过程”的数据库。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-13T15:52:44.507

检查连接字符串中的“初始目录”是否设置为正确的数据库。

将数据库置于单用户模式（并确保您是单用户）并检查该过程是否仍然每小时消失一次？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-13T16:01:12.777

也许有一项工作是定期恢复旧备份？

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-05-13T17:02:20.600

如果它在那里，那么这个查询必须返回一条记录：

```
SELECT * FROM sysobjects 
WHERE id = OBJECT_ID('USP_Equipment_Delete') 
      AND OBJECTPROPERTY(id, N'IsProcedure') = 1 
```

# coding-style - Resharper：如何在类的底部强制引入新的私有字段？

> ID：858652
> 
> 赞同：3
> 
> 时间：2009-05-13T15:30:39.520
> 
> 标签：coding-style, resharper

当您在构造函数中指定新参数时，Resharper 提供了一个非常有用的***引入和初始化字段 xxx操作，例如：***

```
Constructor (int parameter) 
```

唯一的（次要）麻烦是它把新领域放在课程的开头——而且我喜欢把私处放在尽可能远离陌生人窥探的地方；）。

但是，如果您在课堂上已经有一些私有字段，Resharper 会将新字段“正确”（注意引号，我不想就这个问题引发一场激烈的战争）放在那些旁边，即使它们是在课程结束时。

有没有办法强制 Resharper**总是**将新字段放在课程的末尾？

更新：好的，我忘了提到我知道“选项中的类型成员布局”功能，但是关于如何修改模板以实现字段放置的一些具体帮助会很好。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-13T15:42:11.810

在“类型成员布局”中，您可以找到并移动以下 XML 块

```
<!--fields and constants-->
<Entry>
  <Match>
    <Or>
      <Kind Is="constant"/>
      <Kind Is="field"/>
    </Or>
  </Match>
  <Sort>
    <Kind Order="constant field"/>
    <Static/>
    <Readonly/>
    <Name/>
  </Sort>
</Entry> 
```

到默认模式的底部。基本上两行形成文件的底部

```
 <!--HERE-->

  </Pattern>      
</Patterns> 
```

不幸的是，快速测试表明这不会影响通过您描述的选项创建的新字段，但它会使代码清理将它们移动到正确的位置。（前提是您打开了“重新排序类型成员”）

* * *

如果您习惯使用公共字段并且您只想将私有字段移到底部，则将上面的匹配更改为：

```
<Match>
  <And>
    <Access Is="private"/>
    <Or>
      <Kind Is="constant"/>
      <Kind Is="field"/>
    </Or>
  </And>
</Match> 
```

然后您可以再次复制整个块，将“Access Is”值更改为“public”并将新的公共块放在您希望公共字段去的任何地方 - 靠近顶部，我猜它最初来自哪里。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T15:37:37.353

在 Resharper 选项中使用自定义的“类型成员布局”。

在 XML 布局定义的“默认模式”部分，只需将分组字段的条目元素移动到该部分的末尾，在方法、事件、属性等之后。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-17T13:43:15.583

如果您还没有，您应该在 ReSharper Jira 站点提交错误报告：

[http://www.jetbrains.net/jira/browse/RSRP](http://www.jetbrains.net/jira/browse/RSRP)

先看看有没有人举报过。如果是这样，您可以对他们的问题进行投票并收到任何更改的通知。

# java - Java多态混淆

> ID：858656
> 
> 赞同：8
> 
> 时间：2009-05-13T15:31:02.170
> 
> 标签：java, types, polymorphism

下面的问题来自 Kathy Sierra 和 Bert Bates 的 Java SCJP5 书。给定一个声明为的方法：

```
public static <E extends Number> List<E> process(List<E> nums) 
```

程序员想要使用这样的方法：

```
// INSERT DECLARATIONS HERE
output = process(input); 
```

哪一对声明可以放在 // INSERT DECLARATIONS HERE 以允许代码编译？（选择所有适用的。）

一种。

```
ArrayList<Integer> input = null;
ArrayList<Integer> output = null; 
```

B.

```
ArrayList<Integer> input = null;
List<Integer> output = null; 
```

C。

```
ArrayList<Integer> input = null;
List<Number> output = null; 
```

D.

```
List<Number> input = null;
ArrayList<Integer> output = null; 
```

E.

```
List<Number> input = null;
List<Number> output = null; 
```

F。

```
List<Integer> input = null;
List<Integer> output = null; 
```

G. 以上都不是。

给出的正确答案是：B、E、F，书中的解释是：
“返回类型肯定声明为 List，而不是 ArrayList，所以 A、D 是错误的。......”

这是我不明白的......为什么返回类型必须是 List 而不是 ArrayList？就像参数可以是 ArrayList 那么为什么返回类型也不能是 arrayList？

谢谢

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-13T15:36:36.390

因为ArrayList是List的子类，所以不能保证process返回的List就是ArrayList。例如，它可能是一个 LinkedList。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T15:37:15.747

当您指定 List 类型的返回时，您是说返回可以是**任何**类型的 List，无论是 ArrayList、LinkedList 还是其他类型的 List。如果你试图返回一个 ArrayList，你就太具体了——它不再是一个通用的 List。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-13T15:39:14.793

这实际上并不特定于泛型，而是处理类型。

简单的想法是，an`ArrayList`是 a `List`，但 an`List`不一定是 a `ArrayList`。

`ArrayList`实现了`List`接口，因此可以将其视为`List`. 但是，仅仅因为某些东西实现了`List`，它就不是`ArrayList`. 例如，`LinkedList`实现`List`，但不是`ArrayList`.

例如，以下是允许的：

```
List arrayList = new ArrayList();
List linkedList = new LinkedList(); 
```

这是因为两者`ArrayList`都`LinkedList`实现了`List`接口，所以它们都可以作为`List`s来处理。

但是，以下情况是不允许的：

```
ArrayList arrayList = new LinkedList(); 
```

虽然两者都`ArrayList`和`LinkedList`implement `List`，但它们不是同一个类。通过实现 的方法，它们可能有相似之处`List`，但它们是完全独立的类。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-13T15:46:21.897

返回类型**可以**是 ArrayList，但也可以不是 ArrayList，也可以是 LinkedList，或者一些 Collections List 包装器或其他东西。为了将它分配给变量，您必须使用它可能是的最高级别类型（在本例中为 List），或者如果您知道它**必须**是 ArrayList 则向下转换。

在实践中，变量几乎总是应该被输入为 List（如果不是 Collection）。几乎没有充分的理由来实际引用这些类的具体类型。

我能想到的唯一原因是，如果您有一个需要随机访问 List 的方法，并且您想确保出于性能原因没有获得 LinkedList 并且 List 太大而无法合理地复制到 ArrayList 目的的随机访问。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-13T15:38:33.733

该`process`方法无法决定选择 List 的哪个具体实现。它的签名向您保证它将能够对任何列表（ArrayList、LinkedList 等）进行操作，并且只能指定返回值将是 SOME List。

例如，如果返回的对象是 LinkedList，则不能将其直接分配给声明为 ArrayList 的变量，但可以将其视为 List。因此 A. 和 D. 不正确。您不能将变量声明为 ArrayList。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-13T15:47:39.193

您可以将返回类型声明为`ArrayList`，但它需要显式转换，如下所示：

```
ArrayList output = null;
output = (ArrayList)process(input); 
```

...这与泛型允许您完成的相反。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-13T15:37:48.460

这是因为问题明确表示该方法返回 List<T>。您可以很好地更改方法定义以返回 ArrayList<T>，但这是一个不同的问题。List<T> 可以是许多不同类型的列表。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-13T20:25:12.190

另一种看待这一点的方式是“分配兼容性”。从语义上讲，方法调用

```
output = process(input) 
```

相当于

```
nums = input;
/* body of process... */
output = returnVal; /* where process exits with "return returnVal" */ 
```

我们知道`nums`有 type `List<E>`，所以 的类型`input`必须是“可分配的”给`List<E>`。同样，我们知道类型`returnVal`（即 的返回值`process`）`List<E>`，因此`List<E>`必须“可分配”给 的类型`output`。

通常，如果类型是 的子类型（包括和相同的情况） ，则类型`T`可以“分配”给类型。`U``T``U``T``U`

因此， 的类型`input`必须是（例如，或）`List<E>`的子类型。类似地，类型必须是或*超类型*（例如，或什至）。`List<E>``ArrayList<E>``LinkedList<E>``output``List<E>`*`List<E>``Collection<E>``Object`*

 *# operating-system - 如何配置 ATA 硬盘以开始产生中断？

> ID：858657
> 
> 赞同：3
> 
> 时间：2009-05-13T15:31:09.847
> 
> 标签：operating-system, x86, device-driver

**解决**

经过一番困惑和挫折，我终于让我的硬盘中断了。:D 这基本上归结为我一直在读取状态寄存器而不是*备用*状态寄存器。其他一些事情在启动时搞砸了，但关键是我的硬盘驱动程序终于开始成形了。现在，对于其他人，我将离开原来的帖子。

PS为了进一步澄清，我不需要发出任何类型的重置命令。我所做的只是：

1.  选择设备（不想杀死另一个磁盘上的 Solaris OS）
2.  清除设备控制寄存器中的 nIEN 位
3.  发出识别设备命令***

实际上，我不确定是否需要 IDENTIFY DEVICE 命令，因为在没有发出命令的情况下测试代码之前，我很高兴离开了实验室。然而，重点是我需要确保读取*备用状态*寄存器并清除 nIEN 位而不需要复位。BIOS 显然可以处理大多数事情。

* * *

我目前正在尝试为我学校正在开发的爱好操作系统编写磁盘驱动程序。我目前有例程来读取/写入 PCI 配置空间中的数据，还有汇编例程来使用 ATA/ATAPI-7 定义的各种寄存器进行端口 IO。现在，我的问题是，具体来说，我将如何让 IDE 硬盘开始产生中断？我一直在查看所有这些文档，但我并不清楚我做错了什么。

有人可以准确解释导致 IDE 硬盘驱动器开始产生中断的原因吗？我已经准备好测试中断服务例程，但是一开始就很难获得中断。这可以通过 ATA SOFT RESET 完成吗？

谢谢！

更新：好的，通过设置设备控制寄存器中的 SRST 位进行软复位，我能够获得辅助通道，即 ATAPI CDROM 以产生中断。这不适用于主通道上的硬盘。到目前为止我注意到的是，当我为 HDD 设置 SRST 位时，它会设置 BSY 位并保持设置。从那里我不知道该怎么办。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-14T21:06:02.070

该参考资料应该对您有所帮助：[Kenos description of programming ATA/ATAPI](http://code.google.com/p/kenos/wiki/programming_ata_atapi)。

启用中断的基本机制是清除 DCR（设备控制寄存器）中的 nIEN：

> nIEN：驱动中断允许位。主机驱动中断的使能位。当 nIEN 为 0 或选择驱动器时，主机中断信号 INTRQ 通过三态缓冲器启用主机。当 nIEN 为 1 或未选择驱动器时，主机中断信号 INTRQ 处于高阻抗状态，无论是否存在未决中断。

这个[www.ata-atapi.com](http://www.ata-atapi.com/)是一个很好的起点，可以找到比您想知道的更多关于 ATA/PATA/SATA/ATAPI 的信息……请注意，官方 ATA-6/7/etc 规格的价格为 $ $ 来自 T13，尽管您可以从他们那里下载当前的 ATA-8 草案。

此[链接](http://alter.org.ua/en/soft/win/uni_ata/stddev.php)描述了ATA 设备与规格不同的**多种方式中的几种。**（我曾经为 Commodore/Amiga 编写 SCSI 和 ATA/ATAPI 驱动程序，早在那个时候，以及对合格驱动器的帮助 - 或者更准确地说，弄清楚驱动器制造商做了什么愚蠢的事情。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-14T20:37:43.293

如果这只是一个爱好操作系统，为什么不使用 BIOS 中断（int 13h）？诚然不如直接磁盘访问快，但对您的硬盘驱动器更安全（在弄乱磁盘 I/O 之前，我已经将读头通过盘子）。

# c# - Castle Windsor：当我的程序集无法访问基础类型时，如何注册工厂方法？

> ID：858668
> 
> 赞同：4
> 
> 时间：2009-05-13T15:33:58.123
> 
> 标签：c#, castle-windsor

我有一个项目，我的业务层是使用 DI 构建的，但我正在尝试更进一步并使用 Windsor 来管理对象构建。

假设我有一个预先存在的数据层（我不想修改），可以通过以下接口访问它：

```
interface IDataFactory {
   IDataService Service { get; }
} 
```

我的业务层中的一系列类依赖于通过 IDataFactory 暴露的服务：

```
IFactory factory = DataFactory.NewFactory();
IBusinessService service = new ConcreteBusinessService(factory.Service); 
```

我知道为了将 IBusinessService 注册到 Castle Windsor 容器，我将使用类似于以下的代码：

```
IWindsorContainer container = new WindsorContainer();
container.AddComponent("businessService", typeof(IBusinessService), typeof(ConcreteBusinessService)); 
```

但是对于我的生活，我无法弄清楚如何使用我现有的工厂对象从我的数据层注册服务。本质上，我想说：

```
container.AddComponent("dataService", typeof(IDataService), factory.service); 
```

Windsor 似乎想让我说**container.AddComponent("dataService", typeof(IDataService), typeOf(SomeConcreteDataService)** )，但在这种情况下，ConcreteDataService 是该程序集的内部，因此无法在我的内部访问。

鉴于我的程序集不知道 SomeConcreteDataService，我将如何连接数据服务？

* * *

[这个问题](https://stackoverflow.com/questions/64238/castle-windsor-how-do-you-add-a-call-to-a-factory-facility-not-in-xml)与我自己的问题非常相似，除了在我的情况下， AddComponent("calculator", typeof(ICalcService), typeof(CalculatorService), "Create"); 调用不起作用 - CalculatorService 将在另一个程序集内部，对连接容器的程序集不可用。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-13T23:01:21.640

使用温莎 2.0：

```
[TestFixture]
public class WindsorTests {
    public interface IDataService {}

    public class DataService: IDataService {}

    public interface IDataFactory {
        IDataService Service { get; }
    }

    public class DataFactory: IDataFactory {
        public IDataService Service {
            get { return new DataService(); }
        }
    }

    [Test]
    public void FactoryTest() {
        var container = new WindsorContainer();
        container.AddFacility<FactorySupportFacility>();
        container.AddComponent<IDataFactory, DataFactory>();
        container.Register(Component.For<IDataService>().UsingFactory((IDataFactory f) => f.Service));
        var service = container.Resolve<IDataService>();
        Assert.IsInstanceOfType(typeof(DataService), service);
    }
} 
```

有关更多信息，请参阅[fluent API wiki 页面](https://github.com/castleproject/Windsor/blob/master/docs/fluent-registration-api.md)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T16:11:07.673

知道了。答案是，您无需担心实现类型：

```
 IWindsorContainer container = new WindsorContainer();
    container.AddFacility("factories", new FactorySupportFacility());
    container.AddComponent("standard.interceptor", typeof(StandardInterceptor));
    container.AddComponent("factory", typeof(DataFactory));

    MutableConfiguration config = new MutableConfiguration("dataService");
    config.Attributes["factoryId"] = "factory";
    config.Attributes["factoryCreate"] = "get_Service";
    container.Kernel.ConfigurationStore.AddComponentConfiguration("dataService", config);
    container.Kernel.AddComponent("dataService", typeof(IDataService));

    IDataService dataService = (IDataService) container["dataService"]; 
```

当我看到它成功执行时，我有一个“哇”的时刻，因为我没有将具体的实现类型传递给 Kernel.AddComponent()

# android - 编译 Android Qemu 镜像

> ID：858670
> 
> 赞同：2
> 
> 时间：2009-05-13T15:34:05.317
> 
> 标签：android, android-emulator, qemu

我想开始玩Android。下载了源代码并按照[下载页面中的说明进行操作](http://source.android.com/download)

做了一个简单的通用构建：

```
============================================
TARGET_PRODUCT=generic
TARGET_BUILD_VARIANT=eng
TARGET_SIMULATOR=
TARGET_BUILD_TYPE=release
TARGET_ARCH=arm
HOST_ARCH=x86
HOST_OS=linux
HOST_BUILD_TYPE=release
BUILD_ID=
============================================ 
```

但是我怎样才能从中创建一个 egqemu 图像。我环顾了 /out 目录，找到了主机工具和模拟器，但不知道从哪里开始运行它。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-12T16:40:45.697

您是否正在尝试为模拟器构建？如果是这样，请按照以下步骤操作：

1.  从您的 android 根文件夹运行以下命令：“source build/envsetup.sh”，它将设置构建环境。
2.  要选择模拟器选项的构建，请使用以下命令“午餐 1”
3.  从您的根文件夹构建：“make -j4”（数字 4 是系统处理器数量的两倍，因此如果您有四核机器，请使用 -j8）。
4.  运行模拟器：“模拟器”

那应该让你开始。

如果您需要快速重建子集并在模拟器中加载更改，请使用“adb remount && adb sync”。

如果要重建系统映像，请使用“make snod”

希望这可以帮助。

# sql-server - SQL Server 2008 - 登录失败。登录来自不受信任的域，不能用于 Windows 身份验证

> ID：858678
> 
> 赞同：15
> 
> 时间：2009-05-13T15:35:22.927
> 
> 标签：sql-server, security, sql-server-2008, dns

我刚刚安装了 SQL Server 2008 Developer edition，我正在尝试使用 SQLCMD.exe 进行连接，但出现以下错误：

```
H:\>sqlcmd.exe -S ".\SQL2008"

Msg 18452, Level 14, State 1, Server DEVBOX\SQL2008, Line 1

Login failed. The login is from an untrusted domain and cannot be used with Windows authentication. 
```

SQL Server 实例配置为使用 SQL Server 和 Windows 身份验证模式。如果我指定 -U sa 那么我可以成功登录，但我想使用 windows 身份验证。使用带有 Windows 身份验证的 SSMS 进行连接似乎工作正常。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-03-16T20:08:22.300

我遇到了这个问题，这是因为运行应用程序的机器不受活动目录在域上委托的信任。例如，如果它是在应用程序池标识 DOMAIN_application.environment 下运行的 .net 应用程序。除非计算机受信任，否则该标识无法调用 SQL。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-13T15:41:43.697

您没有将任何凭据传递给 sqlcmd.exe

因此，它尝试使用 Windows 登录凭据对您进行身份验证，但您不能设置 SQL Server 来接受这些凭据...

安装时，您必须提供服务器管理员密码（用于`sa`帐户）

尝试...

```
sqlcmd.exe -U sa -P YOUR_PASSWORD -S ".\SQL2008" 
```

供参考，[这里](http://www.microsoft.com/products/ee/transform.aspx?ProdName=Microsoft+SQL+Server&EvtSrc=MSSQLServer&EvtID=18452)有更多详细信息...

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-05-16T18:45:20.453

就我而言，此错误是由重命名我的客户端计算机引起的。我使用了一个超过 13 个字符的新名称（尽管有警告），这导致 NETBIOS 名称被截断并且与完整的机器名称不同。一旦我将客户端重命名为更短的名称，错误就消失了。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-13T16:25:06.950

刚试过这个：

H:>"C:\Program Files\Microsoft SQL Server\90\Tools\Binn\sqlcmd.exe" -S ".\SQL2008" 1>

它可以工作..（我的路径中有 Microsoft SQL Server\100\Tools\Binn 目录）。

仍然不确定为什么 SQL Server 2008 版本的 SQLCMD 不起作用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-13T15:56:58.477

您的错误字面意思是“您正在尝试使用 Windows 身份验证，但您的登录不是来自受信任的域”。这很奇怪，因为您正在连接到本地机器。

也许您使用本地帐户而不是域帐户登录到 Windows？确保您使用的域帐户也是 SQL2008 实例上的 SQL Server 主体。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-13T15:43:15.723

您是否指定了登录用户名和密码？你的完整命令行到底是什么？

如果您在自己的机器上运行，您可以指定用户名/密码，或使用该`-E`参数使用您的 Windows 凭据登录（如果您的 SQL Server 安装允许这些凭据）。

马克

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-06-11T09:51:18.627

我也遇到了这个错误，尽管我的问题是我一直通过我的虚拟机在两个公司网络之间切换，使用不同的访问凭据。我必须运行命令提示符：

```
ipconfig /renew 
```

在此之后，我的网络问题得到解决，我可以再次连接到 SQL。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-06-16T08:40:14.337

刚刚找到这个线程并在此处发布了一个替代答案（复制如下）： [https ://stackoverflow.com/a/37853766/1948625](https://stackoverflow.com/a/37853766/1948625)

特别是在这个问题上，如果命令行值中`.`使用的点“”`-S`与 相同`127.0.0.1`，那么它可能与另一个问题的连接字符串相同。请改用主机名，或检查您的主机文件。

* * *

老问题，我的症状略有不同，但错误相同。我的连接字符串是正确的（集成安全性，我不提供用户和密码）`data source`设置为`127.0.0.1`. 多年来它工作得很好。

但是最近我在静态主机文件中添加了一行用于测试目的（`C:\Windows\System32\drivers\etc\hosts`）

```
127.0.0.1           www.blablatestsite.com 
```

删除这一行，错误就消失了。

我从这篇关于主机名和环回的文章 ( [https://support.microsoft.com/en-gb/kb/896861 ) 中得到了线索。](https://support.microsoft.com/en-gb/kb/896861)

其他可能的解决方法（如果您需要将该行保留在 hosts 文件中）是使用主机名（如`MYSERVER01`）而不是连接字符串中的`127.0.0.1`。`data source`

# javascript - 如何将 JQuery 事件目标转换为包装集？

> ID：858687
> 
> 赞同：1
> 
> 时间：2009-05-13T15:37:11.363
> 
> 标签：javascript, jquery

在我最近的项目中，我正在使用 click 事件，如下所示：

```
$(".nav-item").click(function(evt){
    do something here...
}) 
```

在事件处理函数内部，我想使用 jQuery 选择器查看事件目标的子级。就像是

```
$(event.target + " > .subitem").html() 
```

假设 .subitem 是具有类子项的子节点。

这似乎不起作用。有什么线索吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T15:40:12.170

尝试：`$(" > .subitem", evt.target).html()`

[jQuery 函数](http://docs.jquery.com/Core/jQuery#expressioncontext)的第二个参数为第一个参数提供上下文。

请注意，这`evt.target`将是实际点击的元素；如果您只想要`.nav-item`被点击的特定内容，请使用`$(this)`.

# vba - Excel 加载项如何响应任何工作表中的事件？

> ID：858691
> 
> 赞同：9
> 
> 时间：2009-05-13T15:37:40.600
> 
> 标签：vba, events, excel, add-in

我们的工作簿是**服务器生成的 SpreadsheetML**，不能包含*任何*VBA 代码。不幸的是，创建本机 Excel 文件或 Excel 2007 XML 文件也不是一种选择。

因此，我有一个 Excel 加载项（VBA，而不是 XLL），我们的每个用户都安装它来添加我们的工作簿需要的一些额外的 UDF 等。

这很好用，但现在我需要有一个宏，*每次*用户更改任何单元格中的文本时都需要执行该宏，无论他们当时正在积极使用什么工作簿。

到目前为止，我已经在我的加载项中创建了一个新的类模块 (SheetChangeHandler)，代码如下：

```
Option Explicit
Private WithEvents App As Application

Private Sub Class_Initialize()
    Set App = Application
End Sub

Private Sub App_SheetChange(ByVal Sh As Object, ByVal Source As Range)
    Debug.Print "Changed"
    On Error GoTo Finish
    App.EnableEvents = False
    DoWorkOnChangedStuff Sh, Source
Finish:
    App.EnableEvents = True
End Sub 
```

在我的加载项中，我添加了一行来实例化新类：

```
Public MySheetHandler As New SheetChangeHandler 
```

我的理解是，这应该使 Excel 为所有打开的工作簿发送加载项*所有*SheetChange 事件，而这些工作簿不需要包含任何宏代码。

但它不起作用......没有调试行，当我更改任何工作表上的单元格时，我的 DoWorkOnChangedStuff 代码没有被调用。

有任何想法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-13T17:18:38.703

不要在 dim 语句中使用 New 关键字。您告诉它在需要时实例化该类，但是您再也不会引用它，因此永远不需要它。反而：

```
Public MySheetHandler As SheetChangeHandler

Sub Auto_Open
   Set MySheetHandler = New SheetChangeHandler
End Sub
```

Auto_Open 中的那一行（在启动时运行）将实例化该类。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-08-26T20:09:46.837

从以下网址获取信息： [http](http://www.bettersolutions.com/vba/events/creating-application-level.htm) ://www.bettersolutions.com/vba/events/creating-application-level.htm 并尝试了 Dick Kusleika 的解决方案，但没有让类模块工作。经过 2 天的网络搜索和放弃之前，我尝试了这个并为我工作。考虑到：“工作簿是服务器生成的 SpreadsheetML，不能包含任何 VBA 代码”，也是我的要求。

我在名为“ApplicationEventClass”的类模块中写了这个：

```
Option Explicit

Public WithEvents ExcelAppEvents As Application

Private Sub Class_Initialize()
     Set ApplicationClass.ExcelAppEvents = Application
End Sub

Private Sub ExcelAppEvents_SheetChange(ByVal Sh As Object, ByVal Target As Range)
Target.Font.ColorIndex = 5
End Sub 
```

这在我的名为“Module1”的模块中：

```
Option Explicit

Public ApplicationClass As New ApplicationEventClass

Sub ConnectEventHandler()
      On Error Resume Next
      Set ApplicationClass.ExcelAppEvents = Application
End Sub 
```

就是这样！我希望这对你也有用。显然只在任何工作表中将文本颜色更改为蓝色。

# iphone - 更改 UITableViewCell 中的删除附件视图

> ID：858697
> 
> 赞同：10
> 
> 时间：2009-05-13T15:38:28.757
> 
> 标签：iphone, uikit, uitableview

是否可以更改响应于 UITableView 的 UITableViewCell 中从左到右“我想删除此行”滑动的视图？

目前，“删除”按钮似乎忽略了所有其他 UITableViewCell 自定义选项。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-13T15:51:37.720

删除单元格的棘手之处在于：当您从左向右滑动以显示“删除”按钮时，UITableViewCell 会移动到该`UITableViewCellStateShowingDeleteConfirmationMask`状态，但不会设置其`UITableViewCellStateEditingMask`状态。这意味着您无法更改`accessoryView`编辑状态。

解决这个问题的方法是查看`willTransitionToState:`UITableViewCell 的方法。您可以做的是拦截对此方法的调用，这将使您的单元格处于删除确认状态并显示您自己的视图，而不是通常显示的“删除”确认按钮。

有关更多信息，请查看UITableViewCell的[文档。](https://developer.apple.com/LIBRARY/IOS/documentation/UIKit/Reference/UITableViewCell_Class/Reference/Reference.html#//apple_ref/occ/instm/UITableViewCell/willTransitionToState:)`willTransitionToState:`

# java - Hibernate L2 缓存和多对多关系

> ID：858700
> 
> 赞同：3
> 
> 时间：2009-05-13T15:38:52.140
> 
> 标签：java, hibernate, orm

我有一对 Hibernate 实体 A 和 B，它们通过双向多对多关系相关，如此[处](http://docs.jboss.org/hibernate/stable/core/reference/en/html/collections-advancedmappings.html#collections-bidirectional)所述- 即，每个实体都有一个引用其他类型实体集合的包，带有一个包含每个实体的主键的链接表。

我还使用 Hibernate L2 缓存来缓存集合值，如下所示：

```
<bag name="xyz" table="XYZ" ...>
    <cache usage="nonstrict-read-write"/>
</bag> 
```

我发现的问题是，当我从一侧更新关系时，另一侧缓存的项目集合没有更新。

例如：

```
A a = session.get(1L, A.class);

B b = a.getBs().get(0);
Long bId = b.getId();

a.getBs().remove(0) // delete the B from A
// ... flush and commit the transaction...

B b2 = session.get(bId, B.class);
Collection<A> as = b2.getAs(); 
```

集合 as 仍然包含对 a 的引用，即使数据库状态反映了关系已被删除的事实。使缓存失效后，Hibernate 会返回正确的结果。

hibernate 是否有任何机制来处理相关实体的缓存失效，或者我需要从两端删除关系？

我正在使用休眠 3.2.6。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-31T12:33:54.267

根据定义，您需要从两侧删除。从技术角度来看这是有道理的，因为基本上这两个集合都是独立缓存的。

当然，从实际的角度来看这是胡说八道，很多人会绊倒它。

# javascript - 在 SharePoint 页面上通过 VBScript 访问 activeX 控件

> ID：858702
> 
> 赞同：1
> 
> 时间：2009-05-13T15:39:32.437
> 
> 标签：javascript, sharepoint, vbscript, activex

我正在为 PDF-XChange Viewer 软件使用 activeX 控件。

他们的支持团队给了我以下代码示例：

```
<html>
<head>
<title>PDF-XChange Viewer ActiveX test...</title>
<script language="VBScript">
    Sub btnGetProperty_OnClick()
        PXCV.OpenDocument "/sandpit/appsheet/faxcentre2/Faxes/1234-56789-abc-123-3.pdf", 0, 0, 0
    End Sub
</script>
</head>
<body>

<input type="button" id="btnGetProperty" value="Open document"></br>
<object id="PXCV" classid="CLSID:FE36F0F3-F082-41B7-9EED-772505A7C054" width="500" height="480">
</object>

</body>
</html> 
```

这在我们的标准浏览器 (IE7) 中运行良好，这是可以接受的，因为这是一个内部项目。

但是，如果我通过使用 SharePoint 设计器对其进行编辑并将 VBScript 添加到 AdditionalPageHead 内容区域并将 INPUT 和 OBJECT 标记添加到主要内容区域来将其添加到标准 SharePoint 页面中，则代码将失败。

报告的错误是：

错误：需要对象：'PXCV'

有谁知道这两者之间可能有什么不同？显然 SP 包含许多其他脚本和控件，并且 PXCV 对象在 DOM 中的位置完全不同，也许这就是问题所在。或者它是否与页面中存在其他脚本（据我所知所有 Javascript）有关？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-14T22:05:36.793

SharePoint Web 应用程序在启动时可能不会加载代码。我想您必须将底层 dll 包含到 SharePoint bin 或 GAC 中。然后您必须编辑相应的 web.config 以将该控件注册为“安全控件”。

# sharepoint - Sharepoint 上的 WebPart 连接。- 使用哪种类型？

> ID：858704
> 
> 赞同：0
> 
> 时间：2009-05-13T15:39:43.013
> 
> 标签：sharepoint, sharepoint-2007, web-parts

我编写了一个示例 webpart，它采用从 orher webpart 传递的参数并将其值显示在标签上。这是代码：

```
[Guid("11a885e9-13e1-4c6e-8045-e5575794ebd8")]
public class DisplayParameter : System.Web.UI.WebControls.WebParts.WebPart
{
    protected Label _label = new Label();
    private string _message; 

    [ConnectionConsumer("Parameter to show")]
    public void GetWPConnectedProviderInterface(IWebPartField connectProvider)
    {
        FieldCallback callback = FieldCallback;
        connectProvider.GetFieldValue(callback);
    }

    private void FieldCallback(object fieldValue)
    {
        _message = (string)fieldValue;
    }

    protected override void OnPreRender(EventArgs args)
    {
        if (string.IsNullOrEmpty(_message))
            _label.Text = "No Message.";
        else
            _label.Text = _message;
    }

    protected override void CreateChildControls()
    {
        base.CreateChildControls();
        Controls.Add(_label);
    }
} 
```

然后我将 WP 放在一个页面上，并使用 SPD 生成一个 DataView WP，以便将文件名从 Doc 库传递给 WP。
第一次可以正常工作，但是当我选择另一个文档时，出现以下异常：

> 无法将“Test.Assembly.SharepointProject.DislayParameter”类型的对象转换为“Microsoft.SharePoint.WebPartPages.WebPart”类型。

这让我想......我是否必须从 Microsoft.SharePoint.WebPartPages.WebPart 而不是 System.Web.UI.WebControls.WebParts.WebPart 继承？如果是这样，这有什么缺点，因为 MSDN 和博主建议使用后一类？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T04:30:28.960

我从来没有真正同意不使用特定于 SharePoint 的 webpart 子类 - 反对它的唯一原因是允许 web 部件在 SharePoint 以外的容器中运行 - 这在理论上很好，但我从未参与过一个项目Web 部件极有可能在 SharePoint 之外使用。

由于 SharePoint 2003 中存在早于 .NET 2.0 Web 部件的不同类型的 Web 部件，这个问题也可能有点模糊 - 那是绝对不应该使用的。

# c# - 通过代码，我如何测试硬盘驱动器是否正在休眠而不唤醒它

> ID：858706
> 
> 赞同：9
> 
> 时间：2009-05-13T15:40:10.783
> 
> 标签：c#, windows, hardware

我正在构建一个小应用程序，为我提供磁盘上的可用空间。

我想添加一个显示磁盘状态的功能，例如它是否处于睡眠状态。操作系统是 Windows。

如何才能做到这一点？当然，代码不应该唤醒磁盘来查找；）

C# 中的解决方案会很好，但我想任何解决方案都可以......

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-13T15:44:25.097

C++ 解决方案（调用 GetDiskPowerState 它将遍历物理驱动器，直到不再有）：

```
class AutoHandle
{
    HANDLE  mHandle;
public:
    AutoHandle() : mHandle(NULL) { }
    AutoHandle(HANDLE h) : mHandle(h) { }

    HANDLE * operator & ()
    {
        return &mHandle;
    }

    operator HANDLE() const
    {
        return mHandle;
    }

    ~AutoHandle()
    {
        if (mHandle && mHandle != INVALID_HANDLE_VALUE)
            ::CloseHandle(mHandle);
    }
};

bool
GetDiskPowerState(LPCTSTR disk, string & txt)
{
    AutoHandle hFile = CreateFile(disk, 0, FILE_SHARE_READ|FILE_SHARE_WRITE, NULL, OPEN_EXISTING, 0, NULL);
    if (hFile && hFile != INVALID_HANDLE_VALUE)
    {
        BOOL powerState = FALSE;
        const BOOL result = GetDevicePowerState(hFile, &powerState);
        const DWORD err = GetLastError();

        if (result)
        {
            if (powerState)
            {
                txt += disk;
                txt += " : powered up\r\n";
            }
            else
            {
                txt += disk;
                txt += " : sleeping\r\n";
            }
            return true;
        }
        else
        {
            txt += "Cannot get drive ";
            txt += disk;
            txt += "status\r\n";
            return false;
        }
    }

    return false;
}

string 
GetDiskPowerState()
{
    string text;
    CString driveName;
    bool result = true;
    for (int idx= 0; result; idx++)
    {
        driveName.Format("\\\\.\\PhysicalDrive%d", idx);
        result = GetDiskPowerState(driveName, text);
    }
    return text;
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-05-14T11:34:57.770

在 C# 中（来自[http://msdn.microsoft.com/en-us/library/ms704147.aspx](http://msdn.microsoft.com/en-us/library/ms704147.aspx)）

```
// Get the power state of a harddisk
string ReportDiskStatus()
{
    string status = string.Empty;
    bool fOn = false;

    Assembly assembly = Assembly.GetExecutingAssembly();
    FileStream[] files = assembly.GetFiles();
    if (files.Length > 0)
    {
        IntPtr hFile = files[0].Handle;
        bool result = GetDevicePowerState(hFile, out fOn);
        if (result)
        {
            if (fOn)
            {
                status = "Disk is powered up and spinning";
            }
            else
            {
                status = "Disk is sleeping";
            }
        }
        else
        {
            status = "Cannot get Disk Status";
        }
        Console.WriteLine(status);
    }
    return status;
} 
```

# emacs - Emacs 可以区分 ctrl-r 和 ctrl-shift-r 吗？

> ID：858713
> 
> 赞同：22
> 
> 时间：2009-05-13T15:41:47.020
> 
> 标签：emacs, keyboard-shortcuts, key-bindings

我想将`Ctrl`+绑定`R`到`'isearch-backward`和将`Ctrl`++`Shift`绑定`R`到，`'tags-apropos`但我无法区分这两个按键。

emacs 可以区分`Ctrl`+`R`和`Ctrl`++`Shift`吗`R`？什么应该进入我的 .emacs 文件以允许此键绑定？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-05-13T15:47:56.837

是的。

```
(global-set-key (kbd "C-r") 'isearch-backward)
(global-set-key (kbd "C-S-r") 'tags-apropos) 
```

找出这类问题答案的方法是对某个键进行帮助`C-h k`，然后键入您感兴趣的击键。Emacs 在*帮助*缓冲区中显示的是您可以传递给宏的字符串`'kbd`。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T15:47:52.937

是的——一个是`"\C-r"`，另一个是`"\C-R"`。它们可以很容易地绑定到单独的命令。例如，如果放在您的`.emacs`文件中，这应该可以解决问题：

```
(global-set-key "\C-R" 'tags-apropos) 
```

# iphone - 通话后状态栏恢复正常高度后，如何使视图再次变大？

> ID：858717
> 
> 赞同：0
> 
> 时间：2009-05-13T15:42:52.183
> 
> 标签：iphone, cocoa-touch, uikit

在模拟器中，我进入硬件菜单并在通话期间激活了更大状态栏的模拟。

现在，我试图在我的笔尖中创建一个占据整个屏幕的视图。一旦状态栏变小，我希望我的视图变大，所以它会使用那里的空间。

但是，无论任何自动调整大小设置如何，在状态栏变小后，我的视图都会保持按下状态。挂断电话后状态栏所在的位置有一个空槽。

那实际上应该是什么？我的应用程序将状态栏识别为视图，还是状态栏确实使我的屏幕变小了？我的意思是......它是否会像我的视图本身一样混淆我的视图，或者我的视图是否不知道状态栏，但当状态栏变大时屏幕尺寸会变小？

当状态栏恢复到正常高度时，如何让视图再次变大？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-14T05:27:46.477

```
[view setFrame:[[UIScreen mainScreen] applicationFrame]]; 
```

或者如果这不起作用

```
[view setFrame:[[UIScreen mainScreen] bounds]]; 
```

# mef - 寻找一个简单的 MEF 代码示例

> ID：858718
> 
> 赞同：2
> 
> 时间：2009-05-13T15:43:03.320
> 
> 标签：mef

我正在寻找一个简单的代码示例，展示如何使用 Microsoft Managed Extensibility Framework (MEF)。

我真的很喜欢[http://blogs.msdn.com/brada/archive/2008/09/29/simple-introduction-to-composite-applications-with-the-managed-extensions-framework.aspx](http://blogs.msdn.com/brada/archive/2008/09/29/simple-introduction-to-composite-applications-with-the-managed-extensions-framework.aspx)上的代码，但它是为 MEF CTP 2 或 3 编写的，并且当前版本 (CTP5) 的语法已更改。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T15:49:43.683

我只需下载 MEF 并查看包含的示例。

MEF 站点上也有一个包含[示例文档的页面。](http://mef.codeplex.com/Wiki/View.aspx?title=Samples)但是，示例文档有点过时 - 下载中的示例更新。此外，CTP5 增加了一个新样本（MEF Studio）。

在查看代码方面，这可能[是最](http://mef.codeplex.com/SourceControl/changeset/view/30766#455150)容易破译的示例。该文件中唯一缺少的部分是 MainWindow 类的定义：

```
[Export]
public partial class MainWindow
{
    // ... 
```

如果您添加它，它几乎是一个完整的示例。

# java - 带有元素 ID 的 DWR addRows()

> ID：858734
> 
> 赞同：0
> 
> 时间：2009-05-13T15:46:36.793
> 
> 标签：java, ajax, dwr

召集所有 DWR 大师！

我目前正在使用反向 Ajax 将数据动态添加到网页中的表中。

当我运行以下方法时：

```
public static void addRows(String tableBdId, String[][] data) {
    Util dwrUtil = new Util(getSessionForPage()); // Get all page sessions
    dwrUtil.addRows(tableBdId, data);
} 
```

根据需要在我的网页中创建新行。

但是，为了稍后更新这些新创建的值，标签需要有一个元素 ID 供我访问。

我查看了 DWR javadoc，您可以指定一些附加选项，请参阅[http://directwebremoting.org/dwr/browser/addRows](http://directwebremoting.org/dwr/browser/addRows)，但这对我来说意义不大，文档非常稀疏。

如果有人能给我一个关于如何为创建的 td 元素指定元素 ID 的线索，我将不胜感激。或者，如果有人知道另一种方法，我很想知道。

亲切的问候

卡尔

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-15T10:59:41.693

我能得到的最接近的是传递一些参数来给元素一个id。见下文：

```
 public static void addRows(String tableBdId, String[] data, String rowId) {

    Util dwrUtil = new Util(getSessionForPage()); // Get all page sessions

    // Create the options, which is needed to add a row ID
    String options = "{" +
            "  rowCreator:function(options) {" +
            "    var row = document.createElement(\"tr\");" +
            "     row.setAttribute('id','" + rowId + "'); " +
                    "    return row;" +
                            "  }," +
            "  cellCreator:function(options) {" +
            "    var td = document.createElement(\"td\");" +
            "    return td;" +
                 "  }," +
            "  escapeHtml:true\"}";

    // Wrap the supplied row into an array to match the API
    String[][] args1 = new String[][] { data };
    dwrUtil.addRows(tableBdId, args1, options); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-10-15T17:00:11.423

**你的这行代码真的有效吗？**

```
dwrUtil.addRows(tableBdId, data);
```

**DWR addRows 方法至少需要 4 的 3 个参数才能工作**，它们是：

1.  **id**：表格元素的id（最好是tbody元素）；
2.  **array**：数组（或 DWR 1.1 中的对象），包含更新表中每一行的一个条目；
3.  **cellfuncs**：一组函数（每列一个），用于从传递的行数据中提取单元格数据；
4.  **options**：包含各种选项的对象。

**id**、**array**和**cellfuncs**是**必需**的，在您的情况下，您还必须传递**选项**，因为**您想自定义行创建并设置 TD id**。看看这个：

在 options 参数中，您需要使用一个名为“cellCreator”的参数来告知您自己的方式来创建 td html 元素。看看这个：

```
// Use the cellFuncs var to set the values you want to display inside the table rows
// the syntax is object.property
// use one function(data) for each property you need to show on your table.
var cellFuncs = [
		         	function(data) { return data.name_of_the_first_object_property ,
		         	function(data) { return data.name_of_the_second_object_property; } 
		         	];											

DWRUtil.addRows(
				tableBdId, 
				data, 
				cellFuncs, 
				{
					  // This function is used for you customize the generated td element
					  cellCreator:function(options) {
							var td = document.createElement("td");
							// setting the td element id using the rowIndex
							// just implement your own id bellow
							td.id = options.rowIndex;
							return td;
					 }
				}); 
```

# c# - 如何将此行转换为 vb.net

> ID：858735
> 
> 赞同：3
> 
> 时间：2009-05-13T15:46:47.120
> 
> 标签：c#, asp.net-mvc, vb.net, anonymous-types

来自 asp.net MVC 的免费晚餐书

```
[AcceptVerbs(HttpVerbs.Post)]
public ActionResult Edit(int id, FormCollection formValues) {
    Dinner dinner = dinnerRepository.GetDinner(id);
    UpdateModel(dinner);
    dinnerRepository.Save();
    return RedirectToAction("Details", new { id = dinner.DinnerID });
} 
```

如何将此行转换为 vb.net？

```
return RedirectToAction("Details", new { id = dinner.DinnerID }); 
```

更多**新的 { id = Dinner.DinnerID }**部分

谢谢

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-13T15:50:24.540

试试这个

```
Return RedirectToAction("Details", New With { .id = dinner.DinnerID}) 
```

在 VB 中，匿名类型声明语法以及普通的对象初始值设定项都需要一个“.”。所有属性名称的前缀。这与其他 VB 功能（例如 With 上下文）是一致的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T15:50:47.927

那是使用[匿名类型](http://msdn.microsoft.com/en-us/library/cc468406.aspx)，所以它看起来像这样：

```
Return RedirectToAction("Details", New With { .id = dinner.DinnerID }) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T15:50:58.643

这应该有效：

```
Return RedirectToAction("Details", New With { .id = dinner.DinnerID }) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T15:52:19.170

```
New With {.id = dinner.DinnerID} 
```

# mysql - 你如何从mysql中选择每n行

> ID：858746
> 
> 赞同：80
> 
> 时间：2009-05-13T15:49:09.583
> 
> 标签：mysql

我在数据库中有一系列值，我需要提取这些值来创建折线图。因为我不需要高分辨率，所以我想通过从数据库中选择每 5 行来重新采样数据。

* * *

## 回答 #1

> 赞同：86
> 
> 时间：2009-05-13T16:01:35.100

```
SELECT * 
FROM ( 
    SELECT 
        @row := @row +1 AS rownum, [column name] 
    FROM ( 
        SELECT @row :=0) r, [table name] 
    ) ranked 
WHERE rownum % [n] = 1 
```

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2009-05-13T15:54:11.883

您可以尝试使用[mod](http://dev.mysql.com/doc/refman/5.0/en/mathematical-functions.html#function_mod) 5 来获取 ID 为 5 的倍数的行。（假设您有某种顺序的 ID 列。）

```
select * from table where table.id mod 5 = 0; 
```

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2009-05-13T16:01:00.280

既然您说您使用的是 MySQL，您可以使用[用户变量](http://dev.mysql.com/doc/refman/5.1/en/user-variables.html)来创建连续的行编号。不过，您确实必须将其放在派生表（子查询）中。

```
SET @x := 0;
SELECT *
FROM (SELECT (@x:=@x+1) AS x, mt.* FROM mytable mt ORDER BY RAND()) t
WHERE x MOD 5 = 0; 
```

我添加`ORDER BY RAND()`了一个伪随机抽样，而不是每次都允许无序表的每第五行出现在样本中。

* * *

一位匿名用户试图将其编辑`x MOD 5 = 0`为`x MOD 5 = 1`. 我已经把它改回了我原来的样子。

作为记录，在这种情况下可以使用 0 到 4 之间的任何值，并且没有理由偏爱一个值而不是另一个值。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2015-04-29T08:11:59.583

```
SET @a = 0;
SELECT * FROM t where (@a := @a + 1) % 2 = 0; 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-08-15T16:11:55.000

我一直在寻找这样的东西。泰勒和比尔的回答让我改进了他们的想法。

表 data1 有字段 read_date, value 我们想从一个受 read_date 范围限制的查询中选择每个 2d 记录派生表的名称是任意的，这里称为 DT

询问：

```
 SET @row := 0;
  SELECT * FROM  ( SELECT @row := @row +1 AS rownum, read_date, value  FROM data1  
  WHERE  read_date>= 1279771200 AND read_date <= 1281844740 ) as DT WHERE MOD(rownum,2)=0 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2020-03-10T23:16:24.937

如果您使用的是 MariaDB 10.2、MySQL 8 或更高版本，则可以更高效地执行此操作，并且我认为使用[通用表表达式](https://mariadb.com/kb/en/common-table-expressions/)和[窗口函数](https://mariadb.com/kb/en/window-functions/)更清楚。

```
WITH ordering AS (
  SELECT ROW_NUMBER() OVER (ORDER BY name) AS n, example.* 
    FROM example ORDER BY name
)
SELECT * FROM ordering WHERE MOD(n, 5) = 0; 
```

从概念上讲，这将创建一个临时表，其中包含`example`按字段排序的表内容`name`，添加一个称为行号的附加字段`n`，然后仅获取那些数字恰好能被 5 整除的行，即每 5 行。在实践中，数据库引擎通常能够更好地优化这一点。但即使它没有进一步优化它，我认为它比在早期版本的 MySQL 中迭代使用[用户变量更清晰。](https://mariadb.com/kb/en/user-defined-variables/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-04-21T06:14:33.547

```
SELECT *
FROM ( 
    SELECT @row := @row +1 AS rownum, posts.*
    FROM (
        SELECT @row :=0) r, posts
    ) ranked
WHERE rownum %3 = 1 
```

帖子是我的桌子。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-05-14T06:18:20.517

您可以使用此查询，

```
set @n=2; <!-- nth row -->
select * from (SELECT t.*, 
       @rowid := @rowid + 1 AS ID
  FROM TABLE t, 
       (SELECT @rowid := 0) dummy) A where A.ID mod @n = 0; 
```

或者您可以将**n**替换为您的**第 n 个值**

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2020-01-14T19:39:24.937

如果您不需要结果集中的行号，您可以简化查询。

```
SELECT 
    [column name] 
FROM
    (SELECT @row:=0) temp, 
    [table name] 
WHERE (@row:=@row + 1) % [n] = 1 
```

替换以下占位符：

1.  替换`[column name]`为您需要获取的列列表。
2.  替换`[table name]`为您的表的名称。
3.  替换`[n]`为一个数字。例如，如果您需要每 5 行，请将其替换为 5

# c# - 连接两个 Excel 文件并在 GridView 中显示

> ID：858749
> 
> 赞同：0
> 
> 时间：2009-05-13T15:50:16.240
> 
> 标签：c#, asp.net, excel

我有两个不同的 Excel 文件 (.xls)。有一列名为`KATIP`in `excel1.xls`，有一列名为`SAVCI`in `excel2.xls`。我想获取这些列并将它们合并到一个名为`Nobet`2 列的表中：`SAVCI`和`KATIP`.

然后我想在 ASP.NET 的 Gridview 控件中显示它们。我有工作代码，但是当我运行它时，它会获取第一列命名`KATIP`，然后获取名为`SAVCI`. 它们未合并，并且显示为不同的列。

```
OleDbConnection DBConnection = new OleDbConnection("Provider=Microsoft.Jet.OLEDB.4.0;" + "Data Source=" +
    Server.MapPath("~/App_Data/excel1.xls") + ";" + "Extended Properties=\"Excel 8.0;HDR=Yes\"");

DBConnection.Open();
string SQLString = "SELECT * FROM [Page1$]";
OleDbCommand DBCommand = new OleDbCommand(SQLString, DBConnection);
OleDbDataAdapter da = new OleDbDataAdapter(DBCommand);
DataSet ds = new DataSet("Nobet");
da.Fill(ds,"Nobet");
DBConnection.Close();
DBConnection = new OleDbConnection("Provider=Microsoft.Jet.OLEDB.4.0;" + "Data Source=" +Server.MapPath("~/App_Data/excel2.xls") + ";" + "Extended Properties=\"Excel 8.0;HDR=Yes\"");

DBConnection.Open();
DBCommand = new OleDbCommand(SQLString, DBConnection);
da = new OleDbDataAdapter(DBCommand);
da.Fill(ds,"Nobet");
GridView1.DataSource = ds.Tables["Nobet"];
GridView1.DataBind();
DBConnection.Close(); 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-26T15:03:54.830

我解决了我的问题......这就是我所做的：

```
OleDbConnection DBConnection = new
    OleDbConnection("Provider=Microsoft.Jet.OLEDB.4.0;" + "Data Source=" +
    Server.MapPath("~/App_Data/savcilik_katip.xls") + ";" + "Extended Properties=\"Excel 8.0;HDR=Yes\"");
DBConnection.Open();
OleDbCommand DBCommand = new OleDbCommand("SELECT * FROM [Sayfa1$]", DBConnection);
OleDbDataAdapter da = new OleDbDataAdapter(DBCommand);
DataSet ds = new DataSet("Nobet");
da.Fill(ds, "Nobet");
DBConnection.Close();
DBConnection = new
    OleDbConnection("Provider=Microsoft.Jet.OLEDB.4.0;" + "Data Source=" +
    Server.MapPath("~/App_Data/savcilik_savci.xls") + ";" + "Extended Properties=\"Excel 8.0;HDR=Yes\"");
DBConnection.Open();
DBCommand = new OleDbCommand("SELECT * FROM [Sayfa1$]", DBConnection);
da = new OleDbDataAdapter(DBCommand);
da.Fill(ds, "Nobetci");

DBConnection.Close();
for (int i = 0; i < ds.Tables["Nobet"].Rows.Count; i++)
{
    ds.Tables["Nobet"].Rows[i]["SAVCI"] = ds.Tables["Nobetci"].Rows[i]["SAVCI"];
}

GridView1.DataSource = ds.Tables["Nobet"];
GridView1.DataBind(); 
```

# c# - 如何使用 C# 解析文本文件

> ID：858756
> 
> 赞同：28
> 
> 时间：2009-05-13T15:52:01.573
> 
> 标签：c#, parsing, text

通过文本格式，我的意思是更复杂的东西。

起初，我开始手动将我要问这个问题的文本文件中的 5000 行添加到我的项目中。

文本文件有 5000 行不同长度。例如：

```
1   1   ITEM_ETC_GOLD_01    골드(소)   xxx xxx xxx_TT_DESC 0   0   3   3   5   0   180000  3   0   1   0   0   255 1   1   0   0   0   0   0   0   0   0   0   0   -1  0   -1  0   -1  0   -1  0   -1  0   0   0   0   0   0   0   100 0   0   0   xxx item\etc\drop_ch_money_small.bsr    xxx xxx xxx 0   2   0   0   1   0   0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0   0   0   0   0   0   0   0   0   0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 1   표현할 골드의 양(param1이상) -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx 0   0

1   4   ITEM_ETC_HP_POTION_01   HP 회복 약초    xxx SN_ITEM_ETC_HP_POTION_01    SN_ITEM_ETC_HP_POTION_01_TT_DESC    0   0   3   3   1   1   180000  3   0   1   1   1   255 3   1   0   0   1   0   60  0   0   0   1   21  -1  0   -1  0   -1  0   -1  0   -1  0   0   0   0   0   0   0   100 0   0   0   xxx item\etc\drop_ch_bag.bsr    item\etc\hp_potion_01.ddj   xxx xxx 50  2   0   0   1   0   0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0   0   0   0   0   0   0   0   0   0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 120 HP회복양   0   HP회복양(%)    0   MP회복양   0   MP회복양(%)    -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx 0   0

1   5   ITEM_ETC_HP_POTION_02   HP 회복약 (소)  xxx SN_ITEM_ETC_HP_POTION_02    SN_ITEM_ETC_HP_POTION_02_TT_DESC    0   0   3   3   1   1   180000  3   0   1   1   1   255 3   1   0   0   1   0   110 0   0   0   2   39  -1  0   -1  0   -1  0   -1  0   -1  0   0   0   0   0   0   0   100 0   0   0   xxx item\etc\drop_ch_bag.bsr    item\etc\hp_potion_02.ddj   xxx xxx 50  2   0   0   2   0   0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0   0   0   0   0   0   0   0   0   0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 220 HP회복양   0   HP회복양(%)    0   MP회복양   0   MP회복양(%)    -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx -1  xxx 0   0 
```

第一个字符（1）和第二个字符（1/4/5）之间的文本不是空格，它是一个制表符。该文本文件中没有空格。

我想要的是：

我想获得第二个整数（在我上面发布的三行中，第二个整数是 1,4 和 5）以及每行中间的字符串指示路径（它以“item\”开头并以文件扩展名“.ddj”）。

我的问题：

当我在谷歌上搜索“文本格式 C#”时 - 我得到的只是如何打开文本文件以及如何在 C# 中编写文本文件。我不知道如何在文本文件中搜索文本。我也无法搜索对于第一个整数，因为如果它是我上面发布的三行中的小整数，我将无法找到正确的位置，因为例如“1”可能存在于不同的位置。

我的问题：

如果我编写一个可以删除任何内容但我需要的程序，那将是最好的。

我想到的另一种方法是直接在该文件中搜索，但正如我上面提到的 - 如果第二个整数太低，我可能会得到错误的位置。

请提出一些建议，我无法手动格式化所有这些。

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2009-05-13T15:59:21.220

好的，这就是我们要做的：打开文件，逐行读取，然后按制表符拆分。然后我们获取第二个整数并遍历其余整数以找到路径。

```
StreamReader reader = File.OpenText("filename.txt");
string line;
while ((line = reader.ReadLine()) != null) 
{
    string[] items = line.Split('\t');
    int myInteger = int.Parse(items[1]);   // Here's your integer.

    // Now let's find the path.
    string path = null;
    foreach (string item in items) 
    {
        if (item.StartsWith("item\\") && item.EndsWith(".ddj"))
            path = item;
    }

    // At this point, `myInteger` and `path` contain the values we want
    // for the current line. We can then store those values or print them,
    // or anything else we like.
} 
```

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-05-13T16:09:24.697

另一个解决方案，这次使用正则表达式：

```
using System.Text.RegularExpressions;

...

Regex parts = new Regex(@"^\d+\t(\d+)\t.+?\t(item\\[^\t]+\.ddj)");

StreamReader reader = FileInfo.OpenText("filename.txt");
string line;
while ((line = reader.ReadLine()) != null) {
    Match match = parts.Match(line);
    if (match.Success) {
        int number = int.Parse(match.Group(1).Value);
        string path = match.Group(2).Value;

        // At this point, `number` and `path` contain the values we want
        // for the current line. We can then store those values or print them,
        // or anything else we like.
    }
} 
```

这个表达式有点复杂，所以在这里分解一下：

```
^        Start of string
\d+      "\d" means "digit" - 0-9\. The "+" means "one or more."
         So this means "one or more digits."
\t       This matches a tab.
(\d+)    This also matches one or more digits. This time, though, we capture it
         using brackets. This means we can access it using the Group method.
\t       Another tab.
.+?      "." means "anything." So "one or more of anything". In addition, it's lazy.
         This is to stop it grabbing everything in sight - it'll only grab as much
         as it needs to for the regex to work.
\t       Another tab.

(item\\[^\t]+\.ddj)
    Here's the meat. This matches: "item\<one or more of anything but a tab>.ddj" 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-13T15:58:02.110

您可以执行以下操作：

```
using (TextReader rdr = OpenYourFile()) {
    string line;
    while ((line = rdr.ReadLine()) != null) {
        string[] fields = line.Split('\t'); // THIS LINE DOES THE MAGIC
        int theInt = Convert.ToInt32(fields[1]);
    }
} 
```

您在搜索“格式化”时没有找到相关结果的原因是您正在执行的操作称为“解析”。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-13T16:15:05.093

就像已经提到的那样，我强烈建议使用正则表达式（在 System.Text 中）来完成这种工作。

[**结合使用RegexBuddy**](http://www.regexbuddy.com/)等可靠工具，您可以处理任何复杂的文本记录解析情况，并快速获得结果。该工具使其变得非常容易。

希望有帮助。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-13T16:28:31.717

我发现在这种情况下真正有用的一种方法是使用老式的 Jet OLEDB 提供程序以及 schema.ini 文件来使用 ADO.Net 读取大型制表符分隔的文件。显然，这种方法只有在你知道要导入的文件格式的情况下才真正有用。

```
public void ImportCsvFile(string filename)
{
    FileInfo file = new FileInfo(filename);

    using (OleDbConnection con = 
            new OleDbConnection("Provider=Microsoft.Jet.OLEDB.4.0;Data Source=\"" +
            file.DirectoryName + "\";
            Extended Properties='text;HDR=Yes;FMT=TabDelimited';"))
    {
        using (OleDbCommand cmd = new OleDbCommand(string.Format
                                  ("SELECT * FROM [{0}]", file.Name), con))
        {
            con.Open();

            // Using a DataReader to process the data
            using (OleDbDataReader reader = cmd.ExecuteReader())
            {
                while (reader.Read())
                {
                    // Process the current reader entry...
                }
            }

            // Using a DataTable to process the data
            using (OleDbDataAdapter adp = new OleDbDataAdapter(cmd))
            {
                DataTable tbl = new DataTable("MyTable");
                adp.Fill(tbl);

                foreach (DataRow row in tbl.Rows)
                {
                    // Process the current row...
                }
            }
        }
    }
} 
```

一旦您以良好的格式（例如数据表）获得数据，过滤掉您需要的数据就变得非常简单。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-13T15:58:09.163

尝试正则表达式。您可以在文本中找到特定模式并将其替换为您想要的内容。我现在不能给你确切的代码，但你可以用它来测试你的表达式。

[http://www.radsoftware.com.au/regexdesigner/](http://www.radsoftware.com.au/regexdesigner/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-13T16:00:51.170

您可以打开文件并使用 StreamReader.ReadLine 逐行读取文件。然后，您可以使用 String.Split 将每行分成几部分（使用 \t 分隔符）以提取第二个数字。

由于项目的数量不同，您需要在字符串中搜索模式“item\*.ddj”。

要删除一个项目，您可以（例如）将所有文件的内容保留在内存中，并在用户单击“保存”时写出一个新文件。

# .net - 导致此“Base-64 字符数组的长度无效”的原因

> ID：858761
> 
> 赞同：93
> 
> 时间：2009-05-13T15:52:34.663
> 
> 标签：.net, asp.net, exception, viewstate

我在这里几乎没有什么可做的。我无法在本地重现此内容，但当用户收到错误消息时，我会收到自动电子邮件异常通知：

```
Invalid length for a Base-64 char array.

  at System.Convert.FromBase64String(String s)
  at System.Web.UI.ObjectStateFormatter.Deserialize(String inputString)
  at System.Web.UI.ObjectStateFormatter.System.Web.UI.IStateFormatter.Deserialize(String serializedState)
  at System.Web.UI.Util.DeserializeWithAssert(IStateFormatter formatter, String serializedState)
  at System.Web.UI.HiddenFieldPageStatePersister.Load() 
```

我倾向于认为分配给视图状态的数据存在问题。 **例如：**

```
List<int> SelectedActionIDList = GetSelectedActionIDList();
ViewState["_SelectedActionIDList"] = SelectedActionIDList; 
```

如果无法在本地重现错误，则很难猜测错误的来源。

如果有人对此错误有任何经验，我真的很想知道您发现了什么。

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2010-03-16T10:52:13.073

在 urlDecode 处理文本后，它将所有 '+' 字符替换为 ' ' ...因此出现错误。您应该简单地调用此语句以使其再次兼容 base 64：

```
 sEncryptedString = sEncryptedString.Replace(' ', '+'); 
```

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-05-13T16:04:16.453

我已经看到这个错误是由大小合适的视图状态和过度激进的内容过滤设备/防火墙（尤其是在与 K-12 教育机构打交道时）的组合引起的。

我们通过将 Viewstate 存储在 SQL Server 中来解决这个问题。在走这条路之前，我建议尝试通过不在其中存储任何大的东西并为所有不需要它的控件关闭它来限制您对视图状态的使用。

在 SQL Server 中存储 ViewState 的参考资料：
[MSDN - PageStatePersister](http://msdn.microsoft.com/en-us/library/system.web.ui.pagestatepersister.aspx)
[ASP 联盟概述 - SQL Server 代码项目中存储视图状态的简单方法](http://aspalliance.com/72_Server_Side_Viewstate)
[- ViewState Provider Model](http://www.codeproject.com/Articles/8001/ViewState-Provider-an-implementation-using-Provide)

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2009-05-13T16:04:54.970

我的猜测是某些东西要么编码要么解码太频繁——或者你有多行的文本。

Base64 字符串的长度必须是 4 个字符的倍数 - 每 4 个字符代表 3 个字节的输入数据。不知何故，由 ASP.NET 传回的视图状态数据已损坏 - 长度不是 4 的倍数。

发生这种情况时，您是否记录用户代理？我想知道它是否是某个地方表现不佳的浏览器......另一种可能性是有一个代理在做淘气的事情。同样尝试记录请求的内容长度，以便您可以查看它是否只发生在大型请求中。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2012-02-15T21:17:11.297

尝试这个：

```
public string EncodeBase64(string data)
{
    string s = data.Trim().Replace(" ", "+");
    if (s.Length % 4 > 0)
        s = s.PadRight(s.Length + 4 - s.Length % 4, '=');
    return Encoding.UTF8.GetString(Convert.FromBase64String(s));
} 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2011-10-18T11:03:35.677

```
int len = qs.Length % 4;
            if (len > 0) qs = qs.PadRight(qs.Length + (4 - len), '='); 
```

`qs`任何base64编码的字符串在哪里

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2014-01-27T11:08:58.183

正如其他人所提到的，当某些防火墙和代理阻止访问包含大量 ViewState 数据的页面时，可能会导致这种情况。

ASP.NET 2.0 引入了[ViewState Chunking 机制](https://stackoverflow.com/questions/10413986/viewstate-chunking-in-asp-net)，它将 ViewState 分解为可管理的块，允许 ViewState 毫无问题地通过代理/防火墙。

要启用此功能，只需将以下行添加到您的 web.config 文件中。

```
<pages maxPageStateFieldLength="4000"> 
```

这**不**应该用作减少 ViewState 大小的替代方法，但它可以有效地防止因激进代理等导致的“Base-64 字符数组的长度无效”错误。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-08-04T01:19:25.447

看看你的 HttpHandlers。在我实施压缩工具（来自 Telerik 的 RadCompression）后的几个月里，我一直注意到一些奇怪且完全随机的错误。我注意到以下错误：

*   System.Web.HttpException：无法验证数据。

*   System.Web.HttpException：客户端断开连接。---> System.Web.UI.ViewStateException：无效的视图状态。

和

*   System.FormatException：Base-64 字符数组的长度无效。

*   System.Web.HttpException：客户端断开连接。---> System.Web.UI.ViewStateException：无效的视图状态。

我在我的博客上[写过这个。](https://web.archive.org/web/20111015131130/http://dot-net-sam.blogspot.com/2009/08/random-errors-invalid-length-for-base.html)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-09-30T04:06:29.640

很遗憾，这不是答案。在遇到间歇性错误一段时间后，我终于恼火地尝试修复它，但我还没有找到修复方法。但是，我已经确定了重现我的问题的方法，这可能对其他人有所帮助。

在我的情况下，这只是一个本地主机问题，在我的开发机器上也有应用程序的数据库。这是我正在使用 VS2005 编辑的 .NET 2.0 应用程序。Win7 64 位机器还安装了 VS2008 和 .NET 3.5。

以下是会产生错误的各种形式：

1.  加载表单的新副本。
2.  使用任何表单控件输入一些数据和/或回发。只要没有明显的延迟，重复你喜欢的一切，并且不会出现错误。
3.  稍等片刻（可能 1 或 2 分钟，不超过 5 分钟），然后尝试另一个回发。

一两分钟延迟“等待本地主机”，然后浏览器“连接已重置”，以及`global.asax`应用程序错误陷阱日志：

```
Application_Error event: Invalid length for a Base-64 char array.
Stack Trace:
     at System.Convert.FromBase64String(String s)
     at System.Web.UI.ObjectStateFormatter.Deserialize(String inputString)
     at System.Web.UI.Util.DeserializeWithAssert(IStateFormatter formatter, String serializedState)
     at System.Web.UI.HiddenFieldPageStatePersister.Load() 
```

在这种情况下，它不是视图状态的 SIZE，而是与页面和/或视图状态缓存有关的东西，这似乎在咬我。设置`<pages>`参数`enableEventValidation="false"`，`viewStateEncryption="Never"`并`Web.config`没有改变行为。也没有将其设置`maxPageStateFieldLength`为适度的东西。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-07-08T10:59:19.173

除了帮助我[的@jalchr 解决方案](https://stackoverflow.com/a/2453693/241211)之外，我发现`ATL::Base64Encode`从 c++ 应用程序调用以对传递给 ASP.NET Web 服务的内容进行编码时，还需要其他东西。此外

```
sEncryptedString = sEncryptedString.Replace(' ', '+'); 
```

从[@jalchr 的解决方案中，](https://stackoverflow.com/a/2453693/241211)您*还*需要确保**不使用以下`ATL_BASE64_FLAG_NOPAD`**标志`ATL::Base64Encode`：

```
 BOOL bEncoded = Base64Encode(lpBuffer,
                    nBufferSizeInBytes,
                    strBase64Encoded.GetBufferSetLength(base64Length),
                    &base64Length,ATL_BASE64_FLAG_NOCRLF/*|ATL_BASE64_FLAG_NOPAD*/); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-07-01T09:37:01.683

这是因为视图状态很大，就我而言，我很幸运，因为我没有使用视图状态。我刚刚添加`enableviewstate="false"`了表单标签，视图状态从 35k 变为 100 个字符

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-03-19T15:55:50.090

在使用 SqlMembershipProvider 对 Membership.ValidateUser 进行初始测试期间，我使用了结合盐的哈希 (SHA1) 算法，如果我将盐长度更改为不可被四整除的长度，我会收到此错误。

我没有尝试过上述任何修复，但如果盐被改变，这可能有助于某人查明这是这个特定错误的根源。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-09-26T16:30:03.927

正如 Jon Skeet 所说，字符串必须是 4 个字节的倍数。但我仍然收到错误。

至少它在调试模式下被删除了。设置一个断点，`Convert.FromBase64String()`然后单步执行代码。奇迹般地，错误对我来说消失了:) 它可能与其他人报告的视图状态和类似的其他问题有关。

# java - 如何将二进制文件存储在 sql 数据库中？

> ID：858765
> 
> 赞同：7
> 
> 时间：2009-05-13T15:53:02.243
> 
> 标签：java, sql

我有一个用于存储 excel 文件的 varbinary 列。我需要使用当前在我的文件系统上的不同 xls 文件的内容来更新此列。

给定一个 java.sql.Connection，我应该如何更新该行？

我们使用的是 sql server 2005。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-14T17:20:37.977

我最终做了以下事情：

```
PreparedStatement st = conn.prepareStatement("update MyTable set binaryData = ? where id= 9");
st.setBinaryStream(1, new FileInputStream(file), (int)file.length());
st.execute(); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T16:14:08.497

使用 java.util.Connection 和正确的 SQL，您可以创建适当的 java.sql.PreparedStatement（我不使用 SQL Server，因此您最好自己编写 SQL）。

您可以使用从 xls 文件中读取的字节数据创建 java.sql.Blob。

在 PreparedStatement 上调用 .setBlob(Blob) 然后执行它。

我没有为您编写代码，但这应该是基础。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T15:54:28.747

将字节数组传递给[BLOB](http://java.sun.com/j2se/1.5.0/docs/guide/jdbc/blob.html)字段。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2015-04-17T22:01:51.570

在旧版本的 Java 中，您可以尝试

```
obj.setObject("@somefield", some_data); 
```

# ant - 生成清单类路径 在蚂蚁

> ID：858766
> 
> 赞同：40
> 
> 时间：2009-05-13T15:53:25.020
> 
> 标签：ant, jar, classpath, manifest

在下面的构建文件中，jar 目标是指清单类路径的 jar.class.path 属性。编译目标是指 project.class.path

这里有冗余，因为 jar.class.path 和 project.class.path 非常相似。添加库时必须同时更新它们，如果库列表变得很长，这可能会很痛苦。有没有更好的办法？任何解决方案都必须是跨平台的，并且始终使用相对路径。

编辑：
它应该从文件集中生成 JAR 类路径，而不是相反，所以我可以使用通配符来包括目录中的所有 JAR 文件。

```
<?xml version="1.0"?>
<project name="Higgins" default="jar" basedir=".">

    <property name="jar.class.path" value="lib/forms-1.2.0.jar lib/BrowserLauncher.jar"/>

    <path id="project.class.path">
      <pathelement location="build"/>
      <fileset dir="lib">
        <include name="forms-1.2.0.jar"/>
        <include name="BrowserLauncher.jar"/>
      </fileset>
    </path>

    <target name="prepare">
        <mkdir dir="build"/>
    </target>

    <target name="compile" depends="prepare" description="Compile core sources">
        <javac srcdir="src"
               includes="**"
               destdir="build"
               debug="true"
               source="1.5">
          <classpath refid="project.class.path"/>
        </javac>
    </target>

    <target name="jar" depends="compile" description="Generates executable jar file">
        <jar jarfile="higgins.jar">
            <manifest>
                <attribute name="Main-Class" value="nl.helixsoft.higgins.Main"/>
                <attribute name="Class-Path" value="${jar.class.path}"/>
            </manifest>
            <fileset dir="build" includes="**/*.class"/>            
            <fileset dir="src" includes="**/*.properties"/>         
        </jar>
    </target>

</project> 
```

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-12-12T09:58:31.357

```
<path id="build.classpath">
  <fileset dir="${basedir}">
     <include name="lib/*.jar"/>
  </fileset>
</path>

<pathconvert property="manifest.classpath" pathsep=" ">
  <path refid="build.classpath"/>
  <mapper>
    <chainedmapper>
       <flattenmapper/>
       <globmapper from="*.jar" to="lib/*.jar"/>
    </chainedmapper>
  </mapper>
</pathconvert>

<target depends="compile" name="buildjar">
  <jar jarfile="${basedir}/${test.jar}">
     <fileset dir="${build}" />
     <manifest>
       <attribute name="Main-Class" value="com.mycompany.TestMain"/>
       <attribute name="Class-Path" value="${manifest.classpath}"/>
     </manifest>
 </jar>
</target> 
```

欲了解更多信息，请查看[这篇文章](http://www.rgagnon.com/javadetails/java-0587.html)。

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2009-05-18T17:41:20.510

假设 Ant 1.7 或更高版本，您可以使用[manifestclasspath](http://ant.apache.org/manual/Tasks/manifestclasspath.html)任务。

```
<path id="dep.runtime">
    <fileset dir="./lib">
        <include name="**/*.jar" />
    </fileset>
</path>
<property name="dep_cp" value="${toString:dep.runtime}" />

<target name="default">
    <manifestclasspath property="manifest_cp" jarfile="myjar.jar">
        <classpath refid="dep.runtime" />
    </manifestclasspath>
    <echo message="Build Classpath: ${dep_cp}" />
    <echo message="Manifest Classpath: ${manifest_cp}" />
</target> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-14T19:53:07.783

如果您只想在两个（或多个）路径之间共享一个公共子路径，那很容易做到：

```
<path id="lib.path>
    <fileset dir="lib">
        <include name="forms-1.2.0.jar"/>
        <include name="BrowserLauncher.jar"/>
    </fileset>
</path>

<path id="project.class.path">
    <pathelement location="build"/>
    <path refid="lib.path"/>
</path>

<property name="jar.class.path" refid="lib.path"/> 
```

**编辑**对不起，我误解了这个问题。尝试这个：

```
<property name="jar.class.path" value="lib/forms-1.2.0.jar lib/BrowserLauncher.jar"/>

<path id="project.class.path">
    <pathelement location="build"/>
    <fileset dir="." includes="${jar.class.path}"/>
</path> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-16T00:25:47.980

您可以使用 <pathconvert> 将路径（可以包含文件集）转换为纯字符串。您可能需要将该字符串 <echo> 到文件中，使用 <replace> 或 <replaceregexp> 来切断前导路径位，然后最后使用 <loadfile> 将操纵的字符串加载到最终属性中。

实施留给读者作为练习。

# c# - 从 XML 文件调用文本消息

> ID：858767
> 
> 赞同：0
> 
> 时间：2009-05-13T15:53:34.770
> 
> 标签：c#, xml, visual-studio-2008

目前我正在开发一个使用 Visual Studio 2008 和 C# 使用分层架构的软件。在该系统中，我想将所有文本消息（必要时使用消息框显示）保存在 XML 文件中，这样如果我更新任何消息，我就不必编译整个系统。我怎样才能做到这一点？XML 文件结构是什么？如何从 C# 代码调用消息？请描述并举例说明。谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-14T16:45:10.717

我将创建一个使用 .NET DataSet 和 DataTable 来存储 id 和消息（以及您需要的任何其他内容）的类。

这样，该类可以使用 DataSet.WriteXML() 和 DataSet.ReadXML() 从您指定的任何文件名保存/加载，您不必担心自己“手工制作” XML 格式。

这听起来像是一个方便的课程，所以我写了一个作为“概念证明”：

```
'*************************************************************************
'   Class: MsgFile
'  Author: Ron Savage
'    Date: 05/14/2009
'
' This class is an example for using an XML file to hold messages to be
' displayed by an application.
'
' Modification History
' Date        Init Comment
' 05/14/2009  RS   Created.
'*************************************************************************
Imports Microsoft.VisualBasic
Imports System.IO

Public Class MsgFile
   '*************************************************************************
   ' Class Variables
   '*************************************************************************
   Private MsgFile As String
   Private msgData As DataSet
   Private msgTable As DataTable

   '*************************************************************************
   '     Sub: New()
   '  Author: Ron Savage
   '    Date: 05/14/2009
   '
   ' Creates a new MsgFile from an existing file, or creates an empty one
   ' with the specified file name.
   '*************************************************************************
   Sub New(ByVal msg_File As String)
      Dim srcFile As New FileInfo(msg_File)

      If (srcFile.Exists()) Then
         msgData = New DataSet()

         Load(msg_File)
      Else
         NewFile(msg_File)
      End If
   End Sub

   '*************************************************************************
   '     Sub: NewFile()
   '  Author: Ron Savage
   '    Date: 05/14/2009
   '
   ' Creates a new XML message file.
   '*************************************************************************
   Sub NewFile(ByVal msg_File As String)
      Me.MsgFile = msg_File

      If (IsNothing(msgData)) Then
         msgData = New DataSet("MyAppMessages")
         msgTable = New DataTable("Messages")

         msgTable.Columns.Add(New DataColumn("Id", GetType(System.Int32), Nothing, MappingType.Attribute))
         msgTable.Columns.Add(New DataColumn("Text", GetType(System.String), Nothing, MappingType.Attribute))

         msgData.Tables.Add(msgTable)

         setMessage(0, "New file created")
      End If

      Save()
   End Sub

   '*************************************************************************
   '     Sub: Load()
   '  Author: Ron Savage
   '    Date: 05/14/2009
   '
   ' Loads an existing XML message file into the dataset.
   '*************************************************************************
   Public Sub Load(ByVal msgFileName As String)
      Dim srcFile As FileInfo = Nothing
      Me.MsgFile = msgFileName

      srcFile = New FileInfo(msgFileName)

      msgData.Clear()

      If (srcFile.Exists()) Then
         msgData.ReadXml(msgFileName)

         msgTable = msgData.Tables("Messages")
      End If
   End Sub

   '*************************************************************************
   '     Sub: Save()
   '  Author: Ron Savage
   '    Date: 10/05/2008
   '
   ' This routine saves the DataSet to an XML file.
   '*************************************************************************
   Public Overridable Sub Save()
      If (Not IsNothing(msgData) And Not MsgFile.Equals("")) Then
         Dim fileWriter As StreamWriter = New StreamWriter(MsgFile)

         msgData.WriteXml(fileWriter)

         fileWriter.Close()
      End If
   End Sub

   '*************************************************************************
   '     Sub: getMessage()
   '  Author: Ron Savage
   '    Date: 05/14/2009
   '
   ' This gets the text of the message.
   '*************************************************************************
   Public Function getMessage(ByVal msgId As String) As String
      Dim rowsFound() As System.Data.DataRow
      Dim msgText As String = ""

      If (Not IsNothing(msgTable)) Then
         rowsFound = msgTable.Select("Id = " + msgId.ToString)

         If (rowsFound.Length > 0) Then
            msgText = rowsFound(0).Item("Text").ToString
         End If

      End If
      Return (msgText)
   End Function

   '*************************************************************************
   '     Sub: setMessage()
   '  Author: Ron Savage
   '    Date: 05/14/2009
   '
   ' This sets the text of the message.
   '*************************************************************************
   Public Sub setMessage(ByVal msgId As Integer, ByVal msgText As String)
      Dim rowsFound() As System.Data.DataRow
      Dim msgRow As System.Data.DataRow

      If (Not IsNothing(msgTable)) Then
         rowsFound = msgTable.Select("Id = " + msgId.ToString)

         If (rowsFound.Length > 0) Then
            msgRow = rowsFound(0)

            msgRow.Item("Id") = msgId
            msgRow.Item("Text") = msgText
         Else
            msgRow = msgTable.NewRow()

            msgRow.Item("Id") = msgId
            msgRow.Item("Text") = msgText

            msgTable.Rows.Add(msgRow)
         End If
      End If

      Save()
   End Sub
End Class 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T15:56:41.690

对于您的方案，更好的选择可能是资源卫星 DLL。这是一个单独的 DLL，其中包含一组动态加载到您的应用程序中的资源。这就是有多少不同的应用程序进行本地化。最重要的是，有许多工具支持这种类型的功能。

更改消息只涉及更改此 DLL。这确实会导致编译，但只会编译资源而不是系统。

*   [http://msdn.microsoft.com/en-us/library/e9zazcx5.aspx](http://msdn.microsoft.com/en-us/library/e9zazcx5.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-14T16:34:26.187

您可能希望将自己的自定义部分添加到 app.config 文件中以存储您的消息。但是，这需要您在每次消息更改时更新 app.config 文件。

[http://msdn.microsoft.com/en-us/library/system.configuration.configurationsection.aspx](http://msdn.microsoft.com/en-us/library/system.configuration.configurationsection.aspx)

# css - 在div中定位div

> ID：858771
> 
> 赞同：0
> 
> 时间：2009-05-13T15:54:07.123
> 
> 标签：css, xhtml, html

我在根据需要将 div 放入 div 时遇到问题。请看下面的代码。

```
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    </head>
<body>
<div style="min-width:100%; min-height:90%; background-color:Red; text-align:center;">
<div style="min-height:100%; background-color:Green; width:90%; height:100%;
color:White;">testing 100% height and 90% width in red container</div>
</div>
<div style="min-height:10%; background-color:Yellow; width:100%;"></div>
</body>
</html> 
```

现在我想通过利用红色 div 的所有高度将绿色 div 放置在红色 div 内。因此，绿色 div 的高度应与红色 div 相同，宽度应为红色 div 宽度的 90%。我想我做了同样的事情，但它在任何浏览器中都不起作用。

要查看问题，请复制我提供的代码并将其保存为 HTML 文件。然后在 IE 中查看。

请帮我。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T16:03:28.497

1.  你没有 Doctype，所以浏览器会进入 Quirks 模式并出错（IE 比其他浏览器多）
2.  应用于高度为“auto”的元素的子元素的百分比高度被视为高度为“auto”。由于您没有为 body 元素指定高度，因此它的默认值为“auto”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T16:02:48.670

请记住将 DOCTYPE 放在开头，否则页面将以 quirks 模式呈现。

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T16:50:44.100

您的红色 div 必须指定一个高度，最小高度在 IE 中不起作用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-14T03:51:22.090

现在工作........

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" style="height:100%; width:100%;">
<head>
    <title></title>
    </head>
<body style="height:100%; width:100%; top:0px; left:0px;margin: 0px;">
<div style="width:100%; height:90%; background-color:Red;"><center style="height:100%; width:100%;">
<div style="background-color:Green; width:90%; min-height:100%; color:White; text-align:left; padding-left:20px;">testing 100% height and 90% width in red container</div></center>
</div>
<div style="min-height:10%; background-color:Yellow; width:100%;"></div>
</body>
</html> 
```

# javascript - 从 HTML 中过滤 JavaScript

> ID：858773
> 
> 赞同：8
> 
> 时间：2009-05-13T15:54:24.003
> 
> 标签：javascript, html, xss, filtering, sanitization

我有一个将 HTML 传递给服务器的富文本编辑器。然后将该 HTML 显示给其他用户。我想确保该 HTML 中没有 JavaScript。有没有办法做到这一点？

另外，如果有帮助，我正在使用 ASP.NET。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-13T16:04:19.557

*确保*某些 HTML 标记不包含任何 JavaScript的唯一方法是过滤掉所有不安全的 HTML 标记和属性，以防止[跨站点脚本](http://en.wikipedia.org/wiki/Cross-site_scripting)(XSS)。

但是，通常没有可靠的方法可以通过名称*显式删除*所有不安全的元素和属性，因为某些浏览器可能会解释您在设计时甚至不知道的内容，从而为恶意软件打开安全漏洞用户。这就是为什么您最好采用**白名单**方法而不是**黑名单**方法。也就是说，只允许您*确定*安全的 HTML 标签，并默认剥离所有其他标签。事实上，只有一个意外允许的标签会使您的网站容易受到 XSS 攻击。

* * *

## 白名单（好方法）

[请参阅有关HTML sanitisation](http://www.feedparser.org/docs/html-sanitization.html)的这篇文章，其中提供了一些具体示例，说明为什么应该将其列入白名单而不是列入黑名单。从该页面引用：

> 以下是潜在危险的 HTML 标记和属性的不完整列表：
> 
> *   `script`，其中可能包含恶意脚本
> *   `applet`, `embed`, and `object`, 可以自动下载并执行恶意代码
> *   `meta`，其中可能包含恶意重定向
> *   `onload`, `onunload`, 和所有其他`on*`属性，其中可能包含恶意脚本
> *   `style`, `link`, 和`style`属性，可以包含恶意脚本

[这](http://software.open-xchange.com/OX6/doc/Html-Whitelist/ch01.html)是另一个有用的页面，它建议了一组 HTML 标记和属性以及通常安全允许的 CSS 属性，以及推荐的做法。

## 黑名单（通常是不好的方法）

尽管许多网站过去（和现在）都使用黑名单方法，但几乎从来没有真正需要它。（安全风险总是超过白名单与授予用户的格式化功能所带来的潜在限制。）您需要非常了解它的缺陷。

例如，[此页面](http://forums.tizag.com/showthread.php?t=3459)提供了一个列表，其中列出了您可能想要删除的所谓“所有”HTML 标记。简单地观察一下，您应该注意到它包含的元素名称数量非常有限；浏览器很容易包含一个专有标签，该标签会无意中允许脚本在您的页面上运行，这本质上是黑名单的主要问题。

* * *

最后，我强烈建议您使用 .NET 的**HTML DOM 库**（例如著名的[HTML Agility Pack](http://www.codeplex.com/htmlagilitypack)），而不是 RegEx 来执行清理/白名单，因为它会更加可靠。（很可能创建一些非常疯狂的混淆 HTML 来欺骗正则表达式！一个合适的 HTML 阅读器/编写器使系统的编码更容易，无论如何。）

希望这可以让您大致了解为了完全（或至少最大限度地）防止 XSS 需要设计什么，以及在考虑未知因素的情况下执行 HTML 清理的重要性。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-13T16:06:31.923

正如 Lee Theobald 所指出的，这是一个非常危险的计划。根据定义，您不能通过过滤/黑名单生成“安全”HTML，因为用户可能会将您没有想到的内容放入 HTML 中（或者甚至在您的浏览器版本中不存在，但在其他版本中存在）。

唯一安全的方法是白名单方法，即去除除纯文本和某些特定 HTML 结构之外的所有内容。顺便说一句，这就是 stackoverflow.com 所做的:-)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-11-03T07:43:25.253

这是我使用白名单方法（Javascript 和 Python 代码）的方法

[https://github.com/dcollien/FilterHTML](https://github.com/dcollien/FilterHTML)

我为允许的 HTML 的子集定义了一个规范，这只是应该通过这个过滤器的内容。还有一些选项可以净化 URL 属性，只允许某些方案（如 http:、ftp: 等）并禁止那些会导致 XSS/Javascript 问题的方案（如 javascript:，甚至是数据:)

编辑：这不会在所有情况下为您提供开箱即用的 100% 安全性，但可以智能地使用并与其他一些技巧结合使用（例如检查 url 是否在同一个域上，以及正确的内容类型，等）这可能是你需要的

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-13T16:04:13.207

如果您希望更改 html，以便用户可以看到 HTML 代码本身。对所有 '<'、'>'、'&' 和 ';' 进行字符串替换。例如，'<' 变为 '<'。

如果您希望 html 正常工作，最简单的方法是删除所有 HTML 和 Javascript，然后仅替换 HTML。不幸的是，几乎无法确定删除所有 javascript 并只允许 HTML 的方法。

例如，您可能希望允许图像。但是你可能不知道你可以做到

```
<img src='evilscript.js'> 
```

它可以运行该脚本。它变得非常不安全非常快$。这就是为什么像维基百科和本网站这样的大多数网站都使用特殊的降价语言的原因。这使得允许格式化但不允许恶意 javascript 变得更加容易。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-13T16:02:51.260

您可能想检查一些基于浏览器的所见即所得编辑器（如[TinyMCE](http://tinymce.moxiecode.com/) ）是如何工作的。他们通常会删除 JS，并且似乎在这方面做得不错。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-05-13T15:58:23.467

最简单的做法是使用正则表达式去除标签。麻烦的是你可以在没有脚本标签的情况下做很多讨厌的事情（例如嵌入不可靠的图像，链接到其他带有讨厌 Javascript 的网站）。通过将小于/大于字符转换为它们的 HTML 实体形式（例如 <）来完全禁用 HTML 也是一种选择。

如果您想要一个更强大的解决方案，过去我使用[AntiSamy](http://www.owasp.org/index.php/Category:OWASP_AntiSamy_Project_.NET)来清理传入的文本，以便安全查看。

# svn - 当来自 svn 的代码在其中时无法删除回收站

> ID：858778
> 
> 赞同：1
> 
> 时间：2009-05-13T15:55:15.657
> 
> 标签：svn

我们使用 svn，当我想删除一个分支时，我将它移到回收站，但我一直遇到无法清理回收站的问题。

我不断收到错误：

“无法删除文件夹文本库：目录不为空。”

有没有人看到这个问题，有没有推荐的解决方案？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T21:47:18.373

如果您使用的是 TortoiseSvn，请尝试杀死 TSVNCache.exe。它可能仍然挂在 text-base 目录中的一个文件上

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T16:07:31.113

1）除非您绝对确定需要，否则我不建议您删除分支。即使那样，我也会等待几周，并确保您不再使用它。

2）如果您使用的是tortoiseSVN，只需右键单击包含分支的文件夹，然后转到tortoise的子菜单并选择删除。那应该创建一个更改列表来删除分支。然后只需选择 SVN 提交。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T16:23:33.347

如果你将一个分支移动到recicle bin，你只会删除包含该分支的目录，而不是分支本身。您必须使用 svn 接口来删除分支（如卢卡斯所说）

# javascript - 使 Firebug 在动态加载的 javascript 中中断

> ID：858779
> 
> 赞同：17
> 
> 时间：2009-05-13T15:55:21.413
> 
> 标签：javascript, jquery, firebug

我正在寻找一种调试动态加载的 jQuery document.ready 函数的方法。

显然我不能只调出脚本面板并用鼠标添加断点，因为那里不存在该函数。

我也尝试添加“调试器；” 到函数（不带引号），但这没有做任何事情。我已确保在尝试此操作时实际执行了该功能。

谢谢你的帮助，

阿德里安

**编辑：**我刚刚注意到 Firebug 实际上在调试时中断。但是，当它对动态加载的脚本执行此操作时，它不会像往常一样显示该脚本的源代码。另外，调用堆栈在我自己的代码下方结束。我可以通过调用堆栈调出 document.ready 的实现，但这并没有真正的帮助。这是一个 Firebug 错误还是我错过了什么？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-05-17T11:31:56.000

我刚刚研究了这个[类似的问题](https://stackoverflow.com/questions/874256/dynamicaly-loaded-js-function-does-not-appear-in-firebug-js-debugger/874400#874400)。解决方案包括两次添加单词调试器；一次位于外部文件的顶部，另一次位于需要调试的函数的顶部。

我注意到如果调试器词只使用一次，它就不起作用。例子：

```
//myExternal.js
debugger;
function myExternalFunction(){
 debugger;
 /* do something here */
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T16:24:45.263

您可以尝试在调用事件的位置放置一个断点，然后选择“Step Into”（F11）而不是单击“Play”。我面前没有测试用例，但我认为这可能有效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-07-15T21:40:34.737

**刚刚在Firefox 5.0/Firebug 1.7.3**中遇到了相同的行为（`debugger;`动态加载代码中的 Firebug 忽略语句）。

 **通过分离 Firebug 窗口（“在新窗口中打开 Firebug”）来解决。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-07-31T11:42:59.303

我不知道你有没有想过这个，但万一其他人需要它......

我通过将要调试的代码移动到从主页链接的外部文件来解决这个问题。

就我而言，我使用 jQuery AJAX 让 default.aspx 将 services.aspx 加载到内容 div 中。反过来，Services.aspx 使用 AJAX 从提供数据的 Web 服务加载 jQuery UI 选项卡元素。Web 服务代码位于从 default.aspx 链接的名为 data.js 的文件中。我需要调试 services.aspx 标头中的代码（加载带有数据的选项卡），但在任何可用的检查器中都看不到它。我只是将我需要的代码移到 data.js 中的一个新函数中，并从 services.aspx 的标头中调用它。

我希望这对需要它的人有意义！

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-05-13T21:06:47.770

IE JScript 调试器和 Safari 的 Web Inspector 也支持“调试器”关键字，所以如果 firebug 不支持它，我会感到惊讶。

基本上：

```
// mydynamicallyloadedfile.js
... // do stuff
debugger; // triggers debugger
... // more stuff 
```

而且我希望萤火虫会在`debugger`关键字处中断

# php - CSS/JS 中的动态 URL

> ID：858782
> 
> 赞同：14
> 
> 时间：2009-05-13T15:55:26.827
> 
> 标签：php, javascript, css, dynamic-css

我正在拆分我的一个较大的应用程序并引入一个“cdn”url 来容纳 CSS、javascript 和图像等常见对象以避免重复。不过，我需要做的是为我们的开发环境提供单独的 URL，所以我可能有：

```
http://cdn-dev.example.com
http://cdn-qua.example.com
http://cdn.example.com 
```

取决于我们工作的环境。我可以让它为我们的 PHP 代码生成的东西工作，但我对将被调用的 .css 和 .js 文件不知所措。例如，我该如何制作：

```
.cool-button { background-image: url('http://cdn.example.com/images/button.png'); } 
```

在不同的域之间切换？

处理它的最佳方法是什么？

[编辑]

大家都很清楚，CDN 地址与站点是不同的域。因此，开发站点可能是[http://www-dev.domain.com](http://www-dev.domain.com)，它将使用[http://cdn-dev.domain.com](http://cdn-dev.domain.com)

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-05-13T16:01:05.897

使用相对路径，而不是绝对路径。在 CSS 文件中时，路径是相对于 CSS 文件而不是 HTML 页面的。

如果你的 CSS 文件在这里

```
http://cdn.example.com/css/style.css 
```

你的课是

```
.cool-button { background-image: url('../images/button.png'); } 
```

然后浏览器将尝试从

```
http://cdn.example.com/images/button.png 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-13T16:00:01.670

只使用域相对网址？

```
.cool-button { background-image: url('/images/button.png'); } 
```

然后浏览器将在当前域下查找。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-13T16:10:01.887

您还可以有一个构建过程并使用模板来生成特定于环境的文件

例如在一个名为 yoursite.template.css 的文件中

.cool-button { background-image: url('@@URL@@/images/button.png'); }

创建 yoursite.css 文件，而不是将 @@URL@@ 替换为您想要的域。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-14T13:00:17.090

根据您的服务器配置，您还可以将 .php 扩展名附加到文件名，并将它们也视为 PHP 脚本：

```
I.E.: style.css.php would contain:

.cool-button { background-image url(<?php echo $bgImgUrl;?>); } 
```

这也适用于 JavaScript 文件。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-13T16:00:40.890

我今天实际上一直在做同样的事情，这就是我想出的。

将其粘贴到站点根目录下的 .htaccess 文件中。这显然依赖于 Apache 和 Mod_rewrite。

```
RewriteEngine on
RewriteBase /

# Redirect content to the CDN

RewriteCond %{HTTP_HOST} !^cdn\.server\.com$    [NC]
RewriteRule .*\.(jpg|gif|png|flv|css|js|swf)$   http://cdn.server.com/$0    [R=301,L] 
```

这会将括号中的文件类型的请求发送到您的 cdn，并在您的主服务器上保留对其他类型的请求。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-05-12T11:45:23.030

在寻找这个问题的答案时，我看到了一个简单的：创建具有重复类的 css 文件，一个用于场景 1（从同一域加载图像），另一个用于场景 2（从 CDN 加载图像）。

例如

```
.container {background-image:url(my/site/image.png;)}
.container-CDN {background-image:url(http://my.site.cdn.com/image.png;)} 
```

然后在你的 index.php 中引入 PHP 来调用正确的类

例如

```
<body class="container<?PHP if ($whatever) {echo "-CDN";} ?>"> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-13T16:01:08.237

如果服务器相同，则可以使用相对路径。像 /http/blah/test/images/button.png 或 ../images/button.png

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-13T16:05:52.097

使用相对 URL 时，您可以强制使用“基本”URL。在 <head> 标记中，使用 <base href="http://cdn-dev.example.com">。然后，每个相对链接“/style.css”都会指向“ [http://cdn-dev.example.com/style.css](http://cdn-dev.example.com/style.css) ”

供参考：[http ://www.w3schools.com/TAGS/tag_base.asp](http://www.w3schools.com/TAGS/tag_base.asp)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-13T16:12:48.390

嗯......我想出的解决方案是......有点......hackish，丑陋和愚蠢。但是，见鬼，它奏效了：

```
<?php
    if ($_SERVER['SERVER_NAME'] == "www.domain.tld") {

        $incs_path  = "/usr/local/psa/home/vhosts/domain.tld/non-web-root-folder/private-files";

    }
    else {
        $incs_path  = "incs";
    }

require_once "$incs_path/$file-to-be-called.inc";

?> 
```

如前所述，这既笨拙又丑陋，并且可以做得更漂亮。但它至少允许您根据主机定义特定文件组的特定位置。

# python - getopts Values 类和 Template.Substitute 不能（立即）一起工作

> ID：858784
> 
> 赞同：1
> 
> 时间：2009-05-13T15:55:57.840
> 
> 标签：python, templates, getopts

我有类似的python代码：

```
from string import Template
import optparse

def main():
  usage = "usage: %prog options outputname"
  p = optparse.OptionParser(usage)
  p.add_option('--optiona', '-a', default="")
  p.add_option('--optionb', '-b', default="")
  options, arguments = p.parse_args()
  t = Template('Option a is ${optiona} option b is ${optionb}')
  print t.substitute(options) 
```

但这给了我

```
AttributeError: Values instance has no attribute '__getitem__' 
```

因为`options`是值而不是字典。

我如何巧妙地完成这项工作？

（欢迎任何其他建议，我的蟒蛇意识仍在培养中......）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-13T16:29:29.657

`OptionParser.parse_args`返回一个对象，其中选项变量名称作为属性，而不是作为字典键。您收到的错误意味着`options`不支持下标，通常通过实现`__getitem__`.

因此，换句话说，您的选择是：

```
options.optiona
options.optionb 
```

而不是：

```
options['optiona']
options['optionb'] 
```

模板变量替换需要一个类似`dict`- 的接口，因此它试图使用后一种方法找到 optiona 和 optionb 。

按照他的回答中的建议使用 vars`RoadieRich`来使模板替换方法起作用。或者，除非您真的需要一个`Template`对象，否则我建议使用简单的`print`：

```
print 'Option a is %s and option b is %s' % (options.optiona, options.optionb) 
```

如果您觉得命名字符串参数更好，您也可以将这两种方法结合起来：

```
print 'Option a is %(optiona)s and option b is %(optionb)s' % vars(options) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-13T16:24:14.750

以下似乎对我有用：

```
from string import Template
import optparse

def main():
    usage = "usage: %prog options outputname"
    p = optparse.OptionParser(usage)
    p.add_option('--optiona', '-a', default="")
    p.add_option('--optionb', '-b', default="")
    options, arguments = p.parse_args()
    t = Template('Option a is ${optiona} option b is ${optionb}')
    print t.substitute(vars(options)) #I'm assuming the uppercase S was a typo. 
```

# iphone - 将 UIWebview 内容转换为 UIImage

> ID：858788
> 
> 赞同：10
> 
> 时间：2009-05-13T15:57:36.713
> 
> 标签：iphone, objective-c, cocoa-touch, core-animation

我正在使用 UIWebView 来显示 HTML 格式的文本。我没有加载网页，只是向 UIWebView 提供一串 HTML。

现在我想在屏幕上为这个 UIWebView 设置动画，实际上是其中的几个（一次 2-10 个）。UIWebView 有点重，虽然我还没有尝试过，但我正在做最坏的打算。（我不认为这是过早的优化，我几乎肯定这将是一个问题）

为了解决这个问题，我想我可以将 UIWebViews 的内容转换为 UIImages 并为它们设置动画。

所以，我的问题是：

1.  如何将 UIWebview 内容转换为 UIImage（或 CGImageRef）？
2.  我的 UIWebViews 有透明的 bacgrounds，透明度会传递到 UIImage 吗？

感谢您的任何建议

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-05-13T16:25:43.297

```
UIGraphicsBeginImageContext(webview.bounds.size);
[webview.layer renderInContext:UIGraphicsGetCurrentContext()];
UIImage *image = UIGraphicsGetImageFromCurrentImageContext();
UIGraphicsEndImageContext(); 
```

如果 webview 尺寸很大，您可能会遇到问题，因为 webview 使用的 a`CATiledLayer`由于内存原因不能绘制所有内容。

图像将包括透明度

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T23:36:20.567

我可能是错的，但如果您设置 CoreAnimation 的缓存参数，操作系统将为您处理此优化。

例如

```
[UIView setAnimationTransition:transition forView:self.view cache:YES]; 
```

# version-control - 如何在 IIS 下设置 TeamCity？

> ID：858790
> 
> 赞同：10
> 
> 时间：2009-05-13T15:57:44.390
> 
> 标签：version-control, teamcity

有任何想法吗？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2011-01-30T17:29:25.680

使用 IIS 7.5，您可以使用应用程序请求路由将请求路由`teamcity.server.domain.com:80`到 Tomcat 的`server.domain.com:81`. 我认为这种方法更优越，因为 Tomcat 连接器在 WS2008 x64 下似乎有点不稳定。

Jon Alb 有一篇关于如何在 WS2008 上配置 TeamCity 和 IIS 的文章：

*   [第1部分](http://jonalb.com/post/2010/10/23/TeamCity-On-Port-80-In-IIS.aspx)
*   [第2部分](http://www.jonalb.com/post/2010/10/30/TeamCity-via-IIS-on-port-80-using-a-reverse-proxy-Part-2-host-filtering.aspx)

此外，您需要确保您的 DNS 可以解析`teamcity.server.domain.com`为`server.domain.com`. 我的 IIS 服务器需要`ipconfig /registerdns`正确更新其 DNS 条目。正确的意思是在这种情况下，在 domain.com 查找区域中创建一个*域*`server`条目，一个简单的 A 记录是不够的。在该域中，您需要为 * 创建 CNAME 记录，因此任何子域都将被重定向到`server.domain.com`

我遇到的一个大问题是 IIS 7.5 似乎不再正确写入`applicationHost.config`文件，因此端口号最终不会被保留。这将导致一个令人讨厌的`400.0 Bad Request`错误，因为将达到 MAX_FORWARDS 限制（请求以圆圈为根）。

要解决此问题，请将以下内容添加到`C:\Windows\System32\inetsrv\config`：

```
<webFarms>
  <webFarm name="teamcity" enabled="true" adminUserName="" adminPassword="[enc:AesProvider:2blZ7roifGTktpn8zBBuVQ==:enc]" primaryServer="">
    <server address="localhost" enabled="true">
      <applicationRequestRouting httpPort="YOURPORTHERE!!!" />
    </server>
    <applicationRequestRouting>
      <loadBalancing algorithm="WeightedRoundRobin" />
      <protocol reverseRewriteHostInResponseHeaders="true" />
    </applicationRequestRouting>
  </webFarm>
</webFarms> 
```

**编辑**如果您正在运行其他站点并获得 404，除了遵循第 2 部分之外，您还需要创建一个虚拟站点来捕获主机名，如下面的 Ian Patrick Hughes 回答状态。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2011-10-19T03:25:09.420

要添加到 Johannes Rudolph 的答案... Jon Alb 文章是对在 IIS 7.5 中公开 Team City 进行简单细分的最佳选择。唯一要提到的是，如果您在该服务器实例上运行其他站点，在您完成他的[第二部分](http://www.jonalb.com/post/2010/10/30/TeamCity-via-IIS-on-port-80-using-a-reverse-proxy-Part-2-host-filtering.aspx)之后，您可能需要创建一个虚拟站点以查找子域主机标头值，因为 IIS 似乎从未执行过我的农场如果没有匹配的站点，则重新编写 url。但是，如果您想保护端口 80 上的 Team City 登录页面，这也应该允许您使用 HTTP 身份验证。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-13T16:00:49.970

您需要[Tomcat 和 Tomcat 的 IIS 连接器](http://tomcat.apache.org/connectors-doc/webserver_howto/iis.html)。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-06-08T10:20:35.943

在 IIS 7 中托管 TeamCity 的分步指南

[http://blog.endjin.com/2010/11/a-step-by-step-guide-to-hosting-teamcity-in-iis-7/](http://blog.endjin.com/2010/11/a-step-by-step-guide-to-hosting-teamcity-in-iis-7/)

# c# - 更新和持久化数据集问题

> ID：858798
> 
> 赞同：3
> 
> 时间：2009-05-13T15:59:46.820
> 
> 标签：c#, dataset, persistence

我想我错过了什么。这里很简单：我想更新一个数据集并将其推回它来自的数据库，但我不断得到：

> 并发冲突：UpdateCommand 影响了预期的 1 条记录中的 0 条。

这是一些产生此错误的代码：

```
 public static void UpdateNorthWindWithDataset()
    {
        string connString =
            @"Data Source=localhost;Initial Catalog=NorthWind;Integrated Security=SSPI;";

        using (SqlConnection conn = new SqlConnection(connString))
        {
            conn.Open();

            // Declaring a DataAdapter and initiating it with a Select and updateCommand                
            SqlDataAdapter da = new SqlDataAdapter();

            SqlCommand selectCmd = new SqlCommand("SELECT CustomerId, City, Region " +
                                                  "FROM Customers"
                                                  , conn
                );

            da.SelectCommand = selectCmd;

            SqlCommand updateCmd = new SqlCommand(
                @"UPDATE Customers SET City='@City', Region='@Region'" +
                @"WHERE CustomerID = '@CustomerID'",
                conn
                );

            updateCmd.Parameters.AddRange(
                new SqlParameter[]
                    {
                        new SqlParameter()
                            {
                                ParameterName = "@CustomerID",
                                SourceColumn = "customerid"
                            },
                        new SqlParameter()
                            {
                                ParameterName = "@City",
                                SourceColumn = "city",
                                SqlDbType = SqlDbType.VarChar
                            },
                        new SqlParameter()
                            {
                                ParameterName = "@Region",
                                SourceColumn = "region",
                                SqlDbType = SqlDbType.VarChar
                            }
                    }
                );

            da.UpdateCommand = updateCmd;

            // filling dataset
            DataSet ds = new DataSet();
            da.Fill(ds, "srcCustomers");

            // declaring and editing datatable
            DataTable tblCustomers = ds.Tables["srcCustomers"];

            foreach (DataRow row in tblCustomers.Rows)
            {
                row["City"] = "justUpdated";
                row["Region"] = "justUpdated too";
            }

            da.Update(ds, "srcCustomers");
        }
    } 
```

现在，我的最终目标是通过 OLEdb 将这种代码与 MsAccess 一起使用，但是因为我希望它尽可能清晰，所以我尝试了带有原生 .net 支持的 MSSQL（这里仍然是 2k），但仍然出现错误......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T16:17:09.083

更新失败，因为它找不到与提供的客户 ID 匹配的记录，我认为这是因为参数值没有被默认 - SQL 参数还有其他值允许您执行此操作。

如果您正在查看 OLEDB，则需要注意参数未命名（您可以并且可能应该命名它们，但它们将按照输入的顺序使用，而不是根据它们的名称 - 这也意味着您可以'不要两次使用相同的参数，这可能有点乏味）。

# sql - 从大表中删除数据

> ID：858800
> 
> 赞同：6
> 
> 时间：2009-05-13T16:00:02.030
> 
> 标签：sql

我有一个包含大约 10 个字段的表来为客户存储 gps 信息。随着时间的推移，随着我们增加了更多客户，该表已增长到大约 1400 万行。当 gps 数据进入服务时，会不断地在表中插入一行。90% 的数据并不重要，即客户不关心车辆 3 个月前在哪里，但最新数据用于生成跟踪报告。我的目标是编写一个 sql 来清除超过一个月的数据。

这是我的问题，我不能使用 TRUNCATE TABLE 因为我会失去一切？昨天我写了一个带有 where 子句的删除表语句。当我在测试系统上运行它时，它锁定了我的表，并且模拟 gps 插入间歇性地失败。我的事务日志也增长到超过 6GB，因为它试图记录每个删除。

我的第一个想法是从最旧的第一个开始一次删除一点数据，但我想知道是否有更好的方法。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-13T16:05:17.090

我的 2 美分：

如果您使用的是 SQL 2005 及以上版本，则可以考虑根据日期字段对表进行分区，这样在删除旧记录时表就不会被锁定。

或许，如果您处于制定 dba 决策的位置，您可以暂时将您的日志模型更改为 Simple，这样它就不会增长得太快，它仍然会增长，但日志不会太详细。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-13T16:11:05.957

试试这个

WHILE EXISTS ( SELECT * FROM table WHERE (删除条件))

BEGIN
SET ROWCOUNT 1000
DELETE Table WHERE（删除条件）
SET ROWCOUNT 0
ENd

这将删除 1000 组中的行

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-13T16:04:50.727

更好的是创建一个临时表并仅插入您想要保留的数据。然后截断原始表并复制备份。

Oracle 语法（SQL Server 类似）

```
create table keep as select * from source where data_is_good = 1;
truncate table source;
insert into source select * from keep; 
```

如果源表上有外键，您需要禁用外键。

在 Oracle 中，索引名称在整个模式中必须是唯一的，而不仅仅是每个表。在 SQL Server 中，您可以通过将“keep”重命名为“source”来进一步优化这一点，因为您可以轻松地在两个表上创建同名索引

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-13T16:07:54.560

如果您使用的是 SQL Server 2005 或 2008，滑动窗口分区是解决此问题的*完美*解决方案 - 即时存档或清除，没有任何可察觉的锁定。在[这里](http://msdn.microsoft.com/en-us/library/aa964122(SQL.90).aspx)查看更多信息。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-13T17:20:15.690

欢迎来到数据仓库。您需要将数据分成两部分。

*   实际应用，仅使用当前数据。

*   历史。

您需要编写一些“ETL”作业来将数据从当前移动到历史记录并删除已移动的历史记录。

您需要定期运行它。每天 - 每周 - 每月每季度 - 在技术上并不重要。重要的是历史有什么用途以及谁在使用它。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-13T16:04:31.727

您可以将最近的数据复制到新表中，截断表，然后将其复制回来吗？

当然，那么您将需要担心在 6 个月或一年后再次这样做。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-13T16:20:51.590

我会按天/月进行手动删除（无论您可以使用的最大单位是什么。）一旦您执行了第一个，然后编写一个存储过程以每天开始删除您不需要的最旧数据。

```
DELETE FROM TABLENAME 
WHERE datediff(day,tableDateTime,getdate() > 90 
```

就个人而言，我讨厌对生产数据集做一些事情，其中​​一个错过关键结果会导致一些非常糟糕的事情发生。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-13T16:05:33.347

我可能会像你已经想出的那样分批进行。另一种选择是将重要数据插入另一个表，截断 GPS 表，然后重新插入重要数据。您将有一个小窗口，您将在其中丢失最近的历史数据。该窗口有多小取决于您需要重新插入多少数据。此外，如果表使用自动递增数字或其他默认值，您需要小心，以便您使用原始值。

清理桌子后，应安排定期清洁工作。您可能还想根据您的 RDBMS 查看分区。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-13T16:08:29.253

我假设您无法关闭生产系统（或在清除完成后将 GPS 结果排队等待插入）。

根据您在测试系统上找到的性能，我会同意您一次删除一小部分（可能是 10%）的倾向。

你的表被索引了吗？这可能会有所帮助，但是索引过程对系统的影响与进行一次大清除类似。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-13T16:23:16.377

请记住，大多数数据库在事务期间将相邻记录锁定在索引中，因此保持操作简短会很有帮助。我假设您的插入因锁定等待超时而失败，因此请在小型突发事务中删除您的数据。我建议使用单线程 Perl 脚本，以最旧的 1,000 个块增量循环。我希望您的主键（并希望聚集索引以防它们最终成为两个不同的东西）可以与时间相关联，因为这将是最好的删除方法。

PseudoSQL: Select max(primId) < 3_months_ago 从 primId < maxPrimId 限制 1000 的表中删除

现在，这是真正有趣的部分：所有这些删除可能会使您的索引变得一团糟，并要求重建它们以防止机器变慢。在这种情况下，您要么必须换入最新的从属设备，要么只是遭受一些停机时间。确保在测试机器上测试这种可能的情况。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-13T16:37:12.420

如果您使用的是 oracle，我会在您的表和索引上按日期设置分区。然后你通过删除分区删除数据......数据将神奇地随着分区消失。

这是一个简单的步骤 - 并且不会阻塞您的重做日志等。

[这里](http://www.databasedesign-resource.com/oracle-partitions.html)有所有这些的基本介绍

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-13T17:36:34.367

删除语句是否使用表上的任何索引？通常，通过修改语句以使用现有索引或在表上添加有助于提高删除语句执行的查询性能的索引，可以获得巨大的性能改进。

此外，正如其他提到的，删除应该在多个块中完成，而不是一个巨大的语句。这可以防止表被锁定太久，并让其他进程超时等待删除完成。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-05-13T21:46:51.043

删除表时性能非常快 - 即使是非常大的表。所以这就是我要做的。使用 Management Studio 中的索引编写完整的表。编辑脚本并运行它以创建表的副本。称之为table2。执行选择插入以将要保留的数据停放在新表中2。重命名旧表，例如 tableOld。使用原始名称重命名 table2。等待。如果没有人对您大喊大叫，请放弃 table2。有一些风险。1）检查原始表上是否定义了触发器或约束。它们可能不会包含在管理工作室生成的脚本中。2) 如果原始表有标识字段，您可能必须在插入新表之前打开 identity_insert。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-05-19T19:09:44.447

我想出了以下 T-SQL 脚本，它可以获取任意数量的最新数据。

```
IF EXISTS(SELECT name FROM sys.tables WHERE name = 'tmp_xxx_tblGPSVehicleInfoLog')
BEGIN
    PRINT 'Dropping temp table tmp_xxx_tblGPSVehicleInfoLog'
    DROP TABLE tmp_xxx_tblGPSVehicleInfoLog
END
GO

PRINT 'Creating temp table tmp_xxx_tblGPSVehicleInfoLog'
CREATE TABLE [dbo].[tmp_xxx_tblGPSVehicleInfoLog](
    [GPSVehicleInfoLogId] [uniqueidentifier] NOT NULL,
    [GPSVehicleInfoId] [uniqueidentifier] NULL,
    [Longitude] [float] NULL,
    [Latitude] [float] NULL,
    [GroundSpeed] [float] NULL,
    [Altitude] [float] NULL,
    [Heading] [float] NULL,
    [GPSDeviceTimeStamp] [datetime] NULL,
    [Milliseconds] [float] NULL,
    [DistanceNext] [float] NULL,
    [UpdateDate] [datetime] NULL,
    [Stopped] [nvarchar](1) NULL,
    [StopTime] [datetime] NULL,
    [StartTime] [datetime] NULL,
    [TimeStopped] [nvarchar](100) NULL
) ON [PRIMARY]
GO

PRINT 'Inserting data from tblGPSVehicleInfoLog to tmp_xxx_tblGPSVehicleInfoLog'
SELECT * INTO tmp_xxx_tblGPSVehicleInfoLog 
FROM tblGPSVehicleInfoLog 
WHERE tblGPSVehicleInfoLog.UpdateDate between '03/30/2009 23:59:59' and '05/19/2009  00:00:00'
GO

PRINT 'Truncating table tblGPSVehicleInfoLog'
TRUNCATE TABLE tblGPSVehicleInfoLog
GO

PRINT 'Inserting data from tmp_xxx_tblGPSVehicleInfoLog to tblGPSVehicleInfoLog'
INSERT INTO tblGPSVehicleInfoLog 
SELECT * FROM tmp_xxx_tblGPSVehicleInfoLog 
GO 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-08-11T21:00:04.960

为了防止事务日志变得失控，请按以下方式对其进行修改：

```
DECLARE @i INT
SET @i = 1
SET ROWCOUNT 10000

WHILE @i > 0
BEGIN
    BEGIN TRAN
        DELETE TOP 1000 FROM dbo.SuperBigTable
        WHERE RowDate < '2009-01-01'
    COMMIT
    SELECT @i = @@ROWCOUNT
END
SET ROWCOUNT 0 
```

这是使用 SQL 2005 和 2008 首选 TOP 语法的版本：

```
DECLARE @i INT
SET @i = 1

WHILE @i > 0
BEGIN
    BEGIN TRAN
        DELETE TOP 1000 FROM dbo.SuperBigTable
        WHERE RowDate < '2009-01-01'
    COMMIT
    SELECT @i = @@ROWCOUNT
END 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2019-11-22T21:26:56.153

我正在分享我的解决方案。我确实索引了日期字段。在程序运行时，我测试了记录计数、插入和更新。他们能够在程序运行时完成。在 Azure 托管实例中，在绝对最低配置（通用，4 核）上运行，我能够在一分钟内（大约 55 秒）清除 100 万行。

```
CREATE PROCEDURE [dbo].[PurgeRecords] (
 @iPurgeDays INT = 2,
 @iDeleteRows INT = 1000,
 @bDebug BIT = 1 --defaults to debug mode
)
AS

SET NOCOUNT ON
DECLARE @iRecCount INT = 0 
DECLARE @iCycles INT = 0
DECLARE @iRowCount INT = 1
DECLARE @dtPurgeDate DATETIME = GETDATE() - @iPurgeDays
SELECT @iRecCount = COUNT(1) FROM YOURTABLE WHERE [Created] <= @dtPurgeDate
SELECT @iCycles = @iRecCount / @iDeleteRows
SET @iCycles = @iCycles + 1  --add one my cycle to get the remainder
--purge the rows in groups
WHILE @iRowCount <= @iCycles
 BEGIN
  BEGIN TRY
   IF @bDebug = 0
    BEGIN
     --delete a group of records
     DELETE TOP (@iDeleteRows) FROM YOURTABLE WHERE [Created] <= @dtPurgeDate
    END
   ELSE
    BEGIN
     --display the delete that would have taken place
     PRINT 'DELETE TOP (' + CONVERT(VARCHAR(10), @iDeleteRows) + ') FROM YOURTABLE WHERE [Created] <= ''' + CONVERT(VARCHAR(25), @dtPurgeDate) + ''''
    END
   SET @iRowCount = @iRowCount + 1

  END TRY
  BEGIN CATCH
   --if there are any issues with the delete, raise error and back out
   RAISERROR('Error purging YOURTABLE Records', 16, 1)
   RETURN
  END CATCH
 END
GO 
```

# javascript - 不安全的 JavaScript 尝试访问 Safari 中的框架警告

> ID：858811
> 
> 赞同：29
> 
> 时间：2009-05-13T16:01:06.473
> 
> 标签：javascript, safari, facebook, warnings

我在我的应用程序中使用 Facebook Connect。我让它运行得很好，但是在 Safari 错误控制台中，我看到了这样的错误：

```
Unsafe JavaScript attempt to access frame with URL http://...#... from frame with URL http://www.connect.facebook.com/extern/login_status.phpapi_key=..&extern=2&channel=http...xd_receiver.htm.
Domains, protocols and ports must match. 
```

该应用程序似乎运行正常，但我们看到 Safari 出现周期性挂起和其他不良行为。当我运行其他 Facebook Connect 应用程序时，有时我也会看到这个错误，所以我认为这不是我们的实施问题。忽略此警告是否安全？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-14T08:05:26.563

Safari 的跨框架安全性比其他浏览器更严格，我已经做了特定的 try/catch 包装器来处理这些情况，如果它可以正常工作，那就太好了。

无论哪种方式，都会按照 olliej 的建议将错误发布到上游。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T17:08:25.460

这意味着您正在尝试某种形式的跨源访问，这是不安全的——虽然它可能看起来是良性的，但可能值得尝试找出您为什么要点击它，如果您使用 nightlies 或 Safari4 测试版，您可以使用Web 检查器中的调试器，并使其在所有异常上中断，这将让您看到它何时实际尝试跨域访问。

[至于挂起，如果你能找到某种简化的测试用例，如果你能把它们归档在http://bugs.webkit.org](http://bugs.webkit.org)那就太好了

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-03-18T18:52:43.327

这是一条红鲱鱼。请求仍然通过，一切正常，但 WebKit 仍然记录异常。

# windows - 从 WSH 或其他本机 Windows 程序访问 Win32 CreateEvent/SetEvent

> ID：858816
> 
> 赞同：0
> 
> 时间：2009-05-13T16:01:25.507
> 
> 标签：windows, winapi, wsh

我需要与使用命名的程序套件交互。Win32 事件（例如，`CreateEvent()`API）在正在运行的进程之间进行通信。

我可以用一些非常简单的 C 代码来做到这一点

```
 h = CreateEvent(NULL, FALSE, FALSE, argv[1]);
 if (h != INVALID_HANDLE_VALUE) SetEvent(h); 
```

但是，由于政策问题，我无法在生产机器上安装自定义二进制文件！

有没有办法用 Windows Scripting Host 做到这一点？

我可能会将签名的二进制文件添加到生产环境中——因此其他脚本语言可能是可行的。欢迎提出建议。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-30T23:40:04.980

> 我无法在生产机器上安装自定义二进制文件！...我可能会将签名的二进制文件添加到生产环境中

签署您自己的二进制文件。

谁制定了允许您运行任意 WSH 程序而不是二进制文件的政策，都应该为您的代码签名证书付费。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T16:04:36.110

如果您只需要一个 Win32 事件来进行正常事件，您可以使用 PowerShell。这将使您能够访问 .Net 框架。这将允许您通过使用托管事件类（例如 ManualResetEvent）间接访问 API。这只是普通 CreateEvent API 之上的一个薄包装器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-14T00:22:05.593

Python 有一个 PyWin32 库，允许您使用 Windows API 函数，包括 CreateEvent/SetEvent。

通常（并且具有不同程度的便利），您可以使用任何允许定义和调用外部函数的语言（在本例中来自 kernel32.dll）。

# sql - 如何清除 oracle 执行计划缓存以进行基准测试？

> ID：858829
> 
> 赞同：35
> 
> 时间：2009-05-13T16:03:38.420
> 
> 标签：sql, oracle10g

在 oracle 10gr2 上，我有几个要比较性能的 sql 查询。但是在它们第一次运行之后，v$sql 表存储了用于缓存的执行计划，因此对于其中一个查询，我从第一次运行时的 28 秒到运行后的 0.5 秒。

我试过了

`ALTER SYSTEM FLUSH BUFFER_CACHE;`

运行此之后，查询始终以 5 秒运行，我认为这不准确。

想也许从缓存中删除行项目本身：

`delete from v$sql where sql_text like 'select * from....`

但我收到一个关于无法从视图中删除的错误。

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2009-05-27T19:13:03.533

彼得回答了你提出的问题。

```
alter system flush shared_pool; 
```

那就是您将用来“从缓存中删除准备好的语句”的语句。

（准备好的语句不是从共享池中刷新的唯一对象，该语句的作用不止于此。）

正如我在之前的评论（关于您的问题）中指出的那样，`v$sql`不是表格。它是一个动态性能视图，是 Oracle 内部内存结构的一种方便的类似表的表示形式。您对动态性能视图只有 SELECT 权限，不能从中删除行。

* * *

**刷新共享池和缓冲区缓存？**

以下内容不直接回答您的问题。相反，它回答了一个根本不同（也许更重要）的问题：

我们通常应该刷新共享池和/或缓冲区缓存来衡量查询的性能吗？

简而言之，答案是否定的。

我认为 Tom Kyte 很好地解决了这个问题：

~~[http://www.oracle.com/technology/oramag/oracle/03-jul/o43asktom.html](http://www.oracle.com/technology/oramag/oracle/03-jul/o43asktom.html)~~
[http://www.oracle.com/technetwork/issue-archive/o43asktom-094944.html](http://www.oracle.com/technetwork/issue-archive/o43asktom-094944.html)

**<摘录>**

实际上，重要的是调整工具不要这样做。重要的是运行测试，忽略结果，然后运行两到三遍并平均这些结果。在现实世界中，缓冲区缓存永远不会没有结果。绝不。调整时，您的目标是减少逻辑 I/O (LIO)，因为这样物理 I/O (PIO) 将自行处理。

考虑一下：刷新共享池和缓冲区缓存比不刷新它们更加人为。我怀疑，大多数人似乎对此持怀疑态度，因为它违背了传统智慧。我将向您展示如何执行此操作，但不是为了让您可以将其用于测试。相反，我将用它来证明为什么它是徒劳的和完全人为的练习（因此会导致错误的假设）。我刚刚启动了我的电脑，我已经对一个大表运行了这个查询。我“刷新”缓冲区缓存并再次运行它：

**</摘录>**

我认为汤姆凯特是完全正确的。在解决性能问题方面，我认为“清除 oracle 执行计划缓存”通常不是可靠基准测试的步骤。

让我们解决对性能的担忧。

您告诉我们，您观察到与后续执行（约 5 秒）相比，第一次执行查询所需的时间要长得多（约 28 秒），即使在刷新（所有索引和数据块来自）缓冲区缓存时也是如此。

对我来说，这表明**硬解析**正在做一些繁重的工作。要么工作量大，要么遇到很多等待。可以对此进行调查和调整。

我想知道是否可能不存在统计信息，并且优化器在准备查询计划之前花费了大量时间收集统计信息。这是我要检查的第一件事，即在所有引用的表、索引和索引列上收集统计信息。

如果您的查询连接大量表，CBO 可能会考虑连接顺序的大量排列。

Oracle 跟踪的讨论超出了这个答案的范围，但这是下一步。

我认为您可能想要跟踪事件 10053 和 10046。

这是 Tom Kyte 的“事件 10053”讨论的链接，您可能会觉得有用：

[http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:63445044804318](http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:63445044804318)

* * *

**相关的轶事：硬解析性能**

几年前，我确实看到一个查询在第一次执行时以 MINUTES 为单位，随后以秒为单位执行。我们发现，第一次执行的绝大多数时间都花在了硬解析上。

这个问题查询是由一个 CrystalReports 开发人员编写的，他天真地（天真地？）加入了两个巨大的报告视图。

其中一个视图是 62 个表的连接，另一个视图是 42 个表的连接。

该查询使用了基于成本的优化器。跟踪显示这不是等待时间，而是所有 CPU 时间都花在评估可能的连接路径上。

每个供应商提供的“报告”视图本身并不算太糟糕，但是当它们中的两个加入时，速度慢得令人痛苦。我相信问题在于优化器正在考虑的大量连接排列。有一个实例参数限制优化器考虑的排列数量，但我们的修复是重新编写查询。改进后的查询只加入了查询实际需要的十几个表。

（最初的短期“创可贴”修复是安排在早上早些时候运行查询，在报告生成任务运行之前。这使得报告生成“更快”，因为报告生成运行利用了已经在共享池中准备好语句，避免硬解析。

创可贴修复不是真正的解决方案，它只是将问题转移到查询的初步执行，而没有注意到长执行时间。

我们的下一步可能是为查询实现“存储大纲”，以获得稳定的查询计划。

当然，语句重用（避免硬解析，使用绑定变量）是 Oracle 中的规范模式。它提高了性能，可扩展性，yada，yada，yada。

这个轶事事件可能与您观察到的问题完全不同。

* * *

高温高压

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-05-13T16:21:02.463

自从我使用 Oracle 以来已经有一段时间了，但我相信执行计划缓存在共享池中。尝试这个：

```
alter system flush shared_pool; 
```

缓冲区缓存是 Oracle 存储最近使用的*数据*以最小化磁盘 io 的地方。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-17T14:14:58.720

我们最近在性能调优查询方面做了很多工作，导致查询性能不一致的罪魁祸首之一是 Oracle 所在的文件系统缓存。

当您刷新 Oracle 缓存时，文件系统可能仍然有您的查询要求的数据，这意味着查询仍将快速返回。

不幸的是，我不知道如何清除文件系统缓存 - 我只是使用我们非常有用的系统管理员提供的一个非常有用的脚本。

# html - zlib 压缩 html 页面的文件扩展名？

> ID：858830
> 
> 赞同：2
> 
> 时间：2009-05-13T16:03:38.467
> 
> 标签：html, file, gzip, zlib, deflate

使用 zlib (deflate) 压缩的 html 文件在服务器上看起来像什么？它的扩展名是否与 .html 不同？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T16:08:36.353

它具有您上传时使用的扩展名。

请注意，如果您要求 Web 服务器提供压缩的 html 页面，它会即时执行此操作，并且它所做的任何缓存都将位于您的网站目录之外的某个位置，因此您实际上不会看到这些文件，如果它们根本就是文件。

换句话说，如果您提供即时压缩文件，您可以将普通文件以普通的 .htm 或 .html 扩展名存储在服务器上。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T16:15:03.097

根据您的网络服务器设置，除了让网络服务器自动压缩它们之外，还可以提前压缩 html 文件。通常扩展名是.gz，例如MyPage.html 变成MyPage.html.gz。使用正确的设置，如果有人请求[http://example.com/MyPage.html](http://example.com/MyPage.html)，而 Apache 看到 MyPage.html.gz，并且客户端支持压缩，它将改为提供 MyPage.html.gz 版本。然后客户端将透明地解压缩内容，用户甚至不会知道或关心它是否被压缩（除了页面加载速度快了几分之一秒可能会稍微高兴一点）

# java - ResultSet 是将所有数据加载到内存中还是仅在请求时加载？

> ID：858836
> 
> 赞同：44
> 
> 时间：2009-05-13T16:04:24.143
> 
> 标签：java, database, jdbc

我有一个 .jsp 页面，其中有一个显示 Oracle 数据库记录的 GUI 表。该表允许典型的分页行为，例如“FIRST”、“NEXT”、“PREVIOUS”和“LAST”。记录是从执行 SQL 语句返回的 Java ResultSet 对象中获取的。

这个 ResultSet 可能非常大，所以我的问题是：

如果我有一个包含一百万条记录的 ResultSet，但我的表仅显示 ResultSet 中前十条记录的数据，是仅在我开始请求记录数据时才获取数据，还是在 ResultSet 后将所有数据完全加载到内存中从执行 SQL 语句返回？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-05-13T16:09:34.260

Java ResultSet 是指向数据库中结果的指针（或游标）。ResultSet 从数据库中加载块中的记录。因此，为了回答您的问题，数据仅在您请求时才以块的形式获取。

如果您需要控制驱动程序一次获取多少行，您可以使用 ResultSet 上的[setFetchSize(int rows)](https://docs.oracle.com/javase/10/docs/api/java/sql/ResultSet.html#setFetchSize(int))方法。这将允许您控制一次检索的块的大小。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-05-13T16:39:14.087

JDBC 规范没有指定数据是流式传输还是加载到内存中。默认情况下，Oracle 流。MySQL 没有。要让 MySQL 流式传输结果集，您需要在 Statement 上设置以下内容：

```
 pstmt = conn.prepareStatement(
        sql,
        ResultSet.TYPE_FORWARD_ONLY,
        ResultSet.CONCUR_READ_ONLY);
    pstmt.setFetchSize(Integer.MIN_VALUE); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T16:30:15.333

虽然 JDBC 规范没有指定是否要获取结果集中的所有数据，但任何编写良好的驱动程序都不会这样做。

也就是说，可滚动的结果集可能更符合您的想法：（链接已编辑，它指向间谍软件页面）

您还可以考虑存储在会话中的断开连接的行集（取决于您的站点需要的可扩展性）：http: [//java.sun.com/j2se/1.4.2/docs/api/javax/sql/行集.html](http://java.sun.com/j2se/1.4.2/docs/api/javax/sql/RowSet.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T17:55:18.720

最好的想法是进行子查询并一次/在单页中显示 100 或 1000 行。并通过连接池管理连接。

要进行子查询，您可以在 oracle 中使用 Row count 并在 MY SQL 中使用 Limit。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-07-26T15:26:46.567

假设我们有一个包含 500 条记录的表

```
PreparedStatement stm=con.prepareStatement("select * from table");
stm.setFetchSize(100);// now each 100 records are loaded together from the database into the memory,
// and since we have 500 5 server round trips will occur.
ResultSet rs = stm.executeQuery();
rs.setFetchSize (50);//overrides the fetch size provided in the statements,
//and the next trip to the database will fetch the records based on the new fetch size 
```

# c# - TreeViewItem 上的上下文菜单调用 TreeViewItem 的方法？

> ID：858843
> 
> 赞同：0
> 
> 时间：2009-05-13T16:05:39.680
> 
> 标签：c#, wpf, treeview, contextmenu, treeviewitem

我有一个`TreeView`设置，以便每个`TreeViewItem`都将右键单击上下文菜单应用为`Style`. 就像是：

```
<Grid.Resources>
    <ContextMenu x:Key="contextMenu">
         <MenuItem Header="Save"  IsEnabled="{Binding Path=Saveable}"/>
         <MenuItem Header="Copy" IsEnabled="{Binding Path=Copyable}"/>
         <MenuItem Header="Remove" IsEnabled="{Binding Path=Removeable}"/>
    </ContextMenu>
    <Style TargetType="TreeViewItem">
        <Setter Property="ContextMenu" Value="{StaticResource contextMenu}" />
    </Style>
</Grid.Resources> 
```

Saveable、Copyable 和 Removeable 是来自用作`TreeViewItem`.

我正在寻找的是当用户点击 a 时`MenuItem`，它会点击所选对象的适当方法。因此，单击“保存”`MenuItem`会调用`object.Save()`、“复制”调用`object.Copy()`等。但我不确定语法会是什么样子，或者这个想法在典型的 WPF 样式方面是否实际上是可以接受的。我知道我可以在包含的窗口中创建一个新的事件处理程序，但我更喜欢所选项目本身来处理事件。

想法？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T16:17:00.690

不幸的是，我认为没有一种自动化的方法可以做到这一点。最接近的选项是`RoutedUICommand`为 中的每个项目设置一个`ContextMenu`，然后`CommandBinding`为您的班级中的每个项目创建一个。如果你想让那些去`TreeViewItem`，你可能需要子类`TreeViewItem`化并在`CommandBindings`那里设置。

我认为可能可行的一个选项是在样式中添加一个`EventSetter`for 。但是，这不起作用 - 可能是因为 中的项目与.`MenuItem.Click``TreeViewItem``ContextMenu``TreeViewItems`

# asp.net - ASP.Net页面方法执行时间监控

> ID：858847
> 
> 赞同：2
> 
> 时间：2009-05-13T16:06:14.687
> 
> 标签：asp.net, time, methods, execution

有人可以建议我，有什么方法可以计算 asp.net 页面中的方法执行时间吗？

ASP.Net Trace 不适合我，因为它忽略了 ajax 部分回发，尽管它们只是紧凑的地方。

我的页面事件由于某种未知原因执行缓慢。由于逻辑和事件执行链相当复杂，我仍然无法仅在调试器中确定罪魁祸首。

我想测量整个页面中每个方法的执行时间，但我仍然没有办法，只能在开头插入多余的代码行（如 timeBegin = DateTime.Now.... timeEnd=DateTime.Now = timeBegin 等）和每种方法的结束。这似乎是一种丑陋的方法，有人知道如何自动做到这一点吗？是否有工具可以测量可用的方法执行时间？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2013-05-15T10:24:40.850

我不是 100% 确定以下在所有情况下都有效。到目前为止，它确实如此。请注意**Context.Session.Item("CURRENT_WEB_USER")**是我存储当前用户的位置，因此不能作为 asp.net 会话变量的一部分随时使用。

下面的代码替换了**Global.aspx**，它允许整页计时和开发人员代码计时。

```
Sub Application_Start(ByVal sender As Object, ByVal e As EventArgs)
End Sub

Sub Application_End(ByVal sender As Object, ByVal e As EventArgs)
End Sub

Sub Application_Error(ByVal sender As Object, ByVal e As EventArgs)
End Sub

Sub Session_Start(ByVal sender As Object, ByVal e As EventArgs)
End Sub

Sub Session_End(ByVal sender As Object, ByVal e As EventArgs)
End Sub

Sub Application_AcquireRequestState(sender As Object, e As System.EventArgs)
    If HttpContext.Current Is Nothing Then Return
    If HttpContext.Current.Session Is Nothing Then Return
    If TypeOf HttpContext.Current.CurrentHandler Is Page Then
        If Not Context.Items.Contains("Request_Start_Time") Then
            Dim MyPage As Page = HttpContext.Current.CurrentHandler
            AddHandler MyPage.Init, AddressOf PageInitEncountered
            AddHandler MyPage.Unload, AddressOf PageUnloadEncountered
            Context.Items.Add("Request_Start_Time", DateTime.Now)
            Dim User As String = Context.Session.Item("CURRENT_WEB_USER")
            Context.Items.Add("Request_User", User )
        End If
    End If

End Sub

Sub Application_ReleaseRequestState(sender As Object, e As System.EventArgs) 
    If HttpContext.Current Is Nothing Then Return
    If TypeOf Context.CurrentHandler Is Page Then
        Dim Page As Page = Context.CurrentHandler
        Dim StartDate As Date = Context.Items("Request_Start_Time") : If StartDate = Nothing Then Return
        Dim EndDate As Date = Now
        Dim StartProc As Date = Context.Items("Page_Init")
        Dim EndProc As Date = Context.Items("Page_Unload")
        Dim User As String = Context.Items("Request_User")
        LogEntry(StartDate, EndDate, StartProc, EndProc, User, Context.Request.Url.ToString)
    End If

End Sub

Public Sub PageInitEncountered(sender As Object, e As System.EventArgs)
    Context.Items.Add("Page_Init", DateTime.Now)
End Sub

Public Sub PageUnloadEncountered(sender As Object, e As System.EventArgs)
    Context.Items.Add("Page_Unload", DateTime.Now)
End Sub

Public Sub LogEntry(StartDate As Date, EndDate As Date, StartProc As Date, EndProc As Date, User As String, PageURL As String)
    System.Diagnostics.Debug.WriteLine(" (" & LogEntry.RequestMs & " - " & LogEntry.DurationMs & ") (" & User & ") " & PageURL)
End Sub 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T19:39:19.720

您还可以使用 asp.net 性能计数器和其他东西。但这不会衡量页面速度，但它们会衡量所有应用程序的性能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T16:25:55.997

这可能不是您正在寻找的，但[RedGate](http://www.red-gate.com/products/ants_profiler/index.htm)有一个名为 Performance Profiler 的产品可以做到这一点。他们确实有 15 天的试用期，因此您甚至可以下载它并在您当前的问题上试用。恕我直言，值得每一分钱。

# c# - 用于查找和替换 xml 中的字符串的正则表达式

> ID：858848
> 
> 赞同：0
> 
> 时间：2009-05-13T16:06:24.017
> 
> 标签：c#, regex, string

我正在寻找一个可以匹配 xml 文件中三种特定情况的字符串的正则表达式：

1.  : 围绕字符串的双引号。

2.  **：由大于**和**小于**字符包围的字符串。

3.  : 被字符包围的字符串**；**和**&**。

例子：

*   **"MyString"** - 有效匹配
*   **>MyString<** - 有效匹配
*   **;MyString&** - 有效匹配

其他可能的组合是无效匹配。

*   **"MyString<** - 无效匹配*   **;MyString"** - 无效匹配

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-13T16:10:58.517

试试这个：`("MyString")|(>MyString<)|(;MyString&)`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T16:13:27.110

**您不能使用正则表达式来解析 xml，它不是常规语法。认真地使用 xml 解析器。**

当您使用解析器检查文本节点值时*，只有那时*您可能想要使用`(\".*?\")|(>.*?<)|(;.*?&)`，但我怀疑您会发现问题的框架方式相同。>MyString<*非常*可疑。

# jquery - 当表单返回错误时，在 Rails 中重新填充选择选项时出现问题

> ID：858852
> 
> 赞同：1
> 
> 时间：2009-05-13T16:07:17.587
> 
> 标签：jquery, ruby-on-rails, jquery-plugins, html-select

我有一个表格，里面有 2 个选择选项——频率和持续时间。当表单出现错误并将其返回给浏览器时，即使这些字段的返回值与选择中的选项值匹配，也不会使用用户所做的选择重新填充选择选项。此外，当返回表单时，即使它们的值为空白，这些字段也不会被标记为有错误。

这是 Rails 中的频率和持续时间字段

```
<%= frequency_select c, :frequency %>
<%= duration_select c, :duration %> 
```

频率选择的方法是

```
def frequency_select(f, method)
    options = [["day", 1.day], ["other day", 2.days], ["week", 1.week]]
    f.select method, options, :include_blank => true
end 
```

而 duration_select 的方法是

```
def duration_select(f, method, unit="day" )
    values, units = *case unit
        when "day" : [[[5, 5], [15, 15], [30, 29]], "days"]
        when "other day" : [[[15, 15], [30, 29], [45,45]], "days"]
        when "week" : [[[4, 29], [6, 43], [8, 57]], "weeks"]
    end
    f.select method, values.map {|(label, i)| ["#{label} #{units}", i.days]}, :include_blank => true
end 
```

如果您在这些字段中的一个或两个字段中输入值并提交表单而未完成部分（其中的任何部分），则表单将返回给用户（如预期的那样），但持续时间和频率字段不会重新填充用户的选择。

如果我将这段代码添加到表单中

```
<p><%= @challenge.attributes.inspect %></p> 
```

当表单返回到浏览器时，我看到了持续时间和频率：

```
"duration"=>3888000, "frequency"=>172800 
```

这些值与选择字段中的选项值匹配。

Rails 中是否有什么特别需要做的事情，以便用用户的选择重新填充选择字段？关于问题可能是什么或我接下来应该尝试什么的任何想法？

非常感谢您的帮助！

-瑞克

PS如果您查看其他一些问题，您会注意到我过去曾问过这个问题。有一次，我认为表单以天而不是秒为单位返回频率和持续时间的值，但事实并非如此。

PPS 这里还有一点可能很重要的信息，但我的测试表明它可能并不重要。（虽然，我对此有点新手，所以不要相信我的话。）

这两个字段使用 cascade jquery 插件链接在一起。

javascript 包含在页面中（不是在单独的文件中），并且一些 js 是由 Rails 创建的。

首先，这里是出现在浏览器中的脚本。第一个是为持续时间选择生成选项的脚本，第二个是 Cascade 插件触发字段链接所需的脚本。

```
<script type="text/javascript">
    var list1 = [
        {'When':'86400','Value':' ','Text':' '},
        {'When':'172800','Value':' ','Text':' '},
        {'When':'604800','Value':' ','Text':' '},
        {'When':'86400','Value':'432000','Text':'5 days'},
        {'When':'86400','Value':'1296000','Text':'15 days'},
        {'When':'86400','Value':'2505600','Text':'30 days'},
        {'When':'172800','Value':'1296000','Text':'15 days'},
        {'When':'172800','Value':'2505600','Text':'30 days'},
        {'When':'172800','Value':'3888000','Text':'45 days'},
        {'When':'604800','Value':'2505600','Text':'4 weeks'},
        {'When':'604800','Value':'3715200','Text':'6 weeks'},
        {'When':'604800','Value':'4924800','Text':'8 weeks'}
    ];

    function commonTemplate(item) {
        return "<option value='" + item.Value + "'>" + item.Text + "</option>"; 
};

function commonMatch(selectedValue) {
        return this.When == selectedValue; 
};
</script>

<script type="text/javascript">
    jQuery(document).ready(function(){
        jQuery("#challenge_duration, #user_challenge_duration").cascade("#challenge_frequency, #user_challenge_frequency",{
            list: list1,            
            template: commonTemplate,
            match: commonMatch          
        })
    });
</script> 
```

这是 erb 文件中的第一个脚本的一些内容——您会看到其中一些脚本是由 Rails 生成的

```
<%= 
    [ [1.day, [[5, 5], [15,15], [30, 29]], "days"],
    [2.days, [[15, 15], [30, 29], [45, 45]], "days"],
    [1.week, [[4, 29], [6, 43], [8, 57]], "weeks"]].map do |(frequency, durations, unit)|

    durations.map do |(label, value)| 
        "{'When':'#{frequency}','Value':'#{value.days}','Text':'#{label} #{unit}'}"
    end 
    end.join(",\n")
-%> 
```

现在，我认为是否使用 JS 生成持续时间并不重要的原因是

1.  如果我删除所有 JS，问题仍然存在
2.  该问题还影响频率场，其选项不是由 JS 生成的

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-15T09:47:17.140

让我们先测试 frequency_select 更改视图代码如下，

```
<%= frequency_select @challenge, :frequency %> 
```

将频率选择的辅助方法更改为，

```
def frequency_select(objct, method)
    options = [["day", 1.day], ["other day", 2.days], ["week", 1.week]]
    select objct, method, options, :include_blank => true
end 
```

# visual-studio - notepad++ 中的 Visual Studio 堆栈跟踪

> ID：858856
> 
> 赞同：4
> 
> 时间：2009-05-13T16:08:16.227
> 
> 标签：visual-studio, notepad++

这可能只是我没有看到的一个设置，但是当我从 Visual Studio 的异常帮助器对话框中获得堆栈跟踪时，它在调用堆栈中的每个“行”之后都有 \r\n 。当我将其复制并粘贴到 Notepad++ 中时，它会以字面形式显示为 \r\n，在文档中可见。当然我希望这些被解释为 CR LF，所以一切都在不同的路线上。

有人知道怎么做吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2018-10-16T14:36:10.073

我知道这个问题很老，但也许有人会发现这个解决方案很有帮助。

打开`find and replace`，然后转到替换选项卡

在查找框中输入`\\r\\n`

在替换框中输入`\r\n`（均不带引号）

确保`Extended search mode`在左下角被选中。

最后，点击全部替换。

![我的窗口截图](https://i.stack.imgur.com/STzzD.png).

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2021-02-03T19:04:48.860

第一次找到设置花了我一段时间。它的视图>>显示符号>>显示所有字符。[![在此处输入图像描述](https://i.stack.imgur.com/m3dPq.png)](https://i.stack.imgur.com/m3dPq.png)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-06T22:02:20.593

这听起来像一个 Notepad++ 错误。我可以粘贴到常规记事本和 UltraEdit 中，而不会出现您描述的副作用。

就像 Cerebrus 所说，您可以通过使用其搜索/替换工具在 Notepad++ 端解决它。

# javascript - 用vs 2008调试？

> ID：858876
> 
> 赞同：0
> 
> 时间：2009-05-13T16:11:35.350
> 
> 标签：javascript, visual-studio-2008, debugging

目前设置vs 2008并一直在使用eclipse进行“PURE”javascript调试......所以我想尝试一下vs 2008并调试“PURE”javascript......我有vs2008 sp1并且我没有选中“禁用ie客户端脚本”在 IE8...

我现在设置断点（在 .js 文件中）并附加进程。并标记 Internet Explorer ......但问题是......它说它永远不会被击中......

无论如何我测试了它..我在浏览器中加载了我的 html 我知道调用我的 js 文件.. 但什么也没发生，我错过了什么吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T16:18:31.530

确保从默认的托管代码更改附加到脚本。这让我好几次。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T16:24:14.157

写

```
debugger; 
```

进入您要开始调试的脚本。并运行您的应用程序。当脚本到达时，它会停止并询问您是否要调试。然后在列表中选择 VS.NET 2008。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T16:28:12.623

查看 Visual Studio 2008 中的脚本资源管理器。当您按 F5 时，您的应用程序 VS 将在脚本资源管理器中列出页面内的所有脚本。运行后，您可以在 js 代码上设置断点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-20T13:03:42.343

在 ie8 中，您现在在 ie 开发工具栏中集成了一个强大的 javascript 调试器。

# c# - 在 Visual Studio 中查找引用

> ID：858877
> 
> 赞同：2
> 
> 时间：2009-05-13T16:11:40.310
> 
> 标签：c#, visual-studio, reference

我第一次将 Visual Studio 和 COM 与 C# 一起使用，我对“引用”有些不太了解。你怎么知道给定的'using something.something'参考什么？.Net 引用看起来相当简单，但 COM 不那么明显。我正在运行 Visual Studio 2005 并安装了最新的 VSTO，但对于我的生活，我无法弄清楚我需要参考什么来满足：

使用 Microsoft.VisualStudio.Tools.Applications.Runtime；

.Net 选项卡中有一些 Microsoft.VisualStudio 的东西，但没有一个是 .Tools 或类似的东西。我觉得我在这里错过了一个关键概念。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T16:23:09.650

这里有两个问题——

首先，引用不一定对应命名空间。单个引用可以包含多个命名空间，并且单个命名空间可以由需要引用的多个程序集共享。需要包含引用允许您使用特定类型，而不是整个命名空间。

其次，这是你需要提前知道的。如果您正在使用 Microsoft 的类，例如您列出的命名空间中的类，MSDN 可以提供很大的帮助。

例如，以[Microsoft.VisualStudio.Tools.Applications.Runtime.ServerDocument](http://msdn.microsoft.com/en-us/library/microsoft.visualstudio.tools.applications.runtime.serverdocument(VS.80).aspx)

如果您查看该类（在该命名空间中）的 MSDN 页面，在顶部附近它包括：

> 命名空间：Microsoft.VisualStudio.Tools.Applications.Runtime
> 
> 程序集：Microsoft.VisualStudio.Tools.Applications.Runtime（在 microsoft.visualstudio.tools.applications.runtime.dll 中）

这特别告诉您需要哪个组件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T16:23:59.197

该参考是 Visual Studio SDK 的一部分。我目前使用的是 VS 2008，但是 VS 2005 的程序集应该是相同的。SDK 的链接在[这里](http://www.microsoft.com/downloads/details.aspx?FamilyID=51a5c65b-c020-4e08-8ac0-3eb9c06996f4&DisplayLang=en)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T17:10:53.880

走另一条路很容易。如果您获得了一个引用，您可以在对象浏览器中打开该引用以查看它包含哪些名称空间，并据此确定要添加的 usings。确定给定 using 引用的内容并非易事，因为不能保证每个命名空间都存在一个 DLL。你是怎么到达的

```
using Microsoft.VisualStudio.Tools.Applications.Runtime; 
```

不知道参考什么？如果它是某处的代码示例，他们应该提及项目的外部引用和依赖项是什么。

# c# - 在 .NET 中更新 MsAccess 表的最佳方法是什么

> ID：858879
> 
> 赞同：0
> 
> 时间：2009-05-13T16:12:16.720
> 
> 标签：c#, ms-access, dataset

当需要更新 MSAccess 表中的多个字段时（例如 Salary=Salary*Factor、SomeNumber=GetMyBusinessRuleOn(SomeNumber) 等），并且更新会影响表中的每条记录，您会使用哪种技术？

我刚刚开始用 DataSets 实现这个，但是卡住了（[更新和持久化数据集问题](https://stackoverflow.com/questions/858798/updating-and-persisting-dataset-problem)）

但也许这甚至不是处理这种批量更新的理想方式？

注意：更新不必首先在断开连接的数据上进行，因此不需要数据集。

更新 ：

*   一个命令不行，我需要某种记录集或游标来循环浏览记录

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T16:15:03.267

我只会使用 ODBCConnection/ [ODBCCommand](http://msdn.microsoft.com/en-us/library/system.data.odbc.odbccommand.aspx)并使用 SQL 更新查询。

有一个 JET 数据库驱动程序，您应该能够使用它来使用 ODBCConeection 对象建立与 MSAccess 数据库的数据库连接。

```
string connectionString = "Provider=Microsoft.Jet.OLEDB.4.0; Data Source=c:\\PathTo\\Your_Database_Name.mdb; User Id=admin; Password=";

using (OdbcConnection connection = 
           new OdbcConnection(connectionString))
{
    // Suppose you wanted to update the Salary column in a table
    // called Employees
    string sqlQuery = "UPDATE Employees SET Salary = Salary * Factor";

    OdbcCommand command = new OdbcCommand(sqlQuery, connection);

    try
    {
        connection.Open();
        command.ExecuteNonQuery();
    }
    catch (Exception ex)
    {
        Console.WriteLine(ex.Message);
    }
    // The connection is automatically closed when the
    // code exits the using block.
} 
```

您可以使用这些网站来帮助您生成连接字符串：

*   [http://www.connectionstrings.com/](http://www.connectionstrings.com/)
*   [http://www.sqlstrings.com/](http://www.sqlstrings.com/)

**编辑 - 使用数据阅读器循环浏览记录以应用业务规则的示例**

我应该注意到以下示例可以在某些方面进行改进（特别是如果数据库驱动程序支持参数化查询）。我只想举一个相对简单的例子来说明这个概念。

```
using (OdbcConnection connection = 
           new OdbcConnection(connectionString))
{
    int someNumber;
    int employeeID;
    OdbcDataReader dr = null;
    OdbcCommand selCmd = new OdbcCommand("SELECT EmployeeID, SomeNumber FROM Employees", connection);

    OdbcCommand updateCmd = new OdbcCommand("", connection);

    try
    {
        connection.Open();
        dr = selCmd.ExecuteReader();
        while(dr.Read())
        {
            employeeID = (int)dr[0];
            someNumber = (int)dr[1];
            updateCmd.CommandText = "UPDATE Employees SET SomeNumber= " + GetBusinessRule(someNumber) + " WHERE employeeID = " + employeeID;

            updateCmd.ExecuteNonQuery();
        }
    }
    catch (Exception ex)
    {
        Console.WriteLine(ex.Message);
    }
    finally
    {
       // Don't forget to close the reader when we're done
       if(dr != null)
          dr.Close();
    }
    // The connection is automatically closed when the
    // code exits the using block.
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T16:15:12.987

听起来你只需要一个更新声明：

[http://msdn.microsoft.com/en-us/library/bb221186.aspx](http://msdn.microsoft.com/en-us/library/bb221186.aspx)

您可以为此使用[OleDb 提供程序](http://msdn.microsoft.com/en-us/library/system.data.oledb(VS.71).aspx)。

# c# - C# - 当用户点击箭头键时，上下文菜单条具有滚动行为

> ID：858882
> 
> 赞同：4
> 
> 时间：2009-05-13T16:12:37.813
> 
> 标签：c#, contextmenustrip

我有一个包含 8 个项目和两个分隔符的上下文菜单条。当用户打开上下文菜单条，然后按箭头键滚动项目时，按第八个项目会使菜单“向上滚动”，在底部留下空白区域。有什么办法可以防止这种行为？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-21T22:10:36.680

我找到了。事实证明，如果您在菜单中有不可见的项目，它会与间距拧紧。修复是更改逻辑以实际删除/添加项目或重建菜单，而不是切换菜单项的可见性。这是切换“可见”有一些奇怪行为的一种情况。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T16:45:56.290

我将其发布为答案，因为我想在帖子中添加图像。我看到了同样的行为，我认为这是下拉上下文菜单本身的缺陷。

这是正在发生的事情：

[![前](https://i.stack.imgur.com/oTorO.png)](https://i.stack.imgur.com/oTorO.png)
[（来源：[googlepages.com](http://jongallant.googlepages.com/before.png)）][（来源：][[googlepages.com](http://jongallant.googlepages.com/after.png)][）]
[![后](https://i.stack.imgur.com/a5SeS.png)](https://i.stack.imgur.com/a5SeS.png)

它仅在用户使用键盘进入上下文菜单时发生。就好像它正在尝试进行某种滚动，因为如果您继续向下滚动列表，则选择会在顶部重置。

# php - 异步运行 PHP 任务

> ID：858883
> 
> 赞同：155
> 
> 时间：2009-05-13T16:12:47.343
> 
> 标签：php, asynchronous, background, queue, task

我在一个有点大的 Web 应用程序上工作，后端主要是 PHP。代码中有几个地方我需要完成一些任务，但我不想让用户等待结果。例如，在创建新帐户时，我需要向他们发送一封欢迎电子邮件。但是当他们点击“完成注册”按钮时，我不想让他们等到电子邮件实际发送，我只想开始这个过程，并立即向用户返回一条消息。

到目前为止，在某些地方，我一直在使用 exec() 的感觉。基本上做这样的事情：

```
exec("doTask.php $arg1 $arg2 $arg3 >/dev/null 2>&1 &"); 
```

这似乎有效，但我想知道是否有更好的方法。我正在考虑编写一个在 MySQL 表中对任务进行排队的系统，以及一个单独的长时间运行的 PHP 脚本，该脚本每秒查询一次该表，并执行它找到的任何新任务。如果我需要的话，这还有一个好处，就是让我将来可以在几台工作机器之间分配任务。

我在重新发明轮子吗？有比 exec() hack 或 MySQL 队列更好的解决方案吗？

* * *

## 回答 #1

> 赞同：85
> 
> 时间：2009-05-13T16:20:03.010

我使用了排队方法，它工作得很好，因为您可以推迟处理直到您的服务器负载空闲，如果您可以轻松地划分“不紧急的任务”，那么您可以非常有效地管理您的负载。

自己动手并不太难，这里有一些其他的选择：

*   [GearMan](http://gearman.org/) - 这个答案写于 2009 年，从那时起 GearMan 看起来很受欢迎，请参阅下面的评论。
*   如果您想要一个完整的开源消息队列，请使用[ActiveMQ 。](http://activemq.apache.org/)
*   [ZeroMQ](http://www.zeromq.org/) - 这是一个非常酷的套接字库，它可以轻松编写分布式代码，而不必过多担心套接字编程本身。您可以将它用于单个主机上的消息队列——您只需让您的 web 应用程序将某些内容推送到一个队列中，持续运行的控制台应用程序将在下一个合适的机会使用该队列
*   [beanstalkd](http://xph.us/software/beanstalkd/) - 在写这个答案时才发现这个，但看起来很有趣
*   [dropr](https://github.com/s0enke/dropr/wiki/)是一个基于 PHP 的消息队列项目，但自 2010 年 9 月以来一直没有得到积极维护
*   [php-enqueue](https://github.com/php-enqueue/enqueue-dev)是最近（2017 年）维护的围绕各种队列系统的包装器
*   最后，一篇关于使用[memcached 进行消息队列的博文](http://broddlit.wordpress.com/2008/04/09/memcached-as-simple-message-queue/)

另一种可能更简单的方法是使用[ignore_user_abort](http://php.net/ignore_user_abort) - 一旦您将页面发送给用户，您就可以进行最终处理而不必担心提前终止，尽管这确实具有延长用户页面加载时间的效果看法。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2011-04-14T16:02:08.543

当您只想执行一个或多个 HTTP 请求而无需等待响应时，也有一个简单的 PHP 解决方案。

在调用脚本中：

```
$socketcon = fsockopen($host, 80, $errno, $errstr, 10);
if($socketcon) {   
   $socketdata = "GET $remote_house/script.php?parameters=... HTTP 1.1\r\nHost: $host\r\nConnection: Close\r\n\r\n";      
   fwrite($socketcon, $socketdata); 
   fclose($socketcon);
}
// repeat this with different parameters as often as you like 
```

在被调用的 script.php 中，您可以在第一行调用这些 PHP 函数：

```
ignore_user_abort(true);
set_time_limit(0); 
```

这会导致脚本在 HTTP 连接关闭时继续运行而没有时间限制。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-05-13T23:31:59.640

派生进程的另一种方法是通过 curl。您可以将内部任务设置为 Web 服务。例如：

*   [http://domain/tasks/t1](http://domain/tasks/t1)
*   [http://domain/tasks/t2](http://domain/tasks/t2)

然后在您的用户访问的脚本中调用该服务：

```
$service->addTask('t1', $data); // post data to URL via curl 
```

您的服务可以使用 mysql 或任何您喜欢的方式跟踪任务队列：它全部包含在服务中，您的脚本只是使用 URL。如果需要（即易于扩展），这可以让您腾出时间将服务移动到另一台机器/服务器。

添加 http 授权或自定义授权方案（如 Amazon 的 Web 服务）可以让您打开任务以供其他人/服务使用（如果您愿意），您可以更进一步并在顶部添加监控服务以跟踪队列和任务状态。

*   [http://domain/queue?task=t1](http://domain/queue?task=t1)
*   [http://domain/queue?task=t2](http://domain/queue?task=t2)
*   [http://domain/queue/t1/100931](http://domain/queue/t1/100931)

它确实需要一些设置工作，但有很多好处。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2016-01-21T10:31:22.003

如果只是提供昂贵任务的问题，如果支持 php-fpm，为什么不使用[`fastcgi_finish_request()`](http://php.net/manual/en/function.fastcgi-finish-request.php)函数呢？

> 此函数将所有响应数据刷新到客户端并完成请求。这允许在不打开与客户端的连接的情况下执行耗时的任务。

您实际上并没有以这种方式使用异步性：

1.  首先制作所有主要代码。
2.  执行`fastcgi_finish_request()`。
3.  做所有重的东西。

再次需要 php-fpm。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-05-18T10:16:22.263

我已经将[Beanstalkd](http://xph.us/software/beanstalkd/)用于一个项目，并计划再次使用。我发现它是运行异步进程的绝佳方式。

我用它做的几件事是：

*   图像调整大小 - 并且将轻负载队列传递给基于 CLI 的 PHP 脚本，调整大 (2mb+) 图像的大小工作得很好，但尝试在 mod_php 实例中调整相同图像的大小经常遇到内存空间问题（我将 PHP 进程限制为 32MB，而调整大小的时间不止这些）
*   近期检查 - beanstalkd 有可用的延迟（使此作业只能在 X 秒后运行） - 所以我可以在稍后的时间对事件进行 5 或 10 次检查

我编写了一个基于 Zend-Framework 的系统来解码一个“不错”的 url，例如，调整它会调用的图像大小`QueueTask('/image/resize/filename/example.jpg')`。URL 首先被解码为一个数组（模块、控制器、动作、参数），然后转换为 JSON 以注入队列本身。

然后，一个长时间运行的 cli 脚本从队列中提取作业，运行它（通过 Zend_Router_Simple），如果需要，将信息放入 memcached 中，以便网站 PHP 在完成后根据需要获取。

我还提出的一个问题是 cli 脚本在重新启动之前只运行了 50 个循环，但如果它确实想按计划重新启动，它会立即这样做（通过 bash 脚本运行）。如果有问题并且我做了（ or`exit(0)`的默认值），它会先暂停几秒钟。`exit;``die();`

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-05-13T20:44:08.617

这是我为我的 Web 应用程序编写的一个简单类。它允许分叉 PHP 脚本和其他脚本。适用于 UNIX 和 Windows。

```
class BackgroundProcess {
    static function open($exec, $cwd = null) {
        if (!is_string($cwd)) {
            $cwd = @getcwd();
        }

        @chdir($cwd);

        if (strtoupper(substr(PHP_OS, 0, 3)) == 'WIN') {
            $WshShell = new COM("WScript.Shell");
            $WshShell->CurrentDirectory = str_replace('/', '\\', $cwd);
            $WshShell->Run($exec, 0, false);
        } else {
            exec($exec . " > /dev/null 2>&1 &");
        }
    }

    static function fork($phpScript, $phpExec = null) {
        $cwd = dirname($phpScript);

        @putenv("PHP_FORCECLI=true");

        if (!is_string($phpExec) || !file_exists($phpExec)) {
            if (strtoupper(substr(PHP_OS, 0, 3)) == 'WIN') {
                $phpExec = str_replace('/', '\\', dirname(ini_get('extension_dir'))) . '\php.exe';

                if (@file_exists($phpExec)) {
                    BackgroundProcess::open(escapeshellarg($phpExec) . " " . escapeshellarg($phpScript), $cwd);
                }
            } else {
                $phpExec = exec("which php-cli");

                if ($phpExec[0] != '/') {
                    $phpExec = exec("which php");
                }

                if ($phpExec[0] == '/') {
                    BackgroundProcess::open(escapeshellarg($phpExec) . " " . escapeshellarg($phpScript), $cwd);
                }
            }
        } else {
            if (strtoupper(substr(PHP_OS, 0, 3)) == 'WIN') {
                $phpExec = str_replace('/', '\\', $phpExec);
            }

            BackgroundProcess::open(escapeshellarg($phpExec) . " " . escapeshellarg($phpScript), $cwd);
        }
    }
} 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2015-02-25T11:54:18.413

PHP**有多**线程，只是默认情况下没有启用，有一个名为**pthreads**的扩展可以做到这一点。不过，您需要使用 ZTS 编译的 php。（线程安全）链接：

[例子](https://github.com/krakjoe/pthreads/tree/master/examples)

[另一个教程](http://www.mullie.eu/parallel-processing-multi-tasking-php/)

[pthreads PECL 扩展](http://pecl.php.net/package/pthreads)

更新：因为 PHP 7.2 并行扩展开始发挥作用

> > [教程/示例](https://farizfadian.blogspot.com/2020/07/php-parallel-multithreading-example.html)

> > [参考手册](https://www.php.net/manual/en/book.parallel.php)

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-05-13T16:40:00.013

这是我几年来一直使用的相同方法，但我没有看到或发现更好的方法。正如人们所说，PHP 是单线程的，因此您无能为力。

实际上，我为此添加了一个额外的级别，即获取和存储进程 ID。这允许我重定向到另一个页面并让用户坐在该页面上，使用 AJAX 检查进程是否完成（进程 ID 不再存在）。这对于脚本长度会导致浏览器超时的情况很有用，但用户需要等待该脚本完成才能进行下一步。（在我的例子中，它正在处理带有类似 CSV 文件的大型 ZIP 文件，这些文件最多可向数据库添加 30 000 条记录，之后用户需要确认一些信息。）

我也使用了类似的过程来生成报告。我不确定我是否会对诸如电子邮件之类的东西使用“后台处理”，除非 SMTP 速度慢确实存在问题。相反，我可能会使用一个表作为队列，然后有一个每分钟运行一次的进程来发送队列中的电子邮件。您需要警惕两次发送电子邮件或其他类似问题。对于其他任务，我也会考虑类似的排队过程。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-05-29T07:07:27.913

按照 rojoca 的建议使用 cURL 是个好主意。

这是一个例子。您可以在脚本在后台运行时监控 text.txt：

```
<?php

function doCurl($begin)
{
    echo "Do curl<br />\n";
    $url = 'http://'.$_SERVER['SERVER_NAME'].$_SERVER['REQUEST_URI'];
    $url = preg_replace('/\?.*/', '', $url);
    $url .= '?begin='.$begin;
    echo 'URL: '.$url.'<br>';
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    $result = curl_exec($ch);
    echo 'Result: '.$result.'<br>';
    curl_close($ch);
}

if (empty($_GET['begin'])) {
    doCurl(1);
}
else {
    while (ob_get_level())
        ob_end_clean();
    header('Connection: close');
    ignore_user_abort();
    ob_start();
    echo 'Connection Closed';
    $size = ob_get_length();
    header("Content-Length: $size");
    ob_end_flush();
    flush();

    $begin = $_GET['begin'];
    $fp = fopen("text.txt", "w");
    fprintf($fp, "begin: %d\n", $begin);
    for ($i = 0; $i < 15; $i++) {
        sleep(1);
        fprintf($fp, "i: %d\n", $i);
    }
    fclose($fp);
    if ($begin < 10)
        doCurl($begin + 1);
}

?> 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2021-10-04T09:00:10.377

有一个名为[Swoole](https://www.swoole.co.uk/)的 PHP 扩展。

尽管它可能未启用，但在我的主机上可以通过单击按钮启用它。

值得一试。我还没有时间使用它，因为我在这里搜索信息，当我偶然发现它并认为它值得分享时。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-05-13T16:20:27.800

不幸的是，PHP 没有任何类型的本机线程功能。所以我认为在这种情况下你别无选择，只能使用某种自定义代码来做你想做的事。

如果你在网上搜索 PHP 线程的东西，有些人想出了在 PHP 上模拟线程的方法。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-08-05T23:09:43.857

如果您在“感谢您注册”响应中设置 Content-Length HTTP 标头，则浏览器应在收到指定字节数后关闭连接。这会使服务器端进程运行（假设设置了 ignore_user_abort），因此它可以在不让最终用户等待的情况下完成工作。

当然，您需要在渲染标头之前计算响应内容的大小，但这对于短响应（将输出写入字符串、调用 strlen()、调用 header()、渲染字符串）非常容易。

这种方法的优点是*不*强制您管理“前端”队列，尽管您可能需要在后端做一些工作以防止竞争 HTTP 子进程相互踩踏，但这是您已经需要做的事情， 反正。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2015-02-24T01:31:35.833

如果您不想要完整的 ActiveMQ，我建议考虑[RabbitMQ](http://www.rabbitmq.com/)。RabbitMQ 是使用[AMQP 标准](http://www.amqp.org/)的轻量级消息传递。

我建议还研究一下[php-amqplib](https://github.com/videlalvaro/php-amqplib) - 一个流行的 AMQP 客户端库，用于访问基于 AMQP 的消息代理。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2016-12-19T15:18:25.220

我认为您应该尝试这种技术，它将有助于调用尽可能多的页面，所有页面将同时独立运行，而无需等待每个页面响应异步。

**cornjobpage.php //主页**

```
 <?php

post_async("http://localhost/projectname/testpage.php", "Keywordname=testValue");
//post_async("http://localhost/projectname/testpage.php", "Keywordname=testValue2");
//post_async("http://localhost/projectname/otherpage.php", "Keywordname=anyValue");
//call as many as pages you like all pages will run at once independently without waiting for each page response as asynchronous.
            ?>
            <?php

            /*
             * Executes a PHP page asynchronously so the current page does not have to wait for it to     finish running.
             *  
             */
            function post_async($url,$params)
            {

                $post_string = $params;

                $parts=parse_url($url);

                $fp = fsockopen($parts['host'],
                    isset($parts['port'])?$parts['port']:80,
                    $errno, $errstr, 30);

                $out = "GET ".$parts['path']."?$post_string"." HTTP/1.1\r\n";//you can use POST instead of GET if you like
                $out.= "Host: ".$parts['host']."\r\n";
                $out.= "Content-Type: application/x-www-form-urlencoded\r\n";
                $out.= "Content-Length: ".strlen($post_string)."\r\n";
                $out.= "Connection: Close\r\n\r\n";
                fwrite($fp, $out);
                fclose($fp);
            }
            ?> 
```

**测试页.php**

```
 <?
    echo $_REQUEST["Keywordname"];//case1 Output > testValue
    ?> 
```

PS：如果您想将 url 参数作为循环发送，请遵循以下答案：[https ://stackoverflow.com/a/41225209/6295712](https://stackoverflow.com/a/41225209/6295712)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-12-31T06:56:02.557

使用 curl在服务器上或直接在另一台服务器上生成新进程`exec()`根本不能很好地扩展，如果我们选择 exec，你基本上是在用长时间运行的进程填充你的服务器，这些进程可以由其他非面向 Web 的服务器处理，除非您构建某种负载平衡，否则使用 curl 会占用另一台服务器。

我在一些情况下使用过 Gearman，我发现它更适合这种用例。我可以使用单个作业队列服务器基本上处理所有需要由服务器完成的作业的排队并启动工作服务器，每个工作服务器都可以根据需要运行尽可能多的工作进程实例，并扩大数量根据需要工作服务器，并在不需要时将它们关闭。它还让我在需要时完全关闭工作进程并将作业排队，直到工作人员重新上线。

* * *

## 回答 #16

> 赞同：-5
> 
> 时间：2009-05-13T16:21:03.960

PHP 是一种单线程语言，因此除了使用`exec`or之外，没有其他官方方法可以使用它来启动异步进程`popen`。这里有一篇关于此的博客[文章](http://robert.accettura.com/blog/2006/09/14/asynchronous-processing-with-php/)。您对 MySQL 中的队列的想法也是一个好主意。

您在这里的具体要求是向用户发送电子邮件。我很好奇您为什么要尝试异步执行此操作，因为发送电子邮件是一项非常简单且快速的任务。我想如果您要发送大量电子邮件并且您的 ISP 因涉嫌垃圾邮件而阻止您，这可能是排队的一个原因，但除此之外，我想不出任何理由这样做。

# c# - 使用两个不同的公共属性来“获取”具有不同返回类型的相同私有变量

> ID：858886
> 
> 赞同：1
> 
> 时间：2009-05-13T16:12:51.960
> 
> 标签：c#, properties

我有一个具有 List `<string`> Roles 属性的 Customer 类。*很多时候我想以*字符串列表的形式访问该属性，但有时我想将其视为逗号分隔的列表。

我当然可以用一种新方法来做到这一点，如果我希望以不同的格式（逗号分隔、制表符分隔、&ct）获取变量的值，我当然会这样做。但是，我正在玩弄使用两个不同的属性来访问变量值的想法，类似于

```
public List<string> Roles 
{
    get { return this._Roles; }
    set { this._Roles = value; } 
} 
```

和

```
public string RolesToString
{
    get { do some work here to comma-delimit the list; }
} 
```

本质上，我想覆盖这个*特定*列表的 ToString() 方法。是否有令人信服的理由让 1 胜过其他？使用两个不同的属性来返回相同的变量值是否足够非标准以引起危险信号？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-13T16:17:02.610

我会让你的第二个“财产”成为一种方法。它正在对您的列表进行额外处理，并返回不是对象的直接“属性”，而是对象属性的处理版本。这似乎是一个合理的候选方法。

我的偏好是：

```
public List<string> Roles 
{
    get { return this._Roles; }
    set { this._Roles = value; } 
}

public string GetRolesAsString()
{
    // Do processing on Roles
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T16:20:11.123

正如里德所说，它可能应该是一种方法，但这有点主观。

请注意，您不需要太多代码来执行此操作 - 只需调用 Join()

```
public string RolesAsString()
{
    return String.Join(", ", this._Roles);
} 
```

鉴于.NET 中的字符串连接非常简单，您真的需要一个方法/属性吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T16:20:33.510

我对你的提议没有意见。除非我将其命名为**RolesString**。

但是...为什么只有吸气剂？如果我可以设置 Roles 属性，为什么我不能设置 RolesString 属性？

额外的处理并不一定意味着应该使用一种方法。

# c# - 从数据库中的二进制文件写入 PDF

> ID：858887
> 
> 赞同：4
> 
> 时间：2009-05-13T16:13:02.413
> 
> 标签：c#, sql, pdf, bytearray

好的，

我有一个带有存储 PDF 的 SQL 2005 数据库。该列使用图像类型。因此，当 PDF 存储时，它是一个 byte[] 数组。

所以这是困难的部分。我可以用它来存储数据，但我不确定如何将 byte[] 数组恢复为 PDF 格式并将其显示在网页上。

我正在使用第三部分工具来生成 PDF，效果很好。

我必须生成 byte[] 数组的代码如下：

```
Doc document = new Doc();
byte[] myArray = document.GetData(); 
```

然后我将 byte[] 数组插入到数据库中。

当我从数据库中取回数组时，我这样做：

```
public byte[] GetPDF(parameters)
{
    return DAL.GetPDF(parameters)
} 
```

这将返回一个有效的 byte[] 数组，因为它应该是。

现在，唯一的问题实际上是将 PDF 写入网站并将其显示在网站上，我不知道如何执行此操作或从哪里开始。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T16:20:40.467

```
 Response.ContentType = "application/pdf";
        byte[] bytes = YourBinaryContent;

        using (BinaryWriter writer = new BinaryWriter(context.Response.OutputStream))
        {
            writer.Write(bytes, 0, bytes.Length);
        } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T16:18:46.897

这很简单。事实上，我一个月前才这样做。我们必须将 PDF 存储在数据库中，然后在客户要求查看其文档时将其写出来。

您需要做的是在您的网页上添加以下代码：

```
byte[] myarray = BusinessLayer.GetPDF(parameters)

Response.Clear();
Response.ContentType = "application/pdf";
Response.BinaryWrite(myarray); 
```

看看这是否适合你。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T16:17:54.183

您需要将 Response.ContentType 设置为“application/pdf”，然后调用 Response.BinaryWrite 方法，传入字节数据。

# c# - 使用 C#/.NET 替换文件中文本的最佳方法是什么？

> ID：858897
> 
> 赞同：7
> 
> 时间：2009-05-13T16:14:42.740
> 
> 标签：c#, .net, file-io, replace

我有一个文本文件，它作为非常大的数据提取的一部分被写入。文本文件的第一行是提取的“帐户”数量。

由于此提取的性质，该数字直到过程结束时才知道，但文件可能很大（几百兆）。

C#/.NET 中打开文件（在本例中为简单文本文件）并替换文本第一“行”中的数据的最佳方式是什么？

**重要提示**： - 我不需要替换“固定数量的字节” - 这很容易。这里的问题是需要在文件顶部插入的数据是可变的。

**重要说明 2**： - 一些人曾询问/提到只是将数据保存在内存中然后替换它......但这完全不可能。之所以要更新此进程，是因为有时它在将一些演出加载到内存时会崩溃。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-13T16:22:22.773

如果可以的话，您应该插入一个占位符，并在末尾用实际数字和空格覆盖该占位符。

如果这不是一个选项，请先将您的数据写入缓存文件。当您知道实际数字时，创建输出文件并附加缓存中的数据。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T16:50:48.903

BEST 是非常主观的。对于任何较小的文件，您可以轻松地在内存中打开整个文件并使用字符串替换替换您想要的内容，然后重新写入文件。

即使对于较大的文件，加载到内存中也不会那么难。在内存多千兆的时代，我认为数百兆字节仍然可以轻松地在内存中完成。

您是否测试过这种幼稚的方法？你见过真正的问题吗？

如果这是一个非常大的文件（大小为千兆字节），我会考虑首先将所有数据写入临时文件，然后写入正确的文件，其中标题行首先进入，然后附加其余数据。由于它只是文本，我可能只是向 DOS 发送：

```
 TYPE temp.txt >> outfile.txt 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-18T20:39:31.977

在我看来，如果我正确理解了这个问题？

C#/.NET 中打开文件（在本例中为简单文本文件）并替换文本第一“行”中的数据的最佳方式是什么？

首次创建令牌 {UserCount} 时，如何在文件顶部放置它。

然后使用 TextReader 逐行读取文件。如果它是第一行查找 {UserCount} 并替换为您的值。使用 TextWriter 写出您读入的每一行

例子：

```
 int lineNumber = 1;
    int userCount = 1234;
    string line = null;

    using(TextReader tr = File.OpenText("OriginalFile"))
    using(TextWriter tw = File.CreateText("ResultFile"))
    {

        while((line = tr.ReadLine()) != null)
        {
            if(lineNumber == 1)
            {
                line = line.Replace("{UserCount}", userCount.ToString());
            }

            tw.WriteLine(line);
            lineNumber++;
        }

    } 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-13T16:33:00.133

> 我不需要替换“固定数量的字节”

你确定吗？如果您在文件的第一行写入一个大数字（UInt32.MaxValue 或 UInt64.MaxValue），那么当您找到正确的实际数字时，您可以用正确的数字替换该字节数，但用零填充，所以它仍然是一个有效的整数。例如

```
Replace  999999 - your "large number placeholder"
With     000100 - the actual number of accounts 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-22T18:33:08.480

好的，早些时候我提出了一种处理现有文件会更好的方法。

但是，在您的情况下，您想要创建文件并在创建过程中返回顶部并写出用户数。这将做到这一点。

这是一种避免您编写临时文件的方法。

```
 private void WriteUsers()
    {   
        string userCountString = null;
        ASCIIEncoding enc = new ASCIIEncoding();
        byte[] userCountBytes = null;
        int userCounter = 0;

        using(StreamWriter sw = File.CreateText("myfile.txt"))
        {
            // Write a blank line and return
            // Note this line will later contain our user count.
            sw.WriteLine();

            // Write out the records and keep track of the count 
            for(int i = 1; i < 100; i++)
            {
                sw.WriteLine("User" + i);
                userCounter++;
            }

            // Get the base stream and set the position to 0
            sw.BaseStream.Position = 0;

            userCountString = "User Count: " + userCounter;

            userCountBytes = enc.GetBytes(userCountString);

            sw.BaseStream.Write(userCountBytes, 0, userCountBytes.Length);
        }

    } 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-13T16:20:52.823

如果提取的文件只有几百兆字节，那么您可以轻松地将所有文本保留在内存中，直到提取完成。然后，您可以将输出文件作为最后一个操作，从记录数开始。

# c# - 我可以将 long 转换为 int 吗？

> ID：858904
> 
> 赞同：166
> 
> 时间：2009-05-13T16:15:21.503
> 
> 标签：c#, types, int, type-conversion, long-integer

我想转换`long`为`int`.

如果`long`>的值`int.MaxValue`，我很乐意让它环绕。

什么是最好的方法？

* * *

## 回答 #1

> 赞同：239
> 
> 时间：2009-05-13T16:17:05.323

做吧`(int)myLongValue`。`unchecked`它会在上下文（这是编译器的默认值）中完全按照您的意愿（丢弃 MSB 并采用 LSB ）。如果值不适合，它将`OverflowException`在上下文中抛出：`checked``int`

```
int myIntValue = unchecked((int)myLongValue); 
```

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2009-05-13T16:17:52.327

```
Convert.ToInt32(myValue); 
```

虽然我不知道当它大于 int.MaxValue 时它会做什么。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2012-11-19T11:18:23.140

有时您实际上并不对实际值感兴趣，而是对它作为*checksum/hashcode*的用法感兴趣。在这种情况下，内置方法`GetHashCode()`是一个不错的选择：

```
int checkSumAsInt32 = checkSumAsIn64.GetHashCode(); 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2014-08-21T05:35:46.563

最安全、最快的方法是在施法前使用位掩码...

```
int MyInt = (int) ( MyLong & 0xFFFFFFFF ) 
```

位掩码 ( `0xFFFFFFFF`) 值将取决于 Int 的大小，因为 Int 大小取决于机器。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2020-05-12T20:53:05.910

一种可能的方法是使用模运算符仅让值保持在 int32 范围内，然后将其强制转换为 int。

```
var intValue= (int)(longValue % Int32.MaxValue); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2019-09-16T09:17:50.860

它可以通过

> Convert.ToInt32 方法

但是如果它的值超出 Int32 类型的范围，它会抛出一个 OverflowException。一个基本的测试将向我们展示它是如何工作的：

```
long[] numbers = { Int64.MinValue, -1, 0, 121, 340, Int64.MaxValue };
int result;
foreach (long number in numbers)
{
   try {
         result = Convert.ToInt32(number);
        Console.WriteLine("Converted the {0} value {1} to the {2} value {3}.",
                    number.GetType().Name, number,
                    result.GetType().Name, result);
     }
     catch (OverflowException) {
      Console.WriteLine("The {0} value {1} is outside the range of the Int32 type.",
                    number.GetType().Name, number);
     }
}
// The example displays the following output:
//    The Int64 value -9223372036854775808 is outside the range of the Int32 type.
//    Converted the Int64 value -1 to the Int32 value -1.
//    Converted the Int64 value 0 to the Int32 value 0.
//    Converted the Int64 value 121 to the Int32 value 121.
//    Converted the Int64 value 340 to the Int32 value 340.
//    The Int64 value 9223372036854775807 is outside the range of the Int32 type. 
```

[这里](https://docs.microsoft.com/en-us/dotnet/api/system.convert.toint32?view=netframework-4.8)有一个更长的解释。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2019-09-19T12:28:45.833

如果值超出整数范围，则以下解决方案将截断为 int.MinValue/int.MaxValue。

```
myLong < int.MinValue ? int.MinValue : (myLong > int.MaxValue ? int.MaxValue : (int)myLong) 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-03-02T10:48:11.177

不会

```
(int) Math.Min(Int32.MaxValue, longValue) 
```

从数学上讲，是正确的方法吗？

# algorithm - 外交博弈判断算法

> ID：858914
> 
> 赞同：5
> 
> 时间：2009-05-13T16:18:07.117
> 
> 标签：algorithm

我正在编写一个用于在线玩伟大*外交*游戏的服务器。**有谁知道法官的算法，它将在每一轮结束时计算地图上的所有移动/支持/车队？**

为了实现我使用扭曲的协议，用于 db-access django

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-13T21:02:55.607

是的。 [DPjudge 裁决算法](http://www.floc.net/dpjudge/?page=Algorithm)。[另请参阅有关车队悖论](http://www.floc.net/dpjudge/?page=Questions)的问题的 DPJudge 常见问题解答。

检查链接到源代码的[njudge页面。](http://www.njudge.org/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-14T01:15:00.513

您可能还想查看[DAIDE](http://www.daide.org.uk/index.xml)项目。他们有一个完整的通信协议，可以针对特殊服务器创建 dip bot 播放器。它不是开源的（不幸的是），但是当 7 个人不能玩时，有一个小社区使用它来玩实时 Dip 游戏。

# ms-access - 使用表单在 MS Access 数据库中存储 PDF

> ID：858915
> 
> 赞同：2
> 
> 时间：2009-05-13T16:18:21.140
> 
> 标签：ms-access

我需要使用表单将 PDF 文件存储在共享驱动器上的 Access 数据库中。我想出了如何在表格中执行此操作（使用 OLE 对象字段，然后只需拖放），但我想在具有保存按钮的表单上执行此操作。单击保存按钮会将文件（不仅仅是链接）存储在数据库中。关于如何做到这一点的任何想法？

编辑：我使用的是 Access 2003，数据库将存储在共享驱动器上，所以我不确定链接到文件是否能解决问题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-14T11:42:37.290

我们有几个数据库，其中包含成千上万的文档（pdf、doc、jpg、...），完全没有问题。在 Access 中，我们使用以下代码将二进制对象上传到二进制字段：

```
Function LoadFileFromDisk(Bestand, Optional FileName As String = "")
  Dim imgByte() As Byte
  If FileName = "" Then FileName = strFileName
  Open FileName For Binary Lock Read As #1
  ReDim imgByte(1 To LOF(1))
  Get #1, , imgByte
  Close #1
  If Not IsEmpty(imgByte) Then Bestand.Value = imgByte
End Function 
```

在这种情况下，Bestand 是包含二进制数据的字段。我们使用 MS SQL Server 作为后端，但同样适用于 Access 后端。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-01-16T17:35:42.967

如果您使用相同的概念，但升级为 SQL Server——将 PDF 存储在 Image 数据类型（或 varbinary(max)）中，那么您可以使用全文搜索在 PDF 中进行搜索。

我表明微软说你可以为任何可以注册 IFILTER 产品的文件类型执行此操作。前几天我刚刚在 Adob​​e 网站上说他们的 Acrobat IFILTER 确实是免费的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-14T04:08:32.860

OLE 对象的字段，默认情况下会在表单上使用绑定对象框架。右键单击它，您可以插入一个对象。它带有文件浏览功能。双击该字段，将打开实际文档。

我建议使用大卫的建议和链接。除非您需要传输单个文件并希望包含所有 PDF。尺寸和性能将是一个问题。

如果安全是一个问题并且访问文件是您拥有的唯一控件（您无法在包含所有链接文件的文件夹上设置安全性。），那么您将不得不嵌入。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T16:31:13.647

也许这会有所帮助：[ACC2000：读取、存储和写入二进制大对象 (BLOB)](http://support.microsoft.com/?scid=kb%3Ben-us%3B210486&x=12&y=9)。

他们的工作：分块读取文件并使用 VBA 函数将其添加到 blob。

# python - 如何将 python 警告重定向到自定义流？

> ID：858916
> 
> 赞同：9
> 
> 时间：2009-05-13T16:18:21.843
> 
> 标签：python, warnings, io

假设我有一个类似 StreamIO 的文件对象，并希望 python 的警告模块将所有警告消息写入它。我怎么做？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-05-13T16:20:28.673

尝试重新分配[warnings.showwarning，](http://docs.python.org/library/warnings.html#warnings.showwarning)即

```
#!/sw/bin/python2.5

import warnings, sys

def customwarn(message, category, filename, lineno, file=None, line=None):
    sys.stdout.write(warnings.formatwarning(message, category, filename, lineno))

warnings.showwarning = customwarn
warnings.warn("test warning") 
```

将所有警告重定向到标准输出。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T16:57:28.970

我认为这样的事情会起作用，尽管它是未经测试的代码，并且界面看起来有一种更清洁的方式目前让我无法理解：

```
import warnings

# defaults to the 'myStringIO' file
def my_warning_wrapper(message, category, filename, lineno, file=myStringIO, line=None):
    warnings.show_warning(message, category, filename, lineno, file, line)    

warnings._show_warning = my_warning_wrapper 
```

如果这还不够的话，看看 Lib\warnings.py 应该可以帮助你走上正轨。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T17:40:52.520

```
import sys
import StringIO

sys.stdout = StringIO.StringIO() 
```

# firefox - 自动化 Firefox 配置设置

> ID：858918
> 
> 赞同：0
> 
> 时间：2009-05-13T16:18:41.063
> 
> 标签：firefox, configuration, automation, macros

在 Web 开发工作中，我需要能够在 Firefox 中快速切换各种配置设置。特别是我需要能够：

1) 关闭 cookie 2) 关闭 javascript 3) 切换我的用户代理（我安装了用户代理切换器插件）

然后再回来。

如果我可以在我的工具栏上添加一个“宏”按钮，我可以简单地单击以切换上面的三个设置，而不是手动执行此操作。

有谁知道这是否可能？

顺便说一句 - Firefox 配置文件并没有真正削减它。您不能在特定的 Firefox 实例中动态切换配置文件，而我需要这样做。

顺便说一句 - 当我看到 Greasemonkey、Chicken Foot 时我很兴奋，但看起来这些只能自动化浏览/DOM 任务，而不是使用 firefox 配置设置。

谢谢理查德。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T21:22:40.160

由于您的要求，您最好自己制作一个简单的插件。你甚至可以让它添加一个在事物之间来回切换的按钮。

您可以通过将首选项“network.cookie.cookieBehavior”设置为 2 来禁用 cookie，可以通过将首选项“javascript.enabled”设置为 false 来关闭 JavaScript，并且可以通过更改首选项“general.useragent”来修改用户代理.extra.firefox”。

要执行这些操作，您需要使用在[此处记录](https://developer.mozilla.org/En/Preferences_API)的偏好 API 。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T16:46:21.097

[Web-developer 工具栏](https://addons.mozilla.org/en-US/firefox/addon/60)将执行您请求的所有操作，除了*切换*用户代理字符串，这可以通过您已经使用的 UA 切换器插件来完成。然而，据我所知，它不能被宏化，但可以通过点击几下鼠标来完成。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T16:54:27.417

试试[iMacros](https://addons.mozilla.org/en-US/firefox/addon/3863)。

从他们的网站：“无论你用 Firefox 做什么，iMacros 都可以自动化它。”

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T16:39:07.940

我认为还有其他附加组件可以获得您正在寻找的所有功能（尽管不是全部在一个工具中）。

1.  [https://addons.mozilla.org/en-US/firefox/addon/2497](https://addons.mozilla.org/en-US/firefox/addon/2497)
2.  [https://addons.mozilla.org/en-US/firefox/addon/6527](https://addons.mozilla.org/en-US/firefox/addon/6527)
3.  [https://addons.mozilla.org/en-US/firefox/addon/59](https://addons.mozilla.org/en-US/firefox/addon/59)

如果您想扩展这些附加组件的功能，XPI 文件只是具有不同扩展名的 .zip 文件。您可以重命名它们并解压缩它们，并了解它们是如何做的、扩展它们、安装您自己的定制版本等。

# installation - 从命令行传递的 WiX 条件属性不起作用？

> ID：858923
> 
> 赞同：4
> 
> 时间：2009-05-13T16:19:19.610
> 
> 标签：installation, wix, conditional, wix3, shortcuts

我有一个属性来决定是否安装需要通过命令行参数传递的快捷方式。当我在 wxs 文件中设置属性时，这些条件似乎有效，但在通过命令行设置它们时，它们似乎被忽略了。从日志中我看到它们正在被设置：

```
MSI (s) (24:C8) [11:01:32:234]: PROPERTY CHANGE: Modifying INSTALLSTARTUPSHORTCUT property. Its current value is '0'. Its new value: '1'.
MSI (s) (24:C8) [11:01:32:234]: PROPERTY CHANGE: Modifying INSTALLSTARTMENUSHORTCUT property. Its current value is '0'. Its new value: '1'.
MSI (s) (24:C8) [11:01:32:234]: PROPERTY CHANGE: Modifying INSTALLDESKTOPSHORTCUT property. Its current value is '0'. Its new value: '1'. 
```

但是，他们没有安装快捷方式。

此外，似乎由于它们需要在自己的组件中才能对它们设置条件，因此它们不能再被宣传为快捷方式。您将如何获得有条件安装的广告快捷方式？

当前快捷方式代码：

```
<Property Id="INSTALLSTARTMENUSHORTCUT" Value="0"/>
...
<Component Id="StartMenuShortcut" Guid="MY-GUID">
  <Condition>INSTALLSTARTMENUSHORTCUT</Condition>
  <Shortcut Id="StartMenuServerShortcut"
    Directory="ProgramMenuDir"
    Name="Application Name" WorkingDirectory="INSTALLDIR" Advertise="no"
    Target="[!FileEXE]"
    Icon="Icon.ico" />
</Component> 
```

并重复其他快捷方式

编辑：

尝试 Sacha 的建议并添加以下内容：

```
<Property Id="INSTALLSTARTUPSHORTCUT" Value="0" Secure="yes"/>
<Property Id="INSTALLDESKTOPSHORTCUT" Value="0" Secure="yes"/>
<Property Id="INSTALLSTARTMENUSHORTCUT" Value="0" Secure="yes"/> 
```

现在它会安装所有快捷方式，即使它们在 xml 和命令行中都设置为 0。我传递的命令行是：

```
msiexec /i MySetup.msi INSTALLSTARTUPSHORTCUT=0 INSTALLDESKTOPSHORTCUT=0 INSTALLSTARTMENUSHORTCUT=0 /l*v inst.log /qb 
```

尝试将值放在引号中，但仍然不行。此处未显示，但我通过执行 ALLUSERS="" 或 ALLUSERS="2" 成功操纵 ALLUSERS 属性以执行每个用户或每台机器的注册表所以应该可以传递属性，但我不确定是什么我做错了。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-20T18:44:57.660

两件事，因为这里有两个问题：

1.  广告快捷方式必须位于安装它们指向的文件的同一组件中。这是必需的，因为 Windows 安装程序将广告的快捷方式指向组件的 KeyPath。因此，如果您希望选择性地安装广告快捷方式，则不能使用它们。

我有[一篇关于如何创建快捷方式和通过验证](http://robmensching.com/blog/posts/2007/4/27/how-to-create-an-uninstall-shortcut-and-pass-all-the)的博客文章。

2.  您正在使用的属性需要标记为安全才能从安装 UI 过程传递到服务器端。要做到这一点

    <Property Id="INSTALLSTARTMENUSHORTCUT" Secure="yes"/>

请注意，我没有添加 Value 属性。如果您指定一个值，即使它是 0，那么您的 INSTALLSTARTMENUSHORCUT 将评估为 TRUE。空白/未定义属性为 FALSE，任何其他值为 TRUE。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-14T01:16:05.737

您是否尝试过将属性标记为安全？

```
<Property Id="INSTALLSTARTMENUSHORTCUT" Value="0" Secure="Yes" /> 
```

查看[快捷方式表](http://msdn.microsoft.com/en-us/library/aa371847(VS.85).aspx)的文档，我认为您无法获得有条件的广告快捷方式。我们通过安装广告开始菜单快捷方式和常规桌面快捷方式来解决此问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T19:21:27.737

如果 IIRC Advertise 必须下注设置为 Yes

您已经在 MindCapers 中看到了这个示例，[在](http://wix.mindcapers.com/wiki/Shortcuts_in_WiX)创建注册表项之前，我在使用 Shorcuts 时遇到了问题。

# c# - 将 HTML 文本转换为 microsoft word 文档书签

> ID：858926
> 
> 赞同：1
> 
> 时间：2009-05-13T16:20:23.867
> 
> 标签：c#, ms-word

我有一个小型的网络富文本编辑器，它具有一些功能，如 bolb、斜体等......

生成的文本是 html，我想将该文本插入到 word 文档书签中。

将文本放入书签不是问题。但是，由于文本格式（例如粗体），我遇到了问题。

有没有一种快速的方法可以将文本从 html 转换为 doc，或者只是一种将 html 包含到 word 文档中的方法？

这是一个例子：

```
 <p>Hello <strong>world<strong/></p> 
```

此文本应仅出现在单词书签中的“Hello **World ”。**

提前致谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-11-19T14:35:58.880

将 html 包含在 ... <\body> 标记中应该可以解决问题。

# .net - WPF Toolkit Datagrid - 自定义选项卡

> ID：858938
> 
> 赞同：9
> 
> 时间：2009-05-13T16:22:06.313
> 
> 标签：.net, wpf, .net-3.5, datagrid, wpftoolkit

我有一个包含 3 列的 WPF Toolkit DataGrid。只有第三列允许数据输入 - 前两列是静态的（文本描述）。是否可以控制选项卡和导航，以便选项卡和上下左右按钮将忽略前两列并在第三列的范围内操作？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-11-10T13:18:21.273

`IsTabStop`您可以使用该属性禁用前两列的制表符。不幸的是，这不像其他一些 WPF 控件那样容易访问，因此您必须通过以下方式设置它`CellStyle`：

```
</dg:DataGridTextColumn>
    <dg:DataGridTextColumn.CellStyle>
        <Style TargetType="{x:Type dg:DataGridCell}">
            <Setter Property="IsTabStop" Value="False" />
        </Style>
    </dg:DataGridTextColumn.CellStyle>
</dg:DataGridTextColumn> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-09T20:50:15.370

这可能无法完全回答您的问题，但希望它能帮助您入门。在使用退格键清除单元格内容时，我遇到了 WPF Toolkit DataGrid 的错误，该错误插入了一个垃圾字符。这让我看到了一篇关于该错误的 CodePlex 帖子，结果方法覆盖（我对网格和列进行了子类化）让我绕过了这个问题。

这是让我开始的帖子： [http ://wpf.codeplex.com/WorkItem/View.aspx?WorkItemId=10246](http://wpf.codeplex.com/WorkItem/View.aspx?WorkItemId=10246)

我假设您可以捕获制表键并仅在用户位于第三列时才将其传递？

希望这会有所帮助 - 我对 WPF 比较陌生，所以仍在学习内部知识。

# windows - 在命令行中将目录树复制到单个目录

> ID：858939
> 
> 赞同：4
> 
> 时间：2009-05-13T16:22:16.720
> 
> 标签：windows, regex, command-line, file-rename

任何人都知道一个命令行实用程序（或可以作为命令行运行的实用程序），它将目录树中的所有 .jpg 文件收集到一个文件夹中，只复制更改的文件？

我从[Renamer](http://www.den4b.com/downloads.php?project=ReNamer)开始，它非常适合重命名当前目录中的文件，但当我试图破坏路径时却失败了。这可能是因为我不太了解 Renamer。我最终创建了一个文本文件目录转储，然后使用 REGEX 查找/替换来创建批处理文件，但这既不高效也不自动化。

正则表达式：

(G:\DIR\DIR\)([0-9]+\)([0-9]+\)([0-9]+\)([0-9]+\)(p[0- 9]+.jpg)

改变了这个

G:\DIR\DIR\00\00\00\00\p0000000000.jpg

对此

G:\DIR\DIR\p0000000000.jpg

（复制\1\2\3\4\5\6 \1\6）在批处理文件中。

我需要在没有真人登录的情况下将整个事情作为计划任务运行。不是真的在寻找 Zip 文件，因为我不想打扰系统处理器，而且大多数文件不会每天更改。这更像是文件同步。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-13T16:56:08.600

在 Windows 命令行中，您可以执行以下操作：

```
for /R A %i IN (*.jpg) DO xcopy %i B /M /Y 
```

其中 A 是源目录，B 是目标目录。您需要启用命令扩展，我相信这是默认设置。

## 评论中的几点说明：

如果您的任何路径中可能有空格，则需要在第二个 %i 周围添加引号。这可以防止字符串被 xcopy 命令解释为两个单独的参数。您可能需要围绕 A 和 B 路径执行相同的操作。像这样：

```
for /R "A" %%i IN (*.jpg) DO xcopy "%%i" "B" /M /Y 
```

如果你把它放在 .bat 或 .cmd 文件中，你需要像这样将百分比加倍。

```
for /R A %%i IN (*.jpg) DO xcopy %%i B /M /Y 
```

xcopy 上的 /M 选项将仅复制设置了存档位的文件，然后取消设置该位。这可以防止文件被复制两次。如果您有其他进程也更改此位，则可能会导致问题。也可以使用 /D 选项将文件的最后修改时间与目标中的时间进行比较，并且只复制较新的文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T16:34:52.957

我猜你是在 Windows 上的路径格式。

我还没有读完整本书，但[http://www.infionline.net/~wtnewton/batch/batguide.html#6a](http://www.infionline.net/~wtnewton/batch/batguide.html#6a)可能会对你有所帮助。

同一页面有 dizzy.bat，（[http://www.infionline.net/~wtnewton/batch/dizzy.bat](http://www.infionline.net/~wtnewton/batch/dizzy.bat)）应该很容易编辑来做你想做的事。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T17:06:54.947

在 Unix 环境中，我会使用`find`or `rsync`（也许还有 shell 的一些特性）。Cygwin 和 MinGW 带有`find`，也许带有`rsync`. 您也可以在`find`某处获得独立的 Windows 端口。

如果`SOURCE`shell 变量是包含要复制文件的子目录的目录，并且`DEST`shell 变量是要将它们复制到的目录：

```
find $SOURCE -name \*.jpg -exec cp --update \{\} $DEST/ \; 
```

`find`本质上是递归的。" `-name \*.jpg`" 选择与该模式匹配的文件。您可以使用 -and 添加其他条件。该命令的`--update`选项`cp`（或 -u）仅在更改或尚未复制文件时才会影响复制文件。还有其他选项`cp`也可能有用。

如果 $SOURCE 与您的 DIR/DIR/ 示例中的 $DEST 相同，则 find 还将找到目标文件（已复制），尽管这没问题，cp 会识别出您正在尝试将相同的文件复制到本身并跳过它，但如果你想避免浪费的工作，你可以使用'for'和'if'（或其他东西）只在DIR/DIR/的子目录上运行find。

您还可以使用 rsync，它具有可以从目标目录中删除文件（如果它们也已从源目录中删除）以及许多其他此类变体的选项。

# syntax - F# let 带逗号的语句的语义

> ID：858941
> 
> 赞同：5
> 
> 时间：2009-05-13T16:22:42.803
> 
> 标签：syntax, f#, tuples, semantics, let

我正在学习 F#。我首先查看了来自 Microsoft的[F# 示例。](http://go.microsoft.com/fwlink/?LinkID=124614)

我遇到了这个声明：

```
let line1,line2 = 
    use sr = System.IO.File.OpenText @"test.txt"
    let line1 = sr.ReadLine() 
    let line2 = sr.ReadLine() 
    (line1,line2) 
```

**谁能向我解释这个说法？**

这里定义的是什么类型？一个函数？一个元组？

为什么必须在( ... ) 的定义`line1`中重新定义？`line2``line1,line2``let line1 =``let line2 =`

最后一行是什么，`(line1, line2)`这与原始定义的类型有何关联？这是函数返回吗？

“声明”甚至是用于 F# 定义的正确词吗？

谢谢。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-13T16:41:58.933

在 F# 中绑定标识符值的一般形式是

```
let pattern = expression 
```

在这种情况下，*模式*是“line1，line2”，它是一个*元组*模式，它将绑定到一个 2 元组的值，并将名称“line1”和“line2”分配给这两个值。

*表达式*是接下来的 4 行。在那个表达式里面有局部变量。它们碰巧也被命名为“line1”和“line2”，但它们很容易被重命名为“x”和“y”或其他任何东西——这些标识符的范围是这个缩进表达式的局部变量。（就编译器而言，与外部作用域中的名称使用相同的名称这一事实没有任何影响。）

如果表达式是表达式的“返回值”，则为最后一行。在这种情况下，它返回值“line1”和“line2”的 2 元组（或“x”和“y”，如果您为了清楚说明而重命名它们）。顺便说一句，由于这两个值的类型均为“string”，因此返回表达式的类型为“string*string”，这是一个 2 元组，其中每个值都是一个字符串。这意味着第一行的原始“line1”和“line2”名称都将被推断为“string”类型。

F# is functional, and so in a sense "everything is an expression" and "there are no statements" (only sequences of expressions that are sequentially evaluated), but it is ok IMO to (ab)use the term "statement" to describe the inner "let" lines, unless you're trying to be very precise.

# java - Java + regex 如何检查这样一个字符串“LOAD_filesourceB-01012008_000058.dat”的类型和数字（最后 6 位）

> ID：858946
> 
> 赞同：0
> 
> 时间：2009-05-13T16:24:04.393
> 
> 标签：java, regex

如何通过正则表达式实现这样的要求？

我有一个文件名列表作为字符串。
LOAD_filesourceA-01012008-00001.dat
LOAD_filesourceB-01012008-00001.dat
LOAD_filesourceB-01012008-00003.dat
LOAD_filesourceA-01012008-00004.dat
LOAD_filesourceA-01012008-000055.dat
LOAD_filesourceB-01012008_000055.dat
...
LOAD_filesourceB-01012008_000058.dat
etc

加载每个文件后，该文件被移动到存档目录中......我记录了文件类型和加载编号（文件名中的最后 6 个字符）
我有 2 条信息：1-我希望加载的文件是否为类型 A 或 B 2- 最后加载的文件编号为基于这些的整数，我想获取下一个文件的文件名，即相同的文件类型和加载编号（= 之前的最后 6 位数字。 “.dat”部分）应该是下一个可用的数字。假设加载的是 12，那么我将搜索 13，如果不可用，则搜索 14、15 等。直到我处理该目录中的所有文件。

刚刚给出一个像“LOAD_filesourceB-01012008_000058.dat”这样的字符串，我可以检查这是文件类型B，假设最后加载的文件号是57，它满足58号的要求。（> 57 我的意思是）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T16:29:11.950

LOAD_filesource(A|B)-[0-9]+-([0-9])+.dat

A 或 B 将在第 1 组中结束，即第 2 组中文件的编号。然后将第 2 组解析为十进制整数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T17:31:17.950

看到这个：

```
public class Match {

    Pattern pattern = Pattern.compile("LOAD_filesource(A|B)-[0-9]{8}[_-]([0-9]{5,6})\\.dat");

    String files[] = {
        "LOAD_filesourceA-01012008-00001.dat",
        "LOAD_filesourceB-01012008-00001.dat",
        "LOAD_filesourceB-01012008-00003.dat",
        "LOAD_filesourceA-01012008-00004.dat",
        "LOAD_filesourceA-01012008-000055.dat",
        "LOAD_filesourceB-01012008_000055.dat",
        "LOAD_filesourceB-01012008_000058.dat"
    };

    public static void main(String[] args) {
        new Match().run();
    }

    private void run() {
        for (String file : files) {
            Matcher matcher = pattern.matcher(file);

            System.out.print(String.format("%s %b %s %s\n", file, matcher.matches(), matcher.group(1), matcher.group(2)));
        }
    }
} 
```

使用此输出：

```
LOAD_filesourceA-01012008-00001.dat true A 00001
LOAD_filesourceB-01012008-00001.dat true B 00001
LOAD_filesourceB-01012008-00003.dat true B 00003
LOAD_filesourceA-01012008-00004.dat true A 00004
LOAD_filesourceA-01012008-000055.dat true A 000055
LOAD_filesourceB-01012008_000055.dat true B 000055
LOAD_filesourceB-01012008_000058.dat true B 000058 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T16:57:16.007

我不知道它是否有意，但您列出了两种不同的格式，一种使用连字符作为最后的分隔符，另一种使用下划线。如果两者都得到真正支持，你会想要：

```
LOAD_filesource(A|B)-[0-9]+[_-]([0-9])+.dat 
```

此外，您的六位数字有时是五位数字（例如 LOAD_filesourceA-...-00001.dat 中的 00001），但上述正则表达式只要求至少存在一位数字。

根据您要尝试检查的文件数量，您最好加载目录列表，而不是随机检查文件是否存在。使用适当的比较方法，对列表进行排序可以使您的文件以易于使用的顺序排列。

# asp.net - 扩展从 JQuery 调用 Web 服务时从 ASP.NET 引发的异常

> ID：858953
> 
> 赞同：5
> 
> 时间：2009-05-13T16:24:59.930
> 
> 标签：asp.net, jquery, web-services, json, exception

我正在使用 JQuery 在使用 JSON 和 WebServices 的 ASP.NET 开发环境中动态加载控件。在这个解决方案中，我有一个业务逻辑层，它具有内置的验证机制（即验证类似于 CSLA 的属性和业务规则）

当请求使用 JQuery 和 ASP.NET WebService 动态加载新控件时，我想根据业务逻辑验证机制（即服务器端验证）验证来自当前控件的输入，并在有任何问题时通知用户.

我设法实现了这一点，但是，当 Web 服务中的验证失败时，我想抛出一个包含验证字段 ID 和相关错误消息的客户异常。

在 JQuery 中，我测试了这个特定的 ExceptionType，并希望将错误消息动态地应用于异常类型属性中列出的控件。这就是我的问题所在。即使我使用自定义属性创建了一个自定义异常，从 WebService 以 JSON 格式传递给 JQuery 的异常仍然是一个标准异常，没有列出任何其他属性。我可以简单地在异常的消息属性中创建一个 JSON 格式的值字符串，但最终会更喜欢一些更优雅的东西。有谁知道如何覆盖 ASP.NET 针对此类情况创建的序列化异常...

先感谢您...

G

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-21T05:01:27.700

几天前我遇到了非常相似的事情——基本上没有办法让 ASP.NET 生成自定义异常。这是[设计使然](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=290881)，因为返回特定类型的异常会

> [...] 向客户公开实施细节/错误。我们可以用我们允许通过的特殊异常类型做一些事情，但是对于这个版本来说已经太晚了 [...]

[您总是可以返回不同的 HTTP 状态代码](https://stackoverflow.com/questions/674027/what-should-a-json-service-return-on-failure-error)，并让浏览器将它们作为自定义异常处理 - 例如，500 错误意味着一件事，401 意味着其他事情，等等。我认为最好的解决方案是让您的方法返回一个字符串使用异常堆栈 - 不优雅，但至少这样客户端拥有所有异常详细信息。

Dave Ward 也有关于[ASP.NET AJAX 服务错误](http://encosia.com/2009/03/04/use-jquery-to-catch-and-display-aspnet-ajax-service-errors/)的信息。

# linq - 如何查看 LINQ 查询的输入？

> ID：858956
> 
> 赞同：1
> 
> 时间：2009-05-13T16:25:23.127
> 
> 标签：linq, linq-to-sql

我有一个看起来像这样的 LINQ 查询（最后）：

`var query = from myTable0 ... where myTable1.attributeId == 123 && (bunchaStrings.Contains(myTable1.attributeName)) && myTable2.yesNoValue == 'Y'`

当我看到查询时，它变成了这个

`SELECT ... FROM ... INNER JOIN ... WHERE ... AND (UNICODE([t3].[yesNoValue]) = @p3`

所以这里发生的是'Y'的值通过UNICODE函数变成了'89'。没关系，但我真的很想直接看到 @p3 的值，我不知道如何通过我的 var 提供的任何方法查看该值。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T16:32:26.407

我建议将生成的 SQL 输出到输出窗口。在那里您将能够看到整个 SQL 和您的参数值。然后它也可以被记录。

它的代码可以在这里找到-> [http://www.u2u.info/Blogs/Kris/Lists/Posts/Post.aspx?ID=11](http://www.u2u.info/Blogs/Kris/Lists/Posts/Post.aspx?ID=11)

或者更简单的方法（如果你有一个方便的控制台）：

```
 MyDataContext context = new MyDataContext()
 context.Log = Console.Out 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T16:39:35.757

您可能还对 LINQ to SQL Visualizer 感兴趣：[http ://weblogs.asp.net/scottgu/archive/2007/07/31/linq-to-sql-debug-visualizer.aspx](http://weblogs.asp.net/scottgu/archive/2007/07/31/linq-to-sql-debug-visualizer.aspx)

# sql - SQL中的表和列限制是什么？

> ID：858960
> 
> 赞同：0
> 
> 时间：2009-05-13T16:27:14.123
> 
> 标签：sql

sql最多可以创建多少表，单个表最多可以创建多少列？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T17:05:40.550

SQL 作为一种语言没有规定这样的限制，并且假定列、表和你有的东西数量不受限制。此外，SQL 作为一门语言，认为所有操作在时间效率上都是恒定的和即时的。

正如其他回答者已经提到的那样，不同的[RDBMS](http://en.wikipedia.org/wiki/Relational_database_management_system)实现的东西彼此非常不同。很少有人完整地实现 SQL。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T16:32:38.357

如此处所示：http: [//msdn.microsoft.com/en-us/library/ms143432.aspx](http://msdn.microsoft.com/en-us/library/ms143432.aspx)

MS SQL Server 可以包含 2,147,483,647 个对象。对象包括表、视图、存储过程、用户定义的函数、触发器、规则、默认值、约束等。简而言之，您不太可能用完对象的空间。

每个非宽表 1024 列，宽表 30,000 列。

如果您在谈论另一个数据库平台，那么我相信谷歌会提供帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-13T16:36:43.060

这会因数据库而异，但我可以告诉您，如果您正在考虑接近表中最大列数的任何内容，则需要重新设计。您对每条记录的字节数也有绝对限制，虽然您可以创建列一起添加的字节数超过某些数据库中记录所允许的字节数（我知道 SQL Server 会让您这样做），但您最终将不得不redisgn 因为一条记录不能满足限制。如果您计划每条记录有很多空列，则可能需要相关表。不太宽的表也往往性能更好，并且更容易维护。

# vb.net - 检测已安装的 Excel 版本（和服务包）

> ID：858966
> 
> 赞同：5
> 
> 时间：2009-05-13T16:28:32.247
> 
> 标签：vb.net, excel

我需要能够从我正在开发的一些 .NET 代码中检测我在我的机器中安装了哪个版本的 Excel。我目前正在为此使用**Application.Version**，但它没有提供有关 Service Pack 的信息。

我最好避开这样的事情： [http ://www.mvps.org/access/api/api0065.htm](http://www.mvps.org/access/api/api0065.htm)

欢迎使用托管代码！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-13T18:03:52.763

```
Public Shared Function GetExcelVersion() As Integer
    Dim excel As Object = Nothing
    Dim ver As Integer = 0
    Dim build As Integer
    Try
        excel = CreateObject("Excel.Application")
        ver = excel.Version
        build = excel.Build
    Catch ex As Exception
        'Continue to finally sttmt
    Finally
        Try
            Marshal.ReleaseComObject(excel)
        Catch
        End Try
        GC.Collect()
    End Try
    Return ver
End Function 
```

如果未找到 excel，则返回 0。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T17:13:20.537

不幸的是，这种方法是唯一可靠的方法。甚至[微软也建议使用类似的技术](http://support.microsoft.com/kb/821549)（这是用于手动检查，但概念是相同的）。

如果您想在托管代码中执行此操作，我建议您只从您的链接中移植代码，并创建一个在新服务包发布时易于扩展的类。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-10-06T03:58:27.307

您可以检查注册表中的应用程序路径以获取 exe 的路径，然后获取其版本：请参阅[http://www.codeproject.com/KB/office/getting_office_version.aspx](http://www.codeproject.com/KB/office/getting_office_version.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T17:47:29.733

虽然不稳健，但这种方法是我所知道的唯一方法。

请记住，您不必检查是否完全匹配。您可以对各个值进行比较，以查看您拥有的版本是否为例如 SP1 或更高版本。如果版本号大于或等于“11.0.6355.0”，您就知道它是较新的（您需要实现比较）

# c# - 如何在设计时为紧凑型框架控件进行 Alpha 混合

> ID：858968
> 
> 赞同：1
> 
> 时间：2009-05-13T16:28:51.310
> 
> 标签：c#, visual-studio-2008, compact-framework

我正在设计一个支持透明度的紧凑型框架控件，并且对于控件的运行时版本，一切正常，只需找到在此 API 上执行平台调用即可：

```
[DllImport("coredll.dll")]
    extern public static Int32 AlphaBlend(IntPtr hdcDest, Int32 xDest, Int32 yDest, Int32 cxDest, Int32 cyDest, IntPtr hdcSrc, Int32 xSrc, Int32 ySrc, Int32 cxSrc, Int32 cySrc, BlendFunction blendFunction); 
```

显然，对“coredll.dll”的调用在桌面设计时体验中不起作用，现在，当绘制发生时，我只是检测到正在设计控件并在没有任何透明度的情况下绘制它。我希望能够提供更好的设计时体验，并在 Visual Studio 设计器中显示相同的透明度。

我试过打这个平台电话：

```
[DllImport("gdi32.dll", EntryPoint = "GdiAlphaBlend")]
    public static extern bool AlphaBlendDesktop(IntPtr hdcDest, int nXOriginDest, int nYOriginDest,
        int nWidthDest, int nHeightDest,
        IntPtr hdcSrc, int nXOriginSrc, int nYOriginSrc, int nWidthSrc, int nHeightSrc,
        BlendFunction blendFunction); 
```

但是当它返回 true 时，结果是什么都没有被绘制到设计时视图。

有什么想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-08-26T10:25:51.747

这对我来说是为了欺骗设计师执行 AlphaBlend 操作。

```
// PixelFormatIndexed = 0x00010000, // Indexes into a palette
// PixelFormatGDI = 0x00020000, // Is a GDI-supported format
// PixelFormatAlpha = 0x00040000, // Has an alpha component
// PixelFormatPAlpha = 0x00080000, // Pre-multiplied alpha
// PixelFormatExtended = 0x00100000, // Extended color 16 bits/channel
// PixelFormatCanonical = 0x00200000,
// PixelFormat32bppARGB = (10 | (32 << 8) | PixelFormatAlpha | PixelFormatGDI | PixelFormatCanonical),

// cheat the design time to create a bitmap with an alpha channel
using (Bitmap bmp = new Bitmap(image.Width, image.Height, (PixelFormat) 
                                           PixelFormat32bppARGB))
{
  // copy the original image
  using(Graphics g = Graphics.FromImage(bmp))
  {
    g.DrawImage(image,0,0);
  }

  // Lock the bitmap's bits.  
  Rectangle rect = new Rectangle(0, 0, bmp.Width, bmp.Height);
  System.Drawing.Imaging.BitmapData bmpData =
  bmp.LockBits(rect, System.Drawing.Imaging.ImageLockMode.ReadWrite,
                            (PixelFormat)PixelFormat32bppARGB);

  // Get the address of the first line.
  IntPtr ptr = bmpData.Scan0;

  // Declare an array to hold the bytes of the bitmap.
  // This code is specific to a bitmap with 32 bits per pixels.
  int bytes = bmp.Width * bmp.Height * 4;
  byte[] argbValues = new byte[bytes];

  // Copy the ARGB values into the array.
  System.Runtime.InteropServices.Marshal.Copy(ptr, argbValues, 0, bytes);

  // Set every alpha value to the given transparency.  
  for (int counter = 3; counter < argbValues.Length; counter += 4)
                           argbValues[counter] = transparency;

  // Copy the ARGB values back to the bitmap
  System.Runtime.InteropServices.Marshal.Copy(argbValues, 0, ptr, bytes);

  // Unlock the bits.
  bmp.UnlockBits(bmpData);

  gx.DrawImage(bmp, x, y);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-14T23:40:28.597

抱歉，这并不能完全回答您的问题……但是您应该查看 .Net Compact Framework 的 UI 框架，它已经进行了 alpha 混合。

[http://code.msdn.microsoft.com/uiframework](http://code.msdn.microsoft.com/uiframework)

# ruby - 如何运行秒表程序？

> ID：858970
> 
> 赞同：1
> 
> 时间：2009-05-13T16:29:25.290
> 
> 标签：ruby, shoes

我从一个网站借了一些代码，但我不知道如何让它显示。

```
class Stopwatch
  def start
    @accumulated = 0 unless @accumulated
    @elapsed = 0
    @start = Time.now
    @mybutton.configure('text' => 'Stop')
    @mybutton.command { stop }
    @timer.start
  end

  def stop
    @mybutton.configure('text' => 'Start')
    @mybutton.command { start }
    @timer.stop
    @accumulated += @elapsed
  end

  def reset
    stop
    @accumulated, @elapsed = 0, 0
    @mylabel.configure('text' => '00:00:00.00.000')
  end

  def tick
    @elapsed = Time.now - @start
    time = @accumulated + @elapsed
    h = sprintf('%02i', (time.to_i / 3600))
    m = sprintf('%02i', ((time.to_i % 3600) / 60))
    s = sprintf('%02i', (time.to_i % 60))
    mt = sprintf('%02i', ((time - time.to_i)*100).to_i)
    ms = sprintf('%04i', ((time - time.to_i)*10000).to_i)
    ms[0..0]=''
    newtime = "#{h}:#{m}:#{s}.#{mt}.#{ms}"
    @mylabel.configure('text' => newtime)
  end
end 
```

我将如何让这个运行？谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-13T17:59:25.953

根据 rkneufeld 发布的附加代码，这个类需要一个特定于 Tk 的计时器。要在控制台上执行此操作，您可以创建一个循环调用 tick 一遍又一遍。当然，您必须删除所有与 GUI 相关的代码：

```
class Stopwatch
  def start
    @accumulated = 0 unless @accumulated
    @elapsed = 0
    @start = Time.now
#    @mybutton.configure('text' => 'Stop')
#    @mybutton.command { stop }
#    @timer.start
  end

  def stop
#    @mybutton.configure('text' => 'Start')
#    @mybutton.command { start }
#    @timer.stop
    @accumulated += @elapsed
  end

  def reset
    stop
    @accumulated, @elapsed = 0, 0
#    @mylabel.configure('text' => '00:00:00.00.000')
  end

  def tick
    @elapsed = Time.now - @start
    time = @accumulated + @elapsed
    h = sprintf('%02i', (time.to_i / 3600))
    m = sprintf('%02i', ((time.to_i % 3600) / 60))
    s = sprintf('%02i', (time.to_i % 60))
    mt = sprintf('%02i', ((time - time.to_i)*100).to_i)
    ms = sprintf('%04i', ((time - time.to_i)*10000).to_i)
    ms[0..0]=''
    newtime = "#{h}:#{m}:#{s}.#{mt}.#{ms}"
#    @mylabel.configure('text' => newtime)
  end
end

watch = Stopwatch.new
watch.start
1000000.times do
  puts watch.tick
end 
```

你最终会得到这样的输出：

```
00:00:00.00.000
00:00:00.00.000
00:00:00.00.000
...
00:00:00.00.000
00:00:00.00.000
00:00:00.01.160
00:00:00.01.160
... 
```

不是特别有用，但确实有。现在，如果你想在鞋子中做类似的事情，试试这个非常相似的[教程。](http://ruby.about.com/od/shoes/ss/shoes8.htm)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T16:50:48.373

我相信你已经在[这个网站上找到了这个例子](http://codeidol.com/other/rubyckbk/User-Interface/Creating-a-GUI-Application-with-Tk/)

我在重复网站上已有的内容，但您缺少：

```
require 'tk' 
```

以及初始化代码：

```
 def initialize
        root =  TkRoot.new { title 'Tk Stopwatch' }

        menu_spec = [
                     [
                      ['Program'],
                      ['Start', lambda { start } ],
                      ['Stop', lambda { stop } ],
                      ['Exit', lambda { exit } ]
                     ],
                     [
                      ['Reset'], ['Reset Stopwatch', lambda { reset } ]
                     ]
                    ]

        @menubar = TkMenubar.new(root, menu_spec, 'tearoff' => false)
        @menubar.pack('fill'=>'x', 'side'=>'top')

        @myfont = TkFont.new('size' => 16, 'weight' => 'bold')

        @mylabel = TkLabel.new(root)
        @mylabel.configure('text' => '00:00:00.0', 'font' => @myfont)
        @mylabel.pack('padx' => 10, 'pady' => 10)
        @mybutton =  TkButton.new(root)
        @mybutton.configure('text' => 'Start')
        @mybutton.command { start }
        @mybutton.pack('side'=>'left', 'fill' => 'both')

        @timer = TkAfter.new(1, -1, proc { tick })

        Tk.mainloop
      end
    end

    Stopwatch.new 
```

我建议阅读[网站](http://codeidol.com/other/rubyckbk/User-Interface/Creating-a-GUI-Application-with-Tk/)的其余部分以了解发生了什么。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-05-15T09:40:31.770

我正在寻找一个快速而肮脏的秒表类，以避免编写这样的代码，并找到了发布原始代码的网站和这个网站。

最后，我修改了代码，直到它符合我认为我最初搜索的内容。

如果有人感兴趣，到目前为止我最终使用的版本如下（尽管我还没有将它应用到我当前正在更新的应用程序中，并且我想使用这些功能）。

```
#    REFERENCES
#       1\. http://stackoverflow.com/questions/858970/how-to-get-a-stopwatch-program-running
#       2\. http://codeidol.com/other/rubyckbk/User-Interface/Creating-a-GUI-Application-with-Tk/
#       3\. http://books.google.com.au/books?id=bJkznhZBG6gC&pg=PA806&lpg=PA806&dq=ruby+stopwatch+class&source=bl&ots=AlH2e7oWWJ&sig=KLFR-qvNfBfD8WMrUEbVqMbN_4o&hl=en&ei=WRjOTbbNNo2-uwOkiZGwCg&sa=X&oi=book_result&ct=result&resnum=8&ved=0CEsQ6AEwBw#v=onepage&q=ruby%20stopwatch%20class&f=false
#       4\. http://4loc.wordpress.com/2008/09/24/formatting-dates-and-floats-in-ruby/

module Utilities
  class StopWatch
    def new()
      @watch_start_time = nil           #Time (in seconds) when the stop watch was started (i.e. the start() method was called).
      @lap_start_time   = nil           #Time (in seconds) when the current lap started.
    end  #def new

    def start()
      myCurrentTime = Time.now()        #Current time in (fractional) seconds since the Epoch (January 1, 1970 00:00 UTC)

      if (!running?) then    
        @watch_start_time = myCurrentTime         
        @lap_start_time   = @watch_start_time
      end  #if

      myCurrentTime - @watch_start_time;
    end  #def start

    def lap_time_seconds()
      myCurrentTime = Time.now()
      myLapTimeSeconds = myCurrentTime - @lap_start_time
      @lap_start_time  = myCurrentTime
      myLapTimeSeconds
    end  #def lap_time_seconds

    def stop()
      myTotalSecondsElapsed = Time.now() - @watch_start_time
      @watch_start_time = nil

      myTotalSecondsElapsed
    end  #def stop

    def running?()
      !@watch_start_time.nil?
    end  #def
  end  #class StopWatch
end  #module Utilities

def kill_time(aRepeatCount)
  aRepeatCount.times do
    #just killing time
  end  #do
end  #def kill_time

elapsed_time_format_string = '%.3f'

myStopWatch = Utilities::StopWatch.new()
puts 'total time elapsed: ' + elapsed_time_format_string % myStopWatch.start() + ' seconds'

kill_time(10000000)
puts 'lap time:           ' + elapsed_time_format_string % myStopWatch.lap_time_seconds() + ' seconds'

kill_time(20000000)
puts 'lap time:           ' + elapsed_time_format_string % myStopWatch.lap_time_seconds() + ' seconds'

kill_time(30000000)
puts 'lap time:           ' + elapsed_time_format_string % myStopWatch.lap_time_seconds() + ' seconds'
puts 'total time elapsed: ' + elapsed_time_format_string % myStopWatch.stop() + ' seconds' 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-05-13T20:14:43.793

简单的秒表脚本：

```
# pass the number of seconds as the parameter

seconds = eval(ARGV[0]).to_i
start_time = Time.now

loop do
  elapsed = Time.now - start_time
  print "\e[D" * 17
  print "\033[K"

  if elapsed > seconds
    puts "Time's up!"
    exit
  end

  print Time.at(seconds - elapsed).utc.strftime('%H:%M:%S.%3N')
  sleep(0.05)
end 
```

在终端中像这样运行（要标记一圈，只需点击 enter）：

```
# 10 is the number of seconds
ruby script.rb 10 
# you can even do this:
ruby script.rb "20*60" # 20 minutes 
```

# c++ - IAudioSessionNotification，有人有工作代码吗？

> ID：858974
> 
> 赞同：5
> 
> 时间：2009-05-13T16:30:04.430
> 
> 标签：c++, windows, com, windows-7, audio

既然我已经安装了 RC，我正在挑选一些我在 Windows 7 Beta 中搞砸的实验性代码。

`IAudioSessionManager2`基本上，我正在努力让`IAudioSessionNotification`我的小应用了解每个创建的新音频会话。

`AudioListener`（公共）中的关键代码[`IAudioSessionNotification`](http://msdn.microsoft.com/en-us/library/dd370969(VS.85).aspx)：

```
//This is mostly lifted from MSDN
HRESULT STDMETHODCALLTYPE AudioListener::QueryInterface(REFIID riid, void** ppvObject)
{
    if(riid == __uuidof(IUnknown))
    {
        *ppvObject = (IUnknown*)this;
        return S_OK;
    }

    if(riid == __uuidof(IAudioSessionNotification))
    {
        *ppvObject = (IAudioSessionNotification*)this;
        return S_OK;
    }

    *ppvObject = NULL;

    return E_NOINTERFACE;
}

//m_hwnd, and WM_SESSION_CREATED are set to good values
//WM_SESSION_CREATEd via RegisterWindowMessage(...)
HRESULT STDMETHODCALLTYPE AudioListener::OnSessionCreated(IAudioSessionControl *pSession)
{
    PostMessage(m_hwnd, WM_SESSION_CREATED, (WPARAM)pSession, 0);

    return S_OK;
} 
```

注册我的听众的代码：

```
BOOL RegisterMonitor(HWND target)
{
    BOOL success = false;

    HRESULT res;
    IMMDevice* pDevice;
    IMMDeviceEnumerator* pEnumerator;

    SESSION_LISTENER = NULL;
    SESSION = NULL;

    res = CoInitialize(NULL);

    if(res != S_OK && res != S_FALSE)
        return false;

    SESSION_LISTENER = new AudioListener(target);

    res = CoCreateInstance(__uuidof(MMDeviceEnumerator), NULL, CLSCTX_ALL, __uuidof(IMMDeviceEnumerator), (void**)&pEnumerator);
    if(res != S_OK)  goto Exit;

    res = pEnumerator->GetDefaultAudioEndpoint(eRender, eMultimedia, &pDevice);
    if(res != S_OK)  goto Exit;

    res = pDevice->Activate(__uuidof(IAudioSessionManager2), CLSCTX_ALL, NULL, (void**)&SESSION);
    if(res != S_OK)  goto Exit;

    res = SESSION->RegisterSessionNotification(SESSION_LISTENER);
    if(res != S_OK)  goto Exit;

    success = true;

Exit:
    SAFE_RELEASE(pEnumerator);
    SAFE_RELEASE(pDevice);
    if(!success)
    {
        SAFE_RELEASE(SESSION_LISTENER);
        SAFE_RELEASE(SESSION);
    }

    return success;
} 
```

`RegisterMonitor(...)`返回 true，但从未收到任何通知。我一直在通过启动具有轻微音效的小应用程序并触发它们（Soltaire、Minesweeper 等）进行测试，确认它们会在`SndVol`我期望看到通知时出现。

基本上，有没有人看到我做错了什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-14T04:41:16.710

您在`RegisterMonitor`函数中释放了会话管理器。一旦您释放对会话管理器的最后一个引用，它就会被释放，您将不再收到会话通知。

保持会话管理器对象处于活动状态，它应该可以正常工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2017-06-29T22:02:54.730

我遇到了同样的问题，我的解决方案是在调用 RegisterSessionNotification() 之后添加对 GetSessionEnumerator() 的调用

# c++ - C枚举不同的编译器

> ID：858977
> 
> 赞同：1
> 
> 时间：2009-05-13T16:30:16.737
> 
> 标签：c++, c, gcc, enums, mingw

我正在构建一个需要在 Windows 和 Linux 上编译的应用程序。该应用程序是用 C 编写的，除了 MinGW 编译器拒绝它之外，几乎所有东西都可以工作

```
typedef struct somestruct{
   ...snip...
   enum {NODE, REAL} type;
};

somestruct* something;
switch (something->type){
 case NODE:
   ...stuff...;
   break;
 case REAL:
   ...otherstuff...;
   break;
} 
```

它说 NODE 和 REAL 没有定义，但是如果我提供范围解析

```
case somestruct::NODE 
```

这可以使用 MinGW 3.4.1 编译，但无法在 linux 上使用 gcc 4.1.2 编译。这只是一个需要用预处理器解决的编译器问题还是有其他解释？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-14T03:48:49.943

该应用程序是用“C”编写的，但编译器要求您这样做`somestruct::NODE`，这是有效的“C++”，但不是有效的“C”。

结论：您在 C++ 模式下使用 MinGW 编译此代码，但在 C 模式下使用所有其他编译器。

可能的原因：MinGW 可能不一样，`foo.C`并且`foo.c`您的文件以大写 C 后缀命名（这意味着 UNIX 上的 C++）。

解决方案：向 MinGW 添加`-xc`标志以强制进行纯 C 编译。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T16:50:12.743

如果你摆脱了嵌套，它应该可以移植：

```
typedef enum somestruct_type {
    somestruct_type_NODE, somestruct_type_REAL
} somestruct_type;
typedef struct somestruct {
   ...snip...
   somestruct_type type;
} somestruct; 
```

我已经看到与此非常相似的代码被移植到大量 C 和 C++ 编译器。

（我并不是说这是唯一的方法；我只是说这种方法有效）。

# c# - 使用 Foreach 子句的 Lambda 表达式

> ID：858978
> 
> 赞同：51
> 
> 时间：2009-05-13T16:30:19.373
> 
> 标签：c#, .net-3.5, lambda, foreach

> **可能重复：**
> [为什么 IEnumerable 接口上没有 ForEach 扩展方法？](https://stackoverflow.com/questions/101265/why-is-there-not-a-foreach-extension-method-on-the-ienumerable-interface)

**编辑**

作为参考，这里是 eric 在评论中提到的博客文章

[https://ericlippert.com/2009/05/18/foreach-vs-foreach/](https://ericlippert.com/2009/05/18/foreach-vs-foreach/)

**原创**

我想更多的是一种好奇心，但对于 C# Specification Savants 来说……

为什么 ForEach() 子句不能（或不可用）用于 IQueryable/IEnumerable 结果集...

您必须首先将结果转换为 ToList() 或 ToArray() 大概 C# 迭代 IEnumerables Vs 的方式存在技术限制。列表...是否与 IEnumerables/IQerable 集合的延迟执行有关。例如

```
var userAgentStrings = uasdc.UserAgentStrings
    .Where<UserAgentString>(p => p.DeviceID == 0 && 
                            !p.UserAgentString1.Contains("msie"));
//WORKS            
userAgentStrings.ToList().ForEach(uas => ProcessUserAgentString(uas));         

//WORKS
Array.ForEach(userAgentStrings.ToArray(), uas => ProcessUserAgentString(uas));

//Doesn't WORK
userAgentStrings.ForEach(uas => ProcessUserAgentString(uas)); 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-13T16:42:00.837

完全可以`ForEach`为`IEnumerable<T>`.

我不太确定为什么它不作为内置扩展方法包含在内：

*   也许是因为在 LINQ 之前和之前`ForEach`已经存在。`List<T>``Array`
*   `foreach`也许是因为使用循环来迭代序列很容易。
*   可能是因为感觉功能/LINQy 不够。
*   也许是因为它不可链接。`yield`（在执行操作后制作每个项目的可链接版本很容易，但这种行为并不是特别直观。）

* * *

```
public static void ForEach<T>(this IEnumerable<T> source, Action<T> action)
{
    if (source == null) throw new ArgumentNullException("source");
    if (action == null) throw new ArgumentNullException("action");

    foreach (T item in source)
    {
        action(item);
    }
} 
```

# java - Java中的文件到字节[]

> ID：858980
> 
> 赞同：871
> 
> 时间：2009-05-13T16:30:33.773
> 
> 标签：java, file-io

如何将 a 转换`java.io.File`为 a `byte[]`？

* * *

## 回答 #1

> 赞同：1433
> 
> 时间：2011-02-22T20:36:18.740

从**JDK 7**开始，您可以使用[`Files.readAllBytes(Path)`](http://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#readAllBytes(java.nio.file.Path)).

例子：

```
import java.io.File;
import java.nio.file.Files;

File file;
// ...(file is initialised)...
byte[] fileContent = Files.readAllBytes(file.toPath()); 
```

* * *

## 回答 #2

> 赞同：563
> 
> 时间：2009-05-13T16:48:21.483

这取决于对您来说最好的方式。提高生产力，不要重新发明轮子并使用 Apache Commons。这是在这里[`FileUtils.readFileToByteArray(File input)`](https://commons.apache.org/proper/commons-io/javadocs/api-2.5/org/apache/commons/io/FileUtils.html#readFileToByteArray(java.io.File))。

* * *

## 回答 #3

> 赞同：304
> 
> 时间：2015-07-02T13:47:22.440

从 JDK 7 开始 - 一个班轮：

```
byte[] array = Files.readAllBytes(Paths.get("/path/to/file")); 
```

不需要外部依赖。

* * *

## 回答 #4

> 赞同：170
> 
> 时间：2011-12-08T13:57:11.693

```
import java.io.RandomAccessFile;
RandomAccessFile f = new RandomAccessFile(fileName, "r");
byte[] b = new byte[(int)f.length()];
f.readFully(b); 
```

Java 8 文档： http: [//docs.oracle.com/javase/8/docs/api/java/io/RandomAccessFile.html](http://docs.oracle.com/javase/8/docs/api/java/io/RandomAccessFile.html)

* * *

## 回答 #5

> 赞同：83
> 
> 时间：2009-05-13T17:13:27.290

基本上你必须在内存中阅读它。打开文件，分配数组，将文件中的内容读入数组。

最简单的方法与此类似：

```
public byte[] read(File file) throws IOException, FileTooBigException {
    if (file.length() > MAX_FILE_SIZE) {
        throw new FileTooBigException(file);
    }
    ByteArrayOutputStream ous = null;
    InputStream ios = null;
    try {
        byte[] buffer = new byte[4096];
        ous = new ByteArrayOutputStream();
        ios = new FileInputStream(file);
        int read = 0;
        while ((read = ios.read(buffer)) != -1) {
            ous.write(buffer, 0, read);
        }
    }finally {
        try {
            if (ous != null)
                ous.close();
        } catch (IOException e) {
        }

        try {
            if (ios != null)
                ios.close();
        } catch (IOException e) {
        }
    }
    return ous.toByteArray();
} 
```

这对文件内容进行了一些不必要的复制（实际上数据被复制了三次：从文件到`buffer`，从`buffer`到`ByteArrayOutputStream`，从`ByteArrayOutputStream`到实际结果数组）。

您还需要确保仅在内存中读取特定大小的文件（这通常取决于应用程序）:-)。

您还需要处理`IOException`函数外部。

另一种方式是这样的：

```
public byte[] read(File file) throws IOException, FileTooBigException {
    if (file.length() > MAX_FILE_SIZE) {
        throw new FileTooBigException(file);
    }

    byte[] buffer = new byte[(int) file.length()];
    InputStream ios = null;
    try {
        ios = new FileInputStream(file);
        if (ios.read(buffer) == -1) {
            throw new IOException(
                    "EOF reached while trying to read the whole file");
        }
    } finally {
        try {
            if (ios != null)
                ios.close();
        } catch (IOException e) {
        }
    }
    return buffer;
} 
```

这没有不必要的复制。

`FileTooBigException`是自定义应用程序异常。`MAX_FILE_SIZE`常量是一个应用参数。

对于大文件，您可能应该考虑使用流处理算法或使用内存映射（请参阅 参考资料`java.nio`）。

* * *

## 回答 #6

> 赞同：77
> 
> 时间：2009-05-13T17:08:35.413

正如有人所说，[Apache Commons File Utils](https://commons.apache.org/proper/commons-io/apidocs/org/apache/commons/io/FileUtils.html)可能有你正在寻找的东西

```
public static byte[] readFileToByteArray(File file) throws IOException 
```

示例使用 ( `Program.java`)：

```
import org.apache.commons.io.FileUtils;
public class Program {
    public static void main(String[] args) throws IOException {
        File file = new File(args[0]);  // assume args[0] is the path to file
        byte[] data = FileUtils.readFileToByteArray(file);
        ...
    }
} 
```

* * *

## 回答 #7

> 赞同：27
> 
> 时间：2016-07-06T23:06:51.777

如果您没有 Java 8，并且同意我的观点，那么包含一个庞大的库以避免编写几行代码是一个坏主意：

```
public static byte[] readBytes(InputStream inputStream) throws IOException {
    byte[] b = new byte[1024];
    ByteArrayOutputStream os = new ByteArrayOutputStream();
    int c;
    while ((c = inputStream.read(b)) != -1) {
        os.write(b, 0, c);
    }
    return os.toByteArray();
} 
```

调用者负责关闭流。

* * *

## 回答 #8

> 赞同：24
> 
> 时间：2009-05-13T16:57:43.447

您也可以使用 NIO api 来执行此操作。只要文件总大小（以字节为单位）适合 int，我就可以使用此代码执行此操作。

```
File f = new File("c:\\wscp.script");
FileInputStream fin = null;
FileChannel ch = null;
try {
    fin = new FileInputStream(f);
    ch = fin.getChannel();
    int size = (int) ch.size();
    MappedByteBuffer buf = ch.map(MapMode.READ_ONLY, 0, size);
    byte[] bytes = new byte[size];
    buf.get(bytes);

} catch (IOException e) {
    // TODO Auto-generated catch block
    e.printStackTrace();
} finally {
    try {
        if (fin != null) {
            fin.close();
        }
        if (ch != null) {
            ch.close();
        }
    } catch (IOException e) {
        e.printStackTrace();
    }
} 
```

我认为它非常快，因为它使用了 MappedByteBuffer。

* * *

## 回答 #9

> 赞同：23
> 
> 时间：2009-05-13T16:32:22.990

```
// Returns the contents of the file in a byte array.
    public static byte[] getBytesFromFile(File file) throws IOException {        
        // Get the size of the file
        long length = file.length();

        // You cannot create an array using a long type.
        // It needs to be an int type.
        // Before converting to an int type, check
        // to ensure that file is not larger than Integer.MAX_VALUE.
        if (length > Integer.MAX_VALUE) {
            // File is too large
            throw new IOException("File is too large!");
        }

        // Create the byte array to hold the data
        byte[] bytes = new byte[(int)length];

        // Read in the bytes
        int offset = 0;
        int numRead = 0;

        InputStream is = new FileInputStream(file);
        try {
            while (offset < bytes.length
                   && (numRead=is.read(bytes, offset, bytes.length-offset)) >= 0) {
                offset += numRead;
            }
        } finally {
            is.close();
        }

        // Ensure all the bytes have been read in
        if (offset < bytes.length) {
            throw new IOException("Could not completely read file "+file.getName());
        }
        return bytes;
    } 
```

* * *

## 回答 #10

> 赞同：23
> 
> 时间：2017-02-23T13:19:23.087

**简单的方法：**

```
File fff = new File("/path/to/file");
FileInputStream fileInputStream = new FileInputStream(fff);

// int byteLength = fff.length(); 

// In android the result of file.length() is long
long byteLength = fff.length(); // byte count of the file-content

byte[] filecontent = new byte[(int) byteLength];
fileInputStream.read(filecontent, 0, (int) byteLength); 
```

* * *

## 回答 #11

> 赞同：20
> 
> 时间：2014-01-23T08:59:17.747

从文件中读取字节的最简单方法

```
import java.io.*;

class ReadBytesFromFile {
    public static void main(String args[]) throws Exception {
        // getBytes from anyWhere
        // I'm getting byte array from File
        File file = null;
        FileInputStream fileStream = new FileInputStream(file = new File("ByteArrayInputStreamClass.java"));

        // Instantiate array
        byte[] arr = new byte[(int) file.length()];

        // read All bytes of File stream
        fileStream.read(arr, 0, arr.length);

        for (int X : arr) {
            System.out.print((char) X);
        }
    }
} 
```

* * *

## 回答 #12

> 赞同：15
> 
> 时间：2013-04-17T15:12:02.630

Guava 有[Files.toByteArray()](http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/io/Files.html#toByteArray%28java.io.File%29)可以提供给你。它有几个优点：

1.  它涵盖了文件报告长度为 0 但仍有内容的极端情况
2.  它经过高度优化，如果在尝试加载文件之前尝试读取大文件，则会收到 OutOfMemoryException。（通过巧妙地使用 file.length()）
3.  您不必重新发明轮子。

* * *

## 回答 #13

> 赞同：13
> 
> 时间：2016-09-02T15:55:06.630

```
import java.io.File;
import java.nio.file.Files;
import java.nio.file.Path;

File file = getYourFile();
Path path = file.toPath();
byte[] data = Files.readAllBytes(path); 
```

* * *

## 回答 #14

> 赞同：11
> 
> 时间：2012-02-24T13:00:22.123

使用与社区 wiki 答案相同的方法，但更简洁且开箱即用（如果您不想导入 Apache Commons 库，则首选方法，例如在 Android 上）：

```
public static byte[] getFileBytes(File file) throws IOException {
    ByteArrayOutputStream ous = null;
    InputStream ios = null;
    try {
        byte[] buffer = new byte[4096];
        ous = new ByteArrayOutputStream();
        ios = new FileInputStream(file);
        int read = 0;
        while ((read = ios.read(buffer)) != -1)
            ous.write(buffer, 0, read);
    } finally {
        try {
            if (ous != null)
                ous.close();
        } catch (IOException e) {
            // swallow, since not that important
        }
        try {
            if (ios != null)
                ios.close();
        } catch (IOException e) {
            // swallow, since not that important
        }
    }
    return ous.toByteArray();
} 
```

* * *

## 回答 #15

> 赞同：8
> 
> 时间：2014-04-03T12:04:29.473

我相信这是最简单的方法：

```
org.apache.commons.io.FileUtils.readFileToByteArray(file); 
```

* * *

## 回答 #16

> 赞同：7
> 
> 时间：2015-04-16T08:13:32.317

**ReadFully**从此文件中读取 b.length 个字节到字节数组中，从当前文件指针开始。此方法从文件中重复读取，直到读取请求的字节数。此方法会一直阻塞，直到读取到请求的字节数、检测到流的结尾或引发异常。

```
RandomAccessFile f = new RandomAccessFile(fileName, "r");
byte[] b = new byte[(int)f.length()];
f.readFully(b); 
```

* * *

## 回答 #17

> 赞同：7
> 
> 时间：2021-03-24T09:02:23.873

这是最简单的方法之一

```
 String pathFile = "/path/to/file";
 byte[] bytes = Files.readAllBytes(Paths.get(pathFile )); 
```

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2012-10-12T21:03:10.327

如果您想将字节读入预先分配的字节缓冲区，这个答案可能会有所帮助。

您的第一个猜测可能是使用[`InputStream read(byte[])`](http://docs.oracle.com/javase/6/docs/api/java/io/InputStream.html#read%28byte%5b%5d%29). 但是，这种方法有一个缺陷，使用起来非常困难：即使没有遇到 EOF，也不能保证数组实际上会被完全填满。

相反，看看[`DataInputStream readFully(byte[])`](http://docs.oracle.com/javase/6/docs/api/java/io/DataInputStream.html#readFully%28byte%5b%5d%29). 这是输入流的包装器，不存在上述问题。此外，遇到 EOF 时会抛出此方法。好多了。

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2018-04-09T13:38:22.687

以下方法不仅将 java.io.File 转换为 byte[]，而且在测试许多不同的[Java 文件读取方法](https://funnelgarden.com/java_read_file/)时，我还发现它是读取文件的最快方法：

java.nio.file.Files.readAllBytes()

```
import java.io.File;
import java.io.IOException;
import java.nio.file.Files;

public class ReadFile_Files_ReadAllBytes {
  public static void main(String [] pArgs) throws IOException {
    String fileName = "c:\\temp\\sample-10KB.txt";
    File file = new File(fileName);

    byte [] fileBytes = Files.readAllBytes(file.toPath());
    char singleChar;
    for(byte b : fileBytes) {
      singleChar = (char) b;
      System.out.print(singleChar);
    }
  }
} 
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2009-05-13T18:09:22.380

让我在不使用第三方库的情况下添加另一个解决方案。它重用了[Scott](https://stackoverflow.com/users/12541/scott-stanchfield) ([链接](https://stackoverflow.com/questions/857913/why-would-i-care-about-ioexceptions-when-a-file-is-closed/858004#858004)) 提出的异常处理模式。我将丑陋的部分移到了单独的消息中（我会隐藏在一些 FileUtils 类中；））

```
public void someMethod() {
    final byte[] buffer = read(new File("test.txt"));
}

private byte[] read(final File file) {
    if (file.isDirectory())
        throw new RuntimeException("Unsupported operation, file "
                + file.getAbsolutePath() + " is a directory");
    if (file.length() > Integer.MAX_VALUE)
        throw new RuntimeException("Unsupported operation, file "
                + file.getAbsolutePath() + " is too big");

    Throwable pending = null;
    FileInputStream in = null;
    final byte buffer[] = new byte[(int) file.length()];
    try {
        in = new FileInputStream(file);
        in.read(buffer);
    } catch (Exception e) {
        pending = new RuntimeException("Exception occured on reading file "
                + file.getAbsolutePath(), e);
    } finally {
        if (in != null) {
            try {
                in.close();
            } catch (Exception e) {
                if (pending == null) {
                    pending = new RuntimeException(
                        "Exception occured on closing file" 
                             + file.getAbsolutePath(), e);
                }
            }
        }
        if (pending != null) {
            throw new RuntimeException(pending);
        }
    }
    return buffer;
}
```

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2012-11-12T11:33:27.077

```
public static byte[] readBytes(InputStream inputStream) throws IOException {
    byte[] buffer = new byte[32 * 1024];
    int bufferSize = 0;
    for (;;) {
        int read = inputStream.read(buffer, bufferSize, buffer.length - bufferSize);
        if (read == -1) {
            return Arrays.copyOf(buffer, bufferSize);
        }
        bufferSize += read;
        if (bufferSize == buffer.length) {
            buffer = Arrays.copyOf(buffer, bufferSize * 2);
        }
    }
} 
```

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2020-05-14T04:50:23.923

```
//The file that you wanna convert into byte[]
File file=new File("/storage/0CE2-EA3D/DCIM/Camera/VID_20190822_205931.mp4"); 

FileInputStream fileInputStream=new FileInputStream(file);
byte[] data=new byte[(int) file.length()];
BufferedInputStream bufferedInputStream=new BufferedInputStream(fileInputStream);
bufferedInputStream.read(data,0,data.length);

//Now the bytes of the file are contain in the "byte[] data" 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2014-11-25T10:24:34.047

从文件中读取字节的另一种方法

```
Reader reader = null;
    try {
        reader = new FileReader(file);
        char buf[] = new char[8192];
        int len;
        StringBuilder s = new StringBuilder();
        while ((len = reader.read(buf)) >= 0) {
            s.append(buf, 0, len);
            byte[] byteArray = s.toString().getBytes();
        }
    } catch(FileNotFoundException ex) {
    } catch(IOException e) {
    }
    finally {
        if (reader != null) {
            reader.close();
        }
    } 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2019-02-04T15:20:33.873

尝试这个 ：

```
import sun.misc.IOUtils;
import java.io.IOException;

try {
    String path="";
    InputStream inputStream=new FileInputStream(path);
    byte[] data=IOUtils.readFully(inputStream,-1,false);
}
catch (IOException e) {
    System.out.println(e);
} 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2020-08-31T12:31:59.497

可以这么简单（Kotlin 版本）

```
val byteArray = File(path).inputStream().readBytes() 
```

**编辑**：

我已经阅读了`readBytes`方法文档。它说：

> 将此流完全读入字节数组。 **注意**：关闭此流是调用者的责任。

因此，为了能够关闭流，同时保持一切清洁，请使用以下代码：

```
val byteArray = File(path).inputStream().use { it.readBytes() } 
```

感谢@user2768856 指出这一点。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2021-07-09T16:38:08.520

如果您的目标版本低于 26 API，请尝试此操作

```
 private static byte[] readFileToBytes(String filePath) {

    File file = new File(filePath);
    byte[] bytes = new byte[(int) file.length()];

    // funny, if can use Java 7, please uses Files.readAllBytes(path)
    try(FileInputStream fis = new FileInputStream(file)){
        fis.read(bytes);
        return bytes;
    } catch (FileNotFoundException e) {
        e.printStackTrace();
    } catch (IOException e) {
        e.printStackTrace();
    }
    return null;

} 
```

* * *

## 回答 #27

> 赞同：-7
> 
> 时间：2019-01-17T14:51:41.300

在**JDK8中**

```
Stream<String> lines = Files.lines(path);
String data = lines.collect(Collectors.joining("\n"));
lines.close(); 
```

# c# - 当泛型不可用时尝试获得泛型

> ID：858987
> 
> 赞同：2
> 
> 时间：2009-05-13T16:31:53.520
> 
> 标签：c#, linq, generics, lambda

我正在尝试开发一些通用的自定义 ValidationAttributes。无法创建属性的通用子类这一事实让我发疯了。

这是我在 ValidationAttribute 中用于 IsValid 覆盖的代码，以验证属性的值是否唯一：

```
 public override bool IsValid(object value)
    {
        SomeDataContext context = SomeDataContext.GetNewDataContext();
        Type tableType = typeof(Table<>).MakeGenericType(new Type[] { _EntityType });
        var table = Activator.CreateInstance(tableType);
        //ITable table = context.GetTable(_EntityType);
        var codeProp = (from member in context.Mapping.GetMetaType(_EntityType).DataMembers
                        where member.Name == _PropertyName
                        select member.Member).Single();
        ParameterExpression param = Expression.Parameter(_EntityType, "x");
        MemberExpression memberExp = Expression.Property(param, (PropertyInfo)codeProp); 
        Expression body = Expression.Equal(memberExp, Expression.Constant(value, typeof(char)));
        //var predicate = Expression.Lambda<Func<TEntityType, bool>>(body, param);
        Type lambdaType = typeof(Func<,>).MakeGenericType(_EntityType, typeof(bool));
        var predicate = Expression.Lambda(lambdaType, body, param);
        object code = table.FirstOrDefault(predicate);
        if (code != null)
        {
            return false;
        }
        return true;
    } 
```

这一行：

对象代码 = table.FirstOrDefault(predicate);

错误：

“object”不包含“FirstOrDefault”的定义，也没有扩展名......等。

如何定义、强制转换或以其他方式让编译器将“表”识别为公开 .FirstOrDefault 方法的东西？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T16:39:17.863

> 如何定义、强制转换或以其他方式让编译器将“表”识别为公开 .FirstOrDefault 方法的东西？

通过对某事使用显式强制转换`IEnumerable<>`。由于您不知道案例中的“某事”，因此您实际上无法使用`FirstOrDefault`. 只需自己实现逻辑：

```
var enumerator = ((IEnumerable)table).GetEnumerator();
object code = enumerator.MoveNext() ? enumerator.Value : null; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T16:56:04.417

这将使您获得 System.Linq.Enumerable 可以使用的类型：

```
IEnumerable<object> tableGeneric =
  ((IEnumerable)table).OfType<object>(); 
```

三个担忧：

1.  不要过多地使用 var - 你会忘记你的类型。
2.  我不确定在 FirstOrDefault 调用中使用您的谓词 - 我看不到编译器如何对它进行类型检查。 [http://msdn.microsoft.com/en-us/library/bb299425.aspx](http://msdn.microsoft.com/en-us/library/bb299425.aspx)
3.  如果你让谓词工作， .Any() 可能是比 .FirstOrDefault() 更好的选择

# f# - F# 中“>>”运算符的语义

> ID：858989
> 
> 赞同：3
> 
> 时间：2009-05-13T16:32:07.297
> 
> 标签：f#, operators, semantics

在 Microsoft 的[F# 示例中](http://go.microsoft.com/fwlink/?LinkID=124614)，它们使用“>>”运算符，如下所示：

```
test |> Seq.iter (any_to_string >> printfn "line %s"); 
```

“>>”运算符在这种情况下做了什么？序列的每个项目（在这种情况下是一个数组）是否被`any_to_string`隐式传递给？这类似于`(fun item -> printfn "line %A" item)`吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-13T17:01:25.703

`(>>)`是一个高阶函数，它接受两个函数（具有兼容的参数）并将它们组合（“组合”）为一个函数。

例如与

```
let len (s : string) = s.Length
let show (n : int) = n.ToString() 
```

线

```
(show >> len) 15 
```

相当于

```
len (show 15) 
```

也

```
show 15 |> len 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-13T16:53:47.603

定义在

[http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/FSharp.Core/Microsoft.FSharp.Core.Operators.html](http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/FSharp.Core/Microsoft.FSharp.Core.Operators.html)

说

```
val ( >> ) : ('a -> 'b) -> ('b -> 'c) -> ('a -> 'c)
//Compose two functions, the function on the left being applied first 
```

但我希望其他人能提供更深入的解释。

编辑

MSDN 文档现在在

[http://msdn.microsoft.com/en-us/library/ee353825(VS.100).aspx](http://msdn.microsoft.com/en-us/library/ee353825(VS.100).aspx)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-13T16:59:41.807

可以通过以下方式编写等效的代码：

```
 test |> Seq.iter(fun x -> printfn "line %s" (any_to_string x)) 
```

换句话说，>> 运算符只是这样做：给定一个函数 f(x) 返回类型 T 和 g(y)，其中 y 是类型 T，你可以使用 f >> g 创建一个函数 h(z)相当于 g(f(x))。没有参数，但必须将内部和外部函数传递给该运算符，结果是一个可以随时在您的代码中应用的函数，因此您可以这样做：

```
 //myFunc accepts any object, calls its ToString method, passes ToString
//result to the lambda which returns the string length. no argument is
//specified in advance
let myFunc = any_to_string >> (fun s -> s.Length)
let test = 12345
let f = 12345.0
//now we can call myFunc just like if we had definied it this way:
//let myFunc (x:obj) = obj.ToString().Length
printfn "%i" (myFunc i)
printfn "%i" (myFunc f) 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-13T17:06:55.603

这是一个函数组合运算符（如其他帖子中所述）

您可以自己定义此运算符以查看其语义：

```
let (>>) f g = fun x -> g (f x) 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-14T08:05:26.330

如果您对 C#、泛型或 lambdas 感到不舒服，这可能根本没有帮助，但这里有一个 C# 中的等价物：

```
//Takes two functions, returns composed one
public static Func<T1, T2> Compose<T1, T2, T3>(this Func<T1, T2> f, Func<T2, T3> g)
{
    return (x) => g(f(x));
} 
```

查看类型参数的内容类似于 Brian 的回答：

Compose 采用一个从 T1 到 T2 的函数，另一个从 T2 到 T3 的函数，并返回从 T1 到 T3 的两者的组合。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-13T16:59:14.583

[运算符执行功能组合，这在 Wikipedia 上](https://secure.wikimedia.org/wikipedia/en/wiki/Function_composition)`>>`有很好的解释。[Dustin Campbell 提供了一个很好的用途，并在他的博客上](http://diditwith.net/2008/05/06/YAPESProblemSix.aspx)解释了它（连同（正向管道）运算符）。`|>`

# css - 如何将 CSS 定位到特定的共享点页面布局文件？

> ID：858990
> 
> 赞同：6
> 
> 时间：2009-05-13T16:32:16.877
> 
> 标签：css, sharepoint, page-layout

是否可以为我开发的每个 SharePoint 页面布局创建一个 .CSS 文件，或者是否需要在母版页中引用母版页中每个可能布局的 CSS？

IE 是否可能影响`<head>`使用页面布局的页面？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-06-19T00:18:39.937

通过在布局页面的 PlaceHolderAdditionalPageHead 内容占位符标签中包含任何链接等，可以进一步增强 Michal 的解决方案。这样，它将正确地包含在生成页面的头部。

例如

```
<asp:Content ContentPlaceholderID="PlaceHolderAdditionalPageHead" runat="server">
   <link id="Link1" href="<% $SPUrl:~SiteCollection/Style Library/mystyle.css%>" runat="server" type="text/css" rel="stylesheet" />
   <SharePoint:ScriptLink id="jQueryCore" language="javascript" name="ui.core.js" runat="server"/>
</asp:Content> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-13T18:52:14.870

您可以通过在页面布局中放置标签来嵌入要在页面布局中使用的 CSS。例如：

```
<style type="text/css">
    .ms-pagetitle, .ms-titlearea
    {
        margin-bottom: 5px;
    }

</style> 
```

或者在页面布局中，您还可以创建一个指向您想要使用的 CSS 文件的相对链接：

```
<link rel="stylesheet" type="text/css" href="/_layouts/styles/mystyle.css"/> 
```

通过这种方式，您可以在您使用的页面布局中覆盖不同的 css 样式。希望有帮助！

# visual-studio-2008 - 在 windows 上调试 xsp

> ID：858996
> 
> 赞同：2
> 
> 时间：2009-05-13T16:32:53.537
> 
> 标签：visual-studio-2008, mono, xsp

是否可以在 windows 上调试在 xsp 下运行的网站？如果可能的话，我想附加到 Visual Studio 的流程。

我修改了我的 xsp2.bat 文件以启用调试 @"C:\PROGRA~1\Mono-2.4\bin\mono.exe" --debug=mdb-optimizations "C:\PROGRA~1\Mono-2.4\lib\单声道\2.0\winhack\xsp2.exe" %*

但这似乎没有帮助。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-14T15:46:07.127

看起来此功能即将从 Novell 推出。 [用于 Visual Studio 的单声道工具](http://visualstudiohacks.com/blog/visual-studio-and-mono-at-teched/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T18:15:02.183

不，你不能这样做，mono-debug 只是 linux ..（在 %Program Files/Mono-2.4/bin 文件夹中甚至没有 mdb.exe）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-06T10:36:26.930

正如 balint 指出的那样，mdb 调试器仅适用于 Linux。但是，您应该能够使用[SoftDebugger](http://www.mono-project.com/Sdb)。*****