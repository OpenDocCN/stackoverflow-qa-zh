# StackOverflow 问答 000187000-000187999

# asp.net - 大文件下载 - 连接服务器重置

> ID：187000
> 
> 赞同：3
> 
> 时间：2008-10-09T12:18:42.577
> 
> 标签：asp.net, download

我有一个 asp.net 网站，允许用户下载较大的文件 - 30mb 到大约 60mb。有时下载工作正常，但通常在下载完成之前的某个不同点失败，并显示与服务器的连接已重置的消息。

最初我只是简单地使用 Server.TransmitFile 但在阅读了一下之后我现在正在使用下面发布的代码。我还在 Page_Init 事件中将 Server.ScriptTimeout 值设置为 3600。

```
private void DownloadFile(string fname, bool forceDownload)
        {
            string path = MapPath(fname);
            string name = Path.GetFileName(path);
            string ext = Path.GetExtension(path);
            string type = "";

            // set known types based on file extension  

            if (ext != null)
            {
                switch (ext.ToLower())
                {
                    case ".mp3":
                        type = "audio/mpeg";
                        break;

                    case ".htm":
                    case ".html":
                        type = "text/HTML";
                        break;

                    case ".txt":
                        type = "text/plain";
                        break;

                    case ".doc":
                    case ".rtf":
                        type = "Application/msword";
                        break;
                }
            }

            if (forceDownload)
            {
                Response.AppendHeader("content-disposition",
                    "attachment; filename=" + name.Replace(" ", "_"));
            }

            if (type != "")
            {
                Response.ContentType = type;
            }
            else
            {
                Response.ContentType = "application/x-msdownload";
            }

            System.IO.Stream iStream = null;

            // Buffer to read 10K bytes in chunk:
            byte[] buffer = new Byte[10000];

            // Length of the file:
            int length;

            // Total bytes to read:
            long dataToRead;

            try
            {
                // Open the file.
                iStream = new System.IO.FileStream(path, System.IO.FileMode.Open,
                            System.IO.FileAccess.Read, System.IO.FileShare.Read);

                // Total bytes to read:
                dataToRead = iStream.Length;

                //Response.ContentType = "application/octet-stream";
                //Response.AddHeader("Content-Disposition", "attachment; filename=" + filename);

                // Read the bytes.
                while (dataToRead > 0)
                {
                    // Verify that the client is connected.
                    if (Response.IsClientConnected)
                    {
                        // Read the data in buffer.
                        length = iStream.Read(buffer, 0, 10000);

                        // Write the data to the current output stream.
                        Response.OutputStream.Write(buffer, 0, length);

                        // Flush the data to the HTML output.
                        Response.Flush();

                        buffer = new Byte[10000];
                        dataToRead = dataToRead - length;
                    }
                    else
                    {
                        //prevent infinite loop if user disconnects
                        dataToRead = -1;
                    }
                }
            }
            catch (Exception ex)
            {
                // Trap the error, if any.
                Response.Write("Error : " + ex.Message);
            }
            finally
            {
                if (iStream != null)
                {
                    //Close the file.
                    iStream.Close();
                }
                Response.Close();
            }

        } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-09T12:26:09.003

将要

```
<configuration>
  <system.web>
    <httpRuntime executionTimeout="3600"/>
  </system.web>
</configuration> 
```

有什么帮助吗？

写入数据的内部循环似乎有点复杂，我至少会将其更改为：

```
int length;
while(  Response.IsClientConnected && 
       (length=iStream.Read(buffer,0,buffer.Length))>0 ) 
{
  Response.OutputStream.Write(buffer,0,length);
  Response.Flush();
} 
```

无需通过循环在每一轮重新分配缓冲区，您可以在将其写入输出后简单地重新使用它。

进一步的改进是使用异步 IO，但那是另一天。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-05-19T15:37:43.063

当我使用 FileUpload Control 并且上传文件大小 >4MB 时，我遇到了类似的问题。我曾经收到“连接已重置”错误页面。这是我解决问题所遵循的步骤：

转到 web.config 文件并设置适合您希望上传的文件类型的大小限制。默认大小限制为 4096 千字节 (KB) 或 4 兆字节 (MB)。您可以通过设置 httpRuntime 元素的 maxRequestLength 属性来允许上传较大的文件。要增加整个应用程序的最大允许文件大小，请在 Web.config 文件中设置 maxRequestLength 属性。

例如允许 10MB (10240 KB) 文件..我使用 (REPLACE '[' with '<' and ']' with '>')

[configuration]
[system.web]
[httpRuntime maxRequestLength="10240"/]
[ /system.web]
[/配置]

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-04T01:19:53.103

此问题的最终修复是在 web.config 文件中进行修改。我只需将 sessionState mode="InProc" 更改为 sessionState mode="StateServer"。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-10-12T14:33:55.993

最终为我工作的是执行 Response.End 并使用文件流执行 using 语句。这是我拥有的代码：

```
public partial class ssl_Report_StreamReport : BaseReportPage
{
    protected void Page_Load(object sender, EventArgs e)
    {
        //Get the parameters
        string reportName = Utils.ParseStringRequest(Request, "reportName") ?? string.Empty;
        string reportGuid = Session["reportGuid"].ToString();
        string path = Path.Combine(ReportPath(), Utils.GetSessionReportName(reportName, reportGuid));

        using (var fileStream = File.Open(path, FileMode.Open))
        {
            Response.ClearHeaders();
            Response.Clear();
            Response.ContentType = "application/octet-stream";
            Response.AddHeader("Content-Disposition", "attachment; filename=\"" + reportName + "\"");
            Response.AddHeader("Content-Length", fileStream.Length.ToString(CultureInfo.InvariantCulture));
            StreamHelper.CopyStream(fileStream, Response.OutputStream);
            Response.Flush();
            Response.End();
        }

        ReportProcessor.ClearReport(Session.SessionID, path);
    }
}

public static class StreamHelper
{
    public static void CopyStream(Stream input, Stream output)
    {
        byte[] buffer = new byte[32768];
        int read;
        while ((read = input.Read(buffer, 0, buffer.Length)) > 0)
        {
            output.Write(buffer, 0, read);
        }
    }
} 
```

# wcf - WCF 自定义 Http 代理身份验证

> ID：187001
> 
> 赞同：5
> 
> 时间：2008-10-09T12:18:44.247
> 
> 标签：wcf, authentication, proxy

是否可以为 WCF 提供自定义代理地址和自定义凭据？

我在 stackoverflow 上找到了这个答案：[如何使用凭据设置代理到生成的 WCF 客户端？](https://stackoverflow.com/questions/105499/how-to-set-proxy-with-credentials-to-generated-wcf-client)，但我有一个复杂的问题，我正在验证的服务使用自己的身份验证，所以我必须使用两组凭据（一组通过代理，另一组通过服务进行身份验证）

我正在使用另一个问题的答案中描述的技术来提供服务凭据。例如

```
client.ClientCredentials.UserName.UserName = username;
client.ClientCredentials.UserName.Password = password; 
```

我可以使用以下方式设置代理的地址：

```
(client.Endpoint.Binding as WSHttpBinding).ProxyAddress = ...; 
```

如何设置有效的两组凭据？（注意：代理和实际服务的凭据不同！）还要注意，代理详细信息不一定是默认系统代理详细信息。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2010-01-21T18:05:33.530

如果将[WebRequest.DefaultWebProxy](http://msdn.microsoft.com/en-us/library/system.net.webrequest.defaultwebproxy.aspx)属性设置为具有凭据的新 WebProxy，WCF 将使用它来处理它发出的所有 HTTP 请求。（这将影响应用程序使用的所有 HttpWebRequest，除非显式覆盖）。

```
// get this information from the user / config file / etc.
Uri proxyAddress;
string userName;
string password;

// set this before any web requests or WCF calls
WebRequest.DefaultWebProxy = new WebProxy(proxyAddress)
{
    Credentials = new NetworkCredential(userName, password),
}; 
```

我[关于代理服务器的博文](http://code.logos.com/blog/2010/01/using_http_proxy_servers.html)包含更多详细信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T13:02:08.153

您设置的客户端凭据很好，以便对您的服务进行身份验证。
对于代理身份验证，您需要使用 HttpTransportSecurity.ProxyCredentials。

这个链接可能会帮助你。

[http://msdn.microsoft.com/en-us/library/system.servicemodel.httptransportsecurity.proxycredentialtype.aspx](http://msdn.microsoft.com/en-us/library/system.servicemodel.httptransportsecurity.proxycredentialtype.aspx)

# json - 是否有任何基于 JSON（或 YAML）的“时间表”或“工作日志”相关格式来记录花费在任务上的时间？

> ID：187003
> 
> 赞同：2
> 
> 时间：2008-10-09T12:20:11.903
> 
> 标签：json, logging, yaml, workitem

我只需要一个简单的基于 JSON 或 YAML（或其他）文本的格式来记录我花在任务上的时间。我更喜欢在我的文本编辑器（e 文本编辑器）中做尽可能多的工作，所以我更自然地留在编辑器中而不是来回切换到 Excel 之类的程序（加上这种方式我保持便携和“开放“ 数据）。这个想法是，如果我以 JSON 或 YAML 格式记录我的所有任务，那么我可以轻松地使用 IRB（交互式 Ruby）或其他一些交互式编程会话来为自己创建工作日志报告。我也可以使用它在某个特定时间段结束时很容易地为我的客户生成报告。

如果该格式已经存在并且该格式具有某种机制来处理以下问题，那就太好了：我记录的一些数据应该“仅供内部使用”，而其他数据可以安全地用于“外部”使用。换句话说，我想避免的一个问题是筛选文本工作日志以过滤不应该转发给客户端的项目的麻烦。

问：为什么是 JSON 或 YAML ？？？
A：JSON 或 YAML 似乎比使用 XML 创建更简洁的语法。请记住，我是必须输入日志的人，所以我对输入一堆额外的结束标签不感兴趣。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-04T16:01:19.393

你可以创建任何你想要的格式，这是首先使用 YAML 或 JSON 的主要优势。事实上，除了您自己的工作风格和个人偏好之外，没有什么能阻止您使用 YAML 或 JSON 编写**所有**文本文件。

```
### myyamllog.txt
  - log_entry: posted some stuff on stack overflow
    project:   prj_my_personal_stuff
    datestamp: 2008-11-14 07:58
    summary: answering a question on formatted text for logs
    body: |  
        you can create a "dummy" log entry as a text editor snippet
        and just paste a new entry every time you start a new project.
        The snippet will just contain placeholders for the parts you have
        to fill in by hand. Timestamp will be auto-populated when you paste.

  - log_entry: followup on SO answer
    project:   prj_my_personal_stuff
    datestamp: 2008-11-14 08:10
    summary: 
    body: | 
        As far as a "standardized" format, you can pick anything you want.
        One suggestion is to just make each individual log entry a simple 
        series of name-value pairs. Then combine those individual entries
        as a series of YAML sequence elements. The benefit of this is it
        reflects the layout of a single database table. The sequence elements
        are records and the name-value pairs are fields. 
```

这样做的好处是，如果您有一个喜欢 excel 的老板，或者一个使用 HTML 的内容管理系统，那么将这种格式更改为其他输出目标格式并不难。这可能是您已经注意到的，因此您对标准格式提出了问题。

我的建议是，只需使用您想要使用的任何字段，然后将其构建为“表格”，然后找到将文本表格转换为各种不同格式的工具，如果您需要的格式不存在，请编写一个用python、perl、ruby等翻译自己。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T12:31:59.977

使用 XML 怎么样？>:)

# java - 在 Java 中查找共享可变数据错误的工具

> ID：187004
> 
> 赞同：14
> 
> 时间：2008-10-09T12:20:24.883
> 
> 标签：java, multithreading, static-analysis, dynamic-analysis

我有一个大型遗留系统需要维护。代码库到处都使用线程，这些线程共享大量可变数据。我知道，听起来很糟糕。无论如何，不​​要回答“从头开始重写整个应用程序”，否则我会投票给你 :-) 我曾尝试在代码库上运行一些静态分析工具，但似乎没有一个能捕捉到这种经常发生的情况在我们的源代码中：多个线程正在读取和写入根本没有标记为 volatile 或同步的变量。通常这发生在“runFlag”类型的变量上。在 Effective Java 2nd edition page 260 上就是一个例子：

```
public class StopThread
{
    private static boolean stopRequested;
    public static void main(String[] args) throws InterruptedException
    {
        Thread backgroundThread = new Thread(new Runnable()
        {
            public void run()
            {
                int i = 0;
                while (!stopRequested)
                {
                    i++;
                }
            }
        });
        backgroundThread.start();
        Thread.sleep(1000);
        stopRequested = true;
    }
} 
```

这个例子永远不会在 Windows/Linux 上完成，并为 Sun JVM 提供了“-server”启动参数。那么，是否有任何（半）自动的方法来发现这些问题，还是我必须完全依赖代码审查？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-09T19:22:53.937

Chris Grindstaff 写了一篇文章[FindBugs，第 2 部分：编写自定义检测器](http://www.ibm.com/developerworks/java/library/j-findbug2/)，他在其中描述了如何使用[BCEL](http://jakarta.apache.org/bcel/index.html)添加您自己的规则。（BCEL 不是唯一的字节码库——但它是 FindBugs 使用的。）

下面的代码发出方法访问静态方法或字段的任何情况。您可以在任何实现*Runnable*的类型上运行它。

```
public class StaticInvocationFinder extends EmptyVisitor {

    @Override
    public void visitMethod(Method obj) {
        System.out.println("==========================");
        System.out.println("method:" + obj.getName());

        Code code = obj.getCode();
        InstructionList instructions = new InstructionList(code.getCode());
        for (Instruction instruction : instructions.getInstructions()) {
            // static field or method
            if (Constants.INVOKESTATIC == instruction.getOpcode()) {
                if (instruction instanceof InvokeInstruction) {
                    InvokeInstruction invokeInstruction = (InvokeInstruction) instruction;
                    ConstantPoolGen cpg = new ConstantPoolGen(obj
                            .getConstantPool());
                    System.out.println("static access:"
                            + invokeInstruction.getMethodName(cpg));
                    System.out.println("      on type:"
                            + invokeInstruction.getReferenceType(cpg));
                }
            }
        }
        instructions.dispose();
    }

    public static void main(String[] args) throws Exception {
        JavaClass javaClass = Repository.lookupClass("StopThread$1");

        StaticInvocationFinder visitor = new StaticInvocationFinder();
        DescendingVisitor classWalker = new DescendingVisitor(javaClass,
                visitor);
        classWalker.visit();
    }

} 
```

此代码发出以下内容：

```
==========================
method:<init>
==========================
method:run
static access:access$0
      on type:StopThread 
```

然后可以扫描*StopThread*类型，找到该字段并检查它是否是*volatile*。

检查同步是可能的，但由于多个 MONITOREXIT 条件可能会变得棘手。向上调用堆栈也可能很困难，但这不是一个微不足道的问题。但是，我认为如果始终如一地实施，检查错误模式会相对容易。

在您找到*BCELifier*类之前，BCEL 看起来很少有文档记录并且非常麻烦。如果你在一个类上运行它，它会吐出你将如何在 BCEL 中构建类的 Java 源代码。*在StopThread*上运行它可以生成*access$0*合成访问器：

```
 private void createMethod_2() {
    InstructionList il = new InstructionList();
    MethodGen method = new MethodGen(ACC_STATIC | ACC_SYNTHETIC, Type.BOOLEAN, Type.NO_ARGS, new String[] {  }, "access$0", "StopThread", il, _cp);

    InstructionHandle ih_0 = il.append(_factory.createFieldAccess("StopThread", "stopRequested", Type.BOOLEAN, Constants.GETSTATIC));
    il.append(_factory.createReturn(Type.INT));
    method.setMaxStack();
    method.setMaxLocals();
    _cg.addMethod(method.getMethod());
    il.dispose();
  } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T13:15:41.433

最新版本的 FindBugs 将尝试检查标有`@GuardedBy`注释的字段是否只能在适当的保护代码中访问。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T20:22:54.283

Coverity 线程分析器可以完成这项工作，但这非常昂贵。IBM Multi-Thread Run-time Analysis Tool for Java 似乎能够检测到这些，但设置起来似乎有些困难。这些是动态分析工具，可以检测哪些实际变量是在没有适当同步或波动的情况下从不同线程访问的，因此结果比静态分析更准确，并且能够发现静态分析无法检测到的许多问题。

如果您的代码大部分或至少部分正确同步，修复 FindBugs（或其他静态分析）并发检查也可能会有所帮助，至少规则 IS2_INCONSISTENT_SYNC 和 UG_SYNC_SET_UNSYNC_GET 可能是好的开始。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-09T16:51:43.447

Coverity 制作了一些可能有所帮助的静态和动态分析工具。

[http://www.coverity.com/](http://www.coverity.com/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-09T12:35:08.083

FindBugs 和基于它的专业工具是您最大的希望，但不要指望它们会发现您代码中的所有并发问题。

如果情况如此糟糕，那么您应该通过人类 Java 并发专家的分析来补充工具。

这是一个难题，因为*最终证明*现有但经过修改的代码库的正确性可能是不现实的——尤其是在并发使用的情况下。

# php - 实施 LDAP 合规性

> ID：187005
> 
> 赞同：4
> 
> 时间：2008-10-09T12:20:26.677
> 
> 标签：php, ldap

我正在专业地开发一个包含联系人等数据的 php Web 应用程序。我想知道使用 LDAP 协议将这些数据提供给外部程序会有多难。

有没有专门的工具可以解决这个问题？我真的找不到任何东西，但我无法想象我是第一个想到这个的人。

* * *

编辑 1：我正在寻找的是一种让应用程序（如邮件客户端）能够使用标准 ldap 查找从我的数据中查找联系人的方法。

在我这边使用第三方软件或单独的 ldap 服务器没有任何限制，但我希望客户端能够简单地使用他们选择的应用程序的内置 ldap 连接。

我可以看到一个 ldap 服务器，它在我的应用程序中使用我的数据库或服务来提供数据，就好像我的应用程序本身就是一个 ldap 服务器一样。我更喜欢这样的解决方案，因为如果我可以为此使用外部服务器，我认为使用 ldap 功能使应用程序膨胀是不对的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-09T14:11:00.947

LDAP 服务器协议很大，我认为没有 PHP 服务器存在。我建议运行一个 LDAP 服务器并将记录推送到它。

我喜欢 OpenLDAP，但是那里有很多服务器，具体取决于您的平台。甚至 ActiveDirectory 也是一个 LDAP 服务器。

通常，LDAP 对象具有内部跟踪属性。例如，OpenLDAP`modifyTimestamp`看起来像`20080306214429Z`. 除非您在查询中特别要求它们，否则这些不会被服务器返回。

编写一个 crontab 来比较 LDAP 和您的数据库中的修改时间很容易。如果 LDAP`modifyTimestamp`比您的数据库中的旧，请更新记录。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-09T15:10:01.983

我建议您将数据存储在 LDAP 服务器中，而不是尝试让 LDAP 服务器使用您的数据库。您可以为不适合标准 LDAP 字段的任何内容创建自定义字段。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-09T12:24:13.783

您是想在 PHP 中实现 LDAP 服务器，还是只是交换数据？

如果您只想交换数据，您可能会考虑实现类似[LDIF的东西。](http://en.wikipedia.org/wiki/LDAP_Data_Interchange_Format)

# .net - 如何通过 WCF 暴露对象？

> ID：187006
> 
> 赞同：3
> 
> 时间：2008-10-09T12:20:36.007
> 
> 标签：.net, wcf, silverlight

我的项目被拆分为 Silverlight 应用程序的典型 3 层结构。那是：

*   一个基础层，它是一个类库，包含我所有的业务对象、逻辑、数据访问等。
*   一个中间层，它是一个与之通信的 WCF 服务；
*   我的 Silverlight 前端

我遇到的问题是，目前通过 WCF 向我的 UI 公开的 BO 仅包含私有变量，而没有任何属性或方法。

有没有一种简单的方法来公开整个对象（通过属性或配置）？

什么是最好的解决方案？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-09T12:42:53.073

您似乎希望 WCF 服务中使用的内部类（您已标记为 DataContracts）作为 .NET 对象导出到您的客户端代码（Silverlight UI）。WCF 不支持此功能。标记为 DataContract 的类就是这样，一个没有方法的数据结构。如果您需要了解 WCF 的好资源，请尝试[学习 WCF：Michele Bustamente 的动手指南](https://rads.stackoverflow.com/amzn/click/com/0596101627 "学习 WCF")。

@John Fisher 确实勾勒出一种将 .NET 对象公开给客户端和服务的方法，但这可能不是 Silverlight 的选项。这是一个[博客条目](http://www.gotnet.biz/Blog/post/Accessing-Web-Services-from-Silverlight-2.aspx)，解释了如何从 Silverlight 访问基于 REST 的服务。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-13T15:02:04.370

使用 [DataContract] 属性标记服务正在使用的对象，然后将 [DataMember] 放在公共属性上。这将解决您的问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T12:26:54.527

我在一个小项目上做了类似的事情，创建了一个“通信层”dll，它只包含在客户端和服务器之间传递的对象。这个的变体（在所有需要这些对象的项目之间共享一个 dll）应该适合你。不过，请注意版本控制问题。除非您完全控制两端，否则升级到一端可能会导致头疼，如果您不小心的话。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-09T16:58:13.557

[Sixto 的回答](https://stackoverflow.com/questions/187006/how-to-expose-objects-through-wcf#187079)是正确的。使用 WCF，您可以在客户端和服务之间共享 BO DLL 并重新使用这些对象（只需以这种方式配置 WCF 服务引用），但这不适用于您的情况。问题是您的 BO 项目是标准的 .NET 项目，而不是 silverlight 项目。

通常我的项目结构与你的有点不同：

*   公共对象 - 这些将是用 WCF 属性标记的数据结构，并且还包含任何公共接口，例如我的数据层接口。
*   数据访问 - 任何数据访问对象。这仅引用公共对象并从数据调用中返回这些对象。
*   业务逻辑（可选） - 如果有其他 Web 服务可以与之交互，请在其自己的层中使用
*   Service - 实际的WCF服务，通过接口直接引用Common和其他项目
*   Silverlight - 引用服务

如果您将业务逻辑移到其项目中并仅引用常见的“哑”对象，那么您可能会创建两个逻辑项目，一个 Silverlight 和一个标准，只需将实际文件合二为一，并在其中创建指向这些文件的链接另一个。这样，您将在两个项目中获得相同的逻辑，并且它将同时存在于 Silverlight 和标准 .NET 中。

# asp.net - 如何在 ASP.NET 路由中创建类似“/x/{*path}/y”的路由？

> ID：187009
> 
> 赞同：1
> 
> 时间：2008-10-09T12:21:07.877
> 
> 标签：asp.net, .net, routing

我有像“x/{*path}”这样的路由，其中`path`​​控制器使用参数来导航树结构，最终得到提供给客户端的资源。

我现在想用其他控制器以正交方式扩展这个方案，这些控制器提供资源的其他“方面”，例如元数据或缩略图。应该可以添加这些其他控制器，以便主控制器不必知道它们的存在。我打算使用像“x/{*path}/y”这样的路由来索引这些方面，但路由系统不会接受这样的路径。

例如，如果路径参数以“/y”结尾，我可以使用约束来匹配我的附加路由，但是控制器必须知道添加的“扩展”才能在解析路径时将其删除 - 这个是不能接受的。

我是否被迫编写自己的路线？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-18T18:06:08.463

两种解决方案：

1.  改为使用`x/y/{*path}`。
2.  继续使用`x/{*path}`，但是当您读取路径参数时，请检查`/y`并采取相应措施

# asp.net-ajax - 我可以以编程方式（服务器端）将 ASP.NET AJAX 扩展添加到页面吗？

> ID：187018
> 
> 赞同：0
> 
> 时间：2008-10-09T12:24:42.580
> 
> 标签：asp.net-ajax, controls

在页面中，在加载事件中，我正在动态创建用于在页面上显示的控件。这一切都正常工作。我遇到的麻烦是从 AJAX 控件工具包添加扩展器时，特别是我试图向按钮控件添加圆角。不会引发错误，但 AJAX 扩展功能不会出现在显示的页面中。

有没有人对我没有正确做的事情有任何想法，或者是否有可能？

```
Dim container As HtmlGenericControl
Dim edit As Button
Dim editRoundedCorners As AjaxControlToolkit.RoundedCornersExtender 

For each item in items
            container = New HtmlGenericControl("div")
            container.ID = "container_" & item.code

            edit = New Button()
            edit.ID = "edit_" & item.code
            edit.Text = "Edit"
            edit.Style("padding") = "0 0 0 4px"
            edit.SkinID = "smallEditButton"

            editRoundedCorners = New AjaxControlToolkit.RoundedCornersExtender()
            editRoundedCorners.BorderColor = edit.BorderColor
            editRoundedCorners.ID = edit.ID & "_RoundedCorners"
            editRoundedCorners.Corners = AjaxControlToolkit.BoxCorners.All
            editRoundedCorners.Radius = 3
            editRoundedCorners.TargetControlID = edit.ID

            container.Controls.Add(editRoundedCorners)
            container.Controls.Add(edit)
            pageContainer.Controls.Add(container)
Next 
```

（pageContainer 是页面上的一个 div）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-09T12:28:39.390

您需要将“editRoundedCorners”添加到页面或容器、Controls 集合中，因此请尝试添加以下行：

```
Controls.Add(editRoundedCorners) 
```

就在“'将它们添加到页面控件集合”之前，因为您可能只添加了编辑按钮，而两者都是必需的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T22:05:53.390

我正在使用 C#，所以我将使用该语法。

正如 Rob 所说，您需要将 Extender 添加到页面中。您可以通过以下方式做到这一点：

```
*parentCtrl*.Controls.Add(*extendername*); 
```

或者，或者，

```
*controltype* *controlname* = (*controltype*)Page.LoadControl(typeof(*controltype*), new object[]{}); 
```

如果要将参数传递给控件，​​请将它们放入对象数组中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T14:12:00.400

您不能将 RoundedCornersExtender 应用于文本框或按钮等输入元素。

# vbscript - 如何从 VBScript 控制台应用程序返回退出代码

> ID：187040
> 
> 赞同：44
> 
> 时间：2008-10-09T12:32:03.313
> 
> 标签：vbscript

我有一个旧的 vbs 脚本文件被 AutoSys 作业启动。我能否以及如何返回一个 int 返回值来指示成功或失败？

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2008-10-09T12:34:37.367

尝试：

```
WScript.Quit n 
```

其中 n 是您要返回的 ERRORLEVEL

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2008-10-09T12:35:18.377

我找到了答案：0）

```
 DIM returnValue
 returnValue = 99
 WScript.Quit(returnValue) 
```

这似乎运作良好。

# svn - 代码覆盖率和责任

> ID：187046
> 
> 赞同：8
> 
> 时间：2008-10-09T12:32:48.743
> 
> 标签：svn, version-control, code-coverage, ncover

有没有人见过将代码覆盖结果与 SCM/VCS 集成以将未经测试的代码行归因于开发人员的工具？例如，是否有一个工具可以获取 NCover 的 Coverage.Xml，将其与 SVN 归咎于，并生成一份报告，告诉我诸如开发人员提交了大多数未经测试的代码之类的事情？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-10T07:13:43.097

我使用 CC.NET (ccnet.thoughtworks.com/) 和 NANT 来评估我的应用程序的代码覆盖率。默认情况下，它与开发人员的提交无关，但我认为创建一个 NANT 任务并不难。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-09T13:38:39.593

没有这样做，但[团队城市](http://www.jetbrains.com/teamcity/features/code_quality.html)提供了一些类似的设施......

# c++ - glBlendFunc 和 alpha 混合

> ID：187057
> 
> 赞同：2
> 
> 时间：2008-10-09T12:36:02.027
> 
> 标签：c++, opengl

我想知道 glBlendFunc 是如何工作的。例如，我有 2 个 gl 纹理，其中 alpha 在 tex1 上，我想在我的最终图像中使用 alpha。颜色在 tex1 上的地方，我想要 tex2 的颜色。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-09T13:45:40.733

glBlendFunc 仅适用于最终颜色片段如何与帧缓冲区混合。我认为你想要的是多重纹理，通过使用 glTexEnv 混合纹理阶段来组合两个纹理，或者使用片段着色器来组合两个纹理。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-09T14:23:30.187

抱歉，不能通过简单的混合来做到这一点。例如，我们曾经使用 frament 着色器来做同样的事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-10T22:36:18.900

支持着色器。如果您可以使用着色器，则可以更轻松地对数据执行您想要的操作，而不是使用神秘的混合功能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-12T18:12:41.833

可悲的是，这是针对 iPhone 上的 openGL ES 的，所以没有着色器，但要点是。我的问题是问题的一个非常简化的版本，我需要对定义的纹理的一部分应用简单的颜色（包括 alpha）。正如 Lee 所指出的，纹理混合是为了让 alpha 显示在帧缓冲区上。解决方案是坚持艺术家将纹理的“动作位”设为白色，然后为我渲染的顶点分配颜色。像这样的东西。

```
glTexCoordPointer( 2, GL_FLOAT, 0, sprite->GetTexBuffer() );
glVertexPointer( 3, GL_FLOAT, 0, sprite->GetVertexBuffer() );
glColorPointer( 4, GL_FLOAT, 0, sprite->GetColorBuffer() );
glDrawArrays( GL_TRIANGLES, 0, 6 ); // Draw 2 triangles 
```

即使它有纹理，有颜色意味着它会添加到纹理的颜色中，所以在它是 alpha 的地方，它仍然是 alpha，在它是白色的地方（因为我必须让它），它成为颜色的颜色点的指针。

# asp.net - 如何在 ASP.net 页面中使用 javascript 获取页面中的所有控件

> ID：187059
> 
> 赞同：1
> 
> 时间：2008-10-09T12:36:12.447
> 
> 标签：asp.net, javascript

我有一个带有选项卡控件的页面，每个控件都有近 15 个控件。一个页面中总共有 10 个选项卡和大约 150 个控件（仅下拉列表、文本框、单选按钮、列表框等控件）。

我的要求是页面底部有一个按钮（提交）。我需要使用 JavaScript 检查是否从该页面的 150 个控件中选择了至少 3 个选项，而不管他们选择的选项卡如何。

请在我的 aspx 页面上建议可以在 JavaScript 中完成的最简单和最简单的方法。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-09T13:21:55.663

假设页面上只有一个表单（如果更多，则遍历表单并将下面的循环嵌套在其中）。

```
 var selectedCount = 0;
  var element;

  for (var i = 0; i < document.forms[0].elements.length; i++)
  {
    element = document.forms[0].elements[i];

    switch (element.type)
    {
      case 'text':
        if (element.value.length > 0)
        {
          selectedCount++;
        }
        break;
      case 'select-one':
        if (element.selectedIndex > 0)
        {
          selectedCount++;
        }
        break;
      //etc - add cases for checkbox, radio, etc.
    }
  } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-09T13:03:40.990

我会看一些基于原型[序列化](http://www.prototypejs.org/api/form#method-serializeelements)方法的东西——它可以给你所有表单控件的哈希——它可以让你在你想要的东西上占得先机。

像萤火虫这样的东西会帮助你看到你得到了什么，并评估它是否满足你的需求。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-09T13:21:38.800

您说您需要验证至少应该选择三个选项，但是您是否有可能需要验证比这三个更多的选项？控件是否有唯一的 ID 或类名？您是否使用特定的框架（jQuery、Prototype 等）？

如果不了解您的项目的更多信息，很难提出任何可靠的建议，但是使用纯 JavaScript（没有框架），并假设您有，比如说，我会说的唯一类名......

*   加载 DOM 后，将需要验证的所有控件加载到数组中（通过它们的 ID 或类名获取它们）
*   附加一个事件侦听器以提交以在单击它时捕获
*   在提交实际发生之前，遍历您的控件列表并根据需要验证每个控件。如果验证好，继续提交的默认动作；否则，向用户返回某种形式的错误消息。

这听起来像是一个非常通用的解决方案，但是如果不了解您的设置，就很难给出任何具体的代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-11T02:25:38.110

jQuery 在页面上获取控件会简单得多：

```
var inputs = $('input');
var selects = $('select');

var textBoxes = $("input[type='text']"); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-12-20T07:20:26.837

你真的应该考虑使用[jquery](http://jquery.com/)来解决这个问题。它是免费的，现在所有优秀的 Javascript 程序员都在使用它！

如果你使用 jquery，你的问题就变得很简单了。下面的代码行将搜索整个页面并返回任何被选中的列表项的数量。

```
var count = $("option:selected").length; 
```

# sql - 在选择记录时修改记录中的键的最佳解决方案

> ID：187066
> 
> 赞同：0
> 
> 时间：2008-10-09T12:39:28.510
> 
> 标签：sql, database

我有一个 UPDATE sql 命令，可以修改特定表中的日期/时间字段。此表有两个键，ProductionCode 和 TestTime，这是正在修改的内容。特定记录的生产代码永远不会更改，但用户经常会发现他们输入了错误的测试时间并需要更改它。

我有可以从数据网格中检索到的更新时间，但是，我需要选择正确的记录进行更改。为了做到这一点，我的条件之一必须是该记录在数据库中设置的当前时间。

目前，我保留了一组旧时间，每当运行 UPDATE 命令时都会更新这些时间。所以在 sql 命令的 WHERE 块中，使用的是旧时间。一旦它在数据库中更新，然后我更新时间数组。当时间输入无序，或者数据网格在与时间不同的字段上排序时，就会出现困难。我必须跟踪所有旧时间对应于数据网格行的顺序，并且它在过去导致了许多错误。目前它工作正常，但充其量是微妙的。

所以我真正在寻找的是一个更好的解决方案。我是否应该只存储用于填充 UI 的 SELECT 语句的结果并依赖它们？目前，我的数据库结果的唯一位置是直接进入数据网格。还是有其他方法？我避免了自动数据绑定，而是手动使用 SQL 命令，因为我的数据网格是动态配置的，并且从一次加载到下一次加载使用不同的模式，并且唯一保证存在的列是 ProductionCode 和 TestTime。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-09T12:55:35.327

添加一个新列“id”，其中包含一个可以识别每一行的唯一编号。如果您的用户需要修改主键，您可能没有选择好的主键？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-09T13:04:59.143

我不知道您使用的是哪种语言，但您提到“datagrid”的方式让我觉得是一种 .NET 语言。

数据网格（和网格视图等）具有允许您设置要引用的键的属性。为您的主键创建一个自动编号索引，并使用它来引用要更新的正确记录。

密钥应该是只读的，句号。

希望添加这个新字段不会干扰您的代码 - 但它可能会。但这是处理数据结构的正确方法。

此外，根据您的 SQL 风格，您可能能够在您的选择中生成一个行号。这可能会引导您找到一个可行的解决方案，但这不是正确的路径。

# wpf - 无法在多线程中操作 ObservableCollection

> ID：187069
> 
> 赞同：7
> 
> 时间：2008-10-09T12:40:16.667
> 
> 标签：wpf, multithreading, observablecollection

ObservableCollection 似乎只支持从 UI 线程添加、删除、清除操作，如果它由 NO UI 线程操作，它会抛出 Not Support Exception。我试图覆盖 ObservableCollection 的方法，不幸的是，我遇到了很多问题。任何人都可以为我提供一个可以由多线程操作的 ObservableCollection 示例吗？非常感谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-09T12:43:23.120

使用[Kent](https://stackoverflow.com/questions/187069/can-not-operate-observablecollection-in-multi-threads#187078)提供的链接，您可以使用以下代码跨线程修改集合：

```
while (!Monitor.TryEnter(_lock, 10))
{
   DoEvents();
}

try
{
   //modify collection
}
finally
{
   Monitor.Exit(_lock);
} 
```

但是，如果您只是想修改原始线程上的集合，您可以尝试使用回调到您的 UI 线程。我通常会这样做：

```
this.Dispatcher.Invoke(new MyDelegate((myParam) =>
{
  this.MyCollection.Add(myParam);
}), state); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-09T12:47:23.470

您基本上必须调用或 BeginInvoke 到 UI 线程来执行这些操作。

```
Public Delegate Sub AddItemDelegate(ByVal item As T)

Public Sub AddItem(ByVal item As T)
    If Application.Current.Dispatcher.CheckAccess() Then
        Me.Add(item)
    Else
        Application.Current.Dispatcher.Invoke(Threading.DispatcherPriority.Normal, New AddItemDelegate(AddressOf AddItem), item)
    End If
End Sub 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-11-14T23:54:22.807

就个人而言，我发现 Bob 的回答方式比 Mark 的回答方式更容易使用。以下是用于执行此操作的 C# WPF 片段：

1.  在类的构造函数中，在创建可观察集合时获取当前调度程序。因为，正如您所指出的，需要在**原始**线程上进行修改，这可能不是*主*GUI 线程。所以**Application.Current.Dispatcher**并不总是正确的，并不是所有的类都有**this.Dispatcher**。

    ```
    _dispatcher = System.Windows.Threading.Dispatcher.CurrentDispatcher;
    _data = new ObservableCollection<MyDataItemClass>(); 
    ```

2.  使用调度程序调用需要原始线程的代码部分。

    ```
    _dispatcher.Invoke(new Action(() => { _data.Add(dataItem); })); 
    ```

那应该对你有用。尽管在某些情况下您可能更喜欢**.BeginInvoke**而不是**.Invoke**。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-01-12T21:20:51.430

您可能想调查我对此的回答——但是`please note`代码来自这里，不能归功于我。虽然我试图在 VB 中实现它。:[原创网站](http://geekswithblogs.net/NewThingsILearned/archive/2008/01/16/have-worker-thread-update-observablecollection-that-is-bound-to-a.aspx)

我已经使用它从一个类中填充了一个 WPF 列表框，该类具有从访问数据库异步填充的 ObservableCollectionEx。它确实有效。

```
public class ObservableCollectionEx<T> : ObservableCollection<T>
{
   // Override the event so this class can access it
   public override event System.Collections.Specialized.NotifyCollectionChangedEventHandler    
 CollectionChanged;

   protected override void OnCollectionChanged    (System.Collections.Specialized.NotifyCollectionChangedEventArgs e)
   {
  // Be nice - use BlockReentrancy like MSDN said
  using (BlockReentrancy())
  {
     System.Collections.Specialized.NotifyCollectionChangedEventHandler eventHandler = CollectionChanged;
     if (eventHandler == null)
        return;

     Delegate[] delegates = eventHandler.GetInvocationList();
     // Walk thru invocation list
     foreach (System.Collections.Specialized.NotifyCollectionChangedEventHandler handler in delegates)
     {
        DispatcherObject dispatcherObject = handler.Target as DispatcherObject;
        // If the subscriber is a DispatcherObject and different thread
        if (dispatcherObject != null && dispatcherObject.CheckAccess() == false)
        {
           // Invoke handler in the target dispatcher's thread
           dispatcherObject.Dispatcher.Invoke(DispatcherPriority.DataBind, handler, this, e);
        }
        else // Execute handler as is
           handler(this, e);
     }
  }
}
} 
```

# jquery - jQuery 可排序

> ID：187073
> 
> 赞同：3
> 
> 时间：2008-10-09T12:40:58.350
> 
> 标签：jquery, sequence, sortables

我在 jquery 中使用 sortable 函数对常见问题列表进行排序。不用说，我对这个概念很陌生。任何人都有这方面的后端很好的例子。我的前端工作正常，但更新数据库中的序列是另一回事。顺便说一句，我的后端是 ColdFusion。

提前致谢

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-09T12:50:46.287

定义常见问题：

```
<div id="faq">
  <div id="q1">...</div>
  <div id="q2">...</div>
  (...)
  <div id="q100">..</div>
</div> 
```

使常见问题解答可排序：

```
<script type="text/javascript">
  $("#faq").sortable();
</script> 
```

提交的表格：

```
<form action="..." id="faq_form">
  <input type="hidden" name="faqs" id="faqs" />
  ...
</form> 
```

将排序序列添加到表单

```
<script type="text/javascript>
  $("#faq_form").submit(function() {
    $("#faqs").val($("#faq").sortable('toArray'))
  })
</script> 
```

提交表单时，“faqs”字段将包含来自#faq 的逗号分隔 ID，如下所示：q1,q3,q10,q11,q2,q100...

只需解析它并保存到数据库

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-07-12T11:40:42.727

这是 Jquery UI Sortable 的简单示例，它如何与 div 一起使用。

首先在您的 html 中包含库：

```
 <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>` <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js"></script>`<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>`` 
```

用于使可排序的 Html：

```
<div id="target">
    <div style="cursor: move;" class="entity">
        <div class="digit"><span>1</span><tab />&nbsp; First Item </div>            
    </div>      
    <div style="cursor: move;" class="entity">
        <div class="digit"><span>2</span>&nbsp; Second Item</div>           
    </div>      
    <div style="cursor: move;" class="entity">
        <div class="digit"><span>3</span>&nbsp; Third Item</div>            
    </div>
    <div style="cursor: move;" class="entity">
        <div class="digit"><span>4</span>&nbsp; Fourth Item</div>           
    </div>
    <div style="cursor: move;" class="entity">
        <div class="digit"><span>5</span>&nbsp; Fifth Item</div>            
    </div>
</div> 
```

这是可排序的功能：

```
$(document).ready(function() {
    $('#target').sortable({
        items:'div.entity', //the div which we want to make sortable            
        scroll:true,        //If set to true, the page 
                            //scrolls when coming to an edge.
        update:function(event,ui){ renumber(); } //This event is triggered when the user 
                                                //stopped sorting and the DOM position has changed.
    });
}); 
```

renuber() 从 Sortable 更新事件处理程序回调中调用：

```
function renumber()
{
    $('.digit span').each(function(index,element) {
        $(element).html(index+1);
    });
} 
```

# php - 用其他东西替换或删除新行，但只能在 CSV 文件上使用 PHP 的单引号或双引号之间

> ID：187076
> 
> 赞同：1
> 
> 时间：2008-10-09T12:42:24.293
> 
> 标签：php, csv

我有一个 CSV 文件，其中包含大约 200,000 - 300,000 条记录。大多数记录可以通过一个简单的方法分离并插入到 MySQL 数据库中

```
$line = explode("\n", $fileData); 
```

然后用分隔的值

```
$lineValues = explode(',', $line); 
```

然后使用正确的数据类型（即 int、float、string、text 等）插入数据库。

但是，某些记录的文本列在字符串中包含 \n。使用 $line = explode("\n", $fileData); 时会中断 方法。需要插入数据库的每一行数据大约有 216 列。并非每一行都有一个字符串中带有 \n 的记录。但是，每次在该行中找到一个 \n 时，它都包含在一对单引号 (') 之间

每一行都按以下格式设置：

```
id,data,data,data,text,more data 
```

例子：

```
1,0,0,0,'Hello World,0
2,0,0,0,'Hello
    World',0
3,0,0,0,'Hi',0
4,0,0,0,,0 
```

从示例中可以看出，大多数记录都可以使用上面显示的方法轻松拆分。它是导致问题的示例中的第二条记录。

新行只有 \n 并且文件中根本不包含 \r 。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-09T13:03:26.777

当然，这里的另一个建议是有效的，特别是如果您打算编写自己的 CSV 解析器，但是，如果您只想获取数据，请使用[fgetcsv()](http://php.net/fgetcsv)函数，而不必担心实现细节。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-09T12:48:02.563

如果 csv 数据在文件中，则可以像其他人指出的那样使用 fgetcsv() 。fgetcsv 正确处理嵌入的换行符。

但是，如果您的 csv 数据位于字符串中（例如示例中的 $fileData），则以下方法可能很有用，因为 str_getcsv() 一次只能处理一行，并且不能将整个文件拆分为记录。

您可以通过计算每行中的引号来检测嵌入的换行符。如果有奇数个引号，则说明您的行不完整，因此请将此行与下一行连接起来。一旦你有偶数的报价，你就有一个完整的记录。

一旦你有一个完整的记录，在引号处分割它（再次使用explode()）。奇数字段被引用（因此嵌入的逗号不是特殊的），偶数字段不是。

例子：

```
# Split file into physical lines (records may span lines)
$lines = explode("\n", $fileData);

# Re-assemble records
$records = array ();
$record = '';
$lineSep = '';
foreach ($lines as $line) {
  # Escape @ symbol so we can use it as a marker (as it does not conflict with
  # any special CSV character.)
  $line = str_replace('@', '@a', $line);

  # Escape commas as we don't yet know which ones are separators
  $line = str_replace(',', '@c', $line);

  # Escape quotes in a form that uses no special characters
  $line = str_replace("\\'", '@q', $line);
  $line = str_replace('\\', '@b', $line);

  $record .= $lineSep . $line;
  $lineSep = "\n";

  # Must have an even number of quotes in a complete record!
  if (substr_count($record, "'") % 2 == 0) {
    $records[] = $record;
    $record = '';
    $lineSep = '';
  }
}
if (strlen($record) > 0) {
  $records[] = $record;
}

$rows = array ();

foreach ($records as $record) {
  $chunks_in = explode("'", $record);
  $chunks_out = array ();

  # Decode escaped quotes/backslashes.
  # Decode field-separating commas (unless quoted)
  foreach ($chunks_in as $i => $chunk) {
    # Unescape quotes & backslashes
    $chunk = str_replace('@q', "'", $chunk);
    $chunk = str_replace('@b', '\\', $chunk);
    if ($i % 2 == 0) {
      # Unescape commas
      $chunk = str_replace('@c', ',', $chunk);
    }
    $chunks_out[] = $chunk;
  }

  # Join back together, discarding unescaped quotes
  $record = join('', $chunks_out);

  $chunks_in = explode(',', $record);
  $row = array ();
  foreach ($chunks_in as $chunk) {
    $chunk = str_replace('@c', ',', $chunk);
    $chunk = str_replace('@a', '@', $chunk);
    $row[] = $chunk;
  }
  $rows[] = $row;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T12:54:10.010

如何使用一两个 for 循环从头到尾手动迭代数据？它比 慢`explode()`，但更容易获得关于报价的一致和可靠的结果。

如果您选择此方法，请记住要考虑转义引号。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-09T13:11:41.767

使用`fgetcsv`它，它会为您处理所有这些。除非有一些压倒一切的原因，否则您需要拥有自己的 CSV 解析器。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-09T12:46:13.003

如果您可以保证以数字开头的每个新行都是有效的新行（即不在文本描述的中间），那么您可以尝试以下操作：

```
// Replace all new-line then id patterns with new-line 0+id
$line = preg_replace('/\n(\d)/',"\n0$1",$line);

// Split on new-line then id
$linevalues = preg_split("/\n\d/",$data); 
```

第一步识别具有新行后跟数字值的所有行。然后它将“0”添加到该数值。第二行在找到换行符的地方分割，然后是整数。

“0”被添加到 id 的前面，因为[`preg_split`](http://ie2.php.net/manual/en/function.preg-split.php)它从后续匹配中删除了它匹配的字符。

正如我所说，这只有在您确定换行的文本不会以数字开始新行时才有效。

# javascript - 跨平台、跨浏览器从 Javascript 播放声音的方式？

> ID：187098
> 
> 赞同：79
> 
> 时间：2008-10-09T12:47:30.537
> 
> 标签：javascript, audio, cross-browser, cross-platform, dhtml

我正在编写一个 dhtml 应用程序来创建系统的交互式模拟。用于模拟的数据是从另一个工具生成的，并且已经有非常大量的遗留数据。

模拟中的某些步骤要求我们播放“画外音”音频片段。我一直无法找到一种简单的方法来跨多个浏览器完成此操作。

[Soundmanager2](http://www.schillmania.com/projects/soundmanager2/)非常接近我的需要，但它只能播放 mp3 文件，并且旧数据可能还包含一些 .wav 文件。

有没有人有任何其他可能有帮助的图书馆？

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2008-10-09T14:05:12.753

您必须包含一个像 Real Audio 或 QuickTime 这样的插件来处理 .wav 文件，但这应该可以工作......

```
//======================================================================
var soundEmbed = null;
//======================================================================
function soundPlay(which)
    {
    if (!soundEmbed)
        {
        soundEmbed = document.createElement("embed");
        soundEmbed.setAttribute("src", "/snd/"+which+".wav");
        soundEmbed.setAttribute("hidden", true);
        soundEmbed.setAttribute("autostart", true);
        }
    else
        {
        document.body.removeChild(soundEmbed);
        soundEmbed.removed = true;
        soundEmbed = null;
        soundEmbed = document.createElement("embed");
        soundEmbed.setAttribute("src", "/snd/"+which+".wav");
        soundEmbed.setAttribute("hidden", true);
        soundEmbed.setAttribute("autostart", true);
        }
    soundEmbed.removed = false;
    document.body.appendChild(soundEmbed);
    }
//====================================================================== 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-09T13:11:57.243

如果您使用 Prototype，Scriptaculous 库[有一个健全的 API](http://github.com/madrobby/scriptaculous/wikis/sound)。jQuery[似乎也有一个插件](http://dev.jquery.com/browser/trunk/plugins/sound/jquery.sound.js?rev=5750)。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-12-20T07:59:15.270

dacracots 代码是干净的基本 dom，但也许写得不假思索？当然，您首先检查是否存在较早的嵌入，然后保存重复的嵌入创建行。

```
var soundEmbed = null;
//=====================================================================

function soundPlay(which)
{
    if (soundEmbed)
       document.body.removeChild(soundEmbed);
    soundEmbed = document.createElement("embed");
    soundEmbed.setAttribute("src", "/snd/"+which+".wav");
    soundEmbed.setAttribute("hidden", true);
    soundEmbed.setAttribute("autostart", true);
    document.body.appendChild(soundEmbed);
} 
```

在寻找类似情况的解决方案时，在这里遇到了这些想法。不幸的是，我的浏览器 Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.0.15) Gecko/2009102814 Ubuntu/8.04 (hardy) Firefox/3.0.15 在尝试这个时死掉了。

安装最新更新后，firefox 仍然崩溃，opera 保持活力。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-09T12:52:48.390

我相信最简单和最方便的方法是使用一个小的 Flash 剪辑播放声音。我很欣赏它不是 JavaScript 解决方案，但它是实现目标的最简单方法

[上一个类似问题](https://stackoverflow.com/questions/82141/producing-2-or-more-short-sounds-when-a-web-page-loads#82181)的一些额外链接：

*   Scriptaculous，一个 Javascript 库：http: [//github.com/madrobby/scriptaculous/wikis/sound](http://github.com/madrobby/scriptaculous/wikis/sound)
*   一个开源 Flash 项目：Easy Musicplayer For Flash [http://emff.sourceforge.net/](http://emff.sourceforge.net/)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-10-07T21:14:58.017

您可以使用 HTML5`<audio>`标记。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2011-10-13T20:24:43.893

我喜欢 dacracot 的回答……这是 jQuery 中的一个类似解决方案：

```
function Play(sound) {
    $("#sound_").remove()
    $('body').append('<embed id="sound_" autostart="true" hidden="true" src="/static/sound/' + sound + '.wav" />');
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2012-12-10T19:28:43.607

```
<audio controls>
  <source src="horse.ogg" type="audio/ogg">
  <source src="horse.mp3" type="audio/mpeg">
Your browser does not support the audio element.
</audio> 
```

有关详细信息，请参阅[http://www.w3schools.com/html/html5_audio.asp 。](http://www.w3schools.com/html/html5_audio.asp)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-09T14:10:53.647

如果您使用的是 Mootools，则有[MooSound 插件](http://msteigerwalt.com/widgets/sounds/)。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-05-13T07:56:01.727

有一个更简单的解决方案，而不是求助于插件。IE 有它自己的 bgsound 属性，还有另一种方法可以使它适用于所有其他浏览器。在这里查看我的教程 = [http://www.andy-howard.com/how-to-play-sounds-cross-browser-including-ie/index.html](http://www.andy-howard.com/how-to-play-sounds-cross-browser-including-ie/index.html)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-12-12T16:05:18.710

对于带有 wav 文件的跨浏览器解决方案，我建议将`<audio>`标签设为默认值，然后如果用户在 IE 中，则在[此处](https://stackoverflow.com/a/187415/3214497)`<embed>`使用@dacracot 之前建议的解决方案，您可以在 SO 中通过一点搜索轻松检查它。

# c# - 将验证实现为方法还是属性？

> ID：187100
> 
> 赞同：2
> 
> 时间：2008-10-09T12:47:48.103
> 
> 标签：c#

如果对象数据有效，我有一个需要测试的对象。验证本身将从实例化对象的线程中调用，如下所示：

```
 {
  if (_step.Equals(string.Empty)) return false;
  if (_type.Equals(string.Empty)) return false;
  if (_setup.Equals(string.Empty)) return false;
  return true;
} 
```

将其实现为属性或方法会更好，为什么？我已经阅读了[相关问题](https://stackoverflow.com/questions/164023/what-guidelines-are-appropriate-for-determining-when-to-implement-a-class-membe)的答案，但我认为这里没有涵盖这个特定问题。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-09T12:50:49.360

我个人的看法是：

*   如果“验证”方法以任何方式（您的示例没有）改变对象，则将其设为方法。
*   如果对象在验证后保持不变，则将其设为属性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-09T12:50:42.357

我会说作为财产。

```
if(something.IsValid) { ... 
```

看起来更好

```
if(something.IsValid()) { ... 
```

还有一个来自 MSDN 的示例：http: [//msdn.microsoft.com/en-us/library/system.web.ui.page.isvalid (VS.71).aspx](http://msdn.microsoft.com/en-us/library/system.web.ui.page.isvalid(VS.71).aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T12:53:08.310

该代码需要重构。这就是你用Java而不是C#编写代码的方式。在 C# 中，您有运算符重载。

```
if (_step == "")) return false;
if (_type == "")) return false;
if (_setup == "")) return false; 
```

这是进行比较的惯用方式。除了更冗长之外，您的方式在 C# 中只是出乎意料且不一致。

当*且仅当*时，这些字符串有可能实际上`null`是空的，而不是空的，请改用以下内容：

```
if (string.IsNullOrEmpty(_step)) return false; 
```

# delphi - Delphi 是否有将版本作为输入参数的 FOSS 批量编译解决方案？

> ID：187109
> 
> 赞同：2
> 
> 时间：2008-10-09T12:50:22.293
> 
> 标签：delphi, command-line, compiler-construction

Delphi 是否有将版本作为输入参数的 FOSS 批量编译解决方案？

我正在使用 Delphi 7，这仍然是最繁琐的操作。是否有任何其他解决方案，解决方法可以使这变得容易。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-09T13:33:53.813

不太确定您的问题，但我假设您在编译时询问如何从批处理文件中设置产品的版本号。我之前使用了一个名为[StampVer](http://blog.dixo.net/downloads/stampver-win32-version-resource-stamping/)的程序，您需要在文件中已经有版本信息才能使用 StampVer。StampVer 是免费软件，但不是开源软件。

我强烈推荐的一个好的商业解决方案是[FinalBuilder](http://www.finalbuilder.com)，它还能够操作可执行文件中的版本信息以及编译您的 Delphi 应用程序。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T14:27:49.447

例如，您可以在资源脚本（.rc 文件）中指定版本信息，您可以使用类似于 {$R myver.res} 的方式将其编译表示链接到项目源 (.dpr) 中。然后，您可以让批处理构建系统使用 brcc32.exe（包含在任何 Delphi 版本中）从 .rc 文件生成 .res 文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-09T18:17:43.193

我们正在使用自定义 .res 文件 - 在构建过程中由 TortoiseSVN 的 WCREV 工具从模板创建（它需要修订号并替换模板文件中的关键字）。

Delphi 2006，没有附加组件。如果你愿意，我明天可以发布模板和脚本。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-09T18:59:04.000

[http://svn.berlios.de/svnroot/repos/dzchart/utilities/dzPrepBuild/trunk/](http://svn.berlios.de/svnroot/repos/dzchart/utilities/dzPrepBuild/trunk/)

可能符合要求。

“PrepBuild 是一个命令行工具，用于在使用 dcc32.exe 命令行编译器进行编译时处理 Delphi 项目的版本信息。它也可以用作 Delphi 2007 中的 Pre-Build 工具。”

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-09T04:52:17.837

使用[XN Resource Editor](http://www.wilsonc.demon.co.uk/d10resourceeditor.htm)中的 (MPL) 代码，编写自己的代码并不难：

[http://www.jasontpenny.com/blog/2009/05/08/program-to-set-delphi-resource-version-info-from-commandline/](http://www.jasontpenny.com/blog/2009/05/08/program-to-set-delphi-resource-version-info-from-commandline/)

# .net - Visual Studio 2008 中缺少工作流项目模板

> ID：187120
> 
> 赞同：5
> 
> 时间：2008-10-09T12:53:46.250
> 
> 标签：.net, wpf, visual-studio-2008, workflow

我无法将工作流项添加到我的 WPF 项目中。

我创建了一个新的 WPF 项目并希望添加一个顺序工作流。当我执行“添加新项目”时，没有可供选择的项目模板。

有什么提示吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-09T13:35:36.463

我认为您不能简单地将工作流添加到 WPF 项目中。您需要创建一个 WF 项目并在其中构建您的工作流程，然后引用 WF 项目。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-01T06:16:42.210

尽管这不受官方支持，但您几乎可以让任何 Visual Studio 项目支持工作流，执行由 Robert L. Bogue 在[他的博客文章](http://www.thorprojects.com/blog/archive/2007/01/17/making-a-custom-activity-work-in-your-project-even-if-you-started-with-a-class-library.aspx)中编译的步骤。

以防万一原始帖子不可用，以下是他的步骤（在 Visual Studio 2008 SP1 上测试）：

我将工作活动添加到我的核心项目中，但……它不起作用。当我尝试打开活动的设计图面时，我遇到了这个非常丑陋的错误。它部分表示：

必须安装服务“System.Workflow.ComponentModel.Design.IIdentifierCreationService”，此操作才能成功。确保此服务可用。

在我盯着屏幕想知道如何解决这个问题、搜索答案（但一无所获）之后，我开始查看项目文件，发现有两个必要的部分可以使工作流设计器表面工作。必要的第一个条目属于 and 是：

{14822709-B5A1-4724-98CA-57A101D1B079}；{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}

基本上，它是说它是一个工作流项目，它是一个 C# 项目。如果您使用的是 VB，请创建一个新的自定义工作流活动，然后在记事本中打开项目文件，您应该会看到可以使用的不同 ProjectTypeGuids 节点。

第二部分是只进入根节点内部的导入语句。这是：

将这两个条目添加到您的项目文件中，可以使工作流扩展在 Visual Studio 中工作，并且可以使您的自定义活动工作 - 即使您从标准类库开始。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-04-06T08:52:43.583

1.  打开 VS Studio 命令提示符
2.  运行以下命令：

    ```
    devenv /installvstemplates 
    ```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-09T13:34:03.860

而是创建一个工作流库并从您的 WPF 应用程序访问它？

查看[DinnerNow](http://www.codeplex.com/DinnerNow)示例应用程序...您可以使用它！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-08-13T07:23:38.543

实际上，当您在项目类型上选择工作流时。右侧还有另一个下拉菜单，其中包含框架 2.0、框架 3.0、框架 3.5。

如果您选择框架 3.5。您将获得更多您要求的项目模板。

谢谢穆图

# c# - 使用 NUnit 的单元测试自定义成员资格提供程序引发空引用错误

> ID：187125
> 
> 赞同：0
> 
> 时间：2008-10-09T12:54:30.693
> 
> 标签：c#, .net, unit-testing, nunit, membership

尝试在测试中创建用户帐户。但是在运行时获取对象引用并没有设置为对象错误的实例。

这是我的 MemberShip 提供程序类，它位于类库 MyCompany.MyApp.Domain.dll 中：

```
using System;
using System.Collections.Generic;
using System.Web.Security;

namespace MyCompany.MyApp.Domain
{
    public class MyMembershipProvider : SqlMembershipProvider
    {
        const int defaultPasswordLength = 8;
        private int resetPasswordLength;

        public override void Initialize(string name, System.Collections.Specialized.NameValueCollection config)
        {
            resetPasswordLength = defaultPasswordLength;
            string resetPasswordLengthConfig = config["resetPasswordLength"];
            if (!String.IsNullOrEmpty(resetPasswordLengthConfig))
            {
                config.Remove("resetPasswordLength");

                if (!int.TryParse(resetPasswordLengthConfig, out resetPasswordLength))
                {
                    resetPasswordLength = defaultPasswordLength;
                }
            }
            base.Initialize(name, config);
        }

        public override string GeneratePassword()
        {
            return Utils.PasswordGenerator.GeneratePasswordAsWord(resetPasswordLength);
        }
    }
} 
```

这是我的单独测试类库 MyCompany.MyApp.Doman.Test.dll 的 App.Config，它引用了我上面的业务域库：

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
    <connectionStrings>
        <add name="SqlServer" connectionString="data source=mycomp\SQL2008;Integrated Security=SSPI;Initial Catalog=myDatabase" providerName="System.Data.SqlClient"/>
    </connectionStrings>
    <system.web>
        <membership defaultProvider="MyMembershipProvider" userIsOnlineTimeWindow="15">
            <providers>
                <clear/>
                <add name="MyMembershipProvider"
                     type="MyCompany.MyApp.Domain.MyMembershipProvider,MyCompany.MyApp.Domain"
                     connectionStringName="SqlServer"
                     applicationName="MyApp"
                     minRequiredNonalphanumericCharacters="0"
                     enablePasswordRetrieval="false"
                     enablePasswordReset="true"
                     requiresQuestionAndAnswer="false"
                     requiresUniqueEmail="true"
                     passwordFormat="Hashed"/>
            </providers>
        </membership>
    </system.web>
</configuration> 
```

这是我抛出“对象引用未设置为对象的实例”的方法

```
public class MemberTest
    {
        public static void CreateAdminMemberIfNotExists()
        {
            MembershipCreateStatus status;
            status = MembershipCreateStatus.ProviderError;

            MyMembershipProvider provider = new MyMembershipProvider();

            provider.CreateUser("Admin", "password", "someone@somewhere.co.uk", "Question", "Answer", true, Guid.NewGuid(), out status);
        }
    } 
```

它抛出 provider.CreateUser 行

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-09T13:06:46.067

我很确定您应该在调用 CreateUser 之前在测试代码中调用 provider.Initialize(...)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-10T09:46:03.290

好吧，并不是所有人都有答案。csgero 是在正确的轨道上虽然初始化是问题。但只是直接调用它并不是一个解决方案。这有效：

```
public class MemberTest
    {
        public static void CreateAdminMemberIfNotExists()
        {
            MembershipCreateStatus status;
            MembershipUser member = Membership.CreateUser("Admin", "password", "email@somewhere.co.uk", "Question", "Answer", true, out status);
        }
    } 
```

我相信直接实例化我的会员提供程序需要设置通常存储在 app.config 或 web.config 中的配置属性，然后调用初始化。然而，在 Mebership 类上调用静态 CreateUser 方法会导致读取配置，然后解析、加载和初始化配置中指定的类型。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-09T13:00:13.570

错误是直接在 provider.CreateUser 上还是在它里面的堆栈的某个地方 - 也许你可以在调用之前检查 null 。

也许缺少依赖关系 - 您是否在路径上获得了相关的 DB dll？

# sql - 如何从 CodeIgniter 中具有相同列名的表中输出数据？

> ID：187137
> 
> 赞同：2
> 
> 时间：2008-10-09T12:58:26.630
> 
> 标签：sql, database, codeigniter

这是我的查询：

```
$query = $this->db->query('
    SELECT archives.id, archives.signature, type_of_source.description, media_type.description, origin.description 
    FROM archives, type_of_source, media_type, origin                                                             
    WHERE archives.type_of_source_id = type_of_source.id                                                          
    AND type_of_source.media_type_id = media_type.id                                                              
    AND archives.origin_id = origin.id                                                                            
    ORDER BY archives.id ASC
'); 
```

但是如何输出结果呢？这有效，但只获取最后一个描述（origin.description）：

```
foreach ($query->result_array() as $row)
{
    echo $row['description'];
} 
```

这不起作用：

```
foreach ($query->result_array() as $row)
{
    echo $row['type_of_source.description'];
} 
```

或者我应该重命名列（例如 type_of_source_description）？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-09T13:09:10.493

这实际上与 CodeIgniter 几乎没有关系，而与 mysql_fetch_assoc 如何提供查询结果有很大关系。

解决方案是您应该使用 重命名查询中的列`"AS"`，例如

```
select type_of_source.description as type_of_source_description, origin.descripotion as origin_descripotion from .... 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T13:57:45.980

只需为 SELECT 语句中的列设置别名。不要修改您的数据库。标准做法是在 SQL 语句中使用别名。

来自 PostgreSQL 的文档`"SELECT"`：

“使用子句 AS output_name，可以为输出列指定另一个名称。”

[PostgreSQL 选择](http://www.postgresql.org/docs/8.0/interactive/sql-select.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-14T11:50:11.123

我建议不要以这种方式使用它，您可以使用`AS`.

# database - 在保持抽象的同时将格式化文本存储在数据库中

> ID：187138
> 
> 赞同：20
> 
> 时间：2008-10-09T12:59:26.100
> 
> 标签：database, text, formatting, abstraction

您将如何将格式化的文本块（换行符、制表符、列表等）存储在数据库（没有具体内容）中以在 Web (XHTML) 上显示，同时保持一定的抽象级别，以便数据可以用于其他应用程序或网站的结构是否会在未来发生变化？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-09T13:01:39.387

我会使用 XML 存储文档的结构，并且总是在将其显示在 Web 浏览器中之前应用一些 XSLT 转换。这样，信息可以适应不同的浏览器，或其他用途，如在普通 UI 中显示或导出到一些纯文本文档。

该结构必须是有意义的，而不仅仅是格式化信息。理想情况下，它将是一些特定领域数据模型的表示。

当然，如果有意义的信息是文档结构，那么没有什么能阻止您定义如下内容：

```
<document>
  <title>SomeTitle</title>
  <paragraph>Some Long paragraph text</paragraph>
</document> 
```

在这种情况下使用 XML 的另一个优点是，如果您的数据库支持它（如 Oracle），您可以查询文本的内容。

我们假设文本不需要经常查询，或者内容实际上仅用于显示目的。否则，规范化数据库可能会更好。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-09T13:55:14.940

您的问题中有两个想法略有冲突 - 将数据与内容分开以便可以重新利用，以及包括格式化数据。

格式化数据是数据的一部分，还是只是元数据？

我们以前没见过吗？它基本上似乎是一个 CSS / HTML 难题。

如果这些文本块符合已知的数据方案（如马里奥的回答所假设的那样），那么是的，我会接受他的回答，但重新阅读你的问题我会回答（并假设）你有一些格式，比如说，马里奥使用的段落标签？

按照这个想法，格式基本上是数据的*一部分*，而不仅仅是额外的，我建议采用类似 CSS / HTML 解决方案的东西。使用标准 XHTML 标签存储文本，为您的 CSS 做好准备。然后，当您想使用标准 UI（如在非 Web 应用程序中？）时，可以对其进行解析，并且只需剥离标签并根据需要进行替换。

当然，您可以编写自己的标记（[myBitOfText #] 而不是 < span class="myBitOfText />），但您也可以从数据库中获得一个不需要重新调整用途或字符串操作的返回值。

# web-services - Web Service请求文件传输的实现思路

> ID：187143
> 
> 赞同：2
> 
> 时间：2008-10-09T13:00:15.440
> 
> 标签：web-services

我有一个用 Java 编写的 Web 服务应用程序 - 我们使用 Glassfish 作为应用程序服务器。以及一个用 .NET 编写的 Web 服务客户端。作为对 Web 服务的请求的结果，我想将文件从服务器传输到客户端。你会推荐我用什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-23T08:52:01.220

一种方法是让您的 Web 服务返回一个字符串，该字符串是文件的 base64 编码版本。然后客户端将解码字符串以取回文件。

# postgresql - 内连接和外连接；表格的顺序很重要吗？

> ID：187146
> 
> 赞同：17
> 
> 时间：2008-10-09T13:00:54.707
> 
> 标签：postgresql

为什么在结合外部和内部联接时表的顺序很重要？以下使用 postgres 失败：

```
SELECT grp.number AS number,     
       tags.value AS tag   
FROM groups grp,
     insrel archiverel  
LEFT OUTER JOIN ownrel ownrel ON grp.number = ownrel.dnumber   
LEFT OUTER JOIN tags tags ON tags.number = ownrel.snumber   
WHERE archiverel.snumber = 11128188 AND    
      archiverel.dnumber = grp.number 
```

结果：

```
ERROR:  invalid reference to FROM-clause entry for table "grp" LINE 5: LEFT OUTER JOIN ownrel ownrel ON grp.number = ownrel.d... 
^ HINT:  There is an entry for table "grp", but it cannot be referenced from this part of the query. 
```

当组在 FROM 中反转时，一切正常：

```
SELECT  grp.number AS number,     
        tags.value AS tag   
FROM    insrel archiverel,
        groups grp
LEFT OUTER JOIN ownrel ownrel ON grp.number = ownrel.dnumber   
LEFT OUTER JOIN tags tags ON tags.number = ownrel.snumber   
WHERE   archiverel.snumber = 11128188 AND    
        archiverel.dnumber = grp.number 
```

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-09T13:39:29.107

我相信您可以将其视为运算符优先级问题。

当你写这个：

```
FROM groups grp,
     insrel archiverel  
LEFT OUTER JOIN ownrel ownrel ON grp.number = ownrel.dnumber   
LEFT OUTER JOIN tags tags ON tags.number = ownrel.snumber 
```

我认为解析器是这样解释的：

```
FROM groups grp,
(
  (
     insrel archiverel  
     LEFT OUTER JOIN ownrel ownrel ON grp.number = ownrel.dnumber   
  )
LEFT OUTER JOIN tags tags ON tags.number = ownrel.snumber
) 
```

如果是这样，那么在最里面的连接中“grp”是未绑定的。

当你用“groups”和“insrel”反转行时，最里面的连接适用于“groups”和“ownrel”，所以它可以工作。

可能这也会起作用：

```
 FROM groups grp
         JOIN insrel archiverel  ON archiverel.dnumber = grp.number
    LEFT OUTER JOIN ownrel ownrel ON grp.number = ownrel.dnumber   
    LEFT OUTER JOIN tags tags ON tags.number = ownrel.snumber 
WHERE archiverel.snumber = 11128188 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-10-09T13:39:04.350

我认为没有人非常清楚这一点，或者解释得很好。您正在组合“旧样式”（theta）和“新样式”（ANSI）连接，我强烈怀疑它们是以您意想不到的方式分组的。这样看：

```
SELECT * FROM a, b JOIN c ON a.x = c.x 
```

就像说

```
SELECT * FROM a, (b JOIN c on a.x = c.x) 
```

其中括号中的东西表示一堆合并到一个虚拟表中的表，以针对“a”的 theta-join 进行连接。显然，“a”表不能成为连接的一部分，因为它只是稍后才加入。反转它，你正在做

```
SELECT * FROM b, (a JOIN c on a.x = c.x) 
```

这是完全可以理解的，很好。我不确定你为什么不使用 ANSI join 语法来处理它，这似乎有点奇怪（而且对必须维护它的人来说很残忍！）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-09T13:06:32.887

因为在第一个中 grp 不是 ON 子句所属的连接的一部分。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-09T13:11:02.517

我不知道是什么导致了这种行为，如果它是一个错误或设计，但如果你坚持使用一种形式的加入或另一种形式，它应该可以正常工作。

```
SELECT grp.number AS number,     
       tags.value AS tag   
FROM groups grp
JOIN insrel archiverel ON archiverel.dnumber = grp.number
LEFT OUTER JOIN ownrel ownrel ON grp.number = ownrel.dnumber   
LEFT OUTER JOIN tags tags ON tags.number = ownrel.snumber   
WHERE archiverel.snumber = 11128188 
```

如果行为是设计使然，我很想知道更多。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-09T13:22:36.643

对于内部连接，表的顺序并不重要。

对于外连接，它是。 *将包含指定一侧的表中的所有*行（是左连接还是右连接），而仅包含另一侧表中与连接条件匹配的行。

因为 OUTER JOINS 保留一侧的所有行，所以据说它们（通常）增加了结果集。INNER JOINS 仅在匹配的情况下保留来自双方的行，因此（通常）说它们是为了减少结果集。因此，您通常希望在 OUTER JOINS 之前执行 INNER JOINS（如果可能）。

在您的情况下，几乎可以肯定是邪恶的 A,B 语法的结果。

# hibernate - 当应用程序使用持久层或存储库时，DBA 是否有角色？

> ID：187153
> 
> 赞同：4
> 
> 时间：2008-10-09T13:02:11.180
> 
> 标签：hibernate, database-design

我正在重新设计一对应用程序，它们在一种情况下使用[Hibernate](http://www.hibernate.org/) ，在第二种情况下使用Hibernate 和 Java [Content Repository](http://en.wikipedia.org/wiki/Content_repository_API_for_Java)（特别是[JackRabbit](http://jackrabbit.apache.org/)）的组合。

重新架构的一个关键问题是提高性能，所以我想知道为应用程序的设计和开发引入[DBA是否有任何价值。](http://en.wikipedia.org/wiki/Database_administrator)

请注意，我并没有质疑让 DBA 参与管理生产数据库的价值。但在过去的项目中，必须让优秀的 DBA 参与设计和编码阶段，找出优化数据结构的方法，将代码放入存储过程等。

但鉴于数据库结构几乎完全由 Hibernate 和 JackRabbit 管理，因此优化它们的空间不大。当然，如果我们发现它们表现不佳，DBA 可能会发现问题，我们可以提交补丁来改进它们，但我不知道我们是否希望（或能够）在应用程序方面做很多事情——具体调优。

想知道 DBA 在这类应用程序中的角色的另一个原因是，我们的大部分性能问题很可能在持久层之上，即不是数据库、hibernate 或 JackRabbit 太慢，而是这样我们已经构建了我们的数据并推动它不是很好。解决这个问题将涉及数据建模，但实现媒介是 XML 文件和 Java 代码，而不是数据库表和 SQL。DBA 通常对这类事情了解很多吗？

使我无法完全排除在设计和开发基于持久层之上的应用程序时对 DBA 的需求的原因是怀疑。我不太相信通过使用预打包的解决方案可以完全消除对特定应用程序进行数据库优化的需求。

我错过了关键点吗？熟练的 DBA 是否可以调整休眠配置文件以使我的应用程序的特定用例变得异常快速？在没有 DBA 手动调整数据库本身、构建索引等的情况下考虑运行高负载 Hibernate 应用程序是不是很疯狂？或者开发领域中是否有专门优化基于 XML 的数据模型和抽象持久层的新生物？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-09T13:18:40.863

有DBA，也有DBA。一些 DBA 是管理员——备份、恢复、授予、撤销——一类的人。保持灯亮。基础的。

其他 DBA 是建筑师/设计师。“解决这个问题将涉及数据建模” 这就是第二层 DBA*应该*做的事情。

许多管理员 DBA 被推入架构师角色——毕竟他们知道 SQL——但并不真正适合它。你知道你找错人了，当...

1.  他们痴迷于表和列的命名约定。

2.  他们痴迷于 FK/PK 关系，而忽略了这样一个事实：一旦您获取了行并将它们制成对象，您就有许多丰富、复杂的集合类可用于管理关系。

3.  他们不能将表中的行与应用程序中的对象以及两者都是实现的现实世界实体分开。这通常可能是一个表演障碍。如果您有一个复杂的现实世界对象，该对象由复杂的编程语言结构实现并且还映射到复杂的数据库结构，那么它可能会令人困惑。有些人退回到他们的舒适区并开始重复无意义的短语，例如“这一切都只是位”或“最终，一切都是 FK，甚至是对象引用”。

4.  要求一切都是存储过程，“因为它更快”。如果他们不能提供证据，情况会更糟。

这就是重点...

性能取决于两件事：**数据结构和算法**。通过选择正确的数据结构和算法来最小化资源使用（I/O、内存等）。

数据库非规范化是一种调整数据结构以匹配算法的方法。其他性能调优基本上是相同的概念：更改参数和选项以使数据结构更好地匹配应用程序算法。

这*应该*是双向的。您应该查看您的实体、您的需求，并制定出正确**的**数据结构和算法。完成此操作后，您可以调整缓冲区的大小等等，以获得更好的性能。

从根本上说，超快的速度来自于考虑最内层最内层的循环：它们在循环什么？他们在寻找什么？如何用不循环或根本不循环的东西替换它们？

如果您的 DBA 可以参与算法和数据结构设计，那么它们就是一种资产，请大量使用它们。

如果您的 DBA 不能参与，请不要将您的设计限制在他们喜欢的范围内。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-09T13:06:50.827

> 在没有 DBA 手动调整数据库本身、构建索引等的情况下考虑运行高负载 Hibernate 应用程序是不是很疯狂？

是的，因为（AFAIK）Hibernate 不对数据库进行任何优化，因为这些东西总是依赖于工作负载。

要解决您更大的问题：当然，您需要一个善于调整数据库以提高性能的人，是的，使用休眠确实会改变所需的技能。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-09T13:18:09.197

Hibernate*可以*控制数据库结构。这并不意味着hibernate*应该*控制它们。

如果您有一个包含大量数据且性能至关重要的大型应用程序，我可能不会使用自动生成的表定义。我想要一个完全优化的数据库结构，然后编写 Hibernate 映射来使用它。如果你有一个稍微懂开发的 DBA，他们甚至可以编写 HQL 或自定义 SQL 来让事情变得更好。

（我从来没有用过 JackRabbit，所以我不能在那里发表评论）

此外，DBA 可能会在测试期间帮助您解决性能问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-09T13:10:18.777

我想说这取决于您的应用程序 - 您仍然可以使用 Hibernate 进行本机查询 - 所以这取决于是否存在任何可能存在并需要调整的查询。同样，它取决于所需的性能 - 如果有任何性能关键部分，您可能需要支持来确定是什么减慢了该部分的速度。还有一些数据库只需要比其他数据库更多的管理员（Oracle ...）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-09T13:13:20.250

我同意[大卫](https://stackoverflow.com/questions/187153/is-there-a-role-for-a-dba-when-an-app-uses-a-persistence-layer-or-repository#187168)。更糟糕的是：使用持久层的开发人员应该具有良好的数据库知识，以了解为什么他们的某些调用非常耗时以及如何找到解决方法。

# optimization - InstallShield Basic MSI 优化

> ID：187155
> 
> 赞同：3
> 
> 时间：2008-10-09T13:03:30.427
> 
> 标签：optimization, windows-installer, installshield

我的 InstallShield 2009 基本 MSI 项目安装非常缓慢。我们有一个 65MB .msi 和一个 110MB .cab。该项目是从 IS12 升级而来的，使用它大约需要一半的时间来安装。

2009 升级是否进行了一些我可以撤销的默认修改？是否有任何可以加快基本 MSI 项目的一般优化？也许删除一些不需要的标准动作，等等......

非常感谢任何建议或线索。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T03:02:57.293

我在以下段落中强调的短语，在[此页面](http://kb.acresso.com/selfservice/documentLink.do?popup=false&externalID=Q200151&languageId=)上找到，描述升级到 2009 的可能问题，可以被视为委婉说法：

> 以前，InstallShield 不支持压缩在构建时流式传输到 Setup.exe 文件或 ISSetup.dll 文件中的文件。因此，如果您将在 InstallShield 2008 或更早版本中构建的版本与在 InstallShield 2009 中使用默认压缩级别构建的相同版本进行比较，您可能会注意到 Setup.exe 或 ISSetup.dll 的文件大小略有不同。此外，***提取文件所需的时间可能略有不同***。

在 IS2009 中，您是否可以更改压缩级别或完全关闭它并重新构建您的项目，看看以这种方式构建是否更快？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-06T02:02:35.373

从 IS12 到 2008 年我遇到了类似的问题，最终我只是硬着头皮从头开始重建项目（对某些对话框、注册表项等使用一些导入/导出）

# visual-studio - Visual Studio 安装项目的良好替代方案

> ID：187169
> 
> 赞同：12
> 
> 时间：2008-10-09T13:07:24.757
> 
> 标签：visual-studio, installation, windows-installer

大多数具有编写软件和使用打包的 Visual Studio 安装项目部署经验的开发人员和工程师都知道它的许多缺点。通常与安装定制、升级路径等有关。软件部署有哪些好的替代方案？特别是我对特性、.NET 集成或脚本功能、易用性和价格感兴趣。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-09T13:10:14.593

*   [Windows 安装程序 XML (Wix)](http://wix.sourceforge.net/)
*   [NullSoft 安装程序](http://nsis.sourceforge.net/Main_Page)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-09T13:16:43.613

NullSoft Installer 一直是我的最爱。它可以创建最小的安装可执行文件。卸载也超级干净。它将去除所有痕迹，并使 PC 保持与安装前相同的形状。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-09T13:40:13.583

NullSoft Installer (NSIS) 很好，但构建脚本很痛苦——即使使用 HM NIS Edit。您基本上必须学习一种完全不同的语言才能使用他们的脚本。例子：

插件也是做很多事情所必需的，例如检查 .NET 框架版本或查看您正在更新的应用程序是否已经在运行。

除此之外，一旦你配置好所有东西，它会很快并且运行良好。那里真的没有更好的安装程序（免费）。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2013-10-07T14:10:08.110

Nullsoft Installer (NSIS) 可能是最好的免费安装系统。

由于 NSIS 没有好的 IDE，我决定创建自己的 IDE——我为 NSIS 开发了非常好的 Visual Studio 扩展，具有许多功能（语法高亮、智能感知、导航栏、编译、错误列表等）。

它被称为**Visual & Installer**，您可以在[www.visual-installer.com](http://www.visual-installer.com)上查看它（对不起，自我宣传 :)

# nsis - 在 NSIS 安装程序中删除标题文本

> ID：187181
> 
> 赞同：1
> 
> 时间：2008-10-09T13:10:18.323
> 
> 标签：nsis

我想用位图替换 NSIS 安装程序中的整个标题区域。我已经设置了 MUI-HEADERIMAGE-BITMAP 并将所有子标题设置为“”，但是在安装文件页面上，我看到位图上方的空白白框通常是文本所在的位置。有没有解决的办法？

干杯，克里斯

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-09T13:31:43.570

为什么不从安装程序中发布相关代码？

这是我使用的：

```
!define MUI_HEADERIMAGE
!define MUI_HEADERIMAGE_BITMAP "Banner.bmp"
!define MUI_HEADERIMAGE_BITMAP_NOSTRETCH
!define MUI_HEADER_TRANSPARENT_TEXT 
```

# java - 如何在外部托管的网站中包含标题？

> ID：187188
> 
> 赞同：2
> 
> 时间：2008-10-09T13:12:00.533
> 
> 标签：java, jsp, include, jspinclude

我们正在为客户托管一个站点，他们希望我们将他们在服务器上的标头包含到我们托管的页面中。因此，无论何时他们更改它，它都会在我们的网站上自动更改。

我们试图在我们的 JSP 代码中使用“include”标签。我们使用的代码如下：

`<%@ include file="www.CLIENT.com/CLIENT2/MiddlePageFiles/Vendor_header.html" %>`

我们也试过

`<%@ include file="**http://**www.CLIENT.com/CLIENT2/MiddlePageFiles/Vendor_header.html" %>`

不幸的是，这些对我们不起作用。似乎正在发生的事情是代码仅在本地查找此文件，并且似乎永远不会去“外部”查找它。

当我们使用 iframe 时，我们可以将标题拉入我们的页面，但由于标题的构造/编码方式，当我们使用 iframe 时，鼠标悬停在下拉菜单上并不能正常工作。下拉菜单在页面上的其余内容下方“层叠”，我们无法将它们带到“顶部”。

作为临时解决方法，我们将 HTML 托管在我们自己的服务器上。

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-09T13:24:24.613

如果您选择在 Java 中执行此操作，那么使用 Apache Commons 的 HttpClient 会非常方便。

```
public static String fetchSourceHtml( String urlString ) {

  try {
    HttpClient httpClient = new HttpClient();
    GetMethod getMethod = new GetMethod( urlString );
    getMethod.setFollowRedirects( true );

    int httpStatus = httpClient.executeMethod( getMethod );

    if (httpStatus >= 400) {
      return "";
    }

    String sourceHtml = getMethod.getResponseBodyAsString();
    return sourceHtml;
  }
  catch (IOException e) {
    return "";
  }
} 
```

对于快速而肮脏的解决方案，您的 JSP 可以直接调用此方法。当然，如果您愿意，可以创建一个 taglib 标记来调用该方法。

您可能想要更改 HttpClient 的超时和重试机制。默认情况下，它会自动尝试最多 3 次，每次尝试在 30 秒后超时。

但是，您可能希望研究将字符串缓存一段合适的时间。您真的不想为访问您网站的每个页面创建 2 个阻止外部 http 请求。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-09T13:17:15.907

JSP 包含不支持包含远程文件，这就是需要相对 URL 的原因：http: [//java.sun.com/products/jsp/syntax/1.2/syntaxref1214.html](http://java.sun.com/products/jsp/syntax/1.2/syntaxref1214.html)

我建议编写一个函数来打开与该页面的连接并下载内容，然后将它们打印到您自己的`out`流中。然后，您可以将该函数放在本地文件中，仅`include`此而已。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T13:52:08.193

如何使用 JSTL 核心库并执行以下操作：

```
<c:import url="http://www.CLIENT.com/CLIENT2/MiddlePageFiles/Vendor_header.html" /> 
```

那应该能够在请求时包含远程内容。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-09T13:24:52.023

JSP 包含并不意味着像外部服务器那样工作。这是解决您的问题的一种完全可怕的方法，但它是我在类似情况下的唯一选择。编写一个类来实际解析来自该站点的 html，然后将其打印出来。我要补充一点，无论何时你要做这样的事情，拥有某种身份验证机制总是一个好主意。

# .net - Response.Redirect("") 在“使用{}”中

> ID：187189
> 
> 赞同：4
> 
> 时间：2008-10-09T13:12:41.343
> 
> 标签：.net, using, response.redirect

假设以下代码：

```
using (SqlConnection conn = new SqlConnection(connectionString))
{
   ...
   using (SqlCommand comm = new SqlCommand(...))
   {
      .. do stuff ..
      if(condition) Response.Redirect("somepage.aspx");

   }
} 
```

Response.Redirect() 从 using 块中退出会导致它处理所有连接吗？

或者，是否有任何方法可以退出不会导致处置的 using 块？

编辑：我不想在没有处置的情况下退出。我想知道任何会导致它不起作用的陷阱。- 当然，除非崩溃，但我很确定所有对象都已处理 - 艰难的方式 - 在那种情况下

我接受了一个答案，基本上说“我不知道”，但这是一个经过充分研究的“我不知道”

同时，我将假设 Response.Redirect 中止 using 语句和代码。-- 除非另有证明。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-09T13:42:16.637

从[http://msdn.microsoft.com/en-us/library/aa973248.aspx](http://msdn.microsoft.com/en-us/library/aa973248.aspx)和[http://msdn.microsoft.com/en-us/magazine/cc163298.aspx](http://msdn.microsoft.com/en-us/magazine/cc163298.aspx)：

> **调用 Response.Redirect 不会执行 finally 块**（*以及特定于语言的关键字，如 C#“使用”语句*）。因此，在任何重定向或处理转移发生之前，您必须处置对象。

但来自[http://msdn.microsoft.com/en-us/library/system.threading.threadabortexception.aspx](http://msdn.microsoft.com/en-us/library/system.threading.threadabortexception.aspx)：

> 当调用 Abort 方法来销毁线程时，公共语言运行时会引发 ThreadAbortException。ThreadAbortException 是一个可以被捕获的特殊异常，但它会在 catch 块结束时再次自动引发。**当引发此异常时，运行时会在结束线程之前执行所有 finally 块。**由于线程可以在 finally 块中进行无限计算，或者调用 Thread..::.ResetAbort 来取消中止，因此无法保证线程将永远结束。如果要等到中止的线程结束，可以调用 Thread..::.Join 方法。Join 是一个阻塞调用，直到线程真正停止执行才返回。

看来要考试了。。。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T13:14:27.020

问：或者，有什么方法可以退出不会导致处置的 using 块？

答：没有。

有关更多信息，请参见：[C#“使用”语法](https://stackoverflow.com/questions/149609/c-using-syntax#149643)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-09T13:18:24.827

Response.Redirect 终止服务器端执行。

在正常的执行过程中，退出 using-block 会触发对象处理。此规则的例外情况可能会发生，例如当进程关闭时、计算机关闭时、线程中止时等。但在正常执行过程中不会发生。

查看 Server.Transfer。它可以帮助您实现目标。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-09T13:29:43.260

来自[http://msdn.microsoft.com/en-us/library/aa973248.aspx](http://msdn.microsoft.com/en-us/library/aa973248.aspx)

> 调用 Response.Redirect 不会执行 finally 块。因此，在任何重定向或处理转移发生之前，您必须处置对象。

是的，它不直接处理 Using 语句，但它是一种足够常见的编程实践，需要注意。另外，那篇文章提到了 SharePoint，但由于 SP 是基于 ASP.NET 2.0 构建的，我认为它仍然是相关的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-09T13:17:35.283

所有 using 语句都是基于范围的。因此，无论您如何退出该函数，当时基于堆栈的每个人都将从使用中清除。例外、退货等

我不知道有什么方法可以阻止一个人开火，即使你出于某种原因想要这样做。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-09T13:18:25.187

为什么要在没有处置的情况下退出 using 块？这不是 using 块的想法。

如果您愿意，请不要使用它，但我不推荐它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-09T13:25:56.233

有什么问题：

> using(SqlCommand comm = new SqlCommand(...))
> {
> ...
> if(condition)
> {
> 
> > //我们已经确定这是真的，所以我们不再需要使用
> > //Disposal Code
> 
> 休息;
> //或继续；if that's better
> }
> //在“if”不成立的情况下执行的代码。
> }
> 
> 响应.重定向（页面）；”

?

# ruby-on-rails - RoR：您在应用程序开发的准备阶段经历了哪些步骤？

> ID：187194
> 
> 赞同：2
> 
> 时间：2008-10-09T13:14:58.640
> 
> 标签：ruby-on-rails, ruby, project-management, project-planning

假设您已经“知道”您的客户想要从您那里得到什么（即您已经进行了一些分析并且对您应该提供什么有所了解）。在此阶段之后，您通常会执行哪些后续步骤？换句话说，在*每个*基于 RoR 的应用程序开发开始时，您会执行哪些步骤（在准备框架、插件、存储库等方面）？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-09T13:29:47.473

我有一个空的 Rails 应用程序，没有插件就无法生存（主要是 haml 和 rspec），并且 Rails 冻结到供应商/插件。我还修改了配置内容以适应我的环境。整个事情都存在于我的 svn 存储库中。当我开始一个新项目时，我会检查我的起点并从那里继续。通常通过写（或试图记住写）一个测试。

它只节省了一个小时左右，但不必弄乱我不经常做的事情（因此必须查找）是一个很大的优势。

编辑：哎呀，我忘了提到更全面的[Bort ...](http://jimneath.org/2008/09/09/bort-base-rails-application/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-10T02:15:13.620

我们通常在工作中做的第一件事是获取一个**托管的虚拟专用服务器 (VPS)**作为**开发服务器**（slicehost？任何适合您的口袋），您可以在其中 ssh 并配置以下内容

1.  设置您选择的**服务器组合**（apache、lighttpd、nginx、thin 等）
2.  设置你认为你会使用的**ruby​​、rails、gem 和插件**
3.  设置您选择的**数据库**
4.  设置您选择的**版本控制软件**（git、mercurial、subversion 等）
5.  为您的项目创建一个**存储库**并签出到您的本地计算机
6.  开始编码，经常签入并经常**部署**以进行客户端测试

我认为让 VPS 为您的应用程序部署一个测试版本是非常值得的，您的同事和客户可以在遇到开发人员忽略的一些错误时进行一些用户测试并发出错误跟踪票。当您的客户不断看到他们的应用程序不断取得进步时，这也会让您的客户感到高兴。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T14:47:58.780

所以你在看线框图，UML，想下一步怎么办？Piston 和 rake 非常适合批量安装你最喜欢的插件（不确定活塞现在与 git 的工作情况如何）：

[http://devblog.rorcraft.com/2007/5/20/a-plugin-for-installing-plugins](http://devblog.rorcraft.com/2007/5/20/a-plugin-for-installing-plugins)

（活塞） [http://piston.rubyforge.org/usage.html](http://piston.rubyforge.org/usage.html)

（也是 git） [http://railsontherun.com/2008/4/16/freezing-rails-with-git](http://railsontherun.com/2008/4/16/freezing-rails-with-git)

这些网站有开源/示例/示例应用程序，您可以查看存储库 [http://www.railsforall.org/apps](http://www.railsforall.org/apps)

[http://www.opensourcerails.com/](http://www.opensourcerails.com/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-12T19:41:28.193

这是另一个类似于 Bort 的入门应用程序：

*   [**BaseApp**](http://ariejan.net/2008/09/28/baseapp-a-quick-start-for-your-rails-app/)

# mod-python - 在 apache 中通过 httpd.conf 和 conf.d 安装 mod_python 有区别吗？

> ID：187195
> 
> 赞同：2
> 
> 时间：2008-10-09T13:15:22.790
> 
> 标签：mod-python, apache

我正在与为我安装 mod_python 的托管服务提供商合作。我按照本地的安装说明将其包含在 httpd.conf 中，但他们选择将其放在 conf.d/python.conf 中。

这样做有什么区别/好处吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-09T13:17:26.000

不，所有文件都是在运行时解析的，您可以包含任意数量的文件。他们刚刚选择分离配置以便于管理。

# algorithm - 树算法

> ID：187198
> 
> 赞同：3
> 
> 时间：2008-10-09T13:16:53.240
> 
> 标签：algorithm, tree, switch-statement

今天早些时候我在想一个小游戏的想法，偶然发现了如何实现它。这个想法是，玩家可以做出一系列动作，产生一点影响，但如果按照特定的顺序进行会产生更大的影响。到目前为止一切顺利，我知道该怎么做。显然，我必须让它变得更复杂（因为我们喜欢让它更复杂），所以我认为序列可能有不止一种可能的路径，它们都会产生更大的影响，尽管是不同的。此外，某些序列的一部分可能是其他序列的开始，甚至整​​个序列可能包含在其他更大的序列中。现在我不确定实现这一点的最佳方法。不过，我有一些想法。

1）我可以实现一个循环n链表。但是由于移动列表永远不会结束，我担心它可能会导致堆栈溢出™。这个想法是每个节点都会有 n 个子节点，并且在收到命令后，它可能会将您带到他的一个子节点，或者，如果没有子节点可用于该命令，则将您带回到起点。到达任何孩子时，都会执行几个功能，从而产生大小影响。但是，这可能会导致树上出现许多重复的节点，以应对所有可能以该特定动作结束并具有不同效果的序列，这可能很难维护，但我不确定。我从来没有在代码上尝试过这么复杂的东西，只是理论上。这个算法是否存在并且有名字？这是个好主意吗？

2）我可以实现一个状态机。然后，我不会在链表中徘徊，而是有一些巨大的嵌套开关来调用函数并相应地更新机器状态。似乎实现起来更简单，但是......好吧......看起来并不有趣......也不优雅。巨型开关在我看来总是丑陋，但这会更好吗？

3) 建议？我很好，但我很缺乏经验。编码领域的好处是，无论你的问题多么奇怪，过去有人解决了它，但你必须知道去哪里找。有人可能有比我更好的主意，我真的很想听听建议。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-09T13:53:59.437

我不能完全确定我完全理解你在说什么，但作为一个类似的情况，假设有人在键盘上输入了无穷无尽的数字流。'117' 是一个魔术序列，'468' 是另一个，'411799' 是另一个（包含第一个）。

因此，如果用户输入：

> 55468411799

您想在 *s 处触发“魔术事件”：

> 55468*4117*99*

或类似的东西，对吧？如果这与您正在谈论的问题相似，那么（类似Java的伪代码）之类的东西呢：

```
MagicSequence fireworks = new MagicSequence(new FireworksAction(), 1, 1, 7);
MagicSequence playMusic = new MagicSequence(new MusicAction(), 4, 6, 8);
MagicSequence fixUserADrink = new MagicSequence(new ManhattanAction(), 4, 1, 1, 7, 9, 9);

Collection<MagicSequence> sequences = ... all of the above ...;

while (true) {
  int num = readNumberFromUser();
  for (MagicSequence seq : sequences) {
    seq.handleNumber(num);
  }
} 
```

而 MagicSequence 有类似的东西：

```
Action action = ... populated from constructor ...;
int[] sequence = ... populated from constructor ...;
int position = 0;

public void handleNumber(int num) {
  if (num == sequence[position]) {
    // They've entered the next number in the sequence
    position++;
    if (position == sequence.length) {
       // They've got it all!
       action.fire();
       position = 0; // Or disable this Sequence from accepting more numbers if it's a once-off
    }
  } else {
    position = 0; // missed a number, start again!
  }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T13:36:05.120

无论如何，您可能都想实现一个状态机，但您不必对状态转换进行硬编码。
尝试制作状态图，其中状态 A 到状态 B 之间的链接意味着 A 可以通向 B。
然后您可以在运行时遍历图以查找玩家去向。

编辑：您可以将图形节点定义为：
-state-id
-指向其他状态的链接列表，其中每个链接定义：
-state-id
-precondition，状态列表在进入此状态之前必须访问的内容

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T13:29:46.240

您所描述的内容听起来与游戏实况文明中的技术树非常相似。

我不知道文明作者是如何构建他们的，但我倾向于使用多重图来表示可能的“动作”——有些你可以在没有“经验”的情况下开始，一旦你进入其中，会有多条路径通到最后。

画出在游戏的每个阶段你可以有哪些潜在的选择，然后画出从一些选项到其他选项的界限。

这应该让您开始实施，因为图表是 [相对] 易于实施和利用的概念。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-09T13:39:08.750

听起来像一个[神经网络](http://en.wikipedia.org/wiki/Neural_network)。您可以创建一个并训练它来识别导致您正在寻找的各种效果的模式。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-09T13:50:19.710

您所描述的内容听起来有点类似于依赖图或单词图。你可能会调查那些。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-09T14:06:54.543

为您想要的每个效果创建一个小型状态机。在每个用户操作中，将其“广播”到所有状态机。大多数人不会在意，但有些人会前进，或者可能会倒退。当其中一个达到它的目标时，产生预期的效果。

为了保持代码整洁，不要对状态机进行硬编码，而是构建一个简单的数据结构来对状态图进行编码：每个状态都是一个带有一系列有趣事件的节点，每个节点都指向下一个状态的节点。每台机器的状态只是对相应状态节点的引用。

编辑：Cowan 的建议似乎与此等价，但他优化了他的状态机以仅表达简单的序列。似乎足以解决您的特定问题，但更复杂的条件可能需要更通用的解决方案。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-09T14:29:39.410

@Cowan，@Javier：好主意，介意我添加吗？

让 MagicSequence 对象监听传入的用户输入流，即通知他们输入（广播），并让他们每个人将输入添加到内部输入流中。当输入不是模式中将让 MagicSequence 触发其操作的预期下一个输入时，此流将被清除。模式完成后，立即触发操作并清除内部输入流。

通过仅向等待它的 MagicSequence 提供输入来优化这一点。这可以通过两种方式完成：

1.  您有一个对象可以让所有 MagicSequence 与与其模式中的数字对应的事件连接。MagicSequence(1,1,7) 会将自身添加到 got1 和 got7，例如：

    UserInput.got1 += MagicSequnece[i].SendMeInput;

2.  您可以对此进行优化，以便在每次输入 MagicSequences 从无效事件中注销并注册有效事件之后。

# ajax - 类似谷歌日历的界面

> ID：187199
> 
> 赞同：7
> 
> 时间：2008-10-09T13:17:01.493
> 
> 标签：ajax, user-interface, google-calendar-api

我需要编写一个应用程序，其功能基本上类似于日历的**周视图**、日期的列和约会的行。约会框的高度在视觉上代表时间。

就我而言，我只是不想将一天中的时间作为纵轴，我只想要几小时或几分钟。我认为**Google AJAX**方法非常干净且易于使用，并且非常完美，但我的主要知识是`ASP.Net`和`Windows Forms (.Net)`.

我不想重新发明轮子，但我发现我的想法一直停留在这个问题上，我必须为此从头开始创建一个界面。我已经检查了**Infragistics 产品**（将其用于其他项目）并阅读了很多关于`Google API's`包括他们的`Ajax Toolkit`. 我还没有完成`Java`，但是学习一门语言不是我的问题，而是学习可以帮助我实现目标的细节，而我认为这将花费大部分时间。

我是在用鼹鼠山造山吗？这真的比我想象的要容易得多吗？这开始听起来像是亲爱的艾比的帖子——我现在就停下来。任何建议或见解都会很棒！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-09T13:30:50.247

我建议你使用一些现有的工具包、lib 或 js 小部件来做到这一点。我发现这个库可能适合你：[ftr-gwt-library](http://code.google.com/p/ftr-gwt-library/)。我开始为此编写一个 GWT 组件，但我没有太多时间来完成它。该站点是[gwt-scheduler](http://code.google.com/p/gwt-scheduler/)。

恕我直言，GWT 非常适合这种类型的 AJAX 应用程序，尽管需要一些时间来理解概念和怪癖（主要是浏览器之间的 css 怪癖）。两个链接都是 GWT 组件，将 GWT 组件暴露给 javascript 相对容易。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-04-15T08:00:59.800

我正在做几乎相同的事情。经过一番谷歌搜索，我发现一个 jquery 插件可能会有所帮助。 [http://www.web-delicious.com/jquery-events-calendar-wdcalendar/](http://www.web-delicious.com/jquery-events-calendar-wdcalendar/) 不幸的是，它的示例是 php，您必须将其转换为 .net 版本

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-06-12T11:42:43.917

[www.web2cal.com](http://www.web2cal.com)将是一个很好的起点？还有几个，如果你在堆栈溢出中搜索你应该能够看到。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-15T17:50:31.653

Check out [gwt-cal](http://code.google.com/p/gwt-cal/) ...

It is an open source calendar for ajax apps written in GWT, which is a great toolkit as Miguel noted above. The calendar can be included in your project, and comes with 3 themes - Outlook, Google Calendar and iCal

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-09-07T17:12:01.180

我使用 jquery/ajax 调用相对容易地编写了这样的东西。我使用了一个基本的 html 表，其中的列是每天，行代表半小时的时间段（在服务器端生成）。我使用 jquery 编写了一个函数，通过隐藏单元格和修改单元格的“rowspan”属性来添加/删除约会。需要两个 ajax 函数，一个用于从服务器加载约会，另一个用于创建/删除用户访问的约会。

不过，我很确定我在那里重新发明了轮子。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-09T13:35:27.647

你是对的——你不应该重新发明轮子。

看看[Telerik Calendar 控件](http://www.telerik.com/products/aspnet-ajax/controls/calendar/overview.aspx)。它提供模板支持：“一组动态模板可用于实现日历天的丰富呈现。您可以“每天”使用此自定义。如果您想实现类似调度程序的界面，它特别有用……”

而且我确信其他第三方控件可以做类似的事情。

# sharepoint - WSS/MOSS 开发...在哪里划清界限？

> ID：187205
> 
> 赞同：1
> 
> 时间：2008-10-09T13:17:45.297
> 
> 标签：sharepoint, moss, wss

我们的组织大约在两年前开始使用 SharePoint 路径。在此之前，我们（开发人员）主要为 SQL 后端编写 asp.net 前端。现在似乎每次出现新项目时，我们都被要求“使其”适合 SharePoint；由于复杂性和与其他技术的交互，我们在 SharePoint 中塞入了一些可能应该是独立应用程序或 Web 应用程序的东西。

我的问题是：对于在 SharePoint 和 Web/Winform 应用程序中开发项目，您在哪里划清界限，您如何让您的经理相信 SharePoint 可能不是特定项目的最佳解决方案？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-09T13:42:06.387

我有点同意你的看法，这有时是一个棘手的问题。不过，总的来说，我同意陈词滥调，即您只需要稍微不同地考虑共享点应用程序即可。如果您的数据可以被认为是基于列表的，那么 SharePoint 可能不一定是一个糟糕的开发框架。从表面上看，这似乎是更多的工作，但 IMO 的挑战只是从一个地方转移到另一个地方。如果您使用自定义字段模板和 Web 部件之类的东西，您可以相对自然地处理各种数据。您还可以免费获得 SharePoint 的积极方面（已经成熟的安全框架、内置搜索、网站和列表模板/定义、个性化页面自定义、yada、yada）。

我也不知道你在这里所说的“复杂性和与其他技术的交互”是什么意思，所以很难想象当 SharePoint 添加到组合中时可能会引入哪些具体问题。

如果您的开发团队在 SharePoint 方面相对缺乏经验，并且您关心质量和截止日期，那么我绝对可以理解您的观点。这不是一个简单的学习曲线，但我认为 SharePoint 产品比许多人认为的更自然地可扩展。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T13:57:15.437

在某些情况下，SharePoint 应用程序和 ASP.NET 应用程序之间存在第三种选择。您可以构建自定义网站和应用程序页面并将它们部署到 SharePoint 网站。（Inside Windows SharePoint Services 3.0 一书很好地概述了如何执行此操作。）这将允许您在 SharePoint 环境中使用 ASP.Net 和 SQL Server（这意味着您还可以利用诸如 SharePoint 安全性之类的东西）。它不像开发一个普通的 ASP.Net 应用程序那么容易，但它是一种折衷方案。

当然，如果他们希望这些新应用程序建立在 SharePoint 技术（列表、库、工作流等）之上，而不仅仅是“在”SharePoint 内部，这在某种程度上是一种技术性问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-10T14:51:14.770

One of the primary reasons why you might put an applicaiton in SP is when you want to take advantage of the building blocks SP gives you:

*   Security (share security with the site)
*   Data (store some or all of your data in lists)
*   Provisioning (if you want you app on multiple sites)
*   Some basic data UI e.g. Lists give you that and you dont need to build it.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-09T13:50:35.760

尝试将新应用程序“集成”到现有池中时要考虑的一件事是，数据（客户、库存等）是否有任何重叠会从合并中受益。

能够在一个地方备份多个应用程序及其所有各自的数据还有一个好处。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-09T20:15:09.340

为什么他们要求将所有内容都纳入 SharePoint？

以我的经验，这是因为'ole SharePoint Intranet 作为一个门户非常棒，可以将所有内容放在一起并在一个信息架构下可以找到。

从对组织中应用程序空间的使用感知来解决问题。

只要应用程序看起来和感觉就像 Intranet 站点的一部分并且用户不必考虑如何访问它（以及如何退出），您几乎可以做出任何必要的架构决策来获得在实施和维护方面，组织的最佳收益。

当我们开始考虑较少从 SharePoint 与其他东西到信息架构、可查找性和可用性等漂亮的毛茸茸概念的网站时，我们决定不在 SharePoint 中实际使用它，但仍然像 Intranet 一样对其进行皮肤变得更容易销售。

# ms-access - 如果 DoCmd.SendObject 失败？

> ID：187207
> 
> 赞同：1
> 
> 时间：2008-10-09T13:17:52.410
> 
> 标签：ms-access, vba, ms-office

我正在使用 DoCmd.SendObject 从 MS access 2003 发送电子邮件。它会打开填充了所有相关字段的 Outlook。但此时用户可能不会选择发送电子邮件。在这种情况下，会出现提示“发送操作已取消”。有没有办法捕捉用户不发送电子邮件

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-10T15:16:22.393

可以将 Microsoft Access 中的 Outlook 事件与类模块一起使用。您将在[LessThanDot wiki](http://wiki.lessthandot.com/index.php/Access_and_Email)的“示例：将 Outlook 事件与 Access 一起使用”标题下找到详细信息

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-09T13:24:01.913

您已将对象发送到 Outlook。

我不相信 Outlook 有办法回复您的 Access 命令。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T19:56:04.120

当 Outlook 无法回复您的 Access 命令时，databyss 是正确的。我建议您不要使用这个松散的“sendObject”命令，而是从您的 VBA 代码创建一个 Outlook 实例（在工具/参考中注册 Microsoft Outlook 对象库之后）？然后，您将能够以非常有效的方式管理您的电子邮件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-11T20:58:51.483

也许 Tony Toews 的[Access EMail FAQ](http://www.granite.ab.ca/Access/email.htm)对您有用。

# java - 使用 Java 将电话号码转换为国际格式 (E.164) 的最佳方法是什么？

> ID：187216
> 
> 赞同：32
> 
> 时间：2008-10-09T13:20:07.460
> 
> 标签：java, validation, formatting, phone-number

使用 Java 将电话号码转换为国际格式 (E.164) 的最佳方法是什么？

给定一个“电话号码”和一个国家/地区 ID（假设是 ISO 国家/地区代码），我想将其转换为标准的 E.164 国际格式电话号码。

我确信我可以很容易地手动完成 - 但我不确定它在所有情况下都能正常工作。

您会推荐哪个 Java 框架/库/实用程序来完成此任务？

PS“电话号码”可以是公众可以识别的任何东西 - 例如

```
* (510) 786-0404
* 1-800-GOT-MILK
* +44-(0)800-7310658 
```

最后一个是我最喜欢的——这是一些人在英国写他们的号码的方式，这意味着你应该使用 +44 或者你应该使用 0。

E.164 格式编号应为全数字，并使用完整的国际国家代码（例如+44）

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2011-03-10T19:30:00.903

Google 提供了一个用于处理电话号码的库。他们用于Android的同一个

[http://code.google.com/p/libphonenumber/](http://code.google.com/p/libphonenumber/)

```
String swissNumberStr = "044 668 18 00"
PhoneNumberUtil phoneUtil = PhoneNumberUtil.getInstance();
try {
  PhoneNumber swissNumberProto = phoneUtil.parse(swissNumberStr, "CH");
} catch (NumberParseException e) {
  System.err.println("NumberParseException was thrown: " + e.toString());
}

// Produces "+41 44 668 18 00"
System.out.println(phoneUtil.format(swissNumberProto, PhoneNumberFormat.INTERNATIONAL));
// Produces "044 668 18 00"
System.out.println(phoneUtil.format(swissNumberProto, PhoneNumberFormat.NATIONAL));
// Produces "+41446681800"
System.out.println(phoneUtil.format(swissNumberProto, PhoneNumberFormat.E164)); 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-10T05:02:44.470

从写这种东西的经验来看，要做到 100% 的可靠性真的很难。为此，我编写了一些 Java 代码，这些代码在处理我们拥有的数据方面相当出色，但并不适用于每个国家/地区。你需要问的问题是：

国家之间的字符到数字映射是否一致？美国使用了很多这种（例如 1800-GOT-MILK），但在澳大利亚，例如，它非常罕见。您需要做的是确保您正在为所讨论的国家/地区进行正确的映射，如果它不同（它可能不会）。我不知道使用不同字母的国家（例如俄罗斯的西里尔语和前东区国家）是做什么的；

您必须接受您的解决方案不会是 100%，而且您不应该期望它会是 100%。您需要采取“最佳猜测”方法。例如，没有真正的方法知道 132345 是澳大利亚的有效电话号码，1300 123 456 也是如此，但这是唯一用于 13xx 号码的两种模式，它们不能从海外拨打；

您还必须询问是否要验证区域（区号）。我相信美国使用的系统是区号的第二个数字是 1 或 0。这可能曾经是这种情况，但我不确定它是否仍然适用。无论如何，许多其他国家会有其他规则。在澳大利亚，固定电话和移动（手机）电话的有效区号是两位数（第一位是 0）。08、03 和 04 都有效。01 不是。你如何满足这一点？你想要_____吗？

各国使用不同的约定，无论他们写多少位数。您必须决定是否要接受“规范”以外的东西。这些在澳大利亚都很常见：

*   (02) 1234 5678
*   02 1234 5678
*   0411 123 123（但我从未见过 04 1112 3456）
*   131 123
*   13 1123
*   131 123
*   1 300 123 123
*   1300 123 123
*   02-1234-5678
*   1300-234-234
*   +44 78 1234 1234
*   +44 (0)78 1234 1234
*   +44-78-1234-1234
*   +44-(0)78-1234-1234
*   0011 44​​ 78 1234 1234（0011是标准国际拨号代码）
*   (44) 078 1234 1234（不常见）

这就是我的想法。为一国。例如，在法国，通常将电话号码以数字对（12 34 56 78）的形式写出来，他们也这样发音：而不是：

un (一), deux (二), trois (三), ...

它的

douze (十二), trente-quatre (三十四), ...

你想迎合这种程度的文化差异吗？我认为不会，但这个问题值得考虑，以防你的规则过于严格。

此外，有些人可能会在电话号码上附加分机号码，可能带有“分机”或类似的缩写。你想迎合那个吗？

抱歉，这里没有代码。只是列出要问自己的问题和要考虑的问题。正如其他人所说，一系列正则表达式可以完成上述大部分工作，但最终电话号码字段（大部分）是一天结束时的自由格式文本。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-10-07T12:51:29.363

这是我的解决方案：

```
public static String FixPhoneNumber(Context ctx, String rawNumber)
{
    String      fixedNumber = "";

    // get current location iso code
    TelephonyManager    telMgr = (TelephonyManager) ctx.getSystemService(Context.TELEPHONY_SERVICE);
    String              curLocale = telMgr.getNetworkCountryIso().toUpperCase();

    PhoneNumberUtil phoneUtil = PhoneNumberUtil.getInstance();
    Phonenumber.PhoneNumber     phoneNumberProto;

    // gets the international dialling code for our current location
    String              curDCode = String.format("%d", phoneUtil.getCountryCodeForRegion(curLocale));
    String              ourDCode = "";

    if(rawNumber.indexOf("+") == 0)
    {
        int     bIndex = rawNumber.indexOf("(");
        int     hIndex = rawNumber.indexOf("-");
        int     eIndex = rawNumber.indexOf(" ");

        if(bIndex != -1)
        {
            ourDCode = rawNumber.substring(1, bIndex);
        }
        else if(hIndex != -1) 
        {               
            ourDCode = rawNumber.substring(1, hIndex);
        }
        else if(eIndex != -1)
        {
            ourDCode = rawNumber.substring(1, eIndex);
        }
        else
        {
            ourDCode = curDCode;
        }           
    }
    else
    {
        ourDCode = curDCode;
    }

    try 
    {
      phoneNumberProto = phoneUtil.parse(rawNumber, curLocale);
    } 

    catch (NumberParseException e) 
    {
      return rawNumber;
    }

    if(curDCode.compareTo(ourDCode) == 0)
        fixedNumber = phoneUtil.format(phoneNumberProto, PhoneNumberFormat.NATIONAL);
    else
        fixedNumber = phoneUtil.format(phoneNumberProto, PhoneNumberFormat.INTERNATIONAL);

    return fixedNumber.replace(" ", "");
} 
```

我希望这可以帮助有同样问题的人。

自由享受和使用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-12T01:15:04.227

感谢您的回答。如原始问题所述，我对将数字格式化为标准格式更感兴趣，而不是确定它是否是有效的（如真实的）电话号码。

我目前有一些手工制作的代码，它需要一个电话号码字符串（由用户输入）和一个源国家上下文和目标国家上下文（拨打号码的国家，以及拨打号码的国家） - 这是系统已知的），然后分步进行以下转换

1.  从数字中删除所有空格

2.  将所有字母转换为数字 - 使用字母到数字的查找表（例如 A-->2、B-->2、C-->2、D-->3）等用于键盘（我不知道一些键盘以不同的方式分配这些）

3.  去掉所有标点符号 - 如果前面的“+”存在，则保持原样（如果数字已经采用某种国际格式）。

4.  确定该号码是否具有国家上下文的国际拨号前缀 - 例如，如果源上下文是英国，我会查看它是否以“00”开头 - 并将其替换为“+”。我目前不检查“00”后面的数字是否后跟目标国家的国际拨号代码。我在查找表中查找源国家/地区的国际拨号前缀（例如 GB-->'00'、US-->'011' 等）

5.  确定该号码是否具有国家上下文的本地拨号前缀 - 例如，如果源上下文是英国，我会查看它是否以“0”开头 - 并将其替换为“+”，然后是国际拨号目标国家的代码。我在查找表中查找源国家的本地拨号前缀（例如 GB-->'0'、US-->'1' 等），并在另一个查找表中查找目标国家的国际拨号代码（例如'GB'='44', US='1')

到目前为止，它似乎适用于我所抛出的所有内容 - 除了 +44(0)1234-567-890 情况 - 我将为那个添加一个特殊情况检查。

编写它并不难 - 我可以为遇到的每个奇怪异常添加特殊情况。但我真的很想知道是否有标准解决方案。

电话公司似乎每天都在处理这件事。使用 PSTN 拨打号码时，我从来没有得到不一致的结果。例如，在美国（手机与固定电话的区号相同，我可以拨打 +1-123-456-7890 或 011-1-123-456-7890（其中 011 是US 和 1 是美国的国际拨号代码）、1-123-456-7890（其中 1 是美国的本地拨号前缀）甚至 456-7890（假设我当时在 123 区号）并且每次都得到相同的结果。我假设这些拨打的号码在内部被转换为相同的 E.164 标准格式，并且转换都是在软件中完成的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-30T16:23:37.827

老实说，听起来您已经涵盖了大部分基础。

在英国，有时（错误地）使用的 +44(0)800 格式很烦人，并且根据 E.123 并不严格有效，这是 ITU-T 关于如何显示数字的建议。如果您还没有 E.123 的副本，那么值得一看。

无论如何，电话网络本身并不总是使用 E.164。PBX 生成的 ISDN 信号中通常会有一个标志（如果您使用的是蒸汽电话，则在网络中），它告诉网络所拨打的号码是本地、国内还是国际。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-10T05:35:54.107

在某些国家/地区，您可以将 112 验证为有效的电话号码，但如果您在其前面加上国家代码，它将不再有效。在其他国家/地区，您无法验证 112，但您可以将 911 验证为有效的电话号码。

我见过一些手机将 Q 放在 7 键上，将 Z 放在 9 键上。我见过一些手机将 Q 和 Z 放在 0 键上，有些手机将 Q 和 Z 放在 1 键上。

昨天存在的区号今天可能不存在，反之亦然。

在北美的一半地区（国家代码 1），区号的第二位数字规则曾经是 0 或 1，但该规则在 10 年前就消失了。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-12T04:23:14.147

我不知道可用于将电话号码格式化为 E.164 的标准库或框架。

用于我们产品的解决方案需要将 PBX 提供的 caller-id 格式化为 E.164，部署一个包含所有适用国家/地区的 E.164 格式信息的文件（数据库表）。这样做的好处是可以更新应用程序（以处理各种 PSTN 网络中的所有奇怪的极端情况），而无需更改生产代码库。

该表包含每个国家代码的一行以及关于区号长度和用户长度的信息。一个国家/地区可能有多个条目，具体取决于区号和用户号码长度可能发生的变化。

以新西兰 PSTN（部分）拨号方案为例。

```
CC  AREA_CODE  AREA_CODE_LENGTH  SUBSCRIBER  SUBSCRIBER_LENGTH
64                            1              7
64         21                 2              7
64        275                 3              6 
```

我们会执行与您所描述的类似的操作，即去除所提供的电话号码中的任何非数字字符，然后根据有关总体号码计划长度、外部接入代码和长途/国际接入代码的各种规则进行格式化。

# macos - 如何让终端程序尊重光标键？

> ID：187219
> 
> 赞同：2
> 
> 时间：2008-10-09T13:21:03.137
> 
> 标签：macos, lisp, terminal

我在 Mac OS X 上使用 ccl/openmcl。（两者的最新版本）。当显示 lisp 提示时，使用光标键导航当前行会产生转义码，而不是移动，例如：

`Welcome to Clozure Common Lisp Version 1.2-r9226-RC1 (DarwinX8664)!
? (^[[D`

在这里，我按下了`(`键，然后按下了`left cursor`键。

当我在 Debian Etch 盒子上运行 ccl/openmcl 时，光标会按预期运行，并将插入点向左移动一个位置。

我想这是某种终端配置选项？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-09T14:01:16.847

如果 Clozure CL 不提供本机 readline/editline/whatever 支持或配置为不使用它，您可以使用 rlwrap 运行它，例如：

```
rlwrap openmcl 
```

rlwrap 可以通过[MacPorts](http://www.macports.org/)或直接从[http://utopia.knoware.nl/~hlub/rlwrap/](http://utopia.knoware.nl/~hlub/rlwrap/)获得。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T17:05:00.190

我知道我没有用这个来回答这个问题，但你不应该花太多时间直接使用 lisp repl。

使用 emacs 和[slime](http://common-lisp.net/project/slime/)是一种更方便的与 lisp 交互的方式。你手头有一个检查器和一个调试器，你可以跳转到函数的源代码，等等。

# jquery - 为什么 JQuery keydown 适用于窗口而不适用于文本框？

> ID：187229
> 
> 赞同：3
> 
> 时间：2008-10-09T13:24:15.580
> 
> 标签：jquery

为什么会这样：

```
$(window).keydown(function(event){
    alert(event.keyCode);
}); 
```

但不是这个：

```
$('#ajaxSearchText').keydown(function(event){
    alert(event.keyCode);
}); 
```

我正在使用 Firefox 3 进行测试。有趣的是，它们都不能在 IE7 中运行。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-10T05:18:41.817

在 Chrome、IE7 和 Firefox 3.0.3 中检查了这一点。正常工作。jQuery 版本 1.2.6。

```
<html> 
  <head> 
    <script type="text/javascript" src="jquery-1.2.6.js"></script> 
    <script type="text/javascript"> 
      $(function() 
      {
        $("#ajaxSearchText").keydown(function(event)
        {
          alert(event.keyCode);
        });
      });
    </script> 
  </head> 
  <body> 
    <input type="text" id="ajaxSearchText"></input>
  </body> 
</html> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-03T18:09:38.073

要修复 IE6 和 IE7 中的问题，请尝试此操作...

```
$(function() 
{
    $(document).keydown(function(event){
        alert(event.keyCode);
    });
}); 
```

将事件附加到`$(document)`这里似乎是神奇的事情。

不过，您的第一段代码也应该在 IE 中工作。它似乎归结为 jQuery 中的一个错误，有望很快得到修复......

这是 jQuery 中的错误报告的链接。[https://bugs.jquery.com/ticket/3614](https://bugs.jquery.com/ticket/3614)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-21T09:54:39.260

对于您所有的 keydown/keyup/keyboard 需求，请使用 jQuery 热键插件。

几个月前看到这个，它永远不会给它留下深刻印象。按照插件演示的跳转... [http://code.google.com/p/js-hotkeys/](http://code.google.com/p/js-hotkeys/)

它映射键盘上的所有键，包括组合键。希望能帮助到你！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-09T13:35:26.510

尝试使用

```
$('#ajaxSearchText').keyup(function(event){
    alert(event.keyCode);
}); 
```

完美地为我工作。还要检查 textarea 的 id

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-05-24T18:01:32.487

```
$('#searchInput').keydown(function() {
    alert('testing');
}); 
```

不管用。但是，如果将其包装在一个函数中：

```
$(function()
{
    $('#searchInput').keydown(function() {
        alert('testing');
    });
}); 
```

它会起作用的。

如果没有该函数声明，它仅适用于文档和窗口等对象。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2010-03-27T01:11:31.580

因为“窗口”对象不支持键事件。

[http://www.w3schools.com/jsref/obj_window.asp](http://www.w3schools.com/jsref/obj_window.asp)

但仅在“文档”上：

[http://www.w3schools.com/jsref/dom_obj_event.asp](http://www.w3schools.com/jsref/dom_obj_event.asp)

如果它曾经工作过，那么它就是 jQuery 中的一个错误。

# xml - 如何选择特定命名空间中的元素？

> ID：187231
> 
> 赞同：2
> 
> 时间：2008-10-09T13:24:26.267
> 
> 标签：xml, xpath, xml-namespaces, xalan, xmlspy

我在选择属于特定命名空间的元素时遇到问题。我的 xpath 表达式在 XMLSpy 中工作，但在使用 Xalan 库时失败..

```
<item>
   <media:content attrb="xyz">
     <dcterms:valid>VALUE</dcterms:valid>
  </media:content>
</item> 
```

我的表情是`./item/media:content/dcterms:valid`。我已经将这两个名称空间定义都添加到了我的 XSLT 中。同样，这会在 XMLSpy 中选择正确的值，但在通过 Xalan 库运行时会失败。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-12T18:22:54.043

You'll need to implement a [`org.apache.xml.utils.PrefixResolver`](http://xml.apache.org/xalan-j/apidocs/org/apache/xml/utils/PrefixResolver.html) to map the prefix to namespace URI, and then pass an instance to the `XPath` instance you use. This will allow you to use different prefixes in your XPath expressions from those in your documents (which you might not control).

For example, you could create an implementation that uses a pair of maps (one to map from prefix -> namespace URI, and one from URI to prefix).

In JAXP, the equivalent interface to implement is [`javax.xml.namespace.NamespaceContext`](http://java.sun.com/javase/6/docs/api/javax/xml/namespace/NamespaceContext.html).

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-12T18:42:58.590

You could try a XPath select on the local-name and (optionally) give a namespace URI. And example:

```
/*[local-name()='NewHireList' and namespace-uri()='http://BRE.NewHireList']/*[local-name()='Record' and namespace-uri()=''] 
```

See [this page](http://geekswithblogs.net/brokenrules/archive/2005/06/06/42250.aspx) for more, or google on local-name and XPath.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-09T13:52:19.643

您是否尝试过定义 XML blob 的命名空间？

```
<item xmlns:dcterms="http://dcterms.example" xmlns:media="http://media.example">
   <media:content attrb="xyz">
     <dcterms:valid>VALUE</dcterms:valid>
  </media:content>
</item> 
```

IE

*   xmlns:dcterms="http://dcterms.example"
*   xmlns:media="http://media.example"

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-11T11:28:17.813

XML 中的前缀在绑定到某个命名空间之前是没有意义的，对于 XPath 表达式也是如此——它不会仅仅因为您使用了相同的前缀而匹配。

您必须创建自己的 PrefixResolver 类，该类将为您在 XPath 表达式中拥有的前缀提供完整的命名空间 URI。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-10T19:41:02.547

您在什么情况下尝试评估您的 XPath？（例如，一个 XSLT？）如果是根元素，您可以尝试删除前导“.”：“/item/media:content/dcterms:valid.” 如果有一系列项目，您可以尝试在开头添加另一个斜杠：“//item/media:content/dcterms:valid”。这将选择文档中与该标准匹配的所有项目，无论它们位于文档结构中的哪个位置。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-10T17:02:36.517

也许 XMLSpy 已经实现了 2.x XSLT 规范，我相信 XPath 是其中的一部分。另一方面，Xalan 仍然是 1.x。

# .net - 将 FromBase64Transform 与 CryptoStream 一起使用？

> ID：187237
> 
> 赞同：0
> 
> 时间：2008-10-09T13:29:16.320
> 
> 标签：.net

我有一个 .NET 字符串，它是加密字节数组的 Base64 编码表示。它是这样产生的：

```
String Encrypt( String message )
{
    CryptoStream cryptostream = ...
    StreamWriter stream = new StreamWriter( cryptostream );
    ...
    return Convert.ToBase64String( ... );
} 
```

现在我想要一个解密功能

```
String Decrypt( String cypher )
{
    TextReader reader = new StringReader( cypher );
    byte[] buffer = new byte[ cypher.Length ];
    for( int i = 0; i < cypher.Length; ++i )
    {
        buffer[ i ] = (byte) reader.Read();
    }
    FromBase64Transform transformer = new FromBase64Transform();
    MemoryStream raw = new MemoryStream
    ( 
        transformer.TransformFinalBlock( buffer, 0, buffer.Length )
    );
    ...
} 
```

有没有办法*直接*将 FromBase64Transform与 CryptoStream 一起使用（如 .NET 文档所建议的那样），而不是手动将字符串转换为字节，然后手动解码字节，最后解密解码的字节？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-10T14:36:42.490

我总是使用[Convert](http://msdn.microsoft.com/en-us/library/system.convert.frombase64string.aspx)类将字符串转换为 Byte 数组。

一个例子：

```
 public static string DeCryptString(string s) {
        byte[] b = System.Convert.FromBase64String(s);

        using (MemoryStream ms = new MemoryStream(b)) 
        using (CryptoStream cs = /* Create decrypting stream here */)
        using (StreamReader sr = new StreamReader(cs)) {
            string buf = sr.ReadToEnd();
            return buf;
        }
    } // DeCryptString 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-09T14:43:10.257

从 .NET 3.5 开始，没有从字符串流式传输的公共内置方式。

您可以实现一个从 Stream 继承的简单 StringStream 类，这将使您不必将字符串转换为字节数组。

# ftp - 创建 FTP 站点的站点地图

> ID：187245
> 
> 赞同：0
> 
> 时间：2008-10-09T13:30:16.973
> 
> 标签：ftp, sitemap

在我工作的地方，我们维护一个需要偶尔清理的 FTP 站点。

是否有任何工具可以创建 FTP 站点的站点地图？这将大大简化清理任务。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T00:19:36.973

你希望它有多自动化？用什么语言？

我使用 Perl Net::FTP 模块制作了一个蜘蛛来遍历结构并报告差异。

[Perl ftp 列表目录](http://www.example-code.com/perl/ftp_listDirectory.asp)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-09T14:14:33.420

没用过，而且不是免费的——虽然 19 美元离免费不远[——ftp 空间](http://ftp-space.qarchive.org/?bcsi_scan_CAE56E148E64F880=0)

# wpf - 寻找 Expression Blend 设计师

> ID：187252
> 
> 赞同：5
> 
> 时间：2008-10-09T13:32:04.363
> 
> 标签：wpf, expression-blend

对于寻找 Expression Blend/WPF 设计师来执行合同工作有哪些建议？我认为（本地）自由设计师可能是价格最合理的，但我什至不知道从哪里开始。

作为额外的背景，我位于美国中西部地区，那里的设计师并不普遍。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-09T13:34:16.497

Craigslist 很棒，特别是如果您将与某人远程合作。我也是 LinkedIn 的忠实粉丝。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T13:58:19.677

我想你可能会发现现在很难找到这些人……因为大多数设计师都熟悉 Adob​​e 产品套件，而不是 Expression 套件。

我认为很多人都在学习需要培养这些技能……具有设计师倾向的软件开发人员是否更倾向于设计人员……或者具有开发人员倾向的设计师是否更倾向于开发人员。我是前者的一个例子。

我还要补充一点，当那个人不在附近工作时（因为大多数自由职业者在异地甚至很远的地方工作），培养这些技能要困难得多。

话虽如此，我相信每个人都想知道你是否成功地找到了具有这些技能的人......以及你在哪里找到了他们。

你可能会觉得这篇[文章](https://stackoverflow.com/questions/51624/designers-and-developers-working-together)也很有趣。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T14:59:45.373

是的，我同意 Expression Blend“整合者”的角色很难找到。查看该[网站](http://projectrosetta.com/)，该网站旨在促进设计界[http://projectrosetta.com/](http://projectrosetta.com/)

# mysql - 如何在 MySQL If 语句中有一个范围？

> ID：187255
> 
> 赞同：3
> 
> 时间：2008-10-09T13:33:23.643
> 
> 标签：mysql

我正在尝试选择计算会员支出。

我的方法很简单。

```
SELECT
 month(payments.timestmap)
,sum(if(payments.amount>=29.95,4,0)) As Tier4
,sum(if(payments.amount>=24.95<=29.94,3,0)) As Tier3
,sum(if(payments.amount>=19.95<=24.94,2,0)) As Tier2
FROM payments
GROUP BY month(payments.timestamp) 
```

以上不起作用，因为 MySQL 没有评估条件的第二部分。顺便说一句，它不会导致语法错误，并且选择将返回结果。

在上述之前，我尝试了我假设会像“ `amount between 24.94 AND 29.94`”一样工作的东西，这导致了一个错误。所以我尝试了“ `amount >= 24.94 AND <= 29.94`”

那么是否可以在 MySql 中使用 IF 进行范围比较？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-09T13:37:54.977

表达式的第二部分在您使用时进行评估`AND`-

```
SELECT
 month(payments.timestmap)
,sum(if(payments.amount>=29.95,4,0)) As Tier4
,sum(if(payments.amount>=24.95 AND payments.amount<=29.94,3,0)) As Tier3
,sum(if(payments.amount>=19.95 AND payments.amount<=24.94,2,0)) As Tier2
FROM payments
GROUP BY month(payments.timestamp) 
```

我不完全确定为什么该`between`条款对您不起作用，但上述内容应该可以完成。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-09T13:39:37.220

MySQL中始终存在[BETWEEN...AND...运算符。](http://dev.mysql.com/doc/refman/5.0/en/comparison-operators.html#operator_between)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T13:40:46.157

你的第一次尝试给你带来了什么错误？它绝对应该有效。但是，请注意，您拥有的第二种形式是不正确的语法。应该是`amount >= 24.94 and amount <= 29.94`。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-09-28T14:32:43.103

```
SELECT
month( payments.timestamp )
,sum( if( payments.amount >= 29.95, 4, 0 ) )  As Tier4
,sum( if( payments.amount BETWEEN 24.95 AND 29.94, 3, 0 ) ) As Tier3
,sum( if( payments.amount BETWEEN 19.95 AND 24.94, 2, 0 ) ) As Tier2
FROM payments
GROUP BY month( payments.timestamp ) 
```

这也应该有效，我使用 BETWEEN 和 > < 进行了测试，以确保它们在我的一个查询中工作相同。所以是的，两者都有效。

# python - 使用 Python 的 Base-2（二进制）表示

> ID：187273
> 
> 赞同：6
> 
> 时间：2008-10-09T13:38:32.947
> 
> 标签：python

基于[How Do You Express Binary Literals in Python](https://stackoverflow.com/questions/1476/how-do-you-express-binary-literals-in-python#13107)，我正在考虑以合理、直观的方式来实现以 2 为基数显示整数的 Programming 101 栗子。这是我想出的最好的，但我想用一种更好的算法来代替它，或者至少是一种应该具有极快性能的算法。

```
def num_bin(N, places=8):
    def bit_at_p(N, p):
        ''' find the bit at place p for number n '''
        two_p = 1 << p   # 2 ^ p, using bitshift, will have exactly one
                         # bit set, at place p
        x = N & two_p    # binary composition, will be one where *both* numbers
                         # have a 1 at that bit.  this can only happen 
                         # at position p.  will yield  two_p if  N has a 1 at 
                         # bit p
        return int(x > 0)

    bits =  ( bit_at_p(N,x) for x in xrange(places))
    return "".join( (str(x) for x in bits) )

    # or, more consisely 
    # return "".join([str(int((N & 1 << x)>0)) for x in xrange(places)]) 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-09T14:29:59.550

为了获得最佳效率，您通常希望一次处理多个位。您可以使用一种简单的方法来获得固定宽度的二进制表示。例如。

```
def _bin(x, width):
    return ''.join(str((x>>i)&1) for i in xrange(width-1,-1,-1)) 
```

_bin(x, 8) 现在将给出 x 的低 8 位的零填充表示。这可用于构建查找表，允许您的转换器一次处理 8 位（如果您想将内存用于它，则可以更多）。

```
_conv_table = [_bin(x,8) for x in range(256)] 
```

然后你可以在你的真实函数中使用它，在返回它时去掉前导零。我还添加了对有符号数的处理，因为没有它你将得到一个无限循环（负整数在概念上具有无限数量的设置符号位。）

```
def bin(x):
    if x == 0: 
        return '0' #Special case: Don't strip leading zero if no other digits
    elif x < 0:
        sign='-'
        x*=-1
    else:
        sign = ''
    l=[]
    while x:
        l.append(_conv_table[x & 0xff])
        x >>= 8
    return sign + ''.join(reversed(l)).lstrip("0") 
```

[编辑] 更改代码以处理有符号整数。
[Edit2] 以下是各种解决方案的一些时序图。bin 是上面的函数， constantin_bin 来自[康斯坦丁的答案](https://stackoverflow.com/questions/187273/base-2-binary-representation-using-python#189579)， num_bin 是原始版本。出于好奇，我还尝试了上面的 16 位查找表变体（下面的 bin16），并尝试了 Python3 的内置 bin() 函数。所有计时都是使用 01010101 位模式运行 100000 次。

```
Num Bits:              8       16       32       64      128      256
---------------------------------------------------------------------
bin                0.544    0.586    0.744    1.942    1.854    3.357 
bin16              0.542    0.494    0.592    0.773    1.150    1.886
constantin_bin     2.238    3.803    7.794   17.869   34.636   94.799
num_bin            3.712    5.693   12.086   32.566   67.523  128.565
Python3's bin      0.079    0.045    0.062    0.069    0.212    0.201 
```

正如你所看到的，当使用大块处理长值时确实有回报，但没有什么比 python3 内置的低级 C 代码更好的了（奇怪的是，它在 256 位上似乎始终比 128 位更快！）。使用 16 位查找表可以改善一些事情，但除非你真的需要它，否则可能不值得，因为它会占用大量内存，并且可能会引入一个小但值得注意的启动延迟来预先计算表。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-09T23:24:24.200

不是快速尖叫，而是直截了当：

```
>>> def bin(x):
...     sign = '-' if x < 0 else ''
...     x = abs(x)
...     bits = []
...     while x:
...             x, rmost = divmod(x, 2)
...             bits.append(rmost)
...     return sign + ''.join(str(b) for b in reversed(bits or [0])) 
```

它也比`num_bin`：

```
>>> import timeit
>>> t_bin = timeit.Timer('bin(0xf0)', 'from __main__ import bin')
>>> print t_bin.timeit(number=100000)
4.19453350997
>>> t_num_bin = timeit.Timer('num_bin(0xf0)', 'from __main__ import num_bin')
>>> print t_num_bin.timeit(number=100000)
4.70694716882 
```

更重要的是，它实际上可以正常工作（对于我对“正确性”的定义:)）：

```
>>> bin(1)
'1'
>>> num_bin(1)
'10000000' 
```

# css - IE7 中奇怪的浮动行为

> ID：187279
> 
> 赞同：12
> 
> 时间：2008-10-09T13:39:43.490
> 
> 标签：css, internet-explorer-7, css-float

我想创建一个带有标题栏的简单框，其中包含标题和一些工具按钮。我有以下标记：

```
<div style="float:left">
    <div style="background-color:blue; padding: 1px; height: 20px;">
        <div style="float: left; background-color:green;">title</div>
        <div style="float: right; background-color:yellow;">toolbar</div>
    </div>
    <div style="clear: both; width: 200px; background-color: red;">content</div>
</div> 
```

这在 Firefox 和 Chrome 中表现良好：

[http://www.boplicity.nl/images/firefox.jpg](http://www.boplicity.nl/images/firefox.jpg)

然而 IE7 完全搞砸了，把右边的浮动元素放在页面的右边：

[http://www.boplicity.nl/images/ie7.jpg](http://www.boplicity.nl/images/ie7.jpg)

这可以解决吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-09T13:46:23.977

指定最外层 div 的宽度。如果你的内容 div 中的宽度意味着这是你的盒子的总宽度，只需将它添加到最外层的 div，并（可选）将它从内容中删除，如下所示：

```
<div style="float:left; width: 200px;">
    <div style="background-color:blue; padding: 1px; height: 20px;">
        <div style="float: left; background-color:green;">title</div>
        <div style="float: right; background-color:yellow;">toolbar</div>
    </div>
    <div style="clear: both; background-color: red;">content</div>
</div> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-09T15:37:17.997

这只是一个快速的答案，所以如果它不起作用，我会举手。我认为如果您只添加最小宽度而不是宽度，Marko 的解决方案可能会起作用。如果您也想迎合 ie6，则可能需要使用 hack，因为 ie6 及其后代不支持最小宽度。

所以这应该适用于 IE7 和其他现代浏览器。将最小宽度设置为合适的值。

```
<div style="float:left; min-width: 200px;">
    <div style="background-color:blue; padding: 1px; height: 20px;">
        <div style="float: left; background-color:green;">title</div>
        <div style="float: right; background-color:yellow;">toolbar</div>
    </div>
    <div style="clear: both; background-color: red;">content</div>
</div> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-24T19:39:19.840

我使用 jQuery 修复了它以模拟非 IE 浏览器的行为：

```
 // IE fix for div widths - size header to width of content
    if (!$.support.cssFloat) {
        $("div:has(.boxheader) > table").each(function () {
                $(this).parent().width($(this).width());
        });
    } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-11-13T19:42:27.580

尝试放入`position:relative;`父元素和子元素。它为我解决了这个问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-01-06T15:19:25.603

最近知道，正确的浮动元素需要在其他元素之前附加 div。这是最简单的修复，无需添加任何更改。

```
<div style="background-color:blue; padding: 1px; height: 20px;">
    <div style="float: right; background-color:green;">title</div>
    <div style="float: left; background-color:yellow;">toolbar</div>
</div> 
```

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2008-10-09T13:45:42.293

使其`<div style="background-color:blue; padding: 1px; height: 20px;>`成为 2 个浮动 div 的父级`clear:all`

# sql - SQL SELECT FROM ... AS 带有数据类型说明符？

> ID：187281
> 
> 赞同：11
> 
> 时间：2008-10-09T13:40:13.037
> 
> 标签：sql, postgresql

我对 Postgresql 上的 SQL 查询有疑问。此 select 子句是数据库讲座中的一个示例：

```
1 select t.CourseNr, t.StudentsPerCourse, g.StudentCount, 
2        t.StudentsPerCourse/g.StudentCount as Marketshare
3 from (select CourseNr, count(*) as StudentsPerCourse
4       from taking
5       group by CourseNr) t,
6      (select count(*) as StudentCount
7       from Students) g; 
```

问题出在第 2 行的 Marketshare 列。StudentPerCourse 和 StudentCount 都是整数类型。

在我的 Postgresql 数据库上使用它时，Marketshare 列被评估为 int 类型，而我在这里需要一个浮点/数字。通过搜索 SELECT 子句的 Postgresql 文档或谷歌搜索，我没有找到任何方法来指定数据类型。是否有（最好是标准 SQL）方法来指定列类型，或者我在这里遗漏了什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-09T13:43:30.517

CAST() 一个或两个源列作为小数/浮点/实数/双精度/等类型。

# asp.net - log4net 不记录 ThreadContext

> ID：187284
> 
> 赞同：6
> 
> 时间：2008-10-09T13:40:37.513
> 
> 标签：asp.net, log4net

我在我的 AsP.NET 站点上运行 log4net。我可以将消息记录到我的数据库表中，但它没有记录 ThreadContext 属性。例如：

```
ThreadContext.Properties["Url"] = HttpContext.Current.Request.Url.ToString();
ThreadContext.Properties["HttpReferer"] = HttpContext.Current.Request.ServerVariables["HTTP_REFERER"]; 
```

我的 log4net.config 将这些值作为参数添加到我的 SQL DB 表中：

```
<parameter>
    <parameterName value="@URL"/>
    <dbType value="String"/>
    <size value="512"/>
    <layout type="log4net.Layout.PatternLayout">
        <conversionPattern value="%property{log4net:Url}"/>
    </layout>
</parameter>
<parameter>
    <parameterName value="@HttpReferer"/>
    <dbType value="String"/>
    <size value="512"/>
    <layout type="log4net.Layout.PatternLayout">
        <conversionPattern value="%property{log4net:HttpReferer}"/>
    </layout>
</parameter> 
```

当我调试时，我看到那些 ThreadContext 属性正在设置，但它们没有进入数据库。

我怎样才能让它工作？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-09T19:08:30.643

所以，事实证明配置是罪魁祸首。有点不对劲：

原来的：

```
<conversionPattern value="%property{log4net:HttpReferer}"/> 
```

改变：

```
<conversionPattern value="%property{HttpReferer}"/> 
```

我不得不取出财产内部的“log4net：”。

奇怪的是，一个属性仍然需要 log4net:propertyName。我完全不知道为什么它会以这种方式工作，但这就是有效的解决方法！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-09T14:09:41.167

你能打开 log4net verbose/debug/show sql 看看它在那个级别做了什么吗？是否可能需要其他一些配置才能将它们捆绑在一起？

# asp.net - LinqtoSQL 和问题

> ID：187287
> 
> 赞同：0
> 
> 时间：2008-10-09T13:40:55.500
> 
> 标签：asp.net, vb.net, linq, linq-to-sql

我正在使用指向 sql 的链接，我有一组连接的对象。

我开始做这样的 linq 语句

```
Dim L= from II in context.InventoryItems select II
Dim L2 = L.tolist 
```

第二行是为了缩小问题发生的范围。当第二行被击中时，我收到一个错误“EntitySet 已加载并且无法更改源”

有什么想法可能导致这种情况吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T23:19:05.347

Omer 的评论提出了一个很好的观点：这个 DataContext 是从以前的操作中重用的吗？如果是这样，您可能需要查看 Dino Esposito 关于 DataContext 生命周期的[博客文章](http://weblogs.asp.net/despos/archive/2008/03/19/more-on-datacontext-in-hopefully-a-realistic-world.aspx)，以确保您不会将其保留太久。

该错误听起来可能您已经使用该 DataContext 从 InventoryItems 表中加载了数据，并且可能对绑定到您尚未提交的 DataContext 的实体进行了一些更改。如果您在没有指定任何特殊 DataLoadOptions 的情况下使用全新的 DataContext 尝试您的代码，它应该可以工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-03-06T21:27:57.117

对于任何感兴趣的人，请注意您在构造函数中所做的事情，我在构造函数中初始化了一些我不应该初始化的东西，它导致从数据上下文加载时出错。

# language-agnostic - 什么代码指标让你相信提供的代码是“糟糕的”？

> ID：187289
> 
> 赞同：24
> 
> 时间：2008-10-09T13:42:14.390
> 
> 标签：language-agnostic, automation, metrics, software-quality

每个文件的代码行、每个类的方法、圈复杂度等等。开发人员抵制并解决大多数（如果不是全部）！有一篇很好的[Joel 文章](http://www.joelonsoftware.com/items/2006/08/09.html)（现在没时间找到）。

您推荐使用哪些代码指标来**自动**识别“糟糕的代码”？

什么可以说服大多数开发人员（你不能说服我们所有人接受一些糟糕的指标！：O））这段代码是“垃圾”。

只有可以自动测量的指标才有意义！

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-10-09T13:49:55.030

不是自动化解决方案，但我发现 WTF 每分钟有用。

[![WTF的每分钟](https://i.stack.imgur.com/jEEzF.jpg)](https://i.stack.imgur.com/jEEzF.jpg)
[（来源：[osnews.com](http://www.osnews.com/images/comics/wtfm.jpg)）]

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-10-09T13:50:13.033

没有关于编码风格的指标是此类警告的一部分。

对我来说，它是关于**代码的静态分析**，它可以一直“开启”：

*   [圈复杂度](https://stackoverflow.com/questions/105852)（由 checkstyle 检测）
*   [依赖循环检测](https://stackoverflow.com/questions/62276)（例如通过 findbugs）
*   例如 findbugs 检测到的严重错误。

我会将覆盖测试放在第二步，因为这样的测试可能需要时间。

* * *

不要忘记，“糟糕”的代码不是通过度量来检测的，而是通过度量的*组合*和*演变*（如“*趋势*”中的）来检测的：请参阅[代码度量的魅力是什么？](https://stackoverflow.com/questions/195887/what-is-the-fascination-with-code-metrics)问题。

这意味着您不仅要推荐代码指标来“自动识别“糟糕的代码””，还必须推荐正确的组合和趋势分析来遵循这些指标。

* * *

在旁注中，我确实分享了您的[挫败感](http://stackoverflow.uservoice.com/pages/general/suggestions/35815?tracking_code=3c7fc7632b4236f09130fc94064937c2)；），并且我不同意 tloach 的观点（在另一个答案的评论中）“问一个模糊的问题，得到一个模糊的答案”他说......你的问题值得一个具体的答案。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-09T13:43:07.383

我进行构建时编译器发出的警告数。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-10-09T14:18:45.300

每行生产代码的注释行数。通常它表示一个不了解版本控制的草率程序员。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-10-09T15:24:04.387

开发人员总是关心对他们使用的指标，并且调用“蹩脚”代码并不是一个好的开始。这很重要，因为如果您担心您的开发人员在他们周围玩游戏，那么不要将这些指标用于任何对他们有利/不利的事情。

最好的方法是不要让指标告诉您代码在哪里糟糕，而是使用指标来确定您需要查看的位置。您通过代码审查来查看，如何解决问题的决定是在开发人员和审查人员之间。我也会在开发人员方面对指标出错。如果代码仍然在指标上弹出，但审阅者认为它很好，那就别管它了。

但是，当您的指标开始改善时，请务必牢记这种博弈效应。太好了，我现在有 100% 的覆盖率，但是单元测试有什么好处吗？指标告诉我我没问题，但我仍然需要检查一下，看看是什么让我们到达那里。

归根结底，人类胜过机器。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-10-09T13:44:12.483

全局变量的数量。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-10-09T13:44:43.947

*   不存在的测试（由代码覆盖率显示）。这*不一定*表明代码不好，但它是一个很大的警告信号。

*   评论中的脏话。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2008-10-09T13:54:50.027

单独的指标并不能识别糟糕的代码。但是，他们可以识别可疑代码。

OO 软件有很多指标。其中一些可能非常有用：

*   平均方法大小（在 LOC/语句或复杂性中）。大型方法可能是糟糕设计的标志。
*   被子类覆盖的方法数。较大的数字表示糟糕的类设计。
*   专业化指数（被覆盖的方法数 * 嵌套级别 / 方法总数）。高数字表示类图中可能存在问题。

还有更多可行的指标，可以使用工具进行计算。这可以很好地帮助识别糟糕的代码。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-10-09T14:52:39.693

*   全局变量
*   魔术数字
*   代码/评论比率
*   重耦合（例如，在 C++ 中，您可以通过查看类关系或相互交叉包含的 cpp/头文件的数量来衡量这一点
*   相同代码库中的 const_cast 或其他类型的转换（不带外部库）
*   大部分代码被注释掉并留在里面

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-10-09T13:57:20.677

我个人最喜欢的警告标志：评论免费代码。通常意味着编码人员没有停下来思考它；再加上它会自动让人难以理解，所以会增加糟糕的比例。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-10-09T13:43:35.527

我的赌注：圈复杂度 (CC) 和自动化测试 (TC) 的代码覆盖率的组合。

```
CC | TC

 2 | 0%  - good anyway, cyclomatic complexity too small

10 | 70% - good

10 | 50% - could be better

10 | 20% - bad

20 | 85% - good

20 | 70% - could be better

20 | 50% - bad

... 
```

[crap4j - 可能的工具（用于 java）和概念解释](http://www.crap4j.org/)......寻找 C# 友好工具:(

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-10-11T14:33:12.120

第一眼：货真价实的成语应用。

仔细一看：程序员的明显错误和误解。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-10-09T13:52:00.250

有意义评论的无价值评论数量：

```
'Set i to 1'
Dim i as Integer = 1 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-10-09T13:55:49.807

我不相信有任何这样的指标。除了实际上没有做它应该做的代码（这是一个额外的糟糕程度）之外，“糟糕”的代码意味着难以维护的代码。这通常意味着维护者很难理解，这在某种程度上总是一个主观的东西，就像糟糕的写作一样。当然，在某些情况下，每个人都同意写作（或代码）很糟糕，但很难为它写一个度量标准。

再加上一切都是相对的。与没有限制的简单函数相比，代码在最小内存中执行高度复杂的函数并针对每个最后一个速度周期进行优化，看起来会非常糟糕。但这并不糟糕——它只是在做它必须做的事情。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-10-09T14:13:13.283

不幸的是，没有我知道的指标。需要记住的是，无论您选择什么，程序员都会对系统进行游戏以使他们的代码看起来不错。我已经看到到处都有任何类型的“自动”指标。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2008-10-09T14:42:55.280

大量与字符串之间的转换。通常，这表明开发人员不清楚正在发生的事情，只是在尝试随机的事情，直到某些事情起作用。例如，我经常看到这样的代码：

```
 object num = GetABoxedInt();
//   long myLong = (long) num;   // throws exception
   long myLong = Int64.Parse(num.ToString()); 
```

当他们真正想要的是：

```
 long myLong = (long)(int)num; 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2008-10-09T15:03:02.450

*   注意模式类与标准类的比率。高比率表示模式炎
*   检查未定义为常量的幻数
*   使用模式匹配实用程序来检测可能重复的代码

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2008-10-09T15:31:38.927

我很惊讶没有人提到[crap4j](http://crap4j.org)。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-10-09T15:27:26.143

有时，您只是在看到它时就知道它。例如，今天早上我看到：

```
void mdLicense::SetWindows(bool Option) {
  _windows = (Option ? true: false);
} 
```

我只需要问自己“为什么有人会这样做？”。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-10-09T13:43:29.880

代码覆盖率有一定的价值，但除此之外，我倾向于更多地依赖代码分析来判断代码是否糟糕。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-10-09T13:48:43.767

包含亵渎的评论与不包含亵渎的评论的比率。

更高 = 更好的代码。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-10-09T13:53:34.803

注释行/代码行

`value > 1 -> bad (too many comments)`

`value < 0.1 -> bad (not enough comments)`

根据您自己的经验调整数值；-)

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-10-09T14:25:51.277

我采用多层方法，第一层是合理的可读性，仅由正在解决的问题的复杂性抵消。如果它不能通过可读性测试，我通常认为代码不太好。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2009-11-30T06:42:47.820

**`TODO:`**生产代码中的注释。简单地表明开发人员没有执行任务以完成。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2010-06-23T20:52:47.770

具有 30 个参数的方法。在网络服务上。就这些。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2013-02-14T20:28:27.763

好吧，您可以使用多种不同的方法来指出代码是否是好的代码。以下是其中一些：

1.  内聚性：嗯，代码块，无论是类还是方法，如果被发现提供多种功能，那么可以发现代码的内聚性较低。内聚性较低的代码可以称为可重用性较低。这可以进一步称为可维护性较低的代码。

    1.  代码复杂度：可以使用 McCabe 圈复杂度（决策点数）来确定代码复杂度。代码复杂度高可用于表示可用性较低（难以阅读和理解）的代码。

    2.  文档：从代码可用性的角度来看，没有足够文档的代码也可以归因于软件质量低下。

查看以下页面以了解代码审查[清单](http://vitalflux.com/checklist-for-effective-code-review/)。

* * *

## 回答 #27

> 赞同：-1
> 
> 时间：2009-11-30T04:30:59.303

[这篇关于The Code CRAP Metric 的](http://www.artima.com/weblogs/viewpost.jsp?thread=215899)搞笑博文可能很有用。

# random - 数据的随机分布

> ID：187295
> 
> 赞同：5
> 
> 时间：2008-10-09T13:43:15.450
> 
> 标签：random, controls, distribution, random-seed

如何将少量数据以随机顺序分布在大量数据中？

例如，我有几千行“真实”数据，我想在整个“真实”数据中以随机顺序插入十几或两行控制数据。

现在我不是要问如何使用随机数生成器，而是要问一个统计问题，我知道如何生成随机数，但我的问题是如何确保在同时相当均匀地分散在文件中。

如果我只依赖生成随机数，那么我的所有控制数据，或者至少是其中的一部分，都有可能（尽管非常小）被插入到一个相当狭窄的“真实”数据选择中。阻止这种情况发生的最好方法是什么？

换一种说法，我想在我的真实数据中插入控制数据，而第三方无法计算哪些行是控制的，哪些是真实的。

* * *

更新：我已经把它变成了一个“社区维基”，所以如果有人想编辑我的问题，让它更有意义，那就继续吧。

* * *

更新：让我举个例子（我不想让这种语言或平台依赖，因为它不是编码问题，而是统计问题）。

*   我有 3000 行“真实”数据（这个数量会随着运行的变化而变化，具体取决于用户拥有的数据量）。
*   我有 20 行“控制”数据（同样，这将根据用户想要使用的控制行数而变化，从零开始）。

我现在想在每插入 150 行或“真实”数据后插入这 20 个“控制”行（ *3000/20* = 150）。但是，我不希望它像那样准确，因为我不希望控制行仅根据它们在输出数据中的位置来识别。

因此，我不介意*某些*“控制”行聚集在一起，或者*有些*部分根本没有“控制”行，但通常我希望“控制”行在整个数据中相当均匀地分布。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-09T13:53:59.483

如果您真的随机进行，它们总是有可能彼此靠近:)

但我会做的是：

1.  您拥有多`N`行真实数据`x`和*控制*数据
2.  要获得行的索引，您应该插入`i`第 - 个控制行，我会使用：`N/(x+1) * i + r`，其中`r`是一些随机数，每个控制行都不同，与`N/x`. 选择任意一种确定方式`r`，可以是*高斯*分布，也可以是*平面*分布。`i`是控制行的索引，所以它是`1<=i<x`
3.  通过这种方式，您可以确保避免将控制行凝聚在一个地方。此外，您可以确定它们之间不会保持固定距离。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-09T13:54:36.470

这是我的想法。您为什么不直接遍历现有行并为每一行“掷硬币”来决定是否在其中插入随机数据。

```
for (int i=0; i<numberOfExistingRows; i++)
{    
    int r = random();
    if (r > 0.5)
    {
        InsertRandomData();
    }    
} 
```

这应该会给你一个很好的数据随机分布。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-09T15:28:03.817

以下示例使用 3000 个真实数据行和 20 个控制行（示例比英语更好）

如果您要在 3000 个实际数据行之间尽可能均匀地分布 20 个控制行，您将在每 150 个实际数据行中插入一个。所以选择那个数字，150，作为下一个插入索引。
a) 生成一个介于 0 和 150 之间的随机数，并将其从插入索引中减去
b) 在此处插入控制行。
c) 将插入索引增加 150
d) 重复步骤 a)

当然，这是一个非常粗糙的算法，它需要一些改进:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-09T15:42:56.813

如果实际数据比控制数据大或大得多，只需为您的控制数据生成到达间隔。

所以选择一个随机间隔，复制出那么多行真实数据，插入控制数据，重复直到完成。如何选择那个随机间隔？

我建议使用高斯偏差，将平均值设置为实际数据大小除以控制数据大小，如果需要，可以估计前者，而不是测量或假设已知。根据您愿意容忍的“传播”程度设置此高斯的标准偏差。较小的 stddev 意味着更尖峰分布意味着更严格地遵守均匀间距。更大的标准偏差意味着更扁平的分布和对均匀间距的更松散的遵守。

现在文件的第一部分和最后一部分呢？也就是说：在最开始或最后插入控制数据怎么样？您可以做的一件事是为这些提出特殊情况估计......但一个很好的技巧如下：在负一半高斯平均值处开始您的真实数据的“索引”并生成您的第一个偏差。在您对真实数据的“索引”合法之前，不要输出任何真实数据。数据末尾的对称技巧也应该工作得很好（简单地说：继续生成偏差，直到达到“索引”，至少超出实际数据末尾的高斯平均值的一半。如果在此之前的索引不在end，最后生成数据。

您想查看的不仅仅是统计数据：查看基本排队理论有助于为这类事情开发算法。请参阅 wikipedia 或 Turing Omnibus，其中有一个很好的简短章节，标题为“模拟”。

另外：在某些情况下，非高斯分布，尤其是泊松分布，可以为这类事情提供更好、更自然的结果。上面的算法大纲仍然适用，使用任何似乎正确的分布的平均值的一半。

# project-management - 敏捷/Scrum 资源规划跨项目

> ID：187300
> 
> 赞同：2
> 
> 时间：2008-10-09T13:43:39.690
> 
> 标签：project-management, resources, agile, scrum, resource-scheduling

我们在规划在线网络项目时有不同的步骤：

1) 信息架构

*   提供用户故事
*   提供线框

2) 设计

*   使用线框开发一个漂亮的设计

3) 发展

4) 测试

我知道敏捷工作需要专门的团队。但是在项目结束之前不可能有一个专门的 IA。因为这些项目是小型开发人员在不同的团队中工作。当您知道 50 个小项目和 20 个新项目使用不同的资源时，您如何规划资源？

是否有一个有用的工具可以帮助做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-09T13:55:26.203

无法在整个项目期间提交 IA（或 UI 设计师或其他任何人）的情况很常见。

然而，使用敏捷，问题很容易解决：在需要他的迭代长度内提交资源。即，如果您需要一个架构师来处理一个高峰或一个特定的用户故事，请确保在实施用户故事时，她可以与您的团队合作完成该迭代的长度。稍后，如果您需要她再次做同样的事情。

如果您的迭代对于该方法来说太长，请尝试将资源提交到特定用户故事的长度或仅达到峰值。

# asp.net - FormView_ItemUpdating 在不更新

> ID：187305
> 
> 赞同：1
> 
> 时间：2008-10-09T13:44:36.273
> 
> 标签：asp.net

我正在使用 FormView 来更新现有的 SQL Server 记录。来自 sqldatasource 的行在 FormView 中显示良好，我可以对其进行编辑。当我单击更新时，我得到了 ItemUpdating 事件，但没有得到 ItemUpdated 事件，并且修订没有写入数据库。

任何人都可以帮助我吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T23:45:20.330

在您的 ItemUpdating 事件处理程序中，确保以下事项：

- 如果您没有使用乐观并发检查，请删除 FormView 可能放置在 OldValues 集合中的任何旧值。

- 确保存储过程、查询或数据源所需的所有参数都有值，并且在 Keys 或 NewValues 集合中正确命名（并确保不存在重复项）。

在某些情况下（通常在涉及 ObjectDataSource 时），我必须通过执行以下操作来覆盖 FormView 控件设置的值：

```
protected void myFormView_ItemUpdating(object sender, FormViewUpdateEventArgs e)
    {

        // remove the old values
        e.Keys.Clear();
        e.OldValues.Clear();
        e.NewValues.Clear();

        // set the parameter for the key
        e.Keys.Add("@key", valueGoesHere);

        // set other parameters
        e.NewValues.Add("@param1", aValue);
        e.NewValues.Add("@param2", anotherValue);
    } 
```

它并不漂亮，但它让您可以绝对控制传递给 DataSource 的内容。通常，如果您的 FormView 中的控件都使用 Bind() 进行双向数据绑定（而不是 Eval），则您不必这样做，但至少您可以在 ItemUpdating 中放置一个断点并打开 e .Keys、e.OldValues 和 e.NewValues 集合以查看内容是否符合您的预期。

下一步是启动 SQL Server Profiler 以运行跟踪并检查正在执行的实际查询。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-09T13:48:59.617

如果取出ItemUpdating事件和ItemUpdated事件，你的SQL语句执行是否没有错误？

如果是这样，您为什么不发布一些您正在使用的代码？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-09T13:49:43.050

我们能看到 sqldatasource 的样子吗？你还记得把sqldatasource中的所有参数都放在insert和update参数列表下吗？

哦，您是否还在 itemupdating 事件中设置了取消属性？

# regex - 使用“OR”条件的正则表达式

> ID：187319
> 
> 赞同：2
> 
> 时间：2008-10-09T13:48:53.533
> 
> 标签：regex, django, django-urls

我可以使用一些帮助来编写正则表达式。在我的 Django 应用程序中，用户可以点击以下 URL：

```
http://www.example.com/A1/B2/C3 
```

我想创建一个允许接受以下任何内容作为有效 URL 的正则表达式：

```
http://www.example.com/A1  
http://www.example.com/A1/B2  
http://www.example.com/A1/B2/C3 
```

我猜我需要使用“OR”条件，但我无法让我的正则表达式验证。有什么想法吗？

**更新**：到目前为止，这是正则表达式。请注意，我没有包含“ [http://www.example.com](http://www.example.com) ”部分——Django 会为我处理。我只关心验证 1、2 或 3 个子目录。

```
^(\w{1,20})|((\w{1,20})/(\w{1,20}))|((\w{1,20})/(\w{1,20})/(\w{1,20}))$ 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-09T14:02:13.133

跳过`|`, 使用`?`and`()`

`http://www\.example\.com/A1(/B2(/C3)?)?`

如果您将 A1-C3 替换为模式：

`http://www\.example\.com/[^/]*(/[^/]*(/[^/]*)?)?`

解释：

*   它匹配每个以开头的字符串`http://www.example.com/A1`
*   它可以匹配一个附加`/B2`的，甚至一个附加的`/C3`，但`/C3`只有当有一个`/B2`
*   `[^/]*`（尽可能多的非斜线）
*   如果您需要特殊捕获组中的 A1-C3，您可以使用：

`http://www\.example\.com/([^/]*)(/([^/]*)(/([^/]*))?)?`

将给出 ( `groupnumber: content`)：

```
matches: 0: (http://www.example.com/dir1/dir2/dir3)
1: (dir1)
2: (/dir2/dir3)
3: (dir2)
4: (/dir3)
5: (dir3) 
```

你可以[在这里](http://www.regextester.com/)在线查看或获取这个[工具](http://www.weitz.de/regex-coach/)（是的，它是免费的，它甚至是用 Lisp 编写的......）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-07-22T19:52:14.793

有更多的 Django 方法可以做到这一点：

```
urlpatterns = patterns('',
    url(r'^(?P<object_slug1>\w{2}/(?P<object_slug2>\w{2}/(?P<object_slug3>\w{2})$', direct_to_template, {"template": "two_levels_deep.html"}, name="two_deep"),
    url(r'^(?P<object_slug1>\w{2}/(?P<object_slug2>\w{2})$', direct_to_template, {"template": "one_level_deep.html"}, name="one_deep"),
    url(r'^(?P<object_slug1>\w{2})$', direct_to_template, {"template": "homepage.html"}, name="home"),
) 
```

其他方法没有利用 Django 传递变量的能力。

编辑：我将 urlpattern 的顺序切换为对解析器更明显（即自下而上比自上而下定义更多）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T14:01:16.160

```
http://www\.example\.com/A1(/B2(/C3)?)? 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-09T14:03:50.803

```
 ^(\w{1,20})(/\w{1,20})* 
```

如果您只需要 2 个，则可以使用任意数量的子目录：

```
 ^(\w{1,20})(/\w{1,20}){0,2} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-09T14:04:10.867

如果我理解的话，我认为您只需要在整个 OR 语句周围加上另一组括号：

```
^((\w{1,20})|((\w{1,20})/(\w{1,20}))|((\w{1,20})/(\w{1,20})/(\w{1,20})))$ 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-15T19:39:59.987

请注意，Django 的[反向 URL 匹配](http://docs.djangoproject.com/en/dev/topics/http/urls/#id2)（永久链接`reverse()`和`{% url %}`）可以处理有限的正则表达式子集。为了能够使用它们，有时需要将复杂的正则表达式拆分为单独的 URL 调度程序规则。

# streaming - RTSP的优势是什么？

> ID：187321
> 
> 赞同：1
> 
> 时间：2008-10-09T13:49:38.913
> 
> 标签：streaming, protocols

我正在寻找使用 RTSP 支持将流式视频传输到多个设备的优势。我有：

1.  TCP的好处。
2.  网络上常用的协议，因此受到许多基础设施的支持。
3.  通常在网络上使用，所以有很多工具和堆栈。
4.  可以使用 SSL。
5.  广泛的设备支持（不确定这一点）

还有其他想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-27T17:19:25.553

RTSP 具有高度灵活的优点，但代价是实施起来更加复杂。它也是一个被广泛支持的标准，特别是在它是 3GPP 堆栈的一部分的手机上。

直接回答您的列表点：

1.  RTSP 可以使用 UDP 和 TCP。一些客户端会在传输协议之间优雅地切换。

2.  有很多选择；开源和商业。商业产品往往价格昂贵但功能强大，而开源产品更灵活但往往缺乏大量修饰。

3.  虽然有很多库，但完成的项目并不多，大多数项目都处于稳定状态，但已经很老了：

    *   MPEG4IP（最初由 Cisco）一年多没有发展
    *   DSS 偶尔会落后于 QTSS。出现了一些关于分叉的讨论，但没有明确的出现
    *   VLC 是媒体的标准瑞士军刀，包括流媒体，但服务器*不是*为重负载而设计的。VLC 也很难强迫成为一个简单的流媒体客户端。
4.  据我所知，DSS 不支持 RTSP 连接的 SSL，并且使用 SSL 流式传输实际视频可能太慢而不实用。

5.  VLC、QuickTime Player、mplayer、RealPlayer 和大多数兼容 3G 的手机都支持 RTSP（但里程可能会有所不同）。

使用多播和 UDP 以及库支持的优势可能使 RTSP/RTP 对于内部应用程序非常有价值。广泛的支持使其对于需要支持广泛客户端的应用程序来说也是一个不错的选择。对于不需要与现有技术兼容的外部应用程序，复杂性的实际成本可能不是那么有利，例如不需要支持手机的互联网收音机。

# soap - 使用 SOAP 公开 CRUD 操作

> ID：187326
> 
> 赞同：2
> 
> 时间：2008-10-09T13:49:55.467
> 
> 标签：soap, crud

通过 SOAP Web 服务公开 CRUD 操作是个坏主意吗？我的直觉告诉我，这并不是最不重要的，因为进行数据库调用的开销可能很大。我正在努力寻找支持/反对这种（反）模式的文档，所以我想知道是否有人可以向我指出一些文档或对此事有意见。

此外，如果有人在设计肥皂服务时知道最佳实践（和/或相关文档），那就太好了。

以下是 Web 服务外观的示例：

*   创造
*   删除
*   执行
*   拿来
*   更新

下面是实现的样子：

```
[WebMethod]
public byte[] Fetch(byte[] requestData)
{
    SelectRequest request = (SelectRequest)Deserialize(requestData);

    DbManager crudManager = new DbManager();
    object result = crudManager.Select(request.ObjectType, request.Criteria);

    return Serialize(result);
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-09T14:20:56.310

如果您想以 RESTful 方式使用 SOAP，那么有一个有趣的标准[WS-Transfer](http://www.w3.org/Submission/WS-Transfer/)；它提供松散耦合的 CRUD 端点；您从中检查消息并相应地对您的实体采取行动。

然后，您可以在顶部添加任何您想要的东西，WS-Secure、WS-Reliable 消息传递等等。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T14:12:20.413

我认为发布一个 SOAP 服务将 CRUD 操作暴露给匿名的公共“用户”将是一个特别糟糕的主意。但是，如果您可以限制这些警告中的一个或两个，那么我认为它没有任何问题（而且我已经多次实施此类服务）。

*   除了执行操作所需的任何方法参数之外，您还可以要求在处理请求之前有效地验证发起者的用户名和密码参数：可以通过返回 SOAP 异常来表示验证失败。如果您特别偏执，您可以选择通过 SSL 运行服务

*   您可以让服务器解决方案处理基于 IP 的请求过滤器的发送和接收，只允许来自已批准地址列表的请求。

是的，通过 SOAP 运行请求存在开销（与公开直接数据库访问相反） - 即将请求包装到 HTTP 请求、打开套接字并发送它的处理时间（以及在接收端反之亦然）对于响应） - 但是，它确实有优势。

Java（通过 NetBeans IDE）和 .Net（通过 VS）都支持将 Web 服务消费到项目/解决方案中 - 最大的好处是远程服务上的对象/结构会自动转换为消费应用程序中的本地对象，非常方便。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-09T14:12:40.880

如果您只想通过 Web 进行 CRUD，我会研究一些不同的技术来执行 REST 而不是使用 WS*。 [SQL Data Services](http://www.microsoft.com/sql/dataservices/default.mspx)（以前称为 Project Astoria）实际上可能是一个不错的选择。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-09T14:07:05.697

通过 SOAP Web 服务本身公开 CRUD 操作并没有错。

您显然会发现很多此类服务的示例。

但是，根据您的特定要求，您可能会发现使用 SOAP 对您来说开销太大，或者您最好使用 JSON/AJAX 等。

因此，我相信，除非您提供有关您的特定详细信息的其他详细信息，否则您的问题没有好的答案。

# delphi - 在 Outlook 中标记为已读的项目上的事件 - Delphi COM 插件

> ID：187348
> 
> 赞同：1
> 
> 时间：2008-10-09T13:53:44.583
> 
> 标签：delphi, events, com, outlook, outlook-object-model

我有一个适用于 Outlook (2000-2007) 的 Delphi COM 加载项，并且正在尝试找到一种方法来在 Outlook 中的 MailItem 标记为已读时注册事件。我想在项目被标记为已读时/就在项目中添加一个附加属性。

有谁知道如何使用 Outlook 对象模型来做到这一点？我还使用 Add-In-Express 组件来帮助获取其他属性事件。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-10T22:46:10.347

您可以为此使用两个 MailItem 事件：

*   “读取”甚至会被调用。

*   将使用“UnRead”参数调用 PropertyChange 事件。但是，当 MailItem 再次标记为“已读”时，也会调用此特定事件。

# language-agnostic - 您的“通用”Web 应用程序测试计划是什么？

> ID：187349
> 
> 赞同：2
> 
> 时间：2008-10-09T13:53:57.703
> 
> 标签：language-agnostic, testing

比如，测试：

*   无效输入（包含“'”的字符串）
*   在 url 参数中提供随机 id 以访问“未授权”页面
*   防止sql注入
*   ...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-09T14:18:02.710

我建议阅读这本精彩的[书](https://rads.stackoverflow.com/amzn/click/com/0471081124)，以了解有关测试计划的更多信息。

特别是测试计划不仅仅是您提到的技术列表（这些很可能会进入安全测试的细节）

它至少应该包含：

*   主要问题的答案：
    *   为什么要打扰（通过测试获得了什么）
    *   谁在乎（我们为谁工作）
    *   多少（..测试将完成）

提供以下内容也不会出错：

*   平台
*   方法（正面测试、负载测试等）
*   您计划测试的功能
*   验收标准

计划中还有很多事情要谈。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T08:54:48.670

测试响应：对于整数 - 字符串，空值，超过允许的值，负数，零.. 对于字符串 - 长度超过允许的字符串

对于无效值，您可以检查返回的响应是否提供足够的信息。

测试以查看您的应用程序是否记录了这些错误。如果不是这样，您将无法在生产中出现问题时轻松识别和调试问题。

模糊测试也是 Web 应用程序的必要条件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-09T14:20:22.160

如果您想制作一个列表，您可以添加“在 textarea 字段中尝试简单的 javascripts 以查看站点是否保存并执行它们”

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-06-08T08:55:12.513

这就是我用的

[质量测试计划](http://pm4web.blogspot.com/2008/07/quality-test-plan.html)

它非常简单，直截了当。涵盖了许多常见的网络缺陷（例如断开的链接等）

你可能认为它太基础了，但我总是惊讶它揭示了多少错误

--LM

# c# - Linq to SQL：DataTable.Rows[0]["ColumnName"] 等效

> ID：187357
> 
> 赞同：1
> 
> 时间：2008-10-09T13:55:00.370
> 
> 标签：c#, linq, c#-3.0

考虑一下：

```
var query = from r in this._db.Recipes
            where r.RecipesID == recipeID
            select new { r.RecipesID, r.RecipesName }; 
```

我如何在`query`不使用 for 循环的情况下获取对象中的各个列？

基本上：我如何翻译`DataTable.Rows[0]["ColumnName"]`成 Linq 语法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-09T14:04:56.573

由于您的两个样本是兼容的，因此您真的不清楚您在寻找什么。

尽我所能，你想要的是：

```
var rows = query.ToList();
string name = rows[0].RecipesName; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T14:25:37.140

```
string name = this._db.Recipes.Single(r => r.RecipesID == recipeID).RecipesName; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T23:00:02.097

这是解决方法：

```
DataContext dc = new DataContext();

var recipe = (from r in dc.Recipes 
              where r.RecipesID == 1
              select r).FirstOrDefault();

if (recipe != null)
{
    id = recipe.RecipesID;
    name = recipe.RecipesName;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-09T14:03:35.220

对不起，误解了你的问题。正如其他人所说，您可以使用 ToList() 来获取 List 。如果您只需要第一个，另一种选择，只需使用：

```
 query.First().ColumnName 
```

或者如果你想避免空列表出现异常：

```
 var obj = query.FirstOrDefault();
if (obj != null)
   obj.ColumnName; 
```

* * *

原始答案（所以评论很有意义）：

使用[Linq 到数据集](http://blogs.msdn.com/adonet/archive/2007/01/26/querying-datasets-introduction-to-linq-to-dataset.aspx)。基本上会是这样的：

```
 var query = from r in yourTable.AsEnumerable()
select r.Field<string>("ColumnName"); 
```

# visual-studio - 在 Visual Studio 的解决方案树中隐藏源代码管理文件

> ID：187359
> 
> 赞同：3
> 
> 时间：2008-10-09T13:55:07.797
> 
> 标签：visual-studio, version-control

我们使用 Visual Studio 2008 和 Surround SCM 进行源代码控制。SCM 将文件放入每个名为“.MySCMServerInfo”的目录中，这些文件是用户特定的数据文件，不应检入源代码控制。它们类似于 Visual Source Safe 删除的 .scc 文件。我们还开发了几个 WAP（Web 应用程序项目）。所有这些 .MySCMServerInfo 文件不应该出现在解决方案树和 Pending Checkins 窗口中。必须有某种方法来强制 VS 忽略给定扩展名的文件，因为它会忽略 .scc 文件。如何让 VS 忽略 WAP 中的 .MySCMServerInfo 文件？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-17T18:01:31.090

我有关于这个问题的新信息。在 .MySCMServerInfo 文件上设置隐藏位会导致 Surround SCM 失去对文件修改状态的跟踪。它开始认为文件不是过时的，并且总是尝试获取新版本。

相反，如果您使用的是 Visual Studio 2008，请设置此注册表项：

```
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VisualStudio\9.0\Packages\
{8FF02D1A-C177-4ac8-A62F-88FC6EA65F57}\IgnorableFiles\.MySCMServerInfo] 
```

如果您使用的是 Visual Studio 2005，请设置此注册表项：

```
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VisualStudio\8.0\Packages\
{8FF02D1A-C177-4ac8-A62F-88FC6EA65F57}\IgnorableFiles\.MySCMServerInfo] 
```

这些将告诉 Visual Studio 不要在解决方案树和 Pending Checkins 视图中显示 .MySCMServerInfo 文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-10T21:43:22.317

使用文件系统隐藏位应该可以工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-02-04T04:07:32.733

迟到的答案，但希望对其他人有用。

在将 Visual Studio 2015 与新的 ASP.Net 5 项目模板一起使用时，我开始遇到此问题。（我认为这是因为新模板会自动包含文件夹中的所有内容，而不是仅显示项目文件中列出的内容）。

通过右键单击文件并选择“从解决方案资源管理器中隐藏”来阻止在解决方案资源管理器中显示这些文件，但这并没有阻止 SCM 将它们包含在待处理的签入窗口中。

处理这个问题的正确方法是：

1.  在解决方案资源管理器中选择文件
2.  选择文件 > 源代码管理 > 从源代码管理中排除

[参考](http://www.seapine.com/knowledgebase/index.php?View=entry&EntryID=751)

* * *

***注意：*** 解决方案资源管理器中的右键单击没有此选项。

# ruby-on-rails - 为什么使用 Ruby 而不是 Smalltalk？

> ID：187380
> 
> 赞同：122
> 
> 时间：2008-10-09T13:58:41.330
> 
> 标签：ruby-on-rails, ruby, smalltalk, seaside

Ruby 正在变得[流行](http://www.tiobe.com/index.php/content/paperinfo/tpci/index.html)，很大程度上是受到 Ruby on Rails 的影响，但感觉它目前正艰难度过青春期。Ruby 和 Smalltalk 之间有很多相似之处——[磁悬浮](http://ruby.gemstone.com/)就是证明。尽管有更不寻常的语法，Smalltalk 拥有 Ruby 的所有（如果不是更多）面向对象的美。

从我读到的内容来看，Smalltalk 似乎让 Ruby 更胜一筹：

*   成熟度（在 1970 年代开发）
*   稳定
*   商业支持
*   [分布式源代码控制](http://www.wiresong.ca/monticello/)（了解代码结构，而不仅仅是文本差异）
*   VM的几种[实现](http://en.wikipedia.org/wiki/Smalltalk#List_of_implementations)
*   跨平台支持
*   作为[Rails 的强大替代品](http://www.sauria.com/blog/2005/11/10)的[seaside web 框架](http://www.seaside.st/)

Ruby 似乎只是在重新发明轮子。那么，为什么 Ruby 开发人员不使用 SmallTalk 呢？**Ruby 有什么 Smalltalk 没有的？**

*郑重声明：我是一个 Ruby 人，在 Smalltalk 方面几乎没有经验，但我开始想知道为什么。*

* * *

**编辑：我认为**[GNU Smalltalk](http://en.wikipedia.org/wiki/GNU_Smalltalk)已经解决了易于编写脚本的问题。据我了解，这允许您在常规的旧文本文件中编写 smalltalk，并且您不再需要在 Smalltalk IDE 中。然后，您可以使用以下命令[运行脚本](http://www.gnu.org/software/smalltalk/manual/html_node/Invocation.html#Invocation)：

```
gst smalltalk_file 
```

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2008-10-09T21:16:21.697

我更像是一个 Pythonista 而不是 Ruby 用户，但是出于同样的原因，同样的事情也适用于 Ruby。

*   Smalltalk 的架构有些孤立，而 Python 和 Ruby 是从头开始构建的，以促进集成。Smalltalk 从未像 Python 和 Ruby 那样真正获得混合应用程序支持，因此“smalltalk 作为嵌入式脚本语言”的概念从未流行起来。

    顺便说一句，Java 并不是与其他代码库交互的最简单的东西（JNI 相当笨拙），但这并没有阻止它获得人们的关注。IMO 接口参数很重要 - 易于嵌入并没有伤害 Python - 但这个参数仅具有中等分量，因为并非所有应用程序都需要此功能。此外，Smalltalk 的更高版本确实在很大程度上解决了孤立问题。

*   大多数主要的 smalltalk 实现（VisualWorks、VisualAge 等）的类库都很大，并且以相当陡峭的学习曲线而闻名。Smalltalk 中的大多数关键功能都隐藏在类库的某个地方，甚至是流和集合之类的基本内容。语言范式对于不熟悉它的人来说也是一种文化冲击，浏览器呈现的程序的零碎视图与大多数人习惯的完全不同。

    总体效果是，Smalltalk 因难学而获得了（有些应得的）声誉。要成为一个真正精通 Smalltalk 的程序员需要相当多的时间和精力。Ruby 和 Python 更容易学习并使新程序员跟上速度。

*   [从历史上看，主流的 Smalltalk 实现非常昂贵，并且需要特殊的硬件才能运行，从 1983 年发布的 net.lang.st80](http://groups.google.co.uk/group/net.lang.st80/browse_thread/thread/c35c4ad7fad659c4?hl=en#)可以看出。Windows 3.1、NT 和 '95 以及 OS/2 是第一个在主流硬件上能够支持具有良好本地系统集成的 Smalltalk 实现的大众市场操作系统。以前，Mac 或工作站硬件是能够有效运行 Smalltalk 的最便宜的平台。一些实现（尤其是 Digitalk）很好地支持 PC 操作系统，并且确实成功地获得了一些牵引力。

    然而，OS/2 从未如此成功，Windows 直到 1990 年代中期才获得主流认可。不幸的是，这恰逢 Web 作为一个平台的兴起和 Java 背后的巨大营销推动力。Java 在 1990 年代后期占据了大部分的注意力，使得 Smalltalk 有点被淘汰了。

*   Ruby 和 Python 在更传统的工具链中工作，并且没有与特定的开发环境紧密耦合。虽然我使用的 Smalltalk IDE 已经足够好了，但我还是使用 PythonWin 进行 Python 开发，主要是因为它有一个很好的编辑器，带有语法高亮，而且不会被踩到。

    然而，Smalltalk 被设计为与 IDE 一起使用（事实上，Smalltalk 是最初的图形 IDE），并且仍然具有其他系统无法复制的一些不错的功能。使用高亮和“显示”测试代码仍然是我在 Python IDE 中从未见过的非常好的功能，尽管我不能代表 Ruby。

*   Smalltalk 加入 Web 应用程序派对的时间有点晚。诸如 VisualWave 之类的早期尝试从未取得过巨大的成功，直到 Seaside 出现后，一个像样的 Web 框架才在 Smalltalk 圈子中得到认可。与此同时，Java EE 已经有了一个完整的接受生命周期，从狂热的狂热粉丝开始推广它，最后变得无聊并转向 Ruby；-}

    具有讽刺意味的是，Seaside 开始在行家中获得一些共识，所以我们可能会发现 Smalltalk 骑着它重新流行起来。

话虽如此，一旦您弄清楚了如何驱动它，Smalltalk 就是一个非常好的系统。

* * *

## 回答 #2

> 赞同：79
> 
> 时间：2008-10-11T15:52:12.320

当我早上离开家去上班时，我经常在决定是左转还是右转离开我的车道（我住在街道中间）。无论哪种方式都会让我到达我的目的地。一种方式将我带到高速公路，根据交通情况，这条高速公路可能会让我最快地到达办公室。至少在路上我开得很快，而且我很有可能在上班的路上看到一两个漂亮的女孩:-)

另一种方式让我可以沿着一条非常迷人、多风的小路行驶，那里有完整的树木覆盖。这条路非常令人愉快，而且这两种方法肯定更有趣，尽管这意味着我到办公室的时间比我走高速公路的时间要晚。每种方式都有其优点。在我赶时间的日子里，我通常会走高速公路，虽然我可能会遇到交通，而且我也增加了发生事故的机会（如果我不小心我的匆忙）。其他的日子，我可能会选择林间小路，继续开车，欣赏风景，意识到自己迟到了。我可能会尝试加快速度，提高自己获得罚单或造成事故的机会。

两种方式都不比另一种更好。他们每个人都有自己的好处和风险，每个人都会让我达到我的目标。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2008-10-11T13:26:31.490

我认为你的问题有点忽略了这一点。 *你*不应该选择，你应该两个都**学**！

如果您确实处于可以选择下一个框架（vm、基础架构）的位置，那么您需要决定使用什么，并且可以从您的应用程序打算做什么的角度提出一个具有优缺点的特定问题。

我用过 smalltalk（喜欢它）和 ruby​​（喜欢它）。

在家里或在开源项目中，我可以使用我喜欢的每一种语言，但在工作时我必须采用。

我开始使用 ruby​​（在工作中），因为我们需要一些在 solaris、linux 和 windows(98,2000,xp) 下表现或多或少相同的脚本语言。Ruby 在那个时候对于普通人来说是未知的，并且没有任何轨道。但它很容易卖给所有相关的人。

（为什么不使用 python？真相？我曾经花了一周的时间寻找一个错误，当终端将我的空间转换为选项卡并且意图被搞砸时发生的错误）。

所以人们开始越来越多地用 ruby​​ 编写代码，因为它是如此轻松、享受，而不是天空中的一片云彩。

[保罗格雷厄姆总结](http://www.paulgraham.com/popular.html)

> 确实，大多数人不会仅仅根据自己的优点来选择编程语言。大多数程序员都被告知其他人使用哪种语言。

和

> 为了对黑客有吸引力，一种语言必须适合编写他们想要编写的程序。这意味着，也许令人惊讶的是，它必须适合编写一次性程序。

[什么时候在 Lisp 领域尝试用 smalltalk 替换 LISP](http://www.randomhacks.net/articles/2005/12/03/why-ruby-is-an-acceptable-lisp)

> > Ruby 的库、社区和势头都很好
> 
> 所以如果 LISP 仍然比 Ruby 更强大，为什么不使用 LISP 呢？对 LISP 编程的典型反对意见是：
> 
> 1.  没有足够的图书馆。
> 2.  我们不能雇用 LISP 程序员。
> 3.  在过去的 20 年里，LISP 毫无进展。
> 
> 这些并不是压倒性的反对意见，但它们当然值得考虑。

和

> 现在，如果要在强大的语言和流行语言之间进行选择，那么选择强大的语言可能非常有意义。但是，如果力量差异很小，那么受欢迎具有各种不错的优势。2005 年，在选择 LISP 而不是 Ruby 之前，我想了很久。如果我需要优化代码或充当成熟编译器的宏，我可能只会这样做。

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2009-03-21T11:17:15.053

我会说相反：Smalltalk 语法是最简单和强大的编程语言语法之一。

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2008-10-11T08:21:08.177

> 确实，语言非常相似。解释这一点的简单方法是将 Ruby 称为 Smalltalk 翻唱乐队。更合理的解释是，Smalltalk 的封闭系统将其隔离开来，而 Ruby 参与 Unix 生态以及从阳光下的每种语言中挪用特性的习惯，使它的采用曲线变得无限平缓，并且可以轻松地与 Git 等 kickass 工具集成。

[贾尔斯·鲍克特](http://gilesbowkett.blogspot.com/2008/10/smalltalk-complaints-and-opportunities.html)

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2009-03-27T22:44:23.463

猜猜这是谁说的？（引用很接近，也许不准确）：“我一直认为 Smalltalk 会击败 Java。我只是不知道这样做时是否会被称为 'Ruby'。”

击鼓 ....

...

答案是......肯特贝克

* * *

## 回答 #7

> 赞同：15
> 
> 时间：2008-10-09T14:43:06.153

Stephane Ducasse 在这里有一些很棒的 Smalltalk 书籍：

[http://stephane.ducasse.free.fr/FreeBooks.html](http://stephane.ducasse.free.fr/FreeBooks.html)

因此，尽管 Smalltalk 社区不如 Ruby 和 Rails 社区多产，但仍有一些很大的帮助。

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2008-10-11T13:50:38.307

Ruby 有什么 Smalltalk 没有的？

*   主要平台（IronRuby 和 jRuby）的大量当前支持，丰富了库集
*   像戴夫·托马斯这样的传道者，多年来一直在全国各地巡回宣传他们语言的福音。我在*Java 会议上*看到 Dave说他不懂 Java，而且他更喜欢 Ruby。
*   书架上强大的当前房地产
*   Ruby 的创造者曾说过他为程序员着想：Ruby 的语法似乎有这种禅意。很难确定，但似乎激励了粉丝。
*   创造性的、动态的演示文稿，例如[Giles](https://www.youtube.com/watch?v=0XDawYp9mKY)和[这个](http://www.youtube.com/watch?v=_2VXUQwGHZg)获得了思想分享的演示文稿

我认为你的观点很好。正如一位朋友曾经说过的，Ruby 与 Smalltalk 相比可能是“新瓶装旧酒”。但有时新瓶子很重要。葡萄酒必须在正确的时间出现在正确的地方。

* * *

## 回答 #9

> 赞同：14
> 
> 时间：2009-11-17T18:16:19.897

打败我。我花了一年时间检查 Ruby 并做了一些小型项目，看看我有多喜欢它。我想我是一个 Smalltalk 的偏执狂，因为每次我坐下来和 Ruby 一起工作时，我都会感叹“我真的宁愿在 Smalltalk 中做这件事”。最后我放弃了，回到了 Smalltalk。现在我更快乐了。越快乐越好。

这当然引出了一个问题，“为什么？”。没有特别的顺序：

1.  因为 IDE 把我曾经使用过的任何东西都吹走了。这包括一系列平台，从 IBM 大型机上的 ISPF 到 Microsoft 的 Visual (.*)，包括 Visual Basic 4-6、Visual C++（各种化身）、Borland 的 Turbo Pascal 和后代（例如 Delphi），以及 DEC 上的东西字符模式和 X-Windows 下的机器。
2.  因为图像是一个美丽的居住地。我可以在里面找到我想要的。如果我不知道如何做某事，我知道图像中的*某处*是我正在尝试做的事情的一个例子——我所要做的就是寻找直到找到它。而且它是自记录的——如果你想查看某些东西是如何工作的细节，你只需在你感兴趣的类上打开一个浏览器，看看这个方法，它就是这样工作的。（好吧，最终你会遇到一个叫做原始的东西，然后是“这里有龙”，但通常可以从上下文中理解）。在 Ruby/C++/C 中可以做类似的事情，但这并不容易。容易更好。
3.  语言简洁且一致。三种消息——一元、二元和关键字。这也描述了执行的优先级 - 首先是一元消息，然后是二进制消息，然后是关键字消息。使用括号来帮助解决问题。该死的小语法，真的 - 这一切都是通过消息发送完成的。（好吧，赋值不是消息发送，它是一个运算符。'return' 运算符 (^) 也是如此。块由方括号对 ([ ] ) 括起来。可能是其中的一两个其他“魔术”位，但该死的小......）。
4.  块。是的，我知道，它们存在于 Ruby（和其他）中，但是该死的，如果不使用它们，你真的无法在 Smalltalk 中编程。你*被迫*学习如何使用它们。有时被强迫是好的。
5.  没有妥协的面向对象编程 - 或替代方案，就此而言。你不能假装自己在“做对象”，同时还在做同样的事情。
6.  因为它会拉伸你的大脑。我们都习惯的舒适结构（if-then-else、do-while、for( ; ; ) 等）不再存在，因此您必须学习新知识。以上所有（以及更多）都有等价物，但您将不得不学会以不同的方式思考。不一样就好。

另一方面，这可能只是一个自大型机统治地球以来一直在编程的人的胡言乱语，我们不得不步行 5 英里才能在令人眼花缭乱的暴风雪中工作，双向上坡，并且计算机使用甜甜圈作为记忆。我没有反对 Ruby/Java/C/C++/，它们在上下文中都很有用，但是给我 Smalltalk 或者给我......好吧，也许我应该学习 Lisp 或 Scheme 或者...... :-)

* * *

## 回答 #10

> 赞同：11
> 
> 时间：2009-01-13T13:45:23.023

Smalltalk：人们转发 ifTrue：[认为] ifFalse：[未考虑]

Ruby：人们向前思考，除非向后思考

1）Smalltalk 的类似 RPN 的消息控制流就像 Lisp - 它是常规且很酷的，但会让人们感到奇怪。

2) Ruby 允许人们使用人们说话的惯用方式编写代码——*除非*有理由不这样做，否则就去做吧。

**更新**重写了 Smalltalk 示例，使其实际上更合法。

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2008-10-09T14:03:27.623

Ruby 是当前流行的语言。现在推销用它构建的软件比 70 年代开发的语言更容易。

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2008-10-09T14:32:16.363

社区！Ruby 尤其是 Rails 拥有如此强大的社区。在使用 smalltalk 时，似乎没有那么多关于 Smalltalk 的屏幕截图、文章、博客文章等。

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2008-10-11T10:34:36.563

您在第一行中回答了问题：“Ruby 正在变得流行”

*   有*很多*基于 Ruby 的有趣的模块、项目等。
*   如果你在 Ruby 中做某事有困难，在某个地方寻求帮助将是微不足道的。
*   Ruby 现在安装在*很多*计算机上（它默认包含在 OS X、许多 Linux 发行版上，并且有很好的 Windows 安装程序） - 我没有看到在我使用过的任何机器上默认安装 smalltalk。

我会说一种语言是否优于另一种语言是无关紧要的。举个例子，PHP 可能不是有史以来“最好的”语言，但我仍然会考虑在 Ruby on Rails 上使用它（一个“更好”的创建工具网站），因为它是如此普遍。

基本上，一种语言的具体优缺点远不如它周围的一切——即社区——重要。

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2010-12-10T16:22:05.240

Ruby（或任何其他语言）比 Smalltalk（或任何其他语言）更受欢迎，因为我们生活在一个混乱的世界中。以机智：

*   来自 Dave Thomas 本人，“[在 '如何在 10 分钟内构建博客'的视频之后...... Ruby 从一个不错的小众语言变成了'一种你编写 Rails 应用程序的语言'”（[Ruby Conference 2010 年主题演讲](http://confreaks.net/videos/368-rubyconf2010-keynote)）。
*   早期的 Smalltalk 供应商收费过高
*   Smalltalk，因为它是 30 年前发明的（超前于时代），在许多人看来，它是一种古老的“死”语言（如 FORTRAN）
*   公司认为 Smalltalk 是一种竞争优势，以至于[他们隐藏了它的使用](https://stackoverflow.com/questions/3633293/are-there-any-commercial-projects-using-squeak-smalltalk-that-are-not-web-based/4405172#4405172)

尽管这两种语言在 OO 特性方面相似，但 Smalltalk 的*杀手锏*优势在于实时、开放的环境（被广泛误解的“形象”）。在您查看了[Smalltalk](http://www.pharocasts.com/2010/02/programming-with-live-objects.html)中的这个编程示例之后，争论就结束了。

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2008-10-09T14:03:48.963

对我来说，它不是 Ruby 所拥有的，而是 Ruby 所没有的。它没有的东西是需要一个虚拟机和完整的环境。

Smalltalk 很棒——我在那里学习了 OO 概念，但为了易于使用，我选择了 Ruby。我可以在我最喜欢的编辑器中编写 Ruby 代码并从命令行运行它。

所以，对我来说，这就是我选择 Ruby 而不是 Smalltalk 的原因。

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2008-10-29T06:07:54.277

我认为每个使用 Ruby 已有一段时间的人都认识到它对 Smalltalk 的深深亏欠。作为这些人中的一员，我喜欢 Ruby 而不是 Smalltalk 的哪一点？我认为从严格的语言角度来看，它是糖。Ruby 故意是一种语法非常简洁的语言，而 Smalltalk 是一种语法非常简洁的语言。Ruby 本质上是带有 Perlish 语法糖的 Smalltalk 对象模型。我碰巧喜欢这种糖，发现它让编程更有趣。

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2009-12-03T01:03:45.713

**你可以很容易地找到一份做 Ruby 的工作。**虽然我真的很喜欢 Smalltalk，但要进入 Smalltalk 领域几乎是不可能的。它有一些解决方法，但如果你在它流行的时候没有进入，那么现在几乎是不可能的。

所有其他原因都显得微不足道，因为您需要花费大量时间，专注于实际工作才能正确学习一门语言。如果你不是独立富有，最好的办法就是在工作中接触它。

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2008-11-05T20:16:50.377

因为 Smalltalk 发行版的价格是 1000 美元的倍数，而 Ruby 是免费的。

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2009-02-23T20:39:42.283

Ruby 之于 Smalltalk 就像阿拉伯数字之于罗马数字。相同的数学，更简单的语法。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2008-10-09T14:04:27.263

我做了一点 Smalltalk - IDE 是我记得的一件事 - Ruby 有良好的 IDE 支持吗？

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2008-12-07T02:58:06.927

使用 Ruby 是因为它可能具有业务功能，而 Smalltalk 则没有。

我可以从个人经验告诉你。仍在使用 Smalltalk，喜欢它，并且使用了几种口味。尽管 Smalltalk 是一门很棒的语言，并且是您提到的所有内容，但您不太可能说服普通 CIO/CTO 在新项目中使用 Smalltalk。当然，您甚至可能很难说服保守的 CIO/CTO 使用 Ruby。最后，如果您想要持续的长期商业支持，并且能够找到可以在未来支持您的系统的外来员工，那么您必须非常小心。例如，Smalltalk 在 90 年代初是一件非常大的事情，IBM 在 90 年代后期对其进行了大量投资。对于 IBM，Smalltalk 将成为所有业务应用程序的下一个语言。IBM 将 Smalltalk 安装在包括大型机系统在内的所有设备上。Java 流行起来，占领了市场，Smalltalk 成为了一个小众玩家。一年多以前，IBM 抛弃了该语言（他们的术语是日落）。另外，看看历史。ParkPlace 和 Digitalk 是 Smalltalk 领域的第一批主要商业参与者，他们合并然后倒闭。

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2009-05-15T17:30:46.290

Robert Martin 的有趣观点（来自 RailsConf 2009）：[“杀死 Smalltalk 的东西也会杀死 Ruby”](http://railsconf.blip.tv/file/2089545/)

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2009-06-04T06:35:20.940

我喜欢 Smalltalk 和 Ruby——但我发现 Ruby 更适用于我的日常工作，并且更贴近我的内心（实际上来说）。Ruby 提供了 Smalltalk 没有的什么？

*   基于文本的脚本
*   实施要求低（在更多地方运行）
*   更容易学习和证明（Perl 和 Python 程序员不会有*麻烦*）
*   更容易移动程序 - 文本文件！
*   与原生环境很好的接口
*   任何 Java 运行的地方，jRuby 都运行...
*   更大、更活跃的社区

有些人提到了 gst（GNU Smalltalk）；问题仍然存在。

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2010-10-23T14:35:02.920

使用任何能让你更强大、更快的方法来应对挑战。

对[我们来说](http://flowingconcept.com)，一个小小的内部框架，我们建在海边真的是我们的超级大国。

我喜欢 RoR 社区，它有正确的态度。这是非常非常宝贵的。但同时，从技术上讲，海滨让你更强大地应对更复杂的问题。

你可以使用开源的东西来做很棒的海滨网络应用程序。

dabbledb 是一家基于海边的 sartup，嘿！今年 6 月，Avi 把它卖给了推特！

我说你不需要等待别人批准你的倡议。

去吧。让它完成。向我们展示这行得通。

你不是一个人。我们在同一条船上。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2008-10-09T14:11:42.193

我认为部分问题在于开发环境即运行时。这提供了很大的力量，但它也呈现出更大的学习曲线。

[这](http://wiki.squeak.org/squeak/2230)是一个hello world教程。

这与其他语言非常不同，我只需要知道如何打开文本编辑器、复制和粘贴文本、点击保存并运行编译器。我必须知道如何使用环境。该教程甚至没有向我展示如何创建一个我可以运行的基本程序（这可能更多是该教程的错误）。

与大多数其他语言相比，让事情顺利进行的成本肯定更高。

大多数语言都有一些可以炫耀的漂亮醒目的代码。我还没有在 Smalltalk 上看到过。我也认为 Smalltalk 存在一些污名，因为它已经存在了很长时间，而且还相对晦涩难懂。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2008-10-11T09:24:00.280

我认为最大的区别是 Ruby 在 USEAGE 方面与 perl 更相似。Smalltalk 从未在“脚本”语言中站稳脚跟。

VM 真的很酷，我希望 ruby​​ 有类似的东西，这样我们就可以将操作系统上用 ruby​​ 编写的所有内容都视为内存空间中的对象，但是在那之前，我只是喜欢 Ruby 的简洁、简短的语法，以及只需编写一个小脚本并在以后重用它。Ruby 获得了 perl 的所有优点，而且 OOP 更类似于 smalltalk，而不是 perl 的 OOP hack。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2009-05-02T12:03:46.493

我会比 Jonke 的回答更进一步，并说现在有大量语言拥有非常强大的社区，几乎足以满足各种口味，其中一部分具有主流认可（即你的经理会让你在也可以工作）。

学习一门语言的基础知识很容易，但要真正有效地使用它，您需要投入足够的时间来学习平台和工具，以及语法和习语。IIRC，McConnell 声称要真正精通大约需要三年时间。

考虑到这些情况，很难证明在 LISP 和 Smalltalk 等语言上花费大量时间是合理的，尽管它们很有趣，而且可能具有教育意义。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2010-03-19T22:41:59.133

作为讨论的后来者，Smalltalk 和 Lisp 的主要问题是您无法在共享主机上使用 CGI 或 FastCGI 运行它们。

如果他们需要 VPS 或专用服务器来使用它们，那么未洗过的群众永远不会使用它们。恕我直言，Seaside 几乎优于其他任何东西，但它会在 Dreamhost 或 Webfaction 上运行吗？

# sharepoint - 级联列表框，多选

> ID：187384
> 
> 赞同：2
> 
> 时间：2008-10-09T13:59:10.410
> 
> 标签：sharepoint

我最终从公开发布的 POC 中修改了源代码：http: [//datacogs.com/datablogs/archive/2007/08/26/641.aspx](http://datacogs.com/datablogs/archive/2007/08/26/641.aspx)，这是级联下拉菜单的自定义字段定义。修改是允许父子列表框，用户可以在其中多选以过滤和选择要写回 SharePoint 列表的值。我让父子级联行为正常工作，但保存操作仅采用从列表框中选择的第一个值。我将自定义字段控件的基本类型从“SPFieldText”更改为“SPMultiLineText”，同时将 FLD_TYPES 字段定义值从：Text 更改为 Note，但这不起作用。因此，我将字段控件基本类型更改为“SPFieldMultiChoice”，将 FLD_TYPES 更改为“MultiChoice”，但仍然得到相同的结果，这只是选择的第一个值，写入 SharePoint 列表。

有谁知道如何获取具有多个选择的自定义字段以将这些多个选择写入 SharePoint 列表？

感谢您花时间阅读我的帖子。

干杯，〜彼得

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-19T04:02:58.007

我能够通过继承`SPFieldLookup`并覆盖其内部处理来实现这一点`AllowMultipleValues`：

1.  在您的 FLDTYPES_*.xml 集中`<ParentType>LookupMulti</ParentType>`

2.  在你的扩展中`SPFieldLookup`，一定要覆盖`AllowMultipleValues`（总是`true`），`FieldValueType`（可能`typeof(SPFieldLookupValueCollection)`）和`FieldRenderingControl`。我也设置`base.LookupField = "LinkTitleNoMenu"`了，但回想起来我不知道为什么。:)

3.  在您的字段编辑器控件中`OnSaveChange()`，将字段的`Mult`值设置为`true`。

要设置`Mult`，您可以对字符串进行操作`field.SchemaXml`：

```
string s = field.SchemaXml;
if (s.IndexOf(" Mult=", StringComparison.OrdinalIgnoreCase) < 0)
    field.SchemaXml = s.Insert(s.IndexOf("/>", StringComparison.Ordinal), " Mult=\"TRUE\" "); 
```

或使用反射：

```
 var type = field.GetType();
    var mi = type.GetMethod("SetFieldBoolValue", BindingFlags.Instance | BindingFlags.NonPublic);
    mi.Invoke(field, new object[] { "Mult", true }); 
```

已经有一段时间了，所以我可能会忘记一些东西，但这应该是大部分。

# c# - 使用 IE.GetCookie 的 WatiN 测试仅从 CruiseControl 失败

> ID：187391
> 
> 赞同：1
> 
> 时间：2008-10-09T14:01:08.017
> 
> 标签：c#, cookies, watin, cruisecontrol, mbunit

我今天在我们的应用程序中添加了一些简单的 WatiN 测试，以检查 cookie 值是否正确存储。

测试在团队中的所有机器上本地通过。但是，当 CruiseControl 在我们的构建服务器上运行测试时，这些新测试在包含

`browser.GetCookie(url, cookieName)`

CruiseControl 日志中给出的错误是旧栗子：

`Object reference not set to an instance of an object.`

我已经使用远程桌面登录到构建服务器，使用运行 CruiseControl 的相同用户帐户，并手动运行 MbUnit，并且测试通过了。因此，构建服务器上访问 cookie 的权限不会有问题。

我查看了所有的 WatiN 文档以寻求帮助，但结果都是空的。我已经重新启动了 CruiseControl 服务。我已经尝试了所有我能想到的东西，现在我完全不知道 Cruise Control 运行这些测试的方式可能会有什么不同。

有人知道是什么原因造成的和/或如何解决吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-05T20:05:55.327

尝试将 CruiseControl 作为应用程序而不是作为服务运行。当从服务运行时，WatiN 往往会挂起（因为 Windows 服务未附加到 UI 会话，并且 WatiN 需要一个来处理 IE 中的对话框）。

但除此之外......请记住，IE cookie 存储在您的用户配置文件中。服务运行时不会加载配置文件——它们是在后台安静运行的守护进程，实际上并不在登录会话的上下文中运行。我怀疑这是你异常的原因。

# .net - 跨多个应用程序的配置

> ID：187396
> 
> 赞同：0
> 
> 时间：2008-10-09T14:02:21.243
> 
> 标签：.net, architecture

在 winforms 解决方案中的多个相关应用程序之间共享配置数据的建议是什么？我设想的两种可能的解决方案是使用 machine.config (?) 文件中的自定义部分，另一种是创建一个额外的配置服务应用程序，该应用程序通过其 Properties 类维护设置，并处理来自这些设置的 get 和 set 请求所有其他应用程序。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-09T14:11:59.430

配置服务应用程序的一个问题是，如果设置包含敏感数据（例如数据库密码），您可能需要对服务的调用者进行身份验证/授权。根据您的环境，可能会或可能不会成为问题。

类似地，您可以使用其他一些共享资源来存储设置（共享 XML 文件、数据库），但当然您需要以某种方式“引导”，即每个应用程序都必须有信息来定位共享资源（URL配置服务的位置、XML 文件的位置、配置数据库的连接字符串）。

另一点是配置服务可能会为所有相关应用程序引入额外的单点故障。或者你可以有冗余的配置服务，然后你又回到同步的问题上——这种复杂性通常不能仅仅为了节省更新多个配置文件的工作量。

就我个人而言，我通常在每个应用程序中使用独立的配置文件。在某些情况下，为管理员提供工具以自动更新多个配置文件（例如更改跨多个应用程序共享的数据库密码）。

# c# - C# 可空字符串错误

> ID：187406
> 
> 赞同：135
> 
> 时间：2008-10-09T14:03:57.560
> 
> 标签：c#, nullable

```
private string? typeOfContract
{
  get { return (string?)ViewState["typeOfContract"]; }
  set { ViewState["typeOfContract"] = value; }
} 
```

稍后在代码中我像这样使用它：

```
typeOfContract = Request.QueryString["type"]; 
```

我在声明`typeOfContract`行时收到以下错误：

> 类型“字符串”必须是不可为空的值类型，才能将其用作泛型类型或方法“System.Nullable<T>”中的参数“T”

有任何想法吗？基本上，我想确保在执行操作之前`"type"`存在。`QueryString`

* * *

## 回答 #1

> 赞同：303
> 
> 时间：2008-10-09T14:05:47.120

System.String 是一个引用类型，并且已经“可为空”。

Nullable<T> 和 ? 后缀用于值类型，例如 Int32、Double、DateTime 等。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2008-10-09T14:06:30.457

你把事情弄复杂了。`string`已经可以为空。你不需要让它**更**可空。取出`?`属性类型。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-10-09T14:08:13.603

string 不能作为 Nullable 的参数，因为 string 不是值类型。字符串是引用类型。

```
string s = null; 
```

是一个非常有效的语句，不需要使它可以为空。

```
private string typeOfContract
    {
      get { return ViewState["typeOfContract"] as string; }
      set { ViewState["typeOfContract"] = value; }
    } 
```

应该因为**as**关键字而起作用。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-10-09T14:08:17.443

String 是一种引用类型，因此您不需要（也不能）`Nullable<T>`在此处使用。只需将 typeOfContract 声明为字符串，并在从查询字符串中获取 null 后简单地检查它。或者，如果要处理与 null 相同的空字符串值，请使用 String.IsNullOrEmpty。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-05-16T13:51:19.223

对于可为空`?`的，与所有**C# 原语**一起使用，字符串除外。

以下页面提供了**C# 原语**列表：http : [//msdn.microsoft.com/en-us/library/aa711900 (v=vs.71).aspx](http://msdn.microsoft.com/en-us/library/aa711900(v=vs.71).aspx)

# delegates - 你能解释一下 lambda 表达式吗？

> ID：187414
> 
> 赞同：24
> 
> 时间：2008-10-09T14:05:06.420
> 
> 标签：delegates, lambda, closures, imperative-languages

我并没有真正*得到*lambda 表达式。虽然它们从 ALGOL 时代就已经存在，但直到最近 Python 和 Ruby 变得非常流行时，我才开始听说它们。现在 C# 有了`=>`语法，我的世界 (.NET) 中的人们越来越多地谈论 lamdba 表达式。

我已阅读有关 lambda 演算的 Wikipedia 文章，但我并不是真正的数学专家。从实际的角度来看，我并没有真正理解它。我什么时候使用 lambda 表达式？为什么？我怎么知道这是我应该做的？

您能否以前后格式展示如何解决 lambda 表达式问题的示例？任何命令式语言都可以，但 C# 对我来说最容易理解。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-09T14:08:38.893

基本上就 C# 而言，lambda 表达式是一种创建委托（或表达式树，但我们暂时将其放在一边）的简单方法。

在 C# 1 中，我们只能从普通方法创建委托实例。在 C# 2 中，我们获得了匿名方法。在 C# 3 中，我们获得了 lambda 表达式，它类似于更简洁的匿名方法。

当你想表达一些接受一个值并返回一个值的逻辑时，它们特别简洁。例如，在 LINQ 的上下文中：

```
 // Only include children - a predicate
var query = dataSource.Where(person => person.Age < 18) 
                       // Transform to sequence of names - a projection
                      .Select(person => person.Name); 
```

[在我关于闭包的文章](http://csharpindepth.com/Articles/Chapter5/Closures.aspx)中对此进行了更全面的讨论 - 以及其他方面。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-09T14:06:57.117

[这个问题](https://stackoverflow.com/questions/150129/what-is-a-lambda)的答案可能对你有用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-09T14:11:19.293

lambda 函数只是匿名函数。

例如，在 python 中，您希望将列表中的所有元素加倍。几乎有三种方法可以做到这一点：

列表表达式：

```
[2*x for x in list] 
```

显式功能：

```
def double(x):
    return 2*x
map(double, list) # iirc 
```

使用 lambda：

```
double = lambda x : 2*x
map(double, list) 
```

因此，大多数语言中的 lambda 只是一种避免创建新函数的语法开销的方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-09T14:11:55.437

这是我见过的关于如何理解在 C# 中使用 lambda 表达式的重要思想的更好解释之一：

[http://www.developingfor.net/c-30/upgrade-your-c-skills-part-3-lambda-expressions.html](http://www.developingfor.net/c-30/upgrade-your-c-skills-part-3-lambda-expressions.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-09T14:09:31.730

我在 .NET 中主要使用 lambda 表达式是在处理列表时。使用 lambda 表达式，您可以像构建 SQL 语句来搜索数据库表一样，在列表上构建查询。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-09T14:18:20.073

lambda 表达式是一个函数值（与“int”和“string”是值的意义相同）。这意味着可以

*   定义一个包含 lambda 表达式的变量（这与定义函数相同）
*   从方法或函数返回 lambda 表达式
*   将 lambda 表达式作为参数发送给函数或方法

看一下 map、filter 或 fold（在任何函数式语言中）之类的函数，以了解 lambda 表达式如何用作其他函数的参数。

# c++ - 虚拟列表控件 (MFC)

> ID：187421
> 
> 赞同：1
> 
> 时间：2008-10-09T14:06:39.660
> 
> 标签：c++, windows, user-interface, mfc, controls

我正在使用列表控件来显示向量中元素的表示。当单击列表时，另一个控件会显示有关该元素的信息。元素的索引当前由它在控件中的索引确定，但是如果我希望对结果进行排序或过滤，这将不再有效。

有人告诉我可以使用虚拟列表控件，但是 MSDN 不是很友好，有人可以告诉我如何使用虚拟列表控件吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-09T14:28:18.633

坦率地说 - 将数据（数据向量中的位置）与列表控件中的数据表示（列表 ctrl 中的位置）联系起来是我会远离的。

在 MFC 中，每个控件都有一个“Data”DWORD 成员变量 - 在 MFC 中编码时，我总是为添加的每个项目调用“SetItemData”，并传入相关行引用的指针，例如 `YourListCtrl.SetItemData((DWORDPTR)&YourData);`

然后当 ListCtrl 项目被选中时，你只需调用

`DataTypeYouWant* pData = (DataTypeYouWant*)(YourListCtrl.GetItemData(indexofselecteditem));`

或者类似的东西。

或者 - 如果您不想使用指针 - 在您的行的 itemdata 中保存原始向量中的项目索引（只需将其传递到上面的 fns 中）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-09T14:59:15.997

要使用虚拟列表控件，请设置 LVS_OWNERDATA 样式。然后您需要处理 LVN_GETDISPINFO 通知消息（通过 WM_NOTIFY 发送）。

如果您这样做，您将对数据负全部责任，包括显示的顺序。因此，由您来处理排序等。

到目前为止，最简单的方法是使用项目数据设置/获取可用于检索原始数据的 ID，无论是矢量索引还是指向数据的指针，甚至是关联容器的键。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T15:21:13.003

这实际上取决于您需要的性能。

我个人已经看到包含**大量**数据的列表的性能有显着提高。然而，实现起来**需要做更多的工作**，因此对于没有太多数据的简单用途，我建议远离它。

基本上，虚拟列表控件发生的情况是，您的数据位于您自己的某些数据结构中。由于列表视图仅显示整个数据的一小部分，因此它会在发生某些事情时向您查询要显示的内容（需要重绘、向上或向下滚动、更改排序等）。

我没有方便的例子给你。但是你可以看看 codeguru，我很确定有很好的例子可以开始。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-09T18:34:54.300

虚拟列表控件的目的是完全不同的：当您的列表中有很多项目（我会说 2500+）时，您应该出于性能原因使用它。

在您的情况下，您所需要的只是将矢量索引存储在列表项数据中，正如 NotJarvis 解释的那样。

# video - 录制分量视频

> ID：187433
> 
> 赞同：1
> 
> 时间：2008-10-09T14:08:52.387
> 
> 标签：video

我找到了许多简单、廉价的解决方案，用于将复合视频源录制到我的 PC、笔记本电脑上。但我希望能够以高清录制并使用分量电缆。

我想知道是否有人对此有很好的解决方案。

必需的：

```
Cheap 
```

期望的

```
Portable, external hardware device 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-09T14:17:34.520

取决于您对廉价的定义，但Hauppauge的[高清 PVR价格在 200 美元左右即可。](http://www.hauppauge.com/site/products/data_hdpvr.html)

# python - 如何在 SSL 下制作网站的某些部分而其余部分不制作？

> ID：187434
> 
> 赞同：1
> 
> 时间：2008-10-09T14:09:05.537
> 
> 标签：python, ssl, cherrypy

我需要创建一个有登录区域的cherrypy 主页。我希望登录区域是安全的，但不是页面的其余部分。我怎样才能在 CherryPy 中做到这一点？

理想情况下，任何建议都将与[http://web.archive.org/web/20170210040849/http://tools.cherrypy.org:80/wiki/AuthenticationAndAccessRestrictions兼容](http://web.archive.org/web/20170210040849/http://tools.cherrypy.org:80/wiki/AuthenticationAndAccessRestrictions)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-09T14:23:57.240

这通常被认为是一个坏主意。主要原因是它让大多数人感到困惑，因为网站身份标记出现在几乎每个当前浏览器的 url 区域。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-09T14:24:55.240

假设您只希望实际*页面*的某些部分是安全的，您应该创建一个指向 HTTPS 源的 iframe。但是，这会向用户显示*“页面上的安全和非安全项目”*警告。

# postgresql - 更改 pgsql 端口

> ID：187438
> 
> 赞同：100
> 
> 时间：2008-10-09T14:10:23.617
> 
> 标签：postgresql

我目前有一个在 port 上运行的已安装 pgsql 实例`1486`。我想将此端口更改为`5433`，我应该如何进行呢？

* * *

## 回答 #1

> 赞同：177
> 
> 时间：2008-10-09T14:13:39.553

`postgresql.conf`您的文件中应该有一行内容：

```
port = 1486 
```

改变那个。

该文件的位置可能因您的安装选项而异。在基于 Debian 的发行版上，它是`/etc/postgresql/8.3/main/`

在 Windows 上是`C:\Program Files\PostgreSQL\9.3\data`

不要忘记`sudo service postgresql restart`让更改生效。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2010-03-27T18:16:32.453

您还可以在启动时更改端口：

```
$ pg_ctl -o "-F -p 5433" start 
```

或者

```
$ postgres -p 5433 
```

更多关于这在[手册](http://www.postgresql.org/docs/8.4/interactive/reference-server.html)中。

# .net - 将 HTML 插入 OpenXML Word 文档 (.Net)

> ID：187448
> 
> 赞同：7
> 
> 时间：2008-10-09T14:12:12.440
> 
> 标签：.net, openxml, word-2007

使用 OpenXML SDK，我想将基本的 HTML 片段插入 Word 文档。

你会怎么做：

*   直接操作 XML 吗？
*   使用 XSLT 吗？
*   使用 AltChunk ？

此外，C# 或 VB 示例非常受欢迎 :)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2011-03-09T21:02:39.137

这是另一个（相对较新的）替代方案

[http://notesforhtml2openxml.codeplex.com/](http://notesforhtml2openxml.codeplex.com/)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-25T11:28:43.017

好吧，很难给出一般性的建议，因为这在很大程度上取决于您的输入什么是最好的。

下面是一个使用 OpenXML SDK v2.0 和 XPathDocument 为 (X)HTML 文档中的每个段落插入一个段落到 DOCX 文档中的简单示例：

```
 void ConvertHTML(string htmlFileName, string docFileName)
    {
        // Create a Wordprocessing document. 
        using (WordprocessingDocument package = WordprocessingDocument.Create(docFileName, WordprocessingDocumentType.Document))
        {
            // Add a new main document part. 
            package.AddMainDocumentPart();

            // Create the Document DOM. 
            package.MainDocumentPart.Document = new Document(new Body());
            Body body = package.MainDocumentPart.Document.Body;

            XPathDocument htmlDoc = new XPathDocument(htmlFileName);

            XPathNavigator navigator = htmlDoc.CreateNavigator();
            XmlNamespaceManager mngr = new XmlNamespaceManager(navigator.NameTable);
            mngr.AddNamespace("xhtml", "http://www.w3.org/1999/xhtml");

            XPathNodeIterator ni = navigator.Select("//xhtml:p", mngr);
            while (ni.MoveNext())
            {
                body.AppendChild<Paragraph>(new Paragraph(new Run(new Text(ni.Current.Value))));
            }

            // Save changes to the main document part. 
            package.MainDocumentPart.Document.Save();
        }
    } 
```

该示例要求您的输入是有效的 XML，否则在创建 XPathDocument 时会出现异常。

请注意，这是一个非常基本的示例，没有考虑任何格式、标题、列表等。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-13T06:55:33.260

我不确定，您实际上想要实现什么。OpenXML 文档对格式化元素（如段落、粗体文本等）有自己的类似 html (WordprocessingML) 的表示法。如果您想在文档中添加一些具有基本格式的文本，而不是我建议使用 OpenXML 语法并用它来格式化插入的文本。

如果您有一个必须包含在文档中的 html 片段，则可以使用 OpenXML 的“外部内容”功能。使用外部内容，您可以将 HTML 文档包含到包中，并在要包含此内容的位置的文档中创建引用 (altChunk)。此解决方案的缺点是，并非所有工具都会支持（或正确支持）生成的文档，因此我不推荐此解决方案，除非您确实无法更改 HTML 源。

如何将任何内容（wordml）包含到 openxml word doc 是一个独立的问题，恕我直言，答案在很大程度上取决于您要应用的复杂修改以及文档的大小。对于一个简单的文档，我会简单地从包中读出文档部分，获取它的流并将其加载到 XmlDocument。您可以很容易地将其他内容插入 XmlDocument，然后将其保存回包中。如果文档很大，或者您需要在多个地方进行复杂的修改，那么 XSLT 是一个不错的选择。

# java - 导入包.* 与导入包.SpecificType

> ID：187453
> 
> 赞同：109
> 
> 时间：2008-10-09T14:12:44.953
> 
> 标签：java, import, overhead

是否会假设在编写一个导入加载一个包中的所有类型的开销方面有任何差异（`import java.*`）？不仅仅是一个特定的类型（即`import java.lang.ClassLoader`）？第二种会比另一种更可取吗？

* * *

## 回答 #1

> 赞同：132
> 
> 时间：2008-10-09T14:21:21.457

看一下java API，你会在不同的包中看到许多同名的类和接口。

例如：

```
java.lang.reflect.Array
java.sql.Array 
```

因此，如果您导入`java.lang.reflect.*`并且`java.sql.*`您将在 Array 类型上发生冲突，并且必须在您的代码中完全限定它们。

相反，导入特定的类将为您省去这个麻烦。

* * *

## 回答 #2

> 赞同：115
> 
> 时间：2008-10-09T14:17:00.530

进行 import .* 与导入特定类型相比，没有性能或开销成本。但是，我认为永远不要使用 import .* 是一个最佳实践.

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2008-10-09T18:46:25.743

这实际上是一个非常糟糕的问题。

假设你写

```
import a.*;
import b.*;
...
Foo f; 
```

并且类 Foo 存在于包 a 中。

现在你检查你完美编译的代码，六个月后，有人将类 Foo 添加到包 b 中。（也许是在最新版本中添加了类的第三方库）。

噗！现在您的代码拒绝编译。

***永远不要***使用按需导入。是邪恶的！

有关详细信息，请参阅[http://javadude.com/articles/importondemandisevil.html 。](http://javadude.com/articles/importondemandisevil.html)

稀土性能：

```
import a.*; 
```

对比

```
import a.X; 
```

在运行时没有区别。编译器将解析的类名硬连线到生成的 .class 文件中。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2010-01-26T21:19:52.323

**少数派观点：**在我的代码中，我倾向于使用来自几个包的大量类以及一些奇怪的类。我喜欢保持我的进口清单很小，这样我就可以一眼看出发生了什么。为此，我将阈值设置为 4 个班级。除此之外，Eclipse 将使用 * 作为我的代码。我发现这使我的包导入可读，并且我倾向于将它们称为我查看课程时**要做的第一件事**，以回答以下问题：它与谁交谈？

**关于名称冲突：**您从两个具有竞争类名的包中导入四个或更多类的可能性有多大？如果超过 10% 的时间，您可能需要考虑您的类所依赖的包的数量（例如，将其重构为更小的类）。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-10-09T14:19:45.140

从不使用 import xxx.* 的一个很好的理由是对[依赖](https://stackoverflow.com/questions/62276)有清晰的认识。

您可以更快地知道您正在使用另一个包的特定类，因为它列在源文件的开头。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2008-10-09T15:23:24.013

在寻找更多信息后，我发现了这个网站，其中解释得很好。[导入问题](http://java.sun.com/developer/TechTips/2000/tt0110.html#tip2 "导入问题")和[在导入语句中使用 * 会影响性能吗？](http://www.javaperformancetuning.com/news/qotm031.shtml "在导入语句中使用 * 会影响性能吗？").

这两种风格之间是否存在效率问题？可能，但由于导入声明实际上并没有将任何内容导入您的程序，因此任何差异都非常小。请记住，在编译单元的顶部有一个隐式导入 java.lang.*，而 JDK 1.2.2 中的 java.lang 包含 75 个类和接口。使用一个人为示例的实验，一个必须查找数千个类名使用的示例，显示编译速度的变化可以忽略不计。因此，在选择一种格式而不是另一种格式时，编译性能可能不应该被视为一个因素。

最后一个关于进口申报的兴趣点。假设您使用内部类：

```
package P;

public class A {
    public static class B {}
} 
```

如果你想从另一个编译单元访问 A，你说：

```
import P.*; 
```

或：进口PA；但是如果你想在没有资格的情况下访问 B，你需要说：

```
import P.A.*; 
```

或：进口PAB；其中第一个使包 P 中的类 A 中的类型可用。第二个使包 P 中的类 A 中的类型 B 可用。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-10-09T15:53:49.630

我倾向于使用 IDE 默认值。我发现这并不是真正值得担心的事情，因为它对性能没有影响，并且可以使用各种工具来检查依赖关系。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2011-12-10T08:29:02.773

如果你从同一个包中导入超过 20 个类，你最好使用 import xxx.*。“清洁代码”也有利于导入整个包。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-09T17:11:17.167

导入在字节码级别无关紧要，因此应该没有运行时差异。

我发现最好：a）通过列出所有导入来明确b）让您的IDE管理它。任何主要的 IDE 都可以自动更新、排序和完成您的导入。

我发现 a) 在在 IDE 重构的上下文之外进行手动重新打包时会派上用场。例如，当营销更改您的产品名称并决定您的所有包裹都应该更改名称时。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-01-26T21:45:52.420

这更像是一种很好的编码实践，因为任何阅读您的代码的人都会通过查看文件顶部的导入块立即知道特定类使用了哪些类，而您必须深入了解您是否使用了通配符。

# svn - Subversion没有将更改合并到重命名的文件中？

> ID：187454
> 
> 赞同：25
> 
> 时间：2008-10-09T14:12:48.353
> 
> 标签：svn

我在使用颠覆时遇到以下问题：

我目前正在处理我的项目的主干，并计划进行一些重构（包括重命名文件或将文件移动到不同的目录）。

同时，其他人正在分支上从事同一个项目。

有时我想将分支上所做的更改合并回主干。这包括对已在主干上重命名的文件（在分支上）所做的更改。

我做了一些测试，似乎任何一个颠覆都无法遵循这些变化，或者我错过了一些东西（这是我所希望的）。我使用以下脚本对此进行了测试（应该在 bash 中工作，假设 svn 存储库位于“ [http://myserver/svn/sandbox](http://myserver/svn/sandbox) ”）：

```
svn co http://myserver/svn/sandbox

cd sandbox/

mkdir -p MyProject/trunk MyProject/branches MyProject/tags

cat - <<EOF >MyProject/trunk/FileOne.txt
Test
1
2
EOF

svn add MyProject

svn commit -m "init"

# create a branch
svn copy http://myserver/svn/sandbox/MyProject/trunk http://myserver/svn/sandbox/MyProject/branches/Branch_1 svn copy http://myserver/svn/sandbox/MyProject/trunk http://myserver/svn/sandbox/MyProject/branches/Branch_1

# rename the file
svn move MyProject/trunk/FileOne.txt MyProject/trunk/FileTwo.txt

svn commit -m "renamed file"

svn update 

# change the content of FileOne in branch

cat - <<EOF >MyProject/branches/Branch_1/FileOne.txt
Test
2
3
EOF

svn commit -m "changed branch"

# I now try to merge the changes in FileOne back to FileTwo
cd MyProject/trunk/
svn merge -r1:HEAD http://myserver/svn/sandbox/MyProject/branches/Branch_1
# but this yields the following message:
# Skipped missing target: 'FileOne.txt' 
```

任何帮助是极大的赞赏。

编辑：也许 mikegrb 建议的过程可以通过首先从主干上的 svn log 命令生成重命名文件（旧->新）的映射来稍微自动化：

```
svn log -v
------------------------------------------------------------------------
r33 | sme | 2008-10-09 15:17:54 +0200 (Do, 09 Okt 2008) | 1 line
Changed paths:
   D /MyProject/trunk/FileOne.txt
   A /MyProject/trunk/FileTwo.txt (from /MyProject/trunk/FileOne.txt:31)

resulting map: {FileOne.txt => FileTwo.txt} 
```

现在使用此映射更改分支上生成的补丁文件中的文件名。

原来的：

```
Index: FileOne.txt
===================================================================
--- FileOne.txt (.../trunk)     (revision 31)
+++ FileOne.txt (.../branches/Branch_1) (revision 34)
@@ -1,3 +1,3 @@
 Test
-1
 2
+3 
```

修改的：

```
Index: FileTwo.txt
===================================================================
--- FileTwo.txt (.../trunk)     (revision 31)
+++ FileTwo.txt (.../branches/Branch_1) (revision 34)
@@ -1,3 +1,3 @@
 Test
-1
 2
+3 
```

只是一个想法，还没做。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-09T14:20:58.133

我认为这是一个现有的颠覆[错误](http://subversion.tigris.org/issues/show_bug.cgi?id=898)- 但不要屏住呼吸，它自 2002 年以来一直开放。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-09T14:19:43.377

不幸的是，这是颠覆的局限之一。当我们最近遇到类似情况时，我们的解决方案是为分支创建一个巨大的差异，然后逐个文件手动修补主干。已重命名且未找到的文件将导致patch 提示输入要修补的文件名。非常次优。注意不会在 diff 中显示的二进制文件。这是促使我们评估其他版本控制系统并最终决定过渡到 git 的重要因素之一。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T14:18:26.733

您可能必须在分支中重命名它们。您可以合并将它们从主干重命名为分支的修订吗？这可能会节省一些时间。否则，您必须在分支中重命名它们。然后尝试合并回主干。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-08-22T14:54:43.543

一种解决方法是在将主干与分支同步之前将分支与主干同步。

不同之处在于，主干到分支有一个文件可以应用更改（移动），而分支到主干没有文件可以应用更改（修改）。这仅仅是因为 SVN 似乎没有跟踪文件被移动/重命名的位置。我不知道为什么它没有，希望有一个很好的理由。

例子：

*   rev 1: /trunk/foo.txt 移动到 /trunk/folder/foo.txt
*   rev 2: /branches/mybranch/foo.txt 已修改

如何将 foo.txt 更改合并到主干中？

解决方案：

1.  将所有修订从主干合并到 mybranch 并提交。这将导致 foo.txt 移动。
2.  将 mybranch 中的所有修订合并到主干。这将更新 foo.txt 的内容，因为它们现在具有相同的路径。

注意：如果您在 trunk 和 mybranch 上移动/重命名了不同的文件，那么您就可以试一试了。我想您将不得不有选择地合并更改，以便您首先在两个方向上移动/重命名，然后合并更改。

# python - 在 Python 中计算数组元素

> ID：187455
> 
> 赞同：190
> 
> 时间：2008-10-09T14:12:55.153
> 
> 标签：python, arrays

如何计算数组中元素的数量，因为与逻辑相反，array.count(string) 不会计算数组中的所有元素，它只是搜索字符串的出现次数。

* * *

## 回答 #1

> 赞同：344
> 
> 时间：2008-10-09T14:14:56.930

len() 方法返回列表中元素的数量。

句法：

```
len(myArray) 
```

例如：

```
myArray = [1, 2, 3]
len(myArray) 
```

输出：

```
3 
```

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-10-09T19:40:04.697

`len`是一个内置函数，它调用给定容器对象的`__len__`成员函数来获取对象中的元素数量。

用双下划线括起来的函数通常是实现 Python 中的标准接口之一（容器、数字等）的“特殊方法”。通过语法糖使用特殊方法（对象创建、容器索引和切片、属性访问、内置函数等）。

使用`obj.__len__()`不会是使用特殊方法的正确方法，但我不明白为什么其他人被修改了这么多。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2015-08-11T09:03:51.290

如果你有一个多维数组， len() 可能不会给你你正在寻找的值。例如：

```
import numpy as np
a = np.arange(10).reshape(2, 5)
print len(a) == 2 
```

此代码块将返回 true，告诉您数组的大小为 2。然而，实际上这个 2D 数组中有 10 个元素。在多维数组的情况下， len() 为您提供数组*第一*维的长度，即

```
import numpy as np
len(a) == np.shape(a)[0] 
```

要获取任意形状的多维数组中的元素数：

```
import numpy as np
size = 1
for dim in np.shape(a): size *= dim 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-09T14:23:27.940

或者，

```
myArray.__len__() 
```

如果你想成为 oopy；“len(myArray)” 更容易输入！:)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-07-17T03:05:05.933

在我看到这个之前，我心想，“我需要想办法做到这一点！”

```
for tempVar in arrayName: tempVar+=1 
```

然后我想，“一定有更简单的方法来做到这一点。” 我是对的。

`len(arrayName)`

# projects-and-solutions - 是否有系统的方法来避免软件解决方案的 3 个陷阱（如下）？

> ID：187458
> 
> 赞同：0
> 
> 时间：2008-10-09T14:14:10.707
> 
> 标签：projects-and-solutions, requirements

1.  开发已经存在并可重复使用（商业或开源）的软件解决方案。又名“重新发明轮子”。
2.  与上述相同，但您的解决方案已被破坏。又名“重新发明方轮”。
3.  为不存在的问题制定解决方案。

同样，我对更**正式**的方法感兴趣，例如[TRIZ](http://en.wikipedia.org/wiki/Algorithm_of_Inventive_Problems_Solving)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-09T14:19:22.613

事先做一些研究 (1) 并投资于可靠的软件架构 (2,3) 通常会有所帮助:)

当你计划开发一些东西时，你总是需要计算做一些事情的好处和投资回报率之类的东西。

您可以在Mike Cohn的[敏捷估算和规划](https://rads.stackoverflow.com/amzn/click/com/0131479415)中阅读更多相关信息

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T14:23:48.237

1.  本地市场研究
2.  互联网研究
3.  谷歌指标（看看谷歌计数是什么）

# java - ClassDefNotFound 我第一次从 Eclipse 中启动 Tomcat

> ID：187461
> 
> 赞同：0
> 
> 时间：2008-10-09T14:14:37.257
> 
> 标签：java, eclipse, tomcat

我有一个 Tomcat 应用程序，在启动 Eclipse 后第一次启动 Tomcat 时，我得到一个奇怪的 NoClassDefFoundError。 **如果我然后通过 Eclipse 停止并重新启动 Tomcat，它工作正常。** 我对类路径进行了一次、两次和三次检查，一切似乎都很好。以前有人见过这样的事情吗？

相关版本：

Tomcat 5.5.17
eclipse 3.3 europa
Tomcat 插件 sysdeo 制作的 Eclipse：
com.sysdeo.eclipse.tomcat_3.2.1

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-09T23:00:13.577

我注意到这是一个相当旧的 Tomcat 版本，这可能会导致问题。你可以试试以下

1.  启动 Eclipse。
2.  清理你的 webapp 项目（如果自动构建关闭，则构建）
3.  启动 Tomcat 服务器。

这是我唯一能想到的。除此之外，我建议获取最新的 5.5 版本的 tomcat（我认为是 5.5.25）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T03:42:37.087

我也遇到过类似的问题，我想我通过链接整个类文件夹来解决它，虽然是一个不同的文件夹，但在几个地方有库的副本，并且 Tomcat 服务器需要将运行时中的库导入到该项目。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T03:39:08.967

缺少的课程是什么？您是否尝试过使用 wtp 而不是 sysdeo 来启动和停止 tomcat？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-09T03:23:45.117

我发现 tomcat 插件通常有问题，并且已经停止使用它。

在我的咨询工作中，我与一个团队合作，该团队在开发中的应用程序存在各种稳定性问题。删除 tomcat 插件，只需让它们从命令行启动/停止 tomcat 即可解决所有问题。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-09T14:27:05.157

没有，没见过。该类不太可能存在并且它是类加载器问题。缺少什么课程。可能是它偶尔会遇到一些错误情况

例如试图打开一个已经打开的端口

并且错误导致它尝试加载这个特定的类

# java - GWT 中的客户端回调

> ID：187462
> 
> 赞同：6
> 
> 时间：2008-10-09T14:14:51.873
> 
> 标签：java, gwt, callback, server-push, client-side

我正在尝试为 GWT 应用程序创建一个记录器，作为评估 GWT 的练习。我特别想做的是拥有它，以便我可以在服务器端的任何时候将消息发布到客户端标签。因此，如果服务器上发生了一些有趣的事情，则可以更新客户端。

我的第一个问题是，这可能吗，我可以理解它不是。

其次，如果可能的话，我应该在哪里寻找信息，我已经尝试过 google 和他们的文档，所有的展示都没有这方面的信息。

谢谢

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-09T14:21:46.230

好吧，有几个选项。您需要从服务器获取数据...所以您要么需要轮询服务器，要么使用服务器推送。

轮询非常简单。只需使用[Timer](http://google-web-toolkit.googlecode.com/svn/javadoc/1.5/index.html?overview-summary.html)类重复调用服务以查看它应该显示什么值。

服务器推送是使用诸如彗星之类的东西完成的。[这](http://code.google.com/p/rocket-gwt/wiki/Comet)是 gwt 的一种实现，看起来有些有希望。他们背后的基本概念是浏览器向服务器发送请求并保持连接打开，以便服务器可以自由地继续发送数据。

如果你能让它工作，彗星是更好的选择。它可能会更简单并且可以更好地扩展。

祝你好运！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T14:26:18.920

轮询可能是完成您正在寻找的事情的最佳方式。GWT 最大的问题是一切都必须是可序列化的。我不确定是否可以轻松序列化任何可以推送到浏览器的内容。

# c# - 在 C# 中通过 USB 驱动 POS 打印机

> ID：187465
> 
> 赞同：7
> 
> 时间：2008-10-09T14:16:45.303
> 
> 标签：c#, usb, point-of-sale

任何想法如何最好地从 c# 驱动 USB POS 打印机。POS 打印机通常是基于串行、TCP/IP 或 USB 的。我知道如何完成串行和 TCP/IP，但不知道如何在 C# 中通过 USB 进行通信。我知道微软提供了一个名为 POS.NET 的层，但我想尽量避免使用它。人们可以推荐的任何想法或任何 C# 库将不胜感激。谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-04T01:46:26.097

您真的应该考虑将 POS 用于 .NET 和 OPOS 或 .NET 服务对象（例如，Epson 提供这两者）。.NET 的 POS 符合用于与这些设备连接的 UnifiedPOS 行业标准。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-09T14:25:09.467

如果打印机将自己注册为人机接口设备，您可以[P/INVOKE 进入适当的 Win32 API](http://www.lvr.com/hidpage.htm "隐藏页面")。以下是签名：

```
 [ DllImport( "hid.dll", SetLastError=true ) ]
    public static extern Boolean 
    HidD_FlushQueue( SafeFileHandle HidDeviceObject );        

    [ DllImport( "hid.dll", SetLastError=true ) ]
    public static extern Boolean 
    HidD_FreePreparsedData( ref IntPtr PreparsedData );        

    [ DllImport( "hid.dll", SetLastError=true ) ]
    public static extern Boolean 
    HidD_GetAttributes(  SafeFileHandle HidDeviceObject
                       , ref HIDD_ATTRIBUTES Attributes );        

    [ DllImport( "hid.dll", SetLastError=true ) ]
    public static extern Boolean 
    HidD_GetFeature(  SafeFileHandle HidDeviceObject
                    , ref Byte lpReportBuffer
                    , Int32 ReportBufferLength );        

    [ DllImport( "hid.dll", SetLastError=true ) ]
    public static extern Boolean 
    HidD_GetInputReport( SafeFileHandle HidDeviceObject
                        ,ref Byte lpReportBuffer
                        ,Int32 ReportBufferLength );        

    [ DllImport( "hid.dll", SetLastError=true ) ]
    public static extern void HidD_GetHidGuid( ref System.Guid HidGuid );

    [ DllImport( "hid.dll", SetLastError=true ) ]
    public static extern Boolean 
    HidD_GetNumInputBuffers(  SafeFileHandle HidDeviceObject
                            , ref Int32 NumberBuffers );        

    [ DllImport( "hid.dll", SetLastError=true ) ]
    public static extern Boolean 
    HidD_GetPreparsedData( SafeFileHandle HidDeviceObject
                          ,ref IntPtr PreparsedData );

    [ DllImport( "hid.dll", SetLastError=true ) ]
    public static extern Boolean 
    HidD_SetFeature(  SafeFileHandle HidDeviceObject
                    , ref Byte lpReportBuffer
                    , Int32 ReportBufferLength );

    [ DllImport( "hid.dll", SetLastError=true ) ]
    public static extern Boolean 
    HidD_SetNumInputBuffers( SafeFileHandle HidDeviceObject
                            ,Int32 NumberBuffers );

    [ DllImport( "hid.dll", SetLastError=true ) ]
    public static extern Boolean 
    HidD_SetOutputReport( SafeFileHandle HidDeviceObject
                         ,ref Byte lpReportBuffer
                         ,Int32 ReportBufferLength );

    [ DllImport( "hid.dll", SetLastError=true ) ]
    public static extern Int32 
    HidP_GetCaps( IntPtr PreparsedData, ref HIDP_CAPS Capabilities );

    [ DllImport( "hid.dll", SetLastError=true ) ]
    public static extern Int32 
    HidP_GetValueCaps(  Int16 ReportType
                      , ref Byte ValueCaps
                      , ref Int16 ValueCapsLength
                      , IntPtr PreparsedData ); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T14:26:54.363

icsharpcode 的人[在这里](http://www.icsharpcode.net/opensource/sharpusblib/)有一个 Win32 USP api 的 C# 包装器，我在 .Net 中至少看到了[另一个](http://weblogs.asp.net/israelio/archive/2005/08/15/422637.aspx)对 USB 东西的引用。

棘手的是打印机是否需要 OPOS 才能运行。几年前，我在 .Net 的一个 POS 项目上做了一些工作，据我所知，OPOS 几乎是硬件方面的标准（当时所有的 OPOS API 都使用 COM 互操作）。这些设备有时还具有记录在案的专有通信协议，在这种情况下，您应该能够利用该协议与使用 USB 库的设备进行通信。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-09T16:12:09.953

如果您已经滚动了自己的打印机控制代码，那么您可以通过使用 USB 端口上的“通用/文本”打印机驱动程序设置打印机，将命令直接传递给打印机。该驱动程序不会重新解释控制代码并尝试打印它们，但它只会将它们按原样传递给打印机。

然后可以像使用任何其他打印机一样使用 USB 端口。

这种方法适用于我开发的 POS 系统。

# oracle - 甲骨文日期

> ID：187474
> 
> 赞同：17
> 
> 时间：2008-10-09T14:18:52.303
> 
> 标签：oracle

Oracle 日期是如何实现的？它是否存储为毫秒或类似的东西？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-09T14:23:25.540

Oracle DATE 将日期和时间存储到秒。Oracle TIMESTAMP 将日期和时间存储到最多 9 位亚秒级精度，具体取决于可用的硬件。

两者都是通过以打包二进制格式存储日期和时间的各种组件来实现的。来自[关于日期的 Oracle 概念指南部分](http://download.oracle.com/docs/cd/B19306_01/server.102/b14220/datatype.htm#CNCPT413)

> Oracle 使用自己的内部格式来存储日期。日期数据存储在每个七个字节的固定长度字段中，对应于世纪、年、月、日、小时、分钟和秒。

您可以使用[DUMP()](http://docs.oracle.com/cd/B28359_01/server.111/b28286/functions048.htm)函数来查看任何特定日期（或任何其他值）的内部表示，但这可能比您需要（或想要）知道的要多。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-09T14:24:24.740

不，DATE 是一个具有秒精度的*时间戳值。*您需要 TIMESTAMP(3) 来存储毫秒。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T14:25:37.750

显然，不是毫秒的形式。

这实际上是有道理的，因为它们在当前日期/时间没有任何正在运行的操作：

[http://www.ixora.com.au/notes/date_representation.htm](http://www.ixora.com.au/notes/date_representation.htm)

[http://infolab.stanford.edu/~ullman/fcdb/oracle/or-time.html](http://infolab.stanford.edu/~ullman/fcdb/oracle/or-time.html)

[http://www.akadia.com/services/ora_date_time.html](http://www.akadia.com/services/ora_date_time.html)

# c# - 如何在 ASP.NET 中使用按钮标记？

> ID：187482
> 
> 赞同：63
> 
> 时间：2008-10-09T14:20:28.383
> 
> 标签：c#, asp.net, html, htmlbutton

我想`<button>`在 ASP.NET 网站中使用较新的标签，除其他外，它允许 CSS 样式的文本并在按钮内嵌入图形。asp:Button 控件呈现为`<input type="button">`，有没有办法使预先存在的控件呈现为`<button>`？

从我读过的内容来看，当按钮位于 a 内时，IE 发布按钮的标记而不是 value 属性不兼容`<form>`，但在 ASP.NET 中它将使用 onclick 事件触发 __doPostBack，所以我不不认为这会是一个问题。

有什么理由我不应该使用它吗？如果没有，您将如何使用 asp:Button 或基于它的新服务器控件来支持它？如果可以避免，我宁愿不编写自己的服务器控件。

* * *

起初该`<button runat="server">`解决方案有效，但我立即遇到了需要具有 CommandName 属性的情况，而 HtmlButton 控件没有该属性。看来我毕竟需要创建一个从 Button 继承的控件。

我需要做什么才能覆盖渲染方法并使其呈现我想要的内容？

* * *

**更新**

DanHerbert 的回复让我有兴趣再次找到解决此问题的方法，因此我花了更多时间来解决这个问题。

首先，重载 TagName 有一种更简单的方法：

```
public ModernButton() : base(HtmlTextWriterTag.Button)
{
} 
```

Dan 的解决方案的问题在于标签的 innerhtml 被放入 value 属性中，这会导致回发时出现验证错误。一个相关的问题是，即使您正确呈现 value 属性，IE 的`<button>`标记的脑死实现仍会发布 innerhtml 而不是 value。因此，任何实现都需要重写 AddAttributesToRender 方法以正确呈现 value 属性，并为 IE 提供某种解决方法，这样它就不会完全搞砸回发。

如果您想利用数据绑定控件的 CommandName/CommandArgument 属性，IE 问题可能是无法克服的。希望有人可以为此提出解决方法。

我在渲染方面取得了进展：

[现代按钮.cs](http://gist.github.com/69841)

这将呈现为具有正确值的正确 html `<button>`，但它不适用于 ASP.Net PostBack 系统。我已经写了一些我需要提供`Command`事件的东西，但它不会触发。

当与常规 asp:Button 并排检查此按钮时，除了我需要的差异外，它们看起来相同。所以我不确定`Command`在这种情况下 ASP.Net 是如何连接事件的。

另一个问题是，嵌套的服务器控件没有被渲染（正如你可以看到的 ParseChildren(false) 属性）。在渲染期间将文字 html 文本注入控件非常容易，但是如何支持嵌套的服务器控件呢？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-07-23T12:56:32.603

尽管您说使用 [button runat="server"] 不是一个足够好的解决方案，但重要的是要提一下 - 许多 .NET 程序员害怕使用“本机”HTML标签......

采用：

```
<button id="btnSubmit" runat="server" class="myButton" 
    onserverclick="btnSubmit_Click">Hello</button> 
```

这通常工作得很好，我的团队中的每个人都很高兴。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2015-08-07T13:36:01.843

这是一个古老的问题，但对于我们这些不幸仍然不得不维护 ASP.NET Web 窗体应用程序的人来说，我在尝试将 Bootstrap 字形包含在内置按钮控件中时自己经历了这个问题。

根据 Bootstrap 文档，所需的标记如下：

```
<button class="btn btn-default">
    <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
    Search
</button> 
```

我需要这个标记由服务器控件呈现，所以我开始寻找选项。

# 按钮

这将是第一个合乎逻辑的步骤，但是——正如这个问题所解释的—— Button 呈现一个`<input>`元素而不是`<button>`，因此添加内部 HTML 是不可能的。

# LinkBut​​ton （归功于[Tsvetomir Tsonev 的回答](https://stackoverflow.com/a/187527)）

**来源**

```
<asp:LinkButton runat="server" ID="uxSearch" CssClass="btn btn-default">
    <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
    Search
</asp:LinkButton> 
```

**输出**

```
<a id="uxSearch" class="btn btn-default" href="javascript:__doPostBack(&#39;uxSearch&#39;,&#39;&#39;)">
    <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
    Search
</a> 
```

**优点**

*   看起来不错
*   `Command`事件; `CommandName`和`CommandArgument`属性

**缺点**

*   渲染`<a>`而不是`<button>`
*   呈现并依赖于突兀的 JavaScript

# HtmlButton（归功于[菲利普的回答](https://stackoverflow.com/a/1171539)）

**来源**

```
<button runat="server" id="uxSearch" class="btn btn-default">
    <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
    Search
</button> 
```

**结果**

```
<button onclick="__doPostBack('uxSearch','')" id="uxSearch" class="btn btn-default">
    <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
    Search
</button> 
```

**优点**

*   看起来不错
*   渲染适当的`<button>`元素

**缺点**

*   没有`Command`事件；没有`CommandName`或`CommandArgument`属性
*   呈现并依赖于突兀的 JavaScript 来处理其`ServerClick`事件

* * *

在这一点上，显然没有一个内置控件看起来合适，因此下一步合乎逻辑的步骤是尝试修改它们以实现所需的功能。

# 自定义控件（归功于[Dan Herbert 的回答](https://stackoverflow.com/a/573990)）

**注意：这是基于 Dan 的代码，所以所有功劳归他所有。**

```
using System.Web.UI;
using System.Web.UI.WebControls;

namespace ModernControls
{
    [ParseChildren]
    public class ModernButton : Button
    {
        public new string Text
        {
            get { return (string)ViewState["NewText"] ?? ""; }
            set { ViewState["NewText"] = value; }
        }

        public string Value
        {
            get { return base.Text; }
            set { base.Text = value; }
        }

        protected override HtmlTextWriterTag TagKey
        {
            get { return HtmlTextWriterTag.Button; }
        }

        protected override void AddParsedSubObject(object obj)
        {
            var literal = obj as LiteralControl;
            if (literal == null) return;
            Text = literal.Text;
        }

        protected override void RenderContents(HtmlTextWriter writer)
        {
            writer.Write(Text);
        }
    }
} 
```

我已经将这个类精简到最低限度，并对其进行了重构，以尽可能少的代码实现相同的功能。我还添加了一些改进。即：

*   删除`PersistChildren`属性（似乎没有必要）
*   删除`TagName`覆盖（似乎没有必要）
*   `Text`从（基类已处理此）中删除 HTML 解码
*   保持`OnPreRender`原状；`AddParsedSubObject`改为覆盖（更简单）
*   简化`RenderContents`覆盖
*   添加`Value`属性（见下文）
*   添加命名空间（以包含**@Register**指令的示例）
*   添加必要`using`的指令

该`Value`属性只是访问旧`Text`属性。`value`这是因为本机 Button 控件无论如何都会呈现一个属性（`Text`以其值作为其值）。由于`value`是`<button>`元素的有效属性，因此我决定为其包含一个属性。

**来源**

```
<%@ Register TagPrefix="mc" Namespace="ModernControls" %>

<mc:ModernButton runat="server" ID="uxSearch" Value="Foo" CssClass="btn btn-default" >
    <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
    Search
</mc:ModernButton> 
```

**输出**

```
<button type="submit" name="uxSearch" value="Foo" id="uxSearch" class="btn btn-default">
    <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
    Search
</button> 
```

**优点**

*   看起来不错
*   渲染一个合适的`<button>`元素
*   `Command`事件; `CommandName`和`CommandArgument`属性
*   不呈现或依赖于突兀的 JavaScript

**缺点**

*   无（除了不是内置控件）

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2009-02-22T00:08:16.807

我偶然发现了你的问题，正在寻找同样的东西。我最终使用[Reflector](http://www.red-gate.com/products/reflector/)来确定 ASP.NET`Button`控件的实际呈现方式。事实证明它真的很容易改变。

它实际上只是归结为覆盖类的`TagName`和`TagKey`属性`Button`。完成此操作后，您只需要确保手动渲染按钮的内容，因为原始`Button`类从来没有要渲染的内容，并且如果您不渲染内容，控件将渲染无文本按钮。

**更新：**

可以通过继承对 Button 控件进行一些小的修改，并且仍然可以很好地工作。此解决方案消除了为 OnCommand 实现您自己的事件处理程序的需要（尽管如果您想学习如何做到这一点，我可以向您展示如何处理）。它还解决了提交包含标记的值的问题，可能除了 IE。不过，我仍然不确定如何修复 IE 对 Button 标记的不良实施。这可能只是一个无法解决的真正技术限制......

```
[ParseChildren(false)]
[PersistChildren(true)]
public class ModernButton : Button
{
    protected override string TagName
    {
        get { return "button"; }
    }

    protected override HtmlTextWriterTag TagKey
    {
        get { return HtmlTextWriterTag.Button; }
    }

    // Create a new implementation of the Text property which
    // will be ignored by the parent class, giving us the freedom
    // to use this property as we please.
    public new string Text
    {
        get { return ViewState["NewText"] as string; }
        set { ViewState["NewText"] = HttpUtility.HtmlDecode(value); }
    }

    protected override void OnPreRender(System.EventArgs e)
    {
        base.OnPreRender(e);
        // I wasn't sure what the best way to handle 'Text' would
        // be. Text is treated as another control which gets added
        // to the end of the button's control collection in this 
        //implementation
        LiteralControl lc = new LiteralControl(this.Text);
        Controls.Add(lc);

        // Add a value for base.Text for the parent class
        // If the following line is omitted, the 'value' 
        // attribute will be blank upon rendering
        base.Text = UniqueID;
    }

    protected override void RenderContents(HtmlTextWriter writer)
    {
        RenderChildren(writer);
    }
} 
```

要使用此控件，您有几个选项。一种是将控件直接放入 ASP 标记中。

```
<uc:ModernButton runat="server" 
        ID="btnLogin" 
        OnClick="btnLogin_Click" 
        Text="Purplemonkeydishwasher">
    <img src="../someUrl/img.gif" alt="img" />
    <asp:Label ID="Label1" runat="server" Text="Login" />
</uc:ModernButton> 
```

您还可以将控件添加到代码隐藏中按钮的控件集合中。

```
// This code probably won't work too well "as is"
// since there is nothing being defined about these
// controls, but you get the idea.
btnLogin.Controls.Add(new Label());
btnLogin.Controls.Add(new Table()); 
```

我不知道这两个选项的组合效果如何，因为我没有测试过。

现在这个控件的唯一缺点是我认为它不会记住你在 PostBacks 中的控件。我没有对此进行测试，所以它可能已经工作了，但我怀疑它是否有效。您需要为子控件添加一些 ViewState 管理代码，以便跨 PostBacks 处理我认为，但这对您来说可能不是问题。添加 ViewState 支持应该不难做到，尽管如果需要可以轻松添加。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-09T14:41:10.853

您可以创建一个新控件，从 Button 继承，并覆盖 render 方法，或使用 .browser 文件覆盖站点中的所有 Button，类似于 CSS 友好的东西适用于 TreeView 控件等的方式。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-09T15:59:18.497

您可以使用[Button.UseSubmitBehavior](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.button.usesubmitbehavior.aspx)属性，如本文中[关于将 ASP.NET Button 控件呈现为按钮的](http://www.xerratus.com/2006/11/22/HowToGetASPNET20ButtonWebControlToRenderAsInputTypebutton.aspx)讨论。

* * *

编辑：对不起..这就是我在午休时间略读问题的结果。您是否有理由不只使用 <button runat="server"> 标签或[HtmlButton](http://msdn.microsoft.com/en-us/library/a8fd2268(VS.80).aspx)？

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-09T14:28:33.937

我会使用 LinkBut​​ton 并根据需要使用 CSS 对其进行样式设置。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-06-10T13:21:09.907

我整天都在为此苦苦挣扎——我的自定义`<button/>`生成控件不起作用：

> System.Web.HttpRequestValidationException：从客户端检测到潜在危险的 Request.Form 值

发生的事情是 .Net 添加了一个`name`属性：

```
<button type="submit" name="ctl02" value="Content" class="btn ">
   <span>Content</span>
</button> 
```

使用 IE 6 和 IE 7 时，该`name`属性会引发服务器错误。在其他浏览器（Opera、IE 8、Firefox、Safari）中一切正常。

解决方法是砍掉该`name`属性。还是我还没想通。

# .net - 如何读取程序集属性

> ID：187495
> 
> 赞同：67
> 
> 时间：2008-10-09T14:23:34.603
> 
> 标签：.net, reflection, assemblies, attributes

在我的程序中，如何读取 AssemblyInfo.cs 中设置的属性：

```
[assembly: AssemblyTitle("My Product")]
[assembly: AssemblyDescription("...")]
[assembly: AssemblyConfiguration("")]
[assembly: AssemblyCompany("Radeldudel inc.")]
[assembly: AssemblyProduct("My Product")]
[assembly: AssemblyCopyright("Copyright @ me 2008")]
[assembly: AssemblyTrademark("")]
[assembly: AssemblyCulture("")] 
```

我想向我的程序的用户显示其中一些值，所以我想知道如何从主程序和我正在使用的组件程序集中加载它们。

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2008-10-09T14:28:51.067

这相当容易。你必须使用反射。您需要一个 Assembly 实例，该实例代表具有您要读取的属性的程序集。一个简单的方法是这样做：

```
typeof(MyTypeInAssembly).Assembly 
```

然后你可以这样做，例如：

```
object[] attributes = assembly.GetCustomAttributes(typeof(AssemblyProductAttribute), false);

AssemblyProductAttribute attribute = null;
if (attributes.Length > 0)
{
   attribute = attributes[0] as AssemblyProductAttribute;
} 
```

现在，引用`attribute.Product`将为您提供您传递给 AssemblyInfo.cs 中属性的值。当然，如果您查找的属性可以多次出现，您可能会在 GetCustomAttributes 返回的数组中获得多个实例，但这对于您希望检索的程序集级属性通常不是问题。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2013-11-19T16:39:46.243

我创建了这个使用 Linq 的扩展方法：

```
public static T GetAssemblyAttribute<T>(this System.Reflection.Assembly ass) where T :  Attribute
{
    object[] attributes = ass.GetCustomAttributes(typeof(T), false);
    if (attributes == null || attributes.Length == 0)
        return null;
    return attributes.OfType<T>().SingleOrDefault();
} 
```

然后你可以方便地使用它：

```
var attr = targetAssembly.GetAssemblyAttribute<AssemblyDescriptionAttribute>();
if(attr != null)
     Console.WriteLine("{0} Assembly Description:{1}", Environment.NewLine, attr.Description); 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-05-17T16:08:15.887

好的，对于原始问题，现在可能有点过时了，但无论如何我都会提出这个以供将来参考。

如果您想从程序集内部执行此操作，请使用以下命令：

```
using System.Runtime.InteropServices;
using System.Reflection;

object[] customAttributes = this.GetType().Assembly.GetCustomAttributes(false); 
```

然后，您可以遍历所有自定义属性以找到您需要的属性，例如

```
foreach (object attribute in customAttributes)
{
  string assemblyGuid = string.Empty;    

  if (attribute.GetType() == typeof(GuidAttribute))
  {
    assemblyGuid = ((GuidAttribute) attribute).Value;
    break;
  }
} 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2015-02-11T06:11:19.367

好的，我试图通过许多资源来找到一种方法来提取 .dll 的属性`Assembly.LoadFrom(path)`。但不幸的是，我找不到任何好的资源。这个问题是搜索最多的结果`c# get assembly attributes`（至少对我来说）所以我想分享我的工作。

经过数小时的努力，我编写了以下简单的控制台程序来检索通用程序集属性。在这里，我提供了代码，因此任何人都可以将其用于进一步的参考工作。

我`CustomAttributes`为此使用财产。随意评论这种方法

代码 ：

```
using System;
using System.Reflection;

namespace MetaGetter
{
    class Program
    {
        static void Main(string[] args)
        {
            Assembly assembly = Assembly.LoadFrom("Path to assembly");

            foreach (CustomAttributeData attributedata in assembly.CustomAttributes)
            {
                Console.WriteLine(" Name : {0}",attributedata.AttributeType.Name);

                foreach (CustomAttributeTypedArgument argumentset in attributedata.ConstructorArguments)
                {
                    Console.WriteLine("   >> Value : {0} \n" ,argumentset.Value);
                }
            }

            Console.ReadKey();
        }
    }
} 
```

样本输出：

```
Name : AssemblyTitleAttribute
   >> Value : "My Product" 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2018-04-27T12:08:04.183

我个人非常喜欢[lance Larsen 和他的静态 AssemblyInfo 类](http://lancelarsen.com/reading-values-from-assemblyinfo-cs/)的实现。

一个基本上将类粘贴到他的程序集中（我通常使用已经存在的 AssemblyInfo.cs 文件，因为它符合命名约定）

要粘贴的代码是：

```
internal static class AssemblyInfo
{
    public static string Company { get { return GetExecutingAssemblyAttribute<AssemblyCompanyAttribute>(a => a.Company); } }
    public static string Product { get { return GetExecutingAssemblyAttribute<AssemblyProductAttribute>(a => a.Product); } }
    public static string Copyright { get { return GetExecutingAssemblyAttribute<AssemblyCopyrightAttribute>(a => a.Copyright); } }
    public static string Trademark { get { return GetExecutingAssemblyAttribute<AssemblyTrademarkAttribute>(a => a.Trademark); } }
    public static string Title { get { return GetExecutingAssemblyAttribute<AssemblyTitleAttribute>(a => a.Title); } }
    public static string Description { get { return GetExecutingAssemblyAttribute<AssemblyDescriptionAttribute>(a => a.Description); } }
    public static string Configuration { get { return GetExecutingAssemblyAttribute<AssemblyConfigurationAttribute>(a => a.Configuration); } }
    public static string FileVersion { get { return GetExecutingAssemblyAttribute<AssemblyFileVersionAttribute>(a => a.Version); } }

    public static Version Version { get { return Assembly.GetExecutingAssembly().GetName().Version; } }
    public static string VersionFull { get { return Version.ToString(); } }
    public static string VersionMajor { get { return Version.Major.ToString(); } }
    public static string VersionMinor { get { return Version.Minor.ToString(); } }
    public static string VersionBuild { get { return Version.Build.ToString(); } }
    public static string VersionRevision { get { return Version.Revision.ToString(); } }

    private static string GetExecutingAssemblyAttribute<T>(Func<T, string> value) where T : Attribute
    {
        T attribute = (T)Attribute.GetCustomAttribute(Assembly.GetExecutingAssembly(), typeof(T));
        return value.Invoke(attribute);
    }
} 
```

您添加一个使用系统；到文件的顶部，你很高兴。

对于我的应用程序，我使用这个类来设置/获取/使用我的本地用户设置：

```
internal class ApplicationData
{

    DirectoryInfo roamingDataFolder;
    DirectoryInfo localDataFolder;
    DirectoryInfo appDataFolder;

    public ApplicationData()
    {
        appDataFolder = new DirectoryInfo(Path.Combine(Environment.GetFolderPath(Environment.SpecialFolder.LocalApplicationData), AssemblyInfo.Product,"Data"));
        roamingDataFolder = new DirectoryInfo(Path.Combine(Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData),AssemblyInfo.Product));
        localDataFolder   = new DirectoryInfo(Path.Combine(Environment.GetFolderPath(Environment.SpecialFolder.LocalApplicationData), AssemblyInfo.Product));

        if (!roamingDataFolder.Exists)            
            roamingDataFolder.Create();

        if (!localDataFolder.Exists)
            localDataFolder.Create();
        if (!appDataFolder.Exists)
            appDataFolder.Create();

    }

    /// <summary>
    /// Gets the roaming application folder location.
    /// </summary>
    /// <value>The roaming data directory.</value>
    public DirectoryInfo RoamingDataFolder => roamingDataFolder;

    /// <summary>
    /// Gets the local application folder location.
    /// </summary>
    /// <value>The local data directory.</value>
    public DirectoryInfo LocalDataFolder => localDataFolder;

    /// <summary>
    /// Gets the local data folder location.
    /// </summary>
    /// <value>The local data directory.</value>
    public DirectoryInfo AppDataFolder => appDataFolder;
} 
```

看看 Larsens 网站 (MVP)，他有很酷的东西可以从中汲取灵感。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-10-27T12:57:23.137

我用这个：

```
public static string Title
{
    get
    {
        return GetCustomAttribute<AssemblyTitleAttribute>(a => a.Title);
    }
} 
```

以供参考：

```
using System;
using System.Reflection;
using System.Runtime.CompilerServices;

namespace Extensions
{

    public static class AssemblyInfo
    {

        private static Assembly m_assembly;

        static AssemblyInfo()
        {
            m_assembly = Assembly.GetEntryAssembly();
        }

        public static void Configure(Assembly ass)
        {
            m_assembly = ass;
        }

        public static T GetCustomAttribute<T>() where T : Attribute
        {
            object[] customAttributes = m_assembly.GetCustomAttributes(typeof(T), false);
            if (customAttributes.Length != 0)
            {
                return (T)((object)customAttributes[0]);
            }
            return default(T);
        }

        public static string GetCustomAttribute<T>(Func<T, string> getProperty) where T : Attribute
        {
            T customAttribute = GetCustomAttribute<T>();
            if (customAttribute != null)
            {
                return getProperty(customAttribute);
            }
            return null;
        }

        public static int GetCustomAttribute<T>(Func<T, int> getProperty) where T : Attribute
        {
            T customAttribute = GetCustomAttribute<T>();
            if (customAttribute != null)
            {
                return getProperty(customAttribute);
            }
            return 0;
        }

        public static Version Version
        {
            get
            {
                return m_assembly.GetName().Version;
            }
        }

        public static string Title
        {
            get
            {
                return GetCustomAttribute<AssemblyTitleAttribute>(
                    delegate(AssemblyTitleAttribute a)
                    {
                        return a.Title;
                    }
                );
            }
        }

        public static string Description
        {
            get
            {
                return GetCustomAttribute<AssemblyDescriptionAttribute>(
                    delegate(AssemblyDescriptionAttribute a)
                    {
                        return a.Description;
                    }
                );
            }
        }

        public static string Product
        {
            get
            {
                return GetCustomAttribute<AssemblyProductAttribute>(
                    delegate(AssemblyProductAttribute a)
                    {
                        return a.Product;
                    }
                );
            }
        }

        public static string Copyright
        {
            get
            {
                return GetCustomAttribute<AssemblyCopyrightAttribute>(
                    delegate(AssemblyCopyrightAttribute a)
                    {
                        return a.Copyright;
                    }
                );
            }
        }

        public static string Company
        {
            get
            {
                return GetCustomAttribute<AssemblyCompanyAttribute>(
                    delegate(AssemblyCompanyAttribute a)
                    {
                        return a.Company;
                    }
                );
            }
        }

        public static string InformationalVersion
        {
            get
            {
                return GetCustomAttribute<AssemblyInformationalVersionAttribute>(
                    delegate(AssemblyInformationalVersionAttribute a)
                    {
                        return a.InformationalVersion;
                    }
                );
            }
        }

        public static int ProductId
        {
            get
            {
                return GetCustomAttribute<AssemblyProductIdAttribute>(
                    delegate(AssemblyProductIdAttribute a)
                    {
                        return a.ProductId;
                    }
                );
            }
        }

        public static string Location
        {
            get
            {
                return m_assembly.Location;
            }
        }

    }

} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2019-01-09T01:07:50.983

如果您知道要查找的属性是唯一的，那么使用`Attribute`该类的这个经常被忽视的静态帮助方法会容易得多：

```
var attribute = Attribute.GetCustomAttribute(assembly, typeof(AssemblyTitleAttribute)) 
```

这更容易，因为您不需要弄乱数组，或者担心那个讨厌的`inherit`参数。您只需直接获取单个属性值，或者`null`如果不存在。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2019-10-01T17:45:45.677

这是在一行代码中检索特定属性的好方法。不需要特殊课程。

```
string company = ((AssemblyCompanyAttribute)Attribute.GetCustomAttribute(Assembly.GetExecutingAssembly(), typeof(AssemblyCompanyAttribute), false)).Company; 
```

# c# - 与 WCF 服务共享枚举

> ID：187505
> 
> 赞同：51
> 
> 时间：2008-10-09T14:25:26.220
> 
> 标签：c#, wcf, enums

我有几个不同的应用程序，我想在其中共享一个 C# 枚举。我不太清楚如何在常规应用程序和 WCF 服务之间共享枚举声明。

这是情况。我有 2 个轻量级 C# destop 应用程序和一个 WCF Web 服务，它们都需要共享枚举值。

客户 1 有

```
 Method1( MyEnum e, string sUserId ); 
```

客户 2 有

```
Method2( MyEnum e, string sUserId ); 
```

网络服务有

```
ServiceMethod1( MyEnum e, string sUserId, string sSomeData); 
```

我最初的想法是创建一个名为 Common.dll 的库来封装枚举，然后在需要枚举的所有项目中引用该库。但是，WCF 使事情变得困难，因为您需要标记枚举以使其成为服务的一个组成部分。像这样：

```
[ServiceContract]
[ServiceKnownType(typeof(MyEnum))]
public interface IMyService
{
    [OperationContract]
    ServiceMethod1( MyEnum e, string sUserId, string sSomeData);
}

[DataContract]
public enum MyEnum{ [EnumMember] red, [EnumMember] green, [EnumMember] blue }; 
```

所以....有没有办法在 WCF 服务和其他应用程序之间共享枚举？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-10-09T15:34:57.517

使用公共库应该没问题。枚举是可序列化的，不需要 DataContract 属性。

请参阅：http: [//msdn.microsoft.com/en-us/library/ms731923.aspx](http://msdn.microsoft.com/en-us/library/ms731923.aspx)

> 枚举类型。枚举，包括标志枚举，是可序列化的。可选地，枚举类型可以使用 DataContractAttribute 属性进行标记，在这种情况下，参与序列化的每个成员都必须使用 EnumMemberAttribute 属性进行标记

编辑：即便如此，将枚举标记为 DataContract 并让客户端库使用它应该没有问题。

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2008-10-09T20:16:45.107

我一定对过时的服务参考或其他东西有一些问题。我回去创建了一个包含枚举的公共库，一切正常。我只是添加了对服务接口文件的使用引用。

```
using Common;  

[ServiceContract]
[ServiceKnownType(typeof(MyEnum))]
public interface IMyService
{
    [OperationContract]
    ServiceMethod1( MyEnum e, string sUserId, string sSomeData);
} 
```

我放弃了以下内容：

```
[DataContract]
public enum MyEnum{ [EnumMember] red, [EnumMember] green, [EnumMember] blue }; 
```

我猜由于枚举是通过 ServiceKnownType 引用的，因此不需要在外部库中使用 [DataContract] 或 [Enumerator] 对其进行标记

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2010-07-30T12:21:00.063

我有一个非常奇怪的问题，并认为它可能对你很有趣。当我在数据合同中使用枚举时，我也遇到了连接停止的问题。我花了很长时间才发现真正的问题是什么：我使用了分配了 int 值的枚举。它们从 1 而不是 0 开始。显然 WCF 要求有一个等于 0 的枚举值用于序列化。如果您没有在枚举中声明任何值，则会从 0 开始为您完成自动 int 值映射，所以一切都很好。但是，当您复制粘贴其他未分配 0 值的枚举定义时，您将无法通过 WCF 将其发送给您的客户端 - 奇怪但真实！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-09T15:37:52.923

您可以将 int 值分配给您的 Enum 成员并仅使用 int 进行传输，并在必要时将它们转换回您的 Enum 类型

# ms-access - 如何在 Access 开发中使用版本控制？

> ID：187506
> 
> 赞同：169
> 
> 时间：2008-10-09T14:25:29.047
> 
> 标签：ms-access, version-control

我参与更新 Access 解决方案。它有大量的 VBA、大量的查询、少量的表格以及一些用于数据输入和报告生成的表格。它是 Access 的理想选择。

我想对表设计、VBA、查询和表单进行更改。如何使用版本控制跟踪我的更改？（我们使用 Subversion，但这适用于任何风格）我可以将整个 mdb 粘贴到 subversion 中，但这将存储一个二进制文件，我无法判断我只是更改了一行 VBA 代码。

我曾考虑将 VBA 代码复制到单独的文件中并保存它们，但我可以看到这些代码很快与数据库中的内容不同步。

* * *

## 回答 #1

> 赞同：184
> 
> 时间：2008-10-17T06:15:50.267

我们用 VBScript 编写了自己的脚本，该脚本使用 Access 中未记录的 Application.SaveAsText() 来导出所有代码、表单、宏和报表模块。在这里，它应该给你一些指示。（请注意：有些消息是德语的，但您可以轻松更改它。）

编辑：总结以下各种评论： ~~我们的项目假定一个 .adp 文件。为了使用 .mdb/.accdb 进行这项工作，您必须将 OpenAccessProject() 更改为 OpenCurrentDatabase()~~. `OpenAccessProject()`（如果看到 .adp 扩展名，则更新为使用，否则使用`OpenCurrentDatabase()`.）

分解.vbs：

```
' Usage:
'  CScript decompose.vbs <input file> <path>

' Converts all modules, classes, forms and macros from an Access Project file (.adp) <input file> to
' text and saves the results in separate files to <path>.  Requires Microsoft Access.
'

Option Explicit

const acForm = 2
const acModule = 5
const acMacro = 4
const acReport = 3

' BEGIN CODE
Dim fso
Set fso = CreateObject("Scripting.FileSystemObject")

dim sADPFilename
If (WScript.Arguments.Count = 0) then
    MsgBox "Bitte den Dateinamen angeben!", vbExclamation, "Error"
    Wscript.Quit()
End if
sADPFilename = fso.GetAbsolutePathName(WScript.Arguments(0))

Dim sExportpath
If (WScript.Arguments.Count = 1) then
    sExportpath = ""
else
    sExportpath = WScript.Arguments(1)
End If

exportModulesTxt sADPFilename, sExportpath

If (Err <> 0) and (Err.Description <> NULL) Then
    MsgBox Err.Description, vbExclamation, "Error"
    Err.Clear
End If

Function exportModulesTxt(sADPFilename, sExportpath)
    Dim myComponent
    Dim sModuleType
    Dim sTempname
    Dim sOutstring

    dim myType, myName, myPath, sStubADPFilename
    myType = fso.GetExtensionName(sADPFilename)
    myName = fso.GetBaseName(sADPFilename)
    myPath = fso.GetParentFolderName(sADPFilename)

    If (sExportpath = "") then
        sExportpath = myPath & "\Source\"
    End If
    sStubADPFilename = sExportpath & myName & "_stub." & myType

    WScript.Echo "copy stub to " & sStubADPFilename & "..."
    On Error Resume Next
        fso.CreateFolder(sExportpath)
    On Error Goto 0
    fso.CopyFile sADPFilename, sStubADPFilename

    WScript.Echo "starting Access..."
    Dim oApplication
    Set oApplication = CreateObject("Access.Application")
    WScript.Echo "opening " & sStubADPFilename & " ..."
    If (Right(sStubADPFilename,4) = ".adp") Then
        oApplication.OpenAccessProject sStubADPFilename
    Else
        oApplication.OpenCurrentDatabase sStubADPFilename
    End If

    oApplication.Visible = false

    dim dctDelete
    Set dctDelete = CreateObject("Scripting.Dictionary")
    WScript.Echo "exporting..."
    Dim myObj
    For Each myObj In oApplication.CurrentProject.AllForms
        WScript.Echo "  " & myObj.fullname
        oApplication.SaveAsText acForm, myObj.fullname, sExportpath & "\" & myObj.fullname & ".form"
        oApplication.DoCmd.Close acForm, myObj.fullname
        dctDelete.Add "FO" & myObj.fullname, acForm
    Next
    For Each myObj In oApplication.CurrentProject.AllModules
        WScript.Echo "  " & myObj.fullname
        oApplication.SaveAsText acModule, myObj.fullname, sExportpath & "\" & myObj.fullname & ".bas"
        dctDelete.Add "MO" & myObj.fullname, acModule
    Next
    For Each myObj In oApplication.CurrentProject.AllMacros
        WScript.Echo "  " & myObj.fullname
        oApplication.SaveAsText acMacro, myObj.fullname, sExportpath & "\" & myObj.fullname & ".mac"
        dctDelete.Add "MA" & myObj.fullname, acMacro
    Next
    For Each myObj In oApplication.CurrentProject.AllReports
        WScript.Echo "  " & myObj.fullname
        oApplication.SaveAsText acReport, myObj.fullname, sExportpath & "\" & myObj.fullname & ".report"
        dctDelete.Add "RE" & myObj.fullname, acReport
    Next

    WScript.Echo "deleting..."
    dim sObjectname
    For Each sObjectname In dctDelete
        WScript.Echo "  " & Mid(sObjectname, 3)
        oApplication.DoCmd.DeleteObject dctDelete(sObjectname), Mid(sObjectname, 3)
    Next

    oApplication.CloseCurrentDatabase
    oApplication.CompactRepair sStubADPFilename, sStubADPFilename & "_"
    oApplication.Quit

    fso.CopyFile sStubADPFilename & "_", sStubADPFilename
    fso.DeleteFile sStubADPFilename & "_"

End Function

Public Function getErr()
    Dim strError
    strError = vbCrLf & "----------------------------------------------------------------------------------------------------------------------------------------" & vbCrLf & _
               "From " & Err.source & ":" & vbCrLf & _
               "    Description: " & Err.Description & vbCrLf & _
               "    Code: " & Err.Number & vbCrLf
    getErr = strError
End Function 
```

如果你需要一个可点击的命令，而不是使用命令行，创建一个名为“decompose.cmd”的文件

```
cscript decompose.vbs youraccessapplication.adp 
```

默认情况下，所有导出的文件都进入 Access 应用程序的“脚本”子文件夹。.adp/mdb 文件也被复制到此位置（带有“存根”后缀）并去除所有导出的模块，使其非常小。

您必须使用源文件签入此存根，因为大多数访问设置和自定义菜单栏无法以任何其他方式导出。如果您确实更改了某些设置或菜单，请确保仅提交对此文件的更改。

注意：如果您的应用程序中定义了任何 Autoexec-Makros，则在调用分解时可能必须按住 Shift 键以防止它执行和干扰导出！

当然，也有逆向脚本，从“源”目录构建应用程序：

撰写.vbs：

```
' Usage:
'  WScript compose.vbs <file> <path>

' Converts all modules, classes, forms and macros in a directory created by "decompose.vbs"
' and composes then into an Access Project file (.adp). This overwrites any existing Modules with the
' same names without warning!!!
' Requires Microsoft Access.

Option Explicit

const acForm = 2
const acModule = 5
const acMacro = 4
const acReport = 3

Const acCmdCompileAndSaveAllModules = &H7E

' BEGIN CODE
Dim fso
Set fso = CreateObject("Scripting.FileSystemObject")

dim sADPFilename
If (WScript.Arguments.Count = 0) then
    MsgBox "Please enter the file name!", vbExclamation, "Error"
    Wscript.Quit()
End if
sADPFilename = fso.GetAbsolutePathName(WScript.Arguments(0))

Dim sPath
If (WScript.Arguments.Count = 1) then
    sPath = ""
else
    sPath = WScript.Arguments(1)
End If

importModulesTxt sADPFilename, sPath

If (Err <> 0) and (Err.Description <> NULL) Then
    MsgBox Err.Description, vbExclamation, "Error"
    Err.Clear
End If

Function importModulesTxt(sADPFilename, sImportpath)
    Dim myComponent
    Dim sModuleType
    Dim sTempname
    Dim sOutstring

    ' Build file and pathnames
    dim myType, myName, myPath, sStubADPFilename
    myType = fso.GetExtensionName(sADPFilename)
    myName = fso.GetBaseName(sADPFilename)
    myPath = fso.GetParentFolderName(sADPFilename)

    ' if no path was given as argument, use a relative directory
    If (sImportpath = "") then
        sImportpath = myPath & "\Source\"
    End If
    sStubADPFilename = sImportpath & myName & "_stub." & myType

    ' check for existing file and ask to overwrite with the stub
    if (fso.FileExists(sADPFilename)) Then
        WScript.StdOut.Write sADPFilename & " exists. Overwrite? (y/n) "
        dim sInput
        sInput = WScript.StdIn.Read(1)
        if (sInput <> "y") Then
            WScript.Quit
        end if

        fso.CopyFile sADPFilename, sADPFilename & ".bak"
    end if

    fso.CopyFile sStubADPFilename, sADPFilename

    ' launch MSAccess
    WScript.Echo "starting Access..."
    Dim oApplication
    Set oApplication = CreateObject("Access.Application")
    WScript.Echo "opening " & sADPFilename & " ..."
    If (Right(sStubADPFilename,4) = ".adp") Then
        oApplication.OpenAccessProject sADPFilename
    Else
        oApplication.OpenCurrentDatabase sADPFilename
    End If
    oApplication.Visible = false

    Dim folder
    Set folder = fso.GetFolder(sImportpath)

    ' load each file from the import path into the stub
    Dim myFile, objectname, objecttype
    for each myFile in folder.Files
        objecttype = fso.GetExtensionName(myFile.Name)
        objectname = fso.GetBaseName(myFile.Name)
        WScript.Echo "  " & objectname & " (" & objecttype & ")"

        if (objecttype = "form") then
            oApplication.LoadFromText acForm, objectname, myFile.Path
        elseif (objecttype = "bas") then
            oApplication.LoadFromText acModule, objectname, myFile.Path
        elseif (objecttype = "mac") then
            oApplication.LoadFromText acMacro, objectname, myFile.Path
        elseif (objecttype = "report") then
            oApplication.LoadFromText acReport, objectname, myFile.Path
        end if

    next

    oApplication.RunCommand acCmdCompileAndSaveAllModules
    oApplication.Quit
End Function

Public Function getErr()
    Dim strError
    strError = vbCrLf & "----------------------------------------------------------------------------------------------------------------------------------------" & vbCrLf & _
               "From " & Err.source & ":" & vbCrLf & _
               "    Description: " & Err.Description & vbCrLf & _
               "    Code: " & Err.Number & vbCrLf
    getErr = strError
End Function 
```

同样，这与一个伴随的“compose.cmd”一起使用，其中包含：

```
cscript compose.vbs youraccessapplication.adp 
```

它会要求您确认覆盖当前应用程序并首先创建备份（如果您这样做了）。然后它收集 Source-Directory 中的所有源文件并将它们重新插入到存根中。

玩得开心！

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-10-09T18:21:41.627

它似乎在 Access 中非常可用：

这个来自 msdn 的[链接](http://blogs.msdn.com/access/archive/2008/05/14/access-source-code-control-and-team-foundation-server.aspx)解释了如何为 Microsoft Access 安装源代码控制加载项。它作为 Access 2007 的 Access Developer Extensions 的一部分免费下载，并作为 Access 2003 的单独免费插件提供。

我很高兴你问了这个问题，我花时间查了一下，因为我也想要这个能力。上面的链接包含有关此内容的更多信息以及指向加载项的链接。

更新：
我安装了 Access 2003 的插件。它只适用于 VSS，但它确实允许我将 Access 对象（表单、查询、表、模块等）放入存储库。当您去编辑 repo 中的任何项目时，系统会要求您将其签出，但您不必这样做。接下来，我将检查它如何在没有加载项的系统上处理打开和更改。我不是 VSS 的粉丝，但我真的很喜欢将访问对象存储在存储库中的想法。

Update2：
没有插件的机器无法对数据库结构进行任何更改（添加表字段、查询参数等）。起初我认为如果有人需要这可能是个问题，因为如果 Access 没有加载加载项，就没有明显的方法可以从源代码管理中删除 Access 数据库。

我发现运行“压缩和修复”数据库会提示您是否要从源代码管理中删除该数据库。我选择了是，并且能够在没有加载项的情况下编辑数据库。[上面链接](http://blogs.msdn.com/access/archive/2008/05/14/access-source-code-control-and-team-foundation-server.aspx)中的文章还提供了设置 Access 2003 和 2007 以使用 Team System 的说明。如果您可以找到 SVN 的 MSSCCI 提供程序，那么您很有可能可以让它发挥作用。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2014-11-08T18:21:51.200

Oliver 发布的 compose/decompose 解决方案很棒，但它有一些问题：

*   这些文件被编码为 UCS-2 (UTF-16)，这可能导致版本控制系统/工具将文件视为二进制文件。
*   这些文件包含很多经常变化的杂物——校验和、打印机信息等等。如果您想要干净的差异或需要在项目上合作，这是一个严重的问题。

我本来打算自己解决这个问题，但发现已经有一个很好的解决方案可用： GitHub 上[的 timabell/msaccess-vcs-integration](https://github.com/timabell/msaccess-vcs-integration)。我已经测试了 msaccess-vcs-integration 并且效果很好。

**2015 年 3 月 3 日更新**：该项目最初由 Github 上的 bkidwell 维护/拥有，但已[转移到 timabell](https://github.com/bkidwell/msaccess-vcs-integration/commit/849870c9c2cc8a2a2eae9325e721b2ae3e25792c) - 上面的项目链接相应更新。bkidwell 的原始项目中有一些分支，例如[ArminBra](https://github.com/ArminBra/msaccess-vcs-integration)和[matonb](https://github.com/matonb/msaccess-vcs-integration)，不应使用 AFAICT。

与 Olivers 的分解解决方案相比，使用 msaccess-vcs-integration 的缺点：

*   它明显变慢了。我确信速度问题可以解决，但我不需要经常将我的项目导出为文本......
*   它不会创建删除导出内容的存根 Access 项目。这也可以修复（通过采用分解脚本中的代码），但同样 - 不是那么重要。

无论如何，我明确的建议是 msaccess-vcs-integration。它解决了我在导出文件上使用 Git 时遇到的所有问题。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-12-04T20:36:26.277

奥利弗回答岩石，但`CurrentProject`参考对我不起作用。根据[Arvin Meyer](http://www.accessmvp.com/Arvin/DocDatabase.txt)的类似解决方案，我最终从他的出口中间撕下胆量并用它替换它。如果您使用的是 mdb 而不是 adp，则具有导出查询的优势。

```
' Writes database componenets to a series of text files
' @author  Arvin Meyer
' @date    June 02, 1999
Function DocDatabase(oApp)
    Dim dbs 
    Dim cnt 
    Dim doc 
    Dim i
    Dim prefix
    Dim dctDelete
    Dim docName

    Const acQuery = 1

    Set dctDelete = CreateObject("Scripting.Dictionary")

    Set dbs = oApp.CurrentDb() ' use CurrentDb() to refresh Collections
    Set cnt = dbs.Containers("Forms")
    prefix = oApp.CurrentProject.Path & "\"
    For Each doc In cnt.Documents
        oApp.SaveAsText acForm, doc.Name, prefix & doc.Name & ".frm"
        dctDelete.Add "frm_" & doc.Name, acForm
    Next

    Set cnt = dbs.Containers("Reports")
    For Each doc In cnt.Documents
        oApp.SaveAsText acReport, doc.Name, prefix & doc.Name & ".rpt"
        dctDelete.Add "rpt_" & doc.Name, acReport
    Next

    Set cnt = dbs.Containers("Scripts")
    For Each doc In cnt.Documents
        oApp.SaveAsText acMacro, doc.Name, prefix & doc.Name & ".vbs"
        dctDelete.Add "vbs_" & doc.Name, acMacro
    Next

    Set cnt = dbs.Containers("Modules")
    For Each doc In cnt.Documents
        oApp.SaveAsText acModule, doc.Name, prefix & doc.Name & ".bas"
        dctDelete.Add "bas_" & doc.Name, acModule
    Next

    For i = 0 To dbs.QueryDefs.Count - 1
        oApp.SaveAsText acQuery, dbs.QueryDefs(i).Name, prefix & dbs.QueryDefs(i).Name & ".txt"
        dctDelete.Add "qry_" & dbs.QueryDefs(i).Name, acQuery
    Next

    WScript.Echo "deleting " & dctDelete.Count & " objects."
    For Each docName In dctDelete
        WScript.Echo "  " & Mid(docName, 5)
        oApp.DoCmd.DeleteObject dctDelete(docName), Mid(docName, 5)
    Next

    Set doc = Nothing
    Set cnt = Nothing
    Set dbs = Nothing
    Set dctDelete = Nothing

End Function 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-10-09T20:10:04.310

我们开发了自己的内部工具，其中：

1.  模块：导出为 txt 文件，然后与“文件比较工具”（免费软件）进行比较
2.  表单：通过 undocument application.saveAsText 命令导出。然后可以看到 2 个不同版本之间的差异（再次“文件比较工具”）。
3.  宏：我们没有可比较的宏，因为我们只有“autoexec”宏，其中一行启动 VBA 主程序
4.  查询：只是存储在表格中的文本字符串：见下文
5.  表：我们编写了自己的表比较器，列出了记录和表结构的差异。

整个系统足够智能，可以让我们生成 Access 应用程序的“运行时”版本，从 txt 文件（模块和使用 undocument application.loadFromText 命令重新创建的表单）和 mdb 文件（表）自动生成。

这听起来可能很奇怪，但它确实有效。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2011-06-10T23:02:30.173

基于这篇文章的想法和一些博客中的类似条目，我编写了一个适用于 mdb 和 adp 文件格式的应用程序。它将所有数据库对象（包括表、引用、关系和数据库属性）导入/导出到纯文本文件。使用这些文件，您可以使用任何源版本控制。下一个版本将允许将纯文本文件导入回数据库。还会有一个命令行工具

您可以从以下网址下载应用程序或源代码：[http ://accesssvn.codeplex.com/](http://accesssvn.codeplex.com/)

问候

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2012-03-16T15:28:02.017

复活一个旧线程，但这是一个很好的线程。我已经为我自己的项目实现了两个脚本（compose.vbs / decompose.vbs），但在使用旧的 .mdb 文件时遇到了问题：

当它到达包含代码的表单时它会停止：

```
NoSaveCTIWhenDisabled =1 
```

Access说它有问题，这就是故事的结局。我进行了一些测试并尝试解决此问题，并在最后找到了解决此问题的线程：

[无法创建数据库](http://social.msdn.microsoft.com/Forums/en-US/accessdev/thread/691887f4-b345-4ea0-9158-6183e812bfa2/)

基本上（以防线程死机），您使用 .mdb 并对新的 .accdb 格式执行“另存为”。然后源安全或组合/分解的东西将起作用。我还必须玩 10 分钟才能获得正确的命令行语法，以便 (de)compose 脚本正常工作，所以这里也是该信息：

编写（假设你的东西位于 C:\SControl 中（创建一个名为 Source 的子文件夹来存储提取的文件）：

```
'(to extract for importing to source control)
cscript compose.vbs database.accdb     

'(to rebuild from extracted files saved from an earlier date)
cscript decompose.vbs database.accdb C:\SControl\Source\ 
```

就是这样！

我遇到上述问题的 Access 版本包括 Access 2000-2003“.mdb”数据库，并通过在运行 compose/decompose 脚本之前将它们保存为 2007-2010“.accdb”格式来解决问题。转换后脚本工作正常！

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2016-02-19T08:57:42.750

# 仅文本文件的解决方案（包括查询、表格和关系）

除了模块、类、表单和宏之外，我还修改了 Oliver 的脚本对，以便它们导出/导入**关系、表和查询。***一切*都保存到纯文本文件中，因此**没有创建数据库文件**来与版本控制中的文本文件一起存储。

## 导出为文本文件 (decompose.vbs)

```
' Usage:
'  cscript decompose.vbs <input file> <path>

' Converts all modules, classes, forms and macros from an Access Project file (.adp) <input file> to
' text and saves the results in separate files to <path>.  Requires Microsoft Access.
Option Explicit

Const acForm = 2
Const acModule = 5
Const acMacro = 4
Const acReport = 3
Const acQuery = 1
Const acExportTable = 0

' BEGIN CODE
Dim fso, relDoc, ACCDBFilename, sExportpath
Set fso = CreateObject("Scripting.FileSystemObject")
Set relDoc = CreateObject("Microsoft.XMLDOM")

If (Wscript.Arguments.Count = 0) Then
    MsgBox "Please provide the .accdb database file", vbExclamation, "Error"
    Wscript.Quit()
End If
ACCDBFilename = fso.GetAbsolutePathName(Wscript.Arguments(0))

If (Wscript.Arguments.Count = 1) Then
 sExportpath = ""
Else
 sExportpath = Wscript.Arguments(1)
End If

exportModulesTxt ACCDBFilename, sExportpath

If (Err <> 0) And (Err.Description <> Null) Then
    MsgBox Err.Description, vbExclamation, "Error"
    Err.Clear
End If

Function exportModulesTxt(ACCDBFilename, sExportpath)
    Dim myComponent, sModuleType, sTempname, sOutstring
    Dim myType, myName, myPath, hasRelations
    myType = fso.GetExtensionName(ACCDBFilename)
    myName = fso.GetBaseName(ACCDBFilename)
    myPath = fso.GetParentFolderName(ACCDBFilename)

    'if no path was given as argument, use a relative directory
    If (sExportpath = "") Then
        sExportpath = myPath & "\Source"
    End If
    'On Error Resume Next
    fso.DeleteFolder (sExportpath)
    fso.CreateFolder (sExportpath)
    On Error GoTo 0

    Wscript.Echo "starting Access..."
    Dim oApplication
    Set oApplication = CreateObject("Access.Application")
    Wscript.Echo "Opening " & ACCDBFilename & " ..."
    If (Right(ACCDBFilename, 4) = ".adp") Then
     oApplication.OpenAccessProject ACCDBFilename
    Else
     oApplication.OpenCurrentDatabase ACCDBFilename
    End If
    oApplication.Visible = False

    Wscript.Echo "exporting..."
    Dim myObj
    For Each myObj In oApplication.CurrentProject.AllForms
        Wscript.Echo "Exporting FORM " & myObj.FullName
        oApplication.SaveAsText acForm, myObj.FullName, sExportpath & "\" & myObj.FullName & ".form.txt"
        oApplication.DoCmd.Close acForm, myObj.FullName
    Next
    For Each myObj In oApplication.CurrentProject.AllModules
        Wscript.Echo "Exporting MODULE " & myObj.FullName
        oApplication.SaveAsText acModule, myObj.FullName, sExportpath & "\" & myObj.FullName & ".module.txt"
    Next
    For Each myObj In oApplication.CurrentProject.AllMacros
        Wscript.Echo "Exporting MACRO " & myObj.FullName
        oApplication.SaveAsText acMacro, myObj.FullName, sExportpath & "\" & myObj.FullName & ".macro.txt"
    Next
    For Each myObj In oApplication.CurrentProject.AllReports
        Wscript.Echo "Exporting REPORT " & myObj.FullName
        oApplication.SaveAsText acReport, myObj.FullName, sExportpath & "\" & myObj.FullName & ".report.txt"
    Next
    For Each myObj In oApplication.CurrentDb.QueryDefs
        Wscript.Echo "Exporting QUERY " & myObj.Name
        oApplication.SaveAsText acQuery, myObj.Name, sExportpath & "\" & myObj.Name & ".query.txt"
    Next
    For Each myObj In oApplication.CurrentDb.TableDefs
     If Not Left(myObj.Name, 4) = "MSys" Then
      Wscript.Echo "Exporting TABLE " & myObj.Name
      oApplication.ExportXml acExportTable, myObj.Name, , sExportpath & "\" & myObj.Name & ".table.txt"
      'put the file path as a second parameter if you want to export the table data as well, instead of ommiting it and passing it into a third parameter for structure only
     End If
    Next

    hasRelations = False
    relDoc.appendChild relDoc.createElement("Relations")
    For Each myObj In oApplication.CurrentDb.Relations  'loop though all the relations
    If Not Left(myObj.Name, 4) = "MSys" Then
     Dim relName, relAttrib, relTable, relFoTable, fld
     hasRelations = True

     relDoc.ChildNodes(0).appendChild relDoc.createElement("Relation")
     Set relName = relDoc.createElement("Name")
     relName.Text = myObj.Name
     relDoc.ChildNodes(0).LastChild.appendChild relName

     Set relAttrib = relDoc.createElement("Attributes")
     relAttrib.Text = myObj.Attributes
     relDoc.ChildNodes(0).LastChild.appendChild relAttrib

     Set relTable = relDoc.createElement("Table")
     relTable.Text = myObj.Table
     relDoc.ChildNodes(0).LastChild.appendChild relTable

     Set relFoTable = relDoc.createElement("ForeignTable")
     relFoTable.Text = myObj.ForeignTable
     relDoc.ChildNodes(0).LastChild.appendChild relFoTable

     Wscript.Echo "Exporting relation " & myObj.Name & " between tables " & myObj.Table & " -> " & myObj.ForeignTable

     For Each fld In myObj.Fields   'in case the relationship works with more fields
      Dim lf, ff
      relDoc.ChildNodes(0).LastChild.appendChild relDoc.createElement("Field")

      Set lf = relDoc.createElement("Name")
      lf.Text = fld.Name
      relDoc.ChildNodes(0).LastChild.LastChild.appendChild lf

      Set ff = relDoc.createElement("ForeignName")
      ff.Text = fld.ForeignName
      relDoc.ChildNodes(0).LastChild.LastChild.appendChild ff

      Wscript.Echo "  Involving fields " & fld.Name & " -> " & fld.ForeignName
     Next
    End If
    Next
    If hasRelations Then
     relDoc.InsertBefore relDoc.createProcessingInstruction("xml", "version='1.0'"), relDoc.ChildNodes(0)
     relDoc.Save sExportpath & "\relations.rel.txt"
     Wscript.Echo "Relations successfuly saved in file relations.rel.txt"
    End If

    oApplication.CloseCurrentDatabase
    oApplication.Quit

End Function 
```

您可以通过调用来执行此脚本`cscript decompose.vbs <path to file to decompose> <folder to store text files>`。如果您省略第二个参数，它将创建数据库所在的“源”文件夹。请注意，如果目标文件夹已经存在，它将被擦除。

### 在导出的表中包含数据

替换第 93 行：`oApplication.ExportXML acExportTable, myObj.Name, , sExportpath & "\" & myObj.Name & ".table.txt"`

带线`oApplication.ExportXML acExportTable, myObj.Name, sExportpath & "\" & myObj.Name & ".table.txt"`

## ~~导入~~创建数据库文件 (compose.vbs)

```
' Usage:
'  cscript compose.vbs <file> <path>

' Reads all modules, classes, forms, macros, queries, tables and their relationships in a directory created by "decompose.vbs"
' and composes then into an Access Database file (.accdb).
' Requires Microsoft Access.
Option Explicit

Const acForm = 2
Const acModule = 5
Const acMacro = 4
Const acReport = 3
Const acQuery = 1
Const acStructureOnly = 0   'change 0 to 1 if you want import StructureAndData instead of StructureOnly
Const acCmdCompileAndSaveAllModules = &H7E

Dim fso, relDoc, ACCDBFilename, sPath
Set fso = CreateObject("Scripting.FileSystemObject")
Set relDoc = CreateObject("Microsoft.XMLDOM")

If (Wscript.Arguments.Count = 0) Then
 MsgBox "Please provide the .accdb database file", vbExclamation, "Error"
 Wscript.Quit()
End If

ACCDBFilename = fso.GetAbsolutePathName(Wscript.Arguments(0))
If (Wscript.Arguments.Count = 1) Then
 sPath = ""
Else
 sPath = Wscript.Arguments(1)
End If

importModulesTxt ACCDBFilename, sPath

If (Err <> 0) And (Err.Description <> Null) Then
    MsgBox Err.Description, vbExclamation, "Error"
    Err.Clear
End If

Function importModulesTxt(ACCDBFilename, sImportpath)
    Dim myComponent, sModuleType, sTempname, sOutstring

    ' Build file and pathnames
    Dim myType, myName, myPath
    myType = fso.GetExtensionName(ACCDBFilename)
    myName = fso.GetBaseName(ACCDBFilename)
    myPath = fso.GetParentFolderName(ACCDBFilename)

    ' if no path was given as argument, use a relative directory
    If (sImportpath = "") Then
        sImportpath = myPath & "\Source\"
    End If

    ' check for existing file and ask to overwrite with the stub
    If fso.FileExists(ACCDBFilename) Then
     Wscript.StdOut.Write ACCDBFilename & " already exists. Overwrite? (y/n) "
     Dim sInput
     sInput = Wscript.StdIn.Read(1)
     If (sInput <> "y") Then
      Wscript.Quit
     Else
      If fso.FileExists(ACCDBFilename & ".bak") Then
       fso.DeleteFile (ACCDBFilename & ".bak")
      End If
      fso.MoveFile ACCDBFilename, ACCDBFilename & ".bak"
     End If
    End If

    Wscript.Echo "starting Access..."
    Dim oApplication
    Set oApplication = CreateObject("Access.Application")
    Wscript.Echo "Opening " & ACCDBFilename
    If (Right(ACCDBFilename, 4) = ".adp") Then
        oApplication.CreateAccessProject ACCDBFilename
    Else
        oApplication.NewCurrentDatabase ACCDBFilename
    End If
    oApplication.Visible = False

    Dim folder
    Set folder = fso.GetFolder(sImportpath)

    'load each file from the import path into the stub
    Dim myFile, objectname, objecttype
    For Each myFile In folder.Files
     objectname = fso.GetBaseName(myFile.Name)  'get rid of .txt extension
     objecttype = fso.GetExtensionName(objectname)
     objectname = fso.GetBaseName(objectname)

     Select Case objecttype
      Case "form"
       Wscript.Echo "Importing FORM from file " & myFile.Name
       oApplication.LoadFromText acForm, objectname, myFile.Path
      Case "module"
       Wscript.Echo "Importing MODULE from file " & myFile.Name
       oApplication.LoadFromText acModule, objectname, myFile.Path
      Case "macro"
       Wscript.Echo "Importing MACRO from file " & myFile.Name
       oApplication.LoadFromText acMacro, objectname, myFile.Path
      Case "report"
       Wscript.Echo "Importing REPORT from file " & myFile.Name
       oApplication.LoadFromText acReport, objectname, myFile.Path
      Case "query"
       Wscript.Echo "Importing QUERY from file " & myFile.Name
       oApplication.LoadFromText acQuery, objectname, myFile.Path
      Case "table"
       Wscript.Echo "Importing TABLE from file " & myFile.Name
       oApplication.ImportXml myFile.Path, acStructureOnly
      Case "rel"
       Wscript.Echo "Found RELATIONSHIPS file " & myFile.Name & " ... opening, it will be processed after everything else has been imported"
       relDoc.Load (myFile.Path)
     End Select
    Next

    If relDoc.readyState Then
     Wscript.Echo "Preparing to build table dependencies..."
     Dim xmlRel, xmlField, accessRel, relTable, relName, relFTable, relAttr, i
     For Each xmlRel In relDoc.SelectNodes("/Relations/Relation")   'loop through every Relation node inside .xml file
      relName = xmlRel.SelectSingleNode("Name").Text
      relTable = xmlRel.SelectSingleNode("Table").Text
      relFTable = xmlRel.SelectSingleNode("ForeignTable").Text
      relAttr = xmlRel.SelectSingleNode("Attributes").Text

      'remove any possible conflicting relations or indexes
      On Error Resume Next
      oApplication.CurrentDb.Relations.Delete (relName)
      oApplication.CurrentDb.TableDefs(relTable).Indexes.Delete (relName)
      oApplication.CurrentDb.TableDefs(relFTable).Indexes.Delete (relName)
      On Error GoTo 0

      Wscript.Echo "Creating relation " & relName & " between tables " & relTable & " -> " & relFTable
      Set accessRel = oApplication.CurrentDb.CreateRelation(relName, relTable, relFTable, relAttr)  'create the relationship object

      For Each xmlField In xmlRel.SelectNodes("Field")  'in case the relationship works with more fields
       accessRel.Fields.Append accessRel.CreateField(xmlField.SelectSingleNode("Name").Text)
       accessRel.Fields(xmlField.SelectSingleNode("Name").Text).ForeignName = xmlField.SelectSingleNode("ForeignName").Text
       Wscript.Echo "  Involving fields " & xmlField.SelectSingleNode("Name").Text & " -> " & xmlField.SelectSingleNode("ForeignName").Text
      Next

      oApplication.CurrentDb.Relations.Append accessRel 'append the newly created relationship to the database
      Wscript.Echo "  Relationship added"
     Next
    End If

    oApplication.RunCommand acCmdCompileAndSaveAllModules
    oApplication.Quit
End Function 
```

您可以通过调用来执行此脚本`cscript compose.vbs <path to file which should be created> <folder with text files>`。如果您省略第二个参数，它将查看应在其中创建数据库的“源”文件夹。

### 从文本文件导入数据

将第 14 行：替换`const acStructureOnly = 0`为`const acStructureOnly = 1`. 仅当您已将数据包含在导出的表中时，这才有效。

## 未涵盖的内容

1.  我仅使用 .accdb 文件对此进行了测试，因此其他任何内容都可能存在一些错误。
2.  设置未导出，我建议创建将在数据库启动时应用设置的宏。
3.  有时会导出一些以“~”开头的未知查询。我不知道他们是否有必要。
4.  MSAccess 对象名称可以包含*对文件名无效的*字符- 尝试写入它们时脚本将失败。您可以[规范化所有文件名](https://stackoverflow.com/a/11778694/548792)，但您无法将它们导入回来。

在编写此脚本时，我的其他资源之一是[这个 answer](https://stackoverflow.com/a/354954/4863744)，它帮助我弄清楚如何导出关系。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-19T03:01:38.670

有一个问题 - VSS 6.0 只能在一定数量的对象下接受使用插件的 MDB，其中包括所有本地表、查询、模块和表单。不知道确切的对象限制。

为了构建我们已有 10 年历史的庞大的 prod floor 应用程序，我们被迫将 SS 中的 3 或 4 个单独的 MDB 合并到一个 MDB 中，这使得自动化构建变得复杂，以至于我们不会浪费时间去做。

我想我会尝试上面的脚本将这个 MDb 注入 SVN 并为每个人简化构建。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2010-08-15T17:06:49.870

对于那些使用 Access 2010 的人来说，SaveAsText 在 Intellisense 中不是可见的方法，但它似乎是一种有效的方法，因为[前面提到](https://stackoverflow.com/questions/187506/how-do-you-use-version-control-with-access-development/2366218#2366218)的 Arvin Meyer 的脚本对我来说效果很好。

有趣的是，[SaveAsAXL](http://msdn.microsoft.com/en-us/library/ff821429.aspx)是 2010 的新功能，具有与 SaveAsText 相同的签名，但它似乎只适用于需要 SharePoint Server 2010 的 Web 数据库。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2010-08-17T07:45:41.840

不久前我们遇到了同样的问题。

我们的第一个尝试是第三方工具，它为 Subversion 提供 SourceSafe API 的代理，可与 MS Access 和 VB 6 一起使用。该工具可在[此处](http://www.pushok.com/soft_svn.php)找到。

由于我们对那个工具不太满意，我们切换到 Visual SourceSafe 和 VSS Acces 插件。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2012-12-18T06:09:33.467

我正在使用 Oasis-Svn [http://dev2dev.de/](http://dev2dev.de/)

我只能说它至少救了我一次。我的 mdb 增长到超过 2 GB 并且打破了它。我可以回到旧版本并导入表单，而只是失去了一天左右的工作。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-09T14:35:09.743

我在 SourceForge 上找到了这个工具：http: [//sourceforge.net/projects/avc/](http://sourceforge.net/projects/avc/)

我没有使用它，但它可能是你的开始。可能还有其他一些与 VSS 或 SVN 集成的第三方工具可以满足您的需求。

就我个人而言，我只是方便地保留一个纯文本文件来保存更改日志。当我提交二进制 MDB 时，我使用更改日志中的条目作为我的提交注释。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-09T15:08:38.973

为了完整...

总是有“Microsoft Office System 的 Visual Studio [YEAR] 工具”（[http://msdn.microsoft.com/en-us/vs2005/aa718673.aspx](http://msdn.microsoft.com/en-us/vs2005/aa718673.aspx)），但这似乎需要 VSS。对我来说，VSS（自动损坏）比我在超级备份网络共享上的 347 个保存点更糟糕。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-11-10T21:28:21.917

我正在使用[Access 2003 加载项：源代码控制](http://www.microsoft.com/downloads/details.aspx?familyid=2ea45ff4-a916-48c5-8f84-44b91fa774bc&displaylang=en)。它工作正常。一个问题是无效字符，如“：”。

我正在办理入住和退房手续。在内部，加载项与上面的代码执行相同的操作，但具有更多工具支持。我可以查看对象是否已签出并刷新对象。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2013-09-05T13:13:12.150

您还可以将您的 MS Access 连接到 Team Foundation Server。还有一个免费的 Express 变体，最多可供 5 位开发人员使用。效果很好！

*   [英文导游](http://geekswithblogs.net/michaelazocar/archive/2008/06/26/ms-access-and-tfs.aspx)
*   [团队基础服务器 2012 速成版](http://www.microsoft.com/visualstudio/deu/products/visual-studio-team-foundation-server-express)

编辑：固定链接

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2014-10-08T09:44:25.980

奥利弗的回答很好。请在下面找到我的扩展版本，它增加了对 Access 查询的支持。

（有关更多信息/用法，请[参阅 Oliver 的回答）](https://stackoverflow.com/a/211210/78522)

分解.vbs：

```
' Usage:
'  CScript decompose.vbs <input file> <path>

' Converts all modules, classes, forms and macros from an Access Project file (.adp) <input file> to
' text and saves the results in separate files to <path>.  Requires Microsoft Access.
'
Option Explicit

const acForm = 2
const acModule = 5
const acMacro = 4
const acReport = 3
const acQuery = 1

' BEGIN CODE
Dim fso
Set fso = CreateObject("Scripting.FileSystemObject")

dim sADPFilename
If (WScript.Arguments.Count = 0) then
    MsgBox "Bitte den Dateinamen angeben!", vbExclamation, "Error"
    Wscript.Quit()
End if
sADPFilename = fso.GetAbsolutePathName(WScript.Arguments(0))

Dim sExportpath
If (WScript.Arguments.Count = 1) then
    sExportpath = ""
else
    sExportpath = WScript.Arguments(1)
End If

exportModulesTxt sADPFilename, sExportpath

If (Err <> 0) and (Err.Description <> NULL) Then
    MsgBox Err.Description, vbExclamation, "Error"
    Err.Clear
End If

Function exportModulesTxt(sADPFilename, sExportpath)
    Dim myComponent
    Dim sModuleType
    Dim sTempname
    Dim sOutstring

    dim myType, myName, myPath, sStubADPFilename
    myType = fso.GetExtensionName(sADPFilename)
    myName = fso.GetBaseName(sADPFilename)
    myPath = fso.GetParentFolderName(sADPFilename)

    If (sExportpath = "") then
        sExportpath = myPath & "\Source\"
    End If
    sStubADPFilename = sExportpath & myName & "_stub." & myType

    WScript.Echo "copy stub to " & sStubADPFilename & "..."
    On Error Resume Next
        fso.CreateFolder(sExportpath)
    On Error Goto 0
    fso.CopyFile sADPFilename, sStubADPFilename

    WScript.Echo "starting Access..."
    Dim oApplication
    Set oApplication = CreateObject("Access.Application")
    WScript.Echo "opening " & sStubADPFilename & " ..."
    If (Right(sStubADPFilename,4) = ".adp") Then
        oApplication.OpenAccessProject sStubADPFilename
    Else
        oApplication.OpenCurrentDatabase sStubADPFilename
    End If

    oApplication.Visible = false

    dim dctDelete
    Set dctDelete = CreateObject("Scripting.Dictionary")
    WScript.Echo "exporting..."
    Dim myObj

    For Each myObj In oApplication.CurrentProject.AllForms
        WScript.Echo "  " & myObj.fullname
        oApplication.SaveAsText acForm, myObj.fullname, sExportpath & "\" & myObj.fullname & ".form"
        oApplication.DoCmd.Close acForm, myObj.fullname
        dctDelete.Add "FO" & myObj.fullname, acForm
    Next
    For Each myObj In oApplication.CurrentProject.AllModules
        WScript.Echo "  " & myObj.fullname
        oApplication.SaveAsText acModule, myObj.fullname, sExportpath & "\" & myObj.fullname & ".bas"
        dctDelete.Add "MO" & myObj.fullname, acModule
    Next
    For Each myObj In oApplication.CurrentProject.AllMacros
        WScript.Echo "  " & myObj.fullname
        oApplication.SaveAsText acMacro, myObj.fullname, sExportpath & "\" & myObj.fullname & ".mac"
        dctDelete.Add "MA" & myObj.fullname, acMacro
    Next
    For Each myObj In oApplication.CurrentProject.AllReports
        WScript.Echo "  " & myObj.fullname
        oApplication.SaveAsText acReport, myObj.fullname, sExportpath & "\" & myObj.fullname & ".report"
        dctDelete.Add "RE" & myObj.fullname, acReport
    Next
    For Each myObj In oApplication.CurrentDb.QueryDefs
        if not left(myObj.name,3) = "~sq" then 'exclude queries defined by the forms. Already included in the form itself
            WScript.Echo "  " & myObj.name
            oApplication.SaveAsText acQuery, myObj.name, sExportpath & "\" & myObj.name & ".query"
            oApplication.DoCmd.Close acQuery, myObj.name
            dctDelete.Add "FO" & myObj.name, acQuery
        end if
    Next

    WScript.Echo "deleting..."
    dim sObjectname
    For Each sObjectname In dctDelete
        WScript.Echo "  " & Mid(sObjectname, 3)
        oApplication.DoCmd.DeleteObject dctDelete(sObjectname), Mid(sObjectname, 3)
    Next

    oApplication.CloseCurrentDatabase
    oApplication.CompactRepair sStubADPFilename, sStubADPFilename & "_"
    oApplication.Quit

    fso.CopyFile sStubADPFilename & "_", sStubADPFilename
    fso.DeleteFile sStubADPFilename & "_"

End Function

Public Function getErr()
    Dim strError
    strError = vbCrLf & "----------------------------------------------------------------------------------------------------------------------------------------" & vbCrLf & _
               "From " & Err.source & ":" & vbCrLf & _
               "    Description: " & Err.Description & vbCrLf & _
               "    Code: " & Err.Number & vbCrLf
    getErr = strError
End Function 
```

撰写.vbs：

```
' Usage:
'  WScript compose.vbs <file> <path>

' Converts all modules, classes, forms and macros in a directory created by "decompose.vbs"
' and composes then into an Access Project file (.adp). This overwrites any existing Modules with the
' same names without warning!!!
' Requires Microsoft Access.

Option Explicit

const acForm = 2
const acModule = 5
const acMacro = 4
const acReport = 3
const acQuery = 1

Const acCmdCompileAndSaveAllModules = &H7E

' BEGIN CODE
Dim fso
Set fso = CreateObject("Scripting.FileSystemObject")

dim sADPFilename
If (WScript.Arguments.Count = 0) then
    MsgBox "Bitte den Dateinamen angeben!", vbExclamation, "Error"
    Wscript.Quit()
End if
sADPFilename = fso.GetAbsolutePathName(WScript.Arguments(0))

Dim sPath
If (WScript.Arguments.Count = 1) then
    sPath = ""
else
    sPath = WScript.Arguments(1)
End If

importModulesTxt sADPFilename, sPath

If (Err <> 0) and (Err.Description <> NULL) Then
    MsgBox Err.Description, vbExclamation, "Error"
    Err.Clear
End If

Function importModulesTxt(sADPFilename, sImportpath)
    Dim myComponent
    Dim sModuleType
    Dim sTempname
    Dim sOutstring

    ' Build file and pathnames
    dim myType, myName, myPath, sStubADPFilename
    myType = fso.GetExtensionName(sADPFilename)
    myName = fso.GetBaseName(sADPFilename)
    myPath = fso.GetParentFolderName(sADPFilename)

    ' if no path was given as argument, use a relative directory
    If (sImportpath = "") then
        sImportpath = myPath & "\Source\"
    End If
    sStubADPFilename = sImportpath & myName & "_stub." & myType

    ' check for existing file and ask to overwrite with the stub
    if (fso.FileExists(sADPFilename)) Then
        WScript.StdOut.Write sADPFilename & " existiert bereits. Überschreiben? (j/n) "
        dim sInput
        sInput = WScript.StdIn.Read(1)
        if (sInput <> "j") Then
            WScript.Quit
        end if

        fso.CopyFile sADPFilename, sADPFilename & ".bak"
    end if

    fso.CopyFile sStubADPFilename, sADPFilename

    ' launch MSAccess
    WScript.Echo "starting Access..."
    Dim oApplication
    Set oApplication = CreateObject("Access.Application")
    WScript.Echo "opening " & sADPFilename & " ..."
    If (Right(sStubADPFilename,4) = ".adp") Then
        oApplication.OpenAccessProject sADPFilename
    Else
        oApplication.OpenCurrentDatabase sADPFilename
    End If
    oApplication.Visible = false

    Dim folder
    Set folder = fso.GetFolder(sImportpath)

    ' load each file from the import path into the stub
    Dim myFile, objectname, objecttype
    for each myFile in folder.Files
        objecttype = fso.GetExtensionName(myFile.Name)
        objectname = fso.GetBaseName(myFile.Name)
        WScript.Echo "  " & objectname & " (" & objecttype & ")"

        if (objecttype = "form") then
            oApplication.LoadFromText acForm, objectname, myFile.Path
        elseif (objecttype = "bas") then
            oApplication.LoadFromText acModule, objectname, myFile.Path
        elseif (objecttype = "mac") then
            oApplication.LoadFromText acMacro, objectname, myFile.Path
        elseif (objecttype = "report") then
            oApplication.LoadFromText acReport, objectname, myFile.Path
        elseif (objecttype = "query") then
           oApplication.LoadFromText acQuery, objectname, myFile.Path
        end if

    next

    oApplication.RunCommand acCmdCompileAndSaveAllModules
    oApplication.Quit
End Function

Public Function getErr()
    Dim strError
    strError = vbCrLf & "----------------------------------------------------------------------------------------------------------------------------------------" & vbCrLf & _
               "From " & Err.source & ":" & vbCrLf & _
               "    Description: " & Err.Description & vbCrLf & _
               "    Code: " & Err.Number & vbCrLf
    getErr = strError
End Function 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2014-01-15T21:52:57.433

我试图通过在访问数据库中添加查询的导出选项来帮助他回答。（在[其他](https://stackoverflow.com/questions/1275502/using-vba-to-export-all-ms-access-sql-queries-to-text-files)SO[答案](https://stackoverflow.com/questions/20252599/how-do-you-export-ms-access-query-objects-to-text-file)的充分帮助下）

```
Dim def
Set stream = fso.CreateTextFile(sExportpath & "\" & myName & ".queries.txt")
  For Each def In oApplication.CurrentDb.QueryDefs

    WScript.Echo "  Exporting Queries to Text..."
    stream.WriteLine("Name: " & def.Name)
    stream.WriteLine(def.SQL)
    stream.writeline "--------------------------"
    stream.writeline " "

  Next
stream.Close 
```

无法将其重新用于“撰写”功能，但这不是我现在需要它做的。

注意：我还在*decompose.vbs*中为每个导出的文件名添加了“.txt”，以便源代码管理立即向我显示文件差异。

希望有帮助！

* * *

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2016-02-10T06:13:57.297

此条目描述了与其他条目完全不同的方法，可能不是您要查找的方法。因此，如果您忽略这一点，我不会生气。但至少它是值得深思的。

在一些专业的商业软件开发环境中，软件可交付成果的配置管理 (CM) 通常*不在*软件应用程序本身或软件项目本身内完成。通过将软件保存在一个特殊的 CM 文件夹中，对最终交付的产品施加 CM，该文件及其文件夹都标有版本标识。例如，Clearcase 允许数据管理员“签入”软件文件，为其分配“分支”，为其分配“气泡”，并应用“标签”。当你想查看和下载一个文件时，你必须配置你的“配置规范”以指向你想要的版本，然后 cd 进入文件夹就可以了。

只是一个想法。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2017-09-27T17:00:59.493

对于任何坚持使用 Access 97 的人，我都无法获得其他答案。结合使用[Oliver](https://stackoverflow.com/a/211210/1410257)和[DaveParillo 的](https://stackoverflow.com/a/1849498/1410257)出色答案并进行一些修改，我能够使脚本与我们的 Access 97 数据库一起使用。它也更加用户友好，因为它询问放置文件的文件夹。

AccessExport.vbs：

```
' Converts all modules, classes, forms and macros from an Access file (.mdb) <input file> to
' text and saves the results in separate files to <path>.  Requires Microsoft Access.
Option Explicit

Const acQuery = 1
Const acForm = 2
Const acModule = 5
Const acMacro = 4
Const acReport = 3
Const acCmdCompactDatabase = 4
Const TemporaryFolder = 2

Dim strMDBFileName : strMDBFileName = SelectDatabaseFile
Dim strExportPath : strExportPath = SelectExportFolder
CreateExportFolders(strExportPath)
Dim objProgressWindow
Dim strOverallProgress
CreateProgressWindow objProgressWindow
Dim strTempMDBFileName
CopyToTempDatabase strMDBFileName, strTempMDBFileName, strOverallProgress
Dim objAccess
Dim objDatabase
OpenAccessDatabase objAccess, objDatabase, strTempMDBFileName, strOverallProgress
ExportQueries objAccess, objDatabase, objProgressWindow, strExportPath, strOverallProgress
ExportForms objAccess, objDatabase, objProgressWindow, strExportPath, strOverallProgress
ExportReports objAccess, objDatabase, objProgressWindow, strExportPath, strOverallProgress
ExportMacros objAccess, objDatabase, objProgressWindow, strExportPath, strOverallProgress
ExportModules objAccess, objDatabase, objProgressWindow, strExportPath, strOverallProgress
objAccess.CloseCurrentDatabase
objAccess.Quit
DeleteTempDatabase strTempMDBFileName, strOverallProgress
objProgressWindow.Quit
MsgBox "Successfully exported database."

Private Function SelectDatabaseFile()
    MsgBox "Please select the Access database to export."
    Dim objFileOpen : Set objFileOpen = CreateObject("SAFRCFileDlg.FileOpen")
    If objFileOpen.OpenFileOpenDlg Then
        SelectDatabaseFile = objFileOpen.FileName
    Else
        WScript.Quit()
    End If
End Function

Private Function SelectExportFolder()
    Dim objShell : Set objShell = CreateObject("Shell.Application")
    SelectExportFolder = objShell.BrowseForFolder(0, "Select folder to export the database to:", 0, "").self.path & "\"
End Function

Private Sub CreateExportFolders(strExportPath)
    Dim objFileSystem : Set objFileSystem = CreateObject("Scripting.FileSystemObject")
    MsgBox "Existing folders from a previous Access export under " & strExportPath & " will be deleted!"
    If objFileSystem.FolderExists(strExportPath & "Queries\") Then
        objFileSystem.DeleteFolder strExportPath & "Queries", true
    End If
    objFileSystem.CreateFolder(strExportPath & "Queries\")
    If objFileSystem.FolderExists(strExportPath & "Forms\") Then
        objFileSystem.DeleteFolder strExportPath & "Forms", true
    End If
    objFileSystem.CreateFolder(strExportPath & "Forms\")
    If objFileSystem.FolderExists(strExportPath & "Reports\") Then
        objFileSystem.DeleteFolder strExportPath & "Reports", true
    End If
    objFileSystem.CreateFolder(strExportPath & "Reports\")
    If objFileSystem.FolderExists(strExportPath & "Macros\") Then
        objFileSystem.DeleteFolder strExportPath & "Macros", true
    End If
    objFileSystem.CreateFolder(strExportPath & "Macros\")
    If objFileSystem.FolderExists(strExportPath & "Modules\") Then
        objFileSystem.DeleteFolder strExportPath & "Modules", true
    End If
    objFileSystem.CreateFolder(strExportPath & "Modules\")
End Sub

Private Sub CreateProgressWindow(objProgressWindow)
    Set objProgressWindow = CreateObject ("InternetExplorer.Application")
    objProgressWindow.Navigate "about:blank"
    objProgressWindow.ToolBar = 0
    objProgressWindow.StatusBar = 0
    objProgressWindow.Width = 320
    objProgressWindow.Height = 240
    objProgressWindow.Visible = 1
    objProgressWindow.Document.Title = "Access export in progress"
End Sub

Private Sub CopyToTempDatabase(strMDBFileName, strTempMDBFileName, strOverallProgress)
    strOverallProgress = strOverallProgress & "Copying to temporary database...<br/>"
    Dim objFileSystem : Set objFileSystem = CreateObject("Scripting.FileSystemObject")
    strTempMDBFileName = objFileSystem.GetSpecialFolder(TemporaryFolder) & "\" & objFileSystem.GetBaseName(strMDBFileName) & "_temp.mdb"
    objFileSystem.CopyFile strMDBFileName, strTempMDBFileName
End Sub

Private Sub OpenAccessDatabase(objAccess, objDatabase, strTempMDBFileName, strOverallProgress)
    strOverallProgress = strOverallProgress & "Compacting temporary database...<br/>"
    Set objAccess = CreateObject("Access.Application")
    objAccess.Visible = false
    CompactAccessDatabase objAccess, strTempMDBFileName
    strOverallProgress = strOverallProgress & "Opening temporary database...<br/>"
    objAccess.OpenCurrentDatabase strTempMDBFileName
    Set objDatabase = objAccess.CurrentDb
End Sub

' Sometimes the Compact Database command errors out, and it's not serious if the database isn't compacted first.
Private Sub CompactAccessDatabase(objAccess, strTempMDBFileName)
    On Error Resume Next
    Dim objFileSystem : Set objFileSystem = CreateObject("Scripting.FileSystemObject")
    objAccess.DbEngine.CompactDatabase strTempMDBFileName, strTempMDBFileName & "_"
    objFileSystem.CopyFile strTempMDBFileName & "_", strTempMDBFileName
    objFileSystem.DeleteFile strTempMDBFileName & "_"
End Sub

Private Sub ExportQueries(objAccess, objDatabase, objProgressWindow, strExportPath, strOverallProgress)
    strOverallProgress = strOverallProgress & "Exporting Queries (Step 1 of 5)...<br/>"
    Dim counter
    For counter = 0 To objDatabase.QueryDefs.Count - 1
        objProgressWindow.Document.Body.InnerHTML = strOverallProgress & counter + 1 & " of " & objDatabase.QueryDefs.Count
        objAccess.SaveAsText acQuery, objDatabase.QueryDefs(counter).Name, strExportPath & "Queries\" & Clean(objDatabase.QueryDefs(counter).Name) & ".sql"
    Next
End Sub

Private Sub ExportForms(objAccess, objDatabase, objProgressWindow, strExportPath, strOverallProgress)
    strOverallProgress = strOverallProgress & "Exporting Forms (Step 2 of 5)...<br/>"
    Dim counter : counter = 1
    Dim objContainer : Set objContainer = objDatabase.Containers("Forms")
    Dim objDocument
    For Each objDocument In objContainer.Documents
        objProgressWindow.Document.Body.InnerHTML = strOverallProgress & counter & " of " & objContainer.Documents.Count
        counter = counter + 1
        objAccess.SaveAsText acForm, objDocument.Name, strExportPath & "Forms\" & Clean(objDocument.Name) & ".form"
        objAccess.DoCmd.Close acForm, objDocument.Name
    Next
End Sub

Private Sub ExportReports(objAccess, objDatabase, objProgressWindow, strExportPath, strOverallProgress)
    strOverallProgress = strOverallProgress & "Exporting Reports (Step 3 of 5)...<br/>"
    Dim counter : counter = 1
    Dim objContainer : Set objContainer = objDatabase.Containers("Reports")
    Dim objDocument
    For Each objDocument In objContainer.Documents
        objProgressWindow.Document.Body.InnerHTML = strOverallProgress & counter & " of " & objContainer.Documents.Count
        counter = counter + 1
        objAccess.SaveAsText acReport, objDocument.Name, strExportPath & "Reports\" & Clean(objDocument.Name) & ".report"
    Next
End Sub

Private Sub ExportMacros(objAccess, objDatabase, objProgressWindow, strExportPath, strOverallProgress)
    strOverallProgress = strOverallProgress & "Exporting Macros (Step 4 of 5)...<br/>"
    Dim counter : counter = 1
    Dim objContainer : Set objContainer = objDatabase.Containers("Scripts")
    Dim objDocument
    For Each objDocument In objContainer.Documents
        objProgressWindow.Document.Body.InnerHTML = strOverallProgress & counter & " of " & objContainer.Documents.Count
        counter = counter + 1
        objAccess.SaveAsText acMacro, objDocument.Name, strExportPath & "Macros\" & Clean(objDocument.Name) & ".macro"
    Next
End Sub

Private Sub ExportModules(objAccess, objDatabase, objProgressWindow, strExportPath, strOverallProgress)
    strOverallProgress = strOverallProgress & "Exporting Modules (Step 5 of 5)...<br/>"
    Dim counter : counter = 1
    Dim objContainer : Set objContainer = objDatabase.Containers("Modules")
    Dim objDocument
    For Each objDocument In objContainer.Documents
        objProgressWindow.Document.Body.InnerHTML = strOverallProgress & counter & " of " & objContainer.Documents.Count
        counter = counter + 1
        objAccess.SaveAsText acModule, objDocument.Name, strExportPath & "Modules\" & Clean(objDocument.Name) & ".module"
    Next
End Sub

Private Sub DeleteTempDatabase(strTempMDBFileName, strOverallProgress)
    On Error Resume Next
    strOverallProgress = strOverallProgress & "Deleting temporary database...<br/>"
    Dim objFileSystem : Set objFileSystem = CreateObject("Scripting.FileSystemObject")
    objFileSystem.DeleteFile strTempMDBFileName, true
End Sub

' Windows doesn't like certain characters, so we have to filter those out of the name when exporting
Private Function Clean(strInput)
    Dim objRegexp : Set objRegexp = New RegExp
    objRegexp.IgnoreCase = True
    objRegexp.Global = True
    objRegexp.Pattern = "[\\/:*?""<>|]"
    Dim strOutput
    If objRegexp.Test(strInput) Then
        strOutput = objRegexp.Replace(strInput, "")
        MsgBox strInput & " is being exported as " & strOutput
    Else
        strOutput = strInput
    End If
    Clean = strOutput
End Function 
```

对于将文件导入数据库，您是否需要从头开始重新创建数据库，或者出于某种原因希望在 Access 之外修改文件。

AccessImport.vbs：

```
' Imports all of the queries, forms, reports, macros, and modules from text
' files to an Access file (.mdb).  Requires Microsoft Access.
Option Explicit

const acQuery = 1
const acForm = 2
const acModule = 5
const acMacro = 4
const acReport = 3
const acCmdCompileAndSaveAllModules = &H7E

Dim strMDBFilename : strMDBFilename = SelectDatabaseFile
CreateBackup strMDBFilename
Dim strImportPath : strImportPath = SelectImportFolder
Dim objAccess
Dim objDatabase
OpenAccessDatabase objAccess, objDatabase, strMDBFilename
Dim objProgressWindow
Dim strOverallProgress
CreateProgressWindow objProgressWindow
ImportQueries objAccess, objDatabase, objProgressWindow, strImportPath, strOverallProgress
ImportForms objAccess, objDatabase, objProgressWindow, strImportPath, strOverallProgress
ImportReports objAccess, objDatabase, objProgressWindow, strImportPath, strOverallProgress
ImportMacros objAccess, objDatabase, objProgressWindow, strImportPath, strOverallProgress
ImportModules objAccess, objDatabase, objProgressWindow, strImportPath, strOverallProgress
objAccess.CloseCurrentDatabase
objAccess.Quit
objProgressWindow.Quit
MsgBox "Successfully imported objects into the database."

Private Function SelectDatabaseFile()
    MsgBox "Please select the Access database to import the objects from.  ALL EXISTING OBJECTS WITH THE SAME NAME WILL BE OVERWRITTEN!"
    Dim objFileOpen : Set objFileOpen = CreateObject( "SAFRCFileDlg.FileOpen" )
    If objFileOpen.OpenFileOpenDlg Then
        SelectDatabaseFile = objFileOpen.FileName
    Else
        WScript.Quit()
    End If
End Function

Private Function SelectImportFolder()
    Dim objShell : Set objShell = WScript.CreateObject("Shell.Application")
    SelectImportFolder = objShell.BrowseForFolder(0, "Select folder to import the database objects from:", 0, "").self.path & "\"
End Function

Private Sub CreateBackup(strMDBFilename)
    Dim objFileSystem : Set objFileSystem = CreateObject("Scripting.FileSystemObject")
    objFileSystem.CopyFile strMDBFilename, strMDBFilename & ".bak"
End Sub

Private Sub OpenAccessDatabase(objAccess, objDatabase, strMDBFileName)
    Set objAccess = CreateObject("Access.Application")
    objAccess.OpenCurrentDatabase strMDBFilename
    objAccess.Visible = false
    Set objDatabase = objAccess.CurrentDb
End Sub

Private Sub CreateProgressWindow(ByRef objProgressWindow)
    Set objProgressWindow = CreateObject ("InternetExplorer.Application")
    objProgressWindow.Navigate "about:blank"
    objProgressWindow.ToolBar = 0
    objProgressWindow.StatusBar = 0
    objProgressWindow.Width = 320
    objProgressWindow.Height = 240
    objProgressWindow.Visible = 1
    objProgressWindow.Document.Title = "Access import in progress"
End Sub

Private Sub ImportQueries(objAccess, objDatabase, objProgressWindow, strImportPath, strOverallProgress)
    strOverallProgress = "Importing Queries (Step 1 of 5)...<br/>"
    Dim counter : counter = 0
    Dim folder : Set folder = objFileSystem.GetFolder(strImportPath & "Queries\")
    Dim objFileSystem : Set objFileSystem = CreateObject("Scripting.FileSystemObject")
    Dim file
    Dim strQueryName
    For Each file in folder.Files
        objProgressWindow.Document.Body.InnerHTML = strOverallProgress & counter + 1 & " of " & folder.Files.Count
        strQueryName = objFileSystem.GetBaseName(file.Name)
        objAccess.LoadFromText acQuery, strQueryName, file.Path
        counter = counter + 1
    Next
End Sub

Private Sub ImportForms(objAccess, objDatabase, objProgressWindow, strImportPath, strOverallProgress)
    strOverallProgress = strOverallProgress & "Importing Forms (Step 2 of 5)...<br/>"
    Dim counter : counter = 0
    Dim folder : Set folder = objFileSystem.GetFolder(strImportPath & "Forms\")
    Dim objFileSystem : Set objFileSystem = CreateObject("Scripting.FileSystemObject")
    Dim file
    Dim strFormName
    For Each file in folder.Files
        objProgressWindow.Document.Body.InnerHTML = strOverallProgress & counter + 1 & " of " & folder.Files.Count
        strFormName = objFileSystem.GetBaseName(file.Name)
        objAccess.LoadFromText acForm, strFormName, file.Path
        counter = counter + 1
    Next
End Sub

Private Sub ImportReports(objAccess, objDatabase, objProgressWindow, strImportPath, strOverallProgress)
    strOverallProgress = strOverallProgress & "Importing Reports (Step 3 of 5)...<br/>"
    Dim counter : counter = 0
    Dim folder : Set folder = objFileSystem.GetFolder(strImportPath & "Reports\")
    Dim objFileSystem : Set objFileSystem = CreateObject("Scripting.FileSystemObject")
    Dim file
    Dim strReportName
    For Each file in folder.Files
        objProgressWindow.Document.Body.InnerHTML = strOverallProgress & counter + 1 & " of " & folder.Files.Count
        strReportName = objFileSystem.GetBaseName(file.Name)
        objAccess.LoadFromText acReport, strReportName, file.Path
        counter = counter + 1
    Next
End Sub

Private Sub ImportMacros(objAccess, objDatabase, objProgressWindow, strImportPath, strOverallProgress)
    strOverallProgress = strOverallProgress & "Importing Macros (Step 4 of 5)...<br/>"
    Dim counter : counter = 0
    Dim folder : Set folder = objFileSystem.GetFolder(strImportPath & "Macros\")
    Dim objFileSystem : Set objFileSystem = CreateObject("Scripting.FileSystemObject")
    Dim file
    Dim strMacroName
    For Each file in folder.Files
        objProgressWindow.Document.Body.InnerHTML = strOverallProgress & counter + 1 & " of " & folder.Files.Count
        strMacroName = objFileSystem.GetBaseName(file.Name)
        objAccess.LoadFromText acMacro, strMacroName, file.Path
        counter = counter + 1
    Next
End Sub

Private Sub ImportModules(objAccess, objDatabase, objProgressWindow, strImportPath, strOverallProgress)
    strOverallProgress = strOverallProgress & "Importing Modules (Step 5 of 5)...<br/>"
    Dim counter : counter = 0
    Dim folder : Set folder = objFileSystem.GetFolder(strImportPath & "Modules\")
    Dim objFileSystem : Set objFileSystem = CreateObject("Scripting.FileSystemObject")
    Dim file
    Dim strModuleName
    For Each file in folder.Files
        objProgressWindow.Document.Body.InnerHTML = strOverallProgress & counter + 1 & " of " & folder.Files.Count
        strModuleName = objFileSystem.GetBaseName(file.Name)
        objAccess.LoadFromText acModule, strModuleName, file.Path
        counter = counter + 1
    Next

    ' We need to compile the database whenever any module code changes.
    If Not objAccess.IsCompiled Then
        objAccess.RunCommand acCmdCompileAndSaveAllModules
    End If
End Sub 
```

# visual-studio - 混合 Visual Studio 版本好吗？

> ID：187511
> 
> 赞同：1
> 
> 时间：2008-10-09T14:25:57.203
> 
> 标签：visual-studio

Visual Studio **2005 Team Edition for Developer 可以在我的机器上与 Visual Studio** **2008** Database 版和平共处吗？它们是完全独立的应用程序，不会以任何方式相互干扰吗？

**更新：** Visual Studio 2008 开发者版怎么样？如果我将它安装在与 2008 数据库版本相同的机器上，它会创建两个不同的“VS 2008”安装，还是将它们合并为具有组合功能的单个 Visual Studio 2008？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-09T14:27:42.147

2008 与 2005 并排兼容。此外，请务必应用 2008 SP1，因为它会稍微更改图标，以便您分辨出差异。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-09T14:28:17.090

您可以同时安装和使用两者。但是，有一些警告：

*   使用 vs2008 打开 vs2005 解决方案将更新为解决方案，使其无法再在 vs2005 中使用。
*   您的机器上只能有一个*默认*调试器，因此它们可能会相互争斗。

让每个人都升级到 vs2008 并在需要时使用它来定位 .Net2.0 通常更容易，但它们当然不是不可能共存的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T14:28:59.897

一般来说，是的，它们是完全独立的应用程序。我没有尝试过你提到的具体组合，但我有任意数量的 VS 2003、VS 2005、VS 2008 和 VS 2005 Express Edition 的组合都可以正常运行。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-09T14:39:21.607

如果 VS2005 和 VS2008 在您的开发团队中混合在一起，我相信您可以拥有一个 VS2005 解决方案和一个 VS2008 解决方案，并且它们都可以加载相同的 VS2005 项目。我不确定你是否在那里丢失了任何东西（除了 VS2008 特定的东西，比如 3.5），但我相信它会起作用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-09T14:27:18.043

是的。

我同时使用 Visual Studio 6、Visual Studio 2005 和 Visual Studio 2008，没有任何问题。[所有这些都与 VSS 集成]

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-09T14:27:31.240

是的，它们是完全独立的应用程序，不会相互干扰。我已经跑了一年多了。

# php - 在 PHP 中，如何找到与特定键关联的值

> ID：187515
> 
> 赞同：0
> 
> 时间：2008-10-09T14:27:02.037
> 
> 标签：php, arrays, associative-array

我有两个数组。一个包含`id=>count`，另一个包含`id=>name`。我正在尝试生成一个数组，即`name=>count`. 关于直接执行此操作的任何建议？

我查看[了 PHP 手册中的 Array Functions](http://us2.php.net/manual/en/ref.array.php)并没有看到任何突出的做我想要的东西，所以我猜我需要一个函数组合，但我在想出一些东西时遇到了麻烦这并不复杂。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-09T14:29:49.643

就像是：

```
foreach($countA as $id => $count)
{
    $newArray[$nameA[$id]] = $count;
} 
```

这确实假设键在两个数组之间是对应的，因为否则您的要求是模棱两可的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T14:29:50.223

使用[array_combine](http://ca.php.net/manual/en/function.array-combine.php) ...

```
$countArray = array(0 => 1, 1 => 5);
$namesArray = array(0 => "Bob", 1 => "Alice");

$assocArray = array_combine($namesArray, $countArray); 
```

**编辑：**这是评论#2中表达的新要求的修订解决方案

```
$assocArray = array();
foreach($namesArray as $id => $name) {
    $assocArray[$name] = (array_key_exists($id, $countArray)) ? $countArray[$id] : 0;
} 
```

# ubuntu - Gnome“运行应用程序”对话框中的访问别名

> ID：187526
> 
> 赞同：12
> 
> 时间：2008-10-09T14:28:19.163
> 
> 标签：ubuntu, gnome

我希望能够在 Ubuntu/Gnome 中按 Alt+F2 时出现的“运行应用程序”对话框中从我的 .bashrc 运行我的别名。

有谁知道如何做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-13T20:00:30.790

[http://www.freedesktop.org/wiki/Specifications](http://www.freedesktop.org/wiki/Specifications)可能是一个不错的起点。我发现这些大部分时间都很难理解，但有时你可以弄清楚。具体来说，就是“桌面入口规范”。

另外，我认为您将无法使用来自 的任何别名`.bashrc`，至少在不编写某种包装脚本的情况下不能。我认为它需要是一个可执行文件。当然，您可以只使用良好的旧符号链接 - 相同 + 什么是我的名字技巧......

（作为参考，如下所示：

1.  制作一个使用自己的名称作为参数的脚本。
2.  使用参数值作为链接名称对所述脚本进行符号链接。）

* * *

# 正在调查...

一些随意的调查表明，如果您使用 Nautilus，创建这些相当简单，（至少是我拥有的版本）：

1.  调出一些随机文件的上下文菜单，然后使用“打开方式”->“使用其他应用程序打开”。
2.  展开“使用自定义命令”并输入如下内容：
    1.  `xterm -e 'bash -c "unzip -l %f; sleep 5"'`
3.  这导致
    1.  正在运行的命令（所以不要输入`rm -rf`）
    2.  `~/.local/share/applications/`调用的文件`xterm-usercreated.desktop`

至少在这里，我得到以下文件：

```
[Desktop Entry]
Encoding=UTF-8
Name=xterm
MimeType=application/zip;
Exec=xterm -e 'bash -c "unzip -l %f; sleep 5"' %f
Type=Application
Terminal=false
NoDisplay=true 
```

4：查看系统 xterm .desktop 我发现：

```
[Desktop Entry]
Type=Application
Encoding=UTF-8
Name=XTerm
GenericName=
Comment=XTerm: terminal emulator for X
Icon=/usr/share/pixmaps/xterm-color_32x32.xpm
Exec=xterm
Terminal=false
Categories=X-Debian-Applications-Terminal-Emulators; 
```

5：将 .usercreated.desktop 文件编辑为：

```
[Desktop Entry]                                                                 
Type=Application                                                                
Encoding=UTF-8                                                                  
Name=xtermz                                                                     
Exec=xterm -e 'bash -c "unzip -l %f; sleep 5"' %f                               
Terminal=false                                                                  
Categories=X-Local-WTF 
```

6：运行 xdg-desktop-menu forceupdate --mode user

7：“xtermz”现在出现在列表中……成功！

8：呸！这也使它出现在主菜单的“其他”下。奇怪的！

* * *

## 一些注意事项：

*   在我的 Debian/testing 中，`xdg-desktop-menu`和朋友（特别是`xdg-icon-resource`）住在`xdg-utils`包里。
*   您应该能够`.desktop`从头开始创建文件。
*   您应该能够使用blah blah安装`.desktop`文件`xdg-desktop-menu install`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2015-11-26T04:20:44.543

Linux Mint 和 Ubuntu 有一个非常简单的解决方案（我没有在其他发行版上检查过）：

```
mkdir ~/bin  #actually, need to run this line just once
cd ~/bin
ln -s /bin/any/your/application.sh YOUR_ALIAS_NAME 
```

例如，我喜欢`calc`从**Alt+F2**菜单运行，所以我的脚本是：

```
mkdir ~/bin
cd ~/bin
ln -s /usr/bin/gnome-calculator calc 
```

如果要传递任何参数，可以在以下位置创建一个简短的 shell 脚本`~/bin`：

```
#create the file:
echo '#!/bin/sh
firefox --private-window' > ~/bin/pfx
#make my script executable:
chmod 755 ~/bin/pfx 
```

* * *

该解决方案基于以下事实，即`.profile`开箱即用的 home dir 中有一个名为的文件。我希望，你已经知道，什么是[`.profile`file](https://unix.stackexchange.com/questions/40708/what-is-the-difference-between-profile-bashrc-bash-profile-gnomer)。作为其工作的一部分，此文件附加`~/bin`到`$PATH`（如果`bin`存在）。

我认为，*`bin`在家*不安全，但本文建议遵循描述的方式：[https ://help.ubuntu.com/community/HomeFolder#Installing_Software_Into_The_Home_Directory](https://help.ubuntu.com/community/HomeFolder#Installing_Software_Into_The_Home_Directory)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-04-03T20:01:05.073

您可以添加一个符号链接到 /usr/bin：`ln -s <YOUR_ALIAS_PATCH> <ALIAS_NAME>`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-24T18:48:40.587

我无法让别名工作，所以我这样做了：

*   创建了一个 shell 脚本来做我想做的事情并将它放在我的主目录中

*   **在/usr/bin**中放置一个指向我的 shell 脚本的链接：

     ***   例如**sudo ln -s ~/bin/MyShellScript.sh /usr/bin/MyShortcutName**** 

 **有用！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-05-02T15:27:16.353

我无法让别名工作，所以我这样做了：

创建了一个 shell 脚本来做我想做的事情并将它放在我的主目录中 将指向我的 shell 脚本的链接放在 /usr/bin 中：例如`sudo ln -s ~/bin/MyShellScript.sh /usr/bin/MyShortcutName` 它可以工作！

它之所以有效，是因为 /usr/bin 在您的路径变量中。更好的选择是在您的家中创建一个隐藏目录，例如 ~/.scripts/

然后将此目录添加到您的路径中。您现在可以将所有脚本放在该目录中。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-07-29T15:02:47.057

你可以做几件事。正如 Brad Parks + Nostoc 所说，您可以在本地路径中放置一个执行程序的脚本：

```
$ cat my/local/path/terminal
#! /bin/bash
gnome-terminal 
```

如果您不想为您的许多别名执行此操作，则将单个“别名执行程序”添加到您的本地路径：

```
$ cat my/local/path/myAlias
#! /bin/bash
CMD="$*"
eval "$CMD" 
```

然后，在对话框中输入“myAlias aliasedProgram arg1 arg2 etc”。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-11-05T06:03:25.767

我在名称 /usr/bin/b 下创建了这个脚本，并赋予它全局读取/执行权限：

```
#!/bin/bash -i
eval "$@" 
```

现在我可以使用命令

```
b foo arg1 arg2 
```

基本上运行

```
foo arg1 arg2 
```

就好像它是在交互式 shell 中键入的一样。可以使用别名、复合命令等。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-09-02T08:25:19.747

我没有使用 alt-f2 在终端外运行命令，而是使用 gnome-do；它更加方便和灵活（一旦设置好）。您仍然无法运行 shell“别名”，但您可以配置 gnome-do 以使用“文件和文件夹”插件，然后您想要执行的任何“*.desktop”应用程序都可以用于运行、打开等。您也可以以相同的方式执行 shell 脚本。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-09-02T17:43:31.700

我做了类似于@YAG 的事情。

我在 /usr/local/bin 中创建了一个名为“my”的 bash 脚本：

```
echo -e '#!/usr/bin/bash\n~/bin/$@' > ~/temp
sudo cp ~/temp /usr/local/bin/my
rm ~/temp 
```

现在，如果我想从 Alt+F2 调用 ~/bin 内的脚本，我只需输入：

```
my script.sh 
```

优点是所有用户都将访问他们自己的 ~/bin 目录，并且您不必为每个 ~/bin/* 文件创建新的符号链接。

缺点是每次都需要输入'my'，不能依靠alt+f2的自动完成功能来完成'script.sh'

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-10-18T13:17:00.630

只需输入： bash -ic 'MY_ALIAS'

# perl - 导入某个包/标签时，如何让 Perl 发出警告消息？

> ID：187531
> 
> 赞同：6
> 
> 时间：2008-10-09T14:29:37.680
> 
> 标签：perl, import, packages, warnings

我有一个我刚刚制作的包，我有一个“旧模式”，它基本上使它像以前一样工作：将所有内容导入当前命名空间。将其作为一个软件包的好处之一是我们不再需要这样做。无论如何，我想做的是拥有它，以便每当有人这样做时：

```
use Foo qw(:oldmode); 
```

我发出警告说，这已被弃用，他们应该只导入他们需要的东西，或者只使用 Foo->fun(); 访问函数。

关于如何做到这一点的任何想法？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-09T14:31:55.147

您编写自己`sub import`的代码`package Foo`，将使用来自 的参数列表调用`use Foo`。

一个例子：

```
package Foo;
use Exporter;

sub import {
    warn "called with paramters '@_'";

    # do the real import work
    goto &{Exporter->can('import')};
} 
```

因此，在 sub 中`import`，您可以在参数列表中搜索已弃用的标签，然后发出警告。

*更新*：正如 Axeman 指出的那样，您应该调用`goto &{Exporter->can('import')}`. 这种形式的 goto 替换堆栈上的当前子例程调用，保留当前参数（如果有）。这是必需的，因为 Exporter 的 import() 方法将导出到其调用者的命名空间。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-09T14:56:10.747

好吧，正如您特别声明的那样，您想在这种情况下发出警报`use Mod qw<:oldmode>;`效果更好：

```
package Foo;
use base qw<Exporter>;
use Carp qw<carp>;
...
sub import { 
    #if ( grep { $_ eq ':oldmode' } @_ ) { # Perl 5.8
    if ( @_ ~~ ':oldmode' ) {              # Perl 5.10 
        carp( 'import called with :oldmode!' );
    }
    goto &{Exporter->can( 'import' )};
} 
```

感谢 Frew，他提到了 Perl 5.10 智能匹配语法。我正在学习在我的代码中使用 Perl 5.10 的所有方法。

**注意：**在 import sub 中使用 exporter 的标准方法是操作`$Exporter::ExportLevel`或调用`Foo->export_to_level( 1, @_ );`但我喜欢上面的方式。它更快，我认为，更简单。

# sql-server - Visual Studio 2008 认为它是错误的版本是否重要？

> ID：187535
> 
> 赞同：3
> 
> 时间：2008-10-09T14:29:57.257
> 
> 标签：sql-server, visual-studio, visual-studio-2008, installation

我在重新格式化后一个月左右安装了 Visual Studio 2008 标准版（在 Vista64 上，如果重要的话）。我从其中一个“英雄发生在这里”发布活动中免费获得了它。

然后我大约一周前安装了 SQL Server 2008 Express Edition（我们应该通过邮件免费获得它，但我放弃了——显然[有点太早了）。](http://blogs.msdn.com/chkoenig/archive/2008/10/07/hhh-launch-update-sql-server-2008.aspx)

在我安装 SQL Server 2008 Express 之前，当我启动 Visual Studio 2008 时，初始屏幕会显示“Visual Studio 2008 标准版”。现在它显示“Visual Studio 2008 **Shell** ”。

我认为无论出于何种原因，SQL2008 Express 附带的 VS2008 框架已经踩到了我已经拥有的 VS2008 框架。我知道如果你在没有 VS2005 的机器上安装 SQL2005，你会得到一个没有安装语言（没有 C#、VB.NET 等）的 VS2005 的“shell”版本

我认为这没什么大不了的，因为在最坏的情况下，某处的某些注册表设置是错误的，并且启动画面只是混乱。但我说得对吗？或者当VS2008出于某种原因拒绝我的某些功能时，这会咬我吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-09T14:35:00.477

老实说，我不会诱惑它。这有点像发动机的敲门声，但汽车行驶良好。然后有一天你会被困在路边（或者可能不会。）我建议卸载并重新安装以确保安全。我曾在 Visual Studio 2008 中进行过类似的测试，而这正是我最终所做的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-09T14:36:46.760

我会不理它的。但是，如果我车里的发动机发生了爆震，我现在就在修复较小的时候对其进行重建，而不是等待灾难性的故障（这里的经验之声）。:-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-02T15:25:24.263

我在几台机器上的经验是没有什么可担心的。如果您查看 Visual Studio 中的关于屏幕，它应该会告诉您所有正确的信息。如果您使用“devenv /splash”从运行命令启动它，您可能还会看到显示正确的启动信息。如果您希望每次都显示正确的初始屏幕，请编辑您的 Visual Studio 2008 快捷方式并清除 Start In 目录中的值。

# javascript - 是否有不区分大小写的 jQuery :contains 选择器？

> ID：187537
> 
> 赞同：147
> 
> 时间：2008-10-09T14:30:19.830
> 
> 标签：javascript, jquery, jquery-selectors

是否存在不区分大小写的[:contains](http://docs.jquery.com/Selectors/contains) jQuery 选择器版本，还是我应该通过遍历所有元素并将它们的 .text() 与我的字符串进行比较来手动完成工作？

* * *

## 回答 #1

> 赞同：128
> 
> 时间：2008-10-09T14:37:24.293

我最终为 jQuery 1.2 做的是：

```
jQuery.extend(
    jQuery.expr[':'], { 
        Contains : "jQuery(a).text().toUpperCase().indexOf(m[3].toUpperCase())>=0" 
}); 
```

这将扩展 jquery 以具有不区分大小写的 :Contains 选择器， :contains 选择器保持不变。

编辑：对于 jQuery 1.3（感谢@user95227）和更高版本你需要

```
jQuery.expr[':'].Contains = function(a,i,m){
     return jQuery(a).text().toUpperCase().indexOf(m[3].toUpperCase())>=0;
}; 
```

编辑：显然通过使用直接访问DOM

```
(a.textContent || a.innerText || "") 
```

代替

```
jQuery(a).text() 
```

在前面的表达式中，它大大加快了速度，所以如果速度是一个问题，请自行承担风险。（见[@John](https://stackoverflow.com/users/171662/john)的[问题](https://stackoverflow.com/questions/1407434/is-there-any-way-to-speed-up-this-solution-for-a-case-insensitive-jquery-contai)）

最新编辑：对于 jQuery 1.8，它应该是：

```
jQuery.expr[":"].Contains = jQuery.expr.createPseudo(function(arg) {
    return function( elem ) {
        return jQuery(elem).text().toUpperCase().indexOf(arg.toUpperCase()) >= 0;
    };
}); 
```

* * *

## 回答 #2

> 赞同：107
> 
> 时间：2011-02-08T17:11:46.117

使其可选择不区分大小写： [http ://bugs.jquery.com/ticket/278](http://bugs.jquery.com/ticket/278)

```
$.extend($.expr[':'], {
  'containsi': function(elem, i, match, array)
  {
    return (elem.textContent || elem.innerText || '').toLowerCase()
    .indexOf((match[3] || "").toLowerCase()) >= 0;
  }
}); 
```

然后使用`:containsi`而不是`:contains`

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2009-04-23T22:49:50.747

从 jQuery 1.3 开始，此方法已被弃用。为了让它工作，它需要被定义为一个函数：

```
jQuery.expr[':'].Contains = function(a,i,m){
    return jQuery(a).text().toUpperCase().indexOf(m[3].toUpperCase())>=0;
}; 
```

* * *

## 回答 #4

> 赞同：39
> 
> 时间：2008-10-10T05:06:30.857

如果有人（比如我）对*包含*定义中*的 a*和*m[3]*的含义感兴趣。

 ** * *

**KEY/LEGEND：由 jQuery 提供的可用于选择器定义的参数：**

*r* = 被审查的元素的 jQuery 数组。（例如：*r.length* = 元素数）

*i* = 数组*r*中当前正在审查的元素的索引。

*a* = 当前正在审查的元素。Selector 语句必须返回 true 才能将其包含在匹配的结果中。

*m[2]* = nodeName 或 * 我们正在寻找（冒号左侧）。

*m[3]* = 传递给 :selector(param) 的参数。通常是索引号，如*:nth-of-type(5)*或字符串，如*:color(blue)*。

* * *

## 回答 #5

> 赞同：32
> 
> 时间：2012-08-24T16:40:39.990

在 jQuery 1.8 中，您需要使用

```
jQuery.expr[":"].icontains = jQuery.expr.createPseudo(function (arg) {                                                                                                                                                                
    return function (elem) {                                                            
        return jQuery(elem).text().toUpperCase().indexOf(arg.toUpperCase()) >= 0;        
    };                                                                                  
}); 
```

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2012-07-04T09:26:18.683

似乎执行得稍微快一些并且也**允许正则表达式**的变体是：

```
jQuery.extend (
    jQuery.expr[':'].containsCI = function (a, i, m) {
        //-- faster than jQuery(a).text()
        var sText   = (a.textContent || a.innerText || "");     
        var zRegExp = new RegExp (m[3], 'i');
        return zRegExp.test (sText);
    }
); 
```

* * *

这不仅不区分大小写，而且允许强大的搜索，例如：

*   `$("p:containsCI('\\bup\\b')")` （匹配“Up”或“up”，但不匹配“upper”、“wakeup”等）
*   `$("p:containsCI('(?:Red|Blue) state')")` （匹配“红色状态”或“蓝色状态”，但不匹配“向上状态”等）
*   `$("p:containsCI('^\\s*Stocks?')")` （匹配“stock”或“stocks”，但仅在段落的开头（忽略任何前导空格）。）

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2013-05-27T16:05:57.100

可能会迟到……但是，

我宁愿走这条路。。

```
$.extend($.expr[":"], {
"MyCaseInsensitiveContains": function(elem, i, match, array) {
return (elem.textContent || elem.innerText || "").toLowerCase().indexOf((match[3] || "").toLowerCase()) >= 0;
}
}); 
```

这样，您就**不会**篡改 jQuery 的 NATIVE *'.contains'* ...稍后您可能需要默认的 ...如果被篡改，您可能会发现自己回到***stackOverFlow*** ...

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-06-15T01:20:02.060

```
jQuery.expr[':'].contains = function(a,i,m){
    return jQuery(a).text().toUpperCase().indexOf(m[3].toUpperCase())>=0;
}; 
```

更新代码在 1.3 中运行良好，但与前面的示例不同，“包含”在第一个字母上应该是小写的。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2016-01-11T11:06:28.473

请参阅下文，使用 ":contains" 从 HTML 代码中查找忽略大小写的文本，

```
 $.expr[":"].contains = $.expr.createPseudo(function(arg) {
            return function( elem ) {
                return $(elem).text().toUpperCase().indexOf(arg.toUpperCase()) >= 0;
            };
        });
        $("#searchTextBox").keypress(function() {
          if($("#searchTextBox").val().length > 0){
            $(".rows").css("display","none");
            var userSerarchField = $("#searchTextBox").val();
            $(".rows:contains('"+ userSerarchField +"')").css("display","block");
          } else {
            $(".rows").css("display","block");
          }              
        }); 
```

您还可以使用此链接根据您的 jquery 版本查找忽略大小写的代码， [Make jQuery :contains Case-Insensitive](https://css-tricks.com/snippets/jquery/make-jquery-contains-case-insensitive/)

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2018-04-24T16:29:32.480

使用正则表达式的更快版本。

```
$.expr[':'].icontains = function(el, i, m) { // checks for substring (case insensitive)
    var search = m[3];
    if (!search) return false;

    var pattern = new RegExp(search, 'i');
    return pattern.test($(el).text());
}; 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-04-03T22:56:36.573

我遇到了类似的问题，以下不起作用...

```
// This doesn't catch flac or Flac
$('div.story span.Quality:not(:contains("FLAC"))').css("background-color", 'yellow'); 
```

这有效，无需扩展

```
$('div.story span.Quality:not([data*="flac"])').css("background-color", 'yellow'); 
```

这也有效，但可能属于“手动循环”类别......

```
$('div.story span.Quality').contents().filter(function()
{
  return !/flac/i.test(this.nodeValue);
}).parent().css("background-color", 'yellow'); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-01-14T09:12:05.857

新建一个变量，我将其命名为 subString 并将您要搜索的字符串放入某些元素文本中。然后使用 Jquery 选择器选择您需要的元素，例如我的示例`$("elementsYouNeed")`并按`.filter()`. 在中`.filter()`它将比较每个元素`$("elementsYouNeed")`与函数。

在我`.toLowerCase()`用于元素文本的函数中，还有 subString 可以避免区分大小写的条件并检查其中是否有 subString。之后，该`.filter()`方法从匹配元素的子集构造一个新的 jQuery 对象。

现在您可以在 matchObjects 中获取匹配元素并做任何您想做的事情。

```
var subString ="string you want to match".toLowerCase();

var matchObjects = $("elementsYouNeed").filter(function () {return $(this).text().toLowerCase().indexOf(subString) > -1;}); 
```

# model - 您是否购买了 MVP 及其变体中表示层的重用故事？

> ID：187539
> 
> 赞同：7
> 
> 时间：2008-10-09T14:30:50.313
> 
> 标签：model, view, mvp, reusability, presentation

除了单元测试的好处之外，我听说的关于 MVP 模式的还有表示层的可重用性。因此，您将设计一个表示层并将其用于 WinForms（富）和 Web。

我目前正在.NET 中开发一个 Windows 窗体应用程序，将来可能会创建一个 Web UI。但是，当我设计表示层和 UI 层之间的交互时，我不确定这种可重用性的概念是否值得所有的麻烦。有时我觉得我正在为可能的 Web UI “简化”我的演示文稿，而专门为 Windows 窗体 UI 设计的演示文稿可能会更多。

那么，你们中有多少人正在从可重用的表示层中获益呢？这种可重用性的东西在现实世界中会出现吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-09T16:29:05.100

MVC/MVP 的价值确实在于两种不同的分离。

表示层和模型之间的分离（无论您决定实现它们）是除了简单系统之外的任何东西的更重要的原则软件设计之一。如果您的应用程序中有任何业务逻辑或非可视化逻辑，您肯定会看到这种分离的好处。

表示层和控制器之间的分离对我来说似乎不太重要。在富客户端应用程序中，您很少会看到这种分离的好处。在 Web 前端，它更为常见（例如，ASP.NET aspx 和代码隐藏或 J2EE jspx 和 servlet）。

也许我没有完全掌握你解释 MVP 的方式，但我不会说其中一个好处是表示层的**可重用性**——相反，我会说主要好处是模型的可重用性. 这也是使用任何 n 层系统的主要好处之一。如果您想扩展和构建一种新型前端（例如，WinForms、WPF 等），您可以这样做，而无需尝试将所有逻辑从您刚刚构建的 Web 应用程序中分离出来。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-10T17:04:50.240

我认为您可能误解了角色或演示者。

我认为演示者应该几乎与 UI 无关，即信息的显示方式。

演示者应该从 UI（无论是 web 还是 winform）获取任何输入，在控制器级别开始必要的处理，并保留输出。

UI 应该完全控制该返回的使用方式。

例子：

假设您正在从数据库中提取有关汽车的数据。

您可以将车辆识别号从 UI 传递给演示者，然后要求其返回数据。完成处理后，它将保存返回的数据：假设它具有品牌、型号、年份和最后注册日期。

从您的 UI 中，您应该能够随心所欲地显示它，这使得演示者可重用。您可以在 winform 上显示所有 4 项，但在移动设备的 Web UI 上，您可能只显示基本信息（品牌、型号和年份）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-10T22:34:41.977

我同意chills42 的观点——MVP 的目标不是让presenter 如此通用，以至于它可以与任何UI 技术一起使用。目标是使模型和（也许）控制器具有通用性，以便您可以使用所需的任何技术构建 UI。

同样，这可能是我误解了你，但数据绑定与你的问题并不特别相关（也就是说我没有看到联系）。目标是这样的：

**您设计您的应用程序逻辑，也称为控制器（例如，当 Bob 提交发票时，系统执行 x、y 和 z，然后向 Bob 显示发票列表）。**

**您设计您的业务数据，也称为模型（例如，具有行项目列表的发票）。**

现在，您想知道，用户界面到底在哪里？您拥有知道如何指导您的流程的东西，并且您拥有执行此操作所需的所有数据，因此您只需要一些东西来向您展示这一切的样子。这就是主持人进来的地方。

**您设计了一个与您的控制器和模型交互的 .NET WinForms 应用程序。您制作了一个漂亮的表单，为您的用户提供了一种创建发票的方法。然后，你将所有数据传递给你的控制器，控制器使用它，使用模型处理它，然后告诉你下一步做什么。您的 WinForms 应用程序愉快地继续其愉快的（不知情的）方式并按照指示执行，接收下一个表单的数据并显示它。**

然后，你的老板进来说：“嘿，Jiho Han，你的这个应用程序完全成功了。我需要你为我构建一个 ASP.NET 应用程序和一个批处理器来完成所有这些工作。

**废话。他要你做什么？哦，没问题。你使用了 MVP。您需要做的就是构建一个 ASP.NET UI（当然，它遵循 Web 标准），它将充当您所有数据的漂亮面孔。没问题——三天——发货。**

这就是MVP的好处。您不必重写所有应用程序逻辑；您不必编写大量查询来将数据转换为不同的格式；你不必真正做任何工作。我的意思是，制作 UI 很有趣，对吧？现在由您来决定您是否认为这值得花时间，但几乎在任何实际软件中，您都会对这些组件进行**某种**分离，无论是 MVP 还是像 n-tier 这样更企业化的东西。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T02:18:03.463

我购买重用故事是因为它曾经对我有用，并且因为我不希望从一种类型的 UI 切换到完全不同的类型会很容易。

一般来说，在您的情况下，我希望必须对 Presenter 进行相当多的修改。没关系，这就是它的用途。它本质上是 UI 和域逻辑之间的适配器。并且由于它有助于将域逻辑排除在 UI 之外，这将使交换 UI 变得更加容易。

哦，顺便说一句，网络应用程序开始变得更加强大。您可能需要为 Web 改进您的 Presenter！

麦克风

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-17T02:42:21.827

我认为你对“愚蠢”的感觉是绝对正确的。

可重用性是项目可能消失的最深、最黑暗和最讨厌的老鼠洞之一，从大约 15 年的 OO 开发经验来看，在此期间，可重用性被吹捧为我们将获得的主要好处之一。

为重用而设计就像为性能而设计 - 它应该是一个背景指导原则，但在大多数情况下，预先过多关注会使您的开发过程陷入困境并导致您过度概括一切。

我通常的建议是首先实现最复杂、最灵活的 GUI，然后重构为更可重用的通用架构。根据项目的大小，在原型中执行此操作，并针对您正在评估的内容制定一些明确的目标。然后，您可以存档原型并保留它，同时将经验教训和一些代码带回主项目。

注意：如果您正在探索 GUI 架构，原型需要使用您打算使用的技术，并且*深度和狭窄，*而不是用于演示 GUI 外观和感觉的传统 GUI 原型。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-17T03:35:24.697

MVC 设计提供的可重用性并不是同一个视图/呈现器可以将相同的模型/控制器呈现给不同的输出，而是可以在一个公共视图上呈现不同的模型/控制器集。

一个系统，随着它的成熟，可能需要几个视图：一个 Web 界面、一个桌面编辑器、一个自动化脚本 API 和几个不同的模型： 客户 A 的计费是按订单的，但客户 B 需要它每季度按客户部门。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-13T14:10:56.143

埃德·阿尔托弗，

我对你所说的控制器有点困惑。

> 您设计您的应用程序逻辑，也称为控制器（例如，当 Bob 提交发票时，系统执行 x、y 和 z，然后向 Bob 显示发票列表）。
> 
> 您设计您的业务数据，也称为模型（例如，具有行项目列表的发票）。

但是根据您的陈述，控制器似乎是包含应用程序逻辑（业务逻辑？）的东西，而您的模型只是数据持有者。

据我了解，P代表Presentation。P 关注表示逻辑——如何最好地向用户展示底层业务信息。实际的业务逻辑/规则将包含在模型层中。事实上，你所说的控制器也将是模型层的一部分——M。

无论如何，你关于“苛刻”老板的例子似乎是直接从教科书出来的——我们都知道这一点。这不是我要争论的。

同样，如果 P 用于演示，您的 WinForms 和 Web 可能有完全不同的流程来满足它们的演示需求。更不用说用于批处理应用程序的控制台之一，您甚至可能不需要 P 层。假设数据绑定技术按设计工作，数据绑定使 WinForms UI 层变得如此简单 - V。尝试比较数据绑定和非数据绑定应用程序的来源。在非数据绑定场景中，您必须自己管理更多移动部分。你有更多的控制权，但你仍然必须管理它。在我看来，数据绑定对我如何编写 P 很重要。

我不反对你可以让一个 P 层适用于所有类型的 UI，但我担心，在这样做的同时，你必须在所有 UI 的最小公分母上做出妥协。而且您可能会将更多的表示逻辑推入 UI 层——这反过来又使单元测试更加困难。

我希望这能澄清我最初的困境。恐怕我缺乏充分表达自己的能力...

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-10T18:06:06.670

发冷42，

> 我认为您可能误解了角色或演示者。

我相信我理解主持人的角色就好了。

我不怀疑您可以使演示者通用，以便它适用于任何 UI。我的问题是，这是否值得付出努力，同时失去了利用某个 UI 平台可以提供的优势的机会。

想想 WinForms 上的数据绑定。通过实现某些接口（***IDataErrorInfo***、***INotifyPropertyChanged***、***IEditableObject***等），您的演示者可以用更少的代码使 UI 更简单。有人可能会说，数据绑定不是一个优势——这无关紧要。许多这些界面对网络没有意义，尽管它可能不会伤害它。我可以为 WinForms 创建一个适配器以用于数据绑定。所以我还有一层。问题是，值得付出努力吗？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-10T13:13:25.777

MVC 是一种很好的使用模式，即使您最终只将它用于一个前端。它可以帮助您设计具有干净分离部件的应用程序。这带来了几个好处。

它简化了零件的自动化测试，例如您可以直接调用模型，而无需 gui。

由于有清晰的分隔线，因此更容易重新设计应用程序的各个部分，而不会破坏其他代码（例如重新设计 GUI）。

拥有几个较小（并且尽可能独立）的部分，而不是一大堆杂乱无章的东西，这样更容易调试。

向新程序员介绍代码会更容易，因为他们一次可以探索一个逻辑部分。

一般来说，MVC 是一种很好的 OO 方式来设计应用程序，因为它为您提供了一种自然的方式来封装您的应用程序。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-13T16:50:22.890

你在解释自己方面做得很好——不用担心。:)

注意不要将应用程序逻辑与业务逻辑混淆。应用程序逻辑有时被称为**应用程序进程控制**，这可能是一个更贴切的名称。这基本上是用户操作和系统响应。例如，步骤 1：用户登录，步骤 2：用户点击“创建新发票”，步骤 3：用户提交基本信息，步骤 4：用户添加行项目，步骤 5：用户将发票提交到发票数据库。

我在下面概述的步骤是适用于您为发票应用程序设计的任何 UI 的流程控制。另一方面，业务逻辑封装在您的模型中。P 是表示，是的，但不是表示*逻辑*。在大多数情况下，P 将引用面向客户端的内容（例如，ASPX、JSPX、Ruby on Rails 视图等）——它是严格的标记。换句话说，您的控制器为您的表示层提供了一些行为。

鉴于这些定义，您可能会看到，如果您正确创建了控制器和模型，它们将完全与 UI 无关。您不必迎合最低公分母，因为它们只是封装了您的流程逻辑和业务逻辑，允许您的表示层迎合您公开该逻辑的媒介（例如，Internet、控制台或桌面）应用程序）。

附带说明一下，有时控制器和模型实际上以其他一些抽象方式（如 Web 服务）公开，因此您可以拥有一堆 UI 或 Web 服务器来平衡一些传入流量，并且您仍然可以利用相同的后端.

希望这有所帮助？

# java - 预处理源代码作为 Maven 构建的一部分

> ID：187550
> 
> 赞同：15
> 
> 时间：2008-10-09T14:35:28.120
> 
> 标签：java, maven-2, build-process

我有很多需要自定义预处理的 Java 源代码。我想摆脱它，但现在这不可行，所以我坚持下去。鉴于我有一个原本不应该存在的不幸问题，我该如何使用 maven 解决它？

（对于完整的故事，我正在用 maven 替换基于 python 的构建系统，所以请一次改进。修复非标准源代码更难，稍后会出现。）

是否可以在编译期间使用任何现有的 Maven 插件来实际更改源文件？（显然不理会原始的、未处理的代码）

需要明确的是，预处理是指与天线或 C 编译器预处理代码相同的预处理，而自定义是指它是完全专有的，看起来一点也不像 C 或天线预处理。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2011-12-05T13:43:01.033

有一个支持 MAVEN 的 Java 预处理器：[java-comment-preprocessor](https://github.com/raydac/java-comment-preprocessor)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-09T21:34:14.360

这是非常可行的事情，我过去做过非常相似的事情。

我的一个项目中的一个例子，我使用了 antrun 插件来执行一个外部程序来处理源：

```
 <build>
  <plugins>
    <plugin>
      <groupId>org.apache.maven.plugins</groupId>
      <artifactId>maven-antrun-plugin</artifactId>
      <executions>
        <execution>
          <id>process-sources</id>
          <phase>process-sources</phase>
          <configuration>
            <tasks>
               <!-- Put the code to run the program here -->
            </tasks>
          </configuration>
          <goals>
            <goal>run</goal>
          </goals>
        </execution>
      </executions>
    </plugin>
  </plugins>
</build> 
```

请注意我指示运行阶段的标签。Maven 生命周期的文档在[这里](http://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html)。另一种选择是实际编写您自己的 Maven 插件来执行此操作。这有点复杂，但也是可行的。您仍将按照我在此处记录的内容对其进行配置。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-09T16:06:17.703

Maven 插件可以在预编译时挂钩到构建过程是的，至于任何现有的插件是否有帮助我不知道。

几年前我写了一个 maven 插件作为大学项目的一部分，虽然当时文档有点缺乏，但它并不太复杂。所以你可能会考虑自己动手，应该有很多开源项目你可以从中提取想法或代码（例如，我们的项目是 BSD 许可的......）

# c# - ASP.net 健康监控是否与 asmx Web 服务一起使用

> ID：187551
> 
> 赞同：4
> 
> 时间：2008-10-09T14:35:48.727
> 
> 标签：c#, asp.net, asmx, health-monitoring

我正在尝试使用 ASP.net 健康监控来记录来自 asmx Web 服务的未处理异常。我在 web.config 中启用了运行状况监控，但它没有记录任何内容。运行状况监控是否适用于 asmx Web 服务？我用谷歌搜索，似乎其他人也问过同样的问题，但从未得到明确的答案。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-02T08:44:49.283

请不要发布回复，除非它回答了所提出的问题。对问题以外的问题的一半答案会使读者感到困惑。运行状况监视与“真正未处理的”ASP.NET 异常或 Application_Error 事件无关。

答案是不。我已经对此进行了一些研究，出于某种原因，Web 方法中引发的异常从未提供给健康监控提供者。看来您必须抓住它们并自己处理。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-09T20:24:14.377

未处理异常的正常解释与 Tom 所指的那些之间存在差异。汤姆指的是真正未处理的异常，这将杀死你的 w3wp.exe 进程（在它有机会记录它之前），正如我在这里写的博客： [http ://www.improve.dk/blog/2008 /04/07/spawning-threads-in-aspnet-can-be-dangerous](http://www.improve.dk/blog/2008/04/07/spawning-threads-in-aspnet-can-be-dangerous)

正常未处理的异常将导致异常发生并向用户/被调用者显示错误页面。但是，它不会使您的 w3wp.exe 进程崩溃。这些异常应该由运行状况监控来处理。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-23T03:06:09.613

在 Global.asax 中，如果您使用 Visual Studio 自动生成的，您可以将代码添加到 Application_Error 方法以处理异常并以您选择的任何方式记录它们。您还可以覆盖 Init 方法并为类的错误事件添加事件处理程序。

在任何一种情况下，您都只会得到一个无用的普通 EventArgs 对象，但您可以使用 HttpContext.Current.Server.GetLastError() 来获取发生的异常。

正如另一张海报所提到的，这可能无法捕获由异步运行的委托、您自己启动的线程或使用 Page.RegisterAsyncTask() 创建的异步页面任务引发的异常。在这些方面，您始终需要确保实现具有异常支持，以便可以捕获异常并且 IIS 工作进程不会中止。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-09T14:55:33.087

它不起作用，因为未处理的异常没有在任何类型的 try/catch 中运行。因此，它将无法记录它。看看这篇博文：http: [//blogs.msdn.com/tom/archive/2007/12/04/unhandled-exceptions-causing-asp-net-to-crash-in-net-2-0。 aspx](http://blogs.msdn.com/tom/archive/2007/12/04/unhandled-exceptions-causing-asp-net-to-crash-in-net-2-0.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-13T03:38:14.250

[CALM](http://www.nov8r.com/calm.aspx)产品应该在这种情况下工作；如果不是，请告诉我——我写的 ;-)

# python - 如何使用 python 捕获 mp3 流

> ID：187552
> 
> 赞同：11
> 
> 时间：2008-10-09T14:36:02.003
> 
> 标签：python, streaming

捕获来自http的mp3流并使用python将其保存到磁盘的最佳方法是什么？

到目前为止我已经尝试过

```
target = open(target_path, "w")
conn = urllib.urlopen(stream_url)
while True:
    target.write(conn.read(buf_size)) 
```

这给了我数据，但它在 mp3 播放器中出现乱码或无法播放。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-09T14:40:25.037

如果您使用的是 Windows，您可能会不小心进行 CRLF 转换，从而损坏二进制数据。尝试`target`以二进制模式打开：

```
target = open(target_path, "wb") 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-07-07T09:20:11.910

最好的方法是：

```
urllib.urlretrieve(stream_url, target_path); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2018-05-23T19:35:52.267

也许语法从以前的 urllib 答案改变了（这让我得到了正确的答案），但这种语法适用于 python3：

```
import urllib.request

urllib.request.urlretrieve(stream_url, target_path) 
```

# flash - Flash：如何强制影片剪辑保持在约束内

> ID：187555
> 
> 赞同：1
> 
> 时间：2008-10-09T14:36:54.107
> 
> 标签：flash, actionscript

我有一个动态加载影片剪辑的 Flash 程序，有时它们想要使用的空间超过了我给它们的空间。理想情况下，我想强迫他们只在我给他们的边框中显示内容。我想要这个的原因是我的程序有一个用户界面，有时会被这种行为所掩盖。我想避免重写我的程序以使这些加载的电影处于第一级，但这看起来是我唯一的选择。有什么建议么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-09T16:14:33.070

查看 MovieClip 中的 scrollRect 属性

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-09T18:53:26.383

您可以在加载影片剪辑后动态调整其大小吗？

也许是这样的：

```
private function onClipLoaded(clipRef:MovieClip) {
    if (clipRef.width > myViewArea.width) {
        var scaleRatio:Number = myViewArea.width / clipRef.width;
        with (clipRef) {
            scaleX = scaleRatio;
            scaleY = scaleRatio;
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-09T14:39:42.463

您可以将您的电影放在具有溢出样式的 DIV 中：隐藏，但请务必将“wmode=transparent”添加到您的电影嵌入中，以防止它在您的 HTML 顶部弹出。

# sharepoint - 如何将第 3 方 Web 部件从 SharePoint 2 (2003) 迁移到 SharePoint 3 (2007)

> ID：187560
> 
> 赞同：0
> 
> 时间：2008-10-09T14:38:45.337
> 
> 标签：sharepoint, web-parts, sharepoint-upgrade

我正在将一个站点从 SharePoint 2 迁移到 3（实际上是从 SharePoint Portal Server 2003 迁移到 Microsoft Office SharePoint Server 2007）。有一些第 3 方 Web 部件，由于这是迁移，而不是就地升级，我需要在新场上安装这些 Web 部件。

如果我已打包了 SharePoint 配置分析器以 cab 文件形式提供的 Web 部件，我该如何执行此操作？我可以以某种方式简单地部署这些 cab 文件，即使它们没有打包为解决方案？还是我需要将 cab 文件分开并将它们重新打包为解决方案？或者我是否需要获取为 SharePoint 3 编写的新版本的 Web 部件，并可能编辑使用它们的页面？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-09T18:59:21.473

您仍然可以使用在 WSSv2 中使用的相同 STSADM 命令安装带有 WSSv3 的 .CAB 文件

```
STSADM -o addwppack -filename <filename.CAB> 
```

但是，也许您应该与这些第 3 方 Web 部件的供应商取得联系？也许他们会将 WSSv3 的版本打包为 WSP？

您还可以确定 WSSv2 版本实际上可以在 WSSv3 上运行吗？他们经常这样做，但并非总是如此。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-09T15:24:04.030

您应该能够将它们分开并将它们重新打包为解决方案或手动部署它们。显然，如果它们是具有其他依赖关系的真正复杂的 Web 部件，这可能会变得更加困难。

# c++ - 如何阻止我的 MFC 应用程序在启动时调用 OnFileNew()？

> ID：187567
> 
> 赞同：2
> 
> 时间：2008-10-09T14:41:31.760
> 
> 标签：c++, mfc

我使用 Visual Studio 的应用程序向导创建了一个具有多文档界面的骨架 MFC 程序。当我启动这个程序时，它会自动创建一个子框架，我不希望它这样做——我需要主框架的客户区为空，直到用户选择打开一个文件。

调试器告诉我，当应用程序类的 InitInstance() 函数调用 ProcessShellCommand() 时会创建一个 CChildFrame 对象，但是什么是我重写此行为的好入口点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-10T05:56:27.730

这有效，它保持从外壳等打印/打开。

```
// Parse command line for standard shell commands, DDE, file open
CCommandLineInfo cmdInfo;
ParseCommandLine(cmdInfo);

if ( cmdInfo.m_nShellCommand == CCommandLineInfo::FileNew )
{
    cmdInfo.m_nShellCommand = CCommandLineInfo::FileNothing ;
}

// Dispatch commands specified on the command line
if (!ProcessShellCommand(cmdInfo))
    return FALSE; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-09T15:55:14.607

这对我有用——改变

```
if (!ProcessShellCommand(cmdInfo)) 
```

到

```
if (cmdInfo.m_nShellCommand != CCommandLineInfo::FileNew && !ProcessShellCommand(cmdInfo)) 
```

在您应用的 InitInstance() 函数中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T18:30:20.893

在 InitInstance() 中跳过 ProcessShellCommand() 调用（在 FileNew 的情况下）确实是要走的路。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-02-12T11:19:47.830

做一件事。。

在您的 XXXApp.cpp 文件中

在这种方法中：-

注释以下行.. /*

```
 CCommandLineInfo cmdInfo;
ParseCommandLine(cmdInfo);

// Dispatch commands specified on the command line.  Will return FALSE if
// app was launched with /RegServer, /Register, /Unregserver or /Unregister.
if (!ProcessShellCommand(cmdInfo))
    return; 
```

*/

像这样....

# c# - 如何以最有效的方式读取远程 XML 文件？

> ID：187576
> 
> 赞同：2
> 
> 时间：2008-10-09T14:43:19.273
> 
> 标签：c#, xml, compact-framework, sdf, sql-server-mobile

我正在开发一个小应用程序来检索位于远程服务器（[http://xxxx.com/myfile.xml](http://xxxx.com/myfile.xml)）上的 XML 文件。这个文件比较大，它包含一个很大的地理位置列表以及我需要的其他信息用于我的应用程序。所以我远程读取了这个文件一次并将其插入到一个小的 SqlCE 文件（database.sdf）中

因此，如果我需要访问地理位置 #1，我只需在此 DATABASE 中创建一个 SELECT 语句，而不是每次都加载整个 XML 文件。

但我想知道是否可以在不使用 .sdf 文件的情况下做到这一点？

什么是最有效的方式（最快）？

如果每次我启动我的应用程序以将其加载到数据集中，则在本地保存一次大 XML 文件并加载？这会使应用程序每次加载都会有点长

在本地保存一次大 XML 文件并逐个读取节点以查找地理位置 #1 ？

或者是否可以直接从远程 xml ( [http://xxxx.com/myfile.xml](http://xxxx.com/myfile.xml) ) 检索地理位置 #1 而无需读取整个文件？

你还有其他建议吗？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-09T14:54:23.980

加载大 XML 文件，将其转换为适当的不同数据结构，以高效格式保存到文件中。（XML 真的不是非常有效。）

我相信[Marc Gravell 的 Protocol Buffers](http://code.google.com/p/protobuf-net/)实现适用于 Compact Framework ......

（没有一个 protobuf 实现被认为是生产就绪的，但有几个已经接近了。我们需要测试人员！）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-09T15:50:31.230

重新 protobuf-net，目前没有单独下载 CF 版本，但是 CF 2.0 和 CF 3.5 的源代码中都有一个 csproj。

澄清你的问题；实际上 protobuf-net 甚至不使用 .proto 文件（目前）；.proto 文件仅描述数据是什么 - protobuf-net 仅查看您的类并从中推断架构（类似于 XmlSerializer / DataContractSerializer 等的工作方式）。所以*没有*.proto - 只有看起来像您的数据的类。

但是，在您开始创建看起来像您的数据的类之前，我想知道您是否不能简单地使用 GZIP 或 [PK]ZIP 来压缩数据，并“按原样”传输它。Xml 通常压缩*得*很好。当然，为 CF 找到 GZIP（等）实现就成了问题。

当然，如果您*想*在这里使用 protobuf-net，如果您遇到问题，我会很乐意提出建议……

另一种选择是让您的 CF 应用程序调用具有本地数据的 Web 服务......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-09T17:15:57.750

你为什么要把整个文件拉到 CE 设备上呢？这是一种带宽浪费，而且无论存储格式如何，在嵌入式处理器上进行查找肯定会比在服务器*上*慢得多。您应该有一个服务（Web、WCF 或其他）允许您向它询问您想要的单一地理位置。

# c++ - 我是否需要在多线程环境中保护对 STL 容器的读取访问？

> ID：187583
> 
> 赞同：9
> 
> 时间：2008-10-09T14:47:05.007
> 
> 标签：c++, multithreading, visual-c++, stl, concurrency

我有一个 std::list<> 容器和这些线程：

*   一个无限期添加元素的作家线程。

*   一个读取器/写入器线程，在可用时读取和删除元素。

*   访问容器大小的几个读取器线程（通过使用 size() 方法）

有一个普通的互斥锁可以保护前两个线程对列表的访问。我的问题是，大小读取器线程是否也需要获取此互斥锁？我应该使用读/写互斥锁吗？

我在使用 Visual C++ 6 的 Windows 环境中。

**更新**：看起来答案还不清楚。总结主要疑问：考虑到我不需要确切的值（即我可以假设一个+/- 1 个变化）？竞争条件如何使我的 size() 调用返回无效值（即与好的值完全无关的值）？

**回答**： 通常，必须保护读者线程以避免竞争条件。尽管如此，在我看来，上述更新中提到的一些问题还没有得到解答。

提前致谢！

谢谢大家的答案！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-09T14:49:21.150

是的，读取线程需要某种互斥控制，否则写入会改变它下面的东西。

一个读写器互斥体就足够了。但严格来说，这是一个特定于实现的问题。即使在代码中只读的 const 对象中，实现也可能具有可变成员。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T15:18:12.293

查看英特尔开源[线程构建模块](http://www.threadingbuildingblocks.org/)库提供的并发容器。[在代码示例页面](http://www.threadingbuildingblocks.org/codesamples.php)上的“容器片段”下查看一些示例。它们具有用于向量、哈希映射和队列的并发/线程安全容器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T14:50:16.873

我不相信 STL 容器是线程安全的，因为没有一种跨平台处理线程的好方法。对 size() 的调用很简单，但仍需要对其进行保护。

这听起来像是一个使用读写锁的好地方。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-28T10:01:17.117

您应该考虑一些 SLT 实现可能会在调用时**计算**大小。
为了克服这个问题，您可以定义一个新变量

```
volatile unsigned int ContainerSize = 0; 
```

仅在已受保护的更新调用中更新变量，但您可以在没有保护的情况下读取/测试变量（考虑到您不需要确切的值）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-09T14:51:27.573

是的。我建议用一个强制串行访问的类来包装你的 STL 库。或者找一个已经调试过的类似类。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-09T15:04:33.833

我会说不。在这种情况下。

如果没有互斥体，您可能会发现 size() 在添加或删除项目时偶尔会返回错误值。如果这对你来说是可以接受的，那就去做吧。

但是，如果您在读者需要知道列表时需要准确的大小，那么除了 add 和 erase 调用之外，您还必须在每个 size 调用周围放置一个关键部分。

PS。VC6 size() 只返回 _Size 内部成员，因此没有互斥锁不会对您的特定实现造成问题，除非在添加第二个元素时它可能返回 1，反之亦然。

聚苯乙烯。有人提到了 RW 锁，这是一件好事，尤其是当您以后想访问列表对象时。将您的互斥锁更改为 Boost::shared_mutex 将是有益的。但是，如果您调用的只是 size()，则不需要任何互斥锁。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-10T15:05:42.057

VC++ 版本 6 中的 STL 不是线程安全的，请参阅[这个最近的问题](https://stackoverflow.com/questions/191253/what-are-some-convincing-arguments-to-upgrade-from-visual-studio-6)。所以看来你的问题有点无关紧要。即使**你**做的一切都是正确的，你可能仍然有问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-29T03:09:27.837

size() 是否安全（对于您提供的“安全”定义）取决于实现。即使您在您的平台上被覆盖，对于您的编译器版本在您的线程库版本和 C 运行时的优化级别，请不要这样编码。它会回到字节你，调试将是地狱。你正在为失败做准备。

# windows - 相当于 Unix tail 命令的 Windows

> ID：187587
> 
> 赞同：453
> 
> 时间：2008-10-09T14:48:15.240
> 
> 标签：windows, tail

我正在寻找等效于 Unix 'tail' 命令的命令，它允许我在写入日志文件时观察它的输出。

* * *

## 回答 #1

> 赞同：531
> 
> 时间：2008-10-09T16:42:34.433

如果您使用 PowerShell，则此方法有效：

```
Get-Content filenamehere -Wait -Tail 30 
```

从下面发布 Stefan 的评论，所以人们不要错过它

PowerShell 3 引入了 -Tail 参数以仅包含最后 x 行

* * *

## 回答 #2

> 赞同：143
> 
> 时间：2008-10-09T14:50:45.030

我建议安装[GNU Utilities for Win32 之](http://sourceforge.net/projects/unxutils/)类的东西。它有最喜欢的，包括尾巴。

* * *

## 回答 #3

> 赞同：69
> 
> 时间：2008-10-09T14:52:22.750

我一直使用[Baretail](http://www.baremetalsoft.com/baretail/)在 Windows 中进行拖尾。它是免费的，而且非常好。

编辑：为了更好地描述 Baretail 看到~~[这个问题](https://stackoverflow.com/questions/113121/best-tail-log-file-visualization-freeware-tool)~~

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2008-10-09T14:49:16.907

您可以将 tail 作为[Cygwin](http://cygwin.com/)的一部分。

* * *

## 回答 #5

> 赞同：25
> 
> 时间：2009-08-20T16:45:35.253

任何对使用批处理命令的~~DOS~~ CMD 尾部感兴趣的人（见下文）。

它不是完美的，有时会重复。

用法：tail.bat -d tail.bat -f -f

```
@echo off
SETLOCAL ENABLEEXTENSIONS ENABLEDELAYEDEXPANSION
rem tail.bat -d <lines> <file>
rem tail.bat -f <file>

rem ****** MAIN ******
IF "%1"=="-d" GOTO displayfile
IF "%1"=="-f" GOTO followfile

GOTO end

rem ************
rem Show Last n lines of file
rem ************

:displayfile
SET skiplines=%2
SET sourcefile=%3

rem *** Get the current line count of file ***
FOR /F "usebackq tokens=3,3 delims= " %%l IN (`find /c /v "" %sourcefile%`) DO (call SET find_lc=%%l)

rem *** Calculate the lines to skip
SET /A skiplines=%find_lc%-!skiplines!

rem *** Display to screen line needed
more +%skiplines% %sourcefile%

GOTO end

rem ************
rem Show Last n lines of file & follow output
rem ************

:followfile
SET skiplines=0
SET findend_lc=0
SET sourcefile=%2

:followloop
rem *** Get the current line count of file ***
FOR /F "usebackq tokens=3,3 delims= " %%l IN (`find /c /v "" %sourcefile%`) DO (call SET find_lc=%%l)
FOR /F "usebackq tokens=3,3 delims= " %%l IN (`find /c /v "" %sourcefile%`) DO (call SET findend_lc=%%l)

rem *** Calculate the lines to skip
SET /A skiplines=%findend_lc%-%find_lc%
SET /A skiplines=%find_lc%-%skiplines%

rem *** Display to screen line when file updated
more +%skiplines% %sourcefile%

goto followloop

:end 
```

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2008-10-09T16:10:02.237

有很多选项，但是它们都具有更高级功能的缺陷。

*   [GnuWin32 tail](http://gnuwin32.sourceforge.net/packages/coreutils.htm)是错误的（[α](http://sourceforge.net/tracker/index.php?func=detail&aid=947324&group_id=23617&atid=379173) [β](http://sourceforge.net/tracker/index.php?func=detail&aid=1189724&group_id=23617&atid=379173) [γ](http://sourceforge.net/tracker/index.php?func=detail&aid=1515129&group_id=23617&atid=379173)） - 像 -f 这样的东西根本不起作用。

*   [UnxUtils tail](http://unxutils.sourceforge.net/)似乎更好（-f 有效，但 --pid 似乎无效，-n 但不是 --lines=n 因 -f 而失败），但似乎是一个死项目。

*   [Cygwin](http://www.cygwin.com/)是一个非常丑陋的糊状物，也许可以只使用 DLL 和[coreutils 包](http://cygwin.com/packages/coreutils/)- 但仍然存在诸如 --pid 无法与本机 win32 进程一起使用的问题。

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2008-10-09T14:50:24.720

我用过[Tail For Windows](http://tailforwin32.sourceforge.net/)。当然不如使用优雅

```
尾巴
```

但是，您使用的是 Windows。;)

* * *

## 回答 #8

> 赞同：18
> 
> 时间：2008-10-09T15:30:10.350

如果您根本不想安装任何东西，您可以“构建您自己的”批处理文件，该批处理文件通过标准 Windows 命令完成这项工作。以下是有关如何执行此操作的一些指示。

1）使用**find /c /v "" yourinput.file**，获取输入文件中的行数。输出类似于：

```
---------- T.TXT: 15 
```

2) 使用**for /f**解析此输出以获取数字 15。

3）使用**set /a**，计算需要跳过的标题行数

4) 使用**for /f "skip=n"**跳过标题行并回显/处理尾行。

如果我有时间，我会建立一个这样的批处理文件并把它发回这里。

# 编辑：`tail.bat`

```
REM tail.bat
REM
REM Usage: tail.bat <file> <number-of-lines> 
REM
REM Examples: tail.bat myfile.txt 10
REM           tail.bat "C:\My File\With\Spaces.txt" 10

@ECHO OFF
for /f "tokens=2-3 delims=:" %%f in ('find /c /v "" %1') do (
    for %%F in (%%f %%g) do set nbLines=%%F )
set /a nbSkippedLines=%nbLines%-%2
for /f "usebackq skip=%nbSkippedLines% delims=" %%d in (%1) do echo %%d 
```

* * *

## 回答 #9

> 赞同：18
> 
> 时间：2009-05-08T21:04:39.507

使用 Windows PowerShell，您可以使用：

```
Get-Content <file> -Wait 
```

* * *

## 回答 #10

> 赞同：15
> 
> 时间：2011-06-16T08:09:12.843

我在这里的答案中没有看到 Log Expert。

它是可定制的，非常适合浏览日志文件。到目前为止，它是我最好的 Windows 图形日志查看器。

不幸的是，该软件不再可用。[您可以在archive.org](https://web.archive.org/web/20190609192502/http://www.log-expert.de/)上阅读有关它的信息。

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2011-01-18T09:00:48.137

我最近使用[了 Mtail](http://ophilipp.free.fr/op_tail.htm)，它似乎运行良好。这是上面提到的类似baretail 的GUI 类型。 [![在此处输入图像描述](https://i.stack.imgur.com/XBZxu.jpg)](https://i.stack.imgur.com/XBZxu.jpg)

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2008-10-09T14:54:01.810

尝试[适用于 UNIX 的 Windows 服务](http://www.microsoft.com/en-us/download/details.aspx?id=274)。提供shell、awk、sed等以及tail。

**更新**-：不幸的是，自 2019 年起，该系统在 Microsoft 下载中心不再可用。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2009-05-08T20:41:56.067

下载 tail 命令，部分`Windows Server 2003 Resource Kit Tools`来自[Microsoft](https://www.microsoft.com/en-us/download/details.aspx?id=17657)本身。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2009-04-22T11:27:25.413

我更喜欢 TailMe，因为可以在一个窗口中同时观看多个日志文件：[http ://www.dschensky.de/Software/Staff/tailme_en.htm](http://www.dschensky.de/Software/Staff/tailme_en.htm)

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2009-05-08T20:42:46.923

DOS*没有*tail命令；[您可以在此处](http://unxutils.sourceforge.net/)下载 GNU tail 和其他 GNU 工具的 Windows 二进制文件。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2009-05-08T20:45:43.343

DOS 的`type`工作类似于 *nux's `cat`，虽然就像`cat`，它确实转储了整个文件，所以它不是真正的`tail`，但它可以在紧要关头使用，而无需下载/安装真正的`tail`替代品。

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2009-05-08T20:51:06.870

另一种选择是安装[MSYS](http://www.mingw.org/)（比 Cygwin 更轻量级）。

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2011-05-24T00:31:27.273

我刚刚写了这个小批处理脚本。它不像 Unix“尾巴”那么复杂，但希望有人可以添加它来改进它，比如将输出限制为文件的最后 10 行等。如果你确实改进了这个脚本，请发送它抢劫~[at]~ gmail.com。

```
@echo off

:: This is a batch script I wrote to mimic the 'tail' UNIX command.
:: It is far from perfect, but I am posting it in the hopes that it will
:: be improved by other people. This was designed to work on Windows 7.
:: I have not tested it on any other versions of Windows

if "%1" == "" goto noarg
if "%1" == "/?" goto help
if "%1" == "-?" goto help
if NOT EXIST %1 goto notfound
set taildelay=%2
if "%taildelay%"=="" set taildelay=1

:loop
cls
type %1

:: I use the CHOICE command to create a delay in batch.

CHOICE /C YN /D Y /N /T %taildelay%
goto loop

:: Error handlers

:noarg
echo No arguments given. Try /? for help.
goto die

:notfound
echo The file '%1' could not be found.
goto die

:: Help text

:help
echo TAIL filename [seconds]

:: I use the call more pipe as a way to insert blank lines since echo. doesnt
:: seem to work on Windows 7

call | more
echo Description:
echo     This is a Windows version of the UNIX 'tail' command.
echo     Written completely from scratch by Andrey G.
call | more
echo Parameters:
echo    filename             The name of the file to display
call | more
echo    [seconds]            The number of seconds to delay before reloading the
echo                         file and displaying it again. Default is set to 1
call | more
echo ú  /?                   Displays this help message
call | more
echo    NOTE:
echo    To exit while TAIL is running, press CTRL+C.
call | more
echo Example:
echo    TAIL foo 5
call | more
echo    Will display the contents of the file 'foo',
echo    refreshing every 5 seconds.
call | more

:: This is the end

:die 
```

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2012-05-24T02:19:26.830

[Windows 资源工具包工具](https://web.archive.org/web/20200804140756/http://www.microsoft.com/en-us/download/details.aspx?id=17657)包中提供了该[`tail`](https://en.wikipedia.org/wiki/Tail_(Unix))命令和许多其他命令。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2008-10-09T14:51:17.527

如果您想使用某些 Unix 实用程序的 Win32 端口（而不是安装 Cygwin），我推荐[Win32 的 GNU 实用程序](http://unxutils.sourceforge.net/)。

比 Cygwin 更轻，更便携。

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2009-12-11T11:31:41.467

安装[MKS Toolkit](https://en.wikipedia.org/wiki/MKS_Toolkit) ... 这样您就可以在 Windows 上运行所有 Unix 命令。

命令是：

```
tail -f <file-name> 
```

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2011-07-15T05:55:19.543

在[Far Manager](https://en.wikipedia.org/wiki/Far_Manager "远经理")中，按`F3`文件进入标准查看器，然后按`End`键导航到文件末尾。

如果文件被更新，Far Manager 会自动滚动它。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2010-08-11T08:19:58.747

你也可以试试[WinTail](http://www.baremetalsoft.com/wintail/)。

㎏

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2011-02-13T12:07:51.790

我正在使用*Kiwi Log Viewer*。免费。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2011-07-01T16:40:55.580

图形日志查看器虽然可能非常适合查看日志文件，但不能满足对可合并到脚本（或批处理文件）中的命令行实用程序的需求。通常，这样一个简单且通用的命令可以用作特定环境的专用解决方案的一部分。图形方法不适合这种用途。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2011-07-01T18:27:20.957

我想我找到了一个实用程序，可以满足批处理文件中尾部功能的需求。它叫做“mtee”，而且是免费的。我已将它合并到我正在处理的批处理文件中，它的工作非常好。只需确保将可执行文件放入 PATH 语句中的目录中，然后就可以了。

这是链接：

[mtee](https://ritchielawrence.github.io/mtee/)

# .net - 没有makecert的Windows中的自签名证书？

> ID：187588
> 
> 赞同：8
> 
> 时间：2008-10-09T14:48:49.030
> 
> 标签：.net, windows, wcf, openssl, certificate

我们有一个收缩包装类型的 Windows 服务器应用程序，我们需要在服务器上创建一个自签名证书以供某些 WCF Web 服务使用。根据我们在网络上的搜索，Microsoft PlatformSDK 中的 makecert 实用程序似乎无法与我们的应用程序一起分发，因此我们正在寻找替代方案。

有谁知道如何使用 OpenSSL 创建证书并将其放入 Windows LocalMachine 证书存储区？或者，是否可以直接将证书插入 .NET 应用程序的存储中，我们是否应该只使用 openssl 创建证书文件？任何帮助/建议将不胜感激。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2010-02-16T13:41:25.047

[不幸的是，我还不能评论任何事情，所以我会发布这个作为答案。]

我看到这篇文章有点老了，但我在一条类似的船上，我在 Visual Studio 2008 redist.txt 文件中找到了这个：

```
Windows SDK Files

Subject to the license terms for the software, the following files may be distributed unmodified:

MageUI.exe
Mage.exe
Makecert.exe 
```

不确定是否发生了某些变化（如果我的解释是正确的），但看起来 makecert.exe 作为 Windows SDK 的一部分包含在内，而它又作为 VS2008 安装的一部分包含在实际上可以重新分发。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2015-06-27T14:34:13.417

您现在可以使用 PowerShell 创建自签名证书 您需要的命令是 New-SelfSignedCertificate 和 Export-PfxCertificate。例如：创建证书

```
New-SelfSignedCertificate -certstorelocation cert:\localmachine\my -dnsname orin.windowsitpro.internal 
```

导出它

```
Export-PfxCertificate -cert cert:\localMachine\my\CE0976529B02DE058C9CB2C0E64AD79DAFB18CF4 -FilePath e:\temp\cert.pfx -Password $pwd 
```

这个链接真的很有帮助

[https://www.itprotoday.com/powershell/creating-self-signed-certificates-powershell](http://windowsitpro.com/blog/creating-self-signed-certificates-powershell)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-09T14:55:27.907

呜呼！是时候给你pinvoke了

crypt32 提供了[CertCreateSelfSignCertificate](http://msdn.microsoft.com/en-us/library/aa376039.aspx)函数；如果成功，您可以将其存储在用户的个人商店中（或者假设您正在提升工作的机器商店）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-09T20:21:21.230

我没有使用过 OpenSSL，但我在同一条船上，发现这篇文章很有帮助：

[使用证书保护 WCF 服务](http://www.codeproject.com/KB/WCF/wcf_certificates.aspx)

作者将引导您安装 Microsoft 证书服务，创建可以添加到受信任证书颁发机构的 CA（在客户端和服务器上，因为它是自签名的），然后生成从自签名 CA 证书链接的客户端和服务器证书.

您不需要客户端证书，但它确实可以帮助您创建自签名 CA 和服务器证书。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-02-02T07:44:17.770

以编程方式生成证书的一种替代方法是 Bouncy Castle 的 C# 版本。 [http://www.bouncycastle.org/csharp/](http://www.bouncycastle.org/csharp/)

# visual-studio-2008 - ASP.NET 开发服务器（又名 Cassini）是否支持 SSL？

> ID：187593
> 
> 赞同：5
> 
> 时间：2008-10-09T14:49:58.373
> 
> 标签：visual-studio-2008, iis, cassini

我们正试图让我们的 .NET 开发人员使用[ASP.NET 开发服务器(VS2008) 进行 Web 开发，而不是使用](http://msdn.microsoft.com/en-us/library/58wxa9w5%28v=vs.90%29.aspx)[IIS](http://www.iis.net/)的本地实例。

我收到此回复是我们的一些开发人员无法使用它的原因：“我们的 XXXX Online Sales 应用程序使用 SSL 来保护密码。虽然 Visual Studio 确实允许在没有 IIS 的情况下进行一些基本的 Web 应用程序开发，但轻量级替换不支持SSL。”

这有意义吗？有解决办法吗？

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-09T14:53:19.520

VS 内置的 Web 服务器不支持 SSL。它是一种快速测试应用程序的方法。对于 SSL，您需要使用 IIS 并获得证书。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-10T09:19:00.817

实际上有一种可能的方法 - 如果您只想使用 SSL 运行 ASP.NET 程序，您可以使用 Cassini + Apache Http Proxy/Nginx for Windows。但如果您使用的是 Windows XP，请注意并发连接可能存在限制。

# php - 说真的，我应该编写糟糕的 PHP 代码吗？

> ID：187594
> 
> 赞同：18
> 
> 时间：2008-10-09T14:50:10.930
> 
> 标签：php, optimization, code-generation, translation

我最近在做一些 PHP 工作，在我见过的所有代码中，人们倾向于使用很少的方法。（他们也倾向于使用很少的变量，但这是另一个问题。）我想知道为什么会这样，我发现了这个注释“带有一个参数和一个空函数体的函数调用与执行 7-8 $ 所花费的时间大致相同localvar++ 操作。类似的方法调用当然是大约 15 个 $localvar++ 操作” [here](http://reinholdweber.com/?p=3)。

这是真的吗，即使 PHP 页面已被编译和缓存？我应该尽可能避免使用方法来提高效率吗？我喜欢编写组织良好、人类可读的代码，其中包含重复代码块的方法。如果需要编写没有方法的平面代码，是否有任何程序可以“内联”方法体？这样我就可以编写漂亮的代码，然后在部署之前将其丑化。

顺便说一句，我一直在查看的代码来自 Joomla 1.5 核心和几个 WordPress 插件，所以我假设他们是知道自己在做什么的人。

**注意：**我很高兴每个人都跳到这个问题上来谈论**一般**的优化，但实际上我们谈论的是解释语言中的优化。至少我们正在谈论 PHP 的事实的一些暗示会很好。

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2008-10-09T14:53:13.483

你需要多少“效率”？你还量过吗？过早的优化是万恶之源，没有度量的优化总是过早的。

还要记住[优化俱乐部的规则](http://xoa.petdance.com/Rules_of_Optimization_Club)。

1.  优化俱乐部的第一条规则是，你不要优化。
2.  优化俱乐部的第二条规则是，没有衡量就不要优化。
3.  如果您的应用程序运行速度比底层传输协议快，那么优化就结束了。
4.  一次一个因素。
5.  没有市场机器人，没有市场机器人时间表。
6.  只要需要，测试就会继续进行。
7.  如果这是您在优化俱乐部的第一个晚上，您必须编写一个测试用例。

* * *

## 回答 #2

> 赞同：57
> 
> 时间：2008-10-09T17:53:27.003

我认为 Joomla 和 Wordpress 并不是*优秀*PHP 代码的最好例子，这没有冒犯。我对从事这项工作的人没有任何个人意见，他们使人们拥有网站/博客的方式很棒，而且我知道很多人将所有空闲时间都花在了这两个项目中，但是代码质量相当差（没有冒犯的意思）。

如果您不相信我，请查看过去一年的安全公告；还假设您正在寻找两者中的任何一个的性能，他们的代码在那里也不擅长。所以这绝不是好的代码，但 Wordpress 和 Joomla 在前端都表现出色 - 非常易于使用，人们可以获得一个网站并且可以做*一些事情*。

这就是它们如此成功的原因，人们不是根据代码质量来选择它们，而是根据它们使它们能够做什么。

要回答您的性能问题，是的，确实所有好东西（函数、类等）都会减慢您的应用程序的速度。所以我想如果你的应用程序/脚本都在一个文件中，那就这样吧。随意编写*糟糕的 PHP 代码*。

一旦扩展并开始复制代码，就应该考虑编写可维护代码带来的权衡（速度）。:-)

恕我直言，由于两件事，这种权衡相当小：

1.  CPU**很**便宜。
2.  开发商**并不**便宜。

当您需要在六个月后返回您的代码时，想想如果那些纳秒节省了运行它，当您需要修复一个讨厌的错误时（三到四次，因为重复的代码）仍然加起来。

你可以做各种各样的事情来让 PHP 运行得更快。通常人们推荐一个缓存，例如[APC](http://php.net/apc)。APC真的很棒。它在后台为您运行各种优化，例如缓存 PHP 文件的字节码，还为您提供用户空间中的函数来保存数据。

因此，例如，如果您每次运行该脚本磁盘 i/o 时都解析一个配置文件，这真的很关键。使用简单的[apc_store()](http://php.net/apc_store)和[apc_fetch()](http://php.net/apc_fetch)您可以将解析的配置文件存储在基于文件或基于内存 (RAM) 的缓存中，并从那里检索它，直到缓存过期或被删除。

当然，APC 不是唯一的缓存。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2008-10-09T14:52:53.983

您应该看到对这个问题的回答：[开发人员应该首先考虑可读性还是性能？](https://stackoverflow.com/questions/183201/should-a-developer-aim-for-readability-or-performance-first)

总结共识：除非您知道（通过测试/分析）您的性能需要在某些特定领域解决的事实，否则可读性更为重要。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-10-09T14:54:03.683

在 99% 的情况下，您应该更好地担心代码的可理解性。编写易于测试、理解和维护的代码。

在性能确实很关键的少数情况下，像 PHP 这样的脚本语言不是您的最佳选择。毕竟，PHP 中的许多基础库函数都是用 C 编写的，这是有原因的。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-09T14:54:06.773

就个人而言，虽然函数调用可能会有开销，但如果这意味着我编写了一次代码（参数化），然后在 85 个地方使用它，那么我会**走得更远**，因为我可以在一个地方修复它。

脚本语言倾向于给人们这样的想法，即“足够好”和“有效”是编码时要考虑的唯一标准。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-09T18:03:57.527

特别是对于像 PHP 这样的快速解释器，我不认为缺乏可读性/可维护性是值得你可能（或可能不会！）从中获得的效率。

还有一个关于 WordPress 的说明：我已经浏览了很多 WordPress 代码。请不要假设那些人对好的代码一无所知。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-09T15:53:55.967

要回答您的第一个问题，是的，这是真的，编译的操作码也是如此。是的，您可以通过避免函数调用来使您的代码更快，除非您的代码因代码重复而变得过大的极端情况。

你应该做你喜欢做的事“我喜欢用方法编写组织良好、人类可读的代码，只要代码块会重复出现。”

如果您要犯下删除所有函数调用的可怕暴行，至少使用分析器并且只对重要的 10% 代码执行此操作。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-09T17:40:58.043

微观优化如何导致宏观放缓的一个例子：

如果您正在认真考虑手动内联函数，请考虑手动展开循环。

JMP 很昂贵，如果您可以通过展开来消除循环并消除所有条件块，那么您将消除仅仅在 CPU 缓存周围寻找所浪费的所有时间。

运行时的变量扩充也很慢，就像从数据库中提取数据一样，因此您也应该将所有数据内联到您的代码中。

实际上，加载一个解释器来仅仅执行代码并将内存复制给用户是非常浪费的，为什么我们不预先计算所有可能的页面并将每个页面存储在内存中准备好它只是一个内存副本? 那肯定很快！

啊，现在我们之间有了一个叫做互联网的慢东西，它阻碍了用户体验并限制了我们可以使用的内容量，我们如何提前预先计算页面，并将它们全部存档并在用户本地机器？那会非常快！

但这会浪费大量的 cpu 周期，还有页面加载时间和浏览器内容渲染等，我们将跳过中间人，只在印刷媒体上将页面交付给他们！天才！。

/me 眼睁睁地看着你的公司倒闭，而你却花了 10 年时间（手工）预先计算和打印没人愿意看到的页面。

这对你来说可能听起来很傻，但对我们其他人来说，你的提议就是那么荒谬。

优化是好的，但是在合理的地方划清界限，这样你就不必担心未来的代码工作人员会在你睡梦中跟踪你，因为有一个无法维护的糟糕代码库。

**注意：**是的，我使用 gentoo。你怎么猜的？

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-09T14:58:05.657

当然，您不应该编写糟糕的 PHP 代码。但是一旦你写了不好的东西，你可能总是以性能为借口:-)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-09T15:03:00.547

这是过早的优化。虽然函数调用的成本高于增加局部整数变量的说法是正确的（几乎所有的成本都更高），但与数据库查询相比，函数调用的成本仍然非常低。

也可以看看：

[维基百科 -> 优化 -> 何时优化](http://en.wikipedia.org/wiki/Optimization_(computer_science)#When_to_optimize)

[c2.com Wiki -> 过早优化](http://c2.com/cgi/wiki?PrematureOptimization)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-09T15:41:28.750

PHP 的主要优势在于它可以快速轻松地获得一个工作应用程序。这种优势来自于编写松散（糟糕）代码并使其仍然以某种预期方式运行的机会。

如果您需要节省一些 CPU 周期，那么您不应该使用 PHP。当 PHP Web 应用程序性能不佳时，更有可能是由于查询效率低下，而不是代码执行速度。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-09T16:28:03.633

如果您担心效率的每一点，那么您到底为什么要使用脚本语言？您应该使用一种更快的语言进行编程（在此处插入您最喜欢的编译语言），这可能会导致代码的可读性越来越多，但它会运行得非常快，并且您仍然可以瞄准最佳编码实践。

说真的，如果您正在为运行速度编码，那么您根本不应该使用 PHP。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-07T03:53:02.590

如果您使用 MVC 架构模式开发 Web 应用程序，您可以从缓存和序列化中受益匪浅。您可以缓存视图或其中的一部分，并且可以序列化模型。

根据经验，模型通常会解析并生成大部分正在显示的数据。如果您知道某个模型不会频繁生成新数据，例如解析 RSS 提要的模型，您可以将所有解析的数据填充到某个地方，并每隔一段时间刷新一次。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-27T08:45:12.520

如果您查看 wordpress php 代码，它会在其 html 之间混合 php 标签，这导致我想到意大利面条。

然而，Phpbb3 在这方面要好得多。例如，它在 php 部分和样式部分之间有严格的划分，样式部分是带有 {template} 标签的 xhtml 格式文件，由模板引擎解析。哪个更干净。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-10-09T22:30:16.600

**编写几个 10 分钟的示例并在您的分析器中运行它们。**

这会告诉你哪个更快到毫秒。

如果您没有分析器，请在此处发布它们，我将在我的 PHPEd 分析器中运行它们。

我怀疑大部分时间差异（如果有的话）来自必须打开存储类的文件，但这也必须进行测试。

然后问问自己，你是否在乎几毫秒而不是维护意大利面条式代码——你的用户会注意到吗？

**编辑**

分析器不会模拟高流量，但它会告诉您哪种方法对单个用户更快，以及代码的哪些部分使用了多少时间。特别是如果您对重复执行的操作进行概要分析 - 例如在循环中每次执行 1000 次。

我们可以假设（尽管并非总是如此）很多人使用的更快的代码会比很多人使用的慢速代码更快。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-10-22T09:15:39.810

给你讲代码微优化的人，一般都是每页有 50 个 SQL 查询，总共需要 2 秒，因为他们从来没有听说过 profiling。但是他们的代码被优化了！！！（而且慢得要命）

事实：添加另一个网络服务器并不困难。复制数据库是。如果优化网络服务器代码增加了数据库的负载，那么它可能会造成净损失。

注意：包括 SQL 在内的简单页面（如论坛主题）的 2-3 毫秒对于 PHP 网站来说是一个很好的目标。我的旧网站曾经这样做过。

# unit-testing - VS 2008 #if 用于单元测试的条件语句

> ID：187602
> 
> 赞同：1
> 
> 时间：2008-10-09T14:51:21.817
> 
> 标签：unit-testing, visual-studio-2008

是否有类似“#if DEBUG”的条件语句可以在 VS 2008 中用于确定代码是否从单元测试中运行？（我们正在使用 MS 的内置单元测试。）

例如：

`#if !UNITTEST`

`// Do some GUI stuff we don't want to see when unit testing`

`#endif`

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-09T14:57:11.757

我同意一般情况下避免这样做的评论 - 但我过去自己也这样做过。IIRC，它被用来在“单元测试数据库”（即一次性）和“包含有用数据的测试数据库”之间切换——它被单元测试意外擦除了太多次......

我们的解决方案是拥有一个具有单个静态属性“InUnitTest”的 UnitTestDetector 类（或类似的东西）。这将通过 NUnit 是否加载到当前的 appdomain 中来检测（同样，IIRC）。在第一次探测之后，结果将被缓存以防止它成为性能损失。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-09T14:57:54.783

您所说的条件语句不可用，因为它是编译器指令；您必须有一个特定于测试的构建，您可以定义自己的 TEST 编译器指令。但是，正如评论者所指出的 - 您不应该为测试运行与生产中不同的代码，这违背了目的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T15:09:57.443

谢谢你。避免使用特定于单元测试的代码是我计划采用的方法，但被告知要查看这条路线以防万一。现在我不会了！:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-09T14:56:09.060

请注意，任何此类定义仅在编译时才有意义。因此，您必须以一种方式编译它以获取代码，并以另一种方式来删除该代码。因此，您的代码将“感觉到”它正在由单元测试框架运行。您需要两个单独的程序集。如果这真的是你想要的，那么定义一个符号就很容易了。只需转到项目属性的“构建”选项卡，然后在条件编译符号下添加“UNITTEST”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-15T22:01:58.250

为克里斯的回答 +1。这听起来像是“Test Fake”或“Test Double”类型课程的好地方。您能否将要隐藏的 GUI 内容提取到虚拟或抽象方法中，然后（在您的测试项目中）创建一个派生自被测类并覆盖 GUI 代码的类？

# project-management - 软件项目经理：纯技术背景的数量和质量最好是多少？

> ID：187608
> 
> 赞同：2
> 
> 时间：2008-10-09T14:53:10.363
> 
> 标签：project-management

我们正在考虑招聘一名软件开发项目经理。他的工作将是管理多个专注于为外部客户交付软件的专门项目团队。他还需要为我们的业务开发部门提供支持，并监督上述软件的实施后支持。我们应该期望申请者具备什么样的开发经验水平？成功的候选人不需要做任何编码。

1.  不重要。我们应该专注于软件领域经过验证的项目管理经验。
2.  没有任何。
3.  一些经验，确切的技术并不重要。
4.  丰富的经验，确切的技术并不重要。
5.  一些涉及我们每天在这里使用的首字母缩略词的经验。
6.  涉及与我们每天在这里使用的相同首字母缩略词的丰富经验。
7.  一些经验，主要是我们不使用的技术。
8.  丰富的经验，主要是我们不使用的技术。

这个问题是关于所需技术经验的最佳水平和质量，与软件项目经理的任何其他技能和资格无关。非常感谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-09T22:35:34.157

与任何职位一样，您首先需要评估团队需要哪些技能和经验才能取得成功。然后雇用来填补您团队中尚未具备的技能的空白。

如果您已经拥有一支拥有强大技术和技术领导技能的团队，那么您不需要雇用可能与您已有的人竞争的人。如果您错过了这一点，您可能需要聘请具有一些项目规划和跟踪技能的技术经理。

伟大的项目经理是那些跨学科的——他们是最成功的，他们可以弥合不同利益相关者和团队之间的鸿沟。项目经理的主要职责是管理风险并促进沟通和协作。至少，您应该寻找在您的行业或您所从事的技术领域具有丰富经验的人，否则他们将无法获得团队其他成员的尊重并发挥他们的主要作用。

这让我想到了你应该仔细考虑的另一件事——你的文化是什么？例如，在之前的工作中，我们的开发主管在技术上非常强大且任性。项目经理总是被降级为第二任主席，并且几乎最终成为了美化的 MS Project 管理员。助手。任何好人都没有停留太久。你需要做些什么来让你想要为团队获得的技能类型蓬勃发展？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T14:59:07.073

我们的大多数项目经理的技术经验为零，所以我猜他们的技能组合差异很大，没有必要。然而，他们必须足够聪明才能掌握/学习开发中涉及的概念——而不是实现。

这并不是说技术背景是一件坏事——它可能是“很高兴拥有”。再说一次，它可能会妨碍他们，他们可以尝试控制实施。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-09T15:00:13.547

根据我的经验，我遇到过的最优秀的技术经理都拥有非常强大的技术背景（而且通常有点不愿意用羊群代码换成羊群编码员）。最糟糕的是那些充其量只是普通程序员并且具有更多管理背景的人。

我由此得出的初步结论是，虽然并非所有程序员都是管理人员，但所有优秀的技术经理都是从优秀的程序员开始的。

请注意，这个答案更多地来自聘请工程主管的角度。对于项目经理 - 其工作是在技术人员和客户之间进行交互的人 - 技术敏锐度可能不是必需的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-09T15:05:23.787

一些技术技能会很好，但更重要的是他们了解您公司所在的功能领域。因此，如果您销售操作系统，那么您可能需要比编写银行软件更强大的技术技能。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-09T15:06:21.863

继续第 1 点。“不重要。我们应该专注于软件领域经过验证的项目管理经验。”

**编辑：（**在重新阅读您的介绍段之后）似乎您想要的是*产品*经理，并且在支持方面，您需要不同团队的团队负责人来处理和报告技术问题。（另外，由于涉及到客户联系：一点营销经验也不会受到伤害！）

作为旁白：

你专注于错误的技能组合。您需要经过验证的管理技能；成熟的组织能力；最重要的是：经过验证的人际交往能力-（s）他必须能够在不与观众对抗或光顾的情况下进行交流。技术人员和编程人员将拥有所有必要的开发经验。(S)他必须能够有效地管理和控制这些工作人员。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-06T16:58:38.200

经理必须能够与开发人员沟通。这要么需要良好的技术背景，尽管不一定具有相同的技术，要么需要足够的谦逊来知道开发人员何时比经理更了解某事。我已经看到两者都运作良好。

我认为我所说的是尊重开发人员很重要，并且有两种途径：了解他们所做的事情，或者了解您不了解他们所做的事情。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-12-18T12:57:34.510

答案是“4”。

*对某些*技术的丰富经验至关重要。我知道这种心态是“项目经理不必懂技术，他只管人”。

嗯，不，PM 不管理人：他管理的*项目*应该产生一些至少在某些期望方面（能力、性能、可靠性、安全性、可维护性等）可接受的可交付成果。如果他不懂技术，他就迷路了。当然，他不必是项目中使用的特殊技术方面的专家：但他必须能够过滤掉 BS，质疑程序员的估计（我们知道这些估计是怎么回事），至少能感受到这里的技术风险或在那里，能够制定特定技术的业务分支。

在某些方面，我认为 PM 对技术的挑战甚至比程序员更大：他必须对技术真正感兴趣，但他不能/不应该有任何技术偏执，才能真正公平地对待他们（他们是什么实际上有好处，它们实际上不适合什么）。

阅读“寻找愚蠢”以了解非技术经理如何将许多科技公司推倒在地。

这是 Spolsky 的精彩总结：http: [//www.joelonsoftware.com/articles/Stupidity.html](http://www.joelonsoftware.com/articles/Stupidity.html)

现在，小字#1：当然，不是每个程序员都会成为一名优秀的 PM。简而言之，控制狂、恶毒的人、自大狂、擅长编码但不擅长谈判的人、擅长编码但太容易屈服于压力的人——都会对他们的项目进行 FUBR。

小字#2：具有非常好的分析能力的人可能会弥补技术经验的不足。我曾与优秀的业务流程和程序设计师合作过，他们本能地理解 UI 应该如何组织，软件应该在这个特定的地方做什么，以及为什么以及即使在由领域专家提供服务的情况下，谁能快速检测到 BS，但谁如果他们的生活依赖于它，就无法编程。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-02-04T04:36:21.597

大多数已经回答了，但我会添加这个：

保持与雇用办公室经理时相同的心态。虽然技术知识很重要，但您会发现雄心、学习意愿以及团队领导的态度将使您成为比主要关注技术知识的更好的经理。大多数项目都涉及一些公司/行业特定的技能，快速学习者/伟大的领导者将迅速弥合这一差距。

# delegates - 将代理与 Exchange Web 服务一起使用

> ID：187614
> 
> 赞同：1
> 
> 时间：2008-10-09T14:54:03.387
> 
> 标签：delegates, exchange-server, exchangewebservices

有没有人在 exchnage Web 服务中使用过代表？我希望一位用户能够控制其他用户在 Exchange 中的日历。我发现这个问题有点棘手，我想看看其他人是如何让它正常工作的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-06T09:45:31.147

我刚刚开始，但我设法通过委托帐户访问资源日历。

我使用了[这篇文章中](http://msexchangeteam.com/archive/2007/12/13/447731.aspx)关于委托帐户和资源帐户的建议。（资源帐户很棘手，因为它们在 AD 中被禁用，您必须使用委托帐户才能访问它们）

在服务器上设置委托帐户后，我使用委托帐户的凭据设置 ExchangeServerBinding：

```
ExchangeServiceBinding binding = new ExchangeServiceBinding();
binding.Url = @"https://dc1.litwareinc.com/ews/exchange.asmx";
// Setup binding with username and password of the delegate account
binding.Credentials = 
    new NetworkCredential(delegateuserName, delegatepassword, "litwareinc.com"); 
```

（*我正在使用微软准备的虚拟服务器映像进行测试*）

然后在访问邮箱时，我设置了一个 FindItemType 请求，并使用我要访问的账户的 smtp 地址：

```
// Prepare request
var findItemRequest = new FindItemType();
// Setup the mailbox using the smtp address of the account wanted
var mailbox = new EmailAddressType {EmailAddress = mailboxId};
findItemRequest.ParentFolderIds = 
    new[] {new DistinguishedFolderIdType {Mailbox = mailbox}};
((DistinguishedFolderIdType) findItemRequest.ParentFolderIds[0]).Id = 
    DistinguishedFolderIdNameType.calendar;
findItemRequest.Traversal = ItemQueryTraversalType.Shallow;

// Add ItemResponseShapeType and Calendarview to request here ...

// The create a FindItemResponseType using the binding and the request
var response = binding.FindItem(findItemRequest); 
```

简而言之：

1.  在 Exchange 服务器上设置具有委托访问权限的帐户，这可以通过 owa 或 Exchange Shell 脚本完成
2.  在 ExchangeServiceBinding 对象上使用具有委托访问权限的帐户
3.  使用 FindItemType 访问目标帐户，目标帐户 smtp-addres 作为 EmailAddressType

问候杰斯珀豪格

# javascript - 是否有用于为页面生成“目录”的 JavaScript 解决方案？

> ID：187619
> 
> 赞同：30
> 
> 时间：2008-10-09T14:54:31.700
> 
> 标签：javascript

我`<h1>`通过`<h6>`标签有标题。有没有一种方法可以使用 JavaScript 为也用作锚标记的内容生成目录？

我希望输出类似于：

```
<ol>
    <li>Header 1</li>
    <li>Header 1</li>
        <li>Header 2</li>
            <li>Header 3</li>
</ol> 
```

我目前没有使用 JavaScript 框架，但我不明白为什么我不能使用它。

我也在寻找完成的事情，因为我猜这是一个常见的问题，但如果不是，我自己的起点会很好。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-10-09T15:59:43.427

我忍不住把一个快速的实现放在一起。

在页面的任意位置添加以下脚本：

```
window.onload = function () {
    var toc = "";
    var level = 0;

    document.getElementById("contents").innerHTML =
        document.getElementById("contents").innerHTML.replace(
            /<h([\d])>([^<]+)<\/h([\d])>/gi,
            function (str, openLevel, titleText, closeLevel) {
                if (openLevel != closeLevel) {
                    return str;
                }

                if (openLevel > level) {
                    toc += (new Array(openLevel - level + 1)).join("<ul>");
                } else if (openLevel < level) {
                    toc += (new Array(level - openLevel + 1)).join("</ul>");
                }

                level = parseInt(openLevel);

                var anchor = titleText.replace(/ /g, "_");
                toc += "<li><a href=\"#" + anchor + "\">" + titleText
                    + "</a></li>";

                return "<h" + openLevel + "><a name=\"" + anchor + "\">"
                    + titleText + "</a></h" + closeLevel + ">";
            }
        );

    if (level) {
        toc += (new Array(level + 1)).join("</ul>");
    }

    document.getElementById("toc").innerHTML += toc;
}; 
```

您的页面结构应如下所示：

```
<body>
    <div id="toc">
        <h3>Table of Contents</h3>
    </div>
    <hr/>
    <div id="contents">
        <h1>Fruits</h1>
        <h2>Red Fruits</h2>
        <h3>Apple</h3>
        <h3>Raspberry</h3>
        <h2>Orange Fruits</h2>
        <h3>Orange</h3>
        <h3>Tangerine</h3>
        <h1>Vegetables</h1>
        <h2>Vegetables Which Are Actually Fruits</h2>
        <h3>Tomato</h3>
        <h3>Eggplant</h3>
    </div>
</body> 
```

[您可以在https://codepen.io/scheinercc/pen/KEowRK](https://codepen.io/scheinercc/pen/KEowRK)看到它的实际效果（旧链接： http: [//magnetiq.com/exports/toc.htm](http://magnetiq.com/exports/toc.htm)（适用于 IE、FF、Safari、Opera））

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2013-10-04T15:24:00.713

这是一个很棒的脚本：

[https://github.com/matthewkastor/html-table-of-contents/wiki](https://github.com/matthewkastor/html-table-of-contents/wiki)

要使用它：

1.  添加这个标签：

    ```
    <script src="./node_modules/html-table-of-contents/src/html-table-of-contents.js" type="text/javascript"> 
    ```

2.  调用函数，例如在你的 body 的 onload 属性中：

    ```
    <body onload="htmlTableOfContents();"> 
    ```

以下是生成方法的定义：

```
/**
 * Generates a table of contents for your document based on the headings
 *  present. Anchors are injected into the document and the
 *  entries in the table of contents are linked to them. The table of
 *  contents will be generated inside of the first element with the id `toc`.
 * @param {HTMLDOMDocument} documentRef Optional A reference to the document
 *  object. Defaults to `document`.
 * @author Matthew Christopher Kastor-Inare III
 * @version 20130726
 * @example
 * // call this after the page has loaded
 * htmlTableOfContents();
 */
function htmlTableOfContents (documentRef) {
    var documentRef = documentRef || document;
    var toc = documentRef.getElementById('toc');
    var headings = [].slice.call(documentRef.body.querySelectorAll('h1, h2, h3, h4, h5, h6'));
    headings.forEach(function (heading, index) {
        var anchor = documentRef.createElement('a');
        anchor.setAttribute('name', 'toc' + index);
        anchor.setAttribute('id', 'toc' + index);

        var link = documentRef.createElement('a');
        link.setAttribute('href', '#toc' + index);
        link.textContent = heading.textContent;

        var div = documentRef.createElement('div');
        div.setAttribute('class', heading.tagName.toLowerCase());

        div.appendChild(link);
        toc.appendChild(div);
        heading.parentNode.insertBefore(anchor, heading);
    });
}

try {
     module.exports = htmlTableOfContents;
} catch (e) {
    // module.exports is not defined
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-09T15:01:56.943

JQuery 被认为是一种快速简便的解决方案。快速谷歌搜索*jquery 目录会*产生两个有希望的结果：

*   [jqTOC](http://solidgone.org/jqtoc)
*   [关于如何手动执行此操作的文章](http://www.packtpub.com/article/using-jquery-script-for-creating-dynamic-table-of-contents)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2015-09-30T13:18:30.933

我已经修改了 AtesGoral 接受的答案中的函数，以输出正确的嵌套列表和有效的 HTML5。

只需将以下代码添加到您的脚本并`TableOfContents(container, output);`在加载时调用，其中*容器*是您的内容元素的类或 ID，*输出*是 TOC 元素的类或 ID。默认值分别为“#contents”和“#toc”。

有关工作演示，请参阅[http://codepen.io/aufmkolk/pen/RWKLzr 。](http://codepen.io/aufmkolk/pen/RWKLzr)

```
function TableOfContents(container, output) {
var toc = "";
var level = 0;
var container = document.querySelector(container) || document.querySelector('#contents');
var output = output || '#toc';

container.innerHTML =
    container.innerHTML.replace(
        /<h([\d])>([^<]+)<\/h([\d])>/gi,
        function (str, openLevel, titleText, closeLevel) {
            if (openLevel != closeLevel) {
                return str;
            }

            if (openLevel > level) {
                toc += (new Array(openLevel - level + 1)).join('<ul>');
            } else if (openLevel < level) {
                toc += (new Array(level - openLevel + 1)).join('</li></ul>');
            } else {
                toc += (new Array(level+ 1)).join('</li>');
            }

            level = parseInt(openLevel);

            var anchor = titleText.replace(/ /g, "_");
            toc += '<li><a href="#' + anchor + '">' + titleText
                + '</a>';

            return '<h' + openLevel + '><a href="#' + anchor + '" id="' + anchor + '">'
                + titleText + '</a></h' + closeLevel + '>';
        }
    );

if (level) {
    toc += (new Array(level + 1)).join('</ul>');
}
document.querySelector(output).innerHTML += toc;
}; 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2016-12-11T11:20:29.270

我真的很喜欢[d13 的回答](https://stackoverflow.com/a/19185002)，但想稍微改进一下以使用 html5 符号并保留标题的现有 ID：

```
document.addEventListener('DOMContentLoaded', function() {
    htmlTableOfContents();
} );                        

function htmlTableOfContents( documentRef ) {
    var documentRef = documentRef || document;
    var toc = documentRef.getElementById("toc");
//  Use headings inside <article> only:
//  var headings = [].slice.call(documentRef.body.querySelectorAll('article h1, article h2, article h3, article h4, article h5, article h6'));
    var headings = [].slice.call(documentRef.body.querySelectorAll('h1, h2, h3, h4, h5, h6'));
    headings.forEach(function (heading, index) {
        var ref = "toc" + index;
        if ( heading.hasAttribute( "id" ) ) 
            ref = heading.getAttribute( "id" );
        else
            heading.setAttribute( "id", ref );

        var link = documentRef.createElement( "a" );
        link.setAttribute( "href", "#"+ ref );
        link.textContent = heading.textContent;

        var div = documentRef.createElement( "div" );
        div.setAttribute( "class", heading.tagName.toLowerCase() );
        div.appendChild( link );
        toc.appendChild( div );
    });
}

try {
    module.exports = htmlTableOfContents;
} catch (e) {
    // module.exports is not defined
} 
```

您可以通过在标题中包含脚本来使用它。

很棒的是，您可以在目录中使用样式表：

```
<style>
    #toc div.h1 { margin-left: 0 }
    #toc div.h2 { margin-left: 1em }
    #toc div.h3 { margin-left: 2em }
    #toc div.h4 { margin-left: 3em }
</style> 
```

在我的个人脚本中，我使用了一个稍微不同的选择器：

```
var headings = [].slice.call(documentRef.body.querySelectorAll("article h1, article h2, article h3, article h4, article h5, h6")); 
```

主页保留在内部`<article></article>`，脚本将仅在主要文章中搜索标题。我可以在目录中使用标题，例如`<nav id="toc"><h3>Table of contents</h3></nav>`在页脚/页眉中，而不在目录中显示它。

在下面的评论中，[Gabriel Hautclocq](https://stackoverflow.com/users/1076652/gabriel-hautclocq)对文章代码进行了优化。他还指出，这并不是严格意义上的列表，而是类似列表的 div 结构，更简单，生成的代码更短。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2018-07-13T22:03:13.733

所以我对@Ates Goral 和@Hendrik 提供的答案有疑问，我使用了所见即所得的方法，它在H1-h6 元素中添加了一些html 片段，例如br 标签和其他元素。因此代码中断并且不将其识别为有效的 h 元素，因为它与搜索模式不匹配。还有一些 WYSIWYG 会留下空的 h 标签，因为它们没有内容，所以不会被排除在外。随之而来的各种修改经常会遇到同样的问题。我修复的一个主要错误是，如果您有一个标题，并且文本相同，它只会引用@Ates Goral 和@Hendrik 提供的第一个解决方案

我应该说，如果您从存储在数据库中的数据生成目录，则此解决方案很好。我使用了上面的一些解决方案并以此为基础，尤其是@Ates Goral 和@Hendrik

```
function TableOfContents(container, output) {
        var txt = "toc-"; 
        var toc = "";
        var start = 0;
        var output = output || '#toc';

        var container = document.querySelector(container) || document.querySelector('#contents');
        var c = container.children;

        for (var i = 0; i < c.length; i++) {
        var isHeading = c[i].nodeName.match(/^H\d+$/) ;
        if(c[i].nodeName.match(/^H\d+$/)){
            var level = c[i].nodeName.substr(1);
// get header content regardless of whether it contains a html or not that breaks the reg exp pattern
            var headerText = (c[i].textContent);
// generate unique ids as tag anchors
            var anchor = txt+i;

            var tag = '<a href="#' + anchor + '" id="' + anchor + '">' + headerText + '</a>';

            c[i].innerHTML = tag;

            if(headerText){
                if (level > start) {
                    toc += (new Array(level - start + 1)).join('<ul>');
                } else if (level < start) {
                    toc += (new Array(start - level + 1)).join('</li></ul>');
                } else {
                    toc += (new Array(start+ 1)).join('</li>');
                }
                start = parseInt(level);
                toc += '<li><a href="#' + anchor + '">' + headerText + '</a>';
            }
        }
    }
    if (start) {
        toc += (new Array(start + 1)).join('</ul>');
    }
    document.querySelector(output).innerHTML += toc;
}

document.addEventListener('DOMContentLoaded', function() {
    TableOfContents();
  }
  ); 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2021-05-16T00:30:27.920

这是我为工作而想出的目录的香草 JavaScript 版本。

它查找指定内容容器中的所有标题并为它们创建 ID，然后生成 TOC 链接。我让它添加样式类并使用嵌套列表来创建层次结构。

```
window.addEventListener('DOMContentLoaded', function (event) { // Let the DOM content load before running the script.
//Get all headings only from the actual contents.
var contentContainer = document.getElementById('content'); // Add this div to the html
var headings = contentContainer.querySelectorAll('h1,h2,h3,h4'); // You can do as many or as few headings as you need.

var tocContainer = document.getElementById('toc'); // Add this div to the HTML
// create ul element and set the attributes.
var ul = document.createElement('ul');

ul.setAttribute('id', 'tocList');
ul.setAttribute('class', 'sidenav')

// Loop through the headings NodeList
for (i = 0; i <= headings.length - 1; i++) {

    var id = headings[i].innerHTML.toLowerCase().replace(/ /g, "-"); // Set the ID to the header text, all lower case with hyphens instead of spaces.
    var level = headings[i].localName.replace("h", ""); // Getting the header a level for hierarchy
    var title = headings[i].innerHTML; // Set the title to the text of the header

    headings[i].setAttribute("id", id)  // Set header ID to its text in lower case text with hyphens instead of spaces.

    var li = document.createElement('li');     // create li element.
    li.setAttribute('class', 'sidenav__item') // Assign a class to the li

    var a = document.createElement('a'); // Create a link
    a.setAttribute("href", "#" + id) // Set the href to the heading ID
    a.innerHTML = title; // Set the link text to the heading text

    // Create the hierarchy
    if(level == 1) {
        li.appendChild(a); // Append the link to the list item
        ul.appendChild(li);     // append li to ul.
    } else if (level == 2) {
        child = document.createElement('ul'); // Create a sub-list
        child.setAttribute('class', 'sidenav__sublist')
        li.appendChild(a); 
        child.appendChild(li);
        ul.appendChild(child);
    } else if (level == 3) {
        grandchild = document.createElement('ul');
        grandchild.setAttribute('class', 'sidenav__sublist')
        li.appendChild(a);
        grandchild.appendChild(li);
        child.appendChild(grandchild);
    } else if (level == 4) {
        great_grandchild = document.createElement('ul');
        great_grandchild.setAttribute('class', 'sidenav__sublist');
        li.append(a);
        great_grandchild.appendChild(li);
        grandchild.appendChild(great_grandchild);
    }
}

toc.appendChild(ul);       // add list to the container

// Add a class to the first list item to allow for toggling active state.
var links = tocContainer.getElementsByClassName("sidenav__item");

links[0].classList.add('current');

// Loop through the links and add the active class to the current/clicked link
for (var i = 0; i < links.length; i++) {
    links[i].addEventListener("click", function() {
        var current = document.getElementsByClassName("current");
        current[0].className = current[0].className.replace(" current", "");
        this.className += " current";
    });
}
}); 
```

我在[CodePen](https://codepen.io/cgurski/pen/qBrNrPo)上有一个演示。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-09T14:59:27.743

您是在寻找预先打包的解决方案，还是在询问如何实施？

对于后者，您可以使用~~`getElementsByTagName()`递归地`<h1>`通过`<h6>`~~XPath 遍历所有`<h*>`元素并构造相应的嵌套`<ul>`或`<ol>`列表。您还必须将`<a>`标签添加到标题中。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-09T15:07:05.233

在此页面上查看您正在寻找的组件：[重新发明 XMLHttpRequest：具有嗅探功能的跨浏览器实现](http://www.ilinsky.com/articles/XMLHttpRequest/)

它遍历整个文档并创建一个目录，其中所有 h1-h6 元素都反映在一个可打开的（悬停时）结构中。该组件是独立的，它不使用任何库。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-05-19T22:33:02.693

```
 let headers = document.querySelectorAll('h1,h2,h3,h4,h5,h6');
  let list    = document.createElement('ol');

  let _el = list;
  for(i=0; i<headers.length; i++) {
    while(_el) {
      let li = document.createElement('li');
      li.innerText = headers[i].innerText;
      li.setAttribute('tagName', headers[i].tagName);
      if(_el.getAttribute('tagName') < headers[i].tagName) {
        let ol = _el.children.length > 0 ? ol = _el.querySelector('ol') : document.createElement('ol');
        ol.appendChild(li);
        _el.appendChild(ol);
        _el = li;
        break;
      } else {
        if(_el.tagName == 'OL') {
         _el.appendChild(li);
         _el = li;
         break;
        } else if (!_el.parentNode.parentNode) {
          _el.parentNode.appendChild(li);
          _el = li;
          break;
        }
        else {
          _el = _el.parentNode.parentNode;
        }
      }
    }
  }
  console.log(list); 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-05-19T23:43:47.767

```
 this.insert = (el, h) => {
    let li = document.createElement('li');
    li.innerText = h.innerText;
    li.setAttribute('tagName', h.tagName);
    if(el.tagName == 'OL') {
      el.appendChild(li);
      return li;
    } else if(el.getAttribute('tagName') < h.tagName) {
      let ol = el.children.length > 0 ? ol = el.querySelector('ol') : document.createElement('ol');
      ol.appendChild(li);
      el.appendChild(ol);
      return li;
    } else if(!el.parentNode.parentNode) {
      el.parentNode.appendChild(li);
      return li;
    } else {
      return this.insert(el.parentNode.parentNode, h);
    }
  }

  this.parse = (headers) => {
    let list = document.createElement('ol');
    let el = list;
    for(i=0; i<headers.length; i++) {
      el = this.insert(el, headers[i]);
    }
    return list;
  }
  let headers = document.querySelectorAll('h1,h2,h3,h4,h5,h6');
  let toc = this.parse(headers);
  console.log(toc); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-04-20T19:10:42.890

这是一个基于 jQuery 的函数，它分析标题元素`<h1>`，`<h2>`... 在提供的内容中并返回带有 TOC 层次结构的 jQuery 对象，您可以将其附加到页面：

```
<div class="table_of_contents">
    <ul>
        <a href="#Level1_Heading">Level1 Heading</a>
        <li>
            <a href="#Level2_Heading">Level2 Heading</a>
            <ul>
                ...
        </li>
    </ul>
</div> 
```

它还`$content`通过插入不可见`<a name="...">`的锚点进行修改，用户在单击创建的 TOC 项目时将跳转到这些锚点。

```
function generate_toc($content) {
    let $toc = $("<div>", {class: "table_of_contents"});
    let level2$toc_item = {0: $toc};
    let used_anchors = {};
    $content.find("h1, h2, h3, h4, h5").each(function() {
        // find out the level of heading
        let level = parseInt($(this).prop("tagName").replace(/[^0-9]/gi, ""));
        let heading_text = $(this).text();
        // define the unique anchor id
        let heading_anchor = heading_text.replace(/[^a-z0-9]/gi, "_");
        while (heading_anchor in used_anchors) {heading_anchor += "_";}
        used_anchors[heading_anchor] = true;                
        // add target point into main content
        $(this).prepend($("<a>", {name: heading_anchor}));
        // find the parent level for TOC item
        let parent_level = level-1;
        for (; !(parent_level in level2$toc_item); parent_level--); 
        // remove all jumped over levels
        for (let l in level2$toc_item) {
            if (parseInt(l) > parent_level) {
                delete level2$toc_item[l];
            }
        }
        let $parent = level2$toc_item[parent_level];
        // create new TOC item inside parent's <ul>
        level2$toc_item[level] = $("<li>").appendTo(
            $parent.children("ul").length == 1
            ? $($parent.children("ul")[0])
            : $("<ul>").appendTo($parent)
        ).append($("<a>", {href: `#${heading_anchor}`}).text(heading_text));
    });
    return $toc;
} 
```

使用示例：

```
$("body").prepend(generate_toc("body")); 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-09-20T20:07:21.823

关键是捕获标题的数据并将其转换为对象，^(请参见下面的代码)。 ^(`TocItem`)

至于 TOC 表示，可以使用[ul](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/ul)或者依赖[markmap.js](https://markmap.js.org/)、[d3.js](https://github.com/d3/d3)等生成。

### 核心代码

```
/**
 * @param {string} text
 * @param {int} level
 * @param {TocItem} parent
 * */
function TocItem(text, level, parent = undefined) {
  this.text = text
  this.level = level
  this.id = undefined
  this.parent = parent
  this.children = []
}

/**
* @param {[HTMLHeadingElement]} headingSet
* */
function parse(headingSet) {
  const tocData = []
  let curLevel = 0
  let preTocItem = undefined

  headingSet.forEach(heading => {
    const hLevel = heading.outerHTML.match(/<h([\d]).*>/)[1]
    const titleText = heading.innerText

    switch (hLevel >= curLevel) {
      case true:
        if (preTocItem === undefined) {
          preTocItem = new TocItem(titleText, hLevel)
          tocData.push(preTocItem)
        } else {
          const curTocItem = new TocItem(titleText, hLevel)
          const parent = curTocItem.level > preTocItem.level ? preTocItem : preTocItem.parent
          curTocItem.parent = parent
          parent.children.push(curTocItem)
          preTocItem = curTocItem
        }
        break
      case false:
        // We need to find the appropriate parent node from the preTocItem
        const curTocItem = new TocItem(titleText, hLevel)
        while (1) {
          if (preTocItem.level < curTocItem.level) {
            preTocItem.children.push(curTocItem)
            preTocItem = curTocItem
            break
          }
          preTocItem = preTocItem.parent

          if (preTocItem === undefined) {
            tocData.push(curTocItem)
            preTocItem = curTocItem
            break
          }
        }
        break
    }

    curLevel = hLevel

    if (heading.id === "") {
      heading.id = titleText.replace(/ /g, "-").toLowerCase()
    }
    preTocItem.id = heading.id
  })

  return tocData
} 
```

### 例子

```
<style>
  /* CSS is not necessary. That is for look better and easy to test. */

  /* Longer pages, so you can test to see if you can actually get to the specified location after clicking. */
  body {
    min-height: 160rem
  }

  /* similar to the bootstrap */
  .fixed-top {
    position: fixed;
    top: 0;
    right: 50vw;
    z-index: 1000;
  }
</style>

<div id="target">
  <h1 id="my-app">App1</h1>
  <h2>Video</h2>
  <h3>mp4</h3>
  <h3>webm</h3>

  <h2>Audio</h2>
  <h3>Mp3</h3>
  <h3>m4a</h3>

  <h1>App2</h1>
  <h2>Overview</h2>
</div>

<script>

  class TOC {
    /**
     * @param {[HTMLHeadingElement]} headingSet
     * */
    static parse(headingSet) {
      const tocData = []
      let curLevel = 0
      let preTocItem = undefined

      headingSet.forEach(heading => {
        const hLevel = heading.outerHTML.match(/<h([\d]).*>/)[1]
        const titleText = heading.innerText

        switch (hLevel >= curLevel) {
          case true:
            if (preTocItem === undefined) {
              preTocItem = new TocItem(titleText, hLevel)
              tocData.push(preTocItem)
            } else {
              const curTocItem = new TocItem(titleText, hLevel)
              const parent = curTocItem.level > preTocItem.level ? preTocItem : preTocItem.parent
              curTocItem.parent = parent
              parent.children.push(curTocItem)
              preTocItem = curTocItem
            }
            break
          case false:
            // We need to find the appropriate parent node from the preTocItem
            const curTocItem = new TocItem(titleText, hLevel)
            while (1) {
              if (preTocItem.level < curTocItem.level) {
                preTocItem.children.push(curTocItem)
                preTocItem = curTocItem
                break
              }
              preTocItem = preTocItem.parent

              if (preTocItem === undefined) {
                tocData.push(curTocItem)
                preTocItem = curTocItem
                break
              }
            }
            break
        }

        curLevel = hLevel

        if (heading.id === "") {
          heading.id = titleText.replace(/ /g, "-").toLowerCase()
        }
        preTocItem.id = heading.id
      })

      return tocData
    }

    /**
     * @param {[TocItem]} tocData
     * @return {string}
     * */
    static build(tocData) {
      let result = "<ul>"
      tocData.forEach(toc => {
        result += `<li><a href=#${toc.id}>${toc.text}</a></li>`
        if (toc.children.length) {
          result += `${TOC.build(toc.children)}`
        }
      })
      return result + "</ul>"
    }
  }

  /**
   * @param {string} text
   * @param {int} level
   * @param {TocItem} parent
   * */
  function TocItem(text, level, parent = undefined) {
    this.text = text
    this.level = level
    this.id = undefined
    this.parent = parent
    this.children = []
  }

  window.onload = () => {

    const headingSet = document.querySelectorAll("h1, h2, h3, h4, h5, h6") // You can also select only the titles you are interested in.
    const tocData = TOC.parse(headingSet)

    console.log(tocData)

    const tocHTMLContent = TOC.build(tocData)
    const frag = document.createRange().createContextualFragment(`<fieldset class="fixed-top"><legend>TOC</legend>${tocHTMLContent}</fieldset>`)
    document.querySelector(`body`).insertBefore(frag, document.querySelector(`body`).firstChild)
  }
</script>
```

*香草*JavaScript

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-12-02T12:28:42.280

我可能有点迟到了，但我已经把我自己的 jQuery 插件放在一起了......

可通过 jsDeliver CDN 获得：[https ://cdn.jsdelivr.net/npm/@thelevicole/toc.js@1/dist/toc.jquery.js](https://cdn.jsdelivr.net/npm/@thelevicole/toc.js@1/dist/toc.jquery.js)

页面结构的简单示例：

```
<div class="table-of-contents"></div>
<h1>Heading 1</h1>
<h2>Heading 2</h2>
<h3>Heading 3</h3>
<h2>Heading 2</h2>
<h2>Heading 2</h2>
<h1>Heading 1</h1> 
```

现在启动插件：

```
$('.table-of-contents').tableOfContents(); 
```

这将输出此列表：

```
<ul class="toc-list">
    <li class="toc-item">
        <a href="#heading-1" class="toc-link">Heading 1</a>
        <ul class="toc-list">
            <li class="toc-item">
                <a href="#heading-2" class="toc-link">Heading 2</a>
                <ul class="toc-list">
                    <li class="toc-item">
                        <a href="#heading-3" class="toc-link">Heading 3</a>
                    </li>
                </ul>
            </li>
            <li class="toc-item">
                <a href="#heading-4" class="toc-link">Heading 2</a>
            </li>
            <li class="toc-item">
                <a href="#heading-5" class="toc-link">Heading 2</a>
            </li>
        </ul>
    </li>
    <li class="toc-item">
        <a href="#heading-6" class="toc-link">Heading 1</a>
    </li>
</ul> 
```

截图供参考：

[![在此处输入图像描述](https://i.stack.imgur.com/lXWdG.png)](https://i.stack.imgur.com/lXWdG.png)

* * *

有许多选项可以通过...

```
$('.table-of-contents').tableOfContents({
    contentTarget: $( document.body ), // The element with content.
    selectors: 'h1$1; h2$2; h3$3; h4$4; h5$5; h6$6;', // Tree structure.
    nestingDepth: -1, // How deep we'll allow nesting. -1 for infinate.
    slugLength: 40, // The max number of chars in the hash slug.
    anchors: true, // Add anchors to headings.
    anchorText: '#', // The symbol added to headings.
    orderedList: false // True to use <ol> instead of <ul>
}); 
```

该`selectors`选项允许您从其他选择器创建目录，而不仅仅是 h1、h2、h3 等。

选择器选项接受选择器和深度的字符串、数组或对象：

**细绳**

```
$('.table-of-contents').tableOfContents({
    // '{selector}${depth}; {selector}${depth}; ...'
    selectors: 'h1$1; h2$2; h3$3; p:not(.my-class)$2; ...'
}); 
```

选择器模式相当简单，并且遵循一个简单的模式。我们首先有 DOM/CSS 选择器 {selector}，然后是嵌套深度，它以美元符号 ${depth} 开始并以分号结束；

用于嵌套标题的默认模式如下所示：`'h1$1; h2$2; h3$3; h4$4; h5$5; h6$6;'`

**大批**

```
$('.table-of-contents').tableOfContents({
    selectors: [
        // '{selector}${depth}'
        'h1$1',
        'h2$2',
        'h3$3',
        'p:not(.my-class)$2',
        ...
    ]
}); 
```

**目的**

```
$('.table-of-contents').tableOfContents({
    selectors: {
        // '{selector}': {depth}
        'h1': 1,
        'h2': 2,
        'h3': 3,
        'p:not(.my-class)': 2,
        ...
    }
}); 
```

自定义选择器示例：

```
<div class="table-of-contents"></div>

<article>
    <p class="level-1">I'm level 1</p>
    <p class="level-2">I'm level 2</p>
    <p class="level-1">I'm level 1 again</p>
    <p class="level-2">I'm level 2 again</p>
    <p class="level-3">I'm level 3</p>
    <p><strong>I'm a div element</strong></p>
    <p class="level-2">I'm level 2</p>
</article> 
```

```
$('.table-of-contents').tableOfContents({
    contentTarget: 'article',
    selectors: '.level-1 $1; .level-2 $2; .level-3 $3; p > strong $4'
}); 
```

会导致...

[![在此处输入图像描述](https://i.stack.imgur.com/zmUCQ.png)](https://i.stack.imgur.com/zmUCQ.png)

* * *

我还没有机会编写适当的文档，但是您可以在 GitHub 上关注此项目：[https](https://github.com/thelevicole/toc.js) ://github.com/thelevicole/toc.js或在此处查看主页：[https ://thelevicole.com/toc.js /](https://thelevicole.com/toc.js/)

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2008-10-09T14:57:58.323

页面加载后，循环浏览 DOM 并查找您感兴趣的元素。建立一个很好的锚点列表并将其添加到文档中您想要的位置。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2015-03-01T10:36:28.203

您可以[使用 JavaScript 为任何 HTML 文档创建动态目录，](http://www.siteforinfotech.com/2015/02/how-to-create-table-of-contents-using-javascript.html)它可以显示从 h1 到 h6 的标题列表以及指向标题的链接，并使用以下步骤更轻松地浏览文档。

首先创建 window.onload 函数，该函数在文档完成加载时自动运行，如下所示

```
window.onload=function(){

function getSelectedText(){
if (window.getSelection)
return window.getSelection().toString()+"
"+document.URL;
else if (document.selection)
 return document.selection.createRange().text+"
"+document.URL;
}
var toc=document.getElementById("TOC");
if(!toc) {
 toc=document.createElement("div");
 toc.id="TOC";
 document.body.insertBefore(toc, document.body.firstChild);
}
```

将以下代码添加到函数中以查找所有标签并将它们设置为标题。

```
var headings;
if (document.querySelectorAll) 
headings=document.querySelectorAll("h1, h2, h3, h4, h5, h6");
else
headings=findHeadings(document.body, []);
```

使用以下 CSS 代码设计目录

```
#TOC {border:solid black 1px; margin:10px; padding:10px;}
.TOCEntry{font-family:sans-serief;}
.TOCEntry a{text-decoration:none;}
.TOCLevel1{font-size:17pt; font-weight:bold;}
.TOCLevel2{font-size:16pt; font-weight:bold;}
.TOCLevel3{font-size:15pt; font-weight:bold;}
.TOCLevel4{font-size:14pt; margin-left:.25in;}
.TOCSectNum{display:none;} 
```

这是在脚本标记中创建目录的完整 JavaScript 代码。

```
window.onload=function(){

function getSelectedText(){
if (window.getSelection)
return window.getSelection().toString()+"<br/>"+document.URL;
else if (document.selection)
 return document.selection.createRange().text+"<br/>"+document.URL;
}

var toc=document.getElementById("TOC");
if(!toc) {
 toc=document.createElement("div");
 toc.id="TOC";
 document.body.insertBefore(toc, document.body.firstChild);
}
var headings;
if (document.querySelectorAll) 
headings=document.querySelectorAll("h1, h2, h3, h4, h5, h6");
else
headings=findHeadings(document.body, []);

function findHeadings(root, sects){
 for(var c=root.firstChild; c!=null; c=c.nextSibling){
if (c.nodeType!==1) continue;
if (c.tagName.length==2 && c.tagName.charAt(0)=="H")
sects.push(c);
else
findHeadings(c, sects);
}
return sects;
}

var sectionNumbers=[0,0,0,0,0,0];

for(var h=0; h<headings.length; h++) {
 var heading=headings[h];

if(heading.parentNode==toc) continue;

var level=parseInt(heading.tagName.charAt(1));
if (isNaN(level)||level<1||level>6) continue;

sectionNumbers[level-1]++;
for(var i=level; i<6; i++) sectionNumbers[i]=0;

var sectionNumber=sectionNumbers.slice(0, level).join(".");

var span=document.createElement("span");
span.className="TOCSectNum";
span.innerHTML=sectionNumber;
heading.insertBefore(span, heading.firstChild);
heading.id="TOC"+sectionNumber;
var anchor=document.createElement("a");
heading.parentNode.insertBefore(anchor, heading);
anchor.appendChild(heading);

var link=document.createElement("a");
link.href="#TOC"+sectionNumber; 
link.innerHTML=heading.innerHTML;

var entry=document.createElement("div");
entry.className="TOCEntry TOCLevel" + level;
entry.appendChild(link);

toc.appendChild(entry);
}
};
```

来源：[如何使用 JavaScript 创建目录](http://www.siteforinfotech.com/2015/02/how-to-create-table-of-contents-using-javascript.html)

# .net - 可以将 WinForms 应用程序配置为在不重新编译的情况下以“x86”运行吗？

> ID：187620
> 
> 赞同：4
> 
> 时间：2008-10-09T14:54:54.213
> 
> 标签：.net, winforms, configuration, x86, x86-64

是否可以将针对“任何 CPU”编译的 WinForms 应用程序配置为在 64 位服务器上作为“x86”运行而无需重新编译应用程序？具体来说，我正在寻找一个 app.config 设置或控制面板小程序来实现这一目标。客户所有的客户端都是x86的，但是服务器是x64的，我们喜欢在服务器上安装WinForms应用，供管理员配置和监控系统。我们宁愿不只为服务器重新编译。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-09T14:58:49.867

来自[http://www.request-response.com/blog/PermaLink,guid,34966ef8-3142-46b2-84e0-372b5c36ddcc.aspx](http://www.request-response.com/blog/PermaLink,guid,34966ef8-3142-46b2-84e0-372b5c36ddcc.aspx)

> 但是，即使在您的代码已编译之后，您也可以控制和覆盖此默认行为。SDK 中有一个名为 corflags.exe 的便捷工具，可让您强制“anycpu”编译代码在 64 位世界中使用 32 位进程。

此实用程序的用法可在此处找到[http://msdn.microsoft.com/en-us/library/ms164699(VS.80).aspx](http://msdn.microsoft.com/en-us/library/ms164699(VS.80).aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-09T15:08:51.517

如果您正确编写了托管代码，则不需要进行任何配置。只要 64 位机器安装了正确的框架，JIT 进程就会处理 32 位和 64 位要求之间的任何差异。

在您自己的代码中唯一需要关注的是您是否正在执行任何 P/Invoke。在这种情况下，任何时候调用使用 HANDLE 或 void* 类型的 API 函数时，都需要确保始终使用 System.IntPtr，而不是 System.Int32。在 .NET 世界中，int 数据类型始终为 32 位，即使在 64 位机器上也是如此。同样，无论什么架构，long 总是 64 位。

然而，IntPtr 始终是 void* 的大小，因此根据您运行的机器的体系结构，JIT 的大小也不同。

# python - 如何使 python 命令行程序自动完成任意事物而不是解释器

> ID：187621
> 
> 赞同：116
> 
> 时间：2008-10-09T14:55:02.480
> 
> 标签：python, linux, unix, command-line, autocomplete

我知道如何在 python 解释器（在 unix 上）中设置 python 对象的自动完成。

*   谷歌显示了许多关于如何做到这一点的解释。
*   不幸的是，参考资料太多，很难找到我需要做的事情，这略有不同。

我需要知道如何在用 python 编写的命令行程序中启用、制表符/自动完成任意项。

我的具体用例是一个需要发送电子邮件的命令行 python 程序。我希望能够在用户键入部分电子邮件地址（并且可以选择按 TAB 键）时自动完成电子邮件地址（我在磁盘上有地址）。

我不需要它在 windows 或 mac 上工作，只需要在 linux 上工作。

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2008-10-09T15:01:38.597

使用 Python 的`readline`绑定。例如，

```
import readline

def completer(text, state):
    options = [i for i in commands if i.startswith(text)]
    if state < len(options):
        return options[state]
    else:
        return None

readline.parse_and_bind("tab: complete")
readline.set_completer(completer) 
```

官方[模块文档](https://docs.python.org/2/library/readline.html)并没有更详细，请参阅[readline 文档](http://tiswww.case.edu/php/chet/readline/readline.html#SEC44)了解更多信息。

* * *

## 回答 #2

> 赞同：64
> 
> 时间：2008-10-09T15:08:18.663

按照[cmd 文档](http://docs.python.org/library/cmd.html#cmd.Cmd.cmdloop)，你会没事的

```
import cmd

addresses = [
    'here@blubb.com',
    'foo@bar.com',
    'whatever@wherever.org',
]

class MyCmd(cmd.Cmd):
    def do_send(self, line):
        pass

    def complete_send(self, text, line, start_index, end_index):
        if text:
            return [
                address for address in addresses
                if address.startswith(text)
            ]
        else:
            return addresses

if __name__ == '__main__':
    my_cmd = MyCmd()
    my_cmd.cmdloop() 
```

tab -> tab -> send -> tab -> tab -> f -> tab 的输出

```
(Cmd)
help  send
(Cmd) send
foo@bar.com            here@blubb.com         whatever@wherever.org
(Cmd) send foo@bar.com
(Cmd) 
```

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2008-10-13T09:59:23.950

既然你在你的问题中说“不是解释器”，我想你不想要涉及 python readline 等的答案。（***编辑****：事后看来，显然不是这样。哼哼。无论如何，我认为此信息很有趣，所以我将其留在这里。*）

我想你可能会在[这](http://www.debian-administration.org/articles/317)之后。

它是关于向任意命令添加 shell 级补全，扩展 bash 自己的制表符补全。

简而言之，您将创建一个包含 shell 函数的文件，该函数将生成可能的完成，将其保存到`/etc/bash_completion.d/`并使用 command 进行注册`complete`。这是链接页面的一个片段：

```
_foo() 
{
    local cur prev opts
    COMPREPLY=()
    cur="${COMP_WORDS[COMP_CWORD]}"
    prev="${COMP_WORDS[COMP_CWORD-1]}"
    opts="--help --verbose --version"

    if [[ ${cur} == -* ]] ; then
        COMPREPLY=( $(compgen -W "${opts}" -- ${cur}) )
        return 0
    fi
}
complete -F _foo foo 
```

在这种情况下，输入`foo --[TAB]`将为您提供变量 中的值，`opts`即和。出于您的目的，您基本上需要自定义放入.`--help``--verbose``--version``opts`

请查看链接页面上的示例，这一切都非常简单。

* * *

## 回答 #4

> 赞同：34
> 
> 时间：2014-05-30T16:59:54.013

我很惊讶没有人提到 argcomplete，这是文档中的一个示例：

```
from argcomplete.completers import ChoicesCompleter

parser.add_argument("--protocol", choices=('http', 'https', 'ssh', 'rsync', 'wss'))
parser.add_argument("--proto").completer=ChoicesCompleter(('http', 'https', 'ssh', 'rsync', 'wss')) 
```

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2008-10-16T19:26:31.450

这是由 ehemient [here](https://stackoverflow.com/questions/187621/how-to-make-a-python-command-line-program-autocomplete-arbitrary-things-not-int#187660)提供的代码的完整版本（谢谢）。

```
import readline

addrs = ['angela@domain.com', 'michael@domain.com', 'david@test.com']

def completer(text, state):
    options = [x for x in addrs if x.startswith(text)]
    try:
        return options[state]
    except IndexError:
        return None

readline.set_completer(completer)
readline.parse_and_bind("tab: complete")

while 1:
    a = raw_input("> ")
    print "You entered", a 
```

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2013-10-24T00:48:58.013

```
# ~/.pythonrc
import rlcompleter, readline
readline.parse_and_bind('tab:complete')

# ~/.bashrc
export PYTHONSTARTUP=~/.pythonrc 
```

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2019-05-29T15:10:57.097

您可以尝试使用[Python Prompt Toolkit](https://github.com/prompt-toolkit/python-prompt-toolkit)，这是一个用于在 Python 中构建交互式命令行应用程序的库。

该库可以轻松添加交互式自动完成功能，允许用户使用该`Tab`键以可视方式循环浏览可用选项。该库是跨平台的（Linux、OS X、FreeBSD、OpenBSD、Windows）。例子：

[![pgcli - Python 提示工具包](https://i.stack.imgur.com/h4TmQ.gif "pgcli")](https://i.stack.imgur.com/h4TmQ.gif "pgcli")

（图片来源：[pcgli](https://github.com/dbcli/pgcli)）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-03-29T22:36:14.160

发布的答案工作正常，但我已经开源了一个我在工作中编写的自动完成库。我们已经在生产中使用了一段时间，它快速、稳定且易于使用。它甚至具有演示模式，因此您可以在键入单词时快速测试您会得到什么。

要安装它，只需运行：`pip install fast-autocomplete`

这是一个例子：

```
>>> from fast_autocomplete import AutoComplete
>>> words = {'book': {}, 'burrito': {}, 'pizza': {}, 'pasta':{}}
>>> autocomplete = AutoComplete(words=words)
>>> autocomplete.search(word='b', max_cost=3, size=3)
[['book'], ['burrito']]
>>> autocomplete.search(word='bu', max_cost=3, size=3)
[['burrito']]
>>> autocomplete.search(word='barrito', max_cost=3, size=3)  # mis-spelling
[['burrito']] 
```

结帐：[https](https://github.com/seperman/fast-autocomplete) ://github.com/seperman/fast-autocomplete获取源代码。

这里是它如何工作的解释：http: [//zepworks.com/posts/you-autocomplete-me/](http://zepworks.com/posts/you-autocomplete-me/)

它处理拼写错误并可选择按单词的权重排序。（假设`burrito`比 更重要`book`，那么您给出`burrito`更高的“计数”，它将首先出现`book`在结果中。

Words 是一本字典，每个单词都可以有一个上下文。例如“计数”、如何显示单词、单词周围的一些其他上下文等。在这个例子中，单词没有任何上下文。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2021-07-18T03:11:16.657

这很好用。

```
#!/usr/bin/python3

import readline
readline.parse_and_bind("tab: complete")

def complete(text,state):
    volcab = ['dog','cat','rabbit','bird','slug','snail']
    results = [x for x in volcab if x.startswith(text)] + [None]
    return results[state]

readline.set_completer(complete)

line = input('prompt> ') 
```

# visual-studio - C++中的静态库问题

> ID：187627
> 
> 赞同：1
> 
> 时间：2008-10-09T14:56:26.893
> 
> 标签：visual-studio, static, linker

我正在尝试使用我在 Visual C++ 2005（非托管 C++）中创建的静态库。我声明了一个函数“int myF(int a);” 到 .h 文件中，我在 .cpp 文件中实现它，我编译它 - 生成 .lib 文件。

我在 VC++ 2005（也是本机 C++）中创建了一个新项目（一个单独的解决方案），我添加了包含文件和 lib 文件的路径；当我调用函数 myF 时，链接器报告错误：“错误 LNK2019：未解析的外部符号 _myF 在函数 _main 中引用”。如果我在与库项目相同的解决方案中创建客户端项目，然后添加对库项目的引用，它可以工作，但我不会像这样实现所有内容，而是将外部库添加到我的项目中。 .

怎么了？

谢谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-09T15:03:15.553

您还需要在第二个项目中包含实际的 .lib 文件（不仅仅是它的路径）。

链接器设置中应该有一个选项来执行此操作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T15:05:08.293

仅列出可以找到 MyStatic.lib 的文件夹是不够的。您必须明确告诉链接器 Dependant.vcproj 正在使用 MyStatic.lib。

在 VS2005 中，您可以通过项目属性->链接器->输入->附加依赖项来执行此操作。您还可以在 .h 文件中添加一些预处理器的东西来告诉编译器告诉链接器使用 MyStatic.lib。

编辑：预处理器的魔法是这样的

```
#pragma comment(lib, "MyStatic.lib") 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T18:35:11.257

（编辑：这是对在链接阶段获取 /NODEFAULTLIB 错误的问题的回应，该错误现已被删除......耸耸肩）

如果您收到 defaultlib 错误，则您正在混合编译器设置。例如，如果您在调试中构建库并在发布中构建主库，您将收到此错误，因为它们是为使用不同版本的 CRTL 而构建的。如果您使用不同的设置将 C 运行时链接为对象库或 DLL，也会发生这种情况。（请参阅“运行时库”设置下的 C/C++ 选项、“代码生成”部分）

在许多项目中，如果您无法更正库的设置（例如，第 3 方库），您将无能为力。在这些情况下，您必须使用 /NODEFAULTLIB 开关，它是“输入”部分中称为“忽略特定库”的链接器选项。

但是由于您同时控制主库和库，因此请构建 LIB 文件的调试版本和发布版本，或者确保您的“C/C++；代码生成；运行时库”设置在两个项目中匹配。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-09T15:01:51.703

尝试在链接器输入中为项目属性设置其他依赖项。

# ubuntu - 将 Ubuntu 迁移到另一个平台时如何保留已安装的应用程序？

> ID：187629
> 
> 赞同：14
> 
> 时间：2008-10-09T14:57:09.433
> 
> 标签：ubuntu, migrate, apt, dpkg

我正在考虑从旧的 AMD64 迁移到新的 32 位英特尔双核。安装不是问题，但我可以转移所有已安装的应用程序吗？到目前为止，除了迁移到类似平台和文件系统的位置外，我还没有在 Google 上找到任何东西。我不会更改文件系统，但平台会有所不同。Gentoo 中的“世界”文件的行中有什么东西吗？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-10-09T15:19:51.680

您可以轻松保存软件包列表：查看“man dpkg”并搜索--set-selections 和--get-selections。

不过，它的基本原理是保存包列表：

`dpkg --get-selections > package_list`

要在另一个系统上恢复该列表：

`cat package_list | sudo dpkg --set-selections && sudo apt-get dselect-upgrade`

跨架构移动意味着将有一些包不可用。它们将被忽略；例如，`ia32-libs`将无法安装在 32 位系统上。如果您从 x86-64 迁移到 x86，该选择将被忽略。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-09T16:19:55.023

有趣的是，我在这里使用 SO 作为 howto 存储库（写一个问题，然后选择我自己的答案），但是在我写自己的答案的时候，我被打了三次！

无论如何，这是我的记录：

使用 dpkg 的 --get-selections 和 --set-selections 选项来捕获和选择您当前安装的包。

首先，在旧系统上导出当前的包列表：

```
sudo dpkg --get-selections > mypackages.txt 
```

然后选择此列表作为要在新系统上安装的软件包：

```
sudo dpkg --set-selections < mypackages.txt 
```

（对于额外的信用，复制你的 apt 缓存目录以最小化下载：`/var/cache/apt)`

最后，告诉 apt 下载并安装选定的软件包：

```
sudo apt-get dselect-upgrade 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-09T15:16:20.783

对于您使用 apt-get 安装的所有内容，如果您想创建已安装内容的记录，请运行以下命令：

```
dpkg -l|awk '/^ii\s*(.*)\s*/ {print $2}'|packages.txt 
```

这将创建一个包含您已安装的所有软件包的文本文件。然后在您完成安装后，使用以下内容创建并运行一个脚本：

```
#!/bin/sh
for p in $(cat packages.txt); do apt-get install $p; done 
```

注意：
1) 由于您要从 64 位迁移到 32 位，因此某些软件包可能不兼容。在运行上面的脚本之前，我会为 '64' grep packages.txt 并在需要时找到替代方案。
2）任何你从源代码安装的东西，你都必须记下并再次从源代码安装。

祝你好运！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-03-15T22:34:30.387

我不确定这是否是一个答案，但我刚刚发现命令 aptitude-create-state-bundle 的存在。是的，这是一个命令。查看手册页。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-11-03T22:40:17.273

如果（像我一样）您在弄乱系统之前没有这样做，您可以启动到 live-cd 或其他安装，并使用 chroot 获取此信息。

```
sudo chroot /path/to/old/system /bin/bash 
```

然后`dpkg --get-selections`跳舞，您可以使用生成的文件来设置您的新系统。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-08-30T13:10:35.363

这是我通常用来解决类似问题的方法（多次迁移到新笔记本电脑）。

除了这个问题的其他答案还有两个，这也会移动你的`update-alternatives`和`debconf`设置，这总是需要很长时间才能意识到那些没有被转移。

旧系统备份：

```
sudo apt-get install dselect debconf-utils
mkdir system-selections
update-alternatives --get-selections > system-selections/alternatives-selections
dpkg --get-selections '*' > system-selections/dpkg-selections
sudo debconf-get-selections > system-selections/debconf-selections 
```

将配置目录复制到新系统（“ `scp -r oldsystem:system-selections ~`”）：

```
sudo apt-get install dselect debconf-utils
sudo dselect update
sudo dpkg --set-selections  < system-selections/dpkg-selections
sudo debconf-set-selections < system-selections/debconf-selections
sudo apt-get -u dselect-upgrade
sudo update-alternatives --set-selections < system-selections/alternatives-selections 
```

此外，您可以使用相同的方法定期备份您的主目录和`system-selections`（如上所述）到远程存储。因此，如果您的笔记本电脑损坏/被盗，构建类似系统的速度非常快。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-09T15:17:56.100

我能想到的最好方法是备份当前系统上已安装软件包的列表，然后使用该列表设置要在新系统上安装的软件包。关于如何备份和恢复您的包选择的一般说明：

### 安装工具

```
sudo apt-get install dselect 
```

### 备份包列表

```
dpkg --get-selections | grep -v deinstall > ubuntu-files 
```

### 恢复包选择

```
sudo apt-get update
sudo apt-get dist-upgrade
dpkg --set-selections < ubuntu-files
sudo dselect 
```

这将打开一个 dselect 会话。输入“I”并允许 dselect 安装 ubuntu-files 文档中列出的软件包。完成后，键入“Q”并按 ENTER 键退出 dselect。

# c# - 这两条错误消息的原因是什么？

> ID：187633
> 
> 赞同：0
> 
> 时间：2008-10-09T14:57:56.560
> 
> 标签：c#, vb.net

首先，我想说这个网站很棒！

我的问题是，以下 2 条错误消息的原因是什么？

1) 在 VB.NET 中（我知道这是一个 C# 论坛，但我的下一个问题来自 C# 经验），属性评估失败（我在监视异常变量时这样做）。

2) 在 C# 中，方法或类（不记得是哪个）没有构造函数。我想我是通过 HttpContext 或 HttpApplication 得到的，如果我没记错的话，这是一个类？可以肯定的是，它有自己的属性和方法。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-09T15:01:56.833

1) 可能是多种原因。有些属性在调试器中不能很好地工作。（想象一下看 DateTime.Now 的变化！）

2）您正在尝试创建一个没有适当可访问构造函数的类的实例。通常要么类只有静态成员，要么有一个静态成员用于获取实例。（话虽如此，您提到的两个类都有公共构造函数。）

更准确的错误消息和情况描述会很有帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T15:02:41.013

我可能希望看到代码片段来给你真正的答案，但我的精神检测能力告诉我#2 很可能你正在尝试做类似的事情：

```
HttpContext context = new HttpContext; 
```

这不是你接近的方式。相反，您将使用其内置的工厂方法来访问当前的工厂方法：

```
HttpContext context = HttpContext.Current; 
```

（同样适用于 HttpApplication。）

如果没有看到一些有代表性的代码，我无法帮助#1。别担心，这不是 C# 特定的论坛，它适用于所有编程语言和平台。:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-09T15:26:35.957

首先，很抱歉制作了一个重复的线程（看不到这个，所以做了另一个）。

1）这是有道理的。观察 datetime.now 的变化只会显示时间@添加手表的时间，缓存该值，然后在再次检查时获取新值（时间）。

2）约翰鲁迪：你是正确的。这就是我正在做的事情。所以 HttpContext.Current 给了我使用的 httpcontext 对象，我明白了。

# c++ - C++ 构造函数的默认参数

> ID：187640
> 
> 赞同：134
> 
> 时间：2008-10-09T14:58:34.313
> 
> 标签：c++, constructor, coding-style, overloading

拥有一个使用默认参数的类构造函数是一种好习惯，还是应该使用单独的重载构造函数？例如：

```
// Use this...
class foo  
{
private:
    std::string name_;
    unsigned int age_;
public:
    foo(const std::string& name = "", const unsigned int age = 0) :
        name_(name),
        age_(age)
    {
        ...
    }
};

// Or this?
class foo  
{
private:
    std::string name_;
    unsigned int age_;
public:
    foo() :
    name_(""),
    age_(0)
{
}

foo(const std::string& name, const unsigned int age) :
        name_(name),
        age_(age)
    {
        ...
    }
}; 
```

任何一个版本似乎都可以工作，例如：

```
foo f1;
foo f2("Name", 30); 
```

你喜欢或推荐哪种风格，为什么？

* * *

## 回答 #1

> 赞同：96
> 
> 时间：2008-10-09T14:59:28.587

绝对是风格问题。我更喜欢带有默认参数的构造函数，只要参数有意义。标准中的类也使用它们，这对它们有利。

需要注意的一件事是，如果您对除一个参数之外的所有参数都有默认值，那么您的类可以从该参数类型隐式转换。查看[此线程](https://stackoverflow.com/questions/174349/forcing-single-argument-constructors-to-be-explicit-in-c)以获取更多信息。

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2008-10-09T15:07:28.150

我会使用默认参数，特别是因为 C++ 不允许您链接构造函数（因此您最终不得不为每个重载复制初始化列表，甚至可能更多）。

也就是说，默认参数存在一些问题，包括常量可能被内联（从而成为类的二进制接口的一部分）这一事实。另一个需要注意的是，添加默认参数可以将显式多参数构造函数转换为隐式单参数构造函数：

```
class Vehicle {
public:
  Vehicle(int wheels, std::string name = "Mini");
};

Vehicle x = 5;  // this compiles just fine... did you really want it to? 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-10-09T16:14:37.843

这个讨论既适用于构造函数，也适用于方法和函数。

## 使用默认参数？

好消息是您不需要为每种情况重载构造函数/方法/函数：

```
// Header
void doSomething(int i = 25) ;

// Source
void doSomething(int i)
{
   // Do something with i
} 
```

坏事是你必须在头文件中声明你的默认值，所以你有一个隐藏的依赖：就像当你改变一个内联函数的代码时，如果你改变你的头文件中的默认值，你需要重新编译所有源代码使用此标头确保他们将使用新的默认值。

如果您不这样做，源仍将使用旧的默认值。

## 使用重载的构造函数/方法/函数？

好消息是，如果您的函数没有内联，那么您可以通过选择一个函数的行为方式来控制源中的默认值。例如：

```
// Header
void doSomething() ;
void doSomething(int i) ;

// Source

void doSomething()
{
   doSomething(25) ;
}

void doSomething(int i)
{
   // Do something with i
} 
```

问题是您必须维护多个构造函数/方法/函数及其转发。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-10-09T15:04:50.650

以我的经验，默认参数当时看起来很酷，让我的懒惰因素很开心，但后来我正在使用这个类，当默认参数启动时我很惊讶。所以我真的不认为这是一个好主意; 最好有一个 className::className() 和一个 className::init( *arglist* )。只是为了可维护性优势。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-10-09T17:01:27.467

[Sam 的](https://stackoverflow.com/questions/187640/default-parameters-with-c-constructors#187693)回答给出了默认参数更适合构造函数而不是重载的原因。我只想补充一点，C++-0x 将允许从一个构造函数[委托](http://en.wikipedia.org/wiki/C%2B%2B0x#Object_construction_improvement)给另一个构造函数，从而消除对默认值的需要。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-09T16:18:50.110

任何一种方法都有效。但是，如果您有一长串可选参数，请创建一个默认构造函数，然后让您的 set 函数返回对此的引用。然后链接设置器。

```
class Thingy2
{
public:
    enum Color{red,gree,blue};
    Thingy2();

    Thingy2 & color(Color);
    Color color()const;

    Thingy2 & length(double);
    double length()const;
    Thingy2 & width(double);
    double width()const;
    Thingy2 & height(double);
    double height()const;

    Thingy2 & rotationX(double);
    double rotationX()const;
    Thingy2 & rotatationY(double);
    double rotatationY()const;
    Thingy2 & rotationZ(double);
    double rotationZ()const;
}

main()
{
    // gets default rotations
    Thingy2 * foo=new Thingy2().color(ret)
        .length(1).width(4).height(9)
    // gets default color and sizes
    Thingy2 * bar=new Thingy2()
        .rotationX(0.0).rotationY(PI),rotationZ(0.5*PI);
    // everything specified.
    Thingy2 * thing=new Thingy2().color(ret)
        .length(1).width(4).height(9)
        .rotationX(0.0).rotationY(PI),rotationZ(0.5*PI);
} 
```

现在，在构造对象时，您可以选择要覆盖的属性以及明确命名的属性。更具可读性:)

此外，您不再需要记住构造函数参数的顺序。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-09T15:57:55.397

如果创建带参数的构造函数是不好的（正如许多人会争论的那样），那么使用默认参数创建它们就更糟了。我最近开始认为 ctor 参数不好，因为您的 ctor 逻辑应该*尽可能小*。如果有人传入一个没有任何意义的参数，你如何处理 ctor 中的错误处理？您可以抛出异常，这是个坏消息，除非您的所有调用者都准备好将任何“新”调用包装在 try 块中，或者设置一些“已初始化”成员变量，这有点像一种肮脏的黑客行为。

因此，确保传递到对象初始化阶段的参数的唯一方法是设置一个单独的 initialize() 方法，您可以在其中检查返回码。

使用默认参数不好有两个原因；首先，如果您想向 ctor 添加另一个参数，那么您将无法将其放在开头并更改整个 API。此外，大多数程序员习惯于通过实际使用的方式来计算 API——对于在可能不存在正式文档的组织内部使用的非公共 API*尤其如此。*当其他程序员看到大多数调用不包含任何参数时，他们也会这样做，并且很高兴地不知道您的默认参数强加给他们的默认行为。

此外，值得注意的是，[谷歌 C++ 风格指南](https://google.github.io/styleguide/cppguide.html#Doing_Work_in_Constructors)避开了 ctor 参数（除非绝对必要）和[函数或方法的默认参数](https://google.github.io/styleguide/cppguide.html#Default_Arguments)。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-10T00:55:09.367

主要是个人选择。但是，重载可以做任何默认参数可以做的事情，但反之则**不行。**

例子：

可以使用重载来写 A(int x, foo& a) 和 A(int x)，但不能使用默认参数来写 A(int x, foo& = null)。

一般规则是使用任何有意义的东西并使代码更具可读性。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2010-02-08T05:16:33.143

要考虑的另一件事是该类是否可以在数组中使用：

```
foo bar[400]; 
```

在这种情况下，使用默认参数没有任何好处。

这肯定行不通：

```
foo bar("david", 34)[400]; // NOPE 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-09T15:09:06.493

出于这个原因，我会使用默认参数：您的示例假定 ctor 参数直接对应于成员变量。但是如果不是这样的话，你必须在初始化对象之前处理参数。拥有一个共同的 ctor 将是最好的方法。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-10-09T15:10:07.927

默认参数困扰我的一件事是您不能指定最后一个参数，而是使用第一个参数的默认值。例如，在您的代码中，您不能创建一个没有名称但有给定年龄的 Foo（但是，如果我没记错的话，这在 C++0x 中是可能的，具有统一的构造语法）。有时，这是有道理的，但也可能非常尴尬。

在我看来，没有经验法则。就个人而言，我倾向于使用多个重载的构造函数（或方法），除非只有最后一个参数需要默认值。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-09T16:18:33.793

风格问题，但正如马特所说，绝对考虑使用默认参数标记构造函数，这将允许隐式转换为“显式”以避免意外的自动转换。这不是必需的（如果您要创建要隐式转换为的包装类，则可能不是优选的），但它可以防止错误。

我个人喜欢在适当的时候使用默认值，因为我不喜欢重复的代码。YMMV。

# filesystems - 在远程系统上应用文件结构差异/补丁？

> ID：187644
> 
> 赞同：1
> 
> 时间：2008-10-09T14:58:55.873
> 
> 标签：filesystems, diff

是否有创建文件结构差异的工具，可能基于 MD5 清单。我的目标是通过网络发送一个包含新/更新文件和要删除的文件列表的包。它需要复制新/更新的文件并删除源文件结构中已删除的文件吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-09T22:04:42.130

你可以试试 rsync。根据您的需要，该命令可能很简单：

```
rsync -az --del /path/to/master dup-site:/path/to/duplicate 
```

引用[rsync 的网站](http://samba.anu.edu.au/rsync/)：

> rsync 是一个开源实用程序，可提供快速增量文件传输。rsync 在 GNU 通用公共许可证下免费提供，目前由 Wayne Davison 维护。

或者，如果您更喜欢[维基百科](http://en.wikipedia.org/wiki/Rsync)：

> rsync 是适用于 Unix 系统的软件应用程序，可将文件和目录从一个位置同步到另一个位置，同时在适当时使用 delta 编码最小化数据传输。在大多数类似的程序/协议中没有发现 rsync 的一个重要特性是，镜像发生时每个方向只有一次传输。rsync 可以复制或显示目录内容和复制文件，可选择使用压缩和递归。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-14T17:24:37.103

@vfilby 我正在实现类似的东西。

我使用 rsync 已经有一段时间了，但是当部署到远程服务器时，它变得很时髦，并且权限更改超出了我的控制范围。使用 rsync 您可以选择不包含权限，但由于某种原因仍然会考虑它们。

我现在正在使用 git diff。这对文本文件非常有效。Diff 生成补丁，而不是您必须包含在文件中的清单。补丁的好处是已经有一个既定的框架可以在应用这些补丁之前使用和测试这些补丁。

例如，使用任何 *unix 机器上标配的补丁实用程序，您可以在试运行模式下运行补丁。这将告诉您要应用的补丁是否在您运行之前实际应用。这可以帮助您确保在准备补丁时您正在更新的文件没有更改。

如果这与您正在寻找的相似，我可以详细说明我的过程。

# user-interface - J2ME 小部件库

> ID：187651
> 
> 赞同：3
> 
> 时间：2008-10-09T14:59:34.000
> 
> 标签：user-interface, java-me

我开始开发 J2ME 应用程序，Java 库的内置 GUI 组件丑陋且不灵活。

任何人都可以推荐一个漂亮且易于使用（开源......）的小部件库吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-10T02:18:32.553

外面没有太多选择。最好的选择可能是 Sun 的[LWUIT](https://lwuit.dev.java.net/)。它最近是 GPL 的。或者，您可以使用[J2ME Polish](http://www.j2mepolish.org/cms/)，它在 GPL 下获得许可，并根据您使用它进行商业化。

我们公司可能会选择 LWUIT。似乎它将成为未来最受支持的 API。

# security - HTTPS 标头是否加密？

> ID：187655
> 
> 赞同：718
> 
> 时间：2008-10-09T15:00:35.650
> 
> 标签：security, post, encryption, https, get

当通过 HTTPS 发送数据时，我知道内容是加密的，但是我听到关于标头是否加密或标头的加密程度的混合答案。

有多少 HTTPS 标头*被*加密？

包括 GET/POST 请求 URL、Cookie 等。

* * *

## 回答 #1

> 赞同：649
> 
> 时间：2008-10-09T15:04:51.073

全部加密^(†</sup> - 所有标题。这就是为什么虚拟主机上的 SSL 不能很好地工作的原因——你需要一个专用的 IP 地址，因为主机头是加密的。)

^(†</sup>服务器名称识别 (SNI) 标准意味着如果您使用 TLS，主机名可能不会被加密。此外，无论您是否使用 SNI，TCP 和 IP 标头都不会加密。（如果是，您的数据包将无法路由。）)

* * *

## 回答 #2

> 赞同：120
> 
> 时间：2008-10-09T15:05:26.530

标头是完全加密的。通过网络“明文”传输的唯一信息与 SSL 设置和 D/H 密钥交换有关。这种交换经过精心设计，不会向窃听者提供任何有用的信息，一旦发生，所有数据都会被加密。

* * *

## 回答 #3

> 赞同：83
> 
> 时间：2015-07-22T13:48:57.173

旧问题的新答案，对不起。我想我会添加我的 $.02

OP 询问标头是否已加密。

它们是：在运输中。

它们不是：不在运输途中。

因此，您的浏览器的 URL（在某些情况下还包括标题）可以在标题中显示查询字符串（通常包含最敏感的详细信息）和一些详细信息；浏览器知道一些标头信息（内容类型、unicode 等）；浏览器历史记录、密码管理、收藏夹/书签和缓存页面都将包含查询字符串。远程端的服务器日志也可以包含查询字符串以及一些内容细节。

此外，URL 并不总是安全的：域、协议和端口都是可见的——否则路由器不知道将您的请求发送到哪里。

此外，如果你有一个 HTTP 代理，代理服务器知道地址，通常他们不知道完整的查询字符串。

因此，如果数据在移动，它通常会受到保护。如果它不在传输中，则它没有加密。

不是挑剔，但最后的数据也是解密的，可以随意解析、读取、保存、转发或丢弃。而且，任何一端的恶意软件都可以对进入（或退出）SSL 协议的数据进行快照，例如 HTTPS 内页面内的（坏）Javascript，它可以偷偷地对日志网站进行 http（或 https）调用（因为访问本地硬盘驱动器）通常受到限制且无用）。

此外，cookie 也没有在 HTTPS 协议下加密。想要将敏感数据存储在 cookie（或其他任何地方）中的开发人员需要使用自己的加密机制。

至于缓存，大部分现代浏览器都不会缓存HTTPS页面，但这并不是HTTPS协议定义的，完全取决于浏览器的开发者确保不缓存通过HTTPS接收的页面。

所以如果你担心数据包嗅探，你可能没问题。但是，如果您担心恶意软件或有人翻阅您的历史记录、书签、cookie 或缓存，那么您还没有脱离困境。

* * *

## 回答 #4

> 赞同：54
> 
> 时间：2008-10-09T22:11:41.397

HTTP 1.1 版添加了一种特殊的 HTTP 方法 CONNECT - 旨在创建 SSL 隧道，包括必要的协议握手和加密设置。
此后的常规请求都被包装在 SSL 隧道、标头和正文中发送。

* * *

## 回答 #5

> 赞同：52
> 
> 时间：2008-10-09T15:05:10.040

使用 SSL，加密是在传输级别，因此它发生在发送请求之前。

所以请求中的所有内容都是加密的。

* * *

## 回答 #6

> 赞同：51
> 
> 时间：2008-10-09T15:10:16.270

HTTPS（基于 SSL 的 HTTP）通过 SSL 隧道发送所有 HTTP 内容，因此 HTTP 内容和标头也被加密。

* * *

## 回答 #7

> 赞同：22
> 
> 时间：2016-02-18T13:23:24.183

是的，标头是加密的。它写[在这里](https://en.wikipedia.org/wiki/HTTPS#Network_layers)。

> HTTPS 消息中的所有内容都经过加密，包括标头和请求/响应负载。

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2015-11-21T05:25:06.380

URL也被加密了，你真的只有IP、端口，如果是SNI，还有未加密的主机名。

# c - 在“C”代码中使用链接器命令文件变量的绝对值

> ID：187669
> 
> 赞同：1
> 
> 时间：2008-10-09T15:02:52.167
> 
> 标签：c, embedded, linker

我有一个链接器命令文件，它将堆栈的顶部地址分配给一个变量

```
_stack = . + 0x80000; 
```

我想在“c”程序中使用这个地址——我想将堆栈复制到另一个位置，然后更新堆栈指针以指向新位置，然后对原始 RAM 库进行破坏性内存测试。

我发现如果我做类似的事情

```
extern u32 *_stack;  
myFunction(_stack); 
```

然后该函数似乎传递了存储在堆栈位置的值

```
lwz r3,0(r8) 
```

而不是堆栈本身的地址。任何人都可以帮忙吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-09T15:11:45.363

尝试

```
extern u32 _stack;
U32 * stackPtr;
stackPtr = &_stack; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-11T15:48:46.820

我相信最自然的[即：正确]声明方式是基于将堆栈视为内存中的数组的概念，堆栈指针是该数组中的一个位置：

```
extern U32 _stack[];
U32 *stackPtr;
stackPtr = _stack; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-09T15:10:52.183

*我的函数（&_stack）；*应该将变量 * _stack* 的地址传递给 myFunction。否则，它将传递变量*_stack*中包含的值。

# c# - C# String.Format() 和 String.Join() 的 Java 等效项

> ID：187676
> 
> 赞同：111
> 
> 时间：2008-10-09T15:04:34.177
> 
> 标签：c#, java, string

我知道这是一个新手问题，但是在 Java 中是否有与 C# 的字符串操作等价的东西？

具体来说，我说的是`String.Format`and `String.Join`。

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2008-10-09T15:14:11.333

Java String 对象有一个`format`方法（从 1.5 开始），但没有`join`方法。

要获得一堆尚未包含的有用的 String 实用方法，您可以使用[org.apache.commons.lang.StringUtils](http://commons.apache.org/proper/commons-lang//apidocs/org/apache/commons/lang3/StringUtils.html)。

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2008-10-09T15:10:36.193

[字符串格式](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/String.html#format)。至于加入，你需要自己写：

```
 static String join(Collection<?> s, String delimiter) {
     StringBuilder builder = new StringBuilder();
     Iterator<?> iter = s.iterator();
     while (iter.hasNext()) {
         builder.append(iter.next());
         if (!iter.hasNext()) {
           break;                  
         }
         builder.append(delimiter);
     }
     return builder.toString();
 } 
```

以上来自[http://snippets.dzone.com/posts/show/91](http://snippets.dzone.com/posts/show/91)

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2011-06-28T23:10:08.297

[Guava](https://code.google.com/p/guava-libraries/)随[类一起](http://google-collections.googlecode.com/svn/trunk/javadoc/com/google/common/base/Joiner.html)[提供`Joiner`](http://google-collections.googlecode.com/svn/trunk/javadoc/com/google/common/base/Joiner.html)。

```
import com.google.common.base.Joiner;

Joiner.on(separator).join(data); 
```

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2014-02-13T14:02:15.257

从 Java 8 开始，`join()`现在可以作为 String 类的两个类方法使用。在这两种情况下，第一个参数都是分隔符。

您可以[将单个`CharSequence`s 作为附加参数](http://docs.oracle.com/javase/8/docs/api/java/lang/String.html#join-java.lang.CharSequence-java.lang.CharSequence...-)传递：

```
String joined = String.join(", ", "Antimony", "Arsenic", "Aluminum", "Selenium");
// "Antimony, Arsenic, Alumninum, Selenium" 
```

或者你可以[传递一个`Iterable<? extends CharSequence>`](http://docs.oracle.com/javase/8/docs/api/java/lang/String.html#join-java.lang.CharSequence-java.lang.Iterable-)：

```
List<String> strings = new LinkedList<String>();
strings.add("EX");
strings.add("TER");
strings.add("MIN");
strings.add("ATE");

String joined = String.join("-", strings);
// "EX-TER-MIN-ATE" 
```

Java 8 还添加了一个新类 ，[`StringJoiner`](http://docs.oracle.com/javase/8/docs/api/java/util/StringJoiner.html)您可以像这样使用它：

```
StringJoiner joiner = new StringJoiner("&");
joiner.add("x=9");
joiner.add("y=5667.7");
joiner.add("z=-33.0");

String joined = joiner.toString();
// "x=9&y=5667.7&z=-33.0" 
```

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2013-05-01T22:34:26.577

[TextUtils.join](http://developer.android.com/reference/android/text/TextUtils.html#join%28java.lang.CharSequence,%20java.lang.Iterable%29)在 Android 上可用

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2011-06-24T03:15:36.403

您还可以对字符串使用可变参数，如下所示：

```
 String join (String delim, String ... data) {
    StringBuilder sb = new StringBuilder();
    for (int i = 0; i < data.length; i++) {
      sb.append(data[i]);
      if (i >= data.length-1) {break;}
      sb.append(delim);
    }
    return sb.toString();
  } 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-09T16:52:24.163

至于加入，我相信这看起来可能不那么复杂：

```
public String join (Collection<String> c) {
    StringBuilder sb=new StringBuilder();
    for(String s: c)
        sb.append(s);
    return sb.toString();
} 
```

我没有尽可能多地使用 Java 5 语法（信不信由你，我最近一直在使用 1.0.x）所以我可能有点生疏，但我确信这个概念是正确的.

编辑添加：字符串追加可能会很慢，但是如果您正在处理 GUI 代码或一些短时间运行的例程，那么如果您花费 0.005 秒或 0.006 秒真的没关系，所以如果您有一个名为“joinMe”的集合如果您想附加到现有的字符串“目标”，那么仅内联它并不可怕：

```
for(String s : joinMe)
    target += s; 
```

这是非常低效的（也是一个坏习惯），但除非有数千个字符串或者这是在一个巨大的循环中，或者您的代码对性能非常关键，否则您将无法感知到任何东西。

更重要的是，它易于记忆、简短、快速且可读性强。性能并不总是设计选择的自动赢家。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2014-04-04T20:56:45.763

这是一个非常简单的答案。使用`+=`它，因为它的代码更少，并让优化器`StringBuilder`为您将其转换为 a。使用这种方法，您不必在循环中执行任何“最后一次”检查（性能改进），并且您不必担心在最后剥离任何分隔符。

```
 Iterator<String> iter = args.iterator();
        output += iter.hasNext() ? iter.next() : "";
        while (iter.hasNext()) {
            output += "," + iter.next();
        } 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2014-03-10T19:55:00.930

我不想导入整个 Apache 库来添加简单的连接函数，所以这是我的 hack。

```
 public String join(String delim, List<String> destinations) {
        StringBuilder sb = new StringBuilder();
        int delimLength = delim.length();

        for (String s: destinations) {
            sb.append(s);
            sb.append(delim);
        }

        // we have appended the delimiter to the end 
        // in the previous for-loop. Let's now remove it.
        if (sb.length() >= delimLength) {
            return sb.substring(0, sb.length() - delimLength);
        } else {
            return sb.toString();
        }
    } 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-09T19:54:12.720

如果您希望将多个字符串连接（连接）为一个，则应使用 StringBuilder。这比使用要好得多

```
for(String s : joinMe)
    target += s; 
```

由于 StringBuilder 不使用同步，因此在性能上也比 StringBuffer 略胜一筹。

对于像这样的通用实用程序方法，它会（最终）在许多情况下被多次调用，因此您应该使其高效并且不要分配许多瞬态对象。我们分析了很多很多不同的 Java 应用程序，并且几乎总是发现字符串连接和字符串/字符 [] 分配占用了大量的时间/内存。

我们的可重用集合 -> 字符串方法首先计算所需结果的大小，然后创建一个具有该初始大小的 StringBuilder；这避免了在附加字符串时对使用的内部 char[] 进行不必要的加倍/复制。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-04-05T15:11:52.163

我自己写的：

```
public static String join(Collection<String> col, String delim) {
    StringBuilder sb = new StringBuilder();
    Iterator<String> iter = col.iterator();
    if (iter.hasNext())
        sb.append(iter.next().toString());
    while (iter.hasNext()) {
        sb.append(delim);
        sb.append(iter.next().toString());
    }
    return sb.toString();
} 
```

但`Collection`JSP 不支持，所以对于标记功能，我写道：

```
public static String join(List<?> list, String delim) {
    int len = list.size();
    if (len == 0)
        return "";
    StringBuilder sb = new StringBuilder(list.get(0).toString());
    for (int i = 1; i < len; i++) {
        sb.append(delim);
        sb.append(list.get(i).toString());
    }
    return sb.toString();
} 
```

并`.tld`归档：

```
<?xml version="1.0" encoding="UTF-8"?>
<taglib version="2.1" xmlns="http://java.sun.com/xml/ns/javaee"
    <function>
        <name>join</name>
        <function-class>com.core.util.ReportUtil</function-class>
        <function-signature>java.lang.String join(java.util.List, java.lang.String)</function-signature>
    </function>
</taglib> 
```

并在 JSP 文件中将其用作：

```
<%@taglib prefix="funnyFmt" uri="tag:com.core.util,2013:funnyFmt"%>
${funnyFmt:join(books, ", ")} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-06-25T16:56:35.010

[StringUtils](http://commons.apache.org/lang/api/org/apache/commons/lang/StringUtils.html)是 Apache Commons Lang 库中一个非常有用的类。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-07-01T08:05:57.773

有些[`MessageFormat.format()`](http://docs.oracle.com/javase/7/docs/api/java/text/MessageFormat.html#format(java.lang.String,%20java.lang.Object...))像 C# 的`String.Format()`.

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-07-01T20:22:13.423

我在这里看到了很多过于复杂的 String.Join 实现。如果您没有 Java 1.8，并且您不想导入新库，那么下面的实现就足够了。

```
public String join(Collection<String> col, String delim) {
    StringBuilder sb = new StringBuilder();
    for ( String s : col ) {
        if ( sb.length() != 0 ) sb.append(delim);
        sb.append(s);
    }
    return sb.toString();
} 
```

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2013-11-18T23:21:15.050

```
ArrayList<Double> j=new ArrayList<>; 
j.add(1);
j.add(.92);
j.add(3); 
String ntop=j.toString(); //ntop= "[1, 0.92, 3]" 
```

所以基本上，String ntop 用逗号分隔符和括号存储整个集合的值。

* * *

## 回答 #16

> 赞同：-8
> 
> 时间：2009-10-21T13:13:15.900

我只会使用字符串连接运算符“+”来连接两个字符串。 `s1 += s2;`

# concurrency - RIA 中的并发性

> ID：187683
> 
> 赞同：0
> 
> 时间：2008-10-09T15:05:20.713
> 
> 标签：concurrency, weborb

这将是我在这个平台上的第一个问题。我使用 Flex、WebORB 和 ASP.NET 进行了大量开发。我们已经解决了消息传递的并发问题（悲观并发控制）。这工作得很好，但它也使整个应用程序依赖于消息传递。没有消息传递，没有并发控制。我知道 ASP.NET 在 DataSets 中有版本控制，但是如果您正在使用 RIA，您将如何使用它。似乎很难将每个数据集存储在客户端的会话中......因此，如果客户端需要所有产品，我需要将数据集存储在客户端的会话中。当客户将某些内容更改为产品并保存产品时，我可以更新数据集（存储在会话中）并尝试保存它...... 看起来工作量很大，而且会用到很多内存（因为那些产品会保存在客户端的内存中，所以数据集需要保存在服务器端会话中）。我认为最简单的方法是为所有 DTO 提供版本号。如果客户端尝试保存 DTO，我可以将版本号与数据库中的版本号进行比较。

利文·卡登

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T14:40:29.580

这是我以前做过的事情——因为原始数据来自 SQL Server 数据库，我们只是在每个 DTO 中使用了一个 rowversion 类型的列来确定它是否在用户处理它时发生了变化。

此时，您可以抱怨错误或尝试找出合并更改的方法，但至少您可以看出它在您下面发生了更改:)

# java - ListCellRenderer 不在子组件上触发事件

> ID：187687
> 
> 赞同：0
> 
> 时间：2008-10-09T15:06:10.180
> 
> 标签：java, swing

以下 ListCellRenderer 不接收嵌套 ComboBox 上的单击事件。我需要启用某些东西吗？

```
class FilterCellRenderer implements ListCellRenderer {

    public Component getListCellRendererComponent(JList list, Object value, int index, boolean isSelected, boolean cellHasFocus) {
        Filter filter = (Filter)value;

        JPanel filterPanel = new JPanel();
        FlowLayout layout = new FlowLayout();
        layout.setAlignment(FlowLayout.LEFT);
        filterPanel.setLayout(layout);
        filterPanel.add(new JLabel(filter.getLabel()));

        final List<Object> options = filter.getOptions();
        if (options.size() > 1) {
            JComboBox optionCombo = new JComboBox(new AbstractComboBoxModel() {

                public int getSize() {
                    return options.size();
                }

                public Object getElementAt(int index) {
                    return options.get(index);
                }
            });
            optionCombo.setSelectedItem(filter.getValue());
            filterPanel.add(optionCombo);
        }

        if (isSelected) {
            filterPanel.setBackground(list.getSelectionBackground());
            filterPanel.setForeground(list.getSelectionForeground());
        } 
        return filterPanel;
    }

} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-09T20:13:27.767

swing 中的渲染器组件就像“橡皮图章”一样工作——它们只是用于渲染/绘制一个值，而不是以通常的方式添加到父容器中（想想如何在多个地方添加单个组件！）。

听起来您可能想要一个编辑器而不是渲染器（编辑器是一个成熟的组件，在任何给定时间添加到一个地方）。如果失败，您将不得不在 JList 上安装 MouseListener。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-11T00:06:32.573

因为我不需要选择行，所以我最终只是动态地将元素添加到具有自定义布局的 JPanel 中。允许完整的组件行为，而无需破解表。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-09T18:27:55.123

这有点棘手。我相信您需要用单列 JTable 替换 JList。然后设置一个表格单元格编辑器以及渲染器。IIRC，丢失第一次单击（用于选择已编辑的单元格）可能会出现问题。

此外，在每次调用 getCellRendererComponent 之间重用组件也是一个好主意。这些组件被用作印章，然后被丢弃。如果每次都重新创建它们，性能将非常糟糕。

# c# - 对不可变字符串的误解或文档中的错误？

> ID：187695
> 
> 赞同：5
> 
> 时间：2008-10-09T15:07:47.557
> 
> 标签：c#, string

我刚刚在 MS Visual Studio 文档中看到了这一点，粗体部分对我来说没有意义。是错的还是我没有正确理解？如果你运行它，b 似乎持有“hello”（如我所料）而不是“h”。

字符串是*不可变*的——字符串对象的内容在创建对象后不能更改，尽管语法使它看起来好像您可以这样做。例如，当您编写此代码时，编译器实际上会创建一个新的字符串对象来保存新的字符序列，**而变量 b 会继续保存 "h"**。

字符串 b = "h";

b +=“你好”；

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-09T15:09:28.520

您已经一步完成了添加和分配。字符串是不可变的，但也是一种引用类型。

```
string b = "h";
b = b + "ello"; 
```

我们可以这样查看伪内存：

```
string b = "h";         // b    := 0x00001000 ["h"]
string tmp1 = "ello";   // tmp1 := 0x00002000 ["ello"]
string tmp2 = b + tmp1; // tmp2 := 0x00003000 ["hello"]
string b = tmp2;        // b    := 0x00003000 ["hello"] 
```

我不完全确定你从哪里得到那个文本，因为当我阅读我找到的[字符串](http://msdn.microsoft.com/en-us/library/362314fe.aspx)类的文档时（不是我认为“h”实际上被垃圾收集了）：

> 字符串是不可变的——字符串对象的内容在创建对象后不能更改，尽管语法使它看起来好像您可以这样做。例如，当您编写此代码时，编译器实际上会创建一个新的字符串对象来保存新的字符序列，并将该新对象分配给 b。然后字符串“h”就可以进行垃圾回收了。

@Jon Skeet 提出由于字符串实习，“h”永远不会被垃圾收集，我同意他的观点，但 C# 标准也同意他的观点，否则 §2.4.4.5 字符串文字中的以下内容不可能是真的：

> 每个字符串文字不一定会产生一个新的字符串实例。当根据字符串相等运算符（第 7.9.7 节）等效的两个或多个字符串文字出现在同一程序中时，这些字符串文字引用相同的字符串实例。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-09T15:35:29.823

人们似乎没有理解这个问题。没有人争辩说字符串对象不是不可变的。争论的焦点是他加粗的内容：

> 并且变量 b 继续保持“h”

我同意 OP 的观点，即文档的这一部分在两个方面是不正确的：

(1) 在明显的直观意义上，如果您在他的两个示例行之后 print(b) （或该语言中的任何正确语句），您将得到“hello”作为结果。
(2) 严格意义上说，变量 b 不包含**“** h”、“hello”或任何字符串值。它包含对字符串对象的引用。

变量 b 的内容确实会因赋值而改变——它从指向字符串对象“h”的点变为指向字符串对象“hello”的指针。

当他们说“持有”时，他们真正的意思是“指向”。他们错了，赋值后 b 不再指向“h”。

我认为他们真正想举的例子是：

```
string a = "h";
string b = a;
b += "ello"; 
```

我相信，重点是 a 仍然指向“h”；即，对 b 的赋值不会修改它指向的对象，它会创建一个新对象并将 b 更改为指向它。

（我实际上并没有编写 C#，但这是我的理解。）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-09T15:21:13.003

文档是错误的。变量 b 现在保存“hello”。字符串是不可变的，但可以重新分配变量。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-09T15:22:30.007

这里的误解是关于**引用类型**：
**字符串是引用类型**，而不是值类型。这意味着，您的变量**b 不是**字符串类型的对象，它是对内存中字符串类型**对象的引用。**
文档所说的是，**内存中的对象是不可变的**。
不过，**您对对象的引用可以更改**为指向内存中的某个其他（不可变）对象。
对你来说，看起来对象的内容已经改变了，但在内存中并没有改变，这就是*不可变*事物的全部内容。

字符串本身**是**不可变的。您的示例更改的不是内存中的字符串类，而是您的变量指向的引用。

请参阅此稍作修改的代码：

```
string b = "h";
string m1 = b;
b += "ello";
// now b == "hello", m1 == "h" 
```

最后 b 将指向“hello”，而 m1 将指向“h”。对您而言，“h”似乎已更改为“hello”，但事实并非如此。b+="ello" 创建了一个包含 "hello" 的新字符串类并将其分配给 b，而旧的 b 仍然存在于内存中并且仍然包含 "b"。

如果字符串不是不可变的，m1 也将包含“hello”，而不仅仅是“b”，因为 b 和 m1 都指向同一个引用。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-09T15:10:48.360

是的，文档是错误的。（许多字符串方法的文档也暗示了可变性。它们基本上写得不好。）

哎呀，即使使用“编译器”创建新的字符串对象也是关闭的。基本上它在做：

```
string b = "h";
b = string.Concat(b, "ello"); 
```

至此，编译器的工作就完成了——它是创建新字符串对象的框架。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-09T15:12:00.153

字符串不能更改，但可以为字符串变量分配不同的值。你正在做的更接近：

```
string b = "h";
string temp = b + "ello";
b = temp; 
```

为了显示字符串的实际不变性，这将失败：

```
 string b="hello";
   if(b[0] == 'h')  // we can read via indexer
      b[0] = 'H';   // but this will fail. 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-09T15:10:26.800

现在有三个字符串。一个是原始的“h”，一个是“hello”，第三个是“hello”。您的 b 变量指向“hello”字符串。其他两个字符串没有对它们的引用，可以被垃圾收集器丢弃。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-09T16:13:31.183

尝试这个：

```
string b = "h";
string c = b + "ello";    // b still == "h", c = "hello"
string d = string.concat(b, "ello"); // d == hello, b still "h" 
```

为什么 b 仍然是 "h" ？因为“b”不是一个对象，它是一个对象**引用**。您无法对 b 引用的对象进行任何更改来更改它。如果字符串可变，则使用：

```
string b = "ello";
string f = b.Insert("h",0); 
```

会将 b 修改为“hello”（因为 h 被插入到位置 0 ）但由于它是不可变的 b 仍然是“hello”。

如果您更改对其他对象的引用，那就不同了。

```
b = "ello";
b = "Some other string";
// b not references "Some other string" , but the object "ello" remains unchanged. 
```

我希望它有所帮助（并且有效：S）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-09T15:36:59.260

我不知道 C# 做了什么，但我确实在 Java 中读到过这个，基于 Java 的实现会更像这样：

字符串 b = "h" ;

b = (new StringBuilder(b)).Append("ello").ToString() ;

关键是字符串不存在“+”或“附加”，因为字符串是不可变的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-09T17:41:36.170

简单来说，字符串不能原地修改（如果字符串是字符数组）

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-06-27T21:07:49.370

将所有类类型的存储位置视为持有“对象 ID”可能是最清楚的。假设，最初，编译器已分配`ID #123`给字符串“h”并已分配`ID #547`给字符串“ello”。然后在语句之后`b = "h";`，变量`b`将保持不变`ID #123`。该语句`b += "ello";`将导致编译器将`ID #123`和传递`ID #547`给`+`字符串运算符，然后将它们传递给`String.Concat`方法。该方法将依次要求系统创建一个类型为、包含五个字符的新对象（例如`ID #915`），并将该对象返回给调用者。然后编译器将存储到.`System.String``"hello"``ID #915``b`

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-09T15:14:05.513

字符串 b = "h"; b +=“你好”；

b 只是对堆中对象的引用。实际上，在 "+=" 操作之后，b 不再引用原来的 "h"。现在，它引用了一个新的字符串对象“hello”，它是“h”和“ello”的连接。“h”字符串将被 GC 收集。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-09T15:15:16.793

发生的事情是您正在创建一个包含“hello”的新变量，然后更改 b 以引用它，“旧”b 的内存仍然包含“h”，但不再需要它，因此垃圾收集器将清理它了。这就是为什么在迭代和粘贴字符串时使用字符串生成器非常好 - 请参阅[此](http://www.c-sharpcorner.com/UploadFile/mahesh/StringBuilderComp11232005235258PM/StringBuilderComp.aspx)了解更多信息。

# c++ - 将浮点数转换为定点数

> ID：187713
> 
> 赞同：24
> 
> 时间：2008-10-09T15:10:07.597
> 
> 标签：c++, fixed-point

在 C++ 中，将任何浮点值 (float) 转换为[**定点**](http://en.wikipedia.org/wiki/Fixed-point_arithmetic)(int、16:16 或 24:8) 的通用方法是什么？

**编辑：**为澄清起见，定点值有两个部分：整数部分和小数部分。整数部分可以用有符号或无符号整数数据类型表示。小数部分由无符号数据整数数据类型表示。

为了清楚起见，让我们用金钱做一个类比。小数部分可能代表美分——一美元的小数部分。'cents' 数据类型的范围是 0 到 99。如果将 8 位无符号整数用于定点数学，那么小数部分将被分成 256 个可整除的部分。

我希望这能解决问题。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-10-09T15:27:11.447

干得好：

```
// A signed fixed-point 16:16 class
class FixedPoint_16_16
{
    short          intPart;
    unsigned short fracPart;

public:
    FixedPoint_16_16(double d)
    {
        *this = d; // calls operator=
    }

    FixedPoint_16_16& operator=(double d)
    {
        intPart = static_cast<short>(d);
        fracPart = static_cast<unsigned short>
                    (numeric_limits<unsigned short> + 1.0)*d);
        return *this;
    }

    // Other operators can be defined here
}; 
```

**编辑：**这是一个更通用的类，它基于另一种处理定点数的常用方法（KPexEA 指出）：

```
template <class BaseType, size_t FracDigits>
class fixed_point
{
    const static BaseType factor = 1 << FracDigits;

    BaseType data;

public:
    fixed_point(double d)
    {
        *this = d; // calls operator=
    }

    fixed_point& operator=(double d)
    {
        data = static_cast<BaseType>(d*factor);
        return *this;
    }

    BaseType raw_data() const
    {
        return data;
    }

    // Other operators can be defined here
};

fixed_point<int, 8> fp1;           // Will be signed 24:8 (if int is 32-bits)
fixed_point<unsigned int, 16> fp1; // Will be unsigned 16:16 (if int is 32-bits) 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-10-09T15:29:14.407

从浮点数到整数的转换将丢弃小数部分，因此如果您想将该分数保持为固定点，那么您只需在转换之前乘以浮点数。下面的代码不会检查溢出提醒你。

如果你想要 16:16

```
double f = 1.2345;
int n;

n=(int)(f*65536); 
```

如果你想要 24:8

```
double f = 1.2345;
int n;

n=(int)(f*256); 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-09T16:11:50.330

**** 编辑** ：*我的第一条评论适用于凯文的编辑之前，但我会把它留在这里以供后代使用。有时这里的答案变化如此之快！*

Kevin 方法的问题在于，使用 Fixed Point，您通常会打包成有保证的字长（通常为 32 位）。分别声明这两个部分会让您随心所欲地使用编译器的结构包装。是的，你可以强制它，但它不适用于 16:16 表示以外的任何东西。

KPexEA 通过将所有内容打包到 int 中更接近标记 - 尽管我会使用“signed long”来尝试在 32 位上显式。然后你可以使用他的方法来生成定点值，并且位切片会再次提取组成部分。他的建议也涵盖了 24:8 的情况。

（以及其他只建议 static_cast 的人......你在想什么？；））

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-31T13:29:24.227

我把答案给了写出最佳答案的人，但我确实使用了指向[此处](https://web.archive.org/web/20080917044553/http://www.codef00.com/coding.php)的相关问题代码。

它使用模板并且很容易放弃对 boost 库的依赖。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-09T15:28:02.523

这对于从浮点数转换为整数很好，但 OP 也需要[定点数](http://en.wikipedia.org/wiki/Fixed-point_arithmetic)。

现在你如何在 C++ 中做到这一点，我不知道（C++ 不是我能轻易想到的东西）。或许可以尝试使用缩放整数方法，即使用 32 位或 64 位整数并以编程方式将最后一位（例如 6 位）分配给小数点右侧的内容。

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2008-10-09T15:32:18.007

C++ 中没有对定点数的任何内置支持。您最好的选择是编写一个包装器“FixedInt”类，它接受双打并转换它们。

至于转换的通用方法...... int 部分很容易，只需获取值的整数部分并将其存储在高位中......小数部分将类似于以下内容：

```
for (int i = 1; i <= precision; i++)
{
   if (decimal_part > 1.f/(float)(i + 1)
   {
      decimal_part -= 1.f/(float)(i + 1);
      fixint_value |= (1 << precision - i);
   }
} 
```

尽管这可能仍然包含错误

# php - PHP中的命令行密码提示

> ID：187736
> 
> 赞同：81
> 
> 时间：2008-10-09T15:13:38.043
> 
> 标签：php, passwords

我正在编写一个命令行工具来帮助我的网络应用程序。它需要密码才能连接到服务。我希望脚本显示密码提示，因此我不必将其作为命令行参数传递。

这很容易，但我希望它不会在输入密码时将密码回显到屏幕上。我怎样才能用 PHP 做到这一点？

在纯 PHP 中执行此操作（否`system('stty')`）并将字符替换为`*`.

**编辑：**

该脚本将在类似 unix 的系统（linux 或 mac）上运行。该脚本是用 PHP 编写的，并且很可能会保持这种状态。

另外，为了记录，`stty`这样做的方式是：

```
echo "Password: ";
system('stty -echo');
$password = trim(fgets(STDIN));
system('stty echo');
// add a new line since the users CR didn't echo
echo "\n"; 
```

我宁愿没有`system()`电话在那里。

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-11-04T14:41:55.480

[在sitepoint](http://www.sitepoint.com/blogs/2009/05/01/interactive-cli-password-prompt-in-php/)上找到。

```
function prompt_silent($prompt = "Enter Password:") {
  if (preg_match('/^win/i', PHP_OS)) {
    $vbscript = sys_get_temp_dir() . 'prompt_password.vbs';
    file_put_contents(
      $vbscript, 'wscript.echo(InputBox("'
      . addslashes($prompt)
      . '", "", "password here"))');
    $command = "cscript //nologo " . escapeshellarg($vbscript);
    $password = rtrim(shell_exec($command));
    unlink($vbscript);
    return $password;
  } else {
    $command = "/usr/bin/env bash -c 'echo OK'";
    if (rtrim(shell_exec($command)) !== 'OK') {
      trigger_error("Can't invoke bash");
      return;
    }
    $command = "/usr/bin/env bash -c 'read -s -p \""
      . addslashes($prompt)
      . "\" mypassword && echo \$mypassword'";
    $password = rtrim(shell_exec($command));
    echo "\n";
    return $password;
  }
} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-09T17:40:42.707

根据您的环境（即，不在 Windows 上），您可以使用 ncurses 库（特别是[ncurses_noecho()](http://us.php.net/manual/en/function.ncurses-noecho.php)函数来停止键盘回显和[ncurses_getch()](http://us.php.net/manual/en/function.ncurses-getch.php)来读取输入）来获取密码而不在屏幕上显示它。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2012-08-25T22:21:47.833

您可以使用我的[hiddeninput.exe](https://github.com/Seldaek/hidden-input)文件来获得真正的隐藏输入，而不会在屏幕上的任何地方泄漏信息。

```
<?php

echo 'Enter password: ';
$password = exec('hiddeninput.exe');
echo PHP_EOL;

echo 'Password was: ' . $password . PHP_EOL; 
```

如果您删除最后一个回显，则密码永远不会出现，但您可以将其用于验证。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2018-08-08T13:00:36.353

以下方法适用于 Linux CLI，但不适用于 Windows CLI 或 Apache。它也仅适用于标准 Ascii 表中的字符（不过，使其与扩展字符集兼容并不需要太多时间）。

我已经输入了一些代码来防止复制和粘贴密码。如果删除了两个注释之间的位，则可以注入/粘贴密码。

我希望这可以帮助别人。

```
<?php

    echo("Password: ");
    $strPassword=getObscuredText();
    echo("\n");
    echo("You entered: ".$strPassword."\n");

    function getObscuredText($strMaskChar='*')
    {
        if(!is_string($strMaskChar) || $strMaskChar=='')
        {
            $strMaskChar='*';
        }
        $strMaskChar=substr($strMaskChar,0,1);
        readline_callback_handler_install('', function(){});
        $strObscured='';
        while(true)
        {
            $strChar = stream_get_contents(STDIN, 1);
            $intCount=0;
// Protect against copy and paste passwords
// Comment \/\/\/ to remove password injection protection
            $arrRead = array(STDIN);
            $arrWrite = NULL;
            $arrExcept = NULL;
            while (stream_select($arrRead, $arrWrite, $arrExcept, 0,0) && in_array(STDIN, $arrRead))            
            {
                stream_get_contents(STDIN, 1);
                $intCount++;
            }
//        /\/\/\
// End of protection against copy and paste passwords
            if($strChar===chr(10))
            {
                break;
            }
            if ($intCount===0)
            {
                if(ord($strChar)===127)
                {
                    if(strlen($strObscured)>0)
                    {
                        $strObscured=substr($strObscured,0,strlen($strObscured)-1);
                        echo(chr(27).chr(91)."D"." ".chr(27).chr(91)."D");
                    }
                }
                elseif ($strChar>=' ')
                {
                    $strObscured.=$strChar;
                    echo($strMaskChar);
                    //echo(ord($strChar));
                }
            }
        }
        readline_callback_handler_remove();
        return($strObscured);
    }
?> 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-09-07T02:18:56.940

这是适用于所有平台的最简单的解决方案：

```
function prompt($message = 'prompt: ', $hidden = false) {
    if (PHP_SAPI !== 'cli') {
        return false;
    }
    echo $message;
    $ret = 
        $hidden
        ? exec(
            PHP_OS === 'WINNT' || PHP_OS === 'WIN32'
            ? __DIR__ . '\prompt_win.bat'
            : 'read -s PW; echo $PW'
        )
        : rtrim(fgets(STDIN), PHP_EOL)
    ;
    if ($hidden) {
        echo PHP_EOL;
    }
    return $ret;
} 
```

然后`prompt_win.bat`在同一目录下创建：

```
SetLocal DisableDelayedExpansion
Set "Line="
For /F %%# In ('"Prompt;$H & For %%# in (1) Do Rem"') Do (
    Set "BS=%%#"
)

:loop_start
    Set "Key="
    For /F "delims=" %%# In ('Xcopy /L /W "%~f0" "%~f0" 2^>Nul') Do (
        If Not Defined Key (
            Set "Key=%%#"
        )
    )
    Set "Key=%Key:~-1%"
    SetLocal EnableDelayedExpansion
    If Not Defined Key (
        Goto :loop_end
    )
    If %BS%==^%Key% (
        Set "Key="
        If Defined Line (
            Set "Line=!Line:~0,-1!"
        )
    )
    If Not Defined Line (
        EndLocal
        Set "Line=%Key%"
    ) Else (
        For /F "delims=" %%# In ("!Line!") Do (
            EndLocal
            Set "Line=%%#%Key%"
        )
    )
    Goto :loop_start
:loop_end

Echo;!Line! 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-09T15:28:45.657

我想如果不使用 stty -echo 就没有简单的方法（实际上我想不出任何方法）。如果您打算在 Windows 上运行它，您可以创建一个批处理脚本，为您的 php 脚本提供未回显的类型信息。

```
@echo off
cls
SET /P uname=Enter Username:
echo hP1X500P[PZBBBfh#b##fXf-V@`$fPf]f3/f1/5++u5>in.com
set /p password=Enter password :<nul
for /f “tokens=*” %%i in (’in.com’) do set password=%%i
del in.com
echo.
c:\php\php.exe d:\php\test.php %uname% “%password%”
Pause 
```

示例取自[http://www.indiangnu.org/2008/php-hide-user-input-using-batch-script-windows/](http://www.indiangnu.org/2008/php-hide-user-input-using-batch-script-windows/)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-09-03T18:19:37.177

**适用于具有 powershell 支持的每个 Windows 系统。**（来源：[http](http://www.qxs.ch/2013/02/08/php-cli-password-prompts-on-windows-7/) ://www.qxs.ch/2013/02/08/php-cli-password-prompts-on-windows-7/ ）

```
<?php
// please set the path to your powershell, here it is: C:\Windows\system32\WindowsPowerShell\v1.0\powershell.exe
$pwd=shell_exec('C:\Windows\system32\WindowsPowerShell\v1.0\powershell.exe -Command "$Password=Read-Host -assecurestring \"Please enter your password\" ; $PlainPassword = [System.Runtime.InteropServices.Marshal]::PtrToStringAuto([System.Runtime.InteropServices.Marshal]::SecureStringToBSTR($Password)) ; echo $PlainPassword;"');
$pwd=explode("\n", $pwd); $pwd=$pwd[0];
echo "You have entered the following password: $pwd\n"; 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-06-21T15:26:35.180

接受的答案还不够好。首先，Windows 解决方案不适用于 Windows 7 及更高版本。其他操作系统的解决方案取决于 Bash 和 bash 内置的“读取”。但是，有些系统不使用 Bash（例如 OpenBSD），这显然是行不通的。

在这篇[博客](https://blog.dsl-platform.com/hiding-input-from-console-in-php/)中，我讨论了适用于几乎所有基于 Unix 的操作系统和从 95 到 8 的 Windows 的解决方案。Windows 解决方案使用基于 Win32 API 的 C 语言编写的外部程序。其他操作系统的解决方案使用外部命令“stty”。我还没有看到没有“stty”的基于 Unix 的系统

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-09T18:03:28.810

为什么不使用 SSH 连接？您可以将命令抽象出来，重定向输入/输出并拥有完全控制权。

您可以为某人提供一个具有尽可能少的权限的纯净外壳，并让密码与 SSH2::Connect() 一起发布以打开外壳。

我创建了一个很好的类来使用 php SSH2 扩展，也许它可以帮助你；（而且它还可以保护文件传输）

```
<?php

/**
 * SSH2
 * 
 * @package Pork
 * @author SchizoDuckie
 * @version 1.0
 * @access public
 */
class SSH2
{
    private $host;
    private $port;
    private $connection;
    private $timeout;
    private $debugMode;
    private $debugPointer;
    public $connected; 
    public $error;

    /**
     * SSH2::__construct()
     * 
     * @param mixed $host
     * @param integer $port
     * @param integer $timeout
     * @return
     */
    function __construct($host, $port=22, $timeout=10)
    {
        $this->host = $host;
        $this->port = $port;
        $this->timeout = 10;
        $this->error = 'not connected';
        $this->connection = false;
        $this->debugMode = Settings::Load()->->get('Debug', 'Debugmode');
        $this->debugPointer = ($this->debugMode) ? fopen('./logs/'.date('Y-m-d--H-i-s').'.log', 'w+') : false;
        $this->connected = false;

    }

    /**
     * SSH2::connect()
     * 
     * @param mixed $username
     * @param mixed $password
     * @return
     */
    function connect($username, $password)
    {
        $this->connection = ssh2_connect($this->host, $this->port);
        if (!$this->connection) return $this->error("Could not connect to {$this->host}:{$this->port}");
        $this->debug("Connected to {$this->host}:{$this->port}");
        $authenticated = ssh2_auth_password($this->connection, $username, $password);
        if(!$authenticated) return $this->error("Could not authenticate: {$username}, check your password");
        $this->debug("Authenticated successfully as {$username}");
        $this->connected = true;

        return true;
    }

    /**
     * SSH2::exec()
     *
     * @param mixed $command shell command to execute
     * @param bool $onAvailableFunction a function to handle any available data.
     * @param bool $blocking blocking or non-blocking mode. This 'hangs' php execution until the command has completed if you set it to true. If you just want to start an import and go on, use this icm onAvailableFunction and false
     * @return
     */
    function exec($command, $onAvailableFunction=false, $blocking=true)
    {
        $output = '';
        $stream = ssh2_exec($this->connection, $command);
        $this->debug("Exec: {$command}");
        if($onAvailableFunction !== false)
        {
            $lastReceived = time();
            $timeout =false;
            while (!feof($stream) && !$timeout)
            {
                $input = fgets($stream, 1024);
                if(strlen($input) >0)
                {
                    call_user_func($onAvailableFunction, $input);
                    $this->debug($input);
                    $lastReceived = time();
                }
                else
                {
                    if(time() - $lastReceived >= $this->timeout)
                    {
                        $timeout = true;
                        $this->error('Connection timed out');
                        return($this->error);
                    }
                }
            }
        }
        if($blocking === true && $onAvailableFunction === false)
        {
            stream_set_blocking($stream, true);
            $output = stream_get_contents($stream);
            $this->debug($output);
        }
        fclose($stream);
        return($output);
    }

    /**
     * SSH2::createDirectory()
     *
     * Creates a directory via sftp
     *
     * @param string $dirname
     * @return boolean success
     *  
     */
    function createDirectory($dirname)
    {
        $ftpconnection = ssh2_sftp ($this->connection);
        $dircreated = ssh2_sftp_mkdir($ftpconnection, $dirname, true);
        if(!$dircreated) 
        {
            $this->debug("Directory not created: ".$dirname);
        }
        return $dircreated;
    }

    public function listFiles($dirname)
    {
        $input = $this->exec(escapeshellcmd("ls  {$dirname}"));
        return(explode("\n", trim($input)));

    }

    public function sendFile($filename, $remotename)
    {
        $this->debug("sending {$filename} to {$remotename} ");
        if(file_exists($filename) && is_readable($filename))
        {
            $result = ssh2_scp_send($this->connection, $filename, $remotename, 0664);
        }
        else
        {
            $this->debug("Unable to read file : ".$filename);
            return false;
        }
        if(!$result) $this->debug("Failure uploading {$filename} to {$remotename}");
        return $result;
    }

    public function getFile($remotename, $localfile)
    {
        $this->debug("grabbing {$remotename} to {$localfile}");
        $result = ssh2_scp_recv($this->connection, $remotename, $localfile);

        if(!$result) $this->debug("Failure downloading {$remotename} to {$localfile}");
        return $result;
    }

    /**
     * SSH2::debug()
     * 
     * @param mixed $message
     * @return
     */
    function debug($message) 
    {
        if($this->debugMode)
        {
            fwrite($this->debugPointer, date('Y-m-d H:i:s')." : ".$message."\n");
        }
    }

    /**
     * SSH2::error()
     * 
     * @param mixed $errorMsg
     * @return
     */
    function error($errorMsg) 
    {
        $this->error = $errorMsg;
        $this->debug($errorMsg);
        return false;
    }   

    /**
     * SSH2::__destruct()
     * 
     * @return
     */
    function __destruct() 
    {
        if($this->connection){
            $this->connection = null;
        }
        if($this->debugMode && $this->debugPointer)
        {
            fclose($this->debugPointer);
        }
    }       

} 
```

使用示例：

```
$settings = Settings::Load()->Get("SecureServer");
$ssh = new SSH2($settings['host']);
if( $ssh->connect($settings['username'], $settings['password']))
{
    echo $ssh->exec("ls -la ".$settings['path'], false, true);  
    flush();    
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-18T13:12:13.153

理论上你可以使用 stream_set_blocking() 来做到这一点，但看起来有一些 PHP 错误管理 STDIN。

看： http://bugs.php.net/bug.php? [id =](http://bugs.php.net/bug.php?id=36030) [34972 http://bugs.php.net/bug.php?id=36030](http://bugs.php.net/bug.php?id=34972)

自己试试：

```
echo "Enter Password: ";
$stdin = fopen('php://stdin','r');
// Trying to disable stream blocking
stream_set_blocking($stdin, FALSE) or die ('Failed to disable stdin blocking');
// Trying to set stream timeout to 1sec
stream_set_timeout ($stdin, 1) or die ('Failed to enable stdin timeout');
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-12-02T19:45:59.440

```
system('stty -echo'); 
```

禁用当前终端回显，并且：

```
system('stty echo'); 
```

重新启用它。前后设置`fgets`。

# continuous-integration - 与 Nant 持续集成

> ID：187741
> 
> 赞同：3
> 
> 时间：2008-10-09T15:14:53.923
> 
> 标签：continuous-integration, build-automation, nant, automated-tests

我准备第一次使用持续集成。我将使用 Nant 进行自动化构建和测试任务，并尝试找到合适的 CI 工具来轮询存储库并执行 Nant 脚本。

到目前为止，我已经大致研究了以下内容：

*   哈德逊
*   巡航控制
*   德拉科

到目前为止，我的感觉是，由于大部分工作将由 Nant 完成，Draco 会很好，因为它应该很容易安装/设置。另一方面，Cruise Control 和 Hudson 可能会提供更好的报告选项。

将 Nant 用于构建和测试任务时，执行持续集成的最佳方式是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-09T15:35:02.697

我们使用[CruiseControl.NET](http://confluence.public.thoughtworks.org/display/CCNET)作为我们的 CI 服务器以及我们在 NAnt 中的完整构建系统。在过去的 5 年里，它运行得非常好。从那以后，我研究了其他替代方案，但找不到任何令人信服的理由来切换。

CruiseControl.NET 对不同的源代码控制系统有着惊人的支持。此外，我喜欢他们的应用程序的可扩展性，因为我们已经构建了一些集成到其中的系统。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-10T18:30:07.417

你看过[TeamCity](http://www.jetbrains.com/teamcity/)吗？我将它用于我的个人项目。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-09T15:21:10.557

我不能代表列出的应用程序，但我是 buildbot 的忠实粉丝：http:
[//buildbot.net/trac](http://buildbot.net/trac)

它将在任何运行 Python 的平台上构建/测试（因此，如果您的软件应该在多个操作系统上工作，每个操作系统都可以覆盖），它非常易于使用，并且具有极强的可扩展性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-09T15:24:00.067

我建议使用 CruiseControl.NET 而不是普通的 CruiseControl，尽管我在这里的经验有限。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-09T15:24:47.117

我不敢说哪个最好，但是 CruiseControl.NET 确实工作得很好，尤其是基于 NAnt 的构建。不过，就个人而言，它是我唯一使用过的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-10T17:56:38.687

巡航控制似乎是事实上的标准（尽管我没有数据支持）。

您可能会考虑的另一个选择（尽管我没有尝试过）是 ThoughtWorks 的新 Cruise 产品（请参阅[http://studios.thoughtworks.com/cruise-continuous-integration](http://studios.thoughtworks.com/cruise-continuous-integration)）。几年前，ThoughtWorks 开发人员是 Cruise Control 的父亲/母亲。最多两个“代理”免费。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-27T10:34:17.167

我们已经开始在我的公司使用 TeamCity，我必须说我对这款产品印象深刻。我们之前尝试过 CruiseControl.NET，但 TeamCity 更容易配置，而且配置更加透明，因为您可以从 Web GUI 控制几乎所有内容。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-27T10:47:43.007

正如其他人已经建议的那样，我会说[TeamCity](http://www.jetbrains.com/teamcity)。你可能还要等到本周末，因为他们的新版本（TC 4.0）将会发布（也许今天，也许明天）......

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-16T19:32:59.327

我们使用 CruiseControl.NET 并利用它的预处理器。

对于 NAnt 部分，我们使用 UppercuT。UppercuT 使用 NAnt 来构建，它是非常容易使用的构建框架。

[http://code.google.com/p/uppercut/](http://code.google.com/p/uppercut/)

这里有一些很好的解释：[Uppercut](http://ferventcoder.com/category/10094.aspx)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-01-24T08:23:35.787

我们公司使用 Hudson 和 NAnt。从我的角度来看，它工作得很好。

# c# - 如何判断类属性是否具有公共集 (.NET)？

> ID：187742
> 
> 赞同：6
> 
> 时间：2008-10-09T15:14:54.857
> 
> 标签：c#, .net, data-binding, reflection

我有这个：

```
public string Log
        {
            get { return log; }
            protected set
            {
                if (log != value)
                {
                    MarkModified(PropertyNames.Log, log);
                    log = value;
                }
            }

        } 
```

我的数据绑定实用程序类这样做：

```
PropertyInfo pi = ReflectionHelper.GetPropertyInfo(boundObjectType, sourceProperty);

if (!pi.CanWrite)
                SetReadOnlyCharacteristics(boundEditor); 
```

但是 PropertyInfo.CanWrite 不关心该集合是否可公开访问，只关心它是否存在。

我如何确定是否有**公共**集，而不仅仅是**任何**集？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-09T15:20:55.720

您需要使用[BindingFlags](http://msdn.microsoft.com/en-us/library/system.reflection.bindingflags.aspx)。就像是

```
PropertyInfo property = type.GetProperty("MyProperty", BindingFlags.Public | BindingFlags.SetProperty | BindingFlags.Instance); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-09T15:22:11.723

在 PropertyInfo 上调用 GetSetMethod，获取 MethodInfo 并检查其属性，如 IsPublic。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T15:24:13.717

在其他答案中建议对 ReflectionHelper 进行更改的替代方法是调用`pi.GetSetMethod(false)`并查看结果是否为空。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-09T15:21:30.070

在您的 ReflectionHelper.GetPropertyInfo() 中，您大概是一个 boundObjectType.GetType().GetProperties()，其中 BindingFlags 参数显然包括 BindingFlags.NonPublic。您只想指定 BindingFlags.Public

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-09T15:24:14.870

嗯，这有点难说，因为你有一个“ReflectionHelper”类，我们看不到源。但是，我的第一个猜测是您在调用 Type.GetProperty 时没有正确设置 BindingFlags 属性。您需要在 Public 枚举标志中进行 OR 以确保仅返回 Public 值。

# linux - VisualStudio2005 调试到远程 Linux 网络服务器

> ID：187749
> 
> 赞同：1
> 
> 时间：2008-10-09T15:16:52.687
> 
> 标签：linux, visual-studio-2005, debugging

我正在调试 VisualStudio 2005 网络服务客户端软件，访问 Linux 网络服务器。VisualStudio 有 MSVSMON.exe 用于远程调试网络服务器代码。是否有适用于 Linux 的等效调试监视器？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-09T15:19:58.997

[是](http://tirania.org/blog/archive/2008/Sep-04.html)的，但它还没有完全准备好。您可以注册预览版（您没有指定哪种语言，但如果是 C# 或 VB.Net，这应该可以）。

# multithreading - 递归锁（互斥锁）与非递归锁（互斥锁）

> ID：187761
> 
> 赞同：195
> 
> 时间：2008-10-09T15:19:13.757
> 
> 标签：multithreading, locking, mutex, deadlock, recursive-mutex

POSIX 允许互斥体是递归的。这意味着同一个线程可以两次锁定同一个互斥体并且不会死锁。当然也需要解锁两次，否则其他线程无法获得互斥量。并非所有支持 pthread 的系统也支持递归互斥锁，但如果它们想要[符合 POSIX 标准，它们必须](http://www.opengroup.org/onlinepubs/009695399/functions/pthread_mutexattr_gettype.html).

其他 API（更高级的 API）通常也提供互斥锁，通常称为锁。一些系统/语言（例如 Cocoa Objective-C）同时提供递归和非递归互斥锁。有些语言也只提供一种或另一种。例如，在 Java 中，互斥锁总是递归的（同一个线程可能在同一个对象上“同步”两次）。根据它们提供的其他线程功能，没有递归互斥锁可能没有问题，因为它们可以很容易地自己编写（我已经在更简单的互斥锁/条件操作的基础上自己实现了递归互斥锁）。

我不太明白：非递归互斥锁有什么用？如果它两次锁定同一个互斥锁，为什么我会想要一个线程死锁？即使是可以避免这种情况的高级语言（例如测试这是否会死锁并抛出异常）通常也不会这样做。他们会让线程死锁。

这仅适用于我不小心将其锁定两次并且仅将其解锁一次的情况，并且在递归互斥锁的情况下，将更难找到问题，因此我立即将其死锁以查看不正确的锁定出现在哪里？但是我不能在解锁时返回一个锁计数器做同样的事情吗？在我确定我释放了最后一个锁并且计数器不为零的情况下，我可以抛出异常或记录问题吗？还是我没有看到其他更有用的非递归互斥锁用例？或者它可能只是性能，因为非递归互斥体可能比递归互斥体稍微快一点？但是，我对此进行了测试，差异确实没有那么大。

* * *

## 回答 #1

> 赞同：162
> 
> 时间：2008-10-10T01:09:43.910

递归和非递归互斥体之间的区别与所有权有关。在递归互斥锁的情况下，内核必须跟踪第一次实际获得互斥锁的线程，以便它可以检测递归与应该阻塞的不同线程之间的差异。正如另一个答案所指出的那样，在存储此上下文的内存以及维护它所需的周期方面，都存在额外开销的问题。

*但是*，这里也有其他考虑因素。

因为递归互斥体具有所有权感，所以抓取互斥体的线程必须是释放互斥体的同一线程。在非递归互斥锁的情况下，没有所有权感，任何线程通常都可以释放互斥锁，无论哪个线程最初获取互斥锁。在许多情况下，这种类型的“互斥锁”实际上更像是一种信号量操作，您不必将互斥锁用作排除设备，而是将其用作两个或多个线程之间的同步或信号设备。

互斥体中的另一个具有所有权感的属性是支持优先级继承的能力。因为内核可以跟踪拥有互斥锁的线程以及所有阻塞器的身份，所以在优先级线程系统中，可以将当前拥有互斥锁的线程的优先级提升到最高优先级线程的优先级当前在互斥锁上阻塞。这种继承防止了在这种情况下可能发生的优先级反转问题。（请注意，并非所有系统都支持此类互斥体的优先级继承，但这是通过所有权概念成为可能的另一个功能）。

如果你参考经典的 VxWorks RTOS 内核，它们定义了三种机制：

*   **mutex** - 支持递归和可选的优先级继承。这种机制通常用于以连贯的方式保护数据的关键部分。
*   **二进制信号量**- 无递归，无继承，简单排除，接受者和给予者不必是同一个线程，广播发布可用。这种机制可用于保护关键部分，但对于线程之间的连贯信号或同步也特别有用。
*   **计数信号量**- 没有递归或继承，作为任何所需初始计数的一致资源计数器，线程仅在对资源的净计数为零时阻塞。

同样，这会因平台而有所不同——尤其是他们所说的这些东西，但这应该代表了正在发挥作用的概念和各种机制。

* * *

## 回答 #2

> 赞同：131
> 
> 时间：2008-11-16T07:44:44.377

答案*不是*效率。不可重入的互斥锁会带来更好的代码。

示例： A::foo() 获取锁。然后它调用 B::bar()。当你写它时，它工作得很好。但是不久之后有人将 B::bar() 更改为调用 A::baz()，它也获得了锁。

好吧，如果您没有递归互斥锁，就会出现死锁。如果你确实有它们，它会运行，但它可能会中断。A::foo() 可能在调用 bar() 之前使对象处于不一致的状态，假设 baz() 无法运行，因为它也获取了互斥锁。但它可能不应该运行！写 A::foo() 的人假设没有人可以同时调用 A::baz() ——这就是这两个方法都获得锁的全部原因。

使用互斥锁的正确思维模型：互斥锁保护不变量。当互斥锁被持有时，不变量可能会改变，但在释放互斥锁之前，不变量会重新建立。可重入锁很危险，因为第二次获得锁时，您不能再确定不变量是否为真。

如果您对可重入锁感到满意，那只是因为您以前不必调试过这样的问题。顺便说一句，Java 现在在 java.util.concurrent.locks 中有不可重入锁。

* * *

## 回答 #3

> 赞同：96
> 
> 时间：2009-08-07T14:20:38.433

[正如戴夫·布滕霍夫本人所写](http://www.zaval.org/resources/library/butenhof1.html)：

“递归互斥锁最大的问题是它们鼓励你完全忘记你的锁定方案和范围。这是致命的。邪恶的。它是“线程吞噬者”。你持有锁的时间绝对最短。句号。总是。如果你调用一个持有锁的东西仅仅是因为你不知道它被持有，或者因为你不知道被调用者是否需要互斥锁，那么你持有它的时间太长了。你将猎枪对准您的应用程序并扣动扳机。您大概开始使用线程来获得并发性；但您只是阻止了并发性。”

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-12-16T11:41:11.630

> 使用互斥锁的正确思维模型：互斥锁保护不变量。

为什么你确定这真的是使用互斥锁的正确心智模型？我认为正确的模型是保护数据而不是不变量。

保护不变量的问题即使在单线程应用程序中也存在，并且与多线程和互斥锁没有共同之处。

此外，如果您需要保护不变量，您仍然可以使用永远不会递归的二进制信号量。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2015-05-29T13:41:01.073

递归互斥锁有用的一个主要原因是在同一线程多次访问方法的情况下。例如，如果互斥锁正在保护银行账户提款，那么如果提款也需要支付费用，那么就必须使用相同的互斥锁。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2015-11-20T14:30:40.813

递归互斥锁的唯一好用例是对象包含多个方法时。当任何方法修改了对象的内容，因此必须在状态再次一致之前锁定对象。

如果这些方法使用其他方法（即：addNewArray() 调用 addNewPoint()，并使用 recheckBounds() 完成），但这些函数中的任何一个都需要锁定互斥锁，那么递归互斥锁是双赢的。

对于任何其他情况（解决糟糕的编码，甚至在不同的对象中使用它）显然是错误的！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2020-06-03T17:05:41.777

> 非递归互斥锁有什么用？

当您必须确保在做某事之前**解锁互斥锁时，它们绝对是好的。**这是因为`pthread_mutex_unlock`可以保证互斥体只有在非递归的情况下才会解锁。

```
pthread_mutex_t      g_mutex;

void foo()
{
    pthread_mutex_lock(&g_mutex);
    // Do something.
    pthread_mutex_unlock(&g_mutex);

    bar();
} 
```

如果`g_mutex`是非递归的，则保证上面的代码`bar()`在互斥锁*未锁定*的情况下调用。

`bar()`因此，如果碰巧是一个未知的外部函数，它可能会做一些可能导致另一个线程尝试获取相同互斥锁的事情，从而消除死锁的可能性。这种情况在基于线程池的应用程序和分布式应用程序中并不少见，在分布式应用程序中，进程间调用可能会产生一个新线程，而客户端程序员甚至没有意识到这一点。在所有此类情况下，最好仅在释放锁后调用所述外部函数。

如果`g_mutex`是递归的，则根本*无法*确保在拨打电话之前它已解锁。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-10-04T20:10:35.107

恕我直言，大多数反对递归锁的论点（这是我在 20 年的并发编程中 99.9% 的时间使用的）将它们的好坏与其他完全无关的软件设计问题混为一谈。举个例子，“回调”问题，在没有任何多线程相关观点的情况下详尽地阐述了这一问题，例如在[Component software - beyond Object oriented programming](https://rads.stackoverflow.com/amzn/click/com/032175302X)一书中。

一旦你有一些控制反转（例如事件被触发），你就会面临重入问题。与是否涉及互斥锁和线程无关。

```
class EvilFoo {
  std::vector<std::string> data;
  std::vector<std::function<void(EvilFoo&)> > changedEventHandlers;
public:
  size_t registerChangedHandler( std::function<void(EvilFoo&)> handler) { // ...  
  }
  void unregisterChangedHandler(size_t handlerId) { // ...
  }
  void fireChangedEvent() { 
    // bad bad, even evil idea!
    for( auto& handler : changedEventHandlers ) {
      handler(*this);
    }
  }
  void AddItem(const std::string& item) { 
    data.push_back(item);
    fireChangedEvent();
  }
}; 
```

现在，使用上面这样的代码，您会得到所有错误情况，这些情况通常会在递归锁的上下文中命名 - 只是没有任何错误情况。事件处理程序一旦被调用就可以取消注册，这将导致在幼稚编写的`fireChangedEvent()`. `EvilFoo`或者它可以调用导致各种问题的其他成员函数。根本原因是重入。最糟糕的是，这甚至可能不是很明显，因为它可能会在整个事件链中触发事件，最终我们会回到我们的 EvilFoo（非本地）。

所以，重入是根本问题，而不是递归锁。现在，如果您觉得使用非递归锁更安全，那么这样的错误会如何表现出来呢？每当发生意外的重新进入时，就会陷入僵局。并使用递归锁？同样，它会在没有任何锁的代码中体现出来。

所以邪恶的部分`EvilFoo`是事件以及它们是如何实现的，而不是递归锁。`fireChangedEvent()`对于初学者来说，首先需要创建一个副本`changedEventHandlers`并将其用于迭代。

另一个经常进入讨论的方面是首先定义锁应该做什么：

*   保护一段代码不被重新输入
*   保护*资源*不被同时使用（被多个线程）。

我做并发编程的方式，我有后者的心智模型（保护资源）。这是我擅长递归锁的主要原因。如果某些（成员）函数需要锁定资源，它会锁定。如果它在执行它的操作时调用另一个（成员）函数并且该函数也需要锁定 - 它会锁定。而且我不需要“替代方法”，因为递归锁的引用计数与每个函数编写如下内容完全相同：

```
void EvilFoo::bar() {
   auto_lock lock(this); // this->lock_holder = this->lock_if_not_already_locked_by_same_thread())
   // do what we gotta do

   // ~auto_lock() { if (lock_holder) unlock() }
} 
```

一旦事件或类似的构造（访问者？！）开始发挥作用，我不希望通过一些非递归锁来解决所有随之而来的设计问题。

# c# - 我可以在 .NET 中使用 FileInfo.CopyTo() 显示文件复制进度吗？

> ID：187768
> 
> 赞同：31
> 
> 时间：2008-10-09T15:20:53.130
> 
> 标签：c#, .net, copy, fileinfo

我在 c#（.NET 2.0 框架）中创建了一个复制实用程序，用于复制文件、目录和递归子目录等。该程序有一个 GUI，显示正在复制的当前文件、当前文件号（序列）、总数要复制的文件数和复制操作完成的百分比。还有一个进度条，基于当前文件/总文件。

我的问题与复制大文件有关。我一直无法找到一种方法来指示大文件的总复制进度（使用我当前使用 FileInfo.CopyTo 方法的类结构）。作为一种解决方法，我将文件复制操作和 GUI 显示分离到它们自己的线程中，并设置了一个视觉提示来显示工作正在完成。至少用户知道程序没有被冻结并且仍在复制文件。

如果能够根据字节总数显示进度，或者有某种类型的事件从 FileInfo.CopyTo 方法触发，指示从当前文件复制的字节总数，那就更好了。

我知道 FileInfo.Length 属性，所以我确信有一种方法 MacGuyver 我自己的事件基于此，并且在读取更新的事情的 GUI 端有一个处理程序（可能基于检查 FileInfo.Length）。使用某种类型的计时器的目标对象的长度属性？）。

有谁知道我忽略的一种方法。如果我可以避免它，我宁愿不重写我的类以通过流复制字节并以这种方式跟踪它（尽管我认为我可能会坚持走这条路）。

PS - 我现在坚持使用 .NET 2.0 框架，因此任何需要 >= 3.0 中可用功能的解决方案对我来说都不是一个选项。

PPS - 我对任何 .NET 语言种类的解决方案持开放态度，而不仅仅是 c#。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-10-09T15:34:07.487

FileInfo.CopyTo 基本上是 kernel32.dll 中 Win32 API 调用“CopyFile”的包装。此方法不支持进度回调。

但是，CopyFileEx 方法可以，您可以在几分钟内围绕它编写自己的 .NET 包装器，如下所述： [http ://www.pinvoke.net/default.aspx/kernel32.CopyFileEx](https://web.archive.org/web/20200428185128/http://www.pinvoke.net/default.aspx/kernel32.CopyFileEx)

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2011-12-01T13:10:31.880

我还使用了[标记答案](https://stackoverflow.com/a/187842/73025)中提供的实现。然而，我随后创建了一个包装器，以提供更好的™ API 以从 .NET 中使用。

**用法：**

```
XCopy.Copy(networkFile.FullPath, temporaryFilename, true, true, (o, pce) => 
{
    worker.ReportProgress(pce.ProgressPercentage, networkFile);
}); 
```

**执行**

```
/// <summary>
/// PInvoke wrapper for CopyEx
/// http://msdn.microsoft.com/en-us/library/windows/desktop/aa363852.aspx
/// </summary>
public class XCopy
{
    public static void Copy(string source, string destination, bool overwrite, bool nobuffering)
    {
         new XCopy().CopyInternal(source, destination, overwrite, nobuffering, null);            
    }

    public static void Copy(string source, string destination, bool overwrite, bool nobuffering, EventHandler<ProgressChangedEventArgs> handler)
    {            
         new XCopy().CopyInternal(source, destination, overwrite, nobuffering, handler);            
    }

    private event EventHandler Completed;
    private event EventHandler<ProgressChangedEventArgs> ProgressChanged;

    private int IsCancelled;
    private int FilePercentCompleted;
    private string Source;
    private string Destination;        

    private XCopy()
    {
        IsCancelled = 0;
    }

    private void CopyInternal(string source, string destination, bool overwrite, bool nobuffering, EventHandler<ProgressChangedEventArgs> handler)
    {
        try
        {
            CopyFileFlags copyFileFlags = CopyFileFlags.COPY_FILE_RESTARTABLE;
            if (!overwrite)
                copyFileFlags |= CopyFileFlags.COPY_FILE_FAIL_IF_EXISTS;

            if (nobuffering)
                copyFileFlags |= CopyFileFlags.COPY_FILE_NO_BUFFERING;

            Source = source;
            Destination = destination;

            if (handler != null)
                ProgressChanged += handler;

            bool result = CopyFileEx(Source, Destination, new CopyProgressRoutine(CopyProgressHandler), IntPtr.Zero, ref IsCancelled, copyFileFlags);
            if (!result)
                throw new Win32Exception(Marshal.GetLastWin32Error());
        }
        catch (Exception)
        {
            if (handler != null)
                ProgressChanged -= handler;

            throw;
        }
    }

    private void OnProgressChanged(double percent)
    {
        // only raise an event when progress has changed
        if ((int)percent > FilePercentCompleted)
        {
            FilePercentCompleted = (int)percent;

            var handler = ProgressChanged;
            if (handler != null)
                handler(this, new ProgressChangedEventArgs((int)FilePercentCompleted, null));
        }
    }

    private void OnCompleted()
    {
        var handler = Completed;
        if (handler != null)
            handler(this, EventArgs.Empty);
    }

    #region PInvoke

    [DllImport("kernel32.dll", SetLastError = true, CharSet = CharSet.Auto)]
    [return: MarshalAs(UnmanagedType.Bool)]
    private static extern bool CopyFileEx(string lpExistingFileName, string lpNewFileName, CopyProgressRoutine lpProgressRoutine, IntPtr lpData, ref Int32 pbCancel, CopyFileFlags dwCopyFlags);

    private delegate CopyProgressResult CopyProgressRoutine(long TotalFileSize, long TotalBytesTransferred, long StreamSize, long StreamBytesTransferred, uint dwStreamNumber, CopyProgressCallbackReason dwCallbackReason,
                                                    IntPtr hSourceFile, IntPtr hDestinationFile, IntPtr lpData);

    private enum CopyProgressResult : uint
    {
        PROGRESS_CONTINUE = 0,
        PROGRESS_CANCEL = 1,
        PROGRESS_STOP = 2,
        PROGRESS_QUIET = 3
    }

    private enum CopyProgressCallbackReason : uint
    {
        CALLBACK_CHUNK_FINISHED = 0x00000000,
        CALLBACK_STREAM_SWITCH = 0x00000001
    }

    [Flags]
    private enum CopyFileFlags : uint
    {
        COPY_FILE_FAIL_IF_EXISTS = 0x00000001,
        COPY_FILE_NO_BUFFERING = 0x00001000,
        COPY_FILE_RESTARTABLE = 0x00000002,
        COPY_FILE_OPEN_SOURCE_FOR_WRITE = 0x00000004,
        COPY_FILE_ALLOW_DECRYPTED_DESTINATION = 0x00000008
    }

    private CopyProgressResult CopyProgressHandler(long total, long transferred, long streamSize, long streamByteTrans, uint dwStreamNumber,
                                                   CopyProgressCallbackReason reason, IntPtr hSourceFile, IntPtr hDestinationFile, IntPtr lpData)
    {
        if (reason == CopyProgressCallbackReason.CALLBACK_CHUNK_FINISHED)
            OnProgressChanged((transferred / (double)total) * 100.0);

        if (transferred >= total)
            OnCompleted();

        return CopyProgressResult.PROGRESS_CONTINUE;
    }

    #endregion

} 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2014-11-27T22:30:38.417

我知道我参加聚会有点晚了，但我做了一个包装器，`CopyFileEx`它返回 a`Task`并接受 a `CancellationToken`and `IProgress<double>`。不幸的是，它在 .NET 2.0 框架中不起作用，但对于使用 4.5 的任何人，这允许您使用`await`关键字。

```
public static class FileEx
{
    public static Task CopyAsync(string sourceFileName, string destFileName)
    {
        return CopyAsync(sourceFileName, destFileName, CancellationToken.None);
    }

    public static Task CopyAsync(string sourceFileName, string destFileName, CancellationToken token)
    {
        return CopyAsync(sourceFileName, destFileName, token, null);
    }

    public static Task CopyAsync(string sourceFileName, string destFileName, IProgress<double> progress)
    {
        return CopyAsync(sourceFileName, destFileName, CancellationToken.None, progress);
    }

    public static Task CopyAsync(string sourceFileName, string destFileName, CancellationToken token, IProgress<double> progress)
    {
        int pbCancel = 0;
        CopyProgressRoutine copyProgressHandler;
        if (progress != null)
        {
            copyProgressHandler = (total, transferred, streamSize, streamByteTrans, dwStreamNumber, reason, hSourceFile, hDestinationFile, lpData) =>
            {
                progress.Report((double)transferred / total * 100);
                return CopyProgressResult.PROGRESS_CONTINUE;
            };
        }
        else
        {
            copyProgressHandler = EmptyCopyProgressHandler;
        }
        token.ThrowIfCancellationRequested();
        var ctr = token.Register(() => pbCancel = 1);
        var copyTask = Task.Run(() =>
        {
            try
            {
                CopyFileEx(sourceFileName, destFileName, copyProgressHandler, IntPtr.Zero, ref pbCancel, CopyFileFlags.COPY_FILE_RESTARTABLE);
                token.ThrowIfCancellationRequested();
            }
            finally
            {
                ctr.Dispose();
            }
        }, token);
        return copyTask;
    }

    private static CopyProgressResult EmptyCopyProgressHandler(long total, long transferred, long streamSize, long streamByteTrans, uint dwStreamNumber, CopyProgressCallbackReason reason, IntPtr hSourceFile, IntPtr hDestinationFile, IntPtr lpData)
    {
        return CopyProgressResult.PROGRESS_CONTINUE;
    }

    #region DLL Import

    [DllImport("kernel32.dll", SetLastError = true, CharSet = CharSet.Auto)]
    [return: MarshalAs(UnmanagedType.Bool)]
    private static extern bool CopyFileEx(string lpExistingFileName, string lpNewFileName,
       CopyProgressRoutine lpProgressRoutine, IntPtr lpData, ref Int32 pbCancel,
       CopyFileFlags dwCopyFlags);

    delegate CopyProgressResult CopyProgressRoutine(
        long totalFileSize,
        long totalBytesTransferred,
        long streamSize,
        long streamBytesTransferred,
        uint dwStreamNumber,
        CopyProgressCallbackReason dwCallbackReason,
        IntPtr hSourceFile,
        IntPtr hDestinationFile,
        IntPtr lpData);

    enum CopyProgressResult : uint
    {
        PROGRESS_CONTINUE = 0,
        PROGRESS_CANCEL = 1,
        PROGRESS_STOP = 2,
        PROGRESS_QUIET = 3
    }

    enum CopyProgressCallbackReason : uint
    {
        CALLBACK_CHUNK_FINISHED = 0x00000000,
        CALLBACK_STREAM_SWITCH = 0x00000001
    }

    [Flags]
    enum CopyFileFlags : uint
    {
        COPY_FILE_FAIL_IF_EXISTS = 0x00000001,
        COPY_FILE_RESTARTABLE = 0x00000002,
        COPY_FILE_OPEN_SOURCE_FOR_WRITE = 0x00000004,
        COPY_FILE_ALLOW_DECRYPTED_DESTINATION = 0x00000008
    }

    #endregion
} 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-10-09T16:52:04.413

看在上帝的份上，不要使用流实现自己的文件副本！Gaspar 提到的 Win32 CopyFile API 调用能够利用例如 DMA，而我向甜甜圈打赌，Will 编写的代码不会“聪明”到足以做到这一点。

CopyFileEx 会正确对待您，或者您可以实现一个 BackgroundWorker 来监视目标文件的大小并使用该信息更新进度条。后一种方法为您节省了 PInvoke，但从长远来看，前一种方法可能更干净一些。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-10T11:08:06.697

对于这类事情，我已经退回到 Shell32（或者是 ShellUI？我不知道了）。这为您提供了一个用户习惯于在复制操作中看到的本机 Windows 对话框。我想它会取代你已经存在的对话框，所以它可能不是你的正确答案，但记住那些“紧要关头”的场景很有用。

```
Microsoft.VisualBasic.FileIO.FileSystem.CopyFile(
    srcPath, 
    dstPath, 
    Microsoft.VisualBasic.FileIO.UIOption.AllDialogs,    
    Microsoft.VisualBasic.FileIO.UICancelOption.ThrowException
); 
```

是的，您必须引用 Microsoft.VisualBasic 程序集。我已经[爱上](http://www.deploymentzone.com/2008/08/11/microsoftvisualbasic/)了这个集会。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-08-31T04:13:11.067

感谢@Gasper 和@Dennis 指出 CopyFileEx 方法。我用中止副本扩展了丹尼斯的答案

```
 /// <summary>
    /// Type indicates how the copy gets completed.
    /// </summary>
    internal enum CopyCompletedType
    {
        Succeeded,
        Aborted,
        Exception
    }

/// <summary>
/// Event arguments for file copy 
/// </summary>
internal class FileCopyEventArgs : EventArgs
{
    /// <summary>
    /// Constructor
    /// </summary>
    /// <param name="type">type of the copy completed type enum</param>
    /// <param name="exception">exception if any</param>
    public FileCopyEventArgs(CopyCompletedType type, Exception exception)
    {
        Type = type;
        Exception = exception;
    }

    /// <summary>
    /// Type of the copy completed type
    /// </summary>
    public CopyCompletedType Type
    {
        get;
        private set;

    }

    /// <summary>
    /// Exception if any happend during copy.
    /// </summary>
    public Exception Exception
    {
        get;
        private set;
    }

}

/// <summary>
/// PInvoke wrapper for CopyEx
/// http://msdn.microsoft.com/en-us/library/windows/desktop/aa363852.aspx
/// </summary>
internal class XCopy
{

    private int IsCancelled;
    private int FilePercentCompleted;

    public XCopy()
    {
        IsCancelled = 0;
    }

    /// <summary>
    /// Copies the file asynchronously
    /// </summary>
    /// <param name="source">the source path</param>
    /// <param name="destination">the destination path</param>
    /// <param name="nobuffering">Bufferig status</param>
    /// <param name="handler">Event handler to do file copy.</param>
    public void CopyAsync(string source, string destination, bool nobuffering)
    {
        try
        {
            //since we needed an async copy ..
            Action action = new Action(
                () => CopyInternal(source, destination, nobuffering)
                    );
            Task task = new Task(action);
            task.Start();
        }
        catch (AggregateException ex)
        {
            //handle the inner exception since exception thrown from task are wrapped in
            //aggreate exception.
            OnCompleted(CopyCompletedType.Exception, ex.InnerException);
        }
        catch (Exception ex)
        {
            OnCompleted(CopyCompletedType.Exception, ex);
        }
    }

    /// <summary>
    /// Event which will notify the subscribers if the copy gets completed
    /// There are three scenarios in which completed event will be thrown when
    /// 1.Copy succeeded
    /// 2.Copy aborted.
    /// 3.Any exception occured.
    /// These information can be obtained from the Event args.
    /// </summary>
    public event EventHandler<FileCopyEventArgs> Completed;
    /// <summary>
    /// Event which will notify the subscribers if there is any progress change while copying.
    /// This will indicate the progress percentage in its event args.
    /// </summary>
    public event EventHandler<ProgressChangedEventArgs> ProgressChanged;

    /// <summary>
    /// Aborts the copy asynchronously and throws Completed event when done.
    /// User may not want to wait for completed event in case of Abort since 
    /// the event will tell that copy has been aborted.
    /// </summary>
    public void AbortCopyAsync()
    {
        Trace.WriteLine("Aborting the copy");
        //setting this will cancel an operation since we pass the
        //reference to copyfileex and it will periodically check for this.
        //otherwise also We can check for iscancelled on onprogresschanged and return 
        //Progress_cancelled .
        IsCancelled = 1;

        Action completedEvent = new Action(() =>
            {
                //wait for some time because we ll not know when IsCancelled is set , at what time windows stops copying.
                //so after sometime this may become valid .
                Thread.Sleep(500);
                //do we need to wait for some time and send completed event.
                OnCompleted(CopyCompletedType.Aborted);
                //reset the value , otherwise if we try to copy again since value is 1 , 
                //it thinks that its aborted and wont allow to copy.
                IsCancelled = 0;
            });

        Task completedTask = new Task(completedEvent);
        completedTask.Start();
    }

    /// <summary>
    /// Copies the file using asynchronos task
    /// </summary>
    /// <param name="source">the source path</param>
    /// <param name="destination">the destination path</param>
    /// <param name="nobuffering">Buffering status</param>
    /// <param name="handler">Delegate to handle Progress changed</param>
    private void CopyInternal(string source, string destination, bool nobuffering)
    {
        CopyFileFlags copyFileFlags = CopyFileFlags.COPY_FILE_RESTARTABLE;

        if (nobuffering)
        {
            copyFileFlags |= CopyFileFlags.COPY_FILE_NO_BUFFERING;
        }

        try
        {
            Trace.WriteLine("File copy started with Source: " + source + " and destination: " + destination);
            //call win32 api.
            bool result = CopyFileEx(source, destination, new CopyProgressRoutine(CopyProgressHandler), IntPtr.Zero, ref IsCancelled, copyFileFlags);
            if (!result)
            {
                //when ever we get the result as false it means some error occured so get the last win 32 error.
                throw new Win32Exception(Marshal.GetLastWin32Error());
            }
        }
        catch (Exception ex)
        {
            //the mesage will contain the requested operation was aborted when the file copy
            //was cancelled. so we explicitly check for that and do a graceful exit
            if (ex.Message.Contains("aborted"))
            {
                Trace.WriteLine("Copy aborted.");
            }
            else
            {
                OnCompleted(CopyCompletedType.Exception, ex.InnerException);
            }
        }
    }

    private void OnProgressChanged(double percent)
    {
        // only raise an event when progress has changed
        if ((int)percent > FilePercentCompleted)
        {
            FilePercentCompleted = (int)percent;

            var handler = ProgressChanged;
            if (handler != null)
            {
                handler(this, new ProgressChangedEventArgs((int)FilePercentCompleted, null));
            }
        }
    }

    private void OnCompleted(CopyCompletedType type, Exception exception = null)
    {
        var handler = Completed;
        if (handler != null)
        {
            handler(this, new FileCopyEventArgs(type, exception));
        }
    }

    #region PInvoke

    /// <summary>
    /// Delegate which will be called by Win32 API for progress change
    /// </summary>
    /// <param name="total">the total size</param>
    /// <param name="transferred">the transferrred size</param>
    /// <param name="streamSize">size of the stream</param>
    /// <param name="streamByteTrans"></param>
    /// <param name="dwStreamNumber">stream number</param>
    /// <param name="reason">reason for callback</param>
    /// <param name="hSourceFile">the source file handle</param>
    /// <param name="hDestinationFile">the destination file handle</param>
    /// <param name="lpData">data passed by users</param>
    /// <returns>indicating whether to continue or do somthing else.</returns>
    private CopyProgressResult CopyProgressHandler(long total, long transferred, long streamSize, long streamByteTrans, uint dwStreamNumber,
                                                   CopyProgressCallbackReason reason, IntPtr hSourceFile, IntPtr hDestinationFile, IntPtr lpData)
    {
        //when a chunk is finished call the progress changed.
        if (reason == CopyProgressCallbackReason.CALLBACK_CHUNK_FINISHED)
        {
            OnProgressChanged((transferred / (double)total) * 100.0);
        }

        //transfer completed
        if (transferred >= total)
        {
            if (CloseHandle(hDestinationFile))
            {
                OnCompleted(CopyCompletedType.Succeeded, null);
            }
            else
            {
                OnCompleted(CopyCompletedType.Exception,
                    new System.IO.IOException("Unable to close the file handle"));
            }
        }

        return CopyProgressResult.PROGRESS_CONTINUE;
    }
    [System.Runtime.InteropServices.DllImport("Kernel32")]
    private extern static Boolean CloseHandle(IntPtr handle);

    [DllImport("kernel32.dll", SetLastError = true, CharSet = CharSet.Auto)]
    [return: MarshalAs(UnmanagedType.Bool)]
    private static extern bool CopyFileEx(string lpExistingFileName, string lpNewFileName, CopyProgressRoutine lpProgressRoutine, IntPtr lpData, ref Int32 pbCancel, CopyFileFlags dwCopyFlags);

    private delegate CopyProgressResult CopyProgressRoutine(long TotalFileSize, long TotalBytesTransferred, long StreamSize, long StreamBytesTransferred, uint dwStreamNumber, CopyProgressCallbackReason dwCallbackReason,
                                                    IntPtr hSourceFile, IntPtr hDestinationFile, IntPtr lpData);

    private enum CopyProgressResult : uint
    {
        PROGRESS_CONTINUE = 0,
        PROGRESS_CANCEL = 1,
        PROGRESS_STOP = 2,
        PROGRESS_QUIET = 3
    }

    private enum CopyProgressCallbackReason : uint
    {
        CALLBACK_CHUNK_FINISHED = 0x00000000,
        CALLBACK_STREAM_SWITCH = 0x00000001
    }

    [Flags]
    private enum CopyFileFlags : uint
    {
        COPY_FILE_FAIL_IF_EXISTS = 0x00000001,
        COPY_FILE_NO_BUFFERING = 0x00001000,
        COPY_FILE_RESTARTABLE = 0x00000002,
        COPY_FILE_OPEN_SOURCE_FOR_WRITE = 0x00000004,
        COPY_FILE_ALLOW_DECRYPTED_DESTINATION = 0x00000008
    }

    #endregion

} 
```

客户端可以创建 XCopy 类的对象并调用复制/中止方法。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2018-11-10T11:42:10.080

如果有人仍然像我一样偶然发现这个问题（10 年后！），我已经创建了一个围绕 CopyFileEx 和 MoveFileWithProgress 函数的包装器（作为这里的一些答案）以及一些额外的有用功能（例如异步、访问权限检查、字节格式，复制目录...）

在这里检查 - [GitHub](https://github.com/martinchrzan/FileTransferManager)和 [Nuget](https://www.nuget.org/packages/FileTransferManager/)

# sql - 在 SQL Server 中将表从一个数据库复制到另一个数据库

> ID：187770
> 
> 赞同：331
> 
> 时间：2008-10-09T15:20:58.170
> 
> 标签：sql, sql-server, copy, migrate, database-table

我有一个名为 foo 的数据库和一个名为 bar 的数据库。我在 foo 中有一个名为 tblFoobar 的表，我想将（数据和所有）从数据库 foo 移动到数据库 bar。执行此操作的 SQL 语句是什么？

* * *

## 回答 #1

> 赞同：538
> 
> 时间：2008-10-09T15:36:17.950

SQL Server Management Studio 的“导入数据”任务（右键单击数据库名称，然后单击任务）将为您完成大部分工作。从要将数据复制到的数据库中运行它。

如果表不存在，它将为您创建它们，但您可能必须重新创建任何索引等。如果表确实存在，它将默认附加新数据，但您可以调整（编辑映射），以便删除所有现有数据。

我一直都在使用它，而且效果很好。

* * *

## 回答 #2

> 赞同：214
> 
> 时间：2008-10-09T15:22:46.263

在 SQL Server 上？并在同一数据库服务器上？使用三部分命名。

```
INSERT INTO bar..tblFoobar( *fieldlist* )
SELECT *fieldlist* FROM foo..tblFoobar 
```

这只是移动数据。如果要移动表定义（以及其他属性，例如权限和索引），则必须执行其他操作。

* * *

## 回答 #3

> 赞同：113
> 
> 时间：2008-10-09T15:31:50.830

这应该有效：

```
SELECT * 
INTO DestinationDB..MyDestinationTable 
FROM SourceDB..MySourceTable 
```

它**不会**复制约束、默认值或索引。创建的表将**没有**聚集索引。

或者，您可以：

```
INSERT INTO DestinationDB..MyDestinationTable 
SELECT * FROM SourceDB..MySourceTable 
```

如果您的目标表存在并且为空。

* * *

## 回答 #4

> 赞同：46
> 
> 时间：2013-03-20T09:56:22.363

如果只有一张桌子，那么您需要做的就是

*   脚本表定义
*   在另一个数据库中创建新表
*   更新规则、索引、权限等
*   导入数据（上面已经显示了几个插入示例）

您必须考虑的一件事是其他更新，例如将来迁移其他对象。请注意，您的源表和目标表的名称不同。这意味着如果您依赖对象（例如视图、存储过程和其他），您还必须进行更改。

Whit 一个或多个对象，您可以手动进行，没有任何问题。但是，当更新不止一些时，第 3 方比较工具会派上用场。现在我正在使用[ApexSQL Diff](http://www.apexsql.com/sql_tools_diff.aspx)进行架构迁移，但使用其他任何工具都不会出错。

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2008-10-09T15:32:43.183

1.  在管理工作室中编写脚本`create table`，在栏中运行该脚本以创建表。（在对象资源管理器中右键单击表，将表脚本作为，创建到...）

2.  `INSERT bar.[schema].table SELECT * FROM foo.[schema].table`

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2011-10-11T23:41:05.047

您还可以使用**[生成 SQL Server 脚本向导](http://blog.sqlauthority.com/2009/07/29/sql-server-2008-copy-database-with-data-generate-t-sql-for-inserting-data-from-one-table-to-another-table/)**来帮助指导创建可以执行以下操作的 SQL 脚本：

*   复制表架构
*   任何约束（身份、默认值等）
*   表内数据
*   如果需要，还有许多其他选择

**SQL Server 2008**的良好示例工作流，[此处](http://blog.sqlauthority.com/2009/07/29/sql-server-2008-copy-database-with-data-generate-t-sql-for-inserting-data-from-one-table-to-another-table/)显示屏幕截图。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2012-05-06T00:06:54.733

你可以这样去：（一个一般的例子）

```
insert into QualityAssuranceDB.dbo.Customers (columnA, ColumnB)
Select columnA, columnB from DeveloperDB.dbo.Customers 
```

此外，如果您还需要生成列名以放入插入子句，请使用：

```
 select (name + ',') as TableColumns from sys.columns 
where object_id = object_id('YourTableName') 
```

复制结果并粘贴到查询窗口中以表示您的表列名称，即使这也将排除标识列：

```
 select (name + ',') as TableColumns from sys.columns 
where object_id = object_id('YourTableName') and is_identity = 0 
```

请记住，如果数据库属于同一位置，则复制行的脚本将起作用。

* * *

你可以试试这个。

```
select * into <Destination_table> from <Servername>.<DatabaseName>.dbo.<sourceTable> 
```

如果两个数据库位于同一服务器中，则服务器名称是可选的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-11-03T13:05:09.013

我给你三个选择：

如果它们是同一实例上的两个数据库，请执行以下操作：

```
SELECT  * INTO My_New_Table FROM [HumanResources].[Department]; 
```

如果它们是不同服务器上的两个数据库并且您有链接服务器，请执行以下操作：

```
SELECT  * INTO My_New_Table FROM [ServerName].[AdventureWorks2012].[HumanResources].[Department]; 
```

如果它们是不同服务器上的两个数据库并且您没有链接服务器，请执行以下操作：

```
SELECT * INTO My_New_Table
FROM OPENROWSET('SQLNCLI', 'Server=My_Remote_Server;Trusted_Connection=yes;',
     'SELECT * FROM AdventureWorks2012.HumanResources.Department'); 
```

# xml - 测试某种类型的非空元素是否存在......某处

> ID：187774
> 
> 赞同：1
> 
> 时间：2008-10-09T15:21:28.840
> 
> 标签：xml, xslt

我有看起来像的 XML

```
<answers>
   <answer>
      <question-number>1</question-number>
      <value>3</value>
      <mean xsi:nil="1" />
    </answer>
   <answer>
      <question-number>2</question-number>
      <value>2</value>
      <mean>2.3</mean>
    </answer>
   <answer>
      <question-number>3</question-number>
      <value>3</value>
      <mean xsi:nil="1" />
    </answer>
....
</answers> 
```

我正在使用 xsl:for-each 格式化每个答案。如果存在平均值，我有平均值的图形表示。对于一些潜在的答案列表，平均值将始终为空。

在页面底部，我想放一个图例来解释平均值的图形表示。但我只希望它出现在我实际上显示平均值的情况下。所以我希望能够在关闭 xsl:for-each 之后进行检查，以说“是否有任何答案元素具有非空平均值？”。

真的不知道该怎么做。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-09T15:55:58.957

是否有任何答案元素具有非空平均值？基于罗伯特的例子

```
<xs:if test="(count(/answers/answer/mean[not(@xsi:nil)])>0"><xs:if> 
```

编辑：

```
<xs:if test="//answer/mean[not(text())]"><xs:if> 
```

最后编辑（回家之前...）

```
<xs:if test="//answer/mean[attribute::xsi:nil]"><xs:if> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T15:58:39.700

```
<xs:if test="count(/answers/answer/mean[@xsi:nil != '1']) > 0">Mean stuff here</xs:if> 
```

应该做你想做的（计算 xsi:nil 属性未设置为 1 的方法）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T18:01:47.097

这是最终对我有用的方法：

```
<xsl:if test="//answers/answer/mean>0"> 
```

也就是说，“是否存在平均值大于零的答案元素”。幸运的是，我知道平均值（如果有的话）实际上总是大于零——不幸的是，由于这个原因，这不是一个通用的解决方案。

我仍然认为 jasper 和 workmad3 采用的方法（检查 xsi:nil 属性）应该有效，但我无法让语法真正......有效。

非常感谢，大家。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-09T15:34:18.813

像这样的东西应该工作。如果您有任何方法，它将返回 true

```
<xs:if test="/answers/answer/mean">You have a mean</xs:if> 
```

我想这就是你的意思。

编辑：也许这个？

```
<xs:if test="(count(/answers/answer/mean)==1)">You have a mean<xs:if> 
```

不确定这是否有效，但它可能

```
<xs:if test="/answers/answer/mean != nil">You have a mean</xs:if> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-09T15:57:39.407

这样的事情呢？

```
 <xsl:for-each select="/answers/answer">
      <xsl:if test="mean &gt;= 0">
          ... other code ...
      </xsl:if>
  </xsl:for-each> 
```

# c# - 从 C# 获取无线接入点的 BSSID（MAC 地址）

> ID：187777
> 
> 赞同：13
> 
> 时间：2008-10-09T15:21:58.963
> 
> 标签：c#, networking, wireless

如何使用 C# 获取我的系统连接到的无线接入点的 BSSID/MAC（媒体访问控制）地址？

请注意，我对 WAP 的 BSSID 感兴趣。这与 WAP 网络部分的 MAC 地址不同。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-09T15:38:38.710

以下需要以编程方式执行：

```
netsh wlan show networks mode=Bssid | findstr "BSSID" 
```

上图显示了接入点的无线 MAC 地址，它不同于：

```
arp -a | findstr 192.168.1.254 
```

这是因为接入点有 2 个 MAC 地址。一个用于无线设备，一个用于网络设备。我想要无线 MAC，但使用*arp*获取网络 MAC 。

使用[托管 Wifi API](http://www.codeplex.com/managedwifi)：

```
var wlanClient = new WlanClient();
foreach (WlanClient.WlanInterface wlanInterface in wlanClient.Interfaces)
{
    Wlan.WlanBssEntry[] wlanBssEntries = wlanInterface.GetNetworkBssList();
    foreach (Wlan.WlanBssEntry wlanBssEntry in wlanBssEntries)
    {
        byte[] macAddr = wlanBssEntry.dot11Bssid;
        var macAddrLen = (uint) macAddr.Length;
        var str = new string[(int) macAddrLen];
        for (int i = 0; i < macAddrLen; i++)
        {
            str[i] = macAddr[i].ToString("x2");
        }
        string mac = string.Join("", str);
        Console.WriteLine(mac);
    }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-10-17T17:22:56.307

```
using System;
using System.Diagnostics;

class Program
{
    static void Main(string[] args)
    {       
        Process proc = new Process();
        proc.StartInfo.CreateNoWindow = true;
        proc.StartInfo.FileName = "cmd";

        proc.StartInfo.Arguments = @"/C ""netsh wlan show networks mode=bssid | findstr BSSID """;

        proc.StartInfo.RedirectStandardOutput = true;       
        proc.StartInfo.UseShellExecute = false;
        proc.Start();
        string output = proc.StandardOutput.ReadToEnd();
        proc.WaitForExit(); 

        Console.WriteLine(output); 
    }   
} 
```

当心花括号之类的语法错误。但是这个概念就在这里。您可以通过定期调用此过程来创建扫描功能。如果出现问题，请纠正我。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-09T16:24:59.023

关于以编程方式从 ARP.EXE 获取该结果：

获取此信息的 Win32 API 位于[IP Helper 函数](http://msdn.microsoft.com/en-us/library/aa366073(VS.85).aspx)组中，称为[GetIpNetTable()](http://msdn.microsoft.com/en-us/library/aa365956(VS.85).aspx)。它的[P/Invoke 签名在这里](http://www.pinvoke.net/search.aspx?search=GetIpNetTable)。您必须编写一些代码来编组其中的结果，它是具有可变长度结果的有趣 Win32 API 之一。

另一种方法是使用[Windows Management Instrumentation ，它在](http://msdn.microsoft.com/en-us/library/aa310909(VS.71).aspx)[System.Management 和 System.Management.Instrumentation 命名空间](http://msdn.microsoft.com/en-us/library/aa720682(VS.71).aspx)中有一组很好的包装类。但不利的一面是 WMI 服务必须运行才能正常工作。我已经四处寻找，但似乎无法在 WMI 树中找到包含等效信息的确切对象。我很确定它存在，因为我在网上看到声称使用此 API 检索此信息的第三方工具。也许其他人会加入那部分。

# iis - 在 Windows XP 上将 IIS 5.1 升级到 IIS 6

> ID：187779
> 
> 赞同：16
> 
> 时间：2008-10-09T15:22:13.300
> 
> 标签：iis, iis-6, windows-xp, iis-5

是否可以将 Windows XP 上的 IIS 从 5.1 更新到 6？

如果有怎么办？

谢谢。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-10-09T15:26:07.067

不，这是不可能的。IIS 的版本与特定的 Windows 版本相关联。

```
XP = IIS 5.1
2003 = IIS 6
2008 = IIS 7 
```

更多信息，请访问[http://support.microsoft.com/kb/224609](http://support.microsoft.com/kb/224609)。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2010-07-01T09:13:18.973

现在可以在 XP 上运行 IIS 7 - Express，这是一个完整的 iis，用于开发但不部署 Web 应用程序。

见[http://weblogs.asp.net/scottgu/archive/2010/06/28/introducing-iis-express.aspx](http://weblogs.asp.net/scottgu/archive/2010/06/28/introducing-iis-express.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-09T15:27:36.063

不，我相信它只适用于 Win2003 和 x64 XP Pro

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-12-29T10:11:29.270

如果你有 XP x64 Pro 是可能的

# aop - 使用策略注入的面向方面编程中的错误

> ID：187782
> 
> 赞同：0
> 
> 时间：2008-10-09T15:22:18.963
> 
> 标签：aop, policy-injection

在使用带有策略注入的面向方面编程时，如何在设计中优雅地处理策略错误？

在面向方面的编程中，对象应该不关心特定策略的配置方式，但特定策略可能会引发特定错误。处理这个问题的最优雅的设计是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-03T09:41:09.410

如果您认为策略是系统的“方面”，那么特定方面应该处理与该策略有关的所有事情。对象应该不知道具体的策略。这样，如果您将来需要更改策略，则无需更改对象中的任何内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T16:52:35.177

为什么不让注入策略的方面验证它/处理可能发生的错误？

# apache-flex - Flex：跨 mxml 页面访问功能/组件

> ID：187795
> 
> 赞同：3
> 
> 时间：2008-10-09T15:24:29.957
> 
> 标签：apache-flex, mxml

为简单起见，假设我有两个 flex mxml 页面。

form.mxml
按钮.mxml

如果 form.mxml 页面有以下代码，它应该可以正常工作：

```
<custom:SelectView dSource="{_thedata}" id="form" visible="false">
</custom:SelectView>

<mx:LinkButton label="Show" id="lbShow" click="form.visible=true;>
<mx:LinkButton label="Show" id="lbHide" click="form.visible=false;> 
```

但是如果代码是这样的：

表单.mxml

```
 <custom:SelectView dSource="{_thedata}" id="form" visible="false">
 </custom:SelectView> 
```

按钮.mxml

```
<mx:LinkButton label="Show" id="lbShow" click="form.visible=true;>
<mx:LinkButton label="Show" id="lbHide" click="form.visible=false;> 
```

如何从 button.mxml 调用以更改 form.mxml

---- 更多细节 ---

我的页面实际上是这样的： where query:AdvancedSearchFields 基本上是在页面中包含一个弹性表单，我希望它在搜索完成后显示/隐藏下面的自定义视图。

```
<query:AdvancedSearchFields searchType="projects" searchCategory="advanced" visible="true" id="AdvancedSearch" />

<custom:SelectView dSource="{_searchResults}" id="sv" visible="false"> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-09T15:51:49.527

您可以编写一个自定义方法来处理按钮单击事件并引发自定义事件。然后在 form.mxml 中，您可以处理该事件。

像这样拆分它更简洁一些，因为它使 button.mxml 文件独立工作。让 Button.mxml 直接引用您的表单会导致两者之间的紧耦合，通常您应该避免紧耦合。

编辑：我刚刚有了另一个想法，它也避免了紧耦合并且更简单一些：

*表单.mxml*

```
<custom:SelectView dSource="{_thedata}" id="form" visible="{buttons.showForm}">
</custom:SelectView>

<!-- include your buttons.mxml component using an ID of "buttons" --> 
```

*按钮.mxml*

```
<mx:Script>
<![CDATA[
    [Bindable] public var showForm:Boolean = true;
]]>
</mx:Script>

<mx:LinkButton label="Show" id="lbShow" click="this.showForm=true;">
<mx:LinkButton label="Hide" id="lbHide" click="this.showForm=false;"> 
```

这实质上是通过使用变量绑定来模拟使用自定义事件。每当按钮中的 showForm 变量更改时，SelectView 的可见属性将通过绑定进行更新。这比创建自定义事件更轻量级（尽管我认为自定义事件的设计要好一些）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-09T15:44:50.803

您的`button.mxml`类必须引用将受到影响的“表单”类的实例。然后就可以直接对其进行操作了：

*按钮.mxml：*

```
<mx:Script>
<![CDATA[
    [Bindable] public var myForm:MyFormClass;
]]>
</mx:Script>

<mx:LinkButton label="Show" id="lbShow" click="myForm.form.visible=true;">
<mx:LinkButton label="Show" id="lbHide" click="myForm.form.visible=false;"> 
```

通常，设置此变量的最合乎逻辑的位置是在您的`Button`类的父级中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T04:41:03.140

如果你需要更频繁地处理这个问题，我建议使用像 PureMVC 这样的 MVC 框架。它的设置是为了让您拥有一个 Mediator 对象，该对象侦听来自 MXML 组件的事件，然后发送一个通知，该通知可以被任何其他调解器拾取。然后，该中介可以根据通知及其相关数据来操作自己的可视化组件。

在您正在做的事情（简单版本）的上下文中，您可以接受基本解决方案。但是，一旦您处理具有大量逻辑的四个或五个或更多组件，您将根本不高兴。

# c++ - 数据成员是否与 C++ 中的对象分配在相同的内存空间中？

> ID：187797
> 
> 赞同：7
> 
> 时间：2008-10-09T15:25:05.523
> 
> 标签：c++, memory-management

假设我有这样的课程：

```
class Test
{
  int x;
  SomeClass s;
} 
```

我像这样实例化它：

```
Test* t = new Test; 
```

x 在栈上还是堆上？s呢？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-09T15:27:27.923

```
Test a;
Test *t = new Test; 
```

a 及其所有成员都在堆栈中。

t 指向的对象及其所有成员都在堆上。

指针 t 在堆栈上。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-09T16:02:05.903

每次使用 new（我们在这里说的是 C++）“实例化”一个对象/符号时，都会为这个对象分配一个新的内存区域。如果没有，它将被放在“本地”内存区域。

问题是我对“本地”内存区域没有标准定义。

## 一个例子

这意味着，例如：

```
struct A
{
   A()
   {
      c = new C() ;
   }

   B b ;
   C * c ;
}

void doSomething()
{
   A aa00 ;
   A * aa01 = new A() ;
} 
```

对象 aa00 在堆栈上分配。

由于 aa00::b 根据 aa00 分配在“本地”内存上，因此 aa00::b 分配在新 aa00 指令分配的内存范围内。因此，aa00::b 也分配在堆栈上。

但是aa00::c是一个指针，用new分配的，所以aa00::c设计的对象是在堆上的。

现在，一个棘手的例子：aa01 是通过一个新的分配的，因此，在堆上。

在这种情况下，由于 aa01::b 根据 aa01 分配在“本地”内存上，因此 aa01::b 分配在新 aa01 指令分配的内存范围内。因此，aa01::b 位于堆上，“在”已为 aa01 分配的内存“内部”。

由于 aa01::c 是一个用 new 分配的指针，因此 aa01::c 设计的对象在堆上，在另一个内存范围内，而不是为 aa01 分配的内存范围。

## 结论

所以，游戏的重点是：
1 - 研究对象的“本地”内存是什么：堆堆栈？
2 - 如果对象是通过 new 分配的，那么它在这个本地内存之外，即它在堆上的其他地方
3 - 如果对象是“没有 new”分配的，那么它在本地内存内。
4 - 如果“本地”内存在堆栈上，那么没有 new 分配的对象也在堆栈上。
5 - 如果“本地”内存在堆上，那么没有 new 分配的对象也在堆上，但仍在本地内存中。

抱歉，我没有更好的词汇来表达这些概念。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-09T15:27:03.227

由于您使用过`new`，所以它都在堆上，[或多或少]连续存储在`t`的内存区域中。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-09T15:27:31.977

t 在堆栈上。*t 处的对象在堆上。它包含一个 int 和一个 SomeClass 对象，它们在一个单元中彼此相邻。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-09T15:27:49.123

由于您使用的是 new，因此您将在堆上分配对象。因此，由 t 指向的每个测试成员也都在堆上。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-09T16:54:41.490

```
class MyClass {
    int i;
    MyInnerClass m;
    MyInnerClass *p = new MyInnerClass();
}

MyClass a;
MyClass *b = new MyClass(); 
```

a 在堆栈上；它的成员 ai 和 am（包括 am 的任何成员）和 ap（指针，而不是它指向的对象）是它的一部分，因此也在堆栈上。

ap 指向的对象在堆上。

b 指向的对象在堆上，包括它的所有成员；bp指向的对象也是如此

# .net - 测试数据生成器模式：更有用还是更维护？

> ID：187799
> 
> 赞同：4
> 
> 时间：2008-10-09T15:25:23.073
> 
> 标签：.net, unit-testing, design-patterns

首先让我说我非常喜欢这种模式的优雅——我有一组基本实体，我已经为其实现了构建器（特别是用于测试）。但是我发现（这可能是警告）随着我的程序的发展，我一直不得不回去重新设计构建器。最后，让它们保持更新似乎真的不值得，我已经回到主要保留具有许多预配置实体的 Object Mother。我是否应该继续更新构建器以供将来使用，或者 TDB 是否应该仅在您的设计达到一定稳定性并且 Object Mother 变得太大时才创建？

另请注意，我发现我没有在应用程序的其他任何地方使用构建器，因为我喜欢使用 .Net 3.0 的新语法进行属性初始化。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-21T17:13:02.480

我喜欢对被测对象使用流利的构建器来表达我正在创建的对象的性质。ObjectMothers 往往变得笨拙并且倾向于（在我遇到的实现中）最终隐藏对象创建的细节。

比较：

```
User fred = CreateUser("fred").WithReputation(900)
                              .WithScholarBadge()
                              .WithCriticBadge() 
```

与：

```
User fred = UserObjectMother.Fred() 
```

要表达用户拥有 900 名代表的想法，而这两个特定的徽章与 ObjectMother 一起使用会很笨拙。我看到的趋势是开发人员随后找到了 build 的这种方法`Fred()`，这与他们所需要的很接近，因此他们向对象添加了更多属性。另一方面，流利的构建器可以表达正在构建的内容，并且很容易根据需要为测试创建特定用户。

也就是说，我最终也只在测试代码中使用这些模式，因为生产代码通常不需要这种表达能力。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-20T14:01:08.157

如果测试数据构建器变得太复杂而无法维护，我建议切换到**模拟框架**，这样可以更方便地生成具有已知状态的域测试对象。

此外，通过模拟，您可以使测试对象不仅仅是简单的存根，并且通过设置对如何调用它们的属性和方法的期望来实际参与测试断言的**内容**。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-11-13T11:10:25.290

Lambda 语法可以让 Fluent 界面更加简洁

例如，

```
User fred = new UserTestDataBuilder()
                .With(u => u.Name = "fred")
                .With(u => u.Reputation = 900)
                .With(u => u.ScholarBadge = true)
                .With(u => u.CriticBadge = true) 
```

您只需要一个 Action 方法和一个类来填充属性。

```
public class UserSpec
{
    public string Name {get; set;}
    public int Reputation {get; set;}
    ...
}

public class UserTestDataBuilder() 
{
    private UserSpec _userSpec = new UserSpec();
    public UserTestDataBuilder With(Action<UserSpec> action) 
    {
        action(_userSpec);
        return this;
    }

    public User Build() 
    {
        return new User(_userSpec.Name, _userSpec.Reputation, _userSpec.ScholarBadge, _userSpec.CriticBadge);
    }
} 
```

# linux - 自动杀死占用过多内存或在 linux 上停止的进程

> ID：187804
> 
> 赞同：5
> 
> 时间：2008-10-09T15:26:18.703
> 
> 标签：linux, project-management, process

我想要一个监视进程并在以下情况下终止所述进程的“系统”：

*   该过程超出了一些内存要求
*   进程在一段时间内没有响应来自“系统”的消息

我认为这个“系统”可能像监控过程一样简单？如何做到这一点的代码示例将很有用。我当然不反对这个问题的完全不同的解决方案。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-09T15:29:19.713

对于第一个要求，您可能需要考虑使用`ulimit`或调整系统上的内核 OOM-killer 设置。

监控守护进程也存在于这类事情中。 [上帝](http://god.rubyforge.org/)就是一个最近的例子。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-08-30T23:24:55.040

我编写了一个作为 cron 作业运行的脚本，可以自定义以终止问题进程：

```
#!/usr/local/bin/perl

use strict;
use warnings;
use Proc::ProcessTable;

my $table = Proc::ProcessTable->new;

for my $process (@{$table->table}) {
    # skip root processes
    next if $process->uid == 0 or $process->gid == 0;

    # skip anything other than Passenger application processes
    #next unless $process->fname eq 'ruby' and $process->cmndline =~ /\bRails\b/;

    # skip any using less than 1 GiB
    next if $process->rss < 1_073_741_824;

    # document the slaughter
    (my $cmd = $process->cmndline) =~ s/\s+\z//;
    print "Killing process: pid=", $process->pid, " uid=", $process->uid, " rss=", $process->rss, " fname=", $process->fname, " cmndline=", $cmd, "\n";

    # try first to terminate process politely
    kill 15, $process->pid;

    # wait a little, then kill ruthlessly if it's still around
    sleep 5;
    kill 9, $process->pid;
} 
```

[https://www.endpointdev.com/blog/2012/08/automatically-kill-process-using-too/](https://www.endpointdev.com/blog/2012/08/automatically-kill-process-using-too/)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-09T15:28:15.703

要限制进程的内存使用，请检查 /etc/security/limits.conf

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T22:09:38.933

尝试使用[Process Resource Monitor](https://www.rfxn.com/projects/process-resource-monitor/)以获得经典的、易于使用的进程监视器。GPL 下可用的代码。

那里还有一些其他的监控脚本，您可能也会觉得有趣。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-22T22:13:42.717

如果您想建立一个相当全面的监控系统，请查看[monit](http://www.tildeslash.com/monit/)。有时它可能**很**健谈，但它会进行大量监控、重新启动服务、提醒您等。

也就是说，如果您每天收到数十封电子邮件，请不要感到惊讶，直到您习惯于配置它并告诉它不要让您烦恼的事情。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-09T15:29:30.273

受监控的进程是您正在编写的进程，还是只是任何进程？

如果它们是任意进程，那么可能很难监控响应性。除非该流程已设置为处理和响应您可以发送的事件，否则我怀疑您是否能够监控它们。如果它们是您正在编写的进程，则需要添加某种可以使用检查的消息处理。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-04-06T14:21:23.603

我这里有一个 shell 脚本，可以作为你的起点。我这样做是因为我也遇到了一些超出内存限制的进程问题。实际上它只是检查给定的 CPU 使用限制，但您可以轻松更改为监视内存或空闲进程的作业列表。

*文件：pkill.sh*

```
#!/bin/bash

if [ -z "$1" ]
  then
    maxlimit=99
else
  maxlimit=$1
fi

ps axo user,%cpu,pid,vsz,rss,uid,gid --sort %cpu,rss\
| awk -v max=$maxlimit '$6 != 0 && $7 != 0 && $2 > max'\
| awk '{print $3}'\
| while read line;\
    do\
      ps u --no-headers -p $line;\
      echo "$(date) - $(ps u --no-headers -p $line)" >> pkill.log;\
      notify-send 'Killing proccess!' $(ps -p $line -o command --no-headers | awk '{print $1}') -u normal -i dialog-warning -t 3000;\
      kill $line;\
  done; 
```

简单地运行一次，如下所示：`sh ./pkill.sh <limit-cpu>`

或者，为了保持运行：`watch -n 10 sh ./pkill.sh 90`

在上述情况下，它将每 10 秒运行一次，杀死超过 90% CPU 的进程

# c# - 在 Asp.Net 中拥有实时可读配置文件的最佳方式

> ID：187807
> 
> 赞同：0
> 
> 时间：2008-10-09T15:27:03.523
> 
> 标签：c#, asp.net, configuration-files

我需要调整一些变量（仅在开发设置中），而不必重新启动 IIS 或任何东西（所以我认为 Web.Config 是放置它们的错误位置）。就像我说的那样，在 IIS 运行时，最容易放置大约 500 个配置设置的地方是什么？

**编辑**：就像我说的，这仅用于一些 Q&D 开发，所以我不关心任何性能。数据库有点矫枉过正（并且可能比我想要处理的工作更多），我想要一些快速的东西（比如设置），我不必担心解析并且可以读取和写入。如果我做 XML，我应该把文件写到哪里，这样我就不必花时间弄乱权限了？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-09T15:30:24.903

在数据库中？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-09T15:30:19.460

为每个请求读取 500 个配置设置？我会将它们放在数据库中，以便可以对它们进行索引和缓存。一个单独的 XML 或数据文件也很可能由 Web 服务器缓存在内存中，但仍无法提供索引数据库表可以提供的性能。但这取决于您如何访问设置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-09T15:31:17.260

您可以制作自己的“配置”文件。只是不要将其命名为 .config。然后您可以像阅读文本文件一样阅读它并设置所有属性。只需要实现您自己的文件监控类或知道文件已更改的东西，以便您可以更新您的代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-09T15:38:46.417

拥有这么多配置选项的数据库系统，加上一些经过深思熟虑的缓存很可能是总体上最好的主意！

您必须确保考虑加载/存储它们对所有请求的影响，即使值很小，也可能是大量开销。所以缓存将非常重要。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-09T16:55:15.920

我知道您说过您不需要数据库，但是有 500 个设置，这似乎是最好的解决方案。

也就是说，如果您真的不想要数据库，您可以随时将它们转储到本地存储的 xml 文件中，并在需要时读取/写入。

# sql-server - SQL Server STATISTICS

> ID：187827
> 
> 赞同：14
> 
> 时间：2008-10-09T15:30:17.307
> 
> 标签：sql-server, database, indexing, statistics

So for this one project, we have a bunch of queries that are executed on a regular basis (every minute or so. I used the "Analyze Query in Database Engine " to check on them.

They are pretty simple: select * from tablex where processed='0'

There is an index on processed, and each query should return <1000 rows on a table with 1MM records.

The Analyzer recommended creating some STATISTICS on this.... So my question is: What are those statistics ? do they really help performance ? how costly are they for a table like above ?

Please bear in mind that by no means I would call myself a SQL Server experienced user ... And this is the first time using this Analyzer.

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-09T16:55:08.447

Statistics are what SQL Server uses to determine the viability of how to get data.

Let's say, for instance, that you have a table that only has a clustered index on the primary key. When you execute `SELECT * FROM tablename WHERE col1=value`, SQL Server only has one option, to scan every row in the table to find the matching rows.

Now we add an index on col1 so you assume that SQL Server will use the index to find the matching rows, but that's not always true. Let's say that the table has 200,000 rows and `col1` only has 2 values: 1 and 0\. When SQL Server uses an index to find data, the index contains pointers back to the clustered index position. Given there's only two values in the indexed column, SQL Server decides it makes more sense to just scan the table because using the index would be more work.

Now we'll add another 800,000 rows of data to the table, but this time the values in `col1` are widely varied. Now it's a useful index because SQL Server can viably use the index to limit what it needs to pull out of the table. Will SQL Server use the index?

It depends. And what it depends on are the Statistics. At some point in time, with `AUTO UPDATE STATISTICS` set on, the server will update the statistics for the index and know it's a very good and valid index to use. Until that point, however, it will ignore the index as being irrelevant.

That's one use of statistics. But there is another use and that isn't related to indices. SQL Server keeps basic statistics about all of the columns in a table. If there's enough different data to make it worthwhile, SQL Server will actually create a temporary index on a column and use that to filter. While this takes more time than using an existing index, it takes less time than a full table scan.

Sometimes you will get recommendations to create specific statistics on columns that would be useful for that. These aren't indices, but the do keep track of the statistical sampling of data in the column so SQL Server can determine whether it makes sense to create a temporary index to return data.

HTH

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-09T15:37:41.350

In Sql Server 2005, set auto create statistics and auto update statistics. You won't have to worry about creating them or maintaining them yourself, since the database handles this very well itself.

# windows-services - 如何在 Windows 中重新启动远程计算机上的服务？

> ID：187836
> 
> 赞同：141
> 
> 时间：2008-10-09T15:32:35.680
> 
> 标签：windows-services

有时在调试时，我需要在远程机器上重新启动服务。目前，我正在通过远程桌面执行此操作。如何从本地计算机上的命令行完成？

* * *

## 回答 #1

> 赞同：214
> 
> 时间：2008-10-09T15:36:55.640

您可以使用服务控制台，单击左侧，然后在操作菜单中选择“连接到另一台计算机”选项。

如果您只想使用命令行，您可以使用

```
sc \\machine stop <service> 
```

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2008-10-09T15:39:14.137

您可以使用 mmc：

1.  开始运行。键入“mmc”。
2.  文件/添加/删除管理单元...单击“添加...”
3.  找到“服务”并单击“添加”
4.  选择“另一台计算机：”并键入远程计算机的主机名/IP 地址。单击完成、关闭等。

此时，您将能够像在本地计算机上一样管理服务。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-09T15:39:15.357

您可以使用[System Internals](http://technet.microsoft.com/en-us/sysinternals/bb795533.aspx) **PSEXEC**命令远程执行**net stop yourservice**，然后**net start yourservice**

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-09T15:52:32.957

使用命令行，您可以这样做：

```
AT \\computername time "NET STOP servicename"
AT \\computername time "NET START servicename" 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-09T15:39:18.147

我建议你看看[RSHD](http://rshd.sourceforge.net/)

您不需要为客户端费心，Windows 默认有它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-09T15:37:36.060

好吧，如果您有 Visual Studio（我知道它是在 2005 年，但不确定早期版本），您可以将远程计算机添加到“服务器资源管理器”标签中。此时，您将可以访问正在运行或可以从该机器运行的服务（以及事件日志、队列和其他一些有趣的东西）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-09T15:37:37.013

一种方法是在您想要控制服务的机器上启用 telnet 服务器（添加/删除 Windows 组件）

打开 dos 提示
键入 telnet *yourmachineip/name*
登录
类型 net start &serviceName* 例如 w3svc

这将启动 IIS，或者您可以使用 net stop 停止服务。

根据您的设置，您需要查看一种保护 telnet 连接的方法，因为我认为它是未加密的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-09T18:32:28.190

这里有几个很好的解决方案。如果您仍在使用 Win2K 并且无法在远程计算机上安装任何东西，这也可以：

打开计算机管理控制台（右键单击我的电脑，选择管理；从开始菜单中的管理工具打开；或使用管理单元从 MMC 打开）。

右键单击您的计算机名称，然后选择“连接到远程计算机”

输入计算机名称和凭据，您就可以完全访问许多管理功能，包括服务控制面板。

# sql - 是否可以使用 SQL Server 2005 复制启用压缩

> ID：187838
> 
> 赞同：2
> 
> 时间：2008-10-09T15:33:00.873
> 
> 标签：sql, sql-server, configuration, compression, replication

我正在通过带宽非常小的链路发送数据，并且我可能会发送大型数据文件。

我目前配置了合并复制和快照复制。

是否可以在 SQL Server 2005 复制中启用压缩，如果可以，如何？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-11T15:55:19.443

Google 在 Microsoft SQL Server 开发客户咨询团队 [原文如此！] 博客上发布了这篇文章：

[SQL Server 2005 事务复制：在低带宽、高延迟环境中使用 SubscriptionStreams 的好处](http://blogs.msdn.com/sqlcat/archive/2007/05/07/sql-server-2005-transactional-replication-benefit-of-using-subscriptionstreams-for-low-bandwidth-high-latency-environments.aspx)

不完全是您所要求的，但也许仍然有价值。

# .net - .Net 后台工作进程本地化帮助

> ID：187849
> 
> 赞同：0
> 
> 时间：2008-10-09T15:35:37.843
> 
> 标签：.net, localization, process, background, worker

在我的 Windows 窗体应用程序中，我的后台工作进程报告了本地化消息，我遇到了一些奇怪的行为。

该应用程序是一个带有 Windows 窗体的设置应用程序。该应用程序启动一个后台工作程序来执行和 IIS 重置，然后安装 MSI。

我第一次在西班牙语 Win Server 2003 VM 上运行应用程序时，表单是西班牙语，但不是 BWP 消息。如果我立即再次运行它，则消息为西班牙语。

.Resources 文件是嵌入式资源，在应用程序启动时被提取到 temp 目录。

我的代码通过自定义资源管理器类检索本地化字符串。此类为临时目录中的 .Resources 文件创建基于文件的资源。这工作正常，因为 Windows 窗体标签和标题每次都本地化。

有没有人经历过这个？我完全卡住了，请帮忙。谢谢，安德鲁

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-01-17T16:39:58.323

如果您的 UIThread 运行的 UICulture 与 BackgroundWorker 不同，则可以使用如下回调显式更改工作线程的文化：

```
 private delegate CultureInfo GetUICultureCallback();

        private CultureInfo GetUICulture()
        {
            if (this.InvokeRequired)
            {
                return (CultureInfo)this.Invoke(new GetUICultureCallback(GetUICulture));
            }

            return System.Threading.Thread.CurrentThread.CurrentUICulture;
        }

        void backgroundWorker_DoWork(object sender, DoWorkEventArgs e)
        {
            System.Threading.Thread.CurrentThread.CurrentUICulture = GetUICulture();

            for (; ; )
            {
                if (backgroundWorker.CancellationPending)
                {
                    e.Cancel = true;
                    return;
                }
.
.
. 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-10T08:18:31.437

文化信息在线程本地存储中，因此如果后台工作人员在不同线程上运行进程，这可能是预期的。

[http://msdn.microsoft.com/en-us/library/system.globalization.cultureinfo.currentculture.aspx](http://msdn.microsoft.com/en-us/library/system.globalization.cultureinfo.currentculture.aspx)

[http://msdn.microsoft.com/en-us/library/system.threading.thread.currentculture.aspx](http://msdn.microsoft.com/en-us/library/system.threading.thread.currentculture.aspx)

不过，我不确定跨线程传输文化信息的推荐做法是什么。

# jsf - 重定位 JSF 生成的 javascript

> ID：187850
> 
> 赞同：1
> 
> 时间：2008-10-09T15:35:54.660
> 
> 标签：jsf

我在我的应用程序中使用了很多命令链接。为了让它们工作，JSF 生成了一些狂野的 Javascript ( `function dpf(f) {var adp...`)。可悲的是，脚本标签破坏了我的布局。（确实如此——我对此很确定）。

有没有办法强制 JSF 在其他地方生成脚本标签？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-14T06:43:09.230

也许您可以尝试外部化您的 Javascript。它不会将 Javascript 代码放在您的页面中，而是仅包含一个指向 Javascript 文件的脚本标记。为此，请修改您的 web.xml 文件以使其具有：

```
<context-param>
    <param-name>com.sun.faces.externalizeJavaScript</param-name>
    <param-value>true</param-value>
</context-param> 
```

# apache-flex - Flex 中的同步对话框？

> ID：187851
> 
> 赞同：3
> 
> 时间：2008-10-09T15:36:08.967
> 
> 标签：apache-flex, synchronous, function-calls, dialog

如何在 Flex 中打开同步对话框？我需要从外部接口 (JavaScript) 调用一个函数，该函数将在 Flex 应用程序中打开一个简单的对话框，并根据用户单击的按钮（确定/取消）返回一个值。

所以它应该通过对对话框的同步调用，即调用等待直到用户像这样关闭对话框。

```
//This function is called by JavaScript
function onApplicationUnload():Boolean
{
  var result:Boolean;
  result = showDialogAndWaitForResult();
  return result
} 
```

有人知道我该怎么做吗？我可以编写一个循环，等待对话框设置一个标志，然后读取结果以返回它，但必须有一些更优雅和可重用的东西来等待其他异步调用的完成。

**编辑：** 不幸的是，回调不起作用，因为调用 onApplicationUnload() 本身的 JavaScript 函数必须返回一个值（类似于 Flex 中的 onApplicationUnload() 函数）。这个 JavaScript 函数有一个固定的签名，因为它是由框架调用的，我无法更改它。或者换句话说：从 JavaScript 到 Flex 的调用也必须是同步的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-09T16:02:39.037

Flex 不能以同步方式工作，因为它是一个单线程应用程序，因此需要您的代码将执行交回“核心”以处理用户输入等。

这样做的方法是使对话的行为异步：

```
function onApplicationUnload():void
{
    showDialog(resultMethod);
}

function resultMethod(result:Boolean):void
{
    ExternalInterface.call("javaScriptCallback", [result]);
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T18:12:36.403

你不能在 Flex 中做到这一点。正如大卫所提到的，Flex 是单线程的，因此在处理对话框时您不能拥有功能块。

您最好的选择可能是使用 Javascript 弹出窗口。您对窗口的控制要少得多，但它应该按照您想要的方式运行（阻止函数直到它被关闭）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-04-15T18:47:09.767

让您的 Flex 代码使用事件来等待对话框。在主线程中，注册一个等待对话框关闭的事件处理程序。在对话框中的 OK 上，调度对话框完成事件。

对于 Cairngorm，这类似于：

在主线程中：

`CairngormEventDispatcher.getInstance().addEventListener(ClosingDialogCompleteEvent.DIALOG_COMPLETE, onClosingDialogComplete);`

（如果您想避免在完成之前返回，请在计时器和全局变量上循环。）

在对话框关闭处理程序中：

`CairngormEventDispatcher.dispatchEvent(new ClosingDialogCompleteEvent(<parameters>));`

事件处理程序：

```
 public function onClosingDialogComplete (e: ClosingDialogCompleteEvent):void
{
   param1 = e.param1;
   param2 = e.param2;
   // etc.
   // Continue processing or set the global variable that signals the main thread to continue.
} 
```

为此，必须定义 ClosingDialogCompleteEvent 类。该类的部分代码是：

```
 package com. ... .event  // You define where the event lives.
{
import com.adobe.cairngorm.control.CairngormEvent;

public class ClosingDialogCompleteEvent extends CairngormEvent
{
    // Event type.
    public static const DIALOG_COMPLETE:String = "dialogComplete";

    public var param1:String;
    public var param2:String;

    public function ClosingDialogCompleteEvent(param1:String, param2:String)
    {
        super(DIALOG_COMPLETE);
        this.param1 = param1;
        this.param2 = param2;
    }
}
} 
```

等待事件是在 Flex 中进行同步的最佳方式。它也适用于启动对话框。在仅 flex 的应用程序中，它工作得特别好。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-05-05T07:54:08.690

我已经解释了在 flex 中创建同步警报的解决方法

[http://reallypseudorandom.blogspot.com/2010/05/flash-asynchronous-alert-and-pause.html](http://reallypseudorandom.blogspot.com/2010/05/flash-asynchronous-alert-and-pause.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-17T08:55:42.453

好的......毕竟我找到了一个可能的解决方案。但我想几乎没有人会认真地这样做:-(

该解决方案侧重于使用 while 循环来检查结果，然后返回 JavaScript 正在调用的函数。然而，我们需要一种在 while 循环中休眠的方法，同时等待结果。然而，对 JavaScript 的调用是同步的。现在的诀窍是在 JavaScript 中进行睡眠，这在此处也不能直接使用，但可以使用同步 XML Http Request 来完成，如本[博客](http://narayanraman.blogspot.com/2005/12/javascript-sleep-or-wait.html)所述。

正如我所说 - 我不会仅将其作为最后的手段来推荐。对于我的问题，我使用了丑陋的 JavaScript 弹出窗口。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-11T14:03:01.820

让您的对话框调用 flex 中的另一个函数来处理用户选择的结果：

```
private function deleteFileCheck():void
{
  Alert.show("Are you sure you want to delete this file?",
             "Confirm Delete",
             Alert.YES| Alert.NO,
             this, deleteFileHandler, null, Alert.NO);
}

private function deleteFileHandler(event:CloseEvent):void
{
    if (event.detail == Alert.YES)
    {
        ...do your processing here
    }
} 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-10-17T08:59:39.390

您可以通过弹出一个对话框然后在后台禁用所有内容来伪造 flex 中的同步对话框。`Alert.show("Hello World");`如果您在应用程序中这样做，您可以看到这一点。背景将变灰，用户将无法点击背景中的任何 UI。该应用程序将“等待”，直到用户单击“确定”按钮。

# asp.net - DRY 原则在 ASP.NET MVC 中实际上是什么样的？

> ID：187855
> 
> 赞同：5
> 
> 时间：2008-10-09T15:36:58.743
> 
> 标签：asp.net, asp.net-mvc, dry

我一直听说 DRY 原则以及它在 ASP.NET MVC 中的重要性，但是当我在 Google 上进行研究时，我似乎不太了解它是如何应用于 MVC 的。

从我读到的内容来看，它并不是我认为的复制和粘贴代码的味道，但它不仅如此。

你们中的任何人都可以深入了解我如何在我的 ASP.NET MVC 应用程序中使用 DRY 原则吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-09T16:05:13.900

DRY 的意思是“不要重复自己”。确保在编写代码时只编写一次。如果您发现自己在所有 Controller 类中编写了类似的功能，请创建一个具有该功能的基本控制器类，然后从它继承，或者将功能移到另一个类中并从那里调用它，而不是在所有控制器中重复它。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-12T17:47:39.513

*   使用过滤器属性来管理方面（身份验证、导航、面包屑等）
*   使用[层超类型](http://martinfowler.com/eaaCatalog/layerSupertype.html)控制器（对其应用常见的控制器级过滤器，参见[mvccontrib 示例](http://code.google.com/p/mvccontrib/source/browse/trunk/src/MVCContrib/ConventionController.cs)）
*   编写自定义操作结果（如[在 mvccontrib 中](http://code.google.com/p/mvccontrib/source/browse/trunk/src/MVCContrib/#MVCContrib/ActionResults)- 例如，我们制作了一个名为 logoutresult 的函数，它只执行`FormsAuthentication.Logout()`
*   使用视图名称约定
*   最重要的是——让你的控制器动作保持**沉默**，在服务中寻找重用机会

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-09T16:12:55.817

不要重复自己。它可以应用于编程的许多不同方面。最基本的层面是防止代码异味。我没有使用过 ASP.NET，所以我无法具体了解它和 MVC。

*   在 C++ 中，模板会阻止同一函数的多个副本。
*   在 C 中，可以以类似的方式使用 void * 指针，但要非常小心。
*   从另一个函数继承允许函数允许其他函数使用相同的代码库，而无需复制代码。
*   规范化数据库中的数据可以最大限度地减少冗余数据。还坚持 DRY 原则。

当你在一个项目中回顾一个“想法”时。问你自己。

1.  我已经写过这段代码了吗？
2.  这段代码在其他地方有用吗？
3.  我可以通过构建以前的类/函数来节省编码吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-09T16:09:35.077

DRY 并不特定于任何*一种*技术。只需确保您从功能的角度（甚至不是从复制/粘贴编码器视图）查看您的类，并查看重复发生的位置。这个过程可能不会一次性发生，并且您只会在几个月后在添加新功能时审查您的代码后才会注意到重复。如果您有单元测试，则不必担心删除该重复项。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-09T16:22:33.740

MVC 与不重复自己相关的一个优点是，您的控制器可以执行一个类中所有页面共有的任务。例如，可以集中验证某些类型的恶意请求或验证身份验证。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-12T18:04:20.790

DRY 不仅应该应用于代码，还应该应用于一般信息。您是否在构建系统中重复某些事情？您是否有应该移动到通用配置文件等的数据？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-13T14:39:20.203

嗯，我可以给出的关于 DRY 和 UI 的最常见示例是使用 MasterPages 和 UserControls 之类的东西。

MasterPages 确保您只编写一次所有静态 HTML。

UserControls 确保代码的可重用性。例如，您将有很多表单执行基本的操作，例如 CRUD。现在，理想情况下，我们希望所有用户看到创建和更新的不同页面，尽管两者中的表单字段几乎相同。我们能做的就是把所有的常用控件组合起来，放到一个可以在两个页面上重复使用的控件中。这确保我们永远不会重新输入（或复制粘贴）相同的代码。

DRY 在 MVC 中尤其重要，因为完成相同任务的文件数量增加了。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-01-18T19:42:09.437

似乎存在一种误解，即必须将域模型中的所有内容复制为特殊的视图模型。您可以让域模型成为域模型，但视图模型是对域细节一无所知并且更通用的东西。例如：

领域模型类：Account、Asset、PurchaseOrder

视图模型：List、Table、Tuple、SearchFormBackingModel：Checked options、Outputoptions 等。视图本身可能更特定于视图实现。

Tuple/Dictionary/Map 可能映射到 Account、Asset 和 PurchaseOrder 单个实例，但 Table 可能对它们的集合等有用。您仍然有 MVC，但您有会话数据，尚未准备好在视图模型中进行事务处理，但不一定让它违反你的域模型的规则，这是规则应该去的地方。这样，他们将不那么贫血和反模式。您可以在前面传递这些规则并在那里或只是在后面或两者都使用它们，具体取决于系统如何从客户端读取等。

# c# - C# (TIBCO.EMS.dll) 的 TIBCO EMS 故障转移重新连接

> ID：187857
> 
> 赞同：13
> 
> 时间：2008-10-09T15:37:02.863
> 
> 标签：c#, tibco, tibco-ems, ems

我们有一个 TIBCO EMS 解决方案，它在 2-4 个服务器环境中使用内置服务器故障转移。如果 TIBCO 管理员将故障转移服务从一台 EMS 服务器转移到另一台，则连接应该在 EMS 服务级别自动转移到新服务器。对于我们使用 EMS 服务的 C# 应用程序，这不会发生 - 我们的用户连接在故障转移后没有被转移到新服务器，我们不确定原因。

我们的应用程序仅在启动时连接到 EMS，因此如果 TIBCO 管理员在用户启动我们的应用程序后进行故障转移，他们的用户需要重新启动应用程序才能重新连接到新服务器（我们的 EMS 连接使用一个服务器字符串，包括所有 4 个生产 EMS 服务器- 如果第一次尝试失败，它会移动到字符串中的下一个服务器并再次尝试）。

我正在寻找一种自动化方法，如果它检测到连接已失效，它将尝试定期重新连接到 EMS，但我不确定如何最好地做到这一点。

有任何想法吗？我们正在使用 TIBCO.EMS.dll 版本 4.4.2 和 .Net 2.x（SmartClient 应用程序）

任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-24T19:31:10.720

首先，是的，我正在回答我自己的问题。然而，重要的是要注意，如果没有 ajmastrean，我将无处可去。太感谢了！

一：ConnectionFactory.SetReconnAttemptCount、SetReconnAttemptDelay、SetReconnAttemptTimeout 应适当设置。我认为默认值重试太快（重试之间大约 1/2 秒）。由于网络存储等原因，我们的 EMS 服务器可能需要很长时间才能进行故障转移 - 因此以 1/2 秒的间隔重试 5 次远远不够长。

二：我认为启用客户端-服务器和服务器-客户端心跳很重要。无法验证但没有这些，客户端可能不会收到服务器离线或切换到故障转移模式的通知。当然，这是 EMS 的服务器端设置。

三：您可以通过设置 Tibems.SetExceptionOnFTSwitch(true); 来监视故障转移事件；然后连接一个异常事件处理程序。在单服务器环境中，您将看到“连接已终止”消息。但是，如果你在一个容错的多服务器环境中，你会看到这样的：“连接已执行容错切换到”。您并不严格需要此通知，但它可能很有用（尤其是在测试中）。

四：EMS文档中显然没有明确，连接重连在单服务器环境下是行不通的。您需要处于多服务器、容错环境中。然而，有一个窍门。您可以将同一台服务器两次放入连接列表 - 我知道这很奇怪，但它可以工作，并且它使内置的重新连接逻辑能够工作。

一些代码：

```
private void initEMS()
{
    Tibems.SetExceptionOnFTSwitch(true);
    _ConnectionFactory = new TIBCO.EMS.TopicConnectionFactory(<server>);
    _ConnectionFactory.SetReconnAttemptCount(30);       // 30retries
    _ConnectionFactory.SetReconnAttemptDelay(120000);   // 2minutes
    _ConnectionFactory.SetReconnAttemptTimeout(2000);   // 2seconds
_Connection = _ConnectionFactory.CreateTopicConnectionM(<username>, <password>);
    _Connection.ExceptionHandler += new EMSExceptionHandler(_Connection_ExceptionHandler);
}
private void _Connection_ExceptionHandler(object sender, EMSExceptionEventArgs args)
{
    EMSException e = args.Exception;
    // args.Exception = "Connection has been terminated" -- single server failure
    // args.Exception = "Connection has performed fault-tolerant switch to <server url>" -- fault-tolerant multi-server
    MessageBox.Show(e.ToString());
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-16T21:19:00.443

*这篇文章应该总结我目前的评论并更详细地解释我的方法......*

TIBCO 'ConnectionFactory' 和 'Connection' 类型是重量级的线程安全类型。TIBCO 建议您保持使用**一个**ConnectionFactory（每个服务器配置的工厂）和每个工厂**一个**Connection。

服务器*似乎*还负责就地“连接”故障转移和重新连接，所以让我们确认它正在完成它的工作，然后依靠该功能。

创建客户端解决方案将比修复服务器或客户端设置问题稍微复杂一些。您从失败的连接创建的所有会话都需要重新创建（更不用说生产者、消费者和目的地）。两种类型都没有“重新连接”或“刷新”方法。会话也不维护对其父连接的引用。

您将不得不管理连接/会话对象的查找并疯狂地重新初始化每个人！或者实现某种可以获取新连接并重新连接它们的会话失败事件处理程序。

所以，现在，让我们深入了解一下客户端是否设置为接收故障转移通知（tib ems 用户指南第 292 页）。并确保捕获引发的异常，包含故障转移 URL，并且得到正确处理。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-16T21:04:39.677

客户端应用程序可以通过设置 tibco.tibjms.ft.switch.exception 系统属性来接收故障转移通知

也许图书馆需要它来工作？

# visual-studio-2005 - Visual Studio 2005 Designer 未向 aspx.Designer.cs 添加控件

> ID：187881
> 
> 赞同：6
> 
> 时间：2008-10-09T15:41:53.977
> 
> 标签：visual-studio-2005

我不是 Designer 的粉丝，我更喜欢直接在 ASPX 页面上编写代码。但是，自从重新格式化（并导致重新格式化）`designer.cs`以来，手动编码到 .aspx 文件时文件没有正确更新。这意味着我的[代码](http://en.wikipedia.org/wiki/ASP.NET#Code-behind_model)无法识别新控件并引发编译器错误。

如何***防止***这种情况发生，或者在手动编码 aspx 文件后强制重新编译 Designer.cs 文件？我知道我可以手动将控件键入到设计器文件中，但这很耗时，而且在创建较大的 aspx 页面时令人讨厌。

编辑

WebDude 的答案*曾经*有效，但切换到设计视图不再以任何程度的一致性解决问题。还有什么想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-09-23T15:06:45.790

简单的解决方案，

删除designer.cs页面，右键aspx/ascx页面，选择Convert to Web Application。

你都准备好了！

巴韦什

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-09T15:53:49.867

当我在 Visual Studio 2008 中安装 sp1 时，这发生在我身上。我让代码识别我的控件的方式是在设计器模式下查看 aspx 页面，然后改回代码视图。

这似乎给了 Visual Studio 开始自动填充我的设计师所需的一记耳光。

我意识到您的问题出在 Vis 2005 中，但这可以帮助您

祝你好运！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-25T13:12:31.040

Just reload the IDE and start from clean code backup.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-09T16:29:13.617

我发现关闭和重新打开页面（包括 HTML 和后面的代码）会强制它重新填充所有内容。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-12-30T20:50:48.573

我在用户控件上遇到了同样的问题。通过向页面添加一个新控件（在我的例子中是一个表单视图）并构建它强制它重新生成后面的代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-01-21T06:14:27.977

在[这篇相关文章中](https://stackoverflow.com/questions/45325/how-do-you-force-visual-studio-to-regenerate-the-designer-files-for-aspx-ascx-f/14433337#14433337 "你如何强制 Visual Studio 为 aspx/ascx 文件重新生成 .designer 文件？")，我刚刚发布了一些关于我的新工具 Redesigner 的信息。它是开源的 BSD 许可证，可在 SourceForge 上获得，并且无需 Visual Studio 即可可靠地生成设计器文件！（并且没有 Visual Studio 的错误！）

[您可以在此处](https://sourceforge.net/projects/redesigner/ "重新设计者")下载副本，或在[相关文章](https://stackoverflow.com/questions/45325/how-do-you-force-visual-studio-to-regenerate-the-designer-files-for-aspx-ascx-f/14433337#14433337 "你如何强制 Visual Studio 为 aspx/ascx 文件重新生成 .designer 文件？")中了解更多信息。

# oracle - 在特定用户拥有的所有表上授予选择

> ID：187886
> 
> 赞同：43
> 
> 时间：2008-10-09T15:44:29.963
> 
> 标签：oracle

我需要将特定用户拥有的所有表的选择权限授予另一个用户。我可以使用以下命令执行此操作吗：

```
Grant Select on OwningUser.* to ReceivingUser 
```

或者我是否必须为每个表生成 sql，其中包含以下内容：

```
 Select 'GRANT SELECT ON OwningUser.'||Table_Name||'TO ReceivingUser' 
 From All_Tables Where Owner='OWNINGUSER' 
```

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2008-10-09T22:49:13.850

好吧，这不是一个单一的声明，但它与 oracle 一样接近：

```
BEGIN
   FOR R IN (SELECT owner, table_name FROM all_tables WHERE owner='TheOwner') LOOP
      EXECUTE IMMEDIATE 'grant select on '||R.owner||'.'||R.table_name||' to TheUser';
   END LOOP;
END; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2013-08-29T13:03:21.113

是的，有可能，运行以下命令：

假设您有用户调用`thoko`

```
grant select any table, insert any table, delete any table, update any table to thoko; 
```

注意：在oracle数据库上工作

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-09-09T06:14:00.360

表格 + 视图 + 错误报告

```
SET SERVEROUT ON
DECLARE
  o_type VARCHAR2(60) := '';
  o_name VARCHAR2(60) := '';
  o_owner VARCHAR2(60) := '';
  l_error_message VARCHAR2(500) := '';
BEGIN
  FOR R IN (SELECT owner, object_type, object_name
            FROM all_objects 
            WHERE owner='SCHEMANAME'
            AND object_type IN ('TABLE','VIEW')
            ORDER BY 1,2,3) LOOP
    BEGIN
    o_type := r.object_type;
    o_owner := r.owner;
    o_name := r.object_name;
    DBMS_OUTPUT.PUT_LINE(o_type||' '||o_owner||'.'||o_name);
    EXECUTE IMMEDIATE 'grant select on '||o_owner||'.'||o_name||' to USERNAME';
    EXCEPTION
      WHEN OTHERS THEN
        l_error_message := sqlerrm;
        DBMS_OUTPUT.PUT_LINE('Error with '||o_type||' '||o_owner||'.'||o_name||': '|| l_error_message);
        CONTINUE;
    END;
  END LOOP;
END;
/ 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-10-05T06:28:47.440

从[http://psoug.org/reference/roles.html](http://psoug.org/reference/roles.html)在您的数据库上创建一个过程供您的用户执行此操作：

```
CREATE OR REPLACE PROCEDURE GRANT_SELECT(to_user in varchar2) AS

  CURSOR ut_cur IS SELECT table_name FROM user_tables;

  RetVal  NUMBER;
  sCursor INT;
  sqlstr  VARCHAR2(250);

BEGIN
    FOR ut_rec IN ut_cur
    LOOP
      sqlstr := 'GRANT SELECT ON '|| ut_rec.table_name || ' TO ' || to_user;
      sCursor := dbms_sql.open_cursor;
      dbms_sql.parse(sCursor,sqlstr, dbms_sql.native);
      RetVal := dbms_sql.execute(sCursor);
      dbms_sql.close_cursor(sCursor);

    END LOOP;
END grant_select; 
```

# visual-studio-2008 - 从命令行控制 Visual Studio 插件

> ID：187888
> 
> 赞同：2
> 
> 时间：2008-10-09T15:44:38.013
> 
> 标签：visual-studio-2008

有没有办法通过命令行控制插件 Visual Studio 2008 加载？我正在寻找一种方法来在我使用 VB 或 C# 时加载我的 DevExpress 插件，或者在我处理 c++ 项目时加载 Visual Assist X。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-17T04:06:26.103

不是直接的答案，但您可以通过菜单 (VAssistX | Enable/Disable ) 或通过命令 VAssistX.EnableDisable 禁用 Visual Assist X（两者都在打开和关闭之间切换）。或者，您可以将 .cs 和 .vb 文件扩展名添加到 Visual Assist Options | 中的“要忽略的扩展名”列表中。项目 | 文件处理。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-11-20T17:27:15.773

有一种方法可以从插件访问命令行。我认为唯一的选择是，如果你真的想要这个并且插件不支持开箱即用，那就是编写你自己的插件。为此，只需从 OnConnection 方法中读取 Environment.CommandLine。

# asp.net - 通过 VB.NET 将点击事件添加到按钮以触发 javascript

> ID：187890
> 
> 赞同：4
> 
> 时间：2008-10-09T15:44:51.083
> 
> 标签：asp.net, javascript, vb.net

我有一个 ASP.NET 页面，它从数据库表中提取一组图像，并使用枚举器遍历所有图像然后显示。

这一切都发生在代码隐藏 (VB.NET) 中，代码在其中添加占位符和表格内的一些控件（占位符内的表格）。

我已经向这个占位符（在表格单元格内）添加了一个按钮，所有这些都以编程方式进行，但是如何以编程方式向按钮添加点击事件？我想触发一个显示图像大预览的javascript（灯箱）（当用户单击一个小图像时有效，这会在指向javascript的代码上调用一个字符串超链接）。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-09T15:49:13.900

`cmdMyButton.attributes.add("onclick", "alert('hello');")`?

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-09T15:50:17.610

您可以使用 OnClientClick 命令调用客户端 javascript。如果您的按钮名为 btnMyButton，请按如下方式编写代码：

```
btnMyButton.OnClientClick = "window.open('http://www.myimage.com'); return false;"; 
```

最后使用 return false 将确保该按钮不会导致返回页面。用你想要做的替换javascript。

上述方法的替代方案是

```
btnMyButton.Attributes.Add("onclick", "window.open('http://www.myimage.com'); return false;"; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-09T16:05:04.617

.NET Framework 向 web 控件添加属性（例如 onClick）的首选方法是：

```
control.Attributes.Add("onclick", "javascript:DoSomething('" + control.Value + "')") 
```

您还可以在触发另一个事件（例如，DataBound）时添加 onClick 事件：

```
Private Sub ctlControlName_ActionName(ByVal sender As Object, ByVal e As System.EventArgs)
        Handles ctlControlName.ActionName
Dim control As ControlType = DirectCast(sender, ControlType)
control.Attributes.Add("onclick", "javascript:DoSomething('" + control.Value + "')")
End Sub 
```

希望这可以帮助！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-09T15:50:36.813

`button.Attributes.Add("onclick", "javascript:fireLightBox()")`

那是 C#，但我认为 VB.NET 会非常相似。

# sql - 有没有办法将参数传递给 CodeIgniter 中的查询*而不*使用 ActiveRecord？

> ID：187893
> 
> 赞同：0
> 
> 时间：2008-10-09T15:46:36.853
> 
> 标签：sql, database, codeigniter, arguments

这是我想做的，但似乎不可能：（编辑：将单引号更改为双引号）

```
function get_archives($limit, $offset) 
{
    $query = $this->db->query("
        SELECT  archivalie.id, 
                archivalie.signature, 
                type_of_source.description AS type_of_source_description, 
                media_type.description AS media_type_description,
                origin.description AS origin_description

        FROM    archivalie, 
                type_of_source, 
                media_type,
                origin

        WHERE   archivalie.type_of_source_id = type_of_source.id                                                        
        AND     type_of_source.media_type_id = media_type.id  
        AND     archivalie.origin_id = origin.id                                                                     

        ORDER BY    archivalie.id ASC
        LIMIT       $limit, $offset
    "); 

    // etc...

} 
```

它给出了这个错误：（编辑：使用双引号的新错误消息，并在 URL 中传递了一个偏移量）

```
ERROR: LIMIT #,# syntax is not supported HINT: Use separate LIMIT and OFFSET clauses. 
```

它仅在您使用 ActiveRecord 格式传递变量时才有效：

```
$this->db->select('archivalie.id, archivalie.signature, etc, etc');
// from, where, etc.
$this->db->limit($limit, $offset);        
$query = $this->db->get(); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-10-14T16:14:03.477

```
$query = $this->db->query('
SELECT  archivalie.id, 
        archivalie.signature, 
        type_of_source.description AS type_of_source_description, 
        media_type.description AS media_type_description,
        origin.description AS origin_description
FROM    archivalie, 
        type_of_source, 
        media_type,
        origin
WHERE   archivalie.type_of_source_id = type_of_source.id                                                        
AND     type_of_source.media_type_id = media_type.id  
AND     archivalie.origin_id = origin.id                                                                     
ORDER BY    archivalie.id ASC
LIMIT       ?
OFFSET      ?',array($limit,$offset)); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-10T08:41:36.557

这有效：

```
$query = $this->db->query("
    SELECT  archivalie.id, 
            archivalie.signature, 
            type_of_source.description AS type_of_source_description, 
            media_type.description AS media_type_description,
            origin.description AS origin_description

    FROM    archivalie, 
            type_of_source, 
            media_type,
            origin

    WHERE   archivalie.type_of_source_id = type_of_source.id                                                        
    AND     type_of_source.media_type_id = media_type.id  
    AND     archivalie.origin_id = origin.id                                                                     

    ORDER BY    archivalie.id ASC
    LIMIT       $limit
    OFFSET      $offset
"); 
```

但如果 URL 中不存在偏移量，则需要检查以分配默认值。从我的控制器：

```
# Check/assign an offset
$offset = (!$this->uri->segment(3)) ? 0 : $this->uri->segment(3);

# Get the data
$archives = $this->archive->get_archives($config['per_page'], $offset); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-12-07T02:28:38.083

它与参数的数据类型有关。如果您不希望 Codeigniter 添加 `'' 单引号，请确保您传递的是整数。

```
$page = '10'; // for some reason this arrives as a string
$sql = "select * from customers limit 10 offset ?";
$result = $this->db->query($sql, array(intval($page)); 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-09T15:49:42.603

如果你使用双引号而不是单引号，它会起作用，但如果变量没有被正确清理，你就会受到注入攻击。

# c# - 如何使用 C# 获取 IP 地址的物理 (MAC) 地址？

> ID：187894
> 
> 赞同：12
> 
> 时间：2008-10-09T15:47:06.807
> 
> 标签：c#, networking

在 C# 中，我想做与以下等效的操作：

```
arp -a |findstr 192.168.1.254 
```

或者，答案可以调用[SendARP](http://msdn.microsoft.com/en-us/library/aa366358.aspx)函数并获取结果。

这将允许我的应用程序执行一些需要 MAC 地址的其他处理。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-10-09T15:54:29.507

SendARP P/Invoke 是这样的：

```
[DllImport("iphlpapi.dll", ExactSpelling=true)]
public static extern int SendARP( int destIp, int srcIP, byte[] macAddr, ref uint physicalAddrLen ); 
```

[PInvoke.NET](http://www.pinvoke.net/default.aspx/iphlpapi/SendARP.html)有这个例子：

```
IPAddress dst = IPAddress.Parse("192.168.2.1"); // the destination IP address

byte[] macAddr = new byte[6];
uint macAddrLen = (uint)macAddr.Length;

if (SendARP(BitConverter.ToInt32(dst.GetAddressBytes(), 0), 0, macAddr, ref macAddrLen) != 0)
     throw new InvalidOperationException("SendARP failed.");

string[] str = new string[(int)macAddrLen];
for (int i=0; i<macAddrLen; i++)
     str[i] = macAddr[i].ToString("x2");

Console.WriteLine(string.Join(":", str)); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2016-05-11T06:46:47.270

这是我的解决方案。

```
public static class MacResolver
{
    /// <summary>
    /// Convert a string into Int32  
    /// </summary>
    [DllImport("Ws2_32.dll")]
    private static extern Int32 inet_addr(string ip);

    /// <summary>
    /// The main funtion 
    /// </summary> 
    [DllImport("Iphlpapi.dll")]
    private static extern int SendARP(Int32 dest, Int32 host, ref Int64 mac, ref Int32 len);

    /// <summary>
    /// Returns the MACAddress by a string.
    /// </summary>
    public static Int64 GetRemoteMAC(string remoteIP)
    {   
        Int32 ldest = inet_addr(remoteIP);

        try
        {
            Int64 macinfo = 0;           
            Int32 len = 6;           

            int res = SendARP(ldest, 0, ref macinfo, ref len);

            return macinfo;    
        }
        catch (Exception e)
        {
            return 0;
        }
    }

    /// <summary>
    /// Format a long/Int64 into string.   
    /// </summary>
    public static string FormatMac(this Int64 mac, char separator)
    {
        if (mac <= 0)
            return "00-00-00-00-00-00";

        char[] oldmac = Convert.ToString(mac, 16).PadLeft(12, '0').ToCharArray();

        System.Text.StringBuilder newMac = new System.Text.StringBuilder(17);

        if (oldmac.Length < 12)
            return "00-00-00-00-00-00";

        newMac.Append(oldmac[10]);
        newMac.Append(oldmac[11]);
        newMac.Append(separator);
        newMac.Append(oldmac[8]);
        newMac.Append(oldmac[9]);
        newMac.Append(separator);
        newMac.Append(oldmac[6]);
        newMac.Append(oldmac[7]);
        newMac.Append(separator);
        newMac.Append(oldmac[4]);
        newMac.Append(oldmac[5]);
        newMac.Append(separator);
        newMac.Append(oldmac[2]);
        newMac.Append(oldmac[3]);
        newMac.Append(separator);
        newMac.Append(oldmac[0]);
        newMac.Append(oldmac[1]);

        return newMac.ToString();
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T15:59:27.140

挂钩到 WMI 子系统。[一些 VBScript 代码可以朝着正确的](http://www.microsoft.com/technet/scriptcenter/resources/qanda/jun05/hey0614.mspx)方向前进

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-09T16:06:15.627

要找到自己的：

添加对 System.Management 的引用

```
ManagementClass mc = new ManagementClass("Win32_NetworkAdapterConfiguration");

ManagementObjectCollection mcCol = mc.GetInstances();

foreach (ManagementObject mcObj in mcCol)
{
  Console.WriteLine(mcObj["Caption"].ToString());
  Console.WriteLine(mcObj["MacAddress"].ToString());
} 
```

不确定是否能找到另一台设备。

# logging - 企业图书馆审查？

> ID：187895
> 
> 赞同：0
> 
> 时间：2008-10-09T15:47:13.903
> 
> 标签：logging, exception-handling, enterprise-library

就所提供功能的内存使用而言，用于异常处理和日志记录的企业库是否有效？

优缺点都有什么？谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-09T16:20:33.510

我怀疑企业库会成为您的性能瓶颈。我会说使用它，测量您的应用程序的性能，找到瓶颈并从那里开始。担心性能*可能*不会为您的场景提供任何有用的数据。

也就是说，我对 Enterprise Library Application Logging Block 很幸运，在大多数情况下我会推荐它。:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T17:55:36.920

我以前使用过 EntLib（在 CAB、Object Builder、SmartClient 等时代）。

我认为它太重且不灵活。

更好地使用 log4net 进行日志记录和自定义异常策略以进行异常处理（您可以使用 EntLib 轻松实现最后一件事，[就像这样](http://abdullin.com/journal/2008/12/1/net-exception-handling-action-policies-application-block.html)）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T16:11:53.433

鉴于今天（和最近）计算机的更大内存和更快的处理速度，我没有效率低下的问题。我在企业库中发现的效率是我不必自己编写和测试。而且，由于它的一致性和文档，我也不必花太多时间教给其他人。诚然，我没有专门测试它的速度，你可能会编写一个更有针对性的自定义版本，而不需要太多开销……但同样，效率在于使用库本身并继续解决其他更重要的问题.

# ms-access - MS Access 2003 ADP 报告图表

> ID：187901
> 
> 赞同：0
> 
> 时间：2008-10-09T15:49:32.153
> 
> 标签：ms-access, excel, vba

在 Access 2003 ADP 项目中以图表格式显示报告数据的最佳方法是什么？我知道这可以在普通的 MDB 中完成，但这似乎在幕后使用 Jet Crosstab 查询，这在 ADP 中不可用。我已经尝试过 Office 11 图表控件，但这似乎有点失败。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-11T15:40:43.107

这个有点空白，但经过一些实验后，我在 Office 11 Chart 上取得了一些成功。它以编程方式有点不灵活，但它的图表功能非常类似于 Excel，它非常适用于静态（非参数化）报告。

# jpa - JPA - 具有复合键的表与其自身的多对多关系

> ID：187908
> 
> 赞同：1
> 
> 时间：2008-10-09T15:50:30.713
> 
> 标签：jpa, many-to-many, entity-relationship, compound-key

我想使用 JPA 注释创建一个表（RoutePlace）与其自身的多对多关系。我想加入的表的独特之处在于它有一个复合键。

示例：[https ://h4losw2.files.wordpress.com/2008/10/tables.png](https://h4losw2.files.wordpress.com/2008/10/tables.png)

![替代文字](https://h4losw2.files.wordpress.com/2008/10/tables.png)

有什么建议么？

提前致谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-20T13:39:00.900

我不确定我的问题是否正确，但你的意思是这样的：

```
@IdClass(RoutePlacePK.class)
@Entity
public class RoutePlace {
    private Collection<RoutePlace> route;

    @ManyToMany(mappedBy = "place")
    public Collection<RoutePlace> getRoute() {
        return route;
    }

    public void setRoute(Collection<RoutePlace> route) {
        this.route = route;
    }

    private Collection<RoutePlace> place;

    @ManyToMany
    public Collection<RoutePlace> getPlace() {
        return place;
    }

    public void setPlace(Collection<RoutePlace> place) {
        this.place = place;
    }
} 
```

复合主键包装类：

```
public class RoutePlacePK {
    private int routeID;
    private int placeID;

    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;

        RoutePlacePK that = (RoutePlacePK) o;

        if (placeID != that.placeID) return false;
        if (routeID != that.routeID) return false;

        return true;
    }

    public int hashCode() {
        int result;
        result = routeID;
        result = 31 * result + placeID;
        return result;
    }
} 
```

# c# - 从集合到列表的最快转换

> ID：187913
> 
> 赞同：74
> 
> 时间：2008-10-09T15:51:37.670
> 
> 标签：c#, collections

我想避免的：

```
ManagementClass m = new ManagementClass("Win32_LogicalDisk");

ManagementObjectCollection managementObjects = m.GetInstances();

List<ManagementObject> managementList = new List<ManagementObject>();

foreach(ManagementObject m in managementObjects){

    managementList.Add(m);

} 
```

有没有办法将该集合放入一个类似于以下内容的列表中：

```
List<ManagementObject> managementList = new List<ManagementObjec>(collection_array); 
```

* * *

## 回答 #1

> 赞同：133
> 
> 时间：2008-10-09T15:53:42.487

什么版本的框架？使用 3.5，您大概可以使用：

```
List<ManagementObject> managementList = managementObjects.Cast<ManagementObject>().ToList(); 
```

（编辑删除更简单的版本；我检查并`ManagementObjectCollection`只实现了非通用`IEnumerable`形式）

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2015-08-02T01:32:40.717

你可以使用

```
using System.Linq; 
```

这将为您提供 ICollection<> 的 ToList<> 扩展方法

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-09T16:05:00.357

`managementObjects.Cast<ManagementBaseObject>().ToList();`是一个不错的选择。

您可以通过预先初始化列表容量来提高性能：

```
 public static class Helpers
    {
        public static List<T> CollectionToList<T>(this System.Collections.ICollection other)
        {
            var output = new List<T>(other.Count);

            output.AddRange(other.Cast<T>());

            return output;
        }
    } 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-09-20T17:41:34.330

从 3.5 开始，从 System.Collection.IEnumerable 继承的任何东西都有方便的扩展方法 OfType 可用。

如果您的集合来自 ICollection 或 IEnumerable，您可以这样做：

```
List<ManagementObject> managementList = ManagementObjectCollection.OfType<ManagementObject>().ToList(); 
```

找不到更简单的方法。:)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-09T15:53:28.603

你可以试试：

```
List<ManagementObject> managementList = new List<ManagementObject>(managementObjects.ToArray()); 
```

不确定 .ToArray() 是否可用于该集合。如果您确实使用了您发布的代码，请确保使用现有元素的数量初始化列表：

```
List<ManagementObject> managementList = new List<ManagementObject>(managementObjects.Count);  // or .Length 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-09T16:02:41.330

只要 ManagementObjectCollection 实现 IEnumerable<ManagementObject> 你可以这样做：

```
List<ManagementObject> managementList = new List<ManagementObjec>(managementObjects); 
```

如果没有，那么你就被困在你正在做的事情上。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-03-16T06:25:56.213

你可以像下面的代码片段一样转换

```
Collection<A> obj=new Collection<return ListRetunAPI()> 
```

# c# - 使用 C# .net 检测进程已在 Windows 中运行

> ID：187915
> 
> 赞同：8
> 
> 时间：2008-10-09T15:52:18.887
> 
> 标签：c#, .net, windows, winforms

如何检测一个进程是否已经在 Windows 任务管理器下运行？我也想获得内存和cpu使用情况。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-10-09T16:07:40.290

简单的例子...

```
bool processIsRunning(string process)
{
    return (System.Diagnostics.Process.GetProcessesByName(process).Length != 0);
} 
```

糟糕...忘记了内存使用情况等...

```
bool processIsRunning(string process)
{
System.Diagnostics.Process[] processes = 
    System.Diagnostics.Process.GetProcessesByName(process);
foreach (System.Diagnostics.Process proc in processes)
{
    Console.WriteLine("Current physical memory : " + proc.WorkingSet64.ToString());
    Console.WriteLine("Total processor time : " + proc.TotalProcessorTime.ToString());
    Console.WriteLine("Virtual memory size : " + proc.VirtualMemorySize64.ToString());
}
return (processes.Length != 0);
} 
```

（我将把从方法中获取数据的机制留给你——现在是 17:15，我准备回家了。:)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-09T15:54:05.653

您是否查看过[System.Diagnostics.Process](https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.process)类。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-09T16:07:46.343

您可以使用[System.Diagnostics.Process](https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.process)类。
有一个[GetProcesses()](https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.process.getprocesses)和一个[GetProcessesByName()](https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.process.getprocessesbyname)方法将获取数组中所有现有进程的列表。

该`Process`对象具有检测进程是否正在运行所需的所有信息。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-09T16:15:06.390

如果您想了解正在运行的 IE 进程：

```
System.Diagnostics.Process[] ieProcs = Process.GetProcessesByName("IEXPLORE");

if (ieProcs.Length > 0)
{
   foreach (System.Diagnostics.Process p in ieProcs)
   {                        
      String virtualMem = p.VirtualMemorySize64.ToString();
      String physicalMem = p.WorkingSet64.ToString();
      String cpu = p.TotalProcessorTime.ToString();                      
   }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-09T15:55:09.490

您可以使用 WMI 来查询一些内容

```
"SELECT * FROM Win32_Process WHERE Name = '<your process name here>'" 
```

但是，特别是使用 WMI 时，处理器的使用有点棘手。[正如Ian Jacobs](https://stackoverflow.com/questions/187915/detecting-a-process-is-already-running-in-windows-using-c-net#187927)建议的那样，使用 System.Diagnostics.Process 可能会更好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-09T16:15:14.470

像这样的东西：

```
foreach ( WindowsProcess in Process.GetProcesses) 
{ 
    if (WindowsProcess.ProcessName == nameOfProcess) { 
        Console.WriteLine(WindowsProcess.WorkingSet64.ToString); 
        Console.WriteLine(WindowsProcess.UserProcessorTime.ToString); 
        Console.WriteLine(WindowsProcess.TotalProcessorTime.ToString); 
    } 
} 
```

# sql-server-2005 - 临时表上的 DBCC CHECKIDENT 为错误的用户抛出权限错误

> ID：187920
> 
> 赞同：8
> 
> 时间：2008-10-09T15:53:14.843
> 
> 标签：sql-server-2005, stored-procedures, permissions, temp-tables

我作为非 sa 用户“bhk”登录到 SQL Server 2005 数据库，该用户仅是“公共”服务器角色的成员。以下代码尝试在用户“bhk”调用的存储过程中执行。这行代码...

```
TRUNCATE TABLE #Table1
DBCC CHECKIDENT('#Table1', RESEED, @SequenceNumber) WITH NO_INFOMSGS 
```

导致此错误...

> 用户 'guest' 无权为对象
> '#Table1__00000000007F' 运行 DBCC CHECKIDENT。

我知道运行 DBCC CHECKIDENT 所需的权限...
***调用者必须拥有该表****，或者是 sysadmin 固定服务器角色、db_owner 固定数据库角色或 db_ddladmin 固定数据库角色的成员。*

所以我有两个问题：

1.  由于'bhk'正在调用一个创建临时表的存储过程，'bhk'不应该是所有者并被允许运行DBCC CHECKIDENT吗？
2.  为什么错误消息返回用户 'guest' 没有权限？据我所知，我没有以“访客”身份登录。

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-13T15:39:05.857

这是另一种解决方案，如果您需要使用大于 1 的序列号重新播种，它可能会起作用。

```
TRUNCATE #Table1

SET IDENTITY_INSERT #Table1 ON

INSERT INTO #Table1 (TableID) -- This is your primary key field
VALUES (@SequenceNumber - 1)

SET IDENTITY_INSERT #Table1 OFF

DELETE FROM #Table1 
```

这样做是在临时表上设置 IDENTITY_INSERT，以允许您添加具有显式 ID 的行。然后您可以删除该行，但进一步的插入应该从最后一个序列号开始。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-11T15:16:26.543

你写了：

> “调用者必须拥有表，或者是 sysadmin 固定服务器角色的成员，db_owner 固定。”

所以（如果它不是错误的话），根据[Columbo 中尉](http://en.wikipedia.org/wiki/Columbo)无可挑剔的逻辑，每个前提都必须是错误的。这意味着，**调用者不拥有该表，**即使他创建了它。

事实上，似乎在 tempd**中创建的所有对象默认都归 dbo 所有**。如果您在查询分析器中执行以下操作，您可以检查它：

1.  使用低权限用户连接到*您的数据库。*
2.  执行：`CREATE TABLE #NotMyTable (TestID int identity)`
3.  连接到**与 dbo**相同的 SQL Server 的*tempdb*
***   执行：`SELECT user_name(uid) FROM sysobjects WHERE name LIKE '#NotMyTable%'`**

 **您会看到 dbo 是临时表的所有者。

**那么，有什么办法可以解决呢？**

（前言：*我不喜欢那种操纵，但智力刺激正在驱使我……;-)* ）

因此，您可以编写另一个存储过程，将 tempdb 的 sysobjects 中的 UID 更新为您的用户的值（*颤抖！*）。我只在查询分析器中对其进行了测试。更新后我可以执行您的 DBCC CHECKIDENT 命令。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-02-08T17:00:03.267

您可以通过完全限定 tempdb 表来完成此操作。

```
DBCC CHECKIDENT([tempdb..#Table1], RESEED, @SequenceNumber) WITH NO_INFOMSGS 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-13T09:07:27.690

执行 TRUNCATE 和 CHECKIDENT 命令的另一种解决方案是简单地删除并重新创建临时表。例如

```
DROP TABLE #Table1

CREATE TABLE #Table1
(
   ....
) 
```

不过，这可能不是最有效的解决方案。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-04-30T15:23:47.827

我刚碰到这个。我得到的答案是为相关帐户授予 tempdb 数据库中的权限，显然，这些表是在该数据库中创建的。

# file-format - 用于保存基于矢量的 3D 图形的格式

> ID：187921
> 
> 赞同：6
> 
> 时间：2008-10-09T15:53:25.747
> 
> 标签：file-format, vector-graphics

我编写了一个基于矢量的 3D 编辑器（UI 自定义有点像技术图纸）。我现在想以可移植格式保存矢量/绘图数据。哪些格式可用；其中哪一个（一个？）是最被广泛接受的，我在哪里可以获得格式规范？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-15T05:45:56.223

在商业上，许多用户会寻找 AutoCAD DWG 和 Bentley DGN 格式。虽然不是免费的，但可以从[开放设计联盟中找到生成这些格式的库](http://www.opendwg.org/home)

GIS 社区在矢量化 3d 模型中大量使用[shape](http://en.wikipedia.org/wiki/Shapefile)文件，可以在[此处](http://shapelib.maptools.org/)找到适用于 shape 文件的免费 SDK 。[OSG 库](http://en.wikipedia.org/wiki/OpenSceneGraph)也是免费的，支持多种矢量图形格式。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-09T15:56:01.390

[可缩放矢量图形 (SVG)](http://www.w3.org/Graphics/SVG/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T15:58:06.080

DXF：[http ://en.wikipedia.org/wiki/AutoCAD_DXF](http://en.wikipedia.org/wiki/AutoCAD_DXF)

# sql-server - 如何将 SQL Server 数据库对象添加到 TFS？

> ID：187936
> 
> 赞同：15
> 
> 时间：2008-10-09T15:56:41.683
> 
> 标签：sql-server, version-control, tfs, ssms

我们目前没有任何形式的源代码控制中的 SQL Server 对象。我们最近安装了 TFS 2008，我想添加我们的 SQL 服务器代码。我想我可以编写所有数据库的脚本并为每个对象创建脚本文件，但我希望有一种方法可以指向 SSMS 中的数据库并创建一个可以添加到 TFS 或类似内容的项目。基本上，我正在寻找从 A 点到 B 点的最简单方法。我已经安装了 TFS MSSCCI 提供程序，并且在 SSMS 的源代码控制提供程序选项中看到了 TFS。SQL Server 实例是 SS2005。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-09T16:02:31.313

如果您有 Visual Studio Team Developer 许可证，您可以下载数据库版本。它有一个项目类型，可以将您的表、存储过程、触发器等置于源代码控制之下，并将其检入 TFS。

**更新：**
Redgate 有一个名为[SQL Source Control](http://www.red-gate.com/products/sql-development/sql-source-control/)的产品。这与 TFS、SVN 等多个源代码控制系统相关联。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2014-07-29T19:02:16.103

您还可以尝试 ApexSQL 版本，这是一个 SSMS 插件，用于直接在 SSMS 中对数据库和数据库对象进行版本控制。

我们正在不断改进，您还可以在本文中查看我们未来改进的路线图：[重新设计 ApexSQL 版本 – 路线图](http://blog.apexsql.com/redesigning-apexsql-version-the-road-map/)

*免责声明：我为 ApexSQL 工作*

希望这可以帮助

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-09T16:04:27.333

我认为生成自己的脚本是最好的方法，正如这个优秀的系列文章所述：

[http://odetocode.com/Blogs/scott/archive/2008/01/31/11710.aspx](http://odetocode.com/Blogs/scott/archive/2008/01/31/11710.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-09T16:04:37.643

我使用 Tasks -> Generate Scripts in SSMS 创建一个 SQL 脚本，并将其存储在我的项目中。如果您这样做，请确保您选择的选项包括触发器和索引等内容。我通常会忽略脚本生成中的扩展属性，以使事情更紧凑。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-19T01:15:42.737

最简单的方法是使用 Quest Toad for SQL Server。免责声明 - 我为 Quest 工作，哈哈哈。无论如何，Toad 与 TFS 集成，因此您可以将对象签入和签出源代码控制。您不必先为对象编写脚本而烦恼。如果您想玩它，请免费获取最新的测试版，并且该网站上有一个活跃的用户社区，您可以在其中提问。

[适用于 SQL Server 的 Toad](http://toadsoft.com/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-09T16:02:41.190

你可能需要 Visual Studio Team System For Database Professionals 来做你想做的事。

我使用标准的数据库项目，每个数据库只保留三个脚本：一个用于模式，一个用于存储过程，一个用于数据填充。

# activex - 当进度不在主时间线上时，有没有办法使用 Flash ActiveX 对象检测 Flash 播放进度？

> ID：187965
> 
> 赞同：0
> 
> 时间：2008-10-09T16:04:49.890
> 
> 标签：activex, flash

我已经完成了一些编程，将 Flash ActiveX 控件嵌入到我的程序中。我将在用户提供的“播放列表”中播放 SWF 文件。通常，我会保持一个计时器运行，查看 CurrentFrame 与 TotalFrames 以检测向前运动。我不允许循环 - 如果 CurrentFrame 曾经减少，我会跳出文件。

但是，有一种新的 SWF 文件——通常来自将 PowerPoint 演示文稿转换为 SWF 文件的转换程序——现在可以在主时间线之外执行所有操作。因此，根据 ActiveX 控件，一个 30 秒的 SWF 文件可能只有 5 帧。它仍然播放 30 秒，但 CurrentFrame*非常*快地达到 TotalFrames，我的程序将在那时停止播放文件。不是期望的行为。

那么 - 是否有某种方法，仅使用 Flash ActiveX 控件，我可以确定 Flash 播放是否仍在前进？或者是否有一些我可以挂钩或查找 Flash 在内部使用的事件来指示它已到达播放结束？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-09T20:56:24.530

你对此无能为力。基本上，您必须以某种方式知道持续时间，如果 swf 不提供该信息，我无法提出解决方案。如果您可以控制加载的 swf，您可以在 swf 完成后使用 ExternalInterface 与主机通信。如果你不能修改 swf 的，这当然是行不通的。

# c# - GetResponse 对 Sharepoint 网站未经授权

> ID：187971
> 
> 赞同：1
> 
> 时间：2008-10-09T16:06:01.277
> 
> 标签：c#, sharepoint

我有以下代码可以毫无问题地 ping 一个典型的匿名网站，但我收到未经授权的错误或被禁止。这是给我禁止错误的代码。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Net;

public partial class Ping : System.Web.UI.Page
{
    protected string PingResponseTime(string url)
    {
        // Create a 'WebRequest' object with the specified url. 
        WebRequest myWebRequest = WebRequest.Create(url);
    myWebRequest.Credentials = new NetworkCredential("username","password","domain");
        myWebRequest.Timeout = 90000;
        string requestTime, elapsedSecs;
        // If trace enabled - set the Trace
        WebHeaderCollection myWebCollection = new WebHeaderCollection();
        myWebCollection.Add("Trace", "1");
        myWebRequest.Headers = myWebCollection;
        // Send the 'WebRequest' and wait for response. 
        DateTime startTime = DateTime.Now;       // Start time
        myWebRequest.GetResponse();              // Web Request
        DateTime stopTime = DateTime.Now;        // End Time
        TimeSpan duration = stopTime - startTime;     // Time Diff
    //    succededStr = "1";
        requestTime = startTime.ToString();
        elapsedSecs = duration.ToString().Substring(6);
        return elapsedSecs;
    }

    protected void btnPing_Click(object sender, EventArgs e)
    {
        lblResponseTime.Text = PingResponseTime(txtURL.Text.ToString());
    }
} 
```

ping Sharepoint 站点时出现禁止错误，我做错了什么？我什至尝试过启用匿名访问的 Sharepoint 站点。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-10T09:20:10.563

您是否尝试过更换线路：

```
myWebRequest.Credentials = new NetworkCredential("username", "password", "domain"); 
```

和 ：

```
myWebRequest.Credentials = CredentialCache.DefaultCredentials; 
```

或者 ：

```
myWebRequest.Credentials = CredentialCache.DefaultNetworkCredentials; 
```

# msbuild - 子目录中的 MSBUILD 任务项：不能在这些上进行增量构建吗？

> ID：187974
> 
> 赞同：0
> 
> 时间：2008-10-09T16:06:24.957
> 
> 标签：msbuild

我有一个简单的 Word 到 Pdf 转换器作为 MSBuild 任务。该任务将 Word 文件 (ITaskItems) 作为输入，将 Pdf 文件 (ITaskItems) 作为输出。该脚本使用 Target 转换进行转换：

```
<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="3.5">
  <UsingTask AssemblyFile="$(MSBuildExtensionsPath)\MyTasks.dll" TaskName="MyTasks.DocToPdf" />
  <Target Name="Build" DependsOnTargets="Convert" />
  <Target Name="Convert"
          Inputs="@(WordDocuments)"
          Outputs="@(WordDocuments->'%(FileName).pdf')">
    <DocToPdf Inputs="@(WordDocuments)"
              Outputs="%(FileName).pdf">
      <Output TaskParameter="ConvertedFiles" ItemName="PdfDocuments" />
    </DocToPdf>
  </Target>
  <ItemGroup>
    <WordDocuments Include="One.doc" />
    <WordDocuments Include="SubDir\Two.doc" />

    <WordDocuments Include="**\*.doc" />
  </ItemGroup>
</Project> 
```

发生的事情是 SubDir\Two.doc 在每次增量构建时都会被转换，而 One.doc 不会（即 MSBuild 正确跳过该文件，因为它已经被转换）。如果我使用递归项目规范（上面的第三个），我会得到相同的行为（即 One.doc 只有在 PDF 过期或丢失时才会被转换，但子目录中的所有文档总是会被转换）。

我在这里做错了什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-09T16:27:10.283

我发现了问题。事实证明，我在 Task 中有一些逻辑，它将为 PDF 文件指定的任何相对路径转换为绝对路径。一旦我删除它并将脚本更改为：

```
 <Target Name="Convert"
          Inputs="@(WordDocuments)"
          Outputs="@(WordDocuments->'%(RelativeDir)%(FileName).pdf')">
    <DocToPdf Inputs="%(WordDocuments.Identity)"
              Outputs="%(RelativeDir)%(FileName).pdf">
      <Output TaskParameter="ConvertedFiles" ItemName="PdfDocuments" />
    </DocToPdf>
  </Target> 
```

我得到了我预期的行为。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-10T22:11:41.993

这是我对通过子目录递归找到的项目执行增量构建的任务示例：

```
 <Target Name="Build" Inputs="@(RequestTextFiles)" Outputs="@(RequestTextFiles -> '%(Rootdir)%(Directory)%(Filename).out')">

    <DoSomething SourceFiles="@(RequestTextFiles)" />

  </Target> 
```

这将 1:1 映射到一个输入文件和一个具有相同名称的输出文件，该文件输出到具有不同扩展名的相同路径，在本例中为“out”。

# regex - 这些 Unicode 字符（代码点）在这个正则表达式中是什么意思？

> ID：187981
> 
> 赞同：3
> 
> 时间：2008-10-09T16:09:52.190
> 
> 标签：regex, unicode, diacritics, codepoint

我有以下正则表达式：我想出了大部分如下：

```
ValidationExpression="^[\u0020\u0027\u002C\u002D\u0030-\u0039\u0041-\u005A\u005F\u0061-\u007A\u00C0-\u00FF°./]{1,256}$"

u0020 : 空间
u0027 : 撇号
u002C : 逗号
u002D：连字符/减号
u0030-\u0039\：0-9
u0041-\u005A : A - Z
u005F : 下划线
u0061-\u007A\ : a - z

u00C0-\u00FF°./ : ??

```

在理解验证表达式的最后部分时需要帮助：

```
u00C0-\u00FF°./
```

任何人都知道这是什么意思？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-09T16:13:50.090

\u00C0 - \u00FF 是带有重音符号的字母，尽管这还不是全部。而“°”只是度数字符。但是，“./”应该是“\”。允许句点字符。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T16:18:54.400

奇怪...根据 Windows 上的字符映射，我会说“À 到 ÿ”

这些是 A、C、E、I、D、N、O、U、Y、德国夏普 s 的一些变体（重音、变音符）...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T16:20:42.930

[您的问题标题错误，您需要有关Unicode](http://wikipedia.org/wiki/Unicode) codepoints 的[帮助](http://wikipedia.org/wiki/Code_point)。例如，您可以[在此处](http://namidst.com/stuff/unidata/)查看它们。

它们是 Latin1 Supplement 的后半部分，包括重读的人声和其他一些字符。请参阅上面的链接。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-09T17:00:47.000

使用[http://rishida.net/scripts/uniview/conversion.php](http://rishida.net/scripts/uniview/conversion.php) 我得到：',-0-9A-Z_a-zÀ-ÿ

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-04-11T04:44:02.560

您拆分原始字符串的结果看起来很奇怪，好像您不了解 Unicode 转义序列是什么。它应该看起来像：

```
\u0020
\u0027
\u002C
\u002D
\u0030-\u0039
\u0041-\u005A
\u005F
\u0061-\u007A
\u00C0-\u00FF
°
.
/ 
```

您可以在 Unicode 网站上查找这些代码点的含义：

*   [https://www.unicode.org/charts/PDF/U0000.pdf](https://www.unicode.org/charts/PDF/U0000.pdf)（基本拉丁文）
*   [https://www.unicode.org/charts/PDF/U0080.pdf（Latin-1](https://www.unicode.org/charts/PDF/U0080.pdf)补充）
*   [https://www.unicode.org/charts/PDF/U1F600.pdf](https://www.unicode.org/charts/PDF/U1F600.pdf)（表情）

最后三个字符的确切含义是：

*   学位标志
*   点/句点/句号
*   正斜杠

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2008-10-09T16:23:59.680

它看起来是 TABLE ASCII-II 中最后 2 列中显示的字符范围，位于[扩展 ASCII 图表的以下链接中](http://www.cdrummond.qc.ca/cegep/informat/Professeurs/Alain/files/ascii.htm)

# c# - 如何在 C# 的任务管理器中隐藏进程？

> ID：187983
> 
> 赞同：36
> 
> 时间：2008-10-09T16:10:11.033
> 
> 标签：c#, .net, taskmanager

我需要在任务管理器中隐藏一个进程。适用于内网场景。所以，一切都是合法的。:)

请随时分享您拥有的任何代码（最好是 C# 代码）或任何其他技术或与此路线相关的任何问题。

**更新 1**：大多数用户拥有管理员权限才能运行一些旧版应用程序。因此，建议之一是将其隐藏在任务管理器中。如果有其他方法可以防止用户终止进程，那就太好了。

**更新 2 ：删除对 rootkit 的引用**。**不知何故，这篇文章看起来很消极。**

 *** * *

## 回答 #1

> 赞同：73
> 
> 时间：2008-10-09T16:29:57.937

不要试图阻止它被杀死——你不会去管理它。相反，让它定期调用网络服务。当 web 服务注意到客户端“静默”时，它可以 ping 机器以查看这是否只是重新启动问题，并向经理（或任何人）发送电子邮件以惩罚终止进程的人。

* * *

## 回答 #2

> 赞同：48
> 
> 时间：2008-10-09T16:22:03.693

没有支持的方式来实现这一点。可以在任何特权级别读取进程列表。如果您希望甚至对管理员隐藏进程，那么这是双重不受支持的。

要让它工作，您需要编写一个内核模式 rootkit 来拦截对[NtQuerySystemInformation](http://msdn.microsoft.com/en-us/library/ms724509(VS.85).aspx)的调用，以便 SystemProcessInformation 信息类无法列出您的隐藏进程。

拦截系统调用很难安全地进行，64 位 Windows 内核[竭尽全力](http://www.microsoft.com/whdc/driver/kernel/64bitPatching.mspx)防止这种情况发生：尝试修改系统调用表会导致即时蓝屏。在这些平台上会非常困难

[这](https://blogs.technet.microsoft.com/markrussinovich/2005/10/31/sony-rootkits-and-digital-rights-management-gone-too-far/)是一个尝试做类似事情的rootkit的例子（并且有几个严重的问题）。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-10-09T16:35:06.163

如果你想阻止用户从任务管理器中杀死进程，你可以在进程上使用安全描述符来拒绝终止对每个人的访问。从技术上讲，管理员仍然可以通过获取进程的所有权并重置 DACL 来终止进程，但是任务管理器中没有执行这些操作的界面。[Process Explorer](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)可能有一个接口。

当您的进程启动时，使用[SetKernelObjectSecurity](http://msdn.microsoft.com/en-us/library/aa379578(VS.85).aspx)并`DACL_SECURITY_INFORMATION`使用当前进程句柄。设置具有零 ACL 的 DACL。这将拒绝所有人的所有访问权限，包括那些试图用任务管理器结束您的进程的人。

这是一个也更改进程所有者的示例：

```
SECURITY_DESCRIPTOR sd;
ACL dacl;
SID_IDENTIFIER_AUTHORITY ntauth = SECURITY_NT_AUTHORITY;
PSID owner;

assert(InitializeAcl(&dacl, sizeof dacl, ACL_REVISION));

assert(AllocateAndInitializeSid(&ntauth, 1, SECURITY_LOCAL_SYSTEM_RID, 0,0,0,0,0,0,0, &owner));

assert(InitializeSecurityDescriptor(&sd, SECURITY_DESCRIPTOR_REVISION));

assert(SetSecurityDescriptorDacl(&sd, TRUE, &dacl, FALSE));

assert(SetSecurityDescriptorOwner(&sd, owner, FALSE));

assert(SetKernelObjectSecurity(GetCurrentProcess(), DACL_SECURITY_INFORMATION | OWNER_SECURITY_INFORMATION, &sd));

assert(FreeSid(owner) == NULL); 
```

不幸的是，它似乎没有效果。我仍然可以关闭该进程（尽管不是受限用户）。也许任务管理器正在取得所有权或调用其他特权来终止进程？我似乎记得这在以前版本的 Windows 中工作（我正在测试 2003），但我可能弄错了。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-10-09T16:11:42.637

我希望你不能。

**更新：**鉴于这种情况，我认为您最好在不同的管理员帐户下运行它。这可能有助于提醒人们不要终止进程。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-10-09T16:39:02.910

或者，您可以编写一个小的“检查器”实用程序来检查应用程序是否正在运行，如果不是，它会自动启动它。然后将代码添加到应用程序以检查执行相同操作的“检查器”实用程序。这样，如果一个被终止，那么另一个将重新启动它。我似乎病毒会这样做，而且它似乎非常有效。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2012-02-28T15:25:03.297

编写驱动程序 - 您可以使用 ObRegisterCallbacks 来注册进程对象访问通知。当 DesiredAccess 包含您不喜欢的访问权限时返回 STATUS_ACCESS_DENIED，例如进程终止或写入进程内存。

[http://msdn.microsoft.com/en-us/library/windows/hardware/ff558692(v=vs.85).aspx](http://msdn.microsoft.com/en-us/library/windows/hardware/ff558692(v=vs.85).aspx)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-09T16:26:19.393

如果您只是需要伪装进程而不是完全隐藏它，您可以将其重命名为 winlogon.exe 或 svchost.exe，它可能会被用户忽略。但正如塞尔吉奥所说，这是默默无闻的安全性，它的名声不好是有原因的。

如果用户拥有适当的权限，则防止用户杀死进程是另一个困难。我知道的唯一方法是让多个进程相互监视并重新启动任何被监视的进程被杀死。再一次，这走上了一条阴暗的道路。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2013-01-11T12:59:19.640

不知道为什么还没有建议，但这是我在这个网站上的第一个答案。而不是阻止用户杀死进程。（需要 rootkit 挂钩。）您可以简单地禁用任务管理器与注册表输入一起使用。

```
public static void ToggleTaskManager(bool toggle)
{
    Microsoft.Win32.RegistryKey HKCU = Microsoft.Win32.Registry.LocalMachine;
    Microsoft.Win32.RegistryKey key = HKCU.CreateSubKey(@"Software\Microsoft\Windows\CurrentVersion\Policies\System");
    key.SetValue("DisableTaskMgr", toggle ? 0 : 1, Microsoft.Win32.RegistryValueKind.DWord);
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-09T16:27:52.153

没有简单或受支持的方法可以做到这一点。即使您编写了一个 rootkit 来执行此操作，也很容易被未来的更新所破坏，该更新旨在填补该漏洞。我会重新检查这是否是您想要做的事情。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-12-27T17:43:21.653

正如上面所说的，最好的方法是2个任务，互相监控，我理解你不想浪费CPU，所以最好的方法是在任务之间建立一个事件，当一个任务关闭时触发。

我不完全确定如何设置挂钩，但是您不会使用会浪费 CPU 的 while 循环。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2013-08-06T15:19:32.920

很多人可能知道怎么做，但不会在这里发布。在互联网上发布恶意代码是非常危险的。谁知道你可能有危险。问一些计算机工程师。我会给你程序的结构。

只需将程序的 dll 注入 explorer.exe。

您的进程不仅会显示出来，因为它不是作为程序运行，而是在程序（explorer.exe）中运行。即使他使用任何类型的任务管理器，用户也不会看到该过程。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2010-03-24T16:48:17.210

您是否考虑过编写服务？这样服务作为本地系统运行，应用程序在用户的上下文下运行，服务可以保证事情仍然按需要完成，而应用程序只是这个服务的一个接口。终止应用程序只会导致用户看不到任何通知、系统托盘图标等，但服务仍在执行其工作。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2017-11-19T09:39:57.037

我看到@Chris Smith 的回答，我决定将其转换为 C#。

下面是取自[这里](http://csharptest.net/1043/how-to-prevent-users-from-killing-your-service-process/index.html)的代码，用于一个简单的 Winform 应用程序：
**C# 变体：**

```
 using System;
    using System.Collections.Generic;
    using System.ComponentModel;
    using System.Data;
    using System.Drawing;
    using System.Linq;
    using System.Runtime.InteropServices;
    using System.Security.AccessControl;
    using System.Security.Principal;
    using System.Text;
    using System.Threading.Tasks;
    using System.Windows.Forms;

namespace Hide2
{
    public partial class Form1 : Form
    {
        [DllImport("advapi32.dll", SetLastError = true)]
        static extern bool GetKernelObjectSecurity(IntPtr Handle, int securityInformation, [Out] byte[] pSecurityDescriptor,
        uint nLength, out uint lpnLengthNeeded);

        public static RawSecurityDescriptor GetProcessSecurityDescriptor(IntPtr processHandle)
        {
            const int DACL_SECURITY_INFORMATION = 0x00000004;
            byte[] psd = new byte[0];
            uint bufSizeNeeded;
            // Call with 0 size to obtain the actual size needed in bufSizeNeeded
            GetKernelObjectSecurity(processHandle, DACL_SECURITY_INFORMATION, psd, 0, out bufSizeNeeded);
            if (bufSizeNeeded < 0 || bufSizeNeeded > short.MaxValue)
                throw new Win32Exception();
            // Allocate the required bytes and obtain the DACL
            if (!GetKernelObjectSecurity(processHandle, DACL_SECURITY_INFORMATION,
            psd = new byte[bufSizeNeeded], bufSizeNeeded, out bufSizeNeeded))
                throw new Win32Exception();
            // Use the RawSecurityDescriptor class from System.Security.AccessControl to parse the bytes:
            return new RawSecurityDescriptor(psd, 0);
        }

        [DllImport("advapi32.dll", SetLastError = true)]
        static extern bool SetKernelObjectSecurity(IntPtr Handle, int securityInformation, [In] byte[] pSecurityDescriptor);

        [DllImport("kernel32.dll")]
        public static extern IntPtr GetCurrentProcess();

        [Flags]
        public enum ProcessAccessRights
        {
            PROCESS_CREATE_PROCESS = 0x0080, //  Required to create a process.
            PROCESS_CREATE_THREAD = 0x0002, //  Required to create a thread.
            PROCESS_DUP_HANDLE = 0x0040, // Required to duplicate a handle using DuplicateHandle.
            PROCESS_QUERY_INFORMATION = 0x0400, //  Required to retrieve certain information about a process, such as its token, exit code, and priority class (see OpenProcessToken, GetExitCodeProcess, GetPriorityClass, and IsProcessInJob).
            PROCESS_QUERY_LIMITED_INFORMATION = 0x1000, //  Required to retrieve certain information about a process (see QueryFullProcessImageName). A handle that has the PROCESS_QUERY_INFORMATION access right is automatically granted PROCESS_QUERY_LIMITED_INFORMATION. Windows Server 2003 and Windows XP/2000:  This access right is not supported.
            PROCESS_SET_INFORMATION = 0x0200, //    Required to set certain information about a process, such as its priority class (see SetPriorityClass).
            PROCESS_SET_QUOTA = 0x0100, //  Required to set memory limits using SetProcessWorkingSetSize.
            PROCESS_SUSPEND_RESUME = 0x0800, // Required to suspend or resume a process.
            PROCESS_TERMINATE = 0x0001, //  Required to terminate a process using TerminateProcess.
            PROCESS_VM_OPERATION = 0x0008, //   Required to perform an operation on the address space of a process (see VirtualProtectEx and WriteProcessMemory).
            PROCESS_VM_READ = 0x0010, //    Required to read memory in a process using ReadProcessMemory.
            PROCESS_VM_WRITE = 0x0020, //   Required to write to memory in a process using WriteProcessMemory.
            DELETE = 0x00010000, // Required to delete the object.
            READ_CONTROL = 0x00020000, //   Required to read information in the security descriptor for the object, not including the information in the SACL. To read or write the SACL, you must request the ACCESS_SYSTEM_SECURITY access right. For more information, see SACL Access Right.
            SYNCHRONIZE = 0x00100000, //    The right to use the object for synchronization. This enables a thread to wait until the object is in the signaled state.
            WRITE_DAC = 0x00040000, //  Required to modify the DACL in the security descriptor for the object.
            WRITE_OWNER = 0x00080000, //    Required to change the owner in the security descriptor for the object.
            STANDARD_RIGHTS_REQUIRED = 0x000f0000,
            PROCESS_ALL_ACCESS = (STANDARD_RIGHTS_REQUIRED | SYNCHRONIZE | 0xFFF),//    All possible access rights for a process object.
        }
        public static void SetProcessSecurityDescriptor(IntPtr processHandle, RawSecurityDescriptor dacl)
        {
            const int DACL_SECURITY_INFORMATION = 0x00000004;
            byte[] rawsd = new byte[dacl.BinaryLength];
            dacl.GetBinaryForm(rawsd, 0);
            if (!SetKernelObjectSecurity(processHandle, DACL_SECURITY_INFORMATION, rawsd))
                throw new Win32Exception();
        }

        public Form1()
        {
            InitializeComponent();

            // Get the current process handle
            IntPtr hProcess = GetCurrentProcess();
            // Read the DACL
            var dacl = GetProcessSecurityDescriptor(hProcess);
            // Insert the new ACE
            dacl.DiscretionaryAcl.InsertAce(
            0,
            new CommonAce(
            AceFlags.None,
            AceQualifier.AccessDenied,
            (int)ProcessAccessRights.PROCESS_ALL_ACCESS,
            new SecurityIdentifier(WellKnownSidType.WorldSid, null),
            false,
            null)
            );
            // Save the DACL
            SetProcessSecurityDescriptor(hProcess, dacl);
        }
    }
} 
```

以受限用户身份运行后，我无法从任务管理器中将其杀死，只能以管理员身份。
我离开了`X`按钮，以便能够在没有管理员的情况下将其关闭，但也可以将其删除。

结果：

[![在此处输入图像描述](https://i.stack.imgur.com/3zI5E.png)](https://i.stack.imgur.com/3zI5E.png)

**Powershell 变体：**

```
$source = @"
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Runtime.InteropServices;
using System.Security.AccessControl;
using System.Security.Principal;

namespace Hide2
{
    public class myForm
    {
        [DllImport("advapi32.dll", SetLastError = true)]
        static extern bool GetKernelObjectSecurity(IntPtr Handle, int securityInformation, [Out] byte[] pSecurityDescriptor,
        uint nLength, out uint lpnLengthNeeded);

        public static RawSecurityDescriptor GetProcessSecurityDescriptor(IntPtr processHandle)
        {
            const int DACL_SECURITY_INFORMATION = 0x00000004;
            byte[] psd = new byte[0];
            uint bufSizeNeeded;
            // Call with 0 size to obtain the actual size needed in bufSizeNeeded
            GetKernelObjectSecurity(processHandle, DACL_SECURITY_INFORMATION, psd, 0, out bufSizeNeeded);
            if (bufSizeNeeded < 0 || bufSizeNeeded > short.MaxValue)
                throw new Win32Exception();
            // Allocate the required bytes and obtain the DACL
            if (!GetKernelObjectSecurity(processHandle, DACL_SECURITY_INFORMATION,
            psd = new byte[bufSizeNeeded], bufSizeNeeded, out bufSizeNeeded))
                throw new Win32Exception();
            // Use the RawSecurityDescriptor class from System.Security.AccessControl to parse the bytes:
            return new RawSecurityDescriptor(psd, 0);
        }

        [DllImport("advapi32.dll", SetLastError = true)]
        static extern bool SetKernelObjectSecurity(IntPtr Handle, int securityInformation, [In] byte[] pSecurityDescriptor);

        [DllImport("kernel32.dll")]
        public static extern IntPtr GetCurrentProcess();

        [Flags]
        public enum ProcessAccessRights
        {
            PROCESS_CREATE_PROCESS = 0x0080, //  Required to create a process.
            PROCESS_CREATE_THREAD = 0x0002, //  Required to create a thread.
            PROCESS_DUP_HANDLE = 0x0040, // Required to duplicate a handle using DuplicateHandle.
            PROCESS_QUERY_INFORMATION = 0x0400, //  Required to retrieve certain information about a process, such as its token, exit code, and priority class (see OpenProcessToken, GetExitCodeProcess, GetPriorityClass, and IsProcessInJob).
            PROCESS_QUERY_LIMITED_INFORMATION = 0x1000, //  Required to retrieve certain information about a process (see QueryFullProcessImageName). A handle that has the PROCESS_QUERY_INFORMATION access right is automatically granted PROCESS_QUERY_LIMITED_INFORMATION. Windows Server 2003 and Windows XP/2000:  This access right is not supported.
            PROCESS_SET_INFORMATION = 0x0200, //    Required to set certain information about a process, such as its priority class (see SetPriorityClass).
            PROCESS_SET_QUOTA = 0x0100, //  Required to set memory limits using SetProcessWorkingSetSize.
            PROCESS_SUSPEND_RESUME = 0x0800, // Required to suspend or resume a process.
            PROCESS_TERMINATE = 0x0001, //  Required to terminate a process using TerminateProcess.
            PROCESS_VM_OPERATION = 0x0008, //   Required to perform an operation on the address space of a process (see VirtualProtectEx and WriteProcessMemory).
            PROCESS_VM_READ = 0x0010, //    Required to read memory in a process using ReadProcessMemory.
            PROCESS_VM_WRITE = 0x0020, //   Required to write to memory in a process using WriteProcessMemory.
            DELETE = 0x00010000, // Required to delete the object.
            READ_CONTROL = 0x00020000, //   Required to read information in the security descriptor for the object, not including the information in the SACL. To read or write the SACL, you must request the ACCESS_SYSTEM_SECURITY access right. For more information, see SACL Access Right.
            SYNCHRONIZE = 0x00100000, //    The right to use the object for synchronization. This enables a thread to wait until the object is in the signaled state.
            WRITE_DAC = 0x00040000, //  Required to modify the DACL in the security descriptor for the object.
            WRITE_OWNER = 0x00080000, //    Required to change the owner in the security descriptor for the object.
            STANDARD_RIGHTS_REQUIRED = 0x000f0000,
            PROCESS_ALL_ACCESS = (STANDARD_RIGHTS_REQUIRED | SYNCHRONIZE | 0xFFF),//    All possible access rights for a process object.
        }
        public static void SetProcessSecurityDescriptor(IntPtr processHandle, RawSecurityDescriptor dacl)
        {
            const int DACL_SECURITY_INFORMATION = 0x00000004;
            byte[] rawsd = new byte[dacl.BinaryLength];
            dacl.GetBinaryForm(rawsd, 0);
            if (!SetKernelObjectSecurity(processHandle, DACL_SECURITY_INFORMATION, rawsd))
                throw new Win32Exception();
        }

        public static void ProtectMyProcess()
        {
            // Get the current process handle
            IntPtr hProcess = GetCurrentProcess();
            // Read the DACL
            var dacl = GetProcessSecurityDescriptor(hProcess);
            // Insert the new ACE
            dacl.DiscretionaryAcl.InsertAce(
            0,
            new CommonAce(
            AceFlags.None,
            AceQualifier.AccessDenied,
            (int)ProcessAccessRights.PROCESS_ALL_ACCESS,
            new SecurityIdentifier(WellKnownSidType.WorldSid, null),
            false,
            null)
            );
            // Save the DACL
            SetProcessSecurityDescriptor(hProcess, dacl);

        }
    }
}
"@

Add-Type -TypeDefinition $Source -Language CSharp  

[ScriptBlock]$scriptNewForm = {
    Add-Type -AssemblyName System.Windows.Forms

    $Form = New-Object system.Windows.Forms.Form
    $Form.Text = "PowerShell form"
    $Form.TopMost = $true
    $Form.Width = 303
    $Form.Height = 274

    [void]$Form.ShowDialog()
    $Form.Dispose()
}

$SleepTimer = 200
$MaxResultTime = 120
$MaxThreads = 3

$ISS = [system.management.automation.runspaces.initialsessionstate]::CreateDefault()
$RunspacePool = [runspacefactory]::CreateRunspacePool(1, $MaxThreads, $ISS, $Host)
$RunspacePool.Open()

$Jobs = @()

$PowershellThread = [powershell]::Create().AddScript($scriptNewForm)
$PowershellThread.RunspacePool = $RunspacePool
$Handle = $PowershellThread.BeginInvoke()
$Job = "" | Select-Object Handle, Thread, object
$Job.Handle = $Handle
$Job.Thread = $PowershellThread
$Job.Object = $computer
$Jobs += $Job

[Hide2.myForm]::ProtectMyProcess()

<#
ForEach ($Job in $Jobs){
    $Job.Thread.EndInvoke($Job.Handle)
    $Job.Thread.Dispose()
    $Job.Thread = $Null
    $Job.Handle = $Null
}
#> 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-09T16:40:20.240

你只是要求用户不要杀死进程呢？你会花多少时间去做这件事，因为在同一家公司的员工显然是幼稚的行为。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2015-06-15T19:03:23.313

我知道这个问题很老，但我不久前回答了一个重复的问题，其中包含一些不错的信息，但这里没有，所以我想我会链接到它。 [请参阅我对重复问题的回答。](https://stackoverflow.com/a/4167219/361783)此外，如果您的真正目标是阻止用户终止该进程，那么我所知道的过去很容易工作，尽管它有点骇人听闻而且我不知道这是否仍然有效，只是简单地将您的应用程序命名为 lsass.exe并且任务管理器甚至不允许管理员用户关闭该进程。对于这种方法，哪个用户启动进程或可执行文件驻留在文件系统上的位置都没有关系，Windows 似乎只是检查进程是否被命名为 this 然后不允许它结束。

更新：我刚刚尝试在 Windows 7 上执行 lsass.exe 技巧，它似乎已修复，但我猜它仍然适用于 windows xp，甚至可能适用于 xp 以外版本的早期服务包。尽管在撰写本文时这不再有效，但我认为无论如何我都会将其作为一个有趣的事实包含在内。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2015-03-31T18:36:32.200

要阻止进程被永久终止，让进程做的第一件事是调用“atexit()”并让 atexit() 函数启动进程

# asp.net - NHibernate 数据库连接在负载下失败

> ID：187987
> 
> 赞同：1
> 
> 时间：2008-10-09T16:11:09.130
> 
> 标签：asp.net, nhibernate

我想知道这对于任何有经验的 NHibernate 开发人员来说是否熟悉，或者是否有人可以告诉我从哪里开始尝试解决这个问题：

我继承了一个用 ASP.NET 1.1 编写的 NHibernate 站点，使用 NHibernate 0.6 和 .NET 远程处理驻留在数据库服务器上的 DAL 层。我一直在尝试将其升级到 ASP.NET 3.5 和 NHibernate 1.2.1.4。

我用直接的数据库连接替换了 .NET 远程处理设置，一切正常，直到站点承受一定的负载，然后 NHibernate 调用开始间歇性地失败并抛出异常：ADOException 无法执行查询，然后是 NHibernate 生成的 SQL 语句。

给出错误的堆栈跟踪是：

```
NHibernate.Loader.Loader.LoadEntity(ISessionImplementor session, Object id, IType identifierType, Object optionalObject, Type optionalEntityName, Object optionalIdentifier, IEntityPersister persister)
   at NHibernate.Loader.Entity.AbstractEntityLoader.Load(ISessionImplementor session, Object id, Object optionalObject, Object optionalId)
   at NHibernate.Loader.Entity.AbstractEntityLoader.Load(Object id, Object optionalObject, ISessionImplementor session)
   at NHibernate.Persister.Entity.AbstractEntityPersister.Load(Object id, Object optionalObject, LockMode lockMode, ISessionImplementor session)
   at NHibernate.Impl.SessionImpl.DoLoad(Type theClass, Object id, Object optionalObject, LockMode lockMode, Boolean checkDeleted)
   at NHibernate.Impl.SessionImpl.DoLoadByClass(Type clazz, Object id, Boolean checkDeleted, Boolean allowProxyCreation)
   at NHibernate.Impl.SessionImpl.Load(Type clazz, Object id) 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-10T13:30:09.800

问题是非线程安全的休眠会话工厂。将项目更改为使用 http 模块，以便每个请求使用一个休眠会话（并确保不要为非 .as*x 文件上的 rquests 打开会话），一切都很好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-09T16:19:29.893

*   验证您的连接设置。
*   如果可以的话，尽可能多地缓存对象以避免破坏服务器
*   确保你的表被索引了……那是一个巨大的
*   确保 log4net 的日志记录变为警告/错误，这样您就不会在日志中写百科全书

# oracle - 如何在 PL/SQL 包中将会话变量 skip_unusable_indexes 设置为 true 以加速表删除/插入？

> ID：187988
> 
> 赞同：3
> 
> 时间：2008-10-09T16:11:17.163
> 
> 标签：oracle, session, plsql, indexing

我正在尝试加快通过 PL/SQL 存储过程控制的数据加载。我以编程方式将要刷新的表的索引更改为不可用。我希望 Oracle 忽略这些不可用的索引。我可以发表声明：

```
ALTER SESSION SET skip_unusable_indexes = TRUE 
```

但我随后得到了错误：

> ORA-01502: 索引 'MY_INDEX_NAME' 或此类索引的分区处于不可用状态

所以它似乎忽略了我的改变会话。

我可以在 PL/SQL 包中更改我的会话吗？如果没有，我的选择是什么？我还能如何禁用（设置不可用）索引以加快负载？

[这里](https://stackoverflow.com/questions/129046/disable-and-later-enable-all-table-indexes-in-oracle)有一个有点相关的问题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-09T16:19:00.953

您是否在存储过程使用的同一会话中发出 ALTER SESSION 语句？还是 ALTER SESSION 在单独的会话中执行？

您可以使用动态 SQL 将 ALTER SESSION 嵌入到您的 PL/SQL 中，即

```
BEGIN
  EXECUTE IMMEDIATE 'ALTER SESSION SET skip_unusable_indexes = TRUE';

  <<more code>>
END; 
```

某些索引是否唯一（或用于强制执行唯一约束）？作为[skip_unusable_indexes 文档](http://download.oracle.com/docs/cd/B19306_01/server.102/b14237/initparams200.htm#REFRN10240)所述

> 注意：如果使用索引对表强制执行 UNIQUE 约束，则允许对表执行插入和更新操作可能会违反约束。因此，此设置不会禁用唯一的不可用索引的错误报告。

如果是这种情况，您可以禁用约束和/或将索引更改为非唯一的吗？

唯一索引和非唯一索引之间差异的快速示例。请注意，当您有一个不可用的唯一索引时，skip_unusable_indexes 不会像当您有一个不可用的非唯一索引时那样抑制 ORA-01502 错误。

```
SQL> create table a (
  2    col1 number
  3  );

Table created.

SQL> create unique index idx_a on a( col1 );

Index created.

SQL> insert into a values( 1 );

1 row created.

SQL> commit;

Commit complete.

SQL> alter index idx_a unusable;

Index altered.

SQL> insert into a values( 2 );
insert into a values( 2 )
*
ERROR at line 1:
ORA-01502: index 'SCOTT.IDX_A' or partition of such index is in unusable state

SQL> alter session set skip_unusable_indexes = true;

Session altered.

SQL> insert into a values( 2 );
insert into a values( 2 )
*
ERROR at line 1:
ORA-01502: index 'SCOTT.IDX_A' or partition of such index is in unusable state

SQL> drop index idx_a;

Index dropped.

SQL> create index idx_a_nonunique on a( col1 );

Index created.

SQL> alter index idx_a_nonunique unusable;

Index altered.

SQL> insert into a values( 2 );

1 row created. 
```

# api - 通过反射的方法参数值

> ID：187989
> 
> 赞同：2
> 
> 时间：2008-10-09T16:11:18.583
> 
> 标签：api, reflection, .net-3.5, clr

我正在尝试使用反射记录方法的参数。我也阅读了关于 StackOverflow 上发布的关于此问题的[较早问题](https://stackoverflow.com/questions/168396/capturing-method-state-using-reflection)，这将我指向 CLR API。

是否有可能，有人可以指出我正确的方向，至于我将如何获取使用 API 传递的参数值？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-09T16:18:41.063

基本上你不能在“香草”.NET 代码中。参数只是局部变量，如果不深入研究其他线程中提到的调试器 API，就无法获取它们的值。

您*可以*做的是使用[PostSharp](http://www.sharpcrafters.com/solutions/logging)插入日志记录代码。我建议在查看调试 API 之前先走这条路！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-09T16:41:14.857

如果您喜欢冒险，可以查看 System.Runtime.Remoting.Messaging 中的 RealProxy 类。它允许您实现一个代理类，该类可以拦截对您的方法的调用。然后，您可以注销参数并将呼叫转发到您的实际班级。

这会对性能产生影响，但它可能会给你你正在寻找的东西......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-09T16:57:16.367

@Sean：这看起来很有希望，是否可以在 WCF 中拦截并获取类似的值？我知道服务日志已经包含该信息，但很难挖掘它，这使我寻找记录方法及其参数的替代方法。

# windows - 为什么 GCC-Windows 依赖于 cygwin？

> ID：187990
> 
> 赞同：39
> 
> 时间：2008-10-09T16:11:21.030
> 
> 标签：windows, gcc, cygwin, posix, compiler-construction

我不是 C++ 开发人员，但我一直对编译器很感兴趣，而且我对修补一些 GCC 的东西（尤其是 LLVM）很感兴趣。

在 Windows 上，GCC 需要 POSIX 仿真层（cygwin 或 MinGW）才能正确运行。

这是为什么？

我使用许多其他软件，用 C++ 编写并针对不同平台（Subversion、Firefox、Apache、MySQL）进行交叉编译，它们都不需要 cygwin 或 MinGW。

我对 C++ 最佳实践编程的理解是，您可以编写合理的平台中立代码并处理编译过程中的所有差异。

那么与 GCC 有什么关系呢？为什么它不能在 Windows 上本地运行？

* * *

编辑：

好的，到目前为止，这两个回复基本上说，“GCC 使用 posix 层，因为它使用 posix 标头”。

但这并不能真正回答问题。

假设我已经为我最喜欢的标准库准备了一组头文件。为什么我仍然需要 posix 标头？

GCC 是否需要 cygwin/mingw 才能实际*运行*？

还是只需要头文件和库的仿真层？如果是这样，为什么我不能只给它一个包含所需资源的“lib”目录？

* * *

再次编辑：

好的，我会再次尝试澄清问题...

我还用[D 编程语言](http://digitalmars.com/d)编写代码。官方编译器名为“dmd”，并且有适用于 Windows 和 linux 的官方编译器二进制文件。

Windows 版本不需要任何类型的 POSIX 仿真。Linux 版本不需要任何类型的 Win32 仿真。如果编译器对其环境有假设，它会很好地隐藏这些假设。

当然，我必须告诉编译器在哪里可以找到标准库以及在哪里可以找到静态或动态链接的库。

相比之下，GCC 坚持假装它在 posix 环境中运行，它要求我通过设置一个仿真层来满足这些假设。

但是，在 GCC 中，究竟是什么依赖于该层？它只是在寻找 stdlib 标头，并假设它会在“/usr/lib”中找到这些标头吗？

如果是这样的话，我不应该告诉它在“C：/gcc/lib”中查找那些头文件吗？

或者 GCC 本身是否依赖 POSIX 库来访问文件系统（以及做其他低级的事情）？如果是这样的话，那么我想知道为什么他们不只是静态链接到他们最喜欢的 windows POSIX 库。当用户可以将这些依赖项直接构建到应用程序中时，为什么还要要求用户设置依赖项？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-10-26T12:36:21.360

实际上，问题前提是错误的：[MinGW](http://www.mingw.org/) GCC**不需要**Cygwin。

你会发现你根本不需要 Cygwin。它在 Windows（至少 32 位）上本机运行。工具链和生成的二进制文件都独立于 Cygwin。

Cygwin 中可用的 MinGW 编译器是不同的：它们构建在 Cygwin 平台上，用于生成不依赖于 Cygwin 运行时的代码。在这种情况下，编译器本身确实依赖于 Cygwin。但那是因为你是从 Cygwin 安装它们的。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-12-10T00:49:36.047

GCC的**[Cygwin版本需要安装](http://www.cygwin.com/)****[Cygwin](http://www.mingw.org/wiki/Cygwin)**才能编译程序。

**[MinGW](http://www.mingw.org/)**版本在编译后不需要任何东西，除了 Windows 的工作副本。

您不能真正将 Cygwin 环境和 MinGW 编译器混合在一起，因为 Cygwin 会更改预编译库的路径。

如果您需要 bash 样式的 shell，但又不想使用 Cygwin，我会推荐[MSYS](http://www.mingw.org/wiki/MSYS)。

# Cygwin 与 MinGW 的对比

*复制自[MinGW Wiki](http://www.mingw.org/wiki/Cygwin)*

> Cygwin 应用程序原则上不被视为“本机 Win32 应用程序”，因为它依赖于 Cygwin® POSIX Emulation DLL 或`cygwin1.dll`Posix 函数，并且不直接使用 win32 函数。另一方面，MinGW 提供由 Win32 API 提供的函数。在 MinGW 下移植应用程序时，非 Win32 原生的功能（例如`fork()`，`mmap()`或`ioctl()`将需要重新实现为 Win32 等效项，以使应用程序正常运行）。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-19T03:43:18.910

POSIX（便携式操作系统接口）“是由 IEEE 产生并由 ANSI 和 ISO 标准化的不断发展的文档。POSIX 的目标是应用程序的源代码可移植性”[1]。

实际上，目标被定义为编写一个源代码实现并让它在不同的（符合 POSIX 的）系统上运行的能力，而只需重新编译。

GCC 是一个能够实现这一承诺的编译器，因此，它需要一层代码来使机器“达到”POSIX 标准。

这是您问题答案的核心。

为了帮助理解我的意思，我将为您提供以下练习：

*   编写一个没有特定于操作系统的#ifdefs 的程序，该程序将用户的某个目录路径作为输入，并将其内容列表（一级）写入标准输出。

我想你会发现很难编写只使用在任何 UNIX 或 LINUX 系统上编译的本机 WIN32 API 的代码

编写使用 POSIX API 的代码——就像在任何 LINUX 机器上一样——并让它在 Windows 下编译（DevStudio2005 现在有数量惊人的符合 POSIX 的标头......你可能会得到关）。

从上面带你 LINUX 程序，现在在 Cygwin 或 MinGW 下运行的 GCC 下编译它。我敢打赌它会编译并运行。

GCC 是如何发挥这种魔力的？Cygwin 或 MinGW 提供的 POSIX 标头和底层实现。

GCC 在 Windows 下对 Cygwin/MinGW 的依赖现在是否更有意义？

1.  POSIX.4：面向现实世界的编程，Bill O. Gallmeister，O'Reilly & Associates, Inc.，第 2 页

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-04T10:48:19.087

我试图让我的程序在 Windows 下表现得像一个优秀的 Windows 公民，在 Linux 下表现得像一个优秀的 Linux 公民。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-09T16:25:11.970

Windows 不提供标准 POSIX 库，因此 cygwin 提供了一个（cygwin1.dll）。cygwin 自带的 gcc 包使用它。

另一方面，mingw 不一定提供 POSIX 层。例如，我使用的 mingw 安装甚至没有 pthread 库。

如果我需要它，我必须安装它。Mingw-gcc 生成 Win32 本机代码（实际上依赖于 MSVCRT.DLL）。

编辑：阅读您的编辑我不再确定您是否在问为什么 gcc 本身需要 mingw/cygwin 库，或者在 Win 上使用 gcc 编译的程序是否需要这些库

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-19T04:45:10.273

为什么？因为在创建[GCC](http://en.wikipedia.org/wiki/GNU_Compiler_Collection)时，Windows 32 位甚至还没有退出......

更准确地说——它是为 UNIX/Posix OS 开发的。后来被移植到windows上。

Windows 不是 POSIX 兼容系统。它甚至不提供非常基本的功能。试试看`readdir`还是`stat`在windows下编译？这是非常基本的功能，您需要编写编译器！

需要明确的是，GCC 编译的程序通常只需要一个 mingw32.dll 来添加缺少的功能即可运行。

所以...你问为什么 GCC 需要一些 POSIX 层？因为 Windows 操作系统不是 POSIX 操作系统。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-05-05T14:15:00.710

> 我不是 C++ 开发人员，但我一直对编译器很感兴趣，而且我对修补一些 GCC 的东西很感兴趣（尤其是 LLVM）

请注意，LLVM 和 GCC 不相关。LLVM 很大程度上是 Chris Lattner ( [http://llvm.org/developers.cgi](http://llvm.org/developers.cgi) ) 关于现代优化的研究结果。他的论文可在[http://llvm.org](http://llvm.org)上找到。如今，它得到了苹果的大力赞助。GCC 的 C/C++/Obj-C 前端用于 llvm-gcc，它发出 LLVM 机器代码（在 llvm 中经过大量优化后，最终的可执行文件出现了）；llvm-gcc 是一种将一些现成的 C/C++/Obj-C 前端耦合到 LLVM 的 hack。

无论如何请注意，LLVM 团队还构建了一个自己的、完整的 C/C++/Obj-C 编译器，称为 clang。它的 C 实现接近完成，C++ 支持越来越好，但不知道 Obj-C。

所以，如果有人说“compiler llvm”，他的意思要么是llvm-gcc，要么是clang。LLVM 本身只是低级虚拟机，只有少数静态单一分配形式的指令（大约 32 条指令，公平的），但是大量的优化传递到你的语法树上。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-09T16:18:15.637

为不同平台编译的大部分软件都是在 MinGW 中编译的。与 gcc 的唯一区别在于它*本身*是一个编译器，这意味着它需要通常与程序一起编译的所有头文件，并且通常不需要运行生成的程序。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-01-10T06:27:50.050

因为支持 GCC 的人满怀热情地讨厌 Windows（总有一天会读到 Stallman）。因此，当将 GCC 移植到 Windows 时，他们尽最大努力假装它只是另一个 Unix。

那，他们可能不想花时间从代码中删除 POSIX 依赖项。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-06-22T19:17:03.087

The MinGW-w64 port of gcc creates native code for 32- and 64-bit Windows without any additional dependencies. See for example [http://mstenberg.com/blog/2010/06/13/gcc-for-windows/](http://mstenberg.com/blog/2010/06/13/gcc-for-windows/) for a quick getting-started guide.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-09-06T15:32:34.627

如果您不想支持 pthread 或 OpenMP，则在构建 gcc 时可以选择指定 posix 以外的 enable-threads 选项。不用说，这些都没有经过很好的测试。有一些第 3 方对带有 Windows 线程的 OpenMP 的封闭源代码支持，但它与 gcc 的使用似乎违反了许可。由于 Windows pthreads 库是 Windows 线程功能的更高级别接口，因此当它性能不佳或遇到 Microsoft 拒绝支持亲和性支持时，这可能并不奇怪。直到最近，微软才开始在 Windows 上容忍 gcc。曾经有一段时间，他们实际上说他们不会处理 gcc 用户报告的错误，即使它们可以用专门的 Microsoft 工具复制。

# sql - SQL Server 中的行偏移量

> ID：187998
> 
> 赞同：138
> 
> 时间：2008-10-09T16:13:03.757
> 
> 标签：sql, sql-server

SQL Server 中是否有任何方法可以从给定的偏移量开始获取结果？例如，在另一种类型的 SQL 数据库中，可以这样做：

```
SELECT * FROM MyTable OFFSET 50 LIMIT 25 
```

得到结果 51-75。SQL Server 中似乎不存在此构造。

如何在不加载所有我不关心的行的情况下完成此操作？谢谢！

* * *

## 回答 #1

> 赞同：157
> 
> 时间：2008-10-09T16:23:10.663

我会避免使用`SELECT *`. 指定您实际需要的列，即使它可能是所有列。

**SQL Server 2005+**

```
SELECT col1, col2 
FROM (
    SELECT col1, col2, ROW_NUMBER() OVER (ORDER BY ID) AS RowNum
    FROM MyTable
) AS MyDerivedTable
WHERE MyDerivedTable.RowNum BETWEEN @startRow AND @endRow 
```

**SQL Server 2000**

[在 SQL Server 2000 中高效地对大型结果集进行分页](http://www.4guysfromrolla.com/webtech/041206-1.shtml)

[通过大型结果集进行分页的更有效方法](http://www.4guysfromrolla.com/webtech/042606-1.shtml)

* * *

## 回答 #2

> 赞同：109
> 
> 时间：2011-04-02T21:22:58.903

如果您将按顺序处理所有页面，那么只需记住上一页上看到的最后一个键值，`TOP (25) ... WHERE Key > @last_key ORDER BY Key`如果存在合适的索引以允许有效地查找它，则使用可能是性能最佳的方法 -如果没有，则[使用 API 游标](https://dba.stackexchange.com/a/68280/3690).

对于选择任意页面，SQL Server 2005 - 2008 R2 的最佳解决方案可能`ROW_NUMBER`是`BETWEEN`

对于 SQL Server 2012+，您可以使用增强的[ORDER BY](http://msdn.microsoft.com/en-us/library/ms188385%28SQL.110%29.aspx)子句来满足此需求。

```
SELECT  *
FROM     MyTable 
ORDER BY OrderingColumn ASC 
OFFSET  50 ROWS 
FETCH NEXT 25 ROWS ONLY 
```

尽管[这个选项的性能如何还有待观察](http://sqlblogcasts.com/blogs/sqlandthelike/archive/2010/11/10/denali-paging-is-it-win-win.aspx)。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-10-09T16:22:26.860

这是一种方式（SQL2000）

```
SELECT * FROM
(
    SELECT TOP (@pageSize) * FROM
    (
        SELECT TOP (@pageNumber * @pageSize) *
        FROM tableName 
        ORDER BY columnName ASC
    ) AS t1 
    ORDER BY columnName DESC
) AS t2 
ORDER BY columnName ASC 
```

这是另一种方式（SQL 2005）

```
;WITH results AS (
    SELECT 
        rowNo = ROW_NUMBER() OVER( ORDER BY columnName ASC )
        , *
    FROM tableName 
) 
SELECT * 
FROM results
WHERE rowNo between (@pageNumber-1)*@pageSize+1 and @pageNumber*@pageSize 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-10-09T16:25:31.113

你可以使用`ROW_NUMBER()`函数来得到你想要的：

```
SELECT *
FROM (SELECT ROW_NUMBER() OVER(ORDER BY id) RowNr, id FROM tbl) t
WHERE RowNr BETWEEN 10 AND 20 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2014-05-12T15:50:16.770

SQL Server 2012 中有`OFFSET .. FETCH`，但您需要指定一`ORDER BY`列。

如果您确实没有任何可以作为列传递的显式`ORDER BY`列（正如其他人所建议的那样），那么您可以使用这个技巧：

```
SELECT * FROM MyTable 
ORDER BY @@VERSION 
OFFSET 50 ROWS FETCH NEXT 25 ROWS ONLY 
```

... 或者

```
SELECT * FROM MyTable 
ORDER BY (SELECT 0)
OFFSET 50 ROWS FETCH NEXT 25 ROWS ONLY 
```

当用户没有明确指定订单时，我们在[jOOQ中使用它。](http://www.jooq.org)然后，这将产生相当随机的排序，而无需任何额外费用。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2012-10-25T15:37:59.907

对于具有更多和大数据列的表，我更喜欢：

```
SELECT 
  tablename.col1,
  tablename.col2,
  tablename.col3,
  ...
FROM
(
  (
    SELECT
      col1
    FROM 
    (
      SELECT col1, ROW_NUMBER() OVER (ORDER BY col1 ASC) AS RowNum
      FROM tablename
      WHERE ([CONDITION])
    )
    AS T1 WHERE T1.RowNum BETWEEN [OFFSET] AND [OFFSET + LIMIT]
  )
  AS T2 INNER JOIN tablename ON T2.col1=tablename.col1
); 
```

-

```
[CONDITION] can contain any WHERE clause for searching.
[OFFSET] specifies the start,
[LIMIT] the maximum results. 
```

它在具有大数据（如 BLOB）的表上具有更好的性能，因为 ROW_NUMBER 函数只需查看一列，并且只返回与所有列匹配的行。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2013-12-23T18:34:44.567

请参阅我的分页器选择

```
SELECT TOP @limit * FROM (
   SELECT ROW_NUMBER() OVER (ORDER BY colunx ASC) offset, * FROM (

     -- YOU SELECT HERE
     SELECT * FROM mytable

   ) myquery
) paginator
WHERE offset > @offset 
```

这解决了分页；）

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2014-05-21T08:05:32.973

```
SELECT TOP 75 * FROM MyTable
EXCEPT 
SELECT TOP 50 * FROM MyTable 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-09T16:20:56.097

根据您的版本，您无法直接执行此操作，但您可以执行一些 hacky 之类的操作

```
select top 25 *
from ( 
  select top 75 *
  from   table 
  order by field asc
) a 
order by field desc 
```

其中“字段”是关键。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-11-27T15:10:37.757

使用该语句时应该小心，`ROW_NUMBER() OVER (ORDER BY)`因为性能很差。使用公用表表达式`ROW_NUMBER()`也是如此，情况更糟。我正在使用以下代码段，该代码段已被证明比使用具有标识的表变量来提供页码要快一些。

```
DECLARE @Offset INT = 120000
DECLARE @Limit INT = 10

DECLARE @ROWCOUNT INT = @Offset+@Limit
SET ROWCOUNT @ROWCOUNT

SELECT * FROM MyTable INTO #ResultSet
WHERE MyTable.Type = 1

SELECT * FROM
(
    SELECT *, ROW_NUMBER() OVER(ORDER BY SortConst ASC) As RowNumber FROM
    (
        SELECT *, 1 As SortConst FROM #ResultSet
    ) AS ResultSet
) AS Page
WHERE RowNumber BETWEEN @Offset AND @ROWCOUNT

DROP TABLE #ResultSet 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2015-05-07T07:21:54.803

以下将显示 25 条记录，不包括 SQL Server 2012 中的前 50 条记录。

```
SELECT * FROM MyTable ORDER BY ID OFFSET 50 ROWS FETCH NEXT 25 ROWS ONLY; 
```

您可以根据需要替换 ID

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-09T16:27:18.690

在 SqlServer2005 中，您可以执行以下操作：

```
DECLARE @Limit INT
DECLARE @Offset INT
SET @Offset = 120000
SET @Limit = 10

SELECT 
    * 
FROM
(
   SELECT 
       row_number() 
   OVER 
      (ORDER BY column) AS rownum, column2, column3, .... columnX
   FROM   
     table
) AS A
WHERE 
 A.rownum BETWEEN (@Offset) AND (@Offset + @Limit-1) 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-03-18T21:18:27.693

我使用这种技术进行分页。我没有获取所有行。例如，如果我的页面需要显示前 100 行，我只使用 where 子句获取 100 行。SQL 的输出应该有一个唯一的键。

该表具有以下内容：

```
ID, KeyId, Rank 
```

将为多个 KeyId 分配相同的等级。

SQL 是`select top 2 * from Table1 where Rank >= @Rank and ID > @Id`

我第一次通过 0 两者。第二次通过 1 和 14。第三次通过 2 和 6....

第 10 条记录 Rank & Id 的值传递给下一个

```
11  21  1
14  22  1
7   11  1
6   19  2
12  31  2
13  18  2 
```

这将对系统造成最小的压力

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2017-01-15T12:50:24.043

在不浪费时间订购记录的情况下做到这一点的最佳方法是这样的：

```
select 0 as tmp,Column1 from Table1 Order by tmp OFFSET 5000000 ROWS FETCH NEXT 50 ROWS ONLY 
```

不到一秒钟！
大桌子的最佳解决方案。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2020-04-21T19:34:25.707

使用 SQL Server 2012 (11.x) 及更高版本和 Azure SQL 数据库，您还可以拥有“fetch_row_count_expression”，还可以拥有 ORDER BY 子句。

```
USE AdventureWorks2012;  
GO  
-- Specifying variables for OFFSET and FETCH values    
DECLARE @skip int = 0  , @take int = 8;  
SELECT DepartmentID, Name, GroupName  
FROM HumanResources.Department  
ORDER BY DepartmentID ASC   
    OFFSET @skip ROWS   
    FETCH NEXT @take ROWS ONLY; 
```

[https://docs.microsoft.com/en-us/sql/t-sql/queries/select-order-by-clause-transact-sql?view=sql-server-ver15](https://docs.microsoft.com/en-us/sql/t-sql/queries/select-order-by-clause-transact-sql?view=sql-server-ver15)

**注意** OFFSET 指定在开始从查询表达式返回行之前*要跳过的行数。*它不是起始行号。因此，它必须为 0 才能包含第一条记录。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2012-04-13T17:58:02.677

我一直在寻找这个答案一段时间（对于通用查询），并找到了另一种在 SQL Server 2000+ 上使用 ROWCOUNT 和游标并且没有 TOP 或任何临时表的方法。

使用`SET ROWCOUNT [OFFSET+LIMIT]`你可以限制结果，并使用游标直接转到你想要的行，然后循环'直到最后。

所以你的查询会是这样的：

```
SET ROWCOUNT 75 -- (50 + 25)
DECLARE MyCursor SCROLL CURSOR FOR SELECT * FROM pessoas
OPEN MyCursor
FETCH ABSOLUTE 50 FROM MyCursor -- OFFSET
WHILE @@FETCH_STATUS = 0 BEGIN
    FETCH next FROM MyCursor
END
CLOSE MyCursor
DEALLOCATE MyCursor
SET ROWCOUNT 0 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2021-08-29T00:22:54.803

## 方法一：

**在这里订购似乎很重要**

在偏移之前带来限制似乎有效。

```
SELECT *
FROM MyTable
LIMIT 25
OFFSET 50 
```

* * *

## 方法二：

**或者，您可以仅使用限制**
LIMIT 取两个值
第一个：偏移值
第二个：要显示的行数

SELECT *
FROM MyTable
LIMIT (OffsetValue), (NoOfRows)

```
SELECT *
FROM MyTable
LIMIT 50, 25 
```

# .net - 如何在不加载程序集的情况下获取程序集的版本？

> ID：187999
> 
> 赞同：26
> 
> 时间：2008-10-09T16:13:11.917
> 
> 标签：.net, assemblies, versions

大型程序的一个小功能检查文件夹中的程序集并用最新版本替换过时的程序集。为此，它需要读取现有程序集文件的版本号，而无需将这些程序集实际加载到执行进程中。

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-10-09T16:21:53.833

我[在这篇文章中](http://blogs.msdn.com/alejacma/archive/2008/09/05/how-to-get-assembly-version-without-loading-it.aspx)找到了以下内容。

```
using System.Reflection;
using System.IO;

...

// Get current and updated assemblies
AssemblyName currentAssemblyName = AssemblyName.GetAssemblyName(currentAssemblyPath);
AssemblyName updatedAssemblyName = AssemblyName.GetAssemblyName(updatedAssemblyPath);

// Compare both versions
if (updatedAssemblyName.Version.CompareTo(currentAssemblyName.Version) <= 0)
{
    // There's nothing to update
    return;
}

// Update older version
File.Copy(updatedAssemblyPath, currentAssemblyPath, true); 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-09T16:23:37.887

根据文件，一个选项可能是`FileVersionInfo`- 即

```
FileVersionInfo fvi = FileVersionInfo.GetVersionInfo(path)
string ver = fvi.FileVersion; 
```

问题是这取决于具有`[AssemblyFileVersion]`属性的代码，并且它与属性匹配`[AssemblyVersion]`。

不过，我想我会先看看其他人建议的 AssemblyName 选项。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-09T16:21:33.383

使用`AssemblyName.GetAssemblyName("assembly.dll");`，然后解析名称。根据[MSDN](http://msdn.microsoft.com/en-us/library/system.reflection.assemblyname.getassemblyname.aspx)：

> 这仅在文件包含程序集清单时才有效。此方法会导致文件被打开和关闭，但程序集不会添加到此域。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-02-13T13:18:48.553

仅作记录：以下是在 C#.NET Compact Framework 中获取文件版本的方法。它基本上来自 OpenNETCF，但相当短且经过提取，因此可以通过复制粘贴。希望它会有所帮助...

```
public static Version GetFileVersionCe(string fileName)
{
    int handle = 0;
    int length = GetFileVersionInfoSize(fileName, ref handle);
    Version v = null;
    if (length > 0)
    {
        IntPtr buffer = System.Runtime.InteropServices.Marshal.AllocHGlobal(length);
        if (GetFileVersionInfo(fileName, handle, length, buffer))
        {
            IntPtr fixedbuffer = IntPtr.Zero;
            int fixedlen = 0;
            if (VerQueryValue(buffer, "\\", ref fixedbuffer, ref fixedlen))
            {
                byte[] fixedversioninfo = new byte[fixedlen];
                System.Runtime.InteropServices.Marshal.Copy(fixedbuffer, fixedversioninfo, 0, fixedlen);
                v = new Version(
                    BitConverter.ToInt16(fixedversioninfo, 10), 
                    BitConverter.ToInt16(fixedversioninfo,  8), 
                    BitConverter.ToInt16(fixedversioninfo, 14),
                    BitConverter.ToInt16(fixedversioninfo, 12));
            }
        }
        Marshal.FreeHGlobal(buffer);
    }
    return v;
}

[DllImport("coredll", EntryPoint = "GetFileVersionInfo", SetLastError = true)]
private static extern bool GetFileVersionInfo(string filename, int handle, int len, IntPtr buffer);
[DllImport("coredll", EntryPoint = "GetFileVersionInfoSize", SetLastError = true)]
private static extern int GetFileVersionInfoSize(string filename, ref int handle);
[DllImport("coredll", EntryPoint = "VerQueryValue", SetLastError = true)]
private static extern bool VerQueryValue(IntPtr buffer, string subblock, ref IntPtr blockbuffer, ref int len); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-02-26T17:44:43.370

使用[AssemblyLoadContext](https://docs.microsoft.com/en-us/dotnet/core/dependency-loading/understanding-assemblyloadcontext)`.netcore`更新乔尔的答案：

```
using System.IO;
using System.Reflection;
using System.Runtime.Loader;

...

// Get current and updated assemblies
AssemblyName currentAssemblyName = AssemblyLoadContext.GetAssemblyName(currentAssemblyPath);
AssemblyName updatedAssemblyName = AssemblyLoadContext.GetAssemblyName(updatedAssemblyPath);

// Compare both versions
if (updatedAssemblyName.Version.CompareTo(currentAssemblyName.Version) <= 0)
{
    // There's nothing to update
    return;
}

// Update older version
File.Copy(updatedAssemblyPath, currentAssemblyPath, true); 
```

> 我发现这在分析由 Windows 服务运行（和锁定）的 DLL 时很有用，这是一种比创建单独的`AppDomain`.*******